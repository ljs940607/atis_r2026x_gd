define("DS/MPFSubscriptionsComponent/offerList/OfferFilters",["UWA/Core","UWA/String","UWA/Class/View","DS/UIKIT/Input/Select","DS/MPFPortfolioModel/PortfolioModel","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],(function(t,e,s,i,o,n){"use strict";var r={},a={};r.NEW_FILTER_VALUE="newFilterValue",a.PERIODICITY="periodicity";var c=s.extend({className:"mpf-subs-filters",setup:function(t){t||(t={}),this._parent(t),this.periodicityFilterLabel=this._createPeriodicityFilterLabel(),this.periodicityFilterSelect=this._createPeriodicityFilterSelect()},render:function(){var e;return e=t.createElement("div",{class:"mpf-filter-block",html:[this.periodicityFilterLabel,this.periodicityFilterSelect]}),this.container.setContent(e),this},_onNewFilterValue:function(t){this[t.filterType]=t.value,this.dispatchEvent(r.NEW_FILTER_VALUE,t)},setPeriodicityFilterValue:function(t){this.periodicityFilterSelect.select(t,!0,!0)},getPeriodicityValue:function(){return this.periodicityFilterSelect.getValue()[0]},disablePeriodicityFilter:function(){this.periodicityFilterSelect.setDisabled()},enablePeriodicityFilter:function(){this.periodicityFilterSelect.setDisabled(!1)},_createPeriodicityFilterLabel:function(){return t.createElement("div",{class:"mpf-filter-label",text:n.get("subscription")+":"})},_createPeriodicityFilterOptions:function(){return Object.values(o.RevTypes).filter((t=>t!==o.RevTypes.QRC)).map((t=>({label:e.ucfirst(n.get(t)),value:t})))},_createPeriodicityFilterSelect:function(){var t=this,e=this._createPeriodicityFilterOptions();return new i({placeholder:!1,value:e[1],options:e,events:{onChange:function(){t._onNewFilterValue({filterType:a.PERIODICITY,value:this.getValue()[0]})}}})}});return c.Events=Object.freeze(r),c.FilterTypes=Object.freeze(a),c})),define("DS/MPFSubscriptionsComponent/quoteList/ProductListTile",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Button","DS/UIKIT/Modal","DS/UIKIT/Mask","DS/MPFAmdLazyLoader/AmdLazyLoader","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartItemModel","DS/MPFCartModel/LicensingSchemeMapping","DS/MPFFiniteStateMachine/FiniteStateMachine","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],((t,e,s,i,o,n,r,a,c,l,h,d)=>{"use strict";const p=Object.freeze({SHOW_MORE_ACTIVATED:"showMoreActivated",SHOW_MORE_DESACTIVATED:"showMoreDesactivated"});return e.extend({className:"mpf-product-details table-responsive",setup(t={}){this._parent(t),this._checkPrototypes(t),this.locale=t.locale||"fr-FR",this.cart=t.cart,this.compassPortfolios=t.compassPortfolios,this.stateMachine=this._createStateMachine(),this.showMoreButton=this._createShowMoreButton()},render(){const t=[];return t.push(this._createTable()),this.cart.getItems().length>5&&t.push(this.showMoreButton),this.container.setContent(t),this},destroy(){this.cart=null,this.compassPortfolios=null,this._parent(),this.container=null},_onClickButton(){this.stateMachine.getState()===p.SHOW_MORE_DESACTIVATED?(this.stateMachine.changeState(p.SHOW_MORE_ACTIVATED),this.showMoreButton.setValue(d.get("showLess"))):this.stateMachine.getState()===p.SHOW_MORE_ACTIVATED&&(this.stateMachine.changeState(p.SHOW_MORE_DESACTIVATED),this.showMoreButton.setValue(d.get("showMore"))),this.render()},_createShowMoreButton(){return new s({value:d.get("showMore"),className:"link",events:{onClick:this._onClickButton.bind(this)}})},_createTable(){return t.createElement("table",{class:"table table-condensed",html:[this._createHeader(),this._createBody()]})},_formatPrice(t){return t.toLocaleString(this.locale,{style:"currency",currency:this.cart.getCurrency()})},_displayMarketingModal(t){return o.mask(this.container),this._createMarketingModal(t).then((t=>{o.unmask(this.container),this.container.addContent(t),t.render().show()}))},_createMarketingModal(t){return n.getInstance().get(["DS/MPFSubscriptionsComponent/quoteList/MarketingModal"]).then((([e])=>new e({item:t,compassPortfolios:this.compassPortfolios})))},_getTotalPrice(e){return t.createElement("td",{class:"mpf-total-price-cell",text:this._formatPrice(e.getTotalNetAmount())})},_getUnitCell(e){return t.createElement("td",{class:"mpf-unit-price-cell",text:this._formatPrice(e.getUnitNetAmount())})},_getQuantityCell:e=>t.createElement("td",{class:"mpf-quantity-cell",text:parseInt(e.getQuantity())}),_getLicensingSchemeCell(e){const s=l.getLicensingLabel(e.getLicensing());return t.createElement("td",{class:"mpf-licensing-cell",text:t.is(s)?s:""})},_getPeriodicityCell(e){let s=e.getLicensingScheme(),i="";return s?(s===c.RevTypes.QRC&&(s=c.RevTypes.QSC),i=s===c.RevTypes.YSC?d.get("yearly"):s===c.RevTypes.MSC?d.get("monthly"):d.get("quarterly")):s="",t.createElement("td",{class:"mpf-periodicity-cell",html:[t.createElement("div",{class:"mpf-periodicity-label",text:i}),t.createElement("div",{class:"mpf-periodicity-trigram",text:"("+s+")"})]})},_getProductCell(e){const s=e.getType()===c.Types.INNOVATE_REQUEST||c.Types.PHASE_ITEM,i=t.createElement("span",{class:"fonticon fonticon-info",events:{click:this._displayMarketingModal.bind(this,e)}}),o=t.createElement("div",{class:"mpf-product-info",html:[t.createElement("div",{class:"mpf-product-number-label",text:e.getProductDisplayName()}),t.createElement("div",{class:"mpf-product-number-value",html:[t.createElement("span",{text:d.get("productNumber")}),s?e.getProductTrigram():e.getProductNumber()]})]});return t.createElement("td",{class:"mpf-product-cell",html:[i,o]})},_getProductDetails(e){return t.createElement("tr",{html:[this._getProductCell(e),this._getLicensingSchemeCell(e),this._getPeriodicityCell(e),this._getQuantityCell(e),this._getUnitCell(e),this._getTotalPrice(e)]})},_createBody(){return t.createElement("tbody",{html:this.cart.getItems().map(((t,e)=>t.getQuantity()>0&&(e<5||this.stateMachine.getState()===p.SHOW_MORE_ACTIVATED)?this._getProductDetails(t):""))})},_createHeader:()=>t.createElement("thead",{html:t.createElement("tr",{html:[t.createElement("th",{text:d.get("products")}),t.createElement("th",{text:d.get("licensingScheme")}),t.createElement("th",{text:d.get("subscription")}),t.createElement("th",{text:d.get("quantity")}),t.createElement("th",{text:d.get("unitPrice")}),t.createElement("th",{text:d.get("totalPrice")})]})}),_createStateMachine:()=>new h({state:p.SHOW_MORE_DESACTIVATED,states:[p.SHOW_MORE_ACTIVATED,p.SHOW_MORE_DESACTIVATED],transitions:[{from:p.SHOW_MORE_ACTIVATED,to:p.SHOW_MORE_DESACTIVATED},{from:p.SHOW_MORE_DESACTIVATED,to:p.SHOW_MORE_ACTIVATED}]}),_checkPrototypes(t){r.requiredOfPrototype(t.cart,a,"options.cart must be a CartModel")}})})),define("DS/MPFSubscriptionsComponent/roleList/ReasonsToStop",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Select","DS/UIKIT/Input/Text","DS/MPFServices/ObjectService","i18n!DS/MPFSubscriptionsComponent/assets/nls/ReasonsToStop"],(function(t,e,s,i,o,n){"use strict";const r=Object.freeze({COST:"Cost",NOT_MY_NEEDS:"Didn't meet my needs",NO_LONGER_NEEDED:"Solution no longer needed",SWITCHING_SOLUTION:"Switching to another solution",USER_EXPERIENCE:"User experience",TECHNICAL_ISSUES:"Technical issues",OTHER:"Other",BUDGET_LIMITATION:"Budget limitation",NOT_ENOUGH_VALUE:"Not enough value",COMPARED_COMPETITORS:"Compared to competitors",MISSING_FEATURE:"Missing feature",TOO_COMPLEX:"Technically too complex",PRESENT_TIME:"At the present time",NOT_IN_FUTURE:"Not in the foreseeable future",DS_SOLUTION:"Dassault Systemes solution",EASE_OF_USE:"General ease of use",GETTING_STARTED:"Difficulty getting started",MISSING_MATERIALS:"Missing learning materials",INSUFFICIENT_SUPPORT:"Insufficient support",HARDWARE_COMPATIBILITY:"Hardware compatibility or requirements",INSTALLATION:"Installation",DATA_MIGRATION:"Data migration",RELIABILITY:"Reliability",PERFORMANCE:"Performance",ACCESSIBILITY:"Accessibility"}),a=e.extend({className:"mpf-reasons-to-stop",setup(){this.reasonSelect=this._createReasonSelect(),this.detailsSelect=this._createDetailsSelect(),this.reasonWrapper=this._createSelectWrapper({select:this.reasonSelect,selectType:"reason"}),this.detailsWrapper=this._createSelectWrapper({select:this.detailsSelect,selectType:"details"}),this.additionalMention=this._createAdditionalMention(),this.commentsField=this._createCommentsField()},render(){return this.container.setContent([{tag:"div",class:"mpf-top-mention",text:n.get("whyStopping")},this.reasonWrapper,this.detailsWrapper,this.additionalMention,this.commentsField]),this},getReasons(){return{reason:this.reasonSelect.getValue()[0],subReasons:this.detailsSelect.getValue(),comment:this.commentsField.getValue()}},isValid(){let t=!0;return""===this.reasonSelect.getValue()[0]&&(this.reasonWrapper.addClassName("mpf-invalid"),t=!1),this.reasonSelect.getValue()[0]!==r.OTHER&&""===this.detailsSelect.getValue()[0]&&(this.detailsWrapper.addClassName("mpf-invalid"),t=!1),""!==this.additionalMention.getText()&&""===this.commentsField.getValue()&&(this.commentsField.setClassName("mpf-comments-field mpf-invalid"),t=!1),t},destroy(){this.reasonSelect.destroy(),this.detailsSelect.destroy(),this.commentsField.destroy(),this._parent(),this.container=null},_createSelectWrapper({select:e,selectType:s}){return t.createElement("div",{class:"mpf-select-wrapper",html:[t.createElement("div",{class:"mpf-select-label",html:["reason"===s?n.get("selectReason"):n.get("selectDetails"),this._getRequired()]}),e]})},_createReasonSelect(){return new s({className:"mpf-select-reason",placeholder:n.get("selectReason"),required:!0,options:this._getReasonOptions(),events:{onChange:()=>{this.reasonWrapper.removeClassName("mpf-invalid"),this.detailsWrapper.removeClassName("mpf-invalid"),this.commentsField.setClassName("mpf-comments-field"),this._reasonOnChange()}}})},_reasonOnChange(){this.detailsSelect.remove(),this.detailsSelect.add(this._getDetailsOptions()),this._updateAdditionalMention(),this.reasonSelect.getValue()[0]===r.OTHER?(this.detailsSelect.disable(),this.detailsSelect.options.required=!1,this.detailsWrapper.getElementsByClassName("mpf-select-label")[0].setContent(n.get("selectDetails"))):this.detailsSelect.isDisabled()&&(this.detailsSelect.enable(),this.detailsSelect.options.required=!0,this.detailsWrapper.getElementsByClassName("mpf-select-label")[0].setContent([n.get("selectDetails"),this._getRequired()]))},_updateAdditionalMention(){const t=this.reasonSelect.getValue()[0],e=this.detailsSelect.getValue();t===r.OTHER||e.includes(r.OTHER)?t===r.SWITCHING_SOLUTION?this.additionalMention.setContent([n.get("pleaseSpecify"),this._getRequired()]):this.additionalMention.setContent([n.get("pleaseProvide"),this._getRequired()]):t===r.NOT_MY_NEEDS&&e.includes(n.get("missingFeature"))?this.additionalMention.setContent([n.get("pleaseProvide"),this._getRequired()]):this.additionalMention.setContent("")},_createDetailsSelect(){return new s({className:"mpf-select-details",placeholder:n.get("selectDetails"),required:!0,multiple:!0,options:this._getDetailsOptions(),events:{onChange:()=>{this.detailsWrapper.removeClassName("mpf-invalid"),this.commentsField.setClassName("mpf-comments-field"),this._updateAdditionalMention()}}})},_createAdditionalMention:()=>t.createElement("div",{class:"mpf-additional-mention",text:""}),_createCommentsField(){return new i({className:"mpf-comments-field",placeholder:n.get("additionalInformation"),multiline:!0,rows:3,attributes:{type:"text"},events:{onChange:()=>{this.commentsField.setClassName("mpf-comments-field")}}})},_getRequired:()=>t.createElement("span",{class:"mpf-required",text:" *"}),_getReasonOptions:()=>[{value:r.COST,label:n.get("cost")},{value:r.NOT_MY_NEEDS,label:n.get("notMyNeeds")},{value:r.NO_LONGER_NEEDED,label:n.get("noLongerNeeded")},{value:r.SWITCHING_SOLUTION,label:n.get("switchingSolution")},{value:r.USER_EXPERIENCE,label:n.get("userExperience")},{value:r.TECHNICAL_ISSUES,label:n.get("technicalIssues")},{value:r.OTHER,label:n.get("other")}],_getDetailsOptions(){let t=[];switch(this.reasonSelect.getValue()[0]){case r.COST:t=[{value:r.BUDGET_LIMITATION,label:n.get("budgetLimitation")},{value:r.NOT_ENOUGH_VALUE,label:n.get("notEnoughValue")},{value:r.COMPARED_COMPETITORS,label:n.get("comparedCompetitors")}];break;case r.NOT_MY_NEEDS:t=[{value:r.MISSING_FEATURE,label:n.get("missingFeature")},{value:r.TOO_COMPLEX,label:n.get("tooComplex")},{value:r.OTHER,label:n.get("other")}];break;case r.NO_LONGER_NEEDED:t=[{value:r.PRESENT_TIME,label:n.get("presentTime")},{value:r.NOT_IN_FUTURE,label:n.get("notInFuture")}];break;case r.SWITCHING_SOLUTION:t=[{value:r.DS_SOLUTION,label:n.get("DSSolution")},{value:r.OTHER,label:n.get("other")+" "+n.get("tellUsWhy")}];break;case r.USER_EXPERIENCE:t=[{value:r.EASE_OF_USE,label:n.get("easeOfUse")},{value:r.GETTING_STARTED,label:n.get("gettingStarted")},{value:r.MISSING_MATERIALS,label:n.get("missingMaterials")},{value:r.INSUFFICIENT_SUPPORT,label:n.get("insufficientSupport")}];break;case r.TECHNICAL_ISSUES:t=[{value:r.HARDWARE_COMPATIBILITY,label:n.get("hardwareCompatibility")},{value:r.INSTALLATION,label:n.get("installation")},{value:r.DATA_MIGRATION,label:n.get("dataMigration")},{value:r.RELIABILITY,label:n.get("reliability")},{value:r.PERFORMANCE,label:n.get("performance")},{value:r.ACCESSIBILITY,label:n.get("accessibility")+" "+n.get("accessibilityExamples")},{value:r.OTHER,label:n.get("other")}];break;default:t=[]}return t}});return a.Reasons=r,a})),define("DS/MPFSubscriptionsComponent/quoteList/QuoteCardFooter",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFPersonModel/PersonFactory","DS/MPFCartModel/CartFactory","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],((t,e,s,i,o,n,r,a,c)=>{"use strict";const l=Object.freeze({DISPLAY_CHECKOUT:"displayCheckout"}),h=e.extend({className:"mpf-quote-card-footer",setup(t={}){this._parent(t),this._checkPrototypes(t),this.locale=t.locale||"fr-FR",this.cart=t.cart,this.cartFactory=t.cartFactory,this.personFactory=t.personFactory},render(){const e=[this._getTotalPriceQuote(),this._getButton()],s=t.createElement("div",{class:"mpf-quote-card-footer-right",html:e});return this.container.setContent(s),this},destroy(){this.stopListening(),this.cart=null,this.cartFactory=null,this.personFactory=null,this._parent(),this.container=null},async _changeCartOwnerAndProceedToPayment(){await this._changeCartOwner(),this.dispatchEvent(l.DISPLAY_CHECKOUT)},_changeCartOwner(){const t=this.personFactory.createModel(r.Types.ME),e=this.cartFactory.createModel(a.Types.OWNER,{id:this.cart.id});return i.mask(this.container),t.fetchPromise().then((()=>e.dataProxy.requestPromise(e.dataProxy.urlPatch(e),{method:"PATCH",data:JSON.stringify({id:t.id})}))).finally(i.unmask.bind(i,this.container))},_getButton(){const t={},e=this.cart.getState()===n.States.SUBMITTED||this.cart.getState()===n.States.PENDING_PAYMENT||this.cart.getState()===n.States.PAYMENT_INITIATED,i=this.cart.getGlobalState()===n.GlobalStates.WAITING_PAYMENT;if(e&&i)return t.value=this.cart.getNetAmountTotal()>0?c.get("confirmOrder"):c.get("confirm"),t.icon="",t.className="primary",t.events={onClick:this._changeCartOwnerAndProceedToPayment.bind(this)},new s(t)},_getTotalPriceQuote(){return t.createElement("div",{class:"mpf-quote-price",html:[c.get("totalPriceTaxExcl"),t.createElement("span",{text:this.cart.getNetAmountTotal().toLocaleString(this.locale,{style:"currency",currency:this.cart.getCurrency()})})]})},_checkPrototypes(t){o.requiredOfPrototype(t.cart,n,"options.cart must be a CartModel")}});return h.Events=Object.freeze(l),h})),define("DS/MPFSubscriptionsComponent/roleList/StopRenewalTableLine",["UWA/Class/View","DS/UIKIT/Input/Number","DS/UIKIT/Input/Button","DS/MPFServices/ObjectService","DS/MPFProductModel/ProductModel","DS/MPFSubscriptionModel/SubscriptionModel","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent"],(function(t,e,s,i,o,n,r){"use strict";const a=Object.freeze({ON_CONFIRMATION:"onConfirmation"}),c=Object.freeze({SELECT_QUANTITY:"selectQuantity",DEFAULT:"default"}),l=t.extend({className:"mpf-stop-renewal-table-line",setup({product:t,subscription:e,locale:s,state:r}={}){i.requiredOfPrototype(t,o,"options.product must be a ProductModel"),i.requiredOfPrototype(e,n,"options.subscription must be a SubscriptionModel"),this.product=t,this.subscription=e,this.locale=s,this.state=r||c.DEFAULT,this.quantityInput=this._renderQuantityInput()},render(){const t=this.subscription.getStatus()===n.Status.STOPPED;return this.container.setContent([{tag:"span",text:this.subscription.getQuantity()},{tag:"span",text:r.get("willBe"+(t?"StoppedOn":"RenewedOn"))},{tag:"span",text:this.subscription.getEndDate()},{tag:"span",text:this.subscription.getPrice().toLocaleString(this.locale,{style:"currency",currency:this.subscription.getCurrency()})},{tag:"span",class:"mpf-button-container",html:t?"":this._renderInputs()}]),this},_renderInputs(){return this.state===c.SELECT_QUANTITY?[this.quantityInput,this._renderConfirmationButton(),this._renderCancelButton()]:[this._renderStopRenewalButton()]},_renderQuantityInput(){const t=this.product.getName().startsWith("RCR"),s=this.subscription.getQuantity();return new e({min:t?2500:1,max:this.subscription.getQuantity(),value:t?2500:1,step:t?2500:1,disabled:t?2500===s:1===s,attributes:{title:r.get("quantityToStop")}})},_renderConfirmationButton(){return new s({className:"primary",value:r.get("confirm"),events:{onClick:()=>{this.dispatchEvent(a.ON_CONFIRMATION,{quantity:parseInt(this.quantityInput.getValue()),subscription:this.subscription})}}})},_renderCancelButton(){return new s({value:"",icon:"wrong",events:{onClick:()=>{this.state=c.DEFAULT,this.render()}}})},_renderStopRenewalButton(){return new s({value:r.get("stopRenewal"),disabled:this.subscription.isCancellationInProcess(),events:{onClick:()=>{this.state=c.SELECT_QUANTITY,this.render()}}})},destroy(){this.subscription=null,this.product=null,this._parent(),this.container=null}});return l.Events=a,l})),define("DS/MPFSubscriptionsComponent/SubscriptionsCheckout",["UWA/Class/View","UWA/Core","DS/UIKIT/Scroller","DS/UIKIT/Mask","DS/MPFServices/ObjectService","DS/MPFServices/MarketplaceServices","DS/MPFPersonModel/PersonModel","DS/MPFCartModel/CartModel","DS/MPFCheckoutPage/CheckoutPageFactory","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent"],((t,e,s,i,o,n,r,a,c,l)=>{"use strict";const h=Object.freeze({SUBSCRIPTIONS:"Subscriptions",MY_ORDERS:"MyOrders"}),d=Object.freeze({BACK_TO_CART:"backToCart",TO_PAYMENT_RESULT:"toPaymentResult",GO_TO_SUBSCRIPTIONS_TAB:"goToSubscriptionsTab",GO_TO_MY_ORDERS:"goToMyOrders"}),p=t.extend({className:"mpf-subscriptions-checkout",setup(t={}){this._checkPrototypes(t),this.me=t.me,this.cart=t.cart,this.connector=t.connector,this.parentPage=t.parentPage},async render(){this.checkoutPage=await this._createCheckoutPage();const t=e.createElement("div",{class:"mpf-checkout-content",html:this.checkoutPage.render()});this.container.setContent(t),i.unmask(this.container);try{new s({element:t}).inject(this.container)}catch(t){console.warn(t)}return this},destroy(){this.stopListening(),this.checkoutPage&&this.checkoutPage.destroy(),this.checkoutPage=null,this.me=null,this.cart=null,this.connector=null,this._parent(),this.container=null},async _createCheckoutPage(){const t=new URL(window.parent.location.href);t.search="",t.searchParams.append("mpfPage","payment-result"),t.searchParams.append("orderId",this.cart.get("id"));const e=await c.createComponent({cartId:this.cart.get("id"),connector:this.connector,service:n.SUBSCRIPTIONS,resetCartState:this.parentPage!==h.MY_ORDERS,paymentResultUrl:t.toString()});return this.listenTo(e,c.Events.BACK_TO_CART,this.dispatchEvent.bind(this,d.BACK_TO_CART)),this.listenTo(e,c.Events.PAYMENT_DONE,(async()=>{this.dispatchEvent(d.TO_PAYMENT_RESULT)})),e},_checkPrototypes(t){o.requiredOfPrototype(t.me,r,"options.me must be a PersonModel"),o.requiredOfPrototype(t.cart,a,"options.cart must be a CartModel")}});return p.Events=d,p})),define("DS/MPFSubscriptionsComponent/quoteList/QuoteIdTile",["UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],((t,e,s,i)=>{"use strict";return t.extend({className:"mpf-quote-id-tile",setup(t={}){this._parent(t),e.requiredOfPrototype(t.cart,s,"options.cart must be a CartModel"),this.cart=t.cart},render(){return this.container.setContent(this.cart.getName()),this}})})),define("DS/MPFSubscriptionsComponent/paymentMethodsList/PaymentMethodsCustomerInformation",["UWA/Core","UWA/Class/View","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent"],((t,e,s)=>{"use strict";return e.extend({className:"mpf-customer-info",setup(t={}){this.buyer=t.buyer,this.onlineInstanceId=t.onlineInstanceId,this.companyInformation=t.companyInformation,this.customerName=this._createCustomerName(),this.reference=this._createReference()},render(){return this.container.setContent([this.customerName,this.reference]),this},destroy(){this.buyer=null,this.onlineInstanceId=null,this.customerName=null,this.reference=null,this._parent(),this.container=null},_createCustomerName(){return t.createElement("dl",{html:[{tag:"dt",text:s.get("customer")},{tag:"dd",text:this.buyer.getName()}]})},_createReference(){return t.createElement("dl",{html:[{tag:"dt",text:s.get("reference")},{tag:"dd",text:this.companyInformation?this.companyInformation.getSiteId():this.onlineInstanceId}]})}})})),define("DS/MPFSubscriptionsComponent/quoteList/StatusQuoteTile",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],((t,e,s,i,o)=>{"use strict";const n=Object.freeze({CANCELLED:"CANCELLED",SUBMITTED:"SUBMITTED",WAITING_PAYMENT:"WAITING_PAYMENT",PROCESSING_PAYMENT:"PROCESSING_PAYMENT",PAID:"PAID",PROCESSING:"PROCESSING",READY:"READY",DELIVERED:"DELIVERED"}),r=Object.freeze({CANCELLED:"0",SUBMITTED:"14",WAITING_PAYMENT:"29",PROCESSING_PAYMENT:"43",PAID:"58",PROCESSING:"72",READY:"86",DELIVERED:"100"});return e.extend({className:"mpf-status-quote-tile",setup(t={}){this._parent(t),s.requiredOfPrototype(t.cart,i,"options.cart must be a CartModel"),this.cart=t.cart},render(){return this.container.setContent([this._getOrderStatusContainer(),this._getProgressBarContainer()]),this},_getProgressBarContainer(){const e=this.cart.getGlobalState(),s=r[e],i=t.createElement("div",{class:"mpf-progress-bar",html:t.createElement("div",{class:"mpf-step-bar",styles:{width:s+"%"}})});return e===n.DELIVERED&&i.addClassName("complete"),i},_getOrderStatusContainer(){const e=this._getIcon(),s=o.get(this.cart.getGlobalState().toLowerCase());return t.createElement("div",{class:"mpf-status",html:[e,s]})},_getIcon(){let e;const s=this.cart.getGlobalState();return s===n.SUBMITTED?e="fonticon fonticon-right":s===n.WAITING_PAYMENT?e="fonticon fonticon-survey":s===n.PROCESSING_PAYMENT?e="fonticon fonticon-hourglass":s===n.PAID?e="fonticon fonticon-check":s===n.PROCESSING?e="fonticon fonticon-clock":s===n.READY?e="fonticon fonticon-parcel-ok":s===n.DELIVERED?e="fonticon fonticon-status-ok":s===n.CANCELLED&&(e="fonticon fonticon-wrong"),t.createElement("span",{class:e})}})})),define("DS/MPFSubscriptionsComponent/roleList/MarketingModal",["UWA/Class/View","UWA/Core","DS/UIKIT/Modal","DS/UIKIT/Mask","DS/WebappsUtils/WebappsUtils","DS/MPFServices/ObjectService","DS/MPFProductModel/ProductModel","DS/MPFPortfolioModel/PortfolioModel","DS/MPFPortfolioModel/compass/CompassPortfolioCollection","DS/MPFClickAndBuyComponent/MarketingPortfolioPage","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],((t,e,s,i,o,n,r,a,c,l,h)=>{"use strict";const d=Object.freeze({ON_LOADED:"onLoaded",ON_ERROR:"onError"}),p=t.extend({className:"mpf-marketing-modal mpf-click-and-buy",setup(t={}){e.is(t.product)?(n.requiredOfPrototype(t.product,r,"options.product must be a ProductModel"),this.product=t.product,this.isProductModel=!0):e.is(t.offer)&&(n.requiredOfPrototype(t.offer,a,"options.offer must be a PortfolioModel"),this.offer=t.offer,this.isProductModel=!1),n.requiredOfPrototype(t.compassPortfolios,c,"options.compassPortfolios must be a CompassPortfolioCollection"),this.compassPortfolios=t.compassPortfolios,this.modal=this._createModal()},render(){const t=e.createElement("div",{class:"modal-overlay"});return this.container.setContent([this.modal,t]),this._setModalBody(),this},show(){this.modal.show()},destroy(){this.modal.destroy(),this.product=null,this.offer=null,this.compassPortfolios=null,this._parent(),this.container=null},_createModal(){return new s({className:"mpf-marketing-offer",header:{tag:"h4",text:this.isProductModel?this.product.getDisplayName():this.offer.getProductName()},events:{onHide:this.destroy.bind(this)},visible:!1})},async _setModalBody(){if(this.isProductModel&&this.product.isMarketplaceOffer())try{const t=Object.keys(this.product.getIncludedProducts()).map((t=>this.compassPortfolios.getWithTrigram(t.split("-")[0])));this.modal.setBody([{tag:"div",class:"mpf-roles-title",text:h.get("rolesIncludedInOffer")},{tag:"div",class:"mpf-roles-container",html:t.map((t=>this._renderRoleTile(t)))}]),this.dispatchEvent(d.ON_LOADED)}catch(t){console.error(t),this.dispatchEvent(d.ON_ERROR)}else{const t=this.isProductModel?this.product.getName():this.offer.getProductTrigram(),s=this.compassPortfolios.getWithTrigram(t.split("-")[0]);if(s&&s.getDescription()){const t=new l({portfolioInfo:s});this.modal.setBody(t.render())}else{const s=e.createElement("iframe",{src:"https://www.3ds.com/role/inapp/"+t+"/"});this.modal.setBody(s)}}},_renderRoleTile:t=>({tag:"div",class:"mpf-role-tile",html:[{tag:"img",src:o.getWebappsAssetUrl("i3DXCompass","v3.1/images/role/"+t.getBrand()+"_Role.png")},{tag:"span",class:"mpf-role-name",text:t.getTitle()}]})});return p.Events=d,p})),define("DS/MPFSubscriptionsComponent/OITypeNotSupportedPage",["UWA/Core","UWA/Class/View","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],((t,e,s)=>{"use strict";return e.extend({className:"mpf-oi-type-not-supported-page",setup(t){this.heroImage=this._createHeroImage(),this.title=this._createTitle(),this.message=this._createMessage()},render(){return this.container.setContent([this.heroImage,this.title,this.message]),this},destroy(){this._parent()},_createHeroImage:()=>t.createElement("div",{class:"mpf-hero-image",html:[{tag:"i",class:"fonticon fonticon-status-ko"}]}),_createTitle:()=>t.createElement("h2",{class:"mpf-title",text:s.get("oiTypeNotHandledTitle")}),_createMessage:()=>t.createElement("p",{class:"mpf-message",text:s.get("oiTypeNotHandledMessage")})})})),define("DS/MPFSubscriptionsComponent/paymentMethodsList/PaymentMethodsVirtualIbanEntry",["UWA/Core","UWA/Class/View","DS/MPFVirtualIbanModel/VirtualIbanModel","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent"],((t,e,s,i)=>{"use strict";const o={"3DS-EUR":{accountName:s.Fields.ACCOUNT_NAME,bic:s.Fields.BIC,bankName:s.Fields.BANK_NAME,iban:s.Fields.IBAN},"3DS-GBP":{accountName:s.Fields.ACCOUNT_NAME,bic:s.Fields.BIC,bankName:s.Fields.BANK_NAME,iban:s.Fields.IBAN},"3DS-USD":{accountName:s.Fields.ACCOUNT_NAME,swift:s.Fields.BIC,bankName:s.Fields.BANK_NAME,accountNumber:s.Fields.ACCOUNT_NUMBER,routingNumber:s.Fields.ROUTING_NUMBER},"3DS-AUD":{accountName:s.Fields.ACCOUNT_NAME,swift:s.Fields.BIC,bankName:s.Fields.BANK_NAME,accountNumber:s.Fields.ACCOUNT_NUMBER,bsb:s.Fields.BSB_NUMBER},"3DS-JPY":{accountName:s.Fields.ACCOUNT_NAME,bankName:s.Fields.BANK_NAME,swift:s.Fields.BIC,accountNumber:s.Fields.ACCOUNT_NUMBER}};return e.extend({tagName:"dl",className:"mpf-virtual-iban",setup(t){this.virtualIban=t.virtualIban,this.keyValueList=this._createKeyValueList()},render(){return this.container.setContent(this.keyValueList),this},_createKeyValueList(){const t=o[this.virtualIban.getExternalReference()]||[];return Object.keys(t).map((e=>this._createKeyValueEntry(i.get(e),this.virtualIban.get(t[e]))))},_createKeyValueEntry:(e,s)=>t.createElement("div",{class:"mpf-entry",html:[{tag:"dt",class:"mpf-key",text:e},{tag:"dd",class:"mpf-value",text:s}]}),destroy(){this.virtualIban=null,this._parent()}})})),define("DS/MPFSubscriptionsComponent/roleList/RoleCardFooter",["UWA/Class/View","DS/UIKIT/Input/Button","DS/MPFServices/ObjectService","DS/MPFProductModel/ProductModel","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],(function(t,e,s,i,o){"use strict";const n=Object.freeze({MANAGE:"manage",BUY_MORE:"buyMore"}),r=t.extend({className:"mpf-role-card-footer-content",setup:function(t={}){s.requiredOfPrototype(t.product,i,"options.product must be a ProductModel"),this.product=t.product,this.manageButton=this._createManageButton(),this.buyMoreButton=this._createBuyMoreButton()},render:function(){const t=this.product.isMarketplaceOffer(),e=this.product.isEdu(),s=this.product.isBuyable(),i=!t&&!e&&s;return this.container.setContent([this.product.isRenewable()&&this.manageButton,i&&this.buyMoreButton]),this},destroy(){this.product=null,this._parent(),this.container=null},_createManageButton(){const t=o.get("manage")+` (${this.product.getQuantity()})`;return new e({value:t,icon:"fonticon-cog",attributes:{title:t},events:{onClick:this.dispatchEvent.bind(this,n.MANAGE)}})},_createBuyMoreButton:function(){const t=o.get("buyMoreSubs");return new e({className:"primary",value:t,icon:"shopping-cart",attributes:{title:t},events:{onClick:this.dispatchEvent.bind(this,n.BUY_MORE)}})}});return r.Events=n,r})),define("DS/MPFSubscriptionsComponent/quoteList/StatusSelectorTileElement",["UWA/Core","UWA/Class/View"],((t,e)=>{"use strict";const s=Object.freeze({SELECTED:"selected"}),i=e.extend({className:"mpf-status-selector-tile-element",domEvents:{click:"onClick"},setup(t){this.title=t.title,this.count=t.count||0,this.setIsSelected(t.isSelected),this.titleElement=this._createTitleElement(),this.countElement=this._createCountElement(),this.container.addClassName(t.cssClass)},render(){return this.container.setContent([this.titleElement,this.countElement]),this},setIsSelected(t){this.isSelected=!0===t,this.isSelected?this.container.addClassName("mpf-selected"):this.container.removeClassName("mpf-selected")},onClick(){this.dispatchEvent(s.SELECTED),this.setIsSelected(!0)},updateCount(t){this.countElement.setText(t)},_createTitleElement(){return t.createElement("p",{class:"mpf-title",text:this.title})},_createCountElement:function(){return t.createElement("p",{class:"mpf-count",text:"("+this.count+")"})}});return i.Events=Object.freeze(s),i})),define("DS/MPFSubscriptionsComponent/PaymentResultPage",["UWA/Class/View","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/UIKIT/Alert","DS/MPFServices/MarketplaceServices","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartFactory","DS/MPFClickAndBuyComponent/checkout/ThankYouForPurchasePanel","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent"],(function(t,e,s,i,o,n,r,a,c,l,h){"use strict";const d=Object.freeze({GO_TO_SUBSCRIPTIONS_TAB:"goToSubscriptionsTab",GO_TO_MY_ORDERS:"goToMyOrders"}),p=Object.freeze({LOADING:"loading",LOADED:"loaded"}),u=t.extend({className:"mpf-payment-result-page",setup({me:t,cartFactory:e,service:s}={}){this.me=t,this.cartFactory=e,this.service=s,this.state=p.LOADING,this.alert=this._createAlert()},setCartId(t){this.cartId=t},async load(){try{s.mask(this.container);const t=new URL(window.parent.location.href).searchParams.get("orderId"),e=this.cartFactory.createModel(a.Types.CART,{id:this.cartId||t});await e.fetchPromise({expand:[r.Expands.CART_ITEMS]});const i=c.getOrderStatus(e);if(i===c.OrderStatus.CANCELLED||i===c.OrderStatus.FAILURE)try{await e.savePromise({[r.Fields.STATE]:e.isRenewal()?r.States.SUBMITTED:r.States.DRAFT},{patch:!0})}catch(t){console.error(t),console.error("Cart state reset failure.")}this.purchaseEndPanel&&this.purchaseEndPanel.destroy(),this.purchaseEndPanel=this._createPurchaseEndPanel(e),this.footer=this._createFooter(),this.state=p.LOADED,s.unmask(this.container),this.render()}catch(t){console.error(t),console.error("Unable to load cart"),this.alert.add({className:"error",message:l.get("unabletoLoadOrder")})}},render(){return this.state===p.LOADED?this.container.setContent([this.alert,this.purchaseEndPanel.render({I18n:h}),this.footer]):(this.container.setContent([this.alert]),this.load()),this},destroy(){this._parent(),this.container=null},_createPurchaseEndPanel(t){return new c({cart:t,me:this.me,service:o.SUBSCRIPTIONS})},_createFooter(){return{tag:"div",class:"mpf-subs-footer",html:[new e({value:l.get("back"),events:{onClick:()=>{const t=this.purchaseEndPanel.getOrderStatus()===c.OrderStatus.SUCCESS?d.GO_TO_MY_ORDERS:d.GO_TO_SUBSCRIPTIONS_TAB;this._clearUrl(),this.dispatchEvent(t)}}})]}},_clearUrl(){const t=new URL(window.parent.location.href);t.searchParams.delete("orderId"),t.searchParams.delete("mpfPage"),t.searchParams.delete("orderStatus"),window.parent.history.pushState(null,null,t.toString())},_createAlert:()=>new i({visible:!1,autoHide:!0,hideDelay:5e3})});return u.Events=d,u.States=p,u})),define("DS/MPFSubscriptionsComponent/quoteList/DownloadQuoteTile",["UWA/Core","UWA/Class/View","DS/UIKIT/Mask","DS/UIKIT/Spinner","DS/UIKIT/DropdownMenu","DS/UIKIT/Modal","DS/UIKIT/Input/Button","DS/UIKIT/Input/Select","DS/UIKIT/Alert","DS/MPFServices/ObjectService","DS/MPFAddressModel/AddressModel","DS/MPFCompanyModel/CompanyModel","DS/MPFCartModel/CartModel","DS/MPFCartQuoteModel/CartQuoteFactory","DS/MPFInvoiceModel/InvoiceFactory","DS/MPFCompanyModel/CompanyFactory","DS/MPFFiniteStateMachine/FiniteStateMachine","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],((t,e,s,i,o,n,r,a,c,l,h,d,p,u,m,S,C,y)=>{"use strict";const f=Object.freeze({ACTIVE:"active",LOADING:"loading"}),M=Object.freeze({CANCELLED:"CANCELLED",PENDING_CONFIRMATION:"WAITING_PAYMENT",PROCESSING:"PROCESSING",DELIVERED:"DELIVERED"});return e.extend({className:"mpf-quote-download-tile",setup(t={}){this._parent(t),this._checkPrototypes(t),this.cart=t.cart,this.cartQuoteFactory=t.cartQuoteFactory,this.companyFactory=t.companyFactory,this.invoiceFactory=t.invoiceFactory,this.quote=this.cartQuoteFactory.createModel(u.Types.CART_QUOTE),this.quote.setParentResourceId(this.cart.id),this.invoice=this.invoiceFactory.createModel(m.Types.INVOICE),this.stateMachine=this._createStateMachine(),this.downloadLink=this._createDownloadLink(),this.spinner=new i},render(){return this.stateMachine.getState()===f.LOADING?(this.container.setContent(this.spinner),this.spinner.show()):this.container.setContent(this.downloadLink),this},_createDownloadLink(){const e=this.cart.getGlobalState();let s=t.createElement("div",{class:"fonticon fonticon-download"});if(e===M.PENDING_CONFIRMATION||e===M.PROCESSING||e===M.CANCELLED||e===M.DELIVERED&&!t.is(this.cart.getInvoiceId())){const t=this._handleFetchAddressesAndDownloadQuote.bind(this);s.addEvent("click",t)}else this.cart.getActionType()===p.ActionTypes.CANCEL&&e===M.DELIVERED&&t.is(this.cart.getInvoiceId())?s.addEvent("click",this._downloadInvoice.bind(this)):e===M.DELIVERED&&t.is(this.cart.getInvoiceId())?this._createDownloadMenu(s):s="";return s},_handleFetchAddressesAndDownloadQuote(){if(this.cart.getCompanyID()){const t=this.companyFactory.createModel(S.Types.COMPANY);return t.id=this.cart.getCompanyID(),t.fetchPromise({expand:[d.Expands.ADDRESSES]}).then(this._handleDownloadQuote.bind(this))}return this._handleDownloadQuote()},_handleDownloadQuote(e){let s;const i=t.is(e)?e.addresses:[],o=i.filter((t=>t.isBillTo()));return""!==this.cart.get("billTo")||t.is(this.cart.get(p.Fields.BILL_TO))&&""!==this.cart.get(p.Fields.BILL_TO)||1!==o.length?this.cart.getState()===M.PROCESSING||this.cart.getState()===M.DELIVERED||this.cart.isRenewal()?this._downloadQuote():(s=new n({header:y.get("downloadQuote"),events:{onHide:function(){s.destroy()}}}),s.setBody(this._createModalBody(s,i)),s.setFooter(this._createModalFooter(s)),s.inject(document.body),void s.show()):this._patchBillingAddressOnCart(o[0].id).then(this._downloadQuote.bind(this))},_patchBillingAddressOnCart(t){return this.stateMachine.changeState(f.LOADING),this.render(),this.cart.dataProxy=this.cart.collection.modelDataProxy,this.cart.savePromise({BillTo:t},{patch:!0}).finally((()=>{this.stateMachine.changeState(f.ACTIVE),this.render()}))},_downloadQuote(e){return this.stateMachine.changeState(f.LOADING),this.render(),t.is(e)&&s.mask(e.getBody()),this.quote.fetchPromise().then((()=>{window.open(this.quote.getUrl()),t.is(e)&&e.hide()})).finally((()=>{this.stateMachine.changeState(f.ACTIVE),this.render()}))},_downloadInvoice(){this.invoice.id=this.cart.getInvoiceId(),window.open(this.invoice.dataProxy.urlGet(this.invoice))},_onChangeBillingAddress(t,e){""!==e&&(s.mask(t.getBody()),this._patchBillingAddressOnCart(e).catch((()=>{new c({visible:!0,messageClassName:"error",messages:y.get("errorOccured")}).inject(t.getBody(),"top")})).finally((()=>{s.unmask(t.getBody())})))},_getAddressOptions(t){return t.filter((t=>t.isBillTo())).map((t=>({value:t.id,label:this._getAddressLabel(t)})))},_getAddressLabel:t=>[h.Fields.LINE1,h.Fields.LINE2,h.Fields.LINE3,h.Fields.LINE4,h.Fields.CITY,h.Fields.COUNTY,h.Fields.STATE,h.Fields.POSTAL_CODE,h.Fields.COUNTRY].map((e=>t.get(e))).filter((t=>t&&t.length>0)).join(", "),_createModalBody(e,s){const i=this;return[t.createElement("div",{text:y.get("selectBillingAddress")}),new a({placeholder:y.get("selectBillingAddress"),options:this._getAddressOptions(s),events:{onChange:()=>{i._onChangeBillingAddress(e,this.getValue()[0])}}})]},_createModalFooter(t){return[new r({className:"primary",value:y.get("downloadQuote"),events:{onClick:this._downloadQuote.bind(this,t)}}),new r({value:y.get("cancel"),events:{onClick:()=>{t.hide()}}})]},_createDownloadMenu(t){return new o({target:t,items:[{text:y.get("downloadQuote"),handler:this._handleFetchAddressesAndDownloadQuote.bind(this)},{text:y.get("downloadInvoice"),handler:this._downloadInvoice.bind(this)}]})},_createStateMachine:()=>new C({state:f.ACTIVE,states:[f.ACTIVE,f.LOADING],transitions:[{from:f.ACTIVE,to:f.LOADING},{from:f.LOADING,to:f.ACTIVE}]}),_checkPrototypes(t){l.requiredOfPrototype(t.invoiceFactory,m,"options.invoiceFactory must be an InvoiceFactory"),l.requiredOfPrototype(t.cartQuoteFactory,u,"options.cartQuoteFactory must be a CartQuoteFactory"),l.requiredOfPrototype(t.cart,p,"options.cart must be a CartModel"),l.requiredOfPrototype(t.companyFactory,S,"options.companyFactory must be a CompanyFactory")}})})),define("DS/MPFSubscriptionsComponent/roleList/ActiveSubscriptionLine",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Button","DS/MPFServices/ObjectService","DS/MPFSubscriptionModel/SubscriptionModel","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent"],((t,e,s,i,o,n)=>{"use strict";const r=Object.freeze({STOP_SUBSCRIPTION:"stopSubscription"}),a=e.extend({className:"mpf-active-subscription-line",setup(t={}){i.requiredOfPrototype(t.subscription,o,"options.subscription must be a SubscriptionModel"),this.subscription=t.subscription,this.stopButton=this._createStopButton()},render(){return this.container.setContent([{tag:"span",class:"mpf-end-date",text:this.subscription.has(o.Fields.END_DATE)?this.subscription.getEndDate():""},{tag:"span",class:"mpf-number-subscriptions",text:n.get("nActive",{number:this.subscription.getActiveQuantity()})},this.stopButton]),this},destroy(){this.stopButton=null,this.cancelButton=null,this.subscription=null,this._parent(),this.container=null},_createStopButton(){const t=n.get("stopRenewal");return new s({className:"primary",value:t,attributes:{title:t},disabled:0===this.subscription.getActiveQuantity(),events:{onClick:this.dispatchEvent.bind(this,r.STOP_SUBSCRIPTION,this.subscription)}})}});return a.Events=r,a})),define("DS/MPFSubscriptionsComponent/roleList/StopSubscriptionsComponent",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Button","DS/UIKIT/Input/Number","DS/UIKIT/Mask","DS/UIKIT/Alert","DS/MPFServices/ObjectService","DS/MPFSubscriptionModel/SubscriptionModel","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],((t,e,s,i,o,n,r,a,c)=>{"use strict";const l=Object.freeze({CANCEL:"cancel",SUBS_STOPPED:"subsStopped"}),h=e.extend({className:"mpf-stop-subscriptions",setup(t={}){this._parent(t),this._checkPrototypes(t),this.subscription=t.subscription,this.message=this._createMessageContainer(),this.quantityInput=this._createQuantityInput(),this.stopButton=this._createStopButton(),this.cancelButton=this._createCancelButton()},render(){return this.container.setContent([{tag:"div",class:"mpf-subscrpition-info",html:[{tag:"span",class:"mpf-end-date",text:this.subscription.getEndDate()},{tag:"span",class:"mpf-number-subscriptions",text:c.get("nActive",{number:this.subscription.getActiveQuantity()})}]},this.message,this.quantityInput,{tag:"div",class:"mpf-stop-subscriptions-buttons",html:[this.stopButton,this.cancelButton]}]),this},_stopSubscriptions(){const t=parseInt(this.quantityInput.getValue());return o.mask(this.container),this.subscription.savePromise({[a.Fields.ONLINE_INSTANCE]:this.subscription.onlineInstanceId,[a.Fields.QUANTITY]:t}).then((()=>{o.unmask(this.container),this.dispatchEvent(l.SUBS_STOPPED,this.subscription)})).catch((t=>{o.unmask(this.container),t.response.errorCode===a.ErrorCodes.STOP_AFTER_DEADLINE&&new n({className:"error",messageClassName:"error",messages:c.get("errorStopAfterDeadline"),closable:!0,visible:!0,autoHide:!1}).inject(this.container,"top"),console.error(t)}))},_createMessageContainer:()=>t.createElement("div",{class:"mpf-stop-subscriptions-message",text:c.get("stopSubsMessage")}),_createQuantityInput(){return new i({min:1,max:this.subscription.getActiveQuantity(),disabled:!1,step:1,value:1,decimalPrecision:1})},_createStopButton(){return new s({className:"primary",value:c.get("stop"),events:{onClick:this._stopSubscriptions.bind(this)}})},_createCancelButton(){return new s({value:c.get("cancel"),events:{onClick:()=>{this.dispatchEvent(l.CANCEL)}}})},_checkPrototypes(t){r.requiredOfPrototype(t.subscription,a,"options.subscription must be a SubscriptionModel")}});return h.Events=l,h})),define("DS/MPFSubscriptionsComponent/IfweLoopEngagementTenantPage",["UWA/Core","UWA/Class/View","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],((t,e,s)=>{"use strict";return e.extend({className:"mpf-ifweloop-engagement-tenant-page",setup(t){this.heroImage=this._createHeroImage(),this.tilte=this._createTitle(),this.message=this._createMessage()},render(){return this.container.setContent([this.heroImage,this.tilte,this.message]),this},destroy(){this._parent()},_createHeroImage:()=>t.createElement("div",{class:"mpf-hero-image",html:[{tag:"i",class:"fonticon fonticon-infinity"}]}),_createTitle:()=>t.createElement("h2",{class:"mpf-title",text:s.get("ifweLoopEngagementTenantTitle")}),_createMessage:()=>t.createElement("p",{class:"mpf-message",text:s.get("ifweLoopEngagementTenantMessage")})})})),define("DS/MPFSubscriptionsComponent/quoteList/QuoteListEvents",[],(()=>{"use strict";return Object.freeze({FILTER_BY_STATE:"filterByState",FILTER_BY_DATE:"filterByDate",SORT:"sort",CLEAR_DATE_FILTER:"clearFilter"})})),define("DS/MPFSubscriptionsComponent/quoteList/SentQuoteTile",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartModelHelper","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],((t,e,s,i,o,n)=>{"use strict";return e.extend({className:"mpf-sent-quote-tile",setup(t={}){this._parent(t),s.requiredOfPrototype(t.cart,i,"options.cart must be a CartModel"),this.cart=t.cart},render(){const e=t.createElement("div",{class:"mpf-sent-time",text:n.get("timeAgo",{time:o.getElapsedTime(this.cart.getCreated())})}),s=n.get("sentAgo",{timeAgo:e.outerHTML});return this.container.setContent(s),this}})})),define("DS/MPFSubscriptionsComponent/roleList/RoleCard",["UWA/Core","UWA/Class/View","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/MPFAmdLazyLoader/AmdLazyLoader","DS/MPFServices/ObjectService","DS/MPFProductModel/ProductModel","DS/MPFPortfolioModel/PortfolioModel","DS/MPFPortfolioModel/compass/CompassPortfolioCollection"],(function(t,e,s,i,o,n,r,a,c){"use strict";return e.extend({className:"mpf-role-card",setup({product:t,portfolio:e,compassPortfolios:s,footer:i}={}){if(t&&n.requiredOfPrototype(t,r,"options.product must be a ProductModel"),e&&n.requiredOfPrototype(e,a,"options.portfolio must be a PortfolioModel"),!t&&!e)throw new Error("Component requires a ProductModel or PortfolioModel instance");n.requiredOfPrototype(s,c,"options.compassPortfolios must be a CompassPortfolioCollection"),n.requiredOfType(i,"object","options.footer must be an object"),this.product=t,this.portfolio=e,this.compassPortfolios=s;const o=(this.product&&this.product.get(r.Fields.NAME)||this.portfolio&&this.portfolio.getProductTrigram()).split("-")[0];this.portfolioRoleInfo=this.compassPortfolios.getWithTrigram(o),this.footer=i},render(){const t=this._getTitle();return this.container.setContent([{tag:"div",class:"mpf-card-top",html:[{tag:"div",class:"mpf-image-container",html:[{tag:"img",src:this._getImageSrc(),width:"250px",height:"120px",loading:"lazy",alt:this.portfolioRoleInfo&&this.portfolioRoleInfo.getTitle()||"",events:{error:t=>{t.target.style.display="none"}}}]},{tag:"div",class:"mpf-role-card-content",html:[{tag:"div",class:"mpf-role-title",attributes:{title:t},html:[{tag:"span",class:"fonticon fonticon-info",events:{click:()=>{this._loadModal().then((()=>this._showModal()))}}},{tag:"span",text:t}]},this._getRoleDescriptionContainer()]}]},{tag:"div",class:"mpf-role-card-footer",html:this.footer.render()}]),this},setFooter(t){this.footer=t},destroy(){this.modal&&this.modal.destroy(),this.modal=null,this.footer=null,this.product=null,this.portfolio=null,this.compassPortfolios=null,this.portfolioRoleInfo=null,this._parent(),this.container=null},_getTitle(){return this.portfolioRoleInfo&&this.portfolioRoleInfo.getTitle()||this.product&&this.product.getDisplayName()||this.portfolio&&this.portfolio.getProductDisplayName()},_showModal(){this.container.addContent(this.modal),this.modal.render().show()},async _loadModal(){s.mask(this.container);const t=o.getInstance(),[e]=await t.get(["DS/MPFSubscriptionsComponent/roleList/MarketingModal"]);this.modal=new e({offer:this.portfolio,product:this.product,compassPortfolios:this.compassPortfolios,portfolioRoleInfo:this.portfolioRoleInfo}),s.unmask(this.container)},_getImageSrc(){const t=this.portfolioRoleInfo&&this.portfolioRoleInfo.getDescriptionMedias();let e;return t&&(e=t.filter((t=>"png"===t.split(".").pop())).shift()),e||""},_getRoleDescriptionContainer(){let e="";this.product&&this.product.isMarketplaceOffer()?e=this.product.getDescription():this.portfolioRoleInfo&&this.portfolioRoleInfo.getTagLine()&&(e=this.portfolioRoleInfo.getTagLine());const s=t.createElement("div",{class:"mpf-role-description-content",text:e}),o=t.createElement("div",{class:"mpf-role-description",html:s});try{new i({element:s}).inject(o)}catch(t){console.warn(t)}return o}})})),define("DS/MPFSubscriptionsComponent/CartHelper",["UWA/Promise","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartItemModel","DS/MPFCartModel/CartPatchArray","DS/MPFCartModel/CartPatchOperation","DS/MPFUtils/MPFUtils"],(function(t,e,s,i,o,n){"use strict";const r={createQuote:function(t,s,i,o){return t.unset("id"),t.set(e.Fields.ONLINE_INSTANCE,""),t.set(e.Fields.CURRENCY,s),t.set("legalEntityId",o),t.set(e.Fields.STATE,"Draft"),t.set("type",e.Types.SOFTWARE_REQUEST),t.set("licensorId",i),t.set("isSelfOrder",!0),t.savePromise()},addItemsToQuote:function(t,n,r,a){var c,l,h={};return h[s.Fields.SKU_ID]=n.getSkuId(),h[s.Fields.LICENSING]=n.getLicensingScheme(),h[s.Fields.LICENSING_SCHEME]=n.getRevType(),h[s.Fields.PRODUCT_DISPLAY_NAME]=n.getProductName(),h[s.Fields.PRODUCT_TRIGRAM]=n.getProductTrigram(),h[s.Fields.PRODUCT_NUMBER]=n.getProductNumber(),h[s.Fields.ACTION]=t.getActionType()||e.ActionTypes.START,h[s.Fields.UNIT_NET_AMOUNT]=n.getListedPrice(),h[s.Fields.TYPE]=t.get(e.Fields.TYPE)||e.Types.SOFTWARE_REQUEST,h[s.Fields.QUANTITY]=a,h[s.Fields.ONLINE_INSTANCE]=n.onlineInstanceId,c=new i,l=new o(o.Operations.add,"/cart-items",h),c.add(l),t.megaPatch(c)},addSubscriptionsItemsToQuote:function(t,n,r,a){var c,l,h={};return h[s.Fields.ONLINE_INSTANCE]=n.onlineInstanceId,h[s.Fields.SKU_ID]=r.getOfferId(),h[s.Fields.LICENSING]=n.getLicensingScheme(),h[s.Fields.LICENSING_SCHEME]=r.getLicensingScheme(),h[s.Fields.PRODUCT_DISPLAY_NAME]=n.getDisplayName(),h[s.Fields.PRODUCT_TRIGRAM]=n.getName(),h[s.Fields.PRODUCT_NUMBER]=n.getProductNumber(),h[s.Fields.ACTION]=t.getActionType()||e.ActionTypes.START,h[s.Fields.UNIT_NET_AMOUNT]=r.getPrice().toString(),h[s.Fields.TYPE]=t.get(e.Fields.TYPE)||e.Types.SOFTWARE_REQUEST,h[s.Fields.QUANTITY]=a,c=new i,l=new o(o.Operations.add,"/cart-items",h),c.add(l),t.megaPatch(c)},deleteItemsFromQuote:function(e,s){var n,r,a;return r=e.getItems().filter((function(t){return t.getSkuId()===s})),n=new i,a=r.map((function(t){return new o(o.Operations.REMOVE,"/cart-items/"+t.id)})),n.addAll(a),a.length>0?e.megaPatch(n):t.resolve()},modifyQuantitiesItemsOnQuote:function(r){var a,c;const l=r.getItems();if(a=new i,c=l.map((function(t){return new o(o.Operations.MODIFY,"/cart-items/"+t.get("id"),{Quantity:parseInt(t.get(s.Fields.QUANTITY))})})),a.addAll(c),r.hasPendingChanges(r.pick(e.Fields.COUPON_SOFTWARE))){const t={[e.Fields.COUPON_SOFTWARE]:!!r.getCouponSoftware()&&r.getCouponSoftware().getCommercialName()||"",[s.Fields.TEMP_UUID]:n.generateUUID()};a.addOperation(o.Operations.MODIFY,"/",t)}return c.length>0?r.megaPatch(a):t.resolve()}};return r})),define("DS/MPFSubscriptionsComponent/quoteList/MarketingModal",["UWA/Class/View","UWA/Core","DS/UIKIT/Modal","DS/UIKIT/Mask","DS/MPFServices/ObjectService","DS/MPFCartModel/CartItemModel","DS/MPFPortfolioModel/PortfolioHelper","DS/MPFClickAndBuyComponent/MarketingPortfolioPage"],((t,e,s,i,o,n,r,a)=>{"use strict";return t.extend({className:"mpf-marketing-modal mpf-click-and-buy",setup(t={}){o.requiredOfPrototype(t.item,n,"options.item must be a CartItemModel"),this.item=t.item,this.compassPortfolios=t.compassPortfolios,this.modal=this._createModal()},render(){return this.container.setContent(this.modal),this._setModalBody(),this},show(){this.modal.show()},destroy(){this.modal.destroy(),this.item=null,this.compassPortfolios=null,this._parent(),this.container=null},_createModal(){return new s({className:"mpf-marketing-offer",header:{tag:"h4",text:this.item.getProductDisplayName()},events:{onHide:this.destroy.bind(this)},visible:!1})},_setModalBody(){i.mask(this.modal.getBody());const t=this.item.getProductTrigram(),e=this.compassPortfolios.getWithTrigram(t.split("-")[0]),s=new a({portfolioInfo:e});this.modal.setBody(s.render())}})})),define("DS/MPFSubscriptionsComponent/paymentMethodsList/PaymentCardForm",["UWA/Promise","UWA/Core","UWA/Class/View","DS/UIKIT/Mask","DS/UIKIT/Alert","DS/UIKIT/Input/Text","DS/UIKIT/Input/Select","DS/UIKIT/Input/Button","DS/MPFServices/ObjectService","DS/MPFPaymentMethodModel/PaymentMethodModel","DS/MPFPaymentCardTokenModel/PaymentCardTokenModel","DS/MPFPspModel/PspModel","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent"],((t,e,s,i,o,n,r,a,c,l,h,d,p)=>{"use strict";const u=Object.freeze({PAYMENT_INFO_UPDATED:"paymentInfoUpdated",CANCEL:"cancel"}),m=s.extend({className:"mpf-payment-method-form",setup(t={}){this._checkPrototypes(t),this.title=t.title,this.psp=t.psp,this.card=t.card,this.stripe=Stripe(this.psp.getPublicKey()),this.elements=this.stripe.elements(),this.onlineInstanceId=t.onlineInstanceId,this.formTitle=this._createFormTitle(),this.cardNameHolderInput=this._createCardNameHolderInput(),this.cardNumberInput=this._createCardNumberInput(),this.cardExpiryDateInput=this._createCardExpiryDateInput(),this.expiryMonthInput=this._createExpiryMonthInput(),this.expiryYearInput=this._createExpiryYearInput(),this.cardVerificationCodeInput=this._createCardVerificationCodeInput(),this.saveButton=this._createSaveButton(),this.cancelButton=this._createCancelButton(),this.formCommands=this._createFormCommands()},render(){const t=[this._createCardNameHolderContainer(),this._createCardNumberInputContainer()];this.card.isNew()?(t.push(this._createCardExpiryDateInputContainer()),t.push(this._createCardCvcInputContainer())):(t.push(this._createExpiryMonthInputContainer()),t.push(this._createExpiryYearInputContainer()));const e=[this.formTitle,{tag:"div",class:"mpf-input-container",html:t},this.formCommands];return this.container.setContent(e),this},_onSave(){return this.card.isNew()?this.psp.isScaEnabled()?this._createStripeTokenCardWithSca():this._createStripeTokenCard():this._updateCardInfo()},_onCancel(){this.hide(),this.dispatchEvent(u.CANCEL)},_updateCardInfo(){const t={[h.Fields.CARD_NAME]:this.cardNameHolderInput.getValue(),[h.Fields.CARD_EXP_MONTH]:this.expiryMonthInput.getValue()[0],[h.Fields.CARD_EXP_YEAR]:this.expiryYearInput.getValue()[0]};return i.mask(this.container),this.card.setParentResourceId(this.onlineInstanceId),this.card.savePromise(t,{patch:!0}).then(this.dispatchEvent.bind(this,u.PAYMENT_INFO_UPDATED)).catch(this._displayErrorMessage.bind(this,p.get("cardNotUpdated"))).finally(i.unmask.bind(i,this.container))},_createFormTitle(){return this.title?e.createElement("h1",{class:"mpf-title",text:this.title}):null},_createStripeTokenCardWithSca(){const e={[l.Fields.IS_DEFAULT_PAYMENT_METHOD]:!0};return this.card.set(e),this.card.setParentResourceId(this.onlineInstanceId),i.mask(this.container),this.card.savePromise().then((()=>{const t={name:this.cardNameHolderInput.getValue()};return this.stripe.confirmCardSetup(this.card.getClientSecret(),{payment_method:{card:this.cardNumberInput,billing_details:t}})})).then((e=>e.error?(this._displayErrorMessage(e.error),t.resolve(e.error)):(this.dispatchEvent(u.PAYMENT_INFO_UPDATED),t.resolve()))).catch((t=>{console.error(t),this._displayErrorMessage(p.get("cardNotSaved"))})).finally(i.unmask.bind(i,this.container))},_createStripeTokenCard(){const t={name:this.cardNameHolderInput.getValue()};return i.mask(this.container),this.stripe.createToken(this.cardNumberInput,t).then((t=>{if(t.token){const e={[l.Fields.IS_DEFAULT_PAYMENT_METHOD]:!0,[l.Fields.PAYMENT_TOKEN]:t.token.id};return this.card.set(e),this.card.setParentResourceId(this.onlineInstanceId),this.card.savePromise()}this._displayErrorMessage(t.error)})).then(this.dispatchEvent.bind(this,u.PAYMENT_INFO_UPDATED)).catch(this._displayErrorMessage.bind(this,p.get("cardNotSaved"))).finally(i.unmask.bind(i,this.container))},_displayErrorMessage(t){new o({className:"error",messageClassName:"error",messages:t,closable:!0,visible:!0,closeOnClick:!0}).inject(this.container,"top")},_validateExipiryDateInput(t){const e=""===this.expiryYearInput.getValue()[0],s=""===this.expiryMonthInput.getValue()[0],i=this.container.getElement(".mpf-expiry-year"),o=this.container.getElement(".mpf-expiry-month");return e&&"year"===t?(i.addClassName("invalid"),i.getElement("#mpf-stripe-card-expiration-errors").setText(p.get("invalidExpiryYear"))):(i.removeClassName("invalid"),i.getElement("#mpf-stripe-card-expiration-errors").setText("")),s&&"month"===t?(o.addClassName("invalid"),o.getElement("#mpf-stripe-card-expiration-errors").setText(p.get("invalidExpiryMonth"))):(o.removeClassName("invalid"),o.getElement("#mpf-stripe-card-expiration-errors").setText("")),e||s?this.saveButton.disable():this.saveButton.enable()},_createExpiryYearInput(){const t=new Date(Date.now()),e=parseInt(t.getFullYear());return new r({placeholder:"YYYY",events:{onChange:this._validateExipiryDateInput.bind(this,"year")},options:[{value:e},{value:e+1},{value:e+2},{value:e+3},{value:e+4},{value:e+5},{value:e+6},{value:e+7}]})},_createExpiryYearInputContainer(){const t=e.createElement("div",{class:"mpf-expiry-year-input",html:[e.createElement("label",{text:p.get("expiryYear")}),this.expiryYearInput]}),s=e.createElement("div",{id:"mpf-stripe-card-expiration-errors"});return e.createElement("div",{class:"mpf-expiry-year",html:[t,s]})},_createExpiryMonthInput(){return new r({placeholder:"MM",events:{onChange:this._validateExipiryDateInput.bind(this,"month")},options:[{value:"01"},{value:"02"},{value:"03"},{value:"04"},{value:"05"},{value:"06"},{value:"07"},{value:"08"},{value:"09"},{value:"10"},{value:"11"},{value:"12"}]})},_createExpiryMonthInputContainer(){const t=e.createElement("div",{class:"mpf-expiry-month-input",html:[e.createElement("label",{text:p.get("expiryMonth")}),this.expiryMonthInput]}),s=e.createElement("div",{id:"mpf-stripe-card-expiration-errors"});return e.createElement("div",{class:"mpf-expiry-month",html:[t,s]})},_validateCardNameHolderInput(){""===this.cardNameHolderInput.getValue().trim()?(this.saveButton.disable(),this.cardNameHolderInput.setClassName("invalid"),this.container.getElement("#mpf-stripe-card-holder-errors").setText(p.get("cardHolderEmpty"))):this.saveButton.enable()},_createCardNameHolderInput(){return new n({placeholder:p.get("cardHolder"),value:this.card.isNew()?"":this.card.getCardName(),events:{onChange:this._validateCardNameHolderInput.bind(this),onKeyDown:()=>{this.cardNameHolderInput.setClassName(""),this.container.getElement("#mpf-stripe-card-holder-errors").setText("")}}})},_createCardNumberInput(){if(this.card.isNew()){const t=this.elements.create("cardNumber",{classes:{base:"StripeCardElement",focus:"StripeCardElement--focus",invalid:"StripeCardElement--invalid"}});return t.addEventListener("change",(t=>{t.error?this.container.getElement("#mpf-stripe-card-number-errors").setContent(t.error.message):this.container.getElement("#mpf-stripe-card-number-errors").setContent("")})),t}return new n({value:"**** - "+this.card.getCardNumber(),disabled:!0})},_createCardExpiryDateInput(){const t=this.elements.create("cardExpiry",{classes:{base:"StripeCardElement",focus:"StripeCardElement--focus",invalid:"StripeCardElement--invalid"}});return t.addEventListener("change",(t=>{t.error?this.container.getElement("#mpf-stripe-card-expiration-errors").setContent(t.error.message):this.container.getElement("#mpf-stripe-card-expiration-errors").setContent("")})),t},_createCardVerificationCodeInput(){const t=this.elements.create("cardCvc",{classes:{base:"StripeCardElement",focus:"StripeCardElement--focus",invalid:"StripeCardElement--invalid"}});return t.addEventListener("change",(t=>{t.error?this.container.getElement("#mpf-stripe-card-cvc-errors").setContent(t.error.message):this.container.getElement("#mpf-stripe-card-cvc-errors").setContent("")})),t},_createSaveButton(){return new a({className:"primary",value:p.get("save"),disabled:!0,events:{onClick:this._onSave.bind(this)}})},_createFormCommands(){return e.createElement("div",{class:"mpf-stripe-payment-commands",html:[this.saveButton,this.cancelButton]})},_createCancelButton(){return new a({className:"default",value:p.get("cancel"),events:{onClick:this._onCancel.bind(this)}})},_createCardNameHolderContainer(){const t=e.createElement("span",{text:p.get("cardHolder")}),s=e.createElement("div",{id:"mpf-stripe-card-holder-errors"});return e.createElement("div",{class:"mpf-stripe-payment-card-holder",html:[e.createElement("label",{html:[t,this.cardNameHolderInput]}),s]})},_createCardCvcInputContainer(){const t=e.createElement("span",{text:"CVC"}),s=e.createElement("div",{id:"mpf-stripe-card-cvc-element"}),i=e.createElement("div",{id:"mpf-stripe-card-cvc-errors"});return this.cardVerificationCodeInput.mount(s),e.createElement("div",{class:"mpf-stripe-card-cvc-element-container",html:[e.createElement("label",{html:[t,s]}),i]})},_createCardExpiryDateInputContainer(){const t=e.createElement("span",{text:p.get("expiryDate")}),s=e.createElement("div",{id:"mpf-stripe-card-expiration-element"}),i=e.createElement("div",{id:"mpf-stripe-card-expiration-errors"});return this.cardExpiryDateInput.mount(s),e.createElement("div",{class:"mpf-stripe-card-expiration-element-container",html:[e.createElement("label",{html:[t,s]}),i]})},_createCardNumberInputContainer(){let t;const s=e.createElement("span",{text:p.get("cardNumber")}),i=e.createElement("div",{id:"mpf-stripe-card-number-errors"});return this.card.isNew()&&(t=e.createElement("div",{id:"mpf-stripe-card-number-element"}),this.cardNumberInput.mount(t)),e.createElement("div",{class:"mpf-stripe-card-number-element-container",html:[e.createElement("label",{html:[s,this.card.isNew()?t:this.cardNumberInput]}),i]})},_checkPrototypes(t){c.requiredOfPrototype(t.psp,d,"options.psp must be a PspModel"),c.requiredAsOneOf(t.card,[l,h],"options.card must be a PaymentMethodModel or a PaymentCardTokenModel")},destroy(){this._parent(),this.container=null}});return m.Events=u,m})),define("DS/MPFSubscriptionsComponent/offerList/OfferCardHeader",["UWA/Core","UWA/Class/View","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],((t,e)=>{"use strict";return e.extend({className:"mpf-offer-card-header",setup(t={}){this._parent(t),this.portfolioRoleInfo=t.portfolioRoleInfo||{}},render(){const e=this.portfolioRoleInfo.descriptionMedias;if(e){const s=t=>"png"===t.split(".").pop(),i=e.filter(s).shift(),o=this.portfolioRoleInfo.title,n=t.createElement("img",{src:t.is(i)?i:"",width:"250px",height:"120px",loading:"lazy",alt:t.is(o)?o:""});n.addEventListener("error",this._onError.bind(this)),this.container.setContent(n)}return this},_onError(t){t.target.style.display="none"},destroy(){this.stopListening(),this._parent(),this.container=null}})})),define("DS/MPFSubscriptionsComponent/offerList/OfferCardBody",["UWA/Core","UWA/Class/View","DS/UIKIT/Scroller","DS/UIKIT/Modal","DS/MPFServices/ObjectService","DS/MPFAmdLazyLoader/AmdLazyLoader","DS/MPFPortfolioModel/PortfolioModel","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],((t,e,s,i,o,n,r,a)=>{"use strict";return e.extend({className:"mpf-offer-card-body",setup(t={}){this._parent(t),o.requiredOfPrototype(t.offer,r,"options.offers must be a PortfolioModel"),this.portfolioRoleInfo=t.portfolioRoleInfo||{},this.offer=t.offer,this.compassPortfolios=t.compassPortfolios,this.title=this._createTitleContainer(),this.description=this._createDescriptionContainer(),this.price=this._createPriceContainer(),this.revType=this._createRevTypeContainer()},render(){const e=t.createElement("div",{class:"mpf-info-container",html:[this.title,this.description]}),s=t.createElement("div",{class:"mpf-price-container",html:[this.price,this.revType]});return this.container.setContent([e,s]),this},_createTitleContainer(){const e=t.createElement("span",{class:"fonticon fonticon-info",events:{click:this._displayMarketingInfo.bind(this)}});return t.createElement("div",{class:"mpf-offer-title",html:[e,this.offer.getProductName()]})},_createDescriptionContainer(){let e="";t.is(this.portfolioRoleInfo.tagLine)&&(e=this.portfolioRoleInfo.tagLine);const i=t.createElement("div",{class:"mpf-offer-description-content",html:e}),o=t.createElement("div",{class:"mpf-offer-description",html:i});try{new s({element:i}).inject(o)}catch(t){console.warn(t)}return o},_createPriceContainer(){const e=this.offer.getLicensingScheme(),s="NAM"===e||"CON"===e||"CAS"===e,i=this.offer.getPrice();let o=parseFloat(i).toLocaleString("fr-FR",{style:"currency",currency:this.offer.getCurrency()});return o=s?o+" / "+a.get("user")+" / "+a.get("month"):o+" / "+a.get("month"),t.createElement("div",{class:"mpf-offer-price",text:o})},_createRevTypeContainer(){let e;const s=this.offer.getRevType();return s===r.RevTypes.YSC?e=a.get("yearly"):s!==r.RevTypes.QRC&&s!==r.RevTypes.QSC||(e=a.get("quarterly")),t.createElement("div",{class:"mpf-offer-rev-type",text:e})},_displayMarketingInfo(){return this._createMarketingModal().then((t=>{t.inject(document.body),t.render().show()}))},_createMarketingModal(){return n.getInstance().get(["DS/MPFSubscriptionsComponent/roleList/MarketingModal"]).then((([t])=>new t({offer:this.offer,compassPortfolios:this.compassPortfolios})))},destroy(){this.stopListening(),this._parent(),this.container=null}})})),define("DS/MPFSubscriptionsComponent/quoteList/QuoteCardHeader",["UWA/Core","UWA/Class/View","DS/MPFView/EmptyView","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartItemModel","DS/MPFCartQuoteModel/CartQuoteFactory","DS/MPFInvoiceModel/InvoiceFactory","DS/MPFCompanyModel/CompanyFactory","DS/MPFSubscriptionsComponent/quoteList/QuoteIdTile","DS/MPFSubscriptionsComponent/quoteList/SentQuoteTile","DS/MPFSubscriptionsComponent/quoteList/StatusQuoteTile","DS/MPFSubscriptionsComponent/quoteList/DownloadQuoteTile","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],((t,e,s,i,o,n,r,a,c,l,h,d,p,u)=>{"use strict";return e.extend({className:"mpf-quote-card-header",setup(t={}){this._parent(t),this._checkPrototypes(t),this.cart=t.cart,this.cartQuoteFactory=t.cartQuoteFactory,this.companyFactory=t.companyFactory,this.invoiceFactory=t.invoiceFactory,this.quoteIdTile=this._createQuoteIdTile(),this.sentQuoteTile=this._createSentQuoteTile(),this.statusQuoteTile=this._createStatusQuoteTile(),this.downloadQuoteTile=this._createDownloadQuoteTile()},render(){const e=t.createElement("div",{class:"mpf-header-left-content",html:[this.quoteIdTile.render(),this.sentQuoteTile.render()]}),s=t.createElement("div",{class:"mpf-header-right-content",html:[this.statusQuoteTile.render(),this.downloadQuoteTile.render()]}),i=t.createElement("div",{class:"mpf-quote-card-header-content",html:[e,s]});return this.container.setContent(i),this},_createDownloadQuoteTile(){return this.cart.getItems().some((t=>t.getLicensingScheme()===n.RevTypes.ELC))?s.getInstance():new p({cart:this.cart,cartQuoteFactory:this.cartQuoteFactory,companyFactory:this.companyFactory,invoiceFactory:this.invoiceFactory})},_createStatusQuoteTile(){return new d({cart:this.cart})},_createSentQuoteTile(){return new h({cart:this.cart})},_createQuoteIdTile(){return new l({cart:this.cart})},_checkPrototypes(t){i.requiredOfPrototype(t.invoiceFactory,a,"options.invoiceFactory must be an InvoiceFactory"),i.requiredOfPrototype(t.cartQuoteFactory,r,"options.cartQuoteFactory must be a CartQuoteFactory"),i.requiredOfPrototype(t.cart,o,"options.cart must be a CartModel"),i.requiredOfPrototype(t.companyFactory,c,"options.companyFactory must be a CompanyFactory")}})})),define("DS/MPFSubscriptionsComponent/roleList/ConfirmRenewalStopModal",["UWA/Core","UWA/Class/View","DS/UIKIT/Modal","DS/UIKIT/Input/Button","DS/MPFServices/ObjectService","DS/MPFSubscriptionsComponent/roleList/ReasonsToStop","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent"],(function(t,e,s,i,o,n,r){"use strict";const a=Object.freeze({STOP_RENEWAL:"stopRenewal",CANCEL:"cancel"}),c=e.extend({className:"mpf-confirm-renewal-stop-modal",setup(){this.modal=this._createModal(),this.stopRenewalButton=this._createStopRenewalButton(),this.cancelButton=this._createCancelButton()},render(){return this.container.setContent(this.modal),this},show({subscriptions:t,subscription:e,product:s,quantity:o,riskStoppingLast3DSwymer:n}){const c=n&&e.getQuantity()===o;return this.modal.setHeader({tag:"h4",text:r.get("stopRenewalPlusName",{name:s.getDisplayName()})}),this.modal.setBody(this._renderWarningText(e,o)),c?this.modal.setFooter([new i({value:r.get("next"),className:"primary",events:{onClick:this._renderReasonsToStop.bind(this,{subscriptions:t,subscription:e,product:s,quantity:o})}}),this.cancelButton]):(this.stopRenewalButton.addEventOnce("onClick",this.dispatchEvent.bind(this,a.STOP_RENEWAL,{subscriptions:t,subscription:e,product:s,quantity:o})),this.modal.setFooter([this.stopRenewalButton,this.cancelButton])),this.modal.show(),this},hide(){return this.modal.hide(),this},destroy(){this.modal.destroy(),this.stopRenewalButton=null,this.cancelButton=null,this._parent(),this.container=null},_createStopRenewalButton:()=>new i({value:r.get("stopRenewal"),className:"primary"}),_createCancelButton(){return new i({value:r.get("cancel"),events:{onClick:()=>{this.hide(),this.dispatchEvent(a.CANCEL)}}})},_renderWarningText:(e,s)=>({tag:"div",html:[{tag:"span",text:r.get("stopRenewalConfMessage",{quantity:s,date:e.getEndDate()})},{tag:"ul",html:[{tag:"li",html:r.get("stopRenewalConfWarning1",{bold3D:t.createElement("b",{text:"3D"}).outerHTML})},{tag:"li",text:r.get("stopRenewalConfWarning2")}]}]}),_renderReasonsToStop({subscriptions:t,subscription:e,product:s,quantity:i}){const o=new n;this.modal.setBody(o.render()),this.stopRenewalButton.removeEvent("onClick"),this.stopRenewalButton.addEvent("onClick",(()=>{o.isValid()&&this.dispatchEvent(a.STOP_RENEWAL,{subscriptions:t,subscription:e,product:s,quantity:i,reasons:o.getReasons()})})),this.modal.setFooter([this.stopRenewalButton,this.cancelButton]),this.render()},_createModal:()=>new s});return c.Events=a,c})),define("DS/MPFSubscriptionsComponent/offerList/OfferCardFooter",["UWA/Class/View","DS/UIKIT/Mask","DS/UIKIT/Input/Button","DS/UIKIT/Input/Number","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFPortfolioModel/PortfolioModel","DS/MPFPortfolioModel/LicensingHelper","DS/MPFSubscriptionsComponent/CartHelper","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],((t,e,s,i,o,n,r,a,c,l)=>{"use strict";const h=Object.freeze({READY_TO_ADD:"readyToAdd",ITEM_ADDED:"itemsAdded"});return t.extend({className:"mpf-offer-card-footer",setup(t={}){this._parent(t),this._checkPrototypes(t),this.legalEntityId=t.legalEntityId,this.offer=t.offer,this.cart=t.cart,this.state=this._getQuantityOfferInCart()>0?h.ITEM_ADDED:h.READY_TO_ADD,this.quantityInput=this._createQuantityInput(),this.addButton=this._createAddButton(),this.listenTo(this.cart,"onChange:"+n.Fields.CART_ITEMS,this._updateInfoDisplayed.bind(this)),this.listenTo(this.cart,"onRequest",this._avoidMultiCartCreation.bind(this))},render(){return this.container.setContent([{tag:"div",class:"mpf-price-container",html:[{tag:"div",class:"mpf-offer-price",text:this._getPriceText()},{tag:"div",class:"mpf-offer-rev-type",text:this._getRevTypeText()}]},{tag:"div",class:"mpf-button-container",html:[this.quantityInput,this.addButton]}]),this},_updateInfoDisplayed(){const t=this._getQuantityOfferInCart();this.state=t>0?h.ITEM_ADDED:h.READY_TO_ADD,this.addButton.enable(),this._renderButton(),this.quantityInput.enable(),this.quantityInput.setValue(t>0?t:1),this.quantityInput.setDisabled(t>0)},_avoidMultiCartCreation(){this.cart.isNew()&&this.addButton.disable()},_renderButton(){const t=this.state===h.READY_TO_ADD?"primary":"error",e=this.state===h.READY_TO_ADD?l.get("add"):l.get("remove"),s=this.state===h.READY_TO_ADD?"plus":"trash";this.addButton.setClassName(t),this.addButton.setValue(e),this.addButton.setIcon(s),this.addButton.elements.input.setAttribute("title",e)},_addToQuote(){return this.cart.isNew()?this._createQuote():(e.mask(this.container),this._addItemsToQuote().finally(e.unmask.bind(e,this.container)))},_deleteFromQuote(){return e.mask(this.container),c.deleteItemsFromQuote(this.cart,this.offer.getSkuId()).finally(e.unmask.bind(e,this.container))},_addItemsToQuote(){return c.addItemsToQuote(this.cart,this.offer,this.contact,parseInt(this.quantityInput.getValue(),10))},_createQuote(){return e.mask(this.container),c.createQuote(this.cart,this.offer.getCurrency(),this.offer.getLicensorId(),this.legalEntityId).then((()=>{this.cart.dataProxy=this.cart.dataProxy.delegate})).then(this._addToQuote.bind(this))},_onButtonClicked(){return this.state===h.READY_TO_ADD?this._addToQuote():this._deleteFromQuote()},_getQuantityOfferInCart(){const t=this.cart.getItems(),e=this.offer.getSkuId();return t.reduce(((t,s)=>(s.getSkuId()===e&&(t+=parseInt(s.getQuantity(),10)),t)),0)},_getPriceText(){const t=this.offer.getLicensingScheme(),e="NAM"===t||"CON"===t||"CAS"===t,s=this.offer.getPrice();let i=parseFloat(s).toLocaleString("fr-FR",{style:"currency",currency:this.offer.getCurrency()});return i=e?i+" / "+l.get("user")+" / "+l.get("month"):i+" / "+l.get("month"),i},_getRevTypeText(){let t;const e=this.offer.getRevType();return e===r.RevTypes.YSC?t=l.get("yearly"):e!==r.RevTypes.QRC&&e!==r.RevTypes.QSC||(t=l.get("quarterly")),t},_createAddButton(){const t=l.get("add");return new s({className:"primary",icon:"plus",value:t,attributes:{title:t},events:{onClick:this._onButtonClicked.bind(this)}})},_createQuantityInput(){return new i({min:a.isCredit(this.offer.getLicensingScheme())?2500:1,max:99999,step:1,decimalPrecision:1})},_checkPrototypes(t){o.requiredOfPrototype(t.offer,r,"options.offers must be a PortfolioModel"),o.requiredOfPrototype(t.cart,n,"options.cart must be a CartModel")},destroy(){this.stopListening(),this.quantityInput=null,this.addButton=null,this.offer=null,this.cart=null,this._parent(),this.container=null}})})),define("DS/MPFSubscriptionsComponent/quoteList/QuoteListCommandFilter",["UWA/Core","UWA/Class/View","DS/UIKIT/DropdownMenu","DS/MPFCartModel/CartFilters","DS/MPFSubscriptionsComponent/quoteList/QuoteListEvents","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent"],((t,e,s,i,o,n)=>{"use strict";const r=Object.freeze({CLEAR:"clearFilter",CREATION_DATE_TODAY:"creationDateToday",CREATION_DATE_LAST_7_DAYS:"creationDateLast7Days",CREATION_DATE_LAST_30_DAYS:"creationDateLast30Days",CREATION_DATE_LAST_6_MONTHS:"creationDateLast6Monthss",MODIFICATION_DATE_TODAY:"modificationDateToday",MODIFICATION_DATE_LAST_7_DAYS:"modificationDateLast7Days",MODIFICATION_DATE_LAST_30_DAYS:"modificationDateLast30Days",MODIFICATION_DATE_LAST_6_MONTHS:"modificationDateLast6Monthss"});return e.extend({className:"mpf-quote-list-command-filter",setup(t){this.filterIcon=this._createFilterIcon(),this.filterMenu=this._createFilterMenu()},render(){return this.container.setContent([this.filterIcon]),this},setActive(t){!0===t?this.filterIcon.addClassName("mpf-active"):this.filterIcon.removeClassName("mpf-active")},_createFilterIcon:()=>t.createElement("div",{class:"fonticon fonticon-filter"}),_createFilterMenu(){return new s({target:this.container,renderTo:this.container,multiSelect:!1,items:[{text:n.get("creationDate"),items:[{text:n.get("today"),name:r.CREATION_DATE_TODAY,selectable:!0},{text:n.get("lastXDays",{number:7}),name:r.CREATION_DATE_LAST_7_DAYS,selectable:!0},{text:n.get("lastXDays",{number:30}),name:r.CREATION_DATE_LAST_30_DAYS,selectable:!0},{text:n.get("lastXMonths",{number:6}),name:r.CREATION_DATE_LAST_6_MONTHS,selectable:!0}]},{text:n.get("modificationDate"),items:[{text:n.get("today"),name:r.MODIFICATION_DATE_TODAY,selectable:!0},{text:n.get("lastXDays",{number:7}),name:r.MODIFICATION_DATE_LAST_7_DAYS,selectable:!0},{text:n.get("lastXDays",{number:30}),name:r.MODIFICATION_DATE_LAST_30_DAYS,selectable:!0},{text:n.get("lastXMonths",{number:6}),name:r.MODIFICATION_DATE_LAST_6_MONTHS,selectable:!0}]},{text:n.get("clearFilter"),name:r.CLEAR,selectable:!0,fonticon:"trash"}],events:{onClick:this._onFilterSelected.bind(this)}})},_onFilterSelected(t,e){switch(this._updateMenuSelection(e),e.name){case r.CREATION_DATE_TODAY:this._dispatchFilterCreationDateDays(0);break;case r.CREATION_DATE_LAST_7_DAYS:this._dispatchFilterCreationDateDays(7);break;case r.CREATION_DATE_LAST_30_DAYS:this._dispatchFilterCreationDateDays(30);break;case r.CREATION_DATE_LAST_6_MONTHS:this._dispatchFilterCreationDateMonths(6);break;case r.MODIFICATION_DATE_TODAY:this._dispatchFilterModificationDateDays(0);break;case r.MODIFICATION_DATE_LAST_7_DAYS:this._dispatchFilterModificationDateDays(7);break;case r.MODIFICATION_DATE_LAST_30_DAYS:this._dispatchFilterModificationDateDays(30);break;case r.MODIFICATION_DATE_LAST_6_MONTHS:this.dispatchEvent(o.FILTER_BY_DATE,{filter:i.FILTER_BY_MODIFICATION_DATE_MONTHS,months:6});break;case r.CLEAR:this.dispatchEvent(o.FILTER_BY_DATE,{filter:i.CLEAR})}},_updateMenuSelection(t){this.filterMenu.getSelectedItems().forEach((e=>{e!==t&&(e.elements.container.removeClassName("selected"),e.selected=!1)}))},_dispatchFilterCreationDateDays(t){this.dispatchEvent(o.FILTER_BY_DATE,{filter:i.FILTER_BY_CREATION_DATE_DAYS,days:t})},_dispatchFilterCreationDateMonths(t){this.dispatchEvent(o.FILTER_BY_DATE,{filter:i.FILTER_BY_CREATION_DATE_MONTHS,months:t})},_dispatchFilterModificationDateDays(t){this.dispatchEvent(o.FILTER_BY_DATE,{filter:i.FILTER_BY_MODIFICATION_DATE_DAYS,days:t})},_dispatchFilterModificationDateMonths(t){this.dispatchEvent(o.FILTER_BY_DATE,{filter:i.FILTER_BY_MODIFICATION_DATE_MONTHS,months:t})}})})),define("DS/MPFSubscriptionsComponent/roleList/BuyMoreFooter",["UWA/Class/View","DS/UIKIT/Mask","DS/UIKIT/Input/Button","DS/UIKIT/Input/Number","DS/MPFServices/ObjectService","DS/MPFProductModel/ProductModel","DS/MPFCartModel/CartModel","DS/MPFPortfolioModel/LicensingHelper","DS/MPFSubscriptionModel/SubscriptionModel","DS/MPFSubscriptionsComponent/CartHelper","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],(function(t,e,s,i,o,n,r,a,c,l,h){"use strict";var d={READY_TO_ADD:"readyToAdd",ITEM_ADDED:"itemsAdded"};return t.extend({className:"mpf-buy-more-footer",setup:function(t){t||(t={}),this._parent(t),this._checkPrototypes(t),this.product=t.product,this.subscription=t.subscription,this.cart=t.cart,this.legalEntityId=t.legalEntityId,this.state=this._getQuantityItemInCart()>0?d.ITEM_ADDED:d.READY_TO_ADD,this.quantityInput=this._createQuantityInput(),this.addButton=this._createAddButton(),this.listenTo(this.cart,"onChange:"+r.Fields.CART_ITEMS,this._updateInfoDisplayed.bind(this)),this.listenTo(this.cart,"onRequest",this._avoidMultiCartCreation.bind(this))},render:function(){return this.container.setContent([this.quantityInput,this.addButton]),this},_updateInfoDisplayed:function(){var t;t=this._getQuantityItemInCart(),this.state=t>0?d.ITEM_ADDED:d.READY_TO_ADD,this.addButton.enable(),this._renderButton(),this.quantityInput.enable(),this.quantityInput.setValue(t>0?t:1),this.quantityInput.setDisabled(t>0)},_avoidMultiCartCreation:function(){this.cart.isNew()&&this.addButton.disable()},_renderButton:function(){var t=this.state===d.READY_TO_ADD?"primary":"error",e=this.state===d.READY_TO_ADD?h.get("add"):h.get("remove"),s=this.state===d.READY_TO_ADD?"plus":"trash";this.addButton.setClassName(t),this.addButton.setValue(e),this.addButton.setIcon(s)},_getQuantityItemInCart:function(){var t=this.cart.getItems(),e=this.subscription.getOfferId();return t.reduce((function(t,s){return s.getSkuId()===e&&(t+=parseInt(s.getQuantity(),10)),t}),0)},_onButtonClicked:function(){return this.state===d.READY_TO_ADD?this._addToQuote():this._deleteFromQuote()},_addToQuote:function(){return this.cart.isNew()?this._createQuote():(e.mask(this.container),this._addItemsToQuote().finally(e.unmask.bind(e,this.container)))},_deleteFromQuote:function(){return e.mask(this.container),l.deleteItemsFromQuote(this.cart,this.subscription.getOfferId()).finally(e.unmask.bind(e,this.container))},_addItemsToQuote:function(){return l.addSubscriptionsItemsToQuote(this.cart,this.product,this.subscription,parseInt(this.quantityInput.getValue(),10))},_createQuote:function(){var t=this;return e.mask(this.container),l.createQuote(this.cart,this.subscription.getCurrency(),this.product.getLicensorId(),this.legalEntityId).then((function(){t.cart.dataProxy=t.cart.dataProxy.delegate})).then(this._addToQuote.bind(this))},_createAddButton:function(){const t=h.get("add");return new s({className:"primary",icon:"plus",value:t,attributes:{title:t},events:{onClick:this._onButtonClicked.bind(this)}})},_createQuantityInput:function(){return new i({min:a.isCredit(this.product.getLicensingScheme())?2500:1,max:99999,step:1,decimalPrecision:1})},_checkPrototypes:function(t){o.requiredOfPrototype(t.product,n,"options.product must be a ProductModel"),o.requiredOfPrototype(t.subscription,c,"options.subscription must be a SubscriptionModel"),o.requiredOfPrototype(t.cart,r,"options.cart must be a CartModel")}})})),define("DS/MPFSubscriptionsComponent/quoteList/QuoteListCommandSort",["UWA/Class/View","DS/MPFCartModel/CartSorts","DS/MPFSort/SortOrder","DS/MPFSort/SortDirection","DS/MPFSortSelector/SortSelector","DS/MPFSubscriptionsComponent/quoteList/QuoteListEvents","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent"],((t,e,s,i,o,n,r)=>{"use strict";return t.extend({className:"mpf-quote-list-command-sort",setup(t={}){this.sortSelector=this._createSortSelector(),this.listenTo(this.sortSelector,o.Events.SORT,this._onSortSelected.bind(this))},render(){return this.container.setContent(this.sortSelector.render()),this},_createSortSelector(){return new o({entries:this._createSortOptions()})},_onSortSelected(t){let s;s=t.direction===i.DESCENDING?e.desc(t.sort):t.sort,this.dispatchEvent(n.SORT,{sort:s})},_createSortOptions:()=>[{label:r.get("modificationDate"),name:e.MODIFICATION_DATE,order:s.NUMERICAL,selected:i.DESCENDING},{label:r.get("creationDate"),name:e.CREATION_DATE,order:s.NUMERICAL}],destroy(){this.stopListening(this.sortSelector),this.sortSelector.destroy(),this.sortSelector=null,this._parent(),this.container=null}})})),define("DS/MPFSubscriptionsComponent/offerList/OfferCardComponent",["UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFPortfolioModel/PortfolioModel","DS/MPFPortfolioModel/compass/CompassPortfolioCollection","DS/MPFSubscriptionsComponent/roleList/RoleCard","DS/MPFSubscriptionsComponent/offerList/OfferCardFooter","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],((t,e,s,i,o,n,r)=>{"use strict";return t.extend({className:"mpf-offer-card",setup(t={}){e.requiredOfPrototype(t.offer,i,"options.offer must be a PortfolioModel"),e.requiredOfPrototype(t.cart,s,"options.cart must be a CartModel"),e.requiredOfPrototype(t.compassPortfolios,o,"options.compassPortfolios must be a CompassPortfolioCollection"),this.legalEntityId=t.legalEntityId,this.offer=t.offer,this.cart=t.cart,this.compassPortfolios=t.compassPortfolios,this.footer=this._createFooter(),this.roleCard=this._createRoleCard({footer:this.footer})},render(){return this.container.setContent([this.roleCard.render()]),this.container.setData(i.Fields.SKU_ID,this.offer.getSkuId()),this},_createRoleCard({footer:t}){return new n({portfolio:this.offer,compassPortfolios:this.compassPortfolios,footer:t})},_createFooter(){return new r({offer:this.offer,cart:this.cart,legalEntityId:this.legalEntityId})},destroy(){this.stopListening(),this.roleCard&&this.roleCard.destroy(),this.footer&&this.footer.destroy(),this.roleCard=null,this.footer=null,this.cart=null,this.offer=null,this.compassPortfolios=null,this._parent(),this.container=null}})})),define("DS/MPFSubscriptionsComponent/roleList/BuyMoreComponent",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFProductModel/ProductModel","DS/MPFCartModel/CartModel","DS/MPFSubscriptionModel/SubscriptionCollection","DS/MPFSubscriptionsComponent/roleList/BuyMoreFooter","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],((t,e,s,i,o,n,r,a)=>{"use strict";const c={ON_BACK:"onBack"},l=e.extend({className:"mpf-buy-more",setup(t={}){this._parent(t),this._checkPrototypes(t),this.product=t.product,this.subscriptions=t.subscriptions,this.cart=t.cart,this.legalEntityId=t.legalEntityId,this.header=this._createrHeader(),this.yearlyContainer=this._createSchemeContainer(n.RevTypes.YSC,a.get("yearlySubscriptions").toUpperCase()),this.quarterlyContainer=this._createSchemeContainer([n.RevTypes.QRC,n.RevTypes.QSC],a.get("quarterlySubscriptions").toUpperCase())},render(){const t=this.cart.getItemsLicenseScheme(),e=!t||t===i.RevTypes.YSC,s=!t||t===i.RevTypes.QSC||t===i.RevTypes.QRC;return this.container.setContent([this.header,e&&this.yearlyContainer,s&&this.quarterlyContainer]),this},disablePeriodicity(t){const e=t===i.RevTypes.YSC,s=t===i.RevTypes.QRC||t===i.RevTypes.QSC;e?this.quarterlyContainer&&this.quarterlyContainer.hide():s&&this.yearlyContainer&&this.yearlyContainer.hide()},enableAllPeriodicities(){this.quarterlyContainer&&this.quarterlyContainer.show(),this.yearlyContainer&&this.yearlyContainer.show()},_createFooter(t){return new r({product:this.product,subscription:t,cart:this.cart,legalEntityId:this.legalEntityId})},_createSchemeContainer(e,s){const i=this.subscriptions.getSubscriptionWithLicensingScheme(e);if(i)return t.createElement("div",{class:"mpf-buy-more-details",html:[{tag:"div",class:"mpf-buy-more-details-title",text:s},this._createPriceContainer(i),this._createFooter(i).render()]})},_createPriceContainer(e){const s=e.getMonthlyPrice(),i=parseFloat(s).toLocaleString("fr-FR",{style:"currency",currency:e.getCurrency()})+" / user / month";return t.createElement("div",{class:"mpf-buy-more-price",text:i})},_createrHeader(){var e=this;return t.createElement("div",{class:"mpf-buy-more-header",html:[{class:"fonticon fonticon-chevron-left"},this.product.getDisplayName()],events:{click:function(){e.dispatchEvent(c.ON_BACK)}}})},_checkPrototypes(t){s.requiredOfPrototype(t.product,i,"options.product must be a ProductModel"),s.requiredOfPrototype(t.cart,o,"options.cart must be a CartModel"),s.requiredOfPrototype(t.subscriptions,n,"options.options.subscriptions must be a SubscriptionCollection")}});return l.Events=Object.freeze(c),l})),define("DS/MPFSubscriptionsComponent/quoteList/QuoteListCommands",["UWA/Class/View","DS/MPFSubscriptionsComponent/quoteList/QuoteListCommandFilter","DS/MPFSubscriptionsComponent/quoteList/QuoteListCommandSort","DS/MPFSubscriptionsComponent/quoteList/QuoteListEvents"],((t,e,s,i)=>{"use strict";return t.extend({className:"mpf-quote-list-commands",setup(t){this.filterCommand=this._createFilterCommand(),this.sortCommand=this._createSortCommand(),this.listenTo(this.filterCommand,i.FILTER_BY_DATE,this._onFilterByDate.bind(this)),this.listenTo(this.sortCommand,i.SORT,this._onSort.bind(this))},render(){return this.container.setContent([this.filterCommand.render(),this.sortCommand.render()]),this},setFilterActive(t){this.filterCommand.setActive(t)},_createFilterCommand:()=>new e,_createSortCommand:()=>new s,_onFilterByDate(t){this.dispatchEvent(i.FILTER_BY_DATE,t)},_onSort(t){this.dispatchEvent(i.SORT,t)},destroy(){this.stopListening(this.filterCommand),this.stopListening(this.sortCommand),this.filterCommand.destroy(),this.filterCommand=null,this.sortCommand.destroy(),this.sortCommand=null,this._parent()}})})),define("DS/MPFSubscriptionsComponent/offerList/OfferCardListComponent",["UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFPortfolioModel/PortfolioModel","DS/MPFPortfolioModel/PortfolioCollection","DS/MPFSubscriptionsComponent/offerList/OfferCardComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],((t,e,s,i,o,n)=>{"use strict";return t.extend({className:"mpf-offer-card-list",setup(t={}){this._parent(t),this._checkPrototypes(t),this.legalEntityId=t.legalEntityId,this.offers=t.offers,this.cart=t.cart,this.compassPortfolios=t.compassPortfolios,this.cards=this._createCards()},render(){const t=this.cards.map((t=>t.render()));return this.container.setContent(t),this},filterOnPeriodicity(t){const e=t===i.RevTypes.YSC,s=t===i.RevTypes.QRC+","+i.RevTypes.QSC||t===i.RevTypes.QRC||t===i.RevTypes.QSC;this.cards.forEach((t=>{const o=t.offer.getRevType();e&&o===i.RevTypes.YSC?t.show():!s||o!==i.RevTypes.QSC&&o!==i.RevTypes.QRC?t.hide():t.show()}))},_createCards(){return this.offers.map((t=>(t.onlineInstanceId=this.offers.onlineInstanceId,new n({legalEntityId:this.legalEntityId,offer:t,compassPortfolios:this.compassPortfolios,cart:this.cart}))))},_checkPrototypes(t){e.requiredOfPrototype(t.offers,o,"options.offers must be an PortfolioCollection"),e.requiredOfPrototype(t.cart,s,"options.cart must be a CartModel")},destroy(){this.cart=null,this.offers=null,this.compassPortfolios=null,this.stopListening(),this._parent()}})})),define("DS/MPFSubscriptionsComponent/roleList/RolePresentation",["UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFProductModel/ProductModel","DS/MPFPortfolioModel/compass/CompassPortfolioCollection","DS/MPFSubscriptionsComponent/roleList/RoleCard","DS/MPFSubscriptionsComponent/roleList/RoleCardFooter","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],((t,e,s,i,o,n)=>{"use strict";const r=Object.freeze({BUY_MORE:"buyMore",MANAGE:"manage"}),a=t.extend({className:"mpf-role-presentation",setup(t={}){this._parent(t),e.requiredOfPrototype(t.product,s,"options.product must be a ProductModel"),e.requiredOfPrototype(t.compassPortfolios,i,"options.compassPortfolios must be a CompassPortfolioCollection"),this.product=t.product,this.compassPortfolios=t.compassPortfolios,this.product.isMarketplaceOffer()&&this.container.addClassName("mpf-marketplace-offer"),this._createSubComponents()},render(){return this.container.setContent([this.roleCard.render()]),this},destroy(){this.stopListening(),this.roleCard&&this.roleCard.destroy(),this.footer&&this.footer.destroy(),this.roleCard=null,this.footer=null,this.product=null,this.compassPortfolios=null,this._parent(),this.container=null},_createSubComponents(){this.footer||(this.footer=this._createFooter()),this.roleCard||(this.roleCard=this._createRoleCard({footer:this.footer}))},_onManage(){this.dispatchEvent(r.MANAGE)},_onBuyMore(){this.dispatchEvent(r.BUY_MORE)},_createRoleCard({footer:t}){return new o({product:this.product,compassPortfolios:this.compassPortfolios,footer:t})},_createFooter(){const t=new n({product:this.product});return this.listenTo(t,n.Events.BUY_MORE,this._onBuyMore.bind(this)),this.listenTo(t,n.Events.MANAGE,this._onManage.bind(this)),t}});return a.Events=r,a})),define("DS/MPFSubscriptionsComponent/offerList/OfferListComponent",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Button","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartFactory","DS/MPFPortfolioModel/PortfolioCollection","DS/MPFSubscriptionsComponent/offerList/OfferFilters","DS/MPFSubscriptionsComponent/offerList/OfferCardListComponent","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],((t,e,s,i,o,n,r,a,c,l)=>{"use strict";const h=Object.freeze({GO_TO_MY_ORDERS:"goToMyOrders"}),d=e.extend({className:"mpf-offer-list",setup(t={}){this._parent(t),this._checkPrototypes(t),this.legalEntityId=t.legalEntityId,this.offers=t.offers,this.compassPortfolios=t.compassPortfolios,this.cart=t.cart,this.paymentCompleted=!1,this.offerFilters=this._createOfferFilters(),this.offerCardsList=this._createOfferCardsList()},render(){const e=t.createElement("div",{class:"mpf-subs-title",html:l.get("moreRoles")});this.filterOnPeriodicity(this.offerFilters.getPeriodicityValue());const s=[t.createElement("div",{class:"mpf-title-header",html:[e,0===this.offers.size()?"":this.offerFilters.render()]}),t.createElement("div",{class:"mpf-portfolio",html:0===this.offers.size()?this._getNoOfferMessage():this.offerCardsList.render()})];return this.container.setContent(s),this},filterOnPeriodicity(t){return this.offerCardsList.filterOnPeriodicity(t)},setPeriodicityFilterValue(t){return this.offerFilters.setPeriodicityFilterValue(t)},disablePeriodicityFilter(){return this.offerFilters.disablePeriodicityFilter()},enablePeriodicityFilter(){return this.offerFilters.enablePeriodicityFilter()},_getNoOfferMessage:()=>t.createElement("div",{class:"mpf-message",html:[t.createElement("div",{class:"fonticon fonticon-3x fonticon-search"}),t.createElement("h4",{text:l.get("portfolioEmpty")}),t.createElement("div",{text:l.get("noOffersSearch")})]}),_createOfferFilters(){const t=new a;return this.listenTo(t,a.Events.NEW_FILTER_VALUE,this._newFilterSelected.bind(this)),t},_newFilterSelected(t){t.filterType===a.FilterTypes.PERIODICITY&&this.offerCardsList.filterOnPeriodicity(t.value)},_createOfferCardsList(e){return new c({offers:t.is(e)?e:this.offers,cart:this.cart,compassPortfolios:this.compassPortfolios,legalEntityId:this.legalEntityId})},_onPaymentCompleted(){this.paymentCompleted=!0},_onPaymentModalClosed(){!0===this.paymentCompleted&&this.dispatchEvent(h.GO_TO_MY_ORDERS)},_checkPrototypes(t){i.requiredOfPrototype(t.cart,o,"options.cart must be a CartModel"),i.requiredOfPrototype(t.offers,r,"options.offers must be an PortfolioCollection")},destroy(){this.stopListening(),this.compassPortfolios=null,this._parent(),this.container=null}});return d.Events=h,d})),define("DS/MPFSubscriptionsComponent/roleList/ActiveSubscriptionCard",["UWA/Class/View","DS/UIKIT/Mask","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFProductModel/ProductModel","DS/MPFSubscriptionModel/SubscriptionFactory","DS/MPFFiniteStateMachine/FiniteStateMachine","DS/MPFSubscriptionsComponent/roleList/RolePresentation","DS/MPFSubscriptionsComponent/roleList/BuyMoreComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],((t,e,s,i,o,n,r,a,c)=>{"use strict";const l=Object.freeze({ROLE_PRESENTATION:"rolePresentation",ON_ADD_SUBSCRIPTIONS:"onAddSubscriptions"}),h=Object.freeze({RENDERED:"rendered",MANAGE_SUBSCRIPTIONS:"manageSubscriptions"}),d=t.extend({className:"mpf-active-subscription-card",setup(t={}){s.requiredOfPrototype(t.cart,i,"options.cart must be a CartModel"),s.requiredOfPrototype(t.product,o,"options.product must be a ProductModel"),s.requiredOfPrototype(t.subscriptionFactory,n,"options.subscriptionFactory must be a SubscriptionFactory"),this.cart=t.cart,this.product=t.product,this.compassPortfolios=t.compassPortfolios,this.subscriptionFactory=t.subscriptionFactory,this.legalEntityId=t.legalEntityId,this.stateMachine=this._createStateMachine(),this.rolePresentationComponent=this._createRolePresentationComponent()},render(){let t;return this.stateMachine.getState()===l.ROLE_PRESENTATION?t=this.rolePresentationComponent.render():this.stateMachine.getState()===l.ON_ADD_SUBSCRIPTIONS&&(t=this.buyMoreComponent.render({})),this.container.setContent(t),this.dispatchEvent(h.RENDERED),this},disableBuyMorePeriodicity(t){this.buyMoreComponent&&this.buyMoreComponent.disablePeriodicity(t)},enableBuyMoreAllPeriodicities(){this.buyMoreComponent&&this.buyMoreComponent.enableAllPeriodicities()},destroy(){this.stopListening(),this.rolePresentationComponent.destroy(),this.buyMoreComponent&&this.buyMoreComponent.destroy(),this.rolePresentationComponent=null,this.buyMoreComponent=null,this.subscriptionFactory=null,this.product=null,this.compassPortfolios=null,this.cart=null,this._parent(),this.container=null},async _displayBuyMoreView(){e.mask(this.container);const t=this.subscriptionFactory.createCollection(n.Types.CATALOGUE_SUBSCRIPTIONS,null,{parentResourceId:this.product.getName()});t.onlineInstanceId=this.product.onlineInstanceId,await t.fetchPromise(),e.unmask(this.container),this.buyMoreComponent=this._createBuyMoreComponent({subscriptions:t}),this.stateMachine.changeState(l.ON_ADD_SUBSCRIPTIONS),this.render()},_displayPresentationView(){this.stateMachine.changeState(l.ROLE_PRESENTATION),this.render()},_createBuyMoreComponent({subscriptions:t}){const e=new c({product:this.product,cart:this.cart,legalEntityId:this.legalEntityId,subscriptions:t});return this.listenTo(e,c.Events.ON_BACK,this._displayPresentationView.bind(this)),e},_createRolePresentationComponent(){const t=new a({product:this.product,compassPortfolios:this.compassPortfolios});return this.listenTo(t,a.Events.MANAGE,this.dispatchEvent.bind(this,h.MANAGE_SUBSCRIPTIONS)),this.listenTo(t,a.Events.BUY_MORE,this._displayBuyMoreView.bind(this)),t},_createStateMachine:()=>new r({state:l.ROLE_PRESENTATION,states:[l.ROLE_PRESENTATION,l.ON_ADD_SUBSCRIPTIONS],transitions:[{from:l.ROLE_PRESENTATION,to:l.ON_ADD_SUBSCRIPTIONS},{from:l.ON_ADD_SUBSCRIPTIONS,to:l.ROLE_PRESENTATION}]})});return d.Events=h,d})),define("DS/MPFSubscriptionsComponent/roleList/SchemeActiveSubscriptionList",["UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFProductModel/ProductModel","DS/MPFSubscriptionsComponent/roleList/ActiveSubscriptionLine","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent"],((t,e,s,i,o)=>{"use strict";const n=Object.freeze({STOP:"stopSubscription"}),r=Object.freeze({YSC:"yearly",QRC:"quarterly",QSC:"quarterly",MSC:"monthly"}),a=t.extend({className:"mpf-scheme-active-subscription-list",setup(t={}){e.requiredOfPrototype(t.product,s,"options.product must be a ProductModel"),e.requiredOfType(t.licensingScheme,"string","options.licensingScheme must be a string"),this.product=t.product,this.licensingScheme=t.licensingScheme,this.activeSubscriptionLines=[]},render(){const t=[];return this._destroyActiveSubscriptionLines(),this.activeSubscriptionLines=this._createActiveSubscriptionLines(),this.activeSubscriptionLines.forEach((e=>{e&&t.push({tag:"div",class:"mpf-scheme-list-title",text:o.get(`${r[this.licensingScheme]}Subscriptions`).toUpperCase()},{tag:"div",class:"mpf-subscription-list",html:e.render()})})),this.container.setContent(t),this},destroy(){this._destroyActiveSubscriptionLines(),this.activeSubscriptionLines=null,this.product=null,this._parent(),this.container=null},_createActiveSubscriptionLines(){return this.product.getSubscriptions().filter((t=>t.getLicensingScheme()===this.licensingScheme)).filter((t=>t.getActiveQuantity()>0)).map((t=>{const e=new i({subscription:t});return this.listenTo(e,i.Events.STOP_SUBSCRIPTION,this.dispatchEvent.bind(this,n.STOP,t)),e}))},_destroyActiveSubscriptionLines(){this.activeSubscriptionLines.forEach((t=>{this.stopListening(t),t.destroy()})),this.activeSubscriptionLines=[]}});return a.Events=n,a})),define("DS/MPFSubscriptionsComponent/roleList/ManageSubscriptionsComponent",["UWA/Core","UWA/Class/View","DS/UIKIT/Mask","DS/MPFServices/ObjectService","DS/MPFProductModel/ProductModel","DS/MPFSubscriptionsComponent/roleList/SchemeActiveSubscriptionList","DS/MPFSubscriptionsComponent/roleList/StopSubscriptionsComponent"],((t,e,s,i,o,n,r)=>{"use strict";const a=Object.freeze({LIST:"subscriptionList",STOP:"stopSubscription"}),c=Object.freeze({ON_BACK:"onBack",ON_SUBSCRIPTION_STOPPED:"onSubscriptionStopped"}),l=e.extend({className:"mpf-manage-subscriptions-component",setup(t={}){i.requiredOfPrototype(t.product,o,"options.product must be a ProductModel"),this.product=t.product,this.state=t.state||a.LIST,this.subscriptionLists=[]},render(){const t=[{class:"mpf-manage-header",html:[{class:"fonticon fonticon-chevron-left"},this.product.getDisplayName()],events:{click:this._onBack.bind(this)}}];return this.state===a.STOP&&this.subscription?(this._destroyStopSubscriptionComponent(),this.stopSubscriptionsComponent=this._createStopSubscriptionsComponent(),t.push(this.stopSubscriptionsComponent.render())):(this._destroyActiveSubscriptionLists(),this.subscriptionLists=this._createActiveSubscriptionLists(),t.push({tag:"div",class:"mpf-list-container",html:this.subscriptionLists.map((t=>t.render()))})),this.container.setContent(t),this},destroy(){this.stopListening(),this._destroyStopSubscriptionComponent(),this._destroyActiveSubscriptionLists(),this.product=null,this.subscription=null,this._parent(),this.container=null},_onBack(){this.state===a.LIST?this.dispatchEvent(c.ON_BACK):this._showActiveSubscriptionList()},_createActiveSubscriptionLists(){return this.product.getAvailableLicensingSchemes().filter((t=>this.product.hasSubscriptionsForLicensingScheme(t))).map((t=>{const e=new n({product:this.product,licensingScheme:t});return this.listenTo(e,n.Events.STOP,this._showStopSubscriptionComponent.bind(this)),e}))},_createStopSubscriptionsComponent(){const t=new r({subscription:this.subscription});return this.listenTo(t,r.Events.CANCEL,this._showActiveSubscriptionList.bind(this)),this.listenTo(t,r.Events.SUBS_STOPPED,this._showActiveSubscriptionList.bind(this)),t},_destroyStopSubscriptionComponent(){this.stopSubscriptionComponent&&(this.stopListening(this.stopSubscriptionComponent),this.stopSubscriptionComponent.destroy(),this.stopSubscriptionComponent=null)},_destroyActiveSubscriptionLists(){this.subscriptionLists.forEach((t=>{this.stopListening(t),t.destroy()}))},_showActiveSubscriptionList(){this.state=a.LIST,this.subscription=null,this.render()},_showStopSubscriptionComponent(t){this.state=a.STOP,this.subscription=t,this.subscription.onlineInstanceId=this.product.onlineInstanceId,this.render()}});return l.Events=c,l})),define("DS/MPFSubscriptionsComponent/paymentMethodsList/PaymentMethodsCardEntry",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Button","DS/UIKIT/Input/Toggle","DS/UIKIT/Mask","DS/UIKIT/Alert","DS/WebappsUtils/WebappsUtils","DS/MPFServices/ObjectService","DS/MPFFiniteStateMachine/FiniteStateMachine","DS/MPFPaymentCardTokenModel/PaymentCardTokenModel","DS/MPFPspModel/PspModel","DS/MPFSubscriptionsComponent/paymentMethodsList/PaymentCardForm","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent"],((t,e,s,i,o,n,r,a,c,l,h,d,p)=>{"use strict";const u=Object.freeze({CARD_SELECTED:"cardSelected",PAYMENT_INFO_UPDATED:"paymentInfoUpdated"}),m=Object.freeze({STANDARD_VIEW:"standardView",MSG_DISPLAYED:"msgDisplayed",CARD_FORM_DISPLAYED:"cardFormDisplayed"}),S=e.extend({className:"mpf-card-entry",setup(t={}){this._checkPrototypes(t),this.card=t.card,this.psp=t.psp,this.onlineInstanceId=t.onlineInstanceId,this.stateMachine=this._createStateMachine(),this.toggle=this._createToggleEntry(),this.typeEntry=this._createTypeEntry(),this.numberEntry=this._createNumberEntry(),this.expirationEntry=this._createExpirationDateEntry(),this.ownerEntry=this._createOwnerEntry(),this.selectedCardEntry=this._createSelectedEntry(),this.optionsEntry=this._createOptionsEntry(),this.cardForm=this._createCardForm()},render(){const e=[],s=t.createElement("div",{class:"mpf-card-entry-content",html:[this.toggle,this.typeEntry,this.numberEntry,this.expirationEntry,this.ownerEntry,this.selectedCardEntry,this.optionsEntry]});return e.push(s),this.stateMachine.getState()===m.CARD_FORM_DISPLAYED?(e.push(this.cardForm.render()),this.cardForm.show()):this.cardForm.hide(),this.stateMachine.getState()===m.MSG_DISPLAYED&&(this.importantMessage=this._createImportantMessage(),e.push(this.importantMessage)),this.container.setContent(e),this},uncheck(){this.toggle.uncheck(),this.toggle.setDisabled(this.card.isExpired()),this.selectedCardEntry.setText(this.card.isExpired()?p.get("expired"):""),this.card.setAsDefaultPaymentMethod(!1)},_deleteCard(){return o.mask(this.container),this.card.setParentResourceId(this.onlineInstanceId),this.card.destroyPromise().then(this.dispatchEvent.bind(this,u.PAYMENT_INFO_UPDATED)).catch(this._displayErrorMessage.bind(this,p.get("cardNotDeleted"))).finally(o.unmask.bind(o,this.container))},_displayErrorMessage(t){new n({className:"error",messageClassName:"error",messages:t,closable:!0,visible:!0,closeOnClick:!0}).inject(this.container,"top")},_setCardAsDefaultPaymentMethod(){const t={};return t[l.Fields.IS_DEFAULT_PAYMENT_METHOD]=!0,this.card.setParentResourceId(this.onlineInstanceId),this.card.savePromise(t,{patch:!0}).then((()=>{this.selectedCardEntry.setText(this.card.isExpired()?p.get("expired"):p.get("defaultPaymentMethod")),this.dispatchEvent(u.CARD_SELECTED,this)})).catch(this.uncheck.bind(this))},_createCardForm(){const t=new d({title:p.get("updateCard"),card:this.card,psp:this.psp,onlineInstanceId:this.onlineInstanceId});return this.listenTo(t,d.Events.PAYMENT_INFO_UPDATED,this.dispatchEvent.bind(this,u.PAYMENT_INFO_UPDATED)),this.listenTo(t,d.Events.CANCEL,(()=>{this.stateMachine.changeState(m.STANDARD_VIEW),this.render()})),t},_createImportantMessage(){const e=new s({className:"primary",value:p.get("gotIt"),events:{onClick:()=>{this.card.isDefaultPaymentMethod()?(this.importantMessage.destroy(),this.stateMachine.changeState(m.STANDARD_VIEW)):this._deleteCard()}}}),i=new s({value:p.get("cancel"),events:{onClick:()=>{this.importantMessage.destroy(),this.stateMachine.changeState(m.STANDARD_VIEW)}}}),o=t.createElement("div",{class:"mpf-card-entry-msg-header",html:[{tag:"div",text:p.get("importantMessage")},{tag:"div",html:this.card.isDefaultPaymentMethod()?e:[e,i]}]}),n=t.createElement("div",{class:"mpf-card-entry-msg-content",html:[{tag:"div",class:"fonticon fonticon-alert"},{tag:"div",text:this.card.isDefaultPaymentMethod()?p.get("addPaymentMethod"):p.get("warningCardDeleted")}]});return t.createElement("div",{class:"mpf-card-entry-msg",html:[o,n]})},_createToggleEntry(){return new i({type:"radio",value:" ",checked:this.card.isDefaultPaymentMethod(),className:"primary",id:this.card.getCardId(),disabled:this.card.isExpired()&&!this.card.isDefaultPaymentMethod(),events:{onChange:this._setCardAsDefaultPaymentMethod.bind(this)}})},_createOptionsEntry(){const e=new s({className:"link",value:p.get("delete"),events:{onClick:()=>{this.stateMachine.changeState(m.MSG_DISPLAYED),this.render()}}}),i=new s({className:"link",value:p.get("update"),events:{onClick:()=>{this.stateMachine.changeState(m.CARD_FORM_DISPLAYED),this.render()}}});return t.createElement("div",{class:"mpf-card-options",html:[e,i]})},_createSelectedEntry(){const e=this.card.isExpired()?p.get("expired"):this.card.isDefaultPaymentMethod()?p.get("defaultPaymentMethod"):"";return t.createElement("div",{class:"mpf-card-selected",text:e})},_createOwnerEntry(){return t.createElement("div",{class:"mpf-card-owner",text:this.card.getCardName()})},_createExpirationDateEntry(){return t.createElement("div",{class:"mpf-card-expiration",text:p.get("expire")+" "+this.card.getCardExpMonth()+"/"+this.card.getCardExpYear()})},_createNumberEntry(){return t.createElement("div",{class:"mpf-card-number",text:"****-"+this.card.getCardNumber()})},_createTypeEntry(){const e=this.card.getCardType(),s=r.getWebappsAssetUrl("MPFSubscriptionsComponent","graphics/pictures/")+e.toLowerCase().replace(/\s+/,"")+".png",i=t.createElement("img",{src:s});return t.createElement("div",{class:"mpf-card-type",html:[i,e]})},_createStateMachine:()=>new c({state:m.STANDARD_VIEW,states:[m.STANDARD_VIEW,m.MSG_DISPLAYED,m.CARD_FORM_DISPLAYED],transitions:[{from:m.STANDARD_VIEW,to:m.MSG_DISPLAYED},{from:m.MSG_DISPLAYED,to:m.STANDARD_VIEW},{from:m.STANDARD_VIEW,to:m.CARD_FORM_DISPLAYED},{from:m.CARD_FORM_DISPLAYED,to:m.STANDARD_VIEW},{from:m.MSG_DISPLAYED,to:m.CARD_FORM_DISPLAYED},{from:m.CARD_FORM_DISPLAYED,to:m.MSG_DISPLAYED}]}),_checkPrototypes(t){a.requiredOfPrototype(t.card,l,"options.card must be a PaymentCardTokenModel"),a.requiredOfPrototype(t.psp,h,"options.psp must be a PspModel")},destroy(){this.card=null,this._parent()}});return S.Events=u,S})),define("DS/MPFSubscriptionsComponent/quoteList/StatusSelectorTile",["UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCartModel/CartCollection","DS/MPFCartModel/CartFilters","DS/MPFSubscriptionsComponent/quoteList/StatusSelectorTileElement","DS/MPFSubscriptionsComponent/quoteList/QuoteListEvents","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],((t,e,s,i,o,n,r)=>{"use strict";return t.extend({className:"mpf-status-selector-tile",setup(t={}){e.requiredOfPrototype(t.carts,s,"options.carts must be a CartCollection"),this.carts=t.carts,this.pendingSelector=this._createPendingSelector(),this.deliveredSelector=this._createDeliveredSelector(),this.canceledSelector=this._createCanceledSelector(),this.allSelector=this._createAllSelector(),this.listenTo(this.pendingSelector,o.Events.SELECTED,this._onPendingSelected.bind(this)),this.listenTo(this.deliveredSelector,o.Events.SELECTED,this._onDeliveredSelected.bind(this)),this.listenTo(this.canceledSelector,o.Events.SELECTED,this._onCanceledSelected.bind(this)),this.listenTo(this.allSelector,o.Events.SELECTED,this._onAllSelected.bind(this)),this.listenTo(this.carts,"onReset",this._updateSelectorCounts.bind(this))},render(){return this.container.setContent([this.pendingSelector.render(),this.deliveredSelector.render(),this.canceledSelector.render(),this.allSelector.render()]),this},destroy(){this.stopListening(this.pendingSelector),this.stopListening(this.deliveredSelector),this.stopListening(this.canceledSelector),this.stopListening(this.allSelector),this.stopListening(this.carts),this._parent()},_updateSelectorCounts(){this.pendingSelector.updateCount(this.carts.pending),this.deliveredSelector.updateCount(this.carts.delivered),this.canceledSelector.updateCount(this.carts.cancelled),this.allSelector.updateCount(this.carts.all),this.render()},_createPendingSelector(){return new o({title:r.get("pending"),isSelected:!0,cssClass:"pending",count:this.carts.pending})},_createDeliveredSelector(){return new o({title:r.get("delivered"),isSelected:!1,cssClass:"delivered",count:this.carts.delivered})},_createCanceledSelector(){return new o({title:r.get("cancelled"),isSelected:!1,cssClass:"canceled",count:this.carts.cancelled})},_createAllSelector(){return new o({title:r.get("all"),isSelected:!1,cssClass:"all",count:this.carts.all})},_onPendingSelected(){const t={};this.deliveredSelector.setIsSelected(!1),this.canceledSelector.setIsSelected(!1),this.allSelector.setIsSelected(!1),t[i.FILTER_BY_STATE]=i.STATE_PENDING_FILTER,this.dispatchEvent(n.FILTER_BY_STATE,t)},_onDeliveredSelected(){const t={};this.pendingSelector.setIsSelected(!1),this.canceledSelector.setIsSelected(!1),this.allSelector.setIsSelected(!1),t[i.FILTER_BY_STATE]=i.STATE_DELIVERED_FILTER,this.dispatchEvent(n.FILTER_BY_STATE,t)},_onCanceledSelected(){const t={};this.pendingSelector.setIsSelected(!1),this.deliveredSelector.setIsSelected(!1),this.allSelector.setIsSelected(!1),t[i.FILTER_BY_STATE]=i.STATE_CANCELED_FILTER,this.dispatchEvent(n.FILTER_BY_STATE,t)},_onAllSelected(){const t={};this.pendingSelector.setIsSelected(!1),this.deliveredSelector.setIsSelected(!1),this.canceledSelector.setIsSelected(!1),t[i.FILTER_BY_STATE]=i.STATE_ALL_FILTER,this.dispatchEvent(n.FILTER_BY_STATE,t)}})})),define("DS/MPFSubscriptionsComponent/roleList/StopRenewalSchemeSection",["UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFProductModel/ProductModel","DS/MPFSubscriptionModel/SubscriptionModel","DS/MPFSubscriptionModel/SubscriptionCollection","DS/MPFSubscriptionsComponent/roleList/StopRenewalTableLine","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent"],(function(t,e,s,i,o,n,r){"use strict";const a=Object.freeze({STOP_RENEWAL:"stopRenewal"}),c=Object.freeze({EXPANDED:"expanded",COLLAPSED:"collapsed"}),l=new Map;l.set("YSC","yearly"),l.set("QRC","quarterly"),l.set("QSC","quarterly"),l.set("MSC","monthly");const h=t.extend({className:"mpf-stop-renewal-scheme-section",setup({product:t,subscriptions:i,scheme:n,locale:r,state:a}={}){e.requiredOfPrototype(i,o,"options.subscriptions must be a SubscriptionCollection"),e.requiredOfPrototype(t,s,"options.product must be a ProductModel"),this.product=t,this.subscriptions=i,this.scheme=n,this.locale=r,this.state=a||c.EXPANDED},render(){const t=this.subscriptions.where({[i.Fields.LICENSING_SCHEME]:this.scheme}),e=[{tag:"div",class:"mpf-section-title",html:[{tag:"span",class:"fonticon fonticon-"+(this.state===c.EXPANDED?"expand-down":"expand-right")},{tag:"span",text:r.get(l.get(this.scheme)+"Subscriptions")+` (${t.reduce(((t,e)=>t+e.getQuantity()),0)})`}],events:{click:()=>{this.state=this.state===c.COLLAPSED?c.EXPANDED:c.COLLAPSED,this.render()}}}];return this.state===c.EXPANDED&&e.push(this._renderTable(t)),this.container.setContent(e),this},destroy(){this._destroyTableLines(),this.product=null,this.subscriptions=null,this._parent(),this.container=null},_renderTable(t){return this._destroyTableLines(),this.tableLines=t.map((t=>this._renderTableLine(t))),{tag:"div",class:"mpf-table",html:[this._renderTableHead(),this.tableLines.map((t=>t.render()))]}},_renderTableHead:()=>({tag:"div",class:"mpf-table-header",html:[r.get("quantity"),r.get("status"),r.get("date"),r.get("unitPrice")].map((t=>({tag:"span",text:t})))}),_renderTableLine(t){const e=new n({product:this.product,locale:this.locale,subscription:t});return this.listenTo(e,n.Events.ON_CONFIRMATION,this.dispatchEvent.bind(this,a.STOP_RENEWAL)),e},_destroyTableLines(){this.tableLines&&this.tableLines.forEach((t=>{this.stopListening(t),t.destroy()})),this.tableLines=null}});return h.Events=a,h})),define("DS/MPFSubscriptionsComponent/quoteList/QuoteCardBody",["UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFSubscriptionsComponent/quoteList/ProductListTile","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],((t,e,s,i)=>{"use strict";return t.extend({className:"mpf-quote-card-body",setup(t={}){this._parent(t),this._checkPrototypes(t),this.cart=t.cart,this.compassPortfolios=t.compassPortfolios,this.productDetailsTile=this._createProductListTile()},render(){return this.container.setContent(this.productDetailsTile.render()),this},destroy(){this.productDetailsTile.destroy(),this.cart=null,this.compassPortfolios=null,this._parent(),this.container=null},_createProductListTile(){return new i({cart:this.cart,compassPortfolios:this.compassPortfolios})},_checkPrototypes(t){e.requiredOfPrototype(t.cart,s,"options.cart must be a CartModel")}})})),define("DS/MPFSubscriptionsComponent/quoteList/QuoteListHeader",["UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCartModel/CartCollection","DS/MPFSubscriptionsComponent/quoteList/StatusSelectorTile","DS/MPFSubscriptionsComponent/quoteList/QuoteListCommands","DS/MPFSubscriptionsComponent/quoteList/QuoteListEvents"],((t,e,s,i,o,n)=>{"use strict";return t.extend({className:"mpf-quote-list-header",setup(t={}){e.requiredOfPrototype(t.carts,s,"options.carts must be a CartCollection"),this.carts=t.carts,this.statusSelectorTile=this._createStatusSelectorTile(t.statusSelectorInitValue),this.commands=this._createCommands(),this.stateFilter="all",this.listenTo(this.statusSelectorTile,n.FILTER_BY_STATE,this._onFilterByState.bind(this)),this.listenTo(this.commands,n.FILTER_BY_DATE,this._onFilterByDate.bind(this)),this.listenTo(this.commands,n.SORT,this._onSort.bind(this))},render(){return this.container.setContent([this.statusSelectorTile.render(),this.commands.render()]),this},setFilterActive(t){this.commands.setFilterActive(t)},_createStatusSelectorTile(){return new i({carts:this.carts})},_createCommands:()=>new o,_onFilterByState(t){this.dispatchEvent(n.FILTER_BY_STATE,t)},_onFilterByDate(t){this.dispatchEvent(n.FILTER_BY_DATE,t)},_onSort(t){this.dispatchEvent(n.SORT,t)},destroy(){this.stopListening(this.statusSelectorTile),this.stopListening(this.commands),this.statusSelectorTile.destroy(),this.statusSelectorTile=null,this.commands.destroy(),this.commands=null,this._parent()}})})),define("DS/MPFSubscriptionsComponent/quoteList/QuoteCard",["UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFCartQuoteModel/CartQuoteFactory","DS/MPFInvoiceModel/InvoiceFactory","DS/MPFCompanyModel/CompanyFactory","DS/MPFSubscriptionsComponent/quoteList/QuoteCardHeader","DS/MPFSubscriptionsComponent/quoteList/QuoteCardBody","DS/MPFSubscriptionsComponent/quoteList/QuoteCardFooter","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],((t,e,s,i,o,n,r,a,c)=>{"use strict";const l=Object.freeze({REFRESH_CARTS:"refreshCarts",DISPLAY_CHECKOUT:"displayCheckout"}),h=t.extend({className:"mpf-quote-card",setup(t={}){this._parent(t),this._checkPrototypes(t),this.cart=t.cart,this.compassPortfolios=t.compassPortfolios,this.cartFactory=t.cartFactory,this.personFactory=t.personFactory,this.invoiceFactory=t.invoiceFactory,this.cartQuoteFactory=t.cartQuoteFactory,this.companyFactory=t.companyFactory,this.header=this._createHeader(),this.body=this._createBody(),this.footer=this._createFooter(),this.listenTo(this.footer,c.Events.DISPLAY_CHECKOUT,this._displayCheckout.bind(this))},render(){return this.container.setContent([this.header.render(),this.body.render(),this.footer.render()]),this},destroy(){this.stopListening(),this.header.destroy(),this.body.destroy(),this.footer.destroy(),this.cart=null,this.compassPortfolios=null,this.cartFactory=null,this.personFactory=null,this.invoiceFactory=null,this.cartQuoteFactory=null,this.companyFactory=null,this._parent(),this.container=null},_displayCheckout(t){this.dispatchEvent(l.DISPLAY_CHECKOUT,t)},_createFooter(){return new c({cart:this.cart,cartFactory:this.cartFactory,personFactory:this.personFactory})},_createBody(){return new a({cart:this.cart,compassPortfolios:this.compassPortfolios})},_createHeader(){return new r({cart:this.cart,cartQuoteFactory:this.cartQuoteFactory,companyFactory:this.companyFactory,invoiceFactory:this.invoiceFactory})},_checkPrototypes(t){e.requiredOfPrototype(t.invoiceFactory,o,"options.invoiceFactory must be an InvoiceFactory"),e.requiredOfPrototype(t.cartQuoteFactory,i,"options.cartQuoteFactory must be a CartQuoteFactory"),e.requiredOfPrototype(t.cart,s,"options.cart must be a CartModel"),e.requiredOfPrototype(t.companyFactory,n,"options.companyFactory must be a CompanyFactory")}});return h.Events=l,h})),define("DS/MPFSubscriptionsComponent/quoteList/QuoteList",["UWA/Core","UWA/Class/View","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/PlatformAPI/PlatformAPI","DS/MPFServices/ObjectService","DS/MPFCartQuoteModel/CartQuoteFactory","DS/MPFInvoiceModel/InvoiceFactory","DS/MPFCompanyModel/CompanyFactory","DS/MPFCartModel/CartCollection","DS/MPFCartModel/CartFilters","DS/MPFCartModel/CartSorts","DS/MPFSubscriptionsComponent/quoteList/QuoteListHeader","DS/MPFSubscriptionsComponent/quoteList/QuoteCard","DS/MPFSubscriptionsComponent/quoteList/QuoteListEvents","DS/MPFPaginationComponent/PaginationComponent","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],((t,e,s,i,o,n,r,a,c,l,h,d,p,u,m,S,C)=>{"use strict";const y=Object.freeze({DISPLAY_CHECKOUT:"displayCheckout"}),f=e.extend({className:"mpf-quote-list",setup(t={}){this._parent(t),this._checkPrototypes(t),this.carts=t.carts,this.compassPortfolios=t.compassPortfolios,this.cartFactory=t.cartFactory,this.personFactory=t.personFactory,this.cartQuoteFactory=t.cartQuoteFactory,this.invoiceFactory=t.invoiceFactory,this.companyFactory=t.companyFactory,this.header=this._createHeader(),this.pagination=this._createPagination(),this.fetchOptions={reset:!0,start:0,size:10,company:this.legalEntityId},this.fetchOptions[h.FILTER_BY_STATE]=h.STATE_PENDING_FILTER,this.listenTo(this.header,m.FILTER_BY_STATE,this._onFilterByState.bind(this)),this.listenTo(this.header,m.FILTER_BY_DATE,this._onFilterByDate.bind(this)),this.listenTo(this.header,m.SORT,this._onSort.bind(this)),this.listenTo(this.pagination,S.Events.CHANGE_PAGE,this._onChangePage.bind(this)),o.subscribe("SearchBar/search",this._onTopBarSearch.bind(this)),o.subscribe("SearchBar/clear",this._onTopBarClear.bind(this))},render(){let e;this.carts.isEmpty()?e=[this._createEmptyListMessage()]:(e=this._createQuoteCards().map((t=>t.render())),e.push(this.pagination.render())),e.unshift(this.header.render());const s=t.createElement("div",{class:"mpf-quote-list-content",html:e});this.container.setContent(s);try{new i({element:s}).inject(this.container)}catch(t){console.warn(t)}return this},destroy(){this.stopListening(),o.unsubscribe("SearchBar/search"),o.unsubscribe("SearchBar/clear"),this.header&&this.header.destroy(),this.pagination&&this.pagination.destroy(),this.header=null,this.pagination=null,this.carts=null,this.compassPortfolios=null,this.cartFactory=null,this.personFactory=null,this.cartQuoteFactory=null,this.invoiceFactory=null,this.companyFactory=null,this._parent(),this.container=null},_onChangePage(t={}){const e=t.page||1;this.fetchOptions.start=10*(e-1),this.header.container.scrollIntoView(!1),this._refreshCarts()},_onSort(t){this._resetPage(),t&&t.sort?this.fetchOptions[d.SORT]=t.sort:this.fetchOptions[d.SORT]=null,this._refreshCarts()},_onFilterByState(t){this._resetPage(),this.fetchOptions[h.FILTER_BY_STATE]=t[h.FILTER_BY_STATE],this._refreshCarts()},_onFilterByDate(t){switch(this._resetPage(),t.filter){case h.FILTER_BY_CREATION_DATE_DAYS:this._resetDateFilter(),this.fetchOptions[h.FILTER_BY_CREATION_DATE_DAYS]=t.days,this.header.setFilterActive(!0);break;case h.FILTER_BY_CREATION_DATE_MONTHS:this._resetDateFilter(),this.fetchOptions[h.FILTER_BY_CREATION_DATE_MONTHS]=t.months,this.header.setFilterActive(!0);break;case h.FILTER_BY_MODIFICATION_DATE_DAYS:this._resetDateFilter(),this.fetchOptions[h.FILTER_BY_MODIFICATION_DATE_DAYS]=t.days,this.header.setFilterActive(!0);break;case h.FILTER_BY_MODIFICATION_DATE_MONTHS:this._resetDateFilter(),this.fetchOptions[h.FILTER_BY_MODIFICATION_DATE_MONTHS]=t.months,this.header.setFilterActive(!0);break;case h.CLEAR:this._resetDateFilter(),this.header.setFilterActive(!1)}this._refreshCarts()},_resetDateFilter(){this.header.setFilterActive(!1),this.fetchOptions[h.FILTER_BY_CREATION_DATE_MONTHS]=null,this.fetchOptions[h.FILTER_BY_CREATION_DATE_DAYS]=null,this.fetchOptions[h.FILTER_BY_MODIFICATION_DATE_DAYS]=null,this.fetchOptions[h.FILTER_BY_MODIFICATION_DATE_MONTHS]=null},_refreshCarts(){return s.mask(this.container),this.carts.fetchPromise(t.clone(this.fetchOptions)).then(this.render.bind(this)).finally(s.unmask.bind(null,this.container))},_resetPage(){this.pagination.changePage(1,{silent:!0}),this.fetchOptions.start=0},_createPagination(){return new S({collection:this.carts,pageSize:10})},_createHeader(){return new p({carts:this.carts})},_createQuoteCards(){return this.carts.map((t=>{const e=new u({cart:t,compassPortfolios:this.compassPortfolios,cartFactory:this.cartFactory,personFactory:this.personFactory,cartQuoteFactory:this.cartQuoteFactory,companyFactory:this.companyFactory,invoiceFactory:this.invoiceFactory});return this.listenTo(e,u.Events.DISPLAY_CHECKOUT,(()=>{this.dispatchEvent(y.DISPLAY_CHECKOUT,{cart:t})})),e}))},_createEmptyListMessage:()=>t.createElement("div",{class:"mpf-message",html:[t.createElement("i",{class:"fonticon fonticon-doc-log"}),t.createElement("h4",{text:C.get("quoteListEmpty")}),t.createElement("p",{text:C.get("noQuotesMatchingSearchCriteria")})]}),_onTopBarSearch(t){document.body.getElementsByClassName("mpf-quote-list").length>0&&(this._resetPage(),this.fetchOptions.search=t,this._refreshCarts())},_onTopBarClear(){document.body.getElementsByClassName("mpf-quote-list").length>0&&(this._resetPage(),this.fetchOptions.search="",this._refreshCarts())},_checkPrototypes(t){n.requiredOfPrototype(t.cartQuoteFactory,r,"options.cartQuoteFactory must be a CartQuoteFactory"),n.requiredOfPrototype(t.invoiceFactory,a,"options.invoiceFactory must be an InvoiceFactory"),n.requiredOfPrototype(t.carts,l,"options.carts must be a CartCollection"),n.requiredOfPrototype(t.companyFactory,c,"options.companyFactory must be a CompanyFactory")}});return f.QUOTES_PER_PAGE=10,f.Events=y,f})),define("DS/MPFSubscriptionsComponent/paymentMethodsList/PaymentMethodsCards",["UWA/Core","UWA/Class/View","DS/MPFView/EmptyView","DS/MPFServices/ObjectService","DS/MPFPaymentMethodModel/PaymentMethodFactory","DS/MPFPspModel/PspModel","DS/MPFSubscriptionsComponent/paymentMethodsList/PaymentMethodsCardEntry","DS/MPFSubscriptionsComponent/paymentMethodsList/PaymentCardForm","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent"],((t,e,s,i,o,n,r,a,c)=>{"use strict";const l=Object.freeze({CARD_SELECTED:"cardSelected",PAYMENT_INFO_UPDATED:"paymentInfoUpdated"}),h=e.extend({className:"mpf-payment-methods-cards",setup(t={}){i.requiredOfPrototype(t.psp,n,"options.psp must be a PspModel"),i.requiredOfPrototype(t.paymentMethodFactory,o,"options.paymentMethodFactory must be a PaymentMethodFactory"),this.onlineInstanceId=t.onlineInstanceId,this.paymentMethodFactory=t.paymentMethodFactory,this.paymentCardTokens=t.paymentCardTokens||[],this.psp=t.psp,this.paymentCardEntries=this._createPaymentCardEntries(),this.newCardButton=this._createNewCardButton(),this.newCardFormComponent=this._createNewCardFormComponent()},render(){const e=this.paymentCardEntries.map((t=>t.render()));return e.unshift(t.createElement("div",{class:"mpf-payment-methods-cards-title mpf-title",text:c.get("yourCreditCards")})),this.psp.isCcAvenue()?e.push({tag:"div",class:"mpf-info-message",text:c.get("paymentCardManagementNotAvailable")}):(e.push(this.newCardButton),e.push(this.newCardFormComponent.render())),this.container.setContent(e),this},uncheckDefaultCard(){this.paymentCardEntries.forEach((t=>t.uncheck()))},_updateDefaultCard(t){this.paymentCardEntries.forEach((e=>{if(e!==t)return e.uncheck()})),this.dispatchEvent(l.CARD_SELECTED)},_createNewCardButton(){return t.createElement("button",{class:"btn btn-primary",text:c.get("addCard"),events:{click:this._onAddCard.bind(this)}})},_onAddCard(){this.newCardFormComponent.show(),this.newCardButton.hide()},_createNewCardFormComponent(){if(this.psp.isCcAvenue())return new s;{const t=this.paymentMethodFactory.createModel(o.Types.ME_ONLINE_INSTANCE),e=new a({title:c.get("addCard"),onlineInstanceId:this.onlineInstanceId,card:t,psp:this.psp});return e.hide(),this.listenTo(e,a.Events.PAYMENT_INFO_UPDATED,this.dispatchEvent.bind(this,l.PAYMENT_INFO_UPDATED)),this.listenTo(e,a.Events.CANCEL,this.newCardButton.show.bind(this.newCardButton)),e}},destroy(){this.stopListening(this.newCardFormComponent),this.newCardFormComponent.destroy(),this.newCardFormComponent=null,this.paymentCardEntries.forEach((t=>t.destroy())),this.paymentCardEntries=null,this.paymentCardTokens=null,this._parent(),this.container=null},_createPaymentCardEntries(){return this.paymentCardTokens.map((t=>{const e=new r({onlineInstanceId:this.onlineInstanceId,psp:this.psp,card:t});return this.listenTo(e,r.Events.CARD_SELECTED,this._updateDefaultCard.bind(this)),this.listenTo(e,r.Events.PAYMENT_INFO_UPDATED,this.dispatchEvent.bind(this,l.PAYMENT_INFO_UPDATED)),e}))}});return h.Events=l,h})),define("DS/MPFSubscriptionsComponent/quoteList/QuoteListFactory",["UWA/Promise","DS/MPFConnector/MarketplaceConnector","DS/MPFServices/MarketplaceServices","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFCartModel/CartFactory","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartFilters","DS/MPFModel/CollectionFetchOptions","DS/MPFSubscriptionsComponent/quoteList/QuoteList","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],((t,e,s,i,o,n,r,a,c)=>{"use strict";function l(e){const s=i.getInstance(e);return t.all([s.getFactory(i.Types.CART),s.getFactory(i.Types.CART_QUOTE),s.getFactory(i.Types.COMPANY),s.getFactory(i.Types.ADDRESS),s.getFactory(i.Types.INVOICE),s.getFactory(i.Types.PERSON)])}function h(e,s){const i=s[0],l=s[1],h=s[2],d=s[3],p=s[4],u=s[5];return h.addressFactory=d,function(t,e){const s=t.createCollection(o.Types.ME_V2,[],{modelDataProxy:t.getDataProxy(o.Types.CART)}),i={expand:[n.Expands.CART_ITEMS],start:0,size:c.QUOTES_PER_PAGE};return i[r.FILTER_BY_STATE]=r.STATE_PENDING_FILTER,i[a.ONLINEINSTANCE]=e,s.fetchPromise(i)}(i,e).then((e=>t.all([e,i,u,d,l,p,h])))}function d({compassPortfolios:t},e){const s=e[0],i=e[1],o=e[2],n=e[3],r=e[4],a=e[5],l=e[6];return new c({carts:s,cartFactory:i,personFactory:o,addressFactory:n,cartQuoteFactory:r,companyFactory:l,invoiceFactory:a,compassPortfolios:t})}return{fromSubscriptions:({onlineInstanceId:t,connector:i,compassPortfolios:o})=>{const n={compassPortfolios:o};return function(t){return t?Promise.resolve(t):e.fetchPromise({service:s.SUBSCRIPTIONS})}(i).then(l).then(h.bind(null,t)).then(d.bind(null,n))}}})),define("DS/MPFSubscriptionsComponent/roleList/StopRenewalModal",["UWA/Class/View","UWA/Core","DS/UIKIT/Mask","DS/UIKIT/Modal","DS/UIKIT/Alert","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartFactory","DS/MPFSubscriptionModel/SubscriptionModel","DS/MPFSubscriptionModel/SubscriptionCollection","DS/MPFSubscriptionModel/SubscriptionFactory","DS/MPFSubscriptionsComponent/roleList/StopRenewalSchemeSection","DS/MPFSubscriptionsComponent/roleList/ConfirmRenewalStopModal","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent"],(function(t,e,s,i,o,n,r,a,c,l,h,d,p,u){"use strict";const m=Object.freeze({STOPPED_ALL_RENEWABLE:"stoppedAllRenewable"}),S=t.extend({className:"mpf-stop-renewal-modal",setup({subscriptionFactory:t,cartFactory:e,onlineInstanceId:s,locale:i}){n.requiredOfPrototype(t,h,"options.subscriptionFactory must be a SubscriptionFactory"),n.requiredOfPrototype(e,a,"options.cartFactory must be a CartFactory"),this.subscriptionFactory=t,this.cartFactory=e,this.onlineInstanceId=s,this.locale=i,this.sections=[],this.alert=this._createAlert(),this.confirmationModal=this._createConfirmationModal(),this.modal=this._createModal(),this.overlay=this._createOverlay()},render(){return this.container.setContent([this.modal,this.overlay]),this.overlay.hide(),this},show({product:t,subscriptions:e,riskStoppingLast3DSwymer:s}={}){return this.riskStoppingLast3DSwymer=s,this._createContent({product:t,subscriptions:e}),this.modal.show(),this.overlay.show(),this},hide(){return this.modal.hide(),this.overlay.hide(),this},setLoading(t=!0,e){const i=this.modal.getBody();t?s.mask(i,e):s.unmask(i)},destroy(){this.stopListening(),this._destroySections(),this.overlay=null,this.riskStoppingLast3DSwymer=null,this._parent(),this.container=null},async _stopRenewal({subscriptions:t,subscription:e,product:s,quantity:i,reasons:o}){const n=this.subscriptionFactory.createModel(h.Types.UNSUBSCRIBE,{[c.Fields.QUANTITY]:i,[c.Fields.OFFER_ID]:e.getOfferId(),[c.Fields.END_DATE]:e.getEndDate(),[c.Fields.ONLINE_INSTANCE]:this.onlineInstanceId,[c.Fields.REASON]:o&&o.reason,[c.Fields.SUB_REASONS]:o&&o.subReasons,[c.Fields.COMMENT]:o&&o.comment});this.confirmationModal.hide(),this.setLoading(!0,u.get("creatingRenewalStopRequest"));try{await n.savePromise(),await this._waitForAnnulationDelivered(n,35e3,2e3),await t.fetchPromise(),this.setLoading(!1),this._createContent({product:s,subscriptions:t}),this.alert.add({className:"success",message:u.get("stopRenewalRequestCreated")}).show();const e=t.find((t=>t.getStatus()===c.Status.TO_RENEW));e||this.dispatchEvent(m.STOPPED_ALL_RENEWABLE,s)}catch(t){this.setLoading(!1),console.error(t);const s=t&&t.response&&t.response.errorCode;let i;i="Error.AfterStopDeadline"===s?this._createErrorMessage(e.getLicensingScheme()):"Error.unsubscribeprocessing"===s?u.get("stopRenewalProcessingError"):u.get("technicalErrorContactSupport"),this.alert.add({className:"error",message:i}).show()}},async _waitForAnnulationDelivered(t,e,s){const i=this.cartFactory.createModel(a.Types.CART,{id:t.getCartId()});let o=0;for(;i.getState()!==r.States.DELIVERED&&o<e;)await this._fetchCartAndWait(i,s),o+=s},_fetchCartAndWait:(t,e)=>new Promise((s=>t.fetchPromise().then((()=>{setTimeout(s,e)})))),_createContent({product:t,subscriptions:e}){n.requiredOfPrototype(e,l,"options.subscrpitions must be a SubscriptionCollection"),this._destroySections(),this.sections=this._createSections({subscriptions:e,product:t});const s=e.some((t=>t.isCancellationInProcess()));this.modal.setHeader({tag:"h4",text:u.get("manageSubsription")}),this.modal.setBody([this.confirmationModal.render(),this.alert,s&&this._createProcessingInfo(),{tag:"div",class:"mpf-product-title",text:t.getDisplayName()},...this.sections.map((t=>t.render()))])},_createSections({subscriptions:t,product:e}){const s=[];t.pluck(c.Fields.LICENSING_SCHEME).forEach((t=>{-1===s.indexOf(t)&&s.push(t)}));let i=this.riskStoppingLast3DSwymer;if(i){t.filter((t=>t.getStatus()===c.Status.TO_RENEW)).length>1&&(i=!1)}return s.map((s=>{const o=new d({product:e,subscriptions:t,scheme:s,locale:this.locale});return this.listenTo(o,d.Events.STOP_RENEWAL,(({subscription:s,quantity:o})=>{this.confirmationModal.show({subscriptions:t,subscription:s,product:e,quantity:o,riskStoppingLast3DSwymer:i})})),o}))},_destroySections(){this.sections.forEach((t=>{t.destroy(),this.stopListening(t)}))},_createModal(){return new i({events:{onHide:()=>{this.overlay.hide()}}})},_createConfirmationModal(){const t=new p;return this.listenTo(t,p.Events.STOP_RENEWAL,this._stopRenewal.bind(this)),t},_createAlert:()=>new o({visible:!1,autoHide:!0,hideDelay:5e3}),_createErrorMessage:t=>"YSC"===t||"QSC"===t||"QRC"===t||"MSC"===t?u.get("unableToStopRenewalYearlyQuaterlyMonthly"):u.get("unableToStopRenewal"),_createProcessingInfo:()=>({tag:"div",class:"alert-message alert-warning alert-has-icon",html:[{tag:"span",class:"icon fonticon"},u.get("cartCancellationInProcessInfo")]}),_createOverlay:()=>e.createElement("div",{class:"modal-overlay"})});return S.Events=m,S})),define("DS/MPFSubscriptionsComponent/MyOrdersTab",["UWA/Core","UWA/Class/View","DS/UIKIT/Mask","DS/MPFSubscriptionsComponent/quoteList/QuoteListFactory","DS/MPFSubscriptionsComponent/quoteList/QuoteList","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],((t,e,s,i,o)=>{"use strict";const n=Object.freeze({DISPLAY_CHECKOUT:"displayCheckout"}),r=e.extend({className:"mpf-my-orders-tab",setup(t={}){this._parent(t),this.connector=t.connector,this.onlineInstanceId=t.onlineInstanceId,this.compassPortfolios=t.compassPortfolios},render(){return t.is(this.quoteList)?this.container.setContent(this.quoteList.render()):(s.mask(this.container),i.fromSubscriptions({connector:this.connector,onlineInstanceId:this.onlineInstanceId,compassPortfolios:this.compassPortfolios}).then((t=>{this.quoteList=t,this.listenTo(this.quoteList,o.Events.DISPLAY_CHECKOUT,(async({cart:t})=>{this.dispatchEvent(n.DISPLAY_CHECKOUT,{cart:t})})),this.container.setContent(this.quoteList.render())})).finally((()=>{s.unmask(this.container)}))),this},refresh(){if(t.is(this.quoteList))return this.quoteList._refreshCarts().then(this.render())},destroy(){this.stopListening(),this.compassPortfolios=null,this._parent(),this.container=null}});return r.Events=n,r})),define("DS/MPFSubscriptionsComponent/roleList/RoleListComponent",["UWA/Core","UWA/Class/View","DS/UIKIT/Mask","DS/UIKIT/Alert","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFProductModel/ProductCollection","DS/MPFCartModel/CartFactory","DS/MPFSubscriptionModel/SubscriptionFactory","DS/MPFSubscriptionsComponent/roleList/ActiveSubscriptionCard","DS/MPFSubscriptionsComponent/roleList/StopRenewalModal","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],((t,e,s,i,o,n,r,a,c,l,h,d)=>{"use strict";return e.extend({className:"mpf-role-list",setup(t={}){o.requiredOfPrototype(t.cart,n,"options.cart must be a CartModel"),o.requiredOfPrototype(t.products,r,"options.products must be a ProductCollection"),o.requiredOfPrototype(t.marketplaceOffers,r,"options.marketplaceOffers must be a ProductCollection"),o.requiredOfPrototype(t.cartFactory,a,"options.cartFactory must be a CartFactory"),o.requiredOfPrototype(t.subscriptionFactory,c,"options.subscriptionFactory must be a SubscriptionFactory"),this.products=t.products,this.marketplaceOffers=t.marketplaceOffers,this.compassPortfolios=t.compassPortfolios,this.cart=t.cart,this.cartFactory=t.cartFactory,this.subscriptionFactory=t.subscriptionFactory,this.legalEntityId=t.legalEntityId,this.locale=t.locale,this.renewedIFWCount=this._getRenewedIFWCount(),this.alert=this._createAlert(),this.cards=this._createCards(),this.stopRenewalModal=this._createStopRenewalModal()},render(){const e=t.createElement("div",{class:"mpf-subs-title",html:d.get("activeSubscriptions")}),s=t.createElement("div",{class:"mpf-title-header",html:e}),i=t.createElement("div",{class:"mpf-roles",html:this.cards.map((t=>t.render()))});return this.container.setContent([this.stopRenewalModal.render(),s,i]),this},disableBuyMorePeriodicity(t){this.cards.forEach((e=>e.disableBuyMorePeriodicity(t)))},enableBuyMoreAllPeriodicities(){this.cards.forEach((t=>t.enableBuyMoreAllPeriodicities()))},destroy(){this.stopListening(),this.cards.forEach((t=>{t.destroy()})),this.products=null,this.marketplaceOffers=null,this.cart=null,this.cards=null,this.renewedIFWCount=null,this._parent(),this.container=null},async _showManageSubscriptionsModal(t){s.mask(this.container);try{const e=this.subscriptionFactory.createCollection(c.Types.CATALOGUE_SUBSCRIPTIONS,[],{parentResourceId:t.getName()});e.onlineInstanceId=this.products.onlineInstanceId,await e.fetchPromise(),this.stopRenewalModal.show({product:t,subscriptions:e,riskStoppingLast3DSwymer:this._isOrHasIFW(t)&&1===this.renewedIFWCount})}catch(t){console.error(t),this.alert.add({className:"error",message:d.get("unableToLoadSubscriptionData")})}s.unmask(this.container)},_createAlert:()=>new i({visible:!1,autoHide:!0,hideDelay:5e3}),_createCards(){return[...this.products.toArray(),...this.marketplaceOffers.toArray()].map((t=>{t.onlineInstanceId=this.products.onlineInstanceId;const e=new l({product:t,cart:this.cart,compassPortfolios:this.compassPortfolios,subscriptionFactory:this.subscriptionFactory,legalEntityId:this.legalEntityId});return this.listenTo(e,l.Events.MANAGE_SUBSCRIPTIONS,(()=>{this._showManageSubscriptionsModal(t)})),e}))},_createStopRenewalModal(){const t=new h({cartFactory:this.cartFactory,subscriptionFactory:this.subscriptionFactory,onlineInstanceId:this.products.onlineInstanceId,locale:this.locale});return this.listenTo(t,h.Events.STOPPED_ALL_RENEWABLE,(t=>{this._isOrHasIFW(t)&&this.renewedIFWCount--})),t},_getRenewedIFWCount(){let t=0;return this.marketplaceOffers.forEach((e=>{e.hasRenewableIFW()&&t++})),this.products.forEach((e=>{e.hasRenewableIFW()&&t++})),t},_isOrHasIFW:t=>t.getName().includes("IFW")||t.isMarketplaceOffer()})})),define("DS/MPFSubscriptionsComponent/paymentMethodsList/PaymentMethodsBankTransfer",["UWA/Class/View","UWA/Core","DS/UIKIT/Input/Toggle","DS/UIKIT/Input/Button","DS/MPFFiniteStateMachine/FiniteStateMachine","DS/MPFServices/ObjectService","DS/MPFPspModel/PspModel","DS/MPFPaymentMethodModel/PaymentMethodModel","DS/MPFSubscriptionsComponent/paymentMethodsList/PaymentMethodsVirtualIbanEntry","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent"],((t,e,s,i,o,n,r,a,c,l)=>{"use strict";const h=Object.freeze({BANK_TRANSFER_SELECTED:"bankTransferSelected"}),d=Object.freeze({MSG_DISPLAYED:"msgDisplayed",MSG_NOT_DISPLAYED:"msgNotDisplayed"}),p=t.extend({className:"mpf-payment-methods-bank-transfer",setup(t={}){this._checkPrototypes(t),this.onlineInstanceId=t.onlineInstanceId,this.paymentMethodModel=t.paymentMethodModel,this.virtualIbans=t.virtualIbans,this.psp=t.psp,this.stateMachine=this._createStateMachine(),this.toggle=this._createToggleEntry(),this.selectedEntry=this._createSelectedEntry(),this.virtualIbanCards=this._createVirtualIbanCards(),this.displayButton=this._createDisplayButton(),this.bankAccount=this._getBankAccount()},render(){const t=[{tag:"div",class:"mpf-payment-methods-bt-title mpf-title",text:l.get("deferredPaymentOnInvoice")}];return this.psp.isCcAvenue()?t.push({tag:"div",class:"mpf-info-message",text:l.get("deferredPaymentManagementNotAvailable")}):t.push({tag:"div",class:"mpf-bt-entry",html:[this.toggle,{tag:"div",class:"mpf-bt-entry-right",html:[this.selectedEntry,this.displayButton]}]}),this.stateMachine.getState()===d.MSG_DISPLAYED&&t.push(this.bankAccount),this.container.setContent(t),this},uncheck(){return this.selectedEntry.setText(""),this.toggle.uncheck()},_setBankTransferAsDefaultPaymentMethod(){const t={};return t[a.Fields.PAYMENT_METHOD_TYPE]=a.PaymentMethodTypes.DBT,this.paymentMethodModel.setParentResourceId(this.onlineInstanceId),this.paymentMethodModel.savePromise(t,{patch:!0}).then((()=>{this.selectedEntry.setText(l.get("defaultPaymentMethod")),this.dispatchEvent(h.BANK_TRANSFER_SELECTED,this)})).catch(this.uncheck.bind(this))},_getBankAccount(){const t=new i({className:"primary",value:l.get("gotIt"),events:{onClick:()=>{this.stateMachine.changeState(d.MSG_NOT_DISPLAYED),this.render()}}}),s=e.createElement("div",{class:"mpf-bt-entry-msg-header",html:[{tag:"div",text:l.get("importantMessage")},t]}),o=e.createElement("div",{class:"mpf-virtual-ibans",html:this.virtualIbanCards.map((t=>t.render()))}),n=e.createElement("div",{class:"mpf-bt-entry-msg-content",html:[{tag:"div",class:"fonticon fonticon-alert"},{tag:"div",text:l.get("selectDeferredPayment")}]});return e.createElement("div",{class:"mpf-bt-entry-msg",html:[s,o,n]})},_createVirtualIbanCards(){return this.virtualIbans.map((t=>new c({virtualIban:t})))},_createSelectedEntry(){const t=this.paymentMethodModel.isDefaultPaymentMethod()?l.get("defaultPaymentMethod"):"";return e.createElement("div",{class:"mpf-bt-selected",text:t})},_createDisplayButton(){return new i({className:"link",value:l.get("displayBankAccount"),events:{onClick:()=>{this.stateMachine.changeState(d.MSG_DISPLAYED),this.render()}}})},_createToggleEntry(){return new s({type:"radio",value:l.get("deferredPayment"),checked:this.paymentMethodModel.isDefaultPaymentMethod(),className:"primary",id:"bankTransfer",events:{onChange:this._setBankTransferAsDefaultPaymentMethod.bind(this)}})},_createStateMachine:()=>new o({state:d.MSG_NOT_DISPLAYED,states:[d.MSG_DISPLAYED,d.MSG_NOT_DISPLAYED],transitions:[{from:d.MSG_NOT_DISPLAYED,to:d.MSG_DISPLAYED},{from:d.MSG_DISPLAYED,to:d.MSG_NOT_DISPLAYED}]}),_checkPrototypes(t){n.requiredOfPrototype(t.paymentMethodModel,a,"options.paymentMethodModel must be a PaymentMethodModel"),n.requiredOfPrototype(t.psp,r,"options.psp must be a PspModel")},destroy(){this.virtualIbans=null,this.psp=null,this._parent(),this.container=null}});return p.Events=h,p})),define("DS/MPFSubscriptionsComponent/SubscriptionsTab",["UWA/Core","UWA/Class/View","DS/UIKIT/Mask","DS/UIKIT/Alert","DS/UIKIT/Scroller","DS/UIKIT/Input/Button","DS/MPFServices/ObjectService","DS/MPFServices/MarketplaceServices","DS/MPFError/ValidationError","DS/MPFFiniteStateMachine/FiniteStateMachine","DS/MPFClickAndBuyComponent/ClickAndBuyStateMachine","DS/MPFCartModel/CartFactory","DS/MPFCartModel/CartModel","DS/MPFPspModel/PspFactory","DS/MPFPortfolioModel/PortfolioCollection","DS/MPFProductModel/ProductCollection","DS/MPFSubscriptionsComponent/CartHelper","DS/MPFSubscriptionsComponent/roleList/RoleListComponent","DS/MPFSubscriptionsComponent/offerList/OfferListComponent","DS/MPFClickAndBuyComponent/ClickAndBuyCartHelper","DS/MPFClickAndBuyComponent/orderList/OrderList","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],((t,e,s,i,o,n,r,a,c,l,h,d,p,u,m,S,C,y,f,M,_,P)=>{"use strict";const E=Object.freeze({PORTFOLIO:"portfolio",QUOTE:"quote"}),I=Object.freeze({DISPLAY_CHECKOUT:"displayCheckout"}),b=e.extend({className:"mpf-subs-tab",setup(t={}){this._parent(t),this._checkPrototypes(t),this.legalEntityId=t.legalEntityId,this.offers=t.offers,this.products=t.products,this.marketplaceOffers=t.marketplaceOffers,this.compassPortfolios=t.compassPortfolios,this.countries=t.countries,this.locale=t.locale,this.cartFactory=t.cartFactory,this.cartItemFactory=t.cartItemFactory,this.portfolioFactory=t.portfolioFactory,this.couponFactory=t.couponFactory,this.subscriptionFactory=t.subscriptionFactory,this.me=t.me,this.taxEstimation=t.taxEstimation,this.selectedCountry=t.selectedCountry,this.pspFactory=t.pspFactory,this.cart=this.cartFactory.createModel(d.Types.ME),this.fetchingCatalogue=!1,this.stateMachine=this._createStateMachine(),this.alert=this._createAlert(),this.offerListComponent=this._createOfferListComponent(),this.roleListComponent=this._createRoleListComponent(),this.backButton=this._createBackButton(),this.viewQuoteButton=this._createViewQuoteButton(),this.listenTo(this.cart,"onChange:"+p.Fields.CART_ITEMS,this._updateButtonsAndFilter.bind(this))},render(){let e;this.stateMachine.getState()===E.PORTFOLIO?(e=[this.roleListComponent.render(),this.offerListComponent.render()],this.viewQuoteButton.show(),this.backButton.hide()):this.stateMachine.getState()===E.QUOTE&&(e=this.quoteDetailsComponent.render(),this.viewQuoteButton.hide(),this.backButton.show());const i=t.createElement("div",{class:"mpf-subs-content",html:[this.alert,e]}),n=t.createElement("div",{class:"mpf-subs-footer",html:[this.viewQuoteButton,this.backButton]});this.container.setContent([i,n]);try{new o({element:i}).inject(this.container)}catch(t){console.warn(t)}return this.fetchingCatalogue&&s.mask(this.container),this},setFetchingCatalogueVariable(t){this.fetchingCatalogue=!0===t},_createQuote(){const t={};return t[p.Fields.STATE]=p.States.SUBMITTED,C.modifyQuantitiesItemsOnQuote(this.cart).then(this.cart.savePromise.bind(this.cart,t,{patch:!0}))},_onBack(){if(this.cart.getItems().length>0)return this.backButton.load(),C.modifyQuantitiesItemsOnQuote(this.cart).then(this.stateMachine.changeState.bind(this.stateMachine,E.PORTFOLIO)).then(this.render.bind(this)).finally((()=>{this.quoteDetailsComponent&&this.quoteDetailsComponent.destroy(),this.backButton.load(!1)}));this.stateMachine.changeState(E.PORTFOLIO),this.render()},_displayQuote(){return this.viewQuoteButton.load(),this.cart.fetchPromise({expand:[p.Expands.CART_ITEMS]}).then(this._createQuoteDetailsComponent.bind(this)).then(this.stateMachine.changeState.bind(this.stateMachine,E.QUOTE)).then(this.render.bind(this)).finally(this.viewQuoteButton.load.bind(this.viewQuoteButton,!1))},_updateButtonsAndFilter(){if(!this.isLoadingCheckout){const t=this.cart.getItems();let e,i;if(s.unmask(this.container),t.length>0){const s=t[0].getLicensingScheme();e=t.reduce((function(t,e){return t+=parseInt(e.getQuantity(),10)}),0),this.roleListComponent.disableBuyMorePeriodicity(s),this.offerListComponent.setPeriodicityFilterValue(s),this.offerListComponent.filterOnPeriodicity(s),this.offerListComponent.disablePeriodicityFilter(),i=P.get("viewQuoteNbItems",{nb:e})}else e=0,this.roleListComponent.enableBuyMoreAllPeriodicities(),this.offerListComponent.enablePeriodicityFilter(),i=P.get("viewQuote");this.viewQuoteButton.setDisabled(0===e),this.viewQuoteButton.setValue(i)}},async _createQuoteDetailsComponent(){const t=new h({page:h.Pages.CART,cookieKey:"swymlang",localStorageKey:"mpfSubscriptionsCountry",doChangeUrls:!1,me:this.me,countries:this.countries,service:a.SUBSCRIPTIONS}),e=this.pspFactory.createModel(u.Types.PARAM_PSP);this.quoteDetailsComponent=new _({stateMachine:t,psp:e,taxEstimation:this.taxEstimation,compassPortfolios:this.compassPortfolios,service:a.SUBSCRIPTIONS,cartFactory:this.cartFactory,cartItemFactory:this.cartItemFactory,portfolioFactory:this.portfolioFactory,couponFactory:this.couponFactory,countries:this.countries,showPageHeader:!0,showCountrySelect:!1}),this.listenTo(this.quoteDetailsComponent,_.Events.DISPLAY_CHECKOUT,this._displayCheckout.bind(this)),this.listenTo(this.quoteDetailsComponent,_.Events.ADD_ADDITIONAL_ITEMS,this._onBack.bind(this)),await this.quoteDetailsComponent.load({loadedCart:this.cart})},_createRoleListComponent(){return new y({cart:this.cart,legalEntityId:this.legalEntityId,products:this.products,marketplaceOffers:this.marketplaceOffers,compassPortfolios:this.compassPortfolios,cartFactory:this.cartFactory,subscriptionFactory:this.subscriptionFactory,locale:this.locale})},_createOfferListComponent(){return new f({cart:this.cart,compassPortfolios:this.compassPortfolios,legalEntityId:this.legalEntityId,offers:this.offers})},_createBackButton(){return new n({value:P.get("back"),events:{onClick:this._onBack.bind(this)}})},async _displayCheckout(){try{s.mask(this.container),await this._checkCartMaxChargeCompliance(),await C.modifyQuantitiesItemsOnQuote(this.cart),s.unmask(this.container),this.dispatchEvent(I.DISPLAY_CHECKOUT,{cart:this.cart})}catch(t){let e;s.unmask(this.container),console.error(t),e=t&&t instanceof c&&"MaxChargeExceeded"===t.errorCode?P.get("maxChargeExceeded"):P.get("errorSavingCart"),this.alert.add({className:"error",message:e}).show()}},async _checkCartMaxChargeCompliance(){const t=this.pspFactory.createModel(u.Types.PARAM_PSP),e=await M.loadCartItemPortfolios({cart:this.cart,country:this.selectedCountry,portfolioFactory:this.portfolioFactory});return M.checkCartMaxChargeCompliance({portfolios:e,psp:t,cart:this.cart,country:this.selectedCountry,service:a.SUBSCRIPTIONS})},_createViewQuoteButton(){return new n({className:"primary",value:P.get("viewQuote"),disabled:!0,icon:"shopping-cart",events:{onClick:this._displayQuote.bind(this)}})},_createStateMachine:()=>new l({state:E.PORTFOLIO,states:[E.PORTFOLIO,E.QUOTE],transitions:[{from:E.PORTFOLIO,to:E.QUOTE},{from:E.QUOTE,to:E.PORTFOLIO}]}),_createAlert:()=>new i({visible:!1,closable:!0,autoHide:!1}),_getLocale(){return"EUR"===this.cart.getCurrency()?"fr-FR":"en-US"},_checkPrototypes(t){r.requiredOfPrototype(t.products,S,"options.products must be a ProductCollection"),r.requiredOfPrototype(t.offers,m,"options.offers must be an PortfolioCollection"),r.requiredOfPrototype(t.cartFactory,d,"options.cartFactory must be a CartFactory")}});return b.Events=I,b})),define("DS/MPFSubscriptionsComponent/PaymentMethodsTab",["UWA/Class/View","UWA/Core","DS/UIKIT/Scroller","DS/UIKIT/Mask","DS/MPFView/EmptyView","DS/MPFServices/ObjectService","DS/MPFPaymentMethodModel/PaymentMethodFactory","DS/MPFPaymentMethodModel/PaymentMethodCollection","DS/MPFPspModel/PspModel","DS/MPFSubscriptionsComponent/paymentMethodsList/PaymentMethodsCustomerInformation","DS/MPFSubscriptionsComponent/paymentMethodsList/PaymentMethodsCards","DS/MPFSubscriptionsComponent/paymentMethodsList/PaymentMethodsBankTransfer","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent"],((t,e,s,i,o,n,r,a,c,l,h,d,p)=>{"use strict";return t.extend({className:"mpf-payments-tab",setup(t={}){this._checkPrototypes(t),this.paymentMethodFactory=t.paymentMethodFactory,this.buyer=t.buyer,this.onlineInstanceId=t.onlineInstanceId,this.paymentMethods=t.paymentMethods,this.psp=t.psp,this.companyInformation=t.companyInformation,this.virtualIbans=t.virtualIbans,this.choosePaymentMethodTitle=this._createChoosePaymentMethodTitle(),this.customerInformations=this._createCustomerInformation(),this.paymentCardList=this._createPaymentCardList(),this.bankTransferList=this._createBankTransferList(),this.renewalNoticeMessage=this._createRenewalNoticeMessage()},render(){const t=e.createElement("div",{class:"mpf-payments-tab-content",html:[this.customerInformations.render(),this.choosePaymentMethodTitle,this.paymentCardList.render(),this.bankTransferList.render(),this.renewalNoticeMessage]});this.container.setContent(t);try{new s({element:t}).inject(this.container)}catch(t){console.warn(t)}return this},destroy(){this.customerInformations.destroy(),this.paymentCardList.destroy(),this.bankTransferList.destroy(),this._parent(),this.container=null},_refresh(){i.mask(this.container),setTimeout((()=>this.paymentMethods.fetchPromise().then((()=>{this.paymentCardList=this._createPaymentCardList(),this.bankTransferList=this._createBankTransferList(),this.render()})).finally(i.unmask.bind(i,this.container))),2e3)},_createChoosePaymentMethodTitle:()=>e.createElement("h3",{class:"mpf-title",text:p.get("chooseYourPaymentMethod")}),_createRenewalNoticeMessage(){const t=e.createElement("div",{class:"mpf-notice-renewal-title",text:p.get("defaultPaymentAndRenewal")}),s=e.createElement("div",{class:"mpf-notice-renewal-content",html:[{tag:"p",text:p.get("defaultPaymentAndRenewalContentPart1")},{tag:"p",text:p.get("defaultPaymentAndRenewalContentPart2")}]});return e.createElement("div",{class:"mpf-notice-renewal",html:[t,s]})},_createCustomerInformation(){return new l({buyer:this.buyer,onlineInstanceId:this.onlineInstanceId,companyInformation:this.companyInformation})},_createPaymentCardList(){const t=new h({onlineInstanceId:this.onlineInstanceId,paymentMethodFactory:this.paymentMethodFactory,paymentCardTokens:this.paymentMethods.getPaymentCardTokenModels(),psp:this.psp});return this.listenTo(t,h.Events.CARD_SELECTED,(()=>{this.bankTransferList.uncheck()})),this.listenTo(t,h.Events.PAYMENT_INFO_UPDATED,this._refresh.bind(this)),t},_createBankTransferList(){const t=this.paymentMethods.getDbtPaymentMethodModel();if(e.is(t)){const t=new d({onlineInstanceId:this.onlineInstanceId,paymentMethodModel:this.paymentMethods.getDbtPaymentMethodModel(),virtualIbans:this.virtualIbans,psp:this.psp});return this.listenTo(t,d.Events.BANK_TRANSFER_SELECTED,this.paymentCardList.uncheckDefaultCard.bind(this.paymentCardList)),t}return o.getInstance()},_checkPrototypes(t){n.requiredOfPrototype(t.paymentMethodFactory,r,"options.paymentMethodFactory must be a PaymentMethodFactory"),n.requiredOfPrototype(t.paymentMethods,a,"options.paymentMethods must be a PaymentMethodCollection"),n.requiredOfPrototype(t.psp,c,"options.psp must be a PspModel")}})})),define("DS/MPFSubscriptionsComponent/SubscriptionsComponent",["UWA/Class/View","UWA/Core","DS/UIKIT/Toggler","DS/UIKIT/Mask","DS/MPFUrl/UrlUtils","DS/MPFServices/ObjectService","DS/MPFCartModel/CartFactory","DS/MPFCartModel/CartModel","DS/MPFPaymentMethodModel/PaymentMethodFactory","DS/MPFCatalogueModel/CatalogueModel","DS/MPFPaymentMethodModel/PaymentMethodCollection","DS/MPFPspModel/PspModel","DS/MPFFiniteStateMachine/FiniteStateMachine","DS/MPFSubscriptionsComponent/SubscriptionsTab","DS/MPFSubscriptionsComponent/MyOrdersTab","DS/MPFSubscriptionsComponent/PaymentMethodsTab","DS/MPFSubscriptionsComponent/SubscriptionsCheckout","DS/MPFSubscriptionsComponent/PaymentResultPage","DS/Usage/TrackerAPI","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],((t,e,s,i,o,n,r,a,c,l,h,d,p,u,m,S,C,y,f,M)=>{"use strict";const _=Object.freeze({SUBSCRIPTIONS:"subscriptions",CHECKOUT:"checkout",PAYMENT_RESULT:"paymentResult"}),P=Object.freeze({GO_TO_MY_ORDERS:"goToMyOrders"}),E=Object.freeze({PAGE_SUBSCRIPTION:"Subcription",PAGE_MY_ORDERS:"MyOrders",PAGE_PAYMENT_METHODS:"PaymentMethods"}),I=Object.freeze({0:"Subscriptions",1:"MyOrders",2:"PaymentMethods"}),b=Object.freeze({Subscriptions:0,MyOrders:1,PaymentMethods:2}),T=t.extend({className:"mpf-subscriptions",setup(t={}){this._parent(t),this._checkPrototypes(t),this.connector=t.connector,this.cartFactory=t.cartFactory,this.cartItemFactory=t.cartItemFactory,this.paymentMethodFactory=t.paymentMethodFactory,this.me=t.me,this.buyer=t.buyer,this.catalogue=t.catalogue,this.compassPortfolios=t.compassPortfolios,this.onlineInstanceId=t.onlineInstanceId,this.paymentMethods=t.paymentMethods,this.psp=t.psp,this.taxEstimation=t.taxEstimation,this.paymentMethodsNotAllowed=!0===t.paymentMethodsNotAllowed,this.companyInformation=t.companyInformation,this.virtualIbans=t.virtualIbans,this.countries=t.countries,this.selectedCountry=t.selectedCountry,this.locale=t.locale,this.portfolioFactory=t.portfolioFactory,this.couponFactory=t.couponFactory,this.pspFactory=t.pspFactory,this.subscriptionFactory=t.subscriptionFactory,this.products=this._getProductsFromCatalogue(),this.marketplaceOffers=this._getMarketplaceOffersFromCatalogue(),this.offers=this._getOffersFromCatalogue(this.products,this.marketplaceOffers),this.subscriptionsTab=this._createSubscriptionsTab(),this.myOrdersTab=this._createMyOrdersTab(),this.paymentMethodsTab=this._createPaymentMethodsTab(),this.currentTabContainer=this._createTabDisplayer(),this.tabs=this._initTabs(),this.navTab=this._initNavTab(),this.paymentResultPage=this._createPaymentResultPage(),this.stateMachine=this._createStateMachine()},render(){return this.stateMachine.getState()===_.SUBSCRIPTIONS?this.container.setContent([this.navTab,this.currentTabContainer]):this.stateMachine.getState()===_.PAYMENT_RESULT?this.container.setContent([this.paymentResultPage.render()]):(this.container.setContent(this.subscriptionsCheckout),i.unmask(this.container)),this},destroy(){this.subscriptionsTab.destroy(),this.myOrdersTab.destroy(),this.paymentMethodsTab.destroy(),this.paymentResultPage.destroy(),this.subscriptionsTab=null,this.myOrdersTab=null,this.paymentMethodsTab=null,this.paymentResultPage=null,this.currentTabContainer=null,this.tabs=null,this.navTab=null,this.stateMachine=null,this.products=null,this.marketplaceOffers=null,this.offers=null,this.connector=null,this.cartFactory=null,this.cartItemFactory=null,this.paymentMethodFactory=null,this.me=null,this.buyer=null,this.catalogue=null,this.compassPortfolios=null,this.onlineInstanceId=null,this.paymentMethods=null,this.psp=null,this.companyInformation=null,this.virtualIbans=null,this.countries=null,this.selectedCountry=null,this.portfolioFactory=null,this.couponFactory=null,this.pspFactory=null,this.subscriptionFactory=null,this._parent(),this.container=null},_displayTab(t,e){switch(e){case 0:this._sendTrackingView(E.PAGE_SUBSCRIPTION);break;case 1:this._sendTrackingView(E.PAGE_MY_ORDERS);break;case 2:this._sendTrackingView(E.PAGE_PAYMENT_METHODS)}this.currentTabContainer.setContent(this.tabs[e].render()),this._updateHash(e)},_updateHash(t){const e=new URL(window.parent.location.href),s=e.hash.split("/tab:Subscriptions");e.hash=s[0]+"/tab:Subscriptions/"+I[t],window.parent.location.href=e.href},_getSelectedTabIdx(){const t=window.parent.location.hash.match(/\/tab:Subscriptions\/(\w+)/);return t&&t.length>0?b[t[1]]:0},_initTabs(){return this.paymentMethodsNotAllowed?[this.subscriptionsTab,this.myOrdersTab]:[this.subscriptionsTab,this.myOrdersTab,this.paymentMethodsTab]},_createTabDisplayer:()=>e.createElement("div",{class:"mpf-content-tab"}),_initNavTab(){const t=e.createElement("a",{class:"tab-item mpf-link-tab-item",html:[{tag:"span",class:"fonticon fonticon-shopping-cart"},{tag:"span",text:M.get("subscriptions")}]}),i=e.createElement("a",{class:"tab-item mpf-link-tab-item",html:[{tag:"span",class:"fonticon fonticon-task"},{tag:"span",text:M.get("myOrders")}]}),o=e.createElement("a",{class:"tab-item mpf-link-tab-item",html:[{tag:"span",class:"fonticon fonticon-credit-card"},{tag:"span",text:M.get("paymentMethods")}]}),n=this.paymentMethodsNotAllowed?[t,i]:[t,i,o],r=e.createElement("nav",{class:"tab tab-pills mpf-nav",html:n});return this.toggler=new s({container:r,selected:this._getSelectedTabIdx(),events:{onToggle:this._displayTab.bind(this)}}),r},_getProductsFromCatalogue(){const t=this.catalogue.getProducts();return t.onlineInstanceId=this.catalogue.onlineInstanceId,t},_getOffersFromCatalogue(t,e){const s=this._excludeOwnedEduOffers(this.catalogue.getOffers(),t,e);return s.onlineInstanceId=this.catalogue.onlineInstanceId,s},_excludeOwnedEduOffers(t,e,s){const i=e.map((t=>t.getProductTrigram()));s.forEach((t=>{const e=t.getIncludedProducts()||{};Object.keys(e).forEach((t=>i.push(t)))}));for(let e=t.size()-1;e>=0;--e){const s=t.at(e),o=s.getProductTrigram();o.endsWith("-AC")&&i.includes(o)&&t.remove(s)}return t},_getMarketplaceOffersFromCatalogue(){return this.catalogue.getMarketplaceOffers()},_createMyOrdersTab(){const t=new m({onlineInstanceId:this.onlineInstanceId,connector:this.connector,compassPortfolios:this.compassPortfolios});return this.listenTo(t,m.Events.DISPLAY_CHECKOUT,(async({cart:t})=>{i.mask(this.container),this.stateMachine.changeState(_.CHECKOUT);const e=await this._fetchCart({cart:t});this.subscriptionsCheckout=await this._createSubscriptionsCheckout({cart:e,parentPage:I[1]}).render(),this.render()})),t},_createSubscriptionsTab(){const t=new u({legalEntityId:this.catalogue.getCompanyID(),cartFactory:this.cartFactory,cartItemFactory:this.cartItemFactory,offers:this.offers,products:this.products,marketplaceOffers:this.marketplaceOffers,compassPortfolios:this.compassPortfolios,countries:this.countries,locale:this.locale,portfolioFactory:this.portfolioFactory,couponFactory:this.couponFactory,subscriptionFactory:this.subscriptionFactory,me:this.me,taxEstimation:this.taxEstimation,selectedCountry:this.selectedCountry,pspFactory:this.pspFactory});return this.listenTo(t,u.Events.DISPLAY_CHECKOUT,(async({cart:t})=>{i.mask(this.container),this.stateMachine.changeState(_.CHECKOUT);const e=await this._fetchCart({cart:t});this.subscriptionsCheckout=await this._createSubscriptionsCheckout({cart:e,parentPage:I[0]}).render(),this.render()})),t},_createPaymentMethodsTab(){if(!this.paymentMethodsNotAllowed)return new S({paymentMethodFactory:this.paymentMethodFactory,buyer:this.buyer,onlineInstanceId:this.onlineInstanceId,paymentMethods:this.paymentMethods,psp:this.psp,companyInformation:this.companyInformation,virtualIbans:this.virtualIbans})},async _refreshAndDisplayMyOrdersTab(){this.myOrdersTab.refresh(),this.toggler.toggle(1),this.subscriptionsTab.setFetchingCatalogueVariable(!0),await this.catalogue.fetchPromise(),this.offers=this._getOffersFromCatalogue(this.products,this.marketplaceOffers),this.products=this._getProductsFromCatalogue(),this.subscriptionsTab=this._createSubscriptionsTab(),this.tabs=this._initTabs(),0===this._getSelectedTabIdx()&&this.currentTabContainer.setContent(this.tabs[0].render()),this.stateMachine.changeState(_.SUBSCRIPTIONS),this.render(),this.subscriptionsCheckout&&this.subscriptionsCheckout.destroy()},_createSubscriptionsCheckout({cart:t,parentPage:e}){const s=new C({me:this.me,connector:this.connector,cart:t,parentPage:e});return this.listenTo(s,C.Events.BACK_TO_CART,(()=>{this.currentTabContainer.setContent(this.tabs[this._getSelectedTabIdx()].render()),this.stateMachine.changeState(_.SUBSCRIPTIONS),this.render(),this.subscriptionsCheckout&&this.subscriptionsCheckout.destroy()})),this.listenTo(s,C.Events.TO_PAYMENT_RESULT,(()=>{this.stateMachine.changeState(_.PAYMENT_RESULT),this.paymentResultPage.setCartId(t.get("id")),this.render()})),s},_createPaymentResultPage(){const t=new y({me:this.me,cartFactory:this.cartFactory,service:this.service});return this.listenTo(t,y.Events.GO_TO_MY_ORDERS,(async()=>{i.mask(this.container),await this._refreshAndDisplayMyOrdersTab(),i.unmask(this.container)})),this.listenTo(t,y.Events.GO_TO_SUBSCRIPTIONS_TAB,(()=>{this.stateMachine.changeState(_.SUBSCRIPTIONS),this.render()})),t},_fetchCart({cart:t}){return this.cartFactory.createModel(r.Types.CART,{id:t.get("id")}).fetchPromise({expand:[a.Expands.CART_ITEMS]})},_createStateMachine(){const t="payment-result"===new URL(window.parent.location.href).searchParams.get("mpfPage")?_.PAYMENT_RESULT:_.SUBSCRIPTIONS;return new p({state:t,states:[_.SUBSCRIPTIONS,_.CHECKOUT,_.PAYMENT_RESULT],transitions:[{from:_.SUBSCRIPTIONS,to:_.CHECKOUT},{from:_.CHECKOUT,to:_.SUBSCRIPTIONS},{from:_.CHECKOUT,to:_.PAYMENT_RESULT},{from:_.PAYMENT_RESULT,to:_.SUBSCRIPTIONS}]})},_checkPrototypes(t){n.requiredOfPrototype(t.paymentMethodFactory,c,"options.paymentMethodFactory must be a PaymentMethodFactory"),n.requiredOfPrototype(t.cartFactory,r,"options.cartFactory must be a CartFactory"),n.requiredOfPrototype(t.catalogue,l,"options.catalogue must be a CatalogueModel"),n.requiredOfPrototype(t.paymentMethods,h,"options.paymentMethods must be a PaymentMethodCollection"),n.requiredOfPrototype(t.psp,d,"options.psp must be a PspModel")},_sendTrackingView(t){f.trackPageView({pageURL:"/my-subscriptions",pageTitle:t})}});return T.Events=P,T})),define("DS/MPFSubscriptionsComponent/SubscriptionsWidgetWrapper",["UWA/Class/View","UWA/Promise","UWA/Utils","DS/UIKIT/Mask","DS/UIKIT/Modal","DS/UIKIT/Autocomplete","DS/UIKIT/Input/Button","DS/MPFConnector/MarketplaceConnector","DS/MPFServices/MarketplaceServices","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFPersonModel/PersonFactory","DS/MPFCountryModel/CountryFactory","DS/MPFCatalogueModel/CatalogueFactory","DS/MPFPersonModel/MePersonDataProxy","DS/MPFBuyer/Buyer","DS/MPFTaxModel/TaxEstimationFactory","DS/MPFPaymentMethodModel/PaymentMethodFactory","DS/MPFPspModel/PspFactory","DS/MPFConnector/AppsConnector","DS/MPFAppsPlatform/PublicPlatformsDataProxy","DS/MPFAppsPlatform/PlatformCollection","DS/MPFPortfolioModel/compass/CompassPortfolioCollection","DS/MPFPortfolioModel/compass/CompassPortfolioDataProxy","DS/MPFCompanyInformationModel/CompanyInformationModel","DS/MPFCompanyInformationModel/CompanyInformationFactory","DS/MPFVirtualIbanModel/VirtualIbanFactory","DS/MPFAppsPlatform/ServiceEnum","DS/MPFSubscriptionsComponent/SubscriptionsComponent","DS/MPFClickAndBuyComponent/MaintenancePage","DS/MPFError/NotSupportedError","DS/MPFSubscriptionsComponent/IfweLoopEngagementTenantPage","DS/MPFSubscriptionsComponent/OITypeNotSupportedPage","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/UIKIT/UIKIT","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],((t,e,s,i,o,n,r,a,c,l,h,d,p,u,m,S,C,y,f,M,_,P,E,I,b,T,g,F,D,A,O,v,N)=>{"use strict";return t.extend({init(t={}){this._parent(t),this.i3DXCompassPlatformServices=t.i3DXCompassPlatformServices,this.locale=t.locale||window.dsLang||this._getCookieValue("swymlang")||s.Client.Locale.lang,this.widget=t.widget,this.deferred=e.deferred(),this.promise=this.deferred.promise},inject(){this.widget.setBody(this.widgetComponent.render()),this.deferred=e.deferred(),this.promise=this.deferred.promise},whenReady(){return this._getOnlineInstance(),this.promise},refresh(){return this.onlineInstanceId=this.widget.getPreference("x3dPlatformId").value,this.widget.setTitle(this.onlineInstanceId),this.widget.setBody(""),i.mask(this.widget.body),e.all([this._fetchCatalogue(),this.paymentMethodsNotAllowed?e.resolve():this._fetchPaymentMethods()]).then(this._initWidgetComponent.bind(this)).then(this.inject.bind(this)).catch((async t=>{console.error(t);const e=new D;await e.load(),this.widget.setBody(e.render())})).finally((()=>{i.unmask(this.widget.body)}))},_getCookieValue(t){const e=document.cookie.match("(^|;)\\s*"+t+"\\s*=\\s*([^;]+)");return e&&e.length>0&&e.pop()},_initWidget(t){this._setWidgetPreferences(this.platforms),this._initWidgetComponent(),t.resolve()},_initWidgetComponent(){const t=this.taxEstimationFactory.createModel(S.Types.TAX_ESTIMATION);this.widgetComponent=new F({connector:this.mpConnector,cartFactory:this.cartFactory,cartItemFactory:this.cartItemFactory,paymentMethodFactory:this.paymentMethodFactory,pspFactory:this.pspFactory,me:this.me,buyer:this.buyer,catalogue:this.catalogue,compassPortfolios:this.compassPortfolios,onlineInstanceId:this.onlineInstanceId,paymentMethods:this.paymentMethods,psp:this.psp,taxEstimation:t,paymentMethodsNotAllowed:this.paymentMethodsNotAllowed,companyInformation:this.companyInformation,virtualIbans:this.virtualIbans,countries:this.countries,selectedCountry:this._getSelectedCountry(),locale:this.locale,portfolioFactory:this.portfolioFactory,couponFactory:this.couponFactory,subscriptionFactory:this.subscriptionFactory}),this.listenTo(this.widgetComponent,F.Events.GO_TO_MY_ORDERS,this._refreshAndDisplayOrders.bind(this))},_refreshAndDisplayOrders(){return this.refresh().then((()=>{this.widgetComponent.displayMyOrdersTab()}))},_fetchResources(t){return this._fetchConnector().then(this._initFactories.bind(this)).then(this._fetchCatalogue.bind(this)).then(this._fetchCompassRolesInfo.bind(this)).then(this._fetchMeAllowingCreation.bind(this)).then(this._fetchBuyer.bind(this)).then(this._fetchPsp.bind(this)).then(this._fetchCompanyInformation.bind(this)).then(this._fetchPaymentMethods.bind(this)).then(this._fetchVirtualIbans.bind(this)).then(this._fetchCountries.bind(this)).then(this._initWidget.bind(this,t)).catch((async e=>{let s;console.error(e),e.response&&e.response.errorCode&&e.response.errorCode===A.ErrorCodes.IFWELOOP_ENGAGEMENT_TENANT||e instanceof A&&e.errorCode&&e.errorCode===A.ErrorCodes.IFWELOOP_ENGAGEMENT_TENANT?s=new O:e.response&&e.response.errorCode&&"error.nothandledoitype"===e.response.errorCode?s=new v:(s=new D,await s.load()),this.widget.setBody(s.render()),t.reject()}))},async _fetchCompassRolesInfo(){const t=await new Promise(((t,e)=>{this.myAppsConnector.request(this.myAppsConnector.url("/infos/feature/compass"),{onComplete:t,onFailure:e})})),e=new f(t.portfolio);return this.compassPortfolios=new P([],{dataProxy:new E(e)}),this.compassPortfolios.fetchPromise()},_fetchCatalogue(){return this.catalogue=this.catalogueFactory.createModel(p.Types.CATALOGUE_V2),this.catalogue.onlineInstanceId=this.onlineInstanceId,this.catalogue.fetchPromise().then((t=>10===t.getCode()?e.reject("OEdown"):e.resolve(t)))},_initFactories(){return this.mpfFactories=l.getInstance(this.mpConnector),this.mpfFactories.getFactory(l.Types.SUBSCRIPTION).then((t=>e.all([this.mpfFactories.getFactory(l.Types.PORTFOLIO),this.mpfFactories.getFactory(l.Types.PRODUCT,{subscriptionFactory:t})]))).then((([t,s])=>e.all([this.mpfFactories.getFactory(l.Types.CATALOGUE,{portfolioFactory:t,productFactory:s}),this.mpfFactories.getFactory(l.Types.PERSON),this.mpfFactories.getFactory(l.Types.CART),this.mpfFactories.getFactory(l.Types.PAYMENT_METHOD),this.mpfFactories.getFactory(l.Types.PSP),this.mpfFactories.getFactory(l.Types.COMPANY_INFORMATION),this.mpfFactories.getFactory(l.Types.VIRTUAL_IBAN),this.mpfFactories.getFactory(l.Types.COUNTRY),this.mpfFactories.getFactory(l.Types.PORTFOLIO),this.mpfFactories.getFactory(l.Types.SUBSCRIPTION),this.mpfFactories.getFactory(l.Types.CART_ITEM),this.mpfFactories.getFactory(l.Types.TAX_ESTIMATION),this.mpfFactories.getFactory(l.Types.COUPON_CREATION)]))).then((t=>{this.catalogueFactory=t[0],this.personFactory=t[1],this.cartFactory=t[2],this.paymentMethodFactory=t[3],this.pspFactory=t[4],this.companyInformationFactory=t[5],this.virtualIbanFactory=t[6],this.countryFactory=t[7],this.portfolioFactory=t[8],this.subscriptionFactory=t[9],this.cartItemFactory=t[10],this.taxEstimationFactory=t[11],this.couponFactory=t[12]}))},_fetchCountries(){return this.countries=this.countryFactory.createCollection(d.Types.SP_PUBLIC_OPENED_COUNTRIES),this.countries.fetchPromise()},_getSelectedCountry(){let t;return t=this.me.hasCountry()&&this.countries.some((t=>t.getIso2()===this.me.getCountry()))?this.me.getCountry():"US",t},_fetchMeAllowingCreation(){const t={};return this.me=this.personFactory.createModel(h.Types.ME),t[u.Params.ALLOW_CREATION]=!0,this.me.fetchPromise(t)},_fetchBuyer(){return m.fromMe({connector:this.mpConnector}).then((t=>{this.buyer=t}))},_fetchPaymentMethods(){return this.paymentMethods=this.paymentMethodFactory.createCollection(C.Types.ME_ONLINE_INSTANCE),this.paymentMethods.setParentResourceId(this.onlineInstanceId),this.paymentMethods.fetchPromise().catch((t=>403===(t&&t.options).request.xhr.status?(this.paymentMethodsNotAllowed=!0,e.resolve()):e.reject(t)))},_fetchVirtualIbans(){return this.virtualIbans=this.virtualIbanFactory.createCollection(T.Types.ME_ONLINE_INSTANCE),this.virtualIbans.setParentResourceId(this.onlineInstanceId),this.virtualIbans.fetchPromise().catch((t=>{console.error(t)}))},_fetchCompanyInformation(){return this.companyInformation=this.companyInformationFactory.createModel(b.Types.COMPANY_INFORMATION),this.companyInformation.set(I.Fields.ONLINE_INSTANCE_ID,this.onlineInstanceId),this.companyInformation.fetchPromise().then((t=>{let e=t;return t&&t.getSiteId&&"200000000448000"===t.getSiteId()&&(e=Promise.reject(new A("MySubscription is not supported for Ifweloop engagement tenant",{errorCode:A.ErrorCodes.IFWELOOP_ENGAGEMENT_TENANT}))),e})).catch((t=>{if(console.error(t),t instanceof A)throw t}))},_fetchPsp(){return this.psp=this.pspFactory.createModel(y.Types.ME_ONLINE_INSTANCE),this.psp.setParentResourceId(this.onlineInstanceId),this.psp.fetchPromise()},_getOnlineInstance(){const t=this;this.i3DXCompassPlatformServices.getAppInfo({appId:"X3DOPMR_AP",onComplete:function(e){t.platforms={},e.platforms.length>1&&(t.platforms=e.platforms);let s=e.platformId;t.widget&&t.widget.getValue("x3dPlatformId")?t.widget.getValue("x3dPlatformId")===e.platformId?s=e.platformId:t.platforms&&(s=t.platforms.detect((function(e){return e.id===t.widget.getValue("x3dPlatformId")})).id):!s&&t.platforms&&(s=t.platforms[0].id),t.onlineInstanceId=s,t._fetchResources(t.deferred)}})},_setWidgetPreferences(t){const e=[];t.length>0?t.forEach((t=>{e.push({label:t.name,value:t.id,id:t.id})})):e.push({label:this.onlineInstanceId,value:this.onlineInstanceId,id:this.onlineInstanceId}),this.widget.setTitle(this.onlineInstanceId),this.widget.addPreference({type:"list",id:"x3dPlatformId",name:"x3dPlatformId",defaultValue:this.onlineInstanceId,label:N.get("3DExperiencePlatform"),options:e})},_computeMyAppsUrl(t){const e=t.replace("-ifwe","-apps"),s=e.match(/^https?:\/\/(\w{1,14}-)?(\w+\d-)/)[2];let i;return i=t.includes(s+"euw1-")||["eu1-","euw1-"].includes(s)?e:e.replace(s,"eu1-"),i+"/enovia/resources/AppsMngt"},_promptForPlatform:t=>new Promise(((e,s)=>{const i=t.map((t=>({value:t.id}))),a=new n({showSuggestsOnFocus:!0,placeholder:"Select a platform",required:!0,datasets:[{items:i}],events:{onKeyDown:function(){this.elements.container.removeClassName("mpf-error")}}}),c=new r({value:"Select",className:"primary"}),l=new o({className:"mpf-platform-selector-modal",closable:!1,escapeToClose:!1,visible:!0,header:"<h4>Available Marketplace Platforms</h4>",body:a,footer:c});c.addEvent("onClick",(function(){const i=a.getValue();if(a.isValid()&&i){const o=t.find((t=>t.id===i));l.hide(),l.destroy(),o?e(o):s(new Error("Platform not found"))}else a.elements.container.addClassName("mpf-error")})),l.inject(document.body)})),_fetchConnector(){const t=this._computeMyAppsUrl(window.location.origin);this.myAppsConnector=new f(t);const e=new M(this.myAppsConnector);function s(t){return t.services.get(g.MARKETPLACE.name)}return new _([],{dataProxy:e}).fetchPromise().then((t=>{const e=t.filter(s);return e.length>1?this._promptForPlatform(t.filter(s)):e.pop()})).then((t=>{const e=t.services.get(g.MARKETPLACE.name).getUrl()+"/resources";return this.mpConnector=new a(e,t.id,{service:c.SUBSCRIPTIONS}),this.mpConnector}))}})}));