define("DS/ENO3DCommands/ENO3DReframeOnCmd",["DS/ENOPAD3DViewer/commands/PAD3DViewerReframeOnCmd"],(function(e){"use strict";function t(e){this.ec=e.executionContext,this._viewer=this.ec.getComponent("Viewer")}return t.prototype.beginExecute=function(){new e({context:this._viewer}).execute(),this.endExecute()},t.prototype.endExecute=function(){this.done()},t})),define("DS/ENO3DCommands/ENO3DVolumeQueryCmd",["DS/ENOWebNavVolumeQuery/ENOWebNavVolumeQueryCmd","DS/PADUtils/PADUtilsServices"],(function(e,t){"use strict";function n(e){this.ec=e.executionContext,this.args=e.args,this.cmd=null,this._cbToken=null,this._vqType="box",this._vqMode="partly_in",this._readSessionStorage()}return n.prototype.pauseExecute=function(){this.done()},n.prototype.resumeExecute=function(){},n.prototype.beginExecute=function(){return new Promise(((t,n)=>{try{this.args?(this.args.vqType=this._vqType,this.args.vqMode=this._vqMode):this.args={vqType:this._vqType,vqMode:this._vqMode},this.cmd=new e({context:this.ec.getComponent("Viewer"),args:this.args}),this.cmd.beginExecute(),this.cmd._isRunning=!0,this._cbToken=this.ec.getComponent("Viewer").subscribe({event:"onVolumeEndExecute"},this.done),t()}catch(e){n(e)}}))},n.prototype.cancelExecute=function(){this.cmd._isRunning=!1,this.cmd.cancelExecute(),this.done()},n.prototype.endExecute=function(){this.cmd._isRunning=!1,this.destroy(),this.done()},n.prototype.destroy=function(){this.ec.getComponent("Viewer").unsubscribe(this._cbToken),this.cmd.endExecute(),this.cmd.destroy()},n.prototype._readSessionStorage=function(){const e=window.sessionStorage;null!==e.getItem(`${t.getWidgetId()}-vq-type`)&&(this._vqType=e.getItem(`${t.getWidgetId()}-vq-type`)),null!==e.getItem(`${t.getWidgetId()}-vq-mode`)&&(this._vqMode=e.getItem(`${t.getWidgetId()}-vq-mode`))},n})),define("DS/ENO3DCommands/ENO3DOpenAppCmd",["DS/PADUtils/PADSettingsMgt","DS/Selection/CSOManager","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/PlatformAPI/PlatformAPI"],(function(e,t,n,o){function i(e){this._appID=e.args.appId,this._context=e.args.ctx,this._ec=e.args.ec}return i.prototype.beginExecute=function(){require(["DS/PADServices/utils/PADTrackerManager","DS/PADUtils/PADUtilsServices"],function(e,t){var n=e.getPADTracker({eventCategory:"usage",eventAction:"command-3D"});n.setEventData({eventLabel:"PAD3DViewerOpenAppCmd-"+this._appID}),n.trackPageEvent()}.bind(this)),require(["DS/PADUtils/PADUtilsServices","DS/Selection/CSOManager","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/ENOPAD3DViewer/utils/PAD3DViewerVisuServices","DS/Visualization/SceneGraphUtils","DS/i3DXCompassServices/i3DXCompassPubSub"],function(t,n,i,s,r,c){var a=this._context,l=[],d={},u=[],h=[],g=[],p=n.get(),m=a.getController()._model.getRootBag(),D=[],f={},C={version:"1.1",paths:l,attributes:d};if(a.getRoots().forEach((function(e){D.push(i.getNodeID(e))})),e.getSetting("authorizeChangeControl")){var v=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext");f.changeControl=v.get()}for(var E={},x=0;x<p.length;x++){var S={},y=p[x];if(i.isAModelPath(y.pathElement)){var P=y.pathElement,_=P.getLastElement(!0),w=i.getNodeID(_);if(i.isTileSetNode(_))a.streamPathWithType(y.pathElement,l,d);else if(-1!==D.indexOf(w)&&l.push([w]),!i.is3DLeaf(_)&&w){if(!0===e.getSetting("enopad3dviewer_lightNodeModel")){var N=a.getController().createReferenceIterator(w);this._traverseOOCGraphToGetReps(N,E,S);var b=Object.keys(S);a.getController().lockNodes({ids:b})}if(i.isPLMNode(_)){var O={};_.traverse((function(e){if(i.is3DLeaf(e)){var t=i.getNodeID(e);if(t&&!O[t])O[t]=!0,r.buildPathesLeadingToNode(e,m).forEach((function(e){P.isAParentOf(e)&&u.push(e)}))}}))}else{for(;!i.is3DLeaf(_);)_=(P=P.getParentPath()).getLastElement(!0);u.push(P)}u.forEach((function(e){a._hideShowController.isVisible(e)||g.push(i.getNodeID(e.getLastElement(!0))),a.streamPathWithType(e,l,d)}))}else a.streamPathWithType(y.pathElement,l,d)}}!0===e.getSetting("enopad3dviewer_lightNodeModel")&&a.getController().unlockNodes({ids:Object.keys(E)}),l&&l.forEach((function(e){h.push(e[e.length-1])})),a.setTypesForOFW({nodes2Open:h,hiddenNodes:g,selectedPaths:C},function(e){var n=a.getViewpoint(),i=s.buildViewPoint(n);if(null!==i&&e.viewpoint.push(i),f.changeControl&&(e.workUnder=f.changeControl),"OPEN_IN_CAD_WEB_IN_WIN"===this._appID)o.publish("webinwin:web:notification",JSON.stringify({operation:"open/setTypes",operationVersion:"1.0",content:e}));else{e.appId=this._appID;var r=JSON.stringify(e),l={appId:this._appID,widgetId:t.getWidgetId(),fileName:"-file",fileContent:r};c.publish("launchApp",l)}this.done()}.bind(this))}.bind(this))},i.prototype._traverseOOCGraphToGetReps=function(e,t,n){if(e)if(e.isRepRef())t[e.getReferenceId()]||(t[e.getReferenceId()]=!0,n[e.getReferenceId()]=!0);else for(var o=e.getChildren(),i=0;i<o.length;i++)this._traverseOOCGraphToGetReps(o[i].getReferenceIterator(),t,n)},i})),define("DS/ENO3DCommands/ENO3DLeftSidePanelCmd",[],(function(){"use strict";function e(e){this.ec=e.executionContext}return e.prototype.beginExecute=function(){!1===this.ec.getComponent("Viewer")._rootListPanel.visibleFlag?this.ec.getComponent("Viewer")._showRootListPanel():!0===this.ec.getComponent("Viewer")._rootListPanel.visibleFlag&&this.ec.getComponent("Viewer")._hideRootListPanel(),this.done()},e.prototype.cancelExecute=function(){this.endExecute()},e.prototype.endExecute=function(){this.destroy()},e.prototype.destroy=function(){delete this.ec},e})),define("DS/ENO3DCommands/ENO3DToggleAccurateCmd",["DS/ENOPAD3DViewer/commands/PAD3DViewerToggleGeometry"],(function(e){"use strict";function t(e){}return t.prototype.beginExecute=function(t){return new Promise(((n,o)=>{const i=t.executionContext.getComponent("Viewer");new e({context:i.getCommandContext(),arguments:t.arguments}).execute(),n(),this.endExecute()}))},t.prototype.endExecute=function(){this.destroy(),this.done()},t.prototype.destroy=function(){delete this._ec},t})),define("DS/ENO3DCommands/ENO3DViewerScreenshotCmd",["DS/ViewerCommandsExt/ViewerScreenshotUtils"],(function(e){"use strict";function t(e){this._ec=e.executionContext,this._context=this._ec.getComponent("Viewer"),this._widget=this._ec.getComponent("Widget"),this._appPrefix="3D Navigate","undefined"!=typeof widget&&void 0!==widget.getValue("appTitle")?this._appPrefix=widget.getValue("appTitle"):e.args&&e.args.appPrefix&&(this._appPrefix=e.args.appPrefix),this._noBlink=!1,e.args&&e.args.noBlink&&(this._noBlink=!0===e.args.noBlink)}return t.prototype.beginExecute=function(){return require(["DS/PADServices/utils/PADTrackerManager"],(e=>{const t=e.getPADTracker({eventCategory:"usage",eventAction:"command-3D"});t.setEventData({eventLabel:"ENO3DViewerScreenshotCmd"}),t.trackPageEvent()})),new Promise((t=>{this._context.getContentName().then((n=>{e.saveScreenshot({viewer:this._context.getViewer(),filenamePrefix:this._appPrefix+"-"+n.contentName,noBlink:this._noBlink}),this.endExecute(),t()}))}))},t.prototype.endExecute=function(){this.done()},t.prototype.destroy=function(){delete this._ec},t})),define("DS/ENO3DCommands/ENO3DRelationalNavigatorCmd",["DS/ENOPAD3DViewer/commands/PAD3DViewerRelationalNavigatorCmd"],(function(e){"use strict";function t(e){this.ec=e.executionContext}return t.prototype.beginExecute=function(){const t=this.ec.getComponent("Viewer");new e({context:t.getCommandContext()}).execute(),this.endExecute()},t.prototype.endExecute=function(){this.done(),this.destroy()},t.prototype.destroy=function(){delete this.ec},t})),define("DS/ENO3DCommands/ENO3DFocusOnCmd",[],(function(){"use strict";function e(e){this._executionContext=e.executionContext}return e.prototype.beginExecute=function(){require(["DS/PADServices/utils/PADTrackerManager"],(e=>{const t=e.getPADTracker({eventCategory:"usage",eventAction:"command-3D"});t.setEventData({eventLabel:"ENO3DFocusOnCmd"}),t.trackPageEvent()})),require(["DS/Selection/CSOManager","DS/PADUtils/PADCommandProxy"],function(e,t){try{var n=this._executionContext.getComponent("Viewer"),o=t.create();if(o){var i=e.get(),s=[];i.length&&(i.forEach((function(e){var t=e.pathElement,o=n.streamPath(t);s.push(o)})),require(["DS/PADUtils/PADUtilsServices"],(function(e){o.focus({intent:"focus",paths:s,widget:"3D",sharedID:e.getSharedId(),appID:e.getAppId()}),o.destroy()})))}}finally{this.done()}}.bind(this),function(){this.done()}.bind(this))},e.prototype.destroy=function(){delete this._executionContext},e})),define("DS/ENO3DCommands/ENO3DRevealDocumentsCmd",["DS/ENOPAD3DViewer/commands/PAD3DViewerRevealCmd"],(function(e){"use strict";function t(e){this.ec=e.executionContext}return t.prototype.beginExecute=function(){return new Promise(((t,n)=>{this.ec.getComponent("Viewer");new e({context:this.ec.getComponent("Viewer")}).execute(),this.endExecute(),t()}))},t.prototype.endExecute=function(){this.destroy(),this.done()},t.prototype.destroy=function(){delete this.ec},t})),define("DS/ENO3DCommands/utils/ENO3DInformationPanelUtils",["DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/PADUtils/PADSettingsMgt","DS/EditPropWidget/constants/EditPropConstants","DS/Selection/CSOManager","i18n!DS/PADUtils/assets/nls/PADUtils.json"],(function(e,t,n,o,i){"use strict";function s(){return"object"==typeof s.instance?s.instance:(this.name="ENO3DInformationPanelUtils",s.instance=this,this)}return s.prototype.initializeFacets=function(e,t){t.removeFacets([n.FACET_VIEWS]),t.removeFacets([n.FACET_DERIVEDOUTPUT]);const o=e.getPropertiesFacet(),s=[];for(let e=0;e<o.length;++e){const n=new Promise((n=>{const s=o[e];if(s.facet){if(s.facet.text||(s.facet.text=i[`${s.facet.name}_cmd_title`]),s.actions&&s.actions.length>0)for(let e=0;e<s.actions.length;++e)s.actions[e].text=i[s.facet.name+s.actions[e].text];t.addFacets([s])}n()}));s.push(n)}return s},s.prototype.getSelectedNodes=function(n){var i=function(){return this.refID},s=function(){return this.instID},r=function(){return this.i3dx};const c=o.get(),a=[];for(let t=0;t<c.length;++t){let o=c[t].pathElement;for(;o&&!e.isPLMNode(o.getLastElement(!0))&&!e.isTileSetNode(o.getLastElement(!0));)o=o.getParentPath();if(!o&&n.isSelectiveLoadingActivated());else{const t=e.getRootReferences(o.getLastElement(!0)),i=e.getNodeID(t[0]),s=n.getController().getRootStats(i);if(s&&!s.isVDRP)a.push({refID:e.getNodeID(o.getLastElement(!0)),instID:e.getNodeID(o.getParentPath().getLastElement(!0)),i3dx:e.getNodeI3DX(o.getLastElement(!0)),source:s.serviceId});else{var l=n.streamPath(o);a.push({refID:l[l.length-1],instID:l[l.length-2],i3dx:e.getNodeI3DX(o.getLastElement(!0)),source:s.serviceId})}}}const d=[];for(let e=0;e<a.length;++e)d.push({id:a[e].refID,tenant:t.getSetting("x3dPlatformId"),source:a[e].source,getID:i.bind(a[e]),getRelationID:s.bind(a[e]),getI3DX:r.bind(a[e])});return d},s.prototype.selectionChange=function(e,t){let s=o.get();if(s=s.filter((e=>!("function"==typeof e.getNodeSource&&1===e.getNodeSource()))),s.length)for(let o=0;o<s.length;++o){const r=s[o];if("r2vsurvey"===this.getServiceId(e,r)||!0===this.isInternalJSONObject(r)){const n=e.getPropertiesFacet();for(let e=0;e<n.length;++e){const o=n[e];if(o.facet){if(o.facet.text||(o.facet.text=i[`${o.facet.name}_cmd_title`]),o.actions&&o.actions.length>0)for(let e=0;e<o.actions.length;++e)o.actions[e].text=i[o.facet.name+o.actions[e].text];t.removeFacets([o.facet.name])}}}else if(!0!==this.isInternalJSONObject(r)){t.removeFacets([n.FACET_VIEWS]),t.removeFacets([n.FACET_DERIVEDOUTPUT]);const o=e.getPropertiesFacet();for(let e=0;e<o.length;++e){const n=o[e];if(n.facet){if(n.facet.text||(n.facet.text=i[`${n.facet.name}_cmd_title`]),n.actions&&n.actions.length>0)for(let e=0;e<n.actions.length;++e)n.actions[e].text=i[n.facet.name+n.actions[e].text];t.addFacets([n])}}}}},s.prototype.getI3DX=function(t){let n,o=t.pathElement;for(;o&&!e.isPLMNode(o.getLastElement(!0))&&!e.isTileSetNode(o.getLastElement(!0));)o=o.getParentPath();if(o){const t=o.getLastElement(!0);n=e.getNodeI3DX(t)}return n},s.prototype.getID=function(t,n){for(var o,i=n.pathElement;i&&!e.isPLMNode(i.getLastElement(!0))&&!e.isTileSetNode(i.getLastElement(!0));)i=i.getParentPath();if(!i&&t.isSelectiveLoadingActivated())o=t.getController().getOOCSelectedReferenceID();else{const n=e.getNodeID(i.externalPath[1]),c=t.getController().getRootStats(n);if(c&&!c.isVDRP){var s=i.getLastElement(!0);o=e.getNodeID(s)}else{var r=t.streamPath(i);if(r)o=r[r.length-1];else{s=i.getLastElement(!0);o=e.getNodeID(s)}}}return o},s.prototype.getRelationID=function(t,n){for(var o,i=t.pathElement;i&&!e.isPLMNode(i.getLastElement(!0))&&!e.isTileSetNode(i.getLastElement(!0));)i=i.getParentPath();if(i){const t=e.getNodeID(i.externalPath[1]),a=n.getController().getRootStats(t);if(a&&!a.isVDRP){var s=i.getLastElement(!0);if(e.isInstance(s))o=e.getNodeID(s);else{var r=i.getParentPath().getLastElement(!0);o=e.getNodeID(r)}}else{var c=n.streamPath(i);s=i.getLastElement(!0);o=e.isInstance(s)?c[c.length-1]:c[c.length-2]}}return o},s.prototype.getType=function(t){for(var n,o=t.pathElement;o&&!e.isPLMNode(o.getLastElement(!0))&&!e.isTileSetNode(o.getLastElement(!0));)o=o.getParentPath();if(o){var i=o.getLastElement(!0);n=e.getNodeType(i)}return n},s.prototype.getServiceId=function(n,o){const i=e.getNodeID(o.pathElement.externalPath[1]);return t.getSetting("enopad3dviewer_lightNodeModel")&&n.getController().getRootStats(i)?n.getController().getRootStats(i).serviceId:"3DSpace"},s.prototype.isInternalJSONObject=function(t){let n=!1,o=t.pathElement;for(;o&&!e.isPLMNode(o.getLastElement(!0));)o=o.getParentPath();if(o){const t=o.getLastElement(!0);n=e.isInternalJSONObject(t)}return n},new s})),define("DS/ENO3DCommands/ENO3DEditPropertiesCmd",["DS/Selection/CSOManager","DS/PADUtils/PADSettingsMgt","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/ENOCollabSharingCmds/commands/EditPropCmd/EditPropCmdBase"],(function(e,t,n,o){"use strict";function i(e){this._ec=e.executionContext,this._csoTokens=[]}return i.prototype.beginExecute=function(){require(["DS/PADServices/utils/PADTrackerManager"],(e=>{const t=e.getPADTracker({eventCategory:"usage",eventAction:"command-3D"});t.setEventData({eventLabel:"ENO3DEditPropertiesCmd"}),t.trackPageEvent()}));for(var i=this._ec.getComponent("Viewer"),s=e.get(),r=[],c=0;c<s.length;c++){var a=s[c].pathElement;let e=n.getRootReferences(a.getLastElement(!0));for(;a&&!n.isPLMNode(a.getLastElement(!0))&&!n.isTileSetNode(a.getLastElement(!0));)a=a.getParentPath();if(!a&&i.isSelectiveLoadingActivated());else{let t=n.getNodeID(e[0]);r.push({refID:n.getNodeID(a.getLastElement(!0)),instID:n.getNodeID(a.getParentPath().getLastElement(!0)),i3dx:n.getNodeI3DX(a.getLastElement(!0)),source:this._ec.getComponent("Viewer").getController().getRootStats(t).serviceId})}}var l=function(){return this.refID},d=function(){return this.instID},u=function(){return this.i3dx},h={getSelectedNodes:function(){var e=[];for(c=0;c<r.length;++c)e.push({id:r[c].refID,tenant:t.getSetting("x3dPlatformId"),source:r[c].source,getID:l.bind(r[c]),getRelationID:d.bind(r[c]),getI3DX:u.bind(r[c])});return e},getSecurityContext:function(){return{SecurityContext:t.getSetting("pad_security_ctx"),tenant:t.getSetting("x3dPlatformId")}}};(new o).launchProperties(h),this.endExecute()},i.prototype.endExecute=function(){this.done()},i.prototype.destroy=function(){delete this._csoTokens,delete this._ec},i})),define("DS/ENO3DCommands/OpenLandingPageCmd",["DS/PADServices/commands/HomeCmd"],(function(e){"use strict";function t(e){this.ec=e.executionContext}return t.prototype.beginExecute=function(){const t=this.ec.getComponent("Viewer");new e({context:t.getCommandContext()}).execute(),this.endExecute()},t.prototype.endExecute=function(){this.destroy(),this.done()},t.prototype.destroy=function(){delete this._ec},t})),define("DS/ENO3DCommands/actions/ENO3DStandardActions",["i18n!DS/ENO3DCommands/assets/nls/ENO3DCommands.json"],(function(e){"use strict";const t=Object.create(null);return t.toggleStatusBar=function(e,t){require(["DS/PADServices/utils/PADTrackerManager"],(e=>{const t=e.getPADTracker({eventCategory:"usage",eventAction:"command-3D"});t.setEventData({eventLabel:"ENO3DToggleStatusBarCmd"}),t.trackPageEvent()}));const n=t.executionContext.getComponent("Viewer");if(n){let e=!0;void 0===t.args.state&&null===t.args.state||(e=t.args.state),n.displayStatusBar("true"===e)}e()},t.toggleSidePanel=function(e,t){if(!t||"object"!=typeof t.args&&"object"!=typeof t.executionContext)return void console.error("ENO3DStandardActions.toggleSidePanel\n\tInvalid parameters");const n=t.executionContext.getComponent(WAfrStandardComponentKey.ModelEvents);n&&n.publish?"left"!==t.args.side&&"right"!==t.args.side?n.publish({event:"toggleSidePanel",data:"ENO3DStandardActions.toggleSidePanel\n\tInvalid side value, must be left or right"}):"open"!==t.args.action&&"close"!==t.args.action?n.publish({event:"toggleSidePanel",data:"ENO3DStandardActions.toggleSidePanel\n\tInvalid action value, must be open or close"}):"left"===t.args.side?"open"===t.args.action&&!1===t.executionContext.getComponent("Viewer")._rootListPanel.visibleFlag?t.executionContext.getComponent("Viewer")._showRootListPanel():"close"===t.args.action&&!0===t.executionContext.getComponent("Viewer")._rootListPanel.visibleFlag&&t.executionContext.getComponent("Viewer")._hideRootListPanel():"right"===t.args.side&&n.publish({event:"toggleSidePanel",data:t.args}):console.error("ENO3DStandardActions.toggleSidePanel\n\tUnable to get model event component from Wafr"),e()},t.toggleTimelineView=function(e,t){t.executionContext.getComponent(WAfrStandardComponentKey.ModelEvents).publish({event:"toggleTimelineView",data:t.args}),e()},t.togglePhoto360Mode=function(e,t){t.executionContext.getComponent(WAfrStandardComponentKey.ModelEvents).publish({event:"togglePhoto360Mode",data:t.args}),e()},t.togglePointVisualization=function(e,t){t.executionContext.getComponent(WAfrStandardComponentKey.ModelEvents).publish({event:"togglePointVisualization",data:t.args}),e()},t.togglePointCloudMinimap=function(e,t){t.executionContext.getComponent(WAfrStandardComponentKey.ModelEvents).publish({event:"togglePointCloudMinimap",data:t.args}),e()},t.openAppCmd=function(e,t){t.executionContext.getComponent(WAfrStandardComponentKey.HandlerComponent).executeHandler({id:"ENO3DOpenAppCmd",args:{appId:t.args.appId,ctx:t.executionContext.getComponent("Viewer"),ec:t.executionContext}}),e()},t})),define("DS/ENO3DCommands/ENO3DCleanViewCmd",[],(function(){"use strict";function e(e){this.ec=e.executionContext}return e.prototype.beginExecute=function(){return require(["DS/PADServices/utils/PADTrackerManager"],(e=>{const t=e.getPADTracker({eventCategory:"usage",eventAction:"command-3D"});t.setEventData({eventLabel:"ENO3DCleanViewCmd"}),t.trackPageEvent()})),new Promise((e=>{const t=this.ec.getComponent("Viewer");t&&t.empty&&t.empty(),this.endExecute(),e()}))},e.prototype.endExecute=function(){this.destroy(),this.done()},e.prototype.destroy=function(){delete this.ec},e})),define("DS/ENO3DCommands/ENO3DHideShowCmd",["DS/Selection/CSOManager"],(function(e){"use strict";function t(e){this._ec=e.executionContext}return t.prototype.beginExecute=function(){require(["DS/PADServices/utils/PADTrackerManager"],(e=>{const t=e.getPADTracker({eventCategory:"usage",eventAction:"command-3D"});t.setEventData({eventLabel:"ENO3DHideShowCmd"}),t.trackPageEvent()}));const t=this._ec.getComponent("Viewer"),n=e.get(),o=[];for(let e=0;e<n.length;++e)o.push(n[e].pathElement.clone());t.getHideShowInheritStatus()?t.getHideShowController().toggleHideShowInherit({paths:o}):t.getHideShowController().toggleHideShow({paths:o,dispatch:!0}),this.endExecute()},t.prototype.endExecute=function(){this.destroy(),this.done()},t.prototype.destroy=function(){delete this._ec},t})),define("DS/ENO3DCommands/ENO3DDefineFilterCmd",["DS/ENOPAD3DViewer/commands/PAD3DViewerDefineFilterCmd"],(function(e){"use strict";function t(e){this.ec=e.executionContext,this._objectId=e.args&&e.args.objectId||null}return t.prototype.beginExecute=function(t){return new Promise(((t,n)=>{try{const n=this.ec.getComponent("Viewer"),o=new e({context:n.getCommandContext()});null!==this._objectId&&o.setAppParams(this._objectId),o.execute(),this.endExecute(),t()}catch(e){this.endExecute(),n(e)}}))},t.prototype.endExecute=function(){this.destroy(),this.done()},t.prototype.destroy=function(){delete this.ec,delete this._objectId},t})),define("DS/ENO3DCommands/ENO3DRemoveRootCmd",["DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices"],(function(e){"use strict";function t(e){this.ec=e.executionContext,this._viewer=this.ec.getComponent("Viewer")}return t.prototype.beginExecute=function(){return require(["DS/PADServices/utils/PADTrackerManager"],(e=>{const t=e.getPADTracker({eventCategory:"usage",eventAction:"command-3D"});t.setEventData({eventLabel:"ENO3DRemoveRootCmd"}),t.trackPageEvent()})),new Promise((t=>{require(["DS/Selection/CSOManager","DS/Selection/HSOManager"],((n,o)=>{let i=n.get(),s=[];for(let t=0;t<i.length;++t){let n=i[t].pathElement.getLastElement(!0);e.isTileSetNode(n)?s.push(e.getNodeID(e.getRootReferences(n)[0])):e.isPLMNode(n)&&s.push(e.getNodeID(n))}n.empty(),o.empty(),s.length&&(this._viewer.removeRoots({pids:s},!0),this._viewer.getViewer().render({updateInfinitePlane:!0})),this.endExecute(),t()}))}))},t.prototype.endExecute=function(){this.done()},t})),define("DS/ENO3DCommands/ENO3DPointCloudElevationCmd",["DS/PADServices/utils/PADTrackerManager"],(function(e){"use strict";function t(e){this._ec=e.executionContext,this._viewer=this._ec.getComponent("Viewer")}return t.prototype.beginExecute=function(){if(!this._viewer.getController().get3DLayerController().hasLayer("pointCloudElevationLayer")){console.log("Launch PointCloudElevation cmd"),this._viewer.getController().launchPointCloudStyling("elevation");var t=e.getPADTracker({eventCategory:"usage",eventAction:"command-3D",appId:widget.getValue("appId")});t.setEventData({eventLabel:"ENO3DPointCloudElevation",eventValue:"ENO3DPointCloudElevation"}),t.trackPageEvent()}this.endExecute()},t.prototype.endExecute=function(){this.done()},t.prototype.destroy=function(){delete this._ec,delete this._viewer},t})),define("DS/ENO3DCommands/ENO3DTransparencyCmd",["DS/ENOPAD3DViewer/commands/PAD3DViewerTransparencyCmd"],(function(e){"use strict";function t(e){this.ec=e.executionContext}return t.prototype.beginExecute=function(){return new Promise((t=>{const n=this.ec.getComponent("Viewer");new e({context:n.getCommandContext()}).execute(),this.endExecute(),t()}))},t.prototype.endExecute=function(e){this.destroy(),this.done()},t.prototype.destroy=function(){delete this.ec},t})),define("DS/ENO3DCommands/ENO3DNavigateOnSelectionCmd",["DS/ENO3DView/controller/ENO3DPagerNavigationController"],(function(e){"use strict";function t(e){this.options=e}return t.prototype.beginExecute=function(){new e(this.options),this._focusTooltip=this.options.args.focusTooltip,this._viewer||this.options&&this.options.executionContext&&(this._viewer=this.options.executionContext.getComponent("Viewer")),this._viewer&&(this._viewer._focusTooltip=this.options.args.focusTooltip),this.endExecute()},t.prototype.endExecute=function(){this.done()},t})),define("DS/ENO3DCommands/ENO3DPrintCmd",["DS/PADUtils/PADUtilsServices"],(function(e){"use strict";function t(t){this._ec=t.executionContext,e.isMobileDevice()&&this._ec.getComponent(WAfrStandardComponentKey.HandlerComponent).disableHandler("ENO3DPrintCmd")}return t.prototype.beginExecute=function(){require(["DS/PADServices/utils/PADTrackerManager"],(e=>{const t=e.getPADTracker({eventCategory:"usage",eventAction:"command-3D"});t.setEventData({eventLabel:"ENO3DPrintCmd"}),t.trackPageEvent()})),this._ec.getComponent(WAfrStandardComponentKey.HandlerComponent).disableHandler("ENO3DPrintCmd");const e=this._ec.getComponent("Viewer");var t=1920,n=e.getViewer(),o=n.SCREEN_WIDTH/n.SCREEN_HEIGHT,i=o>1?t:Math.floor(t*o),s=o>1?Math.floor(t/o):t,r=document.createElement("canvas");r.width=i,r.height=s;var c={data:null,width:i,height:s,bufferWidth:0,bufferHeight:0,x:0,y:0};e.getViewer().renderToTarget(c,e.getViewpoint());var a=r.getContext("2d"),l=a.getImageData(0,0,r.width,r.height);if(l.width==r.width)if(l.height==r.height){var d,u,h,g,p=(c.width-1)/(l.width-1),m=(c.height-1)/(l.height-1),D=c.data,f=l.data;if(1==p&&1==m){var C=l.height,v=l.width,E=4*v;for(u=0;u<C;u++)for(h=u*v*4,g=(C-u)*v*4,d=E;d--;)f[h+d]=D[g+d]}a.putImageData(l,0,0,0,0,r.width,r.height);var x=function(e){var t='style="max-width: 100%"';o<1&&(t='style="max-height: 95%; margin: 0px"');var n="<!DOCTYPE html>";n+='<html style="height: 100vh; width: 100vw; margin: 0px">',n+="<head><title>"+e.contentName+"</title></head>",n+='<body style="height: 100vh; width: 100vw; margin: 0px">',n+='<img src="'+r.toDataURL("image/png")+'" '+t+">",n+="</body>",n+="</html>";var i=window.open("","","width=800,height=600");i.document.open(),i.document.addEventListener("load",function(){i.focus(),i.print(),i.document.close(),i.close(),this.endExecute(),this._ec.getComponent(WAfrStandardComponentKey.HandlerComponent).enableHandler("ENO3DPrintCmd")}.bind(this),!0),i.document.write(n)}.bind(this);e.getContentName().then(x).catch(x)}else console.error("error");else console.error("error")},t.prototype.endExecute=function(){this.done()},t.prototype.destroy=function(){delete this._ec},t})),define("DS/ENO3DCommands/ENO3DLevelSelectorCmd",["DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/LevelSelector/LevelSelector","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/Selection/PSOManager"],(function(e,t,n,o,i){"use strict";function s(e){this._viewer=e.executionContext.getComponent("Viewer"),this._context=e.executionContext.getComponent("Context"),this._labelsVisibility=e.args.labelVisibility||!1,this._emptyCSOToken="",this._levelSelectorContext=null,this._path=null,this._levels=[],this._event=null}return s.prototype.beginExecute=function(){require(["DS/PADServices/utils/PADTrackerManager"],(e=>{const t=e.getPADTracker({eventCategory:"usage",eventAction:"command-3D"});t.setEventData({eventLabel:"ENO3DLevelSelectorCmd"}),t.trackPageEvent()})),this._subscribeToEvent();const e=n.get();if(1===e.length){this._event=e[0].event,this._path=e[0].pathElement,this._levelSelectorContext=e[0].pathElement.clone();var o=this._viewer.getDOMElement("container");let n=this._event?this._event.event.pageX+75:o.offsetWidth/2,i=this._event?this._event.event.pageY-75:o.offsetHeight/2;this._event&&"Touch"===this._event.type&&(n=this._event.currentPosition.x+75,i=this._event.currentPosition.y-75),t.createView({positionX:n,positionY:i,uiFrame:o,getLevels:this._getLevels.bind(this),onHover:this._onHover.bind(this),onLeave:this._onLeave.bind(this),onSelect:this._onSelect.bind(this)})}else this.endExecute()},s.prototype.endExecute=function(){this._unsubscribeToEvent(),t.destroyView(),delete this._labelsVisibility,delete this._viewer,delete this._emptyCSOToken,delete this._levelSelectorContext,delete this._levels,delete this._path,delete this._event,this.done()},s.prototype._getLevels=function(t){for(var i=this._path,s=[];i;){var r=i.externalPath[i.externalPath.length-1];if(e.isPLMNode(r)&&(e.isReference(r)||e.is3DLeaf(r))){const t=i.getLastElement(!0),n=e.getBIColor(t);null!==n?this._levels.push({pathElement:i,canvasColor:n,event:this._event}):this._levels.push({pathElement:i,event:this._event}),s.push(e.getNodeID(i.getLastElement(!0)))}i=i.getParentPath()}if(this._labelsVisibility&&s.length){var c=["ds6w:label","type_icon_url"],a="";if(this._viewer.getController().is3DLeafColorizeActivated()){a=this._viewer.getController().getBIColorMap().predicate;c.push(a)}this._viewer.getController().getAttributes({ids:s,attributes:c,callbacks:{onComplete:n=>{for(var o=0;o<this._levels.length;++o){var i=e.getNodeID(this._levels[o].pathElement.getLastElement(!0));if(n[i]&&(this._levels[o].name=n[i][c[0]],this._levels[o].icon=n[i][c[1]],this._viewer.getController().is3DLeafColorizeActivated()&&""!==a)){var s=n[i][a];this._levels[o].canvasColor=this._viewer.getController().getColorValueForPredicate(s,this._viewer.getController().getBIColorMap().predicateKind)}}t(this._levels),this._context.setContextBarVisibility?this._context.setContextBarVisibility(!1):console.warn('ENO3DLevelSelector : the "Context" component doesn\'t implement the required setContextBarVisibility method. The level selector behavior is therefore altered.'),this.done()},onFailure:e=>{console.error("Levele selector command: The getAttributes call failed.",e),t(this._levels),this._context.setContextBarVisibility?this._context.setContextBarVisibility(!1):console.warn('ENO3DLevelSelector : the "Context" component doesn\'t implement the required setContextBarVisibility method. The level selector behavior is therefore altered.'),this.done()}}})}else o.empty(),n.empty(),this.done();return this._levels},s.prototype._onHover=function(e){o.empty(),i.empty(),e.event=this._event,o.add(e)},s.prototype._onLeave=function(e){o.empty(),i.empty(),o.add({pathElement:this._levelSelectorContext,event:this._event})},s.prototype._onSelect=function(e){o.empty(),n.empty(),e.event=this._event,o.add(e),n.add(e),this.endExecute()},s.prototype._subscribeToEvent=function(){this._emptyCSOToken=n.onEmpty(this.endExecute.bind(this)),this._rootRemovedToken=this._viewer.subscribe({event:"onRootRemoved"},this.endExecute.bind(this)),this._rootAddedToken=this._viewer.subscribe({event:"onRootAdded"},this.endExecute.bind(this)),this._modelUpdatedToken=this._viewer.subscribe({event:"onModelUpdated"},this.endExecute.bind(this)),this._modelUpdatedToken=this._viewer.subscribe({event:"on3DLeafUnColorize"},this.endExecute.bind(this))},s.prototype._unsubscribeToEvent=function(){n.unsubscribe(this._emptyCSOToken),this._viewer&&(this._viewer.unsubscribe(this._rootRemovedToken),this._viewer.unsubscribe(this._rootAddedToken),this._viewer.unsubscribe(this._modelUpdatedToken))},s})),define("DS/ENO3DCommands/ENO3DPointCloudClassificationCmd",["DS/PADServices/utils/PADTrackerManager"],(function(e){"use strict";function t(e){this._ec=e.executionContext,this._viewer=this._ec.getComponent("Viewer")}return t.prototype.beginExecute=function(){if(!this._viewer.getController().get3DLayerController().hasLayer("pointCloudClassificationLayer")){console.log("Launch PointCloudClassification cmd"),this._viewer.getController().launchPointCloudStyling("classification");var t=e.getPADTracker({eventCategory:"usage",eventAction:"command-3D",appId:widget.getValue("appId")});t.setEventData({eventLabel:"ENO3DPointCloudClassification",eventValue:"ENO3DPointCloudClassification"}),t.trackPageEvent()}this.endExecute()},t.prototype.endExecute=function(){this.done()},t.prototype.destroy=function(){delete this._ec,delete this._viewer},t})),define("DS/ENO3DCommands/HighQualityCmd",["DS/ENO3DCommands/ENO3DToggleAccurateCmd"],(function(e){"use strict";function t(e){this.ec=e.executionContext}return t.prototype.beginExecute=function(t){return new Promise(((t,n)=>{const o=this.ec.getComponent("Viewer");(new e).beginExecute({executionContext:this.ec,context:o.getCommandContext(),arguments:[{ID:"mode",Value:"high"}]}),t(),this.endExecute()}))},t.prototype.endExecute=function(){this.destroy(),this.done()},t.prototype.destroy=function(){delete this.ec},t})),define("DS/ENO3DCommands/OptimizedQualityCmd",["DS/ENO3DCommands/ENO3DToggleAccurateCmd"],(function(e){"use strict";function t(e){this.ec=e.executionContext}return t.prototype.beginExecute=function(t){return new Promise(((t,n)=>{const o=this.ec.getComponent("Viewer");(new e).beginExecute({executionContext:this.ec,context:o.getCommandContext(),arguments:[{ID:"mode",Value:"optimized"}]}),t(),this.endExecute()}))},t.prototype.endExecute=function(){this.destroy(),this.done()},t.prototype.destroy=function(){delete this.ec},t})),define("DS/ENO3DCommands/utils/_ENO3DInformationPanelController",["DS/ENO3DCommands/utils/ENO3DInformationPanelUtils","DS/InformationWebAfrCmd/cmd/InformationCmd","DS/PADUtils/PADSettingsMgt","DS/Selection/CSOManager","DS/Utilities/Utils","DS/PADServices/utils/R2VProperties","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/utils/EditPropUtils","i18n!DS/PADUtils/assets/nls/PADUtils.json"],(function(e,t,n,o,i,s,r,c,a){"use strict";function l(){return"object"==typeof l.instance?l.instance:(this.name="_ENO3DInformationPanelController",l.instance=this,this.ec=null,this.cmd=null,this._canceled=!1,this._tkAdd=null,this._tkRemove=null,this._tkEmpty=null,this)}return l.prototype.open=function(t){this.ec=t,this._canceled=!1,this.createInformationCmd(),this.cmd.beginExecute();const n=e.initializeFacets(this.ec.getComponent("Viewer"),this.cmd);Promise.all(n).then((()=>{e.selectionChange(this.ec.getComponent("Viewer"),this.cmd),this._subscribeToCSOEvents()}))},l.prototype.close=function(){this._canceled=!0,this.cmd&&this.cmd.closePanel(),this.ec=null,this.cmd=null,o.unsubscribe(this._tkAdd),o.unsubscribe(this._tkRemove),o.unsubscribe(this._tkEmpty)},l.prototype.createInformationCmd=function(){let e=!0;void 0!==this.ec.getComponent("Viewer")&&null!==this.ec.getComponent("Viewer")&&void 0!==this.ec.getComponent("Viewer").getEditMode&&!0===this.ec.getComponent("Viewer").getEditMode()&&(e=!1),this.cmd=new t({executionContext:this.ec,args:{appId:"undefined"!=typeof widget&&null!==widget?widget.getValue("appId"):"",className:"enxpropertiestab",multiselection:r.MULTISEL_NO,setEditButton:!e,readOnly:e,typeOfDisplay:r.ALL,selectionType:r.NO_SELECTION,actions:[{name:"action_close_panel",text:a.closeProperties,icon:"close",handler:()=>{this._canceled||this.close()}}],events:{onCancel:()=>{this._canceled||this.close()}},context:{getSelectedNodes:this.getSelectedNodes.bind(this),getSecurityContext:function(){return{SecurityContext:n.getSetting("pad_security_ctx"),tenant:n.getSetting("x3dPlatformId")}}}}}),this.cmd.done=()=>{}},l.prototype._subscribeToCSOEvents=function(){const t=i.debounce((()=>{let t=o.get();if(0!==t.length){e.selectionChange(this.ec.getComponent("Viewer"),this.cmd);const n=[];t.forEach((t=>{const o=new Promise((n=>{let o={ID:"",relation:"",type:"",i3dx:"",getID:function(){return this.ID},getRelationID:function(){return this.relation},getType:function(){return this.type},getI3DX:function(){return t.options&&t.options.grid?t.getI3DX():e.getI3DX(t)}};const i=this;"function"!=typeof t.getID&&(t.getID=function(){return e.getID(i.ec.getComponent("Viewer"),this)}),"function"!=typeof t.getRelationID&&(t.getRelationID=function(){return e.getRelationID(this,i.ec.getComponent("Viewer"))}),void 0===t.type&&(t.options&&t.options.type?t.type=t.options.type:t.type=e.getType(t)),"r2vsurvey"===e.getServiceId(this.ec.getComponent("Viewer"),t)?s.getPropModel({objectId:e.getID(this.ec.getComponent("Viewer"),t),type:e.getType(t),serviceId:e.getServiceId(this.ec.getComponent("Viewer"),t)}).then(n).catch((e=>{console.error(e)})):(o.ID=t.getID(),!0===e.isInternalJSONObject(t)?o.relation=void 0:o.relation=t.getRelationID(),o.type=t.type,n(c.getModelFromSelectedNode(o)))}));n.push(o)})),Promise.all(n).then((e=>{this.cmd.initDatas(e)})).catch((e=>{console.warn("Cannot retrieve properties model")}))}else this.cmd.initDatas([])}),100);this._tkAdd=o.onPostAdd(t),this._tkRemove=o.onPostRemove(t),this._tkEmpty=o.onEmpty(t)},l.prototype.getSelectedNodes=function(){return e.getSelectedNodes(this.ec.getComponent("Viewer"))},l.prototype.getCmd=function(){return this.cmd||null},new l})),define("DS/ENO3DCommands/ENO3DInformationPanelCmd",["DS/ENO3DCommands/utils/_ENO3DInformationPanelController"],(function(e){"use strict";function t(e){this.ec=e.executionContext}return t.prototype.beginExecute=function(){null===e.getCmd()?e.open(this.ec):e.close(),this.done()},t.prototype.cancelExecute=function(){},t.prototype.endExecute=function(){},t.prototype.destroy=function(){delete this.ec},t}));