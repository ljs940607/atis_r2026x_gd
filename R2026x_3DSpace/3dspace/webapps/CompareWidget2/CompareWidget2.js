define("DS/CompareWidget2/CompareWidgetInit",[],(function(){"use strict";return function(){setTimeout((function(){let e=null,t=null;try{var i=widget.data.X3DContentId||widget.getValue("__X3DContentId");e=JSON.parse(i),widget.data.X3DContentId&&widget.setValue("__X3DContentId",widget.data.X3DContentId)}catch(e){console.log("X3DContentId is not a json object")}e&&(t=e.runOptions),require(["DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleServicesSettings"],(function(e,i){var n=widget.getValue("x3dPlatformId");i.app_initialization((function(){e.getSecurityContextPromise(n,null).then((function(e){require(["DS/CompareWidget2/CompareWidget2"],(function(e){widget.addEvents({onLoad:function(i){e.onLoad.call(null,t)},onViewChange:function(t){e.onViewChange.call(null,t)},onRefresh:function(t){e.onRefresh.call(null,t)},onResize:function(t){e.onResize.call(null,arguments)},onEdit:function(t){e.onEdit.apply(null,arguments)},endEdit:function(t){t.submitted&&e.endEdit.apply(null,arguments)}})}))}))}))}))}),500)}})),define("DS/CompareWidget2/plugins/PORTFOLIO/PORTFOLIO_STRUCT_FETCH_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/PORTFOLIO/expanders/PortfolioExpand","DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/nodeOccRel2RefInstTree","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInstTreeAug","DS/CompareWidget2/support/cw2CacheMgr"],(function(e,t,i,n,o){function r(e,o){var r=this;return new Promise((function(s,a){r._lastReqStart=r._plugSvcs.nowMS();var l=r._lastReqStart;r._plugSvcs.postEvent("STRUCT_UPDATE_IN_PROGRESS_EVENT",null);var u=e.length,c=[];for(let d of e)t.doExpand(d,"PORTFOLIO_SERVICE","-1",r._plugSvcs,o).then((function(t){var p=t,h=i.convert(d,p,r._plugSvcs,o);if(h.setDataSource(p._dataSource),h.sortChildren(),r.dbgout("%% STRUCTURAL DATA EXPANDED by: "+h._dataSource),l==r._lastReqStart){var _={securityContext:d._securityContext,tenant:d._tenant,serviceName:d._serviceName};n.augment(h,_,r._plugSvcs).then((function(t){if(l==r._lastReqStart){var i,n,o,a=t;if(c.push(a),c.length>=u){var d=(i=e,n=[],o={},c.forEach((function(e){var t=e.getObjIDSpec().getUniqueID();o[t]=e})),i.forEach((function(e){var t=e.getUniqueID(),i=o[t];n.push(i)})),n);if(l!=r._lastReqStart)return;s(d)}}}),(function(e){r._plugSvcs.errout("FAILURE AUGMENTING TREE:"+e),a(e)}))}}),(function(e){r._plugSvcs.errout("Failed to expand using service: "+e),a(e)}))}))}return e.extend({init:function(e,t,i,n){this._parent(e,t,i,n),this._dataSource="PORTFOLIO_SERVICE",this._dbFallback=!1},execute:function(e,t){var i=this;i._parent(e,t);var n=e;r.call(i,n,t).then((function(e){var t=e;i.reportOK(t)}),(function(e){i.reportKO()}))}})})),define("DS/CompareWidget2/plugins/PORTFOLIO/expanders/PortfolioExpand",["DS/CompareWidget2/support/cw2Utils","DS/CompareCommon/Utils","DS/CompareCommon/CompareMetaData","DS/CompareWidget2/support/DataCenter","DS/CompareWidget2/support/objIDSpec","DS/CompareWidget2/plugins/STRUCTURE/expanders/compareServiceExpand","DS/CompareWidget2/ViewDefModules/ViewDefOptions","UWA/Json"],(function(e,t,i,n,o,r,s,a){function l(e){var i=e.attributes.revision,n={};if(t.isRevBranchRevPattern(i,n)){for(var o=e.attributes.name,r=n.branches.length-1;r>=0;--r)o+="_"+n.branches[r].branchId,0!==r&&(o+="_"+n.branches[r].revisionId);e.attributes.name=o}e.logicalid="NoDupes"}return{jsName:"PORTFOLIO_EXPAND",doExpand:function(e,a,u,c,d){return new Promise((function(u,d){(function(e,t,i,o){return new Promise((function(t,i){var o="objectIds="+e.getPhysID(),r=e.getTenant(),s=e.getServiceName();n.makeAuthHttpsCall("/3dportfolio/fetchObjs","GET",o,"json",r,s,null,!1).then((function(e){t(e)}),(function(e){i(e)}))}))})(e).then((function(n){var p=n[0];for(var h of(p._dataSource=a,p.nodes))void 0!==h.serviceId&&null!==h.serviceId&&"3dportfolio"===h.serviceId.toLowerCase()&&l(h);(function(e,n,a,l){return new Promise((function(l,u){if(null!=n){var c={objectIds:[],objectTypes:[],serviceIds:[],tenant:e._tenant,securityContext:e._securityContext},d={objectIds:[],objectTypes:[],serviceIds:[],tenant:e._tenant,securityContext:e._securityContext};for(var p of n.nodes)p.nodeid!==n.rootoccurrence&&void 0!==p.proxySpec&&null!==p.proxySpec&&(-1!==p.proxySpec.serviceURL.search(/^3DSpace/i)?(c.objectIds.push(p.physicalid),c.objectTypes.push(p.type),c.serviceIds.push(p.proxySpec.serviceURL)):(d.objectIds.push(p.physicalid),d.objectTypes.push(p.type),d.serviceIds.push(p.proxySpec.serviceURL)));var h=0,_=0;function g(){_===h&&l(n)}if(0===d.objectIds.length&&0===c.objectIds.length&&g(),d.objectIds.length>0&&(++h,t.getFederatedAttributesPromise(d).then((function(e){++_;for(let t of n.nodes)for(let n of e.results)if(t.physicalid===n.physicalID){let e=n.data.findIndex((e=>"ds6w:label"===e.name));-1!==e&&(t.Title=n.data[e].value),t.icon=n.type_icon_url,""===t.attributes.name&&(t.attributes.name=t.physicalid),""===t.attributes.derivedFromId&&(t.attributes.derivedFromId=t.physicalid),t.logicalid=t.physicalid,i.typeInfo[t.type]&&i.typeInfo[t.type].icon||(i.typeInfo[t.type]=i.typeInfo[t.type]||{},i.typeInfo[t.type].icon=n.type_icon_url,null==i.typeInfo[t.type].serviceId&&void 0!==n.sourceID&&null!==n.sourceID&&(i.typeInfo[t.type].serviceId=n.sourceID.split(":")[0]))}g()}))),c.objectIds.length>0){++h;let f=[];for(let T=0;T<c.objectIds.length;++T){let E=new o(c.objectIds[T],c.objectTypes[T],c.securityContext,c.tenant,c.serviceIds[T]);f.push(E)}let S="CV_SERVICE",m="0",C=s.STRUCT_FETCH_OPTIONS;C.USE_MCS=!1,r.doExpandN(f,S,m,a,C).then((function(e){++_;for(let r of e)if(null!=r){var t=r.rootoccurrence,i=parseInt(r.occurrences[t].nodeid),o=r.nodes[i].physicalid;for(let e of n.nodes)if(e.physicalid===o){let t=r.nodes[i];e.icon=t.icon,e.name=t.attributes.name,e.revision=t.revision,e.attributes=t.attributes,e.logicalid=t.attributes.name;let n=t.attributes["PLMReference.V_DerivedFrom"];e.attributes.derivedFromId=null!=n&&""!==n?n:t.physicalid,"Products"===t.type&&(e.name=t.versionid,e.attributes.derivedFromId=t.attributes.name),"VPMReference"===t.type&&(e.versionid=t.versionid,e.logicalid=t.logicalid)}}g()}))}}}))})(e,p,c).then((function(e){u(e)}),(function(e){c.errout(e),d(e)}))}),(function(e){c.errout(e),d(e)}))}))}}})),define("DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/pe2RefInstTreeWithBSD",["DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/exAdapter","DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/treeBuilderWithBSD","DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/pe2RefInstTree"],(function(e,t,i){return e.singleton({jsClass:"PE2REFINST_TREE_BSD",convert:function(e,n,o,r,s){const a=i.convert(e,s.results,o,r);for(var l=new t(e),u=n.length,c=0;c<u;c++){var d=n[c];if(null!=d.resourceid){var p=l.build_dbObj(d,r.MULTI_VALUE_ATTRS);l.add_dbObj(p)}else null!=d.Path?l.add_path(d.Path):null!=d.icon__default_thumbnail_2d?l.add_typeIcons(d.icon__default_thumbnail_2d):o.errout("Unknown entry in input:"+JSON.stringify(d)+", skipping...")}let h=n._dataSource;var _=l.buildTree(s,h,a);return l=null,_}})})),define("DS/CompareWidget2/plugins/ATTRIBUTE/ViewPanel/attrChooseDialog",["UWA/Class","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Expander","DS/Controls/Button","DS/Controls/Toggle","DS/Controls/LineEditor","DS/Controls/TooltipModel","i18n!DS/CompareWidget2/assets/nls/CompareV2","css!DS/CompareWidget2/CompareWidget2.css"],(function(e,t,i,n,o,r,s,a,l){return e.extend({init:function(e,n,o,r){this._parent({}),this.context=e,this.options=n,this.onClickOkCallback=o,this.onClickCancelCallback=r;let s=null!=n&&null!=n.Title&&""!==n.Title?n.Title:l.selectPropertiesToDisplay,a=this._buildContent();this.header=a.header,this.content=a.body;let u=this._buildFooter();if(this.immersiveFrame=new t,this.immersiveFrame.inject(widget._isODTMode()?document.body:widget.body),this.dialog=new i({title:s,header:this.header,content:this.content,buttons:u,immersiveFrame:this.immersiveFrame,resizableFlag:!0,visibleFlag:!0,modalFlag:!0}),null!=this.options&&null!=this.options.Width&&""!==this.options.Width){this.content.getParent().setStyle("width",this.options.Width)}null!=n&&null!=n.Icon&&(this.dialog.icon=n.Icon),this.dialog.addEventListener("close",this._onClickClose.bind(this))},_enableOK:function(e){this.dialog.buttons.Ok.disabled=!e},_enableReset:function(e){null!=this.dialog.buttons.Reset&&(this.dialog.buttons.Reset.disabled=!e)},_onDialogClose:function(){this.dialog.removeEventListener("close",this._onClickClose.bind(this)),this.dialog.destroy(),this.immersiveFrame.destroy()},_onClickOk:function(){this._save(function(e){this.onClickOkCallback(e),this.dialog.close()}.bind(this))},_onClickCancel:function(){"function"==typeof this.onClickCancelCallback&&this.onClickCancelCallback(),this.dialog.close()},_onClickClose:function(){"function"==typeof this.onClickCancelCallback&&this.onClickCancelCallback()},_onClickReset:function(){this._resetToDefaultAttrs()},_resetToDefaultAttrs:function(){var e=this,t=this.context.defaultAttrs;this.allPropertyCheckboxes.forEach((function(i){var n=null==t||-1!=t.indexOf(i.value)||e.context.isTitleAttr(i);i.checkFlag=n})),e._updateAllCheck(),e._enableReset(!1),e._enableOK(!0)},onClickDisplayAll:function(e){let t=this.displayAllCheckbox.checkFlag;for(var i of this.allPropertyCheckboxes)i.visibleFlag&&this._checkboxExpanderVisibleAndExpanded(i)&&(this.context.isTitleAttr(i)?i.checkFlag=!0:i.checkFlag=t);this._enableReset(!0),this._enableOK(!0)},_checkboxExpanderVisibleAndExpanded:function(e){if(retval=!0,null!=e.options&&null!=e.options.expander&&""!==e.options.expander&&null!=this.allExpanders&&this.allExpanders.length>0)for(var t of this.allExpanders)if(null!=t.options&&null!=t.options.id&&""!=t.options.id&&e.options.expander===t.options.id){retval=1==t.visibleFlag&&!0===t.expandedFlag;break}return retval},onUncommittedLineEditorChange:function(){let e=this.lineEditorForFiltering.valueToCommit.toLowerCase();for(var t of this.allPropertyCheckboxes){let i=!0;""!==e&&(t.options.label_lc.includes(e)||(i=!1)),t.visibleFlag!=i&&(i?t.show():t.hide())}},_save:function(e){let t=[],i=[];if(null!=this.dialog.buttons.Reset&&this.dialog.buttons.Reset.disabled)t.push("__showDefault__");else if(null==this.displayAllCheckbox||!this.displayAllCheckbox.checkFlag)for(let e=0;e<this.allPropertyCheckboxes.length;e++){let i=this.allPropertyCheckboxes[e];if(0==i.checkFlag){let e=i.value;t.push(e)}}this.context.savePropsDisplayOptions(t);for(let e=0;e<this.allPropertyCheckboxes.length;e++){let t=this.allPropertyCheckboxes[e];if(1==t.checkFlag&&null!=t.options){null==i.find((function(e){return e.indexCompare===t.options.id}))&&i.push({indexCompare:t.options.id,showInDisplay:!0})}}e(i)},_buildPropertyCheckboxes:function(e,t,i){this.allPropertyCheckboxes=[],this.allExpanders=[];var n=[];for(let e of t)if(null!=e.value){void 0===n.find((function(t){return t.name===e.value.facet}))&&n.push({name:e.value.facet,icon:e.value.icon})}if(n.length>1)for(let o of n){let n=this._addExpander(o,e);for(let e=0;e<t.length;++e)t[e].value.facet===o.name&&this._addCheckbox(e,t,i,!0,n.body,n.options.id)}else if(null!=this.options&&!0===this.options.GroupAdditionalStatusesByObjectType){var o=[];for(let e of t)if(null!=e.value)for(let t of e.value.objType){void 0===o.find((function(e){return e.name===t}))&&o.push({name:t})}o.sort((function(e,t){let i=e.name.toLowerCase(),n=t.name.toLowerCase();return i<n?-1:i>n?1:0}));let i=l.commonExpanderTitle;o.unshift({name:i});t=this.options.Attributes||[];for(let n of o){var r=null;let o=!1;for(let s=0;s<t.length;++s)if(n.name===i&&t[s].value.objType.length>1||n.name!==i&&1===t[s].value.objType.length&&t[s].value.objType.includes(n.name)){null==r&&(r=this._addExpander(n,e,!1)),!0===this._addCheckbox(s,t,[],!1,r.body,r.options.id).checkFlag&&(o=!0)}o&&(r.expandedFlag=!0,this.displayAllCheckbox.checkFlag=!0)}}else for(let n=0;n<t.length;++n)this._addCheckbox(n,t,i,!0,e)},_addExpander:function(e,t,i){var o=UWA.createElement("div",{}),r=new n({header:e.name,icon:e.icon,style:"simple",expandedFlag:!1!==i,body:o}).inject(t);return r.options.id=e.name,this.allExpanders.push(r),r},_addCheckbox:function(e,t,i,n,o,s){var u=this;let c=t[e],d=null!=c.value?c.value.label:c.displayName;if(n&&null!=c.value&&null!=c.value.objType){let i=e>0&&t[e-1].value.label===c.value.label,n=e<t.length-1&&c.value.label===t[e+1].value.label;if(i||n)if(c.value.objType.length>3)d+=" ("+c.value.objType.length+" object types)";else if(c.value.objType.length>0){d+=" (";for(let e=0;e<c.value.objType.length;++e)e>0&&(d+=","),d+="function"==typeof u.context.getObjTypeNLS?u.context.getObjTypeNLS(c.value.objType[e]):c.value.objType[e];d+=")"}}let p=null;if(null!=c.value){let e=l.objTypesWithThisAttr;for(let t=0;t<c.value.objType.length;++t)e+="\r\n",e+="function"==typeof u.context.getObjTypeNLS?u.context.getObjTypeNLS(c.value.objType[t]):c.value.objType[t];p=new a({title:c.value.label,shortHelp:e})}let h=new r({label:d,value:null!=c.value?c.value.attrName:c.name,tooltipInfos:p});return null!=c.value?h.checkFlag=!0===c.value.checkFlag:h.checkFlag=-1==i.indexOf(c.name),h.options.label_lc=h.label.toLowerCase(),h.options.id=e,null!=s&&""!==s&&(h.options.expander=s),u.context.isTitleAttr(c)?(h.disabled=!0,h.checkFlag=!0,h.addEventListener("buttonclick",function(){u._enableOK(!1),u._enableReset(!1),u._updateAllCheck()}.bind(u)),h.inject(o),u.allPropertyCheckboxes.unshift(h)):(h.addEventListener("buttonclick",function(){u._enableOK(!0),u._enableReset(!0),u._updateAllCheck()}.bind(u)),h.inject(o),u.allPropertyCheckboxes.push(h)),h},_updateAllCheck:function(){if(null!=this.displayAllCheckbox){for(var e=!0,t=this.allPropertyCheckboxes.length,i=0;i<t;i++){if(1!=this.allPropertyCheckboxes[i].checkFlag){e=!1;break}}this.displayAllCheckbox.checkFlag=e}},_buildDisplayAllCheckbox:function(e){let t=new a({title:this.options.AllText});null!=this.options.AllTextTooltip&&""!==this.options.AllTextTooltip&&(t.shortHelp=this.options.AllTextTooltip),this.displayAllCheckbox=new r({label:this.options.AllText,value:"all",checkFlag:this.context.showAllProps(),tooltipInfos:t}),this.displayAllCheckbox.getContent().setStyle("margin-left","5px"),this.displayAllCheckbox.inject(e),this.displayAllCheckbox.addEventListener("buttonclick",this.onClickDisplayAll.bind(this))},_buildLineEditor:function(e){this.lineEditorForFiltering=new s({placeholder:l.enterAttributeNamePrompt,displayClearFieldButtonFlag:!0,sizeInCharNumber:40}),this.lineEditorForFiltering.getContent().setStyle("padding-bottom","6px"),null!=this.displayAllCheckbox&&this.lineEditorForFiltering.getContent().setStyle("padding-top","6px"),this.lineEditorForFiltering.inject(e);let t=this.lineEditorForFiltering.getContent().getChildren();null!=t[0]&&t[0].setStyle("width","100%"),this.lineEditorForFiltering.addEventListener("uncommittedChange",this.onUncommittedLineEditorChange.bind(this))},_buildContent:function(){var e=null!=this.options.Attributes?this.options.Attributes:this.context.compareResult;for(let i=0;i<e.length;i++)if(this.context.isTitleAttr(e[i])){e.unshift(e[i]);var t=i+1;e.splice(t,1)}var i=e.findIndex((e=>"thumbnailimage"===e.name));if(-1!=i&&0!=i){e.unshift(e[i]);var n=i+1;e.splice(n,1)}let o={header:null,body:UWA.createElement("div",{id:"attr-choose-dialog"})};return null!=this.options&&null!=this.options.AllText&&""!==this.options.AllText&&(null==o.header&&(o.header=UWA.createElement("div",{id:"attr-choose-dialog-header"})),this._buildDisplayAllCheckbox(o.header)),null!=this.options&&!0===this.options.LineEditor&&(null==o.header&&(o.header=UWA.createElement("div",{id:"attr-choose-dialog-header"})),this._buildLineEditor(o.header)),this._buildPropertyCheckboxes(o.body,e,this.context.getPropsToHide(e)),o},_buildFooter:function(){var e={};return e.Ok=new o({domId:"compare_attrchooser_OK",onClick:this._onClickOk.bind(this),disabled:!0,emphasize:"primary"}),e.Cancel=new o({domId:"compare_attrchooser_Cancel",onClick:this._onClickCancel.bind(this),disabled:!1,emphasize:"secondary"}),null!=this.options&&!0===this.options.ResetButton&&(e.Reset=new o({domId:"compare_attrchooser_Reset",onClick:this._onClickReset.bind(this),disabled:this.context.showDefaultPropsOnly(),emphasize:"secondary"})),e}})})),define("DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/pe2RefInstTreeWithPGP",["DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/exAdapter","DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/treeBuilderWithPGP"],(function(e,t){return e.singleton({jsClass:"PE2REFINST_TREE_PGP",convert:function(e,i,n,o){var r=new t(e),s=i.length;let a=[];for(var l=0;l<s;l++){var u=i[l];if(null!=u.resourceid){var c=r.build_dbObj(u,o.MULTI_VALUE_ATTRS);r.add_dbObj(c)}else null!=u.Path?r.add_path(u.Path):null!=u.pgp_output?a=u.pgp_output.pgp_hide||[]:null!=u.icon__default_thumbnail_2d?r.add_typeIcons(u.icon__default_thumbnail_2d):n.errout("Unknown entry in input:"+JSON.stringify(u)+", skipping...")}var d=r.buildTree(a);return r=null,d}})})),define("DS/CompareWidget2/widget/resultFrame",["UWA/Controls/Abstract","DS/CustomizableLayout/Layout","DS/CompareWidget2/viewComponents/MainToolbar","DS/CompareCommon/Utils","DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/userSettings/UserSettingsManager","DS/CompareCommon/Probs/CompareAnalyticsProb","i18n!DS/CompareWidget2/assets/nls/DisplayMessages"],(function(e,t,i,n,o,r,s,a){"use strict";function l(e,t){let i=[];t=t||"normal","content"==e.type&&("normal"!=e.state&&"maximized"!=e.state||"normal"!=t||(i=i.concat(e.views)));let n=e.children;if(null!=n){let o="normal"==e.state&&(t="normal")?"normal":"closed";for(let e=0;e<n.length;e++){let t=n[e];i=i.concat(l(t,o))}}return i}return e.extend({init:function(e,t,i){this._parent({}),this._eventMgr=e,this._runOptions=t,this._eventTokens={},this._layout=null,this._panelSpecSet={},this._swapIsEnabled=!0,this._isToolbarCreated=!1,this._CCM=i,this.elements.container=UWA.createElement("div",{id:"compare-result-frame"}),this._layout=null},_createLayoutPromise:function(e){var i={container:this.elements.container,tabOnlyDocking:"smartphone"===o.getDeviceType(),resultFrame:this};let n=new t(i);n.onViewOpened(this.onViewOpenedCB.bind(this)),n.onViewClosed(this.onViewClosedCB.bind(this));let s=e+"_"+o.getDeviceType();return r.loadSettingsPromise([s]).then((()=>(r.savePrefsTimestampAndEnableUpdate(),r.sync(n,s,"layout",null))))},onViewOpenedCB:function(e){let t=e.getName();console.log("VIEW "+t+" OPENED"),console.log("probs -- compare actionName changes from "+s.getActionName()+" to Enable Option"),s.setActionName("Enable Option"),console.log("probs -- compare action applied on type changes from "+s.getActionAppliedOn()+" to Views"),s.setActionAppliedOn("Views"),console.log("probs -- compare action target changes from "+s.getActionTarget()+" to "+t),s.setActionTarget(t);let i=this._layout?.getActiveViews();console.log("probs -- compare current dispalyed views changes from [ "+s.getDisplayedViews()+" ] to [ "+i+" ]"),s.setDisplayedViews(i),s.trackEnableDisableAction(),this._eventMgr.publish({event:"VIEW_OPENED",data:{eventName:"VIEW_OPENED",view:e}})},onViewClosedCB:function(e){let t=e.getName();console.log("VIEW "+t+" CLOSED"),console.log("probs -- compare actionName changes from "+s.getActionName()+" to Disable Option"),s.setActionName("Disable Option"),console.log("probs -- compare action applied on type changes from "+s.getActionAppliedOn()+" to Views"),s.setActionAppliedOn("Views"),console.log("probs -- compare action target changes from "+s.getActionTarget()+" to "+t),s.setActionTarget(t);let i=this._layout?.getActiveViews();console.log("probs -- compare current dispalyed views changes from [ "+s.getDisplayedViews()+" ] to [ "+i+" ]"),s.setDisplayedViews(i),s.trackEnableDisableAction(),this._eventMgr.publish({event:"VIEW_CLOSED",data:{eventName:"VIEW_CLOSED",view:e}})},_createLayout:function(e){var i={name:e,container:this.elements.container};return new t(i)},update:function(e,t,o,r){this.elements.container.innerHTML="",null==this._runOptions||"MERGE"!==this._runOptions.app&&"NRF"!==this._runOptions.app||(this._useDatabaseSelected=!widget.getBool("useIndexForMerge")),this.MainToolbarModule||(this.MainToolbarModule=new i),this._isToolbarCreated||(this.toolbarContainer=UWA.createElement("div",{class:"compare-main-toolbar-container"}),this.toolbarContainer.inject(this.elements.container),this.MainToolbarModule.createToolbar(this,this._eventMgr,this.toolbarContainer,e,t,o,r),this._isToolbarCreated=!0);let s=this._layout.buildUI();s.length&&n.showAlertBox("NEW_VIEWS_MESSAGE",a,"info",!1,{newViews:s.reduce(((e,t,i,n)=>e+(i<n.length-1?",":"")+t),"")}),this._isToolbarCreated&&this.MainToolbarModule&&this.MainToolbarModule.updateToolbar()},setToolbarCreated:function(){this._isToolbarCreated=!0},addPanel:function(e,t){(this._createLayout&&void 0===this._layout||null===this._layout)&&(this._layout=this._createLayout("Layout-"+e.name)),this._panelSpecSet[e.name]=e,this._layout.addRow(e.panel),this.update()},setAllPanels:function(e,t,i,n,r,s,a,l){function u(e,t){var i="ROW"===Object.keys(e)[0].toUpperCase()?"addRow":"addCol";(Object.values(e)[0].constructor!==Array?[Object.values(e)[0]]:Object.values(e)[0]).forEach((e=>{if(e.constructor===String)null!=n[e]&&t[i](n[e].panel);else if(e.constructor===Array){let o=e.map((e=>n[e]?.panel)).filter((e=>null!=e));t[i](o)}else e.constructor===Object&&u(e,t[i]())}))}var c=this;return c._panelSpecSet=n,new Promise((function(n,d){c._createLayoutPromise(e+"_"+t).then((e=>{if(c._layout=e,"smartphone"===o.getDeviceType())c._layout.addRow(Object.keys(c._panelSpecSet).map((e=>c._panelSpecSet[e].panel)));else if(null!=i)u(i,c._layout);else{Object.keys(c._panelSpecSet).forEach((function(e){var t=c._panelSpecSet[e].panel;c._layout.addRow(t)}))}c.update(r,s,a,l),n()}))}))},getActiveViewNamesFromPrefs:function(){let e=JSON.parse(this._layout.layout),t=null;return null!=e&&(t=l(e)),t},updateToolbarCustomProfile:function(){this.MainToolbarModule.updateComparisonProfileDropdownUI()},refreshFrame:function(){this.updateToolbarCustomProfile()},applyDefaultLayout:function(){this._layout.restoreLayoutAllVisable(),this.MainToolbarModule.updateToolbar()},onPanelMaximized:function(){this.MainToolbarModule.updateToolbar()},onPanelRestoredFromMaximized:function(){this.MainToolbarModule.updateToolbar()},onProfileManagerDone:function(){void 0!==this.MainToolbarModule&&null!==this.MainToolbarModule&&this.MainToolbarModule.updateComparisonProfileDropdownUI()},destroy:function(){for(var e in this._eventTokens)this._eventMgr.unsubscribe(this._eventTokens[e]),this._eventTokens[e]=null;this._eventMgr=null,this._ccm=null,this._isToolbarCreated=!1,this._panelSpecSet={},this.MainToolbarModule.destroyToolbar(),this._parent()}})})),define("DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structOpenWithMenu",["UWA/Class","WebappsUtils/WebappsUtils","DS/i3DXCompassServices/i3DXCompassPubSub","DS/CompareCommon/launchTree","DS/i3DXCompassPlatformServices/OpenWith","i18n!DS/CompareWidget2/assets/nls/CompareV2"],(function(e,t,i,n,o,r){"use strict";var s=[];function a(e){if(e.widgetId===widget.id){for(var t=[],n=0;n<e.data.items.length;n++)t.push(e.data.items[n].path);var o=null;for(n=0;null==o&&n<s.length;)o=s[n].buildLaunchJSON(t),n++;if(null==o)return void console.error("Cannot find selection in either tree (this should not happen)");var r={appId:e.appId,widgetId:e.widgetId,fileName:"-file",fileContent:o};i.publish("launchApp",r)}}return e.extend({init:function(e){this._structComparePanel=e.structComparePanel,i.subscribe("setTypesCallback",a)},getOpenWithMenuPromise:function(e,t,i){var o=this;return new Promise((function(r){var a=e.cellInfos.nodeModel.getRoot(),l=!1;for(const e of s)a.options.data.getPath()===e._pathWithStrArray[0]&&(l=!0);if(!l){for(var u=(a=e.cellInfos.nodeModel._getTrueRoot()).getAllDescendants().map((function(e){return e.options.data.getPath()})),c=new n([]),d=0;d<u.length;++d){var p=u[d].split("/");c._pathWithArray.push(p),c._pathWithStrArray.push(p.join(","))}s.push(c)}require(["DS/PADUtils/PADUtilsServices","DS/PADUtils/PADTypesMgt","DS/PADUtils/PADProbes"],(function(n,s,a){n.app_initialization((function(){var n=[];for(var a of t){let e=a.options.data.getObjIDSpec_REF();null!=e&&n.push(e.getObjType())}s.retrieveHierarchy(n,(function(s){for(var a=[],l=0;l<n.length;++l)a[l]=n[l],null!=s&&void 0!==s[n[l]]&&null!==s[n[l]]&&(a[l]=s[n[l]]);for(var u=t.map((function(e){return e.options.data.getPath()})),c=[],d=0;d<t.length;++d){var p=u[d].split("/").map((function(e){return{resourceid:e}}));let e=[p[p.length-1]];var h=t[d].options.data._objIDSpecREF;null!=h&&c.push({contextId:h.getSecurityContext(),envId:h.getTenant(),objectId:h.getPhysID(),objectTaxonomies:a[d],objectType:h.getObjType(),path:!0===i.useSelectionInContext?p:e,serviceId:h.getServiceName()})}var _={protocol:"3DXContent",version:"1.1",source:"ENOCOMP_AP",widgetId:widget.id,data:{items:c}};o._getOpenWithMenuPromise(e,_).then((function(e){r(e)}))}))}))}))}))},_getOpenWithMenuPromise:function(e,t){return new Promise((function(i){var n=[],s=(e.cellInfos.nodeModel.options.data._objIDSpecREF,function(e){for(var t=e.cellInfos.nodeModel;0!==t._nodeDepth;)t=t._parentNode;return t.options.data._objIDSpecREF}(e));if("3DShape"===s.getObjType()||widget.isWebInWin)i(n);else{var a=new o;a.set3DXContent(t,!0),UWA.is(a.retrieveCompatibleApps,"function")?a.retrieveCompatibleApps((function(e){var t=[];if(e.forEach((function(e){t.push({type:"PushItem",title:e.text,fonticon:void 0!==e.fonticon&&null!==e.fonticon&&e.fonticon.length>0?{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+e.fonticon,family:WUXManagedFontIcons.Font3DS}:void 0,icon:void 0!==e.icon&&null!==e.icon&&e.icon.length>0?e.icon:"",action:{callback:function(){e.handler()}}})})),t.length>0)var n={type:"PushItem",icon:"open-menu-dot",title:r.OpenWith,submenu:t};i(n)})):i(n)}}))},clearLaunchTreeArray:function(){s=[]}})})),define("DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structExpandCollapseMenu",["UWA/Class","DS/CompareCommon/Utils","i18n!DS/CompareWidget2/assets/nls/CompareV2"],(function(e,t,i){"use strict";return e.extend({init:function(e){this._structComparePanel=e.structComparePanel},getExpandCollapseContextMenu:function(e,t){var i=this.getExpandCollapseMenu(t);return function(e){return null==e||void 0===e.cellInfos||null===e.cellInfos||void 0===e.cellInfos.nodeModel||null===e.cellInfos.nodeModel||void 0===e.cellInfos.nodeModel._options||null===e.cellInfos.nodeModel._options||void 0===e.cellInfos.nodeModel._options.children||null===e.cellInfos.nodeModel._options.children}(e)?null:UWA.extend({...i.find((e=>e.id===t))},{type:"PushItem",submenu:i})},getExpandCollapseMenu:function(){var e=this;return[{id:"expandAll",icon:"flow-tree-expand-down",title:i.ExpandAll,tooltip:t.generateTooltip("CompareWidget2/Tooltips","ExpandAll")},{id:"expandNLevels",icon:"flow-tree-expand-down-cog",title:i.ExpandNLevels,tooltip:t.generateTooltip("CompareWidget2/Tooltips","ExpandNLevels")},{id:"collapseAll",icon:"flow-tree-expand-up",title:i.CollapseAll,tooltip:t.generateTooltip("CompareWidget2/Tooltips","CollapseAll")}].map((t=>({type:"CheckItem",id:t.id,icon:t.icon,title:t.title,tooltip:t.tooltip,state:e._structComparePanel.getActiveExpandMenuId()===t.id?"selected":"",action:{callback:()=>e._structComparePanel.handleToolbarCommands({event:t.id,data:{icon:t.icon}})}})))}})})),define("DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_node",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/dbObj"],(function(e,t){var i=function(i,n){var o;this._dbObj_REF=null,this._dbObj_INST=null,this._childArray=[],this._parent=null,this._dbContext={},o=i,ret=!0,null!=o&&o.constructor!=t&&(e.errout("[INVALID] refInst_node receives unexpected type"),ret=!1),ret&&(this._dbObj_REF=i),this._dbObj_INST=n,this._reqModforODT="DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_node"};return i.prototype.makeDupe=function(){var e=this,t=e._dbObj_REF.makeDupe(),n=null!=e._dbObj_INST?e._dbObj_INST.makeDupe():null,o=new i(t,n);return o._parent=e._parent,o._dbContext=JSON.parse(JSON.stringify(e._dbContext)),o._childArray=[],e._childArray.forEach((function(e){var t=e.makeDupe();t._parent=o,o._childArray.push(t)})),o._reqModforODT=e._reqModforODT,null!=e._synthProps&&(o._synthProps=JSON.parse(JSON.stringify(e._synthProps))),o},i.prototype.visit_subtreeAndFN=function(e){var t=e(this);if(null!=this._childArray)for(var i=this._childArray.length,n=0;n<i&&1==t;n++){var o=this._childArray[n];null!=o&&(t=o.visit_subtreeAndFN(e))}return t},i.prototype.set_dbObj_INST=function(e){this._dbObj_INST=e},i.prototype.setDBContext=function(e){this._dbContext=e},i.prototype.getDBContext=function(){return this._dbContext},i.prototype.setParent=function(t,i){var n=!1;1==i?n=!0:null==t?e.errout("refInst_node's parent cannot be set to null... ignored"):t.constructor!=this.constructor?e.errout("refInst_node's parent can only be another refInst_node... ignored"):null!=this._parent&&this._parent!=t?e.errout("Changing parent node of a refInst_node (unexpectedly)... ignored"):n=!0,1==n&&(this._parent=t)},i.prototype.getParent=function(){return this._parent},i.prototype.addChild=function(t){null==t?e.errout("refInst_node cannot have a null child... ignored"):t.constructor!=this.constructor?e.errout("refInst_node's child must be another refInst_node... ignoring"):this._childArray.push(t)},i.prototype.rmChild=function(e){var t=[];this._childArray.forEach((function(i){i.getAttr("INST.physicalid")!=e&&t.push(i)})),this._childArray=t},i.prototype.rmAllChildren=function(){this._childArray=[]},i.prototype.getChildArray=function(){return this._childArray},i.prototype.sortChildArray=function(){var e=this._childArray.sort((function(e,t){return e.getAttr("INST.ro.plminstance.v_treeorder")-t.getAttr("INST.ro.plminstance.v_treeorder")}));this._childArray=e},i.prototype.findChid=function(e,t){for(var i=null,n=this._childArray.length,o=0;o<n;o++){var r=this._childArray[o];if(e==r.getAttr("INST.physicalid")&&t==r.getAttr("REF.physicalid")){i=r;break}}return i},i.prototype.isRoot=function(){return null==this.getParent()},i.prototype.isLeaf=function(){return 0==this._childArray.length},i.prototype.get_dbObj_REF=function(){return this._dbObj_REF},i.prototype.get_dbObj_INST=function(){return this._dbObj_INST},i.prototype.getAttr=function(t){var i=null,n=t.indexOf("."),o=t.substring(0,n),r=t.substring(n+1);return"REF"==o?i=this._dbObj_REF.getAttr(r):"INST"==o?null!=this._dbObj_INST&&(i=this._dbObj_INST.getAttr(r)):e.errout("unexpected qualifier in name: "+o),i},i.prototype.setAttr=function(t,i){var n=null,o=t.indexOf("."),r=t.substring(0,o),s=t.substring(o+1);return"REF"==r?n=this._dbObj_REF.setAttr(s,i):"INST"==r?null!=this._dbObj_INST&&(n=this._dbObj_INST.setAttr(s,i)):e.errout("unexpected qualifier in name: "+r),n},i.prototype.setSynthProp=function(e,t){null==this._synthProps&&(this._synthProps={}),this._synthProps[e]=t},i.prototype.getSynthProps=function(){return this._synthProps},i.prototype.isBSDNode=function(){return"ds6w:Term"===this.get_dbObj_REF()._attrList["ds6w:globalType"]},i.prototype.setBSDRefInstTreeSkelToRoot=function(e){this._childArray=e._rootRefInstNode._childArray;for(let e=0;e<this._childArray.length;e++){this._childArray[e].setParent(this,!0)}},i.prototype.findBSDNode=function(e){if(this.getAttr("REF.physicalid")===e)return this;let t=this.getChildArray();for(var i=0;i<t.length;i++){let n=t[i].findBSDNode(e);if(n)return n}return null},i.prototype.removeIntermediateBSDChild=function(e){let t=this.getChildArray(),i=t.findIndex((t=>t.getAttr("REF.physicalid")===e));t.splice(i,1)},i})),define("DS/CompareWidget2/userSettings/UserSettingsManager",["UWA/Core","DS/CompareCommon/Utils","DS/CompareCommon/WidgetPreferences","i18n!DS/CompareWidget2/assets/nls/CompareV2"],(function(e,t,i,n){"use strict";function o(e,i,n,o){var r={callbackList:[]};return((i,s,a)=>{let l=s;Object.defineProperty(r,"value",{enumerable:!0,configurable:!1,get:function(){return l},set:function(s){if(l!==s)if(l=s,r.callbackList.forEach((e=>e(l))),!0===widget.getValue("saveToWidgetOnly"))widget.setValue(n+"["+e+"]",l);else{t.savePrefToSession(`${a}[${i}]`,l);let e=Date.now();o.__updateSessionCacheTimestamp__&&t.savePrefTimestampToSession(a,e),!widget._isODTMode()&&t.saveUserPreferencesPromise(`${a}[${i}]`,l).then((()=>{o.__updateSessionCacheTimestamp__&&t.savePrefTimestampToDashboardPromise(a,e).then((()=>{}))}))}}})})(e,i,n),r}function r(e,n){this.disablePrefsTimestampUpdate();let r=Object.keys(e);var s;!0===widget.getValue("saveToWidgetOnly")?(r.forEach((t=>{this.userSettings[t]=o(t,widget.getValue(this.namespace+"["+t+"]"),this.namespace,this),e[t].widgetSetting&&i.addWidgetPreference(t,e[t].widgetSetting,this.get(t))})),n()):(s=this.namespace,new Promise(((e,i)=>{let n=t.getPrefTimestampFromSession(s);Number.isNaN(n)||n<=0?e(!1):t.getPrefLastSavedTimestampFromDashboardPromise(s).then((t=>{e(!(Number.isNaN(t)||t>n))}))}))).then((s=>{Promise.allSettled(r.map((e=>t[s?"getPrefFromSessionPromise":"getUserPreferencesPromise"](`${this.namespace}[${e}]`)))).then((s=>{for(var a=0,l=s.length;a<l;a++){let n=s[a];"rejected"!==n.status&&null!==n.value&&void 0!==n.value&&""!==n.value?this.userSettings[r[a]]=o(r[a],n.value,this.namespace,this):(this.userSettings[r[a]]=o(r[a],null,this.namespace,this),this.set(r[a],e[r[a]].value)),t.savePrefToSession(`${this.namespace}[${r[a]}]`,this.get(r[a])),e[r[a]].widgetSetting&&i.addWidgetPreference(r[a],e[r[a]].widgetSetting,this.get(r[a])),widget.setValue(this.namespace+"["+r[a]+"]",this.get(r[a]))}n()}))}))}return e.Class.singleton({init:function(){this.namespace="",this.userSettings={},this.__updateSessionCacheTimestamp__=!0},get:function(e){return this.userSettings[e]?this.userSettings[e].value:null},set:function(e,t){this.hasPref(e)?this.userSettings[e].value=t:this.userSettings[e]={value:t}},hasPref:function(e){return this.userSettings.hasOwnProperty(e)},sync:function(e,t,i,n){let o=this;return o.hasPref(t)&&(i=i||t,"function"==typeof n&&o.userSettings[t].callbackList.push(n),Object.defineProperty(e,i,{enumerable:!0,configurable:!0,get:function(){return o.get(t)},set:function(e){o.set(t,e)}})),e},unsync:function(e,t,i,n){let o=e[i=i||t];delete e[i],e[i]=o;var r="function"==typeof n?this.userSettings[t].callbackList.indexOf(n):-1;return r>=0&&this.userSettings[t].callbackList.splice(r,1),e},loadSettingsFromConfigPromise:function(e){return i.addWidgetPrefs("V2"),new Promise(((s,a)=>{function l(){i.addWidgetPreference("saveToWidgetOnly",{type:"boolean",label:n.saveToWidgetOnly,defaultValue:!1}),s()}require([e.configPath],(e=>{this.namespace=e.namespace;var n=function(e,t){var i={};return function e(n,o){for(let s of Object.keys(n))if("namespace"!==s)if(n[s].hasOwnProperty("value")){var r=null!=o&&o.constructor===String?o+t+s:s;i[r]={value:n[s].value},n[s].hasOwnProperty("V1Preference")&&(i[r].V1Preference=n[s].V1Preference),n[s].hasOwnProperty("widgetSetting")&&(i[r].widgetSetting=n[s].widgetSetting)}else e(n[s],null!=o&&o.constructor===String?o+t+s:s)}(e),i}(e,".");i.isV1ToV2PrefMigrationComplete(this.namespace,(()=>{r.bind(this)(n,l)}),(()=>{i.addWidgetPrefs("V2Migrate"),i.loadDefaults("compare_widget_default_prefs",(()=>t.setPreferencesToWidget(["compare_viewer_selectmode","compare_attributes_display_option","compare_attributes_not_shown","compare_attributes_not_shown_INST","compare_attributes_not_shown_EFF"],["viewer_display_mode","attributes_display_option","attributes_not_shown","attributes_not_shown_INST","attributes_not_shown_EFF"],(()=>{this.disablePrefsTimestampUpdate(),Object.keys(n).forEach((e=>{if("string"==typeof n[e].V1Preference&&n[e].V1Preference.length){let t=widget.getValue(n[e].V1Preference);this.userSettings[e]=o(e,null,this.namespace,this),this.set(e,t||n[e].value)}else if(Array.isArray(n[e].V1Preference)&&n[e].V1Preference.length){var t=n[e].V1Preference.reduce(((e,t)=>{let i=Object.keys(t)[0];return widget.getValue(i)===t[i].oldValue&&e.push(t[i].newValue),e}),[]);this.userSettings[e]=o(e,null,this.namespace,this),this.set(e,t.length?t:n[e].value)}else if("object"==typeof n[e].V1Preference){let t,i=n[e].V1Preference,r=Object.keys(i)[0];for(let e=0;e<i[r].length;e++)if(widget.getValue(r)===i[r][e].oldValue){t=i[r][e].newValue;break}this.userSettings[e]=o(e,null,this.namespace,this),this.set(e,void 0!==t?t:n[e].value)}else this.userSettings[e]=o(e,null,this.namespace,this),this.set(e,n[e].value);n[e].widgetSetting&&i.addWidgetPreference(e,n[e].widgetSetting,this.get(e)),widget.setValue(this.namespace+"["+e+"]",this.get(e))})),i.setV1ToV2PrefMigrationCompletedFlag(this.namespace).then(l)}))))}))}))}))},loadSettingsPromise:function(e){let t=this;return new Promise((i=>{let n={};e.forEach((e=>n[e]={value:null})),r.bind(t)(n,i)}))},disablePrefsTimestampUpdate:function(){this.__updateSessionCacheTimestamp__=!1},enablePrefsTimestampUpdate:function(){this.__updateSessionCacheTimestamp__=!0},savePrefsTimestampAndEnableUpdate:function(){let e=Date.now();t.savePrefTimestampToDashboardPromise(this.namespace,e).then((()=>{t.savePrefTimestampToSession(this.namespace,e),this.enablePrefsTimestampUpdate()}),(()=>{}))},resetSettings:function(){this.init()}})})),define("DS/CompareWidget2/viewComponents/ContextMenuBase",["UWA/Class"],(function(e){"use strict";return e.extend({createContextMenu:function(){return[]}})})),define("DS/CompareWidget2/plugins/STRUCTURE/expanders/expandMgr",["DS/CompareWidget2/plugins/STRUCTURE/expanders/cvExpand","DS/CompareWidget2/plugins/STRUCTURE/expanders/cvProgressiveExpand","DS/CompareWidget2/plugins/STRUCTURE/expanders/fileExpand","DS/CompareWidget2/plugins/STRUCTURE/expanders/compareServiceExpand","DS/CompareWidget2/plugins/STRUCTURE/expanders/lifecycleServicesExpand","DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/nodeOccRel2RefInstTree","DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/cv2RefInstTree","DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/pe2RefInstTree","i18n!DS/CompareWidget2/assets/nls/DisplayMessages","DS/CompareWidget2/plugins/STRUCTURE/expanders/cvProgressiveExpandWithBSD","DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/pe2RefInstTreeWithBSD","DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/pe2RefInstTreeWithPGP"],(function(e,t,i,n,o,r,s,a,l,u,c,d){var p={CV_DIRECT:{expander:e,adapter:s},CV_SERVICE:{expander:n,adapter:r},DB_SERVICE:{expander:n,adapter:r},CV_PROGRESSIVE:{expander:t,adapter:a},CV_PROGRESSIVE_PGP:{expander:t,adapter:d},CV_PROGRESSIVE_BSD:{expander:u,adapter:c},LC_IDX_SERVICE:{expander:o,adapter:s},LC_AUTH_SERVICE:{expander:o,adapter:s},FILE_CV:{expander:i,adapter:s},FILE_NOR:{expander:i,adapter:r},FILE_PE:{expander:i,adapter:a},FILE_PE_BSD:{expander:i,adapter:c}};return{expandUsingType:function(e,t,i,n,o){return new Promise((function(r,s){var a=p[t];if(null==a){var u="UNKNOWN EXPAND TYPE: '"+t+"'";n.errout(u),s(u)}return a.expander.doExpand(e,t,i,n,o).then((function(i){if("CV_PROGRESSIVE_BSD"===t)var{expandedData:u,bsdStruct:c}=i;else var u=i;if(o._ODT_FailFirstFetch&&s("ODT: failing initial fetch"),null==u||0==u.length)n.showAlertBox("RETURN_IS_BLANK",l,"warning"),s("Object query returned blank - was the root filtered out?");else{"AMD_MODULE_PATH"==e.getIDType()?n.dbgout("Expand via '"+t+"' successful for AMD Module: "+e.getPhysID()):n.dbgout("Expand via '"+t+"' successful for ID: "+e.getPhysID());var d=null;null==(d=null!=a.adapter?"CV_PROGRESSIVE_BSD"===t?a.adapter.convert(e,u,n,o,c):a.adapter.convert(e,u,n,o):u)?s("Adapter has failed..."):(d.sortChildren(),r(d))}}),(function(e){n.warnout("Failed to expand using "+t+" ::"+e),s(e)}))}))},doExpand:function(e,t,i,n,o,r){var s=this;return new Promise((function(a,l){s.expandUsingType(e,t,n,o,r).then((function(e){a(e)}),(function(t){o.warnout("Primary expansion failed: "+t),null==i?(o.errout("No secondary expand Type; can't continue!"),l(t)):(o.warnout("Attempting to expand using secondary expandType"),s.expandUsingType(e,i,n,o,r).then((function(e){o.warnout("Secondary expansion success"),a(e)}),(function(e){o.warnout("Secondary expansion failed: "+e),l(e)})))}))}))}}})),define("DS/CompareWidget2/plugins/STRUCTURE/flexibleView/ViewPanel/flagDisplayDataItem",["i18n!DS/CompareWidget2/assets/nls/CompareV2"],(function(e){return function(e,t,i,n){let o=null!=e&&null!=n&&null!=t?e[n][t]:null,r=null==o?"":o.TOOLTIP_MODULE_PATH,s=null==o?"":o.COLOR;"IDENTICAL"!=t&&""==s&&(console.warn("Missing COLOR definition; using RED (by default) for :"+t),s="#ff0000"),this.id=t,this.label=i,this.tooltip={title:i},this.modulePath=r,this.color=s,this.description="",this.flagName=t,this.NLS=i,this.matchedPairs=[],this.legendGrouping=0,this.visibleFlag=!1,this.checked=!0,this.reset=function(){this.matchedPairs=[],this.visibleFlag=!1,this.checked=!0}}})),define("DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/statusVisibilityDialog",["UWA/Class","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/Toggle","DS/Controls/ButtonGroup","i18n!DS/CompareWidget2/assets/nls/CompareV2","i18n!DS/UIKIT/assets/nls/UIKIT","css!DS/CompareWidget2/CompareWidget2.css"],(function(e,t,i,n,o,r,s,a){return e.extend({init:function(e){this._parent({}),this.OKfn=e.OKfn,this.statusVisibility={},Object.keys(e.statuses).forEach((t=>"IDENTICAL"!==t&&(this.statusVisibility[t]=e.statuses[t].visibleFlag))),this.content=this._buildContent(e.statuses),this.immersiveFrame=new t,this.immersiveFrame.inject(widget._isODTMode()?document.body:widget.body),this.dialog=new i({title:s.chooseStatusToDisplay,content:this.content,immersiveFrame:this.immersiveFrame,resizableFlag:!0,visibleFlag:!0,modalFlag:!0,width:230,buttons:{Ok:new n({label:a.ok,onClick:this._OKfn.bind(this),disabled:!1,emphasize:"primary"}),Cancel:new n({label:a.ko,onClick:this._close.bind(this),disabled:!1,emphasize:"secondary"})}}),this.dialog.addEventListener("close",this._close.bind(this))},_buildContent:function(e){function t(e){let t=e.checkFlag;e.elements.checkSign.setStyles({"background-color":!0===t?e.color:"","border-color":!0===t?e.color:""})}let i=new r({type:"checkbox"});return Object.keys(this.statusVisibility).forEach((n=>{let r=e[n],s=new o({type:"switch",label:r.label,value:r.name,checkFlag:r.visibleFlag});s.color=r.color,s.id=n,t(s),s.addEventListener("buttonclick",(()=>{t(s),this.statusVisibility[s.id]=s.checkFlag})),i.addChild(s)})),i},_close:function(){this.dialog.removeEventListener("close",this._close.bind(this)),this.dialog.destroy(),this.immersiveFrame.destroy()},_OKfn:function(){this._close(),setTimeout((()=>{this.OKfn(this.statusVisibility)}),20)}})})),define("DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/nodeOccRel2RefInstTree",["DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/exAdapter","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_tree","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_node","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/dbObj"],(function(e,t,i,n){var o=function(e){this._objIDSpec=e,this._dbObjREFByNodeID={},this._occurByID={},this._occurRelArray=[],this._rootOccurID=0,this._refInstNodeByOccurID={}};return o.prototype.addNodes=function(e,t,i,n){var o=this;e.forEach((function(e){var r=t;void 0!==e.serviceId&&null!==e.serviceId&&""!==e.serviceId&&(r=e.serviceId),void 0!==e.proxySpec&&null!==e.proxySpec&&""!==e.proxySpec&&void 0!==e.proxySpec.serviceURL&&null!==e.proxySpec.serviceURL&&""!==e.proxySpec.serviceURL&&(r=e.proxySpec.serviceURL);var s=o.node2dbObjREF(e,r,i,n);o._dbObjREFByNodeID[e.nodeid]=s}))},o.prototype.setRootOccurID=function(e){this._rootOccurID=e},o.prototype.node2dbObjREF=function(e,t,i,o){var r=function(e,n,r){if("icon"==n){var s={smallURL:o.makeServiceURL(t,i,r,null),largeURL:""};e.setAttr("typeIcons",s)}else if("cgrurl"==n&&r){var a=r.indexOf("?"),l=r.substr(0,a),u=r.substr(a+1),c=o.makeServiceURL(t,i,l,u);e.setAttr("thumbnail_3d",c),e.addAttr("ds6w:globaltype","ds6w:Document")}else{var d={"PLMEntity.V_Name":"ds6w:label",revision:"ds6wg:revision",type:"ds6w:type","PLMReference.V_DerivedFrom":"dfr","attribute[PLMEntity.V_usage]":"bo.plmentity.v_usage"}[n];null==d&&(d=n),e.setAttr(d,r)}},s=new n;return Object.keys(e).forEach((function(t){if("attributes"==t){Object.keys(e.attributes).forEach((function(t){var i=e.attributes[t];r(s,t,i)}))}else{var i=e[t];r(s,t,i)}})),null==s.getAttr("ds6w:globaltype")&&s.addAttr("ds6w:globaltype","ds6w:Part"),s},o.prototype.addOccurs=function(e,t){var i=this;e.forEach((function(e){var t={};Object.keys(e).forEach((function(i){var n=e[i];!function(e,t,i){if("xform"==t){var n=JSON.parse(JSON.stringify(i));n.splice(15,1),n.splice(11,1),n.splice(7,1),n.splice(3,1);for(var o=n.length,r=0;r<o;r++){var s=n[r];Number.isInteger(s)&&(n[r]=s.toFixed(1))}e.matrixtxt=attrVal2use=n.join(),e.matrixtxt=e.matrixtxt.replace(/e/g,"E")}else{var a={"logicalid[connection]":"logicalid"}[t];null==a&&(a=t),e[a]=i}}(t,i,n)})),i._occurByID[e.occurrenceid]=t}))},o.prototype.addOccurRels=function(e){this._occurRelArray=e},o.prototype.buildTree=function(){var e=this,o=e._occurByID[e._rootOccurID].nodeid,r=e._dbObjREFByNodeID[o],s=new i(r,null);e._refInstNodeByOccurID[e._rootOccurID]=s,this._occurRelArray.forEach((function(t){var o=t.child,r=e._occurByID[o],s=new n,a=t.relationship;s.addAttr("ds6w:type",a),Object.keys(r).forEach((function(e){var t=r[e];s.addAttr(e,t)})),s.addAttr("physicalid",t.physicalid),s.addAttr("ds6w:globaltype","Instance"),s.addAttr("ro.plminstance.v_treeorder",t.treeOrder);var l=r.nodeid,u=e._dbObjREFByNodeID[l],c=new i(u,s);e._refInstNodeByOccurID[o]=c}));var a=new t(e._objIDSpec),l=e._refInstNodeByOccurID[e._rootOccurID];return a.setRoot(l),this._occurRelArray.forEach((function(t){var i=t.parent,n=e._refInstNodeByOccurID[i],o=t.child,r=e._refInstNodeByOccurID[o];n.addChild(r),r.setParent(n)})),a},e.singleton({jsClass:"NODE_OCCUR_REL2REFINST_TREE",convert:function(e,t,i,n){var r=new o(e);r.addNodes(t.nodes,e.getServiceName(),e.getTenant(),i),r.addOccurs(t.occurrences,i),r.addOccurRels(t.occurrencerelationships),r.setRootOccurID(t.rootoccurrence);var s=r.buildTree();return r=null,s}})})),define("DS/CompareWidget2/plugins/STRUCTURE/relations/Ecosystem",["UWA/Class","DS/LifecycleServices/LifecycleServicesSettings","DS/WAFData/WAFData","i18n!DS/CompareWidget/assets/nls/CompareWidget"],(function(e,t,i,n){var o=e.extend({init:function(e){this._parent({}),this.rels=e,this.idObjMap=this.buildIdObjMap(e),this.formated=this.format(e)},addTo:function(e){for(var t=this.newAsm(e),i=Object.keys(this.formated),n=0;n<i.length;n++)this.addSourceToAsm(i[n],t)},addRootSourceToAttributes:function(e){for(var t=this.rels.New.Objects,i=0;i<t.length;i++){var n=t[i],o=e[n.id];null!=o&&(n.rootSource=o.rootSource)}},getLinkedObjectIds:function(){for(var e=[],t=(this.rels.New.Objects,this.rels.New.Links),i=0;i<t.length;i++){var n=t[i].target;-1==e.indexOf(n)&&e.push(n)}return e},format:function(e){for(var t={},i=0;i<e.New.Links.length;i++){var n=e.New.Links[i];null==t[n.source]&&(t[n.source]={});var o=t[n.source],r=n.type+"."+n.name;null==o[r]&&(o[r]=[]),o[r].push(n.target)}return t},buildIdObjMap:function(e){for(var t={},i=e.New.Objects,n=0;n<i.length;n++){var o=i[n];t[o.id]=o}return t},addSourceToAsm:function(e,t){for(var i=t.getOccs(e),n=0;n<i.length;n++)this.addSourceToOcc(e,i[n],t)},addSourceToOcc:function(e,t,i){for(var n=this.formated[e],o=Object.keys(n),r=0;r<o.length;r++){var s=o[r];this.addCategoryToSourceOcc(n,s,t,i)}},addCategoryToSourceOcc:function(e,t,i,n){var r=o.relationLabels[t];if(null!=r)for(var s=this.addToOcc(t,{Title:r.label,icon:r.icon,physicalid:t,attributes:{revision:" "}},i,n),a=e[t],l=0;l<a.length;l++){var u=a[l],c=this.idObjMap[u],d={Title:c["ds6w:label"],icon:c.icon_url,physicalid:c.id,type:c["ds6w:type"],attributes:{revision:c.revision,name:c["ds6w:identifier"],"revision-physicalid":c.id,"PLMReference.V_DerivedFrom":c.rootSource}};this.addToOcc(u,d,s,n)}},addToOcc:function(e,t,i,n){var o=n.addNode(e,t),r=n.addOcc(o.nodeid);return n.addRel(i.occurrenceid,r.occurrenceid),r},newAsm:function(e){return{asm:e,getOccs:function(e){if(this.pidOccsMap=this.pidOccsMap||{},void 0===this.pidOccsMap[e]){this.pidOccsMap[e]=[];for(var t=0;t<this.asm.occurrences.length;t++){var i=this.asm.occurrences[t];e==this.asm.nodes[i.nodeid].physicalid&&this.pidOccsMap[e].push(i)}}return this.pidOccsMap[e]},getChildOcc:function(e,t){for(var i=0;i<this.asm.occurrencerelationships.length;i++){var n=this.asm.occurrencerelationships[i];if(n.parent==e){var o=this.asm.occurrences[n.child];if(this.asm.nodes[o.nodeNdx].physicalid==t)return o}}return null},getNode:function(e){if(this.pidNodeMap=this.pidNodeMap||{},void 0===this.pidNodeMap[e]){for(var t=0;t<this.asm.nodes.length;t++){var i=this.asm.nodes[t];i.physicalid==e&&(this.pidNodeMap[e]=i)}void 0===this.pidNodeMap[e]&&(this.pidNodeMap[e]=null)}return this.pidNodeMap[e]},addNode:function(e,t){var i=this.getNode(e);return null!=i||((i=t).nodeid=this.asm.nodes.length,this.asm.nodes.push(i),this.pidNodeMap[e]=i),i},addOcc:function(e){var t={occurrenceid:this.asm.occurrences.length,nodeid:e,xform:["n/a"]};return this.asm.occurrences.push(t),t},addRel:function(e,t){var i={parent:e,child:t};this.asm.occurrencerelationships.push(i)}}}});function r(e,n,o,r){var s=widget.getValue("x3dPlatformId"),a=t.get3DSpaceWSUrl(s,e);i.authenticatedRequest(a,{method:"POST",type:"json",timeout:12e4,data:JSON.stringify(n),headers:{Accept:"application/json","Content-Type":"application/json"},onComplete:o,onFailure:r})}return o.docRels=["v6_specdoc_to","v6_annexdoc_to"],o.otherRels=["SpaceAssignment_to","RFL_implementScope_from","RFL_implementScope_to","ProposedSolution_to"],o.relationLabels={"SpaceAssignment_to.472":{label:n.spaceAssignment,icon:" "},"RFL_implementScope_from.52":{label:n.implementedBy,icon:" "},"RFL_implementScope_to.51":{label:n.implementing,icon:""},"ProposedSolution_to.ProposedSolution":{label:n.proposedSolutions,icon:""},"v6_specdoc_to.87":{label:n.attachedDocuments,icon:""},"v6_annexdoc_to.Reference Document":{label:n.attachedDocuments,icon:""},"v6_specdoc_to.SpecificationDocument":{label:n.specificationDocuments,icon:""}},o.get=function(e,t,i,n){null!=e&&t.length>0?function(e,t,i,n){var s={relations:t,countmanagement:!1,debug:!1,trueREST:!0,widgetId:widget.id,timeout:"6000",ids:e};"compareWidgetOdtId"==widget.id&&(s=null),r("/resources/enorelnav/navigate/getecosystem",s,function(e){var t=new o(e);i(t)}.bind(this),n)}(e,t,(function(e){var t=e.getLinkedObjectIds();t.length>0?function(e,t,i){for(var n=[],o=0;o<e.length;o++)n.push({id:e[o]});r("/resources/compare/index/fetchRootSource",{data:n},t,i)}(t,(function(t){e.addRootSourceToAttributes(t),i(e)}),n):i(e)}),n):i(null)},o})),define("DS/CompareWidget2/plugins/VIEW3D/ViewPanel/XSelectManager",["DS/Selection/CSOManager","DS/Selection/HSOManager","DS/ApplicationFrame/CommandsManager"],(function(e,t,i){var n=function(e){this._plugSvcs=e,this._onPostAddCSOManagerToken=null,this._onPostRemoveCSOManagerToken=null,this._updateState="NONE",this.hookupCrossSelectionCallbacks()};function o(){const e=i.getCommand("PAD3DViewerNavigateOnSelectionHdr",null);return e&&Array.isArray(e._selection)&&e._selection.length?e._selection.length:0}return n.prototype.destroy=function(){null!=me._onPostAddCSOManagerToken&&(e.unsubscribe(me._onPostAddCSOManagerToken),me._onPostAddCSOManagerToken=null),null!=me._onPostRemoveCSOManagerToken&&(e.unsubscribe(me._onPostRemoveCSOManagerToken),me._onPostRemoveCSOManagerToken=null)},n.prototype.getUpdateState=function(){return this._plugSvcs.dbgout("XSELECT","getUpdateState() returns "+this._updateState),this._updateState},n.prototype.setUpdateState=function(e){this._plugSvcs.dbgout("XSELECT","setUpdateState() to "+e),this._updateState=e},n.prototype.hookupCrossSelectionCallbacks=function(){var t=this;null!=t._onPostAddCSOManagerToken&&e.unsubscribe(t._onPostAddCSOManagerToken),t._onPostAddCSOManagerToken=e.onPostAdd((function(n){if(t._plugSvcs.dbgout("XSELECT","XXX>>> _________________________________"),t._plugSvcs.dbgout("XSELECT","XXX>>> CSOManager.onPostAdd() called, updateState = "+t.getUpdateState()),"FOCUSON"===t.getUpdateState()&&0===o()?(t._plugSvcs.dbgout("XSELECT","XXX>>> CHANGING FOCUSON to NONE"),t.setUpdateState("NONE")):"FOCUSON"!==t.getUpdateState()&&o()>0&&(t._plugSvcs.dbgout("XSELECT","XXX>>> CHANGING state to FOCUSON"),t.setUpdateState("FOCUSON")),"NONE"===t.getUpdateState()||"FOCUSON"===t.getUpdateState()){"NONE"==t.getUpdateState()&&(t._plugSvcs.dbgout("XSELECT","XXX>>> CHANGING state to INTERNAL"),t.setUpdateState("INTERNAL"));let o=e.get();if(o.length>2){const e=i.getCommand("LevelSelectorHdr",null);null!=e&&(t._plugSvcs.dbgout("XSELECT","XXX>>> ENDING EXECUTE"),e.endExecute())}"FOCUSON"!=t.getUpdateState()&&t._onViewerSelection(n,o,t._plugSvcs)}})),null!=t._onPostRemoveCSOManagerToken&&e.unsubscribe(t._onPostRemoveCSOManagerToken),t._onPostRemoveCSOManagerToken=e.onPostRemove((function(i){if(t._plugSvcs.dbgout("XSELECT","    CSOManager.onPostRemove() called, updateState = "+t.getUpdateState()),"EXTERNAL"!=t.getUpdateState()){let n=e.get();t._onViewerSelection(i,n,t._plugSvcs)}}))},n.prototype.notifyClearHighlights=function(){e.empty(),t.empty()},n.prototype.notifyNewHighlights=function(i,n){try{var r=this;if("FOCUSON"===r.getUpdateState()&&o()<2&&r.setUpdateState("NONE"),"NONE"==r.getUpdateState()){r.setUpdateState("EXTERNAL");var s=e.get();r._plugSvcs.dbgout("XSELECT","    CSOManager.empty() called in notifyNewHighlights on a count of "+s.length),e.empty(),t.empty(),i.length>0&&!1!==n&&(r._plugSvcs.dbgout("XSELECT","    CSOManager.add() called in notifyNewHighlights with a count of "+i.length),e.add(i),t.add(i)),r.setUpdateState("NONE")}else"FOCUSON"==r.getUpdateState()||r.setUpdateState("NONE")}catch(e){r._plugSvcs.errout("EXCEPTION working with CSO/HSO managers: "+e)}},n.prototype._onViewerSelection=function(e,t){var i=this,n=t.length;if(n>0){i._plugSvcs.dbgout("XSELECT","XSELECT_MANAGER _onViewerSelection "+n+" selections"),this._plugSvcs.dbgout("XSELECT","structComparePanel._onViewerSelection "+n+" selections");var o=function(e){var t=[];return e.forEach((function(e){for(var i="",n=e.pathElement.externalPath,o=1;o<n.length;o++){var r=n[o].modelIdentification;if(null!=r){var s=r.lastIndexOf(".");i+="/"+r.substr(0,s)}}t.push(i)})),t}(t);i._plugSvcs.postEvent("3DVIEW_NODES_SELECTED_EVENT",{nodePathArray:o})}else i._plugSvcs.dbgout("XSELECT","XSELECT_MANAGER _onViewerSelection no selections"),i._plugSvcs.dbgout("XSELECT","structComparePanel._onViewerSelection 0 selections (clear)"),i._plugSvcs.postEvent("3DVIEW_ALL_NODES_UNSELECTED_EVENT",{})},n})),define("DS/CompareWidget2/plugins/STRUCTURE/refInstTree/hierResultList",[],(function(){var e=function(e,t){this._nodePair_byIndexArray=[],this._nodeArray_base=e,this._nodeArray_comp=t,this.indexMax_base=e.length,this.indexMax_comp=t.length};return e.prototype.destroy=function(){this._nodePair_byIndexArray=null,this._nodeArray_base=null,this._nodeArray_comp=null},e.prototype.add=function(e,t,i,n,o,r,s){var a=this,l={index_base:e,index_comp:t,relIndex:i,relName:n,adjIndex:o,adjFlagArray:r,instFlagNdxs:s||[]};null==a._nodePair_byIndexArray[i]&&(a._nodePair_byIndexArray[i]=[]),null==a._nodePair_byIndexArray[i][o]&&(a._nodePair_byIndexArray[i][o]=[]),a._nodePair_byIndexArray[i][o].push(l)},e.prototype.getResult=function(){var e=this,t=new Array(e.indexMax_base),i=new Array(e.indexMax_comp),n=[];e._nodePair_byIndexArray.forEach((function(o,r){o.forEach((function(o,r){o.forEach((function(o){var s=o.index_base,a=o.index_comp;if(null==t[s]&&null==i[a]){t[s]="X",i[a]="X";var l={node_base:e._nodeArray_base[s],node_comp:e._nodeArray_comp[a],relName:o.relName,adjustment:r,adjFlagArray:o.adjFlagArray,instFlagNdxs:o.instFlagNdxs||[]};n.push(l)}}))}))}));for(var o=[],r=t.length,s=0;s<r;s++)null==t[s]&&o.push(e._nodeArray_base[s]);for(var a=[],l=i.length,u=0;u<l;u++)null==i[u]&&a.push(e._nodeArray_comp[u]);return{matchedNodePairArray:n,unmatchedNodeArray_base:o,unmatchedNodeArray_comp:a}},e})),define("DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structRelationsMenu",["UWA/Class","UWA/Utils/InterCom","i18n!DS/CompareWidget2/assets/nls/CompareV2"],(function(e,t,i){"use strict";return e.extend({init:function(e){},getRelationsMenuItem:function(e){if(!(e&&e.cellInfos&&e.cellInfos.nodeModel&&e.cellInfos.nodeModel.options))return null;var n=e.cellInfos.nodeModel.options.data;if(!n)return null;var o=n.getObjIDSpec_REF();if(!o)return null;var r=o.getPhysID(),s=o.getObjType(),a=n.getAttr("title");return{type:"PushItem",title:i.Relations,fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-object-related",family:WUXManagedFontIcons.Font3DS},action:{callback:function(e){var i=require("DS/PADUtils/PADCommandProxy").create();require(["DS/PADUtils/PADUtilsServices"],(function(e){var n=[];n.push({envId:o.getTenant(),serviceId:o.getServiceName(),contextId:o.getSecurityContext(),objectId:r,objectType:s,displayName:a});var l={protocol:"3DXContent",version:"1.0",source:"ENOLCMI_AP",data:{items:n}},u={attributes:{},paths:[],version:"1.1"};u.attributes[r]={label:a,type:s},u.paths.push([r]);var c=new t.Socket("compassPageSocket");c.subscribeServer("com.ds.compass",window.parent),c.dispatchEvent("onSetX3DContent",l,"compassPageSocket"),c.addListener("launchApp",(function(e){i.select(u),i.destroy()})),c.dispatchEvent("onLaunchApp",{appId:"ENORIPE_AP"},"compassPageSocket")}))}}}}})})),define("DS/CompareWidget2/userSettings/SettingsBase",["i18n!DS/CompareWidget2/assets/nls/CompareV2"],(function(e){"use strict";return{namespace:"",compareSettings:{},viewSettings:{PROP_VIEW:{showOnlyDifferences:{value:!1},attributes_display_option:{value:"",V1Preference:"compare_attributes_display_option"},default_attributes:{value:["label","owner","current","modified","type","originated","revision"]},attributes_always_shown:{value:["label"]},attributes_not_shown:{value:"",V1Preference:"compare_attributes_not_shown"}},STRUCT_VIEW:{display_mode:{value:"tree"},currentViewID_MULTI:{value:""},currentViewID_SG:{value:null},statuses_to_hide:{value:[],V1Preference:[{openness_revisions:{oldValue:!0,newValue:"REVISION"}},{openness_duplicates:{oldValue:!0,newValue:"DUPE"}}]},statuses_unchecked:{value:[]},multi_statuses_to_hide_and:{value:!1,widgetSetting:{type:"boolean",label:e.uncheckBothPrimaryAndSecondary,defaultValue:!1}},show_3dshape_of_3dpart:{value:!1,widgetSetting:{type:"boolean",label:e.show3dShapeOf3dPart,defaultValue:!1}}}},exportSettings:{exportOldFormat:{value:!1,widgetSetting:{type:"boolean",label:e.exportOldFormat,defaultValue:!1}}}}})),define("DS/CompareWidget2/plugins/VIEW3D/ViewPanel/view3DComparePanel",["DS/CustomizableLayout/View","i18n!DS/CompareWidget2/assets/nls/CompareV2"],(function(e,t){"use strict";var i=["DS/ENOPAD3DViewer/PAD3DViewer","DS/DMU3DCompareAPI/DMU3DCompareAPI","DS/UIKIT/Mask","DS/CompareWidget2/plugins/VIEW3D/ViewPanel/exclusiveHideShowController"],n=null,o=null,r=null,s=null;return e.extend({init:function(e,t,i){this._parent(),this.__startTime=t.nowMS(),t.reportTime(this.__startTime,"[3DVIEW] Creating new view3DComparePanel"),this._plugSvcs=t,this._viewer3D=null,this._compareAPI3D=null,this._colors={BASELINE:i.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR,COMPARE:i.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR,COMMON:"#EEEEEE"},this._viewer3DIsCreated=!1,this._viewerIsLoaded=!1,this._initialCompareDone=!1,this._deferred_showResultsArg=null,this._deferred_updateSelectedArg=null,this.elements.container=e,t.reportTime(this.__startTime,"[3DVIEW] view3DComparePanel construction finished")},createViewer:function(){var e,t=this;0==t._viewer3DIsCreated&&(e=function(){t._viewer3D=t._buildPAD3DViewer(),t._viewer3DIsCreated=!0},require(i,(function(t,i,a,l){n=t,o=i,r=a,s=l,e()}),(function(e){console.error("FAILED TO LOAD PAD3DVIEWER MODULE: "+e)})))},destroy:function(){null!=this._viewer3D&&(this._viewer3D.empty(),null!=this._viewer3D.flushModel&&this._viewer3D.flushModel(),this._viewer3D.destroy(),this._viewer3D=null),this._compareAPI3D=null,this._plugSvcs=null,this._deferred_showResultsArg=null,this._deferred_updateSelectedArg=null,this.elements=null},_buildPAD3DViewer:function(){var e=this,t={widget:widget,css_view_class:"windowed",visuProgressiveTileModel:!0,allowAuthoring:!1,activateProbes:!1,actionbar_corrected:!0,interwidgetComAvailability:!1,supportWorldOrientation:!0,windowOptions:{workbench:"CompareViewerCmd.xml",workbenchModule:"CompareWidget",robotVisibility:!1,automaticReframePolicy:!0,allowDnD:!1,defaultStatusBarVisibility:!1,defaultContextualMenuVisibility:!0,defaultContextualBarVisibility:!0,viewerOptions:{highlight:{activated:!0,displayHL:!0,gpu:!0,computeNormalDepth:!0,primitive:!1,trapSelection:!0,trapGPU:!0,trapPrimitive:!1}},contextualMenuContent:{workbenchName:"CompareViewerContextualBar",module:"CompareWidget",fileName:"CompareViewerContextualBar.xml",geometry:{firstLevel:["CompareViewerFocusOnHdr","ReframeOnHdr"],toggleVisu:null}}}};e._plugSvcs.reportTime(e.__startTime,"[3DVIEW] Creating PAD3DViewer");var i=new n(t);e._plugSvcs.reportTime(e.__startTime,"[3DVIEW] PAD3DViewer created");var o=i.subscribe({event:"onReady"},(function(){i.unsubscribe(o),e._plugSvcs.reportTime(e.__startTime,"[3DVIEW] pad3DViewer reports ready"),e._padReadyCB()}));return i},_padReadyCB:function(){var e=this,t=!1,i=widget.getPreferences();i.forEach((e=>{"xPref_3DEXPERIENCE_PLATFORM"!==e.name&&"pad_security_ctx"!==e.name||"hidden"===e.type||(e.type="hidden",t=!0)})),t&&widget.setPreferences(i),e._viewer3D.render().inject(e.elements.container);var n=e._viewer3D.getHideShowController();e._exclusiveHideShowController=new s(n);if(e._compareAPI3D=new o(e._viewer3D._frmWindow,{activateXHighlight:!0,ctxViewer:e._viewer3D}),e._compareAPI3D.setLegendVisibleFlag(!1),e._viewerIsLoaded=!0,null!=e._deferred_showResultsArg){var r=e._deferred_showResultsArg;e._deferred_showResultsArg=null,e._doShowResults(r)}},showResults:function(e){var t=this;return new Promise((function(i,n){t._compareOKFn=i,t._compareKOfn=n,0==t._viewerIsLoaded?(t._deferred_showResultsArg=e,t.createViewer()):(t._initialCompareDone=!1,t._doShowResults(e))}))},_doShowResults:function(e){this.__startTime=this._plugSvcs.nowMS(),this._plugSvcs.reportTime(this.__startTime,"[3DVIEW] view3DComparePanel._doShowResults() called");var t=this;t._loadViewerJSONS(e).then((function(i){if(t._do3DCompare(e),t._initialCompareDone=!0,t._deferred_updateSelectedArg){var n=t._deferred_updateSelectedArg;t._deferred_updateSelectedArg=null,setTimeout((function(){t._doUpdateSelected(n,!0),t._signalCompareDone(!0)}),0)}else t._signalCompareDone(!0)}),(function(e){t._signalCompareDone(!1)}))},_signalCompareDone:function(e){var t=this,i=null;t._plugSvcs.reportTime(t.__startTime,"[3DVIEW] Signaling compare is done"),i=1==e?t._compareOKFn:t._compareKOFn,t._compareOKFn=null,t._compareKOFn=null,null==i?this._plugSvcs.errout("trying to signal 3DCompare done but no report function available"):i()},_checkForViewables(e){let t=null==e?0:e.length,i=!1;for(var n=0;n<t&&0==i;n++){let t=e[n].structure.results,r=t.length;for(var o=0;o<r;o++){let e=t[o];if(null!=e.thumbnail_3d||null!=e.cgr){i=!0;break}}}return i},_loadViewerJSONS:function(e){var t=this;t._plugSvcs.dbgout("3DVIEW","LOADING VIEWER JSONS...");let i=this._checkForViewables(e);return new Promise((function(n,o){var r=t._viewer3D.subscribe({event:"onLoadingComplete"},(function(){t._plugSvcs.dbgout("3DVIEW","...LOADING VIEWER JSONS COMPLETE"),t._plugSvcs.reportTime(t.__startTime,"[3DVIEW] EVENT: PAD3DViewer.onLoadingComplete"),t._viewer3D.unsubscribe(r),t._viewer3D.reframe(),0==i&&n()})),s=t._viewer3D.subscribe({event:"onEndProgressiveLoad"},(function(e){1==e.memoryFull&&t._plugSvcs.showAlertBox("Load Failed / Out of Memory",null,"error"),t._viewer3D.unsubscribe(s),t._viewer3D.reframe()})),a=t._viewer3D.subscribe({event:"onRepresentationLoaded"},(function(e){t._plugSvcs.dbgout("3DVIEW","...LOADING VIEWER REPRESENTATIONS COMPLETE"),t._plugSvcs.reportTime(t.__startTime,"[3DVIEW] EVENT: REP LOADED COMPLETED"),t._viewer3D.unsubscribe(a),1==i&&n()}));t._plugSvcs.reportTime(t.__startTime,"[3DVIEW] will now call PAD3DViewer.loadJSON()"),t._viewer3D.loadJSON({data:e})}))},_do3DCompare:function(e){var t=this;try{t._plugSvcs.reportTime(t.__startTime,"[3DVIEW] Will now call DMU3DCompareAPI.compare()"),t._plugSvcs.dbgout("3DVIEW","Retrieving viewer paths for roots...");var i=t._getViewerPath(e[0].rootID),n=t._getViewerPath(e[1].rootID),o=t._buildDMUOptions(i,n);null!=t._compareAPI3D&&t._compareAPI3D.compare(o),t._plugSvcs.reportTime(t.__startTime,"[3DVIEW] DMU3DCompareAPI.compare() now finished")}catch(e){t._plugSvcs.showAlertBox("3DComparison failed",null,"error"),t._plugSvcs.errout("Exception performing 3D Compare: "+e.stack)}},updateSelected:function(e,t){var i=this;i._deferred_CrossHighlight=t,0==i._initialCompareDone?i._deferred_updateSelectedArg=e:setTimeout((function(){i._doUpdateSelected(e,!0)}),0)},_doUpdateSelected:function(e,t){this._plugSvcs.reportTime(this.__startTime,"[3DVIEW] BEGIN doUpdateSelected()"),this._plugSvcs.dbgout("3DVIEW","'doUpdateSelected()' is fetching viewer paths");for(var i=this,n=[],o=[],s=e.length,a=0;a<s;a++){var l=e[a];null!=l&&(n[a]=[],l.forEach((function(e){var t=i._getViewerPath(e);if(null!=t){n[a].push(t);var r=e.split("/");o.push(r)}})))}setTimeout((function(){r.mask(i.elements.container),i.elements.container.getElement(".spinner").addClassName("in"),i._updateViewer("update",o).then((function(e){if(null!=i._compareAPI3D){let e=i._plugSvcs.nowMS();if(1==t){var o=i._buildDMUOptions(n[0],n[1]);o.noAutomaticReframe=!0,i._compareAPI3D.updateCompareModel(o)}i._plugSvcs.reportTime(e,"[3DVIEW] END DMU3DCompareAPI.updateCompareModel() ")}null!=i._deferred_CrossHighlight&&i._deferred_CrossHighlight.status&&i._deferred_CrossHighlight.doneCB(i._deferred_CrossHighlight),i._deferred_CrossHighlight=null,r.isMasked(i.elements.container)&&r.unmask(i.elements.container)}),(function(e){i._plugSvcs.errout("[3DVIEW] Cannot update View3D:: "+e)}))}),0)},_updateViewer:function(e,t){this._plugSvcs.dbgout("3DVIEW","+++++++++ UPDATING VIEW with command'"+e+"' +++++++++++++++");var i=this,n=null,o=null;return"hide"==e?(n=i._exclusiveHideShowController.hide,o="onHide"):"show"==e?(n=i._exclusiveHideShowController.show,o="onShow"):"update"==e&&(n=i._exclusiveHideShowController.exclusiveShow,o="onExclusiveShow"),new Promise((function(e,r){if(null==n)r("bad opName in 'doUpdate'");else{let a=i._plugSvcs.nowMS();var s=i._exclusiveHideShowController.subscribe({event:o},(function(){try{i._exclusiveHideShowController.unsubscribe(s),i._plugSvcs.reportTime(a,"[3DVIEW] END _exclusiveHideShowController.doUpdateSelected("+o+")"),e()}catch(e){i._plugSvcs.errout("Failure performing explusive show"),r()}}));try{n.call(i._exclusiveHideShowController,{paths:t})}catch(e){i._exclusiveHideShowController.unsubscribe(s),i._plugSvcs.errout("exception performing exclusive show"),r()}}}))},_getViewerPath:function(e){var t="";try{var i=null!=e?e.split("/"):[];t=this._viewer3D.getController().buildPathFromArray(i)}catch(e){this._plugSvcs.warnout("[3DVIEW] EXCEPTION trying to get viewer path: "+e)}return t},_makeTreeEntry:function(e,t,i,n){var o={};return null==n||n.constructor==Array&&null==n[0]?o=null:(o={name:e,nls:t,color:i},n.constructor==Array?o.pathElements=n:o.pathElement=n),o},_buildDMUOptions:function(e,t){var i=null==e||e.constructor==Array&&0==e.length,n=null==t||t.constructor==Array&&0==t.length,o=!i&&!n,r=i?null:this._colors.BASELINE,s=n?null:this._colors.COMPARE,a={panel:"reduce",TitleNls:"NLS_TITLE",Common:{nls:"NLS_Common",color:this._colors.COMMON}};return(n||o)&&(a.Old=this._makeTreeEntry("L","NLS_LEFT",r,i?t:e)),(i||o)&&(a.New=this._makeTreeEntry("R","NLS_RIGHT",s,n?e:t)),a},clearView:function(e){null!=this._viewer3D&&(this._plugSvcs.dbgout("3DVIEW",".........CLEARING VIEW..............."),this._viewer3D.empty())},getLabel:function(){return t.Compare3DPanelTitle},getName:function(){return"view3d"}})})),define("DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInstTreeEditor",["DS/CompareWidget2/plugins/STRUCTURE/refInstTree/dbObj"],(function(e){function t(t,i,n,o,r){var s=!1,a=!1,l=null;return null==o?a=!0:(l=function(e,t,i){var n=function(e,t,i){var n=[];return e.visit_riTreeAndFN((function(e){if(e.getAttr("INST.physicalid")==i){var o=e.getParent();(null!=o?o.getAttr("REF.physicalid"):null)==t&&n.push(o)}return!0})),n}(e,t,i);return n.forEach((function(e){e.rmChild(i)})),n}(t,n,o),null!=l&&(a=!0)),1==a&&(s=null==r||function(t,i,n,o,r){var s=!1;null==r&&(r=function(e,t){var i=[];return e.visit_riTreeAndFN((function(e){e.getAttr("REF.physicalid")==t&&i.push(e)})),i}(t,n));var a=null;return i.forEach((function(e){e.getObjIDSpec().getPhysID()!=o||(a=e)})),null!=a&&(r.forEach((function(t){var i=new e;i.setAttr("did",null),i.setAttr("ds6w:type","VPMInstance"),i.setAttr("logicalid","00000000000000000000000000000001"),i.setAttr("matrixtxt","1.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0"),i.setAttr("physicalid","00000000000000000000000000000001");var n=a.getRoot();n.set_dbObj_INST(i),t.addChild(n),n.setParent(t)})),s=!0),s}(t,i,n,r,l)),s&&a}return{applyCommands:function(e,t,i,n,o){var r=this,s=!1;if(1==e.get_editsHaveBeenApplied())r._plugSvcs.errout("Edit commands already applied to assembly... ignoring...");else{var a=!1;t.forEach((function(t){if(0==r.applyCommand(e,t,i,n)){a=!0;var s="refInstTreeEditor: Command '"+JSON.stringify(t)+"' failed :: ";if(1==o)return void r._plugSvcs.errout(s+" edits to structure aborted at point of failure.");r._plugSvcs.errout(s+" edits to structure continue, skipping this command...")}})),s=!a}return s},applyCommand:function(e,i,n,o){var r=!1,s=null;if(null==i)s="refInstTreeEditor given null command; skipping";else{var a=i.parent,l=null,u=null;switch(i.op){case"INSERT":null==(l=i.inNode)&&(s="Op is INSERT, but inNode is missing");break;case"REMOVE":null==(u=i.rmNode)&&(s="Op is REMOVE, but rmNode is missing");break;case"REPLACE":null==(l=i.inNode)&&(s="Op is REPLACE, but inNode is missing"),null==(u=i.rmNode)&&(s="Op is REPLACE, but rmNode is missing");break;default:s="UNSUPPORTED command in edits list: '"+i.op+"', skipping..."}}return null!=s?me._plugSvcs.errout(s):r=t(e,n,a,u,l),r}}})),define("DS/CompareWidget2/plugins/STRUCTURE/expanders/fileExpand",[],(function(){return{jsName:"FILE_EXPAND",doExpand:function(e,t,i,n,o){return new Promise((function(t,i){var o=e.getPhysID();n.dbgout("  ... loading file: "+o);try{require([o],(function(e){var i=null!=e.results?e.results:e;t(i)}),(function(e){i(e)}))}catch(e){n.errout("Exception trying to load data file:: "+modulePath+"::"+e)}}))}}})),define("DS/CompareWidget2/plugins/STRUCTURE/STRUCT_CUST_ATTRS_PREP_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/STRUCTURE/Utils/MaturityUtils"],(function(e,t){return e.extend({init:function(e,t,i,n){this._parent(e,t,i,n)},execute:function(e,i){var n=this;n._parent(e,i);let o=e.crTreeArray,r=[];!0===i?.pluginOptions?.COMPUTE_CUST_ATTRS?o.forEach((function(e){r.push(t.prepTreeForMaturityAndPolicyPromise(e,n._plugSvcs))})):r.push(Promise.resolve()),Promise.all(r).then((()=>{null!=e?n.reportOK(e):n.reportKO()}))}})})),define("DS/CompareWidget2/widget/controls/TreesContainer",["UWA/Controls/Abstract"],(function(e){"use strict";return e.extend({name:"treesContainer",init:function(e){this._panels=[],this._parent(e),this._buildLayout()},addPanel:function(e){e.inject(this.getContent()),this._panels.push(e),e.addEvent("collapseChange",this._updateLayout.bind(this))},setPanelCaption:function(e,t){this._panels.find((t=>t.options.contentId===e)).setCaption(t)},_updateLayout:function(){var e=this._panels.length,t=this._panels.reduce((function(e,t){return e+(t.isCollapsed()?0:1)}),0);2===e&&t>0&&this._panels.forEach((function(e){e.isCollapseable()&&2===t&&e.setSize50pct()})),3!==t&&4!==t||this._panels.forEach((function(e){e.isCollapseable()&&(3===t?e.setSize50pct():e.setSize33pct())}))},_buildLayout:function(){var e={class:this.getClassNames("-root")};this.elements.container=new UWA.Element("div",UWA.merge(this.options,e)),this._render()},_render:function(){}})})),define("DS/CompareWidget2/userSettings/MultiStructBase",[],(function(e){"use strict";return{namespace:"",compareSettings:{},viewSettings:{STRUCT_VIEW:{currentViewID_SG:{value:null}}}}})),define("DS/CompareWidget2/plugins/STRUCTURE/Utils/MaturityUtils",[],(function(){return{_maturityStatesInfo:null,_createCSSClass:function(e,t,i){if(null===document.getElementById(e)){var n=document.createElement("style");n.type="text/css",n.id=e;let o=i||"."+e;n.innerHTML=o+t,document.getElementsByTagName("head")[0].appendChild(n)}},_cleanStatusForCSS:function(e){return e.replace(/(\.| )/g,"-")},_getMaturityClass:function(e,t){return"lc-status-"+this._cleanStatusForCSS(e)+(t?"-withClass":"")},_addCSSMaturityClasses:function(e,t){var i=this;void 0!==e&&e.forEach((function(e){let n=e.policyName;e.states.forEach((function(e){let o=e.activeColor,r="{color:"+("#FFFFFF"===o?"#000000":"#FFFFFF")+" ; background-color:"+o+";}",s=i._cleanStatusForCSS(e.stateSysName),a="lc-status-"+i._cleanStatusForCSS(n)+"-"+s+(t?"-withClass":""),l="."+a+(t?" ."+t:"");i._createCSSClass(a,r,l)}))}))},_getMaturityStateUserNameFromCRNode(e){var t="",i=this._getMaturityStateInfoFromCRNode(e);return i&&(t=i.stateUserName),t},_getMaturityStateActiveColorFromCRNode(e){var t="#FFFFFF",i=this._getMaturityStateInfoFromCRNode(e);return i&&(t=i.activeColor),t},_getMaturityStateCSSClassFromCRNode(e,t,i){var n="",o=e.getAttr(t||"policy"),r=this._getMaturityStateInfoFromCRNode(e,t,i);if(r){var s=o+"."+r.stateSysName;n=this._getMaturityClass(s,"wux-controls-label")}return n},_getMaturityStateInfoFromCRNode(e,t,i){var n=null;i=i||"last.current",t=t||"policy";var o="",r="";if(e)if(e.getAttr(i))r=e.getAttr(t),o=e.getAttr(i);else{var s=e.getMatchInfo();if(s){var a=s.getBaseNode();if(a.getAttr(i))r=a.getAttr(t),o=a.getAttr(i);else{var l=s.getCompNode();l.getAttr(i)&&(r=l.getAttr(t),o=l.getAttr(i))}}}var u=this._maturityStatesInfo.policies.find((e=>e.policyName===r));return u&&(n=u.states.find((e=>e.stateSysName===o))),n},_getMaturityStatesAttributes:function(e,t){var i=this;return new UWA.Class.Promise((function(n,o){var r=new Set;if(e.visitAll_treeAndFN(0,(function(e){var i=e.getAttr(t||"policy");i&&r.add(i)})),e.visitAll_treeAndFN(1,(function(e){var i=e.getAttr(t||"policy");i&&r.add(i)})),r.size){var s={policies:Array.from(r)},a=e.getRoot(0).getObjIDSpec_REF(),l=a.getTenant(),u=a.getServiceName(),c=a.getSecurityContext(),d=i._plugSvcs.nowMS();i._plugSvcs.makeAuthHttpsCall("/resources/lifecycle/maturity/getStatesAttributes","POST",s,"json",l,u,c).then((function(e){i._plugSvcs.reportTime(d,"getStatesAttributes request OK.");var t="string"==typeof e?JSON.parse(e):e;n(t)}),(function(e){i._plugSvcs.reportTime(d,"getStatesAttributes request failed."),i._plugSvcs.showAlertBox("getStatesAttributes request unsuccessful.",null,"error"),i._plugSvcs.errout("Failure of getStatesAttributes request: "+e)}))}else n(null)}))},_getPolicyAndTypeAttributes:function(e,t){return new Promise(((i,n)=>{require(["DS/LifecycleServices/TranslationService"],(function(o){let r=new o({handleError:!0});e.visitAll_treeAndFN(0,(function(e){var i=e.getAttr(t||"policy");i&&r.addPolicy(i);var n=e.getAttr("REF.ds6w:type");n&&r.addType(n);var o=e.getAttr("INST.ds6w:type");o&&r.addType(o)}));var s=e.getRoot(0).getObjIDSpec_REF().getTenant();widget._isODTMode()?i(r):r.initAsync(s).then((()=>i(r)),(()=>n()))}))}))},prepTreeForMaturityAndPolicyPromise:function(e,t){let i=this;return i._plugSvcs=t,new Promise(((t,n)=>{for(let t=0;t<2;t++)e.visitAll_treeAndFN(t,(e=>{let t=e.getAttr("REF.ds6w:status");t?(t=t.split("."),e.addAttr("policy",t[0]),e.addAttr("last.current",t[1])):null!=e.getAttr("REF.ds6w:policy")&&e.addAttr("policy",e.getAttr("REF.ds6w:policy"))}));Promise.all([i._getMaturityStatesAttributes(e),i._getPolicyAndTypeAttributes(e)]).then((n=>{null!=n[0]&&(i._maturityStatesInfo=n[0],i._addCSSMaturityClasses(i._maturityStatesInfo.policies,"wux-controls-label")),null!=n[1]&&(i._translationService=n[1]);for(let t=0;t<2;t++)e.visitAll_treeAndFN(t,(e=>{if(i._maturityStatesInfo){let t=i._getMaturityStateUserNameFromCRNode(e,n);t&&(e.addOrSetCustAttr("REF.ds6w:status",t),e.addOrSetCustAttr("maturity.class",i._getMaturityStateCSSClassFromCRNode(e)))}i._translationService&&(null!=e.getAttr("REF.ds6w:policy")&&e.addOrSetCustAttr("REF.ds6w:policy",i._translationService.translatePolicy(e.getAttr("REF.ds6w:policy"))),null!=e.getAttr("REF.ds6w:type")&&e.addOrSetCustAttr("REF.ds6w:type",i._translationService.translateType(e.getAttr("REF.ds6w:type"))),null!=e.getAttr("INST.ds6w:type")&&e.addOrSetCustAttr("INST.ds6w:type",i._translationService.translateType(e.getAttr("INST.ds6w:type"))))}));t(e)}),(()=>{n(e)}))}))}}})),define("DS/CompareWidget2/plugins/VIEW3D/view3DJSONEngine_LDV",[],(function(){var e={encoding:"UTF-8",kind:"InstRef",version:"1.1"};function t(e,t,i,n){return{resourceid:e,"ds6w:type":t,"ds6w:globaltype":i,boundingbox:n}}function i(i,n,o){var r,s=null,a=[],l=0,u=0,c=!1;i.visit_riTreeAndFN((function(e){var i=null,r=e.isLeaf();let d=e.isRoot();var p=e.get_dbObj_REF(),h=p.getAttr("physicalid")+"."+n,_=p.getAttr("ds6w:type"),g=p.getAttr("ds6w:globaltype"),f=p.getAttr("boundingbox"),S=p.getAttr("ds6wg:XCADOrientationExt.V_WorldOrientation");if(null!=S&&""!==S||(S=p.getAttr("vWorldOrientation")),null!=S&&""!==S||(S="0"),r){var m=p.getAttr("thumbnail_3d"),C=p.getAttr("cgr");if(null==m&&null!=(m=C)&&0==c&&(c=!0,o.dbgout("Thumbnail_3d visuals not yet available; using CGRs")),null!=m)u++,i=function(e,i,n,o,r,s){var a=t(e,i,n,o);return a.thumbnail_3d=r,a.cgr=s,a}(h,_,g,f,m,C);else{if(!d)return o.dbgout("NO VISUAL // excluded from viewerJSON ID:: "+h+"("+p.getAttr("ds6w:label")+")"),!0;(i=t(h,_,g,f))["ds6wg:XCADOrientationExt.V_WorldOrientation"]=S}}else i=t(h,_,g,f),d&&(i["ds6wg:XCADOrientationExt.V_WorldOrientation"]=S);if(l++,a.push(i),1==d)null!=s?o.errout("ERROR - TREE has more than ONE root"):s=i;else{var T=e.get_dbObj_INST(),E=T.getAttr("physicalid")+"."+n,v=T.getAttr("ds6w:type"),D=(T.getAttr("ds6w:globalType"),function(e,t,i,n,o,r){return{resourceid:e,"ds6w:type":t,"ds6w:globaltype":i,matrixtxt:n,from:o,to:r}}(E,v,"ds6w:Instance",T.getAttr("matrixtxt"),e.getParent().get_dbObj_REF().getAttr("physicalid")+"."+n,h));a.push(D)}return!0})),r=a.length;var d=function(t,i,n,o){var r=JSON.parse(JSON.stringify(t));return{infos:e,results:[r,{synthesis:{name:"ProgressiveExpand_FlatSynthesis",value:i}},{synthesis:{name:"ProgressiveExpand_OccSynthesis",value:n}},{synthesis:{name:"ProgressiveExpand_LeafSynthesis",value:o}}]}}(s,r,l,u);s.resourceid;return{rootStats:d,infos:e,results:a}}return{refInstTree2ViewerJSON:function(e,t){var n=[];return e.forEach((function(e,o){var r=i(e,o,t);if(null==r)throw new Error("Failure creating view3DJSON");var s=e.getRoot().getAttr("REF.physicalid")+"."+o;n.push({rootID:s,structure:r})})),n}}})),define("DS/CompareWidget2/support/cw2Utils",["DS/WidgetServices/WidgetServices","DS/Utilities/DateUtils"],(function(e,t){var i={},n=["     ","    ","   ","  "," ",""];return{jsClass:"CW2UTILS",createRandomString:function(e,t,i){if(null==i&&(i=t),t>i){this.errout("MIN/MAX values reversed... switching");var n=t;t=i,i=n}var o=Math.random()*(i-t)+t;return e+Math.random().toString(36).substring(o)},dupeJson:function(e){var t=null;if(null!=e)try{t=JSON.parse(JSON.stringify(e))}catch(t){this.errout("Exception duping JSON: "+this.stringify(e)),this.errout(t)}return t},stringify:function(e){var t=null;if(null!=e){e.constructor==String&&(t=e);try{t=JSON.stringify(e)}catch(i){t=e.toString()}}return t},nowMS:function(){return(new Date).getTime()},reportTime:function(e,t){if(!widget||widget.CV2Timing){var i=t.indexOf("[");(-1==i||i>3)&&(t="[FRMWRK]"+t);var o=((this.nowMS()-e)/1e3).toString(),r=o.length,s=o.indexOf(".");-1==s&&(s=1);(s<n.length?n[s]:"").length;var a=o;console.log("[C2.TIME]"+t+"   //  {"+a+" seconds}  \\\\ ")}},enableDebugLabel:function(e){i[e]=!0},disableDebugLabel:function(e){i[e]=!1},dbgout:function(e,t){this.dbgout2(!1,e,t)},dbgout2:function(e,t,n){try{if(null!=widget&&!widget.CV2Debug)return}catch(e){return void console.error("EXCEPTION trying to output message: "+e+", continuing")}var o=null!=n?n:t,r=null!=n?t:null;if(null!=r){if(1!=i[r])return;o="["+r+"] "+o}var s="";"["!=o.charAt(0)&&(s=" "),o="[C2.DBG ]"+(o=e?"[PLUGIN]"+s+o:"[FRMWRK]"+s+o),console.log(o)},warnout:function(e){console.warn("[C2.WRN]"+e)},errout:function(e){console.error("[C2.ERR]"+e)},getCurrentTenant:function(){var e=null;try{e=widget.getValue("x3dPlatformId")}catch(e){this.dbgout("attempted to get tenant information from widget and failed... must be running an ODT... using 'OnPremise'")}return null==e&&(e="OnPremise"),e},getDeviceType:function(){let e="desktop",t="ontouchstart"in document.documentElement&&/mobi/i.test(navigator.userAgent),i=window.matchMedia("(max-width: 480px) and (orientation:portrait)"),n=window.matchMedia("(max-height: 480px) and (orientation:landscape)"),o=i.matches||n.matches;return t&&o?e="smartphone":t&&!o&&(e="tablet"),e},csValsEquivalent:function(e,t,i){var n=!1;if(e==t)n=!0;else if(!1!==i&&null!=e&&null!=t){var o=e.split(",");o.forEach((function(e,t){o[t]=e.trim()}));var r=t.split(",");r.forEach((function(e,t){r[t]=e.trim()}));var s=o.length;if(s==r.length){for(var a=o.sort(),l=r.sort(),u=!1,c=0;c<s;c++)if(a[c]!=l[c]){u=!0;break}n=!u}}return n},formatDate:function(i){var n="",o=t.convertToDate(i);if(null!=o)n=t.formatDateToString(o,{dateStyle:"short",timePrecision:"sec"});else{if(/(\d+)\/(\d+)\/(\d+)@\d+:\d+:\d+:\w+/.test(i)){i=e.formatDateObj(i).toUTCString()}let o=Date.parse(i);if(!isNaN(o)){let e=t.convertToDate(o);n=t.formatDateToString(e,{dateStyle:"short",timePrecision:"sec"})}}return n}}})),define("DS/CompareWidget2/plugins/STRUCTURE/flexibleView/ViewPanel/fvpTreesViewActions",["UWA/Controls/Abstract"],(function(e){return e.extend({init:function(e,t,i){this.structComparePanelCBs=i,this._plugSvcs=t,this._fvpTrees=e},_buildSelectedDataArray_list:function(e,t){var i=[];return[e,t].forEach((function(e,t){var n=[];e.forEach((function(e){var i=e.options.data;if(!i.isDummy()){var o=i.getAttr("physicalID_REF"),r=i.getAttr("physicalID_INST");me._crTree.visitVisible_treeAndFN(t,(function(e){if(e.getAttr("physicalID_REF")==o){var t=e.getDBContext(),i=new ObjIDSpec(o,e.getAttr("type"),t.securityContext,t.tenant,t.serviceName),s=null;null!=r&&(s=new ObjIDSpec(r,e.getAttr("type"),t.securityContext,t.tenant,t.serviceName));var a={ObjIDSpec:i,IDPath:e.getPath(),instObjIDSpec:s};n.push(a)}return!0}))}})),i.push(n)})),i},_buildSelectItem:function(e){var t=null;if(null!=e&&!e.isDummy()){var i=e.getObjIDSpec_REF();if(null!=i){var n=e.getPath();t={ObjIDSpec:i,instObjIDSpec:e.getObjIDSpec_INST(),IDPath:n,riNode:e._riNode}}}return t},_buildSelectedDataArray_tree:function(e){var t=[];for(let i=0;i<e.length;i++){t[i]=[];let n=e[i];for(let e=0;e<n.length;e++){let o=n[e].options.data;if(null!=o){let e=this._buildSelectItem(o);null!=e&&t[i].push(e)}}}return t},_buildSelectedDataArray:function(e){var t=[];let i=this._fvpTrees.getAllGridSelectedNodes(),n=!1;return i.forEach((function(e){0!=e.length||(n=!0)})),e&&n||(t=this._buildSelectedDataArray_tree(i)),t},onTreesSelectRow:function(e){var t=this._buildSelectedDataArray(e);let i=this._fvpTrees._options;null!=t&&(this._plugSvcs.postEvent("string"==typeof i.CUSTOM_NEW_CURRENT_SELECTION_EVENT&&i.CUSTOM_NEW_CURRENT_SELECTION_EVENT.length?i.CUSTOM_NEW_CURRENT_SELECTION_EVENT:"NEW_CURRENT_SELECTION_EVENT",{isAsync:!0,selectedData:t,crTree:this._crTree,structDisplayMode:"STRUCT"}),this.structComparePanelCBs.syncOverview())},onTreesUnselectRow:function(){this._syncOverview(),this.onTreesSelectRow(!0)},onTreesPreCollapse:function(e){e.nodeModel.options.data.setExpandCollapseState(e.nodeModel.getState())},onTreesPreExpand:function(e){e.nodeModel.options.data.setExpandCollapseState(e.nodeModel.getState())},onTreesCollapse:function(e){e.nodeModel.options.data.setExpandCollapseState(e.nodeModel.getState()),this.structComparePanelCBs.doExpandCollapseUpdates()},onTreesExpand:function(e){e.nodeModel.options.data.setExpandCollapseState(e.nodeModel.getState()),this.structComparePanelCBs.doExpandCollapseUpdates()}})})),define("DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/flagInfo",["i18n!DS/CompareWidget2/assets/nls/CompareV2"],(function(e){function t(e,t,i){let n={title:e.NLS};void 0!==e.tooltipCustomRule&&null!==e.tooltipCustomRule&&e.tooltipCustomRule.length>0&&(n.shortHelp=e.tooltipCustomRule);let o="",r=-1;void 0!==e.legendPosition&&null!==e.legendPosition&&(o=e.legendPosition.grouping,r=e.legendPosition.position);let s=1,a=0;return"left"===o?(s=0,a=r):"right"===o?(s=2,a=r):1===i&&(s=2),{id:e.flagName,label:e.NLS,tooltip:n,modulePath:e.modulePath,color:e.color,description:"",checked:!0,matchedPairs:[],visibleFlag:t,legendGrouping:s,legendSubGrouping:a}}var i=function(t,i){this.statusIDFlagData_all=function(t){var i={};return["SYSTEM_RULE_ID_FLAGS","CUSTOM_RULE_ID_FLAGS","CUSTOM_MATCH_ADJ_FLAGS","BUBBLE_FLAGS"].forEach((function(n){var o=t[n];null!=o&&Object.keys(o).forEach((function(o){var r=t[n][o].NLS,s=e[r];null!=s&&0!=s.length||(s=r),i[o]={color:t[n][o].COLOR,flagName:o,NLS:s,modulePath:t[n][o].TOOLTIP_MODULE_PATH},void 0!==t[n][o].TOOLTIP_CUSTOM_RULE&&null!==t[n][o].TOOLTIP_CUSTOM_RULE&&t[n][o].TOOLTIP_CUSTOM_RULE.length>0&&(i[o].tooltipCustomRule=t[n][o].TOOLTIP_CUSTOM_RULE),void 0!==t[n][o].LEGEND_POSITION&&null!==t[n][o].LEGEND_POSITION&&(i[o].legendPosition=t[n][o].LEGEND_POSITION)}))})),i}(t),this._plugSvcs=i,this.inUse={},this.inUse.active={}};return i.prototype.setActive=function(e){this.inUse[e]=this.inUse[e]||{},this.inUse.active=this.inUse[e]},i.prototype.getActiveFlagDisplayData=function(e){var t=this.inUse.active.flagDisplayData;return null!=e&&null!=t&&(t=t[e]),t},i.prototype.getActiveFlagDisplayData_excludeFilteredByTypeAttr=function(){var e=this.inUse.active.flagDisplayData,t={};return Object.keys(e).forEach((function(i){for(var n=e[i],o=n.matchedPairs,r=!1,s=0;s<o.length;s++){if(0==o[s].getIsHidden_byTypeAttr()){r=!0;break}}(r||"IDENTICAL"===n.id)&&(t[i]=n)})),t},i.prototype.getActiveMaxFlags=function(){return this.inUse.active.maxFlags},i.prototype.get_statusIDFlag=function(e){var t=this.statusIDFlagData_all[e];return null==t&&(this._plugSvcs.errout("view def options missing RULE_ID_FLAG definition for: "+e+"; using default color RED"),this.statusIDFlagData_all[e]={color:"#ff0000",NLS:e,flagName:e},t=this.statusIDFlagData_all[e]),t},i.prototype.createFlagDisplayData=function(e,i,n){for(var o={},r=0,s=i.length,a=0;a<s;a++){let e=i[a];var l=!0===e.qtyIsDiffFlag,u=e.getAllStatusArray(!0)||[],c=u.length,d=c+(l?1:0);d>r&&(r=d);for(var p=0;p<c;p++){var h=u[p];if(null!=h&&""!=h&&("UNRELATED"!=h||n)){if(null==o[h]){let e=this.get_statusIDFlag(h);o[h]=t(e,!0,p)}o[h].matchedPairs.push(e)}}if(l){if(null==o.QUANTITY){var _=this.get_statusIDFlag("QUANTITY");o.QUANTITY=t(_,!0)}o.QUANTITY.matchedPairs.push(e)}}this.inUse[e]={flagDisplayData:o,maxFlags:r}},i})),define("DS/CompareWidget2/Customization/viewConfigMangler",[],(function(e){"use strict";return{applyCustomProfileToViewConfig:function(e,t){for(var i=JSON.parse(JSON.stringify(t)),n={},o={},r=[],s={},a=[],l={},u={},c=e.UseCustomMatchingRules?e.MatchingRules.length:0,d=0;d<c;d++){let t=e.MatchingRules[d],i=t.name,a=t.color;"#"!=a.charAt(0)&&(a="#"+a);t.description;let u=t.attributes;r[d]=i,l[i]={COLOR:a,TOOLTIP_MODULE_PATH:"",NLS:i};let c=[];for(var p of u){let e=p.name,t=p.objType[0],i=p.icon,r="Instance"===t.substr(t.length-8)?"INST":"REF",a=r+"_"+e+"_"+"ATTR",l=r+"."+e;n[a]=l,!1!==p.showInDisplay&&(o[a]={name:l,objType:t,icon:i,origin:"matching_rule"}),c.push({info:0===c.length?"same":"and",name:l});let u="COMP_"+r+"_"+e;null==s[u]&&(s[u]=[],s[u][0]=[a,a],s[u][1]=[]),s[u][1][d]="EQ"}l[i].TOOLTIP_CUSTOM_RULE=c,l[i].LEGEND_POSITION={grouping:"left",position:d}}Object.keys(s).forEach((function(e){for(var t=0;t<c;t++)null==s[e][1][t]&&(s[e][1][t]="N/A")}));let h=null!=e.AdditionalStatuses?e.AdditionalStatuses.length:0;for(var _=0;_<h;_++){let t=e.AdditionalStatuses[_];if(""!==t.name&&t.attributes.length>0){let e=t.name,i=t.color;"#"!=i.charAt(0)&&(i="#"+i);t.description;let r=t.attributes,s={NAME:e,PROPS:[],PROPSET:[],FLAG_ON:"NEQ",IS_VISIBLE:!0,MATCH_ADJ:0},l=[];for(var p of r){let e=p.name,i=p.objType[0],r=p.icon,a="Instance"===t.facet?"INST":"REF",u=a+"_"+e+"_"+"ATTR",c=a+"."+e;n[u]=c,void 0!==o[u]&&null!==o[u]||!1!==p.showInDisplay&&(o[u]={name:c,objType:i,icon:r,origin:"additional_status"}),l.push({info:0===l.length?"different":"or",name:c}),s.PROPSET.push(u)}a.push(s),u[e]={COLOR:i,TOOLTIP_MODULE_PATH:"",NLS:e},u[e].TOOLTIP_CUSTOM_RULE=l,u[e].LEGEND_POSITION={grouping:"right",position:_}}}if(i.customProfileName=e.Name,Object.assign(i.PLUGDEFS.StructFetch.Options.CV_PROPS,n),i.PLUGDEFS.StructFetch.Options.DB_PROPS={},i.PLUGDEFS.StructFetch.Options.DB_FALLBACK=!1,i.PLUGDEFS.StructFetch.Options.MULTI_VALUE_ATTRS=e.MULTI_VALUE_ATTRS,Object.assign(i.PLUGDEFS.StructCompare.Options.PROPS,n),c>0){i.PLUGDEFS.StructCompare.Options.CUSTOM_RELATIONSHIP_NAMES=r,i.PLUGDEFS.StructCompare.Options.CUSTOM_COMPARISONS=s,i.PLUGDEFS.StructCompare.Options.CUSTOM_MATCH_ADJUSTMENTS=a;let e=["LEFT_ONLY","RIGHT_ONLY","QUANTITY","UNRELATED"],t=i.PLUGDEFS.StructCompare.Options.SYSTEM_RELATIONSHIP_NAMES.filter((t=>e.includes(t)));i.PLUGDEFS.StructCompare.Options.SYSTEM_RELATIONSHIP_NAMES=t,i.PLUGDEFS.StructCompare.Options.COMPUTE_DIFFERENT=!0}else for(var g of a)i.PLUGDEFS.StructCompare.Options.CUSTOM_MATCH_ADJUSTMENTS.push(g);if(i.PLUGDEFS.StructCompare.Options.CUSTOM_PROFILE_IN_USE=!0,c>0){i.PLUGDEFS.StructDisplay.Options.CUSTOM_RULE_ID_FLAGS=l;let e=["LEFT_ONLY","RIGHT_ONLY","QUANTITY","UNRELATED"];!0===i.PLUGDEFS.StructCompare.Options.CUSTOM_PROFILE_IN_USE&&e.push("DIFFERENT");let t=Object.keys(i.PLUGDEFS.StructDisplay.Options.SYSTEM_RULE_ID_FLAGS).filter((t=>e.includes(t))).reduce(((e,t)=>(e[t]=i.PLUGDEFS.StructDisplay.Options.SYSTEM_RULE_ID_FLAGS[t],e)),{});i.PLUGDEFS.StructDisplay.Options.SYSTEM_RULE_ID_FLAGS=t}return h>0&&(i.PLUGDEFS.StructDisplay.Options.CUSTOM_MATCH_ADJ_FLAGS||={},Object.assign(i.PLUGDEFS.StructDisplay.Options.CUSTOM_MATCH_ADJ_FLAGS,u)),i.PLUGDEFS.StructDisplay.Options.CUSTOM_PROFILE_IN_USE=!0,i.PLUGDEFS.StructDisplay.Options.PROPS=o,i.PLUGDEFS.StructListViewPrep.Options={isCustomMatching:r.length>0},i.PLUGDEFS.StructCustAttrsPrep.Options={COMPUTE_CUST_ATTRS:!0},i}}})),define("DS/CompareWidget2/Customization/Profile",["UWA/Class"],(function(e){"use strict";var t=e.extend({init:function(){var e=null,t=null,i=null,n=null,o=!1;let r="";if(1==arguments.length)e=arguments[0];else if(3==arguments.length)t=arguments[0],i=arguments[1],n=arguments[2];else{if(5!=arguments.length)throw new Error("Illegal initial state for new PROFILE");e=arguments[0],t=arguments[1],i=arguments[2],n=arguments[3],r=arguments[4],o=!0}this.Facets=[],this.AllowCustomMatchingRules=!1,this.Interfaces=[],this.SelectedTypes=[],this.UseCustomMatchingRules=!1,this.UserOverrideOK=!0,this.MatchingRules=[],this.AdditionalStatuses=[],this.Name="Default",this.Creator="unknown",this.isAdminUser=!1,this.companyId="",null!=e&&this._initFrom(e,o),null!=t&&(this.Name=t,this.NameNLS=null),null!=i&&(this.Creator=i),null!=n&&(this.isAdminUser=n),null!=r&&""!==r&&(this.companyId=r),this.Type="customization"},_initFrom:function(e,t){var i=this,n=Object.keys(e);let o="template"===e.Type;n.filter((e=>["_CustomTypesInfo","_CustomInterfacesInfo","_TypesInfo"].every((t=>e!==t)))).forEach((function(n){if(i[n]=JSON.parse(JSON.stringify(e[n])),o&&t&&"Facets"===n){let t=JSON.parse(JSON.stringify(e[n])),o=[],r=[];for(let e of t){for(let t of e.ObjectTypes)o.push(t);if(void 0!==e.Interfaces&&null!==e.Interfaces)for(let t of e.Interfaces)r.push(t)}i.SelectedTypes=o,i.Interfaces=r}})),i.fromTemplateProfile=i.fromTemplateProfile||(o?e.Name:"EngineeringItemProfile")},setMatchingRules:function(e){var t=e||[];t=JSON.parse(JSON.stringify(t));this.MatchingRules=t},setAdditionalStatuses:function(e){var t=e||[];t=JSON.parse(JSON.stringify(t));this.AdditionalStatuses=t}});return t})),define("DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInstTreeAug",[],(function(){function e(e,i,n){n.dbgout("------------[ A U G M E N T   T R E E   N O D E S    B E G I N ] -----------");let o=function(e,t){var i=[];return e.visit_riTreeAndFN((function(e){var t=e.get_dbObj_REF();if(null==t.getAttr("dfr")){var n=t.getAttr("physicalid"),o=t.getAttr("dfr_bootstrapID");null!=t.getAttr("dfr_in_progress")||(null==o?t.setAttr("dfr",n):(t.setAttr("dfr_in_progress",o),t.rmAttr("dfr_bootstrapID"),i.push(t)))}return!0})),i}(e);return t(e,o,i,n).then((function(t){return n.dbgout("------------[ A U G M E N T   T R E E   N O D E S    E N D  ] -----------"),e}),(function(e){}))}function t(e,i,n,o){return new Promise((function(r,s){if(i.length>0){let a=function(e){var t=[];return e.forEach((function(e){t.push(e.getAttr("dfr_in_progress"))})),t}(i);(function(e,t,i){var n="/cvservlet/fetch/v2",o=i.createRandomString("Compare2-",8);widget._isODTMode()&&(o="");var r={physicalid:e,select_predicate:["bo.plmreference.v_derivedfrom"],with_synthesis:!1,label:o};return i.makeAuthHttpsCall(n,"POST",r,"json",t.tenant,t.serviceName,t.securityContext)})(a,n,o).then((function(a){let l=function(e,t){var i=[];if(null!=e&&e.length>0){var n={};t.forEach((function(e){var t=e.getAttr("dfr_in_progress");n[t]=e})),e.forEach((function(e){var t=null,o=null;e.attributes.forEach((function(e){"bo.plmreference.v_derivedfrom"==e.name?o=e.value:"resourceid"==e.name&&(t=e.value)}));var r=n[t];if(null==o){var s=r.getAttr("dfr_in_progress");r.setAttr("dfr",s),r.rmAttr("dfr_in_progress")}else r.setAttr("dfr_in_progress",o),i.push(r)}))}return i}(a.results,i);0==l.length?(e.visit_riTreeAndFN((function(e){let t=e.get_dbObj_REF(),i=t.getAttr("dfr_in_progress");return null!=i&&(t.setAttr("dfr",i),t.rmAttr("dfr_in_progress")),!0})),r(e)):t(e,l,n,o).then(r,s)}),(function(e){o.errout("GOT A KO TRYING TO AUG TREE"),s()}))}else r(e)}))}return{jsClass:"REFINST_TREE_AUGMENTER",augment:function(t,i,n){var o=n.nowMS();t.visit_riTreeAndFN((function(e){return e.setDBContext(i),!0}));var r=e(t,i,n);return n.reportTime(o,"--\x3e Augment tree with 'derived from root' "),r}}})),define("DS/CompareWidget2/widget/controls/TreePanel",["UWA/Controls/Abstract","DS/Core/PointerEvents"],(function(e,t){"use strict";return e.extend({name:"treePanel",defaultOptions:{caption:"-",addClass:"",collapseable:!1,UIcollapseable:!0},init:function(e){this._parent(e),this._isCollapsed=!1,this._isMaximized=!1,1==e.initSize100pct?this.setSize100pct():e.initSize50pct?this.setSize50pct():this.setSize33pct(),this._buildLayout()},_buildLayout:function(){var e=this,t=" ";this.options.collapseable&&(t+=this.expandClass);var i={class:this.getClassNames("-root")+t+" "+this.options.addClass};this.elements.container=new UWA.Element("div",i),0!=this.options.includeTreeHeader&&this._buildPanelHeader(this.elements.container),this.elements.contentContainer=new UWA.Element("div",{id:this.options.contentId,class:this.getClassNames("-contentContainer"),styles:{"border-top":this.options.contentBorderTop}}),this.elements.contentContainer.inject(this.elements.container);var n="";this.options.collapseable&&(n="treePanel-content-hide-expander"),this.elements.contentHide=new UWA.Element("div",{class:this.getClassNames("-content-hide")+" "+n,events:{click:function(){e.options.UIcollapseable&&e.options.collapseable&&e.toggleCollapsed()}}}),this.elements.contentHide.inject(this.elements.contentContainer),this.elements.captionCollapsed=new UWA.Element("span",{class:this.getClassNames("-caption-collapsed"),html:this.options.caption}),this.elements.captionCollapsed.inject(this.elements.contentHide),this.elements.content=new UWA.Element("div",{class:this.getClassNames("-content")}),this.elements.content.inject(this.elements.contentContainer),this._render()},_buildPanelHeader:function(e){var t=this,i=new UWA.Element("div",{class:this.getClassNames("-panelHeader")});i.inject(e),this.options.colorIndicator&&(this.elements.colorIndicator=new UWA.Element("div",{class:"fonticon fonticon-stop",styles:{color:this.options.colorIndicator,"margin-left":"10px"}}),this.elements.colorIndicator.inject(i)),this.elements.headerText=new UWA.Element("div",{class:this.getClassNames("-headerText"),html:[{tag:"section",html:this.options.caption},{tag:"section",html:""},{tag:"section",html:""},{tag:"section",html:[{tag:"div",html:""}]}]}),this.elements.headerText.inject(i),this.options.collapseable&&(this.elements.headerBtn=new UWA.Element("div",{class:"wux-controls-button wux-controls-abstract wux-ui-state-secondary wux-ui-style-normal "+this.getClassNames("-headerButton"),events:{click:function(){t.toggleCollapsed()}}}),this.elements.headerBtnIcon=new UWA.Element("div",{class:"fonticon fonticon-expand-left treePanel-headerButtonIcon"}),this.elements.headerBtnIcon.inject(this.elements.headerBtn),this.elements.headerBtn.inject(i))},_render:function(){},isCollapsed:function(){return this._isCollapsed},isCollapseable:function(){return this.options.collapseable},setUICollapseable:function(e){this.options.UIcollapseable!==e&&((this.options.UIcollapseable=e)?(this.elements.headerBtn.removeClassName("treePanel-hidden"),this.elements.contentHide.addClassName("treePanel-content-hide-expander")):(this.elements.headerBtn.addClassName("treePanel-hidden"),this.elements.contentHide.removeClassName("treePanel-content-hide-expander")))},empty:function(){},hide:function(){this.elements.container.addClassName("treePanel-hidden")},show:function(){this.elements.container.removeClassName("treePanel-hidden")},_setCollapsed:function(e){this._isCollapsed=e,this.dispatchEvent("collapseChange",{isCollapsed:e})},setSize33pct:function(){this._setSizepct("treePanel-expandedPanel33")},setSize50pct:function(){this._setSizepct("treePanel-expandedPanel50")},setSize100pct:function(){this._setSizepct("treePanel-expandedPanel100")},_setSizepct:function(e){this.expandClass!==e&&(!this.isCollapsed()&&this.elements.container&&this.elements.container.removeClassName(this.expandClass),this.expandClass=e,!this.isCollapsed()&&this.elements.container&&this.elements.container.addClassName(this.expandClass))},setCaption:function(e){if(0!=this.options.includeTreeHeader)if("string"==typeof e)this.elements.headerText.childNodes[0].setHTML(e),this.elements.captionCollapsed.setHTML(e);else{let n="";for(var i=0;i<this.elements.headerText.childNodes.length;++i)if(i===this.elements.headerText.childNodes.length-1&&e.dropDown)this.elements.headerText.childNodes[i].addClassName("treePanel-caption-dropdown-container"),this.elements.headerText.childNodes[i].childNodes[0].classList.add("fonticon","fonticon-down-open","treePanel-caption-dropdown"),this.elements.headerText.childNodes[i].childNodes[0].removeEvent(t.POINTERDOWN),this.elements.headerText.childNodes[i].childNodes[0].addEvent(t.POINTERDOWN,e.dropDown.onClick),this.elements.headerText.childNodes[i].childNodes[0].id=e.dropDown.id;else if(i<e.label.length){let o=2===i?"["+e.label[i].text+"]":e.label[i].text,r=UWA.String.escapeHTML(o);this.elements.headerText.childNodes[i].setHTML(r),this.elements.headerText.childNodes[i].addClassName("treePanel-caption-item"),void 0!==e.label[i].onClick&&null!==e.label[i].onClick&&"function"==typeof e.label[i].onClick&&(this.elements.headerText.childNodes[i].removeEvent(t.POINTERDOWN),this.elements.headerText.childNodes[i].addEvent(t.POINTERDOWN,e.label[i].onClick),this.elements.headerText.childNodes[i].id=e.label[i].id,this.elements.headerText.childNodes[i].addClassName("treePanel-caption-item-clickable")),0===i?n=o:n+=" "+o}else this.elements.headerText.childNodes[i].setHTML("");let o=UWA.String.escapeHTML(n);this.elements.captionCollapsed.setHTML(o)}},collapse:function(){this.isCollapseable()&&(this.isCollapsed()||(this.elements.container.removeClassName(this.expandClass),this.elements.container.addClassName("treePanel-collapsedPanel"),this.elements.contentHide.show(),this.elements.headerText.hide(),this.elements.headerBtnIcon.removeClassName("fonticon-expand-left"),this.elements.headerBtnIcon.addClassName("fonticon-expand-right"),this._setCollapsed(!0)))},expand:function(){this.isCollapseable()&&this.isCollapsed()&&(this.elements.headerText.show(),this.elements.container.addClassName(this.expandClass),this.elements.container.removeClassName("treePanel-collapsedPanel"),this.elements.contentHide.hide(),this.elements.headerBtnIcon.addClassName("fonticon-expand-left"),this.elements.headerBtnIcon.removeClassName("fonticon-expand-right"),this._setCollapsed(!1))},toggleCollapsed:function(){this.isCollapsed()?this.expand():this.collapse()},maximize:function(){this._isMaximized||(this._isMaximized=!0,this.elements.container.addClassName("treePanel-maximized"))},restore:function(){this._isMaximized&&(this._isMaximized=!1,this.elements.container.removeClassName("treePanel-maximized"))}})})),define("DS/CompareWidget2/plugins/EXPORT/CompareExporter",["UWA/Class","DS/PADUtils/PADUtilsServices","i18n!DS/CompareWidget2/assets/nls/CompareExport"],(function(e,t,i){"use strict";var n='<table style="border:1px solid black; border-collapse:collapse;">',o="</table><br/>",r='<th style="border:1px solid black; background-color:#A7C942; text-align:left; color:#FFFFFF; font-size:.8em; padding-top:5px; paddingbottom:4px;word-break:break-word;display:table-cell;">',s="</th>",a="<tr>",l="</tr>",u="<td>",c="</td>";!function(){var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"},t=/[&<>"'\/]/g,i=/[<>\/]/g;function n(t){return e[t]}}();function d(e,t,i){for(var n=e.length,o=0;o<n;o++){i(t,e[o],o)}}function p(e){return'"'+e+'"'}function h(){this._str=""}function _(e){var t=e||{};this._debug=!0===t.debug,this._builder=new h}function g(){this._builder=new h}h.prototype={CRLF:"\r\n",append:function(e){this._str+=e+""},appendCRLF:function(){this._str+=this.CRLF},toString:function(){return this._str}},_.prototype={render:function(e){var t=this;return this.appendCRLF(),d(e.tables,e.columns,(function(e,i){t._builder.append(n),t._builder.append("<thead><tr>"),t.appendCRLF(),d(e,null,(function(e,i){t._builder.append(r),t._builder.append(i),t._builder.append(s)})),t.appendCRLF(),t._builder.append("</tr></thead>"),t._builder.append("<tbody>"),d(i.rows,null,(function(e,i){t.appendCRLF(),t._builder.append(a),d(i,null,(function(e,i){t._builder.append(u),t._builder.append(i),t._builder.append(c)})),t._builder.append(l)})),t.appendCRLF(),t._builder.append("</tbody>"),t._builder.append(o)})),this._builder.toString()},appendCRLF:function(){this._debug&&this._builder.appendCRLF()}},g.prototype={renderHeaders:function(e){var t=e.length-1;d(e,this,(function(e,i,n){e._builder.append(p(i)),n!==t&&e._builder.append(",")})),this._builder.appendCRLF()},renderTables:function(e,t){var i=this;d(e,null,(function(e,t){d(t.rows,null,(function(e,t){var n=t.length-1;d(t,null,(function(e,t,o){i._builder.append(p(t)),o!==n&&i._builder.append(",")})),i._builder.appendCRLF()}))}))},render:function(e){return this._builder.append("\ufeff"),this.renderHeaders(e.columns),this.renderTables(e.tables,e.columns),this._builder.toString()}};var f={options:{csv_base_file_name:"CSV Report"}};return e.singleton({outHeader:function(e,t){"MULTI"==e.structDisplayStyle?(1==e.showLevel&&t.push(i.Depth),1==e.showQuant&&t.push(i.ReferenceQuantity),t.push(i.ReferenceID),1==e.showQuant&&t.push(i.ComparedQuantity),t.push(i.ComparedID)):("list"===e.structDisplayStyle?t.push(i.ReferenceQuantity):t.push(i.Depth),t.push(i.ReferenceID),"list"===e.structDisplayStyle&&t.push(i.ComparedQuantity),t.push(i.ComparedID)),t.push(i.Type),t.push(i.ComparisonStatus),e.outputAttributeDifferences&&t.push(i.ComparisonInformation),("MULTI"==e.structDisplayStyle&&1==e.showLevel||e.outputAttributeDifferences&&"list"!=e.structDisplayStyle)&&t.push(i.ComparisonInformationForInstances)},printHtml:function(e,i){var n=(new _).render(e);t.printhtml(n)},generateCsv:function(e,i){i.csv_base_file_name&&(f.options.csv_base_file_name=i.csv_base_file_name);var n=(new g).render(e);i.outputToConsole&&console.log(n),i.noOutputToFile||t.downloadfile(n,f.options.csv_base_file_name+" "+(new Date).toString().split(" ").splice(1,4).join(" ")+".csv","text/csv")},consoleOutput:function(e,t){t.outputToConsole=!0,t.noOutputToFile=!0,this.generateCsv(e,t)}})})),define("DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/pe2RefInstTree",["DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/exAdapter","DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/treeBuilder"],(function(e,t){return e.singleton({jsClass:"PE2REFINST_TREE",convert:function(e,i,n,o){for(var r=new t(e),s=i.length,a=0;a<s;a++){var l=i[a];if(null!=l.resourceid){var u=r.build_dbObj(l,o.MULTI_VALUE_ATTRS);r.add_dbObj(u)}else null!=l.Path?r.add_path(l.Path):null!=l.icon__default_thumbnail_2d?r.add_typeIcons(l.icon__default_thumbnail_2d):n.errout("Unknown entry in input:"+JSON.stringify(l)+", skipping...")}var c=r.buildTree();return r=null,c}})})),define("DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/cv2RefInstTree",["DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/exAdapter","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_tree","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_node","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/dbObj"],(function(e,t,n,o){var r=function(e,t){this._objIDSpec=e,this._dbObjArray=[],this._dbObjByDID={},this._dbObjByPhysID={},this._plugSvcs=t,this._pathArrayArray=[],this._typeIconsArrayArray=[]};return r.prototype.build_dbObj=function(e,t){var i=new o;Array.isArray(t)&&t.length&&t.forEach((t=>{mvAttrs=[];let i=-1;for(;i=e.findIndex((e=>e.name===t)),i>-1;)mvAttrs.push(e.splice(i,1)[0]);mvAttrs.length&&e.push({name:t,value:mvAttrs.map((e=>e.value)).sort().join(",")})}));for(var n=e.length,r=0;r<n;r++){var s=e[r],a=s.name,l=s.value;"bo.plmreference.v_derivedfrom"==a&&(a="dfr_bootstrapID"),"matrixtxt"==a&&"1,0,0,0,1,0,0,0,1,0,0,0"==l&&(l="1.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0"),"resourceid"==a&&i.addAttr("physicalid",l),i.addAttr(a,l)}return i},r.prototype.add_dbObj=function(e){var t=!0;return null==this._dbObjByDID[e.getAttr("did")]?this._dbObjByDID[e.getAttr("did")]=e:(this._plugSvcs.errout("new node already in tree (byDID)"),t=!1),1==t&&null==this._dbObjByPhysID[e.getAttr("physicalid")]?this._dbObjByPhysID[e.getAttr("physicalid")]=e:(this._plugSvcs.errout("new node already in tree (byPhysID)"),t=!1),t&&this._dbObjArray.push(e),t},r.prototype.add_path=function(e){null==e||0==e.length?this._plugSvcs.errout("Attempt to add null or empty path to tree"):e.length%2!=1?this._plugSvcs.errout("Invalid path; contains even number of entries (count *must* be odd)"):this._pathArrayArray.push(e)},r.prototype.add_typeIcons=function(e){this._typeIconsArrayArray.push(e)},r.prototype._isTreeNodeRefInstID=function(e,t,i){var n=!1;e.getAttr("REF.did")==t&&(e.getAttr("INST.did")==i&&(n=!0));return n},r.prototype.buildTree=function(){var e=this,o=new t(this._objIDSpec);try{e._pathArrayArray.forEach((function(t){var r=t.length,s=o.getRoot(),a=null,l=0,u=t[0],c=null,d=null;if(null!=s&&e._isTreeNodeRefInstID(s,u,c)){for(d=s,l=1,i=1;i<r;i+=2){c=t[i],u=t[i+1];for(var p=s.getChildArray(),h=p.length,_=!1,g=0;g<h;g++){var f=p[g];if(e._isTreeNodeRefInstID(f,u,c)){_=!0,d=f,s=f;break}}if(0==_)break}a=d,l=i}for(i=l;i<r;){var S=0==i;c=S?null:t[i++],u=t[i++];var m=e._get_dbObjByDID(u),C=null;0==S&&(C=e._get_dbObjByDID(c));var T=new n(m,C);S?o.setRoot(T):(a.addChild(T),T.setParent(a)),a=T}}))}catch(e){this._plugSvcs.errout("Exception while building riTree: "+e),o=null}return o},r.prototype.attachIconsToNodes=function(){var e=this,t=!1;try{this._typeIconsArrayArray.forEach((function(t){t.forEach((function(t){for(var i=t.did,n={smallURL:t.icon,largeURL:t.thumbnail_2d},o=i.length,r=0;r<o;r++){var s=i[r];e._get_dbObjByDID(s).setAttr("typeIcons",n)}}))})),t=!0}catch(e){this._plugSvcs.errout("Failure attaching icons to tree: "+e)}return t},r.prototype._getObjByPhysID=function(e){return this._dbObjByPhysID[e]},r.prototype._get_dbObjByDID=function(e){return this._dbObjByDID[e]},r.prototype._visit_dbObjsAndFN=function(e){for(var t=this._dbObjArray.length,i=!0,n=0;1==i&&n<t;n++){i=e(this._dbObjArray[n])}return i},e.singleton({jsClass:"CV2REFINST_TREE",convert:function(e,t,i,n){for(var o=new r(e,i),s=t.length,a=0;a<s;a++){var l=t[a];if(null!=l.attributes){var u=o.build_dbObj(l.attributes,n.MULTI_VALUE_ATTRS);null!=l.boundingbox&&u.addAttr("boundingbox",l.boundingbox),o.add_dbObj(u)}else null!=l.path?o.add_path(l.path):null!=l.icon__default_thumbnail_2d?o.add_typeIcons(l.icon__default_thumbnail_2d):i.errout("Unknown entry in input:"+JSON.stringify(l)+", skipping...")}0==o.attachIconsToNodes()&&this._plugSvcs.warnout("Failed to attach icons");var c=o.buildTree();return o=null,c}})})),define("DS/CompareWidget2/widget/compareCustomizationFrame",["UWA/Controls/Abstract","DS/UIKIT/Mask","DS/CompareWidget2/Customization/CompareCustomization"],(function(e,t,i){return e.extend({init:function(e,t,i){this._parent({}),this._eventMgr=e,this._options=null!=t?JSON.parse(JSON.stringify(t)):{},this._CCM=i,this.elements.container=UWA.createElement("div",{id:"customization-container",styles:{height:"100%"}})},show:function(e){var n=this;this._parent(),t.mask(n.elements.container),this._CCM.loadCustomizations(!0).then((function(o){void 0!==n._compareCustomizationPage&&null!==n._compareCustomizationPage||(n._compareCustomizationPage=new i(n._CCM)),n._compareCustomizationPage.show(n.elements.container,e,n.onDone.bind(n)),t.unmask(n.elements.container)}),(function(t){console.error("FAILED to load customizations..."),void 0!==n._compareCustomizationPage&&null!==n._compareCustomizationPage||(n._compareCustomizationPage=new i(n._CCM)),n._compareCustomizationPage.show(n.elements.container,e,n.onDone.bind(n))}))},onDone:function(e){this._eventMgr.publish({event:"Event_controlCustomizationDone",data:e})},refreshFrame:function(){null!=this._compareCustomizationPage&&this._compareCustomizationPage.reset(),this.show()}})})),define("DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/exAdapter",["UWA/Class","DS/CompareWidget2/support/cw2Utils"],(function(e,t){return e.extend({convert:function(e){return t.errout("Abstract base class called; requires implementation"),null}})})),define("DS/CompareWidget2/Customization/getProfileNameDialog",["UWA/Class","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/Label","DS/Controls/LineEditor","i18n!DS/CompareCommon/assets/nls/CompareCustomization"],(function(e,t,i,n,o,r,s){"use strict";return e.extend({init:function(e,o){this._parent({}),this.options=e,this.onClickOkCallback=o,this.immersiveFrame=new t,this.immersiveFrame.inject(widget._isODTMode()?document.body:widget.body),this.content=this._buildContent(),this.dialog=new i({title:e.dialogTitle,content:this.content,immersiveFrame:this.immersiveFrame,resizableFlag:!0,visibleFlag:!0,modalFlag:!0,buttons:{Ok:new n({label:e.okLabel,domId:"compare_getprofname_OK",onClick:this._onClickOk.bind(this),disabled:!1,emphasize:"primary"}),Cancel:new n({label:e.cancelLabel,domId:"compare_getprofname_Cancel",onClick:this._onClickCancel.bind(this),disabled:!1,emphasize:"secondary"})}}),this.dialog.addEventListener("close",this._onDialogClose.bind(this))},_buildContent:function(){var e=this;let t=UWA.createElement("div",{id:"compare_getprofname_dialog"}),i=UWA.createElement("div",{}).inject(t);i.setStyle("display","inline-flex"),i.setStyle("width","100%");let n=new o({value:s.get("ProfileTitleLabel")+"*"}).inject(i);return n.getContent().style.fontWeight="bold",n.getContent().style.background="white",this.nameEditor=new r({placeholder:s.get("ProfileTitlePlaceholder"),maxLength:100,requiredFlag:!0}).inject(i),this.nameEditor.addEventListener("uncommittedChange",(function(t){e.messageLabel.setText(t.options.uncommittedValue.length>99?s.get("PROFILE_TITLE_LONG"):"")})),this.nameEditor.getContent().style.width="100%",this.messageLabel=UWA.createElement("div",{id:"compare_getprofname_message",html:[]}).inject(t),this.messageLabel.setStyles({color:"red","margin-top":"6px"}),t},_onDialogClose:function(){this.dialog.removeEventListener("close",this._onDialogClose.bind(this)),this.dialog.destroy(),this.immersiveFrame.destroy()},_onClickOk:function(){if(this.nameEditor.validFlag)if(void 0!==this.options.existingNames&&null!==this.options.existingNames&&this.options.existingNames.includes(this.nameEditor.value)){let e=s.get("PROFILE_TITLE_ALREADY_EXISTS").replace("{msgData}",this.nameEditor.value);this.messageLabel.setText(e)}else this.onClickOkCallback(this.nameEditor.value),this.dialog.close();else""===this.nameEditor.value?this.messageLabel.setText(s.get("PROFILE_TITLE_REQUIRED")):this.messageLabel.setText(s.get("PROFILE_TITLE_INVALID_CHARS"))},_onClickCancel:function(){this.dialog.close()}})})),define("DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/externalController",[],(function(){var e=function(e,t,i){this._getActiveTreeCB=e,this._isListCB=t,this.dbgout=i};return e.prototype.destroy=function(){this._getActiveTreeCB=null,this._isListCB=null},e.prototype.setSelectedNodes=function(e){return this._selectNodes(e)},e.prototype.clearSelectedNodes=function(){this._clearSelections()},e.prototype._selectNodes=function(e){var t=this,i=t._getActiveTreeCB();i.withUpdateLocked((()=>{var n=[];i.dataGridViews.forEach(((i,o)=>{t.dbgout("XSELECT","   structComparePanel._selectNodes dataGrid # "+o),e.forEach((function(e,o){t.dbgout("XSELECT","      structComparePanel._selectNodes selection # "+o);var r=t._find_nodes_from_path(i,e);r.length>0&&(t.dbgout("XSELECT","      structComparePanel._selectNodes _find_nodes_from_path found "+r.length+" nodes"),r.forEach(((e,i)=>{n.push(e);var o=e.getAttr("title"),r=e.getAttr("type");t.dbgout("XSELECT","        "+o+" "+r)})))}))})),t.dbgout("XSELECT","   structComparePanel._selectNodes calling selectByCrNodes with "+n.length),i.selectByCrNodes(n)}))},e.prototype._clearSelections=function(){var e=this._getActiveTreeCB();e.withUpdateLocked((()=>{e.dataGridViews.forEach(((t,i)=>{e.clearNTHGridSelection(i)}))}))},e.prototype._find_nodes_from_path=function(e,t){var i=this,n=[],o=[];"/"==t[0]&&(t=t.substr(1));var r=t.split("/");if(null!=r&&Array.isArray(r)&&r.length>0){var s=r.length,a=Math.floor(s/2)+1,l=r[0],u=i._isListCB();for(const t of e.model){let e=t.options.data;if(null!=e){var c=e.getObjIDSpec_REF(),d=e.getObjIDSpec_INST();if(null!=c)if(u)null==d?1===a&&c.getPhysID()===r[0]&&(i.dbgout("XSELECT","      structComparePanel._find_nodes_from_path - found node in LIST"),n.push(e)):a>1&&c.getPhysID()===r[s-1]?(i.dbgout("XSELECT","      structComparePanel._find_nodes_from_path - found node in LIST"),n.push(e)):a>2&&d.getPhysID()===r[s-4]&&c.getPhysID()===r[s-3]&&(i.dbgout("XSELECT","      structComparePanel._find_nodes_from_path - found node in LIST"),o.push(e));else if(c.getPhysID()===l)if(1===a)i.dbgout("XSELECT","      structComparePanel._find_nodes_from_path - found node in TREE (root node)"),n.push(e);else{i.dbgout("XSELECT","      structComparePanel._find_nodes_from_path - searching thru root "+l);i._find_node_from_path(e,2,r,n)}}}return 0===n.length&&o.length>0?o:n}},e.prototype._find_node_from_path=function(e,t,i,n){var o=this;e.getChildArray().forEach(((e,r)=>{var s=e.getObjIDSpec_REF(),a=null!=s?s.getPhysID():"null",l=e.getObjIDSpec_INST(),u=null!=l?l.getPhysID():"null",c=i[2*(t-1)-1],d=i[2*(t-1)];if(u===c&&a===d){var p=Math.floor(i.length/2+1);t===p?(n.push(e),o.dbgout("XSELECT","      structComparePanel._find_nodes_from_path - found node in TREE (under root)")):t<p&&(++t,o._find_node_from_path(e,t,i,n),--t)}}))},e})),define("DS/CompareWidget2/ViewDefModules/DSColors",[],(function(){var e={colorDef:{BLUE1:"#009DDB",ORANGE:"#FF8A2E",VIOLET:"#9B2C98",GREEN1:"#00AA86",PINK:"#F564A3",BLUE2:"#8DDEE4",RED:"#CC092F",GREY1:"#E2D5CC",GREEN2:"#6FBC4B",PURPLE:"#70036B",BLUE3:"#002596",BEIGE:"#C6C68B",GREY2:"#7F7F7F",BLUE4:"#4EA8B7",GREEN3:"#007A4C",GREY3:"#ADADAD",BLUE5:"#127277",RED2:"#6D2815",BLACK:"#000000",BLUE6:"#4D62BA",YELLOW:"#FEE000",WHITE:"#FFFFFF",NONE:"",LIGHT_TAN:"#EEEEEE",V1DIFF_STATUS:"#D2B48C",V1REV_STATUS:"#982C98",V1MOVE_STATUS:"#FFCC00",V1QTY_STATUS:"#1494DE"}};return e.colorSeq=[e.colorDef.BLUE1,e.colorDef.ORANGE,e.colorDef.VIOLET,e.colorDef.GREEN1,e.colorDef.PINK,e.colorDef.BLUE2,e.colorDef.RED,e.colorDef.GREY1,e.colorDef.GREEN2,e.colorDef.PURPLE,e.colorDef.BLUE3,e.colorDef.BEIGE,e.colorDef.GREY2,e.colorDef.BLUE4,e.colorDef.GREEN3,e.colorDef.GREY3,e.colorDef.BLUE5,e.colorDef.RED2,e.colorDef.BLACK,e.colorDef.BLUE6,e.colorDef.YELLOW,e.colorDef.WHITE,e.colorDef.NONE],e})),define("DS/CompareWidget2/plugins/STRUCTURE/STRUCT_LIST_VIEW_PREP_PLUGIN",["DS/CompareWidget2/plugins/plugin"],(function(e){return e.extend({init:function(e,t,i,n){this._parent(e,t,i,n)},execute:function(e,t){var i=this;i._parent(e,t),e.crTreeArray.forEach((function(e){e.niceUp(!0,!0,t&&!0===t.isCustomMatching)})),null!=e?i.reportOK(e):i.reportKO()}})})),define("DS/CompareWidget2/plugins/VIEW3D/ViewPanel/exclusiveHideShowController",["UWA/Class","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/SceneGraphOverrides/SceneGraphOverrideSet","DS/Visualization/SceneGraphUtils","DS/Visualization/IdPath","DS/PADUtils/PADSettingsMgt"],(function(e,t,i,n,o,r){return t.customIdsUnstreamer=e=>e.split(".")[0],e.extend({init:function(e){this._hideShowController=e,this._xShowSGOS=null,this._isLightNodeModel=r.getSetting("enopad3dviewer_lightNodeModel")},_getPAD3DViewer:function(){var e=null;return null!=this._hideShowController&&(e=this._hideShowController._context),e},_getSceneGraphOverrideSet:function(){var e=null;return null!=this._hideShowController&&(e=this._hideShowController._sceneGraphOverrideSet),e},_createOverrideSet:function(){null!=this._hideShowController&&(delete this._hideShowController._sceneGraphOverrideSet,this._hideShowController.createOverrideSet())},_publish:function(e){null!=this._hideShowController&&this._hideShowController.publish(e)},subscribe:function(e,t){if(null!=this._hideShowController)return this._hideShowController.subscribe(e,t)},unsubscribe:function(e){null!=this._hideShowController&&this._hideShowController.unsubscribe(e)},_getViewer:function(){var e=null,t=this._getPAD3DViewer();return null!=t&&(e=t.getViewer()),e},_getSceneGraphOverrideSetManager:function(){var e=null,t=this._getViewer();return null!=t&&(e=t.getSceneGraphOverrideSetManager()),e},_getPAD3DController:function(){var e=null,t=this._getPAD3DViewer();return null!=t&&(e=t.getController()),e},_asyncRender:function(){var e=this;setTimeout((function(){e._getViewer().render({updateInfinitePlane:!0})}))},hide:function(e){this._hideShowController.hide(e)},show:function(e){this._hideShowController.show(e)},exclusiveShow:function(e){if("object"!=typeof e)throw new Error("No parameter defined");if(!Array.isArray(e.paths))throw new Error("No paths to be shown defined");var i=this;if(i._isLightNodeModel){i._resetExclusiveShow();var r=i._getPAD3DController().getRoots(),s=e.paths.length,a=2==s;if(1==a)for(var l=0;l<s;l++)if(1!=e.paths[0].length){a=!1;break}var u=[];for(l=0;l<r.length;l++){var c=t.getNodeID(r[l]);c&&u.push(new o([i._getPAD3DController().getRootBagId(),c]))}if(u.length){var d=i._xShowSGOS.createIdPathOverride({idPathes:u,propagateUntilRepRefs:!0});d&&d.setVisibility(1==a)}if(0==a){var p=[];for(l=0;l<e.paths.length;l++)p.push(new o([i._getPAD3DController().getRootBagId()].concat(e.paths[l])));if(p.length){var h=i._xShowSGOS.createIdPathOverride({idPathes:p,propagateUntilRepRefs:!0});h&&h.setVisibility(!0);var _=i._xShowSGOS.createIdPathOverride({idPathes:p,propagateToParents:!0});_&&_.setVisibility(!0)}}i._asyncRender(),i._publish({event:"onExclusiveShow",data:e})}else{i._resetExclusiveShow();var g=i._getPAD3DController()._model._nodeIndex,f=Object.getOwnPropertyNames(g),S=i._getPAD3DController()._model.getRootBag();f.forEach((function(e){g[e].is3DLeaf&&g[e].is3DLeaf()&&n.buildPathesLeadingToNode(g[e],S).forEach((function(e){i._getSceneGraphOverrideSet().createOverride(e).setVisibility(!1)}))})),e.paths.forEach((function(e){if(t.isAModelPath(e)){var o=e.getLastElement(!0);if(o.is3DLeaf&&o.is3DLeaf()){i._getSceneGraphOverrideSet().createOverride(e).setVisibility(!0)}else{var r=[],s={};o.traverse((function(t){t.is3DLeaf&&t.is3DLeaf()&&!s[t.getID()]&&(s[t.getID()]=!0,n.buildPathesLeadingToNode(t,S).forEach((function(t){e.isAParentOf(t)&&r.push(t)})))})),r.forEach((function(e){i._getSceneGraphOverrideSet().createOverride(e).setVisibility(!0)}))}}}));var m=i._getSceneGraphOverrideSetManager();m&&(m.removeSceneGraphOverrideSet(i._getSceneGraphOverrideSet()),m.pushSceneGraphOverrideSet(i._getSceneGraphOverrideSet())),i._asyncRender(),i._publish({event:"onExclusiveShow",data:e})}},_resetExclusiveShow:function(){var e=this;if(e._isLightNodeModel){(t=e._getSceneGraphOverrideSetManager())&&(null!=e._xShowSGOS&&(t.removeSceneGraphOverrideSet(e._xShowSGOS),delete e._xShowSGOS),e._xShowSGOS=new i(e._getPAD3DController().getRootBag(),e._getPAD3DController().getRootBagId(),!0),t.pushSceneGraphOverrideSet(e._xShowSGOS)),e._asyncRender()}else{var t,n=e._getSceneGraphOverrideSet();if(null!=n)(t=e._getSceneGraphOverrideSetManager())&&t.removeSceneGraphOverrideSet(n),e._createOverrideSet(),e._asyncRender()}}})})),define("DS/CompareWidget2/viewComponents/MainToolbar",["UWA/Class","DS/CompareCommon/Utils","i18n!DS/CompareWidget2/assets/nls/CompareV2","DS/Tweakers/GeneratedToolbar","DS/CompareWidget2/support/cw2Utils","DS/CompareCommon/Probs/CompareAnalyticsProb"],(function(e,t,i,n,o,r){"use strict";return e.extend({init:function(){},createToolbar:function(e,n,o,s,a,l,u){var c=this;(this._eventMgr=n,this._eventMgr.subscribe({event:"EXPORT_IS_DISABLED"},c._disableExportButton.bind(c)),this._eventMgr.subscribe({event:"EXPORT_IS_ENABLED"},c._enableExportButton.bind(c)),this._deferredEnableExport=!1,this._isToolbarCreated&&this.mainToolbar&&this.destroyToolbar(),this._isToolbarCreated=!1,this.resultFrame=e,this.toolbarContainer=o,this.mainToolbarOptions=a,s)&&require(["text!"+s],(function(e){var n=JSON.parse(e);n.entries.forEach((function(e){!0===e.hasTooltip&&(e.tooltipInfos=t.generateTooltip("CompareWidget2/Tooltips",e.id)),"object"==typeof e.dataElements.value?(e.dataElements.value.argument={},e.dataElements.value.argument.objects=c):"customEnumMember"===e.dataElements.typeRepresentation?e.dataElements.label=i[e.id]:"string"==typeof e.dataElements.value&&"color"!==e.dataElements.typeRepresentation&&(e.dataElements.value=i[e.id]),a.forEach((function(t){var i=t.replace(/\s+/g,"");e.id.toLowerCase().indexOf(i.toLowerCase())>=0&&(e.dataElements.visibleFlag=!1)}))})),c.buildToolbar(n,l,u),c.resultFrame.setToolbarCreated(),c.updateToolbar();let o=c?.resultFrame?._layout.getActiveViews();console.log("probs -- compare actionname changes from "+r.getActiveViewActionName()+" to activate view"),r.setActiveViewActionName("activate view");let s=c?.resultFrame?._layout.getActiveViewTab();console.log("probs -- compare active view tab changes from "+r.getActiveViewName()+" to "+s),r.setActiveViewName(s),console.log("probs -- compare current dispalyed views changes from [ "+r.getDisplayedViews()+" ] to [ "+o+" ]"),r.setDisplayedViews(o)}))},buildToolbar:function(e,t,i){let n=this;this._isToolbarCreated=!0,this._toolbarObjTypes=[],this._customConfigActive=i;let o=e.entries.findIndex((e=>"mainToolbarProfile"===e.id)),r=e.entries.findIndex((e=>"mainToolbarEditCustomization"===e.id)),s=e.entries[o]||null,a=e.entries[r],l=!0;if(s&&a)if(!0===i){if(this.resultFrame&&this.resultFrame._CCM&&null!=t&&void 0!==t.typeInfoArray&&void 0!==t.typeInfoArray&&t.typeInfoArray.length>0){let o=t.typeInfoArray.map((e=>e.type));this._toolbarObjTypes=o,l=!1,this.resultFrame._CCM.getProfileNames({getTemplates:!1,objTypes:o}).then((o=>{n.buildToolbar_finishCustomProfiles(i,e,t,o,s,a)}))}}else s.visibleFlag=!1,a.visibleFlag=!1;if(l){let n=null;this.buildToolbar_finishCustomProfiles(i,e,t,n,s,a)}},buildToolbar_finishCustomProfiles:function(e,t,o,r,s,a){if(s&&a){if(null!=r&&r.length>0){let e=this.resultFrame._CCM.getUserPreferredProfileName(o);r.unshift(i.mainToolbarProfileDefault),null!=e&&s.dataElements.value!==e&&(s.dataElements.value=e,require(["DS/CompareWidget2/viewComponents/MainToolbarEvents"],(t=>{null==t._lastProfileValue&&(t._lastProfileValue=e)})))}else r=[i.mainToolbarProfileDefault];e&&(s.dataElements.possibleValues=r),s.visibleFlag=e,a.visibleFlag=e}this._replaceLeftAndRightColorWithOptionsColors(t),this.toolbarModel=n.prototype.createTreeDocument(t),this.mainToolbar=new n({items:this.toolbarModel}),this.mainToolbar._eventMgr=this._eventMgr,this.mainToolbar.inject(this.toolbarContainer),1==this._deferredEnableExport&&(this._deferredEnableExport=!1,this._enableExportButton())},updateToolbar:function(){this.mainToolbar&&(this.mainToolbar.prepareUpdateView(),this.mainToolbar.updateNodeModel("mainToolbarDisplayViews",{disabled:this.resultFrame._layout.getViews().length<2||null!=this.resultFrame._layout.maximizedPanel}),this.mainToolbar.pushUpdateView())},_disableExportButton:function(){this.mainToolbar&&(this.mainToolbar.prepareUpdateView(),this.mainToolbar.updateNodeModel("mainToolbarExport",{disabled:!0}))},_enableExportButton:function(){this.mainToolbar?(this.mainToolbar.prepareUpdateView(),this.mainToolbar.updateNodeModel("mainToolbarExport",{disabled:!1})):this._deferredEnableExport=!0},updateComparisonProfileDropdownUI:function(){if(!0===this._customConfigActive){let e=null,t=null;if(this.mainToolbar){let n=n=>{try{this.mainToolbar.prepareUpdateView(),t=null!=n&&n.length>0,t?(n.unshift(i.mainToolbarProfileDefault),e=!0):(n=[i.mainToolbarProfileDefault],e=!0),this.mainToolbar.updateNodeModel("mainToolbarEditCustomization",{visibleFlag:e});let o={visibleFlag:e};e&&null!=n&&(o.possibleValues=n),this.mainToolbar.updateNodeModel("mainToolbarProfile",o),this.mainToolbar.pushUpdateView()}catch(e){o.warnout("Failed updating maintoolbar... continuing... :: "+e)}};this.resultFrame._CCM.getProfileNames({getTemplates:!1,objTypes:this._toolbarObjTypes,callBackAfterProfilesUpdated:n})}}},destroyToolbar:function(){null!=this.mainToolbar&&this.mainToolbar.destroy(),this.mainToolbar=null,this._isToolbarCreated=!1},_replaceLeftAndRightColorWithOptionsColors:function(e){if(null!=this.resultFrame._panelSpecSet.STRUCT_VIEW&&null!=this.resultFrame._panelSpecSet.STRUCT_VIEW.plugin&&null!=this.resultFrame._panelSpecSet.STRUCT_VIEW.plugin._pluginOptions&&null!=this.resultFrame._panelSpecSet.STRUCT_VIEW.plugin._pluginOptions.SYSTEM_RULE_ID_FLAGS&&null!=this.resultFrame._panelSpecSet.STRUCT_VIEW.plugin._pluginOptions.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY&&null!=this.resultFrame._panelSpecSet.STRUCT_VIEW.plugin._pluginOptions.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR&&null!=this.resultFrame._panelSpecSet.STRUCT_VIEW.plugin._pluginOptions.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY&&null!=this.resultFrame._panelSpecSet.STRUCT_VIEW.plugin._pluginOptions.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR){let t=this.resultFrame._panelSpecSet.STRUCT_VIEW.plugin._pluginOptions.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR,i=this.resultFrame._panelSpecSet.STRUCT_VIEW.plugin._pluginOptions.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR,n=e.entries.findIndex((e=>"mainToolbarLeftObjectColor"===e.id)),o=e.entries.findIndex((e=>"mainToolbarRightObjectColor"===e.id));-1!==n&&""!==t&&(e.entries[n].dataElements.value=t),-1!==o&&""!==i&&(e.entries[o].dataElements.value=i)}}})})),define("DS/CompareWidget2/implementations/costing/UserSettings",["UWA/Core","DS/CompareWidget2/userSettings/MultiStructBase"],(function(e,t){let i=e.clone(t,!0);return i.viewSettings.STRUCT_VIEW.DISPLAYED_COST={value:null},i})),define("DS/CompareWidget2/viewComponents/MainToolbarEvents",["DS/CompareWidget2/userSettings/UserSettingsManager","DS/CompareCommon/Utils","i18n!DS/CompareWidget2/assets/nls/CompareV2"],(function(e,t,i){"use strict";function n(e,n,o,r,s,a){var l={id:e,type:n,title:i[e],tooltip:t.generateTooltip("CompareWidget2/Tooltips",e)};return"function"==typeof r&&(l.state=!0===r.bind(l)()?"selected":""),null!=o&&(l.icon=o),"function"==typeof s&&(l.action={callback:s.bind(l)}),null!=a&&(l.submenu=a),l}var o=Object.create(null);return o._lastProfileValue=null,o.onClickSwap=function(e){e.objects._eventMgr.publish({event:"Event_CW2_SWAP"})},o.onClickRefresh=function(e){e.objects._eventMgr.publish({event:"Event_CW2_REFRESH"})},o.onClickX=function(e){o._lastProfileValue=null,e.objects._eventMgr.publish({event:"Event_CW2_RESET_TO_INPUT"})},o.onClickExport=function(e){e.objects._eventMgr.publish({event:"EXECUTE_EXPORT_EVENT"})},o.onProfileUpdate=function(e){if(void 0!==e.context&&null!==e.context&&null!=e.context.nodeModel&&null!=e.context.nodeModel){let t=e.context.nodeModel.getAttributeValue("data");t==o._lastProfileValue||"Default"===t&&"__|DEFAULT|__"===o._lastProfileValue||(o._lastProfileValue=t,e.context.toolbar._eventMgr.publish({event:"Event_CW2_SELECT_PROFILE",data:t}))}},o.onEditCustomization=function(e){let t=e.objects.mainToolbar.elements.farContainer.getElement("#compare-main-customization-profile .wux-controls-combobox .wux-controls-combobox-mainelement"),i="";null!=t&&(i=t.getText()),e.objects._eventMgr.publish({event:"Event_showControlCenter",data:{profileName:i}})},o.createViewDropdown=function(e){var t=e.objects.resultFrame._layout;if(!t.maximizedPanel){for(var i=t.getViews(),n=[],o=0;o<i.length;o++){var r=i[o],s={type:"CheckItem",title:r.getLabel(),uid:r.getName(),state:t.isViewOpen(r)?"selected":"",action:{callback:function(){t.onClickShowHideViewCmd(this)},this:r}};n.push(s)}var a=e.objects.mainToolbar.elements.container.getElement(".wux-ui-3ds-eye-cog").getBoundingClientRect();require(["DS/Menu/Menu"],(e=>e.show(n,{position:{x:a.right,y:a.bottom},layout:"topright"})))}},o.createAdditionalMenu=function(r){var s=[n("compareSettings.includeFacets.externalRelations","PushItem","object-related-cog",null,null,[n("compareSettings.includeFacets.externalRelations.showDocs","CheckItem","doc",(function(){return"true"===e.get(this.id)||!0===e.get(this.id)}),(function(){e.set(this.id,!e.get(this.id)),r.objects._eventMgr.publish({event:"Event_CW2_REFRESH"})})),n("compareSettings.includeFacets.externalRelations.showOtherRels","CheckItem","object-related",(function(){return"true"===e.get(this.id)||!0===e.get(this.id)}),(function(){e.set(this.id,!e.get(this.id)),r.objects._eventMgr.publish({event:"Event_CW2_REFRESH"})}))]),{id:"closeAllObjects",type:"PushItem",title:i.closeAllObjects,tooltip:t.generateTooltip("CompareWidget2/Tooltips","closeAllObjects"),icon:"close",action:{callback:function(){o.onClickX(r)}}},{id:"mainToolbarRestoreLayout",tooltip:t.generateTooltip("CompareWidget2/Tooltips","mainToolbarRestoreLayout"),type:"PushItem",icon:"reset",title:i.restoreLayout,action:{callback:function(){r.objects.resultFrame.applyDefaultLayout()}}}];r.objects.mainToolbarOptions.forEach((function(e){for(var t=e,i=0;i<s.length;i++)s[i].id.indexOf(t)>=0&&(s.splice(i,1),i--)}));var a=r.objects.mainToolbar.elements.container.getElement(".wux-ui-3ds-menu-dot").getBoundingClientRect();require(["DS/Menu/Menu"],(e=>e.show(s,{position:{x:a.right,y:a.bottom},layout:"topright"})))},o})),define("DS/CompareWidget2/support/DataCenter",["UWA/Class","DS/WidgetServices/WidgetServices","DS/LifecycleServices/LifecycleServicesSettings","DS/WAFData/WAFData","DS/CompareWidget2/support/cw2Utils"],(function(e,t,i,n,o){var r=e.singleton({init:function(){this._parent({})},makeAuthHttpsCall:function(e,r,s,a,l,u,c,d,p,h,_){return new Promise((function(g,f){null!=e&&e.constructor==String&&0!=e.length||f("BAD svcPath format:"+e),"GET"!=r&&"POST"!=r&&f("Method type: "+r+" is not supported"),null==c&&o.warnout("Call to "+e+" is missing securityContext");var S=u||"3DSpace",m=l||"OnPremise",C=e,T=null;let E;if("POST"==r&&null!=s&&(T=!0===p?s:UWA.Json.encode(s),s=null),"3dspace"==S.toLowerCase()&&"3DSpace"!=S&&(o.errout("Correcting malforded service '"+S+"' to '3DSpace'"),S="3DSpace"),null!=c){let e=!0;["/cvservlet/progressiveexpand/v2","/cvservlet/fetch/v2","/cvservlet/expand3d"].forEach((function(t){C.includes(t)&&(e=!1)})),E=1==e?encodeURIComponent(c):c}var v=i.getPlatformWSUrl(S,m,C,h||s),D={Accept:"application/json","Accept-Language":t.getLanguage(),"Content-Type":!0===p?"text/plain":"application/json",SecurityContext:E};if(_)try{var I=_.get();I.change.id.length>0&&(D["DS-Change-Authoring-Context"]="pid:"+I.change.id),I.evolution.id.length>0&&(D["DS-Configuration-Authoring-Context"]="pid:"+I.evolution.id)}catch(e){}var y=1!=d;n.authenticatedRequest(v,{method:r,type:a,timeout:48e4,data:T,headers:D,proxy:"passport",cache:y,onComplete:function(e){null!=e&&null!=e.STATUS?"OK"==e.STATUS?g(e.RESULT):(o.errout("**** SERVER ERROR calling: "+v),o.errout("**** MSG: "+e.MSG),f(e.MSG)):null==e?(o.errout("**** SERVER ERROR calling: "+v),o.errout("**** RESPONSE IS null"),f("null response")):g(e)},onFailure:function(e){o.errout("**** HTTPS ERROR calling: "+v),o.errout("**** MSG: "+e),null!=c&&""!=c||o.errout("**** Probably related to blank security context in request"),f(e)}})}))},loadPageObject:function(e,t,i){var n="/resources/collabCommon/settings/getComparePageObj/"+e;return this.makeAuthHttpsCall(n,"GET",null,"json",t,"3DSpace",i,!0)},savePageObject:function(e,t,i,n){var o="/resources/collabCommon/settings/updateComparePageObj/"+e;return this.makeAuthHttpsCall(o,"POST",{settings:{content:t}},"json",i,"3DSpace",n,!0)},fetchFilterDefinition:function(e){return new Promise((function(t,i){var n="filterId="+e.getPhysID();r.makeAuthHttpsCall("/resources/FilterBIAPI/Filter/getFilterFromId","GET",n,"json",e.getTenant(),e.getServiceName(),e.getSecurityContext()).then((function(e){var i=e.ENOStrSpecDesc;t(i)}),(function(e){i(e)}))}))}});return r})),define("DS/CompareWidget2/Customization/CompareCustomization",["UWA/Core","DS/Core/Core","DS/Utilities/Dom","DS/Controls/Button","DS/Controls/Label","DS/Controls/ComboBox","DS/Controls/Toggle","DS/Controls/ButtonGroup","DS/WUXAutoComplete/AutoComplete","DS/Controls/Expander","DS/Utilities/WebUXColorEnums","DS/DataGridView/DataGridView","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/TreeModel/DataModelSet","DS/UIKIT/Mask","DS/CompareCommon/Utils","DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/support/DataCenter","DS/CompareWidget2/ViewDefModules/DSColors","DS/CompareWidget2/Customization/getProfileNameDialog","DS/CompareWidget2/Customization/Profile","DS/CompareWidget2/plugins/ATTRIBUTE/ViewPanel/attrChooseDialog","i18n!DS/UIKIT/assets/nls/UIKIT","i18n!DS/CompareCommon/assets/nls/CompareCustomization","i18n!DS/CompareWidget2/assets/nls/DisplayMessages","css!DS/CompareWidget2/CompareWidget2.css"],(function(e,t,i,n,o,r,s,a,l,u,c,d,p,h,_,g,f,S,m,C,T,E,v,D,I,y){"use strict";const b="compare-customization-footerbutton",R="compare-customization-help",A="compare-customization-row",O="compare-customization-row-chips-cont",P="compare-customization-label",N="MR_Order",w="MR_StatusName",L="MR_Attribute",U="MR_Color",F="AS_Facet",M="AS_Attribute",V="AS_Color",x=!1;function W(e){let t=e.getChildren();for(var i=0;i<t.length;++i)t[i].options.grid.MR_Order=i+1}function j(e,t,i){return t.prepareUpdate(),t.addRoot(e),!0===i&&W(t),t.pushUpdate(),t.getChildren().length}function G(e,t){let i=(27+26*(e<1?1:e)).toString()+"px";t.setStyles({height:i})}var B=function(e){if(null==e)throw Error("CompareCustomization: Compare customizations are not loaded");this._CCM=e,this.initModel()};function k(e){return new h({label:I.get("template"===e?"TemplateProfiles":"admin"===e?"AdminProfiles":"MyProfiles"),ccId:"template"===e?"templates":"admin"===e?"adminprofiles":"userprofiles",comboBoxSemantics:"section",description:I.get("template"===e?"TemplateProfilesDescription":"admin"===e?"AdminProfilesDescription":"MyProfilesDescription")})}return B.prototype.initModel=function(){this._currentProfile=null,this._currentProfileOrg=null,this._TypesInfo={},this._CustomTypesInfo={},this._CustomInterfacesInfo={},this._RolesInfo={},this._manipulatingProfileFromUI=!0,this._profileNameDlg=null},B.prototype.show=function(e,t,i){this.doneCB=i,this.buildSkeleton(e),this._initialProfileIn="",this._initialProfileInChanged=!0,null!=t&&void 0!==t.profileName&&null!==t.profileName&&""!==t.profileName&&(this._initialProfileIn=t.profileName,this._initialProfileInChanged=!1),this.initUI(t)},B.prototype.buildSkeleton=function(t){void 0!==this.customizationRoot&&null!==this.customizationRoot||(this.customizationRoot=e.createElement("div",{id:"compare-customization-root",html:[]}),this.customizationRoot.inject(t),this.buildSkeleton_Header(),this.buildSkeleton_Body(),this.buildSkeleton_Footer())},B.prototype.buildSkeleton_Header=function(){},B.prototype.buildSkeleton_Body=function(){this.customizationBody=e.createElement("div",{id:"compare-customization-body",html:[]}).inject(this.customizationRoot),this.buildSkeleton_Section_Profile(),this.buildSkeleton_Section_Rules()},B.prototype.buildSkeleton_Section_Profile=function(){this.profileContent=e.createElement("div",{class:"compare-customization-exp-cont"}),this.profileRow=e.createElement("div",{class:A}).inject(this.customizationBody),this.profileRow.setStyle("padding-bottom","10px");new u({header:I.get("TypesAndExtensionsLabel"),body:this.profileContent,style:"simple",expandedFlag:!1}).inject(this.customizationBody);this.profileRow.setStyle("margin-top","0px"),new o({value:I.get("ComparisonProfileLabel")}).inject(this.profileRow).getContent().addClassName(P),i.generateIcon({className:R,iconName:"info",fontIconFamily:WUXManagedFontIcons.Font3DS,tooltipInfos:f.generateTooltip("CompareWidget2/Tooltips","ProfilesTitleTooltips")}).inject(this.profileRow).classList.remove("wux-ui-3ds-lg"),this.profilesCombo=new r({placeholder:I.get("NoProfileSpecified"),reachablePlaceholderFlag:!0,elementsTree:null,enableSearchFlag:!1,domId:"compare-customization-profile"}).inject(this.profileRow),this.profilesCombo.getContent().style.width="300px",this.profilesCombo.addEventListener("change",this.onProfileSelected.bind(this)),this.profilesDuplicate=new n({displayStyle:"icon",icon:{iconName:"duplicate",fontIconFamily:WUXManagedFontIcons.Font3DS},showLabelFlag:!1,domId:"compare-customization-duplicate",tooltipInfos:f.generateTooltip("CompareWidget2/Tooltips","DuplicateProfileTooltips")}).inject(this.profileRow),this.profilesDuplicate.getContent().setStyles({"min-height":"16px","line-height":"16px","margin-left":"10px"}),this.profilesDuplicate.addEventListener("buttonclick",this.onDuplicateProfile.bind(this)),this.profilesDelete=new n({displayStyle:"icon",icon:{iconName:"trash",fontIconFamily:WUXManagedFontIcons.Font3DS},showLabelFlag:!1,domId:"compare-customization-delete",tooltipInfos:f.generateTooltip("CompareWidget2/Tooltips","DeleteProfileTooltips")}).inject(this.profileRow),this.profilesDelete.getContent().setStyles({"min-height":"16px","line-height":"16px"}),this.profilesDelete.addEventListener("buttonclick",this.onDeleteProfile.bind(this)),this.typesRow=e.createElement("div",{class:A}).inject(this.profileContent),new o({value:I.get("ObjectTypesLabel")}).inject(this.typesRow).getContent().addClassName(P),i.generateIcon({className:R,iconName:"info",fontIconFamily:WUXManagedFontIcons.Font3DS,tooltipInfos:f.generateTooltip("CompareWidget2/Tooltips","ObjectTypesTooltips")}).inject(this.typesRow).classList.remove("wux-ui-3ds-lg"),this.typesLabelsContainer=e.createElement("div",{class:O}).inject(this.typesRow),this.typesLabels=[],this.typesCustomRow=e.createElement("div",{class:A}).inject(this.profileContent),new o({value:I.get("ObjectTypesCustomLabel")}).inject(this.typesCustomRow).getContent().addClassName(P),i.generateIcon({className:R,iconName:"info",fontIconFamily:WUXManagedFontIcons.Font3DS,tooltipInfos:f.generateTooltip("CompareWidget2/Tooltips","ObjectTypesCustomTooltips")}).inject(this.typesCustomRow).classList.remove("wux-ui-3ds-lg"),this.typesCustomLabelsContainer=e.createElement("div",{class:O}).inject(this.typesCustomRow),this.typesCustomLabels=[],this.typesCustomRow.hide(),this.interfacesRow=e.createElement("div",{class:A}).inject(this.profileContent),new o({value:I.get("InterfacesLabel")}).inject(this.interfacesRow).getContent().addClassName(P),i.generateIcon({className:R,iconName:"info",fontIconFamily:WUXManagedFontIcons.Font3DS,tooltipInfos:f.generateTooltip("CompareWidget2/Tooltips","InterfacesTooltips")}).inject(this.interfacesRow).classList.remove("wux-ui-3ds-lg"),this.interfacesLabelsContainer=e.createElement("div",{class:O}).inject(this.interfacesRow),this.interfacesLabels=[],this.interfacesCustomRow=e.createElement("div",{class:A}).inject(this.profileContent),new o({value:I.get("InterfacesCustomLabel")}).inject(this.interfacesCustomRow).getContent().addClassName(P),i.generateIcon({className:R,iconName:"info",fontIconFamily:WUXManagedFontIcons.Font3DS,tooltipInfos:f.generateTooltip("CompareWidget2/Tooltips","InterfacesCustomTooltips")}).inject(this.interfacesCustomRow).classList.remove("wux-ui-3ds-lg"),this.interfacesCustomLabelsContainer=e.createElement("div",{class:O}).inject(this.interfacesCustomRow),this.interfacesCustomLabels=[],this.interfacesCustomRow.hide(),this.profileInformationLabel=new o({value:"",emphasize:"Highlight"}).inject(this.profileRow)},B.prototype.buildSkeleton_Section_Rules=function(){this.buildSkeleton_Group_MatchingRules(),this.buildSkeleton_Group_AdditionalStatuses()},B.prototype.buildSkeleton_Group_MatchingRules=function(){this.rulesRow=e.createElement("div",{class:A}).inject(this.customizationBody),new o({value:I.get("MatchingRulesLabel")}).inject(this.rulesRow).getContent().addClassName(P),i.generateIcon({className:R,iconName:"info",fontIconFamily:WUXManagedFontIcons.Font3DS,tooltipInfos:f.generateTooltip("CompareWidget2/Tooltips","MatchingRuleTooltips")}).inject(this.rulesRow).classList.remove("wux-ui-3ds-lg");let t=new a({type:"radio"});this.useDefaultRulesBtn=new s({type:"radio",label:I.get("UseDefaultRules"),checkFlag:!0,domId:"compare-customization-default-rules",tooltipInfos:f.generateTooltip("CompareWidget2/Tooltips","UseDefaultMatchingRulesTooltips")}),this.useCustomRulesBtn=new s({type:"radio",label:I.get("UseCustomRules"),checkFlag:!1,domId:"compare-customization-custom-rules",tooltipInfos:f.generateTooltip("CompareWidget2/Tooltips","UseCustomMatchingRulesTooltips")}),t.addChild(this.useDefaultRulesBtn),t.addChild(this.useCustomRulesBtn),this.useDefaultRulesBtn.getContent().setStyles({"margin-right":"5px","margin-left":"5px"}),this.useCustomRulesBtn.getContent().setStyles({"margin-right":"5px","margin-left":"5px"}),this.useDefaultRulesBtn.elements.label.style.marginRight="6px",this.useDefaultRulesBtn.elements.label.style.marginLeft="6px",this.useCustomRulesBtn.elements.label.style.marginRight="6px",this.useCustomRulesBtn.elements.label.style.marginLeft="6px",t.getContent().setStyles({display:"flex","margin-right":"10px","margin-left":"16px"}),t.inject(this.rulesRow),t.addEventListener("change",this.onChangeUseDefaultCustomMatchingRules.bind(this)),this.matchingRulesAdd=new n({label:I.get("AddMatchingRule"),icon:{iconName:"plus",fontIconFamily:WUXManagedFontIcons.Font3DS},displayStyle:"icon",domId:"compare-customization-add-MR",tooltipInfos:f.generateTooltip("CompareWidget2/Tooltips","AddMatchingRuleTooltips")}).inject(this.rulesRow),this.matchingRulesAdd.getContent().setStyles({"min-height":"16px","line-height":"16px","margin-left":"10px"}),this.matchingRulesAdd.addEventListener("buttonclick",this.onAddMatchingRule.bind(this)),this.buildSkeleton_RulesTable("MatchingRulesDataGridViewId")},B.prototype.buildSkeleton_RulesTable=function(t){var i=this,n=e.createElement("div",{class:"compare-customization-table",id:"MatchingRulesDataGridViewId"===t?"compare-customization-MR-table":"compare-customization-AS-table"}).inject(this.customizationBody);const o=27..toString()+"px";n.setStyles({position:"relative",height:o});var r=new _,s=new p({dataModelSet:r});s.prepareUpdate(),s.expandAll(),s.pushUpdate();var a=[];"MatchingRulesDataGridViewId"===t&&a.push({dataIndex:N,text:I.get("MatchingRulesOrder"),typeRepresentation:"number",width:"24px",editableFlag:!1,sortableFlag:!1}),"AdditionalStatusesDataGridViewId"===t&&a.push({dataIndex:F,text:I.get("StatusNameColumnHeader"),typeRepresentation:"string",width:"200px",editableFlag:!1,sortableFlag:!1}),"MatchingRulesDataGridViewId"===t&&a.push({dataIndex:w,text:I.get("StatusNameColumnHeader"),typeRepresentation:"string",width:"200px",sortableFlag:!1,editionPolicy:"EditionInPlace",getCellSemantics:function(e){return{placeholder:I.get("StatusNameColumnHeader")}},getCellClassName:function(e){return e.nodeModel?"MatchingRulesDataGridViewId"===t&&""===e.cellModel?"compare-customization-needvalue":"":"headerClass"}}),a.push({dataIndex:"MatchingRulesDataGridViewId"===t?U:V,text:I.get("StatusColor"),typeRepresentation:"color",width:28,minWidth:28,sortableFlag:!1,editionPolicy:"EditionOnOver"});let l={dataIndex:"MatchingRulesDataGridViewId"===t?L:M,text:I.get("AttributeColumnHeader"),typeRepresentation:"url",sortableFlag:!1,getCellSemantics:function(e){return{possibleValues:function(t){let n=e.nodeModel.options.grid.AS_Facet;return i._getPossibleAttributesDisplay(i._currentProfile,n,!1)},allowMultipleValuesFlag:!0,viewOptions:{multipleValuesSeparator:"MatchingRulesDataGridViewId"===t?I.get("RuleAnd"):I.get("RuleOr")}}},getCellClassName:function(e){return e.nodeModel?"MatchingRulesDataGridViewId"!==t||void 0!==e.cellModel&&null!==e.cellModel&&0!==e.cellModel.length?"":"compare-customization-needvalue":"headerClass"},editableFlag:!1};a.push(l);var u=new d({identifier:t,treeDocument:s,columns:a,placeholder:I.get("MatchingRulesDataGridViewId"===t?"MatchingRulesPlaceholder":"AdditionalStatusesPlaceholder"),defaultColumnDef:{editableFlag:!0},showRowIndexFlag:!1,showSelectionCheckBoxesFlag:!1,showRowHeaderBackgroundFlag:!1,layoutOptions:{rowsHeader:!1,cellHeight:26},showContextualMenuColumnFlag:"MatchingRulesDataGridViewId"===t,showOutlineFlag:!0,columnDragEnabledFlag:!1,showColumnBorderFlag:!0,onContextualEvent:function(e){var n=[];if(e.cellInfos&&e.cellInfos.rowID>-1&&e&&e.collectionView){n=e.collectionView.buildDefaultContextualMenu(e,{insertRow:!1,expandCollapse:!1});var o=e.cellInfos.nodeModel,r=o.getNextBrother(),s=o.getPreviousBrother();"MatchingRulesDataGridViewId"===t&&n.push({type:"PushItem",title:I.get("InsertItemAbove"),fonticon:{content:"wux-ui-3ds wux-ui-3ds-level-up"},action:{callback:function(){S.dbgout("CompareCustomization Insert Row Above this row menu item clicked"),"MatchingRulesDataGridViewId"===t&&i.addMatchingRuleBefore(o)}}}),"MatchingRulesDataGridViewId"===t&&n.push({type:"PushItem",title:I.get("InsertItemBelow"),fonticon:{content:"wux-ui-3ds wux-ui-3ds-level-down"},action:{callback:function(){S.dbgout("CompareCustomization Insert Row Below this row menu item clicked"),"MatchingRulesDataGridViewId"===t&&i.addMatchingRuleBefore(r)}}}),"MatchingRulesDataGridViewId"===t&&null!=s&&n.push({type:"PushItem",title:I.get("IncreaseItemPriority"),fonticon:{content:"wux-ui-3ds wux-ui-3ds-up"},action:{callback:function(){S.dbgout("CompareCustomization Increase Priority of this item clicked"),"MatchingRulesDataGridViewId"===t&&i.moveMatchingRuleUp(e.cellInfos.nodeModel)}}}),"MatchingRulesDataGridViewId"===t&&null!=r&&n.push({type:"PushItem",title:I.get("DecreaseItemPriority"),fonticon:{content:"wux-ui-3ds wux-ui-3ds-down"},action:{callback:function(){S.dbgout("CompareCustomization Decrease Priority of this item clicked"),"MatchingRulesDataGridViewId"===t&&i.moveMatchingRuleDown(e.cellInfos.nodeModel)}}}),"MatchingRulesDataGridViewId"===t&&n.push({type:"PushItem",title:I.get("RemoveItem"),fonticon:{content:"wux-ui-3ds wux-ui-3ds-remove"},action:{callback:function(){S.dbgout("CompareCustomization Remove this row menu item clicked"),"MatchingRulesDataGridViewId"===t&&i.removeMatchingRule(e.cellInfos.nodeModel)}}})}return n},getCellTooltip:function(e){let n="MatchingRulesDataGridViewId"===t?i.matchingRulesDGV:i.additionalStatusesDGV;return"MatchingRulesDataGridViewId"===t&&0===e.columnID?{getAllInformationCB:()=>({model:i.matchingRulesOrderTooltipModel})}:n.getCellDefaultTooltip(e)}}).inject(n);"MatchingRulesDataGridViewId"===t?(this.matchingRulesOrderTooltipModel=f.generateTooltip("CompareWidget2/Tooltips","RuleOrderTooltips"),this.matchingRulesTable=n,this.matchingRulesModel=s,this.matchingRulesDGV=u):(this.additionalStatusesTable=n,this.additionalStatusesModel=s,this.additionalStatusesDGV=u);var c=u.getCellsXSO();c.onPostAdd((function(e){let t=!(void 0===i._currentProfile||null===i._currentProfile),n=t&&i._CCM.isTemplateProfile(i._currentProfile),o=!1;t&&!n&&(o=i._currentProfile.Creator===i._CCM.getUserName()),o&&e.forEach((function(e){if(e.columnDataIndex===L||e.columnDataIndex===M){var t=e.columnDataIndex===L?"MatchingRulesDataGridViewId":"AdditionalStatusesDataGridViewId";i.chooseAttributesDialog(t,e.nodeModel,(function(t){e.nodeModel.prepareUpdate();let i=null!=t?t.map((e=>e.value)):[];e.columnDataIndex===L?e.nodeModel.updateOptions({grid:{MR_Attribute:i}}):e.nodeModel.updateOptions({grid:{AS_Attribute:i}}),e.nodeModel.pushUpdate(),c.empty()}),(function(){c.empty()}))}}))}))},B.prototype.chooseAttributesDialog=function(e,t,i,n){var o=this,r={compareResult:[],defaultAttrs:null,showDefaultPropsOnly:function(){return!1},isTitleAttr:function(e){return!1},showAllProps:function(){return!1},getPropsToHide:function(){return[]},savePropsDisplayOptions:function(e){},getObjTypeNLS:function(e){return o._TypesInfo[e].displayName}};let s="";s="MatchingRulesDataGridViewId"===e?""!=t.options.grid.MR_StatusName?t.options.grid.MR_StatusName:"Matching Rule "+t.options.grid.MR_Order:t.options.grid.AS_Facet;var a="Select "+s+" Attributes";S.dbgout("CompareCustomization Select Attributes menu item clicked "+a);let l=t.options.grid.AS_Facet;var u=this._getPossibleAttributesDisplay(this._currentProfile,l,!1);let c=t.getReferenceValue("MatchingRulesDataGridViewId"===e?L:M);for(var d of c)for(var p of u)if(d.attrName===p.value.attrName&&d.objType.length===p.value.objType.length){p.value.checkFlag=!0;for(var h=0;h<d.objType.length;++h)d.objType[h]!==p.value.objType[h]&&(p.value.checkFlag=!1)}u.sort((function(e,t){let i=e.value.facet.toLowerCase(),n=t.value.facet.toLowerCase();return i<n?-1:i>n?1:!0===e.value.checkFlag&&!0!==t.value.checkFlag?-1:!0!==e.value.checkFlag&&!0===t.value.checkFlag?1:(i=e.value.label.toLowerCase(),n=t.value.label.toLowerCase(),i<n?-1:i>n?1:0)}));var _={Title:a,Icon:"AdditionalStatusesDataGridViewId"===e?u[0].value.icon:null,Attributes:u,AllText:"AdditionalStatusesDataGridViewId"===e?I.get("SelectAllAttributes"):"",AllTextTooltip:"AdditionalStatusesDataGridViewId"===e?I.get("SelectAllAttributesTooltip"):"",LineEditor:!0,GroupAdditionalStatusesByObjectType:"AdditionalStatusesDataGridViewId"===e,Width:"auto"};new v(r,_,function(e){var t=[];for(var n of e){let e=u[n.indexCompare];t.push(e)}i(t)}.bind(r),(function(){"function"==typeof n&&n()}))},B.prototype.buildSkeleton_Group_AdditionalStatuses=function(){this.additionalStatusesRow=e.createElement("div",{class:A}).inject(this.customizationBody),new o({value:I.get("AdditionalStatusesLabel")}).inject(this.additionalStatusesRow).getContent().addClassName(P),i.generateIcon({className:R,iconName:"info",fontIconFamily:WUXManagedFontIcons.Font3DS,tooltipInfos:f.generateTooltip("CompareWidget2/Tooltips","AdditionalStatusTooltips")}).inject(this.additionalStatusesRow).classList.remove("wux-ui-3ds-lg"),this.buildSkeleton_RulesTable("AdditionalStatusesDataGridViewId")},B.prototype.buildSkeleton_Footer=function(){this.customizationFooter=e.createElement("div",{id:"compare-customization-footer",html:[]}).inject(this.customizationRoot),this.saveBtn=new n({label:I.get("SaveCustomizationTitle"),domId:"compare-customization-button-save",tooltipInfos:f.generateTooltip("CompareWidget2/Tooltips","SaveCustomizationTooltips")}),this.cancelBtn=new n({label:D.ko,domId:"compare-customization-button-cancel",tooltipInfos:f.generateTooltip("CompareWidget2/Tooltips","CancelCustomizationTooltips")});let t=(new a).inject(this.customizationFooter);t.addChild(this.saveBtn),t.addChild(this.cancelBtn),t.getContent().setStyles({float:"right"}),this.saveBtn.getContent().addClassName(b),this.cancelBtn.getContent().addClassName(b),this.saveBtn.getContent().setStyles({"margin-right":"10px","border-radius":"4px"}),this.cancelBtn.getContent().setStyles({"border-radius":"4px"}),this.saveBtn.addEventListener("buttonclick",this.onSaveCustomization.bind(this)),this.cancelBtn.addEventListener("buttonclick",this.onCancelCustomization.bind(this))},B.prototype.initUI=function(e){let t=this;this._manipulatingProfileFromUI=!1;let i=null;if(null!=e&&void 0!==e.profileName&&null!==e.profileName&&""!==e.profileName&&(i=e.profileName),null===i&&void 0!==this._currentProfile&&null!==this._currentProfile&&(i=this._currentProfile.Name),null==i||""===i||!this._CCM.profileExists(i)){let e=this._CCM.getOnlyProfileName();i=null!=e?e:""}this.getProfileTreeDocument({getTemplates:!0}).then((e=>{t.profilesCombo.elementsTree=e,null!=i&&""!==i&&(t.profilesCombo.value=i),t._manipulatingProfileFromUI=!0,t.setProfileIntoSkeleton(null==i?"":i,!1,"ignore")}))},B.prototype.getProfileTreeDocument=function(e){let t=this;return new Promise((function(i,n){t._CCM.getProfileNames({getTemplates:null!=e&&1==e.getTemplates,asTree:!0}).then((e=>{var t=new p({shouldBeSelected:function(e){return"section"!==e.options.comboBoxSemantics}});if(void 0!==e.templates&&null!==e.templates&&e.templates.length>0){let i=k("template");for(var n of(t.addRoot(i),e.templates)){let e=new h({label:n,comboBoxSemantics:"leaf"});i.addChild(e)}}if(void 0!==e.adminProfiles&&null!==e.adminProfiles&&e.adminProfiles.length>0){let i=k("admin");for(var n of(t.addRoot(i),e.adminProfiles)){let e=new h({label:n,comboBoxSemantics:"leaf"});i.addChild(e)}}if(void 0!==e.userProfiles&&null!==e.userProfiles&&e.userProfiles.length>0){let i=k("user");for(var n of(t.addRoot(i),e.userProfiles)){let e=new h({label:n,comboBoxSemantics:"leaf"});i.addChild(e)}}t.expandAll(),i(t)}))}))},B.prototype.setProfileIntoSkeleton=function(e,t,i){let n=this,o=!0;return!1===t||n.validateProfileRules(!0,!0)?n._checkChanges(i,"",(function(t){if(t.status&&"save"===t.action)n._setProfileRules(),n._saveToDatabase({silent:!1,name:n._currentProfile.Name});else if(t.status&&"discard"===t.action){if(!0===n._currentProfileOrg.NeverBeenSaved){let e=n._currentProfile.Name;n._CCM.removeProfile(e),n.profilesCombo.elementsTree.prepareUpdate();let t=n.profilesCombo.elementsTree.getChildren().find((e=>"userprofiles"===e.options.ccId));if(null!=t){let i=t.getChildren(),o=1===i.length,r=i.find((t=>t.options.label===e));t.removeChild(r),o&&n.profilesCombo.elementsTree.removeRoot(t)}n.profilesCombo.elementsTree.pushUpdate()}n._currentProfile.UseCustomMatchingRules=n._currentProfileOrg.UseCustomMatchingRules}else if(t.status&&"cancel"===t.action)return n._manipulatingProfileFromUI=!1,n.profilesCombo.value=n._currentProfile.Name,n._manipulatingProfileFromUI=!0,o;n.setValidatedProfileIntoSkeleton(e)})):o=!1,o},B.prototype.validateProfileRules=function(e,t){let i=!0;if(this._CCM.isCustomizationProfile(this._currentProfile)){let l=["MatchingRulesDataGridViewId","AdditionalStatusesDataGridViewId"];!0===e&&this.removeEmptyMatchingRules();var n=!1,o=!1,r=!1,s=[];for(var a of l){let e="MatchingRulesDataGridViewId"===a?this.matchingRulesModel.getRoots():this.additionalStatusesModel.getRoots();for(let t of e){let e=t.getReferenceValue("MatchingRulesDataGridViewId"===a?w:F),i=t.getReferenceValue("MatchingRulesDataGridViewId"===a?L:M);("MatchingRulesDataGridViewId"===a||i.length>0)&&(n=!0,""===e||0===i.length?"MatchingRulesDataGridViewId"===a&&(r=!0):s.includes(e)?o=!0:s.push(e))}}if(r&&(S.dbgout("CompareCustomization Profile - Rules did not validate.  A Matching Rule Name or Attribute field is empty."),f.showAlertBox(I.get("EMPTY_PROFILE_RULES_MR"),null,"error"),i=!1),o&&(S.dbgout("CompareCustomization Profile - Duplicate rule name found."),f.showAlertBox(I.get("DUPLICATE_RULE_NAME"),null,"error"),i=!1),t&&!n){S.dbgout("CompareCustomization Profile - No rules have been specified.");let e=I.get(this._currentProfile.AllowCustomMatchingRules?"NO_PROFILE_RULES":"NO_ADDITIONAL_STATUS_RULES").replace("{msgData}",this._currentProfile.Name);f.showAlertBox(e,null,"error"),i=!1}}return i},B.prototype.setValidatedProfileIntoSkeleton=function(e){g.mask(this.customizationRoot.parentElement),this._currentProfile=this._CCM.getProfile(e);let t=!(void 0===this._currentProfile||null===this._currentProfile),i=t&&this._CCM.isTemplateProfile(this._currentProfile);this._currentProfileOrg=null,t&&(this._currentProfileOrg={UseCustomMatchingRules:this._currentProfile.UseCustomMatchingRules});let n=!1;t&&!i&&(n=this._currentProfile.Creator===this._CCM.getUserName());let r=!0;t&&!i&&(r=this._currentProfile.UserOverrideOK),t?this.profilesDuplicate.show():this.profilesDuplicate.hide(),this.saveBtn.disabled=!(t&&!i&&!n),t&&n?this.profilesDelete.show():this.profilesDelete.hide(),t?i?(this.profileInformationLabel.value=I.get("THIS_IS_A_TEMPLATE_PROFILE"),this.profileInformationLabel.show(),this.saveBtn.disabled=!0,this.saveBtn.emphasize="secondary"):this._currentProfile.isAdminUser?this._CCM.getIsAdminUser()?(this.profileInformationLabel.value="",this.profileInformationLabel.hide(),this.saveBtn.disabled=!1,this.saveBtn.emphasize="primary"):(this.profileInformationLabel.value=I.get("THIS_IS_AN_ADMIN_PROFILE"),this.profileInformationLabel.show(),this.saveBtn.disabled=!0,this.saveBtn.emphasize="secondary"):(this.profileInformationLabel.value="",this.profileInformationLabel.hide(),this.saveBtn.disabled=!1,this.saveBtn.emphasize="primary"):(this.profileInformationLabel.value="",this.profileInformationLabel.hide(),this.saveBtn.disabled=!0,this.saveBtn.emphasize="secondary"),this._getObjTypesInfo(i).then((()=>{var s=[],a=[];if(t){var l=this._currentProfile.Facets;for(var u of l){for(let e of u.ObjectTypes)null!=this._TypesInfo[e]&&s.push(this._TypesInfo[e].displayName);if(void 0!==u.Interfaces&&null!==u.Interfaces)for(let e of u.Interfaces)null!=this._TypesInfo[e]&&a.push(this._TypesInfo[e].displayName)}}var c=t?this._currentProfile.SelectedTypes:[],d=[];for(var p of(d=null==c?s:c.map((e=>null!=this._TypesInfo[e]?this._TypesInfo[e].displayName:"")),this.typesLabels)){let e=p.getContent();null!=e&&e.remove()}this.typesLabels=[];let h=[];for(var _ of d){let e=this._getTypeNameFromDisplayName(_);h.push(e);let t=new o({value:_,appearance:"chip",icon:""!==e?this._TypesInfo[e].icon:null}).inject(this.typesLabelsContainer),i=t.getContent().getElement(".wux-controls-label-icon");null!=i&&i.setStyle("color","#77797C"),this.typesLabels.push(t)}for(var f of this.interfacesLabels){let e=f.getContent();null!=e&&e.remove()}for(var S of(this.interfacesLabels=[],a)){let e=this._getTypeNameFromDisplayName(S),t=new o({value:S,appearance:"chip",icon:""!==e?this._TypesInfo[e].icon:null}).inject(this.interfacesLabelsContainer),i=t.getContent().getElement(".wux-controls-label-icon");null!=i&&i.setStyle("color","#77797C"),this.interfacesLabels.push(t)}for(var m of this.typesCustomLabels){let e=m.getContent();null!=e&&e.remove()}for(var C of this.interfacesCustomLabels){let e=C.getContent();null!=e&&e.remove()}if(this.typesCustomLabels=[],this.interfacesCustomLabels=[],t&&Object.keys(this._CustomTypesInfo).length>0){for(const[e,t]of Object.entries(this._CustomTypesInfo))if(h.includes(t.parentType)){let i=new o({value:this._TypesInfo[e].displayName,appearance:"chip",icon:this._TypesInfo[t.parentType].icon}).inject(this.typesCustomLabelsContainer),n=i.getContent().getElement(".wux-controls-label-icon");null!=n&&n.setStyle("color","#77797C"),this.typesCustomLabels.push(i)}this.typesCustomRow.show()}else this.typesCustomRow.hide();if(t&&Object.keys(this._CustomInterfacesInfo).length>0){for(const[e,t]of Object.entries(this._CustomInterfacesInfo))if(h.includes(t.parentType)){let i=new o({value:this._TypesInfo[e].displayName,appearance:"chip",icon:this._TypesInfo[t.parentType].icon}).inject(this.interfacesCustomLabelsContainer),n=i.getContent().getElement(".wux-controls-label-icon");null!=n&&n.setStyle("color","#77797C"),this.interfacesCustomLabels.push(i)}this.interfacesCustomRow.show()}else this.interfacesCustomRow.hide();this._getRolesInfo().then((()=>{let o=t&&void 0!==this._currentProfile.Roles&&null!==this._currentProfile.Roles;var s=o?this._currentProfile.Roles:[],a=[];if(o)for(var l of s)a.push(this._RolesInfo[l].displayName);var u=o?this._currentProfile.SelectedRoles:[];if(null==u?a:u.map((e=>this._RolesInfo[e].displayName)),this._validateProfileBeforeSetting(e),this.matchingRulesModel.removeRoots(),this.additionalStatusesModel.removeRoots(),t&&!0===this._currentProfile.AllowCustomMatchingRules){this.matchingRulesModel.prepareUpdate(),this.rulesRow.show();let e=this._currentProfile.MatchingRules;null!=e&&e.length>0?(this.addMatchingRule(e),this._currentProfile.UseCustomMatchingRules?this.matchingRulesTable.show():this.matchingRulesTable.hide()):this.matchingRulesTable.hide(),this._setMatchingRulesState(i,n,r),this.matchingRulesModel.pushUpdate()}else this.rulesRow.hide(),this.matchingRulesTable.hide();if(t){this.additionalStatusesModel.prepareUpdate(),this.additionalStatusesRow.show(),this.additionalStatusesRow.setStyle("margin-top",!0===this._currentProfile.AllowCustomMatchingRules?"20px":"0px"),this._setAdditionalStatusesState(i,n);let e=this._currentProfile.AdditionalStatuses;null!=e&&e.length>0?(this.addAdditionalStatus(e),this.additionalStatusesTable.show()):i?this.additionalStatusesTable.hide():(this.addAdditionalStatus(this._currentProfile),this.additionalStatusesTable.show()),this.additionalStatusesModel.pushUpdate()}else this.additionalStatusesRow.hide(),this.additionalStatusesTable.hide();g.unmask(this.customizationRoot.parentElement)}))}))},B.prototype._checkChanges=function(e,t,i){let n={status:!0};if("ignore"===e)i(n);else if(void 0!==this._currentProfile&&null!==this._currentProfile)if(this._CCM.isCustomizationProfile(this._currentProfile))if("force"===e||this._hasProfileChanged())if("force"===e)n.action="save",i(n);else{let e=!0===this._currentProfileOrg.NeverBeenSaved,o="duplicate"===t?e?"SAVE_PROFILE_UNSAVED_DUPLICATE":"SAVE_PROFILE_CHANGES_DUPLICATE":e?"SAVE_PROFILE_UNSAVED":"SAVE_PROFILE_CHANGES";f.confirmDialog2({message:I.get(o).replace("{msgData}",this._currentProfile.Name),title:I.get("CompareProfilePageDialogHeader").replace("{msgData}",this._currentProfile.Name),iconpath:"https://vdevpril3265am.dsone.3ds.com/3DSpace/webapps/IterationsWidget/assets/images/warning.png",okButton:{label:I.get("SaveChanges"),callback:function(){n.action="save",i(n)}},koButton:{label:I.get("duplicate"===t?"CancelOperation":"DiscardChanges"),callback:function(){n.action="duplicate"===t?"cancel":"discard",i(n)}},closeX:{callback:function(){n.action="cancel",i(n)}}})}else i(n);else i(n);else i(n)},B.prototype._hasProfileChanged=function(){if(void 0===this._currentProfile||null===this._currentProfile)return!1;if("template"===this._currentProfile.Type||this._currentProfile.Creator!==this._CCM.getUserName())return!1;let e=!0===this._currentProfileOrg.NeverBeenSaved,t=this._currentProfileOrg.UseCustomMatchingRules!==this._currentProfile.UseCustomMatchingRules,i=!1,n=!1;if(!e||!t){i=!0;let e=this._retrieveProfileRulesFromModel("MatchingRulesDataGridViewId");if(void 0===e||null===e&&void 0===this._currentProfile.MatchingRules||null===this._currentProfile.MatchingRules)i=!1;else if(null!=e&&void 0!==this._currentProfile.MatchingRules&&null!==this._currentProfile.MatchingRules)if(i=!1,e.length===this._currentProfile.MatchingRules.length)for(let t=0;t<e.length;++t){let n=e[t],o=this._currentProfile.MatchingRules[t];if(n.color===o.color&&n.description===o.description&&n.name===o.name&&n.attributes.length===o.attributes.length)for(let e=0;e<n.attributes.length;++e){let t=n.attributes[e],r=o.attributes[e];t.name!==r.name&&(i=!0)}else i=!0}else i=!0;n=!0;let t=this._retrieveProfileRulesFromModel("AdditionalStatusesDataGridViewId");if(void 0===t||null===t&&void 0===this._currentProfile.AdditionalStatuses||null===this._currentProfile.AdditionalStatuses)n=!1;else if(null!=t&&void 0!==this._currentProfile.AdditionalStatuses&&null!==this._currentProfile.AdditionalStatuses)if(n=!1,t.length===this._currentProfile.AdditionalStatuses.length)for(let e=0;e<t.length;++e){let i=t[e],o=this._currentProfile.AdditionalStatuses[e];if(i.color===o.color&&i.description===o.description&&i.facet===o.facet&&i.name===o.name&&i.attributes.length===o.attributes.length)for(let e=0;e<i.attributes.length;++e){let t=i.attributes[e],r=o.attributes[e];t.name!==r.name&&(n=!0)}else n=!0}else n=!0}return e||t||i||n},B.prototype._saveToDatabase=function(e){let t=this._CCM.saveCustomizations();return e.name===this._initialProfileIn&&(this._initialProfileInChanged=!0),!1===t?(S.dbgout("CompareCustomization saving custom profiles - failed"),e.silent||(e.delete?f.showAlertBox(I.get("DELETE_PROFILE_FAILED").replace("{msgData}",e.name),null,"warning"):f.showAlertBox(I.get("SAVE_PROFILES_FAILED").replace("{msgData}",e.name),null,"warning"))):(S.dbgout("CompareCustomization saving custom profiles - success"),e.silent||(e.delete?f.showAlertBox(I.get("DELETE_PROFILE_SUCCESS").replace("{msgData}",e.name),null,"success"):f.showAlertBox(I.get("SAVE_PROFILES_SUCCESS").replace("{msgData}",e.name),null,"success"))),t},B.prototype._validateProfileBeforeSetting=function(e){let t=this._CCM.getProfile(e);if(null!=t&&""!==t){if(!(t&&this._CCM.isTemplateProfile(t))){let i=[];for(let e of[t.MatchingRules,t.AdditionalStatuses])if(null!=e&&e.length>0)for(let t of e)for(let e of t.attributes){let t=e.objType,n=this._TypesInfo[t[0]];if(null!=n){-1===n.attributes.findIndex((t=>t.uri===e.name))&&i.push(e.name)}}if(i.length>0){let t=i.toString();S.dbgout("Attribute "+t+"not found in "+e+".  Have these attributes been deleted?"),f.showAlertBox(y.get("CUSTOM_ATTRIBUTE_DELETED").replace("{msgData}",t),null,"warning")}}}},B.prototype._setMatchingRulesState=function(e,t,i){this.useCustomRulesBtn.disabled=e||!t||!i,this.useDefaultRulesBtn.disabled=e||!t||!i;let n=!0===this._currentProfile.UseCustomMatchingRules?this.useCustomRulesBtn:this.useDefaultRulesBtn;for(var o of(n.fireOnlyFromUIInteractionFlag=!0,n.checkFlag=!0,n.fireOnlyFromUIInteractionFlag=!1,e||this.useDefaultRulesBtn.checkFlag?this.matchingRulesAdd.hide():this.matchingRulesAdd.show(),this.matchingRulesAdd.disabled=!t||!i,this.matchingRulesDGV.columns))o.editableFlag=o.dataIndex!==N&&t&&i;this.matchingRulesDGV.showContextualMenuColumnFlag=t&&i},B.prototype._setAdditionalStatusesState=function(e,t){if(e);else for(var i of this.additionalStatusesDGV.columns)i.dataIndex!==F&&(i.editableFlag=t)},B.prototype._setProfileRules=function(){if(this._CCM.isCustomizationProfile(this._currentProfile)){this._currentProfileOrg={UseCustomMatchingRules:this._currentProfile.UseCustomMatchingRules};let t=["MatchingRulesDataGridViewId","AdditionalStatusesDataGridViewId"];for(var e of t){let t=this._retrieveProfileRulesFromModel(e);"MatchingRulesDataGridViewId"===e?this._currentProfile.setMatchingRules(t):this._currentProfile.setAdditionalStatuses(t)}}},B.prototype._retrieveProfileRulesFromModel=function(e){let t=[],i="MatchingRulesDataGridViewId"===e?this.matchingRulesModel.getRoots():this.additionalStatusesModel.getRoots();for(let n of i)if("MatchingRulesDataGridViewId"===e)t.push({name:n.getReferenceValue(w),attributes:this._getMatchingRuleFromMatchingRuleDisplay(n.getReferenceValue(L)),color:n.getReferenceValue(U),description:""});else{let e=n.getReferenceValue(F),i=n.getReferenceValue(M);t.push({facet:n.getReferenceValue(F),name:e,attributes:this._getMatchingRuleFromMatchingRuleDisplay(i),color:n.getReferenceValue(V),description:""})}return t},B.prototype.onProfileSelected=function(){if(this._manipulatingProfileFromUI){let e=this.profilesCombo.currentLabel;S.dbgout("CompareCustomization Profile was selected: "+e),this.setProfileIntoSkeleton(e,!0,"user")||(this._manipulatingProfileFromUI=!1,this.profilesCombo.value=this._currentProfile.Name,this._manipulatingProfileFromUI=!0)}},B.prototype.onDuplicateProfile=function(){let e=this,t=this.profilesCombo.currentLabel;S.dbgout("CompareCustomization Duplicate Profile button was clicked: "+t),e.validateProfileRules(!0,!0)&&e._checkChanges("user","duplicate",(function(i){let n=t;if(i.status&&"save"===i.action)e._setProfileRules(),e._saveToDatabase({silent:!1,name:n});else if(i.status&&"cancel"===i.action)return;let o=e.profilesCombo.elementsTree.getAllDescendants(),r={dialogTitle:I.get("DuplicateProfileTitle"),okLabel:I.get("DuplicateProfileOkayButton"),cancelLabel:I.get("DuplicateProfileCancelButton"),existingNames:o.map((e=>e.options.label))};e._profileNameDlg=new T(r,(t=>{e._CCM.duplicateProfile(n,t);e.profilesCombo.elementsTree.prepareUpdate();let i=new h({label:t,comboBoxSemantics:"leaf"}),o=e._CCM.getIsAdminUser()?"adminprofiles":"userprofiles",r=e.profilesCombo.elementsTree.getChildren().find((e=>e.options.ccId===o));null==r&&(r=k("adminprofiles"===o?"admin":"user"),e.profilesCombo.elementsTree.addRoot(r)),r.addChild(i),e.profilesCombo.elementsTree.expandAll(),e.profilesCombo.elementsTree.pushUpdate(),e._profileNameDlg=null,e.profilesCombo.value=t,e._currentProfileOrg.NeverBeenSaved=!0}))}))},B.prototype.onDeleteProfile=function(){var e=this;let t=this.profilesCombo.currentLabel;S.dbgout("CompareCustomization Delete Profile button was clicked: "+t),f.confirmDialog2({message:I.get("CONFIRM_DELETE_PROFILE").replace("{msgData}",t),title:I.get("CompareProfilePageDialogHeader").replace("{msgData}",t),iconpath:"https://vdevpril3265am.dsone.3ds.com/3DSpace/webapps/IterationsWidget/assets/images/warning.png",okButton:{label:I.get("DELETE_PROFILE_OK"),callback:function(){let i=e._CCM.profileExists(t);e._CCM.removeProfile(t),e.profilesCombo.elementsTree.prepareUpdate();let n=e._CCM.getIsAdminUser()?"adminprofiles":"userprofiles",o=e.profilesCombo.elementsTree.getChildren().find((e=>e.options.ccId===n));if(null!=o){let i=o.getChildren(),n=1===i.length,r=i.find((e=>e.options.label===t));o.removeChild(r),n&&e.profilesCombo.elementsTree.removeRoot(o)}e.profilesCombo.elementsTree.pushUpdate(),i?e._saveToDatabase({silent:!1,delete:!0,name:t}):f.showAlertBox(I.get("DELETE_PROFILE_SUCCESS").replace("{msgData}",t),null,"success"),e._resetCurrentUI()}},koButton:{label:D.ko,callback:function(){}}})},B.prototype._resetCurrentUI=function(){this._manipulatingProfileFromUI=!1;let e="",t=this._getDefaultSelection();void 0!==t.index&&null!==t.index&&(this.profilesCombo.selectedIndex=t.index,e=t.label),this._manipulatingProfileFromUI=!0,this.setProfileIntoSkeleton(e,!1,"ignore")},B.prototype._getDefaultSelection=function(){let e=-1,t="",i=0,n=this.profilesCombo.elementsTree.getChildren();for(var o of n){let n=o.getChildren();Array.isArray(n)&&n.length>0&&(i+=n.length,e=n[0]._rowID,t=n[0].options.label)}return 1===i?{index:e,label:t}:{index:-1,label:""}},B.prototype.onChangeUseDefaultCustomMatchingRules=function(e){var t="1"===e.dsModel.value.toString();let i=!0;t||(i=this.validateProfileRules(!0,!1)),i?(this._currentProfile&&(this._currentProfile.UseCustomMatchingRules=t),t?this.matchingRulesAdd.show():this.matchingRulesAdd.hide(),t?this.matchingRulesTable.show():this.matchingRulesTable.hide(),t&&this._currentProfile&&0===this.matchingRulesModel.getChildren().length&&this.addMatchingRule()):this.useCustomRulesBtn.checkFlag=!0},B.prototype.onAddMatchingRule=function(){let e=this.profilesCombo.currentLabel;S.dbgout("CompareCustomization Add Matching Rule button was clicked: "+e),this.addMatchingRule(),this.useCustomRulesBtn.checkFlag=!0},B.prototype.addMatchingRule=function(e){var t;if(Array.isArray(e))for(var i of(t=[],e)){let e=new h({grid:{MR_Order:-1,MR_StatusName:i.name,MR_Attribute:this._getMatchingRuleDisplayFromMatchingRule(i.attributes,x),MR_Color:i.color}});t.push(e)}else t=new h({grid:{MR_Order:-1,MR_StatusName:e&&e.name?e.name:"",MR_Attribute:e&&e.attributes?this._getMatchingRuleDisplayFromMatchingRule(e.attributes,x):[],MR_Color:e&&e.color?e.color:this._getNextColor("matching_rule")}});let n=j(t,this.matchingRulesModel,!0);G(n,this.matchingRulesTable),1===n&&!0===this._currentProfile.UseCustomMatchingRules&&this.matchingRulesTable.show()},B.prototype.addMatchingRuleBefore=function(e){let t=function(e,t,i,n){return i.prepareUpdate(),i.insertBefore(e,t),!0===n&&W(i),i.pushUpdate(),i.getChildren().length}(new h({grid:{MR_Order:-1,MR_StatusName:"",MR_Attribute:[],MR_Color:this._getNextColor("matching_rule")}}),e,this.matchingRulesModel,!0);G(t,this.matchingRulesTable)},B.prototype.moveMatchingRuleUp=function(e){!function(e,t,i){t.prepareUpdate();let n=e.getPreviousBrother();if(null!=n){let i=t.removeRoot(e);t.insertBefore(i,n)}!0===i&&W(t),t.pushUpdate()}(e,this.matchingRulesModel,!0)},B.prototype.moveMatchingRuleDown=function(e){!function(e,t,i){t.prepareUpdate();let n=e.getNextBrother();if(null!=n){let i=t.removeRoot(e),o=n.getNextBrother();null!=o?t.insertBefore(i,o):t.addRoot(i)}!0===i&&W(t),t.pushUpdate()}(e,this.matchingRulesModel,!0)},B.prototype.removeMatchingRule=function(e){let t=function(e,t,i){return t.prepareUpdate(),t.removeRoot(e),!0===i&&W(t),t.pushUpdate(),t.getChildren().length}(e,this.matchingRulesModel,!0);G(t,this.matchingRulesTable),0===t&&(this.useDefaultRulesBtn.checkFlag=!0)},B.prototype.removeEmptyMatchingRules=function(){if(this._CCM.isCustomizationProfile(this._currentProfile)){let t=this.matchingRulesModel.getRoots();for(var e=t.length-1;e>=0;--e){let i=t[e],n=i.getReferenceValue(w),o=this._getMatchingRuleFromMatchingRuleDisplay(i.getReferenceValue(L));""!==n||null!=o&&0!==o.length||this.removeMatchingRule(i)}}},B.prototype._getPossibleAttributesDisplay=function(e,t,i){let n=[],o=e.SelectedTypes.map((e=>({name:e,grouping:-1}))),r=[];void 0!==e.Interfaces&&null!==e.Interfaces&&(r=e.Interfaces.map((e=>({name:e,grouping:-1}))));let s=o.concat(r);for(var a of s)for(var l=0;l<e.Facets.length;++l){let t=e.Facets[l];for(let e=0;e<t.ObjectTypes.length;++e)a.name===t.ObjectTypes[e]&&(a.grouping=l);if(void 0!==t.Interfaces&&null!==t.Interfaces)for(let e=0;e<t.Interfaces.length;++e)a.name===t.Interfaces[e]&&(a.grouping=l)}var u=[];for(var a of s){for(const[e,t]of Object.entries(this._CustomTypesInfo))t.parentType===a.name&&u.push({name:e,grouping:a.grouping});for(const[e,t]of Object.entries(this._CustomInterfacesInfo))t.parentType===a.name&&u.push({name:e,grouping:a.grouping})}let c=s.concat(u);for(var d=[],p=0,h=0;h<e.Facets.length;++h){let i=this._CCM.getFacetNameNLS(e.NLSPath,e.Facets[h].Name);if(null==t||t===i){d[p]={Name:i,ObjectTypes:[]};for(var _=0;_<c.length;++_)c[_].grouping===h&&d[p].ObjectTypes.push(c[_].name);++p}}for(var g of d){let e=[];for(var f of g.ObjectTypes)if(null!=this._TypesInfo[f].attributes){var S=this._TypesInfo[f].displayName,m=this._TypesInfo[f].icon;for(var C of this._TypesInfo[f].attributes){let t=e.findIndex((e=>e.value.attrName===C.uri));if(-1!==t){let n=e[t].value.objType.findIndex((e=>e===f));if(-1===n&&(e[t].value.objType.push(f),i)){let i=e[t].value.label.replace(")",","+S+")");e[t].value.label=i}}else{let t={value:{icon:m,attrName:C.uri,objType:[f]}};t.value.label=C.nlsName,i&&(t.value.label+=" ("+S+")"),t.value.facet=g.Name,e.push(t)}}}for(var a of e)n.push(a)}return n},B.prototype._getMatchingRuleDisplayFromMatchingRule=function(e,t,i){let n=[];for(let t of e){let e=t.objType,o=this._TypesInfo[e[0]],r=t.name;if(void 0===o)o=this._CustomTypesInfo[e[0]],null!=o&&(r=o.attributes[t.name].Name);else{let e=o.attributes.findIndex((e=>e.uri===t.name));r=-1===e?t.name:o.attributes[e].nlsName}let s=o.icon;void 0===s&&null!=o.parentType&&(s=this._TypesInfo[o.parentType].icon);let a=t.objType.map((e=>o.displayName)).join(","),l={icon:s,attrName:t.name,objType:t.objType};l.label=r,i&&(l.label+=" ("+a+")"),n.push(l)}return n},B.prototype._getMatchingRuleFromMatchingRuleDisplay=function(e){return e.map((e=>({objType:e.objType,name:e.attrName,icon:e.icon})))},B.prototype._getTypeNameFromDisplayName=function(e){let t="";for(const[i,n]of Object.entries(this._TypesInfo))if(n.displayName===e){t=i;break}return t},B.prototype.addAdditionalStatus=function(e){var t;if(Array.isArray(e))for(var i of(t=[],e)){let e=i.facet,n=new h({grid:{AS_Facet:e,AS_Attribute:this._getMatchingRuleDisplayFromMatchingRule(i.attributes,x),AS_Color:i.color}});t.push(n)}else if("object"==typeof e){t=[];let i=[];for(var n=0;n<e.Facets.length;++n){let o=this._getNextColor("additional_status",i);i.push(o);let r=this._CCM.getFacetNameNLS(this._currentProfile.NLSPath,e.Facets[n].Name),s=new h({grid:{AS_Facet:r,AS_Attribute:[],AS_Color:o}});t.push(s)}}else{let i="";e&&e.facet&&(i=e.facet),t=new h({grid:{AS_Facet:i,AS_Attribute:e&&e.attributes?this._getMatchingRuleDisplayFromMatchingRule(e.attributes,x):[],AS_Color:e&&e.color?e.color:this._getNextColor("additional_status")}})}let o=j(t,this.additionalStatusesModel);G(o,this.additionalStatusesTable),1===o&&this.additionalStatusesTable.show()},B.prototype._getNextColor=function(e,t){t=t||[];let i=this.matchingRulesModel.getRoots().map((e=>e.getReferenceValue(U))),n=this.additionalStatusesModel.getRoots().map((e=>e.getReferenceValue(V))),o=[C.colorDef.BLUE1,C.colorDef.ORANGE,C.colorDef.BEIGE,C.colorDef.BLUE2],r="additional_status"===e?[C.colorDef.VIOLET,C.colorDef.GREEN2,C.colorDef.RED,C.colorDef.PINK,C.colorDef.YELLOW]:[],s=t.concat(i,n,o,r);return C.colorSeq.find((e=>!s.includes(e)))||C.colorDef.BLACK},B.prototype._getObjTypesInfo=function(e){var t=this;return new Promise((function(i,n){if(t._currentProfile){var o=e?t._currentProfile:t._CCM.getProfile(t._currentProfile.fromTemplateProfile);t._CCM.loadModelerTemplateInfo(o,!0).then((function(){t._CustomTypesInfo=o._CustomTypesInfo||{},t._CustomInterfacesInfo=o._CustomInterfacesInfo||{},t._TypesInfo=o._TypesInfo,i()}))}else i()}))},B.prototype._getRolesInfo=function(){var e=this;return new Promise((function(t,i){var n=[];if(void 0!==e._currentProfile&&null!==e._currentProfile&&void 0!==e._currentProfile.Roles&&null!==e._currentProfile.Roles&&(n=e._currentProfile.Roles),0===n.length)e._RolesInfo={},t();else{for(var o of n)e._RolesInfo[o]={displayName:o.toLowerCase()};t()}}))},B.prototype.onSaveCustomization=function(){var e=this;S.dbgout("CompareCustomization Save button was clicked"),this.validateProfileRules(!0,!0)&&e._checkChanges("force","",(function(t){t.status&&"save"===t.action&&(e._setProfileRules(),e._saveToDatabase({silent:!1,name:e._currentProfile.Name})),e._doClose({status:!0})}))},B.prototype.onCancelCustomization=function(){S.dbgout("CompareCustomization Cancel button was clicked"),void 0!==this._currentProfileOrg&&null!==this._currentProfileOrg&&!0===this._currentProfileOrg.NeverBeenSaved&&this._CCM.removeProfile(this._currentProfile.Name),this._doClose({status:!0})},B.prototype._doClose=function(e){this._resetCurrentUI(),this._CustomTypesInfo={},this._CustomInterfacesInfo={},this._RolesInfo={},""!==!this._initialProfileIn&&(e.inProfileChanged=this._initialProfileInChanged),this.doneCB(e)},B.prototype.reset=function(){this._resetCurrentUI(),this.initModel()},B})),define("DS/CompareWidget2/plugins/STRUCTURE/expanders/cvProgressiveExpand",["UWA/Core","DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/support/DataCenter"],(function(e,t,i){var n={format:"entity_relation_occurrence",hits:{predefined_computation:["boundingbox","cgr","thumbnail_3d","icons"]},select_object:["physicalid","ds6w:type","ds6w:globaltype","ds6wg:revision","ds6w:label","ds6wg:XCADOrientationExt.V_WorldOrientation"],select_relation:["physicalid","ds6w:type","ro.plminstance.v_treeorder","ro.plminstance.plm_externalid"]},o={format:n.format,hits:n.hits,select_object:[...n.select_object,"relcount","bo.plmentity.plm_externalid","ds6w:reserved","ds6w:description","ds6w:modified","ds6w:created","ds6w:responsible","ds6w:policy","ds6w:organizationResponsible","ds6w:project","ds6w:reservedBy","ds6w:identifier","bo.plmreference.v_derivedfrom"],select_relation:[...n.select_relation,"Matrixtxt"]};function r(e,i,r,s){var a=null!=s&&0!=s.length,l=a?n:o,u={batch:{expands:[{label:"TBD_LABEL",root:{physical_id:e},filter:{all:1},aggregation_processors:[]}]},outputs:t.dupeJson(l)};return a&&(u=function(e,t){return Object.keys(t).forEach((function(i){var n=t[i],o=n.indexOf(".");if(-1==o)e.select_bo.push(n);else{var r=n.substr(0,o),s=n.substr(o+1);if("REF"==r)"dfr"==s&&(s="bo.plmreference.v_derivedfrom"),-1==e.outputs.select_object.indexOf(s)&&e.outputs.select_object.push(s);else{if("INST"!=r)throw new Error("UNKNOWN specifier in PROPS definition");"matrixtxt"==s&&(s="Matrixtxt"),-1==e.outputs.select_relation.indexOf(s)&&e.outputs.select_relation.push(s)}}})),e}(u,s)),u}function s(t,n,o,s,a){return new Promise((function(o,l){var u="/cvservlet/progressiveexpand/v2";s.dbgout("------------[ T R E E   E X P A N S I O N    B E G I N ] -----------"),s.dbgout("cvExpand on id: "+t.getPhysID()+"\n on service   : "+t.getServiceName()+"\n with expand type: cvProgressiveExpand\n with URL     : "+u);(function(t,i,n,o){return new Promise((function(i,n){var s=r(t.getPhysID(),0,0,o.CV_PROPS),a=t.getExternalFilterSpec();null!=a&&(s=function(e,t){return null!=t.CVQueryV2.filter?e.batch.expands[0].filter=t.CVQueryV2.filter:e.batch=t.CVQueryV2.batch,e}(s,a)),null!=o.PROGRESSIVE_EXPAND_OPTIONS&&e.extend(s.batch.expands[0],o.PROGRESSIVE_EXPAND_OPTIONS),null!=o.PROGRESSIVE_EXPAND_OUTPUTS&&e.extend(s.outputs,o.PROGRESSIVE_EXPAND_OUTPUTS),i(s)}))})(t,0,0,a).then((function(e){var r=e;i.makeAuthHttpsCall(u,"POST",r,"text/plain",t.getTenant(),t.getServiceName(),t.getSecurityContext(),!1,!1,"output_format=cvjson").then((function(e){var t=e;"string"==typeof t&&(t=t.replace("{}",""),t=JSON.parse(t)),null!=t.errors&&0!=t.errors.length?l(t.errors):((t=t.results)._dataSource=n,s.dbgout("------------[ T R E E   E X P A N S I O N    E N D    ] -----------"),o(t))}),(function(e){l(e)}))}),(function(e){l(e)}))}))}return{jsClass:"CV_PROGRESSIVE_EXPAND",doExpand:function(e,t,i,n,o){return s(e,t,0,n,o)}}})),define("DS/CompareWidget2/plugins/STRUCTURE/expanders/lifecycleServicesExpand",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/support/DataCenter","DS/LifecycleServices/LifecycleServicesSettings","UWA/Json"],(function(e,t,i,n){return{jsName:"LIFECYCLE_SVC_EXPAND",doExpand:function(e,n,o,r,s){return me=this,new Promise((function(o,a){(function(e,i,n,o){var r=this;return new Promise((function(n,s){var a=null,l=null,u=null,c=[],d=[],p="",h="";null!=o.CV_PROPS&&Object.keys(o.CV_PROPS).forEach((function(e){var t=o.CV_PROPS[e];"REF.dfr"==t&&(t="REF.bo.plmreference.v_derivedfrom"),-1==t.indexOf(".")&&c.push(t),t.startsWith("REF.")?c.push(t.substring(4)):t.startsWith("INST.")&&d.push(t.substring(5))}));var _=e.getExternalFilterSpec();null!=_&&null!=_.CVQuery&&((p={}).CVQuery=_.CVQuery),null!=_&&null!=_.CVQueryV2&&(null!=_.CVQueryV2.filter?(h={}).filter=_.CVQueryV2.filter:(h={}).filter=_.CVQueryV2.batch.expands[0].filter,h.aggregation_processors=[]),c.includes("bo.plmentity.v_usage")&&c.splice(c.indexOf("bo.plmentity.v_usage"),1,"bo.PLMEntity.V_usage"),d.includes("ro.plminstance.V_treeorder")||d.push("ro.plminstance.V_treeorder"),c.includes("bo.PLMConnection.V_CnxTreeOrder")||c.push("bo.PLMConnection.V_CnxTreeOrder"),c.includes("bo.PLMPort.V_PortTreeOrder")||c.push("bo.PLMPort.V_PortTreeOrder"),d.includes("ro.plminstance.plm_externalid")||d.push("ro.plminstance.plm_externalid");var g=o.COMMAND_CONTEXT?o.COMMAND_CONTEXT:"compare";if("LC_IDX_SERVICE"==i||"LC_AUTH_SERVICE"==i){a="/resources/lifecycle/expand/federated";var f="LC_AUTH_SERVICE"==i;l="POST",u={ids:[e.getPhysID()],authoring:f,command:g,enableProto:!0,select_bo:c,select_rel:d,filter:p,filterV2:h}}else{var S="UNEXPECTED data source: "+i;r.plugSvcs.errout(S),s(S)}var m=e.getTenant(),C=e.getSecurityContext(),T=e.getServiceName();t.makeAuthHttpsCall(a,l,u,"json",m,T,C,!0).then((function(e){n(e)}),(function(e){s(e)}))}))})(e,n,0,s).then((function(e){var t=e.errorCode;if(t){var s=e.errorMessage;return r.errout("Lifecycle federated expand via "+n+" failed; errorCode:"+t+" errorMessage:"+s),void a(e)}if(!me._responseValidityCheck(e))return r.errout("Lifecycle federated expand via "+n+" failed; response deemed invalid."),void a(e);var l=e.results;l.forEach((function(e){if(e.attributes){e.attributes=e.attributes.filter((e=>""!==e.value));let t=e.attributes.find((e=>"ds6w:label"===e.name));e.attributes.forEach((function(i){"bo.PLMEntity.V_usage"===i.name?i.name="bo.plmentity.v_usage":"bo.PLMConnection.V_CnxTreeOrder"===i.name||"bo.PLMPort.V_PortTreeOrder"===i.name?e.attributes.push({name:"TreeOrder",value:i.value}):"bo.LPAbstractPort.V_FunctionalName"!==i.name||t||e.attributes.push({name:"Title",value:i.value})}))}})),l.forEach((function(e){if(e.icon__default_thumbnail_2d){var t=i.getTenant(),n=i.get3DSpaceBaseUrl(t);e.icon__default_thumbnail_2d.forEach((function(e){e.icon&&e.icon.startsWith("/")&&(e.icon=n+e.icon)}))}})),l._dataSource=n,o(l)}),(function(e){r.errout(e),a(e)}))}))},_responseValidityCheck:function(e){if(!e.results)return!1;var t=e.results;if(!Array.isArray(t))return!1;if(!t.find((e=>e.attributes&&e.attributes.length>0)))return!1;var i=t.find((e=>e.path&&e.path.length>0));if(!i)return!1;var n=i.path[0];return!!t.find((e=>e.attributes&&Array.isArray(e.attributes)&&e.attributes.find((e=>"did"===e.name&&e.value==n))))}}})),define("DS/CompareWidget2/plugins/STRUCTURE/expanders/cvProgressiveExpandWithBSD",["UWA/Core","DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/support/DataCenter"],(function(e,t,i){function n(i,n,o,r,s){return new Promise((function(n,o){var a=function(e,i,n,o,r){let s={facet_name:"ds6w",include_predicates:[`ds6w:${r}`],select_object:["physicalid","ds6w:globalType","ds6w:type","ds6w:identifier","ds6w:label","ds6wg:revision","ds6w:description","ds6w:responsible","ds6w:reserved","ds6w:cadMaster","ds6w:isLastRevision","ds6w:status","ds6wg:EnterpriseExtension.V_PartNumber","owner",`ds6w:${r}`,"ds6w:reservedBy","ds6w:i3dx","logicalid","versionid"],select_relation:["physicalid","ds6w:globalType","ds6w:type","ds6w:identifier","ds6w:label","matrixtxt",`ds6w:${r}`,"ro.plminstance.V_treeorder","logicalid"],hits:{predefined_computation:["urlstream|thumbnail|2dthb|allrefs","icons"]},format:"entity_relation_occurrence"};return{batch:{expands:[{label:"TBD_LABEL",root:{physical_id:e},filter:{and:{filters:[{sequence_filter:{sequence:[{uql:`physicalid:${e}`},{statement:"NEXT"},{uql:`(mxobjecttype:(RELATIONSHIP)) AND ((listofcfgfields:"ds6w:${r}") OR (NOT listofcfgfields:"ds6w:${r}"))`}]}}]}},aggregation_processors:[{synthesis:{mode:"tree_leaf_instance",name:"BSDGroupOnInstance_Rateau_0"}}],graph:{descending_condition_object:{uql:'[ds6w:globalType]:"ds6w:Document" OR [ds6w:globalType]:"ds6w:Part"'},descending_condition_relation:{uql:'(NOT((flattenedtaxonomies:"reltypes/XCADBaseDependency") OR (flattenedtaxonomies:"reltypes/Reference Document")))'}}}]},outputs:t.dupeJson(s)}}(i.getPhysID(),0,0,r.CV_PROPS,s),l=i.getExternalFilterSpec();null!=l&&a.batch.expands[0].filter.and.filters.push(l.CVQueryV2.filter),null!=r.PROGRESSIVE_EXPAND_OPTIONS&&e.extend(a.batch.expands[0],r.PROGRESSIVE_EXPAND_OPTIONS),n(a)}))}function o(e,t,o,r,s){return new Promise((function(o,a){var l="/cvservlet/progressiveexpand/v2";r.dbgout("------------[ T R E E   E X P A N S I O N    B E G I N ] -----------"),r.dbgout("cvExpand on id: "+e.getPhysID()+"\n on service   : "+e.getServiceName()+"\n with expand type: cvProgressiveExpand\n with URL     : "+l);(function(e){return new Promise((function(t,i){e?t({batch:{expands:[{label:"BSDAPI_getBrowsingStructureTree",root:{physical_id:e},parameters:{graph_advise:1},graph:{descending_condition_relation:{uql:"(taxonomies:Sub Term)"}},filter:{all:1}}]},outputs:{select_object:["ds6w:label","ds6w:type","physicalid","ds6w:created","ds6w:modified","predicatename","versionid","logicalid"],select_relation:["physicalid","logicalid"],hits:{predefined_computation:["urlstream|thumbnail|2dthb|allrefs","icons"]},format:"entity_relation_occurrence"}}):i("Please provide BSDId....")}))})(e.getBSDId()).then((function(u){let c=u;i.makeAuthHttpsCall(l,"POST",c,"text/plain",e.getTenant(),e.getServiceName(),e.getSecurityContext(),!1,!1,"output_format=cvjson").then((function(u){let c=u;if("string"==typeof c&&(c=c.replace("{}",""),c=JSON.parse(c)),null!=c.errors&&0!=c.errors.length)a(c.errors);else{let u=c.results[0].predicatename;n(e,0,0,s,u).then((function(n){var s=n;i.makeAuthHttpsCall(l,"POST",s,"text/plain",e.getTenant(),e.getServiceName(),e.getSecurityContext(),!1,!1,"output_format=cvjson").then((function(e){var i=e;"string"==typeof i&&(i=i.replace("{}",""),i=JSON.parse(i)),null!=i.errors&&0!=i.errors.length?a(i.errors):((i=i.results)._dataSource=t,r.dbgout("------------[ T R E E   E X P A N S I O N    E N D    ] -----------"),o({expandedData:i,bsdStruct:c}))}),(function(e){a(e)}))}),(function(e){a(e)}))}}),(function(e){a(e)}))}),(function(e){a(e)}))}))}return{jsClass:"CV_PROGRESSIVE_EXPAND_BSD",doExpand:function(e,t,i,n,r){return o(e,t,0,n,r)}}})),define("DS/CompareWidget2/plugins/STRUCTURE/expanders/cvExpand",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/support/DataCenter","i18n!DS/CompareWidget2/assets/nls/DisplayMessages"],(function(e,t,i){var n={select_bo:["physicalid","ds6w:type","ds6w:globaltype","ds6wg:revision","ds6w:label","ds6wg:XCADOrientationExt.V_WorldOrientation"],compute_select_bo:["cgr","thumbnail_3d","icon"],select_rel:["physicalid","ds6w:type","ro.plminstance.v_treeorder","ro.plminstance.plm_externalid"]},o={...n,select_bo:["relcount","bo.plmentity.plm_externalid","ds6w:reserved","ds6w:description","ds6w:modified","ds6w:created","ds6w:responsible","ds6w:policy","ds6w:organizationResponsible","ds6w:project","ds6w:reservedBy","ds6w:identifier","bo.plmreference.v_derivedfrom"],select_rel:["matrixtxt"]};function r(t,i,r){var s=null!=r&&0!=r.length,u=s?n:o,c=e.dupeJson(u);return i&&(c=a(c)),s&&(c=l(c,r)),c.label="ComparefilterQuery-"+e.nowMS(),null!=t.CVQuery3D?c.union=t.CVQuery3D.union:null!=t.CVQuery?c.union=t.CVQuery.union:c=null,c}function s(t,i,r,s){var u=null!=s&&0!=s.length,c=u?n:o,d=e.dupeJson(c);return d.no_type_filter_bo=["PLMPort","PLMConnection"],r&&(d=a(d)),u&&(d=l(d,s)),d.root_physicalid=t,d.expand_iter=i||"-1",d.label=widget._isODTMode()?"":"Compare2-"+e.nowMS(),d}function a(e){return e.fcs_url_mode="REDIRECT",e.boundingbox=!0,e.with_synthesis=!0,e}function l(e,t){return Object.keys(t).forEach((function(i){var n=t[i],o=n.indexOf(".");if(-1==o)e.select_bo.push(n);else{var r=n.substr(0,o),s=n.substr(o+1);"REF"==r?("dfr"==s&&(s="bo.plmreference.v_derivedfrom"),-1==e.select_bo.indexOf(s)&&e.select_bo.push(s)):"INST"==r?-1==e.select_rel.indexOf(s)&&e.select_rel.push(s):KOfn("UNKNOWN specifier in PROPS definition")}})),e}function u(e,i,n,o,a){return new Promise((function(l,u){o.dbgout("------------[ T R E E   E X P A N S I O N    B E G I N ] -----------"),function(e,i){return new Promise((function(n,o){var r={};if("DELLmiGeneralSystemReference"==e.getObjType())r.name="EXPAND",r.url="/cvservlet/expand",n(r);else if(null!=e.getExternalFilterSpec())i.forEach((function(e){"Filter"!=e.name||(r=e)})),null==r?o("URL for filter missing from viewDef/options"):n(r);else{var s=e.getPhysID(),a=e.getTenant(),l=e.getServiceName(),u=e.getSecurityContext(),c={queryPhysID:s,catSpec:i};t.makeAuthHttpsCall("/resources/compare2/IDCat/","POST",c,"json",a,l,u).then((function(e){n(e)}),(function(e){o("Failure determining expand type")}))}}))}(e,a.CVURL_BY_TYPE).then((function(c){var d=c,p=d.url,h=d.name;o.dbgout("cvExpand on id: "+e.getPhysID()+" on service   : "+e.getServiceName()+" with expand type: "+h+" with URL     : "+p);var _=!1;"3D"!=h&&"Filter"!=h||(_=!0),function(e,i,n,o){let a=o.CV_PROPS;return new Promise((function(l,u){if("ENOStrRefinementSpecification"==e.getObjType())t.fetchFilterDefinition(e).then((function(e){var t=r(JSON.parse(e.filterCVQuery),n,a);l(t)}),(function(e){u(e)}));else{var c=e.getExternalFilterSpec(),d=null;null!=c?"DELLmiGeneralSystemReference"==e.getObjType()?(d=s(e.getPhysID(),i,n,a)).config_filter=c.CVQuery.union.expand[0].config_filter:d=r(c,n,a):d=s(e.getPhysID(),i,n,a),o.EXPAND_V1_OPTIONS&&o.EXPAND_V1_OPTIONS.no_type_filter_bo&&(d.no_type_filter_bo=o.EXPAND_V1_OPTIONS.no_type_filter_bo),l(d)}}))}(e,n,_,a).then((function(n){var r=n;t.makeAuthHttpsCall(p,"POST",r,"json",e.getTenant(),e.getServiceName(),e.getSecurityContext()).then((function(e){if(null!=e.error){let i=!1;for(var t of(o.dbgout("expand success, but with errors: "+e.error.errorMessage),e.error.errors))"CLOUDVIEW_ERROR__UNKNOWN_META"===t.errorCode?o.dbgout("   "+t.errorContextualMessage):i=!0;(i||void 0===e.results||null===e.results||0===e.results.length)&&u(e.error)}var n=e.results;n._dataSource=i,o.dbgout("------------[ T R E E   E X P A N S I O N    E N D    ] -----------"),l(n)}),(function(e){u(e)}))}),(function(e){u(e)}))}),(function(e){u(e)}))}))}return{jsClass:"CVEXPAND",doExpand:function(e,t,i,n,o){return u(e,t,i,n,o)}}})),define("DS/CompareWidget2/plugins/STRUCTURE/expanders/lifecycleServicesNavigate",["DS/CompareWidget2/support/DataCenter"],(function(e){return{jsName:"LIFECYCLE_SVC_NAVIGATE",doNavigate:function(t,i,n,o,r,s,a){return me=this,new Promise((function(l,u){(function(t,i,n,o,r,s,a){return new Promise((function(l,u){var c=null,d=null,p=null,h=[];t.forEach((function(e){var t={physicalid:e};h.push(t)}));var _=a.COMMAND_CONTEXT?a.COMMAND_CONTEXT:"compare";if("LC_IDX_SERVICE"==i||"LC_AUTH_SERVICE"==i)c="/resources/lifecycle/navigate/federated",d="POST",p={data:h,authoring:"LC_AUTH_SERVICE"==i,command:_,select_bo:[]};else{var g="UNEXPECTED data source: "+i;s.errout(g),u(g)}var f=s.nowMS();e.makeAuthHttpsCall(c,d,p,"json",n,r,o,!0).then((function(e){s.reportTime(f,"Lifecycle federated navigate request OK."),l(e)}),(function(e){s.reportTime(f,"Lifecycle federated navigate request KO."),u(e)}))}))})(t,i,n,o,r,s,a).then((function(e){var t=e.errorCode;if(t){var n=e.errorMessage;return s.errout("Lifecycle federated navigate via "+i+" failed; errorCode:"+t+" errorMessage:"+n),void u(e)}var o=e.results;o._dataSource=i,l(o)}),(function(e){s.errout(e),u(e)}))}))}}})),define("DS/CompareWidget2/plugins/STRUCTURE/expanders/compareServiceExpand",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/support/DataCenter","UWA/Json"],(function(e,t,i){function n(e,i,n,o){return new Promise((function(r,s){var a=null,l=null,u=null,c="";null!=o.DB_PROPS&&Object.keys(o.DB_PROPS).forEach((function(e){var t=o.DB_PROPS[e];"REF.dfr"==t&&(t="REF.attribute[PLMReference.V_DerivedFrom]"),c+=t+","}));var d=encodeURIComponent(c),p=void 0!==o.USE_MCS&&null!==o.USE_MCS&&!1===o.USE_MCS?"":"USE_MCS";if("CV_SERVICE"==i){a="/resources/compare/index/postFetchModelsFromIndex",l="POST";let t=[];if(Array.isArray(e))for(let i of e)t.push({type:"IDSPEC",spec:i.getPhysID()});else t.push({type:"IDSPEC",spec:e.getPhysID()});u={objSpecList:t,depth:n,compareOption:p,PROPS:d}}else if("DB_SERVICE"==i){if(a="/resources/compare/fetchModels",l="GET",Array.isArray(e))for(let t=0;t<e.length;++t)0===t&&(u="objectIds="),u+=e[t].getPhysID(),t<e.length-1&&(u+=",");else u="objectIds="+e.getPhysID();u+="&compareOption="+p,u+="&PROPS="+d}else{var h=plugSvcs.errout("UNEXPECTED data source: "+i);s(h)}var _=Array.isArray(e)?e[0].getTenant():e.getTenant(),g=Array.isArray(e)?e[0].getSecurityContext():e.getSecurityContext(),f=Array.isArray(e)?e[0].getServiceName():e.getServiceName();t.makeAuthHttpsCall(a,l,u,"json",_,f,g,!0).then((function(e){r(e)}),(function(e){s(e)}))}))}return{jsName:"COMPARE_SVC_EXPAND",doExpand:function(e,t,i,o,r){return new Promise((function(s,a){n(e,t,i,r).then((function(e){var i=e[0];if(null!=i.Failed_idlist){var n=i.Failed_idlist[0].error;o.errout("Error retrieving data:: "+n),a(n)}else i._dataSource=t,s(i)}),(function(e){o.errout(e),a(e)}))}))},doExpandN:function(e,t,i,o,r){return new Promise((function(s,a){n(e,t,i,r).then((function(i){if(Array.isArray(e)){for(let e of i)e._dataSource=t;s(i)}else{var n=i[0];n._dataSource=t,s(n)}}),(function(e){o.errout(e),a(e)}))}))}}})),define("DS/CompareWidget2/plugins/plugin",["UWA/Class","DS/CompareWidget2/userSettings/UserSettingsManager"],(function(e,t){return e.extend({setOutputFn:function(e){this._outputFn=e},updateOutput:function(e){null==this._outputFn?this._plugSvcs.warnout("PLUGIN trying to set new output, but no output fn set"):this._outputFn(e)},reportOK:function(e){this.dbgout("------------------------------------------------------------"),0!=this._startMS&&this._plugSvcs.reportTime(this._startMS," Plugin '"+this._plugPath+"' execution "),this.dbgout("~~~~~~ Plugin '"+this._plugPath+"' reports success <<<"),this.dbgout("------------------------------------------------------------"),this.updateOutput(e)},reportKO:function(e){this._plugSvcs.errout("~~~~~~ Plugin '"+this._plugPath+"' reports failure:: "+e)},subscribeEvent:function(e,t){if(null==this._subscribeTokens[e]){var i=this._plugSvcs.subscribe(e,t);this._subscribeTokens[e]=i}},unsubscribeEvent:function(e){var t=this._subscribeTokens[e];null!=t&&(this._plugSvcs.unsubscribe(t),delete this._subscribeTokens[e])},unsubscribeAllEvents:function(){var e=this,t=!0;try{Object.keys(e._subscribeTokens).forEach((function(t){var i=e._subscribeTokens[t];e._plugSvcs.unsubscribe(i)}))}catch(i){this._plugSvcs.warnout("problem unsubscribing events in plugin "+e.getName()),t=!1}return e._subscribeTokens={},t},postEvent:function(e,t){this._plugSvcs.postEvent(e,t)},isEnabled:function(){return this._enabled},enable:function(e){return this._pluginOptions=e||{},this._enabled=!0,this.onEnabled()},disable:function(){this._enabled=!1,this.onDisabled()},disconnect:function(){this.onDisconnect(),this.unsubscribeAllEvents(),this.unsyncAllSettings(),this._outputFn=null,this.disable()},destroy:function(){this.onDestroy(),this.disconnect(),this._plugPath=null,this._plugSvcs=null,this._type=null,this._parent()},onLoad:function(){return!0},onEnabled:function(){return!0},onDisabled:function(){},onDisconnect:function(){},onDestroy:function(){},execute:function(e,t){null!=t&&Object.assign(this._pluginOptions,t,this._pluginOptions),this.dbgout("~~~~~~ "+this.getPath()+".execute() running... "),this._startMS=this._plugSvcs.nowMS()},enableDebugLabel:function(e){this.dbgout=this._plugSvcs.dbgout,null!=e&&this._plugSvcs.enableDebugLabel(e)},dbgout:function(e){},init:function(e,t,i,n){this._parent(),this._pluginOptions=i||{},this._plugPath=e,this._name=t,this._plugSvcs=n,this._outputFn=null,this._type="PLUGIN",this._subscribeTokens={},this._syncTokens={},this._enabled=!1,this._startMS=0},getPath:function(){return this._plugPath},getName:function(){return this._name},getType:function(){return this._type},syncSetting:function(e,i,n,o,r,s){i=i||e;var a=r||i;t.hasPref(e)?null==this._syncTokens[a]&&(this._syncTokens[a]={settingKey:e,callback:n,object:o,objectKey:i},t.sync(o||this,e,i,n)):s&&t.loadSettingsPromise([e]).then((()=>{t.savePrefsTimestampAndEnableUpdate(),t.sync(o||this,e,i,n)}))},unsyncAllSettings:function(){for([key,value]of Object.entries(this._syncTokens))t.unsync(value.object||this,value.settingKey,value.objectKey,value.callback);this._syncTokens={}}})})),define("DS/CompareWidget2/plugins/VIEW3D/VIEW3D_PREP_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/VIEW3D/view3DJSONEngine_LDV"],(function(e,t){return e.extend({onEnabled:function(){var e=this;return e.syncSetting("inlcudePGPHideShowSettings.includePGPHideShow","_includePGPHideShow",null,null),e.syncSetting("viewSettings.PAD3D_VIEW.view3D.isolate","_viewerDisplayModeIsolate",null,null),e.syncSetting("compareSettings.dataSource.useIndex","_useIndex",null,null),e._parent()},execute:function(e,i){var n=this;n._parent(e,i);var o=e,r=t.refInstTree2ViewerJSON(o,n._plugSvcs);null!=r?n.reportOK(r):n.reportKO()}})})),define("DS/CompareWidget2/plugins/STRUCTURE/flexibleView/STRUCT_ADD_STATUS_plugin",["DS/CompareWidget2/plugins/plugin"],(function(e){return e.extend({init:function(e,t,i,n){this._parent(e,t,i,n)},applyAdditionalStatusFlags:function(e,t,i){return new Promise((function(i,n){if(null!=t){null!=t.ADD_STATUSES&&e.forEach((function(e){e.visitVisible_treeAndFN(0,(function(e){var i=e.getMatchInfo();let n=!1;return null!=i&&(t.ADD_STATUSES.forEach((function(e){e.PROPS.forEach((function(t){i.isAttributeValueEqual(t)!=(1==e.FLAG_ON)||i.addAdditionalStatus(e.NAME)}))})),n=!0),n}))}))}i(e)}))},execute:function(e,t){var i=this;i._parent(e,t);var n=e.crTreeArray;null==t?i.reportOK(e):i.applyAdditionalStatusFlags(n,t,this._plugSvcs).then((function(t){var n=e;i.reportOK(n)}),(function(e){i.reportKO("FAILURE performing struct augment: "+e)}))}})})),define("DS/CompareWidget2/support/objIDSpec",["DS/CompareWidget2/support/cw2Utils"],(function(e){var t=function(t,i,n,o,r,s,a,l,u,c,d,p){this._physID=t?e.dupeJson(t):null,this._objType=i?e.dupeJson(i):null,this._securityContext=n?e.dupeJson(n):null,this._tenant=o?e.dupeJson(o):e.getCurrentTenant(),this._serviceName=r?e.dupeJson(r):"3DSpace",this._externalFilterSpec=s?e.dupeJson(s):null,this._idType=a?e.dupeJson(a):"modelID",this._commands=l?e.dupeJson(l):null,void 0!==u&&(this._supportsRevisions=!1!==u),void 0!==c&&(this._supportsFilters=!1!==c),void 0!==p&&(this._supportsEffectivityBasedRevisions=!1!==p),this._interfaces=d||[],this._reqModforODT="DS/CompareWidget2/support/objIDSpec"};return t.prototype.destroy=function(){delete this._physID,delete this._objType,delete this._securityContext,delete this._tenant,delete this._serviceName,delete this._externalFilterSpec,delete this._idType,delete this._commands,delete this._supportsRevisions,delete this._supportsFilters,delete this._interfaces,delete this._supportsEffectivityBasedRevisions},t.prototype.makeDupe=function(){return new t(this._physID,this._objType,this._securityContext,this._tenant,this._serviceName,this._externalFilterSpec,this._idType,this._commands,this._supportsRevisions,this._supportsFilters,this._interfaces,this._supportsEffectivityBasedRevisions)},t.prototype._getFilterID=function(e){let t=null;try{if(null!=e&&(t=e.filterTitle,(null==t||0==t.length)&&(t=e?.CVQuery?.union?.expand[0]?.config_filter_id?.physical_id,null==t||0==t.length))){let i=e.CVQuery||e;t=JSON.stringify(i)}}catch(e){}return t||"NO_FILTER"},t.prototype.getUniqueID=function(){let e=this._getFilterID(this._externalFilterSpec);var t="NO_COMMANDS";return null!=this._commands&&(t=this._commands),this.getPhysID()+"-"+this.getObjType()+"-"+this.getSecurityContext()+"-"+this.getTenant()+"-"+this.getServiceName()+"-"+e+"-"+t+"-"+this.getInterfacesString()},t.prototype.isEqual=function(e){return this.getUniqueID()==e.getUniqueID()},t.prototype.getPhysID=function(){return this._physID},t.prototype.getObjType=function(){return this._objType},t.prototype.getSecurityContext=function(){return this._securityContext},t.prototype.getTenant=function(){return this._tenant},t.prototype.getServiceName=function(){return this._serviceName},t.prototype.getExternalFilterSpec=function(){return this._externalFilterSpec},t.prototype.getIDType=function(){return this._idType},t.prototype.getCommands=function(){return this._commands},t.prototype.hasCommands=function(){var e=!1;return null!=this._commands&&this._commands.constructor==Array&&this.commands.length>0&&(e=!0),e},t.prototype.isFiltered=function(){return null!=this._externalFilterSpec||"ENOStrRefinementSpecification"==this._objType},t.prototype.getSvcType=function(){return this._serviceName+"."+this._objType},t.prototype.getTenantSvcType=function(){return this._tenant+"."+this.getSvcType()},t.prototype.getInterfaces=function(){return this._interfaces},t.prototype.getInterfacesString=function(){return Array.isArray(this._interfaces)?this._interfaces.join("|"):""},t})),define("DS/CompareWidget2/ViewDefModules/ViewDefOptions",["DS/CompareWidget2/ViewDefModules/DSColors","i18n!DS/CompareWidget/assets/nls/CompareWidget"],(function(e,t){"use strict";var i={PHYSICALID:"REF.physicalid",VERSIONID:"REF.versionid",REF_LOGID:"REF.logicalid",DFR:"REF.dfr",INST_LOGID:"INST.logicalid",XFORM:"INST.matrixtxt",USAGE:"REF.bo.plmentity.v_usage"},n={PHYSICALID:"REF.physicalid",VERSIONID:"REF.versionid",NAME:"REF.name"},o={...i,INST_LOGID:"INST.logicalid[connection]",XFORM:"INST.xform",USAGE:"REF.attribute[PLMEntity.V_usage]"},r={BASELINE:e.colorDef.ORANGE,COMPARE:e.colorDef.BLUE1},s={DB_PROPS:o,CV_PROPS:i,CVURL_BY_TYPE:[{name:"DEFAULT",url:"/cvservlet/expand"},{name:"3D",url:"/cvservlet/expand3d",typeList:["LPAbstract3DRepReference","LPAbstractReference","MCAD Component","CATIA V4 Model","CATIA CGR","CATShape"]},{name:"Filter",url:"/cvservlet/multiexpand",typeList:["ENOStrRefinementSpecification"]}],DATA_SOURCE:"CV_DIRECT",DB_FALLBACK:!0},a={PROPS:i,COMPUTE_DIFFERENT:!0,SYSTEM_RELATIONSHIP_NAMES:["LEFT_ONLY","RIGHT_ONLY","QUANTITY","DIFFERENT","UNRELATED"],CUSTOM_RELATIONSHIP_NAMES:["IDENTICAL","REVISION","BRANCH","DUPE","REPLACED"],CUSTOM_COMPARISONS:{COMP_PHYSID:[["PHYSICALID","PHYSICALID"],["EQ","NEQ","NEQ","NEQ","NEQ"]],COMP_VERID:[["VERSIONID","VERSIONID"],["EQ","EQ","NEQ","NEQ","NEQ"]],COMP_REF_LOGID:[["REF_LOGID","REF_LOGID"],["EQ","EQ","EQ","NEQ","NEQ"]],COMP_DFR:[["DFR","DFR"],["N/A","N/A","N/A","EQ","NEQ"]],COMP_INST_LOGID:[["INST_LOGID","INST_LOGID"],["N/A","N/A","N/A","N/A","EQ"]]},CUSTOM_MATCH_ADJUSTMENTS:[{NAME:"MOVED",PROPS:["XFORM","XFORM"],FLAG_ON:"NEQ",IS_VISIBLE:!0,MATCH_ADJ:-1},{NAME:"NON_MATCHING_INSTANCE",PROPS:["INST_LOGID","INST_LOGID"],FLAG_ON:"NEQ",IS_VISIBLE:!1,MATCH_ADJ:-2}]},l={PROPS:n,RELATION_LABELS:{"SpaceAssignment_to.472":{label:t.spaceAssignment,icon:" "},"RFL_implementScope_from.52":{label:t.implementedBy,icon:" "},"RFL_implementScope_to.51":{label:t.implementing,icon:""},"ProposedSolution_to.ProposedSolution":{label:t.proposedSolutions,icon:""},"v6_specdoc_to.87":{label:t.attachedDocuments,icon:""},"v6_annexdoc_to.Reference Document":{label:t.attachedDocuments,icon:""},"v6_specdoc_to.SpecificationDocument":{label:t.specificationDocuments,icon:""},"SpaceAssignment_to.":{label:t.spaceAssignment,icon:" "},"RFL_implementScope_from.":{label:t.implementedBy,icon:" "},"RFL_implementScope_to.":{label:t.implementing,icon:""},"ProposedSolution_to.":{label:t.proposedSolutions,icon:""},"v6_annexdoc_to.":{label:t.attachedDocuments,icon:""},"v6_specdoc_to.":{label:t.specificationDocuments,icon:""}},DOCS_RELS:["v6_specdoc_to","v6_annexdoc_to"],OTHER_RELS:["SpaceAssignment_to","RFL_implementScope_from","RFL_implementScope_to","ProposedSolution_to"]},u={PROPS:n,COMPUTE_DIFFERENT:!0,SYSTEM_RELATIONSHIP_NAMES:["LEFT_ONLY","RIGHT_ONLY","QUANTITY","DIFFERENT","UNRELATED"],CUSTOM_RELATIONSHIP_NAMES:["IDENTICAL","REVISION"],CUSTOM_COMPARISONS:{COMP_PHYSID:[["PHYSICALID","PHYSICALID"],["EQ","NEQ"]],COMP_VERID:[["VERSIONID","VERSIONID"],["EQ","NEQ"]],COMP_NAME:[["NAME","NAME"],["EQ","EQ"]]},CUSTOM_MATCH_ADJUSTMENTS:[]},c={SYSTEM_RULE_ID_FLAGS:{LEFT_ONLY:{COLOR:r.BASELINE,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"LO"},RIGHT_ONLY:{COLOR:r.COMPARE,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"RO"},UNRELATED:{COLOR:e.colorDef.BLACK,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"UNRELATED"},DIFFERENT:{COLOR:e.colorDef.BEIGE,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"DIFFERENT"},QUANTITY:{COLOR:e.colorDef.BLUE2,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"QUANTITY"}},CUSTOM_RULE_ID_FLAGS:{IDENTICAL:{COLOR:e.colorDef.NONE,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"SM"},REVISION:{COLOR:e.colorDef.VIOLET,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"REV"},BRANCH:{COLOR:e.colorDef.GREEN2,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"BRANCHED"},DUPE:{COLOR:e.colorDef.RED,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"DUPLICATED"},REPLACED:{COLOR:e.colorDef.PINK,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"REPLACED"}},CUSTOM_MATCH_ADJ_FLAGS:{MOVED:{COLOR:e.colorDef.YELLOW,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"MOVED"},NON_MATCHING_INSTANCE:{COLOR:e.colorDef.BLUE6,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"NON_MATCHING_INSTANCE"}},BUBBLE_FLAGS:{},CONTEXT_MENU_PLUGIN:"DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structDefaultContextMenu",CELL_DRAG_ENABLED_FLAG:!0,SHOW_HIDE_NODE_PARAMS:[{NAME:"SHOW_HIDE_PORT_AND_CONNECTION",CHILD:{TYPE:["PLMPort","PLMConnection"]},SHOW:!1},{NAME:"SHOW_HIDE_3DSHAPE_OF_3DPART",CHILD:{TYPE:["3DShape"]},PARENT:{TYPE:["VPMReference"],ATTRIBUTES:{[`${i.USAGE}`]:"3DPart"}},SHOW:"viewSettings.STRUCT_VIEW.show_3dshape_of_3dpart"}]};return{DB_PROPS:o,CV_PROPS:i,STRUCT_COLORS:r,REL_PROPS:n,BUBBLE_OPTIONS:{BUBBLE_DOWN_ENABLED:!1,BUBBLE_UP_ENABLED:!1,BUBBLED_STATUS_CONFIG:[]},ATTRIBUTE_DISPLAY_OPTIONS:{colorLeft:r.BASELINE,colorRight:r.COMPARE},INST_ATTR_FETCH_OPTIONS:{isInstance:!0},INST_ATTR_DISPLAY_OPTIONS:{isInstance:!0,colorLeft:r.BASELINE,colorRight:r.COMPARE},STRUCT_FETCH_OPTIONS:s,STRUCT_COMPARE_OPTIONS:a,STRUCT_DISPLAY_OPTIONS:c,EFFECTIVITY_FETCH_OPTIONS:{isEffectivity:!0},EFFECTIVITY_DISPLAY_OPTIONS:{isEffectivity:!0,colorLeft:r.BASELINE,colorRight:r.COMPARE},GET_RELATIONS_OPTIONS:l,COMPARE_REL_OPTIONS:u}})),define("DS/CompareWidget2/ViewDefModules/DefaultViewDefs_V2",["DS/CompareWidget2/ViewDefModules/ViewDefOptions"],(function(e){"use strict";var t={AttrFetch:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin"},AttrCompare:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin"},AttrDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",Options:e.ATTRIBUTE_DISPLAY_OPTIONS},InstAttrFetch:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin",Options:e.INST_ATTR_FETCH_OPTIONS},InstAttrCompare:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin"},InstAttrDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",Options:e.INST_ATTR_DISPLAY_OPTIONS},View3DDisplay:{Path:"DS/CompareWidget2/plugins/VIEW3D/VIEW3D_DISPLAY_plugin",Options:e.STRUCT_DISPLAY_OPTIONS},View3DPrep:{Path:"DS/CompareWidget2/plugins/VIEW3D/VIEW3D_PREP_plugin"},StructFetch:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_FETCH_plugin",Options:e.STRUCT_FETCH_OPTIONS},StructCompare:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_COMPARE_plugin",Options:e.STRUCT_COMPARE_OPTIONS},GetRelations:{Path:"DS/CompareWidget2/plugins/STRUCTURE/GET_RELATIONS_plugin",Options:e.GET_RELATIONS_OPTIONS},CompareRels:{Path:"DS/CompareWidget2/plugins/STRUCTURE/REL_COMPARE_plugin",Options:e.COMPARE_REL_OPTIONS},StructDisplay:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_DISPLAY_plugin",Options:e.STRUCT_DISPLAY_OPTIONS},StructListViewPrep:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_LIST_VIEW_PREP_PLUGIN"},StructCustAttrsPrep:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_CUST_ATTRS_PREP_plugin"},EffectivityFetch:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin",Options:e.EFFECTIVITY_FETCH_OPTIONS},EffectivityCompare:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin"},EffectivityDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",Options:e.EFFECTIVITY_DISPLAY_OPTIONS},Exporter:{Path:"DS/CompareWidget2/plugins/EXPORT/EXPORT_plugin",Options:e.STRUCT_DISPLAY_OPTIONS}};return UWA.merge({VIEWSETS:{PROPS_ONLY:{ROW:"PROP_VIEW"},STRUCT_ONLY:{ROW:"STRUCT_VIEW"},PAD3D_ONLY:{ROW:"PAD3D_VIEW"},PROPS_AND_STRUCT:{COL:["STRUCT_VIEW","PROP_VIEW"]},PROPS_STRUCT_INSTANCE:{ROW:["STRUCT_VIEW",{COL:["PROP_VIEW","INSTANCE_VIEW"]}]},STRUCT_PROPS_INST_PAD3D:{ROW:["STRUCT_VIEW",{COL:[["PROP_VIEW","INSTANCE_VIEW"],"PAD3D_VIEW"]}]},STRUCT_PROPS_INST_EFF_PAD3D:{ROW:["STRUCT_VIEW_WITH_CUSTOM_ATTRS",{COL:[["PROP_VIEW","INSTANCE_VIEW","EFFECTIVITY_VIEW"],"PAD3D_VIEW"]}]},STRUCT_PROPS_INST_EFF:{ROW:["STRUCT_VIEW_WITH_CUSTOM_ATTRS",{COL:[["PROP_VIEW","INSTANCE_VIEW","EFFECTIVITY_VIEW"]]}]},STRUCT_PROPS_EFF:{COL:["STRUCT_VIEW",["PROP_VIEW","EFFECTIVITY_VIEW"]]}},VIEWDEFS:{PROP_VIEW:["AttrFetch","AttrCompare","AttrDisplay"],INSTANCE_VIEW:["InstAttrFetch","InstAttrCompare","InstAttrDisplay"],EFFECTIVITY_VIEW:["EffectivityFetch","EffectivityCompare","EffectivityDisplay"],STRUCT_VIEW:["StructFetch","StructCompare","GetRelations","CompareRels","StructListViewPrep","StructDisplay","Exporter"],STRUCT_VIEW_WITH_CUSTOM_ATTRS:["StructFetch","StructCompare","GetRelations","CompareRels","StructCustAttrsPrep","StructListViewPrep","StructDisplay","Exporter"],PAD3D_VIEW:["StructFetch","View3DPrep","View3DDisplay"]},PLUGDEFS:t},e)})),define("DS/CompareWidget2/ViewDefModules/DefaultProps_ViewDef",["UWA/Core","DS/CompareWidget2/ViewDefModules/DefaultViewDefs_V2"],(function(e,t){return e.merge({FRAMEWORK_OPTIONS:{displaySingleViewPanelTitleBar:!0}},e.clone(t,!0))})),define("DS/CompareWidget2/ViewDefModules/TNR_viewDefs",["DS/CompareWidget2/ViewDefModules/DefaultViewDefs_V2","DS/CompareWidget2/ViewDefModules/DSColors"],(function(e,t){var i={PHYSICALID:"REF.physicalid",NAME:"REF.name",TYPE:"REF.ds6w:type",DFR:"REF.dfr",XFORM:"INST.matrixtxt",REVISION:"REF.ds6wg:revision"},n={...i,INST_LOGID:"INST.logicalid[connection]",XFORM:"INST.xform"};e.STRUCT_FETCH_OPTIONS.CV_PROPS=i,e.STRUCT_FETCH_OPTIONS.DB_PROPS=n;var o={PROPS:i,CUSTOM_RELATIONSHIP_NAMES:["IDENTICAL","REVISION","SIMILAR"],CUSTOM_COMPARISONS:{COMP_TYPE:[["TYPE","TYPE"],["EQ","EQ","EQ"]],COMP_DFR:[["DFR","DFR"],["EQ","EQ","EQ"]],COMP_PHYSID:[["PHYSICALID","PHYSICALID"],["EQ","NEQ","NEQ"]],COMP_NAME:[["NAME","NAME"],["EQ","EQ","NEQ"]],COMP_REV:[["REVISION","REVISION"],["EQ","NEQ","N/A"]]}};UWA.extend(e.STRUCT_COMPARE_OPTIONS,o);var r={CUSTOM_RULE_ID_FLAGS:{IDENTICAL:{COLOR:t.colorDef.NONE,NLS:"SM"},REVISION:{COLOR:t.colorDef.VIOLET,NLS:"REV"},SIMILAR:{COLOR:t.colorDef.GREEN2,NLS:"SIMILAR"}}};return UWA.extend(e.STRUCT_DISPLAY_OPTIONS,r),e})),define("DS/CompareWidget2/ViewDefModules/develViewDef",["DS/CompareWidget2/ViewDefModules/DefaultViewDefs_V2","DS/CompareWidget2/ViewDefModules/DSColors"],(function(e,t){UWA.extend(e.VIEWDEFS,{DEVEL_VIEW:["StructFetch","StructCompare","StructDisplay"]});return UWA.extend(e.VIEWSETS,{DEVEL_VIEWSET:[["DEVEL_VIEW","PROP_VIEW"],["PAD3D_VIEW"]]}),e.STRUCT_DISPLAY_OPTIONS.SYSTEM_RULE_ID_FLAGS.DIFFERENT.COLOR=t.colorDef.GREEN3,e.STRUCT_DISPLAY_OPTIONS.FORCE_ROOTS_TOGETHER=!0,e.STRUCT_COMPARE_OPTIONS.COMPUTE_DIFFERENT=!0,e})),define("DS/CompareWidget2/plugins/displayPlugin",["DS/CompareWidget2/plugins/plugin","DS/UIKIT/Mask"],(function(e,t){return e.extend({init:function(e,t,i,n){this._parent(e,t,i,n),this._type="DISPLAY_PLUGIN",this._frame=null,this._outputPanel=null,this._messagePanel=null},createViewPanelObject:function(e,t){throw new Error("Abstract class called")},getViewPanel:function(){return this._outputPanel},showMessage:function(e){null!=this._frame&&(t.isMasked(this._frame)&&this.showNotBusy(),t.mask(this._frame,e),this._frame.getElement(".spinner").destroy(),this._frame.getElement(".mask").setStyle("background-color","rgba(255, 255, 255, 1)"))},removeMessage:function(){this.showNotBusy()},showBusy:function(){null!=this._frame&&t.mask(this._frame)},showNotBusy:function(){null!=this._frame&&t.isMasked(this._frame)&&t.unmask(this._frame)},reportKO:function(e){null!=e?this.showMessage(e):this.showNotBusy(),this._parent(e)},buildViewPanel:function(e,t){var i=this;this.hideCloseButton=t&&!0===t.hideCloseButton,i._frame=widget._isODTMode()&&!widget.isCompareFrameworkTest?(document.body.innerHTML="",document.body):i._plugSvcs.requestFrame(e),i.showBusy(),i._outputPanel=i.createViewPanelObject(i._frame,t),(widget._isODTMode()&&widget.isCompareFrameworkTest||!widget._isODTMode())&&i._plugSvcs.addPanel(e,i._outputPanel,i)},getViewPanelName:function(){return this._outputPanel.getName()},destroyDisplayPanel:function(){var e=this;null!=e._outputPanel&&"function"==typeof e._outputPanel.destroy&&e._outputPanel.destroy(),e._outputPanel=null,e._frame=null},onClearView:function(){null!=this._outputPanel&&this._outputPanel.clearView()},onUpdateInProgress:function(){this.onClearView(),this.showBusy()},disconnect:function(){this.destroyDisplayPanel(),this._parent()},destroy:function(){this.destroyDisplayPanel(),this._parent()}})})),define("DS/CompareWidget2/plugins/VIEW3D/VIEW3D_DISPLAY_plugin",["DS/CompareWidget2/plugins/displayPlugin","DS/CompareWidget2/plugins/VIEW3D/ViewPanel/view3DComparePanel","DS/CompareWidget2/plugins/VIEW3D/ViewPanel/XSelectManager"],(function(e,t,i){"use strict";function n(e,t){for(var i=this,n=[],o=t.length,r=0;r<o;r++)for(var s=t[r],a=s.length,l="."+r,u=0;u<a;u++){for(var c=(p=s[u].IDPath.split("/")).length,d=0;d<c;d++){let e=p[d].length;p[d].substring(e-2)!=l&&(p[d]+=l)}s[u].IDPath=p.join("/")}for(const o of t)if(null!=o){var p=[];for(const t of o)try{var h=t.IDPath;if("IDPATH"==e)p.includes(h)||p.push(h);else{if("VIEWERPATH"!=e)return i._plugSvcs.errout("INVALID RETURN TYPE request: "+e),[];var _=i._outputPanel._getViewerPath(h);null!=_&&n.push({pathElement:_})}}catch(e){i._plugSvcs.warnout("Failed to get viewer path... continuing... :: "+e)}"IDPATH"==e&&n.push(p)}return n}function o(e){for(var t={},i=e.length,n=0;n<i;n++){var o=e[n];if(0==o.getIsHidden_byStatusFilter()){var r=o.getBaseNode(),s=r.isDummy()?"":r.getAttr("physicalID_REF")+".0",a=o.getCompNode(),l=a.isDummy()?"":a.getAttr("physicalID_REF")+".1";t[s+"_"+l]=!0,1==o.qtyIsDiff()&&(t[s+"_"]=!0,t["_"+l]=!0)}}return t}function r(e,t,i,n,o){var s={viewableRootSet:[],allVisible:!1},a=!0,l=t.getMatchInfo();let u=t.getRefInstNode(),c=!0;if(c=u&&u.isRoot()?"FALSE"===u.get_dbObj_REF().getAttr("pgp_show"):u&&"FALSE"===u.get_dbObj_INST().getAttr("pgp_show"),i){var d=l.getBaseNode(),p=d.isDummy()?"":d.getAttr("physicalID_REF")+".0",h=l.getCompNode(),_=h.isDummy()?"":h.getAttr("physicalID_REF")+".1";a=1!=n["DIFFERENT"==l.getRelName()?0==e?p+"_":"_"+_:p+"_"+_]}else a=o?l.getIsHidden_byStatusFilter():l.getIsHidden_byStatusFilter()||c;if(a){if(i)for(var g=(S=t.getChildArray()).length,f=0;f<g;f++){(m=r(e,S[f],i,n,o)).viewableRootSet.forEach((function(e){s.viewableRootSet.push(e)}))}}else{var S;g=(S=t.getChildArray()).length;s.allVisible=!0;let a=!0;if(a=u&&u.isRoot()?"FALSE"!==u.get_dbObj_REF().getAttr("pgp_show"):u&&"FALSE"!==u.get_dbObj_INST().getAttr("pgp_show"),0==g){C=(C=t.getPath()+"."+e).replaceAll("/","."+e+"/"),0==t.isDummy()&&(o||a)&&(s.viewableRootSet=[C])}else{for(f=0;f<g;f++){var m;0==(m=r(e,S[f],i,n,o)).allVisible&&(s.allVisible=!1),m.viewableRootSet.forEach((function(e){s.viewableRootSet.push(e)}))}var C;if(1==s.allVisible)C=(C=t.getPath()+"."+e).replaceAll("/","."+e+"/"),0==t.isDummy()&&(o||a)&&(s.viewableRootSet=[C])}}return s}function s(e){try{var t=this;let C=this.viewerDisplayMode;if(void 0===t._outputPanel||null===t._outputPanel)return;t._attrUpdateStartMS=t._plugSvcs.nowMS();var i=e.data.selectedData,s=e.data.crTree,a=[];if(null!=i){var l="LIST"==e.data.structDisplayMode;if("isolate"===C)a=function(e,t,i){var n=[[],[]],s=null;i&&(s=o(e.getCRList().getMatchPairArray()));for(var a=e.getRootArray().length,l=0;l<a;l++)for(var u=t[l].length,c=t[l].sort((function(e,t){return e.IDPath>t.IDPath})),d="XXX",p=0;p<u;p++){var h=c[p].IDPath;if(h.startsWith(d));else{d=h;var _=e.findNodeByIDPath(l,h);if(_){var g=r(l,_,i,s,!0).viewableRootSet;n[l]=n[l].concat(g)}}}return n}(s,i,l);else{if("select"!==C)return void t._plugSvcs.errout("INVALID - expected 'isolate' or 'select', was given: '"+C+"'");a=function(e,t){var i=[],n=null;t&&(n=o(e.getCRList().getMatchPairArray()));for(var s=e.getRootArray(),a=s.length,l=0;l<a;l++){var u=r(l,s[l].CRNode_root,t,n).viewableRootSet;i.push(u)}return i}(s,l)}var u={status:!1};try{"isolate"==C&&"select"==this._lastViewDisplayMode&&t._XSelectManager.notifyClearHighlights();var c="isolate"==C,d="select"==C,p="none"==this._lastViewDisplayMode,h="isolate"==this._lastViewDisplayMode,_=1==a[0].length&&-1==a[0][0].indexOf("/"),g=1==a[1].length&&-1==a[1][0].indexOf("/"),f=_&&g,S="FOCUSON"==t._XSelectManager.getUpdateState(),m=c||d&&(p||h||!f||!this._lastWasRootsOnly);(m=!S&&m)&&function(e,t){var i=!1,n=e,o=t;if(null==n||null==o)i=!0;else if(n.length!=o.length)i=!0;else for(var r=0;r<n.length&&0==i;r++){var s=n[r],a=o[r];s.length!=a.length&&(i=!0);for(var l=0;l<s.length&&0==i;l++)s[l]!=a[l]&&(i=!0)}return i}(a,this._lastIDPAAS)&&(u={status:!0,doneCB:function(e){"select"===C&&require(["DS/Selection/CSOManager","DS/Selection/HSOManager"],(function(e,o){t._XSelectManager.setUpdateState("INTERNAL");let r=n.call(t,"VIEWERPATH",i);e.add(r),o.add(r),t._XSelectManager.setUpdateState("NONE")}),(function(e){}))}},t._outputPanel.updateSelected(a,u),this._lastIDPAAS=a),this._lastViewDisplayMode=C,this._lastWasRootsOnly=f}catch(e){this._plugSvcs.errout("EXCEPTION updating selected in output panel")}if("select"===C){let e=n.call(t,"VIEWERPATH",i);t._XSelectManager.notifyNewHighlights(e,!u.status)}}}catch(e){this._plugSvcs.errout("EXCEPTION updating selected in 3DView output panel:"+e)}}function a(e){try{this._lastIDPAAS=[]}catch(e){this._plugSvcs.errout("EXCEPTION handling cache clearing in 3DView output panel:"+e)}}return e.extend({init:function(e,t,i,n){this._parent(e,t,i,n)},onEnabled:function(){var e=this;return e._lastViewDisplayMode="none",e._lastWasRootsOnly=!1,e.subscribeEvent("STRUCT_UPDATE_IN_PROGRESS_EVENT",e.onUpdateInProgress.bind(e)),e.subscribeEvent("NEW_CURRENT_SELECTION_EVENT",s.bind(this)),e.syncSetting("viewSettings.PAD3D_VIEW.view3D.isolate","_viewerDisplayModeIsolate",(()=>this.viewerDisplayMode=!0===this._viewerDisplayModeIsolate?"isolate":"select")),this.viewerDisplayMode=!0===this._viewerDisplayModeIsolate?"isolate":"select",null==e._XSelectManager&&(e._XSelectManager=new i(e._plugSvcs)),e.subscribeEvent("EVENT_FLUSH_DATA_CACHES",a.bind(this)),e._parent()},destroy:function(){this._XSelectManager.destroy(),this._XSelectManager=null,this._parent()},createViewPanelObject:function(e,i){return new t(e,this._plugSvcs,i)},execute:function(e,t){var i=this;i._parent(e,t);var n=e;null==n[0].structure.results[0]["ds6w:globaltype"]||null==n[1].structure.results[0]["ds6w:globaltype"]?i.reportKO("no viewable present for at least one object"):i._outputPanel.showResults(n).then((function(e){i.showNotBusy(),i.reportOK(e)}),(function(e){i.reportKO(e)}))}})})),define("DS/CompareWidget2/support/cw2CacheMgr",["UWA/Class","DS/CompareWidget2/support/cw2Utils"],(function(e,t){var i=function(){this.data={},this.putEntry=function(e,t){this.data[e]=t},this.getEntry=function(e){return this.data[e]},this.flush=function(){this.data={}},this.getSize=function(){return Object.keys(this.data).length},this.putArray=function(e){for(var t=e.length,i=0;i<t;i++){var n=e[i],o=n.name;this.putEntry(o,n)}}};return e.singleton({init:function(){this._cacheSet={}},flushAll:function(){this._cacheSet={}},flushCache:function(e){null!=this._cacheSet[e]&&(this._cacheSet[e]={})},getCache:function(e,t){return null==this._cacheSet[e]&&0!=t&&(this._cacheSet[e]=new i),this._cacheSet[e]},putCacheObj:function(e,t,i){this.getCache(e,!0).putEntry(t,i)},putCacheObjArray:function(e,t){for(var i=t.length,n=0;n<i;n++){var o=t[n],r=o.name;this.putCacheObj(e,r,o)}},getCacheObj:function(e,t){var i=this.getCache(e,!1);return ret=null!=i?entry=i.getEntry(t):void 0,ret},getSize:function(e){if(null==e)return Object.keys(this._cacheSet).length;var i=this.getCache(e,!1);return null==i?(t.errout("Cache '"+e+"' not found);"),null):i.getSize()},getTotalCachesSize:function(){return t.sizeof(this._cacheSet)}})})),define("DS/CompareWidget2/support/typeHierMgr",["UWA/Class","DS/CompareWidget2/support/cw2CacheMgr","DS/CompareWidget2/support/cw2Utils","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADWSAccess"],(function(e,t,i,n,o){return e.singleton({init:function(){this._cache=t.getCache("typeHier",!0)},flush:function(){this._cache.flush()},isKindOf_withLookup:function(e,t){var i=this;return new Promise((function(n,o){var r=i.isKindOf(e,t);null!=r?n(r):i.loadUp([e]).then((function(o){var r=i.isKindOf(e,t);n(r)}),(function(t){o("Failed to find type hierarchy for "+e+": "+t)}))}))},isKindOf:function(e,t){var i=null;if(e==t)i=!0;else{var n=this._cache.getEntry(e);n&&(i=1==n[t])}return i},loadUp:function(e){var t=this,i=[];return e.forEach((function(e){null==t._cache.getEntry(e)&&i.push(e)})),new Promise((function(e,r){var s;0==i.length?e():(s=i,new Promise((function(e,t){n.app_initialization((function(){o.getTypesHierarchy({types:s,onComplete:function(t){let i=JSON.parse(t).types_hierarchies;e(i)},onFailure:function(e){console.error("Cannot retrieve hierarchies"),t(e)}})}))}))).then((function(i){i.forEach((function(e){for(var i=e.type,n=e.hierarchy,o=null==n?0:n.length,r={},s=0;s<o;s++){r[n[s]]=!0}t._cache.putEntry(i,r)})),e()}),(function(e){r("Failed to loadUp type hierarchies in typeHierMgr... :"+e)}))}))}})})),define("DS/CompareWidget2/plugins/STRUCTURE/STRUCT_FETCH_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/STRUCTURE/expanders/expandMgr","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInstTreeAug","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInstTreeEditor","DS/CompareWidget2/support/objIDSpec","DS/CompareWidget2/userSettings/UserSettingsManager","DS/CompareWidget2/support/typeHierMgr","i18n!DS/CompareCommon/assets/nls/CompareCommon","i18n!DS/CompareWidget2/assets/nls/CompareV2","i18n!DS/CompareWidget2/assets/nls/DisplayMessages"],(function(e,t,i,n,o,r,s,a,l,u){function c(e,n){var r=this;return new Promise((function(s,a){r._plugSvcs.postEvent("STRUCT_UPDATE_IN_PROGRESS_EVENT",null);var l=[];e.forEach((function(e){if(null!=e.getCommands){var t=e.getCommands();null!=t&&t.forEach((function(t){var i=t.inNode;if(null!=i){var n=new o(i,"UNKNOWN",e.getSecurityContext(),e.getTenant(),e.getServiceName());l.push(n)}}))}}));for(var u=[...e,...l],c=[],d=u.length,p=0;p<d;p++){var h=null,_=null,g=u[p];if("AMD_MODULE_PATH"==g.getIDType())h="FILE_EXPAND";else{var f=g.isFiltered();if(0==r._useIndex&&0==f?h=r._expanders.byDB:(h=r._expanders.byIndex,_=f?null:r._expanders.byDB),"function"==typeof g.getBSDId&&g.getBSDId())h="CV_PROGRESSIVE_BSD";else if("CV_DIRECT"==h){var S=g.getExternalFilterSpec();null!=S&&null!=S.CVQueryV2&&"DELLmiGeneralSystemReference"!=g.getObjType()&&(h="CV_PROGRESSIVE")}}t.doExpand(g,h,_,"-1",r._plugSvcs,n).then((function(e){var t=e;if("AMD_MODULE_PATH"==g.getIDType())c.push(t),c.length>=d&&s(c);else{var n={securityContext:t._objIDSpec._securityContext,tenant:t._objIDSpec._tenant,serviceName:t._objIDSpec._serviceName};i.augment(t,n,r._plugSvcs).then((function(e){var t=e;c.push(t),c.length>=d&&s(c)}),(function(e){r._plugSvcs.errout("FAILURE AUGMENTING TREE:"+e),a(e)}))}}),(function(e){r._plugSvcs.errout("FAILURE EXPANDING TREE: "+e),a(e)}))}}))}function d(e){var t,i,n,o="compareSettings.dataSource.useIndex";if(!r.hasPref(o)){if(!r.hasPref("mergeSettings.dataSource.useIndex"))return void console.log("forceSwapToIndexMode: No setting found for using index.");o="mergeSettings.dataSource.useIndex"}!1===r.get(o)&&(e||(t="INDEX_REQ_ENABLING",i="compare-alert-warning",require(["DS/CompareCommon/CompareAlert"],(function(e){var o=null==t?a["MISSING ALERT MESSAGE"]:null!=a[t]?a[t]:t,r=null!=n&&""!==n?o.replace("{msgData}",n):o;e.doAlert({msg:r,alertStyle:i})}),(function(e){console.log("%%%% CompareWidget:: Failed to show "+i+": '"+t+"', error:"+e)}))),widget.setValue(o,!0),r.set(o,!0))}function p(e){this.postEvent({event:"Event_CW2_REFRESH"})}return e.extend({init:function(e,t,i,n){this._parent(e,t,i,n),this._expanders={byIndex:"CV_DIRECT",byDB:null},this.setExpandMethods(i.DATA_SOURCE,i.DB_FALLBACK)},onEnabled:function(){return this.syncSetting("compareSettings.dataSource.useIndex","_useIndex",p.bind(this)),!0},setExpandMethods:function(e,t){var i=this;null!=e&&""!==e&&(i._expanders.byIndex=e),null==t||""==t||0==t?i._expanders.byDB=null:1==t?"CV_SERVICE"==e||"CV_DIRECT"==e?i._expanders.byDB="DB_SERVICE":"LC_IDX_SERVICE"==e?i._expanders.byDB="LC_AUTH_SERVICE":(i._plugSvcs.warnout("DB FALLBACK DISABLED, as there is no default DB fallback for an expand of type: "+i._expanders.byIndex),i._expanders.byDB=null):i._expanders.byDB=t},execute:function(e,t){var i=this;i._parent(e,t);var o=e,r=o.some((e=>null!=e.isFiltered&&e.isFiltered()));i.setExpandMethods(t.DATA_SOURCE,t.DB_FALLBACK),(r||null==i._expanders.byDB&&0==i._useIndex)&&d.call(i,!1),c.call(i,o,t).then((function(e){var t=function(e,t){var i=[],n=[],o=[],r={};return t.forEach((function(e){var t=e.getObjIDSpec().getUniqueID();null==r[t]&&(r[t]=[]),r[t].push(e)})),e.forEach((function(e){var t=e.getUniqueID(),n=r[t].pop();i.push(n),o.push(t)})),Object.keys(r).forEach((function(e){r[e].forEach((function(e){n.push(e)}))})),{orderedTrees:i,extraTrees:n}}(o,e);t.orderedTrees.forEach((function(e){var o=e.getEditCommands();null!=o&&n.applyCommands(e,o,t.extraTrees,i._plugSvcs,!0)})),function(e){var t={};e.forEach((function(e){e.visit_riTreeAndFN((function(e){var i=e.getAttr("REF.ds6w:type"),n=e.getAttr("INST.ds6w:type");return t[i]=!0,null!=n&&(t[n]=!0),!0}))}));var i=Object.keys(t);return s.loadUp(i)}(t.orderedTrees).then((function(e){i.reportOK(t.orderedTrees)}),(function(e){i._plugSvcs.warnout("failed to load type hierarchies:: "+e),i._plugSvcs.warnout("continuing..."),i.reportOK(t.orderedTrees)}))}),(function(e){i._plugSvcs.confirmDialog(u.FETCH_FAIL_DEFAULT,{label:l.Close,callback:function(){i._plugSvcs.postEvent("Event_CW2_RESET_TO_INPUT")}},null),i.reportKO(e)}))}})})),define("DS/CompareWidget2/viewComponents/StandardCompareToolbar",["UWA/Core","UWA/Class","DS/Tweakers/GeneratedToolbar","DS/Core/PointerEvents","DS/Menu/Menu","DS/Tweakers/TypeRepresentationFactory","DS/CompareWidget2/support/cw2Utils","DS/CompareCommon/Utils","i18n!DS/CompareWidget2/assets/nls/CompareV2","css!DS/CompareWidget2/assets/css/Controls/Toolbar.css"],(function(e,t,i,n,o,r,s,a,l){"use strict";return t.extend({init:function(e,t,i){this.container=e,this.options=i,this.view=t,this._buildView()},_buildView:function(){var t=this;this.toolbarContainer=e.createElement("div",{class:"compare-view-toolbar-container"}).inject(this.container),!0===this.options.navigateDifferences&&(this.toolbarNavigate=new i({overflowManagement:"dropdown",direction:"horizontal",items:i.prototype.createTreeDocument({entries:[{id:"navigatePrevious",dataElements:{domId:"compare-navigate-previous-button",typeRepresentation:"functionIcon",position:"near",tooltipInfos:a.generateTooltip("CompareWidget2/Tooltips","PreviousDifference"),icon:{iconName:"chevron-left",fontIconFamily:1},category:1,overflowPriority:"never",value:()=>t.view.handleToolbarCommands.bind(t.view)({event:"navigatePrevious"}),priority:100}},{id:"numDifferencesCommand",dataElements:{domId:"compare-navigate-differences-button",typeRepresentation:"functionMenuIconCount",label:"Differences",position:"near",tooltipInfos:a.generateTooltip("CompareWidget2/Tooltips","NumberOfDifferences"),value:{menu:[{icon:"double-chevron-up",title:l.FirstDifference,tooltip:a.generateTooltip("CompareWidget2/Tooltips","FirstDifference"),domId:"compare-navigate-first-button",event:"navigateFirst"},{icon:"double-chevron-down",title:l.LastDifference,tooltip:a.generateTooltip("CompareWidget2/Tooltips","LastDifference"),domId:"compare-navigate-last-button",event:"navigateLast"}].map((e=>({type:"PushItem",title:e.title,domId:e.domId,tooltip:e.tooltip,fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+e.icon},action:{callback:i=>{t.view.handleToolbarCommands({event:e.event})}}})))},category:1,overflowPriority:"never",priority:100,count:1}},{id:"navigateNext",dataElements:{domId:"compare-navigate-next-button",typeRepresentation:"functionIcon",position:"near",tooltipInfos:a.generateTooltip("CompareWidget2/Tooltips","NextDifference"),icon:{iconName:"chevron-right",fontIconFamily:1},category:1,overflowPriority:"never",value:()=>t.view.handleToolbarCommands.bind(t.view)({event:"navigateNext"}),priority:100}}]})}),this.toolbarNavigate.inject(this.toolbarContainer),this.toolbarNavigate.elements.container.addClassName("compare-view-toolbar-navigate"),"desktop"!==s.getDeviceType()&&this.toolbarNavigate.elements.container.setAttribute("touch-mode",""),this.onReadyLeftToken||(this.onReadyLeftToken=t.toolbarNavigate.getContent().addEvent("onReady",(function(){var e=t.toolbarNavigate.getNodeModelByID("numDifferencesCommand")._associatedView;e&&e.getContent().addClassName("compare-toolbar-differences")}))));var n=Array.isArray(this.options.otherMenuItems)&&this.options.otherMenuItems.length?this.options.otherMenuItems:[];if(this.options.showCompareLegend){this.toolbar=new i({overflowManagement:"dropdown",direction:"horizontal",popupDisplayStyle:"Basic",items:i.prototype.createTreeDocument({entries:[]})}),this.toolbar.elements.container.addClassName("compare-view-toolbar-legend"),this.toolbar.inject(this.toolbarContainer),this.onReadyLegendToken||(this.onReadyLegendToken=t.toolbar.getContent().addEvent("onReady",(function(){if(t.legendItems)for(var e in t.legendItems){var i=t.legendItems[e],n=t.toolbar.getNodeModelByID(e);if(n){let o=n._associatedView;if(o){let r=o.getContent().getParent(".wux-generated-toolbar-items");r.addClassName("compare-toolbar-legend");let s=o.getContent();s.id="compare-legend-status-"+i.label;let a=s.getChildren();a[0].addClassName("compare-toolbar-legend-item");let l=a[0].getChildren(),u=!1===n._options.visibleFlag||"IDENTICAL"===e&&""===i.color;l[0].setStyles({"background-color":u?"#FFFFFF":i.color,"border-color":u?"grey":i.color}),u&&(l[0].addClassName("compare-gray-check-for-white-status"),s.show(),r.addClassName("compare-toolbar-show-hidden-status")),t.toolbar.elements.popupContent.setStyles({"padding-right":"10px","padding-left":"10px","padding-top":"2px","padding-bottom":"2px"})}}}}))),n.unshift({id:"chooseStatusToDisplay",dataElements:{domId:"compare-choose-statuses-display-button",typeRepresentation:"functionIcon",tooltipInfos:a.generateTooltip("CompareWidget2/Tooltips","chooseStatusToDisplay"),icon:{iconName:"menu-eye",fontIconFamily:1},overflowPriority:"never",value:()=>t.view.handleToolbarCommands.bind(t.view)({event:"legendApplyVisibility"}),position:"far",priority:1}})}Array.isArray(n)&&n.length&&(this.toolbarOtherItems=new i({overflowManagement:"dropdown",direction:"horizontal",popupDisplayStyle:"Basic",items:i.prototype.createTreeDocument({entries:n})}),this.toolbarOtherItems.inject(this.toolbarContainer),this.toolbarOtherItems.elements.container.addClassName(this.options.showCompareLegend?"compare-view-toolbar-right-fixed-width":"compare-view-toolbar-right"))},update:function(e){let t=this,n=["toolbarNavigate","toolbar","toolbarOtherItems"],o=(e,t)=>{n.forEach((i=>{this[i]&&this[i][e].apply(this[i],t)}))};o("prepareUpdateView");for(let n in e)switch(n){case"legend":{null!=this.legendItems&&Object.keys(this.legendItems).forEach((e=>{this.toolbar.items&&Array.isArray(this.toolbar.items.getRoots())&&this.toolbar.items.getRoots().filter((t=>t._ID.indexOf(e)>=0)).forEach((e=>e.remove(!0)))})),this.legendItems=e[n];var r={entries:[]};let o=0;for(var s=0;s<=o;++s)for(let[e,i]of Object.entries(this.legendItems)){let n=null!=i.legendGrouping?i.legendGrouping:0;if(n>s)n>o&&(o=n);else if(n===s){let n=i.tooltip;""!==i.modulePath&&Object.entries(l).map((([e,t])=>{t===i.label&&(n=a.generateTooltip(i.modulePath,e))})),r.entries.push({id:e,tooltipInfos:n,dataElements:{typeRepresentation:"bool",label:i.label,value:i.checked,color:this.legendItems[e].color,visibleFlag:i.visibleFlag},onNodeUpdate:function(e){var n=e.getAttributeValue("data");i.checked=n,t.view.handleToolbarCommands.bind(t.view)({event:"legendApplyFilter",toolbar:t.toolbar})}})}}[...i.prototype.createTreeDocument(r).getRoots()].forEach((function(e){t.toolbar.items.addRoot(e)}));break}case"numDifferences":null!=t.toolbarNavigate&&(t.toolbarNavigate.getNodeModelByID("numDifferencesCommand").options.count=e[n]);break;case"enableDisableCommands":e[n].forEach((e=>{o("updateNodeModel",[e.id,{disabled:e.disabled}])}));break;case"showHideCommands":e[n].forEach((e=>{o("updateNodeModel",[e.id,{visibleFlag:e.visibleFlag}])}));break;case"displayIcon":e[n].forEach((e=>{o("updateNodeModel",[e.id,{grid:{semantics:{icon:{iconName:e.icon}}}}])}))}o("pushUpdateView")},destroy:function(){}})})),define("DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/matchPair",["DS/CompareWidget2/support/cw2Utils"],(function(e){var t=function(e,t,i,n,o){this._relName=e,this._adjFlagArray=t||[],this._additionalStatusArray=[],this._bubbledStatusArray_static=[],this._bubbledStatusArray_dynamic=[],null!=o&&o.length>0&&(this._instFlagNdxs=o),this._baseNode=i,this._compNode=n,this._treeNodeArray=[],this._depth="",this._level=-1,this._isHidden_byStatusFilter=!1,this._isHidden_byTypeAttr=!1,this._showHideNodeByTypeAndAttrParam=NaN,this._reqModforODT="DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/matchPair"};return t.prototype.getRelName=function(){return this._relName},t.prototype.getBaseNode=function(){return this._baseNode},t.prototype.getCompNode=function(){return this._compNode},t.prototype.getOtherNode=function(e){return this._baseNode===e?this._compNode:this._baseNode},t.prototype.resetRelName=function(e){this._relName=e},t.prototype.resetBaseNode=function(e){this._baseNode=e},t.prototype.resetCompNode=function(e){this._compNode=e},t.prototype.isBaseDummy=function(){return this._baseNode.isDummy()},t.prototype.isCompDummy=function(){return this._baseNode.isDummy()},t.prototype.getAdjFlagArray=function(){return this._adjFlagArray},t.prototype.getInstFlagNdxs=function(){return this._instFlagNdxs},t.prototype.qtyIsDiff=function(){return this.qtyIsDiffFlag},t.prototype.setDepth=function(e){this._depth=e},t.prototype.getDepth=function(){return this._depth},t.prototype.setLevel=function(e){this._level=e},t.prototype.getLevel=function(){return this._level},t.prototype.setIsHidden_byStatusFilter=function(e){this._isHidden_byStatusFilter=e},t.prototype.setIsHidden_byTypeAttr=function(e){this._isHidden_byTypeAttr=e},t.prototype.getIsHidden_byStatusFilter=function(){return this._isHidden_byStatusFilter},t.prototype.getIsHidden_byTypeAttr=function(){return this._isHidden_byTypeAttr},t.prototype.getIsHidden_byAnyFilter=function(){return this._isHidden_byTypeAttr||this._isHidden_byStatusFilter},t.prototype.setShowHideNodeByTypeAndAttrParamIndex=function(e){this._showHideNodeByTypeAndAttrParam=e},t.prototype.getShowHideNodeByTypeAndAttrParamIndex=function(){return this._showHideNodeByTypeAndAttrParam},t.prototype.addTreeNode=function(e){this._treeNodeArray.push(e)},t.prototype.getTreeNodes=function(){return this._treeNodeArray},t.prototype.addBubbledStatus=function(e,t){var i=this.hasStatus(e);if(null==i)t?this._bubbledStatusArray_dynamic.push(e):this._bubbledStatusArray_static.push(e);else if("DYNAMIC"==i&&0==t){this._bubbledStatusArray_static.push(e);var n=this._bubbledStatusArray_dynamic.indexOf(e);this._bubbledStatusArray_dynamic.splice(n,1)}},t.prototype.addAdditionalStatus=function(e){this._additionalStatusArray.push(e)},t.prototype.getAllStatusArray=function(e){var t=[];return t=null!=this._bubbledStatusArray_static?[this._relName,...this._adjFlagArray,...this._bubbledStatusArray_static]:[this._relName,...this._adjFlagArray],null!=this._additionalStatusArray&&(t=[...t,...this._additionalStatusArray]),this.qtyIsDiffFlag&&t.push("QUANTITY"),1==e&&this._bubbledStatusArray_dynamic.length>0&&(t=[...t,...this._bubbledStatusArray_dynamic]),t},t.prototype.hasStatus=function(e){var t=null;return this._relName==e?t="PRIMARY":null!=this.additionalStatusArray&&this.additionalStatusArray.contains(e)?t="ADDITIONAL":null!=this._adjFlagArray&&this._adjFlagArray.includes(e)?t="SECONDARY":null!=this._bubbledStatusArray_static&&this._bubbledStatusArray_static.includes(e)?t="STATIC":null!=this._bubbledStatusArray_dynamic&&this._bubbledStatusArray_dynamic.includes(e)&&(t="DYNAMIC"),t},t.prototype.shallowDupe=function(){var e=this._relName.repeat(1),i=null==this._adjFlagArray?[]:JSON.parse(JSON.stringify(this._adjFlagArray)),n=null==this._additionalStatusArray?[]:JSON.parse(JSON.stringify(this._additionalStatusArray)),o=this._bubbledStatusArray_dynamic?[]:JSON.parse(JSON.stringify(this._bubbledStatusArray_dynamic)),r=this._bubbledStatusArray_static?[]:JSON.parse(JSON.stringify(this._bubbledStatusArray_static)),s=null;null!=this._instFlagNdxs&&this._instFlagNdxs.length>0&&(s=JSON.parse(JSON.stringify(this._instFlagNdxs)));var a=this._baseNode.shallowDupe(),l=this._compNode.shallowDupe(),u=new t(e,i,a,l,s);return u._isHidden_byStatusFilter=this._isHidden_byStatusFilter,u._isHidden_byTypeAttr=this._isHidden_byTypeAttr,u._additionalStatusArray=n,u._bubbledStatus_dynamic=o,u._bubbledStatus_static=r,a.setMatchInfo(u),l.setMatchInfo(u),u},t.prototype.isAttributeValueEqual=function(e){return this.getBaseNode().getAttr(e)===this.getCompNode().getAttr(e)},t})),define("DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crNode",["UWA/Core","DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/support/objIDSpec"],(function(e,t,i){function n(e){var i=!1;return e instanceof o?e==this?t.errout("Cannot attach an CRNode to itself... ignoring"):i=!0:t.errout("CRNode.validateCRNodeToAdd:Cannot attach an object that is not a CRNode... ignored"),i}var o=function(e,t,i,n,o,r,s,a,l,u,c,d){if(this._attrList={},this._childArray=[],this._parent=null,this._matchInfo=null,this._dbContext={},this._path=null,this._objIDSpecREF=null,this._objIDSpecINST=null,this._expandCollapseState="expanded",this._isVisible=!0,this._externalFilterName=null,this._attrList={name:e,title:t,type:i,physicalID_REF:o,physicalID_INST:n,revision:r,displayOrder:s,typeIconSmallURL:a,typeIconLargeURL:l,thumbnail_3d:u},this._customRuleAttrs={},null!=d){const e=(e,t)=>void 0===t?null:t;this._customRuleAttrs=JSON.parse(JSON.stringify(d,e))}this._riNode=c,this._reqModforODT="DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crNode"};return o.prototype.sortChildren=function(){var e=this._childArray.sort((function(e,t){return e.getAttr("displayOrder")-t.getAttr("displayOrder")}));this._childArray=e},o.prototype.getRefInstNode=function(){return this._riNode},o.prototype.isDummy=function(){return null==this._attrList.physicalID_REF},o.prototype.setDBContext=function(e){this._dbContext=e},o.prototype.hasExternalFilter=function(){return null!=this._externalFilterName},o.prototype.getExternalFilterName=function(){return this._externalFilterName},o.prototype.setExternalFilterName=function(e){this._externalFilterName=e},o.prototype.getObjIDSpec_REF=function(){return null==this._objIDSpecREF&&void 0!==this._attrList.physicalID_REF&&null!==this._attrList.physicalID_REF&&(this._objIDSpecREF=new i(this._attrList.physicalID_REF,this._attrList.type,this._dbContext.securityContext,this._dbContext.tenant,this._dbContext.serviceName)),this._objIDSpecREF},o.prototype.getObjIDSpec_INST=function(){return null==this._objIDSpecINST&&null!=this._attrList.physicalID_INST&&(this._objIDSpecINST=new i(this._attrList.physicalID_INST,this._attrList.type,this._dbContext.securityContext,this._dbContext.tenant,this._dbContext.serviceName)),this._objIDSpecINST},o.prototype.getDBContext=function(){return this._dbContext},o.prototype.getTitle=function(){return this._attrList.title},o.prototype.getType=function(){return this._attrList.type},o.prototype.getCustomRuleAttrs=function(){return this._customRuleAttrs},o.prototype.addAttr=function(e,t){this._attrList[e]=t},o.prototype.addOrSetCustAttr=function(e,t){this._customRuleAttrs[e]=t},o.prototype.getAttr=function(e){let t;return t=this._attrList[e],null==t&&(e.indexOf("REF.")>=0||e.indexOf("INST.")>=0)&&this._riNode&&(t=this._riNode.getAttr(e)),null==t&&null!=this._customRuleAttrs&&(t=this._customRuleAttrs[e]),t},o.prototype.addChild=function(e){n(e)&&this._childArray.push(e)},o.prototype.getChildArray=function(){return this._childArray},o.prototype.getChildren=function(){return this._childArray},o.prototype.findChildByID=function(e,t){for(var i=this._childArray.length,n=null,o=0;o<i;o++){var r=this._childArray[o],s=r.getAttr("physicalID_INST"),a=r.getAttr("physicalID_REF");if(e==s&&t==a){n=r;break}}return n},o.prototype.getPath=function(){if(null==this._path){for(var e=[],t=this;null!=t&&"object"==typeof t;){var i=t.getAttr("physicalID_INST"),n=t.getAttr("physicalID_REF");if(null==n)break;e.unshift(n),null!=i&&""!==i&&e.unshift(i),t=t.getParent()}this._path=e.join("/")}return this._path},o.prototype.setParent=function(e){n(e)&&(null!=this._parent&&t.errout("CRNode's parent is being reassigned (this is unexpected)."),this._parent=e)},o.prototype.getParent=function(){return this._parent},o.prototype.setMatchInfo=function(e,t){1==(null!=t)?(null==this._matchInfo&&(this._matchInfo=[]),this._matchInfo[t]=e):this._matchInfo=e},o.prototype.getMatchInfo=function(e){let t=null;return e=e||0,null!=this._matchInfo&&(this._matchInfo.constructor==Array?t=this._matchInfo[e]:0==e?t=this._matchInfo:console.error("ASKED FOR compTreeIndex: "+e+", but matchInfo is not an array")),t},o.prototype.getAllMatchInfo=function(){return this._matchInfo},o.prototype.isRoot=function(){return null==this._parent},o.prototype.isHeaderRow=function(){return"relations"==this._attrList.type},o.prototype.isBlank=function(){return null==this._attrList.type},o.prototype.isDraggable=function(){return!(this.isBlank()||this.isHeaderRow())},o.prototype.destroy=function(){this._parent=null,this._matchInfo=null,this._attrList=null;for(var e=0;e<this._childArray.length;e++)null!=this._childArray[e]&&(this._childArray[e].destroy(),this._childArray[e]=null)},o.prototype.shallowDupe=function(){let t=new o(this._attrList.name,this._attrList.title,this._attrList.type,this._attrList.physicalID_INST,this._attrList.physicalID_REF,this._attrList.revision,this._attrList.displayOrder,this._attrList.typeIconSmallURL,this._attrList.typeIconLargeURL,this._attrList.thumbnail_3d,this._riNode,this._customRuleAttrs);null!=this._synthProps&&(t._synthProps=JSON.parse(JSON.stringify(this._synthProps))),t.setDBContext(e.clone(this.getDBContext()));var i=this.getExternalFilterName();return t.setExternalFilterName(i),t},o.prototype.getExpandCollapseState=function(){return Array.isArray(this._childArray)&&this._childArray.length?this._expandCollapseState||"expanded":"noExpandState"},o.prototype.setExpandCollapseState=function(e){this._expandCollapseState=e},o.prototype.visitVisible_nodesAndFN=function(e){return this.visit_nodesAndFN(!0,e)},o.prototype.visitAll_nodesAndFN=function(e){return this.visit_nodesAndFN(!1,e)},o.prototype.removeChild=function(e){for(var t=0;t<this._childArray.length;t++){if(this._childArray[t]===e){this._childArray.splice(t,1);break}}},o.prototype.visit_nodesAndFN=function(e,i,n){var o=this,r=!1;if(1==e&&1==o._isVisible||0==e)try{var s=[];for(s.push(o);s.length>0;){var a=s.pop();if(0!=(r=i(a))&&(1==e&&1==o._isVisible||0==e))for(var l=a.getChildArray(),u=l.length-1;u>=0;u--){var c=l[u],d=!!c.getMatchInfo(n)&&!c.getMatchInfo(n).getIsHidden_byStatusFilter();(1==e&&1==d||0==e)&&s.push(c)}}}catch(e){r=!1,t.errout("EXCEPTION in 'visit_nodesAndFN':: "+e)}return r},o.prototype.areAnyChildrenVisible=function(){var e=!1;if("expanded"==this.getExpandCollapseState()){var t=this.getChildArray();if(null!=t)for(var i=0;i<t.length;i++){if(0==t[i].getMatchInfo().getIsHidden_byAnyFilter()){e=!0;break}}}return e},o.prototype.setSynthProps=function(e){this._synthProps=e},o.prototype.getSynthProp=function(e){let t=null;return null!=this._synthProps&&(t=this._synthProps[e]),t},o.prototype.hasChildren=function(){return Array.isArray(this._childArray)&&this._childArray.length},o})),define("DS/CompareWidget2/plugins/STRUCTURE/GET_RELATIONS_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/STRUCTURE/relations/Ecosystem","DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crNode"],(function(e,t,i){"use strict";const n=50;function o(e,i){var n=this;return new Promise((function(e,i){var o=n.rels,r=n.relationLabels=n.relationLabels||n._pluginOptions.RELATION_LABELS;n._lastReqStart=n._plugSvcs.nowMS(),n._plugSvcs.postEvent("GET_RELATIONS_IN_PROGRESS_EVENT",null);var l=n._objIn.crTreeArray[0].getRoot(0),u=n._objIn.crTreeArray[0].getRoot(1),c=s(l),d=s(u),p=c.concat(d);t.get(p,o,(function(t){if(null!=t){var i=[];i.push(l),a(t,i,r);var o=[];o.push(u),a(t,o,r)}e(n._objIn)}))}))}function r(e){var t=[];return e.forEach((function(e){e.getChildArray().forEach((function(e){t.push(e)}))})),t}function s(e){let t=e.getChildArray();var i=[],o=1;let s=e.getObjIDSpec_REF().getPhysID();for(s&&i.push(s);o<=n&&t.length>0;)t.forEach((function(e){let t=e.getObjIDSpec_REF().getPhysID();t&&i.push(t)})),o++,t=r(t);return i}function a(e,t,i){for(var o=1,s=t,a=t[0];o<=n&&s.length>0;)s.forEach((function(t){if(null!=t.getObjIDSpec_REF().getPhysID()){var n=t.getObjIDSpec_REF().getPhysID(),o=[];e.formated[n]&&(o=Object.keys(e.formated[n]));for(var r=0;r<o.length;r++){var s=e.formated[n][o[r]],a=i[o[r]]?.label,c=l(t,o[r],a);s.forEach((function(i){var n=e.idObjMap[i],o=u(c,n);c.addChild(o),o.setDBContext(t._dbContext)})),t.addChild(c)}}})),s=r(s),o++;return a}function l(e,t,n){var o=new i(n,n,"relations","",t,"","","","","");return o.setParent(e),o.addAttr("REF.ds6w:type","relations"),o.addAttr("REF.physicalid",t),o.addAttr("REF.logicalid",t),o.addAttr("REF.versionid",t),o.addAttr("REF.name",n),o.addAttr("REF.dfr",t),o.addAttr("REF.ds6wg:revision",""),o.addAttr("REF.thumbnail_3d",""),o._extRelNLS=!0,o}function u(e,t){var n=new i(t.name,t.name,t.type,"",t.id,t.revision,"",t.icon_url,t.icon_url,t.thumbnail);return n._path=t.id,n.setParent(e),n.addAttr("REF.ds6w:type",t.type),n.addAttr("REF.physicalid",t.id),n.addAttr("REF.logicalid",t.id),n.addAttr("REF.versionid",t.revision),n.addAttr("REF.name",t.name),n.addAttr("REF.dfr",t.id),n.addAttr("REF.ds6wg:revision",t.revision),n.addAttr("REF.thumbnail_3d",t.thumbnail),n}return e.extend({init:function(e,t,i,n){this._parent(e,t,i,n),this.relationLabels=i.RELATION_LABELS},onEnabled:function(){return this.syncSetting("compareSettings.includeFacets.externalRelations.showDocs","showDocs"),this.syncSetting("compareSettings.includeFacets.externalRelations.showOtherRels","showOtherRels"),!0},execute:function(e,t){var i=this;i._parent(e,t);var n=[];!0!==this.showDocs&&"true"!==this.showDocs||(n=t.DOCS_RELS);var r=[];!0!==this.showOtherRels&&"true"!==this.showOtherRels||(r=t.OTHER_RELS),i.rels=n.concat(r);var s=e.crTreeArray[0];i._objIn=e,i.rels.length>0?o.call(i,s,t).then((function(e){var t=e;i.reportOK(t)}),(function(e){i.reportKO()})):i.reportOK(e)}})})),define("DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_tree",["DS/CompareWidget2/support/cw2Utils"],(function(e){var t=function(e){this._objIDSpec=e,this._rootRefInstNode=null,this._pathArray=[],this._dataSource="UNKNOWN",this._editsApplied=!1,this._reqModforODT="DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_tree"};return t.prototype.makeDupe=function(){var e=this._objIDSpec.makeDupe(),i=this._rootRefInstNode.makeDupe(),n=new t(e);return n._rootRefInstNode=i,n._pathArray=JSON.parse(JSON.stringify(this._pathArray)),n._dataSource=this._dataSource,n._editsApplied=this._editsApplied,n._reqModforODT=this._reqModforODT,n},t.prototype.getEditCommands=function(){var e=null;return null!=this._objIDSpec&&(e=this._objIDSpec.getCommands()),e},t.prototype.get_editsHaveBeenApplied=function(){return this._editsApplied},t.prototype.set_editsHaveBeenApplied=function(){this._editsApplied=!0},t.prototype.getObjIDSpec=function(){return this._objIDSpec},t.prototype.setDataSource=function(e){null!=e&&0!=e.length&&(this._dataSource=e)},t.prototype.setRoot=function(e){this._rootRefInstNode=e},t.prototype.getRoot=function(){return this._rootRefInstNode},t.prototype.setPathArray=function(e){this._pathArray=e},t.prototype.getPathArray=function(){return this._pathArray},t.prototype.sortChildren=function(){this.visit_riTreeAndFN((function(e){e.sortChildArray()}))},t.prototype.findNodeByPhysIDPath=function(e){var t=e.split("/");if(this._rootRefInstNode.get_dbObj_REF().getAttr("REF.physicalid")!=t[0]);else for(var i=this._rootRefInstNode,n=t.length,o=1;o<n;o+=2){var r=t[o],s=t[o+1];if(null==(i=i.findChild(r,s)))break}return i},t.prototype.visit_riTreeAndFN=function(t){return null==this._rootRefInstNode?e.errout("'visit_riTreeAndFN()' called, but tree has no root"):this._rootRefInstNode.visit_subtreeAndFN(t),!0},t.prototype.assignLevelToAllNodes=function(){let e=this.getRoot();this._assignLevels(e,0)},t.prototype._assignLevels=function(e,t){e._level=t;let i=this,n=e.getChildArray();null!=n&&n.forEach((function(e){i._assignLevels(e,t+1)}))},t})),define("DS/CompareWidget2/plugins/STRUCTURE/refInstTree/dbObj",["DS/CompareWidget2/support/cw2Utils"],(function(e){function t(t){var i=!1;return null!=t&&0!=t.length?i=!0:e.errout("Invalid string (null or zero length)"),i}var i=function(){this._attrList={},this._reqModforODT="DS/CompareWidget2/plugins/STRUCTURE/refInstTree/dbObj"};return i.prototype.makeDupe=function(){var e=new i;return e._attrList=JSON.parse(JSON.stringify(this._attrList)),e._reqModforODT=this._reqModforODT,e},i.prototype.addAttr=function(i,n,o){t(i)&&(0!=o&&null!=this._attrList[i]&&this._attrList[i]!=n&&e.warnout("New attr value is overwriting an existing attr value for '"+i+"'"),this._attrList[i]=n)},i.prototype.setAttr=function(e,t){this.addAttr(e,t,!1)},i.prototype.rmAttr=function(e){delete this._attrList[e]},i.prototype.getAttrList=function(){return this._attrList},i.prototype.getAttr=function(e){return ret=null,t(e)&&(ret=this._attrList[e]),ret},i.prototype.hasAttr=function(e){return ret=!1,t(e)&&(ret=this._attrList.hasOwnProperty(e)),ret},i})),define("DS/CompareWidget2/support/attrNLS_mgr",["DS/CompareWidget2/support/cw2CacheMgr","DS/CompareCommon/Utils","DS/CompareWidget2/support/DataCenter","DS/CompareWidget2/support/cw2Utils","i18n!DS/CompareWidget2/assets/nls/DisplayMessages"],(function(e,t,i,n,o){function r(e,t){e.forEach((function(e){""!==e.label&&t.putEntry(e.curi,e.label)}))}function s(e){let t=e,i=["REF.","INST."].find((function(t){return e.startsWith(t)}));if(null!=i){let n=i.length;t=e.substring(n)}return t}return{getObjAttrCache:function(i,o,a,l,u){return new Promise((function(c,d){let p=o+"."+l+"."+u,h=e.getCache(p,!0),_=!1;if(h.getSize()>0)for(var g of(attrNamesArray=Object.values(i),attrNamesArray)){let e=s(g);void 0===h.getEntry(e)&&(_=!0)}if(0==h.getSize()||_){let e=[o];null!=a&&a.length>0?e=a:"VPMReference"===o&&(e=["ds6wg:VPMReference","ds6wg:VPMRepReference","ds6wg:EnterpriseExtension","ds6wg:VPMInstance","ds6wg:VPMRepInstance"]),t.getPropertiesForClassPromise(e,l).then((function(e){for(var t of e)r(t.properties,h);c(h)}),(function(){n.errout("failed getting predicates... can't lookup NLS for attrs... continuing"),c(h)}))}else c(h)}))},getAttrNLS:function(e,i,n,r,a){let l={},u=JSON.parse(JSON.stringify(e));return this.getObjAttrCache(e,i,n,r,a).then((function(e){let i=e;return Object.keys(u).forEach((function(e){let n=u[e],r=s(n),a=i.getEntry(r);null==a&&(a="_#_DELETED_#_",t.showAlertBox(o.get("CUSTOM_ATTRIBUTE_DELETED").replace("{msgData}",r),null,"warning")),l[n]=a})),l}))}}})),define("DS/CompareWidget2/plugins/ATTRIBUTE/ViewPanel/propsComparePanel",["UWA/Core","UWA/Json","DS/CustomizableLayout/View","DS/CompareWidget2/plugins/ATTRIBUTE/ViewPanel/attrChooseDialog","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/DataGridView/DataGridView","DS/CompareWidget2/viewComponents/StandardCompareToolbar","DS/CompareWidget2/userSettings/UserSettingsManager","DS/CompareWidget2/support/cw2Utils","DS/CompareCommon/Utils","i18n!DS/CompareWidget2/assets/nls/CompareV2","i18n!DS/CompareWidget2/assets/nls/DisplayMessages","css!DS/CompareWidget2/assets/css/attrComparePanel/attrComparePanel.css"],(function(e,t,i,n,o,r,s,a,l,u,c,d,p){const h="#ff8a2e",_="#009ddb";return i.extend({init:function(e,t,i){this._parent(),this.device=u.getDeviceType(),this._colorLeft=null!=i&&i.colorLeft?i.colorLeft:h,this._colorRight=null!=i&&i.colorRight?i.colorRight:_,this._plugSvcs=t,this.buildSkeleton(e),this.showDiffOnly=!1,this.toClear=[],this.currentDisplayMode=""},getLabel:function(){return"undefined_TITLE"},getName:function(){return"undefined_VIEW"},getDomId:function(){return"undefined_ID"},isTitleAttr:function(e){return c.isTitleAttr(e,!1)},generateId:function(e){return"viewSettings."+this.getName()+"."+e},buildSkeleton:function(t){this.singleColView=!1,this.elements.container=t;var i=this.getToolbarItems(),n=i.find((e=>e.id.indexOf("showOnlyDifferences")>0));n&&l.sync(n.dataElements,n.id,"value",null),this.standardToolbar=new a(t,this,{navigateDifferences:!1,showCompareLegend:!1,otherMenuItems:i}),this.dataGridViewContainer=e.createElement("div",{styles:{flex:"1",position:"relative","border-top":"1px solid #f4f5f6"},id:"ATTR_DISPLAY_CONTAINER"}).inject(this.elements.container)},getToolbarItems:function(){return[this.getShowOnlyDifferencesItem(),this.getChooseAttributesToDisplayItem()]},getShowOnlyDifferencesItem:function(){var e=this;return{id:this.generateId("showOnlyDifferences"),dataElements:{typeRepresentation:"independantBoolean",priority:3,domId:"compare-"+this.getDomId()+"-diffs-only",label:d.attrShowDiffOnly,tooltipInfos:c.generateTooltip("CompareWidget2/Tooltips","attrShowDiffOnly"),position:"near"},onNodeUpdate:function(t){e.showDiffOnlyClicked(t)}}},getChooseAttributesToDisplayItem:function(){return{id:this.generateId("chooseAttributesToDisplay"),dataElements:{typeRepresentation:"functionIcon",priority:10,domId:"compare-"+this.getDomId()+"-to-display",tooltip:c.generateTooltip("CompareWidget2/Tooltips","selectPropertiesToDisplay"),icon:{iconName:"attributes-cog",fontIconFamily:1},position:"far",value:this.customizeRows.bind(this)}}},showDiffOnlyClicked:function(e){this.showDiffOnly=e.options.grid.data,this.update()},destroy:function(){this.elements.container=null,this.dataGridViewContainer=null},showResults:function(e){var t=this;return new Promise((function(i,n){var o=!1;t.compareResult=e,t.names=[];for(let i=0;i<e.length;i++)t.names.push(e[i].name),e[i].valuesRight.length>0&&(o=!0);var r=!0;this.comparedWithObjects=e[0].valuesRight.length,this.comparedWithObjects>1&&(r=!1),t.standardToolbar.update({showHideCommands:[{id:t.generateId("showOnlyDifferences"),visibleFlag:o},{id:"attrViewSelector",visibleFlag:r}]}),i(!0)}))},isDiff:function(e){let t=e.valuesRight;if(!t.length)return!0;if(e.valueLeft||t.some((e=>e)))for(let i=0;i<t.length;i++)if(e.valueLeft!=t[i])return!0;return!1},filterOutNoDiff:function(e){let t=[];for(let i=0;i<e.length;i++){let n=e[i];this.isDiff(n)&&t.push(n)}return t},filterOutPropertiesToHide:function(e){var t=[];for(let i=0;i<this.compareResult.length;i++){let n=this.compareResult[i];-1==e.indexOf(n.name)&&(this.isTitleAttr(n)?t.unshift(n):t.push(n))}var i=t.findIndex((e=>"thumbnailimage"===e.name));if(-1!=i&&0!=i){t.unshift(t[i]);var n=i+1;t.splice(n,1)}return t},getAttributeDisplayOptions:function(){let e=l.get(this.generateId("attributes_not_shown"));this.defaultAttrs=l.get(this.generateId("default_attributes"));try{this.propsToHide=null!=e?t.decode(e):[]}catch(t){e.constructor===String&&(this.propsToHide="__showall__"===e?[]:""===e?["__showDefault__"]:e.split(","))}},getPropsToHide:function(e){return null!=this.propsToHide&&this.propsToHide.length?1===this.propsToHide.length&&"__showDefault__"===this.propsToHide[0]?e.reduce(((e,t)=>(null!=this.defaultAttrs&&-1===this.defaultAttrs.indexOf(t.name)&&!this.isTitleAttr(t)&&e.push(t.name),e)),[]):[...this.propsToHide]:[]},showDefaultPropsOnly:function(){return 1===this.propsToHide.length&&"__showDefault__"===this.propsToHide[0]},showAllProps:function(){return 0===this.propsToHide.length},savePropsDisplayOptions:function(e){this.propsToHide=e,this.saveAttributeSettings()},update:function(){var e=this;if(Array.isArray(e.compareResult))if(this.compareTwo=e.compareResult.length&&1===e.compareResult[0].valuesRight.length,null==this.currentDisplayMode||""===this.currentDisplayMode)e.onResize();else{e.getAttributeDisplayOptions();var t=e.filterOutPropertiesToHide(e.getPropsToHide(e.compareResult));e.showDiffOnly&&(t=e.filterOutNoDiff(t)),e.clearView(),e.buildDataGridView(t,this.currentDisplayMode),e.elements.dataGridView.inject(e.dataGridViewContainer)}return!0},clearView:function(){null!=this.elements.dataGridView&&(this.clear(this.elements.dataGridView),this.dataGridViewContainer.empty())},clear:function(e){var t=this;null!=e&&(t.toClear.push(e),setTimeout((function(){for(var e=t.toClear.length,i=0;i<e;i++)try{null!=t.toClear[i]&&(t.toClear[i].destroy(),t.toClear[i]=null)}catch(e){t._plugSvcs.errout("Exception while clearing panels: '"+e+", continuing...")}t.toClear=[]}),0))},createColumnOptions:function(e){var t=this,i={width:"auto",onCellRequest:function(e){t.onCellRequest(e,this)}};for(var n in e)i[n]=e[n];return i},buildViewModel:function(e){let t=this,i=[],n=e.length>0?e[0].valuesRight.length:0;for(let o=0,r=e.length;o<r;o++){let r=e[o],s={title:r.displayName,left:{value:r.valueLeft,COLOR:1===n&&!0===r.highlightRight[0]?t._colorLeft:""},right:r.valuesRight.map(((e,i)=>({value:e,COLOR:1===n&&!0===r.highlightRight[0]?t._colorRight:"",highlightRightText:n>1&&!0===r.highlightRight[i]}))),data:{isThumbnail:"thumbnailimage"===r.name}};n>0&&0===r.valuesRight.length&&(s.left.COLOR=t._colorLeft,s.right.push({COLOR:t._colorRight})),i.push(s)}return i},buildDataGridView:function(t,i){let n,a=this,l=t.length>0?t[0].valuesRight.length:0,u=a.buildViewModel(t),c=new o;switch(i){case"threeColumn":for(let t=0,i=u.length;t<i;t++){let i=u[t],n={label:i.title,grid:{left:i.left.value,COLOR_LEFT:i.left.COLOR},data:e.extend(i.data,{family:t,titleColumnID:0})};for(let e=0;e<l;e++)n.grid["right_"+e.toString()]=i.right[e].value,1===l?n.grid.COLOR_RIGHT=i.right[0].COLOR:l>1&&(n.grid["highlightRightText_"+e.toString()]=i.right[e].highlightRightText);c.addChild(new r(n))}n=[this.createColumnOptions({dataIndex:"tree"}),...this.compareTwo?[this.createColumnOptions({dataIndex:"COLOR_LEFT",width:8.5,minWidth:8.5,typeRepresentation:"color"})]:[],this.createColumnOptions({dataIndex:"left",typeRepresentation:"textBlock",autoRowHeightFlag:!0}),...this.compareTwo?[this.createColumnOptions({dataIndex:"COLOR_RIGHT",width:8.5,minWidth:8.5,typeRepresentation:"color"})]:[]];for(var g=0;g<l;g++)n.push(this.createColumnOptions({dataIndex:"right_"+g,typeRepresentation:"textBlock",autoRowHeightFlag:!0}));n.forEach((e=>e.getCellClassName=this._getCellClassName));break;case"twoColumn":for(let t=0,i=u.length;t<i;t++){let i=u[t];c.addChild(new r({grid:{left:i.title,COLOR_LEFT:"",COLOR_RIGHT:""},data:{family:t,titleColumnID:1===l?2:0}}));let n={grid:{left:i.left.value,COLOR_LEFT:i.left.COLOR},data:e.extend(i.data,{family:t})};e.extend(n.grid,i.right.reduce(((e,t,o)=>(e["right_"+o.toString()]=t.value,1===l?e.COLOR_RIGHT=i.right[0].COLOR:l>1&&(n.grid["highlightRightText_"+o.toString()]=i.right[o].highlightRightText),e)),{})),c.addChild(new r(n))}n=[...this.compareTwo?[this.createColumnOptions({dataIndex:"tree",width:3,minWidth:3}),this.createColumnOptions({dataIndex:"COLOR_LEFT",width:8.5,minWidth:8.5,typeRepresentation:"color"})]:[],this.createColumnOptions({dataIndex:"left",typeRepresentation:"textBlock",autoRowHeightFlag:!0}),...this.compareTwo?[this.createColumnOptions({dataIndex:"COLOR_RIGHT",width:8.5,minWidth:8.5,typeRepresentation:"color"})]:[]];for(g=0;g<l;g++){var f={dataIndex:"right_"+g,typeRepresentation:"textBlock",autoRowHeightFlag:!0};n.push(this.createColumnOptions(f))}n.forEach((e=>e.getCellClassName=this._getCellClassName));break;case"oneColumn":for(let t=0,i=u.length;t<i;t++){let i=u[t];c.addChild(new r({grid:{left:i.title,COLOR:""},data:{family:t,titleColumnID:1===l?2:0}})),c.addChild(new r({grid:{left:i.left.value,COLOR:i.left.COLOR},data:e.extend(i.data,{family:t})})),l>0&&i.left.COLOR!==i.right[0].COLOR&&c.addChild(new r({grid:{left:i.right[0].value,COLOR:i.right[0].COLOR},data:e.extend(i.data,{family:t})}))}n=[...this.compareTwo?[this.createColumnOptions({dataIndex:"tree",width:3,minWidth:3}),this.createColumnOptions({dataIndex:"COLOR",width:8.5,minWidth:8.5,typeRepresentation:"color"})]:[],this.createColumnOptions({dataIndex:"left",typeRepresentation:"textBlock",autoRowHeightFlag:!0})],n.forEach((e=>e.getCellClassName=this._getCellClassName))}var S=e.createElement("span",{class:"attr-table-no-diffs-found",html:p.NO_DIFFERENCES_FOUND});this.elements.dataGridView=new s({identifier:"ComparePropertyView",treeDocument:c,columns:n,rowSelection:"single",cellSelection:"none",columnSelection:"none",defaultColumnDef:{minWidth:8.5},placeholder:S,getCellTooltip:function(e){var t=e.cellModel;return{title:(t===h?d.mainToolbarLeftObjectString:t===_?d.mainToolbarRightObjectString:"")||"",updateModel:!1}}}),this.elements.dataGridView.registerReusableCellContent({id:"renderThumbnail",buildContent:function(){return new e.Element("img").inject(new e.Element("div",{class:"thumbnail-div"}))}}),this.elements.dataGridView.showCellActivationFlag=!1,this.elements.dataGridView.layout.columnsHeader=!1,this.elements.dataGridView.layout.rowsHeader=!1,this.elements.dataGridView.layout.useLastColumnWidthAutoFlag=!0,this.elements.dataGridView.layout.getRowHeightFunction=function(e){let t=a.elements.dataGridView.layout.getRowHeightFromCellContents(e);return!0===c.getNthRoot(e).options.data.isThumbnail?75:t}},_getCellClassName:function(e){var t;t=e.nodeModel.options.data.family%2==0||e.nodeModel.options.grid.family%2==0?"compareGreyRow":"compareWhiteRow";var i=e.nodeModel.options.data.titleColumnID;return null!=i&&e.columnID===i&&(t+=" compare-attr-title-cell"),t},onCellRequest:function(e,t){t.defaultOnCellRequest(e),!0===e.nodeModel.options.data.isThumbnail&&null!=e.cellModel&&(e.cellModel.indexOf("http://")>=0||e.cellModel.indexOf("https://")>=0||e.cellModel.indexOf("data:image")>=0)?this.renderThumbnail(e,t):this.renderCellTextColor(e,this.currentDisplayMode,t)},renderThumbnail:function(e,t){let i=t.reuseCellContent("renderThumbnail");i.setAttribute("src",e.cellModel),e.cellView.setReusableContent(i.getParent())},renderCellTextColor:function(e,t,i){if(!this.compareTwo&&"oneColumn"!==t){let t=i.getColumnOrGroup(e.columnID);t.dataIndex.indexOf("right_")>=0&&!0===e.nodeModel.options.grid["highlightRightText_"+t.dataIndex.split("_")[1]]?e.cellView.elements.container.style.color="red":e.cellView.elements.container.style.color=""}},customizeRows:function(){new n(this,{ResetButton:!0,AllText:d.displayAllProperties},function(){this.update()}.bind(this))},saveAttributeSettings:function(){l.set(this.generateId("attributes_not_shown"),t.encode(this.propsToHide))},_displayMenu:function(e,t){var i=this;require(["DS/Menu/Menu"],(n=>{var o=t.getBoundingClientRect(),r={position:{x:o.right,y:o.bottom},layout:"topright",input:i.isTouch?"touch":"mouse"};n.show(e,r)}))},handleToolbarCommands:function(e){if("displayView"===e.event)this._displayMode!==e.data.mode&&("singleColDisplay"===e.data.mode?this.singleColView=!0:this.singleColView=!1,this.update(),this.standardToolbar.update({displayIcon:[{id:"attrViewSelector",icon:e.data.icon}]}),this._displayMode=e.data.mode)},onResize:function(){setTimeout((()=>{let e=this.elements&&this.elements.container?this.elements.container.getBoundingClientRect().width:0;if(e<100)return;let t="";t=e>640?"threeColumn":e>=320&&e<=640?"twoColumn":"boolean"==typeof this.compareTwo?!0===this.compareTwo?"oneColumn":"twoColumn":"",this.currentDisplayMode!==t&&(this.currentDisplayMode=t,this.update())}),0)},onActivate:function(){this.onResize()}})})),define("DS/CompareWidget2/plugins/STRUCTURE/flexibleView/ViewPanel/flagDisplayData",["i18n!DS/CompareWidget2/assets/nls/CompareV2","DS/CompareWidget2/plugins/STRUCTURE/flexibleView/ViewPanel/flagDisplayDataItem"],(function(e,t){var i=function(e){this._flagDisplayDataMap=this.buildFlagDisplayData(e)};return i.prototype.buildFlagDisplayData=function(i){var n={};return["SYSTEM_RULE_ID_FLAGS","CUSTOM_RULE_ID_FLAGS","CUSTOM_MATCH_ADJ_FLAGS","BUBBLE_FLAGS","ADDITIONAL_STATUS_FLAGS"].forEach((function(o){var r=i[o];null!=r&&Object.keys(r).forEach((function(r){var s=i[o][r].NLS_RESOLVED;if(null==s){var a=i[o][r].NLS;null!=(s=e[a])&&0!=s.length||(s=a)}n[r]=new t(i,r,s,o)}))})),n},i.prototype.reset=function(){var e=this;Object.keys(this._flagDisplayDataMap).forEach((function(t){e._flagDisplayDataMap[t].reset()}))},i.prototype.attachMatchedPairs=function(){},i.prototype.updateFlagDisplayData=function(e){var t=this,i=0,n=e[0]._trueRoot.getAllDescendants();t.reset();for(var o=n.length,r=0;r<o;r++){let e=n[r].__MATCH_PAIR__;if(null!=e){var s=!0===e.qtyIsDiffFlag,a=e.getAllStatusArray(!0)||[],l=a.length,u=l+(s?1:0);u>i&&(i=u);for(var c=0;c<l;c++){var d=a[c];if(null==d||""==d)continue;this.getFlagDisplayDataItem(d).matchedPairs.push(e)}if(s){this.getFlagDisplayDataItem("QUANTITY").matchedPairs.push(e)}}}t.getFlagDisplayDataItem("IDENTICAL"),this._maxFlagsPerEntry=i,t.resetTypeFiltersOn(),t.setVizNoViz([])},i.prototype.resetTypeFiltersOn=function(){let e=this;Object.keys(this._flagDisplayDataMap).forEach((function(t){e._flagDisplayDataMap[t].checked=!0}))},i.prototype.setVizNoViz=function(e){let t=this,i=!1;for(var n=Object.keys(this._flagDisplayDataMap),o=0;o<n.length;o++){let e=n[o],t=this._flagDisplayDataMap[e];t.matchedPairs.length>0?t.visibleFlag=!0:t.visibleFlag=!1}e.forEach((function(e){1==t._flagDisplayDataMap[e].visibleFlag&&(i=!0),t._flagDisplayDataMap[e].visibleFlag=!1}));let r=this._flagDisplayDataMap.IDENTICAL;r&&0==r.visibleFlag&&(r.matchedPairs.length>0||1==i)&&(r.visibleFlag=!0)},i.prototype.getFlagDisplayData_excludeFilteredByTypeAttr=function(){var e=this._flagDisplayDataMap,t={};return Object.keys(e).forEach((function(i){for(var n=e[i],o=n.matchedPairs,r=!1,s=0;s<o.length;s++){if(0==o[s].getIsHidden_byTypeAttr()){r=!0;break}}r&&(t[i]=n)})),t.IDENTICAL=e.IDENTICAL,t},i.prototype.getMaxFlagsPerEntry=function(){return this._maxFlagsPerEntry},i.prototype.getFlagDisplayDataItem=function(e){this._flagDisplayDataMap=this._flagDisplayDataMap||{};var i=this._flagDisplayDataMap;return null!=e&&null==(i=i[e])&&(this._flagDisplayDataMap[e]=new t(null,e,e,null),i=this._flagDisplayDataMap[e]),i},i.prototype.getFDDItem_lut=function(){var e=this;this._flagDisplayDataMap=this._flagDisplayDataMap||{};var t={};return Object.keys(this._flagDisplayDataMap).forEach((function(i){var n=e._flagDisplayDataMap[i],o=n.id;t[o]=n})),t},i.prototype.getFDDItemArray_active=function(){var e=this;this._flagDisplayDataMap=this._flagDisplayDataMap||{};var t=[];return Object.keys(this._flagDisplayDataMap).forEach((function(i){var n=e._flagDisplayDataMap[i];n.matchedPairs.length>0&&t.push(n)})),t},i.prototype.getStatusONOFF=function(){var e=[],t=[],i=this._flagDisplayDataMap.IDENTICAL.checked,n=Object.keys(this._flagDisplayDataMap);let o=this;return n.forEach((function(n){var r=o._flagDisplayDataMap[n];0==r.checked||0==i&&0==r.visibleFlag?e.push(n):t.push(n)})),{offFlags:e,onFlags:t}},i})),define("DS/CompareWidget2/framework/CPF_configMgr",["UWA/Class","DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/support/DataCenter","DS/CompareWidget2/support/cw2CacheMgr"],(function(e,t,i,n){function o(e,t,n){return i.makeAuthHttpsCall("/resources/compare2/SelectViewSet/","POST",n,"json",t,e,n.securityContext)}function r(e){return new Promise((function(i,r){var s=t.stringify(e);let a=n.getCacheObj("viewSetCache",s);if(null!=a){let e=a[0];i(e)}else{(function(e,i,n){return new Promise((function(r,s){var a=t.getCurrentTenant();o(e,a,n).then((function(s){var l=s;t.dbgout("INIT","<><> ---\x3e Eval from service "+e+" is "+JSON.stringify(l)),e==i?r(l):o(i,a,n).then((function(e){var n=e;t.dbgout("INIT","<><> ---\x3e Eval from service "+i+" is "+JSON.stringify(n));var o=null;o=l.eval<n.eval?l:n,t.dbgout("INIT","<><> ---\x3e Best is: "+JSON.stringify(o)),r(o)}),(function(e){t.dbgout("INIT","<><> ---\x3e using: "+JSON.stringify(l)),r(l)}))}),(function(t){e==i?s("failed to find appropriate viewDef: "+t):o(serviceName2,a,n).then((function(e){r(e)}),(function(e){s("failed to find appropriate viewDef on either service... giving up ("+e+")")}))}))}))})("3DSpace","3DSpace",e).then((function(e){if(null!=e&&(null==e.errors||null!=e.errors.length||0==e.errors.length)&&null!=e.results&&null!=e.results.length&&e.results.length>0){let t=e.results;n.putCacheObj("viewSetCache",s,t);let o=t[0];i(o)}else r(e||{errors:["NO ERRORS RETURNED"]})}),(function(e){t.errout("Failure:: "+e),r(e)}))}}))}function s(e,t,i){(function(e){let t=[];function i(e){Object.values(e).forEach((e=>{(e.constructor!==Array?[e]:e).forEach((e=>{e.constructor===String?t.push(e):e.constructor===Array?e.forEach((e=>{e.constructor===String&&t.push(e)})):null!=e&&i(e)}))}))}return i(e),t})(t).forEach((t=>{if(null==e.VIEWDEFS[t])throw Error("extractViewDefs: View def for "+t+" not found");i[t]=e.VIEWDEFS[t]}))}function a(e,i,n,o,r,a){var l=o.VIEWSETS[n],u={};if(!function e(t,i){let n=1===Object.keys(t).length&&(null==i&&("ROW"===Object.keys(t)[0].toUpperCase()||"COL"===Object.keys(t)[0].toUpperCase())||"ROW"===i&&"COL"===Object.keys(t)[0].toUpperCase()||"COL"===i&&"ROW"===Object.keys(t)[0].toUpperCase());for(let[i,o]of Object.entries(t))n=n&&(o.constructor!==Array?[o]:o).every((t=>t.constructor===String||t.constructor===Array&&t.every((e=>e.constructor===String))||null!=t&&t.constructor!==Array&&t.constructor!==String&&e(t,i)));return n}(l))throw Error("The view set is not properly defined. Please check...");s(o,l,u);var c=u,d=function(e,i){var n={};return Object.keys(i).forEach((function(o){i[o].forEach((function(i){var o=e.PLUGDEFS[i],r={Path:t.dupeJson(o.Path)};null!=o.Options&&(r.Options=t.dupeJson(o.Options)),n[i]=r}))})),n}(o,c);return{FRAMEWORK_OPTIONS:o.FRAMEWORK_OPTIONS||o.RUN_OPTIONS,runOptions:e,viewDefModPath:i,viewSetName:n,VIEWSET:l,VIEWDEFS:c,PLUGDEFS:d,mainToolbarConfigPath:r,mainToolbarOptions:a||[]}}return e.singleton({init:function(){this._currentViewConfig={},this._pluginSettings={}},loadConfig_byPathAndName:function(e,i,n,o,r){let s=this;return new Promise((function(l,u){require([i],(function(c){vdmPromise=c instanceof Promise?c:Promise.resolve(c),vdmPromise.then((u=>{t.dbgout("INIT","Successfully loaded viewSet '"+n+"' from module '"+i+"'"),s._currentViewConfig=a(e,i,n,u,o,r),s._pluginSettings={},l(s._currentViewConfig)}),(()=>{t.errout("FAILED to load viewDefMod '"+i+"'"),u("LOAD FAILURE")}))}),(function(e){t.errout("FAILED to load viewDefMod '"+i+"'"),u("LOAD FAILURE")}))}))},loadConfig_byUseCase:function(e,i){var n=this;return new Promise((function(o,s){r(i).then((function(i){let r=i;var a=r.viewSetMod,l=r.viewSetName;let u=e.MainToolbarConfig||r.mainToolbarConfig;var c=u[0].Location,d=u[0].DoNotInclude;t.dbgout("INIT","<><> BEST viewSet for usecase is: '"+l+"' from viewDefModule '"+a+"'"),n.loadConfig_byPathAndName(e,a,l,c,d).then((function(e){o(e)}),(function(e){t.errout("Cannot return viewConfigFailure loading fetching viewSet:: "+e),s(e)}))}),(function(e){s(e)}))}))},getCurrentViewConfig:function(){return this._currentViewConfig},getCurrentViewSetID:function(){ret="UNKNOWN";try{ret=this._currentViewConfig.viewDefModPath+"_"+this._currentViewConfig.viewSetName}catch(e){t.warnout("INIT","Failed to retrieve current view config ID; returning 'UNKNOWN'")}return ret},getPluginOptions:function(e){let t=null;try{t=this._currentViewConfig.PLUGDEFS[e].Options}catch(t){console.error("Failure retrieving plugin options for:'"+e+"'; "+t)}return t},setPluginSetting:function(e,t){this._pluginSettings[e]=t},getPluginSetting:function(e){return this._pluginSettings[e]},getRunOptions:function(){return this._currentViewConfig.runOptions}})})),define("DS/CompareWidget2/plugins/DATA/attrValObj",["DS/CompareWidget2/support/cw2Utils"],(function(e){function t(e){var t=void 0!==e.selectable?e.selectable:e.name;return"timestamp"===e.type||"modified"===t||"originated"===t||-1!==t.indexOf("ds6w:created")||-1!==t.indexOf("ds6w:modified")}var i=function(e,t,i,n,o,r){this.name=e,this.nls=t,this.value=i,this.type=n,this.UIPosition=o,this.multivalued=!0===r,this._reqModforODT="DS/CompareWidget2/plugins/DATA/attrValObj"};return i.prototype.getFormattedValue=function(){var i=this,n="";if(null!=i.value){if(i.value.constructor==Array)if(i.value.length>1)for(var o=0;o<i.value.length;++o){n+=t(i)&&!widget._isODTMode()?e.formatDate(i.value[o]):i.value[o],o!==i.value.length-1&&(n+=", ")}else n=t(i)&&!widget._isODTMode()?e.formatDate(i.value[0]):i.value[0];else n=t(i)&&!widget._isODTMode()?e.formatDate(i.value):i.value;var r=i.dimension;null!=r&&(n+=" "+r)}return n},i})),define("DS/CompareWidget2/plugins/STRUCTURE/STRUCT_AGG_plugin",["DS/CompareWidget2/plugins/plugin"],(function(e,t){return e.extend({init:function(e,t,i,n){this._parent(e,t,i,n)},doAdjust:function(e,t,i){return new Promise((function(t,i){t(e)}))},doAugment:function(e,t,i){return new Promise((function(t,i){t(e)}))},doAggregate:function(e,t,i){return new Promise((function(t,i){t(e)}))},execute:function(e,t){var i=this;i._parent(e,t);var n=[];e.forEach((function(e){let t=e.makeDupe();n.push(t)})),i.doAdjust(n,t,this._plugSvcs).then((e=>i.doAugment(e,t,this._plugSvcs).then((e=>i.doAggregate(e,t,this._plugSvcs).then((e=>i.reportOK(e))))))).catch((e=>i.reportKO("FAILURE performing ADJ, AGG, or ADD: "+e)))}})})),define("DS/CompareWidget2/implementations/costing/SG_AGG_COSTING_plugin",["DS/CompareWidget2/plugins/STRUCTURE/STRUCT_AGG_plugin","i18n!DS/CompareWidget2/assets/nls/implementations/costing/Costing"],(function(e,t){"use strict";const i={DISPLAY_GROUP_ICON:{iconName:"chart-map-heat",iconFonFamily:"WUXManagedFontIcons.Font3DS"},DISPLAY_CONFIG_ICON:{iconName:"configuration",iconFontFamily:"WUXManagedFontIcons.Font3DS"},REF_ICON:{iconName:"product",iconFontFamily:"WUXManagedFontIcons.Font3DS"},INST_ICON:{iconName:"flow-cascade",iconFontFamily:"WUXManagedFontIcons.Font3DS"}},n=[{groupName:"rawMaterialCost",NLS_resolved:t.RAW_MATERIAL_COST,icon:null,displayProps:[{propName:"rawMat_budget",icon:i.REF_ICON,NLS_resolved:t.BUDGET},{propName:"rawMat_objective",icon:i.REF_ICON,NLS_resolved:t.OBJECTIVE},{propName:"rawMat_value",icon:i.REF_ICON,NLS_resolved:t.VALUE},{propName:"rawMat_RD",icon:i.REF_ICON,NLS_resolved:t.R_AND_D}]},{groupName:"fixedCost",NLS_resolved:t.FIXED_COST,icon:null,displayProps:[{propName:"fixed_budget",icon:i.INST_ICON,NLS_resolved:t.BUDGET},{propName:"fixed_objective",icon:i.INST_ICON,NLS_resolved:t.OBJECTIVE},{propName:"fixed_value",icon:i.INST_ICON,NLS_resolved:t.VALUE},{propName:"fixed_RD",icon:i.INST_ICON,NLS_resolved:t.R_AND_D}]}];return e.extend({_generateSGDisplayConfig:function(e){return{propDisplayGroups:this._genPropDisplayGroups(),treeDisplayLabels:this._genTreeDisplayLabels(e),initialPropDisplayGroupName:"fixedCost"}},_genPropDisplayGroups:function(){return n},_genTreeDisplayLabels:function(e){let t=[];return e.forEach((function(e){let i=e.getRoot().getAttr("REF.ds6w:label");t.push({name:i,icon:null})})),t},_saveSGDisplayConfig:function(e){this._plugSvcs.setPluginSetting("SG_DISPLAY_CONFIG",e)},populateData:function(e){let t=[{name:"rawMat_budget",value:10},{name:"rawMat_objective",value:20},{name:"rawMat_value",value:30},{name:"rawMat_RD",value:40},{name:"fixed_budget",value:11},{name:"fixed_objective",value:21},{name:"fixed_value",value:31},{name:"fixed_RD",value:41}];for(var i=0;i<e.length;i++){let n=e[i];n.getRoot().setSynthProp("displayLabel","CONFIG i"),n.visit_riTreeAndFN((function(e){return t.forEach((function(t){let n=t.value;i>1&&Math.random()<.25&&(n+=1),e.setSynthProp(t.name,"$"+n+".00")})),!0}))}},doAdjust:function(e,t,i){let n=this;return new Promise((function(t,i){let o=n._generateSGDisplayConfig(e);n._saveSGDisplayConfig(o),t(e)}))},doAugment:function(e,t,i){let n=this;return e.forEach((function(e){e.assignLevelToAllNodes()})),new Promise((function(t,i){n.populateData(e),t(e)}))},doAggregate:function(e,t,i){return this._parent(e,t,i)}})})),define("DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/treeBuilder",["DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_tree","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_node","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/dbObj"],(function(e,t,i){var n=function(e,t){this._objIDSpec=e,this._dbObjArray=[],this._dbObjByPhysicalID={},this._plugSvcs=t,this._pathArrayArray=[],this._typeIconsArrayArray=[]};return n.prototype.build_dbObj=function(e,t){var n=new i;Object.keys(e).forEach((function(i){var o=e[i];"bo.plmreference.v_derivedfrom"==i&&(i="dfr_bootstrapID"),"Matrixtxt"==i&&(i="matrixtxt"),"matrixtxt"==i&&"1,0,0,0,1,0,0,0,1,0,0,0"==o&&(o="1.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0"),"resourceid"==i&&(i="physicalid"),o="string"==typeof o&&o.length&&Array.isArray(t)&&t.length&&-1!==t.indexOf(i)?o.split(",").sort().join(","):o,n.addAttr(i,o)}));var o={smallURL:e.icon,largeURL:e.thumbnail_2d};return n.addAttr("typeIcons",o),n},n.prototype.add_dbObj=function(e){var t=!0;return null==this._dbObjByPhysicalID[e.getAttr("physicalid")]?(this._dbObjByPhysicalID[e.getAttr("physicalid")]=e,this._dbObjArray.push(e)):(this._plugSvcs.errout("new node already in tree (byPhysID)"),t=!1),t},n.prototype.add_path=function(e){null==e||0==e.length?this._plugSvcs.errout("Attempt to add null or empty path to tree"):e.length%2!=1?this._plugSvcs.errout("Invalid path; contains even number of entries (count *must* be odd)"):this._pathArrayArray.push(e)},n.prototype.add_typeIcons=function(e){this._typeIconsArrayArray.push(e)},n.prototype._isTreeNodeRefInstID=function(e,t,i){var n=!1;e.getAttr("REF.physicalid")==t&&(e.getAttr("INST.physicalid")==i&&(n=!0));return n},n.prototype.buildTree=function(){var t=this,i=new e(this._objIDSpec);try{t._pathArrayArray.forEach((function(e){var n=e.length,o=0,r=i.getRoot(),s=null,a=0,l=e[0],u=null,c=null;if(null!=r&&t._isTreeNodeRefInstID(r,l,u)){for(c=r,a=1,o=1;o<n;o+=2){u=e[o],l=e[o+1];for(var d=r.getChildArray(),p=d.length,h=!1,_=0;_<p;_++){var g=d[_];if(t._isTreeNodeRefInstID(g,l,u)){h=!0,c=g,r=g;break}}if(0==h)break}s=c,a=o}for(o=a;o<n;){var f=0==o;u=f?null:e[o++],l=e[o++];var S=t._get_dbObjByPhysicalID(l),m=null;0==f&&(m=t._get_dbObjByPhysicalID(u));var C=t._createRefInstNode(S,m,f);f?i.setRoot(C):(s.addChild(C),C.setParent(s)),s=C}}))}catch(e){this._plugSvcs.errout("Failure building riTree (from paths): "+e),i=null}return i},n.prototype._createRefInstNode=function(e,i,n){return new t(e,i)},n.prototype._get_dbObjByPhysicalID=function(e){return this._dbObjByPhysicalID[e]},n})),define("DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/treeBuilderWithBSD",["DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/treeBuilder","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_tree","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_node","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/dbObj"],(function(e,t,i,n){return class extends e{constructor(e,t){super(e,t)}buildTree(e,n,o){const r=new t(this._objIDSpec);n&&r.setDataSource(n);try{this._pathArrayArray.forEach((t=>{const n=t.length;let s=r.getRoot(),a=null,l=null,u=0,c=t[0],d=null,p=null,h=this.getBSDNodeLabelList(e.results);const _=e.results[0].predicatename;if(s&&this._isTreeNodeRefInstID(s,c,d)){p=s,u=1;for(var g=1;g<n;g+=2){d=t[g],c=t[g+1];const e=this._get_dbObjByPhysicalID(d);if(this.isBSDPresent(e,_)){let t=r.getRoot(),i=e.getAttr(`ds6w:${_}`),n=h.get(i),o=t.findBSDNode(n.physicalId);if(!o)break;{let e=!1;const t=o.getChildArray(),i=t.length;l=o;for(let n=0;n<i;n++){const i=t[n];if(this._isTreeNodeRefInstID(i,c,d)){e=!0,p=i,s=i;break}}if(!e)break}}else{const e=s.getChildArray(),t=e.length;let i=!1;for(let n=0;n<t;n++){const t=e[n];if(this._isTreeNodeRefInstID(t,c,d)){i=!0,p=t,s=t;break}}if(!i)break}}a=p,u=g}for(g=u;g<n;){const e=0===g;d=e?null:t[g++],c=t[g++];const n=this._get_dbObjByPhysicalID(c);let s=null,l=null;if(e||(s=this._get_dbObjByPhysicalID(d)),e)l=new i(n,s),l.setBSDRefInstTreeSkelToRoot(o),r.setRoot(l);else{if(this.isBSDPresent(s,_)){let e=r.getRoot(),t=s.getAttr(`ds6w:${_}`),o=h.get(t),a=e.findBSDNode(o.physicalId),u=e.getAttr("REF.physicalid"),c=s.getAttr("from");if(u!==c){if(a){let e=a.getParent(),t=e.getAttr("REF.ds6w:type"),i=a.getChildArray();"Term"===t&&0===i.length&&e.removeIntermediateBSDChild(o.physicalId)}let t=e.findBSDNode(c);l=new i(n,s),t.addChild(l),l.setParent(t)}else a&&(l=new i(n,s),a.addChild(l),l.setParent(a))}else l=new i(n,s),a.addChild(l),l.setParent(a)}a=l}}))}catch(e){return this._plugSvcs.errout("Failure building riTree (from paths): "+e),null}return r}isBSDPresent(e,t){return Boolean(e.getAttr(`ds6w:${t}`))}createdbObj(e){const t=new n;Object.keys(e).forEach((i=>{"resourceid"==i&&(i="physicalid"),t.addAttr(i,e["physicalid"===i?"resourceid":i])}));var i={smallURL:e.icon,largeURL:e.thumbnail_2d};return t.addAttr("typeIcons",i),t}findBSDNode(e,t){for(let i=0;i<e.length;i++){let n=e[i];if(n.resourceid===t)return n}}getBSDNodeLabelList(e){let t=new Map;for(let i=e.length-1;i>=0;i--){let n=e[i];if(null!=n.Path){let i=n.Path,o="";for(let n=2;n<i.length;n+=2){let r=this.findBSDNode(e,i[n])["ds6w:label"];o=""!==o?o.concat("/",r):r,t.has(o)||t.set(o,{bsdLabel:r,physicalId:i[n]})}}}return t}}})),define("DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/treeBuilderWithPGP",["DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/treeBuilder"],(function(e){return class extends e{constructor(e,t){super(e,t)}buildTree(e){return this.pgpHidePathArray=e,super.buildTree()}_createRefInstNode(e,t,i){let n=i?e:t;if(n.setAttr("pgp_show",null),"FALSE"===n.getAttr("ro.PGPShowExtension.V_PGP_Show")&&n.setAttr("pgp_show","FALSE"),Array.isArray(this.pgpHidePathArray)&&this.pgpHidePathArray.length)for(let i=0;i<this.pgpHidePathArray.length;i++){let o=this.pgpHidePathArray[i],r=o[o.length-1],s=o[o.length-2];e.getAttr("physicalid")===r&&t.getAttr("physicalid")===s&&n.setAttr("pgp_show","FALSE")}return super._createRefInstNode(e,t,i)}}})),define("DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/Overview",["UWA/Controls/Abstract","DS/CompareWidget2/ViewDefModules/DSColors"],(function(e,t){function i(e,i,o,r,s,a){for(var l=s,u=r-o,c=0,d=[],p=0;p<i.length;p++){null==a[i[p].flagName]?console.error("ASKING FOR FLAG NAME: "+i[p].flagName+" but is unfound in allflagDefs"):1==a[i[p].flagName].visibleFlag&&(c++,d.push(p))}for(var h=u/c,_=0;_<c;_++){var g=o+_*h,f=g+h,S=i[d[_]].color;null==a||null==a[i[d[_]].flagName]||a[i[d[_]].flagName].visibleFlag||(S=null!=a.IDENTICAL?a.IDENTICAL.color:""),""!==S&&S!=t.colorDef.WHITE&&n(e,S,g,f,l)}}function n(e,t,i,n,o){e.strokeStyle=t,e.beginPath(),e.moveTo(i,o),e.lineTo(n,o),e.stroke()}function o(e,t){try{let i=null;if(null==this._gridID){i="compare-"+(t?"list":"tree")+"-right"}else i=this._gridID;let n=jQuery("div#"+i+" div.compare_tree_list_view div.wux-layouts-header"),o=0!=n.length&&""!==n.first().attr("empty");e.setStyle("top",o?"118px":"92px");let r="true"===jQuery("div#"+i+" div.compare_tree_list_view div.wux-layouts-gridengine-scroller-container").first().attr("has-overflow-x");e.setStyle("bottom",r?"36px":"17px")}catch(e){}}return e.extend({init:function(e){var t=this;t._parent(e),t.isListView=null!=e?e.isListView:null,t._gridID=null!=e?e.gridID:null;let i=null!=e?e.viewID:null;t._canvasID="compareV2-OverviewCanvas",t._containerID="compareV2-overview-container",null!=i&&(t._canvasID+="_"+e.viewID,t._containerID+="_"+e.viewID),t._gap=5,t._lineLength=23,t._selectedByID={},t._keyList=[],t._allFlagDefs={},t.buildSkeleton()},drawAllLines:function(){var e=this;if(null==e._keyList);else{var o=e._keyList.length,r=10+e._lineLength-12,s=Math.floor(1+.5*e._gap),a=10+e._lineLength-6,l=document.getElementById(e._canvasID);if(null==l)return;var u=l.getContext("2d");u.clearRect(0,0,l.width,l.height),u.lineWidth=l.height/3>o?2:1;for(var c=0;c<o;c++){var d=e._keyList[c].flagDefArray;1==e._selectedByID[c]?(u.lineWidth++,1!=d.length||""!=d[0].color&&d[0].color!=t.colorDef.WHITE?i(u,d,1,a,s,e._allFlagDefs):n(u,t.colorDef.BLACK,1,a,s),u.lineWidth--):i(u,d,10,r,s,e._allFlagDefs),s+=e._gap}}},doResize:function(){var e=this;let t=null;if(null==this._gridID){t="compare-"+(this._isListView?"list":"tree")+"-right"}else t=this._gridID;if(0!=jQuery("div#"+t+" div.compare_tree_list_view div.wux-layouts-header").length>0){var i=jQuery("div#"+this._containerID)[0];if(null!=i){o.call(e,i,e._isListView);var n=i.clientHeight,r=i.clientWidth,s=jQuery("#"+e._canvasID)[0];null!=s&&(s.width=r,s.height=n,0==e._keyList.length||(e._gap=(n-2)/e._keyList.length))}}},buildSkeleton:function(){var e=this;e.targetElement=this.elements.container=UWA.createElement("div",{id:e._containerID,class:"compareV2-overview-container"}),o.call(e,e.targetElement,this._isListView),e.rootElement=UWA.createElement("div",{id:"compareV2-overview-toplevel",html:[{tag:"div",id:"compareV2-overview",html:[{tag:"div",id:"compareV2-canvas-buffer",html:[{tag:"canvas",id:e._canvasID,class:"compareV2-OverviewCanvas"}]}]}]}),e.rootElement.inject(e.targetElement),jQuery(document).ready((function(){var t=null,i=!1;function n(){new Date-t<300?setTimeout(n,300):(i=!1,"none"!==jQuery("#"+e._containerID).css("display")&&e._syncIt(!0))}jQuery(window).resize((function(){t=new Date,!1===i&&(i=!0,setTimeout(n,300))}))}))},onResize:function(){var e=this;setTimeout((function(){e._syncIt(!0)}),0)},destroy:function(e){this.rootElement&&(this.rootElement.destroy(),this.rootElement=null),this._selectedByID=null,this._keyList=null,this._allFlagDefs=null},_createSelectedByID:function(e){var t={};return e.forEach((function(e){t[e]=!0})),t},_syncIt:function(e){1==e&&this.doResize(),this.drawAllLines()},syncWithNewData:function(e,t,i,n,o){this._keyList=t,this._allFlagDefs=n,this._selectedByID=this._createSelectedByID(i),this._isListView=o,this._syncIt(e)}})})),define("DS/CompareWidget2/support/tenantServiceContext_IDList",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/support/objIDSpec"],(function(e,t){return function(){this._data={},this.addObjIDSpec=function(e){var t=e.getTenant(),i=e.getServiceName(),n=e.getSecurityContext(),o=e.getPhysID();null==this._data[t]&&(this._data[t]={}),null==this._data[t][i]&&(this._data[t][i]={}),null==this._data[t][i][n]&&(this._data[t][i][n]=[]),this._data[t][i][n][o]=e.getObjType()},this.visitEach_doFunc=function(e){var t=this;Object.keys(t._data).forEach((function(i){Object.keys(t._data[i]).forEach((function(n){Object.keys(t._data[i][n]).forEach((function(o){Object.keys(t._data[i][n][o]).forEach((function(r){var s=t._data[i][n][o][r];e(i,n,o,r,s)}))}))}))}))},this.getList=function(){var e=[];return this.visitEach_doFunc((function(i,n,o,r,s){var a=new t(r,s,i,n,o);return e.push(a),!0})),e}}})),define("DS/CompareWidget2/ViewDefModules/AxisSystemRef_Options",["UWA/Core","DS/CompareWidget2/ViewDefModules/ViewDefOptions"],(function(e,t){let i=e.clone(t,!0);return i.STRUCT_FETCH_OPTIONS.DATA_SOURCE="CV_PROGRESSIVE",i})),define("DS/CompareWidget2/ViewDefModules/AxisSystemRef_ViewDefs",["UWA/Core","DS/CompareWidget2/ViewDefModules/DefaultViewDefs_V2","DS/CompareWidget2/ViewDefModules/AxisSystemRef_Options"],(function(e,t,i){let n=e.clone(t.PLUGDEFS,!0);return n.StructFetch.Options=i.STRUCT_FETCH_OPTIONS,e.merge({VIEWDEFS:t.VIEWDEFS,VIEWSETS:t.VIEWSETS,PLUGDEFS:n},i)})),define("DS/CompareWidget2/framework/pluginMgr",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/support/DataCenter","DS/CompareWidget2/support/cw2CacheMgr"],(function(e,t,i){function n(t,i,n,o){return new Promise((function(r,s){try{require([t],(function(s){var a=new s(t,i,n,o);a.onLoad(),e.dbgout("INIT","  ... loading plugin OK: "+t),r(a)}),(function(i){e.warnout("Failed to load plugin "+t+":: "+i.message),s(i.message)}))}catch(i){e.warnout("Exception trying to load plugin "+t)}}))}return{getPlugins:function(t,o){return new Promise((function(r,s){e.dbgout("INIT","------------[ L O A D   P L U G I N S     B E G I N ] -----------");var a={},l=[];Object.keys(t).forEach((function(n){var o=t[n].Path,r=t[n].Options,s=i.getCacheObj("pluginCache",n);null==s?l.push({plugName:n,plugPath:o,pluginOptions:r}):(e.dbgout("Plugin "+o+" found in cache; load not required"),a[n]=s)}));var u=l.length;if(e.dbgout("INIT","Must load "+u+" plugins..."),0==u)r(a);else{var c=[];for(let e=0;e<u;e++){var d=l[e].plugPath,p=l[e].plugName,h=l[e].pluginOptions;c.push(n(d,p,h,o))}Promise.allSettled(c).then((function(t){for(let r=0;r<t.length;r++)if("rejected"!==t[r].status&&null!=t[r].value){var n=t[r].value,o=(n.getPath(),n._name);a[o]=n,i.putCacheObj("pluginCache",o,n)}else e.dbgout("INIT","Failed to load plugin: "+l[r]);e.dbgout("INIT","------------[ L O A D   P L U G I N S     E N D    ] -----------"),r(a)}))}}))}}})),define("DS/CompareWidget2/plugins/STRUCTURE/flexibleView/ViewPanel/fvpTrees",["UWA/Controls/Abstract","UWA/Core","DS/DataGridView/DataGridView","DS/CompareWidget2/widget/controls/TreesContainer","DS/CompareWidget2/widget/controls/TreePanel","DS/CompareWidget2/plugins/STRUCTURE/flexibleView/ViewPanel/fvpTreesViewActions","DS/CompareWidget2/support/typeHierMgr","i18n!DS/CompareWidget2/assets/nls/CompareV2"],(function(e,t,i,n,o,r,s,a){"use strict";return e.extend({init:function(e){this._parent({});let i=this;this._options=e.options,this._plugSvcs=e.plugSvcs,this._flagDD=e.flagDD,this._gridView=e.gridView,this._structComparePanelCBs=e.structComparePanelCBs,this._flagDD.updateFlagDisplayData(e.compareTreeDocumentArray),this._currentlySelectedRowIDs=[],this.treePanelContent=[],this.onContextMenu=this._structComparePanelCBs.onContextMenu,this._viewActions=new r(this,this._plugSvcs,this._structComparePanelCBs),this.treePanelContent=[],this.treesContainer=new n,this._gridView.getDGVContainersConfig().forEach((function(e,n){var r=new o({caption:e.panelCaption,addClass:e.panelAddClass,contentId:e.id,contentBorderTop:e.styles["border-top"],collapseable:e.panelCollapseable,initSize100pct:!!e.initSize100pct&&e.initSize100pct,initSize50pct:!!e.initSize50pct&&e.initSize50pct,colorIndicator:e.color,includeTreeHeader:e.includeTreeHeader});t.createElement("div",{class:"replace-existing-drag-overlay",id:`${e.id}-replace-existing-drag-overlay_${n}`,html:[{tag:"div",id:`${e.id}-replace-existing-dropIconAndText_${n}`,class:"replace-existing-dropIconAndText",html:[{tag:"i",styles:{color:"#368EC4"},class:"replace-existing-icon wux-ui-3ds wux-ui-3ds-refresh"},{tag:"h5",class:"replace-existing-txt",styles:{color:"#368EC4","font-size":"16px","margin-top":"5px","margin-left":"20%","margin-right":"20%"},html:a.replaceExisting}]}]}).inject(r.elements.container),i.treePanelContent.push(r.elements.content),i.treesContainer.addPanel(r)})),this.elements.container=this.treesContainer.elements.container},destroy:function(){Array.isArray(this.dataGridViews)&&this.dataGridViews.length&&(this.dataGridViews.forEach((e=>e.destroy())),this.dataGridViews=[]),this.clear()},getDisplayMode:function(){return this._gridView.getDisplayMode()},getGridView:function(){return this._gridView},getMatchPairArray:function(){return this._compareTreeDocumentArray[0].__CRTREE__.getMatchPairArray()},show:function(){this.getContent().style.display="flex"},clear:function(){this.treePanelContent.forEach((e=>e.empty())),Array.isArray(this.dataGridViews)&&this.dataGridViews.length&&this.dataGridViews.forEach((e=>e.destroy())),this.dataGridViews=[]},withUpdateLocked:function(e){this._prepareUpdateView(),e(),this._pushUpdateView()},getNTHGridSelectedNodes:function(e){return this.dataGridViews[e].getNodesXSO().get()},getAllGridSelectedNodes:function(){let e=this,t=[],i=e.dataGridViews.length;for(let n=0;n<i;n++){let i=e.getNTHGridSelectedNodes(n);t.push(i)}return t},getNTHGrid:function(e){return this.dataGridViews[e]},clearNTHGridSelection:function(e){this.dataGridViews[e].getNodesXSO().empty()},setPanelCaption:function(e,t){this.treesContainer.setPanelCaption(e,t)},isScrollbarShown:function(){if(null!=this.dataGridViews){let i=this.dataGridViews.length,n=!0;for(var e=0;1==n&&e<i;e++){var t=this.dataGridViews[e].elements;n&=t.poolContainer.clientHeight>t.container.clientHeight}return n}return!1},updateTrees:function(e,t){var i=this;this._compareTreeDocumentArray=e,i._flagDD.updateFlagDisplayData(e),this.clear(),this.show();let n=i._gridView.getColDefs(i.renderTreeCB.bind(i),i._flagDD);i._updateTreesWithGridColumnDefs(n,t)},onSelectRow:function(){this._viewActions.onTreesSelectRow()},_onDragStartCell:function(e,t){this.draggingFromCompare=!0;var i=[];if(t.draggedNodes.forEach((function(e){var t=e._options.data,n=t._attrList,o=t.getDBContext();if(t.isDraggable()){var r=t.getPath().split("/").map((function(e){return{resourceid:e}}));i.push({contextId:o.securityContext,envId:o.tenant,objectId:n.physicalID_REF,objectType:n.type,path:r,serviceId:o.serviceName})}})),0==i.length)return e.preventDefault(),!1;var n={protocol:"3DXContent",version:"1.1",source:"ENOCOMP_AP",widgetId:widget.id,data:{items:i}};return e.dataTransfer.setData("Text",JSON.stringify(n)),!0},_onDragOverCell:function(){return!0},_onDragEndCell:function(){return this.draggingFromCompare=!1,!0},renderTreeCB:function(e,t){this.dataGridViews[e].defaultOnCellRequest(t),this._showHideLinks(t),this._adjustTitleKPIPosition(t)},_showHideLinks:function(e){var t=this._hasNextNonEmptyBrother(e.nodeModel),i=e.cellView.elements.linksContainer.getChildren()[0];if(null!=i){var n=i.getChildren();if(!t){var o=n[n.length-1];null==e.nodeModel.getLabel()?o.setStyle("visibility","hidden"):o.setStyle("height","50%")}}null==e.nodeModel.getLabel()?e.cellView.elements.expanderContainer.hide():(e.cellView.elements.expanderContainer.show(),e.cellView.elements.expanderContainer.setStyle("visibility","visible"),e.cellView.elements.linksContainer.setStyle("visibility","visible"))},_adjustTitleKPIPosition:function(e){let t=e.cellView.getContent(),i=t.getElement(".wux-layouts-datagridview-kpi-color");if(null!=i){t.removeChild(i);let e=t.getElement(".wux-layouts-datagridview-tweaker-container");i.setStyle("outline-width","2px"),i.setStyle("margin-left","2px"),t.insertBefore(i,e)}},_hasNextNonEmptyBrother:function(e){for(var t=!1,i=e.getNextBrother();null!=i&&!(t=""!=i.getLabel());)i=i.getNextBrother();return t},onDataGridViewsReady:function(e){let t=this,i=this._options.colorLeft,n=this._options.colorRight;document.querySelector(":root").style.setProperty("--base-color",i),document.querySelector(":root").style.setProperty("--comp-color",n),this.dataGridViews.forEach((e=>{t._syncScrolling(e),t._syncExpandCollapse(e.getTreeDocument()),t._subscribeForTreeSync(e)})),e()},_syncExpandCollapse:function(e){function t(t,i){var n=this;return o=>{if(null!=o.data.virtualRowID){for(var r=n.dataGridViews.reduce(((t,i)=>i.getTreeDocument()!==e?(t.push(i),t):t),[]),s=0;s<r.length;++s){var a=r[s];if(null!=a){if(!0===a._isSyncing)return;a._isSyncing=!0;let e=a.model.find((({_rowID:e})=>e===o.data.virtualRowID));null==e||void 0===e[t]||null===e[t]?console.log("expandOrCollapse failure"):e[t](),a._isSyncing=!1}}null!=i&&i(o.data)}}}var i=this;e.onPostExpand(t.bind(this)("expand",i._viewActions.onTreesExpand.bind(i._viewActions))),e.onPostCollapse(t.bind(this)("collapse",i._viewActions.onTreesCollapse.bind(i._viewActions))),e.onPreExpand((function(e){i._viewActions.onTreesPreExpand(e.data)})),e.onPreCollapse((function(e){i._viewActions.onTreesPreCollapse(e.data)}))},_syncScrolling:function(e){var t=this,i=t.dataGridViews.reduce(((t,i)=>i!==e?(t.push(i),t):t),[]),n=e._getScroller();n.onScrollBegin((i=>{t._activeScrollingGrid||(t._activeScrollingGrid=e)})),n.onScroll((n=>{t._activeScrollingGrid===e&&setTimeout((()=>{var n=e.getScrollerPosition();i.forEach((e=>e.setScrollerPosition(n))),"function"==typeof t.onScroll&&t.onScroll(n,e)}),0)})),n.onScrollEnd((i=>{t._activeScrollingGrid===e&&(t._activeScrollingGrid=null)}))},_subscribeForTreeSync:function(e){var t=this;e.getTreeDocument().subscribe({event:"select"},(function(i){var n=i.data.nodeModel._getRowID();t.dataGridViews.reduce(((t,i)=>i!==e?(t.push(i),t):t),[]).forEach((e=>{var t=e.model.find((({_rowID:e})=>e===n));null==t||t.isSelected()||e.selectNodeModel(t,!0,!1)})),-1===t._currentlySelectedRowIDs.indexOf(n)&&(t._currentlySelectedRowIDs.push(n),"function"==typeof t._viewActions.onTreesSelectRow&&t._viewActions.onTreesSelectRow())})),e.getTreeDocument().subscribe({event:"unselect"},(function(i){var n=i.data.nodeModel._getRowID(),o=t.dataGridViews.reduce(((t,i)=>i!==e?(t.push(i),t):t),[]),r=!1;o.forEach((e=>{var t=e.model.find((({_rowID:e})=>e===n));null!=t&&t.isSelected()&&(r=!0,e.unselectNodeModel(t))})),1==r&&-1!==t._currentlySelectedRowIDs.indexOf(n)&&(t._currentlySelectedRowIDs.splice(t._currentlySelectedRowIDs.indexOf(n),1),"function"==typeof t._viewActions.onUnselectRow&&t._viewActions.onUnselectRow())}))},applyFilters:function(e,t){null!=(null==t?null:t.statusFilterArgs)&&this._applyStatusFilters(t.statusFilterArgs),this._applyFilterModels_toDataGridViews(e)},_applyStatusFilters:function(e){let t=e.hiddenStatusArray,i=e.filterOnState;this._plugSvcs.dbgout("Applying status filter; filterOn: "+i+", hide: {"+t.join(", ")+"}");let n={};t.forEach((function(e){n[e]=!0}));let o=this.getMatchPairArray(),r=o.length,s=0;o[0].getBaseNode().getChildArray().length>0&&(s=1);for(let e=s;e<r;e++){let t=o[e],r=t.getAllStatusArray(),s=!1,u=!0,c=r.length;for(var a=0;a<c;a++){let e=r[a];if(1==n[e]){if(s=!0,"ANY"==i)break}else u=!1}var l=1==s&&"ANY"==i||1==u&&"ALL"==i;let d=t.getBaseNode().getParent(),p=t.getCompNode().getParent();if("object"==typeof d&&"object"==typeof p&&1==this._statusFilterHideChildIfParentIsHidden){1==d.getMatchInfo().getIsHidden_byStatusFilter()&&(l=!0)}t.setIsHidden_byStatusFilter(l);let h=1==l?0:1;t.getTreeNodes().forEach((e=>e.options.grid.showByStatusFilter=h))}},_applyFilterModels_toDataGridViews:function(e){let i=this,n=!t.equals(e,i.dataGridViews[0].getTreeDocument().getFilterManager().filterModel);this.withUpdateLocked((()=>{i.dataGridViews.forEach((i=>{n?i.getTreeDocument().setFilterModel(t.clone(e,!0)):i.getTreeDocument().reapplyFilterModel()}))}))},_updateTreesWithGridColumnDefs:function(e,n){let o=this;for(var r=0;r<e.length;r++){let n=e[r];var s=t.createElement("div",{class:"compare_tree_list_view"});s.inject(this.treePanelContent[r]);var a=new i({enableListSelection:!0,columnDragEnabledFlag:!1,treeDocument:this._compareTreeDocumentArray[r],columns:n,cellDragEnabledFlag:this._options.CELL_DRAG_ENABLED_FLAG,defaultColumnDef:{minWidth:8.5},layoutOptions:{rowsHeader:0===r},rowSelection:this._gridView.getDisplayMode().rowSelection,useLastColumnWidthAutoFlag:!0,showOutlineflag:!0,showColumnBorderFlag:1==this._gridView.getDisplayMode().showColumnBorderFlag,onContextualEvent:function(e){return new Promise((function(t){o.onContextMenu(e).then((function(e){t(e)}))}))},onDragStartCell:this._onDragStartCell,onDragOverCell:this._onDragOverCell,onDragEndCell:this._onDragEndCell(),selectionBehavior:{unselectAllOnEmptyArea:!1,selectOnContextualEvent:!0}});a.elements.container.style.top="4px",a.layout.columnsHeader=!0,a.layout.rowsHeader=!1,a.cellSelection="none",a.showCellActivationFlag=!1,a.selected=[],this.dataGridViews.push(a),a.inject(s)}Promise.all(this.dataGridViews.map((e=>new Promise((t=>e.onPostUpdateViewOnce((()=>t()))))))).then((function(){o.onDataGridViewsReady(n)}),(function(){o._plugSvcs.errout("onDataGridViewReady() failure")})),this.withUpdateLocked((function(){o.dataGridViews.forEach(((e,t)=>{let i=e.getTreeDocument().getRoots();i&&i[0]&&i[0].select()})),"function"==typeof o._viewActions.onSelectRow&&o._viewActions.onSelectRow()}))},selectByCrNodes:function(e){var t=this;t.withUpdateLocked((()=>{e.forEach(((e,i)=>{for(var n=e.__TREENODE__;null!=n&&!n._isVisible();)n=n.getParent();var o=n._getRowID();t.dataGridViews.forEach(((e,t)=>{var n=e.model.find((({_rowID:e})=>e===o));if(null!=n&&!n.isSelected()){0===i&&0===t&&e.ensureNodeModelVisible(n,!0,!1,.5),e.selectNodeModel(n,!0,!1)}}))}))}))},_prepareUpdateView:function(){this.dataGridViews.forEach((e=>e.prepareUpdateView()))},_pushUpdateView:function(){this.dataGridViews.forEach((e=>e.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0)))}})})),define("DS/CompareWidget2/plugins/STRUCTURE/flexibleView/ViewPanel/structFlexibleViewPanel",["UWA/Class","DS/CompareCommon/DragAndDrop","DS/CompareCommon/Utils","DS/CompareCommon/CompareIdDataListItem","DS/CompareCommon/Input/RevisionsManager","DS/CompareCommon/Input/FilterManager","DS/CompareCommon/Input/SearchManager","DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/Overview","DS/CompareWidget2/plugins/STRUCTURE/flexibleView/ViewPanel/fvpTrees","DS/CompareWidget2/support/objIDSpec","DS/CompareWidget2/viewComponents/StandardCompareToolbar","DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structExpandCollapseMenu","DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/externalController","DS/CompareWidget2/userSettings/UserSettingsManager","DS/UIKIT/Mask","i18n!DS/CompareCommon/assets/nls/CompareInput","i18n!DS/CompareWidget2/assets/nls/CompareV2","i18n!DS/CompareWidget2/assets/nls/DisplayMessages","css!UIKIT/UIKIT.css","css!DS/CompareWidget2/CompareWidget2.css"],(function(e,t,i,n,o,r,s,a,l,u,c,d,p,h,_,g,f,S){"use strict";var m=e.extend({init:function(){let e={};1==arguments.length?e=arguments[0]:(e.container=arguments[0],e.plugSvcs=arguments[1],e.options=arguments[2],e.gridView=arguments[3],e.flagDD=arguments[4],e.viewCallbacks=arguments[5],e.compareTreeDocumentArray=arguments[6]),this._parent(e.options),this._plugSvcs=e.plugSvcs,this._gridView=e.gridView,this._flagDD=e.flagDD,this._viewCallbacks=e.viewCallbacks,this._compareTreeDocumentArray=e.compareTreeDocumentArray,this._initialExpandLevels=e.options.INITIAL_EXPAND_LEVELS,this.ENABLE_DND=e.options.ENABLE_DND,this._myContent=UWA.createElement("div",{id:"FLEX_VIEW-"+this._gridView.getDisplayMode().id,class:"struct_flexible_view",styles:{height:"100%","flex-direction":"column",display:"flex"}}),this._myContent.inject(e.container),this._statusesHidden=[],this._statusesUnchecked=[],this._displayMode=this._gridView.getDisplayMode(),this._statusFilterHideChildIfParentIsHidden=!0,this._expandCollapseMenu=null,this._fvpTrees=null,this._overview=null,this._toolbar=null,this._allowedDisplayModes=[this._gridView.getDisplayMode()],this._myViewID=this._gridView.getViewID(),this._currentViewID=this._myViewID,this._currentExpandMenuId="expandAll",this._suspendExpandUpdates=!1,this._aggVisibilityFilterModels={},r.setApplyCallback(this,[{whichOne:"left"},{whichOne:"right"}],this._onApplyNGFilter),this.buildSkeleton(this._myContent,e.options)},buildToolbar:function(e,t){let i=this.buildOtherMenuItems();return new c(e,this,{navigateDifferences:!0,showCompareLegend:!0,otherMenuItems:i,panelOptions:t,CUSTOM_PROFILE_IN_USE:1==t.CUSTOM_PROFILE_IN_USE})},buildSkeleton:function(e,t){var i=this;this._loadContextMenu(t.CONTEXT_MENU_PLUGIN),this._expandCollapseMenu=new d({structComparePanel:this});var n={doExpandCollapseUpdates:this._doExpandCollapseUpdates.bind(this),onContextMenu:this._onContextMenu.bind(this),syncOverview:this._syncOverview.bind(this)};this._fvpTrees=new l({options:t,plugSvcs:i._plugSvcs,gridView:i._gridView,flagDD:i._flagDD,structComparePanelCBs:n,compareTreeDocumentArray:this._compareTreeDocumentArray}),this._toolbar=this.buildToolbar(e,t),this._fvpTrees.inject(e);let o=i._gridView.getGridIDs();0!=t.ENABLE_OVERVIEW&&(this._overview=new a({viewID:this._myViewID,gridID:o[o.length-1]}),this._overview.inject(e))},show:function(){this._myContent.show();var e="#FLEX_VIEW-"+this._myViewID,t=jQuery(e+" .compare-view-toolbar-container")[0].clientHeight;if(t>8){var i="calc(100% - "+t+"px)";this._myContent.setStyle("height",i)}0!=this.ENABLE_DND&&this._setupDnD()},hide:function(){this._myContent.hide(),this._removeDnD()},destroy:function(){null!=this._externalController&&(this._externalController.destroy(),this._externalController=null),null!=this._fvpTrees&&(this._fvpTrees.destroy(),this._fvpTrees=null),null!=this._overview&&(this._overview.destroy(),this._overview=null),null!=this._toolbar&&(this._toolbar.destroy(),this._toolbar=null),this._expandCollapseMenu=null,this._contextMenuPlugin=null,this._plugSvcs=null},_loadContextMenu:function(e){var t=this,i=e||"DS/CompareWidget2/viewComponents/ContextMenuBase";require([i],(function(e){t._contextMenuPlugin=new e({structComparePanel:t})}),(function(e){console.error("FAILED TO LOAD "+i+": msg:"+e)}))},handleToolbarCommands:function(e){switch(e.event){case"legendApplyFilter":this._applyFiltersCB(),this._updateToolbarDiffCount(),this._updatePersistedUserPref("legendFilter");break;case"legendApplyVisibility":this._showStatusChooserDialog(e);break;case"navigatePrevious":case"navigateFirst":case"navigateLast":case"navigateNext":this._onNavigate(e.event);break;case"displayView":this._viewCallbacks.reqChangeCurrentViewID(e.data.mode);break;case"expandAll":case"collapseAll":case"expandNLevels":this._toolbar.update({displayIcon:[{id:"expandCollapse",icon:e.data.icon}]}),this._currentExpandMenuId=e.event,"expandNLevels"===e.event?this._expandNLevels_showPopup():this._expandCollapse("collapseAll"!==e.event,-1);break;case"revisionsDlg":this._displayHistoryGraph(e.data.whichSide,e.data.objIDSpecREF);break;case"filterPanel":this._displayFilterPanel(e.data.whichSide,e.data.objIDSpecREF)}},_applyFiltersCB:function(){var e=this;0==_.isMasked(e._myContent)&&_.mask(e._myContent),setTimeout((()=>{let t=e._flagDD.getStatusONOFF(),i=e._getFilterOnState();e._fvpTrees.applyFilters(e._aggVisibilityFilterModels,{statusFilterArgs:{hiddenStatusArray:t.offFlags,filterOnState:i}}),e._doExpandCollapseUpdates(),e._fvpTrees.onSelectRow(),_.unmask(e._myContent)}),0)},_updateToolbarDiffCount:function(e){let t=e;null==t&&(t=this._getDifferenceCount()),this._toolbar.update({numDifferences:t})},_updatePersistedUserPref:function(e){let t=this;function i(e,i,n){let o=t._flagDD.getFDDItemArray_active();for(let[r,s]of Object.entries(o))r!==n&&(!0===s[e]&&t[i].indexOf(r)>=0?t[i]=t[i].filter((e=>e!==r)):!1===s[e]&&-1===t[i].indexOf(r)&&(t[i]=[...t[i],r]))}switch(e){case"legendFilter":i("checked","_statusesUnchecked");break;case"legendVisibility":i("visibleFlag","_statusesHidden","IDENTICAL")}},_showStatusChooserDialog:function(){var e=this._flagDD.getFDDItemArray_active().filter((function(e){return"IDENTICAL"!=e.id})),t=this;require(["DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/statusVisibilityDialog"],(i=>{new i({statuses:e,OKfn:i=>{let n=this.statusChooserCB.bind(this)(e,i);n.bApplyChanges&&(this._updatePersistedUserPref("legendVisibility"),this._updateToolbarDiffCount()),n.bAtLeastOneHidden&&t._plugSvcs.showAlertBox(S.HIDDEN_STATUSES_IDENTICAL,null,"info")}})}))},_onNavigate:function(e){var t=this._fvpTrees.dataGridViews[0].getNodesXSO().get();let i=this._fvpTrees.getMatchPairArray();var n=-2;if("navigateFirst"===e)n=-1,e="navigateNext";else if("navigateLast"===e)n=i.length,e="navigatePrevious";else if(Array.isArray(t)&&t.length){var o=(t=t[t.length-1]).options.data.getMatchInfo();n=i.findIndex((e=>o===e))}if(-2!==n){var r=function(e,t,n){for(var o="navigateNext"===t?1:-1,r=e+o,s=i.length;"navigateNext"===t?r<s:r>=0;r+=o)if(i[r].getBaseNode().__TREENODE__.isVisible())for(let e of i[r].getAllStatusArray(!0))if("IDENTICAL"!==e&&n.getFlagDisplayDataItem(e).visibleFlag)return i[r];return null}(n,e,this._flagDD);null!=r&&this._fvpTrees.withUpdateLocked(function(){this._fvpTrees.clearNTHGridSelection(0),r.getBaseNode().__TREENODE__.select(),this._fvpTrees.dataGridViews[0].ensureNodeModelVisible(r.getBaseNode().__TREENODE__,!0,1)}.bind(this))}},_expandNLevels_showPopup:function(e){var t=this;require(["DS/PADUtils/views/PADLevelSel"],(function(i){new i({current_level:1,events:{onApply:function(e){t._expandCollapse(!0,parseInt(e)||-1)}}});if(null!=e&&void 0!==e.position&&null!==e.position&&e.position.x>0&&e.position.y>0){var n=jQuery(".pad_level_sel_modal > .modal-wrap");null!=n&&n.length>0&&(n[0].setStyle("padding-top","0px"),n[0].setStyle("margin-top",e.position.y+"px"),n[0].setStyle("margin-left",e.position.x+"px"))}}))},_doExpandCollapse:function(e){var t=this;t._beginSuspendExpandUpdates(),this._fvpTrees.withUpdateLocked((()=>{try{t._fvpTrees.dataGridViews.forEach(((i,n)=>{t._fvpTrees.getNTHGridSelectedNodes(n).forEach((t=>{if(0==t.hasChildren())t.options.data.setExpandCollapseState("noExpandState");else if(0==e)t.collapseAll();else if(-1==e)t.expandAll();else{var i={};i.numberOfLevelsToExpand=e,t.collapseAll(),t.expandNLevels(i)}}))}))}catch(e){this._plugSvcs.errout("EXCEPTION in doExpandCollapse: "+e)}})),t._initialExpandLevels=e,t._endSuspendExpandUpdates(),this._fvpTrees.applyFilters(t._aggVisibilityFilterModels),this._syncOverview()},_expandCollapse:function(e,t){0==e&&(t=0),this._doExpandCollapse(t)},_getDifferenceCount:function(){let e=this,t=this._flagDD,i=this._fvpTrees.getMatchPairArray();var n=0;return i.forEach((function(i){1==e._checkForVisibleDiff(t,i)&&n++})),n},_checkForVisibleDiff:function(e,t){let i=!1;try{let a=t.getBaseNode();if(1==a.__TREENODE__.isVisible()){var n=0==a.areAnyChildrenVisible();let l=t.getAllStatusArray(n);for(var o=0;o<l.length;o++){var r=l[o];if("IDENTICAL"!=r){var s=e.getFlagDisplayDataItem(r);if(1==s.checked&&1==s.visibleFlag){i=!0;break}}}}}catch(e){console.error("error checking for visible diff flags: "+e)}return i},statusChooserCB:function(e,t){let i=this._flagDD,n=[],o=[];var r=!0;for(let[a,l]of Object.entries(t)){r=r&&l;var s=e[a].id;i.getFlagDisplayDataItem(s).visibleFlag!==l&&n.push({id:s,visibleFlag:l}),0==l&&o.push(s)}return i.setVizNoViz(o),n.unshift({id:"IDENTICAL",visibleFlag:i.getFlagDisplayDataItem("IDENTICAL").visibleFlag}),n.length>0&&(this._toolbar.update({showHideCommands:n}),this._doExpandCollapseUpdates()),{bAtLeastOneHidden:!r,bApplyChanges:n.length>0}},_onContextMenu:function(e){return this._contextMenuPlugin.createContextMenu(e)},_displayMenu:function(e,t){var i=this;require(["DS/Menu/Menu"],(n=>{var o=t.getBoundingClientRect(),r={position:{x:o.right,y:o.bottom},layout:"topright",input:i.isTouch?"touch":"mouse"};n.show(e,r)}))},displayExpandCollapseMenuCB:function(e){this._displayMenu(this._expandCollapseMenu.getExpandCollapseMenu(),e.dsModel.elements.container)},buildOtherMenuItems:function(){var e=this,t=[];t.push({id:"expandCollapse",dataElements:{domId:"compare-struct-expansion-button",typeRepresentation:"functionIcon",label:f.chooseTreeExpansion,tooltipInfos:i.generateTooltip("CompareWidget2/Tooltips","chooseTreeExpansion"),position:"far",priority:0,category:"other",overflowPriority:"never",value:t=>e.displayExpandCollapseMenuCB(t),icon:{iconName:"expandAll"===e._currentExpandMenuId?"flow-tree-expand-down":"flow-tree-expand-up",fontIconFamily:1}}});let n={id:"structPanelViewSelector",dataElements:{domId:"compare-struct-display-style-button",typeRepresentation:"functionIcon",label:f.chooseTreeOrListView,tooltipInfos:i.generateTooltip("CompareWidget2/Tooltips","chooseTreeOrListView"),position:"far",priority:1,overflowPriority:"never",icon:{iconName:e._allowedDisplayModes.find((t=>t.id===e._currentViewID)).icon,fontIconFamily:1},value:t=>{e._displayMenu(e._allowedDisplayModes.map((t=>({type:"RadioItem",title:t.title,id:t.id,tooltip:t.tooltip,icon:t.icon,state:e._currentViewID===t.id?"selected":"unselected",action:{callback:()=>e.handleToolbarCommands({event:"displayView",data:{mode:t.id,tooltip:t.tooltip,icon:t.icon}})}}))),t.dsModel.elements.container)}}};return t.push(n),t},_beginSuspendExpandUpdates:function(){this._suspendExpandUpdates=!0},_endSuspendExpandUpdates:function(){this._suspendExpandUpdates=!1,this._doExpandCollapseUpdates()},_doExpandCollapseUpdates:function(){0==this._suspendExpandUpdates&&(this.onResize(),this._syncOverview(),setTimeout((()=>{this._updateToolbarDiffCount()}),0))},_setupDnD:function(){var e=this;e._gridView.getGridIDs().forEach((function(i,n){t.attachObject(i,e,e._dragEnterPanel,(e=>{}),(e=>{}),null,n)}))},_removeDnD:function(){this._gridView.getGridIDs().forEach((function(e){t.detachObject(e)}))},_dragEnterPanel:function(e){let i=this;var n=this._fvpTrees.dataGridViews.every((function(e){return!e.draggingFromCompare}));if(void 0!==e.currentTarget&&null!==e.currentTarget&&n){let n=e.currentTarget.parentElement.getElement(".replace-existing-drag-overlay");n&&n.setAttribute("visible","");let o=n.getElement(".replace-existing-dropIconAndText");t.attachObject(o.id,i,(e=>{}),i._dragLeaveOverlayPanel,i._dropHandler,null,parseInt(o.id.split("_")[1]))}},_dragLeaveOverlayPanel:function(e){e.target&&e.currentTarget&&e.target===e.currentTarget&&e.target.hasClassName("replace-existing-dropIconAndText")&&(e.target.parentElement.removeAttribute("visible"),t.detachObject(e.target.id))},_dropHandler:function(e,o,r){var s=this._fvpTrees.dataGridViews.every((function(e){return!e.draggingFromCompare}));let a=event.currentTarget;if(a.hasClassName("replace-existing-dropIconAndText")&&(a.parentElement.removeAttribute("visible"),t.detachObject(a.id)),s){if(o.objArray.length>1)return void this._plugSvcs.showAlertBox("DROP_1_OBJ_REPLACE",S,"error");for(var l=i.fetchPersistedIDs(),c=o.objArray,d=c.map((function(e){return e.objectId})),p=c.map((function(e){var t={};for(var i in e)t[i]=e[i];return t})),h=d.length,_=0;_<h;++_){var g=new n(d[_],p[_]);l.items[r]=g}i.persistIDs(l);var f=[];o.objArray.forEach((function(e){var t=new u(e.objectId,e.objectType,e.contextId,e.envId,e.serviceId);f.push(t)})),this._requestRecompareWithNewID(r,f)}this._fvpTrees.dataGridViews.forEach((e=>e.draggingFromCompare=!1)),t.reset()},_updateTreePanelCaptions:function(){var e=this;this._getTreePanelCaptions().forEach((function(t){e._fvpTrees.setPanelCaption(t.panelContentId,t.panelCaption)}))},_getTreePanelCaptions:function(){function e(e,t,i){var n=null;let o=t.getObjIDSpec_REF();if(t){(n={}).label=[],n.label.push({text:t.getAttr("title")});let r=t.getAttr("revision");null!=r&&""!==r&&n.label.push({text:r,id:"treePanel-caption-revision-"+i,onClick:function(){e._displayHistoryGraph(i,o)}}),t.hasExternalFilter()&&n.label.push({text:t.getExternalFilterName(),id:"treePanel-caption-filter-"+i,onClick:function(){e._displayFilterPanel(i,o)}}),n.dropDown={id:"treePanel-caption-dropdown-"+i,onClick:function(){e._displayMenu(n.dropDown.item.map((e=>({type:"PushItem",title:e.text,icon:e.icon,action:{callback:e.onClick}}))),this)}},n.dropDown.item=[],!1!==o._supportsRevisions&&n.dropDown.item.push({text:g.get("revisionCM"),icon:"flow-branch-list",onClick:function(){e._displayHistoryGraph(i,o)}}),!1!==o._supportsFilters&&n.dropDown.item.push({text:g.get("filterCM"),icon:"filter",onClick:function(){e._displayFilterPanel(i,o)}}),n.dropDown.item.push({text:g.get("openCM"),icon:"open",onClick:function(){e._displaySearchPanel(i,o)}})}return n}var t=[];let i=this._gridView.getGridIDs(),n=i.length,o=function(e){e=e||[];let t={crNode_base:null,crNode_comp:null};for(let i=0;i<e.length;i++){let n=e[i];if(null==t.crNode_base){let e=n.getBaseNode();0==e.isDummy()&&(t.crNode_base=e)}if(null==t.crNode_comp){let e=n.getCompNode();0==e.isDummy()&&(t.crNode_comp=e)}if(null!=t.crNode_base&&null!=t.crNode_comp)break}return t}(this._compareTreeDocumentArray[0].__CRTREE__.getMatchPairArray()),r=e(this,o.crNode_base,"left");if(t.push({panelContentId:i[0],panelCaption:r}),2==n){let n=e(this,o.crNode_comp,"right");t.push({panelContentId:i[1],panelCaption:n})}return t},_displayHistoryGraph:function(e,t){var n=this;let r={objId:t.getPhysID(),objType:t.getObjType(),tenant:t.getTenant(),securityContext:t.getSecurityContext()};o.displayHistoryGraph(r,null,{allowDuplicates:!0},(function(t){let o="left"===e?0:1,r=i.fetchPersistedIDs();r.items[o].objectId=t.physicalid,r.items[o].objectServices.objectId=t.physicalid,r.items[o].objectServices.objectType=t.type,r.items[o].objectServices.contextId=t.contextId,r.items[o].objectServices.displayName=t.displayName,r.items[o].objectServices.serviceId=t.serviceId,i.persistIDs(r);let s=new u(t.physicalid,t.type,t.contextId,t.envId);n._requestRecompareWithNewID(o,[s])}))},_displayFilterPanel:function(e,t){var i={objId:t.getPhysID(),objType:t.getObjType(),tenant:t.getTenant(),securityContext:t.getSecurityContext(),serviceName:t.getServiceName()};r.activateProxy(e),r.executeFilterCmd(e,i)},_displaySearchPanel:function(e,t){var n=this,o=t.getTenant(),r=t.getSecurityContext(),a="left"===e?0:1;s.displaySearchPanel(o,!1,null,(function(e){let t=e[0];if(null!=t){var s=t.id;[].push(s);var l=t.sourceid_value.split(":"),c={contextId:r,displayName:t["ds6w:label_value"],displayType:t["ds6w:type"],envId:l.length>1?l[1]:o,objectId:t.id,objectType:t["ds6w:type_value"],serviceId:l[0],preview_url:t.preview_url_value,type_icon_url:t.type_icon_url_value};[].push(c);var d=i.fetchPersistedIDs();d.items[a].objectId=c.objectId,d.items[a].objectServices.objectId=c.objectId,d.items[a].objectServices.objectType=c.objectType,d.items[a].objectServices.contextId=c.contextId,d.items[a].objectServices.displayName=c.displayName,d.items[a].objectServices.serviceId=c.serviceId,i.persistIDs(d);var p=new u(c.objectId,c.objectType,c.contextId,c.envId,c.serviceId);n._requestRecompareWithNewID(a,[p])}}))},_requestRecompareWithNewID:function(e,t){this.clearView(),this._plugSvcs.postEvent("Event_replaceCompare",{targetIndex:e,objIDSpecArray:t})},_getFilterOnState:function(){let e=h.get("viewSettings.STRUCT_VIEW.multi_statuses_to_hide_and");return ret=1==e?"ALL":"ANY",ret},clearView:function(){this._fvpTrees&&this._fvpTrees.clear()},onResize:function(){null!=this._overview&&(this._overview.onResize(),this._updateOverviewVisibility())},onActivate:function(){setTimeout((()=>{this.onResize(),this._syncOverview()}),0)},getLabel:function(){return f.CompareStructurePanelTitle},getName:function(){return this._gridView.VIEWID},showResults:function(e,t,i){var n=this;n._flagDD=t,this._compareTreeDocumentArray=e,this._aggVisibilityFilterModels=n.buildFilterModels(),n._fvpTrees.updateTrees(e,function(){let e=n._flagDD.getStatusONOFF(),o=n._getFilterOnState();n._fvpTrees.applyFilters(n._aggVisibilityFilterModels,{statusFilterArgs:{hiddenStatusArray:e.offFlags,filterOnState:o}}),0!=n._gridView.showPanelCaptions&&this._updateTreePanelCaptions();var r=t.getFlagDisplayData_excludeFilteredByTypeAttr();this._toolbar.update({legend:r,enableDisableCommands:[{id:"expandCollapse",disabled:!this._displayMode.expandCollapseEnabled},{id:"chooseStatusToDisplay",disabled:1===Object.keys(r).length&&null!=r.IDENTICAL&&r.IDENTICAL.visibleFlag}],modulePath:"CompareWidget2/Tooltips"}),n.onResize(),n._syncOverview(),this._updateToolbarDiffCount(),this._doExpandCollapse(this._initialExpandLevels),i()}.bind(n))},updateViewDropDowns(e){this._allowedDisplayModes=e},setCurrentViewID:function(e){this._currentViewID=e},onComparePanelUpdated:function(){void 0!==this._contextMenuPlugin&&null!==this._contextMenuPlugin&&this._contextMenuPlugin.onComparePanelUpdated()},getActiveExpandMenuId:function(){return this._currentExpandMenuId},_updateOverviewVisibility:function(){null!=this._overview&&(this._fvpTrees.isScrollbarShown()?this._overview.show():this._overview.hide())},_syncOverview:function(){if(void 0!==this._overview&&null!==this._overview){var e=this._buildOverviewKeyDiffArray(this._fvpTrees.dataGridViews[1]);this._updateOverviewVisibility();var t=this._fvpTrees.getNTHGridSelectedNodes(0),i=[];t.forEach((function(e){var t=e._getRowID();i.push(t)}));var n=this._flagDD.getFDDItem_lut();this._overview.syncWithNewData(!0,e,i,n)}},_buildOverviewKeyDiffArray:function(e){for(var t=this,i=[],n=e.getTreeDocument().getAllDescendants(),o=0;o<n.length;o++){var r=n[o];if(r.isVisible()){var s=[],a=!1,l=r.options.data.getMatchInfo();if(l){var u=l.getBaseNode().areAnyChildrenVisible();if(l.getAllStatusArray(!u).forEach((function(e){let i=t._flagDD.getFlagDisplayDataItem(e);s.push(i)})),a=l.qtyIsDiffFlag){let e=t._flagDD.getFlagDisplayDataItem("QUANTITY");s.push(e)}}else{let e=t._flagDD.getFlagDisplayDataItem("IDENTICAL");s.push(e)}var c={objKey:o,flagDefArray:s,qtyDiff:a};i.push(c)}}return i},buildFilterModels:function(){return{showByStatusFilter:{filterId:"set",filterModel:[1]},showByTypeAttrFilter:{filterId:"set",filterModel:[1]}}},_onApplyNGFilter:function(e){const t=e.appId.startsWith("CompareWidget_right")?"right":"left",n="left"===t?0:1;let o=e.empty?null:e;var s=i.fetchPersistedIDs();s.items[n].filterData=o,e.empty?(s.items[n].filterSpec=null,i.persistIDs(s)):r.getFilterSpecificationPromise(t,o.filterRootIds[0]).then((function(e){1===e.status&&(s.items[n].filterSpec=e.publicSpec),i.persistIDs(s)}),(function(){i.persistIDs(s)}));let a=s.items[n].objectServices;var l=new u(a.objectId,a.objectType,a.contextId,a.envId,a.serviceId,o);this._requestRecompareWithNewID(n,[l])}});return m})),define("DS/CompareWidget2/plugins/ATTRIBUTE/attrCompareObj",["DS/CompareWidget2/support/cw2Utils"],(function(e){var t=function(e,t,i){this.visible=e,this.displayName=null==t||""===t?i:t,this.name=i,this.valueLeft="",this.valuesRight=[],this.highlightRight=[],this._reqModforODT="DS/CompareWidget2/plugins/ATTRIBUTE/attrCompareObj"};return t.prototype.setLeftVal=function(e){this.valueLeft=e},t.prototype.setRightVal=function(e,t){this.valuesRight[e]=t},t.prototype.setRightValHighlight=function(e,t){this.highlightRight[e]=t},t})),define("DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/ATTRIBUTE/attrCompareObj","DS/CompareCommon/Utils"],(function(e,t,i){function n(e){var i={},n=[],o=[],r=[],s=[],a=[],l=[],u=[];if(e.length>0)for(var c=0;c<e.length;c++)l.push(e[c].objType);if(l.every(((e,t,i)=>e===i[0]))){e.forEach(((e,t)=>{e.attrVals.forEach(((e,a)=>{var l=e.name,c=e.nls,d=e.getFormattedValue();!0===e.multivalued&&(u.includes(l)||u.push(l)),null!=d&&d.constructor==Array&&1==d.length&&(d=d[0]),null==i[l]&&(i[l]=[]),i[l][t]=d,isNaN(e.UIPosition)?r.includes(l)||(r.push(l),s.push(c)):(n[e.UIPosition]=l,o[e.UIPosition]=c)}))})),n.push(...r),o.push(...s);for(var d=[],p=n.length,h=0;h<p;h++){var _=n[h],g=o[h];if(null!=_){var f=new t(!0,g,_);d.push(f);var S=(E=i[_])[0];f.setLeftVal(S);for(var m=E.length,C=1;C<m;C++){var T=E[C];let e=u.includes(_);this._plugSvcs.csValsEquivalent(S,T,e)?(f.setRightVal(C-1,S),f.setRightValHighlight(C-1,!1)):(f.setRightVal(C-1,T),f.setRightValHighlight(C-1,!0))}}}return d}e.forEach(((e,t)=>{if(null!=e.attrVals&&null!=e.attrVals)for(var n=0;n<e.attrVals.length;++n){var o=e.attrVals[n].nls||e.attrVals[n].name;if(null==i[o]&&(i[o]=[],t>0))for(var r=0;r<t;r++)i[o][r]=null;null!=e.attrVals[n].value?i[o][t]=e.attrVals[n].getFormattedValue():i[o][t]=null,-1===a.findIndex((e=>e.attrKey===o))&&a.push({attrNLS:e.attrVals[n].nls||e.attrVals[n].displayName,attrType:e.attrVals[n].type,attrKey:o,attrName:e.attrVals[n].name})}}));for(d=[],p=a.length,h=0;h<p;h++){_=a[h].attrName,g=a[h].attrNLS;if(null!=_){f=new t(!0,g,_);d.push(f);var E=i[g];for(c=0;c<e.length;c++)void 0!==E[c]&&""!==E[c]||(E[c]=null);S=E[0];f.setLeftVal(S);for(m=E.length,C=1;C<m;C++){T=E[C];this._plugSvcs.csValsEquivalent(S,T)?(f.setRightVal(C-1,S),f.setRightValHighlight(C-1,!1)):(f.setRightVal(C-1,T),f.setRightValHighlight(C-1,!0))}}}return d}return e.extend({execute:function(e,t){var i=this;i._parent(e,t);var o=e,r=n.call(i,o);null!=r?i.reportOK(r):i.reportKO()}})})),define("DS/CompareWidget2/plugins/DATA/attrValObjSet",["DS/CompareWidget2/plugins/DATA/attrValObj"],(function(e){var t=function(e,t,i,n){this.physicalID=e,this.objType=t,this.iconURLLarge=i,this.iconURL=n,this.dbContext={},this.attrVals=[],this.byName={},this._reqModforODT="DS/CompareWidget2/plugins/DATA/attrValObjSet"};return t.prototype.add=function(t,i,n,o,r,s){var a=new e(t,i,n,o,r,s);this.attrVals.push(a),this.byName[t]=a},t.prototype.setDBContext=function(e,t,i){this.dbContext={securityContext:e,serviceName:t,tenant:i}},t.prototype.getDBContext=function(){return this.dbContext},t.prototype.getPhysicalID=function(){return this.physicalID},t.prototype.getObjType=function(){return this.objType},t.prototype.getIconURLLarge=function(){return this.iconURLLarge},t.prototype.getIconURL=function(){return this.iconURL},t.prototype.getAttrCount=function(){return this.attrVals.length},t.prototype.getAttr=function(e){return this.attrVals[e]},t.prototype.getAttrByName=function(e){return this.byName[e]},t})),define("DS/CompareWidget2/implementations/costing/costingToolbar",["DS/CompareWidget2/viewComponents/StandardCompareToolbar","UWA/Core","DS/CompareCommon/Utils","DS/Tweakers/GeneratedToolbar","i18n!DS/CompareWidget2/assets/nls/CompareV2","css!DS/CompareWidget2/assets/css/Controls/Toolbar.css"],(function(e,t,i,n,o){"use strict";return e.extend({init:function(e,t,i){this.TOOLBAR_NLS=i.panelOptions.TOOLBAR_NLS,this.baseColor=i.panelOptions.colorLeft,this.compColor=i.panelOptions.colorRight,this._gridView=i.gridView,this._fvpTrees=i.fvpTrees,this._plugSvcs=i.plugSvcs,this._currentPropGroupName=null,this._parent(e,t,i)},_verifyGroupNameOK:function(e){return null!=this._gridView._propDisplayGroups.find((function(t){return t.groupName==e}))},_getCurrentPropGroupName:function(){return null==this._currentPropGroupName&&(this._currentPropGroupName=this._plugSvcs.getUserSetting("viewSettings.STRUCT_VIEW.DISPLAYED_COST"),null!=this._currentPropGroupName&&0!=this._verifyGroupNameOK(this._currentPropGroupName)||(this._plugSvcs.warnout("User setting for current cost type ('"+this._currentPropGroupName+"') not relevant to dataset... trying default"),this._currentPropGroupName=null)),null==this._currentPropGroupName&&(this._currentPropGroupName=this._gridView.getDefaultPropGroupName(),null!=this._currentPropGroupName&&0!=this._verifyGroupNameOK(this._currentPropGroupName)||(this._plugSvcs.warnout("Default current cost type ('"+this._currentPropGroupName+"') not relevant to dataset... using first entry"),this._currentPropGroupName=this._gridView._propDisplayGroups[0]?.groupName)),this._currentPropGroupName},_setCurrentPropGroupName:function(e){this._currentPropGroupName!=e&&(this._currentPropGroupName=e,this._plugSvcs.setUserSetting("viewSettings.STRUCT_VIEW.DISPLAYED_COST",e))},syncToolbar:function(e){let t=null!=e.get_propDisplayGroups?e.get_propDisplayGroups():[],i=[];t.forEach((function(e){i.push({value:e.groupName,label:e.NLS_resolved,icon:e.icon})})),this.toolbar.updateNodeModel.apply(this.toolbar,["propGroupSelector",{possibleValues:i}])},_getToolbarConfig:function(){let e=this,t=[],n={id:"mainToolbarLeftObjectColor",dataElements:{domId:"sg-baseline-label-color",typeRepresentation:"color",value:this.baseColor,position:"near",readOnly:"true"}};t.push(n);let r={id:"mainToolbarLeftObjectString",dataElements:{domId:"sg-baseline-label-string",typeRepresentation:"string",value:this.TOOLBAR_NLS.baseStr,position:"near",readOnly:"true"}};t.push(r);let s={id:"mainToolbarRightObjectColor",dataElements:{domId:"sg-comp-label-color",typeRepresentation:"color",value:this.compColor,position:"near",readOnly:"true"}};t.push(s);let a={id:"mainToolbarRightObjectString",dataElements:{domId:"sg-comp-label-string",typeRepresentation:"string",value:this.TOOLBAR_NLS.compStr,position:"near",readOnly:"true"}};t.push(a);let l=[];this._gridView._propDisplayGroups.forEach((function(e){l.push({value:e.groupName,label:e.NLS_resolved,icon:e.icon})}));let u={id:"propGroupSelector",dataElements:{domId:"compare-display-group-selector",label:null,displayLabel:!1,typeRepresentation:"customEnumMember",position:"far",overflowPriority:"never",category:"other",priority:1,value:this._getCurrentPropGroupName(),possibleValues:l,onNodeUpdate:e.updatePropGroupCB.bind(e)}};t.push(u);let c={id:"expandCollapse",dataElements:{domId:"compare-struct-expansion-button",typeRepresentation:"functionIcon",label:o.chooseTreeExpansion,tooltipInfos:i.generateTooltip("CompareWidget2/Tooltips","chooseTreeExpansion"),position:"far",priority:0,category:"other",overflowPriority:"never",value:t=>e.view.displayExpandCollapseMenuCB(t),icon:{iconName:"expandAll"===e._currentExpandMenuId?"flow-tree-expand-down":"flow-tree-expand-up",fontIconFamily:1}}};t.push(c);let d={id:"SG_Refresh",hasTooltip:!0,dataElements:{domId:"sg-compare-refresh",tooltipInfos:i.generateTooltip("CompareWidget2/Tooltips","mainToolbarRefresh"),typeRepresentation:"functionIcon",icon:{iconName:"refresh",fontIconFamily:1},position:"far",category:"other",value:e.view.refreshCB.bind(e.view)}};return t.push(d),t},_buildView:function(){this.toolbarContainer=t.createElement("div",{class:"compare-view-toolbar-container"}).inject(this.container);let e=this._getToolbarConfig();this.toolbar=new n({overflowManagement:"dropdown",direction:"horizontal",popupDisplayStyle:"Basic",items:n.prototype.createTreeDocument({entries:e})}),this.toolbar.inject(this.toolbarContainer)},destroy:function(){},updatePropGroupCB:function(e){let t=e.options.grid.data;this._setCurrentPropGroupName(t),this.updateVisibleColumns(t)},updateDisplayToCurrentPropGroup:function(){let e=this._getCurrentPropGroupName();this.updateVisibleColumns(e)},updateVisibleColumns:function(e){let t=this._gridView._propDisplayGroups.filter((function(t){return t.groupName==e}))[0];if(null==t)this._plugSvcs.errout("propGroupName '"+e+"' does not exist");else{let e=t.displayProps.flatMap((function(e){return e.propName})),i={};e.forEach((function(e){i[e]=!0}));let n=this._fvpTrees.dataGridViews[0];null!=n&&(n.prepareUpdateView(),n.columns.forEach((function(e){let t=e.children;null!=t&&t.forEach((function(e){if(1==i[e.propName]){1!=n.layout.getColumnVisibleFlag(e.dataIndex)&&n.layout.setColumnVisibleFlag(e.dataIndex,!0)}else{0!=n.layout.getColumnVisibleFlag(e.dataIndex)&&n.layout.setColumnVisibleFlag(e.dataIndex,!1)}}))})),n.pushUpdateView({updateCellContent:!1,updateCellLayout:!0,updateCellAttributes:!0},!1),n.sizeAllColumnsToFit({computeAllRows:!0,computeColumnHeader:!0}))}}})})),define("DS/CompareWidget2/framework/svcNode",["DS/CompareWidget2/support/cw2Utils","DS/CompareCommon/Cycle"],(function(e,t){function i(t){var i=this,n=i.getName();e.dbgout("@@@@ SERVICE NODE "+n+" notified of input object update...");var o=t.obj,r=null==o?"[NO OBJ]":e.stringify(o).substr(0,100)+" ...";e.dbgout("@@@@ ++++++++++++++++++++  RUNNING  PLUGIN  +++++++++++++++++++++++++"),e.dbgout("@@@@ ++ PLUGIN: "+n),e.dbgout("@@@@ ++    OBJ: "+r),e.dbgout("@@@@ ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++");try{if(widget.recordForODT){let e=this.getName(),t=null==o?"null":JSON.stringify(JSON.decycle(o)),i=null==this._pluginOptions?"null":JSON.stringify(JSON.decycle(this._pluginOptions));console.log("COMPARE PLUGIN EXECUTE: "+e),console.log("[CV2ODT] "+e+" INSTRING: "+t),console.log("[CV2ODT] "+e+" INOPTIONS: "+i)}0==i.isEnabled()?(null!=i._deferredObjIn?e.dbgout("PROC_CONTROL"," svcNode '"+i.getName()+"' is DISABLED, and is UPDATING to a NEW DEFERRED OBJ"):e.dbgout("PROC_CONTROL"," svcNode '"+i.getName()+"' is DISABLED, and is deferring processing of an object"),i._deferredObjIn=o):(e.dbgout("PROC_CONTROL"," svcNode '"+i.getName()+"' is ENABLED and processing"),i._plugin.execute(o,i._pluginOptions))}catch(t){e.errout("EXCEPTION in Plugin '"+i.getName()+"'.execute(): "+t.stack)}}var n=function(t,i,n,o,r,s){e.dbgout("INIT","Creating svcNode '"+t+"' using plugin: "+i),this._name=t,this._pluginOptions=n,this._plugin=o,this._plugSvcs=r,this._eventMgr=s,this._subscribedTokens={},null!=this._plugin&&(this._plugin.setOutputFn(this.updateOutput.bind(this)),"DISPLAY_PLUGIN"==this._plugin._type&&this._subscribe("Event_clearView",this._handler_clearView)),this._outputEventName=this._name+".updated",this._outputObj={},this._viewName=null,this._deferredObjIn=null,this._network={upstream:{},downstream:{}}};return n.prototype.destroy=function(){this._name=null,this._pluginOptions=null,null!=this._plugin&&(this._plugin.disconnect(),this._plugin=null),this._pluginService=null,this._unsubscribeAll(),this._eventMgr=null,this._outputEventName=null,null!=this._outputObj&&("function"==typeof this._outputObj.destroy&&this._outputObj.destroy(),this._outputObj=null),null!=this._viewName&&(this._viewName=null),this._network.upstream={},this._network.downstream={}},n.prototype.setViewName=function(e){this._viewName=e},n.prototype.getViewName=function(){return this._viewName},n.prototype.getPluginType=function(){return this._plugin.getType()},n.prototype.updateOutput=function(e){if(this._outputObj=e,widget.recordForODT){let e=this.getName(),t=null==this._outputObj?"null":JSON.stringify(JSON.decycle(this._outputObj));console.log("COMPARE PLUGIN OUTPUT: "+e),console.log("[CV2ODT] "+e+" OUTSTRING: "+t)}this._eventMgr.publish({event:this._outputEventName,data:{eventName:this._outputEventName,obj:this._outputObj}})},n.prototype.getOutputEventName=function(){return this._outputEventName},n.prototype.subscribeToInputEvent=function(e){this._subscribe(e,i)},n.prototype._subscribe=function(t,i){if(null==this._subscribedTokens[t]){e.dbgout("INIT","SvcNode '"+this._name+"' will now listen to update event '"+t+"'");var n=this._eventMgr.subscribe({event:t},i.bind(this));this._subscribedTokens[t]=n}else e.dbgout("INIT","SvcNode '"+this._name+"' already listens to event '"+t+"'; ignoring (this is OK)...")},n.prototype._unsubscribeAll=function(){var e=this;Object.keys(e._subscribedTokens).forEach((function(t){var i=e._subscribedTokens[t];e._eventMgr.unsubscribe(i)})),this._subscribedTokens={}},n.prototype._handler_clearView=function(){1==this.isEnabled()&&this._plugin.onClearView()},n.prototype.refresh=function(){1==this.isEnabled()&&this.updateOutput(this._outputObj)},n.prototype.isEnabled=function(){return this._plugin.isEnabled()},n.prototype.enable=function(){return this.setEnabledState(!0),!0},n.prototype.disable=function(){this.setEnabledState(!1)},n.prototype.setEnabledState=function(t){e.dbgout("PROC_CONTROL"," svcNode '"+this.getName()+"' is being turned "+(t?"ON":"OFF")),this.isEnabled()!=t&&(1==t?this._plugin.enable(this._pluginOptions):this._plugin.disable(),this._notifyEnabledStateChange("UP"),this._notifyEnabledStateChange("DOWN"),this._forwardDeferredData())},n.prototype._notifyEnabledStateChange=function(e){let t="UP"==e?this._network.upstream:this._network.downstream;null!=t&&Object.keys(t).forEach((function(i){t[i]._updateEnabledState(e)}))},n.prototype._updateEnabledState=function(t){var i=this;let n="UP"==t?i._network.downstream:i._network.upstream,o="UP"==t?"DOWN":"UP";e.dbgout("PROC_CONTROL"," svcNode '"+this.getName()+"' is evaluating its enabled state (because "+o+" Stream svcNode changed its enabled state)");var r=!1;Object.keys(n).forEach((function(e){n[e].isEnabled()&&(r=!0)})),r!=i.isEnabled()&&(r?(e.dbgout("PROC_CONTROL"," svcNode '"+this.getName()+"' is being enabled"),i._plugin.enable(),i._notifyEnabledStateChange(t),i._forwardDeferredData()):(e.dbgout("PROC_CONTROL"," svcNode '"+this.getName()+"' is being disabled"),i._plugin.disable(),i._notifyEnabledStateChange(t)))},n.prototype._forwardDeferredData=function(){if(null!=this._deferredObjIn){e.dbgout("PROC_CONTROL"," svcNode '"+this.getName()+"' has deferred input object, and is now processing it...");var t=this._deferredObjIn;this._deferredObjIn=null,this._plugin.execute(t,this._pluginOptions)}},n.prototype.getViewPanel=function(){var e=null;return"DISPLAY_PLUGIN"==this._plugin.getType()&&(e=this._plugin.getViewPanel()),e},n.prototype.addUpstreamNode=function(e){this._network.upstream[e.getName()]=e},n.prototype.addDownstreamNode=function(e){this._network.downstream[e.getName()]=e},n.prototype.buildViewPanel=function(){null==this._viewName?e.warnout("buildViewPanel called on svcNode with no view"):this._plugin.buildViewPanel(this._viewName,this._pluginOptions)},n.prototype.getName=function(){return this._name},n.prototype._debug_dump=function(){},n.prototype.isPlugObjLoaded=function(){return null!=this._plugin},n})),define("DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/crList",["DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crNode","DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/matchPair"],(function(e,t){var i=function(e,t){this._listMatchPairArray=[],this._lut=[],e&&this.build_listMatchedPairArray(e,t),this._lut=[],this._reqModforODT="DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/crList"};return i.prototype.build_listMatchedPairArray=function(e,t){var i=this;e.forEach((function(e){i._addMatchedPair(e,t)})),i._listMatchPairArray.forEach((function(e){var t=e.getRelName();if("LEFT_ONLY"!=t&&"RIGHT_ONLY"!=t){var i=e.getBaseNode(),n=e.getCompNode();e.qtyIsDiffFlag=i.qty!=n.qty}}))},i.prototype.getMatchPairArray=function(){return this._listMatchPairArray},i.prototype.generateDisplayLists=function(){var t=[[],[]];return this._listMatchPairArray.forEach((function(i){var n=i.getBaseNode();null==n&&(n=new e);var o=i.getCompNode();null==o&&(o=new e),t[0].push(n),t[1].push(o)})),t},i.prototype._addMatchedPair=function(i,n){var o=i.getRelName();if("UNRELATED"==o||"DIFFERENT"==o){var r=i.getBaseNode(),s=i.getCompNode(),a=new e,l=new e,u=new t("LEFT_ONLY",null,r,l),c=new t("RIGHT_ONLY",null,a,s);this._addListMatchedPair(u,n),this._addListMatchedPair(c,n)}else{var d=i.shallowDupe(),p=d.getAdjFlagArray()||[];(d.getInstFlagNdxs()||[]).forEach((function(e,t){p.splice(e-t,1)})),this._addListMatchedPair(d,n)}},i.prototype._addListMatchedPair=function(e,t){var i=e.getBaseNode(),n=null==i||i.isDummy(),o=n?"":i.getAttr("physicalID_REF"),r=e.getCompNode(),s=null==r||r.isDummy(),a=s?"":r.getAttr("physicalID_REF"),l=o+"."+a,u=this._lut[l],c=!1;if(null!=u){var d=u.getBaseNode(),p=u.getCompNode();0==n&&(null==d.qty||(d.qty.length=0)?d.qty=1:d.qty++),0==s&&(null==p.qty||(p.qty.length=0)?p.qty=1:p.qty++),c=!0}else if(0==n&&0==s){var h=o+".",_=this._lut[h];if(null!=_&&_.getCompNode().isDummy()){_.getBaseNode().qty++,(T=r.shallowDupe()).qty=1,T.setMatchInfo(_),_._compNode=T,_._relName=e._relName,this._lut[l]=_,this._lut["."+a]=_,c=!0}else{var g="."+a,f=this._lut[g];if(null!=f&&f.getBaseNode().isDummy())f.getCompNode().qty++,(S=i.shallowDupe()).qty=1,S.setMatchInfo(f),f._baseNode=S,f._relName=e._relName,this._lut[l]=f,this._lut[o+"."]=f,c=!0;else(D=e.shallowDupe()).getBaseNode().qty=1,D.getCompNode().qty=1,this._listMatchPairArray.push(D),this._lut[l]=D,this._lut[o+"."]=D,this._lut["."+a]=D,c=!0}}else if(!t)if(s){var S,m="."+o,C=this._lut[m];if(null!=C)(S=i.shallowDupe()).setMatchInfo(C),S.qty=1,C._baseNode=S,C._relName="IDENTICAL",this._lut[o+"."]=C,this._lut[o+"."+o]=C,c=!0}else if(n){var T,E=a+".",v=this._lut[E];if(null!=v)(T=r.shallowDupe()).setMatchInfo(v),T.qty=1,v._compNode=T,v._relName="IDENTICAL",this._lut["."+a]=v,this._lut[a+"."+a]=v,c=!0}if(0==c){var D=e.shallowDupe();this._lut[l]=D,D.getBaseNode().qty=n?"":1,D.getCompNode().qty=s?"":1,this._listMatchPairArray.push(D)}},i})),define("DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crTree",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crNode","DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/matchPair","DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/crList"],(function(e,t,i,n){function o(e){var i=new t;return i.setParent(e),i}function r(e,t,n,s){var a=t.getChildArray(),l=n.getChildArray(),u=a.length,c=l.length,d=[],p=[],h=0;for(h=0;h<c;h++)l[h].touched=!1;for(h=0;h<u;h++){let t=a[h],l=null;if(null==t.getMatchInfo(s)){l=o(n),n.addChild(l);let e=new i("LEFT_ONLY",null,t,l);t.setMatchInfo(e,s),l.setMatchInfo(e)}else l=t.getMatchInfo(s).getCompNode();d.push(t),p.push(l),l.touched=!0,r(e,t,l,s)}for(h=0;h<c;h++){let n=l[h];if(0==n.touched&&null==n.getMatchInfo()){let a=o(t);t.addChild(a);let l=new i("RIGHT_ONLY",null,a,n);n.setMatchInfo(l),a.setMatchInfo(l,s),d.push(a),p.push(n),n.touched=!0,r(e,a,n,s)}else n.touched=!0}t._childArray=d,n._childArray=p}function s(e,t){var i=[],n=[];n.push(e.getRoot(0));for(var o=!0;n.length>0;){var r=n.pop(),s=r.getMatchInfo(t),a=!1;if(o)if(s.getBaseNode().isDummy())s.getCompNode().isDummy()&&(a=!0);0==a&&i.push(s);for(var l=r.getChildArray(),u=l.length-1;u>=0;u--){var c=l[u];n.push(c)}o=!1}return i}function a(e,t){l(e.getRoot(0),[],0,1,t)}function l(e,t,i,n,o){t[i]=n;var r=t.join("."),s=e.getMatchInfo(o);s.setDepth(r),s.setLevel(t.length-1);for(var a=e.getChildArray(),u=a.length,c=0;c<u;c++){l(a[c],t,i+1,c+1,o)}t.pop()}var u=function(e){this._rootSet=[],this._matchPairArray=[],this._crList=null,null!=e&&(this._compTreeIndex=e),this._reqModforODT="DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crTree"};return u.prototype.getCompTreeIndex=function(){return this._compTreeIndex},u.prototype.niceUp=function(e,t,l,u){!function(e,t,n){var s=e.getRoot(0),a=e.getRoot(1),l=!1,u=s.getMatchInfo(n);if(null!=u&&"UNRELATED"!=u.getRelName()&&u.getCompNode()==a&&(l=!0),l||t)r(e,s,a,n);else{var c=o(null),d=new i("LEFT_ONLY",null,s,c);s.setMatchInfo(d,n),c.setMatchInfo(d),r(e,s,c,n),c.addChild(a);var p=o(null);d=new i("RIGHT_ONLY",null,p,a),p.setMatchInfo(d,n),a.setMatchInfo(d),r(e,p,a,n),s.addChild(p),e.resetDisplayRoot(1,c)}}(this,e,u),a(this,u),this._matchPairArray=s(this),0!=t&&(this._crList=new n(this._matchPairArray,l))},u.prototype.reNice=function(e){delete this._matchPairArray,delete this._crList,this._matchPairArray=s(this,e),this._crList=new n(this._matchPairArray)},u.prototype.getMatchPairArray=function(){return this._matchPairArray},u.prototype.getCRList=function(){return this._crList},u.prototype.getRoot=function(e){var t=null;return null!=this._rootSet[e]&&(t=this._rootSet[e].CRNode_root),t},u.prototype.getRootArray=function(){return this._rootSet},u.prototype.getDisplayRoot=function(e){var t=null;return null!=this._rootSet[e]&&(t=this._rootSet[e].CRNode_displayRoot),t},u.prototype.getRootObjIDSpec=function(e){var t=null;return null!=this._rootSet[e]&&(t=this._rootSet[e].root_objIDSpec),t},u.prototype.resetDisplayRoot=function(e,t){null!=this._rootSet[e]&&(this._rootSet[e].CRNode_displayRoot=t)},u.prototype.setRoot=function(e,t,i){this._rootSet[e]={root_objIDSpec:t,CRNode_displayRoot:i,CRNode_root:i}},u.prototype.destroy=function(){for(var e=0;e<this._rootSet.length;e++){var t=this._rootSet[e];null!=t&&(t.root_objIDSpec.destroy(),delete t.root_objIDSpec,t.CRNode_displayRoot.destroy(),delete t.CRNode_displayRoot,delete t.CRNode_root,delete this._rootSet[e])}},u.prototype.sortBaseTreeNodes=function(){let e=this.getCompTreeIndex();this.visitAll_treeAndFN(0,(function(t){t.sortChildren(e)}))},u.prototype.sortCompTreeNodes=function(){this.visitAll_treeAndFN(1,(function(e){e.sortChildren()}))},u.prototype.findNodeByIDPath=function(e,t){var i=t.split("/"),n=this.getRoot(e),o=null,r="",s=n.getAttr("physicalID_REF");if(i[0]==n.getAttr("physicalID_REF")){for(var a=1;null!=n&&a<i.length;a+=2){r=i[a],s=i[a+1];n=n.findChildByID(r,s)}o=n}return o},u.prototype.visitVisible_treeAndFN=function(e,t){this._visit_treeAndFN(!0,e,t)},u.prototype.visitAll_treeAndFN=function(e,t){this._visit_treeAndFN(!1,e,t)},u.prototype._visit_treeAndFN=function(t,i,n){var o=!1,r=this.getRoot(i);if(null==r)e.errout("'_visit_treeAndFN()' called, but tree has no root set");else if(0==i){let e=this.getCompTreeIndex();o=r.visit_nodesAndFN(t,n,e)}else o=r.visit_nodesAndFN(t,n);return o},u})),define("DS/CompareWidget2/plugins/ATTRIBUTE/ViewPanel/attrComparePanel",["DS/CompareWidget2/plugins/ATTRIBUTE/ViewPanel/propsComparePanel","DS/CompareCommon/Utils","i18n!DS/CompareWidget2/assets/nls/CompareV2"],(function(e,t,i){return e.extend({init:function(e,t,i){this._parent(e,t,i)},getLabel:function(){return i.ComparePropertiesPanelTitle},getName:function(){return"PROP_VIEW"},getDomId:function(){return"propattr"}})})),define("DS/CompareWidget2/ViewDefModules/DocumentViewDefOptions",["UWA/Core","DS/CompareWidget2/ViewDefModules/DSColors"],(function(e,t){"use strict";var i={PHYSICALID:"REF.physicalid",VERSIONID:"REF.versionid",NAME:"REF.name"},n={CV_PROPS:i,CVURL_BY_TYPE:[{name:"DEFAULT",url:"/cvservlet/expand"}],DATA_SOURCE:"CV_SERVICE",DB_FALLBACK:!1,USE_MCS:!1},o={PROPS:i,COMPUTE_DIFFERENT:!0,FORCE_ROOTS_TOGETHER:!0,SYSTEM_RELATIONSHIP_NAMES:["LEFT_ONLY","RIGHT_ONLY","QUANTITY","DIFFERENT","UNRELATED"],CUSTOM_RELATIONSHIP_NAMES:["IDENTICAL","REVISION"],CUSTOM_COMPARISONS:{COMP_PHYSID:[["PHYSICALID","PHYSICALID"],["EQ","NEQ"]],COMP_VERID:[["VERSIONID","VERSIONID"],["EQ","NEQ"]],COMP_NAME:[["NAME","NAME"],["EQ","EQ"]]},CUSTOM_MATCH_ADJUSTMENTS:[]},r={SYSTEM_RULE_ID_FLAGS:{LEFT_ONLY:{COLOR:t.colorDef.ORANGE,NLS:"LO"},RIGHT_ONLY:{COLOR:t.colorDef.BLUE1,NLS:"RO"},UNRELATED:{COLOR:t.colorDef.BLACK,NLS:"UNRELATED"},DIFFERENT:{COLOR:t.colorDef.BEIGE,NLS:"DIFFERENT"},QUANTITY:{COLOR:t.colorDef.BLUE2,NLS:"QUANTITY"}},CUSTOM_RULE_ID_FLAGS:{IDENTICAL:{COLOR:t.colorDef.NONE,NLS:"SM"},REVISION:{COLOR:t.colorDef.VIOLET,NLS:"REV"},REPLACED:{COLOR:t.colorDef.PINK,NLS:"REPLACED"}},CONTEXT_MENU_PLUGIN:"DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structDefaultContextMenu",CELL_DRAG_ENABLED_FLAG:!0};return{CV_PROPS:i,STRUCT_FETCH_OPTIONS:n,STRUCT_COMPARE_OPTIONS:o,STRUCT_DISPLAY_OPTIONS:r,ATTRIBUTE_DISPLAY_OPTIONS:{colorLeft:r.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR,colorRight:r.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR}}})),define("DS/CompareWidget2/ViewDefModules/DocumentViewDefs_V2",["DS/CompareWidget2/ViewDefModules/DocumentViewDefOptions"],(function(e){"use strict";var t={AttrFetch:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin"},AttrCompare:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin"},AttrDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",Options:e.ATTRIBUTE_DISPLAY_OPTIONS},StructFetch:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_FETCH_plugin",Options:e.STRUCT_FETCH_OPTIONS},StructCompare:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_COMPARE_plugin",Options:e.STRUCT_COMPARE_OPTIONS},StructDisplay:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_DISPLAY_plugin",Options:e.STRUCT_DISPLAY_OPTIONS},StructListViewPrep:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_LIST_VIEW_PREP_PLUGIN"},Exporter:{Path:"DS/CompareWidget2/plugins/EXPORT/EXPORT_plugin",Options:e.STRUCT_DISPLAY_OPTIONS}};return UWA.merge({VIEWSETS:{STANDARD:{COL:["STRUCT_VIEW","PROP_VIEW"]},PROPS_ONLY:{ROW:"PROP_VIEW"},STRUCT_ONLY:{ROW:"STRUCT_VIEW"}},VIEWDEFS:{PROP_VIEW:["AttrFetch","AttrCompare","AttrDisplay"],STRUCT_VIEW:["StructFetch","StructCompare","StructListViewPrep","StructDisplay","Exporter"]},PLUGDEFS:t},e)})),define("DS/CompareWidget2/ViewDefModules/CreateAssembly_Options",["UWA/Core","DS/CompareWidget2/ViewDefModules/ViewDefOptions"],(function(e,t){"use strict";let i={STRUCT_FETCH_OPTIONS:{PROGRESSIVE_EXPAND_OPTIONS:{graph:{descending_condition_relation:{uql:"(flattenedtaxonomies:reltypes/DELFmiFunctionIdentifiedInstance)"}}},EXPAND_V1_OPTIONS:{no_type_filter_bo:["PLMPort","PLMConnection","VPMReference"]}}};return e.extend(i.STRUCT_FETCH_OPTIONS,t.STRUCT_FETCH_OPTIONS),e.merge(i,t),i})),define("DS/CompareWidget2/ViewDefModules/CreateAssembly_ViewDefs",["UWA/Core","DS/CompareWidget2/ViewDefModules/DefaultViewDefs_V2","DS/CompareWidget2/ViewDefModules/CreateAssembly_Options"],(function(e,t,i){"use strict";let n={PLUGDEFS:{StructFetch:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_FETCH_plugin",Options:i.STRUCT_FETCH_OPTIONS}}};return e.merge(n.PLUGDEFS,t.PLUGDEFS),e.merge(n,t),e.extend(n,i),n})),define("DS/CompareWidget2/ViewDefModules/RequirementSpecViewDefOptions",["UWA/Core","DS/CompareWidget2/ViewDefModules/DSColors"],(function(e,t){"use strict";var i={PHYSICALID:"REF.physicalid",VERSIONID:"REF.versionid",NAME:"REF.name"},n={CV_PROPS:i,CVURL_BY_TYPE:[{name:"DEFAULT",url:"/cvservlet/expand"}],DATA_SOURCE:"CV_DIRECT",DB_FALLBACK:!1,COMMAND_CONTEXT:"compare",USE_MCS:!1},o={PROPS:i,COMPUTE_DIFFERENT:!0,FORCE_ROOTS_TOGETHER:!0,SYSTEM_RELATIONSHIP_NAMES:["LEFT_ONLY","RIGHT_ONLY","QUANTITY","DIFFERENT","UNRELATED"],CUSTOM_RELATIONSHIP_NAMES:["IDENTICAL","REVISION"],CUSTOM_COMPARISONS:{COMP_PHYSID:[["PHYSICALID","PHYSICALID"],["EQ","NEQ"]],COMP_VERID:[["VERSIONID","VERSIONID"],["EQ","EQ"]],COMP_NAME:[["NAME","NAME"],["EQ","EQ"]]},CUSTOM_MATCH_ADJUSTMENTS:[]},r={SYSTEM_RULE_ID_FLAGS:{LEFT_ONLY:{COLOR:t.colorDef.ORANGE,NLS:"LO"},RIGHT_ONLY:{COLOR:t.colorDef.BLUE1,NLS:"RO"},UNRELATED:{COLOR:t.colorDef.BLACK,NLS:"UNRELATED"},DIFFERENT:{COLOR:t.colorDef.BEIGE,NLS:"DIFFERENT"},QUANTITY:{COLOR:t.colorDef.BLUE2,NLS:"QUANTITY"}},CUSTOM_RULE_ID_FLAGS:{IDENTICAL:{COLOR:t.colorDef.NONE,NLS:"SM"},REVISION:{COLOR:t.colorDef.VIOLET,NLS:"REV"},REPLACED:{COLOR:t.colorDef.PINK,NLS:"REPLACED"}},CONTEXT_MENU_PLUGIN:"DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structDefaultContextMenu",CELL_DRAG_ENABLED_FLAG:!0};return{FRAMEWORK_OPTIONS:{customCompareActive:!0},CV_PROPS:i,STRUCT_FETCH_OPTIONS_REQ:n,STRUCT_COMPARE_OPTIONS_REQ:o,STRUCT_DISPLAY_OPTIONS_REQ:r,ATTRIBUTE_DISPLAY_OPTIONS:{colorLeft:r.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR,colorRight:r.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR}}})),define("DS/CompareWidget2/ViewDefModules/RequirementSpecViewDef",["DS/CompareWidget2/ViewDefModules/RequirementSpecViewDefOptions"],(function(e){"use strict";var t={AttrFetch:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin"},AttrCompare:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin"},AttrDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",Options:e.ATTRIBUTE_DISPLAY_OPTIONS},StructFetchReq:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_FETCH_plugin",Options:e.STRUCT_FETCH_OPTIONS_REQ},StructCompareReq:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_COMPARE_plugin",Options:e.STRUCT_COMPARE_OPTIONS_REQ},StructDisplayReq:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_DISPLAY_plugin",Options:e.STRUCT_DISPLAY_OPTIONS_REQ},StructListViewPrep:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_LIST_VIEW_PREP_PLUGIN"},Exporter:{Path:"DS/CompareWidget2/plugins/EXPORT/EXPORT_plugin",Options:e.STRUCT_DISPLAY_OPTIONS}};return UWA.merge({VIEWSETS:{STANDARD_REQ:{COL:["STRUCT_VIEW_REQ","PROP_VIEW"]},PROPS_ONLY:{ROW:"PROP_VIEW"},STRUCT_ONLY_REQ:{ROW:"STRUCT_VIEW_REQ"}},VIEWDEFS:{PROP_VIEW:["AttrFetch","AttrCompare","AttrDisplay"],STRUCT_VIEW_REQ:["StructFetchReq","StructCompareReq","StructListViewPrep","StructDisplayReq","Exporter"]},PLUGDEFS:t},e)})),define("DS/CompareWidget2/plugins/STRUCTURE/flexibleView/ViewPanel/gridView/gridView",["UWA/Controls/Abstract","DS/CompareWidget2/support/attrNLS_mgr","i18n!DS/CompareWidget2/assets/nls/CompareV2"],(function(e,t,i){return e.extend({init:function(e){this._pluginOptions=e,this._baselineColor=e.colorLeft,this._compareColor=e.colorRight,this._displayMode=e.displayMode},getGridIDs:function(){console.error("This method must be filled in by a derived class")},getDGVContainersConfig:function(){console.error("This method must be filled in by a derived class")},getColDefs:function(){console.error("This method must be filled in by a derived class")},getTreeNodeModelConfig:function(){console.error("This method must be filled in by a derived class")},initAsync:function(){return new Promise((function(e,t){e()}))},getViewID:function(){return this._displayMode.id},createTreeNodeModel:function(){return this.getTreeNodeModelConfig()},getDisplayMode:function(){return this._displayMode},lookupSystemPropNLS:function(e,i){return new Promise((function(n,o){if(0==i.length)n({});else{let o=e.getObjType(),r=e.getSecurityContext(),s=e.getTenant();t.getAttrNLS(i,o,[],s,r).then((function(e){n(e)}),(function(e){console.error("Failed to perform NLS lookup: "+e);let t={};i.forEach((function(e){t[e]=e})),n(t)}))}}))}})})),define("DS/CompareWidget2/plugins/STRUCTURE/flexibleView/STRUCT_DISPLAY_PREP_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/STRUCTURE/flexibleView/ViewPanel/flagDisplayData","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel"],(function(e,t,i,n){return e.extend({init:function(e,t,i,n){this._parent(e,t,i,n),this._gridView=null,this._forceRootsTogether=!0,this._compareTreeDocuments=[],this.enableDebugLabel("CRTREE ANALYSIS")},_crNode2tNode:function(e,t,i,o){var r=this;if(null==t)throw new Error("crNode2tNode: Parent node is null");var s=i(e,o),a=new n(s);t.addChild(a),e.__TREENODE__=a;var l=e.getMatchInfo();l.addTreeNode(a),a.__MATCH_PAIR__=l;let u=e.getChildArray();a.setState({state:Array.isArray(u)&&u.length?"expanded":"noChildren"}),e.setExpandCollapseState(a.getState()),Array.isArray(u)&&u.forEach((function(e){r._crNode2tNode(e,a,i,o)}))},_crTree2trTree:function(e,t,n){var o=new i,r=!1,s=e.getMatchInfo();s.getBaseNode().isDummy()&&(s.getCompNode().isDummy()&&(r=!0));if(r)for(var a=e.getChildArray(),l=null==a?0:a.length,u=0;u<l;u++)this._crNode2tNode(a[u],o,t,n);else this._crNode2tNode(e,o,t,n);return o},_loadGridView:function(e,t){var i=this;return new Promise((function(n,o){null!=i._gridView?n(i._gridView):require([t],(function(t){i._gridView=new t(i._pluginOptions),i._gridView.initAsync(e).then((function(e){n(i._gridView)}),(function(e){n(i._gridView)}))}),(function(e){var t="CANNOT LOAD gridView: "+i._gridViewAMDPath+" ::"+e;o(t)}))}))},_doDisplayPrep:function(e,t,i){var n=[];return e.length>2?this._plugSvcs.errout("STRUCT_DISPLAY_PREP_plugin does not (yet) handle > two objects for comparison"):null==t?this._plugSvcs.errout("No crNode2tNodeFN defined... cannot convert"):(n[0]=this._crTree2trTree(crTree.getRoot(0),t,i),n[0].__CRTREE__=crTree,n[1]=this._crTree2trTree(crTree.getRoot(1),t,i),n[1].__CRTREE__=crTree),n},checkNodesForUnmatched:function(e,t){for(let i=0;i<2;i++){let n=0,o=0,r={},s=0,a=0,l=0,u=0,c=0;e.visitAll_treeAndFN(i,(function(e){c++;let s=null;if(null!=e._matchInfo&&(s=0==i?e.getMatchInfo(t):e.getMatchInfo()),null==s)n++;else{o++;let e=s.getRelName();null==r[e]?r[e]=1:r[e]++,s.getCompNode().isDummy()&&u++,s.getBaseNode().isDummy()&&l++}return!0})),this._plugSvcs.dbgout("CRTREE ANALYSIS"," -------------------------------------------------------------\x3e>>>  TREE : "+(0==i?"'BASE'":"'COMP'")),this._plugSvcs.dbgout("CRTREE ANALYSIS"," Total rNode Count                  : "+c),this._plugSvcs.dbgout("CRTREE ANALYSIS"," crNodes without matchPair          : "+n),this._plugSvcs.dbgout("CRTREE ANALYSIS"," crNodes with matchPair             : "+o),0!=a&&this._plugSvcs.errout("CRTREE ANALYSIS"," matchPairs with no baseNode    : "+a+" // THIS SHOULD NEVER HAPPEN"),0!=s&&this._plugSvcs.errout("CRTREE ANALYSIS"," matchPairs with no compNode    : "+s+"// THIS SHOULD NEVER HAPPEN"),this._plugSvcs.dbgout("CRTREE ANALYSIS"," matchPairs with a dummy base node  : "+l),this._plugSvcs.dbgout("CRTREE ANALYSIS"," matchPairs with a dummy comp node  : "+u)}},execute:function(e,i){let n=this;n._parent(e,i);let o=e.crTreeArray,r=new t(i,o[0]),s=o[0].getRootObjIDSpec(0);this._loadGridView(s,i.gridViewAMDPath).then((function(e){let t=e,i=o.length;for(var s=0;s<i;s++)n._plugSvcs.dbgout('CRTREE ANALYSIS","  -+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+-'),crTree=o[s],n._plugSvcs.dbgout("CRTREE ANALYSIS"," +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++>>>> for crTree #"+s+", 'AS GIVEN'"),n.checkNodesForUnmatched(crTree,s),crTree.niceUp(n._forceRootsTogether,!1,!1,s),n._plugSvcs.dbgout("CRTREE ANALYSIS"," +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++>>>> for crTree #"+s+", 'NICED UP'"),n.checkNodesForUnmatched(crTree,s);let a=n._doDisplayPrep(o,t.getTreeNodeModelConfig.bind(t),r);r.updateFlagDisplayData(a,[]);var l={compareTreeDocumentArray:a,flagDisplayData:r,gridView:t};n.reportOK(l)}),(function(e){n.reportKO("FAILURE is STRUCT_DISPLAY_PREP: "+e)}))}})})),define("DS/CompareWidget2/plugins/STRUCTURE/singleGridView/SG_DISPLAY_PREP_plugin",["DS/CompareWidget2/plugins/STRUCTURE/flexibleView/STRUCT_DISPLAY_PREP_plugin","DS/CompareWidget2/plugins/STRUCTURE/flexibleView/ViewPanel/flagDisplayData","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel"],(function(e,t,i,n){return e.extend({init:function(e,t,i,n){this._parent(e,t,i,n)},_getSGDisplayConfig:function(){return this._plugSvcs.getPluginSetting("SG_DISPLAY_CONFIG")},_crNode2tNode:function(e,t,i){let o=this;var r=i(e),s=new n(r);t.addChild(s),e.__TREENODE__=s;let a=e.getChildArray();s.setState({state:Array.isArray(a)&&a.length?"expanded":"noChildren"}),e.setExpandCollapseState(s.getState()),Array.isArray(a)&&a.forEach((function(e){o._crNode2tNode(e,s,i)}))},_crTrees2trTree:function(e,t,n){let o=new i,r=crTree.getRoot(0);return this._crNode2tNode(r,o,t),o},_doDisplayPrep:function(e,t,i){var n=[];return null==t?this._plugSvcs.errout("No crNode2tNodeFN defined... cannot convert"):(n[0]=this._crTrees2trTree(e,t,i),n[0].__CRTREE__=crTree),n},_loadGridView:function(e,t){let i=this;return this._parent(e,t).then((function(e){let t=e,n=i._getSGDisplayConfig();return t.set_propDisplayGroups(n.propDisplayGroups),t.set_treeDisplayLabels(n.treeDisplayLabels),t.setDefaultPropGroupName(n.initialPropDisplayGroupName),t}),(function(e){}))}})})),define("DS/CompareWidget2/plugins/EXPORT/exFormatter",["DS/CompareCommon/Utils","DS/CompareWidget2/plugins/DATA/attrValObj","i18n!DS/CompareWidget2/assets/nls/CompareExport","i18n!DS/CompareWidget2/assets/nls/CompareV2"],(function(e,t,i,n){var o="synthProp_";function r(e,t){var i=!1;if(null==e&&null!=t||null!=e&&null==t)i=!0;else if(e.length!=t.length)i=!0;else if(e.constructor!=t.constructor)i=!0;else if(e.constructor!=Array)e!=t&&(i=!0);else for(var n=0;n<e.length;n++)e[n]!=t[n]&&(i=!0);return i}function s(e){let t=Array.isArray(e)?e.length:0;e=e||[];for(var i={},n=0;n<t;n++)if(!e[n]||"thumbnail"!=e[n].type){var o=e[n]?e[n].getFormattedValue():null;i[`${e[n].name}`]=o}return i}function a(e,t){let n="",o=Array.isArray(e)?e.length:Array.isArray(t.length)?t.length:0;e=e||[],t=t||[];for(var s=0;s<o;s++){if(e[s]&&"thumbnail"==e[s].type||t[s]&&"thumbnail"==t[s].type)continue;var a=e[s]?e[s].nls:null,l=t[s]?t[s].nls:null,u=e[s]?e[s].getFormattedValue():null,c=t[s]?t[s].getFormattedValue():null;if(r(u,c))""!==n&&(n+="\r\n"),n+=i.replace(i.get("ReferenceAttribute"),{attributeName:a,attributeValue:u})+", "+i.replace(i.get("ComparedAttribute"),{attributeName:l,attributeValue:c})}return n}function l(t,i){var n="";let o=e.intersectionDifference(t,i,((e,t)=>e.name===t.name)),r=o[0].intersection,s=o[1].intersection,l=o[0].difference,u=o[1].difference;return n+=a(r,s)+a(l,null)+a(null,u)}function u(e,t){if(relName="",null!=t){let i=t[e];if(null!=i&&""!==i){let e=n[i.NLS];null!=e&&""!==e&&(relName=e)}}return relName}function c(e,t){var i=u(e,t.CUSTOM_MATCH_ADJ_FLAGS);return""===i&&""===(i=u(e,t.CUSTOM_RULE_ID_FLAGS))&&""===(i=u(e,t.SYSTEM_RULE_ID_FLAGS))&&(i=e),i}var d={createOutputTables:function(e,i,n,r,s,a,u){var d=[],p="list"==e;return n.forEach((function(n){var h=null;p?h=n.getCRList().getMatchPairArray():h=n.getMatchPairArray();h.forEach((function(n){var h="",_="",g="",f="",S="",m="",C="",T="",E="onPremise",v="",D="",I=[],y=[],b=[],R="",A="",O="",P="",N="",w="",L="",U="",F="onPremise",M="",V="",x=[],W=[],j=[],G=n.getBaseNode(),B=n.getCompNode();let k=G.__TREENODE__.isVisible(),H=B.__TREENODE__.isVisible();if(k&&H){if(0==G.isDummy()){try{if(null!=G.__TREENODE__){let e=G.__TREENODE__._options.grid,i=G.__TREENODE__._options.NLS_RESOLVED;Object.keys(e).forEach((function(n){if(n.startsWith(o)){let o=n,r=e[n],s=new t(o,i[o],r);b.push(s)}}))}}catch(e){console.error("Failure getting cust attrs:: "+e+", continuing")}g=(h=G.getObjIDSpec_REF()).getPhysID(),f=(_=G.getObjIDSpec_INST())?_.getPhysID():null,S=G.getTitle(),null!=(m=G.getAttr("revision"))&&""!==m&&(S+=" "+m),C=G.getType(),T=G.qty,E=h.getTenant(),v=h.getServiceName(),D=h.getSecurityContext();let e=i.REFERENCE._getFromCache(E,v,D,g);if(null!==e){I=e.attrVals;let t=e.getAttrByName("type");null!=t&&(C=t.value)}if(_&&null!=i.INSTANCE){let e=i.INSTANCE._getFromCache(E,v,D,f);null!==e&&(y=e.attrVals)}}if(0==B.isDummy()){try{if(null!=G.__TREENODE__){let e=B.__TREENODE__._options.grid,i=G.__TREENODE__._options.NLS_RESOLVED;Object.keys(e).forEach((function(n){if(n.startsWith(o)){let o=n,r=e[n],s=new t(o,i[o],r);j.push(s)}}))}}catch(e){console.error("Failure getting cust attrs:: "+e+", continuing")}O=(R=B.getObjIDSpec_REF()).getPhysID(),P=(A=B.getObjIDSpec_INST())?A.getPhysID():null,N=B.getTitle(),null!=(w=B.getAttr("revision"))&&""!==w&&(N+=" "+w),L=B.getType(),U=B.qty,F=R.getTenant(),M=R.getServiceName(),V=R.getSecurityContext();let e=i.REFERENCE._getFromCache(F,M,V,O);if(null!==e){x=e.attrVals;let t=e.getAttrByName("type");null!=t&&(L=t.value)}if(A&&null!=i.INSTANCE){let e=i.INSTANCE._getFromCache(F,M,V,P);null!==e&&(W=e.attrVals)}}var Y=n.getAllStatusArray(!1);if(Array.isArray(s)&&s.length>0)for(var X=0;X<Y.length;++X)s.indexOf(Y[X])>=0&&(Y[X]="IDENTICAL");var z=Y.map((e=>c(e,r))).toString(),K=n.getDepth(),q=C||L,Q=B.isDummy()||G.isDummy(),J=Q?"":l(I,x),$=Q?"":l(y,W);let k=[];if("MULTI"==e){let e="",t="",i=[],n=[];if(1==u){for(let t=0;t<b.length;t++){let n=b[t],o=n.name.toUpperCase();o.endsWith("QUANT")||o.endsWith("COUNT")?e=n.value:i.push(n)}let n=[];for(let e=0;e<j.length;e++){let i=j[e],o=i.name.toUpperCase();o.endsWith("QUANT")||o.endsWith("COUNT")?t=i.value:n.push(i)}}else i=b,n=j;let o=Q?"":l(i,n);o.length>0&&(J=J.length>0?o+"\r\n"+J:o),a&&k.push(K),u&&k.push(e),k.push(S),u&&k.push(t),k.push(N,q,z,J)}else k=p?[T,S,U,N,q,z,J]:[K,S,N,q,z,J,$];d.push(k)}}))})),d},createOutputTablesNewFormat:function(e,t,i,n,r,a,l){var u=[];u.push(...a);var d=[],p="list"==e;return i.forEach((function(e){var i=null;p?i=e.getCRList().getMatchPairArray():i=e.getMatchPairArray();i.forEach((function(e){var i="",a="",h="",_="",g="",f="onPremise",S="",m="",C=[],T=[],E=[],v={},D="",I="",y="",b="",R="",A="onPremise",O="",P="",N=[],w=[],L=[],U={},F=e.getBaseNode(),M=e.getCompNode();let V=F.__TREENODE__.isVisible(),x=M.__TREENODE__.isVisible();if(V&&x){if(0==F.isDummy()){try{if(null!=F.__TREENODE__){let e=F.__TREENODE__._options.grid;Object.keys(e).forEach((function(t){if(t.startsWith(o)){let i=t,n=e[t];v[i]=n}}))}}catch(e){console.error("Failure getting cust attrs:: "+e+", continuing")}h=(i=F.getObjIDSpec_REF()).getPhysID(),_=(a=F.getObjIDSpec_INST())?a.getPhysID():null,baseTitle=F.getTitle(),g=F.qty,f=i.getTenant(),S=i.getServiceName(),m=i.getSecurityContext();let e=t.REFERENCE._getFromCache(f,S,m,h);if(null!==e&&(C=e.attrVals),a){if(null!=t.INSTANCE){let e=t.INSTANCE._getFromCache(f,S,m,_);null!==e&&(T=e.attrVals)}if(null!=t.EFFECTIVITY){let e=t.EFFECTIVITY._getFromCache(f,S,m,_);null!==e&&(E=e.attrVals)}}}if(0==M.isDummy()){try{if(null!=F.__TREENODE__){let e=M.__TREENODE__._options.grid;Object.keys(e).forEach((function(t){if(t.startsWith(o)){let i=t,n=e[t];U[i]=n}}))}}catch(e){console.error("Failure getting cust attrs:: "+e+", continuing")}y=(D=M.getObjIDSpec_REF()).getPhysID(),b=(I=M.getObjIDSpec_INST())?I.getPhysID():null,compTitle=M.getTitle(),R=M.qty,A=D.getTenant(),O=D.getServiceName(),P=D.getSecurityContext();let e=t.REFERENCE._getFromCache(A,O,P,y);if(null!==e&&(N=e.attrVals),I){if(null!=t.INSTANCE){let e=t.INSTANCE._getFromCache(A,O,P,b);null!==e&&(w=e.attrVals)}if(null!=t.EFFECTIVITY){let e=t.EFFECTIVITY._getFromCache(A,O,P,b);null!==e&&(L=e.attrVals)}}}var W=e.getAllStatusArray(!1);if(Array.isArray(r)&&r.length>0)for(var j=0;j<W.length;++j)r.indexOf(W[j])>=0&&(W[j]="IDENTICAL");var G=W.map((e=>c(e,n))).toString(),B=e.getDepth(),k=e.getLevel(),H="",Y="",X="",z="";F.isDummy()||(H=s(C),Y=s(T),X=s(E),z=v);var K="",q="",Q="",J="";M.isDummy()||(K=s(N),q=s(w),Q=s(L),J=U);var $=[],Z=!1;if((F.isHeaderRow()||M.isHeaderRow())&&($.push(""),$.push(""),$.push(""),$.push(F._attrList.title),$.push(M._attrList.title),Z=!0),!1===Z){$.push(G),p?($.push(g),$.push(R)):1==l&&($.push(k),$.push(B));for(j=$.length;j<u.length;j++)u[j].isLeftSide?"INST"==u[j].attrType?$.push(Y[u[j].name]):"REF"==u[j].attrType?$.push(H[u[j].name]):"EFF"==u[j].attrType?$.push(X[u[j].name]):"CUST"==u[j].attrType?$.push(z[u[j].name]):console.error("UNKNOWN ATTR TYPE IN EXPORT... skipping"):"INST"==u[j].attrType?$.push(q[u[j].name]):"REF"==u[j].attrType?$.push(K[u[j].name]):"EFF"==u[j].attrType?$.push(Q[u[j].name]):"CUST"==u[j].attrType?$.push(J[u[j].name]):console.error("UNKNOWN ATTR TYPE IN EXPORT... skipping")}$.forEach(((e,t)=>{void 0===e&&($[t]="")})),d.push($)}}))})),d},getHeaderRow:function(e,t,i,n,o){var r=[];return Object.keys(n).forEach((function(e){-1==n[e].indexOf("thumbnailimage")&&n[e].push("thumbnailimage")})),d.createHeaderRow(e,t,i,n,r,o),r},createHeaderRow:function(e,t,n,o,r,s){var a=[],l=[],u=[],c=o.REF,p=o.INST,h=o.EFF;n.forEach((function(i){var n=null;"list"==e?n=i.getCRList().getMatchPairArray():n=i.getMatchPairArray();n.forEach((function(i){var n="",o="",r="",s="",_="onPremise",g="",f="",S=[],m=[],C=[],T="",E="",v="",D="",I="onPremise",y="",b="",R=[],A=[],O=[],P=i.getBaseNode();if(0==P.isDummy()){r=(n=P.getObjIDSpec_REF()).getPhysID(),s=(o=P.getObjIDSpec_INST())?o.getPhysID():null,_=n.getTenant(),g=n.getServiceName(),f=n.getSecurityContext();let e=t.REFERENCE._getFromCache(_,g,f,r);if(null!==e&&(S=e.attrVals),o){if(null!=t.INSTANCE){let e=t.INSTANCE._getFromCache(_,g,f,s);null!==e&&(m=e.attrVals)}if(null!=t.EFFECTIVITY){let e=t.EFFECTIVITY._getFromCache(_,g,f,s);null!==e&&(C=e.attrVals)}}}var N=i.getCompNode();if(0==N.isDummy()){v=(T=N.getObjIDSpec_REF()).getPhysID(),D=(E=N.getObjIDSpec_INST())?E.getPhysID():null,I=T.getTenant(),y=T.getServiceName(),b=T.getSecurityContext();let e=t.REFERENCE._getFromCache(I,y,b,v);if(null!==e&&(R=e.attrVals),E){if(null!=t.INSTANCE){let e=t.INSTANCE._getFromCache(I,y,b,D);null!==e&&(A=e.attrVals)}if(null!=t.EFFECTIVITY){let e=t.EFFECTIVITY._getFromCache(I,y,b,D);null!==e&&(O=e.attrVals)}}}if("MULTI"==e){let e=P.__TREENODE__;d.gatherSyntheticPropHeaders(a,e)}d.gatherHeaderAttrs(a,S,c,"REF"),d.gatherHeaderAttrs(a,R,c,"REF"),d.gatherHeaderAttrs(l,m,p,"INST"),d.gatherHeaderAttrs(l,A,p,"INST"),d.gatherHeaderAttrs(u,C,h,"EFF"),d.gatherHeaderAttrs(u,O,h,"EFF")}))})),"list"==e?(r.push(...a),r.unshift({name:"compQty",displayName:""+(i.Quantity+" 2"),isLeftSide:!1}),r.unshift({name:"baseQty",displayName:""+(i.Quantity+" 1"),isLeftSide:!0})):(r.push(...a,...l,...u),1==s&&(r.unshift({name:"depth",displayName:i.Depth}),r.unshift({name:"level",displayName:i.Level}))),r.unshift({name:"relName",displayName:i.ComparisonStatus})},gatherSyntheticPropHeaders:function(e,t){if(null!=t){let r=t._options.grid||{},s=Object.keys(r);for(var i=0;i<s.length;i++){let r=s[i];if(r.startsWith(o)&&!e.some((e=>e.name===r))){let i="";i=null!=t._options&&null!=t._options.NLS_RESOLVED?t._options.NLS_RESOLVED[r]:r.slice(10);for(var n=1;n<3;n++)e.push({name:r,displayName:""+(i+" "+n),isLeftSide:1==n,attrType:"CUST"})}}}},gatherHeaderAttrs:function(t,n,o,r){let s="INST"==r;n.forEach((n=>{if(n.hasOwnProperty("name")&&!o.includes(n.name)&&!t.some((e=>e.name===n.name))){var a=s?i.InstanceAttrDiapNamePostfix:"";e.isTitleAttr(n,s)?(t.unshift({name:n.name,displayName:""+(n.nls+" 2"+a),isLeftSide:!1,attrType:r}),t.unshift({name:n.name,displayName:""+(n.nls+" 1"+a),isLeftSide:!0,attrType:r})):(t.push({name:n.name,displayName:""+(n.nls+" 1"+a),isLeftSide:!0,attrType:r}),t.push({name:n.name,displayName:""+(n.nls+" 2"+a),isLeftSide:!1,attrType:r}))}}))},stripHeaderData:function(e){strippedHeaderRow=[];for(var t=0;t<e.length;t++)strippedHeaderRow.push(e[t].displayName);return strippedHeaderRow}};return d})),define("DS/CompareWidget2/plugins/STRUCTURE/flexibleView/ViewPanel/crTreeSetFns",["DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crTree"],(function(e){return{create_crTreeArray:function(t){let i=[];if(1==t)i[0]=new e;else for(let n=0;n<t;n++)i[n]=new e(n);return i}}})),define("DS/CompareWidget2/plugins/STRUCTURE/flexibleView/ViewPanel/gridView/gridView_tree",["DS/CompareWidget2/plugins/STRUCTURE/flexibleView/ViewPanel/gridView/gridView","DS/CompareCommon/Utils","i18n!DS/CompareWidget2/assets/nls/CompareV2","DS/CompareWidget2/ViewDefModules/DSColors"],(function(e,t,i,n){var o="synthProp_";const r="REF.ds6w:label";return e.extend({init:function(e,t){this._parent(e,t),this._DISPLAY_PROPS={fixed:null!=e.DISPLAY_PROPS&&null!=e.DISPLAY_PROPS.fixed?e.DISPLAY_PROPS.fixed:[],scrollable:null!=e.DISPLAY_PROPS&&null!=e.DISPLAY_PROPS.scrollable?e.DISPLAY_PROPS.scrollable:[]},this._SYNTHETIC_PROPS=e.CUSTOM_PROPS||e.SYNTHETIC_PROPS||{},this._displayPropNLS={}},getGridIDs:function(){let e=this.getViewID();return["struct-tree-"+e+"-left","struct-tree-"+e+"-right"]},initAsync:function(e){return this._resolveAllDisplayPropNLS(e)},getDGVContainersConfig:function(){let e=this.getGridIDs();return[{id:e[0],panelCaption:i.Left,panelAddClass:"treePanel-cmpBase",panelCollapseable:!0,initSize50pct:!0,color:this._baselineColor,styles:{display:"flex","flex-direction":"column","border-top":"4px solid "+this._baselineColor,width:"50%"}},{id:e[1],panelCaption:i.Right,panelAddClass:"treePanel-cmpCmp",panelCollapseable:!1,initSize50pct:!0,color:this._compareColor,styles:{display:"flex","flex-direction":"column","border-top":"4px solid "+this._compareColor,padding:"0px 3px",width:"50%"}}]},getTreeNodeModelConfig:function(e,t){let i=this,n=e.isDummy()?1:1==e._riNode.getAttr("REF.hideNode")?0:1;if(e.isDummy()){let t=e.getMatchInfo().getBaseNode(),i=e.getMatchInfo().getCompNode();null==t||t.isDummy()?null==i||i.isDummy()||(n=1==i._riNode.getAttr("REF.hideNode")?0:1):n=1==t._riNode.getAttr("REF.hideNode")?0:1}let r={data:e,label:e.getAttr("title"),icons:[e.getAttr("typeIconSmallURL")],NLS_RESOLVED:{},grid:{rev:e.getAttr("revision"),type:e.getAttr("type"),showByStatusFilter:1,showByTypeAttrFilter:n}},s=e.getRefInstNode();if(null!=s){let e=this._DISPLAY_PROPS;e.fixed.forEach((function(e){var t=s.getAttr(e)||"";null!=i._displayPropNLS[e]?r.grid[e]=t:(displayPropWithPrefix=o+e,r.grid[displayPropWithPrefix]=t,r.NLS_RESOLVED[displayPropWithPrefix]=i._displayPropNLS[displayPropWithPrefix])})),e.scrollable.forEach((function(e){var t=s.getAttr(e)||"",n=i._displayPropNLS[e];null==n?r.grid[e]=t:(r.grid[o+e]=t,r.NLS_RESOLVED[o+e]=n)}))}return"relations"!==e.getAttr("type")&&(r.grid.qty=e.qty),e.hasExternalFilter()&&(r.badges={bottomRight:"filter wux-layouts-treeview-badge compare-badge"}),e.getMatchInfo().getAllStatusArray(!0).forEach((function(e,i){var n=t.getFlagDisplayDataItem(e);r.grid["FLAG_"+i]=n.color})),r},_resolveAllDisplayPropNLS(e){let t=this,i={},n=this._DISPLAY_PROPS,s=[];s.push(r);let a=n.fixed.concat(n.scrollable),l={};return Object.keys(t._SYNTHETIC_PROPS).forEach((function(e){let i=t._SYNTHETIC_PROPS[e];l[i.NAME]=i})),a.forEach((function(e){let t=l[e];null!=t?i[o+e]=t.NLS_RESOLVED||e:s.push(e)})),t.lookupSystemPropNLS(e,s).then((function(e){i={...i,...e},t._displayPropNLS=i}),(function(e){i={...i,...e},t._displayPropNLS=i}))},getColDefs:function(e,t){let i=[],n=this,o=this.getGridIDs().length;for(let u=0;u<o;u++){let o=[],c=0==u?n._baselineColor:n._compareColor,d={text:n._displayPropNLS[r],icon:{iconName:"product",fontIconFamily:WUXManagedFontIcons.Font3DS},dataIndex:"tree",typeRepresentation:"string",width:"auto",resizableFlag:!1,minWidth:200,pinned:"left",sortableFlag:!1,resizableFlag:!0,getCellKPIColor:function(e){let t=null,i=e.nodeModel.options.data;return this._flagPropDiff("title",i)&&(t=c),t}.bind(this),onCellRequest:function(t){return e(u,t)}};o.push(d);var s=this._DISPLAY_PROPS,a=s.scrollable.length>0;if(s.fixed.forEach((function(e){let t=n._createColSpec(c,e);a&&(t.pinned="left"),o.push(t)})),s.scrollable.forEach((function(e){let t=n._createColSpec(c,e);o.push(t)})),u>0){var l=this._getColorColumnsDef(t);o=l.concat(o)}i.push(o)}return i},_specializeCol:function(e,t){switch(e){case"REF_ds6w:status_ATTR":delete(t=UWA.extend(t,{typeRepresentation:"tag",width:90,hasCellValue:function(e){return!!(e.nodeModel&&e.nodeModel.getLabel()&&e.nodeModel.getLabel().length>0)},getCellClassName:function(e){if(e.nodeModel&&e.nodeModel.options.data)return e.nodeModel.options.data.getAttr("maturity.class")}})).getCellKPIColor;break;case"REF_ds6wg:revision_ATTR":t=UWA.extend(t,{width:80})}return t},_flagPropDiff:function(e,t){let i=!1,n=t.getMatchInfo();return n.getBaseNode().isDummy()||n.getCompNode().isDummy()||n.isAttributeValueEqual(e)||null==t.getAttr(e)||""===t.getAttr(e)||(i=!0),i},_createColSpec:function(e,t){let i=t.startsWith("REF")?"product":"flow-cascade",n=t,r=this._displayPropNLS[n];null==r&&(n=o+n,r=this._displayPropNLS[n]);var s={text:r,icon:{iconName:i,fontIconFamily:WUXManagedFontIcons.Font3DS},dataIndex:n,width:150,minWidth:25,typeRepresentation:"string",sortableFlag:!1,resizableFlag:!0,getCellKPIColor:function(i){let n=null,o=i.nodeModel.options.data;return this._flagPropDiff(t,o)&&(n=e),n}.bind(this)};return s=this._specializeCol(t,s)},_getColorColumnsDef:function(e){for(var t=[],i=e.getMaxFlagsPerEntry(),n=0;n<i;n++){let i="FLAG_"+n.toString();var o=this,r={typeRepresentation:"color",dataIndex:i,width:8.5,minWidth:8.5,pinned:"left",resizableFlag:!1,sortableFlag:!1,hasCellValue:function(t){return o._hasCellValue(t,e,i)},getCellTooltip:function(t){return o._getFlagTooltip(t,e)},onCellRequest:this._onCellRequest};t.push(r)}return t},_hasCellValue:function(e,t,i){var o=!1;if(i.startsWith("FLAG_")){var r=Number(i.split("_")[1]),s=e.nodeModel.options.data,a=s.areAnyChildrenVisible(),l=s.getMatchInfo().getAllStatusArray(!a);if(Array.isArray(l)&&r<l.length){var u=l[r],c=t.getFlagDisplayDataItem(u);if(null!=c){var d=c.color,p=c.visibleFlag;null!=d&&d!==n.colorDef.WHITE&&1==p&&(o=!0)}}}return o},_getFlagTooltip:function(e,n){var o=[],r=null==e.nodeModel?null:e.nodeModel.options.data.getMatchInfo();r&&(o=r.getAllStatusArray(!0));var s,a=Number(e.columnID);if(Array.isArray(o)&&a<o.length&&o.length>0){var l=o[a],u=n.getFlagDisplayDataItem(l);if(null!=u.color&&u.visibleFlag){var c=u.label,d=u.modulePath;Object.entries(i).map((([e,i])=>{i===c&&(s=t.generateTooltip(d,e))}))}}return s},_onCellRequest:function(e){this.defaultOnCellRequest(e),e.cellView.getContent().addClassName("compare-color-column")}})})),define("DS/CompareWidget2/plugins/STRUCTURE/singleGridView/gridView_singleGrid",["DS/CompareWidget2/plugins/STRUCTURE/flexibleView/ViewPanel/gridView/gridView_tree","DS/CompareCommon/Utils","i18n!DS/CompareWidget2/assets/nls/CompareV2","DS/CompareWidget2/ViewDefModules/DSColors","DS/CompareWidget2/support/attrNLS_mgr"],(function(e,t,i,n,o){return e.extend({init:function(e,t){this._parent(e,t),this._defaultPropGroupName=null,this._propDisplayGroups=null},getGridIDs:function(){return["struct-"+this._displayMode.id+"-display"]},set_propDisplayGroups:function(e){this._propDisplayGroups=e},get_propDisplayGroups:function(){return this._propDisplayGroups},set_treeDisplayLabels:function(e){this._treeDisplayLabels=e},setDefaultPropGroupName(e){this._defaultPropGroupName=e},getDefaultPropGroupName(){let e=null;return e=null==this._defaultPropGroupName?this._propDisplayGroups[0].NLS_resolved:this._defaultPropGroupName,e},getDGVContainersConfig:function(){return[{id:this.getGridIDs()[0],includeTreeHeader:!1,panelCaption:i.Left,panelAddClass:"treePanel-cmpBase",panelCollapseable:!0,initSize100pct:!0,color:this._baselineColor,styles:{display:"flex","flex-direction":"column",width:"100%"}}]},getColDefs:function(e,t){let n=this,o=[],r={text:n._treeDisplayLabels[0].name,dataIndex:"tree",className:" sg-not-last-col-in-group",typeRepresentation:"string",width:"20%",minWidth:150,resizableFlag:!0,pinned:"left",sortableFlag:!0,onCellRequest:function(t){return e(0,t)}};o.push(r);let s={text:i.REV,className:" sg-last-col-in-group",dataIndex:"rev",width:50,minWidth:30,typeRepresentation:"string",sortableFlag:!1,resizableFlag:!0,pinned:"left",alignment:"center"};o.push(s);let a=this._propDisplayGroups.length,l=n._baselineColor,u=this._compAssemCount;for(var c=0;c<u;c++){let e=[];for(var d=0;d<a;d++){let t=this._propDisplayGroups[d],i=t.displayProps.length;for(var p=0;p<i;p++){let n=t.displayProps[p],o=c,r=this._createDataColumnSpec(l,o,u,n);r.className+=c>0&&p==i-1?" sg-last-col-in-group":" sg-not-last-col-in-group",0==c&&(r.pinned="left"),e.push(r)}}l=n._compareColor;let t=n._treeDisplayLabels[c+1],i=this.createColGroupSpec(c,t,e);o.push(i)}return[o]},createColGroupSpec:function(e,t,i){return{text:t.name,icon:t.icon,icon:{iconName:"stop",fontIconFamily:1},className:" sg-not-last-col-in-group",alignment:"right",dataIndex:e,children:i}},_createDataColumnSpec:function(e,t,i,n){let o=this,r=t+"_"+n.propName;var s={text:n.NLS_resolved,className:"single-grid-cost-value",dataIndex:r,propName:n.propName,width:100,minWidth:75,typeRepresentation:"string",sortableFlag:!1,resizableFlag:!0,alignment:"center",getCellKPIColor:function(s){let a=null,l=s.nodeModel.options.grid;return o._flagPropDiff(l,t,n.propName,i,r)&&(a=e),a}.bind(this)};return null!=n.icon&&(s.icon={iconName:n.icon.iconName,fontIconFamily:n.icon.iconFamily}),s},_flagPropDiff(e,t,i,n,o){let r=!1;try{let s=e[o];if(null!=s&&0!=s.length&&s!=this._pluginOptions.noValSymbol)if(0==t){let t=s;for(let o=1;o<n;o++){let n=e[o+"_"+i];if(null!=n&&0!=n.length&&n!=this._pluginOptions.noValSymbol&&t!=n){r=!0;break}}}else{r=e["0_"+i]!=s}}catch(e){console.error("EXCEPTION DETERMING FLAG VAL: "+e)}return r},_addColData:function(e,t,i){let n=this._propDisplayGroups.length;for(var o=0;o<n;o++){let n=this._propDisplayGroups[o],s=n.displayProps.length;for(var r=0;r<s;r++){let o=n.displayProps[r].propName,s=null==e?"+++":"function"==typeof e.getSynthProp?e.getSynthProp(o):"+++";null!=s&&0!=s.length||(s=0==r?this._pluginOptions.noValSymbol:""),i.grid[t+"_"+o]=s}}},getTreeNodeModelConfig:function(e,t){let i=e.isDummy()?1:1==e._riNode.getAttr("REF.hideNode")?0:1,n={data:e,label:e.getAttr("title"),icons:[e.getAttr("typeIconSmallURL")],NLS_RESOLVED:{},grid:{rev:e.getAttr("revision"),type:e.getAttr("type"),showByStatusFilter:1,showByTypeAttrFilter:i}},o=e.getAllMatchInfo(),r=o.length;this._compAssemCount=r;for(var s=0;s<r;s++){let e=o[s];if(null!=e){let t=e.getCompNode();this._addColData(t,s,n)}}return n}})})),define("DS/CompareWidget2/framework/pluginServices",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/support/DataCenter","DS/CompareCommon/Utils","DS/CompareWidget2/userSettings/UserSettingsManager","DS/LifecycleServices/LifecycleServicesSettings","DS/CompareWidget2/framework/CPF_configMgr"],(function(e,t,i,n,o,r){return function(s,a){this._viewPanelMgr=s,this._eventMgr=a,this.makeAuthHttpsCall=function(e,i,n,o,r,s,a,l,u,c,d){return t.makeAuthHttpsCall(e,i,n,o,r,s,a,l,u,c,d)},this.subscribe=function(e,t){return this._eventMgr.subscribe({event:e},t)},this.unsubscribe=function(e){return this._eventMgr.unsubscribe(e)},this.postEvent=function(e,t){var i=t||{},n=i.isAsync,o=i.catchExceptions;if(widget.recordForODT){let t=null==i?"null":JSON.stringify(JSON.decycle(i));console.log("COMPARE EVENT INPUT: "+e),console.log(e+" DATA: "+t)}this._eventMgr.publish({event:e,data:null==t?null:t,propagate:!0,target:this,isAsync:n,catchExceptions:o})},this.requestFrame=function(e){return this._viewPanelMgr.requestFrame(e)},this.addPanel=function(e,t,i,n,o){return this._viewPanelMgr.addPanel(e,t,i,n,o)},this.clearCurrentlySelectedRowIDs=function(e){this._viewPanelMgr.clearCurrentlySelectedRowIDs(e)},this.makeServiceURL=function(e,t,i,n){return"https:"===i.substring(0,6)?i:o.getPlatformWSUrl(e,t,i,n)},this.createRandomString=function(t,i,n){return e.createRandomString(t,i,n)},this.dbgout=function(t,i){e.dbgout2(!0,t,i)},this.warnout=function(t){e.warnout("[PLUGIN] "+t)},this.errout=function(t){e.errout("[PLUGIN] "+t)},this.enableDebugLabel=function(t){e.enableDebugLabel(t)},this.disableDebugLabel=function(t){e.disableDebugLabel(t)},this.showAlertBox=function(e,t,n,o){return i.showAlertBox(e,t,n,o)},this.confirmDialog=function(e,t,n){return i.confirmDialog(e,"fonticon-attention",t,n)},this.nowMS=function(){return e.nowMS()},this.reportTime=function(t,i){e.reportTime(t,"[PLUGIN]"+i)},this.csValsEquivalent=function(t,i,n){return e.csValsEquivalent(t,i,n)},this.loadPref=function(e,t){return new Promise((function(t,i){t(this.getUserSetting(e))}))},this.savePref=function(e,t){this.setUserSetting(e,t)},this.getUserSetting=function(e){var t=null;try{t=n.get(e)}catch{this.warnout("Failed to retrieve user setting for "+e+"; returning empty string")}return t},this.setUserSetting=function(e,t){try{n.set(e,t)}catch(i){this.warnout("Failed to save user setting '"+e+"' to '"+t+"'")}},this.getPluginOptions=function(e){return r.getPluginOptions[e]},this.setPluginSetting=function(e,t){r.setPluginSetting(e,t)},this.getPluginSetting=function(e){return r.getPluginSetting(e)},this.getRunOptions=function(){return r._currentViewConfig.runOptions},this.getCurrentViewSetID=function(){return r.getCurrentViewSetID()},this.getUserRunOptions=function(){return this.getRunOptions()}}})),define("DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structDefaultContextMenu",["UWA/Core","DS/CompareWidget2/viewComponents/ContextMenuBase","DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structExpandCollapseMenu","DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structOpenWithMenu"],(function(e,t,i,n){"use strict";return t.extend({init:function(e){this._structComparePanel=e.structComparePanel,this._expandCollapseMenu=new i(e),this._openWithMenu=new n(e)},createContextMenu:function(e){var t=this;return new Promise((function(i){var n=[];if(null!=e&&void 0!==e.collectionView&&null!==e.collectionView)if(function(e){return null==e||void 0===e.cellInfos||null===e.cellInfos||void 0===e.cellInfos.cellModel||null===e.cellInfos.cellModel}(e))i(n);else{var o=e.cellInfos.nodeModel.getTreeDocument().getSelectedNodes(),r={useSelectionInContext:null==t._structComparePanel.isList||!t._structComparePanel.isList()};t._openWithMenu.getOpenWithMenuPromise(e,o,r).then((function(o){null!=o&&void 0!==o.submenu&&null!==o.submenu&&o.submenu.length>0&&n.push(o);var r=t._expandCollapseMenu.getExpandCollapseContextMenu(e,t._structComparePanel.getActiveExpandMenuId());if(null!=r&&void 0!==r.submenu&&null!==r.submenu&&r.submenu.length>0&&(n.length>0&&n.push({type:"SeparatorItem"}),n.push(r)),void 0!==e.additionalMenus&&null!==e.additionalMenus&&e.additionalMenus.length>0)for(var s of(n.length>0&&n.push({type:"SeparatorItem"}),e.additionalMenus))n.push(s);i(n)}))}else i(n)}))},onComparePanelUpdated:function(){void 0!==this._openWithMenu&&null!==this._openWithMenu&&this._openWithMenu.clearLaunchTreeArray()}})})),define("DS/CompareWidget2/ViewDefModules/CostingViewDefOptions",["DS/CompareWidget2/ViewDefModules/ViewDefOptions","DS/CompareWidget2/ViewDefModules/DSColors","DS/CompareCommon/Utils","i18n!DS/CompareWidget2/assets/nls/implementations/costing/Costing"],(function(e,t,i,n){"use strict";UWA.extend(e.FRAMEWORK_OPTIONS,{customCompareActive:!1});UWA.extend(e.CV_PROPS,{NAME:"REF.name"});var o={};UWA.extend(o,e.STRUCT_AGG_TREE);var r={PROPS:e.CV_PROPS,COMPUTE_DIFFERENT:!0,FORCE_ROOTS_TOGETHER:!0,SYSTEM_RELATIONSHIP_NAMES:["LEFT_ONLY","RIGHT_ONLY","UNRELATED"],CUSTOM_RELATIONSHIP_NAMES:["MATCH"],CUSTOM_COMPARISONS:{COMP_PHYSID:[["PHYSICALID","PHYSICALID"],["EQ"]]}};UWA.merge(r,e.STRUCT_COMPARE_OPTIONS);var s={CELL_DRAG_ENABLED_FLAG:!1,ENABLE_OVERVIEW:!1,ENABLE_DND:!1,INITIAL_EXPAND_LEVELS:1,colorLeft:e.STRUCT_COLORS.BASELINE,colorRight:e.STRUCT_COLORS.COMPARE,noValSymbol:n["N/A"],TOOLBAR_NLS:{baseStr:n.BASELINE,compStr:n.COMP},CUSTOM_RULE_ID_FLAGS:{MATCH:{COLOR:t.colorDef.GREEN2,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"SM"}}};UWA.merge(s,e.STRUCT_DISPLAY_OPTIONS);var a={gridViewAMDPath:"DS/CompareWidget2/plugins/STRUCTURE/singleGridView/gridView_singleGrid",displayMode:{id:"single-grid",icon:"tree-view-all",title:"",tooltip:i.generateTooltip("CompareWidget2/Tooltips","StructureView"),expandCollapseEnabled:!0,rowSelection:"single",showColumnBorderFlag:!1},DISPLAY_PROPS:{fixed:null,scrollable:null}};return UWA.merge(a,s),{SG_AGG_COSTING_OPTIONS:o,SG_COMPARE_COSTING_OPTIONS:r,SG_DISPLAY_PREP_COSTING_OPTIONS:a,SG_DISPLAY_COSTING_OPTIONS:s}})),define("DS/CompareWidget2/ViewDefModules/CostingViewDefs",["DS/CompareWidget2/ViewDefModules/DefaultViewDefs_V2","DS/CompareWidget2/ViewDefModules/CostingViewDefOptions"],(function(e,t){var i={SG_AGG_COSTING:{Path:"DS/CompareWidget2/implementations/costing/SG_AGG_COSTING_plugin",Options:t.SG_AGG_COSTING_OPTIONS},SG_COMPARE_COSTING:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_COMPARE_plugin",Options:t.SG_COMPARE_COSTING_OPTIONS},SG_DISPLAY_PREP_COSTING:{Path:"DS/CompareWidget2/plugins/STRUCTURE/singleGridView/SG_DISPLAY_PREP_plugin",Options:t.SG_DISPLAY_PREP_COSTING_OPTIONS},SG_DISPLAY_COSTING:{Path:"DS/CompareWidget2/implementations/costing/SG_DISPLAY_COSTING_plugin",Options:t.SG_DISPLAY_COSTING_OPTIONS}};UWA.extend(e.PLUGDEFS,i);UWA.extend(e.VIEWDEFS,{STRUCT_VIEW_COSTING:["StructFetch","SG_AGG_COSTING","SG_COMPARE_COSTING","SG_DISPLAY_PREP_COSTING","SG_DISPLAY_COSTING"]});return UWA.extend(e.VIEWSETS,{COSTING_VIEWSET:{ROW:"STRUCT_VIEW_COSTING"}}),e})),define("DS/CompareWidget2/ViewDefModules/CATProductViewDefOptions",["UWA/Core","DS/CompareWidget2/ViewDefModules/DSColors"],(function(e,t){"use strict";var i={PHYSICALID:"REF.physicalid",VERSIONID:"REF.versionid",REF_LOGID:"REF.logicalid",DFR:"REF.dfr",INST_LOGID:"INST.logicalid",XFORM:"INST.matrixtxt"},n={DB_PROPS:{...i,INST_LOGID:"INST.logicalid[connection]",XFORM:"INST.xform"},CV_PROPS:i,CVURL_BY_TYPE:[{name:"DEFAULT",url:"/cvservlet/expand"}],DATA_SOURCE:"CV_DIRECT",DB_FALLBACK:!0,USE_MCS:!1},o={PROPS:i,COMPUTE_DIFFERENT:!0,FORCE_ROOTS_TOGETHER:!0,SYSTEM_RELATIONSHIP_NAMES:["LEFT_ONLY","RIGHT_ONLY","QUANTITY","DIFFERENT","UNRELATED"],CUSTOM_RELATIONSHIP_NAMES:["IDENTICAL","REVISION"],CUSTOM_COMPARISONS:{COMP_PHYSID:[["PHYSICALID","PHYSICALID"],["EQ","NEQ"]],COMP_VERID:[["VERSIONID","VERSIONID"],["EQ","EQ"]],COMP_NAME:[["NAME","NAME"],["EQ","EQ"]]},CUSTOM_MATCH_ADJUSTMENTS:[]},r={SYSTEM_RULE_ID_FLAGS:{LEFT_ONLY:{COLOR:t.colorDef.ORANGE,NLS:"LO"},RIGHT_ONLY:{COLOR:t.colorDef.BLUE1,NLS:"RO"},UNRELATED:{COLOR:t.colorDef.BLACK,NLS:"UNRELATED"},DIFFERENT:{COLOR:t.colorDef.BEIGE,NLS:"DIFFERENT"},QUANTITY:{COLOR:t.colorDef.BLUE2,NLS:"QUANTITY"}},CUSTOM_RULE_ID_FLAGS:{IDENTICAL:{COLOR:t.colorDef.NONE,NLS:"SM"},REVISION:{COLOR:t.colorDef.VIOLET,NLS:"REV"}},CONTEXT_MENU_PLUGIN:"DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structDefaultContextMenu",CELL_DRAG_ENABLED_FLAG:!1},s={colorLeft:r.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR,colorRight:r.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR};return{CV_PROPS:i,STRUCT_FETCH_OPTIONS:n,STRUCT_COMPARE_OPTIONS:o,STRUCT_DISPLAY_OPTIONS:r,ATTRIBUTE_DISPLAY_OPTIONS:s}})),define("DS/CompareWidget2/ViewDefModules/CATProductViewDefs",["DS/CompareWidget2/ViewDefModules/CATProductViewDefOptions"],(function(e){"use strict";var t={AttrFetch:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin"},AttrCompare:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin"},AttrDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",Options:e.ATTRIBUTE_DISPLAY_OPTIONS},InstAttrFetch:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin",Options:e.INST_ATTR_FETCH_OPTIONS},InstAttrCompare:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin"},InstAttrDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",Options:e.INST_ATTR_DISPLAY_OPTIONS},StructFetch:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_FETCH_plugin",Options:e.STRUCT_FETCH_OPTIONS},StructCompare:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_COMPARE_plugin",Options:e.STRUCT_COMPARE_OPTIONS},StructDisplay:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_DISPLAY_plugin",Options:e.STRUCT_DISPLAY_OPTIONS},StructListViewPrep:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_LIST_VIEW_PREP_PLUGIN"},Exporter:{Path:"DS/CompareWidget2/plugins/EXPORT/EXPORT_plugin",Options:e.STRUCT_DISPLAY_OPTIONS}};return UWA.merge({VIEWSETS:{STANDARD:{ROW:["STRUCT_VIEW",{COL:[["PROP_VIEW","INSTANCE_VIEW"]]}]}},VIEWDEFS:{PROP_VIEW:["AttrFetch","AttrCompare","AttrDisplay"],INSTANCE_VIEW:["InstAttrFetch","InstAttrCompare","InstAttrDisplay"],STRUCT_VIEW:["StructFetch","StructCompare","StructListViewPrep","StructDisplay","Exporter"]},PLUGDEFS:t},e)})),define("DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structFocusOnMenu",["UWA/Class","DS/CompareWidget2/userSettings/UserSettingsManager","i18n!DS/CompareWidget2/assets/nls/CompareV2"],(function(e,t,i){"use strict";return e.extend({init:function(e){this._structComparePanel=e.structComparePanel},getFocusOnContextMenuItem:function(e){let t=this;var n=null;return this._nodeTypeHas3DViewInfo(e)&&this._isSelectMode()&&(n={type:"PushItem",title:i.FocusOn,icon:"zoom-fit",action:{callback:function(){require(["DS/CompareCommon/CompareViewerFocusOnCmd"],(function(e){let i=new e({context:t});null!=i&&i.execute()}))}}}),n},_nodeTypeHas3DViewInfo:function(e){let t=!1;if(null!=e&&null!=e.cellInfos&&null!=e.cellInfos.nodeModel&&null!=e.cellInfos.nodeModel.options&&null!=e.cellInfos.nodeModel.options.data){var i=e.cellInfos.nodeModel.options.data.getObjIDSpec_REF();if(null!=i){var n=i.getObjType();t="VPMReference"===n||"3DShape"===n}}return t},_isSelectMode:function(){return!t.get("viewSettings.PAD3D_VIEW.view3D.isolate")}})})),define("DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structVPMRefContextMenu",["UWA/Core","DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structDefaultContextMenu","DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structFocusOnMenu"],(function(e,t,i){"use strict";return t.extend({init:function(e){this._parent(e),this._focusOnMenu=new i(e)},createContextMenu:function(e){var t=this._focusOnMenu.getFocusOnContextMenuItem(e);return null!=t&&null!=t&&(e.additionalMenus=[t]),this._parent(e)}})})),define("DS/CompareWidget2/implementations/costing/costingViewPanel",["DS/CompareWidget2/plugins/STRUCTURE/flexibleView/ViewPanel/structFlexibleViewPanel","DS/CompareWidget2/implementations/costing/costingToolbar","css!DS/CompareWidget2/assets/css/implementations/costing/costing.css"],(function(e,t){var i=e.extend({init:function(){this._parent(arguments[0])},buildOtherMenuItems:function(){return[]},refreshCB:function(){this._plugSvcs.postEvent("Event_CW2_REFRESH")},buildToolbar:function(e,i){return new t(e,this,{panelOptions:i,gridView:this._gridView,fvpTrees:this._fvpTrees,plugSvcs:this._plugSvcs})},syncToolbar:function(e){this._toolbar.syncToolbar(e)},showResults:function(e,t,i){let n=function(){this._toolbar.updateDisplayToCurrentPropGroup(),i()}.bind(this);this._parent(e,t,n)}});return i})),define("DS/CompareWidget2/plugins/EXPORT/exManager",["DS/CompareWidget2/plugins/EXPORT/CompareExporter","DS/CompareWidget2/plugins/EXPORT/exFormatter","DS/CompareWidget2/userSettings/UserSettingsManager","i18n!DS/CompareWidget2/assets/nls/CompareExport"],(function(e,t,i,n){var o=function(e){this._plugSvcs=e,this._exportInProgress=!1,this._exportInProgressDisplayed=!1};return o.prototype._safeGetSettingJSONArray=function(e){var t=[];try{let n=i.get(e);null!=n&&""!=n&&(t=JSON.parse(n))}catch{this._plugSvcs.warnout("Failed to retrieve user setting for "+e+"; returning empty string")}return t},o.prototype.displayExportInProgress=function(){this._exportInProgressDisplayed||(this._exportInProgressDisplayed=!0,this._plugSvcs.showAlertBox(n.CompareExportRunning,null,"warning"))},o.prototype.doExport=function(i,o,r,s,a,l,u){if(this._exportInProgress)this.displayExportInProgress();else{this._exportInProgress=!0;var c=this;let f=!0;if("MULTI"==r){f=!1;let e=o[0].getMatchPairArray();for(var d=0;d<e.length;d++){if(1!=e[d].getLevel()){f=!0;break}}}var p={columns:[],tables:[{rows:[]}]};if(!1===s){let e={REF:this._safeGetSettingJSONArray("viewSettings.PROP_VIEW.attributes_not_shown"),INST:this._safeGetSettingJSONArray("viewSettings.INSTANCE_VIEW.attributes_not_shown"),EFF:this._safeGetSettingJSONArray("viewSettings.EFFECTIVITY_VIEW.attributes_not_shown")};var h=t.getHeaderRow(r,i,o,e,f);p.columns=t.stripHeaderData(h),p.tables[0].rows=t.createOutputTablesNewFormat(r,i,o,u,a,h,f)}else{let n=!f;var _={structDisplayStyle:r,outputAttributeDifferences:!0,showLevel:f,showQuant:n};e.outHeader(_,p.columns),p.tables[0].rows=t.createOutputTables(r,i,o,u,a,f,n)}if(null==p.tables[0].rows)this._plugSvcs.showAlertBox(n.CompareExportFailure,null,"error");else{var g={csv_base_file_name:n.BaseFilenameExport};switch(l){case"csv":e.generateCsv(p,g);break;case"html":e.printHtml(p,g);break;case"console":e.consoleOutput(p,g)}c._plugSvcs.showAlertBox(n.CompareExportComplete,null,"success",!0)}c._exportReq=null,c._exportInProgress=!1,c._exportInProgressDisplayed=!1}},o})),define("DS/CompareWidget2/plugins/STRUCTURE/structCompareEngine",["DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crTree","DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crNode","DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/matchPair","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/hierResultList","DS/CompareWidget2/support/typeHierMgr","DS/CompareWidget2/plugins/STRUCTURE/flexibleView/ViewPanel/crTreeSetFns"],(function(e,t,i,n,o,r){const s=["","  ","   ","    ","     ","      ","       ","        ","         ","          ","           ","            "];var a=function(e){var t=this;t._plugSvcs=e,t._COMPUTE_DIFFERENT=null,t._FORCE_ROOTS_TOGETHER=!0,t._RELATIONSHIP_NAMES=null,t._RelName2Index={},t._attrNameArray_base=[],t._attrNameArray_comp=[],t._adjArray=[],t._maxAdjScore=0,t._missingAttrVals=!1,t._score2CompareIndex={},t._score2CompareIndex_root={}};function l(e,t){for(var i=t.toString(),n=e-i.length,o="",r=0;r<n;r++)o+=" ";return o+i}return a.prototype._iiGatherTypes=function(e){var t={};return(e||[]).forEach((function(e){var i=e.CONDITIONS;null!=i&&i.TYPE.forEach((function(e){t[e]=!0}))})),Object.keys(t)},a.prototype._createCRNode=function(e){var i=e.getAttr("REF.ds6w:identifier");null!=i&&""!==i||(i=e.getAttr("REF.name"));var n=e.getAttr("REF.ds6w:label");null!=n&&""!==n||(n=e.getAttr("REF.Title"));var o=e.getAttr("REF.typeIcons"),r=null!=o?o.smallURL:null,s=null!=o?o.largeURL:null,a=e.getAttr("INST.ro.plminstance.v_treeorder");null!=a&&""!==a||(a=e.getAttr("INST.ro.plminstance.V_treeorder")),null!=a&&""!==a||(a=e.getAttr("INST.TreeOrder")),null!=a&&""!==a||e.isRoot()||(a=e.getAttr("REF.TreeOrder"));var l=null;if(this._options.CUSTOM_PROFILE_IN_USE){null!=this._attrNameArray_base&&(l={},this._attrNameArray_base.forEach((function(t){var i=e.getAttr(t);l[t]=i})));let t=this;this._options.CUSTOM_MATCH_ADJUSTMENTS&&this._options.CUSTOM_MATCH_ADJUSTMENTS.forEach((function(i){null!=i.PROPSET&&i.PROPSET.forEach((function(i){var n=t._options.PROPS[i],o=e.getAttr(n);l[n]=o}))}))}var u=new t(i,n,e.getAttr("REF.ds6w:type"),e.getAttr("INST.physicalid"),e.getAttr("REF.physicalid"),e.getAttr("REF.ds6wg:revision"),a,r,s,e.getAttr("REF.thumbnail_3d"),e,l);let c=e.getSynthProps();null!=c&&u.setSynthProps(c),u.setDBContext(UWA.clone(e.getDBContext()));var d=e.getAttr("REF.proxySpec");return null!=d&&""!==d.serviceURL&&(u._dbContext.serviceName=d.serviceURL),u},a.prototype._addMatchInfoToCRNodes=function(e,t,n,o,r,s){var a=new i(e,t,n,o,r);return n.setMatchInfo(a,s),o.setMatchInfo(a),a},a.prototype._iiLoadHierCache=function(e){var t=this._iiGatherTypes(e);return o.loadUp(t)},a.prototype._initInternals=function(e){var t=this;t._COMPUTE_DIFFERENT=e.COMPUTE_DIFFERENT,t._FORCE_ROOTS_TOGETHER=!0,t._RELATIONSHIP_NAMES=[...e.CUSTOM_RELATIONSHIP_NAMES,...e.SYSTEM_RELATIONSHIP_NAMES],t._RelName2Index={},t._RELATIONSHIP_NAMES.forEach((function(e,i){t._RelName2Index[e]=i}));var i=e.CUSTOM_MATCH_ADJUSTMENTS,n=e.PROPS,o=e.CUSTOM_COMPARISONS;t._score2CompareIndex={},t._score2CompareIndex_root={};var r=Object.keys(o),a=null;t._plugSvcs.dbgout("**--\x3e MATCH TYPES / ATTR COMPARISON VALUES <--**"),e.CUSTOM_RELATIONSHIP_NAMES.forEach((function(i,l){var u=0,c=0,d=[],p=[],h=11-(a=i).length;a+=s[h=h>11?11:h]+" : {",r.forEach((function(t,i){var r=o[t][1][l],s=1<<i;"EQ"==r?(u+=s,a+=" EQ ,"):"N/A"==r?(d.push(s),a+=" N/A,"):a+=" NEQ,",n[e.CUSTOM_COMPARISONS[t][0][1]].startsWith("INST")?p.push(s):"EQ"==r?c+=s:"N/A"==r&&p.push(s)})),t._iiCalcScoreSet(u,d).forEach((function(e){null==t._score2CompareIndex[e]&&(t._score2CompareIndex[e]=l)})),t._iiCalcScoreSet(c,p).forEach((function(e){null==t._score2CompareIndex_root[e]&&(t._score2CompareIndex_root[e]=l)})),t._plugSvcs.dbgout("**--\x3e "+a+"}")})),t._attrNameArray_base=[],t._attrNameArray_comp=[],Object.keys(o).forEach((function(e,i){var r=o[e][0],s=r[0],a=r[1],l=n[s],u=n[a];t._attrNameArray_base.push(l),t._attrNameArray_comp.push(u),t._plugSvcs.dbgout("------\x3e>  ATTR COMPARISON["+i+"] : compares base attr '"+l+"' against comp attr '"+u+"'")})),t._adjArray=[];for(var l=null==i?0:i.length,u=0;u<l;u++){var c=i[u],d=null,p=null,h=[],_=[];let e=!1;if(null!=c.PROPS&&c.PROPS.length>0){var g=c.PROPS;let t=g[0],i=g[1];d=n[t],p=n[i],null==d?_.push(t):d.startsWith("INST")&&(e=!0),null==p?_.push(i):p.startsWith("INST")&&(e=!0)}else{if(!(null!=c.PROPSET&&c.PROPSET.length>0)){t._plugSvcs.errout("Adjustment rule '"+c.NAME+"' malformed; rule is skipped.");continue}c.PROPSET.forEach((function(t){let i=n[t];null==i?_.push(t):(h.push(i),i.startsWith("INST")&&(e=!0))}))}if(_.length>0)t._plugSvcs.errout("Cannot evaluate adjustment rule '"+c.NAME+"'; references undeclared variable(s):"+_.join(", "));else{var f=c.MATCH_ADJ;let i={NAME:c.NAME,propName0:d,propName1:p,propNameList:h,FLAG_ON:c.FLAG_ON,adjScore:f,CONDITIONS:c.CONDITIONS,usesInstProp:e,IS_VISIBLE:null==c.IS_VISIBLE||c.IS_VISIBLE};t._adjArray.push(i),f>0&&(t._maxAdjScore+=f)}}return t._iiLoadHierCache(e.CUSTOM_MATCH_ADJUSTMENTS)},a.prototype._iiCalcScoreSet=function(e,t){for(var i=[],n=Math.pow(2,t.length),o=0;o<n;o++){for(var r=e,s=0;s<o;s++)0!=(o&1<<s)&&(r+=t[s]);i.push(r)}return i},a.prototype._buildAttrValLUT=function(e,t){var i=this,n={};return t.forEach((function(t){n[t]={},e.forEach((function(e,o){var r=e.getAttr(t);null!=r?(null==n[t][r]&&(n[t][r]=[]),n[t][r].push(o)):0==e.isRoot()&&1!=i._missingAttrVals&&(i._missingAttrVals=!0,i._plugSvcs.warnout("Assembly being tested is MISSING REQUIRED values for the current ruleset ("+t+")"))}))})),n},a.prototype._findMatches=function(e,t){var i=this,o=!1,r=1==e.length&&e[0].isRoot()&&1==t.length&&t[0].isRoot(),s=i._buildAttrValLUT(e,i._attrNameArray_base),a=new n(e,t);return t.forEach((function(t,n){var l={};i._attrNameArray_comp.forEach((function(e,n){var o=t.getAttr(e),r=i._attrNameArray_base[n],a=s[r][o];if(null!=a){var u=1<<n;a.forEach((function(e){null==l[e]&&(l[e]=0),l[e]+=u}))}}));var u=Object.keys(l);i._FORCE_ROOTS_TOGETHER&&r&&0==u.length&&(o=!0),u.forEach((function(s){var u=l[s],c=r?i._score2CompareIndex_root[u]:i._score2CompareIndex[u];if(null!=c){i._stats.totalMatchedFoundCount++;var d=e[s],p=i._evalAdjustment(d,t);a.add(s,n,c,i._RELATIONSHIP_NAMES[c],p.adjIndex,p.adjFlagArray,p.instFlagNdxs)}else r&&i._FORCE_ROOTS_TOGETHER&&(o=!0)})),o&&(i._stats.rootWasForced=!0,a.add(0,0,i._RelName2Index.UNRELATED,"UNRELATED",0,[],[]))})),a.getResult()},a.prototype.isKindOfAny=function(e,t){for(var i=!1,n=e.getAttr("REF.ds6w:type"),r=t.length,s=0;s<r;s++){var a=t[s];if(o.isKindOf(n,a)){i=!0;break}}return i},a.prototype.attrVals_asSpecified=function(e,t){for(var i=!0,n=Object.keys(t),o=n.length,r=0;r<o;r++){var s=n[r],a=t[s];if(e.getAttr(s)!=a){i=!1;break}}return i},a.prototype.conditionsMatchType=function(e,t){return null==t||0==t.length||this.isKindOfAny(e,t)},a.prototype.conditionsMatchAttrs=function(e,t){return null==t||this.attrVals_asSpecified(e,t)},a.prototype.conditionsMatch=function(e,t,i){return null==i||(this.conditionsMatchType(e,i.TYPE)||this.conditionsMatchType(t,i.TYPE))&&(this.conditionsMatchAttrs(e,i.ATTRIBUTES)||(this.conditionsMatchAttrs(t),i.ATTRIBUTES))},a.prototype._evalAdjustment=function(e,t){let i=this,n=0,o=[],r=[],s=e.isRoot()||t.isRoot();for(let l=0;l<i._adjArray.length;l++){let u=i._adjArray[l],c=!1,d="EQ"==u.FLAG_ON,p=u.propNameList;if(null!=p&&p.length>0)for(var a=0;a<p.length;a++){let i=p[a];if((!s||!u.usesInstProp)&&(c=e.getAttr(i)==t.getAttr(i)==d,1==c))break}else{let i=u.propName0,n=u.propName1;if(s&&u.usesInstProp)continue;c=e.getAttr(i)==t.getAttr(n)==d}c&&1==i.conditionsMatch(e,t,u.CONDITIONS)&&(u.IS_VISIBLE&&(o.push(u.NAME),u.usesInstProp&&r.push(l)),n+=u.adjScore)}return o.length>0&&i._plugSvcs.dbgout("EVAL","----\x3e>> [ADJUSTMENT] : Adj: "+n+", FLAGS: "+o.join(",")),{adjIndex:i._maxAdjScore-n,adjFlagArray:o,instFlagNdxs:r}},a.prototype._addCRNodes=function(e){var t=this;e.forEach((function(e){if(null==e._crNode){var i=t._createCRNode(e);if(e._crNode=i,null!=e.getParent()){var n=e.getParent()._crNode;n.addChild(i),i.setParent(n)}}}))},a.prototype._processNodeSets=function(e,t,i){var n=this;n._stats.processedNodeSetCount++,n._plugSvcs.dbgout("EVAL","PROCESSING "+e.length+" x "+t.length+" nodes...");var o=1==e.length&&e[0].isRoot();o||(this._addCRNodes(e),this._addCRNodes(t));var r=n._findMatches(e,t);n._plugSvcs.dbgout("[DBG MATCH]PROCESS_NODE_SETS COUNTS {matchCOunt, baseUnmatchedCount, compUnmatchedCount}): {"+r.matchedNodePairArray.length+", "+r.unmatchedNodeArray_base.length+", "+r.unmatchedNodeArray_comp.length+"}"),r.unmatchedNodeArray_base.length+r.matchedNodePairArray.length==e.length&&r.unmatchedNodeArray_comp.length+r.matchedNodePairArray.length==t.length||n._plugSvcs.dbgout("[DBG MATCH]Failed Sanity Check //  bad counts coming from _findMatches()"),n._stats.unmatchedCount+=r.unmatchedNodeArray_base.length+r.unmatchedNodeArray_comp.length,n._stats.totalMatchedUsedCount+=r.matchedNodePairArray.length;var s=r.matchedNodePairArray,a=r.unmatchedNodeArray_base,l=r.unmatchedNodeArray_comp;s.forEach((function(e,t){n._plugSvcs.dbgout("[DBG MATCH]check match #",t);var r=e.node_base,s=e.node_comp,a=r._crNode,l=s._crNode;if(n._addMatchInfoToCRNodes(e.relName,e.adjFlagArray,a,l,e.instFlagNdxs,i),o&&"UNRELATED"==e.relName&&0==n._COMPUTE_DIFFERENT)return n._addCRNodesForUnmatchedChildren([r]),void n._addCRNodesForUnmatchedChildren([s]);n._markParentsDiff(a,l,i);var u=r.getChildArray(),c=s.getChildArray();(u.length>0||c.length>0)&&n._processNodeSets(u,c,i)})),(a.length>0||l.length>0)&&(1==n._COMPUTE_DIFFERENT?n._processUnmatchedChildren_forDiff(a,l):(n._addCRNodesForUnmatchedChildren(a),n._addCRNodesForUnmatchedChildren(l)))},a.prototype._addCRNodesForUnmatchedChildren=function(e){if(null!=e){var t=[];e.forEach((function(e){e.getChildArray().forEach((function(e){t.push(e)}))})),this._addCRNodes(t),t.length>0&&this._addCRNodesForUnmatchedChildren(t)}},a.prototype._processUnmatchedChildren_forDiff=function(e,t){var i=[],n=[];e.forEach((function(e){e.getChildArray().forEach((function(e){i.push(e)}))})),t.forEach((function(e){e.getChildArray().forEach((function(e){n.push(e)}))})),this._processNodeSets(i,n)},a.prototype._markParentsDiff=function(e,t,i){var n=this;if(null!=e&&null!=t){n._plugSvcs.dbgout("[DBG MATCH]MARK PARENTS DIFF // checking parents of "+e.getAttr("title")+", "+t.getAttr("title"));var o=e.getParent(),r=t.getParent(),s=0;if(s+=null!=o?1:0,0!=(s+=null!=r?1:0))if(1!=s){var a=o.getMatchInfo(i),l=r.getMatchInfo(),u=0;if(u+=null!=a?1:0,0==(u+=null!=l?1:0)){n._addMatchInfoToCRNodes("DIFFERENT",[],o,r,[],i),n._plugSvcs.dbgout("[DBG MATCH]Marking DIFFERENT: "+o.getAttr("title")+" // "+r.getAttr("title")),n._stats.diffCount++,n._plugSvcs.dbgout("[DBG MATCH]CHECKING PARENTS BEGIN"),n._markParentsDiff(o,r,i),n._plugSvcs.dbgout("[DBG MATCH]CHECKING PARENTS END")}else{if(1==u){if(null!=a){let e=o.getAttr("title"),t=a.getCompNode().getAttr("title"),i=a.getRelName();n._plugSvcs.dbgout("[DBG MATCH]FAILED SANITY CHECK:: BASE node '"+e+"'    is already matched with COMP node    '"+t+"' :: '"+i+"'")}else{let e=r.getAttr("title"),t=l.getBaseNode().getAttr("title"),i=l.getRelName();n._plugSvcs.dbgout("[DBG MATCH]FAILED SANITY CHECK:: COMP node '"+e+"'    is already matched with BASE node    '"+t+"' :: '"+i+"'")}return}if(a==l&&"UNRELATED"==a.getRelName())return a.resetRelName("DIFFERENT"),void this._stats.diffCount++}}else n._plugSvcs.dbgout("[DBG MATCH]MarkParentsDiff() failed sanity check - one node is root")}else n._plugSvcs.dbgout("[DBG MATCH]markParentsDiff() fails sanity check: one of these nodes is null")},a.prototype._compareTrees=function(e,t,i,n){var o=this;o._missingAttrVals=!1;var r=t.getRoot(),s=i.getRoot();let a=r._crNode;null==a&&(a=o._createCRNode(r),r._crNode=a),e.setRoot(0,t.getObjIDSpec(),a);var l=t.getObjIDSpec().isFiltered();let u=t.getObjIDSpec().getExternalFilterSpec();if(l)if(null!=u){let e=u.filterTitle;a.setExternalFilterName(e)}else a.setExternalFilterName("");var c=o._createCRNode(s);s._crNode=c,e.setRoot(1,i.getObjIDSpec(),c);let d=i.getObjIDSpec().isFiltered(),p=i.getObjIDSpec().getExternalFilterSpec();if(d)if(null!=p){let e=p.filterTitle;c.setExternalFilterName(e)}else c.setExternalFilterName("");return o._processNodeSets([r],[s],n),e},a.prototype._cleanup=function(e){var t=this;e.forEach((function(e,i){var n=0;e.visit_riTreeAndFN((function(e){return n++,delete e._crTree,!0})),t._plugSvcs.dbgout(" --\x3e Tree #"+i+" node count      : "+l(7,n))}))},a.prototype._initTreeCompareStats=function(){this._stats={processedNodeSetCount:0,totalMatchedFoundCount:0,totalMatchedUsedCount:0,unmatchedCount:0,diffCount:0,rootWasForced:!1,dump:function(e){var t=this;e(" Total node sets processed   : "+l(7,t.processedNodeSetCount)),e(" Total matches found         : "+l(7,t.totalMatchedFoundCount));var i="";t.rootWasForced&&(i=" (+ 1 b/c root was forced)"),e(" Total matches Used          : "+l(7,t.totalMatchedUsedCount)+i),e(" Unmatched Nodes             : "+l(7,t.unmatchedCount)),e(" Unmatched Changed to 'diff' : "+l(7,t.diffCount))}}},a.prototype.doCompare=function(e,t,i){var n=this;return n._plugSvcs=i,n._options=t,new Promise((function(i,o){var s=n._plugSvcs.nowMS();n._initInternals(t).then((function(t){let o=e.length-1,a=r.create_crTreeArray(o),l=e[0],u=l.getRoot().get_dbObj_REF().getAttr("ds6w:label");null==u&&(u=l.getRoot().get_dbObj_REF().getAttr("Title"));for(var c=0;c<o;c++){var d=o>1?c:void 0,p=c+1,h=a[c],_=e[p],g=_.getRoot().get_dbObj_REF().getAttr("ds6w:label");null==g&&(g=_.getRoot().get_dbObj_REF().getAttr("Title")),n._initTreeCompareStats(),n._plugSvcs.dbgout("vvvvvvvvvvvvvvvvvvvvv  COMPARING TREES  vvvvvvvvvvvvvvvvvvvvv <<<<"),n._plugSvcs.dbgout(" Roots are                   : '"+u+"' & '"+g+"'"),h=n._compareTrees(h,l,_,d),n._stats.dump(n._plugSvcs.dbgout),o>1&&n._plugSvcs.dbgout("------------------------------------------------------------------")}for(c=0;c<o;c++){h=a[c];0==c&&h.sortBaseTreeNodes(),h.sortCompTreeNodes()}n._cleanup(e),n._plugSvcs.dbgout("^^^^ ^^^^^^^^^^^^^^^^  COMPARING TREES  ^^^^^^^^^^^^^^^^^^^^^ <<<<"),n._plugSvcs.reportTime(s,"----ALL tree structure comparisons are done----: "),i(a)}),(function(e){n._plugSvcs.errout("Failed comparing structures: "+e),o(e)}))}))},a})),define("DS/CompareWidget2/plugins/STRUCTURE/STRUCT_COMPARE_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/STRUCTURE/structCompareEngine"],(function(e,t){return e.extend({init:function(e,t,i,n){this._parent(e,t,i,n),this._engine=null},onLoad:function(){return this._engine=new t(this._plugSvcs),!0},onDestroy:function(){this._engine=null},execute:function(e,t){var i=this;i._parent(e,t);var n=e;i._engine.doCompare(n,t,this._plugSvcs).then((function(e){if(null!=e){var n={crTreeArray:e,ruleNames:t.CUSTOM_RELATIONSHIP_NAMES,destroy:function(){Array.isArray(this.crTreeArray)&&(this.crTreeArray.forEach((function(e){e.destroy()})),this.crTreeArray=null)}};i.reportOK(n)}else i.reportKO("FAILURE performing struct compare: 'null crTree returned'")}),(function(e){i.reportKO("FAILURE performing struct compare: "+e)}))}})})),define("DS/CompareWidget2/ViewDefModules/PortfolioViewDefOptions",["UWA/Core","DS/CompareWidget2/ViewDefModules/DSColors"],(function(e,t){"use strict";var i={PHYSICALID:"REF.physicalid",NAME:"REF.name",REVISION:"REF.ds6wg:revision",DERIVEDFROMID:"REF.derivedFromId",VERSIONID:"REF.versionid",REF_LOGID:"REF.logicalid"},n={CV_PROPS:i},o={PROPS:i,COMPUTE_DIFFERENT:!0,FORCE_ROOTS_TOGETHER:!0,SYSTEM_RELATIONSHIP_NAMES:["LEFT_ONLY","RIGHT_ONLY","QUANTITY","DIFFERENT","UNRELATED"],CUSTOM_RELATIONSHIP_NAMES:["IDENTICAL","REVISION","BRANCH","DUPE"],CUSTOM_COMPARISONS:{COMP_PHYSID:[["PHYSICALID","PHYSICALID"],["EQ","NEQ","NEQ","NEQ"]],COMP_NAME:[["NAME","NAME"],["EQ","EQ","NEQ","NEQ"]],COMP_REF_LOGID:[["REF_LOGID","REF_LOGID"],["EQ","EQ","EQ","NEQ"]],COMP_DERIVEDFROMID:[["DERIVEDFROMID","DERIVEDFROMID"],["EQ","EQ","EQ","EQ"]]},CUSTOM_MATCH_ADJUSTMENTS:[]},r={SYSTEM_RULE_ID_FLAGS:{LEFT_ONLY:{COLOR:t.colorDef.ORANGE,NLS:"LO"},RIGHT_ONLY:{COLOR:t.colorDef.BLUE1,NLS:"RO"},UNRELATED:{COLOR:t.colorDef.BLACK,NLS:"UNRELATED"},DIFFERENT:{COLOR:t.colorDef.BEIGE,NLS:"DIFFERENT"},QUANTITY:{COLOR:t.colorDef.BLUE2,NLS:"QUANTITY"}},CUSTOM_RULE_ID_FLAGS:{IDENTICAL:{COLOR:t.colorDef.NONE,NLS:"SM"},REVISION:{COLOR:t.colorDef.VIOLET,NLS:"REV"},BRANCH:{COLOR:t.colorDef.GREEN2,NLS:"BRANCHED"},DUPE:{COLOR:t.colorDef.RED,NLS:"DUPLICATED"}},CONTEXT_MENU_PLUGIN:"DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structDefaultContextMenu",CELL_DRAG_ENABLED_FLAG:!0};return{CV_PROPS:i,STRUCT_FETCH_OPTIONS:n,STRUCT_COMPARE_OPTIONS:o,STRUCT_DISPLAY_OPTIONS:r,ATTRIBUTE_DISPLAY_OPTIONS:{colorLeft:r.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR,colorRight:r.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR}}})),define("DS/CompareWidget2/ViewDefModules/PortfolioViewDefs_V2",["DS/CompareWidget2/ViewDefModules/PortfolioViewDefOptions"],(function(e){"use strict";var t={AttrFetchPort:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin"},AttrComparePort:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin"},AttrDisplayPort:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",Options:e.ATTRIBUTE_DISPLAY_OPTIONS},StructFetchPort:{Path:"DS/CompareWidget2/plugins/PORTFOLIO/PORTFOLIO_STRUCT_FETCH_plugin",Options:e.STRUCT_FETCH_OPTIONS},StructComparePort:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_COMPARE_plugin",Options:e.STRUCT_COMPARE_OPTIONS},StructDisplayPort:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_DISPLAY_plugin",Options:e.STRUCT_DISPLAY_OPTIONS},StructListViewPrep:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_LIST_VIEW_PREP_PLUGIN"},Exporter:{Path:"DS/CompareWidget2/plugins/EXPORT/EXPORT_plugin",Options:e.STRUCT_DISPLAY_OPTIONS}};return UWA.merge({VIEWSETS:{PORTFOLIO_STANDARD:{COL:["PORTFOLIO_STRUCT_VIEW","PORTFOLIO_PROP_VIEW"]}},VIEWDEFS:{PORTFOLIO_PROP_VIEW:["AttrFetchPort","AttrComparePort","AttrDisplayPort"],PORTFOLIO_STRUCT_VIEW:["StructFetchPort","StructComparePort","StructListViewPrep","StructDisplayPort","Exporter"]},PLUGDEFS:t},e)})),define("DS/CompareWidget2/plugins/ATTRIBUTE/ViewPanel/effectivityComparePanel",["DS/CompareWidget2/plugins/ATTRIBUTE/ViewPanel/propsComparePanel","DS/CompareCommon/Utils","i18n!DS/CompareWidget2/assets/nls/CompareV2"],(function(e,t,i){return e.extend({init:function(e,t,i){this._parent(e,t,i)},getLabel:function(){return i.CompareEffectivityPanelTitle},getName:function(){return"EFFECTIVITY_VIEW"},getDomId:function(){return"effectivity"}})})),define("DS/CompareWidget2/plugins/STRUCTURE/statusBubbler",["UWA/Class","DS/CompareWidget2/support/typeHierMgr"],(function(e,t){var i=e.extend({init:function(e){this._parent({}),this._plugSvcs=e},doBubble:function(e,t){!0===t.BUBBLE_UP_ENABLED&&this.setup_bubbleUpStatus_lut(t.BUBBLE_STATUS_CONFIG);let i=e.length;for(var n=0;n<i;n++){let i=e[n];this.bubbleTree(i,t,n)}return e}});return i.prototype.bubbleTree=function(e,t,i){for(var n=this,o=e.getMatchPairArray(),r=o.length,s=!1,a=1;a<r;a++){var l=o[a];if(1!=l.DELETED){if(!0===t.BUBBLE_UP_ENABLED){var u=n.computeBubbleUpsForMatchPair(l);0!=u&&(s|=n.bubbleUp(l,u))}!0===t.BUBBLE_DOWN_ENABLED&&n.isBubbleDownTarget(l)&&(s|=n.bubbleDown(l)),s&&e.reNice(i)}}},i.prototype.setup_bubbleUpStatus_lut=function(e){var t=this;t._bubbleAction_LUT={},t._conditionTable={PARENT:{ON_STATUS:{vals:{},baUsed:0,baUnused:0},TYPE:{vals:{},baUsed:0,baUnused:0},ATTRIBUTES:{nameVals:{},baUsed:0,baUnused:0}},CHILD:{ON_STATUS:{vals:{},baUsed:0,baUnused:0},TYPE:{vals:{},baUsed:0,baUnused:0},ATTRIBUTES:{nameVals:{},baUsed:0,baUnused:0}}};var i=0;e.forEach((function(e,n){i=Math.pow(2,n),t._bubbleAction_LUT[i]={BUBBLED_STATUS:e.BUBBLE_STATUS,BUBBLE_TO:e.BUBBLE_TO},e.CONDITIONS.CHILD&&t.addConditionEntries(i,e.CONDITIONS.CHILD,t._conditionTable.CHILD),e.CONDITIONS.PARENT&&t.addConditionEntries(i,e.CONDITIONS.PARENT,t._conditionTable.PARENT)}));var n=2*i-1;t._conditionTable.CHILD.ON_STATUS.baUnused=n&~t._conditionTable.CHILD.ON_STATUS.baUsed,t._conditionTable.CHILD.TYPE.baUnused=n&~t._conditionTable.CHILD.TYPE.baUsed,t._conditionTable.CHILD.ATTRIBUTES.baUnused=n&~t._conditionTable.CHILD.ATTRIBUTES.baUsed,t._conditionTable.PARENT.ON_STATUS.baUnused=n&~t._conditionTable.PARENT.ON_STATUS.baUsed,t._conditionTable.PARENT.TYPE.baUnused=n&~t._conditionTable.PARENT.TYPE.baUsed,t._conditionTable.PARENT.ATTRIBUTES.baUnused=n&~t._conditionTable.PARENT.ATTRIBUTES.baUsed,t._allBubblesAvail_bitmask=Math.pow(2,Object.keys(t._bubbleAction_LUT).length)-1},i.prototype.addConditionEntries=function(e,t,i){(t.ON_STATUS&&(t.ON_STATUS.forEach((function(t){null==i.ON_STATUS.vals[t]&&(i.ON_STATUS.vals[t]=0),i.ON_STATUS.vals[t]|=e})),i.ON_STATUS.baUsed|=e),t.TYPE&&(t.TYPE.forEach((function(t){null==i.TYPE.vals[t]&&(i.TYPE.vals[t]=0),i.TYPE.vals[t]|=e})),i.TYPE.baUsed|=e),t.ATTRIBUTES)&&(Object.keys(t.ATTRIBUTES).forEach((function(n){var o=t.ATTRIBUTES[n];null==i.ATTRIBUTES.nameVals[n]&&(i.ATTRIBUTES.nameVals[n]={}),null==i.ATTRIBUTES.nameVals[n][o]&&(i.ATTRIBUTES.nameVals[n][o]=0),i.ATTRIBUTES.nameVals[n][o]|=e})),i.ATTRIBUTES.baUsed|=e)},i.prototype.computeBitmaskForTypeOf=function(e,i){var n=0;return Object.keys(i.vals).forEach((function(o){t.isKindOf(e,o)&&(n|=i.vals[o])})),n|=i.baUnused},i.prototype.computeBitmaskForMPStatus=function(e,t){var i=0;return e.getAllStatusArray(!0).forEach((function(e){var n=t.vals[e];i|=n})),i|=t.baUnused},i.prototype.computeBitmaskForAttributes=function(e,t){var i=0;return Object.keys(t.nameVals).forEach((function(n){var o=e.getAttr(n);if(null!=o){var r=t.nameVals[n];Object.keys(r).forEach((function(e){o!=e||(i|=t.nameVals[n][e])}))}})),i|=t.baUnused},i.prototype.computeBubbleUpsFor_crNode=function(e,t){var i=this,n=this._allBubblesAvail_bitmask,o=e.getMatchInfo();if(0==(n&=i.computeBitmaskForMPStatus(o,t.ON_STATUS)))return 0;var r=e.getType();return 0==(n&=i.computeBitmaskForTypeOf(r,t.TYPE))?0:n&=i.computeBitmaskForAttributes(e,t.ATTRIBUTES)},i.prototype.computeBubbleUpsForMatchPair=function(e){var t=this._allBubblesAvail_bitmask,i="LEFT_ONLY"==e.getRelName()?e.getBaseNode():e.getCompNode(),n=i.getParent();0!=(t&=this.computeBubbleUpsFor_crNode(i,this._conditionTable.CHILD))&&(t&=this.computeBubbleUpsFor_crNode(n,this._conditionTable.PARENT));return t},i.prototype.bubbleUp=function(e,t){var i=!1,n=1;do{if(t&n){var o=this._bubbleAction_LUT[n];i|=this.bubbleUp_byBubbleRule(e,o)}n<<=1}while(n<=t);return i},i.prototype.bubbleUp_byBubbleRule=function(e,i){for(var n=e.getBaseNode(),o=n.getParent(),r=i.BUBBLE_TO,s="FVP"==i.BUBBLE_TO?"FVP0":"STATIC",a=null!=o,l=!isNaN(parseInt(r)),u=l?parseInt(r):null,c=null!=u,d=!1,p="root"!=r&&"FVP"!=r&&0==l?r:null;a;){o=(n=o).getParent();var h=n.getMatchInfo();if(null!=h){d|=!0;var _=!1;"FVP0"==s?s="FVP1":"FVP1"==s&&(_=!0),h.addBubbledStatus(i.BUBBLED_STATUS,_)}if(null==o)a=!1;else if(c)a=--u>0;else if(null!=p){var g=h.getBaseNode().getType(),f=h.getCompNode().getType();a=!(t.isKindOf(g,p)||t.isKindOf(f,p))}}return d},i.prototype.isBubbleDownTarget=function(e){var t=!1;if(null!=e.hasStatus("REPLACED")){var i=e.getBaseNode();if("VPMReference"==i.getAttr("type"))"3DPart"==i.getRefInstNode().getAttr("REF.bo.plmentity.v_usage")&&(t=!0)}return t},i.prototype.findChild3DShape=function(e){for(var i=null,n=e.getChildArray(),o=n.length,r=0;r<o;r++){var s=n[r],a=s.getAttr("type");if(t.isKindOf(a,"3DShape")){i=s;break}}return i},i.prototype.bubbleDown=function(e){var t=!1,i=e.getBaseNode(),n=e.getCompNode(),o=this.findChild3DShape(i);if(null!=o){var r=this.findChild3DShape(n);if(null!=r){var s=o.getMatchInfo(),a=r.getMatchInfo();if(null==s||null==a)this._plugSvcs.errout("bubbleDown:: Unexpected! matchPair missing! bubbleDown being skipped for node... continuing");else{t=!0;var l=s.getCompNode();s.resetRelName("REPLACED"),s.resetCompNode(r),r.setMatchInfo(s);var u=a.getBaseNode();i.removeChild(u),n.removeChild(l),a.DELETED=!0}}}return t},i})),define("DS/CompareWidget2/plugins/STRUCTURE/STRUCT_BUBBLER_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/STRUCTURE/statusBubbler"],(function(e,t){return e.extend({init:function(e,t,i,n){this._parent(e,t,i,n),this._bubbler=null},onDestroy:function(){this._bubbler=null},execute:function(e,i){var n=this;if(n._parent(e,i),!0===i.BUBBLE_UP_ENABLED||!0===i.BUBBLE_DOWN_ENABLED){var o=this._plugSvcs.nowMS();let r=e.crTreeArray;null==n._bubbler&&(n._bubbler=new t(this._plugSvcs)),n._bubbler.doBubble(r,i),this._plugSvcs.reportTime(o,"TIME TO BUBBLE")}null!=e?n.reportOK(e):n.reportKO()}})})),define("DS/CompareWidget2/ViewDefModules/VPMRef_Options",["UWA/Core","DS/CompareWidget2/ViewDefModules/ViewDefOptions"],(function(e,t){return e.extend(e.clone(t,!0),{FRAMEWORK_OPTIONS:{customCompareActive:!0},STRUCT_FETCH_OPTIONS:{CV_PROPS:{PGP_HIDE_SHOW_REF:"REF.ro.PGPShowExtension.V_PGP_Show",PGP_HIDE_SHOW_INST:"INST.ro.PGPShowExtension.V_PGP_Show"},DATA_SOURCE:"CV_PROGRESSIVE_PGP",PROGRESSIVE_EXPAND_OUTPUTS:{select_pgp:["show","hide"]},DB_FALLBACK:"DB_SERVICE"},STRUCT_DISPLAY_OPTIONS:{CONTEXT_MENU_PLUGIN:"DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structVPMRefContextMenu"}},!0)})),define("DS/CompareWidget2/ViewDefModules/VPMRef_ViewDefs",["UWA/Core","DS/CompareWidget2/ViewDefModules/DefaultViewDefs_V2","DS/CompareWidget2/ViewDefModules/VPMRef_Options"],(function(e,t,i){let n=e.clone(t,!0),o=n.PLUGDEFS,r=n.VIEWDEFS,s=t.VIEWSETS;return o.StructFetch.Options=i.STRUCT_FETCH_OPTIONS,e.extend(o,{StructDisplay:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_DISPLAY_PGP_plugin",Options:i.STRUCT_DISPLAY_OPTIONS},ClassAttrFetch:{Path:"DS/ClassificationsCompareUI/plugins/classificationsfetchplugin"},ClassAttrCompare:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin"},ClassAttrDisplay:{Path:"DS/ClassificationsCompareUI/plugins/classificationsdisplayplugin"}}),o.StructFetch.Options=i.STRUCT_FETCH_OPTIONS,o.StructDisplay.Options.CONTEXT_MENU_PLUGIN=i.STRUCT_DISPLAY_OPTIONS.CONTEXT_MENU_PLUGIN,e.extend(r,{STRUCT_VIEW_WITH_CUSTOM_ATTRS:["StructFetch","StructCompare","GetRelations","CompareRels","StructCustAttrsPrep","StructListViewPrep","StructDisplay","Exporter"],CLASSIFICATION_VIEW:["ClassAttrFetch","ClassAttrCompare","ClassAttrDisplay"]}),e.extend(s,{CLASS_ONLY:{ROW:"CLASSIFICATION_VIEW"},STRUCT_PROPS_INST_EFF_PAD3D:{ROW:["STRUCT_VIEW_WITH_CUSTOM_ATTRS",{COL:[["PROP_VIEW","INSTANCE_VIEW","EFFECTIVITY_VIEW","CLASSIFICATION_VIEW"],"PAD3D_VIEW"]}]}}),e.merge({VIEWDEFS:r,VIEWSETS:s,PLUGDEFS:o},i)})),define("DS/CompareWidget2/ViewDefModules/ProductsViewDefOptions",["UWA/Core","DS/CompareWidget2/ViewDefModules/DSColors"],(function(e,t){"use strict";var i={PHYSICALID:"REF.physicalid",VERSIONID:"REF.versionid",NAME:"REF.name"},n={CV_PROPS:i,CVURL_BY_TYPE:[{name:"DEFAULT",url:"/cvservlet/expand"}],DATA_SOURCE:"CV_SERVICE",DB_FALLBACK:!1,USE_MCS:!1},o={PROPS:i,COMPUTE_DIFFERENT:!0,FORCE_ROOTS_TOGETHER:!0,SYSTEM_RELATIONSHIP_NAMES:["LEFT_ONLY","RIGHT_ONLY","QUANTITY","DIFFERENT","UNRELATED"],CUSTOM_RELATIONSHIP_NAMES:["IDENTICAL","REVISION","BRANCH"],CUSTOM_COMPARISONS:{COMP_PHYSID:[["PHYSICALID","PHYSICALID"],["EQ","NEQ","NEQ"]],COMP_VERID:[["VERSIONID","VERSIONID"],["EQ","EQ","NEQ"]],COMP_NAME:[["NAME","NAME"],["EQ","EQ","EQ"]]},CUSTOM_MATCH_ADJUSTMENTS:[]},r={SYSTEM_RULE_ID_FLAGS:{LEFT_ONLY:{COLOR:t.colorDef.ORANGE,NLS:"LO"},RIGHT_ONLY:{COLOR:t.colorDef.BLUE1,NLS:"RO"},UNRELATED:{COLOR:t.colorDef.BLACK,NLS:"UNRELATED"},DIFFERENT:{COLOR:t.colorDef.BEIGE,NLS:"DIFFERENT"},QUANTITY:{COLOR:t.colorDef.BLUE2,NLS:"QUANTITY"}},CUSTOM_RULE_ID_FLAGS:{IDENTICAL:{COLOR:t.colorDef.NONE,NLS:"SM"},REVISION:{COLOR:t.colorDef.VIOLET,NLS:"REV"},BRANCH:{COLOR:t.colorDef.GREEN2,NLS:"BRANCHED"}},CONTEXT_MENU_PLUGIN:"DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structDefaultContextMenu",CELL_DRAG_ENABLED_FLAG:!0};return{CV_PROPS:i,STRUCT_FETCH_OPTIONS:n,STRUCT_COMPARE_OPTIONS:o,STRUCT_DISPLAY_OPTIONS:r,ATTRIBUTE_DISPLAY_OPTIONS:{colorLeft:r.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR,colorRight:r.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR}}})),define("DS/CompareWidget2/ViewDefModules/ProductsViewDefs_V2",["DS/CompareWidget2/ViewDefModules/ProductsViewDefOptions"],(function(e){"use strict";var t={AttrFetch:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin"},AttrCompare:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin"},AttrDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",Options:e.ATTRIBUTE_DISPLAY_OPTIONS},StructFetch:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_FETCH_plugin",Options:e.STRUCT_FETCH_OPTIONS},StructCompare:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_COMPARE_plugin",Options:e.STRUCT_COMPARE_OPTIONS},StructDisplay:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_DISPLAY_plugin",Options:e.STRUCT_DISPLAY_OPTIONS},StructListViewPrep:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_LIST_VIEW_PREP_PLUGIN"},Exporter:{Path:"DS/CompareWidget2/plugins/EXPORT/EXPORT_plugin",Options:e.STRUCT_DISPLAY_OPTIONS}};return UWA.merge({VIEWSETS:{PRODUCTS_PROPS_AND_STRUCT:{COL:["PRODUCTS_STRUCT_VIEW","PRODUCTS_PROP_VIEW"]},PRODUCTS_PROPS_ONLY:{ROW:"PRODUCTS_PROP_VIEW"},PRODUCTS_STRUCT_ONLY:{ROW:"PRODUCTS_STRUCT_VIEW"}},VIEWDEFS:{PRODUCTS_PROP_VIEW:["AttrFetch","AttrCompare","AttrDisplay"],PRODUCTS_STRUCT_VIEW:["StructFetch","StructCompare","StructListViewPrep","StructDisplay","Exporter"]},PLUGDEFS:t},e)})),define("DS/CompareWidget2/plugins/STRUCTURE/flexibleView/STRUCT_AGG_TREE_plugin",["DS/CompareWidget2/plugins/STRUCTURE/STRUCT_AGG_plugin","DS/CompareWidget2/userSettings/UserSettingsManager"],(function(e,t){return e.extend({doAdjust:function(e,t,i){let n=this;return new Promise((function(i,o){i(null!=t?n.setHideNodeFlags(e,t.SHOW_HIDE_NODE_PARAMS):e)}))},doAugment:function(e,t,i){return new Promise((function(t,i){t(e)}))},doAggregate:function(e,t,i){return new Promise((function(t,i){t(e)}))},doesNodeConform:function(e,t){let i=!1;if((null==t.TYPE||t.TYPE.includes(e.getAttr("REF.ds6w:type")))&&(i=!0),1==i)if(null==t.ATTRIBUTES)i=!0;else{let o=Object.keys(t.ATTRIBUTES),r=o.length;for(var n=0;n<r;n++){let r=o[n];if(t.ATTRIBUTES[r]!=e.getAttr(r)){i=!1;break}}}return i},markAsFiltered:function(e,i){let n=this,o=!1,r=i.length;for(var s=0;s<r;s++){let r=i[s],a=null==r.SHOW||r.SHOW;if(0==("boolean"==typeof a?a:"string"!=typeof a||t.get(a))){let t=!1,i=!1;if(i=null==r.CHILD||null!=e&&n.doesNodeConform(e,r.CHILD),1==i){let s=e.getParent();if(t=null==r.PARENT||null!=s&&n.doesNodeConform(s,r.PARENT),i&&t){o=!0;break}}}}return o},setHideNodeFlags:function(e,t){if(null!=t){let i=this;e.forEach((function(e){let n=0;e.visit_riTreeAndFN((function(e){return i.markAsFiltered(e,t)&&(n++,e.setAttr("REF.hideNode",!0)),!0})),i._plugSvcs.dbgout("refInst tree has "+n+" nodes marked as hidden my SHOW_HIDE_NODE_PARAMS")}))}return e}})})),define("DS/CompareWidget2/plugins/STRUCTURE/flexibleView/STRUCT_AGG_LIST_plugin",["DS/CompareWidget2/plugins/STRUCTURE/flexibleView/STRUCT_AGG_TREE_plugin","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/dbObj","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_node","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_tree"],(function(e,t,i,n){return e.extend({_makeDummyRoot:function(){var e=new t;return new i(e,null)},_splitString_QuantUnit:function(e){var t=null;if(null!=e&&0!=e.length){var i=e.split(" ");if(i.length>0){var n=Number.parseFloat(i[0]);0==Number.isNaN(n)&&(t={number:n,unit:""},i.length>1&&(t.unit=i[1]))}}return t},doAggregate:function(e,t,i){var o=this,r=[];return new Promise((function(i,s){e.forEach((function(e){var i=[],s={};e.visit_riTreeAndFN((function(e){try{var n=e.getAttr("REF.physicalid"),r=s[n],a=null==r;a&&(i.push(e),s[n]=e,r=e);let h=null!=t.ROLLUP_PROPS?t.ROLLUP_PROPS.length:0;for(var l=0;l<h;l++){let i=t.ROLLUP_PROPS[l],n=i.SOURCE_NAME,s=i.DEST_NAME,h="";var u=1,c="";if(null!=n&&""!=n){var d=e.getAttr(n),p=o._splitString_QuantUnit(d);u=null==p||null==p.number?1:p.number,c=null==p||null==p.unit?"":p.unit}if(1==a)h=u.toString(),null!=c&&""!=c&&(h+=" "+c);else{let e=r.getAttr(s),t=o._splitString_QuantUnit(e),i=t.number,n=t.unit;n!=c&&o._plugSvcs.errout("Unit mismatch while aggregating: Existing units are: "+n+"; new units are: "+c),h=(Number.parseFloat(i)+u).toString(),null!=c&&""!=c&&(h+=" "+c)}r.setAttr(s,h)}e.set_dbObj_INST(null)}catch(e){console.error("EXCEPTION AGGREGATING: "+e)}return!0}));var a=o._makeDummyRoot();i.forEach((function(e){e.rmAllChildren(),e.setParent(a,!0),a.addChild(e)}));var l=e.getObjIDSpec().makeDupe(),u=new n(l);u.setRoot(a),r.push(u)})),i(r)}))}})})),define("DS/CompareWidget2/plugins/DATA/attrCache",["DS/CompareWidget2/plugins/DATA/attrValObjSet","DS/CompareWidget2/support/tenantServiceContext_IDList","DS/CompareCommon/Utils","i18n!DS/CompareWidget/assets/nls/CompareWidget"],(function(e,t,i,n){function o(e){for(var t={data:[],tn:e.dbContext.tenant,sc:e.dbContext.securityContext,sn:e.dbContext.serviceName,i1:e.iconURL,i2:e.iconURLLarge,id:e.physicalID,ty:e.objType},i=e.attrVals.length,n=0;n<i;n++){var o=e.attrVals[n],r=[o.name,o.nls,JSON.stringify(o.value),o.type,o.UIPosition,o.multivalued];t.data.push(r)}return t}var r=function(){2==arguments.length?(this._cacheID=arguments[0],this._isInstance="INSTANCE"==this._cacheID,this._isEffectivity="EFFECTIVITY"==this._cacheID,this._plugSvcs=arguments[1]):(this._isInstance=arguments[0],this._isEffectivity=arguments[1],this._plugSvcs=arguments[2],this._cacheID=this._isInstance?"(INST)":this._isEffectivity?"(EFFECTIVITY)":"(REF)"),this._dbgout=this._plugSvcs.dbgout,this._theCache={},this._preloadInProgress=!1,this._cacheIsLoaded=!1};return r.prototype.flushCache=function(){var e=JSON.stringify(this._theCache).length;e>2&&(this._plugSvcs.dbgout("ATTR_CACHE",this._cacheID+" Property value cache (current size: "+e+" characters) is being flushed ..."),this._theCache={},this._preloadInProgress=!1,this._cacheIsLoaded=!1)},r.prototype.getAttrData=function(e){var i=this,n=[];return new Promise((function(o,r){var s=new t;e.forEach((function(e){s.addObjIDSpec(e)})),i._updateCache(s,!0).then((function(t){0==t?o(null):(e.forEach((function(e){var t=e.getTenant(),o=e.getServiceName(),r=e.getSecurityContext(),s=e.getPhysID(),a=i._getFromCache(t,o,r,s);a&&(void 0===a.objType||null===a.objType&&""===a.objType)&&(a.objType=e.getObjType()),n.push(a)})),o(n))}),(function(e){var t=i._cacheID+" fetch data failed:: "+e;r(t)}))}))},r.prototype._getFromCache=function(t,i,n,o){var r=null;try{if(null!=t&&null!=i&&null!=n&&null!=o&&""!==o){var s=this._theCache[t][i][n][o];null!=s?r=function(t){var i=t.tn,n=t.sc,o=t.sn,r=t.i1,s=t.i2,a=t.id,l=t.ty,u=new e(a,l,s,r);return u.setDBContext(n,o,i),t.data.forEach((function(e){var t=e[0],i=e[1],n=null==e[2]?null:JSON.parse(e[2]),o=e[3],r=e[4],s=null==e[5]?null:JSON.parse(e[5]);u.add(t,i,n,o,r,s)})),u}(s):this._dbgout("ATTR_CACHE","_getFromCache() "+o+" not in cache!")}}catch(e){}return r},r.prototype.doPreload=function(e){var t=this;return new Promise((function(i,n){try{t._cacheIsLoaded?i(t):t._preloadInProgress?n(t._cacheID+" doPreload() is already in progress... ignoring request"):(t._preloadInProgress=!0,t._dbgout("ATTR_CACHE",t._cacheID+" PRELOADING 'diff'"),t._updateCache(e.diff,!1).then((function(o){0==o||0==t._preloadInProgress?(t._dbgout("ATTR_CACHE",t._cacheID+" load aborted / data is no longer relevant."),t._preloadInProgress=!1,n("Preload() aborted")):(t._dbgout("ATTR_CACHE",t._cacheID+" PRELOADING 'nodiff'"),t._updateCache(e.nodiff,!1).then((function(e){0==e||0==t._preloadInProgress?(t._dbgout("ATTR_CACHE",t._cacheID+" load aborted / data is no longer relevant."),n("Preload() aborted")):(t._dbgout("ATTR_CACHE",t._cacheID+" *CACHE FULLY LOADED* for current model"),t._cacheIsLoaded=!0,t._preloadInProgress=!1,i(t))}),(function(e){t._preloadInProgress=!1,t._dbgout("ATTR_CACHE",t._cacheID+" LOAD 'nodiffs' FAILED: "+e),n(e)})))}),(function(e){t._preloadInProgress=!1,t._dbgout("ATTR_CACHE",t._cacheID+" LOAD 'diffs' FAILED: "+e),n(e)})))}catch(e){t._preloadInProgress=!1,t.me._plugSvcs.errout("EXCEPTION while loading cache... aborted:: "+e),n(e)}}))},r.prototype._updateCache=function(e,t){var i=this,n=0,o=0,r=0;return new Promise((function(s,a){i._dbgout("ATTR_CACHE",i._cacheID+" Looking for objects in ATTR_FETCH cache...");var l=[];Object.keys(e._data).forEach((function(s){null==i._theCache[s]&&(i._theCache[s]={}),Object.keys(e._data[s]).forEach((function(a){null==i._theCache[s][a]&&(i._theCache[s][a]={}),Object.keys(e._data[s][a]).forEach((function(u){null==i._theCache[s][a][u]&&(i._theCache[s][a][u]={});var c=Object.keys(e._data[s][a][u]),d=[];if(c.forEach((function(e){if(void 0===i._theCache[s][a][u][e]||null===i._theCache[s][a][u][e]&&1==t){if(o++,d.push(e),i._theCache[s][a][u][e]=null,d.length>=10){var c={reqTenant:s,reqServiceName:a,reqSecurityContext:u,reqIDArray:d};l.push(c),d=[]}}else 0==t&&null==i._theCache[s][a][u][e]?r++:n++})),d.length>0){var p={reqTenant:s,reqServiceName:a,reqSecurityContext:u,reqIDArray:d};l.push(p)}}))}))}));var u=o>0?", must fetch...":"";i._dbgout("ATTR_CACHE",i._cacheID+" HIT: "+n+", MISS: "+o+u),0==l.length?s(0==r):(i._dbgout("ATTR_CACHE",i._cacheID+" *FETCHING PROPS* for "+o+" objects using "+l.length+" request set(s)"),i._doBigFetch(l).then((function(e){s(e)}),(function(e){a(e)})))}))},r.prototype._doBigFetch=function(t){var i=this;return new Promise((function(r,s){var a=0,l=t.length,u=l;function c(d){var p=d;if(--u>0){var h=p.result.results.length;i._dbgout("ATTR_CACHE",i._cacheID+" ...processing returned data set ("+h+" items in set); still have "+u+" requests to go...")}else i._dbgout("ATTR_CACHE",i._cacheID+" processing returned data...");for(var _=function(t,i){for(var o=[],r=t.length,s=0;s<r;s++)for(var a=t[s],l=null==a?0:a.result.results.length,u=0;u<l;u++){var c=a.result.results[u],d=new e(c.physicalID,c.type,c.type_icon_large_url,c.type_icon_url);if(d.setDBContext(a.securityContext,a.serviceName,a.tenant),i||d.add("thumbnailimage",n.thumbnailimage,c.thumbnail,"thumbnail",0),void 0!==c.basicData&&null!==c.basicData&&c.basicData.length>0)for(let e of c.basicData){const t=null!==e.nls&&void 0!==e.nls&&""!==e.nls?e.nls:e.displayName;d.add(e.name,t,e.value,e.type,e.UIPosition,e.multivalue)}if(void 0!==c.data&&null!==c.data&&c.data.length>0)for(let e of c.data){const t=null!==e.nls&&void 0!==e.nls&&""!==e.nls?e.nls:e.displayName;d.add(e.name,t,e.value,e.type,e.UIPosition,e.multivalue)}o.push(d)}return o}([p],i._isEffectivity),g=_.length,f=0;f<g;f++){var S=_[f],m=S.getPhysicalID(),C=S.dbContext.tenant,T=S.dbContext.serviceName,E=S.dbContext.securityContext,v=o(S);i._theCache[C][T][E][m]=v}if(a<l){var D=t[a++];i._dbgout("ATTR_CACHE",i._cacheID+" sending request #"+a+" of "+l+"("+D.reqIDArray.length+" objects)"),i._fetchReqSet(D).then((function(e){null==e?i._dbgout("ATTR_CACHE","Data discarded"):c(e)}),(function(e){s(e)}))}else u<=0&&r(!0)}for(a=0;a<2&&a<l;a++){var d=t[a];i._dbgout("ATTR_CACHE",i._cacheID+" sending request #"+(a+1)+" of "+l+" ("+d.reqIDArray.length+" objects)"),i._fetchReqSet(d).then((function(e){c(e)}),(function(e){s(e)}))}}))},r.prototype._fetchReqSet=function(e){var t=this;return new Promise((function(i,n){setTimeout((()=>{var o=t._plugSvcs.nowMS(),r=t._theCache;t._getAttrs(e.reqIDArray,e.reqServiceName,e.reqTenant,e.reqSecurityContext).then((function(s){if(r!==t._theCache)t._dbgout("ATTR_CACHE",t._cacheID+" Cache was flushed; incoming data ignored"),i(null);else{var a=s;if(Array.isArray(a.result.results)&&a.result.results.every((e=>!1!==e.success))){var l=e.reqIDArray.length,u="[ATTR_CACHE]"+t._cacheID+" FETCHED PROPS for "+l+" OBJECTS";if(t._plugSvcs.reportTime(o,u),"3dspace"===a.serviceName.toLowerCase())if(t._isInstance)a.result.results.forEach((e=>e.thumbnail=e.preview_url.length?e.preview_url:e.type_icon_large_url)),i(a);else if(t._isEffectivity)i(a);else{var c=t._plugSvcs.nowMS();t._getThumbnails(e.reqIDArray,e.reqServiceName,e.reqTenant,e.reqSecurityContext,a.result.results).then((function(n){t._plugSvcs.reportTime(c,"[CACHE]"+t._cacheID+" "+e.reqIDArray.length+" thumbnails loaded");var o=n;t._mergeInThumbInfo(a,o),i(a)}),(function(e){var n="attr fetch was OK (but missing thumbnails) :: "+e;t._plugSvcs.errout(n),i(a)}))}else{for(let e of a.result.results)if(e.hasOwnProperty("preview_url")&&""!==e.preview_url)e.thumbnail=e.preview_url;else{var d=e.data.findIndex((function(e){return"preview_url"===e.name}));if(d>=0){let t=e.data.splice(d,1);e.thumbnail=t[0].value}}i(a)}}else n("Failure getting Attributes: ")}}),(function(e){var i="Failure getting Attributes: "+e;t._plugSvcs.errout(i),n(i)}))}),1)}))},r.prototype._getAttrs=function(e,t,n,o){var r=this;if(r._isEffectivity)return new Promise((function(r,s){i.getEffectivityPromise2({objectIds:e,serviceIds:[t],tenant:n,securityContext:o}).then((function(e){r({serviceName:t,tenant:n,securityContext:o,result:e})}))}));if("3dportfolio"===t.toLowerCase()||"3dspace"===t.toLowerCase()){let i="",s="",a="";return"3dportfolio"===t.toLowerCase()?(i="/"+t+"/getAttrs",s="GET",a="objectIds="+e.join(",")):"3dspace"===t.toLowerCase()&&(i="/resources/v1/collabServices/attributes/op/read/",s="POST",a=!0===r._isInstance?{debug_properties:"",plmparameters:"true",relIDs:e,lIds:[]}:{debug_properties:"",readonly:"false",navigateToMain:"true",attributes:"true",plmparameters:"true",busIDs:e,relIDs:[],lIds:[]}),new Promise((function(e,l){r._plugSvcs.makeAuthHttpsCall(i,s,a,"json",n,t,o).then((function(i){e({serviceName:t,tenant:n,securityContext:o,result:i})}),(function(e){r._plugSvcs.errout("Failure retrieving attributes for object"),l(null)}))}))}return new Promise((function(r,s){i.getFederatedAttributesPromise({objectIds:e,serviceIds:[t],tenant:n,securityContext:o}).then((function(e){r({serviceName:t,tenant:n,securityContext:o,result:e})}))}))},r.prototype._getThumbnails=function(e,t,i,n,o){var r=this,s=[],a=e.length,l=0;return new Promise((function(u,c){e.forEach((function(e){let d=o.find((t=>t.physicalID===e)),p=void 0!==d?d.preview_url:"";if(null!=p&&""!==p)s[e]=p,++l>=a&&u(s);else{var h="/resources/compare/thumbnailUrl/"+e;r._plugSvcs.makeAuthHttpsCall(h,"GET",null,"text",i,t,n).then((function(n){var o=n;0==o.startsWith("http")&&(o=r._plugSvcs.makeServiceURL(t,i,o,null)),s[e]=o,++l>=a&&u(s)}),(function(e){c(e)}))}}))}))},r.prototype._mergeInThumbInfo=function(e,t){e.result.results.forEach((function(e){var i=e.physicalID,n=t[i];e.thumbnail=n}))},r})),define("DS/CompareWidget2/plugins/DATA/attrCacheMgr",["UWA/Class","DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/plugins/DATA/attrCache"],(function(e,t,i){function n(e){this._doFlush()}function o(e){this._doFlush(),this._zeroOutAllCaches()}return e.singleton({init:function(){return this._theCaches={},this._flushEventToken=null,this._zeroEventToken=null,this._plugSvcs=null,this._parent()},declareAttrCache:function(e,t){null==this._plugSvcs&&(this._plugSvcs=t),null==this._flushEventToken&&(this._flushEventToken=t.subscribe("EVENT_FLUSH_DATA_CACHES",n.bind(this))),null==this._zeroEventToken&&(this._zeroEventToken=t.subscribe("EVENT_ZERO_ALL_CACHES",o.bind(this))),null==this._theCaches[e]&&(this._theCaches[e]=new i(e,t))},undeclareAttrCache:function(e){},getCache:function(e){let i=this._theCaches[e];return null==i&&t.errout("BAD CACHE ID: "+e),i},getAllCaches:function(){return this._theCaches},_doFlush:function(){let e=this;if(null!=e._theCaches){Object.keys(e._theCaches).forEach((function(t){null!=e._theCaches[t]&&e._theCaches[t].flushCache()}))}t.dbgout("All attr value caches have been flushed")},_zeroOutAllCaches:function(){this._theCaches={}},loadAll:function(e){let t=this;var i=t._plugSvcs.nowMS();let n=Object.keys(t._theCaches),o=n.length,r=0;return new Promise((function(s,a){n.forEach((function(n){if(null!=t._theCaches[n]){let a="REFERENCE"==n?e.loadAttrIDS_REF:e.loadAttrIDS_INST;try{t._theCaches[n].doPreload(a).then((function(e){r++,r>=o&&(t._plugSvcs.reportTime(i,"[CACHE] All caches fully loaded"),s())}),(function(e){t._plugSvcs.errout("FAILED to load attrs '"+n+"' ::"+e),r++,r>=o&&s()}))}catch(e){t._plugSvcs.errout("FAILED to load attrs '"+n+"' ::"+KOarg),r++,r>=o&&s()}}}))}))}})})),define("DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/DATA/attrCacheMgr"],(function(e,t){function i(e){var i=this,n=e.data.selectedData;i._plugSvcs.dbgout("A new row has been selected..."),i._attrUpdateStartMS=i._plugSvcs.nowMS();var o=[];if(e.data.selectedData){var r=n[0].length>n[1].length?n[0]:n[1];if(0===r.length)return;if(i._isInstance){if("LIST"==e.data.structDisplayMode)return void i.postEvent("INST_PROPS_OFF_DURING_LIST_COMPARE",{id:"attrFetch"});if(1!=r.length)return void i.postEvent("INST_PROPS_OFF_TOO_MANY_SELECTED",{id:"attrFetch"})}else if(i._isEffectivity){if("LIST"==e.data.structDisplayMode)return void i.postEvent("EFFECTIVITY_OFF_DURING_LIST_COMPARE",{id:"attrFetch"});if(1!=r.length)return void i.postEvent("EFFECTIVITY_OFF_TOO_MANY_SELECTED",{id:"attrFetch"})}else{var s=!0;if("LIST"!=e.data.structDisplayMode)1!=r.length&&(s=!1);else{var a=r[0].ObjIDSpec.getPhysID();r.forEach((function(e){e.ObjIDSpec.getPhysID()!=a&&(s=!1)}))}if(!s)return void i.postEvent("REF_PROPS_OFF_TOO_MANY_SELECTED",{id:"attrFetch"})}n.forEach((function(e){if(null!=e&&e.length>0){var t=e[0],n=i._isInstance||i._isEffectivity?t.instObjIDSpec:t.ObjIDSpec;null!=n&&o.push(n)}}));let l=0;for(let e of o){let t=e.getPhysID();null!=t&&""!==t&&++l}if(0==l)i._plugSvcs.postEvent(i._isInstance?"INST_PROPS_OFF_NONE_AVAILABLE":i._isEffectivity?"EFFECTIVITY_OFF_NONE_AVAILABLE":"REF_PROPS_OFF_NONE_AVAILABLE",{id:"attrFetch"});else{if("relations"===o[0].getObjType())return void i.postEvent("GROUP_PLACEHOLDER_SELECTED",{id:"attrFetch"});i._plugSvcs.postEvent(i._isInstance?"INST_PROPS_UPDATE_IN_PROGRESS_EVENT":i._isEffectivity?"EFFECTIVITY_UPDATE_IN_PROGRESS_EVENT":"REF_PROPS_UPDATE_IN_PROGRESS_EVENT",null),t.getCache(i._attrDataType).getAttrData(o).then((function(e){if(null!=e){for(var t=!0,n=0;n<e.length;n++)if(null!=e[n]){t=!1;break}t?i._plugSvcs.postEvent(i._isInstance?"INST_PROPS_OFF_NONE_AVAILABLE":i._isEffectivity?"EFFECTIVITY_OFF_NONE_AVAILABLE":"REF_PROPS_OFF_NONE_AVAILABLE",{id:"attrFetch"}):i.updateOutput(e)}}),(function(e){var t="getAttrData() failed:: "+e;i._plugSvcs.dbgout("ATTR_CACHE",i._DEBUG_isInstTxt+t)}))}}}return e.extend({init:function(e,i,n,o){this._parent(e,i,n,o),this.enableDebugLabel("ATTR_CACHE"),this._isInstance=this._pluginOptions.isInstance,this._isEffectivity=this._pluginOptions.isEffectivity,this._DEBUG_isInstTxt=this._isInstance?"(INST)":this._isEffectivity?"(EFFECTIVITY)":"REF)",this._attrDataType=this._isInstance?"INSTANCE":this._isEffectivity?"EFFECTIVITY":"REFERENCE",t.declareAttrCache(this._attrDataType,o),this._comparisonInProgress=!1},onEnabled:function(){return this.subscribeEvent("NEW_CURRENT_SELECTION_EVENT",i.bind(this)),this._parent()},onDestroy:function(){return t.undeclareAttrCache(this._attrDataType),this._parent()},execute:function(e,i){var n=this;n._parent(e,i),this._comparisonInProgress=!0;let o=e;if(n._isInstance)n.postEvent("INST_PROPS_OFF_NONE_AVAILABLE",{id:"attrFetch"});else if(n._isEffectivity)n.postEvent("EFFECTIVITY_OFF_NONE_AVAILABLE",{id:"attrFetch"});else{n._plugSvcs.postEvent("REF_PROPS_UPDATE_IN_PROGRESS_EVENT",null),n._plugSvcs.dbgout("Performing initial ATTR_FETCH"),t.getCache(n._attrDataType).getAttrData(o).then((function(e){null!=e&&n.reportOK(e)}),(function(e){n._plugSvcs.showAlertBox("Failed to retrieve properties",null,"error"),n._plugSvcs.postEvent(n._isInstance?"INST_PROPS_FETCH_FAILED":n._isEffectivity?"EFFECTIVITY_FETCH_FAILED":"REF_PROPS_FETCH_FAILED"),n.reportKO(e)}))}}})})),define("DS/CompareWidget2/plugins/EXPORT/EXPORT_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/EXPORT/exManager","DS/CompareWidget2/support/tenantServiceContext_IDList","DS/CompareWidget2/plugins/DATA/attrCacheMgr"],(function(e,t,i,n){return e.extend({init:function(e,i,n,o){this._parent(e,i,n,o),this._crTreeArray_multiview=null,this._currentViewID_MULTI=null,this._displayMode="unknown",this._useOldExportFormat=!1,this._statusesHidden=!1,this._exManager=new t(o)},onEnabled:function(){var e=this;return e.enableDebugLabel("EXPORT"),e.subscribeEvent("EXECUTE_EXPORT_EVENT",e.handle_EXECUTE_EXPORT_EVENT.bind(e)),e.syncSetting("viewSettings.STRUCT_VIEW.display_mode","_displayMode",null),e.syncSetting("exportSettings.exportOldFormat","_useOldExportFormat",null),e.syncSetting("viewSettings.STRUCT_VIEW.statuses_to_hide","_statusesHidden",null),e.subscribeEvent("MULTIVIEW_VIEW_ID_UPDATE_EVENT",e._handle_MULTIVIEW_VIEW_ID_UPDATE.bind(e)),e.postEvent("EXPORT_IS_ENABLED"),e._plugSvcs.dbgout("EXPORT","EXPORT_IS_ENABLED event... "),e._parent()},onDisabled:function(){this.postEvent("EXPORT_IS_DISABLED"),this._plugSvcs.dbgout("EXPORT","EXPORT_IS_DISABLED event... ")},_handle_MULTIVIEW_VIEW_ID_UPDATE:function(e){this._currentViewID_MULTI=e.data.viewID},handle_EXECUTE_EXPORT_EVENT:function(e){let t=this;t._plugSvcs.dbgout("EXPORT","exporting... "+this._displayMode),t._exManager.displayExportInProgress();let i=this._crTreeArray;null!=this._crTreeArray_multiview&&(i=this._crTreeArray_multiview[this._currentViewID_MULTI]);let o=this._prepareLoadRequest(i);n.loadAll(o).then((function(e){let i=t._crTreeArray,o=t._displayMode,r=n.getAllCaches();if(null!=t._crTreeArray_multiview){let e=t._currentViewID_MULTI;i=t._crTreeArray_multiview[e],o="MULTI"}t._exManager.doExport(r,i,o,t._useOldExportFormat,t._statusesHidden,"csv",t._pluginOptions)}),(function(e){t._plugSvcs.errout("Failure loading properties; cannot export: "+eventData.data.type)}))},_prepareLoadRequest:function(e){var t=new i,n=new i,o=new i,r=new i;return e[0].visitAll_treeAndFN(0,(function(e){var i=e.getMatchInfo(),s=null==i||"IDENTICAL"!=i.getRelName(),a=s?t:n,l=s?o:r;if(0==e.isDummy()&&!e.isHeaderRow()){var u=e.getObjIDSpec_REF(),c=e.getObjIDSpec_INST();null!=u&&null!=u.getPhysID()&&a.addObjIDSpec(u),null!=c&&null!=c.getPhysID()&&l.addObjIDSpec(c)}if(null!=i){var d=i.getCompNode();if(null!=d&&0==d.isDummy()&&!d.isHeaderRow()){var p=d.getObjIDSpec_REF(),h=d.getObjIDSpec_INST();null!=p&&null!=p.getPhysID()&&a.addObjIDSpec(p),null!=h&&null!=h.getPhysID()&&l.addObjIDSpec(h)}}return!0})),e[0].visitAll_treeAndFN(1,(function(e){if(null==e.getMatchInfo()){var i=e.getObjIDSpec_REF(),n=e.getObjIDSpec_INST();null!=i&&t.addObjIDSpec(i),null!=n&&o.addObjIDSpec(n)}return!0})),{loadAttrIDS_REF:{diff:t,nodiff:n},loadAttrIDS_INST:{diff:o,nodiff:r}}},onDestroy:function(){return this._parent()},execute:function(e,t){try{var i=this;i._parent(e,t),null!=e.viewID?(null==this._crTreeArray_multiview&&(this._crTreeArray_multiview={}),null==this._currentViewID_MULTI&&(this._currentViewID_MULTI=e.viewID),this._crTreeArray_multiview[e.viewID]=e.crTreeArray):this._crTreeArray=e,i.reportOK(null)}catch(t){i._plugSvcs.dbgout("EXPORT","reports exception:: "+t),i.reportKO(e)}}})})),define("DS/CompareWidget2/userSettings/PLMReference",["UWA/Core","DS/CompareWidget2/userSettings/SettingsBase","i18n!DS/CompareWidget2/assets/nls/CompareV2"],(function(e,t,i){"use strict";return e.extend(t,{namespace:"",compareSettings:{dataSource:{useIndex:{value:!0,V1Preference:"useIndex",widgetSetting:{type:"boolean",label:i.useIndex,defaultValue:!0}}},includeFacets:{externalRelations:{showDocs:{value:!1,V1Preference:"showDocs"},showOtherRels:{value:!1,V1Preference:"showOtherRels"}}}},viewSettings:{INSTANCE_VIEW:e.extend(e.clone(t.viewSettings.PROP_VIEW,!0),{attributes_display_option:{value:"",V1Preference:"compare_attributes_display_option_INST"},attributes_not_shown:{value:"",V1Preference:"compare_attributes_not_shown_INST"}}),EFFECTIVITY_VIEW:e.extend(e.clone(t.viewSettings.PROP_VIEW,!0),{attributes_display_option:{value:""},default_attributes:{value:["Effectivity","VariantOption","CurrentEvolution","ProjectedEvolution"]},attributes_always_shown:{value:""},attributes_not_shown:{value:""}}),CLASSIFICATION_VIEW:{showOnlyDifferences:{value:!1}}}},!0)})),define("DS/CompareWidget2/userSettings/VPMReference",["UWA/Core","DS/CompareWidget2/userSettings/PLMReference","i18n!DS/CompareWidget2/assets/nls/CompareV2"],(function(e,t,i){"use strict";return e.extend(t,{namespace:"",viewSettings:{PAD3D_VIEW:{view3D:{isolate:{value:!0,V1Preference:{viewer_display_mode:[{oldValue:"isolate",newValue:!0},{oldValue:"select",newValue:!1}]},widgetSetting:{type:"boolean",label:i.viewerIsolate,defaultValue:!1}}}}},inlcudePGPHideShowSettings:{includePGPHideShow:{value:!0,widgetSetting:{type:"boolean",label:i.includePGPHideShow,defaultValue:!0}}}},!0)})),define("DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/Trees",["UWA/Controls/Abstract","UWA/Core","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/DataGridView/DataGridView","DS/CompareWidget2/widget/controls/TreesContainer","DS/CompareWidget2/widget/controls/TreePanel","i18n!DS/CompareWidget2/assets/nls/CompareV2"],(function(e,t,i,n,o,r,s,a){"use strict";return e.extend({init:function(e){this.dataGridConfigArray=e.dataGridConfigArray,this._parent({}),this.onSelectRow=e.onSelectRow,this.onUnselectRow=e.onUnselectRow,this.cols=e.cols,this._eachGridColorColumns=[];let i=this;this._currentlySelectedRowIDs=[],this.treeContainers=[],this.onContextMenu=e.onContextMenu,this.rowSelection=e.rowSelection,this.cellDragEnabledFlag=e.cellDragEnabledFlag,this.dataGridConfigArray.forEach(((e,t)=>{var n=e.cols.find((e=>"tree"===e.dataIndex)),o=n.onCellRequest;n.onCellRequest=e=>{i.onCellRequest(e,i.dataGridViews[t]),"function"==typeof o&&o(e)}})),this.onScroll=e.onScroll,this.onExpand=e.onExpand,this.onCollapse=e.onCollapse,this.onPreExpand=e.onPreExpand,this.onPreCollapse=e.onPreCollapse,this.treeContainers=[],this.treePanels=[],this.treesContainer=new r,e.dataGridConfigArray.forEach((function(e,n){var o=e.gridViewContainerParams,r=new s({caption:o.panelCaption,addClass:o.panelAddClass,contentId:o.id,contentBorderTop:o.styles["border-top"],collapseable:o.panelCollapseable,initSize50pct:!!o.initSize50pct&&o.initSize50pct,colorIndicator:e.colorIndicator});t.createElement("div",{class:"replace-existing-drag-overlay",id:"replace-existing-drag-overlay_"+n,html:[{tag:"div",id:"replace-existing-dropIconAndText_"+n,class:"replace-existing-dropIconAndText",html:[{tag:"i",styles:{color:"#368EC4"},class:"replace-existing-icon wux-ui-3ds wux-ui-3ds-refresh"},{tag:"h5",class:"replace-existing-txt",styles:{color:"#368EC4","font-size":"16px","margin-top":"5px"},html:a.replaceExisting}]}]}).inject(r.elements.container),i.treePanels.push(r),i.treeContainers.push(r.elements.content),i.treesContainer.addPanel(r)})),this.elements.container=this.treesContainer.elements.container,this._skipSync=!1},show:function(){this.getContent().style.display="flex"},restorePreviousSelection:function(){var e=this,t=this.getNTHGridSelectedNodes(0);this.clearNTHGridSelection(0);var i=!1;if(t.forEach((t=>{var n=t._rowID,o=e.dataGridViews[0].model.find((e=>e._rowID===n&&e.isVisible()));o&&(o.select(),i=!0)})),!i){var n=e.dataGridViews[0].model.find((e=>e.isVisible()));n&&n.select()}},onDataGridViewsReady:function(e){let t=this;this.dataGridViews.forEach((e=>{t.syncScrolling(e),t.syncExpandCollapse(e.getTreeDocument()),t.subscribeForTreeSync(e)})),e()},clear:function(){this.treeContainers.forEach((e=>e.empty()))},update:function(e,n,r,s){this.clear();var a=this;Array.isArray(this.dataGridViews)&&this.dataGridViews.length&&this.dataGridViews.forEach((e=>e.destroy())),Array.isArray(this.dataGridViews)&&this.dataGridViews.length&&this.dataGridViews.forEach((e=>e.destroy())),this.dataGridViews=[],this.dataGridConfigArray.forEach(((e,n)=>{var s=t.createElement("div",{class:"compare_tree_list_view"});s.inject(a.treeContainers[n]);for(var l=e.cols.length-1;l>=0;--l){let t=e.cols[l];var u=t.text;if(null!=u){var c=r[u];null!=c&&("_#_DELETED_#_"===c?e.cols.splice(l,1):t.text=c)}}if(1===e.cols.length&&"left"===e.cols[0].pinned)for(var d of(e.cols[0].pinned="",a._eachGridColorColumns))for(var p of d)"left"===p.pinned&&(p.pinned="");var h=new o({enableListSelection:!0,identifier:e.identifier,columnDragEnabledFlag:!1,treeDocument:new i({}),columns:a._eachGridColorColumns[n].concat(e.cols),cellDragEnabledFlag:a.cellDragEnabledFlag,defaultColumnDef:{minWidth:8.5},layoutOptions:{rowsHeader:0===n,useLastColumnWidthAutoFlag:!0},rowSelection:a.rowSelection,selectionBehavior:{unselectAllOnEmptyArea:!1,selectOnContextualEvent:!0},onContextualEvent:function(e){return new Promise((function(t){a.onContextMenu(e).then((function(e){t(e)}))}))}});h.onDragStartCell=function(e,t){this.draggingFromCompare=!0;var i=[];if(t.draggedNodes.forEach((function(e){var t=e._options.data,n=t._attrList,o=t.getDBContext();if(t.isDraggable()){var r=t.getPath().split("/").map((function(e){return{resourceid:e}}));i.push({contextId:o.securityContext,envId:o.tenant,objectId:n.physicalID_REF,objectType:n.type,path:r,serviceId:o.serviceName})}})),0==i.length)return e.preventDefault(),!1;var n={protocol:"3DXContent",version:"1.1",source:"ENOCOMP_AP",widgetId:widget.id,data:{items:i}};return e.dataTransfer.setData("Text",JSON.stringify(n)),!0},h.onDragOverCell=function(e,t){return!0},h.onDragEndCell=function(e,t){return this.draggingFromCompare=!1,!0},a.dataGridViews.push(h),h.inject(s)})),Promise.all(this.dataGridViews.map((e=>new Promise((t=>e.onPostUpdateViewOnce((()=>t()))))))).then((()=>a.onDataGridViewsReady(s))),this.withUpdateLocked((function(){a.dataGridViews.forEach(((t,i)=>{a.buildDataGridView(t,e[i],i,n),t.getTreeDocument().getRoots()[0].select()})),"function"==typeof a.onSelectRow&&a.onSelectRow()}))},buildDataGridView:function(e,t,i,n){t.constructor!=Array&&(t=[t]),e.getNodesXSO().empty(),e.getTreeDocument().empty();var o=this;this.dbgcnt=0,this.asRoot=0,this.asChild=0;var r=e.getTreeDocument();r.withTransactionUpdate((function(){t.forEach((function(e){o.asRoot++,o.crNode2tNode(e,r,i)}))})),e.elements.container.style.top="4px",e.layout.columnsHeader=n,e.layout.rowsHeader=!1,e.cellSelection="none",e.showCellActivationFlag=!1,e.selected=[]},crNode2tNode:function(e,t,i){this.dbgcnt++;var o=this,r=null;if("function"!=typeof o.dataGridConfigArray[i].createTreeNodeConfig)throw Error("Trees:crNode2tNode - createTreeNodeConfig not defined");if(r=new n(o.dataGridConfigArray[i].createTreeNodeConfig(e)),null==t)throw new Error("crNode2tNode: Parent node is null");t.addChild(r),e.__TREENODE__=r,e.getMatchInfo().addTreeNode(r);let s=e.getChildArray(),a=r.options.expandedState?r.options.expandedState:Array.isArray(s)&&s.length?"expanded":"noChildren";r.setState({state:a}),e.setExpandCollapseState(r.getState()),Array.isArray(s)&&s.length&&s.forEach((function(e){o.asChild++,o.crNode2tNode(e,r,i)}))},hasNextNonEmptyBrother:function(e){for(var t=!1,i=e.getNextBrother();null!=i&&!(t=""!=i.getLabel());)i=i.getNextBrother();return t},hideParentLinks:function(e,t,i){},drawDiffFlags:function(e,i){var n=i.cellView.elements.tags;if(null==n){n=t.createElement("div",{styles:{display:"flex",width:5*this._maxFlagsPerDiff+"px"}});var o=i.cellView.elements.container;o.insertBefore(n,o.children[0]),i.cellView.elements.tags=n}n.innerHTML="";for(var r=0;r<e.length;r++){var s=e[r];t.createElement("span",{styles:{width:"5px",background:s.COLOR}}).inject(n)}},drawLinks:function(e,t){var i=this.hasNextNonEmptyBrother(e.nodeModel),n=e.cellView.elements.linksContainer.getChildren()[0];if(null!=n){var o=n.getChildren();if(!i){var r=o[o.length-1];null==e.nodeModel.getLabel()?r.setStyle("visibility","hidden"):r.setStyle("height","50%")}this.hideParentLinks(e.nodeModel,o,1)}null==e.nodeModel.getLabel()?e.cellView.elements.expanderContainer.hide():(e.cellView.elements.expanderContainer.show(),e.cellView.elements.expanderContainer.setStyle("visibility","visible"),e.cellView.elements.linksContainer.setStyle("visibility","visible"))},onCellRequest:function(e,t){t.defaultOnCellRequest(e),this.drawLinks(e,t)},isScrollbarShown:function(){if(null!=this.dataGridViews){var e=this.dataGridViews[0].elements,t=this.dataGridViews[1].elements;return e.poolContainer.clientHeight>e.container.clientHeight&&t.poolContainer.clientHeight>t.container.clientHeight}return!1},syncExpandCollapse:function(e){function t(t,i){var n=this;return o=>{if(null!=o.data.virtualRowID&&!0!==this._skipSync){for(var r=n.dataGridViews.reduce(((t,i)=>i.getTreeDocument()!==e?(t.push(i),t):t),[]),s=0;s<r.length;++s){var a=r[s];if(null!=a){if(!0===a._isSyncing)return;a._isSyncing=!0;let e=a.model.find((({_rowID:e})=>e===o.data.virtualRowID));null==e||void 0===e[t]||null===e[t]||e[t](),a._isSyncing=!1}}"function"==typeof n[i]&&n[i](o.data)}}}var i=this;e.onPostExpand(t.bind(this)("expand","onExpand")),e.onPostCollapse(t.bind(this)("collapse","onCollapse")),e.onPreExpand((function(e){i.onPreExpand(e.data)})),e.onPreCollapse((function(e){i.onPreCollapse(e.data)}))},syncScrolling:function(e){var t=this,i=t.dataGridViews.reduce(((t,i)=>i!==e?(t.push(i),t):t),[]),n=e._getScroller();n.onScrollBegin((i=>{t._activeScrollingGrid||(t._activeScrollingGrid=e)})),n.onScroll((n=>{t._activeScrollingGrid===e&&setTimeout((()=>{var n=e.getScrollerPosition();i.forEach((e=>e.setScrollerPosition(n))),"function"==typeof t.onScroll&&t.onScroll(n,e)}),0)})),n.onScrollEnd((i=>{t._activeScrollingGrid===e&&(t._activeScrollingGrid=null)}))},selectByCrNodes:function(e){var t=this;t.withUpdateLocked((()=>{e.forEach(((e,i)=>{for(var n=e.__TREENODE__;null!=n&&!n._isVisible();)n=n.getParent();var o=n._getRowID();t.dataGridViews.forEach(((e,t)=>{var n=e.model.find((({_rowID:e})=>e===o));if(null!=n&&!n.isSelected()){0===i&&0===t&&e.ensureNodeModelVisible(n,!0,!1,.5),e.selectNodeModel(n,!0,!1)}}))}))}))},subscribeForTreeSync:function(e){var t=this;e.getTreeDocument().subscribe({event:"select"},(function(i){var n=i.data.nodeModel._getRowID();t.dataGridViews.reduce(((t,i)=>i!==e?(t.push(i),t):t),[]).forEach((e=>{var t=e.model.find((({_rowID:e})=>e===n));null==t||t.isSelected()||e.selectNodeModel(t,!0,!1)})),-1===t._currentlySelectedRowIDs.indexOf(n)&&(t._currentlySelectedRowIDs.push(n),"function"==typeof t.onSelectRow&&t.onSelectRow())})),e.getTreeDocument().subscribe({event:"unselect"},(function(i){var n=i.data.nodeModel._getRowID(),o=t.dataGridViews.reduce(((t,i)=>i!==e?(t.push(i),t):t),[]),r=!1;o.forEach((e=>{var t=e.model.find((({_rowID:e})=>e===n));null!=t&&t.isSelected()&&(r=!0,e.unselectNodeModel(t))})),1==r&&-1!==t._currentlySelectedRowIDs.indexOf(n)&&(t._currentlySelectedRowIDs.splice(t._currentlySelectedRowIDs.indexOf(n),1),"function"==typeof t.onUnselectRow&&t.onUnselectRow())}))},clearCurrentlySelectedRowIDs:function(){this._currentlySelectedRowIDs=[]},prepareUpdateView:function(){this.dataGridViews.forEach((e=>e.prepareUpdateView()))},pushUpdateView:function(){this.dataGridViews.forEach((e=>e.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0)))},withUpdateLocked:function(e){this.prepareUpdateView(),e(),this.pushUpdateView()},setEachGridColorColumns:function(e){this._eachGridColorColumns=e},getNTHGridSelectedNodes:function(e){return this.dataGridViews[e].getNodesXSO().get()},getNTHGrid:function(e){return this.dataGridViews[e]},clearNTHGridSelection:function(e){this.dataGridViews[e].getNodesXSO().empty()},setPanelCaption:function(e,t){this.treesContainer.setPanelCaption(e,t)},destroy:function(){Array.isArray(this.dataGridViews)&&this.dataGridViews.length&&(this.dataGridViews.forEach((e=>e.destroy())),this.dataGridViews=[]),this.clear()},applyFilterModelToTrees:function(e){let i=this,n=!t.equals(e,i.dataGridViews[0].getTreeDocument().getFilterManager().filterModel);this.withUpdateLocked((()=>{i.dataGridViews.forEach((i=>{n?i.getTreeDocument().setFilterModel(t.clone(e,!0)):i.getTreeDocument().reapplyFilterModel()}))}))}})})),define("DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structComparePanel",["DS/CompareCommon/DragAndDrop","DS/CompareCommon/Utils","DS/CompareCommon/CompareIdDataListItem","DS/CompareCommon/Input/RevisionsManager","DS/CompareCommon/Input/FilterManager","DS/CompareCommon/Input/SearchManager","DS/CustomizableLayout/View","DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/Overview","DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/Trees","DS/CompareWidget2/support/objIDSpec","DS/CompareWidget2/viewComponents/StandardCompareToolbar","DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structExpandCollapseMenu","DS/CompareWidget2/ViewDefModules/DSColors","DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/externalController","DS/UIKIT/Mask","DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/flagInfo","DS/CompareWidget2/support/typeHierMgr","DS/CompareWidget2/support/attrNLS_mgr","DS/CompareWidget2/support/cw2Utils","DS/CompareCommon/Probs/CompareAnalyticsProb","i18n!DS/CompareCommon/assets/nls/CompareInput","i18n!DS/CompareCommon/assets/nls/CompareCustomization","i18n!DS/CompareWidget2/assets/nls/CompareV2","i18n!DS/CompareWidget2/assets/nls/DisplayMessages","css!UIKIT/UIKIT.css","css!DS/CompareWidget2/CompareWidget2.css"],(function(e,t,i,n,o,r,s,a,l,u,c,d,p,h,_,g,f,S,m,C,T,E,v,D){"use strict";const I="compare-tree-left",y="compare-tree-right",b="compare-list-left",R="compare-list-right",A="custAttr_",O=["REF_ds6w:label_ATTR"];function P(e,t,i){let n=[];if(null==t||""===t){if(null!=e)for(const[t,o]of Object.entries(e))i&&-1!==o.name.indexOf("INST")||n.push(t),n=n.filter((e=>!O.includes(e)))}else{let r="string"==typeof t?[t]:t;for(var o of r)if(null!=e&&null!==o&&""!==o)for(const[t,r]of Object.entries(e))r.origin===o&&(i&&-1!==r.name.indexOf("INST")||n.push(t),n=n.filter((e=>!O.includes(e))))}return 0!=n.length?n:null}return s.extend({init:function(e,i,n,r){this._parent(n),this._plugSvcs=i;let s=[];null!=r&&(s=Object.keys(r)),this._isCustomCompare=s.length>0,this._customAttrNames=r||{},this._statusFilterHideChildIfParentIsHidden=!0,this._skeletonBuilt=!1,this._OKfn_forShowResults=null,this.cellDragEnabledFlag=!!n.CELL_DRAG_ENABLED_FLAG,this._forceRootsTogether=!0,this.elements.container=e,this._showHideNodeParamsOnTypeAndAttribute=n.SHOW_HIDE_NODE_PARAMS,this._newCurrentSelectionEvent="string"==typeof n.CUSTOM_NEW_CURRENT_SELECTION_EVENT&&n.CUSTOM_NEW_CURRENT_SELECTION_EVENT.length?n.CUSTOM_NEW_CURRENT_SELECTION_EVENT:"NEW_CURRENT_SELECTION_EVENT",this._aggVisibilityFilterModels={showByStatusFilter:{filterId:"set",filterModel:[1]}},this._allowedDisplayModes=[{id:"tree",icon:"tree-view-all",title:v.StructureView,tooltip:t.generateTooltip("CompareWidget2/Tooltips","StructureView"),expandCollapseEnabled:!0},{id:"list",icon:"view-list",title:v.ListView,tooltip:t.generateTooltip("CompareWidget2/Tooltips","ListView"),expandCollapseEnabled:!1}],this._displayMode="tree",this._multiStatusesToHideAnd=!1,this._statusesHidden=[],this._statusesUnchecked=[],this._structMatchPairArray=[],this._listMatchPairArray=[],this._listIsComputed=!1,this._structIsComputed=!1,this._currentExpandMenuId="expandAll",this._activeColData=null,this._flagInfo=new g(n,i),this._activeTrees=null,this._activeMatchPairArray=[],this._suspendExpandUpdates=!1;var a=n.CONTEXT_MENU_PLUGIN||"DS/CompareWidget2/viewComponents/ContextMenuBase",l=this;require([a],(function(e){l._contextMenuPlugin=new e({structComparePanel:l}),l.buildSkeleton(n,l._customAttrNames)}),(function(e){console.error("FAILED TO LOAD "+a+": msg:"+e)})),this._externalController=new h(this._getActiveTree.bind(this),this.isList.bind(this),i.dbgout),o.setApplyCallback(this,[{whichOne:"left"},{whichOne:"right"}],this.onApplyNGFilter)},getExternalController:function(){return this._externalController},_getActiveTree:function(){return this._activeTrees},buildSkeleton:function(e,t){var i=this.elements.container;this._expandCollapseMenu=new d({structComparePanel:this}),this.standardToolbar=new c(i,this,{navigateDifferences:!0,showCompareLegend:!0,otherMenuItems:this.applyOtherMenuCommands(),CUSTOM_PROFILE_IN_USE:!0===this.options.CUSTOM_PROFILE_IN_USE});var n=e.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR,o=e.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR;if(this._structTrees=new l({dataGridConfigArray:this.generateDataGridConfig({baselineColor:n,compareColor:o,displayView:"tree",customAttrNames:t}),onSelectRow:this.onTreesSelectRow.bind(this),onUnselectRow:this.onTreesUnselectRow.bind(this),onCollapse:this.onTreesCollapse.bind(this),onExpand:this.onTreesExpand.bind(this),onPreCollapse:this.onTreesPreCollapse.bind(this),onPreExpand:this.onTreesPreExpand.bind(this),baselineColor:n,compareColor:o,onContextMenu:this._contextMenuPlugin.createContextMenu.bind(this._contextMenuPlugin),rowSelection:"multiple",cellDragEnabledFlag:this.cellDragEnabledFlag,showNodeKPIColorFlag:null!=t&&Object.keys(t).length>0}),this._structTrees.inject(i),this._listTrees=new l({dataGridConfigArray:this.generateDataGridConfig({baselineColor:n,compareColor:o,displayView:"list",customAttrNames:t}),onSelectRow:this.onTreesSelectRow.bind(this),onUnselectRow:this.onTreesUnselectRow.bind(this),baselineColor:n,compareColor:o,onContextMenu:this._contextMenuPlugin.createContextMenu.bind(this._contextMenuPlugin),rowSelection:"single",cellDragEnabledFlag:this.cellDragEnabledFlag,showNodeKPIColorFlag:Object.keys(t).length>0}),this._listTrees.inject(i),this._listTrees.hide(),this._skeletonBuilt=!0,null!=this._OKfn_forShowResults){var r=this._OKfn_forShowResults;this._OKfn_forShowResults=null,this._doShowResults(r)}},dragEnterPanel:function(t){let i=this;var n=this._activeTrees.dataGridViews.every((function(e){return!e.draggingFromCompare}));if(void 0!==t.currentTarget&&null!==t.currentTarget&&n){let n=t.currentTarget.parentElement.getElement(".replace-existing-drag-overlay");n&&n.setAttribute("visible","");let o=n.getElement(".replace-existing-dropIconAndText");e.attachObject(o.id,i,(e=>{}),i.dragLeaveOverlayPanel,i.dropHandler,null,parseInt(o.id.split("_")[1]))}},dragLeaveOverlayPanel:function(t){t.target&&t.currentTarget&&t.target===t.currentTarget&&t.target.hasClassName("replace-existing-dropIconAndText")&&(t.target.parentElement.removeAttribute("visible"),e.detachObject(t.target.id))},dropHandler:function(n,o,r){var s=this,a=this._activeTrees.dataGridViews.every((function(e){return!e.draggingFromCompare}));let l=event.currentTarget;if(l.hasClassName("replace-existing-dropIconAndText")&&(l.parentElement.removeAttribute("visible"),e.detachObject(l.id)),a){if(o.objArray.length>1)return void this._plugSvcs.showAlertBox("DROP_1_OBJ_REPLACE",D,"error");var c=t.fetchPersistedIDs(),d=o.objArray,p=d.map((function(e){return e.objectId})),h=d.map((function(e){var t={};for(var i in e)t[i]=e[i];return t})),_=p.length;for(var g of d)if(t.objectTypeNotAllowedForCompare(g.objectType))return;for(var f=0;f<_;++f){var S=new i(p[f],h[f]);c.items[r]=S}t.persistIDs(c),o.objArray.forEach((function(e){e.physID=e.objectId})),t.setSupportsEffectivityBasedRevisions(o.objArray,o.objArray[0].envId,o.objArray[0].contextId).then((function(){var e=[];o.objArray.forEach((function(t){var i=new u(t.objectId,t.objectType,t.contextId,t.envId,t.serviceId,null,"modelID",null,!0,!0,null,t.supportsEffectivityBasedRevisions);e.push(i)})),s._plugSvcs.postEvent("Event_replaceCompare",{targetIndex:r,objIDSpecArray:e})}))}this._activeTrees.dataGridViews.forEach((e=>e.draggingFromCompare=!1)),e.reset()},generateDataGridConfig:function(e){var t=this;return[{identifier:"CompareBaseline",cols:this["tree"===e.displayView?"getTreeCols":"getListCols"](e,"baseline"),createTreeNodeConfig:t.createTreeNodeConfig.bind(t),colorIndicator:e.baselineColor,gridViewContainerParams:{id:"tree"===e.displayView?I:b,panelCaption:"Left",panelAddClass:"treePanel-cmpBase",panelCollapseable:!0,initSize50pct:!0,color:e.baselineColor,styles:{display:"flex","flex-direction":"column","border-top":"4px solid "+e.baselineColor,width:"50%"}}},{identifier:"CompareCompare",cols:this["tree"===e.displayView?"getTreeCols":"getListCols"](e,"compare"),createTreeNodeConfig:t.createTreeNodeConfig.bind(t),colorIndicator:e.compareColor,gridViewContainerParams:{id:"tree"===e.displayView?y:R,panelCaption:"Right",panelAddClass:"treePanel-cmpCmp",panelCollapseable:!1,initSize50pct:!0,styles:{display:"flex","flex-direction":"column","border-top":"4px solid "+e.compareColor,padding:"0px 3px",width:"50%"}}}]},getTreeCols:function(e,t,i){let n=this,o=[],r={dataIndex:"tree",typeRepresentation:"string",width:"auto",minWidth:200,sortableFlag:!1,resizableFlag:!0};if(1==this._isCustomCompare){let s=P(e.customAttrNames,"matching_rule",i),a=P(e.customAttrNames,"additional_status",i);r.text=v.get("TitleColumnHeader"),r.icon={iconName:"product",fontIconFamily:WUXManagedFontIcons.Font3DS},null!==a&&(r.pinned="left"),r.getCellKPIColor=function(i){let n=i.nodeModel.options.data;return"function"!=typeof n.getMatchInfo||n.getMatchInfo().getBaseNode().isDummy()||n.getMatchInfo().getCompNode().isDummy()||n.getMatchInfo().isAttributeValueEqual("title")||null==n.getAttr("title")||""===n.getAttr("title")?null:e[`${t}Color`]},r.onCellRequest=function(e){let t=e.cellView.getContent(),i=t.getElement(".wux-layouts-datagridview-kpi-color");if(null!=i){t.removeChild(i);let e=t.getElement(".wux-layouts-datagridview-tweaker-container");i.setStyle("outline-width","2px"),i.setStyle("margin-left","2px"),t.insertBefore(i,e)}},o.push(r);let l=(i,r)=>{var s={text:e.customAttrNames[i].name,icon:{iconName:e.customAttrNames[i].icon,fontIconFamily:WUXManagedFontIcons.Font3DS},dataIndex:A+e.customAttrNames[i].name,width:"auto",minWidth:25,typeRepresentation:"string",sortableFlag:!1,resizableFlag:!0};r&&null!==a&&(s.pinned="left"),s.getCellKPIColor=function(i){let n=this.columns[i.columnID].dataIndex.split(A).pop(),o=i.nodeModel.options.data;return"function"!=typeof o.getMatchInfo||o.getMatchInfo().getBaseNode().isDummy()||o.getMatchInfo().getCompNode().isDummy()||"tree"===n||o.getMatchInfo().isAttributeValueEqual(n)||null==o.getAttr(n)||""===o.getAttr(n)?null:e[`${t}Color`]},s=n._specializeCol(i,s),o.push(s)};null!==s&&s.forEach((e=>l(e,!0))),null!==a&&a.forEach((e=>l(e,!1)))}else{o.push(r);let e={dataIndex:"rev",typeRepresentation:"string",width:35,minWidth:25,sortableFlag:!1,resizableFlag:!0};o.push(e)}return o},_specializeCol:function(e,t){switch(e){case"REF_ds6w:status_ATTR":delete(t=UWA.extend(t,{typeRepresentation:"tag",width:90,hasCellValue:function(e){return!!(e.nodeModel&&e.nodeModel.getLabel()&&e.nodeModel.getLabel().length>0)},getCellClassName:function(e){if(e.nodeModel&&e.nodeModel.options.data)return e.nodeModel.options.data.getAttr("maturity.class")}})).getCellKPIColor;break;case"REF_ds6w:reserved_ATTR":case"INST_ds6w:reserved_ATTR":t=UWA.extend(t,{typeRepresentation:"icon",width:80,getCellValue:function(t){let i=t.nodeModel.options.grid["REF_ds6w:reserved_ATTR"===e?A+"REF.ds6w:reserved":A+"INST.ds6w:reserved"];return"TRUE"===i?"lock":"FALSE"===i?"lock-open":null}});break;case"REF_ds6wg:revision_ATTR":t=UWA.extend(t,{width:80})}return t},getListCols:function(e,t){let i=this.getTreeCols(e,t,!0),n={dataIndex:"qty",width:1==this._isCustomCompare?50:30,sortableFlag:!1,resizableFlag:!0,minWidth:30};return 1==this._isCustomCompare&&null!=P(e.customAttrNames,"additional_status",!0)&&(n.pinned="left"),1==this._isCustomCompare&&(n.text=v.get("QuantityColumnHeader")),i.unshift(n),i},getEachGridColorColumns:function(){for(var e=this,i=[[]],n=[],o=e._flagInfo.getActiveMaxFlags(),r=0;r<o;r++){var s={typeRepresentation:"color",dataIndex:"FLAG_"+r.toString(),width:8.5,minWidth:8.5,sortableFlag:!1,resizableFlag:!1,hasCellValue:function(t){var i=!1,n=t.columnID,o=this.columns[n].dataIndex;if(o.startsWith("FLAG_")){var r=Number(o.split("_")[1]),s=t.nodeModel.options.data;if("function"==typeof s.getMatchInfo){var a=e._areAnyMatchPairChildrenVisible(s),l=s.getMatchInfo().getAllStatusArray(!a);if(Array.isArray(l)&&r<l.length){var u=l[r],c=e._flagInfo.getActiveFlagDisplayData(u);if(null!=c){var d=c.color,h=c.visibleFlag;null!=d&&d!==p.colorDef.WHITE&&1==h&&(i=!0)}}}}return i},getCellTooltip:function(i){var n,o,r=null==i.nodeModel||"function"!=typeof i.nodeModel.options.data.getMatchInfo?null:i.nodeModel.options.data.getMatchInfo();r&&(o=r.getAllStatusArray(!0));var s,a=Number(i.columnID),l=e._flagInfo.getActiveFlagDisplayData();if(Array.isArray(o)&&a<o.length&&o.length>0){var u=l[o[a]];if(null!=u.color&&u.visibleFlag){n=u.label;var c=u.modulePath;Object.entries(v).map((([e,i])=>{i===n&&(s=t.generateTooltip(c,e))}))}}return s}};this._isCustomCompare&&null!=P(this._customAttrNames,"additional_status",this.isList())&&(s.pinned="left",s.resizableFlag=!1,s.sortableFlag=!1),s.onCellRequest=function(e){this.defaultOnCellRequest(e),e.cellView.getContent().addClassName("compare-color-column")},n.push(s)}return i.push(n),i},createTreeNodeConfig:function(e){var t={data:e,label:e.getAttr("title"),icons:[e.getAttr("typeIconSmallURL")],grid:{rev:e.getAttr("revision"),type:e.getAttr("type"),showByStatusFilter:1}},i=e.getCustomRuleAttrs();(null!=i?Object.keys(i):[]).forEach((function(e,n){["ds6w:created","ds6w:modified"].some((t=>-1!==e.indexOf(t)))?t.grid[A+e]=m.formatDate(i[e]):t.grid[A+e]=i[e]}));var n=e.getMatchInfo(),o=this;return t.grid.showHideNodeOnTypeAndAttribute=n.getShowHideNodeByTypeAndAttrParamIndex(),"relations"!==e.getAttr("type")&&(t.grid.qty=e.qty),e.hasExternalFilter()&&(t.badges={bottomRight:"filter wux-layouts-treeview-badge compare-badge"}),n.getAllStatusArray(!0).forEach((function(e,i){var n=o._flagInfo.get_statusIDFlag(e);t.grid["FLAG_"+i]=n.color})),t},applyOtherMenuCommands:function(){var e=this,i=[];if(this._allowedDisplayModes.some((e=>e.expandCollapseEnabled))&&i.push({id:"expandCollapse",dataElements:{domId:"compare-struct-expansion-button",typeRepresentation:"functionIcon",label:v.chooseTreeExpansion,tooltipInfos:t.generateTooltip("CompareWidget2/Tooltips","chooseTreeExpansion"),position:"far",priority:1,overflowPriority:"never",icon:{iconName:"expandAll"===e._currentExpandMenuId?"flow-tree-expand-down":"flow-tree-expand-up",fontIconFamily:1},value:t=>e._displayMenu(e._expandCollapseMenu.getExpandCollapseMenu(),t.dsModel.elements.container)}}),e._allowedDisplayModes.length>1){let n="tree"===this._displayMode?"TreeView":"ListView";console.log("probs -- compare UXMode changes from "+C.getUXMode()+" to "+n),C.setUXMode(n),i.push({id:"structPanelViewSelector",dataElements:{domId:"compare-struct-display-style-button",typeRepresentation:"functionIcon",label:v.chooseTreeOrListView,tooltipInfos:t.generateTooltip("CompareWidget2/Tooltips","chooseTreeOrListView"),position:"far",icon:{iconName:e._allowedDisplayModes.find((t=>t.id===e._displayMode)).icon,fontIconFamily:1},priority:1,overflowPriority:"never",value:t=>{e._displayMenu(e._allowedDisplayModes.map((t=>({type:"RadioItem",title:t.title,id:t.id,tooltip:t.tooltip,icon:t.icon,state:e._displayMode===t.id?"selected":"unselected",action:{callback:()=>e.handleToolbarCommands({event:"displayView",data:{mode:t.id,tooltip:t.tooltip,icon:t.icon}})}}))),t.dsModel.elements.container)}}})}return i},_displayMenu:function(e,t){var i=this;require(["DS/Menu/Menu"],(n=>{var o=t.getBoundingClientRect(),r={position:{x:o.right,y:o.bottom},layout:"topright",input:i.isTouch?"touch":"mouse"};n.show(e,r)}))},destroy:function(){this._externalController.destroy(),this._externalController=null,this.elements.container=null,this._activeTrees=null,null!=this._structTrees&&(this._structTrees.destroy(),this._structTrees=null),null!=this._listTrees&&(this._listTrees.destroy(),this._listTrees=null),this.overview=null,this._plugSvcs=null,this._structMatchPairArray=null,this._listMatchPairArray=null,this._activeMatchPairArray=null},handleToolbarCommands:function(e){switch(e.event){case"legendApplyFilter":this.applyStatusFilters(),this._updateToolbarDiffCount(),this._updateUserFilterSettings("legendFilter");break;case"legendApplyVisibility":this._showStatusChooserDialog(e);break;case"navigatePrevious":case"navigateFirst":case"navigateLast":case"navigateNext":this.onNavigate(e.event);break;case"displayView":if(this._displayMode!==e.data.mode){this.showResults(e.data.mode),this.standardToolbar.update({displayIcon:[{id:"structPanelViewSelector",icon:e.data.icon}],enableDisableCommands:[{id:"expandCollapse",disabled:this.isList()}]});let t="tree"===this._displayMode?"TreeView":"ListView";console.log("probs -- compare UXMode changes from "+C.getUXMode()+" to "+t),C.setUXMode(t),C.trackDisplayMode()}break;case"expandAll":case"collapseAll":case"expandNLevels":this.standardToolbar.update({displayIcon:[{id:"expandCollapse",icon:e.data.icon}]}),this._currentExpandMenuId=e.event,"expandNLevels"===e.event?this._expandNLevels_showPopup():this._expandCollapse("collapseAll"!==e.event,-1);break;case"revisionsDlg":this._displayHistoryGraph(e.data.whichSide,e.data.objIDSpecREF);break;case"filterPanel":this._displayFilterPanel(e.data.whichSide,e.data.objIDSpecREF)}},_updateUserFilterSettings:function(e){let t=this;function i(e,i,n){let o=t._flagInfo.getActiveFlagDisplayData();for(let[r,s]of Object.entries(o))r!==n&&(!0===s[e]&&t[i].indexOf(r)>=0?t[i]=t[i].filter((e=>e!==r)):!1===s[e]&&-1===t[i].indexOf(r)&&(t[i]=[...t[i],r]))}switch(e){case"legendFilter":i("checked","_statusesUnchecked");break;case"legendVisibility":i("visibleFlag","_statusesHidden","IDENTICAL")}},_expandNLevels_showPopup:function(e){var t=this;require(["DS/PADUtils/views/PADLevelSel"],(function(i){new i({current_level:1,events:{onApply:function(e){t._expandCollapse(!0,parseInt(e)||-1)}}});if(null!=e&&void 0!==e.position&&null!==e.position&&e.position.x>0&&e.position.y>0){var n=jQuery(".pad_level_sel_modal > .modal-wrap");null!=n&&n.length>0&&(n[0].setStyle("padding-top","0px"),n[0].setStyle("margin-top",e.position.y+"px"),n[0].setStyle("margin-left",e.position.x+"px"))}}))},_expandCollapse:function(e,t){var i=this;"tree"===this._displayMode&&(this._activeTrees.withUpdateLocked((()=>{i.beginSuspendExpandUpdates();let n=i._activeTrees._skipSync;i._activeTrees._skipSync=!0,i._activeTrees.dataGridViews.forEach(((n,o)=>{i._activeTrees.getNTHGridSelectedNodes(o).forEach((i=>{if(i.hasChildren()){var n={};-1==t?n.expandAll=!0:n.numberOfLevelsToExpand=t;try{e?-1==t?i.expandAll():(i.collapseAll(),i.expandNLevels(n)):i.collapseAll()}finally{}}else i.options.data.setExpandCollapseState("noExpandState")}))})),i._activeTrees._skipSync=n,i.endSuspendExpandUpdates()})),this.applyCurrentFilterToTrees())},getStatusFilterInfo:function(){var e=[],t=[],i=this._flagInfo.getActiveFlagDisplayData();return Object.keys(i).forEach((function(n){0==i[n].checked?e.push(n):t.push(n)})),{offFlags:e,onFlags:t}},applyStatusFilters:function(){var e=this;0==_.isMasked(e.elements.container)&&_.mask(e.elements.container),setTimeout((()=>{let t=e.isList(),i=e.getStatusFilterInfo();e._updateMatchPairHiddenFlags_AND_ApplyToTreeNode(t,i.offFlags,e._multiStatusesToHideAnd),e._activeTrees.applyFilterModelToTrees(e._aggVisibilityFilterModels),e.doExpandCollapseUpdates(),e.onTreesSelectRow(),_.unmask(e.elements.container)}),0)},_updateMatchPairHiddenFlags_AND_ApplyToTreeNode:function(e,t,i){let n=i?"both":"either",o={};t.forEach((function(e){o[e]=!0}));let r=e?this._crTree.getCRList().getMatchPairArray():this._crTree.getMatchPairArray(),s=r.length;for(let t=e?0:1;t<s;t++){let i=r[t],s=i.getRelName(),a=1==o[s];"both"==n?a&&e&&i.qtyIsDiffFlag&&(a&=1==o.QUANTITY):a||e&&i.qtyIsDiffFlag&&o.QUANTITY&&(a=!0),"both"==n?a&&i.getAdjFlagArray().forEach((function(e){a&=1==o[e]})):a||i.getAdjFlagArray().forEach((function(e){o[e]&&(a=!0)}));let l=i.getBaseNode().getParent(),u=i.getCompNode().getParent(),c="object"!=typeof l||"object"!=typeof u,d=!0;if(this.isList()||c||!this._statusFilterHideChildIfParentIsHidden)d=!a;else{let e=l.getMatchInfo();d=this._statusFilterHideChildIfParentIsHidden&&!a&&e&&!e.getIsHidden_byStatusFilter()}i.setIsHidden_byStatusFilter(!d);let p=Number(d);i.getTreeNodes().forEach((e=>e.options.grid.showByStatusFilter=p))}},legendApplyVisibility:function(e){let t=this._flagInfo.getActiveFlagDisplayData(),i=[];var n=!0;for(let[o,r]of Object.entries(e))n=n&&r,t[o].visibleFlag!==r&&(t[o].visibleFlag=r,i.push({id:o,visibleFlag:r}));return i.length&&(this.standardToolbar.update({showHideCommands:i}),this.doExpandCollapseUpdates()),{bAtLeastOneHidden:!n,bApplyChanges:i.length>0}},_showStatusChooserDialog:function(){var e=this._flagInfo.getActiveFlagDisplayData(),t=this;require(["DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/statusVisibilityDialog"],(i=>{new i({statuses:e,OKfn:e=>{let i=this.legendApplyVisibility.bind(this)(e);i.bApplyChanges&&(this._updateUserFilterSettings("legendVisibility"),this._updateToolbarDiffCount()),i.bAtLeastOneHidden&&t._plugSvcs.showAlertBox(D.HIDDEN_STATUSES_IDENTICAL,null,"info")}})}))},getDifferenceCount:function(){let e=this._flagInfo.getActiveFlagDisplayData();return this._activeMatchPairArray.filter((t=>t.getAllStatusArray().some((t=>"IDENTICAL"!==t&&e[t].checked&&e[t].visibleFlag))&&t.getBaseNode().__TREENODE__.isVisible())).length},clearView:function(){},getAttrNLS:function(e,t){let i={},n=[];for(const[t,o]of Object.entries(e))i[t]=o.name,void 0!==o.objType&&(n.includes(o.objType)||n.push(o.objType));var o=t.getRootObjIDSpec(0),r=o.getObjType(),s=o.getTenant(),a=o.getSecurityContext();return S.getAttrNLS(i,r,n,s,a)},updateResults:function(e,t){var i=this;return i._crTree=t,i._listIsComputed=!1,i._structIsComputed=!1,i._plugSvcs.postEvent("COMPARE_PANEL_UPDATED_EVENT",{}),i.showResults()},_resetTypeFiltersOn:function(e){Object.keys(e).forEach((function(t){e[t].checked=!0}))},_applyStatusDisplaySettings:function(e){for(let[t,i]of Object.entries(e))i.visibleFlag="IDENTICAL"===t?i.matchedPairs.length>0||Array.isArray(this._statusesHidden)&&this._statusesHidden.length>0&&this._statusesHidden.some((t=>null!=e[t]&&e[t].matchedPairs.length)):Array.isArray(this._statusesHidden)&&-1===this._statusesHidden.indexOf(t)},showResults:function(e){var t=this;return t._allowedDisplayModes.findIndex((t=>t.id===e))>=0&&(t._displayMode=e),new Promise((function(e,i){0==t._skeletonBuilt?t._OKfn_forShowResults=e:t._doShowResults(e)}))},_setupDnD:function(){var t=this;e.attachObject(I,t,t.dragEnterPanel,(e=>{}),(e=>{}),null,0),e.attachObject(y,t,t.dragEnterPanel,(e=>{}),(e=>{}),null,1),e.attachObject(b,t,t.dragEnterPanel,(e=>{}),(e=>{}),null,0),e.attachObject(R,t,t.dragEnterPanel,(e=>{}),(e=>{}),null,1)},_placeAttrNLSinTooltips:function(e,t){for(const[n,o]of Object.entries(e))if(void 0!==o.tooltip.shortHelp&&null!==o.tooltip.shortHelp&&o.tooltip.shortHelp.length>0){let r="";for(var i of o.tooltip.shortHelp){let e=i.name;"and"===i.info?r+=" "+E.get("RuleAnd")+" ":"or"===i.info&&(r+=" "+E.get("RuleOr")+" "),void 0!==t[e]&&null!==t[e]&&""!==t[e]?r+=t[e]:r+=e}let s=v.get("same"===o.tooltip.shortHelp[0].info?"CustomMatchingRuleShortHelp":"CustomAdditionalStatusShortHelp").replace("{msgData}",r);e[n].tooltip.shortHelp=s,e[n].tooltip.longHelp=v.get("CustomLegendLongHelp")}},_updateTrees:function(e,t,i,n){var o=this;o._activeTrees.update(e,t,i,function(){o._setupDnD();var e=o._flagInfo.getActiveFlagDisplayData_excludeFilteredByTypeAttr();void 0===o.options.PROPS||null===o.options.PROPS?o._updateTrees_finish(e,n):o.getAttrNLS(o.options.PROPS,o._crTree).then((function(i){t&&o._placeAttrNLSinTooltips(e,i),o._updateTrees_finish(e,n)}),(function(t){console.error("Failed to retrieve NLS values for attributes in legend tooltips. Continuing..."),o._updateTrees_finish(e,n)}))}.bind(o))},_updateTrees_finish:function(e,t){this.onTreesReady(e),this.onResize(),this._syncOverview(),this._updateToolbarDiffCount(),_.unmask(this.elements.container),t()},_doShowResults:function(e){var t=this;0==_.isMasked(t.elements.container)&&_.mask(t.elements.container),"tree"===t._displayMode?t.setup_tree():t.setup_list(),t._applyStatusDisplaySettings(t._flagInfo.getActiveFlagDisplayData()),t._resetTypeFiltersOn(t._flagInfo.getActiveFlagDisplayData()),t._activeTrees.setEachGridColorColumns(t.getEachGridColorColumns()),1==t.options.CUSTOM_PROFILE_IN_USE?t.getAttrNLS(t.options.PROPS,t._crTree).then((function(i){var n=i;t._updateTrees(t._activeColData,!0,n,e)}),(function(e){console.error("Failed to retrieve NLS header values for attrs. Continuing..."),t._updateTrees(t._activeColData,!0,{},OKfb)})):t._updateTrees(t._activeColData,!1,{},e)},setup_tree:function(){var e=this;e._structIsComputed||(e._structMatchPairArray=e._crTree.getMatchPairArray(),e._setup_allMatchPair_hiddenByTypeAttr(e._structMatchPairArray,e._aggVisibilityFilterModels.showHideNodeOnTypeAndAttribute),e._flagInfo.createFlagDisplayData("tree",e._structMatchPairArray,e._forceRootsTogether),e._structIsComputed=!0),e._listTrees&&e._listTrees.hide(),e._structTrees&&e._structTrees.show(),e._activeColData=[e._crTree.getRoot(0),e._crTree.getRoot(1)],e._activeMatchPairArray=e._structMatchPairArray,e._flagInfo.setActive("tree"),e._activeTrees=e._structTrees},setup_list:function(){var e=this;e._listIsComputed||(e._crList=e._crTree.getCRList(),e._listMatchPairArray=e._crList.getMatchPairArray(),e._setup_allMatchPair_hiddenByTypeAttr(e._listMatchPairArray,e._aggVisibilityFilterModels.showHideNodeOnTypeAndAttribute),e._flagInfo.createFlagDisplayData("list",e._listMatchPairArray,e._forceRootsTogether),e._listColData=e._crList.generateDisplayLists(),e._listIsComputed=!0),e._listTrees&&e._listTrees.show(),e._structTrees&&e._structTrees.hide(),e._activeColData=e._listColData,e._activeMatchPairArray=e._listMatchPairArray,e._flagInfo.setActive("list"),e._activeTrees=e._listTrees},onResize:function(){null!=this.overview&&(this.overview.onResize(),this.updateOverviewVisibility())},updateOverviewVisibility:function(){this._activeTrees.isScrollbarShown()?this.overview.show():this.overview.hide()},onTreesSelectRow:function(e){var t=this;this._viewerDisplayModeIsolate;var i=this._activeTrees.getNTHGridSelectedNodes(0),n=this._activeTrees.getNTHGridSelectedNodes(1);if((!e||0!=i.length&&0!=n.length)&&i.length===n.length){var o=[],r=this.isList();if(r){[i,n].forEach((function(e,i){var n=[];e.forEach((function(e){var o=e.options.data;if(!o.isDummy()){var r=o.getAttr("physicalID_REF"),s=o.getAttr("physicalID_INST");t._crTree.visitVisible_treeAndFN(i,(function(e){if(e.getAttr("physicalID_REF")==r){var t=e.getDBContext(),i=new u(r,e.getAttr("type"),t.securityContext,t.tenant,t.serviceName),o=null;null!=s&&(o=new u(s,e.getAttr("type"),t.securityContext,t.tenant,t.serviceName));var a={ObjIDSpec:i,IDPath:e.getPath(),instObjIDSpec:o,riNode:e._riNode};n.push(a)}return!0}))}})),o.push(n)}))}else{var s=[],a=[];i.forEach(((e,t)=>{let i=e.options.data,o=null==i||i.isDummy()?null:i.getObjIDSpec_REF();null!=o&&s.push({ObjIDSpec:o,IDPath:i.getPath(),instObjIDSpec:i.getObjIDSpec_INST(),riNode:i._riNode});var r=t<n.length?n[t].options.data:null;let l=null==r||r.isDummy()?null:r.getObjIDSpec_REF();null!=l&&a.push({ObjIDSpec:l,IDPath:r.getPath(),instObjIDSpec:r.getObjIDSpec_INST(),riNode:r._riNode})})),o.push(s),o.push(a)}t._plugSvcs.postEvent(t._newCurrentSelectionEvent,{isAsync:!0,selectedData:o,crTree:t._crTree,structDisplayMode:r?"LIST":"STRUCT"}),this._syncOverview()}},onTreesUnselectRow:function(){this._syncOverview(),this.onTreesSelectRow(!0)},onTreesPreCollapse:function(e){var t=e.nodeModel.options.data;"function"==typeof setExpandCollapseState&&t.setExpandCollapseState(e.nodeModel.getState())},onTreesPreExpand:function(e){var t=e.nodeModel.options.data;"function"==typeof setExpandCollapseState&&t.setExpandCollapseState(e.nodeModel.getState())},onTreesCollapse:function(e){var t=e.nodeModel.options.data;"function"==typeof setExpandCollapseState&&t.setExpandCollapseState(e.nodeModel.getState()),this.doExpandCollapseUpdates()},onTreesExpand:function(e){var t=e.nodeModel.options.data;"function"==typeof setExpandCollapseState&&t.setExpandCollapseState(e.nodeModel.getState()),this.doExpandCollapseUpdates()},beginSuspendExpandUpdates:function(){this._suspendExpandUpdates=!0},endSuspendExpandUpdates:function(){this._suspendExpandUpdates=!1,this.doExpandCollapseUpdates()},doExpandCollapseUpdates:function(){0==this._suspendExpandUpdates&&(this.onResize(),this._syncOverview(),setTimeout((()=>{this._updateToolbarDiffCount()}),0))},onTreesExpandAll:function(e){this._expandCollapse(!0,-1)},buildOverviewKeyDiffArray:function(e){for(var t=this,i=[],n=e.getTreeDocument().getAllDescendants(),o=0;o<n.length;o++){var r=n[o];if(r.isVisible()){var s=[],a=r.options.data.getMatchInfo();if(a){var l=a.getBaseNode(),u=t._areAnyMatchPairChildrenVisible(l);a.getAllStatusArray(!u).forEach((function(e){let i=t._flagInfo.get_statusIDFlag(e);s.push(i)}))}else{let e=t._flagInfo.get_statusIDFlag("IDENTICAL");s.push(e)}var c={objKey:o,flagDefArray:s,qtyDiff:!1};i.push(c)}}return i},onTreesReady:function(e){var t=this;this._applyShowHideNodesByTypeAndAttributes(),this._updateTreePanelCaptions(),null==this.overview&&(this.overview=new a({isListView:this.isList()}),this.overview.inject(this.elements.container)),this.dispatchEvent("onTreesLoaded"),this._syncOverview(),this.standardToolbar.update({legend:e,enableDisableCommands:[{id:"expandCollapse",disabled:!this._allowedDisplayModes.find((e=>t._displayMode===e.id)).expandCollapseEnabled},{id:"chooseStatusToDisplay",disabled:1===Object.keys(e).length&&null!=e.IDENTICAL&&e.IDENTICAL.visibleFlag}],modulePath:"CompareWidget2/Tooltips"})},_updateToolbarDiffCount:function(){let e=this.getDifferenceCount();this.standardToolbar.update({numDifferences:e})},_syncOverview:function(){if(void 0!==this.overview&&null!==this.overview){var e=this.buildOverviewKeyDiffArray(this._activeTrees.dataGridViews[1]);this.updateOverviewVisibility();var t=this._activeTrees.getNTHGridSelectedNodes(0),i=[];t.forEach((function(e){var t=e._getRowID();i.push(t)}));var n=this._flagInfo.getActiveFlagDisplayData();this.overview.syncWithNewData(!0,e,i,n,this.isList())}},_displayHistoryGraph:function(e,i){var o=this;let r={objId:i.getPhysID(),objType:i.getObjType(),tenant:i.getTenant(),securityContext:i.getSecurityContext()};n.displayHistoryGraph(r,null,{allowDuplicates:!0},(function(i){let n="left"===e?0:1,r=t.fetchPersistedIDs();r.items[n].objectId=i.physicalid,r.items[n].objectServices.objectId=i.physicalid,r.items[n].objectServices.objectType=i.type,r.items[n].objectServices.contextId=i.contextId,r.items[n].objectServices.displayName=i.displayName,r.items[n].objectServices.serviceId=i.serviceId,t.persistIDs(r);let s=new u(i.physicalid,i.type,i.contextId,i.envId);o._plugSvcs.postEvent("Event_replaceCompare",{targetIndex:n,objIDSpecArray:[s]})}))},_displayFilterPanel:function(e,t){var i={objId:t.getPhysID(),objType:t.getObjType(),tenant:t.getTenant(),securityContext:t.getSecurityContext(),serviceName:t.getServiceName()};o.activateProxy(e),o.executeFilterCmd(e,i)},onApplyNGFilter:function(e){const i=e.appId.startsWith("CompareWidget_right")?"right":"left",n="left"===i?0:1;let r=e.empty?null:e;var s=t.fetchPersistedIDs();s.items[n].filterData=r,e.empty?(s.items[n].filterSpec=null,t.persistIDs(s)):o.getFilterSpecificationPromise(i,r.filterRootIds[0]).then((function(e){1===e.status&&(s.items[n].filterSpec=e.publicSpec),t.persistIDs(s)}),(function(){t.persistIDs(s)}));let a=s.items[n].objectServices;var l=new u(a.objectId,a.objectType,a.contextId,a.envId,a.serviceId,r);this._plugSvcs.postEvent("Event_replaceCompare",{targetIndex:n,objIDSpecArray:[l]})},_displaySearchPanel:function(e,i){var n=this,o=i.getTenant(),s=i.getSecurityContext(),a="left"===e?0:1;r.displaySearchPanel(o,!1,null,(function(e){let i=e[0];if(null!=i){var r=i.id;[].push(r);var l=i.sourceid_value.split(":"),c={contextId:s,displayName:i["ds6w:label_value"],displayType:i["ds6w:type"],envId:l.length>1?l[1]:o,objectId:i.id,objectType:i["ds6w:type_value"],serviceId:l[0],preview_url:i.preview_url_value,type_icon_url:i.type_icon_url_value};[].push(c);var d=t.fetchPersistedIDs();d.items[a].objectId=c.objectId,d.items[a].objectServices.objectId=c.objectId,d.items[a].objectServices.objectType=c.objectType,d.items[a].objectServices.contextId=c.contextId,d.items[a].objectServices.displayName=c.displayName,d.items[a].objectServices.serviceId=c.serviceId,t.persistIDs(d);var p=new u(c.objectId,c.objectType,c.contextId,c.envId,c.serviceId);n._plugSvcs.postEvent("Event_replaceCompare",{targetIndex:a,objIDSpecArray:[p]})}}))},getTreePanelCaptions:function(){function e(e,t,i,n){var o=null;if(t){o={label:[{text:t.getAttr("title")}]};let r=t.getAttr("revision");null!=r&&""!==r&&o.label.push({text:r,id:"treePanel-caption-revision-"+n,onClick:function(){e._displayHistoryGraph(n,i)}}),t.hasExternalFilter()&&o.label.push({text:t.getExternalFilterName(),id:"treePanel-caption-filter-"+n,onClick:function(){e._displayFilterPanel(n,i)}}),o.dropDown={id:"treePanel-caption-dropdown-"+n,onClick:function(){e._displayMenu(o.dropDown.item.map((e=>({type:"PushItem",title:e.text,icon:e.icon,state:e.state,action:{callback:e.onClick},tooltip:{title:e.text,shortHelp:e.tooltip}}))),this)}},o.dropDown.item=[],!1!==i._supportsRevisions&&o.dropDown.item.push({text:T.get("revisionCM"),icon:"flow-branch-list",state:!0===i._supportsEffectivityBasedRevisions?"disabled":"enabled",onClick:function(){e._displayHistoryGraph(n,i)},tooltip:T.get(!0===i._supportsEffectivityBasedRevisions?"usesEffectivityBasedRevisionsTip":"revisionOfButtonTip")}),!1!==i._supportsFilters&&o.dropDown.item.push({text:T.get("filterCM"),icon:"filter",onClick:function(){e._displayFilterPanel(n,i)},tooltip:T.get("filterOfButtonTip")}),o.dropDown.item.push({text:T.get("openCM"),icon:"open",onClick:function(){e._displaySearchPanel(n,i)},tooltip:T.get("searchButtonTip")})}return o}var t=[],i=this._crTree.getRoot(1).getMatchInfo();if(i){let n=this._crTree.getRootObjIDSpec(0),o=this._crTree.getRootObjIDSpec(1),r=e(this,i.getBaseNode(),n,"left"),s=e(this,i.getCompNode(),o,"right");r&&s&&(t.push({panelContentId:this.isList()?b:I,panelCaption:r}),t.push({panelContentId:this.isList()?R:y,panelCaption:s}))}return t},_updateTreePanelCaptions:function(){var e=this;this.getTreePanelCaptions(this._addedEvents).forEach((function(t){e._activeTrees.setPanelCaption(t.panelContentId,t.panelCaption)}))},onNavigate:function(e){var t=this._activeTrees.dataGridViews[0].getNodesXSO().get(),i=this._activeMatchPairArray;var n=-2;if("navigateFirst"===e)n=-1,e="navigateNext";else if("navigateLast"===e)n=i.length,e="navigatePrevious";else if(Array.isArray(t)&&t.length){var o=(t=t[t.length-1]).options.data.getMatchInfo();n=i.findIndex((e=>o===e))}if(-2!==n){var r=function(e,t,n){for(var o="navigateNext"===t?1:-1,r=e+o,s=i.length;"navigateNext"===t?r<s:r>=0;r+=o)if(i[r].getBaseNode().__TREENODE__.isVisible())for(let e of i[r].getAllStatusArray(!0))if("IDENTICAL"!==e&&n[e].visibleFlag)return i[r];return null}(n,e,this._flagInfo.getActiveFlagDisplayData());null!=r&&this._activeTrees.withUpdateLocked(function(){this._activeTrees.clearNTHGridSelection(0),r.getBaseNode().__TREENODE__.select(),this._activeTrees.dataGridViews[0].ensureNodeModelVisible(r.getBaseNode().__TREENODE__,!0,1)}.bind(this))}},getActiveExpandMenuId:function(){return this._currentExpandMenuId},isList:function(){return"list"===this._displayMode},getLabel:function(){return v.CompareStructurePanelTitle},getName:function(){return"structures"},onComparePanelUpdated:function(){void 0!==this._contextMenuPlugin&&null!==this._contextMenuPlugin&&this._contextMenuPlugin.onComparePanelUpdated()},onActivate:function(){setTimeout((()=>{this.onResize(),this._syncOverview()}),0)},_setupShowHideNodesByTypeAndAttributeFilterModel:function(){Array.isArray(this._showHideNodeParamsOnTypeAndAttribute)&&this._showHideNodeParamsOnTypeAndAttribute.length?this._aggVisibilityFilterModels.showHideNodeOnTypeAndAttribute={filterId:"set",filterModel:this._showHideNodeParamsOnTypeAndAttribute.reduce(((e,t,i)=>(!0===t.show&&e.push(i),e)),[-1])}:delete this._aggVisibilityFilterModels.showHideNodeOnTypeAndAttribute},_applyShowHideNodesByTypeAndAttributes:function(){this._setupShowHideNodesByTypeAndAttributeFilterModel(),this._activeTrees.applyFilterModelToTrees(this._aggVisibilityFilterModels)},applyCurrentFilterToTrees:function(){this._activeTrees.applyFilterModelToTrees(this._aggVisibilityFilterModels),this._syncOverview()},_setup_allMatchPair_hiddenByTypeAttr:function(e){function t(e,t){return Array.isArray(t.TYPE)&&null!=e&&-1!==t.TYPE.findIndex((t=>e.getAttr("REF.ds6w:type")===t||f.isKindOf(e.getAttr("REF.ds6w:type"),t)))&&(null==t.ATTRIBUTES||null!=t.ATTRIBUTES&&Object.keys(t.ATTRIBUTES).every((i=>t.ATTRIBUTES[i]===e.getAttr(i))))}this._setupShowHideNodesByTypeAndAttributeFilterModel();var i=this._aggVisibilityFilterModels.showHideNodeOnTypeAndAttribute,n=this;e.forEach((function(e){isNaN(e.getShowHideNodeByTypeAndAttrParamIndex())&&(Array.isArray(n._showHideNodeParamsOnTypeAndAttribute)&&n._showHideNodeParamsOnTypeAndAttribute.length?e.setShowHideNodeByTypeAndAttrParamIndex(n._showHideNodeParamsOnTypeAndAttribute.findIndex((i=>{var n=i.CHILD,o=i.PARENT,r=e.getBaseNode();(null==r||r.isDummy())&&(r=e.getCompNode());let s=r.getRefInstNode(),a=null!=s?s.getParent():null,l=t(s,n),u=null!=a&&(!o||null!=o&&t(a,o));return l&&u}))):e.setShowHideNodeByTypeAndAttrParamIndex(-1))})),e.forEach((function(e){var t=e.getShowHideNodeByTypeAndAttrParamIndex(),n=null==i||i.filterModel.indexOf(t)>=0;e.setIsHidden_byTypeAttr(!n)}))},_areAnyMatchPairChildrenVisible:function(e){var t=!1;if("function"==typeof e.getExpandCollapseState&&"expanded"==e.getExpandCollapseState()){var i=e.getChildArray();if(null!=i)for(var n=0;n<i.length;n++){if(0==i[n].getMatchInfo().getIsHidden_byAnyFilter()){t=!0;break}}}return t},clearCurrentlySelectedRowIDs:function(){let e=this._getActiveTree();null!=e&&e.clearCurrentlySelectedRowIDs()}})})),define("DS/CompareWidget2/ViewDefModules/FlexibleViewDefOptions",["DS/CompareWidget2/ViewDefModules/ViewDefOptions","DS/CompareWidget2/ViewDefModules/DSColors","DS/CompareCommon/Utils","i18n!DS/CompareWidget2/assets/nls/FlexibleView"],(function(e,t,i,n){"use strict";var o={DESCRIPTION:"INST.ds6w:description",REVISION:"REF.ds6wg:revision",INST_TITLE:"INST.ds6w:label"},r={QUANT:{NAME:"REF.Quant",ICON:{iconName:"product",fontIconFamily:WUXManagedFontIcons.Font3DS},NLS_RESOLVED:n.Quant},COUNT:{NAME:"REF.Count",ICON:null,NLS_RESOLVED:n.Count}},s={QUANT_STATUS:{COLOR:t.colorDef.GREEN2,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS_RESOLVED:n.QUANT_STATUS},COUNT_STATUS:{COLOR:t.colorDef.GREEN3,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS_RESOLVED:n.COUNT_STATUS}};UWA.extend(e.CV_PROPS,o);var a={SHOW_HIDE_NODE_PARAMS:e.STRUCT_DISPLAY_OPTIONS.SHOW_HIDE_NODE_PARAMS},l={ROLLUP_PROPS:[{SOURCE_NAME:null,DEST_NAME:r.COUNT.NAME}],SHOW_HIDE_NODE_PARAMS:e.STRUCT_DISPLAY_OPTIONS.SHOW_HIDE_NODE_PARAMS},u={ROLLUP_PROPS:[{SOURCE_NAME:o.DESCRIPTION,DEST_NAME:r.QUANT.NAME}],SHOW_HIDE_NODE_PARAMS:e.STRUCT_DISPLAY_OPTIONS.SHOW_HIDE_NODE_PARAMS},c={ADD_STATUSES:[{NAME:"QUANT_STATUS",PROPS:[r.QUANT.NAME],FLAG_ON:"NEQ"}]},d={ADD_STATUSES:[{NAME:"COUNT_STATUS",PROPS:[r.COUNT.NAME],FLAG_ON:"NEQ"}]},p={gridViewAMDPath:"DS/CompareWidget2/plugins/STRUCTURE/flexibleView/ViewPanel/gridView/gridView_tree",colorLeft:e.STRUCT_COLORS.BASELINE,colorRight:e.STRUCT_COLORS.COMPARE,ADDITIONAL_STATUS_FLAGS:s,CUSTOM_PROPS:r,displayMode:{id:"tree-xen",icon:"tree-view-all",title:n.StructureViewTitle,tooltip:i.generateTooltip("CompareWidget2/Tooltips","StructureView"),expandCollapseEnabled:!0,rowSelection:"multiple"},DISPLAY_PROPS:{fixed:[o.INST_TITLE,o.REVISION],scrollable:null}};UWA.extend(p,e.STRUCT_DISPLAY_OPTIONS);var h={gridViewAMDPath:"DS/CompareWidget2/plugins/STRUCTURE/flexibleView/ViewPanel/gridView/gridView_tree",colorLeft:e.STRUCT_COLORS.BASELINE,colorRight:e.STRUCT_COLORS.COMPARE,ADDITIONAL_STATUS_FLAGS:s,CUSTOM_PROPS:r,displayMode:{id:"list-xen",icon:"view-list",title:n.ListViewTitle,tooltip:i.generateTooltip("CompareWidget2/Tooltips","ListView"),expandCollapseEnabled:!1,rowSelection:"single"},DISPLAY_PROPS:{fixed:[o.REVISION,r.COUNT.NAME],scrollable:null}};UWA.extend(h,e.STRUCT_DISPLAY_OPTIONS);var _={gridViewAMDPath:"DS/CompareWidget2/plugins/STRUCTURE/flexibleView/ViewPanel/gridView/gridView_tree",colorLeft:e.STRUCT_COLORS.BASELINE,colorRight:e.STRUCT_COLORS.COMPARE,ADDITIONAL_STATUS_FLAGS:s,CUSTOM_PROPS:r,displayMode:{id:"tree-list-xen",icon:"view-list",title:n.XENDemoListTitle,tooltip:i.generateTooltip("CompareWidget2/Tooltips","ListView"),expandCollapseEnabled:!1,rowSelection:"single"},DISPLAY_PROPS:{fixed:[o.REVISION,r.QUANT.NAME],scrollable:null}};UWA.extend(_,e.STRUCT_DISPLAY_OPTIONS);var g={PROPS:e.CV_PROPS,SYNTHETIC_PROPS:r};return UWA.extend(g,e.STRUCT_DISPLAY_OPTIONS),{STRUCT_DISPLAY_PREP_TREE:p,STRUCT_DISPLAY_PREP_LIST_XEN_DEMO:_,STRUCT_AGG_TREE:a,STRUCT_AGG_LIST:l,STRUCT_AGG_LIST_XEN_DEMO:u,STRUCT_ADD_STATUS_LIST:d,STRUCT_ADD_STATUS_LIST_XEN_DEMO:c,STRUCT_DISPLAY_PREP_LIST:h,STRUCT_FLEX_DISPLAY:g}})),define("DS/CompareWidget2/ViewDefModules/FlexibleViewDefs",["DS/CompareWidget2/ViewDefModules/DefaultViewDefs_V2","DS/CompareWidget2/ViewDefModules/FlexibleViewDefOptions"],(function(e,t){var i={structAgg_TREE:{Path:"DS/CompareWidget2/plugins/STRUCTURE/flexibleView/STRUCT_AGG_TREE_plugin",Options:t.STRUCT_AGG_TREE},structAgg_LIST:{Path:"DS/CompareWidget2/plugins/STRUCTURE/flexibleView/STRUCT_AGG_LIST_plugin",Options:t.STRUCT_AGG_LIST},structAgg_LIST_XEN_DEMO:{Path:"DS/CompareWidget2/plugins/STRUCTURE/flexibleView/STRUCT_AGG_LIST_plugin",Options:t.STRUCT_AGG_LIST_XEN_DEMO},StructCompare_TREE:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_COMPARE_plugin",Options:e.STRUCT_COMPARE_OPTIONS},StructCompare_LIST:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_COMPARE_plugin",Options:e.STRUCT_COMPARE_OPTIONS},StructCompare_LIST_XEN_DEMO:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_COMPARE_plugin",Options:e.STRUCT_COMPARE_OPTIONS},structAddStatus_TREE:{Path:"DS/CompareWidget2/plugins/STRUCTURE/flexibleView/STRUCT_ADD_STATUS_plugin"},structAddStatus_LIST:{Path:"DS/CompareWidget2/plugins/STRUCTURE/flexibleView/STRUCT_ADD_STATUS_plugin",Options:t.STRUCT_ADD_STATUS_LIST},structAddStatus_List_XEN_DEMO:{Path:"DS/CompareWidget2/plugins/STRUCTURE/flexibleView/STRUCT_ADD_STATUS_plugin",Options:t.STRUCT_ADD_STATUS_LIST_XEN_DEMO},structDisplayPrep_TREE:{Path:"DS/CompareWidget2/plugins/STRUCTURE/flexibleView/STRUCT_DISPLAY_PREP_plugin",Options:t.STRUCT_DISPLAY_PREP_TREE},structDisplayPrep_LIST:{Path:"DS/CompareWidget2/plugins/STRUCTURE/flexibleView/STRUCT_DISPLAY_PREP_plugin",Options:t.STRUCT_DISPLAY_PREP_LIST},structDisplayPrep_LIST_XEN_DEMO:{Path:"DS/CompareWidget2/plugins/STRUCTURE/flexibleView/STRUCT_DISPLAY_PREP_plugin",Options:t.STRUCT_DISPLAY_PREP_LIST_XEN_DEMO},structFlexDisplay:{Path:"DS/CompareWidget2/plugins/STRUCTURE/flexibleView/STRUCT_FLEXIBLE_VIEW_plugin",Options:t.STRUCT_FLEX_DISPLAY},ExporterMulti:{Path:"DS/CompareWidget2/plugins/EXPORT/EXPORT_plugin",Options:t.STRUCT_FLEX_DISPLAY}};UWA.extend(e.PLUGDEFS,i);UWA.extend(e.VIEWDEFS,{STRUCT_VIEW_TREE:["StructFetch","structAgg_TREE","StructCompare_TREE","structAddStatus_TREE","structDisplayPrep_TREE","structFlexDisplay"],STRUCT_VIEW_LIST:["StructFetch","structAgg_LIST","StructCompare_LIST","structAddStatus_LIST","structDisplayPrep_LIST","structFlexDisplay"],STRUCT_VIEW_XEN_DEMO:["StructFetch","structAgg_LIST_XEN_DEMO","StructCompare_LIST_XEN_DEMO","structAddStatus_List_XEN_DEMO","structDisplayPrep_LIST_XEN_DEMO","structFlexDisplay","ExporterMulti"]});return UWA.extend(e.VIEWSETS,{XEN_VIEWSET:{ROW:[{COL:["STRUCT_VIEW_TREE","STRUCT_VIEW_LIST","STRUCT_VIEW_XEN_DEMO"]},{COL:["PROP_VIEW","INSTANCE_VIEW"]}]},XSR_VIEWSET:{ROW:[{COL:["PROP_VIEW","INSTANCE_VIEW"]},{COL:["STRUCT_VIEW_TREE","STRUCT_VIEW_LIST","STRUCT_VIEW_XEN_DEMO"]}]}}),e})),define("DS/CompareWidget2/Customization/DictionaryServices",["DS/CompareWidget2/support/DataCenter","DS/CompareWidget2/support/cw2Utils","DS/CompareCommon/Utils"],(function(e,t,i){let n=null,o=async(i,n)=>Promise.allSettled(i.map((i=>null!=i._TypesInfo?Promise.resolve(i):new Promise((function(o,r){i._TypesInfo={};let s={"ds6w:type":i.SelectedTypes.concat(i.Interfaces,Object.keys(i._CustomTypesInfo),Object.keys(i._CustomInterfacesInfo))};e.makeAuthHttpsCall("/resources/6WVocab/access/PredicateValue","POST",s,"json",n.tenant,"3DSpace",n.securityContext,!0).then((function(e){for(const[t,n]of Object.entries(e["ds6w:type"]))i._TypesInfo[t]={displayName:n,icon:void 0,attributes:null};o()}),(function(e){t.dbgout("CompareCustomization: Failed to retrieve object type display names: "+e),r()}))}))))).then((()=>i)),r=async(i,n)=>Promise.allSettled(i.map((i=>new Promise((function(o,r){let s=[];function a(e){return"VPM"===e.substr(0,3)&&"Instance"===e.substr(e.length-8)?"flow-cascade":"VPM"===e.substr(0,3)&&"Reference"===e.substr(e.length-9)?"product":""}for(var l of i.Facets)["ObjectTypes","Interfaces"].forEach((e=>{if(l[e])for(var t of l[e])l.Icon?i._TypesInfo[t].icon=l.Icon:i._TypesInfo[t].icon=a(t),void 0!==i._TypesInfo[t].icon&&null!==i._TypesInfo[t].icon&&""!==i._TypesInfo[t].icon||s.push(t)}));(s.length>0?e.makeAuthHttpsCall("/resources/dictionary/getTypeInfo","POST",s,"json",n.tenant,"3DSpace",n.securityContext,!0,!1):Promise.resolve()).then((function(e){t.dbgout("CompareCustomization._getObjTypesIcon: OK retrieving object type icon information: ");for(const[e,t]of Object.entries(i._TypesInfo))void 0===t.icon&&(void 0!==i._CustomTypesInfo[e]?t.icon=i._TypesInfo[i._CustomTypesInfo[e].parentType].icon:void 0!==i._CustomInterfacesInfo[e]&&(t.icon=i._TypesInfo[i._CustomInterfacesInfo[e].parentType].icon));o()}),(function(e){t.dbgout("CompareCustomization._getObjTypesIcon: KO retrieving object type icon information: "),o()}))}))))).then((()=>i)),s=(e,n)=>Promise.allSettled(e.map((e=>new Promise((function(o,r){let s=[];Object.keys(e._TypesInfo).forEach((t=>{null==e._TypesInfo[t].attributes&&s.push("ds6wg:"+t)})),0===s.length?o():i.getPropertiesForClassPromise(s,n.tenant).then((function(i){"string"==typeof i&&JSON.parse(i);for(var n of i){let i=n.classInfo.curi.indexOf(":"),o=-1==i?n.classInfo.curi:n.classInfo.curi.slice(i+1);if(e._TypesInfo[o]=e._TypesInfo[o]||{attributes:[]},null==e._TypesInfo[o].attributes)for(var r of(e._TypesInfo[o].attributes=[],n.properties))""===r.label?t.dbgout("CompareCustomization: FedDictionaryAccessAPI.getPropertiesForClass() didn't return display name: "+r.curi):e._TypesInfo[o].attributes.push({name:r.originCuri,uri:r.curi,nlsName:r.label})}e._attrInfoLoaded=!0,o()}),(function(){t.dbgout("CompareCustomization: KO retrieving object type attributes: "),r()}))}))))).then((()=>e));return{getAllTypesAndInterfacesInfos:async function(i,a){return i=await(async(i,o)=>(n?Promise.resolve(n):e.makeAuthHttpsCall("/resources/dictionary/DictionaryCUSTO","GET","","json",o.tenant,"3DSpace",o.securityContext,!0,!1)).then((function(e){return n!==e&&e&&e.Dictionary&&(n=e.Dictionary),t.dbgout("CompareCustomization._getCustomTypesAndInterfaces: OK retrieving dictionary custom information: "),i.forEach((e=>{if(!e._CustomTypesInfo||!e._CustomTypesInfo){e._CustomTypesInfo={},e._CustomInterfacesInfo={},["Types","Relationships"].forEach((t=>{for(const[i,o]of Object.entries(n[t]))e.SelectedTypes.includes(o.FirstOOTB)&&(e._CustomTypesInfo[i]={parentType:o.Parent,attributes:o.Attributes})}));let t=e.SelectedTypes.concat(Object.keys(e._CustomTypesInfo));for(const[i,o]of Object.entries(n.Interfaces)){let n=null,r=null;for(const e of["ScopeTypes","ScopeRelationships"])if(Array.isArray(o[e])&&o[e].length){r=o[e];break}(r||[]).some((e=>(n=t.indexOf(e),-1!==n)))&&(e._CustomInterfacesInfo[i]={parentType:t[n],attributes:o.Attributes})}}})),i}),(function(e){return t.dbgout("CompareCustomization._getCustomTypesAndInterfaces: KO retrieving dictionary custom information: "),i})))(i,a),i=await o(i,a),i=await r(i,a),s(i,a),i},getTypesAndInterfacesInfos:async function(e,t,i){return e=await o(e,t),e=await r(e,t),i&&(e=await s(e,t)),e},getFacetAttrs:async function(e,t){return await s(e,t)}}})),define("DS/CompareWidget2/support/EventManager",["DS/CoreEvents/ModelEvents","DS/CompareWidget2/support/cw2Utils"],(function(e,t){return e.extend({init:function(e){var t=e||{};this._parent(t)},publish:function(e){var i=e.isAsync,n=e.catchExceptions,o=this,r=o._parent;try{1==i?setTimeout((function(){r.call(o,e)}),0):r.call(o,e)}catch(i){if(t.warnout("EXCEPTION publishing event '"+e.event+"' : "+i.stack),1!=n)throw i}}})})),define("DS/CompareWidget2/widget/inputFrame",["UWA/Controls/Abstract","DS/CompareCommon/Input/CompareInput","DS/CompareWidget2/support/objIDSpec"],(function(e,t,i){return e.extend({init:function(e,i,n){this._parent({}),this._eventMgr=e,this.elements.container=UWA.createElement("div",{id:"initial-drop",styles:{height:"100%"}}),this.compareInput=new t(i,n);var o=this;this._eventTokens=[],this._eventTokens.push(this._eventMgr.subscribe({event:"Event_controlCustomizationDone"},this._handler_controlCenterDone.bind(this))),setTimeout((function(){o.compareInput.doInput(o.elements.container,i,o.onInputsReady.bind(o),o.onShowControlCenter.bind(o))}))},onShowControlCenter:function(){this._eventMgr.publish({event:"Event_showControlCenter"})},_handler_controlCenterDone:function(e){!0===e.status&&this.compareInput.updateComparisonProfileDropdownUI()},onInputsReady:function(e){let t=[];for(let s of e.idDataList.items){var n=s.objectServices,o=null;void 0!==s.filterData&&null!==s.filterData?o=s.filterData:void 0!==s.queryDef&&null!==s.queryDef&&(o=s.queryDef);var r=new i(n.objectId,n.objectType,n.contextId,n.envId,n.serviceId,o,n.idType,n.commands,s.supportsRevisions,s.supportsFilters,e&&e.validateObj_stateData&&e.validateObj_stateData[n.objectId]&&e.validateObj_stateData[n.objectId].interfaces,s.supportsEffectivityBasedRevisions);t.push(r)}this._eventMgr.publish({event:"Event_inputUpdate",data:t})},clearPersistedInputs:function(){this.compareInput.clearItem("all")},applyNGFilter:function(e,t){this.compareInput.onApplyNGFilter(e,t)}})})),define("DS/CompareWidget2/plugins/STRUCTURE/STRUCT_DISPLAY_plugin",["DS/CompareWidget2/plugins/displayPlugin","DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structComparePanel"],(function(e,t){"use strict";function i(e){var t=e.data.nodePathArray;this._outputPanel._viewerDisplayModeIsolate||this._outputPanel.getExternalController().setSelectedNodes(t)}function n(e){if(!this._outputPanel._viewerDisplayModeIsolate){var t=this._outputPanel.getExternalController();t&&t.clearSelectedNodes(),this._plugSvcs.postEvent("NO_CURRENT_SELECTION_EVENT",{})}}function o(e){this._plugSvcs.dbgout("Struct Plugin handling compare panel updated"),this._outputPanel.onComparePanelUpdated()}return e.extend({init:function(e,t,i,n){this._parent(e,t,i,n)},onEnabled:function(){var e=this;return e.subscribeEvent("STRUCT_UPDATE_IN_PROGRESS_EVENT",e.onUpdateInProgress.bind(e)),e.subscribeEvent("3DVIEW_NODES_SELECTED_EVENT",i.bind(this)),e.subscribeEvent("3DVIEW_ALL_NODES_UNSELECTED_EVENT",n.bind(this)),e.subscribeEvent("COMPARE_PANEL_UPDATED_EVENT",o.bind(this)),e.syncSetting("viewSettings.PAD3D_VIEW.view3D.isolate","_viewerDisplayModeIsolate",e._outputPanel.onTreesSelectRow.bind(e._outputPanel),e._outputPanel),e.syncSetting("viewSettings.STRUCT_VIEW.statuses_to_hide","_statusesHidden",null,e._outputPanel),e.syncSetting("viewSettings.STRUCT_VIEW.display_mode","_displayMode",null,e._outputPanel),e.syncSetting("viewSettings.STRUCT_VIEW.multi_statuses_to_hide_and","_multiStatusesToHideAnd",null,e._outputPanel),this._pluginOptions&&this._pluginOptions.SHOW_HIDE_NODE_PARAMS&&this._pluginOptions.SHOW_HIDE_NODE_PARAMS.forEach((t=>{t.hasOwnProperty("SHOW")&&"string"==typeof t.SHOW?e.syncSetting(t.SHOW,"show",e._outputPanel._applyShowHideNodesByTypeAndAttributes.bind(e._outputPanel),t,t.NAME):t.hasOwnProperty("SHOW")&&"boolean"==typeof t.SHOW?t.show=t.SHOW:t.show=!0})),e._parent()},createViewPanelObject:function(e,i){var n={};return i.CUSTOM_PROFILE_IN_USE&&(n=i.PROPS),new t(e,this._plugSvcs,i,n)},execute:function(e,t){var i=this;i._parent(e,t);var n=e.crTreeArray;i._outputPanel.updateResults(t,n[0]).then((function(e){i.showNotBusy(),i.reportOK(n)}),(function(e){i.reportKO(e)}))}})})),define("DS/CompareWidget2/Customization/CompareCustomizationManager",["UWA/Core","DS/CompareWidget2/Customization/Profile","DS/CompareWidget2/support/DataCenter","DS/LifecycleServices/LifecycleServicesSettings","DS/LifecycleServices/LifecycleServices","DS/CompareCommon/Utils","DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/Customization/viewConfigMangler","DS/CompareWidget2/Customization/DictionaryServices","i18n!DS/CompareWidget2/assets/nls/DisplayMessages"],(function(e,t,i,n,o,r,s,a,l,u){"use strict";const c="__|DEFAULT|__",d=(e,t,i)=>`${e}_${i}_${t}`,p=(e,t)=>d("profiles",e,t),h=(e,t)=>d("preferred",e,t);function _(e,t){var i=e.findIndex((e=>e.Name===t));return-1===i&&(i=e.findIndex((e=>e.NameNLS===t))),i}function g(){var e={userName:"",isAdminUser:!1,securityContext:"",tenant:widget.getValue("x3dPlatformId"),companyId:"",customTypeSupport:!1};return new Promise((function(t,i){o.getSecurityContextPromise(e.tenant,e.securityContext).then((function(i){e.securityContext=i,e.companyId=i.split(".")[1],r.checkIsAdminUserPromise().then((function(i){e.userName=i.id,e.isAdminUser=i.isAdminUser,t(e)}),(function(i){console.error("Failed to get Admin/User info: "+i+"... continuing..."),t(e)}))}),(function(i){console.error("Failed to get security context: "+i+"... continuing..."),t(e)}))}))}function f(e,n,o,r){var s=[];return i.loadPageObject(p(e,r),n,o).then((e=>{if(1==e.success){let r=e.settings.content;if(null!==r)for(var i=0;i<r.length;i++){var n=r[i],o=new t(n);s.push(o)}}return s}),(e=>s))}function S(e,t){var n=h(e.userName,e.companyId);return i.savePageObject(n,t,e.tenant,e.securityContext)}function m(e,t,n){var o=p(t,e.companyId);return i.savePageObject(o,n,e.tenant,e.securityContext)}var C=function(){this._modelerTemplates=null,this._adminProfiles=[],this._userProfiles=[],this._userPreferred={},this._runContext={},this._profileFacetNLSMap={}};return C.prototype.init=function(e,t){var i=this;return this.loadCustomizations(t).then((()=>!e&&i.loadFacetNamesNLS()||Promise.resolve()))},C.prototype.areCustomTypesSupported=function(){return true},C.prototype.loadCustomizations=function(e){var t=this;return t.profilesLoadCompleted=!1,g().then((n=>(t._runContext=n,t._runContext.customTypeSupport=t.areCustomTypesSupported(),null!=t._modelerTemplates&&!0!==e?Promise.resolve(t._modelerTemplates):function(e,t,n){var o=[];return i.makeAuthHttpsCall("/resources/compare2/compareModelerProfiles","GET",null,"json",e.tenant,"3DSpace",e.securityContext,!0).then((e=>(e.results.forEach((function(e){for(var i of e.data.templates)i.Type="template",i.NameNLS=i.Name,void 0!==i.NLSPath&&null!==i.NLSPath&&""!==i.NLSPath?require([i.NLSPath],(function(e){for(var n of(i.NameNLS=e.get(i.Name),void 0!==t[i.NLSPath]&&null!==t[i.NLSPath]||(t[i.NLSPath]={facet:{}}),i.Facets))t[i.NLSPath].facet[n.Name]=e.get(n.Name)}),(function(e){s.dbgout("COMPARE CUSTOMIZATION - Localization name missing for profile "+i.Name)})):s.dbgout("COMPARE CUSTOMIZATION - Localization path missing for profile "+i.Name),null!=i.Facets&&(i.SelectedTypes=i.Facets.reduce(((e,t)=>e.concat(t.ObjectTypes)),[]),i.Interfaces=i.Facets.reduce(((e,t)=>e.concat(Array.isArray(t.Interfaces)?t.Interfaces:[])),[])),o.push(i)})),Promise.resolve(o))),(e=>Promise.resolve(o))).then((t=>e.customTypeSupport&&!0===n?l.getAllTypesAndInterfacesInfos(t,e):Promise.resolve(t)))}(t._runContext,t._profileFacetNLSMap,e)))).then((e=>{return t._modelerTemplates=e,f("admin",(i=t._runContext).tenant,i.securityContext,i.companyId);var i})).then((e=>{return t._adminProfiles=e,f((i=t._runContext).userName,i.tenant,i.securityContext,i.companyId);var i})).then((e=>(t._userProfiles=e,function(e){var t={};return i.loadPageObject(h(e.userName,e.companyId),e.tenant,e.securityContext).then((e=>(1==e.success&&(t=e.settings.content),t)),(e=>t))}(t._runContext)))).then((e=>(t._userPreferred=e,t.profilesLoadCompleted=!0,t.profilesLoadCompleted)))},C.prototype.loadModelerTemplateInfo=function(e,t){var i=this;return g().then((n=>(i._runContext=n,i._runContext.customTypeSupport=i.areCustomTypesSupported(),null!=e?function(e,t,i){return t.customTypeSupport?l.getTypesAndInterfacesInfos(e,t,i):Promise.resolve([])}(Array.isArray(e)?e:[e],i._runContext,t):Promise.resolve())))},C.prototype.saveCustomizations=function(){let e={status:!0};var t,i,n=[];this._runContext.isAdminUser&&n.push((t=this._runContext,i=this._adminProfiles,m(t,"admin",i))),n.push(function(e,t){return m(e,e.userName,t)}(this._runContext,this._userProfiles)),n.push(S(this._runContext,this._userPreferred));var o=n.length;return Promise.allSettled(n).then((t=>{for(var i=0,n=t.length;i<n;i++){let n=3===o?i:i+1;"rejected"===t[i].status?(e.status=!1,0===n?s.dbgout("COMPARE CUSTOMIZATION - Save Admin Profiles FAILED"):1===n?s.dbgout("COMPARE CUSTOMIZATION - Save User Profiles FAILED"):2===n&&s.dbgout("COMPARE CUSTOMIZATION - Save preferred profile FAILED")):0===n?s.dbgout("COMPARE CUSTOMIZATION - Save Admin Profiles successful"):1===n?s.dbgout("COMPARE CUSTOMIZATION - Save User Profiles successful"):2===n&&s.dbgout("COMPARE CUSTOMIZATION - Save preferred profile successful")}})),e},C.prototype.isTemplateProfile=function(e){return null!=e&&"template"===e.Type},C.prototype.isCustomizationProfile=function(e){return null!=e&&"customization"===e.Type},C.prototype.getTenant=function(){return void 0!==this._runContext&&null!==this._runContext?this._runContext.tenant:"onPremise"},C.prototype.getSecurityContext=function(){return void 0!==this._runContext&&null!==this._runContext?this._runContext.securityContext:null},C.prototype.getUserName=function(){return void 0!==this._runContext&&null!==this._runContext?this._runContext.userName:null},C.prototype.getIsAdminUser=function(){return void 0!==this._runContext&&null!==this._runContext?this._runContext.isAdminUser:null},C.prototype._validateUsageByRole=function(e){let t=!0,i=this;if(!this.getIsAdminUser())if(void 0!==e.Roles&&null!==e.Roles){let o=Array.isArray(e.Roles)?e.Roles:[e.Roles];n.hasRole((function(n){!0===n?(t=!0,s.dbgout("User "+i._runContext.userName+" has role privileges for profile "+e.Name)):(t=!1,s.dbgout("User "+i._runContext.userName+" does not have role privileges for profile "+e.Name))}),o)}else s.dbgout("User "+i._runContext.userName+" does not need role privileges for profile "+e.Name);return t},C.prototype._getNames=function(e,t){var i=this;return new Promise((function(n,o){var r=[],s=[];for(var a of e)i._validateUsageByRole(a)&&(null==t?r.push(null!=a.NameNLS?a.NameNLS:a.Name):a.fromTemplateProfile&&s.push(i.getProfile(a.fromTemplateProfile)));s.length>0?i.loadModelerTemplateInfo(s,!1).then((function(){for(var o of e)if(i._validateUsageByRole(o)){var s=!1;let e=o.fromTemplateProfile?i.getProfile(o.fromTemplateProfile):null;o.SelectedTypes.concat(e&&e._TypesInfo?Object.keys(e._TypesInfo):[]).some((function(e){if(t==e)return s=!0,!0})),s&&r.push(null!=o.NameNLS?o.NameNLS:o.Name)}n(r)})):n(r)}))},C.prototype.getProfileNames=function(e){let t=this;return new Promise((function(i,n){let o=null;if(null!=e.objTypes){for(var r=0;r<e.objTypes.length-1;++r)if(e.objTypes[r]!==e.objTypes[r+1])return s.dbgout("LOOKING for profile names that address type '"+e.objTypes[r]+"' and '"+e.objTypes[r+1]+"'. Not supported."),ret;o=e.objTypes[0],s.dbgout("LOOKING for profile names that address type '"+o+"'")}else null!=e.objType?(o=e.objType,s.dbgout("LOOKING for profile names that address type '"+o+"'")):s.dbgout("LOOKING for ALL profile names");if("function"==typeof e.callBackAfterProfilesUpdated)if(t.profilesLoadCompleted)t.fnAfterProfilesRetrieved(e,o).then((t=>{e.callBackAfterProfilesUpdated(t)}));else{let i=setInterval((()=>{t.profilesLoadCompleted&&(clearInterval(i),t.fnAfterProfilesRetrieved(e,o).then((t=>{e.callBackAfterProfilesUpdated(t)})))}),200)}else t.fnAfterProfilesRetrieved(e,o).then((e=>{i(e)}))}))},C.prototype.fnAfterProfilesRetrieved=function(e,t){let i=this;return new Promise((function(n,o){let r=null!=e&&!0===e.asTree?null:[];var s=[];null!=e&&1==e.getTemplates&&s.push(i._getNames(i._modelerTemplates,t)),s.push(i._getNames(i._adminProfiles,t)),s.push(i._getNames(i._userProfiles,t));let a=[],l=[],u=[];Promise.allSettled(s).then((t=>{if(null!=e&&1==e.getTemplates?(a=t[0],l=t[1],u=t[2]):(l=t[0],u=t[1]),null!=e&&!0===e.asTree)r={},"fulfilled"===a.status&&(r.templates=a.value),"fulfilled"===l.status&&(r.adminProfiles=l.value),"fulfilled"===u.status&&(r.userProfiles=u.value);else{r=[].concat("fulfilled"===a.status?a.value:[],"fulfilled"===l.status?l.value:[],"fulfilled"===u.status?u.value:[])}n(r)}))}))},C.prototype.getUserPreferredProfileName=function(e){e.getRoles();var t=(e.getTypeArray()||[])[0];return"COMPARE"===e.app?this._userPreferred[t]:null},C.prototype.setUserPreferredProfileName=function(e,t){let i="function"==typeof e.stringify?e.stringify():e;this.isDefaultProfile(t)&&(delete this._userPreferred[i],t=c),this._userPreferred[i]=t,S(this._runContext,this._userPreferred)},C.prototype.doesUseCaseTemplateProfileExist=function(e){e.getRoles();var t=(e.getTypeArray()||[])[0];return this._modelerTemplates.some((e=>e.SelectedTypes.concat(e._CustomTypesInfo?Object.keys(e._CustomTypesInfo):[]).includes(t)))},C.prototype.profileExists=function(e){return-1!=_(this._modelerTemplates,e)||-1!=_(this._adminProfiles,e)||-1!=_(this._userProfiles,e)},C.prototype.getProfileCount=function(e){let t=this._adminProfiles.length+this._userProfiles.length;return null!=e&&1==e.getTemplates&&(t+=this._modelerTemplates.length),t},C.prototype.getOnlyProfileName=function(){return 1===this.getProfileCount({getTemplates:!0})?this._modelerTemplates[0].NameNLS:null},C.prototype.isDefaultProfile=function(e){return!this.profileExists(e)},C.prototype.getProfile=function(e){let t=null;if(null!=e&&""!==e){var i=_(this._modelerTemplates,e);if(-1!=i)t=this._modelerTemplates[i];else{var n=_(this._adminProfiles,e);if(-1!=n)t=this._adminProfiles[n];else{var o=_(this._userProfiles,e);-1!=o&&(t=this._userProfiles[o])}}}return t},C.prototype.duplicateProfile=function(e,i){let n=this.getProfile(e),o=new t(n,i,this._runContext.userName,this._runContext.isAdminUser,this._runContext.companyId);return this._runContext.isAdminUser?this._adminProfiles.push(o):this._userProfiles.push(o),o},C.prototype.removeProfile=function(e){let t=_(this._userProfiles,e),i=!1;if(-1!==t)this._userProfiles.splice(t,1),i=!0;else if(this._runContext.isAdminUser){let t=_(this._adminProfiles,e);-1!==t&&(this._adminProfiles.splice(t,1),i=!0)}if(i){let t="";for(const[i,n]of Object.entries(this._userPreferred))if(n===e){t=i;break}""!==t&&this.setUserPreferredProfileName(t,c)}},C.prototype.applyCustomProfileToViewConfig=async function(t,i){let n=this;try{var o=this.getProfile(t);if(null!=o){["MatchingRules","AdditionalStatuses"].reduce(((e,t)=>e.concat((o[t]||[]).reduce(((e,t)=>e.concat(t.attributes.map((e=>({uri:e.name,objType:e.objType}))))),[]))),[]);let r=n.getProfile(o.fromTemplateProfile);["_CustomTypesInfo","_CustomInterfacesInfo"].reduce(((t,i)=>e.extend(t,r[i]||{})),{});return n.loadCustomizations(!0).then((()=>(i=a.applyCustomProfileToViewConfig(e.merge({},o),i),s.dbgout("VIEWSETMRG-----\x3e>>>>   viewSetMgr is using CUSTOM PROFILE '"+t+"'"),i)))}s.errout("Cannot retrieve custom profile '"+t+"', using default configuration"),r.showAlertBox("CUSTOMIZATION_FAILED",u,"error")}catch(e){s.errout("Failed to apply profile customizations; using default configuration"),r.showAlertBox("CUSTOMIZATION_FAILED",u,"error")}},C.prototype.loadFacetNamesNLS=function(){return Promise.allSettled([])},C.prototype.getFacetNameNLS=function(e,t){let i=t;if(null!=e&&""!==e&&void 0!==this._profileFacetNLSMap[e]&&null!==this._profileFacetNLSMap[e]){let n=this._profileFacetNLSMap[e].facet;null!=n&&void 0!==n[t]&&null!==n[t]&&""!==n[t]&&(i=n[t])}return i},C.prototype.getTemplateAttributes=async function(e){return l.getFacetAttrs([e],this._runContext)},C})),define("DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structComparePanelWithPGP",["DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structComparePanel","i18n!DS/CompareWidget2/assets/nls/CompareV2"],(function(e,t){const i="pgp_show";function n(e,t){let n,o=!0,r=!0,s=!0,a=e.getRefInstNode();if(!a)return;let l=e.getChildArray();if(Array.isArray(l)&&l.length){for(let e=0;e<l.length;e++){let t=l[e].__TREENODE__;if(t.options.grid.hasOwnProperty(i)){let e=t.getAttributeValue(i);r=r&&!0===e,s=s&&!1===e}}s&&!r?(o=!1,n="FALSE"):r&&!s?(o=!0,n=void 0):(o=void 0,n=void 0)}!0===t&&"FALSE"===n&&(o=void 0,n=void 0),a.isRoot()&&a.getAttr("REF.pgp_show")!==n?a.setAttr(`REF.${i}`,n):a.getAttr("INST.pgp_show")!==n&&a.setAttr(`INST.${i}`,n),e.__TREENODE__.options.grid[`${i}`]!==o&&e.__TREENODE__.updateOptions({grid:{[`${i}`]:o}})}function o(e){if(!e)return;n(e),o(e.getParent())}return class extends e{constructor(e,t,i,n){super(e,t,i,n)}getTreeCols(e,t,i){let n=this,o=[];if(o=super.getTreeCols(e,t,i),"tree"===e.displayView){let e=n.getPGPHideSHowColumn();o.push(e)}return o}getPGPHideSHowColumn(){return{dataIndex:i,typeRepresentation:"customBoolean",width:30,minWidth:30,sortableFlag:!1,resizableFlag:!1,pinned:"right",semantics:{possibleValues:[{value:!0,icon:"eye"},{value:!1,icon:"eye-off"},{value:void 0,icon:"eye-partial"}]},editableFlag:!0,editionPolicy:"EditionOnOver",getCellTooltip:function(e){const n=e?.nodeModel?.options?.grid[i];let o=e?.nodeModel?.options?.data?.getRefInstNode();return{getAllInformationCB:()=>({model:{shortHelp:o?!1!==n?t.get("shownIn3DTooltip"):t.get("hiddenIn3DTooltip"):""}})}}}}createTreeNodeConfig(e){let t=super.createTreeNodeConfig(e),n=e.getRefInstNode();if("tree"===this._displayMode){let o=!0===this._includePGPHideShow&&!0===this._useIndex;if(n&&e.getAttr("type")&&(t.grid[i]=!0,o&&"FALSE"===e.getAttr((e.isRoot()?"REF":"INST")+".pgp_show"))){t.grid[i]=!1;let n=null!=e.__TREENODE__,o=!e.isRoot();for(;o;){let t=(e=e.getParent()).__TREENODE__,r=t.hasChildren()?t.getChildren().filter((e=>e.options.grid.hasOwnProperty(i))):[],s=e.hasChildren()?e.getChildren().filter((e=>null!=e.getRefInstNode())):[],a=r.length===s.length-1,l=!r.length&&1===s.length,u=r.length===s.length,c=r.every((e=>!1===e.getAttributeValue(i)));!1!==t.getAttributeValue(i)&&(!n&&l||!n&&a&&c||n&&u&&c)?(t.setAttribute(i,!1),o=o&&!e.isRoot()):!0===t.getAttributeValue(i)?(t.setAttribute(i,void 0),o=o&&!e.isRoot()):o=!1}}}return t}onTreesReady(e){let t=this;super.onTreesReady(e),"tree"===t._displayMode&&t._activeTrees.dataGridViews.forEach((e=>{e.layout.setColumnOrGroupProperties(i,{visibleFlag:!t._viewerDisplayModeIsolate}),e.onNodeModelUpdateEvent||(e.onNodeModelUpdateEvent=e.getTreeDocument().onNodeModelUpdate((function(n){let o=n.data.attributes[i];n.data.attributes.hasOwnProperty(i)&&void 0!==o&&t.applyObjectVisibility(e,n)})))}))}applyObjectVisibility(e,t){let r=t.data.attributes[i],s=t.data.nodeModel.options.data,a=s.getRefInstNode(),l=s.getParent();a&&!1===r?a.isRoot()?a.get_dbObj_REF().setAttr(i,"FALSE"):a.get_dbObj_INST()&&a.get_dbObj_INST().setAttr(i,"FALSE"):a&&!0===r&&n(s,!0),o(l),this.onTreesSelectRow()}}})),define("DS/CompareWidget2/plugins/STRUCTURE/STRUCT_DISPLAY_PGP_plugin",["DS/CompareWidget2/plugins/STRUCTURE/STRUCT_DISPLAY_plugin","DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structComparePanelWithPGP"],(function(e,t){return class extends e{constructor(e,t,i,n){super(e,t,i,n)}onEnabled(){var e=this;e.syncSetting("inlcudePGPHideShowSettings.includePGPHideShow","_includePGPHideShow",null,e._outputPanel),e.syncSetting("compareSettings.dataSource.useIndex","_useIndex",null,e._outputPanel),super.onEnabled()}createViewPanelObject(e,i){var n={};return i.CUSTOM_PROFILE_IN_USE&&(n=i.PROPS),new t(e,this._plugSvcs,i,n)}}})),define("DS/CompareWidget2/widget/mainFrame",["UWA/Controls/Abstract","DS/CompareWidget2/widget/inputFrame","DS/CompareWidget2/widget/resultFrame","DS/CompareWidget2/widget/compareCustomizationFrame","DS/UIKIT/Mask","css!DS/CompareWidget2/CompareWidget2.css"],(function(e,t,i,n,o){return e.extend({init:function(e,t,i){this._parent({}),this._eventMgr=e,this.elements.container=UWA.createElement("div",{id:"main-frame",styles:{height:"100%",width:"100%",position:"absolute","z-index":1}}),this._ccm=i,this._frameSet=[],this._eventTokens=[],this._lastFrameIndex=-1,this._currFrameIndex=-1,this._buildSkeleton(this._eventMgr,t,i)},_buildSkeleton:function(e,o,r){let s=null!=o.objIDSpecArray&&o.objIDSpecArray.length>2;this._frameSet[0]=s?null:this._buildViewFrame(t,e,o,r),this._frameSet[1]=this._buildViewFrame(i,e,o,r),this._frameSet[2]=s?null:this._buildViewFrame(n,e,o,r),this._showFrame(s?i:0),this._eventTokens.push(this._eventMgr.subscribe({event:"Event_resetToDropFrame"},this._handler_resetToInputframe.bind(this))),this._eventTokens.push(this._eventMgr.subscribe({event:"Event_showControlCenter"},this._handler_showControlCenter.bind(this))),this._eventTokens.push(this._eventMgr.subscribe({event:"Event_controlCustomizationDone"},this._handler_controlCenterDone.bind(this)))},destroy(){this._destroyAllFrames(),this._stopAllListening()},_destroyAllFrames:function(){for(var e=0;e<this._frameSet.length;e++){var t=this._frameSet[e].destroy;null!=t&&"function"==typeof t&&t()}this._frameSet=null},_stopAllListening:function(){for(var e=0;e<this._eventTokens.length;e++)this._eventMgr.unsubscribe(this._eventTokens[e]),this._eventTokens[e]=null;this._eventTokens=null},_buildViewFrame:function(e,t,i,n){var o=new e(t,i,n);return o.inject(this.elements.container),o},_showFrame:function(e,t){this._lastFrameIndex=this._currFrameIndex,this._currFrameIndex=e;for(var i=0;i<this._frameSet.length;i++)i==e?this._frameSet[i].show(t):this._frameSet[i]&&this._frameSet[i].hide();o.unmask(this.elements.container)},_handler_resetToInputframe:function(){this.showInputFrame(!0)},_handler_showControlCenter:function(e){this.showControlCenterFrame(e)},_handler_controlCenterDone:function(e){if(this._showFrame(this._lastFrameIndex),!0===e.status){let e=this.getResultFrame();null!=e&&e.onProfileManagerDone()}},resetResultFrame:function(){let e=this._frameSet[1]._runOptions,t=this._frameSet[1]._CCM;this._frameSet[1].destroy(),this._frameSet[1]=this._buildViewFrame(i,this._eventMgr,e,t)},getResultFrame:function(){return this._frameSet[1]},getInputFrame:function(){return this._frameSet[0]},getCustomizationFrame:function(){return this._frameSet[2]},hideAllShowBusy:function(){this._frameSet[0]&&this._frameSet[0].hide(),o.mask(this.elements.container)},showInputFrame:function(e){e&&this._frameSet[0].clearPersistedInputs(),this._showFrame(0)},showResultFrame:function(){this._showFrame(1)},showControlCenterFrame:function(e){this._showFrame(2,e)},refreshFrame:function(){this._frameSet[this._currFrameIndex]&&"function"==typeof this._frameSet[this._currFrameIndex].refreshFrame&&this._frameSet[this._currFrameIndex].refreshFrame()},isResultViewActive:function(){return 1===this._currFrameIndex}})})),define("DS/CompareWidget2/ViewDefModules/PartViewDefOptions",["UWA/Core","DS/CompareWidget2/ViewDefModules/DSColors"],(function(e,t){"use strict";var i={PHYSICALID:"REF.physicalid",VERSIONID:"REF.ds6wg:revision",NAME:"REF.name",DFR:"REF.dfr",XFORM:"INST.matrixtxt"},n={CV_PROPS:i,CVURL_BY_TYPE:[{name:"DEFAULT",url:"/cvservlet/expand"}],DATA_SOURCE:"CV_SERVICE",DB_FALLBACK:!1},o={PROPS:i,COMPUTE_DIFFERENT:!0,FORCE_ROOTS_TOGETHER:!0,SYSTEM_RELATIONSHIP_NAMES:["LEFT_ONLY","RIGHT_ONLY","QUANTITY","DIFFERENT","UNRELATED"],CUSTOM_RELATIONSHIP_NAMES:["IDENTICAL","REVISION"],CUSTOM_COMPARISONS:{COMP_PHYSID:[["PHYSICALID","PHYSICALID"],["EQ","NEQ"]],COMP_VERID:[["VERSIONID","VERSIONID"],["EQ","NEQ"]],COMP_NAME:[["NAME","NAME"],["EQ","EQ"]]},CUSTOM_MATCH_ADJUSTMENTS:[{NAME:"MOVED",PROPS:["XFORM","XFORM"],FLAG_ON:"NEQ",MATCH_ADJ:-1}]},r={SYSTEM_RULE_ID_FLAGS:{LEFT_ONLY:{COLOR:t.colorDef.ORANGE,NLS:"LO"},RIGHT_ONLY:{COLOR:t.colorDef.BLUE1,NLS:"RO"},UNRELATED:{COLOR:t.colorDef.BLACK,NLS:"UNRELATED"},DIFFERENT:{COLOR:t.colorDef.BEIGE,NLS:"DIFFERENT"},QUANTITY:{COLOR:t.colorDef.BLUE2,NLS:"QUANTITY"}},CUSTOM_RULE_ID_FLAGS:{IDENTICAL:{COLOR:t.colorDef.NONE,NLS:"SM"},REVISION:{COLOR:t.colorDef.VIOLET,NLS:"REV"},BRANCH:{COLOR:t.colorDef.GREEN2,NLS:"BRANCHED"},DUPE:{COLOR:t.colorDef.RED,NLS:"DUPLICATED"},REPLACED:{COLOR:t.colorDef.PINK,NLS:"REPLACED"}},CUSTOM_MATCH_ADJ_FLAGS:{MOVED:{COLOR:t.colorDef.YELLOW,NLS:"MOVED"}},CONTEXT_MENU_PLUGIN:"DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structDefaultContextMenu",CELL_DRAG_ENABLED_FLAG:!0},s={colorLeft:r.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR,colorRight:r.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR};return{CV_PROPS:i,ATTRIBUTE_DISPLAY_OPTIONS:s,INST_ATTR_FETCH_OPTIONS:{isInstance:!0},INST_ATTR_DISPLAY_OPTIONS:{isInstance:!0,colorLeft:s.colorLeft,colorRight:s.colorRight},STRUCT_FETCH_OPTIONS:n,STRUCT_COMPARE_OPTIONS:o,STRUCT_DISPLAY_OPTIONS:r}})),define("DS/CompareWidget2/ViewDefModules/PartViewDefs_V2",["DS/CompareWidget2/ViewDefModules/PartViewDefOptions"],(function(e){"use strict";var t={AttrFetch:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin"},AttrCompare:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin"},AttrDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",Options:e.ATTRIBUTE_DISPLAY_OPTIONS},InstAttrFetch:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin",Options:e.INST_ATTR_FETCH_OPTIONS},InstAttrCompare:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin"},InstAttrDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",Options:e.INST_ATTR_DISPLAY_OPTIONS},View3DDisplay:{Path:"DS/CompareWidget2/plugins/VIEW3D/VIEW3D_DISPLAY_plugin",Options:e.STRUCT_DISPLAY_OPTIONS},View3DPrep:{Path:"DS/CompareWidget2/plugins/VIEW3D/VIEW3D_PREP_plugin"},StructFetch:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_FETCH_plugin",Options:e.STRUCT_FETCH_OPTIONS},StructCompare:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_COMPARE_plugin",Options:e.STRUCT_COMPARE_OPTIONS},StructDisplay:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_DISPLAY_plugin",Options:e.STRUCT_DISPLAY_OPTIONS},StructListViewPrep:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_LIST_VIEW_PREP_PLUGIN"},Exporter:{Path:"DS/CompareWidget2/plugins/EXPORT/EXPORT_plugin",Options:e.STRUCT_DISPLAY_OPTIONS}};return UWA.merge({VIEWSETS:{STANDARD:{ROW:["STRUCT_VIEW",{COL:[["PROP_VIEW","INSTANCE_VIEW"],"PAD3D_VIEW"]}]},PROPS_ONLY:{ROW:"PROP_VIEW"},STRUCT_ONLY:{ROW:"STRUCT_VIEW"},PAD3D_ONLY:{ROW:"PAD3D_VIEW"},PROPS_AND_STRUCT:{COL:["STRUCT_VIEW","PROP_VIEW"]}},VIEWDEFS:{PROP_VIEW:["AttrFetch","AttrCompare","AttrDisplay"],INSTANCE_VIEW:["InstAttrFetch","InstAttrCompare","InstAttrDisplay"],STRUCT_VIEW:["StructFetch","StructCompare","StructListViewPrep","StructDisplay","Exporter"],PAD3D_VIEW:["StructFetch","View3DPrep","View3DDisplay"]},PLUGDEFS:t},e)})),define("DS/CompareWidget2/widget/viewPanelMgr",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/widget/mainFrame"],(function(e,t){return function(e,i,n,o){this._panelSpecSet={},this._mainFrame=new t(i,n,o),widget._isODTMode()?e.setContent(this._mainFrame):this._mainFrame.inject(e),require(["DS/Windows/ImmersiveFrame"],(function(t){var i=new UWA.Element("div",{class:"wux-control-inline-container",style:{"vertical-align":"top"}});i.inject(e);var n=new t;n.inject(i),require(["DS/WebUAUtils/WebUAUtils"],(function(e){e.setPanelHelpMode({immersiveFrame:n})}))})),this.addPanel=function(e,t,i){var n=[];"function"==typeof t.getWidgetButtons&&(n=t.getWidgetButtons());var o={name:e,panel:t,plugin:i,buttonSpecArray:n};o.panel.hideViewPanelTitleBar=i._pluginOptions.hideViewPanelTitleBar,this._panelSpecSet[e]=o},this.clearCurrentlySelectedRowIDs=function(e){let t=this._panelSpecSet[e];if(null!=t){let e=t.panel;null!=e&&e.clearCurrentlySelectedRowIDs()}},this.initAllPanels=function(e,t){return this.getResultFrame().setAllPanels(this._viewDefModPath,this._viewSetName,this._defaultViewConfig,this._panelSpecSet,this._mainToolbarConfigPath,this._mainToolbarOptions,e,t)},this.setDefaultViewConfig=function(e,t,i,n,o){this._viewSetName=t,this._viewDefModPath=e,this._defaultViewConfig=i.VIEWSET,this._mainToolbarConfigPath=n,this._mainToolbarOptions=o},this.getResultFrame=function(){return this._mainFrame.getResultFrame()},this.showResultFrame=function(){this._mainFrame.showResultFrame()},this.releaseViewPanels=function(){this._mainFrame.resetResultFrame(),this._panelSpecSet={}},this.showInputFrame=function(){this._mainframe.showInputFrame()},this.hideAllShowBusy=function(){this._mainFrame.hideAllShowBusy()},this.requestFrame=function(e){return UWA.createElement("div",{id:e,styles:{position:"relative",display:"flex","flex-direction":"column",height:"100%"}})},this.refreshFrame=function(){this._mainFrame.refreshFrame()},this.isResultViewActive=function(){return this._mainFrame.isResultViewActive()}}})),define("DS/CompareWidget2/framework/useCase",["DS/CompareWidget2/support/cw2Utils"],(function(e){"use strict";var t=function(e,t,i){this.app=e,this.roles=t,this.typeInfoArray=i.map((e=>({type:e.getObjType(),service:e.getServiceName(),interfaces:e.getInterfaces()})));var n=i[0].getSecurityContext();Object.defineProperty(this,"securityContext",{enumerable:!1,get:()=>n})};return t.prototype.getApp=function(){return this.app},t.prototype.getRoles=function(){return this.roles},t.prototype.getSvcArray=function(){return this.typeInfoArray.map((e=>e.service))},t.prototype.getTypeArray=function(){return this.typeInfoArray.map((e=>e.type))},t.prototype.getSvcTypeArray=function(){return this.typeInfoArray.map((e=>e.service+e.type))},t.prototype.equals=function(t){return e.stringify(this)==e.stringify(t)},t.prototype.stringify=function(){return e.stringify(this)},t})),define("DS/CompareWidget2/plugins/STRUCTURE/relCompareEngine",["DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/matchPair","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/hierResultList"],(function(e,t){var i=function(){this._propCompArray=[],this._relScore_lut=[],this._RELNAMES=[]};return i.prototype.initInternals=function(e){var t=this;t._propCompArray=[],t._relScore_lut=[],t._RELNAMES=e.CUSTOM_RELATIONSHIP_NAMES;var i=e.PROPS,n=e.CUSTOM_COMPARISONS,o=Object.keys(n),r=[];for(let e=0;e<t._RELNAMES.length;e++)r[e]=0;o.forEach((function(e,o){var s=n[e],a=s[0],l=a[0],u=a[1],c=i[l],d=i[u];t._propCompArray[o]={compName:e,propName0:c,propName1:d,truthBit:1<<o};for(let e=0;e<t._RELNAMES.length;e++){"EQ"==s[1][e]&&(r[e]+=1<<o)}})),r.forEach((function(e,i){t._relScore_lut[e]=i}))},i.prototype.destroy=function(){delete this._propCompArray,delete this._relScore_lut,delete this._RELNAMES},i.prototype.matchupRelItems=function(e){let t=this;e.getRoot(0).visitAll_nodesAndFN((function(e){if("relations"==e.getType()){let i=e.getParent(),n=null==i?null:i.getMatchInfo();if(n){let i=n.getCompNode(),o=null==i?[]:i.getChildArray(),r=o.length;for(let i=0;i<r;i++){let n=o[i];if("relations"==n.getType()&&n.getTitle()==e.getTitle()){t._addMatchInfoToCRNodes("IDENTICAL",null,e,n,null);let i=e.getChildArray(),o=n.getChildArray();t._matchRelChildren(i,o)}}}}return!0}))},i.prototype._addMatchInfoToCRNodes=function(t,i,n,o,r){var s=new e(t,i,n,o,r);return n.setMatchInfo(s),o.setMatchInfo(s),s},i.prototype._matchRelChildren=function(e,t){let i=this;i._evalNodeSets(e,t).forEach((function(e){i._addMatchInfoToCRNodes(e.relName,null,e.node_base,e.node_comp,[])}))},i.prototype._evalNodeSets=function(e,i){var n={};if(e.length>0&&i.length>0){for(var o=new t(e,i),r=0;r<e.length;r++)for(var s=e[r],a=0;a<i.length;a++){var l,u=i[a];null!==(l=this._eval(s,u))&&o.add(r,a,l,this._RELNAMES[l],0,null)}var c=o.getResult();null!=c&&(n=c.matchedNodePairArray),o.destroy(),o=null}return n},i.prototype._eval=function(e,t){for(var i=this,n=0,o=i._propCompArray.length,r=0;r<o;r++){var s=i._propCompArray[r],a=s.propName0,l=s.propName1,u=e.getAttr(a),c=t.getAttr(l);null!=u&&u==c&&(n+=s.truthBit)}return i._relScore_lut[n]},i})),define("DS/CompareWidget2/plugins/STRUCTURE/REL_COMPARE_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/STRUCTURE/relCompareEngine"],(function(e,t){return e.extend({onLoad:function(){return this._engine=new t,!0},onEnabled:function(){return this.syncSetting("compareSettings.includeFacets.externalRelations.showDocs","showDocs"),this.syncSetting("compareSettings.includeFacets.externalRelations.showOtherRels","showOtherRels"),!0},onDestroy:function(){this._engine=null},execute:function(e,t){var i=this;if(i._objIn=e,!0===this.showDocs||"true"===this.showDocs||!0===this.showOtherRels||"true"===this.showOtherRels){i._parent(e,t),i._engine.initInternals(t),i._objIn.crTreeArray.forEach((function(e){i._engine.matchupRelItems(e)}))}var n=i._objIn;null!=n?i.reportOK(n):i.reportKO()}})})),define("DS/CompareWidget2/plugins/STRUCTURE/flexibleView/ViewPanel/multiViewPanel",["DS/CustomizableLayout/View","DS/CompareWidget2/plugins/STRUCTURE/flexibleView/ViewPanel/structFlexibleViewPanel","DS/UIKIT/Mask","i18n!DS/CompareWidget2/assets/nls/CompareV2","css!UIKIT/UIKIT.css","css!DS/CompareWidget2/CompareWidget2.css"],(function(e,t,i,n){"use strict";return e.extend({init:function(e,t,i){this._parent(i),this.elements.container=e,this.elements.container.addClassName("multi-view-panel"),this._plugSvcs=t,this._structFlexViewPanels={},this._currentViewPanel=null,this._multiStatusesToHideAnd=!1,this.buildSkeleton(),this._displayModes={}},buildSkeleton:function(e){},clearView:function(){var e=this;Object.keys(this._structFlexViewPanels).forEach((function(t){e._structFlexViewPanels[t].clearView()}))},destroy:function(){var e=this;e.elements.container=null,e._plugSvcs=null,e._currentViewPanel=null,Object.keys(this._structFlexViewPanels).forEach((function(t){e._structFlexViewPanels[t].destroy(),delete e._structFlexViewPanels[t]}))},_updateViewDropDowns:function(e){let t=this;var i=[];Object.keys(e).forEach((function(t){i.push(e[t])})),Object.keys(this._structFlexViewPanels).forEach((function(e){t._structFlexViewPanels[e].updateViewDropDowns(i)}))},_setCurrentViewID:function(e){let t=this;this._plugSvcs.postEvent("MULTIVIEW_VIEW_ID_UPDATE_EVENT",{viewID:e}),t.showView(e),Object.keys(this._structFlexViewPanels).forEach((function(i){t._structFlexViewPanels[i].setCurrentViewID(e)}))},reqChangeCurrentViewID:function(e){this._setCurrentViewID(e)},showResults:function(){let e=this,n={};return 1==arguments.length?n=arguments[0]:(n.pluginOptions=arguments[0],n.gridView=arguments[1],n.flagDD=arguments[2],n.compareTreeDocumentArray=arguments[3]),n.panelClass=n.panelClass||t,new Promise((function(t,o){var r=n.gridView.getViewID();e._displayModes[r]=n.gridView.getDisplayMode();var s=e._structFlexViewPanels[r];if(0==i.isMasked(e.elements.container)&&i.mask(e.elements.container),null!=s&&null!=s.syncToolbar&&s.syncToolbar(n.gridView),null==s){let t={reqChangeCurrentViewID:e.reqChangeCurrentViewID.bind(e)};s=new n.panelClass({container:e.elements.container,plugSvcs:e._plugSvcs,options:n.pluginOptions,gridView:n.gridView,flagDD:n.flagDD,viewCallbacks:t,compareTreeDocumentArray:n.compareTreeDocumentArray}),e._structFlexViewPanels[r]=s,null==e._currentViewID||""==e._currentViewID||r==e._currentViewID?e._setCurrentViewID(r):s.hide(),e._updateViewDropDowns(e._displayModes)}s.showResults(n.compareTreeDocumentArray,n.flagDD,t),t()}))},showView:function(e){var t=this._structFlexViewPanels[e];null!=t&&t!=this._currentViewPanel&&(null!=this._currentViewPanel&&this._currentViewPanel.hide(),t.show(),this._currentViewPanel=t),this._currentViewID=e},onResize:function(){null!=this._currentViewPanel&&this._currentViewPanel.onResize()},getLabel:function(){return n[this.elements.container.id]},getName:function(){return this.elements.container.id},onComparePanelUpdated:function(){null!=this._currentViewPanel&&this._currentViewPanel.onComparePanelUpdated()},onActivate:function(){null!=this._currentViewPanel&&this._currentViewPanel.onActivate()}})})),define("DS/CompareWidget2/framework/svcNodeNet",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/framework/svcNode","DS/CompareCommon/Probs/CompareAnalyticsProb"],(function(e,t,i){var n=function(e,t){this._eventMgr=t,this._plugSvcs=e,this._inputEventName="DEFAULT_INPUT",this._svcNodeSet={},this._viewSvcNodeArray=[],this._lastObjSent=null,this._lastStructPlugin=null,this._subscribeTokens={},this._beginTimeMS=0,this._waitingCount=0,this._viewSvcNodeByViewPanelName=null,this._subscribeTokens.VIEW_CLOSED=this._eventMgr.subscribe({event:"VIEW_CLOSED"},this._handleViewClosed.bind(this)),this._subscribeTokens.VIEW_OPENED=this._eventMgr.subscribe({event:"VIEW_OPENED"},this._handleViewOpened.bind(this))};return n.prototype.getSvcNodeForViewName=function(e){var t=this;return null==t._viewSvcNodeByViewPanelName&&(t._viewSvcNodeByViewPanelName={},t._viewSvcNodeArray.forEach((function(e){if(null!=e.getViewPanel()){var i=e._plugin.getViewPanelName();t._viewSvcNodeByViewPanelName[i]=e}}))),t._viewSvcNodeByViewPanelName[e]},n.prototype.enableViewNodes=function(e){let t=this;e.forEach((function(e){t.getSvcNodeForViewName(e).enable()}))},n.prototype._handleViewClosed=function(t){e.dbgout("svcNodeNetwork is handling frameMinimized..."),this.getSvcNodeForViewName(t.view.getName()).disable()},n.prototype._handleViewOpened=function(t){e.dbgout("svcNodeNetwork is handling frameRestored..."),this.getSvcNodeForViewName(t.view.getName()).enable()},n.prototype.destroy=function(){var e=this;e._unsubscribeAllEvents(),e._eventMgr=null,e._plugSvcs=null,Object.keys(e._svcNodeSet).forEach((function(t){e._svcNodeSet[t].destroy()})),e._svcNodeSet=null,e._viewSvcNodeArray=[]},n.prototype.updateInput=function(t){this._beginTimeMS=this._plugSvcs.nowMS(),this._waitingCount=Object.keys(this._subscribeTokens).length,e.dbgout("---------------------------------------------------------------------"),e.dbgout("------------[ P R O C E S S I N G    I D S   B E G I N  ] -----------"),e.dbgout("---------------------------------------------------------------------"),e.dbgout("svcNodeNet updating input... raising event '"+this._inputEventName+"'"),this._lastObjSent=t,this._eventMgr.publish({event:this._inputEventName,data:{eventName:this._inputEventName,obj:t}})},n.prototype._buildViewPanels=function(){var t=this;e.dbgout("INIT","------------[ B U I L D   V I E W S   B E G I N ] -----------");var i=t._plugSvcs.nowMS();t._viewSvcNodeArray.forEach((function(t){e.dbgout("INIT","Building view: "+t.getViewName()),t.buildViewPanel()})),t._plugSvcs.reportTime(i," views built"),e.dbgout("INIT","------------[ B U I L D   V I E W S   E N D     ] -----------")},n.prototype.build=function(i){var n=this;e.dbgout("INIT","------------[ C R E A T E   S v c   N o d e   N E T W O R K   B E G I N ] -----------");var o=n._plugSvcs.nowMS(),r=i.PLUGSLOADED,s=i.PLUGDEFS;Object.keys(s).forEach((function(e){var i=s[e],o=i.Path,a=i.Options,l=r[e],u=new t(e,o,a,l,n._plugSvcs,n._eventMgr);n._svcNodeSet[e]=u}));i.VIEWSET;var a=i.VIEWDEFS;(l=Object.keys(a)).forEach((function(e,t){var i=a[e];if(0===t&&(n._lastStructPlugin=i[i.length-1]),i.every((e=>n._svcNodeSet[e].isPlugObjLoaded()))){var o=i[0],r=n._svcNodeSet[o];r.subscribeToInputEvent(n._inputEventName);for(var s=r,l=i.length,u=1;u<l;u++){var c=i[u],d=n._svcNodeSet[c];s.addDownstreamNode(d),d.addUpstreamNode(s);var p=s.getOutputEventName();d.subscribeToInputEvent(p),s=d}var h=s.getOutputEventName();n._addToFinishedEventList(h)}}));var l=Object.keys(a),u={};l.forEach((function(e){var t=a[e];if(t.every((e=>n._svcNodeSet[e].isPlugObjLoaded())))for(var i=0;i<t.length;i++){var o=t[i],r=n._svcNodeSet[o];"DISPLAY_PLUGIN"==r.getPluginType()&&null==u[o]&&(r.setViewName(e),n._viewSvcNodeArray.push(r),u[o]=!0)}})),1===n._viewSvcNodeArray.length&&(n._viewSvcNodeArray[0]._pluginOptions=n._viewSvcNodeArray[0]._pluginOptions||{},n._viewSvcNodeArray[0]._pluginOptions.hideViewPanelTitleBar=!i?.FRAMEWORK_OPTIONS?.displaySingleViewPanelTitleBar),n._buildViewPanels(),n._plugSvcs.reportTime(o," svcNodeNet built"),e.dbgout("INIT","------------[ C R E A T E   S v c   N o d e   N E T W O R K   E N D ] -----------")},n.prototype.enableAll=function(){var t=this._setNetEnable(!0);return 0==t&&e.errout("There was a problem enabling the service nodes"),t},n.prototype.disableAll=function(){return this._setNetEnable(!1)},n.prototype._setNetEnable=function(e){var t=this,i=!1;return Object.keys(t._svcNodeSet).forEach((function(n){var o=t._svcNodeSet[n];i|=1==e?o.enable():o.disable()})),i},n.prototype._handleFinishedEvent=function(t){this._waitingCount>0&&(this._waitingCount--,0==this._waitingCount&&(e.dbgout("---------------------------------------------------------------------"),e.dbgout("------------- [ P R O C E S S I N G    I D S   E N D  ] -------------"),e.dbgout("---------------------------------------------------------------------"),e.reportTime(this._beginTimeMS," svcNodeNetwork completes; async ops may still be processing")));let n=t&&t.split(".")[0];n===this._lastStructPlugin&&(e.dbgout(`-------------------------------Last Struct plugin is ${n}--------------------------------------`),i.compareTrackerInit(),i.setActionName(i.getActiveViewActionName()),i.setActionTarget(i.getActiveViewName()),i.trackActivateView())},n.prototype._addToFinishedEventList=function(e){this._subscribeTokens[e]=this._eventMgr.subscribe({event:e},this._handleFinishedEvent.bind(this,e))},n.prototype._unsubscribeAllEvents=function(){var e=this;Object.keys(e._subscribeTokens).forEach((function(t){var i=e._subscribeTokens[t];e._eventMgr.unsubscribe(i)})),e._subscribeTokens={}},n})),define("DS/CompareWidget2/plugins/STRUCTURE/flexibleView/STRUCT_FLEXIBLE_VIEW_plugin",["DS/CompareWidget2/plugins/displayPlugin","DS/CompareWidget2/plugins/STRUCTURE/flexibleView/ViewPanel/multiViewPanel"],(function(e,t){"use strict";return e.extend({init:function(e,t,i,n){this._parent(e,t,i,n)},onEnabled:function(){var e=this;return e.subscribeEvent("STRUCT_UPDATE_IN_PROGRESS_EVENT",e.onUpdateInProgress.bind(e)),e.syncCurrentViewSetID(),e._parent()},syncCurrentViewSetID:function(){let e=this;try{let t="viewSettings.STRUCT_VIEW.currentFlexViewID_"+(this._plugSvcs.getCurrentViewSetID()+this.getName());e.syncSetting(t,"_currentViewID",null,e._outputPanel,null,!0)}catch(t){e._plugSvcs.dbgout("Failed to retrieve sync current viewSetID"),e._outputPanel._currentViewID=null}},createViewPanelObject:function(e,i){return new t(e,this._plugSvcs,i)},execute:function(e,t){var i=this;i._parent(e,t);var n=e.compareTreeDocumentArray,o=e.gridView,r=e.flagDisplayData;i._outputPanel.showResults(t,o,r,n).then((function(e){i.showNotBusy();var t=n[0].__CRTREE__;i.reportOK({viewID:o.getViewID(),crTreeArray:[t]})}),(function(e){i.reportKO(e)}))}})})),define("DS/CompareWidget2/framework/CPF",["DS/CompareCommon/Utils","DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/framework/useCase","DS/CompareWidget2/framework/CPF_configMgr","DS/CompareWidget2/framework/svcNodeNet","DS/CompareWidget2/framework/pluginMgr","DS/CompareWidget2/support/DataCenter","DS/CompareWidget2/support/objIDSpec","DS/LifecycleServices/LifecycleServicesSettings"],(function(e,t,i,n,o,r,s,a,l){var u=function(e,i,n,o,r){this._viewPanelMgr=e,this._plugSvcs=n,this._eventMgr=i,this._svcNodeNet=null,this._ccm=r,this._currentUseCase=null,t.enableDebugLabel("INIT"),t.enableDebugLabel("PROC_CONTROL"),this._okToUseVars=null,null!=o&&1==o.isODT&&(this,this.forODT=c)};u.prototype._filter_ID_2_ID_w_filter=function(e){var i=this;return new Promise((function(n,o){s.fetchFilterDefinition(e).then((function(r){var l=r,u=JSON.parse(l.filterCVQuery),c=l.rootPhysicalId;if(null==c&&(c=u.CVQuery.union.expand[0].root_path_physicalid[0][0]),null==c){let e="DataCenter.fetchFilterDefinition: Failed to get the root of the filter definition";t.errout(e),o(e)}var d={physicalid:[c],label:widget._isODTMode()?"":"CompareFindFilteredObject-"+t.nowMS(),select_predicate:["ds6w:label","physicalid","ds6w:type","interface"]};s.makeAuthHttpsCall("/cvservlet/fetch/v2","POST",d,"json",e.getTenant(),e.getServiceName(),e.getSecurityContext()).then((function(t){let i={};t.results[0].attributes.forEach((function(e){i[e.name]=e.value}));var o={...u,empty:!1,appId:"CompareWidget",widget:widget.id,filterRootIds:[c],filterRootAlias:[i["ds6w:label"]],filterTitle:l.filterTitle,hideChildren:!1},r=new a(c,i["ds6w:type"],e.getSecurityContext(),e.getTenant(),e.getServiceName(),o,"modelID",null,!0,!0,[i.interface]);n(r)}),(function(e){i._plugSvcs("EXCEPTION doing simple expand: "+e),o(e)}))}),(function(e){i._plugSvcs("EXCEPTION getting filter defn: "+e),o(e)}))}))},u.prototype._massageObjIDs=function(e){var i=this;return new Promise((function(n,o){!function(e){for(var i=e.length,n=!1,o=!1,r=0;r<i;r++)null!=(u=(d=e[r]).getSecurityContext())&&""!=u||(n=!0),null!=(c=d.getTenant())&&""!=c||(o=!0);if(n||o){var s=null,a=null;for(r=0;r<i;r++){var l=e[r];if(n&&null!=(u=l.getSecurityContext())&&""!=u&&(n=!1,s=u),o&&null!=(c=l.getTenant())&&""!=c&&(o=!1,a=c),0==n&&0==o)break}for(r=0;r<i;r++){var u,c;null!=(u=(d=e[r]).getSecurityContext())&&""!=u||(null==s?t.errout("Missing security context in request (can not repair)..."):(t.warnout("Missing security context in request (repairing)..."),d._securityContext=s)),null!=(c=d.getTenant())&&""!=c||(null==s?t.errout("Missing tenant in request (can not repair)..."):(t.warnout("Missing tenant in request (repairing)..."),d._tenant=a))}}for(r=0;r<i;r++){var d,p=(d=e[r]).getServiceName();"3dspace"==p.toLowerCase()&&"3DSpace"!=p&&(t.warnout("Correcting malformed service name '"+p+"' to '3DSpace'"),d._serviceName="3DSpace")}}(e);var r=[],s=[];e.forEach((function(e,t){"ENOStrRefinementSpecification"!=e.getObjType()?r[t]=e:s.push(t)}));var a=s.length;0==a?n(e):s.forEach((function(r){let s=r,l=e[r];i._filter_ID_2_ID_w_filter(l).then((function(t){console.debug("TEST NEW: "+JSON.stringify(t)),e[s]=t,--a<=0&&n(e)}),(function(e){t.errout("Failure comparing with use case: "+e),o(e)}))}))}))},u.prototype.compareObjs=function(e,n){var o=this;return o._printStartMsg(n),o._viewPanelMgr.hideAllShowBusy(),new Promise((function(r,s){return new Promise(((e,t)=>{l.getGrantedRoles(e)})).then((a=>{let l=a.map((e=>e.id)).filter((e=>null!=e));l.push("*"),o._massageObjIDs(n).then((function(a){n=a;let u=o._currentUseCase=new i(e.app,l,n);o._compareObjsWithUseCase(e,n,u,e.noViewDefMatchDefaultToCompare).then((function(e){r(e)}),(function(e){t.errout("Failure comparing with use case: "+e),s(e)}))}),(function(e){t.errout("Failure massaging ObjIDSpecs: "+e+"; cannot create use case for comparison"),s(e)}))}))}))},u.prototype.compareObjsWithViewSetName=function(e,i,o,r,s,a){var l=this;return new Promise((function(u,c){l._printStartMsg(i),l._viewPanelMgr.hideAllShowBusy(),n.loadConfig_byPathAndName(e,o,r,s,a).then((function(e){var n=e;l._compareObjsWithViewConfig(i,n).then((function(e){t.dbgout("INIT","compare with viewSetName is OK!"),u(e)}),(function(e){t.errout("compare with viewSetName FAILURE!!!"),c(e)}))}),(function(e){t.errout("Failure to load view config: "+e),c(e)}))}))},u.prototype._sendUpdatedInputToSvcNodeNet=function(e){var i=!1;this._viewPanelMgr.showResultFrame();var n=t.nowMS();return null==this._svcNodeNet?t.errout("No svcNodeNet to update"):(this._svcNodeNet.updateInput(e),i=!0),t.reportTime(n," ##### update input"),i},u.prototype._compareObjsWithUseCase=function(i,o,r,s){var a=this;t.dbgout("INIT","<><><><><><><><><><><><><><><><><><>"),t.dbgout("INIT","<><> USE CASE     APP: "+r.getApp()),t.dbgout("INIT","<><> USE CASE    ROLE: "+r.getRoles().join("~")),r.getSvcTypeArray().forEach((function(e){t.dbgout("INIT","<><> USE CASE svcType: "+e)})),t.dbgout("INIT","<><><><><><><><><><><><><><><><><><>");var l=t.nowMS();let u=function(i,n){t.reportTime(l,"get viewConfig for use case");let s=!1,u=null;if(i.FRAMEWORK_OPTIONS&&!0===i.FRAMEWORK_OPTIONS.customCompareActive&&!0===widget.CV2EnableCustomProfile){s=!0;var c=a._ccm&&a._ccm.getUserPreferredProfileName(r);null!=c&&a._ccm&&!a._ccm.isDefaultProfile(c)?(t.dbgout("INIT","<><> using CUSTOM PROFILE: '"+c+"'"),u=e.forceIndex_DisableOtherRelations_ForCustomProfilePromiseArray(),u.push((async()=>{i=await a._ccm.applyCustomProfileToViewConfig(c,i)})())):(s=a._ccm.doesUseCaseTemplateProfileExist(r),u=[Promise.resolve(null)])}else u=[Promise.resolve(null)];Promise.allSettled(u).then((()=>{a._compareObjsWithViewConfig(o,i,r,s).then((function(e){t.dbgout("INIT","compare with useCase is OK!"),n(e)}),(function(e){t.errout("compare with useCase FAILURE!!!"),KOfn(e)}))}))};return new Promise((function(e,o){n.loadConfig_byUseCase(i,r).then((t=>{u(t,e)}),(function(a){t.errout("[FRMWRK][INIT] !! ---\x3e>> "),t.errout("[FRMWRK][INIT] !! ---\x3e>>  ViewSet not found for Use Case!"),Array.isArray(a.errors)&&a.errors.length&&a.errors.some((e=>-1!==e.indexOf("NO MATCHES FOUND")))&&!0===s?(r.app="COMPARE",t.errout("[FRMWRK][INIT] !! ---\x3e>>  Looking for a fallback viewset; using app = '"+r.app+"'"),t.errout("[FRMWRK][INIT] !! ---\x3e>> "),n.loadConfig_byUseCase(i,r).then((function(i){t.errout("[FRMWRK][INIT] !! ---\x3e>> USING FALLBACK VIEWSET <<<--- !! "),u(i,e)}),(function(e){t.errout("[FRMWRK][INIT] FAILED getting viewConfig for use case"),o("Failed getting viewConfig for use case")}))):(t.errout(`[FRMWRK][INIT] FAILED getting viewConfig for use case:${r.stringify()}`),o("Failed getting viewConfig for use case"))}))}))},u.prototype._buildSvcNodeNet=function(e){var t=new o(this._plugSvcs,this._eventMgr);return t.build(e),t},u.prototype._compareObjsWithViewConfig=function(e,i,n,o){var s=this;return new Promise((function(a,l){var u=i.viewDefModPath,c=i.viewSetName,d=i.mainToolbarConfigPath,p=i.mainToolbarOptions;t.dbgout("INIT","<><><><><><><><><><><><><><><><><><><><><><><><><><>"),t.dbgout("INIT","<><> USING viewDefMod: "+u),t.dbgout("INIT","<><> USING    viewSet: "+c),t.dbgout("INIT","<><><><><><><><><><><><><><><><><><><><><><><><><><>");var h=t.nowMS();r.getPlugins(i.PLUGDEFS,s._plugSvcs).then((function(r){t.reportTime(h,"--\x3e load all plugins"),i.PLUGSLOADED=r,t.dbgout("INIT","<><> --\x3e viewSet is new... building new svcNodeNet..."),t.dbgout("INIT","<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>"),null!=s._svcNodeNet&&(s._svcNodeNet.destroy(),s._viewPanelMgr.releaseViewPanels(),s._svcNodeNet=null),s._svcNodeNet=s._buildSvcNodeNet(i),s._viewPanelMgr.setDefaultViewConfig(u,c,i,d,p),s._viewPanelMgr.initAllPanels(n,o).then((function(t){let i=s._viewPanelMgr.getResultFrame().getActiveViewNamesFromPrefs();null!=i?s._svcNodeNet.enableViewNodes(i):s._svcNodeNet.enableAll(),s._sendUpdatedInputToSvcNodeNet(e),a()}),(function(e){t.errout("Failed to initialize view panels. Cannot continue."),l(e)}))}),(function(e){t.errout("Error loading plugins:: "+t.stringify(e)),l(e)}))}))},u.prototype._printStartMsg=function(e){t.dbgout("INIT","<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>"),t.dbgout("INIT","<><><><><><><><><><>   BEGIN NEW COMPARE  <><><><><><><><><><><><><><><><><>"),t.dbgout("INIT","<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>");for(var i=0;i<e.length;i++){let n=e[i];"AMD_MODULE_PATH"==n.getIDType()?t.dbgout("INIT","<><> ID ["+i+"]: AMD MODULE: "+n.getPhysID()):(t.dbgout("INIT","<><> ID ["+i+"]: SERVICE : "+n.getPhysID()),t.dbgout("INIT","<><> ID ["+i+"]:      ID : "+n.getPhysID()),t.dbgout("INIT","<><> ID ["+i+"]: OBJTYPE : "+n.getObjType()),t.dbgout("INIT","<><> ID ["+i+"]:   TENANT: "+n.getTenant()),t.dbgout("INIT","<><> ID ["+i+"]: SEC CTXT: "+n.getSecurityContext()),t.dbgout("INIT","<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>"))}t.dbgout("INIT","<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>")};var c={};return u})),define("DS/CompareWidget2/plugins/STRUCTURE/singleGridView/SG_DISPLAY_plugin",["DS/CompareWidget2/plugins/STRUCTURE/flexibleView/STRUCT_FLEXIBLE_VIEW_plugin","DS/CompareWidget2/plugins/STRUCTURE/flexibleView/ViewPanel/structFlexibleViewPanel"],(function(e,t){"use strict";return e.extend({init:function(e,t,i,n){this._parent(e,t,i,n)},onEnabled:function(){var e=this;return e.syncSetting("viewSettings.STRUCT_VIEW.currentViewID_SG","_currentViewID",null,e._outputPanel),e._parent()},getPanelClass:function(){return t},execute:function(e,t){var i=this,n=e.compareTreeDocumentArray,o=e.gridView,r=e.flagDisplayData;i._outputPanel.showResults({pluginOptions:t,gridView:o,flagDD:r,compareTreeDocumentArray:n,panelClass:i.getPanelClass()}).then((function(e){i.showNotBusy();var t=n[0].__CRTREE__;i.reportOK({viewID:o.getViewID(),crTreeArray:[t]})}),(function(e){i.reportKO(e)}))}})})),define("DS/CompareWidget2/implementations/costing/SG_DISPLAY_COSTING_plugin",["DS/CompareWidget2/plugins/STRUCTURE/singleGridView/SG_DISPLAY_plugin","DS/CompareWidget2/implementations/costing/costingViewPanel","css!DS/CompareWidget2/assets/css/implementations/costing/costing.css"],(function(e,t){return e.extend({init:function(e,t,i,n){this._parent(e,t,i,n)},getPanelClass:function(){return t}})})),define("DS/CompareWidget2/support/objIDSpecWithBSD",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/support/objIDSpec"],(function(e,t){return class extends t{constructor(t,i,n,o,r,s,a,l,u,c,d,p,h){super(t,i,n,o,r,s,a,l,u,c,d),this._BSDId=p?e.dupeJson(p):null,this._title=h?e.dupeJson(h):null,this._reqModforODT="DS/CompareWidget2/support/objIDSpecWithBSD"}destroy(){super.destroy(),delete this._BSDId,delete this._title}getUniqueID(){let e="NO_FILTER";null!=this._externalFilterSpec&&(e=this._externalFilterSpec.filterTitle);let t="NO_COMMANDS";return null!=this._commands&&(t=this._commands),super.getUniqueID()+"-"+(this._BSDId||"NO_BSDID")+"-"+(this._title||"NO_TITLE")}getBSDId(){return this._BSDId}getTitle(){return this._title}setBSDId(t){this._BSDId=t?e.dupeJson(t):null}setTitle(t){this._title=t?e.dupeJson(t):null}}})),define("DS/CompareWidget2/plugins/ATTRIBUTE/ViewPanel/instanceAttrComparePanel",["DS/CompareWidget2/plugins/ATTRIBUTE/ViewPanel/propsComparePanel","DS/CompareCommon/Utils","i18n!DS/CompareWidget2/assets/nls/CompareV2"],(function(e,t,i){return e.extend({init:function(e,t,i){this._parent(e,t,i)},getLabel:function(){return i.CompareInstancePanelTitle},getName:function(){return"INSTANCE_VIEW"},getDomId:function(){return"instattr"},isTitleAttr:function(e){return t.isTitleAttr(e,!0)}})})),define("DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",["DS/CompareWidget2/plugins/displayPlugin","DS/CompareWidget2/plugins/ATTRIBUTE/ViewPanel/attrComparePanel","DS/CompareWidget2/plugins/ATTRIBUTE/ViewPanel/instanceAttrComparePanel","DS/CompareWidget2/plugins/ATTRIBUTE/ViewPanel/effectivityComparePanel","i18n!DS/CompareWidget2/assets/nls/DisplayMessages"],(function(e,t,i,n,o){return e.extend({onEnabled:function(){var e=this;return{instProps:[{eventName:"INST_PROPS_UPDATE_IN_PROGRESS_EVENT",fn:e.onUpdateInProgress},{eventName:"INST_PROPS_FETCH_FAILED",fn:e.onAttrFetchFailure},{eventName:"NO_CURRENT_SELECTION_EVENT",fn:function(){e.showMessage(o.PROPS_UNAVAILABLE_NO_SELECTION)}},{eventName:"INST_PROPS_OFF_NONE_AVAILABLE",fn:function(){e.showMessageAndSignalOK("INST_PROPS_OFF_NONE_AVAILABLE_MSG")}},{eventName:"INST_PROPS_OFF_DURING_LIST_COMPARE",fn:function(){e.showMessageAndSignalOK("INST_PROPS_OFF_DURING_LIST_COMPARE_MSG")}},{eventName:"INST_PROPS_OFF_TOO_MANY_SELECTED",fn:function(){e.showMessageAndSignalOK("INST_PROPS_OFF_TOO_MANY_SELECTED_MSG")}},{eventName:"GROUP_PLACEHOLDER_SELECTED",fn:function(){e.showMessageAndSignalOK("GROUP_PLACEHOLDER_SELECTED_MSG")}}],effectivity:[{eventName:"EFFECTIVITY_UPDATE_IN_PROGRESS_EVENT",fn:e.onUpdateInProgress},{eventName:"EFFECTIVITY_FETCH_FAILED",fn:e.onAttrFetchFailure},{eventName:"NO_CURRENT_SELECTION_EVENT",fn:function(){e.showMessage(o.PROPS_UNAVAILABLE_NO_SELECTION)}},{eventName:"EFFECTIVITY_OFF_NONE_AVAILABLE",fn:function(){e.showMessageAndSignalOK("EFFECTIVITY_OFF_NONE_AVAILABLE_MSG")}},{eventName:"EFFECTIVITY_OFF_DURING_LIST_COMPARE",fn:function(){e.showMessageAndSignalOK("EFFECTIVITY_OFF_DURING_LIST_COMPARE_MSG")}},{eventName:"EFFECTIVITY_OFF_TOO_MANY_SELECTED",fn:function(){e.showMessageAndSignalOK("EFFECTIVITY_OFF_TOO_MANY_SELECTED_MSG")}},{eventName:"GROUP_PLACEHOLDER_SELECTED",fn:function(){e.showMessageAndSignalOK("GROUP_PLACEHOLDER_SELECTED_MSG")}}],refProps:[{eventName:"REF_PROPS_UPDATE_IN_PROGRESS_EVENT",fn:e.onUpdateInProgress},{eventName:"REF_PROPS_FETCH_FAILED",fn:e.onAttrFetchFailure},{eventName:"NO_CURRENT_SELECTION_EVENT",fn:function(){e.showMessage(o.PROPS_UNAVAILABLE_NO_SELECTION)}},{eventName:"REF_PROPS_OFF_NONE_AVAILABLE",fn:function(){e.showMessageAndSignalOK("REF_PROPS_OFF_NONE_AVAILABLE_MSG")}},{eventName:"REF_PROPS_OFF_TOO_MANY_SELECTED",fn:function(){e.showMessageAndSignalOK("REF_PROPS_OFF_TOO_MANY_SELECTED_MSG")}},{eventName:"GROUP_PLACEHOLDER_SELECTED",fn:function(){e.showMessageAndSignalOK("GROUP_PLACEHOLDER_SELECTED_MSG")}}]}["InstAttrDisplay"===this._name?"instProps":"EffectivityDisplay"===this._name?"effectivity":"refProps"].forEach((function(t){e.subscribeEvent(t.eventName,t.fn.bind(e))})),e._parent()},showMessageAndSignalOK:function(e){this.showMessage(o[e]),this.reportOK()},onAttrFetchFailure:function(){this.showNotBusy()},createViewPanelObject:function(e,o){let r=null;return r=null!=o&&!0===o.isEffectivity?new n(e,this._plugSvcs,o):null!=o&&!0===o.isInstance?new i(e,this._plugSvcs,o):new t(e,this._plugSvcs,o),r},execute:function(e,t){var i=this;i._parent(e,t),i._outputPanel.showResults(e).then((function(e){i.showNotBusy(),i.reportOK(e)}),(function(e){i.reportKO(e)}))}})})),define("DS/CompareWidget2/cw2",["DS/CompareCommon/Utils","DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/framework/CPF","DS/CompareWidget2/framework/pluginServices","DS/CompareWidget2/widget/viewPanelMgr","DS/CompareWidget2/support/EventManager","DS/CompareWidget2/support/objIDSpec","DS/CompareWidget2/Customization/CompareCustomizationManager","i18n!DS/CompareWidget2/assets/nls/DisplayMessages","DS/CompareWidget2/support/objIDSpecWithBSD"],(function(e,t,i,n,o,r,s,a,l,u){var c={getAck:function(){return"Ack"}};function d(e,t){var i="2",n=new URLSearchParams(window.location.search);if(n&&n.has("widgetDomain")){var o=n.get("widgetDomain"),r=new URLSearchParams(o.substring(o.indexOf("?")));r&&r.has(e)&&r.get(e).indexOf("true")>=0&&(i=t)}return i}var p=function(e,t){(t=t||{}).viewDefType=null!=t.viewSetMod&&null!=t.viewSetName?"AS_GIVEN":"LOOKUP";this._runOptions={app:"COMPARE",viewDefType:"LOOKUP",viewSetName:"STRUCT_ONLY",viewSetMod:"DS/CompareWidget2/ViewDefModules/DefaultViewDefs_V2",isODT:!1},Object.assign(this._runOptions,t,this._runOptions),widget.recordForODT=!0===d("recordForCV2ODT",!0),widget.CV2Debug=!0===d("CV2Debug",!0),widget.CV2Timing=!0===d("CV2Timing",!0),widget.CV2EnableCustomProfile=!0;var l=this;l._eventMgr=new r,l._eventTokens=[],l._eventTokens.push(l._eventMgr.subscribe({event:"Event_CW2_REFRESH"},l._handler_CW2_REFRESH.bind(l))),l._eventTokens.push(l._eventMgr.subscribe({event:"Event_inputUpdate"},l._handler_inputUpdate.bind(l))),l._eventTokens.push(l._eventMgr.subscribe({event:"Event_replaceCompare"},l._handler_replaceCompare.bind(l))),l._eventTokens.push(l._eventMgr.subscribe({event:"Event_CW2_SWAP"},l._handler_CW2_SWAP.bind(l))),l._eventTokens.push(l._eventMgr.subscribe({event:"Event_CW2_RESET_TO_INPUT"},l._handler_CW2_RESET_TO_INPUT.bind(l))),l._eventTokens.push(l._eventMgr.subscribe({event:"Event_CW2_SELECT_PROFILE"},l._handler_CW2_SELECT_PROFILE.bind(l))),l._eventTokens.push(l._eventMgr.subscribe({event:"Event_controlCustomizationDone"},l._handler_POST_EDIT_CUSTOMIZATION.bind(l)));let u=null!=l._runOptions.objIDSpecArray&&null!=l._runOptions.objIDSpecArray;null==l._runOptions.objIDSpecArray&&"AS_GIVEN"==l._runOptions.viewDefType&&null!=l._runOptions.viewSetMod&&null!=l._runOptions.viewSetName&&null!=l._runOptions.objAMDNameArray&&2==l._runOptions.objAMDNameArray.length&&(u=!0,l._runOptions.objIDSpecArray=[new s(l._runOptions.objAMDNameArray[0],l._runOptions.objAMD_dataType[0],"UNKN SEC CONTEXT","UNKNOWN_TENANT","NO_SERVICE",null,"AMD_MODULE_PATH"),new s(l._runOptions.objAMDNameArray[1],l._runOptions.objAMD_dataType[1],"UNKN SEC CONTEXT","UNKNOWN_TENANT","NO_SERVICE",null,"AMD_MODULE_PATH")]),l._ccm=null,0==u&&(l._ccm=new a),(l._ccm&&l._ccm.init()||Promise.resolve()).then((t=>{l._viewPanelMgr=new o(e,l._eventMgr,l._runOptions,l._ccm);var r=new n(l._viewPanelMgr,l._eventMgr);l._CPF=new i(l._viewPanelMgr,l._eventMgr,r,l._runOptions,l._ccm),u&&l._handler_inputUpdate(l._runOptions.objIDSpecArray),1==l._runOptions.isODT&&(l.forODT=c,widget.dispatchEvent("ENOLCM/CompareWidget/endLoadingWidget"))}))};return p.prototype._handler_inputUpdate=function(e){if(!this.compareIsRunning&&null!=e&&e.length>0){if(this.compareIsRunning=!0,"AS_GIVEN"==this._runOptions.viewDefType){var t=this._runOptions.viewSetMod,i=this._runOptions.viewSetName,n=null,o=null;null!=this._runOptions.MainToolbarConfig&&(n=this._runOptions.MainToolbarConfig[0].Location,o=this._runOptions.MainToolbarConfig[0].DoNotInclude),this.compareObjsWithViewSetName(this._runOptions,e,t,i,n,o)}else this.compareObjs(e);this._currObjIDSpecArray=e,setTimeout((()=>{this.compareIsRunning=!1}),2e3)}},p.prototype._handler_replaceCompare=function(e){if(null==this._currObjIDSpecArray||this._currObjIDSpecArray.constructor!=Array||this._currObjIDSpecArray.length<2)t.errout("dropCompare called  without prior comparison");else{var i=null==e||null==e.data?null:e.data.objIDSpecArray;if(null==i||i.constructor!=Array||i.length<1)t.errout("bad call to dropCompare");else{for(var n=this._currObjIDSpecArray.length,o=e.data.targetIndex,r=[],s=0;s<n;s++)s==o?i.forEach((function(e){r.push(e)})):r.push(this._currObjIDSpecArray[s]);this._handler_inputUpdate(r)}}},p.prototype._handler_CW2_SWAP=function(){this._eventMgr.publish({event:"EVENT_FLUSH_DATA_CACHES"}),this._eventMgr.publish({event:"Event_clearView"});var t=e.fetchPersistedIDs();if(null!=t&&void 0!==t.items&&null!==t.items&&t.items.length>1){var i=t.items.shift();t.items.push(i),e.persistIDs(t)}var n=this._currObjIDSpecArray.shift();this._currObjIDSpecArray.push(n),this._handler_inputUpdate(this._currObjIDSpecArray)},p.prototype._handler_CW2_REFRESH=function(){this._eventMgr.publish({event:"EVENT_FLUSH_DATA_CACHES"}),this._eventMgr.publish({event:"Event_clearView"}),this._handler_inputUpdate(this._currObjIDSpecArray)},p.prototype._handler_CW2_RESET_TO_INPUT=function(){this._eventMgr.publish({event:"Event_clearView"}),this._eventMgr.publish({event:"Event_resetToDropFrame"}),this._currObjIDSpecArray=null},p.prototype._handler_CW2_SELECT_PROFILE=function(e){if(null!=e&&null!=this._currObjIDSpecArray[0]){var t=this._currObjIDSpecArray[0].getObjType();this._ccm.setUserPreferredProfileName(t,e)}this._eventMgr.publish({event:"EVENT_FLUSH_DATA_CACHES"}),this._eventMgr.publish({event:"Event_clearView"}),this._handler_inputUpdate(this._currObjIDSpecArray)},p.prototype._handler_POST_EDIT_CUSTOMIZATION=function(e){!0===e.status&&(this._eventMgr.publish({event:"EVENT_FLUSH_DATA_CACHES"}),this._eventMgr.publish({event:"Event_clearView"}),this._handler_inputUpdate(this._currObjIDSpecArray))},p.prototype.refresh=function(){this._viewPanelMgr.isResultViewActive()&&this._handler_CW2_REFRESH(),this._viewPanelMgr.refreshFrame()},p.prototype.getAppName=function(){return this._runOptions.app},p.prototype.getWidgetTitle=function(){return this._runOptions.widgetTitle},p.prototype.compareObjs=function(i){var n=this,o=[];i.forEach((function(e){var t=e.makeDupe();o.push(t)})),this._CPF.compareObjs(this._runOptions,o).then((function(e){t.dbgout("CW2 reports build/drop IDs successful."),n._eventMgr.publish({event:"Event_disableSwap",data:o.length>2})}),(function(i){t.errout("CW2 reports failure :"+i),null!=i.stack&&t.errout("Stack trace:"+i.stack),n._eventMgr.publish({event:"Event_CW2_RESET_TO_INPUT"}),e.showAlertBox("COMPARE_FAILED",l,"error",!0)}))},p.prototype.compareObjsWithViewSetName=function(i,n,o,r,s,a){t.dbgout("Comparing with named viewSet '"+r+"' from viewDefModule '"+o+"'");var u=this;this._CPF.compareObjsWithViewSetName(i,n,o,r,s,a).then((function(e){t.dbgout("CW2 reports build/drop IDs successful.")}),(function(i){t.errout("CW2 reports  build/drop IDs FAILED :"+i),i.stack&&t.errout("STACK: "+i.stack),u._eventMgr.publish({event:"Event_CW2_RESET_TO_INPUT"}),e.showAlertBox("Compare failed",l,"error",!0)}))},p.prototype.onWidgetPrefsUpdate=function(){null!=this._ccm&&this._ccm.init(!0)},p})),define("DS/CompareWidget2/CompareWidget2",["DS/LifecycleServices/LifecycleServicesSettings","DS/CompareWidget2/cw2","DS/CompareWidget2/userSettings/UserSettingsManager","DS/LifecycleServices/LifecycleServices","DS/CompareCommon/Utils"],(function(e,t,i,n,o){"use strict";var r=null,s=function(){this._cw2=null};s.prototype._load=function(i){i=i||{};let r=this;widget._isODTMode=()=>"cw2_unittest_client"===widget.id,widget._isODTMode()&&widget.getValue("runOptions")&&(i=widget.getValue("runOptions")),e.app_initialization((function(){let s=i.compareWrapper?i.compareWrapper:(widget.body.innerHTML="",widget.body);i.isODT=widget._isODTMode();var l={configPath:"DS/CompareWidget2/userSettings/VPMReference"};"MERGE"===i.app||"NRF"===i.app?l.configPath="DS/CompareMergePlugin/userSettings/Merge":"string"==typeof i.userSettingsConfig&&i.userSettingsConfig.length&&(l.configPath=i.userSettingsConfig),require(["DS/CompareWidget2/userSettings/UserSettingsManager"],(e=>{e.loadSettingsFromConfigPromise(l).then((()=>{r._cw2=new t(s,i);var e=r._cw2.getWidgetTitle();if(null==e||0==e.length){var n=r._cw2.getAppName();e="COMPARE"!=n?" ("+n+")":""}widget._isODTMode()&&Object.assign(a,{_getCW2ODTAck:function(){return r._cw2.forODT.getAck()},_getCPF:function(){return r._cw2._CPF},_getcw2:function(){return r._cw2}}),widget.setTitle(e)}),(()=>{console.error("COMPARE widget failed to load user settings... cannot continue.")}))})),widget.isWebInWin;var u=e.getOption("platform_services",null);null!=u&&u.length>0&&Array.isArray(u)&&u.forEach((function(e){null!=e&&e.hasOwnProperty("platformId")&&n.getSecurityContextList(e.platformId,(function(){var e=widget.getValue("X3DContentId");if(null!=e&&""!==e){var t=JSON.parse(e);void 0!==t.appContextId&&null!==t.appContextId&&""!==t.appContextId&&o.setCredentialsToWidget(t.appContextId)}}))}))}))},s.prototype.reloadWith=function(e){this._cw2._handler_inputUpdate(e)},s.prototype.resize=function(){},s.prototype.viewChange=function(){},s.prototype.refresh=function(){void 0!==this._cw2&&null!==this._cw2&&this._cw2.refresh()},s.prototype.edit=function(){},s.prototype.endEdit=function(){var e=widget.getPreferences();this._cw2.onWidgetPrefsUpdate(),e.forEach((e=>{i.hasPref(e.name)&&i.get(e.name)!==widget.getValue(e.name)&&i.set(e.name,widget.getValue(e.name))}))};var a={onLoad:function(e){null==r?r=a.createInstance(e):r.reloadWith(e.objIDSpecArray)},createInstance:function(e){let t=new s;return t._load(e),t},reloadWith:function(e){null!=r&&r.reloadWith(e)},onResize:function(e){null!=r&&r.resize(e)},onViewChange:function(e){null!=r&&r.viewChange(e)},onRefresh:function(e){null!=r&&r.refresh(e)},onEdit:function(){null!=r&&r.edit()},endEdit:function(){null!=r&&r.endEdit()}};return a}));