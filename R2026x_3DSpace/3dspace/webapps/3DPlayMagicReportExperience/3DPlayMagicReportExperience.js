define("DS/3DPlayMagicReportExperience/utils/Utils",["UWA/Class","DS/WAFData/WAFData","DS/PlatformAPI/PlatformAPI"],(function(e,t,i){"use strict";return e.extend({name:"MagicExperienceUtils",init:function(e){this._logger=Logger.getLogger(this.name),this._parent(e)},_getBranchIDFromCID:function(e){var t=e.split("/");if(!(t.length<2))return t[1];this._logger.error("wrong contenturl format for "+e)},fetch:function(e){this._logger.log("fetch",e);var t=this,i=e,s=e.url+"/cvservlet/fetch/v2?SecurityContext="+e.securityContext+"&tenant="+e.tenant;i.headers||(i.headers={});var n=i.data;delete i.data;var r=UWA.extend({label:t._getRequestLabel(),physicalid:e.physicalid,locale:t._getLanguage(),tenant:e.tenant,select_predicate:e.select_predicate,select_file:e.select_file},n);return t._POST(i,s,r)},fetchDB:function(e){this._logger.log("fetchDB",e);var t=e,i=e.url+"/resources/v1/modeler/dsmbse/dsmbse:Model/search?tenant="+e.tenant+"&$serializerVersion=4.0.0";t.mask?i+="&$mask="+t.mask:i+="&$mask=dsmvmbse:ModelMask.basic",t.fields?i+="&$fields="+t.fields:i+="&$fields=dsmvmbse:ModelContentType",t.headers||(t.headers={}),t.headers.SecurityContext=e.securityContext;var s={condition:"and",rules:[{field:"dsmvmbse:cid",operator:"=",value:e.physicalid}]};return this._POST(t,i,s)},_POST:function(e,i,s){var n=this._getLanguage(),r=e;return r.method="POST",UWA.is(r.headers)||(r.headers={}),r.headers.Accept="application/json",r.headers["Content-Type"]="application/json",r.headers["Accept-Language"]=n,r.data=JSON.stringify(s),"zh"===n&&(r.headers["Accept-Language"]+="_CN"),t.authenticatedRequest(i,r)},_getLanguage:function(){var e;widget&&widget.lang?e=widget.lang:e=(navigator?navigator.language||navigator.systemLanguage:"en").toLowerCase().split("-")[0];return e},_getUser:function(){return i.getUser()},_getUserLogin:function(){var e=this._getUser(),t="";return void 0!==e&&(t=e.login),t},_getAppId:function(){if("undefined"!=typeof widget)return widget.getValue("x3dAppId")?widget.getValue("x3dAppId"):widget.getValue("appId")},_getRequestLabel:function(){return this._getUserLogin()+"-"+this._getAppId()+"-"+Date.now()}})})),define("DS/3DPlayMagicReportExperience/utils/Preferences",["UWA/Core"],(function(e){"use strict";return{buildPreferences:function(){this._addDevEnvPreference(),this.addUrlParamsPreference()},_addDevEnvPreference:function(){this.isDevEnv()&&!e.is(widget.getValue("iframemockup"))&&widget.addPreference({name:"iframemockup",type:"boolean",label:"iFrame Mockup",defaultValue:!1})},addUrlParamsPreference:function(){e.is(widget.getValue("collaborator_url"))||widget.addPreference({name:"collaborator_url",type:"hidden"})},isDevEnv:function(){return e.is(localStorage.getItem("catmbse-devenv"))},isMockupMode:function(){return widget.getValue("iframemockup")},saveUrl:function(e){widget.setValue("collaborator_url",e)},getSavedUrl:function(){return widget.getValue("collaborator_url")}}})),define("DS/3DPlayMagicReportExperience/Wrapper",["UWA/Core","UWA/Class/Promise","UWA/Utils","DS/Logger/Logger","UWA/Class/Events","DS/3DPlayMagicReportExperience/utils/Preferences"],(function(e,t,i,s,n,r){"use strict";var o=e.Class.extend(n,r,{name:"Wrapper",isFramedMode:!0,parentDomain:null,iframe:null,forwardedParentMessages:{},widget:null,isNavigating:!1,iframeURLs:[],lightbox:null,_logger:null,_callbacks:null,messagePrefix:null,init:function(e){var t,i;this._logger=s.getLogger(this.name),this.isFramedMode=void 0!==e.widgetDomain,this.parentDomain=(t=this.isFramedMode?e.widgetDomain:window.location.href,(i=window.document.createElement("a")).href=t,i.origin?i.origin:i.protocol+"//"+i.host),this.registerEvents(e),this.widget=e},clear:function(){this.postMessage("mbse:clear",{}),this.iframe&&this.iframe.remove&&this.iframe.remove(),this.iframe=null,this.widget=null,this.isNavigating=null,this.iframeURLs=[],this.lightbox=null},setLightbox:function(e){this.lightbox=e},setCallbacks:function(e){this._callbacks=e},createMessageSignature:function(e){return(e||"")+(new Date).getTime()+"."+Math.floor(1e3*Math.random())+"."+Math.floor(1e3*Math.random())},_createIframe:function(t,s,n,r){this._logger.debug("_createIframe",arguments);var o={class:"systemmodel-experience-web-control",src:"about:blank",width:"100%",height:"100%",scrolling:"auto",frameborder:0,id:"frame-"+i.getUUID()};this.iframe=new e.Element("iframe",o),r&&(this.iframe.onerror=r.bind(this)),n&&(this.iframe.onload=n.bind(this)),s&&(this.iframe.src=s),this.iframe.inject(t)},registerEvents:function(e){e.addEvents({onRefresh:this.refresh.bind(this),onResize:this.resizeView.bind(this)})},getViews:function(){this._logger.debug("getViews"),this.postMessage(this.messagePrefix+"views:get")},setActiveView:function(e){this._logger.debug("setActiveView",e),this.postMessage(this.messagePrefix+"activeview:set",{viewId:e})},setActivePerspective:function(e){this._logger.debug("setActivePerspective",e),this.postMessage(this.messagePrefix+"activeperspective:set",e)},onIframeReady:function(e){this._logger.debug("onIframeReady ["+this.messagePrefix+"]",e),this.getViews(),this._callbacks&&this._callbacks.onIframeReady&&this._callbacks.onIframeReady.call(null,e)},onIframeError:function(e){this._logger.debug("onIframeError ["+this.messagePrefix+"]"),this._logger.error("error:"+e.code+", reason:"+e.reason),this._callbacks&&this._callbacks.onIframeError&&this._callbacks.onIframeError.call(null,e)},onSetViews:function(e){this._logger.debug("onSetViews",e),this._callbacks&&this._callbacks.onSetViews&&this._callbacks.onSetViews.call(null,e.views)},onUrlSet:function(e){this._logger.debug("onUrlSet",e),this.saveUrl(e.url),this._enableBackButton(e.isBackAvailable),this._enableForwardButton(e.isForwardAvailable),e.viewId&&this._updateSelectedView(e.viewId,"views"),e.viewType&&this._updateSelectedView(e.viewType,"perspectives")},_enableBackButton:function(e){if(this.lightbox){var t=this.lightbox._lightbox.customActions.find((e=>"goback"===e.name));t&&t.disabled!==!e&&(t.disabled=!e),this.lightbox.update()}},_enableForwardButton:function(e){if(this.lightbox){var t=this.lightbox._lightbox.customActions.find((e=>"goforward"===e.name));t&&t.disabled!==!e&&(t.disabled=!e),this.lightbox.update()}},_updateSelectedView:function(e,t){var i=null;this.lightbox&&(this.lightbox._customMoreActions.forEach((function(s){s.hasOwnProperty("selected")&&s.section===t&&(s.selected=!1),s.name===e&&(i=s)})),i&&(i.selected=!0),this.lightbox.update())},goBack:function(){this.postMessage(this.messagePrefix+"navigation:back")},goForward:function(){this.postMessage(this.messagePrefix+"navigation:forward")},showTree:function(e){this._logger.debug("showTree",e),this.postMessage(this.messagePrefix+"navigationTree:set",!e)},onShowTree:function(e){this._callbacks&&this._callbacks.onShowTree&&this._callbacks.onShowTree.call(null,e.state)},load:function(e,t,i,s){return this.url=e,null!==this.iframe&&null!=this.iframe?this.iframe.src=this.url:this._createIframe(t,this.url,i,s),this.iframe},postMessage:function(e,t,i){this.iframe&&this.iframe.contentWindow&&this.iframe.contentWindow.postMessage({topic:e,payload:t,signature:i},this.iframe.src)},receiveMessage:function(t){if(this.iframe){try{var i=e.is(t.data,"string")?JSON.parse(t.data):t.data;if(!i)return}catch(e){return}var s=i.topic,n=i.payload;if(!s)return void this._logger.warn("Message topic is undefined:",i);s==this.messagePrefix+"ready"?(this._logger.debug(s+" received",n),this.onIframeReady(n)):s==this.messagePrefix+"views:set"?(this._logger.debug(s+" received",n),this.onSetViews(n)):s==this.messagePrefix+"url:set"?(this._logger.debug(s+" received",n),this.onUrlSet(n)):s==this.messagePrefix+"navigationTree:state"?(this._logger.debug(s+" received",n),this.onShowTree(n)):s==this.messagePrefix+"error"&&(this._logger.debug(s+" received",n),this.onIframeError(n)),this.forwardToChild(s,n)}},setMessageForwarding:function(e){e.topic&&(this.forwardedParentMessages[e.topic]=!!e.enabled)},forwardToChild:function(e,t){!0===this.forwardedParentMessages[e]&&this.postMessage(e,t)},forwardToParent:function(e){(this.isFramedMode?window.parent:window).postMessage(JSON.stringify(e),this.parentDomain)},resizeView:function(e){this._logger.debug("resizeView",e)},refresh:function(e){this._logger.debug("resizeView",e)},setMessagePrefix:function(e){this.messagePrefix=e,this._logger.debug("setMessagePrefix",e)}}),a=new o(widget);return window.addEventListener("message",a.receiveMessage.bind(a),!1),a})),define("DS/3DPlayMagicReportExperience/3DPlayMagicReportExperience",["UWA/Core","UWA/Class/Events","DS/WebappsUtils/WebappsUtils","DS/3DPlay/3DPlay","DS/3DPlay2DExperience/3DPlay2DExperience","DS/WebSystem/Environment","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/Logger/Logger","DS/3DPlayMagicReportExperience/Wrapper","DS/3DPlayMagicReportExperience/utils/Preferences","DS/3DPlayMagicReportExperience/utils/Utils","i18n!DS/3DPlay/assets/nls/3DPlay","css!DS/3DPlayMagicReportExperience/3DPlayMagicReportExperience.css","i18n!DS/3DPlayMagicReportExperience/assets/nls/3DPlayMagicReportExperience"],(function(e,t,i,s,n,r,o,a,l,d,h,c,g,u){"use strict";var f=n.extend(t,d,h,{_logger:null,contextId:null,platformId:null,contentUrl:null,serverUrl:null,serviceId:null,pad3DViewer:null,frmWindow:null,attributes:{},name:"3DPlayMagicReportExperience",defaultOptions:{visu:{showReferenceAxisSystem:!1},ui:{displayActionBar:!1,displayTree:!1},showBubbleMenu:!1},_onLoadingFinishedToken:null,_onLightboxReadyToken:null,_loadedData:null,_appTransitionInfo:null,defaultExperience:!1,elements:{},_isIframeReady:!1,messagePrefix:"mbse:collaborator:",init:function(e){this._logger=a.getLogger(this.name),this._parent(e),e.workbenchs=[],this.options=e,this._hasLightbox=widget.hasOwnProperty("hasLightbox")&&widget.hasLightbox,this.options.input&&"OnPremise"===this.options.input.tenantID?this.setDefaultExperience(!0):this._hasLightbox?(e.workbenchs.push({name:"RightPanel_LightboxMode",module:"3DPlay2DExperience"}),this.buildPreferences()):this.setDefaultExperience(!0)},setDefaultExperience:function(e){this.defaultExperience=e},isDefaultExperience:function(){return this.defaultExperience},onPreCreate:function(){this._parent(),this._logger.log("onPreCreate",arguments),this.args=e.extend(this.defaultOptions,this.args,!0),this.isDefaultExperience()||(this.args.ui={keepActionbarClosed:!0})},loadAsset:function(e){this._logger.log("loadAsset",e),this._hasLightbox?e&&e.asset&&e.asset.physicalid&&this.internalLoad&&(this.clearView(),this.internalLoad(e)):(this._logger.debug("no lightbox available, displaying default experience"),this.setDefaultExperience(!0),this._onNoExperienceFound())},_onLoadFail:function(e){this._logger.log("_onLoadFail"),this.loadAssetInfo={},s.displayFatalError({ctx:this.ctx,msg:"Error while loading the Experience"},{name:null!=e?e:"LoadingError_LOAD"}),this.publish("ASSET/LOADINGERROR",{ctx:this.args.ctx,loadAssetInfo:{}})},_onNoExperienceFound:function(){this._logger.log("_onNoExperienceFound"),this.loadAssetInfo={},this._setTitle(),s.displayFatalError({ctx:this.ctx,msg:c.BadDType,error:"BadDType"}),this.publish("ASSET/LOADINGERROR",{ctx:this.args.ctx})},onPostCreate:function(){this._logger.log("onPostCreate");widget&&widget.setMetas({helpPath:"3DPlayMagicReportExperience/assets/help"}),this.internalPostCreate&&this.internalPostCreate(),window.addEventListener("resize",this._onWindowResize.bind(this))},_onWindowResize:function(){window.innerWidth<600?this._toggleLightboxClass(!1):this._toggleLightboxClass(!0)},internalPostCreate:function(){this._logger.log("internalPostCreate");var e=this;this.frmWindow&&this.frmWindow.getActionBar()&&this.frmWindow.getActionBar().onActionBarReady((()=>{e.frmWindow.getActionBar().close(),e.frmWindow.getActionBar().MAB.showNone()}))},_hideActionBar:function(e){var t;this.frmWindow&&this.frmWindow.getActionBar()&&(e?(this.frmWindow.getActionBar().getContent().addClassName("sysmod-hide-actionbar"),(t=this.frmWindow.getContent().getElement('[data-type="action-bar"]'))&&t.addClassName("sysmod-hide-actionbar")):(this.frmWindow.getActionBar().getContent().removeClassName("sysmod-hide-actionbar"),(t=this.frmWindow.getContent().getElement('[data-type="action-bar"]'))&&t.removeClassName("sysmod-hide-actionbar")))},_getSystemModel:function(){this._logger.log("_getSystemModel");var t=this;t.fetch({url:t.serverUrl,tenant:t.platformId,securityContext:t.contextId,physicalid:t.contentUrl,select_predicate:["ds6w:kind","ds6w:type","ds6w:label","ds6w:globalType","ds6w:identifier","ds6w:cadVersion","ds6wg:revision","ds6w:modified","ds6w:policy","ds6w:project","ds6w:organizationresponsible","bo.SystemModel.UUID"],select_file:["icon","thumbnail_2d"],onComplete:function(i){if(""!==i&&e.is(i)){var s=e.is(i,"string")?JSON.parse(i):i;0===s.infos.nresults||s.infos.nresults>1?(t._logger.warn("No result from index, fallback to DB call"),t._getSystemModelDB()):1===s.infos.nresults&&(t._getAttributesFromFetchResult(s),t._launchExperience())}else t._logger.warn("Empty result from index, fallback to DB call"),t._getSystemModelDB()},onFailure:function(){t._logger.warn("Index call failed, fallback to DB call"),t._getSystemModelDB()}})},_getSystemModelDB:function(){this._logger.log("_getSystemModelDB");var t=this;t.fetchDB({url:t.serverUrl,tenant:t.platformId,securityContext:t.contextId,physicalid:t.contentUrl,onComplete:function(i){if(""!==i&&e.is(i)){var s=e.is(i,"string")?JSON.parse(i):i;0===s.models.length?(t._logger.error("no model found in DB"),t._onLoadFail(c.LoadingDocument404)):1===s.models.length?(t._getAttributesFromFetchDB(s),t._launchExperience()):(t._logger.error("DB call returned more than one result"),t._onLoadFail(c.LoadingError_UNEXPECTED))}else t._logger.error("DB call returned an empty payload"),t._onLoadFail(c.LoadingError_UNEXPECTED)},onFailure:function(){t._logger.error("DB call failed"),t._onLoadFail(c.LoadingError_UNEXPECTED)}})},_setHeaderIcon:function(e){this._logger.log("_setHeaderIcon");var t={icon:e,backgroundColor:"#70036b"};this.lightbox&&this.lightbox.setObjectType(t)},_onLoadingFinished:function(e){this._logger.log("_onLoadingFinished",e);this.isDefaultExperience()||this.addActions()},addViewsToMoreMenu:function(e){this._logger.log("addViewsToMoreMenu");var t=this;if(this.lightbox){this.lightbox.addActionToMoreMenu({name:"views",label:u.Views,class:"header"});var i=[];e.forEach((function(e){e.section="views",i.push({name:e.viewId,data:e.viewId,label:e.name,selected:e.isActive,section:e.section,handler:t._setActiveItem.bind(t,e,"view")})})),this._addMoreActions(i)}},addPerspectivesToMoreMenu:function(){this._logger.log("addPerspectivesToMoreMenu");var e=this;if(this.lightbox){var t=[{name:"perpectives",label:u.Perspectives,class:"header"},{name:"model",label:u.Model,data:"model",fonticon:"browsing-structure",selected:!0,section:"perspectives"},{name:"document",label:u.Document,data:"document",fonticon:"doc",selected:!1,section:"perspectives"},{name:"wiki",label:u.Wiki,data:"wiki",fonticon:"book-open",selected:!1,section:"perspectives"}];t.forEach((t=>{"header"!==t.class&&(t.handler=e._setActiveItem.bind(e,t,"perspective"))})),this._addMoreActions(t)}},_setActiveItem:function(e,t){"view"===t?this.wrapper.setActiveView(e.viewId):"perspective"===t&&this.wrapper.setActivePerspective(e.data)},_addMoreActions:function(e){this.lightbox&&(e.forEach((e=>{var t={name:e.name,label:e.label};e.hasOwnProperty("fonticon")&&(t.fonticon=e.fonticon),e.hasOwnProperty("hidden")&&(t.hidden=e.hidden),e.hasOwnProperty("selected")&&(t.selected=e.selected),e.hasOwnProperty("section")&&(t.section=e.section),e.hasOwnProperty("handler")&&(t.handler=e.handler),e.hasOwnProperty("class")&&(t.class=e.class),this.lightbox.addActionToMoreMenu(t)})),this.lightbox.update())},removeMoreMenuActions:function(){this._logger.log("removeMoreMenuActions");this.lightbox&&this.lightbox._customMoreActions&&(this.lightbox._customMoreActions=[],this.lightbox.update())},addActions:function(){this._logger.log("addActions");var e=this;this.lightbox&&this.lightbox&&this.lightbox.addAction&&(this.lightbox.addAction({name:"goback",label:u.Back,fonticon:"left wux-ui-3ds",disabled:!0,handler:function(){e.wrapper.goBack()}}),this.lightbox.addAction({name:"goforward",label:u.Forward,fonticon:"right wux-ui-3ds",disabled:!0,handler:function(){e.wrapper.goForward()}}))},removeActions:function(){this._logger.log("removeActions");this.lightbox&&this.lightbox&&this.lightbox.length>0&&this.lightbox.customItems&&(this.lightbox.customItems=[],this.lightbox.update())},_setTitle:function(){this._logger.log("_setTitle");var t=this.attributes["ds6w:label"],i=this.attributes["ds6wg:revision"];if(e.is(t)&&e.is(i)){var s=t+" | "+i;this.loadAssetInfo.displayname=s}},_launchExperience:function(){this._logger.log("_launchExperience");this.landingPage&&this.landingPage.hide(),this.subType=this._getSubType(),"OnPremise"===this.platformId?(this._logger.error("experience not supported OnPremise"),this.setDefaultExperience(!0),this._onNoExperienceFound()):e.is(this._getResourceID())?(this.playerSplashScreen&&this.playerSplashScreen.show(),this.getPhaseProgress()&&this.getPhaseProgress().showProgressBar(),this.setDefaultExperience(!1),this._subcribeToAssetEvents(),this._subscribeToLightboxEvents(),this._setTitle(),this._launchIframeExperience()):(this.setDefaultExperience(!0),this._onLoadFail(c.LoadingDocument404))},_subcribeToAssetEvents:function(){this._logger.log("_subcribeToAssetEvents"),this._onLoadingFinishedToken||(this._onLoadingFinishedToken=this.subscribeOnce("ASSET/LOADINGFINISHED",this._onLoadingFinished.bind(this),!0))},_subscribeToLightboxEvents:function(){this._logger.log("_subscribeToLightboxEvents")},_launchIframeExperience:function(){this._logger.log("_launchIframeExperience");var e=this;this._loadedData={id:this.contentUrl,contextId:this.contextId,platformId:this.platformId},o.getServiceUrl({serviceName:"mbseapps",platformId:e.platformId,onComplete:function(t){null!=t?e._buildIframe(t):(e._logger.error("not able to retrieve mbseapps service url"),e._onLoadFail(c.PlatformNotFound))},onFailure:function(){e._logger.error("not able to retrieve mbseapps service url"),e._onLoadFail(c.PlatformNotFound)}})},_toggleLightboxClass:function(e){var t=document.querySelector(".vu-lightbox");t?e?t.classList.contains("sysmod-lightbox-dropdown")||t.classList.add("sysmod-lightbox-dropdown"):t.classList.contains("sysmod-lightbox-dropdown")&&t.classList.remove("sysmod-lightbox-dropdown"):this._logger.log("Lightbox element not found")},_buildIframe:function(t){var i,s=this;this._logger.log("_buildIframe",t),this.publish("EXPERIENCE/EXPERIENCEREADY",this),i=this.isMockupMode()?s._buildMockupUrl():s._buildUrl(t),this.elements.container=e.createElement("div",{class:"systemmodel-experience"}),this.initDropHandler(),this.elements.container.inject(this.frmWindow.getViewerFrame()),this.wrapper=l,this.wrapper.setMessagePrefix(this.messagePrefix),this.wrapper.setLightbox(this.lightbox),this.wrapper.setCallbacks({onIframeReady:this._onIframeReadyCB.bind(this),onIframeError:this._onIframeErrorCB.bind(this),onSetViews:this._onSetViews.bind(this),onShowTree:this._onShowTree.bind(this)}),this.elements.iframe=this.wrapper.load(i,this.elements.container,(function(){s._logger.log("iframe onLoad callback")}),(function(){s._logger.log("iframe onError callback")})),this._toggleLightboxClass(!0),this._iframeTimeout=setTimeout((function(){s._isIframeReady||(s._logger.error("Collaborator took more than 20s to answer",i),s.internalClear(),s.setDefaultExperience(!0),s._onNoExperienceFound(),s._handleNotification({ctx:s.args.ctx,eventID:"error",msg:u.error.timeout}))}),2e4)},_initTreeCollapser:function(t){this.elements.leftdockingelement=e.createElement("div",{class:"wux-controls-abstract wux-windows-docking-element wux-docking-element-left sysmod-tree"});var i=e.createElement("div",{class:"sysmod-tree-collapser"});this.elements.leftdockingelement.inject(i),this.elements.leftdockingelement.addEventListener("click",this._onTreeCollapserClick.bind(this)),i.inject(t)},_onTreeCollapserClick:function(){this.elements.leftdockingelement.toggleClassName("collapsed");let e=this.elements.leftdockingelement.hasClassName("collapsed");this.wrapper.showTree(e)},_onShowTree:function(t){if(e.is(t)){var i=this.elements.leftdockingelement.hasClassName("collapsed");"OPEN"===t&&i?this.elements.leftdockingelement.toggleClassName("collapsed"):"CLOSE"!==t||i||this.elements.leftdockingelement.toggleClassName("collapsed")}},_onIframeReadyCB:function(){this._isIframeReady=!0,this.publish("ASSET/LOADINGFINISHED",{time:0,ctx:this.args.ctx,loadAssetInfo:this.loadAssetInfo||{}}),this._hideActionBar(!0)},_onIframeErrorCB:function(e){this._isIframeReady||(this.internalClear(),this.setDefaultExperience(!0),this._onNoExperienceFound()),this._handleNotification({ctx:this.args.ctx,eventID:"error",msg:e.message||e.reason})},_onSetViews:function(e){this.addPerspectivesToMoreMenu(),this.addViewsToMoreMenu(e),Array.isArray(e)&&e.length>0&&this._initTreeCollapser(this.elements.container),this.playerSplashScreen&&this.playerSplashScreen.hide(),this.getPhaseProgress()&&this.getPhaseProgress().hideProgressBar()},initDropHandler:function(){this.drop||(this.drop={Handle:e.createElement("div",{id:"drop-handle",styles:{position:"absolute",top:"0px",left:"0px",right:"0px",bottom:"0px",display:"none","z-index":"10","background-color":"transparent",opacity:"0.4"}}),enableHandle:function(e){this.Handle.setStyle("display","block")},disableHandle:function(e){this.Handle.setStyle("display","none"),this.Handle.setStyle("background-color","transparent")},trapEvent:function(e){e.preventDefault(),e.stopPropagation(),"dragleave"!==e.type&&this.Handle.setStyle("background-color","rgb(249, 249, 249)")}}),this.frmWindow.getViewerFrame().grab(this.drop.Handle),this.elements.container.addEventListener("mouseenter",this.drop.disableHandle.bind(this.drop)),this.elements.container.addEventListener("mouseover",this.drop.disableHandle.bind(this.drop)),this.elements.container.addEventListener("mousedown",this.drop.disableHandle.bind(this.drop)),this.elements.container.addEventListener("wheel",this.drop.disableHandle.bind(this.drop)),this.elements.container.addEventListener("mouseleave",this.drop.enableHandle.bind(this.drop)),this.drop.Handle.addEventListener("mousedown",this.drop.disableHandle.bind(this.drop)),this.drop.Handle.addEventListener("mousemove",this.drop.disableHandle.bind(this.drop)),this.drop.Handle.addEventListener("wheel",this.drop.disableHandle.bind(this.drop))},_getAttributesFromFetchResult:function(e){if(e&&e.results&&1==e.results.length)for(var t=e.results[0].attributes,i=0;i<t.length;i++){var s=t[i];this.attributes[s.name]=s.value}},_getAttributesFromFetchDB:function(e){if(e&&e.models&&1==e.models.length){var t=e.models[0].attributes,i=e.models[0].branch;this.attributes["ds6w:kind"]=t.contentType,this.attributes["ds6w:identifier"]=t.name,this.attributes["ds6w:label"]=t.title,this.attributes["ds6w:type"]=t.type,this.attributes["bo.SystemModel.UUID"]=t.uuid,this.attributes["ds6wg:revision"]=i}},_getSubType:function(){return this.attributes["ds6w:kind"]},_getResourceID:function(){return this.contentUrl},_getFormattedUUID:function(e){var t=this._getResourceID();if(!t)return null;var i=new RegExp(e+"([A-F0-9]{32})","i"),s=t.match(i);if(s&&s[1]){var n=s[1].toLowerCase();return n.substring(0,8)+"-"+n.substring(8,12)+"-"+n.substring(12,16)+"-"+n.substring(16,20)+"-"+n.substring(20)}return null},_buildUrl:function(t){this._logger.log("_buildExperienceUrl",t);var i,s=t,n=this._getFormattedUUID("cid:"),r=this._getFormattedUUID("branch:"),o=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/.test(r),a=this.getSavedUrl();return i=o?"/collaborator/document/"+n+"/branch/"+r+"?viewType=model&viewId=&sectionId=":"/collaborator/document/"+n+"?viewType=model&viewId=&sectionId=",e.is(a)&&a.includes(n)&&a.includes(r)?s+=a:(s+=i,this.saveUrl(i)),s},_buildMockupUrl:function(){var t=i.getProxifiedWebappsBaseUrl();t||(t=i.getWebappsBaseUrl());var s=this.getSavedUrl(),n="iFrameContentMockup/index.html?viewType=model&sectionId=sectionId01&viewId=viewId01";return e.is(s)?t+=s:(t+=n,this.saveUrl("/"+n)),t},internalLoad:function(e){this._logger.log("internalLoad");var t=this;this.contextId=e.asset.contextid||e.asset.contextId,r.get("PreferredCredentials")&&(this.contextId=r.get("PreferredCredentials")),this.platformId=void 0!==e.tenantID&&null!=e.tenantID?e.tenantID:e.asset.tenant,this.contentUrl=e.asset.physicalid,this.serverUrl=e.asset.serverurl||e.asset.serverUrl,this.serviceId=e.asset.serviceId,null!=this.serverUrl&&"3DSpace"===t.serviceId?this._getSystemModel():o.getServiceUrl({serviceName:"3DSpace",platformId:t.platformId,onComplete:function(e){t.serverUrl=e,t.serviceId="3DSpace",t._getSystemModel()},onFailure:function(){options.container.innerHTML="Error get server URL\n"}})},acceptSwitch:function(e){this._logger.log("acceptSwitch");return!1},refresh:function(){return this._logger.log("refresh"),this.internalRefresh&&this.internalRefresh(),!0},internalRefresh:function(){this._logger.log("internalRefresh")},dispose:function(e){this._logger.log("dispose"),widget&&widget.setMetas({helpPath:void 0}),this.internalDispose&&this.internalDispose(this._appTransitionInfo||""),this._appTransitionInfo=null,this._parent(e)},internalDispose:function(e){this._logger.log("internalDispose"),this.internalClear&&this.internalClear(),this._loadedData=null,this.saveUrl(null)},clearView:function(){this.internalClear(),this._parent()},internalClear:function(){this._logger.log("internalClear"),this._toggleLightboxClass(!1),this._hideActionBar(!1),this.removeActions(),this.removeMoreMenuActions(),this._iframeTimeout&&(clearTimeout(this._iframeTimeout),this._iframeTimeout=null),this.getPhaseProgress()&&this.getPhaseProgress().hideProgressBar(),this.wrapper&&this.wrapper.clear&&this.wrapper.clear(),this.elements.container&&this.elements.container.remove&&this.elements.container.remove()}});return f}));