define("DS/SNXAppComponent/SNWebAfrXAppComponent",["UWA/Core","UWA/Utils/InterCom","DS/CSICommandBinder/CSICommandBinder"],(function(e,t,n){"use strict";const o="A2X-PLMChooser-3DSearch-InterCom";return class{constructor(e){console.log("SNWebAfrXAppComponent constructor: ",e),this._socket=new t.Socket(o,{dispacthRetryInterval:0}),this._socket.subscribeServer("SearchComServer")}initialize(){var t=this;console.log("SNWebAfrXAppComponent initialize: ");const n=this.getExecutionContext().getComponent(WAfrStandardComponentKey.A2XClientComponent);n.getSessionId();n.subscribe("PLMChooserA2XEvent",(n=>{console.log("SNWebAfrXAppComponent PLMChooserEvent: ");var o,s=n.readString("preCondition");o=e.is(s,"string")?JSON.parse(s):s,e.is(o)&&t._searchInContext(o).then((function(e){var n=e;console.log("SNWebAfrXAppComponent SelectedObject for Chooser is : ",n),t._transmitSelectedObj(n)}))}))}clean(){console.log("SNWebAfrXAppComponent clean: ")}destroy(){console.log("SNWebAfrXAppComponent destroy: "),this._socket.unsubscribeServer("SearchComServer"),this._socket=null}_searchInContext(t){let n=this;return new Promise((function(o,s){let r=n._getInContextOptions(t);n._socket.addListener("RegisterContext_Response",(function(){n._socket.addListener("InContextSearch_Response",(function(t){if(e.is(t)){let n={command:t.selected_command};if("in_app_ok"===t.selected_command&&e.is(t.selected_objects,"array")){let e=t.selected_objects.length,o=[];for(let n=0;n<e;n++)o.push(t.selected_objects[n].resourceid);n.selected_ids=o}o(n)}}),(function(){s("no object selected, cancel clicked")})),n._socket.addListener("onCloseTransient",n._cleanUpContext.bind(n)),n._socket.dispatchEvent("InContextSearch",r)}),(function(){s("A2X InContext is not activated"),n._socket.addListener("onCloseTransient",n._cleanUpContext.bind(n))})),n._socket.dispatchEvent("RegisterContext",r)}))}_getInContextOptions(e){return{widget_id:widget.id,app_socket_id:o,title:"3DSearch results",default_search_criteria:"",search_criteria_to_display:"",precond:e.precond,default_with_precond:!0,mode:"furtive",multiSel:!0,search_criteria_to_display:"",tenant:widget.getValue("x3dPlatformId")}}_searchSelecteObj(e,t){console.log("In _searchSelecteObj");let n=this;return new Promise((function(e,o){"in_app_ok"===t.selected_command?(n._selectedLabel=t.selected_objects[0]["ds6w:label"],n._selectedId=t.selected_objects[0].resourceid,e(n._selectedId)):o()}))}_cleanUpContext(){this._socket.dispatchEvent("UnregisterContext",{widget_id:widget.id}),this._socket.removeListener("RegisterContext_Response"),this._socket.removeListener("onCloseTransient")}_transmitSelectedObj(e){const t=JSON.stringify(e);console.log("SNWebAfrXAppComponent _transmitSelectedObj: ",t);const o=this.getExecutionContext().getComponent(WAfrStandardComponentKey.A2XClientComponent);if(o&&o.isConnected()){const e=new n.Parameters;e.writeString("selectedObj",t),o.call({name:"plmchooserA2XInit",version:1,parameters:e,onSuccess:function(){},onError:function(){}})}}}}));