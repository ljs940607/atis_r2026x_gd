/*!  Copyright 2025 Dassault Systemes. All rights reserved. */
define("DS/SPYAnim/DataDisplayAnimationAbstract",["UWA/Core"],(function(t){"use strict";return t.Class.extend({_getStepFromTime:function(t,e){let i,n=this.implementation.animationStructure;if(n&&n.activeGroupsTimeProjection){let e=n.activeGroupsTimeProjection,o=(t+=e[0].position)>this._lastTime&&this._lastProjectionIndex?this._lastProjectionIndex:0,s=e.length-1,r=function(t,e,i,n){let o=i,s=n;if(e<=t[o].position)return{idx:o,frame:t[o]};if(e>=t[s].position)return{idx:s,frame:t[s]};for(;s-o>1;){const i=Math.floor((o+s)/2);if(t[i].position===e)return{idx:i,frame:t[i]};t[i].position<e?o=i:s=i}let r=Math.abs(t[o].position-e)<=Math.abs(t[s].position-e)?o:s;return{idx:r,frame:t[r]}}(e,t,o,s);this._lastProjectionIndex=r.idx<s?r.idx:void 0,i=r.idx,this._lastTime=t}return i},init:function(){this.listObjectsToAnimate=[]},getImpl:function(){return this.implementation},isFrameLoaded:function(){console.error("SPYAnim - isFrameLoaded to be overloaded")},loadFrame:function(){console.error("SPYAnim - loadFrame to be overloaded")},initAnimation:function(){this._lastProjectionIndex=void 0,this._stepsRequested=new Map},animate:function(t,e){if(this.currentStep!==t&&this.implementation)if(this.isFrameLoaded(t)){this.currentStep=t,this.listObjectsToAnimate.forEach((i=>{i.animate(t,e)}));const i=this.implementation.spm.window;e&&e.navigateMode||i&&i.SPMUI&&i.SPMUI.updateTextures(t,!0,{animationScope:e.animationScope}),i.getViewer?i.getViewer().render():this._renderRequest&&this._renderRequest()}else{"loading"!==this._stepsRequested.get(t)&&(this._stepsRequested.set(t,"loading"),this.loadFrame(t,(()=>{this._stepsRequested.set(t,"loaded"),this.animate(t,e)})))}},stopAnimation:function(){const t=this.implementation.animationStructure.totalFrameNumber-1;
//! should be the last of the animationScope
this.animate(t)},getCurrentAnimationStep:function(){return this.currentStep},setActiveGroups:function(t){let e=this.implementation.getLegend();e&&e.setActiveGroups(t)},updateActiveGroupsTimeProjection:function(t){let e=this.implementation.getLegend();e&&e.updateActiveGroupsTimeProjection(t)},getFrameIndexFromPosition:function(t){let e,i=this.implementation.getLegend();return i&&(e=i.getFrameIndexFromPosition(t)),e},jumpTo:function(t,e){let i=this._getStepFromTime(t,e);this.animate(i)}})}));