define("DS/ENOXCADNonPSConnector/ENOXCADNonPSConnector",["DS/3DPlayConnectors/CAT3DPlayConnector","DS/VisuDataAccess/Ox4PLMDataHelper","DS/VisuDataAccess/Ox4XHRWithProxyAbstraction","DS/VisuDataAccess/Ox4TicketGeneratorTask"],(function(e,t,r,n){"use strict";var a=null,o=null,i=null,s=null,m=function(e,t,r){var n='<?xml version="1.0" encoding="utf-8"?>\n';return n+='<executeSequence xmlns="http://www.3ds.com/xmql/query">\n',n+="\t<execute>\n",n+="\t\t<function>query_bus</function>\n",n+="\t\t<version>2.0.0</version>\n",n+="\t\t<params>\n",n+='\t\t\t<param name="type">'+t+"</param>\n",n+='\t\t\t<param name="name">*</param>\n',n+='\t\t\t<param name="revision">*</param>\n',n+='\t\t\t<param name="vault">*</param>\n',n+='\t\t\t<param name="where">physicalid=='+e+"</param>\n",n+='\t\t\t<param name="select">'+JSON.stringify(r)+"</param>\n",n+='\t\t\t<param name="dump">,</param>\n',n+="\t\t</params>\n",n+="\t</execute>\n",n+="</executeSequence>\n"},l=function(e,t,n){var a,l,c,p,u,f,d,v=(a=e.physicalid,l=e.boType,{mqlCmd:m(a,l,["attribute[StreamDescriptors]","format.file.name","format.file.store"]),parseTCLRow:function(e){for(var t=/{{.*} {.*} {.*} {{(.*)}} {({.*})} {({.*})}}/.exec(e),r=t[1],n=t[2],o=t[3],m=r.split(":"),l=[],v=0;v<m.length;v++){var y=/SDv2\((.*),'(.*)',(.*),.*,.*,'(.*)','(.*)'\)/.exec(m[v]);l.push({format:y[1],role:y[2],lateType:y[3],persistancyType:y[4],persistancyName:y[5]})}for(var x=/{([^{}]*)}/g,S=null,h=[];null!==(S=x.exec(n));)h.push(S[1]);for(var T=[];null!==(S=x.exec(o));)T.push(S[1]);var D={name:"",store:""};for(v=0;v<l.length;v++){var N=l[v];void 0!==c&&c!==N.format||void 0!==p&&p!==N.role||void 0!==u&&u!==N.lateType||void 0!==f&&f!==N.persistancyType||void 0!==d&&d!==N.persistancyName||(i=N.persistancyType,s=N.persistancyName,""===D.name?(D.name=a+"_'"+N.role+"'."+N.format,N.persistancyName&&(D.name+="="+N.persistancyName),D.format=N.format):(D.tooManyFilesError=!0,D.name=""))}if(""!==D.name)for(v=0;""===D.store&&v<h.length;v++)D.name===h[v]&&(D.store=T[v]);return""!==D.name&&""!==D.store||(D.noStreamRetrieved=!0,D.name="",D.store=""),D}});(new r).executePostHttpRequest(o.xmqlServiceUri(),"application/xml",v.mqlCmd,(function(r){var a=v.parseTCLRow(r);a.tooManyFilesError?n("Too many streams retrieved"):a.noStreamRetrieved?n("No stream retrieved"):(a.physicalid=e.physicalid,void 0===a.format&&void 0!==e.format&&(a.format=e.format),void 0!==a.format?t(a):n("Stream format has to be specified"))}))},c=function(e){var m,c;null!==a&&null!==o&&o.url===e.serverUrl||(o={rawmode:!1,url:e.serverUrl},c=(m=o).url,m.xmqlServiceUri=function(){return c+"/i3dx/services/xmql"},m.threedexpServiceUri=function(){return c},r.useUWAProxy({proxymode:"passport"}),a=new t(o)),l(e,(function(t){var m,l,c,p;m=t,l=function(t){!function(e,t,r,n){if("posthttp"==e.slice(0,8)){var a=e.indexOf(":postparams:"),o=e.slice(9,a),m=e.slice(a+12,e.length);void 0!==s||null===s||void 0!==i||null===i?r({URLToFCS:o+"?"+m,FileName:s+"."+i}):n("Unable to correcty get the required information from the NonPSRepRef Object")}}(t,e.streamType,e.onInformationReceived,e.onInformationFailed)},e.onInformationFailed,c=a.transformSelectedFileIntoTicketRequest(m.physicalid,m.format,m.store,m.name),p=new n(c,o),(new r).asyncTransformFCSUrlIntoRealUrl(p.generateRequest(),!1,(function(e,t){l(t)}))}),e.onInformationFailed)};return e.extend({init:function(e){this._parent(e)},open:function(e,t,r){var n=e,a={serverUrl:n.serverurl,physicalid:n.physicalid,boType:n.type,format:"1",onInformationReceived:function(r){var n=r.URLToFCS,a=r.FileName,o={dtype:e.dtype,provider:"FILE",url:n,filename:a,requestsOptions:{authentication:"passport",proxy:"none",method:"POST"}};console.log("Calling 3DPlay for loading the experience"),t(o)},onInformationFailed:function(e){console.log("Non PS Representation Reference document:"+e);r({NLS_File:"3DPlay/Core",NLS_ID:"LoadingError_LOAD_ENTRY"})}};c(a)}})}));