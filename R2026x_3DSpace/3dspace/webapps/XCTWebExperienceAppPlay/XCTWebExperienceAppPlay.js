define("DS/XCTWebExperienceAppPlay/managers/CXPWebEventListenerManager",["UWA/Core","UWA/Class","DS/EP/EP","DS/MathematicsES/MathVector2DJSImpl","DS/VisuEvents/EventsManager","DS/EPInputsServicesWeb/EPInputsServices","DS/StuClickable/StuSpatialTapEvent","DS/StuClickable/StuSpatialDoubleTapEvent"],(function(e,t,n,r,i,a,o,s){"use strict";return t.extend({elementKeyBoard:document.body,elementTouch:null,Build:function(){this.viewer=this._experienceBase.webApplication.frmWindow.getViewer(),this.elementTouch=this.viewer.div},_getInputServices:function(){return this._inputServices||(this._inputServices=new a),this._inputServices},start:function(){var t=this;if(this._eventsArray)return void e.log("CXPWebEventListenerManager already started");var a=this._getInputServices();a.enableKeyboard(this.elementKeyBoard),a.enableTouch(this.elementTouch),a.enableGesture(this.elementTouch),navigator.getGamepads&&a.enableGamepad();var c=new n.MouseEnableEvent;n.EventServices.dispatchEvent(c),this._eventsArray=[],this._eventsArray.push(i.addEvent(document,"onMouseMove",(function(e){if(e.from[0].view===t.viewer.canvas){var i=new r;i.x=e.from[0].currentPosition.x,i.y=e.from[0].currentPosition.y;var a=new n.MouseMoveEvent;a.position=i;var o=new r;o.x=e.from[0].deltaPosition.x,o.y=e.from[0].deltaPosition.y,a.deltaPosition=o,n.EventServices.dispatchEvent(a)}}))),this._eventsArray.push(i.addEvent(document,"onLeftMouseDown",(function(e){if(e.from[0].view===t.viewer.canvas){var r=new n.MousePressEvent;r.position.x=e.from[0].currentPosition.x,r.position.y=e.from[0].currentPosition.y,r.button=n.Mouse.EButton.eLeft,n.EventServices.dispatchEvent(r)}}))),this._eventsArray.push(i.addEvent(document,"onLeftMouseUp",(function(e){if(e.from[0].view===t.viewer.canvas){var r=new n.MouseReleaseEvent;r.position.x=e.from[0].currentPosition.x,r.position.y=e.from[0].currentPosition.y,r.button=n.Mouse.EButton.eLeft,n.EventServices.dispatchEvent(r)}}))),this._eventsArray.push(i.addEvent(document,"onLeftClick",(function(e){if(e.from[0].view===t.viewer.canvas){var r=new n.MouseClickEvent;r.position.x=e.from[0].currentPosition.x,r.position.y=e.from[0].currentPosition.y,r.button=n.Mouse.EButton.eLeft,n.EventServices.dispatchEvent(r)}}))),this._eventsArray.push(i.addEvent(document,"onLeftDoubleClick",(function(e){if(e.from[0].view===t.viewer.canvas){var r=new n.MouseDoubleClickEvent;r.position.x=e.from[0].currentPosition.x,r.position.y=e.from[0].currentPosition.y,r.button=n.Mouse.EButton.eLeft,n.EventServices.dispatchEvent(r)}}))),this._eventsArray.push(i.addEvent(document,"onMiddleMouseDown",(function(e){if(e.from[0].view===t.viewer.canvas){var r=new n.MousePressEvent;r.position.x=e.from[0].currentPosition.x,r.position.y=e.from[0].currentPosition.y,r.button=n.Mouse.EButton.eMiddle,n.EventServices.dispatchEvent(r)}}))),this._eventsArray.push(i.addEvent(document,"onMiddleMouseUp",(function(e){if(e.from[0].view===t.viewer.canvas){var r=new n.MouseReleaseEvent;r.position.x=e.from[0].currentPosition.x,r.position.y=e.from[0].currentPosition.y,r.button=n.Mouse.EButton.eMiddle,n.EventServices.dispatchEvent(r)}}))),this._eventsArray.push(i.addEvent(document,"onMiddleClick",(function(e){if(e.from[0].view===t.viewer.canvas){var r=new n.MouseClickEvent;r.position.x=e.from[0].currentPosition.x,r.position.y=e.from[0].currentPosition.y,r.button=n.Mouse.EButton.eMiddle,n.EventServices.dispatchEvent(r)}}))),this._eventsArray.push(i.addEvent(document,"onMiddleDoubleClick",(function(e){if(e.from[0].view===t.viewer.canvas){var r=new n.MouseDoubleClickEvent;r.position.x=e.from[0].currentPosition.x,r.position.y=e.from[0].currentPosition.y,r.button=n.Mouse.EButton.eMiddle,n.EventServices.dispatchEvent(r)}}))),this._eventsArray.push(i.addEvent(document,"onRightMouseDown",(function(e){if(e.from[0].view===t.viewer.canvas){var r=new n.MousePressEvent;r.position.x=e.from[0].currentPosition.x,r.position.y=e.from[0].currentPosition.y,r.button=n.Mouse.EButton.eRight,n.EventServices.dispatchEvent(r)}}))),this._eventsArray.push(i.addEvent(document,"onRightMouseUp",(function(e){if(e.from[0].view===t.viewer.canvas){var r=new n.MouseReleaseEvent;r.position.x=e.from[0].currentPosition.x,r.position.y=e.from[0].currentPosition.y,r.button=n.Mouse.EButton.eRight,n.EventServices.dispatchEvent(r)}}))),this._eventsArray.push(i.addEvent(document,"onRightClick",(function(e){if(e.from[0].view===t.viewer.canvas){var r=new n.MouseClickEvent;r.position.x=e.from[0].currentPosition.x,r.position.y=e.from[0].currentPosition.y,r.button=n.Mouse.EButton.eRight,n.EventServices.dispatchEvent(r)}}))),this._eventsArray.push(i.addEvent(document,"onRightDoubleClick",(function(e){if(e.from[0].view===t.viewer.canvas){var r=new n.MouseDoubleClickEvent;r.position.x=e.from[0].currentPosition.x,r.position.y=e.from[0].currentPosition.y,r.button=n.Mouse.EButton.eRight,n.EventServices.dispatchEvent(r)}}))),this._eventsArray.push(i.addEvent(document,"onMouseWheel",(function(e){if(e.from[0].view===t.viewer.canvas){var r=new n.MouseWheelEvent;r.position=n.Devices.getMouse().getPosition(),r.wheelDeltaValue=e.gesture.delta,n.EventServices.dispatchEvent(r)}})));let u=this._experienceBase.getManager("CAT3DXAVPComManager");u&&(u.registerCommandFromSwift("onSpatialTap",(e=>{let t=this._experienceBase.getManager("CAT3DExperienceESExportManager");const r=this._experienceBase.ComponentsMap.GetComponentFromID(e);let i=t.getProjectedESObject(r);if(i){let e=new o;e.setActor(i),n.EventServices.dispatchEvent(e)}})),u.registerCommandFromSwift("onSpatialDoubleTap",(e=>{let t=this._experienceBase.getManager("CAT3DExperienceESExportManager");const r=this._experienceBase.ComponentsMap.GetComponentFromID(e);let i=t.getProjectedESObject(r);if(i){let e=new s;e.setActor(i),n.EventServices.dispatchEvent(e)}})))},stop:function(){var e=this._getInputServices();if(e.disableKeyboard(),e.disableTouch(),e.disableGesture(),e.disableGamepad(),this._eventsArray){for(var t=this._eventsArray.length;t--;)i.removeEventFromToken(this._eventsArray[t]),this._eventsArray[t]=null;this._eventsArray=null}let n=this._experienceBase.getManager("CAT3DXAVPComManager");n&&(n.unregisterCommandFromSwift("onSpatialTap"),n.unregisterCommandFromSwift("onSpatialDoubleTap"))},GetType:function(){return"CXPWebEventListenerManager"}})})),define("DS/XCTWebExperienceAppPlay/interfaces/StuIPrototypeBuild",["UWA/Class","DS/WebComponentModeler/CATWebInterface"],(function(e,t){"use strict";return t.singleton({interfaceName:"StuIPrototypeBuild",required:{getESPrototype:function(){},build:function(){},disposeESObject:function(){}},optional:{}})})),define("DS/XCTWebExperienceAppPlay/managers/CAT3DExperienceESExportManager",["UWA/Core","UWA/Class","DS/CAT3DExpModel/interfaces/CATI3DExperienceObject","DS/StuRenderEngine/StuColor"],(function(e,t,n,r){"use strict";return t.extend({Build:function(){this._esObjectMap={},this._esObjectMapPromises={},this._weakReferenceMap=[]},Dispose:function(){delete this._exportPromise,delete this._esObjectMap,delete this._esObjectMapPromises,delete this._weakReferenceMap},export:function(t){var n=this._exportPromise?this._exportPromise:e.Promise.resolve(),r=this,i=n.then((function(){return r._createESObjectFrom3DExpObject(t,null)})).then((function(e){return r._solveWeakReferences(),r._finalizeExperienceObject(t),r._exportPromise===i&&delete r._exportPromise,e}));return this._exportPromise=i,i},exportSubExperienceObject:function(t){var n=this._exportPromise?this._exportPromise:e.Promise.resolve();const r=t.QueryInterface("CATI3DExperienceObject").GetParent(),i=t.QueryInterface("CATI3DExperienceObject").GetParentVariable();var a=this.getProjectedESObject(r),o=this,s=n.then((function(){return o._createESObjectFrom3DExpObject(t,a)})).then((function(e){if(1!==t.QueryInterface("CATI3DExperienceObject").GetVariableMaxNumberOfValues){const t=a[i]?a[i]:[];t.push(e),a[i]=t}else a[i]=e;return o._solveWeakReferences(),o._finalizeExperienceObject(t),o._exportPromise===s&&delete o._exportPromise,e}));return this._exportPromise=s,s},cleanProjectedESObjectMap:function(){for(var e in this._esObjectMap)if(this._esObjectMap.hasOwnProperty(e)){var t=this._esObjectMap[e].modelObject,n=this._esObjectMap[e].ESObject;t.QueryInterface("StuIPrototypeBuild").disposeESObject(n),delete this._esObjectMap[e]}},getProjectedESObject:function(e){if(this._esObjectMap[e.GetID()])return this._esObjectMap[e.GetID()].ESObject},removeProjectedESObject:function(e){if(this._esObjectMap[e.GetID()]){var t=this._esObjectMap[e.GetID()].ESObject;e.QueryInterface("StuIPrototypeBuild").disposeESObject(t),delete this._esObjectMap[e.GetID()];for(var n=this._listChildren(e),r=0;r<n.length;r++)this.removeProjectedESObject(n[r])}},_createESObjectFrom3DExpObject:function(t,n){if(this._esObjectMapPromises[t.GetID()])return this._esObjectMapPromises[t.GetID()];var r,i=this.getProjectedESObject(t);i?(i.constructor(),r=e.Promise.resolve(i)):r=t.QueryInterface("StuIPrototypeBuild").getESPrototype().then((function(e){i=new e}));var a=this,o=t.QueryInterface("CATI3DExperienceObject");return this._esObjectMapPromises[t.GetID()]=r.then((function(){return i.name=o.GetValueByName("_varName"),n&&i.setParent&&i.setParent(n),t.QueryInterface("StuIPrototypeBuild").build(i)})).then((function(t){for(var n=[],r=o.ListVariables(),s=0;s<r.length;s++){var c=r[s];t.indexOf(c)>=0||n.push(a._projectVariable(o,c,i))}return e.Promise.allSettled(n)})).then((function(){return a._esObjectMap[t.GetID()]={ESObject:i,modelObject:t},delete a._esObjectMapPromises[t.GetID()],e.Promise.resolve(i)})),this._esObjectMapPromises[t.GetID()]},_createESObjectFrom3DExpObjectInArray:function(e,t,n){return this._createESObjectFrom3DExpObject(e,t).then((function(e){return{esObject:e,index:n}}))},_projectVariable:function(e,t,r){var i=e.GetVariableType(t);return n.VarType.Color===i?this._projectColorVariable(e,t,r):n.VarType.Object===i?this._projectObjectVariable(e,t,r):this._projectDefaultVariable(e,t,r)},_projectDefaultVariable:function(t,n,r){var i=t.GetValueByName(n);return e.is(i)&&(r[n]=i),e.Promise.resolve()},_projectColorVariable:function(t,n,i){var a=t.GetValueByName(n);if(a){var o=a.GetThreeColor(),s=new r(255*o.r,255*o.g,255*o.b);i[n]=s}return e.Promise.resolve()},_projectObjectVariable:function(t,r,i){var a=t.GetVariableValuationMode(r),o=t.GetValueByName(r);if(!o)return e.Promise.resolve();if(n.ValuationMode.AggregatingValue!==a)return this._storeWeakReference(o,r,i),e.Promise.resolve();if(!Array.isArray(o))return this._createESObjectFrom3DExpObject(o,i).then((function(e){i[r]=e}));for(var s=[],c=[],u=0;u<o.length;u++)s.push(this._createESObjectFrom3DExpObjectInArray(o[u],i,u).then((function(e){c[e.index]=e.esObject})));return e.Promise.allSettled(s).then((function(){i[r]=c}))},_solveWeakReferences:function(){for(var e=this,t=0;t<this._weakReferenceMap.length;t++){var n=this._weakReferenceMap[t].ESObject,r=this._weakReferenceMap[t].variableName,i=this._weakReferenceMap[t].referenceValue;i=Array.isArray(i)?i.map((function(t){return e.getProjectedESObject(t)})):this.getProjectedESObject(i),n[r]=i}this._clearWeakReferenceMap()},_storeWeakReference:function(e,t,n){this._weakReferenceMap.push({referenceValue:e,variableName:t,ESObject:n})},_clearWeakReferenceMap:function(){this._weakReferenceMap=[]},_finalizeExperienceObject:function(e){var t=this.getProjectedESObject(e);t.finalize&&t.finalize()},_listChildren:function(e){var t=e.QueryInterface("CATI3DExperienceObject"),r=[],i=[];t.ListVariables(i,n.VarType.Object);for(var a=0;a<i.length;a++)if(t.GetVariableValuationMode(i[a])===n.ValuationMode.AggregatingValue){var o=t.GetValueByName(i[a]);if(!o)continue;Array.isArray(o)?r=r.concat(o):r.push(o)}return r},GetType:function(){return"CAT3DExperienceESExportManager"}})})),define("DS/XCTWebExperienceAppPlay/CXPWebRaytraceWrapper",[],(function(){"use strict";var e=function(){};return e.prototype.setAperture=function(){},e.prototype.setExposure=function(){},e.prototype.setFocusDistance=function(){},e.prototype.setSpeed=function(){},e.prototype.setAutoFocusMode=function(){},e.prototype.setProduceVideo=function(){},e.prototype.shotSingleFrame=function(){},e.prototype.begin=function(){},e.prototype.end=function(){},e})),define("DS/XCTWebExperienceAppPlay/CXPWebViewer",["UWA/Core","DS/Visualization/ThreeJS_DS","DS/StuCore/StuContext","DS/StuMath/StuSphere","DS/StuMath/StuRay","DS/Visualization/PathElement","DS/MathematicsES/MathsDef","DS/CATCXPModel/CATCXPRenderUtils","DS/Selection/HSOManager","DS/Selection/PSOManager","DS/EP/EP","DS/StuRenderEngine/StuIntersection","DS/CAT3DExpModel/CAT3DXModel"],(function(e,t,n,r,i,a,o,s,c,u,p,l,f){"use strict";return e.Class.extend({_viewer:null,init:function(e){this._viewer=e},onStart:function(){c.empty(),u.empty()},onStop:function(){c.empty(),u.empty(),this._viewer.canvas.style.cursor="inherit"},GetSize:function(t){if(t instanceof o.Vector2D){var n=this._viewer.canvas.getSize();t.x=n.width,t.y=n.height}else e.log("StuViewer.GetSize ERROR : parameter is not a Vector2D !"),t=null},GetGlobalBoundingSphere:function(t){if(t instanceof n.Sphere){var r=this._viewer.getSceneBoundingSphere("show",!0);t.center=r.center,t.radius=r.radius}else e.log("StuViewer.GetGlobalBoundingSphere ERROR : parameter is not a STU.Sphere !"),t=null},GetRayFromPosition:function(t,r){if(!(r instanceof n.Ray))return e.log("StuViewer.GetRayFromPosition ERROR : ray parameter is not a STU.Ray !"),void(r=null);var i=this._viewer.currentViewpoint.camera,a=this._viewer.currentViewpoint.create3DRayFrom2DPoint(t,i);r.origin.x=a.origin.x,r.origin.y=a.origin.y,r.origin.z=a.origin.z,r.direction.x=a.direction.x,r.direction.y=a.direction.y,r.direction.z=a.direction.z},GetLineFromPosition:function(t,n){if(!(n instanceof o.Line))return e.log("StuViewer.GetLineFromPosition ERROR : ray parameter is not a DSMath.Line !"),void(n=null);var r=this._viewer.currentViewpoint.camera,i=this._viewer.currentViewpoint.create3DRayFrom2DPoint(t,r);n.origin.x=i.origin.x,n.origin.y=i.origin.y,n.origin.z=i.origin.z,n.direction.x=i.direction.x,n.direction.y=i.direction.y,n.direction.z=i.direction.z},PickFromPosition:function(r,i,a,c,u=!1){if(!(i instanceof Array))return e.log("StuViewer.PickFromPosition ERROR : oIntersections parameter is not an Array !"),void(i=null);if(a){var p=new t.Vector2(r.x,r.y),l=this._viewer.getMousePosition(p),f=this._viewer.pick(l,"mesh",!u);if(f.path.length>=1){var d=s.getComponentsFromPathElement(f.path[0],!0);if(1===d.length){var y=new n.Intersection,h=d[0]._experienceBase.getManager("CAT3DExperienceESExportManager").getProjectedESObject(d[0]);if(y.setActor(h),0==u){var C=new o.Point(f.position.x,f.position.y,f.position.z);y.setPoint(C);var m=new o.Vector3D(f.normal.x,f.normal.y,f.normal.z);y.setNormal(m)}i.push(y)}}return i}var g=new n.Ray;return this.GetRayFromPosition(r,g),this.PickFromRay(g,i,a,c)},PickFromRay:function(r,i,a){if(!(i instanceof Array))return e.log("StuViewer.PickFromRay ERROR : oIntersections parameter is not an Array !"),void(i=null);var c=new t.Ray;c.origin.set(r.getOrigin().x,r.getOrigin().y,r.getOrigin().z);var u=r.getDirection();u.isNormalized()||(u=u.normalize()),c.direction.set(u.x,u.y,u.z);for(var p=r.getLength(),l=this._viewer.castRay(c,null,"prim"),f=0;f<l.length;f++)if(l[f].distance<=p||0===p){var d=s.getComponentsFromPathElement(l[f].pathElement,!0);if(1===d.length){var y=d[0]._experienceBase.getManager("CAT3DExperienceESExportManager").getProjectedESObject(d[0]);if(this._isClickable(y)){var h=new n.Intersection;h.setActor(y);var C=new o.Point(l[f].point.x,l[f].point.y,l[f].point.z);h.setPoint(C);var m=new o.Vector3D(l[f].normal.x,l[f].normal.y,l[f].normal.z);if(h.setNormal(m),i.push(h),!0===a)return i}}}return i},_isClickable:function(e){return!!e.clickable&&(!(e.parent instanceof n.Actor3D)||this._isClickable(e.parent))},PickFromLine:function(t,r,i){if(!(r instanceof Array))return e.log("StuViewer.PickFromLine ERROR : oIntersections parameter is not an Array !"),void(r=null);var a=new n.Ray;return a.origin=t.origin,a.direction=t.direction,this.PickFromRay(a,r,i),r},GetMousePosition:function(e){var t=p.Devices.getMouse().position;e.x=t.x,e.y=t.y},SetMousePosition:function(){e.log("StuViewer.SetMousePosition WARNING : No Implementation !")},HideMouseCursor:function(){this._viewer.canvas.style.cursor="none"},ShowMouseCursor:function(){this._viewer.canvas.style.cursor="inherit"},HighlightDisplay:function(e,t){var n=e.getModelObject(),r=n.QueryInterface("CATI3DGeoVisu").GetPathElement();if(!r)return;const i=f.GetExperience()._experienceBase.getManager("CAT3DXAVPComManager");if(i&&i.isAVPEnabled()){const e=n.QueryInterface("CATI3DExperienceObject").GetPathOfIds().toString();1==t?i.sendCommandToSwift("HighlightActor",{pathOfIds:e}):i.sendCommandToSwift("DehighlightActor",{pathOfIds:e})}else t?c.add({pathElement:r}):c.remove({pathElement:r})},PreHighlightDisplay:function(e,t){var n=e.getModelObject().QueryInterface("CATI3DGeoVisu").GetPathElement();n&&(t?u.add({pathElement:n}):u.remove({pathElement:n}))},GetViewpointCoordinatesFromPixel:function(e,t){return this._viewer.currentViewpoint.create3DRayFrom2DPoint(e,t).origin},Unproject:function(e,n){var r=new t.Matrix4,i=new t.Matrix4;this._validateMatrix(n.matrixWorld,i);var a=new t.Matrix4;return this._validateMatrix(n.projectionMatrix,a),r.multiplyMatrices(i,r.getInverse(a)),e.applyProjection(r)},_validateMatrix:function(e,t){for(var n=e.elements.length-1;n>=0;n--){var r=e.elements[n];isFinite(r)&&!isNaN(r)&&(t.elements[n]=r)}},ActivateDefaultNavigation:function(){this._viewer.autoUpdateFrustum=!0,this._viewer.currentViewpoint.control.setActive(!0),this._viewer.currentViewpoint.control.setMouseActive(!0),this._viewer.currentViewpoint.control.setReframeOnDoubleTap(!0);const e=this._viewer.getSceneBoundingSphere(),t=this._viewer.currentViewpoint.position;this._viewer.currentViewpoint.setTarget(e.center);const n=e.center.distanceTo(t);this._viewer.currentViewpoint.setTargetDistance(n)},DeactivateDefaultNavigation:function(){this._viewer.autoUpdateFrustum=!1,this._viewer.setAutomaticPlaneUpdate(!1),this._viewer.currentViewpoint.control.setActive(!1),this._viewer.currentViewpoint.control.setMouseActive(!1),this._viewer.currentViewpoint.control.setReframeOnDoubleTap(!1)}})})),define("DS/XCTWebExperienceAppPlay/commands/XCTCmdPlayListenerHelper",["UWA/Class/Listener"],(function(e){"use strict";return{listen:function(t,n){const r=t._experienceBase.getManager("CXPWebPlayManager"),i=new e;return i.listenTo(r,"PlayStateChanged",(e=>{n(e,r)})),()=>{i.stopListening()}}}})),define("DS/XCTWebExperienceAppPlay/managers/APIPlayerManager",["UWA/Core","UWA/Class","DS/CAT3DExpModel/CAT3DXModel","DS/StuCore/StuContext","DS/EP/EP","DS/StuModel/StuVariantValuedEvent","DS/StuModel/StuVariantUnvaluedEvent"],(function(e,t,n,r,i,a,o){"use strict";return t.extend({Dispose:function(){delete this._playerOptions},GetType:function(){return"APIPlayerManager"},play:function(){return this._experienceBase.getManager("XCTCreativeExperiencePlayerAPIManager").play()},pause:function(){return this._experienceBase.getManager("XCTCreativeExperiencePlayerAPIManager").pause()},stop:function(){return this._experienceBase.getManager("XCTCreativeExperiencePlayerAPIManager").stop()},isPlaying:function(){return this._experienceBase.getManager("XCTCreativeExperiencePlayerAPIManager").isPlaying()},muteAll:function(){return this._experienceBase.getManager("XCTCreativeExperiencePlayerAPIManager").muteAll()},unmuteAll:function(){return this._experienceBase.getManager("XCTCreativeExperiencePlayerAPIManager").unmuteAll()},getScenes:function(){return this._experienceBase.getManager("XCTCreativeExperiencePlayerAPIManager").getScenes()},getCurrentScene:function(){return this._experienceBase.getManager("XCTCreativeExperiencePlayerAPIManager").getCurrentScene()},playScene:function(e){return this._experienceBase.getManager("XCTCreativeExperiencePlayerAPIManager").playScene(e)},getPermanentActs:function(){return this._experienceBase.getManager("XCTCreativeExperiencePlayerAPIManager").getPermanentActs()},playPermanentAct:function(e){this._experienceBase.getManager("XCTCreativeExperiencePlayerAPIManager").playPermanentAct(e)},getCurrentPermanentAct:function(){return this._experienceBase.getManager("XCTCreativeExperiencePlayerAPIManager").getCurrentPermanentAct()},getActsFromScene:function(e){return this._experienceBase.getManager("XCTCreativeExperiencePlayerAPIManager").getActsFromScene(e)},playActFromCurrentScene:function(e){this._experienceBase.getManager("XCTCreativeExperiencePlayerAPIManager").playActFromCurrentScene(e)},getCurrentActFromCurrentScene:function(){return this._experienceBase.getManager("XCTCreativeExperiencePlayerAPIManager").getCurrentActFromCurrentScene()},getTwinVariants:function(e){return this._getTwinVariants(e)},getTwinInstances:function(){return this._getTwinInstances()},getTwinVariantValue:function(e,t){return this._getTwinVariantValue(e,t)},setTwinVariantValue:function(e,t,n){return this._setTwinVariantValue(e,t,n)},getPlayerId:function(){if(this._playerOptions&&this._playerOptions.input)return this._playerOptions.input.ID},addVariantListener:function(e){i.EventServices.addObjectListener(r.VariantValuedEvent,e,"onVariantValuedEvent"),i.EventServices.addObjectListener(r.VariantUnvaluedEvent,e,"onVariantUnvaluedEvent")},removeVariantListener:function(e){i.EventServices.removeObjectListener(r.VariantValuedEvent,e,"onVariantValuedEvent"),i.EventServices.removeObjectListener(r.VariantUnvaluedEvent,e,"onVariantUnvaluedEvent")},simplifyVariantValues:function(e){let t=[];return e.forEach((e=>{let n={};for(var r in e)"name"!==r&&"Alternative Name"!==r||(n[r]=e[r]);Object.keys(n).length>0&&(n.isCurrent=e.getVariant().isValueCurrent(e),t.push(n))})),t},simplifyVariants:function(e){let t=[];return e&&e.forEach((e=>{let n={};for(var r in e)e.hasOwnProperty(r)&&("values"===r&&(n[r]=this.simplifyVariantValues(e[r])),"name"!==r&&"type"!==r&&"Alternative Name"!==r||(n[r]=e[r]));Object.keys(n).length>0&&t.push(n)})),t},simplifyTwins:function(e){let t=[];return e.forEach((e=>{let n={};for(var r in e)"name"===r&&(n[r]=e[r]);Object.keys(n).length>0&&t.push(n)})),t},_getTwinVariants:function(e){var t=r.Experience.getCurrent().getActorByName(e,!1);return this.simplifyVariants(t.variants)},_getTwinInstances:function(){var e=r.Experience.getCurrent().getActorsByType(r.ProductActor,!1);let t;return(e=e.filter((e=>e.hasOwnProperty("variants")&&Array.isArray(e.variants)&&e.variants.length>0))).length&&(t=this.simplifyTwins(e)),t},_getTwinVariantValue:function(e,t){var n=r.Experience.getCurrent().getActorByName(e,!1);let i;return this.simplifyVariants(n.variants).map((e=>{e["Alternative Name"]===t&&(i=e.values.find((e=>e.isCurrent)))})),i?i["Alternative Name"]:null},_setTwinVariantValue:function(e,t,n){r.Experience.getCurrent().getActorsByType(r.ProductActor,!0).forEach((r=>{if(r.getName()===e)for(var i in r)if(r.hasOwnProperty(i)){let e;"variants"===i&&(e=r[i],e.forEach((e=>{e.getDisplayName()===t&&e.setCurrentValueByDisplayName(n)})))}}))},_listActorsAssets:function(){var e=n.GetExperience(),t=e.QueryInterface("CATI3DExperienceObject").GetValueByName("actors"),r=[],i=e.QueryInterface("CATI3DExperienceObject").GetValueByName("scenes");for(let e=0;e<i.length;e++)t=t.concat(i[e].QueryInterface("CATI3DExperienceObject").GetValueByName("actors"));for(let e=0;e<t.length;e++)this._listActorsAssetsRecursively(t[e],r);return r},_listActorsAssetsRecursively:function(e,t){var n={experienceObject:e,name:e.QueryInterface("CATI3DExperienceObject").GetValueByName("_varName")},r=e.QueryInterface("CATI3DXAssetHolder")._getLinkDescription();if(n.assetLink=r||"",t.push(n),e.QueryInterface("CATI3DExperienceObject").HasVariable("actors")){var i=e.QueryInterface("CATI3DExperienceObject").GetValueByName("actors");for(let e=0;e<i.length;e++)this._listActorsAssetsRecursively(i[e],t)}if(e.QueryInterface("CATI3DExperienceObject").HasVariable("overrides")){var a=e.QueryInterface("CATI3DExperienceObject").GetValueByName("overrides");for(let e=0;e<a.length;e++)this._listActorsAssetsRecursively(a[e],t)}},_listMaterialsAssets:function(){var e=n.GetExperience(),t=[];if(e.QueryInterface("CATI3DExperienceObject").HasVariable("materials"))for(var r=e.QueryInterface("CATI3DExperienceObject").GetValueByName("materials"),i=0;i<r.length;i++)t.push({experienceObject:r[i],name:r[i].QueryInterface("CATI3DExperienceObject").GetValueByName("_varName"),assetLink:r[i].QueryInterface("CATI3DXAssetHolder")._getLinkDescription()});let a=this._listActorsAssets();for(var o=0;o<a.length;o++)if(a[o]&&a[o].experienceObject&&a[o].experienceObject.QueryInterface("CATI3DExperienceObject").HasVariable("materialsRef")){var s=a[o].experienceObject.QueryInterface("CATI3DExperienceObject").GetValueByName("materialsRef");if(s)for(i=0;i<s.length;i++)t.push({experienceObject:s[i],name:s[i].QueryInterface("CATI3DExperienceObject").GetValueByName("_varName"),assetLink:s[i].QueryInterface("CATI3DXAssetHolder")._getLinkDescription()})}return t},_listEnvironmentsAssets:function(){var e=n.GetExperience(),t=[];if(e.QueryInterface("CATI3DExperienceObject").HasVariable("environments"))for(var r=e.QueryInterface("CATI3DExperienceObject").GetValueByName("environments"),i=0;i<r.length;i++)t.push({experienceObject:r[i],name:r[i].QueryInterface("CATI3DExperienceObject").GetValueByName("_varName"),assetLink:r[i].QueryInterface("CATI3DXAssetHolder")._getLinkDescription()});return t},_listResourcesAssets:function(){var e=n.GetExperience(),t=[];if(e.QueryInterface("CATI3DExperienceObject").HasVariable("resources"))for(var r=e.QueryInterface("CATI3DExperienceObject").GetValueByName("resources"),i=0;i<r.length;i++)t.push({experienceObject:r[i],name:r[i].QueryInterface("CATI3DExperienceObject").GetValueByName("_varName"),assetLink:r[i].QueryInterface("CATI3DXAssetHolder")._getLinkDescription()});return t},_setPlayerOptions:function(e){this._playerOptions=e}})})),define("DS/XCTWebExperienceAppPlay/managers/XCTEWSEPublishToSwymPlayerOptionsMgr",["UWA/Core","UWA/Class","UWA/Class/Listener","DS/ApplicationFrame/CommandsManager"],(function(e,t,n,r){"use strict";return t.extend(n,{setPlayerOptions:function(t){var n=t&&t.playExperience?t.playExperience:{};const i=!e.is(t.OptimizeRaycasting)||t.OptimizeRaycasting,a={playExperience:n,optimizeRaycasting:i};let o=this.GetObject()._experienceBase;var s=o.webApplication.frmWindow;s.loadActionBar({workbenchModule:"XCTWebExperienceAppPlay",workbench:"XCTWebExperienceAppPlayPublishToSwym.xml"}),s.onActionBarReady((()=>{var e=s.getActionBar();if(e){e.close();const t=o.webApplication.frmWindow.options.context,n=r.getCommand("VisuReframeView",t),i=r.getCommand("VisuPanView",t),a=r.getCommand("VisuRotateView",t),s=r.getCommand("VisuZoomView",t),c=r.getCommand("ViewSelector",t),u=o.getManager("CXPWebPlayManager");this.listenTo(u,"PlayStateChanged",(e=>{u.ePlayState.ePlaying===e?(n.disable(),i.disable(),a.disable(),s.disable(),c.disable()):(n.enable(),i.enable(),a.enable(),s.enable(),c.enable())}))}t.playExperience&&t.playExperience.updateMAB&&t.playExperience.updateMAB({speeddial:[{id:"CameraNavigations",rsc:"XCTWebExperienceAppPlay/XCTWebExperienceAppPlay",updateIcon:!0,flyout:[{id:"PlayOrbitalNavigationHdr",rsc:"XCTWebExperienceAppPlay/XCTWebExperienceAppPlay"},{id:"PauseDefaultNavigationHdr",rsc:"XCTWebExperienceAppPlay/XCTWebExperienceAppPlay"}]},{id:"VisuReframeView",rsc:"ViewerCommands/ViewerCommands"},{id:"ViewSelector",rsc:"3DPlay/3DPlayExperience3D",hideAB:!0,showBack:!0}],sections:[{id:"VisuQMCommand",nls:"ViewerCommands/ViewerCommands",rsc:"ViewerCommands/ViewerCommands"}],hideAB:!0,showBack:!1})})),i&&o.getManager("CAT3DXVisuManager").activateAccelerationStructure(),this.QueryInterface("XCTEWSIExperienceMgr")._setPlayerOptions(a)},Dispose:function(){this.stopListening()}})})),define("DS/XCTWebExperienceAppPlay/StuWebPlayerWeb",["DS/StuWebPlayer/StuWebPlayer","DS/EPEventServices/EPEventServices","DS/StuCore/StuContext","DS/StuWebPlayer/StuWebPlayerMessageReceivedEvent","DS/CAT3DExpModel/CAT3DXModel"],(function(e,t,n,r,i){"use strict";function a(){let e=null,t=n.Experience.getCurrent().CATI3DExperienceObject.getModelObject()._experienceBase.getManager("APIPlayerManager");return null!=t&&(e=t.getPlayerId()),e}window.addEventListener("message",(function(e){let n=e.data;if("ExperienceMessage"===n.protocol&&function(e,t){let n=!1;e===t&&(n=!0);void 0===t&&(n=!0);return n}(n.playerID,a())&&"WebComponent"===n.sender){let e=new r(n.message);t.dispatchEvent(e)}}));var o=e.prototype.sendMessage;return e.prototype.sendMessage=function(e){o.call(this);let t={protocol:"ExperienceMessage",playerID:a(),sender:"CreativeExperience"};t.message=e,window.parent.postMessage(t,"*")},e.prototype.isAVPEnabled=function(){const e=i.GetExperience()._experienceBase.getManager("CAT3DXAVPComManager");return!!e&&e.isAVPEnabled()},e.prototype._startNewAVPExperience=function(e){console.warn("Do not use. For internal usage only.");const t=i.GetExperience()._experienceBase.getManager("CAT3DXAVPComManager");t&&t.sendCommandToSwift("startNewAVPExperience",e)},e})),define("DS/XCTWebExperienceAppPlay/StuUIBinder",["UWA/Core","UWA/Class"],(function(e){"use strict";return e.Class.extend({fillProperties:function(){}})})),define("DS/XCTWebExperienceAppPlay/CXPWebViewpoint",["UWA/Core","DS/Visualization/ThreeJS_DS","DS/CATCXPModel/CATCXPRenderUtils"],(function(e,t,n){"use strict";return e.Class.extend({_viewer:null,init:function(e){this._viewpoint=e},__stu__IsLocked:function(){return 0},__stu__SetAngle:function(e){this._viewpoint.setAngle(2*e)},__stu__SetFocusDistance:function(e){this._viewpoint.setTargetDistance(e)},__setViewpointFromCamera:function(e){n.setViewpointFromCamera(this._viewpoint,e.CATI3DExperienceObject.getModelObject()),n.setViewerRatioFromCamera(this._viewpoint.viewer,e.CATI3DExperienceObject.getModelObject())}})})),define("DS/XCTWebExperienceAppPlay/StuHMDWrapper",["DS/StudioIV/StuHMDWrapper"],(function(e){"use strict";e.prototype.setInteractionCtxTransform=function(){},e.prototype.getInteractionCtxTransform=function(){},e.prototype.deactivateMainViewerRefresh=function(){},e.prototype.activateMainViewerRefresh=function(){},e.prototype.setRepresentationVisibility=function(){},e.prototype.start=function(){}})),define("DS/XCTWebExperienceAppPlay/CAT3DXModelFactoryPlay",["UWA/Core","DS/CAT3DExpModel/CAT3DXModelFactory","DS/CAT3DExpModel/CAT3DXJSONReader","DS/CAT3DExpModel/XCTExpUint8ArrayAsset"],(function(e,t,n,r){"use strict";return t.extend({LoadExperience:function(t){var i=this;return this._expCoreLinkManager.resolveLink(t).then((function(a){if(!(a instanceof r))return e.Promise.reject("Cant load experience from link : "+t);const o=a.getText(),s=JSON.parse(o);return n.read(s,i._objectBuilder,i._expDataObjectMap,i._expCoreLinkManager)})).then((function(n){return e.is(n)?e.Promise.resolve(n):e.Promise.reject("Cant load experience from link : "+t)}))},CloseExperience:function(){var e=this.GetExperience();return this._objectBuilder._removeObject(e)}})})),define("DS/XCTWebExperienceAppPlay/CXPWebiVWrapper",[],(function(){"use strict";var e=function(){};return e.prototype.createIVScenario=function(){},e.prototype.setBackgroundStreamState=function(){},e.prototype.setMarkerType=function(){},e.prototype.setMarkerSize=function(){},e.prototype.startTracking=function(){},e.prototype.isNoTrackingEnabled=function(){},e.prototype.setMirrorState=function(){},e.prototype.dispose=function(){},e.prototype.getBackgroundStreamState=function(){},e.prototype.getMirrorState=function(){},e})),define("DS/XCTWebExperienceAppPlay/StuRaytraceWrapper",["DS/StuRaytrace/StuRaytraceWrapper"],(function(e){"use strict";e.prototype.setAperture=function(){},e.prototype.setExposure=function(){},e.prototype.setFocusDistance=function(){},e.prototype.setSpeed=function(){},e.prototype.setAutoFocusMode=function(){},e.prototype.setProduceVideo=function(){},e.prototype.shotSingleFrame=function(){},e.prototype.begin=function(){},e.prototype.end=function(){}})),define("DS/XCTWebExperienceAppPlay/StuCDSDynFactory",["DS/StuPhysic/StuCDSDynFactory"],(function(e){"use strict";e.buildCDSDynFactory=function(){return{CreateBox:function(){},CreateForce:function(){return{SetApplicationPoint:function(){},SetForceComponent:function(){},SetTorqueComponent:function(){}}},CreateMaterial:function(){},CreateRigidBody:function(){return{SetFixed:function(){},SetOrigin:function(){},SetOrientation:function(){},EnableAutomaticDeactivation:function(){},SetMaterial:function(){},SetAngularDamping:function(){},SetLinearVelocity:function(){},SetAngularVelocity:function(){},GetInertia:function(){},GetMaterial:function(){}}},ReleaseObject:function(){},CreateInertia:function(){return{SetMass:function(){},SetInertia:function(){},SetCenterOfGravity:function(){}}},CreateSolverConfig:function(){},CreateSolver:function(){return{SetWorld:function(){},AddRigidBody:function(){},AddImpulse:function(){},AddForce:function(){},RemoveForce:function(){}}},CreateWorld:function(){return{SetSize:function(){},SetGravity:function(){}}}}},e.buildCDSDynInertiaComputer=function(e,t){return{Run:function(){this.usedVar=t},GetMass:function(){},GetPrincipalInertia:function(){return{oInertia:null,oInertiaOrientation:null}},GetCoG:function(){return{oCoG:[null,null,null]}}}},e.removeCDSDynInertiaComputer=function(e){this.usedVar=e}})),define("DS/XCTWebExperienceAppPlay/managers/W3AACXPWebPlayManager",["UWA/Core","DS/WebApplicationBase/W3AAManager","DS/EPTaskPlayer/EPTaskPlayerDefine"],(function(e,t,n){"use strict";return e.Class.extend(t,{update:function(e){n.execute({deltaTime:e.deltaTime,elapsedTime:Date.now()-this.GetObject()._startDate,frameNumber:this.GetObject()._frameNumber}),this.GetObject()._frameNumber++},getUpdatePriority:function(){return 0}})})),define("DS/XCTWebExperienceAppPlay/StuVisuServices",["DS/StuMiscContent/StuVisuServices","UWA/Core","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/SceneGraphNodes/CSS2DNode","DS/StuRenderEngine/StuRenderManager"],(function(e,t,n,r,i,a){"use strict";var o=t.Class.extend({GetPLMProperties:function(){return["not available in web"]},GetPLMPropValue:function(){return["not available in web"]},AnnotationDisplay:function(e,t){a.getInstance().main3DViewer._viewer.getRootNode().addChild(t)}});return e.prototype.build=function(){return new o},e})),define("DS/XCTWebExperienceAppPlay/managers/APIPlayerManagerPlayerOptions",["UWA/Core","UWA/Class"],(function(e,t){"use strict";return t.extend({Dispose:function(){delete this._playerOptions},setPlayerOptions:function(e){this.GetObject()._setPlayerOptions(e)}})})),define("DS/XCTWebExperienceAppPlay/StuEnvServices",["DS/StuCore/StuEnvServices"],(function(e){"use strict";e.CATGetEnv=function(e){return localStorage.getItem(e)},e.EKIntegrationOFF=function(){return!0}})),define("DS/XCTWebExperienceAppPlay/commands/XCTWebPlayPublishToSwymCmd",["UWA/Core","UWA/Class/Listener","DS/ApplicationFrame/Command"],(function(e,t,n){"use strict";return e.Class.extend(n,t,{execute:function(){this.getFrameWindow()._experienceBase.getManager("CXPWebPlayManager").play()}})})),define("DS/XCTWebExperienceAppPlay/commands/XCTWebPausePublishToSwymCmd",["UWA/Core","UWA/Class/Listener","DS/ApplicationFrame/Command"],(function(e,t,n){"use strict";return e.Class.extend(n,t,{execute:function(){this.getFrameWindow()._experienceBase.getManager("CXPWebPlayManager").pause()}})})),define("DS/XCTWebExperienceAppPlay/CXPWebHMDWrapper",[],(function(){"use strict";var e=function(){};return e.prototype.setInteractionCtxTransform=function(){},e.prototype.getInteractionCtxTransform=function(){},e.prototype.deactivateMainViewerRefresh=function(){},e.prototype.activateMainViewerRefresh=function(){},e.prototype.setRepresentationVisibility=function(){},e.prototype.start=function(){},e})),define("DS/XCTWebExperienceAppPlay/CATCXPHumanManager",["DS/StuHuman/CATCXPHumanManager"],(function(e){"use strict";e.CATGetHumanManager=function(){return{RegisterHumanMotionBe:function(){}}}})),define("DS/XCTWebExperienceAppPlay/CXPConfServices",["DS/StuRenderEngine/CXPConfServices"],(function(e){"use strict";return e.prototype.build=function(){return this},e.prototype.getConfiguration=function(){},e.prototype.setConfiguration=function(){},e.prototype.checkActivations=function(){},e.prototype.removeConfiguration=function(){},e.prototype.getCurrentConfigurationName=function(){},e})),define("DS/XCTWebExperienceAppPlay/managers/XCTEWSECXPWebPlayerOptionsMgr",["UWA/Core","UWA/Class"],(function(e,t){"use strict";return t.extend({setPlayerOptions:function(t){var n=t&&t.input&&t.input.playOptions?t.input.playOptions:{},r=!!e.is(n.progressiveLoading)&&n.progressiveLoading,i=!e.is(n.play)||n.play,a=!!e.is(n.transparentBackground)&&n.transparentBackground,o=t&&t.playExperience?t.playExperience:{};const s=!e.is(t.OptimizeRaycasting)||t.OptimizeRaycasting,c={autoPlay:i,progressiveLoading:r,transparentBackground:a,playExperience:o,optimizeRaycasting:s};let u=this.GetObject()._experienceBase;var p=u.webApplication.frmWindow;p.loadActionBar({workbenchModule:"XCTWebExperienceAppPlay",workbench:"XCTWebExperienceAppPlay.xml"}),p.onActionBarReady((function(){var e=p.getActionBar();e&&e.close()})),a&&u.getManager("CAT3DXEnvironmentManager").setTransparentBackground(!0),s&&u.getManager("CAT3DXVisuManager").activateAccelerationStructure(),this.QueryInterface("XCTEWSIExperienceMgr")._setPlayerOptions(c)}})})),define("DS/XCTWebExperienceAppPlay/CXPWebCapacityLauncher",["DS/StuMiscContent/StuCapacityLauncher","DS/Controls/Button","UWA/Core","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/SceneGraphNodes/CSS2DNode"],(function(e,t,n,r,i,a){"use strict";return e.prototype.createCapacityPanel=function(e,t){for(var i=n.createElement("div",{id:"layouttest",styles:{display:"flex","flex-direction":"column","align-items":"stretch",width:"auto",padding:"4px",border:"1px solid #E2E4E3","background-color":"#F4F5F6"}}),o=0;o<e.length;o++)e[o].inject(i);return new a({html:i,offset:new r.Vector2(t.x,t.y)})},e.prototype.createElement=function(e,n){if("CATVidCtlButton"===e){var r=new t;return r.label=n.Label,r.Name=n.Name,r.displayStyle="flyout",r.elements.button.style.cssText="justify-content : left",r}},e.prototype.setClickEventName=function(){return"click"},e.prototype.getCapacities=function(){if(this.capacities&&this.capacities!==[])return this.capacities;var e=[],t=this.actor,n=t.behaviors,r=function(e){var t=e.name;return!["hide","show","activate","deactivate"].includes(t)&&""===e._naturalLanguageInfo._exposedVariableName&&"SensorState"!==e._naturalLanguageInfo._capacityType},i=[],a=[];t._services&&(i=i.concat(t._services.filter(r))),t._functions&&(a=a.concat(t._functions.filter(r)));for(var o=0;o<n.length;o++)n[o]._services&&(i=n[o]._services.concat(i)),n[o]._functions&&(a=n[o]._functions.concat(a));return(e=(e=e.concat(i,a,[])).filter(r)).map((function(e){return e.name}))},e.prototype.visibleFlagSpelling=function(){return"visibleFlag"},e.prototype.setVisibility=function(e,t){e.setVisibility(t),this.CATI3DExperienceObject.getModelObject()._experienceBase.getManager("CAT3DXVisuManager").forceViewerRefresh()},e.prototype.toggleVisibility=function(e){var t=e.visible;e.setVisibility(!t),this.CATI3DExperienceObject.getModelObject()._experienceBase.getManager("CAT3DXVisuManager").forceViewerRefresh()},e})),define("DS/XCTWebExperienceAppPlay/extensions/CATECXPExperienceScenesMgrPlay",["UWA/Core","DS/CAT3DExpModel/CAT3DXModel","DS/CATCXPModel/extensions/CATECXPExperienceScenesMgr"],(function(e,t,n){"use strict";return e.Class.extend(n,{Build:function(){this._parent(),this._switchedscenes=[],this._lastSceneChanged=void 0,this.listenTo(this.GetObject()._experienceBase.getManager("CXPWebPlayManager"),"PlayStateChanged",(function(){this._OnPlayStateChanged()}))},Dispose:function(){delete this._switchedscenes,delete this._lastSceneChanged,this._parent()},_OnPlayStateChanged:function(){var e=this.GetObject()._experienceBase.getManager("CXPWebPlayManager");if(e&&e.ePlayState.eStart===e.getPlayState()){var t=this.GetCurrentScene();t&&(this._switchedscenes.push(t),this._lastSceneChanged=t)}else e&&e.ePlayState.eStop===e.getPlayState()&&(this._switchedscenes.splice(0,this._switchedscenes.length),this._lastSceneChanged=void 0)},_OnSceneChanged:async function(e){var t=this.GetObject()._experienceBase.getManager("CXPWebPlayManager");if(t&&t.ePlayState.ePlaying!==t.getPlayState())return this._parent(e);if(e!==this._lastSceneChanged){var n=this._parent;await this._manageLastSceneAtPlay(this._lastSceneChanged),this._lastSceneChanged=e,n.call(this,e),await this._manageNewSceneAtPlay(e)}},_manageLastSceneAtPlay:async function(e){var n=this.GetObject()._experienceBase.getManager("CXPWebPlayManager");if(!n||n.ePlayState.ePlaying===n.getPlayState()){var r=t.GetExperience(),i=this.GetObject()._experienceBase.getManager("CAT3DExperienceESExportManager").getProjectedESObject(r);if(i&&e){var a=this.GetObject()._experienceBase.getManager("CAT3DExperienceESExportManager").getProjectedESObject(e);a&&i.handlePreviousSceneSwitch(a)}}},_manageNewSceneAtPlay:async function(n){var r=this.GetObject()._experienceBase.getManager("CXPWebPlayManager");if(!r||r.ePlayState.ePlaying===r.getPlayState()){var i=t.GetExperience(),a=this.GetObject()._experienceBase.getManager("CAT3DExperienceESExportManager").getProjectedESObject(i);if(a&&n){var o=this.GetObject()._experienceBase.getManager("CAT3DExperienceESExportManager").getProjectedESObject(n);if(o){-1!==this._switchedscenes.indexOf(n)?await this._ResetValues(n):this._switchedscenes.push(n);var s=this.GetObject()._experienceBase.getManager("CAT3DXUIManager").waitUIActorsReady(),c=this.GetObject()._experienceBase.getManager("CAT3DXVisuManager").waitContentReady();return e.Promise.all([s,c]).then((function(){a.handleNewSceneSwitch(o)}))}}}},_ResetValues:async function(e){e.QueryInterface("CATI3DExperienceObject").GetValueByName("_rebuildPlay")&&(e.QueryInterface("CATI3DXVolatileEO").restorePersistent(),e.QueryInterface("CATI3DXVolatileEO").setVolatile(),await this.GetObject()._experienceBase.getManager("CAT3DExperienceESExportManager").export(e))}})})),define("DS/XCTWebExperienceAppPlay/managers/XCTEWSEPublishToSwymExperienceMgr",["UWA/Core","UWA/Class","UWA/Class/Listener","DS/CATCXPModel/CATCXPRenderUtils","DS/CAT3DExpModel/interfaces/CATI3DExperienceObject","DS/CAT3DExpModel/XCTEWSTracesHelper"],(function(e,t,n,r,i,a){"use strict";return t.extend(n,{Dispose:function(){delete this._playerOptions},onExperienceReady:async function(e){const t=this.GetObject()._experienceBase,n=this._getPlayerOptions().playExperience,r=n&&n.onModelLoadingProgression?n.onModelLoadingProgression:function(){},i=n&&n.onModelLoadingCompleted?n.onModelLoadingCompleted:function(){};r({loaded:75,total:100});const o=a.createTrace("EWS_LoadExperienceVisualization"),s=e.QueryInterface("CATI3DGeoVisu");t.getManager("CAT3DXVisuManager").setRoot(s),t.getManager("CAT3DXVisuManager").setContent(s),t.getManager("CAT3DXEnvironmentManager").setExperience(e),await t.getManager("CAT3DXVisuManager").waitContentReady(),await t.getManager("CAT3DXEnvironmentManager").waitEnvironmentReady(),await t.getManager("CAT3DXVisuManager").forceConvolutionComputation(),r({loaded:90,total:100});const c=e.QueryInterface("CATI3DExperienceObject");let u=c.GetValueByName("currentCamera");if(!u&&c.HasVariable("startupCamera")&&(u=c.GetValueByName("startupCamera")),!u){n.modelLoadComplete=void 0;t.getManager("CAT3DXVisuManager").getViewer().currentViewpoint.reframe(null,0)}o.end();const p=t.getManager("CAT3DXAVPComManager");let l=!0;p&&p.isAVPEnabled()&&(l=!1),!0===l&&await t.getManager("CXPWebPlayManager").play(),p&&p.sendCommandToSwift("experienceLoaded"),i()},onPreDisposeExperience:function(){const t=this.GetObject()._experienceBase;return t.getManager("CXPWebPlayManager").stop(),t.getManager("CAT3DXVisuManager").removeContent(),t.getManager("CAT3DXEnvironmentManager").removeExperience(),e.Promise.resolve()},_getPlayerOptions:function(){return this._playerOptions?this._playerOptions:{}},_setPlayerOptions:function(e){this._playerOptions=e}})})),define("DS/XCTWebExperienceAppPlay/StuMaterialsManager",["DS/StuRenderEngine/StuMaterialsManager","DS/StuModel/StuExperience"],(function(e,t){"use strict";return e.prototype.build=function(){return this},e.prototype.getMaterialName=function(e){var t=this.getMaterial(e);return t?t.name:null},e.prototype.setMaterialByName=function(e,n){for(var r=t.getCurrent().CATI3DExperienceObject.GetValueByName("materials"),i=0;i<r.length;i++)r[i].name===n&&this.setMaterial(e,r[i].CATI3DExperienceObject)},e.prototype.removeMaterials=function(e){e.SetValueByName("materials",[])},e.prototype.setMaterial=function(e,t){var n=e.getModelObject(),r=n._experienceBase.getManager("CXPWebPlayManager");t?r.createVolatileObjectFromPrototype("CXPMaterialApplication_Spec","materialApplication",n,"materials",!0).done((function(e){e.CATI3DExperienceObject.SetValueByName("linktomaterial",t.getStuObject())})):e.SetValueByName("materials",[])},e.prototype.getMaterial=function(e){var t=e.GetValueByName("materials");return!t||!t.length>0?null:t[0].CATI3DExperienceObject.GetValueByName("linktomaterial")},e})),define("DS/XCTWebExperienceAppPlay/CXPWebEnvironmentsManager",["UWA/Core","DS/CAT3DExpModel/CAT3DXModel"],(function(e,t){"use strict";return e.Class.extend({getActiveEnvironmentName:function(){var e=t.GetExperience();if(e)return e.QueryInterface("CATICXPEnvironmentsMgr").GetActiveEnvironment().QueryInterface("CATIAlias").GetAlias()},setActiveEnvironmentByNumber:function(e){var n=t.GetExperience();if(n){var r=n.QueryInterface("CATICXPEnvironmentsMgr"),i=[];return r.ListEnvironments(i),0===e?r.SetActiveEnvironment():r.SetActiveEnvironment(i[e-1]),e}},getActiveEnvironmentNumber:function(){var e=t.GetExperience();if(!e)return 0;var n=e.QueryInterface("CATICXPEnvironmentsMgr"),r=[];n.ListEnvironments(r);var i=n.GetActiveEnvironment();return r.indexOf(i)+1},deActivateEnvironment:function(){var e=t.GetExperience();if(e)return e.QueryInterface("CATICXPEnvironmentsMgr").SetActiveEnvironment(),this.getActiveEnvironmentNumber()},setActiveEnvironmentByName:function(e){var n=t.GetExperience();if(n){var r=n.QueryInterface("CATICXPEnvironmentsMgr"),i=[];r.ListEnvironments(i);for(var a=0;a<i.length;a++)if(i[a].QueryInterface("CATIAlias").GetAlias()===e)return r.SetActiveEnvironment(i[a]),this.getActiveEnvironmentNumber()}},initStartupEnvironment:function(){var e=t.GetExperience();if(e){var n=e.QueryInterface("CATICXPEnvironmentsMgr"),r=n.GetStartupEnvironment();return r&&n.SetActiveEnvironment(r),this.getActiveEnvironmentNumber()}},getExperienceScaleFactor:function(){return 1},getActiveLocation:function(){var e=t.GetExperience();if(e)return e.QueryInterface("CATICXPEnvironmentsMgr").GetActiveLocation()}})})),define("DS/XCTWebExperienceAppPlay/CXPWebGeomPrimitiveISOManager",["UWA/Core","DS/StuCore/StuContext","DS/Visualization/SceneGraphFactory","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Mesh/Mesh","DS/SceneGraphNodes/ArrowNode","DS/SceneGraphNodes/FixedSizeArrowNode","DS/SceneGraphOverrides/SceneGraphOverrideSet","DS/Visualization/PathElement","DS/SceneGraphNodes/FixedSizeNode3D","DS/MathematicsES/MathsDef"],(function(e,t,n,r,i,a,o,s,c,u,p,l){"use strict";var f=e.Class.singleton({init:function(){this._GeomPrimitiveRootNode=new i,this._GeomPrimitiveRootNode.pickable=!1,this._sceneGraphOS=new c(this._GeomPrimitiveRootNode),this._primitiveNodes={},this._uIDNode=0},deleteAll:function(){for(var e in this._sceneGraphOS.deleteOverrides(this._sceneGraphOS.getOverrides()),this._GeomPrimitiveRootNode.removeChildren(),this._primitiveNodes)this._primitiveNodes.hasOwnProperty(e)&&delete this._primitiveNodes[e];this._viewer&&this._viewer.render()},setViewer:function(e){this._viewer&&(this._viewer.removeNode(this._GeomPrimitiveRootNode),this._viewer.getSceneGraphOverrideSetManager()&&this._viewer.getSceneGraphOverrideSetManager().removeSceneGraphOverrideSet(this._sceneGraphOS)),this._viewer=e,e.addNode(this._GeomPrimitiveRootNode),this._viewer.getSceneGraphOverrideSetManager().pushSceneGraphOverrideSet(this._sceneGraphOS)},_createNewRep:function(n,a,o){var s;if(s=o.screenSize?new p({ratio:t.RenderManager.getInstance().getPixelDensity()}):new i,this._GeomPrimitiveRootNode.addChild(s),a instanceof l.Transformation){var c=a.getArray(),f=new r.Matrix4(c[0],c[3],c[6],c[9],c[1],c[4],c[7],c[10],c[2],c[5],c[8],c[11],0,0,0,1);s.setMatrix(f)}else s.setMatrix(a);s.addChild(n);var d=this._uIDNode;this._primitiveNodes[d]=s,this._uIDNode++;var y=e.is(o.alpha)?o.alpha/255:1,h=o.color?"rgb("+o.color.r+","+o.color.g+","+o.color.b+")":"rgb(150,150,150)",C=new u([this._GeomPrimitiveRootNode,s]),m=this._sceneGraphOS.createOverride(C);return m.setOpacity(y,!1),m.setColor(h,!1),this._viewer&&this._viewer.render(),d},createBox:function(t){var i,a,o,s,c,u,p,l=!!e.is(t.closed)&&t.closed,f=Boolean(t.centered);t.box?(i=new r.Vector3(t.box.low.x,t.box.low.y,t.box.low.z),a=new r.Vector3(t.box.high.x-t.box.low.x,0,0),o=new r.Vector3(0,t.box.high.y-t.box.low.y,0),s=new r.Vector3(0,0,t.box.high.z-t.box.low.z)):("number"==typeof t.size?(c=t.size,u=t.size,p=t.size):(c=t.size.x,u=t.size.y,p=t.size.z),f?(i=new r.Vector3(t.position.vector.x-c/2,t.position.vector.y-u/2,t.position.vector.z-p/2),a=new r.Vector3(c/2,0,0),o=new r.Vector3(0,u/2,0),s=new r.Vector3(0,0,p/2)):(i=new r.Vector3(t.position.vector.x,t.position.vector.y,t.position.vector.z),a=new r.Vector3(c,0,0),o=new r.Vector3(0,u,0),s=new r.Vector3(0,0,p)));var d=n.createCuboidNode({cornerPoint:i,firstAxis:a,secondAxis:o,thirdAxis:s,fill:l,material:new r.PhysicalMaterial({force:!0})});return this._createNewRep(d,t.position,t)},createSphere:function(e){var t=e.radius,i=n.createSphereNode({radius:t,material:new r.PhysicalMaterial({force:!0})});return this._createNewRep(i,e.position,e)},createPoint:function(e){return e.screenSize=!0,e.radius=e.size,this.createSphere(e)},createVector:function(e){var t=this._CreateLineOrVector(e,!0);return this._createNewRep(t.rep,t.transform,e)},createLine:function(e){var t=this._CreateLineOrVector(e,!1);return this._createNewRep(t.rep,t.transform,e)},_CreateLineOrVector:function(e,t){var i,a=new r.Vector3;if(e.startPoint&&e.endPoint){var o=e.endPoint.clone().addScaledVector(e.startPoint,-1);a.set(o.x,o.y,o.z),i=a.distanceTo(new r.Vector3)}else i=e.length,a.set(e.direction.x,e.direction.y,e.direction.z);var s=new r.Vector3;s.set(e.startPoint.x,e.startPoint.y,e.startPoint.z);var c,u=e.width?e.width:.01*i;if(t){var p=e.headLength?e.headLength:.1*i,l=e.headWidth?e.headWidth:3*u;i-=p,c=n.createConeNode({bottomCenterPoint:new r.Vector3(0,0,i),topCenterPoint:new r.Vector3(0,0,i+p),topRadius:0,bottomRadius:l,material:new r.PhysicalMaterial({force:!0})})}var f=n.createCylinderNode({bottomCenterPoint:new r.Vector3(0,0,0),topCenterPoint:new r.Vector3(0,0,i),radius:u,material:new r.PhysicalMaterial({force:!0})});c&&f.addChild(c);var d=new r.Vector3(0,0,1);d.cross(a.clone()),0===d.length()&&(d.set(0,1,0),d.cross(a.clone()));var y=new r.Matrix4;return y.lookAt(a,new r.Vector3,d),y.setPosition(s),{rep:f,transform:y}},createAxis:function(e){var t=e.size,n={startPoint:new l.Vector3D(0,0,0),length:t};n.direction=new l.Vector3D(1,0,0);var r=this._CreateLineOrVector(n,!0);n.direction=new l.Vector3D(0,1,0);var a=this._CreateLineOrVector(n,!0);n.direction=new l.Vector3D(0,0,1);var o=this._CreateLineOrVector(n,!0),s=new i;return s.addChild(r.rep),s.addChild(a.rep),s.addChild(o.rep),r.rep.setMatrix(r.transform),a.rep.setMatrix(a.transform),o.rep.setMatrix(o.transform),this._createNewRep(s,e.position,e)},setColor:function(t,n,r,i,a){var o=this._primitiveNodes[t];if(o){var s=e.is(a)?a/255:1,c="rgb("+(e.is(n)?n:150)+","+(e.is(r)?r:150)+","+(e.is(i)?i:150)+")",p=new u([this._GeomPrimitiveRootNode,o]),l=this._sceneGraphOS.getUniqueOverrideFromPathElement(p);l.setOpacity(s,!1),l.setColor(c,!1),this._viewer&&this._viewer.render()}},setPosition:function(e,t){var n=this._primitiveNodes[e];if(n&&t instanceof l.Transformation){var i=t.getArray(),a=new r.Matrix4(i[0],i[3],i[6],i[9],i[1],i[4],i[7],i[10],i[2],i[5],i[8],i[11],0,0,0,1);n.setMatrix(a)}},ExternalizeSharedTransfo:function(e){this._sharedTransfo=e},CleanSharedTransfo:function(e){return e},SetPosFromSharedTransfo:function(e){if(this._primitiveNodes.hasOwnProperty(e)){var t=this._primitiveNodes[e];if(t){var n=this._sharedTransfo;if(n&&n[12]>0){var i=new r.Matrix4(n[0],n[3],n[6],n[9],n[1],n[4],n[7],n[10],n[2],n[5],n[8],n[11],0,0,0,1);t.setMatrix(i)}}}}});return f.__proto__.delete=function(e){var t=this._primitiveNodes[e];if(t){var n=new u([this._GeomPrimitiveRootNode,t]),r=this._sceneGraphOS.getUniqueOverrideFromPathElement(n);this._sceneGraphOS.deleteOverride(r),this._GeomPrimitiveRootNode.removeChild(t),delete this._primitiveNodes[e],this._viewer&&this._viewer.render()}},f.init(),f.deleteAll(),f})),define("DS/XCTWebExperienceAppPlay/StuProfilingServices",["DS/StuCore/StuProfilingServices"],(function(e){"use strict";e.prototype.IsAnalyzerActive=function(){return!1}})),define("DS/XCTWebExperienceAppPlay/StuProxy/StuProxy",["UWA/Core","UWA/Class"],(function(e){"use strict";return e.Class.extend({init:function(e,t){this._modelObject=e,this._stuObject=t},dispose:function(){delete this._modelObject,delete this._stuObject},getModelObject:function(){return this._modelObject},getStuObject:function(){return this._stuObject}})})),define("DS/XCTWebExperienceAppPlay/managers/XCTEWSECXPWebExperienceMgr",["UWA/Core","UWA/Class","UWA/Class/Listener","DS/CATCXPModel/CATCXPRenderUtils","DS/CAT3DExpModel/interfaces/CATI3DExperienceObject","DS/CAT3DExpModel/XCTEWSTracesHelper"],(function(e,t,n,r,i,a){"use strict";return t.extend(n,{Dispose:function(){delete this._playerOptions},onExperienceReady:async function(t){const n=this.GetObject()._experienceBase,o=this._getPlayerOptions();let s=o.autoPlay;const c=o.progressiveLoading,u=o.playExperience,p=u&&u.onModelLoadingProgression?u.onModelLoadingProgression:function(){},l=u&&u.onModelLoadingCompleted?u.onModelLoadingCompleted:function(){};p({loaded:75,total:100});let f=!0;const d=t.QueryInterface("CATI3DExperienceObject")._GetExpDataObject(),y=d.GetValueByName("scenes");y.length>0&&d._AddVariableSession("currentScene",i.VarType.Object,1,i.ValuationMode.ReferencingValue,"CXPScene_Spec","currentScene",y[0]),t.QueryInterface("CATICXPScenesMgr");const h=a.createTrace("EWS_LoadExperienceVisualization"),C=t.QueryInterface("CATI3DGeoVisu");n.getManager("CAT3DXVisuManager").setRoot(C),n.getManager("CAT3DXVisuManager").setContent(C),n.getManager("CAT3DXEnvironmentManager").setExperience(t),c&&(u.modelLoadComplete=void 0);const m=t.QueryInterface("CATI3DExperienceObject");let g=m.GetValueByName("currentCamera");if(!g&&m.HasVariable("startupCamera")&&(g=m.GetValueByName("startupCamera")),g){if(c){const e=n.getManager("CAT3DXVisuManager").getViewer();r.setViewpointFromCamera(e.currentViewpoint,g,0)}f=!1}if(await n.getManager("CAT3DXVisuManager").waitContentReady(),await n.getManager("CAT3DXEnvironmentManager").waitEnvironmentReady(),"false"!==localStorage.getItem("CXPWeb_ForceConvolutionComputation")&&await n.getManager("CAT3DXVisuManager").forceConvolutionComputation(),n.getManager("CAT3DXUIManager").setExperience(t),await n.getManager("CAT3DXUIManager").waitUIActorsReady(),p({loaded:90,total:100}),f){u.modelLoadComplete=void 0;n.getManager("CAT3DXVisuManager").getViewer().currentViewpoint.reframe(null,0)}h.end();const S=n.getManager("CAT3DXAVPComManager");S&&S.isAVPEnabled()&&(s=!1),e.is(s)&&!0!==s||await n.getManager("CXPWebPlayManager").play(),S&&S.sendCommandToSwift("experienceLoaded"),l()},onPreDisposeExperience:function(){const t=this.GetObject()._experienceBase;return t.getManager("CXPWebPlayManager").stop(),t.getManager("CAT3DXVisuManager").removeContent(),t.getManager("CAT3DXUIManager").removeExperience(),t.getManager("CAT3DXEnvironmentManager").removeExperience(),e.Promise.resolve()},_getPlayerOptions:function(){return this._playerOptions?this._playerOptions:{}},_setPlayerOptions:function(e){this._playerOptions=e}})})),define("DS/XCTWebExperienceAppPlay/commands/XCTWebStopCmd",["UWA/Core","UWA/Class/Listener","DS/ApplicationFrame/Command","DS/XCTWebExperienceAppPlay/commands/XCTCmdPlayListenerHelper"],(function(e,t,n,r){"use strict";return e.Class.extend(n,t,{init:function(e){this._parent(e,{isAsynchronous:!0});const t=this.getFrameWindow();this._disposeListener=r.listen(t,((e,t)=>{t.ePlayState.ePlaying===e||t.ePlayState.ePause===e?this.enable():this.disable()}))},execute:function(){var e=this.getFrameWindow()._experienceBase,t=this;e.getManager("CXPWebPlayManager").stop().done((function(){t.end()}))},dispose:function(){this._disposeListener&&this._disposeListener()}})})),define("DS/XCTWebExperienceAppPlay/commands/XCTWebPlayCmd",["UWA/Core","UWA/Class/Listener","DS/ApplicationFrame/Command","DS/XCTWebExperienceAppPlay/commands/XCTCmdPlayListenerHelper"],(function(e,t,n,r){"use strict";return e.Class.extend(n,t,{init:function(e){this._parent(e,{isAsynchronous:!0});const t=this.getFrameWindow();this._disposeListener=r.listen(t,((e,t)=>{t.ePlayState.eStop===e||t.ePlayState.ePause===e?this.enable():this.disable()}))},execute:function(){var e=this.getFrameWindow()._experienceBase,t=this;e.getManager("CXPWebPlayManager").play().done((function(){t.end()}))},dispose:function(){this._disposeListener&&this._disposeListener()}})})),define("DS/XCTWebExperienceAppPlay/commands/XCTWebPauseCmd",["UWA/Core","UWA/Class/Listener","DS/ApplicationFrame/Command","DS/XCTWebExperienceAppPlay/commands/XCTCmdPlayListenerHelper"],(function(e,t,n,r){"use strict";return e.Class.extend(n,t,{init:function(e){this._parent(e,{isAsynchronous:!1});const t=this.getFrameWindow();this._disposeListener=r.listen(t,((e,t)=>{t.ePlayState.ePlaying===e?this.enable():this.disable()}))},execute:function(){this.getFrameWindow()._experienceBase.getManager("CXPWebPlayManager").pause()},dispose:function(){this._disposeListener&&this._disposeListener()}})})),define("DS/XCTWebExperienceAppPlay/CXPWebRenderManager",["DS/StuRenderEngine/StuRenderManager","DS/XCTWebExperienceAppPlay/CXPWebViewer","DS/XCTWebExperienceAppPlay/CXPWebViewpoint","DS/XCTWebExperienceAppPlay/CXPWebGeomPrimitiveISOManager","DS/XCTWebExperienceAppPlay/CXPWebEnvironmentsManager"],(function(e,t,n,r,i){"use strict";var a=e.prototype.onStart;e.prototype.onStart=function(){a.call(this),this.main3DViewer&&this.main3DViewer.onStart()};var o=e.prototype.onStop;e.prototype.onStop=function(){o.call(this),this.main3DViewer&&this.main3DViewer.onStop()},e.prototype.buildViewer=function(){return new t(this._WebViewer)},e.prototype.setViewer=function(e){this._WebViewer=e,r.setViewer(e)},e.prototype.setViewpoint=function(e){this._WebViewpoint=e},e.prototype.buildViewpoint=function(){return new n(this._WebViewpoint)},e.prototype.buildGeomPrimitive_ISOManager=function(){return r},e.prototype.buildGlobeServices=function(){return null},e.prototype.buildEnvironmentsManager=function(){return new i},e.prototype.getPixelDensity=function(){return 96/25.4};var s=e.prototype.onPostExecute;return e.prototype.onPostExecute=function(){s.call(this);var e=this.getCurrentCamera();e&&this.main3DViewpoint.__setViewpointFromCamera(e)},e})),define("DS/XCTWebExperienceAppPlay/CXPWebiVScenario",["DS/StudioIV/StuiVScenario","DS/XCTWebExperienceAppPlay/CXPWebiVWrapper"],(function(e,t){"use strict";return e.prototype.buildWrapper=function(){return new t},e})),define("DS/XCTWebExperienceAppPlay/CXPWebRaytrace",["DS/StuRaytrace/StuRaytrace","DS/XCTWebExperienceAppPlay/CXPWebRaytraceWrapper"],(function(e,t){"use strict";e.prototype.buildWrapper=function(){return new t}})),define("DS/XCTWebExperienceAppPlay/CXPWebViveManager",["DS/StudioIV/StuViveManager","DS/XCTWebExperienceAppPlay/CXPWebHMDWrapper"],(function(e,t){"use strict";return e.prototype.buildHMDWrapper=function(){return new t},e})),define("DS/XCTWebExperienceAppPlay/StuProxy/StuCATICXPActivable",["UWA/Core","DS/XCTWebExperienceAppPlay/StuProxy/StuProxy","UWA/Class/Listener"],(function(e,t,n){"use strict";return t.extend(n,{init:function(e,t){this._parent(e,t),this._modelCATICXPActivable=e.QueryInterface("CATICXPActivable"),this._LastSelfActiveFromWeb=!1,this.listenTo(e.QueryInterface("CATI3DExperienceObject"),"selfActive.CHANGED",(e=>{this._LastSelfActiveFromWeb!==e&&(e?t.activate():t.deactivate())}))},dispose:function(){delete this._modelCATICXPActivable,this._parent(),delete this._LastSelfActiveFromWeb,this.stopListening()},setSelfActivity:function(e){this._LastSelfActiveFromWeb=e}})})),define("DS/XCTWebExperienceAppPlay/StuProxy/StuCATI3DGeoVisu",["UWA/Core","DS/XCTWebExperienceAppPlay/StuProxy/StuProxy"],(function(e,t){"use strict";return t.extend({})})),define("DS/XCTWebExperienceAppPlay/StuSubProductActorWeb",["DS/StuRenderEngine/StuSubProductActor","DS/XCTWebExperienceAppPlay/StuVisuServices"],(function(e,t){"use strict";return e.prototype.buildPLMServices=function(){return console.error("GetPLMProperties Javascript API is not available in Web."),new t},e})),define("DS/XCTWebExperienceAppPlay/StuProxy/StuCATI3DExperienceObject",["UWA/Core","DS/XCTWebExperienceAppPlay/StuProxy/StuProxy","DS/CAT3DExpModel/interfaces/CATI3DExperienceObject","DS/StuRenderEngine/StuColor","DS/StuModel/StuExperience","DS/StuModel/StuActorTemplate","DS/StuRenderEngine/StuActor3D","UWA/Class/Listener","DS/VCXWebProperties/VCXColor"],(function(e,t,n,r,i,a,o,s,c){"use strict";return t.extend({init:function(e,t){this._parent(e,t),this._modelCATI3DExperienceObject=e.QueryInterface("CATI3DExperienceObject"),this._ESExportManager=e._experienceBase.getManager("CAT3DExperienceESExportManager")},dispose:function(){delete this._modelCATI3DExperienceObject,delete this._ESExportManager,this._parent()},GetValueByName:function(e){var t=this._modelCATI3DExperienceObject.GetVariableType(e);return t===n.VarType.Object?this._GetValueByNameObject(e):t===n.VarType.Color?this._GetValueByNameColor(e):this._modelCATI3DExperienceObject.GetValueByName(e)},_GetValueByNameObject:function(e){var t,n=this._modelCATI3DExperienceObject.GetValueByName(e);if(n)if(Array.isArray(n)){t=[];for(var r=0;r<n.length;r++)if(n[r].QueryInterface("StuIPrototypeBuild")){var i=this._ESExportManager.getProjectedESObject(n[r]);i&&t.push(i)}}else n.QueryInterface("StuIPrototypeBuild")&&(t=this._ESExportManager.getProjectedESObject(n));return t},_GetValueByNameColor:function(e){var t,n=this._modelCATI3DExperienceObject.GetValueByName(e);if(n){var i=n.GetThreeColor();t=new r(255*i.r,255*i.g,255*i.b)}return t},SetValueByName:function(e,t){var r=this._modelCATI3DExperienceObject.GetVariableType(e);r===n.VarType.Object?this._SetValueByNameObject(e,t):r===n.VarType.Color?this._SetValueByNameColor(e,t):this._modelCATI3DExperienceObject.SetValueByName(e,t)},_SetValueByNameObject:function(e,t){if(t)if(Array.isArray(t)){for(var n=[],r=0;r<t.length;r++)n.push(t[r].CATI3DExperienceObject.getModelObject());this._modelCATI3DExperienceObject.SetValueByName(e,n)}else this._modelCATI3DExperienceObject.SetValueByName(e,t.CATI3DExperienceObject.getModelObject());else this._modelCATI3DExperienceObject.SetValueByName(e,t)},_SetValueByNameColor:function(e,t){this._modelCATI3DExperienceObject.SetValueByName(e,(new c).FromRGBA(t.r/255,t.g/255,t.b/255,1))},createDynamicInstance:function(t={},n,r){if(this.getStuObject()instanceof a){var o=n.CATI3DExperienceObject.getModelObject(),s=(t.parent?t.parent:i.getCurrent()).CATI3DExperienceObject.getModelObject(),c=t.name?t.name:n.name;if(!e.is(t.incrementName)||!0===t.incrementName){const e=s.QueryInterface("CATI3DExperienceObject").GetValueByName("actors").map((e=>e.QueryInterface("CATI3DExperienceObject").GetValueByName("_varName")));if(-1!==e.indexOf(c)){let t=2;const n=c;for(;-1!==e.indexOf(c);)c=n+" "+t,t++}}var u,p=this;this.getModelObject()._experienceBase.getManager("CXPWebPlayManager").createVolatileeObjectFromTemplate(o,c,s,"actors").then((function(e){return(u=e)._isVolatile=!0,p._getVisuReady(u)})).then((function(){t.onInstantiationSuccess&&t.onInstantiationSuccess.call(t.callbackCaller?t.callbackCaller:this,u),r.call(n,u),u.initialize(),u.activate(!0),u.isActive()?t.onActivationSuccess&&t.onActivationSuccess.call(t.callbackCaller?t.callbackCaller:this,u):p._throwFailure("Dynamic instance activation failed",t.onFailure)})).catch((function(){p._throwFailure("Create Dynamic instance failed",t.onFailure)}))}else this._throwFailure("this method should be called on ActorTemplates only",t.onFailure)},_getVisuReady:function(t){var n=t.CATI3DExperienceObject.getModelObject().QueryInterface("CATI3DGeoVisu");if(!n)return e.Promise.resolve();if(n.isReady())return e.Promise.resolve();let r=e.Promise.deferred();var i=new s;return i.listenTo(n,"readyChanged",(function(e){e&&(i.stopListening(n,"readyChanged"),setTimeout((function(){r.resolve()})))})),r.promise},_throwFailure:function(e,t){console.warn(e),t&&t(e)},IsDynamicInstance:function(){return!0===this.getStuObject()._isVolatile},delete:function(){this.getStuObject().dispose();var e=this.getModelObject();e._experienceBase.getManager("CXPWebPlayManager").removeVolatileObject(e)},getAssetLinkStatus:function(){return o.EAssetLinkStatus.eOK}})})),define("DS/XCTWebExperienceAppPlay/extensions/StuEExperienceBasePrototypeBuild",["UWA/Core","text!DS/XCTWebExperienceAppPlay/assets/XCTWebExperienceAppPlayPrototypeBuild.json","DS/XCTWebExperienceAppPlay/StuProxy/StuCATI3DExperienceObject","DS/XCTWebExperienceAppPlay/StuProxy/StuCATICXPActivable"],(function(e,t,n,r){"use strict";var i=JSON.parse(t);for(let e in i)i.hasOwnProperty(e)&&(i[e]={path:i[e]});return e.Class.extend({getESPrototype:function(){var t=this._getESPrototype();if(!t)return e.Promise.reject(new Error("Cant retrieve ES Prototype for expObject "+this.GetObject().GetType()));if(i[t].prototype)return e.Promise.resolve(i[t].prototype);if(i[t].prototypePromise)return i[t].prototypePromise;var n=e.Promise.deferred();return i[t].prototypePromise=n.promise,require([i[t].path],(e=>{i[t].prototype=e,n.resolve(e),delete i[t].prototypePromise})),n.promise},_getESPrototype:function(){for(var e=this.GetObject().GetTypes(),t=e.length-1;t>=0;t--){var n=e[t];if(i.hasOwnProperty(n))return n}},build:function(t){t.CATI3DExperienceObject||(t.CATI3DExperienceObject=new n(this.GetObject(),t)),t.CATICXPActivable||(t.CATICXPActivable=new r(this.GetObject(),t));return e.Promise.resolve([])},disposeESObject:function(e){e.CATI3DExperienceObject.dispose(),delete e.CATI3DExperienceObject,e.CATICXPActivable.dispose(),delete e.CATICXPActivable}})})),define("DS/XCTWebExperienceAppPlay/extensions/StuEVector3DPrototypeBuild",["UWA/Core","DS/XCTWebExperienceAppPlay/extensions/StuEExperienceBasePrototypeBuild","DS/MathematicsES/MathsDef"],(function(e,t,n){"use strict";return t.extend({getESPrototype:function(){return e.Promise.resolve(n.Vector3D)}})})),define("DS/XCTWebExperienceAppPlay/extensions/StuEBeScriptPrototypeBuild",["UWA/Core","DS/XCTWebExperienceAppPlay/extensions/StuEExperienceBasePrototypeBuild"],(function(e,t){"use strict";return t.extend({build:function(e){return e.__proto__.name=this.QueryInterface("CATI3DExperienceObject").GetValueByName("_varName"),this._parent(e)}})})),define("DS/XCTWebExperienceAppPlay/extensions/StuEVector2DPrototypeBuild",["UWA/Core","DS/XCTWebExperienceAppPlay/extensions/StuEExperienceBasePrototypeBuild","DS/MathematicsES/MathsDef"],(function(e,t,n){"use strict";return t.extend({getESPrototype:function(){return e.Promise.resolve(n.Vector2D)}})})),define("DS/XCTWebExperienceAppPlay/StuProxy/StuCATIMovable",["UWA/Core","DS/XCTWebExperienceAppPlay/StuProxy/StuProxy","DS/MathematicsES/MathsDef"],(function(e,t,n){"use strict";var r=null;return t.extend({init:function(e,t){this._parent(e,t),this._modelCATIMovable=e.QueryInterface("CATIMovable"),Object.defineProperty(this,"_ArrayBuffer",{enumerable:!0,configurable:!0,get:function(){return r},set:function(e){r=e}})},dispose:function(){delete this._modelCATIMovable,this._parent()},GetLocalPosition:function(){var e=new n.Transformation;this._modelCATIMovable.GetLocalPosition(e),this._transformToArrayBuffer(e)},SetLocalPosition:function(){var e=this._arrayBufferToTransform();this._modelCATIMovable.SetLocalPosition(null,e)},GetAbsPosition:function(){var e=new n.Transformation;this._modelCATIMovable.GetAbsPosition(e),this._transformToArrayBuffer(e)},SetAbsPosition:function(){var e=this._arrayBufferToTransform();this._modelCATIMovable.SetAbsPosition(e)},ExternalizeArray:function(e){this._ArrayBuffer=e},CleanArray:function(){this._ArrayBuffer=null},_transformToArrayBuffer:function(e){var t=e.getArray();this._ArrayBuffer[0]=t[0],this._ArrayBuffer[1]=t[1],this._ArrayBuffer[2]=t[2],this._ArrayBuffer[3]=t[3],this._ArrayBuffer[4]=t[4],this._ArrayBuffer[5]=t[5],this._ArrayBuffer[6]=t[6],this._ArrayBuffer[7]=t[7],this._ArrayBuffer[8]=t[8],this._ArrayBuffer[9]=t[9],this._ArrayBuffer[10]=t[10],this._ArrayBuffer[11]=t[11]},_arrayBufferToTransform:function(){var e=new n.Transformation;return e.setFromArray(Array.prototype.slice.call(this._ArrayBuffer)),e}})})),define("DS/XCTWebExperienceAppPlay/StuProxy/StuCATICXPGroupCall",["UWA/Core","DS/XCTWebExperienceAppPlay/StuProxy/StuProxy"],(function(e,t){"use strict";return t.extend({init:function(e,t){this._parent(e,t),this._modelCATICXPGroupCall=e.QueryInterface("CATICXPGroupCall")},dispose:function(){delete this._modelCATICXPGroupCall,this._parent()},getRelatedCapacities:function(e){var t=this._modelCATICXPGroupCall.GetRelatedCapacities(e),n=this.getModelObject()._experienceBase.getManager("CAT3DExperienceESExportManager");return t.map((function(e){return n.getProjectedESObject(e)}))}})})),define("DS/XCTWebExperienceAppPlay/extensions/StuECollectionCallPrototypeBuild",["UWA/Core","DS/XCTWebExperienceAppPlay/extensions/StuEExperienceBasePrototypeBuild","DS/XCTWebExperienceAppPlay/StuProxy/StuCATICXPGroupCall"],(function(e,t,n){"use strict";return t.extend({build:function(e){return e.CATICXPGroupCall||(e.CATICXPGroupCall=new n(this.GetObject(),e)),this._parent(e)},disposeESObject:function(e){e.CATICXPGroupCall.dispose(),delete e.CATICXPGroupCall,this._parent(e)}})})),define("DS/XCTWebExperienceAppPlay/StuProxy/StuIRepresentation",["UWA/Core","DS/XCTWebExperienceAppPlay/StuProxy/StuProxy","DS/Visualization/ThreeJS_DS","DS/MathematicsES/MathsDef"],(function(e,t,n,r){"use strict";return t.extend({GetBoundingSphere:function(e){var t,n=this._modelObject.QueryInterface("CATI3DGeoVisu"),i=n.GetPathElement(),a=this._modelObject._experienceBase.getManager("CAT3DXVisuManager").getViewer();t=n.GetOverride().getVisibility()?i.getBoundingSphere(a,"visibleSpace"):i.getBoundingSphere(a,"invisibleSpace"),e.center.x=t.center.x,e.center.y=t.center.y,e.center.z=t.center.z,e.radius=t.radius;const o=this.getModelObject().QueryInterface("CATIMovable");if(o){const t=new r.Transformation;o.GetLocalPosition(t),e.radius=t.getScaling().scale*e.radius;const n=this._modelObject.QueryInterface("CATI3DExperienceObject").GetParent();if(!n)return;const i=n.QueryInterface("CATIMovable");if(!i)return;const a=new r.Transformation;i.GetAbsPosition(a),e.center.applyTransformation(a.getInverse())}},GetBoundingBox:function(e,t,r){let i=this._getBoundingBox();if(0===r){var a=t.getArray(),o=new n.Matrix4(a[0],a[3],a[6],a[9],a[1],a[4],a[7],a[10],a[2],a[5],a[8],a[11],0,0,0,1);i.applyMatrix4(o)}!0===i.isNaN()&&(i=new n.Box3(new n.Vector3,new n.Vector3)),e.high.x=i.max.x,e.high.y=i.max.y,e.high.z=i.max.z,e.low.x=i.min.x,e.low.y=i.min.y,e.low.z=i.min.z},GetOrientedBoundingBox:function(e,t,r){t=t||{};let i=this._getBoundingBox(t.excludeChildren);var a=t.orientation?t.orientation.getArray():[1,0,0,0,1,0,0,0,1,0,0,0],o=r.getArray(),s=new n.Matrix4(o[0],o[3],o[6],o[9],o[1],o[4],o[7],o[10],o[2],o[5],o[8],o[11],0,0,0,1),c=new n.Matrix4(a[0],a[3],a[6],a[9],a[1],a[4],a[7],a[10],a[2],a[5],a[8],a[11],0,0,0,1),u=new n.Matrix4;u=u.getInverse(c);var p=new n.Matrix4;p.multiplyMatrices(s,u),i.applyMatrix4(p),!0===i.isNaN()&&(i=new n.Box3(new n.Vector3,new n.Vector3)),e.high.x=i.max.x,e.high.y=i.max.y,e.high.z=i.max.z,e.low.x=i.min.x,e.low.y=i.min.y,e.low.z=i.min.z},_getBoundingBox:function(e=!1){const t=this._modelObject.QueryInterface("CATI3DGeoVisu");let r=t.GetPathElement();if(e){const e=t.GetLocalNodes();if(!e)return new n.Box3(new n.Vector3,new n.Vector3);r=r.clone(),r.externalPath.push(e)}var i=this._modelObject._experienceBase.getManager("CAT3DXVisuManager").getViewer();return t.GetOverride().getVisibility()?r.getBoundingBox(null,i,"visibleSpace"):r.getBoundingBox(null,i,"invisibleSpace")}})})),define("DS/XCTWebExperienceAppPlay/StuProxy/StuCATI3DXGraphicalProperties",["UWA/Core","DS/XCTWebExperienceAppPlay/StuProxy/StuProxy"],(function(e,t){"use strict";return t.extend({init:function(e,t){this._parent(e,t),this._modelCATI3DXGraphicalProperties=e.QueryInterface("CATI3DXGraphicalProperties")},dispose:function(){delete this._modelCATI3DXGraphicalProperties,this._parent()},GetPickMode:function(){return this._modelCATI3DXGraphicalProperties.GetPickMode()},SetPickMode:function(e){this._modelCATI3DXGraphicalProperties.SetPickMode(e)},GetShowMode:function(){return this._modelCATI3DXGraphicalProperties.GetShowMode()},SetShowMode:function(e){this._modelCATI3DXGraphicalProperties.SetShowMode(e)},GetOpacity:function(){return this._modelCATI3DXGraphicalProperties.GetOpacity()},SetOpacity:function(e){this._modelCATI3DXGraphicalProperties.SetOpacity(e)},GetRed:function(){return this._modelCATI3DXGraphicalProperties.GetRed()},GetGreen:function(){return this._modelCATI3DXGraphicalProperties.GetGreen()},GetBlue:function(){return this._modelCATI3DXGraphicalProperties.GetBlue()},SetColor:function(e,t,n){this._modelCATI3DXGraphicalProperties.SetColor(e,t,n)}})})),define("DS/XCTWebExperienceAppPlay/extensions/StuE3DActorPrototypeBuild",["UWA/Core","DS/XCTWebExperienceAppPlay/extensions/StuEExperienceBasePrototypeBuild","DS/XCTWebExperienceAppPlay/StuProxy/StuCATIMovable","DS/XCTWebExperienceAppPlay/StuProxy/StuIRepresentation","DS/XCTWebExperienceAppPlay/StuProxy/StuCATI3DGeoVisu","DS/XCTWebExperienceAppPlay/StuProxy/StuCATI3DXGraphicalProperties"],(function(e,t,n,r,i,a){"use strict";return t.extend({build:function(e){e.CATIMovable||(e.CATIMovable=new n(this.GetObject(),e)),e.StuIRepresentation||(e.StuIRepresentation=new r(this.GetObject(),e)),e.CATI3DGeoVisu||(e.CATI3DGeoVisu=new i(this.GetObject(),e)),e.CATI3DXGraphicalProperties||(e.CATI3DXGraphicalProperties=new a(this.GetObject(),e));var t=this,o=this._parent;return this._buildActorsList(e).then((function(){return o.call(t,e)})).then((function(e){return e.push("actors"),e.push("overrides"),e}))},_buildActorsList:function(t){for(var n=this.QueryInterface("CATI3DExperienceObject").GetValueByName("actors"),r=[],i=[],a=0;a<n.length;a++)r.push(this.GetObject()._experienceBase.getManager("CAT3DExperienceESExportManager")._createESObjectFrom3DExpObject(n[a],null).then((function(e){e.setParent(t),i.push(e)})));return e.Promise.allSettled(r).then((function(){t.subActors=i}))},disposeESObject:function(e){e.CATIMovable.dispose(),delete e.CATIMovable,e.StuIRepresentation.dispose(),delete e.StuIRepresentation,e.CATI3DGeoVisu.dispose(),delete e.CATI3DGeoVisu,e.CATI3DXGraphicalProperties.dispose(),delete e.CATI3DXGraphicalProperties,this._parent(e)}})})),define("DS/XCTWebExperienceAppPlay/extensions/StuESubProductActorPrototypeBuild",["UWA/Core","DS/XCTWebExperienceAppPlay/extensions/StuE3DActorPrototypeBuild","DS/XCTWebExperienceAppPlay/StuSubProductActorWeb"],(function(e,t){"use strict";return t.extend({_buildActorsList:function(t){for(var n=this.QueryInterface("CATI3DX3DActorAsset").getVisuOverrideChildren(),r=[],i=[],a=0;a<n.length;a++)r.push(this.GetObject()._experienceBase.getManager("CAT3DExperienceESExportManager")._createESObjectFrom3DExpObject(n[a],null).then((function(e){e.setParent(t),i.push(e)})));return e.Promise.allSettled(r).then((function(){t.subActors=i}))}})})),define("DS/XCTWebExperienceAppPlay/StuProductActorWeb",["DS/StuRenderEngine/StuProductActor","DS/XCTWebExperienceAppPlay/StuVisuServices"],(function(e,t){"use strict";return e.prototype.buildPLMServices=function(){return console.error("GetPLMProperties Javascript API is not available in Web."),new t},e})),define("DS/XCTWebExperienceAppPlay/extensions/StuEProductActorPrototypeBuild",["UWA/Core","DS/XCTWebExperienceAppPlay/extensions/StuE3DActorPrototypeBuild","DS/XCTWebExperienceAppPlay/StuProductActorWeb"],(function(e,t){"use strict";return t.extend({_buildActorsList:function(t){for(var n=this.QueryInterface("CATI3DX3DActorAsset").getVisuOverrideChildren(),r=this.QueryInterface("CATI3DExperienceObject").GetValueByName("actors").concat(n),i=[],a=[],o=0;o<r.length;o++)i.push(this.GetObject()._experienceBase.getManager("CAT3DExperienceESExportManager")._createESObjectFrom3DExpObject(r[o],null).then((function(e){e.setParent(t),a.push(e)})));return e.Promise.allSettled(i).then((function(){t.subActors=a}))}})}));