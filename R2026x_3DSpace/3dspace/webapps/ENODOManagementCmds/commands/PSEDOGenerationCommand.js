define("DS/ENODOManagementCmds/commands/PSEDOGenerationCommand",["UWA/Core","DS/ApplicationFrame/Command","DS/PADUtils/PADContext","i18n!DS/ENODOManagementCmdsLight/assets/nls/DOGeneratorCmd","DS/ENODOUtilsServices/DOServices"],(function(e,t,i,r,n){"use strict";return t.extend({_retrieveSelectionAndFiltersCV1:function(e,t){var i,n={selections:[]},s=[],o=[];for(i=0;i<t.length;i++){var a=t[i],l=a.getOccurencePath(),c=a.getID(),h=new RegExp("^[0-9a-f.]+$");if(!UWA.is(c)||!h.test(c.toLowerCase()))throw r.error.invalidPhID;var d=a.getRoot().getID(),g=s.indexOf(d);if(-1===g){s.push(d);var p=[l];o.push(p)}else o[g]&&o[g].push(l)}var f,u={V1:{}};for(f=0;f<s.length;f++){if((p={}).paths=o[f],void 0!==e.HasFilter&&"function"==typeof e.HasFilter){var v=e.HasFilter(s[f]);if(UWA.is(v.hasFilter)&&!0===v.hasFilter&&UWA.is(e.GetFilterSpec(s[f],u).CVQuery)){var m=e.GetFilterSpec(s[f],u).CVQuery;p.filter=m}}n.selections.push(p)}return console.log(n),n},_retrieveSelectionAndFilters:function(e,t){var i={selections:[]},n=[],s=[];for(p=0;p<t.length;p++){var o=t[p],a=o.getOccurencePath(),l=o.getID(),c=new RegExp("^[0-9a-f.]+$");if(!UWA.is(l)||!c.test(l.toLowerCase()))throw r.error.invalidPhID;var h=o.getRoot().getID(),d=n.indexOf(h);if(-1===d){n.push(h);var g=[a];s.push(g)}else s[d]&&s[d].push(a)}for(var p=0;p<n.length;p++){g={};var f=[],u=[];f.push(n[p]),g.paths=f;for(var v=0;v<s[p].length;v++){var m=s[p][v];Array.isArray(m)&&m.length>0&&u.push(m[m.length-1])}g.selectId=u;var D={filter:{all:1}};if(e.GetFilterSpec){var S=this.prefixPath(s[p]);D=e.GetFilterSpec(n[p],{V2:{prefixPathArray:S}}),g.filter=D.filter}i.selections.push(g)}return console.log(i),i},prefixPath:function(e){return e.map((e=>({physical_id_path:e})))},init:function(e){this._parent(e);var t=i.get(),r=t.options.model?t.options.model:t.getPADTreeDocument();r.getXSO().onPostAdd(this._check_select.bind(this)),r.getXSO().onPostRemove(this._check_select.bind(this)),r.getXSO().onEmpty(this._check_select.bind(this))},_check_select:function(){!0===i.get().getPADTreeDocument().getXSO().get().length>0?this.enable():this.disable()},execute:function(){var e=this,t=i.get(),s=t.options.model?t.options.model:t.getPADTreeDocument();require(["DS/ENODOManagementCmdsLight/commands/GenericDOGenerationCmd"],(function(i){var o=s.getSelectedNodes();try{var a;return a="ENOWSES_AP"==widget.data.appId?e._retrieveSelectionAndFiltersCV1(t,o):e._retrieveSelectionAndFilters(t,o),new i({command_id:e.options.ID,data:{selections:a.selections,context:widget.data.appId}})}catch(e){n._displayNotification("error",r.error.title,e)}}))}})}));