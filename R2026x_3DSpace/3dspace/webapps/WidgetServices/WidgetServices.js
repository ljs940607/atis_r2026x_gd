define("DS/WidgetServices/WidgetServices",["UWA/Array","UWA/Widget","UWA/Utils","UWA/Json","UWA/Core","DS/Controls/ProgressBar","DS/WAFData/WAFData"],(function(e,t,n,i,r,o,s){"use strict";var a=!1,l=!1,c=!1,u={},d={},g={},f=null,p={setReplayODT:function(e){a=e},isReplayODT:function(){return a},isReplayedODT:function(){return this.isReplayODT()||"infra_odt_wgd"===this.getWidgetId()||!0===window.isReplayODT},isTransientWidget:function(){var e=this.getWidgetId();return!!e&&0===e.indexOf("preview")},setODTMultiSel:function(e){l=e},isMultiSelODT:function(){return l},isTouchDevice:function(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0},setODTComment:function(e){c=e},isCommentODT:function(){return c},getProdLevel:function(){return this.isReplayODT()?0:2},generateUniqueId:function(){return(new Date).getTime()+""+10*Math.random()},commonChar:function(e,t,n){var i=e,r=t;i.length>r.length&&(i=t,r=e);for(var o={},s=0,a=0;a<i.length&&(0===s||!n);a++){var l=i[a];!o[l]&&r.indexOf(l)>=0&&s++,o[l]=!0}return s},removeDuplicate:function(t,n){var i=[];if(null!=t&&e.isArray(t)){var r={};t.forEach((function(e){var t=n(e);1!==r[t]&&(r[t]=1,i.push(e))}))}return i},arrayContains:function(e,t,n){return this.arrayContains2(e,t,(function(e,t){return n(e)==n(t)}))},arrayContains2:function(e,t,n){var i=-1;return e.every((function(e,r){return!n(e,t)||(i=r,!1)})),i},getImageUser:function(e,t){var n="";n=3==e?"fonticon fonticon-users-group":2==e?"fonticon fonticon-users":"fonticon fonticon-user";return"medium"===t&&(n+=" fonticon-2x "),{tag:"span",class:n}},getUrl:function(){return window.location.href},getRealPath:function(e,t,n){var i="";if(null==n&&(n=!1),(t=t||this.getWidgetObject())&&"function"==typeof t.getUrl&&0!=this.getProdLevel()){var r=t.getUrl();""!=(i=r.substring(0,r.indexOf("/webapps")))&&null!=i&&!1===n?i+="/webapps/":(i=t.getUrl(),i=(i=this.removeParameterOfUrl(i)).substring(0,i.lastIndexOf("/")),n&&(i+="/"))}else i=this.getUrl(),i=this.removeParameterOfUrl(i);return UWA.Utils.buildUrl(i,e)},removeParameterOfUrl:function(e){var t=e.split("?");if(t.length>0)return t[0]},startProgress:function(e,t,n){var i=this;if(!i.isProgressBusy()){if(i.currentProgressBar=t.partisionedProgressLabel,i.labelWaitingOperation=UWA.i18n(t.partisionedProgressLabel),i.progressContextDiv=t.progressBarContext,i.progressContextDiv){i.progressContextDiv.addClassName("masked");var s=r.createElement("div",{class:"mask"}),a=r.createElement("div",{class:"PBwrapper"}),l=r.createElement("div",{class:"PBcontent"});if(r.createElement("span",{class:"text",text:i.labelWaitingOperation}).inject(l),new UWA.Element("div",{class:"wux-control-inline-container",style:{"vertical-align":"top"}}).inject(l),l.inject(a),a.inject(s),s.inject(i.progressContextDiv),i.progressContextRenderTo=l,!0!==t.useWaitCursor){if(i.progressbar=new o({value:0}).inject(l),null!=e){var c=parseInt(t.progressBarStowedHits,10),u=i.progressbar.value+100/(e.length/n)/1*c;u=Math.min(u,100),console.log(u),i.progressbar.value=u,console.log(i.progressbar.value),t.progressBarStowedHits=0}}else i.progressbar=void 0,s.style.cursor="wait",void 0!==t.progressBarWaitContext&&(t.progressBarWaitContext.style.cursor="wait")}if(null!=t.disableActionBar&&null!=i.modifiedElement){i.modifiedElement.forEach((function(e){e.hasClassName("wux-ui-state-disabled")&&e.removeClassName("wux-ui-state-disabled")}))}i.modifiedElement=[];var d=[];if(null!=t.disableActionBar){var g=document.querySelectorAll(".wux-afr-cmdstarter");null!=g&&"function"==typeof g.forEach&&g.forEach((function(e){e.hasClassName("wux-ui-state-disabled")||(e.addClassName("wux-ui-state-disabled"),d.push(e))}))}i.modifiedElement=d}},isProgressBusy:function(){var e=!1;this.progressContextDiv&&(this.progressContextDiv.getElement(" > .mask")&&(e=!0));return e},stopProgress:function(e,t){var n=this;if(n.currentProgressBar==e.partisionedProgressLabel){var i=20;t.length>200&&(i=200),t.length>400&&(i=2e3),setTimeout((function(){if(n.modifiedElement.forEach((function(e){e.hasClassName("wux-ui-state-disabled")&&e.removeClassName("wux-ui-state-disabled")})),n.progressContextDiv){var t=n.progressContextDiv.getElement(" > .mask");t&&t.destroy(),n.progressContextDiv.removeClassName("masked")}n.progressContextRenderTo=n.progressContextDiv,!0===e.useWaitCursor&&void 0!==e.progressBarWaitContext&&(e.progressBarWaitContext.style.cursor="")}),i)}},updateProgress:function(e,t,n){var i=this;if(i.startProgress(e,n,t),i.currentProgressBar!=n.partisionedProgressLabel)n.progressBarStowedHits+=1;else if(null!=i.progressbar){var r=i.progressbar.value+100/(e.length/t)/1;r=Math.min(r,100),console.log(r),i.progressbar.value=r,console.log(i.progressbar.value)}},partitionedAuthenticatedRequest:function(t,n){var r=this;n.progressBarStowedHits=0;var o=i.decode(n.data);if(n.commonKeys=new e,null==n.requestArray)for(var a in o)e.isArray(o[a])?null==n.requestArray&&(n.requestArray=a):n.commonKeys.push(a);var l=o[n.requestArray],c=!1,u=[],d=0,g=5,f=50;null!=n.minChunkSize&&(g=n.minChunkSize),null!=n.maxChunkSize&&(f=n.maxChunkSize);var p=-1;(p=Math.ceil(l.length/20))>f&&(p=f),p<g&&(p=g),l.length<=20&&(n.useWaitCursor=!0),null!=n.symultaneousRequest&&0!=n.symultaneousRequest||r.startProgress(void 0,n,p);var h=n.onComplete;n.onComplete=function(a){r.updateProgress(l,p,n);var g=null;if(null==n.responseArray){for(var f in a)if(e.isArray(a[f])){n.responseArray=f,g=a[n.responseArray];break}}else g="function"==typeof n.responseArray?n.responseArray(a):a[n.responseArray];null!=g&&g.forEach((function(e){u.push(e)}));var v=!1;if("function"==typeof n.cancelCallback&&(v=n.cancelCallback()),0==a.success&&null!=a.success&&(c=!0),!v&&d+p<l.length){d+=p;var m=[];if("function"==typeof n.chunkify)m=n.chunkify(d,p,l);else for(var y=d;y<d+p&&y<l.length;y++)m.push(l[y]);if(m.length>0){var C={};n.commonKeys.forEach((function(e){C[e]=o[e]})),C[n.requestArray]=m,n.data=i.encode(C),s.authenticatedRequest(t,n)}}else r.stopProgress(n,l),a.success=!c,"function"==typeof n.responseArrayMerge?a=n.responseArrayMerge(a,u):a[n.responseArray]=u,h.call(null,a)};var v=n.onFailure;n.onFailure=function(e,t,i){r.stopProgress(n,l),v.call(null,e,t,i)};var m=n.onTimeout;n.onTimeout=function(e,t,i){r.stopProgress(n,l),m.call(null,e,t,i)};var y=[];if("function"==typeof n.chunkify)y=n.chunkify(d,p,l);else for(var C=d;C<d+p&&C<l.length;C++)y.push(l[C]);var S={};n.commonKeys.forEach((function(e){S[e]=o[e]})),S[n.requestArray]=y,n.data=i.encode(S),s.authenticatedRequest(t,n)},get3DSpaceUrl:function(e){var t=location.protocol+"//"+location.hostname,n="3DSpace";return e&&(e.serverUrl=t,e.serverUri=n),t+"/"+n},_failUrlAsync:function(e,t,n){var i="3DSpace"===e?this.get3DSpaceUrl(n):"";t.onComplete.call(null,i)},getServicesUrl:function(e){var t=this,n=this._getCancelObject();return this.getWebInWinParameters((function(i){var r=i?i.myAppsBaseUrl:null;!1===n.isCancelled()&&(e.myAppsBaseUrl=r||e.myAppsBaseUrl,n.handler=t.__getServicesUrl(e))})),n},__getServicesUrl:function(t){var n=this,i=this._getCancelObject(),r=t.platformId?t.platformId:null,o=!1;if(r=r||(null!=n.getTenantID()?n.getTenantID():null)){var s=g[r];(o=!!s)&&t.onComplete.call(null,s)}return o||require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],(function(o){if(!1===i.isCancelled()){var s={onComplete:function(n){e.isArray(n)&&n.length>0&&(n=n[0]),n=n||{},r&&(g[r]=n),t.onComplete.call(null,n)},onFailure:function(e){t.onComplete.call(null,{})}};if(r&&(s.platformId=r),t.myAppsBaseUrl){var a={myAppsBaseUrl:t.myAppsBaseUrl,userId:"all",lang:n.getLanguage()};s.config=a}i.handler=o.getPlatformServices(s)}})),i},getWidgetObject:function(){var e=window.widget&&window.widget instanceof t;return f||((f=e?window.widget:new t).body||(f.body=UWA.extend(document.body)),e||(f.lang=window.dsDashboardWindow&&window.dsDashboardWindow.top&&window.dsDashboardWindow.top.dsLang?window.dsDashboardWindow.top.dsLang:window.top.dsLang?window.top.dsLang:f.lang,window.widget=f),f)},addWidgetResizeEvent:function(e){var t=this.getWidgetObject();(t||this.getWidgetBody()).addEvent("onResize",e)},removeWidgetResizeEvent:function(e){var t=this.getWidgetObject();(t||this.getWidgetBody()).removeEvent("onResize",e)},setWidgetObject:function(e){f=e},getLanguage:function(){var e=this.getWidgetObject(),t=null;return window.COMPASS_CONFIG&&(t=window.COMPASS_CONFIG.lang),e&&null==t&&(t=e.lang?e.lang:this.getWidgetValue("lang")),t||(t=window.dsDashboardWindow&&window.dsDashboardWindow.top&&window.dsDashboardWindow.top.dsLang?window.dsDashboardWindow.top.dsLang:window.top.dsLang?window.top.dsLang:"en"),t},setWidgetValue:function(e,t){var n=this.getWidgetObject();n&&"function"==typeof n.setValue&&n.setValue(e,t),u[e]=t},getWidgetValue:function(e){var t=this.getWidgetObject(),n=t&&"function"==typeof t.getValue?t.getValue(e):void 0;return n||(n=u[e]),n},deleteWidgetValue:function(e){var t=this.getWidgetObject();t&&"function"==typeof t.deleteValue&&t.deleteValue(e),delete u[e]},addWidgetPreference:function(e){var t=this.getWidgetObject();t&&"function"==typeof t.addPreference&&t.addPreference(e)},setWidgetPreferences:function(e){var t=this.getWidgetObject();t&&"function"==typeof t.setPreferences&&t.setPreferences(e)},getWidgetPreferences:function(){return this.getWidgetObject().preferences},getWidgetPreference:function(e){var t=this.getWidgetObject();return t&&"function"==typeof t.getPreference?t.getPreference(e):null},getWidgetPreferenceValue:function(e){var t=this.getWidgetPreference(e);return t&&t.value?t.value:null},getWidgetId:function(){var e=this.getWidgetObject();return e?e.id:"0"},getWidgetBody:function(){var e=this.getWidgetObject();return e&&e.body?e.body:UWA.extend(document.body)},isDebug:function(){return"1"===this.getWidgetValue("debug_me")},getTenantID:function(e){var t=this.getWidgetValue("x3dPlatformId");return(t=t||("undefined"!=typeof enoviaServerCAWidget?enoviaServerCAWidget.tenant:null))||e},setTenantID:function(e){this.setWidgetValue("x3dPlatformId",e)},getTenants:function(e){var t=this;this._getPlatformServices((function(n){var i=[];null!==n&&(n.forEach((function(e){i.push(e.platformId)})),t.getTenantID()||t.setTenantID(i[0])),e.call(this,i)}))},getWebInWinParameters:function(e){var t=this;window.COMPASS_CONFIG&&window.COMPASS_CONFIG.myAppsBaseUrl?e(window.COMPASS_CONFIG):this._getMyappsUrl((function(n){window.COMPASS_CONFIG||(window.COMPASS_CONFIG={}),n&&(window.COMPASS_CONFIG.myAppsBaseUrl=n,window.COMPASS_CONFIG.userId||(window.COMPASS_CONFIG.userId=window.enoviaServerCAWidget&&window.enoviaServerCAWidget.contextUser?window.enoviaServerCAWidget.contextUser:"all"),window.COMPASS_CONFIG.lang||(window.COMPASS_CONFIG.lang=t.getLanguage())),e(window.COMPASS_CONFIG)}))},getGrantedRoles:function(e,t){var n=this;require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],(function(i){n.getWebInWinParameters((function(r){i.getGrantedRoles((function(i){var r=[];i.forEach((function(e){var n=!0;t&&e.platforms&&(n=e.platforms.indexOf(t)>=0),(n=n||"InternalDS"===e.id)&&r.push(e.id)})),e.call(n,r)}))}))}))},isChangeAvailable:function(){return!0},isNatifEnvironnement:function(){return"undefined"!=typeof dscef},isWebInWinEnvironment:function(){return this.isCatiaV5Environment()||this.isSolidworksEnvironment()},isCatiaV5Environment:function(){return"catiav5"===this._getEnvironment()},isSolidworksEnvironment:function(){return"solidworks"===this._getEnvironment()},_getEnvironment:function(){return this.getUrlParameter("addinmode")},getUrlParameter:function(e){return this._getUrlParameters()[e]},_getUrlParameters:function(){if(!this.storedUrlParams){var e={},t=[window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.location:window.top.location];window!==(window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top:window.top)&&t.push(window.location),t.forEach((function(t){try{t.search.substr(1).split("&").forEach((function(t){var n=t.split("=");n.length>1&&(e[n[0]]=n[1])}))}catch(e){}})),this.storedUrlParams=e}return this.storedUrlParams},_getMyappsUrl:function(e){this.isNatifEnvironnement()&&"function"==typeof dscef.getMyAppsURL?dscef.getMyAppsURL().then((function(t){console.log("MyApps URL",t),e.call(null,t)})).catch((function(t){console.error("Failed to fetch MyApps URL: "+t),e.call(null,null)})):e.call(null,null)},getCancelObject:function(){return this._getCancelObject()},_getCancelObject:function(){return{isCancelled:function(){return!1!==this.handler.toCancel},cancel:function(){this.handler.cancel()},handler:{toCancel:!1,cancel:function(){this.toCancel=!0}}}},_getServiceUrlAsync:function(e,t,n){var i=this;t=t||{};var r=this._getCancelObject();return this.getWebInWinParameters((function(o){var s=o?o.myAppsBaseUrl:null;!1===r.isCancelled()&&(t.myAppsBaseUrl=s||t.myAppsBaseUrl,r.handler=i.__getServiceUrlAsync(e,t,n))})),r},__getServiceUrlAsync:function(e,t,n){var i=this,r=this._getCancelObject();r._answerGiven=!1,r.hasEnded=function(){return!0===this.toCancel||!0===this._answerGiven},null==t.platformId&&(t.platformId=this.getUrlParameter("tenant"));var o=t.platformId?t.platformId:null,s=!1;if(o=o||(null!=i.getTenantID()?i.getTenantID():null)){var a=d[e+o];(s=!!a)&&(r._answerGiven=!0,t.onComplete.call(null,a))}return s||require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],(function(s){if(!1===r.isCancelled()){!0!==t.withoutTimeout&&setTimeout((function(){r.hasEnded()||!1!==r.isCancelled()||(r.cancel(),t.onComplete.call(null,"3DSpace"===e?i.get3DSpaceUrl(n):""))}),1e4);try{var a={serviceName:e,onComplete:function(s){if(r._answerGiven=!0,!1===r.isCancelled()){var a=s;if(s&&"string"!=typeof s&&s.length>0){var l=0;for(a=s[0].url,l=0;l<s.length;l++)t.platformId&&t.platformId.toUpperCase()===s[l].platformId.toUpperCase()&&(a=s[l].url)}a=a||("3DSpace"===e?i.get3DSpaceUrl(n):""),o&&(d[e+o]=a),t.onComplete.call(null,a)}},onFailure:function(o){r._answerGiven=!0,!1===r.isCancelled()&&t.onComplete.call(null,"3DSpace"===e?i.get3DSpaceUrl(n):"")}};if(o&&(a.platformId=o),t.myAppsBaseUrl){var l={myAppsBaseUrl:t.myAppsBaseUrl,userId:"all",lang:i.getLanguage()};a.config=l}if(!1!==t.wintop&&t.wintop){if(t.serverUrl){var c=t.serverUrl[0]["3DSpace"];a.onComplete(c)}}else s.getServiceUrl(a)}catch(o){r._answerGiven=!0,i.displayErrorOnConsole(o.stack),i._failUrlAsync(e,t,n)}}}),(function(){i.displayErrorOnConsole("Fail loading i3DXCompassServices"),i._failUrlAsync(e,t,n)})),r},displayErrorOnConsole:function(e){console.log("%c"+e,"color: red")},getSourceUrlAsync:function(e,t){var n=e&&e.source?e.source:"3DSpace";return this._getServiceUrlAsync(n,e,t)},get3DSpaceUrlAsync:function(e,t){return this.getSourceUrlAsync(e,t)},get3DSwymUrlAsync:function(e,t){return this._getServiceUrlAsync("3DSwym",e,t)},get3DSearchUrlAsync:function(e,t){return this._getServiceUrlAsync("3DSearch",e,t)},getCompassUrlAsync:function(e,t){return this._getServiceUrlAsync("3DCompass",e,t)},_getPlatformServices:function(e){require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],(function(t){t.getPlatformServices({onComplete:function(t){e.call(this,t)},onFailure:function(t){that.displayErrorOnConsole("Cannot retrieve the Platform Services"),e.call(this,null)}})}))},getFullUrl:function(e,t,n){var i="",r=e,o=t,s=this.getWidgetObject();if(null==s||"function"!=typeof s.getUrl||""!=e&&null!=e||""!=t&&null!=t)""!=e&&null!=e||(r=this.getServerUrl()),""!=t&&null!=t||(o=this.getRootURI()),i=UWA.Utils.buildUrl(r,o);else{var a=s.getUrl();o=(i=a.substring(0,a.indexOf("/webapps"))).substring(i.lastIndexOf("/")+1)}if(""==i&&(i=this.get3DSpaceUrl()),null!=n){var l=i;""!==o&&(l=i.substring(0,i.indexOf("/"+o))),n.serverUrl=l,n.serverUri=o}return i},getServerUrl:function(){var e="";return(e=location.host)||(e=location.origin),e.indexOf("http")<0&&(e=location.protocol?location.protocol+"//"+e:"http://"+e),e},getRootURI:function(){var e=location.pathname,t=e.indexOf("/",1);return t<0&&(t=e.indexOf("\\",1)),e=e.substring(0,t)},convertDateToStandard:function(e,t){if(!e)return{value:"",valueDB:""};var n=t?e:new Date,i=e.getUTCFullYear(),r=e.getUTCMonth()+1,o=e.getUTCDate(),s=n.getUTCHours(),a=n.getUTCMinutes(),l=n.getUTCSeconds();return this.isReplayedODT()&&(s=12,a=0,l=0,n.setHours(s),n.setMinutes(a),n.setSeconds(l)),r<10&&(r="0"+r),o<10&&(o="0"+o),s<10&&(s="0"+s),a<10&&(a="0"+a),l<10&&(l="0"+l),n.setYear(i),n.setMonth(e.getMonth()),n.setDate(o),{value:n.toLocaleString(this.getLanguage()),valueDB:i+"/"+r+"/"+o+"@"+s+":"+a+":"+l+":GMT"}},formatDateObj:function(e){if(!e)return null;var t=e.split("@"),n=e;if(t.length>1){var i=t[0].split("/"),r=i[0],o=i[1]-1,s=i[2],a=t[1].split(":"),l=a[0],c=a[1],u=a[2];(n=new Date).setUTCHours(l),n.setUTCMinutes(c),n.setUTCSeconds(u),n.setUTCFullYear(r),n.setUTCDate(1),n.setUTCMonth(o),n.setUTCDate(s)}else e.contains("T")&&(n=new Date(e));return n},formatDate:function(e,t){var n=e,i=e instanceof Date?e:this.formatDateObj(e);return i&&(n=1==t?i.toLocaleString(this.getLanguage()):i.toLocaleDateString(this.getLanguage())),n},addNewStyles:function(e,t,n){var i="";for(var r in t){var o=t[r],s="{";for(var a in o){s+=a+":"+o[a]+";"}s.length>1&&(i+=r+" "+(s+="}"))}if(i)return this.addNewStyle(e,i,n)},addNewStyle:function(e,t,n){var i=this,r=document.getElementsByClassName(e),o=null;return r&&r.length>0&&(o=r[0]),n&&o&&(this.addNewStyle(e+"_temp",t,!1),o.parentNode.removeChild(o),o=null),o||((o=document.createElement("style")).type="text/css",o.className=e,document.getElementsByTagName("head")[0].appendChild(o)),o.appendChild(document.createTextNode(t)),setTimeout((function(){i.clearJSStylesheet(e+"_temp")})),o},clearJSStylesheet:function(e){var t=document.getElementsByClassName(e);t&&t.length>0&&t[0].parentNode.removeChild(t[0])},download:function(e,t,n,i){var r="json"===n,o=r?JSON.stringify(t,null,"\t"):t;if(e=this.isReplayedODT()?"ODT_ToRemove":e,!0===i){var s=this.getTenantID();e+=s?"_"+s:""}e+=r?".json":".txt";var a=(r?"application/json":"text/plain")+";charset=utf-8;";if(window.navigator&&window.navigator.msSaveOrOpenBlob){var l=new Blob([decodeURIComponent(encodeURI(o))],{type:a});window.navigator.msSaveOrOpenBlob(l,e)}else{var c=document.createElement("a");c.setAttribute("href","data:"+a+","+encodeURIComponent(o)),c.setAttribute("download",e),c.setAttribute("target","_blank"),document.body.appendChild(c),c.click(),document.body.removeChild(c),this.isReplayedODT()&&(window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.EP_MaskCustomization_ODTData=JSON.parse(o):window.top.EP_MaskCustomization_ODTData=JSON.parse(o))}},compareValue:function(e,t){if(!isNaN(e)||!isNaN(t)){if(!isNaN(e)&&!isNaN(t))return Number(t)==Number(e)?0:Number(t)>Number(e)?1:-1;e+="",t+=""}return t.localeCompare(e,undefined,{numeric:!0,sensitivity:"base"})},setValue:function(e,t){u[e]=t},getValue:function(e){return u[e]}};return window.widget&&!0===window.widget.getValue("proto")&&(p.servicesUrls=d),p})),define("DS/WidgetServices/commandProxy/CommandProxy",["UWA/Class","DS/PlatformAPI/PlatformAPI"],(function(e,t){"use strict";var n="DS/PADUtils/PADCommandProxy/select",i="DS/Properties/CommandProxy/update";var r=e.extend({subscriptions:{},choices:{SELECT:"onSelect",UPDATE:"onUpdateTransient"},onSelect:function(e){var i=n,r=t.subscribe(i,(function(t){if(null!=t.metadata&&(n=t.metadata.appid),null!=n&&0===n.indexOf("/"))var n=n.substr(1);var i=Object.keys(widget.data).length;void 0!==widget.data&&widget.data.appId==n&&widget.data.x3dAppId==n&&0!==i||e.apply(null,[t.data,t])}));this.unsubscribe(this.choices.SELECT),this.subscriptions[this.choices.SELECT]=r},onUpdateTransient:function(e){var n=i,r=t.subscribe(n,(function(t){e.call(null,t)}));this.unsubscribe(this.choices.UPDATE),this.subscriptions[this.choices.UPDATE]=r},init:function(e){this.subscribe(e)},subscribe:function(e){for(var t in e)if("function"==typeof e[t])switch(t){case this.choices.SELECT:this.onSelect(e[t]);break;case this.choices.UPDATE:this.onUpdateTransient(e[t])}},unsubscribe:function(e){var n=this.subscriptions[e];n&&(t.unsubscribe(n),this.subscriptions[e]=null)},destroy:function(){for(var e in this.subscriptions)this.unsubscribe(e);this._parent()},publishAddExtensionEvent:function(e){t.publish("DS/Information/CommandProxy/AddExtension",e)}});return r.create=function(e){var t;return e&&(t=e.events),new r(t)},r.publishUpdate=function(e,n){t.publish(i,{models:e,options:n})},r.publishSelect=function(e){t.publish(n,e)},r})),define("DS/WidgetServices/moveHelper/MoveHelper",["UWA/Controls/Abstract"],(function(e){"use strict";var t=null,n=null,i=!1,r=function(e){if(null!=t){t.getElement();var i=s(e),r={x:n.x-i.x,y:n.y-i.y};t.dispatchEvent("move",{diff:r})}},o=function(e){null!=t&&t.dispatchEvent("endMove"),t=null},s=function(e){return null!=e.changedTouches?{x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY}:{x:e.clientX,y:e.clientY}},a=[];function l(){document.removeEventListener("mousemove",r),document.removeEventListener("touchmove",r),document.removeEventListener("mouseup",o),document.removeEventListener("touchend",o),document.body.removeEventListener("mouseleave",o),document.body.removeEventListener("touchleave",o),i=!1}var c=e.extend({init:function(e){this._parent(e);var t=this;this._handlerFirstActionResize=function(e){t._firstActionResize(e)},i||(i=!0,document.addEventListener("mousemove",r),document.addEventListener("touchmove",r),document.addEventListener("mouseup",o),document.addEventListener("touchend",o),document.body.addEventListener("mouseleave",o),document.body.addEventListener("touchleave",o)),e.element.addEventListener("mousedown",this._handlerFirstActionResize),e.element.addEventListener("touchstart",this._handlerFirstActionResize),a.push(this)},getElement:function(){return this.options.element},disconnect:function(){this.options.element.removeEventListener("mousedown",this._handlerFirstActionResize),this.options.element.removeEventListener("touchstart",this._handlerFirstActionResize)},_firstActionResize:function(e){e.preventDefault(),this.dispatchEvent("startMove"),t=this,n=s(e)},destroy:function(){var e=this;this.disconnect();var t=[];a.forEach((function(n){n!==e&&t.push(n)})),0===(a=t).length&&l(),this._parent()}});return c.removeAll=function(){a.forEach((function(e){e.disconnect()})),a=[],l()},c})),define("DS/WidgetServices/MultipleAsynchronousRequests",[],(function(){"use strict";return function(e,t){var n={},i=e.length,r=t;this.setAnswer=function(t,o){e.indexOf(t)>=0&&(void 0===n[t]&&i--,n[t]=o),i<=0&&null!==r&&r.call(this)},this.getAnswer=function(e){return n[e]},this.addRequest=function(t){e.indexOf(t)<0&&(e.push(t),i++)}}})),define("DS/WidgetServices/UIInfra/UIInfra",["css!DS/WidgetServices/WidgetServices.css"],(function(e){"use strict";var t=UWA.createElement("div",{class:"Ghost_copiedElementContainer"});return{createGhostDnD:function(e,n){var i=n.number>99?"99+":n.number,r=null;n.number>1&&(r=UWA.createElement("span",{class:"Ghost_infoDrag",text:i})),t.inject(document.body);var o=e.target.cloneNode(!0),s=(e.target.getSize(),"Ghost_left"),a=null;if("function"!=typeof DataTransfer.prototype.setDragImage){a=UWA.extend(e.target,UWA.element);var l={x:e.offsetX,y:e.offsetY},c=(e.target.getSize(),{left:l.x,right:200-l.x}),u=!0;c.left<=30&&c.left<=c.right&&(s="Ghost_right",u=!1),null!==r&&(a.addClassName(s),u?e.target.insertBefore(r,e.target.firstChild):e.target.appendChild(r)),e.target.parentNode.insertBefore(o,e.target),e.target.addClassName("Ghost_tempObj"),setTimeout((function(){e.target.removeClassName("Ghost_tempObj"),e.target.parentNode.removeChild(o),null!==r&&e.target.removeChild(r)}),0)}else(a=UWA.extend(o,UWA.Element)).addClassName("Ghost_draggingObj"),t.appendChild(o),null!==r&&(a.addClassName(s),o.insertBefore(r,o.firstChild)),e.dataTransfer.setDragImage(o,-10,-10),setTimeout((function(){t.removeChild(o)}));a.addClassName(n.className),a.addClassName("GhostMainContainer"),setTimeout((function(){a.removeClassName(s),a.removeClassName(n.className),a.removeClassName("GhostMainContainer"),t.remove()}),0)}}})),define("DS/WidgetServices/CollabPerfTimer",["DS/WAFData/WAFData","DS/WidgetServices/WidgetServices","UWA/Widget","DS/ENOFloatingPanel/ENOFloatingPanel"],(function(e,t,n,i){"use strict";function r(){this._name="",this._sections={},this._options={}}var o;return r.prototype={init:function(e,t){e&&(this._name=e),t&&(this._options=t),this._sections={}},stop:function(e){if(this.getSectionIsRunning(e)){this.setSectionIsRunning(e,!1);var t=Date.now(),n=this.getStartMs(e);0!=n&&this.setInterval(e,n,t)}},start:function(e){if(!this.getSectionIsRunning(e)){this.setSectionIsRunning(e,!0);var t=Date.now();this.setStartMs(e,t)}},getTotalMs:function(e){var t=0;if(this._sections[e]&&this._sections[e].intervals)for(let i=0;i<this._sections[e].intervals.length;++i){const r=this._sections[e].intervals[i];var n=r.startMs;t=t+r.endMs-n}return t},getTotalMinutesAndSeconds:function(e){var t=this.getTotalMs(e);return this.millisToMinutesAndSeconds(t)},printTime:function(e){if(void 0===this._sections[e])console.log(e+" has not been executed or measured");else{var t=this.getTotalMinutesAndSeconds(e);console.log(e+"  "+t)}},getStartMs:function(e){var t=0;return this._sections[e]&&this._sections[e].currentStartMs&&(t=this._sections[e].currentStartMs),t},setStartMs:function(e,t){void 0===this._sections[e]&&(this._sections[e]={}),this._sections[e].currentStartMs=t},setSectionIsRunning:function(e,t){void 0===this._sections[e]&&(this._sections[e]={}),this._sections[e].isRunning=t},getSectionIsRunning:function(e){return void 0!==this._sections[e]&&this._sections[e].isRunning},setInterval:function(e,t,n){void 0===this._sections[e]&&(this._sections[e]={}),void 0===this._sections[e].intervals&&(this._sections[e].intervals=[]);var i={};i.startMs=t,i.endMs=n,this._sections[e].intervals.push(i)},millisToMinutesAndSeconds:function(e){var t=Math.floor(e/6e4),n=Math.trunc(e%6e4/1e3),i=Math.trunc(e%6e4%1e3/10),r=":"+n;return 0==n?r=":00":n<10&&(r=":0"+n),t+r+"."+(0==i?"00":(i<10?"0":"")+i)},launchDialog:function(e){if(null!=e){var t=new n;t.body=UWA.extend(document.body);var r="<head><style>pre {outline: 1px solid #ccc; padding: 5px; margin: 5px; overflow-y:scroll; height: 100%; width: 100% } .row { display: flex;} ";r+=" .column { flex: 50%; padding: 10px;} </style> </head> <body>",r+=' <h2>Timing Run</h2> <div class="row"> <div class="column" style="background-color:#FFF;"> ',r+=" <p>"+JSON.stringify(e)+"</p> ";var o=new i({className:"LifecycleCommandCheck_Dlg",title:"Report",body:r+=" </div> </div> </body> ",overlay:!0,escapeToClose:!0,closable:!0,animate:!0,resizable:!0,maximizable:!0,autocenter:!0,visible:!0,limitParent:!0});o.getBody().style.overflowY="scroll",o.getBody().style.overflowX="scroll",o.inject(t.body)}},printTimeShowDialogAndProcess:function(n,i,r){var o=this;for(let e=0;e<n.length;++e){var s=n[e];o.printTime(s)}r&&console.log(r);t.get3DSpaceUrlAsync({onComplete:function(s){var a={Accept:"application/json","content-type":"application/json"};a.SecurityContext=encodeURIComponent(i);var l=s+"/resources/lifecycle/util/getExpressionAndUser?";a["Accept-Language"]=widget.lang;var c=t.getTenantID();c&&(l+="&tenant="+c);e.authenticatedRequest(l,{method:"GET",headers:a,timeout:288e5,data:{expression:"LifecyclePerfTimerExpression"},onComplete:function(e){console.log("fetchOfExpression: completed"),console.log(e);var t="";if(null!=e){var i={},s="";if(e.result){t=e.result;i=JSON.parse(t)}e.user&&(s=e.user);var a="",l=!1;if(i.all&&(a=i.all),""!==s&&i[s]&&(a=i[s]),a.showDialog&&"true"===a.showDialog&&(l=!0),a.doPostAnalysis&&"true"===a.doPostAnalysis&&!0,!0===l){var c=[];for(let e=0;e<n.length;++e){var u=n[e],d={section:u,time:o.getTotalMinutesAndSeconds(u)};c.push(d)}r&&c.push(r),o.launchDialog(c)}}},onFailure:function(e,t){console.log("Failed to retrive data from the server")},onTimeout:function(e){console.log("Timed out on trying to retrive data from the server")},type:"json"})}})}},o||(o=new r)})),define("DS/WidgetServices/securityContextServices/SecurityContextServices",["UWA/Class","UWA/Json","DS/WidgetServices/WidgetServices","i18n!DS/WidgetServices/assets/nls/SecurityContextNls"],(function(e,t,n,i){"use strict";let r=[],o=[];return e.singleton({_currentSecurityContext:"",_preferedSecurityContext:"",_validSecurityContext:"",options:{serverName:"",serverUri:"",isStandalone:!1,alwaysUpdate:!1,context:null,wintop:!1,tenant:null,source:null},init:function(e){this._parent(),this._assignedSecurityContextOfLoggedInUser=[],this._numberOfTimesAPICalled=0,this.errorObject=null,this._validSecurityContext=null},getInstance:function(e){try{this.init(e)}catch(e){}for(var t in e)this.options[t]=e[t];return e&&e.widgetIsPinned&&(this.widgetIsPinned=!0),this.options.source||(this.options.source="3DSpace"),this},getSecurityContext:function(e,t){if(this._currentSecurityContext=null,this.options.context&&"function"==typeof this.options.context.getSecurityContext){var n=this.options.context.getSecurityContext();if(n&&n.SecurityContext)return this._currentSecurityContext=n,void this._computeSecurityContext(e)}var i=!1;if(null!=t&&(null!=t.serverName&&(t.serverName!=this.options.serverName&&(i=!0),this.options.serverName=t.serverName),null!=t.serverUri&&(t.serverUri!=this.options.serverUri&&(i=!0),this.options.serverUri=t.serverUri)),!0===this.options.alwaysUpdate&&(i=!0),1==i||""==this._preferedSecurityContext||null==this._preferedSecurityContext.SecurityContext)return this._getSecurityContext(!0,e);this._computeSecurityContext(e)},_computeSecurityContext:function(e){if(null===this._currentSecurityContext&&(this._currentSecurityContext=this._preferedSecurityContext),null!=e)if(this._currentSecurityContext&&this._currentSecurityContext.SecurityContext){var t=this._currentSecurityContext.SecurityContext,n="";0!=t.indexOf("ctx::")&&(n="ctx::"),this._currentSecurityContext.SecurityContext=n+t,e.onSuccess.call(this,this._currentSecurityContext)}else{var r={message:i.get("ErrorSecurityContextEmpty"),code:"ERROR"};e.onFailure.call(this,r)}},_getSecurityContext:function(e,t){var i=this,r=n._getCancelObject();if(!1!==e||""!=this.options.serverName||""!=this.options.serverUri){var o={Accept:"application/json","Content-Type":"application/json"};if(!1===e)this.options.serverName,this.options.serverUri;return require(["DS/WAFData/WAFData","DS/WidgetServices/WidgetServices"],(function(n,s){if(!1===r.isCancelled()){var a=i.options.tenant;a=a||s.getTenantID(),r.handler=s.getSourceUrlAsync({platformId:a,source:i.options.source,onComplete:function(a){var l=a+"/resources/pno/person/getsecuritycontext",c=i.options.tenant;(c=c||s.getTenantID())&&(l+="?tenant="+c);var u="";!1===i.options.isStandalone&&2==i.prodLevel&&(u="passport"),o["Accept-Language"]=s.getLanguage();var d={type:"json",method:"GET",proxy:u,headers:o,onComplete:function(n){i._onCompleteGetSecurityContext(n,e,t)},onFailure:function(n,r,o){i._onFailureGetSecurityContext(n,r,o,e,t)},onTimeout:function(){i._onTimeoutGetSecurityContext(e,t)}};!1===i.options.isStandalone&&(d.authentication="passport"),r.handler=n.handleRequest(l,d)},serverUrl:i.options.serverUrl,wintop:i.options.wintop})}})),r}this._onFailureGetSecurityContext(null,null,null,e,t)},_onCompleteGetSecurityContext:function(e,t,n){null!=e&&""!=e||0==t?(this._preferedSecurityContext=e,null!=n&&this._computeSecurityContext(n)):this._getSecurityContext(!1,n)},_onTimeoutGetSecurityContext:function(e,t){if(0!=e)this._getSecurityContext(!1,t);else{var n={message:i.get("ErrorTimeOut"),code:"TO"};null!=t&&t.onFailure.call(this,n)}},_onFailureGetSecurityContext:function(e,n,r,o,s){if(this._request=null,0!=o)this._getSecurityContext(!1,s);else{t.isJson(n)&&(n=t.decode(n));var a={};a=null!=n&&n.hasOwnProperty("error")?n.error:{message:i.get("ErrorSecurityContext"),code:"ERROR"},s&&"function"==typeof s.onFailure&&s.onFailure.call(this,a)}},getValidSecurityContext:function(e,t){let n=this;if(n._validSecurityContext=null,!n.widgetIsPinned&&n.options.context&&"function"==typeof n.options.context.getSecurityContext){let t=n.options.context.getSecurityContext();if(t&&t.SecurityContext){let i=t.SecurityContext,r="";return 0!=i.indexOf("ctx::")&&(r="ctx::",i=r+i),n._validSecurityContext={SecurityContext:i},void(e&&"function"==typeof e.onSuccess&&e.onSuccess.call(n,n._validSecurityContext))}}0===n._assignedSecurityContextOfLoggedInUser.length&&"3DSPACE"===n.options.source.toUpperCase()?(0==r.length&&n._getSecurityContextAssignedToLoggedInUser(),o.push(e)):n.callbackFunction(e)},_getSecurityContextAssignedToLoggedInUser:function(){let e=this;r.push(1),e._numberOfTimesAPICalled++;let t={Accept:"application/json","Content-Type":"application/json"};require(["DS/WAFData/WAFData","DS/WidgetServices/WidgetServices"],(function(n,i){let o=e.options.tenant;o=o||i.getTenantID(),i.getSourceUrlAsync({platformId:o,source:e.options.source,onComplete:function(o){let s=o+"/resources/vplmte/getallctx",a=e.options.tenant;a=a||i.getTenantID(),a&&(s+="?tenant="+a),t["Accept-Language"]=i.getLanguage();let l={type:"json",method:"GET",headers:t,onComplete:function(t){r.shift(),e._onCompleteGetSecurityContextAssignedToLoggedInUser(t)},onFailure:function(t,n,i){r.shift(),e._onFailureGetSecurityContextAssignedToLoggedInUser(t,n,i)},onTimeout:function(){r.shift(),e._onTimeoutGetSecurityContextAssignedToLoggedInUser()}};n.authenticatedRequest(s,l)},serverUrl:e.options.serverUrl,wintop:e.options.wintop})}))},_onCompleteGetSecurityContextAssignedToLoggedInUser:function(e){let t=this;if(e&&"object"==typeof e&&e.hasOwnProperty("credentials")&&Array.isArray(e.credentials)){e.credentials.forEach((e=>{if(e.ctxname){let n=`ctx::${e.ctxname}`;t._assignedSecurityContextOfLoggedInUser.push(n)}}));let n=o.length;for(let e=0;e<n;e++){let e=o.shift();t.callbackFunction(e)}}},_onFailureGetSecurityContextAssignedToLoggedInUser:function(e,n,r){let s=this;if(s._numberOfTimesAPICalled<2)s._getSecurityContextAssignedToLoggedInUser();else{t.isJson(n)&&(n=t.decode(n));let e={};e=null!=n&&n.hasOwnProperty("error")?n.error:{message:i.get("ErrorSecurityContext"),code:"ERROR"},s.errorObject=e;let r=o.length;for(let e=0;e<r;e++){let e=o.shift();s.callbackFunction(e)}}},_onTimeoutGetSecurityContextAssignedToLoggedInUser:function(){let e=this;if(e._numberOfTimesAPICalled<2)e._getSecurityContextAssignedToLoggedInUser();else{let t={message:i.get("ErrorTimeOut"),code:"TO"};e.errorObj=t;let n=o.length;for(let t=0;t<n;t++){let t=o.shift();e.callbackFunction(t)}}},_isSecurityContextValid:function(e){let t=this;if(t.options.source&&"3DSPACE"!==t.options.source.toUpperCase())return!0;if(t._assignedSecurityContextOfLoggedInUser.length>0){return t._assignedSecurityContextOfLoggedInUser.includes(e)}return!1},callbackFunction:function(e){let t=this;if(t.options.context&&"function"==typeof t.options.context.getSecurityContext){let e=t.options.context.getSecurityContext();if(e&&e.SecurityContext){let n=e.SecurityContext,i="";0!=n.indexOf("ctx::")&&(i="ctx::",n=i+n),t._isSecurityContextValid(n)?t._validSecurityContext={SecurityContext:n}:t._assignedSecurityContextOfLoggedInUser.length>0&&(t._validSecurityContext={SecurityContext:t._assignedSecurityContextOfLoggedInUser[0]})}else t._assignedSecurityContextOfLoggedInUser.length>0&&(t._validSecurityContext={SecurityContext:t._assignedSecurityContextOfLoggedInUser[0]})}else t._assignedSecurityContextOfLoggedInUser.length>0&&(t._validSecurityContext={SecurityContext:t._assignedSecurityContextOfLoggedInUser[0]});if(null!=t._validSecurityContext&&t._validSecurityContext.SecurityContext)e&&"function"==typeof e.onSuccess&&e.onSuccess.call(t,t._validSecurityContext);else{let n={message:i.get("ErrorSecurityContextEmpty"),code:"ERROR"};if(t.options.source&&"3DSPACE"!==t.options.source.toUpperCase()&&e&&"function"==typeof e.onSuccess)return void e.onSuccess.call(t,null);e&&"function"==typeof e.onFailure&&e.onFailure.call(t,n)}}})}));