define("DS/DELPPWImplementModule/ImplementModule",["UWA/Core"],(function(e){"use strict";return{behaviors:["UXFactoryBehavior","MfgItemUXBehavor","ResourceBehavior","ModelBehavior","SelectionBehavior","ProductImplementBehavior","AssignProductBehavior","WUXNodeModelBehavior","TreeListViewBehavior","ViewBehavior","LinkBehavior"],creator:function(t,n,i,o,l,c,m,a,s,r,p,d){var g,S,u,I,h,f,P,L,A,v,C,b,R,k,T,D,E,O,N,U,w,V,F,y,M,B,W,_,j,x,H="ReconnectScope",X="ReviseAndReconnectScope",K="AssignProductUI",q="CreateMfgItemAndScope",Q=null,z=null,G=null,J=null,Y={};return u=function(t,n){if(Y={},!e.is(t))throw new Error("Command ID is null");Y.cmdId=t,Y.onOKCallBack=n,Y.onCancelCallback=U,Y.newObjType=z,Y.isInstancePossible=null},h=function(n,i){var l=null;if(z=null,g=null,G=null,e.is(i,"array")&&0<i.length&&i.forEach((function(t){e.is(t)&&e.is(t.ID,"string")&&e.is(t.Value,"string")&&("ReferenceType"===t.ID&&(z=t.Value),"V_DimensionType"===t.ID&&(G=t.Value))}),this),!e.is(z))throw l=o.getNLSValue("Error.CommandConfigNotValid",{cmdName:n}),t.warn(l),new Error(l);g=z.split("/")[1]},f=function(t){var n,i,c=!1,m=o.getNLSValue("ImplementUI.SelectedMultiObjectsForProvide");if(!0===t.bUpdateImplemented?Q.updateImplemented(t.selNodes):!0===t.bUpdateImplementing&&Q.updateImplementing(t.selNodes),e.is(g)&&(n=Q.getImplementingID(),e.is(n))){let e=null;i={parent:l.getReferenceModel(n),child:g},({isInstancePossible:c,errorMessage:e}=l.computeIsInstancePossible(i)),Q.showDCFormForAssign(c),c||Q.getImplementedIDs().length>1&&Q.showErrorMultipleImplementedSelected(m)}},P=function(e){!0===e.bUpdateImplemented&&(Q.updateImplemented(e.selNodes),Q.showDCFormForCreate(true))},L=function(e){var t=!0,n=p.getActiveView();return!1===e.changed.isSelected&&e.sourceId!==n&&(t=!1),t},I=function(){e.is(Q)&&(Q.isVisible()&&Q.destroyUI(),Q=void 0)},A=function(t,n){if(Y={},!e.is(t))throw new Error("Command ID is null");Y.cmdId=t,Y.moduleOptions=S,Y.onOKCallBack=n,Y.onCancelCallback=U},C=function(t){var n,i,c,a,s,r,p=!1,d=o.getNLSValue("ImplementUI.Implementing"),g=function(){v()},S=function(e){J.updateImplementedRevnList(i,e,!0,p)},u=function(e){J.showMessages(e,"error")};e.is(t)&&(s=function(){a=l.getInstancesFromCollection(c),e.is(a)&&a.length>0&&(p=!0),J.updateImplementingLabel(c),(n=m.getScopeLinksOfImplementing(c)).length<=0?J.showMessages(o.getNLSValue("ImplementBehavior.Validation.NoScopeExist"),"error"):(i=n[0].get("to"),r=function(t){e.is(t)?J.showMessages(t,"error"):l.getMajorRevisions(i,S,u)},m.prereqChecksForReconnectScope(Y.cmdId,c,d,r,g))},c=l.getReferenceId(t),l.needToQueryForChildren(c)?l.getDescendantsFromServer([c],s,{expandLevel:1,forceDBMode:!0}):s())},v=function(){e.is(J)&&(J.isVisible()&&J.destroyUI(),J=void 0)},U=function(){I(),v()},w=function(n){var i=n.implementingId,o=n.implementedIDs[0],l=n.implementingPaths[0],c=n.implementedPaths[0];(e.is(i)&&e.is(o)||e.is(l)&&e.is(c))&&m.validateBrokenScopeLinkPromise(i,o).then((({isScopeLinkBroken:e,implementedRefId:t,implementingRefId:n})=>{if(e){const e={logMessage:"Reconnect Scope For Broken Link"};m.reconnectScope(t,n,e)}else m.createScopeLink([{implementingPID:i,implementedPID:o,implementingAbsPath:l,implementedAbsPath:c}])})).catch((()=>{t.log("Error occured while validating broken scope link")})),I()},M=function(t){const{implementingPaths:n,implementedPaths:i,cmdAction:o,implementedIDs:l}=t,[c]=n,[a]=i,[s]=l;e.is(c)&&e.is(a)&&m.managePartialScopeLink({implementingAbsPath:c,implementedAbsPath:a,implementedPID:s,implementingPID:t.implementingId,cmdAction:o}),I()},F=function(t){var n,i,o;e.is(t)&&(n=t.implementingId),l.isInstance(n)?(o=n,i=l.getReferenceIdFromInstance(o)):i=n,a.assignProduct({mbomReferenceId:i,mbomInstanceId:o,bodyInstanceIds:t.implementedIDs,bodyAbsolutePaths:t.implementedPaths,mbomAbsolutePaths:t.implementingPaths,newMfgAttributes:t.newObjAttributes,isInstancePossible:t.isInstancePossible,securityContextOverride:t.securityContextOverride}),I()},y=function(t){var n=o.getNLSValue(Y.cmdTitle,{type:o.getNLSValue(g||"",null,"Type")}),i=t.implementedIDs,l=t.newObjAttributes,c={securityContextOverride:t.securityContextOverride};e.is(l[0].V_Type,"string")||(l[0].V_Type=z),a.createMfgItemAndScopeLink(i,l,n,c),I()},V=function(t){var n={logMessage:e.is(Y.cmdTitle)?o.getNLSValue(Y.cmdTitle):"Reconnect Scope command"};e.is(t)&&(Y.cmdId===H?m.reconnectScope(t.implementedId,t.implementingId,n,v):Y.cmdId===X&&m.reviseAndReconnectScope(t.implementedId,t.implementingId,n,v))},b=function(){U(),d.getRelations().then((function(e){e.isRelationsLoaded&&(z=null,g=null,u("CreateScopeLink",w),Y.cmdTitle="ImplementUI.CreateScope",Y.implementingSection=!0,Y.implementedSection=!0,Y.optionsSection=!1,Y.checkForImplementingScope=!0,Y.modalFlag=!1,Y.multiSelectionOfImplementing=!1,Y.multiSelectionOfImplemented=!1,Q=i.createImplementUI(Y),f(Q.getSelectionsWithPaths()))}))},B=function(){U(),d.getRelations().then((function(e){e.isRelationsLoaded&&(z=null,g=null,u("CreatePartialScopeLink",M),Y.cmdTitle="ImplementUI.CreatePartialScope",Y.implementingSection=!0,Y.implementedSection=!0,Y.optionsSection=!1,Y.checkForImplementingScope=!0,Y.modalFlag=!1,Y.multiSelectionOfImplementing=!1,Y.multiSelectionOfImplemented=!1,Y.cmdAction=m.PartialScopeAction.CREATE_PARTIALSCOPE,Q=i.createImplementUI(Y),f(Q.getSelectionsWithPaths()))}))},_=function(){U(),d.getRelations().then((function(e){e.isRelationsLoaded&&(z=null,g=null,u("StretchPartialScopeLink",M),Y.cmdTitle="ImplementUI.StretchPartialScope",Y.implementingSection=!0,Y.implementedSection=!0,Y.optionsSection=!1,Y.checkForImplementingScope=!0,Y.modalFlag=!1,Y.multiSelectionOfImplementing=!1,Y.multiSelectionOfImplemented=!1,Y.cmdAction=m.PartialScopeAction.STRETCH_PARTIALSCOPE,Q=i.createImplementUI(Y),f(Q.getSelectionsWithPaths()))}))},W=function(){var n,i,l=[],a=o.getNLSValue("ImplementUI.Implementing");if(U(),n=c.getSelectionsWithPaths()[1],e.is(n,"array")&&n.length>0){const t=n,{path:o,id:c}=t[0],a=e.is(o)&&o.length>0?o:c;m.isPartialScoped(a)&&(e.is(a,"array")&&a.length>0?l=a:i=a)}if(e.is(l,"array")&&l.length>0)m.managePartialScopeLink({implementingAbsPath:l,cmdAction:m.PartialScopeAction.DELETE_PARTIALSCOPE});else if(e.is(i)){const e=m.getPartialScopeLinks(i)[0].get("to");m.managePartialScopeLink({implementingPID:i,implementedPID:e,cmdAction:m.PartialScopeAction.DELETE_PARTIALSCOPE})}else t.warn(o.getNLSValue("Error.PartialScopeDeletion",{objectName:a}))},j=function(){var n,i,l=[],a=o.getNLSValue("ImplementUI.Implementing");if(U(),n=c.getSelectionsWithPaths()[1],e.is(n,"array")&&n.length>0){const t=n,{path:o,id:c}=t[0],a=e.is(o)&&o.length>0?o:c;m.isPartialScoped(a)&&(e.is(a,"array")&&a.length>0?l=a:i=a)}if(e.is(l,"array")&&l.length>0)m.managePartialScopeLink({implementingAbsPath:l,cmdAction:m.PartialScopeAction.SWITCH_TO_FULLSCOPE});else if(e.is(i)){const e=m.getPartialScopeLinks(i)[0].get("to");m.managePartialScopeLink({implementingPID:i,implementedPID:e,cmdAction:m.PartialScopeAction.SWITCH_TO_FULLSCOPE})}else t.warn(o.getNLSValue("Error.SwitchPartialScope",{objectName:a}))},E=function(e){U(),d.getRelations().then((function(t){t.isRelationsLoaded&&(h(K,e.arguments),u(K,F),Y.cmdTitle="ImplementUI.AssignImplemented",Y.implementingSection=!0,Y.implementedSection=!0,Y.optionsSection=!1,Y.checkForImplementingScope=!1,Y.modalFlag=!1,Y.multiSelectionOfImplementing=!1,Y.multiSelectionOfImplemented=!0,Q=i.createImplementUI(Y),f(Q.getSelectionsWithPaths()))}))},O=function(){var t,n,i=c.getSelectionsWithPaths()[1],o=[];U(),i.forEach((function(i){t=i.path,n=e.is(t)&&t.length>0?t:i.id,o.push(n)})),a.unassignProduct(o)},N=function(t){U(),h(q,t.arguments),u(q,y),Y.cmdTitle="ImplementUI.CreateImplementingAndScope",Y.implementingSection=!1,Y.implementedSection=!0,Y.optionsSection=!1,Y.checkForImplementingScope=!1,Y.modalFlag=!0,Y.multiSelectionOfImplementing=!1,Y.multiSelectionOfImplemented=!0,e.is(G)&&(Y.cmdTitle="ImplementUI.ContinuousProvidedMaterialAndScope",Y.newObjDimensionType=G),Q=i.createImplementUI(Y),P(Q.getSelectionsWithPaths())},R=function(){var n,i,l,a=[],s=o.getNLSValue("ImplementUI.Implementing");U(),n=c.getSelectionsWithPaths()[1],e.is(n,"array")&&n.length>0&&n.forEach((function(t){i=t.path,l=e.is(i)&&i.length>0?i:t.id,m.isScoped(l)&&a.push(l)})),a.length>0?m.deleteScopeLink(a):t.warn(o.getNLSValue("Error.ScopeDeletion",{objectName:s}))},k=function(t,n){U(),A(t,V),Y.cmdTitle=e.is(n)?n:"",Y.implementedRevTreeListCSSStyle="implementedSection-container",Y.optionsSection=!1,Y.modalFlag=!1,J=i.createImplementedRevChooserUI(Y),C(c.getSelections()[1][0])},T=function(){k(H,"Dialog.ReconnectScope.Title")},D=function(){k(X,"Dialog.ReviseAndReconnectScope.Title")},x=function n(){var i,a,s,r=c.getSelectionsWithPaths()[1][0].id,p=l.getReferenceModel(r);e.is(p)?(i=p.get("PID"),(a=m.getScopeLinksOfImplementing(i)).length<=0?t.warn(o.getNLSValue("Error.NoProductScopeExists.Title")):(s=a[0].get("to"),e.is(undefined)&&t.warn(s),m.createEngMadeFromItem(s,p))):t.debug(n+": Reference Model not found for pid:"+r)},{listenTo:function(){return{select:this.onSelect,CreateScopeLink:b,DeleteScopeLink:R,ReconnectScope:T,ReviseAndReconnectScope:D,AssignProduct:E,UnassignProduct:O,CreateMfgItemAndScope:N,CreatePartialScopeLink:B,DeletePartialScopeLink:W,StretchPartialScopeLink:_,SwitchToFullScopeLink:j,DELCreateEngineeringMadeFromItem:x}},onStart:function(e){S=e},onStop:function(){I(),v()},onSelect:function(t){var n;if(e.is(Q)&&Q.isVisible()){if(e.is(t)){if(!1===L(t))return;e.is(t.selectedNodeIds)&&t.selectedNodeIds.length>0&&(n=Q.getSelectionsWithPaths())}e.is(n)&&n.selNodes.length>0&&(!0===Y.implementingSection?f(n):P(n))}else e.is(J)&&J.isVisible()&&e.is(t.selectedNodeIds)&&t.selectedNodeIds.length>0&&C(c.getSelections()[1][0])}}}}}));