define("DS/PlatformManagementLayout/EditableTabView",["UWA/Core","UWA/Utils","DS/UIKIT/DropdownMenu","i18n!DS/PlatformManagementLayout/assets/nls/PlatformManagementLayout","css!DS/PlatformManagementLayout/PlatformManagementLayout.css"],(function(e,t,s,a){"use strict";var n=require("DS/Dashboard/UserPlatformAccess"),o=require("DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"),i=require("DS/PlatformAPI/PlatformAPI"),l=require("DS/UWPClientCode/PublicAPI"),r="my-account",c=[],m=[],u=null;return{init:function(e,t){var s=this,a=3,l=function(){0===--a&&t.refreshIfVisible()};s.tabsOptions={className:r,classNames:{scroller:r+"-tablist-scroller",scrollerButton:r+"-scroller-button",tabView:r+"-tabview",tabList:r+"-tablist",tabPanels:r+"-tabview-panel"},editable:!1,allowNewTab:!1},console.log(e),this.items=[],console.log(s),e.setValue("tabsOptions",s.tabsOptions),o.getGrantedRoles((function(e){c=e,l()})),i.subscribe("com.ds.i3DXCompassManagement:updateNotificationBadge",(function(t){var s=e.body.getElement("[data-tabid=PlatformManager00011] .badge");s&&(s.setText(t.count),s.toggleClassName("hidden",0===t.count))})),n.fetchUserStartupParams().then((function(e){e.roles.forEach((function(e){e.roles.detect((function(e){return"Operator"===e.id}))&&(s.items.push({value:e.platform,text:e.platform}),localStorage.getItem("platform-manager-id")===e.platform&&(u=e.platform))})),u||(u=s.items[0].text),o.getPlatformServices({platformId:u,onComplete:function(e){m=e,l()}}),l()}))},onLoadCards:function(e,t){var s=e.layout.elements.container;l.getUser(),this._buildHeader(e),this._overrideCss(s),this._buildMobileMenu(s),this._buildPlatformSelector(e,s),this._buildMoreLessMenu(s),this._hideMenus(e,s)},_overrideCss:function(e){var t,s;e.className+=" row",s=e.querySelector("."+this.tabsOptions.classNames.scroller+"-ctn"),t=e.querySelector("."+this.tabsOptions.classNames.tabPanels),s.className+=" hidden-xs col-sm-4 col-md-2 resetPadding",t.className+=" col-xs-12 col-sm-8 col-md-10 resetPadding"},_buildMobileMenu:function(t){var s=e.createElement("select",{class:"form-control mobile-tab-select"}),a=e.createElement("div",{class:"mobile-tab-container visible-xs"}),n=t.querySelector("."+this.tabsOptions.classNames.tabPanels);s.inject(a),t.insertBefore(a,n)},_buildHeader:function(e){e.body.innerHTML+='<div class="'+r+'-header row"><div class="first">'+a.get("welcome")+'</div><div class="second">'+a.get("platformManagement")+"</div></div>"},_buildPlatformSelector:function(t,a){var n=a.querySelector("."+this.tabsOptions.classNames.tabList);if(this.items.length>1)var o=e.createElement("li",{class:"wp-tab "+r+"-custom-tab",html:{class:"inner-ctn",html:{tag:"span",class:"title",html:[{tag:"i",class:"fonticon fonticon-3ds-compass expand-more"},{tag:"span",text:u},{tag:"i",class:"fonticon fonticon-open-down expand-more"}]}}}).inject(n,"top");!self.dropdown&&this.items.length>1&&(self.dropdown=new s({target:o,position:"bottom left",items:this.items,events:{onClick:function(e,s){console.log(s),localStorage.setItem("platform-manager-id",s.value),t.setPreferences({platform:s.value}),window.location.reload()}}}))},_buildMoreLessMenu:function(t){var s=this,n=t.querySelector("."+this.tabsOptions.classNames.tabList),o=t.querySelectorAll("."+s.tabsOptions.classNames.tabList+" > .wp-tab:not(."+r+"-custom-tab) .title");console.log("."+s.tabsOptions.classNames.tabList+" > .wp-tab:not(."+r+"-custom-tab) .title"),o.length>2&&e.createElement("li",{class:"wp-tab "+r+"-custom-tab expand-more",html:{class:"inner-ctn",html:{tag:"span",class:"title state-more",html:[{tag:"i",class:"fonticon fonticon-expand-left less"},{tag:"span",text:a.get("more")},{tag:"i",class:"fonticon fonticon-expand-right more"}]}},events:{click:function(){t.querySelectorAll("."+s.tabsOptions.classNames.tabList+" > .wp-tab:not(."+r+"-custom-tab) .title").forEach((function(e,t){t>2&&e.getParent("li").toggleClassName("hidden")})),this.getElement(".title").hasClassName("state-more")?this.querySelector(".title span").innerText=a.get("less"):this.querySelector(".title span").innerText=a.get("more"),this.getElement(".title").toggleClassName("state-more").toggleClassName("state-less")}}}).inject(n)},_hideMenus:function(t,s){var a=this;s.querySelectorAll("."+a.tabsOptions.classNames.tabList+" > .wp-tab:not(."+r+"-custom-tab) .title").forEach((function(s,n){var o=JSON.parse(t.layout.tabs[n].options.item.data),i=o.icon||"",l=o.role||null,r=o.service||null;s.innerHTML='<span class="fonticon fonticon-'+i+'"></span> '+s.innerHTML,n>2&&s.getParent("li").addClassName("hidden"),a._isRoleAvailable(l)||s.getParent("li").addClassName("missing-role"),a._isServiceAvailable(r)||s.getParent("li").addClassName("missing-service");e.createElement("div",{class:"badge-notification",html:{tag:"span",text:0,class:"badge hidden"}}).inject(s)}))},_isRoleAvailable:function(e){return!e||!!c.detect((function(t){return t.id===e&&t.platforms.indexOf(u)>-1}))},_isServiceAvailable:function(e){return!e||!!m[e]}}})),define("DS/PlatformManagementLayout/Column",["UWA/Core","UWA/Class/Promise"],(function(e,t){"use strict";var s=require("DS/UWPClientCode/WidgetFactory"),a=require("DS/WidgetPreview/Environment/Transient"),n=require("DS/i3DXCompass/i3DXCompass"),o="my-account",i="."+o+"-header",l="module "+o+" -module";return{init:function(e,t){console.log("init"),t.refreshIfVisible()},_getAppInfo:function(e){return new t((function(t,s){n?n.getAppInfo({appId:e,onComplete:function(e){e?t(e):s("Could not locate app information.")},onFailure:s}):s()}))},_instantiateApp:function(n,o,i){return new t((function(t){var l={el:o,title:"",parent:!1,preview:!0,appId:n.id,data:i||{},header:!0};if(!n||!(n.checksum&&n.launchInfos||n.platforms&&n.platforms[0]&&n.platforms[0].checksum&&n.platforms[0].launchInfos))throw new Error("Could not get valid Config from MyApps for the App "+l.appId);l=e.extend(l,{widgetId:e.is(n.launchInfos)?n.launchInfos:n.platforms[0].launchInfos,isolationLevel:e.is(n.isolationLevel)?n.isolationLevel:n.platforms[0].isolationLevel,token:e.is(n.checksum)?n.checksum:n.platforms[0].checksum}),s.load(l,(function(){l.widget&&l.widget.environment&&self.wp&&self.wp.isVisible&&l.widget.environment.setVisible(!0,!0),t(l.widget)}),a)}))},onBeforeLoadColumns:function(t,s){var a=this,n=document.body.querySelector(".main"),o=document.body.querySelector(i),r=n&&e.extendElement(n).getSize().height||588,c=o&&e.extendElement(o).getSize().height||100,m=t&&t.getValue("appId"),u=e.createElement("div",{class:l,styles:{height:r-c}}).inject(t.layout.columns[0].body);a._getAppInfo(m).then((function(e){return a._instantiateApp(e,u,"")}))}}}));