define("DS/CATCivilCompareRulesIntegration/plugins/STRUCTURE/expanders/aec_expandMgr",["DS/CompareWidget2/plugins/STRUCTURE/expanders/cvExpand","DS/CATCivilCompareRulesIntegration/plugins/STRUCTURE/expanders/aec_cvProgressiveExpand","DS/CompareWidget2/plugins/STRUCTURE/expanders/fileExpand","DS/CompareWidget2/plugins/STRUCTURE/expanders/compareServiceExpand","DS/CompareWidget2/plugins/STRUCTURE/expanders/lifecycleServicesExpand","DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/nodeOccRel2RefInstTree","DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/cv2RefInstTree","DS/CATCivilCompareRulesIntegration/plugins/STRUCTURE/expansionAdapters/aec_pe2RefInstTree","i18n!DS/CompareWidget2/assets/nls/DisplayMessages","DS/CompareWidget2/plugins/STRUCTURE/expanders/cvProgressiveExpandWithBSD","DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/pe2RefInstTreeWithBSD","DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/pe2RefInstTreeWithPGP"],(function(e,t,n,i,r,a,s,o,l,c,u,_){var p={CV_DIRECT:{expander:e,adapter:s},CV_SERVICE:{expander:i,adapter:a},DB_SERVICE:{expander:i,adapter:a},CV_PROGRESSIVE:{expander:t,adapter:o},CV_PROGRESSIVE_PGP:{expander:t,adapter:_},CV_PROGRESSIVE_BSD:{expander:c,adapter:u},LC_IDX_SERVICE:{expander:r,adapter:s},LC_AUTH_SERVICE:{expander:r,adapter:s},FILE_CV:{expander:n,adapter:s},FILE_NOR:{expander:n,adapter:a},FILE_PE:{expander:n,adapter:o},FILE_PE_BSD:{expander:n,adapter:u}};return{expandUsingType:function(e,t,n,i,r){return new Promise((function(a,s){var o=p[t];if(null==o){var c="UNKNOWN EXPAND TYPE: '"+t+"'";i.errout(c),s(c)}return o.expander.doExpand(e,t,n,i,r).then((function(n){if("CV_PROGRESSIVE_BSD"===t)var{expandedData:c,bsdStruct:u}=n;else var c=n;if(r._ODT_FailFirstFetch&&s("ODT: failing initial fetch"),null==c||0==c.length)i.showAlertBox("RETURN_IS_BLANK",l,"warning"),s("Object query returned blank - was the root filtered out?");else{"AMD_MODULE_PATH"==e.getIDType()?i.dbgout("Expand via '"+t+"' successful for AMD Module: "+e.getPhysID()):i.dbgout("Expand via '"+t+"' successful for ID: "+e.getPhysID());var _=null;null==(_=null!=o.adapter?"CV_PROGRESSIVE_BSD"===t?o.adapter.convert(e,c,i,r,u):o.adapter.convert(e,c,i,r):c)?s("Adapter has failed..."):(_.sortChildren(),a(_))}}),(function(e){i.warnout("Failed to expand using "+t+" ::"+e),s(e)}))}))},doExpand:function(e,t,n,i,r,a){var s=this;return new Promise((function(o,l){s.expandUsingType(e,t,i,r,a).then((function(e){o(e)}),(function(t){r.warnout("Primary expansion failed: "+t),null==n?(r.errout("No secondary expand Type; can't continue!"),l(t)):(r.warnout("Attempting to expand using secondary expandType"),s.expandUsingType(e,n,i,r,a).then((function(e){r.warnout("Secondary expansion success"),o(e)}),(function(e){r.warnout("Secondary expansion failed: "+e),l(e)})))}))}))}}})),define("DS/CATCivilCompareRulesIntegration/plugins/STRUCTURE/expanders/aec_cvProgressiveExpand",["UWA/Core","DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/support/DataCenter"],(function(e,t,n){var i={format:"entity_relation_occurrence",hits:{predefined_computation:["boundingbox","cgr","thumbnail_3d","icons"]},select_object:["physicalid","ds6w:type","ds6w:globaltype","ds6wg:revision","ds6w:label","ds6wg:XCADOrientationExt.V_WorldOrientation"],select_relation:["physicalid","ds6w:type","ro.plminstance.v_treeorder","ro.plminstance.plm_externalid"]},r={format:i.format,hits:i.hits,select_object:[...i.select_object,"relcount","bo.plmentity.plm_externalid","ds6w:reserved","ds6w:description","ds6w:modified","ds6w:created","ds6w:responsible","ds6w:policy","ds6w:organizationResponsible","ds6w:project","ds6w:reservedBy","ds6w:identifier","bo.plmreference.v_derivedfrom"],select_relation:[...i.select_relation,"Matrixtxt"]};function a(e,n,a,s){var o=null!=s&&0!=s.length,l=o?i:r,c={batch:{expands:[{label:"ENOCompare_Progrssive_Expand",root:{physical_id:e},filter:{all:1},aggregation_processors:[]}]},outputs:t.dupeJson(l)};return o&&(c=function(e,t){return Object.keys(t).forEach((function(n){var i=t[n],r=i.indexOf(".");if(-1==r)e.select_bo.push(i);else{var a=i.substr(0,r),s=i.substr(r+1);if("REF"==a)"dfr"==s&&(s="bo.plmreference.v_derivedfrom"),-1==e.outputs.select_object.indexOf(s)&&e.outputs.select_object.push(s);else{if("INST"!=a)throw new Error("UNKNOWN specifier in PROPS definition");"matrixtxt"==s&&(s="Matrixtxt"),-1==e.outputs.select_relation.indexOf(s)&&e.outputs.select_relation.push(s)}}})),e}(c,s)),c}function s(t,i,r,s,o){return new Promise((function(r,l){var c="/cvservlet/progressiveexpand/v2";s.dbgout("------------[ T R E E   E X P A N S I O N    B E G I N ] -----------"),s.dbgout("cvExpand on id: "+t.getPhysID()+"\n on service   : "+t.getServiceName()+"\n with expand type: cvProgressiveExpand\n with URL     : "+c);(function(t,n,i,r){return new Promise((function(n,i){var s=a(t.getPhysID(),0,0,r.CV_PROPS),o=t.getExternalFilterSpec();null!=o&&(s=function(e,t){return null!=t.CVQueryV2.filter?e.batch.expands[0].filter=t.CVQueryV2.filter:e.batch=t.CVQueryV2.batch,e}(s,o)),null!=r.PROGRESSIVE_EXPAND_OPTIONS&&e.extend(s.batch.expands[0],r.PROGRESSIVE_EXPAND_OPTIONS),null!=r.PROGRESSIVE_EXPAND_OUTPUTS&&e.extend(s.outputs,r.PROGRESSIVE_EXPAND_OUTPUTS),n(s)}))})(t,0,0,o).then((function(e){var a=e;n.makeAuthHttpsCall(c,"POST",a,"text/plain",t.getTenant(),t.getServiceName(),t.getSecurityContext(),!1,!1,"output_format=cvjson&redirectQueryToSGI=true&expandIndexUnit=3DSpaceTransformedForIFC").then((function(e){var t=e;"string"==typeof t&&(t=t.replace("{}",""),t=JSON.parse(t)),null!=t.errors&&0!=t.errors.length?l(t.errors):((t=t.results)._dataSource=i,s.dbgout("------------[ T R E E   E X P A N S I O N    E N D    ] -----------"),r(t))}),(function(e){l(e)}))}),(function(e){l(e)}))}))}return{jsClass:"CV_PROGRESSIVE_EXPAND",doExpand:function(e,t,n,i,r){return s(e,t,0,i,r)}}})),define("DS/CATCivilCompareRulesIntegration/viewdef/CivilObjectOptions",["UWA/Core","DS/CompareWidget2/ViewDefModules/ViewDefOptions"],(function(e,t){"use strict";let n=e.merge({FRAMEWORK_OPTIONS:{customCompareActive:!0}},e.clone(t,!0));n.STRUCT_DISPLAY_OPTIONS.SHOW_HIDE_NODE_PARAMS=[{NAME:"SHOW_HIDE_PORT_AND_CONNECTION",CHILD:{TYPE:["PLMPort","PLMConnection"]},SHOW:!1},{NAME:"SHOW_HIDE_3DSHAPE_OF_3DPART",CHILD:{TYPE:["3DShape"]},SHOW:"viewSettings.STRUCT_VIEW.show_3dshape_of_3dpart"}];let i=!0;return n.STRUCT_FETCH_OPTIONS.DATA_SOURCE="CV_PROGRESSIVE",n.STRUCT_FETCH_OPTIONS.PROGRESSIVE_EXPAND_OPTIONS={aggregation_processors:[{synthesis:{name:"ProgressiveExpand_LeafSynthesis",mode:"tree_leaf"}}],graph:{descending_condition:{uql:"availability:2"},descending_condition_object:{uql:'[ds6w:globaltype]:"ds6w:Document" OR [ds6w:globaltype]:"ds6w:Part"'},descending_condition_relation:{uql:'NOT (flattenedtaxonomies:"reltypes/XCADBaseDependency") AND NOT (flattenedtaxonomies:"reltypes/Reference Document")'}},parameters:{limit_max_path:2e4},shatteredExpand:!0},n.AEC_ATTR_FETCH_OPTIONS={useSGIfetch:i},n.INST_ATTR_FETCH_OPTIONS.useSGIfetch=i,n})),define("DS/CATCivilCompareRulesIntegration/utils/aec_attrFetchUtils",["UWA/Class","text!DS/CATCivilCompareRulesIntegration/assets/masks/aec_coreInfoMask.json"],(function(e,t){const n="undefined"!=typeof widget?widget.lang:"en",i=JSON.parse(t);return e.singleton({init:function(){return this._extDictionary={},this._attrDictionary={},this._plugSvcs=null,this._plugOptions=null,this._reqServiceName=null,this._reqTenant=null,this._reqSecurityContext=null,this._parent()},initializeUtils:function(e,t,n,i,r){this._plugSvcs=e,this._plugOptions=t,this._reqServiceName=n,this._reqTenant=i,this._reqSecurityContext=r},_fetchCoreInfo:async function(e){var t=this;let i={physicalid:e,label:"ENOCompare-"+Date.now().toString(),locale:n,select_file:["icon","thumbnail_2d"],select_predicate:["ds6w:type","interface","ds6w:i3dx"],shatteredFetch:!0,unescape_slashes_in_attribute_values:!0};return new Promise((function(e,n){t._plugSvcs.makeAuthHttpsCall("/cvservlet/fetch/v2","POST",i,"json",t._reqTenant,t._reqServiceName,t._reqSecurityContext,!1,!1,"redirectQueryToSGI=true").then((function(n){let i={serviceName:t._reqServiceName,tenant:t._reqTenant,securityContext:t._reqSecurityContext,coreInfos:[]},r=n;if(void 0!==r.results)for(let e=0;e<r.results.length;e++){let t=r.results[e];i.coreInfos.push({type:"",exts:[]});for(let n=0;n<t.attributes.length;n++){switch(t.attributes[n].name){case"ds6w:i3dx":i.coreInfos[e].i3dx=t.attributes[n].value;break;case"ds6w:type":i.coreInfos[e].type=t.attributes[n].value;break;case"interface":-1===i.coreInfos[e].exts.indexOf(t.attributes[n].value)&&i.coreInfos[e].exts.push(t.attributes[n].value);break;default:i.coreInfos[e][t.attributes[n].name]=t.attributes[n].value}i.coreInfos[e][t.attributes[n].name]=t.attributes[n].value}}e(i)}),(function(e){t._plugSvcs.errout("Failure retrieving predicates for object"),n(null)}))}))},_fetchAttributes:async function(e,t){var i=this;let r={physicalid:e,label:"ENOCompare-"+Date.now().toString(),locale:n,tenant:i._reqTenant,select_file:["icon","thumbnail_2d"],select_predicate:t,shatteredFetch:!0,unescape_slashes_in_attribute_values:!0};return new Promise((function(e,t){i._plugSvcs.makeAuthHttpsCall("/cvservlet/fetch/v2","POST",r,"json",i._reqTenant,i._reqServiceName,i._reqSecurityContext,!1,!1,"redirectQueryToSGI=true").then((function(t){let n={serviceName:i._reqServiceName,tenant:i._reqTenant,securityContext:i._reqSecurityContext,result:t};e(n)}),(function(e){i._plugSvcs.errout("Failure retrieving predicates for object"),t(null)}))}))},_getPropertiesForClass:async function(e,t){const n=e.classURIs.split("\n");var i={resourceid:t,predicates:[],NLS:[]};for(let e=0;e<n.length;e+=100){const t=n.slice(e,e+100);try{let e=await this._splittedPropertiesForClass(t.join("\n"));e&&(i.predicates=i.predicates.concat(e)),e=await this._fetchNLSForProperties(t.map((e=>"ds6wg:"+e)).join(",")),e&&(i.NLS=i.NLS.concat(e))}catch(e){console.warn("Cannot retrieve information from "+t)}}return i},_getNLSForClass:async function(e){const t=e;var n={predicates:[]};for(let e=0;e<t.length;e+=100){const i=t.slice(e,e+100);try{let e=await this._fetchNLSForProperties(i.join(","));e&&(n.predicates=n.predicates.concat(e))}catch(e){console.warn("Cannot retrieve NLS information from "+i)}}return n},_splittedPropertiesForClass:async function(e){var t=this;return new Promise((async function(i,r){(await require("DS/FedDictionaryAccess/FedDictionaryAccessAPI")).getPropertiesForClass(e,{tenantId:t._reqTenant,lang:n,apiVersion:"R2019x",onComplete:function(e){var t="string"==typeof e?JSON.parse(e):e;i(t)},onFailure:function(e){console.warn("FedDictionaryAccessAPI.getPropertiesForClass failed"),r()}})}))},_fetchNLSForProperties:async function(e){var t=this;return new Promise((async function(i,r){(await require("DS/FedDictionaryAccess/FedDictionaryAccessAPI")).getResourcesInfo(e,{tenantId:t._reqTenant,lang:n,apiVersion:"R2019x",onComplete:function(e){var t="string"==typeof e?JSON.parse(e):e;i(t)},onFailure:function(e){console.warn("FedDictionaryAccessAPI.getResourcesInfo failed"),r()}})}))},_fetchAttributeValues:async function(e){var t=this;return new Promise((async function(n,r){try{let a=await t._fetchCoreInfo(e),s=[];if(a.coreInfos&&a.coreInfos.length>0)for(let e=0;e<a.coreInfos.length;e++){let n=a.coreInfos[e],i=[],r=n.exts.map((e=>e));i.push(r),i.push(n.type),i=i.flat(1/0),s.push(t._getPropertiesForClass({classURIs:i.join("\n")},n.resourceid))}try{(await Promise.all(s)).forEach((e=>{e.predicates.forEach((e=>{t._extDictionary[e.classInfo.curi]={NLS:"",attributes:[]};for(let n=0;n<e.properties.length;n++){let r=e.properties[n];-1===i.attrToIgnore.indexOf(r.curi)&&(-1===t._extDictionary[e.classInfo.curi].attributes.indexOf(r.curi)&&t._extDictionary[e.classInfo.curi].attributes.push(r.curi),void 0===t._attrDictionary[r.curi]&&(t._attrDictionary[r.curi]=r,t._attrDictionary[r.curi].definedIn=[]),-1===t._attrDictionary[r.curi].definedIn.indexOf(e.classInfo.curi)&&t._attrDictionary[r.curi].definedIn.push(e.classInfo.curi))}})),e.NLS.forEach((e=>{t._extDictionary[e.curi].NLS=e.label}))}));let a=[];for(let e in t._attrDictionary)t._attrDictionary.hasOwnProperty(e)&&a.push(e);-1!==a.indexOf("ds6w:responsible")&&-1===a.indexOf("owner")&&a.push("owner"),a=[...new Set(a)],a.sort();try{let i=await t._fetchAttributes(e,a),r=await t._getNLSForClass(a);r.predicates.length>0&&r.predicates.forEach((e=>{void 0!==t._attrDictionary[e.curi]&&(t._attrDictionary[e.curi].labelNLS=void 0!==e.label?e.label:"")})),n(i)}catch(e){t._plugSvcs.errout("Failure fetching attributes for objects"),r(null)}}catch(e){t._plugSvcs.errout("Failure retrieving available attributes for objects"),r(null)}}catch(e){t._plugSvcs.errout("Failure retrieving attributes for object"),r(null)}}))}})})),define("DS/CATCivilCompareRulesIntegration/plugins/STRUCTURE/expansionAdapters/aec_pe2RefInstTree",["DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/exAdapter","DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/treeBuilder"],(function(e,t){return e.singleton({jsClass:"PE2REFINST_TREE",convert:function(e,n,i,r){!function(e){let t=[],n=[],i=new Map;for(let r=0;r<e.length;r++){let a=e[r];"VPMRepReference"===a["ds6w:type"]&&"string"==typeof a.resourceid&&i.set(a.resourceid.slice(0,-1),r),"3DShape"===a["ds6w:type"]&&t.push(a),void 0!==a.Path&&a.Path.length&&n.push(a)}for(let r=0;r<t.length;r++){let a=t[r];if(void 0===a)continue;let s=void 0!==a.resourceid?a.resourceid:"";for(let t=0;t<n.length;t++){let r=n[t].Path.filter((e=>e.includes(s)&&e!==s));for(let t=0;t<r.length;t++)for(let n=0;n<e.length;n++)if(void 0===e[n].Path){if(!e[n]["ds6w:type"].includes("Instance")&&void 0!==e[n].resourceid&&void 0===e[n].logicalid&&void 0===e[n].versionid&&e[n].resourceid===r[t]){let t=e[n].resourceid.slice(32);e[n].logicalid=a.logicalid+t,e[n].versionid=a.versionid+t}if(void 0!==e[n]["ds6wg:EnterpriseExtension.V_PartNumber"]&&i.has(e[n].resourceid)){const t=i.get(e[n].resourceid);t>=0&&t<e.length&&(e[t]["ds6wg:EnterpriseExtension.V_PartNumber"]=e[n]["ds6wg:EnterpriseExtension.V_PartNumber"]+"_B")}}}}}(n);for(var a=new t(e),s=n.length,o=0;o<s;o++){var l=n[o];if(null!=l.resourceid){var c=a.build_dbObj(l,r.MULTI_VALUE_ATTRS);a.add_dbObj(c)}else null!=l.Path?a.add_path(l.Path):null!=l.icon__default_thumbnail_2d?a.add_typeIcons(l.icon__default_thumbnail_2d):i.errout("Unknown entry in input:"+JSON.stringify(l)+", skipping...")}var u=a.buildTree();return a=null,u}})})),define("DS/CATCivilCompareRulesIntegration/viewdef/Utilities",["UWA/Core","UWA/Controls/Abstract","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/WAFData/WAFData"],(function(e,t,n,i){"use strict";var r=t.singleton({init:function(){r._cacheUrlMap=new Map,r._objectId=0,r._cacheSecurityContext=""},refreshSecurityContext:function(){r._cacheSecurityContext=widget.getValue("xPref_CREDENTIAL")},get3DSpaceAndLoginTicket:async function(e){return new Promise((async function(t,n){let i="",a="",s="";try{i=await r.get3DSpace(e),r._cacheUrl3DSpace=i,s=r.getSecurityContext(),a=await r.getLoginTicket(i,s,e,!0),r._cacheLoginTicket=a,t()}catch(e){n(e)}}))},getLoginTicket:function(e,t,n,a){let s=this;if(!0===a&&(r._cacheLoginTicket=null),"string"==typeof r._cacheLoginTicket&&r._cacheLoginTicket)return Promise.resolve(r._cacheLoginTicket);if(this._getLoginTicketPromise)return this._getLoginTicketPromise;if(!widget.uwaUrl)return r._cacheLoginTicket="",Promise.resolve(r._cacheLoginTicket);var o=new Promise((async function(a,o){var l={timeout:15e3,cache:-1,method:"GET",type:"json",headers:{Accept:"application/json","Accept-Language":null},onComplete:function(t){var n={loginTicket:t.ticket,url3DSpace:e};r._cacheLoginTicket=t.ticket,s._getLoginTicketPromise=null,a(n)},onFailure:function(){s._getLoginTicketPromise=null,o(new Error("GetLoginTicket failed"))}},c=e+"/ticket/get?";c+=t?"runasctx="+encodeURIComponent(t):"runasctx=preferred",n&&(c+="&tenant="+encodeURIComponent(n)),i.authenticatedRequest(c,l)}));return this._getLoginTicketPromise=o,o},get3DSpace:function(e){let t=this;if("string"==typeof r._cacheUrl3DSpace&&r._cacheUrl3DSpace.length)return Promise.resolve(r._cacheUrl3DSpace);if(this._get3DSpacePromise)return this._get3DSpacePromise;if(!widget.uwaUrl)return r._cacheUrl3DSpace="",Promise.resolve(r._cacheUrl3DSpace);var i=new Promise((async function(i,a){n.getServiceUrl({serviceName:"3DSpace",platformId:e,onComplete:function(e){r._cacheUrl3DSpace=e,t._get3DSpacePromise=null,i(r._cacheUrl3DSpace)},onFailure:function(){t._get3DSpacePromise=null,a(new Error("get3DSpace failed"))}})}));return this._get3DSpacePromise=i,i},getSecurityContext:function(){return r._cacheSecurityContext.replace("ctx::","")},initServiceManager:function(){return new Promise((async function(e,t){let n=null,i=null,a=null,s=null;try{n=await r.getTenantId()}catch(e){console.error("Couldn't retrieve TenantId"),t(e)}try{i=await r.get3DSpace(n),r._cacheUrl3DSpace=i}catch(e){console.error("Couldn't retrieve LoginTicket"),t(e)}a=r.getSecurityContext();try{s=await r.getLoginTicket(i,a,n,!0),r._cacheLoginTicket=s}catch(e){console.error("Couldn't retrieve LoginTicket"),t(e)}n&&i&&s&&a?e():t()}))},getTenantId:function(){let e=this;if(r._cacheTenantId)return Promise.resolve(r._cacheTenantId);if(this._getTenantIdPromise)return this._getTenantIdPromise;if(!widget.uwaUrl)return r._cacheTenantId="TST",Promise.resolve(r._cacheTenantId);if(void 0===r._cacheTenantId)return r._cacheTenantId=widget.getValue("x3dPlatformId"),Promise.resolve(r._cacheTenantId);var t=new Promise((async function(t,i){n.getServiceUrl({serviceName:"3DDesign",onComplete:function(n){r._cacheTenantId=n[0].platformId,e._getTenantIdPromise=null,t(r._cacheTenantId)},onFailure:function(){e._getTenantIdPromise=null,i(new Error("getTenantId failed"))}})}));return this._getTenantIdPromise=t,t}});return e.namespace("DS/CAT3DWebStoreyComponents/Utilities",r)})),define("DS/CATCivilCompareRulesIntegration/plugins/STRUCTURE/AEC_STRUCT_FETCH_plugin",["DS/CompareWidget2/plugins/plugin","DS/CATCivilCompareRulesIntegration/plugins/STRUCTURE/expanders/aec_expandMgr","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInstTreeAug","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInstTreeEditor","DS/CompareWidget2/support/objIDSpec","DS/CompareWidget2/userSettings/UserSettingsManager","DS/CompareWidget2/support/typeHierMgr","i18n!DS/CompareCommon/assets/nls/CompareCommon","i18n!DS/CompareWidget2/assets/nls/CompareV2","i18n!DS/CompareWidget2/assets/nls/DisplayMessages"],(function(e,t,n,i,r,a,s,o,l,c){function u(e,i){var a=this;return new Promise((function(s,o){a._plugSvcs.postEvent("STRUCT_UPDATE_IN_PROGRESS_EVENT",null);var l=[];e.forEach((function(e){if(null!=e.getCommands){var t=e.getCommands();null!=t&&t.forEach((function(t){var n=t.inNode;if(null!=n){var i=new r(n,"UNKNOWN",e.getSecurityContext(),e.getTenant(),e.getServiceName());l.push(i)}}))}}));for(var c=[...e,...l],u=[],_=c.length,p=0;p<_;p++){var d=null,h=null,f=c[p];if("AMD_MODULE_PATH"==f.getIDType())d="FILE_EXPAND";else{var g=f.isFiltered();if(0==a._useIndex&&0==g?d=a._expanders.byDB:(d=a._expanders.byIndex,h=g?null:a._expanders.byDB),"function"==typeof f.getBSDId&&f.getBSDId())d="CV_PROGRESSIVE_BSD";else if("CV_DIRECT"==d){var T=f.getExternalFilterSpec();null!=T&&null!=T.CVQueryV2&&"DELLmiGeneralSystemReference"!=f.getObjType()&&(d="CV_PROGRESSIVE")}}t.doExpand(f,d,h,"-1",a._plugSvcs,i).then((function(e){var t=e;if("AMD_MODULE_PATH"==f.getIDType())u.push(t),u.length>=_&&s(u);else{var i={securityContext:t._objIDSpec._securityContext,tenant:t._objIDSpec._tenant,serviceName:t._objIDSpec._serviceName};n.augment(t,i,a._plugSvcs).then((function(e){var t=e;u.push(t),u.length>=_&&s(u)}),(function(e){a._plugSvcs.errout("FAILURE AUGMENTING TREE:"+e),o(e)}))}}),(function(e){a._plugSvcs.errout("FAILURE EXPANDING TREE: "+e),o(e)}))}}))}function _(e){var t,n,i,r="compareSettings.dataSource.useIndex";if(!a.hasPref(r)){if(!a.hasPref("mergeSettings.dataSource.useIndex"))return void console.log("forceSwapToIndexMode: No setting found for using index.");r="mergeSettings.dataSource.useIndex"}!1===a.get(r)&&(e||(t="INDEX_REQ_ENABLING",n="compare-alert-warning",require(["DS/CompareCommon/CompareAlert"],(function(e){var r=null==t?o["MISSING ALERT MESSAGE"]:null!=o[t]?o[t]:t,a=null!=i&&""!==i?r.replace("{msgData}",i):r;e.doAlert({msg:a,alertStyle:n})}),(function(e){console.log("%%%% CompareWidget:: Failed to show "+n+": '"+t+"', error:"+e)}))),widget.setValue(r,!0),a.set(r,!0))}function p(e){this.postEvent({event:"Event_CW2_REFRESH"})}return e.extend({init:function(e,t,n,i){this._parent(e,t,n,i),this._expanders={byIndex:"CV_DIRECT",byDB:null},this.setExpandMethods(n.DATA_SOURCE,n.DB_FALLBACK)},onEnabled:function(){return this.syncSetting("compareSettings.dataSource.useIndex","_useIndex",p.bind(this)),!0},setExpandMethods:function(e,t){var n=this;null!=e&&""!==e&&(n._expanders.byIndex=e),null==t||""==t||0==t?n._expanders.byDB=null:1==t?"CV_SERVICE"==e||"CV_DIRECT"==e?n._expanders.byDB="DB_SERVICE":"LC_IDX_SERVICE"==e?n._expanders.byDB="LC_AUTH_SERVICE":(n._plugSvcs.warnout("DB FALLBACK DISABLED, as there is no default DB fallback for an expand of type: "+n._expanders.byIndex),n._expanders.byDB=null):n._expanders.byDB=t},execute:function(e,t){var n=this;n._parent(e,t);var r=e,a=r.some((e=>null!=e.isFiltered&&e.isFiltered()));n.setExpandMethods(t.DATA_SOURCE,t.DB_FALLBACK),(a||null==n._expanders.byDB&&0==n._useIndex)&&_.call(n,!1),u.call(n,r,t).then((function(e){var t=function(e,t){var n=[],i=[],r=[],a={};return t.forEach((function(e){var t=e.getObjIDSpec().getUniqueID();null==a[t]&&(a[t]=[]),a[t].push(e)})),e.forEach((function(e){var t=e.getUniqueID(),i=a[t].pop();n.push(i),r.push(t)})),Object.keys(a).forEach((function(e){a[e].forEach((function(e){i.push(e)}))})),{orderedTrees:n,extraTrees:i}}(r,e);t.orderedTrees.forEach((function(e){var r=e.getEditCommands();null!=r&&i.applyCommands(e,r,t.extraTrees,n._plugSvcs,!0)})),function(e){var t={};e.forEach((function(e){e.visit_riTreeAndFN((function(e){var n=e.getAttr("REF.ds6w:type"),i=e.getAttr("INST.ds6w:type");return t[n]=!0,null!=i&&(t[i]=!0),!0}))}));var n=Object.keys(t);return s.loadUp(n)}(t.orderedTrees).then((function(e){n.reportOK(t.orderedTrees)}),(function(e){n._plugSvcs.warnout("failed to load type hierarchies:: "+e),n._plugSvcs.warnout("continuing..."),n.reportOK(t.orderedTrees)}))}),(function(e){n._plugSvcs.confirmDialog(c.FETCH_FAIL_DEFAULT,{label:l.Close,callback:function(){n._plugSvcs.postEvent("Event_CW2_RESET_TO_INPUT")}},null),n.reportKO(e)}))}})})),define("DS/CATCivilCompareRulesIntegration/viewdef/APIRequestServices",["UWA/Core","UWA/Controls/Abstract","DS/WAFData/WAFData","DS/CATCivilCompareRulesIntegration/viewdef/Utilities"],(function(e,t,n,i){"use strict";var r=t.singleton({init:function(){},POST:function(e,t){return new Promise((async function(r,a){var s={timeout:6e4,cache:-1,method:"POST",type:"json",data:t,headers:{"content-type":"application/json",SecurityContext:i.getSecurityContext()},onComplete:function(e){r(e)},onFailure:function(){a(new Error("post failed"))}};let o=await i.getTenantId();var l=await i.get3DSpace(o.toLowerCase())+e;n.authenticatedRequest(l,s)}))}});return e.namespace("DS/CATCivilCompareRulesIntegration/viewdef/APIRequestServices",r)})),define("DS/CATCivilCompareRulesIntegration/plugins/DATA/aec_attrCache",["DS/CompareWidget2/plugins/DATA/attrValObjSet","DS/CompareWidget2/support/tenantServiceContext_IDList","DS/CompareCommon/Utils","DS/CATCivilCompareRulesIntegration/utils/aec_attrFetchUtils","text!DS/CATCivilCompareRulesIntegration/assets/masks/aec_coreInfoMask.json","i18n!DS/CompareWidget/assets/nls/CompareWidget"],(function(e,t,n,i,r,a){const s=JSON.parse(r);function o(e){for(var t={data:[],tn:e.dbContext.tenant,sc:e.dbContext.securityContext,sn:e.dbContext.serviceName,i1:e.iconURL,i2:e.iconURLLarge,id:e.physicalID,ty:e.objType},n=e.attrVals.length,i=0;i<n;i++){var r=e.attrVals[i],a=[r.name,r.nls,JSON.stringify(r.value),r.type,r.UIPosition];t.data.push(a)}return t}function l(e,t){function n(e,n){let i=t._attributes[e.name];if(void 0===i)return;var r=e.value;if(void 0!==r){let n=function(e,t){for(const[i,r]of Object.entries(t))if(i===e.name&&void 0!==r.rangeValues&&r.rangeValues.length>0){var n=r.rangeValues.find((t=>t.value===e.value));if(void 0!==n&&void 0!==n.nlsValue)return n.nlsValue}}(e,t._attributes);void 0!==n&&(r=n)}else r="";var a=function(e,t){for(const[n,i]of Object.entries(t))if(-1!==i.attributes.indexOf(e.name))return""!==i.NLS?i.NLS:n;return"ds6wg:Base"}(e,t._dictionary);return{dimensionType:void 0!==i?i.dimension:"",extension:a,visible:!0,readOnly:!1,type:e.type,UIPosition:n,path:i.selectable,nls:i.labelNLS+" ("+a+")",name:e.name,value:[String(r)],dimension:[],keepformat:!1}}t._attributes=i._attrDictionary,t._dictionary=i._extDictionary;let r={type_icon_url:"",data:[],physicalID:"",basicData:[],type:"",type_icon_large_url:"",extensions:{},preview_url:"",success:!0,thumbnail:""},a=e.attributes.find((e=>"type_icon_url"===e.name)),o=e.attributes.find((e=>"resourceid"===e.name)),l=e.attributes.find((e=>"ds6w:type"===e.name)),c=e.attributes.filter((e=>"ds6w:kind"!==e.name)),u=e.attributes.filter((e=>"ds6w:kind"===e.name));for(let e of u)if(void 0!==e.value&&void 0===r.extensions[e.value]){const n=t._dictionary["ds6wg:"+e.value];void 0!==n&&(r.extensions[e.value]={name:e.value,nameNLS:""!==n.NLS?n.NLS:e.value})}let _=[],p=[];var d=[],h={"ds6wg:Ifc":[],"ds6wg:IfcPset":[],"ds6wg:IfcQto":[]},f=[];c.forEach((e=>{if(-1!==s.mask.default.indexOf(e.name))d.push(e.name);else{let t=!1;for(let n of s.mask.ifc)if(e.name.includes(n)){h[n].push(e.name),t=!0;break}t||f.push(e.name)}})),d.sort(((e,t)=>s.mask.default.indexOf(e)-s.mask.default.indexOf(t)));for(const[e,t]of Object.entries(h))t.sort();return f.sort(),c.forEach((e=>{let t;e.UIPosition=void 0,-1===s.basicDataAttributes.indexOf(e.name)?(t=n(e,e.UIPosition),void 0!==t&&_.push(t)):(t=n(e,e.UIPosition),void 0!==t&&p.push(t))})),r.physicalID=void 0!==o?o.value:"",r.type_icon_url=void 0!==a?a.value:"",r.type=void 0!==l?l.value:"",r.data=_,r.basicData=p,r.thumbnail=e.attributes.thumbnail,r}return class{constructor(){2==arguments.length?(this._cacheID=arguments[0],this._isInstance="INSTANCE"==this._cacheID,this._isEffectivity="EFFECTIVITY"==this._cacheID,this._plugSvcs=arguments[1]._plugSvcs,this._plugOptions=arguments[1]._plugOptions):(this._isInstance=arguments[0],this._isEffectivity=arguments[1],this._plugSvcs=arguments[2],this._cacheID=this._isInstance?"(INST)":this._isEffectivity?"(EFFECTIVITY)":"(REF)"),this._dbgout=this._plugSvcs.dbgout,this._theCache={},this._preloadInProgress=!1,this._cacheIsLoaded=!1,this._dictionary={},this._attributes={}}flushCache(){var e=JSON.stringify(this._theCache).length;e>2&&(this._plugSvcs.dbgout("ATTR_CACHE",this._cacheID+" Property value cache (current size: "+e+" characters) is being flushed ..."),this._theCache={},this._preloadInProgress=!1,this._cacheIsLoaded=!1)}getAttrData(e){var n=this,i=[];return new Promise((function(r,a){var s=new t;e.forEach((function(e){s.addObjIDSpec(e)})),n._updateCache(s,!0).then((function(t){0==t?r(null):(e.forEach((function(e){var t=e.getTenant(),r=e.getServiceName(),a=e.getSecurityContext(),s=e.getPhysID(),o=n._getFromCache(t,r,a,s);o&&(void 0===o.objType||null===o.objType&&""===o.objType)&&(o.objType=e.getObjType()),i.push(o)})),r(i))}),(function(e){var t=n._cacheID+" fetch data failed:: "+e;a(t)}))}))}_getFromCache(t,n,i,r){var a=null;try{if(null!=t&&null!=n&&null!=i&&null!=r&&""!==r){var s=this._theCache[t][n][i][r];null!=s?a=function(t){var n=t.tn,i=t.sc,r=t.sn,a=t.i1,s=t.i2,o=t.id,l=t.ty,c=new e(o,l,s,a);return c.setDBContext(i,r,n),t.data.forEach((function(e){var t=e[0],n=e[1],i=null==e[2]?null:JSON.parse(e[2]),r=e[3],a=e[4];c.add(t,n,i,r,a)})),c}(s):this._dbgout("ATTR_CACHE","_getFromCache() "+r+" not in cache!")}}catch(e){}return a}doPreload(e){var t=this;return new Promise((function(n,i){try{t._cacheIsLoaded?n(t):t._preloadInProgress?i(t._cacheID+" doPreload() is already in progress... ignoring request"):(t._preloadInProgress=!0,t._dbgout("ATTR_CACHE",t._cacheID+" PRELOADING 'diff'"),t._updateCache(e.diff,!1).then((function(r){0==r||0==t._preloadInProgress?(t._dbgout("ATTR_CACHE",t._cacheID+" load aborted / data is no longer relevant."),t._preloadInProgress=!1,i("Preload() aborted")):(t._dbgout("ATTR_CACHE",t._cacheID+" PRELOADING 'nodiff'"),t._updateCache(e.nodiff,!1).then((function(e){0==e||0==t._preloadInProgress?(t._dbgout("ATTR_CACHE",t._cacheID+" load aborted / data is no longer relevant."),i("Preload() aborted")):(t._dbgout("ATTR_CACHE",t._cacheID+" *CACHE FULLY LOADED* for current model"),t._cacheIsLoaded=!0,t._preloadInProgress=!1,n(t))}),(function(e){t._preloadInProgress=!1,t._dbgout("ATTR_CACHE",t._cacheID+" LOAD 'nodiffs' FAILED: "+e),i(e)})))}),(function(e){t._preloadInProgress=!1,t._dbgout("ATTR_CACHE",t._cacheID+" LOAD 'diffs' FAILED: "+e),i(e)})))}catch(e){t._preloadInProgress=!1,t.me._plugSvcs.errout("EXCEPTION while loading cache... aborted:: "+e),i(e)}}))}_updateCache(e,t){var n=this,i=0,r=0,a=0;return new Promise((function(s,o){n._dbgout("ATTR_CACHE",n._cacheID+" Looking for objects in ATTR_FETCH cache...");var l=[];Object.keys(e._data).forEach((function(s){null==n._theCache[s]&&(n._theCache[s]={}),Object.keys(e._data[s]).forEach((function(o){null==n._theCache[s][o]&&(n._theCache[s][o]={}),Object.keys(e._data[s][o]).forEach((function(c){null==n._theCache[s][o][c]&&(n._theCache[s][o][c]={});var u=Object.keys(e._data[s][o][c]),_=[];if(u.forEach((function(e){if(void 0===n._theCache[s][o][c][e]||null===n._theCache[s][o][c][e]&&1==t){if(r++,_.push(e),n._theCache[s][o][c][e]=null,_.length>=10){var u={reqTenant:s,reqServiceName:o,reqSecurityContext:c,reqIDArray:_};l.push(u),_=[]}}else 0==t&&null==n._theCache[s][o][c][e]?a++:i++})),_.length>0){var p={reqTenant:s,reqServiceName:o,reqSecurityContext:c,reqIDArray:_};l.push(p)}}))}))}));var c=r>0?", must fetch...":"";n._dbgout("ATTR_CACHE",n._cacheID+" HIT: "+i+", MISS: "+r+c),0==l.length?s(0==a):(n._dbgout("ATTR_CACHE",n._cacheID+" *FETCHING PROPS* for "+r+" objects using "+l.length+" request set(s)"),n._doBigFetch(l).then((function(e){s(e)}),(function(e){o(e)})))}))}_doBigFetch(t){var n=this;return new Promise((function(i,r){var s=0,c=t.length,u=c;function _(p){var d=p;if(--u>0){var h=d.result.results.length;n._dbgout("ATTR_CACHE",n._cacheID+" ...processing returned data set ("+h+" items in set); still have "+u+" requests to go...")}else n._dbgout("ATTR_CACHE",n._cacheID+" processing returned data...");for(var f=function(t,n){const i=n._isEffectivity;for(var r=[],s=t.length,o=0;o<s;o++)for(var c=t[o],u=null==c?0:c.result.results.length,_=0;_<u;_++){var p=c.result.results[_],d=void 0!==p.attributes?l(p,n):p,h=new e(d.physicalID,d.type,d.type_icon_large_url,d.type_icon_url);if(h.setDBContext(c.securityContext,c.serviceName,c.tenant),i||h.add("thumbnailimage",a.thumbnailimage,d.thumbnail,"thumbnail",0),void 0!==d.basicData&&null!==d.basicData&&d.basicData.length>0)for(let e of d.basicData){const t=null!==e.nls&&void 0!==e.nls&&""!==e.nls?e.nls:e.displayName;h.add(e.name,t,e.value,e.type,e.UIPosition)}if(void 0!==d.data&&null!==d.data&&d.data.length>0)for(let e of d.data){const t=null!==e.nls&&void 0!==e.nls&&""!==e.nls?e.nls:e.displayName;h.add(e.name,t,e.value,e.type,e.UIPosition)}r.push(h)}return r}([d],n),g=f.length,T=0;T<g;T++){var S=f[T],C=S.getPhysicalID(),E=S.dbContext.tenant,I=S.dbContext.serviceName,v=S.dbContext.securityContext,D=o(S);n._theCache[E][I][v][C]=D}if(s<c){var A=t[s++];n._dbgout("ATTR_CACHE",n._cacheID+" sending request #"+s+" of "+c+"("+A.reqIDArray.length+" objects)"),n._fetchReqSet(A).then((function(e){null==e?n._dbgout("ATTR_CACHE","Data discarded"):_(e)}),(function(e){r(e)}))}else u<=0&&i(!0)}for(s=0;s<2&&s<c;s++){var p=t[s];n._dbgout("ATTR_CACHE",n._cacheID+" sending request #"+(s+1)+" of "+c+" ("+p.reqIDArray.length+" objects)"),n._fetchReqSet(p).then((function(e){_(e)}),(function(e){r(e)}))}}))}_fetchReqSet(e){var t=this;return new Promise((function(n,i){setTimeout((()=>{var r=t._plugSvcs.nowMS(),a=t._theCache;t._getAttrs(e.reqIDArray,e.reqServiceName,e.reqTenant,e.reqSecurityContext).then((function(s){if(a!==t._theCache)t._dbgout("ATTR_CACHE",t._cacheID+" Cache was flushed; incoming data ignored"),n(null);else{var o=s;if(Array.isArray(o.result.results)){var l=e.reqIDArray.length,c="[ATTR_CACHE]"+t._cacheID+" FETCHED PROPS for "+l+" OBJECTS";if(t._plugSvcs.reportTime(r,c),"3dspace"===o.serviceName.toLowerCase())if(t._isInstance)void 0!==t._useSGI&&t._useSGI?o.result.results.forEach((e=>{let t=e.attributes.find((e=>"preview_url"===e.name)),n=e.attributes.find((e=>"type_icon_url"===e.name));e.attributes.thumbnail=void 0!==t&&t.value.length?t.value:n.value})):o.result.results.forEach((e=>e.thumbnail=e.preview_url.length?e.preview_url:e.type_icon_large_url)),n(o);else if(t._isEffectivity)n(o);else{var u=t._plugSvcs.nowMS();t._getThumbnails(e.reqIDArray,e.reqServiceName,e.reqTenant,e.reqSecurityContext,o.result.results).then((function(i){t._plugSvcs.reportTime(u,"[CACHE]"+t._cacheID+" "+e.reqIDArray.length+" thumbnails loaded");var r=i;t._mergeInThumbInfo(o,r),n(o)}),(function(e){var i="attr fetch was OK (but missing thumbnails) :: "+e;t._plugSvcs.errout(i),n(o)}))}else{for(let e of o.result.results)if(e.hasOwnProperty("preview_url")&&""!==e.preview_url)e.thumbnail=e.preview_url;else{var _=e.data.findIndex((function(e){return"preview_url"===e.name}));if(_>=0){let t=e.data.splice(_,1);e.thumbnail=t[0].value}}n(o)}}else i("Failure getting Attributes: ")}}),(function(e){var n="Failure getting Attributes: "+e;t._plugSvcs.errout(n),i(n)}))}),1)}))}_getAttrs(e,t,r,a){var s=this;if(s._isEffectivity)return new Promise((function(i,s){n.getEffectivityPromise2({objectIds:e,serviceIds:[t],tenant:r,securityContext:a}).then((function(e){i({serviceName:t,tenant:r,securityContext:a,result:e})}))}));if("3dportfolio"===t.toLowerCase()||"3dspace"===t.toLowerCase()){let n="",o="",l="";return void 0===s._plugOptions||void 0===s._plugOptions||void 0===s._plugOptions.useSGIfetch?s._useSGI=!1:s._useSGI=s._plugOptions.useSGIfetch,"3dportfolio"===t.toLowerCase()?(n="/"+t+"/getAttrs",o="GET",l="objectIds="+e.join(",")):"3dspace"===t.toLowerCase()&&(n="/resources/v1/collabServices/attributes/op/read/",o="POST",l=!0===s._isInstance?{debug_properties:"",plmparameters:"true",relIDs:e,lIds:[]}:{debug_properties:"",readonly:"false",navigateToMain:"true",attributes:"true",plmparameters:"true",busIDs:e,relIDs:[],lIds:[]}),!0===s._useSGI?(i.initializeUtils(s._plugSvcs,s._plugOptions,t,r,a),i._fetchAttributeValues(e)):new Promise((function(e,i){s._plugSvcs.makeAuthHttpsCall(n,o,l,"json",r,t,a).then((function(n){e({serviceName:t,tenant:r,securityContext:a,result:n})}),(function(e){s._plugSvcs.errout("Failure retrieving attributes for object"),i(null)}))}))}return new Promise((function(i,s){n.getFederatedAttributesPromise({objectIds:e,serviceIds:[t],tenant:r,securityContext:a}).then((function(e){i({serviceName:t,tenant:r,securityContext:a,result:e})}))}))}_getThumbnails(e,t,n,i,r){var a=this,s=[],o=e.length,l=0;return new Promise((function(c,u){e.forEach((function(e){let _,p;if(void 0!==a._useSGI&&a._useSGI?(_=r.find((t=>void 0!==t.attributes.find((t=>"resourceid"===t.name&&t.value===e)))),p=void 0!==_?_.attributes.find((e=>"preview_url"===e.name)).value:""):(_=r.find((t=>t.physicalID===e)),p=void 0!==_?_.preview_url:""),null!=p&&""!==p)s[e]=p,++l>=o&&c(s);else{var d="/resources/compare/thumbnailUrl/"+e;a._plugSvcs.makeAuthHttpsCall(d,"GET",null,"text",n,t,i).then((function(i){var r=i;0==r.startsWith("http")&&(r=a._plugSvcs.makeServiceURL(t,n,r,null)),s[e]=r,++l>=o&&c(s)}),(function(e){u(e)}))}}))}))}_mergeInThumbInfo(e,t){e.result.results.forEach((function(e){if(void 0!==e.attributes){var n=e.attributes.find((e=>"resourceid"===e.name)).value,i=t[n];e.attributes.thumbnail=i}else{n=e.physicalID,i=t[n];e.thumbnail=i}}))}}})),define("DS/CATCivilCompareRulesIntegration/plugins/DATA/aec_attrCacheMgr",["UWA/Class","DS/CompareWidget2/support/cw2Utils","DS/CATCivilCompareRulesIntegration/plugins/DATA/aec_attrCache"],(function(e,t,n){function i(e){this._doFlush()}function r(e){this._doFlush(),this._zeroOutAllCaches()}return e.singleton({init:function(){return this._theCaches={},this._flushEventToken=null,this._zeroEventToken=null,this._plugSvcs=null,this._plugOptions=null,this._parent()},declareAttrCache:function(e,t,a){null==this._plugSvcs&&(this._plugSvcs=t),null==this._plugOptions&&(this._plugOptions=a),null==this._flushEventToken&&(this._flushEventToken=t.subscribe("EVENT_FLUSH_DATA_CACHES",i.bind(this))),null==this._zeroEventToken&&(this._zeroEventToken=t.subscribe("EVENT_ZERO_ALL_CACHES",r.bind(this))),null==this._theCaches[e]&&(this._theCaches[e]=new n(e,{_plugSvcs:t,_plugOptions:a}))},undeclareAttrCache:function(e){},getCache:function(e){let n=this._theCaches[e];return null==n&&t.errout("BAD CACHE ID: "+e),n},getAllCaches:function(){return this._theCaches},_doFlush:function(){let e=this;if(null!=e._theCaches){Object.keys(e._theCaches).forEach((function(t){null!=e._theCaches[t]&&e._theCaches[t].flushCache()}))}t.dbgout("All attr value caches have been flushed")},_zeroOutAllCaches:function(){this._theCaches={}},loadAll:function(e){let t=this;var n=t._plugSvcs.nowMS();let i=Object.keys(t._theCaches),r=i.length,a=0;return new Promise((function(s,o){i.forEach((function(i){if(null!=t._theCaches[i]){let o="REFERENCE"==i?e.loadAttrIDS_REF:e.loadAttrIDS_INST;try{t._theCaches[i].doPreload(o).then((function(e){a++,a>=r&&(t._plugSvcs.reportTime(n,"[CACHE] All caches fully loaded"),s())}),(function(e){t._plugSvcs.errout("FAILED to load attrs '"+i+"' ::"+e),a++,a>=r&&s()}))}catch(e){t._plugSvcs.errout("FAILED to load attrs '"+i+"' ::"+KOarg),a++,a>=r&&s()}}}))}))}})})),define("DS/CATCivilCompareRulesIntegration/plugins/EXPORT/AEC_EXPORT_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/EXPORT/exManager","DS/CompareWidget2/support/tenantServiceContext_IDList","DS/CATCivilCompareRulesIntegration/plugins/DATA/aec_attrCacheMgr"],(function(e,t,n,i){return e.extend({init:function(e,n,i,r){this._parent(e,n,i,r),this._crTreeArray_multiview=null,this._displayMode="unknown",this._useOldExportFormat=!1,this._statusesHidden=!1,this._exManager=new t(r)},onEnabled:function(){var e=this;return e.enableDebugLabel("EXPORT"),e.subscribeEvent("EXECUTE_EXPORT_EVENT",e.handle_EXECUTE_EXPORT_EVENT.bind(e)),e.syncSetting("viewSettings.STRUCT_VIEW.display_mode","_displayMode",null),e.syncSetting("exportSettings.exportOldFormat","_useOldExportFormat",null),e.syncSetting("viewSettings.STRUCT_VIEW.statuses_to_hide","_statusesHidden",null),e.syncSetting("viewSettings.STRUCT_VIEW.currentViewID_MULTI","_currentViewID_MULTI",null),e.postEvent("EXPORT_IS_ENABLED"),e._plugSvcs.dbgout("EXPORT","EXPORT_IS_ENABLED event... "),e._parent()},onDisabled:function(){this.postEvent("EXPORT_IS_DISABLED"),this._plugSvcs.dbgout("EXPORT","EXPORT_IS_DISABLED event... ")},handle_EXECUTE_EXPORT_EVENT:function(e){let t=this;t._plugSvcs.dbgout("EXPORT","exporting... "+this._displayMode),t._exManager.displayExportInProgress();let n=this._crTreeArray;null!=this._crTreeArray_multiview&&(n=this._crTreeArray_multiview[this._currentViewID_MULTI]);let r=this._prepareLoadRequest(n);i.loadAll(r).then((function(e){let n=t._crTreeArray,r=t._displayMode,a=i.getAllCaches();if(null!=t._crTreeArray_multiview){let e=t._currentViewID_MULTI;n=t._crTreeArray_multiview[e],r="MULTI"}t._exManager.doExport(a,n,r,t._useOldExportFormat,t._statusesHidden,"csv",t._pluginOptions)}),(function(e){t._plugSvcs.errout("Failure loading properties; cannot export: "+eventData.data.type)}))},_prepareLoadRequest:function(e){var t=new n,i=new n,r=new n,a=new n;return e[0].visitAll_treeAndFN(0,(function(e){var n=e.getMatchInfo(),s=null==n||"IDENTICAL"!=n.getRelName(),o=s?t:i,l=s?r:a;if(0==e.isDummy()&&!e.isHeaderRow()){var c=e.getObjIDSpec_REF(),u=e.getObjIDSpec_INST();null!=c&&null!=c.getPhysID()&&o.addObjIDSpec(c),null!=u&&null!=u.getPhysID()&&l.addObjIDSpec(u)}if(null!=n){var _=n.getCompNode();if(null!=_&&0==_.isDummy()&&!_.isHeaderRow()){var p=_.getObjIDSpec_REF(),d=_.getObjIDSpec_INST();null!=p&&null!=p.getPhysID()&&o.addObjIDSpec(p),null!=d&&null!=d.getPhysID()&&l.addObjIDSpec(d)}}return!0})),e[0].visitAll_treeAndFN(1,(function(e){if(null==e.getMatchInfo()){var n=e.getObjIDSpec_REF(),i=e.getObjIDSpec_INST();null!=n&&t.addObjIDSpec(n),null!=i&&r.addObjIDSpec(i)}return!0})),{loadAttrIDS_REF:{diff:t,nodiff:i},loadAttrIDS_INST:{diff:r,nodiff:a}}},onDestroy:function(){return this._parent()},execute:function(e,t){try{var n=this;n._parent(e,t),null!=e.viewID?(null==this._crTreeArray_multiview&&(this._crTreeArray_multiview={}),this._crTreeArray_multiview[e.viewID]=e.crTreeArray):this._crTreeArray=e,n.reportOK(null)}catch(t){n._plugSvcs.dbgout("EXPORT","reports exception:: "+t),n.reportKO(e)}}})})),define("DS/CATCivilCompareRulesIntegration/plugins/ATTRIBUTE/AEC_ATTR_FETCH_plugin",["DS/CompareWidget2/plugins/plugin","DS/CATCivilCompareRulesIntegration/plugins/DATA/aec_attrCacheMgr"],(function(e,t){function n(e){var n=this,i=e.data.selectedData;n._plugSvcs.dbgout("A new row has been selected..."),n._attrUpdateStartMS=n._plugSvcs.nowMS();var r=[];if(e.data.selectedData){var a=i[0].length>i[1].length?i[0]:i[1];if(0===a.length)return;if(n._isInstance){if("LIST"==e.data.structDisplayMode)return void n.postEvent("INST_PROPS_OFF_DURING_LIST_COMPARE",{id:"attrFetch"});if(1!=a.length)return void n.postEvent("INST_PROPS_OFF_TOO_MANY_SELECTED",{id:"attrFetch"})}else if(n._isEffectivity){if("LIST"==e.data.structDisplayMode)return void n.postEvent("EFFECTIVITY_OFF_DURING_LIST_COMPARE",{id:"attrFetch"});if(1!=a.length)return void n.postEvent("EFFECTIVITY_OFF_TOO_MANY_SELECTED",{id:"attrFetch"})}else{var s=!0;if("LIST"!=e.data.structDisplayMode)1!=a.length&&(s=!1);else{var o=a[0].ObjIDSpec.getPhysID();a.forEach((function(e){e.ObjIDSpec.getPhysID()!=o&&(s=!1)}))}if(!s)return void n.postEvent("REF_PROPS_OFF_TOO_MANY_SELECTED",{id:"attrFetch"})}i.forEach((function(e){if(null!=e&&e.length>0){var t=e[0],i=n._isInstance||n._isEffectivity?t.instObjIDSpec:t.ObjIDSpec;null!=i&&r.push(i)}}));let l=0;for(let e of r){let t=e.getPhysID();null!=t&&""!==t&&++l}if(0==l)n._plugSvcs.postEvent(n._isInstance?"INST_PROPS_OFF_NONE_AVAILABLE":n._isEffectivity?"EFFECTIVITY_OFF_NONE_AVAILABLE":"REF_PROPS_OFF_NONE_AVAILABLE",{id:"attrFetch"});else{if("relations"===r[0].getObjType())return void n.postEvent("GROUP_PLACEHOLDER_SELECTED",{id:"attrFetch"});n._plugSvcs.postEvent(n._isInstance?"INST_PROPS_UPDATE_IN_PROGRESS_EVENT":n._isEffectivity?"EFFECTIVITY_UPDATE_IN_PROGRESS_EVENT":"REF_PROPS_UPDATE_IN_PROGRESS_EVENT",null),t.getCache(n._attrDataType).getAttrData(r).then((function(e){if(null!=e){for(var t=!0,i=0;i<e.length;i++)if(null!=e[i]){t=!1;break}t?n._plugSvcs.postEvent(n._isInstance?"INST_PROPS_OFF_NONE_AVAILABLE":n._isEffectivity?"EFFECTIVITY_OFF_NONE_AVAILABLE":"REF_PROPS_OFF_NONE_AVAILABLE",{id:"attrFetch"}):n.updateOutput(e)}}),(function(e){var t="getAttrData() failed:: "+e;n._plugSvcs.dbgout("ATTR_CACHE",n._DEBUG_isInstTxt+t)}))}}}return e.extend({init:function(e,n,i,r){this._parent(e,n,i,r),this.enableDebugLabel("ATTR_CACHE"),this._isInstance=this._pluginOptions.isInstance,this._isEffectivity=this._pluginOptions.isEffectivity,this._DEBUG_isInstTxt=this._isInstance?"(INST)":this._isEffectivity?"(EFFECTIVITY)":"REF)",this._attrDataType=this._isInstance?"INSTANCE":this._isEffectivity?"EFFECTIVITY":"REFERENCE",t.declareAttrCache(this._attrDataType,r,i),this._comparisonInProgress=!1},onEnabled:function(){return this.subscribeEvent("NEW_CURRENT_SELECTION_EVENT",n.bind(this)),this._parent()},onDestroy:function(){return t.undeclareAttrCache(this._attrDataType),this._parent()},execute:function(e,n){var i=this;i._parent(e,n),this._comparisonInProgress=!0;let r=e;if(i._isInstance)i.postEvent("INST_PROPS_OFF_NONE_AVAILABLE",{id:"attrFetch"});else if(i._isEffectivity)i.postEvent("EFFECTIVITY_OFF_NONE_AVAILABLE",{id:"attrFetch"});else{i._plugSvcs.postEvent("REF_PROPS_UPDATE_IN_PROGRESS_EVENT",null),i._plugSvcs.dbgout("Performing initial ATTR_FETCH"),t.getCache(i._attrDataType).getAttrData(r).then((function(e){null!=e&&i.reportOK(e)}),(function(e){i._plugSvcs.showAlertBox("Failed to retrieve properties",null,"error"),i._plugSvcs.postEvent(i._isInstance?"INST_PROPS_FETCH_FAILED":i._isEffectivity?"EFFECTIVITY_FETCH_FAILED":"REF_PROPS_FETCH_FAILED"),i.reportKO(e)}))}}})})),define("DS/CATCivilCompareRulesIntegration/viewdef/APIServices",["UWA/Core","UWA/Controls/Abstract","DS/CATCivilCompareRulesIntegration/viewdef/APIRequestServices"],(function(e,t,n){"use strict";var i=t.singleton({init:function(){},getCompareConfiguration:function(){return n.POST("/resources/v1/modeler/dscstr/invoke/dscstr:getSupportedFeatures",'{"features":["Bcd_CompAECFeat"]}')}});return e.namespace("DS/CATCivilCompareRulesIntegration/viewdef/APIServices",i)})),define("DS/CATCivilCompareRulesIntegration/viewdef/CivilViewDefinition",["UWA/Core","DS/CATCivilCompareRulesIntegration/viewdef/CivilObjectOptions","DS/CompareWidget2/ViewDefModules/ViewDefOptions","DS/CATCivilCompareRulesIntegration/viewdef/Utilities","DS/CATCivilCompareRulesIntegration/viewdef/APIServices"],(function(e,t,n,i,r){"use strict";let a={AttrFetch:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin"},AttrCompare:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin"},AttrDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin"},InstAttrFetch:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin",Options:n.INST_ATTR_FETCH_OPTIONS},InstAttrCompare:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin"},InstAttrDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",Options:n.INST_ATTR_DISPLAY_OPTIONS},View3DDisplay:{Path:"DS/CompareWidget2/plugins/VIEW3D/VIEW3D_DISPLAY_plugin",Options:n.STRUCT_DISPLAY_OPTIONS},View3DPrep:{Path:"DS/CompareWidget2/plugins/VIEW3D/VIEW3D_PREP_plugin"},StructFetch:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_FETCH_plugin",Options:n.STRUCT_FETCH_OPTIONS},StructCompare:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_COMPARE_plugin",Options:n.STRUCT_COMPARE_OPTIONS},GetRelations:{Path:"DS/CompareWidget2/plugins/STRUCTURE/GET_RELATIONS_plugin",Options:n.GET_RELATIONS_OPTIONS},CompareRels:{Path:"DS/CompareWidget2/plugins/STRUCTURE/REL_COMPARE_plugin",Options:n.COMPARE_REL_OPTIONS},StructDisplay:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_DISPLAY_plugin",Options:n.STRUCT_DISPLAY_OPTIONS},StructListViewPrep:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_LIST_VIEW_PREP_PLUGIN"},StructCustAttrsPrep:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_CUST_ATTRS_PREP_plugin"},EffectivityFetch:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin",Options:n.EFFECTIVITY_FETCH_OPTIONS},EffectivityCompare:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin"},EffectivityDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",Options:n.EFFECTIVITY_DISPLAY_OPTIONS},Exporter:{Path:"DS/CompareWidget2/plugins/EXPORT/EXPORT_plugin",Options:n.STRUCT_DISPLAY_OPTIONS}};function s(i){var r={PROP_VIEW:["AttrFetch","AttrCompare","AttrDisplay"],INSTANCE_VIEW:["InstAttrFetch","InstAttrCompare","InstAttrDisplay"],STRUCT_VIEW:["StructFetch","StructCompare","GetRelations","CompareRels","StructListViewPrep","StructDisplay","Exporter"],PAD3D_VIEW:["StructFetch","View3DPrep","View3DDisplay"],STRUCT_VIEW_WITH_CUSTOM_ATTRS:["StructFetch","StructCompare","GetRelations","CompareRels","StructCustAttrsPrep","StructListViewPrep","StructDisplay","Exporter"]},s={STANDARD:{ROW:["STRUCT_VIEW",{COL:[["PROP_VIEW","INSTANCE_VIEW"],"PAD3D_VIEW"]}]},PROPS_ONLY:{ROW:"PROP_VIEW"},STRUCT_ONLY:{ROW:"STRUCT_VIEW"},IFC_STANDARD_VIEW:{ROW:["STRUCT_VIEW_WITH_CUSTOM_ATTRS",{COL:[["PROP_VIEW","INSTANCE_VIEW"],"PAD3D_VIEW"]}]}};let o=null;return i?(a.AttrFetch={Path:"DS/CATCivilCompareRulesIntegration/plugins/ATTRIBUTE/AEC_ATTR_FETCH_plugin",Options:t.AEC_ATTR_FETCH_OPTIONS},a.InstAttrFetch={Path:"DS/CATCivilCompareRulesIntegration/plugins/ATTRIBUTE/AEC_ATTR_FETCH_plugin",Options:t.INST_ATTR_FETCH_OPTIONS},a.StructFetch={Path:"DS/CATCivilCompareRulesIntegration/plugins/STRUCTURE/AEC_STRUCT_FETCH_plugin",Options:t.STRUCT_FETCH_OPTIONS},a.EffectivityFetch={Path:"DS/CATCivilCompareRulesIntegration/plugins/ATTRIBUTE/AEC_ATTR_FETCH_plugin",Options:t.EFFECTIVITY_FETCH_OPTIONS},a.Exporter={Path:"DS/CATCivilCompareRulesIntegration/plugins/EXPORT/AEC_EXPORT_plugin",Options:t.STRUCT_DISPLAY_OPTIONS},o=e.merge({VIEWSETS:s,VIEWDEFS:r,PLUGDEFS:a},t)):o=e.merge({VIEWSETS:s,VIEWDEFS:r,PLUGDEFS:a},n),o}return new Promise(((e,t)=>{i.refreshSecurityContext(),i.initServiceManager().then((t=>{r.getCompareConfiguration().then((t=>{let n=t.features.Bcd_CompAECFeat;void 0!==n&&e(s(n))})).catch((t=>{console.warn("Failed to load specialized compare profile for AEC, switching to default comparison profile"),e(s(!1))}))})).catch((t=>{console.warn("Failed to load specialized compare profile for AEC, switching to default comparison profile"),e(s(!1))}))}))}));