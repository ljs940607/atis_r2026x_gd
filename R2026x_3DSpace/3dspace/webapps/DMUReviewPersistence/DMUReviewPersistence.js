define("DS/DMUReviewPersistence/DMUReviewMaturityChangeCmd",["DS/CATWebUXComponents/DMUCommand","DS/DMUBaseExperience/DMUContextManager","DS/DMUValidationPersistence/DMUValidationPersistenceServices","DS/DMUReadPersistence/DMUReviewPersistenceServicesSetting"],(function(e,t,n,i){"use strict";return e.extend({init:function(e){e.mode="shared",e.repeatMode=!1,e.isAsynchronous=!0,this._parent(e);var a,o=this,s=e.frameWindow||this.getFrameWindow();this.beginExecute=function(){var e=t.getReviewContext({viewer:s.getViewer()}).getValidation();if(e){var r=t.getEventsController({viewer:s.getViewer()});require(["DS/MaturityWidget/MaturityWidget"].concat([]),(function(t){a&&a.dialog&&a.dialog.destroy(),(a=new t({externalSettings:i.getOption("platform_services")})).addEvent("onMaturityCanceled",(function(){o.cancel()})),a.addEvent("onMaturityTransitionEnd",(function(t){if(t&&t.data&&t.data.length>0){for(var i=0;i<t.data.length;i++)if(t.data[i]&&t.data[i].physicalid===e.getPlmID()&&t.data[i].tostate){e.setCurrentState(t.data[i].tostate),r&&("PRIVATE"===t.data[i].fromstate&&"IN_WORK"===t.data[i].tostate?n.notify({validationId:e.getPlmID(),notifId:"review.members.new",allMembers:!0}):n.notify({validationId:e.getPlmID(),notifId:"review.maturity.change",allMembers:!0}),r.fireEvent("onReviewObjectAttributesModified",{object:e,attr:[{currentState:t.data[i].tostate}]}));break}o.cancel()}else o.cancel()})),i.getServerContext({onComplete:function(t){a.executeCmd([{physicalid:e.getPlmID(),tenant:i.getTenant()}],{context:{getSecurityContext:()=>({SecurityContext:t})}},(()=>{}))},onFailure:function(){}})}))}else o.cancel()},this.cancelExecute=function(){a=null}}})})),define("DS/DMUReviewPersistence/DMUReviewStatusChangeCmd",["DS/CATWebUXComponents/DMUCommand","DS/CATWebUXCVS/CATWebUXCVSComponent","DS/DMUBaseExperience/DMUContextManager","DS/DMUReadPersistence/DMUReviewPersistenceServicesSetting","DS/CATWebUXComponents/CATWebUXNotification","i18n!DS/DMUReviewPersistence/assets/nls/DMUReviewPersistence"],(function(e,t,n,i,a,o){"use strict";return e.extend({init:function(e){e.mode="shared",e.repeatMode=!1,e.isAsynchronous=!0,this._parent(e);var s,r=this,l=null,c=e.frameWindow||this.getFrameWindow();function d(){s&&s.destroy(),l&&l.clean(),r.cancel()}this.beginExecute=function(){var e=n.getReviewContext({viewer:c.getViewer()}).getValidation(),r=function(){(s=new a).build({type:"error",autoHide:!0,message:o.valStateChange.error,body:c.getUIFrame()}),d()};i.getServerContext({onComplete:function(a){l=new t({title:e.getName(),physicalId:e.getPlmID(),current:e.getStatus(),parent:c.getImmersiveFrame(),platformSettings:i.getOption("platform_services"),tenant:i.getTenant(),securityContext:{getSecurityContext:()=>({SecurityContext:a})},onChangeValidationStateCompleted:function(t){if(t){var i=[];e.setStatus(t.sValidationState),i.push({sValidationState:t.sValidationState});var a=n.getEventsController({viewer:c.getViewer()});a&&a.fireEvent("onReviewObjectAttributesModified",{object:e,attr:i}),d()}else r()},onChangeValidationStateClose:function(){d()},onChangeValidationStateFailure:function(){r()}})},onFailure:function(){r()}})},this.destroy=function(){d()}}})})),define("DS/DMUReviewPersistence/DMUAuthReviewPersistenceServices",["UWA/Utils","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseUIControllers/DMUReviewContextInitializer","DS/DMUPersistence/DMUDOSThumbnailServices","DS/DMUPlayMarkup/DMUMarkup","DS/DMUBaseWebValidation/EXPValMarkup","DS/DMUBaseWebValidation/EXPValValidation","DS/DMUBaseWebValidation/EXPValContext","DS/DMUBaseWebValidation/EXPValValidated","DS/DMUBaseWebValidation/EXPValCheck","DS/DMUBaseWebValidation/EXPValHighlight","DS/DMUBaseExperience/DMULinksManager","DS/DMUBaseUIServices/DMUSlidePreferences","DS/DMUBaseExperience/DMUModelServices","DS/DMUBaseExperience/EXPUtils","DS/DMUValidationPersistence/DMUValidationPersistenceServices","DS/DMUPlaySlide/DMUSlide","DS/DMUBaseUI/DMUToolsUsers","DS/DMUBaseUIControllers/DMUApplicativeContextManager","DS/DMUReadPersistence/DMULoadingContextController","DS/DMUPersistence/DMUAuthPersistenceUtils","DS/DMUBaseUIControllers/DMUSlidesController","DS/DMUBaseUIControllers/DMUReqCompareController","DS/DMUBaseUIControllers/DMUCommentsController","DS/DMUMeasurable/DMUToolsSceneGraph","DS/Visualization/Node3D","DS/DMUReadPersistence/DMUReviewPersistenceServicesSetting","i18n!DS/DMUReviewPersistence/assets/nls/DMUReviewPersistence"],(function(e,t,n,i,a,o,s,r,l,c,d,m,u,p,g,f,h,v,I,b,C,w,D,y,x,R,M,S){"use strict";var k=0,U=function(e){var n=e.validation,i=n.getMembers();let a=e.membersFromServer.result?e.membersFromServer.result:e.membersFromServer;if(i||(n.setMembers(),i=n.getMembers()),i){if(a.assignees){if(a.assignees.add){i.addAssignees(a.assignees.add);let e=a.assignees.add.find((e=>!e.contribution));if(a.assignees.add.length>0&&e){let t=a.assignees.add.findIndex((e=>!e.contribution)),n=i._sJsonMembers[e.user],o=n.contribution?n.contribution:"NotStarted";a.assignees.add[t].contribution=o}}a.assignees.remove&&i.removeAssignees(a.assignees.remove)}if(a.coordinators&&(a.coordinators.add&&i.addCoordinators(a.coordinators.add),a.coordinators.remove&&i.removeCoordinators(a.coordinators.remove)),a.contributors){if(a.contributors.add){i.addContributors(a.contributors.add);let e=a.contributors.add.find((e=>!e.contribution));if(a.contributors.add.length>0&&e){let t=a.contributors.add.findIndex((e=>!e.contribution)),n=i._sJsonMembers[e.user],o=n.contribution?n.contribution:"NotStarted";a.contributors.add[t].contribution=o}}a.contributors.remove&&i.removeContributors(a.contributors.remove)}a.informedusers&&(a.informedusers.add&&i.addInformedUsers(a.informedusers.add),a.informedusers.remove&&i.removeInformedUsers(a.informedusers.remove))}var o;e.context&&e.context.getViewer&&(o=t.getEventsController({viewer:e.context.getViewer()})),o&&o.fireEvent("onValidationMembersUpdated",{validationMembersDiff:a})},V=function(e){var n=e.iReviewContext?e.iReviewContext:t.getReviewContext({context:e.ctxViewer}),i=new c(e.ctxViewer.getViewer(),n.getValidation());i.setFromJson({type:e.type,name:e.name,id:e.id,state:e.state,description:e.description,owner:e.owner,children:""!==e.requirementDocId?[{id:e.requirementDocId,type:"Requirement",name:e.requirementName}]:[]}),n.getValidation().addCheck(i),n.getValidation().fireEvent("onDMUObjectInitialized",{dmuObject:i})},j=async function(n){if(!(n&&n.mkpData&&n.validation&&n.reviewCtx&&n.ctxViewer))return;var i=n.ctxViewer.getViewer(),s=n.ctxViewer.getFrameWindow(),r=new o(n.ctxViewer.getViewer(),n.validation);n.validation.addMarkup(r);var l={children:[],id:n.mkpData.pId,instanceId:n.mkpData.markupRefInst.pId,name:n.mkpData.name,type:"Markup",treeOrder:"4.3333",webMarkup:"true",owner:n.mkpData.owner};r.setFromJson(l);var c={children:[],id:n.mkpData.markupRepRef.pId,instanceId:n.mkpData.markupRepInst.pId,name:"Review "+n.mkpData.name,type:"ReviewMarkup",treeOrder:"4.3334",webMarkup:"true",owner:n.mkpData.markupRepRef.owner};r.addChild(c);var d=t.getReviewContext({context:n.ctxViewer}),p=d.getTransientReviewBag(),g=null,f={entities:null,occurrences:null};p&&(g=p.getAttribute("oLinksManager")),g&&g.exportLinksManagerData(f),p=new a(n.ctxViewer.getViewer(),n.reviewCtx);let b=r.getChildren();if(b&&b.length&&(b[0].setMarkupContent(p),p.setMarkupOwner(b[0]),g=new m(n.ctxViewer.getViewer(),p),n.validation.setCurrentMarkup(b[0]),n.validation.fireEvent("onDMUObjectInitialized",{dmuObject:b[0]})),(f.entities&&f.entities.length>0||f.occurrences&&f.occurrences.length>0)&&g.importLinksManagerData(f),p.setAttributes([{name:"oLinksManager",value:g},{name:"sName",value:n.mkpData.markupName}]),u.setSlidePreferences({context:s,preferences:{panelTitle:n.validation.getName()}}),n.createFirstSlide&&n.ctxViewer.getRootBagPath().getChildrenPathes().length){let a,o=1,r=D.giveReqCompareController({context:n.ctxViewer});r&&r.isRequirementCompareActive()&&(o=2);for(let s=0;s<o;s++){if(a=new h(n.ctxViewer.getViewer(),n.reviewCtx.getCurrentSessionMarkup()),t.getEventsController({viewer:n.ctxViewer.getViewer()}).fireEvent("onDMUObjectCreation",{dmuObject:a}),a.setAttributes([{name:"sID",value:p.computeNewID()},{name:"sUuid",value:e.getUUID()},{name:"sOwner",value:v.getUserLogin()},{name:"fCreationDate",value:Date.now()}]),a.updateEnvironmentOverload({target:n.reviewCtx.getEnvironment(),state:n.reviewCtx.getEnvironment().getEnvironmentInfo()}),p.addSlide(a),!d.getUIManager().isAPreviewRegistered()){let e=null,t=d.getValidation().getContext()?d.getValidation().getContext().getJsonContextTypes()[0]:null;t&&(e=t.parentType?t.parentType:t.type?t.type:t),["Document","Requirement","Requirement Specification"].includes(e)||d.getUIManager().registerElementIdAsPreview(a.getAttribute("sUuid"),p)}var y=null,x=I.giveDMUApplicativeContextManager({context:t.getContextViewer({viewer:i})});if(x)for(var R,M,k=x?x.getApplicativeControllers():[],U=0;U<k.length;U++){M=k[U].getApplicativeContainerID();var V=await x.getVerifiedApplicativeContainerState(M);V&&(a.setSlideApplicativeContext(M,V),null,(R=k[U].getCurrentAppContainerStateTitle())&&(y?y+=" - ":y="",y+=R),a.setSlideApplicativeContext(M,V))}y&&!y.length&&(y=null),a.setAttribute("sName",p.computeNewName({object:a,prefix:y||S.createReview.slideTitle,noSuffixIfPossible:null!==y,separator:null!==y?"parenthesis":null})),n.validation.fireEvent("onDMUObjectInitialized",{dmuObject:a})}p.setCurrentSlide(a),n.validation.updateVisibleMarkups(),await C.copyTransientMarkersAndOverloads(p,a,n.ctxViewer,n.duplicatedEntity,n.hiddenElts),r&&r.isRequirementCompareActive()&&await r.addActiveCompareToNewSlide(a);var j=w.giveDMUSlidesController({context:s});j&&j.setActiveSlide(a,{duration:0})}else n.validation.fireEvent("onCreateMarkupNoSlide");return{sessionMarkup:p,markup:r}},P=function(e){var n=t.getEventsController({viewer:e.iCtxViewer.getViewer()});var i=t.getReviewContext({viewer:e.iCtxViewer.getViewer()}).getValidation().getChecks(),a=[],o=[];if("add"===e.mode)for(let t=0;t<i.length;t++){var s=i[t].getAttribute("sPlmID");for(let n=0;n<e.checks.length;n++)s===e.checks[n]&&(e.highlight.addAssociatedCheck(i[t].getAttribute("sPlmID")),a.push(i[t]))}else"remove"===e.mode&&(e.highlight.removeAssociatedCheck(e.check.getPlmID()),o.push({highlightId:e.highlight.getPlmID(),checkId:e.check.getPlmID()}));n.fireEvent("onUpdateImpactedChecksList",{highlight:e.highlight,checks:"remove"===e.mode?o:a,mode:e.mode})},E=function(e){var n=t.getReviewContext({context:e.ctxViewer}),a=t.getEventsController({viewer:e.ctxViewer.getViewer()});let o=n.getValidation().getHighlights(),s=e.markup.getChildren()[0].getMarkupContent().getSlides();for(let e=0;e<s.length;e++){for(let t=0;t<o.length;t++){let n=o[e].getPresentationSlideID();s[e].getAttribute("sUuid")===n&&(i.deleteMarkupThumbnail("review2dthumbnail",o[t].getPlmID()),a.fireEvent("onHighlightPreviewUpdateRequested",{highlightId:o[t].getPlmID()}))}if(s[e].getDMUObjects&&s[e].getDMUObjects().length){var r=s[e].getDMUObjects();for(let e=0;e<r.length;e++)if(r[e].getDMUComments()&&r[e].getDMUComments().length){var l=r[e].getDMUComments();for(let e=0;e<l.length;e++)for(let t=0;t<o.length;t++)o[t].getPresentationSlideID()===l[e].getAttribute("sUuid")&&(i.deleteMarkupThumbnail("review2dthumbnail",o[t].getPlmID()),a.fireEvent("onHighlightPreviewUpdateRequested",{highlightId:o[t].getPlmID()}))}}}},A=function(e){if(e&&e.validation&&e.replyData&&e.viewer&&e.reviewCtx){var t,n=function(t){let n=null,i=null,o={entities:null,occurrences:null};i=e.reviewCtx.getCurrentSessionMarkup(),i&&"DMUMarkup"===i.getType()&&(n=i.getAttribute("oLinksManager")),n&&n.exportLinksManagerData(o),i=new a(e.viewer,e.reviewCtx),t.setMarkupContent(i),i.setMarkupOwner(t),n=new m(e.viewer,i),(o.entities&&o.entities.length>0||o.occurrences&&o.occurrences.length>0)&&n.importLinksManagerData(o),i.setAttributes([{name:"oLinksManager",value:n},{name:"sName",value:e.replyData.name}])};if(e.existingRepRef)n(e.existingRepRef),t={replyRef:e.existingRepRef.getOwner(),replyRepRef:e.existingRepRef};else{if(!e.markupRef)return;var i={children:[],id:e.replyData.pId,instanceId:e.replyData.markupRefInst.pId,name:e.replyData.name,type:"Reply",treeOrder:"4.3333",webMarkup:"true",owner:e.replyData.owner};e.markupRef.addChild(i);let a=e.markupRef.getChildren();var o=a&&a.length?a[a.length-1]:null;if(o){var s={children:[],id:e.replyData.markupRepRef.pId,instanceId:e.replyData.markupRepInst.pId,name:"Review "+e.replyData.name,type:"ReviewMarkup",treeOrder:"4.3334",webMarkup:"true",owner:e.replyData.owner};o.addChild(s),a=o.getChildren();var r=a&&a.length?a[0]:null;r&&(n(r),t={replyRef:o,replyRepRef:r})}}return t}},T=function(e){if(e||e.validation||e.validation.getRepRef)for(let t in e.listCommentsStatus){if(!e.listCommentsStatus.hasOwnProperty(t))continue;const n=e.validation.getRepRef(t);n&&n.setCommentsStatusList(e.listCommentsStatus[t])}},O={createReview:async function(e){if(!e||!e._ctxViewer)return;var i=e._ctxViewer,a="Draft"===e.maturity,o=i.getViewer(),c=t.getReviewContext({context:i});let d=t.getEventsController({viewer:i.getViewer()});c||(c=await n.createReviewContext({context:i}));let m=void 0!==e._rootData?e._rootData.valueItem:void 0,u=e._subContext?e._subContext.id:void 0,p=[],g=[];m&&p.push(m),u&&p.push(u),g.push({contextIds:p,sServiceID:m&&i.getController().getRootStats(m)&&i.getController().getRootStats(m).serviceId?i.getController().getRootStats(m).serviceId:""}),f.createReviewInDataBase({viewer:i,reviewName:e._reviewName,reviewPLMexternalID:e._reviewPLMexternalID,parentID:m,contextIds:p&&p.length>0?p:void 0,listContextIds:g&&g.length>0?g:void 0,reviewDescription:e._reviewDescription?e._reviewDescription:"",createMarkup:e._createMarkup,restrictedEdition:e._restrictedEdition,markupName:e._markupName,markupPLMexternalID:e._markupPLMexternalID,markupDescription:e._markupDescription,contextAsValidated:1===p.length?e._contextAsValidated:void 0,validatedObjects:e._validatedObjects,serviceID:m&&i.getController().getRootStats(m)&&i.getController().getRootStats(m).serviceId?i.getController().getRootStats(m).serviceId:"",members:e._members,checksList:e._checks,multiReview:e.multiReview,strURI:e._strURI,onReviewCreationCompleted:function(n){new Promise((t=>{if(a){const i=n.currentState,o=()=>{M.sendWebServiceCall({url:"resources/lifecycle/maturity/promote",config:{verb:"POST",data:JSON.stringify({data:[{physicalid:n.pId,tostate:"PRIVATE",fromstate:i,type:"DMUValidationValidation",revision:"A",policy:"VPLM_SMB_Evaluation_MajorRev",name:n.validationName,coretype:"Reference",signature:"Isolate"}],notificationTimeout:3600})},onSuccess:function(){c.getValidation().setCurrentState("PRIVATE"),d.fireEvent("onReviewObjectAttributesModified",{object:c.getValidation(),attr:[{currentState:"PRIVATE"}]})},onFailure:function(){var t=e._ctxViewer.getFrameWindow().getUIFrame().getElementsByClassName("DMUCreateReviewInfoDiv");t.length&&t[0].dsModel&&t[0].dsModel.destroy()}})};if(e._createMarkup){if(d){const e=d.addEvent("onReviewSaved",(()=>{a&&o(),d.removeEvent(e)})),t=d.addEvent("onReviewSaveFailed",(()=>{a&&o(),d.removeEvent(t)}))}t()}else a&&o(),t()}else{var i=e._ctxViewer.getFrameWindow().getUIFrame().getElementsByClassName("DMUCreateReviewInfoDiv");i.length&&i[0].dsModel&&i[0].dsModel.destroy(),t()}})).then((async()=>{d=t.getEventsController({viewer:i.getViewer()});let a=b.getLoadingContextController({context:i});if(!i.getRootBagPath().getChildrenPathes().length){d&&d.fireEvent("reviewNoContextModeOn");let t=d.addEvent("onLoadedReviewContext",(n=>{d.removeEvent(t);["DXF","DWG","PDF"].some((t=>{if(t===n.rootType){c.getValidation().getMarkups().length||new Promise((function(e){let t;O.generateName({sListTypeName:[{sTypeName:"DMUValidationReviewReference"}],onGenerateNameCompleted:function(n){t=n.listNames[0].title,e(t)},ononGenerateNameFailed:function(){t=S.createReviewMarkup.defaultMarkupName,e(t)}})})).then((function(t){O.createReviewMarkup({ctxViewer:i,validation:c.getValidation(),mkpName:t,duplicatedEntity:[],hiddenElts:[],createFirstSlide:e.createFirstSlide,onMarkupCreationCompleted:function(e){d&&d.fireEvent("onDMUMarkupCreationSucceeded",{dmuObject:e.sessionMarkup})},onMarkupCreationFailed:function(){}})}))}}))})),n=i.subscribe({event:"onRootAdded"},(function(e){let t;if(e.path)t=x.getNodeType(e.path.getLastElement(!0)),"Document"===t&&(t=a.getLoadMarkupCtxType()?a.getLoadMarkupCtxType():t);else{let e=i.getRootBagPath().externalPath[0].path.getChildrenPathes().length,n=i.getRootBagPath().externalPath[0].path.getChildrenPathes()[e-1];t=x.getNodeType(n.getLastElement(!0))}d.fireEvent("reviewNoContextModeOff",{rootType:t}),i.unsubscribe(n)}))}if(n){let d,p;a&&(d=a.getTempObjectInformations(),p=a.getLoadedR2VInformations());let g=[];n.Validated.paths?n.Validated.paths.forEach((e=>{e.path?g.push(e.path):e.uri&&g.push(e.uri)})):n.Validated.path&&(g=n.Validated.path);var m={context:e._rootData,contextId:e._rootData?e._rootData.valueItem:null,subContext:e._subContext,subContextId:e._subContext?e._subContext.id:null,subContextType:e._subContext?e._subContext.type:null,reviewId:n.pId,valCtxId:n.Context?n.Context.pId:null,validatedID:n.Validated.pId,validatedPath:g,reviewName:n.validationName,modifiable:!0,editionMode:e._editionMode,restrictedEdition:n.restrictedEdition,reviewDescription:n.description?n.description:"",status:n.status,currentState:n.currentState,reviewType:"DMUValidationValidation",owner:n.owner,tempObjectInfo:d,loadedR2VInfo:p,members:n.Members?n.Members:null,checks:n.checks?n.checks:null},u=function(e){let n=e.reviewContext,i=e.createdReviewInfo;var a=new s(e.viewer,n);a.setFromJson({id:i.reviewId,name:i.reviewName,status:i.status,currentState:i.currentState,type:i.reviewType,owner:i.owner,restrictedEdition:i.restrictedEdition}),n.setValidation(a),n.setReviewCtxInformation(i),a.setNode(new R("DMUReviewBag"));let o=b.giveLoadingContextController({context:t.getContextViewer({viewer:e.viewer})});if(o&&["PDF","Requirement","Requirement Specification"].includes(o.getLoadMarkupCtxType())&&a.enableMultipleMarkupVisibility(!0),i.valCtxId){var c=new r(e.viewer,a);c.setFromJson({id:i.valCtxId,type:"DMUValidationContext"});let t=[];i.context&&t.push({id:i.context.valueItem,name:i.context.labelItem,type:i.context.type}),i.subContext&&t.push({id:i.subContext.id,name:i.subContext.label,type:i.subContext.type,subContext:!0}),c.setJsonContexts(t),a.setContext(c)}if(i.members){var d={};d.validation=n.getValidation(),d.membersFromServer=i.members,U(d)}i.checks&&i.checks.forEach((t=>{V({type:"DMUValidationCheck",name:t.name,id:t.pId,state:t.checkState,description:t.description,owner:t.owner,requirementName:t.name,requirementDocId:t.requirementDocId,ctxViewer:e.ctxViewer,iReviewContext:n})}));var m=new l(e.viewer,a);if(m.setFromJson({id:i.validatedID,type:"ValValidated"}),a.setValidated(m),i.validatedPath&&i.validatedPath.length>0)if("R2V_Activity"===n.getValidation().getContext().getJsonContextTypes()[0])i.validatedPath.length&&i.validatedPath[0]&&i.loadedR2VInfo.forEach((e=>{(i.validatedPath[0][0]&&e.id===i.validatedPath[0][0]||e.id&&e.strURI===i.validatedPath[0])&&(n.getValidation().getValidated().addPathElement({instanceName:e.info[0]["ds6w:label"],referenceName:e.info[0]["ds6w:label"],PathElements:[e.id]}),a.fireEvent("onDMUObjectInitialized",{dmuObject:a,editionMode:i.editionMode}))}));else{var u=t.getContextViewer({viewer:e.viewer}).getController(),p=[];i.validatedPath.forEach((e=>{Array.isArray(e)?p.push(e[0]):p.push(e)})),u.getAttributes({ids:p,attributes:["ds6w:label","type_icon_url","ds6w:type"],callbacks:{onComplete:function(e){i.validatedPath.forEach((t=>{n.getValidation().getValidated().addPathElement({instanceName:e[t]["ds6w:label"],referenceName:e[t]["ds6w:label"],referenceType:e[t]["ds6w:type"],PathElements:t})})),a.fireEvent("onDMUObjectInitialized",{dmuObject:a,editionMode:i.editionMode})},onFailure:function(){n.getValidation().getValidated().addPathElement({instanceName:i.tempObjectInfo.title,referenceName:i.tempObjectInfo.title,PathElements:[i.validatedPath]}),a.fireEvent("onDMUObjectInitialized",{dmuObject:a,editionMode:i.editionMode})}}})}else a.fireEvent("onDMUObjectInitialized",{dmuObject:a,editionMode:i.editionMode});return a}({viewer:o,createdReviewInfo:m,reviewContext:c,ctxViewer:i});e._createMarkup?n.markup?(await j({mkpData:n.markup,validation:u,reviewCtx:c,ctxViewer:i,duplicatedEntity:e._dmuEltsDuplicated,hiddenElts:e.hiddenElts,rootData:e._rootData,createFirstSlide:e._createFirstSlide}),e.onReviewCreationComplete({validation:u})):e.onReviewCreationFailed():e.onReviewCreationComplete()}else e.onReviewCreationFailed()}))},onReviewCreationFailed:e.onReviewCreationFailed})},updateValidatedObjectsList:function(e){f.saveValidatedObject({serviceId:e.serviceId,validatedObjects:e.validatedObjects,validatedId:e.validatedId,onSaveValidatedObjectsCompleted:function(){!function(e){var n=e.ctxViewer,i=t.getContextViewer({viewer:n}).getController();const a=t.getReviewContext({viewer:e.ctxViewer});var o=[e.instanceIds,e.referenceIds];const s=n=>{var i=t.getEventsController({viewer:e.ctxViewer}),o=[],s=[];let r=null,l=a.getValidation().getContext()?a.getValidation().getContext().getMainContextType():null;if(l&&(r=l.parentType?l.parentType:l.type?l.type:l),"remove"===e.updateMode){for(let t=0;t<e.validatedToAdd.length;t++)a.getValidation().getValidated().removePathElement(e.validatedToAdd[t],e.fullPathRefs[t]);"Change Action"===n[e.referenceIds[0]]["ds6w:type"]?i.fireEvent("onRemoveCA",e):i.fireEvent("onValidatedSaved",e),["Requirement Specification","Requirement","Document","Specification Report","DesignSight","R2V_Activity"].includes(r)&&a.getValidation().removeValidatedNode(e.referenceIds[0])}else{for(let t=0;t<e.validatedToAdd.length;t++)a.getValidation().getValidated().addPathElement({instanceName:n[e.instanceIds[t]]["ds6w:label"],referenceName:n[e.referenceIds[t]]["ds6w:label"],PathElements:e.validatedToAdd[t],referenceType:n[e.referenceIds[t]]["ds6w:type"]}),o.push(n[e.referenceIds[t]].type_icon_url),s.push(n[e.instanceIds[t]]["ds6w:label"]),["Requirement Specification","Requirement","Document","Specification Report","DesignSight","R2V_Activity"].includes(r)&&a.getValidation().addValidatedNode({docInfo:{validatedId:e.validatedId,validatedPaths:e.validatedToAdd[t],validatedName:n[e.validatedToAdd[t]]["ds6w:label"],referenceType:n[e.validatedToAdd[t]]["ds6w:type"]}});var c;1===e.validatedToAdd.length&&1===e.validatedToAdd[0].length&&n[e.validatedToAdd[0][0]]["ds6w:type"]&&"Change Action"===n[e.validatedToAdd[0][0]]["ds6w:type"]&&(c="Change Action"),c&&"Change Action"===c?i.fireEvent("onDropCA",{changeId:e.validatedId,changeName:s,changeIcon:o}):e.onReviewCtxUpdateOrDropValidated?i.fireEvent("onReviewCtxUpdateOrDropValidated",{validatedId:e.validatedId,validatedNames:s,validatedPaths:e.validatedToAdd,validatedIcons:o}):i.fireEvent("onDMUValidatedCreated",{validatedId:e.validatedId,validatedNames:s,validatedPaths:e.validatedToAdd,validatedIcons:o,validatedType:c})}};if(a)if("R2V_Activity"===a.getValidation().getContext().getJsonContextTypes()[0]){const e=b.getLoadingContextController({context:t.getContextViewer({viewer:n})}).getLoadedR2VInformations(),i=e[0].id,a=e[0].info[0].icon;s({[i]:{"ds6w:label":e[0].info[0]["ds6w:label"],"ds6w:type":"R2V_Activity",physicalid:i,type_icon_url:a}})}else i.getAttributes({ids:o,attributes:["ds6w:label","type_icon_url"],callbacks:{onComplete:s,onFailure:function(){return null}}})}(e)},onSaveValidatedObjectsFailed:e.onSaveValidatedObjectsFailed})},addCheck:function(e){f.addCheck({validationId:e.validation.getPlmID(),requirementDocId:e.requirementDocId,checkName:e.checkName,description:e.description,checkState:e.checkState,onCheckCreationCompleted:function(t){t.error||V({type:"DMUValidationCheck",name:t.name,id:t.pId,state:t.checkState,description:t.description,owner:t.owner,requirementName:e.requirementName,requirementDocId:e.requirementDocId,ctxViewer:e.iCtxViewer})},onCheckCreationFailed:e.onCheckCreationFailed})},addChecks:function(e){var n=t.getReviewContext({context:e.iCtxViewer}).getValidation().getPlmID();f.addChecks({listObjects:e.checkList,validationId:n,onCheckCreationCompleted:function(t){t.checkObjects&&t.checkObjects.forEach((t=>{V({type:"DMUValidationCheck",name:t.name,id:t.pId,state:t.checkState,description:t.description,owner:t.owner,requirementName:t.name,requirementDocId:t.requirementDocId,ctxViewer:e.iCtxViewer})}))},onCheckCreationFailed:e.onCheckCreationFailed})},setCheckRequirement:function(e){f.setCheckRequirement({checkId:e.checkId,requirementId:e.requirementId,removeReq:e.removeReq,onSetCheckRequirementComplete:function(){e.onSetCheckRequirementComplete(e)},onSetCheckRequirementFailed:e.onSetCheckRequirementFailed})},setImpactedCheck:function(e){f.setImpactedCheck({checksId:e.checks,highlightId:e.highlight.getPlmID(),onSetImpactedCheckComplete:function(){e.mode="add",P(e),e.onSetImpactedCheckComplete()},onSetImpactedCheckFailed:e.onSetImpactedCheckFailed})},removeImpactedCheck:function(e){f.removeImpactedCheck({checkId:e.check.getPlmID(),highlightId:e.highlight.getPlmID(),onRemoveImpactedCheckComplete:function(){e.mode="remove",P(e),e.onRemoveImpactedCheckComplete()},onRemoveImpactedCheckFailed:e.onRemoveImpactedCheckFailed})},updateSessionCheckAttributes:function(e){var n=t.getReviewContext({context:e.ctxViewer}).getValidation().getPlmID();f.updateAttributes({validationId:n,objectsToModify:[{sObjectId:e.objectId,sListOfAttributesToModify:e.attributesList}],onAttributesSaveCompleted:function(n){n.modifiedObjects&&1===n.modifiedObjects.length?(n.modifiedObjects[0].iCtxViewer=e.ctxViewer,function(e){var n,i=t.getReviewContext({context:e.iCtxViewer}).getValidation().getChecks();for(n=0;n<i.length;n++)i[n].getPlmID()===e.pId&&(e.iCheckState&&i[n].setStatus(e.iCheckState),e.sDescription&&i[n].setDescription(e.sDescription),e.sName&&i[n].setName(e.sName))}(n.modifiedObjects[0]),e.onSaveCompleted()):e.onSaveFailed()},onAttributesSaveFailed:e.onSaveFailed})},addHighlight:function(e){var t=[];e.markupRepRef&&(e.markupRepRef.getParent&&e.markupRepRef.getParent()&&e.markupRepRef.getParent().getInstancePlmID&&t.push(e.markupRepRef.getParent().getInstancePlmID()),e.markupRepRef.getInstancePlmID&&(t.push(e.markupRepRef.getInstancePlmID()),t.push(e.markupRepRef.getPlmID())));var n=2;if(e.highlightRating)switch(e.highlightRating){case"Undefined":n=1;break;case"Medium":n=3;break;case"High":n=4;break;case"Processed":n=5;break;case"Urgent":n=6}f.addHighlight({validationId:e.validation.getPlmID(),markupRepRefPathIds:t,slideId:e.slide.getAttribute("sUuid"),highlightName:e.highlightName,description:e.description,rating:n,onHighlightCreationCompleted:function(t){!function(e){if(e&&e.validation&&e.iCtxViewer&&e.highlightData){var t=new d(e.iCtxViewer.getViewer(),e.validation);t.setFromJson({type:"DMUValidationExposedPresentation",name:e.highlightData.name,id:e.highlightData.pId,slideId:e.highlightData.slideId,repRefMarkupId:e.highlightData.markupRepRefId,description:e.highlightData.description,rating:e.highlightData.presentationRating,associatedCheck:[],owner:e.highlightData.owner}),e.validation.addHighlight(t);var n=w.giveDMUSlidesController({context:e.iCtxViewer.getFrameWindow()});if(n){var a=n.getSlideRepresentation(e.highlightData.slideId);if(!a){var o=y.giveDMUCommentsController({context:e.iCtxViewer.getFrameWindow()});o&&(a=o.getCommentRepresentation(e.highlightData.slideId))}a&&(a.getImage().then((function(t){i.saveObjectThumbnail("review2dthumbnail",t,e.highlightData.pId)})),a.remove())}e.validation.fireEvent("onDMUObjectInitialized",{dmuObject:t,slideObject:e.slideObj})}}({iCtxViewer:e.iCtxViewer,validation:e.validation,highlightData:t,slideObj:e.slide,presentationRating:e.presentationRating}),e.onHighlightCreationCompleted()},onHighlightCreationFailed:e.onHighlightCreationFailed})},addReply:function(e){var n=t.getContextViewer({viewer:e.viewer}),i=t.getReviewContext({context:n});if(e.existingRepRef){let t=A({ctxViewer:n,replyData:e.existingRepRef.getOwner(),existingRepRef:e.existingRepRef,reviewCtx:i,validation:e.validation,viewer:e.viewer});e.onReplyCreationCompleted(t)}else f.addReply({markupRefId:e.markupRef.getPlmID(),name:e.name,description:e.description,validationId:e.validation.getPlmID(),onReplyCreationCompleted:function(t){let a=A({ctxViewer:n,replyData:t,markupRef:e.markupRef,reviewCtx:i,validation:e.validation,viewer:e.viewer});e.validation.fireEvent("onDMUObjectInitialized",{dmuObject:a.replyRepRef}),e.onReplyCreationCompleted(a)},onReplyCreationFailed:e.onReplyCreationFailed})},deleteObject:function(e){var n=t.getReviewContext({context:e.ctxViewer}).getValidation().getPlmID();f.deleteObject({validationId:n,objectIds:e.objectIds,onObjectDeletionCompleted:function(){var n=e.ctxViewer,a=[],o=[],s=[],r=t.getReviewContext({context:n}),l=t.getEventsController({viewer:n.getViewer()});if("validationObject"===e.type){for(let t=0;t<e.objectIds.length;t++){var c=r.getValidation().getChecks(),d=r.getValidation().getHighlights();for(let n=0;n<c.length;n++)c[n].getPlmID()===e.objectIds[t]&&(o.push(e.objectIds[t]),r.getValidation().removeCheck(e.objectIds[t]));for(let n=0;n<d.length;n++)if(d[n].getPlmID()===e.objectIds[t]){let o=d[n].getAssociatedCheck();for(let e=0;e<o.length;e++)s.push({highlightId:d[n].getPlmID(),checkId:o[e]});a.push(e.objectIds[t]),r.getValidation().removeHighlight(e.objectIds[t]),i.deleteMarkupThumbnail("review2dthumbnail",e.objectIds[t])}}a.length&&(l.fireEvent("onDMUHighlightRemoveRequested",a),l.fireEvent("onUpdateImpactedChecksList",{checks:s})),o.length&&l.fireEvent("onDMUCheckRemoveRequested",o)}else if("Markup"===e.type){let t=r.getValidation().getMarkups();for(let n=0;n<t.length;n++)t[n].getPlmID()===e.objectIds[0]&&E({ctxViewer:e.ctxViewer,markup:t[n]});r.getValidation().removeMarkup(e.objectId)}else if("Reply"===e.type){let t=null,n=r.getValidation().getMarkups();for(let i=0;i<n.length;i++){let a=n[i].getReplies();for(let o=0;o<a.length;o++)if(a[o].getPlmID()===e.objectIds[0]){t=n[i],E({ctxViewer:e.ctxViewer,markup:a[o]});break}if(t)break}t&&t.removeReply(e.objectIds[0])}e.onDeleteCompleted&&e.onDeleteCompleted()},onObjectDeletionFailed:e.onDeleteFailed})},createReviewMarkup:async function(e){if(e.ctxViewer&&e.validation){var i=t.getReviewContext({context:e.ctxViewer});i||(i=await n.createReviewContext({context:e.ctxViewer})),f.addMarkup({mkpName:e.mkpName,mkpDescription:e.mkpDescription,markupPLMexternalID:e.markupPLMexternalID,validationId:e.validation.getPlmID(),onMarkupCreationCompleted:async function(t){if(t&&t.error)e.onMarkupCreationFailed();else{let n=await j({mkpData:t,validation:e.validation,reviewCtx:i,ctxViewer:e.ctxViewer,duplicatedEntity:e.duplicatedEntity,hiddenElts:e.hiddenElts,createFirstSlide:e.createFirstSlide});e.onMarkupCreationCompleted&&e.onMarkupCreationCompleted(n)}},onMarkupCreationFailed:e.onMarkupCreationFailed})}},saveReviewMarkup:function(e){e&&e.frmWindow&&g.isPersistenceAllowed({onPersistenceAllowed:async function(){var n=function(){k--};k++;var i=null,a=t.getReviewContext({viewer:e.frmWindow.getViewer()});let o=a?a.getValidation():null,s=o?o.getRepRef(e.markupRepRefId):null,r=s?s.getMarkupContent():null;if(r){var l;if(!e.superType||"SIMItfSimulation"!==e.superType&&"Document"!==e.superType&&"Specification Report"!==e.superType){l={Version:"1.0",Model:[]};let e=await p.getObjectDefinition(r);l.Model.push(e)}else{l={Version:"1.0",Contexts:[],Model:[]};let t=await p.getObjectDefinition(r);l.Model.push(t),l.Contexts.push({superType:e.superType,documentType:e.documentType,listData:e.listData,loadingInfos:e.loadingInfos,documentVersionInfos:e.documentVersionInfos})}r.setDirtyFlag(!1),i=JSON.stringify(l)}i?f.saveReviewMarkup({markupRepRefId:e.markupRepRefId,jsonContent:i,validationId:o?o.getPlmID():null,onSaveReviewMarkupCompleted:function(){r.getMarkupOwner()&&!r.getMarkupOwner().hasStream()&&r.getMarkupOwner().setAttribute("bNoStream",!1),e.onSaveCompleted(),n()},onSaveReviewMarkupFailed:function(t){r.setDirtyFlag(!0),e.onSaveFailed(t),n()}}):(e.onSaveFailed&&e.onSaveFailed("error"),n())},onPersistenceNotAllowed:function(){e.onSaveFailed&&e.onSaveFailed("error")}})},updateAttributes:function(e){var n=[];e.objectsToModify&&e.objectsToModify.length>0&&e.objectsToModify.forEach((function(e){var t=e.objectId;t||(t=e.object.getPlmID()),n.push({sObjectId:t,sListOfAttributesToModify:e.attributesList})}));var i=t.getReviewContext({context:e.ctxViewer}).getValidation().getPlmID();f.updateAttributes({validationId:i,objectsToModify:n,onAttributesSaveCompleted:function(n){!function(e){var n;e.ctxViewer&&e.ctxViewer.getViewer&&(n=t.getEventsController({viewer:e.ctxViewer.getViewer()})),e.objects&&e.updateInfos&&e.updateInfos.length>0&&e.updateInfos.forEach((function(t){for(var i,a=[],o=0;o<e.objects.length;o++)if(e.objects[o]&&e.objects[o].object&&e.objects[o].object.getPlmID()===t.pId){i=e.objects[o].object;break}i&&(t.sValidationState?(i.setStatus(t.sValidationState),a.push({sValidationState:t.sValidationState})):t.sAlias&&(i.setName(t.sAlias),a.push({sAlias:t.sAlias})),n&&n.fireEvent("onReviewObjectAttributesModified",{object:i,attr:a}))}))}({objects:e.objectsToModify,ctxViewer:e.ctxViewer,updateInfos:n.modifiedObjects}),e.onAttributesSaveCompleted(n)},onAttributesSaveFailed:e.onSaveFailed})},updateReviewContext:function(e){let n=[];e.mainContext&&e.mainContext.id&&n.push(e.mainContext.id),e.subContext&&e.subContext.id&&n.push(e.subContext.id),f.updateReviewContext({validationId:e.validation.getPlmID(),contextId:1===n.length?n[0]:void 0,contextIds:n.length>0?n:void 0,serviceID:e.ctxViewer.getController().getRootStats(e.contextId)&&e.ctxViewer.getController().getRootStats(e.contextId).serviceId?e.ctxViewer.getController().getRootStats(e.contextId).serviceId:"",onUpdateReviewContextCompleted:function(n){!function(e){if(e&&e.updateInfos&&e.validation&&e.mainContext){var n;e.ctxViewer&&e.ctxViewer.getViewer&&(n=t.getEventsController({viewer:e.ctxViewer.getViewer()}));var i=e.validation.getContext();if(!i&&e.updateInfos.Context&&((i=new r(e.ctxViewer,e.validation)).setFromJson({id:e.updateInfos.Context.pId,type:"DMUValidationContext"}),e.validation.setContext(i)),i){let t=[];e.mainContext.id&&t.push({id:e.mainContext.id,name:e.mainContext.label,type:e.mainContext.type}),e.subContext&&e.subContext.id&&t.push({id:e.subContext.id,name:e.subContext.label,type:e.subContext.type,subContext:!0}),i.setJsonContexts(t),n&&n.fireEvent("onReviewCtxLoaded",{name:e.subContext&&e.subContext.id?e.subContext.label:e.mainContext.label,icon:e.subContext&&e.subContext.id?e.subContext.icon:e.mainContext.icon,id:e.subContext&&e.subContext.id?e.subContext.id:e.mainContext.id})}}}({validation:e.validation,updateInfos:n,mainContext:e.mainContext,subContext:e.subContext,ctxViewer:e.ctxViewer}),e.onUpdateReviewContextCompleted()},onUpdateReviewContextFailed:e.onUpdateReviewContextFailed})},generateName:function(e){f.generateName({sListTypeName:e.sListTypeName,onGenerateNameCompleted:e.onGenerateNameCompleted,ononGenerateNameFailed:e.ononGenerateNameFailed})},setSlideForPreview:function(e){if(e&&e.validation){var t=e.validation,n=JSON.stringify(e.slideForPreview);this.updateAttributes({objectsToModify:[{object:e.validation,attributesList:[{sSlideForPreview:n}]}],ctxViewer:e.ctxViewer,onAttributesSaveCompleted:function(){t.setSlideForPreview(n),e.onSetSlideForPreviewCompleted()},onSaveFailed:e.onSetSlideForPreviewFailed})}},isProcessing:function(){return k>0},updateValidationMembers:function(e){var n=t.getReviewContext({context:e.context}).getValidation(),i=e.jsonMembersToModify;f.updateValidationMembers({validationId:n.getPlmID(),membersUpdate:i,onUpdateMembersSuccessful:function(t){e.validation=n,e.membersFromServer=t,U(e),e.onUpdateMembersSuccessful&&e.onUpdateMembersSuccessful()},onUpdateMembersFailed:e.onUpdateMembersFailed})},updateUserContribution:function(e){var n=t.getReviewContext({context:e.ctxViewer}).getValidation();f.updateAttributes({validationId:n.getPlmID(),objectsToModify:e.objectsToModify,onAttributesSaveCompleted:function(i){e.validation=n,e.contributionData=i,function(e){const{validation:n,contributionData:i}=e,a=i.modifiedObjects[0];if(!a)return;const o=n.getMembers(),s=o.getAssignees(),r=o.getContributors();let l=s.find((e=>e.id===a.pId))||r.find((e=>e.id===a.pId));var c;l&&(o.setMemberContribution(a),l.contribution=a.sContribution,l.bIsAssignee=s.some((e=>e.id===a.pId)),l.bIsContributor=r.some((e=>e.id===a.pId))),e.ctxViewer&&e.ctxViewer.getViewer&&(c=t.getEventsController({viewer:e.ctxViewer.getViewer()})),c&&c.fireEvent("onValidationUserContributionUpdated",{concernedMember:l})}(e),e.onAttributesSaveCompleted&&e.onAttributesSaveCompleted()},onAttributesSaveFailed:e.onAttributesSaveFailed})},setCommentStatus:function(e){f.setCommentStatus({commentsID:e.commentsID,commentStatus:e.commentStatus,validationId:e.validation.getPlmID(),onSetCommentStatusSuccess:function(t){e.listCommentsStatus=t.listCommentsStatus,T(e),e.onSetCommentStatusSuccess&&e.onSetCommentStatusSuccess(t)},onSetCommentStatusFailed:e.onSetCommentStatusFailed})},removeCommentStatus:function(e){f.removeCommentStatus({commentsID:e.commentsID,validationId:e.validation.getPlmID(),onRemoveCommentStatusSuccess:function(t){e.listCommentsStatus=t.listCommentsStatus,T(e),e.onRemoveCommentStatusSuccess&&e.onRemoveCommentStatusSuccess(t)},onRemoveCommentStatusFailed:e.onRemoveCommentStatusFailed})}};return O})),define("DS/DMUReviewPersistence/DMUReviewPersistence",[],(function(){})),define("DS/DMUReviewPersistence/panels/DMUReviewCreationPanel",["UWA/Core","UWA/Class","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/ComboBox","DS/Controls/Editor","DS/Controls/LineEditor","DS/Controls/Tab","DS/WUXAutoComplete/AutoComplete","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/Utilities/TouchUtils","DS/DMUControls/DMUAddMembersCommonComponent","i18n!DS/DMUReviewPersistence/assets/nls/DMUReviewPersistence","css!DS/DMUReviewPersistence/DMUReviewPersistence.css"],(function(e,t,n,i,a,o,s,r,l,c,d,m,u,p){"use strict";return t.extend({init:function(t){if(this._parent(t),!t.inputInfos)return;let g,f,h,v,I,b,C,w,D,y,x,R,M,S,k,U,V,j,P,E,A,T,O,N={},F=!1,L=!1,_=new c;function W(e,t,n,i){let a=i||"";return n?(n.value=t&&t.length>1?p.createReview.multiReviewsNaming+" ("+t.length+")":a,n.disabled=t&&t.length>1):((n=new s({value:t&&t.length>1?p.createReview.multiReviewsNaming+" ("+t.length+")":a,selectAllOnFocus:!0,maxLength:100,autoCommitFlag:!0,disabled:t&&t.length>1}).inject(e)).getContent().addClassName("add-dmu-creation-Item"),n.elements.container.setStyles({width:"100%"}),n.elements.container.childNodes[0].setStyles({width:"100%"})),n}let q,B=function(t){let n;w=t.reviewTitle;let i,r=function(t){E=""===t.value;let i=E||L;"reviewTitle"===t.id&&(Y.disabled=i,Z&&(Z.disabled=i)),Y.disabled||("reviewTitle"===t.id?w=t.value:"reviewDescription"===t.id&&(x=t.value)),e.createElement("span",{class:"wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-required wux-ui-3ds-lg"}).setStyles({color:"#E87B00",display:"inline-block","font-weight":"bold"}),"reviewTitle"===t.id&&(E?(g&&(g.tabBar.buttonGroup.getButton(g.value[0]).icon={iconName:"required",fontIconFamily:WUXManagedFontIcons.Font3DS},g.tabBar.buttonGroup.getButton(g.value[0]).elements.button.getChildren()[0].getChildren()[0].setStyles({color:"#E87B00","font-weight":"bold"})),n&&n.getChildren()[0].removeClassName("add-dmu-creation-errorIcon-hide")):(g&&(g.tabBar.buttonGroup.getButton(g.value[0]).icon={iconName:"doc",fontIconFamily:WUXManagedFontIcons.Font3DS}),n&&n.getChildren()[0].addClassName("add-dmu-creation-errorIcon-hide")))};if("Activated"===t.restrictedAccess?i=p.createReview.restrictedEditionActivated:"Deactivated"===t.restrictedAccess&&(i=p.createReview.restrictedEditionDeactivated),"R3R"===t.mode&&t.contexts&&(C=t.contexts[0],t.contexts.length>1)){let n=e.createElement("div",{class:"add-dmu-creation-multi-div"}).inject(t.parentDiv);new e.Element("div",{text:p.createReview.reviewContext,class:"add-dmu-creation-label"}).inject(n);var l=new a({elementsList:t.contexts,selectedIndex:0,enableSearchFlag:!0,actionOnClickFlag:!1}).inject(n);l.getContent().addClassName("add-dmu-creation-Item"),l.addEventListener("change",(()=>{C=l.value}))}v=e.createElement("div",{class:"add-dmu-creation-multi-div"}).inject(t.parentDiv),n=new e.Element("div",{class:"add-dmu-creation-label"}).inject(v),e.createElement("span",{class:"add-dmu-creation-errorIcon wux-ui-3ds wux-ui-3ds-error add-dmu-creation-errorIcon-hide"}).inject(n),e.createElement("span",{text:p.createReview.nameLabel}).inject(n),t.multipleReviews&&t.contexts&&t.contexts.length>1||e.createElement("span",{class:"add-dmu-creation-mandIcon wux-ui-3ds wux-ui-3ds-new-create"}).inject(n),T=new s({placeholder:p.createReview.namePlaceholder,value:t.multipleReviews&&t.contexts&&t.contexts.length>1?p.createReview.multiReviewsNaming+" ("+t.contexts.length+")":t.reviewTitle,selectAllOnFocus:!0,maxLength:100,autoCommitFlag:!0,disabled:t.multipleReviews&&t.contexts&&t.contexts.length>1}).inject(v),T.getContent().addClassName("add-dmu-creation-Item"),T.elements.container.setStyles({width:"100%"}),T.elements.container.childNodes[0].setStyles({width:"100%"}),T.addEventListener("change",(()=>{r({value:T.value,id:"reviewTitle"})}));let c=e.createElement("div",{class:"add-dmu-creation-multi-div"}).inject(t.parentDiv);new e.Element("div",{text:p.createReview.descriptionLabel,class:"add-dmu-creation-label"}).inject(c);let d=new o({nbRows:5,newLineMode:"shiftEnter",placeholder:p.createReview.descriptionPlaceholder,selectAllOnFocus:!0,maxLength:256,autoCommitFlag:!0}).inject(c);d.getContent().addClassName("add-dmu-creation-Item"),d.elements.container.setStyles({width:"100%"}),d.elements.container.childNodes[0].setStyles({width:"100%"}),d.addEventListener("change",(()=>{r({value:d.value,id:"reviewDescription"})}));let m=e.createElement("div",{class:"add-dmu-creation-multi-div"}).inject(t.parentDiv);new e.Element("div",{text:p.createReview.restrictedEditionLabel,class:"add-dmu-creation-label"}).inject(m),new e.Element("div",{text:i,class:"add-dmu-creation-Item"}).inject(m)},H=async function(n){C=n.contexts[0];let i=function(t,n,i){let a=new e.Element("div",{class:"add-dmu-creation-Item-WithIcon"}).inject(t);e.createElement("img",{src:n}).inject(a).setStyles({"margin-right":"5px"}),e.createElement("span",{text:i}).inject(a)},o=e.createElement("div",{class:"add-dmu-creation-multi-div-search"}).inject(n.parentDiv);if(new e.Element("div",{text:p.createReview.reviewContext,class:"add-dmu-creation-label"}).inject(o),"R3M"===t.mode){S=new e.Element("span",{class:"fonticon fonticon-search dmu-dmu-creation-field-search"});let t=null,i=null,a=null;j=new l({elementsTree:function(e){return new Promise((function(i){a&&clearTimeout(a),a=setTimeout((async function(){let a=await n.getObjs({text:e,roleType:""});_.empty(),_.prepareUpdate();var o=j.selectedItems;for(let e=0;e<a.length;e++){var s=[];if(o&&o.length>0&&(s=o.filter((t=>a[e].type.toLowerCase()===t.options.type.toLowerCase()?t.options.identifier===a[e].identifier:t.options.identifier===a[e].id))),!o||0===o.length||0===s.length){let n={label:a[e].label,plmID:a[e].id,value:a[e].identifier,name:a[e].label,identifier:a[e].identifier,type:a[e].type,icon:a[e].icon,serviceId:a[e].serviceId};t=new d(n),_.addRoot(t)}}_.pushUpdate(),i(_)}),1e3)}))},getChipInfo:function(e){return{label:e.options.label,icon:e.options.icon}},placeholder:p.createReview.autoCompletePlaceHolder,multiSearchMode:!0,allowFreeInputFlag:!1,minLengthBeforeSearch:3,keepSearchResultsFlag:!1}),j.getContent().addClassName("add-dmu-creation-Item"),j.getContent().getChildren()[0].addClassName("dmu-autoCompleteChecksSelectionChip"),j.getContent().getElementsByClassName("wux-controls-autoComplete-editor")[0].setStyle("min-width","180px");let r=n.contexts.filter((e=>!e.setValidatedObjFromContext))[0],c=n.contexts.filter((e=>e.setValidatedObjFromContext));if(0===c.length&&n.contexts&&n.contexts.length>0){let e=[];!r.valueItem||r.iconItem&&r.type?e.push({objectIconUrl:r.iconItem,objectType:r.type}):e=await n.getAdditionalObjInfo({ids:[r.valueItem]}),e.length&&(i=e[0].objectIconUrl),_.empty(),_.prepareUpdate();let a={label:r.labelItem,plmID:r.valueItem,name:r.labelItem,type:r.type,icon:i,objectData:r};t=new d(a),_.addRoot(t),_.pushUpdate(),j.selectedItems=[_.getRoots()[0]]}else{j.selectedItems||(j.selectedItems=[]);let e=[];_.empty(),_.prepareUpdate();let a=[],s=[];c.forEach((e=>{!e.valueItem||e.iconItem&&e.type?e.iconItem&&e.type&&a.push({objectIconUrl:e.iconItem,objectType:e.type}):s.push(e.valueItem)})),s.length&&0===a.length&&(a=await n.getAdditionalObjInfo({ids:s}));for(let n=0;n<c.length;n++){a&&a.length&&(i=a[n].objectIconUrl);let o={label:c[n].labelItem,plmID:c[n].valueItem,name:c[n].labelItem,type:c[n].type,setValObjFromCtx:c[n].setValidatedObjFromContext,icon:i,objectData:c[n]};t=new d(o),_.addRoot(t),e.push(_.getRoots()[n])}_.pushUpdate(),j.selectedItems=e,e.length>1&&(j.hide(),S.hide(),A=W(o,n.contexts,A),j.selectedItems&&j.selectedItems.length<=1&&A.addEventListener("change",(()=>{onEditorChangedCB({value:A.value,id:"reviewTitle"})})))}j.addEventListener("change",(async e=>{j.selectedItems||(j.selectedItems=[]);let t=e.dsModel.selectedItems[e.dsModel.selectedItems.length-1];if(t&&t.options){if(!t.options.setValObjFromCtx){let e={objectId:t.options.plmID?t.options.plmID:t.options.id,objectType:t.options.type,displayName:t.options.label,serviceId:t.options.serviceId};if(n.checkValidObject)var i=await n.checkValidObject({checkId:"Context",objs:[e]});if(i&&i.length>0)t.options.setValObjFromCtx=!!i[0].setValidatedObjFromContext&&i[0].setValidatedObjFromContext,t.options.objectData||(t.options.objectData=i[0]);else{const t=j.selectedItems.filter((t=>(t.options.id||t.options.plmID)!==e.objectId));j.selectedItems=t}}let e=t.options.setValObjFromCtx;if(F=!0,e)P.selectedItems&&j.selectedItems.length===P.selectedItems.length+1&&(j.selectedItems=[j.selectedItems[j.selectedItems.length-1]]),P.selectedItems=j.selectedItems;else{if(j.selectedItems.length>1){const e=j.selectedItems.filter((e=>(e.options.id||e.options.plmID)===(t.options.id||t.options.plmID)));j.selectedItems=e}P.selectedItems=[]}}else P.selectedItems=[],C=null,F=!1}));var s=async function(a){let o=null,s=null,r=null;var l=null,c=null;if(!a["dswebux/x-controls.selectionchips.items+json"]&&1===a.length)for(l=0;l<a.length;l++){let m={objectId:a[l].valueItem,objectType:a[l].type,displayName:a[l].labelItem,serviceId:a[l].serviceId,setValObjFromCtx:!!a[l].setValidatedObjFromContext&&a[l].setValidatedObjFromContext,objectData:a[l]};s=m.objectId,j.selectedItems=[],r=j.selectedItems;let u=null;if(s&&"R2V_FeatureOfInterest"===m.objectType?u=await n.getAdditionalObjInfo({ids:[s],isR2V:!0}):s&&(u=await n.getAdditionalObjInfo({ids:[s]})),u&&(i=u[l].objectIconUrl),r&&r.length>0){for(c=0;c<r.length&&r[c].options.id!==s;c++)if(e.is(a)&&e.is(a.length)&&a.length>0){_.prepareUpdate(),o=m.displayName;let e={label:o,name:m.displayName,type:m.objectType,id:m.objectId,icon:i,serviceId:m.serviceId,setValObjFromCtx:m.setValObjFromCtx,objectData:m.objectData};t=new d(e),_.addRoot(t),r?(r=r.concat(t),j.selectedItems=r):(r=[t],j.selectedItems=r),_.pushUpdate();break}}else if(e.is(a)&&e.is(a.length)&&a.length>0){_.prepareUpdate(),o=m.displayName;let e={label:o,name:m.displayName,type:m.objectType,id:m.objectId,icon:i,serviceId:m.serviceId,setValObjFromCtx:m.setValObjFromCtx,objectData:m.objectData};t=new d(e),_.addRoot(t),r?(r=r.concat(t),j.selectedItems=r):(r=[t],j.selectedItems=r),_.pushUpdate()}}};j.addEventListener("drop",(async e=>{let t=JSON.parse(e.dataTransfer.getData("text/plain"));if(e.preventDefault(),e.stopPropagation(),t.data.items)if(1===t.data.items.length){if(n.checkValidObject)var i=await n.checkValidObject({checkId:"Context",objs:t.data.items});i&&i.length>0?s(i):n.dropWarningNotif(p.createReview.setDefaultNotif)}else n.dropWarningNotif(p.createReview.setCtxRootNotif)})),S.onclick=function(){n.searchObjs({roleType:j&&j.selectedItems&&j.selectedItems.length?j.selectedItems[0].options.type:"",onSearchOkButtonClicked:async function(e){let t=e.data.items;if(t)if(1===t.length){if(n.checkValidObject)var i=await n.checkValidObject({checkId:"Context",objs:t});i&&i.length>0?s(i):n.dropWarningNotif(p.createReview.setDefaultNotif)}else n.dropWarningNotif(p.createReview.setCtxRootNotif)}})},n.multipleReviews||(j.inject(o),S.inject(o)),n.multipleReviews&&(j.inject(o),S.inject(o))}else{if(!n.multipleReviews&&n.contexts)if(n.contexts.length>0&&(C=n.contexts[0]),1===n.contexts.length)i(o,n.contexts[0].subContextId?n.contexts[0].subContextIcon:n.contexts[0].iconItem,n.contexts[0].subContextId?n.contexts[0].subContextTitle:n.contexts[0].labelItem);else if(n.contexts.length>1){let e=null;var r=new a({elementsList:n.contexts,selectedIndex:0,enableSearchFlag:!0,actionOnClickFlag:!1}).inject(o);r.getContent().addClassName("add-dmu-creation-Item-WithIcon"),r.addEventListener("change",(()=>{n.contexts&&(e=n.contexts.find((e=>e.valueItem===r.value)),C=e,"R2V_Activity"===e.type?(k&&k.hide(),V&&V.hide(),y&&y.hide()):(y&&b&&y.show().inject(b),V&&b&&V.show().inject(b),k&&b&&k.show().inject(b)),e.setValidatedObjFromContext?(h.getChildren().find((e=>e.className.contains("wux-controls-autoComplete add-dmu-creation-Item")))&&h.getChildren().find((e=>e.className.contains("wux-controls-autoComplete add-dmu-creation-Item"))).hide(),h.getChildren().find((e=>e.className.contains("add-dmu-creation-Item-WithIcon")))&&h.getChildren().find((e=>e.className.contains("add-dmu-creation-Item-WithIcon"))).destroy(),h.getChildren().find((e=>e.className.contains("dmu-dmu-creation-field-search")))&&h.getChildren().find((e=>e.className.contains("dmu-dmu-creation-field-search"))).destroy(),i(h,e.subContextId?e.subContextIcon:e.iconItem,e.subContextId?e.subContextTitle:e.labelItem)):(h.getChildren().find((e=>e.className.contains("add-dmu-creation-Item-WithIcon")))&&h.getChildren().find((e=>e.className.contains("add-dmu-creation-Item-WithIcon"))).destroy(),P.selectedItems=[],P.show().inject(h),M.inject(h)))})),C=n.contexts[0]}n.multipleReviews&&n.contexts&&(A=W(o,n.contexts,A))}h=e.createElement("div",{class:"add-dmu-creation-multi-div-search"}).inject(n.parentDiv),new e.Element("div",{text:p.createReview.validatedObjects,class:"add-dmu-creation-label"}).inject(h),M=new e.Element("span",{class:"fonticon fonticon-search dmu-dmu-creation-field-search"});let m=new c,u=null,g=null,f=null;if(P=new l({elementsTree:function(e){return new Promise((function(t){f&&clearTimeout(f),f=setTimeout((async function(){let i=await n.getObjs({text:e,roleType:j&&j.selectedItems&&j.selectedItems.length?j.selectedItems[0].options.type:C?C.type:""});m.empty(),m.prepareUpdate();var a=P.selectedItems;for(let e=0;e<i.length;e++){var o=[];if(a&&a.length>0&&(o=a.filter((t=>i[e].type.toLowerCase()===t.options.type.toLowerCase()?t.options.identifier===i[e].identifier:t.options.identifier===i[e].id))),!a||0===a.length||0===o.length){let t={label:i[e].label,plmID:i[e].id,value:i[e].identifier,name:i[e].label,identifier:i[e].identifier,type:i[e].type,icon:i[e].icon,serviceId:i[e].serviceId};u=new d(t),m.addRoot(u)}}m.pushUpdate(),t(m)}),1e3)}))},getChipInfo:function(e){return{label:e.options.label,icon:e.options.icon}},placeholder:p.createReview.autoCompletePlaceHolder,multiSearchMode:!0,allowFreeInputFlag:!1,minLengthBeforeSearch:3,keepSearchResultsFlag:!1}),P.getContent().addClassName("add-dmu-creation-Item"),P.getContent().getChildren()[0].addClassName("dmu-autoCompleteChecksSelectionChip"),P.getContent().getElementsByClassName("wux-controls-autoComplete-editor")[0].setStyle("min-width","180px"),"R3M"===t.mode){let e=n.contexts.filter((e=>e.setValidatedObjFromContext));if(e&&e.length&&n.contexts&&n.contexts.length>0){P.selectedItems||(P.selectedItems=[]);let t=[];m.empty(),m.prepareUpdate();let i=[],a=[];e.forEach((e=>{!e.valueItem||e.iconItem&&e.type?e.iconItem&&e.type&&i.push({objectIconUrl:e.iconItem,objectType:e.type}):a.push(e.valueItem)})),a.length&&0===i.length&&(i=await n.getAdditionalObjInfo({ids:a}));for(let n=0;n<e.length;n++){i&&i.length&&(g=i[n].objectIconUrl);let a={label:e[n].labelItem,plmID:e[n].valueItem,name:e[n].labelItem,type:e[n].type,icon:g,objectData:e[n]};u=new d(a),m.addRoot(u),t.push(m.getRoots()[n])}m.pushUpdate(),P.selectedItems=t}else if(0===e.length&&1===n.contexts.length&&n.validatedObjects&&n.validatedObjects.length>0){P.selectedItems||(P.selectedItems=[]);let e=[];m.empty(),m.prepareUpdate();let t=[],i=[];n.validatedObjects.forEach((e=>{!e.valueItem||e.iconItem&&e.type?e.iconItem&&e.type&&t.push({objectIconUrl:e.iconItem,objectType:e.type}):i.push(e.valueItem)})),i.length&&0===t.length&&(t=await n.getAdditionalObjInfo({ids:i}));for(let i=0;i<n.validatedObjects.length;i++){t&&t.length&&(g=t[i].objectIconUrl);let a={label:n.validatedObjects[i].labelItem,plmID:n.validatedObjects[i].valueItem,name:n.validatedObjects[i].labelItem,type:n.validatedObjects[i].type,icon:g,objectData:n.validatedObjects[i]};u=new d(a),m.addRoot(u),e.push(m.getRoots()[i])}m.pushUpdate(),P.selectedItems=e}P.addEventListener("change",(async e=>{P.selectedItems||(P.selectedItems=[]);let t=e.dsModel.selectedItems[e.dsModel.selectedItems.length-1],i=j.selectedItems.some((e=>e.options.setValObjFromCtx));if(t&&t.options){if(!t.options.setValObjFromCtx){let e={objectId:t.options.plmID?t.options.plmID:t.options.id,objectType:t.options.type,displayName:t.options.label,serviceId:t.options.serviceId},i=[];if(j&&j.selectedItems&&j.selectedItems.length&&j.selectedItems.forEach((e=>{let t=e.options.objectData?e.options.objectData:null;t&&i.push(t)})),n.checkValidObject)var a=await n.checkValidObject({checkId:"Validated",objs:[e],contexts:i&&i.length?i:C?[C]:null});if(a&&a.length>0)t.options.setValObjFromCtx=!!a[0].setValidatedObjFromContext&&a[0].setValidatedObjFromContext,t.options.objectData||(t.options.objectData=a[0]);else{const t=P.selectedItems.filter((t=>(t.options.id||t.options.plmID)!==e.objectId));P.selectedItems=t}}let e=t.options.setValObjFromCtx;if(0===j.selectedItems.length&&(i=!0),i&&e&&!F)P.selectedItems&&j.selectedItems&&j.selectedItems.length>1?P.selectedItems.length===j.selectedItems.length-1?1===P.selectedItems.length?o.getChildren().find((e=>e.className.contains("wux-controls-lineeditor-width add-dmu-creation-Item")))&&(o.getChildren().find((e=>e.className.contains("wux-controls-lineeditor-width add-dmu-creation-Item"))).destroy(),S.show().inject(o),j.show().inject(o),j.selectedItems=P.selectedItems,v&&w&&(w=n.reviewTitle,T=W(v,j.selectedItems,T,w)),I&&D&&(D=n.markupTitle,O=W(I,j.selectedItems,O,D))):(j.selectedItems=P.selectedItems,A=W(o,j.selectedItems,A),v&&w&&(T=W(v,j.selectedItems,T,w)),I&&D&&(O=W(I,j.selectedItems,O,D))):P.selectedItems.length===j.selectedItems.length+1&&(j.selectedItems=P.selectedItems,P.selectedItems.length>1&&j&&(j.hide(),S.hide()),A=W(o,j.selectedItems,A),v&&w&&(T=W(v,j.selectedItems,T,w)),I&&D&&(O=W(I,j.selectedItems,O,D))):j.selectedItems&&1===j.selectedItems.length?P.selectedItems.length===j.selectedItems.length-1?j.selectedItems=P.selectedItems:P.selectedItems.length===j.selectedItems.length+1&&(j.hide(),S.hide(),j.selectedItems=P.selectedItems,A=W(o,j.selectedItems),v&&w&&(T=W(v,j.selectedItems,T,w)),I&&D&&(O=W(I,j.selectedItems,O,D))):j.selectedItems=P.selectedItems;else if(0===j.selectedItems.length){const e=P.selectedItems.filter((e=>(e.options.id||e.options.plmID)!==(t.options.id||t.options.plmID)));P.selectedItems=e}}else i&&0===P.selectedItems.length&&(j.selectedItems=P.selectedItems);F=!1}))}var x=async function(t){let i=null,a=null,o=null;var s=null,r=null;let l=[],c=null,p=!1,f=!1,h=null;if(!t["dswebux/x-controls.selectionchips.items+json"]){for(const e of t)e.valueItem&&l.push(e.valueItem),e.type&&"R2V_Activity"===e.type&&(p=!0,h=await n.getAdditionalObjInfo({ids:[e.valueItem],isR2V:p}));for(p&&1===t.length||(c=await n.getAdditionalObjInfo({ids:l})),s=0;s<t.length;s++){let n={objectId:t[s].valueItem,objectType:t[s].type,displayName:t[s].labelItem,serviceId:t[s].serviceId,parentType:t[s].parentType?t[s].parentType:"",setValObjFromCtx:!!t[s].setValidatedObjFromContext&&t[s].setValidatedObjFromContext,objectData:t[s]};if(o=P.selectedItems,"R2V_Activity"===n.objectType?h&&h.length&&(g=h[s].objectIconUrl,f=!0):c&&c.length&&(g=f?c[s-1].objectIconUrl:c[s].objectIconUrl),o&&o.length>0){for(a=o.filter((e=>(e.options.id||e.options.plmID)===n.objectId)),r=0;r<o.length&&!(a&&a.length>0);r++)if(e.is(t)&&e.is(t.length)&&t.length>0){m.prepareUpdate(),i=n.displayName;let e={label:i,name:n.displayName,type:n.objectType,id:n.objectId,icon:g,serviceId:n.serviceId,parentType:n.parentType,setValObjFromCtx:n.setValObjFromCtx,objectData:n.objectData};u=new d(e),m.addRoot(u),o?(o=o.concat(u),P.selectedItems=o):(o=[u],P.selectedItems=o),m.pushUpdate();break}}else if(e.is(t)&&e.is(t.length)&&t.length>0){m.prepareUpdate(),i=n.displayName;let e={label:i,name:n.displayName,type:n.objectType,id:n.objectId,icon:g,serviceId:n.serviceId,parentType:n.parentType,setValObjFromCtx:n.setValObjFromCtx,objectData:n.objectData};u=new d(e),m.addRoot(u),o?(o=o.concat(u),P.selectedItems=o):(o=[u],P.selectedItems=o),m.pushUpdate()}}}};P.addEventListener("drop",(async e=>{let t=JSON.parse(e.dataTransfer.getData("text/plain"));if(e.preventDefault(),e.stopPropagation(),t.data.items&&t.data.items.length>0){let e=[];if(j&&j.selectedItems&&j.selectedItems.length&&j.selectedItems.forEach((t=>{let n=t.options.objectData?t.options.objectData:null;n&&e.push(n)})),n.checkValidObject)var i=await n.checkValidObject({checkId:"Validated",objs:t.data.items,contexts:e&&e.length?e:C?[C]:null});i&&i.length>0&&i.length<t.data.items.length?(n.dropWarningNotif(p.createReview.setSomeValObjectAsValidatedNotif),x(i)):i&&i.length>0?x(i):n.dropWarningNotif(p.createReview.setValObjectAsValidatedNotif)}})),P.addEventListener("onPostRemove",(()=>{if(0===P.selectedItems.length){let e=!0;j&&j.selectedItems&&(j.selectedItems.forEach((t=>{t.options.setValObjFromCtx||(e=!1)})),j&&j.selectedItems&&0===j.selectedItems.length&&e&&(S.show().inject(o),j.show().inject(o),j.selectedItems=P.selectedItems,v&&w&&(T=W(v,j.selectedItems,T,w)),I&&D&&(O=W(I,j.selectedItems,O,D))))}})),M.onclick=function(){n.searchObjs({roleType:j&&j.selectedItems&&j.selectedItems.length?j.selectedItems[0].options.type:"",onSearchOkButtonClicked:async function(e){let t=e.data.items;if(t&&t.length>0){let e=[];if(j&&j.selectedItems&&j.selectedItems.length&&j.selectedItems.forEach((t=>{let n=t.options.objectData?t.options.objectData:null;n&&e.push(n)})),n.checkValidObject)var i=await n.checkValidObject({checkId:"Validated",objs:t,contexts:e&&e.length?e:C?[C]:null});i&&i.length>0&&i.length<t.length?(n.dropWarningNotif(p.createReview.setSomeValObjectAsValidatedNotif),x(i)):i&&i.length>0?x(i):n.dropWarningNotif(p.createReview.setValObjectAsValidatedNotif)}}})},!n.multipleReviews&&n.contexts?1===n.contexts.length&&n.contexts[0].setValidatedObjFromContext?"R3M"===t.mode?(M.inject(h),P.inject(h)):(i(h,n.contexts[0].subContextId?n.contexts[0].subContextIcon:n.contexts[0].iconItem,n.contexts[0].subContextId?n.contexts[0].subContextTitle:n.contexts[0].labelItem),R=n.contexts[0].subContextId?n.contexts[0].subContextId:n.contexts[0].valueItem):1!==n.contexts.length?n.contexts&&n.contexts.length>0&&n.contexts[0].setValidatedObjFromContext?(i(h,n.contexts[0].subContextId?n.contexts[0].subContextIcon:n.contexts[0].iconItem,n.contexts[0].subContextId?n.contexts[0].subContextTitle:n.contexts[0].labelItem),R=n.contexts[0].subContextId?n.contexts[0].subContextId:n.contexts[0].valueItem):(M.inject(h),P.inject(h)):1!==n.contexts.length||n.contexts[0].setValidatedObjFromContext||(M.inject(h),P.inject(h)):n.contexts&&(M.inject(h),P.inject(h)),y=new e.Element("div",{text:p.createReview.changeAction,class:"add-dmu-creation-label"}),b=e.createElement("div",{class:"add-dmu-creation-multi-div-search"}).inject(n.parentDiv),k=new e.Element("span",{class:"fonticon fonticon-search dmu-dmu-creation-field-search"});let U=new c,E=null,N=null;V=new l({elementsTree:function(e){return new Promise((function(t){f&&clearTimeout(f),f=setTimeout((async function(){let i=await n.getObjs({text:e,roleType:"Change Action"});U.empty(),U.prepareUpdate();var a=V.selectedItems;let o=null,s=[];i.forEach((e=>{e.id&&s.push(e.id)})),o=await n.getAdditionalObjInfo({ids:s});for(let e=0;e<i.length;e++){o&&o.length&&(N=o[e].objectIconUrl);var r=[];if(a&&a.length>0&&(r=a.filter((t=>"change action"===i[e].type.toLowerCase()?t.options.identifier===i[e].identifier:t.options.identifier===i[e].id))),(!a||0===a.length||0===r.length)&&"change action"===i[e].type.toLowerCase()){let t={label:i[e].label,plmID:i[e].id,value:i[e].identifier,name:i[e].label,identifier:i[e].identifier,type:i[e].type.toLowerCase(),icon:N};E=new d(t),U.addRoot(E)}}U.pushUpdate(),t(U)}),1e3)}))},getChipInfo:function(e){return{label:e.options.label,icon:e.options.icon}},placeholder:p.createReview.autoCompletePlaceHolder,customFilterMessage:p.createReview.noCASearchFound,multiSearchMode:!0,allowFreeInputFlag:!1,minLengthBeforeSearch:3,keepSearchResultsFlag:!1}),"R3V"===n.mode&&C&&"R2V_Activity"===C.type||(y.inject(b),k.inject(b),V.inject(b),V.getContent().addClassName("add-dmu-creation-Item"),V.getContent().getChildren()[0].addClassName("dmu-autoCompleteChecksSelectionChip"),V.getContent().getElementsByClassName("wux-controls-autoComplete-editor")[0].setStyle("min-width","180px"));var L=async function(t){let i=null,a=null,o=null;var s=null,r=null;if(!t["dswebux/x-controls.selectionchips.items+json"])for(s=0;s<t.length;s++){let l=t[s];if(1!==t.length){n.dropWarningNotif(p.createReview.setChgActNotif);break}if("change action"!==l.objectType.toLowerCase()){n.dropWarningNotif(p.createReview.setDefaultChgActNotif);break}{o=V.selectedItems,a=l.objectId;let c=null;if(a&&(c=await n.getAdditionalObjInfo({ids:[a]})),c&&(N=c[s].objectIconUrl),o&&o.length>0){for(V.selectedItems=[],r=0;r<o.length&&o[r].options.id!==a;r++)if(e.is(t)&&e.is(t.length)&&t.length>0){U.prepareUpdate(),i=l.displayName;let e={label:i,name:l.displayName,type:l.objectType,id:l.objectId,icon:N};E=new d(e),U.addRoot(E),o?(o=o.concat(E),V.selectedItems=o):(o=[E],V.selectedItems=o),U.pushUpdate();break}}else if(e.is(t)&&e.is(t.length)&&t.length>0){U.prepareUpdate(),i=l.displayName;let e={label:i,name:l.displayName,type:l.objectType,id:l.objectId,icon:N};E=new d(e),U.addRoot(E),o?(o=o.concat(E),V.selectedItems=o):(o=[E],V.selectedItems=o),U.pushUpdate()}}}};if(V.addEventListener("change",(()=>{let e=!1;j&&j.selectedItems&&V.selectedItems.length>0&&(j&&j.selectedItems&&1===j.selectedItems.length&&(e=j.selectedItems.some((e=>"R2V_Activity"===e.options.type))),e&&(V.selectedItems=[],n.dropWarningNotif(p.createReview.setChgActCtxNotif))),V.selectedItems.length>0&&(V.selectedItems=[V.selectedItems[V.selectedItems.length-1]])})),V.addEventListener("drop",(e=>{let t=JSON.parse(e.dataTransfer.getData("text/plain"));if(e.preventDefault(),e.stopPropagation(),t.data.items&&1===t.data.items.length){let e=!1;if(j&&j.selectedItems&&1===j.selectedItems.length&&(e=j.selectedItems.some((e=>"R2V_Activity"===e.options.type))),e)n.dropWarningNotif(p.createReview.setChgActCtxNotif);else{var i=t.data.items;L(i)}}})),k.onclick=function(){n.searchObjs({roleType:"Change Action",onSearchOkButtonClicked:function(e){var t=e.data.items;let i=!1;j&&j.selectedItems&&1===j.selectedItems.length&&(i=j.selectedItems.some((e=>"R2V_Activity"===e.options.type))),i?n.dropWarningNotif(p.createReview.setChgActCtxNotif):L(t)}})},n.caObj){let e={label:n.caObj.labelItem,plmID:n.caObj.valueItem,name:n.caObj.labelItem,type:n.caObj.type,icon:n.caObj.iconItem};U.prepareUpdate(),E=new d(e),U.addRoot(E),U.pushUpdate(),V.selectedItems=[U.getRoots()[0]]}},X=function(){var e=[],t=[],n=[],i=[],a=null,o=null;if(!(f&&f.coordinatorsAutoComplete&&f.assigneesAutoComplete&&f.contributorsAutoComplete&&f.informedUsersAutoComplete))return{};if(void 0!==f.coordinatorsAutoComplete.selectedItems)for(o=0;o<f.coordinatorsAutoComplete.selectedItems.length;o++){let t=f.coordinatorsAutoComplete.selectedItems[o].options;a={user:t.identifier,type:t.type,plmID:t.plmID?t.plmID:t.id},e.push(a)}if(void 0!==f.assigneesAutoComplete.selectedItems)for(o=0;o<f.assigneesAutoComplete.selectedItems.length;o++){let e=f.assigneesAutoComplete.selectedItems[o].options;a={user:e.identifier,type:e.type,plmID:e.plmID?e.plmID:e.id},t.push(a)}if(void 0!==f.contributorsAutoComplete.selectedItems)for(o=0;o<f.contributorsAutoComplete.selectedItems.length;o++){let e=f.contributorsAutoComplete.selectedItems[o].options;a={user:e.identifier,type:e.type,plmID:e.plmID?e.plmID:e.id},n.push(a)}if(void 0!==f.informedUsersAutoComplete.selectedItems)for(o=0;o<f.informedUsersAutoComplete.selectedItems.length;o++){let e=f.informedUsersAutoComplete.selectedItems[o].options;a={user:e.identifier,type:e.type,plmID:e.plmID?e.plmID:e.id},i.push(a)}return e.length>0||t.length>0||n.length>0||i.length>0?(f.coordinatorsAutoComplete.selectedItems=f.assigneesAutoComplete.selectedItems=f.contributorsAutoComplete.selectedItems=f.informedUsersAutoComplete.selectedItems=void 0,function(e,t,n,i){const a={coordinatorsTab:e,assigneesTab:t,contributorsTab:n,informedusersTab:i};return Object.fromEntries(Object.entries(a).filter((([,e])=>e.length>0)).map((([e,t])=>[e.replace("Tab",""),{add:t}])))}(e,t,n,i)):{}},J=function(t){let n;N.markup={},N.markup.title=t.markupTitle,D=t.markupTitle;let i,a=function(t){L=""===t.value;let i=E||L;"markupTitle"===t.id&&(Y.disabled=i,Z&&(Z.disabled=i)),Y.disabled||("markupTitle"===t.id?N.markup.title=t.value:"markupDescription"===t.id&&(N.markup.description=t.value)),e.createElement("span",{class:"wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-required wux-ui-3ds-lg"}).setStyles({color:"#E87B00",display:"inline-block","font-weight":"bold"}),"markupTitle"===t.id&&(L?(g&&(g.tabBar.buttonGroup.getButton(g.value[0]).icon={iconName:"required",fontIconFamily:WUXManagedFontIcons.Font3DS},g.tabBar.buttonGroup.getButton(g.value[0]).elements.button.getChildren()[0].getChildren()[0].setStyles({color:"#E87B00","font-weight":"bold"})),n&&n.getChildren()[0].removeClassName("add-dmu-creation-errorIcon-hide")):(g&&(g.tabBar.buttonGroup.getButton(g.value[0]).icon={iconName:"doc",fontIconFamily:WUXManagedFontIcons.Font3DS}),n&&n.getChildren()[0].addClassName("add-dmu-creation-errorIcon-hide")))};"Activated"===t.restrictedAccess?i=p.createReview.restrictedEditionActivated:"Deactivated"===t.restrictedAccess&&(i=p.createReview.restrictedEditionDeactivated),I=e.createElement("div",{class:"add-dmu-creation-multi-div"}).inject(t.parentDiv),n=new e.Element("div",{class:"add-dmu-creation-label"}).inject(I),e.createElement("span",{class:"add-dmu-creation-errorIcon wux-ui-3ds wux-ui-3ds-error add-dmu-creation-errorIcon-hide"}).inject(n),e.createElement("span",{text:p.createReview.nameLabel}).inject(n),t.multipleReviews||e.createElement("span",{class:"add-dmu-creation-mandIcon wux-ui-3ds wux-ui-3ds-new-create"}).inject(n),O=new s({placeholder:p.createReview.namePlaceholder,value:t.multipleReviews&&t.contexts&&t.contexts.length>1?p.createReview.multiReviewsNaming+" ("+t.contexts.length+")":t.markupTitle,selectAllOnFocus:!0,maxLength:100,autoCommitFlag:!0,disabled:t.multipleReviews&&t.contexts&&t.contexts.length>1}).inject(I),O.getContent().addClassName("add-dmu-creation-Item"),O.elements.container.setStyles({width:"100%"}),O.elements.container.childNodes[0].setStyles({width:"100%"}),O.addEventListener("change",(()=>{a({value:O.value,id:"markupTitle"})}));let r=e.createElement("div",{class:"add-dmu-creation-multi-div"}).inject(t.parentDiv);new e.Element("div",{text:p.createReview.descriptionLabel,class:"add-dmu-creation-label"}).inject(r);var l=new o({nbRows:5,newLineMode:"shiftEnter",placeholder:p.createReview.descriptionPlaceholder,selectAllOnFocus:!0,maxLength:256,autoCommitFlag:!0}).inject(r);if(l.getContent().addClassName("add-dmu-creation-Item"),l.elements.container.setStyles({width:"100%"}),l.elements.container.childNodes[0].setStyles({width:"100%"}),l.addEventListener("change",(()=>{a({value:l.value,id:"markupDescription"})})),t.restrictedAccess){let n=e.createElement("div",{class:"add-dmu-creation-multi-div"}).inject(t.parentDiv);new e.Element("div",{text:p.createReview.restrictedEditionLabel,class:"add-dmu-creation-label"}).inject(n),new e.Element("div",{text:i,class:"add-dmu-creation-Item"}).inject(n)}},G=e.createElement("div",{class:"DMUCreateReviewPanelMainDiv"});if("R3R"!==t.mode||t.markupCreation)if(t.markupTabOnly)J({parentDiv:G,markupTitle:t.inputInfos.markupTitle});else{var z=e.createElement("div",{class:"DMUCreateReviewTab"}).inject(G);g=new r({displayStyle:"strip"}),g.inject(z),q=z;let n=e.createElement("div",{class:"DMUCreateReviewPanelTab"});if(B({parentDiv:n,reviewTitle:t.inputInfos.reviewTitle,contexts:t.inputInfos.contexts,multipleReviews:t.inputInfos.multipleReviews,restrictedAccess:t.inputInfos.restrictedAccess,mode:t.mode}),g.add({label:p.createReview.labelReview,content:n,icon:{iconName:"review",fontIconFamily:WUXManagedFontIcons.Font3DS}}),"R3R"!==t.mode&&t.inputInfos.contexts&&t.inputInfos.contexts.length>0){let n=e.createElement("div",{class:"DMUCreateReviewPanelTab"});H({searchObjs:t.searchObjs,getObjs:t.getObjs,validatedObjects:t.inputInfos.validatedObjects,checkValObj:t.checkValidatedObject,checkValidObject:t.checkValidObject,getAdditionalObjInfo:t.getAdditionalObjInfo,parentDiv:n,contexts:t.inputInfos.contexts,caObj:t.inputInfos.caObject,multipleReviews:t.inputInfos.multipleReviews,mode:t.mode,dropWarningNotif:t.dropWarningNotification,reviewTitle:t.inputInfos.reviewTitle,markupTitle:t.inputInfos.markupTitle}),g.add({label:p.createReview.labelObjects,content:n,icon:{iconName:"6w-what",fontIconFamily:WUXManagedFontIcons.Font3DS}})}else if("R3M"===t.mode&&t.inputInfos.contexts&&0===t.inputInfos.contexts.length){let n=e.createElement("div",{class:"DMUCreateReviewPanelTab"});H({searchObjs:t.searchObjs,getObjs:t.getObjs,checkValObj:t.checkValidatedObject,checkValidObject:t.checkValidObject,getAdditionalObjInfo:t.getAdditionalObjInfo,parentDiv:n,contexts:t.inputInfos.contexts,caObj:t.inputInfos.caObject,multipleReviews:t.inputInfos.multipleReviews,mode:t.mode,dropWarningNotif:t.dropWarningNotification,reviewTitle:t.inputInfos.reviewTitle,markupTitle:t.inputInfos.markupTitle}),g.add({label:p.createReview.labelObjects,content:n,icon:{iconName:"6w-what",fontIconFamily:WUXManagedFontIcons.Font3DS}})}if("R3R"!==t.mode){let n=e.createElement("div",{class:"DMUCreateReviewPanelTab"});!async function(t){var n=e.createElement("div",{class:"add-dmu-creation-multi-div-search"}).inject(t.parentDiv);new e.Element("div",{text:p.createReview.chkListTitle,class:"add-dmu-creation-label"}).inject(n);var i=new e.Element("span",{class:"fonticon fonticon-search dmu-dmu-creation-field-search"}).inject(n),a=new c,o=null;let s=null;U=new l({elementsTree:function(e){return new Promise((function(n){s&&clearTimeout(s),s=setTimeout((async function(){let i=null,s=await t.getObjs({text:e,roleType:"Requirement"});a.empty(),a.prepareUpdate();var r=U.selectedItems;let l=null,c=[];s.forEach((e=>{e.id&&c.push(e.id)})),l=await t.getAdditionalObjInfo({ids:c});for(let e=0;e<s.length;e++){l&&l.length&&(i=l[e].objectIconUrl);var m=[];if(r&&r.length>0&&(m=r.filter((t=>"requirement"===s[e].type.toLowerCase()||"requirement specification"===s[e].type.toLowerCase()||"chapter"===s[e].type.toLowerCase()?t.options.identifier===s[e].identifier:t.options.identifier===s[e].id))),!(r&&0!==r.length&&0!==m.length||"requirement"!==s[e].type.toLowerCase()&&"requirement specification"!==s[e].type.toLowerCase()&&"chapter"!==s[e].type.toLowerCase())){let t={label:s[e].label,plmID:s[e].id,value:s[e].identifier,name:s[e].label,identifier:s[e].identifier,type:s[e].type.toLowerCase(),icon:i};o=new d(t),a.addRoot(o)}}a.pushUpdate(),n(a)}),1e3)}))},getChipInfo:function(e){return{label:e.options.label,icon:e.options.icon}},placeholder:p.createCheck.typeToSearch,customFilterMessage:p.createCheck.noSearchFound,multiSearchMode:!0,allowFreeInputFlag:!1,minLengthBeforeSearch:3,keepSearchResultsFlag:!1}).inject(n),U.getContent().addClassName("add-dmu-creation-Item-WithIcon"),U.getContent().getChildren()[0].addClassName("dmu-autoCompleteSelectionChip"),U.getContent().getElementsByClassName("wux-controls-autoComplete-editor")[0].setStyle("min-width","180px"),U.selectedItems||(U.selectedItems=[]);let r=[];if(a.empty(),a.prepareUpdate(),t&&t.reqs&&t.reqs&&t.reqs.length>0){let e=[],n=[];t.reqs.forEach((t=>{!t.sRequirementDocId||t.iconItem&&t.objectType?t.iconItem&&t.objectType&&e.push({objectIconUrl:t.iconItem,objectType:t.objectType}):n.push(t.sRequirementDocId)})),n.length&&0===e.length&&(e=await t.getAdditionalObjInfo({ids:n}));for(let n=0;n<t.reqs.length;n++){let i={label:t.reqs[n].sName,id:t.reqs[n].sRequirementDocId,name:t.reqs[n].sName,type:e&&e.length?e[n].objectType:"unknown",icon:e&&e.length?e[n].objectIconUrl:"unknown"};o=new d(i),a.addRoot(o),r.push(a.getRoots()[n])}}a.pushUpdate(),U.selectedItems=r;var m=async function(n){let i=null,s=null,r=null,l=null;var c=null,m=null;if(!n["dswebux/x-controls.selectionchips.items+json"]){let u=null,g=[];for(n.forEach((e=>{e.objectId&&g.push(e.objectId)})),u=await t.getAdditionalObjInfo({ids:g}),c=0;c<n.length;c++){let g=n[c];if("requirement"===g.objectType.toLowerCase()||"requirement specification"===g.objectType.toLowerCase()||"chapter"===g.objectType.toLowerCase()){if(l=U.selectedItems,r=g.objectId,u&&(s=u[c].objectIconUrl),l&&l.length>0){for(m=0;m<l.length&&l[m].options.id!==r;m++)if(e.is(n)&&e.is(n.length)&&n.length>0){a.prepareUpdate(),i=g.displayName;let e={label:i,name:g.displayName,type:g.objectType,id:g.objectId,icon:s};o=new d(e),a.addRoot(o),l?(l=l.concat(o),U.selectedItems=l):(l=[o],U.selectedItems=l),a.pushUpdate();break}}else if(e.is(n)&&e.is(n.length)&&n.length>0){a.prepareUpdate(),i=g.displayName;let e={label:i,name:g.displayName,type:g.objectType,id:g.objectId,icon:s};o=new d(e),a.addRoot(o),l?(l=l.concat(o),U.selectedItems=l):(l=[o],U.selectedItems=l),a.pushUpdate()}}else t.dropWarningNotif(p.createReview.setDefaultNotif)}}};i.onclick=function(){t.searchObjs({roleType:"Requirement",onSearchOkButtonClicked:function(e){var t=e.data.items;m(t)}})};let u=null;U.addEventListener("drop",(e=>{if(u=JSON.parse(e.dataTransfer.getData("text/plain")),e.preventDefault(),e.stopPropagation(),u.data.items){var t=u.data.items;m(t)}}))}({searchObjs:t.searchObjs,getObjs:t.getObjs,getAdditionalObjInfo:t.getAdditionalObjInfo,parentDiv:n,reqs:t.inputInfos.reqs,dropWarningNotif:t.dropWarningNotification}),g.add({label:p.createReview.labelCheck,content:n,icon:{iconName:"check-review",fontIconFamily:WUXManagedFontIcons.Font3DS}});let i=e.createElement("div",{class:"DMUCreateMembersPanelReviewTab"});$={getAdditionalMembersInfo:t.getAdditionalMembersInfo,parentDiv:i,membersTitle:t.inputInfos.membersTitle,searchMember:t.searchMember,getMembers:t.getMembers,members:t.inputInfos.members,mode:t.mode,getUserName:t.getUserName,dropWarningNotif:t.dropWarningNotification},f=new u,f.buildAdditionDiv({getMembers:function(e){return $.getMembers(e)},searchMember:function(e){return $.searchMember(e)},mode:$.mode,dropWarningNotif:$.dropWarningNotif,getUserName:$.getUserName,additionalMembersInfo:$.getAdditionalMembersInfo,retrievedCoordinators:$.members?$.members.coordinators:null,retrievedAssignees:$.members?$.members.assignees:null,retrievedContributors:$.members?$.members.contributors:null,retrievedInformedUsers:$.members?$.members.informedUsers:null}),f.globalDiv.inject($.parentDiv),g.add({label:p.createReview.labelMember,content:i,icon:{iconName:"fonticon fonticon-wux-ui-3ds-review wux-ui-3ds-users DMUCreateMembersPanelIcon",fontIconFamily:WUXManagedFontIcons.Font3DS}})}if(t.markupCreation){let n=e.createElement("div",{class:"DMUCreateReviewPanelTab"});J({parentDiv:n,markupTitle:t.inputInfos.markupTitle,contexts:t.inputInfos.contexts,multipleReviews:t.inputInfos.multipleReviews,restrictedAccess:t.inputInfos.restrictedAccess}),g.add({label:p.createReview.labelMarkup,content:n,icon:{iconName:"markup-review",fontIconFamily:WUXManagedFontIcons.Font3DS}})}g.value=[0],g.tabBar.centeredFlag=!1}else B({parentDiv:G,reviewTitle:t.inputInfos.reviewTitle,contexts:t.inputInfos.contexts,restrictedAccess:t.inputInfos.restrictedAccess,mode:t.mode}),q=G;var $;if(t.warningStyle&&q){var K=e.createElement("p",{class:"DMUCreateMarkupPanelLabel"}).inject(q);K.innerHTML=p.createReview.warningMessage,K.setStyles({color:"#e87b00","font-weight":"normal","font-style":"italic",margin:"0","margin-top":"10px"})}function Q(e,n){return new i({label:e,onClick:function(){N.review={title:w,description:x},N.validatedObjects=function(){let e=[];return P&&P.selectedItems?(P.selectedItems.forEach((t=>{let n=t.options,i=n.plmID?n.plmID:n.id;e.push(i)})),e):R?(e.push(R),e):[]}(),N.changeAction=function(){if(!V||!V.selectedItems||!V.selectedItems[0].options)return null;let e=V.selectedItems[0].options;return e.plmID?e.plmID:e.id}(),N.contexts=function(){let e=[];return j&&j.selectedItems?(j.selectedItems.forEach((t=>{let n=t.options,i={valueItem:n.plmID?n.plmID:n.id,type:n.type,labelItem:n.label,serviceId:n.serviceId,data:n.objectData};e.push(i)})),e):C?(e.push(C),e):[]}(),N.multipleReviews="R3M"===t.mode&&N.contexts.length>1,N.maturity=n,N.checks=function(){if(!U||!U.selectedItems)return[];let e=[];return U.selectedItems.forEach((t=>{let n=t.options,i={reqId:n.plmID?n.plmID:n.id,reqName:n.name,reqType:n.type.toLowerCase()};e.push(i)})),e}(),N.members=X(),t.onOK(N)}})}let Y=Q(p.createReview.createreviewButton,"InWork");t.markupTabOnly?Y.getContent().addClassName("reviewMarkupCreationButton"):Y.getContent().addClassName("reviewCreationButton");let Z=null;t.saveAsDraft&&!t.markupTabOnly&&(Z=Q(p.createReview.saveAsDraftButton,"Draft"));let ee=new i({label:p.createReview.cancelButton,onClick:t.onCancel}),te=p.createReview.panelValidationTitle;t.markupTabOnly?te=p.createReviewMarkup.panelTitle:"R3R"===t.mode&&(te=p.createReview.panelTitle);let ne=new n({modalFlag:!0,ensureHeightDefinitionOnHierarchy:!0,title:te,resizableFlag:!0,immersiveFrame:t.frame,position:m.getTouchMode()?{my:"center bottom"}:void 0,buttons:t.saveAsDraft&&!t.markupTabOnly?{Ok:Y,Apply:Z,Cancel:ee}:{Ok:Y,Cancel:ee},width:500,content:G});t.warningStyle&&(Y.emphasize="medium-attention",Y.icon={iconName:"warning",fontIconFamily:WUXManagedFontIcons.font3DS},Z&&(Z.emphasize="medium-attention",Z.icon={iconName:"warning",fontIconFamily:WUXManagedFontIcons.font3DS})),ne.addEventListener("close",(function(){t.onClose()})),this.destroy=function(){ne&&(ne.destroy(),ne=null)}}})})),define("DS/DMUReviewPersistence/DMUAddHighlightCmd",["DS/CATWebUXComponents/DMUCommand","DS/CATWebUXComponents/CATWebUXNotification","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/EXPManagerSet","DS/DMUBaseUIControllers/DMUCommentsController","DS/DMUBaseExperience/EXPToolsContext","DS/DMUMeasurable/DMUToolsSceneGraph","DS/Selection/CSOManager","DS/DMUReviewPersistence/DMUAuthReviewPersistenceServices","i18n!DS/DMUReviewPersistence/assets/nls/DMUReviewPersistence"],(function(e,t,n,i,a,o,s,r,l,c){"use strict";return e.extend({init:function(e){e.mode="shared",e.repeatMode=!1,e.isAsynchronous=!0,this._parent(e);var d,m,u,p,g=this,f=e.frameWindow||this.getFrameWindow(),h=f.getViewer(),v=null,I=null;function b(){m||(m=new t),m.build({type:"error",autoHide:!0,message:c.createHighlight.errorMessage,body:f.getUIFrame()}),d&&d.fireEvent("onHighlightCreationFailed")}function C(){(I=new t).build({body:f.getUIFrame(),type:"info",notificationType:"HelpNotification",message:c.createHighlight.selectHighlight}),v=r.onAdd((function(){let e,t=r.get();if(t.length>0&&u&&t.length&&"DMUComment"===t[0].pathElement.getLastElement().getDMUType()){let n=u.getDMUObjectFromPathElement(t[0].pathElement);n&&n.getParent&&n.getParent()&&n.getParent().getMarkupOwner&&(e=n.getParent().getMarkupOwner()),e.getCommentStatus(n.getAttribute("sUuid"))||n.isExternal()?r.empty():g._createNewHighlight(n,e,!0)}}))}this._createNewHighlight=function(e,t,i){var a=n.getReviewContext({viewer:f.getViewer()}),r=a.getValidation(),m=this.options.arguments.length&&this.options.arguments[0].Rating?this.options.arguments[0].Rating:"";if(e&&e.getParent()){var u,p="";d=n.giveEventsController({viewer:h});let i=a.getValidation().getContext().getJsonContextTypes()[0],f=o.getParentType(i)?o.getParentType(i):i;if("DMUComment"===e.getType()){var v=e.getAttribute("sTextContents");for(let t=0;t<v.length;t++){var I=e.getTextContent();p+=I,t<v[t].length-1&&(p+="\n")}if(r.getAllRepRefs().forEach((t=>{let n=t.getMarkupContent();if(n){let t=n.getComments();t&&t.forEach((t=>{if(t.getAttribute("sParentCommentId")===e.getAttribute("sUuid")){var n=t.getAttribute("sTextContents");for(let e=0;e<n.length;e++){var i=t.getTextContent();p+="\n",p+=i}}}))}})),"Requirement"===f)u=r.getContext().getJsonContextNames()[0];else if("Document"===f){var C=e.getNode().getParents();let t=s.buildPathElement(C[0]),n=a.getDMUObjectFromPathElement(t).getAttribute("fPointedPageNumber");u=r.getContext().getJsonContextNames()[0]+"-"+c.page+" "+n}}l.addHighlight({iCtxViewer:n.getContextViewer({viewer:h}),validation:r,highlightRating:m,description:p,highlightName:u,markupRepRef:t,slide:e,onHighlightCreationCompleted:function(){g._endExecute()},onHighlightCreationFailed:function(){b(),g._endExecute()}})}else!1===i&&b(),g._endExecute()},this.beginExecute=function(){var e,t=n.getReviewContext({viewer:f.getViewer()}).getValidation();(p=t&&t.getCurrentMarkup())||(b(),this._endExecute());var o="ReviewMarkup"===p.getValType()?t.getCurrentMarkup():t.getCurrentMarkup().getRepRef();u=a.giveDMUCommentsController({context:f});let s=i.getManager({name:"DMU2DSheetManager",context:g.getFrameWindow()});if((e=r.get()).length&&u)for(let t=0;t<e.length;t++)if("DMUComment"===e[t].pathElement.getLastElement().getDMUType()){let n=u.getDMUObjectFromPathElement(e[t].pathElement);const i=n.getParent();((i&&i.getMarkupOwner()).getCommentStatus(n.getAttribute("sUuid"))||n.isExternal())&&(r.remove({pathElement:e[t].pathElement}),t--)}if((e=r.get()).length>0&&"DMUComment"===e[0].pathElement.getLastElement().getDMUType()){if(1!==e.length)return r.empty(),C();let t=u.getDMUObjectFromPathElement(e[0].pathElement);t&&t.getParent&&t.getParent()&&t.getParent().getMarkupOwner&&(o=t.getParent().getMarkupOwner()),g._createNewHighlight(t,o,!0)}else if(!s||"Requirement"!==s.getDocumentType()&&"Document"!==s.getDocumentType()){let e=o.getMarkupContent()&&o.getMarkupContent().getSlides().length>0?o.getMarkupContent().getCurrentSlide():null;g._createNewHighlight(e,o,!1)}else u.setCommentUnselectableFlags(!0),C()},this.cancelExecute=function(){this._endExecute()},this._endExecute=function(){r.unsubscribe(v),u&&u.setCommentUnselectableFlags(!1),I&&I.destroy(),this.cancel()},this.destroy=function(){this._endExecute()}}})})),define("DS/DMUReviewPersistence/DMUMarkCommentStatusCmd",["require","exports","DS/Selection/CSOManager","DS/DMUReviewPersistence/DMUAuthReviewPersistenceServices","DS/DMUBaseExperience/DMUContextManager","DS/DMUControls/DMUWarningPanel","DS/DMUBaseExperience/EXPUtils","DS/CATWebUXComponents/CATWebUXNotification","DS/DMUBaseUIControllers/DMUCommentsController","i18n!DS/DMUReviewPersistence/assets/nls/DMUReviewPersistence"],(function(e,t,n,i,a,o,s,r,l,c){"use strict";return class{constructor(e){this.beginExecute=function(){const t=e.args.status;let d,m=null,u=null,p=this,g=[];const f=function(){m&&(m=null),u&&(u=null),p.done()},h=e.executionContext.getComponent("Viewer"),v=h.getViewer(),I=h.getFrameWindow(),b=l.giveDMUCommentsController({context:I}),C=a.getEventsController({viewer:I.getViewer()}),w=a.getReviewContext({viewer:v}).getValidation();if(!b)return window.console.error("[DMUMarkCommentStatusCmd] Cannot mark comment - Comment Controller undefined"),f();if(d=n.get(),!d||0===d.length)return void f();const D=function(){let e=()=>{g.forEach((e=>{b.setCommentLoading(e.getAttribute("sUuid"),!1),e.fireEvent("onDMUObjectVisuRefreshRequired",{dmuObject:e})})),f()},n=()=>{let e=!1,n=[];g.forEach((i=>{b.setCommentLoading(i.getAttribute("sUuid"),!1),i.fireEvent("onDMUObjectVisuRefreshRequired",{dmuObject:i});const a=i.getAttribute("sUuid"),o=i.getParent(),s=o&&o.getMarkupOwner(),r=s.getCommentStatus(a)?s.getCommentStatus(a):null;n.push({comment:i,status:r}),r!==t&&(e=!0)})),C.fireEvent("onCommentStatusChanged",{commentsList:n}),e&&(u||(u=new r),u.build({type:"warning",autoHide:!0,message:`${c.markComment.unableToMark}`,body:I.getUIFrame()})),s._sendUsageProbe("command","CommentStatus_"+(t||"clear")+(g.length>1?"_multicomments":"")),f()};d.forEach((e=>{let n=null==b?void 0:b.getDMUObjectFromPathElement(e.pathElement);if(n&&(n.isReply()&&(n=n.getParent()),0===n.getAssociatedHighlightData().length)){const e=n.getAttribute("sUuid"),i=n.getParent(),a=(i&&i.getMarkupOwner()).getCommentStatus(e);(t&&!a||!t&&a)&&(g.includes(n)||(b.setCommentLoading(e,!0),g.push(n)))}}));const a=g.reduce(((e,t)=>{const n=t.getAttribute("sUuid"),i=null==b?void 0:b.getMarkupIdFromCommentId(n);return e[i]||(e[i]=[]),e[i].push(n),e}),{});0!==Object.keys(a).length?t?i.setCommentStatus({viewer:v,validation:w,commentsID:a,commentStatus:t,onSetCommentStatusSuccess:n,onSetCommentStatusFailed:e}):i.removeCommentStatus({viewer:v,validation:w,commentsID:a,onRemoveCommentStatusSuccess:n,onRemoveCommentStatusFailed:e}):f()};t?D():m||(m=new o({className:"DMUWarningPanelRoot",title:c.markComment.clearStatusWarningPanel.title,message:c.markComment.clearStatusWarningPanel.message,okLabel:c.markComment.clearStatusWarningPanel.okLabel,frmWindow:I,callbacks:{onValidateCB:D,onCancelCB:f,onCloseCB:f}}))}}}})),define("DS/DMUReviewPersistence/DMUUpdateValidatedListCmd",["DS/CATWebUXComponents/DMUCommand","DS/CATWebUXComponents/CATWebUXNotification","DS/DMUBaseExperience/DMUContextManager","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/Visualization/PathElement","DS/DMUMeasurable/DMUToolsSceneGraph","DS/CATWebUXComponents/CATWebUXNotifBar","DS/DMUReviewPersistence/DMUAuthReviewPersistenceServices","DS/DMUBaseExperience/EXPToolsContext","i18n!DS/DMUReviewPersistence/assets/nls/DMUReviewPersistence"],(function(e,t,n,i,a,o,s,r,l,c,d){"use strict";return e.extend({init:function(e){e.mode="shared",e.repeatMode=!1,e.isAsynchronous=!0;var m,u=null,p=null,g=this;this._parent(e);let f=e.args;if(f){let e=Object.keys(f),t=Object.values(f);this.options.arguments=[],this.options.arguments[0]={};for(let n=0;n<e.length-1;n++)this.options.arguments[0][e[n]]=t[n]}var h,v,I=e.frameWindow||this.getFrameWindow();function b(){i.unsubscribe(u),i.unsubscribe(p),m&&m.destroy(),g.cancel()}this.contextIsAPart=function(){var e=n.getReviewContext({viewer:I.getViewer()}),t=n.getContextViewer({viewer:I.getViewer()}).getController(),i=!0;let a=e.getValidation().getContext().getJsonContextTypes()[0];if("VPMReference"!==(c.getParentType(a)?c.getParentType(a):a))i=!1;else{var s=e.getValidation().getContext().getJsonContexts()[0].id,r=[],l=t.getNode({id:s});r.push(l);var d=new o(r);if(i=d,d.externalPath.length)for(var m=d.externalPath[0].getChildren(),u=0;u<m.length;u++)m[u].userData&&"VPMInstance"===m[u].userData.type&&(i=!1)}return i},this._isValidatedDuplicated=function(e){var t=n.getReviewContext({viewer:I.getViewer()}).getValidation().getValidated().getPathElements();for(let n=0;n<t.length;n++)if(s.getIdPath(e).equals(t[n].pathElement))return!0;return!1},this.getLastInstance=function(e){return e.getLength()>1?s.isInstance(e.getLastElement(!0))&&!s.isRepInstance(e.getLastElement(!0))?e.clone():this.getLastInstance(e.getParentPath()):new o},this._createNewValidated=function(e){var i=n.getReviewContext({viewer:I.getViewer()}),a=i.getValidation().getValidated().getPathElements(),o=e.validatedPath,s=[],r=[];let l=this.options.arguments[0].Value;var c=function(e){var t=[];if(e)if(e.length>1)for(var n=1;n<e.length-1;)t.push(e[n]),n+=2;else 1===e.length&&t.push(e[0]);return t},m=-1;for(let n=0;n<a.length;n++){for(let i=0;i<e.validatedPath.length;i++)(e.refFullPath[i].equals(a[n].pathElement)||e.validatedPath[i].equals(a[n].pathElement))&&("add"===l&&(v||(v=new t),v.build({type:"information",autoHide:!0,message:d.updateValidatedListCmd.ValidatedExist,body:I.getUIFrame()})),m=n);m!==n?s.push(c(a[n].pathElement)):a.length&&a[n]&&r.push(a[n].instanceName?a[n].instanceName:void 0),m=-1}if("add"===l)for(let e=0;e<o.length;e++)s.push(c(o[e]));return{validatedObjects:s,validatedId:i.getValidation().getValidated().getPlmID()?i.getValidation().getValidated().getPlmID():null,instanceNames:r}},this.beginExecute=function(){h=I.getViewer();var e=[],t=g.contextIsAPart(),f=[],v=[],C=[],w=[],D=[],y=function(){let r,d=[],m=i.get(),u=n.getReviewContext({viewer:I.getViewer()}),p=u.getValidation().getContext().getJsonContextTypes()[0],y=c.getParentType(p)?c.getParentType(p):p,x=n.getContextViewer({viewer:I.getViewer()}).getController(),R=u.getValidation().getContext().getJsonContextIDs()[0],M=u.getValidation().getContext().getJsonContextTypes();if(M&&1===M.length&&"SIMItfSimulation"===M[0]){var S=I.getExecutionContext().getComponent("Viewer");if(S&&S.getApplicativeData){let e=S.getApplicativeData().getLoadedItfData();e.data&&1===e.data.length&&e.data[0].prd&&1===e.data[0].prd.length&&(R=e.data[0].prd[0])}}let k=x.getNode({id:R}),U=s.buildPathElement(k),V=g.options.arguments[0].Value;if(["Requirement Specification","Requirement","Document","DesignSight","R2V_Activity","DELLmiWorkPlanSystemReference","DELLmiPPRHeaderProcessReferenceAbstract"].includes(y)){let e=u.getValidation().getValidated().getPathElements(),t=[];e.length>0&&e.forEach((e=>{t.push(e.pathElement)})),m.forEach((e=>{if(e.pathElement.getLastElement().getDocInfo)w.push(e.pathElement.getLastElement().getDocInfo().validatedPaths[0]),D.push(e.pathElement.getLastElement().getDocInfo().validatedPaths[0]),t.forEach(((n,i)=>{n[0]===e.pathElement.getLastElement().getDocInfo().validatedPaths[0]&&t.splice(i,1)})),v=e.pathElement.getLastElement().getDocInfo().validatedPaths,f.push(e.pathElement.getLastElement().getDocInfo().validatedPaths);else if(e.pathElement.getLastElement().getReqInfo){const n=e.pathElement.getLastElement().getReqInfo().id;w.push(n),D.push(n),t.forEach(((e,i)=>{e[0]===n&&(v.push(e),t.splice(i,1))}))}else e.pathElement.getLastElement().getModelIdentification&&(w.push(e.pathElement.getLastElement().getModelIdentification()),D.push(e.pathElement.getLastElement().getModelIdentification()),t.forEach(((n,i)=>{n[0]===e.pathElement.getLastElement().getModelIdentification()&&(v.push(n),t.splice(i,1))})))})),r={validatedObjects:t,validatedId:u.getValidation().getValidated().getPlmID(),instanceNames:""}}else{for(let e=0;e<m.length;e++)if(U.isAParentOf(m[e].pathElement)&&m[e].pathElement){let t=m[e].pathElement.getLength(),n=!1,i=!1;for(var j=0;j<t;j++){var P=m[e].pathElement.getElement(j);if(s.isRepReference(P))n=!0;else if(n&&s.isInstance(P)){i=!0;break}}i||d.push(m[e])}if(0===d.length){let e=n.getEventsController({viewer:I.getViewer()});i.empty(),a.empty(),e.fireEvent("onValidatedObjCancelRequested"),g.endExecute()}else{if(d.length>0)for(let n=0;n<d.length;n++){if(d[n].pathElement&&f.push(s.getIdPath(d[n].pathElement)),t&&t.externalPath&&t.externalPath.length)e.push(t);else{e.push(function(e){var t=null;if(e){t=new o;for(var n=1;n<e.getLength();n++){var i=e.getElement(n);if(s.isRepInstance(i))break;t.addElement(i)}}return t}(d[n].pathElement))}"add"!==V||g._isValidatedDuplicated(e[n])?"remove"===V&&(e[n].externalPath&&v.push(s.getIdPath(e[n])),C.push(s.getLastReference(e[n]).getLastElement()),w.push(C[n]?C[n].getModelIdentification():v[n][0]),g.getLastInstance(e[n]).getLastElement()?D.push(g.getLastInstance(e[n]).getLastElement().getModelIdentification()):D.push(w[n])):(e[n].externalPath&&v.push(s.getIdPath(e[n])),C.push(s.getLastReference(e[n]).getLastElement()),w.push(C[C.length-1]?C[C.length-1].getModelIdentification():v[v.length-1][0]),g.getLastInstance(e[n]).getLastElement()?D.push(g.getLastInstance(e[n]).getLastElement().getModelIdentification()):D.push(w[w.length-1]))}if(v.length&&v[0].length&&f.length&&f[0].length)r=g._createNewValidated({validatedPath:v,refFullPath:f});else{let e=n.getEventsController({viewer:I.getViewer()});i.empty(),a.empty(),e.fireEvent("onValidatedObjCancelRequested"),g.endExecute()}}}r&&l.updateValidatedObjectsList({fullPathRefs:f,validatedObjects:r.validatedObjects,validatedId:r.validatedId,validatedToAdd:v,referenceIds:w,instanceIds:D,instanceNames:r.instanceNames,updateMode:V,ctxViewer:h,onSaveValidatedObjectsFailed:function(){}}),b()};let x=d.updateValidatedListCmd.SelectMsg?d.updateValidatedListCmd.SelectMsg:"Select the Validated Object(s) to add",R=d.updateValidatedListCmd.OkBtn?d.updateValidatedListCmd.OkBtn:"OK",M=d.updateValidatedListCmd.CancelBtn?d.updateValidatedListCmd.CancelBtn:"OK";(m=new r({className:"R3VAddValidatedCmdDlg"}).inject(I.getUIFrame())).add({msgType:"primary",message:x,closable:!1,buttons:[{className:"primary",label:R,onClick:y},{className:"default",label:M,onClick:function(){let e=n.getEventsController({viewer:I.getViewer()});i.empty(),a.empty(),e.fireEvent("onValidatedObjCancelRequested"),b()}}]}),0===i.get().length&&(m.elements.container.getElementsByClassName("btn btn-sm btn-primary")[0].disabled=!0),"add"===this.options.arguments[0].Value?(u=i.onAdd((function(){m.elements.container.getElementsByClassName("btn btn-sm btn-primary")[0].disabled=!1,m.show()})),p=i.onRemove((function(){0===i.get().length&&(m.elements.container.getElementsByClassName("btn btn-sm btn-primary")[0].disabled=!0)}))):y()},this.destroy=function(){b()},this.pauseExecute=function(){this.done()},this.resumeExecute=function(){}}})})),define("DS/DMUReviewPersistence/DMUAddCheckCmd",["DS/CATWebUXComponents/DMUCommand","DS/CATWebUXComponents/CATWebUXNotification","DS/DMUBaseExperience/DMUContextManager","DS/DMUReviewPersistence/DMUAuthReviewPersistenceServices","i18n!DS/DMUReviewPersistence/assets/nls/DMUReviewPersistence"],(function(e,t,n,i,a){"use strict";return e.extend({init:function(e){e.mode="shared",e.repeatMode=!1,e.isAsynchronous=!0,this._parent(e);var o,s,r=this,l=e.frameWindow||this.getFrameWindow(),c=l.getViewer();this._createNewCheck=function(e){var d=n.getReviewContext({viewer:l.getViewer()});o=n.giveEventsController({viewer:c}),i.addCheck({iCtxViewer:n.getContextViewer({viewer:c}),validation:d.getValidation(),requirementDocId:"",checkName:e||"",description:"",checkState:1,onSaveCheckFailed:function(){s||(s=new t),s.build({type:"error",autoHide:!0,message:a.createCheck.errorMessage,body:l.getUIFrame()}),o&&o.fireEvent("onCheckCreationFailed"),r.end()}}),r.end()},this.beginExecute=function(){r._createNewCheck()}}})})),define("DS/DMUReviewPersistence/DMUReviewCreationController",["UWA/Core","UWA/Class","DS/DMUBaseExperience/DMUContextManager","DS/WAFData/WAFData","DS/DMUBaseUIComponents/DMUSearchMembersServices","DS/DMUReadPersistence/DMUWebServicesUtils","DS/DMUBaseUI/DMUToolsUsers","DS/CATWebUXComponents/CATWebUXNotification","DS/DMUReviewPersistence/panels/DMUReviewCreationPanel","i18n!DS/DMUReviewPersistence/assets/nls/DMUReviewPersistence"],(function(e,t,n,i,a,o,s,r,l,c){"use strict";return t.extend({init:function(t){const d=this;let m,u,p,g;this._parent(t);let f=null,h=null,v=null,I=t?t.platform:void 0;require(["DS/PADUtils/PADSettingsMgt","DS/PADServices/utils/SearchUtils","DS/PADUtils/PADUtilsServices"],(function(e,t,n){f=e,h=t,v=n}));var b=function(t){var n,i=window.widget;return n=t&&e.is(t.securityContexts,"string")?t.securityContexts:I?I.getSecurityContext():f.getSetting("pad_security_ctx"),t&&!1===t.encode?n="ctx::"+decodeURIComponent(f.getSetting("pad_security_ctx")):t&&!0===t.encode&&void 0!==t.securityContexts&&(n="ctx::"+encodeURIComponent(n)),{Accept:"application/json","Content-Type":"application/json","Accept-Language":i.lang,SecurityContext:n}};this._getSearchType=function(e,t,n){let i=[];switch(e){case"ENOStrRefinementSpecification":case"VPMReference":case"DesignSight":i.push("VPMReference");break;case"SIMItfSimulation":i.push("VPMReference","SIMItfSimulation");break;case"DIFLayout":i.push("DIFLayout","DIFSheet");break;case"Requirement Specification":i.push("Requirement","Requirement Specification");break;case"Requirement":i.push("Requirement","Requirement Specification","Chapter");break;case"Change Action":i.push("Change Action");break;case"Document":i.push("Document");break;case"FailureModesEffectsAnalysis":i.push("FailureModesEffectsAnalysis");break;case"DELLmiWorkPlanSystemReference":i.push("DELLmiWorkPlanSystemReference","DELLmiHeaderOperationReference");break;case"DELLmiHeaderWorkPlanReference":i.push("DELLmiHeaderWorkPlanReference","DELLmiWorkPlanSystemReference","DELLmiHeaderOperationReference");break;default:i.push("VPMReference","Requirement Specification","SIMItfSimulation","DIFLayout","Document","Requirement","Drawing","Specification Report","FailureModesEffectsAnalysis","PLMPIMMetricReference","DIFSheet","DesignSight","R2V_FeatureOfInterest","DELLmiHeaderWorkPlanReference","DELLmiWorkPlanSystemReference")}if(!Array.isArray(i)||0===i.length)return"";let a="";if(t){if(!n||"string"!=typeof n)return"";const e=["ds6w:identifier","ds6w:label"],t=["ds6w:type","ds6w:label"],o=[];i.forEach((i=>{"R2V_FeatureOfInterest"===i?o.push(`([${t[0]}]:R2V_FeatureOfInterest AND [${t[1]}]:(*${n}*))`):e.forEach((e=>{o.push(`((flattenedtaxonomies:"types/${i}") AND [${e}]:(*${n}*))`)}))})),a=`((${o.join(" OR ")}))`}else a=i.map((e=>`(flattenedtaxonomies:"types/${e}")`)).join(" OR ");return a},this._getObjs=function(n){var a={method:"POST"};(t=e.is(n)?n:{}).isfederated=!0,a.headers=b({encode:!0});var o={with_indexing_date:!0,with_nls:!1,label:"yus-1515078503005",locale:"en",select_predicate:["ds6w:label","ds6w:type","ds6w:description","ds6w:identifier","ds6w:responsible","ds6wg:fullname"],select_file:["icon","thumbnail_2d"],query:d._getSearchType(t.roleType,!0,t.text),order_by:"desc",order_field:"relevance",nresults:1e3,start:"0",source:[],tenant:I?I.getPlatformId():v.getPlatformId()};a.data=JSON.stringify(o);var s=new Promise((function(e,t){a.onComplete=function(t){let n=JSON.parse(t);var i=[];n&&n.results&&Array.isArray(n.results)&&n.results.forEach((function(e){var t={},n=e.attributes;"OnPremise"===v.getPlatformId()?n.forEach((function(e){"ds6w:what/ds6w:type"===e.name&&(t.type=e.value),"resourceid"===e.name&&(t.id=e.value),"ds6w:identifier"===e.name&&(t.identifier=e.value),"ds6w:label"===e.name&&(t.label=e.value),"type_icon_url"===e.name&&(t.icon=e.value),"sourceid"===e.name&&(t.serviceId=e.value.slice(0,e.value.indexOf(":")))})):n.forEach((function(e){"ds6w:what/ds6w:type"===e.name&&(t.type=e.value,t.type.includes("foaf")&&(t.type=t.type.slice(5))),"resourceid"===e.name&&(t.id=e.value),"ds6w:identifier"===e.name&&(t.identifier=e.value),"ds6w:label"===e.name&&(t.label=e.value),"type_icon_url"===e.name&&(t.icon=e.value),"sourceid"===e.name&&(t.serviceId=e.value.slice(0,e.value.indexOf(":")))})),i.push(t)}));e(i)},a.onFailure=function(e){t(e)}}));let r=null;return r=I?I.get3DSearchUrl():v.get3DSearchUrl(),i.authenticatedRequest(r+"/search",a),s},this._searchObjs=function(e){let t=d._getSearchType(e.roleType,!1);h.inAppsSearch({title:c.createCheck[e.roleType.toLowerCase()],default_search_criteria:"",precond:t,multiSel:!0,callback:function(t){for(var n=[],i=0;i<t.length;i++)n.push({objectId:t[i].id,identifier:t[i]["ds6w:identifier"],objectType:t[i]["ds6w:type_value"],displayType:t[i]["ds6w:type"],displayName:t[i]["ds6w:label"],serviceId:t[i].sourceid});var a={data:{}};a.data.items=n,e.onSearchOkButtonClicked(a)},cancel:function(){}})},this._searchMember=function(e){return a.searchMember(e)},this._getMembers=function(e){return a.getMembers({platformOptions:I,text:e})},this._getAdditionalMembersInfo=function(e){return new Promise(((t,i)=>{m?n.getContextViewer({viewer:m.getViewer()}).getController().getAttributes({ids:e,attributes:["ds6w:identifier"],callbacks:{onComplete:function(n){if(n){var i=[];e.forEach((function(e){n[e]&&i.push(n[e]["ds6w:identifier"])})),t(i)}},onFailure:function(e){i(e)}}}):I&&o.fetchAttributes({ids:e,attributes:["ds6w:identifier"],platform:I}).then((n=>{if(n){var i=[];e.forEach((function(e){n[e]&&i.push(n[e]["ds6w:identifier"])})),t(i)}})).catch((e=>{i(e)}))}))},this._dropWarningNotification=function(e){(new r).build({type:"warning",autoHide:!0,message:e,body:u})},this._getAdditionalObjInfo=function(e){return new Promise(((t,i)=>{e.isR2V?"R3M"===p&&I&&o.fetchR2VFeatureOfInterestAttributes({ids:e.ids,attributes:["type_icon_url","ds6w:type"],platform:I}).then((n=>{if(n){var i=[];e.ids.forEach((function(e){n[e]&&i.push({objectIconUrl:n[e].icon,objectType:n[e].type})})),t(i)}})).catch((e=>{i(e)})):m?n.getContextViewer({viewer:m.getViewer()}).getController().getAttributes({ids:e.ids,attributes:["type_icon_url","ds6w:type"],callbacks:{onComplete:function(n){if(n){var i=[];e.ids.forEach((function(e){n[e]&&i.push({objectIconUrl:n[e].type_icon_url,objectType:n[e]["ds6w:type"]})})),t(i)}},onFailure:function(e){i(e)}}}):I&&o.fetchAttributes({ids:e.ids,attributes:["type_icon_url","ds6w:type"],platform:I}).then((n=>{if(n){var i=[];e.ids.forEach((function(e){n[e]&&i.push({objectIconUrl:n[e].type_icon_url,objectType:n[e]["ds6w:type"]})})),t(i)}})).catch((e=>{i(e)}))}))},this._getUserName=function(e,t){return new Promise(((n,i)=>{var a=[],o=s.getUserName(t,"R3M"===e?I:void 0);a.push(o.then((function(e){return e})).catch((function(e){i(e)}))),n(Promise.all(a))}))},this.buildDialog=function(e){let t;g&&g.destroy(),"ENOR3R_AP"===e.appId?t="R3R":"ENOR3V_AP"===e.appId?t="R3V":"ENOR3M_AP"===e.appId&&(t="R3M"),p=t,m=e.frmWindow,u=e.frame,g=new l({frame:e.frame,mode:t,saveAsDraft:"ENOR3R_AP"!==e.appId,inputInfos:e.inputInfos,warningStyle:e.warningStyle,reviewTabOnly:e.reviewTabOnly,markupTabOnly:e.markupTabOnly,markupCreation:e.markupCreation,multipleReviews:e.multipleReviews,dropWarningNotification:d._dropWarningNotification,getAdditionalMembersInfo:d._getAdditionalMembersInfo,getAdditionalObjInfo:d._getAdditionalObjInfo,getObjs:d._getObjs,searchObjs:d._searchObjs,searchMember:d._searchMember,getMembers:d._getMembers,getUserName:d._getUserName,checkValidObject:e.isValidObject,onOK:e.onProcessCreation,onCancel:e.onCancelCreation,onClose:e.onClose})},this.clean=function(){g&&(g.destroy(),g=null)}}})})),define("DS/DMUReviewPersistence/DMUCreateMulitpleReviewsCmd",["UWA/Core","DS/CATWebUXComponents/DMUCommand","DS/CATWebUXPreferences/CATWebUXPreferencesUtils","DS/DMUReviewPersistence/DMUReviewCreationController","DS/DMUReadPersistence/DMUWebServicesUtils","DS/DMUValidationPersistence/DMUValidationPersistenceServices","DS/DocumentManagement/DocumentManagement","i18n!DS/DMUReviewPersistence/assets/nls/DMUReviewPersistence","css!DS/DMUReviewPersistence/DMUReviewPersistence.css"],(function(e,t,n,i,a,o,s,r){"use strict";return t.extend({init:function(e){e.repeatMode=!1,e.isAsynchronous=!0,this._parent(e);var t,l,c=this,d={};const m=["VPMReference","Requirement Specification","SIMItfSimulation","DIFLayout","DesignSight","ENOStrRefinementSpecification","DELLmiWorkPlanSystemReference","DELLmiPPRHeaderProcessReferenceAbstract"];let u={},p={};u.VPMReference=["VPMReference"],u.DesignSight=["VPMReference"],u["Requirement Specification"]=["Requirement"],u.DIFLayout=["DIFSheet"],u.SIMItfSimulation=["VPMReference"],u.ENOStrRefinementSpecification=["VPMReference"],u.All=["FailureModesEffectsAnalysis","Document","Requirement","Drawing","Specification Report","PLMPIMMetricReference","DIFSheet","R2V_FeatureOfInterest"],p.DELLmiWorkPlanSystemReference=["DELLmiHeaderOperationReference"],p.DELLmiPPRHeaderProcessReferenceAbstract=["DELLmiWorkPlanSystemReference","DELLmiHeaderOperationReference"],p.All=["DELLmiWorkPlanSystemReference","DELLmiHeaderOperationReference"];const g=["pdf","dxf","dwg","doc","docx","docm","dot","dotm","dotx","rtf","ppt","pptx","pot","potm","potx","pps","ppsm","ppsx","pptm"];var f=e.parent||this.getFrameWindow();let h;var v,I,b,C;function w(e){h&&h.clean(),h=null,t&&t.onCommandEnded(e),c.end?c.end():c.done()}function D(e,t){d[e]?t(d[e]):a.getParentTypes(e,l).then((function(n){d[e]=[e].concat(n),t(d[e])})).catch((function(){t([e])}))}function y(e){return new Promise((t=>{o.generateName({sListTypeName:e,platform:l,onGenerateNameCompleted:function(e){v=e.listNames[0].title,I=e.listNames[0].name,b=e.listNames[1]?e.listNames[1].title:void 0,C=e.listNames[1]?e.listNames[1].name:void 0,t()},ononGenerateNameFailed:function(){v=r.createReview.defaultReviewName,b=r.createReviewMarkup.defaultMarkupName,t()}})}))}function x(e){return a.fetchR2VActivityFromR2VFeatureOfInterest({ids:e.valueItem,platform:l})}function R(e){let t,n,i=[];e.infos.contexts&&e.infos.contexts.length>0&&e.infos.contexts.forEach((a=>{let o=[],s=[a.valueItem],r=a.data&&a.data.parentType?a.data.parentType:void 0;if(n=a.contextURI?a.contextURI:void 0,a.data&&a.data.mainContext&&(r=a.data.mainContext.type,s.push(a.data.mainContext.id),o.push([a.valueItem])),i.push({contextIds:s,mainContextType:r,sServiceID:a.data&&a.data.serviceId?a.data.serviceId:"3DSpace"}),e.infos.contexts.length>1){let i;t||(t=[]),(e.infos.markup||a.data&&("Document"===a.data.parentType||a.data.mainContext&&"Specification Report"===a.data.mainContext.type))&&(i="true"),e.infos.validatedObjects&&e.infos.validatedObjects.length>0&&"R2V_Activity"!==a.data.type&&e.infos.validatedObjects.forEach((e=>{o.push([e])}));let r={contextIds:s,serviceID:a.data&&a.data.serviceId?a.data.serviceId:"3DSpace",contextAsValidated:a.data&&a.data.mainContext?void 0:"true",validatedObjects:o,addMarkup:i};n&&(r.contextURI=n),t.push(r)}}));let a=[];e.infos.validatedObjects&&e.infos.validatedObjects.length>0&&e.infos.validatedObjects.forEach((e=>{a.push([e])})),o.createReviewInDataBase({reviewName:e.infos.multipleReviews?void 0:e.infos.review.title,reviewPLMexternalID:e.infos.multipleReviews?void 0:I,listContextIds:i,reviewDescription:e.infos.review.description,createMarkup:e.infos.markup,restrictedEdition:e.infos.restrictedAccess,markupName:!e.infos.multipleReviews&&e.infos.markup?e.infos.markup.title:void 0,markupPLMexternalID:!e.infos.multipleReviews&&e.infos.markup?C:void 0,markupDescription:e.infos.markup?e.infos.markup.description:void 0,contextAsValidated:e.infos.multipleReviews?"true":"false",validatedObjects:a,checksList:e.infos.checks,members:e.infos.members,multiReview:e.infos.multipleReviews?"true":"false",multiReviews:t,maturity:e.infos.maturity,platform:l,strURI:t?"":n,onReviewCreationCompleted:t=>{let n=t.validations?t.validations:[t],i={validations:n,CA:e.infos.changeAction};if(n){let t=[];n.forEach((n=>{if(n.markup&&n.markup.markupRepRef){let a;n.rootContextIds&&1===n.rootContextIds.length&&e.infos.contexts&&(a=e.infos.contexts.find((e=>e.valueItem===n.rootContextIds[0])));let s=(i={id:n.markup.markupRepRef.pId,validationId:n.pId,context:a},new Promise((e=>{let t={Version:"1.0",Model:[{type:"Markup",LinksManager:{type:"ExternalLinks",entities:[],occurrences:[]}}]};if(i.context&&i.context.data&&"Document"===i.context.data.parentType){let e=i.context.data.documentFileData.dataelements.title.split(".").pop().toUpperCase(),n={fileId:i.context.data.documentFileData.relId,version:[i.context.data.documentFileData.id]};t.Contexts=[{superType:"Document",documentType:e,documentVersionInfos:n}]}o.saveReviewMarkup({markupRepRefId:i.id,jsonContent:JSON.stringify(t),validationId:i.validationId,platform:l,onSaveReviewMarkupCompleted:()=>{e()},onSaveReviewMarkupFailed:()=>{e()}})})));t.push(s)}var i})),Promise.all(t).then((()=>{e.onEnd(i)})).catch((()=>{e.onEnd(i)}))}else e.onEnd(i)},onReviewCreationFailed:e.onEnd})}function M(e){return new Promise((t=>{let n={parts:[],products:[]},i=[];for(var o=Object.keys(e),s=0;s<o.length;s++)i.push(o[s]);a.fetchAttributes({ids:i,attributes:["ds6w:label","ds6w:contentStructure","ds6w:type"],platform:l}).then((i=>{if(i)for(var a=Object.keys(i),o=0;o<a.length;o++)"Leaf"===i[a[o]]["ds6w:contentStructure"]||"Standalone"===i[a[o]]["ds6w:contentStructure"]?(e[a[o]].setValidatedObjFromContext=!0,n.parts.push(e[a[o]])):n.products.push(e[a[o]]);t(n)})).catch((function(){t(n)}))}))}function S(e){return new Promise((t=>{let n=[],i=[];for(var a=Object.keys(e),o=0;o<a.length;o++)i.push(a[o]);i.length>0?s.getDocuments(i,{onComplete:i=>{i.data&&i.data.length>0&&i.data.forEach((t=>{t&&t.relateddata&&t.relateddata.files&&1===t.relateddata.files.length&&-1!==g.includes(t.relateddata.files[0].dataelements.title.split(".").pop().toLowerCase())&&(e[t.id].documentFileData=t.relateddata.files[0],n.push(e[t.id]))})),t(n)},onFailure:()=>{t(n)},securityContext:l.getSecurityContext(),tenantUrl:l.get3DSpaceUrl(),tenant:l.getPlatformId(),getVersions:!0}):t(n)}))}function k(e){return new Promise((async t=>{let n=[];for(var i=Object.keys(e),o=0;o<i.length;o++){let t=await a.getSpecReportData(i[o],l);t&&(e[i[o]].mainContext={id:t.id,type:t.type},e[i[o]].setValidatedObjFromContext=!0,n.push(e[i[o]]),delete e[i[o]])}t(n)}))}this.beginExecute=async function(){t||w();let e,o,s,r=[],c=[],d=[],g=[],I=[],C=[],U=async e=>{if(e&&e.contexts.length&&e.contexts.length>=1)for(const t of e.contexts)if("R2V_FeatureOfInterest"===t.type)try{const e=await x(t),n=JSON.parse(e).result[0];t.type=t.data.type=n["ds6w:type"],t.valueItem=t.data.valueItem=n.resourceid,t.contextURI=t.data.contextURI=n["ds6w:i3dx"]}catch(e){window.console.error("Error :",e)}R({infos:e,onEnd:w}),function(e){if(e){let i={reqs:e.checks};if(e.members)for(var t=Object.keys(e.members),n=0;n<t.length;n++)e.members[t[n]]&&e.members[t[n]].add&&(i.members||(i.members={}),i.members[t[n]]=e.members[t[n]].add);localStorage.setItem("DMUMulitpleRvwsCmd",JSON.stringify(i))}}(e)};var V=function(){h=new i({platform:l}),h.buildDialog({appId:"ENOR3M_AP",frame:f,markupCreation:e.ValidMngtAutomaticMarkupCreationDialog,platform:l,inputInfos:{reviewTitle:v,markupTitle:b,contexts:r,validatedObjects:I,restrictedAccess:e.ValidMngtRestrictedAccess,multipleReviews:r.length>1,caObject:1===g.length?g[0]:void 0,reqs:o&&o.reqs?o.reqs:void 0,members:o&&o.members?o.members:void 0},isValidObject:async t=>{let n,i,a,o=[];if(t.objs&&t.objs.length>0){"Context"===t.checkId&&1===t.objs.length?(n=u.All,i=m):"Validated"===t.checkId&&(t.contexts&&1===t.contexts.length&&t.contexts[0]&&!t.contexts[0].setValidatedObjFromContext?(n=u[t.contexts[0].parentType],"VPMReference"===t.contexts[0].parentType||"DIFLayout"===t.contexts[0].parentType||"Requirement Specification"===t.contexts[0].parentType?(i=[t.contexts[0].parentType],a=t.contexts[0].valueItem):"DELLmiWorkPlanSystemReference"!==t.contexts[0].parentType&&"DELLmiPPRHeaderProcessReferenceAbstract"!==t.contexts[0].parentType||(i=p[t.contexts[0].parentType],a=t.contexts[0].valueItem)):n=u.All);let r=await(s={listObjs:t.objs,supportedLeafTypes:n,supportedRootTypes:i,leafTypes:!i,contextId:a,pref:e},new Promise((e=>{let t={roots:[],leafs:[],ca:[]},n={},i={};if(s.listObjs&&s.listObjs.length&&s.listObjs.length>0){let a=[];s.listObjs.forEach((e=>{let o,r={valueItem:e.objectId,type:e.objectType,labelItem:e.displayName,serviceId:e.serviceId};o=s.contextId&&s.contextId===e.objectId?new Promise((e=>{t.roots.push(r),e()})):new Promise((a=>{D(e.objectType,(o=>{for(var l=0;l<o.length;l++){if(!s.leafTypes&&s.supportedRootTypes&&s.supportedRootTypes.includes(o[l])){r.parentType=o[l],"VPMReference"===o[l]?n[e.objectId]=r:t.roots.push(r);break}if(s.leafTypes&&"VPMReference"===o[l]){r.parentType=o[l],n[e.objectId]=r;break}if(s.supportedLeafTypes&&s.supportedLeafTypes.includes(o[l])){r.parentType=o[l],r.setValidatedObjFromContext=!0,"Document"===o[l]?i[e.objectId]=r:t.leafs.push(r);break}if("Change Action"===o[l]){t.ca.push({valueItem:e.objectId,type:e.objectType});break}}a()}))})),a.push(o)})),Promise.all(a).then((async()=>{if(s.pref&&"OpenReleaseSnapshot"===s.pref.ValidMngtProductLoadingMode){let e=await k(n);e&&e.length>0&&(t.leafs=t.leafs.concat(e))}let a=await M(n);a&&a.parts&&(t.leafs=t.leafs.concat(a.parts)),!s.leafTypes&&a&&a.products&&(t.roots=t.roots.concat(a.products));let o=await S(i);o&&o.length>0&&(t.leafs=t.leafs.concat(o)),e(t)})).catch((()=>{e(t)}))}else e(t)})));r&&r.roots&&(o=o.concat(r.roots)),r&&r.leafs&&(o=o.concat(r.leafs))}var s;return o},onProcessCreation:n=>{if(n.restrictedAccess=e.ValidMngtRestrictedAccess,n.multipleReviews&&(n.validatedObjects=[]),n.changeAction&&n.validatedObjects.push(n.changeAction),h&&h.clean(),h=null,t&&t.startLoadingUI&&t.startLoadingUI(),n.checks&&n.checks.length>0){let e=function(e){let t=function(e){let t;if(void 0!==e){var n=document.createElement("textarea");n.innerHTML=e;t=(new DOMParser).parseFromString(n.value,"text/html").documentElement.textContent}return t},n=e["attribute[Content Text]"]?t(e["attribute[Content Text]"]):e["Content Text"]?e["Content Text"]:t(e.content)?t(e.content):"";n&&n.length>100&&(n=n.substring(0,99)+"...");let i=e["attribute[Title]"]?t(e["attribute[Title]"]):e.Title?e.Title:"";if("Requirement"===(e.type.value?e.type.value:e["type.kindof"]?e["type.kindof"]:"")){return{sRequirementDocId:e.physicalid,sName:i,sDescription:n,iCheckState:1}}},t=[],i=[];n.checks.forEach((n=>{let o=new Promise((async i=>{if("requirement"===n.reqType){let i;n.iCheckState=1;let o=await a.getRequirementElementContent(n.reqId,l);o&&o.results&&1===o.results.length&&(o.results[0].physicalid||(o.results[0].physicalid=n.reqId),i=e(o.results[0])),i&&t.push(i)}else if("chapter"===n.reqType||"requirement specification"===n.reqType){let i=await a.getRequirementData(n.reqId,l);i&&i.forEach((n=>{let i=e(n);i&&t.push(i)}))}i()}));i.push(o)})),Promise.all(i).then((()=>{n.checks=t,U(n)}))}else U(n)},onCancelCreation:w,onClose:w})};e=await new Promise((async e=>{let t={};try{let e=(await n.readPreferences([{Repository:"DMURepository",PreferenceNames:["ValidMngtAutomaticMarkupCreationDialog","ValidMngtCAFromSelection","ValidMngtRestrictedAccess","ValidMngtProductLoadingMode"]}])).repositories[0].preferences;for(let n=0;n<e.length;n++)"ValidMngtAutomaticMarkupCreationDialog"===e[n].name?t.ValidMngtAutomaticMarkupCreationDialog="true"===e[n].value:"ValidMngtCAFromSelection"===e[n].name?t.ValidMngtCAFromSelection="true"===e[n].value:"ValidMngtRestrictedAccess"===e[n].name?t.ValidMngtRestrictedAccess=e[n].value:"ValidMngtProductLoadingMode"===e[n].name&&(t.ValidMngtProductLoadingMode=e[n].value)}catch(e){t.ValidMngtAutomaticMarkupCreationDialog=!1,t.ValidMngtCAFromSelection=!1,t.ValidMngtRestrictedAccess="Activated",t.ValidMngtProductLoadingMode="Open3DDefinition",window.console.warn("Could not get server value, default value set instead.",e)}e(t)})),o=function(){let e,t=localStorage.getItem("DMUMulitpleRvwsCmd");return t&&(e=JSON.parse(t)),e}();let j=e.ValidMngtAutomaticMarkupCreationDialog?[{sTypeName:"DMUValidationValidation"},{sTypeName:"DMUValidationReviewReference"}]:[{sTypeName:"DMUValidationValidation"}];if(t.objects&&t.objects.length>0){t.startCheckingSelUI&&t.startCheckingSelUI();let n=[],i={},f={},h=[];t.objects.forEach((e=>{let t=new Promise((t=>{D(e.objectType,(n=>{for(var a=0;a<n.length;a++){if(m.includes(n[a])){let t={valueItem:e.objectId,type:e.objectType,parentType:n[a],serviceId:e.serviceId};"VPMReference"===n[a]?i[e.objectId]=t:d.push(t);break}if(u.All&&u.All.includes(n[a])){let t={valueItem:e.objectId,type:e.objectType,parentType:n[a],setValidatedObjFromContext:!0,serviceId:e.serviceId};"Document"===n[a]?f[e.objectId]=t:c.push(t);break}if(p.All&&p.All.includes(n[a])){let t={valueItem:e.objectId,type:e.objectType,parentType:n[a],serviceId:e.serviceId};C.push(t);break}if("Change Action"===n[a]){g.push({valueItem:e.objectId,type:e.objectType});break}}t()}))}));n.push(t)})),Promise.all(n).then((async()=>{if("OpenReleaseSnapshot"===e.ValidMngtProductLoadingMode){let e=await k(i);e&&e.length>0&&(c=c.concat(e))}let n=await M(i);n&&(n.parts&&(c=c.concat(n.parts)),n.products&&(d=d.concat(n.products)));let m=await S(f);m&&m.length>0&&(c=c.concat(m));let v=[];if(1===d.length)if(r.push(d[0]),"SIMItfSimulation"===d[0].type){let e=await(b=d[0].valueItem,new Promise((async e=>{let t,n=await a.getInterferenceSimulationContext(b,l);n&&(t={valueItem:n.physicalid,labelItem:n["ds6w:label"],type:n["ds6w:type"]}),e(t)})));e&&I.push(e)}else{for(let e=0;e<c.length;e++)u[d[0].parentType]&&u[d[0].parentType].includes(c[e].parentType)&&I.push(c[e]);for(let e=0;e<C.length;e++)p[d[0].parentType]&&p[d[0].parentType].includes(C[e].parentType)&&I.push(C[e])}else c.length>0&&c.forEach((e=>{r.push(e),I.push(e),"R2V_FeatureOfInterest"===e.type&&h.push(e)}));var b,w,D,x,R;if(g.length>1)g=[];else if(0===g.length&&e.ValidMngtCAFromSelection){let e=await(w=I,new Promise((e=>{if(w.length>0){let t=[];w.forEach((e=>{t.push(e.valueItem)})),a.navigate({ids:t,primitives:[{navigate_from_sr:{id:1,mode:"ends",type:"Realized Activity.After"},navigate_from_rel:{id:2,filter:{rel_type:["Realized Activities"]}}}],patterns:{ca:[{id:1},{id:2}]},attributes:["ds6w:label","ds6w:type","type_icon_url"],fileAttributes:[],platform:l}).then((t=>{let n,i=w.length,a=0;if(t.result&&t.result.length>0)for(var o=0;o<t.result.length;o++)if(t.result[o]&&t.result[o].outputs&&t.result[o].outputs.ca&&1===t.result[o].outputs.ca.length){if(n){if(n&&n.valueItem!==t.result[o].outputs.ca[0].physicalid)break}else n={valueItem:t.result[o].outputs.ca[0].physicalid,labelItem:t.result[o].outputs.ca[0]["ds6w:label"],iconItem:t.result[o].outputs.ca[0].type_icon_url,type:t.result[o].outputs.ca[0]["ds6w:type"]};a++}i>0&&i===a?e(n):e()})).catch((function(){e()}))}else e()})));e&&g.push(e)}o&&o.reqs&&o.reqs.length>0&&(s=o.reqs),v.push((D=r.concat(g).concat(I),x=s,new Promise((e=>{let t=[];D.forEach((e=>{t.push(e.valueItem)})),x&&x.forEach((e=>{t.push(e.sRequirementDocId)})),a.fetchAttributes({ids:t,attributes:["ds6w:label","ds6wg:revision","type_icon_url","ds6w:type"],platform:l}).then((t=>{D.forEach((e=>{t[e.valueItem]&&(e.labelItem=t[e.valueItem]["ds6w:label"],e.iconItem=t[e.valueItem].type_icon_url)})),x&&x.forEach((e=>{t[e.sRequirementDocId]&&(e.sName=t[e.sRequirementDocId]["ds6w:label"],e.objectIconUrl=t[e.sRequirementDocId].type_icon_url,e.objectType=t[e.sRequirementDocId]["ds6w:type"])})),e()})).catch((function(){e()}))})))),h.length>0&&v.push((R=h,new Promise((e=>{let t=[];R.forEach((e=>{t.push(e.valueItem)})),a.fetchR2VFeatureOfInterestAttributes({ids:t,platform:l}).then((t=>{R.forEach((e=>{t[e.valueItem]&&(e.labelItem=t[e.valueItem].label,e.iconItem=t[e.valueItem].icon)})),e()})).catch((function(){e()}))})))),v.push(y(j)),Promise.all(v).then((()=>{t.endCheckingSelUI&&t.endCheckingSelUI(),V()}))}))}else await y(j),V()},this.cancelExecute=function(){},this.initCommandParamters=function(e){t=e,e.platformUtils&&(l={getLang:e.platformUtils.getLang,getSecurityContext:e.platformUtils.getSecurityContext,get3DSpaceUrl:e.platformUtils.get3DSpaceUrl,get3DSearchUrl:e.platformUtils.get3DSearchUrl,getR2VPlatformUrl:e.platformUtils.getR2VPlatformUrl,getPlatformId:e.platformUtils.getPlatformId,getUserLogin:e.platformUtils.getUserLogin,getWidgetAppId:e.platformUtils.getWidgetAppId})}}})})),define("DS/DMUReviewPersistence/DMUCreateReviewCmd",["UWA/Core","DS/CATWebUXComponents/DMUCommand","DS/CATWebUXComponents/CATWebUXNotification","DS/DMUBaseExperience/DMUContextManager","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUControls/DMUInfoModalDiv","DS/Visualization/PathElement","DS/DMUReviewPersistence/DMUAuthReviewPersistenceServices","DS/DMUReadPersistence/DMULoadingContextController","DS/DMUPersistence/DMUAuthPersistenceUtils","DS/DMUPersistence/DMUAuthPersistenceServices","DS/DMUBaseExperience/EXPToolsContext","DS/CATWebUXPreferences/CATWebUXPreferencesUtils","DS/DMUReviewPersistence/DMUReviewCreationController","DS/DMUReadPersistence/DMUWebServicesUtils","i18n!DS/DMUReviewPersistence/assets/nls/DMUReviewPersistence","css!DS/DMUReviewPersistence/DMUReviewPersistence.css"],(function(e,t,n,i,a,o,s,r,l,c,d,m,u,p,g,f){"use strict";return t.extend({init:function(e){e.mode="shared",e.repeatMode=!1,e.isAsynchronous=!0,this._parent(e);let t,h=e.args;if(h){let e=Object.keys(h),t=Object.values(h);this._arguments=[];for(let n=0;n<e.length-1;n++)this._arguments.push({ID:e[n],Value:t[n]})}e.executionContext&&e.executionContext.getSourceApp()&&(t=e.executionContext.getSourceApp().options.id);var v,I,b,C,w,D,y,x=this,R=h?"ENOR3V_AP"===t:"DMUDesignValidation"===e.arguments[0].Value,M=e.frameWindow||this.getFrameWindow(),S=M.getViewer(),k=[],U=[],V=[],j=[];let P,E,A,T,O,N,F,L,_=null;var W={};let q={VPMReference:["VPMReference"],ENOStrRefinementSpecification:["VPMReference"],"Requirement Specification":["Requirement"],DIFLayout:["DIFSheet"],SIMItfSimulation:["VPMReference"],FailureModesEffectsAnalysis:["FailureModesEffectsAnalysis"],DELLmiWorkPlanSystemReference:["DELLmiHeaderOperationReference"],DELLmiPPRHeaderProcessReferenceAbstract:["DELLmiWorkPlanSystemReference","DELLmiHeaderOperationReference"]};const B=["VPMReference","ENOStrRefinementSpecification","Requirement Specification","DIFLayout","SIMItfSimulation","DELLmiWorkPlanSystemReference","DELLmiPPRHeaderProcessReferenceAbstract"];function H(){b=null,_=null,k=[],U=[],v&&v.destroy(),L&&L.clean(),L=null,v=null,b=void 0,x.end?x.end():x.done()}function X(e){var t;y&&(y.destroy(),y=null),v||(v=new n),t="errorShape"===e?f.createReview.errorShape:f.createReview.errorMessage,v.build({type:"error",autoHide:!0,message:t,body:M.getUIFrame()});let a=i.giveEventsController({viewer:S});a&&a.fireEvent("onDMUReviewCreationFailed"),H()}function J(e){var t="",n=i.getContextViewer({viewer:S}).getController();if(e){switch(m.getParentType(e.type)?m.getParentType(e.type):e.type){case"ENOStrRefinementSpecification":t="NGFilter";break;case"Requirement":t="Requirement";break;case"Requirement Specification":t="Requirement Specification";break;case"Document":t="Document";break;case"Specification Report":t="Specification Report";break;case"Drawing":t="Drawing";break;case"SIMItfSimulation":t="ITF";break;case"PLMPIMMetricReference":t="ISR";break;case"DIFSheet":t="DIFSheet";break;case"DesignSight":t="DesignSight";break;case"FailureModesEffectsAnalysis":t="FailureModesEffectsAnalysis";break;case"DELLmiWorkPlanSystemReference":t="DELLmiWorkPlanSystemReference";break;case"DELLmiPPRHeaderProcessReferenceAbstract":t="DELLmiPPRHeaderProcessReferenceAbstract";break;case"R2V_Activity":t="R2V_Activity";break;default:var o=[],r=n.getNode({id:e.id});o.push(r);var l=new s(o);if(a.isRepReference(l.getLastElement(!0)))t="RepRef";else if(a.isReference(l.getLastElement(!0))){t="Product";var c=l.externalPath[0].getChildren();if(c.length>0){t="Part";for(let e=0;e<c.length;e++)if(!a.isRepInstance(c[e])){t="Product";break}}}}}return t}function G(e){let t,n=!1;return e&&(t=J(e),["Part","Document","Specification Report","Requirement","DIFSheet","Drawing","R2V_Activity","FailureModesEffectsAnalysis"].includes(t)&&"ENOR3V_AP"===F&&(n=!0)),n}function z(e,t){W[e]?t(W[e]):g.getParentTypes(e).then((function(n){W[e]=[e].concat(n),t(W[e])})).catch((function(){t([e])}))}function $(e){let t=i.giveEventsController({viewer:S});var n;let o=i.getReviewContext({context:I});if(o&&o.getValidation()?i.removeReviewContext({viewer:S}):o&&o.removeInternalDataModel(),t.fireEvent("onDMURemoveSessionReview"),!I)return;var s=e.contexts&&1===e.contexts.length?e.contexts[0].valueItem:void 0,l=e.contexts&&1===e.contexts.length?e.contexts[0]:void 0,c=e.contexts&&1===e.contexts.length?e.contexts[0].strURI:void 0,d="false";let m;var u=[];l&&(l.setValidatedObjFromContext&&(d="true"),m=J({id:l.valueItem,type:l.type}),l.subContextId&&(n={id:l.subContextId,type:l.subContextType}),e.validatedObjects&&e.validatedObjects.length>0&&e.validatedObjects.forEach((e=>{u.push([e])})),e.changeAction&&u.push([e.changeAction]));let p="Document"===m||"Specification Report"===m||P;!m||"Document"!==m&&"Specification Report"!==m&&"Requirement"!==m&&"Requirement Specification"!==m||(E=!0),r.createReview({_ctxViewer:I,_reviewName:e.review.title,_reviewPLMexternalID:D,_rootData:l,_subContext:n,_reviewDescription:e.review.description,_restrictedEdition:e.restrictedAccess,_createMarkup:p,_markupName:e.markup?e.markup.title:void 0,_markupPLMexternalID:w,_markupDescription:e.markup?e.markup.description:void 0,_contextAsValidated:d,_validatedObjects:u,_parentID:s,_dmuEltsDuplicated:V,hiddenElts:j,_editionMode:R,_createFirstSlide:E,_members:e.members,_checks:e.checks,maturity:e.maturity,_strURI:c,onReviewCreationComplete:function(){if("R2V_Activity"===m&&(I.toggleSOITimelinesUsability(!1),t&&t.fireEvent("onR2VReviewCreationSuccess")),t&&t.fireEvent("onDMUReviewCreationSucceeded"),"ITF"===m||"ISR"===m){o=i.getReviewContext({context:I});let e=I.getRootBagPath().getChildrenPathes(),t=a.getNodeID(e[0].getLastElement(!0)),n="add";r.updateValidatedObjectsList({fullPathRefs:[[t]],validatedObjects:[[t]],validatedId:o.getValidation().getValidated().getPlmID()?o.getValidation().getValidated().getPlmID():null,validatedToAdd:[[t]],referenceIds:[t],instanceIds:[t],instanceNames:[],updateMode:n,ctxViewer:I.getViewer(),onReviewCtxUpdateOrDropValidated:!0,onSaveValidatedObjectsFailed:function(){}})}H()},onReviewCreationFailed:X})}async function K(){let e,t,n;try{let e=(await u.readPreferences([{Repository:"DMURepository",PreferenceNames:["DisplayMarkupCreationDialog","CreateFirstSlide","AutomaticMarkupCreationDialog","ValidationAutomaticMarkupCreationDialog","DisplayReviewCreationDialog","ReviewRestrictedAccess","ValidationRestrictedAccess"]}])).repositories[0].preferences;for(let i=0;i<e.length;i++)"CreateFirstSlide"===e[i].name?E="true"===e[i].value:"AutomaticMarkupCreationDialog"===e[i].name?t="true"===e[i].value:"ValidationAutomaticMarkupCreationDialog"===e[i].name?n="true"===e[i].value:"DisplayReviewCreationDialog"===e[i].name?A="true"===e[i].value:"DisplayMarkupCreationDialog"===e[i].name?T="true"===e[i].value:"ReviewRestrictedAccess"===e[i].name?O=e[i].value:"ValidationRestrictedAccess"===e[i].name&&(N=e[i].value)}catch(e){E=!0,t=!1,n=!0,A=!0,O="Deactivated",N="Activated",window.console.warn("Could not get server value, default value set instead.",e)}"ENOR3V_AP"===F?(e=N,P=n):"ENOR3R_AP"===F&&(e=O,P=t);var a=P?[{sTypeName:"DMUValidationValidation"},{sTypeName:"DMUValidationReviewReference"}]:[{sTypeName:"DMUValidationValidation"}];b||new Promise((function(e){r.generateName({sListTypeName:a,onGenerateNameCompleted:function(t){b=t.listNames[0].title,D=t.listNames[0].name,P&&(C=t.listNames[1].title,w=t.listNames[1].name),e()},ononGenerateNameFailed:function(){b=U.length?f.createReview.defaultReviewName+"_"+U[0]:f.createReview.defaultReviewName,e()}})})).then((function(){var t=i.getReviewContext({context:I}),n=function(e){L&&L.clean(),async function(e){(y=new o).display({modal:!0,frmWindow:M,type:"load",message:f.createReview.loadingMessage}),y.getContent().addClassName("DMUCreateReviewInfoDiv");var n=e.contexts&&1===e.contexts.length?e.contexts[0].valueItem:void 0;if(P&&E){let e=await c.getTransientMarkersAndOverloads(t,I,n);j=e.overloads,V=e.markers}if(t)if(t.getValidation()){var i,a=t?t.getValidation():null,s=a?a.getCurrentMarkup():null;s&&"Markup"===s.getType()?i=t.getRestrictions()?t.getRestrictions().markup.canEdit:null:s&&"Reply"===s.getType()&&(i=t.getRestrictions()?t.getRestrictions().reply.canEdit:null),s&&i?r.saveReviewMarkup({markupRepRefId:s.getRepRef().getPlmID(),frmWindow:M,onSaveCompleted:()=>{$(e)},onSaveFailed:()=>{}}):$(e)}else $(e);else $(e)}(e)};if(A||k.length>1||t&&t.getCurrentSessionMarkup())L=new p,L.buildDialog({appId:F,frame:M.getImmersiveFrame(),frmWindow:M,reviewTabOnly:!P&&"ENOR3R_AP"===F,markupCreation:P&&T,warningStyle:t&&t.getValidation(),inputInfos:{reviewTitle:b,markupTitle:C,contexts:k,restrictedAccess:e,multipleReviews:!1},isValidObject:async e=>{let t=[];if(e.objs&&e.objs.length>0&&"Validated"===e.checkId&&e.contexts&&1===e.contexts.length){let i=await(n={listObjs:e.objs,supportedTypes:q,contextId:e.contexts[0].valueItem,contextType:e.contexts[0].type},new Promise((e=>{let t=[];n.listObjs&&n.listObjs.length&&n.listObjs.length>0?z(n.contextType,(i=>{let a,o,s=[];for(var r=0;r<i.length;r++)if(B.includes(i[r])){a=i[r];break}a&&("VPMReference"!==a&&"DIFLayout"!==a&&"Requirement Specification"!==a&&"DELLmiWorkPlanSystemReference"!==a&&"DELLmiPPRHeaderProcessReferenceAbstract"!==a||(o=n.contextId)),n.listObjs.forEach((e=>{let i,r={valueItem:e.objectId,type:e.objectType,labelItem:e.displayName,serviceId:e.serviceId};i=o===e.objectId?new Promise((e=>{t.push(r),e()})):new Promise((i=>{z(e.objectType,(e=>{for(var o=0;o<e.length;o++)if(n.supportedTypes[a]&&n.supportedTypes[a].includes(e[o])){r.parentType=e[o],t.push(r);break}i()}))})),s.push(i)})),Promise.all(s).then((()=>{e(t)})).catch((()=>{e(t)}))})):e(t)})));i&&i.length>0&&(t=i)}var n;return t},onProcessCreation:t=>{if(t.restrictedAccess=e,t.checks&&t.checks.length>0){let e=function(e){let t=function(e){let t;if(void 0!==e){var n=document.createElement("textarea");n.innerHTML=e;t=(new DOMParser).parseFromString(n.value,"text/html").documentElement.textContent}return t},n=e["attribute[Content Text]"]?t(e["attribute[Content Text]"]):e["Content Text"]?e["Content Text"]:t(e.content)?t(e.content):"";n&&n.length>100&&(n=n.substring(0,99)+"...");let i=e["attribute[Title]"]?t(e["attribute[Title]"]):e.Title?e.Title:"";if("Requirement"===(e.type.value?e.type.value:e["type.kindof"]?e["type.kindof"]:"")){return{sRequirementDocId:e.physicalid,sName:i,sDescription:n,iCheckState:1}}},i=[],a=[];t.checks.forEach((t=>{let n=new Promise((async n=>{if("requirement"===t.reqType){let n;t.iCheckState=1;let a=await g.getRequirementElementContent(t.reqId);a&&a.results&&1===a.results.length&&(a.results[0].physicalid||(a.results[0].physicalid=t.reqId),n=e(a.results[0])),n&&i.push(n)}else if("chapter"===t.reqType||"requirement specification"===t.reqType){let n=await g.getRequirementData(t.reqId);n&&n.forEach((t=>{let n=e(t);n&&i.push(n)}))}n()}));a.push(n)})),Promise.all(a).then((()=>{t.checks=i,n(t)}))}else n(t)},onCancelCreation:function(){var e=i.giveEventsController({viewer:S});e&&e.fireEvent("onDMUMarkupCreationCancelled"),H()},onClose:H});else{let t={};t.review={title:b},t.contexts=k&&1===k.length?k:void 0,t.restrictedAccess=e,t.maturity="Activated"===e?"Draft":"InWork",t.markup={title:C},n(t)}}))}i.setAuthoringFeatureTypes("Check"),i.setAuthoringFeatureTypes("Highlight"),this.beginExecute=function(){var e;if(F=window.widget.getValue("appId"),I=i.getContextViewer({viewer:S})){var t=d.getPossibleRootContexts(I),n=[];for(_=l.getLoadingContextController({context:I}),e=0;e<t.length;e++){var o=I.getController().isFiltered(a.getNodeID(t[e].getLastElement(!0))),s=_.getLoadedWorkplanInformations();let i=_.getLoadedFMEAInformations();if(I.getApplicativeData&&I.getApplicativeData().getLoadedItfData&&I.getApplicativeData().getLoadedItfData().data.length){I.getApplicativeData().getLoadedItfData().data.forEach((function(e){n.push({rootID:e.isrID,type:e.type})}));break}if(s)(n=[]).push({rootID:s.id,type:s.type});else if(i)(n=[]).push({rootID:i.id,type:i.type});else if(o.filterId)n.push({rootID:o.filterId,type:"ENOStrRefinementSpecification"});else if(""!==a.getNodeID(t[e].getLastElement(!0))){const i=a.getNodeID(t[e].getLastElement(!0));n.push({rootID:a.getNodeID(t[e].getLastElement(!0)),type:I.getController().getRootStats(i)&&"r2vsurvey"===I.getController().getRootStats(i).serviceId?"R2V_Activity":a.getNodeType(t[e].getLastElement(!0))})}}n.length?new Promise((function(e){var t=0;n.forEach((function(i){if("R2V_Activity"===i.type){_||(_=l.getLoadingContextController({context:I}));_.getLoadedR2VInformations().forEach((a=>{a.id===i.rootID&&(t++,k.push({labelItem:a.info[0]["ds6w:label"],iconItem:a.info[0].icon||a.info[0]["ds6w:icon"],valueItem:i.rootID,type:i.type,setValidatedObjFromContext:G({id:i.rootID,type:i.type}),strURI:a.strURI?a.strURI:void 0}),t===n.length&&e())}))}else{let n=null,a=[];a.push(i.rootID),"Specification Report"===i.type&&(_||(_=l.getLoadingContextController({context:I})),_&&(n=_.getSubContextInformations(i.rootID)),n&&a.push(n.id)),I.getController().getAttributes({ids:a,attributes:["ds6w:label","ds6wg:revision","type_icon_url","ds6w:type"],callbacks:{onComplete:function(a){var o,s,r,l;(t++,a[i.rootID]&&(s=a[i.rootID].type_icon_url,o=a[i.rootID]["ds6w:label"],l=a[i.rootID]["ds6w:type"],r=m.getParentType(a[i.rootID]["ds6w:type"])?m.getParentType(a[i.rootID]["ds6w:type"]):l,a[i.rootID]["ds6wg:revision"]&&(o+=" "+a[i.rootID]["ds6wg:revision"]),U.push(o),k.push({labelItem:o,iconItem:s,valueItem:i.rootID,type:r,setValidatedObjFromContext:G({id:i.rootID,type:i.type?i.type:r}),subContextId:n?n.id:void 0,subContextType:n?n.type:void 0,subContextIcon:n&&a[n.id]?a[n.id].type_icon_url:void 0,subContextTitle:n&&a[n.id]?a[n.id]["ds6w:label"]:void 0})),i)?"RepRef"===J({id:i.rootID,type:i.type?i.type:r})?X("errorShape"):e():X()},onFailure:function(){t++;[{type:"ENOStrRefinementSpecification",label:"Filter"},{type:"Document",label:"Document"},{type:"Specification Report",label:"Specification Report"},{type:"ISR",label:"Iterference Simulation"},{type:"PLMPIMMetricReference",label:"Iterference Metric"},{type:"DesignSight",label:"Physics Simulation"},{type:"Requirement",label:"Requirement"},{type:"Requirement Specification",label:"Requirement Specification"},{type:"R2V_Activity",label:"R2V_Activity"}].some((a=>{if(i.type===a.type)return U.push(a.label),k.push({labelItem:a.label+t,valueItem:i.rootID,type:i.type,setValidatedObjFromContext:G({id:i.rootID,type:i.type}),subContextId:n?n.id:void 0,subContextIcon:n?n.icon:void 0,subContextTitle:n?n.label:void 0}),e(),!0}))}}})}}))})).then((function(){K()})):K()}else H()},this.cancelExecute=function(){H()}}})})),define("DS/DMUReviewPersistence/DMUCreateReviewMarkupCmd",["DS/CATWebUXComponents/DMUCommand","DS/CATWebUXComponents/CATWebUXNotification","DS/DMUBaseExperience/DMUContextManager","DS/DMUControls/DMUInfoModalDiv","DS/DMUReviewPersistence/DMUAuthReviewPersistenceServices","DS/DMUPersistence/DMUAuthPersistenceUtils","DS/CATWebUXPreferences/CATWebUXPreferencesUtils","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUBaseExperience/EXPToolsContext","DS/DMUPersistence/DMUAuthPersistenceServices","DS/DMUReviewPersistence/DMUReviewCreationController","i18n!DS/DMUReviewPersistence/assets/nls/DMUReviewPersistence","css!DS/DMUReviewPersistence/DMUReviewPersistence.css"],(function(e,t,n,i,a,o,s,r,l,c,d,m){"use strict";return e.extend({init:function(e){e.mode="shared",e.repeatMode=!1,e.isAsynchronous=!0,this._parent(e);var u,p,g,f,h,v=this,I=e.frameWindow||this.getFrameWindow(),b=I.getViewer();let C,w,D,y=[],x=[];function R(){g=null,h&&(h.destroy(),h=null),u&&u.destroy(),D&&D.clean(),D=null,u=null,g=void 0,v.cancel()}function M(e){p&&a.createReviewMarkup({ctxViewer:p,validation:e.val,mkpName:e.markupTitle,mkpDescription:e.markupDescription,markupPLMexternalID:f,duplicatedEntity:y,hiddenElts:x,createFirstSlide:C,onMarkupCreationCompleted:function(e){h&&(h.destroy(),h=null);let t=n.giveEventsController({viewer:b});t&&t.fireEvent("onDMUMarkupCreationSucceeded",{dmuObject:e.sessionMarkup}),R()},onMarkupCreationFailed:function(e){!function(){u||(u=new t),u.build({type:"error",autoHide:!0,message:m.createReviewMarkup.errorMessage,body:I.getUIFrame()});var e=n.giveEventsController({viewer:b});e&&e.fireEvent("onDMUMarkupCreationFailed"),R()}()}})}n.setAuthoringFeatureTypes("Markup"),this.beginExecute=function(){new Promise((function(e){a.generateName({sListTypeName:[{sTypeName:"DMUValidationReviewReference"}],onGenerateNameCompleted:function(t){g=t.listNames[0].title,f=t.listNames[0].name,e(g)},ononGenerateNameFailed:function(){g=m.createReviewMarkup.defaultMarkupName,e(g)}})})).then((async function(e){try{let e=(await s.readPreferences([{Repository:"DMURepository",PreferenceNames:["CreateFirstSlide","DisplayMarkupCreationDialog"]}])).repositories[0].preferences;for(let t=0;t<e.length;t++)"CreateFirstSlide"===e[t].name?C="true"===e[t].value:"DisplayMarkupCreationDialog"===e[t].name&&(w="true"===e[t].value)}catch(e){C=!0,w=!0,window.console.warn("Could not get server value, default value set instead.",e)}if(g=e,p=n.getContextViewer({viewer:b})){var t=n.getReviewContext({context:p});if(t){var a=async function(e){(h=new i).display({modal:!0,frmWindow:I,type:"load",message:m.createReviewMarkup.loadingMessage}),x.length=0;let n="",a=t.getReviewCtxInformation();a&&a.contextId&&(n=a.contextId);let s=function(){var e=c.getPossibleRootContexts(p);if(e&&e.length){let t=r.getNodeType(e[0].getLastElement(!0));return l.getParentType(t)||t}}();if(!s||"Document"!==s&&"Requirement"!==s&&"Requirement Specification"!==s||(C=!0),C){let e=await o.getTransientMarkersAndOverloads(t,p,n);x=e.overloads,y=e.markers}M({val:t.getValidation(),markupTitle:e&&e.markup?e.markup.title:void 0,markupDescritpion:e&&e.markup?e.markup.description:void 0})},u=function(e){D&&D.clean(),a(e)};w?(D=new d,D.buildDialog({frame:I.getImmersiveFrame(),frmWindow:I,markupTabOnly:!0,inputInfos:{markupTitle:g},onProcessCreation:e=>{u(e)},onCancelCreation:function(){var e=n.giveEventsController({viewer:b});e&&e.fireEvent("onDMUMarkupCreationCancelled"),R()},onClose:R})):u()}else R()}else R()}))},this.destroy=function(){R()}}})}));