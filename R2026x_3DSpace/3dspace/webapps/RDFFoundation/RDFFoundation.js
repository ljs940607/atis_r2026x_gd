define("DS/RDFFoundation/SecurityContextUtils",["UWA/Core","DS/Foundation/WidgetAPIs","DS/Foundation/WidgetUwaUtils","DS/Foundation2/FoundationV2Data","DS/E6WCommonUI/PlatformManager"],(function(e,t,n,i,s){"use strict";var r={spaceNames:{}},o=[];r.getDefaultSecurityContext=function(){var e;if(window.enoviaServer&&window.enoviaServer.space)return window.enoviaServer.space;var t=r.getSecurityContexts();return t&&t.length&&(e=t[0].actualValue,t.some((function(t){return!!t.isDefault&&(e=t.actualValue,!0)}))),e},r.getDefaultCollabSpace=function(){var e,t=r.getSecurityContexts();return t&&t.length&&(e=t[0].csName,t.some((function(t){return!!t.isDefault&&(e=t.csName,!0)}))),e},r.getSecurityContexts=function(){return o},r.processSecurityContextData=function(e){var t=[];e.forEach((function(e){var n,i=e.name,s=e.displayName.split(".");s.length&&(n=s[s.length-1]),t.push({actualValue:i,displayValue:n,csName:e.csName,isDefault:e.isDefault})})),o=t},r.initSecurityContexts=function(){t.getSecurityContexts(r.processSecurityContextData)},r.fetchSecurityContextByRepo=function(e){const t=r.getSecurityContexts(),n=this.getDefaultSecurityContext(),i=n&&t.find((e=>e.actualValue===n));return(i&&i.csName)===e?i:(t&&t.length&&(s=t.find((t=>t.csName===e))),s);var s},r.getContentRepositories=function(t,n){var i=r.getUsersContentRepositories(),s=t.get(n);(s=e.is(s,"array")?s[0]:s,i&&s)&&(s.get("_isDriveRepositoryModel")||r.hasAccessToContentRepository(s.id)||i.push({actualValue:s.id}));return i},r.getUsersContentRepositories=function(){var e=r.getSecurityContexts(),n=[],i=Object.create(null);if(e){var s=e.slice();if(s.length>0)s[s.length-1].actualValue===t.TSK_PRIVATE_SPACE&&s.pop();s.forEach((function(e){var t=e.csName;t&&!i[t]&&(n.push({actualValue:t,displayValue:e.displayValue}),i[t]=!0)}))}return n},r.hasAccessToContentRepository=function(e){return r.getUsersContentRepositories().some((function(t){return t.actualValue===e}))},r.getContentRepositoryValuesForDetailDisplay=function(t,n){var i=n.attribute,s=r.getContentRepositories.bind(void 0,t,i);return e.merge(s,e.Class.Events.prototype),e.merge(s,e.Class.Listener.prototype),s.listenTo(t,"onChange:"+i,(function(){s.dispatchEvent("onChange")})),s},r.loadSecurityContextsForTenant=function(e){let n=e.tenant||s.getTenant();if(r.spaceNames[n])return void e.callback(r.spaceNames[n]);let o=[],a=s.getTenantServiceData(n),l=a?a["3DSpace"]:void 0;if(r.shouldShowPrivateSecurityContext()&&o.push({name:t.TSK_PRIVATE_SPACE,displayName:"Private ● "+s.getContextUserName(),csName:"TSK_privateSpace"}),l){let t=l;t+="/resources/bps/cspaces?tenant="+n,i.ajaxRequest({url:t,type:"GET",dataType:"json",data:"",noSecurityContext:!0,callback:function(t){r.spaceNames[n]=t.cspaces.concat(o),e.callback(r.spaceNames[n])}},!0)}else r.spaceNames[n]=o,e.callback(o)},r.shouldShowPrivateSecurityContext=function(e){return!1};const a=function(e,t){const n=e.split(".");return n&&n.length?n[n.length-t]:null},l=function(e,t,n){const i=e.map((e=>{if("string"==typeof e.name&&n(e))return{actualValue:e.value,displayValue:e.name}})).filter((e=>e));return i.unshift({actualValue:t.value,displayValue:t.name}),i};return r.getPreferencesCredentials=function(e){const t=widget.getPreference("collabspace"),n=e||widget.getValue("collabspace");if(t&&n)return window.enoviaServer.space=n,r.getDropdownObjects(t.options)},r.createCredentialsDropDown=function(e){let t=[];for(let i=0;i<e.length;i++){const s=e[i];t.push({label:n.getSecurityContextName(!0,s.displayName),value:s.name,displayName:s.displayName})}return r.getDropdownObjects(t)},r.getDropdownObjects=function(e){const t=r.getDefaultSecurityContext(),n=function(e){const t=[];return e.forEach((e=>{const n=a(e.displayName,1),i=t.find((e=>e.name===n)),s=a(e.displayName,2);if(i){const t=i.value.find((e=>e.name===s));t?t.value.push(e.value):i.value.push({name:s,value:[e.value]})}else t.push({name:n,value:[{name:s,value:[e.value]}]})})),t}(e),i=function(e,t){for(const n of t)for(const t of n.value)if(t.value.includes(e)){const e=n.value.findIndex((e=>e===t));return n.value.splice(e,1),n.value.unshift(t),n}return{}}(t,n);return{collabspace:l(n,i,(e=>!function(e,t){return e.some((e=>e.value.includes(t)))}(e.value,t))),organization:l(i.value,i.value.find((e=>e.value.includes(t)))||i.value[0],(e=>!e.value.includes(t)))}},r.isTSKContext=function(){return"ENOTASK_AP"===widget.getValue("appId")||"ENOTASP_AP"===widget.getValue("appId")},r})),define("DS/RDFFoundation/UserPreferences",["UWA/Core","DS/WAFData/WAFData","DS/E6WCommonUI/PlatformManager"],(function(e,t,n){"use strict";var i={setDataForUserPreference:function(t){var n={};if("undefined"==typeof widget)return n;var i=widget&&"ENOTASK_AP"===widget.getValue("appId");if(!i&&(n.taskType=this.userPreferences&&this.userPreferences.taskType),!i&&["dsplan:projectType","dsplan:schedulingStrategy","dsplan:actualDatesStrategy","hideWeekLabel"].forEach((e=>{"dsplan:projectType"===e&&(!t.isNew()||t.getParent&&t.getParent())?n[e]=this.userPreferences&&this.userPreferences[e]:n[e]=t.get(e)?t.get(e):this.userPreferences&&this.userPreferences[e]})),i){var s=e.clone(this.userPreferences||{},!1);n=s,t&&t.get("taskType")&&(n.taskType=t.get("taskType"))}return n},get:function(e){return this.getUserPreferenceData()[e]},set:function(e,t){this.getUserPreferenceData()[e]=t,this.saveUserPreferences()},setUserPreferences:function(e,t){var n=this.setDataForUserPreference(e,t);JSON.stringify(n)!==JSON.stringify(this.userPreferences)&&(this.userPreferences=n,this.saveUserPreferences())},saveUserPreferences:function(){const e=n.getServiceUrl("3dplan",!0)+"/v1/invoke/dsxplan:setUserPreference";t.authenticatedRequest(e,{method:"POST",type:"json",data:JSON.stringify([this.userPreferences]),headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},onFailure:()=>console.log("failed to set the user preferences")})},getUserPreferences:function(e){this._loading||(this._loading=!0,n.initPlatformServiceData({onComplete:()=>{const t=n.getServiceUrl("3dplan",!0)+"/v1/invoke/dsxplan:getUserPreference";(e=e||RDFUtils.request)(t,{method:"POST",type:"json",data:JSON.stringify([]),headers:{"Content-Type":"application/json"},onComplete:e=>{this._loading=!1,this._loaded=!0,this.userPreferences=e["@value"]&&JSON.parse(e["@value"])},onFailure:()=>{this._loading=!1,console.log("failed to get user preferences")}})}}))},getUserPreferenceData:function(){return this.userPreferences=this.userPreferences||{},this.userPreferences},getSpecificPreference:function(e){return this.userPreferences&&this.userPreferences[e]},getHideWeekLabel:()=>!1!==i.get(i.HIDE_WEEK),getWeekNumber:function(e){if(this._loaded,e&&!isNaN(e)&&i){var t=e.getDay();return 0==t&&(t=7),i.getHideWeekLabel()?"":" (W"+n.getWeekNumber(e)+"-"+t+")"}return""},HIDE_WEEK:"hideWeekLabel"};return i})),define("DS/RDFFoundation/FederatedSearchUtil",["UWA/Core","UWA/Class/Events","DS/WAFData/WAFData","DS/E6WCommonUI/PlatformManager","DS/E6WCommonUI/FeatureFlagUtils"],(function(e,t,n,i,s){"use strict";var r={_buildRequestData:function(t){var n=e.clone(t||{},!1),s=t.sources||[];n.source=s,delete n.sources,n&&!n.locale&&(n.locale=widget.lang||"en");var r=window.enoviaServer&&window.enoviaServer.user||window.dsUserLogin,o=this._isSynthesisTrue(n),a={label:"3dplan-"+r+"-"+Date.now(),with_synthesis:o,with_synthesis_attribute:o,order_field:"relevance",order_by:"desc",select_file:["icon","thumbnail_2d"],nresults:n.nresults||10,start:0,tenant:i.getTenant()};return e.extend(a,n),a},_isSynthesisTrue:function(e){var t=e.searchSourceTypes?Object.keys(e.searchSourceTypes):e.source||[],n=-1!==t.indexOf("swym")||-1!==t.indexOf("usersgroup");return void 0!==e.with_synthesis_attribute?e.with_synthesis_attribute&&n:n},_buildRequest:function(e){var t={method:"POST",type:"json",headers:{"Content-Type":"application/json"}};return t.data=JSON.stringify(this._buildRequestData(e)),t.onComplete=e.onComplete,t.onFailure=e.onFailure,t},escapeTwoByteChars:function(e){return e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/（/g,"\\（")).replace(/）/g,"\\）")).replace(/［/g,"\\［")).replace(/］/g,"\\］")).replace(/｛/g,"\\｛")).replace(/｝/g,"\\｝")).replace(/｟/g,"\\｟")).replace(/｠/g,"\\｠")).replace(/〖/g,"\\〖")).replace(/〗/g,"\\〗")).replace(/【/g,"\\【")).replace(/】/g,"\\】")).replace(/〚/g,"\\〚")).replace(/〛/g,"\\〛")).replace(/ー/g,"\\ー")).replace(/\u3000/g," ")},sendRequestWithDelimiter:function(e){const t=e&&e.delimeter||" OR ",n=t.length;let i="",s=0;r.promises=[];for(let o=0;o<e.query.length;o++){const a=e.query[o],l=a.length;i.length+n+l>r.QUERY_MAX_LENGTH?(r.promises.push(this._sendDelimitedRequest(i,s,e)),s=1,i=a):(s++,i+=`${s>1?t:""}${a}`)}r.promises.push(this._sendDelimitedRequest(i,s,e)),Promise.allSettled(r.promises).then((t=>{const n=e&&e.onFailure||Function.prototype,i=e&&e.onComplete||Function.prototype,s=this._combineDelimitedResults(t.filter((e=>e.value)).map((e=>e.value)));t.find((e=>"rejected"===e.status))?n(s):i(s)}))},_combineDelimitedResults:function(e){const t={infos:e[0]&&e[0].infos,results:[]};return e.forEach((e=>e.results&&t.results.push(...e.results))),t},_sendDelimitedRequest:function(t,n,i){const s=e.clone(i||{},!1);return s.searchQueryPrefix&&(t=s.searchQueryPrefix+":("+t+")"),s.query=t,s.nresults=n,new Promise(((e,t)=>{s.onComplete=e,s.onFailure=t,i.queueRequest?this._handleQueue(s):this.sendRequest(s)}))},_handleQueue:function(t){var n=e.clone(t||{},!1),i=this;return r._queue=r._queue||[],new Promise(((e,s)=>{n.onComplete=function(e){t.onComplete&&t.onComplete(e),i._requestFetch()},n.onFailure=function(e){t.onFailure&&t.onFailure(e),i._requestFetch()},r._queue.push(n),r._requestFetch()}))},_requestFetch:function(){var e=this;!r._timeout&&r._queue.length&&(r._timeout=setTimeout((function(){delete r._timeout;var t=r._queue.shift();t&&e.sendRequest(t)}),r.REQUEST_DELAY))},sendRequest:function(e){var t=i.getServiceUrl("3DSearch",!0);if(t)return t+="/search",n.authenticatedRequest(t,this._buildRequest(e))},filterSearchSources:function(e){r._validFederatedSearchSources=r._validFederatedSearchSources||{},e=e||[],Array.isArray(e)||(e=[e]);var t=e.slice(),s=i.getServiceUrl("3DSearch",!0);return s?(s&&(s&&r._validFederatedSearchSources[s]?t=e.filter((function(e){return-1!==r._validFederatedSearchSources[s].indexOf(e)})):r._gettingSources||(r._gettingSources=!0,n.authenticatedRequest(s+"/search/source",{onComplete:function(e){delete r._gettingSources,r._validFederatedSearchSources[s]=e?JSON.parse(e).source:void 0,r.eventDispatcher.dispatchEvent("onFederatedSearchSourcesLoaded")},onFailure:function(){delete r._gettingSources}}))),t):e},hasLoadedFederatedSearchSources:function(){return r._validFederatedSearchSources},getFederatedQueryCriteria:function(t){var n=e.clone(t||{},!1),i=n.criteria,s=n.fieldConfig;if(s&&"person"===s.type&&s.searchSource&&-1!==s.searchSource.indexOf("swym")&&1!==i.length)throw new Error("Invalid search criteria for person field.");return i.length>1?"("+i.join(" OR ")+")":0===i.length||0===i[0].length?"":s&&s.searchSourceTypes?i[0]+"*":i[0]},getFederatedQueryPreCondition:function(e){var t;return e&&"person"===e.type&&e.userRole&&e.searchSource&&-1!==e.searchSource.indexOf("3dspace")&&(t='userrole:"'+e.userRole+'"'),t}};return r.eventDispatcher=new t,r.QUERY_MAX_LENGTH=8192,r.REQUEST_DELAY=100,r})),define("DS/RDFFoundation/ProjectTypeUtils",["DS/E6WCommonUI/PlatformManager","UWA/Class/Events","DS/E6WCommonUI/E6WCommonUIConstants","i18n!DS/RDFFoundation/assets/nls/RDFFoundationNLS"],(function(e,t,n,i){"use strict";const s=i.get.bind(i),r=["dsplan:AgileProject","AgileProject"],o="dsplan:AgileProject",a="dsplan:Project",l=["dsplan:xProject","Enterprise Project","xProject"],c={"dsplan:Project":"RDFFoundation.Label.TeamProjectTypeHelper","dsplan:xProject":"RDFFoundation.Label.EnterpriseProjectTypeHelper","dsplan:AgileProject":"RDFFoundation.Label.AgileProjectTypeHelper"},d={"dsplan:Project":"xPlan.Label.dsplan:Project","dsplan:xProject":"xPlan.Label.dsplan:xProject","dsplan:AgileProject":"xPlan.Label.dsplan:AgileProject"},u=[o,a,l[0]];var p=new(t.extend({projectTypeList:[],loadProjectTypes:function(t){t(e.getServiceUrl("3dplan",!0)+"/v1/invoke/dsxplan:getProjectTypes?$mask=dsplan:MVMask.Template.Basic",{method:"POST",type:"json",data:JSON.stringify([]),headers:{"Content-Type":"application/json"},onComplete:e=>{this.parseProjectTypes(e),this.dispatchEvent("onChange")},onFailure:function(e){console.log(e)}})},getDefaultProjectImage:function(e,t){const i=t&&t.imageType;let s="_22.png";return i&&i===n.IMAGE_TILE_ATTR?s="_Tile.png":i&&i===n.IMAGE_THUMBNAIL_ATTR&&(s="_Thumbnail.png"),t&&t.isTemplate?require.toUrl("E6WCommonApps/assets/img/I_ProjectPlanningTemplate_Thumbnail.png"):l.includes(e)?require.toUrl("E6WCommonApps/assets/img/I_EnterpriseProject"+s):r.includes(e)?require.toUrl("E6WCommonApps/assets/img/I_AgileProject"+s):"dsplan:ProjectPlanningTemplate"===e?require.toUrl("E6WCommonApps/assets/img/I_ProjectPlanningTemplate_Thumbnail.png"):require.toUrl("E6WCommonApps/assets/img/I_TeamProject"+s)},parseProjectTypes:function(e){var t=this;if(e&&e.member){let n=e.member.map((function(e){let n=t.getDefaultProjectImage(e["@id"]);return{actualValue:e["@id"],displayValue:e["dskern:nlsLabel"],icon:n}}));n.sort(((e,t)=>e.actualValue===a?-1:t.actualValue===a?1:e.actualValue<=t.actualValue?-1:1)),this.setProjectTypes(n)}},setProjectTypes:function(e){this.projectTypeList=e},getProjectTypes:function(){let e=u;return this.projectTypeList.length>0&&(e=this.projectTypeList.map((e=>e.actualValue)),e=e.filter((e=>e!==n.PROJECT_TEMPLATE_TYPE))),e},getCreateProjectTypes:function(e){let t=e&&e.projectTypes?e.projectTypes:[...this.projectTypeList];return t=t.filter((e=>e.actualValue!==n.PROJECT_TEMPLATE_TYPE)),t},getEditProjectTypes:function(){let e=this.getCreateProjectTypes();return e=e.filter((e=>e.actualValue!==o)),e},getHelperText:function(e){return s(c[e])},getProjectLabel:function(e){return s(d[e])},getLabel:function(e){return this.isTemplate(e)?s("xPlan.Label.Template"):s("xPlan.Label."+e.get("dsplan:projectType"))},isTemplate:function(e){return this.isProject(e.get("dsxplan:jsType"))&&Boolean(e.get("dsplan:isTemplate"))},isProject:function(e){return"dsplan:Project"===e||"dsplan:xProject"===e||e===o},isScenario:function(e){return"dsplan:Experiment"===(e.get("dsplan:jsType")||e.get("dsxplan:jsType"))},getProjectTypeData:function(e){return this.projectTypeList.find((t=>t.actualValue===e))||{}}}));return p.AGILE_PROJECT=o,p.TEAM_PROJECT=a,p.ENTERPRISE_PROJECT=l[0],p})),define("DS/RDFFoundation/Mixins/FetchTrackingMixin",[],(function(){"use strict";const e={initFetchTrackingMixinForInstance:function(){this._completeCount=0,this._fetchCount=0},initFetchTrackingMixinForClass:function(t){Object.defineProperty(t.prototype,"fetching",e.fetchingPropertyDefinition),Object.defineProperty(t.prototype,"completing",e.completingPropertyDefinition)},allFetchesUseComplete:function(){return this._completeCount===this._fetchCount},handleBadFetchCounts:function(e){this[e]<0&&(this[e]=0,console.error(`tried to set ${e} to a negative value`))},fetchingPropertyDefinition:{get:function(){return this._fetchCount>0},set:function(e){return!1===e?(this._fetchCount--,this.handleBadFetchCounts("_fetchCount")):this._fetchCount++,this.dispatchEvent("onFetchCountChanged"),this.fetching}},completingPropertyDefinition:{get:function(){return this._completeCount>0},set:function(e){return!1===e?(this._completeCount--,this.handleBadFetchCounts("_completeCount")):this._completeCount++,this.fetching=e,this.completing}}};return e})),define("DS/RDFFoundation/RequestUtils",["UWA/Core"],(function(e){"use strict";var t={addNecessaryHeadersAndParams:function(e){e.headers||(e.headers={}),"GET"!==e.method&&"OPTIONS"!==e.METHOD&&(e.headers["X-Requested-With"]="XMLHttpRequest"),"POST"===e.method&&(e.url.match(/\/invoke/)&&(e.headers["Content-Type"]=e.headers["Content-Type"]?e.headers["Content-Type"]:"application/json",e.data||(e.data="[]"),!e.headers["Request-Timeout"]&&e.url.match(/3dplan/)&&(e.headers["Request-Timeout"]=1800)),"json"!==e.type&&(e.headers.Accept="multipart/mixed,application/json")),!e.headers["Accept-Language"]&&(e.headers["Accept-Language"]=window.widget&&window.widget.lang||window.dsLang);var n=window.widget&&window.widget.getValue("overrideTenant");n&&(e.url=t.addQueryParam(e.url,"tenant","dstenant:"+n,!0))},addQueryParam:function(t,n,i,s){return e.is(i)?t+(-1===t.indexOf("?")?"?":"&")+n+"="+(s?encodeURIComponent(i):i):t},addQueryParams:function(e,n){return n.forEach((function(n){e=t.addQueryParam(e,n.name,n.value,n.encode)})),e}};return t})),define("DS/RDFFoundation/CustomExtensionUtils",["DS/E6WCommonUI/PlatformManager","DS/E6WCommonUI/E6WCommonUIConstants","i18n!DS/RDFFoundation/assets/nls/RDFFoundationNLS"],(function(e,t,n){"use strict";n.get.bind(n);const i={customExtensionMap:{},customAttrsMap:{},customAttrCols:[],fetchExtensions:function(t){t(e.getServiceUrl("3dplan",!0)+"/v1/invoke/dsxplan:getExtensions",{method:"POST",type:"json",headers:{"Content-Type":"application/json"},onComplete:function(e){i.parseExtensions(e)},onFailure:function(e){console.log(e)}})},parseExtensions:function(e){if(e&&e.member){var t=e.member,n=["dsplan:Project","dsplan:xProject","dsplan:AgileProject","dsplan:Task","dsplan:Milestone","dsplan:Gate"],s=[],r={};if(t)for(var o=0;o<n.length;o++){var a=t.filter((e=>e.taxonomy===n[o]));if(0!==a.length){s=[];for(var l=0;l<a[0].extensions.member.length;l++)s.push({value:a[0].extensions.member[l]["@id"],label:a[0].extensions.member[l].label});r[n[o]]=s}}i.setExtensions(r)}},setExtensions:function(e){i.customExtensionMap=e},getExtensionsForTaxonomy:function(e){return i.customExtensionMap[e]}};return i})),define("DS/RDFFoundation/Models/ObjectProxyUtil",["UWA/Core","DS/WAFData/WAFData","DS/i3dxUtils6W/i3dxUtils","DS/E6WCommonUI/PlatformManager","DS/E6WCommonUI/UIHelper","DS/E6WCommonUI/E6WCommonUIConstants","i18n!DS/RDFFoundation/assets/nls/RDFFoundationNLS"],(function(e,t,n,i,s,r,o){"use strict";var a={};const l="bigIcon";n.initRegistry(),a.getDate=function(e){var t=new Date(e);return"Invalid Date"===t.toString()&&(t=new Date(1e3*parseInt(e,10))),"Invalid Date"!==t.toString()?t:e};const c={id:"resourceid",type:"ds6w:type",extension:"ds6w:docextension",icon:"type_icon_url",image:"preview_url",kind:"ds6w:kind",linkURL:"linkURL",islast:"islast",revision:"revision",description:"description",stateNLS:"ds6w:what/ds6w:status",ownerFullname:"ds6w:responsible",[l]:l};a.convertServiceResponseToFederatedFormat=function(t){var n=[];t=e.is(t,"array")?t:[t];for(var i,r=0;r<t.length;r++){var o=t[r];s.isIconURL(o.image)&&(o[l]=o.image,delete o.image);let e={attributes:[{name:"ds6w:label",value:(i=o,i.title?i.title:i.name)},{name:"files",value:o.hasfiles||""},{name:"ds6w:modified",value:a.getDate(o.modified)},{name:"ds6w:created",value:a.getDate(o.created)}]};for(const t in c)Object.hasOwn(c,t)&&Object.hasOwn(o,t)&&e.attributes.push({name:c[t],value:o[t]});n.push(e)}return n},a.i3dxKeyMap={"ds6w:icon":"type_icon_url","ds6w:previewURL":"preview_url"},a.sendRequest=function(t,n){var s=require("DS/DocumentManagement/ObjectInfoService");if(t["3dspace"]&&t["3dspace"].length>0){let i=e.clone(n||{},!1);var r="$fields=all,islast";i.additionalURLParams=i.additionalURLParams?i.additionalURLParams+"&"+r:r,i.responsePreprocessor=a.convertServiceResponseToFederatedFormat,a.sendRequestHelper(s,t["3dspace"],"3dspace",i)}if(t.drive&&t.drive.length>0){var o=require("DS/DocumentManagement/DriveDocumentManagement");let i=e.clone(n||{},!1);i.tenantUrl=window.enoviaServer["3DDrive"],i.tenant=widget.getValue("x3dPlatformId")||widget.getValue("tenant"),i.responsePreprocessor=a.convertServiceResponseToFederatedFormat,a.sendRequestHelper(o,t.drive,"drive",i)}if(t.i3dx&&t.i3dx.length>0){let i=e.clone(n||{},!1);i.responsePreprocessor=e=>e.map((e=>({attributes:Object.keys(e).map((t=>({name:a.i3dxKeyMap[t]||t,value:e[t]})))}))),a.sendRequestHelper(a,t.i3dx,"i3dx",i)}t.businessprocess&&t.businessprocess.length>0&&require(["DS/RDFFoundation/BusinessProcessUtils"],(function(s){let r=e.clone(n||{},!1);r.tenantUrl=i.getServiceUrl("businessprocess"),r.tenant=i.getTenant(),r.responsePreprocessor=t=>(e.is(t,"object")&&(t.resourceid=t.id,t=[t]),t.map((e=>({attributes:Object.keys(e).map((t=>({name:t,value:e[t]})))}))));for(let e=0;e<t.businessprocess.length;e++)r.proxyType=t.businessprocess[e].proxyType,a.sendRequestHelper(s,t.businessprocess[e].id,"businessprocess",r)}))},a.sendRequestHelper=function(n,s,r,a){var l=e.clone(a||{},!1);let c=e=>{let t=e;l.responsePreprocessor&&(t=l.responsePreprocessor(e)),l.onComplete&&l.onComplete(t,r)},d=(e,n)=>{let r=[];for(const t of s)e[t]||r.push({id:t});if(r.length){let e=i.getServiceUrl("3DSpace",!0)+"/resources/v1/application/E6WFoundation/CheckObjectExistence";return t.authenticatedRequest(e,{type:"json",headers:{"Content-Type":"application/json"},method:"POST",data:JSON.stringify({data:r}),contentType:"application/json",onComplete:e=>{if(e.success)for(const t of e.data)"FALSE"===t.exists&&(n.push(t),t.type="DELETED",t.title=o.get("RDFFoundation.Label.Deleted"));c(n)},onFailure:e=>{console.error("CheckObjectExistence returned: "+e),c(n)}}),!1}return!0};n.getObjects(s,{tenantUrl:l.tenantUrl,tenant:l.tenant,additionalURLParams:l.additionalURLParams,proxyType:l.proxyType,onComplete:function(e){if(e&&e.data&&(e=e.data),"3dspace"===r){let t={};for(const n of e)t[n.id]=n;if(!d(t,e))return}c(e)},onFailure:function(){if("3dspace"===r){d({},[])}else l.onFailure&&l.onFailure("object_not_found",r,s)}})},a.split3dx=n.split3dx;return a.supportedi3dx=function(e){return!!n.getDomainByI3dx(e)},a.getObjects=function(e,s){let r=n.getFetchForResources(e);for(const e of r){let n=i.getServiceUrl(e.service,!0)+e.URL+"?include=ds6w%3Akind%2Cds6w%3Aicon%2Cds6w%3ApreviewURL";if(n){var o;let r=a=>{let l=o.getDefaultSecurityContext();l=l&&l.split("::")[1];let c=0,d={"Content-Type":"application/json"};l&&(d.SecurityContext=l),t.authenticatedRequest(n,{type:"json",headers:d,method:"POST",data:JSON.stringify(e.payload),contentType:"application/json",onComplete:s&&s.onComplete,onFailure:function(){401!==c||a||"mbseapps"!==e.service?s&&s.onFailure():(a=!0,t.authenticatedRequest(i.getServiceUrl(e.service,!0)+"/resources/v1/modeler/dssyseng/version",{method:"GET",contentType:"*/*",headers:{Accept:"*/*"},onComplete:function(e){console.log(e),r(!0)}}))},onProgress:function(e){console.log("onprogress"),c=e.currentTarget.status}})};try{o=require("DS/RDFFoundation/SecurityContextUtils"),r()}catch(e){require(["DS/RDFFoundation/SecurityContextUtils"],(e=>r()))}}}},a.BIG_ICON=l,a})),define("DS/RDFFoundation/Models/RDFFoundationConstants",[],(function(){"use strict";return{dslcMapping:{title:"dsxplan:label","dskern:label":"dsxplan:label","dsplan:durationIntervalMin":"dsxplan:durationIntervalMin","dsplan:estimatedStartDate":"dsxplan:estimatedStartDate","dsplan:accumulatedStoryPoints":"dsxplan:accumulatedStoryPoints","dsplan:estimatedEndDate":"dsxplan:estimatedEndDate","dsplan:comment":"dsxplan:comment","dsplan:sequenceOrder":"dsxplan:sequenceOrder","dsplan:durationIntervalMax":"dsxplan:durationIntervalMax","dsplan:estimatedDuration":"dsxplan:estimatedDuration","dsplan:endDateIntervalMin":"dsxplan:endDateIntervalMin","dsplan:endDateIntervalMax":"dsxplan:endDateIntervalMax","dsplan:startDateIntervalMax":"dsxplan:startDateIntervalMax","dsplan:startDateIntervalMin":"dsxplan:startDateIntervalMin","dsplan:solveStart":"dsxplan:solveStart","dsplan:solveEnd":"dsxplan:solveEnd","dsplan:percentageCompletion":"dsxplan:percentageCompletion","dsplan:actualStartDate":"dsxplan:actualStartDate","dsplan:actualEndDate":"dsxplan:actualEndDate","dsplan:actualDeliverable":"dsxplan:actualDeliverable","dscom:hasMaturity":"dsxplan:hasMaturity","dsplan:userDefinedDates":"dsxplan:userDefinedDates","dsplan:userDefinedStart":"dsxplan:userDefinedStart","dsplan:userDefinedEnd":"dsxplan:userDefinedEnd","dsplan:hasAssignee":"dsxplan:hasAssignee","dsplan:requiresSkill":"dsxplan:requiresSkill","rdf:type":"dsxplan:type",subtitle:"dsxplan:comment","dsplan:hasAttachment":"dsxplan:hasAttachment","dsplan:hasPriority":"dsxplan:hasPriority","dsplan:hasCommunity":"dsxplan:hasCommunity","dsplan:hasSubtask":"dsxplan:hasSubtask","dsplan:estimatedDate":"dsxplan:estimatedDate","dsplan:dateIntervalMax":"dsxplan:dateIntervalMax","dsplan:dateIntervalMin":"dsxplan:dateIntervalMin","dsplan:actualDate":"dsxplan:actualDate","dspol:modificationDate":"dsxplan:modificationDate","dsplan:suggestedDate":"dsxplan:suggestedDate","dsplan:ScheduleUpdateStatus":"dsxplan:ScheduleUpdateStatus","dsplan:schedulingStrategy":"dsxplan:schedulingStrategy","dskern:image":"dxplan:image","dsplan:hasThumbnail":"dsxplan:hasThumbnail","dsplan:hasWorkContext":"dsxplan:hasWorkContext","dsplan:hasWorkDecomposition":"dsxplan:hasWorkDecomposition","dsplan:hasTask":"dsxplan:hasTask","dsplan:hasBacklogTask":"dsxplan:hasBacklogTask","dsplan:hasMilestone":"dsxplan:hasMilestone","dsplan:hasGate":"dsxplan:hasGate","dsplan:hasReferenceProject":"dsxplan:hasReferenceProject","dsplan:hasContentRepository":"dsxplan:hasContentRepository","dsplan:scheduleCalendar":"dsxplan:scheduleCalendar","dsplan:reminderDays":"dsxplan:reminderDays","dsplan:enterpriseIdentificationNumber":"dsxplan:enterpriseIdentificationNumber","dsplan:vocabularyType":"dsxplan:vocabularyType","dsplan:jsType":"dsxplan:jsType","dsplan:usesCalendar":"dsxplan:usesCalendar"}}})),define("DS/RDFFoundation/MaskUtils",["UWA/Core"],(function(e){"use strict";var t,n;require(["text!DS/RDFFoundation/assets/maskDefinition.json"],(function(e){e=JSON.parse(e),t=e.masks,n=e.maskBreakdownArray}),(function(){require(["text!DS/RDFFoundation/assets/maskDefinition_prebuilt.json"],(function(e){e=JSON.parse(e),t=e.masks,n=e.maskBreakdownArray}))}));var i={isSubMask:function(e,t){return t.some((function(t){return e===t||n[t]&&n[t].includes(e)}))},addAttributeToMask:function(e,t,n){i.addMask(e)[t]=n},addMask:function(e){var n=t[e];return n||(n=t[e]={}),n},getMask:function(e){return t[e]},getAllMasks:function(){return t},resetMaskContent:function(n){t=e.clone(n||{})},getMinMaskArray:function(s,r){var o=e.clone(r||{},!1),a=o.level||0;let l,c=[],d=0,u=[];return a>3?s:(o.attributes&&o.attributes.length>0&&(s=s.filter((e=>o.attributes.some((n=>t[e].hasOwnProperty(n)))))),s.forEach((e=>{let t=n[e]?n[e]:[],i=s.filter((e=>t.includes(e)));i.push(e),i.length>d&&(d=i.length,l=e,u=i)})),l&&c.push(l),d!==s.length&&(c=c.concat(i.getMinMaskArray(s.filter((e=>!u.includes(e))),{attributes:[],level:++a}))),c)},ARRAY_ATTR:"array",COLLECTION_ATTR:"collection",MODEL_ATTR:"model",STRING_ATTR:"string"};return i})),define("DS/RDFFoundation/MemberUtils",["UWA/Core","DS/RDFFoundation/FederatedSearchUtil","DS/E6WCommonUI/PlatformManager","DS/WAFData/WAFData"],(function(e,t,n,i){"use strict";var s="uuid:",r="iam:",o=/^(uuid:|mailto:|iam:)/g,a={userMap:{},idAttributeForFederatedSearch:"ds6w:resourceUid",addUserUIdToMap:function(e,t){e!==t&&(a.userMap[e]=t)},escapeRegExp:function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},findAndGetSwymPersonResourceUid:function(n){var i=e.clone(n||{},!1),s=i.searchOptions,r=s.id,o=n.dropObj&&n.dropObj.objectType||n.detailedObject&&n.detailedObject["ds6w:type"],l=this._getDefaultSearchAttributes(r,o);e.extend(l,s),t.sendRequest({select_predicate:l.select_predicate,sources:[l.source],query:l.query,nresults:1,onComplete:function(e){var t=!0,n=e.results;if(n&&n.length)for(var s=n[0].attributes,r=s.length,o=0;o<r;o++)if(s[o].name===a.idAttributeForFederatedSearch){var c=s[o].value;l.callback&&l.callback(c,i),t=!1;break}t&&l.onFailure&&l.onFailure()},onFailure:function(){l.onFailure&&l.onFailure()}})},getContextUserUid:function(t){var s=e.clone(t||{});let r=n.getServiceUrl("3DSwym",!0)+"/api/index/tk";i.authenticatedRequest(r,{method:"GET",onComplete:e=>{let t=JSON.parse(e).result.ServerToken;i.authenticatedRequest(n.getServiceUrl("3DSwym",!0)+"/api/user/getcurrent",{method:"POST",type:"json",data:JSON.stringify({params:{detailedView:!1,get_autosaved_content:!0}}),headers:{"Content-Type":"application/json","X-DS-SWYM-CSRFTOKEN":t},onComplete:e=>{let t=e.result;a.addUserUIdToMap(t.login,a.addUUIDToURI(t.uid)),n.setContextUserUid(t.uid),s.onComplete&&s.onComplete(t.uid)},onFailure:()=>{console.error("Unable to retrieve current user information from 3DSwym"),s.onFailure&&s.onFailure()}})},onFailure:()=>{console.error("Unable to retrieve current user information from 3DSwym"),s.onFailure&&s.onFailure()}})},setContextUserUid:function(t){let i=e.clone(t||{});n.getServiceUrl("3DSwym",!0)?this.getContextUserUid(i):n.addEventOnce("serviceDataLoaded",a.getContextUserUid.bind(this,i))},_getDefaultSearchAttributes:function(e,t){var n,i;return t&&"foaf:Group"===t||"Group"===t?(n="usersgroup",i=["[ds6w:resourceUid]",':("',e,'")'].join("")):(n="swym",i=["resourceid",':("',e,'")'].join("")),{source:n,query:i,select_predicate:["resourceid","ds6w:resourceUid"]}},getPersonMask:function(){return"dsplan:MVMask.Person.Complex"},addUUIDToURI:function(t,n){var i=n&&n.detailedObject&&("foaf:Group"===n.detailedObject["ds6w:type"]||"Group"===n.detailedObject["ds6w:type"]),r=n&&n.dropObj&&("foaf:Group"===n.dropObj.objectType||"Group"===n.dropObj.objectType);return i||r||!t||!e.is(t,"string")||t.match(o)?t:[s,t].join("")},removeUUIDFromURI:function(t){return t&&e.is(t,"string")&&t.startsWith(s)&&(t=t.replace(s,"")),t},addIamToURI:function(t){return t&&e.is(t,"string")&&!t.match(o)?[r,t].join(""):t},preProcessPersonObject:function(e,t){return"pno:Person"===t["ds6w:type"]&&(e=a.addUUIDToURI(e)),e},typeAheadCallback:function(e,n,i){return t.sendRequest({select_predicate:["ds6w:label","ds6w:resourceUid","ds6w:type","ds6w:type_value","type_icon_url","preview_url","login"],sources:t.filterSearchSources(["swym","usersgroup"]),query:'[ds6w:type]:("foaf:Group" OR "pno:Person")',specific_source_parameter:{usersgroup:{additional_query:" AND [ds6w:label]:("+a.escapeRegExp(e)+"*)"},swym:{additional_query:" AND personOrGroup:("+e+")"}},with_synthesis_attribute:!0,onComplete:i.onComplete&&i.onComplete.bind(void 0,n,i)})},isPendingUser:function(e){var t=e.get("resourceid"),n=e.get("dsaccess:state");return!(!t&&!n)&&(t&&t.startsWith("mailto:")||n&&"pending"===n)},getAccountNameForUser:function(e,t){var n=e.startsWith("mailto:")?t:e;return n&&n.split(":")[1]},getLabelForUserGroup:function(e){return e.detailedObject?e.detailedObject.label?e.detailedObject.label:e.detailedObject["ds6w:label"]:e.dropObj?e.dropObj.objectType:void 0},getUserNameForSwymUserProfile:function(e){var t=e.get("resourceid");return t&&t.startsWith("iam:")?t.split(":")[1]:e.get("dsaccess:accountName")}};return a})),define("DS/RDFFoundation/BatchBuilder",["UWA/Core","UWA/Utils","UWA/Class","DS/RDFFoundation/RequestUtils"],(function(e,t,n,i){"use strict";var s="\r\n\r\n",r=n.extend({init:function(e){this.ajax=this.ajax.bind(this),this.requests=[],this._baseUrl=e.baseUrl,this._ajax=e.ajax},ajax:function(t,n){var i=e.clone(n||{},!1);i.url=t,this.requests.push(i)},addRequestsFromBatch:function(e){this.requests.push.apply(this.requests,e.requests)},_sendSingleRequest:function(t,n,i){var s=i,r=n,o=t,a=r.onComplete&&s.onComplete,l=r.onFailure&&s.onFailure,c=i.waitOnInFlightRequests;if(a||l||c){var d=(r=e.clone(r,!1)).onComplete,u=r.onFailure;r.onComplete=a?function(){d&&d.apply(this,arguments),s.onComplete&&s.onComplete.apply(this,arguments)}:d||s.onComplete,r.onFailure=l?function(){u&&u.apply(this,arguments),s.onFailure&&s.onFailure.apply(this,arguments)}:u||s.onFailure,c&&(r.waitOnInFlightRequests=c)}return o(r.url,r)},sendBatch:function(n){var s,o,a,l=n&&n.ajax||this._ajax,c=this.requests;if(0===c.length)return n&&e.is(n.onComplete,"function")&&n.onComplete(),{cancel:function(){}};var d=e.clone(n||{},!1);if(1===c.length)return this._sendSingleRequest(l,c[0],d);var u=t.getUUID(),p="batch_"+u,h="changeset_"+u,g="\r\n--"+p+"\r\nContent-Type: multipart/mixed;boundary="+h+"\r\n\r\n",f=this._baseUrl.length;s=c.length;var m=1;for(a=0;a<s;a++){if((o=c[a]).changeset=h,o.newTransaction&&a&&(g+="--"+h+"--\r\n",g+="--"+p+"\r\n",g+="Content-Type: multipart/mixed;boundary="+(h="changeset_"+(u=t.getUUID()))+"\r\n\r\n"),g+="--"+h+"\r\n",g+="Content-Type: application/http\r\nContent-Transfer-Encoding: binary\r\nContent-ID: "+(o.id||m++)+"\r\n\r\n",g+=o.method+" "+o.url.substring(f)+"\r\n",i.addNecessaryHeadersAndParams(o),o.headers)for(var y=Object.keys(o.headers),v=y.length,C=0;C<v;C++){var F=y[C];g+=F+": "+o.headers[F]+"\r\n"}g+="\r\n",g+=(o.data||"")+"\r\n"}return g+="--"+h+"--\r\n--"+p+"--",d.method="POST",d.data=g,d.headers={"Content-Type":"multipart/mixed;boundary="+p},d.url=this._baseUrl+"batch",d.responseType="text",d.batchRequest=!0,d.onComplete=function(t){var i=r.parseBatchRequest(t),a=i.length,l=0;s=c.length;for(var d,u=function(t,n){var i=this[n],s=i.data;2===Math.floor(i.status/100)?("json"===t.type&&(s=JSON.parse(s)),e.is(t.onComplete,"function")&&t.onComplete(s,i.headers)):e.is(t.onFailure,"function")&&t.onFailure(i.data,i.headers)},p=function(t){if("string"==typeof this.data)try{this.data=JSON.parse(this.data)}catch(e){this.data={msg:this.data}}this.data["@code"]=this.status,e.is(t.onFailure,"function")&&t.onFailure(new Error('NetworkError: URL "'+t.url+'" return ResponseCode with value "'+(this.status||0)+" "+(this.statusText||"")+'".'),this.data,this.headers)},h=0;h<a;h++){d=i[h];for(var g=[];l<s;l++){if((o=c[l]).newTransaction&&l){o.newTransaction=!1;break}g.push(o)}if(e.is(d,"array")){if(d.length!==g.length)throw new Error("expecting "+g.length+" response.  Got "+d.length);g.forEach(u,d)}else g.forEach(p,d)}n&&e.is(n.onComplete,"function")&&n.onComplete(t)},d.onFailure=function(){for(s=c.length,a=0;a<s;a++)o=c[a],e.is(o.onFailure,"function")&&o.onFailure.apply(this,arguments);n&&e.is(n.onFailure,"function")&&n.onFailure.apply(this,arguments)},d.onTimeout=function(){for(s=c.length,a=0;a<s;a++)o=c[a],e.is(o.onTimeout,"function")?o.onTimeout.apply(this,arguments):e.is(o.onFailure,"function")&&o.onFailure.apply(this,arguments);n&&e.is(n.onFailure,"function")&&n.onFailure.apply(this,arguments)},d.ignoreDictionary=!0,l(d.url,d)}});return r.parseBatchRequest=function(e){var t=e,n=t.indexOf("\r\n",1),i=t.substr(0,n),r=t.split(i),o=r.length,a=[];a.boundary=i;for(var l=function(e){if(e.length){var t=e.match(/([^:]*):(.*)/);t&&(this[t[1]]=t[2])}},c=function(e){var t=e.trim().split(s,2),n=t[0].split("\r\n");if(n.length>1){var i={};n.forEach(l,i);var r=t[1],o=r.split("\r\n"),c=o.shift(),d=c.match(/(POST|GET|PATCH|DELETE|PUT)[ ]+(.*)/),u=c.match(/HTTP\/1\.1[ ]+([0-9]+)[ ]+(.*)/),p={data:e.substr(t[0].length+8+r.length),partHeader:i};return d?(p.url=d[2],p.method=d[1]):u&&(p.status=parseInt(u[1],10),p.statusText=u[2]),i={},o.map(l,i),p.headers=i,p}return a},d=1;d<o-1;d++){var u=r[d],p=u.match(/Content-Type:\s*multipart\/mixed;boundary=(.*)/);if(p){var h=p[1],g=u.split("--"+h);g.pop(),g.shift();var f=g.map(c.bind(this));f.boundary=h,a.push(f)}else a.push(c.call(this,u))}return a},r.batchResponseHasAFailure=function(t){var n;if(e.is(t,"string"))n=r.parseBatchRequest(t);else{if(e.is(t,"object"))return!1;if(!e.is(t,"array"))return console.error("unexpected batch response type"),!0}return n.find((t=>!e.is(t,"array")))},r})),define("DS/RDFFoundation/RDFUtils",["UWA/Core","UWA/Utils","UWA/Utils/Cookie","DS/WAFData/WAFData","DS/WebappsUtils/WebappsUtils","DS/PlatformAPI/PlatformAPI","DS/RDFFoundation/FederatedSearchUtil","DS/RDFFoundation/BatchBuilder","DS/RDFFoundation/RequestUtils","DS/RDFFoundation/MemberUtils","DS/RDFFoundation/ProjectTypeUtils","DS/RDFFoundation/UserPreferences","DS/RDFFoundation/CustomExtensionUtils","DS/E6WCommonUI/PlatformManager","DS/E6WCommonUI/Search","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],(function(e,t,n,i,s,r,o,a,l,c,d,u,p,h,g,f){"use strict";var m,y=864e5,v=/(-)?P(?:([0-9]+|NaN)D)?T?(?:([0-9]+|NaN)H)?(?:([0-9]+|NaN)M)?(?:([0-9.]+|NaN)S)?/,C={"3dspace":"3DSpace","3dmessaging":"3DMESSAGING",drive:"3DDrive",swym:"3DSwym",geovia:"geoservice","3dportfolio":"3dportfolio"},F={dsxplan:"http://www.3ds.com/RDF/Corpus/xPlan/",dsplan:"http://www.3ds.com/RDF/Corpus/Plan/",dskern:"http://www.3ds.com/RDF/Corpus/Kernel/",dspol:"http://www.3ds.com/RDF/Corpus/Policy/",dscom:"http://www.3ds.com/RDF/Corpus/com/",ds6w:"http://www.3ds.com/vocabularies/ds6w/",dsbase:"http://www.3ds.com/RDF/Corpus/dsbase/",iam:"http://iam.3ds.com/",dsaccess:"http://www.3ds.com/RDF/Corpus/Access/",w3:"http://www.w3.org/1999/02/"},_=function(e){for(var t={},n=Object.keys(e),i=n.length,s=0;s<i;s++){var r=n[s];t[e[r]]=r}return t};function D(e,t){e._onRequest&&e._onCompleteRequest&&e._onRequest(),t&&e.fetchingMask(t),e.completing=!0}var S={cancel:function(){var e=this.options.queue||m;if(this.actualRequest)delete this.options.onComplete,this.actualRequest.cancel&&this.actualRequest.cancel(),this.removeFromInFlightRequest();else{var t=m._pendingRequests.indexOf(this);e._pendingRequests.splice(t,1)}},onComplete:function(t){var n=this.options.queue||m;this.options.invokeAsLRT||this.removeFromInFlightRequest(),t&&t.httpStatusCode>400?e.is(this._onFailure,"function")&&this._onFailure(t):e.is(this._onComplete,"function")&&this._onComplete.apply(this,arguments),this.options.invokeAsLRT||m.sendPendingRequests(n)},onFailure:function(){var t=this.options.queue||m;this.removeFromInFlightRequest(),e.is(this._onFailure,"function")&&this._onFailure.apply(this,arguments),m.sendPendingRequests(t)},onTimeout:function(){var t=this,n=this.options.queue||m;e.is(this._longRunningOperationTimeoutCallback,"function")?this._longRunningOperationTimeoutCallback({onComplete:function(){var n=t.options.queue||m;t.removeFromInFlightRequest(),e.is(t._onTimeout,"function")&&t._onTimeout.apply(t,arguments),m.sendPendingRequests(n)},onFailure:function(){t.onFailure.apply(t,arguments)}}):(this.removeFromInFlightRequest(),e.is(this._onTimeout,"function")?this._onTimeout.apply(this,arguments):e.is(this._onFailure,"function")&&this._onFailure.apply(this,arguments),m.sendPendingRequests(n))},removeFromInFlightRequest:function(){var e=this.options.queue||m,t=e._inFlightRequests.indexOf(this);e._inFlightRequests.splice(t,1),e!==m&&(t=m._inFlightRequests.indexOf(this),m._inFlightRequests.splice(t,1))}};return m={RESTRICTED_PROPERTIES:{},MAX_CONCURRENT_REQUEST:20,TAGGER_URI_PREFIX:"dsplan:",WEDO_TAGGER_URI_PREFIX:"swym:wedo%3Aeoe%3A",_inFlightRequests:[],_pendingRequests:[],DOWNLOADABLE_TYPES:["MS Word Document","MS Excel Document","MS Powerpoint Document","MS Outlook Document","MS Word Template","MS Excel Template","MS Powerpoint Template","MS Outlook Template","Document","DriveFile"],EDITABLE_TYPES:["MS Word Document","MS Excel Document","MS Powerpoint Document","MS Outlook Document","MS Word Template","MS Excel Template","MS Powerpoint Template","MS Outlook Template","MS Outlook Attachment","Document"],inverseMapping:_,sourceToServiceMap:C,serviceToSourceMap:_(C),serviceFromSource:function(e){return m.sourceToServiceMap[e]||e},sourceFromService:function(e){return m.serviceToSourceMap[e]||e},serviceArrayFromSourceArray:function(e){return e.map(m.serviceFromSource)},_computeTypeAheadEntryBasedOnFedSearchResult:function(e){for(var t=e.attributes,n=t.length,i={},s=0;s<n;s++){var r=t[s],o=r.value;switch(r.name){case"resourceid":i.value=o;break;case"ds6w:resourceUid":o=c.preProcessPersonObject(o,i),i.resourceUid=o;break;case"preview_url":i.image=o;break;case"ds6w:type":case"ds6w:what/ds6w:type":i["ds6w:type"]=o;break;case"ds6w:label":i.label=o;break;case"sourceid":i.sourceId=o;break;default:i[r.name]=o}}return i},onTypeAheadComplete:function(t,n,i){var s=(e.is(i,"string")?JSON.parse(i):i).results,r=[];if(s)for(var o=s.length,a=0;a<o;a++){var l=s[a],c=m._computeTypeAheadEntryBasedOnFedSearchResult(l);if(n.fieldConfig&&"dsplan:hasWorkContext"===n.fieldConfig.name){var d=n.model.get(n.fieldConfig.name),u=m.removeBracketLongURI(c.resourceUid)||c.sourceId;if(d||u===n.model.id)(d&&d.id)!==u&&u!==n.model.id&&r.push(c);else r.push(c)}else r.push(c)}t(r,n)},typeAheadCallback:function(t,n,i,s){var r=e.clone(s||{},!1);r.fieldConfig=t,n=o.escapeTwoByteChars(n);var a,l,c=o.filterSearchSources(t.searchSource);return window.widget.getValue("oldSearch")?a="("+n+"* OR "+n+")":(a=(a=n.split(",").map((function(e){return e.trim()}))).filter((function(e){return e})),a=o.getFederatedQueryCriteria({criteria:a,fieldType:t.type,fieldConfig:t}),l=o.getFederatedQueryPreCondition(t)),o.sendRequest({select_predicate:["ds6w:label","ds6w:resourceUid","ds6w:type","ds6w:type_value","type_icon_url","preview_url","login"],sources:c,query:a,precond:l,specific_source_parameter:g.computeSourceParameters(t,n),with_synthesis_attribute:void 0!==t.with_synthesis_attribute?t.with_synthesis_attribute:(c||[]).includes("swym"),onComplete:m.onTypeAheadComplete.bind(void 0,i,r),onFailure:m.onTypeAheadComplete.bind(void 0,i,r)})},complete:function(t,n,i){var s=e.clone(i||{},!1),r=s.batchGenerator,o=s.mask;if(o&&"undefined"!==o){var a=function(t,n,i){var s=e.clone(i||{}),r=[],o=s.mask;delete s.mask;for(var a=0;a<n.length;a++){var l=m.getObjectForAdding(t,n[a],s);if(l){if(!l.id||s.onlyIfNeeded&&o&&l.hasDataForMask(o,{checkFetching:!0}))continue;D(l,o),r.push(l)}else r.push({id:n[a]})}return r}(t,n,s);if(0!==a.length)for(var l=function(e){e.forEach((function(e){var t=m.getObjectById(e);t&&(t._onCompleteRequest&&t._onCompleteRequest(),t.doneFetchingMask(o),t.completing=!1)}))},c=s.onComplete,d=s.onFailure,u=function(e,t){!function(e,t){const n={...t||{}};(e.member||[]).forEach((function(e){if(404===e.error||401===e.error){var t=m.getObjectById(e["@id"]);const i=n.individualCallbacks?n.individualCallbacks[e["@id"]].onFailure:n.onFailure;t&&i&&i(t)}else if(n.individualCallbacks&&n.individualCallbacks[e["@id"]].onComplete)n.individualCallbacks[e["@id"]].onComplete(e);else{var i=m.getExistingAndMerge(e,{animate:n.animate});if(!i){var s=m.getModelConstructor(e);s&&(i=new s(e,{parse:!0})),i&&D(i)}i&&i.addMask(e["@mask"])}}))}(t,s),l(e),0==--y&&c&&c()},p=function(e){if(l(e),d)for(var t=e.length,n=0;n<t;n++)d(e[n]);0==--y&&c&&c()},h=[],g=r?r.ajax:m.request,f=a.map((function(e){return h.push(e.id),m.jsonURIToSparqlURI(e.id)})),y=Math.ceil(f.length/10);f.length;){var v=f.splice(0,10),C=h.splice(0,10),F="invoke/dsxplan:fetchIds?$mask="+o;g(m.expandUrl(F,"v1"),{method:"POST",type:"json",data:JSON.stringify({ids:v,checkCommunity:i&&i.checkCommunity}),newTransaction:!0,onComplete:u.bind(void 0,C),onFailure:p.bind(void 0,C)})}else s.onComplete&&s.onComplete()}else console.log("empty mask in complete function")},subscribeToNotification:function(e){return r.subscribe("XApp.Magic.Update",e)},hrefFromId:function(e){var t="/resources/";return t+=e},getObjectById:function(e){e=m.getObjectIDFromUserMap(e);return m.objectMap[e]},getObjectIDFromUserMap:function(e){e=m.removeBracketLongURI(e);return c.userMap[e]||e},resetObjectMap:function(){o.promises=[],m._inverseTimeout=void 0,m.objectMap={},c.userMap={}},addObjectToMap:function(e,t){var n=m.removeBracketLongURI(e);m.objectMap[n]&&console.error("attempting to add object to an existing id"),m.objectMap[n]=t},removeObjectFromMap:function(e){!m.objectMap[e]&&console.log("Removing object from map that wasn't there. Not an issue, just strange"),delete m.objectMap[e]},getObjectForAdding:function(t,n,i){var s=m.removeBracketLongURI(n),r=e.clone(i||{},!1),o=m.getObjectById(s);if(!o&&t){var a=m.getTypeCollection(t,{create:!0}),l=i&&i.attrs&&i.attrs["@type"]||!0;o=m.createPlaceholder(s,void 0,l),r.attrs&&(e.merge(o,r.attrs),r.attrs["dsxplan:jsType"]&&delete o["@type"],delete r.attrs),r.parse&&(o=new t(o,{parse:!0}),delete r.parse),o=a.add(o,r)}return r.mask&&(r.onlyIfNeeded=!0,o.fetch(r)),o},createPlaceholder:function(e,t,n,i){var s={"@id":m.removeBracketLongURI(e),"@href":m.hrefFromId(e),"@mask":t,"@type":n,_skeletonId:e};return i&&i.forceDslc&&(s.forceDslc=!0),s},splitUri:function(e){var t;return t=e.indexOf(":"),[e.substr(0,t),e.substr(t+1)]},getAssetUrl:function(e){var t;return"webapps"===(t=m.splitUri(e))[0]&&(e=s.getWebappsBaseUrl()+t[1]),e},parseUrl:function(e){var n,i;return i=(n=t.parseUrl(e)).query.length?t.parseQuery(n.query):{},{path:n.path,mask:i.$mask,where:i.$where&&decodeURIComponent(i.$where)}},buildProductAuthorizationRequests:function(e,t){t.forEach((function(t){e.ajax(m.expandUrl("invoke/dsplan:isProductAuthorized","v1"),{method:"POST",type:"json",data:'"'+t+'.prd"',headers:{"Content-Type":"application/json"},onComplete:function(e){"ENXPLAN_AP"===t?h.setXPPAuthorized(e["@value"]||e.value):h.setAuthorized(t,e["@value"]||e.value)}})}))},reconstructUrl:function(e){var t=e.path+(e.mask?"?$mask="+e.mask:"");return t+=e.mask&&e.where?"&":"",t+=e.where?"$where="+e.where:""},expandUrl:function(e,t,n){return e=e.replace(/^\//,""),t=t||"v1",e=h.getServiceUrl("3dplan",!0)+"/"+t+"/"+e,n&&n.rdfIndex&&(e=e.replace("3DPLAN","3drdfindex")),e},hasLoadedDictionary:function(){return!!m.typeDictionary&&m.typeDictionary.typeHierarchy},request:function(t,s){var r,o=e.clone(s||{},!1),a=Object.create(S);let c=h.getServiceUrl("3dplan",!0);if(!o.ignoreDictionary&&!m.hasLoadedDictionary()&&c){var d=e.clone(o,!1);d.newTransaction=!0;var u=m.getDictionaryBatch();return o.waitForDictionary?u.sendBatch({onComplete:function(){m.request(t,s)}}):(u.ajax(t,d),u.sendBatch()),a}o.url=t,l.addNecessaryHeadersAndParams(o);var p=o.queue||m;r=i.authenticatedRequest,a.options=o;var g,f=p.MAX_CONCURRENT_REQUEST||m.MAX_CONCURRENT_REQUEST;return p._inFlightRequests.length>=f||o.waitOnInFlightRequests&&m._inFlightRequests.length?(p._pendingRequests.push(a),a):(a._onComplete=o.onComplete,a._onFailure=o.onFailure,a._onTimeout=o.onTimeout,a._longRunningOperationTimeoutCallback=o.longRunningOperationTimeoutCallback,o.onComplete=a.onComplete.bind(a),o.onTimeout=a.onTimeout.bind(a),p._inFlightRequests.push(a),p!==m&&m._inFlightRequests.push(a),o.onFailure=function(i,s){var l=g&&g.xhr&&g.xhr.status;l&&e.is(s,"object")&&(s["@code"]=l),s&&e.is(s,"object")&&(s.error=i),503!==l&&503!==this.status||a.alreadySentOnce?a.onFailure.apply(a,arguments):(n.expire("SERVERID"),n.expire("SOLVERID"),a.alreadySentOnce=!0,g=r(t,o))},m.isBlockingRequests()?(m._blockedRequests.push(o),a):(o.invokeAsLRT&&(o.cancelableRequest=a),g=r(o.url,o),a.actualRequest=g,o.invokeAsLRT,a))},createRequestQueue:function(e){return{_inFlightRequests:[],_pendingRequests:[],MAX_CONCURRENT_REQUEST:e||3}},getPendingRequests:function(e){return e._pendingRequests},sendPendingRequests:function(e){var t=e||m;if(e&&!e._pendingRequests.length&&(t=m),t._pendingRequests.length){var n,i=t._pendingRequests,s=i.length,r=t.MAX_CONCURRENT_REQUEST||m.MAX_CONCURRENT_REQUEST;for(n=0;n<s&&t._inFlightRequests.length<r;n++){var o=i[n];m.request(o.options.url,o.options)}t._pendingRequests.splice(0,n)}},findInFlightRequestByUri:function(e){return this._inFlightRequests.find((function(t){return t.actualRequest&&(t.actualRequest.url&&t.actualRequest.url.contains(e)||t.actualRequest.xhr&&t.actualRequest.xhr.url.contains(e))}))},getBatchGenerator:function(e){var t=e&&e.ignoreDictionary;return h.isOnPremise()||t||m.hasLoadedDictionary()?new a({ajax:m.request,baseUrl:m.expandUrl("","v1")}):m.getDictionaryBatch()},getExistingAndMerge:function(t,n){var i=e.clone(n||{},!1),s=m.getObjectById(t["@id"]);if(i.mergeIfSameETag&&(s&&s.get("@etag")===t["@etag"]||(s=void 0)),s){var r=t;s.isDSLC()&&r&&(r=s._mapDslcAttributes(r)),r=s.parse(r),i.parse=!0,s.set(r,i),m.scheduleUpdateInverseProperties(s)}return s},getModelConstructor:function(t){var n;if(m.typeDictionary){if(m.typeDictionary.typeMap){var i=t["@type"]||t["dsxplan:jsType"];if(!i){var s=t["dsxplan:actualType"]||t["dsplan:actualType"];i=s&&s["@id"]}if(i){var r=m.typeDictionary.typeMap[i];return r&&r.type}}if(m.typeDictionary.mapping){var o,a=t["rdf:type"],l=e.is(a,"array")?a:a&&a.member,c={};if(l)l.forEach((function(e){c[e["@id"]]=e}));else if(t["@type"]){var d=t["@type"];c[d]=d}m.typeDictionary.mapping.some((function(e){return!!c[e.key]&&(o=e.type,!0)})),n=o}}return n},removeTypeCollection:function(e){var t;if(m.typeDictionary&&m.typeDictionary.modelIndexes){var n=m.typeDictionary.modelIndexes.get(e);m.typeDictionary.modelIndexes.delete(e),t=n}return t},resetTypeCollection:function(e,t){m.typeDictionary&&(m.typeDictionary.modelIndexes||(m.typeDictionary.modelIndexes=new Map),m.typeDictionary.modelIndexes.set(e,t))},getTypeCollection:function(e,t){var n;if(m.typeDictionary){m.typeDictionary.modelIndexes||(m.typeDictionary.modelIndexes=new Map);var i=m.typeDictionary.modelIndexes.get(e);!i&&t&&t.create&&(i=new m.ResultCollection(void 0,{model:e,"@href":"classes/"+e.prototype._uwaClassName,"@id":"typeCollection:"+e.prototype._uwaClassName}),m.typeDictionary.modelIndexes.set(e,i)),n=i}return n},getModelByTypeAndId:function(e,t,n){var i=this.getTypeCollection(e,n);return i&&i.get(t,n)},_maskStrength:function(e){if(!e)return-1;if(m.typeDictionary&&m.typeDictionary.masksStrength){var t=m.typeDictionary.masksStrength[e];if(void 0!==t)return t}return"dskern:Mask.Default"===e?0:e.match(/.*\.Basic$/)?1:e.match(/.*\.Simple$/)?2:e.match(/.*\.Collapsed$/)?6:e.match(/.*\.Expanded$/)?8:e.match(/.*\.Complex$/)?10:1},compareMasks:function(e,t){return m.typeDictionary&&m.typeDictionary.masksStrength,m._maskStrength(e)-m._maskStrength(t)},xsdDayTimeDurationToMilliseconds:function(e){var t,n=0,i=String(e).match(v);return i&&(t="-"===i[1],n=parseInt(i[2]||0)*y+36e5*parseInt(i[3]||0)+6e4*parseInt(i[4]||0)+1e3*parseFloat(i[5]||0),t&&(n=-n)),n},millisecondsToXsdDayTimeDuration:function(e){return(e<0?"-":"")+"PT"+Math.abs(e)/1e3+"S"},handleContext:function(t){if(t){var n=t["@context"];n&&e.merge(m.typeDictionary.context,n)}},shortToLongURI:function(e){var t=m.splitUri(e),n=m.typeDictionary.context[t[0]],i=e;return n?i="<"+n+t[1]+">":"uuid"===t[0]&&(i="<"+e+">"),i},conditionalShortToLongURI:function(e){return e.startsWith("uuid")&&(e=m.shortToLongURI(e)),encodeURIComponent(e)},longToShortURI:function(e){var t=e.split("/"),n=t.pop(),i=t.join("/")+"/";return m.inverseTypeDictionary[i]?`${m.inverseTypeDictionary[i]}:${n}`:e},jsonURIToSparqlURI:function(e){var t=e;if(t){var n=m.splitUri(e);m.typeDictionary.context[n[0]]&&n.length>=2&&!n[1].startsWith("//")?t=e:"uuid"===n[0]&&(t="<"+e+">")}return t},removeBracketLongURI:function(t){return t&&e.is(t,"string")&&t.startsWith("<")&&t.endsWith(">")&&(t=t.substr(1,t.length-2)),t},getURIForFiltering:function(t){return t&&e.is(t,"string")&&(t=t.replace(this.TAGGER_URI_PREFIX,"")),t&&e.is(t,"string")&&(t=t.replace(this.WEDO_TAGGER_URI_PREFIX,"")),this.removeBracketLongURI(decodeURIComponent(t))},loadTypeList:function(e){var t=e&&e.member;if(t){for(var n,i,s={},r={},o=t.length,a=function(e){return e.key===n&&(i=e,!0)},l=function(e){var t=e.Name;t&&(i&&(s[t]=i),r[n].push(t))},c=0;c<o;c++){var d=t[c];n=d.Name,i=void 0,r[n]=[],m.typeDictionary.mapping.some(a),m.scanStructure(d,l)}m.typeDictionary.typeMap=s,m.typeDictionary.typeHierarchy=r}for(var u=m.typeDictionary.mapping,p=u.length,h=0;h<p;h++){var g=u[h];m.typeDictionary.typeMap[g.key]||(m.typeDictionary.typeMap[g.key]=g)}},scanStructure:function(t,n,i,s){if(e.is(t,"array"))for(var r=t.length,o=0;o<r;o++){var a=t[o];if("STOP"===m.scanStructure(a,n,t))return"STOP"}else if(e.is(t,"object")){for(var l=Object.keys(t),c=l.length,d=0;d<c;d++){var u=l[d],p=t[u];if("@context"!==u&&"rdf:type"!==u&&((e.is(p,"object")||e.is(p,"array"))&&"STOP"===m.scanStructure(p,n,t,u)))return"STOP"}return n(t,i,s)}},typeDictionary:{context:F},inverseTypeDictionary:_(F),getDictionaryBatch:function(t){var n=e.clone(t||{},!1),i=m.getBatchGenerator({ignoreDictionary:!0});n.ajax=i.ajax;var s=function(e){var n,i=(n="E6WCommonUI.Alert.3DPlanServiceFail",f.get(n));return window.widget&&window.widget.alerter&&h.getServiceUrl("3dplan",!0)&&(window.widget.alerter.add({message:i,className:"error"}),window.widget.alerter.show()),t&&e&&e.apply(this,arguments)};return i.ajax(m.expandUrl("invoke/dsmf:xplan.xPlanVocabulary.getVocabulary"),{method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify([]),onComplete:function(e){m.loadTypeList(e)},onFailure:s.bind(this,t&&t.onFailure),onTimeout:s.bind(this,t&&(t.onTimeout||t.onFailure)),type:"json"}),this.buildProductAuthorizationRequests(i,["ENXPLAN_AP","RSK","DPM","XWO"]),d.loadProjectTypes(i.ajax),u.getUserPreferences(i.ajax),p.fetchExtensions(i.ajax),m.getRestrictedPropertiesInComplete(i.ajax),i},getRestrictedPropertiesInComplete:function(e){e(m.expandUrl("invoke/dsxplan:getPropertiesBlockedInComplete"),{method:"POST",headers:{"Content-Type":"application/json"},onComplete:function(e){m.RESTRICTED_PROPERTIES=JSON.parse(e["@value"])},type:"json"})},serverHasDSLC:function(){return!(!this.typeDictionary||!this.typeDictionary.typeHierarchy)&&this.typeDictionary.typeHierarchy["dslc:ItemVersioningPolicy"]},removeAllTypeCollections:function(){delete m.typeDictionary.modelIndexes},removeObjectFromIndex:function(e){var t=m.getObjectById(e);t&&(m.getTypeCollection(t.constructor).remove(t),delete m.objectMap[e]);return t},isBlockingRequests:function(){return e.is(m._blockedRequests,"array")},blockRequests:function(){m._blockedRequests=m._blockedRequests||[]},unblockRequests:function(){m.isBlockingRequests()&&(m._blockedRequests.forEach((function(e){i.authenticatedRequest(e.url,e)})),delete m._blockedRequests)},clearBlockedRequests:function(){delete m._blockedRequests},getCurrentUserName:function(){var e=m.getObjectById(h.getContextUserUid());if(!e||!e.fullName){var t=r.getUser();return t.firstName+" "+t.lastName}return e.fullName},downloadFCSFile:function(t,n){let i=e.clone(n||{});i.onFailure=i.onFailure||Function.prototype,m.request(m.expandUrl(`invoke/dspol:checkOut?$this=${t}`),{method:"POST",type:"json",onComplete:function(e){m.request(e.url,{method:"POST",data:{__fcs__jobTicket:e.body},onComplete:function(e){i.onComplete&&i.onComplete(e)},onFailure:i.onFailure})},onFailure:i.onFailure})},invokeAsLRT:function(t,n){let i=e.clone(n||{},!1);return i.cancelableRequest=m.request(m.expandUrl("task/"+t),{invokeAsLRT:!0,method:"POST",queue:i.queue?i.queue:m,onComplete:function(e){var t={method:"GET",type:"json",headers:{"Content-Type":"application/json"}};return m.checkStatusOfLRT(e,i,t,1e3,0)},onTimeout:i.onTimeout||i.onFailure,onFailure:i.onFailure,data:JSON.stringify(i.data),headers:{"Content-Type":"application/json"},type:"json"}),i.cancelableRequest},invokeAsRPC:function(t,n){let i=e.clone(n||{},!1);return i.cancelableRequest=m.request(m.expandUrl("invoke/"+t),{method:"POST",queue:i.queue||m,onComplete:i.onComplete,onTimeout:i.onTimeout||i.onFailure,onFailure:i.onFailure,data:JSON.stringify(i.data),headers:{"Content-Type":"application/json"},type:"json"}),i.cancelableRequest},removeInflightAndSendPendingRequests:function(e){let t=e.cancelableRequest;t&&t.removeFromInFlightRequest(),e.queue&&m.sendPendingRequests(e.queue),m.sendPendingRequests(m)},checkStatusOfLRT:function(t,n,i,s,r){if(202===t["@code"]){var o=t["@id"],a=m.expandUrl("task/"+o.toString(),"v1");s=Math.max(s,r),i.onComplete=function(e){return m.checkStatusOfLRT(e,n,i,s,r+.1*s)},i.onFailure=function(t){return m.removeInflightAndSendPendingRequests(n),e.is(n.onFailure,"function")&&n.onFailure.apply(this,[t])},setTimeout((function(){m.request(a,i)}),s)}else{if(200===t["@code"])return m.removeInflightAndSendPendingRequests(n),e.is(n.onComplete,"function")&&n.onComplete.apply(this,[t]);if(t["@code"]>=400)return e.is(n.onFailure,"function")&&n.onFailure.apply(this,[t])}},isStoryTask:function(e){const t=e.get("dsxplan:workscopeParent");if(t&&"NoAccessModel"!==t._uwaClassName){if(t.isAgile&&t.isAgile())return!1;const e=t.getParent&&t.getParent();if(e&&e.isAgile&&e.isAgile())return!0}return Boolean(e.get("dsxplan:backlogParent"))},isDPMProject:function(t,n,i){if(t)return Boolean(t&&"Project Space"===t.get("ds6w:type"));var s,r=i&&(i.detailedObjects||i.dropObj);if(e.is(r,"array")){for(var o=0;o<r.length;o++){var a=r[o];if(a.id===n){s=a;break}}return Boolean(s&&"Project Space"===s.objectType)}return Boolean(r&&"Project Space"===r.objectType)},isProject:function(e,t){const n=m.getObjectById(e);if(n&&d.isProject(n.get("dsxplan:jsType")))return!0;m.request(m.expandUrl("invoke/dsxplan:isProject"),{method:"POST",headers:{"Content-Type":"application/json"},type:"json",data:JSON.stringify([e]),onComplete:t.onComplete,onFailure:function(){console.error("unable to find the object type")}})},getDefaultModelConstructor:function(){return m._defaultModelConstructor},setDefaultModelConstructor:function(e){m._defaultModelConstructor=e},enrichObjectFromSearch:function(t){(t.sourceid||t.sourceId)&&e.merge(t,m.getSourceAndTenantFromSearch(t)),t.id&&e.merge(t,{objectType:t["ds6w:type_value"]||t["ds6w:type"],displayType:t["ds6w:type_value"]||t["ds6w:type"]})},getSourceAndTenantFromSearch:function(e){var t=e.sourceid||e.sourceId,n=t.indexOf(":");const i=-1===n?t:t.substring(0,n);return{source:i,serviceId:m.serviceFromSource(i),tenant:-1===n?void 0:t.substring(n+1)}},scheduleUpdateInverseProperties:function(e){m._inverseTimeout=m._inverseTimeout||setTimeout((()=>{m._inverseTimeout=void 0,Object.values(m._modelsToUpdateInverse).forEach((e=>{e._updateInverseProperties()})),m._modelsToUpdateInverse={}}),0),m._modelsToUpdateInverse=m._modelsToUpdateInverse||{},m._modelsToUpdateInverse[e.cid]=e}},m.inverseMapping=_,m.MS_DAY=y,m})),define("DS/RDFFoundation/Models/NoAccessModel",["UWA/Core","UWA/Class/Model","DS/RDFFoundation/RDFUtils","i18n!DS/RDFFoundation/assets/nls/RDFFoundationNLS"],(function(e,t,n,i){"use strict";var s=t.extend({isAgile:()=>!1,_uwaClassName:"NoAccessModel",idAttribute:"physicalId",init:function(t,s){var r=e.extend(t||{},{"dsxplan:label":i.get("RDFFoundation.Label.NoAccess"),image:require.toUrl("DS/RDFFoundation/assets/img/NoAccess.png"),physicalId:"noAccessModelId"});this._parent(r,s),this.set("physicalId","noAccessModelId"+this.cid),n.addObjectToMap(this.id,this)},get:function(e){var t=this._parent.apply(this,arguments);switch(e){case"displayValue":case"title":return this.get("dsxplan:label")}return t},toJSON:function(){var e=this._parent.apply(this,arguments);return e.title=this.get("title"),e.image=this.get("image"),e},compactJson:function(){},sync:Function.prototype,getObjectType:Function.prototype,getParent:Function.prototype,hasViewAccess:function(){return!1},dataForRendering:function(){var e=this.toJSON();return e.isNoAccessModel=!0,e},isReferenceProject:function(){return!1},canBeRemoved:function(){return!0}});return s})),define("DS/RDFFoundation/Models/ComponentProxyIndexModel",["UWA/Core","UWA/Class/Model","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/RDFFoundation/FederatedSearchUtil","DS/RDFFoundation/Models/ObjectProxyUtil","DS/RDFFoundation/RDFUtils"],(function(e,t,n,i,s,r){"use strict";var o=["ds6w:label","ds6w:type","type_icon_url","ds6w:docextension","preview_url","ds6w:resourceUid","modified","ds6w:modified","ds6w:kind","islast","revision","linkURL","description","ds6w:responsible","ds6w:created","resourceid"];const a=new Map;var l={};o.forEach((function(e){l[e]=!0}));var c=t.extend({_uwaClassName:"ComponentProxyIndexModel",idAttribute:"resourceid",defaults:{},init:function(e,t){var n=Array.prototype.slice.call(arguments,0);if(e&&(e.results||e.attributes)&&(!t||!t.parse)){var i="";if(e.results){var s=e.results;if(1!==s.length)return this._parent.apply(this,n);i=s[0]}this.collection=t&&t.collection;var r=this.parse(i);n[0]=r}this._rawResponse={attributes:[]},this._parent.apply(this,n),a.set(this.id,this)},sync:function(t,n,i){if("read"!==t)throw new Error("component proxy index model don't support writing");var s=e.clone(i||{},!1);return s.source=this.get("source"),c.requestFetch(n,s)},parse:function(e,t){var n={};if(this._rawResponse={attributes:[]},e&&e.attributes){const d={};for(var i=e.attributes,s=i.length,r=t&&t.selectPredicates||l,o=0;o<s;o++){var a=i[o],c=a.name;d[c]||(d[c]=!0,this._rawResponse.attributes.push(a)),"ds6w_facet"===a.format&&(c=c.substr(c.lastIndexOf("/")+1)),r[c]&&(n[c]=a.value)}}return n},getFedSearchResponse:function(){return this._rawResponse},destroy:function(){a.delete(this.id),this._parent.apply(this,arguments)},getFetchPromise:function(){return this._fetchPromise||new Promise((e=>e()))}});c.prototype.dataForRendering=function(){return this.toJSON()},c.toBeFetched={};var d={cancel:function(){this.fetching?(delete this._onComplete,delete this._onFailure):delete this.queue.toBeFetched[this.id]},onComplete:function(){this._onComplete&&this._onComplete.apply(this,arguments)},onFailure:function(){this._onFailure&&this._onFailure.apply(this,arguments)}};return c.TIMEOUT_LENGTH=97,c.idAttributeForFederatedSearch="[ds6w:resourceUid]",c.idAttributeForFederatedSearchResult="resourceid",c.select_predicate=o,c.fetchProxies=function(){delete this.fetchTimeout;var t={idAttributeForFederatedSearch:this.idAttributeForFederatedSearch,select_predicate:this.select_predicate,idAttributeForFederatedSearchResult:this.idAttributeForFederatedSearchResult||this.idAttributeForFederatedSearch},n=this.toBeFetched;this.toBeFetched={};var i=Object.keys(n),r=i.length;if(!r)return{cancel:function(){}};for(var o,a,l={},d={"3dspace":[],i3dx:[],businessprocess:[]},u=0;u<r;u++){var p,h=i[u],g=n[h];g.fetching=!0;var f=g.idAttributeForFederatedSearch||t.idAttributeForFederatedSearch;if(p=e.is(t.idAttributeForFederatedSearch,"function")?t.idAttributeForFederatedSearch(g.source):f,g.id&&g.id.startsWith("i3dx:"))d.i3dx.push(h);else if("3dspace"===g.source)d["3dspace"].push(h);else if("businessprocess"===g.source){var m={id:h,proxyType:g.model.get("dscom:ProxyType")};d.businessprocess.push(m)}else this.optimizeSearchQuery?o='"'+h+'"':(o=p+':"'+h+'"',g.additionalQueryStatement&&(o="("+o+" AND "+g.additionalQueryStatement+")")),l[g.source]||(l[g.source]=[]),l[g.source].push(o)}var y=function(e,t){for(var i=Object.keys(n),r=i.length,o=0;o<r;o++){var l=i[o],c=n[l],d=c.source;"3dspace"===t||"3dspace"===d?"3dspace"===t&&"3dspace"===d&&c.onFailure&&c.onFailure(e):"businessprocess"===d?delete n[l]:"drive"===d?s.sendRequest({drive:[l]},{onComplete:a,onFailure:function(e,t,i){var s=n[i[0]];s.onFailure.apply(s,arguments)}}):t===d&&c.onFailure&&c.onFailure(e)}};return a=function(e,i){var s,r=e.length,o=t.idAttributeForFederatedSearchResult.replace(/\[?([^\]]*)]?/,"$1");"i3dx"===i&&(o="ds6w:i3dx");for(var a=0;a<r;a++)for(var l=e[a],c=l.attributes,d=c.length,u=0;u<d;u++){var p=c[u];if(p.name===o){(s=n[p.value])&&s.onComplete(l),delete n[p.value];break}}y("object_not_found",i)},s.sendRequest(d,{onComplete:a,onFailure:y}),c.sendFederatedSearchRequest.apply(this,[l,a,y]),{}},c.sendFederatedSearchRequest=function(t,n,s){var r=Object.keys(t);if(r.length>0)for(var o=function(t,i){var r=(e.is(i,"string")?JSON.parse(i):i).results;r?n(r,t):s("object_not_found",t)},a=0;a<r.length;a++){var l=r[a],d=t[r[a]],u={query:d,nresults:d.length+10,sources:[l],select_predicate:this.select_predicate,searchQueryPrefix:this.optimizeSearchQuery?c.idAttributeForFederatedSearch:void 0,delimeter:this.optimizeSearchQuery&&"swym"===l?" BOR ":void 0,onComplete:o.bind(void 0,l),onFailure:s.bind(this,"object_not_found",l)};i.sendRequestWithDelimiter(u)}},c.requestFetch=function(t,n){var i=e.clone(n||{},!1),s=i.queue||this,r=s.toBeFetched[t.id];return r||(t._fetchPromise=new Promise(((e,t)=>{i.onComplete=function(t){n&&n.onComplete(t),e()},i.onFailure=function(e){n&&n.onFailure(e),t(new Error(e))}})).catch((e=>{console.error(`Error fetching index model: ${e}`)})),(r=Object.create(d)).id=t.id,r.model=t,r.source=i.source||"3dspace",r._onComplete=i.onComplete,r._onFailure=i.onFailure,r.queue=s,r.additionalQueryStatement=i.additionalQueryStatement,r.idAttributeForFederatedSearch=i.idAttributeForFederatedSearch,s.toBeFetched[t.id]=r,s.fetchTimeout||(s.fetchTimeout=setTimeout(c.fetchProxies.bind(s),c.TIMEOUT_LENGTH)),r)},c.resetQueue=function(e){(e=e||this).toBeFetched={},clearTimeout(e.fetchTimeout),delete e.fetchTimeout,delete e.optimizeSearchQuery},c.getObjectById=function(e){return a.get(e)},c.resetCache=function(){a.clear()},c.getOrCreateFromFedSearchResults=function(e){let t=c.getObjectById(e.attributes.find((e=>"resourceid"===e.name)).value);t||(t=new c(e,{parse:!0}));const n=e.attributes.reduce(((e,t)=>(e[t.name]=t.value,e)),{}),i=r.getSourceAndTenantFromSearch(n);return t.set(i),t},c})),define("DS/RDFFoundation/Utils/Filter",["UWA/Class","UWA/Class/Events","UWA/Class/Listener","DS/RDFFoundation/RDFUtils"],(function(e,t,n,i){"use strict";const s=e.extend({init:function(e){this.collection=e.collection,this._ids=[],this._active=!1},updateCollection:function(e){this.collection=e,this.isActive()&&this.execute()},setModels:function(e){this._ids=e.map((e=>s.getModelIdForFilter(e))),this.onChange()},getIds:function(){return this._ids},setActive:function(e){this._active!==e&&(this._active=e,this.onChange())},isActive:function(){return this._active},onChange:function(e){this.onChangeTimeout||(this.onChangeTimeout=setTimeout((()=>{this.onChangeTimeout=void 0;const t=this.isActive()?s.events.changed:s.events.deactivated;this.dispatchEvent(t,[e])}),0))},execute:Function.prototype});return s.implement(t,n),s.getModelIdForFilter=function(e){return i.removeBracketLongURI(e.get("physicalId"))},s.events={changed:"onFilterChange",deactivated:"onFilterDeactivated"},s.ON_CHANGE_TIMEOUT=0,s})),define("DS/RDFFoundation/Models/DeletedModel",["UWA/Core","UWA/Class/Model","DS/RDFFoundation/RDFUtils","i18n!DS/RDFFoundation/assets/nls/RDFFoundationNLS"],(function(e,t,n,i){"use strict";var s=t.extend({isAgile:()=>!1,_uwaClassName:"DeletedModel",idAttribute:"physicalId",init:function(t,s){var r=e.extend(t||{},{"dsxplan:label":i.get("RDFFoundation.Label.Deleted"),image:require.toUrl("DS/RDFFoundation/assets/img/Deleted.png"),physicalId:"deletedModelId"});this._parent(r,s),this.set("physicalId","deletedModelId"+this.cid),n.addObjectToMap(this.id,this)},get:function(e){var t=this._parent.apply(this,arguments);switch(e){case"displayValue":case"title":return this.get("dsxplan:label")}return t},toJSON:function(){var e=this._parent.apply(this,arguments);return e.title=this.get("title"),e.image=this.get("image"),e},compactJson:function(){},sync:Function.prototype,getObjectType:Function.prototype,getParent:Function.prototype,hasViewAccess:function(){return!1},dataForRendering:function(){var e=this.toJSON();return e.isNoAccessModel=!0,e},isReferenceProject:function(){return!1},canBeRemoved:function(){return!0}});return s})),define("DS/RDFFoundation/Utils/TaggerFilter",["UWA/Core","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/Utils/Filter"],(function(e,t,n){"use strict";const i=n.extend({init:function(e){this._parent.apply(this,arguments),e.proxy||e.collection?this.tnProxy=e.proxy?e.proxy:e.collection.getTNProxy({setPredicatesOnProxy:!1}):this.tnProxy=null,this.setupListener(),this.collection.requestFetchNewTags({onlyIfNeeded:!0}),this.listenTo(this.collection,{onAdd:()=>{this.collection.requestFetchNewTags(),this.updateTags()},onRemove:this.updateTags,"onChange:tagsData":this.updateTags})},handleTaggerFilter:function(e){const t=(e.filteredSubjectList||[]).map((e=>i.objectMap[e]));this.setModels(t),e.dontCacheFilters||this.setActive(Object.keys(e.allfilters).length>0)},updateTags:function(){this._updateTagTimeout=this._updateTagTimeout||setTimeout((()=>{this._updateTagTimeout=void 0;const e=this.collection.getTaggerData();"function"==typeof this.tnProxy.setSubjectsTags?this.tnProxy.setSubjectsTags(e):"function"==typeof this.tnProxy.setTags&&this.tnProxy.setTags(e)}),200)},setupListener:function(){this.stopListening(this.tnProxy,"onFilterSubjectsChange"),this.listenTo(this.tnProxy,"onFilterSubjectsChange",this.handleTaggerFilter)},onChange:function(){this._parent({fromTagger:!0})}});return i.objectMap={},i.addModelToMap=function(e){i.objectMap[e.getTaggerURI()]=e,e.addEvent("onDestroy",(function(t){try{i.objectMap[t.getTaggerURI()]=void 0}catch(t){console.error(`Could not calcluate tagger uri to remove ${e.id} from TaggerFilter map`)}}))},i.UPDATE_TAG_TIMEOUT=200,i})),define("DS/RDFFoundation/Models/ResultModel",["UWA/Core","UWA/Utils","UWA/Class/Model","UWA/Class/Collection","UWA/Class/Events","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/BatchBuilder","DS/RDFFoundation/RequestUtils","DS/RDFFoundation/MaskUtils","DS/RDFFoundation/UserPreferences","DS/RDFFoundation/Mixins/FetchTrackingMixin","DS/RDFFoundation/Utils/TaggerFilter","DS/RDFFoundation/Models/NoAccessModel","DS/E6WCommonUI/PlatformManager","DS/E6WCommonUI/ApolloUtils","DS/E6WCommonUI/UIHelper","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],(function(e,t,n,i,s,r,o,a,l,c,d,u,p,h,g,f,m){"use strict";r.objectMap={};var y,v,C=n,F=Object.prototype.hasOwnProperty;v=e.is;var _=function(){var t=this.get("dsxplan:jsType")||this.get("@type")||this.get("dsxplan:actualType")||this.get("dsplan:actualType");return t&&!e.is(t,"string")&&(t=t.id),t};return y={_mapDslcAttributes:function(e){if(e&&this.dslcMapping)for(var t=Object.keys(e),n=t.length,i=0;i<n;i++){var s=t[i],r=this.dslcMapping[s];if(r){var o=e[s];delete e[s],e[r]=o}}return e},isRDF:!0,serviceHosting:"3dplan",idAttribute:"@id",_uwaClassName:"ResultModel",canBeRemoved:function(){return!0},getIdForFederatedSearch:function(){return this.id},getCombinedAttributes:function(e){let t=this.getChangedAttributesSinceLastSave(),n=e?Object.keys(e):[];return e?n.concat(t.filter((e=>n.indexOf(e)<0))):t},setCollection:function(t,n){var i=this;this._collections[t]=n;var s=this.getPropertyInverse(t);function r(t){var n;return!s.name||t&&t.dontInverseUpdate||(n=e.clone(t||{},!1),e.merge(n,s),n.dontRegisterChange=!0,n.dontInverseUpdate=!0),n}this.listenTo(n,{onAdd:function(e,n,i){var s=r(i);s&&e._addToModelOrCollectionProperty(this,s),this._registerChangedCollection(t,e,n,i)},onRemove:function(e,n,s){var o=r(s);o&&e._removeFromModelOrCollectionProperty(i,o),this._registerChangedCollection(t,e,n,s)},onReset:function(e,n){var s=r(n);if(s){var o={};n.previousModels.forEach((function(e){o[e.id]=e})),e.forEach((function(e){o[e.id]?delete o[e.id]:e._addToModelOrCollectionProperty(i,s)}));for(var a=Object.keys(o),l=0;l<a.length;l++){o[a[l]]._removeFromModelOrCollectionProperty(i,s)}}this._registerChangedCollection.bind(this,t)}})},hasUsedMask:function(e){return!!(this._usedMasks&&this._usedMasks.indexOf(e)>-1)},hasViewAccess:function(){return{"dsxplan:Open":!0,"dsxplan:Draft":!0,"dsxplan:InProgress":!0,"dsxplan:Done":!0,"dsxplan:OnHold":!0,"dsxplan:Published":!0,"dsxplan:Low":!0,"dsxplan:Medium":!0,"dsxplan:High":!0,"dsxplan:Urgent":!0}[this.id]||!!this.get("dsplan:jsType")||!!this.get("dsxplan:jsType")},MAX_CONCURRENT_REQUEST:1,init:function(e,t){this._inFlightRequests=[],this._pendingRequests=[],e&&e.forceDslc&&(this._isDslc=!0,delete e.forceDslc),this.initFetchTrackingMixinForInstance(),this._models={},this._collections={},this._changedAttributesSinceLastSave={},this._fetchedAttributes={},this.isDSLC(e||{})&&(e=this._mapDslcAttributes(e));var n=t||{};Object.defineProperty(this,"collectionConstructor",{get:this._getCollectionConstructor,set:function(e){return this._collectionConstructor=e,e}}),this._collectionConstructor||(n.collectionConstructor?this.collectionConstructor=n.collectionConstructor:n.collection&&(this.collectionConstructor=n.collection.constructor));var i=e&&e["@id"];if(i){if(r.getObjectById(i))throw new Error("object existing try to get existing from resultmodel first");r.addObjectToMap(r.removeBracketLongURI(i),this),e["@href"]||(e["@href"]=r.hrefFromId(i))}return this._parent.apply(this,arguments)},_getCollectionConstructor:function(){return this._collectionConstructor||this.collection&&this.collection.constructor||r.ResultCollection},_registerChangedCollection:function(e,t,n,s){var r=n,o=s;t instanceof i&&(r=t,o=n),o&&(o.parse||o.dontRegisterChange)||this.isPropertyVolatile(e)||(this._changedAttributesSinceLastSave[e]=r)},getParent:Function.prototype,getParentModels:function(e){if(this.getParent()){var t=this.getParent();e.push(t.id),t.getParentModels(e)}},isParentHierarchyLoaded:function(e,t){return!!e&&(t===e||this.isParentHierarchyLoaded(e.getParent(),t))},_registerChangedAttributes:function(t,n){var i=t||this,s=e.clone(n||{},!1);if(!s.parse){var r=i.changedAttributes();for(var o in r)F.call(r,o)&&(this.isPropertyVolatile(o)||s.dontRegisterChange||this._registerChangedAttribute(o,r[o],n),s.dontInverseUpdate||this._updateInverseProperty(o,r[o],n))}},_registerChangedAttribute:function(e,t,n){var i=this._changedAttributesSinceLastSave;void 0!==i[e]&&null!==i[e]||(i[e]=this.previous(e)),t instanceof y&&(this._models[e]=t)},_updateInverseProperty:function(t,s,o){var a=this.getPropertyInverse(t);if(a.name){var l=e.clone(o||{},!1);e.merge(l,a),l.dontRegisterChange=!0,l.dontInverseUpdate=!0;var c=this.previous(t);if(c&&(c["@id"]&&(c=r.getObjectById(c["@id"])),c instanceof y&&c!==s&&c._removeFromModelOrCollectionProperty(this,l)),s&&(s instanceof n||s instanceof i)){(s instanceof n?[s]:s.toArray()).forEach((e=>{let t=e.get(a.name);const n=Boolean(t)&&a.isCollection?t.get(this):t===this;if(e&&e instanceof y&&!n&&(l.sort=!1,e._addToModelOrCollectionProperty(this,{...l,...a}),a.isCollection)){const t=e.getCollectionAttribute(a.name);t.comparator&&(t._sortTimeout=t._sortTimeout||setTimeout((()=>{t._sortTimeout=void 0,t.sort()}),0))}}))}}},_removeFromModelOrCollectionProperty:function(e,t){t.isCollection?this.getCollectionAttribute(t.name).remove(e,t):this.unset(t.name,t)},_addToModelOrCollectionProperty:function(e,t){const n=this.get(t.name);t.isCollection||n instanceof i?this.getCollectionAttribute(t.name).add(e,t):this.set(t.name,e,t)},resetRecursive:function(){this._resettingRecursively||(this._resettingRecursively=!0,Object.values(this._collections).forEach((e=>{e.forEach((e=>e.resetRecursive())),e.reset([],{dontRegisterChange:!0})})),this._usedMasks=[],y.events.dispatchEvent("onResetRecursive",[this]),this._resettingRecursively=void 0)},destroy:function(t){this.destroying=!0;var n=e.clone(t||{},!1),i=this;n.apolloShouldIgnore||(n.onComplete=function(){g.onModelDeleted(i),t&&t.onComplete&&t.onComplete.apply(i,arguments)}),n.dontRegisterChange=!0;var s=Array.prototype.slice.call(arguments,0);s[0]=n,this.stopListening(),r.removeObjectFromMap(this.id),r.removeObjectFromMap(this.cid),this._parent.apply(this,s),this.removeEvents()},clone:function(){throw new Error("don't clone resultmodels please")},toJSON:function(t){var n="string"==typeof t?{}:e.clone(t||{},!1),i=void 0===n.level?1:n.level;if(i<0)return{};n.level=i-1;var s=n.ancestors,r=s&&s[this.id];s||(n.ancestors=s={});try{s[this.id]=!0;var o=this._parent.apply(this,arguments),a={},l={};if(n.attributes)for(var c=n.attributes.length,d=0;d<c;d++){var u=n.attributes[d],p=o[u];void 0!==p&&(l[u]=p),a[u]=!0}else l=o;if(n.attributesWhiteList=a,r||n.noSerialize||(this._jsonChildren(l,this._models,i,n),this._jsonChildren(l,this._collections,i,n),t&&t.noSkeletonId&&delete l._skeletonId),this.isDSLC()&&this.dslcMapping&&(n.level=i,n.isAnAncestor=r,this._jsonDSLC(l,n),n.ancestors=s,i>0&&(n.level=i-1)),n.attributes){var h=n.attributes.filter((function(e){return!l[e]}));this._jsonAddAttributes(l,h,n)}return this.hasViewAccess()||(l.error="No Access",l.noAccessCharacter=m.get("E6WCommonUI.Error.NoAccess")+" "),l}finally{delete s[this.id]}},_jsonChildren:function(e,t,n,i){for(var s=Object.keys(t),o=s.length,a=i.attributesWhiteList,l=0;l<o;l++){var c=s[l];if(0!==n){if(i.attributes&&!a[c])continue;var d=t[c];if(d instanceof r.ResultCollection&&!d.length&&i.noEmptyCollection){delete e[c];continue}e[c]=d.toJSON(i)}else delete e[c]}},_jsonAddAttributes:function(t,n,i){for(var s=i.attributesWhiteList,o=i.isAnAncestor,a=n.length,l=0;l<a;l++){var c=n[l];if(!i.attributes||s[c]){var d=this.get(c),u=!1;if(void 0!==d){if(!o){if(e.is(d,"array")){for(var p=[],h=0;h<d.length;h++)if(d[h]instanceof y||d[h]instanceof r.ResultCollection){if(0===i.level){u=!0;break}p.push(d[h].toJSON(i))}d=p}(d instanceof y||d instanceof r.ResultCollection)&&(0!==i.level?d=d.toJSON(i):u=!0)}u?delete t[c]:t[c]=d}}}},_jsonDSLC:function(e,t){if(t.dataForRendering){var n=Object.keys(this.dslcMapping);this._jsonAddAttributes(e,n,t)}},getCollectionAttribute:function(e,t){var n=e;this.isDSLC()&&this.dslcMapping&&(n=this.dslcMapping[e]||n);var i=this.get(n);return i||t&&t.noCreate||(i=this.addNewCollectionData(n,void 0,t)),i},isNew:function(e){return!(e&&e.excludeForced||!this.forcedNew)||this._parent.apply(this,arguments)},_prepareOptionsForPatch:function(e){let t={};return e.activityIdToSubscribe&&(t.identifier=e.activityIdToSubscribe),t},_prepareDataForPatch:function(e){let t=[e.attrs,this.id],n=this._prepareOptionsForPatch(e);return Object.keys(n).length>0&&n&&t.push(n),t},_prepareDataForClone:function(e){let t=this.getParentPath();return[e.attrs,e.idToDuplicate,t]},_prepareDataForCreate:function(e){let t=this.getParentPath();return[e.attrs,t]},_prepareDataForDelete:function(e){return[this.id,Boolean(e.isStructureDelete)]},_syncCreateDSLC:function(e,t){let n=t.idToDuplicate;var i=n?y.CLONE_ITEM_VERSION_URI:y.CREATE_ITEM_VERSION_URI,s=t.mask||this.writeMask||this.getMask(),o=s?"?$mask="+s:"";t.url=r.expandUrl(i+o),t.data=n?JSON.stringify(this._prepareDataForClone(t)):JSON.stringify(this._prepareDataForCreate(t)),t.method="POST"},syncCreate:function(e,t){var s=this,r={},o={};Object.keys(e).forEach((function(t){var a,l;if((a=e[t])instanceof i){if(!a.length)return;r[t]=a,l=a.compactJson()}else l=a instanceof n||Boolean(this._models[t])?a?s.getRelatedModelCompactJson(a,t):void 0:a;o[t]=l}),this);var a,l,c=(a=this.getParentPath(),(l=a.split("/"))[l.length-1]),d=this.getPropertyThisIsInverseOf(c);d&&delete o[d],t.attrs=t.attrs=t.noStringify||this.isDSLC()||t.dslc?o:JSON.stringify(o);var u=[],p=Object.keys(this._models),h=Object.keys(this._collections),g=t.onComplete,f=t.onFailure;p.forEach((function(e){var t=this[e];t.isNew()&&u.push(t)}),this._models);var m=function(e){e.isNew()&&u.push(e)};h.forEach((function(e){this[e].forEach(m)}),this._collections),t.onComplete=function(){var e;e=s._collections,Object.keys(e).forEach((function(e){var t=r[e];t&&t.resetFlags()})),u.forEach((function(e){e.isNew({excludeForced:!0})&&e.destroy()})),g&&g.apply(s,arguments)},t.onFailure=function(){setTimeout((()=>{s.destroy({noServer:!0,dontRegisterChange:!0})}),0),f&&f.apply(s,arguments)};var y=t.onTimeout;t.onTimeout=function(){s.destroy({noServer:!0,dontRegisterChange:!0}),y&&y.apply(s,arguments)},this.collection&&this.collection.removeAddedModel(this),(this.isDSLC()||t.dslc)&&this._syncCreateDSLC(e,t)},_syncPatchDSLC:function(e,t){var n=t.mask||this.getMask();t.url=r.expandUrl(y.MODIFY_ITEM_VERSION_URI+(n?"?$mask="+n:"")),t.data=JSON.stringify(this._prepareDataForPatch(t)),t.method="POST"},_syncPatchHandleCollectionAttribute:function(t,n,i){var s,r=n._replaceOnSave,o=[],a=this;return delete n._replaceOnSave,"rdf:type"===t&&1===n._added.length&&1===n.length&&(n._removed.length>0||r)?o.push({op:"replace",path:"/"+t,value:this.getRelatedModelCompactJson(n._added[0],t)}):(n._added.forEach((function(e){o.push({op:"add",path:"/"+t+"/-",value:a.getRelatedModelCompactJson(e,t)})})),n._removed.forEach((function(n){s=n["@value"],e.is(s)?e.is(s,"string")&&(s='"'+s+'"'):s=n.id,o.push({op:"remove",path:"/"+t+"/{"+s+"}"})}))),i[t]={_removed:n._removed,_added:n._added},n.resetFlags(),o},syncPatch:function(t,s){var r=[],o={},a=this._changedAttributesSinceLastSave;this._changedAttributesSinceLastSave={};var l,c={},d=this;if(Object.keys(a).forEach((function(e){var s,l,u,p,h;d.isPropertyVolatile(e)||d.computedProperties&&d.computedProperties[e]||((s=t[e])instanceof i?r.push.apply(r,d._syncPatchHandleCollectionAttribute(e,s,c)):(h=s instanceof n||Boolean(this._models[e]),u=a[e],v(u)&&!v(s)?p="remove":!v(u)&&v(s)?p="add":v(u)&&v(s)&&(h&&u.id!==s.id||!h&&u!==s)&&(p="replace"),h?(o[e]=s,l=s?d.getRelatedModelCompactJson(s,e):void 0):l=s,p&&r.push({op:p,path:"/"+e,value:l})))}),this),r.length||(s&&s.onComplete&&s.onComplete({}),l={cancel:function(){}}),!l){s.attrs=s.noStringify||this.isDSLC()?r:JSON.stringify(r);var u=e.clone(s||{},!1),p=s.onFailure;s.onFailure=function(e){p&&p(e),this.dispatchEvent("onError",[this,e,u]),this.rollbackChanges(a,c,t)}.bind(this),s.url=this.url({mask:this.writeMask})}return!l&&this.isDSLC()&&(l=this._syncPatchDSLC(t,s)),l},rollbackChanges:function(e,t,n){var i=this,s=e||this._changedAttributesSinceLastSave,r=!1,o={};if(s&&Object.keys(s).forEach((function(e){var t=i.get(e),n=s[e];n!==t&&(o[e]=n,r=!0)})),r){this.set(o,{dontRegisterChange:!0});var a=this._previousAttributes;this._previousAttributes=n;for(var l=Object.keys(o),c=0;c<l.length;c++){var d=l[c];this._updateInverseProperty(d,o[d])}this._previousAttributes=a}t&&Object.keys(t).forEach((function(e){var n=i.get(e),s=t[e],r=!1;s._added&&s._added.forEach((function(t){i.onCollectionRollback(e),n.remove(t,{dontRegisterChange:!0}),r=!0})),s._removed&&s._removed.forEach((function(e){n.add(e,{dontRegisterChange:!0}),r=!0})),r&&i._fireRelationshipChangeEvents(e)})),this._changedAttributesSinceLastSave={}},onCollectionRollback:Function.prototype,_dontRollBackAndRetrySave:function(t,n){var i=this;e.extend(this._changedAttributesSinceLastSave,t),Object.keys(n).forEach((function(e){var t=i.get(e),s=n[e];s._added&&s._added.forEach((function(e){t._registerAddedModel(e)})),s._removed&&s._removed.forEach((function(e){t._registerRemovedModel(e)}))})),this.save()},fetchingMask:function(e){this._masksBeingFetched=this._masksBeingFetched||{},this._masksBeingFetched[e]=!0},doneFetchingMask:function(e){this._masksBeingFetched&&delete this._masksBeingFetched[e]},_syncSetQueue:function(t,n){if(this instanceof y&&!n.queue){var i=this;"create"===t&&e.is(this.getParent,"function")&&(i=this.getParent()||this),n.queue=i}},ifActualFailure:function(e,t){var n=!0,i=e?Object.keys(l.getMask(e)||{}):[];return e&&i.length?-1!==i.indexOf("dsxplan:jsType")||-1!==i.indexOf("@type")?n=!t["dsxplan:jsType"]&&!t["@type"]:"dsplan:MVMask.Task.Deliverables"===e?t["dsxplan:actualDeliverable"]&&(n=!1):"dskern:Mask.Default"===e?t.title&&(n=!1):"dsplan:MVMask.URL.Complex"===e?t["dsplan:linkURL"]&&(n=!1):"dsplan:MVMask.History.Basic"===e&&(t["dsxplan:label"]||t["dsplan:label"]||t["dskern:nlsLabel"])&&(n=!1):n=!t["dsxplan:jsType"]&&!t["@type"],n},sync:function(t,n,i){if(i&&i.noServer)return i&&i.onComplete&&i.onComplete({}),{cancel:function(){}};var s=this,o=e.clone(i||{},!1);o.ajax||(o.ajax=r.request,this._syncSetQueue(t,o));var a=e.extend(this.toJSON({noSkeletonId:!0}),this._collections);a=e.extend(a,this._models);var l=Array.prototype.slice.call(arguments,0);l[2]=o;var d=i.onComplete,u=i.onFailure,p=function(e){f.trackPageEvent({eventCategory:"ResultModel",eventAction:e,eventLabel:n.getObjectType()})};switch(t){case"create":this.syncCreate(a,o),c.setUserPreferences(n);try{p(t)}catch(e){console.log("e")}break;case"update":case"patch":l[0]="patch";var h=this.syncPatch(a,o);if(c.setUserPreferences(n),h)return h;try{p(t)}catch(e){console.log("e")}break;case"read":var g=this.mask;i&&i.mask&&!i.dontUpdateMask&&(this.mask=i.mask,this.fetchingMask(this.mask)),this.fetching=!0,o.onComplete=function(e){s instanceof y&&s.ifActualFailure(i.mask,e)?o.onFailure(e,"no-access"):(i&&i.mask&&!i.dontUpdateMask&&s.doneFetchingMask(i.mask),s.fetching=!1,d&&d.apply(this,arguments))},o.onFailure=function(){i&&i.mask&&!i.dontUpdateMask&&s.doneFetchingMask(i.mask),s.fetching=!1,s.mask=g,u&&u.apply(this,arguments)};break;case"delete":this.syncDelete(o);try{p(t)}catch(e){console.log("e")}}return o.id=this.id||this.cid,this._parent.apply(this,l)},onTypeChange:function(){var e=r.getModelConstructor(this.toJSON())||y;if(!(this instanceof e)){r.removeObjectFromIndex(this.id);var t=new e(this.toJSON({noSerialize:!0}),{collectionConstructor:this.collectionConstructor});this.dispatchEvent("onTypeChanged",[this,t])}},isDSLC:function(e){if(this._isDslc)return this._isDslc;var t,n=e?e["@type"]:y.prototype.get.call(this,"@type",{noDSLCMapping:!0});if(n&&r&&r.typeDictionary&&r.typeDictionary.typeHierarchy){var i=r.typeDictionary.typeHierarchy["dslc:ItemVersioningPolicy"];t=i&&-1!==i.indexOf(n)}else if(!e){var s=this.get("dsxplan:jsType",{noDSLCMapping:!0})||y.prototype.get.call(this,"dsxplan:actualType",{noDSLCMapping:!0});if(!(t=Boolean(s))){var o=y.prototype.get.call(this,y.ACTUAL_TYPE_ATTR,{noDSLCMapping:!0})||n;if((o=o&&(o.id||o))&&!(t="dslc:ItemVersion"===o)&&r&&r.typeDictionary&&r.typeDictionary.typeHierarchy){var a=r.typeDictionary.typeHierarchy["dslc:ItemVersion"];t=a&&-1!==a.indexOf(o)}}}return this._isDslc=t,t},setup:function(t,n){if(y.scheduleUpdateInverseProperties(this),n=n||{},this.isDSLC()&&this.inverseDslcMapping){var i=this;Object.keys(this.inverseDslcMapping).forEach((function(e){i.listenTo(i,"onChange:"+e,(function(t,n,i){i&&i.silent||t.dispatchEvent("onChange:"+this.inverseDslcMapping[e],arguments)}))}))}!this.collection&&n.mask&&(this.mask=n.mask),this.isNew()&&this.set("_skeletonId","temp:"+this.cid),this.listenTo(this,"onChange",this._registerChangedAttributes),this.listenTo(this,"onChange:@href",this.onHRefChange),this.listenTo(this,"onChange:@id",this.onAtIdChange),this.listenTo(this,"onChange:rdf:type",this.onTypeChange),this.listenTo(this,"onChange:dsplan:actualType",this.onTypeChange),this.listenTo(this,"onChange:dsxplan:actualType",this.onTypeChange),this.listenTo(this,"onChange:dsxplan:jsType",this.onTypeChange);var s=r.getTypeCollection(this.constructor,{create:!0}),o=e.clone(n,!1);if(o.parse=!1,o.fireTypeCollectionEvent&&delete o.silent,s.get(this))throw new Error("object existing try to get existing from rdfutils first!");s&&s.add(this,o),this.id?u.addModelToMap(this):r.addObjectToMap(this.cid,this)},_updateInverseProperties:function(){if(this._propertyDictionary){Object.entries(this._propertyDictionary).filter((([e,t])=>t.inverseProperty)).forEach((([e,t])=>{const n=this.get(e);n&&this._updateInverseProperty(e,n,{fromServer:!0})}))}},url:function(e){var t,n;if(this.isNew()){var i=this.collection.getUri({forNewObject:!0});t=r.expandUrl(i),n="/resource"===i.substr(0,9)}else t=r.expandUrl(this.get("@href")?this.get("@href"):"","v1");var s=e&&e.mask;return s||(s=this.getMask(),this.isNew()&&(s=n?this.parentMask||this.collection.getMask():this.writeMask||s)),a.addQueryParam(t,"$mask",s)},_originalGet:function(){return n.prototype.get.apply(this,arguments)},get:function(e,t){var n=Array.prototype.slice.call(arguments,0),i=e;return t&&t.noDSLCMapping||!this.isDSLC()||!this.dslcMapping||(i=this.dslcMapping[i]||i),n[0]=i,"physicalId"===i?this.id&&r.jsonURIToSparqlURI(this.id):this._models[i]||this._collections[i]||this._parent.apply(this,n)},compactJson:function(){if(this.isNew())return this.toJSON({noSkeletonId:!0,noEmptyCollection:!0});var e={};return e[this.idAttribute]=this.id,e},parse:function(n,i){var s;if(!e.is(n,"object"))return{value:n};var o=e.clone(n||{},!1);n&&n["@href"]&&0===n["@href"].indexOf("/invoke/")&&(o=n["@value"]||n.value),s=r.parseUrl(o["@href"]),r.handleContext(o),delete o["@context"],delete o["@code"],this.addMask(o["@mask"]),s.path&&(o["@href"]=s.path),(!this.mask||r.compareMasks(this.getMask(),o["@mask"])<0)&&(this.mask=o["@mask"]);var a=o["@mask"];a&&l.addMask(a),delete o["@mask"];var c=o["@id"];return c&&(c.test(/[/?]/)?o._skeletonId=t.getCheckSum("_"+c):o._skeletonId=c),o.image&&(o.image=r.getAssetUrl(o.image)),o["@id"]&&o["@id"]!==this.id&&this.set("@id",o["@id"],{dontRegisterChange:!0}),this._parseNestedModelsAndCollections(o,a,i),this._parsePruneModelsAndCollections(o,a,i),o},_parseNestedModelsAndCollections:function(t,n){var i=t,s=n;Object.keys(i).forEach((function(t){var n;n=!e.is(i[t],"string")||"dsxplan:hasPriority"!==t&&"dsxplan:hasMaturity"!==t&&"dsplan:resolution"!==t?i[t]:{"@id":i[t]},(v(n,"object")&&n["@id"]||"dsxplan:hasPriority"===t||"dsxplan:hasMaturity"===t||"dsplan:resolution"===t)&&("Collection"===n["@type"]?this.parseNestedCollection(i,s,t,n):this.parseNestedModel(i,s,t,n))}),this)},parseNestedCollection:function(t,n,i,s){var r,o=!0;if(s.member&&s.member.length&&(r=s.member,o=!e.Array.detect(r,(function(t){return!e.is(t,"string")}))),o&&r){var a=e.clone(r,!1);this.set(i,a,{dontRegisterChange:!0}),t[i]=a,l.addAttributeToMask(n,i,l.ARRAY_ATTR)}else this.addNewCollectionData(i,s,{parse:!0,fromServer:!0}),s.member&&l.addAttributeToMask(n,i,l.COLLECTION_ATTR)},parseNestedModel:function(e,t,n,i){let s=this._models[n];s&&s.id===i["@id"]?s.set(s.parse(i),{dontRegisterChange:!0,dontAdjustDates:!0,fromServer:!0}):(s=y.mergeOrCreateObject(i),this._models[n]=s),e[n]=s,t&&l.addAttributeToMask(t,n,l.MODEL_ATTR)},_parsePruneModelsAndCollections:function(t,n,i){var s=n,r=t;if(s)for(var o,a=l.getMask(s),c=Object.keys(a),d=c.length,u=function(e){return!e.isNew()},p=function(e){e.isNew()&&o.push(e)},h=0;h<d;h++){var g=c[h];if(!r[g])switch(a[g]){case l.COLLECTION_ATTR:var f=this.get(g,{noDSLCMapping:!0}),m=e.clone(i||{},!1);if(delete m.batchFetch,delete m.parse,m.dontRegisterChange=!0,f){f.moreItems=!1,o=f._added.filter(u),f.forEach(p);var y=f.length;if(f.reset&&f.reset(o||[],m),y!==f.length){this._fireRelationshipChangeEvents(g,m);try{var v=this._attributes&&this._attributes[g];v&&(v.totalItems=f.length,v.member=f.pluck("@id").map((function(e){return{"@id":e}})))}catch(e){console.log(e)}}}break;case l.MODEL_ATTR:var C=g;this.isDSLC()&&this.inverseDslcMapping&&this.inverseDslcMapping[C]&&(C=this.inverseDslcMapping[C]),e.is(this.unsetModelFromKey,"function")&&this.unsetModelFromKey(g,r[C],i),this.parsePruneModel(g,r[C],i);break;case l.STRING_ATTR:case l.ARRAY_ATTR:default:void 0!==r[g]&&null!==r[g]||void 0!==this.get(g)&&this.unset(g,{dontRegisterChange:!0})}}},parsePruneModel:function(e,t,n){!this._models[e]||this._models[e]===t||n&&n.silent||this._fireRelationshipChangeEvents(e,n),delete this._models[e],delete this._attributes[e]},removeObject:function(t,i,s){var r=t;this.isDSLC()&&this.dslcMapping&&(r=this.dslcMapping[r]||r);var o=this._collections[r];if(o){if(e.is(i,"number"))o.at(i);else{if(!(i instanceof n))throw new Error("invalid object to remove "+i);i}o.remove(i,s),this._fireRelationshipChangeEvents(r,s,s&&s.silentOnChange),s&&s.silent&&(this._registerChangedCollection(r,i,o,s),o._registerRemovedModel(i,o,s))}else this._models[r]===i&&(this.unset(r,s),s&&s.silent&&this._registerChangedAttributes())},getMask:function(){return this.mask||this.collection&&this.collection.getDetailsMask()},dataForRendering:function(t){var n=e.clone(t||{},!1);return n.dataForRendering=!0,this.toJSON(n)},_setDateAttribute:function(t,n,i){if(n instanceof Date)this.set(t,n.toISOString(),i);else{if(!e.is(n,"string"))throw new Error(n+" is not a date object or a string. It was not saved for the model.");this.set(t,n,i)}i&&i.silent&&this._registerChangedAttributes()},isOfType:function(e){var t=r.typeDictionary.typeMap,n=this.get("dsxplan:jsType")||this.get("dsxplan:actualType")||this.get("dsplan:actualType");return n=n.id||n,!(!t||!n)&&t[e].key===n},_fireRelationshipChangeEvents:function(t,n,i,s){if(!(n&&n.silent||(s||(this.dispatchEvent("onChange:"+t,[this,n]),n&&"add"===n.operation?this.dispatchEvent("onAdd:"+t,[this,n]):n&&"remove"===n.operation&&this.dispatchEvent("onRemove:"+t,[this,n])),i))){var r=e.clone(n||{},!1);r.relationshipChanged=t,this.dispatchEvent("onChange",[this,r])}},addObjects:function(e,t,n,i){var s=t;this.isDSLC()&&this.dslcMapping&&(s=this.dslcMapping[t]||s);var r,o=[],a=e.length,l=this._collections[s];l||(l=this._createCollection(s,void 0,i));for(var c=0;c<a;c++){var d=this.getObjectToBeAdded(e[c],i);o.push(l.add(d,i)),i&&i.silent&&l._registerAddedModel(d,l,i)}if(o.length)try{this._changing||(r=this._changed,this._changed={}),this._fireRelationshipChangeEvents(s,i,i&&i.silentOnChange),i&&i.silent&&this._registerChangedCollection(s,l,i)}finally{this._changing||(this._changed=r)}return o},getObjectToBeAdded:function(t,n){var i;if(t instanceof y)i=t;else if(e.is(t,"string"))(i=r.getObjectById(t))||(i=new y(r.createPlaceholder(t))).fetch(n);else if(t["@id"]&&t["@type"]){var s=e.clone(t,!1),o=r.getModelConstructor(t);s.mask=n.mask||o.prototype.mask||"dsplan:MVMask.Task.Basic",i=r.getObjectForAdding(o,t["@id"],s)}return i},addModelToAttributeWithCollection:function(t,n,i){var s,r=this._collections[t],o=e.clone(i||{},!1);if(r)s=r.add(n,i);else{o.parse=!0;var a=this._jsonForCollectionForAttribute(t);n&&(a.member=[n]),r=this.addNewCollectionData(t,a,o),n&&r.dispatchEvent("onAdd",[r.at(0),r]),s=r.first()}return s},_jsonForCollectionForAttribute:function(e,t){return{"@href":this._computeCollectionId(e,t),"@id":this.get("@id")+"/"+e,"@type":"Collection","@mask":t&&t.mask||this.getMask()}},addNewCollectionData:function(t,n,i){var s=this._collections[t];if(s){var r=function(e,t){return e+"|"+t.id},o=s.reduce(r,""),a=s.state.totalRecords;s.update(n,i);var l=s.reduce(r,""),c=s.state.totalRecords;l===o&&c===a||this._fireRelationshipChangeEvents(t,i)}else{var d=e.clone(i||{},!1);d.parentModel=this,s=this._createCollection(t,n,d)}return s},_createCollection:function(t,n,i){var s=n;e.is(n,"array")&&((s=this._createCollection(t)).member=n);var r=this.getCollectionConstructor(t),o=e.clone(i||{},!1);o["@href"]=this._computeCollectionId(t,o);var a=new r(s,o);return this.setCollection(t,a),this.set(t,a,{dontRegisterChange:!0}),this.getPropertyInverse(t).name&&this._scheduleUpdateInverseProperty(t,a),a},_scheduleUpdateInverseProperty:function(e,t){setTimeout((()=>{for(var n=0;n<t.length;n++){var i=t.at(n);this._updateInverseProperty(e,i)}}),0)},getCollectionConstructor:function(e){var t,n=this.collectionConstructor;if(this._relations&&(t=this._relations.detect((function(t){return t.key===e}))),t){var i=t.relatedCollection;i&&(n=i)}return n},getChangedAttributesSinceLastSave:function(){return this._changedAttributesSinceLastSave?Object.keys(this._changedAttributesSinceLastSave):[]},_computeCollectionId:function(e){return this.get("@href")+"/"+e},onHRefChange:function(){var e=this;this._collections&&Object.keys(this._collections).forEach((function(t){var n=e._collections[t],i=e._computeCollectionId(t,{mask:n.getMask()});n.setUri(i)}))},onAtIdChange:function(){this.id?(r.addObjectToMap(this.id,this),u.addModelToMap(this)):r.addObjectToMap(this.cid,this);var e=this.previousAttributes()["@id"];e?r.removeObjectFromMap(e):this.id&&r.removeObjectFromMap(this.cid)},setModel:function(t,n,i){var s=f.setHelper.apply(this,arguments),r=e.clone(s.attrs||{},!1);i=s.options,this.isDSLC()&&r&&(r=this._mapDslcAttributes(r));for(var o=Object.keys(r),a=o.length,l=0;l<a;l++){var c=o[l],d=r[c];this._models[c]!==d?(this._previousAttributes||(this._previousAttributes=e.clone(this._attributes,!1)),this._previousAttributes[c]=this._models[c],this._models[c]=d):delete r[c]}return C.prototype.set.call(this,r,i)},set:function(){var t=f.setHelper.apply(this,arguments),n=e.clone(t.attrs||{},!1),i=t.options;this.isDSLC()&&n&&(n=this._mapDslcAttributes(n)),this._removeModelsForUndefinedValues(n);var s=this._setModelIfNeeded(n,i);return this._parent(n,i)&&s},_removeModelsForUndefinedValues:function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var i=t[n];void 0===e[i]&&delete this._models[i]}},_setModelIfNeeded:function(e,t){for(var n=Object.keys(e),i=n.length,s={},r=!1,o=0;o<i;o++){var a=n[o],l=e[a];l instanceof y&&(s[a]=l,r=!0)}var c=!0;return r&&(c=this.setModel(s,t)),c},syncDelete:function(e){if(this.isVersion()&&this.isDSLC()||e.dslc){e.url=r.expandUrl(y.DELETE_ITEM_VERSION_URI),e.data=JSON.stringify(this._prepareDataForDelete(e)),e.method="POST";var t=e.onComplete;e.onComplete=function(e){var n=e.member;if(n)for(var i=0;i<n.length;i++){var s=n[i],o=r.getObjectById(s);o&&o.destroy({noServer:!0})}t.apply(this,arguments)}}this.handleDeleteFailure(e)},handleDeleteFailure:function(e){var t=e.onFailure,n=e.onComplete;this._collectionsRemovedFrom=[];var i=this;e.onFailure=function(){r.addObjectToMap(i.id,i),r.addObjectToMap(i.cid,i),i._collectionsRemovedFrom.forEach((function(e){e.add(i)})),delete i._collectionsRemovedFrom,t&&t.apply(i,arguments)},e.onComplete=function(){delete i._collectionsRemovedFrom,n&&n.apply(i,arguments)}},onRemovedFromCollection:function(e){this._collectionsRemovedFrom&&this._collectionsRemovedFrom.push(e)},fetch:function(t){var n=e.clone(t||{},!1);return n.dontUpdateMask&&(n.url=this.url(t)),n.mask&&n.onlyIfNeeded&&this.hasDataForMask(n.mask,{checkFetching:!0})?(n.onComplete&&n.onComplete(this),{cancel:function(){}}):this._parent(n)},isPropertyVolatile:function(e){return"@etag"===e||this._propertyDictionary&&this._propertyDictionary[e]&&this._propertyDictionary[e].volatility},getPropertyInverse:function(e){return{name:this._propertyDictionary&&this._propertyDictionary[e]&&this._propertyDictionary[e].inverseProperty,isCollection:this._propertyDictionary&&this._propertyDictionary[e]&&this._propertyDictionary[e].inversePropertyIsCollection}},getPropertyThisIsInverseOf:function(e){var t;if(this._propertyDictionary){var n=this;Object.keys(this._propertyDictionary).some((function(i){return n._propertyDictionary[i].inverseProperty===e&&(t=i),void 0!==t}))}return t},getParentPath:function(){return this.collection.getIdForCreateChildDSLC()},addMask:function(t){this._usedMasks=this._usedMasks||[],t&&-1===this._usedMasks.indexOf(t)&&(this._usedMasks.push(t),e.merge(this._fetchedAttributes,l.getMask(t)))},removeMask:function(e){const t=this._usedMasks.findIndex((t=>t===e));if(t>=0)return this._usedMasks.splice(t,1)},getMasks:function(){return this._usedMasks||(this._usedMasks=[]),this._usedMasks},hasDataForMask:function(e,t){var n=l.isSubMask(e,this.getMasks());if(!n&&t&&t.checkFetching&&this._masksBeingFetched){var i=Object.keys(this._masksBeingFetched);n=l.isSubMask(e,i)}return n},resetMasks:function(){this._usedMasks=[]},unset:function(e){var t,n=this._models[e],i=this._collections[e];n&&(t=this._previousAttributes[e],this._previousAttributes[e]=n,delete this._models[e]),i&&(t=this._previousAttributes[e],this._previousAttributes[e]=n,delete this._collections[e]);var s=this._parent.apply(this,arguments);return s||(this._models[e]=n,this._collections[e]=i,this._previousAttributes[e]=t),s},getTagPrefix:function(){return r.TAGGER_URI_PREFIX},getObjectType:_,getDragType:_,getObjectTypeNLS:function(){return f.translateType(_.call(this))},getTransferObject:function(n){var i=this.getDragType(),s=e.clone(n||{},!1);s&&delete s.parentObject;var r=e.merge(s,{source:window.widget.getValue("appId")||"X3DCSMA_AP",envId:window.enoviaServer&&window.enoviaServer.tenant||window.widget.getValue("x3dPlatformId"),objectId:this.get("physicalId"),objectType:i,objectType_Internal:i,displayType:f.translateType(i),displayName:this.get("title"),serviceId:s.serviceId||"3dplan",image:this.get("image"),objectState:this.get("@etag")||t.getUUID()});let o=this.getIconURL&&this.getIconURL();return o&&(r.displayIcon=o,o!==r.image&&(r.displayPreview=r.image)),f.getTransferObject(r)},getLaunchOptions:function(){var e={appId:"ENXPLAN_AP"};return e.ids=this.id,e.x3dPlatformId=window.enoviaServer.tenant||window.widget.getValue("x3dPlatformId"),e},isVersion:function(){return!1},hasChanged:function(e){var t=e;return this.isDSLC()&&this.dslcMapping&&(t=this.dslcMapping[e]||t),this._parent(t)},hasFetchedAttribute:function(e){var t=this.isDSLC()&&(this.dslcMapping[e]||e);return this.getMasks().detect((function(e){return l.getMask(e)[t]}))},getFetchedAttributes:function(){return this._fetchedAttributes},processLiveUpdateCreation:function(e){var t=r.getObjectById(e["@parentId"]),n=t.getCollectionAttributeBasedOnModel(this);if(t.hasFetchedAttribute(n)){t.getCollectionAttribute(n).add(this,{dontRegisterChange:!0});var i=this.liveUpdateCreateMask||"dsplan:MVMask.ScheduleElements.Basic";this.fetch({mask:i})}},_fetchHistoryFromS3Bucket:function(e){var t=window.enoviaServer&&window.enoviaServer.tenant;const n=h.getServiceUrl("3dplan",!0)+`/auditarchive/api/v1/historyentries/${this.id}?tenantId=${t}&sourceService=3DPLAN`;return r.request(n,{method:"GET",type:"json",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},onComplete:t=>this._fetchHistoryFromRDF(t,e),onFailure:()=>this._fetchHistoryFromRDF([],e),onCancel:()=>{this.fetchingHistory=!1}})},_fetchHistoryFromRDF:function(t,n){var i=e.clone(n||{},!1),s=this.id;const o=r.expandUrl(`invoke/dsaudit:Auditable.getHistory?$this=${s}`,"v1");return r.request(o,{method:"POST",type:"json",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},onComplete:e=>{this.fetchingHistory=!1,i.onComplete&&i.onComplete.apply(this,[e,t])},onFailure:e=>{this.fetchingHistory=!1,i.onFailure&&i.onFailure.call(this,e)},onCancel:()=>{this.fetchingHistory=!1}})},fetchAuditHistoryData:function(t){this.fetchingHistory=!0;var n=e.clone(t||{},!1),i=h.getServiceUrl("3dplan",!0)+`/resources/v1/3dplan/history?rootId=${encodeURIComponent(this.id)}&includeChildren=${!!n.includeChildren}`;return n.identifier&&(i+=`&identifier=${encodeURIComponent(n.identifier)}`),r.request(i,{method:"GET",type:"json",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},onComplete:t=>{this.fetchingHistory=!1;const i=t.archiveHistory||[],s=t.rdfHistory||{};e.is(n.onComplete,"function")&&n.onComplete.call(this,{s3History:i,rdfHistory:s})},onFailure:t=>{this.fetchingHistory=!1,e.is(n.onFailure,"function")&&n.onFailure.call(this,t)},onCancel:()=>{this.fetchingHistory=!1}})},getRelatedModelCompactJson:function(e){return e.compactJson()},isDeleted:function(){return!this.get("dsxplan:jsType")||0===this.get("dsxplan:jsType").indexOf("dsplan:Deleted")},getTaggerURI:function(){var e=this.get("physicalId")||this.id;return this.isRDF&&(e=this.getTagPrefix()+r.conditionalShortToLongURI(e)),e},uploadingFileForAttribute:function(e){return this._attributes[e]&&this._attributes[e].input&&this._attributes[e].input instanceof File},setTagsData:function(e){this.tagsData=e,this.dispatchEvent("onChange:tagsData")}},(y=C.extend(y)).implement(d),d.initFetchTrackingMixinForClass(y),y.shouldCreateOnLiveUpdate=function(e){var t=r.getObjectById(e["@parentId"]);return Boolean(t)},y.RDF_TYPE="rdf:type",y.ACTUAL_TYPE_ATTR="dsplan:actualType",y.getObjectById=r.getObjectById,y.mergeOrCreateObject=function(e){var t=r.getModelConstructor(e);t=t||y;var n=r.getExistingAndMerge(e);return(n=n||new t(e,{parse:!0,collectionConstructor:this.collectionConstructor}))&&n._updateInverseProperties(),n},Object.defineProperty(y.prototype,"tenant",{get:function(){return window.enoviaServer.tenant}}),Object.defineProperty(y,"fakeEmptyCollection",{get:function(){var e=[];return e.get=function(){},e.first=e.get,e.toArray=function(){return this},e}}),y.resetObjectMap=r.resetObjectMap,Object.defineProperty(y.prototype,"fedSearchIdQuery",{get:function(){if(this.id)return f.isWedoTask(this.get("dsxplan:jsType"))?'resourceid:"'+r.removeBracketLongURI(this.id)+'"':'uri:"'+r.shortToLongURI(this.id)+'"'}}),Object.defineProperty(y.prototype,"parentId",{get:function(){return this._parentId},set:function(e){if(this._parentId){var t=r.getObjectById(this._parentId);this.stopListening(t,"onModifyAccessChanged"),this.stopListening(t,"onDeleteAccessChanged")}this._parentId=e,r.getObjectById(e)&&this.listenTo(r.getObjectById(e),{onModifyAccessChanged:this.dispatchEvent.bind(this,"onModifyAccessChanged"),onDeleteAccessChanged:this.dispatchEvent.bind(this,"onDeleteAccessChanged")})}}),y.scheduleUpdateInverseProperties=r.scheduleUpdateInverseProperties,y.MODIFY_ITEM_VERSION_URI="/invoke/dsxplan:modifyItemVersion",y.CREATE_ITEM_VERSION_URI="/invoke/dsxplan:createItemVersion",y.CLONE_ITEM_VERSION_URI="/invoke/dsxplan:cloneItemVersion",y.DELETE_ITEM_VERSION_URI="/invoke/dsxplan:deleteItemVersion",y.events=new s,r.setDefaultModelConstructor(y),y})),define("DS/RDFFoundation/Models/ComponentProxyModel",["UWA/Core","DS/RDFFoundation/Models/ComponentProxyIndexModel","DS/RDFFoundation/Models/ResultModel","DS/RDFFoundation/Models/NoAccessModel","DS/RDFFoundation/Models/DeletedModel","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/Models/ObjectProxyUtil"],(function(e,t,n,i,s,r,o){"use strict";var a=function(e){return function(){var t=Array.prototype.slice.call(arguments,0);return t[0]=this,this.dispatchEvent("onChange"+(e?":"+e:""),t)}},l=n.extend({_uwaClassName:"ComponentProxyModel",writeMask:"dsplan:MVMask.ComponentProxy.Complex",_propertyDictionary:{"dsxplan:hasContributingElements":{inverseProperty:"dsxplan:hasWorkContext",volatility:!0}},init:function(t,n){const i=e.clone(t||{},!1);if(!t["dscom:ServiceHosting"]){const e=t["@id"].match(/dscom:(.*?)_/);e&&e[1]&&(i["dscom:ServiceHosting"]=e[1])}this._parent(i,n)},setup:function(n,i){var s=e.clone(i||{},!1);s.mask="dsplan:MVMask.ComponentProxy.Complex";var r=this._getProxyModelId(this.id);if(this.indexModel=t.getObjectById(r),!this.indexModel){var o={resourceid:r,tenant:this.get("dscom:Tenant"),source:this.sourceName,description:this.get("description")};"businessprocess"===this.sourceName&&(o["dscom:ProxyType"]=this.get("dscom:ProxyType")),this.indexModel=new t(o);var l=this;"3DLean"===this.get("dscom:ServiceHosting")||s.noFetch||this.indexModel.fetch({onComplete:function(){if("3DSpace"===l.get("dscom:ServiceHosting")){let n=l.get("ds6w:label"),i=l.get("modified");if(!n&&!i){var t=e.clone(arguments[2]||{},!1).onFailure;t&&t("object_not_found")}}},onFailure:function(e,t){"object_not_found"===t&&(l.indexModel._noAccess=!0,l.dispatchEvent("onModelAccessChanged"))}})}this.listenTo(this.indexModel,"onChange:ds6w:label",a("title")),this.listenTo(this.indexModel,"onChange:type_icon_url",a("image")),this.listenTo(this.indexModel,"onChange:ds6w:type",a("ds6w:type")),this.listenTo(this.indexModel,"onChange:modified",a("modified")),this.listenTo(this.indexModel,"onChange",a()),this._parent(n,s)},canShowProperties:function(){return!["3DLean","3dlifecycle"].includes(this.sourceName)},hasViewAccess:function(){return Boolean(this.forceAccess||this.indexModel&&!this.indexModel._noAccess)&&!this.isDeleted()},isDeleted:function(){return Boolean(this.indexModel&&"DELETED"===this.indexModel.get("ds6w:type"))},getLaunchOptions:function(e){var t=this._parent.apply(this,arguments);return"swym:Community"===this.getDragType()?(t.appId="X3DMCTY_AP",t.community=this.get("physicalId"),t.communityType="community"):"Project Space"===this.getDragType()?(t.ids=this.get("physicalId"),t.appId="ENOPRPR_AP"):"3dportfolio"===this.serviceHosting&&(t.ids=r.removeBracketLongURI(this.get("physicalId")),t.appId="ENXPORT_AP"),t.x3dPlatformId=this.tenant,t},_getProxyModelId:function(e){if(this.get("dscom:ServiceHosting")){var t=("dscom:"+this.get("dscom:ServiceHosting")+"_").length;return decodeURI(e.substring(t))}return e.split("_")[1]},set:function(e,t){if("modified"===e)this.indexModel.set(e,t);else{if("title"!==e)return this._parent.apply(this,arguments);this.indexModel.set("ds6w:label",t)}},get:function(e){var t=this._parent.apply(this,arguments);switch(e){case"name":case"title":return this.indexModel.get("ds6w:label")||t;case"physicalId":return this.indexModel.id||this._getProxyModelId(this.id);case"image":return this.indexModel.get("preview_url")||this.indexModel.get("type_icon_url")||t;case"ds6w:type":case"type":return this.indexModel&&this.indexModel.get("ds6w:type")||t;case"kind":case"ds6w:kind":return this.indexModel.get("ds6w:kind")||t;case"hasfiles":return r.DOWNLOADABLE_TYPES.includes(this.get("type"));case"fileExtension":return this.indexModel.get("ds6w:docextension")}return t||(t=this.indexModel&&this.indexModel.get(e)),t},toJSON:function(e){var t=this._parent.apply(this,arguments);if(e&&e.dataForRendering){t.image=this.get("image"),t.type=this.get("type"),t.hasfiles=this.get("hasfiles"),t.fileExtension=this.get("fileExtension"),t.source=this.get("source");var n=this.get("revision");if(t.revision=n&&n.length>10?"":n,t.islast=this.get("islast"),t.title=this.get("title"),this.isDeleted())t=(new s).toJSON();else if("No Access"===t.error||!this.hasViewAccess())t=(new i).toJSON();t.physicalId=this.get("physicalId")}else t["ds6w:type"]=this.get("ds6w:type");return t},syncCreate:function(e,t){t.noStringify=!0;var n=this._parent.apply(this,arguments),i="/invoke/dsxplan:createProxyModel",s=this.writeMask||this.getMask(),o=s?"?$mask="+s:"";t.url=r.expandUrl(i+o),t.data=JSON.stringify([t.attrs]),t.method="POST";var a=t.onComplete;return t.onComplete=function(e,t){var n=e;return n["@href"]===i&&(n=n["@value"]||n.value),a.call(this,n,t)},n},getParentPath:function(){return""},getIdForFederatedSearch:function(){return this.get("physicalId")},getTransferObject:function(t){let n=e.clone(t||{},!1);e.merge(n,{serviceId:this.serviceHosting,envId:this.tenant});try{var i,s=this.getDragType();if(s&&(i=e.clone(this.get("parentTypes")||[s],!1)),i&&0!==i.length)if("Document"===s){var r=i,o=this.indexModel.get("files");if(o&&1===o.length){var a=o[0].dataelements.title.match(/\.[^.]*$/);r.push(a[0])}n.objectTaxonomies=r}else"URL"===s?(n.linkURL=this.get("linkURL"),n.description=this.get("description")):0!==Object.keys(i).length&&(n.objectTaxonomies=i);var l=this.get("ds6w:kind");l&&s&&(n.objectTaxonomies=n.objectTaxonomies||[s],n.objectTaxonomies.push(l))}catch(e){console.log(e)}return this.isCSLOnly()&&(n.i3dx=this.indexModel.id),this._parent(n)},isCSLOnly:function(){return o.supportedi3dx(this.indexModel.id)},getObjectType:function(){return this.get("type")},getDragType:function(){return this.get("type")}});return Object.defineProperty(l.prototype,"tenant",{get:function(){return this.get("dscom:Tenant")}}),Object.defineProperty(l.prototype,"serviceHosting",{get:function(){return this.get("dscom:ServiceHosting")}}),Object.defineProperty(l.prototype,"sourceName",{get:function(){return"3DPlan"===r.sourceFromService(this.serviceHosting)?"3dplan":r.sourceFromService(this.serviceHosting)||""}}),Object.defineProperty(l.prototype,"fedSearchIdQuery",{get:function(){return'[ds6w:resourceUid]:"'+this.get("physicalId")+'"'}}),l.computeURI=function(e){let t=e.id||e.objectId;return e.i3dx&&o.supportedi3dx(e.i3dx)&&(t=e.i3dx),"dscom:"+e.serviceId+"_"+encodeURI(t)},l.getNewProxyModel=function(e){var t="dscom:"+e.serviceId+"_",n=e.id||e.objectId;0!==n.indexOf(t)&&(n=l.computeURI(e));let i={title:e.title,image:e.image,"dscom:ServiceHosting":e.serviceId,"dscom:Tenant":e.envId?e.envId:e.tenant,type:e.type||e.objectType,"@type":"dscom:ComponentProxy"};"URL"===e.type&&(i.linkURL=e.linkURL,i.description=e.description,i.name=e.name),"businessprocess"===e.serviceId&&(i["dscom:ProxyType"]=e["dscom:ProxyType"]);var s=r.getObjectForAdding(l,n,{attrs:i});return s.forcedNew=!0,s},l.getOrCreateProxy=function(e,t){let n=r.getObjectById(l.computeURI(e));return n||(n=l.getNewProxyModel(e),t&&n.save(void 0,{ajax:t.ajax})),n},l.getOrCreateFromFedSearchResult=function(n){try{const i=e.clone(n||{},!1),s=t.getOrCreateFromFedSearchResults(i);return l.getOrCreateProxy({id:s.get("resourceid"),title:s.get("ds6w:label"),serviceId:s.get("serviceId"),tenant:s.get("tenant")})}catch(e){console.warn(`Unable to create proxy model for: ${JSON.stringify(n)}`)}},l})),define("DS/RDFFoundation/Models/MemberModel",["UWA/Core","DS/RDFFoundation/Models/ResultModel","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/MemberUtils","DS/E6WCommonUI/UIHelper","DS/E6WCommonUI/E6WCommonUIConstants","DS/RDFFoundation/Models/ComponentProxyIndexModel"],(function(e,t,n,i,s,r,o){"use strict";var a=["ds6w:label","ds6w:type","type_icon_url","ds6w:docextension","preview_url","resourceid","ds6w:resourceUid"],l=require.toUrl(r.DEFAULT_PROFILE_IMG_PATH),c={};a.forEach((function(e){c[e]=!0}));var d=t.extend({_uwaClassName:"MemberModel",parse:function(e){return e&&e.attributes?o.prototype.parse.call(this,e,{selectPredicates:c}):this._parent.apply(this,arguments)},setup:function(){return this.fetch(),this._parent.apply(this,arguments)},memberSync:function(t,n,i){var s=this;if("read"===t){var r=e.clone(i||{},!1);r.queue=d;var a=this.getIdForFederatedSearch(),l=i.onComplete;return r.onComplete=function(){var e=arguments[0];s._processTaggerDataAndStoreOnModel(n,arguments),s.completing=!1,l&&l.apply(this,arguments),s.dispatchEvent("onFetchDone",arguments),"foaf:Group"===s.getObjectType()&&(s.setLabel(e.attributes&&e.attributes.find((e=>"ds6w:label"===e.name)).value),s.setViewAccess(Boolean(s.get("ds6w:label"))),s.dispatchEvent("onChange",[s]),s.dispatchEvent("onAccessSetOfGroup",[s]))},r.onFailure=function(){var t=i.onFailure,n=e.clone(r||{},!1);n.onFailure=function(){s.completing=!1,t&&t.apply(this,arguments),s.dispatchEvent("onFetchDone"),"foaf:Group"===s.getObjectType()&&(s.setViewAccess(Boolean(s.get("ds6w:label"))),s.dispatchEvent("onChange",[s]),s.dispatchEvent("onAccessSetOfGroup",[s]))},"foaf:Group"!==s.getObjectType()?s.getPersonFromRDF(n):s.fetchUserGroupName(n)},r.source=this.source,r.additionalQueryStatement=a?void 0:this.additionalQueryStatement,r.idAttributeForFederatedSearch=this.idAttributeForFederatedSearch,d.optimizeSearchQuery=!0,d.toBeFetched[a]||(this.completing=!0),o.requestFetch({id:a},r)}},_processTaggerDataAndStoreOnModel:function(e,t){var n=t&&t[0].attributes;if(n){var i=e.collection.getModelAndProcessedTaggerDataAttributes(n);e.setTagsData(i.tags),e.set("explicitTagsData",i.explicitTagsData)}},get:function(e){var t=this.id&&n.splitUri(this.id)[1];switch(e){case"title":case"name":return this.getFullName();case"nameAndAccount":const e=this.get("dsaccess:accountName");return this.getFullName()&&(e?this.getFullName()+" ("+e+")":this.getFullName());case"image":return this.get("preview_url")||this.get("type_icon_url")||s.userPictureURL(t,"normal")||l;case"miniImage":return"foaf:Group"===this.get("ds6w:type")&&this.get("ds6w:label")?this.get("preview_url"):this.get("ds6w:label")||"foaf:Group"!==this.get("dsxplan:jsType")?s.userPictureURL(t,"mini")||l:require.toUrl("DS/E6WCommonApps/assets/img/defaultGroupPrivate.png");case"physicalId":return this._getPhysicalId();case"resourceUid":return this._getResourceUid();case"type":return this.get("ds6w:type");case"accountName":return this.get("dsaccess:accountName")}return this._parent.apply(this,arguments)},getFullName:function(){var e=this.get("resourceid");if(e&&e.startsWith("mailto:"))return n.splitUri(e)[1];var t=this.get("dsaccess:state");if(!e&&t&&"pending"===t)return this.get("dsaccess:mbox");var i=this.get("ds6w:label");if(!i){var s=this.getFirstName(),r=this.getLastName();i=s&&r&&s+" "+r}return i},getFirstName:function(){var e=this.get("foaf:givenName");return e&&e[0]},getLastName:function(){var e=this.get("foaf:familyName");return e&&e[0]},_getPhysicalId:function(){return n.jsonURIToSparqlURI(this.id)},_getResourceUid:function(){return n.jsonURIToSparqlURI(this.id)},toJSON:function(e){var t=e||{},n=this._parent.apply(this,arguments);return n.isRDF=!0,n.physicalId=this.get("physicalId"),n.resourceUid=this.get("resourceUid"),n.name=this.get("name"),n.image=this.get("image"),"dskern:Person.Guest"===this.id||"foaf:xPlanInfra"===this.id||"dskern:Person.Creator"===this.id?(n.firstname=this.id.split(":")[1],n.fullName=n.firstname):n.fullName=this.get("name")||n.name||n["ds6w:label"],n.title=n.fullName,n.nameAndAccount=this.get("nameAndAccount"),t.dataForRendering&&(n.type="pno:Person"),n},getPersonFromRDF:function(e){var t=["resources/",n.removeBracketLongURI(this.id),"?$mask=dsplan:MVMask.Person.Complex"].join(""),i=n.expandUrl(t,"v1");n.request(i,{method:"GET",type:"json",onComplete:e.onComplete,onFailure:e.onFailure})},getDragType:function(){return this.getObjectType()},getTransferObject:function(){return this._parent({objectId:this.get("physicalId"),resourceUid:this.get("resourceUid"),displayName:this.fullName,serviceId:this.serviceHosting})},hasViewAccess:function(){return!0}});return Object.defineProperty(d.prototype,"fullName",{get:function(){return this.get("name")}}),Object.defineProperty(d.prototype,"serviceHosting",{get:function(){return this.serviceId}}),Object.defineProperty(d.prototype,"physicalId",{get:function(){return this.get("physicalId")}}),Object.defineProperty(d.prototype,"fedSearchIdQuery",{get:function(){return this.idAttributeForFederatedSearch+':"'+this.getIdForFederatedSearch()+'"'}}),d.toBeFetched={},d.idAttributeForFederatedSearch=i.idAttributeForFederatedSearch,d.select_predicate=a,d})),define("DS/RDFFoundation/Models/PersonRDFModel",["UWA/Class/Events","DS/E6WCommonUI/PlatformManager","DS/E6WCommonUI/E6WCommonUIConstants","DS/RDFFoundation/Models/MemberModel","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/MemberUtils"],(function(e,t,n,i,s,r){"use strict";var o=i.extend({_uwaClassName:"PersonRDFModel",additionalQueryStatement:'[ds6w:type]:"pno:Person"',source:"swym",sourceName:"swym",serviceId:"3DSwym",idAttributeForFederatedSearch:"[ds6w:resourceUid]",getIdForFederatedSearch:function(){return r.removeUUIDFromURI(this.id)},getObjectType:function(){return n.PERSON_TYPE},sync:function(){return this.memberSync.apply(this,arguments)},_getPhysicalId:function(){var e=this.get("resourceid");if(e&&e.startsWith("mailto:"))return e;var t=this.get("dsaccess:state");return!e&&t&&"pending"===t?this.get("dsaccess:mbox"):r.addIamToURI(this.get("accountName"))},_getResourceUid:function(){return r.removeUUIDFromURI(this.id)}});return o.Events={CurrentUserModelCreated:"CurrentUserModelCreated"},o.Dispatcher=new e,o.loadAndCreateModelForCurrentUser=function(){function e(e){var n=s.getObjectForAdding(o,e,{attrs:{"dsaccess:accountName":t.getContextUser()}});n.addEvent("onSync",(function(){o.Dispatcher.dispatchEvent(o.Events.CurrentUserModelCreated,n)}))}r.setContextUserUid({onComplete:e,onFailure:e})},o})),define("DS/RDFFoundation/Models/UsersGroupRDFModel",["UWA/Core","DS/RDFFoundation/Models/MemberModel","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/MemberUtils","DS/E6WCommonUI/PlatformManager","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],(function(e,t,n,i,s,r){"use strict";var o=t.extend({_uwaClassName:"UsersGroupRDFModel",additionalQueryStatement:'[ds6w:type]:"foaf:Group"',source:"usersgroup",serviceId:"usersgroup",idAttributeForFederatedSearch:"uri",getIdForFederatedSearch:function(){return n.jsonURIToSparqlURI(this.id)},setup:function(){return this.setViewAccess(Boolean(this.get("ds6w:label"))),this._parent.apply(this,arguments)},setViewAccess:function(e){this._hasViewAccess=e},getObjectType:function(){return"foaf:Group"},setLabel:function(e){e&&this.set("ds6w:label",e)},hasViewAccess:function(){return this._hasViewAccess},sync:function(){return this.memberSync.apply(this,arguments)},get:function(e){switch(e){case"name":if(!this.hasViewAccess())return r.get("E6WCommonUI.Label.PrivateGroup");break;case"image":if(!this.hasViewAccess())return require.toUrl("DS/E6WCommonApps/assets/img/defaultGroupPrivate.png");break;case"nameAndAccount":return this.get("name")}return this._parent.apply(this,arguments)},fetchUserGroupName:function(e){let t=s.getServiceUrl("usersgroup",!0)+"/3drdfindex/v1/resources/"+n.removeBracketLongURI(this.id)+"?$mask=dsaccess:Mask.Group.Name";n.request(t,{method:"GET",type:"json",onComplete:e.onComplete,onFailure:e.onFailure})},includesCurrentUser:function(e){var t,r=JSON.stringify({taskId:e.id,personId:i.addUUIDToURI(s.getContextUserUid())});n.request(n.expandUrl("/invoke/dsxplan:isUserCandidate","v1"),{method:"POST",type:"json",data:r,headers:{"Content-Type":"application/json"},onComplete:function(n){n["@value"]&&(t=!0),e._membersChecked=!0,e._isUserACandidateAssignee=t,e.dispatchEvent("onUserGroupMembersFetched")},onFailure:function(e){console.log("err",e)}})},canShowProperties:function(){return!1},compactJson:function(){var e={};return e[this.idAttribute]=this.id,e.type="group",e}});return o})),define("DS/RDFFoundation/Models/URLModel",["UWA/Core","DS/RDFFoundation/Models/ResultModel","DS/E6WCommonUI/UIHelper","DS/RDFFoundation/RDFUtils"],(function(e,t,n,i){"use strict";var s=t.extend({_uwaClassName:"URLModel",writeMask:"dsplan:MVMask.URL.Complex",_propertyDictionary:{canEdit:{volatility:!0}},isDSLC:function(){return!0},init:function(t,n){const i=e.clone(t||{},!1),s=e.clone(n||{},!1);i["dsplan:jsType"]=i["dsplan:jsType"]||i["dsxplan:jsType"]||"dsplan:url",s.mask=this.getPropertyMask(),this._parent(i,s)},setup:function(t,n){var i=e.clone(n||{},!1);i.mask=this.getPropertyMask(),this._parent(t,i)},hasViewAccess:function(){return!0},set:function(){return this._parent.apply(this,arguments)},get:function(e){var t=this._parent.apply(this,arguments);switch(e){case"canEdit":return!0;case"ds6w:type":case"type":return"dsplan:url";case"description":return this.get("dsplan:comment");case"linkURL":return this.get("dsplan:linkURL");case"icon":case"image":return require.toUrl("DS/E6WCommonApps/assets/img/I_CommonIcon_Link_16.png")}return t},fetchForProperty:function(t){let n=e.clone(t||{},!1);n.mask=this.getPropertyMask&&this.getPropertyMask(),n.onlyIfNeeded=!0,this.fetch(n)},save:function(){var e=n.setHelper.apply(this,arguments),t=e.attrs||{},i=e.options;return this._parent(t,i)},toJSON:function(e){var t=this._parent.apply(this,arguments);return e&&e.dataForRendering?(t.image=this.get("image"),t.type=this.get("type"),t.title=this.get("title"),t.linkURL=this.get("linkURL"),t.physicalId=this.get("physicalId")):t["ds6w:type"]=this.get("ds6w:type"),t},syncCreate:function(e,t){t.noStringify=!0;var n=this._parent.apply(this,arguments),s="/invoke/dsxplan:createURLObject",r=this.writeMask||this.getMask(),o=r?"?$mask="+r:"";t.url=i.expandUrl(s+o),t.data=JSON.stringify([t.attrs]),t.method="POST";var a=t.onComplete;return t.onComplete=function(e,t){var n=e;return n["@href"]===s&&(n=n["@value"]||n.value),a&&a.call(this,n,t)},n},syncPatch:function(e,t){t.noStringify=!0;var n=t.onComplete,s="/invoke/dsxplan:modifyURLObject";return i.request(i.expandUrl(s),{method:"POST",noStringify:!0,type:"json",data:JSON.stringify([e]),onComplete:function(e,t){var i=e;return i["@href"]===s&&(i=i["@value"]||i.value),n&&n.call(this,i,t)}})},getParentPath:function(){return""},getIdForFederatedSearch:function(){return this.get("physicalId")},getTransferObject:function(t){let n=e.clone(t||{},!1);return e.merge(n,{serviceId:this.serviceHosting,envId:this.tenant}),n.linkURL=this.get("dsplan:linkURL"),this._parent(n)},getPropertyMask:function(){return"dsplan:MVMask.URL.Complex"},getObjectType:function(){return this.get("type")},getDragType:function(){return this.get("type")}});return s})),define("DS/RDFFoundation/Models/LogicalUserModel",["DS/RDFFoundation/Models/ResultModel","DS/E6WCommonUI/E6WCommonUIConstants"],(function(e,t){"use strict";var n=e.extend({_uwaClassName:"LogicalUserModel",source:t.SERVICE_3DPLAN,serviceId:t.SERVICE_3DPLAN,getObjectType:function(){return t.LOGICAL_USER_TYPE},canShowProperties:function(){return!1},getDragType:function(){return t.LOGICAL_USER_TYPE},get:function(e){let n=this._parent.apply(this,arguments);switch(e){case"miniImage":case"image":return require.toUrl("DS/E6WCommonApps/assets/img/role-avatar.png");case"fullName":case"name":return this.get("title")||this.get(t.DSLC_TITLE_ATTR);case"responsibility":if(!n)return this.get("dsplan:logicalResponsibility");break;case"@type":return this.get("type")}return n},toJSON:function(){var e=this._parent.apply(this,arguments);return e.name=this.get("name"),e.nameAndAccount=this.get("name"),e.image=this.get("image"),e.fullName=this.get("fullName"),e},getTransferObject:function(){return this._parent({objectId:this.get("id"),displayName:this.get("title"),serviceId:t.SERVICE_3DPLAN})},hasViewAccess:()=>!0});return Object.defineProperty(n.prototype,"fullName",{get:function(){return this.get("fullName")}}),n})),define("DS/RDFFoundation/BusinessProcessUtils",["UWA/Core","DS/WAFData/WAFData","UWA/Utils","DS/E6WCommonUI/UIHelper","DS/E6WCommonUI/PlatformManager","DS/RDFFoundation/RDFUtils","DS/E6WCommonUI/E6WCommonUIConstants","DS/RDFFoundation/Models/ComponentProxyModel","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],(function(e,t,n,i,s,r,o,a,l){"use strict";var c="businessprocess",d=function(e){return l.get(e)},u={getObjects:function(t,n){var i=e.clone(n||{},!1);i.id=t,t&&i.proxyType===o.GOVERNING_PROCESS_INSTANCE_ATTR?u.getBusinessProcessInstanceInfo(i):t&&i.proxyType===o.GOVERNING_PROCESS_MODEL_ATTR&&u.getBusinessProcessModelInfo(i)},_request:function(n,i){var r=e.clone(i||{},!1);if(s.isAuthorized("BPO")){var o=e.clone(r.additionalHeaders||{},!1);o["content-type"]="application/json",o.Accept="application/json",o["Accept-Language"]=s.getCurrentLanguage(),u.iteropBearerToken&&Date.now()<u.tokenExpirationDate?(r.headers=o,r.headers.Authorization="Bearer "+this.iteropBearerToken,t.proxifiedRequest(n,r)):u.fetchIteropToken({headers:o,onComplete:function(){u._request(n,i)},onFailure:function(){r.onFailure&&r.onFailure()}})}else r.onFailure&&r.onFailure(new Error("noBPOLicense"),"noBPOLicense")},getBusinessProcessInstanceInfo:function(t){var n=e.clone(t||{},!1),i={type:"GET",dataType:"json",onComplete:function(t){t&&(t=JSON.parse(t));const i={};i.identificator=t.identificatorInstance,i.id=t.processInstanceId,i.title=t.identificatorInstance,e.is(n.onComplete,"function")&&n.onComplete(i)},onFailure:n.onFailure},r=s.getServiceUrl(c,!0)+"/api/v2/history/instances/"+n.id;r+="?getVariables=true&variableFilter=identificatorInstance&getTasks=true",this._request(r,i)},getBusinessProcessModelInfo:function(t){var n=e.clone(t||{},!1),i={method:"GET",onComplete:function(t){t&&(t=JSON.parse(t));const i={};i.label=t.name,i.id=t.key,e.is(n.onComplete,"function")&&n.onComplete(i)},onFailure:n.onFailure};this._request(s.getServiceUrl(c)+"/api/v2/repository/processes/"+n.id+"/basic",i)},getTaskIdForInstance:function(t){var n=e.clone(t||{},!1),i={method:"GET",onComplete:n.onComplete,onFailure:n.onFailure},r=s.getServiceUrl(c,!0)+"/api/v2/runtime/tasks?instanceId="+n.model.get("physicalId");this._request(r,i)},fetchBusinessProcessModels:function(e,t){var n={method:"GET",onComplete:function(e){if(e&&(e=JSON.parse(e)),(e=e.responses?e.responses:e).length){const n=[];for(let t=0;t<e.length;t++){const i={};i.label=e[t].name,i.id=e[t].key,i.sourceid=c,n.push(i)}t(n)}else t([])},onFailure:e.onFailure};this._request(s.getServiceUrl(c,!0)+"/api/v2/repository/processes/startable/list",n)},typeAheadCallback:function(e,t,n,i){u.fetchBusinessProcessModels(i,(e=>{let i;t&&(i=t.toLowerCase()),i&&(e=e.filter((e=>e.label&&e.label.toLowerCase().startsWith(i)))),n(e)}))},fetchIteropToken:function(e){var n=s.getServiceUrl("3DPassport"),i=s.getServiceUrl(c)+"/api/v2/auth/cas",r=n+"/login?service="+encodeURIComponent(i),o={headers:e.headers,method:"GET",onComplete:t=>{this.getBearerToken(t,e)},onFailure:e.onFailure};t.authenticatedRequest(r,o)},getBearerToken:function(e,n){try{var i=s.getServiceUrl(c)+"/api/v2/auth/cas";i=i+"?ticket="+JSON.parse(e).access_token;var r={headers:n.headers,data:"",method:"POST",onComplete:e=>{try{var t=JSON.parse(e).token;this.iteropBearerToken=t,this.tokenExpirationDate=Date.now()+18e5,n.onComplete&&n.onComplete()}catch(t){n&&n.onFailure&&n.onFailure(e)}},onFailure:n.onFailure};t.authenticatedRequest(i,r)}catch(t){n&&n.onFailure&&n.onFailure(e)}},getStartProcessModelData:function(e,t){return{data:{start_3dplanobjectid:e.id,start_processtoken:t},identificator:e.identificator}},startProcessModel:function(t){var i=e.clone(t||{},!1),r=n.getUUID(),l=s.getServiceUrl(c,!0);i.processKey=i.model&&i.model.get(o.GOVERNING_PROCESS_MODEL_ATTR).get("physicalId"),i.model.identificator||(i.model.identificator=i.model&&i.processKey+" "+i.model.get(o.UNIQUE_OBJECT_ID_ATTR));var d={method:"POST",type:"json",data:JSON.stringify(this.getStartProcessModelData(i.model,r)),onComplete:function(e){var t={id:e.id,title:i.model.identificator,serviceId:"businessprocess",tenant:i.tenant,"dscom:ProxyType":o.GOVERNING_PROCESS_INSTANCE_ATTR};const n=i.batch?a.getOrCreateProxy(t,i.batch):a.getOrCreateProxy(t);i.model.set(o.GOVERNING_PROCESS_INSTANCE_ATTR,n),i.model.set("dsxplan:processToken",r),i.saveProcessInstance&&i.model.save({ajax:i.batch?i.batch.ajax:void 0}),i.onComplete&&i.onComplete()},onFailure:function(e,t){i.onFailure&&i.onFailure(t)}},u=l+"/api/v2/runtime/processes/"+i.processKey;this._request(u,d)},getStartProcessButtonConfig:function(t){var n=e.extend(e.clone(t||{},!1),{saveProcessInstance:!0,onFailure:e=>{e&&403===e.code&&"You do not have enough right to perform this action."===e.message?i.displayError(d("E6WCommonUI.Error.notBusinessProcessInitiatorError")):i.displayError(d("E6WCommonUI.Error.errorStartingProcessInstance")),t.onFailure&&t.onFailure()}});return{text:d("E6WCommonUI.Label.StartProcess"),fonticon:"graph-linear",handler:function(){u.startProcessModel(n)},name:"startProcessButton",className:s.isAuthorized("BPO")?"":"disabled"}},openIteropTask:function(t,n){var i=e.clone(t||{},!1),s=i.model.get("physicalId");i.onComplete=e=>{e&&(e=JSON.parse(e));var t=e.find((e=>e.process.instanceId===s));let i=t&&t.id;this.openIteropItemCallback(i,n)},i.model&&u.getTaskIdForInstance(i)},openIteropInformation:function(e,t){var n=e.model&&e.model.get("physicalId");this.openIteropItemCallback(n,t)},openIteropItemCallback:function(e,t){return require("DS/TransientWidget/TransientWidget").showWidget("ENXBPPY_AP",d("E6WCommonUI.Label.Widget.Title"),{objectType:t,objectId:e}),!0},startProcessForMassEdit:function(t,n,s){var r=e.clone(s||{},!1);t.forEach((function(e){const i=e.get("dsxplan:hasMaturity");"dsxplan:Open"!==i.id&&"dsxplan:Draft"!==i.id||!e.get("_hasProcessModelButNoInstance")||n.push(new Promise(((n,i)=>{let s={model:e,batch:r.batch,onComplete:function(){n()},onFailure:function(n){t.splice(t.findIndex((function(t){return e.id===t.id})),1),i(n)}};u.startProcessModel(s)})))})),Promise.allSettled(n).then((e=>{let n=e.find((e=>"rejected"===e.status));n&&(n.reason&&403===n.reason.code&&"You do not have enough right to perform this action."===n.reason.message?i.displayError(d("E6WCommonUI.Error.notBusinessProcessInitiatorError")):"noBPOLicense"===n.reason?i.displayError(d("E6WCommonUI.Error.noBPOLicense")):i.displayError(d("E6WCommonUI.Error.stateChangeErrorOnStartProcessFail"))),r.onComplete(t,r.batch)}))}};return u})),define("DS/RDFFoundation/Models/DriveRepositoryProxyModel",["UWA/Core","DS/RDFFoundation/Models/ComponentProxyModel","DS/RDFFoundation/RDFUtils","DS/E6WCommonUI/PlatformManager"],(function(e,t,n,i){"use strict";var s="3DDrive",r="dscom:"+s+"_",o=t.extend({_uwaClassName:"DriveRepositoryProxyModel",init:function(e){return e&&e["@id"]&&(e["dscom:ServiceHosting"]=s,e["dscom:Tenant"]=i.getTenant(),e["@type"]="dscom:ComponentProxy"),this._parent.apply(this,arguments)},get:function(e){if("_isDriveRepositoryModel"===e)return!0;return this._parent.apply(this,arguments)}});return o.ID_PREFIX=r,o})),define("DS/RDFFoundation/Models/RDFCloneModel",["UWA/Core","DS/E6WCommonUI/Models/CloneModel","DS/E6WCommonUI/E6WCommonUIConstants","DS/E6WCommonUI/PlatformManager","DS/RDFFoundation/Models/ResultModel","DS/RDFFoundation/RDFUtils","DS/E6WCommonUI/UIHelper","DS/RDFFoundation/Models/ComponentProxyModel","DS/RDFFoundation/Models/URLModel","DS/RDFFoundation/Models/PersonRDFModel","DS/E6WCommonUI/Models/DropValidator","DS/RDFFoundation/FederatedSearchUtil","DS/RDFFoundation/MemberUtils","DS/RDFFoundation/BusinessProcessUtils","DS/RDFFoundation/Models/UsersGroupRDFModel","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],(function(e,t,n,i,s,r,o,a,l,c,d,u,p,h,g,f){"use strict";var m=t.extend({getObjectToBeAdded:function(t,s,d){var u;if(!d.dropObj&&!d.detailedObject){var h=r.getObjectById(s);return h||"dsplan:hasAssignee"!==t?h:r.getObjectForAdding(c,s,{mask:p.getPersonMask(),attrs:{"dsaccess:accountName":p.addIamToURI(i.getContextUser())}})}u=o.getObjectDataFromDropSearchOrTypeAhead(d);var f,m,y,v=r.getExistingAndMerge({"@id":r.getObjectIDFromUserMap(u.id),image:u.image},{dontRegisterChange:!0}),C="swym:WeDo"===u.type,F="dsplan:url"===u.type;if(v)return v;if(F)y=e.clone(u||{},!1),e.extend(y,{"@type":u.type?u.type:n.URL_TYPE}),f=l,m="MVMask.URL.Complex";else if("3dplan"===u.serviceId||C)y=e.clone(u||{},!1),e.extend(y,{"@type":u.type?u.type:n.LOGICAL_USER_TYPE}),f=r.getModelConstructor(y),m="dsplan:MVMask.Task.Basic";else{var _="pno:Person"===u.type,D="foaf:Group"===u.type;if(!_&&!D)return u.id=a.computeURI(u),"businessprocess"===u.serviceId&&(u[n.PROXY_TYPE]=n.GOVERNING_PROCESS_MODEL_ATTR),a.getNewProxyModel(u);var S=u.id;if(!S.startsWith("uuid:")){var b={id:S,callback:this.swymPersonCallback.bind(this),onFailure:this.swymPersonCallbackFailure.bind(this),fieldName:t};return e.extend(d,{searchOptions:b}),this._swymPersonFetchCount++,void p.findAndGetSwymPersonResourceUid(d)}if(_)f=c;else{if(!D)throw new Error("Object type is not supported");f=g}m=p.getPersonMask(),y={"dsaccess:accountName":u.accountName}}return r.getObjectForAdding(f,u.id,{mask:m,attrs:y})},swymPersonCallback:function(e,t){if(e){var n,i=p.addUUIDToURI(e,t),s=t.searchOptions,o=s&&s.fieldName,a=s&&s.id;this.localAttributes.hasOwnProperty(o)&&delete this.localAttributes[o];let l=t.dropObj&&("foaf:Group"===t.dropObj.objectType||"Group"===t.dropObj.objectType),d=t.detailedObject&&("foaf:Group"===t.detailedObject["ds6w:type"]||"Group"===t.detailedObject["ds6w:type"]),u={"dsaccess:accountName":p.getAccountNameForUser(a,i)},h=c;(l||d)&&(h=g,u["ds6w:label"]=p.getLabelForUserGroup(t));let f=t.singleObjectOnly||t.config&&t.config.singleObjectOnly,m=r.getObjectForAdding(h,i,{mask:p.getPersonMask(),attrs:u});n=f?this.replaceObjectOnAttributeWithSingleModel(o,m,t):this.addIndividualObjectAsModel(o,m,t),!p.userMap[a]&&p.addUserUIdToMap(a,i),this.dispatchEvent("onChange:modificationsPending",[this]),t.operation="add",t.added=[n.ret],this._fireRelationshipChangeEvents(o,t)}this._swymPersonFetchCount--},swymPersonCallbackFailure:function(){this._swymPersonFetchCount--},buildBatchWithPreprocessedObjects:function(e){var t=e&&e.batch,n=e&&e.attributesToBeUpdated||{},i=Object.keys(n);if(i.length){var s=this._options.onFailure;t=t||r.getBatchGenerator();for(var o=0;o<i.length;o++)for(var l=i[o],c=0;c<n[l].length;c++){var d=n[l][c];d instanceof a!=!1&&(delete d.collection,d.save(void 0,{ajax:t.ajax,newTransaction:!0,onFailure:s}))}}return t},removeProcessInstanceAttributesFromMassEditAutoStart:function(e,t){return t.autoStartProcessInstanceForMultiEdit?(e.proxyAttributes&&e.proxyAttributes["dsplan:hasProcessInstance"]&&delete e.proxyAttributes["dsplan:hasProcessInstance"],e):e},save:function(t){if(!this.model.hasFetchedAccessData||!this.model.hasFetchedAccessData()||this.model.canModify(!0)||this.model.get(n.CANDIDATE_ASSIGNEE_ATTR))if(this._swymPersonFetchCount)this.listenToOnce(this,"allSwymPersonsFetched",this.save.bind(this,t));else{var i=this._filterProxyObjectsFromLocalAttributesAndLocalRelatedData(),s=e.clone(t||{},!1);i=this.removeProcessInstanceAttributesFromMassEditAutoStart(i,s),s.attributesToBeUpdated=i.proxyAttributes;var r=this.buildBatchWithPreprocessedObjects(s);!s.autoStartProcessInstanceForMultiEdit&&this.handleBusinessProcess(),r?(s.changed=!0,s.ajax=r.ajax,s.newTransaction=!0,delete s.attributesToBeUpdated,this._parent(s),delete s.ajax,delete s.onComplete,r.sendBatch(s)):(s&&(s.attributesToBeUpdated=s.attributesToBeUpdated||{}),this._parent(s))}else o.displayError(f.get("E6WCommonUI.Error.noAccessOnObject"))},_modelSave:function(e){this._shouldWaitForSave()?this.model.set(e):this._parent.apply(this,arguments)},_shouldWaitForSave:function(){return this.model&&this.model.isUploadingFiles&&this.model.isUploadingFiles()||this.isStartingProcessModel},_validateDroppedObject:function(e,t){var n=d.validateDroppedObject(e,t);return n&&o.displayError(n),n},_filterProxyObjectsFromLocalAttributesAndLocalRelatedData:function(){var e=Object.keys(this.localRelatedData),t={},n={},i=this;return e.forEach((function(e){for(var s=i.localRelatedData[e],r=0;r<s.length>0;r++){var o,l=s[r].value;l instanceof a?"add"===s[r].operation&&((o=t[e]||[]).push(l),t[e]=o):((o=n[e]||[]).push(s[r]),n[e]=o)}})),(e=Object.keys(this.localAttributes)).forEach((function(e){var n=i.localAttributes[e];n instanceof a&&(t[e]=[n])})),{proxyAttributes:t,nonProxyAttributes:n}},handleBusinessProcess:function(){const e=this.model.previousAttributes()["dsxplan:hasMaturity"];if((this.localAttributes[n.STATE_ATTR]&&"dsxplan:InProgress"===this.localAttributes[n.STATE_ATTR].id||this.localAttributes[n.COMPLETE_PERCENT_ATTR]&&100!==this.localAttributes[n.COMPLETE_PERCENT_ATTR])&&("dsxplan:Open"===e.id||"dsxplan:Draft"===e.id||"dsxplan:OnHold"===e.id)&&this.get("_hasProcessModelButNoInstance")){var t={model:this,onComplete:()=>{this.isStartingProcessModel=!1,this.save()},onFailure:t=>{t&&403===t.code&&"You do not have enough right to perform this action."===t.message?o.displayError(f.get("E6WCommonUI.Error.notBusinessProcessInitiatorError")):"noBPOLicense"===t?o.displayError(f.get("E6WCommonUI.Error.noBPOLicense")):o.displayError(f.get("E6WCommonUI.Error.stateChangeErrorOnStartProcessFailSingleObject")),this.isStartingProcessModel=!1,this.set(n.STATE_ATTR,e),this.save()}};this.isStartingProcessModel=!0,h.startProcessModel(t)}},getDetailedObjectToBeAdded:function(t,n,i){if(i&&i.isObject){var s=e.clone(i||{},!1);return s.detailedObject=s.detailedObjects&&s.detailedObjects[0],this.getObjectToBeAdded(t,n,s)}return n},set:function(e,t,n){return t&&void 0!==t.actualValue&&(t=t.actualValue),t=this.getDetailedObjectToBeAdded(e,t,n),this._parent(e,t,n)},add:function(t,i,s){var a;if(t===n.ATTACHMENT_ATTR||t===n.ACTUAL_DELIVERABLE_ATTR){var l=this.get(n.BOOKMARK_FOR_FILE_REPOSITORY);if(l&&!l.hasViewAccess())return o.displayError(f.get("E6WCommonUI.Error.noAccessOnBookmark")),a}if("dsplan:hasAttachment"!==t||r.removeBracketLongURI(i)!==r.removeBracketLongURI(this.model.id)){var c=e.clone(s||{},!1),d=c.singleObjectOnly||c.config&&c.config.singleObjectOnly;return a=this.get(t)instanceof e.Class.Model||d?this.replaceObjectOnAttributeWithSingleModel.apply(this,arguments):this._parent.apply(this,arguments)}o.displayError(f.get("E6WCommonUI.Error.CannotAddSameObject"))},remove:function(t,n,i){var s=e.clone(i||{},!1),r=s.singleObjectOnly||s.config&&s.config.singleObjectOnly,o=this.get(t);return this.model.get(t)&&(o instanceof e.Class.Model||r)&&delete this.localAttributes[t],(o=this.get(t))&&this._parent.apply(this,arguments)},replaceObjectOnAttributeWithSingleModel:function(n,i,s){var r=e.clone(s||{},!1);r.isObject=!(i instanceof e.Class.Model||i instanceof FileList||i instanceof File);var o=r.isCollectionAttribute,a=e.is(i,"string")?void 0:[i];if(this.get(n))this.remove(n,0,s),o||delete this.localRelatedData[n];else if(!o){var l=this.localRelatedData[n];l&&1===l.length&&"remove"===l[0].operation&&delete this.localRelatedData[n]}return o?t.prototype.add.call(this,n,i,r):this.set(n,i,r),a},preprocessPersonObject:function(e){if("pno:Person"===e.objectType){var t=e.objectId;t.startsWith("iam:")||(e.objectId=p.addUUIDToURI(t))}}});m._modelShouldWaitForSave=function(e){return e.isUploadingFiles&&e.isUploadingFiles()};var y=0;return Object.defineProperty(m.prototype,"_swymPersonFetchCount",{get:function(){return y},set:function(e){0===(y=e)&&this.dispatchEvent("allSwymPersonsFetched")}}),m})),define("DS/RDFFoundation/Models/CategoryModel",["UWA/Core","UWA/Utils","UWA/Class/Model","DS/RDFFoundation/RDFUtils"],(function(e,t,n,i){"use strict";var s={_uwaClassName:"CategoryModel",defaults:{title:"",subtitle:""},_image:function(){var e;return(e=this.get("thumbnail"))&&(e=i.getAssetUrl(e)),e},"onChange:thumbnail":function(){this.set("image",this._image())},parse:function(e){var t,n=(t=i.parseUrl(e["@href"])).path.match(/(?:\/resources\/|\/classes\/|\/invoke\/)(.*)/);if(e["@id"]=n&&n[1]||e["@id"],!e.mask){var s=e["@mask"]||t.mask;s&&(e.mask=s)}return e.where=t.where&&t.where,e},isAgile:()=>!1,isXProject:()=>!1};return n.extend(s)})),define("DS/RDFFoundation/Models/CollabspaceRepositoryModel",["UWA/Core","DS/RDFFoundation/SecurityContextUtils","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/Models/ResultModel","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],(function(e,t,n,i,s){"use strict";var r=i.extend({_uwaClassName:"CollabspaceRepositoryModel",idAttribute:"@id",setup:function(e){if(!e.displayValue){var n=t.getUsersContentRepositories().find((e=>e.actualValue===this.id));this.set(n)}},get:function(e){var n=this._parent.apply(this,arguments);switch(e){case"physicalId":return this.id;case"image":return require.toUrl("E6WCommonApps/assets/Collab_Space_icon.png");case"title":return t.hasAccessToContentRepository(this.id)?this.get("displayValue"):s.get("E6WCommonUI.Error.NoAccess")+(this.get("displayValue")||this.id)}return n},hasViewAccess:function(){return t.hasAccessToContentRepository(this.id)},toJSON:function(){var e=this._parent.apply(this,arguments);return e.title=this.get("title"),e.image=this.get("image"),e},compactJson:function(){return this.id}});return r})),define("DS/RDFFoundation/Models/CloneModelForRepository",["UWA/Core","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/Models/RDFCloneModel","DS/RDFFoundation/Models/CollabspaceRepositoryModel","DS/RDFFoundation/Models/DriveRepositoryProxyModel","DS/E6WCommonUI/UIHelper"],(function(e,t,n,i,s,r){"use strict";var o="dsxplan:hasContentRepository",a=n.extend({_uwaClassName:"CloneModelForRepository",getObjectToBeAdded:function(t,n,i){const s=e.clone(i||{},!1);return s.detailedObject&&delete s.detailedObject.type_icon_url,this._parent(t,n,s)},save:function(t){var n=this.getUploadRepositoryIdAsOptionsObject(),i=e.clone(t||{},!1);e.merge(i,n),this._parent(i)},dataForRenderingWhitelistHelper:function(t,n){for(var i,s=this.createWhitelistMap(n),o=0;o<this.attributesOverridden.length;o++)if(i=this.attributesOverridden[o],s&&s[i]){var a=this.get(i);e.is(a,"object")&&(a=r.normalizedToJson(a,n)),t[i]=a}else delete t[i];return t},dataForRendering:function(e){var t=this._parent.apply(this,arguments),n=e&&e.attributes,i=this;function s(e){if(!n||n&&-1!==n.indexOf(e)){var s=i.get(e);s&&(t[e]=s.toJSON({dataForRendering:!0}))}else delete t[e]}return s(o),s("dsplan:hasCollaborativeSpace"),t},getUploadRepositoryIdAsOptionsObject:function(){var e={},t=this.get(o);if(t){var n=t.id;n.startsWith(s.ID_PREFIX)?e.driveFolderProxyId=n:e.collabspaceId=n}return e}});return a})),define("DS/RDFFoundation/Collections/CollectionTaggerHelper",["UWA/Core","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/FederatedSearchUtil","DS/RDFFoundation/MemberUtils","DS/TagNavigatorProxy/TagNavigatorProxy","DS/E6WCommonUI/TopBarSearchDispatcher","DS/E6WCommonUI/PlatformManager","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],(function(e,t,n,i,s,r,o,a){"use strict";var l="explicitTagsData",c={_proxyCount:0,requestFetchNewTags:function(t){const n=e.clone(t||{},!1);if(0!==this.length){for(var i,s=n.searchSource||[],r=[],o=0;o<this.length;o++){var a=this.at(o);if(!(n.onlyIfNeeded&&a.tagsData&&a.tagsData.length>1)){var l=a.get("source");l&&!s.includes(l)&&s.push(l),(i=a.fedSearchIdQuery)&&r.push(i)}}this._sendFederatedTaggerRequest(r,s,n)}else n.onComplete&&n.onComplete()},_sendFederatedTaggerRequest:function(e,t,i){var s=this;e.length>0?n.sendRequestWithDelimiter({sources:t,with_synthesis_attribute:!0,locale:window.widget.lang||"en",query:e,onComplete:function(e){var t=e?e.results:[];t?(s.convertTagDataToTnProxyFormat(t),i.onComplete&&i.onComplete()):i.onFailure&&i.onFailure()},onFailure:function(){i.onFailure&&i.onFailure()},queueRequest:!0}):i&&i.onComplete&&i.onComplete()},convertTagDataToTnProxyFormat:function(e){if(e&&e.length>0)for(var t=e.length,n=0;n<t;n++){var i=this.getModelAndProcessedTaggerDataAttributes(e[n].attributes),s=i.id,r=i.tags,o=this.getModelsAsArrayToHandleTagger(s);o&&0!==o.length&&o.forEach((function(e){e.setTagsData(r),e.set(l,i.explicitTagsData)}))}},getModelsAsArrayToHandleTagger:function(e){var t=this.get(e);return t?[t]:this.getModelsAsArrayToHandleTaggerFallback&&this.getModelsAsArrayToHandleTaggerFallback(e)},getModelsAsArrayToHandleTaggerFallback:function(e){for(var n=[],i=0;i<this.length;i++){var s=this.at(i),r=s.get("physicalId");(e.includes&&e.includes(r)||t.removeBracketLongURI(r)===e)&&n.push(s)}return n},getModelAndProcessedTaggerDataAttributes:function(e){var n,i=[],s={},r={},o=e.length;for(let d=0;d<o;d++){let o=e[d];var l=o.value;if(l)if(s=c.getExplicitTagsDataHelper(o,s),"ds6w_facet"===o.format){"date"===o.type?l=this.getFormatedTagDate(l):"double"===o.type&&(l=parseFloat(l).toString()),["ds6w:what/ds6w:status","ds6w:what/ds6w:type"].indexOf(o.name)>-1&&(r[o.name]=o.value,this.translate&&(l=this.translate(l)));let e={object:l,sixw:o.name,field:o.field,type:o.type},t="E6WCommonUI.Tag."+l,n=a.get(t);n!==t&&(e.dispValue=n),i.push(e)}else"resourceid"===o.name?n=t.removeBracketLongURI(l):["preview_url","ds6w:label","dsplan:projectType"].indexOf(o.name)>-1&&(r[o.name]=o.value)}return{id:n,tags:i,explicitTagsData:s,attributesForModelCreation:r}},fetchModelAndAddTaggerData:function(n,i){var s=e.clone(i||{},!1),r=n.results,o=[];if(r&&r.length>0){var a=r.length;s.dontUpdateTaggerSummaryData||(this.tagsSummaryData=this.translateSummaryData?this.translateSummaryData(n.facets):n.facets);for(var l=[],c=0;c<a;c++){var d,u=this.getModelAndProcessedTaggerDataAttributes(r[c].attributes),p=u.id,h=u.tags,g=u.attributesForModelCreation,f=t.getObjectById(p),m=g["dsplan:projectType"],y=g["ds6w:what/ds6w:type"],v=f&&f.get("dsxplan:jsType")!==y,C=f&&!f.get("title"),F=v||C;if(!f||F){switch(g["ds6w:what/ds6w:status"]){case"To Do":d="Open";break;case"In Work":d="InProgress";break;case"Completed":d="Done";break;default:d=g["ds6w:what/ds6w:status"]}var _={"dsxplan:jsType":this.getJSType(y),"dsxplan:label":g["ds6w:label"],"dsplan:hasThumbnail":g.preview_url,"dsxplan:hasMaturity":{"@id":"dsxplan:"+d}};m&&(_["dsplan:projectType"]=m),F?f.set(f.parse(_),{dontRegisterChange:!0}):(_["@id"]=p,f=new s.ModelConstructor(_,{parse:!0}))}o.push(p),l.push(f),f.setTagsData(h)}s.reset?this.reset(l):this.add(l)}},getJSType:function(e){return"dsplan:xProject"===e&&(e="dsplan:Project"),e},getFormatedTagDate:function(e){var t=new Date(e),n=t.getFullYear(),i=t.getMonth()+1,s=t.getDate(),r=i<10?"0"+i:i,o=s<10?"0"+s:s;return String(n)+"/"+r+"/"+o},refineParametersAndQuery:function(t){var n=this,i=e.clone(t||{},!1);if(i.refineParam){const t=e.clone(i.refineParam,!0);Object.keys(t).forEach((function(e){if("date"===t[e][0].type){var s=t[e][0].object,r=n.getFromAndToDateFromDateTagFilter(s),o=e.split("/"),a=o[o.length-1];i.query="("+i.query+")",r.from&&(r.from.setHours(0),i.query="["+a+']>="'+r.from.toISOString()+'" AND '+i.query),r.to&&(i.query="["+a+']<="'+r.to.toISOString()+'" AND '+i.query),delete t[e]}})),i.refineParam=t}return i},getFromAndToDateFromDateTagFilter:function(e){var t,n;return e.to||e.from?(e.from&&(t=new Date(e.from)),e.to&&(n=new Date(e.to)).setHours(24)):(n=this.parseEndDate(e),7===e.length?(e+="/01",t=new Date(e)):t=10===e.length?new Date(e):4===e.length?new Date(e+"/01/01"):new Date(e)),{from:t,to:n}},parseEndDate:function(e){var t,n;return e.length>7?((t=new Date(e)).setHours(24),t):(7===e.length?(e+="/01",n=new Date(e)):n=new Date(e,0,1),t=4===e.length?new Date(n.getFullYear()+1,0,1):new Date(n.getFullYear(),n.getMonth()+1,1))},federatedSearchAdvanceQueryRequest:function(t){var i=this,s=e.clone(t||{},!1);s=i.refineParametersAndQuery(s),n.sendRequest({label:"3dplan-"+s.labelPrefix+window.enoviaServer.user+"-"+Date.now(),select_predicate:s.selectPredicateArray,sources:["3dplan"],with_synthesis:!0,with_synthesis_attribute:!0,query:s.query,nresults:s.limit,refine:s.refineParam,order_field:"ds6w:modified",order_by:"desc",iDoNotThrowError:!0,onComplete:function(e){s.onComplete&&s.onComplete(e),i.dispatchEvent("onSync")},onFailure:function(){s.onFailure&&s.onFailure()}})},getTaggerData:function(e){var t={};return(e&&e.isTopBarSearch||r.getSearchString()?this:this.originalCollection||this).forEach((function(e){if(e.id){var n=e.getTaggerURI();t[n]=e.tagsData||[]}})),t},getFilterOnServerTaggerData:function(e){var n={tagsData:{},summaryData:[]};if(e){var i=this.get(t.removeBracketLongURI(e));i?n.tagsData[t.TAGGER_URI_PREFIX+encodeURIComponent(t.shortToLongURI(i.id))]=i.tagsData||[]:n.tagsData={}}else this.forEach((function(e){n.tagsData[t.TAGGER_URI_PREFIX+encodeURIComponent(t.shortToLongURI(e.id))]=e.tagsData||[]}));return n.summaryData=this.tagsSummaryData||[],n},getTNProxy:function(t){var n=e.clone(t||{},!1),i=this.tnProxy;if(i)return i;var r={widgetId:widget.id?widget.id:window.enoviaServer.widgetId,filteringMode:n.filterOnServer?s.filteringMode.FilteringOnServer:s.filteringMode.WithFilteringServices,tenant:o.getTenant(),events:n.events,colorize:!0};return i=s.createProxy(r),n.filterOnServer&&i&&i.configurePredicates({"ds6w:modified":{allowFreeInput:!0,freeInputOnly:!0},"ds6w:created":{allowFreeInput:!0,freeInputOnly:!0},"ds6w:plannedStart":{allowFreeInput:!0,freeInputOnly:!0},"ds6w:plannedEnd":{allowFreeInput:!0,freeInputOnly:!0}}),this.tnProxy=i,i},setTNProxy:function(e){this.tnProxy=e},cacheCollection:function(){this.originalCollection=this.clone()},_resetCollectionOnObjectSelction:function(e,t){var n=this._getModelIdsToKeep(e,t),i=this._getModelsBasedOnIds(n);this._resetCollection(i)},filterCollection:function(t,n){var i=e.clone(n||{},!1),s=t.searchInput||r.getSearchString();return s||this._isTaggerFilteringOn(t)?(this.originalCollection||i.noCache||(this.allFetchesUseComplete()?this.cacheCollection():this.listenToOnce(this,"onSync",(()=>{this.allFetchesUseComplete()&&(this.cacheCollection(),this._resetCollectionOnObjectSelction(t,s))}))),this._resetCollectionOnObjectSelction(t,s),!0):(this.originalCollection&&(this._resetCollection(this.originalCollection._models),delete this.originalCollection),!1)},_getModelIdsToKeep:function(e,t){var n=e.filteredSubjectList||[];return t&&!this._isTaggerFilteringOn(e)&&(n=[],this.originalCollection.toArray().forEach((e=>{n.push(e.id)})),this._resetCollection(this.originalCollection._models)),n},_getModelsBasedOnIds:function(e){let n=r.getSearchString();n&&(n=i.escapeRegExp(n));var s=new RegExp(n,"i"),o=[];return e.forEach((e=>{var i=(this.originalCollection||this).getModelsAsArrayToHandleTagger(t.getURIForFiltering(e));i&&i.length>0&&(n?(s.test(i[0].get("title"))||s.test(i[0].get("dsxplan:enterpriseIdentificationNumber")))&&(o=o.concat(i)):o=o.concat(i))})),o},_isTaggerFilteringOn:function(e){var t=this.getTNProxy().getCurrentFilter();return e.allfilters&&Object.keys(e.allfilters).length||t.allfilters&&Object.keys(t.allfilters).length},_resetCollection:function(e){this.reset(e,{dontCallTagger:!0,dontRegisterChange:!0})},handleFocusOnSubjects:function(e){if(e){var n={},i=e.get("physicalId")||e.id;if(!i)return;var s=e.serviceId||"3DSpace";if(e.isRDF&&"3dspace"!==e.get("source")){i=t.jsonURIToSparqlURI(i);var r=e.get("dsxplan:jsType");(r&&"swym:WeDo"===r||"swym"!==e.get("source"))&&(i=encodeURIComponent(i)),s="6WTags"}e.getTagPrefix&&(i=e.getTagPrefix()+i),n[i]=s;try{this.getTNProxy().focusOnSubjects([i],!0,n)}catch(e){console.log(e.message),console.log(e)}}else try{this.getTNProxy().unfocus()}catch(e){console.log(e.message),console.log(e)}},handleTagColoring:function(e,n){var i=n&&n.coloredSubjects;if(e.coloredObjects||(e.coloredObjects=[]),Object.values(e.coloredObjects).forEach((function(e){delete e.tagColor,e.dispatchEvent("onChangeTaggerColoring")})),e.coloredObjects=[],i)for(var s in i){var r=s.startsWith("pid://")?s.substring(6):s,o=e.getModelsAsArrayToHandleTagger(t.getURIForFiltering(r));o&&o.length>0&&o.forEach((t=>{e.coloredObjects.push(t),t.tagColor=i[s],t.dispatchEvent("onChangeTaggerColoring")}))}},addTaggerProxyColoringEvents:function(e,t){var n=function(e){c.handleTagColoring(t,e)};e.addEvent("colorize",n),e.addEvent("unColorize",n)},getExplicitTagsData:function(e){var t={};return e.forEach((e=>{t=c.getExplicitTagsDataHelper(e,t)})),t},getExplicitTagsDataHelper:function(e,t){if(void 0!==e.field&&"implicit"!==e.field){var n=e.dispValue||e.object||e.value,i=(e.sixw||e.name).substring(5);t[i]||(t[i]=[]),t[i].push(n)}return t},setExplicitTagsData:function(t,n){var i=n.sixw.substring(5),s=e.clone(t.get(l)||{},"false");s[i]||(s[i]=[]),s[i].push(n.object),t.set(l,s)},removeExplicitTagsData:function(t,n){var i=n.sixw.substring(5),s=e.clone(t.get(l)||{},"false"),r=s[i].indexOf(n.object);s[i].splice(r,1),t.set(l,s)},updateTagsData:function(e,t,n){var i=!0;e.tagsData||e.setTagsData([]);for(var s=0;s<e.tagsData.length;s++){var r=e.tagsData[s];if(r.sixw===t){r.object=n,i=!1;break}}i&&e.tagsData.push({field:"implicit",object:n,sixw:t,type:"string"})},getTaggerDataWithSearchFilter:function(e){var t={},n=r.getSearchString()||e.getSearch(),i=new RegExp(n,"i");return(e=n?e:e.originalCollection||e).forEach((function(e){if(e.id){var s=e.getTaggerURI();n?(i.test(e.get("title"))||i.test(e.get("dsxplan:enterpriseIdentificationNumber")))&&(t[s]=e.tagsData||[]):t[s]=e.tagsData||[]}})),t}};return c.dispatcher=new e.Class.Events,c.EXPLICIT_TAGS_DATA=l,c})),define("DS/RDFFoundation/Collections/ResultCollection",["UWA/Core","UWA/Utils","UWA/Class/Collection","UWA/Class/Model","DS/PlatformAPI/PlatformAPI","DS/WebAppsFoundations/Collections/PageableCollection","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/RequestUtils","DS/RDFFoundation/Models/CategoryModel","DS/RDFFoundation/Models/ResultModel","DS/RDFFoundation/Collections/CollectionTaggerHelper","DS/RDFFoundation/Mixins/FetchTrackingMixin"],(function(e,t,n,i,s,r,o,a,l,c,d,u){"use strict";var p={_uwaClassName:"ResultCollection",getId:function(){return this._modelKey.get("@id")},_syncSetQueue:Function.prototype,getTotalRecords:function(){var e=this.length;return this.state&&null!==this.state.totalRecords&&void 0!==this.state.totalRecords&&(e=this.state.totalRecords+this._added.length-this._removed.length,e+=this._unregisteredModelsAdded.length-this._unregisteredModelsRemoved.length),e},hasMoreItems:function(){return this.moreItems||this.length!==this.getTotalRecords()},hasChildItems:function(){return this.length||this.moreItems},getModels:function(){return this._models},defaultOptions:{mode:"data",state:{pageSize:20},queryParams:{pageSize:"$top",sortKey:"$orderby",directions:{1:"desc","-1":"asc"}}},dataForRendering:function(e){for(var t=[],n=this.length,i=0;i<n;i++){var s=this.at(i);s&&t.push(s.dataForRendering(e))}return t},name:"rdf-result-collection",sync:function(){return c.prototype.sync.apply(this,arguments)},reset:function(e,t){return t&&t.forceReplaceOnSave&&(this._replaceOnSave=!0),this._newModels.clear(),this._parent.apply(this,arguments)},init:function(){this.initFetchTrackingMixinForInstance(),this._newModels=new Map,this._parent.apply(this,arguments)},setup:function(t,n){var i;if(n=n||{},this._defaultModel=n.defaultModel,i=n._modelKey,e.is(i))this._modelKey=i;else{var s=t&&t["@mask"]||n["@mask"];this._modelKey=new l({"@href":t&&t["@href"]||n["@href"],"@id":t&&t["@id"]||n["@id"],"@mask":s,mask:s,detailsMask:n.detailsMask},{parse:!0})}this.resetFlags(),this.initialized=Boolean(t&&t.member),this.listenTo(this,{onAdd:this._registerAddedModel,onRemove:this._registerRemovedModel,onReset:this._registerResetModels}),this.listenTo(this,{onTypeChanged:this._replaceModel}),this._unregisteredModelsRemoved=[],this._unregisteredModelsAdded=[]},_replaceModel:function(e,t){var n=this.indexOf(e);-1!==n&&(this.remove(e,{dontRegisterChange:!0}),this.add(t,{at:n,dontRegisterChange:!0}))},removeAddedModel:function(e){var t,n=this._added.indexOf(e);return-1!==n&&(this._added.splice(n,1),t=e),t},_registerAddedModel:function(e,t,n){if(n&&(n.parse||n.fromServer||n.dontRegisterChange))n&&n.dontRegisterChange&&this.addUnregisteredModel(e);else{var i=this._removed.indexOf(e);if(-1!==i)this._removed.splice(i,1);else-1===this._added.indexOf(e)&&this._added.push(e)}e&&e.isNew()&&(this.listenToOnce(e,"onChange:@id",(()=>this._newModels.delete(e))),this._newModels.set(e,!0))},_registerRemovedModel:function(e,t,n){n&&(n.parse||n.fromServer||n.dontRegisterChange)?n&&n.dontRegisterChange&&this.removeUnregisteredModel(e):this.removeAddedModel(e)||-1===this._removed.indexOf(e)&&this._removed.push(e);this._newModels.delete(e)},_registerResetModels:function(e,t){if(!t||!(t.parse||t.fromServer||t.dontRegisterChange)){var n=t.previousModels,i=this;n.forEach((function(e){i._registerRemovedModel(e,i,t)})),this.forEach((e=>{i._registerAddedModel(e,i,t),e.isNew()&&this._newModels.set(e,!0)}))}},destroy:function(){this.stopListening(),this._newModels.clear(),this._newModels=void 0,this._parent.apply(this,arguments),this.removeEvents()},set:function(t,n){var i=t;if(n&&(n.parse||n.fromServer)){let t=[...this._newModels.keys()];var s;n.parse?(o.handleContext(i),s=i.member):e.is(i.member,"array")?s=i.member:e.is(i,"array")?s=i:i=s=[i],s&&s.push.apply(s,t)}return this._parent(i,n)},fetch:function(t){var i,s,r,o,l={cancel:function(){}};if(t&&t.dontFetch)return l;var c=(r=e.clone(t,!1)||{}).idsToOpen,d=!c||r.collectionAndIds,u=d&&c&&c.length>0,p=r.onComplete;return r.onComplete=function(){!u&&p&&p.apply(this,arguments),u=!1},c&&c.length&&(this.fetchModelsById(c,r),r.newTransaction=!0),d?(r.mask&&this.setMask(r.mask),i=this._checkState(this.state),s=this.queryParams,(o=this.getLink(r.to))||(o=this.url(),"first"===r.to&&i.pageSize&&(o=a.addQueryParam(o,s.pageSize,i.pageSize)),i.sortKey&&(o=a.addQueryParam(o,s.sortKey,i.sortKey+" "+s.directions[i.order],!0))),r.url=o,-1!==r.url.indexOf("/invoke/")&&(r.method="POST"),r.remove||(r.remove=!1),n.prototype.fetch.call(this,r)):l},fetchModelsById:function(t,n){var i=this,s=e.clone(n||{},!1);s.mask=s.mask||this.getDetailsMask();var r=t.filter((function(e){return!i.get(e)})).map((function(e){return c.getObjectById(e)||o.createPlaceholder(e,void 0,void 0,{forceDslc:!0})})),a=n&&n.onFailure;this.add(r);s.onFailure=function(t){if(t instanceof e.Class.Model)i.remove(t);else{var n=[];r.forEach((function(t){t instanceof e.Class.Model?n.push(t):n.push(o.getObjectById(t["@id"]))})),i.remove(n)}e.is(a,"function")&&a.apply(void 0,arguments)},o.complete(this.model,t,s)},getPage:function(t,n){var i=e.clone(n||{},!1);return i.to=t,this.fetch(i)},sortBy:function(t,n){if(e.is(t,"function"))return this._parent.apply(this,arguments);if(e.is(n,"string")?"asc"===(n=n.toLowerCase())?n=-1:"desc"===n&&(n=1):n=n||-1,1!==n&&-1!==n)throw new Error("direction should be 1, -1, asc or desc");return this.state.sortKey=t,this.state.order=n,this.links={},this.reset(),this.toArray()},url:function(){var e=o.expandUrl(this.getUri());return a.addQueryParams(e,[{name:"$mask",value:this.getMask()},{name:"$where",value:this.getWhere(),encode:!0}])},getLink:function(e){var t=this.links[e];return t&&(t=o.expandUrl(t,"v1"),this.state.sortKey&&(t=a.addQueryParam(t,this.queryParams.sortKey,this.state.sortKey+" "+this.queryParams.directions[this.state.order],!0))),t},getWhere:function(){return this._modelKey.get("where")},getMask:function(){return this._modelKey.get("mask")},setMask:function(e){return this._modelKey.set("mask",e)},getDetailsMask:function(){return this._modelKey.get("detailsMask")||this.getMask()},setDetailsMask:function(e){return this._modelKey.set("detailsMask",e)},getUri:function(){return this._modelKey.get("@href")},setUri:function(e){this._modelKey.set(l.prototype.parse({"@href":e}))},parseRecords:function(e){return e["@href"]&&this.setUri(e["@href"]),e.member||e.value&&[e.value]||e["@value"]&&[e["@value"]]},getModelsToRemove:function(e){return this.filter((function(t){return!t.isNew()&&!e[t.id]&&!t.keepWhenUpdating}))},update:function(t,n){var i=e.clone(n||{},!1);if(t.member||this.setUri(t["@id"]),t.member){for(var s={},r=t.member,o=r.length,a=0;a<o;a++){var l=r[a];s[l["@id"]]=l}var c=this.getModelsToRemove(s);this.remove(c,i),i.merge=!0,i.parse=!0,this.add(t,i)}else this.parse(t,{})},parseResponseForStateUpdate:function(n,i,s){var r=e.clone(s||{},!1),o=n.view;if(o){var a=this.links;a.first=o.first,a.prev=o.previous,a.next=o.next,a.last=o.last,a.current=o["@href"];var l=parseInt(t.parseQuery(t.parseUrl(o["@href"]).query).$skip);r.currentPage=l/s.pageSize+1}return e.is(n.totalItems)?(r.totalRecords=n.totalItems,delete this.moreItems):this.moreItems=n.moreItems,this._unregisteredModelsRemoved=[],this._unregisteredModelsAdded=[],r},compactJson:function(){return this.reduce((function(e,t){return t._deleted||e.push(t.compactJson()),e}),[])},resetFlags:function(){this._added=[],this._removed=[]},model:function(e,t){var n=o.getModelConstructor(e,t)||t&&t._defaultModel||t&&t.collection&&t.collection._defaultModel||o.getDefaultModelConstructor(),i=o.getExistingAndMerge(e,t);return i?(i.collection=i.collection||t&&t.collection,i):new n(e,t)},add:function(t,n){var i=e.clone(n||{},!1);if(i.fireTypeCollectionEvent=!i.silent,i.silent=!0,n&&n.merge){const i=this._parent(t,n);return i&&(e.is(i,"array")?i.forEach((e=>c.scheduleUpdateInverseProperties(e))):c.scheduleUpdateInverseProperties(i)),i}var s=[],r=this,o=function(e){var t;e instanceof c?t=e:t=e[r.model===p.prototype.model?c.prototype.idAttribute:r.model.prototype.idAttribute];t&&!r.get(t)&&s.push(t)};t&&(e.is(t.forEach,"function")?t.forEach(o):o(t));var a=this._parent(t,i);return n&&n.silent||(a&&e.is(a.forEach,"function")?a.forEach((function(e){e.id||s.push(e)})):a&&!a.id&&-1===s.indexOf(a)&&s.push(a),i.forceDispatchEvent&&(e.is(a,"array")?s.push(...a):s.push(a)),s.forEach((function(e){var t;t=r.get(e),r.dispatchEvent("onAdd",[t,r,n])}))),a},getIdForCreateChildDSLC:function(){return 0===this.getUri().indexOf("/resources")?this.getId():""},_prepareModel:function(e){var t;if(!(e instanceof i)&&(t=o.getExistingAndMerge(e))){var n=Array.prototype.slice.call(arguments,0);return n[0]=t,this._parent.apply(this,n)}return this._parent.apply(this,arguments)},getTenant:function(){return window.enoviaServer&&window.enoviaServer.tenant||"OnPremise"},removeUnregisteredModel:function(e){-1===this._unregisteredModelsRemoved.indexOf(e)&&this._unregisteredModelsRemoved.push(e)},addUnregisteredModel:function(e){if(-1===this._unregisteredModelsAdded.indexOf(e)&&this._unregisteredModelsAdded.push(e),-1!==this._unregisteredModelsRemoved.indexOf(e)){var t=this._unregisteredModelsRemoved.indexOf(e);this._unregisteredModelsRemoved.splice(t,1)}},remove:function(e){e=Array.isArray(e)?e:[e];for(var t=0;t<e.length;t++){var n=e[t];n.destroying&&n.onRemovedFromCollection(this)}return this._parent.apply(this,arguments)},allFetchesUseComplete:c.allFetchesUseComplete,handleBadFetchCounts:c.handleBadFetchCounts,fetchingMask:Function.prototype,doneFetchingMask:Function.prototype};return p.model.prototype.idAttribute=c.prototype.idAttribute,(p=r.extend(p)).implement(d),Object.defineProperty(p.prototype,"totalRecords",{get:p.prototype.getTotalRecords}),p.implement(u),u.initFetchTrackingMixinForClass(p),o.ResultCollection=p,p})),define("DS/RDFFoundation/Collections/UserCollection",["DS/E6WCommonUI/E6WCommonUIConstants","DS/RDFFoundation/Collections/ResultCollection","DS/RDFFoundation/Models/PersonRDFModel","DS/RDFFoundation/Models/UsersGroupRDFModel","DS/RDFFoundation/Models/LogicalUserModel"],(function(e,t,n,i,s){"use strict";var r=t.extend({_uwaClassName:"UserCollection",_prepareModel:function(t){var r,o;return this.model=(r=t[e.JS_TYPE_ATTR],o=n,r===e.LOGICAL_USER_TYPE?o=s:"foaf:Group"===r&&(o=i),o),this._parent.apply(this,arguments)}});return r})),define("DS/RDFFoundation/Collections/PersonCollection",["UWA/Core","UWA/Class/Events","UWA/Class/Listener","UWA/Class","UWA/Class/Collection","DS/RDFFoundation/Collections/ResultCollection","DS/RDFFoundation/Models/PersonRDFModel"],(function(e,t,n,i,s,r,o){"use strict";return r.extend({_uwaClassName:"PersonCollection",model:o})}));