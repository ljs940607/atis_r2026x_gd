define("DS/CAT3DExpModelRestAPI/expCoreLink/ExpCoreLinkSnapshotJSONSolver",["UWA/Core","DS/CAT3DExpModel/XCTExpUint8ArrayAsset"],(function(e,t){"use strict";return e.Class.extend({initialize:function(e={}){this.config={validPathPrefix:"$.Assets.",...e},this.resolveContent=this.resolveContent.bind(this)},resolveContent:function(r,n){try{if(!r||!n)return e.Promise.reject(new Error("Invalid input parameters"));if(!r.startsWith("$.Assets."))return e.Promise.reject(new Error(`Invalid path format: must start with ${this.config.validPathPrefix}`));if(!n.Assets?.AssetsData)return e.Promise.reject(new Error("Invalid JSON structure: missing Assets.AssetsData"));const o=r.split(".")[3],i=n.Assets.AssetsData[o];if(!i)return e.Promise.reject(new Error(`Asset not found: ${o}`));const{Content:s,Extension:a}=i;if(!s||!a)return e.Promise.reject(new Error(`Invalid asset data for: ${o}`));try{const r=this._base64ToUint8Array(s),n=this._getMimeTypeFromExtension(a),i=new t(`${o}.${a}`,r,n);return e.Promise.resolve(i)}catch(t){return e.Promise.reject(new Error(`Failed to process asset content: ${t.message}`))}}catch(t){return e.Promise.reject(t)}},_base64ToUint8Array:function(e){const t=atob(e),r=t.length,n=new Uint8Array(r);for(let e=0;e<r;e++)n[e]=t.charCodeAt(e);return n},_getMimeTypeFromExtension:function(e){return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",svg:"image/svg+xml",bmp:"image/bmp",tif:"image/tiff",tiff:"image/tiff",cgm:"image/cgm",rgb:"image/x-rgb",wav:"audio/x-wav",ogg:"audio/ogg",cgr:"application/cgr","3dxc":"application/3dxc","3dxm":"application/3dxm"}[e.toLowerCase()]||"application/octet-stream"},_splitPath:function(e){return e.match(/[^.]+|\.(?=.*\.)/g)||[]},parseEncodedPath:function(t){const r=decodeURIComponent(t);return r?e.Promise.resolve(r):e.Promise.reject(new Error("Invalid JSONPath format"))}})})),define("DS/CAT3DExpModelRestAPI/expCoreLink/ExpCoreLinkContextSnapshotJSON",["UWA/Core","DS/CAT3DExpModel/expCoreLink/ExpCoreLinkContext"],(function(e,t){"use strict";return t.extend({init:function(e,t){this._parent(e,t),this._jsonContent=e},_getContent:function(){return this._jsonContent},_getService:function(e){return"JSONPath"===e?this._createExpCoreLinkService("ExpCoreLinkServiceSnapshotJSON"):null},_dispose:function(){this._parent(),delete this._jsonContent}})})),define("DS/CAT3DExpModelRestAPI/CAT3DXModelFactoryRestAPI",["UWA/Core","DS/CAT3DExpModel/CAT3DXModelFactory","DS/CAT3DExpModel/CAT3DXJSONReader","DS/WAFData/WAFData"],(function(e,t,r,n){"use strict";return t.extend({LoadExperience:async function(t){const o=this,i=t;try{const t=await this.getServerURL(),s=await new Promise(((e,r)=>{n.authenticatedRequest(`${t}/resources/v1/3dcommunication/experiences/${i}/snapshot`,{method:"GET",type:"json",headers:{Accept:"application/json"},onComplete:function(t){e(t)},onFailure:function(e){r(new Error(e.statusText||"Failed to load experience from snapshot"))}})}));let a=JSON.parse(s.Expjson);if(!a.Version||"1.1"!==a.Version)throw new Error("Invalid experience version");this.experienceJSON={...a.Experience,Assets:a.Assets},this._expCoreLinkManager._addExpCoreLinkContextShortcut("localSnapshot","ExpCoreLinkContextSnapshotJSON",this.experienceJSON),this._prototypes=a.Prototypes||{};const c=await r.read(this.experienceJSON,o._objectBuilder,o._expDataObjectMap,o._expCoreLinkManager);if(e.is(c))return c;throw new Error("Invalid experience format")}catch(e){throw new Error("Cannot load experience from physicalId: "+i+" - "+e.message)}},CloseExperience:function(){var e=this.GetExperience();return this._objectBuilder._removeObject(e)},getServerURL:async function(){if(this._serverURL)return this._serverURL;throw new Error("CAT3DXModelFactoryRestAPI: serverURL option is Mandatory")},init:function(e){this._parent(e),e.serverURL?this._serverURL=e.serverURL:console.error("CAT3DXModelFactoryRestAPI: serverURL option is Mandatory")}})})),define("DS/CAT3DExpModelRestAPI/expCoreLink/ExpCoreLinkServiceSnapshotJSON",["UWA/Core","DS/CAT3DExpModel/expCoreLink/ExpCoreLinkService","DS/CAT3DExpModelRestAPI/expCoreLink/ExpCoreLinkSnapshotJSONSolver"],(function(e,t,r){"use strict";return t.extend({init:function(e){this._parent(e),this._solver=new r},_getChildLinkContextFromIdentifier:function(e,t){try{if(!this._validatePath(t))return this._handleError(new Error("Invalid path type"),"Path validation");const r=e._getContent();return this._solver.parseEncodedPath(t).then((e=>this._solver.resolveContent(e,r))).then((e=>this._createExpCoreLinkContext("ExpCoreLinkContextSnapshotJSON",e))).catch((e=>this._handleError(e,"Content resolution")))}catch(e){return this._handleError(e,"General error")}},createEncodedPath:function(e){return encodeURIComponent(e.join("."))},_validatePath:function(t){return"string"==typeof t||e.Promise.reject(new Error("Path must be a string"))},_handleError:function(t,r){return e.Promise.reject(new Error(`ExpCoreLinkServiceSnapshotJSON: ${r} - ${t.message}`))}})}));