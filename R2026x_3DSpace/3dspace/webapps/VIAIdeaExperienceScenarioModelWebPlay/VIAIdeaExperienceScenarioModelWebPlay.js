define("DS/VIAIdeaExperienceScenarioModelWebPlay/StuProxy/StuCATICXPAnimation",["UWA/Core","DS/CoreEvents/Events","DS/XCTWebExperienceAppPlay/StuProxy/StuProxy","UWA/Class/Listener","DS/StuModel/StuAnimationEvent","DS/StuModel/StuAnimationFinishedEvent","DS/StuModel/StuAnimationLoopFinishedEvent","DS/StuModel/StuAnimationLoopStartedEvent","DS/StuModel/StuAnimationPausedEvent","DS/StuModel/StuAnimationResumedEvent","DS/StuModel/StuAnimationStartedEvent","DS/StuModel/StuAnimationStoppedEvent"],(function(e,t,i,n){"use strict";const a="ServiceStoppedEvent",s=0,r=1,o=3,c=4;return i.extend(n,{init:function(e,t){this._animationPlayState=s,this._restartTime=0;const i=e._experienceBase.getManager("CXPWebPlayManager");this.listenTo(i,"PlayStateChanged",this._onPlaySateChanged.bind(this)),this._isExperiencePlaying=!1,this._resumeAnimationOnNextPlay=!1,this._parent(e,t)},dispose:function(){this.stopListening(),this._animationEndEvent&&(t.unsubscribe(this._animationEndEvent),delete this._animationEndEvent),this._animationLoopStartedEvent&&(t.unsubscribe(this._animationLoopStartedEvent),delete this._animationLoopStartedEvent),this._animationLoopFinishedEvent&&(t.unsubscribe(this._animationLoopFinishedEvent),delete this._animationLoopFinishedEvent),this._scenarioMgr.PlayScenario(this._scenario,0),this._scenario.SetCurrentFrame(0),this._scenarioMgr.StopPlayingScenario(this._scenario.GetID()),delete this._scenario,delete this._scenarioMgr,this._parent()},setVCXScenario:function(e,i){this._scenario=e,this._scenarioMgr=i;var n=this,s=this.getModelObject().QueryInterface("CATI3DExperienceObject");this._setIsReverse(s.GetValueByName("reverse")),this.listenTo(s,"reverse.CHANGED",(function(e){n._setIsReverse(e)})),this._setIsBounce(s.GetValueByName("bounce")),this.listenTo(s,"bounce.CHANGED",(function(e){n._setIsBounce(e)})),this._setIsLoop(s.GetValueByName("loop")),this.listenTo(s,"loop.CHANGED",(function(e){n._setIsLoop(e)})),this._setSpeed(s.GetValueByName("speedFactor")),this.listenTo(s,"speedFactor.CHANGED",(function(e){n._setSpeed(e)})),this._animationEndEvent=t.subscribe({event:"VCX_SCENARIO_PLAY_END_REACHED"},(function(e){n._scenario.GetID()===e&&(n._animationPlayState=c,n._dispatchEvent("AnimationFinished"),n._dispatchEvent(a))})),this._animationLoopStartedEvent=t.subscribe({event:"VCX_SCENARIO_PLAY_LOOP_START_REACHED"},(function(e){n._scenario.GetID()===e&&n._dispatchEvent("AnimationLoopStarted")})),this._animationLoopFinishedEvent=t.subscribe({event:"VCX_SCENARIO_PLAY_LOOP_END_REACHED"},(function(e){n._scenario.GetID()===e&&n._dispatchEvent("AnimationLoopFinished")}))},play:function(){if(this._animationPlayState!==o){this._scenarioMgr.PlayScenario(this._scenario,this._restartTime*this._scenarioMgr.GetFPS()),this._restartTime=0;var e=this._animationPlayState===r;this._animationPlayState=o,e?this._dispatchEvent("AnimationResumed"):this._dispatchEvent("AnimationStarted")}},_playFromExperience:function(){this._isExperiencePlaying=!0,this._resumeAnimationOnNextPlay&&(this._resumeAnimationOnNextPlay=!1,this._scenarioMgr.PlayScenario(this._scenario,this._restartTime*this._scenarioMgr.GetFPS()),this._restartTime=0)},pause:function(){this._animationPlayState===o&&(this._restartTime=this._scenario.GetCurrentFrame()/this._scenarioMgr.GetFPS(),this._scenarioMgr.StopPlayingScenario(this._scenario.GetID()),this._animationPlayState=r,this._dispatchEvent("AnimationPaused"))},_pauseFromExperience:function(){this._restartTime=this._scenario.GetCurrentFrame()/this._scenarioMgr.GetFPS(),this._scenarioMgr.StopPlayingScenario(this._scenario.GetID()),this._isExperiencePlaying=!1,this._resumeAnimationOnNextPlay=!0},stop:function(){var e;this._animationPlayState!==s&&(e=this.getModelObject().QueryInterface("CATI3DExperienceObject").GetValueByName("reverse")?this._scenario.GetMaxFrame():0,this._scenarioMgr.PlayScenario(this._scenario,e),this._scenario.SetCurrentFrame(e),this._scenarioMgr.StopPlayingScenario(this._scenario.GetID()),this._restartTime=0,this._animationPlayState=s,this._dispatchEvent("AnimationStopped"),this._dispatchEvent(a))},_onPlaySateChanged:function(e){const t=this.getModelObject()._experienceBase.getManager("CXPWebPlayManager");e===t.ePlayState.ePlaying?this._playFromExperience():e===t.ePlayState.ePause&&this._pauseFromExperience()},isPlaying:function(){return this._animationPlayState===o},isPaused:function(){return this._animationPlayState===r},getDuration:function(){return this._scenario.GetMaxFrame()/this._scenarioMgr.GetFPS()},setTime:function(e){var t=e*this._scenarioMgr.GetFPS();this._scenarioMgr.PlayScenario(this._scenario,t),this._animationPlayState!==o&&(this._restartTime=e,this._scenario.SetCurrentFrame(t),this._scenarioMgr.StopPlayingScenario(this._scenario.GetID()))},getTime:function(){return this._scenario.GetCurrentFrame()/this._scenarioMgr.GetFPS()},getAnimatedObjects:function(){var e=[];this._scenario.GetListModifiables(e);for(var t=[],i=0;i<e.length;i++){var n=this._scenarioMgr.ModifiableServer.GetModifiableFromHashing(e[i]);if(n){var a=n.GetObject(),s=a._experienceBase.getManager("CAT3DExperienceESExportManager").getProjectedESObject(a);s&&t.push(s)}}return t},isRewinding:function(){return this._scenario.GetIsBouncing()!==this._scenario.GetIsReverse()},_setIsReverse:function(e){this._scenario.SetIsReverse(e),this._animationPlayState===o&&this._scenarioMgr.PlayScenario(this._scenario,this._scenario.GetCurrentFrame())},_setIsBounce:function(e){this._scenario.SetIsBounce(e),this._animationPlayState===o&&this._scenarioMgr.PlayScenario(this._scenario,this._scenario.GetCurrentFrame())},_setIsLoop:function(e){this._scenario.SetIsLoop(e),this._animationPlayState===o&&this._scenarioMgr.PlayScenario(this._scenario,this._scenario.GetCurrentFrame())},_setSpeed:function(e){this._scenario.SetSpeed(e),this._animationPlayState===o&&this._scenarioMgr.PlayScenario(this._scenario,this._scenario.GetCurrentFrame())},_dispatchEvent:function(e){this.getStuObject().doDispatchEvent(e)}})})),define("DS/VIAIdeaExperienceScenarioModelWebPlay/extensions/StuEAnimationPrototypeBuild",["UWA/Core","DS/XCTWebExperienceAppPlay/extensions/StuEExperienceBasePrototypeBuild","DS/VIAIdeaExperienceScenarioModelWebPlay/StuProxy/StuCATICXPAnimation"],(function(e,t,i){"use strict";return t.extend({build:function(e){if(!e.CATICXPAnimation){e.CATICXPAnimation=new i(this.GetObject(),e);var t=this.GetObject()._experienceBase.getManager("VCXScenarioManager"),n=this,a=this._parent;return this.QueryInterface("CATI3DXVCXScenarioAsset").getVCXScenario().done((function(i){return e.CATICXPAnimation.setVCXScenario(i,t),a.call(n,e)}))}return this._parent(e)},disposeESObject:function(e){e.CATICXPAnimation.dispose(),delete e.CATICXPAnimation,this._parent(e)}})}));