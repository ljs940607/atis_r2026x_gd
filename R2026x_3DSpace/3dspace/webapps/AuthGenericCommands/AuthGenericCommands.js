/*!  COPYRIGHT DASSAULT SYSTEMES 2016   */
define("DS/AuthGenericCommands/views/AuthSearchView",["css!DS/AuthGenericCommands/AuthGenericCommands","UWA/Core","UWA/Class/View","UWA/Drivers/Alone","DS/Logger/Logger","DS/PADUtils/PADCommandProxy","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/Handlebars/Handlebars","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADTypesMgt","DS/PADUtils/PADContext","UWA/Event"],(function(e,t,n,i,o,s,r,a,l,c,d,u){"use strict";var p=n.extend({name:"AuthSearchView",_searchTriggered:!1,className:"vpe_global_ctn_search",_selected_paths:[],_insertReplaceNode:null,_insertParams:null,_insertFlag:null,_insertSelected:null,input_text:null,domEvents:{"click div.vpe_run_ctn_search":"_onSearch","click span.fonticon-check":"_onConfirmSelect","click div.vpe_clear_ctn_search":"_onClearSearch","click span.fonticon-up-open":"_onPrevious","click span.fonticon-down-open":"_onNext","keyup input.input_search":"_onSearchInputKeyUp","paste input.input_search":"_onSearchInputPaste","keydown input.input_search":"_onSearchInputKeyDown"},template:null,_logger:null,setup:function(e){var t=this;void 0===d.get().getPADTreeDocument&&"ENOPAD3DViewer"!==d.get().name||(t._insertFlag=!0,void 0!==d.get().getPADTreeDocument&&(d.get().getPADTreeDocument()._insertFlag=!0)),this._logger=o.getLogger(p),this._logger.log("setup"),!0===e.navigate_onresult?this.template=a.compile('<div class="vpe_left_ctn_search ctn_search"></div>  <div class="vpe_input_ctn_search ctn_search search_css_temp">  <div class="input_search_div with_nav" id="input_search_div">  <input class="input_search" id="input_search_input" type="text" placeholder="Search" ondrop="event.preventDefault ? event.preventDefault() : event.returnValue = false">  </div>  <div class="pad_count_ctn" id="pad_count_ctn"><div class="pad_count" id="pad_count"></div></div>  <div class="right_search">  <div class="vpe_nav_ctn_search ctn_search"><span class="fonticon fonticon-up-open ctn_search pad_nav"  style="display:none;" title="Previous"></span></div>  <div class="vpe_nav_ctn_search ctn_search"><span class="fonticon fonticon-down-open ctn_search pad_nav"  style="display:none;" title="Next"></span></div>  <div class="vpe_clear_ctn_search ctn_search"><div class="clear_btn_search" style="display:none;"></div></div>  <div class="vpe_run_ctn_search ctn_search"><div class="vpe_run_btn_search" style="opacity:0.1;"></div></div>  <div class="vpe_right_ctn_search ctn_search"></div>  </div>  </div>'):this.template=a.compile('<div class="vpe_left_ctn_search ctn_search"></div>  <div class="vpe_input_ctn_search ctn_search search_css_temp">  <div class="input_search_div" id="input_search_div">  <input class="input_search" id="input_search_input" type="text" placeholder="Search" ondrop="event.preventDefault ? event.preventDefault() : event.returnValue = false">  </div>  <div class="right_search">  <div class="vpe_clear_ctn_search ctn_search"><div class="clear_btn_search" style="display:none;"></div></div>  <div class="vpe_nav_ctn_search ctn_search"><span class="fonticon fonticon-check fonticon-1x"  style="opacity:0;"></span></div>  <div class="vpe_run_ctn_search ctn_search"><div class="vpe_run_btn_search"  style="opacity:0.1;"></div></div>  <div class="vpe_right_ctn_search ctn_search"></div>  </div>  </div>'),this._searchTriggered=!1,this._parent(e),this._commandProxy=s.create({events:{onSelect:function(e){function n(){t.$clearSearchButton.style.display="inline-block",t.$searchInput.value=t._insertParams["ds6w:label"],t.input_text=t.$searchInput.value,t.$searchButton&&(t.$searchButton.style.opacity=1),t.$checkButton&&(t.$checkButton.style.opacity=1),void 0===d.get().getPADTreeDocument&&"ENOPAD3DViewer"!==d.get().name||(t._insertSelected=!0)}if((void 0!==d.get().getPADTreeDocument&&t._insertFlag&&!0===d.get().getPADTreeDocument().options.insert_replace||"ENOPAD3DViewer"===d.get().name&&t._insertFlag)&&e.paths[0]){var i=e.paths[0],o=i[i.length-1],s=[];s.push({type:e.attributes[o].type}),c.isTypesAuthorized(s,(function(i){i.length>0&&(t._selected_paths=e.paths[0],t._insertReplaceNode=t._selected_paths[t._selected_paths.length-1],t._insertParams={"ds6w:type":e.attributes[t._insertReplaceNode].type,"ds6w:label":e.attributes[t._insertReplaceNode].label},UWA.is(t._insertParams["ds6w:label"])?n():require(["DS/PADUtils/PADWSAccess"],(function(e){t._insertParams["ds6w:label"]=r.PADProgressBar_loading,n();var i=l.getWebAPI_Options("fetch");e.fetch({enopad_webapis:l.getSetting("enopad_webapis"),data:i,pids:[t._selected_paths[t._selected_paths.length-1]],onComplete:function(e){var i=UWA.is(e,"string")?JSON.parse(e):e;if(i.results&&1===i.results.length){var o,s=i.results[0],r=null,a=null,l=s.attributes.length;for(o=0;o<l&&!r||!a;o++)"ds6w:label"===s.attributes[o].name&&(r=s.attributes[o].value),"ds6wg:revision"===s.attributes[o].name&&(a=s.attributes[o].value);t._insertParams["ds6w:label"]=r,t._insertParams["ds6wg:revision"]=a,n()}else t._insertParams["ds6w:label"]=null,n()},onFailure:function(){t._insertParams["ds6w:label"]=null,n()}})})))}))}}}})},render:function(){this._logger.log("render");var e=this.template();return this.container.setContent(e),function(e,n,i){var o,s,r;if(!t.is(e,"object"))return e;for(o=0,s=(r=Object.keys(e)).length;o<s;o++)n.call(i,e[r[o]],r[o],e)}({searchInput:"input.input_search",searchButton:"div.vpe_run_btn_search",checkButton:"span.fonticon-check",searchOptionButton:".option_ctn_search",clearSearchButton:"div.clear_btn_search",onprevious:"span.fonticon-up-open",onnext:"span.fonticon-down-open",padcount:"div.pad_count"},(function(e,t){this["$"+t]=this.getElement(e)}),this),this.$onprevious&&(this.$onprevious.title=r.PADSearchView_previous),this.$onnext&&(this.$onnext.title=r.PADSearchView_next),this.$clearSearchButton&&(this.$clearSearchButton.title=r.PADSearchView_clear),this.$searchButton&&(this.$searchButton.title=r.PADSearchView_search),this.$checkButton&&(this.$checkButton.title=r.PADSearchView_check),void 0!==d.get().getPADTreeDocument&&!0===d.get().getPADTreeDocument().options.insert_replace?(this.$searchInput.placeholder=r.PADSearchView_search_select,this.$searchInput.title=r.PADSearchView_search_select):(this.$searchInput.placeholder=r.PADSearchView_search,this.$searchInput.title=r.PADSearchView_search),this},setCount:function(e){this.$padcount.setContent(e.index+"/"+e.total),null!==this.$onprevious&&null!==this.$onnext&&(this.$onprevious.setStyle("display","inline-block"),this.$onnext.setStyle("display","inline-block"))},_onConfirmSelect:function(){var e=this;(void 0!==d.get().getPADTreeDocument&&!0===e._insertSelected||"ENOPAD3DViewer"===d.get().name&&!0===e._insertSelected)&&(UWA.is(this.options.callbacks.onSearch,"function")&&this.options.callbacks.onSearch.call(null,[{search_value:this.$searchInput.value,resourceid:e._insertReplaceNode,"ds6w:type":e._insertParams["ds6w:type"],"ds6w:type_value":e._insertParams["ds6w:type"],"ds6w:label":e._insertParams["ds6w:label"],"ds6wg:revision":e._insertParams["ds6wg:revision"]}],this._insertSelected),void 0===d.get().getPADTreeDocument&&"ENOPAD3DViewer"!==d.get().name||(e._insertSelected=!1,e._insertFlag=!1,void 0!==d.get().getPADTreeDocument&&(d.get().getPADTreeDocument()._insertFlag=!1)))},_onSearch:function(){void 0===d.get().getPADTreeDocument&&"ENOPAD3DViewer"!==d.get().name||(this._insertSelected=!1),this._logger.log("_onSearch"),this.$searchInput.blur(),UWA.is(this.options.callbacks.onSearch,"function")&&this.options.callbacks.onSearch.call(null,{search_value:this.$searchInput.value},this._insertSelected),void 0===d.get().getPADTreeDocument&&"ENOPAD3DViewer"!==d.get().name||(this._insertFlag=!1,void 0!==d.get().getPADTreeDocument&&(d.get().getPADTreeDocument()._insertFlag=!1))},_onClearSearch:function(){this._logger.log("_onClearSearch"),this.$searchInput.value="",this.$clearSearchButton.hide(),this.$checkButton&&this.$checkButton.setStyle("opacity","0"),this.$searchButton.setStyle("opacity","0.1"),this._searchTriggered=!1,null!==this.$onprevious&&null!==this.$onnext&&null!==this.$padcount&&(this.$onprevious.hide(),this.$onnext.hide(),this.$padcount.setContent("")),UWA.is(this.options.callbacks.onClear,"function")&&this.options.callbacks.onClear.call(null)},_onSearchInputKeyUp:function(){this.$searchInput.value?(this.$searchButton.setStyle("opacity","1"),this.$clearSearchButton.setStyle("display","inline-block"),null!==this.$onprevious&&null!==this.$onnext&&!0===this._searchTriggered&&(this.$onprevious.setStyle("display","inline-block"),this.$onnext.setStyle("display","inline-block"))):(this.$clearSearchButton.hide(),null!==this.$onprevious&&null!==this.$onnext&&null!==this.$padcount&&(this.$onprevious.hide(),this.$onnext.hide(),this.$padcount.setContent("")),this.$searchButton.setStyle("opacity","0.1")),this.$checkButton&&this.input_text!==this.$searchInput.value&&(void 0===d.get().getPADTreeDocument&&"ENOPAD3DViewer"!==d.get().name||(this._insertSelected=!1),this.$checkButton.setStyle("opacity","0.2"))},_onSearchInputPaste:function(){var e=this;setTimeout((function(){e._onSearchInputKeyUp()}),200)},_onPrevious:function(){UWA.is(this.options.callbacks.onPrevious,"function")&&this.options.callbacks.onPrevious.call(null)},_onNext:function(){UWA.is(this.options.callbacks.onNext,"function")&&this.options.callbacks.onNext.call(null)},_onSearchInputKeyDown:function(e){var t=this;"return"!==u.whichKey(e)&&"Enter"!==e.keyIdentifier&&"return"!==e.keyIdentifier||(void 0!==d.get().getPADTreeDocument&&!0===this._insertSelected||"ENOPAD3DViewer"===d.get().name&&!0===this._insertSelected?(UWA.is(this.options.callbacks.onSearch,"function")&&this.options.callbacks.onSearch.call(null,[{search_value:this.$searchInput.value,resourceid:t._insertReplaceNode,"ds6w:type":t._insertParams["ds6w:type"],"ds6w:type_value":t._insertParams["ds6w:type"],"ds6w:label":t._insertParams["ds6w:label"]}],this._insertSelected),void 0===d.get().getPADTreeDocument&&"ENOPAD3DViewer"!==d.get().name||(t._insertSelected=!1,t._insertFlag=!1,void 0!==d.get().getPADTreeDocument&&(d.get().getPADTreeDocument()._insertFlag=!1))):this._onSearch()),u.stopPropagation(e)}});return p})),define("DS/AuthGenericCommands/views/AuthGenericDlgUpdateRevOnEntireStructure",["UWA/Core","UWA/Class","UWA/Class/Options","DS/Windows/Dialog","DS/Windows/ImmersiveFrame","DS/Controls/Button","DS/Tree/TreeListView","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/WebappsUtils/WebappsUtils","i18n!DS/AuthGenericCommands/assets/nls/AuthDlgRevisionUpdate.json"],(function(e,t,n,i,o,s,r,a,l,c,d){"use strict";return t.extend(n,{name:"GenericDlgUpdateRevOnEntireStructure",init:function(e){this._parent(e),this.setOptions(e),this._createPanel()},_createPanel:function(){this.immersiveFrame=new o,widget&&widget.body?this.immersiveFrame.inject(widget.body):this.immersiveFrame.inject(document.body);var t=this.options.title,n=e.createElement("div",{class:"UpdateRevOnEntireStructure-dialog-body"});this._dialog=new i({immersiveFrame:this.immersiveFrame,title:t,icon:c.getWebappsAssetUrl("UPSCommands","icons/32/I_UPSAuthCmdUpdateRevOnEntireStructure.png"),className:this.name+"_dialog",content:n,allowMaximizeFlag:!0,maximizeButtonFlag:!0,resizableFlag:!0,width:500,minWidth:500,minHeight:200,height:400,modalFlag:!0,buttons:{Ok:new s({label:d.modalFooterOK,onClick:this._onOK.bind(this)}),Cancel:new s({label:d.modalFooterCancel,onClick:this._onCancel.bind(this)})}});var a=[],l={};this.options.operations.confirmations.length>0&&this.options.operations.confirmations.forEach((function(e){l={label:e.label,icons:[{iconPath:"url("+e.icon+")"}],grid:{code:e.code,operation:d[e.operation],tooltip:d["tooltip_"+e.operation]}},a.push(l)})),this._treeview=new r({apiVersion:2,height:"auto",isEditable:!1,show:{rowHeaders:!1,columnHeaders:!0},resize:{rows:!1,columns:!0},roots:a,selection:{nodes:!1,cells:!1,rowHeaders:!1,columnHeaders:!1,toggle:!1,canMultiSelect:!1,enableListSelection:!1,preSelection:!1},enableDragAndDrop:!1,columns:[{text:d.TreeListViewHeaderName,width:227,dataIndex:"tree"},{text:d.TreeListViewHeaderRevisionCurrent,width:94,dataIndex:"code"},{text:d.TreeListViewHeaderAction,width:"auto",dataIndex:"operation",onCellRequest:function(t){if(!t.isHeader&&t.nodeModel&&t.nodeModel.options){var n=e.createElement("span",{text:t.nodeModel.options.grid.operation});(t.cellView&&t.cellView.getContent&&t.cellView.getContent()).setContent(n),t.cellView._setTooltip(t.cellView.elements.container,{longHelp:t.nodeModel.options.grid.tooltip})}}}]}),this._treeview.inject(n),this._dialog.addEventListener("close",this._onClosePanel.bind(this),!1)},_onOK:function(e){e.dsModel;var t=this.options.onCofirm;t&&"function"==typeof t&&t(),this._onClosePanel()},_onCancel:function(e){this._onClosePanel()},_onClosePanel:function(){this._dialog.destroy(),this._dialog=null,this.immersiveFrame.destroy(),this.immersiveFrame=null,this.options.enableCmdOnClose()}})})),define("DS/AuthGenericCommands/views/AuthGenericDlgProgressbar",["UWA/Core","UWA/Class/Options","UWA/Class","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/ProgressBar","DS/Controls/Button"],(function(e,t,n,i,o,s,r){"use strict";return n.extend(t,{options:{},init:function(e){this._parent(e);this.setOptions(e),e.renderTo||(e.renderTo=document.body),this._createPanel()},_createPanel:function(){var t=this;t.immersiveFrame=new i,widget&&widget.body?t.immersiveFrame.inject(widget.body):t.immersiveFrame.inject(document.body);var n=new e.Element("div",{class:"wux-control-inline-container",styles:{width:"100%",height:"100%",position:"relative"}});t._dialog=new o({immersiveFrame:t.immersiveFrame,title:t.options.label.progressBarMainTitle,className:"progressBar_dialog",content:n,movableFlag:!1,width:500,height:100,modalFlag:!0,closeButtonFlag:!1,buttons:{Abort:new r({label:t.options.label.modalFooterAbort,onClick:t._onAbort.bind(t)})}}),t.progressBar=new s({value:0,visibleflag:!0,statusflag:!0,emphasize:"success"}).inject(n)},_onAbort:function(){var e=this;e._alert=new o({title:e.options.label.progressBarAlertTitle,content:e.options.label.progressBarAbortAlert,immersiveFrame:e.immersiveFrame,modalFlag:!0,buttons:{Cancel:new r({onClick:function(e){e.dsModel.dialog.close()}}),Ok:new r({onClick:function(t){t.dsModel.dialog.close(),e.options.events.onAbort(),e.disableAbort()}})}})},destroy:function(){this._alert&&this._alert.activeFlag&&this._alert.close(),this._dialog.close(),this.immersiveFrame.destroy(),this.immersiveFrame=null},disableAbort:function(){this._alert&&this._alert.activeFlag&&this._alert.close(),this._dialog.buttons.Abort.disabled=!0}})})),define("DS/AuthGenericCommands/views/AuthCfgProductConfiguration",["UWA/Class/View","DS/Controls/Label","DS/Controls/Button","DS/WUXAutoComplete/AutoComplete","DS/Controls/TooltipModel","DS/Controls/ProgressBar","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","i18n!DS/AuthGenericCommands/assets/nls/AuthDlgRevisionUpdate.json"],(function(e,t,n,i,o,s,r,a,l){"use strict";return e.extend({selectedPCID:null,selectedRevisionID:null,init:async function(e){this._parent(e)},render:function(){let e=this;e.selectedPCID="",e.selectedRevisionID="";let r=UWA.createElement("div",{class:"xRevisionConfiguration"}),a=UWA.createElement("div",{class:"cfgStaticMappingTitleDiv"}),c=new t({value:this.options.referenceName,domId:"lineEditor-label"}).inject(a);a.inject(r);let d=UWA.createElement("div",{class:"revisionLabel"}),u=new t({value:l.revisionLabel,domId:"lineEditor-label"}).inject(d);d.inject(r);let p=UWA.createElement("div",{class:"xRevisionAuto"}).inject(r),h=UWA.createElement("span").inject(p);h.set({events:{click:function(t){e._launchRevisionsExplorer(e.options.referenceId,e.selectedRevisionID)}}}),h.addClassName("fonticon"),h.addClassName("fonticon-1.5x"),h.addClassName("fonticon-search"),h.addClassName("searchRevisionButton"),this.revisionTextBox=UWA.createElement("div").inject(p),this.revisionTextBox.addClassName("CfgRevision"),this.revisionTextBox.set({events:{click:function(t){e._launchRevisionsExplorer(e.options.referenceId,e.selectedRevisionID)}}});let g=new t({value:l.productConfigurationLabel,domId:"lineEditor-label"}).inject(r);console.log("AuthCfgProductConfiguration component loaded with "+c.value+" , "+this.options.referenceId+" , "+g.value+" and "+u.value+" .");let f=UWA.createElement("div",{class:"xRevisionAuto"}).inject(r);this.pcAutocomplete=new i({multiSearchMode:!1,allowFreeInputFlag:!1,disabled:!0,placeholder:l.productConfigurationLabel}).inject(f),this.pcAutocomplete.addEventListener("change",(e=>{e&&e.dsModel&&e.dsModel.selectedItems||(this.selectedPCID="")}));let m=UWA.createElement("span").inject(f);return this.searchBtn=new n({displayStyle:"smartIcon",label:"",disabled:!0,icon:{iconName:"search",fontIconFamily:WUXManagedFontIcons.Font3DS},tooltipInfos:new o({title:l.productConfigurationLabel}),showLabelFlag:!1}).inject(m),this.searchBtn.addEventListener("buttonclick",(e=>this._getProductConfigurations())),m.addClassName("cfgGenericSearchButton"),this.spinnerContainer=new UWA.Element("div",{class:"circular-container"}),this.spinnerContainer.inject(r),this.spinnerContainer.addClassName("cfgPCProgressBar"),new s({shape:"spinner",height:20}).inject(this.spinnerContainer),this.spinnerContainer.hide(),r},_launchRevisionsExplorer:function(e,t){let n=this;require(["DS/Windows/Dialog","DS/Controls/Button","DS/Windows/ImmersiveFrame","DS/CoreEvents/ModelEvents","DS/AuthGenericCommands/views/AuthCfgRevision","i18n!DS/AuthGenericCommands/assets/nls/AuthDlgRevisionUpdate.json"],(function(i,o,s,r,a,l){n.AuthCfgRevisionObj=new a({referenceId:e,selectedRevisionID:t}),n.AuthCfgRevisionObj.configurationActionEvents=new r;let c=new o({label:l.modalFooterOK,onClick:function(){if(1===n.AuthCfgRevisionObj.versionExplorer.getSelectedNodes().length){let e=n.AuthCfgRevisionObj.versionExplorer.getSelectedNodes()[0].options.data.id,t=n.AuthCfgRevisionObj.versionExplorer.getSelectedNodes()[0].options.data.revision;n.revisionSelectionEvents.publish({event:"revisionSelectionInConfigurationDialog",data:{}}),n.selectedRevisionID=e,n._getProductConfigurationFromRevision(e),n.revisionTextBox.innerText=t,n.spinnerContainer.show()}n.referenceRevisionsDialog.immersiveFrame.getModel().elements.container.destroy(),n.referenceRevisionsDialog.immersiveFrame&&n.referenceRevisionsDialog.immersiveFrame.destroy()},className:"primary"}),d=new o({label:l.modalFooterCancel,onClick:function(){n.referenceRevisionsDialog.immersiveFrame.getModel().elements.container.destroy(),n.referenceRevisionsDialog.immersiveFrame&&n.referenceRevisionsDialog.immersiveFrame.destroy()},className:"secondary"}),u=new s;u.inject(widget.body),n.referenceRevisionsDialog=new i({title:l.insertReplaceRevisions,content:n.AuthCfgRevisionObj.render(),immersiveFrame:u,resizableFlag:!0,closeButtonFlag:!1,modalFlag:!0,identifier:"SelectRevisionForInsertConfiguration",width:900,height:500,minHeight:406,minWidth:320,buttons:{Cancel:d,Ok:c}}),n.referenceRevisionsDialog.defaultButton.disabled=!0,n.AuthCfgRevisionObj.configurationActionEvents.subscribe({event:"selectionInConfigurationDialog"},(e=>{let t="",i="";void 0!==e&&void 0!==e.data&&void 0!==e.data.nodeModel&&void 0!==e.data.nodeModel.options&&e.data.nodeModel.options&&(null!=e.data.nodeModel.options.id&&(t=e.data.nodeModel.options.id),void 0!==e.data.nodeModel.options.grid&&void 0!==e.data.nodeModel.options.grid.maturity&&(i=e.data.nodeModel.options.grid.maturity)),n.AuthCfgRevisionObj.options.selectedRevisionID===t||"Inactive"===i||"Obsolete"===i?n.referenceRevisionsDialog.defaultButton.disabled=!0:n.referenceRevisionsDialog.defaultButton.disabled=!1})),n.AuthCfgRevisionObj.configurationActionEvents.subscribe({event:"unselectionInConfigurationDialog"},(()=>{n.referenceRevisionsDialog.defaultButton.disabled=!0}))}))},_getProductConfigurationFromRevision:function(e){let t=this;require(["DS/AuthGenericCommands/AuthGenericCmdWSAccess"],(function(n){return new Promise((function(i,o){if(e){let o={data:{},onComplete:function(e){let n="",o="string"==typeof e?JSON.parse(e):e;o.revision&&o.revision.identifier&&"Allocated"===o.allocationStatus?(t.pcAutocomplete.placeholder=l.productConfigurationLabel,n=o.revision.identifier,t._getProductConfigurationFromAllocation(n),i(n)):(t.pcAutocomplete.elementsTree=null,t.pcAutocomplete.placeholder=l.StaticMappingNoConfigurationAssociationInfo,t.selectedPCID="",t.searchBtn.disabled=!0,t.pcAutocomplete.disabled=!0,t.spinnerContainer.hide())},onFailure:function(){t.pcAutocomplete.placeholder=l.StaticMappingNoConfigurationAssociationInfo,bDebug&&console.log("_getProductConfigurationFromRevision.onFailure")}},s="/resources/modeler/configXRevision/navigationServices/getRevisionVariantManagementInformation",r="GET",a=["xRevisionIdentifier",e];n.callWS(o,s,r,a)}else o("CFGUX: No input xRevisionElement ID to _getProductConfigurationFromRevision")}))}))},_getProductConfigurationFromAllocation:function(e){let t=this;require(["DS/AuthGenericCommands/AuthGenericCmdWSAccess"],(function(n){return new Promise((function(i,o){if(e){let s={data:{query:`(flattenedtaxonomies:"types/Product Configuration" AND (based_95_on_95_model_95_version_95_pid: ${e}))`,select_file:["icon","thumbnail_2d"],select_predicate:["ds6w:label","ds6w:type","ds6w:description","ds6w:identifier","ds6w:modified","ds6w:created","ds6w:responsible","ds6w:lastModifiedBy","ds6wg:marketing_Name","ds6wg:revision","ds6w:what/ds6w:status"],with_indexing_date:!0,with_nls:!1,locale:"en",order_by:"desc",order_field:"relevance",start:"0",source:[],nresults:1e3,label:"cfgLabel"},onComplete:function(e){let n="string"==typeof e?JSON.parse(e):e;if(!n.results||!Array.isArray(n.results))return i([]),t.pcAutocomplete.elementsTree=null,t.pcAutocomplete.placeholder=l.StaticMappingNoConfigurationAssociationInfo,t.selectedPCID="",t.searchBtn.disabled=!0,t.pcAutocomplete.disabled=!0,void t.spinnerContainer.hide();{let e=t._prepareTreeForAutoComplete(n.results);t.searchBtn.disabled=!1,t.pcAutocomplete.disabled=!1,t.pcAutocomplete.elementsTree=e,t.spinnerContainer.hide()}},onFailure:function(e,t){bDebug&&console.log("_getProductConfigurationFromAllocation.onFailure");let n=t||e;o(n.errorMessage?n.errorMessage:"")}},r="/search",a="POST",c=[];n.callWS(s,r,a,c)}else o("CFGUX: No input xRevisionElement ID to _getProductConfigurationFromAllocation")}))}))},_prepareTreeForAutoComplete:function(e){let t=new r({shouldBeSelected:function(e){return!e||!0!==e._isSelected}});return t.prepareUpdate(),e.forEach((e=>{let n=this._getAttrValue(e,"ds6wg:revision"),i=this._getAttrValue(e,"ds6w:label"),o=this._getAttrValue(e,"ds6w:identifier"),s=this._getAttrValue(e,"ds6w:who/ds6w:responsible"),r=this._getAttrValue(e,"ds6w:what/ds6w:status"),l=this._getAttrValue(e,"ds6w:what/ds6w:type"),c=this._getAttrValue(e,"resourceid"),d=this._getAttrValue(e,"preview_url"),u=this._getAttrValue(e,"type_icon_url"),p=this._getAttrValue(e,"ds6w:modified_value");0==p.length&&(p=this._getAttrValue(e,"ds6w:when/ds6w:modified"));let h=new a({label:n?`${i}-${n}`:i,value:o,icon:u,grid:{ID:this._getAttrValue(e,"resourceid"),objlabel:i,revision:n,owner:s,dispvalue:r,type:l,name:o,resourceid:c,image:d,icon:u,modified:p,tags:i+n+o}});t.addRoot(h)})),t.pushUpdate(),t},_getAttrValue:function(e,t){let n="";return e.attributes.length<=0||e.attributes.forEach((e=>{e.name==t&&(n=e.value)})),n},_getProductConfigurations:function(){let e=this;require(["DS/AuthGenericCommands/AuthGenericCmdWSAccess","DS/CfgBaseUX/scripts/CfgSearchConfiguration"],(function(t,n){let i=e.selectedRevisionID;const o=t=>{t.length>0&&(e.selectedPCID=t[0].get("id"),e.pcAutocomplete.value=t[0].get("ds6w:label")+"-"+t[0].get("ds6wg:revision"))};let s={data:{},onComplete:function(t){let i="string"==typeof t?JSON.parse(t):t;if(i.revision&&i.revision.identifier&&"Allocated"===i.allocationStatus){let t=i.revision.identifier,s=new n(!1),r="",a="Product Configuration",c="",d=o,u="",p='(NOT current:"Inactive") AND (based_95_on_95_model_95_version_95_pid:'+t+")",h="";s.activate(r,a,c,d,u,h,p),e.pcAutocomplete.placeholder=l.productConfigurationLabel}else e.pcAutocomplete.placeholder=l.StaticMappingNoConfigurationAssociationInfo},onFailure:function(){e.pcAutocomplete.placeholder=l.StaticMappingNoConfigurationAssociationInfo,bDebug&&console.log("_getProductConfigurations.onFailure")}},r=["xRevisionIdentifier",i];t.callWS(s,"/resources/modeler/configXRevision/navigationServices/getRevisionVariantManagementInformation","GET",r)}))}})})),define("DS/AuthGenericCommands/views/AuthGenericReportPanel",["UWA/Core","UWA/Class","UWA/Class/Options","DS/Controls/Tab","DS/Windows/Panel","DS/Windows/ImmersiveFrame","DS/Logger/Logger","i18n!DS/AuthGenericCommands/assets/nls/AuthGenericReportPanel.json"],(function(e,t,n,i,o,s,r,a){"use strict";var l=t.extend(n,{name:"GenericReportPanel",_logger:null,_panel:null,options:{},init:function(e){this._parent(e);var t=this;e.renderTo||(widget&&widget.body?e.renderTo=widget.body:e.renderTo=document.body),t._logger=r.getLogger(l),t.setOptions(e),t._createPanel(e)},_fillTab:function(t,n,i,o){for(var s=void 0,r=new e.Element("ul"),a=0,l=n.length;a<l;a++)(s=new e.Element("div",{styles:{"white-space":"pre-line"}})).textContent=n[a],r.appendChild(new e.Element("li").appendChild(s));var c=new e.Element("div",{styles:{padding:"2px","word-wrap":"break-word"}});return c.appendChild(new e.Element("div").appendChild(r)),{label:t+" ("+n.length+")",isSelected:o===i,content:c,index:i}},_createTab:function(e,t){var n=this,i=0;e.success.length>0&&(e.tab.add(n._fillTab(a.success,e.success,i,e.selectedIndex)),i++),e.failure.length>0&&(e.tab.add(n._fillTab(a.failure,e.failure,i,e.selectedIndex)),i++),e.neutral.length>0&&(e.tab.add(n._fillTab(a.neutral,e.neutral,i,e.selectedIndex)),i++),e.aborted.length>0&&(e.tab.add(n._fillTab(a.aborted,e.aborted,i,e.selectedIndex)),i++),e.tab.inject(t)},_createPanel:function(t){var n=this,r=new e.Element("div",{styles:{"vertical-align":"top","min-height":"286px",position:"relative"}}),a=new e.Element("div",{class:"wux-control-inline-container"});r.inject(a),n.immersiveFrame=new s,n.immersiveFrame.inject(n.options.renderTo);var l=new e.Element("div",{class:"wux-control-container"}),c=new i({displayStyle:"strip"});c.reorderFlag=!1,c.pinFlag=!0,c.showComboBoxFlag=!1,c.editableFlag=!1,c.multiSelFlag=!0,c.centeredFlag=!1,c.touchMode=!0;var d={tab:c,selectedIndex:0};void 0!==t.success&&null!==t.success&&Array.isArray(t.success)&&(d.success=t.success),void 0!==t.failure&&null!==t.failure&&Array.isArray(t.failure)&&(d.failure=t.failure),void 0!==t.neutral&&null!==t.neutral&&Array.isArray(t.neutral)&&(d.neutral=t.neutral),void 0!==t.aborted&&null!==t.aborted&&Array.isArray(t.aborted)&&(d.aborted=t.aborted),n._createTab(d,l),n._panel=new o({title:t.title,content:l,position:{my:"center",at:"center"},width:600,allowedDockAreas:0,immersiveFrame:n.immersiveFrame,resizableFlag:!0,collapsibleFlag:!1,minWidth:600,minHeight:85}),n._panel.addEventListener("close",n._onClosePanel.bind(n),!1),(d.success.length>15||t.failure.length>15||t.neutral.length>15||t.aborted.length>15)&&(n._panel.height=400),n._panel.elements.container.classList.add("AuthGenericReportPanel_Panel")},_onClosePanel:function(){this._panel.destroy(),this._panel=null,this.immersiveFrame.destroy(),this.immersiveFrame=null}});return l})),define("DS/AuthGenericCommands/views/AuthModalChooser",["css!DS/AuthGenericCommands/AuthGenericCommands.css","UWA/Class","UWA/Class/Options","DS/Logger/Logger","DS/AuthGenericCommands/views/AuthSearchView","DS/UIKIT/Modal","DS/PADUtils/PADContext","DS/PADUtils/PADUtilsServices"],(function(e,t,n,i,o,s,r,a){"use strict";return t.extend(n,{name:"authmodalchooser",_logger:null,_modal:null,options:{},init:function(e){if(this._logger=i.getLogger(o),this._logger.log("init"),this._parent(e),this.setOptions(e),!e.renderTo){var t=document.getElementsByClassName("xnav_component");t&&1===t.length?e.renderTo=t[0]:e.renderTo=document.body}var n=UWA.createElement("div"),a=this;if(new o({callbacks:{onSearch:this._onPADSearch.bind(this)}}).render().inject(n),document.addEventListener("keyup",(function(e){27===e.keyCode&&(a.close(),void 0!==r.get().getPADTreeDocument&&(r.get().getPADTreeDocument()._insertFlag=!1))})),this._modal=new s({className:this.name+"_modal",closable:!1,body:n,visible:!0,overlay:!UWA.is(this.getOption("overlay"))||this.getOption("overlay")}),e.position){var l=e.renderTo.getBoundingClientRect();if(e.position.top&&e.position.left)e.position.top<l.height-80?this._modal.elements.content.setStyle("top","calc("+e.position.top+"px - 80px)"):this._modal.elements.content.setStyle("top","calc("+l.height+"px - 140px)"),e.position.left<l.width-340?this._modal.elements.content.setStyle("left",e.position.left):this._modal.elements.content.setStyle("left","calc("+l.width+"px - 350px)");else if(e.position.x&&e.position.y)e.position.y<l.height-80?this._modal.elements.content.setStyle("top","calc("+e.position.y+"px - 80px)"):this._modal.elements.content.setStyle("top","calc("+l.height+"px - 140px)"),e.position.x<l.width-340?this._modal.elements.content.setStyle("left",e.position.x):this._modal.elements.content.setStyle("left","calc("+l.width+"px - 350px)");else if("above_action_bar"===e.position)this._modal.elements.wrapper.setStyle("padding-top","calc("+l.height+"px - 80px)"),this._modal.elements.wrapper.setStyle("padding-left","calc(50% - 135px)");else this._logger.log("unknown style")}this._modal.elements.container.addEventListener("click",(function(){a.close(),void 0!==r.get().getPADTreeDocument&&(r.get().getPADTreeDocument()._insertFlag=!1)})),this._modal.elements.content.addEventListener("click",(function(e){return e.preventDefault(),e.stopPropagation(),!1})),this._modal.inject(e.renderTo)},close:function(){var e=this.getOption("in_apps_search");this._modal.destroy(),e.in_apps_callback.call(null,null)},_onPADSearch:function(e,t){this._logger.log("_onPADSearch with "+JSON.stringify(e));var n=this;if(void 0!==r.get().getPADTreeDocument&&!0===t||"ENOPAD3DViewer"===r.get().name&&!0===t)n.close(),this.getOption("in_apps_search").in_apps_callback.call(null,e);else if(e.search_value.length){var i,o=this.getOption("in_apps_search");if(!0===this.getOption("retrieveSearchValue")){i=e.search_value,n.close();var s=this.getOption("searchValueCallback");UWA.is(s,"function")&&s(null,{searchValue:i})}else o&&(i=e.search_value,o.fts_value=i,o.callback=function(e){n._logger.log("In Apps Search callback"),n.close(),UWA.is(o.in_apps_callback,"function")&&(e.selected_objects?o.in_apps_callback.call(null,e.selected_objects):o.in_apps_callback.call(null,e))},o.cancel=function(){n._logger.log("In Apps Search Cancel callback"),n.close()},o.app_socket_id="AuthModalChooser-"+widget.id,a.inAppsSearch(o))}else this._logger.log("No search done since no string inside the input"),this.close()}})})),define("DS/AuthGenericCommands/AppContext",["DS/PADUtils/PADContext","DS/PADUtils/PADSettingsMgt","DS/AuthGenericCommands/views/AuthModalChooser","DS/Controls/ModalContainer","DS/Controls/Loader","DS/TreeModel/TreeNodeModel","DS/WidgetServices/WidgetServices"],(function(e,t,n,i,o,s,r){"use strict";var a=void 0,l=void 0,c=void 0;function d(e){return e.getNodeSource()===s.NODE_SOURCE.GROUPING||!0===e.isGroupingNode&&void 0!==e.options.bsIntent}return{_myContext:void 0,isExternalContext:!1,_b3DFirstTime:!0,_controller3D:void 0,getContext:function(){return this._myContext=this._myContext||e.get(),this._myContext},setContext:function(e){"Default"!==e&&(this._myContext=e,this.isExternalContext=!0)},_is2DContext:function(){return"pad_component"===this.getContext().name},_is3DContext:function(){return!0===this._b3DFirstTime&&(a=require("DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices"),l=require("DS/Visualization/SceneGraphUtils"),c=require("DS/Selection/CSOManager"),this._b3DFirstTime=!1,this._controller3D=this._myContext.getController()),"ENO3DView"===this.getContext().name},getSelectedNodes:function(){if(this.isExternalContext)return this.getContext().getSelectedNodes();if(this._is2DContext()){if((e=this.getContext().getSelectedNodes())&&e[0])return e}else if(this._is3DContext()){var e=[];return c.get().forEach((function(t){e.push(t.pathElement)})),e}return[]},isThereARootSelected:function(){if(this.isExternalContext)return this.getContext().isThereARootSelected();var e=this,t=0,n=e.getSelectedNodes();return n.length>0&&(n.forEach((function(n){e.isRoot(n)&&t++})),t>0)},getSelectedRoots:function(){if(this.isExternalContext)return this.getContext().getSelectedRoots();var e=this,t=[],n=e.getSelectedNodes();return n.length>0&&n.forEach((function(n){e.isRoot(n)&&t.push(n)})),t},IsDrawAvailableForUpdateRevision:function(){var e=!1;return e=null==(e=localStorage.getItem("AuthGenericToolbar.displayDrawingAsChild"))||"true"==e},Is3DShapeAvailableForUpdateRevision:function(){var e=!1;return e=null!=(e=localStorage.getItem("AuthGenericToolbar.display3DShapeAsChild"))&&"true"==e},samePath:function(e,t){if(null==e||null==t)return!1;var n=e.externalPath.length;if(n!==t.externalPath.length)return!1;for(var i=0;i<n;i++)if(e.externalPath[i].id!==t.externalPath[i].id)return!1;return!0},getParentWithChild:function(e){if(this.isExternalContext)return this.getContext().getParentWithChild(e);if(this._is2DContext()){if(null!=e&&e.length){for(var t=[],n=e.length,i=0;i<n;i++)for(var o=e[i],s=0;s<n;s++)if(i!==s)for(var r=e[s],a=this.getParent(r);a;)a===o&&t.push({parent:o,child:r}),a=this.getParent(a);return t}}else if(this._is3DContext()){var l=this;if(null!=e&&e.length){for(t=[],n=e.length,i=0;i<n;i++){var c=e[i];for(s=0;s<n;s++)if(i!==s){var d=e[s];for(a=l.getParent(d);a;)l.samePath(a,c)&&t.push({parent:c,child:d}),a=l.getParent(a)}}return t}}return[]},getInstance:function(e){if(this.isExternalContext)return this.getContext().getRelationID(e);if(this._is2DContext()){if(null!=e&&e.getRelationID)return e.getRelationID()}else if(this._is3DContext())for(var t=e;null!=t;){var n=t.getLastElement(!0);if(a.isPLMNode(n)&&(a.isInstance(n)||a.isRepInstance(n)))return a.getNodeID(n);t=t.getParentPath()}},getReference:function(e){if(this.isExternalContext)return this.getContext().getReference(e);if(this._is2DContext()){if(null!=e&&e.getID)return e.getID()}else if(this._is3DContext())for(var t=e;null!=t;){var n=t.getLastElement(!0);if(a.isPLMNode(n)){if(a.isReference(n)||a.is3DLeaf(n)||a.isRepReference(n))return a.getNodeID(n);if(a.isInstance(n)||a.isRepInstance(n))return a.getNodeID(n.getChildren()[0])}t=t.getParentPath()}},getParent:function(e){if(this.isExternalContext)return!!this.getContext().getParent&&this.getContext().getParent(e);if(this._is2DContext()){if(null!=e&&e.getParent){let t=e.getParent();return t&&d(t)&&(t=t.getParent()),t}}else if(this._is3DContext())for(var t=e;null!=t;){var n=t.getLastElement(!0);if(a.isPLMNode(n)){var i;if(a.isReference(n)||a.isRepReference(n)||a.is3DLeaf(n))return null===(i=e.getParentPath().getParentPath())?void 0:i;if(a.isInstance(n)||a.isRepInstance(n))return null===(i=e.getParentPath())?void 0:i}t=t.getParentPath()}},getParents:function(e){if(this.isExternalContext)return this.getContext().getParents(e);if(this._is2DContext()){if(null!=e&&e.getParents){let t=e.getParents(),n=[];return t.forEach((function(e){e&&!d(e)&&n.push(e)})),n}}else if(this._is3DContext()){for(var t=[],n=this.getParent(e);void 0!==n;)t.push(n),n=this.getParent(n);return t}},getAllDescendants:function(e,t){var n=this;void 0===t?t=[]:t.push(e);var i=n.getChildren(e);return i&&i.forEach((function(e){n.getAllDescendants(e,t)})),t},getRoot:function(e){if(this.isExternalContext)return this.getContext().getRoot(e);if(this._is2DContext()){if(null!=e&&e.getRoot)return e.getRoot()}else if(this._is3DContext()){var t=e;if(null!=t)do{if(this.isRoot(t))return t;t=this.getParent(t)}while(null!=t)}},getRoots:function(){if(this.isExternalContext)return this.getContext().getRoots();if(this._is2DContext())return this.getContext().getPADTreeDocument().getRoots();if(this._is3DContext()){var e=a.getRoots(this._myContext),t=this._myContext.getRootBagPath();return e.map((function(e){var n=t.clone();return n.externalPath.push(e),n}))}},getType:function(e){if(this.isExternalContext)return this.getContext().getType(e);if(this._is2DContext()){if(null!=e&&e.options)return e.options.type}else if(this._is3DContext())for(var t=e;null!=t;){var n=t.getLastElement(!0);if(a.isPLMNode(n))return a.getNodeType(n);t=t.getParentPath()}return""},getName:function(e){if(this.isExternalContext)return this.getContext().getName(e);if(this._is2DContext()){if(null!=e&&e.options)return e.options.label}else this._is3DContext();return""},getNamesAsync:function(e,t){var n=[];if(Array.isArray(e)){var i=e.length;if(this.isExternalContext||this._is2DContext())for(var o=0;o<i;o++)n[o]=this.getName(e[o]);else if(this._is3DContext()){var s=[];for(o=0;o<i;o++)s[o]=this.getReference(e[o]);var r={ids:s,attributes:["ds6w:label"],callbacks:{onComplete:function(e){for(var o=0;o<i;o++){var r=s[o];n[o]=e[r]["ds6w:label"]}t&&t(n)},onFailure:function(){t&&t(n)}}};return this._controller3D.getAttributes(r)}}t&&t(n)},getInstanceName:function(e){if(this.isExternalContext)return this.getContext().getInstanceName?this.getContext().getInstanceName(e):this.getContext().getName(e);if(this._is2DContext()){if(null!=e&&e.options&&e.options.grid){var t=e.options.grid["ds6w:label-Instance"];return t||(t=e.options.label+".1"),t}}else this._is3DContext();return""},getInstanceNamesAsync:function(e,t){var n=this,i=[];if(Array.isArray(e)){var o=e.length;if(this.isExternalContext||this._is2DContext())for(var s=0;s<o;s++)i[s]=this.getInstanceName(e[s]);else if(this._is3DContext()){var r=[];for(s=0;s<o;s++)r[s]=n.getInstance(e[s]);var a={ids:r,attributes:["ds6w:label"],callbacks:{onComplete:function(s){for(var a=0,l=0;l<o;l++){var c=r[l];s[c]["ds6w:label"]?i[l]=s[c]["ds6w:label"]:a++}t&&(a>0?n.getNamesAsync(e,(function(e){t(e)})):t(i))},onFailure:function(){t&&n.getNamesAsync(e,(function(e){t(e)}))}}};return n._controller3D.getAttributes(a)}}t&&t(i)},getParameterAsync:function(e,t,n,i){let o=this;if(Array.isArray(e))if(this.isExternalContext||this._is2DContext())e.forEach((e=>{let t=e._options.icons[0].iconPath,i=[];i.push(t);let o={Title:e._options.label,Instance_Title:e._options.grid["ds6w:label-Instance"],Revision:e._options.grid["ds6wg:revision"],Icon:i,Parent_Title:e._parentNode._options.label,Parent_Revision:e._parentNode._options.grid["ds6wg:revision"]};n.push(o)}));else if(this._is3DContext()){let r=[],a=e.length;for(let t=0;t<a;t++)r[t]=o.getReference(e[t]);var s={ids:r,attributes:t,callbacks:{onComplete:function(e){for(var t=0;t<a;t++){var o=r[t];let i={id:o};if(null!=e[o]){let s=[];s.push(e[o].type_icon_url),i.Title=e[o]["ds6w:label"],i.Revision=e[o]["ds6wg:revision"],i.Icon=s,n[t]=i}}i&&i(n)},onFailure:function(){console.warn("Failed")}}};return o._controller3D.getAttributes(s)}},getRevisionAsync:function(e,t){let n=this,i=[];if(this._is3DContext()){let s=[],r=e.length;for(let t=0;t<r;t++)s[t]=n.getReference(e[t]);var o={ids:s,attributes:["ds6wg:revision"],callbacks:{onComplete:function(e){for(var n=0;n<r;n++){var o=s[n];let t={id:o};null!=e[o]&&(t.Revision=e[o]["ds6wg:revision"],i[n]=t)}t&&t(i)},onFailure:function(){console.warn("Failed"),t&&t(i)}}};return n._controller3D.getAttributes(o)}},getChildren:function(e){var t=this;if(this.isExternalContext)return this.getContext().getChildren(e);if(this._is2DContext()){if(null!=e&&e.getChildren){let n=e.getChildren(),i=[];return n&&n.length&&n.forEach((function(e){e&&(d(e)||e.isRelationsObjectNode?Array.prototype.push.apply(i,t.getChildren(e)):i.push(e))})),i||[]}}else if(this._is3DContext()){var n=e;if(null!=n){var i=n.getLastElement(!0);if(a.isPLMNode(i)){if(a.isInstance(i)&&i.children.length){var o=n.clone();return o.externalPath.push(i.children[0]),o.getChildrenPathes()}if(a.isRepInstance(i))return[];if(a.isReference(i))return n.getChildrenPathes()}}}return[]},getOrdering:function(e){if(this.isExternalContext)return this.getContext().getOrdering(e);if(this._is2DContext()){if(null!=e)return this.getContext().getOrdering(e)}else this._is3DContext()},getNodesInOriginalOrder:function(e){if(this.isExternalContext){if(this.getContext().getNodesInOriginalOrder)return this.getContext().getNodesInOriginalOrder(e)}else if(this._is2DContext()){var t=[],n=-1,i=this.getRoots();if(i&&i.length&&i[0].getAllDescendants)return i.forEach((function(i){i.processDescendants({onlyVisibleNodes:!1,processNode:function(i){(n=e.indexOf(i.nodeModel))>-1&&t.push(e[n])}})})),t;if(i&&!i.length&&i.getAllDescendants)return i.processDescendants({onlyVisibleNodes:!1,processNode:function(i){(n=e.indexOf(i.nodeModel))>-1&&t.push(e[n])}}),t}else this._is3DContext();return e},getNodesById:function(e){if(this.isExternalContext)return this.getContext().getNodesById(e);if(this._is2DContext())return this.getContext().getPADTreeDocument().getNodesById(e);if(this._is3DContext()){if(null!=e)try{var n=this,i=[];if(t.getSetting("enopad3dviewer_lightNodeModel")){this._controller3D.getIdPathesLeadingToReference(e).forEach((function(e){i.push(n._controller3D.buildPathFromArray(e.ids))}))}else{var o=this._controller3D.getNode({id:e}),s=this._controller3D.getRootBag();i=l.buildPathesLeadingToNode(o,s)}return i}catch(e){return[]}return[]}},isRoot:function(e){if(this.isExternalContext)return this.getContext().isRoot(e);if(this._is2DContext()){if(null!=e&&e.getRoot)return e.getRoot()===e}else if(this._is3DContext()){var t=e;if(null!=t)return t.externalPath.length<=2}return!1},isDescendantOf:function(e,t){if(this.isExternalContext)return this.getContext().isDescendantOf(e,t);if(this._is2DContext()){if(null!=e&&e.isDescendantOf)return e.isDescendantOf(t)}else if(this._is3DContext()&&null!=e){if(this.getReference(e)===t)return!0;if(!this.isRoot(e)){var n=this.getParent(e);if(n)return this.isDescendantOf(n,t)}}return!1},refresh:function(e){this.author(!0);var t=this.getContext();if(this.isExternalContext)t.refresh(e);else if("unparent"===e.action){var n=[],i=[];e.instances.forEach((function(e){n.push({physicalid:e}),i.push(e)})),this._is2DContext()?t.refreshView({deleted:n}):this._is3DContext()&&t.getController().unparent({deleted:i}),(g={}).detach={deleted:i},t._commandProxy.padRefresh(g,!0)}else if("insert"===e.action){var o={};o.isProdConfig=!!e.productConfigurationFromSearch,o[e.parent]=[];for(var s=0;s<e.references.length;s++)e.clientTaskData?o[e.parent].push({resourceid:e.references[s],relationid:e.instances[s],clientTaskData:e.clientTaskData}):o[e.parent].push({resourceid:e.references[s],relationid:e.instances[s]});if(o.noNotification=!0,this._is2DContext())this.getContext().insertNodes(o);else if(this._is3DContext()){var r=[],a=[];for(s=0;s<o[e.parent].length;s++){r.push(o[e.parent][s].relationid);var l=t.getController().buildArrayFromPath(e.rootNode);l.push(o[e.parent][s].relationid),l.push(o[e.parent][s].resourceid),a.push(l)}t.getController().insertExisting({created:r,inserted:a,modified:[e.parent]},!0)}}else if("replace"===e.action){var c=this;if(0===e.operations.length)return;var d={},u={created:[],inserted:[],modified:[]};d.isProdConfig=e.isProdConfig,d.noNotification=!0;var p=[],h=[];if(e.operations.forEach((function(e){if(0!==c.getNodesById(e.parent).length){if(c._is2DContext())d[e.parent]=d[e.parent]||[],d[e.parent].push({resourceid:e.new.reference,relationid:e.new.instance,ordering:e.ordering});else if(c._is3DContext()){u.created.push(e.new.instance);var n=t.getController().buildArrayFromPath(e.rootNode);-1===u.modified.indexOf(e.parent)&&(u.modified.push(e.parent),n.push(e.parent)),n.push(e.new.instance),n.push(e.new.reference),u.inserted.push(n)}p.push({physicalid:e.old,newrelid:e.new.instance}),h.push(e.old)}})),0!==p.length)if(this._is2DContext())t.replaceNodes({toInsert:d,toDelete:p});else if(this._is3DContext()){t.getController().insertExisting({created:u.created,inserted:u.inserted,modified:u.modified},!0),t.getController().unparent({deleted:h}),(g={}).detach={deleted:h},t._commandProxy.padRefresh(g,!0)}}else if("modified"===e.action){(m={}).authored={modified:e.operations},t._commandProxy.refresh(m)}else if("updateRevision"===e.action){var g;(g={}).updateRevision=e.operations,t._commandProxy.padRefresh(g,!0),this._is2DContext()&&this.getContext().getPADTreeDocument().updateRevision(e)}else if("created"===e.action){var f=t.getCurrentFolder();if(f){var m,v=(f="string"==typeof f?JSON.parse(f):f).FolderID,_=[];if(v)e.operations.forEach((function(e){var t=[v,e.existing];_.push(t)})),(m={}).authored={connected:_},t._commandProxy.refresh(m)}}},author:function(e){this.isExternalContext||this._is2DContext()?this.getContext().author(e):this._is3DContext()&&this.getContext().getController().switchAuthoringMode(e,!0,"PADSession_disabling_index_authoring")},beginBlockingTransaction:function(e){if(this.isExternalContext)this.getContext().beginBlockingTransaction&&this.getContext().beginBlockingTransaction(e);else if(this._is2DContext()){var t=new o({text:e,fadeDuration:50});t.on(e);var n=void 0;n=widget&&widget.body?widget.body:document.body,i.removeModal(n),i.createModal(n,t.elements.container)}else this._is3DContext()},endBlockingTransaction:function(){if(this.isExternalContext)this.getContext().endBlockingTransaction&&this.getContext().endBlockingTransaction();else if(this._is2DContext()){var e=void 0;e=widget&&widget.body?widget.body:document.body,i.removeModal(e)}else this._is3DContext()},displayNotification:function(e){this.getContext().displayNotification&&this.getContext().displayNotification(e)},modalChooser:function(e){var t="OnPremise",i=r.getTenantID();if(i&&0!==i.length&&(t=i),this.isExternalContext)this.getContext().modalChooser(e);else new n({position:e.position,in_apps_search:{source:e.source?e.source:["3dspace"],precond:e.precond,in_apps_callback:e.in_apps_callback,multiSel:e.multiSel,tenant:t}})},addRoot:function(e,t,n){this.isExternalContext?this.getContext().addRoot(e,t,n):this._is2DContext()?this.getContext().add(e,t,n):this._is3DContext()&&this.getContext().addRoots(e,n)},getSetting:function(e){if(this.isExternalContext)return this.getContext().getSetting(e);switch(e){case"lang":return t.getSetting("lang");case"securityContext":return t.getSetting("pad_security_ctx");default:return}},getNode3DStatus:function(e){return{isPLMNode:a.isPLMNode(e),is3DLeaf:a.is3DLeaf(e),isReference:a.isReference(e),isInstance:a.isInstance(e),isRepInstance:a.isRepInstance(e),isRepReference:a.isRepReference(e)}},getPathStatus:function(e){for(;null!=e;){var t=e.getLastElement(!0);if(a.isPLMNode(t))return this.getNode3DStatus(t);e=e.getParentPath()}return{isPLMNode:void 0,is3DLeaf:void 0,isReference:void 0,isInstance:void 0,isRepInstance:void 0,isRepReference:void 0}},getParentIds:function(e){var t=[];do{var n=this.getParent(e),i=this.getReference(n);void 0!==i&&t.push(i),e=n}while(void 0!==e);return t},displayConfirmationOnRemove:function(){var e=this.getContext().displayConfirmationOnRemove;return"function"==typeof e?e():widget.getPreference("displayConfirmationOnRemove")?widget.getPreference("displayConfirmationOnRemove").value:void 0},inheritParentLockStatusToChild:function(){var e=this.getContext().inheritParentLockStatusToChild;return"function"==typeof e?e():widget.getPreference("inheritReferenceLock")?widget.getPreference("inheritReferenceLock").value:void 0},isParentOfGroupingNode:function(e){if(!this.isExternalContext&&this._is2DContext()){let t=e.getChildren();return t&&t.length?d(t[0]):void 0}}}})),define("DS/AuthGenericCommands/views/AuthGenericDlgReorder",["UWA/Core","UWA/Class","UWA/Class/Options","DS/WebappsUtils/WebappsUtils","DS/AuthGenericCommands/AppContext","css!DS/AuthGenericCommands/AuthGenericCommands.css","DS/Core/PointerEvents"],(function(e,t,n,i,o,s,r){"use strict";var a=t.extend(n,{name:"UPSDlgReorder",_logger:null,_dialog:null,options:{},_treeListView:null,_manualButtons:[],_initialList:[],init:function(e){this._parent(e);var t=this;sessionStorage.UPSDlgReorderDnDIsHeader&&delete sessionStorage.UPSDlgReorderDnDIsHeader,sessionStorage.UPSDlgReorderDnDIsCell&&delete sessionStorage.UPSDlgReorderDnDIsCell,require(["DS/Logger/Logger"],(function(n){t._logger=n.getLogger(a),t._manualButtons=[],t._initialList=[],t.setOptions(e),e.renderTo||(e.renderTo=document.body);for(var i=e.children.length,o=new Array(i),s=0;s<i;s++){var r=e.children[s];o[s]={label:r.options.label,created:null,modified:null,responsible:r.options.grid["ds6w:responsible"],relationid:r.getRelationID(),physicalid:r.getID()},r.options.grid["ds6w:created"]&&(o[s].created=new Date(r.options.grid["ds6w:created"])),r.options.grid["ds6w:modified"]&&(o[s].modified=new Date(r.options.grid["ds6w:modified"]))}var l=o;t._createPanel(l,e)}))},_createPanel:function(t,n){var o=this;require(["i18n!DS/AuthGenericCommands/assets/nls/AuthDlgReorder.json","DS/Windows/Dialog","DS/Windows/ImmersiveFrame","DS/Controls/Button","DS/Controls/TooltipModel","DS/UIKIT/Alert"],(function(n,s,r,a,l,c){o.immersiveFrame=new r,widget&&widget.body?o.immersiveFrame.inject(widget.body):o.immersiveFrame.inject(document.body);var d=e.createElement("div",{class:"reorder-dialog-body",styles:{width:"100%",height:"100%",position:"relative"}}),u=n.modalHeader;o._dialog=new s({immersiveFrame:o.immersiveFrame,title:u,className:"reorder_dialog",content:d,resizableFlag:!0,allowMaximizeFlag:!0,maximizeButtonFlag:!0,movableFlag:!0,width:1e3,minWidth:500,minHeight:300,height:500,position:{at:"top left",my:"top left",offsetX:50,offsetY:50},touchMode:!0,buttons:{Ok:new a({label:n.modalFooterOK,disabled:!0,onClick:function(e){o.options.onReorderDone(o._treeListView.getDocument().getRoots()),e.dsModel.dialog.close()}}),Reset:new a({label:n.modalFooterReset,disabled:!0,onClick:o._onReset.bind(o)}),Cancel:new a({label:n.modalFooterCancel,onClick:function(e){e.dsModel.dialog.close()}})}}),o._dialog.addEventListener("close",o._onClosePanel.bind(o),!1),o._dialog.buttons.Reset.elements.container.classList.add("reorder-btn-reset-tree-order"),o._dialog.buttons.Cancel.elements.container.classList.add("reorder-btn-cancel"),o._dialog.elements.container.classList.add("AuthDLgReorder_Dialog"),o._dialog.elements.container.addEventListener("click",(function(e){return e.preventDefault(),e.stopPropagation(),!1}));var p=new e.Element("div",{class:"wux-control-inline-container",styles:{width:"100%",height:"100%",position:"relative"}}).inject(d),h=new e.Element("div",{class:"reorder-manual-listview-container",styles:{width:"calc(100% - 83.77px)",height:"calc(100% - 10px)",position:"relative",display:"inline-block"}}).inject(p),g=new e.Element("div",{class:"reorder-manual-updown-container",styles:{display:"inline-block","vertical-align":"top","margin-left":"25.88px","margin-top":"25.88px"}}).inject(p);o.reorderUp=new a({icon:i.getWebappsAssetUrl("AuthGenericCommands","icons/22/I_UpArrowReorder.png"),disabled:!0,touchMode:!0,onClick:o._onReorderUp.bind(o)}).inject(g),o.reorderDown=new a({icon:i.getWebappsAssetUrl("AuthGenericCommands","icons/22/I_DownArrowReorder.png"),disabled:!0,touchMode:!0,onClick:o._onReorderDown.bind(o)}).inject(g),o.reorderFree=new a({icon:i.getWebappsAssetUrl("AuthGenericCommands","icons/22/I_DesFlipSelection_34.png"),touchMode:!0,disabled:!0,onClick:o._onReorderFree.bind(o)}).inject(g),o.reorderUp.tooltipInfos=new l({shortHelp:n.upArrow}),o.reorderDown.tooltipInfos=new l({shortHelp:n.downArrow}),o.reorderFree.tooltipInfos=new l({shortHelp:n.freeArrow}),o.reorderUp.elements.container.addClassName("reorder-manual-button-up-arrow"),o.reorderDown.elements.container.addClassName("reorder-manual-button-down-arrow"),o.reorderFree.elements.container.addClassName("reorder-manual-button-free"),o._manualButtons.push(o.reorderUp),o._manualButtons.push(o.reorderDown),o._manualButtons.push(o.reorderFree),o._createTreeListView(h,t)}))},_createTreeListView:function(e,t){var n=this;require(["i18n!DS/AuthGenericCommands/assets/nls/AuthDlgReorder.json","DS/Tree/TreeListView","DS/TreeModel/TreeDocument"],(function(i,o,s){var r={apiVersion:2,defaultCellHeight:20,height:"auto",resize:{columns:!0,rows:!0},selection:{nodes:!0,cells:!1,rowHeaders:!1,columnHeaders:!1,unselectAllOnEmptyArea:!0,toggle:!1,canMultiSelect:!0,enableListSelection:!0},enableScrollOnDrag:!0,enableKeyboardNavigation:!0,enableActiveUI:!0,keymaps:{"ctrl+a":"treelistview:select-all"},columns:[{text:i.TreeListViewHeaderName,dataIndex:"tree",width:"40%",isSortable:!0},{text:i.TreeListViewHeaderResponsible,dataIndex:"responsible",width:"18%",isSortable:!0},{text:i.TreeListViewHeaderCreationDate,dataIndex:"createdDate",width:"20%",typeRepresentation:"datetime",isSortable:!0,isEditable:!1},{text:i.TreeListViewHeaderModifiedDate,dataIndex:"lastModifiedDate",width:"20%",typeRepresentation:"datetime",isSortable:!0,isEditable:!1}],onDragStartCell:function(e,t){if(!0!==this.reorderFreeRunning){var i=[],o=[];t.manager.getDocument().getXSO().get().forEach((function(e){i.push(e.dump()),o.push(e._getID())})),this.serializeDragAndDropEvent(e,{data:{"dswebux/x-tree.treenodemodel+json":i,"dswebux/x-tree.treenodemodel+number":t.nodeModel._getID(),"dspsd/x-tree.dlgreorderproduct+number":o}}),e.dataTransfer.effectAllowed="move",sessionStorage.UPSDlgReorderDnDIsHeader&&delete sessionStorage.UPSDlgReorderDnDIsHeader,sessionStorage.UPSDlgReorderDnDIsCell="true",n.DragFromThisPanel=!0}},onDragStartColumnHeader:function(){return sessionStorage.UPSDlgReorderDnDIsHeader=!0,sessionStorage.UPSDlgReorderDnDIsCell&&delete sessionStorage.UPSDlgReorderDnDIsCell,!0},onDragEnterCell:function(e){return void 0!==sessionStorage.UPSDlgReorderDnDIsCell&&"true"===sessionStorage.UPSDlgReorderDnDIsCell||(e.dataTransfer.dropEffect="none",!1)}};r.onDragOverCell=r.onDragEnterCell,r.onDragEnterBlank=r.onDragEnterCell,r.onDragOverBlank=r.onDragEnterCell,r.onDragEndCell=function(){delete n.DragFromThisPanel,delete sessionStorage.UPSDlgReorderDnDIsHeader,delete sessionStorage.UPSDlgReorderDnDIsCell},r.onDragEnterColumnHeader=function(e){return void 0!==sessionStorage.UPSDlgReorderDnDIsHeader&&"true"===sessionStorage.UPSDlgReorderDnDIsHeader||(e.dataTransfer.dropEffect="none",!1)},r.onDragOverColumnHeader=r.onDragEnterColumnHeader,r.onDropCell=function(e,t){if(void 0===sessionStorage.UPSDlgReorderDnDIsCell||void 0!==sessionStorage.UPSDlgReorderDnDIsHeader&&"true"===sessionStorage.UPSDlgReorderDnDIsHeader||!0!==n.DragFromThisPanel)return!1;var i=n._treeListView.getDocument().getSelectedNodes(),o=this.unserializeDragAndDropEvent(e);if(o){var s=t.nodeModel._getID(),r=o.data["dswebux/x-tree.treenodemodel+number"],a=o.data["dspsd/x-tree.dlgreorderproduct+number"],l=!1;if(a.forEach((function(e){e===s&&(l=!0)})),s===r||l)return!1;"middle"===t.dropPosition&&(t.dropPosition="bottom")}if(n._treeListView.options.onDropCellDefault.call(n._treeListView._datagrid,e,t),t.manager.getDocument().options.shouldAcceptDrop(t)){var c,d,u,p=t.nodeModel,h=p.getParent().getChildren().indexOf(p);if(n._logger.log("insert before or after node "+p.dump().label+", index of node: "+h+". Drop position : "+t.dropPosition),n._logger.log("reminder: top = insertBefore ||| bottom = addChild "),"top"===t.dropPosition)for(c=h-1,u=i.length-1;u>=0;u--)d=c-u,n._logger.log("idxToSelect after recalculation: "+d),n._treeListView.getManager().getRoots()[d].select();else for(c=h+1,u=0;u<i.length;u++)d=c+u,n._logger.log("idxToSelect after recalculation: "+d),n._treeListView.getManager().getRoots()[d].select();n._dialog.buttons.Ok.disabled=!1,n._dialog.buttons.Reset.disabled=!1}return delete n.DragFromThisPanel,delete sessionStorage.UPSDlgReorderDnDIsHeader,delete sessionStorage.UPSDlgReorderDnDIsCell,!1},r.onDropBlank=function(e,t){if(void 0===sessionStorage.UPSDlgReorderDnDIsCell||void 0!==sessionStorage.UPSDlgReorderDnDIsHeader&&"true"===sessionStorage.UPSDlgReorderDnDIsHeader||!0!==n.DragFromThisPanel)return!1;var i=Math.min(n._treeListView.getDocument().getRoots().length,13)*n._treeListView.elements.container.querySelectorAll(".wux-datagrid-cell.wux-layouts-treeview-cell.wux-datagrid-cell-even")[0].getSize().height;if(e.offsetY<i)return!1;var o=n._treeListView.getDocument().getSelectedNodes(),s=t.manager._rowsList.length-1;n._logger.log("idxToSelect for onDropBlank: "+s),n._treeListView.options.onDropBlankDefault.call(n._treeListView._datagrid,e,t);for(var r=0;r<o.length;r++){var a=s-r;n._logger.log("idxToSelect after recalculation: "+a),n._treeListView.getManager().getRoots()[a].select()}return n._dialog.buttons.Ok.disabled=!1,n._dialog.buttons.Reset.disabled=!1,delete n.DragFromThisPanel,delete sessionStorage.UPSDlgReorderDnDIsHeader,delete sessionStorage.UPSDlgReorderDnDIsCell,!1},r.onDropColumnHeader=function(){return void 0!==sessionStorage.UPSDlgReorderDnDIsHeader&&(void 0===sessionStorage.UPSDlgReorderDnDIsCell||"true"!==sessionStorage.UPSDlgReorderDnDIsCell)},n._treeListView=new o(r);var a,l=new s({shouldAcceptDrop:function(e){return void 0!==sessionStorage.UPSDlgReorderDnDIsCell&&(void 0===sessionStorage.UPSDlgReorderDnDIsHeader||"true"!==sessionStorage.UPSDlgReorderDnDIsHeader)&&("middle"!==e.dropPosition&&!0===n.DragFromThisPanel)},shouldAcceptDrag:function(e,t){return"tree"===t.dataIndex&&(void 0===n.reorderFreeRunning||!1===n.reorderFreeRunning)}});n._fillTreeNodeModel(l,t),n._treeListView.getManager().loadDocument(l),a=function(e,t,i){if(0!==i)return i;for(var o=void 0,s=void 0,r=0;r<n._initialList.length;r++)void 0===o&&e===n._initialList[r]?o=r:void 0===s&&t===n._initialList[r]&&(s=r);return o-s},r.columns.forEach((function(e){if("tree"===e.dataIndex)e.sortFunction=function(e,t){var i=e.options.label,o=t.options.label,s=i>o?1:i<o?-1:0;return s=a(e,t,s),n._dialog.buttons.Ok.disabled=!1,n._dialog.buttons.Reset.disabled=!1,s};else if("responsible"===e.dataIndex)e.sortFunction=function(e,t){var i=e.options.grid.responsible>t.options.grid.responsible?1:e.options.grid.responsible<t.options.grid.responsible?-1:0;return i=a(e,t,i),n._dialog.buttons.Ok.disabled=!1,n._dialog.buttons.Reset.disabled=!1,i};else{var t=void 0;"createdDate"===e.dataIndex?t="createdDate":"lastModifiedDate"===e.dataIndex&&(t="lastModifiedDate"),e.sortFunction=function(e,i){var o=new Date(e.options.grid[t])-new Date(i.options.grid[t]);return o=a(e,i,o),n._dialog.buttons.Ok.disabled=!1,n._dialog.buttons.Reset.disabled=!1,o}}})),n._treeListView.onNodeClick((function(){!1===n.reorderFreeRunning&&delete n.reorderFreeRunning}));var c=n._treeListView.getDocument().getXSO();n.callbackaddSelection=c.onPostAdd(n._check_onAdd.bind(n)),n.callbackremoveSelection=c.onPostRemove(n._check_onRemove.bind(n)),n._treeListView.inject(e)}))},_check_onAdd:function(){var e=this;!e.reorderFreeRunning&&e._treeListView.getDocument().getSelectedNodes().length>0&&(e.reorderUp.disabled=!1,e.reorderDown.disabled=!1,e.reorderFree.disabled=!1)},_check_onRemove:function(){var e=this;e.reorderFreeRunning||0!==e._treeListView.getDocument().getSelectedNodes().length||(e.reorderUp.disabled=!0,e.reorderDown.disabled=!0,e.reorderFree.disabled=!0)},_fillTreeNodeModel:function(e,t){var n=this;require(["DS/TreeModel/TreeNodeModel"],(function(i){e.prepareUpdate(),t.forEach((function(t){var n=new i({label:t.label,grid:{responsible:t.responsible,createdDate:t.created,lastModifiedDate:t.modified,relationid:t.relationid,physicalid:t.physicalid}});e.addRoot(n)})),e.pushUpdate(),n._initialList=e.getRoots().slice()}))},_getSelectedItems:function(){var e=[],t=this._treeListView.getDocument().getSelectedNodes();t.sort((function(e,t){return e._rowID-t._rowID}));for(var n=0;n<t.length;n++)e.push({label:t[n].options.label,rowID:t[n]._rowID,newRowID:t[n]._rowID});return e},_onReorderUp:function(){var e=this,t=e._getSelectedItems(),n=!1,i=e._treeListView.getDocument().getRoots();e._treeListView.getManager().prepareUpdateView();for(var o=0;o<t.length;o++){var s=t[o];if(0!==s.rowID&&(0===o&&s.rowID>0||t[o-1].newRowID!==s.rowID-1)){var r=i[s.rowID];s.newRowID=s.rowID-1,r.getParent().insertBefore(r,i[s.newRowID]),r.select(),n=!0}}if(e._treeListView.getManager().pushUpdateView(),n){var a=e._treeListView.getManager()._getVirtualPositionFromScrollPosition().rowID;t[0].newRowID<=a&&e._treeListView.getManager().scrollToRow(t[0].newRowID,"top"),e._dialog.buttons.Ok.disabled=!1,e._dialog.buttons.Reset.disabled=!1}},_onReorderDown:function(){var e=this,t=e._getSelectedItems(),n=e._treeListView.getDocument().getRoots().length-1,i=!1,o=e._treeListView.getDocument().getRoots();e._treeListView.getManager().prepareUpdateView();for(var s=t.length-1;s>=0;s--){var r=t[s];if(r.rowID!==n&&(s===t.length-1||t[s+1].newRowID!==r.rowID+1)){var a=o[r.rowID];r.newRowID=r.rowID+1,a.getParent().insertBefore(a,o[r.newRowID+1]),a.select(),i=!0}}if(e._treeListView.getManager().pushUpdateView(),i){var l=e._treeListView.getManager()._getVirtualPositionFromScrollPosition().rowID,c=Math.min(e._treeListView.getDocument().getRoots().length,14)+l;t[t.length-1].newRowID+1>=c&&e._treeListView.getManager().scrollToRow(t[t.length-1].newRowID+1,"bottom"),e._dialog.buttons.Ok.disabled=!1,e._dialog.buttons.Reset.disabled=!1}},_onReorderFree:function(){var t=this;if(!0===t.reorderFreeRunning)return t.reorderFreeRunning=!1,t._treeListView.getDocument().getXSO()._modelEvents.unsubscribe(t.reorderFreeOnAddCB),t._treeListView.getManager().elements.container.removeEvent(r.POINTERUP,t.reorderFreeEmptyAreaCB),t._treeListView.getDocument().getXSO()._modelEvents.unsubscribe(t.reorderFreeOnAddCB),delete t.reorderFreeOnAddCB,t.reorderUp.disabled=!1,void(t.reorderDown.disabled=!1);var n,i=t._getSelectedItems(),o=t._treeListView.getDocument().getSelectedNodes();0!==i.length&&(t.reorderUp.disabled=!0,t.reorderDown.disabled=!0,t._dialog.buttons.Ok.disabled=!0,t._dialog.buttons.Reset.disabled=!0,t.reorderFreeRunning=!0,t.reorderFreeEmptyAreaCB=function(n){var i=function(e){if(!e.hasOwnProperty("offsetX")){var t=(e.target||e.srcElement).getBoundingClientRect();return{offsetX:e.clientX-t.left,offsetY:e.clientY-t.top}}return{offsetX:e.offsetX,offsetY:e.offsetY}}(n);if(-1!==n.target.className.indexOf("wux-scroller")){var s=e.extendElement(n.target).getDimensions(),r=s.width,a=s.height;i.offsetX<r-18&&i.offsetY<a-18&&(t._reorderFreeEmptyAreaRunning=!0,o.forEach((function(e){e.select()})),t._reorderFreeEmptyAreaRunning=!1)}},t._treeListView.getManager().elements.container.addEvent(r.POINTERUP,t.reorderFreeEmptyAreaCB),t.reorderFreeOnAddCB=t._treeListView.getDocument().getXSO().onAdd((function(e){if(!t._reorderFreeEmptyAreaRunning){t._treeListView.getDocument().getXSO()._modelEvents.unsubscribe(t.reorderFreeOnAddCB),t._treeListView.getManager().elements.container.removeEvent(r.POINTERUP,t.reorderFreeEmptyAreaCB),e.unselect(),t.reorderUp.disabled=!1,t.reorderDown.disabled=!1,t._dialog.buttons.Ok.disabled=!1,t._dialog.buttons.Reset.disabled=!1,n=e._getRowID();var o,s=t._treeListView.getDocument().getRoots(),a=e.getParent(),l=0,c=1,d=2,u=3,p=4,h=0,g=0,f=!1;for(o=0;o<i.length;o++){if(i[o].rowID===n){f=!0;break}i[o].rowID<n?g++:h++}var m=l;m=f?p:g>0&&0===h?d:h>0&&0===g?c:u,t._treeListView.getManager().prepareUpdateView();var v=[];for(o=i.length-1;o>=0;o--){var _=s[i[o].rowID];v.push(_.remove()),i[o].rowID<n&&n--}m!==d&&m!==u||n++,setTimeout((function(){v.forEach((function(e,i){a.insertBefore(e,s[n]);var o=0===i;e.select(o),t.reorderFreeRunning=!1,delete t.reorderFreeOnAddCB})),t._treeListView.getManager().pushUpdateView()}),100),t._dialog.buttons.Ok.disabled=!1,t._dialog.buttons.Reset.disabled=!1}})))},_onReset:function(){var e,t=this;t._treeListView.getManager().prepareUpdateView();var n=t._treeListView.getDocument().getRoots();for(e=0;e<t._initialList.length;e++){var i=n[e];t._initialList[e]!==i&&i.getParent().insertBefore(t._initialList[e],i),i.unselect()}for(e=n.length-1;e>t._initialList.length;e--)n[e].remove();n.length=t._initialList.length,t._treeListView.getManager().pushUpdateView(),t._dialog.buttons.Ok.disabled=!0,t._dialog.buttons.Reset.disabled=!0},_onClosePanel:function(){void 0!==this.options.enableCmdOnClose&&"function"==typeof this.options.enableCmdOnClose&&this.options.enableCmdOnClose(!0),this._dialog.destroy(),this._dialog=null,this.immersiveFrame.destroy(),this.immersiveFrame=null}});return a})),define("DS/AuthGenericCommands/commands/AuthGenericCmdInsertNewDeformedFrom",["UWA/Class","DS/ApplicationFrame/Command","DS/AuthGenericCommands/AppContext","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/Editor","DS/Controls/Label","i18n!DS/AuthGenericCommands/assets/nls/AuthGenericCommandsCatalog.json"],(function(e,t,n,i,o,s,r,a,l){"use strict";return e.extend(t,{defaultOptions:{},init:function(e){e.context&&n.setContext(e.context),this._parent(e,{mode:"exclusive",isAsynchronous:!0})},execute:function(){var e=this;e._parentNodes=[];var t=n.getSelectedNodes();e._addRootMode=0===t.length,e._addRootMode||(e._success={},e._parentsCache={},e._childrenName={},n.getNamesAsync(t,(function(i){for(var o=0,s=i.length;o<s;o++){var r=n.getReference(t[o]),a=t[o];e._parentsCache[r]={node:a,name:i[o],type:n.getType(a)}}e._checkParentsSelection(t)}))),e.options.position=void 0},_checkParentsSelection:function(e){var t=this;t.defaultOptions.isValidParentSelection(e,(function(i){if(!1===i.status)for(var o=0,s=i.invalid.length;o<s;o++){var r=i.invalid[o],a=n.getReference(r),c=t._parentsCache[a].name,d=t._parentsCache[a].type,u=l.replace(l.get("insert_unsupported_type_parent"),{name:c,type:d});n.displayNotification({title:u,eventID:"error"})}else t._parentNodes=e,t._launchModalChooser()}))},_launchModalChooser:function(){var e=this,t=e._addRootMode?e.defaultOptions.chooser.precondFilterAddRoot:e.defaultOptions.chooser.precondFilter;n.modalChooser({position:e.options.position?e.options.position:"above_action_bar",source:e.defaultOptions.chooser.source,precondition:t,in_apps_callback:e._onSearchDone.bind(e,this),multiSel:e.defaultOptions.chooser.multiSel})},_onSearchDone:function(e,t){t?this._expandWebService(t):this.end()},_expandWebService:function(e){var t=this,n=require("DS/AuthGenericCommands/AuthGenericCmdWSAccess");t.defaultOptions.isValidChildrenSelection(e,(function(e){if(!1!==e.status){var i,o=e.valid[0].resourceid,s={onComplete:function(e){i=JSON.parse(e),t._launchWebPanel(i,o)},onFailure:function(e,t){console.warn("_runExpand.WS.onFailure")}},r="/resources/product/deformable/"+o+"/expandAll";n.callWS(s,r,"GET")}else t._reportBadTypes(e)}))},_createPanel:function(e,t){var n=this;n.immersiveFrame=new i,widget&&widget.body?n.immersiveFrame.inject(widget.body):n.immersiveFrame.inject(document.body);var c=UWA.createElement("div",{class:"insert-new-deformed-dialog-body",styles:{width:"100%",height:"100%",position:"relative"}}),d=l.insertNewDeformed_Header+" - "+t.title;n._dialog=new o({immersiveFrame:n.immersiveFrame,title:d,className:"insert_new_deformed_dialog",content:c,resizableFlag:!0,allowMaximizeFlag:!0,maximizeButtonFlag:!0,movableFlag:!0,width:750,minWidth:500,minHeight:250,height:400,position:{at:"top left",my:"top left"},modalFlag:!0,buttons:{Ok:new s({label:l.insertNewDeformed_OKBtn,onClick:function(i){n._createDeformedFromDeformable(e,t,h.value),i.dsModel.dialog.close()}}),Cancel:new s({label:l.insertNewDeformed_CancelBtn,onClick:function(e){e.dsModel.dialog.close()}})}}),n._dialog.buttons.Cancel.elements.container.classList.add("insert-new-deformed-btn-cancel"),n._dialog.elements.container.classList.add("AuthInsertNewDeformed_Dialog"),n._dialog.elements.container.addEventListener("click",(function(e){return e.preventDefault(),e.stopPropagation(),!1}));var u=new UWA.Element("div",{class:"wux-control-inline-container",styles:{width:"100%",height:"100%",position:"relative"}}).inject(c),p=new UWA.Element("div",{class:"insert-new-deformed-listview-container",styles:{width:"calc(100%)",height:"calc(85%)",position:"relative",display:"inline-block"}}).inject(u);new a({value:l.insertNewDeformed_Prefix,styles:{width:"calc(50%)",height:"calc(15%)",position:"relative",display:"inline-block"}}).inject(u).getContent().addClassName("iInsertNewDeformedFrom_PreFixLabel");var h=new r({widthInCharNumber:20,nbRows:1,newLineMode:"shiftEnter",styles:{width:"calc(70%)",height:"calc(20%)",position:"relative",display:"inline-block"}}).inject(u);h.getContent().addClassName("iInsertNewDeformedFrom_PreFixEditor"),n._createTreeListView(p,t)},_createTreeListView:function(e,t){var n=this;require(["DS/TreeModel/TreeDocument","DS/Tree/TreeListView"],(function(i,o){var s={apiVersion:2,height:"auto",resize:{columns:!0,rows:!0},selection:{nodes:!0,cells:!1,rowHeaders:!1,columnHeaders:!1,unselectAllOnEmptyArea:!0,toggle:!1,canMultiSelect:!1},enableScrollOnDrag:!0,columns:[{text:l.insertNewDeformed_Col_Name,dataIndex:"tree",isSortable:!1,isEditable:!1,isDraggable:!1},{text:l.insertNewDeformed_Col_Actions,dataIndex:"actions",isSortable:!1},{text:l.insertNewDeformed_Col_Deformabilty,dataIndex:"deformabilty",isSortable:!1},{text:l.insertNewDeformed_Col_Maturity,dataIndex:"maturity",isSortable:!1},{text:l.insertNewDeformed_Col_Revision,dataIndex:"revision",isSortable:!1},{text:l.insertNewDeformed_Col_Type,dataIndex:"type",isSortable:!1}]};n._treeListView=new o(s);var r=new i({});n._fillTreeNodeModel(r,t),n._treeListView.getManager().loadDocument(r),n._treeListView.inject(e)}))},_fillTreeNodeModel:function(e,t){var n=this;require(["DS/TreeModel/TreeNodeModel"],(function(i){let o={PRIVATE:"Draft",IN_WORK:"In Work",FROZEN:"Frozen",RELEASED:"Released",OBSOLETE:"Obsolete"};var s=function(e,t){let n=r(t);if(e.addChild(n),0!=t.children.length)for(var i of t.children)s(n,i)},r=function(e){let t="Deformable"===e.Deformabilty_Status?"To be deformed":"Reused",n=o[e.Maturity],s=null!=n?n:e.Maturity,r={revision:e.revision,type:e.type,actions:t,maturity:s,deformabilty:e.Deformabilty_Status},a=[];return e.IconUrl&&e.IconUrl.length>0&&a.push(e.IconUrl),new i({label:e.title,icons:a,grid:r})};e.prepareUpdate();var a=r(t);if(e.addRoot(a),0!==t.children.length)for(var l of t.children)s(a,l);e.pushUpdate(),n._initialList=e.getRoots().slice();let c=e.getRoots()[0];null!=c&&c.expand()}))},_CreateData:function(e,t){for(var n of(t.children=[],e))t.resourceid==n.parentid&&("Rigid"===t.Deformabilty_Status&&(n.Deformabilty_Status="Rigid"),t.children.push(n))},_launchWebPanel:function(e,t){let n=e.results,i=null;n.forEach((e=>{e.resourceid==t&&(i=e),this._CreateData(n,e)})),this._createPanel(n,i)},_createDeformedFromDeformable:function(e,t,n){var i,o,s=require("DS/AuthGenericCommands/AuthGenericCmdWSAccess"),r=this,a=e.length,l=[];for(i=0;i<a;i++)"Deformable"===e[i].Deformabilty_Status&&l.push({cestamp:e[i].cestamp,deformableID:e[i].resourceid});var c={data:{data:l,options:[{nlsKey:"Prefix:",type:"text",value:n,key:"prefix"}]},onComplete:function(e){var n,i,s=(o=JSON.parse(e)).results.length;for(n=0;n<s;n++)o.results[n].deformableID==t.resourceid&&(i=o.results[n].deformedID);var a=[i];r._processInsertExisting(a)},onFailure:function(e,t){console.warn("_createDeformedFromDeformable.WS.onFailure")},onTimeout:function(){console.warn("_createDeformedFromDeformable.WS.onTimeout")}};s.callWS(c,"/resources/product/deformable/createDeformedFromDeformable","POST")},_optimize:function(e){var t,n,i,o,s,r,a=[],l=e.length,c={},d={},u=0,p=0;for(t=0;t<l;t++)c[o=(n=e[t]).parent.isInstanceOf]?c[o].count++:(c[o]={count:1,cacheId:u++},n.parent.children&&(c[o].children=n.parent.children)),d[r=n.child.isInstanceOf]?d[r].count++:d[r]={count:1,cacheId:p++};var h={};for(i in c)h[i]={isInstanceOf:i},c[i].children&&(h[i].children=c[i].children),c[i].count>1&&(h[i].cacheId=c[i].cacheId);var g={};for(s in d)g[s]={isInstanceOf:s},d[s].count>1&&(g[s].cacheId=d[s].cacheId);for(t=0;t<l;t++)i=(n=e[t]).parent.isInstanceOf,s=n.child.isInstanceOf,o={},void 0===c[i].used?(o=h[i],c[i].used=!0):o={cacheId:h[i].cacheId},r={},void 0===d[s].used?(r=g[s],d[s].used=!0):r={cacheId:g[s].cacheId},a.push({parent:o,child:r});return a},_processInsertExisting:function(e){var t=this;require(["DS/AuthGenericCommands/AuthGenericCmdUtils","DS/AuthGenericCommands/views/AuthGenericDlgProgressbar"],(function(i,o){var s=[],r=[],a=[],c=e.length;for(let n=0;n<c;n++){var d=e[n],u=t._childrenName[d];s.push({isInstanceOf:d,name:u}),r.push(d),a.push(u)}var p=[];for(var h in t._parentsCache){var g=t._parentsCache[h].name,f=t._parentsCache[h].node,m={isInstanceOf:h,name:g},v=l.insert_unsupported_cycle,_=l.insert_unsupported_itself;if(!i.canInstantiate(h,r,v,g,a,_))return;var b=void 0,C=n.getChildren(f);null!==C&&C.length>0&&(b=[],C.forEach((function(e){var t=n.getInstance(e);t&&b.push(t)})),m.children=b),p.push(m)}for(var D=[],A=p.length,S=0;S<A;S++)for(let e=0;e<c;e++)D.push({parent:p[S],child:s[e]});var w={requests:D,chunkSize:t.defaultOptions.chunkSize,cbOnProgress:t._insertMass_OnProgress.bind(t),cbOnComplete:t._insertMass_OnComplete.bind(t),cbOnAbort:t._insertMass_OnAbort.bind(t),cbOnLastChunk:t._insertMass_OnLastChunk.bind(t)};w.chunkSize<D.length?t._progressbarDlg=new o({label:{progressBarMainTitle:l.executing,progressBarAbortAlert:l.abort_confirm_message,progressBarAlertTitle:l.confirm,modalFooterAbort:l.modalFooterAbort},events:{onAbort:function(){w.cbOnAbort()}}}):n.beginBlockingTransaction(l.executing),t._insertProcess=t._insertMassOperations(w)}))},_insertMassOperations:function(e){var t=this,i=require("DS/AuthGenericCommands/AuthGenericCmdWSAccess");return e.cbOnProcess=function(e,o){o=t._optimize(o);var s=!1;void 0===(s=n.inheritParentLockStatusToChild())&&(s=!1),i.insertExisting({data:{version:t.defaultOptions.version,bAllOrNothing:t.defaultOptions.bAllOrNothing,lockConnectionAsParent:s,operations:o},modeler:t.defaultOptions.modeler,onComplete:function(n){t._handleWSSuccess(e,o,n)},onFailure:function(n,i){t._handleWSFailure(e,o,n,i)}})},new i.MassChunkedRequests(e)},_handleWSSuccess:function(e,t,n){n="string"==typeof n?JSON.parse(n):n;var i=require("DS/AuthGenericCommands/AuthGenericCmdUtils");n.clientTaskData&&e.addClientTaskData(n.clientTaskData);for(var o=0,s=t.length;o<s;o++){var r=t[o],a=n.results[o];if("failure"===a.status){var l=i.buildErrorMessage(a.messages,{remapErrors:this.defaultOptions.remapErrors,name:null,type:null});a.messages=[l]}e.setAnswer(r,a)}},_handleWSFailure:function(e,t,n,i){var o=this,s=require("DS/AuthGenericCommands/AuthGenericCmdUtils");function r(e,t){var n=void 0;try{var i=JSON.parse(t);n=s.buildErrorMessage(i.messages,{remapErrors:o.defaultOptions.remapErrors,name:null,type:null})}catch(t){n=e.message}return n}for(var a=0,l=t.length;a<l;a++){var c=r(n,i),d=t[a],u={status:"failure",messages:[c],parent:d.parent.isInstanceOf,child:d.child.isInstanceOf?d.child.isInstanceOf:function(e){for(var n=0,i=t.length;n<i;n++)if(t[n].child.cacheId===e)return t[n].child.isInstanceOf}(d.child.cacheId)};e.setAnswer(d,u)}},_insertMass_OnAbort:function(){this._insertProcess&&this._insertProcess.abort()},_insertMass_OnProgress:function(e){var t=this;t._progressbarDlg&&t._progressbarDlg.progressBar&&(t._progressbarDlg.progressBar.value=100*e)},_insertMass_OnLastChunk:function(){this._progressbarDlg&&this._progressbarDlg.disableAbort()},_insertMass_OnComplete:function(e,t){var i=this;require(["DS/AuthGenericCommands/AuthGenericCmdUtils","DS/AuthGenericCommands/views/AuthGenericReportPanel"],(function(t,o){i._progressbarDlg?(i._progressbarDlg.destroy(),i._progressbarDlg=void 0):n.endBlockingTransaction();var s=[],r=[],a=[],c=void 0,d=void 0,u=void 0;e.getAbortedRequests().forEach((function(e){u=e.child.name,d=e.parent.name,c=l.replace(l.get("insert_report_cancelled"),{child:u,parent:d}),a.push(c)})),e.getAnswers().forEach((function(t){var n=t.answer,o=n.parent,a=n.child;u=i._childrenName[a],d=i._parentsCache[o].name;var p=n.instanceName;if(void 0===p&&(p=u),"success"===n.status)c=l.replace(l.get("insert_report_success"),{child:n.instanceName,parent:d}),s.push(c),i._success[o]?(i._success[o].references.push(a),i._success[o].instances.push(n.instance)):i._success[o]={references:[a],instances:[n.instance],rootNode:i._parentsCache[o].node},e.getClientTaskData()&&(i._success[o].clientTaskData=e.getClientTaskData());else{c=l.replace(l.get("insert_report_failure"),{child:u,parent:d});var h=t.answer.messages.length-1,g=t.answer.messages[h];c+="\n"+g,r.push(c)}}));var p=[];for(var h in i._success){var g=i._success[h];g.parent=h,g.action="insert",p.push(g)}if(p.forEach((function(e){n.refresh(e)})),1===s.length+r.length+a.length){var f=s.length>0,m=f?s[0]:r[0],v=f?"primary":"error";if("error"===v){const e=m.replace("{parent_object_title}",d).split("\n");n.displayNotification({title:e[0],subtitle:null!=e[1]?e[1]:"",msg:e[2],eventID:v})}else n.displayNotification({msg:m,eventID:v})}else i.reportPanel=new o({title:i.options.reportTitle,success:s,failure:r,neutral:[],aborted:a})}))}})})),define("DS/AuthGenericCommands/commands/AuthGenericCmdInsertProductConfiguration",["UWA/Class","DS/ApplicationFrame/Command","DS/AuthGenericCommands/AppContext","i18n!DS/AuthGenericCommands/assets/nls/AuthGenericCommandsCatalog.json"],(function(e,t,n,i){"use strict";return e.extend(t,{defaultOptions:{},init:function(e){e.context&&n.setContext(e.context),this._parent(e,{mode:"exclusive",isAsynchronous:!0})},beginExecute:function(){var e=this,t=n.getSelectedNodes();e._parentNodesFromID=[],e._childrenNameFromID=[],e.defaultOptions.isValidParentSelection(t,(function(o){if(!1===o.status)for(var s=0,r=o.invalid.length;s<r;s++){var a=o.invalid[s];const e=i.replace(i.get("insert_unsupported_type_parent"),{name:n.getName(a),type:n.getType(a)}).split("\n");n.displayNotification({title:e[0],msg:null!=e[1]?e[1]:"",eventID:"error"})}else{e._parentNodes=t;var l=e.defaultOptions.chooser.precondFilter;e._launchModalChooser(l)}})),e.options.position=void 0},_launchModalChooser:function(e){var t=this;t.firstOneToken=!1,n.modalChooser({position:t.options.position?t.options.position:"above_action_bar",source:t.defaultOptions.chooser.source,precond:e,in_apps_callback:t._onSearchDone_Children.bind(t,this),multiSel:t.defaultOptions.chooser.multiSel})},_onSearchDone_Children:function(e,t){var o=this;if(t){if(!o.firstOneToken){o.firstOneToken=!0,n.beginBlockingTransaction(i.executing);var s=o._launchProductConfigurationChooser.bind(o);o._checkValidParentAndChildren(t,s)}}else o.end&&o.end(),o.done()},_checkValidParentAndChildren:function(e,t){var o=this;require(["DS/AuthGenericCommands/AuthGenericCmdUtils"],(function(s){var r,a,l,c,d;o.defaultOptions.isValidChildrenSelection(e,(function(u){if(!1!==u.status){for(r=0,a=u.valid.length;r<a;r++)l=u.valid[r],c=l["ds6w:label"],o._childrenNameFromID[l.resourceid]=c;var p=[],h=[],g=[],f=e.length;console.log("nChild =",f);for(var m=0;m<f;m++)l=e[m],d=l.resourceid,c=o._childrenNameFromID[d],console.log("Child["+m+"] is",c),p.push({isInstanceOf:d,name:c}),h.push(d),g.push(c);var v=o._parentNodes,_=[],b=v.length;console.log("nParent =",b);for(var C=0;C<b;C++){var D=v[C];if(d=n.getReference(D),void 0===o._parentNodesFromID[d]){o._parentNodesFromID[d]=D;var A=i.insert_unsupported_cycle,S=i.insert_unsupported_itself,w=n.getName(D);if(console.log("Parent["+C+"] is",w),!s.canInstantiate(d,h,A,w,g,S))return;var y={isInstanceOf:d,name:w},N=void 0,x=n.getChildren(D);null!==x&&x.length>0&&(N=[],x.forEach((function(e){var t=n.getInstance(e);void 0!==t&&N.push(t)})),y.children=N),_.push(y)}}o._parents=_,o._children=p,o._childrenIDs=h,o._childrenName=g,"function"==typeof t&&t()}else{var R="",I="";for(r=0,a=u.invalid.length;r<a;r++)R+=u.invalid[r]["ds6w:label"],I+=u.invalid[r]["ds6w:type"],r!==a-1&&(R+=", ",I+=", ");const e=i.replace(i.get("insert_unsupported_child_type"),{name:R,type:I}).split("\n");n.displayNotification({title:e[0],msg:null!=e[1]?e[1]:"",eventID:"error"})}}))}))},_launchProductConfigurationChooser:function(){var e=this;require(["DS/AuthGenericCommands/AuthGenericCmdWSAccess"],(function(t){var n={data:{version:"1.2",pidList:[e._childrenIDs[0]],modelMask:"Read",enabledCriteria:"YES",cfgCtxt:"YES",xRevisionContent:"YES",isUniqueInDB:"YES"},onComplete:function(t){var n=null;let i=null;var o="string"==typeof t?JSON.parse(t):t;if(o.version&&"1.2"===o.version)if(null!=o.xRevisionContent&&o.xRevisionContent.length>0){let t={referenceId:o.xRevisionContent[0].referencePID,referenceName:e._childrenName[0]};e._launchReferenceRevisionExplorer(t)}else o.contextInfo&&o.contextInfo.length>0&&(n="",i="",o.referencesInfo&&o.referencesInfo.length>0&&"YES"===o.referencesInfo[0].hasConfigContext&&"Explicit"===o.referencesInfo[0].revisionMode?o.contextInfo[0].evolutionPid&&(i=o.contextInfo[0].evolutionPid):o.contextInfo.forEach((function(e){e.content.results.forEach((function(e){n&&(n+=" OR "),n+=e.physicalID}))}))),i&&i.length>0?e._launchProductConfigurationChooser3(i):e._launchProductConfigurationChooser2(n)},onFailure:function(t,n){console.log("getMultipleConfigurationContextInfo.onFailure"),e._launchProductConfigurationChooser2(null)}};t.callWS(n,"/resources/modeler/configuration/navigationServices/getMultipleConfigurationContextInfo","POST",[])}))},_launchReferenceRevisionExplorer:function(e){var t=this;require(["DS/Windows/Dialog","DS/Controls/Button","DS/Windows/ImmersiveFrame","DS/CoreEvents/ModelEvents","DS/AuthGenericCommands/views/AuthCfgProductConfiguration","i18n!DS/AuthGenericCommands/assets/nls/AuthDlgRevisionUpdate.json"],(function(n,i,o,s,r,a){t.AuthCfgProductConfigurationObj=new r({referenceId:e.referenceId,referenceName:e.referenceName}),t.AuthCfgProductConfigurationObj.revisionSelectionEvents=new s;let l=new i({label:a.modalFooterInsert,onClick:function(){let e=t.AuthCfgProductConfigurationObj.selectedRevisionID,n="";t.AuthCfgProductConfigurationObj&&""!==t.AuthCfgProductConfigurationObj.selectedPCID?n=t.AuthCfgProductConfigurationObj.selectedPCID:t.AuthCfgProductConfigurationObj.pcAutocomplete&&t.AuthCfgProductConfigurationObj.pcAutocomplete.selectedItems&&t.AuthCfgProductConfigurationObj.pcAutocomplete.selectedItems.options&&t.AuthCfgProductConfigurationObj.pcAutocomplete.selectedItems.options.grid&&""!==t.AuthCfgProductConfigurationObj.pcAutocomplete.selectedItems.options.grid.ID&&(n=t.AuthCfgProductConfigurationObj.pcAutocomplete.selectedItems.options.grid.ID),""!==n?t._onxRevision_ProductConfiguration({xRevisionId:e,pcID:n}):t._onxRevision_ProductConfiguration({xRevisionId:e}),t.referenceConfigurationDialog.immersiveFrame.getModel().elements.container.destroy(),t.referenceConfigurationDialog.immersiveFrame&&t.referenceConfigurationDialog.immersiveFrame.destroy()},className:"primary"}),c=new i({label:a.modalFooterCancel,onClick:function(){t.referenceConfigurationDialog.immersiveFrame.getModel().elements.container.destroy(),t.referenceConfigurationDialog.immersiveFrame&&t.referenceConfigurationDialog.immersiveFrame.destroy(),t.end&&t.end(),t.done()},className:"secondary"});var d=new o;d.inject(widget.body),t.referenceConfigurationDialog=new n({title:a.insertProductConfigurationTitle,content:t.AuthCfgProductConfigurationObj.render(),immersiveFrame:d,resizableFlag:!0,closeButtonFlag:!1,modalFlag:!0,identifier:"InsertExistingConfiguration",width:475,height:350,minHeight:256,minWidth:120,buttons:{Cancel:c,Ok:l}}),t.referenceConfigurationDialog.defaultButton.disabled=!0,t.AuthCfgProductConfigurationObj.revisionSelectionEvents.subscribe({event:"revisionSelectionInConfigurationDialog"},(()=>{t.referenceConfigurationDialog.defaultButton.disabled=!1}))})),n.endBlockingTransaction()},_launchProductConfigurationChooser2:function(e){var t=this;require(["DS/CfgBaseUX/scripts/CfgSearchConfiguration"],(function(o){if(null===e){const e=i.get("insertPC_noPCFound").split("\n");n.displayNotification({title:e[0],msg:null!=e[1]?e[1]:"",eventID:"error"})}else{console.log("CFG ModelId:",e);var s=new o(!1),r=t._onSearchDone_ProductConfiguration.bind(t),a='(NOT current:"Inactive") AND (based_95_on_95_model_95_pid:'+e+")";s.activate("","Product Configuration","",r,"","",a)}n.endBlockingTransaction()}))},_launchProductConfigurationChooser3:function(e){var t=this;require(["DS/CfgBaseUX/scripts/CfgSearchConfiguration"],(function(o){if(null===e){const e=i.get("insertPC_noPCFound").split("\n");n.displayNotification({title:e[0],msg:null!=e[1]?e[1]:"",eventID:"error"})}else{console.log("CFG ModelVersionId:",e);var s=new o(!1),r=t._onSearchDone_ProductConfiguration.bind(t),a='(NOT current:"Inactive") AND (based_95_on_95_model_95_version_95_pid:'+e+")";s.activate("","Product Configuration","",r,"","",a)}n.endBlockingTransaction()}))},_onxRevision_ProductConfiguration:function(e){var t=this;t.isEffectivityBased=!0;let n=e.xRevisionId;t._children[0].xRevisionId=n;var i=e.pcID;i&&(t._children[0].productConfigurationId=i),t._processInsertExisting()},_onSearchDone_ProductConfiguration:function(e){var t=this;t._productConfigurationFromSearch=e[0];var n=e[0].id;t._children[0].productConfigurationId=n,t._processInsertExisting()},_processInsertExisting:function(){for(var e=this,t=e._parents,o=e._children,s=[],r=t.length,a=(o.length,0);a<r;a++)s.push({parent:t[a],child:o[0]});var l=e.defaultOptions.chunkSize,c={isEffectivityBased:e.isEffectivityBased,chunkSize:l,requests:s,cbOnProgress:function(e,t,n){console.log("insertMassOperations.cbOnProgress",t)},cbOnComplete:function(t,o){n.endBlockingTransaction();var s={},r=[];t.getAnswers().forEach((function(t){var n=t.answer;if("success"===n.status){var i=n.parent;void 0!==s[i]?(s[i].references.push(n.child),s[i].instances.push(n.instance)):(s[i]={references:[n.child],instances:[n.instance],rootNode:e._parentNodesFromID[i]},e._productConfigurationFromSearch&&(s[i].productConfigurationFromSearch=e._productConfigurationFromSearch))}else r.push(n)}));var a=r.length>0;if(a){var l=e._parentNodesFromID[item.parent],c=n.getName(l),d=e._childrenNameFromID[item.child];if(e.isEffectivityBased){var u=i.replace(i.get("insertEB_error"),{parent:c,child:d});n.displayNotification({title:u,msg:"",eventID:"error"})}else{u=i.replace(i.get("insertPC_error"),{parent:c,child:d});n.displayNotification({title:u,msg:"",eventID:"error"})}}var p=[];for(var h in s){var g=s[h];g.parent=h,g.action="insert",p.push(g)}p.length>0&&(p.forEach((function(e){n.refresh(e)})),a||(e.isEffectivityBased?n.displayNotification({msg:i.insertEB_success,eventID:"primary"}):n.displayNotification({msg:i.insertPC_success,eventID:"primary"})))}};console.log("insertMassOperations need to process",s.length,"operation(s)"),n.beginBlockingTransaction(i.executing),e.process=e._insertMassOperations(c)},_insertMassOperations:function(e){var t=this,o=e;require(["DS/AuthGenericCommands/AuthGenericCmdWSAccess","DS/AuthGenericCommands/AuthGenericCmdUtils"],(function(e,s){return o.cbOnProcess=function(r,a){console.log("insertMassOperations.cbOnProcess: size=",a.length),console.log(a);var l=!1;void 0===(l=n.inheritParentLockStatusToChild())&&(l=!1),e.insertExisting({data:{version:t.defaultOptions.version,bAllOrNothing:t.defaultOptions.bAllOrNothing,lockConnectionAsParent:l,operations:a},modeler:t.defaultOptions.modeler,onComplete:function(e){if(console.log("insertMassOperations.WS.onComplete"),"success"===(e="string"==typeof e?JSON.parse(e):e).status){e.clientTaskData&&r.addClientTaskData(e.clientTaskData);for(var l=0,c=a.length;l<c;l++){var d=a[l],u=e.results[l];r.setAnswer(d,u)}}else if("failure"===e.status)for(l=0,c=a.length;l<c;l++){d=a[l];if(void 0!==(u=e.results[l]).messages){var p=t._parentNodesFromID[u.parent],h=n.getName(p),g=t._childrenNameFromID[u.child],f={remapErrors:t.defaultOptions.remapErrors,name:g,type:null},m=s.buildErrorMessage(u.messages,f),v=i.replace(i.get("insertPC_failure"),{parent:h,child:g,error:m});o.isEffectivityBased&&(v=i.replace(i.get("insertEB_failure"),{parent:h,child:g,error:m}));const e=(v=v.replace("{parent_object_title}",h)).split("\n");n.displayNotification({title:e[0],subtitle:null!=e[1]?e[1]:"",msg:null!=e[2]?e[2]:"",eventID:"error"}),r.cancel()}}},onFailure:function(e,o){console.log("insertMassOperations.WS.onFailure");var a=i.insertPC_error,l=void 0;try{l="string"==typeof o?JSON.parse(o):o;var c={remapErrors:t.defaultOptions.remapErrors,name:null,type:null};a+="\n"+s.buildErrorMessage(l.messages,c)}catch(t){a+=e.message}const d=a.split("\n");n.displayNotification({title:d[0],msg:null!=d[1]?d[1]:"",eventID:"error"}),r.cancel()}})},new e.MassChunkedRequests(o)}))}})})),define("DS/AuthGenericCommands/commands/AuthGenericCmdInsertExisting",["UWA/Class","DS/ApplicationFrame/Command","DS/AuthGenericCommands/AppContext","i18n!DS/AuthGenericCommands/assets/nls/AuthGenericCommandsCatalog.json"],(function(e,t,n,i){"use strict";return e.extend(t,{defaultOptions:{},init:function(e){e.context&&n.setContext(e.context),this._parent(e,{mode:"exclusive",isAsynchronous:!0})},beginExecute:function(){var e=this;e._parentNodes=[];var t=n.getSelectedNodes();e._addRootMode=0===t.length,e._addRootMode?e._launchModalChooser():(e._success={},e._parentsCache={},e._childrenName={},n.getNamesAsync(t,(function(i){for(var o=0,s=i.length;o<s;o++){var r=n.getReference(t[o]),a=t[o];e._parentsCache[r]={node:a,name:i[o],type:n.getType(a)}}e._checkParentsSelection(t)}))),e.options.position=void 0},_checkParentsSelection:function(e){var t=this;t.defaultOptions.isValidParentSelection(e,(function(o){if(!1===o.status)for(var s=0,r=o.invalid.length;s<r;s++){var a=o.invalid[s],l=n.getReference(a),c=t._parentsCache[l].name,d=t._parentsCache[l].type;const e=i.replace(i.get("insert_unsupported_type_parent"),{name:c,type:d}).split("\n");n.displayNotification({title:e[0],subtitle:null!=e[1]?e[1]:"",eventID:"error"})}else t._parentNodes=e,t._launchModalChooser()}))},_launchModalChooser:function(){var e=this,t=e._addRootMode?e.defaultOptions.chooser.precondFilterAddRoot:e.defaultOptions.chooser.precondFilter;e.firstOneToken=!1,n.modalChooser({position:e.options.position?e.options.position:"above_action_bar",source:e.defaultOptions.chooser.source,precond:t,in_apps_callback:e._onSearchDone.bind(e,this),multiSel:e.defaultOptions.chooser.multiSel})},_onSearchDone:function(e,t){var n=this;t?n.firstOneToken||(n.firstOneToken=!0,n._addRootMode?n._addRoot(t):n._insertExisting(t)):(n.end&&n.end(),n.done())},_reportBadTypes:function(e){for(var t="",o="",s=0,r=e.invalid.length;s<r;s++){var a=e.invalid[s]["ds6w:label_value"];a||(a=e.invalid[s]["ds6w:label"]),t+=a,o+=e.invalid[s]["ds6w:type"],s!==r-1&&(t+=", ",o+=", ")}var l=this._addRootMode?"insert_unsupported_root":"insert_unsupported_child_type";const c=(l=i.replace(i.get(l),{name:t,type:o})).split("\n");n.displayNotification({title:c[0],subtitle:null!=c[1]?c[1]:"",eventID:"error"})},_addRoot:function(e){var t=this;t.defaultOptions.isValidRootSelection(e,(function(e){if(!1===e.status&&t._reportBadTypes(e),e.valid.length>0){var i=[];e.valid.forEach((function(e){i.push(e.resourceid)})),n.addRoot({pids:i,data:e.valid},void 0,!0)}}))},_insertExisting:function(e){var t=this;t.defaultOptions.isValidChildrenSelection(e,(function(n){if(!1!==n.status){for(var i=0,o=n.valid.length;i<o;i++){var s=n.valid[i],r=s["ds6w:label_value"];r||(r=s["ds6w:label"]);var a=r;t._childrenName[s.resourceid]=a}t._processInsertExisting(e)}else t._reportBadTypes(n)}))},_optimize:function(e){var t,n,i,o,s,r,a=[],l=e.length,c={},d={},u=0,p=0;for(t=0;t<l;t++)c[o=(n=e[t]).parent.isInstanceOf]?c[o].count++:(c[o]={count:1,cacheId:u++},n.parent.children&&(c[o].children=n.parent.children)),d[r=n.child.isInstanceOf]?d[r].count++:d[r]={count:1,cacheId:p++};var h={};for(i in c)h[i]={isInstanceOf:i},c[i].children&&(h[i].children=c[i].children),c[i].count>1&&(h[i].cacheId=c[i].cacheId);var g={};for(s in d)g[s]={isInstanceOf:s},d[s].count>1&&(g[s].cacheId=d[s].cacheId);for(t=0;t<l;t++)i=(n=e[t]).parent.isInstanceOf,s=n.child.isInstanceOf,o={},void 0===c[i].used?(o=h[i],c[i].used=!0):o={cacheId:h[i].cacheId},r={},void 0===d[s].used?(r=g[s],d[s].used=!0):r={cacheId:g[s].cacheId},a.push({parent:o,child:r});return a},_processInsertExisting:function(e){var t=this;require(["DS/AuthGenericCommands/AuthGenericCmdUtils","DS/AuthGenericCommands/views/AuthGenericDlgProgressbar"],(function(o,s){var r,a=[],l=[],c=[],d=e.length;for(console.log("nChild =",d),r=0;r<d;r++){var u=e[r].resourceid,p=t._childrenName[u];console.log("Child["+r+"] is",p),a.push({isInstanceOf:u,name:p}),l.push(u),c.push(p)}var h=[];for(var g in t._parentsCache){var f=t._parentsCache[g].name,m=t._parentsCache[g].node;console.log("Found parent",g,f);var v={isInstanceOf:g,name:f},_=i.insert_unsupported_cycle,b=i.insert_unsupported_itself;if(!o.canInstantiate(g,l,_,f,c,b))return;var C=void 0,D=n.getChildren(m);null!==D&&D.length>0&&(C=[],D.forEach((function(e){var t=n.getInstance(e);t&&C.push(t)})),v.children=C),h.push(v)}var A=[],S=h.length;console.log("nParent =",S);for(var w=0;w<S;w++)for(r=0;r<d;r++)A.push({parent:h[w],child:a[r]});var y={requests:A,chunkSize:t.defaultOptions.chunkSize,cbOnProgress:t._insertMass_OnProgress.bind(t),cbOnComplete:t._insertMass_OnComplete.bind(t),cbOnAbort:t._insertMass_OnAbort.bind(t),cbOnLastChunk:t._insertMass_OnLastChunk.bind(t)};console.log("insertMassOperations need to process",A.length,"operation(s)"),y.chunkSize<A.length?t._progressbarDlg=new s({label:{progressBarMainTitle:i.executing,progressBarAbortAlert:i.abort_confirm_message,progressBarAlertTitle:i.confirm,modalFooterAbort:i.modalFooterAbort},events:{onAbort:function(){y.cbOnAbort()}}}):n.beginBlockingTransaction(i.executing),t._insertProcess=t._insertMassOperations(y)}))},_insertMassOperations:function(e){var t=this,i=require("DS/AuthGenericCommands/AuthGenericCmdWSAccess");return e.cbOnProcess=function(e,o){console.log("insertMassOperations.cbOnProcess: size=",o.length),o=t._optimize(o);var s=!1;void 0===(s=n.inheritParentLockStatusToChild())&&(s=!1),i.insertExisting({data:{version:t.defaultOptions.version,bAllOrNothing:t.defaultOptions.bAllOrNothing,lockConnectionAsParent:s,operations:o},modeler:t.defaultOptions.modeler,onComplete:function(n){console.log("insertMassOperations.WS.onComplete"),t._handleWSSuccess(e,o,n)},onFailure:function(n,i){console.log("insertMassOperations.WS.onFailure"),t._handleWSFailure(e,o,n,i)}})},new i.MassChunkedRequests(e)},_handleWSSuccess:function(e,t,n){n="string"==typeof n?JSON.parse(n):n;var i=require("DS/AuthGenericCommands/AuthGenericCmdUtils");n.clientTaskData&&e.addClientTaskData(n.clientTaskData);for(var o=0,s=t.length;o<s;o++){var r=t[o],a=n.results[o];if("failure"===a.status){var l=i.buildErrorMessage(a.messages,{remapErrors:this.defaultOptions.remapErrors,name:null,type:null});a.messages=[l]}e.setAnswer(r,a)}},_handleWSFailure:function(e,t,n,i){var o=this,s=require("DS/AuthGenericCommands/AuthGenericCmdUtils");function r(e,t){var n=void 0;try{var i=JSON.parse(t);n=s.buildErrorMessage(i.messages,{remapErrors:o.defaultOptions.remapErrors,name:null,type:null})}catch(t){n=e.message}return n}for(var a=0,l=t.length;a<l;a++){var c=r(n,i),d=t[a],u={status:"failure",messages:[c],parent:d.parent.isInstanceOf,child:d.child.isInstanceOf?d.child.isInstanceOf:function(e){for(var n=0,i=t.length;n<i;n++)if(t[n].child.cacheId===e)return t[n].child.isInstanceOf}(d.child.cacheId)};e.setAnswer(d,u)}},_insertMass_OnAbort:function(){this._insertProcess&&this._insertProcess.abort()},_insertMass_OnProgress:function(e){var t=this;t._progressbarDlg&&t._progressbarDlg.progressBar&&(t._progressbarDlg.progressBar.value=100*e)},_insertMass_OnLastChunk:function(){this._progressbarDlg&&this._progressbarDlg.disableAbort()},_insertMass_OnComplete:function(e,t){var o=this;require(["DS/AuthGenericCommands/AuthGenericCmdUtils","DS/AuthGenericCommands/views/AuthGenericReportPanel"],(function(t,s){o._progressbarDlg?(o._progressbarDlg.destroy(),o._progressbarDlg=void 0):n.endBlockingTransaction();var r=[],a=[],l=[],c=void 0,d=void 0,u=void 0;e.getAbortedRequests().forEach((function(e){u=e.child.name,d=e.parent.name,c=i.replace(i.get("insert_report_cancelled"),{child:u,parent:d}),l.push(c)})),e.getAnswers().forEach((function(t){var n=t.answer,s=n.parent,l=n.child;u=o._childrenName[l],d=o._parentsCache[s].name;var p=n.instanceName;if(void 0===p&&(p=u),"success"===n.status)c=i.replace(i.get("insert_report_success"),{child:n.instanceName,parent:d}),r.push(c),o._success[s]?(o._success[s].references.push(l),o._success[s].instances.push(n.instance)):o._success[s]={references:[l],instances:[n.instance],rootNode:o._parentsCache[s].node},e.getClientTaskData()&&(o._success[s].clientTaskData=e.getClientTaskData());else{c=i.replace(i.get("insert_report_failure"),{child:u,parent:d});var h=t.answer.messages.length-1,g=t.answer.messages[h];c+="\n"+g,a.push(c.replace("{parent_object_title}",d))}}));var p=[];for(var h in o._success){var g=o._success[h];g.parent=h,g.action="insert",p.push(g)}if(p.forEach((function(e){n.refresh(e)})),1===r.length+a.length+l.length){var f=r.length>0,m=f?r[0]:a[0],v=f?"primary":"error";if("error"===v){const e=(c=c.replace("{parent_object_title}",d)).split("\n");n.displayNotification({title:e[0],subtitle:null!=e[1]?e[1]:"",msg:null!=e[2]?e[2]:"",eventID:v})}else n.displayNotification({msg:m,eventID:v})}else o.reportPanel=new s({title:o.options.reportTitle,success:r,failure:a,neutral:[],aborted:l})}))}})})),define("DS/AuthGenericCommands/commands/AuthGenericCmdInsertDuplicate",["UWA/Class","DS/ApplicationFrame/Command","DS/AuthGenericCommands/AppContext","DS/DuplicateWidget/DuplicateComponentWidget","i18n!DS/AuthGenericCommands/assets/nls/AuthGenericCommandsCatalog.json"],(function(e,t,n,i,o){"use strict";return e.extend(t,{defaultOptions:{},init:function(e){e.context&&n.setContext(e.context),this._parent(e,{mode:"exclusive",isAsynchronous:!0})},beginExecute:function(){var e=this;e._duplicateComponentWidget=new i,e._parentNodes=[];var t=n.getSelectedNodes();e._addRootMode=0===t.length,e._addRootMode?e._launchModalChooser():(e._success={},e._parentsCache={},e._childrenName={},n.getNamesAsync(t,(function(i){for(var o=0,s=i.length;o<s;o++){var r=n.getReference(t[o]),a=t[o];e._parentsCache[r]={node:a,name:i[o],type:n.getType(a)}}e._checkParentsSelection(t)}))),e.options.position=void 0},_checkParentsSelection:function(e){var t=this;t.defaultOptions.isValidParentSelection(e,(function(i){if(!1===i.status)for(var s=0,r=i.invalid.length;s<r;s++){var a=i.invalid[s],l=n.getReference(a),c=t._parentsCache[l].name,d=t._parentsCache[l].type,u=o.replace(o.get("insert_unsupported_type_parent"),{name:c,type:d});n.displayNotification({title:u,eventID:"error"})}else t._parentNodes=e,t._launchModalChooser()}))},_launchModalChooser:function(){var e=this,t=e._addRootMode?e.defaultOptions.chooser.precondFilterAddRoot:e.defaultOptions.chooser.precondFilter;n.modalChooser({position:e.options.position?e.options.position:"above_action_bar",source:e.defaultOptions.chooser.source,precond:t,in_apps_callback:e._onSearchDone.bind(e,this),multiSel:e.defaultOptions.chooser.multiSel})},_onSearchDone:function(e,t){var n=this,i={title:n.options.commandName,duplicateAdvanced:!1};if(t){n._addRootMode?i.onCompletedCallback=function(e){e.result&&e.result.created.length>0?(t.forEach((function(t){e.result.created.forEach((function(e){t.resourceid==e.sourceObjectId&&(t.resourceid=e.physicalid,t.id=e.physicalid)}))})),n._addRoot(t)):(n.end&&n.end(),n.done())}:i.onCompletedCallback=function(e){e.result&&e.result.created.length>0?(t.forEach((function(t){e.result.created.forEach((function(e){t.resourceid==e.sourceObjectId&&(t.resourceid=e.physicalid,t.id=e.physicalid)}))})),n._insertExisting(t)):(n.end&&n.end(),n.done())};var o=[];t.forEach((function(e){o.push({physicalid:e.resourceid,name:e["ds6w:label"],revision:e["ds6wg:revision"],typeDisplayName:e["ds6w:type"],current:e["ds6w:status"],imageUrl:e.preview_url_value})})),n._duplicateComponentWidget.executeCmd(o,i)}else n.end&&n.end(),n.done()},_reportBadTypes:function(e){for(var t="",i="",s=0,r=e.invalid.length;s<r;s++){var a=e.invalid[s]["ds6w:label_value"];a||(a=e.invalid[s]["ds6w:label"]),t+=a,i+=e.invalid[s]["ds6w:type"],s!==r-1&&(t+=", ",i+=", ")}var l=this._addRootMode?"insert_unsupported_root":"insert_unsupported_child_type";l=o.replace(o.get(l),{name:t,type:i}),n.displayNotification({title:l,eventID:"error"})},_addRoot:function(e){var t=this;t.defaultOptions.isValidRootSelection(e,(function(e){if(!1===e.status&&t._reportBadTypes(e),e.valid.length>0){var i=[];e.valid.forEach((function(e){i.push(e.resourceid)})),n.addRoot({pids:i,data:e.valid},void 0,!0)}}))},_insertExisting:function(e){var t=this;t.defaultOptions.isValidChildrenSelection(e,(function(n){if(!1!==n.status){for(var i=0,o=n.valid.length;i<o;i++){var s=n.valid[i],r=s["ds6w:label_value"];r||(r=s["ds6w:label"]);var a=r;t._childrenName[s.resourceid]=a}t._processInsertExisting(e)}else t._reportBadTypes(n)}))},_optimize:function(e){var t,n,i,o,s,r,a=[],l=e.length,c={},d={},u=0,p=0;for(t=0;t<l;t++)c[o=(n=e[t]).parent.isInstanceOf]?c[o].count++:(c[o]={count:1,cacheId:u++},n.parent.children&&(c[o].children=n.parent.children)),d[r=n.child.isInstanceOf]?d[r].count++:d[r]={count:1,cacheId:p++};var h={};for(i in c)h[i]={isInstanceOf:i},c[i].children&&(h[i].children=c[i].children),c[i].count>1&&(h[i].cacheId=c[i].cacheId);var g={};for(s in d)g[s]={isInstanceOf:s},d[s].count>1&&(g[s].cacheId=d[s].cacheId);for(t=0;t<l;t++)i=(n=e[t]).parent.isInstanceOf,s=n.child.isInstanceOf,o={},void 0===c[i].used?(o=h[i],c[i].used=!0):o={cacheId:h[i].cacheId},r={},void 0===d[s].used?(r=g[s],d[s].used=!0):r={cacheId:g[s].cacheId},a.push({parent:o,child:r});return a},_processInsertExisting:function(e){var t=this;require(["DS/AuthGenericCommands/AuthGenericCmdUtils","DS/AuthGenericCommands/views/AuthGenericDlgProgressbar"],(function(i,s){var r,a=[],l=[],c=[],d=e.length;for(console.log("nChild =",d),r=0;r<d;r++){var u=e[r].resourceid,p=t._childrenName[u];console.log("Child["+r+"] is",p),a.push({isInstanceOf:u,name:p}),l.push(u),c.push(p)}var h=[];for(var g in t._parentsCache){var f=t._parentsCache[g].name,m=t._parentsCache[g].node;console.log("Found parent",g,f);var v={isInstanceOf:g,name:f},_=o.insert_unsupported_cycle,b=o.insert_unsupported_itself;if(!i.canInstantiate(g,l,_,f,c,b))return;var C=void 0,D=n.getChildren(m);null!==D&&D.length>0&&(C=[],D.forEach((function(e){var t=n.getInstance(e);t&&C.push(t)})),v.children=C),h.push(v)}var A=[],S=h.length;console.log("nParent =",S);for(var w=0;w<S;w++)for(r=0;r<d;r++)A.push({parent:h[w],child:a[r]});var y={requests:A,chunkSize:t.defaultOptions.chunkSize,cbOnProgress:t._insertMass_OnProgress.bind(t),cbOnComplete:t._insertMass_OnComplete.bind(t),cbOnAbort:t._insertMass_OnAbort.bind(t),cbOnLastChunk:t._insertMass_OnLastChunk.bind(t)};console.log("insertMassOperations need to process",A.length,"operation(s)"),y.chunkSize<A.length?t._progressbarDlg=new s({label:{progressBarMainTitle:o.executing,progressBarAbortAlert:o.abort_confirm_message,progressBarAlertTitle:o.confirm,modalFooterAbort:o.modalFooterAbort},events:{onAbort:function(){y.cbOnAbort()}}}):n.beginBlockingTransaction(o.executing),t._insertProcess=t._insertMassOperations(y)}))},_insertMassOperations:function(e){var t=this,i=require("DS/AuthGenericCommands/AuthGenericCmdWSAccess");return e.cbOnProcess=function(e,o){console.log("insertMassOperations.cbOnProcess: size=",o.length),o=t._optimize(o);var s=!1;void 0===(s=n.inheritParentLockStatusToChild())&&(s=!1),i.insertExisting({data:{version:t.defaultOptions.version,bAllOrNothing:t.defaultOptions.bAllOrNothing,lockConnectionAsParent:s,operations:o},modeler:t.defaultOptions.modeler,onComplete:function(n){console.log("insertMassOperations.WS.onComplete"),t._handleWSSuccess(e,o,n)},onFailure:function(n,i){console.log("insertMassOperations.WS.onFailure"),t._handleWSFailure(e,o,n,i)}})},new i.MassChunkedRequests(e)},_handleWSSuccess:function(e,t,n){n="string"==typeof n?JSON.parse(n):n;var i=require("DS/AuthGenericCommands/AuthGenericCmdUtils");n.clientTaskData&&e.addClientTaskData(n.clientTaskData);for(var o=0,s=t.length;o<s;o++){var r=t[o],a=n.results[o];if("failure"===a.status){var l=i.buildErrorMessage(a.messages,{remapErrors:this.defaultOptions.remapErrors,name:null,type:null});a.messages=[l]}e.setAnswer(r,a)}},_handleWSFailure:function(e,t,n,i){var o=this,s=require("DS/AuthGenericCommands/AuthGenericCmdUtils");function r(e,t){var n=void 0;try{var i=JSON.parse(t);n=s.buildErrorMessage(i.messages,{remapErrors:o.defaultOptions.remapErrors,name:null,type:null})}catch(t){n=e.message}return n}for(var a=0,l=t.length;a<l;a++){var c=r(n,i),d=t[a],u={status:"failure",messages:[c],parent:d.parent.isInstanceOf,child:d.child.isInstanceOf?d.child.isInstanceOf:function(e){for(var n=0,i=t.length;n<i;n++)if(t[n].child.cacheId===e)return t[n].child.isInstanceOf}(d.child.cacheId)};e.setAnswer(d,u)}},_insertMass_OnAbort:function(){this._insertProcess&&this._insertProcess.abort()},_insertMass_OnProgress:function(e){var t=this;t._progressbarDlg&&t._progressbarDlg.progressBar&&(t._progressbarDlg.progressBar.value=100*e)},_insertMass_OnLastChunk:function(){this._progressbarDlg&&this._progressbarDlg.disableAbort()},_insertMass_OnComplete:function(e,t){var i=this;require(["DS/AuthGenericCommands/AuthGenericCmdUtils","DS/AuthGenericCommands/views/AuthGenericReportPanel"],(function(t,s){i._progressbarDlg?(i._progressbarDlg.destroy(),i._progressbarDlg=void 0):n.endBlockingTransaction();var r=[],a=[],l=[],c=void 0,d=void 0,u=void 0;e.getAbortedRequests().forEach((function(e){u=e.child.name,d=e.parent.name,c=o.replace(o.get("insert_duplicate_report_cancelled"),{child:u,parent:d}),l.push(c)})),e.getAnswers().forEach((function(t){var n=t.answer,s=n.parent,l=n.child;u=i._childrenName[l],d=i._parentsCache[s].name;var p=n.instanceName;if(void 0===p&&(p=u),"success"===n.status)c=o.replace(o.get("insert_report_success"),{child:n.instanceName,parent:d}),r.push(c),i._success[s]?(i._success[s].references.push(l),i._success[s].instances.push(n.instance)):i._success[s]={references:[l],instances:[n.instance],rootNode:i._parentsCache[s].node},e.getClientTaskData()&&(i._success[s].clientTaskData=e.getClientTaskData());else{c=o.replace(o.get("insert_duplicate_report_failure"),{child:u,parent:d});var h=t.answer.messages.length-1,g=t.answer.messages[h];c+="\n"+g,a.push(c)}}));var p=[];for(var h in i._success){var g=i._success[h];g.parent=h,g.action="insert",p.push(g)}if(p.forEach((function(e){n.refresh(e)})),1===r.length+a.length+l.length){var f=r.length>0,m=f?r[0]:a[0],v=f?"primary":"error";if("error"===v){const e=m.replace("{parent_object_title}",d).split("\n");n.displayNotification({title:e[0],subtitle:null!=e[1]?e[1]:"",msg:e[2],eventID:v})}else n.displayNotification({msg:m,eventID:v})}else i.reportPanel=new s({title:i.options.reportTitle,success:r,failure:a,neutral:[],aborted:l})}))}})})),define("DS/AuthGenericCommands/views/AuthCfgRevision",["UWA/Class/View","UWA/Core","DS/Handlebars/Handlebars4","DS/ENOXVersionExplorerController/VersionExplorerController","DS/WidgetServices/WidgetServices","DS/AuthGenericCommands/AppContext"],(function(e,t,n,i,o,s){"use strict";return e.extend({className:"auth-configuration-revision",init:async function(e){this._parent(e)},render:function(){let e="OnPremise";if(s.getSetting("tenant"))e=s.getSetting("tenant");else{let t=o.getTenantID();t&&0!==t.length&&(e=t)}let t=s.getSetting("securityContext");var n=UWA.createElement("div",{styles:{height:"100%"}});n.inject(this.container),this.versionExplorer=new i({versionGraphContainer:n}),this.versionExplorer.setSingleSelectionMode(),this.versionExplorer.disableCommands();var r=this;return this.options.selectedRevisionID&&""!=this.options.selectedRevisionID&&(r.selectedNode={id:this.options.selectedRevisionID}),this.versionExplorer.publishEvent("ENOXVersionExplorerLoadVersionModel",{id:this.options.referenceId,securityContext:t,tenantId:e,type:"VPMReference",context:null,dataModelType:6,onComplete:function(){r.versionExplorer.subscribeEvent("select",(e=>r.configurationActionEvents.publish({event:"selectionInConfigurationDialog",data:e}))),r.versionExplorer.subscribeEvent("unselect",(e=>r.configurationActionEvents.publish({event:"unselectionInConfigurationDialog"}))),r.selectedNode&&r.selectedNode.id&&r.versionExplorer.select(r.selectedNode.id)}}),this.container}})})),define("DS/AuthGenericCommands/commands/AuthGenericCmdReorder",["UWA/Class","DS/ApplicationFrame/Command","DS/AuthGenericCommands/AppContext"],(function(e,t,n){"use strict";var i=e.extend(t,{defaultOptions:{},init:function(e){e.context&&n.setContext(e.context),this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){var e=this;e.disable(),require(["i18n!DS/AuthGenericCommands/assets/nls/AuthGenericCommandsCatalog.json"],(function(t){var i,o=n.getSelectedNodes();if(1===o.length){var s=o[0];n.isParentOfGroupingNode(s)?(n.displayNotification({title:t.reorder_groupedNode_error,eventID:"error"}),e.disable(),e.end&&e.end(),e.done()):e.defaultOptions.isValidParentSelection(s,(function(r){if(!1===r.status){var a=t.SEL_004;a=a.replace(/{type}/g,n.getType(o[0])),n.displayNotification({title:a,eventID:"error"}),e.enable(),e.end&&e.end(),e.done()}else{var l=n.getChildren(s);if(l&&l.length>1){l=l.slice();var c=[];e.defaultOptions.isChildrenOrderable(l,(function(o){for(i=0;i<l.length;i++)!1===o.status[i]&&(l.splice(i,1),o.status.splice(i,1),c.push(i),i--);if(l.length>1)n.getContext().isPartiallyExpanded(s,(function(i){if(i&&n.displayNotification({msg:t.reorder_view_partially_expanded,eventID:"warning"}),n.getContext().getPADDGVView()&&n.getContext().getPADDGVView().isClearSortEnabled()){var o=[];l.forEach((function(e){o.splice(function(e,t){for(var n=0;n<e.length;n++)if(e[n].getAttributeValue("actualIndex")>t.getAttributeValue("actualIndex"))return n;return e.length}(o,e),0,e)})),l=o,n.displayNotification({msg:t.reorder_warning_unsaved_sorting,eventID:"warning"})}e._launchReorderUI(s,l,c)}));else{let i=t.SEL_003;i=i.replace("{parent}",n.getName(s));const o=i.split("\n");n.displayNotification({title:o[0],msg:o[1],eventID:"error"}),e.enable(),e.end&&e.end(),e.done()}}))}else{let i=t.SEL_003;i=i.replace("{parent}",n.getName(s));const o=i.split("\n");n.displayNotification({title:o[0],msg:o[1],eventID:"error"}),e.enable(),e.end&&e.end(),e.done()}}}))}else if(o.length>1){const i=t.SEL_005.split("\n");n.displayNotification({title:i[0],msg:i[1],eventID:"error"}),e.enable(),e.end&&e.end(),e.done()}}))},_launchReorderUI:function(e,t,i,o){var s=this;require(["i18n!DS/AuthGenericCommands/assets/nls/AuthGenericCommandsCatalog.json","DS/AuthGenericCommands/views/AuthGenericDlgReorder","DS/AuthGenericCommands/AuthGenericCmdWSAccess","DS/AuthGenericCommands/AuthGenericCmdUtils","UWA/Core"],(function(o,r,a,l,c){s.reorderDlg=new r({parent:e,children:t,css_style:"maximized",enableCmdOnClose:s._setCmdAvailability.bind(s),events:{onApply:function(){}},onReorderDone:function(t){var r,d=[],u=t.length;for(r=0;r<u;r++){var p=t[r];d.push(p.options.grid.relationid)}var h={version:"1.0",order:{type:"RTInstance",count:u,children:d}};a.reorder({data:h,modeler:s.defaultOptions.modeler,optionalURL:e.getID(),onComplete:function(s){var a=c.is(s,"string")?JSON.parse(s):s;"success"===a.status?(n.author(!0),Array.prototype.find||(Array.prototype.find=function(e){var t,n=Object(this),i=n.length>>>0,o=arguments[1];for(r=0;r<i;r++)if(t=n[r],e.call(o,t,r,n))return t}),n.getRoots().forEach((function(o){o.getNodesById(e.getID()).forEach((function(e){!function(e,t){if(e.hasChildren()){var o=e.getState();e.prepareUpdate();var s=n.getChildren(e);for(e.removeChildren(),r=0;r<i.length;r++)e.addChild(s.splice(i[r],1));for(var a=0;a<s.length;a++){var l=s.find((function(e){return e.options.relationid===t[a].options.grid.relationid}));e.addChild(l)}e.setState({state:o}),e.pushUpdate()}}(e,t)}))})),n.displayNotification({msg:o.SUC_005,eventID:"primary"}),n.getContext().getPADDGVView()&&n.getContext().getPADDGVView().isClearSortEnabled()&&n.getContext().getPADDGVView().clearSort()):n.displayNotification({title:o.ERR_005,msg:a.message,eventID:"error"})},onFailure:function(e,t){var i=o.ERR_005;try{var r={remapErrors:s.defaultOptions.remapErrors,name:null,type:null},a=JSON.parse(t);if("ERR_FUN092398"===a.messages[0]){var c=n.getName(n.getNodesById(this.optionalURL)[0]);i+="\n"+o.replace(o.get("reorder_failure"),{name:c})}i+="\n"+l.buildErrorMessage(a.messages,r)}catch(t){i+="\n"+e.message}const d=i.split("\n");n.displayNotification({title:d[0],msg:d[1],eventID:"error"})}})}})}))},_setCmdAvailability:function(e){!0===e?this.enable():!1===e&&this.disable(),this.end&&this.end(),this.done()}});return i})),define("DS/AuthGenericCommands/views/AuthGenericDlgConfirm",["UWA/Controls/Abstract","UWA/Class/Events","UWA/Core","DS/Controls/Toggle","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Button","DS/WebappsUtils/WebappsUtils","DS/AuthGenericCommands/AppContext","i18n!DS/AuthGenericCommands/assets/nls/AuthGenericCommandsCatalog.json","DS/TreeModel/TreeDocument","DS/DataGridView/DataGridView","DS/TreeModel/TreeNodeModel","DS/TreeModel/DataModelSet"],(function(e,t,n,i,o,s,r,a,l,c,d,u,p,h){"use strict";return e.extend(t,{init:function(e){var t=this,g=UWA.Element("div",{class:"AuthGenericDlgConfirm_modal"}),f=UWA.Element("div",{class:"iDetachMessage"}).inject(g),m=a.getWebappsAssetUrl("AuthGenericCommands","icons/I_Warning.png");n.createElement("img",{src:m,class:"iTypeWarningIcon"}).inject(f);let v=e.ProductList.length;if(v>1){let t=UWA.Element("div",{class:"iDetachInformationMsg_MultipleObjects"}).inject(f);UWA.Element("div",{class:"iDetachInformationMsg_MultipleObjects_1",html:"<p>"+e.message+"</p>"}).inject(t),this.link=UWA.Element("div",{class:"iDetachInformationMsg_MultipleObjects_2",html:'<a id="textWorning_iDetachInformationMsg" style="cursor: pointer">'+v+" objects?</a>"}).inject(t)}else this.textWorning=UWA.Element("div",{class:"iDetachInformationMsg",html:"<p>"+e.message+"</p>"}).inject(f);var _=UWA.Element("div",{class:"iDetachMessageConfirm"}).inject(g),b=void 0,C=!1;e.CheckDetachRiskMsg?(b="<p>"+c.unparent_confirm_Warnning_1+"<br>"+c.unparent_confirm_Warnning_2+".</p>",C=!0):b="<p>"+c.displayAgain+".<p>";var D=!1,A=l.displayConfirmationOnRemove();void 0===A||!0!==A||e.CheckDetachRiskMsg||(D=!0),this.displayToggle=new i({type:"checkbox",domId:"idDisplayToggle",checkFlag:!1,visibleFlag:!D}).inject(_),UWA.Element("div",{class:"iDetachTextWorning_New",html:b,hidden:D}).inject(_).hidden=D;var S=new o({});let w=[new r({domId:"id"+e.action+"Button",label:e.action,visibleFlag:!0,disabled:C,emphasize:"primary",onClick:function(){t.myDialog.close(),e.callback(!0)}}),new r({domId:"idCancelButton_Confirm",label:c.insertNewDeformed_CancelBtn,visibleFlag:!0,onClick:function(){t.myDialog.close(),e.callback()}})];t.myDialog=new s({immersiveFrame:S,title:e.title,content:g,activeFlag:!1,modalFlag:!0,customButtonsDefinition:w,width:450,height:200}),this.displayToggle.addEventListener("buttonclick",function(){if(C){let e=t.myDialog.getCustomButtons();e[0].disabled=!e[0].disabled}else{var n=t.displayToggle.checkFlag;localStorage.setItem(e.className+".displayConfirmMsg",!n)}}.bind(this)),null!=this.link&&this.link.addEventListener("click",(function(){let n=UWA.Element("div",{class:"AuthGenericDlgConfirm_modal1"}),i={showSelectionCheckBoxesFlag:!1,showRowIndexFlag:!1,columns:[{text:c.detachConfirmation_Col_ParentTitle,dataIndex:"parent_title"},{text:c.detachConfirmation_Col_ParentRevision,dataIndex:"parent_revision"},{text:c.insertNewDeformed_Col_Name,dataIndex:"instance_title",icon:{iconName:"flow-cascade dgv-header-icon",fontIconFamily:WUXManagedFontIcons.Font3DS}},{text:c.insertNewDeformed_Col_Name,dataIndex:"tree"},{text:c.insertNewDeformed_Col_Revision,dataIndex:"Revision"}]},o=new h,a=new d({dataModelSet:o});a.prepareUpdate(),e.ProductList.forEach((function(e){let t=p.createTreeNodeDataModel(o,{label:e.Title,grid:{parent_revision:e.Parent_Revision,parent_title:e.Parent_Title,instance_title:e.Instance_Title,Revision:e.Revision},icons:e.Icon});a.addChild(t)})),a.expandAll(),a.pushUpdate(),i.treeDocument=a,t._treeListView=new u(i),t._treeListView.inject(n);let l=[new r({domId:"idObjectsDetailDialogCancelButton_Confirm",label:c.detachConfirmation_CancelBtn,visibleFlag:!0,onClick:function(){t.ObjectsDetailDialog.close()}})];t.ObjectsDetailDialog=new s({immersiveFrame:S,title:v+c.detachConfirmation_selectedObject,content:n,customButtonsDefinition:l,activeFlag:!1,width:600,height:80+25*v,resizableFlag:!0,modalFlag:!0})})),S.inject(document.body)}})})),define("DS/AuthGenericCommands/AuthGenericCmdUtils",["DS/AuthGenericCommands/AppContext"],(function(e){"use strict";return{checkNoParentWithChild:function(t){if(e._is2DContext()||e._is3DContext()){for(var n=t.length,i=0;i<n;i++)for(var o=t[i],s=0;s<n;s++)if(i!==s)for(var r=t[s],a=e.getParent(r);a;){if(a===o)return!1;a=e.getParent(a)}return!0}},canInstantiate:function(t,n,i,o,s,r){var a=i;if(e.isExternalContext&&void 0!==e.getContext().canInstantiate)return e.getContext().canInstantiate(t,n,i,o,s,r);for(var l=0;l<n.length;l++){if(this.searchForCycle(t,n[l])){if(i){a=i;var c=void 0!==o&&-1!==a.indexOf("{parent}"),d=void 0!==s&&-1!==a.indexOf("{child}");if(c&&d){var u=s[l];a=u===o?(a=r).replace(/{name}/g,o):(a=a.replace(/{parent}/g,o)).replace(/{child}/g,u)}const t=a.split("\n");e.displayNotification({title:t[0],subtitle:null!=t[1]?t[1]:"",eventID:"error"})}return!1}}return!0},searchForCycle:function(t,n,i){var o=!1;Array.isArray(i)||(i=[]);for(var s=e.getNodesById(t),r=0;r<s.length&&!o;r++){var a=s[r],l=e.getParents(a);if(l)for(var c=l.length-1;c>=0&&!o;c--){var d=l[c],u=e.getReference(d);i.indexOf(u)<0&&((o=this.searchForCycle(u,n,i))||i.push(u))}o||(o=e.isDescendantOf(a,n))}return o},buildErrorMessage:function(e,t){var n=null,i=null,o=null;if(void 0!==t.remapErrors&&null!==t.remapErrors)for(var s=t.remapErrors.length,r=0;r<s;r++){if(new RegExp(t.remapErrors[r].modeler,"i").test(e)){n=t.remapErrors[r].user,i=void 0!==t.remapErrors[r].type&&null!==t.remapErrors[r].type?t.remapErrors[r].type:null,o=void 0!==t.remapErrors[r].name&&null!==t.remapErrors[r].name?t.remapErrors[r].name:null;break}}return null===n&&(n=e[e.length-1]),null!=(o=null!==o?o:t.name)&&(n=n.replace(/{name}/g,o)),null!=(i=null!==i?i:t.type)&&(n=n.replace(/{type}/g,i)),n}}})),define("DS/AuthGenericCommands/commands/AuthGenericCmdReplaceByExisting",["UWA/Class","DS/ApplicationFrame/Command","DS/AuthGenericCommands/AppContext","i18n!DS/AuthGenericCommands/assets/nls/AuthGenericCommandsCatalog.json","DS/AuthGenericCommands/AuthGenericCmdUtils","DS/AuthGenericCommands/views/AuthGenericReportPanel"],(function(e,t,n,i,o,s){"use strict";return e.extend(t,{defaultOptions:{},init:function(e){e.context&&n.setContext(e.context),this._parent(e,{mode:"exclusive",isAsynchronous:!0,chunkSize:30})},beginExecute:function(){var e=this;if(e.errors=[],e.neutrals=[],e.selectedNodes=n.getSelectedNodes(),!e.selectedNodes.length)return e.end&&e.end(),void e.done();if(n.isThereARootSelected()){let t=i.SEL_002.split("\n");return n.displayNotification({title:t[0],subtitle:null!=t[1]?t[1]:"",eventID:"error"}),e.disable(),e.end&&e.end(),void e.done()}var t=n.getParentWithChild(e.selectedNodes);if(t&&0!==t.length)return n.displayNotification({title:i.replace_error,subtitle:i.replace_latest_failed_child_selected,eventID:"error"}),e.disable(),e.end&&e.end(),void e.done();e.defaultOptions.isValidSelection(e.selectedNodes,(function(t){if(!1===t.status)return n.getNamesAsync(t.invalid,(function(e){for(var o=0,s=t.invalid.length;o<s;o++){var r=t.invalid[o];const s=i.replace(i.get("replace_unsupported_type"),{name:e[o],type:n.getType(r)}).split("\n");n.displayNotification({title:s[0],subtitle:null!=s[1]?s[1]:"",eventID:"error"})}})),e.disable(),e.end&&e.end(),void e.done();var o=e.defaultOptions.chooser.precondFilter;"Drawing"===n.getType(e.selectedNodes[0])?o=e.defaultOptions.chooser.precondFilterDrawing:"3DShape"===n.getType(e.selectedNodes[0])&&(o=e.defaultOptions.chooser.precondFilter3DShape),e.firstOneToken=!1,n.modalChooser({position:e.options.position?e.options.position:"above_action_bar",precond:o,in_apps_callback:e._onSelectionDone.bind(e,this),multiSel:e.defaultOptions.chooser.multiSel})})),e.options.position=void 0},_onSelectionDone:function(e,t){var r=this;if(!t)return r.end&&r.end(),void r.done();if(r.firstOneToken)return r.end&&r.end(),void r.done();if(r.firstOneToken=!0,!n.getSelectedNodes().length)return 1===r.selectedNodes.length?n.displayNotification({eventID:"error",title:i.replace_error,msg:i.replace(i.get("replace_unaccessible_objet"),{name:n.getName(r.selectedNodes[0])})}):(r.selectedNodes.forEach((function(e){r.errors.push(i.replace_error+i.replace(i.get("replace_unaccessible_objet"),{name:n.getName(e)}))})),r.reportPanel=new s({title:r.options.reportTitle,success:[],failure:r.errors,neutral:[],aborted:[]})),r.end&&r.end(),void r.done();r.operations=[];var a=[];r.ordering=n.getOrdering(r.selectedNodes);var l=t[0];r.defaultOptions.isValidReplacer(l,(function(e){if(!0===e)n.getNamesAsync(r.selectedNodes,(function(e){for(var t=0,s=r.selectedNodes.length;t<s;t++){var c=r.selectedNodes[t],d=e[t],u=n.getReference(c),p=n.getInstance(c),h=l.resourceid,g=l["ds6w:label_value"];if(g||(g=l["ds6w:label"]),-1===a.indexOf(p))if(a.push(p),u!==h){var f=n.getReference(n.getParent(c));if(o.canInstantiate(f,[h])){var m={hasParent:f,instance:p,isInstanceOf:h,oldName:d,newName:g};r.operations.push(m)}else n.getNamesAsync([n.getParent(c)],(function(e){r.neutrals.push(i.replace(i.get("replace_unsupported_cycle"),{child:g,parent:e[0]}))}))}else r.neutrals.push(i.replace(i.get("replace_unsupported_itself"),{name:g}))}n.beginBlockingTransaction(i.executing),r._launchReplace(r.operations)}));else{var t=l["ds6w:label_value"];t||(t=l["ds6w:label"]),n.displayNotification({eventID:"error",title:i.replace_error,subtitle:i.replace(i.get("replace_bad_replacer_type"),{name:t,type:l["ds6w:type"]})})}}))},_launchReplace:function(e){var t=this;require(["DS/AuthGenericCommands/AuthGenericCmdWSAccess"],(function(o){if(e.length<1){if(t.errors.length+t.neutrals.length===1)if(1===t.errors.length){const e=t.errors[0].split("\n");n.displayNotification({title:e[0],subtitle:null!=e[1]?e[1]:"",eventID:"error"})}else n.displayNotification({msg:t.neutrals[0],eventID:"warning"});else t.reportPanel=new s({title:t.options.reportTitle,success:[],failure:t.errors,neutral:t.neutrals,aborted:[]});return t.enable(),n.endBlockingTransaction(),t.end&&t.end(),void t.done()}var r={version:t.defaultOptions.version,bAllOrNothing:t.defaultOptions.bAllOrNothing,modeler:t.defaultOptions.modeler,chunkSize:t.options.chunkSize,requests:e,cbOnProgress:t._replaceMass_OnProgress.bind(t),cbOnComplete:t._replaceMass_OnComplete.bind(t),cbOnAbort:t._replaceMass_OnAbort.bind(t),cbOnLastChunk:t._replaceMass_OnLastChunk.bind(t)};r.chunkSize<e.length&&require(["DS/AuthGenericCommands/views/AuthGenericDlgProgressbar"],(function(e){t.progressbarDlg=new e({label:{progressBarMainTitle:i.executing,progressBarAbortAlert:i.abort_confirm_message,progressBarAlertTitle:i.confirm,modalFooterAbort:i.modalFooterAbort},events:{onAbort:function(){r.cbOnAbort()}}}),t.enable(),n.endBlockingTransaction(),t.end&&t.end(),t.done()})),t.replaceProcess=o.replaceMassOperations(r)}))},_replaceMass_OnAbort:function(){this.replaceProcess&&this.replaceProcess.abort()},_replaceMass_OnProgress:function(e){var t=this;t.progressbarDlg&&t.progressbarDlg.progressBar&&(t.progressbarDlg.progressBar.value=100*e)},_replaceMass_OnLastChunk:function(){this.progressbarDlg&&this.progressbarDlg.disableAbort()},_replaceMass_OnComplete:function(e){var t,r=this,a=[],l=[],c=r.errors,d=e.getAnswers(),u={action:"replace",operations:[]};if(d.forEach((function(e){var n=e.answer;if("success"===n.status){var s={parent:n.parent,old:n.oldInstance,new:{reference:n.newReference,instance:n.newInstance},rootNode:n.parent};void 0!==r.ordering&&(s.ordering=r.ordering[n.oldInstance]),u.operations.push(s),t=i.replace(i.get("replace_report_success"),{oldName:n.oldName,newName:n.newName}),a.push(t)}else{var l={remapErrors:r.defaultOptions.remapErrors,name:n.oldName,type:null},d=o.buildErrorMessage(n.messages,l);"."===d&&n.messages&&(d=n.messages),t=n.oldName&&n.newName?i.replace(i.get("replace_report_failure2"),{oldName:n.oldName,newName:n.newName})+"\n"+d:n.oldName?i.replace(i.get("replace_report_failure1"),{oldName:n.oldName})+"\n"+d:i.replace_error+"\n"+d,c.push(t)}})),e.getAbortedRequests().forEach((function(e){t=i.replace(i.get("replace_report_abort"),{oldName:e.oldName,newName:e.newName}),l.push(t)})),n.refresh(u),r.progressbarDlg?(r.progressbarDlg.destroy(),r.progressbarDlg=void 0):n.endBlockingTransaction(),a.length+c.length+r.neutrals.length+l.length===1)if(1===a.length)n.displayNotification({msg:a[0],eventID:"primary"});else if(1===c.length){const e=t.replace("{parent_object_title}",d[0].answer.oldName).split("\n");n.displayNotification({title:e[0],subtitle:null!=e[1]?e[1]:"",msg:null!=e[2]?e[2]:"",eventID:"error"})}else 1===r.neutrals.length&&n.displayNotification({msg:r.neutrals[0],eventID:"warning"});else r.reportPanel=new s({title:r.options.reportTitle,success:a,failure:c,neutral:r.neutrals,aborted:l});r.enable(),n.endBlockingTransaction(),r.end&&r.end(),r.done()}})})),define("DS/AuthGenericCommands/commands/AuthGenericCmdRevisionUpdate",["UWA/Class","DS/ApplicationFrame/Command","DS/AuthGenericCommands/AppContext","DS/AuthGenericCommands/AuthGenericCmdUtils","i18n!DS/AuthGenericCommands/assets/nls/AuthGenericCommandsCatalog.json"],(function(e,t,n,i,o){"use strict";return e.extend(t,{defaultOptions:{},init:function(e){e.context&&n.setContext(e.context),this._parent(e,{mode:"exclusive",isAsynchronous:!1,chunkSize:30}),localStorage.getItem("PADAuthoringDebug")&&(this.options.debugMode=!0)},beginExecute:function(){var e=this;e.disable(),require(["DS/AuthGenericCommands/views/AuthGenericDlgRevisionUpdate"],(function(t){var i=n.getSelectedNodes();e.selectedNodes=i,i.length&&e.defaultOptions.isValidSelection(i,(function(i){if(!1===i.status){for(var s=0,r=i.invalid.length;s<r;s++){var a=i.invalid[s],l="",c=n.getName(a.node);"BADTYPE"===a.why?l=o.replace(o.get("selection_unsupported_type"),{name:c,type:n.getType(a.node)}):"ROOT"===a.why?l=o.replace(o.get("selection_root"),{name:c}):"CHILD"===a.why?l=o.replace(o.get("selection_child"),{child:c,parent:n.getName(a.parent)}):"ROOT_NO_CHILD"===a.why?l=o.replace(o.get("selection_root_no_children"),{name:c}):"CYCLE"===a.why&&(l=o.replace(o.get("selection_cycle"),{name:c})),n.displayNotification({title:o.BAD_SELECTION,msg:l,eventID:"warning"})}e.enable()}i.valid.length>0&&("FlatList"===e.options.commandMode?e.selectedNodes=n.getNodesInOriginalOrder(i.valid):e.selectedNodes=i.valid,e.revisionDlg=new t({roots:e.selectedNodes,validChildrenIDs:i.validChildrenIDs,valid3DShapeKindChildrenIDs:i.valid3DShapeKindChildrenIDs,validDrawingKindChildrenIDs:i.validDrawingKindChildrenIDs,title:e.options.commandName,commandMode:e.options.commandMode,onLoad:e._launchLoad.bind(e),onLoadRevisionNumberProposal:e._launchLoadRevisionNumberProposal.bind(e),onLoadConfigInfo:e._launchLoadConfigInfo.bind(e),onComplete:e._launchIntention.bind(e),onCancel:e._launchCancel.bind(e),onAbort:e._launchLoadAbort.bind(e),enableCmdOnClose:e._setCmdAvailability.bind(e),options:e.options.options}))}))}))},_setCmdAvailability:function(e){!0===e?this.enable():!1===e&&this.disable()},_launchLoad:function(e,t,n){var i=this;require(["DS/AuthGenericCommands/AuthGenericRevision"],(function(o){if(i.options.fakeRevisions){var s=i.options.getFakeRevisions(e,i.options.fakeRevisions),r=o.getLatestCandidateRevisions(s,!0);"function"==typeof t&&t(r)}else{var a={requests:e,chunkSize:i.options.chunkSize,progressBar:i.revisionDlg.progressBar,cbOnComplete:function(e){var n=e.getAnswers(),s=o.getLatestCandidateRevisions(n);"function"==typeof t&&t(s),"function"==typeof i.options.onWIWPageReady&&i.options.onWIWPageReady()},cbOnProgress:n,cbOnAbort:i._launchLoadAbort};i.options.options&&i.options.options.getIconFromNLV&&!0===i.options.options.getIconFromNLV&&(a.useIcon=!0),i.loadProcess=o.getRevisions(a)}}))},_launchLoadRevisionNumberProposal:function(e,t){require(["DS/AuthGenericCommands/AuthGenericCmdWSAccess"],(function(n){var i=[],o=[];e.forEach((function(e){(o=[]).push({semantic:"LAST",id:e}),i.push({copyId:e,ancestors:o})}));var s={data:JSON.stringify({addRequests:i}),timeout:6e6,onComplete:function(e){var n="string"==typeof e?JSON.parse(e):e;"function"==typeof t&&t(n.addRequests)},onFailure:function(e,n){"function"==typeof t&&t()},onTimeout:function(){"function"==typeof t&&t()}};n.callWS(s,"/resources/v1/dslc/getversionnumberproposal","POST")}))},_launchLoadConfigInfo:function(e,t){require(["DS/AuthGenericCommands/AuthGenericCmdWSAccess"],(function(n){var i={data:{version:"1.0",pidList:e,modelMask:"Read",enabledCriteria:"YES",cfgCtxt:"YES"},onComplete:function(e){var n="string"==typeof e?JSON.parse(e):e;"function"==typeof t&&t(n.referencesInfo)},onFailure:function(e,n){"function"==typeof t&&t()},onTimeout:function(){"function"==typeof t&&t()}};n.callWS(i,"/resources/modeler/configuration/navigationServices/getMultipleConfigurationContextInfo","POST",[])}))},_launchLoadAbort:function(){this.loadProcess&&this.loadProcess.abort()},_getNodeToOrder:function(e){var t=this,n=[];return"FlatList"===t.options.commandMode?n=t.selectedNodes:e.forEach((function(e){for(var i=t.selectedNodes.length,o=0;o<i;o++){var s=t.selectedNodes[o].getNodesByRelId(e.instance);if(s.length&&1===s.length){n.push(s[0]);break}}})),n},_launchCancel:function(){var e=this;e.options.onWIWCancel&&"function"==typeof e.options.onWIWCancel?e.options.onWIWCancel():(e.end&&e.end(),e.done())},_launchIntention:function(e){var t=[];if(e.replaceCycleList=[],e.replaceList.length>0){for(var s=0;s<e.replaceList.length;s++)i.canInstantiate(e.replaceList[s].hasParent,[e.replaceList[s].isInstanceOf])?t.push(e.replaceList[s]):e.replaceCycleList.push(e.replaceList[s]);e.replaceList=t}this.options.options.EnableBubbleup&&e.createList.length>0?(n.beginBlockingTransaction(o.executing),e.replaceNeutralList=[],this._launchNewRevision(e)):e.replaceList.length>0?this._launchReplace(e):e.replaceCycleList.length>0&&this._intention_OnComplete(e)},_launchNewRevision:function(e){var t=this;require(["DS/AuthGenericCommands/AuthGenericCmdWSAccess"],(function(n){for(var i=[],o=[],s=0;s<e.createList.length;s++)"waiting"===e.createList[s].status&&((i=[]).push({semantic:"LAST",id:e.createList[s].physicalid}),o.push({copyId:e.createList[s].physicalid,ancestors:i,options:{withPost:!0}}),e.createList[s].status="pending");var r={data:JSON.stringify({addRequests:o}),timeout:6e5,onComplete:t._createRevisionComplete.bind(t,e),onFailure:t._createRevisionFailure.bind(t,e),onTimeout:t._createRevisionFailure.bind(t,e)};n.callWS(r,"/resources/v1/dslc/addversions","POST",!1,!0)}))},_createRevisionFailure:function(e,t,n){var i=0,o=this;for(o.options.debugMode&&console.log("createRevisionFailure, networkError :"+t+", serverError :"+n),i=0;i<e.createList.length;i++){"pending"===e.createList[i].status&&(e.createList[i].status="failed");for(var s=0;s<e.replaceList.length;s++)e.replaceList[s].isInstanceOf===e.createList[i].physicalid&&(e.replaceNeutralList.push({status:"neutral",oldName:e.replaceList[s].oldName}),e.replaceList.splice(s,1),0!==s&&s!==e.replaceList.length||s--)}e.replaceList.length>0?o._launchReplace(e):o._intention_OnComplete(e)},_createRevisionComplete:function(e,t){var i=0,o=0,s=this,r=e.replaceList;if((t="string"==typeof t?JSON.parse(t):t).errorMessage)s._createRevisionFailure(e,"",t.errorMessage);else{for(t.addRequests&&t.addRequests.length>0&&(t.addRequests.forEach((function(t){for(i=0;i<e.createList.length;i++)for(e.createList[i].physicalid===t.copyId&&(e.createList[i].status="success",e.createList[i].newName+=t.code,e.createList[i].newRevision=t.code,e.createList[i].id=t.id),o=0;o<e.replaceList.length;o++)e.replaceList[o].hasParent===t.copyId&&(r[o].hasParent=t.id),"success"===e.createList[i].status&&e.replaceList[o].isInstanceOf===t.copyId&&-1!==e.createList[i].instancesOfHimself.indexOf(e.replaceList[o].instance)&&(r[o].isInstanceOf=t.id,r[o].newName+=t.code),e.replaceList[o].instance===t.copyId&&(r[o].instance=t.id)})),e.replaceList=r),i=0;i<e.createList.length;i++)if("neutral"===e.createList[i].status)for(o=0;o<e.replaceList.length;o++)e.replaceList[o].isInstanceOf===e.createList[i].physicalid&&(e.replaceNeutralList.push({status:"neutral",oldName:e.replaceList[o].oldName}),e.replaceList.splice(o,1),0!==o&&o!==e.replaceList.length||o--);e.replaceList.length>0?s._launchReplace(e):(s._intention_OnComplete(e),n.endBlockingTransaction())}},_launchReplace:function(e){var t=this;t.options.onWIWClose&&"function"==typeof t.options.onWIWClose?t.options.onWIWClose(e.replaceList):require(["DS/AuthGenericCommands/AuthGenericCmdWSAccess"],(function(i){var s=t._getNodeToOrder(e.replaceList);t.ordering=n.getOrdering(s);var r={version:t.defaultOptions.version,bAllOrNothing:t.defaultOptions.bAllOrNothing,modeler:t.defaultOptions.modeler,chunkSize:t.options.chunkSize,requests:e.replaceList,cbOnComplete:t._intention_OnComplete.bind(t,e),cbOnProgress:t._replaceMass_OnProgress.bind(t),cbOnAbort:t._replaceMass_OnAbort.bind(t),cbOnLastChunk:t._replaceMass_OnLastChunk.bind(t)};r.chunkSize<e.replaceList.length?(n.endBlockingTransaction(),require(["DS/AuthGenericCommands/views/AuthGenericDlgProgressbar"],(function(e){t.progressbarDlg=new e({label:{progressBarMainTitle:o.executing,progressBarAbortAlert:o.abort_confirm_message,progressBarAlertTitle:o.confirm,modalFooterAbort:o.modalFooterAbort},events:{onAbort:function(){r.cbOnAbort()}}})}))):0===e.createList.length&&n.beginBlockingTransaction(o.executing),t.replaceProcess=i.replaceMassOperations(r)}))},_replaceMass_OnAbort:function(){this.replaceProcess&&this.replaceProcess.abort()},_replaceMass_OnProgress:function(e){var t=this;t.progressbarDlg&&t.progressbarDlg.progressBar&&(t.progressbarDlg.progressBar.value=100*e)},_replaceMass_OnLastChunk:function(){this.progressbarDlg&&this.progressbarDlg.disableAbort()},_intention_OnComplete:function(e,t){var s=this;require(["DS/AuthGenericCommands/views/AuthGenericReportPanel"],(function(r){var a,l=[],c=[],d=[],u=[],p=[],h=[],g=[],f=[],m=[];t&&(f=t.getAnswers(),m=t.getAbortedRequests());var v={action:"replace",operations:[]};e.createList&&e.createList.forEach((function(e){"success"===e.status&&(a=o.replace(o.get("NewRevision_report_success"),{oldName:e.oldName,newName:e.newName}),h.push(e.physicalid),g.push({existing:e.physicalid,new:e.id,newRevison:e.newRevision}),"CreateNewRevision"===e.type&&p.push(e.id),l.push(a)),"failed"===e.status&&(a=o.replace(o.get("NewRevision_report_failure"),{oldName:e.oldName}),c.push(a)),"aborted"===e.status&&(a=o.replace(o.get("NewRevision_report_abort"),{oldName:e.oldName}),u.push(a)),"neutral"===e.status&&(a=o.replace(o.get("NewRevision_report_neutral"),{oldName:e.oldName}),d.push(a))})),e.replaceNeutralList&&e.replaceNeutralList.forEach((function(e){a=o.replace(o.get("replace_report_neutral"),{oldName:e.oldName}),d.push(a)})),e.replaceCycleList&&e.replaceCycleList.forEach((function(e){n.getNamesAsync([s.selectedNodes[0]],(function(t){a=o.replace(o.get("replace_unsupported_cycle"),{child:e.newName,parent:t[0]})})),d.push(a)})),f&&f.forEach((function(e){var t=e.answer;if("success"===t.status)v.operations.push({parent:t.parent,old:t.oldInstance,new:{reference:t.newReference,instance:t.newInstance},rootNode:t.parent,ordering:s.ordering[t.oldInstance]}),a=o.replace(o.get("replace_report_success"),{oldName:t.oldName,newName:t.newName}),l.push(a);else{var r={remapErrors:s.defaultOptions.remapErrors,name:t.oldName,type:null},d=i.buildErrorMessage(t.messages,r);"."===d&&t.messages&&(d=t.messages),d=d.replace(/insert an Aggregated/g,"replace a Composed"),a=o.replace(o.get("replace_report_failure1"),{oldName:t.oldName})+" "+d;let e=n.getNodesById(t.parent);a=a.replace("{parent_object_title}",n.getName(e[0])),c.push(a)}})),m&&m.forEach((function(e){a=o.replace(o.get("replace_report_abort"),{oldName:e.oldName,newName:e.newName}),u.push(a)})),v.operations.length>0&&n.refresh(v),p.length>0&&n.addRoot({pids:p},void 0,!0),g.length>0&&(n.refresh({action:"created",operations:g}),n.refresh({action:"updateRevision",operations:g})),s.progressbarDlg?(s.progressbarDlg.destroy(),s.progressbarDlg=void 0):(n.endBlockingTransaction(),s.end&&s.end(),s.done()),s.reportPanel=new r({title:s.options.reportTitle,success:l,failure:c,neutral:d,aborted:u})}))}})})),define("DS/AuthGenericCommands/commands/AuthGenericCmdReplaceByDuplicate",["UWA/Class","DS/ApplicationFrame/Command","DS/AuthGenericCommands/AppContext","DS/DuplicateWidget/DuplicateComponentWidget","i18n!DS/AuthGenericCommands/assets/nls/AuthGenericCommandsCatalog.json","DS/AuthGenericCommands/AuthGenericCmdUtils","DS/AuthGenericCommands/views/AuthGenericReportPanel"],(function(e,t,n,i,o,s,r){"use strict";return e.extend(t,{defaultOptions:{},init:function(e){e.context&&n.setContext(e.context),this._parent(e,{mode:"exclusive",isAsynchronous:!0,chunkSize:30})},beginExecute:function(){var e=this;if(e._duplicateComponentWidget=new i,e.errors=[],e.neutrals=[],e.selectedNodes=n.getSelectedNodes(),e.selectedNodes.length){if(n.isThereARootSelected()){const t=o.SEL_002.split("\n");return n.displayNotification({title:t[0],subtitle:null!=t[1]?t[1]:"",eventID:"error"}),e.disable(),e.end&&e.end(),void e.done()}e.defaultOptions.isValidSelection(e.selectedNodes,(function(t){if(!1===t.status)return n.getNamesAsync(t.invalid,(function(e){for(var i=0,s=t.invalid.length;i<s;i++){var r=t.invalid[i];const s=o.replace(o.get("replace_unsupported_type"),{name:e[i],type:n.getType(r)}).split("\n");n.displayNotification({title:s[0],subtitle:null!=s[1]?s[1]:"",eventID:"error"})}})),e.disable(),e.end&&e.end(),void e.done();var i={title:e.defaultOptions.commandName,duplicateAdvanced:!1,onCompletedCallback:function(t){if(t.result&&t.result.created.length>0){e.success=[];var i=n.getParentWithChild(e.selectedNodes);i&&0!==i.length&&i.forEach((function(t){for(let s=0;s<e.selectedNodes.length;s++)if(n.getParent(t.child).options.referenceId===t.parent.options.referenceId&&e.selectedNodes[s].options.grid.instanceId===t.child.options.grid.instanceId){e.selectedNodes.splice(s,1);var i=o.replace(o.get("replace_duplicate_report_success"),{oldName:t.child.options.grid["ds6w:label"]});e.success.push(i),s--}})),e.operations=[];var r=[];e.ordering=n.getOrdering(e.selectedNodes),n.getNamesAsync(e.selectedNodes,(function(i){for(var a=0,l=e.selectedNodes.length;a<l;a++){var c=e.selectedNodes[a],d=i[a],u=n.getReference(c),p=n.getInstance(c),h=void 0;if(t.result.created.forEach((function(e){u==e.sourceObjectId&&(h=e.physicalid)})),-1===r.indexOf(p))if(r.push(p),u!==h){var g=n.getReference(n.getParent(c));if(s.canInstantiate(g,[h])){var f={hasParent:g,instance:p,isInstanceOf:h,oldName:d};e.operations.push(f)}else n.getNamesAsync([n.getParent(c)],(function(t){e.neutrals.push(o.replace(o.get("replace_unsupported_cycle"),{child:d,parent:t[0]}))}))}else e.neutrals.push(o.replace(o.get("replace_unsupported_itself"),{name:d}))}})),n.beginBlockingTransaction(o.executing),e._launchReplace(e.operations)}else e.end&&e.end(),e.done()}},r=[];e.selectedNodes.forEach((function(e){r.push({physicalid:n.getReference(e),name:e.options.label,revision:e.options.grid["ds6wg:revision"],typeDisplayName:e.options.grid["ds6w:type"],current:e.options.grid["ds6w:status"],imageUrl:e.options.thumbnail})})),console.log("call the DuplicateComponentWidget"),e._duplicateComponentWidget.executeCmd(r,i)}))}},_launchReplace:function(e){var t=this;require(["DS/AuthGenericCommands/AuthGenericCmdWSAccess"],(function(i){if(e.length<1){if(t.errors.length+t.neutrals.length===1)if(1===t.errors.length){const e=t.errors[0].split("\n");n.displayNotification({title:e[0],subtitle:null!=e[1]?e[1]:"",eventID:"error"})}else{const e=t.neutrals[0].split("\n");n.displayNotification({title:e[0],subtitle:null!=e[1]?e[1]:"",eventID:"warning"})}else t.reportPanel=new r({title:t.options.reportTitle,success:[],failure:t.errors,neutral:t.neutrals,aborted:[]});return t.enable(),n.endBlockingTransaction(),t.end&&t.end(),void t.done()}var s={version:t.defaultOptions.version,bAllOrNothing:t.defaultOptions.bAllOrNothing,modeler:t.defaultOptions.modeler,chunkSize:t.options.chunkSize,requests:e,cbOnProgress:t._replaceMass_OnProgress.bind(t),cbOnComplete:t._replaceMass_OnComplete.bind(t),cbOnAbort:t._replaceMass_OnAbort.bind(t),cbOnLastChunk:t._replaceMass_OnLastChunk.bind(t)};s.chunkSize<e.length&&require(["DS/AuthGenericCommands/views/AuthGenericDlgProgressbar"],(function(e){t.progressbarDlg=new e({label:{progressBarMainTitle:o.executing,progressBarAbortAlert:o.abort_confirm_message,progressBarAlertTitle:o.confirm,modalFooterAbort:o.modalFooterAbort},events:{onAbort:function(){s.cbOnAbort()}}}),t.enable(),n.endBlockingTransaction(),t.end&&t.end(),t.done()})),t.replaceProcess=i.replaceMassOperations(s)}))},_replaceMass_OnAbort:function(){this.replaceProcess&&this.replaceProcess.abort()},_replaceMass_OnProgress:function(e){var t=this;t.progressbarDlg&&t.progressbarDlg.progressBar&&(t.progressbarDlg.progressBar.value=100*e)},_replaceMass_OnLastChunk:function(){this.progressbarDlg&&this.progressbarDlg.disableAbort()},_replaceMass_OnComplete:function(e){var t,i=this,a=[],l=i.errors,c=e.getAnswers(),d={action:"replace",operations:[]};if(c.forEach((function(e){var n=e.answer;if("success"===n.status){var r={parent:n.parent,old:n.oldInstance,new:{reference:n.newReference,instance:n.newInstance},rootNode:n.parent};void 0!==i.ordering&&(r.ordering=i.ordering[n.oldInstance]),d.operations.push(r),t=o.replace(o.get("replace_duplicate_report_success"),{oldName:n.oldName,newName:n.newName}),i.success.push(t)}else{var a={remapErrors:i.defaultOptions.remapErrors,name:n.oldName,type:null},c=s.buildErrorMessage(n.messages,a);"."===c&&n.messages&&(c=n.messages),t=n.oldName&&n.newName?o.replace(o.get("replace_report_failure2"),{oldName:n.oldName,newName:n.newName})+"\n"+c:n.oldName?o.replace(o.get("replace_report_failure1"),{oldName:n.oldName})+"\n"+c:o.replace_error+c,l.push(t.replace("{parent_object_title}",n.parentName))}})),e.getAbortedRequests().forEach((function(e){t=o.replace(o.get("replace_duplicate_report_abort"),{oldName:e.oldName,newName:e.newName}),a.push(t)})),n.refresh(d),i.progressbarDlg?(i.progressbarDlg.destroy(),i.progressbarDlg=void 0):n.endBlockingTransaction(),i.success.length+l.length+i.neutrals.length+a.length===1){if(1===i.success.length)n.displayNotification({msg:i.success[0],eventID:"primary"});else if(1===l.length){const e=l[0].split("\n");n.displayNotification({title:e[0],subtitle:e[1],msg:e[2],eventID:"error"})}else if(1===i.neutrals.length){const e=i.neutrals[0].split("\n");n.displayNotification({title:e[0],subtitle:null!=e[1]?e[1]:"",eventID:"warning"})}}else i.reportPanel=new r({title:i.options.reportTitle,success:i.success,failure:l,neutral:i.neutrals,aborted:a});i.enable(),n.endBlockingTransaction(),i.end&&i.end(),i.done()}})})),define("DS/AuthGenericCommands/AuthGenericCmdWSAccess",["text!DS/AuthGenericCommands/assets/AuthGenericCommands.json","DS/WAFData/WAFData","DS/WidgetServices/WidgetServices","DS/AuthGenericCommands/AppContext","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext"],(function(e,t,n,i,o){"use strict";var s=JSON.parse(e);function r(e){var t="";if(void 0!==e&&Array.isArray(e))for(var n=e.length/2,i=0;i<n;i++)t+=0===i?"?":"&",t+=e[2*i]+"="+e[2*i+1];return encodeURI(t)}function a(e,o,s,a){var l=void 0;if(s=s||"",(a=a||[]).push("securityContext"),a.push(i.getSetting("securityContext")),i.getSetting("tenant"))l=i.getSetting("tenant"),a.push("tenant"),a.push(l);else{l="OnPremise";var c=n.getTenantID();c&&0!==c.length&&(l=c),a.push("tenant"),a.push(l)}o.indexOf("/search")>=0?n.get3DSearchUrlAsync({onComplete:function(n){var c=r(a),d=n+o+s+c;return void 0!==e.data&&null!==e.data&&"object"==typeof e.data&&(e.data.tenant=l,e.data.login={"3dspace":{SecurityContext:i.getSetting("securityContext")}},e.data=JSON.stringify(e.data),"{}"===e.data&&(e.data=null)),t.authenticatedRequest(d,e)},platformId:l}):n.get3DSpaceUrlAsync({onComplete:function(n){var i=r(a),l=n+o+s+i;return void 0!==e.data&&null!==e.data&&"object"==typeof e.data&&(e.data=JSON.stringify(e.data),"{}"===e.data&&(e.data=null)),t.authenticatedRequest(l,e)},platformId:l})}function l(e,t,n){var r=s[t],l=r.url.replace("[modeler]",e.modeler),c=UWA.clone(e,!1);if(c.method=r.verb,c.timeout=6e5,c.headers={Accept:"application/json","Content-Type":"application/json","Accept-Language":i.getSetting("lang"),SecurityContext:i.getSetting("securityContext")},!0===n){var d=o.get();if(d&&d.AuthoringContextHeader)for(var u in d.AuthoringContextHeader)c.headers[u]=d.AuthoringContextHeader[u]}a(c,l,e.optionalURL)}var c={callWS:function(e,t,n,s,r){return function(e,t,n,s,r){var l=UWA.clone(e,!1);if(l.method=n,l.headers={Accept:"application/json","Content-Type":"application/json","Accept-Language":i.getSetting("lang"),SecurityContext:i.getSetting("securityContext")},!0===r){var c=o.get();if(c&&c.AuthoringContextHeader)for(var d in c.AuthoringContextHeader)l.headers[d]=c.AuthoringContextHeader[d]}a(l,t,"",s)}(e,t,n,s,r)},unparent:function(e){return l(e,"unparent",!0)},insertExisting:function(e){return l(e,"insertExisting",!0)},replace:function(e){return l(e,"replace",!0)},reorder:function(e){return l(e,"reorder",!0)},move3D:function(e){return l(e,"move3D",!0)},reparent:function(e){return l(e,"reparent",!0)},getTypesHierarchy:function(e){return l(e,"gettypeshierarchy")},getoperationslist:function(e){return l(e,"getoperationslist",!0)},getIsDeformed:function(e){return l(e,"getIsDeformed")},getDeformedFromReferences:function(e){return l(e,"getDeformedFromReferences")},MassChunkedRequests:function(e){var t=e.chunkSize||30,n=void 0,i=void 0,o=void 0,s=void 0,r=void 0,a=0,l=0,c=0,d=0,u=!1,p=!1,h=void 0,g=this;this.process=function(){if(a!==r&&"function"==typeof e.cbOnProcess){var n=o.slice(l,l+t);e.cbOnProcess(g,n)}},this.reprocess=function(){if(!u&&"function"==typeof e.cbOnProcess){var n=o.slice(l,l+t);e.cbOnProcess(g,n)}},this.addClientTaskData=function(e){h=h?h.concat(e):e},this.getClientTaskData=function(){return h},this.setAnswer=function(o,h){if(!u){if(a++,n?s.push({request:o,answer:h}):s[o]=h,"function"==typeof e.cbOnProgress){var f=a/r;e.cbOnProgress(f)}a>c&&(++d===i&&e.cbOnLastChunk&&"function"==typeof e.cbOnLastChunk&&e.cbOnLastChunk(),l=c+1,(c+=t)>=r&&(c=r-1),p?(e.cbOnComplete(g,p),u=!0):this.process()),a>=r&&!u&&"function"==typeof e.cbOnComplete&&(e.cbOnComplete(g,p),u=!0)}},this.getAnswer=function(e){if(void 0!==n){if(!n)return s[e];for(var t=JSON.stringify(e),i=0,o=s.length;i<o;i++){if(t===JSON.stringify(s[i].request))return s[i].answer}}},this.getAnswers=function(){if(void 0!==n)return s},this.getAbortedRequests=function(){if(void 0!==n)return o.slice(l)},this.cancel=function(){p=!0,u||"function"==typeof e.cbOnComplete&&(e.cbOnComplete(g,p),u=!0),e.cbOnCancel&&"function"==typeof e.cbOnCancel&&e.cbOnCancel(g)},this.abort=function(){u||(p=!0)},this.start=function(){if(void 0!==e.requests&&Array.isArray(e.requests)&&(r=e.requests.length)>0&&(i=Math.floor(r/t),"string"==typeof e.requests[0]?(n=!1,s={},o=e.requests.filter((function(e,t,n){return n.indexOf(e)===t})),r=o.length):"object"==typeof e.requests[0]&&(n=!0,s=[],o=e.requests),void 0!==n))return l=0,(c=t-1)>=r&&(c=r-1),void this.process();"function"==typeof e.cbOnComplete&&e.cbOnComplete(g,p)},this.start()},replaceMassOperations:function(e){var t=this,n=e;return n.cbOnProcess=function(n,o){console.log("replaceMassOperations.cbOnProcess: size=",o.length);var s=!1;void 0===e.lockConnectionAsParent?void 0===(s=i.inheritParentLockStatusToChild())&&(s=!1):e.inheritParentLockStatusValue,t.replace({data:{version:e.version,bAllOrNothing:e.bAllOrNothing,lockConnectionAsParent:s,operations:o},timeout:6e5,modeler:e.modeler,onComplete:function(e){e="string"==typeof e?JSON.parse(e):e;for(var t=0,i=o.length;t<i;t++){var s=o[t],r={};if("success"===e.status&&e.results&&e.results[t])r=e.results[t];else{r={status:"failure"};var a=e.results[t];if(a){var l=[];if(void 0!==a.messages){var c=a.messages.length-1;l.push(a.messages[c])}else l.push("");a.parent?r.parent=a.parent:s.parent&&(r.parent=s.parent),a.oldInstance?r.oldInstance=a.oldInstance:s.oldInstance&&(r.oldInstance=s.oldInstance),r.messages=l,a.oldName?r.oldName=a.oldName:s.oldName&&(r.oldName=s.oldName),a.newName?r.newName=a.newName:s.newName&&(r.newName=s.newName)}else l=[""],s.parent&&(r.parent=s.parent),s.oldInstance&&(r.oldInstance=s.oldInstance),r.messages=l,s.oldName&&(r.oldName=s.oldName),s.newName&&(r.newName=s.newName)}n.setAnswer(s,r)}},onFailure:function(e,t){console.log("replaceMassOperations.onFailure");var i=void 0;try{var s=JSON.parse(t);s||(s=t),i=s.messages}catch(t){e.message&&"."!==(i=e.message)[i.length-1]&&(i+=".")}for(var r=0,a=o.length;r<a;r++){var l=o[r],c={},d=void 0,u=[];if(s&&s.results&&s.results[r]&&s.results[r].messages){var p=(d=s.results[r]).messages.length-1;u.push(d.messages[p])}else u=i;if(!u)return void n.setAnswer(l,{status:"failure"});c={status:"failure"},l.parent&&(c.parent=l.parent),l.oldInstance&&(c.oldInstance=l.oldInstance),c.messages=u,l.oldName&&(c.oldName=l.oldName),l.newName&&(c.newName=l.newName),n.setAnswer(l,c)}}})},new c.MassChunkedRequests(n)}};return c})),define("DS/AuthGenericCommands/commands/AuthGenericCmdReplaceProductConfiguration",["UWA/Class","DS/ApplicationFrame/Command","DS/AuthGenericCommands/AppContext","i18n!DS/AuthGenericCommands/assets/nls/AuthGenericCommandsCatalog.json","DS/AuthGenericCommands/AuthGenericCmdWSAccess","DS/AuthGenericCommands/AuthGenericCmdUtils","DS/AuthGenericCommands/views/AuthGenericReportPanel"],(function(e,t,n,i,o,s,r){"use strict";const a=sessionStorage.getItem("PSWEBR2Debeug");return e.extend(t,{defaultOptions:{},init:function(e){e.context&&n.setContext(e.context),this._parent(e,{mode:"exclusive",isAsynchronous:!0,chunkSize:30})},beginExecute:function(){var e=this;if(e.errors=[],e.neutrals=[],e.selectedNodes=n.getSelectedNodes(),e.selectedNodes.length){if(n.isThereARootSelected()){const t=i.SEL_002.split("\n");return n.displayNotification({title:t[0],msg:null!=t[1]?t[1]:"",eventID:"error"}),e.disable(),e.end&&e.end(),void e.done()}var t=n.getParentWithChild(e.selectedNodes);if(t&&0!==t.length)return n.displayNotification({title:i.ERR_ReplaceProductCconfiguration,msg:i.replace_latest_failed_child_selected,eventID:"error"}),e.disable(),e.end&&e.end(),void e.done();e.defaultOptions.isValidSelection(e.selectedNodes,(function(t){if(!1===t.status)return n.getNamesAsync(t.invalid,(function(e){for(var o=0,s=t.invalid.length;o<s;o++){var r=t.invalid[o];const s=i.replace(i.get("replace_unsupported_type"),{name:e[o],type:n.getType(r)}).split("\n");n.displayNotification({title:s[0],msg:null!=s[1]?s[1]:"",eventID:"error"})}})),e.disable(),e.end&&e.end(),void e.done();e.firstOneToken=!1,n.modalChooser({position:e.options.position?e.options.position:"above_action_bar",precond:e.defaultOptions.chooser.precondFilter,in_apps_callback:e._onSearchDone_Children.bind(e,this),multiSel:e.defaultOptions.chooser.multiSel})}))}e.options.position=void 0},_onSearchDone_Children:function(e,t){var n=this;if(t){if(!n.firstOneToken){n.firstOneToken=!0;var i=n._launchProductConfigurationChooser.bind(n);n._checkValidParentAndChildren(t,i)}}else n.end&&n.end(),n.done()},_checkValidParentAndChildren:function(e,t){var o=this;if(!n.getSelectedNodes().length)return 1===o.selectedNodes.length?n.displayNotification({eventID:"error",title:i.ERR_ReplaceProductCconfiguration,msg:i.replace(i.get("replace_unaccessible_objet"),{name:n.getName(o.selectedNodes[0])})}):(o.selectedNodes.forEach((function(e){o.errors.push(i.ERR_ReplaceProductCconfiguration+i.replace(i.get("replace_unaccessible_objet"),{name:n.getName(e)}))})),o.reportPanel=new r({title:o.options.reportTitle,success:[],failure:o.errors,neutral:[],aborted:[]})),o.end&&o.end(),void o.done();o.operations=[];var a=[];o.ordering=n.getOrdering(o.selectedNodes),o.replacer=e[0],o.defaultOptions.isValidReplacer(o.replacer,(function(e){if(!0===e){var l=o.replacer["ds6w:label"];n.getNamesAsync(o.selectedNodes,(function(e){for(var c=0,d=o.selectedNodes.length;c<d;c++){var u=o.selectedNodes[c],p=e[c],h=n.getInstance(u),g=o.replacer.resourceid;if(-1===a.indexOf(h)){a.push(h);var f=n.getReference(n.getParent(u));if(s.canInstantiate(f,[g])){var m={hasParent:f,instance:h,isInstanceOf:g,oldName:p,newName:l};o.operations.push(m)}else n.getNamesAsync([n.getParent(u)],(function(e){o.neutrals.push(i.replace(i.get("replace_unsupported_cycle"),{child:l,parent:e[0]}))}))}}o.operations.length>0?"function"==typeof t&&(n.beginBlockingTransaction(i.executing),t()):(o.errors.length+o.neutrals.length===1?1===o.errors.length?n.displayNotification({title:o.errors[0],eventID:"error"}):n.displayNotification({msg:o.neutrals[0],eventID:"warning"}):o.reportPanel=new r({title:o.options.reportTitle,success:[],failure:o.errors,neutral:o.neutrals,aborted:[]}),o.enable(),o.end&&o.end(),o.done())}))}else n.displayNotification({eventID:"error",title:i.ERR_ReplaceProductCconfiguration,msg:i.replace(i.get("replace_bad_replacer_type"),{name:o.replacer["ds6w:label"],type:o.replacer["ds6w:type"]})})}))},_launchProductConfigurationChooser:function(){var e=this;let t="",s="",r="";if(e.selectedNodes&&e.selectedNodes.length>0&&e.selectedNodes[0].options&&e.selectedNodes[0].options.grid&&(t=e.selectedNodes[0].options.grid["ds6w:status-original"]||e.selectedNodes[0].options.grid.currentObjectState),e.replacer&&(s=e.replacer["ds6w:status_value"]),t&&s&&t!=s){let o=n.getName(e.selectedNodes[0]),a=e.replacer["ds6w:label"];if(t.indexOf("EffectivityBasedItem")>=0?r=i.replace(i.get("replaceEBwithMB_failure"),{selectedProduct:o,replacedProduct:a}):s.indexOf("EffectivityBasedItem")>=0&&(r=i.replace(i.get("replaceMBwithEB_failure"),{selectedProduct:o,replacedProduct:a})),r.length>0){const t=r.split("\n");return n.displayNotification({title:t[0],subtitle:null!=t[1]?t[1]:"",msg:null!=t[2]?t[2]:"",eventID:"error"}),n.endBlockingTransaction(),e.end&&e.end(),void e.done()}}var l={data:{version:"1.2",pidList:[e.replacer.resourceid],modelMask:"Read",enabledCriteria:"YES",cfgCtxt:"YES",xRevisionContent:"YES",isUniqueInDB:"YES"},onComplete:function(t){var n=null;let i=null;var o="string"==typeof t?JSON.parse(t):t;if(o.version&&"1.2"===o.version)if(null!=o.xRevisionContent&&o.xRevisionContent.length>0){let t={referenceId:o.xRevisionContent[0].referencePID,referenceName:e.operations[0].newName};e._launchReferenceRevisionExplorer(t)}else o.contextInfo&&o.contextInfo.length>0&&(n="",i="",o.referencesInfo&&o.referencesInfo.length>0&&"YES"===o.referencesInfo[0].hasConfigContext&&"Explicit"===o.referencesInfo[0].revisionMode?o.contextInfo[0].evolutionPid&&(i=o.contextInfo[0].evolutionPid):o.contextInfo.forEach((function(e){e.content.results.forEach((function(e){n&&(n+=" OR "),n+=e.physicalID}))}))),i&&i.length>0?e._launchProductConfigurationChooser3(i):e._launchProductConfigurationChooser2(n)},onFailure:function(t,n){a&&console.log("getMultipleConfigurationContextInfo.onFailure, serverError :"+n),e._launchProductConfigurationChooser2(null)}};o.callWS(l,"/resources/modeler/configuration/navigationServices/getMultipleConfigurationContextInfo","POST",[])},_launchReferenceRevisionExplorer:function(e){var t=this;require(["DS/Windows/Dialog","DS/Controls/Button","DS/Windows/ImmersiveFrame","DS/CoreEvents/ModelEvents","DS/AuthGenericCommands/views/AuthCfgProductConfiguration","i18n!DS/AuthGenericCommands/assets/nls/AuthDlgRevisionUpdate.json"],(function(n,i,o,s,r,a){t.AuthCfgProductConfigurationObj=new r({referenceId:e.referenceId,referenceName:e.referenceName}),t.AuthCfgProductConfigurationObj.revisionSelectionEvents=new s;let l=new i({label:a.modalFooterReplace,onClick:function(){let e=t.AuthCfgProductConfigurationObj.selectedRevisionID,n="",i="";t.AuthCfgProductConfigurationObj&&""!==t.AuthCfgProductConfigurationObj.selectedPCID?(n=t.AuthCfgProductConfigurationObj.selectedPCID,i=" "+t.AuthCfgProductConfigurationObj.pcAutocomplete.selectedItems.options.grid.objlabel+" "+t.AuthCfgProductConfigurationObj.pcAutocomplete.selectedItems.options.grid.revision):t.AuthCfgProductConfigurationObj.pcAutocomplete&&t.AuthCfgProductConfigurationObj.pcAutocomplete.selectedItems&&t.AuthCfgProductConfigurationObj.pcAutocomplete.selectedItems.options&&t.AuthCfgProductConfigurationObj.pcAutocomplete.selectedItems.options.grid&&""!==t.AuthCfgProductConfigurationObj.pcAutocomplete.selectedItems.options.grid.ID&&(n=t.AuthCfgProductConfigurationObj.pcAutocomplete.selectedItems.options.grid.ID,i=" "+t.AuthCfgProductConfigurationObj.pcAutocomplete.selectedItems.options.grid.objlabel+" "+t.AuthCfgProductConfigurationObj.pcAutocomplete.selectedItems.options.grid.revision),""!==n?t._onxRevision_ProductConfiguration({xRevisionId:e,pcID:n,pcName:i}):t._onxRevision_ProductConfiguration({xRevisionId:e}),t.referenceConfigurationDialog.immersiveFrame.getModel().elements.container.destroy(),t.referenceConfigurationDialog.immersiveFrame&&t.referenceConfigurationDialog.immersiveFrame.destroy()},className:"primary"}),c=new i({label:a.modalFooterCancel,onClick:function(){t.referenceConfigurationDialog.immersiveFrame.getModel().elements.container.destroy(),t.referenceConfigurationDialog.immersiveFrame&&t.referenceConfigurationDialog.immersiveFrame.destroy(),t.end&&t.end(),t.done()},className:"secondary"});var d=new o;d.inject(widget.body),t.referenceConfigurationDialog=new n({title:a.replaceProductConfigurationTitle,content:t.AuthCfgProductConfigurationObj.render(),immersiveFrame:d,resizableFlag:!0,closeButtonFlag:!0,modalFlag:!0,identifier:"ReplaceConfiguration",width:475,height:350,minHeight:256,minWidth:120,buttons:{Cancel:c,Ok:l}}),t.referenceConfigurationDialog.defaultButton.disabled=!0,t.AuthCfgProductConfigurationObj.revisionSelectionEvents.subscribe({event:"revisionSelectionInConfigurationDialog"},(()=>{t.referenceConfigurationDialog.defaultButton.disabled=!1}))})),n.endBlockingTransaction()},_onxRevision_ProductConfiguration:function(e){var t=this;let o=e.xRevisionId;t._xRevisionId=o;var s=e.pcID;s&&(t._productConfigurationId=s);var r=e.pcName;t._productConfigurationName=r||" ",n.beginBlockingTransaction(i.executing),t._processReplaceExisting()},_launchProductConfigurationChooser2:function(e){var t=this;if(null===e){const e=i.get("replacePC_noPCFound").split("\n");n.displayNotification({title:e[0],msg:null!=e[1]?e[1]:"",eventID:"error"})}else require(["DS/CfgBaseUX/scripts/CfgSearchConfiguration"],(function(n){a&&console.log("CFG ModelId:",e);var i=new n(!1),o=t._onSearchDone_ProductConfiguration.bind(t),s='(NOT current:"Inactive") AND (based_95_on_95_model_95_pid:'+e+")";i.activate("","Product Configuration","",o,"","",s)}));n.endBlockingTransaction()},_launchProductConfigurationChooser3:function(e){var t=this;require(["DS/CfgBaseUX/scripts/CfgSearchConfiguration"],(function(o){if(null===e){const e=i.get("insertPC_noPCFound").split("\n");n.displayNotification({title:e[0],msg:null!=e[1]?e[1]:"",eventID:"error"})}else{a&&console.log("CFG ModelVersionId:",e);var s=new o(!1),r=t._onSearchDone_ProductConfiguration.bind(t),l='(NOT current:"Inactive") AND (based_95_on_95_model_95_version_95_pid:'+e+")";s.activate("","Product Configuration","",r,"","",l)}n.endBlockingTransaction()}))},_onSearchDone_ProductConfiguration:function(e){var t=this;t._productConfigurationFromSearch=e[0],t._productConfigurationId=e[0].id,e[0]._attributes&&e[0]._attributes["ds6w:identifier_value"]?t._productConfigurationName=" "+e[0]._attributes["ds6w:identifier_value"]:t._productConfigurationName="",n.beginBlockingTransaction(i.executing),t._processReplaceExisting()},_processReplaceExisting:function(){for(var e=this,t=0,s=e.operations.length;t<s;t++)e._productConfigurationId&&(e.operations[t].productConfigurationId=e._productConfigurationId),e._xRevisionId&&(e.operations[t].xRevisionId=e._xRevisionId),e.operations[t].newName=e.operations[t].newName+e._productConfigurationName;var r={version:e.defaultOptions.version,bAllOrNothing:e.defaultOptions.bAllOrNothing,modeler:e.defaultOptions.modeler,chunkSize:e.options.chunkSize,requests:e.operations,cbOnProgress:e._replaceMass_OnProgress.bind(e),cbOnComplete:e._replaceMass_OnComplete.bind(e),cbOnAbort:e._replaceMass_OnAbort.bind(e),cbOnLastChunk:e._replaceMass_OnLastChunk.bind(e)};r.chunkSize<e.operations.length&&require(["DS/AuthGenericCommands/views/AuthGenericDlgProgressbar"],(function(t){e.progressbarDlg=new t({label:{progressBarMainTitle:i.executing,progressBarAbortAlert:i.abort_confirm_message,progressBarAlertTitle:i.confirm,modalFooterAbort:i.modalFooterAbort},events:{onAbort:function(){r.cbOnAbort()}}}),e.enable(),n.endBlockingTransaction(),e.end&&e.end(),e.done()})),e.replaceProcess=o.replaceMassOperations(r)},_replaceMass_OnAbort:function(){this.replaceProcess&&this.replaceProcess.abort()},_replaceMass_OnProgress:function(e){var t=this;t.progressbarDlg&&t.progressbarDlg.progressBar&&(t.progressbarDlg.progressBar.value=100*e)},_replaceMass_OnLastChunk:function(){this.progressbarDlg&&this.progressbarDlg.disableAbort()},_replaceMass_OnComplete:function(e){var t,o=this,a=[],l=[],c=o.errors,d=e.getAnswers(),u={action:"replace",operations:[],isProdConfig:!0};if(d.forEach((function(e){var r=e.answer;if("success"===r.status){var l={parent:r.parent,old:r.oldInstance,new:{reference:r.newReference,instance:r.newInstance},rootNode:r.parent};void 0!==o.ordering&&(l.ordering=o.ordering[r.oldInstance]),u.operations.push(l),t=i.replace(i.get("replace_report_success"),{oldName:r.oldName,newName:r.newName}),a.push(t)}else{var d={remapErrors:o.defaultOptions.remapErrors,name:r.oldName,type:null},p=s.buildErrorMessage(r.messages,d);"."===p&&r.messages&&(p=r.messages),t=r.oldName&&r.newName?i.replace(i.get("replace_report_failure2"),{oldName:r.oldName,newName:r.newName})+"\n"+p:r.oldName?i.replace(i.get("replace_report_failure1"),{oldName:r.oldName})+"\n"+p:i.replace_error+"\n"+p;let a=n.getNodesById(e.request.hasParent);c.push(t.replace("{parent_object_title}",n.getName(a[0])))}})),e.getAbortedRequests().forEach((function(e){t=i.replace(i.get("replace_report_abort"),{oldName:e.oldName,newName:e.newName}),l.push(t)})),n.refresh(u),o.progressbarDlg?(o.progressbarDlg.destroy(),o.progressbarDlg=void 0):n.endBlockingTransaction(),a.length+c.length+o.neutrals.length+l.length===1)if(1===a.length)n.displayNotification({msg:a[0],eventID:"primary"});else if(1===c.length){let e=c[0].split("\n");n.displayNotification({title:e[0],msg:null!=e[1]?e[1]:"",eventID:"error"})}else 1===o.neutrals.length&&n.displayNotification({msg:o.neutrals[0],eventID:"warning"});else o.reportPanel=new r({title:o.options.reportTitle,success:a,failure:c,neutral:o.neutrals,aborted:l});o.enable(),n.endBlockingTransaction(),o.end&&o.end(),o.done()}})})),define("DS/AuthGenericCommands/commands/AuthGenericCmdUpdateRevOnEntireStructure",["UWA/Class","DS/ApplicationFrame/Command","DS/AuthGenericCommands/AppContext","DS/AuthGenericCommands/AuthGenericCmdWSAccess","UWA/Core","DS/AuthGenericCommands/views/AuthGenericDlgUpdateRevOnEntireStructure","i18n!DS/AuthGenericCommands/assets/nls/AuthGenericCommandsCatalog.json"],(function(e,t,n,i,o,s,r){"use strict";return e.extend(t,{defaultOptions:{modeler:"product"},init:function(e){this.hasRequestedPADSession=!1,this.PADSession=null,e.context&&n.setContext(e.context),this._parent(e,{mode:"exclusive",isAsynchronous:!1,chunkSize:30,chunkSizeNav:100}),localStorage.getItem("PADAuthoringDebug")&&(this.options.debugMode=!0)},beginExecute:function(){var e=this;e.disable(),e._confirmed=!1;var t=n.getSelectedNodes();e.selectedNodes=t,t.length?e.defaultOptions.isValidSelection(t,(function(t){if(!1===t.status){for(var i=0,o=t.invalid.length;i<o;i++){var s=t.invalid[i],a="",l=n.getName(s.node);"BADTYPE"===s.why&&(a=r.replace(r.get("selection_unsupported_type"),{name:l,type:n.getType(s.node)})),n.displayNotification({title:r.BAD_SELECTION,msg:a,eventID:"warning"})}e.enable()}if(t.valid.length>0){var c=[];t.valid.forEach((function(e){c.push([e.options.resourceid])}));var d={pathsArray:c};widget&&n._is2DContext()?e._getPADSession().then((function(t){var n=!0;t&&(n=t.determineAuthoredFlag()),!0===e.options.debugMode&&(e.tStartApp=performance.now()),e.launchGetOperationsList(d,n)})):e.launchGetOperationsList(d,!0)}})):(this.end&&this.end(),this.done())},launchGetOperationsList:function(e,t){var s=this,a=[];e.pendingPaths&&e.pendingPaths.length>0&&(a=e.pendingPaths),e.pathsArray&&e.pathsArray.length>0&&e.pathsArray.forEach((function(e){a.push(e)})),a.length>s.options.chunkSizeNav?e.pathsArray=a.splice(0,s.options.chunkSizeNav):(e.pathsArray=a,a=[]),a.length>0?e.pendingPaths=a:delete e.pendingPaths,e.version="1.0",e.authored=t,e.expand3DShape=!0,e.expandDrawing=!0,!0===s.options.debugMode&&(e.PADAuthoringDebug=!0),!0===s.options.debugMode&&(console.log("Update Revisions on Entire Structure on :"),console.log("data:"+JSON.stringify(e))),!0===s.options.debugMode&&(console.log("AuthGenericCmdUpdateRevOnEntireStructure /resources/[modeler]/navigation/getoperationslist"),s.tStart=performance.now()),n.beginBlockingTransaction(r.replace(r.get("analyzing"),{level:Math.floor(e.pathsArray[0].length/3+1)})),i.getoperationslist({data:e,modeler:s.options.modeler,timeout:6e5,onComplete:function(i){!0===s.options.debugMode&&console.log("WS getoperationslist.onComplete");var a=o.is(i,"string")?JSON.parse(i):i;if(!0===s.options.debugMode&&(console.log("WS getoperationslist success: "+i),s.tEnd=performance.now(),console.log("[timestamp] Get Intension on level : "+(s.tEnd-s.tStart)+" ms"),s.getIntentionTimeStamp=s.tEnd-s.tStart),a.pathsArray&&a.pathsArray.length>0||e.pendingPaths&&e.pendingPaths.length>0)s.launchGetOperationsList(a,t);else{var l=a.operations;!0===s.options.debugMode&&(s.tStopApp=performance.now(),console.log("[timestamp] Get Intension total: "+(s.tStopApp-s.tStartApp)+" ms"),s.getIntentiontotTimeStamp=s.tStopApp-s.tStartApp),l.confirmations&&l.confirmations.length>0?l.createList.length>0?s._launchLoadConfigInfo(s._getCreationListId(l.createList),(function(e){!0===s.options.debugMode&&console.log("WS _launchLoadConfigInfo.onComplete"),!0===s.options.debugMode&&(s.tEnd=performance.now(),console.log("[timestamp] _launchLoadConfigInfo : "+(s.tEnd-s.tStart)+" ms"),s._launchLoadConfigInfoTimeStamp=s.tEnd-s.tStart),e&&s._LaunchConfirmation(s._updateoperationsWithConfig(l,e))})):s._LaunchConfirmation(l):(l.addRoot,l.addRoot.length>0?n.addRoot({pids:l.addRoot},void 0,!0):(n.displayNotification({msg:r.structure_already_latest,eventID:"primary"}),s._closeCommand())),n.endBlockingTransaction()}},onFailure:function(e,t){s.options.debugMode&&console.log("createRevisionFailure, networkError :"+e+", serverError :"+t),n.endBlockingTransaction(),n.displayNotification({title:s.options.commandName,msg:r.error_internal,eventID:"error"}),s._closeCommand()},onTimeout:function(){n.endBlockingTransaction(),n.displayNotification({title:s.options.commandName,msg:r.error_timeout,eventID:"error"}),s._closeCommand()}})},getPADSessionPromise:function(){var e=this;return new o.Class.Promise((function(t,n){require(["DS/PADUtils/PADSession"],(function(n){e.hasRequestedPADSession=!0,e.PADSession=n,t(e.PADSession)}),(function(i){e.hasRequestedPADSession=!0,e.PADSession=null,t(e.PADSession),n()}))}))},_getPADSession:function(){return this.hasRequestedPADSession?o.Class.Promise.resolve(this.PADSession):this.getPADSessionPromise()},_setCmdAvailability:function(e){!0===e?this.enable():!1===e&&this.disable()},_LaunchConfirmation:function(e){var t=this;t.confirmationDlg=new s({title:t.options.confirmationTitle,operations:e,onCofirm:t._launchIntention.bind(t,e),enableCmdOnClose:t._closeCommand.bind(t)}),t.confirmationDlg._dialog.addEventListener("close",t._closeConfirm.bind(this))},_closeConfirm:function(){this._confirmed||this._closeCommand()},_closeCommand:function(){this._setCmdAvailability(!0),this.end&&this.end(),this.done()},_launchIntention:function(e){this._confirmed=!0,e.createList.length>0?(n.beginBlockingTransaction(r.revising),e.replaceNeutralList=[],this._launchNewRevision(e)):e.replaceList.length>0&&this._launchReplace(e)},_launchNewRevision:function(e){for(var t=this,n=[],o=[],s=0;s<e.createList.length;s++)(n=[]).push({semantic:"LAST",id:e.createList[s].physicalid}),o.push({copyId:e.createList[s].physicalid,ancestors:n,options:{withPost:!0}}),e.createList[s].status="pending";!0===t.options.debugMode&&(console.log("AuthGenericCmdRevisionUpdate /resources/v1/dslc/addversions size: "+n.length),t.tStart=performance.now());var r={data:JSON.stringify({addRequests:o}),timeout:6e5,onComplete:t._createRevisionComplete.bind(t,e),onFailure:t._createRevisionFailure.bind(t,e),onTimeout:t._createRevisionFailure.bind(t,e)};i.callWS(r,"/resources/v1/dslc/addversions","POST",!1,!0)},_createRevisionFailure:function(e,t,n){var i=0;for(this.options.debugMode&&console.log("createRevisionFailure, networkError :"+t+", serverError :"+n),i=0;i<e.createList.length;i++){"pending"===e.createList[i].status&&(e.createList[i].status="failed");for(var o=0;o<e.replaceList.length;o++)e.replaceList[o].isInstanceOf===e.createList[i].physicalid&&(e.replaceNeutralList.push({status:"neutral",oldName:e.replaceList[o].oldName}),e.replaceList.splice(o,1),0!==o&&o!==e.replaceList.length||o--)}e.replaceList.length>0&&this._launchReplace(e)},_createRevisionComplete:function(e,t){var n=0,i=0,o=this,s=e.replaceList;!0===o.options.debugMode&&(o.tEnd=performance.now(),console.log("[timestamp] create_revision: "+(o.tEnd-o.tStart)+" ms"),this.createRevisionTimeStamp=o.tEnd-o.tStart),(t="string"==typeof t?JSON.parse(t):t).errorMessage?o._createRevisionFailure(e,"",t.errorMessage):(t.addRequests&&t.addRequests.length>0&&(t.addRequests.forEach((function(t){for(n=0;n<e.createList.length;n++)for(e.createList[n].physicalid===t.copyId&&(e.createList[n].status="success",e.createList[n].newName+=t.code,e.createList[n].newRevision=t.code,e.createList[n].id=t.id),i=0;i<e.replaceList.length;i++)e.replaceList[i].hasParent===t.copyId&&(s[i].hasParent=t.id),"success"===e.createList[n].status&&e.replaceList[i].isInstanceOf===t.copyId&&-1!==e.createList[n].instancesOfHimself.indexOf(e.replaceList[i].instance)&&(s[i].isInstanceOf=t.id,s[i].newName+=t.code),e.replaceList[i].instance===t.copyId&&(s[i].instance=t.id)})),e.replaceList=s),e.replaceList.length>0&&o._launchReplace(e))},_launchReplace:function(e){var t=this,o={version:t.options.version,bAllOrNothing:t.options.bAllOrNothing,modeler:t.options.modeler,chunkSize:t.options.chunkSize,requests:e.replaceList,cbOnComplete:t._intention_OnComplete.bind(t,e),cbOnProgress:t._replaceMass_OnProgress.bind(t),cbOnAbort:t._replaceMass_OnAbort.bind(t),cbOnLastChunk:t._replaceMass_OnLastChunk.bind(t)};o.chunkSize<e.replaceList.length?(n.endBlockingTransaction(),require(["DS/AuthGenericCommands/views/AuthGenericDlgProgressbar"],(function(e){t.progressbarDlg=new e({label:{progressBarMainTitle:r.updating,progressBarAbortAlert:r.abort_confirm_message,progressBarAlertTitle:r.confirm,modalFooterAbort:r.modalFooterAbort},events:{onAbort:function(){o.cbOnAbort()}}})}))):n.beginBlockingTransaction(r.updating),t.tStart=null,!0===t.options.debugMode&&(t.tStart=performance.now()),t.replaceProcess=i.replaceMassOperations(o)},_replaceMass_OnAbort:function(){this.replaceProcess&&this.replaceProcess.abort()},_replaceMass_OnProgress:function(e){var t=this;t.progressbarDlg&&t.progressbarDlg.progressBar&&(t.progressbarDlg.progressBar.value=100*e)},_replaceMass_OnLastChunk:function(){this.progressbarDlg&&this.progressbarDlg.disableAbort()},_intention_OnComplete:function(e,t){var i=this;require(["DS/AuthGenericCommands/views/AuthGenericReportPanel","DS/AuthGenericCommands/AuthGenericCmdUtils"],(function(o,s){var a,l=[],c=[],d=[],u=[],p=[],h=[],g=[],f=[],m=[];t&&(f=t.getAnswers(),m=t.getAbortedRequests()),!0===i.options.debugMode&&(i.tEnd=performance.now(),console.log("[timestamp] replace: "+(i.tEnd-i.tStart)+" ms"),i.replaceTimeStamp=i.tEnd-i.tStart,console.log(i.getIntentiontotTimeStamp+"|"+i.createRevisionTimeStamp+"|"+i.replaceTimeStamp));var v={action:"replace",operations:[]};e.createList&&e.createList.forEach((function(e){"success"===e.status&&(a=r.replace(r.get("NewRevision_report_success"),{oldName:e.oldName,newName:e.newName}),h.push(e.physicalid),g.push({existing:e.physicalid,new:e.id,newRevison:e.newRevision}),"CreateNewRevision"===e.type&&p.push(e.id),l.push(a)),"failed"===e.status&&(a=r.replace(r.get("NewRevision_report_failure"),{oldName:e.oldName}),c.push(a)),"aborted"===e.status&&(a=r.replace(r.get("NewRevision_report_abort"),{oldName:e.oldName}),u.push(a)),"neutral"===e.status&&(a=r.replace(r.get("NewRevision_report_neutral"),{oldName:e.oldName}),d.push(a))})),e.replaceNeutralList&&e.replaceNeutralList.forEach((function(e){a=r.replace(r.get("replace_report_neutral"),{oldName:e.oldName}),d.push(a)})),e.addRoot,e.addRoot.length>0&&n.addRoot({pids:e.addRoot},void 0,!0),f&&f.forEach((function(e){var t=e.answer;if("success"===t.status)v.operations.push({parent:t.parent,old:t.oldInstance,new:{reference:t.newReference,instance:t.newInstance},rootNode:t.parent}),a=r.replace(r.get("replace_report_success"),{oldName:t.oldName,newName:t.newName}),l.push(a);else{var o={remapErrors:i.options.remapErrors,name:t.oldName,type:null},d=s.buildErrorMessage(t.messages,o);a=r.replace(r.get("replace_report_failure1"),{oldName:t.oldName})+"\n"+d;let l=n.getNodesById(e.request.hasParent);c.push(a.replace("{parent_object_title}",n.getName(l[0])))}})),m&&m.forEach((function(e){a=r.replace(r.get("replace_report_abort"),{oldName:e.oldName,newName:e.newName}),u.push(a)})),v.operations.length>0&&n.refresh(v),p.length>0&&n.addRoot({pids:p},void 0,!0),g.length>0&&(n.refresh({action:"created",operations:g}),n.refresh({action:"updateRevision",operations:g})),i.progressbarDlg?(i.progressbarDlg.destroy(),i.progressbarDlg=void 0):n.endBlockingTransaction(),i.reportPanel=new o({title:i.options.reportTitle,success:l,failure:c,neutral:d,aborted:u})})),this.end&&this.end(),this.done()},_launchLoadConfigInfo:function(e,t){var n={data:{version:"1.0",pidList:e,modelMask:"Read",enabledCriteria:"YES",cfgCtxt:"YES"},onComplete:function(e){var n="string"==typeof e?JSON.parse(e):e;"function"==typeof t&&t(n.referencesInfo)},onFailure:function(e,n){"function"==typeof t&&t()},onTimeout:function(){"function"==typeof t&&t()}};i.callWS(n,"/resources/modeler/configuration/navigationServices/getMultipleConfigurationContextInfo","POST",[])},_getCreationListId:function(e){var t=[];return e.forEach((function(e){t.push(e.physicalid)})),t},_updateoperationsWithConfig:function(e,t){var n=this;return t.forEach((function(t){if("YES"===t.hasConfigContext){var i=n._getindexOp(t.pid,e.createList,"physicalid");-1!==i&&(e.createList.splice(i,1),e.replaceList=n._cleanList(t.pid,e.replaceList,"isInstanceOf"));var o=n._getindexOp(t.pid,e.confirmations,"physicalid");if(-1!==o)"newRevisionAndUpdate"===e.confirmations[o].operation&&(e.confirmations[o].operation="update")}})),e},_getindexOp:function(e,t,n){for(var i=0;i<t.length;i++)if(t[i][n]===e)return i;return-1},_cleanList:function(e,t,n){var i=[];return t.forEach((function(t){t[n]!==e&&i.push(t)})),i}})})),define("DS/AuthGenericCommands/commands/AuthGenericCmdUnparent",["UWA/Class","DS/ApplicationFrame/Command","DS/AuthGenericCommands/AppContext","DS/AuthGenericCommands/AuthGenericCmdWSAccess"],(function(e,t,n,i){"use strict";return e.extend(t,{defaultOptions:{},init:function(e){e.context&&n.setContext(e.context),this._parent(e,{mode:"exclusive",isAsynchronous:!0})},beginExecute:function(){var e=this;e._cache={};let t=[];e._uniqueInstances=[],e._badInstances=[],e._reportFailure=[],e._reportAborted=[],e._reportSuccess=[];var i=n.getSelectedNodes();if(!i.length)return e.end&&e.end(),void e.done();var o=[];i.forEach((function(i){var s=n.getInstance(i);o.includes(s)||t.push(i),o.push(s),e._cache[s]={node:i}}));var s=[];for(var r in e._cache)e._uniqueInstances.push(r),s.push(e._cache[r].node);e.listViewData=[],n.getParameterAsync(t,["ds6w:label","ds6wg:revision","type_icon_url"],e.listViewData,(function(t){let i,o,r=[];for(i=0,o=s.length;i<o;i++)r[i]=n.getParent(s[i]),e.listViewData[i].instanceId=e._uniqueInstances[i];n.getRevisionAsync(r,(function(t){for(i=0,o=t.length;i<o;i++)e.listViewData[i].Parent_Revision=t[i].Revision}))})),n.getInstanceNamesAsync(s,(function(t){var i,o,r;for(i=0,o=t.length;i<o;i++)r=e._uniqueInstances[i],e._cache[r].instanceName=t[i];var a=[];for(i=0,o=s.length;i<o;i++)a[i]=n.getParent(s[i]);n.getNamesAsync(a,(function(t){for(i=0,o=t.length;i<o;i++)r=e._uniqueInstances[i],e._cache[r].parentName=t[i];e._checkConfirmAndLaunch(s)}))}))},_checkConfirmAndLaunch:async function(e){var t=this,i=n.displayConfirmationOnRemove(),o=!!t._GetUserRole()&&await t._IsFrozenInstancePresent();void 0===i?"false"===localStorage.getItem(t.options.className+".displayConfirmMsg")&&0==o?t._checkSelection(e):t._launchConfirm({displayToggleCheckFlag:!0,CheckDetachRiskMsg:o,callback:function(n){n?t._checkSelection(e):(t.end&&t.end(),t.done())}}):!1===i&&0==o?t._checkSelection(e):t._launchConfirm({displayToggleCheckFlag:!1,CheckDetachRiskMsg:o,callback:function(n){n?t._checkSelection(e):(t.end&&t.end(),t.done())}})},_launchConfirm:function(e){var t=this;require(["DS/AuthGenericCommands/views/AuthGenericDlgConfirm","i18n!DS/AuthGenericCommands/assets/nls/AuthGenericCommandsCatalog.json"],(function(n,i){let o,s,r=t._uniqueInstances.length;if(0===r);else if(1===r){var a=t._uniqueInstances[0],l=t._cache[a].instanceName;o=i.unparent_confirm_message_single,o=o?o.replace(/{name}/g,l):o,s=i.unparent_confirm_title+" - "+l}else o=i.unparent_confirm_message_multiple,s=i.unparent_confirm_title+" - "+r+" objects";t.listViewData.length>1&&null==t.listViewData[0].Instance_Title&&t.listViewData.forEach((e=>{let n=e.instanceId;null!=n&&(e.Parent_Title=t._cache[n].parentName,e.Instance_Title=t._cache[n].instanceName)})),t._confirmModal=new n({className:t.options.className,renderTo:document.body,action:i.unparent_confirm_title,title:s,message:o,callback:e.callback,displayToggleCheckFlag:e.displayToggleCheckFlag,CheckDetachRiskMsg:e.CheckDetachRiskMsg,ProductList:t.listViewData})}))},_GetUserRole:function(){var e=!1,t=n.getSetting("securityContext");return null!=t&&(e=t.includes("ProjectAdministrator")||t.includes("VPLMAdmin")),e},_getFrozenInstanceData:async function(){var e=this;return new Promise(((t,n)=>{var o={data:{version:"1.0",rawInformation:"Yes",resources:e._uniqueInstances},onComplete:function(e){var n=JSON.parse(e).resources;t(n)},onFailure:function(e,t){n(t)},onTimeout:function(){console.warn("updateFacet.WS.onTimeout")}};i.callWS(o,"/resources/modeler/configuration/navigationServices/instancesBelongToFrozenEvolution","POST")}))},_IsFrozenInstancePresent:async function(){var e=await this._getFrozenInstanceData(),t=!1;for(var n of e)if("Yes"===n.isFrozenEvolution){t=!0;break}return t},_checkSelection:function(e){var t=this;require(["i18n!DS/AuthGenericCommands/assets/nls/AuthGenericCommandsCatalog.json"],(function(i){e.length&&t.defaultOptions.isValidSelection(e,(function(e){if(!1!==e.status)t._launchUnparent();else{for(var o="",s=0,r=e.invalid.length;s<r;s++){var a=e.invalid[s],l=n.getInstance(a),c="?";void 0!==t._cache[l]&&(c=t._cache[l].instanceName),o+=c,s!==r-1&&(o+=", ")}var d=i.replace(i.get("unparent_unsupported_object"),{name:o});n.displayNotification({title:d,eventID:"error"})}}))}))},_launchUnparent:function(){var e=this;require(["DS/AuthGenericCommands/views/AuthGenericDlgProgressbar","i18n!DS/AuthGenericCommands/assets/nls/AuthGenericCommandsCatalog.json"],(function(t,i){var o=e._uniqueInstances,s={requests:o,chunkSize:e.defaultOptions.chunkSize,cbOnProgress:e._detachMass_OnProgress.bind(e),cbOnComplete:e._detachMass_OnComplete.bind(e),cbOnAbort:e._detachMass_OnAbort.bind(e),cbOnLastChunk:e._detachMass_OnLastChunk.bind(e)};s.chunkSize<o.length?e._progressbarDlg=new t({label:{progressBarMainTitle:i.executing,progressBarAbortAlert:i.abort_confirm_message,progressBarAlertTitle:i.confirm,modalFooterAbort:i.modalFooterAbort},events:{onAbort:function(){s.cbOnAbort()}}}):n.beginBlockingTransaction(i.executing),e._detachProcess=e._detachMassOperations(s)}))},_detachMassOperations:function(e){var t=this,n=e,i=require("DS/AuthGenericCommands/AuthGenericCmdWSAccess");return n.cbOnProcess=function(e,n){var o={version:t.defaultOptions.version,bAllOrNothing:t.defaultOptions.bAllOrNothing,instances:n};i.unparent({data:o,modeler:t.defaultOptions.modeler,timeout:6e4,onComplete:function(i){t._handleWSSuccess(e,n,i)},onFailure:function(i,o){t._handleWSFailure(e,n,i,o)}})},new i.MassChunkedRequests(n)},_handleWSSuccess:function(e,t,n){var i=this,o="string"==typeof n?JSON.parse(n):n;require(["DS/AuthGenericCommands/AuthGenericCmdUtils","i18n!DS/AuthGenericCommands/assets/nls/AuthGenericCommandsCatalog.json"],(function(e,t){var n=o.results;Array.isArray(n)&&n.forEach((function(n){var o=n.instance;i._badInstances.push(o);let s=function(n,o){var s={remapErrors:i.defaultOptions.remapErrors},r=e.buildErrorMessage(n,s),a=t.replace(t.get("unparent_report_failure"),{instanceName:i._cache[o].instanceName,parentName:i._cache[o].parentName});a=a+"\n"+r;var l=new RegExp(t.unwanted_word_delete,"g");return a.replace(l,t.unwanted_word_replacer_delete)}(n.messages,o);i._reportFailure.push(s.replace("{parent_object_title}",i._cache[o].parentName))}))}));for(var s=0,r=t.length;s<r;s++){var a=t[s];e.setAnswer(a,void 0)}},_handleWSFailure:function(e,t,n,i){var o=this;require(["DS/AuthGenericCommands/AuthGenericCmdUtils","i18n!DS/AuthGenericCommands/assets/nls/AuthGenericCommandsCatalog.json"],(function(s,r){function a(e){var t=o._cache[e].instanceName,a=o._cache[e].parentName,l=r.replace(r.get("unparent_report_failure"),{instanceName:t,parentName:a});try{var c=JSON.parse(i);l+="\n"+s.buildErrorMessage(c.messages,{remapErrors:o.defaultOptions.remapErrors,name:t,type:null})}catch(e){l+="\n"+n.message}var d=new RegExp(r.unwanted_word_delete,"g");return l=l.replace(d,r.unwanted_word_replacer_delete)}for(var l=0,c=t.length;l<c;l++){var d=t[l];o._badInstances.push(d);let n=a(d);o._reportFailure.push(n.replace("{parent_object_title}",o._cache[d].parentName)),e.setAnswer(d,void 0)}}))},_detachMass_OnAbort:function(){this._detachProcess&&this._detachProcess.abort()},_detachMass_OnProgress:function(e){var t=this;t._progressbarDlg&&t._progressbarDlg.progressBar&&(t._progressbarDlg.progressBar.value=100*e)},_detachMass_OnLastChunk:function(){this._progressbarDlg&&this._progressbarDlg.disableAbort()},_detachMass_OnComplete:function(e,t){var i=this;require(["DS/AuthGenericCommands/AuthGenericCmdUtils","DS/AuthGenericCommands/views/AuthGenericReportPanel","i18n!DS/AuthGenericCommands/assets/nls/AuthGenericCommandsCatalog.json"],(function(t,o,s){i._progressbarDlg?(i._progressbarDlg.destroy(),i._progressbarDlg=void 0):n.endBlockingTransaction(),e.getAbortedRequests().forEach((function(e){var t=e,n=i._cache[t].instanceName,o=i._cache[t].parentName;i._badInstances.push(t);var r=s.replace(s.get("unparent_report_cancelled"),{instanceName:n,parentName:o});i._reportAborted.push(r)}));var r=function(e,t){for(var n in t){var i=t[n],o=e.indexOf(i);-1!==o&&e.splice(o,1)}return e}(i._uniqueInstances,i._badInstances);if(r.forEach((function(e){var t=i._cache[e].instanceName,n=i._cache[e].parentName,o=s.replace(s.get("unparent_report_success"),{instanceName:t,parentName:n});i._reportSuccess.push(o)})),1===i._reportSuccess.length+i._reportFailure.length+i._reportAborted.length){var a=i._reportSuccess.length>0,l=a?i._reportSuccess[0]:i._reportFailure[0],c=a?"primary":"error";if("error"===c){const e=l.split("\n");n.displayNotification({title:e[0],subtitle:null!=e[1]?e[1]:"",msg:e[2],eventID:c})}else n.displayNotification({msg:l,eventID:c})}else i.reportPanel=new o({title:i.options.reportTitle,success:i._reportSuccess,failure:i._reportFailure,neutral:[],aborted:i._reportAborted});n.refresh({action:"unparent",instances:r}),i.end&&i.end(),i.done()}))}})})),define("DS/AuthGenericCommands/Facets/ProductMechanicalBehaviorFacet",["UWA/Core","UWA/Class","UWA/Controls/Abstract","DS/EditPropWidget/facets/Common/FacetsBase","DS/Controls/Button","DS/AuthGenericCommands/AppContext","DS/AuthGenericCommands/AuthGenericCmdWSAccess","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/WAFData/WAFData","DS/WidgetServices/WidgetServices","i18n!DS/AuthGenericCommands/assets/nls/AuthGenericCommandsCatalog.json","DS/WebappsUtils/WebappsUtils","DS/Controls/Loader","DS/Controls/ModalContainer","DS/PlatformAPI/PlatformAPI"],((e,t,n,i,o,s,r,a,l,c,d,u,p,h,g,f)=>{"use strict";return t.extend(n,i,{CheckValidSelection(){return null!=this.getUniqueSelectedNodeID()},init(e){this._parent(e),this.buildView(e)},getSearchFilter:function(){let e="";return e="SOLIDWORKS"==this.extensionValue?'flattenedtaxonomies:"types/VPMReference" AND flattenedtaxonomies:"interfaces/PrdDeformableExtension" AND ([ds6w:cadMaster]:SOLIDWORKS)':"CATIAV5"==this.extensionValue?'flattenedtaxonomies:"types/VPMReference" AND flattenedtaxonomies:"interfaces/PrdDeformableExtension" AND ([ds6w:cadMaster]:CATIAV5)':'flattenedtaxonomies:"types/VPMReference" AND flattenedtaxonomies:"interfaces/PrdDeformableExtension" AND ([ds6w:cadMaster]:3DEXPERIENCE)',e},_launchModalChooser(){let e=this;s.modalChooser({position:e.options.position?e.options.position:"above_action_bar",precondition:e.getSearchFilter(),source:["3dspace"],in_apps_callback:e._onSearchDone.bind(e,this)})},_publishRefreshEvent:function(e){f.publish("DS/PADUtils/PADCommandProxy/refresh",{data:{authored:{modified:[e],fromFacet:!0}}})},_onSearchDone(e,t){let n=this;if(t){let e=t[0].id;null!=e&&(n.AccociateddeformableId=e),n._onOKButtonClicked(u.deformed,t[0]["ds6w:label"])}else n.end()},_GetErroMessage:e=>e.includes("No modify access")||e.includes("An internal server error occurred")?u.deformability_Facet_Error:e,_DisplayNotifications(e,t,n){"error"===e?s.displayNotification({title:t+this.productName,subtitle:n,msg:"",eventID:e}):s.displayNotification({msg:t,level:e})},async _UnsetDeformedStatus(){let e=this,t={data:{references:[this.getUniqueSelectedNodeID()]},onComplete:function(t){"failure"==JSON.parse(t).results[0].status?e._DisplayNotifications("error",u.deformability_Change_failed,e._GetErroMessage(JSON.parse(t).results[0].message)):(e.updateRigidButton(),e._DisplayNotifications("success",u.deformability_success_message+u.rigid),e._publishRefreshEvent(e.getUniqueSelectedNodeID()))},onFailure:function(e,t){console.warn("_UnsetDeformedStatus.WS.onFailure")},onTimeout:function(){console.warn("_UnsetDeformedStatus.WS.onTimeout")}};r.callWS(t,"/resources/product/authoring/UnsetDeformed","POST",[],!0)},_onOpenButtonClicked(){let e=this,t=this.options.appContext.i18nManager.app.core;null!=t&&t.navigate("engItem_View",{pid:e.AccociateddeformableId},{replace:!1,reload:!0})},async _onOKButtonClicked(e,t){let n=this;if(e==u.deformable){let e={data:{references:[this.getUniqueSelectedNodeID()]},onComplete:function(e){"failure"==JSON.parse(e).results[0].status?n._DisplayNotifications("error",u.deformability_Change_failed,n._GetErroMessage(JSON.parse(e).results[0].message)):(n.updateDeformableButton(),n._DisplayNotifications("success",u.deformability_success_message+u.deformable),n._publishRefreshEvent(n.getUniqueSelectedNodeID()))},onFailure:function(e,t){console.warn("_onOKButtonClicked.WS.onFailure")},onTimeout:function(){console.warn("_onOKButtonClicked.WS.onTimeout")}},t="POST",i="/resources/product/authoring/SetDeformable",o=[];r.callWS(e,i,t,o,!0)}if(e==u.deformed){let e={data:{Deformed:[this.getUniqueSelectedNodeID()],Deformable:[this.AccociateddeformableId]},onComplete:function(e){if("failure"==JSON.parse(e).results[0].status)n._DisplayNotifications("error",u.deformability_Change_failed,n._GetErroMessage(JSON.parse(e).results[0].message));else if(null!=n.AccociateddeformableId){let e=n.elements.Associate_DeformableContainer;null==e&&n._createAssociateDeformableSection(),n.elementAssociatedDeformableValue.setText(t),n.ProductDeformabilityValue.setText(u.deformed),e.style.visibility="visible",n.OpenDeformableButton.disabled=!1,n.SelectDeformableButton.disabled=!1,n.SetAsDeformedButton.label=u.set_as_rigid;let i=n.elements.DeformedListContainer;null!=i&&(i.style.visibility="hidden"),n._DisplayNotifications("success",u.deformability_success_message+u.deformed),n._publishRefreshEvent(n.getUniqueSelectedNodeID())}},onFailure:function(e,t){console.warn("_onOKButtonClicked.WS.onFailure")},onTimeout:function(){console.warn("_onOKButtonClicked.WS.onTimeout")}},i="POST",o="/resources/product/authoring/SetDeformed",s=[];r.callWS(e,o,i,s,!0)}},_onRigidButtonClicked(){this._UnsetDeformedStatus()},_onDeformedButtonClicked(){this.SetAsDeformedButton.label==u.set_as_rigid?this._onRigidButtonClicked():1==this.IsEINPresent?this._createWarningDialog(u.deformed,u.deformed_confirm_Warnning_1,u.deformed_EIN_Warning):this._launchModalChooser()},_createWarningDialog(t,n,i){let s=this,r=new a({}),c=[new o({domId:"idConformDeformableButton",label:t,visibleFlag:!0,emphasize:"primary",onClick:function(){s.myDialog.close(),!0===s.IsEINPresent&&s.myDialog.customButtonsDefinition[0].label===u.deformed?s._launchModalChooser():s._onOKButtonClicked(u.deformable)}}),new o({domId:"idCancelDeformableButton",label:u.insertNewDeformed_CancelBtn,visibleFlag:!0,onClick:function(){s.myDialog.close()}})],d=e.Element("div",{class:"iDeformableDlgConfirm_modal"}),h=p.getWebappsAssetUrl("AuthGenericCommands","icons/I_Warning.png");e.createElement("img",{src:h,class:"iTypeWarningIcon"}).inject(d);e.Element("div",{class:"iDeformableInformationMsg",html:"<p><b>"+n+"</b><br>"+i+"</p>"}).inject(d);this.myDialog=new l({immersiveFrame:r,title:u.deformable_confirm_title+s.productName,content:d,activeFlag:!1,customButtonsDefinition:c,position:{offsetX:260},width:425,height:130,modalFlag:!0}),r.inject(document.body)},_onDeformableButtonClicked(){this._createWarningDialog(u.set_deformable,u.deformable_confirm_Warnning_1,u.deformable_confirm_Warnning_2)},buildView(t){this.elements.container=e.createElement("div",{class:"iProductMechanicalBehvoirFacet_Body"}),this.elements.ProductDeformabilityValueContainer=e.createElement("div",{class:"iProductMechanicalBehvoirFacet_header"}).inject(this.elements.container),this.elements.container1_1=e.createElement("div",{class:"iProductMechanicalBehvoirFacet_header_1"}).inject(this.elements.ProductDeformabilityValueContainer),e.createElement("h5",{html:{text:u.product_deformability}}).inject(this.elements.container1_1),this.ProductDeformabilityValue=e.createElement("h6",{html:{text:u.rigid},styles:{color:"gray"}}).inject(this.elements.container1_1),this.elements.container1_2=e.createElement("div",{class:"iProductMechanicalBehvoirFacet_header_2"}).inject(this.elements.ProductDeformabilityValueContainer),this.SetAsDeformedButton=new o({domId:"idSetAsDeformedButton",label:u.set_as_deformed,visibleFlag:!0,disabled:!1}).inject(this.elements.container1_2),this.SetAsDeformableButton=new o({domId:"idSetAsDeformableButton",label:u.set_as_deformable,visibleFlag:!0,disabled:!1}).inject(this.elements.container1_2),this.SetAsDeformedButton.addEventListener("buttonclick",function(){this._onDeformedButtonClicked()}.bind(this)),this.SetAsDeformableButton.addEventListener("buttonclick",function(){this._onDeformableButtonClicked()}.bind(this)),this._createAssociateDeformableSection(),this._createDeformedListContainer()},_createAssociateDeformableSection(){this.elements.Associate_DeformableContainer=e.createElement("div",{class:"iProductMechanicalBehvoirFacet_Button"}).inject(this.elements.container),this.elements.container2_1=e.createElement("div",{class:"iProductMechanicalBehvoirFacet_Associate_Deformable"}).inject(this.elements.Associate_DeformableContainer),this.elementAssociatedDeformable=e.createElement("h5",{html:{text:u.associated_deformable}}).inject(this.elements.container2_1),this.elementAssociatedDeformableValue=e.createElement("h6",{html:{text:" "},styles:{color:"gray"}}).inject(this.elements.container2_1),this.elements.container2_2=e.createElement("div",{class:"iProductMechanicalBehvoirFacet_Button_1"}).inject(this.elements.Associate_DeformableContainer),this.SelectDeformableButton=new o({domId:"idSelectDeformableButton",label:u.replace_deformable,visibleFlag:!0,disabled:!1}).inject(this.elements.container2_2),this.OpenDeformableButton=new o({domId:"idOpenDeformableButton",label:u.open_deformable,visibleFlag:!0,disabled:!1}).inject(this.elements.container2_2),this.OpenDeformableButton.addEventListener("buttonclick",function(){this._onOpenButtonClicked()}.bind(this)),this.SelectDeformableButton.addEventListener("buttonclick",function(){this._SelectDeformableButton()}.bind(this))},_createDeformedListContainer(){this.elements.DeformedListContainer=e.createElement("div",{class:"iProductMechanicalBehvoirFacet_DeformedList"}).inject(this.elements.container),e.createElement("h5",{html:{text:u.deformed_list}}).inject(this.elements.DeformedListContainer)},_SelectDeformableButton(){this.UnSetDeformed=!0,this._launchModalChooser()},updateDeformedButton(){let e=this,t={data:{references:[this.getUniqueSelectedNodeID()]},onComplete:function(t){let n=JSON.parse(t).results[0].deformedFrom;if(null!=n){let t=n["PLMEntity.V_Name"];e.AccociateddeformableId=n.reference,e.elementAssociatedDeformableValue.setText(t),e.ProductDeformabilityValue.setText(u.deformed),e.SetAsDeformedButton.label=u.set_as_rigid}},onFailure:function(e,t){console.warn("updateFacet.WS.onFailure")},onTimeout:function(){console.warn("updateFacet.WS.onTimeout")}};r.callWS(t,"/resources/product/navigation/deformable/getDeformedFromReferences","POST");let n=this.elements.Associate_DeformableContainer;if(null==n)this._createAssociateDeformableSection();else{n.style.visibility="visible",this.SetAsDeformedButton.visibleFlag=!0,this.SetAsDeformableButton.visibleFlag=!0,this.SetAsDeformedButton.disabled=!1,this.SetAsDeformableButton.disabled=!1,this.OpenDeformableButton.disabled=!1,this.SelectDeformableButton.disabled=!1;let e=this.elements.DeformedListContainer;null!=e&&(e.style.visibility="hidden")}},updateUnreachableDeformable(){this.elementAssociatedDeformableValue.setText(u.unreachableDeformable),this.ProductDeformabilityValue.setText(u.deformed),this.SetAsDeformedButton.label=u.set_as_rigid,this.OpenDeformableButton.disabled=!0,this.SelectDeformableButton.disabled=!1;let e=this.elements.Associate_DeformableContainer;if(null==e)this._createAssociateDeformableSection();else{e.style.visibility="visible",this.SetAsDeformedButton.visibleFlag=!0,this.SetAsDeformableButton.visibleFlag=!0,this.SetAsDeformedButton.disabled=!1,this.SetAsDeformableButton.disabled=!1,this.OpenDeformableButton.disabled=!0,this.SelectDeformableButton.disabled=!1;let t=this.elements.DeformedListContainer;null!=t&&(t.style.visibility="hidden")}},_createTreeListView:function(e){let t=this;require(["DS/TreeModel/TreeDocument","DS/Tree/TreeListView"],(function(n,i){let o={apiVersion:2,resize:{columns:!0,rows:!0},selection:{nodes:!0,cells:!1,rowHeaders:!1,columnHeaders:!1,unselectAllOnEmptyArea:!0,toggle:!1,canMultiSelect:!1},enableScrollOnDrag:!0,columns:[{text:u.insertNewDeformed_Col_Name,dataIndex:"tree",isSortable:!0,isEditable:!1,isDraggable:!1},{text:u.insertNewDeformed_Col_Maturity,dataIndex:"maturity",isSortable:!1},{text:u.insertNewDeformed_Col_Revision,dataIndex:"revision",isSortable:!1},{text:u.insertNewDeformed_Col_Type,dataIndex:"type",isSortable:!1}]};if(null!=t._treeListView){let i=new n({});t._fillTreeNodeModel(i,e),t._treeListView.getManager().loadDocument(i)}else{t._treeListView=new i(o);let s=new n({});t._fillTreeNodeModel(s,e),t._treeListView.getManager().loadDocument(s),t._treeListView.inject(t.elements.DeformedListContainer)}}))},_fillTreeNodeModel:function(e,t){let n=this;require(["DS/TreeModel/TreeNodeModel"],(function(i){e.prepareUpdate();let o={PRIVATE:"Draft",IN_WORK:"In Work",FROZEN:"Frozen",RELEASED:"Released",OBSOLETE:"Obsolete"};t.forEach((function(t){let n=o[t.Maturity],s=null!=n?n:t.Maturity,r=new i({label:t.title,grid:{revision:t.revision,type:t.type,maturity:s}});e.addRoot(r)})),e.pushUpdate(),n._initialList=e.getRoots().slice()}))},updateDeformableButton(e){let t=this;t.ProductDeformabilityValue.setText(u.deformable);let n=this.elements.Associate_DeformableContainer;if(null!=n&&(n.style.visibility="hidden"),this.SetAsDeformedButton.visibleFlag=!1,this.SetAsDeformableButton.visibleFlag=!1,null!=e){let n={onComplete:function(e){let n=JSON.parse(e).results,i=t.elements.DeformedListContainer;n.length>0?(i.style.visibility="visible",t._createTreeListView(n)):i.style.visibility="hidden"},onFailure:function(e,t){console.warn("_runExpand.WS.onFailure")}},i="GET",o="/resources/product/deformable/"+e+"/GetDeformedReferences";r.callWS(n,o,i)}},updateRigidButton(){this.ProductDeformabilityValue.setText(u.rigid);let e=this.elements.Associate_DeformableContainer;null!=e&&(e.style.visibility="hidden"),this.SetAsDeformedButton.visibleFlag=!0,this.SetAsDeformableButton.visibleFlag=!0,this.SetAsDeformedButton.disabled=!1,this.SetAsDeformableButton.disabled=!1,this.SetAsDeformedButton.label=u.set_as_deformed;let t=this.elements.DeformedListContainer;null!=t&&(t.style.visibility="hidden")},updateXCADDataDeformabiltyInfo(){this.SetAsDeformedButton.disabled=!0,this.SetAsDeformableButton.disabled=!0,this.SelectDeformableButton.disabled=!0,this.OpenDeformableButton.disabled=!0,!0===this.isXCADExtensionPresent&&this._DisplayNotifications("warning",u.deformability_CAD_Warning+this.extensionValue)},encodeParameters(e){let t="";if(void 0!==e&&Array.isArray(e)){let n=e.length/2;for(let i=0;i<n;i++)t+=0===i?"?":"&",t+=e[2*i]+"="+e[2*i+1]}return encodeURI(t)},async finalizeWSCallAsync(e,t,n,i){let o,r=this;if(n=n||"",i=i||[],s.getSetting("tenant"))o=s.getSetting("tenant"),i.push("tenant"),i.push(o);else{o="OnPremise";let e=d.getTenantID();e&&0!==e.length&&(o=e),i.push("tenant"),i.push(o)}d.get3DSpaceUrlAsync({onComplete:function(o){let s=r.encodeParameters(i),a=o+t+n+s;return void 0!==e.data&&null!==e.data&&"object"==typeof e.data&&(e.data=JSON.stringify(e.data),"{}"===e.data&&(e.data=null)),c.authenticatedRequest(a,e)},platformId:o})},async checkExtensions(){return new Promise(((e,t)=>{let n=this,i={data:{lIds:[],relIDs:[],busIDs:[this.getUniqueSelectedNodeID()],plmparameters:"false",attributes:"true",navigateToMain:"true",readonly:"false",debug_properties:""},onComplete:function(t){let i=JSON.parse(t).results[0].data,o=i.filter((function(e){return"PLMEntity.V_Name"==e.path}));n.productName=o[0].value[0];let s=JSON.parse(t).results[0].extensions;if(null!=s){if(n.IsEINPresent=!1,n.isXCADExtensionPresent=!1,n.extensionValue="",null!=s.XCADExtension){n.isXCADExtensionPresent=!0;i.filter((function(e){"XCADExtension"==e.extension&&(n.extensionValue=e.value)}))}null!=s.EnterpriseExtension&&(n.IsEINPresent=!0)}else n.isXCADExtensionPresent=!1,n.IsEINPresent=!1,n.extensionValue="";e()},onFailure:function(e,n){t(e.message)},onTimeout:function(){t("Service Time out error")},method:"POST",headers:{Accept:"application/ds-json","Content-Type":"application/ds-json","Accept-Language":"en",SecurityContext:s.getSetting("securityContext")}};this.finalizeWSCallAsync(i,"/resources/v1/collabServices/attributes/op/read","",[])}))},IsXCADExtensionAllowed:function(){return"SOLIDWORKS"==this.extensionValue||"CATIAV5"==this.extensionValue},async updateDeformabilityInfo(){return new Promise(((e,t)=>{let n=this,i={data:{references:[this.getUniqueSelectedNodeID()]},onComplete:function(t){let i=JSON.parse(t).results[0].statusValue;"Deformable"==i?n.updateDeformableButton(n.getUniqueSelectedNodeID()):"Deformed"==i?n.updateDeformedButton():"UnreachableDeformable"==i?n.updateUnreachableDeformable():n.updateRigidButton(),1!=n.isXCADExtensionPresent||n.IsXCADExtensionAllowed()||n.updateXCADDataDeformabiltyInfo(),e()},onFailure:function(e,n){t(e.message)},onTimeout:function(){t("Service Time out error")}};r.callWS(i,"/resources/product/navigation/deformable/DeformedStatus","POST")}))},ShowHideContaniers(e){let t=this.elements.ProductDeformabilityValueContainer;null!=t&&(t.style.visibility=e);let n=this.elements.Associate_DeformableContainer;null!=n&&(n.style.visibility=e);let i=this.elements.DeformedListContainer;if(null!=i&&(i.style.visibility=e),"visible"==e){let e=this.elements.DeformableFacetWarnningMsg_;null!=e&&(e.style.visibility="hidden")}},createWarnningContainer(){let t=this.elements.DeformableFacetWarnningMsg_;null!=t?t.style.visibility="visible":this.elements.DeformableFacetWarnningMsg_=e.createElement("h3",{class:"iDeformableFacetWarnningMsg_",html:{text:u.deformability_Empty_Warning},styles:{color:"gray",position:"centre"}}).inject(this.elements.container)},_checkIsVPMReferenceTypeSelection:e=>"VPMReference"==e.options.type||null!=e.options.padgrid&&"ds6w:Part"==e.options.padgrid["ds6w:globalType"],getUniqueSelectedNodeID(){let e,t=!0;const n=[],i=this.options.appContext.contextManager.getXENTreeDocument().getSelectedNodes();if(i.length>0&&i.forEach((e=>{n.push(e.getID()),this._checkIsVPMReferenceTypeSelection(e)||(t=!1)})),!t)return;const o=[...new Set(n)];return 1===o.length?[e]=o:0===i.length&&1===this.options.appContext.contextManager.getSelectedNodes().length&&(e=this.options.appContext.contextManager.getSelectedNodes()[0].getID()),e},_mask:function(t,n){this.isMasked(t)&&this._unmask(t),t.addClassName("masked");const i=e.is(n,"string")?n:nlsKeys.get("loading");this.loader=new h({text:i,showButtonFlag:!1}),this.loader.on(i);const o=e.createElement("div",{class:"mask"});g.createModal(o,this.loader.elements.container),o.inject(t)},_unmask:function(e){const t=e.getElement(" > .mask");t&&(this.loader&&(this.loader.off(),this.loader.destroy(),this.loader=null),g.removeModal(t),t.destroy()),e.removeClassName("masked")},isMasked:function(e){return e.hasClassName("masked")},async updateFacet(){if(this.CheckValidSelection()){this._mask(this.elements.container,"Loading"),this.ShowHideContaniers("visible");try{await this.checkExtensions(),await this.updateDeformabilityInfo()}catch(e){this._DisplayNotifications("error",e)}this._unmask(this.elements.container)}else this.ShowHideContaniers("hidden"),this.createWarnningContainer()}})})),define("DS/AuthGenericCommands/views/AuthGenericTLVRevisionUpdate",["UWA/Core","UWA/Class","UWA/Class/Options","DS/Tree/TreeListView","DS/TreeModel/TreeDocument","DS/WebappsUtils/WebappsUtils","DS/AuthGenericCommands/AppContext","DS/Controls/ComboBox","DS/UIKIT/Spinner","DS/ENOXVersionExplorerController/VersionExplorerController","DS/ENOXVersionExplorerUtils/VersionExplorerSettings","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","DS/ENOXVersionExplorerViews/VersionExplorerModal","DS/WidgetServices/WidgetServices","DS/WebUAUtils/WebUAUtils","i18n!DS/AuthGenericCommands/assets/nls/AuthDlgRevisionUpdate.json"],(function(e,t,n,i,o,s,r,a,l,c,d,u,p,h,g,f){"use strict";return t.extend(n,{name:"GenericTLVRevisionUpdate",options:{},_treeListView:null,_isDataReady:!1,_isTreeListViewReady:!1,_isTreeDocumentReady:!1,_revisions:void 0,_myVersionExplorer:null,init:function(e){this._parent(e),this.setOptions(e),this._createTreeListView(e.renderTo)},_createTreeListView:function(e){var t=this,n={apiVersion:2,height:"auto",resize:{columns:!0,rows:!0},selection:{nodes:!0,rowHeaders:!1,columnHeaders:!1,unselectAllOnEmptyArea:!0,toggle:!1,canMultiSelect:!0,enableListSelection:!0,preSelection:!1},enableDragAndDrop:!1,enableScrollOnDrag:!1,enableTreeColumnEllipsisOverflow:!1,enableActiveUI:!0,enableKeyboardNavigation:!0,enableExpandOnDoubleClick:!0,keymaps:{"ctrl+a":"treelistview:select-all"},onContextualEvent:{callback:function(e){var n=[];if(e.treeview.cellModel&&!e.treeview.cellModel.options.isHeader){var i=e.treeview.nodeModel;if(i.isSelected()||i.select(!0),!i.isSelected())return;t._isTreeListMode()&&(n.push({type:"PushItem",title:f.SelectAllVisible,icon:"url("+s.getWebappsAssetUrl("AuthGenericCommands","icons/I_SelectAll.png")+")",action:{callback:t.options.cbOnSelectAllVisible.bind(this)}}),n.push({type:"PushItem",title:f.SelectChildren,icon:"url("+s.getWebappsAssetUrl("AuthGenericCommands","icons/I_SelectChildren.png")+")",action:{callback:t.options.cbOnSelectChildren.bind(this)}}),n.push({type:"PushItem",title:f.SelectLeaves,icon:"url("+s.getWebappsAssetUrl("AuthGenericCommands","icons/I_SelectLeaves.png")+")",action:{callback:t.options.cbOnSelectLeaves.bind(this)}}),t.options.getIsExpandable()&&(n.push({type:"PushItem",title:f.ExpandAll,icon:"url("+s.getWebappsAssetUrl("AuthGenericCommands","icons/I_ExpandAll.png")+")",action:{callback:t.options.cbOnExpandAll.bind(this)}}),n.push({type:"PushItem",title:f.ExpandNLevel,icon:"url("+s.getWebappsAssetUrl("AuthGenericCommands","icons/I_ExpansionLevel.png")+")",action:{callback:t.options.cbOnExpandNLevel.bind(this,e.infos.target.getOffsets())}}),n.push({type:"PushItem",title:f.CollapseAll,icon:"url("+s.getWebappsAssetUrl("AuthGenericCommands","icons/I_CollapseAll.png")+")",action:{callback:t.options.cbOnCollapseAll.bind(this)}}))),t.options.options.EnableCompare&&t.options.getIsComparable()&&n.push({type:"PushItem",title:f.CompareRevisions,icon:"url("+s.getWebappsAssetUrl("AuthGenericCommands","icons/I_Compare.png")+")",action:{callback:t.options.cbOnCompareRevisions.bind(this)}}),n.push({type:"PushItem",title:f.Replaceby,fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-part-replace"},state:!t._isDataReady||t._isTreeListMode()&&i.isRoot()&&1===t._treeListView.getDocument().getSelectedNodes().length?"disabled":"enabled",submenu:[{type:"PushItem",title:f.ReplaceActionLatest,action:{callback:function(){var e=t._treeListView.getDocument().getSelectedNodes();t._launchActions(e,f.ReplaceActionLatest)}}},{type:"PushItem",title:f.ReplaceActionLatestStable,action:{callback:function(){var e=t._treeListView.getDocument().getSelectedNodes();t._launchActions(e,f.ReplaceActionLatestStable)}}},{type:"PushItem",title:f.ReplaceActionLatestReleased,action:{callback:function(){var e=t._treeListView.getDocument().getSelectedNodes();t._launchActions(e,f.ReplaceActionLatestReleased)}}}]}),t.options.getIsResetable()&&n.push({type:"PushItem",title:f.ResetAction,icon:"url("+s.getWebappsAssetUrl("AuthGenericCommands","icons/I_ExecResetAll.png")+")",action:{callback:function(){var e=t._treeListView.getDocument();if(e){var n=[];e.withTransactionUpdate((function(){e.getSelectedNodes().forEach((function(e){e._options.grid.actionSelected&&e._options.grid.actionSelected!==f.ReplaceActionNone&&n.push(e)}))})),t.resetActions(n)}}}})}return n}},columns:[]};this.options.options.visibleColumn.ExpectedMaturity&&n.columns.unshift({text:f.TreeListViewHeaderMaturityPreview,dataIndex:"maturityPreview",width:"auto",isSortable:!1,isEditable:!1,isDraggable:!1}),this.options.options.visibleColumn.ExpectedRevision&&n.columns.unshift({text:f.TreeListViewHeaderRevisionPreview,dataIndex:"revisionPreview",width:102,isSortable:!1,isEditable:!1,isDraggable:!1,setValue:function(e){e.nodeModel.options.grid[e.dataIndex]=e.value,e.manager.updateRowViewWithException(e.nodeModel,e.dataIndex)}}),this.options.options.visibleColumn.ReplaceAction&&n.columns.unshift({text:f.TreeListViewHeaderAction,dataIndex:"action",width:192,isSortable:!1,isEditable:!0,isDraggable:!0,onCellRequest:function(e){if(!e.isHeader&&(!t._isTreeListMode()||!e.nodeModel.isRoot()||e.nodeModel.isRoot()&&t.options.options.EnableBubbleup)){var n=e.nodeModel.options.grid.action,i=e.cellView.reuseCellContent("action");if(i){i.disabled=!e.nodeModel.options.grid.isEnabled,i.elementsList=n,i.currentValue=e.nodeModel.options.grid.actionSelected,e.nodeModel.options.grid.actionComboBox=i;var o=t._getTooltipCandidates(e);e.cellView._setTooltip(e.cellView.elements.container,{longHelp:o})}}},setValue:function(){},onCellChange:function(e){var n=e.event.target.dsModel?e.event.target.dsModel.currentValue:e.event.ODTTarget.dsModel.currentValue;return t._launchAction(e.nodeModel,n),n}}),this.options.options.visibleColumn.Candidate&&n.columns.unshift({text:"",dataIndex:"candidate",width:40,minWidth:30,maxWidth:50,isSortable:!1,isEditable:!1,isDraggable:!0,onCellRequest:function(e){if(e.isHeader)e.cellView._setTooltip(e.cellView.elements.container,{longHelp:f.TreeListViewHeaderCandidate});else if(!t._isTreeListMode()||!e.nodeModel.isRoot()){var n,i=e.nodeModel._options.grid.candidate;i&&i.length>0?(n=e.cellView.reuseCellContent("candidateLoaded"))&&t._drawCandidate(n,i):n=e.cellView.reuseCellContent("candidateLoading");var o=t._getTooltipCandidates(e);e.cellView._setTooltip(e.cellView.elements.container,{longHelp:o})}}}),this.options.options.visibleColumn.Responsible&&n.columns.unshift({text:f.TreeListViewHeaderResponsible,dataIndex:"responsible",width:100,isSortable:!1,isEditable:!1,isDraggable:!0}),this.options.options.visibleColumn.Type&&n.columns.unshift({text:f.TreeListViewHeaderType,dataIndex:"type",width:100,isSortable:!1,isEditable:!1,isDraggable:!0}),this.options.options.visibleColumn.Maturity&&n.columns.unshift({text:f.TreeListViewHeaderMaturityCurrent,dataIndex:"maturityCurrent",width:100,isSortable:!1,isEditable:!1,isDraggable:!0}),this.options.options.visibleColumn.Revision&&n.columns.unshift({text:f.TreeListViewHeaderRevisionCurrent,dataIndex:"revisionCurrent",width:65,isSortable:!1,isEditable:!1,isDraggable:!0}),this.options.options.visibleColumn.Title&&n.columns.unshift({text:f.TreeListViewHeaderName,dataIndex:"tree",width:275,isSortable:!1,isEditable:!1,isDraggable:!0}),this._isTreeListMode()&&this.options.options.visibleColumn.IsModified&&n.columns.unshift({text:"",dataIndex:"isModified",width:30,minWidth:30,maxWidth:30,isSortable:!1,isEditable:!1,isDraggable:!0,onCellRequest:function(e){if(e.isHeader)e.cellView._setTooltip(e.cellView.elements.container,{longHelp:f.TreeListViewTooltipHeaderIsModified});else{var t=e.nodeModel._options.grid.isModified;if(t&&t.length>0){var n=e.cellView.reuseCellContent("isModified"),i=void 0;if(n){switch(t){case"yes_editable":i=s.getWebappsAssetUrl("AuthGenericCommands","icons/22/I_QuickInfo_20.png");break;case"yes_not_revisable":case"yes_revisable":i=s.getWebappsAssetUrl("AuthGenericCommands","icons/22/SWXUiWarningSymbol20.png");break;default:i=""}n.src=i}}var o="";"yes_editable"===e.nodeModel.options.grid.isModified?o=f.TreeListViewTooltipCellIsModifiedAvailable:"yes_revisable"===e.nodeModel.options.grid.isModified?o=f.TreeListViewTooltipCellIsModifiedForbidden:"yes_not_revisable"===e.nodeModel.options.grid.isModified&&(o=f.TreeListViewTooltipCellIsRevisionForbidden),o=o.replace("{objectName}",e.nodeModel.getLabel()),e.cellView._setTooltip(e.cellView.elements.container,{longHelp:o,moreHelpCB:function(){g.displayHelp({WebHelp:"EXP3DBasicsUserMap/base-m-access-roles-sb.htm"})},mouseRelativePosition:!1,position:"top"})}}}),this._treeListView=new i(n),this._treeListView.getManager().onReady((function(){t._isTreeListViewReady=!0,t.checkAndLaunchTreeNodeModelUpdate()})),this._registerAllReusableCellContent();var r=new o({shouldAcceptDrop:!1,shouldAcceptDrag:!1,shouldBeSelected:function(e){return e.options.grid.isEnabled}}),a=r.onUpdate((function(){this.removeEventListener(a),t._isTreeDocumentReady=!0,t.checkAndLaunchTreeNodeModelUpdate()}));this._fillTreeNodeModel(r),this._treeListView.getManager().loadDocument(r),this._treeListView.inject(e),this._treeListView.getDocument().getXSO().onChange(this.options.cbUpdateToolbarCommandsStatus.bind(this)),this.options.options.webInWin&&this._treeListView.getDocument().getXSO().onChange((function(e){e.options.grid.relationid&&t.options.options.cbUpdateWIWselection({isSelected:e.isSelected(),relationid:e.options.grid.relationid})}))},_getTooltipCandidates:function(e){var t=[];return e.nodeModel.options.grid.Latest&&t.push(f.ReplaceActionLatest),e.nodeModel.options.grid.LatestStable&&t.push(f.ReplaceActionLatestStable),e.nodeModel.options.grid.LatestReleased&&t.push(f.ReplaceActionLatestReleased),this.options.options.EnableByRevision&&t.push(f.ReplaceActionByRevision),(t.length>0&&!1!==e.nodeModel.options.isReplaceable?f.TreeListViewTooltipCellCandidateAvailable.replace("{candidateList}",t.join("\n")):f.TreeListViewTooltipCellCandidateNone).replace("{objectName}",e.nodeModel.getLabel())},_fillTreeNodeModel:function(e){var t=this;require(["DS/TreeModel/TreeNodeModel"],(function(n){var i=t.options.roots,o=[],s=[];e.prepareUpdate();var a=function(e){var i=r.getInstance(e),o=r.getReference(e),a=!1;s.indexOf(i)>=0&&(a=!0);var l={isModified:"",revisionCurrent:e.options.grid["ds6wg:revision"],revisionPreview:"",maturityCurrent:e.options.grid["ds6w:status"],maturityType:"",maturityPreview:"",type:e.options.grid["ds6w:type"],responsible:e.options.grid["ds6w:responsible"],candidate:"",action:"",relationid:i,physicalid:o,isEnabled:!0,hasOtherInstances:a};if(t.options.options.EnableBubbleup&&(l.configured=!1),void 0!==e.isReplaceable&&(l.isEnabled=e.isReplaceable),t._isFlatListMode()){var c=r.getParent(e);l.parent=r.getReference(c)}var d=[];return e.options.icons&&e.options.icons.length>0&&d.push(e.options.icons[0]),new n({label:e.options.label,badges:e.options.badges,icons:d,isReplaceable:e.isReplaceable,type:e.options.type,grid:l})},l=function(e,n){r.getChildren(n).forEach((function(n){if(-1!==t.options.validChildrenIDs.indexOf(r.getReference(n))&&!0!==n.isRelationsObjectNode){var i=a(n);e.addChild(i),-1!==t.options.valid3DShapeKindChildrenIDs.indexOf(i.options.grid.physicalid)&&(r.Is3DShapeAvailableForUpdateRevision()||i.hide()),-1!==t.options.validDrawingKindChildrenIDs.indexOf(i.options.grid.physicalid)&&(r.IsDrawAvailableForUpdateRevision()||i.hide()),n.isExpandable?n.isExpandable()&&l(i,n):n.isExpanded()&&l(i,n)}})),n.isExpanded()&&e.expandAll()};i.forEach((function(e){r.getAllDescendants(e).forEach((function(e){var t=r.getInstance(e);o.indexOf(t)>=0?s.push(t):o.push(t)}))})),i.forEach((function(n){var i=a(n);t._isTreeListMode()&&(l(i,n),i.expandAll()),e.addRoot(i)})),e.pushUpdate()}))},_isFlatListMode:function(){return"FlatList"===this.getOption("commandMode")},_isTreeListMode:function(){return"TreeList"===this.getOption("commandMode")},checkAndLaunchTreeNodeModelUpdate:function(e){e&&(this._revisions=e,this._isDataReady=!0),this._revisions&&this._isTreeListViewReady&&this._isTreeDocumentReady&&this._updateTreeNodeModel(this._revisions)},treeNodeModelUpdateRevisionNumberProposal:function(e){var t=this._treeListView.getDocument();t&&e&&t.withTransactionUpdate((function(){t._getTrueRoot().processDescendants({onlyVisibleNodes:!1,processNode:function(n){t.options.shouldBeSelected.call(t,n.nodeModel)&&e.forEach((function(e){n.nodeModel.options.grid.physicalid===e.copyId&&(n.nodeModel.options.grid.revisionsnumberproposal=e.code)}))}})}))},treeNodeModelUpdateConfigInfo:function(e){var t=this._treeListView.getDocument();t&&e&&t.withTransactionUpdate((function(){t._getTrueRoot().processDescendants({onlyVisibleNodes:!1,processNode:function(n){t.options.shouldBeSelected.call(t,n.nodeModel)&&e.forEach((function(e){n.nodeModel.options.grid.physicalid===e.pid&&(n.nodeModel.options.grid.configured="YES"===e.hasConfigContext)}))}})}))},_updateTreeNodeModel:function(e){var t=this.options,n=this._treeListView.getDocument(),i=function(e,n){var i={grid:{candidate:"None",action:[],actionSelected:""}};if(void 0!==n){0===e.options.icons.length&&n.CURRENT.icon&&(i.icons=[n.CURRENT.icon]);var o=function(e,n){var i={iconName:"None",actions:[]};return i.actions.push(f.ReplaceActionNone),e.isRoot()&&"FlatList"!==t.commandMode||(n.LATEST&&(i.iconName="Latest",i.actions.push(f.ReplaceActionLatest)),n.STABLE&&("None"===i.iconName?i.iconName="Stable":i.iconName+="+Stable",i.actions.push(f.ReplaceActionLatestStable)),n.RELEASED&&("None"===i.iconName?i.iconName="Released":i.iconName+="+Released",i.actions.push(f.ReplaceActionLatestReleased)),t.options.EnableByRevision&&i.actions.push(f.ReplaceActionByRevision),t.options.EnableBubbleup&&!e.options.grid.configured&&-1===t.valid3DShapeKindChildrenIDs.indexOf(e.options.grid.physicalid)&&-1===t.validDrawingKindChildrenIDs.indexOf(e.options.grid.physicalid)&&i.actions.push(f.ReplaceActionByNewRevision)),t.options.EnableBubbleup&&!e.options.grid.configured&&-1===t.valid3DShapeKindChildrenIDs.indexOf(e.options.grid.physicalid)&&-1===t.validDrawingKindChildrenIDs.indexOf(e.options.grid.physicalid)&&i.actions.push(f.CreateNewRevision),i}(e,n);i.grid={Latest:n.LATEST?n.LATEST:void 0,LatestStable:n.STABLE?n.STABLE:void 0,LatestReleased:n.RELEASED?n.RELEASED:void 0,candidate:!1!==e.options.isReplaceable?o.iconName:"None",action:!1!==e.options.isReplaceable?o.actions:[],actionSelected:!1!==e.options.isReplaceable?o.actions[0]:""},e.options.grid.revisionCurrent||(i.grid.revisionCurrent=n.CURRENT.revision),e.options.grid.maturityCurrent||(i.grid.maturityCurrent=n.CURRENT.maturityNLS),!e.options.grid.maturityType&&n.CURRENT&&(i.grid.maturityType=n.CURRENT.maturity),e.updateOptions(i)}else e.updateOptions(i)},o=function(t){var n=t.getChildren();n&&n.length>0&&n.forEach((function(t){var n=e[t._options.grid.physicalid];i(t,n),o(t)}))};n.prepareUpdate(),n.getRoots().forEach((function(t){var n=e[t._options.grid.physicalid];i(t,n),o(t)})),n.pushUpdate(),this.options.cbUnableReplaceAll()},_launchActions:function(e,t){var n=this,i=this._treeListView.getDocument(),o=0,s=e.length;i.withTransactionUpdate((function(){e.forEach((function(i){(!n._isTreeListMode()||!i.isRoot()||i.isRoot()&&n.options.options.EnableBubbleup)&&(-1!==i._options.grid.action.indexOf(t)&&n._launchAction(i,t)&&o++,n._isActionRequired(i)&&function(e,t){t.getAllDescendants().forEach((function(t){e.forEach((function(n,i){t===n&&e.splice(i,1)}))}))}(e,i))}))}));var a=void 0;a=(a=(a=(a=o===s?f.ReplaceMultiInfoSuccess:o>0?f.ReplaceMultiInfoPartial:f.ReplaceMultiInfoFailure).replace("{candidatesCount}",o)).replace("{selectedNodes}",s)).replace("{action}",t),r.displayNotification({msg:a,eventID:"primary"})},resetAction:function(e){this._launchAction(e,f.ReplaceActionNone)},resetActions:function(e){this._launchActions(e,f.ReplaceActionNone)},_launchAction:function(e,t){var n={};if(e._options.grid.action.indexOf(t)>=0){switch(t){case f.ReplaceActionNone:n.maturity="",n.revision="",n.newName="";break;case f.ReplaceActionLatest:n.maturity=e._options.grid.Latest?e._options.grid.Latest.maturityNLS:void 0,n.revision=e._options.grid.Latest?e._options.grid.Latest.revision:void 0,n.newName=e._options.grid.Latest?e._options.grid.Latest.displayName:void 0;break;case f.ReplaceActionLatestStable:n.maturity=e._options.grid.LatestStable?e._options.grid.LatestStable.maturityNLS:void 0,n.revision=e._options.grid.LatestStable?e._options.grid.LatestStable.revision:void 0,n.newName=e._options.grid.LatestStable?e._options.grid.LatestStable.displayName:void 0;break;case f.ReplaceActionLatestReleased:n.maturity=e._options.grid.LatestReleased?e._options.grid.LatestReleased.maturityNLS:void 0,n.revision=e._options.grid.LatestReleased?e._options.grid.LatestReleased.revision:void 0,n.newName=e._options.grid.LatestReleased?e._options.grid.LatestReleased.displayName:void 0;break;case f.ReplaceActionByNewRevision:case f.CreateNewRevision:n.maturity=f.MaturityNewRevision,n.revision=e._options.grid.revisionsnumberproposal?e._options.grid.revisionsnumberproposal:void 0,n.newName=e._options.label;break;case f.ReplaceActionByRevision:n.maturity="",n.revision="",n.newName="",void 0!==e._options.grid.physicalid&&this._launchVersionExplorer(e)}var i={maturityPreview:void 0!==n.maturity?n.maturity:e._options.grid.maturityPreview,revisionPreview:void 0!==n.revision?n.revision:"",actionSelected:e._options.grid.action.indexOf(t)>=0?t:e._options.grid.actionSelected,expectedNewName:void 0!==n.newName?n.newName:e._options.grid.expectedNewName};return t!==f.ReplaceActionByRevision&&this._updateNodesAfterAction(e,i),void 0!==n.revision}return!1},_updateNodesAfterAction:function(e,t){var n=this;this._getallSameNodes(e).forEach((function(e){e.updateOptions({grid:t});var i=n._isActionRequired(e);n._enableChildren(e,!i),i&&(n._clearParentsAction(e),n._enable(e,!0)),n.options.options.EnableBubbleup&&n._updateStatus(e),e.getParent()&&n._updateStatus(e.getParent()),n.options.cbActionAvailable()})),this.options.cbUpdateToolbarCommandsStatus()},_updateStatus:function(e){var t=!1,n=e.getChildren();if(n)for(var i=0;i<n.length;i++)if(n[i]._options.grid.actionSelected&&n[i]._options.grid.actionSelected!==f.ReplaceActionNone&&n[i]._options.grid.actionSelected!==f.CreateNewRevision&&e._options.grid.actionSelected!==f.CreateNewRevision){t=!0;break}var o="no";if(t)switch(e.options.grid.maturityType){case"OBSOLETE":o=e.options.grid.actionSelected===f.ReplaceActionByNewRevision||e.options.grid.actionSelected===f.CreateNewRevision?"yes_not_revisable":"yes_revisable";break;case"RELEASED":case"FROZEN":o=e.options.grid.actionSelected===f.ReplaceActionByNewRevision||e.options.grid.actionSelected===f.CreateNewRevision?"yes_editable":"yes_revisable";break;default:o="yes_editable"}"OBSOLETE"!==e.options.grid.maturityType||e.options.grid.actionSelected!==f.ReplaceActionByNewRevision&&e.options.grid.actionSelected!==f.CreateNewRevision||(o="yes_not_revisable"),e.updateOptions({grid:{isModified:o}}),e.options.grid.actionComboBox&&e.options.grid.actionComboBox.elements&&e.options.grid.actionComboBox.elements.container.attributes.focused&&e.options.grid.actionComboBox.elements.container.attributes.removeNamedItem("focused")},_getallSameNodes:function(e){if(this._isFlatListMode())return[e];for(var t=[],n=e._options.grid.relationid,i=this._treeListView.getDocument().getRoots(),o=0;o<i.length;o++){var s=i[o].getAllDescendants();if(s&&s.length>0)for(var r=0;r<s.length;r++){var a=s[r];a._options.grid.hasOtherInstances&&a._options.grid.relationid===n&&t.push(a)}}return t.length>0?t:[e]},_enableChildren:function(e,t){var n=this,i=void 0,o=this._treeListView.getDocument();o&&o.withTransactionUpdate((function(){e.processDescendants({onlyVisibleNodes:!1,processNode:function(e){i=e.nodeModel.options.grid.hasOtherInstances?n._getallSameNodes(e.nodeModel):[e.nodeModel];var o=!0;i.forEach((function(e){void 0!==e._options.isReplaceable&&(o=e._options.isReplaceable),t&&n._isActionRequired(e.getParent(),!0)&&(o=!1)})),o&&i.forEach((function(e){n._enable(e,t),t||n._removeAction(e)}))}})}))},_enable:function(e,t){e.updateOptions({grid:{actionComboBox:{disabled:!t},isEnabled:t}}),!t&&e.isSelected()&&e.unselect()},_clearParentsAction:function(e){var t=this,n=e.getParents();n&&n.length&&n.forEach((function(e){var n=!0;void 0!==e._options.isReplaceable&&(n=e._options.isReplaceable),e._options.grid.actionSelected&&e._options.grid.actionSelected!==f.ReplaceActionNone&&e._options.grid.actionSelected!==f.CreateNewRevision&&e._options.grid.actionSelected!==f.ReplaceActionByNewRevision&&t._removeAction(e,n)}))},_removeAction:function(e,t){e.updateOptions({grid:{maturityPreview:"",revisionPreview:"",actionSelected:f.ReplaceActionNone}}),t&&this._enable(e,t),this._updateStatus(e),this._updateStatus(e.getParent())},_isActionRequired:function(e,t){if(!e){for(var n=this._treeListView.getDocument().getRoots(),i=0;i<n.length;i++){if(this._isFlatListMode()&&this._isActionRequired(n[i]))return!0;var o=n[i].getAllDescendants();if(o&&o.length>0)for(var s=0;s<o.length;s++){var r=o[s];if(this._isActionRequired(r))return!0}}return!1}if(e._options.grid.actionSelected&&e._options.grid.actionSelected!==f.ReplaceActionNone&&""!==e._options.grid.actionSelected&&e._options.grid.actionSelected!==f.ReplaceActionByNewRevision&&e._options.grid.actionSelected!==f.CreateNewRevision)return!0;if(t)for(var a=e.getParents(),l=0;l<a.length;l++)if(this._isActionRequired(a[l]))return!0;return!1},findCorrespondingAction:function(e){switch(e){case f.ReplaceActionLatest:return"Latest";case f.ReplaceActionLatestStable:return"LatestStable";case f.ReplaceActionLatestReleased:return"LatestReleased";case f.ReplaceActionByRevision:return"ByRevision";case f.ReplaceActionByNewRevision:return"ByNewRevision";case f.CreateNewRevision:return"CreateNewRevision";case f.ReplaceActionNone:default:return"None"}},_registerAllReusableCellContent:function(){var t=this._treeListView.getManager();t.registerReusableCellContent({id:"isModified",buildContent:function(){return new e.Element("img",{class:"isModifiedIcon"})}}),t.registerReusableCellContent({id:"candidateLoading",buildContent:function(){var t=new e.Element("div",{class:"candidateLoading"});return(new l).inject(t).show(),t}}),t.registerReusableCellContent({id:"candidateLoaded",buildContent:function(){var t=new e.Element("div",{class:"candidateContainer",styles:{width:"inherit",height:"inherit",padding:"inherit"}}),n=e.createElement("div",{class:"candidateLatest"}),i=e.createElement("div",{class:"candidateStable"}),o=e.createElement("div",{class:"candidateReleased"});return t.appendChild(n),t.appendChild(i),t.appendChild(o),t}}),t.registerReusableCellContent({id:"action",buildContent:function(){return new a({elementsList:"",touchMode:!1,placeholder:f.TreeListViewReplacePlaceholder,enableSearchFlag:!1,actionOnClickFlag:!1,selectedIndex:-1,currentValue:""})}})},_launchVersionExplorer:function(t){var n=this;if(this.options.options.webInWin&&this.options.options.launchVersionExplorer&&"function"==typeof this.options.options.launchVersionExplorer)r.beginBlockingTransaction(),n.options.options.launchVersionExplorer(t._options.grid.physicalid),widget.addEvent("ENOXVersionExplorerModalOK",(function(e){n._onWIWVersionExplorerModalOK(e,t),r.endBlockingTransaction(),widget.removeEvent("ENOXVersionExplorerModalOK"),widget.removeEvent("ENOXVersionExplorerModalCancel")}),!1),widget.addEvent("ENOXVersionExplorerModalCancel",(function(){n._onVersionExplorerModalCancel(t),r.endBlockingTransaction(),widget.removeEvent("ENOXVersionExplorerModalCancel"),widget.removeEvent("ENOXVersionExplorerModalOK")}),!1);else{var i=e.createElement("div",{class:"revisionUpdate-dialog-versionexplorer"}).inject(document.body);this._myVersionExplorer=new c({versionGraphContainer:null,selectionMode:u.SELECTION_MODES.SINGLE_SELECT_ONLY,widget:widget}),this._myVersionExplorer.disableDrag(),this._myVersionExplorer.showDialog({x:100,y:100},i,!0),d.loadUserSettingsPromise({displayMode:u.DISPLAY_MODES.SUBWAY_VIEW,displayLegend:!0},!0);var o=this;this._myVersionExplorer.publishEvent("ENOXVersionExplorerLoadVersionModel",{id:t._options.grid.physicalid,type:t._options.type,tenantId:h.getTenantID(),securityContext:r.getSetting("securityContext"),onComplete:function(){var e=o._myVersionExplorer,t=this,n=!1,i=e.applyFilter((function(n){var i=!0,o=e.getObjects().find((function(e){return e.options.id===t.id||e.options.grid&&e.options.grid.contents&&e.options.grid.contents[0].id===t.id})),s=o?o.options.grid.majorid:void 0;if("string"==typeof t.id)i=t.id!==n._options.id&&n._options.grid.majorid!==s;else if(t.id.item&&t.id.item.id){var r=t.id.item.id;i=(r=r.replace("vid:",""))!==n._options.id&&n._options.grid.majorid!==s}return!0===i&&(i=!0===n._options.grid.__isLeaf__),i}));1===i.length&&(e.unselectAll(),i[0].select(),n=!0);var s=e.getObjects().find((function(e){return e.options.id===t.id||e.options.grid&&e.options.grid.contents&&e.options.grid.contents[0].id===t.id})),r=s?s.options.grid.majorid:void 0;return 1===(i=e.applyFilter((function(e){if("string"==typeof t.id)return t.id!==e._options.id&&e._options.grid.majorid!==r;var n=!0;if(t.id.item&&t.id.item.id){var i=t.id.item.id;n=(i=i.replace("vid:",""))!==e._options.id&&e._options.grid.majorid!==r}return n}))).length&&(e.unselectAll(),i[0].select(),n=!0),n},dataModelType:u.DATA_MODEL_TYPES.MODEL_HISTORY}),this._myVersionExplorer.subscribeEvent("ENOXVersionExplorerModalOK",this._onVersionExplorerModalOK.bind(this,t),!1),this._myVersionExplorer.subscribeEvent("ENOXVersionExplorerModalCancel",this._onVersionExplorerModalCancel.bind(this,t),!1),this._dlgVersionExplorer=p._dlg,p._dlg&&p._dlg.rightButtons&&p._dlg.rightButtons.addEventListener("click",this._onVersionExplorerModalCancel.bind(this,t))}},_onVersionExplorerModalCancel:function(e){var t={actionSelected:e._options.grid.actionSelected};this._updateNodesAfterAction(e,t)},_decodeHtml:function(e){const t=document.createElement("textarea");return t.innerHTML=e,t.value},_onVersionExplorerModalOK:function(e){var t,n=this._myVersionExplorer.getSelectedNodes().shift();if(n&&n._options.data.physicalid!==e._options.grid.physicalid){var i=document.createElement("textarea");i.innerHTML=n._options.data.name;const e=i.value;t={maturityPreview:n._options.grid.maturity_nls,revisionPreview:n._options.data.revision,actionSelected:f.ReplaceActionByRevision,expectedNewName:e,ByRevision:{id:n._options.data.physicalid,indexIn:0,indexOut:0,maturity:n._options.grid.maturity,maturityNLS:n._options.grid.maturity_nls,revision:n._options.data.revision}}}else t={actionSelected:e._options.grid.actionSelected};this._updateNodesAfterAction(e,t)},_onWIWVersionExplorerModalOK:function(e,t){var n;n=e&&e.physicalid!==t._options.grid.physicalid?{maturityPreview:e.maturity_nls,revisionPreview:e.revision,actionSelected:f.ReplaceActionByRevision,expectedNewName:e.name,ByRevision:{id:e.physicalid,indexIn:0,indexOut:0,maturity:e.maturity,maturityNLS:e.maturity_nls,revision:e.revision}}:{actionSelected:t._options.grid.actionSelected},this._updateNodesAfterAction(t,n)},getReplaceList:function(e){var t=this,n=[],i=void 0;return e?i=!0:(i=!1,e=this._treeListView.getDocument().getRoots()),e.forEach((function(e){t._isTreeListMode()?t._addRecursivelyReplaceCouple(e,n,i):t._addReplaceCouple(e,n,i)})),n},getCreateList:function(){var e=this,t=[],n=this._treeListView.getDocument();return n&&n._getTrueRoot().processDescendants({onlyVisibleNodes:!1,processNode:function(i){n.options.shouldBeSelected.call(n,i.nodeModel)&&e._addCreateCouple(i.nodeModel,t)}}),t},_drawCandidate:function(e,t){var n=e.querySelector(".candidateLatest"),i="available";n&&(t.contains("Latest")?n.addClassName(i):n.removeClassName(i)),(n=e.querySelector(".candidateStable"))&&(t.contains("Stable")?n.addClassName(i):n.removeClassName(i)),(n=e.querySelector(".candidateReleased"))&&(t.contains("Released")?n.addClassName(i):n.removeClassName(i))},_addRecursivelyReplaceCouple:function(e,t,n){var i=this,o=e.getChildren();o&&o.length>0&&o.forEach((function(e){i._addReplaceCouple(e,t,n),i._addRecursivelyReplaceCouple(e,t,n)}))},_addCreateCouple:function(e,t){var n=e.options.grid.actionSelected,i=this.findCorrespondingAction(n),o=void 0,s=void 0;if(("ByNewRevision"===i||"CreateNewRevision"===i)&&(o=e.options.grid.physicalid,s=e.options.grid.Latest?e.options.grid.Latest.id:e.options.grid.physicalid,o)){var r=-1;if(t&&t.length>0)for(var a=0;a<t.length;a++){if(t[a].branchDedup===s){r=a;break}}if(r<0){var l=e.getChildren(),c=[];l&&l.length>0&&l.forEach((function(e){c.push(e.options.grid.relationid)})),t.push({physicalid:e.options.grid.physicalid,instances:c,oldName:e.options.label+" "+e.options.grid.revisionCurrent,newName:e.options.grid.expectedNewName+" ",status:"waiting",type:i,branchDedup:s,instancesOfHimself:[e.options.grid.relationid]})}else o===t[r].physicalid?t[r].instancesOfHimself.push(e.options.grid.relationid):(t[r].status="neutral",t.push({physicalid:e.options.grid.physicalid,oldName:e.options.label+" "+e.options.grid.revisionCurrent,status:"neutral",type:i,branchDedup:s}))}},_addReplaceCouple:function(e,t,n){var i=e.options.grid.actionSelected,o=this.findCorrespondingAction(i),s=void 0,r=void 0,a=void 0;if((e.options.grid[o]||"ByNewRevision"===o)&&(s="ByNewRevision"===o?e.options.grid.physicalid:e.options.grid[o].id)){n||(r=e.options.label+" "+e.options.grid.revisionCurrent,a="ByNewRevision"===o?e.options.grid.expectedNewName+" ":e.options.grid.expectedNewName+" "+e.options.grid.revisionPreview);var l=this._isTreeListMode()?e.getParent().options.grid.physicalid:e.options.grid.parent,c=-1;if(t&&t.length>0)for(var d=0;d<t.length;d++){var u=t[d];if(n){if(u.rmNode===e.options.grid.relationid){c=d;break}}else if(u.instance===e.options.grid.relationid){c=d;break}}c<0&&(n?t.push({op:"REPLACE",parent:l,inNode:s,rmNode:e.options.grid.relationid}):t.push({hasParent:l,instance:e.options.grid.relationid,isInstanceOf:s,oldName:r,newName:a}))}}})})),define("DS/AuthGenericCommands/views/AuthGenericToolbar",["UWA/Core","UWA/Class","UWA/Class/Options","DS/Controls/Toolbar","DS/Controls/TooltipModel","DS/Controls/Button","DS/Menu/Menu","DS/WebappsUtils/WebappsUtils","DS/AuthGenericCommands/AppContext","i18n!DS/AuthGenericCommands/assets/nls/AuthDlgRevisionUpdate.json"],(function(e,t,n,i,o,s,r,a,l,c){"use strict";return t.extend(n,{options:{},init:function(e){this._parent(e);this.setOptions(e),this._createToolbar()},_createToolbar:function(){var t=this;this.toolbar=new i({overflowManagement:"dropdown",direction:"horizontal"}).inject(this.options.renderTo);var n=new e.Element("div",{class:"replaceAllActionElement"});new e.Element("B",{text:c.ToolBarReplaceAll,styles:{margin:"auto"}}).inject(n),this.replaceAllDropDownArrow=new s({domId:"upsReplaceAllDropDown",icon:{iconClasses:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-expand-down arrow-icon"},displayStyle:"icon",onClick:this._onShowReplaceAllDropdownMenu.bind(this),disabled:!0,minWidth:8}).inject(n),this.toolbar.add("element",{element:n,position:"near"}),this.toolbar.add("separator",{position:"near"}),this.toolbar.add("separator",{position:"far"}),this.options.EnableFliter&&(this.selectFilterIcon=new e.Element("img",{class:"selectFilterIcon",src:a.getWebappsAssetUrl("AuthGenericCommands","icons/I_DefineFilter.png")}),this.selectFilterIcon.tooltipInfos=new o({shortHelp:c.FilterReps,mouseRelativePosition:!0}),this.filterDropDownArrow=new s({domId:"upsSelectDropDown",icon:{iconClasses:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-expand-down arrow-icon"},displayStyle:"icon",onClick:this._onShowFilterDropdownMenu.bind(this),minWidth:8}),this.toolbar.add("element",{element:this.selectFilterIcon,position:"far"}),this.toolbar.add("element",{element:this.filterDropDownArrow.getContent(),position:"far"}),this.toolbar.add("separator",{position:"far"})),this._isTreeListMode()&&(this.selectAllVisibleBtn=new s({icon:a.getWebappsAssetUrl("AuthGenericCommands","icons/I_SelectAll.png"),tooltipInfos:new o({shortHelp:c.SelectAllVisible,mouseRelativePosition:!0}),onClick:this.options.cbOnSelectAllVisible.bind(this),displayStyle:"icon"}),this.selectchildrenBtn=new s({icon:a.getWebappsAssetUrl("AuthGenericCommands","icons/I_SelectChildren.png"),tooltipInfos:new o({shortHelp:c.SelectChildren,mouseRelativePosition:!0}),onClick:this.options.cbOnSelectChildren.bind(this),displayStyle:"icon"}),this.selectLeavesBtn=new s({icon:a.getWebappsAssetUrl("AuthGenericCommands","icons/I_SelectLeaves.png"),tooltipInfos:new o({shortHelp:c.SelectLeaves,mouseRelativePosition:!0}),onClick:this.options.cbOnSelectLeaves.bind(this),displayStyle:"icon"}),this.selectDropDownArrow=new s({domId:"upsSelectDropDown",icon:{iconClasses:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-expand-down arrow-icon"},displayStyle:"icon",onClick:this._onShowSelectDropdownMenu.bind(this),minWidth:8}),this.collapseAllBtn=new s({icon:a.getWebappsAssetUrl("AuthGenericCommands","icons/I_CollapseAll.png"),tooltipInfos:new o({shortHelp:c.CollapseAll,mouseRelativePosition:!0}),onClick:this.options.cbOnCollapseAll.bind(this),disabled:!0,displayStyle:"icon"}),this.expandDropDownArrow=new s({domId:"upsExpandDropDown",icon:{iconClasses:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-expand-down arrow-icon"},displayStyle:"icon",onClick:this._onShowExpandDropdownMenu.bind(this),minWidth:8}),this.toolbar.add("element",{element:this.selectAllVisibleBtn.getContent(),position:"far"}),this.positionSelectionToogle=this.toolbar.getPositionFromElement(this.selectAllVisibleBtn.getContent()),this.toolbar.add("element",{element:this.selectDropDownArrow.getContent(),position:"far"}),this.toolbar.add("separator",{position:"far"}),this.toolbar.add("element",{element:this.collapseAllBtn.getContent(),position:"far"}),this.positionExpandToggle=this.toolbar.getPositionFromElement(this.collapseAllBtn.getContent()),this.toolbar.add("element",{element:this.expandDropDownArrow.getContent(),position:"far"}),this.toolbar.add("separator",{position:"far"}),this.expandAllBtn=new s({icon:a.getWebappsAssetUrl("AuthGenericCommands","icons/I_ExpandAll.png"),tooltipInfos:new o({shortHelp:c.ExpandAll,mouseRelativePosition:!0}),onClick:this.options.cbOnExpandAll.bind(this),displayStyle:"icon"}),this.expandNLevelBtn=new s({icon:a.getWebappsAssetUrl("AuthGenericCommands","icons/I_ExpansionLevel.png"),tooltipInfos:new o({shortHelp:c.ExpandNLevel,mouseRelativePosition:!0}),onClick:function(e){t.options.cbOnExpandNLevel(e.target.getOffsets())},displayStyle:"icon"})),this.options.EnableCompare&&(this.compareBtn=new s({domId:"upsCompareBtn",icon:a.getWebappsAssetUrl("AuthGenericCommands","icons/I_Compare.png"),tooltipInfos:new o({shortHelp:c.CompareRevisions,mouseRelativePosition:!0}),disabled:!0,onClick:this.options.cbOnCompareRevisions.bind(this),displayStyle:"icon"}),this.toolbar.add("element",{element:this.compareBtn.getContent(),position:"far"}),this.toolbar.add("separator",{position:"far"})),this.options.EnableBubbleup&&this.options.EnableAutoBubbleup&&(this.autoSetToReplaceByNewRevisionBtn=new s({domId:"upsAutoSetToReplaceByNewRevisionBtn",onClick:this.options.cbAutoBubbleUp.bind(),id:c.ReplaceActionByNewRevision,data:c.ReplaceActionByNewRevision,icon:a.getWebappsAssetUrl("AuthGenericCommands","icons/I_SetParents.png"),disabled:!0,tooltipInfos:new o({shortHelp:c.MenuAutoSetReplaceByNewRevision,mouseRelativePosition:!0}),displayStyle:"icon"}),this.toolbar.add("element",{element:this.autoSetToReplaceByNewRevisionBtn.getContent(),position:"far"}),this.toolbar.add("separator",{position:"far"})),this.resetBtn=new s({tooltipInfos:new o({domId:"upsResetBtn",shortHelp:c.ResetAction,mouseRelativePosition:!0}),icon:a.getWebappsAssetUrl("AuthGenericCommands","icons/I_ExecResetAll.png"),disabled:!0,onClick:this.options.cbOnReset.bind(this),displayStyle:"icon"}),this.toolbar.add("element",{element:this.resetBtn.getContent(),position:"far"})},toggleExpandBtn:function(e){e&&(this.toolbar.removeItem("element",this.positionExpandToggle),e===c.ExpandAll?this.toolbar.add("element",{element:this.expandAllBtn.getContent(),position:this.positionExpandToggle.position,index:this.positionExpandToggle.index}):e===c.ExpandNLevel?this.toolbar.add("element",{element:this.expandNLevelBtn.getContent(),position:this.positionExpandToggle.position,index:this.positionExpandToggle.index}):e===c.CollapseAll&&this.toolbar.add("element",{element:this.collapseAllBtn.getContent(),position:this.positionExpandToggle.position,index:this.positionExpandToggle.index}))},toggleSelectBtn:function(e){e&&(this.toolbar.removeItem("element",this.positionSelectionToogle),e===c.SelectAllVisible?this.toolbar.add("element",{element:this.selectAllVisibleBtn.getContent(),position:this.positionSelectionToogle.position,index:this.positionSelectionToogle.index}):e===c.SelectChildren?this.toolbar.add("element",{element:this.selectchildrenBtn.getContent(),position:this.positionSelectionToogle.position,index:this.positionSelectionToogle.index}):e===c.SelectLeaves&&this.toolbar.add("element",{element:this.selectLeavesBtn.getContent(),position:this.positionSelectionToogle.position,index:this.positionSelectionToogle.index}))},updateToolbarCommandsStatus:function(){this.options.EnableCompare&&(this.compareBtn.disabled=!this.options.getIsComparable()),this.options.EnableBubbleup&&this.options.EnableAutoBubbleup&&(this.autoSetToReplaceByNewRevisionBtn.disabled=!this.options.getIsIntentionSet()),this._isTreeListMode()&&(this.selectchildrenBtn.disabled=!this.options.getIsSomthingSelected(),this.selectLeavesBtn.disabled=!this.options.getIsSomthingSelected(),this.collapseAllBtn.disabled=!this.options.getIsExpandable(),this.expandAllBtn.disabled=!this.options.getIsExpandable(),this.expandNLevelBtn.disabled=!this.options.getIsExpandable()),this.resetBtn.disabled=!this.options.getIsResetable()},unableReplaceAll:function(){this.replaceAllDropDownArrow.disabled=!1},_onShowReplaceAllDropdownMenu:function(){var e=this.replaceAllDropDownArrow.elements.container.getOffsets();r.show([{type:"PushItem",title:c.ReplaceActionLatestRevision,action:{callback:this.options.cbOnReplaceAll.bind(this),context:c.ReplaceActionLatest}},{type:"PushItem",title:c.ReplaceActionLatestStableRevision,action:{callback:this.options.cbOnReplaceAll.bind(this),context:c.ReplaceActionLatestStable}},{type:"PushItem",title:c.ReplaceActionLatestReleasedRevision,action:{callback:this.options.cbOnReplaceAll.bind(this),context:c.ReplaceActionLatestReleased}}],{position:{x:e.x,y:e.y+40}})},_onShowFilterDropdownMenu:function(){var e=this,t=e.filterDropDownArrow.elements.container.getOffsets();let n=l.IsDrawAvailableForUpdateRevision()?"selected":"unselected",i=l.Is3DShapeAvailableForUpdateRevision()?"selected":"unselected";r.show([{type:"CheckItem",title:c.filter_drawing,icon:{iconName:"drawing",fontIconFamily:1},state:n,action:{callback:function(){n="selected"===n?"unselected":"selected",localStorage.setItem("AuthGenericToolbar.displayDrawingAsChild","selected"==n),e.options.FilterSelection("Drawing","selected"==n)}}},{type:"CheckItem",title:c.filter_3DShape,icon:{iconName:"3dpart",fontIconFamily:1},state:i,action:{callback:function(){i="selected"===i?"unselected":"selected",localStorage.setItem("AuthGenericToolbar.display3DShapeAsChild","selected"==i),e.options.FilterSelection("3DShape","selected"==i)}}}],{position:{x:t.x,y:t.y+40}})},_onShowSelectDropdownMenu:function(){var e=this.selectDropDownArrow.elements.container.getOffsets();r.show([{type:"PushItem",title:c.SelectAllVisible,icon:"url("+a.getWebappsAssetUrl("AuthGenericCommands","icons/I_SelectAll.png")+")",action:{callback:this._onToggleSelection.bind(this),context:c.SelectAllVisible}},{type:"PushItem",title:c.SelectChildren,icon:"url("+a.getWebappsAssetUrl("AuthGenericCommands","icons/I_SelectChildren.png")+")",state:this.options.getIsSomthingSelected()?"enabled":"disabled",action:{callback:this._onToggleSelection.bind(this),context:c.SelectChildren}},{type:"PushItem",title:c.SelectLeaves,icon:"url("+a.getWebappsAssetUrl("AuthGenericCommands","icons/I_SelectLeaves.png")+")",state:this.options.getIsSomthingSelected()?"enabled":"disabled",action:{callback:this._onToggleSelection.bind(this),context:c.SelectLeaves}}],{position:{x:e.x,y:e.y+40}})},_onShowExpandDropdownMenu:function(){var e=this.expandDropDownArrow.elements.container.getOffsets();r.show([{type:"PushItem",title:c.ExpandAll,icon:"url("+a.getWebappsAssetUrl("AuthGenericCommands","icons/I_ExpandAll.png")+")",state:this.options.getIsExpandable()?"enabled":"disabled",action:{callback:this._onToggleExpand.bind(this,c.ExpandAll)}},{type:"PushItem",title:c.ExpandNLevel,icon:"url("+a.getWebappsAssetUrl("AuthGenericCommands","icons/I_ExpansionLevel.png")+")",state:this.options.getIsExpandable()?"enabled":"disabled",action:{callback:this._onToggleExpand.bind(this,c.ExpandNLevel,e)}},{type:"PushItem",title:c.CollapseAll,icon:"url("+a.getWebappsAssetUrl("AuthGenericCommands","icons/I_CollapseAll.png")+")",state:this.options.getIsExpandable()?"enabled":"disabled",action:{callback:this._onToggleExpand.bind(this,c.CollapseAll)}}],{position:{x:e.x,y:e.y+40}})},_onToggleExpand:function(e,t){e&&(this.toggleExpandBtn(e),e===c.ExpandAll?this.options.cbOnExpandAll():e===c.ExpandNLevel?this.options.cbOnExpandNLevel(t):e===c.CollapseAll&&this.options.cbOnCollapseAll())},_onToggleSelection:function(e){e.context&&(this.toggleSelectBtn(e.context),e.context===c.SelectAllVisible?this.options.cbOnSelectAllVisible():e.context===c.SelectChildren?this.options.cbOnSelectChildren():e.context===c.SelectLeaves&&this.options.cbOnSelectLeaves())},_isTreeListMode:function(){return"TreeList"===this.getOption("commandMode")}})})),define("DS/AuthGenericCommands/views/AuthGenericDlgRevisionUpdate",["UWA/Core","UWA/Class","UWA/Class/Options","DS/Windows/Dialog","DS/Windows/ImmersiveFrame","DS/Controls/Button","DS/Controls/ProgressBar","DS/Controls/SpinBox","DS/ApplicationFrame/CommandsManager","DS/AuthGenericCommands/AppContext","DS/AuthGenericCommands/views/AuthGenericTLVRevisionUpdate","DS/AuthGenericCommands/views/AuthGenericToolbar","DS/Logger/Logger","i18n!DS/AuthGenericCommands/assets/nls/AuthDlgRevisionUpdate.json"],(function(e,t,n,i,o,s,r,a,l,c,d,u,p,h){"use strict";var g=t.extend(n,{name:"GenericDlgRevisionUpdate",dialog_header:null,progressBar:null,isExpanded:!0,options:{},_logger:null,_dialog:null,_toolbar:null,_parent:null,_allrevisions:null,_treeListView:null,_compareCmd:null,init:function(e){this._parent(e),this._logger=p.getLogger(g),this.setOptions(e),this._createPanel(),this.physicalids=this._getPhysicalIds(),this.options.options.EnableBubbleup?(this._getConfigInfo(this.physicalids),this._getRevisionNumberProposal(this.physicalids)):this._getRevisionInfo(this.physicalids),this.options.options.EnableCompare&&(this._compareCmd=l.getCommand("CompareHdr",c.getContext().options.widget))},_createPanel:function(){var t=this;this.immersiveFrame=new o,widget&&widget.body?this.immersiveFrame.inject(widget.body):this.immersiveFrame.inject(document.body),this.dialog_header=e.createElement("div",{class:"revisionUpdate-dialog-header"});var n=e.createElement("div",{class:"revisionUpdate-dialog-body"}),a=this.options.title;if(this._dialog=new i({immersiveFrame:this.immersiveFrame,title:a,className:this.name+"_dialog",header:this.dialog_header,content:n,allowMaximizeFlag:!0,maximizeButtonFlag:!0,resizableFlag:!0,width:1105,minWidth:500,minHeight:250,height:500,position:{at:"left",my:"left",offsetX:50},modalFlag:!0,buttons:{Ok:new s({label:h.modalFooterOK,disabled:!0,class:"btn btn-primary disabled revisionUpdate-btn-ok",onClick:this._onOK.bind(this)}),Cancel:new s({label:h.modalFooterCancel,disabled:!1,className:"btn btn-default revisionUpdate-btn-cancel",onClick:this._onCancel.bind(this)})}}),this.options.options.webInWin){var l=this._dialog;l.titleBarVisibleFlag=!1,l.closeButtonFlag=!1,l.maximizedButtonFlag=!1,l.movableFlag=!1,l.resizableFlag=!1,l.maximizedFlag=!0,l.usePaddingFlag=!1}this._dialog.addEventListener("close",this._onClosePanel.bind(this),!1),this._dialog.elements.container.classList.add("AuthDlgRevisionUpdate_Dialog"),this._dialog.elements.container.addEventListener("click",(function(e){return e.preventDefault(),e.stopPropagation(),!1}));var c=new e.Element("div",{class:"wux-control-inline-container"}).inject(n),p=new r({value:0,displayStyle:"normal",shape:"linear",emphasize:"success",position:{at:"left",my:"left",offsetY:10}}),g=this._dialog.elements.container.querySelector(".wux-windows-dialog-footer");g.setStyle("height","60px");var f=new e.Element("div",{class:"generalLoader",styles:{width:"600px"}});g.insertBefore(f,g.getChildren()[0]),p.inject(f),this.progressBar=p;var m=new e.Element("div").inject(c),v=new e.Element("div",{class:"revisionUpdate-listview-container"}).inject(m);this._toolbar=new u({renderTo:this.dialog_header,commandMode:this.getOption("commandMode"),EnableCompare:this.options.options.EnableCompare,EnableBubbleup:this.options.options.EnableBubbleup,EnableAutoBubbleup:this.options.options.EnableAutoBubbleup,EnableFliter:this.options.options.EnableFliter,cbOnReplaceAll:this._onReplaceAll.bind(this),cbOnSelectAllVisible:this._onSelectAllVisible.bind(this),cbOnSelectChildren:this._onSelectChildren.bind(this),cbOnSelectLeaves:this._onSelectLeaves.bind(this),cbOnExpandAll:this._onExpandAll.bind(this),cbOnExpandNLevel:this._onExpandNLevel.bind(this),cbOnCollapseAll:this._onCollapseAll.bind(this),cbOnCompareRevisions:this._onCompareRevisions.bind(this),cbAutoBubbleUp:this._onAutoBubbleUp.bind(this),cbOnReset:this._onReset.bind(this),getIsSomthingSelected:this._isSomthingSelected.bind(this),getIsExpandable:this._isExpandable.bind(this),getIsComparable:this._isComparable.bind(this),getIsResetable:this._isResetable.bind(this),getIsIntentionSet:this._isIntentionSet.bind(this),FilterSelection:this._FilterSelection.bind(this)}),this._treeListView=new d({renderTo:v,roots:this.getOption("roots"),commandMode:this.getOption("commandMode"),options:this.getOption("options"),validChildrenIDs:this.getOption("validChildrenIDs"),valid3DShapeKindChildrenIDs:this.getOption("valid3DShapeKindChildrenIDs"),validDrawingKindChildrenIDs:this.getOption("validDrawingKindChildrenIDs"),cbOnSelectAllVisible:this._onSelectAllVisible.bind(this),cbOnSelectChildren:this._onSelectChildren.bind(this),cbOnSelectLeaves:this._onSelectLeaves.bind(this),cbOnExpandAll:this._onExpandAll.bind(this),cbOnExpandNLevel:this._onExpandNLevel.bind(this),cbOnCollapseAll:this._onCollapseAll.bind(this),cbOnCompareRevisions:this._onCompareRevisions.bind(this),getIsExpandable:this._isExpandable.bind(this),getIsComparable:this._isComparable.bind(this),getIsIntentionSet:this._isIntentionSet.bind(this),getIsResetable:this._isResetable.bind(this),cbUpdateToolbarCommandsStatus:this._onUpdateToolbarCommandsStatus.bind(this),cbUnableReplaceAll:this._onUnableReplaceAll.bind(this),cbActionAvailable:function(){t._enableOKButton()}})},_FilterSelection:function(e,t){let n=this._treeListView._treeListView.getDocument();if(n){n._getTrueRoot().getAllDescendants().forEach((n=>{if("Drawing"===e&&-1!==this.options.validDrawingKindChildrenIDs.indexOf(n.options.grid.physicalid)||"3DShape"===e&&-1!==this.options.valid3DShapeKindChildrenIDs.indexOf(n.options.grid.physicalid))if(t){var i=n.getParent(),o=!1;i.isVisible()&&(o=this._treeListView._isActionRequired(i)),this._treeListView._enableChildren(i,!o),n.show()}else this._treeListView._launchAction(n,h.ReplaceActionNone),n.hide(),n.updateOptions({grid:{actionComboBox:{disabled:!0},isEnabled:!1}})}))}this._enableOKButton()},_isExpandable:function(){var e=!1,t=this._treeListView._treeListView.getDocument();return t&&t.getSelectedNodes().some((function(t){if(t._options.children)return e=!0})),e},_isSomthingSelected:function(){return this._treeListView._treeListView.getDocument().getSelectedNodes().length>0},_isComparable:function(){var e=!1,t=this._treeListView._treeListView.getDocument();if(t){var n=t.getSelectedNodes();if(1===n.length){var i=n[0];i._options.grid.revisionPreview&&i._options.grid.revisionPreview.length>0?e=!0:this._isTreeListMode()&&i.getAllDescendants().some((function(t){if(t._options.grid.revisionPreview&&t._options.grid.revisionPreview.length>0)return e=!0}))}}return e},_isIntentionSet:function(){var e=!1,t=this._treeListView._treeListView.getDocument();return t&&t._getTrueRoot().processDescendants({onlyVisibleNodes:!1,processNode:function(t){if(t.nodeModel._options.grid.actionSelected&&t.nodeModel._options.grid.actionSelected!==h.ReplaceActionNone)return e=!0}}),e},_isResetable:function(){var e=!1,t=this._treeListView._treeListView.getDocument();if(t){var n=t.getSelectedNodes();n.length>0&&n.some((function(t){if(t._options.grid.actionSelected&&t._options.grid.actionSelected!==h.ReplaceActionNone)return e=!0}))}return e},_UnSelectHiddenElements:function(){let e=this._treeListView._treeListView.getDocument();if(e){e._getTrueRoot().getAllDescendants().forEach((e=>{e.isHidden()&&e.unselect()}))}},_onReplaceAll:function(e){var t=this._treeListView._treeListView.getDocument();e.context&&t&&(t.selectAll(),this._UnSelectHiddenElements(),this._treeListView._launchActions(t.getSelectedNodes(),e.context))},_onSelectAllVisible:function(){var e=this._treeListView._treeListView.getDocument();if(e){var t=[];e.withTransactionUpdate((function(){e._getTrueRoot().processDescendants({onlyVisibleNodes:!0,processNode:function(n){e.options.shouldBeSelected.call(e,n.nodeModel)&&t.push(n.nodeModel)}}),e.getXSO().empty(),e.getXSO().add(t)}))}},_onSelectChildren:function(){var e=this._treeListView._treeListView.getDocument();if(e){var t=[];e.withTransactionUpdate((function(){e.getSelectedNodes().forEach((function(n){n.processDescendants({onlyVisibleNodes:!1,processNode:function(n){e.options.shouldBeSelected.call(e,n.nodeModel)&&t.push(n.nodeModel)}})})),e.getXSO().add(t)}))}},_onSelectLeaves:function(){var e=this._treeListView._treeListView.getDocument();if(e){var t=[];e.withTransactionUpdate((function(){e.getSelectedNodes().forEach((function(n){n.processDescendants({onlyVisibleNodes:!0,processNode:function(n){!n.nodeModel._isExpanded&&e.options.shouldBeSelected.call(e,n.nodeModel)&&t.push(n.nodeModel)}})})),e.getXSO().empty(),e.getXSO().add(t)}))}},_onExpandAll:function(){var e=this._treeListView._treeListView.getDocument();e&&e.withTransactionUpdate((function(){e.getSelectedNodes().forEach((function(e){e.expandAll()}))}))},_onExpandNLevel:function(t){var n=e.createElement("div",{class:"expandLevel-dialog-body",styles:{height:"45px",width:"227px",display:"inline"}});this._expandLevelDlg=new i({immersiveFrame:this.immersiveFrame,content:n,resizableFlag:!1,position:{at:"top left",my:"top left",offsetX:t.x-227,offsetY:t.y+35},modalFlag:!0,titleBarVisibleFlag:!1}),this.spindboxexpand=new a({value:1,units:"",minValue:0,stepValue:1,pageStepValue:1}),this.spindboxexpand.inject(n),new s({icon:{iconName:"check"},onClick:this._onExpandNLevelOK.bind(this),emphasize:"success",minWidth:22}).inject(n).getContent().setStyle("margin-left","10px"),this._expandLevelDlg.options.maxWidth=277,this._handleModalClick=function(e){"wux-windows-modalDialog"===e.target.className&&this._onExpandNLevelKO()}.bind(this),this._handleModalEsc=function(e){27===e.keyCode&&this._onExpandNLevelKO()}.bind(this),document.body.addEventListener("mousedown",this._handleModalClick),document.body.addEventListener("keyup",this._handleModalEsc)},_onExpandNLevelOK:function(){var e=this;if(e.spindboxexpand.value){var t=this._treeListView._treeListView.getDocument();t&&t.withTransactionUpdate((function(){t.getSelectedNodes().forEach((function(t){t.expandNLevels({numberOfLevelsToExpand:e.spindboxexpand.value})}))}))}document.body.removeEventListener("mousedown",this._handleModalClick),document.body.removeEventListener("keyup",this._handleModalEsc),this._expandLevelDlg.close()},_onExpandNLevelKO:function(){this._expandLevelDlg&&(document.body.removeEventListener("mousedown",this._handleModalClick),document.body.removeEventListener("keyup",this._handleModalEsc),this._expandLevelDlg.close())},_onCollapseAll:function(){var e=this._treeListView._treeListView.getDocument();e&&e.withTransactionUpdate((function(){e.getSelectedNodes().forEach((function(e){e.collapseAll()}))}))},_onCompareRevisions:function(){this._launchCompare(this._treeListView._treeListView.getDocument().getSelectedNodes())},_onAutoBubbleUp:function(){var e=this._treeListView._treeListView.getDocument(),t=this;if(e){var n=[],i=[];e.withTransactionUpdate((function(){e._getTrueRoot().processDescendants({onlyVisibleNodes:!1,processNode:function(t){e.options.shouldBeSelected.call(e,t.nodeModel)&&t.nodeModel.options.grid.actionSelected!==h.ReplaceActionNone&&n.push(t.nodeModel)}}),n.forEach((function(e){e.getParents().forEach((function(e){e.options.grid.actionSelected!==h.ReplaceActionByNewRevision&&i.push(e)}))})),t._treeListView._launchActions(i,h.ReplaceActionByNewRevision)}))}},_onReset:function(){var e=this._treeListView._treeListView.getDocument();if(e){var t=[];e.withTransactionUpdate((function(){e.getSelectedNodes().forEach((function(e){e._options.grid.actionSelected&&e._options.grid.actionSelected!==h.ReplaceActionNone&&t.push(e)}))})),this._treeListView.resetActions(t)}},_onUpdateToolbarCommandsStatus:function(){this._toolbar&&this._toolbar.updateToolbarCommandsStatus()},_onUnableReplaceAll:function(){this._toolbar&&this._toolbar.unableReplaceAll()},_getPhysicalIds:function(){var e=this,t=[];return this.options.roots.forEach((function(n){var i=c.getReference(n);t.push(i),e._isTreeListMode()&&e._addChildrenRevision(n,t)})),t},_addChildrenRevision:function(e,t){var n=this,i=c.getChildren(e);null!==i&&0<i.length&&i.forEach((function(e){-1!==n.options.validChildrenIDs.indexOf(c.getReference(e))&&!0!==e.isRelationsObjectNode&&(-1===t.indexOf(c.getReference(e))&&t.push(c.getReference(e)),(n.options.options.webInWin||e.isExpanded())&&n._addChildrenRevision(e,t))}))},_getRevisionInfo:function(e){var t=this,n=this.options.onLoad;"function"==typeof n&&n(e,(function(e){t._allrevisions=e,t._treeListView.checkAndLaunchTreeNodeModelUpdate(t._allrevisions),void 0!==t.progressBar&&void 0!==t.progressBar.value&&(t.progressBar.destroy(),t._dialog.elements.container.querySelector(".generalLoader").destroy())}),(function(e){void 0!==t.progressBar&&void 0!==t.progressBar.value&&(t.progressBar.value=100*e)}))},_getRevisionNumberProposal:function(e){var t=this,n=this.options.onLoadRevisionNumberProposal;"function"==typeof n&&n(e,(function(e){e&&t._treeListView.treeNodeModelUpdateRevisionNumberProposal(e)}))},_getConfigInfo:function(e){var t=this,n=this.options.onLoadConfigInfo;"function"==typeof n&&n(e,(function(e){e&&t._treeListView.treeNodeModelUpdateConfigInfo(e),t._getRevisionInfo(t.physicalids)}))},_onClosePanel:function(){void 0!==this.options.enableCmdOnClose&&"function"==typeof this.options.enableCmdOnClose&&this.options.enableCmdOnClose(!0),this._dialog.destroy(),this._dialog=null,this.immersiveFrame.destroy(),this.immersiveFrame=null},_enableOKButton:function(){this._dialog.buttons.Ok.disabled=!this._isIntentionSet()},_isTreeListMode:function(){return"TreeList"===this.getOption("commandMode")},_getCreateList:function(e){return this._treeListView.getCreateList(e)},_getReplaceList:function(e){return this._treeListView.getReplaceList(e)},_launchCompare:function(e){var t=[],n=void 0,i=void 0,o=e[0]._options.grid,s=o.actionSelected;if(o.revisionPreview&&o.revisionPreview.length>0){var r=this._treeListView.findCorrespondingAction(s);n=o.physicalid,i=o[r].id}else t=this._getReplaceList(e),n=o.physicalid,i={id:o.physicalid,commands:t};var a=[n,i];this._compareCmd&&(this._compareCmd.options.CompareIds=a,this._compareCmd.options.ImmediateCompare=!0,this._compareCmd.execute_CompareHdr())},_onOK:function(e){var t=[];this._dialog.close(),this.options.options.EnableBubbleup&&(t=this._getCreateList());var n=this._getReplaceList(),i=this.options.onComplete;i&&"function"==typeof i&&i({createList:t,replaceList:n})},_onCancel:function(e){this._dialog.close();var t=this.options.onCancel;t&&"function"==typeof t&&t()}});return g})),define("DS/AuthGenericCommands/AuthGenericRevision",["DS/AuthGenericCommands/AuthGenericCmdWSAccess","DS/AuthGenericCommands/AppContext"],(function(e,t){"use strict";var n={},i=!1;function o(e){i=e}function s(e,t,n){var i={id:e.id,revision:e.revision,maturityNLS:e.maturityNLS,maturity:e.maturity,displayName:e.displayName};return void 0!==t&&(i.indexIn=t),void 0!==n&&(i.indexOut=n),e.icon&&(i.icon=e.icon),i}function r(e,t){if(!n[t]){var i=[];e.some((function(e){return e.id===t&&(i.push(e),!0)}));for(var o=t,s=function(e){if(e.secondaries&&e.secondaries[0].id===o)return i.push(e),o=e.id,!0};e.some(s););for(var r=t,a=function(t){if(t.ancestors&&t.ancestors[0]&&"E"===t.ancestors[0].semantic&&(t.ancestors[0].id===r||t.ancestors[0].fid===r)){for(i.push(t),r=t.id,o=r;e.some(s););return!0}};e.some(a););return n[t]=i,i}return n[t]}function a(e,t,n){var i=void 0;if(e.some((function(e){return e.id===n&&(i=n,!0)})),void 0!==i)return i;for(var o=t,s=function(e){if(e.id===o){if(e.ancestors&&e.ancestors[0]&&e.ancestors[0].id&&"E"===e.ancestors[0].semantic&&o!==e.ancestors[0].id)return o=e.ancestors[0].id,!0;i=o}return!1};e.some(s););return i}function l(e,t){for(var n=e.length,i=0;i<n;i++)for(var o=e[i],s=o.versions,l=s.length,c=o.item.vid,d=0;d<l;d++){if(s[d].id===t)return r(s,c=a(s,t,c))}}return{getVersionsFromGraphs:function(e,t){return l(e,t)},getRevisions:function(s){return function(s){n={};var r=s;return s.useIcon&&o(s.useIcon),r.cbOnProcess=function(n,o){var s=[];o.forEach((function(e){var t={id:e};s.push(t)}));var r={data:{graphRequests:s},timeout:6e4,onComplete:function(e){var t="string"==typeof e?JSON.parse(e):e;void 0!==t.graphs&&Array.isArray(t.graphs)&&o.forEach((function(e){var i=e,o=l(t.graphs,i);n.setAnswer(i,o)}))},onTimeout:function(e){console.log(e.message),t.displayNotification({msg:e.message,eventID:"error"}),n.cancel()},onFailure:function(e,t){console.log("getRevisions.onFailure");var i="string"==typeof t?JSON.parse(t):t;void 0!==i.errorID&&101===i.errorID&&n.cancel(),n.reprocess()}},a=["withIsLastVersion","1","validIntents","E"];return!0===i&&(a.push("withThumbnail"),a.push("1")),e.callWS(r,"/resources/v1/dslc/versiongraph","POST",a)},new e.MassChunkedRequests(r)}(s)},getCurrentAndLatestRevisionNames:function(e,t){for(var n="",i=null,o=e.length,s=0;s<o;s++){var r=e[s];r.id===t&&void 0!==r.code&&(n=r.code),void 0!==r.isLastVersion&&!0===r.isLastVersion&&(i=r.code)}return{oldRevision:n,newRevision:i}},getLatestRevisionForReplace:function(e,t){for(var n=null,i=e.length,o=0;o<i;o++){var s=e[o];if(void 0!==s.isLastVersion&&!0===s.isLastVersion){n=s.id;break}}return t===n?null:n},getNameOfLatestRevisionForReplace:function(e,t){for(var n=e.length,i=0;i<n;i++){var o=e[i];if(void 0!==o.isLastVersion&&!0===o.isLastVersion)return o.label}},getLightRevisionsFromWSData:function(e){if(Array.isArray(e)){for(var t=[],n=0,o=e.length;n<o;n++){var s=e[n];if("object"==typeof s&&void 0!==s.id&&void 0!==s.code&&void 0!==s.maturity&&void 0!==s.maturity_nls&&void 0!==s.isLastVersion&&void 0!==s.label){var r={id:s.id,revision:s.code,maturity:s.maturity,maturityNLS:s.maturity_nls,bLastVersion:s.isLastVersion,displayName:s.label};!0===i&&s.icon&&(r.icon=s.icon),t.push(r)}}if(0!==t.length)return t}},getLatestCandidateRevisions:function(e,t){if("object"==typeof e){t&&o(t);var n={};for(var i in e){var s=e[i];if(Array.isArray(s)){var r=this.getLightRevisionsFromWSData(s),a=i;n[i]={};var l=n[i],c=this.getLRCurrentRevision(r,a);l.CURRENT=c;var d=this.getLRLatestReleasedRevision(r,a);void 0!==d&&d.indexIn!==d.indexOut&&(l.RELEASED=d);var u=this.getLRLatestStableRevision(r,a);void 0!==u&&u.indexIn!==u.indexOut&&(l.STABLE=u);var p=this.getLRLatestRevision(r,a);void 0!==p&&p.indexIn!==p.indexOut&&(l.LATEST=p)}}return n}},getLRRevisionIndex:function(e,t){for(var n=0,i=e.length;n<i;n++)if(e[n].id===t)return n;return-1},getLRCurrentRevision:function(e,t){for(var n=this.getLRRevisionIndex(e,t),i=e.length-1;i>=0;i--){var o=e[i];if(o.id===t)return s(o,n,i)}},getLRLatestReleasedRevision:function(e,t){for(var n=this.getLRRevisionIndex(e,t),i=e.length-1;i>=0;i--){var o=e[i];if("RELEASED"===o.maturity)return s(o,n,i)}},isLRLatestReleasedRevision:function(e,t){var n=this.getLRLatestReleasedRevision(e,t);return void 0!==n&&n.indexIn===n.indexOut},getLRLatestStableRevision:function(e,t){for(var n=this.getLRRevisionIndex(e,t),i=e.length-1;i>=0;i--){var o=e[i];if("FROZEN"===o.maturity||"RELEASED"===o.maturity)return s(o,n,i)}},isLRLatestStableRevision:function(e,t){var n=this.getLRLatestStableRevision(e,t);return void 0!==n&&n.indexIn===n.indexOut},getLRLatestRevisionIndex:function(e){for(var t=-1,n=e.length,i=0;i<n;i++){!0===e[i].bLastVersion&&(t=i)}return t},getLRLatestRevision:function(e,t){var n=this.getLRRevisionIndex(e,t),i=this.getLRLatestRevisionIndex(e),o=e[i];if(o)return s(o,n,i)},isLRLatestRevision:function(e,t){var n=this.getLRLatestRevision(e,t);return void 0!==n&&n.indexIn===n.indexOut},getLRExpectedRevision:function(e,t,n){switch(n){case"LatestReleased":return this.getLRLatestReleasedRevision(e,t);case"LatestStable":return this.getLRLatestStableRevision(e,t);case"Latest":return this.getLRLatestRevision(e,t);default:return}},isLRExpectedRevision:function(e,t,n){switch(n){case"LatestReleased":return this.isLRLatestReleasedRevision(e,t);case"LatestStable":return this.isLRLatestStableRevision(e,t);case"Latest":return this.isLRLatestRevision(e,t);default:return!1}}}})),define("DS/AuthGenericCommands/commands/AuthGenericCmdReplaceByLatestRevision",["UWA/Class","DS/ApplicationFrame/Command","DS/AuthGenericCommands/AppContext","DS/AuthGenericCommands/AuthGenericCmdUtils","DS/AuthGenericCommands/views/AuthGenericReportPanel","DS/AuthGenericCommands/AuthGenericRevision","i18n!DS/AuthGenericCommands/assets/nls/AuthGenericCommandsCatalog.json"],(function(e,t,n,i,o,s,r){"use strict";return e.extend(t,{defaultOptions:{},init:function(e){e.context&&n.setContext(e.context),this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){var e=this;e.disable(),e.errors=[],e.neutrals=[];var t=n.getSelectedNodes();if(e.selectedNodes=t,n.isThereARootSelected()){const e=r.SEL_002.split("\n");n.displayNotification({title:e[0],msg:e[1],eventID:"error"})}else{var i=n.getParentWithChild(t);i&&0!==i.length?n.displayNotification({title:r.replace_error,msg:r.replace_latest_failed_child_selected,eventID:"error"}):e.defaultOptions.isValidSelection(t,e._checkValidSelection.bind(e))}},_checkValidSelection:function(e){var t=this;if(!1!==e.status){t.ordering=n.getOrdering(t.selectedNodes),t.preparedItems={},t.physicalIds=[],t.selectedNodes.forEach((function(e){var i=n.getInstance(e),o=n.getReference(e);t.physicalIds.push(o);var s={};s.node=e,s.oldInstance=i,s.oldReference=o,s.parentNode=n.getParent(e),s.parentInstance=n.getReference(s.parentNode),t.preparedItems[i]=s}));var i={requests:t.physicalIds,chunkSize:30,cbOnComplete:t._revisionMass_onComplete.bind(t),cbOnAbort:t._revisionMass_onAbort.bind(t)};n.beginBlockingTransaction(r.executing),t.loadProcess=s.getRevisions(i)}else for(var o=0,a=e.invalid.length;o<a;o++){var l=e.invalid[o];const t=r.replace(r.get("replace_unsupported_type"),{name:n.getName(l),type:n.getType(l)}).split("\n");n.displayNotification({title:t[0],msg:null!=t[1]?t[1]:"",eventID:"error"})}},_revisionMass_onAbort:function(){},_revisionMass_onComplete:function(e){var t=this,o=e.getAnswers(),a=[],l=[];for(var c in t.preparedItems){var d=t.preparedItems[c],u=d.oldReference,p=o[u],h=d.node,g=n.getName(h);if(void 0!==p){var f=s.getCurrentAndLatestRevisionNames(p,u),m=s.getLatestRevisionForReplace(p,u);if(null===m)t.neutrals.push(r.replace_latest_failed_already_latest.replace("{name}",g+" "+f.newRevision));else{var v=s.getNameOfLatestRevisionForReplace(p,u),_=d.parentInstance,b=d.oldInstance,C=n.getReference(n.getParent(h));if(i.canInstantiate(C,[m])){var D={hasParent:_,instance:b,isInstanceOf:m,oldName:g+" "+f.oldRevision,newName:v+" "+f.newRevision};a.push(D),d.newReference=m,l.push(d)}else n.getNamesAsync([n.getParent(h)],(function(e){t.neutrals.push(r.replace(r.get("replace_unsupported_cycle"),{child:v,parent:e[0]}))}))}}else t.neutrals.push(r.replace_latest_failed_nograph.replace("{name}",g))}t._launchReplace(a)},_launchReplace:function(e){var t=this;require(["DS/AuthGenericCommands/AuthGenericCmdWSAccess"],(function(i){if(e.length<1)return t.reportPanel=new o({title:t.options.reportTitle,success:[],failure:t.errors,neutral:t.neutrals,aborted:[]}),t.enable(),t.end&&t.end(),t.done(),void n.endBlockingTransaction();var s={version:t.defaultOptions.version,bAllOrNothing:t.defaultOptions.bAllOrNothing,modeler:t.defaultOptions.modeler,chunkSize:30,requests:e,cbOnProgress:t._replaceMass_OnProgress.bind(t),cbOnComplete:t._replaceMass_OnComplete.bind(t),cbOnAbort:t._replaceMass_OnAbort.bind(t),cbOnLastChunk:t._replaceMass_OnLastChunk.bind(t)};s.chunkSize<e.length&&require(["DS/AuthGenericCommands/views/AuthGenericDlgProgressbar"],(function(e){t.progressbarDlg=new e({label:{progressBarMainTitle:r.executing,progressBarAbortAlert:r.abort_confirm_message,progressBarAlertTitle:r.confirm,modalFooterAbort:r.modalFooterAbort},events:{onAbort:function(){s.cbOnAbort()}}}),t.enable(),t.end&&t.end(),t.done(),n.endBlockingTransaction()})),t.replaceProcess=i.replaceMassOperations(s)}))},_replaceMass_OnAbort:function(){this.replaceProcess&&this.replaceProcess.abort()},_replaceMass_OnProgress:function(e){var t=this;t.progressbarDlg&&t.progressbarDlg.progressBar&&(t.progressbarDlg.progressBar.value=100*e)},_replaceMass_OnLastChunk:function(){this.progressbarDlg&&this.progressbarDlg.disableAbort()},_replaceMass_OnComplete:function(e){var t,s=this,a=[],l=[],c=s.errors,d=e.getAnswers(),u={action:"replace",operations:[]};d.forEach((function(e){var o=e.answer;if("success"===o.status)u.operations.push({parent:o.parent,old:o.oldInstance,new:{reference:o.newReference,instance:o.newInstance},rootNode:o.parent,ordering:s.ordering[o.oldInstance]}),t=r.replace(r.get("replace_report_success"),{oldName:o.oldName,newName:o.newName}),a.push(t);else{var l={remapErrors:s.defaultOptions.remapErrors,name:o.oldName,type:null},d=i.buildErrorMessage(o.messages,l);"."===d&&o.messages&&(d=o.messages),t=r.replace(r.get("replace_report_failure1"),{oldName:o.oldName})+"\n"+d;let e=n.getNodesById(o.parent);t=t.replace("{parent_object_title}",n.getName(e[0])),c.push(t)}})),e.getAbortedRequests().forEach((function(e){t=r.replace(r.get("replace_report_abort"),{oldName:e.oldName,newName:e.newName}),l.push(t)})),u.operations.length&&n.refresh(u),s.progressbarDlg?(s.progressbarDlg.destroy(),s.progressbarDlg=void 0):(n.endBlockingTransaction(),s.end&&s.end(),s.done()),s.reportPanel=new o({title:s.options.reportTitle,success:a,failure:c,neutral:s.neutrals,aborted:l}),s.enable(),s.end&&s.end(),s.done(),n.endBlockingTransaction()}})}));