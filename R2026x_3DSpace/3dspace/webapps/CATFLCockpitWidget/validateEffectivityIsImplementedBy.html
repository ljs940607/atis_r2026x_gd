<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:widget="http://www.netvibes.com/ns/">
<head>


    <title>Validate Effectivity - Web In Win</title>

    <!-- App icon set to blue CATIA icon -->
	<!-- <link rel="icon" type="image/png" href="assets/icons/16/iconCATIA.png" /> -->

	<!-- Application Metas -->
	<meta name="autoRefresh" content="false" />
	<meta name="debugMode" content="true" />
    <meta name="author" content="FLE Team" />
    <meta name="description" content="FL Cockpit Widget" />

    <!-- AMDLoader -->
    <script type="text/javascript" src="../AmdLoader/AmdLoader.js"></script>
    <script type="text/javascript" src="../WebappsUtils/WebappsUtils.js"></script>

    <!-- UWA -->
    <script type="text/javascript" src="../c/UWA/js/UWA_Standalone_Alone.js"></script>

    <!--  CSS -->
    <link rel="stylesheet" type="text/css" href="../UIKIT/UIKIT.css" />
    <link rel="stylesheet" type="text/css" href="CATFLCockpitWidget.css" />

    <!-- Web Fundamentals -->
    <script type="text/javascript" src="../WebUX/WebUX.js"></script>

    <!-- Sample code -->
    <script>
        // Expose global method here
      window.validateEffectivityIsImplementedBy = function (options) {
          require([
          	'DS/CATFLCockpitWidget/components/WIWItemCreationModal/WIWItemCreationModal',
            'DS/CATFLCockpitWidget/components/WIWItemCreationModal/WIWValidateEffectivity',
              'UWA/Core',
              'DS/CATFLCockpitWidget/services/logitem.service',
              'DS/CATFLCockpitWidget/services/model.service',
              'DS/CATFLCockpitWidget/services/common.service',
              'DS/CATFLCockpitWidget/utils/common.util',
              'DS/Windows/ImmersiveFrame',
              'DS/Windows/Dialog',
              'i18n!DS/CATFLCockpitWidget/assets/nls/CATFLCockpitWidget',
              'css!DS/CATFLCockpitWidget/CATFLCockpitWidget'
          ], function (WIWItemCreationModal, WIWValidateEffectivity, UWA, LogItemService, ModelService, CommonService, CommonUtil, WUXImmersiveFrame, WUXDialog, NLS) {

            let instanceCount = 0;
            if ( options.ListSelectedInstances ) {
              instanceCount = options.ListSelectedInstances.length;
            }
            let discId = options.SelectionContext.ReferenceContext;
            let itemId = options.SelectionContext.LinkedSystem;
            let securityContext;
            if (options.SecurityContext) {
                securityContext = options.SecurityContext;
                delete options.SecurityContext;
            }

            // LogItemService.getlogRefDiagramProposal(options, securityContext).then((proposalResp) => {
              // set the title of WIW Create from diagram page
              let titleOfWIW = document.getElementsByClassName('title');
              if(titleOfWIW && titleOfWIW.length == 1){
                  titleOfWIW[0].innerText = NLS.action_check_effectivity_consistency;
              }

              let parentDiv = UWA.createElement('div');
              parentDiv.setStyles({
                width : '100%',
                height: '100%'
              });
              widget.body.empty();
              widget.body.appendChild(parentDiv);

              WIWValidateEffectivity.init(options, parentDiv);

              // // add information to proposal response
              // proposalResp.instanceCount = instanceCount;
              // proposalResp.winInfo = {
              //   action: 'createLogRefFromDiagram',
              //   title: NLS.action_check_effectivity_consistency + proposalResp.SelectionContext.LinkedSystemTitle,
              //   submitBtn: NLS.action_create
              // };

              // // copying all configuration related data
              // let cfgCtxInfo = {};
              // if (proposalResp.configurationInfo) {
              //   cfgCtxInfo.bCopyEff = proposalResp.configurationInfo.canCopyEffectivity;
              //   cfgCtxInfo.bApplyConfig = proposalResp.configurationInfo.canApplyConfiguration;

              //   let models = proposalResp.configurationInfo.models;
              //   let itemCtx = proposalResp.configurationInfo.itemModels;
              //   cfgCtxInfo.itemModels = [];
              //   models.forEach((modelInfo) => {
              //     if (itemCtx.indexOf(modelInfo.physicalid) >= 0) {
              //       cfgCtxInfo.itemModels.push(modelInfo);
              //     }
              //   });
              // }

              // // save Work Under change if not any or none on item
              // if (proposalResp.changeControlInfo) {
              //   let itemChangeControl = proposalResp.changeControlInfo.itemChangeControl;
              //   if (itemChangeControl !== "none" && itemChangeControl !== "any") {
              //     proposalResp.changecontrol = itemChangeControl;
              //   }
              // }

              // WIWValidateEffectivity.init(options, parentDiv);

              // let moduleFooter = document.getElementsByClassName('moduleFooter')
              // if(moduleFooter && moduleFooter.length == 1){
              //  moduleFooter[0].setStyle('display', 'none')
              // }
            // }, function (errors){
            //       CommonUtil.displayError(errors, null, null, NLS.msg_generic_error_get_failed);
            // });
          });
      };

      // The ReferenceContext(Discipline) should be implemented by the LinkedSystem(Item) to do create from diagram
      // All the model versions of the models attached to linked system will be available in the Applied Configuration option
      // var options = {
      //    "SelectionContext":{"ReferenceContext":"D1B98256D7AE080067E2809700000103","LinkedSystem":"D1B98256D7AE080067E276AC00000039"},
      //    "ListSelectedInstances":[
      //       {"instanceID":"D1B98256D7AE080067E280B200000113","referenceID":"D1B98256D7AE080067E280B20000010D", "parentID": "D1B98256D7AE080067E2809700000103","addRefRef":false}, 
      //       {"instanceID":"D1B98256D7AE080067E280BA0000011F","referenceID":"D1B98256D7AE080067E280BA00000119", "parentID": "D1B98256D7AE080067E2809700000103","addRefRef":false},
      //       {"instanceID":"D1B98256D7AE080067E280C40000012B","referenceID":"D1B98256D7AE080067E280C400000125", "parentID": "D1B98256D7AE080067E2809700000103","addRefRef":false},
      //       {"instanceID":"D1B9825677F7010067EA46F80000056D","referenceID":"D1B9825677F7010067EA46F800000567", "parentID": "D1B98256D7AE080067E2809700000103","addRefRef":false},
      //       {"instanceID":"D1B9825677F7010067EA470D0000057F","referenceID":"D1B9825677F7010067EA470D00000579", "parentID": "D1B9825677F7010067EA46F800000567","addRefRef":false}
      //    ]
      // }
      
      // validateEffectivityIsImplementedBy(options);

/* var jsonDataDummy = {
   "columnNames":[
      "instance",
      "reference",
      "revision",
      "newValue",
	  "cc1",
	  "cc2"
   ],
   "columns":{
      "instance":{
         "key":"instance",
         "label":"Instance",
         "editable":false,
         "required":false,
         "format":"string",
         "architectureIdColumn":false
      },
      "reference":{
         "key":"reference",
         "label":"Reference",
         "editable":false,
         "required":false,
         "format":"string",
         "architectureIdColumn":false
      },
      "revision":{
         "key":"revision",
         "label":"Revision",
         "editable":false,
         "required":false,
         "format":"string",
         "architectureIdColumn":false
      },
      "newValue":{
         "key":"newValue",
         "label":"Architecture Number",
         "editable":true,
         "required":true,
         "format":"string",
         "architectureIdColumn":true
      },
	  "cc1":{
         "key":"cc1",
         "label":"CC1",
         "editable":true,
         "required":true,
         "architectureIdColumn":true,
		 "range": ["va11", "val2", "val3"],
		 "defaultValue": "val2",
		 "format":"enum"
      },
	  "cc2":{
         "key":"cc2",
         "label":"CC2",
         "editable":true,
         "required":true,
         "architectureIdColumn":true,
		 "range": ["va11", "val2", "val3"],
		 "rangeLabel": ["Lso11", "Lsol2", "Lsol3"],
		 "format":"enum"
      }
   },
   "rows":[
      {
         "reference":"Pump",
         "newValue":"",
         "instance":"Pump.1",
         "instanceID":"62EB82561A6A000060FAE79E000C67CD",
         "referenceID":"62EB82565137000060F69044000BCDF3",
         "revision":"A.1",
		 "cc1":"",
		 "cc2":"va11"
      },
      {
         "reference":"Valve",
         "newValue":"",
         "instance":"Valve.1",
         "instanceID":"62EB82561A6A000060FAE79E00162D1D",
         "referenceID":"62EB82565137000060F690530018426D",
         "revision":"A.1",
		 "cc1":"",
		 "cc2":"val2"
      },
      {
         "reference":"Motor",
         "newValue":"",
         "instance":"Motor.1",
         "instanceID":"62EB82561A6A000060FAE79F00011047",
         "referenceID":"62EB82565137000060F6904C001D6C95",
         "revision":"A.1",
		 "cc1":"val3",
		 "cc2":"val3"
      }
   ],
   "AN_ACTION":"CREATE_ITEM",
   "showBulkRecomputation":true,
   "showRowLevelRecomputation":"true",
   "SelectionContext":{
      "ReferenceContext":"62EB82565137000060F69002000E36F3",
      "LinkedSystem":"62EB82569B7B000060FEA5EF00111FEB",
      "LinkedSystemTitle":"PIPE_SYS"
   }
 };*/
 //
    </script>
    <!-- Application JS End -->
</head>

<body>
</body>

</html>
