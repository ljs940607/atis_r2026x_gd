/*!  Copyright 2014 Dassault Systemes. All rights reserved. */
define("DS/SPYUI/commands/CATSPYMSRAttachSessionDataCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/Core/Core","DS/CoreEvents/Events","DS/ApplicationFrame/CommandsManager"],(function(e,t,i,n,a){"use strict";return t.extend({init:function(e,t){this._parent(e,{isAsynchronous:!0,mode:"shared"})},beginExecute:function(){var e=a.getCommand("Share3DComment",this._ctx);e.isRunning()||e.begin(),this.end()}})})),define("DS/SPYUI/GuidanceMsg",["css!DS/SPYUI/Guidance.css","UWA/Core","UWA/Class","DS/WebSystem/Nls","DS/WebappsUtils/WebappsUtils"],(function(e,t,i,n,a){"use strict";var s=i.extend({_expand:function(){this._expanded=!0,this._extButton.removeClassName("wux-ui-3ds-open-down"),this._extButton.addClassName("wux-ui-3ds-open-up")},_collapse:function(){this._expanded=!1,this._extButton.removeClassName("wux-ui-3ds-open-up"),this._extButton.addClassName("wux-ui-3ds-open-down")},init:function(e){if(this._parent(),e&&e.msgData&&e.nlsModule&&e.nlsFile&&e.parentContainer){this._extendedMsg=e.extendedMsg,this._extendedMsg&&(this._extendedMsg.onHide=function(){this._collapse()}.bind(this)),this._expanded=!1,this._container=new t.Element("div",{class:"guidance-msg-container",events:{click:function(){this._extendedMsg&&(this._expanded?(this._extendedMsg.hide(),this._collapse()):(this._extendedMsg.show(),this._expand()))}.bind(this)}}).inject(e.parentContainer);var i=new t.Element("span",{class:"guidance-msg-text"}).inject(this._container);n.nls(e.nlsModule+"/"+e.nlsFile,e.msgData.text,(function(e){i.setText(e)})),new t.Element("span",{class:"guidance-msg-image"}).inject(this._container).style["background-image"]='url("'+a.getWebappsBaseUrl()+e.msgData.image+'")',e.extendedMsg&&(this._extButton=new t.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-open-down guidance-extend-symbol"}).inject(this._container))}},remove:function(){this._container&&(this._container.remove(),this._container.destroy())}});return t.namespace("DS/SPYUI/GuidanceMsg",s)})),define("DS/SPYUI/controllers/SPYContext",["UWA/Core","UWA/Class","DS/EditPropWidget/constants/EditPropConstants"],(function(e,t,i){"use strict";var n=t.singleton({getEmbeder:function(){return this._embeder},isEmbeder3DPlay:function(){return"X3DPLAW_AP"===this._embeder},isEmbederPSR:function(){return"SIMWPSR_AP"===this._embeder},setEmbeder:function(e){this._embeder=e},setAppContext:function(e){this._ctx=e},getAppContext:function(){return this._ctx},setAppEventProxy:function(e){this._evtProxy=e},sendAppNotification:function(e,t){this._evtProxy&&n.AppEventProxy.isPrototypeOf(this._evtProxy)&&this._evtProxy.sendAppNotification(e,t)},appNotificationTypes:{info:"info",warning:"warning",error:"error"},getCurrentPad:function(e){this._pad=e},setCurrentPad:function(){return this._pad},getCurrentController:function(){return this._spmUI},setCurrentController:function(e){this._spmUI=e},getFrameWindow:function(){return this._frmWindow},setFrameWindow:function(e){this._frmWindow=e},getCommandsManager:function(){return this._coms},setCommandsManager:function(e){this._coms=e},getCurrentContent:function(){return this._currentContent},setCurrentContent:function(e){this._currentContent=e},getSidePanelFacets:function(){var e=[i.FACET_PHYSICSSIMULATION];return this.isEmbederPSR()&&(e.push(i.FACET_RELATIONS),e.push(i.FACET_PROPERTIES),e.push(i.FACET_SWYMCOMMENTS)),e}});return n.AppEventProxy=function(){},n.AppEventProxy.prototype.sendAppNotification=function(){console.warn(" SPYContext.AppEventProxy - abstract class method sendAppNotification called !")},n.AppEventProxy.prototype.convertNotification=function(e){console.warn(" SPYContext.AppEventProxy - abstract class method convertNotification called !")},n})),define("DS/SPYUI/views/ChooseContentView",["css!DS/SPYUI/views/ChooseContentView.css","i18n!DS/SPYUI/assets/nls/ContentReport","i18n!DS/SPYUI/assets/nls/ChooseContent","UWA/Core","UWA/Class","DS/CoreEvents/Events","DS/Windows/Panel","DS/CollectionView/ResponsiveTilesCollectionView","DS/Controls/Button","DS/Controls/ComboBox","DS/Controls/Popup","DS/DataGridView/DataGridView","DS/SMAMpwControls/SMAMpwBreadcrumb"],(function(e,t,i,n,a,s,o,r,l,c,h,d,u){"use strict";const m="spy-msr-treeBC",g=".spy-msr-element",p={NOT_LOADED:0,LOADING:1,LOADED:2};var v=a.singleton({build:function(e,t,a){if(!this._panelDOM||this.immersiveFrame!==e){this.ctx=a,this.immersiveFrame=e,this.isContentVisible=!1,this.isVerticalMobile=t,this._headerContainer=new n.Element("div",{class:"headerContainer"});let s=new n.Element("div",{class:"parentContainer"}).inject(this._headerContainer);this.breadcrumb=new u(s,a),this._panelContent=new n.Element("div",{id:"panelContent",html:""});let r=new n.Element("div",{class:"changeViewButton"}).inject(s),l=[{label:i.changeViewTiles,icon:"view-big-tile wux-ui-3ds",value:"tiles"},{label:i.changeViewTreeView,icon:"tree-view-flattened-leaves wux-ui-3ds",value:"treeView"}];this.changeViewCombo=new c({enableSearchFlag:!1,elementsList:l,popupSizeAdjustPolicy:h.SizeAdjustPolicyEnum.AdjustToVisibleContents,mainElementContent:"icon",displayStyle:"lite",value:"tiles"}).inject(r),this.currentView="tiles",this.changeViewCombo.addEventListener("change",this._selectView.bind(this)),this.reportZone=new n.Element("div",{class:"spy-report-container-header"}).inject(this._headerContainer),this._panel=new o({immersiveFrame:this.immersiveFrame,title:i.panelTitle,maximizedFlag:t,resizableFlag:!t,visibleFlag:!t,position:{my:"top left",at:"top left",of:this.immersiveFrame},closeButtonFlag:!1,content:this._panelContent,header:this._headerContainer}),this._panel.addEventListener("close",(e=>{console.log("close")})),this._panelDOM=this._panel.getContent(),this._panelDOM.classList.add("spy-msr-contentchooserpanel"),this.immersiveFrame.moveWindowToMaximizeZone(this._panel),document.querySelector(".wux-controls-button.wux-controls-combobox-mainelement.wux-ui-style-lite").classList.add("spy-msr-button-changeview"),null!=this.myResponsiveTilesCollectionView&&(this.myResponsiveTilesCollectionView.destroy(),this.myResponsiveTilesCollectionView=void 0)}},buildDatagridView:function(e,t,i){var n=[{text:"Choose Content",dataIndex:"tree",getCellKPIColor:function(e){if(null===e.nodeModel.getChildren()){let n=e.nodeModel.getParent().getLabel();if(e.nodeModel.getLabel()===t&&n===i)return"#54a3dc"}}}];this.dataGridView=new d({treeDocument:e,columns:n,focusNextEditableCellOnTabFlag:!0,showBackgroundFlag:!1,defaultColumnDef:{minWidth:30,sortableFlag:!1},layoutOptions:{columnsHeader:!1,rowsHeader:!1,rowSpacing:6}}),this.dataGridView.getCellsXSO().onPostAdd((e=>{e.forEach((e=>{let t=e.nodeModel.getParent().options.grid.idx,i=e.nodeModel.options.grid.idx,n=e.nodeModel.getParent().getLabel(),a=e.nodeModel.getLabel();if(void 0!==t){let e=this.breadcrumb;s.publish({event:this.ctx+"treeViewSelection",data:{selectedSeq:t,selectedCnt:i,labelSeq:n,labelCnt:a,treeViewBC:e}}),this.isVerticalMobile&&v.setPanelVisibility(!1)}this.dataGridView.columns.getCellKPIColor=function(e){if(null===e.nodeModel.getChildren()){let t=e.nodeModel.getParent().getLabel();if(e.nodeModel.getLabel()===a&&t===n)return"#54a3dc"}}}))})),this.dataGridView.rowSelection="single",this.clearPanelContent(),this.dataGridView.inject(this._panelContent)},_selectView:function(){this.currentView=this.changeViewCombo.currentValue;let e=this.currentView;"treeView"===e?this.disableBreadCrumbItems():this.enableBreadCrumbItems(),s.publish({event:this.ctx+"changeViewClickOn",data:{comboItem:e}})},setPanelVisibility:function(e){this._panel&&(this._panel.visibleFlag=e)},getPanelVisibility:function(){return void 0!==this._panel&&this._panel.visibleFlag},getCurrentView:function(){return this.currentView},setChooseContentVisibility:function(e,t){let i=this._panel.getModel();e?(this._panelContent.style.visibility="visible",i.height=this.immersiveFrame.getFreeZone().clientWidth>550?450:this.immersiveFrame.getFreeZone().clientHeight,i.resizableFlag=!0,this.isContentVisible=!0):(this._panelContent.style.visibility="hidden",t?setTimeout((()=>{this._panel.getModel().height=0}),300):i.height=0,i.resizableFlag=!1,this.isContentVisible=!1)},getChooseContentVisibility:function(){return"visible"===this._panelContent.style.visibility},updateContent:function(e){this.myResponsiveTilesCollectionView=(new r).inject(this._panelContent),this.myResponsiveTilesCollectionView.onSelectionAdd((e=>{let t,i=e.options.value[0].id,n=e.options.value[0].tag,a=e._options.label;e._options.subLabel&&(t=e._options.subLabel);let o=this.breadcrumb;s.publish({event:this.ctx+"thumbnailClickOn",data:{idx:i,tag:n,thumbName:a,breadcrumbCC:o,subLabel:t}})})),this.myResponsiveTilesCollectionView.loadApplicativeModel(e);let t=this.myResponsiveTilesCollectionView.getContent();if(this.myResponsiveTilesCollectionView){this.myResponsiveTilesCollectionView.TreedocModel.getRoots().forEach((e=>{this.setContentState(e._options.id,e._options.loaded?p.LOADED:p.NOT_LOADED)}))}t.classList.add("spy-msr-collectionview-panel")},getCellByID:(e,t)=>{let i=null;if(e){e.TreedocModel.getRoots().forEach((function(e){e._options.id===t&&(i=e)}))}return i},updateGlobalProgress:function(e){if(!isNaN(e)){let t=this.breadcrumb.breadCrumbCC.elements.container.parentElement,i=t.querySelector(".spy-breadcrumb-global-percentage");if(!i){let e=document.createElement("div");e.textContent="--%",e.classList.add("spy-breadcrumb-global-percentage"),e.classList.add(".wux-ui-is-rendered"),t.prepend(e),i=e}i.innerHTML=e<=0||e>=100?"":" ("+~~e+"%)"}},setSeqState:function(e,t,i){let n=this.getCellByID(this.myResponsiveTilesCollectionView,e);t==p.NOT_LOADED?n&&(n.updateOptions({disabled:!0}),n.setLabel(n.options.name)):t==p.LOADING?n&&(n.updateOptions({disabled:!1}),n.setLabel(n.options.name+" ("+~~i+"%)")):t==p.LOADED&&n&&(n.updateOptions({disabled:!1}),n.setLabel(n.options.name))},setContentState:function(e,t,i){let n=this.getCellByID(this.myResponsiveTilesCollectionView,e);n&&(t==p.NOT_LOADED?n.updateOptions({disabled:!0}):t==p.LOADING&&i?n&&(n.updateOptions({disabled:!1}),n.setLabel(n.options.name+" ("+~~i+"%)")):t==p.LOADED&&n.updateOptions({disabled:!1}))},getPanelDescriptor:function(){return{isPanelVisible:this._panel.visibleFlag,isContentVisible:this.isContentVisible,getBreadcrumb:()=>this.breadcrumb,getResponsiveTilesView:()=>this.myResponsiveTilesCollectionView,getTreeViewModel:()=>this.dataGridView}},clearPanelContent:function(){this._panelContent.getChildren().forEach((e=>{this._panelContent.removeChild(e)}))},removeReport:function(){this._loadingReport&&this._loadingReport.remove()},createReport:function(e){var i=e.noStream,a=!isNaN(e.streamTimeOut),s=!isNaN(e.invalidStreamNb),o=e.filteredContent,r=!o&&!isNaN(e.filteredDDNb)&&e.filteredDDNb>0;if(i||a||s||o||r){this._loadingReport=new n.Element("div",{class:"spy-report-container"}).inject(this.reportZone);var l=function(e,t){var i,a="wux-ui-3ds wux-ui-3ds-1x spy-report-icon";"warning"===e?(a+=" wux-ui-3ds-alert spy-report-alertIcon",i="spy-report-alert"):(a+=" wux-ui-3ds-info spy-report-infoIcon",i="spy-report-info");var s=new n.Element("div",{class:i}).inject(this._loadingReport);new n.Element("span",{class:a}).inject(s);new n.Element("span",{class:"spy-report-text"}).inject(s).setText(t)}.bind(this),c=function(e,i,n){var a=t[i];l(e,n?n+" "+a:a)};if(i)c("warning","noStream");else{if(a){var h=new n.Element("div",{class:"spy-report-alert"}).inject(this._loadingReport),d=new n.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-alert spy-report-icon spy-report-alertIcon"}).inject(h),u=new n.Element("span",{class:"spy-report-text"}),m=new n.Element("a",{class:"spy-report-text"}),g=new n.Element("ul"),p=function(e){e.stopPropagation(),g.show(),d.hide(),u.hide(),m.hide()};if(u.inject(h),u.setText(t.timeOut),m.addEvent("click",p),h.addEvent("click",p),m.inject(h),g.addEvent("click",(function(e){e.stopPropagation(),g.hide(),d.show(),u.show(),m.show()})),g.inject(h),g.hide(),m.setText(t.timeOutMore),navigator.userAgent.indexOf("Trident")>=0)new n.Element("li",{class:"spy-report-text"}).inject(g).setText(t.timeOutCause1);new n.Element("li",{class:"spy-report-text"}).inject(g).setText(t.timeOutCause2),new n.Element("li",{class:"spy-report-text"}).inject(g).setText(t.timeOutCause3)}s&&c("info",e.invalidStreamNb>1?"invalid":"invalid1",e.invalidStreamNb.toString()),o&&c("info","filteredContent"),r&&c("info",e.filteredDDNb>1?"partialFiltered":"partialFiltered1",e.filteredDDNb.toString())}}},handleResponsive:function(e){this._panel&&(this._panel.maximizedFlag=e,this._panel.resizableFlag=!e);let t=this.getChooseContentVisibility();if(e){this._lastContentAreaVisibilityBeforeMobile=t;let e=t||!0;this.setChooseContentVisibility(e,!0),this.setPanelVisibility(t)}else{let e=this.getPanelVisibility();this.setChooseContentVisibility(e,!0),this.setPanelVisibility(!0)}this.isVerticalMobile=e},handleResize:function(e){e&&e.clientWidth<550&&(this._panel.width=e.clientWidth)},disableBreadCrumbItems:function(){if(this._headerContainer){this._headerContainer.querySelector(g+"-1").classList.add(m),this._headerContainer.querySelector(g+"-0").classList.add(m)}},enableBreadCrumbItems:function(){if(this._headerContainer){this._headerContainer.querySelector(g+"-1").classList.remove(m),this._headerContainer.querySelector(g+"-0").classList.remove(m)}},getCurrentSelectedValue:function(){let e,t=this.breadcrumb.breadCrumbCC.getContent().dsModel,i=t?t.selectedValues:void 0;return t&&Array.isArray(i)&&i[0]&&(e=i[0].value),e},getStates:function(){return p},resetLeftIfNegative:function(){if(this._panel){let e=this._panel.elements.container.style.left;e&&e.includes("-")&&(this._panel.elements.container.style.left="0px")}}});return v})),define("DS/SPYUI/controllers/CATSimNavDataOverlaysManager",["css!DS/SPYUI/controllers/CATSimNavDataOverlaysManager.css","i18n!DS/SPYUI/assets/nls/CATSimNavDataOverlaysManager","UWA/Core","UWA/Class","DS/Core/Core","DS/CoreEvents/Events","DS/Tree/TreeListView","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/Visualization/PathElement"],(function(e,t,i,n,a,s,o,r,l,c){"use strict";var h=function(e,t){e&&(e.setAttribute("visibility",t),e.spyVisIcon&&e.spyVisIcon.setAttribute("visFlag",t?"shown":"hidden"))},d=n.extend({init:function(e){if(this._parent(),e&&e.parentContainer&&e.viewer&&e.model&&e.model.streamlines){this._viewer=e.viewer,this._eventId=e.model.eventId,this._onVisibilityChange=e.onVisibilityChange;var n=t.get("nameAttr");this._treeListOptions={apiVersion:2,performances:{renderingMode:"adaptive"},defaultCellHeight:40,iconsSize:0,isEditable:!0,shouldBeEditable:!1,columns:[{text:"",dataIndex:"visibility",width:30,onCellRequest:function(e){if(!e.isHeader){var t=function(e){return new i.Element("div",{class:"spy-overlay-iconCell spy-overlay-visibiltyIcon",visFlag:e?"shown":"hidden"})}(e.nodeModel.options.grid.visibility);e.cellView.getContent().setContent(t),e.nodeModel.spyVisIcon=t}}},{text:n,dataIndex:"tree"}],roots:[],allowUnsafeHTMLLabel:!0},this._treeListOptions.show={columnHeaders:!1},this._treeListOptions.height=150,this._treeListOptions.useAsyncPreExpand=!0,this._treeListOptions.selection={nodes:!1,rowHeaders:!1,columnHeaders:!1,toggle:!1,canMultiSelect:!1},this._treeModel=new r({shouldAcceptDrop:function(){return!1}});for(var a=e.model.streamlines,s=0;s<a.length;s++){var h=a[s],d=new l({label:h.name,grid:{visibility:h.visibility,tree:h.name}});d.spmElement=h,h.treeNode=d,this._treeModel.addRoot(d)}this._container=new i.Element("div",{class:"spy-overlay-container"}).inject(e.parentContainer),this._containerHeader=new i.Element("div").inject(this._container),this._titleIcon=new i.Element("span",{class:"spy-overlay-titleIcon"}).inject(this._containerHeader),this._title=new i.Element("span",{class:"spy-overlay-title"}).inject(this._containerHeader),this._title.setText(t.get("title")),this._treeListOptions.treeDocument=this._treeModel,this._treeListView=new o(this._treeListOptions).inject(this._container),this._treeListView.getContent().addClassName("spy-overlay-treelistview-theme");var u=function(e){if(e&&e.spmElement){var t=e.spmElement;t&&t.isActive&&t.isActive()&&this._viewer&&t.QI("CATISimNavDataSpecUI",function(t){var i=new c([t.node.getParents()[0],t.node]);this._viewer.addToCSOHSO({path:[i]},{multiSel:!1,trapSel:!1}),setTimeout((function(){e.unhighlight()}),300)}.bind(this))}}.bind(this);this._treeListView.onNodeClick((function(e){u(e.nodeModel)}))}},startSync:function(){this._eventId&&!this._visChangeCallback&&(this._visChangeCallback=s.subscribe({event:this._eventId},this._visibilityChanged.bind(this)))},stopSync:function(){this._visChangeCallback&&(s.unsubscribe(this._visChangeCallback),this._visChangeCallback=null)},showAll:function(){for(var e=this._treeModel.getRoots(),t=0;t<e.length;t++)h(e[t],!0)},setRightOffset:function(e){isNaN(e)||(this._container.style.right=e>0?(e+40).toString()+"px":"")},_visibilityChanged:function(e){e.isAStreamLine&&e.treeNode&&h(e.treeNode,!e.treeNode.options.grid.visibility)}});return i.namespace("DS/SPYUI/controllers/CATSimNavDataOverlaysManager",d)})),define("DS/SPYUI/CATSimNavDataWatermark",["css!DS/SPYUI/CATSimNavDataWatermark.css","UWA/Core","UWA/Class"],(function(e,t,i){"use strict";var n=i.extend({init:function(e){this._parent(),e&&e.imageURL&&e.parentContainer&&(this._container=new t.Element("div",{class:"spy-watermark-container"}).inject(e.parentContainer),this._image=new t.Element("img",{class:"spy-watermark-image"}).inject(this._container),this._image.src=e.imageURL,e.actionBarManager&&e.actionBarManager.addToActionBarEvent(this._container))},setRightOffset:function(e){isNaN(e)||(this._container.style.right=e>0?(e+30).toString()+"px":"")},setBottomOffset:function(e){isNaN(e)||(this._container.style.bottom=e>0?(e+50).toString()+"px":"")},show:function(){this._image&&this._image.show()},hide:function(){this._image&&this._image.hide()},drawToCanvas:function(e){e&&this._container&&this._image&&e.drawImage(this._image,this._container.offsetLeft,this._container.offsetTop,this._image.width,this._image.height)}});return t.namespace("DS/SPYUI/CATSimNavDataWatermark",n)})),define("DS/SPYUI/CATSimNavDataSpeedControl",["css!DS/SPYUI/CATSimNavDataSpeedControl.css","i18n!DS/SPYUI/assets/nls/CATSimNavDataSpeedControl","UWA/Core","DS/CoreEvents/Events","DS/Controls/Button","DS/Controls/ButtonGroup","DS/Windows/ImmersiveFrame","DS/Windows/Panel"],(function(e,t,i,n,a,s,o,r){"use strict";var l=i.Class.extend({_setPanelPosition:function(e){this._panel&&this._panel.elements.container&&this._panel.setProperties({position:{my:"bottom left",at:"bottom left",offsetY:e}})},init:function(e){this._parent();var l=new i.Element("div",{class:"spy-speedcontrol-container",id:"speed"});this._label=new i.Element("span",{class:"spy-speedcontrol-label"}).inject(l),this._label.setText(t.get("title")),this._buttonGroup=new s,this._buttonGroup.inject(l),this._buttonGroup.elements.container.addClassName("spy-speedcontrol-buttongroup"),this._buttonGroup.addChild(new a({type:"radio",label:"1/8",value:.125,allowUnsafeHTMLLabel:!0})),this._buttonGroup.addChild(new a({type:"radio",label:"1/4",value:.25,allowUnsafeHTMLLabel:!0})),this._buttonGroup.addChild(new a({type:"radio",label:"1/2",value:.5,allowUnsafeHTMLLabel:!0})),this._buttonGroup.addChild(new a({type:"radio",label:"x1",value:1,allowUnsafeHTMLLabel:!0})),this._buttonGroup.addChild(new a({type:"radio",label:"x2",value:2,allowUnsafeHTMLLabel:!0})),this._buttonGroup.addChild(new a({type:"radio",label:"x4",value:4,allowUnsafeHTMLLabel:!0})),this._buttonGroup.addChild(new a({type:"radio",label:"x8",value:8,allowUnsafeHTMLLabel:!0})),this._buttonGroup.multiSelFlag=!1,this._buttonGroup.addEventListener("change",(function(t){e.onChange(t.dsModel.value[0])}));var c=this._buttonGroup.getButtonFromValue(e.speedFactor);c&&this._buttonGroup.selectIndex(this._buttonGroup.getButtonIndex(c));var h=new o({identifier:"SPY_SpeedControlFrame"});if(this._panel=new r({titleBarVisibleFlag:!1,visibleFlag:!1,content:l,position:{my:"bottom left",at:"bottom left",offsetY:-120},resizableFlag:!1,allowedDockAreas:0,identifier:"SPY_SpeedControl_Panel"}),this._setPanelPosition(-120),e.actionBar){var d=e.actionBar;d.getLabelsVisibility()&&this._setPanelPosition(-150),d.onShowLabels(function(){this._setPanelPosition(-150)}.bind(this)),d.onHideLabels(function(){this._setPanelPosition(-120)}.bind(this))}h.addWindow(this._panel),h.inject(e.container),e.resizeEvent&&(this.resizeCallback=n.subscribe({event:e.resizeEvent},this.updateSizeResponsive.bind(this))),this.updateSizeResponsive(e.initialLayoutId),setTimeout(function(){this._panel.show()}.bind(this),150)},destroy:function(){this._panel.close(),this._parent(),n.unsubscribe(this.resizeCallback)},updateSizeResponsive:function(e){"small"===e?(this._label.hide(),this._buttonGroup.minButtonWidth=40):(this._label.show(),this._buttonGroup.minButtonWidth=65)}});return i.namespace("DS/SPYUI/CATSimNavDataSpeedControl",l)})),define("DS/SPYUI/commands/CATSPYKeepOnlyCmd",["UWA/Core","DS/ApplicationFrame/CommandCheckHeader","DS/CoreEvents/Events"],(function(e,t,i){"use strict";return t.extend({init:function(e){this._parent(e),this.onStateChange(function(){if(!this._processingStateChange){this._processingStateChange=!0;var e=this.getState();i.publish({event:this._context+"/SPY/SELECTION/KEEPONLY"+(e?"_ON":"_OFF"),data:this}),this._processingStateChange=void 0}}.bind(this))}})})),define("DS/SPYUI/controllers/ViewpointHelper",["UWA/Core","UWA/Class","DS/Visualization/ThreeJS_DS"],(function(e,t,i){"use strict";let n=t.singleton({extractViewpoint:function(e,t,i,n){if(t){let a=e.getEyePosition(),s=e.getSightDirection(),o=e.getUpDirection();if(a&&s&&o){let r=function(e){return{x:e.x,y:e.y,z:e.z}};i&&(r=function(e){return{x:e.x.toString(),y:e.y.toString(),z:e.z.toString()}}),t.cameraCheckValue=n?e[n]:void 0,t.cameraPosition=r(a),t.cameraTarget=r(s),t.cameraUp=r(o),t.targetDistance=e.getTargetDistance(),t.angle=e.getAngle(),t.projectionType=e.getProjectionType(),t.modelBoundingSphere=e.getBoundingSphere().radius}}},updateViewpoint:function(e,t,n){isNaN(t.projectionType)||e.getProjectionType()!==t.projectionType&&e.setProjectionType(t.projectionType);let a=function(e){return new i.Vector3(1*e.x,1*e.y,1*e.z)};n&&(a=function(e){return new i.Vector3(1*parseFloat(e.x),1*parseFloat(e.y),1*parseFloat(e.z))}),t.cameraTarget&&e.setSightDirection(a(t.cameraTarget)),t.cameraUp&&e.setUpDirection(a(t.cameraUp)),t.cameraPosition&&e.setEyePosition(a(t.cameraPosition)),isNaN(t.targetDistance)||e.setTargetDistance(t.targetDistance),isNaN(t.angle)||e.setAngle(t.angle)}});return e.namespace("DS/SPYUI/controllers/ViewpointHelper",n)})),define("DS/SPYUI/LWTextureAnimationVizExtension",["UWA/Class","DS/Visualization/ThreeJS_DS"],(function(e,t){"use strict";return e.extend({init:function(e){this._parent(e),this._id=e.id,this._textures=[]},getId:function(){return this._id},setTexture:function(e,i){i&&!isNaN(e)&&(this._textures[e]=i,this._originalTexture&&(i.offset.x=this._originalTexture.offset.x,i.offset.y=this._originalTexture.offset.y,i.repeat.x=this._originalTexture.repeat.x,i.repeat.y=this._originalTexture.repeat.y,i.wrapS=this._originalTexture.wrapS,i.wrapT=this._originalTexture.wrapT),i.minFilter=t.NearestFilter,i.magFilter=t.NearestFilter,i.needsUpdate=!0)},build3D:function(e){if(!e||!e.modelManager||!e.loadDescription||isNaN(e.sequenceIdx))return;this._geometries=e.node;let t=this._geometries.children[0];if(t){this._texturedMaterial=t.children[0].getPrimitives()[0].sgNode.getGroup().material,this._texturedMaterial.map&&(this._originalTexture=this._texturedMaterial.map);var i,n=[];isNaN(e.animationIndex)||(this.animationIndex=e.animationIndex),i=e.loadDescription.files,isNaN(this.animationIndex)&&(this.animationIndex=i.length-1),n[0]=i[this.animationIndex],e.modelManager.loadFiles({type:"Texture",initProgressFromCurrent:e.initProgressFromCurrent,filesList:n,framesIndices:[this.animationIndex],manager:this,sequence:e.sequenceIdx,callback:function(t){this.animate(this.animationIndex),e.postLoadingCallback&&e.postLoadingCallback(this.animationIndex,t)}.bind(this),resetProgress:!1})}e.modelManager.processLoadFiles("Texture")},initAnimation:function(e){e&&e()},animate:function(e){let t=this._geometries.children[0];if(this._geometries.children.length>1&&(t=this._geometries.children.find((t=>t._SPYFrameIndex===e))),this._texturedMaterial=t.children[0].getPrimitives()[0].sgNode.getGroup().material,t&&this._texturedMaterial&&this._textures[e]){var i=this._textures[e];this._texturedMaterial.map=i}}})})),define("DS/SPYUI/LWInstancingVizExtension",["UWA/Class","DS/Visualization/ThreeJS_DS"],(function(e,t){"use strict";var i={ComputeObjectPosition:["vec3 ComputeObjectPosition() {","vec3 localPosition = vGetAttribPosition();","vec3 v3sq = vec3(instanceDirection.x * instanceDirection.x, instanceDirection.y * instanceDirection.y, instanceDirection.z * instanceDirection.z);","float xy = instanceDirection.x * instanceDirection.y;","float xz = instanceDirection.x * instanceDirection.z;","float yz = instanceDirection.y * instanceDirection.z;","float fCos = instanceRotation.y;","vec3 rot = instanceDirection * instanceRotation.x;","float bidirectional = instanceBidirectional * instanceRotation.x;","mat3 m = mat3(v3sq.x + (v3sq.y + v3sq.z) * fCos, xy - xy*fCos + rot.z, xz - xz*fCos - rot.y,xy - xy*fCos - rot.z, v3sq.y + (v3sq.x + v3sq.z) * fCos, yz - yz*fCos + rot.x,xz - xz*fCos + rot.y, yz - yz*fCos - rot.x, v3sq.z + (v3sq.x + v3sq.y) * fCos);","if (0.0 < instance3D)","vNormal = normalize(m * vGetAttribNormal());","mat3 ms = mat3(instanceScale, 0.0, 0.0, 0.0, instanceScale, 0.0, 0.0, 0.0, instanceScale);","m *= ms;","vec3 v3Pos = localPosition;","if (bidirectional > 0.0 && instanceValue < 0.0&& (v3Pos.x != 0.0 || v3Pos.y != 0.0))","v3Pos.z = v3Pos.z < 0.0 ? -1.0 : 1.0;","v3Pos = m * v3Pos;","return v3Pos + instancePosition;","}"].join("\n"),ComputeVaryingValues:["void ComputeVaryingValues() {","vec3 blue = vec3(0.0, 0.0, 1.0);","vec3 green = vec3(0.0, 1.0, 0.0);","vec3 red = vec3(1.0, 0.0, 0.0);","if (instanceValue < 0.5)","vColor = mix(blue, green, instanceValue * 2.0);","else","vColor = mix(green, red, (instanceValue - 0.5) * 2.0);","}"].join("\n")},n={ComputeAlbedo:["vec3 ComputeAlbedo() {","return vColor;","}"].join("\n"),ComputeSpecularReflectance:["vec3 ComputeSpecularReflectance() {","return vec3(1.0,1.0,1.0);","}"].join("\n"),ComputeViewNormal:["vec3 ComputeViewNormal() {","return vNormal;","}"].join("\n")};return e.extend({init:function(e){this._parent(),this._positions=[],this._directions=[],this._scales=[],this._values=[],this._rotations=[],this._bidirectional=[],this._is3D=[],this._attributes=[{data:this._positions,type:"v3",attribName:"instancePosition"},{data:this._directions,type:"v3",attribName:"instanceDirection"},{data:this._scales,type:"f",attribName:"instanceScale"},{data:this._values,type:"f",attribName:"instanceValue"},{data:this._rotations,type:"v2",attribName:"instanceRotation"},{data:this._bidirectional,type:"f",attribName:"instanceBidirectional"},{data:this._is3D,type:"f",attribName:"instance3D"}],this._instancesNumber=0,this._buffers=[]},setBuffers:function(e,t,i,n,a,s,o,r,l){this._buffers[e]={instancesNumber:t,positions:i,directions:n,scalingFactors:a,values:s,rotations:o,bidirectionalFactors:r,is3DFactors:l},this._attributes[0].data=i,this._attributes[1].data=n,this._attributes[2].data=a,this._attributes[3].data=s,this._attributes[4].data=o,this._attributes[5].data=r,this._attributes[6].data=l,this._instancesNumber=t,this._positions=i,this._directions=n,this._scales=a,this._values=s,this._rotations=o,this._bidirectional=r,this._is3D=l},build3D:function(e){if(e&&e.modelManager&&e.loadDescription&&!isNaN(e.sequenceIdx)){if(e.node.children.length>0&&(this._geometry=e.node.children[0]),this._geometry){var a=t.MaterialUtils.createShinyFaceMaterial({force:!0});a.activatePDSFX();a.setPDSFXVaryings({vColor:{type:"v3"},vNormal:{type:"v3"}}),a.setPDSFXOverridableFunctions(i,n),this._geometry.setMaterial(a);var s,o=[];isNaN(e.animationIndex)||(this.animationIndex=e.animationIndex),s=e.loadDescription.files,isNaN(this.animationIndex)&&(this.animationIndex=s.length-1),o[0]=s[this.animationIndex],e.modelManager.loadFiles({type:"Instancing",initProgressFromCurrent:e.initProgressFromCurrent,filesList:o,framesIndices:[this.animationIndex],manager:this,sequence:e.sequenceIdx,callback:function(){this.animate(this.animationIndex),e.postLoadingCallbackcallback&&e.postLoadingCallbackcallback(this.animationIndex)}.bind(this),resetProgress:!1})}e.modelManager.processLoadFiles("Instancing")}},initAnimation:function(e){e&&e()},animate:function(e){if(this._geometry&&this._buffers[e]&&(this._instancesNumber=this._buffers[e].instancesNumber,this._positions=this._buffers[e].positions,this._directions=this._buffers[e].directions,this._scales=this._buffers[e].scalingFactors,this._values=this._buffers[e].values,this._rotations=this._buffers[e].rotations,this._bidirectional=this._buffers[e].bidirectionalFactors,this._is3D=this._buffers[e].is3DFactors,this._attributes[0].data=this._positions,this._attributes[1].data=this._directions,this._attributes[2].data=this._scales,this._attributes[3].data=this._values,this._attributes[4].data=this._rotations,this._attributes[5].data=this._bidirectional,this._attributes[6].data=this._is3D,this._instancesNumber>0)){var i=new t.Sphere,n=Object.assign({},this._positions[0]),a=Object.assign({},this._positions[0]);this._positions.forEach(((e,t)=>{e.x<n.x&&(n.x=e.x),e.x>a.x&&(a.x=e.x),e.y<n.y&&(n.y=e.y),e.y>a.y&&(a.y=e.y),e.z<n.z&&(n.z=e.z),e.z>a.z&&(a.z=e.z)}));var s=a.x-n.x,o=a.y-n.y,r=a.z-n.z;i.radius=Math.sqrt(s*s+o*o+r*r),this._geometry.forceBoundingSphere(i),this._geometry.setInstancingParameters(this._instancesNumber,this._attributes)}}})})),define("DS/SPYUI/CATSimNavDataMaxiPlayer",["css!DS/SPYUI/CATSimNavDataMaxiPlayer.css","UWA/Core","DS/CoreEvents/Events","DS/ApplicationFrame/AfrPlayerService","DS/Controls/Timeline","DS/ApplicationFrame/PlayerStyle"],(function(e,t,i,n,a,s){"use strict";var o=t.Class.extend({_setAfrPlayerLoopMode:function(e){for(var t=0;t<n._playerModel.elements.length;t++){var i=n._playerModel.elements[t].id;"loopRCBF"!==i&&"loopRC"!==i&&"loopRO"!==i||(n._playerModel.elements[t].hiddenByDefault=i!==e||void 0)}},_computeAfrProgress:function(e){var t=NaN;return e>=this.minValue&&e<=this.maxValue&&(t=(e-this.minValue)/(this.maxValue-this.minValue)),t},_computeIndex:function(e){return Math.round(e*(this.maxValue-this.minValue))+this.minValue},_formatterLabel:function(e){return this._computeIndex(e).toString()},_conditionalUpdate:function(e){this.canPlayerChangeTo?this.canPlayerChangeTo(e,this._realUpdate.bind(this),function(){this._loopToReset=void 0!==this._animationLoop,this._loopToReset&&(clearInterval(this._animationLoop),this._animationLoop=void 0)}.bind(this),function(e){this._realUpdate(e),this._loopToReset&&this._animatingFlag&&(this._animationLoop=setInterval(this._loopFunction.bind(this),this.intervalMS/this._speedFactor),this._loopToReset=!1)}.bind(this)):this._realUpdate(e)},_realUpdate:function(e){this.onPlayerChange&&this.onPlayerChange(e,this.playerForwardDirection),this.updateTimeline(e)},_loopFunction:function(){this.playerValue===this.maxValue?(this.playerForwardDirection="loopRCBF"!==this._loopMode,this._onCompleteRun&&this._onCompleteRun()):this.playerValue===this.minValue&&(this.playerForwardDirection=!0);var e=!0;this.playerForwardDirection?(this.playerValue++,this.playerValue>this.maxValue&&("loopRO"===this._loopMode?(this.end(),e=!1):"loopRC"===this._loopMode&&(this.playerValue=this.minValue))):this.playerValue--,e&&this._conditionalUpdate(this.playerValue)},init:function(e){if(this._parent(),this._onCompleteRun=e.onCompleteRun,this._speedFactor=1,this._loopMode="loopRC",this.container=new t.Element("div",{class:"spy-maxiplayer-container",id:"player",debug:!0}),this.playerDiv=new t.Element("div",{class:"playerBorder spy-maxiplayer-afrtuning"}),this.playerDiv.insertPlayer=function(e){e.inject(this.playerDiv),this.container.playerView=e}.bind(this),this.playerDiv.removePlayer=function(e){e&&e.remove&&e.remove(),this.container.playerView=null}.bind(this),this.playerDiv.inject(this.container),e){if(this.minValue=e.minValue?e.minValue:1,this.maxValue=e.maxValue?e.maxValue:1,this.playerValue=e.initValue?e.initValue:1,this.intervalMS=e.intervalMS?e.intervalMS:200,this.canPlayerChangeTo=e.canPlayerChangeTo,this.onPlayerChange=e.onPlayerChange,this.onBegin=e.onBegin,this.onPrevious=e.onPrevious,this.onNext=e.onNext,this.onStop=e.onStop,this.onPause=e.onPause,this.onPlay=e.onPlay,this.onEnd=e.onEnd,this.onLoopOnce=e.onLoopOnce,this.onLoopRepeat=e.onLoopRepeat,this.onLoopBounce=e.onLoopBounce,this.onOptions=e.onOptions,this.onExit=e.onExit,this.isReduced=e.isReduced,this._loopModeButtons=[],e){var i=!0===e.isReduced?[1,2,3,5,8,9,11,12]:[2,5,11],a={style:s.SIMULATION,excludedElements:i,useTotal:!1,editableLabel:!1,callbacks:{},formatterLabel:this._formatterLabel.bind(this)};a.callbacks[n.actions.FIRST]=function(e){this.begin(e)}.bind(this),a.callbacks[n.actions.BACK]=function(e){this._processingPrevNext=!0,this.previous(e),this._processingPrevNext=!1}.bind(this),a.callbacks[n.actions.STOP]=function(e){this.stop(e)}.bind(this),a.callbacks[n.actions.PAUSE]=function(e){this.pause(e)}.bind(this),a.callbacks[n.actions.PLAY]=function(e){this.play(e)}.bind(this),a.callbacks[n.actions.NEXT]=function(e){this._processingPrevNext=!0,this.next(e),this._processingPrevNext=!1}.bind(this),a.callbacks[n.actions.LAST]=function(e){this.end(e)}.bind(this),a.callbacks[n.actions.LOOPRC]=function(e){this.loopBounce(e)}.bind(this),a.callbacks[n.actions.LOOPRCBF]=function(e){this.loopOnce(e)}.bind(this),a.callbacks[n.actions.LOOPRO]=function(e){this.loopRepeat(e)}.bind(this),a.callbacks[n.actions.OPTIONS]=function(){this.onOptions()}.bind(this),a.callbacks[n.actions.EXIT]=function(){this.onExit()}.bind(this),a.callbacks[n.actions.SLIDER_CHANGE]=function(e){this._processingPrevNext||this._updatingTimeline||(this.playerValue=this._computeIndex(e.data.value),this.onPlayerChange&&this.onPlayerChange(this.playerValue,this.playerForwardDirection))}.bind(this),t.debug=!0,n.registerPlayerContainer(this.playerDiv),t.debug=!1,n.createPlayer(a),this._loopMode=e.loopMode?e.loopMode:this._loopMode,this._setAfrPlayerLoopMode(this._loopMode),this.setCurrentSpeedFactor(e.speedFactor),n.showPlayer(),this.playerTimeline=!0,n.setState({state:"play",progress:this._computeAfrProgress(this.playerValue)}),this.container.addEventListener("contextmenu",(function(e){e.preventDefault()}),!1)}if(e.resizeManager&&e.resizeManager.addToResizeEvent(this.container),e.actionBarManager&&e.actionBarManager.addToActionBarEvent(this.container),e.actionBar){let t=e.actionBar;if(t&&t.getLabelsVisibility){t.getLabelsVisibility()&&this.container.addClassName("show-labels");var o=function(){this.container&&this.container.toggleClassName("show-labels")};t.onShowLabels(o.bind(this)),t.onHideLabels(o.bind(this))}}}},setRightOffset:function(e){isNaN(e)||(this.container.style.right=e>0?(e+30).toString()+"px":"")},setLeftOffset:function(e){isNaN(e)||(this.container.style.left=e>0?(e+30).toString()+"px":"")},begin:function(){this.stop(),this.playerValue=this.minValue,this._conditionalUpdate(this.playerValue),this.onBegin&&this.onBegin(this.playerValue)},previous:function(){this.playerValue=Math.max(--this.playerValue,this.minValue),this._conditionalUpdate(this.playerValue),this.onPrevious&&this.onPrevious(this.playerValue)},stop:function(){n.setState({state:"stop",progress:this._computeAfrProgress(this.playerValue)}),this._pauseButton&&this._pauseButton.hide(),this._playButton&&this._playButton.show(),clearInterval(this._animationLoop),this._animationLoop=void 0,this._animatingFlag=!1,this.onStop&&this.onStop(this.playerValue)},pause:function(){n.setState({state:"pause",progress:this._computeAfrProgress(this.playerValue)}),this._pauseButton&&this._pauseButton.hide(),this._playButton&&this._playButton.show(),clearInterval(this._animationLoop),this._animationLoop=void 0,this._animatingFlag=!1,this.onPause&&this.onPause(this.playerValue)},play:function(){this._pauseButton&&this._pauseButton.show(),this._playButton&&this._playButton.hide(),this._animationLoop&&clearInterval(this._animationLoop),this.playerValue===this.maxValue&&"loopRO"===this._loopMode&&(this.playerValue=this.minValue,this.playerTimeline||this.onPlayerChange&&this.onPlayerChange(this.playerValue,this.playerForwardDirection)),n.setState({state:"play",progress:this._computeAfrProgress(this.playerValue)}),this._slaveMode||(this._animationLoop=setInterval(this._loopFunction.bind(this),this.intervalMS/this._speedFactor)),this._animatingFlag=!0,this.onPlay&&this.onPlay()},next:function(){this.playerValue=Math.min(++this.playerValue,this.maxValue),this._conditionalUpdate(this.playerValue),this.onNext&&this.onNext(this.playerValue)},end:function(){this.stop(),this.playerValue=this.maxValue,this._conditionalUpdate(this.playerValue),this.onEnd&&this.onEnd(this.playerValue)},loopOnce:function(){this._loopMode="loopRO",this.onLoopOnce&&this.onLoopOnce()},loopRepeat:function(){this._loopMode="loopRC",this.onLoopRepeat&&this.onLoopRepeat()},loopBounce:function(){this._loopMode="loopRCBF",this.onLoopBounce&&this.onLoopBounce()},slowDown:function(){this.onSlowDown&&this.onSlowDown()},speedUp:function(){this.onSpeedUp&&this.onSpeedUp()},show:function(){n.showPlayer()},hide:function(){n.hidePlayer()},clear:function(){clearInterval(this._animationLoop),this._animationLoop=void 0,this._animatingFlag=!1,this.onClear&&this.onClear()},inject:function(e){this.container&&e&&(this.container.inject(e),!0===this.isReduced&&this.container.querySelector(".wux-controls-player-editor").addClassName("spy-reducedPlayer"))},removeFrom:function(e){e&&e.removeChild&&e.removeChild(this.container)},updateBoundaries:function(e,t,i){isNaN(e)||isNaN(t)||(this.minValue=e,this.maxValue=t,!isNaN(i)&&i<=t&&i>=e?this.playerValue=i:this.playerValue=t,this.updateTimeline(this.playerValue))},switchToSlaveMode:function(){this._slaveMode=!0},switchToDefaultMode:function(){this._slaveMode=void 0},getCurrentSpeedFactor:function(){return this._speedFactor},setCurrentSpeedFactor:function(e){this._speedFactor=isNaN(e)?this._speedFactor:e,this._animationLoop&&this._animatingFlag&&(clearInterval(this._animationLoop),this._animationLoop=setInterval(this._loopFunction.bind(this),this.intervalMS/this._speedFactor))},getLoopMode:function(){return this._loopMode},updateTimeline:function(e){if(this.playerTimeline){var t=n.getState().state;this._updatingTimeline=!0,n.setState({state:t,progress:this._computeAfrProgress(e)}),this._updatingTimeline=!1}}});return t.namespace("DS/SPYUI/CATSimNavDataMaxiPlayer",o)})),define("DS/SPYUI/CATSimNavDataSpecColorShading",["UWA/Core"],(function(e){"use strict";var t=e.Class.extend({init:function(){},setShadingColor:function(e){for(var t=!1,i={red:255,green:255,blue:255},n=0;n<e.length&&!t;n++)e[n].matchId===this.implementation.getId()&&(i=e[n].color,t=!0);this.shadingColor=i},getShadingColor:function(){return this.shadingColor},activateShading:function(){this.active=!0},deactivateShading:function(){this.active=!1},isShadingActive:function(){return this.active},resetOverride:function(){}});return e.namespace("DS/SPYUI/CATSimNavDataSpecColorShading",t)})),define("DS/SPYUI/ExtendedGuidanceMsg",["css!DS/SPYUI/Guidance.css","UWA/Core","UWA/Class","DS/WebSystem/Nls","DS/WebappsUtils/WebappsUtils"],(function(e,t,i,n,a){"use strict";var s=i.extend({init:function(e){this._parent(),e&&e.msgData&&e.nlsModule&&e.nlsFile&&e.parentContainer&&(this._wrapper=new t.Element("div",{class:"guidance-extmsg-wrapper"}).inject(e.parentContainer),this._container=new t.Element("div",{class:"guidance-extmsg-container",events:{click:this.hide.bind(this)}}).inject(this._wrapper),this._wrapper.hide(),e.msgData.content.forEach(function(i){var s=new t.Element("div",{class:"guidance-extmsg-line"}).inject(this._container);i.image&&(new t.Element("img",{class:"guidance-extmsg-image"}).inject(s).src=a.getWebappsBaseUrl()+i.image);var o=new t.Element("span",{class:"guidance-extmsg-text"}).inject(s);n.nls(e.nlsModule+"/"+e.nlsFile,i.text,(function(e){o.setText(e)}))}.bind(this)))},show:function(){this._wrapper&&this._wrapper.show()},hide:function(){this._wrapper&&this._wrapper.hide(),this.onHide&&this.onHide()},remove:function(){this._wrapper&&(this._wrapper.remove(),this._wrapper.destroy())},updateSizeResponsive:function(e){var t=["responsive-small","responsive-medium"];t.forEach(function(e){this._container.removeClassName(e)}.bind(this)),"small"===e?this._container.addClassName(t[0]):"medium"===e&&this._container.addClassName(t[1])}});return t.namespace("DS/SPYUI/ExtendedGuidanceMsg",s)})),define("DS/SPYUI/CATSimNavDataDisplayColorShadingManager",["UWA/Core","DS/SPY/CATSimNavDataFrameViewCompValue","DS/SPY/CATSimNavDataFrameView","DS/SPY/CATSimNavDataLink"],(function(e,t,i,n){"use strict";var a=function(e,t,i,n){if(e){var a=e.getNavData3DViewList();a=a.concat(e.getNavDataFrameViewList());for(var s=function(e){e&&(void 0===e.isShadingActive()||t===e.isShadingActive()||n)&&(t?e.activateShading({overrideSet:i}):e.deactivateShading({overrideSet:i}))},o=0;o<a.length;o++){var r=a[o];r&&r.QI("CATISimNavDataColorShading",s)}}},s=function(e,t){var i={},n=e>360?Math.floor(e)%360+(e-Math.floor(e)):e,a=t<0?0:t>1?1:t,s=a<=.5?Math.floor(510*a):255,o=a<=.5?0:Math.floor(510*(a-.5)),r=(s-o)/60;return n<=60?(i.red=s,i.green=o+r*n,i.blue=o):n>60&&n<=120?(i.red=s-Math.round(r*(n-60)),i.green=s,i.blue=o):n>120&&n<=180?(i.red=o,i.green=s,i.blue=o+Math.round(r*(n-120))):n>180&&n<=240?(i.red=o,i.green=s-Math.round(r*(n-180)),i.blue=s):n>240&&n<=300?(i.red=o+Math.round(r*(n-240)),i.green=o,i.blue=s):n>300&&n<=360&&(i.red=s,i.green=o,i.blue=s-Math.round(r*(n-300))),i.red=Math.round(i.red),i.green=Math.round(i.green),i.blue=Math.round(i.blue),i},o=e.Class.extend({init:function(e){this.implementation=e,this.active=!1,this.support=!1,this.supportInitDone=!1},getImpl:function(){return this.implementation},supportsShading:function(){if(!this.supportInitDone){var e=this.implementation;if(e){if(this.support="Material"===e.type,this.support)for(var a=e.getNavData3DViewList("plotContentOnly"),s=e.getNavDataFrameViewList(),o=0;o<a.length;o++){var r=a[o];if(r){var l=r.getType();if("CATSimNavData3DCamerasRoot"!==l&&"CATSimNavData3DExtremasRoot"!==l){for(var c=!1,h=0;h<s.length&&!c;h++)c=s[h].getId()===r.getId();if(!c){var d=new i(void 0,e);d.id=r.getId(),d.name=r.getName();var u=new n(void 0,e);u.setPointedData(r.getId()),d.addLink("Frameto3D",u);var m=new t(void 0,e);m.id="NoInfo",d.children.push(m),e.listFrameViews.push(d)}}}}this.supportInitDone=!0}}return this.support},computeColors:function(e,t){if(this.supportsShading()){var i=this.implementation.getNavDataFrameViewList(),n=0,a=0;if((e=i.length)<=10)n=e,a=1;else{var o=Math.sqrt(e),r=Math.floor(o);o===r?(n=r,a=r):r===Math.floor(o+.5)?(n=r+1,a=r):(n=Math.floor(o)+1)*(a=Math.floor(o)+1)<e&&n++}var l=function(e){var t=[],i=e.hueDivision,n=e.lightDivision,a=e.lightMin,o=e.lightMax;if(a>o||a<0||a>1||o<0||o>1||i<=0||n<=0)return t;var r,l=360/i,c=0,h=(o-a)/n,d=a;1===n&&(d=(o+a)/2);for(var u=1;u<=n;){for(var m=0,g=1;g<=i;)r=s(m+c,d),t.push({color:r}),m+=l,g++;(c+=l*(.5+Math.floor(i/3)))>360&&(c-=360),d+=h,u++}return t}({hueDivision:n,lightDivision:a,lightMin:.2,lightMax:.8});if(l.length>=e){for(var c=0;c<i.length;c++){var h=i[c],d=l[c];h&&d&&(d.matchId=h.getId())}for(var u=function(e,t,i,n){i&&t&&(e&&e.setShadingColor(t),i.count--,0===i.count&&i.loopEnded&&n&&n())},m=function(){for(var e={count:0,loopEnded:!1},n=function(i){u(i,l,e,t)},a=0;a<i.length;a++)e.count++,i[a].QI("CATISimNavDataColorShading",n);e.loopEnded=!0,0===e.count&&t()},g={count:0,loopEnded:!1},p=function(e){u(e,l,g,m)},v=this.implementation.getNavData3DViewList(),S=0;S<v.length;S++)g.count++,v[S].QI("CATISimNavDataColorShading",p);g.loopEnded=!0,0===g.count&&m()}}},toggleElementShading:function(e){if(e&&this._overrideSet){var t=this.implementation.getNavDataFrameViewList();e.QI("CATISimNavDataColorShading",function(e){var i=!e.isShadingActive();i?e.activateShading({overrideSet:this._overrideSet}):e.deactivateShading({overrideSet:this._overrideSet});for(var n=e.getShadingColor(),a=!1,s=function(e){if(e){var t=e.getShadingColor();(a=n.red===t.red&&n.green===t.green&&n.blue===t.blue)&&(i?e.activateShading():e.deactivateShading())}},o=0;o<t.length;o++){var r=t[o];r&&!a&&r.QI("CATISimNavDataColorShading",s)}}.bind(this))}},activateShading:function(e){this.supportsShading()&&(e&&e.overrideSet&&(this._overrideSet=e.overrideSet),this._overrideSet&&(a(this.implementation,!0,this._overrideSet,e&&e.forceFlag),this.active=!0,e&&e.viewer&&(e.viewer.render(),this._viewer=e.viewer),this._viewer&&this._viewer.render()))},deactivateShading:function(){this.supportsShading()&&this._overrideSet&&(a(this.implementation,!1,this._overrideSet,!0),this.active=!1,this._viewer&&this._viewer.render())},isShadingActive:function(){return this.active},resetOverride:function(){for(var e=this.implementation.getNavData3DViewList(),t=function(e){e&&e.resetOverride()},i=0;i<e.length;i++){var n=e[i];n&&n.QI("CATISimNavDataColorShading",t)}}});return e.namespace("DS/SPYUI/CATSimNavDataDisplayColorShadingManager",o)})),define("DS/SPYUI/controllers/SessionStateManager",["UWA/Core","UWA/Class","DS/CoreEvents/Events","DS/WebappsUtils/Promise"],(function(e,t,i,n){"use strict";var a="expandableId",s="expanded",o=function(e){return function(e,t,i){var n={};if(Array.isArray(e))for(var a of e)n[a[t]]={},Object.defineProperty(n[a[t]],i,{value:a[i],writable:!0});return n}(e,a,s)},r=function(e){return function(e,t,i){var n=[];for(var a in e){var s={};Object.defineProperty(s,t,{value:e[a],writable:!1}),Object.defineProperty(s,i,{value:e[a][i],writable:!1}),n.push(s)}}(e,a,s)};return t.singleton({resetSession:function(){this._session={version:"1.0"},this._session.viewpoint={},this._session.content={},this._session.camera={},this._session.time={},this._session.animationScope={},this._session.customization={},this._session.hidden3DElementsIds=[],this._session.panelsPreferences={},this._session.sidePanel={},this._session.expandableUI={},this._session.extractableUI={}},clean:function(){this._session=void 0,this._callbacks&&this._callbacks.forEach((function(e){i.unsubscribe(e)})),this._callbacks=[],this._activeContentRestore=void 0,this._activeCameraRestore=void 0,this._timeSelectionRestore=void 0,this._playExistNoRestoreNeeded=void 0,this._animScopeRestore=void 0,this._userMinRestore=void 0,this._userMaxRestore=void 0,this._viewpointRestore=void 0,this._hiddenElementsRestore=void 0,this._panelsPrefRestore=void 0,this._sidePanelStateRestore=void 0,this._expandableUIRestore=void 0,this._extractableUIRestore=void 0},initialize:function(e){this._parent(),this.clean(),this.resetSession(),this._resetValues={},this.MSRShareAs3DComment={key:"MSR_ExperienceContent",readCB:(e,t,i)=>{var n={onComplete:()=>{i&&i(),this._restoring3DComment=!1}};this._restoring3DComment=!0,this.loadState(e,n)},clearCB:()=>{console.log("clearCallback NOT IMPLEMENTED")},writeCB:()=>{let e={content:this._session.content,camera:this._session.camera,time:this._session.time,animationScope:this._session.animationScope,customization:this._session.customization,panelsPreferences:this._session.panelsPreferences,sidePanel:this._session.sidePanel,expandableUI:this._session.expandableUI,extractableUI:this._session.extractableUI};return e.customization.userMax||(e.customization.userMax=this._resetValues.computedMax),e.customization.userMin||(e.customization.userMin=this._resetValues.computedMin),e}};var t=e.persistency?function(t){var i=Object.assign({},t);delete i.hidden3DElementsIds,e.persistency(i)}:function(){},n=function(e,n,a){return this._callbacks.push(i.subscribe({event:e.eventId},function(i){if(!this._loading){var s={};e.onExtract(i,s);var o=a&&"object"==typeof this._session[n]?this._session[n]:{};this._session[n]=Object.assign(o,s),e.onPostExtract&&e.onPostExtract(i,this._session[n]),t(this._session)}}.bind(this))),e.onRestore}.bind(this),a=function(e,n,a){return this._callbacks.push(i.subscribe({event:e.eventId},function(i){if(!this._loading){if(a)e.onExtract(i,this._session[n]);else{var s=[];e.onExtract(i,s),this._session[n]=s.slice()}e.onPostExtract&&e.onPostExtract(i,this._session[n]),t(this._session)}}.bind(this))),e.onRestore}.bind(this);if(e.contentActivated){this.resetSession();var s=e.contentActivated;this._activeContentRestore=s.onRestore,this._callbacks.push(i.subscribe({event:s.eventId},function(n){i.publish({event:"SPY_LEGEND_GETMINMAX"}),this._loading||s.isSameContent(n,this._session.content)||(this.resetSession(),e.contentActivated.onExtract(n,this._session.content,this._session.camera,this._session.time,this._session.animationScope,this._session.customization,this._session.viewpoint,this._session.sidePanel),e.contentActivated.onPostExtract&&e.contentActivated.onPostExtract(n),t(this._session))}.bind(this)))}e.cameraActivated&&(this._activeCameraRestore=e.cameraActivated.onRestore,this._callbacks.push(i.subscribe({event:e.cameraActivated.eventId},function(i){this._loading||(e.cameraActivated.onExtract(i,this._session.camera),this._session.viewpoint={},t(this._session))}.bind(this)))),e.timeSelected&&(this._timeSelectionRestore=n(e.timeSelected,"time")),e.playExit&&(this._playExistNoRestoreNeeded=n(e.playExit,"time")),e.animationScopeChanged&&(this._animScopeRestore=n(e.animationScopeChanged,"animationScope")),e.userMinChanged&&(this._userMinRestore=n(e.userMinChanged,"customization",!0)),e.userMaxChanged&&(this._userMaxRestore=n(e.userMaxChanged,"customization",!0)),e.viewpointChanged&&(this._session.viewpoint={},e.viewpointChanged.viewpoint&&(this._callbacks.push(i.subscribe({event:"/VISU/"},function(i){this._loading||"@onViewpointEndMove"===i.eventType&&(e.viewpointChanged.onExtract(this._session.viewpoint),Object.keys(this._session.content).length>0&&t(this._session))}.bind(this))),this._viewpointRestore=e.viewpointChanged.onRestore)),e.visibilityChanged&&(this._hiddenElementsRestore=a(e.visibilityChanged,"hidden3DElementsIds",!0,!1)),e.panelsPreferencesChanged&&(this._panelsPrefRestore=n(e.panelsPreferencesChanged,"panelsPreferences")),e.sidePanelToggle&&(this._sidePanelStateRestore=n(e.sidePanelToggle,"sidePanel",!0)),e.expandableUIChanged&&(this._expandableUIRestore=n(e.expandableUIChanged,"expandableUI",!0)),e.extractableUIChanged&&(this._extractableUIRestore=n(e.extractableUIChanged,"extractableUI",!0))},destroy:function(){this.clean(),this._parent()},getState:function(){return this._session},saveStateToJSON:function(){return JSON.stringify(this.getState())},loadState:function(e,t){this._loading=!0;var i=function(e){t.onError&&t.onError(e),this._loading=!1}.bind(this),a=function(e){t.onComplete&&t.onComplete(e),this._loading=!1}.bind(this);new n(function(t){this._panelsPrefRestore&&e.panelsPreferences?this._panelsPrefRestore(e.panelsPreferences,function(){this._session.panelsPreferences=Object.assign({},e.panelsPreferences),t()}.bind(this)):t()}.bind(this)).then(function(){return new n(function(t){this._expandableUIRestore&&e.expandableUI&&this._expandableUIRestore(e.content,e.expandableUI,function(){this._session.expandableUI=Object.assign({},e.expandableUI)}.bind(this),(function(){reject(new Error("contentNotFound"))})),t()}.bind(this))}.bind(this)).then(function(){return new n(function(t){this._extractableUIRestore&&e.extractableUI?this._extractableUIRestore(e.content,e.extractableUI,function(){this._session.extractableUI=Object.assign({},e.extractableUI),t()}.bind(this),(function(){reject(new Error("contentNotFound"))})):t()}.bind(this))}.bind(this)).then(function(){return new n(function(i,n){this._activeContentRestore&&e.content?this._activeContentRestore(e.content,function(){this._session.content=Object.assign({},e.content),i()}.bind(this),(function(){n(new Error("contentNotFound"))}),{loadExtensionMode:t?t.loadExtensionMode:void 0,onExtensionGranted:t?t.onExtensionGranted:void 0}):i()}.bind(this))}.bind(this)).then(function(){return new n(function(t){this._activeCameraRestore&&e.camera?this._activeCameraRestore(e.camera,function(){this._session.camera=Object.assign({},e.camera),t()}.bind(this)):t()}.bind(this))}.bind(this)).then(function(){return new n(function(t){this._timeSelectionRestore&&e.time?this._timeSelectionRestore(e.time,function(){this._session.time=Object.assign({},e.time),t()}.bind(this)):t()}.bind(this))}.bind(this)).then(function(){return new n(function(t){this._animScopeRestore&&e.animationScope?this._animScopeRestore(e.animationScope,function(){this._session.animationScope=Object.assign({},e.animationScope),t()}.bind(this)):t()}.bind(this))}.bind(this)).then(function(){return new n(function(t){e.customization?void 0!==e.customization.userMin&&void 0!==this._userMinRestore?this._userMinRestore(e.customization.userMin,function(){this._session.customization.userMin=Object.assign({},e.customization.userMin),t()}.bind(this),function(){this._session.customization.userMin=void 0,t()}.bind(this)):t():t()}.bind(this))}.bind(this)).then(function(){return new n(function(t){e.customization?void 0!==e.customization.userMax&&void 0!==this._userMaxRestore?this._userMaxRestore(e.customization.userMax,function(){this._session.customization.userMax=Object.assign({},e.customization.userMax),t()}.bind(this),function(){this._session.customization.userMax=void 0,t()}.bind(this)):t():t()}.bind(this))}.bind(this)).then(function(){return new n(function(t){this._viewpointRestore&&e.viewpoint?this._viewpointRestore(e.viewpoint,function(){this._session.viewpoint=Object.assign({},e.viewpoint),t()}.bind(this)):t()}.bind(this))}.bind(this)).then(function(){return new n(function(t){let i=!1;if(e.content&&e.content.contentId===this._session.content.contentId){let t=!Array.isArray(e.hidden3DElementsIds)||0===e.hidden3DElementsIds.length,n=Array.isArray(this._session.hidden3DElementsIds)&&this._session.hidden3DElementsIds.length>0;i=t&&n}this._hiddenElementsRestore?this._hiddenElementsRestore(e.hidden3DElementsIds,i,function(){this._session.hidden3DElementsIds=[],!i&&Array.isArray(e.hidden3DElementsIds)&&(this._session.hidden3DElementsIds=e.hidden3DElementsIds.slice()),t()}.bind(this)):t()}.bind(this))}.bind(this)).then(function(){return new n(function(t){this._sidePanelStateRestore&&e.sidePanel?this._sidePanelStateRestore(e.sidePanel,function(){this._session.sidePanel=Object.assign({},e.sidePanel),t()}.bind(this)):t()}.bind(this))}.bind(this)).then(function(){return new n((function(e){a(),e()}))}.bind(this)).catch((function(e){e&&"contentNotFound"!==e.message&&console.log(e),i()}))},loadStateFromJSON:function(e){var t=JSON.parse(e.json);t&&this.loadState(t,e)},isLoading:function(){return this._loading},getStateForMarkupSlide:function(){var e,t=this._session;if(t){var i=function(e,t,i){e[i]&&Object.keys(e[i]).length>0&&(t[i]=Object.assign({},e[i]))};if(i(t,(e={version:1,context:{datadisplay:t.content},content:{}}).context,"time"),i(t,e.content,"customization"),i(t,e.content,"animationScope"),i(t,e.content,"camera"),i(t,e.content,"sidePanel"),Array.isArray(t.hidden3DElementsIds)&&t.hidden3DElementsIds.length>0&&(e.content.hidden3DElementsIds=t.hidden3DElementsIds.slice()),t.expandableUI&&Object.keys(t.expandableUI).length>0){var n=r(t.expandableUI);Array.isArray(n)&&n.length>0&&(e.content.expandableUI=n)}}return e},getTitleForMarkupSlide:function(){var e="msr_default_title",t=this._session;return t&&t.content&&(e=t.content.contentName,t.time&&(t.time.groupId&&(e+=" - "+t.time.groupId),isNaN(t.time.framePosition)||(e+=" - "+Number(t.time.framePosition).toString()),t.time.unit&&(e+=t.time.unit),t.content.sequenceName&&(e+=" ("+t.content.sequenceName+")"))),e},restoreStateForMarkupSlide:function(e,t){var i=Object.assign({},e.content);i.content=Object.assign({},e.context.datadisplay),i.time=Object.assign({},e.context.time),i.animationScope=Object.assign({},e.content.animationScope),i.customization=Object.assign({},e.content.customization),Array.isArray(e.content.hidden3DElementsIds)&&(i.hidden3DElementsIds=e.content.hidden3DElementsIds),i.sidePanel=Object.assign({},e.content.sidePanel),i.expandableUI=Object.assign({},o(e.content.expandableUI)),this.loadState(i,t)},SetLegendData:function(e){this._resetValues.computedMin={value:e.computedMin,unit:e.unit},this._resetValues.computedMax={value:e.computedMax,unit:e.unit}}})})),define("DS/SPYUI/CATSimNavDataDisclaimer",["css!DS/SPYUI/CATSimNavDataDisclaimer.css","UWA/Core","UWA/Class"],(function(e,t,i){"use strict";var n=i.extend({init:function(e){if(this._parent(),e&&e.text&&e.parentContainer){this._container=new t.Element("div",{class:"spy-disclaimer-wrapper"}).inject(e.parentContainer);var i=new t.Element("div",{class:"spy-disclaimer-container"}).inject(this._container);this._msg=new t.Element("p",{class:"spy-disclaimer-text"}).inject(i),this._msg.setText(e.text)}},setLeftOffset:function(e){isNaN(e)||(this._container.style.left=e>0?(e+30).toString()+"px":"")},setText:function(e){this._container&&this._msg&&(""!==e?(this._msg=e,this._container.show()):(this._msg="",this._container.hide()))},remove:function(){this._container&&this._container.remove()},getHeight:function(){var e;return this._container&&(e=this._container.clientHeight),e},drawToCanvas:function(e){if(e&&this._container&&this._msg){e.font=12..toString()+"px Arial",e.fillText(this._msg.getText(),this._msg.offsetLeft,this._container.offsetTop+this._msg.offsetTop)}}});return t.namespace("DS/SPYUI/CATSimNavDataDisclaimer",n)})),define("DS/SPYUI/CATSimNavData3DExtremaNode",["UWA/Core","DS/WebappsUtils/WebappsUtils","DS/Visualization/SceneGraphFactory","DS/SceneGraphNodes/Canvas2DNode","DS/SceneGraphNodes/CanvasNodeTexture","DS/Visualization/ThreeJS_DS","DS/VisuEvents/EventsManager"],(function(e,t,i,n,a,s,o){"use strict";const r=window.devicePixelRatio||1,l=44,c=44,h=t.getProxifiedWebappsBaseUrl()?t.getProxifiedWebappsBaseUrl():t.getWebappsBaseUrl(),d="SPYUI/assets/icons/extrema/",u=30;let m=n.extend({_updateTagImage:function(){let e=-1!==this._type.indexOf("Partial")?"Hidden":"",t="Min";-1!==this._type.indexOf("Max")!==this._colorsInverted&&(t="Max"),this._tagImg.src=h+d+"I_SimNavExtrema"+e+t+"Tag.png"},_requestTextureUpdate:function(){this._extremaTexture.requestRedraw(),this._viewer.render()},init:function(t,n,m,g){this._initDone=!1,this._viewer=t,this._type=n,this._colorsInverted=g,this._expandFlag=!1,this._antiConflictFlag=!1,this._reframed=!1,this._tagImg=new e.Element("img",{attributes:{width:l*r,height:c*r}}),this._reframeImg=new e.Element("img",{attributes:{width:u*r,height:u*r,src:h+d+"I_SimNavExtremaReframe.png"}}),this._restoreImg=new e.Element("img",{attributes:{width:u*r,height:u*r,src:h+d+"I_SimNavExtremaUndo.png"}}),this._extremaTexture=new a({width:200*r,height:c*r,drawCB:function(e,t){if(this._initDone){if(this._expandFlag&&this.extremaValue){let e=12*this.extremaValue.length;t.fillStyle="rgba(100, 100, 255, 0.6)",-1!==this._type.indexOf("Max")!==this._colorsInverted&&(t.fillStyle="rgba(255,100,100,0.6)"),!function(e,t,i,n,a,s,o,r){if(void 0===r&&(r=!0),void 0===s&&(s=5),"number"==typeof s)s={tl:s,tr:s,br:s,bl:s};else{let e={tl:0,tr:0,br:0,bl:0};for(let t in e)s[t]=s[t]||e[t]}e.beginPath(),e.moveTo(t+s.tl,i),e.lineTo(t+n-s.tr,i),e.quadraticCurveTo(t+n,i,t+n,i+s.tr),e.lineTo(t+n,i+a-s.br),e.quadraticCurveTo(t+n,i+a,t+n-s.br,i+a),e.lineTo(t+s.bl,i+a),e.quadraticCurveTo(t,i+a,t,i+a-s.bl),e.lineTo(t,i+s.tl),e.quadraticCurveTo(t,i,t+s.tl,i),e.closePath(),o&&e.fill(),r&&e.stroke()}(t,18*r,4*r,(65+e)*r,32*r,10*r,!0,!1),t.font="bold "+(16*r).toString()+"pt Arial",t.fillStyle="black",t.fillText(this.extremaValue,l*r,28*r),t.globalAlpha=1,t.strokeStyle="black",t.lineWidth=2;let i=this._reframed?this._restoreImg:this._reframeImg;this._xReframeRestore=50+e,this._yReframeRestore=5,t.drawImage(i,this._xReframeRestore*r,this._yReframeRestore*r,u*r,u*r)}if(this._antiConflictFlag){let e=l*r/2,i=c*r/2;t.translate(e,i),t.rotate(Math.PI),t.drawImage(this._tagImg,-1*i,-1*i,l*r,c*r),t.rotate(-1*Math.Pi),t.translate(-1*e,-1*i)}else t.drawImage(this._tagImg,0,0,l*r,c*r)}}.bind(this)}),this._tagImg.onload=this._requestTextureUpdate.bind(this);let p={name:m+"_"+this._viewer.id.toString(),hotspot:new s.Vector2(l*r/2,this._antiConflictFlag?c*r:0),canvasNodeTexture:this._extremaTexture};this._parent(p,i);let v=this;this._onClick=function(e){if(e){let t=v._viewer.getMousePosition(e.from[0].getCurrentPosition(v._viewer.canvas)),i=new s.Vector2(t.xPix,t.yPix),n=(new s.Vector3).getPositionFromMatrix(v.getMatrix()),a=v._viewer.getViewpoints();if(a.length>0){let e=a[0];(new s.Projector).projectVector(n,e.camera),n.x=(n.x+1)/2,n.y=(1-n.y)/2;let t=new s.Vector2(n.x*v._viewer.canvas.width,n.y*v._viewer.canvas.height),o=i.sub(t).multiplyScalar(1/(window.devicePixelRatio||1));o.x=o.x+22;let r=v._antiConflictFlag?0:-44,h=v._antiConflictFlag?c:0,d=v._antiConflictFlag?c-v._yReframeRestore:-1*v._yReframeRestore,m=v._antiConflictFlag?c-v._yReframeRestore-u:-1*(v._yReframeRestore+u);o.x>=0&&o.y<=h&&(o.x<=l&&o.y>=r?v.setExpandFlag(!v._expandFlag):v._expandFlag&&o.x>=v._xReframeRestore&&o.x<=v._xReframeRestore+u&&o.y<=d&&o.y>=m&&(v._reframed?v.onRestore():v.onReframe()))}}},o.addEvent(this._viewer.canvas,"onLeftMouseUp",this._onClick),o.addEvent(this._viewer.canvas,"onTap",this._onClick),this.setPickable("Mesh.NOPICKABLE"),this._initDone=!0},clean:function(){if(this._viewer){o.removeEvent(this._viewer.canvas,"onLeftMouseUp",this._onClick),o.removeEvent(this._viewer.canvas,"onTap",this._onClick);let e=this.getParents();Array.isArray(e)&&e[0]&&e[0].removeChild(this)}},setAssociatedComponent:function(e){this.cmp3D=e},getAssociatedComponent:function(){return this.cmp3D},getConnectionOffset:function(){return{x:10,y:10}},setExtremaType:function(e){this._type=e,this._updateTagImage()},setAntiConflictFlag:function(e){this._antiConflictFlag=e,this.hotspot=new s.Vector2(l*r/2,this._antiConflictFlag?c*r:0),this.setHotspot(this.hotspot),this._requestTextureUpdate()},setExtremaValue:function(e){this.extremaValue=e,this._requestTextureUpdate()},getExtremaValue:function(){return this.extremaValue},setExpandFlag:function(e){this._expandFlag=e,this._requestTextureUpdate()},applyOffset:function(){},setPosition:function(e){if(e){let t=new s.Matrix4;t.setPosition(e),this.setMatrix(t),this.applyOffset()}},setNormalVector:function(e){this.normalVector=e},getNormalVector:function(){return this.normalVector},getExpandFlag:function(){return this._expandFlag},onReframe:function(){if(this._viewer){let e=this._viewer.getViewpoints();if(e.length>0){let t=e[0],i=t.getEyePosition(),n=t.getSightDirection(),a=t.getUpDirection();if(i&&n&&a){this._backupViewpoint={mainViewpoint:t,cameraPosition:{x:i.x,y:i.y,z:i.z},cameraTarget:{x:n.x,y:n.y,z:n.z},cameraUp:{x:a.x,y:a.y,z:a.z}};let e=(new s.Vector3).getPositionFromMatrix(this.getMatrix());if(e&&this.normalVector){0===this.normalVector.x&&0===this.normalVector.y&&0===this.normalVector.z&&(this.normalVector.x=1);let i=new s.Vector3;i.addVectors(e,this.normalVector.clone().normalize().multiplyScalar(500)),t.setSightDirection((new s.Vector3).subVectors(e,i)),t.setUpDirection(new s.Vector3(0,0,1)),t.setEyePosition(i),this._reframed=!0,this._requestTextureUpdate(),setTimeout(function(){this._moveCBToken=t.onMove(this.onUserViewModification.bind(this))}.bind(this),200)}}}}},onRestore:function(){if(this._backupViewpoint){let e=this._viewer.getViewpoints();if(e.length>0){let t=e[0];t&&(t.setSightDirection(new s.Vector3(this._backupViewpoint.cameraTarget.x,this._backupViewpoint.cameraTarget.y,this._backupViewpoint.cameraTarget.z)),t.setUpDirection(new s.Vector3(this._backupViewpoint.cameraUp.x,this._backupViewpoint.cameraUp.y,this._backupViewpoint.cameraUp.z)),t.setEyePosition(new s.Vector3(this._backupViewpoint.cameraPosition.x,this._backupViewpoint.cameraPosition.y,this._backupViewpoint.cameraPosition.z)),t.unsubscribe(this._moveCBToken),this._moveCBToken=void 0,this._reframed=!1,this._requestTextureUpdate())}}},onUserViewModification:function(){if(this._moveCBToken){let e=this._viewer.getViewpoints();if(e.length>0){let t=e[0];t&&(t.unsubscribe(this._moveCBToken),this._moveCBToken=void 0)}this._reframed=!1,this._requestTextureUpdate()}}});return e.namespace("DS/SPYUI/CATSimNavData3DExtremaNode",m)})),define("DS/SPYUI/controllers/CATSimNavDataCameraSelector",["i18n!DS/SPYUI/assets/nls/CATSimNavDataCameraSelector","UWA/Core","UWA/Class","DS/WebappsUtils/WebappsUtils","DS/TreeModel/TreeNodeModel","DS/TreeModel/TreeDocument","DS/Tree/ThumbnailGridView","DS/CoreEvents/Events"],(function(e,t,i,n,a,s,o,r){"use strict";var l=i.extend({_selClick:function(e){var t=e.virtualCellID;this._camerasRoot.setCurrentCamera(t),this.updateViewPoint(),r.publish({event:this._selectionEventId,data:t})},init:function(e){this._camerasRoot=e.cameraRoot,this._viewer=e.viewer,this._zip=e.zip,this._selectionEventId=e.selectionEventId,this._changeEventId=e.changeEventId,r.subscribe({event:this._changeEventId},function(e){if(this._cellsModel&&this._cameraGrid&&e){this._cellsModel.unselectAll();var t=this._cellsModel.getNthRoot(e.cameraIndex);t&&(t.select(),this._cameraGrid.setActiveNode(t),this.updateViewPoint(),r.publish({event:this._selectionEventId,data:e.cameraId}))}}.bind(this))},reset:function(e){this._camerasRoot=e.cameraRoot,this._zip=e.zip},loadScrollingPanel:function(t,i){if(this._camerasRoot){var r=this._camerasRoot.getCurrentCameraIdx();this._cellsModel=new s({shouldAcceptDrop:function(){return!1}});for(var l=n.getWebappsBaseUrl()+"SPYUI/assets/icons/camera",c=0;c<this._camerasRoot.getListCamera().length;++c){var h=this._camerasRoot.getCamera(c),d=void 0!==h.getLinks("CamerasToPart"),u=new a({label:h.getName(),sublabel:d?e.get("tracking"):e.get("static"),thumbnail:"",icons:[l+"/I_SimNavCam"+(d?"Tracking.png":"Static.png")],description:h.getDescription()}),m=h.getThumbnail();m?this.loadThumbnail(c,m):u.options.thumbnail=l+"/I_SimNavCamDefaultThumbnail.png",this._cellsModel.addRoot(u)}this._cameraGrid=new o({model:this._cellsModel,defaultCellWidth:225,defaultCellHeight:170,height:"auto",numberOfColumns:1,selection:{canMultiSelect:!1,enableListSelection:!1},checkboxVisibilityFlag:"never",enableActiveUI:!0,enableKeyboardNavigation:!0,performances:{preloadPool:!0,useRequestAnimationFrameRendering:!1},onContextualEvent:{callback:function(e){return[]}}}).inject(t),this._cameraGrid.elements.container.setStyles({width:"255px"}),this._cameraGrid.onCellClick(this._selClick.bind(this)),this._cellsModel.getNthRoot(r).select(),i&&i(),setTimeout(function(){var e=this._cameraGrid.elements.poolContainerRel;e&&e.querySelectorAll(".wux-controls-thumbnail-menu").forEach((function(e){e.remove()}))}.bind(this),500)}},loadThumbnail:function(e,t){var i=this._zip.find(t);i&&i.getBlob("image/PNG").then(function(t){this._cellsModel.getNthRoot(e).options.thumbnail=URL.createObjectURL(t),this._cellsModel.getNthRoot(e).updateOptions()}.bind(this))},updateViewPoint:function(e){this._camerasRoot.QI("CATISimNavDataAnimation",(function(t){t.animate(void 0,{forceUpdateCamera:!0===e})}))}});return t.namespace("DS/SPYUI/controllers/CATSimNavDataCameraSelector",l)})),define("DS/SPYUI/CATSimNavDataDisplayAnimation",["UWA/Core","DS/SPYAnim/DataDisplayAnimationAbstract"],(function(e,t){"use strict";return t.extend({isFrameLoaded:function(e){let t=!0,i=function(e){let t=!0;if(e){let i="loaded"===(e.Geometry?e.Geometry:e).status,n=!0,a=!0,s=e.Texture||e.Instancing;s&&(e.Texture?n="loaded"===e.Texture.status:e.Instancing&&(a="loaded"===e.Instancing.status)),t=s?i&&n&&a:i}return t};for(let n=0;n<this.listObjectsToAnimate.length&&t;n++)this.listObjectsToAnimate[n].getLoadingDescription&&(t=i(this.listObjectsToAnimate[n].getLoadingDescription(e)));return t},loadFrame:function(e,t){if(!this.implementation)return;let i=0,n=0,a=0,s=Date.now(),o=s,r=function(a){t&&t({extractionTime:a,numberOf3DElements:i,numberOfStreamlines:n,visuCreationTime:o-s-a,globalFrameIdx:e})};if(this.isFrameLoaded(e))r(0);else{let t={Geometry:{statuses:[],files:[],fatherNodes:[],matrices:[]},Texture:{statuses:[],files:[],managers:[]},Instancing:{statuses:[],files:[],managers:[]},frameIndex:e},s=function(e,i){let n=e[i];n&&"loaded"!==n.status&&n.file&&(t[i].statuses.push(n.status),t[i].files.push(n.file),t[i].fatherNodes?t[i].fatherNodes.push(n.fatherNode):t[i].managers.push(n.manager),t[i].matrices&&t[i].matrices.push(n.matrix))},o=function(e){e&&(s(e,"Geometry"),s(e,"Texture"),s(e,"Instancing"))};this.listObjectsToAnimate.forEach((t=>{t.getLoadingDescription&&o(t.getLoadingDescription(e)),t.getNode&&t.getNode()&&(i++,"streamlines"===t.getImpl().subType&&n++)}));let l=function(e){if(e){t.Geometry.fatherNodes.forEach(((i,n)=>{i&&i.children.forEach((a=>{a._SPYFrameIndex===t.frameIndex&&e(a,i,n)}))}))}};0===t.Instancing.files.length&&0===t.Texture.files.length&&l((function(e,t){t&&e&&t.remove(e)}));let c=function(t){this.listObjectsToAnimate.forEach((i=>{let n=i.getImpl();n&&n.setLoadingStatus&&n.setLoadingStatus(e,"loaded",t)}))}.bind(this),h=this.implementation.getSPM(),d=this.implementation.getSequence(),u=function(){t.Instancing.files.length>0?(h.loadFiles({type:"Instancing",filesList:t.Instancing.files,frameIndex:e,managers:t.Instancing.managers,sequence:d,callback:function(e){e.maxRscExtractionTime>a&&(a=e.maxRscExtractionTime),c("Instancing"),r(a)},resetProgress:!0}),h.processLoadFiles()):r(a)},m=function(){t.Texture.files.length>0?(h.loadFiles({type:"Texture",filesList:t.Texture.files,frameIndex:e,managers:t.Texture.managers,sequence:d,callback:function(e){e.maxRscExtractionTime>a&&(a=e.maxRscExtractionTime),c("Texture"),u()},resetProgress:!0}),h.processLoadFiles()):u()};t.Texture.files.length>0||t.Instancing.files.length>0?m():t.Geometry.files.length>0&&(h.loadFiles({type:"Geometry",filesList:t.Geometry.files,frameIndex:e,fatherNodes:t.Geometry.fatherNodes,sequence:d,callback:function(e){e.maxRscExtractionTime>a&&(a=e.maxRscExtractionTime),l((function(e,i,n){e&&!isNaN(n)&&e.setMatrix(t.Geometry.matrices[n])})),c("Geometry"),m()},resetProgress:!0}),h.processLoadFiles())}},initAnimation:function(e,t){if(!this.implementation)return;this._parent(),t&&(this._renderRequest=t.renderRequest),this.listObjectsToAnimate=[];let i=this.implementation.getNavData3DViewList(),n=this.implementation.getNavData2DViewList(),a=this.implementation.getNavDataFrameViewList(),s=i.concat(n).filter((e=>e.active));this.implementation.spm.window&&this.implementation.spm.window.SPMUI&&this.implementation.spm.window.experience&&this.implementation.spm.window.SPMUI._isAFullExperience(this.implementation.spm.window.experience)&&(s=s.concat(a));let o=0,r=!1,l=function(){0===o&&r&&e&&e()},c=function(e){e?e.initAnimation((()=>{this.listObjectsToAnimate.push(e),o--,l()})):o--}.bind(this);s.forEach((e=>{o++,e.QI("CATISimNavDataAnimation",c)})),r=!0,l()}})})),define("DS/SPYUI/CATSimNavDataSpecUI",["UWA/Core"],(function(e){"use strict";var t=e.Class.extend({init:function(e){this.implementation=e},getImpl:function(){return this.implementation},clean:function(){delete this.implementation},build2D:function(){},buildFrame:function(){},updateFrame:function(){},drawToCanvas:function(){},updateSizeResponsive:function(){}});return e.namespace("DS/SPYUI/CATSimNavDataSpecUI",t)})),define("DS/SPYUI/commands/CATSPYMSRShareAs3DCommentCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/Core/Core","DS/CoreEvents/Events","DS/SPYUI/controllers/SPYContext","text!DS/SPYUI/assets/json/MSR_ShareAs3DCommentCtxBar.json"],(function(e,t,i,n,a,s){"use strict";return t.extend({_setContextualBarLabels:function(e,t){var i=e.getContent().querySelector("div.wux-afr-view");if(i){var n=t?"wux-afr-state-nolabels":"wux-afr-state-labels",a=t?"wux-afr-state-labels":"wux-afr-state-nolabels";i.removeClassName(n),i.addClassName(a)}},_onViewerResize:function(){let e=a.getFrameWindow();if(e){var t=e.getContent().getDimensions(),i=e.getContextualUIManager();if(i){var n="small"===this._spmUI.getLayoutId(),s=i.getContextualBar();if(s){var o=t.width-(n?50:100),r=t.height/2-(n?80:130);s.setPosition({x:o,y:r}),this._setContextualBarLabels(s,!n)}}}},init:function(e,t){this._parent(e,{isAsynchronous:!0,mode:"shared"})},beginExecute:function(){this._spmUI=a.getCurrentController();let e=a.getFrameWindow(),t=e.getContent().getDimensions(),i=this.getContextualBarDefinition();if(i){let a=e.getContextualUIManager();if(void 0!==a){let e="small"===this._spmUI.getLayoutId(),s={fillingList:[i,{subscriberId:"SPY_DUM_Ctx",workbenchName:"BasicSimulationPlayer",module:"3DPlayBasicSimulation",cmdPrefix:"",fileName:"BasicSimulationPlayer.xml",onContextualBarReady:()=>{let t=a.getContextualBar();if(t){this._hideToRestore=t.hide,this._showToRestore=t.show,t.hide=function(){},t.show=function(){};let i=t.getContent().querySelectorAll("div.wux-afr-cmdstarter");for(let e=0;e<i.length;e++)i[e].style.display="block";this._setContextualBarLabels(t,!e);let n=t.getContent().querySelector("div.wux-afr-cmdContainer");n&&(n.style.height="auto")}return{}}}],hideWithDistance:!1,x:t.width-(e?50:100),y:t.height/2+(e?40:140)};a.showContextualBar(s),this._resizeCallback=n.subscribe({event:this._ctx+"/SPY/VIEWERRESIZE"},this._onViewerResize.bind(this))}}this._viewer=e.getViewer()},endExecute:function(){i.Selection.CSOManager.unsubscribe(this._CSOcb);let e=a.getFrameWindow();if(e){let t=e.getContextualUIManager();t&&this._hideToRestore&&this._showToRestore&&(t.getContextualBar().show=this._showToRestore,t.getContextualBar().hide=this._hideToRestore,t.getContextualBar().hide())}n.unsubscribe(this._resizeCallback)},getContextualBarDefinition:function(){return{subscriberId:"MSR_ShareAs3DCommentCtxBar",workbenchName:"FullSimulationPlayer",module:"3DPlayFullSimulation",cmdPrefix:"",fileName:"FullSimulationPlayer.xml",onContextualBarReady:()=>JSON.parse(s)}}})})),define("DS/SPYUI/commands/CATSPYInfoAccessCmd",["UWA/Core","DS/Core/Core","DS/ApplicationFrame/CommandCheckHeader","DS/SPYUI/controllers/SPYContext"],(function(e,t,i,n){"use strict";return i.extend({init:function(e){this._parent(e),this.onStateChange((()=>{if(!this._processingStateChange){this._processingStateChange=!0;let a=this.getState();n.getCurrentController();if(spmUI&&(spmUI.setInformationStatus(a),a)){var e=t.Selection.CSOManager.get();if(e.length>0){var i=e[0].pathElement;t.Selection.CSOManager.empty(),t.Selection.HSOManager.empty(),t.Selection.CSOManager.unique({pathElement:i}),t.Selection.HSOManager.unique({pathElement:i})}}this._processingStateChange=void 0}}))}})})),define("DS/SPYUI/commands/CATSPYHideShowCtxCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/Core/Core","DS/SPYUI/controllers/SPYContext"],(function(e,t,i,n){"use strict";var a=t.extend({_postRequisites:function(){i.Selection.CSOManager.empty(),i.Selection.HSOManager.empty(),this._viewer&&this._viewer.render(),this._spmUI&&this._spmUI.updateExtrema(),this.done()},_switch:function(e,t){var i=this._ctx;e.forEach((function(e){e.spObj&&e.spObj.switchVisibility(!0,i)})),t&&t()},init:function(e){this._parent(e,{isAsynchronous:!0})},beginExecute:function(){this._parent();let e=n.getCurrentController();e&&(this._spmUI=e,this._viewer=e.getViewer());for(var t=i.Selection.CSOManager.get(),a=[],s=0;s<t.length;s++){var o=null,r=null;this._currentFatherNode=null;for(var l=t[s].pathElement||t[s].options.pathElement,c=l.getLength()-1;!r&&c>0;)l.getElement(c--).SPObj&&(this._currentFatherNode=l.getElement(c),o=l.getElement(c+1),r=l.getElement(c+1).SPObj);r&&o&&a.push({spObj:r,node:o})}this._switch(a,this._postRequisites.bind(this))}});return a.toggleHideShow=function(e,t){a.beginExecute()},a})),define("DS/SPYUI/commands/CATSPYAnimateCmd",["UWA/Core","DS/CoreEvents/Events","DS/ApplicationFrame/Command","DS/SPYUI/controllers/SPYContext"],(function(e,t,i,n){"use strict";return i.extend({init:function(e){this._parent(e,{isAsynchronous:!0,mode:"exclusive"})},beginExecute:function(){let e=n.getCurrentController();if(e)if(e.running)e.clearAnimation(),t.publish({event:e.getContext()+"/SPY/ANIM/CLEAR"}),t.publish({event:e.getContext()+"/SPY/PROGRESS/END"}),this.done&&this.done(),this.end&&this.end();else{e.initAnimation(!0);var i={position:e.getAnimationFrameIndex(),totalNumberOfFrames:e.getActiveDD().getTotalNumberOfFrames(),totalComputedFramesNumber:e.getActiveDD().getAnimationStructure().totalComputedFramesNumber};t.publish({event:e.getContext()+"/SPY/ANIM/PLAY",data:i}),this.done&&this.done()}},endExecute:function(){let e=n.getCurrentController();e&&(e.clearAnimation(),t.publish({event:e.getContext()+"/SPY/ANIM/CLEAR"}),t.publish({event:e.getContext()+"/SPY/PROGRESS/END"}))}})})),define("DS/SPYUI/commands/CATSPYToggleStreamsCmd",["UWA/Core","DS/CoreEvents/Events","DS/ApplicationFrame/CommandCheckHeader","DS/SPYUI/controllers/SPYContext"],(function(e,t,i,n){"use strict";return i.extend({init:function(e){this._parent(e),this.onStateChange((()=>{if(!this._processingStateChange){this._processingStateChange=!0;let e=this.getState(),i=n.getCurrentController();if(i){let n=i.frameStreamlines;n&&(n.style.display=e?"block":"none",e?t.publish({event:this._context+"/SPY/STREAMLINESMGR/SHOW"}):t.publish({event:this._context+"/SPY/STREAMLINESMGR/HIDE"}))}this._processingStateChange=void 0}}))}})})),define("DS/SPYUI/commands/CATSPYCameraSelectorCmd",["UWA/Core","DS/ApplicationFrame/CommandCheckHeader","DS/SPYUI/controllers/SPYContext"],(function(e,t,i){"use strict";return t.extend({init:function(e){this._parent(e),this.onStateChange((()=>{if(!this._processingStateChange){this._processingStateChange=!0;let e=this.getState(),t=i.getCurrentController();t&&t.setCameraBrowsingStatus(e),this._processingStateChange=void 0}}))}})})),define("DS/SPYUI/commands/CATSPYOpenFrom3DSpaceCmd",["UWA/Core","DS/CoreEvents/Events","DS/ApplicationFrame/Command","DS/SPYUI/controllers/SPYContext"],(function(e,t,i,n){"use strict";return i.extend({init:function(e){this._parent(e,{isAsynchronous:!0,mode:"exclusive"})},beginExecute:function(){let e=n.getCurrentController().getSPM();e&&e.originURL&&e.originURL.length>0&&(window.open(e.originURL),this.end())}})})),define("DS/SPYUI/facets/PhysSimulationFacet",["css!DS/SPYUI/facets/PhysSimulationFacet.css","i18n!DS/SPYUI/assets/nls/PhysSimulationFacet","DS/EditPropWidget/facets/Common/FacetsBase","UWA/Core","DS/UIKIT/Scroller","DS/CoreEvents/Events","DS/SPYUI/controllers/SPYContext"],(function(e,t,i,n,a,s,o){"use strict";return i.extend({_simulationView:null,init:function(e){this._simulationView=null,this._parent(e),this._initUI(),this._contentChangeCb=s.subscribe({event:o.getAppContext()+"/SPY/VRFACET/CONTENTCHANGED"},this.updateFacet.bind(this))},_initUI:function(){this.elements.container=n.createElement("div",{class:"container_PhysSimulation"}),this.elements.content=n.createElement("div",{class:"content_PhysSimulation"}),this.elements.contentScroll=n.createElement("div",{class:"contentScroll_PhysSimulation"}),this.elements.contentScroll.inject(this.elements.content),this.elements.scroller=new a({element:this.elements.content}).inject(this.elements.container)},destroyComponent:function(){this._simulationView&&this._simulationView.destroy(),s.unsubscribe(this._contentChangeCb)},onResize:function(){var e=o.getCurrentContent();if(e){var t=this.elements.contentScroll.clientWidth;e.QI("CATISimNavDataDisplayUI",function(e){e&&e.updateFrame(t)}.bind(this))}},getOptimalSize:function(){return this._parent()},updateFacet:function(){this.elements.contentScroll.empty();var e=o.getCurrentContent();if(e){var i=this.elements.contentScroll.clientWidth;e.QI("CATISimNavDataDisplayUI",function(e){if(e){var a=e.getInfoContent();if(a?(this._simulationView=a,e.updateFrame(i),s.publish({event:o.getAppContext()+"/SPY/VRFACET/PHYSICS_SIMULATION_FACET_FRAME_BUILT"})):this._simulationView=e.buildFrame(i,(function(){})),this._simulationView)this._simulationView.inject(this.elements.contentScroll);else{var r=new n.Element("div",{class:"spy-facet-noinfo"});new n.Element("span").inject(r).setText(t.get("noInfo")),r.inject(this.elements.contentScroll)}}}.bind(this))}else{var a=new n.Element("div",{class:"spy-facet-loading"});new n.Element("span").inject(a).setText(t.get("loading")),a.inject(this.elements.contentScroll)}},onRefresh:function(){this.updateFacet()}})})),define("DS/SPYUI/CATSimNavData2DLegendUI",["UWA/Core","DS/SPYUI/CATSimNavDataSpecUI","DS/WebappsUtils/WebappsUtils","DS/CoreEvents/Events","DS/SMAMpwControls/SMAMpwLegend","DS/i3DxMdSimulationWeb/i3DxMSRFileTree"],(function(e,t,i,n,a,s){"use strict";var o=t.extend({_isFullExperience:function(){var e=!1,t=this.implementation.getDataDisplay();return t&&t.spm.window&&t.spm.window.SPMUI&&(e=t.spm.window.SPMUI._isAFullExperience(t.spm.window.experience)),e},clean:function(){this._legendUI&&this._legendUI.destroy(),delete this._legendUI,delete this.div},build2D:function(t){this.div=new e.Element("div");var o,r={hasMinMax:function(){return this.implementation.hasMinMax()}.bind(this),getGlobalComputedMin:function(){return this.implementation.min}.bind(this),getGlobalComputedMax:function(){return this.implementation.max}.bind(this),getUserMin:function(){return this.implementation.userMin}.bind(this),getUserMax:function(){return this.implementation.userMax}.bind(this),getDefaultFrameId:function(){var e=this.implementation.animRawData.length-1;return isNaN(this._defaultStep)||(e=this._defaultStep),e}.bind(this),updateDefaultFrameId:function(e){this._defaultStep=e}.bind(this),getLocalComputedMin:function(e){return this.implementation.localMin[e]}.bind(this),getLocalComputedMax:function(e){return this.implementation.localMax[e]}.bind(this),hasDeformationScales:function(){return this.implementation.deformationScales.length>0}.bind(this),getDeformationScaleFactor:function(e){return this.implementation.deformationScales[e]}.bind(this),getInvertedFlag:function(){return this.implementation.inverseState}.bind(this),hasScanAnimation:function(){return this.implementation.hasScanAnimation}.bind(this),loadColorsImage:function(e){if(this._imageRequested)this._imageContainers.push(e);else{var t=this.implementation.getDataDisplay();if(t){var a,o,r=t.spm.getZipEntries(t.seq);let h=this.implementation.palette;if(r&&this.implementation.palette){o="image/png";let e=t.spm.buildResourcePath(this.implementation.palette,t.seq);a=r.find(e)}if(a)this._imageContainers=[e],this._imageRequested=!0,a.getData64URI(o).then(function(e){this._imageContainers.forEach((function(t){"IMG"===t.nodeName.toUpperCase()?t.src=e:t.style["background-image"]="url("+e+")"})),this._imageContainers=[],this._imageRequested=!1}.bind(this));else if(t.spm.sequences[t.seq].key&&h){this._imageContainers=[e];let i=[h],a=t.spm.sequences[t.seq];s.getFileTreeDownloadURL(a.url,a.contextid,a.simId,a.resultRepId,a.key,i).then((e=>{o="image/png";let t=function(e,t){let i="";for(let t=0;t<e.length;t++)i+=String.fromCharCode(e[t]);return`data:${t};base64,${btoa(i)}`}(e[0].buffer,o);t&&(this._imageContainers.forEach((e=>{"IMG"===e.nodeName.toUpperCase()&&n.publish({event:"/SPYUI/LEGEND/PALETTE/LOADED",data:t})})),this._imageContainers=[],this._imageRequested=!1)}))}else{var l="1"===this.implementation.inverseState?"SMAMpwControls/assets/legend_na_inverted.png":"SMAMpwControls/assets/legend_na.png",c=i.getProxifiedWebappsBaseUrl()?i.getProxifiedWebappsBaseUrl():i.getWebappsBaseUrl();"IMG"===e.nodeName.toUpperCase()?e.src=c+l:e.style["background-image"]="url("+c+l+")"}}}}.bind(this),getTitle:function(){return this.implementation.title}.bind(this),getFrameSelectorEntries:function(){var e=[],t=this.implementation.getDataDisplay();if(!t)return e;for(var i,n=t.getAnimationStructure(),a=0;a<n.groupList.length;a++){var s=n.groupList[a],o=s.rootName;s.numberComputedFrames<=1?o=s.loadCaseName?o+" - "+s.loadCaseName:o:s.frameList.length>1&&(o=s.name);for(var r=0;r<s.frameList.length;r++){var l,c=s.frameList[r];l=""===s.name?c.name:s.isMode?s.name:s.name+" - "+c.name,i=c.globalIndex,c.isScaledPosition||e.push({value:i.toString(),label:l,group:o})}}return e}.bind(this),getScopeBlocks:function(){var e=[],t=this.implementation.getDataDisplay();if(!t)return e;for(var i=t.getAnimationStructure(),n=i.totalFrameNumber,a=0;a<i.groupList.length;a++){var s=i.groupList[a];if(s){var o=s.frameList.length;e.push({id:s.id,name:s.name,percentSize:100*o/n})}}return e}.bind(this),getScopeBlocksIds:function(){var e=[],t=this.implementation.getDataDisplay();if(!t)return e;var i=t.isPartialAnimationMode()?t.getAnimationScope(this._currentStep):t.getDefaultAnimationScope(this._currentStep);return i&&(e=i.groupIDs),e}.bind(this)},l=this.implementation.getDataDisplay();l&&(o=l.getSPM().getContext());for(var c={onPostBuildCallback:function(){t&&t(this.div)}.bind(this),onFrameSelectorChange:function(e){!this._animationMode&&this._publishSelectEvent&&(n.publish({event:o+"/SPY/FRAME/SELECT",data:e}),this._currentStep=e-1)}.bind(this),getCurrentFrameId:function(){return this._currentStep}.bind(this),getCurrentScopeStartFrameId:function(){var e,t=this.implementation.getDataDisplay();if(t){var i=t.getAnimationScope(this._currentStep);i&&(e=i.globalStart)}return e}.bind(this),getCurrentScopeEndFrameId:function(){var e,t=this.implementation.getDataDisplay();if(t){var i=t.getAnimationScope(this._currentStep);i&&(e=i.globalEnd)}return e}.bind(this),getLockAvailability:function(){var e,t=this.implementation.getDataDisplay();if(t){var i=t.getAnimationScope(this._currentStep);if(i){var n=!this._animationMode&&i&&i.canBePartial&&i.length>1,a=this._animationMode&&t.isPartialAnimationMode();e=n||a}}return e}.bind(this),getLockStatus:function(){var e,t=this.implementation.getDataDisplay();if(t){if(t.defaultLockStatus){let e=t.getAnimationScope(this._currentStep);if(e&&e.hasModes)return!0}e=t.isPartialAnimationMode()}return e}.bind(this),onLock:function(){this.implementation.getDataDisplay().setPartialAnimationMode(!0)}.bind(this),onUnLock:function(){this.implementation.getDataDisplay().setPartialAnimationMode(!1)}.bind(this),getCurrentScopeBlockId:function(){var e,t=this.implementation.getDataDisplay();if(!t)return e;var i=t.getGroupForFrame(this._currentStep);return i&&i.group&&(e=i.group.id),e}.bind(this),checkEditability:()=>{let e=!this.implementation.rangeIsReadOnly()&&this._isFullExperience();if(e){e=!this.implementation.getDataDisplay().spm.window.SPMUI.isAnimationRunning()}return e},onMinChanged:function(e){this.implementation.setUserMin(e,this._currentStep)}.bind(this),onMinReset:function(e){var t=l.spm.window.SPMUI;t&&t.isSynchronizingLegend()?this.implementation.setUserMin(e,this._currentStep):this.implementation.setUserMin(void 0,this._currentStep)}.bind(this),onMaxChanged:function(e){this.implementation.setUserMax(e,this._currentStep)}.bind(this),onMaxReset:function(e){var t=l.spm.window.SPMUI;t&&t.isSynchronizingLegend()?this.implementation.setUserMax(e,this._currentStep):this.implementation.setUserMax(void 0,this._currentStep)}.bind(this),getUserMinMdlEventId:function(){return o+"/SPY/LEGEND/EDIT/USERMIN"},getUserMaxMdlEventId:function(){return o+"/SPY/LEGEND/EDIT/USERMAX"},getAnimationModeEventId:function(){return o+"/SPY/FRAME/DISABLESELECT"},onAnimationMode:function(){this._animationMode=!0}.bind(this),getNavigationModeEventId:function(){return o+"/SPY/FRAME/ENABLESELECT"},onNavigationMode:function(){this._animationMode=!1}.bind(this),isInAnimationMode:function(){return this._animationMode}.bind(this),areCursorsVisible:function(){var e=this.implementation.getDataDisplay(),t=e&&e.getAnimationStructure(),i=e&&t&&t.computedFramesOnlyForDefault&&!e.isPartialAnimationMode();return this._animationMode&&!i&&!this.implementation.hasScanAnimation}.bind(this),getPostDOMInsertEventId:function(){return o+"/SPY/DATADISPLAY/ACTIVATED"},getResponsiveEventId:function(){return o+"/SPY/VIEWERRESIZE"},getEditabilityChangeEventId:function(){return o+"/SPY/LEGEND/EDITABILITY"}},h=l.getAnimationStructure(),d=!1,u=0;u<h.groupList.length;u++){u>0&&(d=!0);for(var m=h.groupList[u],g=0;g<m.frameList.length&&!d;g++)g>0&&(d=!0)}this._publishSelectEvent=d;var p={readOnly:this.implementation.rangeIsReadOnly()||!this._isFullExperience(),valuePrecision:l.spm.window.SPMUI?l.spm.window.SPMUI.getValueDisplayPrecision():3,displayFrameSelector:h.totalFrameNumber>0,enableFrameSelector:d,displayBlocks:!0,displayLock:!0,colorBarSize:198,legendDataProvider:r,legendControler:c},v=r.getDefaultFrameId();return this._currentStep=v,this._legendUI=new a(p).inject(this.div),this.div},drawToCanvas:function(e,t,i){if(e&&this.div&&this._legendUI){var n=this.div.offsetLeft+t,a=this.div.offsetTop+i;this._legendUI.drawToCanvas(e,n,a)}},initAnimation:function(e){e&&e()},animate:function(e,t){this._animationMode=!t||!t.navigateMode,this._currentStep=e;var i=this._publishSelectEvent;this._publishSelectEvent=!(t&&t.noEvent),this.div&&this._legendUI&&this._legendUI.animate(e),this._publishSelectEvent=i},updateSizeResponsive:function(){this._legendUI.updateSizeResponsive&&this._legendUI.updateSizeResponsive()}});return e.namespace("DS/SPYUI/CATSimNavData2DLegendUI",o)})),define("DS/SPYUI/CATSimNavDataFrameViewColorShading",["UWA/Core","DS/SPYUI/CATSimNavDataSpecColorShading"],(function(e,t){"use strict";var i=t.extend({init:function(){this._parent()},setShadingColor:function(e){this._parent(e),this.active&&this.activateShading()},activateShading:function(){if(this._parent(),this.shadingColor&&!isNaN(this.shadingColor.red)){var e="rgba("+this.shadingColor.red+", "+this.shadingColor.green+", "+this.shadingColor.blue+", 1)";this.implementation.QI("CATISimNavDataSpecUI",(function(t){t.colorCodedElement&&(t.colorCodedElement.style.backgroundColor=e)}))}},deactivateShading:function(){this._parent(),this.implementation.QI("CATISimNavDataSpecUI",(function(e){e.colorCodedElement&&(e.colorCodedElement.style.backgroundColor="inherit")}))}});return e.namespace("DS/SPYUI/CATSimNavDataFrameViewColorShading",i)})),define("DS/SPYUI/commands/CATSPYMSRAccessCmd",["UWA/Core","DS/ApplicationFrame/CommandCheckHeader","DS/CoreEvents/Events","DS/SPYUI/controllers/SPYContext"],(function(e,t,i,n){"use strict";let a=t.extend({init:function(e){this._parent(e),this._publishToggle=!0,this.onStateChange((()=>{this._publishToggle&&a.toggleContentChooser()})),i.subscribe({event:e.context+"contentAreaVisibilityChange"},(e=>{this._publishToggle=!1,this.setState(e),this._publishToggle=!0})),i.subscribe({event:e.context+"chooseContentPanelHidden"},(()=>{this._publishToggle=!1,this.setState(!1),this._publishToggle=!0}))}});return a.toggleContentChooser=function(e,t){let a=n.getCurrentController();a&&i.publish({event:n._ctx+"toggleContentPart",data:a}),e&&e()},a})),define("DS/SPYUI/commands/CATSPYHideShowLegendCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/SPYUI/controllers/SPYContext"],(function(e,t,i){"use strict";return t.extend({init:function(e){this._parent(e,{isAsynchronous:!0,mode:"shared"})},beginExecute:function(){let e=i.getCurrentController();if(e){let t=e.getActiveDD();if(t){let i=t.getLegend();i&&(i.visibility=!i.visibility,e.setLegendFrameVisibility(i.visibility))}}this.done&&this.done(),this.end&&this.end()}})})),define("DS/SPYUI/commands/CATSPYSelectAllCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/Visualization/PathElement","DS/Core/Core","DS/CoreEvents/Events","DS/SPYUI/controllers/SPYContext"],(function(e,t,i,n,a,s){"use strict";return t.extend({init:function(e){this._parent(e,{isAsynchronous:!0,mode:"shared"})},beginExecute:function(){this._viewer=s.getCurrentController().getViewer(),a.publish({event:this._ctx+"/SPY/SELECTION/KEEPONLY_STOP"})},execute:function(){let e=s.getCurrentController().getExperience().getRootBag();var t=[];e.traverse((function(e){e.SPObj&&e.SPObj.isActive&&e.SPObj.isActive()&&t.push(new i([e.getParents()[0],e]))})),t.forEach(function(e){this._viewer.addToCSOHSO({path:[e]},{multiSel:!1,trapSel:!1})}.bind(this)),this.end()},endExecute:function(){n.Selection.CSOManager.empty(),n.Selection.HSOManager.empty()}})})),define("DS/SPYUI/CATSimNavData3DStaticColorShading",["UWA/Core","DS/Visualization/ThreeJS_DS","DS/Visualization/PathElement","DS/SPYUI/CATSimNavDataSpecColorShading"],(function(e,t,i,n){"use strict";var a=function(e,t){var i;if(e&&t){var n=e.getOverridesFromPathElement(t);if(n)for(var a,s=0;s<n.length&&!a;s++)(a=null!==n[s].getColor())&&(i=n[s])}return i},s=n.extend({_getPathElementFromRootBag:function(e){var t;if(e&&e.getParents()&&e.getParents().length>0&&e.getParents()[0].getParents()&&e.getParents()[0].getParents().length>0){var n=[e.getParents()[0].getParents()[0].getParents()[0],e.getParents()[0].getParents()[0],e.getParents()[0],e];t=new i(n)}return t},init:function(){this._parent()},setShadingColor:function(e){this._parent(e)},activateShading:function(e){if(e&&e.overrideSet&&(this._sgOverrideSet=e.overrideSet),this._sgOverrideSet&&(this._parent(),this.shadingColor&&!isNaN(this.shadingColor.red))){var i="rgb("+this.shadingColor.red+","+this.shadingColor.green+","+this.shadingColor.blue+")";this.implementation.QI("CATISimNavDataSpecUI",function(e){var n=e.getNode(),s=this._getPathElementFromRootBag(n),o=a(this._sgOverrideSet,s);if(o||(o=this._sgOverrideSet.createOverride(s)),o){var r=o.getMaterial();r&&!r.spColorCode&&(this._appliedMatToRestore=r),this._appliedMatToRestore=this._appliedMatToRestore?this._appliedMatToRestore.clone():null;var l=new t.MeshPhongMaterial({color:i,ambient:6710886,fog:!1});l.spColorCode=!0,o.setMaterial(l,!0),o.setColor(i,!0),e.applyTransparency()}}.bind(this))}},deactivateShading:function(e){this._parent(),e&&e.overrideSet&&(this._sgOverrideSet=e.overrideSet),this._sgOverrideSet&&this.implementation.QI("CATISimNavDataSpecUI",function(e){var t=e.getNode(),i=this._getPathElementFromRootBag(t),n=a(this._sgOverrideSet,i);n&&(n.setMaterial(this._appliedMatToRestore,!0),n.setColor(null,!0),this.implementation.transparent&&e.applyTransparency())}.bind(this)),this.resetOverride()},resetOverride:function(){this._sgOverrideSet=void 0}});return e.namespace("DS/SPYUI/CATSimNavData3DStaticColorShading",s)})),define("DS/SPYUI/CATSimNavData3DCamerasRootAnimationUI",["UWA/Core","DS/SPYUI/CATSimNavDataSpecUI","DS/SPY/CATSimNavData3DCamerasRoot","DS/Visualization/ThreeJS_DS","DS/CoreEvents/Events"],(function(e,t,i,n,a){"use strict";var s=function(e,t,i){var a=new n.Vector3,s=t.clone().normalize(),o=i.clone().normalize();a.crossVectors(s,o).normalize();var r=s.angleTo(o);r<.02?e.set(0,0,0,1):e.setFromAxisAngle(a,r)},o=t.extend({_getAnimationTransformation:function(e,t){var i,a=e.getLockedDOF();if(e.getLinks("CamerasToPart")){var s=e.getLinks("CamerasToPart").getPointedData().getGeometryFrameSet();isNaN(this.animationIndex)&&(this.animationIndex=s.getSize()-1),isNaN(t)?t=this.animationIndex:this.animationIndex=t;var o=function(e,t){var i,n,a;if(t){const o=t.getSize();for(var s=0;!a&&s<o;s++)(i=t.getMatrix(s))&&(n=i),s===e&&(a=i||n)}return a}(t,s);if(o&&(i=o.clone(),a)){var r=new n.Quaternion,l=new n.Vector3,c=new n.Vector3;i.decompose(l,r,c),a&&(l.x=a.Tx?0:l.x,l.y=a.Ty?0:l.y,l.z=a.Tz?0:l.z,r.x=a.Rx?0:r.x,r.y=a.Ry?0:r.y,r.z=a.Rz?0:r.z),i.compose(l,r,c)}}return i},_updateUserTransformation:function(e){e&&this._userManipulationReference&&this._lastUserTransformation&&(this._lastUserTransformation.translation.subVectors(e.cameraEye,this._userManipulationReference.cameraEye),s(this._lastUserTransformation.sightRotation,this._userManipulationReference.cameraSight,e.cameraSight),s(this._lastUserTransformation.upRotation,this._userManipulationReference.cameraUp,e.cameraUp),this._lastUserTransformation.isDefined=!0)},_getUserTransformation:function(){return this._lastUserTransformation&&this._lastUserTransformation.isDefined?this._lastUserTransformation:void 0},_resetUserManipulation:function(){this._userManipulationReference=void 0,this._viewpointManipulation={},this._lastUserTransformation={translation:new n.Vector3,sightRotation:new n.Quaternion,upRotation:new n.Quaternion,isDefined:!1}},_getUserManipulationReference:function(){return this._userManipulationReference},_setUserManipulationReference:function(e){this._userManipulationReference={cameraEye:e.cameraEye.clone(),cameraUp:e.cameraUp.clone(),cameraSight:e.cameraSight?e.cameraSight.clone():e.viewpoint.getSightDirection().clone()}},init:function(){},initAnimation:function(e){var t=this.implementation.getDataDisplay().getSPM().window.getViewer();if(t){var i=t.getViewpoints();i.length>0&&(this._mainViewpoint=i[0],this._camControl=this._mainViewpoint.getControl())}this._viewpointChangeCallback&&a.unsubscribe(this._viewpointChangeCallback),this._resetUserManipulation(),this._viewpointChangeCallback=a.subscribe({event:"/VISU/"},function(e){if(e)switch(e.eventType){case"@onViewpointBeginMove":this._userManipulating=!0;break;case"@onViewpointChange":this._userManipulating&&!this._animationUpdatingViewpoint&&(this._viewpointManipulation.cameraEye=e.cameraEye.clone(),this._viewpointManipulation.cameraUp=e.cameraUp.clone(),this._viewpointManipulation.cameraSight=e.viewpoint.getSightDirection().clone(),this._viewpointManipulation.cameraAngle=e.viewpoint.getAngle(),this._viewpointManipulation.cameraDistance=e.viewpoint.getTargetDistance(),this._updateUserTransformation(this._viewpointManipulation));break;case"@onViewpointEndMove":this._userManipulating=!1}}.bind(this)),e&&e()},getLoadingDescription:function(e){return this.implementation.getLoadingDescription(e)},animate:function(e,t){var i=this.implementation.getCurrentCamera();if(i!==this._currentCamera)this._resetUserManipulation();else if(!(i.isTracking()||t&&t.forceUpdateCamera))return;this._currentCamera=i;var a={};a.eyes=i.getEyePosition().clone(),a.sightDir=i.getSightDirection().clone(),a.upDir=i.getUpDirection().clone(),a.targetDistance=i.getTargetDistance(),a.angle=i.getAngle();var o,r,l=this._getAnimationTransformation(i,e);if(l){var c=this._getUserManipulationReference(),h={cameraEye:a.eyes.clone().applyMatrix4(l),cameraUp:a.upDir.clone().transformDirection(l),cameraSight:a.sightDir.clone().transformDirection(l)};c&&(o=new n.Quaternion,r=new n.Quaternion,s(o,c.cameraSight,h.cameraSight),s(r,c.cameraUp,h.cameraUp)),this._setUserManipulationReference(h),a.sightDir.transformDirection(l),a.upDir.transformDirection(l),a.eyes.applyMatrix4(l)}var d=this._getUserTransformation();d&&(l&&o&&r&&(d.translation.applyQuaternion(o),d.translation.applyQuaternion(r)),function(e,t){e&&t&&(e.eyes.add(t.translation),e.sightDir.applyQuaternion(t.sightRotation).normalize(),e.upDir.applyQuaternion(t.upRotation).normalize(),e.targetDistance=void 0,e.angle=void 0)}(a,d)),this._animationUpdatingViewpoint=!0,this.updateViewPoint(a),this._animationUpdatingViewpoint=!1},_getViewpoint:function(){var e,t=this.implementation.getDataDisplay().getSPM().window.getViewer();if(t){var i=t.getViewpoints();i.length>0&&(e=i[0])}return e},updateViewPoint:function(e){var t=this._getViewpoint();t&&e&&(t._SPYCameraId=this._currentCamera.getId(),t.setSightDirection(e.sightDir),t.setUpDirection(e.upDir),t.setEyePosition(e.eyes),isNaN(e.targetDistance)||t.setTargetDistance(e.targetDistance),isNaN(e.angle)||t.setAngle(e.angle))}});return e.namespace("DS/SPYUI/CATSimNavData3DCamerasRootAnimationUI",o)})),define("DS/SPYUI/commands/CATSPYShowHideExtremaCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/SPYUI/controllers/SPYContext"],(function(e,t,i){"use strict";return t.extend({init:function(e){this._parent(e,{isAsynchronous:!0,mode:"exclusive"})},beginExecute:function(){i.getCurrentController().toggleExtrema(),this.done&&this.done(),this.end&&this.end()}})})),define("DS/SPYUI/CATSimNavDataDisplayUI",["UWA/Core","DS/WebUtils/ProbesManager","DS/Visualization/Node3D","DS/SPY/CATSimNavDataDisplay","DS/CoreEvents/Events","DS/SPYUI/CATSimNavData3DExtremaNode"],(function(e,t,i,n,a,s){"use strict";var o=e.Class.extend({init:function(e){this.node=null,this.implementation=e,this.allItemsHidden=!0,this.extremaRequested=!1},getImpl:function(){return this.implementation},clean:function(){var e=function(){delete this.node,this.cleanExtrema(),this.selectCallback&&a.unsubscribe(this.selectCallback)}.bind(this),t={count:0,loopEnded:!1},i=function(i){i&&(t.count--,this.node&&this.node.remove(i.getNode()),i.clean(),0===t.count&&t.loopEnded&&e())}.bind(this),n=function(i){i&&(t.count--,i.clean(),0===t.count&&t.loopEnded&&e())},s=this.implementation.getNavData3DViewList(),o=this.implementation.getNavData2DViewList();s.forEach((function(e){e.impl.CATISimNavDataSpecUI&&(t.count++,e.QI("CATISimNavDataSpecUI",i))})),o.forEach((function(e){e.impl.CATISimNavDataSpecUI&&(t.count++,e.QI("CATISimNavDataSpecUI",n))})),t.loopEnded=!0,0===t.count&&e()},build2D:function(t){if(this.implementation){var i=this.implementation.getNavData2DViewList();if(0!==i.length){var n=new e.Element("div"),a=0,s=!1,o=function(e){e&&e.build2D((function(e){a--,e&&e.inject(n),0===a&&s&&t&&t(n)}))};i.forEach((function(e){a++,e.QI("CATISimNavDataSpecUI",o)})),s=!0,0===a&&t&&t(n)}else t&&t()}},build3D:function(e){if(!this.implementation||!e||!e.parentNode&&!e.existingNode)return;this.implementation.startAnalyticsTimeUpdate("visuCreationTime");var n=this.implementation.getNavData3DViewList();let a=e.list3DViewsToFilter;if(Array.isArray(a)&&a.length>0)for(let e=n.length-1;e>=0;e--)a.includes(n[e].getName())&&n.splice(e,1);if(0===n.length)return this.implementation.stopAnalyticsTimeUpdate("visuCreationTime"),void(e.callback&&e.callback());var s=0,o=t.createProbe("MsrEcBuild3D");o.begin(),e.existingNode?(this.node=e.existingNode,this.node.setName(this.implementation.name)):this.node=new i(this.implementation.name),e.parentNode&&e.parentNode.addChild(this.node),this.node.SPObj=this.implementation;var r=function(){var e=this.getImpl().getSPM();e&&e.processLoadFiles("Geometry")}.bind(this),l=function(){o.end(),this.implementation.stopAnalyticsTimeUpdate("visuCreationTime"),this.implementation.integrateRSCExtractionTime(s),e.callback&&e.callback(this.node)}.bind(this),c={count:0,loopEnded:!1},h={count:0,loopEnded:!1},d=function(t){t?(t.loadRenderingMaterial&&t.loadRenderingMaterial(),t.build3D({animationIndex:e.animationIndex,initProgressFromCurrent:e.initProgressFromCurrent,overrideManager:e.overrideManager,postLoadingCallback:function(e,i){if(i){var n=i.maxRscExtractionTime;s=n>s?n:s}this.node.addChild(t.node),t.initRenderingMaterial&&t.initRenderingMaterial((function(){t.getImpl().transparent&&t.applyTransparency()}));var a=t.getImpl();a&&a.setLoadingStatus&&a.setLoadingStatus(e,"loaded"),h.count--,0===h.count&&h.loopEnded&&l()}.bind(this),callback:function(){c.count--,0===c.count&&c.loopEnded&&r()}})):(c.count--,h.count--)}.bind(this);n.forEach((function(e){e.isActive()&&(c.count++,h.count++,e.QI("CATISimNavDataSpecUI",d))})),c.loopEnded=!0,h.loopEnded=!0,0===c.count&&r()},getInfoContent:function(){return this._infoContent},updateFrame:function(e,t){if(this.implementation){var i=this.implementation.getNavDataFrameViewList();if(i&&0!==i.length){var n=function(i){i&&i.updateFrame(e,t)};i.forEach((function(e){e.QI("CATISimNavDataSpecUI",n)}))}}},cleanInfoContent:function(){this._infoContent&&(this._infoContent.remove().destroy(),this._infoContent=void 0)},buildFrame:function(t,i){if(this._infoContent)return this.updateFrame(t),i(),this._infoContent;if(this._infoContent=void 0,this.implementation){var n=this.implementation.getNavDataFrameViewList();if(!n||0===n.length)return this._infoContent;this._infoContent=new e.Element("table",{class:"spy-infopane-content-table"});var s=[],o=[],r=function(){o.forEach(function(e){e&&e.inject(this._infoContent)}.bind(this)),this.selectCallback&&a.subscribe(this.selectCallback);this.selectCallback=a.subscribe({event:this.getImpl().getSPM().getContext()+"/SPY/FRAMEVIEW/SELECT"},function(e){var t=function(e,i){if(e&&e!==i){e.setHighlightFlag(!1);var n=e.implementation.children,a=function(e){t(e,i)};n&&n.forEach((function(e){e.QI("CATISimNavDataSpecUI",a)}))}};e&&s.forEach((function(i){t(i,e)}))}.bind(this)),a.publish({event:this.getImpl().getSPM().getContext()+"/SPY/DATADISPLAY/FRAMEBUILT"}),i&&i()}.bind(this),l={count:0,loopEnded:!1},c=function(e){var i,n,a,c;i=e,n=l,a=0===e.getImpl()._spyRank,c=r,i&&n&&(s.push(i),i.buildFrame(t,a,(function(e){o[i.getImpl()._spyRank]=e,n.count--,0===n.count&&n.loopEnded&&c&&c()})))};return n.forEach((function(e,t){l.count++,e._spyRank=t,e.QI("CATISimNavDataSpecUI",c)})),l.loopEnded=!0,0===l.count&&r(),this._infoContent}},getNode:function(){return this.node},computeExtrema:function(e,t){let i=!1,n=this.getImpl().getLegend();n&&n.isInverted()&&(i=!0);var a=!1,o=!1;this.allItemsHidden=!0;var r,l,c=[],h=[],d=[],u=[],m=function(e,t,i,n){var a={extremum:void 0,isHidden:!1};if(e.length===i.length){var s=-1,o=!1;e.forEach((function(e,r){if(!1,e&&(!n||n&&i[r])){var l=parseFloat(e.getExtremaValue());o||(s=l,a.extremum=e,a.isHidden=!i[r],o=!0),(t&&l>s||!t&&l<s)&&(s=l,a.extremum=e,a.isHidden=!i[r])}}))}return a},g=function(){var e=this.implementation.spm.window.SPMUI.getValueDisplayPrecision(),n=!0,g=m(h,n,u,!1);if(r=g.extremum,(o=g.isHidden)&&r){var p=parseFloat(r.getExtremaValue());g=m(h,n,u,!0),(r=g.extremum)&&(o=p.toPrecision(e)!==parseFloat(r.getExtremaValue()).toPrecision(e))}if(g=m(c,n=!1,d,!1),l=g.extremum,a=g.isHidden){var v=parseFloat(l.getExtremaValue());g=m(c,n,d,!0),(l=g.extremum)&&(a=v.toPrecision(e)!==parseFloat(l.getExtremaValue()).toPrecision(e))}var S=this.implementation.spm.window.getViewer();if(S){var f,_=S.getRootNode();if(l&&(f=l.getPosition()),r){var b=r.getPosition();this.maxExtremum||(this.maxExtremum=new s(S,o?"PartialMax":"GlobalMax","SimNavMax",i)),this.maxExtremum&&(0===this.maxExtremum.parents.length&&_.add(this.maxExtremum),this.maxExtremum.setExtremaType(o?"PartialMax":"GlobalMax"),this.maxExtremum.setAssociatedComponent(r.getComponent()),this.maxExtremum.setExtremaValue(parseFloat(r.getExtremaValue()).toPrecision(e)),this.maxExtremum.setNormalVector(r.getNormalVector()),this.maxExtremum.setPosition(b),this.maxExtremum.setAntiConflictFlag(b.distanceTo(f)<=1))}else this.maxExtremum&&(this.maxExtremum.setExtremaValue(""),this.maxExtremum.setAssociatedComponent(),this.maxExtremum.setAntiConflictFlag(!1));l?(this.minExtremum||(this.minExtremum=new s(S,a?"PartialMin":"GlobalMin","SimNavMin",i)),this.minExtremum&&(0===this.minExtremum.parents.length&&_.add(this.minExtremum),this.minExtremum.setExtremaType(a?"PartialMin":"GlobalMin"),this.minExtremum.setAssociatedComponent(l.getComponent()),this.minExtremum.setExtremaValue(parseFloat(l.getExtremaValue()).toPrecision(e)),this.minExtremum.setNormalVector(l.getNormalVector()),this.minExtremum.setPosition(f))):this.minExtremum&&(this.minExtremum.setExtremaValue(""),this.minExtremum.setAssociatedComponent()),t()}}.bind(this),p=this.implementation.getNavData3DViewList("plotContentOnly"),v=0,S=!1,f=function(t){v--;var i=t?t.getExtrema(e):void 0;if(i){var n=i.listMin,a=i.listMax;if(n&&n.length<=1&&a&&a.length<=1){var s=function(e){var t=!1;if(e&&!(t=e.visibility)){var i=e.getSibling();t=i&&i.visibility}return t}(t.getImpl());this.allItemsHidden&&s&&(this.allItemsHidden=!1),n&&1===n.length&&n[0]&&(c.push(n[0]),d.push(s)),a&&1===a.length&&a[0]&&(h.push(a[0]),u.push(s))}}0===v&&S&&g()}.bind(this);p.forEach((function(e){e.supportedModes&&-1!==e.supportedModes.indexOf("ENG")&&"CATSimNavData3DExtremasRoot"!==e.getType()&&(v++,e.QI("CATISimNavDataExtremaProvider",f))})),S=!0,0===v&&g()},setExtremaVisibility:function(e){this.minExtremum&&this.minExtremum.setVisibility(e&&this.minExtremum.getExtremaValue().length>0&&!this.allItemsHidden),this.maxExtremum&&this.maxExtremum.setVisibility(e&&this.maxExtremum.getExtremaValue().length>0&&!this.allItemsHidden)},getVisibleExtrema:function(){var e=[];return this.minExtremum&&this.minExtremum.isVisible()&&e.push(this.minExtremum),this.maxExtremum&&this.maxExtremum.isVisible()&&e.push(this.maxExtremum),e},cleanExtrema:function(){this.minExtremum&&this.minExtremum.clean(),this.maxExtremum&&this.maxExtremum.clean(),this.minExtremum=null,this.maxExtremum=null},getExtremaRequestedFlag:function(){return this.extremaRequested},setExtremaRequestedFlag:function(e){this.extremaRequested=e}});return e.namespace("DS/SPYUI/CATSimNavDataDisplayUI",o)})),define("DS/SPYUI/CATSimNavDataFrameViewCompUI",["UWA/Core","DS/SPYUI/CATSimNavDataSpecUI","DS/Core/Core","DS/CoreEvents/Events","DS/Visualization/PathElement"],(function(e,t,i,n,a){"use strict";var s=t.extend({init:function(){this._parent()},buildFrame:function(e){alert("error: call to buildFrame on CATSimNavDataFrameViewCompUI")},enableCrossHighlight:function(){if(!this._xhighlightEnabled){var e=this.implementation.getLinks("Frameto3D");if(e)this.pointedData=e.getPointedData(),this.addToCsoCallback=i.Selection.CSOManager.onAdd(this.addToCso.bind(this)),this.removeFromCsoCallback=i.Selection.CSOManager.onRemove(this.removeFromCso.bind(this)),this.highlightFlag=!1,this.renderHighlight(this.highlightFlag),this.selectableWidget&&(this.selectableClickListener=function(e){this._expander&&!this._expander.expandedFlag||(this.highlightFlag=!this.highlightFlag,this.highlightFlag?(this.addPointedToCSO(),n.publish({event:this.getImpl().getDataDisplay().getSPM().getContext()+"/SPY/FRAMEVIEW/SELECT",data:this})):this.removePointedFromCSO(),this.renderHighlight(this.highlightFlag))},this.selectableWidget.addEvent("click",this.selectableClickListener.bind(this))),this.addToCso(i.Selection.CSOManager.get()[0]);else{var t=this.implementation.children;if(t)for(var a=function(e){e&&e.enableCrossHighlight()},s=0;s<t.length;s++){var o=t[s];o&&o.QI("CATISimNavDataSpecUI",a)}}this._xhighlightEnabled=!0}},disableCrossHighlight:function(){this.highlightFlag=!1,this.renderHighlight(this.highlightFlag),this.addToCsoCallback&&i.Selection.CSOManager.unsubscribe(this.addToCsoCallback),this.removeFromCsoCallback&&i.Selection.CSOManager.unsubscribe(this.removeFromCsoCallback),this.selectableWidget&&this.selectableWidget.removeEvent("click");var e=this.implementation.children;if(e)for(var t=function(e){e&&e.disableCrossHighlight()},n=0;n<e.length;n++){var a=e[n];a&&a.QI("CATISimNavDataSpecUI",t)}this._xhighlightEnabled=!1},setHighlightFlag:function(e){e!==this.highlightFlag&&(this.highlightFlag=e,this.renderHighlight(e))},renderHighlight:function(e){if(this.selectableWidget){var t="spy-info-highlight";e?this.selectableWidget.addClassName(t):this.selectableWidget.removeClassName(t)}},addPointedToCSO:function(){var e=null;this.pointedData&&this.pointedData.QI("CATISimNavDataSpecUI",(function(t){var i=t.getNode();i&&i.getParents()&&i.getParents().length>0&&(e=new a([i.getParents()[0],i]))})),e&&(i.Selection.CSOManager.unique({pathElement:e}),i.Selection.HSOManager.unique({pathElement:e}))},removePointedFromCSO:function(){var e=null;this.pointedData&&this.pointedData.QI("CATISimNavDataSpecUI",(function(t){var i=t.getNode();i&&i.getParents()&&i.getParents().length>0&&(e=new a([i.getParents()[0],i]))})),e&&(i.Selection.CSOManager.remove({pathElement:e,infoClick:!0}),i.Selection.HSOManager.remove({pathElement:e}))},addToCso:function(e){if(e&&!e.infoClick){var t=null,i=e.pathElement;if(i){for(var n=i.getLength()-1;!t&&n>0;)i.getElement(n--).SPObj&&(t=i.getElement(n+1).SPObj);t&&this.setHighlightFlag(t===this.pointedData)}}},removeFromCso:function(e){if(e&&!e.infoClick){var t=null,i=e.pathElement;if(i){for(var n=i.getLength()-1;!t&&n>0;)i.getElement(n--).SPObj&&(t=i.getElement(n+1).SPObj);t&&t===this.pointedData&&this.setHighlightFlag(!1)}}},onExpanderChange:function(){},getLayoutPreferences:function(){var e={};return this.implementation.getLayoutPreferences&&(e=this.implementation.getLayoutPreferences()),e}});return e.namespace("DS/SPYUI/CATSimNavDataFrameViewCompUI",s)})),define("DS/SPYUI/CATSimNavDataFrameViewTextUI",["UWA/Core","DS/SPYUI/CATSimNavDataFrameViewCompUI"],(function(e,t){"use strict";var i=t.extend({init:function(){this._parent()},buildFrame:function(t,i,n){if(!this.implementation)return null;var a=new e.Element("tr",{class:"spy-infopane-content-table-scalar"});this._valueCell=new e.Element("td",{class:"spy-infopane-content-text-value",attributes:{colspan:"5"},styles:{"max-width":String(.8*t)+"px"}}).inject(a);var s=new e.Element("b").inject(this._valueCell),o=this.implementation.getValues();return o&&o.value&&s.setText(o.value),this.selectableWidget=a,n&&n(a),a},updateFrame:function(e){this._valueCell&&(this._valueCell.style["max-width"]=String(.8*e)+"px")}});return e.namespace("DS/SPYUI/CATSimNavDataFrameViewTextUI",i)})),define("DS/SPYUI/CATSimNavDataFrameViewCompValueUI",["UWA/Core","DS/SPYUI/CATSimNavDataFrameViewCompUI"],(function(e,t){"use strict";var i=t.extend({init:function(){this._parent()},buildFrame:function(t,i,n){if(!this.implementation)return null;var a=new e.Element("tr",{class:"spy-infopane-content-table-scalar"}),s=new e.Element("td",{class:"spy-infopane-content-scalar-name"}).inject(a),o=new e.Element("td").inject(a),r=new e.Element("td",{class:"spy-infopane-content-scalar-value"}).inject(a),l=new e.Element("b").inject(r),c=this.implementation.getValues();return c.value&&l.setText(c.value),c.unit&&c.unit.length>0?(new e.Element("td",{class:"spy-infopane-content-scalar-unit"}).inject(a).setText(c.unit),new e.Element("td",{class:"spy-infopane-content-scalar-spacer"}).inject(a)):r.setAttribute("colSpan","3"),"NoInfo"===this.implementation.getId()&&c&&void 0===c.value&&void 0===c.unit&&(c.name="No detailed information could be produced"),s.setText(c.name),c.type&&o.setText(c.type),this.selectableWidget=a,n&&n(a),a}});return e.namespace("DS/SPYUI/CATSimNavDataFrameViewCompValueUI",i)})),define("DS/SPYUI/CATSimNavDataFrameViewUI",["UWA/Core","DS/SPYUI/CATSimNavDataFrameViewCompUI","DS/CoreEvents/Events","DS/Core/PointerEvents","DS/Controls/Expander","DS/Controls/Button","DS/Controls/TooltipModel"],(function(e,t,i,n,a,s,o){"use strict";var r=t.extend({_processExpandCollapse:function(e){if(this.implementation){var t=this.implementation.getChildren(),n={count:0,loopEnded:!1},a=function(e){var t=this.getImpl().getDataDisplay().getSPM();i.publish({event:t.getContext()+"/SPY/FRAMEVIEW/EXPAND",data:this}),i.publish({event:t.getContext()+"/SPY/EXPANDABLEUI/CHANGE",data:{expandableId:this.implementation.getId(),expanded:e}})}.bind(this),s=function(t){t&&t.onExpanderChange(e),n.count--,0===n.count&&n.loopEnded&&a(e)};t.forEach((function(e){n.count++,e.QI("CATISimNavDataSpecUI",s)})),n.loopEnded=!0,0===n.count&&a(e)}},init:function(){this._parent(),this.animationInitialized=!1},setExpandStatus:function(e){this._expander&&(e?this._expander.expand():this._expander.close())},updateFrame:function(e,t){if(this.implementation){var i=this.implementation.getChildren(),n=function(i){i&&i.updateFrame(e,t)};i.forEach((function(e){e.QI("CATISimNavDataSpecUI",n)}))}},buildFrame:function(t,i,n,s,o){if(this.implementation){s=void 0===s||s,o=void 0!==o&&o;var r=new e.Element("tr",{class:"spy-infopane-content-table-framerow"}),l=new e.Element("table",{class:"spy-infopane-content-table"}).inject(r),c=new e.Element("tr").inject(l);this.implementation.listLinks&&this.implementation.listLinks.Frameto3D&&(this.colorCodedElement=new e.Element("td",{class:"spy-infopane-colorcode"}).inject(c));var h=new e.Element("td").inject(c),d=new e.Element("div",{class:"spy-infopane-content"}).inject(h),u=this.implementation.getChildren();if(u.length>0){s||o||new e.Element("p",{class:"spy-infopane-content-section-title"}).inject(d).setText(this.implementation.getName());var m=new e.Element("table",{class:"spy-infopane-content-table"}).inject(d),g=new e.Element("div",{class:"spy-infopane-content-table-nbCharts"});if(this.implementation.getNbCharts&&this.implementation.getNbCharts()>0){new e.Element("div",{class:"spy-infopane-content-table-nbCharts-num"}).inject(g).setText(this.implementation.getNbCharts().toString());var p=new e.Element("div",{class:"spy-infopane-content-table-nbCharts-icon"}).inject(g);new e.Element("div",{class:"wux-ui-3ds wux-ui-3ds-chart-line-single"}).inject(p)}s&&(this._expander=new a({header:this.implementation.getName(),body:m,allowUnsafeHTMLLabel:!0,customHeader:g}).inject(d),this._expander.addEventListener("expand",function(){this._processExpandCollapse(!0)}.bind(this)),this._expander.addEventListener("collapse",function(){this._processExpandCollapse(!1)}.bind(this))),this.expandableZone=m;var v=this.getLayoutPreferences().expanded,S=void 0!==v?v:s&&i,f=[],_=function(){f.forEach((function(e){e&&e.inject(m)})),n&&n(r),this.setExpandStatus(S)}.bind(this),b=this.implementation.getId(),C=function(e,n,a){if(n){var s,o=i,r=e.implementation;r.getChildren&&r.getChildren().length>0&&0!==r._spyRank&&(o=!1),r.getLayoutPreferences&&(s=r.getLayoutPreferences()),this._expander&&!s||(o=!0),r.isExtractable&&(o=o&&0===r._spyRank),e.buildFrame(t,o,(function(t){n.count--,f[e.implementation._spyRank]=t,0===n.count&&n.loopEnded&&a&&a()}),e.implementation.isComplex(),e.implementation.getId()===b)}}.bind(this),D={count:0,loopEnded:!1},x=function(e){C(e,D,_)};u.forEach((function(e,t){D.count++,e._spyRank=t,e.QI("CATISimNavDataSpecUI",x)})),D.loopEnded=!0,0===D.count&&_()}else n&&n(r);return this.selectableWidget=d,r}},renderHighlight:function(e){if(this.selectableWidget){var t="spy-info-highlight";e?this.selectableWidget.addClassName(t):this.selectableWidget.removeClassName(t)}this.expandableZone&&e&&this.setExpandStatus(!0)},initAnimation:function(e){if(this.animationInitialized)e&&e();else if(this.implementation){var t=0,i=!1,n=function(){0===t&&i&&e&&(this.animationInitialized=!0,e())}.bind(this),a=function(e){e?e.initAnimation((function(){t--,n()})):t--}.bind(this);this.implementation.getChildren().forEach((function(e){t++,e.QI("CATISimNavDataAnimation",a)})),i=!0,n()}},animate:function(e,t){if(this.implementation&&this.animationInitialized){var i=function(i){i&&i.animate(e,t)};this.implementation.getChildren().forEach((function(e){e.QI("CATISimNavDataAnimation",i)}))}}});return e.namespace("DS/SPYUI/CATSimNavDataFrameViewUI",r)})),define("DS/SPYUI/commands/CATSPYResetCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/Core/Core","DS/CoreEvents/Events","DS/SPYUI/controllers/SPYContext"],(function(e,t,i,n,a){"use strict";return t.extend({init:function(e){this._parent(e,{isAsynchronous:!0,mode:"shared"}),n.publish({event:this._ctx+"/SPY/SELECTION/KEEPONLY_STOP"})},destroy:function(){i.Selection.CSOManager.empty(),i.Selection.HSOManager.empty()}})})),define("DS/SPYUI/commands/CATSPYTranspResetCmd",["UWA/Core","DS/SPYUI/commands/CATSPYResetCmd","DS/SPYUI/controllers/SPYContext"],(function(e,t,i){"use strict";return t.extend({init:function(e){this._parent(e)},beginExecute:function(){let e,t,n=i.getCurrentController();if(n){e=n.getViewer();let i=n.getExperience();t=i?i.getRootBag():void 0}if(t){let i=0,n=!1,a=()=>{e.render()},s=()=>{i--,0===i&&n&&a()};t.traverse((function(e){e.SPObj&&e.SPObj.transparent&&(i++,e.SPObj.transparent=!1,e.SPObj.QI("CATISimNavDataSpecUI",(function(e){e&&e.applyTransparency(s)})))})),n=!0,0===i&&a()}this.end?this.end():this.done()}})})),define("DS/SPYUI/commands/CATSPYRHESwitchResetCmd",["UWA/Core","DS/SPYUI/commands/CATSPYResetCmd","DS/SPYUI/controllers/SPYContext"],(function(e,t,i){"use strict";return t.extend({init:function(e){this._parent(e)},beginExecute:function(){let e=i.getCurrentController();if(e){this._viewer=e.getViewer();let t=e.getExperience().getRootBag(),i=e.getActiveDD(),n=this;i.QI("CATISimNavDataColorShadingManager",(function(e){if(e.supportsShading())e.activateShading({forceFlag:!0}),n._viewer.render();else{for(var a,s=t.getChildByName(i.name),o=s.children.length,r=new Array(o),l=0;l<o;l++)r[l]=s.children[l];var c=function(e){e&&e.hasRenderingMaterial()&&(e.removeRenderingMaterial(),n._viewer.render())};for(a=0;a<o;a++){var h=r[a];if(h.SPObj){var d=h.SPObj;d.supportedModes&&(-1===d.supportedModes.search(i.defaultMode)?n.switchMode(d,h,s):d.supportedModes.search("ENG")>=0&&d.supportedModes.search("REA")>=0&&d.QI("CATISimNavDataSpecUI",c))}}}}))}this.end?this.end():this.done()},switchMode:function(e,t,n){let a=i.getCurrentController();var s=a?a.getAnimationFrameIndex():void 0,o=a?a.getActiveDD():void 0,r=e.getSibling();r&&o&&(e.setActive(!1),e.setLoadingStatus&&!isNaN(s)&&e.setLoadingStatus(s,"notLoaded"),r.setActive(!0),r.transparent=e.transparent,n.remove(t),r.QI("CATISimNavDataSpecUI",function(e){var t=o.getSPM();t&&(e.build3D({animationIndex:s,overrideManager:a.getOverrideManager(),postLoadingCallback:function(){n.addChild(e.node),e.applyTransparency(),isNaN(s)||(
//!! the buil3D of replacing item would load for last stored anim frameIndex
e.getImpl().setLoadingStatus(s,"loaded"),this._viewer.render())}.bind(this)}),t.processLoadFiles())}.bind(this)))}})})),define("DS/SPYUI/commands/CATSPYHideShowResetCmd",["UWA/Core","DS/SPYUI/commands/CATSPYResetCmd","DS/SPYUI/controllers/SPYContext"],(function(e,t,i){"use strict";return t.extend({init:function(e){this._parent(e)},beginExecute:function(){let e=i.getCurrentController();if(e){let t=e.getExperience(),i=t?t.getRootBag():void 0;i&&i.traverse((e=>{if(e.SPObj&&(e.setVisibility(!e.SPObj.isActive||e.SPObj.isActive()),e.SPObj.visibility=!0,e.SPObj.getSibling)){let t=e.SPObj.getSibling();t&&(t.visibility=!0)}}));let n=e.streamsManager;n&&n.showAll(),e.getViewer().render(),e.updateExtrema()}this.end?this.end():this.done()}})})),define("DS/SPYUI/CATSimNavData2DViewUI",["UWA/Core","DS/SPYUI/CATSimNavDataSpecUI"],(function(e,t){"use strict";var i=t.extend({init:function(){this._parent()},build2D:function(t){if(this.implementation){var i=this.implementation.getPNGList();this._images=[];var n=new e.Element("div",{styles:{margin:"10px"}});Array.isArray(i)||(i=i.files),Array.isArray(i)||i.forEach((function(t,i){var a=new e.Element("img").inject(n),s=t.getPointedResource(i);a.src=s,this._images.push(a),this._loadImageFromZip(a,s)})),this._initImagesVisibility(),t&&t(n)}},_loadImageFromZip:function(e,t){var i=this.implementation.getDataDisplay();i&&i.spm.loadImage(i.seq,t,(function(t){e.src=t}))},_initImagesVisibility:function(){for(var e=0;e<this._images.length;e++)this._images[e].show()}});return e.namespace("DS/SPYUI/CATSimNavData2DViewUI",i)})),define("DS/SPYUI/CATSimNavData2DRepStaticViewUI",["UWA/Core","DS/SPYUI/CATSimNavData2DViewUI"],(function(e,t){"use strict";var i=t.extend({init:function(){this._parent()}});return e.namespace("DS/SPYUI/CATSimNavData2DRepStaticViewUI",i)})),define("DS/SPYUI/CATSimNavData2DAnimationViewUI",["UWA/Core","DS/SPYUI/CATSimNavData2DViewUI"],(function(e,t){"use strict";var i=t.extend({init:function(){this._parent()},_initImagesVisibility:function(){for(var e=0;e<this._images.length;e++)this._images[e].hide();this.animationIndex=this._images.length-1,this._images[this.animationIndex].show()},initAnimation:function(e){e&&e()},animate:function(e,t){this.animationIndex=e;for(var i=0;i<this._images.length;i++)i===e?this._images[i].show():this._images[i].hide()}});return e.namespace("DS/SPYUI/CATSimNavData2DAnimationViewUI",i)})),define("DS/SPYUI/CATSimNavData3DViewUI",["UWA/Core","DS/SPYUI/CATSimNavDataSpecUI","DS/Visualization/PathElement","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D"],(function(e,t,i,n,a){"use strict";var s="SP_REAMAT_ID",o=t.extend({init:function(e){this._parent(e),this.node=null,this._overrideManager=null},clean:function(){this.node&&(this.node.removeChildren(),delete this.node),this._overrideManager&&delete this._overrideManager,this._Rmaterial&&delete this._Rmaterial,this._matFatherNode&&delete this._matFatherNode,this._parent()},build3D:function(){},getNode:function(){return this.node},getReferenceNode:function(){return this.node?this.node.children[0]:void 0},applyTransparency:function(e){var t=e||function(){},a=this.getNode(),s=a?a.SPObj:void 0,o=s?s.getDataDisplay():void 0;if(a&&a.getParents()&&a.getParents().length>0&&s){var r,l=new i([a.getParents()[0].getParents()[0].getParents()[0],a.getParents()[0].getParents()[0],a.getParents()[0],a]),c=s.transparent?.6:null;if(this._overrideManager){var h=this._overrideManager.getOverrideSet("SPMUI");if(h){var d=h.getOverridesFromPathElement(l);if(d)for(var u,m=0;m<d.length&&!u;m++){if(!(u=null!==d[m].getOpacity())){var g=d[m].getMaterial();u=g&&"SP_TRANSPMAT_ID"===g.spTranspId}u&&(r=d[m])}r||(r=h.createOverride(l))}}var p=function(e){r&&r.setOpacity(e)},v=function(){if(r&&null!==c){var e=new n.MeshPhongMaterial({color:"rgb(255,255,255)"});e.spTranspId="SP_TRANSPMAT_ID",r.setMaterial(e,!0),r.setOpacity(.7,!0)}},S=r?r.getMaterial():void 0;if(S&&"SP_TRANSPMAT_ID"===S.spTranspId)null===c&&r&&(r.setMaterial(null,!0),r.setOpacity(null,!0)),t();else{let e=this.getReferenceNode(),i=e&&e.children[0]?e.children[0]:void 0,a=i&&i.mesh3js?i.mesh3js.material:void 0;(S=S||(e.material?e.material:a))?S instanceof n.ShaderMaterial?(v(),t()):"Mesh"===o.type||(o.plotType||"Result"===o.category)&&-1!==s.supportedModes.indexOf("ENG")?(p(c),t()):s.QI("CATISimNavDataColorShading",(function(e){e&&e.isShadingActive()?p(c):v(),t()})):(p(c),t())}}},loadRenderingMaterial:function(e){var t=this.getImpl().getRenderingMaterial();if(t&&t.length>4){var i=[];i.push(t);var n=this.implementation.getDataDisplay().getSPM(),o=this.implementation.getDataDisplay().getSequence();this._matFatherNode=new a;var r=function(e){var t;if(e){var i=e.getPrimitives?e.getPrimitives():void 0;if(i)for(var n=0;n<i.length&&!t;n++){var a=i[n];a&&"FACE"===a.getGeometricType()&&(t=a.sgNode.getGroup().material?a.sgNode.getGroup().material:void 0)}}return t},l=function(){var t=this._matFatherNode.children.length>0?this._matFatherNode.children[0]:void 0;t&&(t.children.length>0?this._Rmaterial=r(t.children[0]):this._Rmaterial=r(t)),this._Rmaterial&&(this._Rmaterial.mpwMatID=s,this._hasRMat=!0),e&&e()}.bind(this);n.loadFiles({type:"Geometry",filesList:i,fatherNode:this._matFatherNode,sequence:o,callback:l,resetProgress:!1})}},initRenderingMaterial:function(e){var t=function(){if(this._isRMatApplied&&this._Rmaterial&&this._overrideManager){var e=this.getNode();this._overrideManager.applyMaterialOverride("SPMUI",e,this._Rmaterial,s)}}.bind(this);!1===this._hasRMat||this._hasRMat&&this._Rmaterial?t():(void 0===this._hasRMat&&(this._hasRMat=!1,this._isRMatApplied=!1,this._Rmaterial=null),this.loadRenderingMaterial(t)),e&&e()},hasRenderingMaterial:function(){return this._hasRMat&&this._Rmaterial},isRenderingMaterialApplied:function(){return this._isRMatApplied},applyRenderingMaterial:function(){if(this._overrideManager&&!this._isRMatApplied){var e=this.getNode();this._overrideManager.applyMaterialOverride("SPMUI",e,this._Rmaterial,s),this._isRMatApplied=!0}},removeRenderingMaterial:function(){this._overrideManager&&(this._overrideManager.removeMaterialOverride("SPMUI",this.getNode(),this._isRMatApplied,s),this._isRMatApplied=!1)},applyPassFailMaterial:function(){if(this._overrideManager){var e=this.getNode();this._overrideManager.applyPassFailMaterial("SPMUI",e)}},removePassFailMaterial:function(){this._overrideManager&&this._overrideManager.removePassFailMaterial("SPMUI",this.getNode())}});return e.namespace("DS/SPYUI/CATSimNavData3DViewUI",o)})),define("DS/SPYUI/CATSimNavData3DRepStaticViewUI",["UWA/Core","DS/Visualization/Node3D","DS/Visualization/PathElement","DS/SPYUI/CATSimNavData3DViewUI"],(function(e,t,i,n){"use strict";var a=n.extend({init:function(){},build3D:function(e){this.implementation&&e&&(this._overrideManager=e.overrideManager,this.node=new t(this.implementation.getId()),this.node.SPObj=this.implementation,this.node.productType="Reference3D",this.implementation.getDataDisplay().QI("CATISimNavDataDisplayUI",function(){var t=this.implementation.visibility,i=this.implementation.isActive(),n=this.implementation.getGeometryFiles(),a=this.implementation.getDataDisplay().getSPM(),s=this.implementation.getDataDisplay().getSequence(),o=function(e){if(e){for(var t=0;t<e.children.length;t++)o(e.children[t]);e.setPickParent(!0)}},r=function(){for(var t=0;t<this.node.children.length;t++)o(this.node.children[t]);e.postLoadingCallback&&e.postLoadingCallback()}.bind(this);a.loadFiles({type:"Geometry",initProgressFromCurrent:e.initProgressFromCurrent,filesList:n,fatherNode:this.node,sequence:s,callback:function(){this.node.setVisibility(t&&i);for(var e=0;e<this.node.children.length;e++){this.node.children[e].setVisibility(!0),o(this.node.children[e]);for(var n=0;n<this.node.children[e].children.length;n++)this.node.children[e].children[n].exludeFromBounding(!1),this.node.children[e].children[n].hasExplicitBE&&!isFinite(this.node.children[e].children[n].explicitBBox.max.x)&&this.node.children[e].children[n].forceBoundingBox({max:{x:0,y:0,z:0},min:{x:0,y:0,z:0}})}r()}.bind(this),resetProgress:!1}),e.callback&&e.callback()}.bind(this)))}});return e.namespace("DS/SPYUI/CATSimNavData3DRepStaticViewUI",a)})),define("DS/SPYUI/controllers/ChooseContentController",["i18n!DS/SPYUI/assets/nls/ChooseContent","i18n!DS/SPYUI/assets/nls/ContentReport","UWA/Core","UWA/Controls/ToolTip","UWA/Class","DS/CoreEvents/Events","DS/ApplicationFrame/Command","DS/WebappsUtils/WebappsUtils","DS/SPYLoader/SPYLoader","DS/SPYLoader/MSRFileTreeProxy","DS/SPYUI/views/ChooseContentView","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel"],(function(e,t,i,n,a,s,o,r,l,c,h,d,u){"use strict";const m="SPY/THUMBNAILS/LOADED",g=r.getProxifiedWebappsBaseUrl()?r.getProxifiedWebappsBaseUrl():r.getWebappsBaseUrl();return a.singleton({_lockContentAreaVisibility:function(){this._lockCtAreaVis=!0},_unlockContentAreaVisibility:function(){this._lockCtAreaVis=!1},_setContentAreaVisibility:function(e){this.isVerticalMobile||this._lockCtAreaVis||this._contentAreaVisibility===e||(this._contentAreaVisibility=e,h.setChooseContentVisibility(e),s.publish({event:this.ctx+"contentAreaVisibilityChange",data:e}))},_getContentAreaVisibility:function(){return h.getChooseContentVisibility()},_getActiveMainController:function(){let e;return this.spmUI&&this.spmUI.window&&this.spmUI.window.SPMUI&&(e=this.spmUI.window.SPMUI),e},_onDataDisplayActivation:function(){let t=this._getContentAreaVisibility(),i=h.getCurrentSelectedValue();this._updateView();let n=[],a=this._getActiveMainController();if(a){let o=a.getActiveSequence(),r=a.getSPM().getSequenceName(o);t&&!i&&(i="cnt"),n.push({label:"cnt"===i?r:e.homeItemBC,value:i}),s.publish({event:this.ctx+"updateSelectedItem",data:{selectedItems:n}})}this._setContentAreaVisibility(t)},_toggleContentPart:function(e){if(!this._processingToggleEvent){this._processingToggleEvent=!0;let t=[],i=()=>{let e=this._getActiveMainController();if(e){let i=e.getActiveSequence(),n=e.getSPM().getSequenceName(i);t.push({label:n,value:"cnt"})}};if(this._lockContentAreaVisibility(),e){if(this.isVerticalMobile=e.isVerticalMobileLayout(),this.isVerticalMobile){let e=h.getPanelVisibility();h.setPanelVisibility(!e)}!1===this._contentAreaVisibility&&"treeView"!==h.getCurrentView()&&i(),s.publish({event:this.ctx+"updateSelectedItem",data:{selectedItems:t}}),this._unlockContentAreaVisibility(),this._setContentAreaVisibility(!this._contentAreaVisibility),this._isReport||this.createReport()}this._processingToggleEvent=!1}},_breadCrumbClickOn:function(e){if(!this._processingBC){this._processingBC=!0;let t=e?JSON.stringify(e.selectedItems):void 0,i=e&&e.selectedItems?e.selectedItems.value:void 0,n=!1,a=()=>{if(e.selectedItems)if(h.clearPanelContent(),"treeView"===h.getCurrentView())this._changeViewClickOn({comboItem:"treeView"}),h.disableBreadCrumbItems(),this._processingBC=!1;else{this.treedocModel=new d;let t=this._getActiveMainController();this.loadTreeModel(t.getSPM(),e.selectedItems.value)}else this._processingBC=!1};a(),n=!0,this._lastSel!==t&&(this._lastSel&&t?i!==this._lastSelValue&&this._setContentAreaVisibility(!0):this._setContentAreaVisibility(!this._contentAreaVisibility),n||a()),this._lastSel=t,this._lastSelValue=i}},_thumbnailClickOn:function(e){this._lockContentAreaVisibility();let t,i,n=e.idx,a=e.tag,s=e.thumbName,o=e.breadcrumbCC,r=o.getPathValues(),l=this._getActiveMainController();l&&("seq"===a?(l.activateSequence(n),l.resetExpectedSequence(),t=[{label:s,value:"cnt"}],i=1,this.lastSelectedThumbnailIdx=n):"cnt"===a&&(i=2,l.resetExpectedSequence(),l.activateDD(n),t=[{label:r[1].label,value:"cnt"}],e.subLabel&&(s+=" ( "+e.subLabel+" )"))),r[i].label=s,o.updatePathValues(r),o.updateBreadcrumb(t),this._unlockContentAreaVisibility(),this.isVerticalMobile?h.setPanelVisibility(!1):this._setContentAreaVisibility(!0)},_loadThumbnails:function(e,t,i){let n=this._getActiveMainController();this.loadThumbnails(e,t,n,i)},_loadThumbnailsFromPrimaryDico:function(e,t,i){let n=this._getActiveMainController();this.loadThumbnailsFromPrimaryDico(e,t,n,i)},_changeViewClickOn:function(e){this._lockContentAreaVisibility();let t=[],i=this._getActiveMainController(),n=i?i.getActiveDD():void 0,a=n.getSequence(),o=i.getSPM().getSequenceName(a);if("treeView"===e.comboItem){let e=this.treeDataModel(i.getSPM()),n=this.loadTreeViewModel(e);h.buildDatagridView(n,i.getActiveDD().name,o),this._isReport||this.createReport(),s.publish({event:this.ctx+"updateSelectedItem",data:{selectedItems:t}})}else i&&n&&t.push({label:o,value:"cnt"}),s.publish({event:this.ctx+"updateSelectedItem",data:{selectedItems:t}});this._unlockContentAreaVisibility(),this._setContentAreaVisibility(!0)},_treeViewSelection:function(e){this._activationFromHere=!0;let t=this._getActiveMainController();t.activateSequence(e.selectedSeq),t.resetExpectedSequence(),t.activateDD(e.selectedCnt);let i=e.treeViewBC.getPathValues();i[1].label=e.labelSeq,i[2].label=e.labelCnt,e.treeViewBC.updatePathValues(i),this.lastSelectedThumbnailIdx=e.selectedSeq,h.disableBreadCrumbItems()},_updateSeqPercentage:function(e){e&&(0==e.progress?h.setSeqState(e.streamId,h.getStates().NOT_LOADED,0):e.progress>0&&e.progress<100?h.setSeqState(e.streamId,h.getStates().LOADING,e.progress):100==e.progress?h.setSeqState(e.streamId,h.getStates().LOADED,100):(console.error("Wrong percentage value received from loader, disabling content "+e.streamId),h.setSeqState(e.streamId,h.getStates().NOT_LOADED,0)),h.updateGlobalProgress(e.globalProgress))},_updateContentPercentage:function(e){e&&(0==e.progress?h.setContentState(e.streamId,h.getStates().NOT_LOADED,0):e.progress>0&&e.progress<100?h.setContentState(e.streamId,h.getStates().LOADING,e.progress):100==e.progress?h.setContentState(e.streamId,h.getStates().LOADED,100):(console.error("Wrong percentage value received from loader, disabling content "+e.streamId),h.setContentState(e.streamId,h.getStates().NOT_LOADED,0)))},_updateContentState:function(e){this.contentProgressMap.set(e.streamId,e.progress),100==e.progress?h.setContentState(e.streamId,h.getStates().LOADED):0==e.progress&&h.setContentState(e.streamId,h.getStates().NOT_LOADED)},_onPrimaryDicoLoaded:function(){console.log("here"),this._getActiveMainController().getSPM().getPrimaryDico().analysisCases.forEach((e=>{e.contents.forEach((e=>{this.contentProgressMap.set(e.id,0)}))})),this._updateView()},_unsubscribeEvents:function(e){s.unsubscribe(this._thumbnailsLoadedCb),this._thumbnailsLoadedCb=void 0,s.unsubscribe(this._loadCb),this._loadCb=void 0,s.unsubscribe(this._loadDicoThumbnailsCb),this._loadDicoThumbnailsCb=void 0,s.unsubscribe(this._assetActivedCb),this._assetActivedCb=void 0,s.unsubscribe(this._assetDeactivedCb),this._assetDeactivedCb=void 0,s.unsubscribe(this._onThumbnailClickCb),this._onThumbnailClickCb=void 0,s.unsubscribe(this._onBreadCrumbClickCb),this._onBreadCrumbClickCb=void 0,s.unsubscribe(this._toggleContentCb),this._toggleContentCb=void 0,s.unsubscribe(this._changeViewClickCb),this._changeViewClickCb=void 0,s.unsubscribe(this._treeViewSelectCb),this._treeViewSelectCb=void 0,s.unsubscribe(this._viewerResizeCb),this._viewerResizeCb=void 0,s.unsubscribe(this._outsideActivationCb),this._outsideActivationCb=void 0,s.unsubscribe(this._updateSeqPercentageCb),this._updateSeqPercentageCb=void 0,s.unsubscribe(this._updateContentStateCb),this._updateContentStateCb=void 0,s.unsubscribe(this._primaryDicoLoadedCb),this._primaryDicoLoadedCb=void 0,this._eventsSubscribed=!1},_subscribeEvents:function(e){this._unsubscribeEvents(e),this._thumbnailsLoadedCb=s.subscribe({event:this.ctx+m},(()=>{h.updateContent(this.treedocModel),this._processingBC=!1})),this._loadCb=s.subscribe({event:this.ctx+"/SPY/ASSET/LOADINGCOMPLETE"},this._updateView.bind(this)),this._loadDicoThumbnailsCb=s.subscribe({event:this.ctx+"/SPY/LOADING/DICOTHUMBNAILSREADY"},this._onPrimaryDicoLoaded.bind(this)),this._assetActivedCb=s.subscribe({event:this.ctx+"/SPY/ASSET/ACTIVATED"},this._onDataDisplayActivation.bind(this)),this._assetDeactivedCb=s.subscribe({event:this.ctx+"/SPY/ASSET/DEACTIVATED"},this._updateView.bind(this)),this._onThumbnailClickCb=s.subscribe({event:this.ctx+"thumbnailClickOn"},this._thumbnailClickOn.bind(this)),this._onBreadCrumbClickCb=s.subscribe({event:this.ctx+"breadcrumbClickOn"},this._breadCrumbClickOn.bind(this)),this._toggleContentCb=s.subscribe({event:this.ctx+"toggleContentPart"},this._toggleContentPart.bind(this)),this._changeViewClickCb=s.subscribe({event:this.ctx+"changeViewClickOn"},this._changeViewClickOn.bind(this)),this._treeViewSelectCb=s.subscribe({event:this.ctx+"treeViewSelection"},this._treeViewSelection.bind(this)),this._viewerResizeCb=s.subscribe({event:this.ctx+"/SPY/VIEWERRESIZE"},this.handleResize.bind(this)),this._viewerResponsiveCb=s.subscribe({event:this.ctx+"/SPY/RESPONSIVE/VERTICALMOBILE"},this.handleResponsive.bind(this)),this._outsideActivationCb=s.subscribe({event:this.ctx+"/SPY/DATADISPLAY/ACTIVATED"},this._onDataDisplayActivation.bind(this)),this._updateSeqPercentageCb=s.subscribe({event:this.ctx+"/SPY/STREAMLOADING/PROGRESS"},this._updateSeqPercentage.bind(this)),this._updateContentStateCb=s.subscribe({event:this.ctx+"/SPY/DDLOADING/PROGRESS"},this._updateContentState.bind(this)),this._primaryDicoLoadedCb=s.subscribe({event:this.ctx+"SPY/PRIMARYDICO/LOADED"},this._onPrimaryDicoLoaded.bind(this)),this._eventsSubscribed=!0},buildView:function(e){this.spmUI=e.spmUI,this.ctx=e.ctx,this.isVerticalMobile=e.verticalMobile,this._contentAreaVisibility=!1,this.treedocModel=new d,this.immersiveFrame=e.immersiveFrame,this._isReport=!1,h.removeReport(),this._fullXP=e.fullXP,h.build(this.immersiveFrame,this.isVerticalMobile,this.ctx),this.handleResize(),this.contentProgressMap=new Map,this._subscribeEvents(this.ctx),this.isVerticalMobile&&this._updateView()},getView:function(){return h},destroy:function(){this._cleanView()},createReport:function(){var e=l.getReport();e&&(h.createReport(e),this._isReport=!0)},_cleanView:function(){this._unsubscribeEvents(this.ctx)},_updateView:function(){h.resetLeftIfNegative(),this._lockContentAreaVisibility();let t=this._getActiveMainController();if(t){let i,n=this._getActiveMainController().getSPM().getPrimaryDico(),a=t.getActiveSequence();if(-1==a&&n){let e,t=this.spmUI._spm.streamIds,s=this.spmUI._spm.getPreferredStreamId();null!=t&&null!=s&&(e=t.indexOf(s)),-1!==e&&void 0!==e||(e=n.getActiveSequence(),-1!==e&&void 0!==e||(e=this.spmUI._spm.getActiveSequence())),i=-1!==e?n.getSequenceName(e):"---",a=e}else i=-1!==a?t.getSPM().getSequenceName(a):"---";let o,r=t.getActiveDD();if(r)o=r.subName?r.name+" ( "+r.subName+" )":r.name;else if(n){let e=this.spmUI.getPreferredContentName();o=void 0!==e?e:-1!==a&&n.getActiveContentName(a)?n.getActiveContentName(a):"---"}else o="---";let l=[{label:e.homeItemBC,value:"seq"}];l.push({label:i,value:"cnt"}),l.push({label:o,value:"inf"}),s.publish({event:this.ctx+"itemsForBreadcrumb",data:{pathItems:l}}),this._restoreOnNextActivation&&(h.setPanelVisibility(!0),this._restoreOnNextActivation=void 0)}else this._restoreOnNextActivation=!0,h.setPanelVisibility(!1),s.publish({event:this.ctx+"chooseContentPanelHidden"});this._unlockContentAreaVisibility()},createThumbnails:function(e,t,i,n,a,s,o,r,l,c,h,d){let m=new u({id:h,label:e,name:e,subLabel:t,thumbnail:a,icons:n,color:i,description:s,emptyStatusbarVisibleFlag:!0,activeFlag:!1,value:[{id:o,tag:l}],statusbarIcons:r,customTooltip:c,loaded:d>0,disabled:"cnt"==l&&d<=0});this.treedocModel.addRoot(m),setTimeout(function(){}.bind(this),2e3)},loadSequenceData(n,a){let o=this._getActiveMainController(),r=o.getActiveSequence(),c=o.getSPM().getNbSequences(),h=g+"SPYUI/assets/I_SimNavCategory_R.png",d=0,u=()=>{d++,d==c&&s.publish({event:this.ctx+m})};n.sequences.forEach(((s,o)=>{if(s){let s="",g=n.sequences[o].persistentId;var c=n.getZipEntries(o);let p=n.getDataDisplayList(o);if(p&&p.length>0){var d,m=p[0].thumbnail;m&&(d=c.find(m));l._typingInfo;let v;if(o===r&&(s="#54A3DC"),this._fullXP){let e=n.getStreamAnalytics(o),a=Number(e.dataSize/1048576).toPrecision(4)+" MB",s=t.loadedStreamSizeLabel+" "+a;v=i.String.stripTags(s)}d?d.getBlob("image/PNG").then((t=>{this.createThumbnails(n.getSequenceName(o),"",s,[],URL.createObjectURL(t),e.contentNumberPrefix+n.getDataDisplayList(o).length.toString(),o,[],a,v,g,100),u()})):(this.createThumbnails(n.getSequenceName(o),"",s,[],h,e.contentNumberPrefix+n.getDataDisplayList(o).length.toString(),o,[],a,v,g,100),u())}}}))},loadSequenceDataWithPrimaryDico(n,a){let o=this._getActiveMainController(),r=o.getActiveSequence(),c=o.getSPM().getNbSequences(),h=g+"SPYUI/assets/I_SimNavCategory_R.png",d=0,u=n.getPrimaryDico(),p=()=>{d++,d==c&&s.publish({event:this.ctx+m})};u.analysisCases.forEach(((s,o)=>{if(s){let d="",u=n.getStreamId(o),m=this._getActiveMainController().getSPM().getPrimaryDico().getContents(o);if(m&&m.length>0){var c=m[0].thumbnail;l._typingInfo;let g;if(o===r&&(d="#54A3DC"),this._fullXP){let e=Number(n.getStreamSize(o)/1048576).toPrecision(4)+" MB",a=t.loadedStreamSizeLabel+" "+e;g=i.String.stripTags(a)}let v=n.getThumbnailBlob(o,c);v?(this.createThumbnails(s.name,"",d,[],URL.createObjectURL(v),e.contentNumberPrefix+m.length.toString(),o,[],a,g,u,Array.from(n.streamLoadingProgress.values())[o]),p()):(this.createThumbnails(s.name,"",d,[],h,e.contentNumberPrefix+m.length.toString(),o,[],a,g,u,Array.from(n.streamLoadingProgress.values())[o]),p())}}}))},loadContentFromSequence(e,t,i){var n=e.getDataDisplayList(t);if(n){for(var a=n.length,s=[],o=e.getZipEntries(t),r=0;r<a;r++){var l=n[r];if(l){var c={idx:r,name:l.name,subName:l.subName,thumbnail:l.thumbnail,category:l.category,animated:l.isAnimated(),activated:l.activated,nbCharts:l.getNumberOfCharts(),contentId:l.id,progress:100};s.push(c)}}this._loadThumbnails(s,o,i)}},loadContentFromSequenceWithPrimaryDico(e,t,i){let n=this._getActiveMainController().getSPM().getPrimaryDico().getContents(t),a=this._getActiveMainController().getSPM().getThumbnailBlobs(),s=a?.get(t)??null;if(n){for(var o=n.length,r=[],l=0;l<o;l++){var c=n[l];if(c){var h={idx:l,name:c.getName(),subName:c.getSubName(),thumbnail:c.getThumbnail(),category:c.getCategory(),animated:c.getIsAnimated(),activated:l==this._getActiveMainController().activatingDD||l==this._getActiveMainController().activeDD,nbCharts:c.getNumberOfCharts(),contentId:c.id,progress:c.progress};r.push(h)}}this._loadThumbnailsFromPrimaryDico(r,s,i)}},loadTreeModel:function(e,t){const i=this._getActiveMainController().getSPM().getPrimaryDico(),n=this._getActiveMainController();if("seq"===t)i?this.loadSequenceDataWithPrimaryDico(e,t):this.loadSequenceData(e,t);else if("cnt"===t)if(i){let a=null!=this.lastSelectedThumbnailIdx&&-1!=this.lastSelectedThumbnailIdx?this.lastSelectedThumbnailIdx:n.getActiveSequence();-1===a&&(a=i.getActiveSequence()),this.loadContentFromSequenceWithPrimaryDico(e,a,t)}else this.loadContentFromSequence(e,n.getActiveSequence(),t)},loadThumbnailsFromPrimaryDico:function(e,t,i,n){if(0===e.length)return void s.publish({event:this.ctx+m});var a=null,o=e.shift();let r=o.category,l=o.nbCharts;var c=o.animated,h=o.thumbnail;let d,u="";o.activated&&(u="#54A3DC"),h&&(a=t.get(h));let p=g+"SPYUI/assets/I_SimNavCategory_";switch(r){case"Model":d="wux-ui-3ds wux-ui-3ds-3dpart",p+="M";break;case"Scenario":d="wux-ui-3ds wux-ui-3ds-3dpart-simulation-scenario",p+="S";break;case"Result":d="wux-ui-3ds wux-ui-3ds-3dpart-play",p+="R"}p+=".png";var v=[];let S=[];S.push(d),0!==l&&v.push({label:l.toString(),icon:"chart-line-single",emphasize:"primary"}),c&&v.push({icon:"play wux-ui-3ds",emphasize:"primary"}),a?(this.createThumbnails(o.name,o.subName,u,S,URL.createObjectURL(a),"",o.idx,v,n,"",o.contentId,this.contentProgressMap.get(o.contentId)),this.loadThumbnailsFromPrimaryDico(e,t,i,n)):(this.createThumbnails(o.name,o.subName,u,S,p,"",o.idx,v,n,"",o.contentId,this.contentProgressMap.get(o.contentId)),this.loadThumbnailsFromPrimaryDico(e,t,i,n))},loadThumbnails:function(e,t,i,n){if(0===e.length)return void s.publish({event:this.ctx+m});var a=null,o=e.shift();let r=o.category,l=o.nbCharts;var c=o.animated,h=o.thumbnail;let d,u=o.activated,p="";u&&(p="#54A3DC"),h&&(a=t.find(h));let v=g+"SPYUI/assets/I_SimNavCategory_";switch(r){case"Model":d="wux-ui-3ds wux-ui-3ds-3dpart",v+="M";break;case"Scenario":d="wux-ui-3ds wux-ui-3ds-3dpart-simulation-scenario",v+="S";break;case"Result":d="wux-ui-3ds wux-ui-3ds-3dpart-play",v+="R"}v+=".png";var S=[];let f=[];f.push(d),0!==l&&S.push({label:l.toString(),icon:"chart-line-single",emphasize:"primary"}),c&&S.push({icon:"play wux-ui-3ds",emphasize:"primary"}),a?a.getBlob("image/PNG").then((a=>{this.createThumbnails(o.name,o.subName,p,f,URL.createObjectURL(a),"",o.idx,S,n,"",o.contentId,100),this.loadThumbnails(e,t,i,n)})):(this.createThumbnails(o.name,o.subName,p,f,v,"",o.idx,S,n,"",o.contentId,100),this.loadThumbnails(e,t,i,n))},treeDataModel:function(e){let t=[{Text:"Home",children:[]}],i=0;return e.sequences.forEach(((n,a)=>{if(n){t[0].children.push({Text:e.getSequenceName(a),children:[],idx:a});let n=e.getDataDisplayList(a);n&&n.forEach(((e,n)=>{e&&t[0].children[i].children.push({Text:e.name,categ:e.category,idx:n})})),i++}})),t},loadTreeViewModel:function(e){let t="";var i=new d;return i.prepareUpdate(),e.forEach((function(e){var n=new u({label:e.Text,grid:e});if(e.children)for(var a=0;a<e.children.length;a++){var s=new u({label:e.children[a].Text,grid:e.children[a]});n.addChild(s);for(var o=0;o<e.children[a].children.length;o++){switch(e.children[a].children[o].categ){case"Model":t="wux-ui-3ds wux-ui-3ds-3dpart";break;case"Scenario":t="wux-ui-3ds wux-ui-3ds-3dpart-simulation-scenario";break;case"Result":t="wux-ui-3ds wux-ui-3ds-3dpart-play"}var r=new u({label:e.children[a].children[o].Text,icons:[t],grid:e.children[a].children[o]});s.addChild(r)}}i.addRoot(n)})),i.expandAll(),i.pushUpdate(),i},handleResponsive:function(e){e&&(h.handleResponsive(e.verticalMobile),this.isVerticalMobile=e.verticalMobile,this._updateView())},handleResize:function(){let e=this.immersiveFrame,t=e?e.getFreeZone():void 0;t&&h.handleResize(t)}})})),define("DS/SPYUI/CATSimNavData3DAnimationViewUI",["UWA/Core","DS/Visualization/Node3D","DS/Visualization/PathElement","DS/SPYUI/CATSimNavData3DViewUI"],(function(e,t,i,n){"use strict";let a=n.extend({init:function(){this._parent()},build3D:function(e){if(!this.implementation||!e)return;this._overrideManager=e.overrideManager,e.existingNode?(this.node=e.existingNode,this.node.setName(this.implementation.getId())):this.node=new t(this.implementation.getId()),this.node.SPObj=this.implementation,this.node.productType="Reference3D";let i,n=this.implementation.visibility,a=this.implementation.isActive(),s=this.implementation.getDataDisplay().getSPM(),o=this.implementation.getDataDisplay().getSequence();isNaN(e.animationIndex)||(this.animationIndex=e.animationIndex);let r,l,c,h=this.implementation.getAllLoadingDescription(),d=h.Geometry,u=h.Texture,m=h.Instancing;isNaN(this.animationIndex)&&(
//! appropriate frame set needs to be use to determine frames number
u?this.animationIndex=u.files.length-1:m?this.animationIndex=m.files.length-1:d&&(this.animationIndex=d.files.length-1));let g=function(){let t=l;m&&m.files.length>0?require(["DS/SPYUI/LWInstancingVizExtension"],(i=>{this._instancingVizExtension=new i,this._instancingVizExtension.build3D({node:this.node.children[0],modelManager:s,loadDescription:m,sequenceIdx:o,postLoadingCallbackcallback:function(i,n){r=n,e.postLoadingCallback&&e.postLoadingCallback(this.animationIndex,t)}.bind(this)})})):e.postLoadingCallback&&e.postLoadingCallback(this.animationIndex,t)}.bind(this),p=function(){u&&u.files.length>0?require(["DS/SPYUI/LWTextureAnimationVizExtension"],(e=>{this._textureAnimationVizExtension=new e({id:this.implementation.getId()}),this._textureAnimationVizExtension.build3D({node:this.node,modelManager:s,loadDescription:u,sequenceIdx:o,postLoadingCallback:function(e,t){c=t,g()}})})):g()}.bind(this);if(d&&d.files.length>0){let t=this.animationIndex;1==d.files.length&&(u||m)&&(t=0),Array.isArray(d.matrices)&&(i=d.matrices[t]),s.loadFiles({type:"Geometry",initProgressFromCurrent:e.initProgressFromCurrent,filesList:[d.files[t]],framesIndices:[t],fatherNode:this.node,sequence:o,callback:function(e){l=e,1===this.node.children.length&&(i&&this.node.children[0].setMatrix(i),this.node.setVisibility(n&&a),this.node.children[0].setVisibility(!0)),p()}.bind(this),resetProgress:!1})}e.callback&&(e.callback.length>0?e.callback(this.node):e.callback())},initAnimation:function(e){this._textureAnimationVizExtension?this._textureAnimationVizExtension.initAnimation(e):this._instancingVizExtension?this._instancingVizExtension.initAnimation(e):e&&e()},getLoadingDescription:function(e){let t=this.implementation.getLoadingDescription(e);return t.Geometry.fatherNode=this.node,t.Texture&&(t.Texture.manager=this._textureAnimationVizExtension),t.Instancing&&(t.Instancing.manager=this._instancingVizExtension),t},animate:function(e){if(this.animationIndex=e,this._textureAnimationVizExtension||this._instancingVizExtension){let t=this.implementation.getGeometryFiles();Array.isArray(t)&&t.length>1?this._animateGeometry():this.node.children[0].setVisibility(!0),this._textureAnimationVizExtension?this._textureAnimationVizExtension.animate(e):this._instancingVizExtension&&this._instancingVizExtension.animate(e)}else this._animateGeometry()},_animateGeometry:function(){this.node.children.forEach((e=>{e.setVisibility(e._SPYFrameIndex===this.animationIndex)}))}});return e.namespace("DS/SPYUI/CATSimNavData3DAnimationViewUI",a)})),define("DS/SPYUI/CATSimNavData3DVirtualComponentUI",["DS/Visualization/Node3D","DS/SPYUI/CATSimNavData3DAnimationViewUI"],(function(e,t){"use strict";let i=t.extend({init:function(){},build3D:function(t){let i=this.getImpl();if(!i||!t)return;this._overrideManager=t.overrideManager,this.node=new e(this.implementation.getId()),this.node.setVisibility(!1),this.node.SPObj=this.implementation,isNaN(t.animationIndex)||(this.animationIndex=t.animationIndex);let n=i.getGeometryFrameSet();for(let t=0;t<n.getSize();t++){let a=n.getMatrix(t),s=new e;s.setMatrix(a),s.setVisibility(!1),this.node.addChild(s),i.setLoadingStatus(t,"loaded")}t.callback&&t.callback(),t.postLoadingCallback&&t.postLoadingCallback(this.animationIndex)}});return UWA.namespace("DS/SPYUI/CATSimNavData3DVirtualComponentUI",i)})),define("DS/SPYUI/CATSimNavDataFrameExtractableUI",["UWA/Core","DS/SPYUI/CATSimNavDataFrameViewCompUI","DS/Core/PointerEvents","DS/CoreEvents/Events","DS/Controls/Expander","DS/Controls/Button","DS/Controls/TooltipModel","DS/SMAMpwControls/SMAMpwPanel","i18n!DS/SPYUI/assets/nls/CATSimNavDataFrameExtractableUI"],(function(e,t,i,n,a,s,o,r,l){"use strict";return t.extend({init:function(){this._parent(),this.layout={}},onExpanderChange:function(){},onExtractableExpanderChange:function(e){var t=this.getImpl().getDataDisplay().getSPM();n.publish({event:t.getContext()+"/SPY/EXPANDABLEUI/CHANGE",data:{expandableId:this.getExtractedContentId(),expanded:e}})},buildExtractableContent:function(){},getExtractedContent:function(){},getExtractedContentId:function(){return"unidentified_content"},getExtractedContentTitle:function(){return"untitled_content"},getExtractedPanelId:function(){return(widget&&widget.id?widget.id+"_":"")+this.getExtractedContentId()+"_panel"},getExtractedPanelTitle:function(){return this.getExtractedContentTitle()},buildExtractableContainer:function(t,n,r){var c,h,d=this.getImpl().getDataDisplay().getSPM(),u=d&&d.window.SPMUI&&d.window.SPMUI.isExtractableUIallowed(),m=l.get("extractShortHelp");(h=new e.Element("div",{class:"wux-control-inline-container"})).setStyle("width","100%"),h.addEventListener(i.POINTERUP,(function(e){e.stopPropagation()})),h.addEventListener("click",(function(e){e.stopPropagation()}));var g=new s({domId:"idButton",label:"",emphasize:"secondary",icon:{iconName:"shortcut",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"1x"},displayStyle:"normal"}).inject(h);g.tooltipInfos=new o({shortHelp:m,mouseRelativePosition:!0}),g.addEventListener("buttonclick",function(e){e.stopPropagation(),this.extract()}.bind(this)),u||g.hide();var p=this.getLayoutPreferences().expanded,v=void 0!==p?p:r;return this._expander=new a({header:this.implementation.getName(),body:this.layout.extracted?void 0:t,allowUnsafeHTMLLabel:!0,customHeader:h,expandedFlag:v}).inject(n),this._expander.addEventListener("expand",function(){this.onExtractableExpanderChange(!0)}.bind(this)),this._expander.addEventListener("collapse",function(){this.onExtractableExpanderChange(!1)}.bind(this)),this.layout.extracted?this._expander.hide():this.getLayoutPreferences().extracted&&(c=this.extract()),c},extract:function(){var e=!1;if(this.layout&&!this.layout.extracted){var t=this.getImpl().getDataDisplay().getSPM(),i=.9,a=.9,s=this.getExtractedContent();this._widthBeforeExtract=s.clientWidth;var o=s.clientHeight>0?s.clientHeight:120;this.layout.panel=new r({identifier:this.getExtractedPanelId(),title:this.getExtractedPanelTitle(),content:s,width:s.clientWidth,height:o,immersiveFrame:t.window.getImmersiveFrame(),resizableFlag:!0,maximizeButtonFlag:!0}),this.layout.extracted=!0,this._expander.hide(),//!! we should probably unset the content as well
this.layout.panel.addEventListener("close",function(e){this.layout.panel=null,this.layout.extracted=!1,e.dsModel.content.inject(this._expander.elements.bodyContainer),this._expander.show(),this.buildExtractableContent(this._widthBeforeExtract,null,!0),n.publish({event:t.getContext()+"/SPY/EXTRACTABLEUI/CHANGE",data:{extractableId:this.getExtractedContentId(),extracted:!1,panelId:this.getExtractedPanelId()}})}.bind(this)),this.layout.panel.addEventListener("resize",function(e){var t=e.dsModel.getAvailableContentDimensions();this.buildExtractableContent(a*t.width,i*t.height,!0)}.bind(this)),this.layout.panel.addEventListener("placeChange",function(e){if(this.layout.extracted&&e.dsModel.maximizedFlag!==e.dsModel.maximized){var t=e.dsModel.getAvailableContentDimensions();this.buildExtractableContent(a*t.width,i*t.height,!0)}}.bind(this)),this.layout.panel.addEventListener("activate",function(e){if(e.dsModel.windowGroup){var t=e.dsModel.getAvailableContentDimensions();this.buildExtractableContent(a*t.width,i*t.height,!0)}}.bind(this));var l=this.layout.panel.getAvailableContentDimensions();this.buildExtractableContent(a*l.width,i*l.height,!0),e=!0,n.publish({event:t.getContext()+"/SPY/EXTRACTABLEUI/CHANGE",data:{extractableId:this.getExtractedContentId(),extracted:!0,panelId:this.getExtractedPanelId()}})}return e}})})),define("DS/SPYUI/CATSimNavDataFrameViewImageUI",["UWA/Core","DS/SPYUI/CATSimNavDataFrameExtractableUI","DS/Controls/TooltipModel","DS/SMAMpwControls/SMAMpwTooltipedImage"],(function(e,t,i,n){"use strict";var a=t.extend({init:function(){this._parent()},buildFrame:function(t,a,s){if(this.implementation){var o=new e.Element("table",{class:"spy-infopane-content-table"}),r=new e.Element("tr",{class:"spy-infopane-content-table-scalar"}).inject(o),l=new e.Element("td",{class:"spy-infopane-content-image-cell",styles:{"max-width":t?t.toString()+"px":"100%"}}).inject(r),c=[];if(c.push(this.implementation.getPNGList()[0]),c.length>0){var h=new i({shortHelp:this.implementation.getTooltip(),allowUnsafeHTMLLabel:!0}),d=this.implementation.getTitle();this._loadImage(c[0],function(e){this.image=new n({imageUrl:e,tooltipInfos:h,title:d}),this.buildExtractableContainer(this.image,l,a)}.bind(this))}return this.selectableWidget=o,s&&s(o),o}},_loadImage:function(e,t){var i=this.implementation.getDataDisplay();i&&i.spm.loadImage(i.seq,e,t)},getExtractedContentId:function(){var e=this.implementation,t=e.getTitle();return e.id?e.id:t},getExtractedContentTitle:function(){return this.implementation.getTitle()},buildExtractableContent:function(e,t,i){this.image},getExtractedContent:function(){return this.image}});return e.namespace("DS/SPYUI/CATSimNavDataFrameViewImageUI",a)})),define("DS/SPYUI/controllers/GuidanceManager",["UWA/Core","UWA/Class","DS/CoreEvents/Events","DS/SPYUI/GuidanceMsg","DS/SPYUI/ExtendedGuidanceMsg"],(function(e,t,i,n,a){"use strict";var s=t.singleton({_onViewerResize:function(e){this._currentExtMessage&&this._currentExtMessage.updateSizeResponsive(e)},setOptions:function(e){e.parentContainer&&(this._msgDico={},this._msgContainer=e.parentContainer),e.resizeEventId&&(this._resizeCallback=i.subscribe({event:e.resizeEventId},this._onViewerResize.bind(this))),this._initialLayoutId=e.layoutId},loadGuidanceFile:function(e,t){if(this._currentGuidanceFileName=e,this._msgDico)if(this._msgDico[e])t&&t();else{var i={};this._msgDico[e]=i,require(["text!DS/SPYUI/assets/xml/"+e+".xml"],(function(e){i.nlsModule="SPYUI";var n=(new DOMParser).parseFromString(e,"text/xml").firstChild;if("HelpMessage"===n.nodeName)for(var a=0;a<n.childNodes.length;a++){var s=n.childNodes[a];if("State"===s.nodeName){var o=s.getAttribute("name");i[o]={};for(var r=0;r<s.childNodes.length;r++){var l=s.childNodes[r],c={};if("Message"===l.nodeName)c.text=l.getAttribute("text"),c.image=l.getAttribute("image"),i[o].msg=c;else if("MessageExtended"===l.nodeName){c.content=[];for(var h=0;h<l.childNodes.length;h++){var d=l.childNodes[h],u={};"Content"===d.nodeName&&(u.text=d.getAttribute("text"),u.image=d.getAttribute("image"),c.content.push(u))}i[o].extMsg=c}}}}t&&t()}))}},displayMessage:function(e){if(this.hideMessage(),this._msgDico&&this._currentGuidanceFileName){var t=this._msgDico[this._currentGuidanceFileName];if(t){var i=t[e];this._currentExtMessage=new a({msgData:i.extMsg,nlsModule:t.nlsModule,nlsFile:this._currentGuidanceFileName,parentContainer:this._msgContainer}),this._initialLayoutId&&this._currentExtMessage.updateSizeResponsive(this._initialLayoutId),this._currentMessage=new n({msgData:i.msg,nlsModule:t.nlsModule,nlsFile:this._currentGuidanceFileName,parentContainer:this._msgContainer,extendedMsg:this._currentExtMessage})}}},hideMessage:function(){this._currentMessage&&(this._currentMessage.remove(),delete this._currentMessage),this._currentExtMessage&&(this._currentExtMessage.remove(),delete this._currentExtMessage)}});return e.namespace("DS/SPYUI/controllers/GuidanceManager",s)})),define("DS/SPYUI/commands/CATSPYSwitchCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/Core/Core","DS/CoreEvents/Events","DS/SPYUI/controllers/GuidanceManager","DS/SPYUI/controllers/SPYContext"],(function(e,t,i,n,a,s){"use strict";return t.extend({_preRequisites:function(e){this._spmUI=s.getCurrentController(),this._activeDD=this._spmUI?this._spmUI.getActiveDD():void 0,e&&e()},_postRequisites:function(){},_isInDefaultState:function(){},_filterItemsWithDefaultState:function(e,t,i){var n={totalCount:e.length},a=[],s=function(e,s){n.totalCount--,e===t&&a.push(s),0===n.totalCount&&i&&i(a)};e.forEach(function(e){this._isInDefaultState(e,s)}.bind(this))},_listAllOthersInDefaultState:function(e){var t=[],i=[];if(this._activeDD){i=(i=this._activeDD.getNavData2DViewList()).concat(this._activeDD.getNavData3DViewList());var n=[];i.forEach((function(e){"CATSimNavData3DExtremasRoot"!==e.type&&"CATSimNavData3DCamerasRoot"!==e.type&&"CATSimNavData2DLegend"!==e.type&&n.push({spObj:e})})),this._filterItemsWithDefaultState(n,!0,function(i){i.forEach(function(e){if(e.spObj.isActive()){var i,n,a=!1;n=e.spObj.getId();for(var s=0;s<this._listKeepOnly.length&&!a;s++){var o=this._listKeepOnly[s].spObj;o&&(i=o.getId()),a=i===n}a||t.push({spObj:e.spObj})}}.bind(this));var n={totalCount:t.length},a=function(){e&&e(t)};if(0===t.length)a();else{t.forEach((function(e){var t;e.spObj.QI("CATISimNavDataSpecUI",(t=e,function(e){e&&(t.node=e.node),n.totalCount--,0===n.totalCount&&a()}))}))}}.bind(this))}},_switch:function(e,t){t&&t()},_setContextualBarLabels:function(e,t){var i=e.getContent().querySelector("div.wux-afr-view");if(i){var n=t?"wux-afr-state-nolabels":"wux-afr-state-labels",a=t?"wux-afr-state-labels":"wux-afr-state-nolabels";i.removeClassName(n),i.addClassName(a)}},_onViewerResize:function(){let e=s.getFrameWindow();if(e){var t=e.getContent().getDimensions(),i=e.getContextualUIManager();if(i){var n="small"===this._spmUI.getLayoutId(),a=i.getContextualBar();if(a){var o=t.width-(n?50:100),r=t.height/2-(n?80:130);a.setPosition({x:o,y:r}),this._setContextualBarLabels(a,!n)}}}},init:function(e,t){this._parent(e,t)},beginExecute:function(){n.publish({event:this._ctx+"/SPY/SWITCH_CMD_STARTED"}),this._spmUI=s.getCurrentController();let e=s.getFrameWindow(),t=this.getHelpMessageContent();e&&t&&(a.setOptions({parentContainer:e.getUIFrame(),resizeEventId:this._ctx+"/SPY/VIEWERRESIZE",layoutId:this._spmUI.getLayoutId()}),a.loadGuidanceFile(t.xmlFilename,(function(){a.displayMessage(t.stateName)})));var o=e.getContent().getDimensions(),r=this.getContextualBarDefinition();if(r){var l=e.getContextualUIManager();if(void 0!==l){var c="small"===this._spmUI.getLayoutId(),h={fillingList:[r,{subscriberId:"SPY_DUM_Ctx",workbenchName:"BasicSimulationPlayer",module:"3DPlayBasicSimulation",cmdPrefix:"",fileName:"BasicSimulationPlayer.xml",onContextualBarReady:function(){var e=l.getContextualBar();if(e){this._hideToRestore=e.hide,this._showToRestore=e.show,e.hide=function(){},e.show=function(){};for(var t=e.getContent().querySelectorAll("div.wux-afr-cmdstarter"),i=0;i<t.length;i++)t[i].style.display="block";this._setContextualBarLabels(e,!c);var n=e.getContent().querySelector("div.wux-afr-cmdContainer");n&&(n.style.height="auto")}return{}}.bind(this)}],hideWithDistance:!1,x:o.width-(c?50:100),y:o.height/2+(c?40:140)};l.activateContextualBarOnLeftClicAfterCSOChange(),l.showContextualBar(h),this._resizeCallback=n.subscribe({event:this._ctx+"/SPY/VIEWERRESIZE"},this._onViewerResize.bind(this))}}this._viewer=e.getViewer(),this._CSOcb=i.Selection.CSOManager.onAdd(this.elementAdded.bind(this)),this.elementAdded();var d=function(e,t,i){this._keepOnlyMode=e,this._listKeepOnly=[],i&&this._keepOnlyCmd&&this._keepOnlyCmd.setState(!1),this._keepOnlyCmd=t}.bind(this);this._keepOnCallback=n.subscribe({event:this._ctx+"/SPY/SELECTION/KEEPONLY_ON"},(function(e){d(!0,e)})),this._keepOffCallback=n.subscribe({event:this._ctx+"/SPY/SELECTION/KEEPONLY_OFF"},(function(e){d(!1,e)})),this._keepStopCallback=n.subscribe({event:this._ctx+"/SPY/SELECTION/KEEPONLY_STOP"},(function(){d(!1,void 0,!0)}))},elementAdded:function(){this._preRequisites(function(){for(var e=i.Selection.CSOManager.get(),t=[],n=0;n<e.length;n++){var a=null,s=null;this._currentFatherNode=null;for(var o=e[n].pathElement||e[n].options.pathElement,r=o.getLength()-1;!a&&r>0;)o.getElement(r--).SPObj&&(this._currentFatherNode=o.getElement(r),a=o.getElement(r+1),s=o.getElement(r+1).SPObj);s&&a&&(this._keepOnlyMode?this._listKeepOnly.push({spObj:s,node:a}):t.push({spObj:s,node:a}))}this._keepOnlyMode?this._filterItemsWithDefaultState(this._listKeepOnly,!1,function(e){this._switch(e,function(){this._listAllOthersInDefaultState(function(e){this._switch(e,this._postRequisites.bind(this))}.bind(this))}.bind(this))}.bind(this)):this._switch(t,this._postRequisites.bind(this))}.bind(this))},endExecute:function(){i.Selection.CSOManager.unsubscribe(this._CSOcb),a.hideMessage();let e=s.getFrameWindow().getContextualUIManager();e&&this._hideToRestore&&this._showToRestore&&(e.getContextualBar().show=this._showToRestore,e.getContextualBar().hide=this._hideToRestore,e.getContextualBar().hide()),this._keepOnlyCmd&&this._keepOnlyCmd.setState(!1),this._listKeepOnly=[],n.publish({event:this._ctx+"/SPY/SWITCH_CMD_ENDED"}),n.unsubscribe(this._keepOnCallback),n.unsubscribe(this._keepOffCallback),n.unsubscribe(this._keepStopCallback),n.unsubscribe(this._resizeCallback)},getHelpMessageContent:function(){},getContextualBarDefinition:function(){}})})),define("DS/SPYUI/commands/CATSPYTranspCmd",["UWA/Core","DS/SPYUI/commands/CATSPYSwitchCmd","DS/Core/Core","DS/SPYUI/controllers/SPYContext","text!DS/SPYUI/assets/json/SIM_TransparencySwitchToolbar.json"],(function(e,t,i,n,a){"use strict";return t.extend({_preRequisites:function(e){this._spmUI=n.getCurrentController(),this._pos=this._spmUI?this._spmUI.getAnimationFrameIndex():void 0,this._activeDD=this._spmUI?this._spmUI.getActiveDD():void 0,this._activeDD&&(this._ddShadingManager?e&&e():this._activeDD.QI("CATISimNavDataColorShadingManager",function(t){this._ddShadingManager=t,e&&e()}.bind(this)))},_postRequisites:function(){this._viewer&&this._viewer.render()},_applyTransparencyOnNodeUI:function(e,t){e&&e.applyTransparency(t)},_isInDefaultState:function(e,t){e&&e.spObj&&t&&t(!e.spObj.transparent,e)},_switch:function(e,t){var i={totalCount:e.length},n=function(){t&&t()};0===e.length&&n();var a=function(){i.totalCount--,0===i.totalCount&&n()};e.forEach(function(e){e.spObj.transparent=!e.spObj.transparent,e.spObj.QI("CATISimNavDataSpecUI",function(e){this._applyTransparencyOnNodeUI(e,a)}.bind(this))}.bind(this))},init:function(e){this._parent(e,{isAsynchronous:!0,mode:"exclusive"})},getHelpMessageContent:function(){return{xmlFilename:"CATSimNavSwitchHelpMessagesWeb",stateName:"Transparency"}},getContextualBarDefinition:function(){return{subscriberId:"SPY_Transp_Ctx",workbenchName:"FullSimulationPlayer",module:"3DPlayFullSimulation",cmdPrefix:"",fileName:"FullSimulationPlayer.xml",onContextualBarReady:function(){return JSON.parse(a)}}}})})),define("DS/SPYUI/commands/CATSPYRHESwitchCmd",["UWA/Core","DS/SPYUI/commands/CATSPYSwitchCmd","DS/Core/Core","text!DS/SPYUI/assets/json/SIM_RHESwitchToolbar.json"],(function(e,t,i,n){"use strict";return t.extend({_preRequisites:function(e){this._parent(),this._pos=this._spmUI?this._spmUI.getAnimationFrameIndex():void 0,this._activeDD&&(this._ddShadingManager?e&&e():this._activeDD.QI("CATISimNavDataColorShadingManager",function(t){this._ddShadingManager=t,e&&e()}.bind(this)))},_postRequisites:function(){this._viewer.render()},_processReplacementObj:function(e,t){if(e&&this._spmUI&&this._activeDD&&!isNaN(this._pos)){var i=this._activeDD.getSPM();i&&(e.build3D({animationIndex:this._pos,overrideManager:this._spmUI.getOverrideManager(),postLoadingCallback:function(){this._currentFatherNode.addChild(e.node),e.applyTransparency(),isNaN(this._pos)||(
//!! the buil3D of replacing item would load for last stored anim frameIndex
e.getImpl().setLoadingStatus(this._pos,"loaded"),t&&t())}.bind(this)}),i.processLoadFiles())}},_processRenderingMaterialToggle:function(e,t){e&&(e.hasRenderingMaterial()&&(e.isRenderingMaterialApplied()?e.removeRenderingMaterial():e.applyRenderingMaterial()),t&&t())},_isInDefaultState:function(e,t){e&&e.spObj&&t&&(this._ddShadingManager.supportsShading()?e.spObj.QI("CATISimNavDataColorShading",(function(i){t(i.isShadingActive(),e)})):e.spObj.getSibling()?t(e.spObj.isActive()&&e.spObj.supportedModes.search("ENG")>=0,e):e.spObj.supportedModes.search("ENG")>=0&&e.spObj.supportedModes.search("REA")>=0&&e.spObj.QI("CATISimNavDataSpecUI",(function(i){t(!i.isRenderingMaterialApplied(),e)})))},_switch:function(e,t){var i={totalCount:e.length},n=function(){t&&t()};0===e.length&&n();var a=function(){i.totalCount--,0===i.totalCount&&n()};e.forEach(function(e){if(this._ddShadingManager.supportsShading())this._ddShadingManager.toggleElementShading(e.spObj),a();else{var t=e.spObj.getSibling();t?(e.spObj.setActive(!1),e.spObj.setLoadingStatus&&!isNaN(this._pos)&&e.spObj.setLoadingStatus(this._pos,"notLoaded"),e.spObj.QI("CATISimNavDataSpecUI",function(e){e&&this._currentFatherNode.remove(e.node)}.bind(this)),t.setActive(!0),t.transparent=e.spObj.transparent,t.QI("CATISimNavDataSpecUI",function(e){this._processReplacementObj(e,a)}.bind(this))):e.spObj.supportedModes&&e.spObj.supportedModes.search("ENG")>=0&&e.spObj.supportedModes.search("REA")>=0&&e.spObj.QI("CATISimNavDataSpecUI",function(e){this._processRenderingMaterialToggle(e,a)}.bind(this))}}.bind(this))},init:function(e){this._parent(e,{isAsynchronous:!0,mode:"exclusive"})},getHelpMessageContent:function(){return{xmlFilename:"CATSimNavSwitchHelpMessagesWeb",stateName:"Material"}},getContextualBarDefinition:function(){return{subscriberId:"SPY_RHE_Ctx",workbenchName:"FullSimulationPlayer",module:"3DPlayFullSimulation",cmdPrefix:"",fileName:"FullSimulationPlayer.xml",onContextualBarReady:function(){return JSON.parse(n)}}},endExecute:function(){this._parent(),this._ddShadingManager=void 0,this._spmUI=void 0,this._pos=void 0,this._activeDD=void 0}})})),define("DS/SPYUI/commands/CATSPYHideShowCmd",["UWA/Core","DS/SPYUI/commands/CATSPYSwitchCmd","DS/Core/Core","DS/CoreEvents/Events","DS/SPYUI/controllers/SPYContext","text!DS/SPYUI/assets/json/SIM_HideShowToolbar.json","text!DS/SPYUI/assets/json/SIM_HideShow_withStreamlines_Toolbar.json"],(function(e,t,i,n,a,s,o){"use strict";return t.extend({_postRequisites:function(){i.Selection.CSOManager.empty(),i.Selection.HSOManager.empty(),this._viewer.render(),this._spmUI.updateExtrema()},_isInDefaultState:function(e,t){e&&e.spObj&&t&&t(e.spObj.visibility,e)},_switch:function(e,t){var i=this._ctx;e.forEach((function(e){e.spObj&&e.spObj.switchVisibility(!0,i)})),t&&t()},_updateLegendDisplayForStreams:function(e){var t=this._spmUI.getActiveDD().getLegend();if(t){var i=this._spmUI.frameStreamlines,n=this._spmUI.frame2D;if(e||(this._legendDisplayedBeforeStreams=t.visibility),t.visibility!==e){var a=n.clientHeight+n.offsetTop,s=i.firstElementChild.offsetTop;(e||s<a)&&(t.visibility=e,this._spmUI.setLegendFrameVisibility(t.visibility))}}},init:function(e){this._parent(e,{isAsynchronous:!0,mode:"exclusive"})},getHelpMessageContent:function(){return{xmlFilename:"CATSimNavSwitchHelpMessagesWeb",stateName:this._streamFlag?"HideShow_withStreamlines":"HideShow"}},getContextualBarDefinition:function(){var e=this._streamFlag;return{subscriberId:"SPY_HS_Ctx",workbenchName:"BasicSimulationPlayer",module:"3DPlayBasicSimulation",cmdPrefix:"",fileName:"BasicSimulationPlayer.xml",onContextualBarReady:function(){return JSON.parse(e?o:s)}}},beginExecute:function(){if(this._spmUI=a.getCurrentController(),this._streamFlag=null!==this._spmUI.frameStreamlines,this._spmUI&&this._streamFlag){this._streamsMgrShowCb=n.subscribe({event:this._ctx+"/SPY/STREAMLINESMGR/SHOW"},function(){this._updateLegendDisplayForStreams(!1)}.bind(this)),this._streamsMgrHideCb=n.subscribe({event:this._ctx+"/SPY/STREAMLINESMGR/HIDE"},function(){this._updateLegendDisplayForStreams(this._legendDisplayedBeforeStreams)}.bind(this));var e=this._spmUI.streamsManager;e&&e.startSync()}this._parent(),this._viewer.setPicking({displayHL:!1})},endExecute:function(){this._parent();let e=this._spmUI.streamsManager;e&&e.stopSync();let t=a.getCommandsManager().getCommandCheckHeader("CATSPYStreamlinesCmdHdr",this._ctx);t&&t.setState(!1),this._viewer.setPicking({displayHL:!0}),n.unsubscribe(this._streamsMgrShowCb),n.unsubscribe(this._streamsMgrHideCb)}})})),define("DS/SPYUI/controllers/CATSimNavDataSyncManager",["css!DS/SPYUI/controllers/CATSimNavDataSyncManager.css","UWA/Core","UWA/Utils","UWA/Utils/InterCom","DS/PlatformAPI/PlatformAPI","DS/CoreEvents/Events","DS/Visualization/ThreeJS_DS","DS/SPYUI/controllers/ViewpointHelper"],(function(e,t,i,n,a,s,o,r){"use strict";var l="CATSimNav.ContentChanged",c="CATSimNav.ViewpointChanged",h="CATSimNav.Probing",d="CATSimNav.AnimationPlay",u="CATSimNav.AnimationClear",m="CATSimNav.AnimationFrameChanged",g="CATSimNav.FrameNavigation",p="CATSimNav.SyncSubscribe",v="CATSimNav.SyncListUpdate",S="CATSimNav.InstanceDispose",f="CATSimNav.LegendMinEdited",_="CATSimNav.LegendMaxEdited",b="CATSimNav.LegendDataRequest",C="CATSimNav.LegendDataResponse",D=t.Class.extend({_isSyncDomainOn:function(e){var t=!1;for(var i in this.syncWith)this.syncWith[i][e]&&(t=!0);return t},_isContentSyncOn:function(){return this._isSyncDomain("content")},_isViewSyncOn:function(){return this._isSyncDomainOn("viewchange")},_isFrameNavSyncOn:function(){return this._isSyncDomainOn("framenav")},_isLegendSyncOn:function(){return this._isSyncDomainOn("legendminmax")},_syncSubscribe:function(e,t){if(this._syncSocket&&t.origin.tabId===this._syncSocket.tabId){if(e.id===this._syncOptions.widgetId);else{e.title!==this._syncOptions.widgetTitle||e.refreshing||(0===e.nbDuplicate?(0===this.duplicateTitleId&&(this.duplicateTitleId=1,this._syncOptions.newDuplicateCallback(this.duplicateTitleId)),this.nbDuplicateTitle+=1,e.duplicateTitleId=this.nbDuplicateTitle+1):0===this.nbDuplicateTitle&&(this.nbDuplicateTitle=e.nbDuplicate,this.duplicateTitleId=e.nbDuplicate+1,this._syncOptions.newDuplicateCallback(this.duplicateTitleId)));var i,n=!1,a=this.allOtherSync.length;for(i=0;i<a;i++)if(this.allOtherSync[i].id===e.id){if(e.title===this.allOtherSync[i].title&&this.allOtherSync[i].duplicateTitleId===e.duplicateTitleId)return;this.allOtherSync[i]=e,n=!0}n||this.allOtherSync.push(e)}this._syncOptions.newConnectionCallback&&this._syncOptions.newConnectionCallback(e),e.id!==this._syncOptions.widgetId&&this._syncSocket.dispatchEvent(p,{id:this._syncOptions.widgetId,title:this._syncOptions.widgetTitle,duplicateTitleId:this.duplicateTitleId,nbDuplicate:this.nbDuplicateTitle,refreshing:e.refreshing,syncOn:this._syncOn})}},_syncListUpdate:function(e,t){this._syncSocket&&t.origin.tabId===this._syncSocket.tabId&&this._syncOptions&&this._syncOptions.updateSyncListCallback&&this._syncOptions.updateSyncListCallback(e)},_viewpointChange:function(){if(this._syncSocket&&this._viewerToSync&&this._viewpoint){var e=this._viewpoint;if(e&&e.getControl()&&!e._SPYsyncInProgress){var t={};r.extractViewpoint(e,t,!0,this._checkCamera),this._syncSocket.dispatchEvent(c,t)}}},_probingDetection:function(e){if(this._syncSocket&&this._viewerToSync&&"object"==typeof e&&e.position2D&&!isNaN(e.position2D.x)&&!isNaN(e.position2D.y)){var t={position2D:{x:e.position2D.x.toString(),y:e.position2D.y.toString()}};this._syncSocket.dispatchEvent(h,t)}},_playCmd:function(e){if(this._syncSocket){var t=parseInt(e.position),i=parseInt(e.totalNumberOfFrames);if(!isNaN(t)&&!isNaN(i)){var n={position:t.toString(),totalNumberOfFrames:i.toString(),totalComputedFramesNumber:parseInt(e.totalComputedFramesNumber).toString()};this._syncSocket.dispatchEvent(d,n),this._dispatchClearOnDispose=!0}}},_startLegendSync:function(e){this._syncSocket&&this._legendMinMaxRequestCallback&&this._legendMinMaxResponseCallback&&e&&!this._integratingLegend&&(this._integratingLegend=!0,this._integratingLegendDataList=[],this._syncSocket.dispatchEvent(b))},init:function(e){this._parent(),this._syncOptions=e,this._syncOn=!1,this.allOtherSync=[],this.syncWith=[],this.duplicateTitleId=0,this.nbDuplicateTitle=0,e&&e.server&&("PubSub"===e.server?this._syncSocket={id:"pubSubPseudoSocket_"+i.getUUID(),widgetId:e.widgetId,tabId:e.tabId,_subs:[],dispatchEvent:function(e,t){var i=t||{};i&&(i._SPYsyncPseudoSocketID=this.id,i._SPYsyncWidgetID=this.widgetId,i._SPYsyncTabID=this.tabId),a.publish(e,i)},addListener:function(e,t){this._subs[e]=a.subscribe(e,(function(i){if(t){var n={event:e,origin:{server:"PubSub",socket:i._SPYsyncPseudoSocketID,widgetId:i._SPYsyncWidgetID,tabId:i._SPYsyncTabID}};t(i,n)}}))},removeListener:function(e){this._subs[e]&&a.unsubscribe(this._subs[e])}}:(this._syncSocket=new n.Socket,this._syncSocket.subscribeServer(e.server,window.__karma__?window:window.parent)),this._initServer=e.server,e.interactive||this.startSync())},destroy:function(){this._parent(),this._syncSocket.removeListener(p),this._syncSocket.removeListener(v),this._syncSocket.removeListener(S),this._syncSocket.removeListener(f),this._syncSocket.removeListener(_),this._syncSocket.removeListener(b),this._syncSocket.removeListener(C),delete this._syncSocket,this._syncSocket=void 0},resetComponentsToSync:function(){s.unsubscribe(this._contentSelectionCallback),this._contentSelectionCallback=void 0,this._viewpoint&&this._viewpoint.unsubscribe(this._viewpointChangeCallback),this._viewpointChangeCallback=void 0,s.unsubscribe(this._probingDetectionCallback),this._probingDetectionCallback=void 0,s.unsubscribe(this._instanceDisposeCallback),this._instanceDisposeCallback=void 0,s.unsubscribe(this._playCmdCallback),this._playCmdCallback=void 0,s.unsubscribe(this._clearCmdCallback),this._clearCmdCallback=void 0,s.unsubscribe(this._frameChgCallback),this._frameChgCallback=void 0,s.unsubscribe(this._frameSelectionCallback),this._frameSelectionCallback=void 0,s.unsubscribe(this._lgdMinEditCallback),this._lgdMinEditCallback=void 0,s.unsubscribe(this._lgdMaxEditCallback),this._lgdMaxEditCallback=void 0,this._contentChangeEvent=void 0,this._contentChangeEventTransfo=void 0,this._contentChangeCallback=void 0,this._viewerToSync=void 0,this._probingEvent=void 0,this._probingCallback=void 0,this._infoToggleEvent=void 0,this._infoToggleCallback=void 0,this._navFrameEvent=void 0,this._navFrameCallback=void 0,this._animPlayEvent=void 0,this._animPlayCallback=void 0,this._animClearEvent=void 0,this._animClearCallback=void 0,this._animFrameChangedEvent=void 0,this._animFrameChangedCallback=void 0,this._legendMinEvent=void 0,this._legendMinMaxRequestCallback=void 0,this._legendMinMaxResponseCallback=void 0,this._legendMinEditedCallback=void 0,this._legendMaxEvent=void 0,this._legendMaxEditedCallback=void 0},addComponentsToSync:function(e){if(e&&(e.content&&(this._contentChangeEvent=e.content.event?e.content.event:this._contentChangeEvent,this._contentChangeEventTransfo=e.content.eventDataBuild?e.content.eventDataBuild:this._contentChangeEventTransfo,this._contentChangeCallback=e.content.callback?e.content.callback:this._contentChangeCallback),e.viewpoint&&(this._viewerToSync=e.viewpoint.viewer?e.viewpoint.viewer:this._viewerToSync,this._checkCamera=e.viewpoint.cameraCheck,this._viewpoint=this._viewerToSync.getViewpoints()[0]),e.probing&&(this._probingEvent=e.probing.event?e.probing.event:this._probingEvent,this._probingCallback=e.probing.callback?e.probing.callback:this._probingCallback),e.instanceDispose&&(this._instanceDisposeEvent=e.instanceDispose.event?e.instanceDispose.event:this._instanceDisposeEvent),e.frameNavigation&&(this._navFrameEvent=e.frameNavigation.event?e.frameNavigation.event:this._navFrameEvent,this._navFrameCallback=e.frameNavigation.callback?e.frameNavigation.callback:this._navFrameCallback),e.animation&&(this._animPlayEvent=e.animation.play.event?e.animation.play.event:this._animPlayEvent,this._animPlayCallback=e.animation.play.callback?e.animation.play.callback:this._animPlayCallback,this._animClearEvent=e.animation.clear.event?e.animation.clear.event:this._animClearEvent,this._animClearCallback=e.animation.clear.callback?e.animation.clear.callback:this._animClearCallback,this._animFrameChangedEvent=e.animation.frameChanged.event?e.animation.frameChanged.event:this._animFrameChangedEvent,this._animFrameChangedCallback=e.animation.frameChanged.callback?e.animation.frameChanged.callback:this._animFrameChangedCallback),e.legendMinMaxRequest&&(this._legendMinMaxRequestCallback=e.legendMinMaxRequest.callback?e.legendMinMaxRequest.callback:this._legendMinMaxRequestCallback),e.legendMinMaxResponse&&(this._legendMinMaxResponseCallback=e.legendMinMaxResponse.callback?e.legendMinMaxResponse.callback:this._legendMinMaxResponseCallback),e.legendMinEdited&&(this._legendMinEvent=e.legendMinEdited.event?e.legendMinEdited.event:this._legendMinEvent,this._legendMinEditedCallback=e.legendMinEdited.callback?e.legendMinEdited.callback:this._legendMinEditedCallback),e.legendMaxEdited&&(this._legendMaxEvent=e.legendMaxEdited.event?e.legendMaxEdited.event:this._legendMaxEvent,this._legendMaxEditedCallback=e.legendMaxEdited.callback?e.legendMaxEdited.callback:this._legendMaxEditedCallback)),this._viewerToSync||this._playerToSync||this._navFrameEvent||this._navFrameCallback||this._animPlayEvent||this._animPlayCallback||this._legendMaxEvent||this._legendMinEvent){if(this._container&&(this._container.style.display="block"),this._legendMinEvent&&this._legendMinEditedCallback&&(this._syncSocket.removeListener(f),this._syncSocket.addListener(f,this.onLegendMinEdited.bind(this))),this._legendMaxEvent&&this._legendMaxEditedCallback&&(this._syncSocket.removeListener(_),this._syncSocket.addListener(_,this.onLegendMaxEdited.bind(this))),this._legendMinMaxRequestCallback&&this._legendMinMaxResponseCallback&&(this._syncSocket.removeListener(b),this._syncSocket.removeListener(C),this._syncSocket.addListener(b,this.onLegendMinMaxRequest.bind(this)),this._syncSocket.addListener(C,this.onLegendMinMaxResponse.bind(this))),this._syncOptions.widgetId){var t=this._syncOptions;this._syncSocket.dispatchEvent(p,{id:t.widgetId,title:t.widgetTitle,duplicateTitleId:this.duplicateTitleId,nbDuplicate:this.nbDuplicateTitle,refreshing:!!this._syncOptions.isRefreshing&&this._syncOptions.isRefreshing()}),this._syncSocket.addListener(p,this._syncSubscribe.bind(this)),this._syncSocket.addListener(S,function(e,t){if(t&&t.event===S&&t.origin.server===this._initServer&&(this._syncOptions.removeConnectionCallback&&this._syncOptions.removeConnectionCallback(t.origin.widgetId),this.allOtherSync.length>0))for(var i=this.allOtherSync.length-1;i>=0;i--)this.allOtherSync[i].id===t.origin.widgetId&&this.allOtherSync.splice(i,1)}.bind(this)),this._syncSocket.addListener(v,this._syncListUpdate.bind(this)),this._syncSocket.addListener(g,this.onNavigateToFrame.bind(this))}this._instanceDisposeEvent&&this._syncSocket&&(s.unsubscribe(this._instanceDisposeCallback),this._instanceDisposeCallback=s.subscribe({event:this._instanceDisposeEvent},function(){this._dispatchClearOnDispose&&this._syncSocket.dispatchEvent(u),this._syncSocket.dispatchEvent(S)}.bind(this))),this._contentChangeEvent&&this._syncSocket&&(s.unsubscribe(this._contentSelectionCallback),this._contentSelectionCallback=s.subscribe({event:this._contentChangeEvent},function(e){if("object"==typeof e&&this._contentChangeEventTransfo){var t=this._contentChangeEventTransfo(e);t&&this._syncSocket.dispatchEvent(l,t)}}.bind(this))),this._viewerToSync&&this._syncSocket&&this._viewpoint&&(this._viewpoint.unsubscribe(this._viewpointChangeCallback),this._viewpointChangeCallback=this._viewpoint.onMove(this._viewpointChange.bind(this))),this._probingEvent&&this._syncSocket&&(s.unsubscribe(this._probingDetectionCallback),this._probingDetectionCallback=s.subscribe({event:this._probingEvent},this._probingDetection.bind(this))),this._animPlayEvent&&this._syncSocket&&(s.unsubscribe(this._playCmdCallback),this._playCmdCallback=s.subscribe({event:this._animPlayEvent},this._playCmd.bind(this))),this._animClearEvent&&this._syncSocket&&(s.unsubscribe(this._clearCmdCallback),this._clearCmdCallback=s.subscribe({event:this._animClearEvent},function(){this._syncSocket.dispatchEvent(u),this._dispatchClearOnDispose=!1}.bind(this))),this._animFrameChangedEvent&&this._syncSocket&&(s.unsubscribe(this._frameChgCallback),this._frameChgCallback=s.subscribe({event:this._animFrameChangedEvent},function(e){if("object"==typeof e&&!isNaN(e.position)&&!isNaN(e.totalNumberOfFrames)&&"boolean"==typeof e.forward){var t={position:e.position.toString(),totalNumberOfFrames:e.totalNumberOfFrames.toString(),totalComputedFramesNumber:e.totalComputedFramesNumber,forward:e.forward?"true":"false"};this._syncSocket.dispatchEvent(m,t)}}.bind(this))),this._navFrameEvent&&this._navFrameCallback&&(s.unsubscribe(this._frameSelectionCallback),this._frameSelectionCallback=s.subscribe({event:this._navFrameEvent},function(e){if(!isNaN(e)){var t={frame:e.toString()};this._syncSocket.dispatchEvent(g,t)}}.bind(this))),this._legendMinEvent&&this._legendMinEditedCallback&&(s.unsubscribe(this._lgdMinEditCallback),this._lgdMinEditCallback=s.subscribe({event:this._legendMinEvent},function(e){e.syncFlag&&(e.syncList=this.syncWith,this._syncSocket.dispatchEvent(f,e))}.bind(this))),this._legendMaxEvent&&this._legendMaxEditedCallback&&(s.unsubscribe(this._lgdMaxEditCallback),this._lgdMaxEditCallback=s.subscribe({event:this._legendMaxEvent},function(e){e.syncFlag&&this._syncOn&&(e.syncList=this.syncWith,this._syncSocket.dispatchEvent(_,e))}.bind(this))),this.isSyncOn()&&this.startSync()}else this._container&&(this._container.style.display="none")},_updateViewpoint:function(e){if("object"==typeof e.cameraPosition&&"object"==typeof e.cameraTarget&&"object"==typeof e.cameraUp&&this._viewerToSync){var t=this._viewerToSync.getViewpoints();if(t.length>0){var i=t[0];this._checkCamera&&i[this._checkCamera]!==e.cameraCheckValue||(i._SPYsyncInProgress=!0,r.updateViewpoint(i,e,!0),i._SPYsyncInProgress=void 0)}}},onContentChanged:function(e,t){this._syncOn&&t&&t.event===l&&t.origin.server===this._initServer&&this.testSourceId(t.origin,"content")&&this._contentChangeCallback(e)},onViewpointChanged:function(e,t){this._syncOn&&t&&t.event===c&&t.origin.server===this._initServer&&(this.testSourceId(t.origin,"viewchange")?"object"==typeof e&&this._updateViewpoint(e):this._syncSocket.widgetId&&t.origin!==this._syncSocket.widgetId&&(this._lastViewpointEvent={data:e,info:t}))},onProbing:function(e,t){var i;this._syncOn&&!this._synchingAnimation&&t.origin&&(t&&t.event===h&&t.origin.server===this._initServer&&this.testSourceId(t.origin,"viewchange")&&(e.position2D&&(i=new o.Vector2(parseInt(e.position2D.x),parseInt(e.position2D.y))),/*!isNaN(x) && !isNaN(y) && */this._probingCallback&&i&&this._probingCallback(i)))},onNavigateToFrame:function(e,t){var i;t&&t.event===g&&t.origin.server===this._initServer&&(this._syncSocket.tabId===t.origin.tabId&&(i=parseInt(e.frame),this._lastFrameNav=i),this._syncOn&&this.testSourceId(t.origin,"framenav")&&!isNaN(i)&&this._navFrameCallback&&this._navFrameCallback(i))},onPlay:function(e,t){if(t&&t.event===d&&t.origin.server===this._initServer&&this.testSourceId(t.origin,"animation")&&this._animPlayCallback){var i=parseInt(e.position),n=parseInt(e.totalNumberOfFrames),a=parseInt(e.totalComputedFramesNumber);isNaN(i)||isNaN(n)||(this._animPlayCallback({position:i,totalNumberOfFrames:n,totalComputedFramesNumber:a}),this._synchingAnimation=!0)}},onClear:function(e,t){t&&t.event===u&&t.origin.server===this._initServer&&this.testSourceId(t.origin,"animation")&&this._animClearCallback&&(this._animClearCallback(),this._synchingAnimation=!1)},onFrameChanged:function(e,t){if(t&&t.event===m&&t.origin.server===this._initServer&&this.testSourceId(t.origin,"animation")&&this._animFrameChangedCallback){var i=parseInt(e.position),n=parseInt(e.totalNumberOfFrames),a=e.totalComputedFramesNumber?parseInt(e.totalComputedFramesNumber):1;if(!isNaN(i)&&!isNaN(n)){!this._synchingAnimation&&this._animPlayCallback&&(this._animPlayCallback({position:i,totalNumberOfFrames:n,totalComputedFramesNumber:a}),this._synchingAnimation=!0);var s="true"===e.forward;this._animFrameChangedCallback({position:i,totalFrames:n,forward:s,totalComputedFramesNumber:a})}}},onLegendMinMaxRequest:function(e,t){if(t&&t.event===b&&t.origin.server===this._initServer&&(this.testSourceId(t.origin,"legendminmax")||this.testTabId(t.origin))&&this._legendMinMaxRequestCallback&&this._syncOn){this._integratingLegend=!0,this._integratingLegendDataList=[];var i=this._legendMinMaxRequestCallback();i.targetId=t.origin.socket,this._syncSocket.dispatchEvent(C,i)}},onLegendMinMaxResponse:function(e,t){t&&t.event===C&&t.origin.server===this._initServer&&(this.testSourceId(t.origin,"legendminmax")||this.testTabId(t.origin))&&this._legendMinMaxResponseCallback&&e.targetId===this._syncSocket.id&&(this._integratingLegendDataList.push(e),this._legendMinMaxResponseCallback(this._integratingLegendDataList))},onLegendMinEdited:function(e,t){t&&t.event===f&&t.origin.server===this._initServer&&(this.testSourceId(t.origin,"legendminmax")||this.testTabId(t.origin))&&this._legendMinEditedCallback&&this._syncOn&&(this._integratingLegend=!1,this._legendMinEditedCallback(e))},onLegendMaxEdited:function(e,t){t&&t.event===_&&t.origin.server===this._initServer&&(this.testSourceId(t.origin,"legendminmax")||this.testTabId(t.origin))&&this._legendMaxEditedCallback&&this._syncOn&&(this._integratingLegend=!1,this._legendMaxEditedCallback(e))},startSync:function(e,t){this._syncOn=!0,e?this.updateSyncList(e,t,!0):void 0===this._syncOptions.widgetId&&this._startLegendSync(!0),this._synchingAnimation=!1,this._dispatchClearOnDispose=!1,this._contentChangeEvent&&this._syncSocket&&(this._syncSocket.removeListener(l),this._syncSocket.addListener(l,this.onContentChanged.bind(this))),this._viewerToSync&&this._syncSocket&&(this._syncSocket.removeListener(c),this._syncSocket.addListener(c,this.onViewpointChanged.bind(this))),this._probingEvent&&this._syncSocket&&(this._syncSocket.removeListener(h),this._syncSocket.addListener(h,this.onProbing.bind(this))),this._animPlayEvent&&this._syncSocket&&(this._syncSocket.removeListener(d),this._syncSocket.addListener(d,this.onPlay.bind(this))),this._animClearEvent&&this._syncSocket&&(this._syncSocket.removeListener(u),this._syncSocket.addListener(u,this.onClear.bind(this))),this._animFrameChangedEvent&&this._syncSocket&&(this._syncSocket.removeListener(m),this._syncSocket.addListener(m,this.onFrameChanged.bind(this))),this._navFrameEvent&&this._navFrameCallback&&(this._syncSocket.removeListener(g),this._syncSocket.addListener(g,this.onNavigateToFrame.bind(this)),!isNaN(this._lastFrameNav)&&this._navFrameCallback&&this._isFrameNavSyncOn()&&this._navFrameCallback(this._lastFrameNav))},stopSync:function(){this._syncOn=!1,this._syncSocket.removeListener(c),this._syncSocket.removeListener(h),this._syncSocket.removeListener(d),this._syncSocket.removeListener(u),this._syncSocket.removeListener(m),this._syncSocket.removeListener(g),this._integratingLegend=!1,this._synchingAnimation&&this._animClearCallback&&this._animClearCallback()},isLegendSyncOn:function(){return this._isLegendSyncOn()},isSyncOn:function(){return this._syncOn},attachSyncButton:function(e){this.detachSyncButton(),this._container&&e&&(this._container.inject(e),this._containerParent=e)},detachSyncButton:function(){this._containerParent&&this._containerParent.removeChild&&this._container&&this._container.getParent()===this._containerParent&&this._containerParent.removeChild(this._container)},updateSyncList:function(e,t,i){var n=this._isViewSyncOn(),a=this._isFrameNavSyncOn(),s=this._isLegendSyncOn();this.syncWith=e;var o=this._isViewSyncOn(),r=this._isFrameNavSyncOn(),l=this._isLegendSyncOn();o&&!n&&this._lastViewpointEvent&&this.onViewpointChanged(this._lastViewpointEvent.data,this._lastViewpointEvent.info),r&&!a&&!isNaN(this._lastFrameNav)&&this._navFrameCallback&&this._navFrameCallback(this._lastFrameNav),t&&this._syncSocket.dispatchEvent(v,{id:this._syncOptions.widgetId,list:e}),(this._syncOn&&l&&!s||i&&l)&&this._startLegendSync(!0),s&&!l&&(this._integratingLegend=!1)},testSourceId:function(e,t){var i=!1;if("object"==typeof e)if(this._syncSocket.widgetId){if(this._syncSocket.widgetId!==e.widgetId&&this._syncSocket.tabId===e.tabId){var n=this._syncOptions.widgetPrefix+e.widgetId;i=void 0!==this.syncWith[n]&&this.syncWith[n][t]}}else i=e.socket!==this._syncSocket.id;return i},testTabId:function(e,t){var i=!1;if("object"==typeof e&&this._syncSocket.tabId&&this._syncSocket.tabId===e.tabId&&this._syncSocket.widgetId!==e.widgetId){var n=this._syncOptions.widgetPrefix+this._syncOptions.widgetId;i=void 0!==this.syncWith[n]&&this.syncWith[n][t]}return i}});return t.namespace("DS/SPYUI/controllers/CATSimNavDataSyncManager",D)})),define("DS/SPYUI/controllers/SimulationPlayerUI",["css!DS/SPYUI/controllers/SimulationPlayerUI.css","UWA/Core","DS/Core/Core","DS/CoreEvents/Events","DS/ApplicationFrame/CommandsManager","DS/Panels/PanelBase","DS/Panels/SidePanel","DS/WebSystem/Nls","DS/Visualization/Node3D","DS/Visualization/ThreeJS_DS","DS/Visualization/WorldOrientation","DS/Visualization/PathElement","DS/SMAMpwManagers/SMAMpwMatOverrideManager","DS/SMAMpwManagers/SMAMpwResultProbingManager","DS/SMAMpwPDSFX/SMAMpwShaderFactory","DS/SPYVisuTools/SPYTexturesProcessor","DS/SPYUI/CATSimNavDataMaxiPlayer","DS/SPYUI/CATSimNavDataSpeedControl","DS/SPYUI/controllers/ViewpointHelper","DS/SPYUI/controllers/CATSimNavDataSyncManager","DS/SPYUI/CATSimNavDataWatermark","DS/SPYUI/CATSimNavDataDisclaimer","DS/SPYUI/controllers/CATSimNavDataOverlaysManager","DS/SPYUI/controllers/CATSimNavDataCameraSelector","DS/SPYUI/controllers/SessionStateManager","DS/SPYUI/controllers/SPYContext","DS/SPYUtils/TrackingManager","DS/SPYUI/controllers/ChooseContentController","DS/WebSystem/SessionManager"],(function(e,t,i,n,a,s,o,r,l,c,h,d,u,m,g,p,v,S,f,_,b,C,D,x,y,I,P,E,w){"use strict";var A=function(e){e&&(n.unsubscribe(e),e=void 0)};const M=window.devicePixelRatio,T={w:640*M,h:480*M},N={w:1024*M,h:768*M},U={w:480*M,h:280*M},F="/SPY/CAMERA/SELECTED",L="/SPY/CAMERA/CHANGED";let R=a;return t.Class.extend({_setCmdsAvailability:function(e){for(let t in this._commandWrappers){let i=this._commandWrappers[t],n=R.getCommandCheckHeader(i,this.cmdCtx);n||(n=R.getCommand(i,this.cmdCtx)),n&&(e?n.enable():n.disable())}},_getCmdWrapper:function(e,t){let i=t;this._commandWrappers&&this._commandWrappers[e]&&(i=this._commandWrappers[e]);let n=R.getCommand(i,this.cmdCtx);return n||(n=R.getCommandCheckHeader(i,this.cmdCtx)),n},_getAnimateCmdHdr:function(){return this._getCmdWrapper("animate","CATSPYAnimateCmdHdr")},_getChooseContentCmdHder:function(){return this._getCmdWrapper("chooseContent","CATSPYMSRAccessCmdHdr")},_getRightSidePanelCmdHdr:function(){return this._getCmdWrapper("rightSidePanel","RightSidePanel")},_update2DComponents:function(){var e=this.isActive()?this._spm.getDisclaimer():"";if(this.disclaimer?this.disclaimer.setText(e):e&&e.length>0&&(this.disclaimer=new C({text:e,parentContainer:this.window.getUIFrame()})),this.frame2D){var t=this.getActiveDD(),i=t?t.getLegend():void 0;if(i){var n=this.frame2D.clientWidth,a=this.getViewer().divCss3DElement.clientWidth;(this._no3Dflag||a<2*n)&&(i.visibility=!1);var s=this.getExperience();s&&s.isDefaultExperience&&s.isDefaultExperience()&&(i.visibility=!1);var o=i.visibility&&this.isActive();this.setLegendFrameVisibility(o)}}},_updateMAB:function(){let e=this.getExperience();if(e){let t=null!==e.frmWindow.getContent().querySelector(".MabEnhancement")&&e.tabletMabModel?e.tabletMabModel:e.mabModel;t&&e.updateMAB(t)}},_onViewerResize:function(){var e=this.window.getViewerFrame().getDimensions();this._layoutId="large",(e.width<N.w||e.height<N.h)&&(this._layoutId="medium"),(e.width<T.w||e.height<T.h)&&(this._layoutId="small"),this.reducedPlayer=e.height<U.h||e.width<U.w,n.publish({event:this.getContext()+"/SPY/VIEWERRESIZE",data:this._layoutId})},_responsiveCheckAndPublish:function(){let e=this.isVerticalMobileLayout();e!==this._verticalMobile&&(this._verticalMobile=e,n.publish({event:this.getContext()+"/SPY/RESPONSIVE/VERTICALMOBILE",data:{verticalMobile:e}}))},_animateSingleCamera:function(e){let t=this._spm.getDataDisplayList(this.activeSequence)[this.activatingDD];if(t){const i=t.getCameraRoot();if(i){1===i.getListCamera().length&&i.QI("CATISimNavDataAnimation",(t=>{t.animate(void 0,{forceUpdateCamera:e}),this._disableAutoReframe=!0}))}}},_stopProbing:function(){this.probingMgr&&this.probingMgr.isProbingActive()&&this.probingMgr.stopProbing()},_startProbing:function(){if(this.probingMgr){this.probingMgr.stopProbing();let e=this.getActiveDD();if(e){let t=e.getGroupInfo(e.isAnimated()?this.animationFrameIdx:0),i={idFilter:this.getSimulationId()};if(i.labels=e.getLegend()?e.getLegend().labels:void 0,i.unit=e.getLegend()?e.getLegend().getUnit():void 0,!i.labels)if("NEUTRAL"===e.getRetexturingMode(this.animationFrameIdx))i.textureMin=t.localMin,i.textureMax=t.localMax;else i.textureMin=t.groupMin,i.textureMax=t.groupMax;let n=this.getSPM().getTextureLoader();if(n){let e=2/3,t=0;n.setRangeColors({minHue:e,minValue:i.textureMin,maxHue:t,maxValue:i.textureMax}),i.textureFSProbingOptions={textureImageDataMap:{},texturePathFilter:e=>e.SPObj&&e.SPObj.hasATextureFrameSet,computeProbingValue:e=>(e.frameIdx=this.animationFrameIdx,n.getValueFromPickingInfo(e))}}this._uvTransformFound&&(i.uvTransformDetected=!0,i.testNodeForUVTransform=e=>e.SPObj&&e.SPObj.hasEngMaterialWithUVTransform,i.getUVTransform=e=>e.SPObj.uvTransform),this.probingMgr.startProbing(i)}}},_removeExtractedWindows:function(){var e=this.window?this.window.getImmersiveFrame():void 0;if(e&&e.windows)for(var t in e.windows){var i=e.windows[t];i&&"SMAMpwPanel"===i.type&&e.windows[t].close()}},_updateSidePanel:function(e){I.setCurrentContent(e),n.publish({event:this.getContext()+"/SPY/VRFACET/CONTENTCHANGED"})},_createProbe:function(e){return this.probesManager?this.probesManager.createProbe(e):void 0},_registerContextualBar:function(){var e=this.window;if(e){var t=this.ctx;require(["text!DS/SPYUI/assets/json/MSR_CtxBar.json"],(function(i){e.getContextualUIManager().register({subscriberId:"MSR_CTX_BAR",workbenchName:"BasicSimulationPlayer",module:"3DPlayBasicSimulation",context:t,cmdPrefix:"",merge:!0,onContextualBarReady:function(e){var t,n={cmdList:[]};if(e&&(t=e,(e=Array.isArray(t)?t[0]:t)&&e.pathElement)){for(var a,s=e.pathElement,o=s.getLength()-1;!a&&o>0;)a=s.getElement(o--).SPObj;a&&(n=JSON.parse(i))}return n}})}))}},_unregisterContextualBar:function(){var e=this.window;e&&e.getContextualUIManager().unregister("MSR_CTX_BAR")},init:function(e){this._id=e.id,this._active=void 0===e.active||e.active,this._commandWrappers=e.commandWrappers,this._parentNode=e.parentNode,this._disableReframe=e.disableReframe,this._assetLoaded=!1,this._openSidePanel=!1,!0===e.openSidePanel&&(this._openSidePanel=!0,this.sidePanelCurrentState=!0),this._roleForFullFound=!1;if(require(["DS/PADUtils/PADUtilsServices"],function(e){e.getGrantedRoles((t=>{if(this._roleForFullFound=!1,Array.isArray(t)){let i=t.filter((e=>e&&("SEI"===e.id||"InternalDS"===e.id)));if(i.length>0){let t=e.getPlatformId(),n=i.filter((e=>e&&e.platforms.indexOf(t)>-1));this._roleForFullFound=n.length>0}}}))}.bind(this),(function(){console.warn("SPYUI: PADUtilsServices not found")})),this._spm=e.spm,this.window=e.window,R=e.commandsManager?e.commandsManager:R,this.ctx=e.context?e.context:"ctxUndefined",this.device=e.device?e.device:"deviceUndefined",this._forcePlay=e.forcePlay,this.onClean=e.onClean,this.envOCA=e.envOCA,this.publishPCSEvent=e.publishPCSEvent,this.updateStats=e.updateStats,this.probesManager=e.probesManager,this._timeToContentInteractionProbe=this._createProbe("MsrEcTimeToContentInteraction"),this._timeToContentInteractionProbe&&(this._timeToContentInteractionProbe.begin(),n.subscribeOnce({event:this.getContext()+"itemsForBreadcrumb"},(e=>{this._timeToContentInteractionProbe.end()}))),this._timeTo3DInteractionProbe=this._createProbe("MsrEcTimeTo3DInteraction"),this._timeTo3DInteractionProbe&&(this._timeTo3DInteractionProbe.begin(),n.subscribeOnce({event:this.getContext()+"/SPY/VISULOADING/FINISHED"},(e=>{this._timeTo3DInteractionProbe.end()}))),this.activeSequence=-1,this.activeDD=-1,this.activatingDD=-1,this._allowExtractableUI=!e||!e.allowExtractableUI||e.allowExtractableUI,this._camerasPanel=null,this.frame2D=null,this.frameStreamlines=null,this._cameraSelector=null,this._scrollers=[],this.running=!1,this._speedFactor=1,this.window&&this._active&&(this.window.SPMUI=this),this.buildTreeView(),this.infoPaneExpandStatus=!1,this.xcrosshighlightActive=!1,this.cmdCtx="SPYDEFAULTCTX_",this.window&&(this.cmdCtx=this.window.experience?this.window.experience.args.ctx:this.window.options.context),I.setAppContext(this.ctx),this._active&&I.setCurrentController(this),I.setCommandsManager(R),I.setFrameWindow(this.window),this.syncOptions=void 0,(r=this.getExperience())&&r.args.options){var t=r.args.options.simNavSyncServer;t&&(this.syncOptions={simNavSyncDomain:{legend:!0,viewpoint:!0,frameNavigation:!0,animation:!0,content:t.forceContentSync}},"object"==typeof t?(Object.assign(this.syncOptions,t),"object"==typeof t.simNavSyncDomain&&Object.assign(this.syncOptions.simNavSyncDomain,t.simNavSyncDomain)):(console.warn(" deprecated PSR argument format: please use an object for simNavSyncServer"),this.syncOptions.server=t,this.syncOptions.interactive=r.args.options.simNavSyncInteractive))}this.allowReframeOnContentChanged=!0,e&&void 0!==e.reframeOnContentChange?this.allowReframeOnContentChanged=e.reframeOnContentChange:r&&r.args.options&&void 0!==r.args.options.simNavNoReframe&&(this.allowReframeOnContentChanged=!r.args.options.simNavNoReframe),this._progressInitCb=n.subscribe({event:this.getContext()+"/SPY/PROGRESS/INIT"},function(e){if(r&&r.progress){this.previousProgressPosition=e.fromPreviousValue&&r.progress.state.visible?parseInt(r.progress.state.value):0;var t=e&&!isNaN(e.value)&&!isNaN(e.total)?Math.round(this.previousProgressPosition+e.value*(100-this.previousProgressPosition)/e.total):this.previousProgressPosition;r.progress.visible(),r.progress._SPYBeingHiden=!1,r.progress.updateProgression(t),r.progress.spinnerContainer.style.overflow="visible"}}.bind(this)),this._progressEndCb=n.subscribe({event:this.getContext()+"/SPY/PROGRESS/END"},function(e){var t=this.getExperience();t&&t.progress&&(t.progress.hide(),t.progress._SPYBeingHiden=!0,e&&(isNaN(e.value)||t.progress.updateProgression(e.value)))}.bind(this)),this._progressUpdateCb=n.subscribe({event:this.getContext()+"/SPY/PROGRESS/UPDATE"},function(e){var t=this.getExperience();t&&t.progress&&(t.progress._SPYBeingHiden||t.progress.visible(),t.progress.updateProgression(Math.round(this.previousProgressPosition+e.value*(100-this.previousProgressPosition)/e.total)))}.bind(this)),this._VRFacetBuildDoneCb=n.subscribe({event:I.getAppContext()+"/SPY/VRFACET/PHYSICS_SIMULATION_FACET_FRAME_BUILT"},this._setTabsListeners.bind(this)),this._getLegendMinMaxCb=n.subscribe({event:"SPY_LEGEND_GETMINMAX"},this._SetSessionStateManagerLegenMinMax.bind(this)),this._restore3DCommentBarStateCb=n.subscribe({event:this.getContext()+"/SPY/SWITCH_CMD_ENDED"},this._Restore3DCommentBarState.bind(this));var i=this.getViewer();if(i){i.setOIT(!0),this._resizeCb=i.onViewerResize(this._onViewerResize.bind(this)),this._onViewerResize();var a="/WUX/AFR/CMD/"+this.ctx+"/DMUSectionInEditModeHdr";this._sectionBeginCb=n.subscribe({event:a+"/BEGIN"},function(){this._previousPrePickingSetup={activated:i.pPicking.activated,displayHL:i.pPicking.displayHL},i.setPrePicking({activated:!0,displayHL:!0})}.bind(this)),this._sectionEndCb=n.subscribe({event:a+"/END"},function(){this._previousPrePickingSetup&&i.setPrePicking(this._previousPrePickingSetup)}.bind(this))}g&&g.registerOnPDSFXMaterial();let s=this.getActionBar();var o,r;s&&s.onWidthChange&&s.onWidthChange(this._responsiveCheckAndPublish.bind(this)),this._fullscreenDisableCb=n.subscribe({event:"3DPLAY/FULLSCREEN/DISABLE"},(()=>{setTimeout((()=>{this._responsiveCheckAndPublish()}),1e3)})),this._loopMode="loopRC",this._playCount=0,(r=this.getExperience())&&r.args.options&&r.args.options.simNavStoredSetup&&(this._previousSetup=r.args.options.simNavStoredSetup.setup,o=r.args.options.simNavStoredSetup.save,this._expectedSequence=void 0,this._previousSetup&&this._previousSetup.content&&(this._expectedSequence={id:this._previousSetup.content.sequencePersistentId,name:this._previousSetup.content.sequenceName}));var l=function(e){var t=this.getViewer();if(t){var i=t.getViewpoints()[0];f.extractViewpoint(i,e)}}.bind(this),c=function(e,t){if(t){var i=t.getCameraRoot();i&&(e.cameraId=i.getCurrentCamera().getId())}},h=function(e,t,i){if(t){let n=t.getGroupForFrame(i);n.group&&(e.groupId=n.group.id,e.groupIdNoMode=n.group.idNoMode,e.unit=n.group.unit),n.frame&&(e.framePosition=n.frame.position)}e.frameIdx=i},d=function(e,t){Array.isArray(t)&&t.forEach((function(t){var i=t.getId();e[i]&&(t.setExpandPreference&&t.setExpandPreference(e[i].expanded),t.setExtractPreference&&t.setExtractPreference(e[i].extracted)),t.getChildren&&d(e,t.getChildren())}))},u=function(e,t){n.publish({event:this.getContext()+"/SPY/REVIEWCONTEXT/"+e+"CHANGED",data:t})}.bind(this),m=function(e,t){n.publish({event:this.getContext()+"/SPY/REVIEWCONTENT/"+e+"CHANGED",data:t})}.bind(this),p={persistency:o,contentActivated:{eventId:this.getContext()+"/SPY/DATADISPLAY/ACTIVATED",isSameContent:function(e,t){return e&&e.content&&e.content.getImpl().id===t.contentId},onExtract:function(e,t,i,n,a,s,o,r){var d=e&&e.content?e.content.implementation:this.getActiveDD();t.contentId=d.id,t.contentName=d.name,t.sequenceOrder=d.getSequence(),t.sequencePersistentId=this._spm.getSequencePersistentId(t.sequenceOrder),t.sequenceName=this._spm.getSequenceName(t.sequenceOrder),c(i,d);var u=this.getAnimationFrameIndex();isNaN(u)||h(n,d,u);var m=d.isPartialAnimationMode();void 0!==m&&(a.partialMode=m);var g=d.getLegend();if(g){var p=g.getUserMax();isNaN(p)||(s.userMax={value:p,unit:g.getUnit()});var v=g.getUserMin();isNaN(v)||(s.userMin={value:v,unit:g.getUnit()})}l(o),r.state=this.getSidePanelState()}.bind(this),onPostExtract:function(e){var t=e&&e.content?e.content.implementation:this.getActiveDD();u("CONTENT",t)}.bind(this),onRestore:function(e,t,i,n){this.restoreDD(e,t,i,n)}.bind(this)},cameraActivated:{eventId:this.getContext()+F,onExtract:function(e,t){var i=this.getActiveDD();c(t,i)}.bind(this),onRestore:function(e,t,i){e&&e.cameraId?this.activateCamera(e.cameraId,t,i):t&&t()}.bind(this)},timeSelected:{eventId:this.getContext()+"/SPY/FRAME/NAVIGATED",onExtract:function(e,t){var i=this.getActiveDD(),n=this.getAnimationFrameIndex();h(t,i,n)}.bind(this),onPostExtract:function(){u("FRAME")},onRestore:function(e,t){e&&!isNaN(e.frameIdx)?this.navigateToFrame(e.frameIdx+1,t):t()}.bind(this)},playExit:{eventId:this.getContext()+"/SPY/ANIM/CLEAR",onExtract:function(e,t){var i=this.getActiveDD(),n=this.getAnimationFrameIndex();h(t,i,n)}.bind(this)},animationScopeChanged:{eventId:this.getContext()+"/SPY/ANIMSCOPECHANGE",onExtract:function(e,t){var i=this.getActiveDD();t.lockStatus=i.isPartialAnimationMode()}.bind(this),onPostExtract:function(){m("ANIMSCOPE")},onRestore:function(e,t){this._restoreAnimScope(e.lockStatus),t&&t()}.bind(this)},userMinChanged:{eventId:this.getContext()+"/SPY/LEGEND/EDIT/USERMIN",onExtract:function(e,t){e&&!isNaN(e.value)&&(t.userMin={value:e.value,unit:e.unit})},onPostExtract:function(){m("LEGEND/EDIT/USERMIN")},onRestore:function(e,t,i){this._restoreUserBound({type:"min",value:e.value,unit:e.unit},t,i)}.bind(this)},userMaxChanged:{eventId:this.getContext()+"/SPY/LEGEND/EDIT/USERMAX",onExtract:function(e,t){e&&!isNaN(e.value)&&(t.userMax={value:e.value,unit:e.unit})},onPostExtract:function(){m("LEGEND/EDIT/USERMAX")},onRestore:function(e,t,i){this._restoreUserBound({type:"max",value:e.value,unit:e.unit},t,i)}.bind(this)},viewpointChanged:{viewpoint:this.getViewer().getViewpoints()[0],onExtract:l,onRestore:function(e,t){var i=this.getViewer().getViewpoints()[0];setTimeout((function(){f.updateViewpoint(i,e),t&&t()}),500)}.bind(this)},sidePanelToggle:{eventId:this.getContext()+"/SPY/SIDEPANEL/TOGGLE",onExtract:function(e,t){t.state=this.getSidePanelState(),this.sidePanelCurrentState=this.getSidePanelState()}.bind(this),onPostExtract:function(){m("SIDEPANEL/TOGGLE")},onRestore:function(e,t){this.setSidePanelState(e.state),t&&t()}.bind(this)},panelsPreferencesChanged:{eventId:"/SMAMpw/Panel/LocalSave",onExtract:function(e,t){var i=e.panelId,n=JSON.parse(localStorage.getItem("wux-windows-window"));t[i]=n[i]}.bind(this),onRestore:function(e,t){var i=JSON.parse(localStorage.getItem("wux-windows-window"));i||(i={});var n=Object.assign(i,e);localStorage.setItem("wux-windows-window",JSON.stringify(n)),t&&t()}.bind(this)},expandableUIChanged:{eventId:this.getContext()+"/SPY/EXPANDABLEUI/CHANGE",onExtract:function(e,t){t[e.expandableId]={expanded:e.expanded}}.bind(this),onPostExtract:function(){m("EXPANDABLEUI")},onRestore:function(e,t,i){var n=this._spm.findSimilarContent({persistentId:e.sequencePersistentId,sequenceName:e.sequenceName,dataDisplayId:e.contentId,dataDisplayName:e.contentName,allowNameComparison:this.isLoadingComplete()});if(n&&n.found){var a=this._spm.getDataDisplayList(n.sequenceIndex)[n.dataDisplayIndex];if(a){var s=a.getNavDataFrameViewList();d(t,s)}}i&&i()}.bind(this)},extractableUIChanged:{eventId:this.getContext()+"/SPY/EXTRACTABLEUI/CHANGE",onExtract:function(e,t){t[e.extractableId]={extracted:e.extracted}}.bind(this),onPostExtract:function(){m("EXTRACTABLEUI")},onRestore:function(e,t,i){var n=this._spm.findSimilarContent({persistentId:e.sequencePersistentId,sequenceName:e.sequenceName,dataDisplayId:e.contentId,dataDisplayName:e.contentName,allowNameComparison:this.isLoadingComplete()});if(n&&n.found){var a=this._spm.getDataDisplayList(n.sequenceIndex)[n.dataDisplayIndex];if(a){var s=a.getNavDataFrameViewList();d(t,s)}}i&&i()}.bind(this)}};e&&e.captureHidden3DElements&&(p.visibilityChanged={eventId:this.getContext()+"/SPY/VISIBILITY/CHANGE",onExtract:function(e,t){
//!! however, the array should be initialized from default visibility
if(e&&Array.isArray(t)){var i=e.getId(),n=e.getVisibility(),a=t.indexOf(i);n?t.splice(a,1):a<0&&t.push(i)}}.bind(this),onPostExtract:function(){m("HIDDEN3DELEMENTS")},onRestore:function(e,t,i){let n=this.getActiveDD();if(n){let i=n.getNavData3DViewList();Array.isArray(i)&&(Array.isArray(e)&&e.length>0?i.forEach((function(t){!t.getVisibility()!==e.includes(t.getId())&&t.switchVisibility()})):t&&i.forEach((function(e){e.getVisibility()||e.switchVisibility()})))}i&&i()}.bind(this)}),y.initialize(p),w.register(y.MSRShareAs3DComment),e&&e.contextualBar&&this._registerContextualBar(),this._verticalMobile=this.isVerticalMobileLayout(),E.buildView({spmUI:this,ctx:this.getContext(),immersiveFrame:this.window?this.window.getImmersiveFrame():void 0,verticalMobile:this._verticalMobile,fullXP:this.isAFullExperience&&this.isAFullExperience()})},isVerticalMobileLayout:function(){let e=!1,t=this.getActionBar();if(t&&t.getContent){let i=t.getContent().getParent().querySelector(".MabEnhancement"),n=t.MAB;if(n){let t=n.state.mode;e=("mobile"===t||"stamp"===t)&&!i}}return e},destroy:function(){this.clean(),this._unregisterContextualBar(),this.deactivate();var e=this.getViewer();e&&void 0===this._OITstatusToRestore&&e.setOIT(this._OITstatusToRestore),n&&(A(this._resizeCb),A(this._sectionBeginCb),A(this._sectionEndCb),A(this._progressInitCb),A(this._progressUpdateCb),A(this._progressEndCb),A(this._VRFacetBuildDoneCb),A(this._getLegendMinMaxCb),A(this.frameSelectionCallback),A(this.legendEditMinCallback),A(this.legendEditMaxCallback),A(this._fullscreenDisableCb),A(this._restore3DCommentBarStateCb)),P.clean(),this._parent()},getSPM:function(){return this._spm},getSimulationId:function(){return this._id||this._spm.getMSRID()},isRestoring3DComment:function(){return y._restoring3DComment},setContextualBar:function(e){this._unregisterContextualBar(),e&&this._registerContextualBar()},setExtractableUIsupport:function(e){this._allowExtractableUI=e},isExtractableUIallowed:function(){return this._allowExtractableUI},setReframeOnContentChange:function(e){this.allowReframeOnContentChanged=e},onClean:function(e){this.onClean=e},setUpdateStats:function(e){this.updateStats=e},setPublishPCSEvent:function(e){this.publishPCSEvent=e},getLoader:function(){var e,t=this.getExperience();return t&&(e=t.loader),e},isLoadingComplete:function(){let e=!1,t=this.getLoader();return t&&(e=t.isLoadingComplete()),e},_restoreAnimScope:function(e){var t=this.getActiveDD();if(t){let n=t.isPartialAnimationMode();if(this.animationFrameIdx){const e=t.getAnimationScope(this.animationFrameIdx);e?.hasModes&&(n=t.defaultLockStatus)}if(!0===n!==(!0===e)){var i=t?t.getLegend():void 0;i&&i.impl.CATISimNavDataSpecUI.obj._legendUI&&i.impl.CATISimNavDataSpecUI.obj._legendUI._partialAnimLock&&i.impl.CATISimNavDataSpecUI.obj._legendUI._partialAnimLock.click()}}},_restoreUserBound:function(e,t,i){var n=this.getActiveDD(),a=n?n.getLegend():void 0;a&&e&&a.unit===e.unit?("min"===e.type?a.setUserMin(e.value,this.animationFrameIdx,!1):"max"===e.type&&a.setUserMax(e.value,this.animationFrameIdx,!1),a.impl.CATISimNavDataAnimation.obj.animate(this.animationFrameIdx,{navigateMode:!0}),t&&t()):i&&i()},_restoreUserMinMax:function(e){e&&(isNaN(e.userMin)||this._restoreUserBound({type:"min",value:e.userMin,unit:e.unit}),isNaN(e.userMax)||this._restoreUserBound({type:"max",value:e.userMax,unit:e.unit}))},setStateData:function(e){y.resetSession(),this._previousSetup=JSON.parse(e),this._expectedSequence=void 0,this._previousSetup&&this._previousSetup.content&&(this._expectedSequence={id:this._previousSetup.content.sequencePersistentId,name:this._previousSetup.content.sequenceName})},getPreferredStreamId:function(){let e;return this._previousSetup&&this._previousSetup.content&&(e=this._previousSetup.content.sequencePersistentId),e},getPreferredContentName:function(){let e;return this._previousSetup&&this._previousSetup.content&&(e=this._previousSetup.content.contentName),e},isThereAnExpectedSequence:function(e){return void 0!==this._expectedSequence&&void 0!==this._expectedSequence.id},isTheExpectedSequence:function(e){return this._expectedSequence&&e===this._expectedSequence.id},resetExpectedSequence:function(){this._expectedSequence=void 0},getExperience:function(){var e;return this.window&&(e=this.window.experience),e},getExperienceRootBag:function(){var e;return this.window&&this.window.experience&&this.window.experience.getRootBag&&(e=this.window.experience.getRootBag()),e},getRootBag:function(){var e,t=this.getViewer();if(t){var i=t.getRootNode();i&&(e=i.getChildByName("RootBag"))}return e},getParentNode:function(){return this._parentNode},getAssetRootBag:function(){var e,t=this.getParentNode();if(t||(t=this.getRootBag()),t){var i=this.getSimulationId();(e=t.getChildren().find((function(e){return e.getModelIdentification()===i})))||((e=new l).name=this._spm.getSimulationAlias(),e.setModelIdentification(i),t.addChild(e))}return e},getUIFrame:function(){var e;return this.window&&(e=this.window.getUIFrame()),e},getUIManager:function(){var e;return this.window&&this.window.experience&&(e=this.window.experience.UIManager),e},getActionBar:function(){var e;return this.window&&(e=this.window.getActionBar()),e},getViewer:function(){var e;return this.window&&(e=this.window.getViewer()),e},getLayoutId:function(){return this._layoutId},isTouch:function(){return"ontouchstart"in window},_isAFullExperience:function(e){var t=!1;if(e&&e.args&&e.args.workbenchs&&e.args.workbenchs[0]){var i=e.args.workbenchs[0];t="FullSimulationPlayer"===i.name||"FullMeshingReview"===i.name||"FemFileImport"===i.name}else t=this._roleForFullFound;return t},isAFullExperience:function(){return this._isAFullExperience(this.getExperience())},_isAPreviewExperience:function(e){var t=!1;e&&e.args&&e.args.workbenchs&&e.args.workbenchs[0]&&(t="PreviewSimulationPlayer"===e.args.workbenchs[0].name);return t},_isA3DSimExperience:function(e){var t=!1;if(e&&e.args&&e.args.workbenchs&&e.args.workbenchs[0]){var i=e.args.workbenchs[0];t="3DSimPlayer"===i.name||"3DSimPlayerNoReturn"===i.name}return t},_updateScrollersHeight:function(){this._scrollers&&this._scrollers.forEach((function(e){if(e.panel&&e.panel.getContent){var t=e.panel.getContent();if(t&&!t.isHidden()&&e.panel.elements){var i=(e.panel.elements.panel.clientHeight-10).toString()+"px";e.scroller&&e.scroller.setStyle("height",i),e.panelContent&&e.panelContent.setStyle("height",i)}}}))},_updateFrameWidth:function(e,t){e&&e.updateFrame(void 0,t)},_showAttachDataButton:function(){let e=R.getCommand("CATSPYMSRShareAs3DCommentCmdHdr",this.ctx);e&&!e.isRunning()&&e.begin(),this.shareAs3dCommentCurrentState=!0},_hideAttachDataButton:function(){let e=R.getCommand("CATSPYMSRShareAs3DCommentCmdHdr",this.ctx);e&&e.isRunning()&&e.end(),this.shareAs3dCommentCurrentState=!1},_Restore3DCommentBarState:function(){let e=R.getCommand("CATSPYMSRShareAs3DCommentCmdHdr",this.ctx);e&&e.isRunning()&&e.end(),this.shareAs3dCommentCurrentState&&this._showAttachDataButton()},_setAttachSessionDatAvailability:function(e){let t=R.getCommand("CATSPYMSRShareAs3DCommentCmdHdr",this.ctx),i=R.getCommand("CATSPYMSRAttachSessionDataCmdHdr",this.ctx);t&&t.isRunning()&&i&&(e?i.enable():i.disable())},_setTabsListeners:function(){setTimeout((()=>{let e=this._getRightSidePanelCmdHdr();if(e){var t=e.getTriptych().getRightPanelContent(),i=(t.querySelector(".wux-controls-buttongroup"),t.querySelector("[tab_name = physicssimulation]")),n=t.querySelector("[tab_name = relations]"),a=t.querySelector("[tab_name = properties]"),s=t.querySelector("[tab_name = social]");t.addEventListener("click",function(e){e.target.matches(".wux-controls-tabBar-centered")&&e.target.querySelector("[tab_name=physicssimulation]").hasAttribute("checked")&&this._hideAttachDataButton()}.bind(this)),i&&i.addEventListener("click",this._hideAttachDataButton.bind(this)),n&&n.addEventListener("click",this._hideAttachDataButton.bind(this)),a&&a.addEventListener("click",this._hideAttachDataButton.bind(this)),s&&s.addEventListener("click",this._showAttachDataButton.bind(this))}}),1e3)},_SetSessionStateManagerLegenMinMax:function(){var e=this.getActiveDD(),t=e?e.getLegend():void 0;if(t){var i=t.getMinMaxData();y.SetLegendData(i)}},_buildFrame:function(e,t){this._infoFrameBuilding=!0;e.buildFrame(undefined,function(){let i=this._getRightSidePanelCmdHdr();i&&(i.onStateChange(function(){(this.setInformationStatus(i.getState(),e),n.publish({event:this.getContext()+"/SPY/SIDEPANEL/TOGGLE"}),0==i.getState())?this._hideAttachDataButton():"social"==i._propertiesWdg.getContent().currentFacetName&&this._showAttachDataButton()}.bind(this)),this.setInformationStatus(i.getState(),e)),A(this.animScopeCallback),this.animScopeCallback=n.subscribe({event:this.getContext()+"/SPY/ANIMSCOPECHANGE"},function(){this._updateFrameWidth(e,this.animationFrameIdx)}.bind(this)),this._infoFrameBuilding=!1,t&&t(),(this.sidePanelCurrentState||this._no3Dflag)&&e.getInfoContent()&&this.setSidePanelState(!0)}.bind(this))},getContext:function(){return this.ctx},buildTreeView:function(){},getActiveSequence:function(){return this.activeSequence},getActiveDD:function(){var e;-1!==this.activeDD&&-1!==this.activeSequence&&(e=this._spm.getDataDisplayList(this.activeSequence)[this.activeDD]);return e},getValueDisplayPrecision:function(){return 3},cleanInfoContent:function(){if((this.activeDD>=0||this.activatingDD>=0)&&this.activeSequence>=0){var e=this.getActiveDD();if(e){var t=e.impl.CATISimNavDataDisplayUI;t&&t.obj&&t.obj.cleanInfoContent()}}},clean:function(e){if((this.activeDD>=0||this.activatingDD>=0)&&this.activeSequence>=0){var t=this.getActiveDD();this.activeDD=-1,this.activatingDD=-1,this.clearAnimation(),this._animationCompleteOnce=void 0,e&&e.keepSyncMgr||!this.syncMgr||(this.syncMgr.stopSync(),this.syncMgr.resetComponentsToSync(),this.syncMgr.destroy(),delete this.syncMgr,this.syncMgr=void 0),this._stopProbing(),t&&(t.resetLoadingStatus(),t._animationIsInitializing=!1,t.QI("CATISimNavDataDisplayUI",(function(e){e&&e.clean()})),t.QI("CATISimNavDataColorShadingManager",(function(e){e&&e.supportsShading()&&e.resetOverride()}))),this.disclaimer&&(this.disclaimer.remove(),delete this.disclaimer),this._camerasPanel&&(this._camerasPanel.remove(),this._camerasPanel.destroy(),delete this._camerasPanel),this._scrollers=[],this.frame2D&&(this.frame2D.remove(),this.frame2D.destroy(),delete this.frame2D),e&&e.newContent&&this._removeExtractedWindows(),this.frameStreamlines&&(this.frameStreamlines.remove(),this.frameStreamlines.destroy(),delete this.frameStreamlines),A(this.animScopeCallback),A(this.visuLoadingFinishedCallback),A(this.resizeCallback2);var i=this.getExperience()&&this.getExperience().mySPM;i&&this.window&&this.window.removeReviewModel&&this.window.removeReviewModel();var n=this.getViewer();if(n){this._matOverrideManager&&this._matOverrideManager.cleanOverrideSet("SPMUI");var a=this.getAssetRootBag();if(a&&(e&&e.newContent?a.removeChildren():a.getParents()[0].removeChild(a)),i){var s=this.getExperienceRootBag();if(n.clearScene&&s){n.clearScene();var o=n.getRootNode();if(o){for(var r=0;r<s.children.length;r++)s.children[r].SPObj&&s.removeChild(s.children[r]);o.addChild(s)}}}n.render()}this.onClean&&this.onClean()}},reduceToResults:function(){if(this._spm){var e=this._spm,t=this.getActiveDD(),i=this.getActiveSequence();if(t){this.cleanInfoContent();var n,a,s=t.id,o="Result"===t.category,r=e.sequences[i].name;e.sequences.forEach((function(e){e.listDD=e.listDD.filter((function(e){return"Result"===e.category})),r===e.name&&(n=e.listDD.length>0),(a=e.listDD).forEach((function(e){e.removeCharts()})),Array.isArray(e.listDDShared)&&e.listDDShared.forEach((function(e){e.removeCharts()}))})),e.sequences=e.sequences.filter((function(e){return e&&e.listDD&&e.listDD.length>0}));var l=0;e.sequences.forEach((function(e){e.idx=l++})),this.activeSequence=e.sequences.findIndex((function(e){return r===e.name}));var c=-1,h=function(){this.window&&this.window.getViewpoint().reframe()}.bind(this);n?(c=a.findIndex((function(e){return e.id===s})),o&&-1!==c?this.activeDD=c:this.activateDD(c,h)):this.activateSequence(0,h)}}},_setWorldOrientation:function(){var e=this.getViewer();e&&(this._spm.isYaxisUp()?e.setWorldOrientation(h.YUpXRight):e.setWorldOrientation(h.ZUpYRight))},activateDefaultContent:function(e){var t=function(){this._previousSetup?y.loadState(this._previousSetup,{onComplete:e}):e&&e()}.bind(this);this._previousSetup&&this._previousSetup.content?t():this.activateSequence(this._spm.getFirstValidSequenceIdx(),t)},activateContent:function(e,t,i){this._spm.sequences[e]&&(e!==this.activeSequence?(this.clean({newContent:!0,keepSyncMgr:!0}),this._setWorldOrientation(),this.activeSequence=e,this.activateDD(t,i)):this.activateDD(t,i))},activateSequence:function(e,t){this._spm.sequences[e]&&(e!==this.activeSequence?(this.activatingSequence=e,this.clean({newContent:!0,keepSyncMgr:!0}),this._setWorldOrientation(),this.activeSequence=e,this.activateDD(-1,t)):t&&t())},recomputeActiveDDIndex:function(){var e=this._spm.getDataDisplayList(this.activeSequence);Array.isArray(e)&&(this.activeDD=e.findIndex((function(e){return e.activated})))},activateDD:function(e,i,a){if(-1!==this.activeSequence){var s,o,r=this._spm.getDataDisplayList(this.activeSequence);if(-1===e)for(s=0;s<r.length;s++)if((o=r[s]).activated){e=s;break}if(-1===e)for(s=0;s<r.length;s++)if((o=r[s])&&"Result"===o.category){e=s;break}if(-1===e)for(s=0;s<r.length;s++)if((o=r[s])&&"Scenario"===o.category){e=s;break}if(-1===e)for(s=0;s<r.length;s++)if((o=r[s])&&"Model"===o.category){e=s;break}if(r&&e>=0&&e<r.length){var l,c,h=-1===this.activeDD;if(e!==this.activeDD){var d=this._getAnimateCmdHdr();d&&d.disable(),(l=R.getCommandCheckHeader("CATSPYCameraSelectorCmdHdr",this.cmdCtx))&&l.disable(),(c=R.getCommand("CATSPYHideShowCmdHdr",this.cmdCtx))&&c.disable();var g=R.getCommand("CATSPYPublishTo3DSwYmCmdHdr",this.cmdCtx);g&&g.disable()}if(A(this.datadisplayActivatedCallback),this.datadisplayActivatedCallback=n.subscribe({event:this.getContext()+"/SPY/DATADISPLAY/ACTIVATED"},function(e){var a=this.window;this.activeDD=-1!==this.activatingDD?this.activatingDD:this.activeDD,this.activatingDD=-1,A(this.datadisplayActivatedCallback),this.updatePlayAvailability({initValue:1});var s=this.getActiveDD();if(s){var o=s?s.getLegend():void 0;o&&this._checkResultsMaterialModel(),this._getDataDisplayNode()&&((s.isAnimated()||o&&(o.userMax||o.userMin))&&this.updateTextures(this.animationFrameIdx),this.updateExtrema()),this.frameStreamlines&&(this.frameStreamlines.destroy(),this.frameStreamlines=null,this.streamsManager=null);var r=s.getStreamlines();r.length>=1&&(this.frameStreamlines=new t.Element("div",{id:"SP_Overlays_Cont"}).inject(a.getUIFrame()),this.streamsManager=new D({parentContainer:this.frameStreamlines,model:{streamlines:r,eventId:this.getContext()+"/SPY/VISIBILITY/CHANGE"},viewer:this.getViewer()}),this.frameStreamlines.style.display="none"),c&&c.enable(),s.getCameraRoot()&&l&&l.enable(),this.watermark||this._spm.getLogoUrl(function(e){if(e.length>0){var t=this.getUIManager();this.watermark=new b({imageURL:e,parentContainer:a.getUIFrame(),actionBarManager:t})}}.bind(this)),this.watermark&&this.isActive()&&this.watermark.show(),this._update2DComponents();var h=e?e.content:void 0;if(h&&s){this.frameSelectionCallback||(this.frameSelectionCallback=n.subscribe({event:this.getContext()+"/SPY/FRAME/SELECT"},function(e){this.isActive()&&!isNaN(e)&&this.navigateToFrame(e)}.bind(this)));var d=this.getExperience();if(this._isAFullExperience(d)||this._isA3DSimExperience(d)){var u=function(){this.updateTextures(this.animationFrameIdx),this.getViewer().render()}.bind(this);this.legendEditMinCallback||(this.legendEditMinCallback=n.subscribe({event:this.getContext()+"/SPY/LEGEND/EDIT/USERMIN"},u)),this.legendEditMaxCallback||(this.legendEditMaxCallback=n.subscribe({event:this.getContext()+"/SPY/LEGEND/EDIT/USERMAX"},u))}var g=this.getViewer();if(g){var p=s.isAnimated(),v=!1,S=o&&o.localMin&&o.localMin.length>0;if(this._OITstatusToRestore=g.getOIT(),g.setOIT(!0),this.envOCA&&(g.setVisuEnvOCA(this.envOCA),localStorage.setItem("visuEnv",this.envOCA+"OCA")),!this._isAPreviewExperience(d))if("Result"===s.category||s.plotType&&""!==s.plotType)void 0!==s.getGroupInfo(p?this.animationFrameIdx:0)&&(m&&!this.probingMgr&&(this.probingMgr=new m({viewer:g,valueDisplayPrecision:this.getValueDisplayPrecision(),syncEvent:this.getContext()+"/SPY/PROBING"})),this.probingMgr&&(this._startProbing(),v=!0));else this._stopProbing();this._isAFullExperience(d)&&this.initSynchro({viewer:g,hasCameras:s.getCameraRoot(),animation:p,probing:v,legend:S}),this._isAPreviewExperience(d)||s.QI("CATISimNavDataColorShadingManager",function(e){if(e&&e.supportsShading()){e.computeColors(0,function(){this._buildFrame(h,function(){e.activateShading({overrideSet:this._matOverrideManager.getOverrideSet("SPMUI"),viewer:g})}.bind(this))}.bind(this))}else this._buildFrame(h);var t=R.getCommand("CATSPYRHESwitchCmdHdr",this.cmdCtx),i=R.getCommand("CATSPYRHESwitchResetCmdHdr",this.cmdCtx);if(t&&i){t.disable(),i.disable();var n=s.getNavData3DViewList();if(n){var a=e&&e.supportsShading();if(!a&&("Result"===s.category||s.plotType&&""!==s.plotType))for(var o=0;!a&&o<n.length;o++)a=n[o].supportedModes&&n[o].supportedModes.search("REA")>=0;a&&(t.enable(),i.enable())}}}.bind(this))}var f=R.getCommand("CATSPYHideShowLegendCmdHdr",this.cmdCtx);if(f&&(this.frame2D?f.enable():f.disable()),!this._no3Dflag){var _=R.getCommand("CATSPYPublishTo3DSwYmCmdHdr",this.cmdCtx);_&&_.enable()}}this._updateMAB(),this._forcePlay||(this.updateStats&&this.updateStats(),this.publishPCSEvent&&this.publishPCSEvent()),this._updateSidePanel(s),i&&i(),this._forcePlay&&this.initAnimation(!0)}}.bind(this)),e===this.activatingDD)return;if(e===this.activeDD)n.publish({event:this.getContext()+"/SPY/DATADISPLAY/ACTIVATED"});else{this._updateSidePanel(),this._spm.clearLoadingQueue(-1===this.activeDD),this._spm.clearLoadingMap(),this.clean({newContent:!0,keepSyncMgr:!0}),this.activatingDD=e;var p=r[e];this._spm.initLoadingMap({type:"Geometry",entries:p.getMultiInstanciatedFiles()}),this._spm.addToLoadingMap({type:"Geometry",entries:p.getRenderingMaterials()}),this._spm.getDataDisplayList(this.activeSequence).forEach((e=>{e.activated=!1})),p.activated=!0,this._no3Dflag=0===p.list3DViews.length;var v=this.window;this.animationFrameIdx=p.getTotalNumberOfFrames()-1,p.isAnimated()&&p.QI("CATISimNavDataAnimation",function(e){if(e){var t=e.getCurrentAnimationStep();isNaN(t)||(this.animationFrameIdx=t)}this.animationScope=p.getDefaultAnimationScope(this.animationFrameIdx),p.updateLegend(this.animationScope)}.bind(this)),this.watermark&&this.watermark.hide();var S=p.getCameraRoot();if(S){if(S.getListCamera().length>1){var f=this.getCameraSelectorView();this.updateCameraSelector(S,this._spm.getZipEntries(p.seq),f),this.setCameraBrowsingStatus(!1),this._cameraSelector.updateViewPoint(),this._disableAutoReframe=!0}this._animateSingleCamera()}p.QI("CATISimNavDataDisplayUI",(e=>{if(e){let i=i=>{i&&(this.frame2D=new t.Element("div",{class:"spy-immersivepanel"+(this.isTouch()?" spy-immersivepanel-touch":""),id:"SP_2D_Cont"}).inject(v.getUIFrame()),i.inject(this.frame2D)),this._spm.clearLoadingQueue(-1===this.activeDD),this.visuLoadingFinishedCallback=n.subscribe({event:this.getContext()+"/SPY/VISULOADING/FINISHED"},(()=>{if(A(this.visuLoadingFinishedCallback),!y.isLoading()&&!this._disableReframe&&(h||this.allowReframeOnContentChanged)){var t=e.getImpl();t&&(this._no3Dflag||t.getCameraRoot()||!this.window||this.window.getViewpoint().reframe())}n.publish({event:this.getContext()+"/SPY/DATADISPLAY/ACTIVATED",data:{content:e,syncInProgress:a}})}));let s=this.getViewer();if(s)if(this._matOverrideManager||(this._matOverrideManager=new u),n.publish({event:this.getContext()+"/SPY/PROGRESS/INIT",data:{red:!1,fromPreviousValue:!0}}),this._no3Dflag)n.publish({event:this.getContext()+"/SPY/VISULOADING/FINISHED"}),n.publish({event:this.getContext()+"/SPY/PROGRESS/END"}),this.createFakeSphere(),this.markAssetLoaded(p);else{this.getExperience();let t=this.getAssetRootBag();if(e.build3D({initProgressFromCurrent:!0,parentNode:t,overrideManager:this._matOverrideManager,callback:()=>{n.publish({event:this.getContext()+"/SPY/VISULOADING/FINISHED"}),n.publish({event:this.getContext()+"/SPY/PROGRESS/END"});let e=this._spm.extractTypingInfoForDataDisplay(p),t=P.createECContentLoaded(p.id,void 0,e),i=p.analytics;if(i.numberOf3DElements=p.getNavData3DViewList().length,i.numberOfStreamlines=p.getStreamlines().length,i.numberOfCameras=p.getCameraRoot()?p.getCameraRoot().getListCamera().length:0,i.numberOfCharts=p.getNumberOfCharts(),i.numberOfImages=p.getNumberOfImages(),P.addLoadingData(t.id,p.analytics),P.publishTracker(t.id),this.markAssetLoaded(p),this.getSPM().getTextureLoader()){let e=p.getLegend();e&&e.setAsReadOnly()}}}),this._matOverrideManager&&s&&e.node){this._matOverrideManager.cleanOverrideSet("SPMUI");let e=this.getParentNode();e||(e=this.getRootBag()),this._matOverrideManager.createOverrideSet({id:"SPMUI",viewer:s,root:e})}}};e.build2D(i)}}))}}}},restoreDD:function(e,t,i,n){var a=function(){i&&i()},s=function(e){return this._spm.findSimilarContent({persistentId:e.sequencePersistentId,sequenceName:e.sequenceName,dataDisplayId:e.contentId,dataDisplayName:e.contentName,allowNameComparison:this.isLoadingComplete()})}.bind(this);if(e){var o=s(e);if(o&&o.found)this.activateContent(o.sequenceIndex,o.dataDisplayIndex,t);else{var r=!1;if(!this._roleForFullFound&&n&&n.loadExtensionMode&&n.onExtensionGranted){var l=this._spm.findSequenceByPersistentId(e.sequencePersistentId);l<0&&(l=this._spm.findSequenceByName(e.sequenceName)),l>-1&&(r=!0,this._spm.clearLoadingQueue(),this._spm.clearLoadingMap(),this.clean({newContent:!0,keepSyncMgr:!0}),n.onExtensionGranted())}if(!r){var c=this.getLoader();c&&c.isLoadingComplete()?this.activateSequence(this._spm.getFirstValidSequenceIdx(),t):a()}}}else a()},setLegendFrameVisibility:function(e){var t,i,n=this.frame2D,a=this.getActiveDD().getLegend();n&&(e?(n.style.display="block",t="I_SimNavShowLegend",i="I_SimNavHideLegend",a.QI("CATISimNavDataSpecUI",(function(e){e.updateSizeResponsive()}))):(n.style.display="none",t="I_SimNavHideLegend",i="I_SimNavShowLegend"),void 0!==this.probingMgr&&this.probingMgr.setProbingUnit(e,a.unit));var s=this.getActionBar();if(s&&s.getContent){var o=s.getContent().querySelectorAll('*[style*="'+t+'"]')[0];o&&(o.style.backgroundImage=o.style.backgroundImage.replace(t,i))}},initSynchro:function(e){if(_&&e&&e.viewer&&this.syncOptions&&(this.syncMgr?this.syncMgr.resetComponentsToSync():this.syncMgr=new _(this.syncOptions),this.syncMgr)){this.syncMgr.attachSyncButton(this.frame2D);var t={};this.syncOptions.simNavSyncDomain.content&&(t.content={event:this.getContext()+"/SPY/DATADISPLAY/ACTIVATED",eventDataBuild:function(e){var t=null;if(!e.syncInProgress){var i=e.content?e.content.implementation:void 0;i&&(t={sequenceName:i.spm.getSequenceName(i.getSequence()),dataDisplayName:i.name})}return t},callback:function(e){e.allowNameComparison=!0;var t=this._spm.findSimilarContent(e);if(t&&t.found)this.activateContent(t.sequenceIndex,t.dataDisplayIndex);else{var i=I.appNotificationTypes.info;r.nls("SPYUI/ContentSync","ContentSync.noMatch",function(e){I.sendAppNotification(i,{text:e})}.bind(this))}}.bind(this)}),this.syncOptions.simNavSyncDomain.viewpoint&&(t.viewpoint={viewer:e.viewer,cameraCheck:e.hasCameras?"_SPYCameraId":void 0}),this.syncOptions.simNavSyncDomain.viewpoint&&e.probing&&(t.probing={event:this.getContext()+"/SPY/PROBING",callback:function(e){this.probingMgr&&this.probingMgr.isProbingActive()&&this.probingMgr.processProbingPosition(e)}.bind(this)}),t.instanceDispose={event:this.getContext()+"/SPY/INSTANCEDISPOSE"},e.animation&&(this.syncOptions.simNavSyncDomain.frameNavigation&&(t.frameNavigation={event:this.getContext()+"/SPY/FRAME/SELECT",callback:function(e){isNaN(e)||this.navigateToFrame(e,null,!1)}.bind(this)}),this.syncOptions.simNavSyncDomain.animation&&(t.animation={play:{event:this.getContext()+"/SPY/ANIM/PLAY",callback:function(e){var t=e.position,i=e.totalNumberOfFrames;if(!isNaN(t)&&!isNaN(i)){var a=this.getActiveDD();if(a&&a&&a.isAnimated()){this.updatePlayAvailability({forceToDisabledFlag:!0}),n.publish({event:this.getContext()+"/SPY/FRAME/DISABLESELECT"}),this._stopProbing(),this._setAttachSessionDatAvailability(!1);var s=function(){this.animationFrameIdx=t,this.animationScope=a.getAnimationScope(t),this.animationScope.length>1&&a.updateLegend(this.animationScope)}.bind(this);a.isAnimationInitialized()?s():this.initAnimation(!1,s)}}}.bind(this)},clear:{event:this.getContext()+"/SPY/ANIM/CLEAR",callback:function(){this.clearAnimation(this.animationForwardFlag),this.updatePlayAvailability()}.bind(this)},frameChanged:{event:this.getContext()+"/SPY/ANIM/FRAMECHANGED",callback:function(e){var t=this.getActiveDD();t&&t.isAnimated()&&this.animationScope.length>1&&t.isAnimationInitialized()&&t.QI("CATISimNavDataAnimation",function(i){var n=t.getTotalNumberOfFrames();e.position<n&&(i.animate(e.position,{navigateMode:!1,forward:e.forward,animationScope:this.animationScope}),this.animationFrameIdx=e.position,this.animationForwardFlag=e.forward)}.bind(this))}.bind(this)}})),this.syncOptions.simNavSyncDomain.legend&&e.legend&&(t.legendMinMaxRequest={callback:function(){var e,t=this.getActiveDD();if(t){var i=t.getLegend();i&&(e=i.getMinMaxData(this.animationFrameIdx))}return e}.bind(this)},t.legendMinMaxResponse={callback:function(e){var t=this.getActiveDD();if(t){var i=t.getLegend();i&&setTimeout(function(){i.integrateMinMaxData(e,this.animationFrameIdx)}.bind(this),300)}}.bind(this)},t.legendMinEdited={event:this.getContext()+"/SPY/LEGEND/EDIT/USERMIN",callback:function(e){var t=this.getActiveDD();if(t){var i=t.getLegend();if(i&&i.unit===e.unit){var n=isNaN(e.value)?e.computed:e.value;i.setUserMin(n,this.animationFrameIdx,!1)}}}.bind(this)},t.legendMaxEdited={event:this.getContext()+"/SPY/LEGEND/EDIT/USERMAX",callback:function(e){var t=this.getActiveDD();if(t){var i=t.getLegend();if(i&&i.unit===e.unit){var n=isNaN(e.value)?e.computed:e.value;i.setUserMax(n,this.animationFrameIdx,!1)}}}.bind(this)}),Object.keys(t).length>0&&this.syncMgr.addComponentsToSync(t)}},isSynchronizingLegend:function(){return this.syncMgr&&this.syncMgr.isLegendSyncOn()},initAnimation:function(e,t){this._playCount++;var i=this.getActiveDD();if(i&&!i._animationIsInitializing){i._animationIsInitializing=!0;var a=this._createProbe("MsrEcInitAnimation"+this._playCount.toString());a&&a.begin(),isNaN(this.animationFrameIdx)&&(this.animationFrameIdx=i.getTotalNumberOfFrames()-1),i.isPartialAnimationMode()?(this.animationScope=i.getAnimationScope(this.animationFrameIdx),(this.animationScope.length<=1||!this.animationScope.canBePartial)&&(this.animationScope=i.getDefaultAnimationScope(this.animationFrameIdx),i.setPartialAnimationMode(!1))):this.animationScope=i.getDefaultAnimationScope(this.animationFrameIdx),e&&this._initAnimationTrackerData(i);var s=this.getViewer();this.watermark&&this.watermark.hide(),i.QI("CATISimNavDataAnimation",function(o){o.initAnimation(function(){if(i.updateLegend(this.animationScope),i._animationIsInitializing=!1,i.setAnimationAsInitialized(),this._currentAnimDD=o,a&&a.end(),e){this._zzPCS_PlayProbe=this._createProbe("MsrEcAnimation"+this._playCount.toString()),this._zzPCS_PlayProbe&&this._zzPCS_PlayProbe.begin();var r=Date.now(),l=function(e,t){if(this._currentAnimDD){var i=this.animationScope.frames[e-1].globalIndex-1;if(this.animationFrameIdx!==i){this._currentAnimDD.isFrameLoaded(this.animationFrameIdx)||this._spm.clearLoadingQueue(),this.animationFrameIdx=this.animationScope.frames[e-1].globalIndex-1,1===e&&(t=!0);var a=this.getActiveDD();n.publish({event:this.getContext()+"/SPY/ANIM/FRAMECHANGED",data:{position:this.animationFrameIdx,totalNumberOfFrames:a.getTotalNumberOfFrames(),totalComputedFramesNumber:a.getAnimationStructure().totalComputedFramesNumber,forward:t}}),this._currentAnimDD.animate(this.animationFrameIdx,{navigateMode:!1,forward:t,animationScope:this.animationScope}),s.render()}}}.bind(this),c=function(){if(!this.maxiPlayer){var e=this.getUIManager(),t=this.getActionBar(),i=-.38*(this.animationScope.length-1-5)+200;i=i>=200?200:i<=50?50:i,this.maxiPlayer=new v({device:this.device,isReduced:this.reducedPlayer,resizeManager:e,actionBarManager:e,actionBar:t,minValue:1,maxValue:this.animationScope.length,initValue:1,intervalMS:i,canPlayerChangeTo:function(e,t,i,n){if(this._currentAnimDD){var a=this.animationScope.frames[e-1].globalIndex-1;if(this._currentAnimDD.isFrameLoaded(a))t&&t(e);else{i&&i();var s=Date.now();this._currentAnimDD.loadFrame(a,function(t){t.ellapsedTime=Date.now()-s,this._updateAnimationLoadingAnalytics(t),n(e)}.bind(this))}}}.bind(this),onPlayerChange:l,onStop:function(){this.pause()}.bind(this),onPlay:function(){n.publish({event:this.getContext()+"/SPY/FRAME/DISABLESELECT"}),this.play()}.bind(this),onPause:function(){this.pause()}.bind(this),onOptions:function(){this._playerSpeedOptionDlg?(this._playerSpeedOptionDlg.destroy(),this._playerSpeedOptionDlg=void 0):this._playerSpeedOptionDlg=new S({container:this.getUIFrame(),actionBar:t,initialLayoutId:this._layoutId,resizeEvent:this.getContext()+"/SPY/VIEWERRESIZE",speedFactor:this._speedFactor,onChange:this.maxiPlayer.setCurrentSpeedFactor.bind(this.maxiPlayer)})}.bind(this),onExit:function(){var e=this._getAnimateCmdHdr();e&&(e.end?e.end():e.done())}.bind(this),loopMode:this._loopMode,speedFactor:this._speedFactor,onCompleteRun:function(){this._zzPCS_PlayProbe&&(this._zzPCS_PlayProbe.end(),this.updateStats&&this.updateStats(),this._forcePlay&&1===this._playCount&&this.publishPCSEvent&&this.publishPCSEvent(),this._zzPCS_PlayProbe=void 0),this._animationCompleteOnce||(this._trackAnimationLoaded(),this._animationCompleteOnce=!0)}.bind(this)}),this.watermark&&this.watermark.setBottomOffset(80);let a=this.window.getImmersiveFrame().getFreeZone();a&&this.maxiPlayer.inject(a),this._camBrowsing&&this._camerasPanel&&this._camerasPanel.slideIn()}this.maxiPlayer.show(),this.maxiPlayer.play()}.bind(this),h=this.animationScope.frames[0].globalIndex-1;o.isFrameLoaded(h)?(l(1),c()):o.loadFrame(h,function(e){e.ellapsedTime=Date.now()-r,this._updateAnimationLoadingAnalytics(e),l(1),c()}.bind(this))}this.watermark&&this.watermark.show(),t&&t()}.bind(this))}.bind(this))}},play:function(){var e=this.getActiveDD();if(e&&e.isAnimationInitialized()&&!this.running){this.running=!0,this.probingMgr&&this.probingMgr.stopProbing(),this.updateExtrema();var t=this.getViewer().ambience;t&&(this._prevAutoGroundOffSet=t.isAutoGroundOffset(),t.setAutoGroundOffset(!1),this._prevBkgGeoAutoSize=t.getBackgroundGeometry().isAutoUpdateSize(),t.getBackgroundGeometry().setAutoUpdateSize(!1)),this._setAttachSessionDatAvailability(!1)}},_initAnimationTrackerData:function(e){this._animationLoadingTrackerData={dataSize:0,streamingTime:0,extractionTime:0,dataModelCreationTime:0,visuCreationTime:0,activeDD:e,numberOfFrames:0,ellapsedTime:0,numberOf3DElements:0}},_updateAnimationLoadingAnalytics:function(e){if(e&&this._animationLoadingTrackerData){isNaN(this._animationLoadingTrackerData.firstFrameIndex)&&(this._animationLoadingTrackerData.firstFrameIndex=e.globalFrameIdx),this._animationLoadingTrackerData.lastFrameIndex=e.globalFrameIdx,this._animationLoadingTrackerData.numberOfFrames++,this._animationLoadingTrackerData.extractionTime+=e.extractionTime,this._animationLoadingTrackerData.visuCreationTime+=e.visuCreationTime;var t=Math.max(this._animationLoadingTrackerData.numberOf3DElements,e.numberOf3DElements);this._animationLoadingTrackerData.numberOf3DElements=t,this._animationLoadingTrackerData.ellapsedTime+=e.ellapsedTime}},_trackAnimationLoaded:function(){if(this._animationLoadingTrackerData&&this._animationLoadingTrackerData.numberOfFrames>0){var e=this._animationLoadingTrackerData.activeDD,t=this._spm.extractTypingInfoForDataDisplay(e),i=P.createECAnimationLoaded(this._animationLoadingTrackerData.firstFrameIndex,void 0,t);P.addLoadingData(i.id,this._animationLoadingTrackerData),P.overrideLoadingTime(i.id,this._animationLoadingTrackerData.ellapsedTime),P.publishTracker(i.id),this._initAnimationTrackerData(e)}},pause:function(){this.running=!1;var e=this.getViewer().ambience;e&&(e.setAutoGroundOffset(this._prevAutoGroundOffSet),e.getBackgroundGeometry().setAutoUpdateSize(this._prevBkgGeoAutoSize))},clearAnimation:function(e){if(this.pause(),this._trackAnimationLoaded(),this._spm.clearLoadingQueue(-1===this.activeDD),this.maxiPlayer){e=this.maxiPlayer.playerForwardDirection,this._loopMode=this.maxiPlayer.getLoopMode(),this._speedFactor=this.maxiPlayer.getCurrentSpeedFactor(),this.maxiPlayer.clear(),this.maxiPlayer.hide();let t=this.window.getImmersiveFrame().getFreeZone();t&&this.maxiPlayer.removeFrom(t),this.maxiPlayer=null,this.watermark&&this.watermark.setBottomOffset(0)}this._playerSpeedOptionDlg&&(this._playerSpeedOptionDlg.destroy(),this._playerSpeedOptionDlg=void 0);var t=this.getActiveDD();if(t){var i=t.getGroupForFrame(this.animationFrameIdx);if(i&&i.group){if(i.group.scaledAnimation){var a=t.getClosestComputedFrameInGroup(this.animationFrameIdx,e);this.navigateToFrame(a)}else this.updateTextures(this.animationFrameIdx),this.getViewer().render(),this._startProbing(),this.updateExtrema();n.publish({event:this.getContext()+"/SPY/FRAME/ENABLESELECT"})}this._setAttachSessionDatAvailability(!0)}this._currentAnimDD=void 0,this._zzPCS_PlayProbe=void 0},isAnimationRunning:function(){return this.running},getAnimationFrameIndex:function(){return this.animationFrameIdx},updatePlayAvailability:function(e){var t=this.getActiveDD(),i=this._getAnimateCmdHdr();if(i&&t){if(void 0!==e&&void 0!==e.forceToDisabledFlag)i.disable();else if(t.isAnimated()&&this.animationScope.length>1){if(i.enable(),this.maxiPlayer){var n=void 0!==e?e.initValue:this.animationScope.localPosition;this.maxiPlayer.updateBoundaries(1,this.animationScope.length,n)}}else i.disable();this._updateMAB()}},navigateToFrame:function(e,t,i){var a=Date.now();if(this._processingNavFrame!==e){this._processingNavFrame=e;var s=this.getActiveDD();s&&e>0&&e<=s.getTotalNumberOfFrames()&&s.QI("CATISimNavDataAnimation",function(o){var r=function(){if(o.isFrameLoaded(this.animationFrameIdx)||this._spm.clearLoadingQueue(),this.animationFrameIdx=e-1,s.isPartialAnimationMode()){var r=!0,l=s.getAnimationScope(this.animationFrameIdx);l.length<=1||!l.canBePartial?(l=s.getDefaultAnimationScope(this.animationFrameIdx),s.setPartialAnimationMode(!1)):r=l.globalStart!==this.animationScope.globalStart||l.globalEnd!==this.animationScope.globalEnd,this.animationScope=l,r&&n.publish({event:this.getContext()+"/SPY/ANIMSCOPECHANGE"})}else this.animationScope=s.getDefaultAnimationScope(this.animationFrameIdx);this.updatePlayAvailability();var c=function(e){if(s.updateLegend(this.animationScope),o.animate(this.animationFrameIdx,{navigateMode:!0,animationScope:this.animationScope,noEvent:!1===i}),this.updateTextures(this.animationFrameIdx),this._startProbing(),this.updateExtrema(),e){var r=this._spm.extractTypingInfoForDataDisplay(s),l=Object.assign({dataSize:0,streamingTime:0,dataModelCreationTime:0},e),c=P.createECFrameLoaded(this.animationFrameIdx,void 0,r);P.addLoadingData(c.id,l),P.overrideLoadingTime(c.id,Date.now()-a),P.publishTracker(c.id)}this._processingNavFrame=void 0,n.publish({event:this.getContext()+"/SPY/FRAME/NAVIGATED"}),t&&t()}.bind(this);o.isFrameLoaded(this.animationFrameIdx)?c():o.loadFrame(this.animationFrameIdx,c)}.bind(this);s.isAnimationInitialized()?r():o.initAnimation((function(){r()}))}.bind(this))}},isInformationFrameBuilding:function(){return this._infoFrameBuilding},setInformationStatus:function(e,t){if(t&&t.getInfoContent()){this.infoPaneExpandStatus=e,this.xcrosshighlightActive=e;var i=this.getActiveDD();if(i){var n=i.getNavDataFrameViewList();if(n)for(var a=function(e){e&&(this.xcrosshighlightActive?e.enableCrossHighlight():e.disableCrossHighlight())}.bind(this),s=0;s<n.length;s++){var o=n[s];o&&o.QI("CATISimNavDataSpecUI",a)}}}},getSidePanelState:function(){let e,t=this._getRightSidePanelCmdHdr();return t&&(e=t.getState()),e},setSidePanelState:function(e){let t=this._getRightSidePanelCmdHdr();t&&t.setState(e)},toggleExtrema:function(){var e=this.getActiveDD();e&&e.QI("CATISimNavDataDisplayUI",function(e){e.setExtremaRequestedFlag(!e.getExtremaRequestedFlag()),this.updateExtrema()}.bind(this))},updateExtrema:function(){var e=!1,t=!1,i=this.isAnimationRunning(),n=this.getActiveDD();if(n&&"Result"===n.category&&n.QI("CATISimNavDataDisplayUI",function(a){var s=function(){a.setExtremaVisibility(t);var e=t?"I_SimNavShowMinMax":"I_SimNavHideMinMax",i=t?"I_SimNavHideMinMax":"I_SimNavShowMinMax",n=this.getActionBar();if(n&&n.getContent){var s=n.getContent().querySelectorAll('*[style*="'+e+'"]')[0];s&&(s.style.backgroundImage=s.style.backgroundImage.replace(e,i))}this.getViewer().render()}.bind(this);if(i)s();else{var o=n.getTotalNumberOfFrames(),r=void 0===this.animationFrameIdx?o-1:this.animationFrameIdx;(e=n.hasMinMax()&&n.hasExtremaAvailable(r))&&(t=a.getExtremaRequestedFlag())?a.computeExtrema(r,(function(){s()})):s()}}.bind(this)),this._extremaCmdAvailable!==e){this._extremaCmdAvailable=e;var a=R.getCommand("CATSPYShowHideExtremaCmdHdr",this.cmdCtx);a&&(e?a.enable():a.disable(),this._updateMAB())}},onUpdatePsoProbing:function(){},getOverrideManager:function(){return this._matOverrideManager},_getDataDisplayNode:function(){let e,t=this.getAssetRootBag();if(t)for(let i=0;i<t.children.length&&!e;i++)e=t.children[i].SPObj?t.children[i]:null;return e},updateTextures:function(e,t,i){let n=this.getActiveDD(),a=this._getDataDisplayNode(),s=i||{valueDisplayPrecision:this.getValueDisplayPrecision()};p.updateTextures(a,n,e,t,s)},_checkResultsMaterialModel:function(){this._uvTransformFound=!1;let e=this.getActiveDD(),t=this._getDataDisplayNode();if(e&&t&&(e.hasMinMax()||e.getLegend()&&e.getLegend().labels)){let e={node:t,childCondition:e=>e&&e.SPObj&&e.SPObj.supportedModes.search("ENG")>=0,nodeUpdateOperator:(e,t)=>{e.SPObj&&(e.SPObj.hasEngMaterialWithUVTransform=!0,e.SPObj.uvTransform=t)}};this._uvTransformFound=p.searchForUVTransform(e)}},setCameraBrowsingStatus:function(e){this.getCameraSelectorView(),this._camerasPanel&&this._camBrowsing!==e&&(this._camBrowsing=e,this._camerasPanel.slideToggle())},getCameraBrowsingStatus:function(){return this._camBrowsing},getCameraSelectorView:function(){if(!this._camerasPanel){this._camerasPanel=new o({title:"",side:"left"}).inject(this.getUIFrame());var e=new s({title:""}).inject(this._camerasPanel);this._camPanelContent=new t.Element("div",{class:"spy-camerapane-container"}).inject(e),this._camBrowsing=!0;var i=R.getCommandCheckHeader("CATSPYCameraSelectorCmdHdr",this.cmdCtx);this._camerasPanel.onSlideIn(function(){var e=this._camerasPanel.elements.panel.clientWidth+30;this._camBrowsing=!0,i&&i.setState(!0),this.maxiPlayer&&this.maxiPlayer.setLeftOffset(e),this.disclaimer&&this.disclaimer.setLeftOffset(e)}.bind(this)),this._camerasPanel.onSlideOut(function(){this._camBrowsing=!1,i&&i.setState(!1),this.maxiPlayer&&this.maxiPlayer.setLeftOffset(0),this.disclaimer&&this.disclaimer.setLeftOffset(0)}.bind(this)),A(this.resizeCallback2),this.resizeCallback2=n.subscribe({event:this.getContext()+"/SPY/VIEWERRESIZE"},this._updateScrollersHeight.bind(this))}return this._camPanelContent},updateCameraSelector:function(e,t,i){this._cameraSelector?this._cameraSelector.reset({cameraRoot:e,zip:t}):this._cameraSelector=new x({cameraRoot:e,viewer:this.getViewer(),zip:t,selectionEventId:this.getContext()+F,changeEventId:this.getContext()+L}),this._cameraSelector.loadScrollingPanel(i,function(){this._scrollers.push({scroller:this._camerasPanel.getContent().querySelector(".wux-scroller"),panel:this._camerasPanel,panelContent:this._camPanelContent}),this._updateScrollersHeight()}.bind(this))},createFakeSphere:function(){var e=new c.Sphere;e.radius=10,this.getViewer().getRootNode()._bsShow=e},activateCamera:function(e,t,i){var a=this.getActiveDD();if(a){var s=a.getCameraRoot();if(s){var o=s.setCurrentCameraFromId(e);n.publish({event:this.getContext()+L,data:{cameraIndex:o,cameraId:e}}),t&&t()}else t&&t()}else i&&i()},markAssetLoaded:function(e){if(!this._assetLoaded&&e){this._assetLoaded=!0;var t=this.getExperience();if(!(t&&t.isDefaultExperience&&t.isDefaultExperience())){var i=this._spm.getAnalytics();if(i){var n=this.getSimulationId(),a=this._spm.getTypingInfo()||{};a&&(a.providerType=i.providerType,a.assetType=i.assetType);var s=0,o=0,r=0,l=0,c=0,h=0,d=this._spm.getDataDisplayType(e),u=e.analytics.visuCreationTime;this._spm.sequences.forEach(function(e){if(e&&(c++,h+=e.listDD.length,e.analytics)){this._spm.updateSequenceAnalyticsFromContent(e.idx);var t={dataSize:e.analytics.dataSize,streamingTime:e.analytics.streamingTime,extractionTime:e.analytics.extractionTime,dataModelCreationTime:e.analytics.dataModelCreationTime,numberOfContents:e.listDD.length},i=this._spm.extractTypingInfoForSequence(e.persistentId,e.name);e.idx===this.getActiveSequence()&&(i.contentType=d,t.visuCreationTime=u);var n=P.createSequenceECLoaded(e.persistentId,e.name,void 0,i);P.addLoadingData(n.id,t),P.publishTracker(n.id),s+=e.analytics.streamingTime,o+=e.analytics.dataSize,r+=e.analytics.extractionTime,l+=e.analytics.dataModelCreationTime}}.bind(this)),d&&(a.contentType=d);var m=P.createSimulationECLoaded(n,a);P.addLoadingData(m.id,{streamingTime:s,dataSize:o,extractionTime:r,dataModelCreationTime:l,visuCreationTime:u,numberOfSequences:c,numberOfContents:h}),P.overrideLoadingTime(m.id,Date.now()-i.loadStart),P.publishTracker(m.id)}}t&&t.markAssetLoaded&&(this._disableAutoReframe&&(t.autoReframe=!1),t.markAssetLoaded())}},isActive:function(){return this._active},activate:function(){this.window.SPMUI=this,I.setCurrentController(this),this._active=!0,this._update2DComponents(),this._setCmdsAvailability(!0),this._startProbing(),n.publish({event:this.getContext()+"/SPY/ASSET/ACTIVATED",data:this.getSimulationId()})},deactivate:function(){this.window.SPMUI=void 0,I.setCurrentController(void 0),n.publish({event:this.getContext()+"/SPY/ASSET/DEACTIVATED",data:this.getSimulationId()}),this._active=!1,this._setCmdsAvailability(!1),this._stopProbing(),this._update2DComponents()},getChooseContentController:function(){return E}})}));