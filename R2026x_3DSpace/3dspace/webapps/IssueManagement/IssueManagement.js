define("DS/IssueManagement/commands/ExportCSV",["UWA/Class","DS/ApplicationFrame/Command"],(function(e,t){"use strict";return e.extend(t,{init:function(e){this._parent(e,{isAsynchronous:!0})},execute:function(){var e=this;require(["DS/IssueManagement/export/ExportCSV"],(function(t){t.exportation().finally((function(){e.end()}))}))}})})),define("DS/IssueManagement/commands/ExportPPTX",["UWA/Class","DS/ApplicationFrame/Command"],(function(e,t){"use strict";return e.extend(t,{init:function(e){this._parent(e,{isAsynchronous:!0})},execute:function(){var e=this;require(["DS/IssueManagement/export/ExportPPTX"],(function(t){t.exportation().finally((function(){e.end()}))}))}})})),define("DS/IssueManagement/export/Print",["UWA/Class/Promise","UWA/Core","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Button","DS/ControlsEx/LoadingPanel","DS/UIKIT/Mask","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","DS/IssueCommon/utils/Utils","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueCommon/assets/nls/IssueCommon","css!DS/IssueManagement/IssueManagement.css"],(function(e,t,n,s,i,o,a,r,l,c,d,u,p){"use strict";var m="DS/IssueManagement/export/Print",g="Issue",f=200;return{exportation:function(n){if(!t.is(n,"object")||!t.is(n.context))throw new Error("Invalid input parameters: context is undefined");let s,i=new e((e=>{s=e}));c.start(m+" exportation");var o=n.context,a=r.get("component"),l=a.getSelectedNodes().filter((function(e){return e.options.baseType===g}));return 0==l.length&&a.loadedIssues<a.totalIssues?this.showConfirmationDialog(s,o):this.printIssues(s,o,l),i},showConfirmationDialog:function(e,t){var o=this,a=r.get("component"),l=new n({}),c=document.getElementsByClassName("issue-list")[0];l.inject(c);var d=u.replace(u.printMessage,{number:a.totalIssues});new s({immersiveFrame:l,title:u.printTitle,content:d,activeFlag:!1,modelFlag:!0,width:500,buttons:{No:new i({domId:"printNo",label:u.cancel,onClick:function(t){l.destroy(),e()}}),Yes:new i({domId:"printYes",label:u.printTitle,onClick:function(n){l.destroy(),o.loadAllIssues(t,e)}})}}).addEventListener("close",(function(t){e(),l&&l.destroy()}))},loadAllIssues:function(e,t){var n=this,s=r.get("component"),i=new o({shape:"linear",showButtonsFlag:"closeButtonOnly",modalFlag:!0,width:"15%",info:u.loadingIssues}).inject(widget.body);i.on();var a=s.loadAllIssues();i.addEventListener("stop",(function(){a.cancel(),i.off(),t()})),a.then((function(){i.off(),n.printIssues(t,e,[])}))},printIssues:function(e,t,n){var s=this._createHTMLTextTable(t,n);this._print(s).then((function(){c.end(m+" exportation"),e()}))},_printWindow:void 0,_createHTMLTextTable:function(e,n){c.start(m+" _createHTMLTextTable");var s="";s="datagrid"==e.list.summaryview?e.getTreeListView().columns.slice():e.getTreeListView().getManager().getColumns().slice(),0===n.length&&(n="datagrid"==e.list.summaryview?e.getTreeListView().getTreeDocument().getRoots():e.getTreeListView().getManager().getRoots());for(var i=[],o=[],a=0;a<s.length;a++){var f=s[a];r.get("ISU_LISTVIEW")?f.text&&!0!==f.isHidden&&this._isExportable(f)&&i.push(f):f.text&&"ContextualMenuColumn"!=f.dataIndex&&1==f.visibleFlag&&this._isExportable(f)&&i.push(f)}for(var h=0;h<n.length;h++){var v=n[h];v.isVisible()&&v.isRoot()&&o.push(v)}var I=t.createElement("div",{class:"issue-list-print"}),b=t.createElement("div",{class:"issue-list-print-summary"});b.inject(I);var y=t.createElement("div",{class:"issue-list-print-summary-sub-ctn issue-list-print-summary-total-ctn"});y.inject(b),t.createElement("div",{class:"issue-list-print-summary-label issue-list-print-summary-total-label",html:u.export.printTotalLabel}).inject(y),t.createElement("div",{class:"issue-list-print-summary-value issue-list-print-summary-total-value",html:o.length}).inject(y);for(var w={Create:0,Assign:0,Active:0,Review:0,Closed:0},S=0;S<o.length;S++)w[o[S].options.state]++;var C=l.get3DSpaceUrl()+"/snresources/images/icons/small/iconSmallIssue.png";Object.keys(w).forEach((function(e){var n=d.getIconByState(e,g,C),s=t.createElement("div",{class:"issue-list-print-summary-sub-ctn"});s.inject(b);var i=t.createElement("div",{class:"issue-list-print-summary-label"});i.inject(s);var o=p.maturity[e.toLowerCase()],a=r.get("maturityGraph");null!=a&&""!==a&&(o=a[e]),t.createElement("span",{class:"issue-list-print-summary-label-nls",html:o}).inject(i),t.createElement("img",{class:"issue-list-print-summary-icon",src:n}).inject(i),t.createElement("div",{class:"issue-list-print-summary-value",html:w[e].toString()}).inject(s)}));(new Date).toLocaleString(r.get("widget").lang);var D=(new Date).toLocaleString(r.get("widget").lang),T=t.createElement("div",{class:"issue-list-print-summary-sub-ctn issue-list-print-summary-date-ctn"});T.inject(b),t.createElement("div",{class:"issue-list-print-summary-value issue-list-print-summary-date-value",html:d.formatDate(D)}).inject(T);var E=t.createElement("div",{class:"issue-list-print-table"});E.inject(I);var A=t.createElement("table");A.inject(E);var _=t.createElement("tr",{class:"table-header-row"});_.inject(A),t.createElement("tr",{class:"table-spacer-row"}).inject(A),i.forEach((function(e){var n="";switch(e.dataIndex){case"ds6w:reportedAgainst":n="wux-ui-3ds wux-ui-3ds-location";break;case"ds6w:resolvedBy":n="fonticon fonticon-resolved-by";break;case"ds6w:resolvedItems":n="wux-ui-3ds wux-ui-3ds-markup-review";break;case"ds6w:contexts":n="wux-ui-3ds wux-ui-3ds-3d-object";break;default:n=""}var s=t.createElement("th",{class:"table-headercol",html:t.String.escapeHTML(e.text)});(s.setStyle("max-width",e.width),n.length)&&(s.innerHTML="",t.createElement("span",{class:"issue-list-cell-header-icon "+n,title:t.String.escapeHTML(u.columns[e.dataIndex+"Column"])}).inject(s));s.inject(_)}));for(var M=0;M<o.length;M++){var N=o[M],x=t.createElement("tr",{class:"table-root-row"});x.inject(A);for(var O={timePrecision:"min"},P=0;P<i.length;P++){var V=i[P],k=t.createElement("th",{class:"table-root-col"}),L=t.createElement("div",{});if("tree"===V.dataIndex){var R=d.getIconByState(N.options.state,N.options.type,N.options.iconurl);t.createElement("img",{class:"tree-icon",src:R}).inject(L);var U=t.createElement("span",{class:"tree-title"});U.innerHTML=t.String.escapeHTML(N.options.title),U.inject(L)}else if(-1!==["ds6w:description"].indexOf(V.dataIndex))L.innerHTML=t.String.escapeHTML(N.options.grid[V.dataIndex]);else if(-1!==["Approvals"].indexOf(V.dataIndex)){var F=N.options.grid[V.dataIndex]?u.approvals.approvalOn:u.approvals.approvalOff;L.innerHTML=t.String.escapeHTML(F)}else if(-1!==["ds6w:state"].indexOf(V.dataIndex)){t.createElement("span",{class:"issue-list-cell-state "+N.options.state,html:t.createElement("span",{html:t.String.escapeHTML(N.options.grid[V.dataIndex]),class:" cell-state-content"})}).inject(L)}else if(-1!==["ds6w:assignees"].indexOf(V.dataIndex)){N.options.grid[V.dataIndex].split(",").forEach((e=>{var n=t.createElement("div",{html:e});L.appendChild(n)}))}else-1!==["ds6w:validation"].indexOf(V.dataIndex)?void 0!==N.options.validation?L.innerHTML=t.String.escapeHTML(N.options.validation):L.innerHTML="":void 0!==N.options.grid[V.dataIndex]?"datetime"==V.typeRepresentation?L.innerHTML=t.String.escapeHTML(d.formatDate(N.options.grid[V.dataIndex],O)):"date"==V.typeRepresentation?L.innerHTML=t.String.escapeHTML(d.formatDate(N.options.grid[V.dataIndex])):L.innerHTML=t.String.escapeHTML(N.options.grid[V.dataIndex]):L.innerHTML="";L.inject(k),k.setStyle("max-width",V.width),-1!==["ds6w:reportedAgainst","ds6w:resolvedBy","ds6w:resolvedItems","ds6w:context"].indexOf(V.dataIndex)&&k.setStyle("text-align","center"),k.inject(x)}}return c.end(m+" _createHTMLTextTable"),I},_isPrintWindowOpened:function(){var e=this;return void 0!==e._printWindow&&null!==e._printWindow&&!1===e._printWindow.closed},_print:function(t){var n=this;return c.start(m+" _print"),new e((function(e,s){n._isPrintWindowOpened()&&n._printWindow.close(),n._printWindow=window.open("/","PrintWindow","width=1024, height=768"),void 0===n._printWindow&&(e(),c.end(m+" _print")),setTimeout((()=>{n._onPrintWindowLoaded(t,e,s)}),1300)}))},_onPrintWindowLoaded:function(n,s,i){var o=this;o._printWindow.document.write('<html><head></head><body class="isu-print-body"></body></html>'),o._printWindow.document.close();var a=[],r=function(t){return new e((function(e){t.addEventListener("load",(function(){e()}),!1)}))};for(var l in document.styleSheets)if(document.styleSheets.hasOwnProperty(l)){var d=t.createElement("link",{rel:"stylesheet",type:"text/css",media:"all",href:document.styleSheets[l].href});null!==document.styleSheets[l].href&&a.push(r(d)),o._printWindow.document.head.appendChild(d)}e.all(a).then((function(){o._printWindow.document.body.innerHTML=n.outerHTML;var e=o._printWindow.document.querySelectorAll("img");c.end(m+" _print");var t=setInterval((function(){for(var n=!0,i=0;i<e.length;i++)!0!==e[i].complete&&(n=!1);!0===n&&(clearInterval(t),s(),setTimeout((function(){o._printWindow.focus(),o._printWindow.print(),o._printWindow.close()}),0))}),f)}),(function(e){i(e),c.end(m+" _print")}))},_isExportable:function(e){return!t.is(e.export,"object")||!1!==e.export.value}}})),define("DS/IssueManagement/components/footer/Status",["UWA/Class/View","UWA/Core","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Button","DS/UIKIT/Mask","DS/UIKIT/Tooltip","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Controls/Loader","DS/Controls/TooltipModel","DS/Controls/Popup","DS/ControlsEx/LoadingPanel","DS/IssueComponents/helper/Helper","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement","text!DS/IssueCommon/assets/Settings.json"],(function(e,t,n,s,i,o,a,r,l,c,d,u,p,m,g,f,h){"use strict";var v="Issue",I=1e3;return e.extend({name:"DS/IssueManagement/components/footer/Status",tagName:"div",className:"status-container",_logger:null,isVisible:!0,_pin:null,setup:function(e){var t=this;g.start(t.name+" setup"),t._parent(e),t.isVisible=!0,t.loading.init(),g.end(t.name+" setup")},render:function(){var e=this;JSON.parse(h);return g.start(e.name+" render"),e.helper().inject(e.container),e.loadedIssues().inject(e.container),e.selectedIssues().inject(e.container),e.empty().inject(e.container),e.loading.container.inject(e.container),g.end(e.name+" render"),e},refresh:function(){this.destroy(),this.render()},destroy:function(){this.container.empty()},loading:{container:t.createElement("div",{class:"im-status-loader"}),clickCallback:null,isVisible:!1,_loader:new l({text:"Loading...",fadeDuration:500,showButtonFlag:!1}),init:function(){this._loader.inject(this.container)},start:function(e){var n=this;n._loader.height=18,n._loader._loaderCounter=0,n._loader.elements.progressBar.infiniteFlag=!0,n._loader.elements.progressBar._applyInfiniteFlag(),t.is(e,"object")&&n.container.toggleClassName("is-clickable",e.isClickable),n._loader.on(),n.isVisible=!0},update:function(e){this._loader.text=e},stop:function(e){var t=this;t._loader.text=e,t._loader._loaderCounter=0,t._loader.elements.progressBar.infiniteFlag=!1,t._loader.elements.progressBar.value=100,t._loader.elements.progressBar._applyInfiniteFlag()},hide:function(e){var n=this;n.isVisible&&(n._loader.text=e,setTimeout((function(){new t.Fx(n._loader.elements.container,{duration:I,transition:"linear",events:{onStart:function(){},onComplete:function(){t.is(n._loader,"object")&&n._loader.off(),n.isVisible=!1}}}).start({opacity:[1,0]})}),0),n.container.toggleClassName("is-clickable",!1))},setClickListener:function(e){var n=this;t.is(n.clickCallback,"function")&&n.container.removeEventListener("click",n.clickCallback),n.clickCallback=e,n.container.addEventListener("click",n.clickCallback)}},helper:function(){var e=m.get("widget")||window.widget,n=t.createElement("span",{class:"issue-status-left-helper fonticon fonticon-help-circled"}),s=new a({className:"helper-tooltip",position:"top",target:n,body:f.tooltips.helper});return n.addEventListener("click",(function(){s.hide(),p.show(e.body)})),n},info:function(){var e=this,n=t.createElement("span",{class:"issue-status-right fonticon fonticon-info"});return new a({className:"im-status-tooltip",trigger:"touch",target:n,events:{onShow:function(){g.start(e.name+" render status");for(var n=m.get("component"),s=n.getSelectedNodes(),i=n.getTreeDocument().getRoots(!1).length,o=0,a=0;a<s.length;a++)s[a].options.baseType===v&&(o+=1);var r=t.createElement("div",{class:"im-status-msg"});t.createElement("div",{class:"im-status-msg-issues",text:f.replace(f.titles.issues,{number:i})}).inject(r),t.createElement("div",{class:"im-status-msg-selection",text:f.replace(f.tooltips.selectedIssues,{number:o})}).inject(r),this.setBody(r),g.end(e.name+" render status")}}}),n},empty:function(){return t.createElement("div",{class:"im-status-empty"})},loadedIssues:function(){var e=this,n=t.createElement("div",{class:"im-status-loaded"}),s=f.replace(f.loadedIssues,{number:0});e.loadedDiv=t.createElement("div",{text:s,class:"im-status-displayed"});var i=t.createElement("div",{text:f.loadRemaining,class:"im-status-loadall"});i.addEventListener("click",(function(){void 0===widget.getValue("showDialog")||widget.getValue("showDialog")?e.showConfirmationDialog():(e.popup.visibleFlag=!1,e.loadAllIssues())})),e.popup=new d({target:e.loadedDiv,trigger:"click",position:"top"}),e.popup.setBody(i),e.loadedDiv.addEventListener("click",(function(t){e.popup.visibleFlag=!0}));var o=f.replace(f.totalIssues,{number:0});return e.totalDiv=t.createElement("div",{text:o}),e.loadedDiv.inject(n),e.totalDiv.inject(n),e.totalWarning=t.createElement("span",{class:"fonticon fonticon-info"}),e.totalWarning.tooltipInfos=new c({shortHelp:f.totalIssuesWarning}),e.totalWarning.inject(n),n},showConfirmationDialog:function(){var e=this,t=new n({}),o=document.getElementsByClassName("issue-list")[0];t.inject(o);var a=new s({immersiveFrame:t,title:f.loadRemaining,content:f.loadAllConfirmation,activeFlag:!1,modelFlag:!0,width:500,buttons:{Cancel:new i({domId:"loallAllNo",label:f.cancel,onClick:function(e){t.destroy(),a.checkboxInfos.checkFlag&&widget.setValue("showDialog",!1)}}),Ok:new i({domId:"loadAllYes",label:f.loadIssues,onClick:function(n){t.destroy(),e.loadAllIssues(),a.checkboxInfos.checkFlag&&widget.setValue("showDialog",!1)}})},checkboxInfos:{label:f.dialogShowAgain}});a.addEventListener("close",(function(e){t&&t.destroy(),a.checkboxInfos.checkFlag&&widget.setValue("showDialog",!1)}))},loadAllIssues:function(){var e=m.get("component"),t=new u({shape:"linear",showButtonsFlag:"closeButtonOnly",modalFlag:!0,width:"15%",info:f.loadingIssues}).inject(widget.body);t.on();var n=e.loadAllIssues();t.addEventListener("stop",(function(){n.cancel(),t.off()})),n.then((function(){t.off()}))},selectedIssues:function(){var e=f.replace(f.selectedIssues,{number:0});return this.selectedDiv=t.createElement("div",{class:"im-status-selected",text:e}),this.selectedDiv},utils:{}})})),define("DS/IssueManagement/utils/customization/ComboSelector",["i18n!DS/IssueManagement/assets/nls/IssueManagement_list","UWA/Core","UWA/Controls/Abstract","UWA/Class/Events","DS/Menu/Menu"],(function(e,t,n,s,i){"use strict";return n.extend(s,{init:function(e){this._parent(e)}})})),define("DS/IssueManagement/commands/SelectAllRelatedObjects",["UWA/Class","DS/ApplicationFrame/Command"],(function(e,t){"use strict";return e.extend(t,{name:"DS/IssueManagement/commands/SelectAllRelatedObjects",execute:function(){var e=this;require(["UWA/Class/Promise","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance"],(function(t,n,s){var i=n.get("component").getTreeDocument();s.start(e.name+" execute"),i.withBroadcastSelect(new t((function(t){i.withTransactionUpdate((function(){i.unselectAll();for(var n=i.getRoots(!1),o=0;o<n.length;o++)n[o].processDescendants({processNode:function(e){e.nodeModel.select()}});s.end(e.name+" execute"),t()}))})))}))}})})),define("DS/IssueManagement/commands/Print",["UWA/Class","DS/ApplicationFrame/Command"],(function(e,t){"use strict";return e.extend(t,{init:function(e){this._parent(e,{isAsynchronous:!0})},execute:function(){var e=this;require(["DS/IssueManagement/export/Print","DS/IssueServices/Contexts"],(function(t,n){t.exportation({context:n.get("component")}).then(e.end.bind(e),e.end.bind(e))}))}})})),define("DS/IssueManagement/views/facets/Classification",["UWA/Class/Promise","UWA/Core","UWA/Class/View","UWA/Class/Model","DS/ClassificationsFacet/ClassificationFacet","DS/IssueCommon/facets/Placeholder","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","DS/PADUtils/views/PADAlert"],(function(e,t,n,s,i,o,a,r){"use strict";return n.extend({name:"DS/IssueCommon/views/Classification",tag:"div",className:"Classification-view fade-in-element",defaultOptions:{physicalIds:[]},classification:null,elements:{target:null},setup:function(e){var t=this;r.start(t.name+" setup"),t._parent(e),t.elements.target=UWA.createElement("div",{class:"classification-content"}),t.container.setContent(t.elements.target),t.classification=null,r.end(t.name+" setup")},render:function(){var e=this;if(!1===e.isValidSelection())return e.elements.target.hide(),e.placeholder.show(e.container),setTimeout((function(){e.dispatchEvent("onReady",{})}),0),e;e.placeholder.hide(e.container),e.elements.target.show(),r.start(e.name+" render");var t=e.getOption("physicalIds");return e.renderClassification(t[0]),r.end(e.name+" render"),e},renderClassification:function(e){var t=this,n="ctx::"+decodeURIComponent(a.getSecurityContext()),o=new s({source:"3DSpace",tenant:a.getTenant(),objectId:e});t.classification=new i({isBookmark:!0,isLibrary:!0,isExportControl:!1,isInformationPanel:!0,isExternal:!0,securityContext:n}),t.classification.elements.container.inject(t.elements.target),t.classification.updateFacetExternal(o)},refresh:function(t){var n=this;if(n.setOption("physicalIds",t),!1===n.isValidSelection())n.elements.target.hide(),n.placeholder.show(n.container);else{if(n.placeholder.hide(n.container),n.elements.target.show(),null==n.classification||null==n.classification)return n.renderClassification(t[0]),e.resolve();var i=new s({source:"3DSpace",tenant:a.getTenant(),objectId:t[0]});n.classification.updateFacetExternal(i)}return e.resolve()},destroy:function(){var e=this;e.stopListening(e,"onReady"),null!==e.classification&&(e.classification.destroy(),e.classification=null),e.container.empty()},isValidSelection:function(){var e=this.getOption("physicalIds");return Array.isArray(e)&&1===e.length},placeholder:{_view:new o,show:function(e){this._view.render("classification").inject(e),this._view.show()},hide:function(){this._view.hide(),this._view.empty()}}})})),define("DS/IssueManagement/commands/ExportZIP",["UWA/Class","DS/ApplicationFrame/Command"],(function(e,t){"use strict";return e.extend(t,{init:function(e){this._parent(e,{isAsynchronous:!0})},execute:function(){var e=this;require(["DS/IssueManagement/export/ExportZIP"],(function(t){t.exportation().finally((function(){e.end()}))}))}})})),define("DS/IssueManagement/commands/SwitchView",["UWA/Class","DS/ApplicationFrame/Command"],(function(e,t){"use strict";return e.extend(t,{name:"DS/IssueManagement/commands/SwitchView",begin:function(e){this.execute(e)},execute:function(e){var t=this;require(["UWA/Class/Promise","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance"],(function(n,s,i){i.start(t.name+" execute"),s.get("component").switchView(e),i.end(t.name+" execute")}))}})})),define("DS/IssueManagement/commands/ColumnCustomization",["UWA/Class","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","DS/IssueServices/services/IssueServices","DS/IssueComponents/utils/Utils","DS/ApplicationFrame/Command","DS/UIKIT/Mask"],(function(e,t,n,s,i,o,a){"use strict";return e.extend(o,{_padCustomizeView:null,init:function(e){this._isDisplayed=!1,this._parent(e)},execute:async function(){var e=this,n=t.get("component"),s=t.get("widget")||window.widget;a.mask(s.body),await new Promise((e=>setTimeout(e,100))),e.list=n.getTreeListView();const o=e.list.document.getRoots();try{await i.updateClassificationsAndInterfaces(e.list.document,o)}catch(e){}i.launchCustomViewManager(e.list)}})})),define("DS/IssueManagement/components/welcomePanel/view/GlobalConfig",[],(function(){"use strict";var e={LEFT_PANEL_SIZE_EXPANDED:300,LEFT_PANEL_SIZE_COLLAPSED:40,MOBILE_CUTOFF:500,TABLET_CUTOFF:768,MOBILE_BREAKPOINT:500,PATH_HOME:"/home",PATH_LANDING_PAGE:"LandingPage",PATH_IM_DETAILS:"IssueManagement",PATH_IT_DETAILS:"IssueTemplate",PATH_CREATE_IM_DETAILS:"CreateIssue",PATH_CREATE_IT_DETAILS:"CreateTemplate",PATH_WHATS_NEW_DETAILS:"WhatsNew",ROUTE_HOME:"home",ROUTE_LANDING_PAGE:"home.LandingPage",ROUTE_IM_DETAILS:"home.IMDetails",ROUTE_IT_DETAILS:"home.ITDetails",ROUTE_CREATE_IM_DETAILS:"home.CreateIMDetails",ROUTE_CREATE_IT_DETAILS:"home.CreateITDetails",ROUTE_WHATS_NEW_DETAILS:"home.WhatsNew"};return e})),define("DS/IssueManagement/views/facets/Relations",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/ENORIPE_Relations/RelationsTabSettings","DS/ENORIPE_Relations/views/RelationsTab","UWA/Class/Model","DS/IssueServices/Contexts","DS/IssueCommon/facets/Placeholder","DS/IssueServices/services/PlatformServices","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","DS/IssueCommon/utils/Utils","css!DS/IssueCommon/IssueCommon.css"],(function(e,t,n,s,i,o,a,r,l,c,d,u){"use strict";return t.extend({name:"DS/IssueManagement/views/facets/Relations",tag:"div",className:"relations-view fade-in-element",defaultOptions:{physicalIds:[]},relations:null,elements:{target:null},setup:function(e){var t=this;d.start(t.name+" setup"),t._parent(e),t.elements.target=n.createElement("div",{class:"relations-content"}),t.container.setContent(t.elements.target),t.relations=null,d.end(t.name+" setup")},render:function(){var e=this;if(!1===e.isValidSelection())return e.elements.target.hide(),e.placeholder.show(e.container),setTimeout((function(){e.dispatchEvent("onReady",{})}),0),e;e.placeholder.hide(e.container),e.elements.target.show(),d.start(e.name+" render");var t=e.getOption("physicalIds");return e.renderRelations(t[0]),d.end(e.name+" render"),e},renderRelations:function(e){var t=this,n="ctx::"+decodeURIComponent(l.getSecurityContext()),a={isDraggable:!0,isProfilesVisible:!0,appID:"ENORIPE_ISU",isExternal:!0,securityContext:n},r={getPlatformID:function(){return l.getTenant()},getServiceID:function(){return"3DSpace"}},c=new o({source:"3DSpace",tenant:l.getTenant(),objectId:e});return s.isAvailable(r,a).then((function(e){"object"==typeof e&&e.isAvailable&&void 0!==e.facetInfo&&(null!=t.relations&&null!=t.relations||(t.relations=new i,t.relations.elements.container.inject(t.elements.target)),t.relations.updateFacetOptions({securityContext:n}).then((function(){t.relations.updateFacetExternal(c)})))}))},refresh:function(t){var n=this;if(n.setOption("physicalIds",t),!1===n.isValidSelection())n.elements.target.hide(),n.placeholder.show(n.container);else{if(n.placeholder.hide(n.container),n.elements.target.show(),null==n.relations||null==n.relations)return n.renderRelations(t[0]);var s=new o({source:"3DSpace",tenant:l.getTenant(),objectId:t[0]});n.relations.updateFacetExternal(s)}return e.resolve()},destroy:function(){var e=this;e.stopListening(e,"onReady"),null!==e.relations&&(e.relations.destroy(),e.relations=null),e.container.empty()},isValidSelection:function(){var e=this.getOption("physicalIds");return Array.isArray(e)&&1===e.length},placeholder:{_view:new r,show:function(e){this._view.render("relations").inject(e),this._view.show()},hide:function(){this._view.hide(),this._view.empty()}}})})),define("DS/IssueManagement/commands/Subscription",["UWA/Class","DS/ApplicationFrame/Command","DS/IssueServices/Contexts","DS/IssueCommon/utils/Utils"],(function(e,t,n,s){"use strict";return e.extend(t,{name:"DS/IssueManagement/commands/Subscription",begin:function(e){this.execute(e)},execute:function(e){var t=n.get("component").getSelectedNodes(),i={getSelectedNodes:()=>t},o="";switch(e){case"subscribe":require(["DS/ENOSubscriptionMgmt/Commands/Subscribe"],(function(e){new e({ID:"SubscribeCmdHdr",context:i,objIDType:"modelID"}).execute()})),o="Subscribe";break;case"unSubscribe":require(["DS/ENOSubscriptionMgmt/Commands/UnSubscribe"],(function(e){new e({ID:"SubscribeCmdHdr",context:i,objIDType:"modelID"}).execute()})),o="UnSubscribe";break;case"editSubscription":require(["DS/ENOSubscriptionMgmt/Commands/EditSubscribe"],(function(e){new e({ID:"MySubscriptionsCmdHdr",context:i,objIDType:"modelID"}).execute()})),o="EditSubscriptions";break;case"mySubscription":require(["DS/ENOSubscriptionMgmt/Commands/MySubscriptions"],(function(e){new e({ID:"MySubscriptionsCmdHdr",context:i,objIDType:"modelID"}).execute()})),o="MySubscriptions"}try{var a=n.get("component").getCurrentView();s.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:a,pd3:"SummaryToolbar",pd4:o,pd5:"Issue/"+a+"/SummaryToolbar/"+o}})}catch(e){}}})})),define("DS/IssueManagement/utils/Synchronizer",["UWA/Class/Listener","UWA/Class/Promise","UWA/Controls/Abstract","UWA/Core","DS/IssueServices/utils/Performance","DS/IssueServices/Contexts","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueCommon/assets/nls/IssueCommon","css!DS/IssueManagement/IssueManagement.css"],(function(e,t,n,s,i,o){"use strict";var a=1,r=0,l=n.extend(e,{name:"DS/IssueManagement/utils/Synchronizer",list:null,kanban:null,KANBAN_VIEW:"KanbanView",_selectEventFromKanbanAcked:-1,_selectEventFromListAcked:-1,init:function(e){var t=this;t._parent(e),t.list=e.list,t.kanban=e.kanban,t._selectEventFromKanbanAcked=-1,t._selectEventFromListAcked=-1},destroy:function(){var e=this;e.list=null,e.kanban=null,e._selectEventFromKanbanAcked=-1,e._selectEventFromListAcked=-1},start:function(){var e=this;return new t((function(t){e._subscribeToList(),e._subscribeToKanban(),t()}))},_refreshKanban:function(){var e=this;o.get("component").getCurrentView()===e.KANBAN_VIEW?e.kanban.refresh():e.list.document.pushBroadcastSelect()},_selectInKanban:function(){var e=this;if(0!==e._selectEventFromListAcked){e._selectEventFromKanbanAcked=0,i.start(e.name+" _selectInKanban");for(var t=e.list.document.getSelectedNodes().map((function(e){return e.getID()})),n=Object.keys(e.kanban._issuesNodesMapping),s={},o=0;o<n.length;o++){var a=n[o];if(-1!==t.indexOf(a))for(var r=0;r<e.kanban._issuesNodesMapping[a].length;r++){var l=e.kanban._issuesNodesMapping[a][r];s.hasOwnProperty(l.getTreeDocument()._id)||(s[l.getTreeDocument()._id]={tree:l.getTreeDocument(),toSelect:[],toUnselect:[]}),s[l.getTreeDocument()._id].toSelect.push(l)}else for(var c=0;c<e.kanban._issuesNodesMapping[a].length;c++){var d=e.kanban._issuesNodesMapping[a][c];s.hasOwnProperty(d.getTreeDocument()._id)||(s[d.getTreeDocument()._id]={tree:d.getTreeDocument(),toSelect:[],toUnselect:[]}),s[d.getTreeDocument()._id].toUnselect.push(d)}}var u=Object.keys(s);e.kanban.preventUnselectColumns=!0;for(var p=0;p<u.length;p++){var m=s[u[p]];e.kanban.currentView===m.tree._currentKanbanView&&e.kanban._preventCurrentViewSelection||(m.toSelect.length>0||m.tree.getSelectedNodes().length>0)&&m.tree.withTransactionUpdate((function(){for(var e=0;e<m.toSelect.length;e++)m.toSelect[e].select();for(var t=0;t<m.toUnselect.length;t++)m.toUnselect[t].unselect()}))}e.list.dispatchEvent("onSelectAcked"),e.kanban.dispatchEvent("onSelectAcked"),i.end(e.name+" _selectInKanban")}else e._selectEventFromListAcked=1},_selectInList:function(){var e=this;if(0!==e._selectEventFromKanbanAcked){e._selectEventFromListAcked=0;var t=e.kanban.getSelectedIssues();e.list.document.prepareBroadcastSelect(),e.list.document.withTransactionUpdate((function(){e.list.document.unselectAll();for(var n=Object.keys(e.kanban._issuesNodesMapping),s=0;s<n.length;s++){var i=n[s];-1===t.indexOf(i)||e.list.document.getNodesById(i)[r].select()}})),e.list.document.pushBroadcastSelect(),e.list.dispatchEvent("onSelectAcked"),e.kanban.dispatchEvent("onSelectAcked")}else e._selectEventFromKanbanAcked=1},_subscribeToList:function(){var e=this,t=e.utils.debounce(e._refreshKanban.bind(e),a);e.list.document.getModelEvents().subscribe({event:"setPathTags"},t),e.listenTo(o.get("component"),"setPathTags",t),e.list.document.getModelEvents().subscribe({event:"onRootsAdded"},t),e.listenTo(o.get("component"),"onRootsAdded",t),e.list.document.addEventListener("nodeModelUpdate",t);var n=e.utils.debounce(e._selectInKanban.bind(e),a);e.list.document.getModelEvents().subscribe({event:"select"},n),e.list.document.getModelEvents().subscribe({event:"unselect"},n)},_subscribeToKanban:function(){var e=this,t=e.utils.debounce(e._selectInList.bind(e),a);e.listenTo(e.kanban,"onSelect",t)},utils:{_debounceTimeouts:[],debounce:function(e,t,n){var s,i=this;return function(){var o=this,a=arguments,r=n&&!s;clearTimeout(s);var l=i._debounceTimeouts.indexOf(s);-1!==l&&i._debounceTimeouts.splice(l,1),s=setTimeout((function(){s=null,n||e.apply(o,a)}),t),i._debounceTimeouts.push(s),r&&e.apply(o,a)}}}});return l})),define("DS/IssueManagement/export/Utils",["UWA/Class/Promise","UWA/Core","DS/UIKIT/Input/Button","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/WebappsUtils/WebappsUtils","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","i18n!DS/IssueManagement/assets/nls/IssueManagement"],(function(e,t,n,s,i,o,a,r,l,c){"use strict";return{confirmation:function(i){var o=r.get("widget")||window.widget;return new e((function(e){var a=t.createElement("div",{class:"confirmation-export-issues-content",html:i.content}),r=new s({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!0,resizable:!0,visible:!0,className:"confirmation-export-issues-dialog",title:i.title,header:null,body:a,footer:[new n({value:c.export.confirmation.confirm,className:"primary confirmation-export-issues-dialog-confirm",events:{onClick:function(){r.destroy(),e(!0)}}}),new n({value:c.export.confirmation.cancel,className:"default confirmation-export-issues-dialog-cancel",events:{onClick:function(){r.destroy(),e(!1)}}})],events:{onClose:function(){r.destroy(),e(!1)}}}).inject(o.body);r.show()}))},getIssuesToExport:function(){var e=r.get("component"),t=e.getSelectedNodes();return 0===t.length&&(t=e.getTreeDocument().getRoots(!1)),t},notifications:{exporting:function(){o.displayNotification({msg:c.export.exporting,eventID:"info"})},nothing:function(){o.displayNotification({msg:c.export.nothingToExport,eventID:"error"})},failure:function(e){o.displayNotification({msg:t.is(e,"string")?e:c.export.failure,eventID:"error"})}},download:{csv:function(e,t){var n=document.createElement("a"),s=n.href=URL.createObjectURL(new Blob(["\ufeff"+e],{encoding:"UTF-8",type:"text/csv;charset=UTF-8"}));n.setAttribute("download",t),document.body.appendChild(n),n.click(),setTimeout((function(){document.body.removeChild(n),URL.revokeObjectURL(s)}),0)}}}})),define("DS/IssueManagement/components/welcomePanel/router/RouterUtils",["DS/Router5/js/Router5","DS/Router5/js/Router5BrowserPlugin","DS/Router5/js/Router5ListenersPlugin","DS/Router5/js/Router5Helpers"],(function(e,t,n,s){"use strict";return{createRouter:function(s,i,o,a){var r=e.createRouter(s,i);return o&&r.usePlugin(n()),a&&r.usePlugin(t({useHash:!1})),r},listenToRouterStateChanges:function(e){e.addListener((function(t,n){var i=s.transitionPath(t,n);i.toDeactivate.forEach((function(s){if(void 0!==e.routerMethods[s]){var i=e.routerMethods[s].deactivate;void 0!==i&&i(t,n)}})),i.toActivate.forEach((function(s){if(void 0!==e.routerMethods[s]){var i=e.routerMethods[s].activate;void 0!==i&&i(t,n)}}))}))}}})),define("DS/IssueManagement/utils/DragAndDrop",["UWA/Core","UWA/Class/Promise","DS/UIKIT/Input/Button","DS/UIKIT/Input/Toggle","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/PlatformAPI/PlatformAPI","DS/IssueAttachmentManager/components/Collection","DS/IssueAttachmentManager/components/Item","DS/IssueAttachmentManager/services/AttachmentServices","DS/IssueAttachmentManager/views/UploadDialog","DS/IssueCommon/utils/Utils","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","DS/IssueServices/utils/Views","DS/DataDragAndDrop/DataDragAndDrop","DS/IssueComponents/utils/Utils","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueAttachmentManager/assets/nls/IssueAttachmentManager"],(function(e,t,n,s,i,o,a,r,l,c,d,u,p,m,g,f,h,v,I,b,y,w,S,C){"use strict";var D="Issue",T="ISU_TYPE_NLS",E=r.getLogger("DS/IssueManagement/utils/DragAndDrop"),A={setDroppableData:function(e,t){var n=f.get("widget")||window.widget,s=w.buildDnDPayload({items:[]});null!=t&&(s.data.options=t);for(var i=0;i<e.length;i++){var o=e[i];if(o.options.baseType===D){var a={};["contexts","reportedAgainst","resolvedBy","resolvedItems"].forEach((function(e){a[e]=[];for(var t=0;t<o.options[e].length;t++){var s={envId:v.getTenant(),serviceId:o.options[e][t].serviceId?o.options[e][t].serviceId:"3DSpace",contextId:n.id,objectId:o.options[e][t].pid,i3dx:o.options[e][t].physicalId.includes("i3dx")?o.options[e][t].physicalId:"",objectType:o.options[e][t].objectType,displayName:o.options[e][t].name,displayType:o.options[e][t].objectType,isIssue:!0};"reportedAgainst"==e&&(s.path=o.options[e][t].path.join()),a[e].push(s)}})),s.data.items.push({envId:v.getTenant(),serviceId:o.options.serviceId?o.options.serviceId:"3DSpace",contextId:n.id,objectId:o.options.physicalId,objectType:o.options.type,displayName:o.options.title+" ("+o.options.name+")",displayType:o.options.type,isIssue:!0,relatedObjects:a})}else{var r=o.options.physicalId.split(","),l=(r[r.length-1],{envId:v.getTenant(),serviceId:o.options.serviceId?o.options.serviceId:"3DSpace",contextId:n.id,objectId:o.options.pid,i3dx:o.options.id.includes("i3dx")?o.options.id:"",objectType:o.options.type,displayName:o.options.display,displayType:o.options.type});s.data.items.push(l)}}var c="text/plain";try{(window.navigator.userAgent.indexOf("MSIE ")>0||navigator.userAgent.match(/Trident.*rv\:11\./))&&(c="text")}catch(e){}return{type:c,data:JSON.stringify(s)}},getDroppableData:function(t){for(var n=null,s=e.is(t.dataTransfer.types.indexOf,"function")?"indexOf":"contains",i="",o=["text/searchitems","text/plain","Text","Files"],a=0;a<o.length&&""===i;a++){var r=t.dataTransfer.types[s](o[a]);(e.is(r,"number")&&r>=0||e.is(r,"boolean")&&!0===r)&&(i=o[a])}var l={};if("Files"===i)n={files:t.dataTransfer.files};else if(""!==i){l=t.dataTransfer.getData(i);try{n=JSON.parse(l)}catch(e){}}return n},related:{whereToAddRelatedObjects:function(i,r,l){var c=this,d=f.get("widget")||window.widget,u=null;u=new s({className:"primary contexts-chooser",name:"typeChooser",value:"contexts",label:"",events:{onChange:function(){I.setDisabled(!0),b.setDisabled(!0)}}});var p=new s({className:"primary reported-against-chooser",name:"typeChooser",value:"reportedAgainst",label:"",checked:!0,events:{onChange:function(e){I.setDisabled(!1),0==T&&b.disable()}}}),m=new s({className:"primary resolved-by-chooser",name:"typeChooser",value:"resolvedBy",label:"",events:{onChange:function(){I.setDisabled(!0),b.setDisabled(!0)}}}),h=new s({className:"primary resolved-items-chooser",name:"typeChooser",value:"resolvedItems",label:"",events:{onChange:function(){I.setDisabled(!0),b.setDisabled(!0)}}}),v=new s({className:"primary attachments-chooser",name:"typeChooser",value:"attachments",label:"",events:{onChange:function(){I.setDisabled(!0),b.setDisabled(!0)}}}),I=new s({className:"primary where-to-drop-sub-icon isuReferenceInstanceChooser",name:"pathChooser",value:"reference",checked:!0,label:"",events:{onChange:function(){}}});I.elements.label.setContent([e.createElement("i",{class:"where-to-drop-reference wux-ui-3ds"}),S.dnd.references]);var b=new s({className:"primary where-to-drop-sub-icon isuReferenceInstanceChooser",name:"pathChooser",value:"instance",label:"",events:{onChange:function(){}}});b.elements.label.setContent([e.createElement("i",{class:"where-to-drop-instance wux-ui-3ds"}),S.dnd.instances]),u.elements.label.setContent([e.createElement("i",{class:"where-to-drop-icon where-to-drop-contexts wux-ui-3ds wux-ui-3ds-3d-object"}),S.columns.contextsColumn]),p.elements.label.setContent([e.createElement("i",{class:"where-to-drop-icon where-to-drop-reported-against wux-ui-3ds wux-ui-3ds-location"}),S.columns.reportedAgainstColumn]),m.elements.label.setContent([e.createElement("i",{class:"where-to-drop-icon where-to-drop-contexts-resolved-by fonticon fonticon-resolved-by"}),S.columns.resolvedByColumn]),h.elements.label.setContent([e.createElement("i",{class:"where-to-drop-icon where-to-drop-resolved-items fonticon fonticon-markup-review"}),S.columns.resolvedItemsColumn]),v.elements.label.setContent([e.createElement("i",{class:"where-to-drop-icon where-to-drop-contexts-attachments fonticon fonticon-attach"}),S.columns.attachmentsColumn]);var y=e.createElement("div",{class:"where-to-drop-main-label",html:S.dnd.whereToDrop});r=A.getDroppableData(l).data.items,g.updateI3DxIds(r);var w=r.map((function(e){return e.i3dx&&""!=e.i3dx?e.i3dx:e.objectId})),C=[];r.map((function(e){e.path&&C.push(e.path.map((function(e){return e.resourceid})))}));var D=[],T=0;C.map((function(e){var t=e.slice(-3);(3==t.length||1==t.length)&&(D.push(t.join()),T++)})),w=w.sort().filter((function(e,t,n){return!t||e!==n[t-1]}));var E=[y];E.push(p),E.push(I),E.push(b),E.push(u),E.push(v),E.push(h),E.push(m);var _=e.createElement("div",{html:E});return 0==T&&b.disable(),new t((function(e,t){var s=new a({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!0,resizable:!0,visible:!0,minHeight:342,className:"drop-objects-issue-dialog",title:S.replace(S.dnd.dialogTitle,{number:w.length,issue:i.title+" ("+i.name+")"}),header:null,body:_,footer:[new n({value:S.dnd.attach,className:"primary drop-objects-issue-dialog-add",events:{onClick:function(){s.destroy();var t=!0===p.isChecked()?p.getValue():!0===m.isChecked()?m.getValue():!0===h.isChecked()?h.getValue():!0===v.isChecked()?v.getValue():u.getValue(),n=[];n="reportedAgainst"==t?I.isChecked()?w:D:w,e({ids:n,type:t,items:r})}}}),new n({value:S.dnd.cancel,className:"default drop-objects-issue-dialog-cancel",events:{onClick:function(){s.destroy(),c.utils&&(c.utils.whereToAddModal=null),t(new Error("The dialog has been closed by the end user"))}}})],events:{onShow:function(){c.utils&&(c.utils.whereToAddModal=s)},onClose:function(){s.destroy(),c.utils&&(c.utils.whereToAddModal=null),t(new Error("The dialog has been closed by the end user"))}}}).inject(d.body);new o({element:_}).inject(s.getBody()),s.show()}))},addRelatedObjects:function(n,s,o){var a=this,r=f.get("widget")||window.widget,c=f.get("component");let d=[];d.push(n.node.options.physicalId),h.issues.retrieve({timestamp:null,data:{objects:d.map((function(e){return{physicalId:e}}))},onComplete:function(e){n.node.options.reportedAgainst=e.results[0].body.reportedAgainst},onFailure:function(e){}}),A.related.whereToAddRelatedObjects.call(a,n,s,o).then((function(s){if(null===s)return t.resolve(null);var o=s.type,d=s.ids,u={};if(i.mask(r.body),u[n.id]={physicalId:n.id},"attachments"===o){var m=n.id,h=d,v=d.map((e=>e)).indexOf(n.id);return-1!=v&&(d.splice(v,1),l.displayNotification({msg:C.notifications.Attach.sameIssueAttached,eventID:"error"}),0===d.length)?(i.unmask(r.body),!1):p.connectDocumentsToParent(d,n.id).then((function(n){if(1===h.length&&1===n.length&&n[n.length-1].response.success)return p.fetch(h).then((function(n){if(e.is(n.results,"array")){var s=n.results.map((function(e){return p.parseFromFetch(e)}));if(1===s.length&&"image"===s[s.length-1].documentType){var i=s[s.length-1];return p.setAsPrimary(i.id,m).then((function(e){var t=JSON.parse(e);i.id===t.documentId&&l.displayNotification({msg:C.notifications.SetAsPrimary.success,eventID:"info"})})).catch((function(e){l.displayNotification({msg:C.notifications.SetAsPrimary.failure,eventID:"error"}),a._logger.error(e)}))}return t.resolve()}throw new Error("Unexpected empty fetch results for setAsPrimary.")})).catch((function(){a._logger.error(new Error("Unexpected fetch error for setAsPrimary."))}));if(1===n.length&&!n[0].response.success&&n[0].response.error.includes("Relationship already exists"))throw new Error("Already attached");if(1===n.length&&!n[0].response.success&&-1!==n[0].response.internalError.indexOf("1500028"))throw new Error("1500028");if(1===n.length&&!n[0].response.success&&-1!==n[0].response.internalError.indexOf("1500029"))throw new Error("MIB");if(n.every((function(e){return!1===e.response.success}))&&n.every((function(e){return-1!==e.response.internalError.indexOf("1500029")})))throw new Error("MIB");return t.resolve()})).then((function(){var e={paths:[[m]],attributes:{}};e.attributes[m]={id:n.id,name:n.name,title:n.title,type:n.type,modifiedAttributes:["attachments"]},c.publishUpdate(e),c.document.refreshNodesById({modified:[n.id]})})).then((function(){i.unmask(r.body),l.displayNotification({msg:S.replace(S.notifications.attachSuccess.attachments,{count:h.length,issue:n.title+" ("+n.name+")"}),eventID:"success"})})).catch((function(e){E.error("Could not add attachment(s): %s",e),i.unmask(r.body),e.message.includes("Already attached")?l.displayNotification({msg:S.dnd.alreadyAttached,eventID:"info"}):e.message.includes("MIB")?l.displayNotification({msg:C.attachmentNotSupported,eventID:"error"}):e.message.includes("1500028")?g.displayErrorMessage(g.getErrorMessage("1500028_1"),"error"):l.displayNotification({msg:S.notifications.serverError,eventID:"error"})}))}{if(s.items.forEach((e=>{e.serviceId.includes(":")&&(e.serviceId=e.serviceId.split(":")[0])})),"resolvedBy"==s.type){var I=d.indexOf(n.id);I>-1&&d.splice(I,1),0==d.length&&l.displayNotification({msg:S.resolvedBy.errorSameIssue,eventID:"error"})}var b=[];if(Array.isArray(n.node.options[s.type])?b=b.concat(n.node.options[s.type]):n.node.options[s.type]&&"physicalId"in n.node.options[s.type]&&b.push(n.node.options[s.type]),b.forEach((function(e){var t=d.indexOf(e.physicalId);"reportedAgainst"==s.type&&(t=d.indexOf(e.path.join())),t>-1&&(d.splice(t,1),l.displayNotification({msg:S.dnd.alreadyAttached,eventID:"info"}))})),0===d.length)return i.unmask(r.body),!1;let e=f.get(T),c=Object.keys(e["ds6w:type"]),p=[];s.items.forEach((e=>{c.includes(e.objectType)&&p.push(e.objectId)}));let m=!1;switch(o){case"contexts":let e=d.filter((function(e){if(!p.includes(e))return e})).map((e=>(m=!0,{physicalId:e})));u[n.id].contexts=e.map((e=>{const t=s.items.findIndex((t=>e.physicalId.includes(t.objectId)||e.physicalId.includes(t.i3dx))),{objectType:n}=-1!==t?s.items[t]:{},{serviceId:i}=-1!==t?s.items[t]:{},{envId:o}=-1!==t?s.items[t]:{};return{...e,objectType:n,serviceId:i,envId:o}})),S.notifications.attachSuccessContexts;break;case"reportedAgainst":let t=d.sort().filter((function(e,t,n){if((!t||e!==n[t-1])&&!p.includes(e))return e})).map((function(e){return m=!0,{physicalId:e}}));u[n.id].reportedAgainst=t.map((e=>{const t=s.items.findIndex((t=>e.physicalId.includes(t.objectId)||e.physicalId.includes(t.i3dx))),{objectType:n}=-1!==t?s.items[t]:{},{serviceId:i}=-1!==t?s.items[t]:{},{envId:o}=-1!==t?s.items[t]:{};return{...e,objectType:n,serviceId:i,envId:o}})),S.notifications.attachSuccessAffectedItems;break;case"resolvedBy":let i=d.sort().filter((function(e,t,n){return!t||e!==n[t-1]})).map((function(e){return m=!0,{physicalId:e}}));u[n.id].resolvedBy=i.map((e=>{const t=s.items.findIndex((t=>e.physicalId.includes(t.objectId)||e.physicalId.includes(t.i3dx))),{objectType:n}=-1!==t?s.items[t]:{},{serviceId:i}=-1!==t?s.items[t]:{},{envId:o}=-1!==t?s.items[t]:{};return{...e,objectType:n,serviceId:i,envId:o}})),S.notifications.attachSuccessResolvedBy;break;case"resolvedItems":let o=d.sort().filter((function(e,t,n){if((!t||e!==n[t-1])&&!p.includes(e))return e})).map((function(e){return m=!0,{physicalId:e}}));u[n.id].resolvedItems=o.map((e=>{const t=s.items.findIndex((t=>e.physicalId.includes(t.objectId)||e.physicalId.includes(t.i3dx))),{objectType:n}=-1!==t?s.items[t]:{},{serviceId:i}=-1!==t?s.items[t]:{},{envId:o}=-1!==t?s.items[t]:{};return{...e,objectType:n,serviceId:i,envId:o}})),S.notifications.attachSuccessResolvedItems}if(!m)return i.unmask(r.body),l.displayNotification({msg:S.dnd.partiallyNotSupported,eventID:"error"}),t.resolve(null);if(a.document)return a.document.addContextsOrReportedAgainstOrResolvedByOrResolvedItems(u).then((function(e){i.unmask(r.body);var t=[],s=[],a="",c="",u=0;e.forEach((e=>{e.body.responce.forEach((e=>{t.push(e.warning.slice(1,-1)),s.push(e.error.slice(1,-1)),2==e.warning.length&&2==e.error.length&&u++}))})),t=new Set(t),s=new Set(s),t.forEach((e=>{a+=e})),s.forEach((e=>{c+=e})),a.length>0&&0==u?l.displayNotification({msg:a,eventID:"warning"}):c.length>0&&0==u?l.displayNotification({msg:c,eventID:"error"}):(a.length>0||c.length>0)&&0!=u?l.displayNotification({msg:S.successPartial,eventID:"warning"}):l.displayNotification({msg:S.replace(S.notifications.attachSuccess[o],{count:d.length,issue:n.title+" ("+n.name+")"}),eventID:"success"})}),(function(e){if(E.error("Could not add related object(s): %s",e),i.unmask(r.body),e.error.internal.includes("Verify that your responsibility and the maturity state of the Issue are compatible with this operation.ErrorCode:2005")){var t=g.getErrorMessage("2005");g.displayErrorMessage(t,"error")}else l.displayNotification({msg:e.error.message,eventID:"error"})}))}}))},uploadFilesAsAttachments:function(e,n){for(var s=this,i=f.get("widget")||window.widget,o=f.get("component"),a=function(e){this.set("isCancelable",!0),this.set("request",e)},r=function(e){if(e.lengthComputable){var t=e.loaded/e.total;this.set("requestProgress",t)}},g=function(){this.set("isCancelable",!1),this.set("request",null)},h=e.id,v=new d({id:h}),I=[],b=[],y=0;y<n.length;y++){var w=n[y],D="temporary_"+Math.floor(Date.now())+"_"+y,T=w.type,A={id:D,title:w.name,type:"Document",dispType:C.views.Attachment.types.Document,owner:{firstName:c.getUser().firstName,fullName:c.getUser().firstName.trim()+" "+c.getUser().lastName.trim(),lastName:c.getUser().lastName,user:c.getUser().login},relOwner:{firstName:c.getUser().firstName,fullName:c.getUser().firstName.trim()+" "+c.getUser().lastName.trim(),lastName:c.getUser().lastName,user:c.getUser().login},relOriginated:(new Date).toString()};w.hasOwnProperty("lastModifiedDate")?w.lastModifiedDate instanceof Date?(A.modified=w.lastModifiedDate.toString(),A.created=w.lastModifiedDate.toString()):(A.modified=new Date(w.lastModifiedDate).toString(),A.created=new Date(w.lastModifiedDate).toString()):(A.modified=(new Date).toString(),A.created=(new Date).toString());var _=new u(A);_.set("isProcessing",!0),_.setDocumentTypeByMIME(T),I.push(_);var M=function(e){return{file:{tempId:this.tempId,type:this.type},response:e}},N=p.uploadFile(w,v.id,{onCheckinStart:a.bind(_),onCheckinProgress:r.bind(_),onCheckinComplete:g.bind(_)});b.push(N.then(M.bind({tempId:D,type:T})).catch(M.bind({tempId:D,type:T})))}v.add(I,{sort:!1}),new m({container:i.body,collection:v}).render();var x=t.all(b).then((function(n){for(var i=0,o=0;o<n.length;o++){var a=n[o].file.tempId,r=n[o].file.type,d=n[o].response;if(d.success){i+=1,v.get(a).set("isProcessing",!1),v.remove(a);var m=d.data[0],g=p.parseDocument(m);g.relOwner={firstName:c.getUser().firstName,fullName:c.getUser().firstName.trim()+" "+c.getUser().lastName.trim(),lastName:c.getUser().lastName,user:c.getUser().login},g.relOriginated=(new Date).toString();var f=new u(g);f.set("iconUrl",f.get("thumbnailUrl")),f.setDocumentTypeByMIME(r),v.add(f)}else v.get(a).set("isFailed",!0),v.get(a).set("isProcessing",!1),v.get(a).set("isCancelable",!1),v.get(a).set("request",null),d instanceof Error&&E.error(d)}var I=t.resolve();if(i>0){if(1===v.size()&&"image"===v.at(0).get("documentType")){var b=v.at(0);I=p.setAsPrimary(b.id,h).then((function(e){var t=JSON.parse(e);b.id===t.documentId&&l.displayNotification({msg:C.notifications.SetAsPrimary.success,eventID:"info"})})).catch((function(e){l.displayNotification({msg:C.notifications.SetAsPrimary.failure,eventID:"error"}),s._logger.error(e)}))}l.displayNotification({msg:S.replace(C.notifications.Upload.successIssue,{count:i,issue:e.title+" ("+e.name+")"}),eventID:"success"})}return i!==n.length&&l.displayNotification({msg:S.replace(C.notifications.Upload.failure,{count:n.length-i}),eventID:"error"}),I})).then((function(){var t={paths:[[e.id]],attributes:{}};t.attributes[e.id]={id:e.id,name:e.name,title:e.title,type:e.type,modifiedAttributes:["attachments"]},o.publishUpdate(t),o.document.refreshNodesById({modified:[e.id]})})).catch((function(e){E.error(e)}));return{collection:v,promise:x}}},events:{onDropCell:function(e,t){e.preventDefault();var n=null,s=(n=t.nodeModel.options.baseType!==D?t.nodeModel.getParent():t.nodeModel).options.id,i=n.options.type,o=n.options.name,a=n.options.title,r=A.getDroppableData(e);if(!r)return l.displayNotification({msg:S.dnd.notSupported,eventID:"warning"}),!1;if(r.hasOwnProperty("files")&&r.files instanceof FileList)A.related.uploadFilesAsAttachments.call(this,{node:n,id:s,type:i,name:o,title:a},r.files);else{if(!g.isValid3DXContent(r)||!r.data.items.length)return l.displayNotification({msg:S.dnd.notSupported,eventID:"warning"}),!1;A.related.addRelatedObjects.call(this,{node:n,id:s,type:i,name:o,title:a},r.data.items,e)}return!0}},makeDroppable:function(t,n){var s=this;y.droppable(t,{drop:function(t,i,o){if(o.stopPropagation&&o.stopPropagation(),o.preventDefault&&o.preventDefault(),o.dataTransfer&&o.dataTransfer.dropEffect&&(o.dataTransfer.dropEffect="copy"),e.is(t)&&""!=t){var a=JSON.parse(t);s.ExecuteDrop(a,n)}}})},ExecuteDrop:function(t,n){if(t){var s=t.data.items;e.is(s)&&e.is(s.length)&&s.length>0&&n(s)}},onToolbarDrop:function(e){var t=[],n=[];e.forEach((e=>{e.displayType===D||e.objectType==D?t.push(e.objectId):e.hasOwnProperty("objectType")?n.push(e.objectType):n.push(e.displayType)})),w.getTypesHierarchy(n).then((n=>{e.forEach((e=>{(n[e.objectType]||n[e.displayType])&&(n[e.objectType].hierarchy.includes(D)||n[e.displayType].hierarchy.includes(D))&&t.push(e.objectId)}))})).then((()=>{h.getAdditionalObjectInfo({pidArray:t}).then((e=>{for(var n=0;n<t.length;n++)if("Issue Template"==e.additionObjectInfo[t[n]].policy){const e=t.indexOf(t[n]);e>-1&&(t.splice(e,1),n=-1)}if(t.length>0){widget.setValue("filter",JSON.stringify({session:!0})),widget.setValue("roots",t),widget.dispatchEvent("onRefresh")}else l.displayNotification({msg:S.dnd.notSupported,eventID:"warning"})}))}))}};return A})),define("DS/IssueManagement/commands/InlineCreate",["UWA/Class","DS/ApplicationFrame/CommandCheckHeader","DS/IssueServices/Contexts","DS/IssueCommon/commands/CreateIssuePLMNew"],(function(e,t,n,s){"use strict";var i=300,o=100,a="PLMNewEnablement";return e.extend(t,{view:null,activated:!1,mini:null,init:function(e){var t=this;t._parent(e,{});var s=!1,i=t.onStateChange((function(){if(!0!==s){if(t.activated!==t.getState()){t.activated=t.getState();var e=n.get(a);!0===t.activated?t.execute():e||t.hide()}}else s=!1})),o=t._destroy;t._destroy=function(){t._modelEvents.unsubscribe(i),o.call(t)},s=!0,t.setState(!1,!0)},execute:function(){var e=this;n.get(a)?new s({app:"ISU_MGMT"}).execute():require(["UWA/Core","DS/IssueCommon/utils/Utils","DS/IssueManagement/components/header/InlineCreate","DS/IssueServices/Contexts","DS/Controls/Popup"],(function(t,n,s,a,r){var l=a.get("actionBar");e.mini=null;var c=new s,d=document.getElementById("InlineCreateToolbar").getParent().getParent();e.view=c;var u=d;if(u.getBoundingClientRect().left-l.container.getBoundingClientRect().left<i){e.mini=t.createElement("div",{class:"mini-inline-create",html:[{tag:"div",class:"mini-inline-create-placeholder"},c.render()]}),e.createPopup=new r({target:a.get("actionBar").container.parentElement,trigger:"click",visibleFlag:!0,autoHide:!1,position:"bottom",alignment:"near",offset:{x:0,y:0},mouseRelativePosition:!1,constraint:"none",overlap:!0,arrowBoxFlag:!1,className:"wux-controls-popup-inline-create"});var p=a.get("actionBar").container.parentElement.offsetWidth;e.createPopup.getContent().setStyle("width",p),e.createPopup.setBody(e.mini),setTimeout((function(){c.focus()}),o)}else{var m=function(){setTimeout((function(){c.focus()}),o),u.removeEventListener("transitionend",m,{once:!0})};u.addEventListener("transitionend",m,{once:!0}),c.render().inject(u)}}))},hide:function(){var e=this;require(["DS/IssueServices/Contexts"],(function(t){e.view.destroy(),e.view=null,null!==e.mini&&(e.mini.destroy(),e.mini=null),null!=e.createPopup&&(e.createPopup.destroy(),e.createPopup=null)}))},resize:function(){var e=this,t=n.get("actionBar"),s="";document.getElementById("InlineCreateToolbar")&&(s=document.getElementById("InlineCreateToolbar").getParent().getParent());var i,o=n.get("actionBar").container.getParent();if(s&&(i=s.getElementsByClassName("create-container")[0]),null!=i){if(null!=s&&null!=s&&s.getBoundingClientRect().left-t.container.getBoundingClientRect().left<90){var a=s.getElementsByClassName("create-container")[0];n.get("actionBar").container.getParent().appendChild(a);var r=n.get("actionBar").container.parentElement.offsetWidth;a.setStyle("width",r),e.view&&e.view.dropdown.updatePosition()}}else if(null!=e.createPopup){if(null!=e.createPopup.getContent().getElementsByClassName("create-container")[0]&&null!=s&&null!=s)if(s.getBoundingClientRect().left-t.container.getBoundingClientRect().left<300){r=n.get("actionBar").container.parentElement.offsetWidth;e.createPopup.getContent().setStyle("width",r)}else{a=e.mini.getElementsByClassName("create-container")[0];e.createPopup.getContent().setStyle("width",""),e.createPopup.getContent().setStyle("top",""),e.createPopup.getContent().setStyle("left",""),document.getElementById("InlineCreateToolbar").getParent().getParent().appendChild(a),a.setStyle("width",""),e.mini.destroy(),e.mini=null,e.createPopup.destroy(),e.createPopup=null,e.view&&e.view.dropdown.updatePosition()}}else if(null!=o.getElementsByClassName("create-container")[0])if(s.getBoundingClientRect().left-t.container.getBoundingClientRect().left>300){a=o.getElementsByClassName("create-container")[0];document.getElementById("InlineCreateToolbar").getParent().getParent().appendChild(a),a.setStyle("width",""),e.view&&e.view.dropdown.updatePosition()}else{r=n.get("actionBar").container.parentElement.offsetWidth;(a=o.getElementsByClassName("create-container")[0]).setStyle("width",r)}}})})),define("DS/IssueManagement/components/information/Content",["UWA/Class/View","UWA/Core","UWA/Class/Promise","DS/Controls/TabBar","DS/Controls/TooltipModel","DS/Logger/Logger","DS/WebUAUtils/WebUAUtils","DS/IssueComponents/utils/Utils","DS/IssueCommon/utils/Utils","DS/IssueCommon/commands/CommandsManager","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement"],(function(e,t,n,s,i,o,a,r,l,c,d,u,p){"use strict";var m={CSS:{ELEMENTS:{VIEW_CONTAINER:"im-information-content-view",COMPACT:"compact"},DIMENSIONS:{MIN_WIDTH:420}},WEBHELP:{properties:"ENXIssuUserMap/issue-r-properties-tab.htm",classification:"ENXIssuUserMap/shared-r-classifications.htm",relatedObjects:"ENXIssuUserMap/issue-t-related-objects-manage.htm",attachments:"ENXIssuUserMap/issue-t-attachments.htm",team:"ENXIssuUserMap/issue-t-members.htm",comments:"ENXIssuUserMap/shared-t-Comments.htm",relations:"ENXIssuUserMap/shared-r-Relations.htm",history:"ENXIssuUserMap/issue-t-history.htm"},DEFAULT_VIEW:"properties"},g=e.extend({name:"DS/IssueManagement/components/information/Content",tagName:"div",className:"im-information-content",_logger:null,views:{facets:{},current:"",indexes:{}},physicalIds:[],tabs:null,elements:{view:null},setup:function(e){var t=this;u.start(t.name+" setup"),t._parent(e),t._logger=o.getLogger(t.name),t.views={facets:{},current:m.DEFAULT_VIEW,indexes:{}},t.customEvents=e.customEvents,t.views.facets={properties:{index:0,name:"properties",label:p.information.views.properties,icon:"attributes",module:"DS/IssueManagement/views/facets/Properties",instance:null,isInstantiating:!1,toBeRefreshed:!1},classification:{index:1,name:"classification",label:p.classificationFacetTitle,icon:"classification-book",module:"DS/IssueManagement/views/facets/Classification",instance:null,isInstantiating:!1,toBeRefreshed:!1},relatedObjects:{index:2,name:"relatedObjects",label:p.information.views.relatedObjects,icon:"location",module:"DS/IssueCommon/facets/RelatedContent",instance:null,isInstantiating:!1,toBeRefreshed:!1},attachments:{index:3,name:"attachments",label:p.information.views.attachments,icon:"attach",module:"DS/IssueCommon/facets/Attachments",instance:null,isInstantiating:!1,toBeRefreshed:!1},team:{index:4,name:"team",label:p.information.views.team,icon:"users",module:"DS/IssueCommon/facets/Team",instance:null,isInstantiating:!1,toBeRefreshed:!1},comments:{index:5,name:"comments",label:p.information.views.comments,icon:"comment",module:"DS/IssueCommon/facets/Comments",instance:null,isInstantiating:!1,toBeRefreshed:!1},relations:{index:6,name:"relations",label:p.information.views.relations,icon:"object-related",module:"DS/IssueManagement/views/facets/Relations",instance:null,isInstantiating:!1,toBeRefreshed:!1},history:{index:7,name:"history",label:p.information.views.history,icon:"navigation-history",module:"DS/IssueCommon/facets/History",instance:null,isInstantiating:!1,toBeRefreshed:!1}},t.physicalIds=[],t.tabs=null,t.elements={view:null},u.end(t.name+" setup")},render:function(){var e=this;u.start(e.name+" render");var n=e.tabs=new s({displayStyle:"strip",showComboBoxFlag:!0,editableFlag:!1,multiSelFlag:!1,reindexFlag:!0,touchMode:!0,centeredFlag:!1,allowUnsafeHTMLOnTabButton:!0}),o=Object.keys(e.views.facets);return o.forEach((function(t){var s=e.views.facets[t],o=new i({title:p[s.name+"Title"],shortHelp:p[s.name+"ShortHelp"],longHelp:p[s.name+"LongHelp"]});if(!o.moreHelpCB){var r={};r.helpid=s.name,r.content={[s.name+".PanelHelp"]:m.WEBHELP[s.name]};var c=a.getMoreHelpCallback(r);o.moreHelpCB=c}var d=n.add({index:s.index,isSelected:t===e.views.current,label:s.label,icon:{iconName:s.icon,fontIconFamily:1},showTitleFlag:!0,tooltipInfos:o});0==l.get3DSwymUrl()&&"comments"==t&&(d.visibleFlag=!1),e.views.indexes[s.index]=t})),n.inject(e.container),n.addEventListener("change",(function(){var s=n.value[n.value.length-1];t.is(e.views.indexes)&&t.is(e.views.indexes[s])&&(e.views.current=e.views.indexes[s],e.refresh(e.physicalIds,{force:!1}));var i="";0==s?i="Properties":1==s?i="ClassificationToolbar":2==s?i="ContentToolbar":3==s?i="AttachmentToolbar":4==s?i="MembersToolbar":6==s?i="InformationRelations":7==s&&(i="InformationHistory");try{l.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:i}})}catch(e){}})),o.forEach((function(s){var i=e.views.facets[s].index;n.buttonGroup.getButton(i).elements.container.addEventListener("dragover",(function(){n.value[n.value.length-1]!==i&&n.buttonGroup.selectIndex(i)}));let o=n.buttonGroup.getButton(i).elements.container;(n.buttonGroup.getButton(i).elements.iconContentCount=t.createElement("span",{class:"im-tab-content-count"})).inject(o)})),e.customEvents.subscribe({event:"im-update-tab-count"},(function(t){t.tabs.forEach((function(s,i){let o=e.views.facets[s].index,a=n.buttonGroup.getButton(o).elements.iconContentCount;""===t.count[i]?a.innerHTML="":a.innerHTML=`(${t.count[i]})`}))})),e.customEvents.subscribe({event:"im-information-empty-close"},(function(e){c.getCommand("ToggleInformationPanel").begin({open:!1,save:!0})})),e.elements.view=t.createElement("div",{class:m.CSS.ELEMENTS.VIEW_CONTAINER}),e.elements.view.inject(e.container),u.end(e.name+" render"),e},destroy:function(){var e=this;e.views={facets:{},current:"",indexes:{}},e.physicalIds=[],e.tabs.destroy(),e.tabs=null,e.elements={view:null},e.container.empty()},refresh:function(e,s){var i=this,o=n.resolve(),a=i.views.current;if(!Array.isArray(e)||0===e.length)return o;i.physicalIds=e;var r=Object.keys(i.views.facets);r.forEach((function(e){var t=i.views.facets[e];null!==t.instance&&t.instance.container.addClassName("hidden")})),l.Mask.mask(i.elements.view);var c=i.views.facets[[i.views.current]];return null===c.instance?!0!==c.isInstantiating&&(c.isInstantiating=!0,o=new n((function(e,t){require([c.module],(function(n){c.instance=new n({physicalIds:i.physicalIds}),i.listenToOnce(c.instance,"onReady",(function(){e()})),i.listenToOnce(c.instance,"onFailure",(function(e){i._logger.error("Refresh has failed: %o",e.error),t(e.error)})),c.isInstantiating=!1,c&&c.instance&&(c.instance.render().inject(i.elements.view),c.instance.container.addClassName("visible")),i.views.current===c.name?c.instance.container.addClassName("visible"):c.instance.container.addClassName("hidden"),l.Mask.unmask(i.elements.view)}))}))):(c.instance.container.addClassName("visible"),c.instance.container.removeClassName("hidden"),s&&!0===s.force?(o=c.instance.refresh(i.physicalIds).then((function(){t.is(c.instance.resize,"function")&&c.instance.resize(),l.Mask.unmask(i.elements.view)})),r.forEach((function(e){var t=i.views.facets[e];t&&t!==c&&null!==t.instance&&(t.toBeRefreshed=!0)}))):!0===c.toBeRefreshed?o=c.instance.refresh(i.physicalIds).then((function(){t.is(c.instance.resize,"function")&&c.instance.resize(),l.Mask.unmask(i.elements.view),c.toBeRefreshed=!1})):(t.is(c.instance.resize,"function")&&c.instance.resize(),l.Mask.unmask(i.elements.view))),o.then((function(){i.dispatchEvent("onReady",{view:a})}))},resize:function(){var e=this;e.container.toggleClassName(m.CSS.ELEMENTS.COMPACT,e.container.getParent()&&e.container.getParent().offsetWidth<m.CSS.DIMENSIONS.MIN_WIDTH),Object.keys(e.views.facets).forEach((function(n){var s=e.views.facets[n];null!==s.instance&&t.is(s.instance.resize,"function")&&s.instance.resize()}))},switchFacet:function(e){var t=this,s=t.tabs;return t.views.current===e?n.resolve(t.views.facets[e].instance):new n((function(n){t.listenToOnce(t,"onReady",(function(e){n(t.views.facets[e.view].instance)})),s.buttonGroup.selectIndex(t.views.facets[e].index)}))},getFacet:function(e){return this.views.facets[e]},getCurrentFacet:function(){return this.views.facets[this.views.current]},getTabs:function(){return this.tabs}});return g})),define("DS/IssueManagement/commands/SelectAllIssues",["UWA/Class","DS/ApplicationFrame/Command"],(function(e,t){"use strict";return e.extend(t,{name:"DS/IssueManagement/commands/SelectAllIssues",execute:function(){var e=this;require(["UWA/Class/Promise","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance"],(function(t,n,s){var i=n.get("component").getTreeDocument();s.start(e.name+" execute"),i.withBroadcastSelect(new t((function(t){i.withTransactionUpdate((function(){i.unselectAll();for(var n=i.getRoots(!1),o=0;o<n.length;o++)n[o].select();s.end(e.name+" execute"),t()}))})))}))}})})),define("DS/IssueManagement/commands/UnselectAll",["UWA/Class","DS/ApplicationFrame/Command"],(function(e,t){"use strict";return e.extend(t,{name:"DS/IssueManagement/commands/UnselectAll",execute:function(){var e=this;require(["UWA/Class/Promise","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance"],(function(t,n,s){var i=n.get("component").getTreeDocument();s.start(e.name+" execute"),i.withBroadcastSelect(new t((function(t){i.withTransactionUpdate((function(){i.unselectAll(),s.end(e.name+" execute"),t()}))})))}))}})})),define("DS/IssueManagement/utils/Tagger",["UWA/Core","DS/TagNavigatorProxy/TagNavigatorProxy","DS/IssueServices/services/PlatformServices","DS/IssueServices/Contexts","DS/IssueComponents/utils/Utils"],(function(e,t,n,s,i){"use strict";return e.Class.singleton({connect:function(s){var i=this;i.app=s,i.proxy&&e.is(i.proxy.die,"function")&&i.proxy.die(),i.proxy=t.createProxy({widgetId:widget.id,filteringMode:"FilteringOnServer",tenant:n.getTenant(),defaultDatePicker:!0,colorize:!0,exclude:!0,simplified:{editTagsRelationships:!0}}),i.proxy.configurePredicates({"ds6w:created":{freeInputOnly:!0},"ds6w:modified":{freeInputOnly:!0},"ds6w:type":{viewMode:"tag"}}),i.proxy.addEvent("onFilterChange",i.filterChange,i),i.proxy.addEvent("colorize",i.onColorize),i.proxy.addEvent("unColorize",i.onUnColorize),widget.deleteValue("coloration"),i.activate()},activate:function(){this.proxy.activate()},filterChange:function(e){s.get("component").document.getModelEvents().publish({event:"taggerFilter",data:e})},setTags:function(e){this.lastTags=e,this.proxy.setTags(null,e)},applyTags:function(){if(widget.getValue("tags")){var e=widget.getValue("tags").allfilters;this.proxy.setLocalFilter(e,!1)}},onColorize:function(t){widget.setValue("coloration",t);var n=s.get("component");n.listView&&!0===n.getTreeListView().getManager().isColumnHidden("biColor")&&n.getTreeListView().getManager().showColumn("biColor"),n.document.withTransactionUpdate((async function(){for(var s=n.document.getRoots(!1),o=0;o<s.length;o++){var a={grid:{biColor:"rgba(0, 0, 0, 0)"},color:"rgba(0, 0, 0, 0)"};s[o].updateOptions(a);for(var r=s[o].getAllDescendants(),l=0;l<r.length;l++)r[l].updateOptions(a)}var c="",d=new Map;e.is(t.tagColors,"array")&&t.tagColors.forEach((function(t){c=e.is(t.predicate,"string")?t.predicate.split("/").pop():t.predicate;var n=t.color,s=t.object,i=t.dispValue;d.set(s,n),d.set(i,n)})),await i.fetchAndUpdatePredicate(n.document,s,c),s.forEach((e=>{var t=e.options.predicates;if(d.has(t[c])){var n=d.get(t[c]);e.updateOptions({grid:{biColor:n},color:n})}}))}))},onUnColorize:function(){widget.deleteValue("coloration");var e=s.get("component");e.document.withTransactionUpdate((function(){for(var t=e.document.getRoots(!1),n=0;n<t.length;n++){var s={grid:{biColor:"rgba(0, 0, 0, 0)"},color:"rgba(0, 0, 0, 0)"};t[n].updateOptions(s);for(var i=t[n].getAllDescendants(),o=0;o<i.length;o++)i[o].updateOptions(s)}})),e.listView&&!0!==e.getTreeListView().getManager().isColumnHidden("biColor")&&e.getTreeListView().getManager().hideColumn("biColor")}})})),define("DS/IssueManagement/commands/Find",["UWA/Class","DS/ApplicationFrame/CommandCheckHeader"],(function(e,t){"use strict";return e.extend(t,{init:function(e){},execute:function(){}})})),define("DS/IssueManagement/views/facets/Related",["UWA/Core","UWA/Class/View","DS/IssueComponents/related/Related","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","css!DS/IssueManagement/IssueManagement.css"],(function(e,t,n,s,i){"use strict";return t.extend({name:"DS/IssueManagement/views/facets/Related"})})),define("DS/IssueManagement/commands/SwitchLayout",["UWA/Core","UWA/Class","DS/ApplicationFrame/Command"],(function(e,t,n){"use strict";return t.extend(n,{name:"DS/IssueManagement/commands/SwitchLayout",begin:function(e){this.execute(e)},execute:function(e){var t=this;require(["DS/IssueServices/Contexts","DS/IssueServices/utils/Performance"],(function(n,s){s.start(t.name+" execute"),n.get("information").setLayout(e.layout),n.get("actionBar").updateLayoutSwitcher(),s.end(t.name+" execute")}))}})})),define("DS/IssueManagement/components/header/Find",["UWA/Class/View","UWA/Core","DS/UIKIT/Input/Text","DS/UIKIT/Tooltip","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement"],(function(e,t,n,s,i,o,a){"use strict";return e.extend({name:"DS/IssueManagement/components/header/Find",tagName:"div",className:"find-container",_logger:null,domEvents:{"keyup input.find-input":"_onSearch","paste input.find-input":"_onSearch","click div.clear-cont":"_onClear","click div.fonticon-down-open":"_onNext","click div.fonticon-up-open":"_onPrevious","click div.fonticon-select-on":"_onSelect"},setup:function(e){o.start(this.name+" setup"),o.end(this.name+" setup")},render:function(){var e=this;return o.start(e.name+" render"),o.end(e.name+" render"),e},destroy:function(){}})})),define("DS/IssueManagement/views/facets/Properties",["UWA/Class/Promise","UWA/Core","UWA/Class/View","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/EditPropWidget","DS/EditPropWidget/models/EditPropModel","DS/PADUtils/views/PADAlert","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","DS/IssueCommon/utils/Utils","css!DS/IssueCommon/IssueCommon.css"],(function(e,t,n,s,i,o,a,r,l,c,d){"use strict";return n.extend({name:"DS/IssueCommon/views/PropertiesView",tag:"div",className:"properties-view fade-in-element",defaultOptions:{physicalIds:[]},properties:{component:"",selection:[],promises:[]},_timestampUpdate:0,_subscriberTokens:[],_subscriberId:"",_eventListeners:[],setup:function(e){var t=this;c.start(t.name+" setup"),t._parent(e),t.properties={component:null,selection:[],promises:[]},t._timestampUpdate=0,t._subscriberTokens=[];var n={getSecurityContext:function(){return{SecurityContext:"ctx::"+decodeURIComponent(l.getSecurityContext())}}};t.properties.component=new i({setEditButton:!0,readOnly:!1,warningOnUnsaved:!1,selectionType:s.NO_SELECTION,typeOfDisplay:s.ONLY_EDIT_PROPERTIES,context:n,events:{onNotification:function(e){a.displayNotification({msg:e.msg,eventID:"error"})}}}),t._subscribers(),c.end(t.name+" setup")},render:function(){var e=this;return c.start(e.name+" render"),e.properties.component.inject(e.container),e.refresh(e.getOption("physicalIds")),c.end(e.name+" render"),e},refresh:function(t){var n=this;try{d.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"Properties"}})}catch(e){}finally{n.setOption("physicalIds",t),n.properties.selection.forEach((function(e){e.destroy()})),n.properties.selection=[],n.properties.promises=[],t.forEach((function(t){var s=new o({metatype:"businessobject",tenant:l.getTenant(),objectId:t});s.addEvent("onChangeAttributes",(function(e,t){if(e.changedValues&&(e.changedValues.hasOwnProperty("Change.Start Date Estimated")||e.changedValues.hasOwnProperty("Change.Completion Date Due")||e.changedValues.hasOwnProperty("Change.Completion Date Estimated"))){var n=e._attributes["Change.Start Date Estimated"]?.valueDB||"",s=new Date(n),i=e._attributes["Change.Completion Date Due"]?.valueDB||"",o=new Date(i),a=e._attributes["Change.Completion Date Estimated"]?.valueDB||"",r=new Date(a);if(s>o){var l=d.getErrorMessage("12");d.displayErrorMessage(l,"error"),t.forEach((function(t){"Start Date Estimated"==t.name?e._attributes["Change.Start Date Estimated"].resetInitialValues():"Completion Date Due"==t.name&&e._attributes["Change.Completion Date Due"].resetInitialValues()}))}else if(s>r){l=d.getErrorMessage("15");d.displayErrorMessage(l,"error"),t.forEach((function(t){"Start Date Estimated"==t.name?e._attributes["Change.Start Date Estimated"].resetInitialValues():"Completion Date Estimated"==t.name&&e._attributes["Change.Completion Date Estimated"].resetInitialValues()}))}}})),n.properties.promises.push(new e((function(e){s.listenToOnce(s,"onSave",(function(){e(this)}))}))),n.properties.selection.push(s)})),n.properties.component.initDatas(n.properties.selection),e.all(n.properties.promises).then((function(e){n._onSave(e)}));return(n.properties.component.getListModel().length,e.resolve()).then((function(){n.dispatchEvent("onReady",{})}))}},destroy:function(){var e=this;e._subscriberTokens.forEach((function(e){r.get("eventsHandler").unsubscribe(e)})),e._subscriberTokens=[],e._timestampUpdate=0;try{e.properties.selection.forEach((function(e){e.destroy()}))}catch(e){}try{e.properties.component.destroyComponent()}catch(e){}e.properties={component:null,selection:[],promises:[]},e.container.empty()},_onSave:function(t){var n=this;if(c.start(n.name+" _onSave"),n.properties.promises=[],n.properties.selection.forEach((function(t){n.properties.promises.push(new e((function(e){t.listenToOnce(t,"onSave",(function(){e(this)}))})))})),0!==n.properties.promises.length){e.all(n.properties.promises).then((function(e){n._onSave(e)}));for(var s=[],i={},o=0;o<t.length;o++){var a=t[o].get("objectId");s.push([a]),i[a]={id:a,type:t[o].get("type").value,name:t[o].get("name").value,title:t[o].get("Title").value,modifiedAttributes:["*"]}}r.get("eventsHandler").publish(n._subscriberId,"DS/Object/update",{metadata:{appId:r.get("widget").id,appName:r.get("widget").name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:s,attributes:i},version:"1.0"});try{var l=r.get("component").getCurrentView();d.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:l,pd3:"Properties",pd4:"Edit",pd5:"Issue/"+l+"/Properties/Edit"}})}catch(e){}c.end(n.name+" _onSave")}},_subscribers:function(){var e=this,t=r.get("eventsHandler");e._subscriberId=Math.random().toString(36).substr(2,9),e._eventListeners=[{event:"DS/Object/update",listener:function(t){c.start(e.name+" DS/Object/update");var n=e.properties.selection.reduce((function(e,t){return e.push(t.get("objectId")),e}),[]);t.data.paths.reduce((function(e,t){return e.push(t.pop()),e}),[]).filter((function(e){return n.includes(e)})).length>0&&(e.properties.promises=[]),c.end(e.name+" DS/Object/update")},conditions:{type:"issue"}}];for(var n=0;n<e._eventListeners.length;n++){var s=e._eventListeners[n];s.token=t.subscribe(e._subscriberId,s.event,s.listener.bind(e),s.conditions)}}})})),define("DS/IssueManagement/commands/Detach",["UWA/Class","DS/ApplicationFrame/Command"],(function(e,t){"use strict";return e.extend(t,{dialog:null,execute:function(){var e=this;require(["UWA/Core","UWA/Class/Promise","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/ENOFloatingPanel/ENOFloatingPanel","DS/PADUtils/views/PADAlert","DS/IssueServices/Contexts","i18n!DS/IssueManagement/assets/nls/IssueManagement","DS/IssueManagement/commands/CommandsManager"],(function(t,n,s,i,o,a,r,l,c,d){var u=l.get("widget")||window.widget;if(!u.body.getElement(".detach-objects-issue-dialog")){for(var p=l.get("component"),m=p.getSelectedNodes(),g={},f=[],h=0;h<m.length;h++){var v=m[h].options.id,I=m[h].options.data.issue,b=m[h].options.data.relationToIssue,y=m[h].options.title;y=m[h].options.name&&""!=m[h].options.name?y+" ("+m[h].options.name+")":y,f.push(y),void 0===g[I]&&(g[I]={physicalId:I}),void 0===g[I][b]&&(g[I][b]=[]),g[I][b].push({physicalId:v})}new n((function(n,i){var r=[];f.forEach((function(e){r.push(t.createElement("li",{html:e,title:e}))}));var l=t.createElement("div",{html:[c.related.confirmDetach,t.createElement("ul",{class:"detach-objects-issue-dialog-ul",html:r})]}),d=null,p=e.dialog=new a({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!0,resizable:!0,visible:!0,className:"detach-objects-issue-dialog",title:c.replace(c.related.dialogTitle,{number:m.length,issues:Object.keys(g).length}),header:null,body:l,footer:[d=new s({value:c.related.detach,className:"primary detach-objects-issue-dialog-add",events:{onClick:function(){p.destroy(),e.dialog=null,n()}}}),new s({value:c.related.cancel,className:"default detach-objects-issue-dialog-cancel",events:{onClick:function(){p.destroy(),e.dialog=null,i(new Error("The dialog has been closed by the end user"))}}})],events:{onClose:function(){p.destroy(),e.dialog=null,i(new Error("The dialog has been closed by the end user"))}}}).inject(u.body);new o({element:l}).inject(p.getBody()),p.show(),d.focus()})).then((function(){i.mask(u.body),p.getTreeDocument().removeContextsOrReportedAgainstOrResolvedByOrResolvedItems(g).then((function(){i.unmask(u.body),r.displayNotification({msg:c.notifications.detachSuccess,eventID:"success"}),d.enable(["Export"])}),(function(){i.unmask(u.body)}))}))}}))}})})),define("DS/IssueManagement/components/idcard/IssueMaturity",["UWA/Class/Promise","DS/UIKIT/Input/Button","DS/UIKIT/Input/Text","DS/UIKIT/Tooltip","DS/UIKIT/Scroller","DS/ENOFloatingPanel/ENOFloatingPanel","DS/PADUtils/views/PADAlert","DS/LifecycleCmd/MaturityCmd","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueAttachmentManager/components/Collection","DS/IssueAttachmentManager/services/AttachmentServices","DS/IssueAttachmentManager/views/UploadDialog","i18n!DS/IssueAttachmentManager/assets/nls/IssueAttachmentManager","DS/IssueCommon/utils/Utils","DS/IssueComponents/create/Attachments","i18n!DS/IssueComponents/assets/nls/IssueComponents","css!DS/ChangeMaturityWidget/ChangeMaturityWidget"],(function(e,t,n,s,i,o,a,r,l,c,d,u,p,m,g,f,h,v){var I={enableMaturityActions:!1,STATES_VALUES:["Create","Assign","Active","Review","Closed"],CSS:{ELEMENTS:{GRAPH_STATE_APPROVE:"fonticon fonticon-thumbs-up im-lifecycle-new graph-state-approve",GRAPH_STATE_REJECT:"fonticon fonticon-thumbs-down im-lifecycle-new graph-state-reject",GRAPH_STATE_INPROGRESS:"fonticon-hourglass wux-ui-3ds im-lifecycle-new graph-state-inprogress",GRAPH_HISTORY_APPROVED:"fonticon fonticon-check im-lifecycle-new graph-history-approved ",GRAPH_HISTORY_REJECTED:"fonticon fonticon-wrong im-lifecycle-new graph-history-rejected",GRAPH_HISTORY_MORE:"fonticon fonticon-menu-dot im-lifecycle-new graph-history-more",GRAPH_HISTORY_TOOLTIP:"im-lifecycle-graph-history-tooltip",GRAPH_HISTORY_TOOLTIP_TITLE:"im-lifecycle-graph-history-tooltip-title",STATE_APPROVE_MODAL:"im-lifecycle-approve-modal",STATE_APPROVE_MODAL_HEIGHT:490,STATE_APPROVE_MODAL_WIDTH:510,STATE_APPROVE_MODAL_BODY:"im-lifecycle-approve-modal-body",STATE_APPROVE_MODAL_REASON:"im-lifecycle-approve-modal-reason",STATE_APPROVE_MODAL_ATTACHMENTS:"im-lifecycle-approve-modal-attachments",STATE_NEXT:"double-chevron-right wux-ui-3ds issue-maturity-next-state",STATE_PREV:"double-chevron-left wux-ui-3ds issue-maturity-prev-state",STATE_MATURITY:"collaborative-lifecycle-management wux-ui-3ds issue-maturity-state"}}};return UWA.Class.extend({init:function(t){var n=this;n.bos=UWA.is(t.bos)?t.bos:[],n.showRoute=!UWA.is(t.showRoute)||t.showRoute,n.modelEvents=t.modelEvents,n.maturityCmd=new r,new e((function(e,t){n.bos&&1===n.bos.length&&c.issues.retrieve({data:{objects:[{physicalId:n.bos[0].physicalId}]}}).then((function(t){var s=t.results[0].body;n.issue=s,e(s)}))}))},buildMaturityView:function(e){var t=this;return t.targetDivs=[],e.targetDivs.forEach((e=>{e.empty();let n=UWA.createElement("div",{class:"issue-maturity-div"}),s=UWA.createElement("div",{class:"issue-maturity-history-div"});s.inject(n);let i=UWA.createElement("div",{class:"issue-maturity-cmd-div"});i.inject(n);let o=UWA.createElement("div",{class:"issue-maturity-actions-div"});o.inject(n);let a=UWA.createElement("div",{class:"issue-maturity-route-div"});a.inject(n),n.inject(e),t.targetDivs.push({element:e,maturityCmdDiv:i,maturityDiv:n,maturityActionDiv:o,maturityHistoryDiv:s,maturityRouteDiv:a})})),t},refresh:function(e){var t=this;t.bos=UWA.is(e)&&UWA.is(e.bos)?e.bos:t.bos;let n=[];if(t.targetDivs.forEach((e=>{e.maturityCmdDiv.empty(),e.maturityActionDiv.empty(),e.maturityHistoryDiv.empty(),e.maturityRouteDiv.empty(),n.push(e.element)})),1==t.bos.length){let e=t.bos[0].physicalId;I.enableMaturityActions?t._renderMultiSelectRoute():t.targetDivs.forEach((n=>{t.maturityCmd.executeCompactViewAsync(widget,n.maturityCmdDiv,{SecurityContext:decodeURIComponent(d.getSecurityContext())},e).then((e=>{t.modelEvents.publish({event:"issue-idcard-maturity-update",data:{result:e}}),t.refresh()}))}))}t.showRoute&&t._issueRouteManagement(t.bos,n).then((e=>{"Diff"==e.renderStatus&&t.bos.length>1&&t.targetDivs.forEach((e=>{e.maturityCmdDiv.innerHTML=v.lifecycle.varies,e.maturityCmdDiv.title=v.lifecycle.notSupported}))})).catch((e=>{}))},_issueRouteManagement:function(t,n){var s,i=this,o=new e((e=>{s=e}));return c.routes.retrieve({data:{objects:t.map((function(e){return{physicalId:e.physicalId}}))}}).then((function(e){if(i.routes=e.results.map((function(e){return e.body})),t.length!=e.results.length)return void s({renderStatus:"No"});if(!i.routes.every((function(e){return e.state===i.routes[0].state})))return void s({renderStatus:"Diff"});let o=UWA.is(i.routes[0].current,"object")&&UWA.is(i.routes[0].current.from,"string");i.routes.every((function(e){return(UWA.is(e.current,"object")&&UWA.is(e.current.from,"string"))===o}))?(i._renderRouteActions(),1==t.length?(i._renderRoutesHistory(i.route,n),s({renderStatus:"OK"})):(i._renderMultiSelectRoute(),s({renderStatus:"Multi"}))):s({renderStatus:"Diff"})})).catch((e=>{})),o},_renderRouteActions:function(){var e=this;let t=e.targetDivs.map((e=>e.element)),n=e.route=e.routes[0],s=n.state;var i=d.getUserName();if(n.current&&n.current.basepurpose&&"standard"===n.current.basepurpose.toLowerCase())n.current&&n.current.from===s&&(c.routes.retrieveTasks({data:{objects:[{physicalId:n.physicalId}]}}).then((function(n){n.results[0].body.tasks.length>0?e._renderApproveRejectButtons(e.routes,t):e._renderInProgressIndicator(e.routes,t)})).catch((e=>{})),t.forEach((e=>{e.getElementsByClassName("issue-maturity-div")[0].addClassName("no-state-chng")})));else if(n.current&&n.current.from===s){var o=e.routes.every((function(e){return-1!==e.current.reviewers.map((function(e){return e.user})).indexOf(i)})),a=e.bos.every((function(e){return-1!==e.owners.map((function(e){return e.user})).indexOf(i)}));if(o){var r=e.routes.some((function(e){return-1===e.current.decisions.filter((function(e){return"approved"===e.status||"rejected"===e.status})).map((function(e){return e.reviewer.user})).indexOf(i)}));r?e._renderApproveRejectButtons(e.routes,t):e._renderInProgressIndicator(e.routes,t)}else e._renderInProgressIndicator(e.routes,t);o||a||t.forEach((e=>{e.getElementsByClassName("issue-maturity-div")[0].addClassName("no-state-chng"),e.getElementsByClassName("issue-maturity-div")[0].addClassName("no-state-action")}))}else{let n=e.bos.every((function(e){let t=e.owners.map((function(e){return e.user})),n=e.coOwnersFromUG.map((function(e){return e}));return-1!==t.indexOf(i)||-1!==n.indexOf(i)})),s=e.bos.every((function(e){let t=e.assignees.map((function(e){return e.user})),n=e.assigneeFromUG.map((function(e){return e}));return-1!==t.indexOf(i)||-1!==n.indexOf(i)}));n||s||t.forEach((e=>{e.getElementsByClassName("issue-maturity-div")[0].addClassName("no-state-chng"),e.getElementsByClassName("issue-maturity-div")[0].addClassName("no-state-action")}))}},_renderApproveRejectButtons:function(e,t){var n=this;t.forEach((e=>{let t=e.getElement(".issue-maturity-route-div");t.empty();let i=UWA.createElement("span",{class:I.CSS.ELEMENTS.GRAPH_STATE_APPROVE}),o=UWA.createElement("span",{class:I.CSS.ELEMENTS.GRAPH_STATE_REJECT});new s({position:"left",target:i,body:v.lifecycle.approveModal.okButton}),new s({position:"left",target:o,body:v.lifecycle.rejectModal.okButton}),i.inject(t),o.inject(t),i.addEventListener("click",n._onClickApprove.bind(n)),o.addEventListener("click",n._onClickReject.bind(n))}))},_renderInProgressIndicator:function(e,t){var n=this;let i,o=e[0],a=o.current.reviewers;if(e.length>1)i="<span>"+v.lifecycle.routeIndicatorTooltip.inProgressTooltip.multiSelectionTitle+"</span>";else if(1===e.length){let e=o.current.decisions.filter((function(e){return"approved"===e.status||"rejected"===e.status})).map((function(e){return e.reviewer.user})),t=a.filter((function(t){return-1===e.indexOf(t.user)})),n=o.current.decisions.filter((function(e){return"approved"===e.status}));if(i=UWA.createElement("div",{class:I.CSS.ELEMENTS.GRAPH_HISTORY_TOOLTIP}),t.length>0){let e=UWA.createElement("div",{html:'<span class="'+I.CSS.ELEMENTS.GRAPH_HISTORY_TOOLTIP_TITLE+'">'+v.lifecycle.routeIndicatorTooltip.inProgressTooltip.title+"</span>"});t.forEach((function(t){UWA.createElement("span",{html:"<span>"+t.fullName+"</span>"}).inject(e)})),e.inject(i)}if(n.length>0){let e=UWA.createElement("div",{html:'<span class="'+I.CSS.ELEMENTS.GRAPH_HISTORY_TOOLTIP_TITLE+'">'+v.lifecycle.routeIndicatorTooltip.approvalTitle+"</span>"});n.forEach((function(t){let n=v.replace(v.lifecycle.routeIndicatorTooltip.approvalText,{name:t.reviewer.fullName,date:new Date(t.date).toLocaleString(l.get("widget").lang)});UWA.createElement("span",{html:"<span>"+n+"</span>"}).inject(e)})),e.inject(i)}}t.forEach((e=>{let t=e.getElement(".issue-maturity-route-div");t.empty();let o=UWA.createElement("span",{class:I.CSS.ELEMENTS.GRAPH_STATE_INPROGRESS});new s({position:"bottom",target:o,body:i}),o.inject(t),o.addEventListener("click",n._onClickInProgress.bind(n))}))},_renderRoutesHistory:function(e,t){var n=this;if(Array.isArray(e.history)&&e.history.length>0){let i=e.state,o=e.history.filter((e=>i==e.rejectTo||i==e.from));o.length>0&&t.forEach((e=>{let t=e.getElement(".issue-maturity-history-div");t.empty();let i="approved"===o[o.length-1].status?I.CSS.ELEMENTS.GRAPH_HISTORY_APPROVED:I.CSS.ELEMENTS.GRAPH_HISTORY_REJECTED,a=UWA.createElement("span",{class:i});a.inject(t);let r=UWA.createElement("div",{class:I.CSS.ELEMENTS.GRAPH_HISTORY_TOOLTIP,html:'<span class="'+I.CSS.ELEMENTS.GRAPH_HISTORY_TOOLTIP_TITLE+'">'+v.replace(v.lifecycle.routeIndicatorTooltip.moreTooltip.title,{number:o.length})+"</span>"});o.forEach((e=>{let t=e.date,n="approved"===e.status?"approvalText":"rejectionText";UWA.createElement("div",{html:"<span>"+v.replace(v.lifecycle.routeIndicatorTooltip.moreTooltip[n],{date:new Date(t).toLocaleString(l.get("widget").lang)})+"</span>"}).inject(r)})),new s({position:"bottom",target:a,body:r}),a.addEventListener("click",n._onClickHistory.bind(n))}))}},_onClickApprove:function(){var e=this,s=e.route,r=v.maturity[s.current.approveTo.toLowerCase()],l=UWA.createElement("div",{class:I.CSS.ELEMENTS.STATE_APPROVE_MODAL_BODY}),c=UWA.createElement("div",{class:I.CSS.ELEMENTS.STATE_APPROVE_MODAL_REASON});c.inject(l),UWA.createElement("label",{html:v.lifecycle.approveModal.reasonLabel}).inject(c);var u=new n({multiline:!0,rows:4,placeholder:v.lifecycle.approveModal.reasonPlaceholder});u.inject(c),u.getContent().toggleClassName("highlight",""===u.getValue()),u.getContent().addEventListener("keyup",(function(){u.getContent().toggleClassName("highlight",""===u.getValue())}));var m=UWA.createElement("div",{class:I.CSS.ELEMENTS.STATE_APPROVE_MODAL_ATTACHMENTS});m.inject(l);var g=new h({parent:e,annotateCommand:{enable:!0,addTextbox:!0,getText:function(){var e=null,t=u.getValue();t&&(e=d.getFullName()+"\n"+(new Date).toLocaleString(widget.lang,{})+"\n"+t);return e}},searchAttachmentCommand:{getSearchQuery:function(){return p.getSearchQuery(e.physicalIds)}}});g.render(),g.inject(m),e.approveComponents={},e.approveComponents.attachments=g,e.approveComponents.reasonInput=u;var b={},y=new i({element:l}),w=new o({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!0,resizable:!0,visible:!0,className:I.CSS.ELEMENTS.STATE_APPROVE_MODAL,header:UWA.createElement("h4",{html:v.replace(v.lifecycle.approveModal.header,{approveTo:r})}),body:y,footer:[b.okButton=new t({value:v.lifecycle.approveModal.okButton,className:"primary",events:{onClick:function(){""!==u.getValue()?(f.Mask.mask(l),b.okButton.elements.container.addClassName("disabled"),b.cancelButton.elements.container.addClassName("disabled"),e._approveRoutes(e.routes,u.getValue(),g).then((function(){w.destroy(),e.approveComponents=null})).catch((function(e){var t=v.lifecycle.error;if(null!=e&&void 0!==e&&null!=e.error&&(t=e.error.message),t.includes("Action Taken and Resolution Statement are not filled in")){b.cancelButton.elements.container.removeClassName("disabled");var n=f.getErrorMessage("5");f.displayErrorMessage(n,"error")}else if(t.includes("Action Taken field is not filled in")){b.cancelButton.elements.container.removeClassName("disabled");n=f.getErrorMessage("6");f.displayErrorMessage(n,"error")}else if(t.includes("Resolution Statement field is not filled in")){b.cancelButton.elements.container.removeClassName("disabled");n=f.getErrorMessage("7");f.displayErrorMessage(n,"error")}else if(t.includes("Resolution Date is not filled in")){b.cancelButton.elements.container.removeClassName("disabled");n=f.getErrorMessage("8");f.displayErrorMessage(n,"error")}else a.displayNotification({msg:t,eventID:"error"});f.Mask.unmask(l)}))):a.displayNotification({msg:v.lifecycle.approveModal.reasonRequired,eventID:"warning"})}}}),b.cancelButton=new t({value:v.lifecycle.approveModal.cancelButton,className:"default",events:{onClick:function(){w.destroy(),e.approveComponents=null}}})]});w.inject(widget.body),w.elements.container.setStyle("height",I.CSS.ELEMENTS.STATE_APPROVE_MODAL_HEIGHT),w.elements.container.setStyle("width",I.CSS.ELEMENTS.STATE_APPROVE_MODAL_WIDTH),w.show(),u.focus()},_onClickReject:function(){var e=this,s=e.route,r=v.maturity[s.current.approveTo.toLowerCase()],l=UWA.createElement("div",{class:I.CSS.ELEMENTS.STATE_APPROVE_MODAL_BODY}),c=UWA.createElement("div",{class:I.CSS.ELEMENTS.STATE_APPROVE_MODAL_REASON});c.inject(l),UWA.createElement("label",{html:v.lifecycle.rejectModal.reasonLabel}).inject(c);var u=new n({multiline:!0,rows:4,placeholder:v.lifecycle.rejectModal.reasonPlaceholder});u.inject(c),u.getContent().toggleClassName("highlight",""===u.getValue()),u.getContent().addEventListener("keyup",(function(){u.getContent().toggleClassName("highlight",""===u.getValue())}));var m=UWA.createElement("div",{class:I.CSS.ELEMENTS.STATE_APPROVE_MODAL_ATTACHMENTS});m.inject(l);var g=new h({parent:e,annotateCommand:{enable:!0,addTextbox:!0,getText:function(){var e=null,t=u.getValue();t&&(e=d.getFullName()+"\n"+(new Date).toLocaleString(widget.lang,{})+"\n"+t);return e}},searchAttachmentCommand:{getSearchQuery:function(){return p.getSearchQuery(e.physicalIds)}}});g.render(),g.inject(m),e.rejectComponents={},e.rejectComponents.attachments=g,e.rejectComponents.reasonInput=u;var b={},y=new i({element:l}),w=new o({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!0,resizable:!0,visible:!0,className:I.CSS.ELEMENTS.STATE_APPROVE_MODAL,header:UWA.createElement("h4",{html:v.replace(v.lifecycle.rejectModal.header,{approveTo:r})}),body:y,footer:[b.okButton=new t({value:v.lifecycle.rejectModal.okButton,className:"primary",events:{onClick:function(){if(""===u.getValue())return a.displayNotification({msg:v.lifecycle.rejectModal.reasonRequired,eventID:"warning"}),void u.elements.container.addClassName("highlight");f.Mask.mask(l),b.okButton.elements.container.addClassName("disabled"),b.cancelButton.elements.container.addClassName("disabled"),e._rejectRoutes(e.routes,u.getValue(),g).then((function(){w.destroy()})).catch((function(e){a.displayNotification({msg:v.lifecycle.error,eventID:"error"}),f.Mask.unmask(l)}))}}}),b.cancelButton=new t({value:v.lifecycle.rejectModal.cancelButton,className:"default",events:{onClick:function(){w.destroy()}}})]});w.inject(widget.body),w.elements.container.setStyle("height",I.CSS.ELEMENTS.STATE_APPROVE_MODAL_HEIGHT),w.elements.container.setStyle("width",I.CSS.ELEMENTS.STATE_APPROVE_MODAL_WIDTH),w.show(),u.focus()},_onClickHistory:function(){this.modelEvents.publish({event:"issue-idcard-maturity-history-click",data:{}})},_onClickInProgress:function(){this.modelEvents.publish({event:"issue-idcard-maturity-history-click",data:{}})},_approveRoutes:function(e,t,n){var s=this,i=e.map((function(e){return e.physicalId}));return f.Mask.mask(s.container),s._connectAttachments(i,n).then((function(){return c.routes.approve({data:{objects:e.map((function(e){return{physicalId:e.physicalId,comment:t}}))},onFailure:function(e){var t=v.lifecycle.error;null!=e&&void 0!==e&&null!=e.error&&(t=e.error.message),UWA.is(e.error)&&UWA.is(e.error.internal)&&e.error.internal.includes("None of the Resolving Change started")?f.displayErrorMessage(f.getErrorMessage("1500167_1"),"error"):a.displayNotification({msg:t,eventID:"error"})}}).then((function(e){var t=e.results.map((function(e){return{physicalId:e.body.physicalId,task:e.body.task}}));s.modelEvents.publish({event:"onApprovalCompleted",data:{issues:t,modifiedAttributes:["attachments"]}})})).catch((e=>{}))})).catch((e=>{})).finally((function(){s.refresh()}))},_rejectRoutes:function(e,t,n){var s=this,i=e.map((function(e){return e.physicalId}));return f.Mask.mask(s.container),s._connectAttachments(i,n).then((function(){return c.routes.reject({data:{objects:e.map((function(e){return{physicalId:e.physicalId,reason:t}}))}}).then((function(e){var t=e.results.map((function(e){return{physicalId:e.body.physicalId,task:e.body.task}}));s.modelEvents.publish({event:"onRejectionCompleted",data:{issues:t,modifiedAttributes:["attachments"]}})})).catch((e=>{s._StateChangeErrors(e)}))})).catch((e=>{})).finally((function(){s.refresh()}))},_connectAttachments:function(t,n){var s=this,i=l.get("widget")||window.widget,o=n.collection,r=function(e){this.set("isCancelable",!0),this.set("request",e)},c=function(e){if(e.lengthComputable){var t=e.loaded/e.total;this.set("requestProgress",t)}},d=function(){this.set("isCancelable",!1),this.set("request",null)},f=o.filter((function(e){return!0===e.get("isFile")})).map((function(e){var t=e.clone();return t.set("isProcessing",!0),t})),h=[];if(f.length>0){var v=new u({id:"uploadAttachmentsToRoutes",attachments:f});if(new m({container:i.body,collection:v}).render(),s.approveComponents&&s.approveComponents.attachments){var I=s.approveComponents.attachments.fields.collaborativeSpace.value,b=s.approveComponents.attachments.fields.organization.value;const e=(y=s.approveComponents.attachments.ctx).findIndex((e=>{const t=e.split(".");return t[1]===b&&t[2]===I}));s.securityContextForDocumentUpload=y[e]}else if(s.rejectComponents&&s.rejectComponents.attachments){var y;I=s.rejectComponents.attachments.fields.collaborativeSpace.value,b=s.rejectComponents.attachments.fields.organization.value;const e=(y=s.rejectComponents.attachments.ctx).findIndex((e=>{const t=e.split(".");return t[1]===b&&t[2]===I}));s.securityContextForDocumentUpload=y[e]}h=f.map((function(e){var t=p.uploadFile(e.get("file"),null,{onCheckinStart:r.bind(e),onCheckinProgress:c.bind(e),onCheckinComplete:d.bind(e)},s.securityContextForDocumentUpload);return t=t.then((function(t){t&&t.data&&t.data.length>0&&t.data[0].id&&(o.get(e.id).set("isFile",!1),o.get(e.id).set("id",t.data[0].id),e.set("id",t.data[0].id),e.set("isFile",!1),e.set("isProcessing",!1))})).catch((function(t){e.set("isFailed",!0),e.set("isProcessing",!1),e.set("isCancelable",!1),e.set("request",null),t instanceof Error&&a.displayNotification({msg:g.replace(g.notifications.Upload.failure,{count:1}),eventID:"error"})}))}))}return e.all(h).then((function(){var n=o.filter((function(e){return!0!==e.get("isFile")})).map((function(e){return e.clone()})),s=[];return n.length>0&&t.forEach((function(e){var t=n.map((function(e){return e.id}));s.push(p.connectDocumentsToParent(t,e).catch((function(e){a.displayNotification({msg:g.replace(g.notifications.Attach.failure,{count:1}),eventID:"error"})})))})),e.all(s)})).then((function(){var n=[],s=o.filter((function(e){return!0===e.get("isPrimary")}));if(1===s.length){var i=s[0];return t.forEach((function(e){n.push(p.setAsPrimary(i.get("id"),e,!0).then((function(){})).catch((function(e){a.displayNotification({msg:g.notifications.SetAsPrimary.failure,eventID:"error"})})))})),e.all(n)}return e.resolve()})).catch((e=>{}))},_renderMultiSelectRoute:function(){var e=this;let n=e.bos[0].physicalId,s=I.STATES_VALUES.indexOf(e.bos[0].state);e.targetDivs.forEach((t=>{t.maturityDiv.addClassName("no-state-chng"),t.maturityDiv.addClassName("no-state-action"),e.maturityCmd.executeCompactViewAsync(widget,t.maturityCmdDiv,{SecurityContext:decodeURIComponent(d.getSecurityContext())},n).then((t=>{e.refresh()}))})),e.targetDivs.forEach((n=>{let i=n.maturityActionDiv,o=[];s!=I.STATES_VALUES.length-1&&o.push({name:"NextState",fonticon:I.CSS.ELEMENTS.STATE_NEXT,text:v.lifecycle.goToNextState,selected:!1}),0!=s&&o.push({name:"PreviousState",fonticon:I.CSS.ELEMENTS.STATE_PREV,text:v.lifecycle.goToPrevState,selected:!1}),o.push({name:"maturity",fonticon:I.CSS.ELEMENTS.STATE_MATURITY,text:v.resolveIssues.state,selected:!1}),new t({className:"route-action",icon:"chevron-down",dropdown:{items:o},events:{onDropdownClick:function(t,n){"NextState"==n.name&&e._onPromote(),"PreviousState"==n.name&&e._onDemote(),"maturity"==n.name&&e.maturityCmd.execute(e.bos,(function(){e.modelEvents.publish({event:"refresh-issue-header",data:{}})}))}}}).inject(i)}))},_onPromote:function(){var e=this;let t=I.STATES_VALUES.indexOf(e.bos[0].state);if(t==I.STATES_VALUES.length-1)return;let n=I.STATES_VALUES[t+1],s=e.bos.map((e=>({physicalId:e.physicalId,state:n})));c.issues.promote({data:{objects:s}}).then((function(t){let n=t.results;n.forEach((t=>{let n=t.body.physicalId;e.bos.forEach((e=>{e.physicalId==n&&(e.state=t.body.state)}))})),e.modelEvents.publish({event:"issue-idcard-maturity-update",data:{result:n}})})).catch((function(t){e._StateChangeErrors(t)})).finally((function(){e.refresh()}))},_onDemote:function(){var e=this;let t=I.STATES_VALUES.indexOf(e.bos[0].state);if(0==t)return;let n=I.STATES_VALUES[t-1],s=e.bos.map((e=>({physicalId:e.physicalId,state:n})));c.issues.demote({data:{objects:s}}).then((function(t){let n=t.results;n.forEach((t=>{let n=t.body.physicalId;e.bos.forEach((e=>{e.physicalId==n&&(e.state=t.body.state)}))})),e.modelEvents.publish({event:"issue-idcard-maturity-update",data:{result:n}})})).catch((function(t){e._StateChangeErrors(t)})).finally((function(){e.refresh()}))},_StateChangeErrors:function(e){var t=v.lifecycle.error,n="";if(e&&e.error&&UWA.is(e.error.message,"string")&&(n=e.error.message),n.includes("Action Taken and Resolution Statement are not filled in")){t=f.getErrorMessage("5");f.displayErrorMessage(t,"error")}else if(n.includes("Action Taken field is not filled in")){t=f.getErrorMessage("6");f.displayErrorMessage(t,"error")}else if(n.includes("Resolution Statement field is not filled in")){t=f.getErrorMessage("7");f.displayErrorMessage(t,"error")}else if(n.includes("Resolution Date is not filled in")){t=f.getErrorMessage("8");f.displayErrorMessage(t,"error")}else if(n.includes("User does not have necessary privileges or selected object is not in correct maturity state for this operation.")){var s=f.getErrorMessage("1005_1");f.displayErrorMessage(s,"error")}else if(e.error&&e.error.internal&&(e.error.internal.includes("Message:No privilege for operation Severity:2 ErrorCode:1500019")||e.error.internal.includes("User does not have necessary privileges"))){s=f.getErrorMessage("1005");f.displayErrorMessage(s,"error")}else if(e.error&&e.error.internal&&e.error.internal.includes("You need at least one assignee to promote or demote this issue, as a validation process is attached to the issue for assignees")){s=f.getErrorMessage("1004");f.displayErrorMessage(s,"error")}else if(n.includes("at least one Resolving Change started")){t=f.getErrorMessage("14");f.displayErrorMessage(t,"error")}else e&&e.error&&UWA.is(e.error.message,"string")&&(t=e.error.message,a.displayNotification({msg:t,eventID:"error"}))}})})),define("DS/IssueManagement/components/idcard/IDCardHeaderAttributes",["i18n!DS/IssueManagement/assets/nls/IssueManagement"],(function(e){return{Default_Attr:[{name:"",id:"maturity",value:"",editable:!0,displayWhenMinified:!0},{name:e.columns.nameColumn,id:"issueName",value:"",editable:!1,displayWhenMinified:!0},{name:e.columns.ownerColumn,id:"owner",value:"",type:"type-hyperlink",editable:!0,displayWhenMinified:!0,isVaries:!1},{name:e.columns.priorityColumn,id:"priority",type:"type-hyperlink",value:"",editable:!0,displayWhenMinified:!0},{name:e.columns.resolutionDateColumn,id:"duedate",value:"",editable:!0,displayWhenMinified:!0},{name:e.columns.collaborativeSpaceColumn,id:"collabspace",type:"type-hyperlink",value:"",editable:!0,displayWhenMinified:!0,isVaries:!1},{name:e.columns.responsibleOrganizationColumn,id:"responsibleOrg",value:"",type:"type-hyperlink",editable:!0,displayWhenMinified:!0},{name:e.columns.reportingOrganizationColumn,id:"reportingOrg",value:"",displayWhenMinified:!0},{name:e.completionType,id:"completionType",value:"",editable:!1,displayWhenMinified:!0}],PLMNew_DraftState:[{name:"",id:"maturity",value:"",editable:!0,displayWhenMinified:!0},{name:e.columns.nameColumn,id:"issueName",value:"",editable:!1,displayWhenMinified:!0},{name:e.columns.ownerColumn,id:"owner",value:"",type:"type-hyperlink",editable:!0,displayWhenMinified:!0,isVaries:!1},{name:e.columns.priorityColumn,id:"priority",type:"type-hyperlink",value:"",editable:!0,displayWhenMinified:!0},{name:e.columns.resolutionDateColumn,id:"duedate",value:"",editable:!0,displayWhenMinified:!0},{name:e.columns.collaborativeSpaceColumn,id:"collabspace",type:"type-hyperlink",value:"",editable:!0,displayWhenMinified:!0,isVaries:!1},{name:e.columns.responsibleOrganizationColumn,id:"responsibleOrg",value:"",type:"type-hyperlink",editable:!0,displayWhenMinified:!0},{name:e.columns.reportingOrganizationColumn,id:"reportingOrg",value:"",displayWhenMinified:!0},{name:e.completionType,id:"completionType",value:"",editable:!1,displayWhenMinified:!0}]}})),define("DS/IssueManagement/utils/customization/DataGridCellContent",["UWA/Core","DS/IssueServices/Contexts","DS/IssueComponents/users/Users","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueCommon/assets/nls/IssueCommon"],(function(e,t,n,s,i){"use strict";return{updateCellContentForGrid:function(e){}}})),define("DS/IssueManagement/commands/ToggleInformationPanel",["UWA/Core","UWA/Class","DS/ApplicationFrame/Command"],(function(e,t,n){"use strict";return t.extend(n,{name:"DS/IssueManagement/commands/ToggleInformationPanel",begin:function(e){this.execute(e)},execute:function(e){var t=this;require(["DS/IssueServices/Contexts","DS/IssueServices/utils/Performance"],(function(n,s){s.start(t.name+" execute"),n.get("information").toggle(e.open,e.save),n.get("information").refreshInfo(),n.get("actionBar").updatePanelToggle(),n.get("application").updateHeaderToggle(),s.end(t.name+" execute")}))}})})),define("DS/IssueManagement/components/header/IssueDataGridToolbar",["DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","i18n!DS/IssueManagement/assets/nls/IssueManagement"],(function(e,t,n){var s=Object.create(null);return s.toolbar=null,s._CONSTANTS={LIST_VIEW:"ListView",KANBAN_VIEW:"KanbanView",CUSTOMIZE_DATAGRID_VIEW:"customizeDatagridView",CUSTOMIZE_KANBAN_VIEW:"customizeKanbanView",PLMNEW_ENABLEMENT:"PLMNewEnablement",LAYOUT:{RIGHT:"right",BOTTOM:"bottom"}},s.selectionOptions={menu:[{type:"PushItem",id:"SelectAllIssues",title:n.actions.select.selectIssues,fonticon:{family:1,content:"wux-ui-3ds wux-ui-3ds-list-ok"},action:{module:"DS/IssueManagement/components/header/IssueToolbarActions",func:"selectAll"}},{type:"PushItem",id:"SelectAllRelatedObjects",title:n.actions.select.selectChildren,fonticon:{family:1,content:"wux-ui-3ds wux-ui-3ds-flow-cascade-ok-2"},action:{module:"DS/IssueManagement/components/header/IssueToolbarActions",func:"selectAllRelatedObjects"}},{type:"PushItem",id:"UnselectAll",title:n.actions.select.unselectAll,fonticon:{family:1,content:"wux-ui-3ds wux-ui-3ds-list-delete"},action:{module:"DS/IssueManagement/components/header/IssueToolbarActions",func:"unselectAll"}}]},s.getMoreOptions=function(t){var i=[];i.push({id:"Export",dataElements:{typeRepresentation:"PushItem",label:n.actions.export,icon:{iconName:"export",fontIconFamily:1}},children:this.getExportMenu()}),i.push({id:"Print",dataElements:{typeRepresentation:"PushItem",label:n.actions.print,icon:{iconName:"print",fontIconFamily:1},action:{module:"DS/IssueManagement/components/header/IssueToolbarActions",func:"print"}}});e.get(s._CONSTANTS.PLMNEW_ENABLEMENT);return i},s.getExportMenu=function(){let e="disabled",s=[{id:"ExportCSV",dataElements:{typeRepresentation:"PushItem",label:n.actions.exportCSV,icon:{iconName:"doc-log",fontIconFamily:1},action:{module:"DS/IssueManagement/components/header/IssueToolbarActions",func:"exportCSV"}}},{id:"ExportPPTX",dataElements:{typeRepresentation:"PushItem",label:n.actions.exportPPTX,icon:{iconName:"newspaper",fontIconFamily:1},action:{module:"DS/IssueManagement/components/header/IssueToolbarActions",func:"exportPPTX"},state:e}},{id:"ExportZIP",dataElements:{typeRepresentation:"PushItem",label:n.actions.exportZIP,icon:{iconName:"archive",fontIconFamily:1},action:{module:"DS/IssueManagement/components/header/IssueToolbarActions",func:"exportZIP"},state:e}}];return"OnPremise"!=t.getTenant()&&s.unshift({id:"ExportBCF",dataElements:{typeRepresentation:"PushItem",label:n.actions.exportBCF,icon:{iconName:"export-multiple",fontIconFamily:1},action:{module:"DS/IssueManagement/components/header/IssueToolbarActions",func:"exportBCF"},state:e}}),s},s.writetoolbarDefination=function(e){var t=n.switchView,i={entries:[{id:"InlineCreate",className:"menu",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"plus",fontIconFamily:1},action:{module:"DS/IssueManagement/components/header/IssueToolbarActions",func:"inlineCreate"},position:"far",category:"create",label:n.actions.create.title,priority:4},domId:"InlineCreateToolbar"},{id:"ResolvedBy",className:"menu",dataElements:{typeRepresentation:"functionMenuIcon",icon:{iconName:"resolved-by",fontIconFamily:1},position:"far",category:"create",visibleFlag:!1,value:{menu:[{id:"CreateTask",title:n.taskAsResolvedBy,type:"PushItem",typeRepresentation:"functionIcon",icon:{iconName:"task",fontIconFamily:1},action:{module:"DS/IssueManagement/components/header/IssueToolbarActions",func:"createTask"},priority:1,label:n.taskAsResolvedBy},{id:"ChangeAction",title:n.caAsResolvedBy,type:"PushItem",typeRepresentation:"functionIcon",icon:{iconName:"change",fontIconFamily:1},action:{module:"DS/IssueManagement/components/header/IssueToolbarActions",func:"createCA"},priority:1,label:n.caAsResolvedBy},{id:"AddResolvedByUsingSearch",title:n.addExistingAsResolvedBy,type:"PushItem",typeRepresentation:"functionIcon",icon:{iconName:"search",fontIconFamily:1},action:{module:"DS/IssueManagement/components/header/IssueToolbarActions",func:"addExisting"},priority:1,label:n.addExistingAsResolvedBy}]},label:n.resolveTheIssue,priority:0}},{id:"3DMarkup",className:"menu",dataElements:{typeRepresentation:"functionIcon",visibleFlag:!1,icon:{iconName:"app-3dmarkup",fontIconFamily:1},action:{module:"DS/IssueManagement/components/header/IssueToolbarActions",func:"create3DMarkUp"},position:"far",category:"create",label:n.actions.markup3D,priority:1}},{id:"Filter",dataElements:{typeRepresentation:"functionMenuIcon",icon:{iconName:"list-filter",fontIconFamily:1},value:{menu:[]},position:"far",category:"filter",label:n.filter.title,priority:3},domId:"filterByObjectToolbar"},{id:"Subscription",dataElements:{typeRepresentation:"functionMenuIcon",icon:{iconName:"bell-list",fontIconFamily:1},value:{menu:[{id:"mySubscription",title:n.actions.subscription.mySubscriptions,type:"PushItem",icon:{iconName:"bell",fontIconFamily:1},action:{module:"DS/IssueManagement/components/header/IssueToolbarActions",func:"subscribe",argument:{actionId:"mySubscription"}}}]},label:n.actions.subscription.header,priority:1,position:"far",category:"subscription"}},{id:"customizeDatagridView",className:"menu",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"cog",fontIconFamily:1},action:{module:"DS/IssueManagement/components/header/IssueToolbarActions",func:"customizeColumnView"},visibleFlag:e.customizeDatagridView,disabled:!1,priority:0,position:"far",category:"View",label:n.actions.customizeView}},{id:"customizeKanbanView",className:"menu",dataElements:{typeRepresentation:"functionMenuIcon",icon:{iconName:"cog",fontIconFamily:1},visibleFlag:e.customizeKanbanView,position:"far",category:"View",priority:0,label:n.actions.customizeView},children:[{id:"state",dataElements:{typeRepresentation:"CheckItem",label:n.columns.stateColumn,action:{module:"DS/IssueManagement/components/header/IssueToolbarActions",func:"customizeByState"},state:e.kanbanViewBySetting.kanbanViewByState},category:"2"},{id:"priority",dataElements:{typeRepresentation:"CheckItem",label:n.columns.priorityColumn,action:{module:"DS/IssueManagement/components/header/IssueToolbarActions",func:"customizeByPriority"},state:e.kanbanViewBySetting.kanbanViewByPriority},category:"2"},{id:"resolutionDate",dataElements:{typeRepresentation:"CheckItem",label:n.columns.resolutionDateColumn,action:{module:"DS/IssueManagement/components/header/IssueToolbarActions",func:"customizeByResDate"},state:e.kanbanViewBySetting.kanbanViewByResDate},category:"2"},{id:"all",dataElements:{typeRepresentation:"CheckItem",label:n.columns.allColumn,action:{module:"DS/IssueManagement/components/header/IssueToolbarActions",func:"customizeByAll"},state:e.kanbanViewBySetting.kanbanViewByAll},category:"2"}]},{id:"Selection",className:"menu",dataElements:{typeRepresentation:"functionMenuIcon",icon:{iconName:"select-on",fontIconFamily:1},value:this.selectionOptions,priority:0,position:"far",category:"View",label:n.actions.select.title}},{id:"Dynamic",className:"menu",dataElements:{typeRepresentation:"threeDotsMenu",icon:{iconName:"menu-dot",fontIconFamily:1},priority:1,position:"far",category:"View",label:n.actions.more},children:this.getMoreOptions("disabled")},{id:"SelectView",className:"menu",dataElements:{typeRepresentation:"functionMenuIcon",icon:{iconName:e.icon,fontIconFamily:1},position:"far",category:"View",disabled:!1,value:{menu:[{id:"KanbanView",type:"CheckItem",title:n.actions.kanbanView,icon:{iconName:"chart-kanban",fontIconFamily:1},action:{module:"DS/IssueManagement/components/header/IssueDataGridToolbar",func:"onKanbanView"},state:e.kanbanView},{id:"ListView",type:"CheckItem",title:n.actions.gridView,icon:{iconName:"view-list",fontIconFamily:1},action:{module:"DS/IssueManagement/components/header/IssueDataGridToolbar",func:"onDataGridView"},state:e.listView}]},label:t,priority:0}},{id:"SwitchLayout",dataElements:{typeRepresentation:"chevronMenuIcon",value:{menu:[{type:"CheckItem",id:s._CONSTANTS.LAYOUT.RIGHT,title:n.information.right,state:e.switchLayout==s._CONSTANTS.LAYOUT.RIGHT?"selected":"unselected",icon:{iconName:"side-panel",fontIconFamily:1},action:{module:"DS/IssueManagement/components/header/IssueDataGridToolbar",func:"switchRightLayout",argument:{actionId:s._CONSTANTS.LAYOUT.RIGHT}}},{type:"CheckItem",id:s._CONSTANTS.LAYOUT.BOTTOM,title:n.information.bottom,state:e.switchLayout==s._CONSTANTS.LAYOUT.BOTTOM?"selected":"unselected",icon:{iconName:"bottom-panel",fontIconFamily:1},action:{module:"DS/IssueManagement/components/header/IssueDataGridToolbar",func:"switchBottomLayout",argument:{actionId:s._CONSTANTS.LAYOUT.BOTTOM}}}]}},position:"far",category:"View",label:n.information.layoutSwitcherTooltip,priority:2}]};return JSON.stringify(i)},s.onKanbanView=function(e){require(["DS/IssueManagement/components/header/IssueToolbarActions"],(function(e){var t=s._CONSTANTS.KANBAN_VIEW,n=[{IdValue:t,StateValue:"selected"}];s._toggleViewItem(n,s.toolbarActionBar),e.switchView(t)}))},s.onDataGridView=function(e){require(["DS/IssueManagement/components/header/IssueToolbarActions"],(function(e){var t=s._CONSTANTS.LIST_VIEW,n=[{IdValue:t,StateValue:"selected"}];s._toggleViewItem(n,s.toolbarActionBar),e.switchView(t)}))},s.switchBottomLayout=function(e){widget.setValue("infoPanelLayout","bottom"),require(["DS/IssueManagement/components/header/IssueToolbarActions"],(function(e){var t=s._CONSTANTS.LAYOUT.BOTTOM,n=[{IdValue:t,StateValue:"selected"}];s._toggleLayout(n,s.toolbarActionBar),e.switchLayout(t)}))},s.switchRightLayout=function(e){widget.setValue("infoPanelLayout","right"),require(["DS/IssueManagement/components/header/IssueToolbarActions"],(function(e){var t=s._CONSTANTS.LAYOUT.RIGHT,n=[{IdValue:t,StateValue:"selected"}];s._toggleLayout(n,s.toolbarActionBar),e.switchLayout(t)}))},s.onClickSession=function(e){require(["DS/IssueManagement/components/header/IssueToolbarActions"],(function(t){t.setFilterOptionsOnWidget(e,"session")}))},s.onClickResetSession=function(){const e={owned:!0,assigned:!0,reported:!1,responsible:!1,contributed:!1,closed:!1,session:!1,filterbyobject:widget.getValue("contextFilter")};var t=widget.getValue("previousFilter");t?widget.setValue("filter",t):widget.setValue("filter",JSON.stringify(e)),widget.setValue("roots",[]),widget.dispatchEvent("onRefresh")},s.onClickOwned=function(e){require(["DS/IssueManagement/components/header/IssueToolbarActions"],(function(t){t.setFilterOptionsOnWidget(e,"owned")}))},s.onClickAssigned=function(e){require(["DS/IssueManagement/components/header/IssueToolbarActions"],(function(t){t.setFilterOptionsOnWidget(e,"assigned")}))},s.onClickReported=function(e){require(["DS/IssueManagement/components/header/IssueToolbarActions"],(function(t){t.setFilterOptionsOnWidget(e,"reported")}))},s.onClickResponsible=function(e){require(["DS/IssueManagement/components/header/IssueToolbarActions"],(function(t){t.setFilterOptionsOnWidget(e,"responsible")}))},s.onClickContributed=function(e){require(["DS/IssueManagement/components/header/IssueToolbarActions"],(function(t){t.setFilterOptionsOnWidget(e,"contributed")}))},s.onClickClosed=function(e){require(["DS/IssueManagement/components/header/IssueToolbarActions"],(function(t){t.setFilterOptionsOnWidget(e,"closed")}))},s.onClickFilterByObj=function(e){require(["DS/IssueManagement/components/header/IssueToolbarActions"],(function(t){t.setFilterOptionsOnWidget(e,"filterbyobject")}))},s.setToolbarState=function(e,t){if(e)for(var n=0;n<e.length;n++){var s=e[n];t.updateNodeModel(s.IdValue,{disabled:s.StateValue})}},s._toggleViewItem=function(e,t){if(e)for(var i=0;i<e.length;i++){var o=e[i],a=t.getNodeModelByID("SelectView");a.options.grid.data.menu.forEach((function(e){if(e.id==o.IdValue?t.updateNodeModel(e.id,{state:"selected"}):t.updateNodeModel(e.id,{state:"undefined"}),o.IdValue==s._CONSTANTS.LIST_VIEW){var i={fontIconFamily:1,fontIconSize:"1x",iconName:"view-list"};t.updateNodeModel(a.options.id,{icon:i,label:n.switchView}),t.updateNodeModel(s._CONSTANTS.CUSTOMIZE_KANBAN_VIEW,{visibleFlag:!1}),t.updateNodeModel(s._CONSTANTS.CUSTOMIZE_DATAGRID_VIEW,{visibleFlag:!0})}else{i={fontIconFamily:1,fontIconSize:"1x",iconName:"chart-kanban"};t.updateNodeModel(a.options.id,{icon:i,label:n.switchView}),t.updateNodeModel(s._CONSTANTS.CUSTOMIZE_KANBAN_VIEW,{visibleFlag:!0}),t.updateNodeModel(s._CONSTANTS.CUSTOMIZE_DATAGRID_VIEW,{visibleFlag:!1})}}))}},s._toggleLayout=function(e,t){if(e)for(var n=0;n<e.length;n++){var s=e[n];t.getNodeModelByID("SwitchLayout").options.grid.data.menu.forEach((function(e){e.id==s.IdValue?t.updateNodeModel(e.id,{state:"selected"}):t.updateNodeModel(e.id,{state:"undefined"})}))}},s.toggleFilterItem=function(e,t){if(e)for(var n=0;n<e.length;n++){var s=e[n];t.getNodeModelByID("Filter").options.grid.data.menu.forEach((function(e){e.id==s.IdValue&&null!=e.state&&(e.state.includes("selected")?t.updateNodeModel(s.IdValue,{state:"undefined"}):t.updateNodeModel(s.IdValue,{state:"selected"}))}))}},s.toggleKanbanCustomizeItem=function(e,t){if(e)for(var n=0;n<e.length;n++){var s=e[n];t.getNodeModelByID("customizeKanbanView").options.grid.data.menu.forEach((function(e){e.id==s.IdValue?t.updateNodeModel(e.id,{state:"selected"}):t.updateNodeModel(e.id,{state:"undefined"})}))}},s.getSelectedFilterOptions=function(e){if(e){var t={};return e.getNodeModelByID("Filter").options.grid.data.menu.forEach((function(e){e.state&&e.state.includes("selected")&&(t[e.id]=!0)})),t}},s.getInformationIcon=function(e){return{iconName:"info",fontIconFamily:1,className:!0===e?"info":""}},s.openInformation=function(){require(["DS/IssueManagement/components/header/IssueToolbarActions"],(function(e){var t="info"===s.toolbarActionBar.getNodeModelByID("ToggleInformationPanel").getAttributeValue("semantics").icon.className;e.openInformationPanel(!t)}))},s})),define("DS/IssueManagement/export/ExportPPTX",["UWA/Class/Promise","UWA/Core","DS/IssueManagement/export/Utils","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueCommon/assets/nls/IssueCommon","text!DS/IssueCommon/assets/Settings.json"],(function(e,t,n,s,i,o,a,r,l){"use strict";var c="DS/IssueManagement/export/ExportPPTX",d="Issue",u={exportation:function(){var t=this;o.start(c+" exportation");var r=s.get("component"),l=s.get("status"),u=a.export.pptx.name;return new e((function(e,t){var s=r.getSelectedNodes().filter((function(e){return e.options.baseType===d}));0===s.length?(0===(s=r.getTreeDocument().getRoots(!1)).length&&(n.notifications.nothing(),t(new Error("Nothing to export as PPTX"))),n.confirmation({title:a.export.pptx.title,content:a.replace(a.export.pptx.content,{number:s.length})}).then((function(n){!0===n?e(s):t(new Error("Export PPTX canceled by user"))}))):e(s)})).then((function(e){1===e.length&&(u=u+e[e.length-1].options.name+"_"),n.notifications.exporting(),l.loading.start(),l.loading.update(a.export.pptx.exporting);for(var s=[],r=0;r<e.length;r++)s.push({physicalId:e[r].options.physicalId});return i.export.pptx({data:{objects:s}}).then((function(e){t.utils.saveByteArray(e,u+(new Date).toString().split(" ").splice(1,4).join(" ")+".pptx"),l.loading.hide(a.export.pptx.done)}),(function(e){var t=new TextDecoder("utf-8"),s=JSON.parse(t.decode(e));n.notifications.failure(s.error.message),l.loading.hide(a.export.pptx.failure)})).finally((function(){o.end(c+" exportation")}))}))},utils:{saveByteArray:function(e,n){var s=t.createElement("a");document.body.appendChild(s),s.style="display: none";var i=new Blob([e],{type:"application/vnd.openxmlformats-officedocument.presentationml.presentation"}),o=window.URL.createObjectURL(i);s.href=o,s.download=n,s.click(),setTimeout((function(){document.body.removeChild(s),window.URL.revokeObjectURL(o)}),0)}}};return u})),define("DS/IssueManagement/utils/customization/PADCustomizeView",["css!DS/UIKIT/UIKIT","css!DS/IssueManagement/IssueManagement.css","i18n!DS/IssueManagement/assets/nls/IssueManagement_list","UWA/Controls/Abstract","UWA/Class/Events","DS/Controls/Button","DS/Controls/Toggle","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/Tree/TreeListView","DS/IssueServices/Contexts","DS/Core/PointerEvents","DS/IssueManagement/utils/customization/ComboSelector","DS/WidgetServices/WidgetServices"],(function(e,t,n,s,i,o,a,r,l,c,d,u,p,m){"use strict";return s.extend(i,{name:"padcustomizeview",_command_id:"",_applyOnlyToThisApp:!1})})),define("DS/IssueManagement/commands/CommandsManager",["UWA/Class","UWA/Class/Events","DS/IssueManagement/components/header/IssueDataGridToolbar","DS/ApplicationFrame/CommandsManager","DS/Logger/Logger"],(function(e,t,n,s,i){"use strict";var o="Issue",a="Default";return e.singleton(t,{_logger:null,init:function(){this._logger=i.getLogger("DS/IssueManagement/View")},setContext:function(e){a=e},commands:{issue:{single:["ResolvedBy","3DMarkup"],multi:["Export","Subscription"],disable:[]},other:{single:[],multi:[],disable:["Export","ResolvedBy","3DMarkup","Subscription"]},empty:{single:[],multi:["InlineCreate","Create","Templates","Print","customizeDatagridView","Dynamic"],disable:["ResolvedBy","3DMarkup","Find","Subscription"]},common:{single:[],multi:["Print","customizeDatagridView"],disable:["Find"]}},all:["InlineCreate","Create","ResolvedBy","3DMarkup","Templates","Print","customizeDatagridView","Dynamic","Subscription"],special:["Selection","Export","Dynamic","SwitchLayout","ToggleInformationPanel","Print"],idling:function(){var e=this,t=e.all;e.disable(t.filter((function(e){return!this.has(e)}),new Set(["InlineCreate","Create","Templates"]))),e.dispatchEvent("onDisable",{commands:e.special,isIdle:!0}),e.enable(["InlineCreate","Create","Templates","Dynamic"])},select:function(e){var t=this;t._logger.debug("Selecting elements in the list..."),t.dispatchEvent("onEnable",{commands:t.special});var n=[],s=[],i=[],a=[];if(!e||0===e.length)return n=t.all,s=t.commands.empty.multi,t.disable(n.filter((function(e){return!this.has(e)}),new Set(s))),void t.enable(t.commands.empty.multi);var r=e.every((function(e){return e.options.baseType===o})),l=e.every((function(e){return e.options.baseType!==o}));if(1===e.length){for(var c in t.commands)if(t.commands.hasOwnProperty(c))if("issue"===c)!1===r?a=a.concat(t.commands.other.disable):i=(i=i.concat(t.commands.issue.single)).concat(t.commands.issue.multi);else i=i.concat(t.commands[c].single).concat(t.commands[c].multi)}else for(var d in t.commands)if(t.commands.hasOwnProperty(d))if("issue"===d)!0===l?a=a.concat(t.commands.other.disable):1==r?i=i.concat(t.commands.issue.multi):!1===l&&0==r&&(a=a.concat(["Subscription"]),i=i.concat(["Export"])),a=a.concat(t.commands.issue.single);else i=i.concat(t.commands[d].multi);n=n.concat(t.all),s=i,a=a.concat(n.filter((function(e){return!this.has(e)}),new Set(s))),t.disable(a),t.enable(i)},getCommand:function(e){var t=a;return s.getCommand(e,t)},getCommandCheckHeader:function(e){var t=a;return s.getCommandCheckHeader(e,t)},enable:function(e){Array.isArray(e)&&(this._switchCommands(e,!0),this.dispatchEvent("onEnable",{commands:e}))},disable:function(e){Array.isArray(e)&&(this._switchCommands(e,!1),this.dispatchEvent("onDisable",{commands:e}))},_switchCommands:function(e,t){for(var s=n.toolbarActionBar,i=0;i<e.length;i++)try{!0===t?s.updateNodeModel(e[i],{visibleFlag:!0}):"Export"!=e[i]&&"Subscription"!=e[i]&&s.updateNodeModel(e[i],{visibleFlag:!1})}catch(n){this._logger.debug("Cannot set the command %s to %s",e[i],t)}}})})),define("DS/IssueManagement/components/header/InlineCreate",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Input/Text","DS/UIKIT/DropdownMenu","DS/UIKIT/Mask","DS/UIKIT/Tooltip","DS/Controls/LineEditor","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/IssueCommon/utils/Utils","DS/IssueComponents/utils/Utils","DS/IssueManagement/commands/CommandsManager","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Parser","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement"],(function(e,t,n,s,i,o,a,r,l,c,d,u,p,m,g,f,h,v,I){"use strict";var b=13,y=27,w=40,S="IFB",C="IFT",D="IFRT",T="RECENT_TEMPLATES_HEADER",E="LOADING_TEMPLATES_PLACEHOLDER",A="SIMILAR_ISSUES",_=250,M=100,N=0,x="Issue",O=1e3;return t.extend({name:"DS/IssueManagement/components/header/Find",tagName:"div",className:"create-container",_logger:null,domEvents:{"keyup input.create-input":"_onKeyUp","keydown input.create-input":"_onKeyDown","click .clear-create":"_onClear","click .validate-create":"_onValidate"},input:null,dropdown:null,icons:null,clear:null,validate:{button:null,tooltip:null},_onCreating:!1,_similarities:{issues:[],search:null},setup:function(e){var t=this;v.start(t.name+" setup"),t._parent(e),t._logger=l.getLogger(t.name),t.input=null,t.dropdown=null,t.icons=null,t.clear=null,t.validate={button:null,tooltip:null},t._subscriberId=Math.random().toString(36).substr(2,9),t._onCreating=!1,t._similarities={issues:[],search:d.debounce(t._searchSimilarIssues.bind(t),O)},v.end(t.name+" setup")},render:function(){var e=this;v.start(e.name+" render"),e.input=new r({visibleFlag:!0,displayClearFieldButtonFlag:!1,placeholder:I.actions.create.placeholder,autoCommitFlag:!0}),e.input.addEventListener("change",(()=>{e._onChangeEvent()})),e.input.getContent().getElement("input").addClassName("create-input"),e.input.getContent().setStyle("width","100%"),setTimeout((()=>{e.input.focus()}),100),e.dropdown=new i({className:"im-inline-create-dropdown",target:e.input.elements.container,bound:!1,closeOnClick:!1,items:[{id:S,text:I.actions.create.issue.blank,fonticon:"issue-type"},{id:C,text:I.actions.create.issue.template,fonticon:"template"},{id:T,text:I.actions.create.issue.recentTemplate,className:"im-inline-create-recent-template-header"},{id:E,text:" "}],events:{onShow:function(){var t=e.input.elements.container.offsetWidth;e.dropdown.elements.container.setStyle("width",t);var s=e.dropdown.getItem(E);d.Mask.mask(s.elements.container),require(["DS/IssueComponents/templates/TemplatesDataGridLayout_V2","i18n!DS/IssueComponents/assets/nls/IssueComponents"],(function(t,s){u.getRecentlyUsedTemplates().then((function(t){var n=[];if(""!==t.body&&(n=t.body),null!==e.dropdown){if(e.dropdown.removeItem(E),0===n.length)return e.dropdown.addItem({id:"empty",text:s.templates.treeList.placeholder,title:s.templates.treeList.placeholder,data:null,fonticon:"clock",disabled:!0}),null;for(var i=0;i<n.length;i++){e.dropdown.addItem({id:D+":::"+n[i].physicalId,text:d.getTextFromHTML(n[i].name),title:d.getTextFromHTML(n[i].name),data:n[i],fonticon:"clock",disabled:!1})}return n}return null}),(function(t){e._logger.error("Could not fetch the templates: %o",t),e.dropdown.removeItem(E),e.dropdown.addItem({id:"empty",text:s.templates.errors.get,title:s.templates.errors.get,data:null,fonticon:"attention ",disabled:!0})})).finally((function(){n.is(e.dropdown,"object")&&(e.dropdown.removeItem(A),e._similarities.issues.length&&e.dropdown.addItem({id:A,text:I.replace(I.actions.create.issue.similarIssues,{count:e._similarities.issues.length}),title:I.replace(I.actions.create.issue.similarIssues,{count:e._similarities.issues.length}),fonticon:"open",className:"im-inline-create-similar-issues-header"}))}))}))},onClick:function(t,n){var s=p.getCommand("Create"),i=e.input.value.trim();i.length>0?s.autoFillData={title:i}:s.autoFillData=null;var o=!0;switch(n.id){case S:s.mode=S,s.begin();try{var a=m.get("component").getCurrentView();d.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:a,pd3:"SummaryToolbar",pd4:"NewIssue",pd5:"Issue/"+a+"/SummaryToolbar/NewIssue"}})}catch(e){}break;case C:s.mode=C,s.begin();try{a=m.get("component").getCurrentView();d.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:a,pd3:"SummaryToolbar",pd4:"NewIssueFromTemplate",pd5:"Issue/"+a+"/SummaryToolbar/NewIssueFromTemplate"}})}catch(e){}break;case A:o=!1;var r=d.computeSharedIssuesURL(e._similarities.issues.map((function(e){return e.physicalId})));window.open(r,"_blank");break;case E:case T:return;default:if(0===n.id.indexOf(D)){s.mode=C,s.template=n.data,s.begin();try{a=m.get("component").getCurrentView();d.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:a,pd3:"SummaryToolbar",pd4:"RecentTemplates",pd5:"Issue/"+a+"/SummaryToolbar/RecentTemplates"}})}catch(e){}break}}!0===o&&e._onClose()}}});var t=null;return e.icons=n.createElement("div",{class:"icons-create",html:[t=n.createElement("div",{class:"clear-create fonticon fonticon-cancel-circled"})]}),t.setAttribute("style","font-size: 15px !important"),e.input.inject(e.container),e.icons.inject(e.container),e.clear=new a({position:"bottom",target:t,body:I.actions.create.clear}),v.end(e.name+" render"),e},destroy:function(){var e=this;e.dropdown.destroy(),e.dropdown=null,e.input.destroy(),e.input=null,e.icons=null,e.clear.destroy(),e.clear=null,null!==e.validate.button&&(e.validate.button.destroy(),e.validate.tooltip.destroy(),e.validate={button:null,tooltip:null}),e._onCreating=!1,e._similarities={issues:[],search:null},e.container.remove()},focus:function(){var e=this;if(e.dropdown&&e.input){e.dropdown.show(),e.input.focus();var t=function(){setTimeout((function(){e.input&&""===e.input.value.trim()&&(n.is(e.dropdown)&&Array.isArray(e.dropdown.menus)&&e.dropdown.menus.length>0&&document.activeElement===e.dropdown.menus[N].elements.wrapper||(e.input.elements.container.removeEventListener("focusout",t),setTimeout((function(){e._onClose()}),_)))}),M/10)};e.input.elements.container.addEventListener("focusout",t)}},_onKeyUp:function(e){var t=this,s=t.input.value.trim();document.activeElement===e.target&&e.target===t.input.elements.inputField&&(s.length>0?(null===t.validate.button&&(t.validate.button=n.createElement("div",{class:"validate-create fonticon fonticon-check"}),t.validate.button.inject(t.icons),t.validate.button.setAttribute("style","font-size: 15px !important"),t.validate.tooltip=new a({position:"bottom",target:t.validate.button,body:I.actions.create.title})),n.is(t._similarities.search,"function")&&t._similarities.search()):t.validate.button instanceof HTMLElement&&(t.validate.button.destroy(),t.validate.tooltip.destroy(),t.validate={button:null,tooltip:null}))},_onKeyDown:function(e){var t=this;if(!0!==t._onCreating)if(e.keyCode!==y||document.activeElement!==e.target||e.target!==t.input.elements.inputField){if(e.keyCode===w&&document.activeElement===e.target&&e.target===t.input.elements.inputField){t.dropdown.menus[N].focusIt();var n=document.createEvent("Events");return n.initEvent("keydown",!0,!0),n.which=40,void t.dropdown.menus[N].elements.container.dispatchEvent(n)}var s=t.input.value.trim();if(e.keyCode===b&&document.activeElement===e.target&&e.target===t.input.elements.inputField){if(0===s.length)return t.input.elements.inputField.addClassName("has-error"),void(t.input.value="");t._onCreating=!0,t._onValidate({doNotClose:!0}).then((function(){t.validate.button instanceof HTMLElement&&(t.validate.button.destroy(),t.validate.tooltip.destroy(),t.validate={button:null,tooltip:null})})).finally((function(){t._onCreating=!1}))}}else t._onClose()},_onChangeEvent:function(){var e=this;0==e.input.value.trim().length&&e.validate.button instanceof HTMLElement&&(e.validate.button.destroy(),e.validate.tooltip.destroy(),e.validate={button:null,tooltip:null})},_onValidate:function(t){var n=this,s=(m.get("widget")||window.widget,p.getCommand("Create"));if(s){var i=n.input.value.trim();i.length>0?s.autoFillData={title:i}:s.autoFillData=null,s.mode=S,s.begin(),setTimeout((function(){n.input.value="",n._onClose()}),0)}return new e((e=>{e()}))},_onCreate:function(e,t){var s=this,i=m.get("widget")||window.widget;g.issues.create({data:t}).then((function(n){var a=n.body;try{d.cloudProbeUtils.sendCreateIssueTrackerEvent({createData:t,options:{issueCreationType:"InlineIssue"}});var r=m.get("component").getCurrentView();d.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:r,pd3:"SummaryToolbar",pd4:"InlineCreate",pd5:"Issue/"+r+"/SummaryToolbar/InlineCreate"}}),d.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"SummaryToolbar"}})}catch(e){}finally{const n=I.replace(I.actions.create.success,{title:t.title});c.displayNotification({msg:n,eventID:"success"}),o.unmask(i.body);var l=m.get("eventsHandler"),u=[],p={};u.push([a.physicalId]),p[a.physicalId]={id:a.physicalId,type:x};var g={metadata:{appId:i.id,appName:i.name,timestamp:Math.floor(Date.now())},data:{paths:u,attributes:p},version:"1.0"};l.publish(s._subscriberId,"DS/Object/create",g),setTimeout((function(){s.input.value="",e&&!0!==e.doNotClose&&s._onClose()}),0)}})).catch((function(e){if(o.unmask(i.body),e&&n.is(e.error,"object")&&n.is(e.error.message,"string"))if(n.is(e.error.internal)&&(e.error.internal.includes("ErrorCode:2004")||e.error.internal.includes("Admin not allowed to create Issue"))){var t=d.getErrorMessage("4");d.displayErrorMessage(t,"error")}else if(n.is(e.error.internal)&&e.error.internal.includes("This Issue requires approval but system was not able to find any member")){t=d.getErrorMessage("1004_1");d.displayErrorMessage(t,"error")}else c.displayNotification({msg:e.error.message,eventID:"error"});else c.displayNotification({msg:I.actions.create.failure,eventID:"error"})}))},_onClear:function(){var e=this;null!==e.input&&(e.input.value="",e.input.focus(),e.validate.button instanceof HTMLElement&&(e.validate.button.destroy(),e.validate.tooltip.destroy(),e.validate={button:null,tooltip:null}))},_onClose:function(){this._onClear(),p.getCommandCheckHeader("InlineCreate").setState(!1,!1)},_searchSimilarIssues:function(){var e=this;if(n.is(e.input)&&n.is(e.dropdown)){var t=e.input.value.trim();t.length>0?g.search({data:{query:"(3dexpiss:#all) "+t,select_predicate:["resourceid","ds6w:created","ds6w:modified","ds6w:identifier","owner","ds6w:responsible","ds6wg:revision","ds6w:status","ds6w:label","ds6w:type"]}}).then((function(t){e.dropdown&&(Array.isArray(t.body.results)?e._similarities.issues=t.body.results.map((function(e){return h.parseFetchResponse(e).value})):e._similarities.issues=[],e.dropdown.removeItem(A),e._similarities.issues.length>0&&e.dropdown.addItem({id:A,text:I.replace(I.actions.create.issue.similarIssues,{count:e._similarities.issues.length}),title:I.replace(I.actions.create.issue.similarIssues,{count:e._similarities.issues.length}),fonticon:"open",className:"im-inline-create-similar-issues-header"}))})):(e._similarities.issues=[],e.dropdown.removeItem(A))}}})})),define("DS/IssueManagement/components/header/ActionBar",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Button","DS/UIKIT/Input/ButtonGroup","DS/UIKIT/Iconbar","DS/UIKIT/Tooltip","DS/UIKIT/DropdownMenu","DS/ApplicationFrame/ActionBar","DS/IssueManagement/commands/CommandsManager","DS/IssueManagement/utils/DragAndDrop","DS/IssueServices/Contexts","DS/IssueServices/utils/LocalStorage","i18n!DS/IssueManagement/assets/nls/IssueManagement","css!DS/IssueManagement/IssueManagement.css"],(function(e,t,n,s,i,o,a,r,l,c,d,u,p){"use strict";return t.extend({})})),define("DS/IssueManagement/components/header/ActionBarDataGrid",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Button","DS/UIKIT/Input/ButtonGroup","DS/UIKIT/Iconbar","DS/UIKIT/Tooltip","DS/Controls/TooltipModel","DS/ApplicationFrame/ActionBar","DS/WebappsUtils/WebappsUtils","DS/IssueCommon/utils/Utils","DS/IssueManagement/commands/CommandsManager","DS/IssueManagement/utils/DragAndDrop","DS/IssueServices/Contexts","DS/IssueServices/utils/LocalStorage","DS/IssueManagement/components/header/IssueDataGridToolbar","i18n!DS/IssueManagement/assets/nls/IssueManagement","text!DS/IssueCommon/assets/Settings.json","css!DS/IssueManagement/IssueManagement.css"],(function(e,t,n,s,i,o,a,r,l,c,d,u,p,m,g,f,h){"use strict";var v="ListView",I="KanbanView",b={RIGHT:"right",BOTTOM:"bottom"},y="Assign",w="Active";return t.extend({name:"DS/IssueManagement/components/header/ActionBarDataGrid",tagName:"div",className:"action-bar",_iconBar:null,_switchers:{layout:null,information:null,tooltips:{layout:null,information:null}},setup:function(e){var t=this;p.get("component");t._parent(e),t._iconBar=null,t._switchers={layout:null,information:null,tooltips:{layout:null,information:null}},t._filterModule=null,t._abar=new r({file:"IssueManagement.xml",module:"IssueManagement",context:"Default"}),t.settings=JSON.parse(h),t._subscribers()},render:function(){var t=this;t._filterModule=p.get("filter");var n=p.get("widget")||window.widget,s=p.get("component");t.listView=p.get("ISU_LISTVIEW"),t.container.addClassName("disabled");var i=t.utils.getCurrentView(),o="",a="",r="",l="",c="";t.listView?f.actions.listView:f.actions.gridView,i===v&&t.listView?(o="view-list",f.actions.listView,f.actions.listView,a="selected",r="undefined",l=!0,c=!1):i===v?(o="view-list",f.actions.gridView,f.actions.listView,a="selected",r="undefined",l=!0,c=!1):(o="chart-kanban",f.actions.kanbanView,f.actions.kanbanView,a="undefined",r="selected",l=!1,c=!0);var u={kanbanViewByState:"undefined",kanbanViewByPriority:"undefined",kanbanViewByResDate:"undefined",kanbanViewByAll:"undefined"};switch(n.getValue("kanbanViewBy")||"state"){case"state":u.kanbanViewByState="selected";break;case"priority":u.kanbanViewByPriority="selected";break;case"resolutionDate":u.kanbanViewByResDate="selected";break;case"all":u.kanbanViewByAll="selected"}var m=n.getValue("infoIsOpened"),h=e.is(m,"boolean")?m:"true"===m,I=e.clone(n.getValue("infoLayout"))||b.RIGHT,y={listView:a,kanbanView:r,tooltip:t._tooltip,icon:o,customizeDatagridView:l,customizeKanbanView:c,kanbanViewBySetting:u,isOpened:h,switchLayout:I};g.toolbarActionBar=s.list.setToolbar(g.writetoolbarDefination(y)),t.toolbar=g.toolbarActionBar,t.updateFilterMenu(),t.container.appendChild(t.toolbar.getContent()),t.registerUpdateToolbarCommandStatesEvent();var w=p.get("information");I=w.getPreferences().current||b.RIGHT;return w.getLayout().current!==I&&d.getCommand("SwitchLayout")&&d.getCommand("SwitchLayout").begin({layout:I}),t.toolbar.elements.container.addEventListener("dragenter",(function(e){t.toolbar.elements.container.addClassName("dragEnter-dnd-issue")})),t.toolbar.elements.container.addEventListener("drop",(function(e){t.toolbar.elements.container.removeClassName("dragEnter-dnd-issue")})),t.toolbar.elements.container.addEventListener("dragleave",(function(e){t.toolbar.elements.container.removeClassName("dragEnter-dnd-issue")})),t.addTooltip(g.writetoolbarDefination(y)),t},refresh:function(){this.destroy(),this.render()},getToolbar:function(){return this.toolbar},destroy:function(){this.stopListening(d,"onEnable"),this.stopListening(d,"onDisable")},resize:function(){requestAnimationFrame((function(){}))},enable:function(t){var n=this;Array.isArray(t)&&t.forEach((function(t){switch(t){case"ToggleInformationPanel":if(n.elements.infoIcon=document.getElementsByClassName("information-panel panel-icon-wrapper")[0],n.elements.infoIcon.classList.remove("isu-icon-disable"),d.getCommand("ToggleInformationPanel")){var s=p.get("widget").getValue("infoIsOpened"),i=e.is(s,"boolean")?s:"true"===s;n.toolbar.updateNodeModel("ToggleInformationPanel",{disabled:!1,grid:{semantics:{icon:g.getInformationIcon(i)}}}),d.getCommand("ToggleInformationPanel").begin({open:i,save:!1})}break;case"SwitchLayout":n.toolbar.updateNodeModel("SwitchLayout",{disabled:!1});var o=n.toolbar.getNodeModelByID("SwitchLayout").options.grid.data.menu;n.updateTooltip(o);break;case"Print":case"Export":var a=n.toolbar.getNodeModelByID("Dynamic").options.grid.data.menu;a.find((e=>e.id===t)).state="enabled",n.toolbar.updateNodeModel("Dynamic",{grid:{data:{menu:a}}});break;case"Subscription":var r=[{id:"subscribe",type:"PushItem",title:f.actions.subscription.subscribe,icon:{iconName:"bell-add",fontIconFamily:1},action:{module:"DS/IssueManagement/components/header/IssueToolbarActions",func:"subscribe",argument:{actionId:"subscribe"}}},{id:"unSubscribe",title:f.actions.subscription.unsubscribe,icon:{iconName:"bell-delete",fontIconFamily:1},type:"PushItem",action:{module:"DS/IssueManagement/components/header/IssueToolbarActions",func:"subscribe",argument:{actionId:"unSubscribe"}}},{id:"editSubscription",title:f.actions.subscription.editSubscription,type:"PushItem",icon:{iconName:"bell-pencil",fontIconFamily:1},action:{module:"DS/IssueManagement/components/header/IssueToolbarActions",func:"subscribe",argument:{actionId:"editSubscription"}}},{id:"mySubscription",title:f.actions.subscription.mySubscriptions,type:"PushItem",icon:{iconName:"bell",fontIconFamily:1},action:{module:"DS/IssueManagement/components/header/IssueToolbarActions",func:"subscribe",argument:{actionId:"mySubscription"}}}];n.toolbar.updateNodeModel("Subscription",{grid:{data:{menu:r}}}),n.updateTooltip(r);break;case"Selection":n.toolbar.updateNodeModel("Selection",{visibleFlag:!0});var l=n.toolbar.getNodeModelByID("Selection").options.grid.data.menu;n.updateTooltip(l);break;case"customizeDatagridView":n.toolbar.updateNodeModel("customizeDatagridView",{visibleFlag:!0});case"ResolvedBy":var c=p.get("component").list.treeDocument.getSelectedNodes();1!==c.length||c[0]._options.state!=y&&c[0]._options.state!=w?n.toolbar.updateNodeModel("ResolvedBy",{disabled:!0}):n.toolbar.updateNodeModel("ResolvedBy",{disabled:!1});var u=n.toolbar.getNodeModelByID("ResolvedBy").options.grid.data.menu;n.updateTooltip(u)}}))},registerUpdateToolbarCommandStatesEvent:function(){var e=this,t=p.get("component");e.setAddToolBarState(!1),t.list.treeDocument.getXSO().onPostAdd((function(n){var s={IdValue:"ResolvedBy",StateValue:!0},i={IdValue:"3DMarkup",StateValue:!0};n[0]._options&&(n[0]._options.reportedAgainst.length>0||n[0]._options.contexts.length>0)&&!e.isAllCSLData(n[0]._options)&&(i.StateValue=!1),!n[0]._options||n[0]._options.state!=y&&n[0]._options.state!=w||(s.StateValue=!1);var o=[s,i];g.setToolbarState(o,e.toolbar),e.setAddToolBarState(!1);var a=e.settings.exportLimit;t.list.treeDocument.getSelectedNodes().length<=a?(g.toolbarActionBar.updateNodeModel("ExportPPTX",{state:"enabled"}),g.toolbarActionBar.updateNodeModel("ExportZIP",{state:"enabled"}),g.toolbarActionBar.updateNodeModel("ExportBCF",{state:"enabled"})):(g.toolbarActionBar.updateNodeModel("ExportPPTX",{state:"disabled"}),g.toolbarActionBar.updateNodeModel("ExportZIP",{state:"disabled"}),g.toolbarActionBar.updateNodeModel("ExportBCF",{state:"disabled"}))})),t.list.treeDocument.getXSO().onPostRemove((function(n){if(t.list.treeDocument.getXSO().isEmpty()){var s=[{IdValue:"ResolvedBy",StateValue:!0},{IdValue:"3DMarkup",StateValue:!0}];g.setToolbarState(s,e.toolbar),g.toolbarActionBar.updateNodeModel("ExportPPTX",{state:"disabled"}),g.toolbarActionBar.updateNodeModel("ExportZIP",{state:"disabled"}),g.toolbarActionBar.updateNodeModel("ExportBCF",{state:"disabled"})}else{var i=t.list.treeDocument.getSelectedNodes(),o=e.settings.exportLimit;i.length<=o?(g.toolbarActionBar.updateNodeModel("ExportPPTX",{state:"enabled"}),g.toolbarActionBar.updateNodeModel("ExportZIP",{state:"enabled"}),g.toolbarActionBar.updateNodeModel("ExportBCF",{state:"enabled"})):(g.toolbarActionBar.updateNodeModel("ExportPPTX",{state:"disabled"}),g.toolbarActionBar.updateNodeModel("ExportZIP",{state:"disabled"}),g.toolbarActionBar.updateNodeModel("ExportBCF",{state:"disabled"}))}}))},setAddToolBarState:function(e){var t;t={IdValue:"InlineCreate",StateValue:e},g.setToolbarState([t],this.toolbar)},disable:function(e){var t=this;Array.isArray(e)&&e.forEach((function(e){switch(e){case"ToggleInformationPanel":t.elements.infoIcon=document.getElementsByClassName("information-panel panel-icon-wrapper")[0],t.elements.infoIcon.classList.add("isu-icon-disable"),t.toolbar.updateNodeModel("ToggleInformationPanel",{disabled:!0,grid:{semantics:{icon:g.getInformationIcon(!1)}}}),d.getCommand("ToggleInformationPanel")&&d.getCommand("ToggleInformationPanel").begin({open:!1,save:!1});break;case"SwitchLayout":t.toolbar.updateNodeModel("SwitchLayout",{disabled:!0});break;case"Print":case"Export":var n=t.toolbar.getNodeModelByID("Dynamic").options.grid.data.menu;n.find((t=>t.id===e)).state="disabled",t.toolbar.updateNodeModel("Dynamic",{grid:{data:{menu:n}}});break;case"Subscription":let s=[{id:"mySubscription",title:f.actions.subscription.mySubscriptions,type:"PushItem",icon:{iconName:"bell",fontIconFamily:1},action:{module:"DS/IssueManagement/components/header/IssueToolbarActions",func:"subscribe",argument:{actionId:"mySubscription"}}}];t.toolbar.updateNodeModel("Subscription",{grid:{data:{menu:s}}}),t.updateTooltip(s);break;case"Selection":t.toolbar.updateNodeModel("Selection",{visibleFlag:!1});case"customizeDatagridView":t.toolbar.updateNodeModel("customizeDatagridView",{visibleFlag:!1})}}))},getIconBar:function(){return this.toolbar},getApplicationFrameActionBar:function(){return this._abar},updatePanelToggle:function(){},updateLayoutSwitcher:function(e){p.get("widget")||window.widget},updateFilterMenu:function(){var e=this,t=e._filterModule.getFilterMenu();e.toolbar.updateNodeModel("Filter",{grid:{data:{menu:t}}}),e.updateTooltip(t)},_subscribers:function(){var e=this,t=p.get("widget")||window.widget;e.listenTo(d,"onEnable",(function(t){e.enable(t.commands),e.utils.getCurrentView()===I&&d.disable(["Selection","Find"])})),e.listenTo(d,"onDisable",(function(t){e.disable(t.commands)})),e._abar.onActionBarReady((function(){d.getCommandCheckHeader("InlineCreate").onStateChange((function(){})),t.addEvent("onSearch",(function(n){var s=p.get("component"),i=p.get("templateComponent");if(e.utils.getCurrentView()===I)for(var o=s.kanban.currentView,a=s.kanban.columns[o].length,r=0;r<a;r++)for(var l=s.kanban.columns[o][r].getTreeDocument().getAllDescendants(),c=0;c<l.length;c++)l[c].getLabel().contains(n)||l[c].hide();else n&&(t.getValue("IsIssueSummaryView")?s.getTreeDocument().setFilterModel({label:{filterId:"string",filterModel:{condition1:{type:"contains",filter:n}}}}):i.document.setFilterModel({label:{filterId:"string",filterModel:{condition1:{type:"contains",filter:n}}}}))})),t.addEvent("onResetSearch",(function(){p.get("ISU_LISTVIEW");var n=p.get("component"),s=p.get("templateComponent");if(e.utils.getCurrentView()===I)for(var i=n.kanban.currentView,o=n.kanban.columns[i].length,a=0;a<o;a++)for(var r=n.kanban.columns[i][a].getTreeDocument().getAllDescendants(),l=0;l<r.length;l++)r[l].isVisible()||r[l].show();else t.getValue("IsIssueSummaryView")?c.setColumnFilteringOnAllColumns(n.list):c.setColumnFilteringOnAllColumns(s.templateList.dataGrid.templatesDatagrid)})),e._iconBar&&e.disable(e._iconBar.disabledCommands),e.container.removeClassName("disabled")}))},utils:{getCurrentView:function(){var e=m.getItem("view");return e&&e.name?e.name:(m.setItem("view",{name:v}),v)}},isAllCSLData:function(e){var t=0;return e.contexts&&e.contexts.forEach((e=>{"LEGACY_3DSPACE"==e.elementType&&t++})),e.reportedAgainst&&e.reportedAgainst.forEach((e=>{"LEGACY_3DSPACE"==e.elementType&&t++})),!(t>0)},addTooltip:function(e){var t=this;e.contains("entries")?(e=JSON.parse(e),t.updateTooltip(e.entries)):Array.isArray(e)?t.updateTooltip(e):e&&e.id&&t.updateTooltip([e])},updateTooltip:function(e){var t=this;e.forEach((e=>{e.id&&(t._tooltip=new a({mouseRelativePosition:!0,allowUnsafeHTMLShortHelp:!0,allowUnsafeHTMLLongHelp:!0}),t._tooltip.loadFromHelpRscFile("IssueManagement/IssueManagementHelp",e.id),t.toolbar.updateNodeModel(e.id,{tooltip:t._tooltip,tooltipInfos:t._tooltip}))}))}})})),define("DS/IssueManagement/components/ContextualMenu",["UWA/Class/Promise","DS/WebappsUtils/WebappsUtils","DS/PADUtils/views/PADAlert","DS/PlatformAPI/PlatformAPI","DS/IssueManagement/commands/CommandsManager","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","DS/IssueServices/utils/Views","DS/IssueCommon/utils/DocumentUtils","DS/IssueCommon/utils/Utils","DS/IssueComponents/utils/Utils","DS/IssueAttachmentManager/services/AttachmentServices","i18n!DS/IssueManagement/assets/nls/IssueManagement","text!DS/IssueCommon/assets/Settings.json"],(function(e,t,n,s,i,o,a,r,l,c,d,u,p,m,g,f){"use strict";var h="Issue",v="Closed",I="Assign",b="Active",y="Review",w="ListView",S={REPORTED_AGAINST:"reportedAgainst",RESOLVED_BY:"resolvedBy",RESOLVED_ITEMS:"resolvedItems",CONTEXTS:"contexts",OPEN_WITH:"Open with",OPEN:"Open"},C={REPORTED_AGAINST:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-location",RESOLVED_BY:"wux-ui-3ds wux-ui-3ds-1x fonticon-resolved-by",RESOLVED_ITEMS:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-3d-object",CONTEXTS:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-3d-object",OPEN_WITH:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-open-menu-dot",OPEN:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-open"},D="DS/IssueManagement/components/ContextualMenu";return{getContextualMenu:function(){var t=o.get("component").getTreeDocument().getSelectedNodes();if(0===t.length)return e.resolve([]);var n=t.reduce((function(e,t){var n=[],s=[],i=[],o=[];t.options.reportedAgainst.forEach((function(e){var t=e.physicalId.split(","),s=t[t.length-1];n.push({physicalId:s,path:e.physicalId,pid:e.pid,type:e.type,name:e.name,title:e.title?e.title:e.name,kind:e.kind,elementType:e.elementType,serviceId:e.serviceId})})),t.options.resolvedBy.forEach((function(e){s.push({physicalId:e.physicalId,pid:e.pid,type:e.type,name:e.name,title:e.title?e.title:e.name,serviceId:e.serviceId})})),t.options.resolvedItems.forEach((function(e){i.push({physicalId:e.physicalId,pid:e.pid,type:e.type,name:e.name,title:e.title?e.title:e.name,kind:e.kind,elementType:e.elementType,serviceId:e.serviceId})})),t.options.contexts.forEach((function(e){o.push({physicalId:e.physicalId,pid:e.pid,type:e.type,name:e.name,title:e.title?e.title:e.name,kind:e.kind,elementType:e.elementType,serviceId:e.serviceId})}));var a=t.options.id.split(","),r=a[a.length-1],l=t.options.grid.Approvals;return e.push({physicalId:r,pid:t.options.pid,serviceId:t.options.serviceId?t.options.serviceId:"3DSpace",path:t.options.id,parentId:t.options.data.issue,relationToIssue:t.options.data.relationToIssue,type:t.options.type,baseType:t.options.baseType,name:t.options.name,title:t.options.title,state:t.options.state,reportedAgainst:n,resolvedBy:s,resolvedItems:i,contexts:o,approvals:l,coOwners:t.options.coOwners,kind:t.options.kind,elementType:t.options.elementType}),e}),[]);return this._getMenu({objects:n,isList:o.get("component").getCurrentView()===w})},_getMenu:function(t){var n=this,s=[],i=Array.isArray(t.objects)?t.objects:[];return 0===i.length?e.resolve([]):(l.start(D+" _getMenu"),t.allObjectsAreIssues=i.every((function(e){return e.baseType===h})),t.allObjectsAreNotIssues=i.every((function(e){return e.baseType!==h})),t.atLeastOneIssueIsClosed=i.some((function(e){return e.state===v})),t.atLeastOneIssueIsNotClosed=i.some((function(e){return e.state!==v})),t.allIssuesAreInApprovalState=i.every((function(e){return e.state===y})),t.userIsCoordinator=i.every((function(e){return e.coOwners.some((e=>e.user==a.getUserName()))})),t.allObjectsAreIssues&&1===i.length&&(t.approvals=i[0].approvals),n._getApprovalMenu(t).then((function(e){s=s.concat(e)})).then((function(){return n._getOpenWithMenu(t)})).then((function(e){o.get("isNatifEnvironnement")||(s=s.concat(e))})).then((function(){return n._getBasicMenu(t)})).then((function(e){return s=s.concat(e),l.end(D+" _getMenu"),s})))},_getApprovalMenu:function(t){var i=[];o.get("component").getTreeDocument().getSelectedNodes();if(t.allObjectsAreIssues&&1===t.objects.length){var a={type:"CheckItem",icon:"check",state:"unselected",id:"approvals",action:{callback:function(e,i){try{var l=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:l,pd3:"SummaryViewActions",pd4:"Approvals",pd5:"Issue/"+l+"/SummaryViewActions/Approvals"}})}catch(e){}finally{var c=a.state,d={id:t.objects[0].physicalId};"selected"===c?r.issues.disableApproval({data:d,onComplete:function(e){var n=o.get("component").getTreeDocument();n.undoRegisterNodeModelUpdateEvent(),n.withTransactionUpdate((function(){n.getSelectedNodes()[0].updateOptions({validation:{activated:!1},grid:{Approvals:!1,"ds6w:validation":{activated:!1}}})})),n.registerNodeModelUpdateEvent();var i=[[t.objects[0].physicalId]],a={};a[t.objects[0].physicalId]={id:t.objects[0].physicalId,type:"Issue",modifiedAttributes:["Approvals"]},s.publish("DS/Object/update",{metadata:{appId:widget.id,appName:widget.name,timestamp:Math.floor(Date.now())},data:{paths:i,attributes:a},version:"1.0"})},onFailure:function(e){if(UWA.is(e.error.internal)&&e.error.internal.includes("No 'modify' access on Attribute 'Waiting On' for")){var t=u.getErrorMessage("2005");u.displayErrorMessage(t,"error")}else n.displayNotification({msg:e.error.message,eventID:"error"})}}):r.issues.enableApproval({data:d,onComplete:function(e){var n=o.get("component").getTreeDocument();n.undoRegisterNodeModelUpdateEvent(),n.withTransactionUpdate((function(){n.getSelectedNodes()[0].updateOptions({validation:{activated:!0},grid:{Approvals:!0,"ds6w:validation":{activated:!0}}})})),n.registerNodeModelUpdateEvent();var i=[[t.objects[0].physicalId]],a={};a[t.objects[0].physicalId]={id:t.objects[0].physicalId,type:"Issue",modifiedAttributes:["Approvals"]},s.publish("DS/Object/update",{metadata:{appId:widget.id,appName:widget.name,timestamp:Math.floor(Date.now())},data:{paths:i,attributes:a},version:"1.0"})},onFailure:function(e){if(UWA.is(e.error.internal)&&e.error.internal.includes("No 'modify' access on Attribute 'Waiting On' for")){var t=u.getErrorMessage("2005");u.displayErrorMessage(t,"error")}else n.displayNotification({msg:e.error.message,eventID:"error"})}})}}}};t.approvals?(a.state="selected",a.title=g.commands.approvalOn):a.title=g.commands.approvalOff,i.push(a),i.push({type:"SeparatorItem"})}return i=p.updateTooltip(i),e.resolve(i)},expandAll:function(){var e=o.get("component").getTreeDocument();e.withTransactionUpdate((function(){for(var t=e.getSelectedNodes(),n=0;n<t.length;n++)t[n].options.data.isExpandMultiple=!0,t[n].expand();t.length>0&&e.getComponent().getTreeDocument().updateNodesOnExpand(t)}));try{var t=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:t,pd3:"SummaryViewActions",pd4:"ExpandAll",pd5:"Issue/"+t+"/SummaryViewActions/ExpandAll"}})}catch(e){}},collapseAll:function(){var e=o.get("component").getTreeDocument();e.withTransactionUpdate((function(){for(var t=e.getSelectedNodes(),n=0;n<t.length;n++)"Issue"==t[n].options.baseType?t[n].collapse():t[n].unselect()}));try{var t=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:t,pd3:"SummaryViewActions",pd4:"CollapseAll",pd5:"Issue/"+t+"/SummaryViewActions/CollapseAll"}})}catch(e){}},close:function(){i.getCommand("Close").begin();try{var e=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:e,pd3:"SummaryViewActions",pd4:"MarkAsComplete",pd5:"Issue/"+e+"/SummaryViewActions/MarkAsComplete"}})}catch(e){}},reopen:function(){i.getCommand("Reopen").begin();try{var e=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:e,pd3:"SummaryViewActions",pd4:"Reopen",pd5:"Issue/"+e+"/SummaryViewActions/Reopen"}})}catch(e){}},collaborativeLifecycleSVActions:function(){i.getCommand("CollaborativeLifecycle").begin();try{var e=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:e,pd3:"SummaryViewActions",pd4:"Maturity",pd5:"Issue/"+e+"/SummaryViewActions/Maturity"}})}catch(e){}},share:function(){i.getCommand("Share").begin();try{var e=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:e,pd3:"SummaryViewActions",pd4:"CopyLink",pd5:"Issue/"+e+"/SummaryViewActions/CopyLink"}})}catch(e){}},attachments:function(){i.getCommand("AttachmentManager").begin();try{var e=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:e,pd3:"SummaryViewActions",pd4:"Attachements",pd5:"Issue/"+e+"/SummaryViewActions/Attachements"}})}catch(e){}},relationalExplorer:function(){i.getCommand("RelationalExplorer").begin();try{var e=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:e,pd3:"SummaryViewActions",pd4:"Relations",pd5:"Issue/"+e+"/SummaryViewActions/Relations"}})}catch(e){}},subscribe:function(){i.getCommand("Subscription").begin("subscribe");try{var e=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:e,pd3:"SummaryViewActions",pd4:"Subscribe",pd5:"Issue/"+e+"/SummaryViewActions/Subscribe"}})}catch(e){}},unSubscribe:function(){i.getCommand("Subscription").begin("unSubscribe");try{var e=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:e,pd3:"SummaryViewActions",pd4:"UnSubscribe",pd5:"Issue/"+e+"/SummaryViewActions/UnSubscribe"}})}catch(e){}},editSubscription:function(){i.getCommand("Subscription").begin("editSubscription");try{var e=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:e,pd3:"SummaryViewActions",pd4:"EditSubscriptions",pd5:"Issue/"+e+"/SummaryViewActions/EditSubscriptions"}})}catch(e){}},delete:function(){i.getCommand("Delete").begin();try{var e=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:e,pd3:"SummaryViewActions",pd4:"Delete",pd5:"Issue/"+e+"/SummaryViewActions/Delete"}})}catch(e){}},collaborativeLifecycleSVContentActions:function(){i.getCommand("CollaborativeLifecycle").begin();try{var e=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:e,pd3:"SummaryViewContentActions",pd4:"Maturity",pd5:"Issue/"+e+"/SummaryViewContentActions/Maturity"}})}catch(e){}},Compare:function(){i.getCommand("Compare").begin();try{var e=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:e,pd3:"SummaryViewContentActions",pd4:"Compare",pd5:"Issue/"+e+"/SummaryViewContentActions/Compare"}})}catch(e){}},RelationalExplorerSVContentActions:function(){i.getCommand("RelationalExplorer").begin();try{var e=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:e,pd3:"SummaryViewContentActions",pd4:"Relations",pd5:"Issue/"+e+"/SummaryViewContentActions/Relations"}})}catch(e){}},detach:function(){i.getCommand("Detach").begin();try{var e=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:e,pd3:"SummaryViewContentActions",pd4:"Remove",pd5:"Issue/"+e+"/SummaryViewContentActions/Remove"}})}catch(e){}},_getBasicMenu:function(t){var n=this;l.start(D+" _getBasicMenu");var s=o.get("component").getTreeDocument().getSelectedNodes(),a=[],r=Array.isArray(t.objects)?t.objects:[];if(0===r.length)return a;n.isI3dxPresent=p.isI3dxInSelectedNodes(s);var c=null,h=JSON.parse(f),v=h.duplicateIssues,y=new e((function(e){e()}));return y=y.then((function(){return!0===t.allObjectsAreNotIssues&&1===r.length&&"Document"===r[0].type?m.getDocuments([r[0].physicalId]).then((function(e){c=e.data[0]})):e.resolve()})).then((function(){if(!0===t.allObjectsAreIssues){if(!0===t.isList){var e=o.get("component").getTreeDocument().getIssuesFromSelectedNodes(),m=e.every((function(e){return!Array.isArray(e.getChildren())||!0===e.isExpanded()})),f=e.every((function(e){return!Array.isArray(e.getChildren())||!1===e.isExpanded()})),y=e.every((function(e){return!Array.isArray(e.getChildren())}));!1===y&&(!0===f||!1===m&&!1===f)&&a.push({name:"Expand",title:g.commands.expandAll,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-flow-children-eye"},data:null,action:{callback:function(){n.expandAll()}}}),!1===y&&(!0===m||!1===m&&!1===f)&&a.push({name:"Collapse",title:g.commands.collapseAll,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-flow-children-eye-off"},data:null,action:{callback:function(){n.collapseAll()}}}),a.push({type:"SeparatorItem"})}1!==r.length||r[0].state!=I&&r[0].state!=b||(a.push({name:"ResolveIssue",title:g.resolveTheIssue,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-resolved-by"},id:"resolvedBy",submenu:[{type:"PushItem",title:g.taskAsResolvedBy,fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-task"},id:"createTask",action:{callback:function(){require(["DS/IssueCommon/commands/CreateTask"],(function(e){(new e).execute(t.options)}))}}},{type:"PushItem",title:g.caAsResolvedBy,fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-change"},id:"changeAction",action:{callback:function(){require(["DS/IssueCommon/commands/ChangeAction"],(function(e){(new e).execute(t.options)}));try{var e=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:e,pd3:"SummaryToolbar",pd4:"AddNewCAAsResolvedBy",pd5:"Issue/"+e+"/SummaryToolbar/AddNewCAAsResolvedBy"}}),u.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"SummaryToolbar"}})}catch(e){}}}},{type:"PushItem",title:g.addExistingAsResolvedBy,fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-search"},id:"addResolvedByUsingSearch",action:{callback:function(){i.getCommand("AddUsingSearchAsResolvedBy").begin()}}}]}),a.push({type:"SeparatorItem"})),r.length<=v&&a.push({name:"Duplicate",title:g.commands.duplicate,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-duplicate"},id:"duplicateIssue",data:null,action:{callback:function(){i.getCommand("Duplicate").begin();try{var e=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:e,pd3:"SummaryViewActions",pd4:"Duplicate",pd5:"Issue/"+e+"/SummaryViewActions/Duplicate"}})}catch(e){}}}}),!(!0===t.atLeastOneIssueIsNotClosed&&r.length<=h.maxNumberOfIssueToClose)||t.allIssuesAreInApprovalState&&t.userIsCoordinator||a.push({name:"Close",title:g.commands.close,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-status-change"},id:"markAsComplete",data:null,action:{callback:function(){n.close()}}}),!0===t.atLeastOneIssueIsClosed&&a.push({name:"Reopen",title:g.commands.reopen,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-open"},data:null,action:{callback:function(){n.reopen()}}}),a.push({name:"CollaborativeLifecycle",title:g.commands.collaborativeLifecycle,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-collaborative-lifecycle-management"},data:null,action:{callback:function(){n.collaborativeLifecycleSVActions()}}}),a.push({type:"SeparatorItem"}),a.push({name:"Move",title:g.commands.move,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-move-to"},id:"moveIssue",data:null,action:{callback:function(){i.getCommand("Move").begin();try{var e=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:e,pd3:"SummaryViewActions",pd4:"Move",pd5:"Issue/"+e+"/SummaryViewActions/Move"}})}catch(e){}}}}),a.push({name:"Share",title:g.commands.share,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-link"},data:null,action:{callback:function(){n.share()}}}),a.push({type:"SeparatorItem"}),1===r.length&&(a.push({name:"Attachments",title:g.commands.attachments,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-attach"},id:"attachmentsCommand",data:null,action:{callback:function(){n.attachments()}}}),a.push({name:"information",title:g.commands.information,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-info-open-in-a-new-window"},data:null,action:{callback:function(){u.viewProperties(r[0].physicalId,"3DSpace");try{var e=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:e,pd3:"SummaryViewActions",pd4:"Information",pd5:"Issue/"+e+"/SummaryViewActions/Information"}})}catch(e){}}}})),o.get("isNatifEnvironnement")||a.push({name:"RelationalExplorer",title:g.commands.relationalExplorer,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-object-related"},data:null,action:{callback:function(){n.relationalExplorer()}}}),a.push({name:"subscribe",title:g.actions.subscription.header,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-bell-list"},id:"subscription",submenu:[{type:"PushItem",title:g.actions.subscription.subscribe,fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-bell-add"},id:"subscribe",action:{callback:function(){n.subscribe()}}},{type:"PushItem",title:g.actions.subscription.unsubscribe,fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-bell-delete"},id:"unsubscribe",action:{callback:function(){n.unSubscribe()}}},{type:"PushItem",title:g.actions.subscription.editSubscription,fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-bell-pencil"},id:"editSubscription",action:{callback:function(){n.editSubscription()}}},{type:"PushItem",title:g.actions.subscription.mySubscriptions,fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-bell"},id:"mySubscriptions",action:{callback:function(){i.getCommand("Subscription").begin("mySubscription");try{var e=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:e,pd3:"SummaryViewActions",pd4:"MySubscriptions",pd5:"Issue/"+e+"/SummaryViewActions/MySubscriptions"}})}catch(e){}}}}]}),a.push({type:"SeparatorItem"}),a.push({name:"Delete",title:g.commands.delete,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-trash"},data:null,id:"deleteIssue",action:{callback:function(){n.delete()}}}),a.push({type:"SeparatorItem"});try{u.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"SummaryViewActions"}})}catch(e){}}else if(!0===t.allObjectsAreNotIssues){if(a.push({type:"SeparatorItem"}),1===r.length&&"Document"===r[0].type){var w={data:c,from:"summary"};(C=[]).push(s[0].options);var S={data:c,from:"summary",menu:n,selected:C};a.push({name:"Preview",title:g.commands.preview,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-eye"},data:null,action:{callback:function(){d.preview(S)}}}),a.push({type:"SeparatorItem"}),""===c.relateddata.files[0].dataelements.locker?a.push({name:"Edit",title:g.commands.edit,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-pencil"},data:null,action:{callback:function(){d.edit(w)}}}):(a.push({name:"UndoEdit",title:g.commands.undoEdit,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-undo"},data:null,action:{callback:function(){d.undoEdit(w)}}}),a.push({name:"Update",title:g.commands.update,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-upload"},data:null,action:{callback:function(){d.update(w)}}}))}if(a.push({type:"SeparatorItem"}),n.isI3dxPresent||a.push({name:"CollaborativeLifecycle",title:g.commands.collaborativeLifecycle,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-collaborative-lifecycle-management"},data:null,action:{callback:function(){n.collaborativeLifecycleSVContentActions()}}}),o.get("isNatifEnvironnement")||r.length<=2&&(n.isI3dxPresent||a.push({name:"Compare",title:g.commands.compare,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-compare-on"},data:null,id:"compareObjects",action:{callback:function(){n.Compare()}}}),a.push({type:"SeparatorItem"})),r.every((e=>"Document"==e.type))){for(var C=[],T=0;T<s.length;T++)C.push(s[T].options);var E={data:c,from:"summary",menu:n,selected:C};a.push({name:"Download",title:g.commands.download,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-download"},data:null,action:{callback:function(){d.download(E)}}})}o.get("isNatifEnvironnement")||(n.isI3dxPresent||a.push({name:"RelationalExplorer",title:g.commands.relationalExplorer,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-object-related"},data:null,action:{callback:function(){n.RelationalExplorerSVContentActions()}}}),1===r.length&&(n.isI3dxPresent||a.push({name:"information",title:g.commands.information,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-info-open-in-a-new-window"},data:null,action:{callback:function(){var e=r[0].physicalId;u.viewProperties(e,r[0].serviceId);try{var t=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:t,pd3:"SummaryViewContentActions",pd4:"Information",pd5:"Issue/"+t+"/SummaryViewContentActions/Information"}})}catch(e){}}}}))),a.push({name:"Detach",title:g.commands.detach,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-remove"},id:"removeObject",data:null,action:{callback:function(){n.detach()}}});try{u.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"SummaryViewContentActions"}})}catch(e){}}else a=!0===t.isList?n._getListMenu():n.getKanbanMenu(),o.get("isNatifEnvironnement")||a.push({name:"RelationalExplorer",title:g.commands.relationalExplorer,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-object-related"},data:null,action:{callback:function(){n.RelationalExplorerSVContentActions()}}});return a.forEach((function(e){"subscription"!==e.id&&"resolvedBy"!==e.id||p.updateTooltip(e.submenu)})),p.updateTooltip(a),l.end(D+" _getBasicMenu"),a}))},_getOpenWithMenu:function(t){try{o.get("component").getCurrentView()}catch(e){}finally{var n=this,s=[];if(0===(Array.isArray(t.objects)?t.objects:[]).length)return e.resolve([]);if(o.get("isNatifEnvironnement"))return e.resolve([]);if(!0===t.allObjectsAreIssues){var i=[],a=[],r=[],l=[];t.objects.forEach((function(e){i=i.concat(e.contexts),a=a.concat(e.reportedAgainst),r=r.concat(e.resolvedBy),l=l.concat(e.resolvedItems)}));var c=[];return e.all([n._getOpenWithSubMenu({name:S.CONTEXTS,label:g.commands.open.contexts,objects:i,icon:C.CONTEXTS}),n._getOpenWithSubMenu({name:S.REPORTED_AGAINST,label:g.commands.open.reportedAgainst,objects:a,icon:C.REPORTED_AGAINST}),n._getOpenWithSubMenu({name:S.RESOLVED_BY,label:g.commands.open.resolvedBy,objects:r,icon:C.RESOLVED_BY}),n._getOpenWithSubMenu({name:S.RESOLVED_ITEMS,label:g.commands.open.resolvedItems,objects:l,icon:C.RESOLVED_ITEMS})]).then((function(e){return(c=e.reduce((function(e,t){return e.concat(t)}),[])).length>0&&(s.push({name:S.OPEN,title:g.commands.open.multiple,type:"PushItem",data:null,fonticon:{content:C.OPEN},submenu:c}),s.push({type:"SeparatorItem"})),s}))}return!0===t.allObjectsAreNotIssues?n._getOpenWithSubMenu({name:S.OPEN_WITH,label:g.commands.open.single,objects:t.objects,icon:C.OPEN_WITH}):e.resolve([])}},_getListMenu:function(){var e=[],t=o.get("component").getTreeDocument().getIssuesFromSelectedNodes(),n=t.every((function(e){return!Array.isArray(e.getChildren())||!0===e.isExpanded()})),s=t.every((function(e){return!Array.isArray(e.getChildren())||!1===e.isExpanded()})),a=t.every((function(e){return!Array.isArray(e.getChildren())}));return!1===a&&(!0===s||!1===n&&!1===s)&&e.push({name:"Expand",title:g.commands.expandAll,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-flow-children-eye"},data:null,action:{callback:function(){var e=o.get("component").getTreeDocument();e.withTransactionUpdate((function(){for(var t=e.getSelectedNodes(),n=0;n<t.length;n++)t[n].options.data.isExpandMultiple=!0,t[n].expand();t.length>0&&e.getComponent().getTreeDocument().updateNodesOnExpand(t)}))}}}),!1===a&&(!0===n||!1===n&&!1===s)&&e.push({name:"Collapse",title:g.commands.collapseAll,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-flow-children-eye-off"},data:null,action:{callback:function(){var e=o.get("component").getTreeDocument();e.withTransactionUpdate((function(){for(var t=e.getSelectedNodes(),n=0;n<t.length;n++)"Issue"==t[n].options.baseType?t[n].collapse():t[n].unselect()}))}}}),e.push({type:"SeparatorItem"}),e.push({name:"CollaborativeLifecycle",title:g.commands.collaborativeLifecycle,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-collaborative-lifecycle-management"},data:null,action:{callback:function(){i.getCommand("CollaborativeLifecycle").begin()}}}),e.push({type:"SeparatorItem"}),e.push({name:"Share",title:g.commands.share,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-link"},data:null,action:{callback:function(){i.getCommand("Share").begin()}}}),"SeparatorItem"===e[e.length-1].type&&e.pop(),e},getKanbanMenu:function(){var e=[];return e.push({name:"CollaborativeLifecycle",title:g.commands.collaborativeLifecycle,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-collaborative-lifecycle-management"},data:null,action:{callback:function(){i.getCommand("CollaborativeLifecycle").begin()}}}),e.push({type:"SeparatorItem"}),e.push({name:"Share",title:g.commands.share,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-link"},data:null,action:{callback:function(){i.getCommand("Share").begin()}}}),e},_getOpenWithSubMenu:function(t){if(!t||!Array.isArray(t.objects)||0===t.objects.length)return e.resolve([]);var n=[],s=[],i=t.objects;return l.start(D+" _getOpenWithSubMenu"),new e((function(e){for(var d=[],u=0;u<i.length;u++){var m=i[u],g=[];g.push(m.type),m.kind&&""!=m.kind&&g.push(m.kind),d.push(m.type),s.push({envId:a.getTenant(),contextId:a.getSecurityContexts().securityContext,serviceId:m.serviceId?m.serviceId:"3DSpace",objectId:m.pid?m.pid:m.physicalId,objectType:m.type,objectTaxonomies:g,displayName:m.title+"("+m.name+")",i3dx:m.physicalId.includes("i3dx")?m.physicalId:""})}r.getTypesHierarchy({types:d,onComplete:function(a){if(UWA.is(a.types_hierarchies,"array")&&a.types_hierarchies.forEach((function(e,t){s.forEach((function(t,n){t.objectTaxonomies[0]===e.type&&(t.objectTaxonomies=t.objectTaxonomies.concat(e.hierarchy))}))})),0===s.length)return l.end(D+" _getOpenWithSubMenu"),void e(n);o.get("widget")||window.widget;if(s[0].objectTaxonomies.some((e=>"catia magic"===e.toLowerCase())))var r=c.getOpenWith().set3DXContent(p.buildDnDPayload({items:s}));else r=c.getOpenWith().set3DXContent(p.buildDnDPayload({items:s}),!0);r.retrieveCompatibleApps((function(s){if(s&&s.length>0){var a=[],r=[];if(s.forEach((function(e){r={name:e.text.replace(/ /g,""),type:"PushItem",title:e.text,action:{callback:function(t){o.get("component").utils.setTypesCallbackForOFW(i),e.handler.call(t)}}},null!=e.fonticon?r.fonticon={content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+e.fonticon}:e.className&&1==e.className.contains("app-widget")?r.icon={iconPath:e.icon,className:"issue-widget"}:r.icon=e.icon,a.push(r)})),a.length>0){var c={name:t.name,type:"PushItem",fonticon:{content:t.icon},title:t.label,submenu:a};n.push(c)}}l.end(D+" _getOpenWithSubMenu"),e(n)}))},onFailure:function(t){e(n)}})}))}}})),define("DS/IssueManagement/components/header/Filter",["UWA/Class/View","UWA/Core","DS/UIKIT/DropdownMenu","DS/UIKIT/Iconbar","DS/WUXAutoComplete/AutoComplete","DS/Menu/Menu","DS/Controls/Button","DS/Controls/Toggle","DS/Controls/ButtonGroup","DS/Controls/TooltipModel","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/DataDragAndDrop/DataDragAndDrop","DS/PADUtils/views/PADAlert","DS/IssueManagement/components/ContextualMenu","DS/IssueCommon/utils/Utils","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Views","DS/IssueServices/utils/Performance","DS/IssueTracker/IssueTracker","i18n!DS/IssueManagement/assets/nls/IssueManagement"],(function(e,t,n,s,i,o,a,r,l,c,d,u,p,m,g,f,h,v,I,b,y,w,S,C,D){"use strict";var T="contextFilter",E="selectedContext",A="affectedItemSetting",_="resolvedItemSetting",M="contextSetting",N="PLMNewEnablement",x="createSetting",O="affectedItemCreateSetting",P="contextCreateSetting",V=e.extend({name:"DS/IssueManagement/components/header/Filter",tagName:"div",className:"filter-container",_logger:null,elements:{bar:null,menu:null},filter:{},setup:function(e){var t=this;S.start(t.name+" setup"),t._parent(e),t.elements={bar:null,menu:null},S.end(t.name+" setup")},render:function(){return this},getFilterMenu:function(){var e=JSON.parse(widget.getValue("filter")),t="",n="",s="",i="",o="",a="",r="",l="",c="";1==e.assigned&&(t="selected"),1==e.owned&&(n="selected"),1==e.reported&&(o="selected"),1==e.responsible&&(a="selected"),1==e.contributed&&(r="selected"),1==e.closed&&(l="selected"),1==e.filterbyobject&&(c="selected");var d=widget.getValue("roots");!1===Array.isArray(d)&&(d=[]),1==e.session&&d.length>0?(s="selected|enabled",i="enabled"):0==d.length?(s="disabled",i="disabled"):d.length>0&&(s="enabled",i="enabled");var u=[{type:"TitleItem",title:D.filter.session.header},{type:"CheckItem",title:d.length>0?D.replace(D.filter.session.title,{number:d.length}):D.filter.session.nothing,state:s,id:"session",action:{module:"DS/IssueManagement/components/header/IssueDataGridToolbar",func:"onClickSession"}},{type:"CheckItem",title:D.resetSession,state:i,id:"reset-session",action:{module:"DS/IssueManagement/components/header/IssueDataGridToolbar",func:"onClickResetSession"}},{type:"CheckItem",title:D.filter.owned,state:n,id:"owned",action:{module:"DS/IssueManagement/components/header/IssueDataGridToolbar",func:"onClickOwned"}},{type:"CheckItem",title:D.filter.assigned,id:"assigned",action:{module:"DS/IssueManagement/components/header/IssueDataGridToolbar",func:"onClickAssigned"},state:t},{type:"SeparatorItem"},{type:"CheckItem",title:D.filter.others.contributed,state:r,id:"contributed",action:{module:"DS/IssueManagement/components/header/IssueDataGridToolbar",func:"onClickContributed"}},{type:"SeparatorItem"},{type:"CheckItem",title:D.filter.others.closed,state:l,id:"closed",action:{module:"DS/IssueManagement/components/header/IssueDataGridToolbar",func:"onClickClosed"}},{type:"SeparatorItem"},{type:"CheckItem",title:D.filter.filterbyobject.title,state:c,id:"filterbyobject",action:{module:"DS/IssueManagement/components/header/IssueDataGridToolbar",func:"onClickFilterByObj"}}];return(widget.getPreference("organizationFilter").value||I.get("isNatifEnvironnement"))&&u.splice(5,0,{type:"CheckItem",title:D.filter.others.reported,id:"reported",action:{module:"DS/IssueManagement/components/header/IssueDataGridToolbar",func:"onClickReported"},state:o},{type:"CheckItem",title:D.filter.others.responsible,id:"responsible",action:{module:"DS/IssueManagement/components/header/IssueDataGridToolbar",func:"onClickResponsible"},state:a}),u},showContextFilter:function(){var e=this;if(I.get("actionBar"))var n=document.getElementById("filterByObjectToolbar").getParent().getParent();if(e.filterDiv&&e.filterDiv.show(),widget.setValue(T,!0),e.autoCompleteFilter)e.autoCompleteFilter.focus();else{e.filterDiv=t.createElement("div",{class:"filter-context"}),e.makeDroppable(e.filterDiv),e.modelForFilter=new p,e.modelForRecentObjects=new p,e.recentObjects=[],b.preferences.get({data:{name:"recentFilterObjects"}}).then((function(t){""!==t.body&&(e.recentObjects=t.body.map((function(e){return"string"==typeof e?{id:e}:e})))})),e.autoCompleteFilter=new i({elementsTree:function(t){return e.modelForRecentObjects.empty(),e.modelForFilter.empty(),t.length<3?e.recentObjects.length>0?new Promise((function(t,n){b.fetch({data:{objects:e.recentObjects.map((function(e){return{physicalId:e.id}}))},onComplete:function(n){var s=n.body;e.modelForRecentObjects.prepareUpdate(),s.results&&s.results.length>0&&(s.results.sort(((t,n)=>{var s=e.parseFetchAttributes(t),i=e.parseFetchAttributes(n);const o=s.id,a=i.id;return e.recentObjects.findIndex((e=>e.id.includes(o)))-e.recentObjects.findIndex((e=>e.id.includes(a)))})),s.results.forEach((function(t){var n=e.parseFetchAttributes(t);n.revision=void 0===n.revision?"":n.revision,n.identifier=void 0===n.identifier?"":" ("+n.identifier+")";var s=n.label+" "+n.revision+n.identifier,i=e.recentObjects.find((e=>e.id.includes(n.id))),o=new m({label:s,value:n.id,name:n.identifier,id:n.id,icon:n.icon,icons:["clock",t.attributes.icon],type:n.type,serviceId:i.serviceId,kind:n.kind});e.modelForRecentObjects.addRoot(o)}))),e.modelForRecentObjects.pushUpdate(),t(e.modelForRecentObjects)},onFailure:function(n){t(e.modelForRecentObjects)}})})):void 0:new Promise((function(n,s){setTimeout((function(){b.getRelatedObjects({text:t}).then((function(t){e.modelForFilter.prepareUpdate();for(var s=0;s<t.length;s++)if(t[s].serviceId.toLowerCase().includes("3dspace")||t[s].id.includes("i3dx:")){t[s].identifier;t[s].revision=void 0===t[s].revision?"":t[s].revision,t[s].identifier=void 0===t[s].identifier?"":" ("+t[s].identifier+")";var i=t[s].label+" "+t[s].revision+t[s].identifier,o=new m({label:i,value:t[s].id,name:t[s].identifier,id:t[s].id,icon:t[s].icon,type:t[s].type,serviceId:t[s].serviceId,kind:t[s].kind});e.modelForFilter.addRoot(o)}e.modelForFilter.pushUpdate(),n(e.modelForFilter)}),(function(t){n(e.modelForFilter)}))}),1e3)}))},placeholder:D.filter.filterbyobject.placeholder,customFilterMessage:D.filter.filterbyobject.filterMessage,multiSearchMode:!1,allowFreeInputFlag:!1,minLengthBeforeSearch:0,keepSearchResultsFlag:!1}).inject(e.filterDiv),e.autoCompleteFilter.focus();var s=I.get("actionBar");if(n.getBoundingClientRect().left-s.container.getBoundingClientRect().left<500?(e.filterDiv.inject(s.container.parentElement),e.autoCompleteFilter.getContent().setStyle("width","inherit")):n.insertBefore(e.filterDiv,n.firstChild),widget.getValue(E)){var r=new m(widget.getValue(E));e.autoCompleteFilter.selectedItems=r}e.autoCompleteFilter.addEventListener("change",(function(){var t="";if(e.autoCompleteFilter.selectedItems&&(t=e.autoCompleteFilter.selectedItems.options,null==e.recentObjects.find((e=>e.id.includes(t.id))))){if(e.recentObjects.unshift(t),e.recentObjects.length>5){for(var n=[],s=0;s<5;s++)n.push(e.recentObjects[s]);e.recentObjects=n}b.preferences.set({data:{name:"recentFilterObjects",value:JSON.stringify(e.recentObjects)}}).catch((function(t){e._logger.error("Could not save the preferences: %o",t)}))}widget.setValue(E,t),widget.dispatchEvent("onRefresh",["filter"]),widget.dispatchEvent("endEdit")}));var l=new a({displayStyle:"lite",label:"lite displayStyle",icon:{iconName:"search",fontIconFamily:WUXManagedFontIcons.Font3DS},showLabelFlag:!1}).inject(e.filterDiv);l.tooltipInfos=new c({shortHelp:D.filter.filterbyobject.search}),l.getContent().addEventListener("buttonclick",(function(){e.searchContext()}));var d=new a({displayStyle:"lite",label:"lite displayStyle",icon:{iconName:"chevron-down",fontIconFamily:WUXManagedFontIcons.Font3DS},showLabelFlag:!1}).inject(e.filterDiv);d.tooltipInfos=new c({shortHelp:D.filter.filterbyobject.menu.title}),d.getContent().addEventListener("buttonclick",(function(){var t=this.getBoundingClientRect(),n={position:{x:t.left-140,y:t.top+30}};e.getContextualMenu().then((function(e){o.show(e,n)}))}))}e.resize()},parseFetchAttributes:function(e){var n={};return e.attributes.forEach((function(e){var s=t.is(e.name,"string")?e.name.replace("ds6w:what/","").replace("ds6w:when/","").replace("ds6w:who/",""):e.name;"ds6w:type"===s&&(n.type=e.value),"ds6w:i3dx"===s&&""!=e.value&&(n.id=e.value),"resourceid"!==s||null!=n.id&&""!=n.id||(n.id=e.value),"ds6w:identifier"===s&&(n.identifier=e.value),"ds6w:label"===s&&(n.label=e.value),"ds6wg:revision"===s&&(n.revision=e.value),"type_icon_url"===s&&(n.icon=e.value),"ds6w:kind"===s&&(n.kind=e.value)})),n},hideContextFilter:function(){var e=this;e.elements.pageToolbarContainer=document.getElementsByClassName("page-toolbar-view-container")[0],e.elements.dataGridView=document.getElementsByClassName("im-layout")[0],e.elements.pageToolbarContainer.removeClassName("isu-contextFilter-enabled"),e.elements.dataGridView.removeClassName("isu-contextFilter-enabled"),e.filterDiv&&e.filterDiv.hide(),e.autoCompleteFilter.selectedItems&&(e.autoCompleteFilter.selectedItems=[]),widget.setValue(T,!1)},makeDroppable:function(e){var n=this;n.toolbarContainer=document.getElementsByClassName("action-bar")[0].getChildren()[0],g.droppable(e,{drop:function(s,i,o){if(o.stopPropagation&&(o.stopPropagation(),n.toolbarContainer.removeClassName("dragEnter-dnd-issue")),o.preventDefault&&(o.preventDefault(),n.toolbarContainer.removeClassName("dragEnter-dnd-issue")),o.dataTransfer&&o.dataTransfer.dropEffect&&(o.dataTransfer.dropEffect="copy",n.toolbarContainer.removeClassName("dragEnter-dnd-issue")),t.is(s)&&""!=s){var a=JSON.parse(s).data.items;t.is(a)&&t.is(a.length)&&a.length>0&&n.dropFilterObject(a),n.toolbarContainer.removeClassName("dragEnter-dnd-issue")}else f.displayNotification({msg:D.filter.filterbyobject.dropNotSupported,eventID:"error"});n.toolbarContainer.removeClassName("dragEnter-dnd-issue"),e.style.borderWidth="0px"},over:function(){arguments[0].setStyles({borderStyle:"solid",borderColor:"#368ec4",borderWidth:"1px"}),n.toolbarContainer.removeClassName("dragEnter-dnd-issue")},leave:function(){arguments[0].setStyle("borderWidth","0px"),n.toolbarContainer.removeClassName("dragEnter-dnd-issue")}})},dropFilterObject:function(e){var t=this;if(e.length>0)if(v.updateI3DxIds(e),e[0].serviceId.toLowerCase().includes("3dspace")||e[0].hasOwnProperty("i3dx")&&""!=e[0].i3dx){var n=e[0].i3dx&&""!=e[0].i3dx?e[0].i3dx:e[0].objectId,s=e[0].serviceId;b.fetch({data:{objects:[{physicalId:n}]},onComplete:function(e){var n=e.body;if(n.results&&n.results.length>0){t.modelForFilter.prepareUpdate();var i=n.results[0],o=t.parseFetchAttributes(i);o.revision=void 0===o.revision?"":o.revision,o.identifier=void 0===o.identifier?"":" ("+o.identifier+")";var a=o.label+" "+o.revision+o.identifier,r=new m({label:a,value:o.id,name:o.identifier,id:o.id,icon:o.icon,type:o.type,kind:o.kind,serviceId:s});t.modelForFilter.addRoot(r),t.modelForFilter.pushUpdate(),t.autoCompleteFilter.selectedItems=r}else f.displayNotification({msg:D.filter.filterbyobject.dropNotSupported,eventID:"error"})},onFailure:function(e){f.displayNotification({msg:D.filter.filterbyobject.dropNotSupported,eventID:"error"})}})}else f.displayNotification({msg:D.filter.filterbyobject.dropNotSupported,eventID:"error"})},searchContext:function(){var e=this;y.search({default_search_criteria:"",precond:"",multiSel:!1,callback:function(t){v.updateI3DxIds(t);var n=t[0];if(n.sourceid.toLowerCase().includes("3dspace")||n.hasOwnProperty("ds6w:i3dx_value")&&""!=n["ds6w:i3dx_value"]){e.modelForFilter.prepareUpdate(),n["ds6wg:revision"]=void 0===n["ds6wg:revision"]?"":n["ds6wg:revision"],n["ds6w:identifier"]=void 0===n["ds6w:identifier"]?"":" ("+n["ds6w:identifier"]+")";var s=n["ds6w:label"]+" "+n["ds6wg:revision"]+n["ds6w:identifier"],i=n["ds6w:i3dx_value"]&&""!=n["ds6w:i3dx_value"]?n["ds6w:i3dx_value"]:n.id,o=new m({label:s,value:n.id,name:n["ds6w:identifier"],id:i,icon:n.type_icon_url,type:n["ds6w:type_value"],kind:n["ds6w:kind"],serviceId:n.sourceid});e.modelForFilter.addRoot(o),e.modelForFilter.pushUpdate(),e.autoCompleteFilter.selectedItems=o}},cancel:function(){}})},getContextualMenu:function(){var e=this;e.isRemoveDialogOpen=!!e.isRemoveDialogOpen&&e.isRemoveDialogOpen,e.isSettingsDialogOpen=!!e.isSettingsDialogOpen&&e.isSettingsDialogOpen;var t=[];return e.getOpenWithMenu().then((function(e){t=t.concat(e)})).then((function(){return t.push({name:"Settings",title:D.filter.filterbyobject.menu.settings.title,type:"PushItem",icon:"cog",data:null,action:{callback:function(){e.createSettingsDialog()}}}),t.push({type:"SeparatorItem"}),widget.getValue(E)&&t.push({name:"Information",title:D.filter.filterbyobject.menu.information,type:"PushItem",icon:"info-open-in-a-new-window",data:null,action:{callback:function(){var e=widget.getValue(E).id;const t=widget.getValue(E).serviceId;v.viewProperties(e,t)}}}),t}))},getOpenWithMenu:function(){var e=[],n=widget.getValue(E);return""===n||void 0===n?Promise.resolve([]):new Promise((function(s){S.start(name+" getOpenWithMenu");var i=[],o=[],a=[];a.push(n.type),n.kind&&""!=n.kind&&a.push(n.kind),o.push(n.type),i.push({envId:y.getTenant(),serviceId:n.serviceId?n.serviceId:"3DSpace",objectId:n.id,objectType:n.type,objectTaxonomies:a,displayName:n.label?n.label:n.name}),b.getTypesHierarchy({types:o,onComplete:function(n){if(t.is(n.types_hierarchies,"array")&&n.types_hierarchies.forEach((function(e,t){i.forEach((function(t,n){t.objectTaxonomies[0]===e.type&&(t.objectTaxonomies=t.objectTaxonomies.concat(e.hierarchy))}))})),0===i.length)return S.end(name+" getOpenWithMenu"),void s(e);var o=I.get("widget")||window.widget;w.getOpenWith().set3DXContent({protocol:"3DXContent",version:"1.1",source:o.name,widgetId:o.id,data:{items:i}},!0).retrieveCompatibleApps((function(t){if(t&&t.length>0){var n=[],i=[];if(t.forEach((function(e){i={name:e.text.replace(/ /g,""),type:"PushItem",title:e.text,action:{callback:e.handler}},null!=e.fonticon?i.fonticon={content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+e.fonticon}:e.className&&1==e.className.contains("app-widget")?i.icon={iconPath:e.icon,className:"issue-widget"}:i.icon=e.icon,n.push(i)})),n.length>0){var o={name:"OpenWith",type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-open-menu-dot"},title:D.filter.filterbyobject.menu.openwith,submenu:n};e.push(o),e.push({type:"SeparatorItem"})}}s(e)})),S.end(name+" getOpenWithMenu")},onFailure:function(t){s(e)}})}))},createSettingsDialog:function(){var e=this;if(!e.isSettingsDialogOpen){var n=!1,s=t.createElement("div",{class:"context-settings"}),i=t.createElement("div",{class:"filter-settings"}),o=t.createElement("div",{class:"filter-by",html:[t.createElement("span",{class:"filter-by-label",html:D.filter.filterbyobject.menu.settings.filterby}),t.createElement("div",{class:"filter-by-label wux-ui-3ds-required wux-ui-3ds"})]}),c=void 0===widget.getValue(A)||widget.getValue(A),p=void 0===widget.getValue(_)||widget.getValue(_),m=void 0===widget.getValue(M)||widget.getValue(M);c||p||m||(n=!0);var g=new l({type:"checkbox"}),f=new r({type:"checkbox",label:D.filter.filterbyobject.menu.settings.affectedItem,checkFlag:c,value:"AffectedItem"}),h=new r({type:"checkbox",label:D.filter.filterbyobject.menu.settings.resolvedItem,checkFlag:p,value:"ResolvedItem"}),v=new r({type:"checkbox",label:D.filter.filterbyobject.menu.settings.context,checkFlag:m,value:"Context"});if(g.addChild(f),g.addChild(h),g.addChild(v),o.inject(i),g.inject(i),g.addEventListener("change",(function(t){0===g.value.length?e.settingsDialog.buttons.Yes.disabled=!0:e.settingsDialog.buttons.Yes.disabled=!1})),i.inject(s),!I.get(N)){var b=t.createElement("div",{class:"create-settings"});t.createElement("div",{class:"create-label",html:D.filter.filterbyobject.menu.settings.issueCreation}).inject(b);var y=!!widget.getValue(x)&&widget.getValue(x),w=!widget.getValue(O)||widget.getValue(O),S=!!widget.getValue(P)&&widget.getValue(P),C=new r({type:"switch",label:D.filter.filterbyobject.menu.settings.createSetting,checkFlag:y,value:"createSetting"});C.inject(b),C.addEventListener("change",(function(e){C.checkFlag?T.show():T.hide()}));var T=new l({type:"radio"});f=new r({type:"radio",label:D.filter.filterbyobject.menu.settings.affectedItem,checkFlag:w,value:"AffectedItem"}),v=new r({type:"radio",label:D.filter.filterbyobject.menu.settings.context,checkFlag:S,value:"Context"});T.addChild(f),T.addChild(v),T.inject(b),C.checkFlag?T.show():T.hide(),b.inject(s)}var E=new d({}),V=document.getElementsByClassName("issue-list")[0];E.inject(V),e.settingsDialog=new u({immersiveFrame:E,title:D.filter.filterbyobject.menu.settings.title,content:s,activeFlag:!1,modelFlag:!0,domId:"filterSettings",width:400,buttons:{No:new a({label:D.filter.filterbyobject.menu.settings.cancel,domId:"applySettingsNo",onClick:function(t){E.destroy(),e.isSettingsDialogOpen=!1}}),Yes:new a({label:D.filter.filterbyobject.menu.settings.apply,domId:"applySettingsYes",disabled:n,onClick:function(t){widget.setValue(A,g.value.includes("AffectedItem")),widget.setValue(_,g.value.includes("ResolvedItem")),widget.setValue(M,g.value.includes("Context")),I.get(N)||(widget.setValue(x,C.checkFlag),widget.setValue(O,T.value.includes("AffectedItem")),widget.setValue(P,T.value.includes("Context"))),E.destroy(),e.isSettingsDialogOpen=!1,e.autoCompleteFilter.selectedItems&&(widget.dispatchEvent("onRefresh",["filter"]),widget.dispatchEvent("endEdit"))}})}}),e.isSettingsDialogOpen=!0,e.settingsDialog.addEventListener("close",(function(t){E&&E.destroy(),e.isSettingsDialogOpen=!1}))}},refresh:function(){this.destroy(),this.render(),I.get("actionBar").updateFilterMenu()},resize:function(){var e,t,n=this,s=I.get("actionBar");if(n.elements.pageToolbarContainer=document.getElementsByClassName("page-toolbar-view-container")[0],n.elements.dataGridView=document.getElementsByClassName("im-layout")[0],null!=document.getElementById("filterByObjectToolbar")&&null!=document.getElementById("filterByObjectToolbar")&&(t=(e=document.getElementById("filterByObjectToolbar").getParent()).getParent()),null!=n.filterDiv&&null!=e&&null!=t&&widget.getValue(T))if(e.getBoundingClientRect().left-s.container.getBoundingClientRect().left<500){if(null!=n.autoCompleteFilter){n.filterDiv.inject(s.container.parentElement),n.elements.pageToolbarContainer.addClassName("isu-contextFilter-enabled");var i=C.getDeviceUsedForOperation();"Desktop"==i||"Tab"==i?n.elements.pageToolbarContainer.addClassName("desktop"):n.elements.pageToolbarContainer.addClassName("mobile"),n.elements.dataGridView.addClassName("isu-contextFilter-enabled"),n.autoCompleteFilter.getContent().setStyle("width","inherit")}}else t.insertBefore(n.filterDiv,t.firstChild),n.elements.pageToolbarContainer.removeClassName("isu-contextFilter-enabled"),n.elements.dataGridView.removeClassName("isu-contextFilter-enabled")},destroy:function(){this.elements={bar:null,menu:null},this.container.empty()},utils:{debounce:function(e,t,n){var s;return function(){var i=this,o=arguments,a=n&&!s;clearTimeout(s),s=setTimeout((function(){s=null,n||e.apply(i,o)}),t),a&&e.apply(i,o)}}}});return V})),define("DS/IssueManagement/views/dragAndDrop/DragAndDropView",["UWA/Class/Promise","UWA/Core","UWA/Class/View","DS/Controls/Button","DS/IssueManagement/utils/DragAndDrop","i18n!DS/IssueManagement/assets/nls/IssueManagement","css!DS/IssueManagement/IssueManagement.css"],(function(e,t,n,s,i,o){return n.extend({name:"DS/IssueManagement/views//dragAndDrop/dragAndDropView",tag:"div",className:"isu-dragAndDropView",elements:{dismissButton:null,dndContainer:null},setup:function(e){this.options=e},render:function(){var e=this;return e._container=t.createElement("div",{class:"isu-dragAndDropView-container"}),e.options.dismissButton&&e.createDismissButton(),e.createDnDContainer(),e.container.appendChild(e._container),e._subscribers(),e},createDismissButton:function(){var e=this;e.elements.dismissButton=new s({domId:"dndDismissButton",icon:{iconName:"close",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"1x"},label:o.dismiss,onClick:function(){e.container.hide()}}),e._container.appendChild(e.elements.dismissButton.elements.container)},createDnDContainer:function(){var e=this;e.elements.dndContainer=t.createElement("div",{class:"im-DnDContainer"}),e.options.dndElements.forEach((n=>{var s=t.createElement("div",{class:e.options.dndElements.length>1?"im-DnDContainer-button isu-multi-container":"im-DnDContainer-button",html:[t.createElement("span",{class:"fonticon fonticon-"+n.icon+" isu-dnd-icon"}),t.createElement("span",{class:"isu-dnd-label",html:n.nls})]}).inject(e.elements.dndContainer);e.options.dndElements.lenght>1&&s.setStyle("width",e.elements.dndContainer.getDimensions("width").width/e.options.dndElements.length)})),e._container.appendChild(e.elements.dndContainer)},_subscribers:function(){var e=this;e.container.addEventListener("drop",(function(t,n,s){e.container.hide()})),e.elements.dndContainer.addEventListener("dragleave",(function(e){e.stopPropagation(),e.preventDefault()})),e.container.addEventListener("dragleave",(function(t,n,s){t.stopPropagation(),t.preventDefault(),e.container.hide()})),e.elements.dismissButton&&e.elements.dismissButton.addEventListener("dragenter",(function(){e.container.hide()})),i.makeDroppable(e.container,e.options.callback)},_onDismissButtonHover:function(){this.container.hide()}})})),define("DS/IssueManagement/components/welcomePanel/router/Router",["UWA/Class","DS/IssueManagement/components/welcomePanel/router/RouterUtils"],(function(e,t){"use strict";var n=e.singleton({initialize:function(e,n){null!=e&&""!=e||(e="home"),null!=n&&""!=n||(n="/home");var s=[{name:e,path:n}];this._router=t.createRouter(s,{defaultRoute:e,defaultParams:{},trailingSlash:!1,useTrailingSlash:void 0,autoCleanUp:!1,strictQueryParams:!0,allowNotFound:!1},!0,!0),this._router._isReadyToNavigate=!0,t.listenToRouterStateChanges(this._router)},canNavigate:function(){return this._router._isReadyToNavigate},changeNavigationState:function(e){this._router._isReadyToNavigate=e},addRoute:function(e){this._router.add(e)},addRouteMethods:function(e,t){this._router.routerMethods||(this._router.routerMethods={}),UWA.is(t,"object")&&(this._router.routerMethods[e]=t)},start:function(e){this._router.start.apply(this._router,arguments)},navigate:function(){this._router.navigate.apply(this._router,arguments)},getRouter:function(){return this._router},setDependency:function(e,t){this._router.setDependency(e,t)},getDependency:function(e){return this._router.getDependencies()[e]}});return n})),define("DS/IssueManagement/views/datagrid/DataGrid",["UWA/Core","UWA/Class/Promise","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/DataGridView/DataGridView","DS/CollectionView/CollectionViewStatusBar","DS/Controls/TooltipModel","DS/IssueCommon/utils/Utils","DS/IssueComponents/utils/Utils","DS/IssueComponents/users/Users","DS/IssueManagement/commands/CommandsManager","DS/IssueManagement/utils/DragAndDrop","DS/IssueManagement/components/ContextualMenu","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","DS/IssueServices/services/PlatformServices","DS/Controls/Button","text!DS/IssueManagement/assets/Settings.json","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueComponents/assets/nls/IssueComponents","i18n!DS/IssueCommon/assets/nls/IssueCommon","text!DS/IssueCommon/assets/Settings.json","css!DS/IssueManagement/IssueManagement.css"],(function(e,t,n,s,i,o,a,r,l,c,d,u,p,m,g,f,h,v,I,b,y,w){"use strict";var S="Issue",C={CREATE:1,ASSIGN:2,ACTIVE:3,REVIEW:4,CLOSED:5},D="Low",T="Medium",E="High",A="Urgent",_={LOW:1,MEDIUM:2,HIGH:3,URGENT:4},M="ds6w:",N={COMPACT:"compact",COMFORTABLE:"comfortable",COMPACT_HEIGHT:26,COMFORTABLE_HEIGHT:38},x=this,O=i.extend({name:"DS/IssueManagement/views/list/TreeList",_logger:null,component:null,document:null,settings:{},_predicates:[],_ghost:null,init:function(i){var o=this;o.container=i.container,i.cellSelection="none",i.cellDragEnabledFlag=!1,i.showRowIndexFlag=!1,o.summaryview="datagrid",g.start(o.name+" init"),x=o,o._logger=n.getLogger("DS/IssueManagement/View"),o.component=i.component,o.document=i.document,o.datagridSettings=i.settings,o.settings=JSON.parse(v),o._predicates=[],i.columns.forEach((function(e){switch(e.text=o.getHeader(e.dataIndex,e.text),e.text){case"Affected Items":e.icon={iconName:"location",fontIconFamily:WUXManagedFontIcons.Font3DS};break;case"Resolved By":e.icon={iconName:"resolved-by",fontIconFamily:WUXManagedFontIcons.Font3DS};break;case"Contexts":e.icon={iconName:"3d-object",fontIconFamily:WUXManagedFontIcons.Font3DS}}})),o.utils._originalColumns=i.columns.slice();for(var a=0;a<i.columns.length;a++)!0===i.columns[a].isIndexed&&o._predicates.push(i.columns[a].dataIndex);return o.custom_view_options={dgvHandle:null,ootb_columns:[],dgvDiv:null,settings:{url:f.get3DSpaceUrl(),securityContext:f.getSecurityContexts().securityContext,isNative:m.get("isNatifEnvironnement"),iterateRootNodesOnly:!0}},o.customColInfo=i.customColInfo,o._parent(i),o.preferences.getViewModePreference()===N.COMFORTABLE?this.layout.cellHeight=N.COMFORTABLE_HEIGHT:this.layout.cellHeight=N.COMPACT_HEIGHT,o.layout.setColumnOrGroupProperties("ContextualMenuColumn",{text:I.columns.actionsColumn,width:55,isHidden:!1,visibleFlag:!0,defaultVisibility:!0}),o.layout.columns.filter((e=>"ContextualMenuColumn"==e.dataIndex)).forEach((e=>e.export={value:!1,lock:!1})),o._customizeColumnSorting(i.columns),o._customizeColumnRendering(i.columns),o.addEventListener("columnOrderChange",(function(e){preventDefault(),o.preferences.savePreferences({columns:!0})})),o.addEventListener("click",o.doOnTreeNodeClick.bind(o)),o.addEventListener("dblclick",o.doOnTreeNodeDblClick.bind(o)),o.addEventListener("keyup",(function(e){if("Delete"===e.key)d.getCommand("Delete").begin();else if("ArrowUp"===e.key||"ArrowDown"===e.key||"Enter"===e.key){var t=o.getCellInfosAt(o.getActiveCellID());o.doOnTreeNodeClick(e,t)}})),o.addEventListener("touchstart",(function(e){var t=e.timeStamp;o.addEventListener("touchstart",(function(e,n){e.timeStamp-t<300&&o.doOnTreeNodeDblClick(e,n)}))})),o.onContextualEvent=async function(e){if(e){var n=e.cellInfos;if(void 0!==n&&-1!==n.rowID&&(this.getTreeDocument().prepareBroadcastSelect(),this.getTreeDocument().pushBroadcastSelect()),-1===n.rowID&&e.collectionView){return e.collectionView.buildDefaultContextualMenu(e,{pin:!0,firstColumnsVisibility:!1,columnsManagement:!1,sizeColumnToFit:!0,filter:!0})}if(n.nodeModel){var s=m.get("component"),i=s.getTreeDocument().getSelectedNodes().filter((e=>{if(e.options.reportedAgainst.length>0&&!e.options.reportedAgainst[0].hasOwnProperty("type")||e.options.contexts.length>0&&!e.options.contexts[0].hasOwnProperty("type")||e.options.resolvedBy.length>0&&!e.options.resolvedBy[0].hasOwnProperty("type")||e.options.resolvedItems.length>0&&!e.options.resolvedItems[0].hasOwnProperty("type"))return e}));return await s.loadInfo_fetchV2(i),!1===n.nodeModel.isSelected()&&(n.nodeModel.select(!0),o.document.prepareBroadcastSelect(),o.document.pushBroadcastSelect()),p.getContextualMenu(n.nodeModel)}return t.resolve()}return t.resolve()},o._registerReusableCellContent(),o.getCellTooltip=function(e){return-1==e.rowID?this.component.list.getCellDefaultTooltip(e):void 0!==e.cellView.collectionView.columns[e.columnID]&&void 0!==e.nodeModel?o.switchCaseFunc(e):void 0},o.onDragOverCell=function(e,t){return e.preventDefault(),e.dataTransfer.dropEffect="copy",e.dataTransfer.effectAllowed="copy",void 0!==t&&(t.dropPosition="middle"),!0},o.onDropCell=function(e,t){e.preventDefault();var n=null,i=(n=t.nodeModel.options.baseType!==S?t.nodeModel.getParent():t.nodeModel).options.id,o=n.options.type,a=n.options.name,l=n.options.title,c=u.getDroppableData(e);if(r.updateI3DxIds(c.data.items),c.hasOwnProperty("files")&&c.files instanceof FileList)u.related.uploadFilesAsAttachments.call(this,{node:n,id:i,type:o,name:a,title:l},c.files);else{if(!r.isValid3DXContent(c)||!c.data.items.length)return s.displayNotification({msg:I.dnd.notSupported,eventID:"warning"}),!1;u.related.addRelatedObjects.call(this,{node:n,id:i,type:o,name:a,title:l},c.data.items,e)}return!0},o.onDragEnterBlank=function(e,t){console.log("inside drag enter blank");var n=document.getElementsByClassName("isu-dragAndDropView")[0];n&&n.show(),document.getElementById("dndDismissButton").show()},o.onDragColumnHeader=function(e,t){console.log("inside column header"),widget.setValue("dragColumnHeader",!0)},o.onDragStartCell=function(t,n){var s=o.document.getSelectedNodes(),i=u.setDroppableData(s);o.getTreeDocument().prepareBroadcastSelect(),o.getTreeDocument().pushBroadcastSelect(),t.dataTransfer.setData(i.type,i.data);var a=n.nodeModel.options;return null!==o._ghost&&(o._ghost.destroy(),o._ghost=null),o._ghost=e.createElement("div",{class:"issue-ghost-container",html:[e.createElement("div",{class:"issue-ghost-panel",html:[e.createElement("img",{class:"issue-ghost-image",src:n.nodeModel.options.icons[n.nodeModel.options.icons.length-1]}),e.createElement("div",{class:"issue-ghost-title",html:r.getTextFromHTML(e.String.escapeHTML(a.title))+" ("+r.getTextFromHTML(a.name)+")"})]}),e.createElement("span",{class:"issue-ghost-counter",html:s.length})]}),o._ghost.setStyle("transform","translate3d(0,0,0)"),document.body.appendChild(o._ghost),t.dataTransfer.setDragImage(o._ghost,t.offsetX,t.offsetY),!0},g.end(o.name+" init"),o},load:function(e){var t=this;return g.start(t.name+" load"),null!=e&&(t.document=e),t.getCustomViewsManager().onCustomViewsSave=function(e,n){t.saveCustomColumns(),l.applyCustomAttributes(e,n,t.custom_view_options)},t.sortModel=[{dataIndex:"ds6w:created",sort:"desc"}],r.setColumnFilteringOnAllColumns(t),g.end(t.name+" load"),t},restoreCustomView:function(){var e=this;l.buildCustomViewOptions(this,this.container),l.registerCustomEventsOnDGV(this),l.applyCustomViews(this).then((t=>{e.saveCustomColumns()})).catch((e=>{}))},restoreCustomView_V2:async function(){l.buildCustomViewOptions(this,this.container),l.registerCustomEventsOnDGV(this);var e=widget.getValue("customColumnsIndex")?widget.getValue("customColumnsIndex"):[];await l.applyCustomAttributes_V2(this.custom_view_options,e)},getManager:function(){return x.component.list},getColumns:function(){return x.component.list.columns},destroy:function(){var e=this;e.utils._debounceTimeouts.forEach((function(e){clearTimeout(e)})),e.utils._debounceTimeouts=[],e._parent()},doOnTreeNodeClick:function(e,t){if(e&&void 0!==t){this.getTreeDocument().prepareBroadcastSelect(),this.getTreeDocument().pushBroadcastSelect();var n=e.dsModel.layout.getDataIndexFromColumnIndex(t.columnID);"ds6w:revision"==n&&"Issue"!=t.nodeModel.options.type&&""!=t.nodeModel.options.revision&&"-"!=t.nodeModel.options.revision&&this.actionOnClick(t),"ds6w:state"==n&&-1!=t.rowID&&e.detail<2&&this.launchMaturityPopup(t)}},launchMaturityPopup:function(){var e=this;require(["DS/IssueComponents/external/CollaborativeLifecycle"],(function(t){for(var n=[],s=e.document.getSelectedNodes(),i=0;i<s.length;i++)n.push(s[i].options.id);t.execute(n)}))},actionOnClick:function(t){t?r.showRevisionModal(t):e.log("Issue management Version Explorer : Invalid type...")},doOnTreeNodeDblClick:function(e,t){e&&void 0!==t&&-1!=t.rowID&&(widget.setValue("fromDataGridDoubleClick",!0),widget.setValue("contentFacet",!1),d.getCommand("ToggleInformationPanel")&&d.getCommand("ToggleInformationPanel").begin({save:!0}))},modifyColumnRendering:function(n){var s=this;return new t((function(t){setTimeout((function(){g.start(s.name+" modifyColumnRendering");var i=e.is(n,"string")?JSON.parse(n):n,o=s.getColumnOrGroup(i.dataIndex);if(void 0!==o){var a=o.text;if(i.headerName&&i.headerName!==a&&(o.text=i.headerName,!0),o.isHidden=!0===o.isHidden,void 0!==i.isHidden&&i.isHidden!==o.isHidden&&(o.isHidden?(x.component.list.layout.setColumnVisibleFlag(o.dataIndex,!0),o.isHidden=!1):(x.component.list.layout.setColumnVisibleFlag(o.dataIndex,!1),o.isHidden=!0)),i.column_color){o.styles=i.column_color,o.styles||(o.styles={}),o.styles.color=i.column_color.color.replace(";",""),o.styles["background-color"]=i.column_color["background-color"].replace(";","");try{s.rendering.updateColumnStyles(o.dataIndex,o.styles)}catch(e){x._logger.warn("Could not set the column styles because %",e)}}}g.end(s.name+" modifyColumnRendering"),t()}),0)}))},resetColumnRendering:function(){var e=this;g.start(e.name+" resetColumnRendering"),require(["text!DS/IssueManagement/assets/IssueManagement.dataGrid.json"],(function(t){var n=JSON.parse(t),s=n.columns;e.component.list.getColumns().forEach((function(t){if("ContextualMenuColumn"==t.dataIndex)t.isHidden=!1,t.visibleFlag=!0,t.defaultVisibility=!0;else{var n=1==t.defaultVisibility;t.isHidden=!n}e.component.list.layout.setColumnVisibleFlag(t.dataIndex,n)})),s.forEach((function(t){t.text=e.getHeader(t.dataIndex)})),n.specificColumns.forEach((function(e){s.splice(e.colIndex,0,{width:e.width,maxWidth:e.maxWidth,minWidth:e.minWidth,dataIndex:e.dataIndex,isDraggable:e.isDraggable,isHidden:e.isHidden})})),e._customizeColumnSorting(s),e._customizeColumnRendering(s),g.end(e.name+" resetColumnRendering")}))},getHeader:function(e,t){var n=m.get("widget")||window.widget,s=this.datagridSettings.list.columns;return s&&s.default&&s.default[e]?I.columns[s.default[e]]:s&&s.custom&&s.custom[e]?s.custom[e][n.lang]:t&&""!=t?t:e},getTreeDocument:function(){return this.document},getPredicates:function(){return this._predicates},_customizeColumnRendering:function(e){var t=this,n=null;widget.getValue("wux-collectionView-dataGridView")&&(n=JSON.parse(widget.getValue("wux-collectionView-dataGridView")).ISUSummaryView),e.forEach((function(e){switch(null==e.visibleFlag&&(e.visibleFlag=!0),n&&n.columnsVisibleFlag&&n.columnsVisibleFlag.hasOwnProperty(e.dataIndex)&&(e.visibleFlag=n.columnsVisibleFlag[e.dataIndex]),e.dataIndex){case"ds6w:biColor":e.onCellRequest=t.rendering.biColor;break;case"ds6w:state":e.getCellClassName=t.styling.state;break;case"ds6w:assignees":e.onCellRequest=t.rendering.assignees;break;case"ds6w:priority":e.onCellRequest=t.rendering.priority;break;case"ds6w:contributors":e.onCellRequest=t.rendering.contributors;break;case"ds6w:informedUsers":e.onCellRequest=t.rendering.informedUsers;break;case"ds6w:originator":e.onCellRequest=t.rendering.originator;break;case"ds6w:validation":e.onCellRequest=t.rendering.validation;break;case"ds6w:owner":e.onCellRequest=t.rendering.owner;break;case"ds6w:coOwners":e.onCellRequest=t.rendering.coOwners;break;case"ds6w:reportedAgainst":e.onCellRequest=t.rendering.isReportedAgainstPresent;break;case"ds6w:resolvedBy":e.onCellRequest=t.rendering.isResolvedByPresent;break;case"ds6w:contexts":e.onCellRequest=t.rendering.isContextsPresent;break;case"ds6w:isLastRevision":e.onCellRequest=t.rendering.isLastRevision;break;case"ds6w:revision":e.getCellValue=t.rendering.revision;break;case"ds6w:resolutionDate":e.onCellRequest=t.rendering.date;break;default:if(e.isCustomColumn){var s={that:t,attr:{name:e.dataIndex}};e.getCellValue=t.rendering.classificationAttributes.bind(s)}}}))},_customizeColumnSorting:function(e){var t=this;e.forEach((function(e){var n=e.dataIndex.replace(M,"");switch(e.dataIndex){case"tree":e.compareFunction=t.sorting.title;break;case"ds6w:name":e.compareFunction=t.sorting.name(!1);break;case"ds6w:description":e.compareFunction=t.sorting.description(!1);break;case"ds6w:created":case"ds6w:modified":case"ds6w:estimatedStartDate":case"ds6w:estimatedEndDate":case"ds6w:actualStartDate":case"ds6w:actualEndDate":case"ds6w:resolutionDate":break;case"ds6w:priority":case"ds6w:state":e.compareFunction=t.sorting.enumeration(n);break;case"ds6w:validation":e.compareFunction=t.sorting.validation(n);break;case"ds6w:assignees":e.compareFunction=t.sorting.assignees;break;case"ds6w:contributors":e.compareFunction=t.sorting.contributors;break;case"ds6w:informedUsers":e.compareFunction=t.sorting.informedUsers;break;case"ds6w:originator":e.compareFunction=t.sorting.originator;break;case"ds6w:owner":e.compareFunction=t.sorting.owner;break;case"ds6w:coOwners":e.compareFunction=t.sorting.coOwners;break;default:!0===e.custom&&(e.compareFunction=t.sorting.custom(n))}}))},_registerReusableCellContent:function(){var t=this;t.registerReusableCellContent({id:"biColorCell",buildContent:function(){return e.createElement("div",{class:"bi-color-cell"})}}),t.registerReusableCellContent({id:"validationloading",buildContent:function(){return e.createElement("div",{class:"container-loading-ring-cell",html:e.createElement("div",{class:"loading-ring-cell",html:"<div></div><div></div><div></div><div></div>"})})}}),t.registerReusableCellContent({id:"validation",buildContent:function(){return e.createElement("div",{class:"container-validation-none-cell",html:e.createElement("span",{class:""})})}}),t.registerReusableCellContent({id:"validationactive",buildContent:function(){return e.createElement("div",{class:"container-validation-active-cell",html:e.createElement("span",{class:"fonticon fonticon-route-start"})})}}),t.registerReusableCellContent({id:"dummy",buildContent:function(){return e.createElement("div",{class:"dummy-container"})}})},switchCaseFunc:function(e){var t="";switch(e.cellView.collectionView.columns[e.columnID].dataIndex){case"ds6w:assignees":(t=e.nodeModel.options.assignees.reduce((function(e,t){return e+t.fullName+" ("+t.user+"), "}),"")).length>0&&(t=(t=t.trim()).substring(0,t.length-1));break;case"ds6w:contributors":(t=e.nodeModel.options.contributors.reduce((function(e,t){return e+t.fullName+" ("+t.user+"), "}),"")).length>0&&(t=(t=t.trim()).substring(0,t.length-1));break;case"ds6w:informedUsers":(t=e.nodeModel.options.informedUsers.reduce((function(e,t){return e+t.fullName+" ("+t.user+"), "}),"")).length>0&&(t=(t=t.trim()).substring(0,t.length-1));break;case"ds6w:coOwners":(t=e.nodeModel.options.coOwners.reduce((function(e,t){return e+t.fullName+" ("+t.user+"), "}),"")).length>0&&(t=(t=t.trim()).substring(0,t.length-1));break;case"ds6w:validation":t=e.nodeModel.options.validation.toString();break;default:return this.component.list.getCellDefaultTooltip(e)}return{shortHelp:t}},saveCustomColumns:function(){var e=this.getColumns(),t=[],n=[];e.forEach((e=>{var s=!1,i={};Object.keys(e).forEach((t=>{"_parent"!==t&&"children"!==t&&(i[t]=e[t])})),1==i.visibleFlag&&!0!==i.isOOTBColumn&&(s=!0,n.push(i.dataIndex)),e.children&&Array.isArray(e.children)&&(i.children=[],e.children.forEach((e=>{var t={};Object.keys(e).forEach((n=>{"_parent"!==n&&(t[n]=e[n])})),1==t.visibleFlag&&!0!==t.isOOTBColumn&&(s=!0,i.children.push(t),n.push(t.dataIndex))}))),s&&t.push(i)})),widget.setValue("customColumns",t),widget.setValue("customColumnsIndex",n)},rendering:{biColor:function(e){!1===e.manager.getColumnOptions("biColor").isHidden&&(e.isHeader||(e.cellView.reuseCellContent("biColorCell").style["background-color"]=e.nodeModel.options.grid.biColor))},revision:function(e){if(e.nodeModel)return{label:e.nodeModel.options.revision}},classificationAttributes:function(t){if(-1===t.rowID||t.nodeModel.options.baseType!=S)return;let n=t.nodeModel.options.grid[this.attr.name];if(void 0!==n)return e.is(n,"string")&&(n=n.replaceAll("",", ")),n;this.that.getTreeDocument().autoFill.classificationAttributes(t.nodeModel.options.physicalId,this.attr.name)},validation:function(t){if(-1!==t.rowID){g.start(x.name+" rendering validation");var n=t.nodeModel.options.validation;if(!0!==n.activated)t.cellView.reuseCellContent("validation");else{var s=e.createElement("div",{class:"validation-cell-container"});if(!0===n.fetched){var i=null;switch(n.status){case"inProgress":s.append(e.createElement("div",{class:"im-routes-cell-status",html:e.createElement("div",{class:"fonticon fonticon-clock in-progress"})}));break;case"approved":i=e.createElement("div",{class:"fonticon fonticon-check approved"});case"rejected":i=i||e.createElement("div",{class:"fonticon fonticon-wrong rejected"}),s.append(e.createElement("div",{class:"im-routes-cell-status",html:i}));break;case"notStarted":return void t.cellView.reuseCellContent("validationactive")}for(var o=t.nodeModel.options.validation.decisions,r=[],l=0;l<o.length;l++){var d=o[l].reviewer;n.status===o[l].status&&r.push(d)}s.append(c.create({users:r})),t.cellView.setReusableContent(s);let u=t.nodeModel.options.validation.toString();s.tooltipInfos=new a({shortHelp:u,mouseRelativePosition:!1,position:"bottom"})}else t.cellView.reuseCellContent("validationloading"),this.getTreeDocument().autoFill.validation(t.nodeModel.options.physicalId)}g.end(x.name+" rendering validation")}},owner:function(t){if(g.start(x.name+" rendering owner"),-1!==t.rowID){var n=t.nodeModel.options,s=(n.owner.fullName,f.get3DSwymUrl()),i=c.create({users:[n.owner]}).addClassName("issue-owner-container");if(s)(o=new h({domId:"hyperlinkButton",displayStyle:"lite",label:n.owner.fullName})).addEventListener("click",(function(){f.getUserProfile(n.owner.user)}));else var o=e.createElement("span",{class:"userName issue-user-image issue-owner-full-name",html:n.owner.fullName});o.inject(i),t.cellView.setReusableContent(i);let r="";n.owner.fullName&&n.owner.user&&(r=n.owner.fullName+" ("+n.owner.user+")"),i.tooltipInfos=new a({shortHelp:r,mouseRelativePosition:!1,position:"bottom"})}g.end(x.name+" rendering owner")},originator:function(t){g.start(x.name+" rendering originator");var n=f.get3DSwymUrl();if(-1!==t.rowID){var s=t.nodeModel.options,i=c.create({users:[s.originator]}).addClassName("issue-owner-container");if(n)(o=new h({domId:"hyperlinkButton",displayStyle:"lite",label:s.originator.fullName})).addEventListener("click",(function(){f.getUserProfile(s.originator.user)}));else var o=e.createElement("span",{class:"userName issue-user-image issue-owner-full-name",html:s.originator.fullName});o.inject(i),t.cellView.setReusableContent(i);let r="";s.originator.fullName&&s.originator.user&&(r=s.originator.fullName+" ("+s.originator.user+")"),i.tooltipInfos=new a({shortHelp:r,mouseRelativePosition:!1,position:"bottom"})}g.end(x.name+" rendering originator")},priority:function(t){if(-1!==t.rowID){var n=x.component.list.reuseCellContent("dummy");if(t.nodeModel.options.baseType===S){var s=t.nodeModel.options.priority,i="",o="",a=y.priorities[s.toLowerCase()];switch(null==a&&(a=s),s){case D:o="low wux-ui-3ds wux-ui-3ds-level-low";break;case T:o="medium wux-ui-3ds wux-ui-3ds-level-medium";break;case E:o="high wux-ui-3ds wux-ui-3ds-level-high";break;case A:o="urgent wux-ui-3ds wux-ui-3ds-alert "}i=""==o?e.createElement("div",{class:"issue-list-priority",html:a}):e.createElement("div",{class:"issue-list-priority",html:[e.createElement("span",{class:"issue-list-priority-icon "+o}),e.createElement("span",{class:"issue-list-priority-name",html:a})]}),t.cellView.setReusableContent(i)}else t.cellView.setReusableContent(n)}},assignees:function(e){if(g.start(x.name+" rendering assignees"),-1!==e.rowID){var t=x.component.list.reuseCellContent("dummy"),n=e.nodeModel.options;if(n.assignees&&n.assignees.length){var s=n.assignees.map((function(e){return e})),i=c.create({users:s});e.cellView.setReusableContent(i);let t="";s.forEach((e=>{""!=t&&(t+=", "),"person"===e.type?t+=e.fullName+" ("+e.user+")":t+=e.fullName})),i.tooltipInfos=new a({shortHelp:t,mouseRelativePosition:!1,position:"bottom"})}else e.cellView.setReusableContent(t)}g.end(x.name+" rendering assignees")},contributors:function(e){if(g.start(x.name+" rendering contributors"),-1!==e.rowID){var t=x.component.list.reuseCellContent("dummy"),n=e.nodeModel.options;if(n.contributors&&n.contributors.length){var s=n.contributors.map((function(e){return e})),i=c.create({users:s});e.cellView.setReusableContent(i);let t="";s.forEach((e=>{""!=t&&(t+=", "),"person"===e.type?t+=e.fullName+" ("+e.user+")":t+=e.fullName})),i.tooltipInfos=new a({shortHelp:t,mouseRelativePosition:!1,position:"bottom"})}else e.cellView.setReusableContent(t)}g.end(x.name+" rendering contributors")},informedUsers:function(e){if(g.start(x.name+" rendering informedUsers"),-1!==e.rowID){var t=x.component.list.reuseCellContent("dummy"),n=e.nodeModel.options;if(n.informedUsers&&n.informedUsers.length){var s=n.informedUsers.map((function(e){return e})),i=c.create({users:s});e.cellView.setReusableContent(i);let t="";s.forEach((e=>{""!=t&&(t+=", "),"person"===e.type?t+=e.fullName+" ("+e.user+")":t+=e.fullName})),i.tooltipInfos=new a({shortHelp:t,mouseRelativePosition:!1,position:"bottom"})}else e.cellView.setReusableContent(t)}g.end(x.name+" rendering informedUsers")},coOwners:function(e){if(g.start(x.name+" rendering coOwners"),-1!==e.rowID){var t=x.component.list.reuseCellContent("dummy"),n=e.nodeModel.options;if(n.coOwners&&n.coOwners.length){var s=n.coOwners.map((function(e){return e})),i=c.create({users:s});e.cellView.setReusableContent(i);let t="";s.forEach((e=>{""!=t&&(t+=", "),"person"===e.type?t+=e.fullName+" ("+e.user+")":t+=e.fullName})),i.tooltipInfos=new a({shortHelp:t,mouseRelativePosition:!1,position:"bottom"})}else e.cellView.setReusableContent(t)}g.end(x.name+" rendering coOwners")},isContextsPresent:function(t){g.start(x.name+" rendering isContextsPresent");var n=x.component.list.reuseCellContent("dummy");if(t.nodeModel.options.baseType===S){var s=t.nodeModel.options.contexts,i=e.createElement("div",{class:"is-context-present"});this.rendering.contentWithHyperlink(s).inject(i),t.cellView.setReusableContent(i)}else t.cellView.setReusableContent(n);g.end(x.name+" rendering isContextsPresent")},isResolvedByPresent:function(t){g.start(x.name+" rendering isResolvedByPresent");var n=x.component.list.reuseCellContent("dummy");if(t.nodeModel.options.baseType===S){var s=t.nodeModel.options.resolvedBy,i=e.createElement("div",{class:"is-resolvedBy-present"});this.rendering.contentWithHyperlink(s).inject(i),t.cellView.setReusableContent(i)}else t.cellView.setReusableContent(n);g.end(x.name+" rendering isResolvedByPresent")},isReportedAgainstPresent:function(t){g.start(x.name+" rendering isReportedAgainstPresent");var n=x.component.list.reuseCellContent("dummy");if(t.nodeModel.options.baseType===S){var s=t.nodeModel.options.reportedAgainst,i=e.createElement("div",{class:"is-resolvedBy-present"});this.rendering.contentWithHyperlink(s).inject(i),t.cellView.setReusableContent(i)}else t.cellView.setReusableContent(n);g.end(x.name+" rendering isReportedAgainstPresent")},isLastRevision:function(t){g.start(x.name+" rendering isLastRevision");var n="";let s;"Issue"!=t.nodeModel.options.type&&""!=t.nodeModel.options.revision&&null!=t.nodeModel.options.revision?""===t.nodeModel.options.isLastRevision?(n=e.createElement("div",{}),s="",t.cellView.setReusableContent(n)):1==t.nodeModel.options.isLastRevision?(n=e.createElement("div",{class:"isLastRevisionTrue wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-check"}),s=b.resolveIssues.tooltips.isLastRevision,t.cellView.setReusableContent(n)):0==t.nodeModel.options.isLastRevision&&(n=e.createElement("div",{class:"isLastRevisionFalse wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-close"}),s=b.resolveIssues.tooltips.isNotLastRevision,t.cellView.setReusableContent(n)):(n=e.createElement("div",{}),s="",t.cellView.setReusableContent(n)),n.tooltipInfos=new a({shortHelp:s,mouseRelativePosition:!1,position:"bottom"}),g.end(x.name+" rendering isLastRevision")},date:function(t){var n="";if(""!=t.nodeModel.options.resolutionDate){var s=m.get("widget")||window.widget,i=parseInt(s.getValue("approaching"),10),o="",a=new Date;a.setHours(0,0,0,0);var l=new Date(t.nodeModel.options.resolutionDate),c=t.nodeModel.options.resolutionDate;l.setHours(0,0,0,0),o=""===(o=Math.ceil(Math.abs(l-a)/864e5)<=i&&l>a?"approaching":"")&&l<=a?"overdue":o;l.toLocaleString(s.lang,{month:"short"}),l.getDate(),l.getFullYear();n=e.is(o,"string")&&""!==o?e.createElement("div",{class:"target-approaching-overdue",html:[{class:"approaching"===o?"fonticon fonticon-clock":"fonticon fonticon-attention"},{html:r.formatDate(c)}]}):e.createElement("div",{class:"target-approaching-overdue",html:r.formatDate(c)})}t.cellView.setReusableContent(n)},updateColumnStyles:function(t,n){var s={};void 0!==n.color&&(s.color=n.color+";"),void 0!==n["background-color"]&&(s["background-color"]=n["background-color"]+";");var i=[],o=document.styleSheets[0];o.cssRules?i=o.cssRules:o.rules&&(i=o.rules);var a='.issue-list-container .wux-datagrid-cell[data-index="'+t+'"]:not(.wux-datagrid-header)',r=this._getBrowserSelector(a),l=function(e,t,n){for(var s=e.length;--s;){var i=e[s];if(n(t,i))return{item:i,index:s}}return null}(i,r,(function(e,t){return t.selectorText===e}));null!==l&&o.deleteRule(l.index);var c="{}";e.is(n,"object")&&(c=(c=(c=JSON.stringify(s)).replace(/"/g,"")).replace(/,/g,"")),"{}"!==c&&o.insertRule(r+c,i.length)},_getBrowserSelector:function(e){var t=document.styleSheets,n=t[t.length-1],s=-1,i=null;try{s=n.insertRule(e+"{}",n.cssRules.length),i=(n.cssRules||n.rules)[s].selectorText}finally{s>=0&&n.deleteRule(s)}return i},contentWithHyperlink:function(e){var t=new h({domId:"hyperlinkButton",displayStyle:"lite",label:e.length,class:"iss-hyperlink-buttons"});return t.addEventListener("click",(function(){widget.setValue("fromDataGridDoubleClick",!0),widget.setValue("contentFacet",!0),d.getCommand("ToggleInformationPanel")&&d.getCommand("ToggleInformationPanel").begin({save:!0})})),t}},styling:{state:function(e){var t=!1;if(e.nodeModel){var n,s="";return"Issue"!=e.nodeModel.options.baseType||e.nodeModel.options.state.includes("Issue.")?(s=e.nodeModel.options.state,t=!1):(s="Issue."+e.nodeModel.options.state,t=!0),s&&(n=this.styling.getAndCreateMaturityClass(s,"wux-controls-label",t)+" ISU-Maturity"),n}},getAndCreateMaturityClass:function(e,t,n){let s="lc-status-"+this.cleanStatusForCSS(e)+(t?"-withClass":"");return n&&(s=s+" "+(e=e.replace("Issue.",""))),s},cleanStatusForCSS:function(e){return e.replace(/(\.| )/g,"-")}},sorting:{custom:function(e){return function(e,t,n,s,i){var o=!(i in n.options.custom)||null===n.options.custom[i],a=!(i in s.options.custom)||null===s.options.custom[i];if(o||a)return o&&!a?-1:!o&&a?1:0;var r=n.options.custom[i],l=s.options.custom[i];return isNaN(r)||isNaN(l)?r>l?1:r<l?-1:0:(r=parseFloat(r))>(l=parseFloat(l))?1:r<l?-1:0}},title:function(e,t,n,s,i){return n.options.baseType!==S||s.options.baseType,n.options.label<s.options.label?-1:n.options.label>s.options.label?1:0},name:function(e){return function(t,n,s,i,o){return s.options.name<i.options.name?e?1:-1:s.options.name>i.options.name?e?-1:1:0}},description:function(e){return function(t,n,s,i,o){var a=r.getTextFromHTML(s.options.description),l=r.getTextFromHTML(i.options.description);return a<l?e?1:-1:a>l?e?-1:1:0}},array:function(e){return function(e,t,n,s,i){return n.options[i].length-s.options[i].length}},date:function(e){return function(e,t,n,s,i){if(n.options[i]&&s.options[i]){var o=n.options[i]<s.options[i]?-1:1;try{var a=new Date(n.options[i]),r=new Date(s.options[i]);o=a>r?1:a<r?-1:0}catch(e){}return o}return!n.options[i]&&s.options[i]?-1:!s.options[i]&&n.options[i]?1:0}},enumeration:function(e){var t={};switch(e){case"state":default:t=C;break;case"priority":t=_}return function(e,n,s,i,o){var a=0;o=o.replace("ds6w:","");try{o in s.options&&o in i.options&&(e=s.options[o].toUpperCase(),n=i.options[o].toUpperCase(),a=t[e]-t[n])}catch(e){}return a}},validation:function(){return function(e,t,n,s,i){return n.options.validation.status<s.options.validation.status?-1:n.options.validation.status>s.options.validation.status?1:0}},assignees:function(e,t,n,s,i){var o=0;if("assignees"in n.options&&"assignees"in s.options){var a=n.options.assignees,r=s.options.assignees;o=a.length>=r.length?1:-1}return o},contributors:function(e,t,n,s,i){var o=0;if("contributors"in n.options&&"contributors"in s.options){var a=n.options.contributors,r=s.options.contributors;o=a.length>=r.length?1:-1}return o},informedUsers:function(e,t,n,s,i){var o=0;if("informedUsers"in n.options&&"informedUsers"in s.options){var a=n.options.informedUsers,r=s.options.informedUsers;o=a.length>=r.length?1:-1}return o},originator:function(e,t,n,s,i){return n.options.originator.lastName<s.options.originator.lastName?-1:n.options.originator.lastName>s.options.originator.lastName?1:0},owner:function(e,t,n,s,i){return n.options.owner.lastName<s.options.owner.lastName?-1:n.options.owner.lastName>s.options.owner.lastName?1:0},coOwners:function(e,t,n,s,i){var o=0;if("coOwners"in n.options&&"coOwners"in s.options){var a=n.options.coOwners,r=s.options.coOwners;o=a.length>=r.length?1:-1}return o}},preferences:{savePreferences:function(t){var n=m.get("widget")||window.widget,s=m.get("component").getTreeListView(),i=[];if(i=(s.layout._balancedColumnTree,s.layout._balancedColumnTree.slice()),!0===t.sort&&i.forEach((function(e){var t=manager.getColumnIDFromDataIndex(e.dataIndex);"none"!==manager.getColumnOrderState(t)&&n.setValue("IssueManagementTableSorting",JSON.stringify({columnID:t,order:manager.getColumnOrderState(t)}))})),!0===t.columns){var o=[];i.forEach((function(t){o.push({dataIndex:t.dataIndex,text:t.text,originalText:x.getHeader(t.dataIndex),export:t.export,width:t.width,visibleFlag:t.visibleFlag,isHidden:!0===t.isHidden,styles:t.styles?t.styles:{},isCustomColumn:!!e.is(t.isCustomColumn)&&t.isCustomColumn})}))}t.hasOwnProperty("view")&&n.setValue("IssueManagementTableView",t.view)},resetPreferences:function(e){var t=m.get("widget")||window.widget;!0===e.sort&&t.setValue("IssueManagementTableSorting",""),e.columns},loadSortPreference:function(){var e=m.get("widget")||window.widget;g.start(x.name+" preferences loadSortPreference");var t=e.getValue("IssueManagementTableSorting");try{var n=JSON.parse(t);if(!Number.isInteger(n.columnID)||!n.order)throw new Error("The sort preference has an incorrect format");this.sort()}catch(t){e.setValue("IssueManagementTableSorting",null)}g.end(x.name+" preferences loadSortPreference")},getViewModePreference:function(){var e=m.get("widget")||window.widget;g.start(x.name+" preferences getViewModePreference");var t=N.COMPACT;try{if((t=e.getValue("IssueManagementTableView"))!==N.COMPACT&&t!==N.COMFORTABLE)throw new Error("The columns preference has an incorrect format")}catch(n){e.setValue("IssueManagementTableView",t),t=N.COMPACT,x.component.utils.isTouchDevice()&&(t=N.COMFORTABLE)}return x.component.utils.isTouchDevice()&&(t=N.COMFORTABLE),g.end(x.name+" preferences getViewModePreference"),t}},getRoots:function(){return this.document.getRoots()},resize:function(){let e=m.get("component");if(e){let t=e.list.getTreeDocument().getSelectedNodes();t[0]&&this.ensureNodeModelVisible(t[0])}},utils:{whereToAddModal:null,_originalColumns:[],_debounceTimeouts:[],getOriginalColumns:function(){return this._originalColumns},debounce:function(e,t,n){var s,i=this;return function(){var o=this,a=arguments,r=n&&!s;clearTimeout(s);var l=i._debounceTimeouts.indexOf(s);-1!==l&&i._debounceTimeouts.splice(l,1),s=setTimeout((function(){s=null,n||e.apply(o,a)}),t),i._debounceTimeouts.push(s),r&&e.apply(o,a)}}}});return O})),define("DS/IssueManagement/views/list/TreeList",["UWA/Core","UWA/Class/Promise","DS/UIKIT/Mask","DS/UIKIT/Input/Button","DS/Core/PointerEvents","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/Tree/TreeListView","DS/Menu/Menu","DS/IssueCommon/utils/Utils","DS/IssueComponents/users/Users","DS/IssueManagement/commands/CommandsManager","DS/IssueManagement/utils/DragAndDrop","DS/IssueManagement/components/ContextualMenu","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueCommon/assets/nls/IssueCommon","css!DS/IssueManagement/IssueManagement.css"],(function(e,t,n,s,i,o,a,r,l,c,d,u,p,m,g,f,h,v,I){"use strict";return r.extend({name:"DS/IssueManagement/views/list/TreeList"})})),define("DS/IssueManagement/models/TreeNodeModel",["UWA/Core","DS/IssueManagement/utils/customization/DataGridCellContent","DS/TreeModel/TreeNodeModel","DS/IssueServices/Contexts","i18n!DS/IssueManagement/assets/nls/IssueManagement"],(function(e,t,n,s,i){"use strict";function o(t){var i=this;t=e.extend({id:"",physicalId:"",label:"",icons:[],grid:{},type:"",children:[],useAsyncPreExpand:!0,matchSearchNavigation:!1},t),i.listView=s.get("ISU_LISTVIEW"),i.listView&&null!=i.listView||i.updateGrid(t),n.call(i,t)}function a(e){e._getFilterInfo||(e.filterInChild=o.prototype.filterInChild.bind(e),e.filterOutChild=o.prototype.filterOutChild.bind(e),e._getFilterInfo=o.prototype._getFilterInfo.bind(e),e._getChildrenFilterInfo=o.prototype._getChildrenFilterInfo.bind(e),e._removeChildrenFilterInfo=o.prototype._removeChildrenFilterInfo.bind(e))}return o.prototype=Object.create(n.prototype),o.prototype.getOccurrencePath=function(t){var n=this;if(e.is(t,"function")&&t(this),!n.isRoot()&&n.getParent()){var s=n.getParent().getOccurrencePath(t);return s.push(n.options.id),s.push(n.options.data.relationToIssue),s}return[n.options.id]},o.prototype.updateGrid=function(e){this.listView&&null!=this.listView||t.updateCellContentForGrid(e)},o.prototype.getNodesById=function(e){var t={listOfNodesFound:[]};return this._getNodesById(e,t),t.listOfNodesFound},o.prototype._getNodesById=function(e,t){var n=this,s=!1;if(n.options.id===e)t.listOfNodesFound.push(n),s=!0;else{var i=n.getChildren();if(i)for(var o=0;o<i.length;o++)s=i[o]._getNodesById(e,t)||s}return s},o.prototype.matchSearchNavigation=function(){this.options.matchSearchNavigation=!0},o.prototype.unmatchSearchNavigation=function(){this.options.matchSearchNavigation=!1},o.prototype.getID=function(){return this.options.id},o.prototype.filterOut=function(){var e=this,t=e.isRoot()?e.getTreeDocument():e.getParent();null!==t&&(a(t),t.filterOutChild(e))},o.prototype.filterOutChild=function(t){var n=this,s=n.getChildren();if(s.indexOf(t)<0)throw new Error("This is not a child");var i=n._getChildrenFilterInfo(!0);if(!i.childrenBeforeFiltering){i.childrenBeforeFiltering=s&&s.length>0?s.slice(0):[];e.is(n._expandState)&&(i.expandStateBeforeFiltering={noExpandState:"noChildren",expandingState:"expanding",partiallyExpandedState:"partiallyExpanded",collapseState:"expanded",expandState:"collapsed"}[n._expandState])}t._getFilterInfo(!0).parentBeforeFiltering=n,e.is(n.removeChild,"function")?n.removeChild(t):n.removeRoot(t,!0,!0),e.is(n.setState,"function")&&n.setState({state:i.expandStateBeforeFiltering}),i.filteredOutChildren||(i.filteredOutChildren=[]),i.filteredOutChildren.push(t)},o.prototype.filterIn=function(e){var t=this,n=t._getFilterInfo();if(n&&n.parentBeforeFiltering){var s=n.parentBeforeFiltering;a(s),s.filterInChild(t)}if(!0===e){var i=null,o=t._getChildrenFilterInfo();(i=o&&o.childrenBeforeFiltering?o.childrenBeforeFiltering:t.getChildren())&&Array.isArray(i)&&i.forEach((function(t){t.filterIn(e)}))}},o.prototype.filterInChild=function(t){var n=this,s=n._getChildrenFilterInfo();if(s&&s.childrenBeforeFiltering){var i=s.childrenBeforeFiltering.indexOf(t);if(i>=0){var o=t._getFilterInfo();if(o&&o.parentBeforeFiltering===n){var a=n.getChildren(),r=null;if(a&&Array.isArray(a))for(var l=0;l<a.length;l++){var c=a[l];if(s.childrenBeforeFiltering.indexOf(c)>i){r=c;break}}delete o.parentBeforeFiltering,t.options&&t.options.isRootAttached?!0===t.options.isRootAttached&&n.insertBefore(t,r):n.insertBefore(t,r),e.is(n.setState,"function")&&n.setState({state:s.expandStateBeforeFiltering}),t._removeFilterInfo();var d=s.filteredOutChildren.indexOf(t);s.filteredOutChildren.splice(d,1),0===s.filteredOutChildren.length&&n._removeChildrenFilterInfo()}}}},o.prototype._removeFilterInfo=function(){delete this.options._filterInfo},o.prototype._removeChildrenFilterInfo=function(){delete this.options._childrenFilterInfo},o.prototype._getFilterInfo=function(e){var t=this;return!t.options._filterInfo&&e&&(t.options._filterInfo={}),t.options._filterInfo},o.prototype._getChildrenFilterInfo=function(e){var t=this;return!t.options._childrenFilterInfo&&e&&(t.options._childrenFilterInfo={}),t.options._childrenFilterInfo},o})),define("DS/IssueManagement/export/ExportCSV",["UWA/Class/Promise","UWA/Core","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Button","DS/ControlsEx/LoadingPanel","DS/UIKIT/Mask","DS/IssueManagement/export/Utils","DS/IssueAttachmentManager/components/Collection","DS/IssueServices/Contexts","DS/IssueCommon/utils/Utils","DS/IssueComponents/utils/Utils","DS/IssueServices/utils/Performance","i18n!DS/IssueCommon/assets/nls/IssueCommon","DS/IssueServices/services/IssueServices","DS/IssueAttachmentManager/services/AttachmentServices","i18n!DS/IssueManagement/assets/nls/IssueManagement"],(function(e,t,n,s,i,o,a,r,l,c,d,u,p,m,g,f,h){"use strict";var v="DS/IssueManagement/export/ExportCSV",I="Issue",b=0;return{exportation:function(){let t,n=new e((e=>{t=e}));p.start(v+" exportation");var s=c.get("component");new Set;var i=s.getSelectedNodes().filter((function(e){return e.options.baseType===I}));return 0==i.length&&s.loadedIssues<s.totalIssues?this.showConfirmationDialog(t):this.createCSV(i,t),n},showConfirmationDialog:function(e){var t=this,o=c.get("component"),a=new n({}),r=document.getElementsByClassName("issue-list")[0];a.inject(r);var l=h.replace(h.exportMessage,{number:o.totalIssues});new s({immersiveFrame:a,title:h.exportTitle,content:l,activeFlag:!1,modelFlag:!0,width:500,buttons:{No:new i({domId:"exportNo",label:h.cancel,onClick:function(t){a.destroy(),e()}}),Yes:new i({domId:"exportYes",label:h.exportLabel,onClick:function(n){a.destroy(),t.loadAllIssues(e)}})}}).addEventListener("close",(function(t){e(),a&&a.destroy()}))},loadAllIssues:function(e){var t=this,n=c.get("component"),s=new o({shape:"linear",showButtonsFlag:"closeButtonOnly",modalFlag:!0,width:"15%",info:h.loadingIssues}).inject(widget.body);s.on();var i=n.loadAllIssues();s.addEventListener("stop",(function(){i.cancel(),s.off(),e()})),i.then((function(){s.off(),t.createCSV([],e)}))},createCSV:function(e,t){r.notifications.exporting(),this.getCSV({type:"string",roots:e}).then((n=>{var s=h.export.csv.name;1===e.length&&(s=s+e[e.length-1].options.name+"_");var i=s+(new Date).toString().split(" ").splice(1,4).join(" ")+".csv";r.download.csv(n,i,"text/csv;encoding:utf-8"),t()}))},getCSV:function(n){var s=this;let i,o=new e((e=>{i=e}));var a="string";if(n&&t.is(n.type,"string"))switch(n.type){case"string":default:a="string";break;case"array":a="array"}p.start(v+" exportation");var r=c.get("component"),l=r.getTreeListView().getManager().getColumns();let u=!1;r.list.getManager().getColumns().forEach((function(e){!r.attributes.includes(e.dataIndex)||l.includes(e)||e.isHidden||l.push(e),"ds6w:validation"==e.dataIndex&&(u=e.visibleFlag)}));var m=[];const f=[];for(let e=0;e<l.length;e++)if(t.is(l[e].visibleFlag)&&l[e].visibleFlag&&f.push(l[e]),t.is(l[e].children))for(let n=0;n<l[e].children.length;n++)t.is(l[e].children[n].visibleFlag)&&l[e].children[n].visibleFlag&&f.push(l[e].children[n]);let h=f.filter((e=>t.is(e.isCustomColumn)&&e.isCustomColumn));h=h.map((e=>({name:e.text?e.text:e.dataIndex}))),m.push(s.utils.getCSVHeader({columns:f}));var b=n&&Array.isArray(n.roots)?n.roots:r.getSelectedNodes().filter((function(e){return e.options.baseType===I}));0===b.length&&(b=r.getTreeDocument().getRoots(!1));let y={};var w=new Set,S=[];b.map((e=>{if(e.options.validation.activated&&S.push(e.options.physicalId),t.is(e.options.reportedAgainst,"array")&&e.options.reportedAgainst!=[]&&e.options.reportedAgainst.map((e=>{w.add(e.objectType)})),t.is(e.options.resolvedBy,"array")&&e.options.resolvedBy!=[]&&e.options.resolvedBy.map((e=>{w.add(e.objectType)})),t.is(e.options.resolvedItems,"array")&&e.options.resolvedItems!=[]&&e.options.resolvedItems.map((e=>{w.add(e.objectType)})),t.is(e.options.contexts,"array")&&e.options.contexts!=[]&&e.options.contexts.map((e=>{w.add(e.objectType)})),h.length>0){let t=y[e.options.physicalId]={};t.attributes=[],t.physicalId=e.options.physicalId,h.forEach((e=>t.attributes.push(e)))}}));var C=S.reduce((function(e,t){return e.push({physicalId:t}),e}),[]);return g.routes.retrieve({data:{objects:C,validationColumnVisibility:u}}).then((function(e){"validationColumnInvisible"!==e&&s.utils.updateValidationStatus(e,b),r.loadInfo_fetchV2(b).then((()=>{var e={"ds6w:type":[...w]};g.getNLSValuesPromise(e).then((e=>e=t.is(e["ds6w:type"])?e["ds6w:type"]:{})).then((e=>{g.classification.retrieve({data:{objects:y}}).then((function(t){var n=c.get("classAttrNLS");let o=t.results,r={};o.forEach((e=>{let t=e.body;r[t.physicalId]=[];for(var s=y[t.physicalId].attributes,i=0;i<s.length;i++){var o=s[i].name,a="";a=n[o]?.rangeValues?d.getMulValueAttr(o,t[o]):t[o].substring(1,t[o].length-1);var l={};l.attrName=o,l.attrValue=a,r[t.physicalId].push(l)}}));for(var l=0;l<b.length;l++){let t=b[l];if(r[t.options.physicalId]){for(var u=r[t.options.physicalId],g={grid:{}},h=0;h<u.length;h++){var I=u[h].attrName,w=u[h].attrValue;g.grid[I]=w}t.updateOptions(g)}m.push(s.utils.getCSVRow({node:b[l],columns:f,typeNLS:e}))}if(p.end(v+" exportation"),"array"!==a){if("string"===a){for(var S=[],C=0;C<m.length;C++){var D=m[C].join(",");S.push(D)}i(S.join("\n"))}i(m)}else i(m)}))}))}))})),o},utils:{getCSVHeader:function(e){p.start(v+" getCSVHeader");for(var t=[],n=0;n<e.columns.length;n++)if(this.isExportable(e.columns[n])){var s=e.columns[n].text;t.push(this.escape(s))}return p.end(v+" getCSVHeader"),t},getCSVRow:function(e){var n=this;p.start(v+" getCSVRow");for(var s=[],i=e.node,o=0;o<e.columns.length;o++)if(n.isExportable(e.columns[o])){var a=e.columns[o].dataIndex;switch(a){case"tree":s.push(n.escape(e.node.getLabel()));break;case"ds6w:occurrence":let p=[];var r=i.getAllDescendants();for(let e=0;e<r.length;e++){var l=r[e].options.grid["ds6w:occurrence"];l&&p.push(l)}s.push(n.escape(p.join(",")));break;case"ds6w:reportedAgainst":for(var g=i.options.reportedAgainst,f=[],I=0;I<g.length;I++){var b=g[I].title;b=(b=g[I].name&&""!=g[I].name?b+" ("+g[I].name+")":b)+" "+(e.typeNLS[g[I].type]?e.typeNLS[g[I].type]:g[I].type),b=g[I].revision?b+" "+g[I].revision:b,f.push(b)}s.push(n.escape(f.join(", ")));break;case"ds6w:resolvedBy":for(var y=i.options.resolvedBy,w=[],S=0;S<y.length;S++){b=y[S].title;b=(b=y[S].name&&""!=y[S].name?b+" ("+y[S].name+")":b)+" "+(e.typeNLS[y[S].type]?e.typeNLS[y[S].type]:y[S].type),b=y[S].revision?b+" "+y[S].revision:b,w.push(b)}s.push(n.escape(w.join(", ")));break;case"ds6w:resolvedItems":for(var C=i.options.resolvedItems,D=[],T=0;T<C.length;T++){b=C[T].title;b=(b=C[T].name&&""!=C[T].name?b+" ("+C[T].name+")":b)+" "+(e.typeNLS[C[T].type]?e.typeNLS[C[T].type]:C[T].type),b=C[T].revision?b+" "+C[T].revision:b,D.push(b)}s.push(n.escape(D.join(", ")));break;case"ds6w:contexts":for(var E=i.options.contexts,A=[],_=0;_<E.length;_++){b=E[_].title;b=(b=E[_].name&&""!=E[_].name?b+" ("+E[_].name+")":b)+" "+(e.typeNLS[E[_].type]?e.typeNLS[E[_].type]:E[_].type),b=E[_].revision?b+" "+E[_].revision:b,A.push(b)}s.push(n.escape(A.join(", ")));break;case"ds6w:assignees":for(var M=i.options.assignees,N=[],x=0;x<M.length;x++)"person"===M[x].type?N.push(M[x].fullName+" ("+M[x].user+")"):N.push(M[x].fullName);s.push(n.escape(N.join(", ")));break;case"ds6w:coOwners":for(var O=i.options.coOwners,P=[],V=0;V<O.length;V++)"person"===O[V].type?P.push(O[V].fullName+" ("+O[V].user+")"):P.push(O[V].fullName);s.push(n.escape(P.join(", ")));break;case"ds6w:contributors":for(var k=i.options.contributors,L=[],R=0;R<k.length;R++)"person"===k[R].type?L.push(k[R].fullName+" ("+k[R].user+")"):L.push(k[R].fullName);s.push(n.escape(L.join(", ")));break;case"ds6w:informedUsers":for(var U=i.options.informedUsers,F=[],B=0;B<U.length;B++)"person"===U[B].type?F.push(U[B].fullName+" ("+U[B].user+")"):F.push(U[B].fullName);s.push(n.escape(F.join(", ")));break;case"ds6w:validation":s.push(n.escape(i.options.validation.toString()));break;case"ds6w:description":var j=i.options.description;s.push(n.escape(j));break;case"ds6w:created":case"ds6w:modified":var W=a.slice(5),H={timePrecision:"min"},z={};if(t.is(i.options[W],"string")&&i.options[W].length>0){z[W]=i.options[W];var G=u.getFormattedDate(z,{day:"numeric",month:"short",year:"numeric",hour:"numeric",minute:"numeric"});s.push(n.escape(d.formatDate(G[W],H)))}else s.push(n.escape(""));break;case"ds6w:actualStartDate":case"ds6w:actualEndDate":case"ds6w:estimatedStartDate":case"ds6w:estimatedEndDate":case"ds6w:resolutionDate":var K=a.slice(5),q={};if(t.is(i.options[K],"string")&&i.options[K].length>0){q[K]=i.options[K];var X=u.getFormattedDate(q,{year:"numeric",month:"short",day:"numeric"});s.push(n.escape(d.formatDate(X[K])))}else s.push(n.escape(""));break;case"ds6w:state":var Y=m.maturity[i.options.state.toLowerCase()],J=c.get("maturityGraph");null!=J&&""!==J&&(Y=J[i.options.state]),Y=n.escape(Y),s.push(Y);break;case"ds6w:priority":Y=m.priorities[i.options.priority.toLowerCase()];Y=n.escape(Y),s.push(Y);break;case"ds6w:originator":Y=i.options.originator.fullName;Y=n.escape(Y),s.push(Y);break;case"ds6w:owner":Y=i.options.owner.fullName;Y=n.escape(Y),s.push(Y);break;case"Approvals":Y=i.options.grid.Approvals;var Z=i.options.grid.Approvals?h.approvals.approvalOn:h.approvals.approvalOff;s.push(Z);break;case"Library":for(var Q=i.options.libraries,$=[],ee=0;ee<Q.length;ee++)$.push(Q[ee]);s.push(n.escape($.join(", ")));break;case"LibraryClasses":for(var te=i.options.library,ne=[],se=0;se<te.length;se++)ne.push(te[se]);s.push(n.escape(ne.join(", ")));break;case"primaryImage":var ie=i.options.grid.primaryImage;s.push(n.escape(ie));break;default:var oe=e.columns[o].dataIndex;if(t.is(i.options.grid[oe],"string")){Y=i.options.grid[oe];Y=n.escape(Y),s.push(Y)}else if(t.is(i.options.grid[oe])){Y=i.options.grid[oe];var ae="datetime"==e.columns[o].typeRepresentation||"datetime"==e.columns[o].dataType;e.columns[o].dataType,H={timePrecision:"min"};if(Array.isArray(Y))if(0===Y.length)Y=n.escape("");else{var re=Y.length>1?Y.map((e=>ae?d.formatDate(e,H):e)).join(", "):ae?n.escape(d.formatDate(Y,H)):Y[0];Y.length>1&&(re=n.escape(re)),Y=re}else ae&&(Y=n.escape(d.formatDate(Y,H)));s.push(Y)}else void 0===i.options.grid[oe]&&s.push("")}}return p.end(v+" getCSVRow"),s},escape:function(e){return e='"'+(e=e.replace(/"/g,'""'))+'"'},isExportable:function(e){return!t.is(e.export,"object")&&!0===e.visibleFlag||!(!t.is(e.export,"object")||!0!==e.export.value||!0!==e.visibleFlag)},updateValidationStatus:function(e,n){for(var s={},i=0;i<e.results.length;i++){var o=e.results[i].body,a={};if(t.is(o.current.status,"string"))a=t.clone(o.current);else if(Array.isArray(o.history)&&o.history.length>0){var r=o.history.sort((function(e,t){var n=0;if(e.date)if(t.date){n=new Date(e.date)-new Date(t.date)}else n=1;else n=-1;return-1*n}));a=t.clone(r[b])}else a={status:"notStarted",approveTo:"",decisions:[]};s[o.physicalId]={activated:!0,fetched:!0,status:a.status,approveTo:a.approveTo,decisions:a.decisions}}for(var l=0;l<n.length;l++){var c=n[l];s[c.options.physicalId]&&c.updateOptions({validation:s[c.options.physicalId]})}}}}})),define("DS/IssueManagement/export/ExportZIP",["UWA/Core","UWA/Promise","DS/Logger/Logger","DS/IssueAttachmentManager/services/AttachmentServices","DS/IssueManagement/export/ExportCSV","DS/IssueManagement/export/Utils","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","DS/ExternalComponents/JSZip","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueCommon/assets/nls/IssueCommon","text!DS/IssueCommon/assets/Settings.json"],(function(e,t,n,s,i,o,a,r,l,c,d,u,p){"use strict";var m="DS/IssueManagement/export/ExportZIP",g="Issue";return{exportation:function(){var n=this;l.start(m+" exportation");var s=a.get("status");n.settings=JSON.parse(p);var r=[],u={},g=new c;return n.getNodes().then((function(e){return r=e,o.notifications.exporting(),s.loading.start(),s.loading.update(d.export.zip.images),n.getImages({nodes:r})})).then((function(s){u=s;var i=[];return r.forEach((function(s){var o=g.folder(s.options.name);if(n.settings.exportPrimaryImage){var a=u[s.options.physicalId];e.is(a,"object")&&setTimeout((function(){i.push(fetch(a.url).then((function(e){return 200===e.status||0===e.status?t.resolve(e.blob()):t.reject(new Error(e))})).then((function(e){o.file(d.export.zip.primary,e)})))}),10)}})),t.all(i)})).then((function(){return s.loading.update(d.export.zip.documents),n.getFiles({nodes:r})})).then((function(n){var a=[];return n.forEach((function(n){var s=g.folder(n.name),i={};i[n.name+"-"+d.export.zip.primary]=0,n.response.forEach((function(o){e.is(o,"object")&&!o.errorMessage&&a.push(fetch(o.downloadUrl).then((function(e){return 200===e.status||0===e.status?t.resolve(e.blob()):t.reject(new Error(e.statusText))})).then((function(t){var a=o.fileName;if(null!==s.file(a)){var r=/(?:\.([^.]+))?$/.exec(a)[1];e.is(r,"string")||(r="");var l=a.replace(/\.[^/.]+$/,"");i[n.name+"-"+a]+=1,a=l+" ("+i[n.name+"-"+a]+")."+r}Number.isInteger(i[n.name+"-"+a])||(i[n.name+"-"+a]=0),s.file(a,t)})))}))})),t.all(a).then((function(){return i.getCSV({type:"string"})})).then((function(e){s.loading.update(d.export.zip.zipping);var t=d.export.csv.name;1===r.length&&(t=t+r[r.length-1].options.name+"_");var n=t+(new Date).toString().split(" ").splice(1,4).join(" ")+".csv";return n=n.split(":").join("_"),g.file(n,"\ufeff"+e),g.generateAsync({type:"blob"}).then((function(e){s.loading.hide(d.export.zip.done);var t=document.createElement("a"),n=t.href=URL.createObjectURL(e),i=d.export.zip.name;1===r.length&&(i=i+r[r.length-1].options.name+"_"),t.setAttribute("download",i+(new Date).toString().split(" ").splice(1,4).join(" ")+".zip"),document.body.appendChild(t),t.click(),setTimeout((function(){document.body.removeChild(t),URL.revokeObjectURL(n)}),0)}))}),(function(){o.notifications.failure()}))}))},getNodes:function(){var e=a.get("component");return new t((function(t,n){const s=a.get("ISU_TYPE_NLS");let i=[];Array.isArray(Object.keys(s["ds6w:type"]))?i=Object.keys(s["ds6w:type"]):i.push(g);var r=e.getSelectedNodes().filter((function(e){return i.includes(e.options.type)}));0===r.length?(0===(r=e.getTreeDocument().getRoots(!1)).length&&(o.notifications.nothing(),n(new Error("Nothing to export as ZIP"))),o.confirmation({title:d.export.zip.title,content:d.replace(d.export.zip.content,{number:r.length})}).then((function(e){!0===e?t(r):n(new Error("Export ZIP canceled by user"))}))):t(r)}))},getFiles:function(e){var n=e.nodes,i=[];return n.forEach((function(e){i.push(s.getDocumentsFrom(e.options.physicalId).then((function(t){return{response:t,name:e.options.name}})))})),t.all(i).then((function(e){var n=[];return e.forEach((function(e){var t=e.response.attachments.reduce((function(e,t){return e.push(t.id),e}),[]);t.length>0&&n.push(s.downloadDocuments(t).then((function(t){return{response:t,name:e.name}})))})),t.all(n)}))},getImages:function(t){var s=t.nodes,i={};return r.images.retrieve({data:{objects:s.map((function(e){return{physicalId:e.options.physicalId}}))}}).then((function(t){for(var n=0;n<t.results.length;n++){var s=t.results[n].body;e.is(s,"object")&&e.is(s.fileName,"string")&&""!==s.fileName&&e.is(s.url,"string")&&""!==s.url&&(i[s.physicalId]=s)}return i}),(function(e){return n.getLogger(m).error("Cannot fetch the primary images %o",e),i}))}}})),define("DS/IssueManagement/views/list/Keyboard",["UWA/Class/Promise","DS/IssueCommon/utils/Utils","DS/IssueManagement/commands/CommandsManager","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance"],(function(e,t,n,s,i){"use strict";var o="DS/IssueManagement/views/list/Keyboard",a="Issue",r=function(){return!(window.document.getElementsByClassName("wux-menu").length>0&&window.document.getElementsByClassName("wux-menu-container").length>0)};return{"treelistview:edit-mode":function(){!1!==r()&&(i.start(o+" edit-mode"),s.get("component").getTreeDocument().getSelectedNodes().length>0&&n.getCommand("ToggleInformationPanel")&&n.getCommand("ToggleInformationPanel").begin({open:!0,save:!0}),i.end(o+" edit-mode"))},"treelistview:edit-cancel":function(){if(!1!==r()){i.start(o+" edit-cancel");var e=s.get("component").getTreeDocument();e.withTransactionUpdate((function(){e.unselectAll(),n.getCommand("ToggleInformationPanel")&&n.getCommand("ToggleInformationPanel").begin({open:!1,save:!0})})),i.end(o+" edit-cancel")}},"treelistview:select-all":function(){!1!==r()&&(i.start(o+" select-all"),n.getCommand("SelectAllIssues").begin(),i.end(o+" select-all"))},"treelistview:copy-node":function(){if(!1!==r()){i.start(o+" copy-node");var e=s.get("component").getTreeDocument().getSelectedNodes(),n=[];e.forEach((function(e){n.push(e.options.type+" "+e.options.name+" "+e.options.revision)})),t.copyTextToClipboard(n.join(", ")),i.end(o+" copy-node")}},"treelistview:delete-node":function(){if(!1!==r()){i.start(o+" delete-node");var e=s.get("component").getSelectedNodes();if(0!==e.length){for(var t=!1,l=0;l<e.length;l++)e[l].options.baseType===a&&(t=!0);!0===t?n.getCommand("Delete").begin():n.getCommand("Detach").begin(),i.end(o+" delete-node")}}}}})),define("DS/IssueManagement/models/TreeDocument_V2",["UWA/Core","UWA/Class/Promise","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/PlatformAPI/PlatformAPI","DS/TreeModel/TreeDocument","DS/TreeModel/BaseFilter","DS/IssueManagement/commands/CommandsManager","DS/IssueManagement/models/TreeNodeModel","DS/IssueManagement/utils/Tagger","DS/IssueCommon/utils/ModelParser","DS/IssueServices/Contexts","DS/IssueServices/utils/Parser","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","DS/IssueCommon/utils/Utils","DS/IssueComponents/utils/Utils","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueComponents/assets/nls/IssueComponents"],(function(e,t,n,s,i,o,a,r,l,c,d,u,p,m,g,f,h,v,I){"use strict";var b="Issue",y=10,w=0,S=100,C=100,D=function(e,t,n){var s;return function(){var i=this,o=arguments,a=n&&!s;clearTimeout(s),s=setTimeout((function(){s=null,n||e.apply(i,o)}),t),a&&e.apply(i,o)}},T=this;return o.extend({name:"DS/IssueManagement/models/TreeDocument_V2",_logger:null,component:null,settings:{},_publishSelection:!1,_onNodeModelUpdateSubscriptionToken:"",init:function(t){var s=this;s.listView=u.get("ISU_LISTVIEW"),T=s,s._logger=n.getLogger("DS/IssueManagement/Model"),s.component=t.component,s.settings=t.settings,t.list=e.merge(t.document||{},s.getEventOptions()),s._parent(t.document),s._publishSelection=!1,s.listView||(s.initCustomFilter(),s.registerCustomFilter()),s.nonIndexData=!1,s._subscribers()},registerNodeModelUpdateEvent:function(){var t=this;t._onNodeModelUpdateSubscriptionToken=t.onNodeModelUpdate((function(n){var o=n.data.nodeModel;if(o){var a=n.data.attributes;if("string"!=typeof a.Approvals){var r={id:o.options.physicalId};if(a.hasOwnProperty("Approvals")){try{var l=u.get("component").getCurrentView();f.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:l,pd3:"SummaryViewActions",pd4:"Approvals",pd5:"Issue/"+l+"/SummaryViewActions/Approvals"}})}catch(e){}o.options.id;a.Approvals?m.issues.enableApproval({data:r,onComplete:function(e){t.undoRegisterNodeModelUpdateEvent(),t.withTransactionUpdate((function(){o.updateOptions({validation:{activated:!0},grid:{"ds6w:validation":{activated:!0}}})})),t.registerNodeModelUpdateEvent();var n=[[o.options.physicalId]],s={};s[o.options.physicalId]={id:o.options.physicalId,type:"Issue",modifiedAttributes:["Approvals"]},i.publish("DS/Object/update",{metadata:{appId:widget.id,appName:widget.name,timestamp:Math.floor(Date.now())},data:{paths:n,attributes:s},version:"1.0"})},onFailure:function(n){if(e.is(n.error.internal)&&n.error.internal.includes("No 'modify' access on Attribute 'Waiting On' for")){var i=f.getErrorMessage("2005");f.displayErrorMessage(i,"error")}else s.displayNotification({msg:n.error.message,eventID:"error"});t.undoRegisterNodeModelUpdateEvent(),t.withTransactionUpdate((function(){o.updateOptions({grid:{Approvals:!1}})})),t.registerNodeModelUpdateEvent()}}):m.issues.disableApproval({data:r,onComplete:function(e){t.undoRegisterNodeModelUpdateEvent(),t.withTransactionUpdate((function(){o.updateOptions({validation:{activated:!1},grid:{"ds6w:validation":{activated:!1}}})})),t.registerNodeModelUpdateEvent();var n=[[o.options.physicalId]],s={};s[o.options.physicalId]={id:o.options.physicalId,type:"Issue",modifiedAttributes:["Approvals"]},i.publish("DS/Object/update",{metadata:{appId:widget.id,appName:widget.name,timestamp:Math.floor(Date.now())},data:{paths:n,attributes:s},version:"1.0"})},onFailure:function(n){if(e.is(n.error.internal)&&n.error.internal.includes("No 'modify' access on Attribute 'Waiting On' for")){var i=f.getErrorMessage("2005");f.displayErrorMessage(i,"error")}else s.displayNotification({msg:n.error.message,eventID:"error"});t.undoRegisterNodeModelUpdateEvent(),t.withTransactionUpdate((function(){o.updateOptions({grid:{Approvals:!0}})})),t.registerNodeModelUpdateEvent()}})}}}}))},undoRegisterNodeModelUpdateEvent:function(){this.unsubscribe(this._onNodeModelUpdateSubscriptionToken)},registerCustomFilter:function(){this.getFilterManager().registerFilter("stringRole",this.stringRoleFilter)},initCustomFilter:function(){T.filteredListOfNodes=[],this.stringRoleFilter=a.inherit({publishedProperties:{},isDataFiltered:function(e){var t=e.getAttributeValue(this.propertyId);return!(!this.filterModel||!this.filterModel.allowedRoles)&&!t.toLowerCase().includes(this.filterModel.allowedRoles.toLowerCase())},isEmpty:function(){return void 0===this.filterModel.allowedRoles}})},getEventOptions:function(){return{shouldAcceptDrag:function(){return!0},shouldAcceptDrop:function(){return!0}}},addRoots:function(e,n){var s=this;return 0===e.length?t.resolve([]):new t((function(t){s.withTransactionUpdate((function(){for(var i=s.component.list,o=[],a=0;a<e.length;a++){(m=new l(e[a])).options.data&&(m.options.data.isExpandMultiple=!1),0===m.options.reportedAgainst.length&&0===m.options.resolvedBy.length&&0===m.options.resolvedItems.length&&0===m.options.contexts.length&&(m.options.children=null,m.setState({state:"noChildren"})),m.options.indexed||(s.nonIndexData=!0),o.push(m)}var r=s.getRoots(),c=r.length;!0===n&&(c=0);var d=new Map;for(a=0;a<r.length;a++)d.set(r[a].options.id,r[a]);for(var p=0;p<o.length;p++)if(d.has(o[p].options.id)){var m=d.get(o[p].options.id);o[p].options.indexed||m.updateOptions(o[p].options)}else s.addRoot(o[p],c),c++;var g=u.get("widget").getValue("IssueManagementTableSorting");try{var f=JSON.parse(g);if(!Number.isInteger(f.columnID)||!f.order)throw new Error("The sort preference has an incorrect format");i.getManager().sortColumnContent(f.columnID,{sortOrder:f.order})}catch(e){"datagrid"==s.component.list.summaryview?s.getRoots().sort():s.getRoots().sort(i.sorting.name(!0))}!0===n&&setTimeout((function(){var e=i.getManager();if(1===o.length)s.listView?e.isNodeInVisibleViewport(o[w])||e.scrollToNode(o[w],"top",!1):i.ensureNodeModelVisible(o[w]);else if(o.length>1&&s.listView){if(!0===o.every((function(t){return!e.isNodeInVisibleViewport(t)}))){for(var t=e.getScroller().getPosition().y,n=0,a=null,r=0;r<o.length;r++){var l=e.getRowPosition(o[r]._getRowID(!0)),c=Math.abs(t-l);0===r&&(n=c,a=o[r]),c<n&&(n=c,a=o[r])}e.scrollToNode(a,"top",!1)}}}),0),s.getModelEvents().publish({event:"onRootsAdded",data:{roots:o,filterChange:s.filterChange}}),t(o)}))}),(function(){s._logger.error('An error occurred during "%s"',"addRoots")}))},updatePredicates:function(){var e=this,n=e.component.list.getPredicates(),s=e.getRoots(!1);if(0===n.length||0===s.length)return t.resolve();var i=s.map((function(e){return{physicalId:e.options.physicalId}}));return m.fetch({data:{objects:i,predicates:n}}).then((function(i){return new t((function(t){e.withTransactionUpdate((function(){for(var e=0;e<i.body.results.length;e++){for(var o=i.body.results[e].attributes,a={},r=0;r<o.length;r++){var l=o[r];-1!==n.indexOf(l.name)&&(a[l.name]=l.value)}s[e].updateOptions({grid:a})}t()}))}))}))},removeRootsById:function(e){var n=this;return 0===e.length?t.resolve():new t((function(t){n.withTransactionUpdate((function(){var s=[];e.forEach((function(e){var t=n.searchRootById(e);null!==t&&(s.push(t),n.removeRoot(t))})),n.getModelEvents().publish({event:"onRootsRemoved",data:{roots:s}}),t({roots:s})}))}))},prepareBroadcastSelect:function(){this._publishSelection=!0},postBroadcastSelect:function(){this._publishSelection=!1},buildBroadcastSelect:function(){var e=this;g.start(e.name+" buildBroadcastSelect");for(var t=[],n={},s=e.getSelectedNodes(),i=0;i<s.length;i++){var o=s[i];t.push([o.options.id]),n[o.options.id]={id:o.options.id,type:o.options.type,name:o.options.name,label:o.options.title}}return g.end(e.name+" buildBroadcastSelect"),{paths:t,attributes:n}},buildBroadcastSelectForIssue:function(){var e=this;g.start(e.name+" buildBroadcastSelectForIssue");for(var t=[],n={},s=e.getSelectedNodes(),i=0;i<s.length;i++){var o=s[i];o.options.baseType===b&&(t.push([o.options.id]),n[o.options.id]={id:o.options.id,type:o.options.type,name:o.options.name,title:o.options.title})}return g.end(e.name+" buildBroadcastSelectForIssue"),{paths:t,attributes:n}},pushBroadcastSelect:D((function(){var e=this;g.start(e.name+" pushBroadcastSelect");var t=e.buildBroadcastSelect(),n=e.buildBroadcastSelectForIssue();if(e.component.getTreeDocument().getRoots(!1).length>0){r.select(e.getSelectedNodes());var s=u.get("status"),i=e.getSelectedNodes().filter((e=>"Issue"==e.options.baseType)),o=v.replace(v.selectedIssues,{number:i.length});s.selectedDiv.textContent=o}e.component.publishSelect(n),f.publishSelectAll(t),e.component.publishCompass(),e._publishSelection=!1,g.end(e.name+" pushBroadcastSelect")}),S),withBroadcastSelect:function(e){var t=this;t.prepareBroadcastSelect(),e.then((function(){t.pushBroadcastSelect()}),(function(){t._publishSelection=!1}))},refresh_v2:function(n,i,o){var a=this;a.selectedIds=[];var r=u.get("widget")||window.widget;g.start(a.name+" refresh");var l=[],p=[];a.filterChange=n;var I=r.getValue("filter"),b=void 0===r.getValue("affectedItemSetting")||r.getValue("affectedItemSetting"),y=void 0===r.getValue("resolvedItemSetting")||r.getValue("resolvedItemSetting"),w=void 0===r.getValue("contextSetting")||r.getValue("contextSetting");!0===a.utils.isJson(I)?((I=JSON.parse(I)).onlyids=!1,r.getPreference("organizationFilter").value||u.get("isNatifEnvironnement")||(I.reported=!1,I.responsible=!1,r.setValue("filter",JSON.stringify(I))),I.affectedItem=b,I.resolvedItem=y,I.context=w):I={},I.top=i,I.skip=o,I.tags={},I.tags=r.getValue("tags")?JSON.parse(JSON.stringify(r.getValue("tags").allfilters)):{};var S=r.getValue("searchTag")?r.getValue("searchTag"):"";return""!=S&&(I.tags.condition?I.tags.condition.push(S):I.tags={condition:S}),I.tags=JSON.stringify(I.tags),I.paging=!0,m.issues.filter({version:"2.0",data:{filter:I,isFilterChange:n}}).then((function(s){if(void 0!==s.success&&!1===s.success){if(s.body&&s.body.error&&s.body.error.internal&&e.is(s.body.error.internal,"string")){var i=s.body.error.internal;if(i.includes("No business object")||i.includes("not exist")){var o=f.getErrorMessage("0");f.displayErrorMessage(o,"error")}}t.resolve([])}s.body.facets&&(0==s.body.facets.length&&0==s.body.issues.length?a.component.totalIssues=0:s.body.facets.forEach((e=>{e.sixw&&(e.sixw.split("/").pop().toLowerCase().includes("policy")&&(a.component.totalIssues=e.count))})));var r=a.getRoots(!0).slice(0);return new t((function(e){a.withTransactionUpdate((async function(){if(r.length>0){for(var t=0;t<r.length;t++){var i=r[t],o=i.options.physicalId;!0===i.isSelected()&&l.push(o),a.selectedIds=l}n?a.removeIssueRoots():a.removeRoots(r)}await h.getNLSValues(s.body.issues),await h.getIssueMaturity({policies:["Issue"]});var u=[];Array.isArray(s.body)?u=d.parse(s.body):s.body.issues&&(u=d.parse(s.body.issues)),a.addRoots(u,!1,!0).then((function(t){s.body.facets?a.component.applyNLSValuesToFacets(s.body.facets):c.setTags(),e(u)})),n&&(f.cloudProbeUtils.sendFilterIssueMgmtTrackerEvent({filter:I,noOfIssues:u.length}),f.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"FilterIssueManagement"}}))}))}))})).then((function(e){if(p=r.getValue("expandedIds"),Array.isArray(p)){for(var t=[],n=0;n<p.length;n++){var i=a.getNodesById(p[n]);i.length>0&&Array.isArray(i)&&t.push(i[0])}t.forEach((function(e){e.options.data.isExpandMultiple=!0,e.expand()})),t.length>0&&a.updateNodesOnExpand(t)}return a.withTransactionUpdate((function(){l.forEach((function(e){a.getNodesById(e).forEach((function(e){e.select()}))})),a.pushBroadcastSelect()})),s.displayNotification({msg:v.notifications.refresh}),e})).catch((function(e){a._logger.error("Refresh has failed: %o",e),s.displayNotification({msg:v.notifications.serverError,eventID:"error"})})).finally((function(){g.end(a.name+" refresh")}))},addChildren:function(e,t){var n=this,s=t.results,i=[];n.withTransactionUpdate((function(){g.start(n.name+" addChildren"),e.sortChildren=function(){return!1};for(var t=[],o=[],a=[],r=e.options.contexts.reduce((function(e,t){return e[t.physicalId]=t,t.isAdded=!1,e}),{}),c=e.options.reportedAgainst.reduce((function(e,t){return e[t.path.toString()]=t,t.isAdded=!1,e}),{}),u=e.options.resolvedBy.reduce((function(e,t){return e[t.physicalId]=t,t.isAdded=!1,e}),{}),p=e.options.resolvedItems.reduce((function(e,t){return e[t.physicalId]=t,t.isAdded=!1,e}),{}),m=1,f=1,h=1,v=1,I=0;I<s.length;I++){if((D=d.parse(s[I],{useIndex:!0,predicates:n.component.list.getPredicates()})).useAsyncPreExpand=!1,D.asyncChildren=[],D.children=null,D.label=D.title,D.display=D.title,D.grid.biColor="rgba(0, 0, 0, 0)",D.icons.length>1&&D.icons.shift(),void 0!==r[D.id]&&!r[D.id].isAdded){r[D.id].isAdded=!0,D.grid["ds6w:name"]=r[D.id].name,D.pid=D.physicalId,D.physicalId=D.id,D.elementType=r[D.id].elementType,D.kind=r[D.id].kind,D.serviceId=r[D.id].serviceId;var b=new l(D);b.setState({state:"noChildren"}),b.options.icons=D.icons.slice(0),1==m?(b.options.icons.length>1&&b.options.icons.shift(),b.options.icons.unshift({iconName:"3d-object"})):b.options.icons.unshift({iconName:"docs",className:"fade-out-element"}),b.options.data.relationToIssue="contexts",b.options.data.issue=e.options.physicalId,b.options.data.position=m,t.push(b),m+=1}if(void 0!==u[D.id]&&!u[D.id].isAdded){u[D.id].isAdded=!0,D.grid["ds6w:name"]=u[D.id].name,D.pid=D.physicalId,D.physicalId=D.id,D.elementType=u[D.id].elementType,D.kind=u[D.id].kind,D.serviceId=u[D.id].serviceId;var y=new l(D);y.setState({state:"noChildren"}),y.options.icons=D.icons.slice(0),1==h?(y.options.icons.length>1&&y.options.icons.shift(),y.options.icons.unshift({iconName:"resolved-by"})):y.options.icons.unshift({iconName:"resolved-by",className:"fade-out-element"}),y.options.data.relationToIssue="resolvedBy",y.options.data.issue=e.options.physicalId,y.options.data.position=h,o.push(y),h+=1}if(void 0!==p[D.id]&&!p[D.id].isAdded){p[D.id].isAdded=!0,D.grid["ds6w:name"]=p[D.id].name,D.pid=D.physicalId,D.physicalId=D.id,D.elementType=p[D.id].elementType,D.kind=p[D.id].kind,D.serviceId=p[D.id].serviceId;var w=new l(D);w.setState({state:"noChildren"}),w.options.icons=D.icons.slice(0),1==v?(w.options.icons.length>1&&w.options.icons.shift(),w.options.icons.unshift({iconName:"markup-review"})):w.options.icons.unshift({iconName:"markup-review",className:"fade-out-element"}),w.options.data.relationToIssue="resolvedItems",w.options.data.issue=e.options.physicalId,w.options.data.position=v,a.push(w),v+=1}}var S={};for(I=0;I<s.length;I++){S[(D=d.parse(s[I],{useIndex:!0,predicates:n.component.list.getPredicates()})).id]=D,""!==S[D.physicalId]&&(S[D.physicalId]=D)}var C=[];for(const[t,n]of Object.entries(c))if(void 0!==c[t]&&!c[t].isAdded){C.push(t),c[t].isAdded=!0;var D,T=t.split(",");(D=S[T[T.length-1]]).grid["ds6w:name"]=c[t].name,D.elementType=c[t].elementType,D.kind=c[t].kind,D.serviceId=c[t].serviceId,D.pid=D.physicalId,D.physicalId=t,D.id=t,D.children=null;var E=new l(D);E.setState({state:"noChildren"}),E.options.icons=D.icons.slice(0),1==f?(E.options.icons.length>1&&E.options.icons.shift(),E.options.icons.unshift({iconName:"location"})):E.options.icons.unshift({iconName:"docs",className:"fade-out-element"}),E.options.data.relationToIssue="reportedAgainst",E.options.data.issue=e.options.physicalId,E.options.data.position=f,i.push(E),f+=1}i.forEach((function(t){e.addChild(t)})),t.forEach((function(t){e.addChild(t)})),a.forEach((function(t){e.addChild(t)})),o.forEach((function(t){e.addChild(t)})),g.end(n.name+" addChildren")}))},fetchOccurencePath:function(e){var t=this,n=[];if(0!=e.length){for(var i=0;i<e.length;i++)if(e[i].options.id)for(var o=e[i].options.id.split(","),a=0;a<o.length;a++)0!=a&&a%2!=1&&a!=o.length-1||n.push(o[a]);n=[...new Set(n)],m.fetch({data:{objects:n.map((function(e){return{physicalId:e}}))},onComplete:function(i){var o=i.body;o.infos&&o.infos.nresults&&n.length!==o.infos.nresults&&s.displayNotification({msg:I.create.templateApplyWarningRelated,eventID:"warning"}),o.infos&&o.infos.nresults&&o.infos.nresults>0&&t.withTransactionUpdate((function(){var t={};"results"in o&&o.results.forEach((function(e){var n=p.parseFetchResponse(e);t[n.value.id]=n}));for(var n=0;n<e.length;n++){var s=e[n].options.id.split(","),i="";s.length>0&&t[s[s.length-1]].display.title;for(var a=0;a<s.length;a++)t[s[a]]&&a!=s.length-1&&(i+=t[s[a]].display.title,a!=s.length-2&&(i+="\\"));var r=e[n]._options.grid;r["ds6w:occurrence"]=i,e[n].updateOptions({grid:r})}}))},onFailure:function(e){}})}},addContextsOrReportedAgainstOrResolvedByOrResolvedItems:function(e){var t=this;g.start(t.name+" addContextsOrReportedAgainstOrResolvedByOrResolvedItems");for(var n=Object.keys(e),s=[],i=0;i<n.length;i++){var o=e[n[i]];for(i=0;o.reportedAgainst&&i<o.reportedAgainst.length;i++){var a=(r=(r=o.reportedAgainst[i].physicalId).split(","))[r.length-1];o.reportedAgainst[i].physicalId=a+"",o.reportedAgainst[i].path=r}for(i=0;o.resolvedBy&&i<o.resolvedBy.length;i++){a=(r=(r=o.resolvedBy[i].physicalId).split(","))[r.length-1];o.resolvedBy[i].physicalId=a+"",o.resolvedBy[i].path=r}for(i=0;o.resolvedItems&&i<o.resolvedItems.length;i++){a=(r=(r=o.resolvedItems[i].physicalId).split(","))[r.length-1];o.resolvedItems[i].physicalId=a+"",o.resolvedItems[i].path=r}for(i=0;o.contexts&&i<o.contexts.length;i++){var r;a=(r=(r=o.contexts[i].physicalId).split(","))[r.length-1];o.contexts[i].physicalId=a+"",o.contexts[i].path=r}s.push(o)}return m.related.update({data:{objects:s}}).then((function(s){g.end(t.name+" addContextsOrReportedAgainstOrResolvedByOrResolvedItems");var i={paths:[],attributes:{}};for(var o in e)i.paths.push([o]),i.attributes[o]={id:o,type:"Issue",modifiedAttributes:["reportedAgainst","resolvedBy","resolvedItems","contexts"]};var a=s.results;return u.get("component").publishUpdate(i),t.refreshNodesById({modified:n}).then((()=>a))}))},removeContextsOrReportedAgainstOrResolvedByOrResolvedItems:function(e){var t=this;g.start(t.name+" removeContextsOrReportedAgainstOrResolvedByOrResolvedItems");for(var n=Object.keys(e),i=[],o=0;o<n.length;o++){if(Array.isArray(e[n[o]].reportedAgainst))for(var a=0;a<e[n[o]].reportedAgainst.length;a++){var r=e[n[o]].reportedAgainst[a].physicalId,l=(r=r.split(","))[r.length-1];e[n[o]].reportedAgainst[a].physicalId=l+"",e[n[o]].reportedAgainst[a].path=r}i.push(e[n[o]])}return m.related.delete({data:{objects:i},onFailure:function(e){t._logger.error(e);var n="";if(e&&e.error&&e.error.internal)n=e.error.internal;if(n.includes("No business object")||n.includes("not exist")){var i=f.getErrorMessage("0");f.displayErrorMessage(i,"error")}else if(n.includes("ErrorCode:2005")){i=f.getErrorMessage("2005");f.displayErrorMessage(i,"error")}else if(n.includes("No fromdisconnect access to object")){i=f.getErrorMessage("10");f.displayErrorMessage(i,"error")}else s.displayNotification({msg:e.error.message,eventID:"error"})}}).then((function(){g.end(t.name+" removeContextsOrReportedAgainstOrResolvedByOrResolvedItems");var s={paths:[],attributes:{}};for(var i in e)s.paths.push([i]),s.attributes[i]={id:i,type:"Issue",modifiedAttributes:["reportedAgainst","resolvedBy","resolvedItems","contexts"]};return u.get("component").publishUpdate(s),t.refreshNodesById({modified:n})}))},refreshNodesById:function(n){var s=this;g.start(s.name+" refreshNodesById");var i=[],o=[],a=[];return new t((function(t,s){e.is(n.created)&&e.is(n.created,"array")&&n.created.forEach((function(e){-1===i.indexOf(e)&&(i.push(e),a.push(e))})),e.is(n.modified)&&e.is(n.modified,"array")&&n.modified.forEach((function(e){-1===i.indexOf(e)&&(i.push(e),o.push(e))})),i.length>0&&m.issues.retrieve({timestamp:n.timestamp?n.timestamp:null,data:{objects:i.map((function(e){return{physicalId:e}}))},onComplete:function(e){let n=e.results.map((e=>e.body));h.addTypeToNonIndexIds(n).then((e=>{let n=e.map((e=>({body:e})));var s=d.parse(n.map((function(e){return e.body})));t(s)}))},onFailure:function(e){s(e)}})})).then((function(e){var t=[],n=[],i=[],r={};return e.forEach((function(e){e.reportedAgainst.forEach((function(e){e.pid=e.physicalId})),e.contexts.forEach((function(e){e.pid=e.physicalId})),e.resolvedBy.forEach((function(e){e.pid=e.physicalId})),e.resolvedItems.forEach((function(e){e.pid=e.physicalId})),-1!==a.indexOf(e.id)&&t.push(e),-1!==o.indexOf(e.id)&&(n.push(e),i.push([e.id]),r[e.id]={id:e.id,type:e.type,name:e.name,title:e.title})})),s.addRoots(t,!0).then((function(e){var t=[];return s.withTransactionUpdate((function(){n.forEach((function(e){var n=s.searchRootById(e.id);null!==n&&(d.update(n.options,e),s.listView&&null!=s.listView||n.updateGrid(e),n.updateOptions(e),s.refreshChildrenNodeById(e.id),t.push(n))}))})),g.end(s.name+" refreshNodesById"),{created:e,modified:t}}))}))},refreshChildrenNodeById:function(e){var t=this,n=t.searchRootById(e);if(g.start(t.name+" refreshChildrenNodeById"),0===n.options.reportedAgainst.length&&0===n.options.resolvedBy.length&&0===n.options.resolvedItems.length&&0===n.options.contexts.length)n.removeChildren(),n.setState({state:"noChildren"});else if(n.isExpanded())n.expand();else{var s=n.getChildren();Array.isArray(s)&&0!==s.length||n.addChild(new l)}g.end(t.name+" refreshChildrenNodeById")},searchRootById:function(e){var t=this,n=null;g.start(t.name+" searchRootById");for(var s=t.getRoots(),i=0;i<s.length;i++)if(s[i].options.id===e){n=s[i];break}return g.end(t.name+" searchRootById"),n},autoFill:{_physicalIdsForValidation:{},_physicalIdsForClassification:{},validation:function(e){var t=this;t._physicalIdsForValidation[e]=e,t._autoFillValidation(Object.keys(t._physicalIdsForValidation))},_autoFillValidation:D((function(t){var n=t.reduce((function(e,t){return e.push({physicalId:t}),e}),[]);this._physicalIdsForValidation={},m.routes.retrieve({data:{objects:n}}).then((function(t){for(var n={},s=0;s<t.results.length;s++){var i=t.results[s].body,o={};if(e.is(i.current.status,"string"))o=e.clone(i.current);else if(Array.isArray(i.history)&&i.history.length>0){var a=i.history.sort((function(e,t){var n=0;if(e.date)if(t.date){n=new Date(e.date)-new Date(t.date)}else n=1;else n=-1;return-1*n}));o=e.clone(a[w])}else o={status:"notStarted",approveTo:"",decisions:[]};n[i.physicalId]={activated:!0,fetched:!0,status:o.status,approveTo:o.approveTo,decisions:o.decisions}}for(var r=T.getRoots(!1),l=0;l<r.length;l++){var c=r[l];n[c.options.physicalId]&&c.updateOptions({validation:n[c.options.physicalId]})}}))}),C),classificationAttributes:function(e,t){var n=this;if(n._physicalIdsForClassification[e]){var s=n._physicalIdsForClassification[e];if(!s.attributes.some((e=>e.name===t))){var i={name:t};s.attributes.push(i)}}else{n._physicalIdsForClassification[e]={},n._physicalIdsForClassification[e].physicalId=[e];i={name:t};n._physicalIdsForClassification[e].attributes=[i]}n._autoFillClassification(n._physicalIdsForClassification)},_autoFillClassification:D((function(e){m.classification.retrieve({data:{objects:e}}).then((function(t){for(var n=u.get("classAttrNLS"),s={},i=0;i<t.results.length;i++){var o=t.results[i].body,a=o.physicalId;s[a]=[];for(var r=e[a].attributes,l=0;l<r.length;l++){var c=r[l].name,d="";o[c]&&(d=n[c]?.rangeValues?f.getMulValueAttr(c,o[c]):o[c].substring(1,o[c].length-1));var p={};p.attrName=c,p.attrValue=d,s[a].push(p)}}var m=T.getAllDescendants();for(l=0;l<m.length;l++){var g=m[l];if(s[g.options.physicalId]){r=s[g.options.physicalId];for(var h=0;h<r.length;h++){var v=r[h].attrName,I=r[h].attrValue;const e=f.getFormattedValueAsPerTypeRepresentation(v,I);var b={grid:{}};b.grid[v]=e,g.updateOptions(b)}}}}))}),C)},getComponent:function(){return this.component},getRoots:function(t){var n=this,s=n._parent();if(!0===t&&e.is(n._getChildrenFilterInfo,"function")){var i=n._getChildrenFilterInfo();if(i&&e.is(i.childrenBeforeFiltering,"array")){var o=s;s=i.childrenBeforeFiltering.slice(0),o.forEach((function(e){s.indexOf(e)<0&&s.push(e)}))}}return s},removeIssueRoots:function(){var t=this;if(t.removeRoots(),e.is(t._getChildrenFilterInfo,"function")){var n=t._getChildrenFilterInfo();n&&e.is(n.childrenBeforeFiltering,"array")&&(delete n.childrenBeforeFiltering,delete n.filteredOutChildren)}},getNodesById:function(e){var t=this,n=[];g.start(t.name+" getNodesById");for(var s=t.getRoots(!1),i=0;i<s.length;i++)n=n.concat(s[i].getNodesById(e));return g.end(t.name+" getNodesById"),n},getNodesByPath:function(e){var t=this;function n(e,t,s,i){if(e.options.id===t[s])if(s===t.length-1)i.push(e);else{var o=e.getChildren();o&&o.length>0&&(s+=1,o.forEach((function(e){n(e,t,s,i)})))}}g.start(t.name+" getNodesByPath");for(var s=[],i=t.getRoots(!1),o=0;o<i.length;o++)n(i[o],e,0,s);return g.end(t.name+" getNodesByPath"),s},getReportedAgainstFromSelectedNodes:function(){for(var e=this.getSelectedNodes(),t=[],n=0;n<e.length;n++){var s=e[n];s.options.baseType===b?s.options.reportedAgainst.forEach((function(e){t.push(e.physicalId)})):t.push(s.options.id)}return t},getIssuesFromSelectedNodes:function(){for(var e=this.getSelectedNodes(),t=[],n=0;n<e.length;n++){var s=e[n];s.options.baseType===b&&t.push(s)}return t},_onPreExpand:function(e){g.start(this.name+" _onPreExpand");var t=e.data.nodeModel;t.removeChildren(),t.options.data.isExpandMultiple?t.options.data.expandEvent=e:this.updateNodesOnExpand([t],e)},updateNodesOnExpand:function(t,n){var i=this;g.start(i.name+"updateNodesOnExpand");var o=function(e,t,o){!0===t?(i._logger.warn("Expand request has failed: %o",e),s.displayNotification({msg:v.notifications.serverWarning,eventID:"warning"})):(i._logger.error("Expand request has failed: %o",e),s.displayNotification({msg:v.notifications.serverError,eventID:"error"})),""==o&&null==o||(o.options.children=[],o.options.data.isExpandMultiple&&o.options.data.expandEvent?o.options.data.expandEvent.target.preExpandDone({state:"collapsed"}):""!=n&&null!=n&&n.target.preExpandDone({state:"collapsed"}))};i.retrieveContentAndFetch(t).then((function(s){if(Array.isArray(s.body.results)){let l={};var a=[];s.body.results.forEach((t=>{let n={};var s="";t.attributes.forEach((t=>{switch(e.is(t.name,"string")?t.name.replace("ds6w:what/","").replace("ds6w:when/","").replace("ds6w:who/","").replace("ds6w:where/ds6w:source/","").replace("ds6w:where/",""):t.name){case"resourceid":n.pid=t.value,""==s&&(s=t.value);break;case"ds6w:label":n.title=t.value;break;case"ds6w:type":n.type=t.value;break;case"ds6w:identifier":n.name=t.value;break;case"ds6wg:revision":n.revision=t.value;break;case"ds6w:policy":a.push(t.value);break;case"ds6w:dataSource":n.serviceId=Array.isArray(t.value)?t.value[0].replace("ds6w:dataSource.",""):t.value;break;case"ds6w:kind":n.kind=t.value;break;case"ds6w:i3dx":""!=t.value&&(s=t.value)}})),n.data={...t,physicalId:s},l[s]=n,""!==n.pid&&(l[n.pid]=n)})),a=[...new Set(a)],i.setClassContentType({policies:a}),t.forEach((e=>{e.removeChildren();var t={},s=[];let a=e.options.contexts;t.contexts=[],a.forEach((e=>{if(l[e.physicalId]){let{data:n,...i}=l[e.physicalId];i={...e,...i},t.contexts.push(i),s.push(l[e.physicalId].data)}}));let r=e.options.reportedAgainst;t.reportedAgainst=[],r.forEach((e=>{if(l[e.physicalId]){let{data:n,...i}=l[e.physicalId];i={...e,...i},t.reportedAgainst.push(i),s.push(l[e.physicalId].data)}}));let c=e.options.resolvedBy;t.resolvedBy=[],c.forEach((e=>{if(l[e.physicalId]){let{data:n,...i}=l[e.physicalId];i={...e,...i},t.resolvedBy.push(i),s.push(l[e.physicalId].data)}}));let d=e.options.resolvedItems;t.resolvedItems=[],d.forEach((e=>{if(l[e.physicalId]){let{data:n,...i}=l[e.physicalId];i={...e,...i},t.resolvedItems.push(i),s.push(l[e.physicalId].data)}})),e.options.contexts=t.contexts,e.options.reportedAgainst=t.reportedAgainst,e.options.resolvedBy=t.resolvedBy,e.options.resolvedItems=t.resolvedItems;let u=[...new Map(s.map((e=>[e.physicalId,e]))).values()];if(u.length>0)try{i.addChildren(e,{results:u}),e.options.data.isExpandMultiple&&e.options.data.expandEvent?e.options.data.expandEvent.target.preExpandDone({state:"expanded"}):""!=n&&null!=n&&n.target.preExpandDone({state:"expanded"})}catch(t){o(t.toString(),!1,e)}else e.options.children=null,e.options.data.isExpandMultiple&&e.options.data.expandEvent?e.options.data.expandEvent.target.preExpandDone({state:"collapsed"}):""!=n&&null!=n&&n.target.preExpandDone({state:"collapsed"}),e.setState({state:"noChildren"}),e.options.contexts=[],e.options.reportedAgainst=[],e.options.resolvedBy=[],e.options.resolvedItems=[],e.options.data.isExpandMultiple=!1}));var r=[];t.forEach((e=>{null!=e.getChildren()&&e.options.children.forEach((e=>{"reportedAgainst"==e.options.data.relationToIssue&&r.push(e)}))})),r.length>0&&i.fetchOccurencePath(r)}else t.forEach((e=>{e.options.children=null,e.options.data.isExpandMultiple&&e.options.data.expandEvent?e.options.data.expandEvent.target.preExpandDone({state:"collapsed"}):""!=n&&null!=n&&n.target.preExpandDone({state:"collapsed"}),e.setState({state:"noChildren"}),e.options.contexts=[],e.options.reportedAgainst=[],e.options.resolvedBy=[],e.options.resolvedItems=[],e.options.data.isExpandMultiple=!1}))}),(function(e){o(e,!1,"")})).finally((function(){g.end(i.name+" _onPreExpand")}))},retrieveContentAndFetch:function(e){var n=this;let s=[];return e.forEach((e=>{e.options.reportedAgainst.forEach((e=>{s.push(e.physicalId)})),e.options.resolvedBy.forEach((e=>{s.push(e.physicalId)})),e.options.contexts.forEach((e=>{s.push(e.physicalId)})),e.options.resolvedItems.forEach((e=>{s.push(e.physicalId)}))})),s=[...new Set(s)],new t(((e,i)=>{var o=parseInt(s.length/1e4);s.length/1e4>parseInt(s.length/1e4)&&o++;const a=[];n.results=[];for(let e=1;e<=o;e++){var r=s.map((function(t,n){if(n>=1e4*(e-1)&&n<1e4*e)return{physicalId:t}})).filter((function(e){return void 0!==e}));let t=m.fetch({data:{objects:r,predicates:n.component.list.getPredicates()}}).then((function(e){Array.isArray(e.body.results)&&n.results.push(...e.body.results)})).catch((function(e){i(e)}));a.push(t)}t.all(a).then((function(){let t={body:{results:n.results}};e(t)}))}))},_onPostExpand:function(t){g.start(this.name+" _onPostExpand");var n=t.data.nodeModel,s=u.get("widget")||window.widget,i=e.clone(s.getValue("expandedIds"));!1===Array.isArray(i)&&(i=[]),i.includes(n.options.physicalId)||i.push(n.options.physicalId),n.options.data.isExpandMultiple=!1,s.setValue("expandedIds",i),s.dispatchEvent("endEdit"),g.end(this.name+" _onPreExpand")},_onPostCollapse:function(t){g.start(this.name+" _onPostCollapse");var n=t.data.nodeModel,s=u.get("widget")||window.widget,i=e.clone(s.getValue("expandedIds"));!1===Array.isArray(i)&&(i=[]);var o=i.indexOf(n.options.physicalId);-1!==o&&(i.splice(o,1),s.setValue("expandedIds",i),s.dispatchEvent("endEdit")),g.end(this.name+" _onPreCollapse")},_onFilter:function(){var e=this.getNumberOfVisibleChildren(),t=u.get("status"),n=v.replace(v.loadedIssues,{number:e});t.loadedDiv.textContent=n},_subscribers:function(){var e=this;e.getXSO().onEmpty((function(){e.prepareBroadcastSelect(),setTimeout((function(){0===e.getSelectedNodes().length&&e.pushBroadcastSelect()}),y)})),e.getXSO().onChange((function(){var t=u.get("status"),n=e.getSelectedNodes().filter((e=>"Issue"==e.options.baseType)),s=v.replace(v.selectedIssues,{number:n.length});t.selectedDiv.textContent=s})),e.onPreExpand((function(t){e._onPreExpand(t)})),e.onPostExpand((function(t){e._onPostExpand(t)})),e.onPostCollapse((function(t){e._onPostCollapse(t)})),e.getModelEvents().subscribe({event:"filter"},e._onFilter)},setClassContentType:function(e){var n={data:e};return new t((function(e,t){m.issues.getStatesAttributes(n).then((function(t){f.addCSSMaturityClasses("wux-controls-label",t),e()})).catch((function(e){return e}))}))},utils:{isJson:function(e){try{JSON.parse(e)}catch(e){return!1}return!0}}})})),define("DS/IssueManagement/components/welcomePanel/view/TriptchWrapper",["DS/ENOXTriptych/js/ENOXTriptych","DS/IssueManagement/components/welcomePanel/view/GlobalConfig","css!DS/IssueManagement/IssueManagement.css","i18n!DS/IssueManagement/assets/nls/IssueManagement"],(function(e,t,n,s){"use strict";var i=function(){};return i.prototype.init=function(n,s,i,o,a){this._left=document.createElement("div"),this._left.classList.add("isu-triptych-wrapper"),this._main=document.createElement("div"),this._main.classList.add("isu-triptych-wrapper"),this._right=document.createElement("div"),this._right.classList.add("isu-triptych-wrapper"),this._applicationChannel=n,this._triptych=new e;var r=widget.body.offsetWidth<550?"close":"open",l={left:{resizable:!1,originalSize:t.LEFT_PANEL_SIZE_EXPANDED,originalState:r,overMobile:!0,withClose:!1},right:{resizable:!0,minWidth:250,originalSize:430,originalState:"close",overMobile:!0},borderLeft:!0,container:s,withtransition:!0,modelEvents:this._applicationChannel,useNewUXGuidelines:!0};this._triptych.init(l,this._left,this._main,this._right)},i.prototype.inject=function(e){this._triptych.inject(e)},i.prototype._getTriptych=function(){return this._triptych},i.prototype.getLeftPanelContainer=function(){return this._left},i.prototype.getLeftPanelContainerTriptych=function(){return this._triptych._leftPanelContent},i.prototype.getRightPanelContainer=function(){return this._right},i.prototype.getMainPanelContainer=function(){return this._main},i})),define("DS/IssueManagement/views/kanban/Keyboard",["UWA/Core","DS/IssueManagement/commands/CommandsManager","DS/IssueManagement/views/list/Keyboard","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance"],(function(e,t,n,s,i){"use strict";var o="DS/IssueManagement/views/kanban/Keyboard",a=function(){return!(window.document.getElementsByClassName("wux-menu").length>0&&window.document.getElementsByClassName("wux-menu-container").length>0)};return{override:function(t){var n=this._addShouldWeProcessThisInputTrigger(t);return e.extend(n,this.commands)},_addShouldWeProcessThisInputTrigger:function(t){i.start(o+" _addShouldWeProcessThisInputTrigger");var n=e.clone(t);for(var s in t)!function(){if(t.hasOwnProperty(s)){var e=t[s];n[s]=function(){return!1===a()?null:e.apply(this,arguments)}}}();return i.end(o+" _addShouldWeProcessThisInputTrigger"),n},commands:{rightMove:function(){if(!1!==a()){i.start(o+" right");var t=s.get("component").getKanbanView();if(e.is(t.siblings.right,"object")){t.siblings.right.grid.elements.container.focus();var n=t.siblings.right.getTreeDocument().getRoots(!1);e.is(n[t.verticalLevelSelector],"object")?n[t.verticalLevelSelector].select():n.length>0&&n[n.length-1].select()}i.end(o+" right")}},leftMove:function(){if(!1!==a()){i.start(o+" left");var t=s.get("component").getKanbanView();if(e.is(t.siblings.left,"object")){t.siblings.left.grid.elements.container.focus();var n=t.siblings.left.getTreeDocument().getRoots(!1);e.is(n[t.verticalLevelSelector],"object")?n[t.verticalLevelSelector].select():n.length>0&&n[n.length-1].select()}i.end(o+" left")}},enter:e.clone(n["treelistview:edit-mode"]),escape:e.clone(n["treelistview:edit-cancel"]),copy:e.clone(n["treelistview:copy-node"]),deleteKeyPressed:e.clone(n["treelistview:delete-node"])}}})),define("DS/IssueManagement/components/welcomePanel/router/RouteConfig",["DS/IssueManagement/components/welcomePanel/router/Router","DS/IssueManagement/components/welcomePanel/view/GlobalConfig","DS/IssueCommon/utils/Utils"],(function(e,t,n){return{initialize:function(){e.initialize(t.ROUTE_HOME,t.PATH_HOME),[{name:t.ROUTE_IM_DETAILS,path:"/"+t.PATH_IM_DETAILS},{name:t.ROUTE_IT_DETAILS,path:"/"+t.PATH_IT_DETAILS},{name:t.ROUTE_CREATE_IM_DETAILS,path:"/"+t.PATH_CREATE_IM_DETAILS},{name:t.ROUTE_CREATE_IT_DETAILS,path:"/"+t.PATH_CREATE_IT_DETAILS},{name:t.ROUTE_WHATS_NEW_DETAILS,path:"/"+t.PATH_WHATS_NEW_DETAILS}].forEach((t=>{e.addRoute(t)}));var s={};for(var i in s[t.ROUTE_HOME]={activate:function(){var n=e.getDependency("issueApp"),s=e.getDependency("applicationChannel");s.publish({event:"information-panel-close",data:null}),widget.getValue("IsIssueSummaryView")||null==widget.getValue("IsIssueSummaryView")||null==widget.getValue("IsIssueSummaryView")?(n._initIssueManagementContent(),s.publish({event:"welcome-panel-select-action",data:{id:t.PATH_IM_DETAILS}})):(n._initIssueTemplateContent(),s.publish({event:"welcome-panel-select-action",data:{id:t.PATH_IT_DETAILS}}))},deactivate:function(){var t=e.getDependency("issueApp");widget.getValue("IsIssueSummaryView")?t.clearIssueManagement():t.clearIssueTemplate()}},s[t.ROUTE_IM_DETAILS]={activate:function(s){var i=e.getDependency("issueApp");e.getDependency("applicationChannel").publish({event:"welcome-panel-select-action",data:{id:t.PATH_IM_DETAILS}}),i._initIssueManagementContent();try{n.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"MyIssues"}})}catch(e){}},deactivate:function(){e.getDependency("issueApp").clearIssueManagement()}},s[t.ROUTE_IT_DETAILS]={activate:function(){var s=e.getDependency("issueApp"),i=e.getDependency("applicationChannel");widget.getValue("isOpened")&&i.publish({event:"information-panel-close"}),i.publish({event:"welcome-panel-select-action",data:{id:t.PATH_IT_DETAILS}}),s._initIssueTemplateContent();try{n.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"MyTemplates"}})}catch(e){}},deactivate:function(){e.getDependency("issueApp").clearIssueTemplate()}},s[t.ROUTE_CREATE_IM_DETAILS]={activate:function(){t.ROUTE_CREATE_IM_DETAILS;var n=e.getDependency("issueApp");e.getDependency("applicationChannel").publish({event:"welcome-panel-select-action",data:{id:t.PATH_CREATE_IM_DETAILS}}),n.openCreateIssuePanel()}},s[t.ROUTE_CREATE_IT_DETAILS]={activate:function(){t.ROUTE_CREATE_IT_DETAILS;var n=e.getDependency("issueApp");e.getDependency("applicationChannel").publish({event:"welcome-panel-select-action",data:{id:t.PATH_CREATE_IT_DETAILS}}),n.openCreateTemplatePanel()}},s[t.ROUTE_WHATS_NEW_DETAILS]={activate:function(){t.ROUTE_CREATE_IT_DETAILS;var n=e.getDependency("issueApp");e.getDependency("applicationChannel").publish({event:"welcome-panel-select-action",data:{id:t.PATH_CREATE_IT_DETAILS}}),n.openCreateTemplatePanel()}},s)s.hasOwnProperty(i)&&e.addRouteMethods(i,s[i]);publishEventSelectionAction=function(e){applicationChannel.publish({event:"welcome-panel-select-action",data:{id:t.PATH_CREATE_IT_DETAILS}})}}}})),define("DS/IssueManagement/components/header/IssueToolbarActions",["DS/IssueManagement/commands/CommandsManager","DS/IssueServices/Contexts","DS/IssueCommon/utils/Utils"],(function(e,t,n){"use strict";var s={setFilterOptionsOnWidget:function(e,t){require(["DS/IssueManagement/components/header/IssueDataGridToolbar","DS/IssueServices/Contexts"],(function(e,s){var i=s.get("widget")||window.widget,o=[{IdValue:t,StateValue:"selected"}];e.toggleFilterItem(o,e.toolbarActionBar);var a=e.toolbarActionBar.getNodeModelByID("Filter").options.grid.data.menu;if("session"===t)a.forEach((function(t){if("session"!==t.id&&"others"!==t.id&&"closed"!==t.id&&"filterbyobject"!==t.id&&"selected"===t.state){var n=[{IdValue:t.id,StateValue:"selected"}];e.toggleFilterItem(n,e.toolbarActionBar)}}));else if("closed"!==t){var r=a.find((e=>"session"===e.id));if(r.state.includes("selected")){o=[{IdValue:r.id,StateValue:"selected"}];e.toggleFilterItem(o,e.toolbarActionBar)}}var l=e.getSelectedFilterOptions(e.toolbarActionBar);if(i.setValue("filter",JSON.stringify(l)),"filterbyobject"!=t)i.dispatchEvent("onRefresh",["filter"]),i.dispatchEvent("endEdit");else if("filterbyobject"===t){var c=s.get("filter");!0===l[t]?c.showContextFilter():c.hideContextFilter();try{var d=s.get("component").getCurrentView();n.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:d,pd3:"SummaryToolbar",pd4:"FilterByObject",pd5:"Issue/"+d+"/SummaryToolbar/FilterByObject"}}),n.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"SummaryToolbar"}})}catch(e){}}}))},inlineCreate:function(){e.getCommandCheckHeader("InlineCreate").toggleState()},createCA:function(e){require(["DS/IssueCommon/commands/ChangeAction"],(function(t){(new t).execute(e.options)}));try{var s=t.get("component").getCurrentView();n.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:s,pd3:"SummaryToolbar",pd4:"AddNewCAAsResolvedBy",pd5:"Issue/"+s+"/SummaryToolbar/AddNewCAAsResolvedBy"}}),n.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"SummaryToolbar"}})}catch(e){}},create3DMarkUp:function(s){e.getCommand("3DMarkup").begin();try{var i=t.get("component").getCurrentView();n.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:i,pd3:"SummaryToolbar",pd4:"AddNew3DMarkupAsAttachment",pd5:"Issue/"+i+"/SummaryToolbar/AddNew3DMarkupAsAttachment"}}),n.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"SummaryToolbar"}})}catch(e){}},selectAll:function(s){e.getCommand("SelectAllIssues").begin();try{var i=t.get("component").getCurrentView();n.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:i,pd3:"SummaryToolbar",pd4:"SelectAllIssues",pd5:"Issue/"+i+"/SummaryToolbar/SelectAllIssues"}}),n.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"SummaryToolbar"}})}catch(e){}},selectAllRelatedObjects:function(s){e.getCommand("SelectAllRelatedObjects").begin();try{var i=t.get("component").getCurrentView();n.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:i,pd3:"SummaryToolbar",pd4:"SelectAllVisibleIssueContent",pd5:"Issue/"+i+"/SummaryToolbar/SelectAllVisibleIssueContent"}}),n.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"SummaryToolbar"}})}catch(e){}},unselectAll:function(s){e.getCommand("UnselectAll").begin();try{var i=t.get("component").getCurrentView();n.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:i,pd3:"SummaryToolbar",pd4:"UnselectAll",pd5:"Issue/"+i+"/SummaryToolbar/UnselectAll"}}),n.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"SummaryToolbar"}})}catch(e){}},customizeColumnView:function(s){require(["DS/IssueManagement/components/header/IssueDataGridToolbar","DS/IssueServices/Contexts"],(function(e,t){t.get("widget")||window.widget})),e.getCommand("ColumnCustomization").begin();try{var i=t.get("component").getCurrentView();n.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:i,pd3:"SummaryToolbar",pd4:"CustomView",pd5:"Issue/"+i+"/SummaryToolbar/CustomView"}}),n.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"SummaryToolbar"}})}catch(e){}},customizeByState:function(){require(["DS/IssueServices/Contexts","DS/IssueManagement/components/header/IssueDataGridToolbar"],(function(e,t){var n=e.get("widget"),s="state",i=[{IdValue:s,StateValue:"selected"}];t.toggleKanbanCustomizeItem(i,t.toolbarActionBar),e.get("component").kanban.switchView(s),n.setValue("kanbanViewBy",s),n.dispatchEvent("endEdit")}))},customizeByPriority:function(){require(["DS/IssueServices/Contexts","DS/IssueManagement/components/header/IssueDataGridToolbar"],(function(e,t){var n=e.get("widget"),s="priority",i=[{IdValue:s,StateValue:"selected"}];t.toggleKanbanCustomizeItem(i,t.toolbarActionBar),e.get("component").kanban.switchView(s),n.setValue("kanbanViewBy",s),n.dispatchEvent("endEdit")}))},customizeByResDate:function(){require(["DS/IssueServices/Contexts","DS/IssueManagement/components/header/IssueDataGridToolbar"],(function(e,t){var n=e.get("widget"),s="resolutionDate",i=[{IdValue:s,StateValue:"selected"}];t.toggleKanbanCustomizeItem(i,t.toolbarActionBar),e.get("component").kanban.switchView(s),n.setValue("kanbanViewBy",s),n.dispatchEvent("endEdit")}))},customizeByAll:function(){require(["DS/IssueServices/Contexts","DS/IssueManagement/components/header/IssueDataGridToolbar"],(function(e,t){var n=e.get("widget"),s="all",i=[{IdValue:s,StateValue:"selected"}];t.toggleKanbanCustomizeItem(i,t.toolbarActionBar),e.get("component").kanban.switchView(s),n.setValue("kanbanViewBy",s),n.dispatchEvent("endEdit")}))},switchView:function(s){e.getCommand("SwitchView").begin(s);try{var i="DataGridView";"KanbanView"===s&&(i="KanbanView");var o=t.get("component").getCurrentView();n.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:o,pd3:"SummaryToolbar",pd4:i,pd5:"Issue/"+o+"/SummaryToolbar/"+i}}),n.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"SummaryToolbar"}})}catch(e){}},print:function(s){e.getCommand("Print").begin();try{var i=t.get("component").getCurrentView();n.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:i,pd3:"SummaryToolbar",pd4:"Print",pd5:"Issue/"+i+"/SummaryToolbar/Print"}}),n.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"SummaryToolbar"}})}catch(e){}},manageTemplates:function(t){e.getCommand("Templates").begin()},exportCSV:function(s){e.getCommand("ExportCSV").begin();try{var i=t.get("component").getCurrentView();n.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:i,pd3:"SummaryToolbar",pd4:"ExportAsCSV",pd5:"Issue/"+i+"/SummaryToolbar/ExportAsCSV"}}),n.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"SummaryToolbar"}})}catch(e){}},exportPPTX:function(s){e.getCommand("ExportPPTX").begin();try{var i=t.get("component").getCurrentView();n.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:i,pd3:"SummaryToolbar",pd4:"ExportAsPPTX",pd5:"Issue/"+i+"/SummaryToolbar/ExportAsPPTX"}}),n.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"SummaryToolbar"}})}catch(e){}},exportZIP:function(s){e.getCommand("ExportZIP").begin();try{var i=t.get("component").getCurrentView();n.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:i,pd3:"SummaryToolbar",pd4:"ExportAsZIP",pd5:"Issue/"+i+"/SummaryToolbar/ExportAsZIP"}}),n.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"SummaryToolbar"}})}catch(e){}},exportBCF:function(){e.getCommand("UnifiedExportCommand").execute();try{var s=t.get("component").getCurrentView();n.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:s,pd3:"SummaryToolbar",pd4:"ExportAsBCF",pd5:"Issue/"+s+"/SummaryToolbar/ExportAsBCF"}}),n.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"SummaryToolbar"}})}catch(e){}},subscribe:function(t){e.getCommand("Subscription").begin(t.actionId)},switchLayout:function(s){e.getCommand("SwitchLayout").begin({layout:s,save:!0});var i="InformationPanelDisplayAtRight";"bottom"===s&&(i="InformationPanelDisplayAtBottom");try{var o=t.get("component").getCurrentView();n.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:o,pd3:"SummaryToolbar",pd4:i,pd5:"Issue/"+o+"/SummaryToolbar/"+i}}),n.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"SummaryToolbar"}})}catch(e){}},openInformationPanel:function(s){e.getCommand("ToggleInformationPanel").begin({open:s,save:!0});try{var i=t.get("component").getCurrentView();n.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:i,pd3:"SummaryToolbar",pd4:"InformationPanel",pd5:"Issue/"+i+"/SummaryToolbar/InformationPanel"}}),n.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"SummaryToolbar"}})}catch(e){}},resize:function(){require(["DS/IssueServices/Contexts"],(function(t){e.getCommandCheckHeader("InlineCreate")&&e.getCommandCheckHeader("InlineCreate").resize(),t&&t.get("filter")&&t.get("filter").resize()}))},createTask:function(e){require(["DS/IssueCommon/commands/CreateTask"],(function(t){(new t).execute(e.options)}))},addExisting:function(){e.getCommand("AddUsingSearchAsResolvedBy").begin()}};return s})),define("DS/IssueManagement/views/kanban/TileList",["UWA/Core","DS/CollectionView/ResponsiveLargeTilesCollectionView","DS/IssueManagement/views/kanban/Keyboard"],(function(e,t,n){"use strict";return t.inherit({_manageKeyboard:function(){var t=this;t._parent();var s=n.override(t.commands);e.extend(t.commands,s)}})})),define("DS/IssueManagement/components/idcard/IssueIdcard",["DS/IssueManagement/components/idcard/IssueMaturity","DS/ENOXIDCard/js/IDCard","DS/ENOFloatingPanel/ENOFloatingPanel","DS/UIKIT/Input/Button","DS/IssueServices/services/IssueServices","DS/IssueComponents/utils/Utils","DS/IssueComponents/search/PeopleSearch","DS/SearchWidget/SearchWidgetConstant","DS/Controls/TooltipModel","DS/IssueServices/Contexts","DS/IssueCommon/utils/Utils","DS/PADUtils/views/PADAlert","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueCommon/assets/nls/IssueCommon","i18n!DS/IssueComponents/assets/nls/IssueComponents"],(function(e,t,n,s,i,o,a,r,l,c,d,u,p,m,g){var f="Low",h="Medium",v="High",I="Urgent";return t.extend({fields:{responsibleOrganization:null,reportingOrganization:null},values:{responsibleOrganization:null,responsibleOrganizationTitle:null,reportingOrganization:null,reportingOrganizationTitle:null},renderView:function(){try{d.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"IDCard"}})}catch(e){}finally{var e=this;e.render(),e._removeOtherTitleSections(),e._addNavigationButtons(),e._updateActionIcon(),e._subscribeViewEvents()}return e},resize:function(){var e=this,t=e.container.offsetWidth,n=e.container.getElement(".main-section").offsetWidth;e.container.hasClassName("minified")?e._checkMinifiedAttributesOverflow():e._checkAttributesOverflow(),e.container.getElement(".free-zone-1").addClassName("hidden"),e.container.getElement(".free-zone-0").addClassName("hidden"),t<420?(e.container.addClassName("no-image-placeholder"),e.container.getElement(".image-placeholder").addClassName("hidden")):(e.container.removeClassName("no-image-placeholder"),e.container.getElement(".image-placeholder").removeClassName("hidden")),null!==e.container.getElement('.attribute-columns[data-column-index="1"]')&&(n<646?e.container.getElement('.attribute-columns[data-column-index="1"]').addClassName("hidden"):e.container.getElement('.attribute-columns[data-column-index="1"]').removeClassName("hidden")),null!==e.container.getElement('.attribute-columns[data-column-index="2"]')&&(n<1e3?e.container.getElement('.attribute-columns[data-column-index="2"]').addClassName("hidden"):e.container.getElement('.attribute-columns[data-column-index="2"]').removeClassName("hidden"))},_removeOtherTitleSections:function(){var e=this;e.container.getElement(".version").addClassName("hidden"),e.container.getElement(".versionModel").addClassName("hidden"),e.container.getElement(".modelVersion").addClassName("hidden"),e.container.getElement(".ngfilter").addClassName("hidden"),e.container.getElement(".configuration").addClassName("hidden")},_addNavigationButtons:function(){var e=this;let t=e.container.getElement(".title-section-buttons"),n=UWA.createElement("div",{class:"fonticon-chevron-left wux-ui-3ds",title:p.information.header.goToPrevious,events:{click:function(){e.modelEvents.publish({event:"issue-idcard-nav-prev",data:{}});try{var t=c.get("component").getCurrentView();d.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:t,pd3:"IDCard",pd4:"PreviousIssue",pd5:"Issue/"+t+"/IDCard/PreviousIssue"}})}catch(e){}}}});UWA.createElement("div",{class:"fonticon-chevron-right wux-ui-3ds",title:p.information.header.goToNext,events:{click:function(){e.modelEvents.publish({event:"issue-idcard-nav-next",data:{}});try{var t=c.get("component").getCurrentView();d.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:t,pd3:"IDCard",pd4:"NextIssue",pd5:"Issue/"+t+"/IDCard/NextIssue"}})}catch(e){}}}}).inject(t,"top"),n.inject(t,"top"),UWA.createElement("span",{class:"wux-ui-3ds-close wux-ui-3ds",title:p.information.header.close,events:{click:function(){e.modelEvents.publish({event:"issue-idcard-nav-close",data:{}});try{var t=c.get("component").getCurrentView();d.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:t,pd3:"IDCard",pd4:"Close",pd5:"Issue/"+t+"/IDCard/Close"}})}catch(e){}}}}).inject(t)},_updateActionIcon:function(){var e=this.container.getElement(".title-section-buttons").getElementsByClassName("actions-menu-icon")[0];e.removeClassName("fonticon-open-down"),e.addClassName("fonticon-menu-dot");try{d.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"IDCardActions"}})}catch(e){}},_addMaturityComponent:function(t){var n=this.container.getElements("#maturity");if(n.forEach((e=>e.empty())),UWA.is(t)){new e({bos:t,modelEvents:this.modelEvents,showRoute:!0}).buildMaturityView({targetDivs:n}).refresh()}try{d.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"IDCard"}})}catch(e){}},_subscribeViewEvents:function(){},setAttributeValue:function(e,t,n){var s=this;s.model.get("attributes").forEach((s=>{s.id==e&&(s.value=t,s.isVaries=!!UWA.is(n,"boolean")&&n)}));UWA.String.escapeHTML(t);if("priority"==e){s.container.getElements("#priority").map((e=>{let n=s._priorityDiv({priority:t});e.innerHTML=n.div,e.title=n.nls}))}else{let n=`#${e}`;s.container.getElements(n).map((e=>{e.innerHTML=t,e.title=t}))}},displayMaturity:function(e){this._addMaturityComponent(e)},_priorityDiv:function(e){var t=e.priority,n="",s=m.priorities[t.toLowerCase()];switch(null==s&&(s=t),e.priority){case f:n="low wux-ui-3ds wux-ui-3ds-level-low";break;case h:n="medium wux-ui-3ds wux-ui-3ds-level-medium";break;case v:n="high wux-ui-3ds wux-ui-3ds-level-high";break;case I:n="urgent wux-ui-3ds wux-ui-3ds-alert "}if(""==n)var i=UWA.createElement("div",{class:"issue-list-priority",html:s});else i=UWA.createElement("div",{class:"issue-list-priority",html:[UWA.createElement("span",{class:"issue-list-priority-icon "+n}),s]});return{div:i.outerHTML,nls:s}}})})),define("DS/IssueManagement/components/welcomePanel/view/WelcomePanelWrapper",["DS/Core/PointerEvents","DS/Utilities/TouchUtils","DS/ENOXWelcomePanel/js/ENOXWelcomePanel","DS/IssueManagement/components/welcomePanel/router/Router","DS/IssueManagement/components/welcomePanel/view/GlobalConfig","i18n!DS/IssueManagement/assets/nls/IssueManagement"],(function(e,t,n,s,i,o){"use strict";var a=function(){};return a.prototype.init=function(e,t,s){this._applicationChannel=e;var i=[];i.push({id:"IssueManagement",text:o.welcomePanelIssueManagement,fonticon:"issue-type",className:"action-new",isNotHighlightable:!0,tooltip:o.welcomePanelIssueManagement,category:"View"}),i.push({id:"IssueTemplate",text:o.welcomePanelIssueTemplate,fonticon:"template",className:"action-new",isNotHighlightable:!0,tooltip:o.welcomePanelIssueTemplate,category:"View"});var a=[{id:"quick_access",actions:i}],r=(o.whatsNew,{appDescription:{title:o.issueManagementAppHeader,description:o.issueManagementAppIntro},collapsed:!1,notifications:[],activities:a,parentContainer:s,modelEvents:e});new n(r).render(),this._subscribeToEvents()},a.prototype._subscribeToEvents=function(){var n=this;this._applicationChannel.subscribe({event:"welcome-panel-action-selected"},(function(n){if(n&&"home"===n.id?s.navigate(i.ROUTE_LANDING_PAGE):n&&n.id==i.PATH_IM_DETAILS?s.navigate(i.ROUTE_IM_DETAILS,{data:"from welcomepanel"}):n&&n.id==i.PATH_IT_DETAILS?s.navigate(i.ROUTE_IT_DETAILS,{data:"from welcomepanel"}):n&&n.id==i.PATH_WHATS_NEW_DETAILS&&s.navigate(i.PATH_WHATS_NEW_DETAILS,{data:"from welcomepanel"}),t.getTouchMode()){var o=new MouseEvent(e.POINTERDOWN,{bubbles:!1});document.dispatchEvent(o)}})),this._applicationChannel.subscribe({event:"welcome-panel-select-action"},(function(e){e&&e.id===i.PATH_IM_DETAILS?(n._applicationChannel.publish({event:"topbar-show-title",data:{id:i.ROUTE_IM_DETAILS,label:o.welcomePanelIssueManagement}}),widget.setValue("IsIssueSummaryView",!0),n._applicationChannel.publish({event:"updateToolbar",data:{side:"right"}})):e&&e.id===i.PATH_IT_DETAILS&&(n._applicationChannel.publish({event:"topbar-show-title",data:{id:i.ROUTE_IT_DETAILS,label:o.welcomePanelIssueTemplate}}),widget.setValue("IsIssueSummaryView",!1),n._applicationChannel.publish({event:"updateToolbar",data:{side:"right"}}))}))},a})),define("DS/IssueManagement/components/information/Header",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Iconbar","DS/UIKIT/Tooltip","DS/Logger/Logger","DS/Menu/Menu","DS/SocialToolbar/SocialToolbar","DS/IssueAttachmentManager/services/AttachmentServices","DS/IssueCommon/commands/CommandsManager","DS/IssueCommon/utils/Utils","DS/IssueComponents/lifecycle/Lifecycle","DS/IssueManagement/components/ContextualMenu","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement"],(function(e,t,n,s,i,o,a,r,l,c,d,u,p,m,g,f,h,v){"use strict";return t.extend({})})),define("DS/IssueManagement/views/kanban/Column",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Mask","DS/UIKIT/Tooltip","DS/IssueManagement/views/kanban/TileList","DS/Core/PointerEvents","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/TreeModel/TreeDocument","DS/WebappsUtils/WebappsUtils","DS/IssueComponents/users/Users","DS/IssueManagement/commands/CommandsManager","DS/IssueManagement/utils/DragAndDrop","DS/IssueManagement/components/ContextualMenu","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","DS/IssueCommon/utils/Utils","DS/IssueComponents/close/Close","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueCommon/assets/nls/IssueCommon"],(function(e,t,n,s,i,o,a,r,l,c,d,u,p,m,g,f,h,v,I,b,y,w,S){"use strict";var C={STATE:"state",PRIORITY:"priority",DUE_DATE:"resolutionDate"},D="Closed",T={Create:0,Assign:1,Active:2,Review:3,Closed:4},E="Low",A="Medium",_="High",M="Urgent",N="Overdue",x="None",O="Today",P="Tomorrow",V="Week",k="Future",L=0,R=500,U=1,F=18,B=function(e){return n.createElement("div",{class:"column-header",html:[n.createElement("div",{class:"column-header-label",html:e.title}),n.createElement("div",{class:"column-header-count",html:"("+e.count+")"})]})},j=function(){return n.createElement("div",{class:"column-content",html:""})},W=function(){return n.createElement("div",{class:"column-overlay",html:[{tag:"div",class:"column-overlay-label",html:w.kanban.dnd.placeholder},{tag:"span",class:"column-overlay-icon fonticon fonticon-drag-drop"}]})};return t.extend({name:"DS/IssueManagement/views/kanban/Column",tagName:"div",className:"kanban-container-column",_logger:null,defaultOptions:{title:{},defaultImage:d.getWebappsAssetUrl("IssueManagement","icons/iconIssueThumbnail.png")},kanban:null,document:null,models:[],grid:null,attributeKeyValue:{key:null,value:null},_dnd:{dragged:!1},_cellsAwaitingPostRendering:[],setup:function(e){var t=this;I.start(t.name+" setup"),t._parent(e),t._logger=r.getLogger("DS/IssueManagement/View"),t.kanban=e.kanban,t.document=new c,t.document._id=t.id,t.document._currentKanbanView=e.attributeKeyValue.key,t.models=[];for(var n=0;n<e.models.length;n++){var s=Object.keys(e.models[n]).reduce((function(t,s){return"children"!==s&&(t[s]=e.models[n][s]),t}),{});s.contextualMenu=[{}],t.models.push(s)}var i=t.getEventOptions();i.allowUnsafeHTMLContent=!1,i.selectionBehavior={},i.selectionBehavior.toggle=!0,i.selectionBehavior.unselectAllOnEmptyArea=!0,i.selectionBehavior.selectNodeModelOnCellSelection=!0,i.selectionBehavior.canMultiSelect=!0,i.selectionBehavior.canInteractiveMultiselectWithCheckboxClick=!0,i.selectionBehavior.enableShiftSelection=!0,i.selectionBehavior.enableFeedbackForActiveCell=!0,t.grid=new o(i),t.setEventOptions(t.grid),t.attributeKeyValue={key:e.attributeKeyValue.key,value:e.attributeKeyValue.value},t._dnd={dragged:!1},t._cellsAwaitingPostRendering=[],t._subscribers(),I.end(t.name+" setup")},render:function(){var e=this;I.start(e.name+" render");var t=B({title:e.getOption("title"),count:e.models.length}),s=j();if(t.inject(e.container),s.inject(e.container),t.addEventListener("drop",(function(t){e._onDrop(t)}),!1),t.addEventListener("dragover",(function(e){e.preventDefault()}),!1),e.attributeKeyValue.key===C.STATE&&e.attributeKeyValue.value===D){var o=f.get("widget");if(!0!==JSON.parse(o.getValue("filter")).closed){e.container.addClassName("not-filtered");var a=n.createElement("div",{class:"not-filtered-warning",html:{tag:"span",class:"fonticon fonticon-attention"}});new i({target:a,body:w.kanban.warning.closed}),a.inject(t)}}return e.grid.inject(s),W().inject(e.container),e.load(),I.end(e.name+" render"),e},load:function(){var e=this;I.start(e.name+" load");for(var t=0;t<e.models.length;t++)e._populate(e.models[t]);e.document.withTransactionUpdate((function(){for(var t=0;t<e.models.length;t++){var n=e.document.addRoot(e.models[t]);e.kanban._issuesNodesMapping[e.models[t].id].push(n),e.models[t].isSelected&&n.select()}e.document.getRoots().sort((function(e,t){return e.name<t.name?1:e.name>t.name?-1:0}))})),e.grid.model=e.document,I.end(e.name+" load")},destroy:function(){var e=this;e._logger=null,e.document=null,e.models=[],e.grid.destroy(),e.grid=null,e.attributeKeyValue={key:null,value:null},e._dnd={dragged:!1},e._cellsAwaitingPostRendering=[]},getTreeDocument:function(){return this.document},getSelectedNodes:function(){return this.document.getSelectedNodes()},unselectAll:function(){this.document.unselectAll()},getEventOptions:function(){var e=this;return{useDragAndDrop:!0,onDragStartCell:function(t,n){t.stopPropagation(),widget.setValue("isDragInternal",!0),e._dnd.internal=!0;var s=e.kanban.getSelectedNodes();0===s.length&&(s=[]).push(n.nodeModel);var i={isKanbanView:!0,columnKeyValue:{key:e.attributeKeyValue.key,value:e.attributeKeyValue.value},models:s.map((function(e){return e.options}))},o=m.setDroppableData(s,i);t.dataTransfer.setData(o.type,o.data),t.dataTransfer.effectAllowed="move",e._dnd.dragged=!0;var a=e.container.getElements(".wux-ui-state-highlighted");if(null!==a)for(var r=0;r<a.length;r++)a[r].getParent().addClassName("kanban-dragged-tile");return!1},onDropCell:function(t,n){e.utils.clean(e.kanban.container,{dragged:!0,hovered:!0,placeholder:!0}),widget.setValue("isDragInternal",!1),e._dnd.internal=!1,m.events.onDropCell.call(e.kanban,t,n)},onDropBlank:e._onDrop.bind(e),onDragEnterBlank:function(t){if(t.preventDefault(),e.utils.clean(e.kanban.container,{hovered:!0,placeholder:!0}),widget.getValue("isDragInternal"))!0===e._dnd.dragged||e.container.addClassName("drop-authorized");else{console.log("inside drag enter blank - kanban");var n=document.getElementsByClassName("isu-dragAndDropView")[0];n&&n.show(),document.getElementById("dndDismissButton").show()}},onDragLeaveBlank:function(t){if(t.preventDefault(),!widget.getValue("isDragInternal"))document.getElementsByClassName("isu-dragAndDropView")[0];e.container.removeClassName("drop-authorized")},onDragOverCell:function(t,n){return t.preventDefault(),e.utils.clean(e.kanban.container,{hovered:!0,placeholder:!0}),n.cellView.elements.container.addClassName("kanban-hovered-tile"),!0}}},setEventOptions:function(t){var s=this;t.onCellDoubleClick((function(){p.getCommand("ToggleInformationPanel")&&(widget.setValue("fromDataGridDoubleClick",!0),p.getCommand("ToggleInformationPanel").begin({save:!0}))})),t.onContextualEvent={callback:function(t){return!(!t||!t.cellInfos)&&new e((function(e){var n=t.cellInfos;!1===n.nodeModel.isSelected()?(s.listenTo(s.kanban,"onSelectAcked",(function(){s.stopListening(s.kanban,"onSelectAcked"),g.getContextualMenu(n.nodeModel).then((function(t){e(t)}))})),n.nodeModel.select(!0),s.kanban.document.prepareBroadcastSelect(),s.kanban.document.pushBroadcastSelect()):g.getContextualMenu(n.nodeModel).then((function(t){e(t)}))}))}},t.onDragEndCell=function(){s.utils.clean(s.kanban.container,{dragged:!0,placeholder:!0}),widget.setValue("isDragInternal",!1),s._dnd.internal=!1,s._dnd.dragged=!1},t.onStatusbarIconPointerDown=function(e){var t=e.cellInfos,n=e.clickedIconIndex,i=t?t.cellView:void 0,o=i?i.contentView:void 0,a=t?t.cellModel:void 0;if(o&&a&&n>=0&&n<o.statusbarIcons.length){for(var r=[],l=[],c=0;c<o.statusbarIcons.length;c++)r.push(o.statusbarIcons[c]),l.push(o.statusbarIconsTooltips[c]);if(s.document.unselectAll(),a.select(),"attach"===r[n])p.getCommand("AttachmentManager").begin()}};var i=s.kanban.utils.debounce(function(){var t=this;new e((function(e,s){if(t._cellsAwaitingPostRendering.length>0){var i=t._cellsAwaitingPostRendering.map((function(e){return{physicalId:e.nodeModel.options.physicalId}})).filter((function(e,t,n){return n.indexOf(e)===t}));h.images.retrieve({data:{objects:i},onComplete:function(s){for(var i=0;i<s.results.length;i++){var o=s.results[i].body;if(n.is(o,"object")&&n.is(o.url,"string")&&""!==o.url)t._cellsAwaitingPostRendering[i].nodeModel.updateOptions({thumbnail:o.url})}e()},onFailure:function(e){t._logger.error("Cannot retrieve the images: %s",e),s(new Error(e))}})}else e()})).finally((function(){t._cellsAwaitingPostRendering=[]}))}.bind(s),R);t.onPostCellRequest((function(e){var t=e.cellView.elements.container;if(t&&"hidden"!==t.getStyle("visibility")){var o=e.nodeModel;e.cellView.contentView.setProperties({description:o.options.description||"",subtitle:n.createElement("div",{class:"sub-label-container",html:[s.utils.getHTMLPriority(o.options.priority),o.options.name,{tag:"span",class:"fonticon fonticon-user"},s.utils.getHTMLOwner(o.options.owner),{tag:"span",class:"fonticon fonticon-users"},s.utils.getHTMLAssignees(o.options.assignees)]})}),s._cellsAwaitingPostRendering.push(e),i()}}))},draggedFromColumn:function(e){let t=!1;for(let n of e)if(n._dnd.dragged){t=!0;break}return t},_populate:function(e){e.thumbnail=this.getOption("defaultImage"),e.statusbarIcons=["attach"],e.statusbarIconsTooltips=[w.commands.attachments]},_subscribers:function(){var e=this,t=e.kanban.utils.debounce(function(t){e.dispatchEvent("onSelect",{column:e,node:t,event:"select"})}.bind(e),U);e.document.getModelEvents().subscribe({event:"select"},t);var n=e.kanban.utils.debounce(function(t){e.dispatchEvent("onSelect",{column:e,node:t,event:"unselect"})}.bind(e),U);e.document.getModelEvents().subscribe({event:"unselect"},n),e.grid.addEventListener(a.POINTERDOWN,(function(t,n){var s=e.grid;if(!(!0!==s.selectionBehavior.unselectAllOnEmptyArea||n&&n.cellView)){var i=s.getViewportDimensions(),o=s.layout.getContentDimensions(),a=0;t.target===s.elements.scroller.getContent()&&("vertical"===s.layout.direction?a=i.height<o.height?F:0:"horizontal"===s.layout.direction&&(a=i.width<o.width?F:0));var r=Math.max(o.width,i.width-a),l=Math.max(o.height,i.height-a);t.offsetX<r&&t.offsetY<l&&e.dispatchEvent("onUnselectAll",{column:e})}}),!1)},_onDrop:function(t){var n=this;t.preventDefault(),t.stopPropagation();var i=null;n.utils.clean(n.kanban.container,{dragged:!0,hovered:!0,placeholder:!0});try{i=m.getDroppableData(t)}catch(e){return l.displayNotification({msg:w.dnd.notSupported,eventID:"info"}),!1}if(i&&i.data)if(i.widgetId===f.get("widget").id&&i.data.options&&i.data.options.isKanbanView){var o=i.data.items,a=i.data.options.models;if(n.attributeKeyValue.key===i.data.options.columnKeyValue.key&&n.attributeKeyValue.value===i.data.options.columnKeyValue.value)return!0;s.mask(n.kanban.container),("state"===n.attributeKeyValue.key?n._onDropUpdateState(a,i.data.options.columnKeyValue.value):n._onDropUpdateIssues(a)).then((function(t){if(!1!==t){for(var s={paths:[],attributes:{}},i=0;i<o.length;i++)s.paths.push([o[i].objectId]),s.attributes[o[i].objectId]={id:o[i].objectId,name:o[i].displayName,title:o[i].displayName,type:o[i].objectType,modifiedAttributes:["state"]};return f.get("component").publishUpdate(s),widget.getValue("isDragInternal")&&(n._dnd.internal=!1,widget.setValue("isDragInternal",!1)),n.kanban.document.refreshNodesById({modified:o.map((function(e){return e.objectId})),timestamp:Math.floor(Date.now())})}return e.resolve()})).catch((function(e){n._logger.error(e)})).finally((function(){s.unmask(n.kanban.container)}))}else l.displayNotification({msg:w.dnd.notSupported,eventID:"info"});return!0},_onDropUpdateState:function(t,s){var i=this;if(!t.every((function(e){return e.state===t[L].state})))return l.displayNotification({msg:w.kanban.dnd.notAllSameStatePromote,eventID:"error"}),e.reject(new Error("Not supported dnd, all issues must be in the same state"));var o=function(e){var t="";if(e&&e.error&&n.is(e.error.message,"string")&&(t=e.error.message),t.includes("Action Taken and Resolution Statement are not filled in")){var s=b.getErrorMessage("5");b.displayErrorMessage(s,"error")}else if(t.includes("Action Taken field is not filled in")){s=b.getErrorMessage("6");b.displayErrorMessage(s,"error")}else if(t.includes("Resolution Statement field is not filled in")){s=b.getErrorMessage("7");b.displayErrorMessage(s,"error")}else if(t.includes("Resolution Date is not filled in")){s=b.getErrorMessage("8");b.displayErrorMessage(s,"error")}else if(t.includes("User does not have necessary privileges or selected object is not in correct maturity state for this operation")){s=b.getErrorMessage("1005");b.displayErrorMessage(s,"error")}else{s=w.notifications.serverError;e&&e.error&&n.is(e.error.message,"string")&&(s=e.error.message),l.displayNotification({msg:s,eventID:"error"})}i._logger.error(e)},a=-1;switch(a=i.attributeKeyValue.value===D?0:T[i.attributeKeyValue.value]-T[s]){case 0:var r=[];return t.forEach((e=>{r.push(e.physicalId)})),new e((function(e){return e(),new y({physicalIds:r}).render()}));case 1:var c=t.map((function(e){return{physicalId:e.physicalId,state:i.attributeKeyValue.value}}));return h.issues.promote({data:{objects:c}}).catch((function(e){o(e)}));case-1:var d=t.map((function(e){return{physicalId:e.physicalId,state:i.attributeKeyValue.value}}));return h.issues.demote({data:{objects:d}}).catch((function(e){o(e)}));default:return l.displayNotification({msg:w.replace(a>0?w.kanban.dnd.unsupportedPromote:w.kanban.dnd.unsupportedDemote,{currState:S.maturity[s.toLowerCase()],state:S.maturity[i.attributeKeyValue.value.toLowerCase()]}),eventID:"error"}),e.reject(new Error("Unexpected dropped data, cannot update state of issue(s)"))}},_onDropUpdateIssues:function(t){var s=this,i=t.filter((function(e){return e.state!==D}));if(i.length!==t.length&&l.displayNotification({msg:w.kanban.dnd.cannotEditClosedIssues,eventID:"warning"}),i.length>0){var o="";if(s.attributeKeyValue.key===C.DUE_DATE)if(s.attributeKeyValue.value===x)o="";else{var a=new Date;a.setHours(0,0,0,0);var r=new Date(a);r.setDate(r.getDate()-r.getDay()+8);var c=new Date(a);switch(s.attributeKeyValue.value){case N:c.setDate(a.getDate()-1);break;case O:break;case P:c.setDate(a.getDate()+1);break;case V:c.setDate(a.getDate()+2),c-r>=0&&(c.setDate(a.getDate()+1),c-r>=0&&c.setDate(a.getDate()-a.getDay()));break;case k:c.setDate(a.getDate()+30)}o=c.getMonth()+1+"/"+c.getDate()+"/"+c.getFullYear()}else o=s.attributeKeyValue.value;var d=i.map((function(e){var t={physicalId:e.physicalId};return t[s.attributeKeyValue.key]=o,t}));return h.issues.update({data:{objects:d}}).catch((function(e){e&&n.is(e.error,"object")&&n.is(e.error.message,"string")?l.displayNotification({msg:e.error.message,eventID:"error"}):l.displayNotification({msg:w.notifications.serverError,eventID:"error"}),s._logger(e)}))}return e.resolve(!1)},utils:{whereToAddModal:null,getHTMLPriority:function(e){var t="";switch(e){case E:t="low wux-ui-3ds wux-ui-3ds-level-low";break;case A:t="medium wux-ui-3ds wux-ui-3ds-level-medium";break;case _:t="high wux-ui-3ds wux-ui-3ds-level-high";break;case M:t="urgent wux-ui-3ds wux-ui-3ds-alert "}return n.createElement("div",{class:"issue-list-priority",html:[n.createElement("span",{class:"issue-list-priority-icon "+t,title:S.priorities[e.toLowerCase()]})]})},getHTMLOwner:function(e){return u.create({users:[e]})},getHTMLAssignees:function(e){var t=e;return u.create({users:t})},clean:function(e,t){if(!0===t.dragged)for(var n=e.getElements(".kanban-dragged-tile"),s=0;s<n.length;s++)n[s].getParent().removeClassName("kanban-dragged-tile");if(!0===t.hovered)for(var i=e.getElements(".kanban-hovered-tile"),o=0;o<i.length;o++)i[o].removeClassName("kanban-hovered-tile");if(!0===t.placeholder){var a=e.getElement(".drop-authorized");null!==a&&a.removeClassName("drop-authorized")}}}})})),define("DS/IssueManagement/views/kanban/Kanban",["UWA/Class/View","UWA/Core","DS/UIKIT/Tooltip","DS/Logger/Logger","DS/IssueManagement/views/kanban/Column","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueCommon/assets/nls/IssueCommon"],(function(e,t,n,s,i,o,a,r,l){"use strict";var c=260,d={STATE:"state",PRIORITY:"priority",DUE_DATE:"resolutionDate",ALL:"all"},u="Create",p="Assign",m="Active",g="Review",f="Closed",h="Low",v="Medium",I="High",b="Urgent",y="Overdue",w="None",S="Today",C="Tomorrow",D="Week",T="Future",E="All",A={RIGHT:"right",BOTTOM:"bottom",CLOSED:"closed"},_=1,M=0,N=e.extend({name:"DS/IssueManagement/views/kanban/Kanban",tagName:"div",className:"kanban-container",_logger:null,component:null,document:null,settings:{},columns:{state:[],priority:[],resolutionDate:[],all:[]},chizu:{container:null,tooltips:[],position:0},currentView:null,columnsListeners:[],siblings:{right:null,left:null},verticalLevelSelector:-1,_issuesNodesMapping:{},preventUnselectColumns:!1,_ctrlKey:!1,_subscribed:!1,setup:function(e){var t=this;a.start(t.name+" setup"),t._parent(e),t._logger=s.getLogger("DS/IssueManagement/View"),t.component=e.component,t.document=null,t.settings=e.settings,t.columns={state:[],priority:[],resolutionDate:[],all:[]},t.chizu={container:null,tooltips:[],position:0},t.currentView=null,t.columnsListeners=[],t.siblings={right:null,left:null},t.verticalLevelSelector=-1,t._issuesNodesMapping={},t.preventUnselectColumns=!1,t._ctrlKey=!1,t._subscribed=!1,a.end(t.name+" setup")},render:function(){var e=this;a.start(e.name+" render"),e.columns.state.forEach((function(t){t.render().inject(e.container)})),e.columns.priority.forEach((function(t){t.render().inject(e.container)})),e.columns.resolutionDate.forEach((function(t){t.render().inject(e.container)})),e.columns.all.forEach((function(t){t.render().inject(e.container)}));var s=o.get("widget").getValue("kanbanViewBy")||"state";return e.switchView(s),e.arrow=t.createElement("div",{class:"arrow-fonticon"}).inject(e.container),e.arrow.left=t.createElement("span",{class:"fonticon fonticon-2x fonticon-left-open"}).inject(e.arrow),e.arrow.leftTooltip=new n({position:"bottom",target:e.arrow.left,body:r.kanban.tooltips.leftArrow}),e.arrow.right=t.createElement("span",{class:"fonticon fonticon-2x fonticon-right-open"}).inject(e.arrow),e.arrow.rightTooltip=new n({position:"bottom",target:e.arrow.right,body:r.kanban.tooltips.rightArrow}),a.end(e.name+" render"),e},load:function(e){var t=this;a.start(t.name+" load"),null!=e&&(t.document=e);var n=t.document.getRoots(!1),s={};s[u]=[],s[p]=[],s[m]=[],s[g]=[],s[f]=[];var c={};c[h]=[],c[v]=[],c[I]=[],c[b]=[];var A={};A[y]=[],A[w]=[],A[S]=[],A[C]=[],A[D]=[],A[T]=[];var _={};_[E]=[];var M=new Date;M.setHours(0,0,0,0);var N=new Date(M);N.setDate(N.getDate()-N.getDay()+8),t._issuesNodesMapping={};for(var x=0;x<n.length;x++){var O=n[x].options;if(t._issuesNodesMapping[n[x].options.id]=[],O.isSelected=n[x].isSelected(),s[O.state]&&c[O.priority]&&_[E])if(s[O.state].push(O),c[O.priority].push(O),_[E].push(O),void 0!==O.resolutionDate&&null!==O.resolutionDate&&""!==O.resolutionDate){var P=new Date(O.resolutionDate),V=P-M;if(isNaN(V))A[w].push(O);else{var k=V/1e3/60/60/24;if(k<0)A[y].push(O);else if(0<=k&&k<1)A[S].push(O);else if(1<=k&&k<2)A[C].push(O);else if(2<=k){P-N<0?A[D].push(O):A[T].push(O)}}}else A[w].push(O)}var L=o.get("maturityGraph");for(var R in s)if(s.hasOwnProperty(R)){var U=l.maturity[R.toLowerCase()];""!==L&&null!=L&&(U=L[R]);var F=new i({id:d.STATE+R.replace(/ /g,"+").toLowerCase(),kanban:t,title:U,models:s[R],attributeKeyValue:{key:d.STATE,value:R}});t.columns.state.push(F)}for(var B in c)if(c.hasOwnProperty(B)){var j=new i({id:d.PRIORITY+B.replace(/ /g,"+").toLowerCase(),kanban:t,title:l.priorities[B.toLowerCase()],models:c[B],attributeKeyValue:{key:d.PRIORITY,value:B}});t.columns.priority.push(j)}for(var W in A)if(A.hasOwnProperty(W)){var H=new i({id:d.DUE_DATE+W.replace(/ /g,"+").toLowerCase(),kanban:t,title:r.kanban.resolutionDate[W.toLowerCase()],models:A[W],attributeKeyValue:{key:d.DUE_DATE,value:W}});t.columns.resolutionDate.push(H)}for(var z in _)if(_.hasOwnProperty(z)){var G=new i({id:d.ALL,kanban:t,title:r.kanban.all,models:_[z],attributeKeyValue:{key:d.ALL,value:z}});t.columns.all.push(G)}return t._subscribers(),a.end(t.name+" load"),t},refresh:function(){var e=this;for(var t in a.start(e.name+" refresh"),e.preventUnselectColumns=!0,e.container.empty(),e.columns)e.columns.hasOwnProperty(t)&&(e.columns[t].forEach((function(e){e.destroy()})),e.columns[t]=[]);e.chizu.tooltips.forEach((function(e){e.destroy(),e=null})),e.chizu.container&&e.chizu.container.destroy(),e.chizu={container:null,tooltips:[],position:0},e.load(),e.render(),e.resize(),a.end(e.name+" refresh")},destroy:function(){var e=this;e._stopListeningToColumns(),e._logger=null,e.component=null,e.document=null,e.settings={},e.columns={state:[],priority:[],resolutionDate:[],all:[]},e.chizu.tooltips.forEach((function(e){e.destroy(),e=null})),e.chizu.container.destroy(),e.chizu={container:null,tooltips:[],position:0},e.currentView=null,e.columnsListeners=[],e.siblings={right:null,left:null},e.verticalLevelSelector=-1,e._issuesNodesMapping={},e.preventUnselectColumns=!1,e._ctrlKey=!1,e._subscribed=!1},resize:function(){var e=this;if(e.container&&e.container.getParent()){var t=o.get("application"),n=t.elements.body,s=t.information.container,i=n.offsetWidth,a=n.offsetHeight,r=o.get("information");r.isOpened()&&(r.getLayout().current,A.RIGHT),r.isOpened()&&r.getLayout().current===A.BOTTOM&&(a-=s.offsetHeight);var l=i,d=e.container.getElements(".kanban-container-column.visible");if(0!==d.length){var u=d[M].offsetWidth,p=l/(u=(u=u>c?c:u)<c?c:u);0==(p=Math.floor(p))&&(p=1);var m=e.chizu.position,g=m;p<d.length&&(p===d.length-m||p>d.length-m&&(g=m-(p-(d.length-m))));var f=g,h=g+p;d.forEach((function(e,t){e.setStyle("max-height",a),f<=t&&t<h?(e.show(),e.setStyle("width",u)):e.hide()})),e._setChizu(d,p,g)}}},switchView:function(e){var t=this;for(var n in this.chizu.position=0,t.columns)t.columns.hasOwnProperty(n)&&(n!==e?t.columns[n].forEach((function(e){e.hide(),e.container.removeClassName("visible")})):(t.currentView=n,t._stopListeningToColumns(),t._listenToColumns(),t.columns[n].forEach((function(e,t){e.show(),0===t&&e.container.addClassName("visible first"),e.container.addClassName("visible")}))));t.resize()},getSelectedNodes:function(){for(var e=this,t=[],n=0;n<e.columns[e.currentView].length;n++)t=t.concat(e.columns[e.currentView][n].getSelectedNodes());return t},getSelectedIssues:function(){for(var e=this,t=[],n=0;n<e.columns[e.currentView].length;n++){var s=e.columns[e.currentView][n].getSelectedNodes().map((function(e){return e.options.id}));t=t.concat(s)}return t},_setChizu:function(e,s,i){var o=this;o.chizu.position=i;var a=[],l=[],c=0;e.forEach((function(e,d){var u="";d<i||c<s&&(u="displayed",c+=1);var p=t.createElement("div",{class:"chizu-placeholder-column "+u,events:{click:function(){var e=o.container.getElements(".kanban-container-column.visible"),t=0,n=e.length-d;n<s&&(d-=s-n);for(var i=0;i<e.length;i++)i<d?e[i].hide():t<s?(e[i].show(),e[i].setStyle("width",100/s+"%"),t+=1):e[i].hide();o._setChizu(e,s,d)}}});l.push(new n({position:"top",target:p,body:r.replace(r.kanban.tooltips.chizu,{title:o.columns[o.currentView][d].getOption("title")+" ("+o.columns[o.currentView][d].getTreeDocument().getRoots(!1).length+")"})})),a.push(p)})),null===o.chizu.container?(o.chizu.container=t.createElement("div",{class:"chizu",html:[{tag:"div",class:"chizu-placeholder-columns",html:a}]}),o.chizu.tooltips=l,o.chizu.container.inject(o.container)):(o.chizu.tooltips.forEach((function(e){e.destroy(),e=null})),o.chizu.tooltips=l,o.chizu.container.getElement(".chizu-placeholder-columns").setContent(a)),1===e.length?o.chizu.container&&!o.chizu.container.hasClassName("chizu-hidden")&&o.chizu.container.addClassName("chizu-hidden"):o.chizu.container&&o.chizu.container.hasClassName("chizu-hidden")&&o.chizu.container.removeClassName("chizu-hidden"),0===i?o.arrow.left&&!o.arrow.left.hasClassName("disable")&&o.arrow.left.addClassName("disable"):o.arrow.left&&o.arrow.left.hasClassName("disable")&&o.arrow.left.removeClassName("disable"),e.length<=c+i?o.arrow.right&&!o.arrow.right.hasClassName("disable")&&o.arrow.right.addClassName("disable"):o.arrow.right&&o.arrow.right.hasClassName("disable")&&o.arrow.right.removeClassName("disable"),o.clickLeftArrowEventListener&&o.arrow.left.removeEventListener("click",o.clickLeftArrowEventListener),o.clickLeftArrowEventListener=function(){e.forEach((function(e,t){t>=i-1&&t<=i+c-2?(e.show(),e.setStyle("width",100/c+"%")):e.hide()})),o._setChizu(e,s,i-1)},o.arrow.left.addEventListener("click",o.clickLeftArrowEventListener),o.clickRightArrowEventListener&&o.arrow.right.removeEventListener("click",o.clickRightArrowEventListener),o.clickRightArrowEventListener=function(){e.forEach((function(e,t){t>=i+1&&t<=i+c?(e.show(),e.setStyle("width",100/c+"%")):e.hide()})),o._setChizu(e,s,i+1)},o.arrow.right.addEventListener("click",o.clickRightArrowEventListener)},_listenToColumns:function(){var e=this,n=e.utils.debounce(function(n){if("select"===n.event){e.verticalLevelSelector=n.node.data.virtualRowID;for(var s=e.columns[n.column.attributeKeyValue.key],i=0;i<s.length;i++)n.column.id===s[i].id&&(e.siblings.right=t.is(s[i+1],"object")?s[i+1]:null,e.siblings.left=t.is(s[i-1],"object")?s[i-1]:null)}if(e.preventUnselectColumns)e.preventUnselectColumns=!1;else if(!e._ctrlKey&&"select"===n.event)for(var o=0;o<e.columns[e.currentView].length;o++)e.columns[e.currentView][o]!==n.column&&e.columns[e.currentView][o].unselectAll();e.dispatchEvent("onSelect")}.bind(e),_);e.columns[e.currentView].forEach((function(t){e.listenTo(t,"onSelect",n),e.columnsListeners.push({component:t,event:"onSelect"}),e.listenTo(t,"onUnselectAll",(function(){for(var t=0;t<e.columns[e.currentView].length;t++)e.columns[e.currentView][t].unselectAll()})),e.columnsListeners.push({component:t,event:"onUnselectAll"})}))},_stopListeningToColumns:function(){var e=this;e.columnsListeners.forEach((function(t){e.stopListening(t.component,t.event)})),e.columnsListeners=[]},_subscribers:function(){var e=this;if(!1===e._subscribed){var t=o.get("widget")||window.widget;t.body.addEventListener("keydown",(function(t){e.container.getParent().isHidden()||17===t.keyCode&&(e._ctrlKey=!0)})),t.body.addEventListener("keyup",(function(t){e.container.getParent().isHidden()||17===t.keyCode&&(e._ctrlKey=!1)})),e._subscribed=!0}},utils:{_debounceTimeouts:[],debounce:function(e,t,n){var s,i=this;return function(){var o=this,a=arguments,r=n&&!s;clearTimeout(s);var l=i._debounceTimeouts.indexOf(s);-1!==l&&i._debounceTimeouts.splice(l,1),s=setTimeout((function(){s=null,n||e.apply(o,a)}),t),i._debounceTimeouts.push(s),r&&e.apply(o,a)}}}});return N})),define("DS/IssueManagement/Component_V2",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/UIKIT/Tooltip","DS/ControlsEx/LoadingPanel","DS/Logger/Logger","DS/IssueComponents/open/Open","DS/IssueCommon/utils/TaskManager","DS/IssueCommon/utils/Utils","DS/IssueComponents/utils/Utils","DS/IssueManagement/commands/CommandsManager","DS/IssueManagement/models/TreeDocument_V2","DS/IssueManagement/utils/Tagger","DS/IssueCommon/utils/ModelParser","DS/IssueManagement/utils/Synchronizer","DS/IssueManagement/views/kanban/Kanban","DS/IssueManagement/views/list/TreeList","DS/IssueManagement/views/datagrid/DataGrid","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/LocalStorage","DS/IssueServices/utils/Performance","DS/IssueManagement/components/header/IssueDataGridToolbar","DS/IssueManagement/views/dragAndDrop/DragAndDropView","DS/PADUtils/views/PADAlert","text!DS/IssueManagement/assets/Settings.json","text!DS/IssueManagement/assets/IssueManagement.1D.json","text!DS/IssueManagement/assets/IssueManagement.dataGrid.json","text!DS/IssueCommon/assets/Settings.json","i18n!DS/IssueManagement/assets/nls/IssueManagement"],(function(e,t,n,s,i,o,a,r,l,c,d,u,p,m,g,f,h,v,I,b,y,w,S,C,D,T,E,A,_,M,N,x){"use strict";var O="ENXISSU_AP",P="Issue",V=0,k=0,L="ListView",R="KanbanView",U="IFB",F={ISU_TASK_MANAGER:"ISU_TASK_MANAGER"},B={FILTER:"FILTER",PREFERENCES:"PREFERENCES",GET_FILTERED_ISSUES:"GET_FILTERED_ISSUES"};return t.extend({name:"DS/IssueManagement/Component_V2",tag:"div",className:"im-main-component",_logger:null,defaultOptions:{document:{},kanban:JSON.parse(_),settings:JSON.parse(A)},containers:{list:null,kanban:null,dndContainer:null},document:null,list:null,kanban:null,synchronizer:null,taskManager:null,_subscriberTokens:[],_tasks:{subscriberTokens:[],current:null},_timestampUpdate:0,_subscriberId:"",totalIssues:0,loadedIssues:0,top:0,skip:0,allIssuesLoaded:!1,setup:function(e){var t=this;t.attributes=[],t._logger=r.getLogger("DS/IssueManagement/Component_V2"),t._parent(e),t.container.empty(),t.containers.list=n.createElement("div",{class:"issue-list-container"}),t.containers.kanban=n.createElement("div",{class:"issue-kanban-container"}),t.document=new m({component:t,settings:t.getOption("settings"),document:t.getOption("document")}),t.isAnyFilterSelected=!1,t.settings=JSON.parse(A);var s=JSON.parse(N);t.numberOfIssuesToLoad=s.issuesToLoad,t.top=t.numberOfIssuesToLoad;var o=JSON.parse(M);let a;t.setOption("list",o);var l={};if(widget.getValue("wux-collectionView-dataGridView")){if(widget.setValue("IssueManagementTableDefinition",void 0),a=widget.getValue("columnsNew"),null==a){var d=JSON.parse(widget.getValue("wux-collectionView-dataGridView"));d&&d.ISUSummaryView&&Object.keys(d.ISUSummaryView).length>1&&void 0===widget.getValue("customColumns")&&(t.isDGViewMigrated=!0),a=t.getOption("list").columns}}else if(widget.getValue("IssueManagementTableDefinition")){let e=JSON.parse(widget.getValue("IssueManagementTableDefinition")),n=[...t.getOption("list").columns];widget.getValue("customColumns")?(a=widget.getValue("columnsNew"),l=widget.getValue("visibleFlagCol")):(a=t.sortColumnToOldLevel(e,n),l=t.getVisibleColumn(e),widget.setValue("visibleFlagCol",l),widget.setValue("columnsNew",a)),t.isDGViewMigrated=Object.keys(l).length>0}else a=t.getOption("list").columns,widget.setValue("columnsNew",a);if(widget.getValue("customColumns")){var u=widget.getValue("customColumns")?widget.getValue("customColumns"):[];a=[...a,...u]}let p=[];for(let e of a)if(e.children)for(let t=0;t<e.children.length;t++)p.push(e.children[t]);else p.push(e);t.list=new b({component:t,container:t.containers.list,settings:t.getOption("settings"),treeDocument:t.document,document:t.document,columns:p,showNodeKPIColorFlag:!0,showContextualMenuColumnFlag:!0,showRowBorderFlag:!0,placeholder:x.emptyDataGridPlaceHolder,showAlternateBackgroundFlag:!0,useWidgetPreferencesFlag:!0,identifier:"ISUSummaryView",columnDefinitionUpdated:!1,rowGroupingEnabledFlag:!1,document:t.document,customColInfo:l}),t.kanban=new v({component:t,settings:t.getOption("settings"),kanban:t.getOption("kanban")}),t.synchronizer=new h({list:t.list,kanban:t.kanban}),t.list.onInfiniteScroll((function(e){!1!==e.reachBottom?t.allIssuesLoaded||(t.skip=t.skip+t.top,i.mask(widget.body),t.addIssues().then((function(){i.unmask(widget.body)}))):t.list.infiniteScrollProcessDone()})),t.document.addEventListener("taggerFilter",(function(e){widget.setValue("tags",e.data),t.refresh_New(!1)}),t),t._subscriberId=Math.random().toString(36).substr(2,9),t.taskManager=c,t._subscriberTokens=[],t._tasks={subscriberTokens:[],current:null},t._timestampUpdate=0,t.utils._setTypesCallbackSubscribe=!1,g.connect(t),t._subscribers(),t._subscribersTaskManager(),t.setPADContext()},render:function(){var e=this;const t={dismissButton:!0,dndElements:[{id:"open",icon:"open",nls:x.Open}],callback:e.onSummaryViewDrop.bind(e)};e.container.dropZone=new T(t).render(),e.container.dropZone.hide(),e.container.dropZone.inject(e.container),e.containers.list.inject(e.container),e.containers.list.removeClassName("hidden"),e.containers.kanban.inject(e.container)},build:function(){var t=this;C.start(t.name+" build");var n=y.get("widget")||window.widget,s=n.getValue("filter");s=JSON.parse(s);return y.get("LoadData_ModelerAPI")?t.load_v2().then((function(){return t.list.load(t.document)})).then((function(){return t.getCurrentView()===R?(t.containers.list.addClassName("hidden"),i.mask(n.body),t.loadAllIssues().then((function(){t.containers.kanban.removeClassName("hidden"),i.unmask(n.body)}))):(t.containers.list.removeClassName("hidden"),t.containers.kanban.addClassName("hidden"),e.resolve())})).then((function(){return t.kanban.load(t.document)})).then((function(){return t.startSynchronizer()})).then((function(){t.containers.list.setContent(t.list.getContent()),t.containers.kanban.setContent(t.kanban.render()),t.container.addEventListener("contextmenu",(function(e){e.preventDefault()}),t);var e=t.document.getRoots();0===e.length&&t.containers.list.hide(),t.dispatchEvent("onReady",{roots:e}),C.end(t.name+" build")})):t.load().then((function(){return t.list.load(t.document)})).then((function(){return t.kanban.load(t.document)})).then((function(){return t.synchronizer.start()})).then((function(){t.render(),C.end(t.name+" build")}))},startSynchronizer:function(){return this.synchronizer.start()},load_v2:function(){var t=this;t.allIssuesLoaded=!1,C.start(t.name+" load");var n=y.get("widget")||window.widget;t.expandedIds=n.getValue("expandedIds");var s=n.getValue("filter"),i=void 0===n.getValue("affectedItemSetting")||n.getValue("affectedItemSetting"),o=void 0===n.getValue("resolvedItemSetting")||n.getValue("resolvedItemSetting"),a=void 0===n.getValue("contextSetting")||n.getValue("contextSetting");return!0===t.utils.isJson(s)?((s=JSON.parse(s)).onlyids=!1,s.affectedItem=i,s.resolvedItem=o,s.context=a):s={},s.top=t.top,s.skip=t.skip,s.tags={},s.tags=n.getValue("tags")?n.getValue("tags").allfilters:{},s.tags=JSON.stringify(s.tags),s.paging=!0,w.issues.filter({version:"2.0",data:{filter:s}}).then((async function(s){var i=n.getValue("sessionRootCount");if(void 0!==s.success&&s.success&&s.body&&i&&s.body&&s.body.issues.length!=i){var o=d.getErrorMessage("0");d.displayErrorMessage(o,"error"),e.resolve([])}s.body.facets&&t.updateTotalCount(s.body.facets),await u.getNLSValues(s.body.issues),await u.getIssueMaturity({policies:["Issue"]});var a=f.parse(s.body.issues);0===a.length&&t.placeholder.show(t.container,t.isAnyFilterSelected),a.length<t.numberOfIssuesToLoad&&(t.allIssuesLoaded=!0),t.document.nonIndexData=!1,t.document.addRoots(a).then((async()=>{const e=t.document.getRoots();t.loadedIssues=e.length;var n=y.get("status"),i=x.replace(x.totalIssues,{number:t.totalIssues}),o=x.replace(x.loadedIssues,{number:t.loadedIssues});n.totalDiv.textContent=i,n.loadedDiv.textContent=o,t.loadedIssues<t.totalIssues&&n.loadedDiv.addClassName("active"),t.document.nonIndexData?n.totalWarning.show():n.totalWarning.hide(),t.list.infiniteScrollProcessDone(),t.document.registerNodeModelUpdateEvent(),u.updateIssueMaturityClass(),s.body.facets?(t.applyNLSValuesToFacets(s.body.facets),g.applyTags()):g.setTags(),t.loadInfo_fetchV2(e);try{t.isDGViewMigrated&&await u.updateClassificationsAndInterfaces(t.document,e)}catch(e){}finally{t._dispatchEventForRestoreCustomView(),D.toolbarActionBar.updateNodeModel("customizeDatagridView",{disabled:!1}),t.list.cellDragEnabledFlag=!0,t.list.reapplySortModel()}}))}))},addIssues:function(e,t,s){var o=this;C.start(o.name+" load");var a=y.get("widget")||window.widget,r=a.getValue("filter"),l=void 0===a.getValue("affectedItemSetting")||a.getValue("affectedItemSetting"),c=void 0===a.getValue("resolvedItemSetting")||a.getValue("resolvedItemSetting"),p=void 0===a.getValue("contextSetting")||a.getValue("contextSetting");!0===o.utils.isJson(r)?((r=JSON.parse(r)).onlyids=!1,r.affectedItem=l,r.resolvedItem=c,r.context=p):r={},r.top=e||o.top,r.skip=t||o.skip,r.tags=a.getValue("tags")?a.getValue("tags").allfilters:{},r.tags=JSON.stringify(r.tags),r.paging=!0,s&&(r.allIssues=!0);var m=w.issues.filter({version:"2.0",data:{filter:r}}).then((async function(e){if(void 0!==e.success&&!1===e.success){if(e.body&&e.body.error&&e.body.error.internal&&n.is(e.body.error.internal,"string")){var t=e.body.error.internal;if(t.includes("No business object")||t.includes("not exist")){var s=d.getErrorMessage("0");d.displayErrorMessage(s,"error")}}return[]}await u.getNLSValues(e.body.issues),await u.getIssueMaturity({policies:["Issue"]});var r=f.parse(e.body.issues);if((r.length<o.numberOfIssuesToLoad||r.length==o.totalIssues)&&(o.allIssuesLoaded=!0),r.length>0)return o.document.addRoots(r).then((async e=>{o.list.infiniteScrollProcessDone(),o.loadedIssues=o.document.getRoots().length;var t=y.get("status"),n=x.replace(x.totalIssues,{number:o.totalIssues}),s=x.replace(x.loadedIssues,{number:o.loadedIssues});t.totalDiv.textContent=n,t.loadedDiv.textContent=s,o.loadedIssues<o.totalIssues?t.loadedDiv.addClassName("active"):t.loadedDiv.removeClassName("active"),a.getValue("coloration")&&g.onColorize(a.getValue("coloration")),o.loadInfo_fetchV2(e),u.updateIssueMaturityClass(),o.isDGViewMigrated&&await u.updateClassificationsAndInterfaces(o.document,e),await o._dispatchEventForRestoreCustomView()})).then((function(){if(Array.isArray(o.expandedIds)){for(var e=[],t=[],n=0;n<o.expandedIds.length;n++){var s=o.document.getNodesById(o.expandedIds[n]);s.length>0&&Array.isArray(s)&&(e.push(s[0]),t.push(o.expandedIds[n]))}e.forEach((function(e){e.options.data.isExpandMultiple=!0,e.expand()})),e.length>0&&o.document.updateNodesOnExpand(e),o.expandedIds=o.expandedIds.filter((e=>!t.includes(e)))}o.list.reapplySortModel(),o.list.document.reapplyFilterModel(),o.publishFilteredIssues()}));i.unmask(a.body)}));return m.catch((function(e){i.unmask(a.body)})),m},loadAllIssues:function(t){var n=this;return n.loadedIssues!==n.totalIssues||t?n.addIssues(null,null,!0):e.resolve()},loadInfo_fetchV2:function(t){var s=this;return 0==t.length?e.resolve():new e((function(e,i){s.getTreeDocument().retrieveContentAndFetch(t).then((o=>{Array.isArray(o.body.results)?s.getTreeDocument().withTransactionUpdate((function(){let s={};o.body.results.forEach((e=>{let t={};var i="";e.attributes.forEach((e=>{switch(n.is(e.name,"string")?e.name.replace("ds6w:what/","").replace("ds6w:when/","").replace("ds6w:who/","").replace("ds6w:where/ds6w:source/","").replace("ds6w:where/",""):e.name){case"resourceid":t.pid=e.value,""==i&&(i=e.value);break;case"ds6w:label":t.title=e.value;break;case"ds6w:type":t.type=e.value,t.objectType=e.value;break;case"ds6w:identifier":t.name=e.value;break;case"ds6wg:revision":t.revision=e.value;break;case"ds6w:kind":t.kind=e.value;break;case"ds6w:dataSource":t.serviceId=Array.isArray(e.value)?e.value[0].replace("ds6w:dataSource.",""):e.value;break;case"ds6w:i3dx":""!=e.value&&(i=e.value)}})),s[i]=t,""!==t.pid&&(s[t.pid]=t)}));for(var i=0;i<t.length;i++){var a=t[i],r={};let e=a.options.contexts;r.contexts=[],e.forEach((e=>{if(s[e.physicalId]){let t={};t={...e,...s[e.physicalId]},r.contexts.push(t)}}));let n=a.options.reportedAgainst;r.reportedAgainst=[],n.forEach((e=>{if(s[e.physicalId]){let t={};t={...e,...s[e.physicalId]},r.reportedAgainst.push(t)}}));let o=a.options.resolvedBy;r.resolvedBy=[],o.forEach((e=>{if(s[e.physicalId]){let t={};t={...e,...s[e.physicalId]},r.resolvedBy.push(t)}}));let l=a.options.resolvedItems;r.resolvedItems=[],l.forEach((e=>{if(s[e.physicalId]){let t={};t={...e,...s[e.physicalId]},r.resolvedItems.push(t)}})),a.updateOptions({reportedAgainst:r.reportedAgainst,resolvedItems:r.resolvedItems,resolvedBy:r.resolvedBy,contexts:r.contexts})}e()})):i(new Error("Unexpected response when retrieving issues."))}))}))},onPostInitialize:function(){var e=this,t=y.get("widget")||window.widget,n=t.getValue("expandedIds");if(!0===Array.isArray(n)){for(var s=[],i=0;i<n.length;i++){var o=e.getNodesById(n[i]);o.length>0&&Array.isArray(o)&&s.push(o[0])}for(var a=0;a<s.length;a++)s[a].options.data.isExpandMultiple=!0,s[a].expand();s.length>0&&e.getTreeDocument().updateNodesOnExpand(s)}var r=y.get("information");r&&r.isOpened()&&r.fullScreenMode&&((s=e.document.getRoots(!1)).length>0&&(e.document.prepareBroadcastSelect(),e.document.withTransactionUpdate((function(){e.document.unselectAll(),s[0].select(),e.document.pushBroadcastSelect()}))));t.getValue("contextFilter")&&y.get("filter").showContextFilter();try{require(["DS/WebappsUtils/WebappsUtils","DS/IssueComponents/konami/Konami"],(function(e,t){t.kojima()}))}catch(e){}},destroy:function(){var e=this;e._subscriberTokens.forEach((function(e){y.get("eventsHandler").unsubscribe(e)})),e._tasks.subscriberTokens.forEach((function(e){y.get("eventsHandler").unsubscribe(e)})),e.document.removeEventListener("onRootsAdded"),e.document.removeEventListener("onRootsRemoved"),e.document.empty(),e.document=null,e.list.destroy(),e.list=null,e.kanban.destroy(),e.kanban=null,e.containers={list:null,kanban:null},e._timestampUpdate=0,e._subscriberTokens=[],e.utils._setTypesCallbackSubscribe=!1,e._tasks={subscriberTokens:[],current:null},e.taskManager.destroy(),e.taskManager=null,e._subscriberId=""},refresh_New:function(e){var t=this;t.allIssuesLoaded=!1;var n=y.get("widget")||window.widget;if(t.expandedIds=n.getValue("expandedIds"),D.toolbarActionBar.updateNodeModel("customizeDatagridView",{disabled:!0}),t.list.cellDragEnabledFlag=!1,i.mask(n.body),y.get("filter").refresh(),t.getCurrentView()===R)return i.mask(n.body),t.loadAllIssues(!0).then((function(){t.synchronizer._refreshKanban(),i.unmask(n.body),t.startSynchronizer()}));t.top=t.numberOfIssuesToLoad,t.skip=0,t.document.nonIndexData=!1,t.document.refresh_v2(e,t.top,t.skip,t.numberOfIssuesToLoad).then((async function(e){e.length<t.numberOfIssuesToLoad&&(t.allIssuesLoaded=!0),t.list.infiniteScrollProcessDone(),i.unmask(n.body);const s=t.document.getRoots();0===t.document.getRoots().length?(t.placeholder.show(t.container,t.isAnyFilterSelected),t.dispatchEvent("onRootsRemoved",{})):t.placeholder.hide(t.container),t.loadedIssues=s.length;var o=y.get("status"),a=x.replace(x.totalIssues,{number:t.totalIssues}),r=x.replace(x.loadedIssues,{number:t.loadedIssues});o.totalDiv.textContent=a,o.loadedDiv.textContent=r,t.loadedIssues<t.totalIssues?o.loadedDiv.addClassName("active"):o.loadedDiv.removeClassName("active"),t.document.nonIndexData?o.totalWarning.show():o.totalWarning.hide(),t.list.reapplySortModel(),t.list.document.reapplyFilterModel(),u.updateIssueMaturityClass(),t.loadInfo_fetchV2(s),t.list.preferences.loadSortPreference(),t.isDGViewMigrated&&await u.updateClassificationsAndInterfaces(t.document,s),t._dispatchEventForRestoreCustomView(),t.dispatchEvent("onRefreshComplete"),D.toolbarActionBar.updateNodeModel("customizeDatagridView",{disabled:!1}),t.list.cellDragEnabledFlag=!0,t.publishFilteredIssues()}))},resize:function(){null!==this.kanban&&this.kanban.resize()},switchView:function(e){var t=this;if(S.setItem("view",{name:e}),e===R){t.containers.list.addClassName("hidden"),p.disable(["Selection","Find"]);var n=new a({shape:"linear",showButtonsFlag:"closeButtonOnly",modalFlag:!0,width:"15%",info:x.loadingIssues}).inject(widget.body);n.on(),t.containers.kanban.removeClassName("hidden");var s=t.loadAllIssues();return n.addEventListener("stop",(function(){s.cancel(),n.off()})),s.then((function(){n.off(),t.synchronizer._refreshKanban(),t.startSynchronizer()}))}t.containers.list.removeClassName("hidden"),t.containers.kanban.addClassName("hidden"),0===t.getTreeDocument().getRoots(!1).length?p.idling():p.enable(["Selection"])},publishSelect:function(e){var t=y.get("widget")||window.widget;y.get("eventsHandler").publish(this._subscriberId,"DS/Object/select",{metadata:{appId:t.id,appName:t.name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:e.paths,attributes:e.attributes},version:"1.0"})},publishUpdate:function(e,t){var s=y.get("widget")||window.widget;y.get("eventsHandler").publish(this._subscriberId,"DS/Object/update",{metadata:{appId:s.id,appName:s.name,timestamp:Math.floor(Date.now()),options:n.is(t,"object")?t:{}},data:{paths:e.paths,attributes:e.attributes},version:"1.0"})},publishPreferences:function(){for(var e=y.get("widget")||window.widget,t=[],n=this.getTreeDocument().getRoots(!1),s=0;s<n.length;s++)t.push(n[s].options.physicalId);y.get("eventsHandler").publish(this._subscriberId,"DS/Widget/preferences",{metadata:{appId:e.id,appName:e.name,timestamp:Math.floor(Date.now())},data:{preferences:JSON.stringify(e.getPreferences())},version:"1.0"})},publishFilteredIssues:function(){for(var e=y.get("widget"),t=[],n=this.getTreeDocument().getRoots(!1),s=0;s<n.length;s++)t.push(n[s].options.physicalId);y.get("eventsHandler").publish(this._subscriberId,"DS/ENXISSU_AP/Filter/Issues",{metadata:{appId:e.id,appName:e.name,timestamp:Math.floor(Date.now())},data:{filter:{issues:t}},version:"1.0"})},publishCompass:function(){this.utils.setTypesCallbackForOFW(this.document.getSelectedNodes())},getSelectedNodes:function(){return this.document.getSelectedNodes()},getNodesById:function(e){return this.document.getNodesById(e)},getTreeDocument:function(){return this.document},getTreeListView:function(){return this.list},getManager:function(){return this.list},getKanbanView:function(){return this.kanban},getCurrentView:function(){var e=S.getItem("view");return null!==e&&e.name?e.name:(S.setItem("view",{name:L}),L)},getSessionOrFilteredRoots:function(){var e=[],t=this.getTreeDocument(),n=y.get("widget"),s=n.getValue("filter");return!0===t.utils.isJson(s)&&!0===(s=JSON.parse(s)).session&&(e=n.getValue("roots")),e},_subscribers:function(){var t=this,n=y.get("widget")||window.widget,s=y.get("eventsHandler");t.document.addEventListener("onRootsAdded",(function(e){t.placeholder.hide(t.container),t.dispatchEvent("onRootsAdded",e)})),t.document.addEventListener("onRootsRemoved",(function(e){0===t.document.getRoots().length&&t.placeholder.show(t.container);var n=y.get("status");t.totalIssues=t.totalIssues-e.data.roots.length,t.loadedIssues=t.loadedIssues-e.data.roots.length;var s=x.replace(x.totalIssues,{number:t.totalIssues}),i=x.replace(x.loadedIssues,{number:t.loadedIssues});n.totalDiv.textContent=s,n.loadedDiv.textContent=i,t.dispatchEvent("onRootsRemoved",e),t.document.getModelEvents().publish({event:"setPathTags"})})),t.listenTo(t,"onResize",(function(){y.get("application").resize()})),t._subscriberTokens.push(s.subscribe(t._subscriberId,"DS/Object/create",(function(n){C.start(t.name+" DS/Object/create");var s=n.data.attributes;t.document.refreshNodesById({timestamp:n.metadata.timestamp,created:Object.keys(s)}).then((function(n){var s=y.get("status");t.totalIssues=t.totalIssues+n.created.length,t.loadedIssues=t.loadedIssues+n.created.length;var i=x.replace(x.totalIssues,{number:t.totalIssues}),o=x.replace(x.loadedIssues,{number:t.loadedIssues});s.totalDiv.textContent=i,s.loadedDiv.textContent=o,t.document.withBroadcastSelect(new e((function(e){t.document.withTransactionUpdate((function(){t.document.unselectAll();for(var s=n.created,i=0;i<s.length;i++)s[i].select();e()}))}))),C.end(t.name+" DS/Object/create")}))}))),t._subscriberTokens.push(s.subscribe(t._subscriberId,"DS/Object/update",(function(e){var n=e.data.attributes;t.document.refreshNodesById({timestamp:e.metadata.timestamp,modified:Object.keys(n)}).then((function(){C.end(t.name+" DS/Object/update")}))}))),t._subscriberTokens.push(s.subscribe(t._subscriberId,"DS/Object/delete",(function(e){C.start(t.name+" DS/Object/delete");var n=t.document,s=[];e.data.paths.forEach((function(e){s.push(e.pop())})),n.removeRootsById(s).then((function(){C.end(t.name+" DS/Object/delete")}))}))),t._subscriberTokens.push(s.subscribe(t._subscriberId,"DS/Object/select",(function(e){var s=e.data.paths;if(e.metadata.appId!==n.id&&!(t._tasks&&t._tasks.current&&t._tasks.current.taskType&&"SELECT_IN_3D"===t._tasks.current.taskType)){C.start(t.name+" DS/Object/select");var i=t.document;i.withTransactionUpdate((function(){for(var n=t.getSelectedNodes(),o=t.getTreeListView(),a=0;a<s.length;a++){var r=i.getNodesById(s[a][V]);if(r.length>0){var l=r[V];C.start(t.name+" scrollToNode"),o.ensureNodeModelVisible(l),C.end(t.name+" scrollToNode"),n.forEach((function(e){e.unselect()})),l.select()}}p.select(t.getSelectedNodes()),d.publishSelectAll(e.data),C.end(t.name+" DS/Object/select")}))}})))},_subscribersTaskManager:function(){var t=this,s=y.get("widget")||window.widget,i=y.get("eventsHandler");t._tasks.subscriberTokens.push(i.subscribe(t._subscriberId,"DS/IssueManagementTask/add",(function(e){if(C.start(t.name+" DS/IssueManagementTask/add"),n.is(e.metadata,"object")&&n.is(e.metadata.options,"object")&&n.equals(e.metadata.options[F.ISU_TASK_MANAGER],F.ISU_TASK_MANAGER)&&Array.isArray(e.data.paths)&&e.data.paths.length>0){var i=e.data.paths[V][V],o=e.data.attributes[i];if(!n.is(t._tasks.current)&&(l=s.body.getDimensions().height,c=window.getComputedStyle(s.body),0!==l&&"none"!==c.display&&-1!==Object.keys(B).indexOf(o.taskType))){var a=[],r={};a.push([i]),r[i]={taskType:o.taskType,widgetIdIM:o.widgetIdIM,widgetId3D:s.id},y.get("eventsHandler").publish(t._subscriberId,"DS/IssueManagementTask/ready",{metadata:{appId:s.id,appName:s.name,timestamp:Math.floor(Date.now()),options:n.clone(e.metadata.options)},data:{paths:a,attributes:r},version:"1.0"})}}var l,c;C.end(t.name+" DS/IssueManagementTask/add")}))),t._tasks.subscriberTokens.push(i.subscribe(t._subscriberId,"DS/IssueManagementTask/exec",(function(i){if(C.start(t.name+" DS/IssueManagementTask/exec"),n.is(i.metadata,"object")&&n.is(i.metadata.options,"object")&&n.equals(i.metadata.options[F.ISU_TASK_MANAGER],F.ISU_TASK_MANAGER)&&Array.isArray(i.data.paths)&&i.data.paths.length>0){var o=i.data.paths[V][V],a=i.data.attributes[o];s.name===O&&a.widgetId3D===s.id&&new e((function(e){e()})).then((function(){t._tasks.current={taskId:o,taskType:a.taskType,widgetIdIM:a.widgetIdIM,widgetId3D:s.id}})).then((function(){return n.is(t._taskHandlers[a.taskType],"function")?t._taskHandlers[a.taskType].call(t,a.args):e.resolve()})).then((function(e){n.is(e,"object")&&(t._tasks.current.cancel=e)})).catch((function(e){t._tasks.current=null,t._logger.error(e)}))}C.end(t.name+" DS/IssueManagementTask/exec")}))),t._tasks.subscriberTokens.push(i.subscribe(t._subscriberId,"DS/IssueManagementTask/cancel",(function(e){if(C.start(t.name+" DS/IssueManagementTask/cancel"),n.is(e.metadata,"object")&&n.is(e.metadata.options,"object")&&n.equals(e.metadata.options[F.ISU_TASK_MANAGER],F.ISU_TASK_MANAGER)&&Array.isArray(e.data.paths)&&e.data.paths.length>0){var i=e.data.paths[V][V],o=e.data.attributes[i];o.taskId===t._tasks.current.taskId&&o.widgetId3D===s.id&&o.widgetIdIM===t._tasks.current.widgetIdIM&&(n.is(t._tasks.current.cancel,"function")&&t._tasks.current.cancel(),t._tasks.current=null)}C.end(t.name+" DS/IssueManagementTask/cancel")})))},_getCommandCheckHeaderForInlineCreate:function(){var e=p.getCommandCheckHeader("InlineCreate");e&&e.setState(!1,!1)},sortColumnToOldLevel:function(e,t){const n=new Map(e.map(((e,t)=>[e.dataIndex,t])));return t.sort(((e,t)=>(n.has(e.dataIndex)?n.get(e.dataIndex):1/0)-(n.has(t.dataIndex)?n.get(t.dataIndex):1/0))),t.map((t=>{let n=e.find((e=>e.dataIndex===t.dataIndex));return{...t,visibleFlag:void 0!==n?.visibleFlag&&n.visibleFlag}}))},getVisibleColumn:function(e){new Map(e.map((e=>[e.dataIndex,e.visibleFlag])));return e.reduce(((e,t)=>("Attribute"!=t.isCustom&&"Classification"!=t.isCustom||!t.visibleFlag||(e[t.dataIndex]=t.visibleFlag),e)),{})},removeMatchingKeys:function(e,t){return Object.fromEntries(Object.entries(t).filter((([t])=>!1!==e[t])))},_taskHandlers:{FILTER:function(t){var n=this,s=y.get("widget")||window.widget;return new e((function(e){n.listenTo(n,"onRefreshComplete",(function(){var e=[],t={};e.push([n._tasks.current.taskId]),t[n._tasks.current.taskId]={taskType:n._tasks.current.taskType,widgetIdIM:n._tasks.current.widgetIdIM,widgetId3D:n._tasks.current.widgetId3D},y.get("eventsHandler").publish(n._subscriberId,"DS/IssueManagementTask/done",{metadata:{appId:s.id,appName:s.name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:e,attributes:t},version:"1.0"}),n._tasks.current=null,n.stopListening(n,"onRefreshComplete")}));s.setValue("filter",JSON.stringify({session:!0})),s.setValue("roots",t[k]),s.dispatchEvent("onRefresh"),e(null)}))},PREFERENCES:function(){var t=this,n=y.get("widget")||window.widget;return new e((function(e){var s=[],i={};s.push([t._tasks.current.taskId]),i[t._tasks.current.taskId]={taskType:t._tasks.current.taskType,widgetIdIM:t._tasks.current.widgetIdIM,widgetId3D:t._tasks.current.widgetId3D,response:{preferences:JSON.stringify(n.getPreferences())}},y.get("eventsHandler").publish(t._subscriberId,"DS/IssueManagementTask/done",{metadata:{appId:n.id,appName:n.name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:s,attributes:i},version:"1.0"}),t._tasks.current=null,e(null)}))},GET_FILTERED_ISSUES:function(){var t=this,n=y.get("widget");return new e((function(e){for(var s=[],i=t.getTreeDocument().getRoots(!1),o=0;o<i.length;o++)s.push(i[o].options.physicalId);var a=[],r={};a.push([t._tasks.current.taskId]),r[t._tasks.current.taskId]={taskType:t._tasks.current.taskType,widgetIdIM:t._tasks.current.widgetIdIM,widgetId3D:t._tasks.current.widgetId3D,response:{filter:{issues:s}}},y.get("eventsHandler").publish(t._subscriberId,"DS/IssueManagementTask/done",{metadata:{appId:n.id,appName:n.name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:a,attributes:r},version:"1.0"}),t._tasks.current=null,e(null)}))}},getPADTreeDocument:function(){return this.getTreeDocument()},setPADContext:function(){var e=this;require(["DS/PADUtils/PADContext"],(function(t){t.set(e)}))},maskForTask:function(e,t){var i=this,o=y.get("widget")||window.widget;i._tasks.current={taskId:e.taskId,taskType:e.taskType,widgetIdIM:o.id,widgetId3D:""};var a=o.body;a.addClassName("masked masked-task");var r=n.createElement("div",{class:"mask mask-for-task"});n.createElement("div",{class:"mask-wrapper",html:n.createElement("div",{class:"task-mask-cancel",html:[n.createElement("div",{class:"task-select-message",html:t||x.tasks.cancelLabel}),new s({value:x.tasks.cancel,className:"default task-cancel-button",id:"task-cancel",events:{onClick:function(){null!==i._tasks.current?i.taskManager.cancel(i._tasks.current.taskId):(a.removeClassName("masked masked-task"),r.destroy())}}})]})}).inject(r),i._mask=r,r.inject(a)},unmaskForTask:function(e){var t=this,s=y.get("widget")||window.widget;e.widgetIdIM===s.id&&(s.body.removeClassName("masked masked-task"),n.is(t._mask)&&(t._mask.destroy(),t._mask=null),t._tasks.current=null)},placeholder:{show:function(e,t){var s=e.getElement(".no-issues-to-show-container");s&&s.destroy();var i=x.titles.placeholder.sub;e.getChildren().forEach((function(e){e.setStyle("display","none")}));var a=n.createElement("span",{class:"no-issues-to-show-filter-shortcut fonticon fonticon-list-filter"}),r=n.createElement("span",{class:"no-issues-to-show-create-shortcut fonticon fonticon-plus"}),l=n.createElement("div",{class:"no-issues-to-show-container",html:[n.createElement("div",{class:"no-issues-to-show",html:[n.createElement("div",{class:"pin",html:'<span class="fonticon fonticon-5x fonticon-issue-type"></span>'}),n.createElement("div",{class:"pulse"}),n.createElement("span",{class:"no-issues-to-show-label",html:x.titles.placeholder.label}),n.createElement("div",{class:"no-issues-to-show-sub-container",html:n.createElement("span",{html:x.replace(i,{filter:a.outerHTML,create:r.outerHTML})})})]})]});return e.appendChild(l),l.addEventListener("dragenter",(()=>{y.get("component").container.dropZone.show(),document.getElementById("dndDismissButton").hide()})),l.addEventListener("dragover",(e=>{e.preventDefault()})),l.addEventListener("drop",(()=>{y.get("component").container.dropZone.hide()})),this._filterTooltip=new o({position:"top",target:l.getElement(".no-issues-to-show-filter-shortcut"),body:x.filter.title}),l.getElement(".no-issues-to-show-filter-shortcut").addEventListener("click",(function(){document.getElementById("filterByObjectToolbar").firstChild.click()})),this._createTooltip=new o({position:"top",target:l.getElement(".no-issues-to-show-create-shortcut"),body:x.actions.create.title}),l.getElement(".no-issues-to-show-create-shortcut").addEventListener("click",(function(){var e=p.getCommand("Create");e.mode=U,e.begin()})),l},hide:function(e){var t=this,n=e.getElement(".no-issues-to-show-container");null!==n&&(e.getChildren().forEach((function(e){e.hasClassName("isu-dragAndDropView")||e.setStyle("display","initial")})),n.destroy(),t._filterTooltip&&(t._filterTooltip.destroy(),t._filterTooltip=null),t._createTooltip&&(t._createTooltip.destroy(),t._createTooltip=null))}},_dispatchEventForRestoreCustomView:async function(){var e=this;e.isDGViewMigrated?e.list.restoreCustomView():await e.list.restoreCustomView_V2()},isFilteringRequestEligible:function(){y.get("actionBar");var e=D.toolbarActionBar.getNodeModelByID("Filter"),t=!1;if(e){let s=e.options.grid.data.menu.filter((e=>{if(e.state&&e.state.includes("selected"))return t=!0,e.id})).map((e=>e.id));var n=!0;(1==s.length&&("closed"==s[0]||"filterbyobject"==s[0])&&this.settings.hideNoFilterSelectionPreference||2==s.length&&s.includes("closed")&&s.includes("filterbyobject")&&this.settings.hideNoFilterSelectionPreference)&&(n=!1),n||(t=!1)}return t},applyNLSValuesToFacets:function(e){var t={};e.forEach((e=>{if(e.sixw){var n=e.sixw.split("/").pop();t[n]||(t[n]=[]),t[n].push(e.object)}})),w.getNLSValuesPromise(t).then((function(t){e.forEach((e=>{if(e.sixw){var s=e.sixw.split("/").pop();n.is(t[s])&&n.is(t[s][e.object])&&(e.dispValue=t[s][e.object])}})),g.setTags(e)}))},updateTotalCount:function(e){var t=this;e.forEach((e=>{e.sixw&&(e.sixw.split("/").pop().toLowerCase().includes("policy")&&(t.totalIssues=e.count))}))},utils:{_iconBarForPlaceHolder:null,_setTypesCallbackSubscribe:!1,setTypesCallbackForOFW:function(e){l.setTypesCallbackForOFW(e,{setTypesCallbackSubscribe:this._setTypesCallbackSubscribe}),this._setTypesCallbackSubscribe=!0},isJson:function(e){try{JSON.parse(e)}catch(e){return!1}return!0},isTouchDevice:function(){return"ontouchstart"in document.documentElement}},onSummaryViewDrop:function(e){var t=[],n=[];e.forEach((e=>{e.displayType===P||e.objectType==P?t.push(e.objectId):e.hasOwnProperty("objectType")?n.push(e.objectType):n.push(e.displayType)})),u.getTypesHierarchy(n).then((n=>{e.forEach((e=>{(n[e.objectType]||n[e.displayType])&&(n[e.objectType].hierarchy.includes(P)||n[e.displayType]&&n[e.displayType].hierarchy.includes(P)||n[e.objectType]&&n[e.objectType].hierarchy.includes(P))&&t.push(e.objectId)}))})).then((()=>{w.getAdditionalObjectInfo({pidArray:t}).then((e=>{for(var n=0;n<t.length;n++)if("Issue Template"==e.additionObjectInfo[t[n]].policy){const e=t.indexOf(t[n]);e>-1&&(t.splice(e,1),n=-1)}var s=widget.getValue("filter");if(widget.setValue("previousFilter",s),t.length>0){var i={session:!0,filterbyobject:widget.getValue("contextFilter")};widget.setValue("filter",JSON.stringify(i)),widget.setValue("roots",t),widget.dispatchEvent("onRefresh")}else E.displayNotification({msg:x.dnd.notSupported,eventID:"warning"})}))}))}})})),define("DS/IssueManagement/components/idcard/IdCardModel",["UWA/Class/Promise","UWA/Class/View","UWA/Core","UWA/Class/Model","DS/CoreEvents/ModelEvents","DS/IssueManagement/components/idcard/IDCardHeaderAttributes","i18n!DS/IssueManagement/assets/nls/IssueManagement"],(function(e,t,n,s,i,o,a){return new s({name:"",thumbnail:"",description:"",withHomeButton:!1,withExpandCollapseButton:!1,withActionsButton:!0,withInformationButton:!1,withToggleMinifiedButton:!0,showBackButton:!1,minified:!1,modelEvents:new i,attributes:o.Default_Attr,customEvents:{homeIconClick:{event:"custom-show-landing-page-event"},expandCollapseIconClick:{event:"issue-idcard-panel-toggle"},informationIconClick:{event:"custom-information-icon-event"},configurationLabelClick:{event:"custom-show-configuration-event"},versionLabelClick:{event:"custom-show-version-explorer-event"},actionsMenuClick:{event:"issue-idcard-actions-menu-click"}}})})),define("DS/IssueManagement/components/welcomePanel/view/TopBarWrapper",["UWA/Class","DS/ENOXPageToolBar/js/PageToolBar","DS/IssueManagement/components/welcomePanel/view/GlobalConfig","DS/PlatformAPI/PlatformAPI","DS/IssueCommon/utils/Utils","DS/IssueServices/Contexts","i18n!DS/IssueManagement/assets/nls/IssueManagement"],(function(e,t,n,s,i,o,a){"use strict";return e.extend({initialize:function(e,n,s){var i=this;this.xModelRouter=n,this._applicationChannel=e,this._isReadyToNavigate=!0;var o={withInformationButton:!0,withWelcomePanelButton:!0,modelEvents:this._applicationChannel,parentContainer:s};i.myPageToolBar=new t(o),i.myPageToolBar.render().inject(s),i.addTitleContentIntoTopBarContent(),this._subscribeToEvents()},_subscribeToEvents:function(){var e=this;this._applicationChannel.subscribe({event:"updateToolbar"},(function(){var e=document.getElementsByClassName("body-content")[0],t=e.getElementsByClassName("im-header")[0],n=e.getElementsByClassName("create-template-chooser-list-iconbar")[0];widget.getValue("IsIssueSummaryView")?(n&&n.hide(),t&&t.show()):(t&&t.hide(),n&&n.show())})),this._applicationChannel.subscribe({event:"welcome-panel-collapse"},(function(){e._applicationChannel.publish({event:"triptych-set-size",data:{size:n.LEFT_PANEL_SIZE_COLLAPSED,side:"left"}}),widget.getValue("isOpened")&&("right"==widget.getValue("infoPanelLayout")||null==widget.getValue("infoPanelLayout")||null==widget.getValue("infoPanelLayout")?(e._applicationChannel.publish({event:"triptych-show-panel",data:"right"}),e._applicationChannel.publish({event:"information-panel-visible",data:null})):"bottom"==widget.getValue("infoPanelLayout")&&e._applicationChannel.publish({event:"triptych-show-panel-bottom",data:"bottom"})),widget.setValue("isCollapsed",!0);try{i.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:"DataGridView",pd3:"LandingPage",pd4:"Collapse",pd5:"Issue/DataGridView/LandingPage/Collapse"}})}catch(e){}})),this._applicationChannel.subscribe({event:"welcome-panel-expand"},(function(){e._applicationChannel.publish({event:"triptych-set-size",data:{size:n.LEFT_PANEL_SIZE_EXPANDED,side:"left"}}),e._applicationChannel.publish({event:"triptych-show-panel",data:"left"}),widget.getValue("isOpened")&&("right"==widget.getValue("infoPanelLayout")||null==widget.getValue("infoPanelLayout")||null==widget.getValue("infoPanelLayout")?(e._applicationChannel.publish({event:"triptych-show-panel",data:"right"}),e._applicationChannel.publish({event:"information-panel-visible",data:null})):"bottom"==widget.getValue("infoPanelLayout")&&e._applicationChannel.publish({event:"triptych-show-panel-bottom",data:"bottom"})),widget.setValue("isCollapsed",!1);try{var t=o.get("component").getCurrentView();i.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:t,pd3:"LandingPage",pd4:"Expand",pd5:"Issue/"+t+"/LandingPage/Expand"}})}catch(e){}})),this._applicationChannel.subscribe({event:"information-panel-close"},(function(){"right"==widget.getValue("infoPanelLayout")||null==widget.getValue("infoPanelLayout")||null==widget.getValue("infoPanelLayout")?(e._applicationChannel.publish({event:"triptych-hide-panel",data:"right"}),widget.setValue("isOpened",!1)):"bottom"==widget.getValue("infoPanelLayout")&&e._applicationChannel.publish({event:"triptych-hide-panel-bottom",data:"bottom"}),e._applicationChannel.publish({event:"resize-summary-view",data:"left"})})),this._applicationChannel.subscribe({event:"triptych-hide-panel"},(function(e){"right"==e&&s.publish(`PropHeaderDeActivated:${widget.id}`)})),this._applicationChannel.subscribe({event:"information-panel-open"},(function(){"right"==widget.getValue("infoPanelLayout")||null==widget.getValue("infoPanelLayout")||null==widget.getValue("infoPanelLayout")?(null!=widget.getValue("infoPanelWidth")&&null!=widget.getValue("infoPanelWidth")&&e._applicationChannel.publish({event:"triptych-set-size",data:{size:widget.getValue("infoPanelWidth"),side:"right"}}),e._applicationChannel.publish({event:"triptych-show-panel",data:"right"}),e._applicationChannel.publish({event:"information-panel-visible",data:null})):"bottom"==widget.getValue("infoPanelLayout")&&e._applicationChannel.publish({event:"triptych-show-panel-bottom",data:"bottom"})})),this._applicationChannel.subscribe({event:"triptych-panel-hidden"},(function(t){if("right"===t){if(widget.getValue("fromLayoutChange"))return void widget.setValue("fromLayoutChange",!1);e._applicationChannel.publish({event:"information-panel-hidden",data:null}),widget.setValue("isOpened",!1)}})),this._applicationChannel.subscribe({event:"topbar-show-title"},(function(t){t&&(e._title.id=t.id,e._title.label=t.label,e._tileContent.setContent(t.label)),e._tileContent.show()})),this._applicationChannel.subscribe({event:"topbar-hide-title"},(function(){e._tileContent.hide()}))},addTitleContentIntoTopBarContent:function(){var e=this;e.topbarContent=e.myPageToolBar.getBodyContent(),this._tileContent=UWA.createElement("div",{class:"page-Toolbar-container",styles:{display:"none",padding:"6px 0",fontSize:"14px",width:"150px",marginTop:"5px"}}),this._tileContent.inject(e.topbarContent),this._title={id:n.ROUTE_HOME,label:"Home"}}})})),define("DS/IssueManagement/components/information/IssueHeader",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Input/Button","DS/Controls/TooltipModel","DS/WebappsUtils/WebappsUtils","DS/PlatformAPI/PlatformAPI","DS/Logger/Logger","DS/Menu/Menu","DS/ENOFloatingPanel/ENOFloatingPanel","DS/IssueAttachmentManager/services/AttachmentServices","DS/IssueCommon/utils/Utils","DS/IssueCommon/commands/CommandsManager","DS/IssueManagement/components/idcard/IssueIdcard","DS/IssueManagement/components/idcard/IdCardModel","DS/IssueManagement/components/idcard/IDCardHeaderAttributes","DS/IssueManagement/components/ContextualMenu","DS/IssueComponents/search/PeopleSearch","DS/SearchWidget/SearchWidgetConstant","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","DS/PADUtils/views/PADAlert","i18n!DS/IssueManagement/assets/nls/IssueManagement","i18n!DS/IssueComponents/assets/nls/IssueComponents"],(function(e,t,n,s,i,o,a,r,l,c,d,u,p,m,g,f,h,v,I,b,y,w,S,C,D){"use strict";var T={ISSUE_TYPE:"Issue",PLMNEW_ENABLEMENT:"PLMNewEnablement",CSS:{ELEMENTS:{COMPACT:"compact",MULTIPLE_SELECTION:"multiple-selection",PLACEHOLDER:"im-information-header-placeholder",PLACEHOLDER_IMAGE:"im-information-header-placeholder-image",PLACEHOLDER_CONTENT:"im-information-header-placeholder-content",IMAGE_CONTAINER:"im-information-header-image-ctn",TITLE_CONTAINER:"im-information-header-info-title",TITLE_CONTENT:"im-information-header-info-title-content",MENU_BUTTON:"im-information-header-info-title-menu-btn fonticon fonticon-2x fonticon-chevron-down",PREV_BUTTON:"im-information-header-info-title-prev-btn fonticon fonticon-2x fonticon-chevron-left",NEXT_BUTTON:"im-information-header-info-title-next-btn fonticon fonticon-2x fonticon-chevron-right",CLOSE_BUTTON:"im-information-header-info-title-close-btn wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-close",SUMMARY_CONTAINER:"im-information-header-info-summary",OWNER_CONTAINER:"im-information-header-info-owner",INFO_CONTAINER:"im-information-header-info-ctn",INFO_ELEMENT:"im-information-header-info-element",INFO_CONTEXTS:"im-information-header-info-contexts",INFO_REPORTEDAGAINST:"im-information-header-info-reportedagainst",INFO_RESOLVEDBY:"im-information-header-info-resolvedby",INFO_RESOLVEDITEMS:"im-information-header-info-resolvedItems",INFO_ASSIGNEES:"im-information-header-info-assignees",INFO_COMMENTS:"im-information-header-info-comments",INFO_ATTACHMENTS:"im-information-header-info-attachments",INFO_RESOLUTIONDATE:"im-information-header-info-resolutiondate",IMAGE:"im-information-header-image",STACK_IMAGES:"im-information-header-stack-images",STACK_ELEMENT:"im-information-header-stack-element"},DIMENSIONS:{MIN_WIDTH:420}},defaultImage:o.getWebappsAssetUrl("IssueManagement","icons/iconIssueThumbnail.png"),MAXIMUM_STACK_ELEMENTS_FOR_IMAGES:3};return t.extend({name:"DS/IssueManagement/components/information/WuxHeader",tagName:"div",className:"im-information-new-header",_logger:null,fields:{responsibleOrganization:null},values:{responsibleOrganization:null,responsibleOrganizationTitle:null},setup:function(t){var n=this;w.start(n.name+" setup"),n._parent(t),n._logger=r.getLogger(n.name),n._deferred={},n.isLoaded=new e((function(e,t){n._deferred.resolve=e,n._deferred.reject=t})),n.IssueIDCard={},n.physicalIds=[],n.customEvents=t.customEvents,n._eventListeners=[],w.end(n.name+" setup")},render:function(){var e=this;w.start(e.name+" render");var t=b.get("eventsHandler");e._subscriberId=Math.random().toString(36).substr(2,9),e._eventListeners=[{event:"DS/Object/update",listener:function(t){t.data.paths.length>0&&(t.data.paths.reduce((function(e,t){return e.push(t.pop()),e})).some((function(t){return-1!==e.physicalIds.indexOf(t)}))&&e.refresh(e.physicalIds))},conditions:{type:"issue",attributes:["*","owner","contexts","reportedAgainst","resolvedBy","resolvedItems","assignees","attachments","state"]}}];for(var n=0;n<e._eventListeners.length;n++){var s=e._eventListeners[n];s.token=t.subscribe(e._subscriberId,s.event,s.listener.bind(e),s.conditions)}return w.end(e.name+" render"),e.IssueIDCard=new m({model:g}),e.IssueIDCard.renderView().inject(e.container),e.IssueIDCard.attachResizeSensor(),e._idCardSubscribers(),!0===widget.getValue("isIDCardCollapsed")?e.IssueIDCard.minify():e.IssueIDCard.expand(),e},refresh:function(t){var n=this,s=[];return n._deferred={},n.isLoaded=new e((function(e,t){n._deferred.resolve=e,n._deferred.reject=t})),n.physicalIds=t,0!=t.length?(s.push(n._refreshPrimaryImage(t)),s.push(n._refreshInfo(t))):t.length,e.all(s).then((function(){n.dispatchEvent("onRefresh"),n._deferred.resolve()})).catch((function(e){n._logger.error("Cannot refresh information header %o",e),n._deferred.reject(e)}))},_refreshPrimaryImage:function(e){var t=this;return y.images.retrieve({data:{objects:e.map((function(e){return{physicalId:e}}))}}).then((function(e){if(!Array.isArray(e.results))throw new Error("Unexpected response when retrieving images.");if(1===e.results.length){var s=e.results[0].body;n.is(s,"object")&&n.is(s.url,"string")&&""!==s.url?t.IssueIDCard.model.set("thumbnail",s.url):t.IssueIDCard.model.set("thumbnail",T.defaultImage)}else e.results.length>1&&t.IssueIDCard.model.set("thumbnail",T.defaultImage)})).catch((function(e){t._logger.error("Cannot retrieve the images: %o",e)}))},_refreshInfo:function(t){var n=this,s=[],i=y.issues.retrieve({data:{objects:t.map((function(e){return{physicalId:e}}))}}).then((function(e){if(Array.isArray(e.results)){if(b.get(T.PLMNEW_ENABLEMENT)&&1==e.results.length)if("Create"==e.results[0].body.state){let e=f.PLMNew_DraftState;n.IssueIDCard.model.set("attributes",e)}else{let e=f.Default_Attr;n.IssueIDCard.model.set("attributes",e)}if(n._setHeaderValues(e.results),1===e.results.length){let t=e.results[0].body,s=t.reportedAgainst.length;s+=t.resolvedBy.length,s+=t.resolvedItems.length,s+=t.contexts.length;let i=n._getMembersCount(t);n.customEvents.publish({event:"im-update-tab-count",data:{tabs:["relatedObjects","team"],count:[s,i]}})}}})).catch((function(e){n._logger.error("Cannot retrieve the info: %o",e)}));return s.push(i),1==t.length?(y.comments.retrieve({data:{physicalId:t[0]}}).then((function(e){var t=0;try{t=e.body.result.nbComments}catch(e){t=0}u.isInteger(t)||(t=0),n.customEvents.publish({event:"im-update-tab-count",data:{tabs:["comments"],count:[t]}})})),d.getDocumentsFrom(t[0]).then((function(e){var t=0;try{t=e.attachments.length}catch(e){t=0}u.isInteger(t)||(t=0),n.customEvents.publish({event:"im-update-tab-count",data:{tabs:["attachments"],count:[t]}})}))):n.customEvents.publish({event:"im-update-tab-count",data:{tabs:["relatedObjects","team","comments","attachments"],count:["","","",""]}}),e.all(s)},resize:function(){var e=this;setTimeout((()=>{e.container.toggleClassName(T.CSS.ELEMENTS.COMPACT,e.container.getParent()&&e.container.getParent().offsetWidth<T.CSS.DIMENSIONS.MIN_WIDTH),e.IssueIDCard.resize()}),200)},destroy:function(){var e=this;if(e.physicalIds=[],Array.isArray(e._eventListeners))for(var t=0;t<e._eventListeners.length;t++){var n=e._eventListeners[t];b.get("eventsHandler").unsubscribe(n.token)}e._eventListeners=[],e.container.empty()},_publishUpdate:function(e,t){for(var n=[],s={},i=0;i<e.length;i++)n.push([e[i].physicalId]),s[e[i].physicalId]={id:e[i].physicalId,type:"Issue",modifiedAttributes:Array.isArray(t)?["state"].concat(t):["state"]};b.get("eventsHandler").publish(this._subscriberId,"DS/Object/update",{metadata:{appId:b.get("widget").id,appName:b.get("widget").name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:n,attributes:s},version:"1.0"})},_scrollToNextNode:function(e){var t=this;e.options.baseType===T.ISSUE_TYPE&&(t.currentSelectedIssue=e);var s=b.get("component").getTreeListView();if(n.is(s,"object")){var i=s.getManager();if(n.is(i,"object")){var o=e.getNextVisibleNode();if(o)if(o.options.baseType===T.ISSUE_TYPE){t.listView?i._goToNode(e,1):(t.currentSelectedIssue&&t.currentSelectedIssue.unselect(),o.select());var a=b.get("component").getTreeDocument();a.prepareBroadcastSelect(),a.pushBroadcastSelect()}else t._scrollToNextNode(o)}}},_scrollToPreviousNode:function(e){var t=this;e.options.baseType===T.ISSUE_TYPE&&(t.currentSelectedIssue=e);var s=b.get("component").getTreeListView();if(n.is(s,"object")){var i=s.getManager();if(n.is(i,"object")){var o=e.getPreviousVisibleNode();if(o)if(o.options.baseType===T.ISSUE_TYPE){t.listView?i._goToNode(e,-1):(t.currentSelectedIssue&&t.currentSelectedIssue.unselect(),o.select());var a=b.get("component").getTreeDocument();a.prepareBroadcastSelect(),a.pushBroadcastSelect()}else t._scrollToPreviousNode(o)}}},_setHeaderValues:function(e){var t=this;let n={title:"",priority:C.information.header.Varies,owner:{fullName:C.information.header.Varies,isVaries:!0},name:{fullName:C.information.header.Varies,isVaries:!0},maturityState:{value:C.information.header.Varies,isVaries:!0},collaborativeSpace:{value:C.information.header.Varies,isVaries:!0},resolutionDate:C.information.header.Varies,modified:C.information.header.Varies,responsibleOrg:{value:C.information.header.Varies,isVaries:!0},reportingOrg:{value:C.information.header.Varies,isVaries:!0},completionType:{value:C.information.header.Varies,isVaries:!0}};if(e.length>1){let s=e.length;n.title=C.replace(C.information.header.multipleSelection.title,{number:s});let i=e[0].body,o=i.owner.fullName,a=i.state,r=i.priority,l=i.collaborativeSpaceTitle?i.collaborativeSpaceTitle:i.collaborativeSpace,c=i.responsibleOrganizationTitle,d=i.resolutionDate,p=i.reportingOrganizationTitle,m=i.completionType;e.every((e=>e.body.owner.fullName==o))&&(n.owner.fullName=o,n.owner.isVaries=!1),e.every((e=>e.body.priority==r))&&(n.priority=r),e.every((e=>e.body.state==a))&&(n.maturityState.value=l,n.maturityState.isVaries=!1);for(let t=0;t<e.length;t++){if((e[t].body.collaborativeSpaceTitle?e[t].body.collaborativeSpaceTitle:e[t].body.collaborativeSpace)!=l){n.collaborativeSpace.value=C.information.header.Varies,n.collaborativeSpace.isVaries=!0;break}n.collaborativeSpace.value=l,n.collaborativeSpace.isVaries=!1}if(e.every((e=>e.body.responsibleOrganizationTitle==c))&&(n.responsibleOrg.value=c,n.responsibleOrg.isVaries=!1),e.every((e=>e.body.reportingOrganizationTitle==p))&&(n.reportingOrg.value=p,n.reportingOrg.isVaries=!1),e.every((e=>e.body.completionType==m))&&(n.completionType.value=C[m],n.completionType.isVaries=!1),e.every((e=>e.body.resolutionDate==d))){n.resolutionDate=d,n.formatDateReq=d;u.getFormattedDate(n,{year:"numeric",month:"numeric",day:"numeric"})}else n.resolutionDate=n.resolutionDate;t.IssueIDCard.setAttributeValue("duedate",u.formatDate(n.formatDateReq),!0),t.IssueIDCard.setAttributeValue("completionType",n.completionType.value,n.completionType.isVaries),t.IssueIDCard.setAttributeValue("issueName",n.name.fullName,!0)}else if(1==e.length){let s=e[0].body;n.title=`${s.title}`,n.priority=s.priority,n.maturityState=s.state,n.owner.fullName=s.owner.fullName,n.owner.isVaries=!1,n.name=s.name,n.collaborativeSpace.value=s.collaborativeSpaceTitle?s.collaborativeSpaceTitle:s.collaborativeSpace,n.collaborativeSpace.isVaries=!1,n.resolutionDate=s.resolutionDate,n.formatDateReq=s.resolutionDate,n.modified=s.modified,n.completionType=C[s.completionType],""!=s.responsibleOrganizationTitle?n.responsibleOrg.value=s.responsibleOrganizationTitle:n.responsibleOrg.value=s.responsibleOrganization,n.responsibleOrg.isVaries=!1,""!=s.reportingOrganizationTitle?n.reportingOrg.value=s.reportingOrganizationTitle:n.reportingOrg.value=s.reportingOrganization,n.reportingOrg.isVaries=!1;u.getFormattedDate(n,{year:"numeric",month:"numeric",day:"numeric"});t.IssueIDCard.setAttributeValue("duedate",u.formatDate(n.formatDateReq)),t.IssueIDCard.setAttributeValue("issueName",n.name),t.IssueIDCard.setAttributeValue("completionType",n.completionType,n.completionType.isVaries),t.IssueIDCard.model.set("state",n.maturityState)}else e.length;t.IssueIDCard.model.set("name",n.title),t.IssueIDCard.setAttributeValue("owner",n.owner.fullName,n.owner.isVaries),t.IssueIDCard.setAttributeValue("collabspace",n.collaborativeSpace.value,n.collaborativeSpace.isVaries),t.IssueIDCard.setAttributeValue("responsibleOrg",n.responsibleOrg.value,n.responsibleOrg.isVaries),t.IssueIDCard.setAttributeValue("reportingOrg",n.reportingOrg.value,n.reportingOrg.isVaries),t.IssueIDCard.setAttributeValue("priority",n.priority);let s=e.map((e=>({physicalId:e.body.physicalId,state:e.body.state,owners:[e.body.owner,...e.body.coOwners],assignees:e.body.assignees,assigneeFromUG:e.body.assigneeFromUsersGroup,coOwnersFromUG:e.body.coOwnersFromUsersGroup})));t.IssueIDCard.displayMaturity(s)},_idCardSubscribers:function(){var e=this;a.subscribe("Lifecycle.Modification",(function(t){var n=JSON.parse(t).Refresh.modified;if(Array.isArray(n)){var s=n.reduce(((e,t)=>(e["Issue"==t.policy?"issuesPhysicalIds":"objectsPhysicalIds"].push(t),e)),{issuesPhysicalIds:[],objectsPhysicalIds:[]}),i=s.issuesPhysicalIds,o=s.objectsPhysicalIds;if(i.length>0){let t=[],n=[];i.forEach((e=>{t.push(e.physicalid),n.push({physicalId:e.physicalid})})),e.refresh(t),e._publishUpdate(n)}var a=o.filter((e=>null!=e.policy));a.length>0&&e.updateObjectNode(a)}})),e.IssueIDCard.modelEvents.subscribe({event:"issue-idcard-nav-prev"},(function(){var t=b.get("component").getTreeListView();if(e.listView=b.get("ISU_LISTVIEW"),n.is(t,"object")){var s=t.getManager();if(n.is(s,"object")){var i="";i=e.listView?s.getActiveNode():s.getTreeDocument().getSelectedNodes()[0],e._scrollToPreviousNode(i)}}})),e.IssueIDCard.modelEvents.subscribe({event:"issue-idcard-nav-next"},(function(){var t=b.get("component").getTreeListView();if(e.listView=b.get("ISU_LISTVIEW"),n.is(t,"object")){var s=t.getManager();if(n.is(s,"object")){var i="";i=e.listView?s.getActiveNode():s.getTreeDocument().getSelectedNodes()[0],e._scrollToNextNode(i)}}})),e.IssueIDCard.modelEvents.subscribe({event:"issue-idcard-nav-close"},(function(e){p.getCommand("ToggleInformationPanel").begin({open:!1,save:!0})}));var t=!1;e.IssueIDCard.modelEvents.subscribe({event:"idcard-expanded"},(function(n){e.dispatchEvent("request:resizeContent",{state:"expanded"}),t=!1,widget.setValue("isIDCardCollapsed",t);var s=document.getElementsByClassName("im-information-content")[0];s&&s.removeClassName("minified")})),e.IssueIDCard.modelEvents.subscribe({event:"idcard-minified"},(function(n){e.dispatchEvent("request:resizeContent",{state:"minified"}),t=!0,widget.setValue("isIDCardCollapsed",t);var s=document.getElementsByClassName("im-information-content")[0];s&&s.addClassName("minified")})),e.IssueIDCard.modelEvents.subscribe({event:"issue-idcard-actions-menu-click"},(function(t){var n=e.IssueIDCard.container.getElement(".actions-menu-icon").getBoundingClientRect(),s={position:{x:n.left,y:n.top+20}};h.getContextualMenu().then((function(e){l.show(e,s)}))})),e.IssueIDCard.modelEvents.subscribe({event:"idcard-attributes-clicked"},(function(t){if(n.is(t.index,"number"))switch(t.index){case 0:case 8:break;case 2:require(["DS/IssueCommon/commands/ChangeOwner"],(function(e){(new e).execute()}));try{var s=b.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:s,pd3:"IDCard",pd4:"ChangeOwner",pd5:"Issue/"+s+"/IDCard/ChangeOwner"}})}catch(e){}break;case 5:p.getCommand("Move").begin();try{s=b.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:s,pd3:"IDCard",pd4:"Move",pd5:"Issue/"+s+"/IDCard/Move"}})}catch(e){}break;case 6:if(1==e.physicalIds.length){e.changeResponsibleOrg();try{s=b.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:s,pd3:"IDCard",pd4:"ResponsibleOrganisation",pd5:"Issue/"+s+"/IDCard/ResponsibleOrganisation"}})}catch(e){}}break;case 7:if(1==e.physicalIds.length&&b.get(T.PLMNEW_ENABLEMENT)&&"Create"==e.IssueIDCard.model.get("state")){e.changeReportingOrg();try{s=b.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:s,pd3:"IDCard",pd4:"ReportingOrganisation",pd5:"Issue/"+s+"/IDCard/ReportingOrganisation"}})}catch(e){}}break;default:e.dispatchEvent("request:switchFacet",{facetName:"properties"})}})),e.IssueIDCard.modelEvents.subscribe({event:"idcard-thumbnail-clicked"},(function(e){if(1==b.get("component").getSelectedNodes().length){p.getCommand("AttachmentManager").begin();try{var t=b.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:t,pd3:"IDCard",pd4:"IssueIconAttachmentManager",pd5:"Issue/"+t+"/IDCard/IssueIconAttachmentManager"}})}catch(e){}}})),e.IssueIDCard.modelEvents.subscribe({event:"issue-idcard-maturity-update"},(function(t){let n=e.physicalIds.map((e=>({physicalId:e})));e._publishUpdate(n)})),e.IssueIDCard.modelEvents.subscribe({event:"issue-idcard-responsibleOrg-update"},(function(t){let n=e.physicalIds.map((e=>({physicalId:e})));var s=[[n[0].physicalId]],i={};i[n[0].physicalId]={id:n[0].physicalId,type:"Issue",modifiedAttributes:["responsibleOrg"]},a.publish("DS/Object/update",{metadata:{appId:widget.id,appName:widget.name,timestamp:Math.floor(Date.now())},data:{paths:s,attributes:i},version:"1.0"})})),e.IssueIDCard.modelEvents.subscribe({event:"issue-idcard-reportingOrg-update"},(function(t){let n=e.physicalIds.map((e=>({physicalId:e})));var s=[[n[0].physicalId]],i={};i[n[0].physicalId]={id:n[0].physicalId,type:"Issue",modifiedAttributes:["reportingOrg"]},a.publish("DS/Object/update",{metadata:{appId:widget.id,appName:widget.name,timestamp:Math.floor(Date.now())},data:{paths:s,attributes:i},version:"1.0"})})),e.IssueIDCard.modelEvents.subscribe({event:"onApprovalCompleted"},(function(t){var n=t.issues.map((function(e){return e.physicalId}));1===n.length&&e._refreshInfo(n),e._refreshPrimaryImage(n),e._publishUpdate(t.issues,t.modifiedAttributes);try{var s=b.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:s,pd3:"IDCard",pd4:"Maturity",pd5:"Issue/"+s+"/IDCard/Maturity"}})}catch(e){}})),e.IssueIDCard.modelEvents.subscribe({event:"onRejectionCompleted"},(function(t){var n=t.issues.map((function(e){return e.physicalId}));1===n.length&&e._refreshInfo(n),e._refreshPrimaryImage(n),e._publishUpdate(t.issues,t.modifiedAttributes);try{var s=b.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:s,pd3:"IDCard",pd4:"Maturity",pd5:"Issue/"+s+"/IDCard/Maturity"}})}catch(e){}})),e.IssueIDCard.modelEvents.subscribe({event:"issue-idcard-maturity-history-click"},(function(t){e.dispatchEvent("request:switchFacet",{facetName:"history"})})),e.IssueIDCard.modelEvents.subscribe({event:"refresh-issue-header"},(function(t){e.refresh(e.physicalIds);let n=e.physicalIds.map((e=>({physicalId:e})));e._publishUpdate(n)}))},_getMembersCount:function(e){let t=new Set;return t.add(e.owner.user),e.assignees.map((e=>{t.add(e.user)})),e.contributors.map((e=>{t.add(e.user)})),e.coOwners.map((e=>{t.add(e.user)})),e.informedUsers.map((e=>{t.add(e.user)})),t.size},changeResponsibleOrg:function(){var e,t=this;t.moveButton;var o=t.IssueIDCard.model.get("attributes").find((e=>"responsibleOrg"==e.id));e=new c({animate:!0,autocenter:!0,closable:!0,limitParent:!0,overlay:!0,resizable:!0,visible:!0,className:"confirm-select-in-3d-dialog",title:C.information.header.moveResponsibleOrg,header:null,body:n.createElement("div",{class:"idcard-form-element idcard-form-element-responsible-organization",html:[{tag:"div",class:"idcard-form-field form-group",html:[{tag:"h5",html:C.information.header.changeResponsibleOrg},{tag:"div",html:[t.fields.addResponsibleOrganization=t._orgSearch("responsibleOrganization"),t.fields.responsibleOrganization=n.createElement("div",{class:"idcard-responsible-organization-holder"}),t.fields.responsibleOrganization.responsibleOrganizationHelper=n.createElement("div",{html:[n.createElement("span",{class:"fonticon fonticon-help"})]})]}]},{tag:"div",class:"idcard-form-help-tooltip",html:[t.fields.responsibleOrganization.responsibleOrganizationHelper]}]}),footer:[t.moveButton=new s({value:C.information.header.move,className:"primary",disabled:!0,events:{onClick:function(){y.issues.update({data:{objects:[{physicalId:t.physicalIds[0],responsibleOrganization:t.values.responsibleOrganization}]},onComplete:function(e){S.displayNotification({msg:C.information.header.moveOrgMsg,eventID:"info"}),o.value=t.values.responsibleOrganizationTitle,t.IssueIDCard.modelEvents.publish({event:"issue-idcard-responsibleOrg-update",data:{}})},onFailure:function(e){if(e.error&&(e.error.internal.includes("You do not have the permissions to perform this action")||e.error.internal.includes("The issue is closed, you cannot update it"))){var t=u.getErrorMessage("1500167_2");u.displayErrorMessage(t,"error")}else S.displayNotification({msg:e.error.message,eventID:"error"})}}),setTimeout((function(){e.destroy(),e=null}),100)}}}),new s({value:C.information.header.cancel,className:"default",events:{onClick:function(){setTimeout((function(){e.destroy(),e=null}),100)}}})],events:{onClose:function(){setTimeout((function(){e.destroy(),e=null}),100)}}}).inject(widget.body),t._setOrganization(o.value,"responsibleOrganization",!1),t.fields.responsibleOrganization.responsibleOrganizationHelper.tooltipInfos=new i({shortHelp:D.create.team.labels.responsibleOrganizationHelper})},changeReportingOrg:function(){var e,t=this;t.moveButton;var o=t.IssueIDCard.model.get("attributes").find((e=>"reportingOrg"==e.id));e=new c({animate:!0,autocenter:!0,closable:!0,limitParent:!0,overlay:!0,resizable:!0,visible:!0,className:"confirm-select-in-3d-dialog",title:C.information.header.moveReportingOrg,header:null,body:n.createElement("div",{class:"idcard-form-element idcard-form-element-responsible-organization",html:[{tag:"div",class:"idcard-form-field form-group",html:[{tag:"h5",html:C.information.header.changeReportingOrg},{tag:"div",html:[t.fields.addReportingOrganization=t._orgSearch("reportingOrganization"),t.fields.reportingOrganization=n.createElement("div",{class:"idcard-responsible-organization-holder"}),t.fields.reportingOrganization.reportingOrganizationHelper=n.createElement("div",{html:[n.createElement("span",{class:"fonticon fonticon-help"})]})]}]},{tag:"div",class:"idcard-form-help-tooltip",html:[t.fields.reportingOrganization.reportingOrganizationHelper]}]}),footer:[t.moveButton=new s({value:C.information.header.move,className:"primary",disabled:!0,events:{onClick:function(){y.issues.update({data:{objects:[{physicalId:t.physicalIds[0],reportingOrganization:t.values.reportingOrganization}]},onComplete:function(e){S.displayNotification({msg:C.information.header.moveReportingOrgMsg,eventID:"info"}),o.value=t.values.reportingOrganizationTitle,t.IssueIDCard.modelEvents.publish({event:"issue-idcard-reportingOrg-update",data:{}})},onFailure:function(e){S.displayNotification({msg:e.error.message,eventID:"error"})}}),setTimeout((function(){e.destroy(),e=null}),100)}}}),new s({value:C.information.header.cancel,className:"default",events:{onClick:function(){setTimeout((function(){e.destroy(),e=null}),100)}}})],events:{onClose:function(){setTimeout((function(){e.destroy(),e=null}),100)}}}).inject(widget.body),t._setOrganization(o.value,"reportingOrganization",!1),t.fields.reportingOrganization.reportingOrganizationHelper.tooltipInfos=new i({shortHelp:D.create.team.labels.reportingOrganizationHelper})},_orgSearch:function(e){var t=this,n=new v({className:"searchPeople_TransferOwnership",MaxNumber:"5",MaxSize:"300",position:"auto",showEmptyCategory:!1,type:I.TYPE_ORGANIZATION,events:{onValid:function(){var s=n.getNewOwner().organization;t._setOrganization(s.orgID,e,s.orgTitle,!0),n.clearInput(),n.getContent().searchInput.focus()},onUnvalid:function(){},onError:function(){S.displayNotification({msg:D.team.error.orgNotFound,eventID:"info"})}}});return y.organizations.getCompanies({onComplete:function(e){t.organizations=e.body,n.setSelectedItemList([{objectID:t.organizations[0].physicalId}])},onFailure:function(){t.organizations=[]}}),n},_setOrganization:function(e,t,s,i){var o=this;if(!n.is(s)||""==s){s=e;var a=b.get(T.BASE_NLS);n.is(a)&&n.is(a["ds6w:organizationResponsible"][e])&&(s=a["ds6w:organizationResponsible"][e])}var r=n.createElement("div",{class:"idcard-content-org-container",html:[n.createElement("span",{class:"idcard-content-org-icon fonticon view-icon fonticon-users"}),n.createElement("span",{class:"idcard-content-org-info",html:u.getTextFromHTML(s)})]});i&&o.moveButton.setDisabled(!1),o.fields[t].empty(),o.fields[t].appendChild(r),"responsibleOrganization"==t?(o.values.responsibleOrganization=e,o.values.responsibleOrganizationTitle=s):"reportingOrganization"==t&&(o.values.reportingOrganization=e,o.values.reportingOrganizationTitle=s)},updateObjectNode:function(e){var t=b.get("component").getSelectedNodes(),s=[];e.forEach((e=>{null!=e.policy&&(e.maturity=e.policy+"."+e.state,s.push(e.maturity))}));var i={"ds6w:status":s};y.getNLSValuesPromise(i).then((s=>{if(n.is(s["ds6w:status"])){var i=Object.values(s["ds6w:status"])[0],o=Object.keys(s["ds6w:status"])[0];t.filter((t=>e.some((e=>t.options.physicalId.includes(e.physicalid))))).forEach((e=>{e.updateOptions({state:o,grid:{"ds6w:state":i}})}))}}))}})})),define("DS/IssueManagement/components/information/Information",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/ENOjquery/ENOjquery","DS/ENOjqueryUI/jQueryUI","DS/Logger/Logger","DS/CoreEvents/ModelEvents","DS/IssueManagement/components/information/Content","DS/IssueManagement/components/information/IssueHeader","DS/IssueManagement/components/information/Header","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","DS/IssueManagement/components/header/IssueToolbarActions","i18n!DS/IssueManagement/assets/nls/IssueManagement"],(function(e,t,n,s,i,o,a,r,l,c,d,u,p,m){"use strict";var g=!0,f="Issue",h={RIGHT:"right",BOTTOM:"bottom",CLOSED:"closed"},v={ELEMENTS:{INNER:"im-information-inner",NO_SELECTION_PLACEHOLDER:"im-information-no-selection-placeholder",FULLSCREEN_INDICATOR_RESIZING:"im-information-fullscreen-indicator-resizing",NO_SELECTION_PLACEHOLDER_TEXT:"im-information-no-selection-middleText"},LAYOUTS:{RIGHT:"layout-right",BOTTOM:"layout-bottom",CLOSED:"layout-closed"},DIMENSIONS:{RIGHT_LAYOUT:{DEFAULT_WIDTH:430,MIN_WIDTH:430},BOTTOM_LAYOUT:{DEFAULT_HEIGHT:400,MIN_HEIGHT:400},MINIMUM_REMAINING_HEIGHT:75,MINIMUM_REMAINING_WIDTH:260,MVHAW:260},STATUS:{NO_SELECTION:"no-selection",MULTI_SELECTION:"multi-selection"}};return t.extend({name:"DS/IssueManagement/components/information/Information",tagName:"div",className:"im-information-component",_logger:null,layout:{current:h.RIGHT,width:v.DIMENSIONS.RIGHT_LAYOUT.DEFAULT_WIDTH,height:v.DIMENSIONS.BOTTOM_LAYOUT.DEFAULT_HEIGHT},elements:{inner:null,placeholder:null},physicalIds:[],resizer:null,header:null,content:null,fullscreenWidth:!1,fullScreenMode:!1,_isOpened:!1,_subscriberId:"",_subscriberTokens:[],previousPhysicalIds:[],setup:function(e){var t=this;u.start(t.name+" setup"),t._parent(e),t._logger=o.getLogger(t.name);var n=t.getPreferences();n.current!==h.RIGHT&&n.current!==h.BOTTOM&&(n.current=h.RIGHT,t.setPreferences({current:n.current})),t._isOpened=n.isOpened||!1,t.layout={current:n.current||h.RIGHT,isOpened:t.isOpened,width:n.width||v.DIMENSIONS.RIGHT_LAYOUT.DEFAULT_WIDTH,height:n.height||v.DIMENSIONS.BOTTOM_LAYOUT.DEFAULT_HEIGHT},t.elements={inner:null,placeholder:null},t.physicalIds=[],t.resizer=null,t._subscriberId=Math.random().toString(36).substr(2,9),t._subscriberTokens=[],t._subscribers(),u.end(t.name+" setup")},render:function(e){var t=this;return t._applicationChannel=e,u.start(t.name+" render"),t.elements.inner=n.createElement("div",{class:v.ELEMENTS.INNER}),t.elements.inner.inject(t.container),t.elements.placeholder=t.utils.placeholder.bind(t)(),t.elements.placeholder.inject(t.elements.inner),t.customModelEvents=new a,t.header=g?new l({customEvents:t.customModelEvents}):new c({customEvents:t.customModelEvents}),t.header.render().inject(t.elements.inner),t._listenToHeader(),t.content=new r({customEvents:t.customModelEvents}),t.content.render().inject(t.elements.inner),t.container.toggleClassName(v.STATUS.NO_SELECTION,!0),t.container.toggleClassName(v.STATUS.MULTI_SELECTION,!1),t._resizable(),u.end(t.name+" render"),t},refreshInfo:function(e,t){widget.setValue("infoIsOpened",!0);var n=this;e&&(n.physicalIds=e);var s=1==t,i=n.content.getCurrentFacet().name;(widget.getValue("isOpened")&&!function(){if(n.previousPhysicalIds.length!==n.physicalIds.length)return!1;for(var e=0;e<n.previousPhysicalIds.length;e++)if(!1===n.physicalIds.includes(n.previousPhysicalIds[e]))return!1;return!0}()||widget.getValue("isOpened")&&"properties"==i||widget.getValue("isOpened")&&1==s)&&(n.refresh(n.physicalIds),n.resize(),n.previousPhysicalIds=n.physicalIds)},refresh:function(t){var n=this;Array.isArray(t)&&(n.physicalIds=t),n.container.toggleClassName(v.STATUS.NO_SELECTION,0===n.physicalIds.length),n.container.toggleClassName(v.STATUS.MULTI_SELECTION,n.physicalIds.length>1);var s=[n.header.refresh(n.physicalIds),n.content.refresh(n.physicalIds,{force:!0})];return e.all(s).then((function(){n.dispatchEvent("onRefresh")}))},resize:function(){var e=this,t=e.container.getParent();if(e.container&&t){var n=t.getElementsByClassName("im-layout")[0],s=document.getElementsByClassName("im-information-component")[0];if(e.layout.current===h.RIGHT)s.addClassName("im-right"),setTimeout((()=>{var t=e.container.offsetWidth;widget.setValue("infoPanelWidth",t)}),500);else if(e.layout.current===h.BOTTOM){s.removeClassName("im-right");var i=e.container.offsetHeight,o=t.offsetHeight;widget.setValue("infoPanelHeight",i),widget.body.offsetHeight>=v.DIMENSIONS.MVHAW&&i>o-v.DIMENSIONS.MINIMUM_REMAINING_HEIGHT?(e.container.setStyle("height",o-v.DIMENSIONS.MINIMUM_REMAINING_HEIGHT),n.setStyle("bottom",o-v.DIMENSIONS.MINIMUM_REMAINING_HEIGHT)):n.setStyle("bottom",i),e.container.style.top=""}e.header.resize(),e.content.resize(),p.resize(),d.get("component").resize()}},destroy:function(){var e=this;e._subscriberTokens.forEach((function(e){d.get("eventsHandler").unsubscribe(e)})),e._subscriberTokens=[],e._subscriberId="",e.layout={current:h.RIGHT,isOpened:!1,width:v.DIMENSIONS.RIGHT_LAYOUT.DEFAULT_WIDTH,height:v.DIMENSIONS.BOTTOM_LAYOUT.DEFAULT_HEIGHT},e.elements={inner:null,placeholder:null},e.physicalIds=[],e.resizer=null,e.header.destroy(),e.header=null,e.content.destroy(),e.content=null,e.container.empty()},setLayout:function(e){var t=this;e!==h.RIGHT&&e!==h.BOTTOM||(t.layout.current=e,t.setPreferences({current:e}),widget.getValue("isOpened")&&t.open())},open:function(e){var t=this,n=t.container.getParent(),s=t.getPreferences();if(widget.getValue("isOpened")&&s.current!=widget.getValue("currentLayout"))return widget.setValue("infoPanelLayout",widget.getValue("currentLayout")),widget.setValue("isOpened",!1),widget.setValue("fromLayoutChange",!0),t._applicationChannel.publish({event:"information-panel-close"}),widget.setValue("infoPanelLayout",s.current),void t._applicationChannel.publish({event:"information-panel-open"});if(t.layout.current===h.RIGHT)widget.setValue("isOpened",!0),widget.setValue("currentLayout","right");else if(t.layout.current===h.BOTTOM){if(widget.setValue("isOpened",!0),t.layout.height=s.height||v.DIMENSIONS.BOTTOM_LAYOUT.DEFAULT_HEIGHT,t.container.setStyles({width:"100%",height:t.layout.height}),n){n.addClassName(v.LAYOUTS.BOTTOM);var i=n.getElementsByClassName("im-layout")[0];null==i&&null==i||(i.addClassName("im-right-layout-closed"),i.setStyle("right",0),i.removeClassName("im-bottom-layout-closed"))}widget.setValue("currentLayout","bottom"),widget.setValue("infoPanelLayout","bottom"),widget.getValue("isOpened")&&t._applicationChannel.publish({event:"information-panel-visible",data:null})}t._isOpened=!0,t.resize(),t.makeSelectedFacetVisible(),widget.getValue("contentFacet")&&(t.switchFacet("relatedObjects"),widget.setValue("contentFacet",!1)),t.setPreferences({isOpened:!0}),t._applicationChannel.subscribe({event:"resize-summary-view"},(function(){setTimeout((()=>{t.content.resize(),d.get("component").resize()}),320)}));var o=document.getElementsByClassName("im-information-content")[0];!0===widget.getValue("isIDCardCollapsed")?o&&o.addClassName("minified"):o&&o.removeClassName("minified")},close:function(e){var t=this,n=t.container.getParent(),s=n.getElementsByClassName("im-layout")[0];null==s&&null==s||(s.addClassName("im-right-layout-closed"),s.addClassName("im-bottom-layout-closed"),s.setStyle("right",0),s.setStyle("bottom",0)),t.container.setStyles({width:0,height:0}),n.addClassName(v.LAYOUTS.CLOSED),t.layout.width=0,t.layout.height=0,t._isOpened=!1,d.get("component").resize(),p.resize(),t.setPreferences({isOpened:!1}),widget.setValue("isOpened",!1),t._applicationChannel.publish({event:"triptych-panel-hidden",data:"right"})},toggle:function(e,t){var n=this;widget.getValue("fromDataGridDoubleClick")&&(widget.setValue("fromDataGridDoubleClick",!1),widget.getValue("isOpened")?widget.getValue("isOpened")&&!widget.getValue("contentFacet")?n._applicationChannel.publish({event:"information-panel-close"}):widget.getValue("isOpened")&&widget.getValue("contentFacet")&&n.switchFacet("relatedObjects"):n._applicationChannel.publish({event:"information-panel-open"})),0==e&&1==t&&n._applicationChannel.publish({event:"information-panel-close"})},switchFacet:function(e){return this.content.switchFacet(e)},setPreferences:function(e){var t=d.get("widget")||window.widget;e&&n.is(e.isOpened,"boolean")&&t.setValue("infoIsOpened",e.isOpened),e&&n.is(e.current,"string")&&t.setValue("infoLayout",e.current),e&&n.is(e.width,"number")&&t.setValue("infoLayoutRightWidth",e.width),e&&n.is(e.height,"number")&&t.setValue("infoLayoutBottomHeight",e.height)},getPreferences:function(){var e=d.get("widget")||window.widget;return{current:n.is(e.getValue("infoLayout"),"string")?e.getValue("infoLayout"):h.RIGHT,isOpened:!!n.is(e.getValue("infoIsOpened"),"boolean")&&e.getValue("infoIsOpened"),width:e.getValue("infoLayoutRightWidth"),height:e.getValue("infoLayoutBottomHeight")}},getLayout:function(){return this.layout},getInformationHeader:function(){return this.header},getInformationContent:function(){return this.content},isOpened:function(){return this._isOpened},_resizable:function(){var e=this;e.resizer=s(e.container).resizable({handles:"n, w",helper:"ui-resizable-helper-information-left",minWidth:v.DIMENSIONS.RIGHT_LAYOUT.MIN_WIDTH,minHeight:v.DIMENSIONS.BOTTOM_LAYOUT.MIN_HEIGHT,start:function(t,i){if(e.fullScreenMode=!1,e.layout.current===h.RIGHT){var o=document.querySelector(".ui-resizable-helper-information-left");o&&(o.getElementsByClassName(v.ELEMENTS.FULLSCREEN_INDICATOR_RESIZING).length||(e.elements.fullscreenIndicator=n.createElement("div",{class:v.ELEMENTS.FULLSCREEN_INDICATOR_RESIZING}),n.createElement("span",{class:"fonticon fonticon-2x fonticon-move-to-start"}).inject(e.elements.fullscreenIndicator),e.elements.fullscreenIndicator.inject(o))),i.helper[i.helper.length-1].setAttribute("class","ui-resizable-helper-information-left");var a=e.container.getParent().offsetWidth;s(e.container).resizable("option","maxWidth",a)}else if(e.layout.current===h.BOTTOM){i.helper[i.helper.length-1].setAttribute("class","ui-resizable-helper-information-top");var r=e.container.getParent().offsetHeight;s(e.container).resizable("option","maxHeight",r-v.DIMENSIONS.MINIMUM_REMAINING_HEIGHT)}e.container.getParent().addClassName("information-panel-resizing")},resize:function(t){if(e.layout.current===h.RIGHT){e.fullscreenWidth=!!e.fullScreenMode||t.clientX>=0&&t.clientX<=260;var n=document.querySelector("."+v.ELEMENTS.FULLSCREEN_INDICATOR_RESIZING);n&&n.toggleClassName("visible",e.fullscreenWidth)}},stop:function(t,n){e.container.getParent().removeClassName("information-panel-resizing"),e.layout.current===h.RIGHT?(e.layout.width=n.size.width,e.setPreferences({width:e.layout.width})):e.layout.current===h.BOTTOM&&(e.layout.height=n.size.height,e.setPreferences({height:e.layout.height})),e.resize()}})},_subscribers:function(){var e=this,t=d.get("eventsHandler");e._subscriberTokens.push(t.subscribe(e._subscriberId,"DS/Object/select",(function(t){var n=Object.keys(t.data.attributes),s=[];t.metadata.appId!==widget.id&&(s=0===n.length&&e.physicalIds?e.physicalIds:[]);var i=d.get("component");if(i._tasks&&i._tasks.current&&i._tasks.current.taskType&&"SELECT_IN_3D"===i._tasks.current.taskType)return!1;var o=i.getTreeDocument();if(n.forEach((function(e){var t=o.getNodesById(e);t.length>0&&t.filter((e=>e.options.baseType===f)).length>0&&s.push(e)})),n.length>0&&0===s.length)return!1;e.physicalIds=s}))),e._subscriberTokens.push(t.subscribe(e._subscriberId,"DS/Object/delete",(function(t){for(var s=Object.keys(t.data.attributes),i=n.clone(e.physicalIds),o=0;o<s.length;o++){var a=i.indexOf(s[o]);-1!==a&&i.splice(a,1)}e.physicalIds.length!==i.length&&e._isOpened&&e.refresh(i)})))},makeSelectedFacetVisible:function(){var e=this.content.views.facets[[this.content.views.current]];null!=e.instance&&e.instance.container.addClassName("visible")},_listenToHeader:function(){var e=this;e.listenTo(e.header,"request:switchFacet",(function(t){var s=e.switchFacet(t.facetName);n.is(t.callback,"function")&&s.then(t.callback)})),e.listenTo(e.header,"request:resizeContent",(function(e){}))},utils:{placeholder:function(){var e=this;return n.createElement("div",{class:v.ELEMENTS.NO_SELECTION_PLACEHOLDER,html:[n.createElement("span",{class:"wux-ui-3ds-close wux-ui-3ds closeIcon",title:"close",events:{click:function(){e.closeIDCard()}}}),n.createElement("div",{class:v.ELEMENTS.NO_SELECTION_PLACEHOLDER_TEXT,html:[n.createElement("span",{class:"fonticon fonticon-5x fonticon-info"}),n.createElement("span",{class:"no-selection-placeholder-label",html:m.information.views.noSelection})]})]})}},closeIDCard:function(){this._applicationChannel.publish({event:"information-panel-close"})}})})),define("DS/IssueManagement/components/welcomePanel/view/ApplicationFrame",["UWA/Class","DS/IssueManagement/components/welcomePanel/view/TriptchWrapper","DS/IssueManagement/components/welcomePanel/view/TopBarWrapper","css!DS/UIKIT/UIKIT.css","css!DS/IssueManagement/IssueManagement.css"],(function(e,t,n){"use strict";return e.extend({initialize:function(e,t,n,s){this._applicationChannel=e,this._router=t,this._leftContent=n,this._middleContent=s,this.render()},render:function(){var e=this;e.createTopBarParent(),e.createMainContainer(),e.initializeTopBarWrapper(),e.initializeTriptychWrapper(),e.createMiddleContainer(),this._middleContainer.appendChild(this._topbar),e.addSummaryViewInMainContainer(),this._applicationChannel.publish({event:"triptych-set-content",data:{side:"middle",content:this._middleContainer}}),this._subscribeEvents(),e.setMobileBreakPoint()},_subscribeEvents:function(){var e=this;e._listSubscription=[],e._listSubscription.push(e._applicationChannel.subscribe({event:"triptych-show-panel"},(function(t){e._mainContainer.clientWidth<e.__mobileBreakpoint&&e._mainContainer.classList.add("full-height")}))),e._listSubscription.push(e._applicationChannel.subscribe({event:"triptych-panel-hide-started"},(function(t){e._mainContainer.clientWidth<e.__mobileBreakpoint&&e._mainContainer.classList.remove("full-height"),e._applicationChannel.publish({event:"model-conflict-panel-closed"});var n=document.querySelector("#taskViewPanelClose");n&&n.click();var s=document.querySelectorAll(".isu-triptych-wrapper");e.infoDialog=s;var i=s[0].childNodes;if("right"===t)for(var o=0;o<i.length;o++){var a=i[o].getAttribute("name");UWA.is(a)&&"EditProp_MasterContain"===a?i[o].style.display="block":i[o].style.display="none"}}))),e._listSubscription.push(e._applicationChannel.subscribe({event:"triptych-entering-mobile"},(function(){e._mainContainer.classList.remove("full-height"),e._applicationChannel.publish({event:"triptych-hide-panel",data:"left"})}))),e._listSubscription.push(e._applicationChannel.subscribe({event:"triptych-resized"},(function(e){if("right"===e.side)e.width}))),e._listSubscription.push(e._applicationChannel.subscribe({event:"triptych-leaving-mobile"},(function(){e._mainContainer.classList.remove("full-height"),widget.getValue("isOpened")&&"bottom"==widget.getValue("currentLayout")&&e._applicationChannel.publish({event:"information-panel-close"}),e._applicationChannel.publish({event:"triptych-show-panel",data:"left"})}))),e._listSubscription.push(e._applicationChannel.subscribe({event:"welcome-panel-action-selected"},(function(t){e._mainContainer.clientWidth<e.__mobileBreakpoint&&e._applicationChannel.publish({event:"triptych-hide-panel",data:"left"})})))},inject:function(e){e.appendChild(this._mainContainer)},destroy:function(){this._content=null},createTopBarParent:function(){this._topbar=UWA.createElement("div",{id:"isu-toolbar"}),this._topbar.classList.add("isu-topbar")},initializeTopBarWrapper:function(){this._pageToolBarComponent=new n,this._pageToolBarComponent.initialize(this._applicationChannel,this._router,this._topbar)},initializeTriptychWrapper:function(){this._triptychWrapper=new t,this._triptychWrapper.init(this._applicationChannel,this._mainContainer)},createMainContainer:function(){this._mainContainer=document.createElement("div"),this._mainContainer.classList.add("isu-content")},createMiddleContainer:function(){this._middleContainer=document.createElement("div"),this._middleContainer.classList.add("isu-maincontainer")},addSummaryViewInMainContainer:function(){this._applicationContent=document.createElement("div"),this._applicationContent.classList.add("isu-content-wrapper"),this._middleContainer.appendChild(this._applicationContent),this._middleContent&&this._middleContent._container&&this._applicationContent.appendChild(this._middleContent._container)},setMobileBreakPoint:function(){this.__mobileBreakpoint=this._triptychWrapper._triptych.__mobileBreakpoint}})})),define("DS/IssueManagement/IssueManagement",["UWA/Class","UWA/Class/Promise","UWA/Core","DS/CoreEvents/ModelEvents","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Migration","DS/IssueServices/utils/Performance","DS/IssueServices/utils/Support","DS/IssueCommon/utils/Utils","DS/IssueComponents/utils/Utils","DS/IssueComponents/templates/TemplatesDataGridLayout_V2","DS/WidgetServices/WidgetServices","DS/PlatformAPI/PlatformAPI","DS/IssueManagement/components/welcomePanel/view/WelcomePanelWrapper","DS/IssueManagement/components/welcomePanel/view/ApplicationFrame","DS/IssueManagement/components/welcomePanel/view/GlobalConfig","DS/IssueManagement/components/welcomePanel/router/Router","DS/IssueManagement/components/welcomePanel/router/RouteConfig","DS/PADUtils/views/PADAlert","i18n!DS/IssueComponents/assets/nls/IssueComponents","DS/Windows/ImmersiveFrame","DS/WebUAUtils/WebUAUtils","DS/IssueTracker/IssueTracker","DS/IssueManagement/views/dragAndDrop/DragAndDropView","text!DS/IssueManagement/assets/Settings.json","i18n!DS/IssueManagement/assets/nls/IssueManagement","css!DS/IssueManagement/IssueManagement.css"],(function(e,t,n,s,o,a,r,l,c,d,u,p,m,g,f,h,v,I,b,y,w,S,C,D,T,E,A,_){"use strict";var M="ENXISSU_AP",N="ENX3DIR_AP",x="Issue",O="X3DContentId",P="XNotifContentId",V="XTemplateContentId",k="XSharedContentId",L="PLMNewEnablement",R="IssueTemplatesEnabled",U="PaginationEnabled",F="TemplateCustomAttrMandEnablement",B={DIMENSIONS:{MINIMUM_INFORMATION_WIDTH:430,MINIMUM_COMPONENT_WIDTH:260}},j=function(){for(var e='<div class="issue-list-placeholder-header"></div>',t=0;t<=50;t++)e+='<div class="issue-list-placeholder-line"></div>';return n.createElement("div",{class:"issue-list-placeholder fade-out-element",html:[n.createElement("div",{class:"issue-list-placeholder-actions",html:'<div class="issue-list-placeholder-action"></div><div class="issue-list-placeholder-action"></div><div class="issue-list-placeholder-action"></div><div class="issue-list-placeholder-action-divider"></div><div class="issue-list-placeholder-action"></div><div class="issue-list-placeholder-action"></div><div class="issue-list-placeholder-action-divider"></div><div class="issue-list-placeholder-action"></div><div class="issue-list-placeholder-action"></div><div class="issue-list-placeholder-action-divider"></div><div class="issue-list-placeholder-action"></div><div class="issue-list-placeholder-action"></div>'}),n.createElement("div",{class:"issue-list-placeholder-lines",html:e})]})},W=function(e){return n.createElement("div",{class:"placeholder-loading-container",html:[n.createElement("div",{class:"placeholder-loading",html:[n.createElement("div",{class:"pin",html:'<span class="fonticon fonticon-5x fonticon-issue-type"></span>'}),n.createElement("div",{class:"pulse"}),n.createElement("span",{class:"placeholder-loading-label saving",html:[e.NLS,{tag:"span",html:"."},{tag:"span",html:"."},{tag:"span",html:"."}]}),n.createElement("div",{class:"placeholder-loading-sub-container",html:[]})]}),n.createElement("div",{class:"placeholder-loading-background",html:""})]})},H=function(e){return n.createElement("div",{class:"loading-error-container",html:n.createElement("div",{class:"loading-error",html:[n.createElement("div",{class:"loading-error-icon",html:n.createElement("span",{class:"fonticon fonticon-5x fonticon-attention"})}),n.createElement("div",{class:"loading-error-label",html:e.label}),n.createElement("div",{class:"loading-error-sub-label",html:e.sub})]})})},z=e.extend({name:"DS/IssueManagement/IssueManagement",actionBar:null,filter:null,status:null,component:null,elements:{container:null,header:null,body:null,footer:null},isLoaded:null,isStandalone:!1,_deferred:{resolve:null,reject:null},_isDOMLoaded:!1,_placeholder:null,_loading:null,_isResizing:!1,initHome:function(e){var t=this;this._welcomePanelComponent=new h,this._immersiveFrame=new C({}),this._applicationContainer=n.createElement("div"),n.extendElement(this._applicationContainer),widget.body.setContent(this._applicationContainer),this._immersiveFrame.inject(this._applicationContainer);var s=n.Element("div",{class:"isu-ua-panel-help-container"});s.inject(this._applicationContainer);var i=new C;i.inject(s),D.setPanelHelpMode({immersiveFrame:i}),this._ApplicationFrame=new v,this._ApplicationFrame.initialize(t._applicationChannel,b,this._welcomePanelComponent),this._immersiveFrame.setContentInBackgroundLayer(this._ApplicationFrame),this.infoPanel=this._ApplicationFrame._triptychWrapper.getRightPanelContainer(),this._welcomePanelComponent.init(t._applicationChannel,b,this._ApplicationFrame._triptychWrapper.getLeftPanelContainerTriptych()),t._applicationChannel.publish({event:"triptych-set-size",data:{side:"left",size:I.LEFT_PANEL_SIZE_EXPANDED}}),b.start("/home")},init:function(e){var i=this;y.initialize();var a={name:"appChannelModleEvent"};i._applicationChannel=new s(a),b.setDependency("applicationChannel",i._applicationChannel),b.setDependency("issueApp",this),i.initHome(e),o.add("widget",window.widget),o.add("isNatifEnvironnement",g.isNatifEnvironnement()),o.get("widget").name=M,o.add("application",i),o.add("CustomAttributesPredicates",{}),_.summaryview&&_.summaryview,o.add("ISU_LISTVIEW",!1),i.component=null,i.actionBar=null,i.filter=null,i.status=null,i.elements={container:null,header:null,body:null,footer:null},i.isStandalone=!1,n.is(e,"object")&&(i.isStandalone=e.standalone||!1),i.isLoaded=new t((function(e,t){i._deferred.resolve=e,i._deferred.reject=t})),i._isDOMLoaded=!1,i._placeholder=j(),i._isResizing=!1,i.settings=JSON.parse(A),i.settings.switchToModelerAPIsForLoading?o.add("LoadData_ModelerAPI",!0):o.add("LoadData_ModelerAPI",!1),i._subscribers()},onLoad:function(){var e=this;c.start(e.name+" onLoad");var t=document.getElementsByClassName("triptych-main")[0];e._placeholder.inject(t),e._placeholder.removeClassName("fade-out-element").addClassName("fade-in-element"),widget.getValue("IsIssueSummaryView")?e._loading=W({NLS:_.issueSummaryLoading}):e._loading=W({NLS:_.templateSummaryLoading}),u.Mask.mask(widget.body),e.resizeTriptychInfoIcon();try{d.checkBrowserSupport()}catch(e){}if(!l.isUpToDate())return e._loading.destroy(),e._loading=null,u.Mask.unmask(widget.body),void l.upgrade();o.get("widget").body.addEventListener("drop",(function(e){e.preventDefault(),e.stopPropagation()}));require(["DS/MSFDocumentManagement/WidgetIntegration"],(function(e){o.get("widget").MSFDocumentClient=e,o.get("widget").MSFDocumentClient.ConnectWidgetWithMSF()})),a.initPlatformServices().then((function(){e.initialize().then((function(){f.subscribe("DS/PADUtils/PADCommandProxy/select",e.onSelect.bind(e)),c.end(e.name+" onLoad"),e._deferred.resolve()}),(function(t){c.end(e.name+" onLoad"),e._deferred.reject(t);var n=e.utils.getNLSMsg(t);o.get("widget").body.appendChild(H(n)),"Oops! Something went wrong."===n.label&&e.utils.error(t)}))}))},initialize:async function(e){var t=this;t.setPreferences();var n=a.getCurrentCredentials();o.get("widget").setValue("xPref_CREDENTIAL",n.role+"."+n.organization+"."+n.collaborativeSpace);let s=await r.preferences.getServerSettings({});return s.body&&(o.add(L,s.body.IssueCreationByPLMNew),o.add(R,s.body.IssueNewTemplate),o.add(U,s.body.pagination),o.add(F,s.body.customAttrMandatoryInTemplate)),t.initializeTriptychMainContainer(),t.initializeTriptychToolbarContainer(),await t._initializeComponent({})},onSelect:function(e){if(!widget.getValue("xHighlightFlag")){var t=this;if(e.metadata&&e.metadata.originWidgetId===widget.id)return;if(e.metadata&&e.metadata.originWidgetId)var s=e.metadata.appid;var i=[],a=[],l=[],c=t.component.getSelectedNodes(),d=o.get("ISU_TYPE_NLS");n.is(d["ds6w:type"])&&(i=Object.keys(d["ds6w:type"]));var u=e.data.paths;if(u.length>0){var p,m=[];u.forEach((function(e){p=e[0],a.push(p);var t={physicalId:p};m.push(t)})),r.fetch({data:{objects:m},onComplete:function(e){var n=e.body;if(n.results&&n.results.length>0){var a="";n.results.forEach((function(e){var n=o.get("filter").parseFetchAttributes(e);a=n.type;var r=n.id;i.includes(a)&&s.includes(N)||i.includes(a)&&widget.getValue("isOpened")?l=t.selectNode(a,r,c,i):widget.getValue("isOpened")||s.includes(N)||(l=t.selectNode(a,r,c,i)),c=[]})),require(["DS/IssueManagement/commands/CommandsManager"],(function(e){l.length>0?(widget.getValue("infoIsOpened")?(o.get("information").refreshInfo(l),o.get("actionBar").updatePanelToggle(),o.get("application").updateHeaderToggle()):o.get("information").physicalIds=l,e.select(t.component.getSelectedNodes())):(i.includes(a)&&widget.getValue("isOpened")||!widget.getValue("isOpened"))&&(o.get("information").physicalIds=[],o.get("information").refreshInfo())}))}}})}}},setPreferences:function(){try{d.checkSwymSupport()}catch(e){}var e=a.getSecurityContexts(),t=a.getTenants();return this._setPreferences({securityContexts:e,tenants:t})},onRefresh:function(e){var t=this,n=void 0!==e,s=o.get("widget")||window.widget;let i=s.getValue("filter");i=JSON.parse(i);let r=!1;if((i.reported||i.responsible)&&!0,s.getValue("IsIssueSummaryView")||null==s.getValue("IsIssueSummaryView")||null==s.getValue("IsIssueSummaryView")){if(null!==t.component)o.get("LoadData_ModelerAPI")?t.component.refresh_New(n):t.component.refresh(n);if(null!==t.information&&t.information.refreshInfo(void 0,!0),void 0!==s.getValue("xPref_CREDENTIAL")){var l=a.getCurrentCredentials();s.setValue("xPref_CREDENTIAL",l.role+"."+l.organization+"."+l.collaborativeSpace)}}else t.Templatecomponent.refreshTemplateList()},onResize:function(){var e=this;e._isResizing=!1,!1!==e._isDOMLoaded&&(e._placeholder.removeClassName("fade-in-element").addClassName("fade-out-element"),e._placeholder.removeClassName("resizing"),e.elements.container.removeClassName("fade-out-element").addClassName("fade-in-element"),e.resize())},endEdit:function(){this.component.publishPreferences()},onDestroy:function(){var e=this;null!==e.actionBar&&e.actionBar.destroy(),e.actionBar=null,o.remove("actionBar"),null!==e.filter&&e.filter.destroy(),e.filter=null,o.remove("filter"),null!==e.status&&e.status.destroy(),e.status=null,o.remove("status"),null!==e.component&&e.component.destroy(),e.component=null,o.remove("component"),null!==e.information&&e.information.destroy(),e.information=null,o.remove("information"),e.elements.container.destroy(),e.elements.header.destroy(),e.elements.body.destroy(),e.elements.footer.destroy(),e.elements={container:null,header:null,body:null,footer:null},o.remove("application"),o.remove("widget"),e._isDOMLoaded=!1},onTitleChange:function(){},onSetPathTags:function(){this.component.setLocalPathTags()},resize:function(){var e=this,t=o.get("widget")||window.widget;null!==e.actionBar&&e.actionBar.resize(),t.body.offsetWidth>B.DIMENSIONS.MINIMUM_INFORMATION_WIDTH+B.DIMENSIONS.MINIMUM_COMPONENT_WIDTH?(null!==e.information&&(e.information.fullScreenMode||(e.information.fullscreenWidth=!1),e.information.resize()),null!==e.component&&(e.component.container.show(),e.component.resize()),e.elements.header):null!==e.information&&(e.information.fullscreenWidth=!0,e.information.resize()),null!==e.component&&e.component.resize()},getActions:function(){return this.actionBar},getInformation:function(){return this.information},getComponent:function(){return this.component},updateHeaderToggle:function(){},_initializeComponent:function(e){var n=this,s=o.get("widget")||window.widget,i=null,a=null,r=null,l=null,c=null,d=null,u=null,p=null;return new t((function(e){require(["UWA/Core","DS/IssueManagement/commands/CommandsManager","DS/IssueManagement/Component_V2","DS/IssueManagement/components/footer/Status","DS/IssueManagement/components/header/ActionBar","DS/IssueManagement/components/header/ActionBarDataGrid","DS/IssueManagement/components/header/Filter","DS/IssueManagement/components/information/Information","DS/IssueCommon/utils/EventsHandler"],(function(t,n,s,o,m,g,f,h,v){i=t,a=n,r=s,u=o,m,l=g,c=f,d=h,p=v,e()}))})).then((function(){return new t((function(t,s){return n.eventsHandler=new p,o.add("eventsHandler",n.eventsHandler),n.information=(new d).render(n._applicationChannel),o.add("information",n.information),n.filter=(new c).render(),o.add("filter",n.filter),n.component=new r(i.extend(e,{events:{onReady:function(e){t(e)},onRootsAdded:function(){n.destroyPlaceholder(),n.onTitleChange(),0===n.component.getSelectedNodes().length&&a.select()},onRootsRemoved:function(){0===n.component.getTreeDocument().getRoots(!1).length?a.idling():0===n.component.getSelectedNodes().length&&a.select(),n.onTitleChange()},setPathTags:function(){n.onTitleChange(),n.component.publishFilteredIssues()}}})),o.add("component",n.component),n.actionBar=(new l).render(),o.add("actionBar",n.actionBar),n.status=(new u).render(),o.add("status",n.status),n.component.render(),n._initializeIssueTemplateComponent(),n.showHideTemplateView(),n.elements.header=i.createElement("div",{class:"im-header"}),n.elements.body=i.createElement("div",{class:"im-body"}),n.elements.footer=i.createElement("div",{class:"im-footer"}),n.elements.layout=i.createElement("div",{class:"im-layout"}),n.elements.DnDContainer=n.component.container.getElementsByClassName("isu-dragAndDropView")[0],n.actionBar.inject(n.elements.header),n.component.inject(n.elements.layout),n.status.inject(n.elements.footer),n.elements.footer.inject(n.elements.layout),n.elements.layout.inject(n.elements.body),n.elements.layout.addClassName("im-bottom-layout-closed"),"Desktop"==n.media?(n.actionBar.container.addClassName("desktop"),n.elements.layout.addClassName("desktop")):(n.actionBar.container.addClassName("mobile"),n.elements.layout.addClassName("mobile")),n.toogleInformationPanel(),n.elements.container=i.createElement("div",{class:"issue-list"}),n.elements.body.inject(n.elements.container),n.resizeMainComponent(),n.insertIssueSummaryViewInTriptych(),n.addToolbarInTriptychToolBarContainer(),document.getElementsByClassName("triptych-close-right")[0].style.display="none",n.component.build().catch(s)}))})).then((function(e){return new t((function(t){0===e.roots.length?(n.onTitleChange(),a.idling()):a.select();var r=s.getValue("isOpened"),l=i.is(r,"boolean")?r:"true"===r;if(!l){var c=s.getValue(O)?JSON.parse(s.getValue(O)):null;null===c||"ENXISSU_AP"!=c.source&&"X3DSEAR_AP"!=c.source&&!s.data.commentURI||(l=!0,n.information.fullScreenMode=!0,n.information.fullscreenWidth=!0,s.setValue("infoIsOpened",!0),o.get("actionBar").updatePanelToggle())}0===e.roots.length?n.information.toggle(!1,!1):(l&&(e.roots[0].select(),n._applicationChannel.publish({event:"information-panel-open"})),s.data&&s.data.commentURI&&o.get("information")&&o.get("information").content&&(o.get("information").content.refresh(),o.get("information").content.switchFacet("comments"))),s.getValue("isCollapsed")&&n._applicationChannel.publish({event:"welcome-panel-collapse"}),n._subscribeToDNDEvents(),n._isDOMLoaded=!0,n.updateViewAfterLogin(),t()}))})).then((function(){return n.component.onPostInitialize()}))},_setPreferences:function(e){var t=this,s=o.get("widget")||window.widget;if(!0===a.isCloudEnvironment()&&n.is(e.tenants,"object")&&s.addPreference({name:"x3dPlatformId",type:"list",label:_.preferences.tenant,options:e.tenants.platforms,defaultValue:e.tenants.tenant}),n.is(e.securityContexts,"object")){s.addPreference({name:"pad_security_ctx",type:"list",label:_.preferences.securityContext,options:e.securityContexts.cspaces});var i=s.getValue("pad_security_ctx"),r=e.securityContexts.cspaces.findIndex((e=>e.value==i))>=0?i:"";if(""!==r)s.setValue("pad_security_ctx",r);else""!==(e.securityContexts.cspaces.findIndex((t=>t.value==e.securityContexts.securityContext))>=0?i:"")?s.setValue("pad_security_ctx",e.securityContexts.securityContext):Array.isArray(e.securityContexts.cspaces)&&e.securityContexts.cspaces.length>0&&s.setValue("pad_security_ctx",e.securityContexts.cspaces[0].value)}return s.addPreference({name:"myTitle",type:"text",label:_.preferences.name.title,onchange:"onTitleChange",defaultValue:""}),t.settings.hideNoFilterSelectionPreference||s.addPreference({name:"defaultFilterForAll",type:"list",label:_.preferences.defaultFilterForAll.title,options:[{label:_.preferences.defaultFilterForAll.organizationAndProject,value:"organization-project",isDefault:!0},{label:_.preferences.defaultFilterForAll.organization,value:"organization"},{label:_.preferences.defaultFilterForAll.project,value:"project"},{label:_.preferences.defaultFilterForAll.policy,value:"policy"}],defaultValue:"organization-project"}),s.addPreference({name:"organizationFilter",type:"boolean",label:_.preferences.organizationFilter,defaultValue:"false"}),s.addPreference({name:"approaching",type:"range",min:"0",max:"100",label:_.preferences.highlights.soon,defaultValue:"3"}),s.addPreference({name:"activateBIFilter",type:"boolean",label:_.preferences.tagger,defaultValue:"true"}),s.addPreference({name:"filter",type:"hidden",defaultValue:JSON.stringify({owned:!0,assigned:!0,reported:!1,responsible:!1,contributed:!1,closed:!1,session:!1})}),s.addPreference({name:"roots",type:"hidden",defaultValue:[]}),t._computeFilter(),t._computePreferences(),s.getPreferences()},_computeFilter:function(){var e=o.get("widget")||window.widget;try{var t=JSON.parse(e.getValue("filter")),s=e.getValue(k)?JSON.parse(e.getValue(k)):null,i=e.getValue(P)?JSON.parse(e.getValue(P)):null,r=e.getValue(O)?JSON.parse(e.getValue(O)):null,l=[];if(null!==s)l=l.concat(s.issues);else if(null!==i)l=l.concat(i.issues);else if(null!==r){var c=[],d=!1;if(r.data.items.forEach((function(e){(e.objectType===x||e.hasOwnProperty("objectTaxonomies")&&e.objectTaxonomies.includes("Issue"))&&(l.push(e.objectId),c.push(e.envId))})),1===c.length&&c[0]!==a.getTenant()&&n.is(e.getPreference("x3dPlatformId"),"object")&&n.is(e.getPreference("x3dPlatformId").options,"array")){d=!0;for(var u=e.getPreference("x3dPlatformId").options,p=0;p<u.length;p++){var m=u[p];if(m.value===c[0]){e.setValue("x3dPlatformId",m.value),require(["DS/PADUtils/views/PADAlert"],(function(e){e.displayNotification({msg:_.multiTenants.differentTenant,eventID:"info"})})),d=!1;break}}}d&&require(["DS/PADUtils/views/PADAlert"],(function(e){e.displayNotification({msg:_.replace(_.multiTenants.mismatchTenant,{tenant:c[0]}),eventID:"error"})}))}0===l.length&&!0===t.session&&(l=e.getValue("roots")),l.length>0?(t={owned:!1,assigned:!1,reported:!1,responsible:!1,contributed:!1,closed:!1,session:!0},e.setValue("filter",JSON.stringify(t)),e.setValue("roots",l)):e.setValue("roots",[])}catch(e){}},_computePreferences:function(){var e=o.get("widget")||window.widget;return new t((function(t,n){try{var s=e.getValue(V)?JSON.parse(e.getValue(V)):null;if(null!==s){var i=s.template;i&&""!==i&&t(i)}}catch(e){n(new Error("An error occurred while adding a shared template "+e))}})).then((function(s){return new t((function(t){require(["DS/PADUtils/views/PADAlert","i18n!DS/IssueComponents/assets/nls/IssueComponents"],(function(i,o){var r=!1;if(s.envId!==a.getTenant()&&n.is(e.getPreference("x3dPlatformId"),"object")&&n.is(e.getPreference("x3dPlatformId").options,"array")){r=!0;for(var l=e.getPreference("x3dPlatformId").options,c=0;c<l.length;c++){var d=l[c];if(d.value===s.envId){e.setValue("x3dPlatformId",d.value),require(["DS/PADUtils/views/PADAlert"],(function(e){e.displayNotification({msg:_.multiTenants.differentTenant,eventID:"info"})})),r=!1;break}}}r&&require(["DS/PADUtils/views/PADAlert"],(function(e){e.displayNotification({msg:_.replace(_.multiTenants.mismatchTenantSharedTemplate,{tenant:s.envId}),eventID:"error"})})),that.Templatecomponent.addSharedTemplateToPreferences(s).then(t).catch((function(){i.displayNotification({msg:o.templates.notifications.sharedTemplateNotAdded,eventID:"error"}),t()}))}))}))}))},_subscribers:function(){var e=this,t=o.get("widget")||window.widget;t.addEvent("onLoad",e.onLoad.bind(e)),t.addEvent("onRefresh",e.onRefresh.bind(e)),t.addEvent("onResize",e.onResize.bind(e)),t.addEvent("endEdit",e.endEdit.bind(e)),t.addEvent("onDestroy",e.onDestroy.bind(e)),t.addEvent("onTitleChange",e.onTitleChange.bind(e)),t.addEventOnce("onSetPathTags",e.onSetPathTags.bind(e)),e._isResizing=!1,window.addEventListener("resize",(function(){!1!==e._isDOMLoaded&&!0!==e._isResizing&&(e._isResizing=!0,e._placeholder.addClassName("resizing"),e._placeholder.removeClassName("fade-out-element").addClassName("fade-in-element"),e.elements.container.removeClassName("fade-in-element").addClassName("fade-out-element"))}),!1)},utils:{error:function(e){n.is(e,"object")&&n.is(e.error,"object")&&n.is(e.error.message,"string")&&require(["DS/PADUtils/views/PADAlert"],(function(t){t.displayNotification({msg:e.error.message,eventID:"error"})}))},getNLSMsg:function(e){var t={label:_.error.generic.label,sub:_.error.generic.sub},s="";return n.is(e,"object")&&n.is(e.error,"object")&&n.is(e.error.message,"string")&&(s=e.error.message),s.contains("The server cannot obtain the license for user")&&(t.label=_.error.licensing.label,t.sub=_.replace(_.error.licensing.sub,{user:a.getUserName()})),t},getPropValue:function(e,t){t.split(".").reduce(((e,t)=>null==e?e:e[t]),e)}},_initIssueManagementContent:function(){var e=this;e.elements.mainITDiv&&e.clearIssueTemplate(),e.elements.mainIMDiv&&(e.elements.mainIMDiv.show(),e.elements.IdCardDiv.show(),e.elements.header.show(),e.elements.infoIcon.classList.remove("issueTemplate"),e.elements.triptychToolbar.removeClassName("isu-templateView"),e.onTitleChange(),e.resize())},_initIssueTemplateContent:function(){var e=this;e.elements.mainIMDiv&&e.clearIssueManagement(),e._loading&&e.destroyPlaceholder(),u.Mask.unmask(widget.body),e.elements.mainITDiv&&(e.Templatecomponent.setTemplateToolbar(),e.elements.mainITDiv.show(),e.elements.issueTemplateHeader.show(),e.elements.infoIcon.classList.add("issueTemplate"),e.elements.triptychToolbar.addClassName("isu-templateView"),e.onTitleChange(),e.Templatecomponent.isTemplateLoaded||e.Templatecomponent.refreshTemplateList().then((t=>{e.Templatecomponent.templateList.dataGrid.setTemplateCustomView()})).catch((e=>{})),e.Templatecomponent.document.pushBroadcastSelect())},clearIssueManagement:function(){this.elements.mainIMDiv.hide(),this.elements.IdCardDiv.hide()},clearIssueTemplate:function(){this.elements.mainITDiv.hide()},addToolbarInTriptychToolBarContainer:function(){var e=this;e.elements.header.inject(e.elements.triptychToolbar),e.elements.header.hide()},showIDCardInRightLayout:function(){var e=this;e.information.inject(e.elements.IdCardDiv),e.information.show(),e._applicationChannel.publish({event:"triptych-set-content",data:{side:"right",content:e.elements.IdCardDiv}}),e.information.open(),e.information.refreshInfo()},resizeTriptychInfoIcon:function(){var e=this;e.elements.infoIcon=document.getElementsByClassName("information-panel panel-icon-wrapper")[0].childNodes[1],e.media=T.getDeviceUsedForOperation(),e.elements.parentInfoIcon=document.getElementsByClassName("information-panel panel-icon-wrapper")[0],e.elements.infoIcon&&(e.elements.infoIcon.className+="wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-info wux-ui-3ds-lg",e.elements.infoIcon.className=e.elements.infoIcon.className.replace("fonticon-2x",""),e.elements.infoIcon.className+=" isu-infoIcon","Desktop"==e.media||"Tab"==e.media?e.elements.parentInfoIcon.className+=" desktop":e.elements.parentInfoIcon.className+=" mobile")},toogleInformationPanel:function(){var e=this;e.elements.IdCardDiv=n.createElement("div",{class:"IDCardMainDiv"}),null!=widget.getValue("isOpened")&&null!=widget.getValue("isOpened")||widget.setValue("isOpened",!1),e._applicationChannel.subscribe({event:"triptych-show-panel"},(function(t){"left"!=t&&e.showIDCardInRightLayout()})),e._applicationChannel.subscribe({event:"triptych-show-panel-bottom"},(()=>{e.information.inject(e.elements.body),e.information.show(),e.information.open(),e.information.refreshInfo()})),e._applicationChannel.subscribe({event:"triptych-hide-panel-bottom"},(()=>{e.information.hide(),e.information.close()}))},resizeMainComponent:function(){var e=this;e._applicationChannel.subscribe({event:"triptych-resized"},(function(t){"right"===t.side&&e.information.resize()}))},insertIssueSummaryViewInTriptych:function(){var e=this;e.elements.mainIMDiv=n.createElement("div",{class:"mainIMDiv"}),e.elements.container.inject(e.elements.mainIMDiv),e.elements.mainIMDiv.inject(e.mainContainer[0]),widget.getValue("IsIssueSummaryView")||e.elements.mainIMDiv.hide()},insertTemplateSummaryViewInTriptych:function(){var e=this;e.Templatecomponent=new m(o.get("widget"),{editMode:!0,onClose:function(){},onEnd:function(){}}),e.Templatecomponent.render(),e.elements.mainITDiv=n.createElement("div",{class:"mainITDiv"}),e.Templatecomponent.elements.body.inject(e.elements.mainITDiv),e.elements.mainITDiv.inject(e.mainContainer[0])},updateViewAfterLogin:function(){var e=this;widget.getValue("IsIssueSummaryView")?(e.elements.header.show(),e.elements.triptychToolbar.removeClassName("isu-templateView"),e._loading&&e.destroyPlaceholder(),u.Mask.unmask(widget.body)):e.elements.mainIMDiv.hide()},_initializeIssueTemplateComponent:function(){this.insertTemplateSummaryViewInTriptych(),this.insertTemplateToolbarInTriptychToolbar()},showHideTemplateView:function(){var e=this;widget.getValue("IsIssueSummaryView")?(e.elements.issueTemplateHeader.hide(),e.elements.mainITDiv.hide(),e.elements.infoIcon.classList.remove("issueTemplate")):(e.Templatecomponent.refreshTemplateList().then((t=>{e.Templatecomponent.templateList.dataGrid.setTemplateCustomView()})).catch((e=>{})),e.elements.infoIcon.classList.add("issueTemplate"),e.elements.triptychToolbar.addClassName("isu-templateView"),e._loading&&e.destroyPlaceholder(),u.Mask.unmask(widget.body))},insertTemplateToolbarInTriptychToolbar:function(){var e=this;e.elements.issueTemplateHeader=document.getElementsByClassName("create-template-chooser-list-iconbar")[0],e.elements.issueTemplateHeader.inject(e.elements.triptychToolbar)},destroyPlaceholder:function(){var e=this;null==e._loading&&null==e._loading||(e._placeholder.removeClassName("fade-in-element").addClassName("fade-out-element"),e._loading.destroy(),e._loading=null)},initializeTriptychMainContainer:function(){this.mainContainer=document.getElementsByClassName("triptych-main")},initializeTriptychToolbarContainer:function(){this.elements.triptychToolbar=document.getElementsByClassName("body-content")[0]},_subscribeToDNDEvents:function(){var e=this;e.elements.layout.getElementsByClassName("wux-layouts-header")[0].addEventListener("dragenter",(function(t,n){widget.getValue("dragColumnHeader"),widget.getValue("dragColumnHeader")||e.elements.DnDContainer.show(),document.getElementById("dndDismissButton").show()}));var t=e.elements.layout.getElementsByClassName("no-issues-to-show-container")[0];t&&t.addEventListener("dragenter",(function(t){e.elements.DnDContainer.show(),document.getElementById("dndDismissButton").show()}))},selectNode:function(e,t,n,s){var o=this,a=[];if(o.component){var r=o.component.getTreeDocument();r.withTransactionUpdate((function(){var l=o.component.getTreeListView(),c=r.getNodesById(t);c.length>0&&(n.forEach((function(e){e.unselect()})),n=[],c.forEach((function(e){o.component.listView?0!==i||l.getManager().isNodeInVisibleViewport(e)||l.getManager().scrollToNode(e,"top",!1):l.ensureNodeModelVisible(e),e.select()})),s.includes(e)&&a.push(t))}))}return a}});return z}));