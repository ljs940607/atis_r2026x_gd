define("DS/ENOX3DSpaceAttributesMgt/services/fetchHTTPClientServices",["UWA/Core","DS/ENOXEngineerCommonUtils/XENGenericHttpClient","DS/ENOXEngineerCommonUtils/XENCommonConstants"],((e,t,s)=>Object.assign(e.clone(t,!0),{decorateWithAddtionnaloptions(e,t){t.noSecurityContextNeeded||t.targetService!==s.SERVICE_3DSPACE_NAME||(e.headers.SecurityContext=encodeURIComponent(`${this.getSecurityContext()}`))},setServiceURL(e){this.serviceURL=e},setSecurityContext(e){this.securityContext=e},getSecurityContext(){return this.securityContext},buildUrl(e){return`${this.serviceURL}${e.url}`}}))),define("DS/ENOX3DSpaceAttributesMgt/services/predicatesServices",["DS/FedDictionaryAccess/FedDictionaryAccessAPI"],(e=>{class t{static getSelectableInfoFromPredicateInfo(e){const{nature:t,selectable:s,userAccess:i,dataType:r,range:a,rangeValues:n,multiValuated:c}=e||{};return{nature:t,selectable:s,userAccess:i,dataType:r,range:a,rangeValues:n,multiValuated:c}}static createANewAttributePredicate(e,s,i){if(!e||!s||!i)throw new Error("wrong input");const{manipulationUnit:r,dimension:a,isAppPredicate:n,isAppPredicateEditable:c}=i||{};return{uri:e,manipulationUnit:r,dimension:a,isAppPredicate:n,isAppPredicateEditable:c,predicates:[{classNames:[s],...this.getSelectableInfoFromPredicateInfo(i)}],get curi(){return this.uri},get isAnAppPredicate(){return"boolean"==typeof this.isAppPredicate&&this.isAppPredicate},get isAnAppPredicateEditable(){return"boolean"==typeof this.isAppPredicateEditable&&this.isAppPredicateEditable},get inTypes(){const e=[];return this.predicates.forEach((t=>e.push(...t.classNames))),[...new Set(e)]},get nature(){const e=this.getPredicateInfo();return e?e.nature:null},get userAccess(){const e=this.getPredicateInfo();return e?e.userAccess:null},get multiValuated(){const e=this.getPredicateInfo();return e?e.multiValuated:null},get dataType(){const e=Array.isArray(this.predicates)&&this.predicates.length?this.predicates[0]:null;if(!e)return"";const t=e.dataType;return t.substring(t.indexOf("#")+1)},get rangeValues(){const e=this.getPredicateInfo();if(!e)return null;return e.rangeValues||null},get selectable(){const e=this.getPredicateInfo();return e?e.selectable:null},getSelectables(e=null){return("function"==typeof e?this.predicates.filter(e):this.predicates).map((e=>e.selectable))},get description(){return i.description},get label(){return i.label},get isAMultiPredicate(){return this.predicates.length>1},findPredicateInfo(e){return"function"!=typeof e?null:this.predicates.find(e)},getPredicateInfo(){if(!this.isAMultiPredicate)return this.predicates[0];if(!this.forceEdition)return null;const e=this.predicates.filter(t.isAPredicateForEdition);if(!e.length)return null;const s=e.findIndex((e=>e.selectable===this.forceEdition));return-1===s?null:e[s]},get isEditable(){return this.isAnAppPredicate?this.isAnAppPredicateEditable:!!this.forceEdition||t.isAPredicateEditable(this)},set forceEditionWith(e){if(e){const s=this.findPredicateInfo((t=>t.selectable===e));s&&t.isAPredicateForEdition(s)&&(this.forceEdition=e)}else delete this.forceEdition},get canBeForceForEdition(){return this.getSelectables(t.isAPredicateForEdition).length>0}}}static canBeEdited(e){return"string"==typeof e&&-1!==e.search(/([wW]rite)/g)}static getAttributePredicatesFromClassPredicates(e,t=null,s=null){if(!e)throw new Error("invalid input");if(!Array.isArray(e))throw new Error("invalid format");const i=[];return e.forEach((e=>{const{classInfo:r}=e,a=r.curi,n=e.properties;Array.isArray(n)&&n.forEach((e=>{const r=this.getUriFromPredicateInfo(e);if(this.isPredicateIgnoredByApplication(r,t))return;const n=this.getSelectableInfoFromPredicateInfo({...e,multiValuated:this.isAMultiValuatedPredicate(e,s)}),c=i.find((e=>e.uri===r));if(c){const{predicates:t}=c,s=t.find((t=>this.isPredicateInfoEqual(t,e)));s?s.classNames.find((e=>e===a))||s.classNames.push(a):t.push({classNames:[a],...n})}else{let n=!1;const c=this.isPredicateControlledByApplication(r,t);c&&(n=this.isAnEditablePredicateControlledByApplication(r,t)),i.push(this.createANewAttributePredicate(r,a,{...e,multiValuated:this.isAMultiValuatedPredicate(e,s),isAppPredicate:c,isAppPredicateEditable:n}))}}))})),i}static isAMultiValuatedPredicate(e,t){if(!e||!Array.isArray(t))return!1;const{selectable:s}=e;if(!s)return!1;return-1!==t.map((e=>{const{Name:t,Owner:s}=e;return s?`${s}.${t}`:t})).indexOf(s)}static isPredicateInfoEqual(e,t){if(!e||!t)throw new Error("isPredicateInfoEqual invalid input");const{nature:s,selectable:i,userAccess:r}=e,{nature:a,selectable:n,userAccess:c}=t;return s===a&&i===n&&r===c}static isAPredicateForEdition(e){const{nature:s,multiValuated:i}=e||{};return!i&&!!t.isAnAttribute(s)}static isAPredicateEditable(e){if(!e)return!1;const{isAMultiPredicate:s}=e;return!s&&t.isAPredicateForEdition(e)}static isAnAttribute(e){return"string"==typeof e&&e.toUpperCase()==="attribute".toUpperCase()}static isAGeneratedPredicate(e){return"string"==typeof e&&e.startsWith("ds6wg:")}static isAnEditablePredicateControlledByApplication(e,t){if(!this.isPredicateControlledByApplication(e,t))return!1;const{userAccess:s}=t[e]||{};return this.canBeEdited(s)}static isPredicateControlledByApplication(e,t){if("string"!=typeof e||!t)return!1;return-1!==Reflect.ownKeys(t).indexOf(e)}static isPredicateIgnoredByApplication(e,t){if(!this.isPredicateControlledByApplication(e,t))return!1;const{ignored:s}=t[e]||{};return"boolean"==typeof s&&s}static getUriFromPredicateInfo(e){const{curi:t}=e||{};if(!t)throw new Error("predicateInfo without uri");return{"ds6wg:XCADExtension.V_CADOrigin":"ds6w:cadMaster"}[t]||t}static async getNLSPropertiesForClass(t,s){if(!Array.isArray(t))throw new Error("invalid inputs");const{settingManager:i}=s||{};if(!i||"function"!=typeof i.getPlatformId||"function"!=typeof i.getLanguage)throw new Error("invalid inputs");if(0===t.length)return[];const r=t.join(",");let a=null;try{a=await new Promise(((s,a)=>{e.getResourcesInfo(r,{tenantId:i.getPlatformId(),lang:i.getLanguage(),apiVersion:"R2019x",onComplete:e=>{const i="string"==typeof e?JSON.parse(e):e;Array.isArray(i)&&t.length===i.length||a(new Error("inconsistent nls answer compare to classes input"));const r={};t.forEach(((e,t)=>{r[e]=i[t]})),s(r)},onFailure:e=>{a(e)}})}))}catch(e){throw new Error(`getNLSPropertiesForClass fails ${e}`)}return a}}return t})),define("DS/ENOX3DSpaceAttributesMgt/services/loadModuleUtils",[],(()=>class{static async loadRuntimeLibrary(e){return await new Promise(((t,s)=>{require([e],(e=>{t(e)}),(t=>{s(new Error(`${e} loading fails error : ${t}`))}))}))}static async loadRuntimeLibraries(e){return Array.isArray(e)&&e.length?new Promise(((t,s)=>{require(e,((...e)=>{t(e)}),(e=>{s(e)}))})):Promise.reject(new Error("wrong inputs"))}})),define("DS/ENOX3DSpaceAttributesMgt/services/fetchClassificationServices",["UWA/Core","DS/ENOX3DSpaceAttributesMgt/services/loadModuleUtils","DS/ENOX3DSpaceAttributesMgt/services/predicatesServices","i18n!DS/ENOX3DSpaceAttributesMgt/assets/nls/ENOXAttributesMgtNls.json"],((e,t,s,i)=>{const r={name:"ClassificationAttributes",nlsName:i.ClassificationAttributes.title,declareIn:["VPMReference"]};class a{static get classificationExtensionProperties(){return"function"!=typeof r.isAvailable&&(r.isAvailable=async function(){if(Reflect.has(this,"ClassificationUtil"))return e.is(this.ClassificationUtil);try{this.ClassificationUtil=await t.loadRuntimeLibrary("DS/ClassificationUtil/ClassificationUtil")}catch(e){this.ClassificationUtil=null}return e.is(this.ClassificationUtil)}),r}static async fetchPropertiesForClassificationClass(e){const{settingManager:t}=e||{};if(!t||"function"!=typeof t.getLanguage)throw new Error("fetchClassificationServices.fetchPropertiesForClassificationClass invalid inputs");if(!await this.classificationExtensionProperties.isAvailable())throw new Error("ClassificationUtil loading fails");let s=null;try{s=await new Promise(((s,i)=>{const{ClassificationUtil:r}=this.classificationExtensionProperties;r.fetchClassificationAttributes({apiVersion:"R2019x",lang:t.getLanguage(),onComplete(t){const i="string"==typeof t?JSON.parse(t):t,r=a.filterClassesWithValidProperties(i);a.updateNlsPropertiesForClassificationClass(r,e).catch((()=>{console.error("problems fetching nls properties for classification attributes")})).finally((()=>{Array.isArray(i)&&(i.forEach((e=>{const{properties:t}=e;Array.isArray(t)&&t.forEach((e=>{-1===Reflect.ownKeys(e).indexOf("userAccess")&&(e.userAccess="ReadWrite")}))})),a.classifClasses=i),s(i)}))},onFailure(e){a.classifClasses=[],i(e)}})}))}catch(e){throw new Error(`fetchClassificationAttributes fails ${e}`)}return s}static filterClassesWithValidProperties(e){return e.filter((e=>{const{properties:t}=e,s=t.filter((e=>{return"string"==typeof(t=e.curi)&&t.trim().length>0;var t}));return s.length&&(e.properties=s),s.length>0}))}static syncFetchPropertiesForClassificationClass(){return a.classifClasses?e.clone(a.classifClasses):null}static async updateNlsPropertiesForClassificationClass(e,t){if(!Array.isArray(e)||!t)throw new Error("invalid inputs");if(!e.length)return;const[i]=e,{properties:r}=i||{};if(!Array.isArray(r))throw new Error("invalid inputs");const a=r.filter((e=>{const{curi:t}=e;return!s.isAGeneratedPredicate(t)}));if(!a.length)return;const n=a.map((e=>e.curi)),c=[...new Set(n)];let o=null;try{o=await s.getNLSPropertiesForClass(c,t)}catch(e){return void console.error("updateNlsPropertiesForClassificationClass: problem with getNLSPropertiesForClass")}a.forEach((e=>{const{curi:t}=e,s=o[t],{label:i}=s||{};"string"==typeof i&&(e.label=i)}))}}return a})),define("DS/ENOX3DSpaceAttributesMgt/services/dictionaryServices",["UWA/Core","DS/ENOX3DSpaceAttributesMgt/services/fetchHTTPClientServices","DS/ENOXEngineerCommonUtils/XENPlatform3DXSettings","DS/FedDictionaryAccess/FedDictionaryAccessAPI"],((e,t,s,i)=>{const r={url:"/resources/dictionary/getTypeInfo?parentInfo=true&$select=IconName&xrequestedwith=xmlhttprequest",method:"POST",type:"json",targetService:"3DSpace",isChangeControlled:!1},a={url:"/resources/dictionary/class/interfaces?displayAttributes=trues",method:"POST",type:"json",targetService:"3DSpace",isChangeControlled:!1};class n{static getSecurityContext(){return widget&&widget.getValue&&widget.getValue("SC")?widget.getValue("SC"):s._preferredSC}static getTenant(){return widget&&widget.getValue&&widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):s._platformId}static getLanguage(){return s.getLanguage()}static async get3DSpaceServiceURL(){return await s.getServiceURL("3DSpace")}static getNLSForTypes(e){return e.map((e=>n.typesNLS&&n.typesNLS[e]?n.typesNLS[e]:e))}static async getTypesInfo(e){const t=await n.fetch(r,e);return await n.formatTypeAnswer(t)}static async getInterfacesForTypes(e){const t={classes:e},s=await n.fetch(a,t);return n.formatInterfaceAnswer(s)}static async fetch(e,s){if(!e)throw new Error("fetchDictionaryServices.fetch, invalid input, missing serviceName or securityContext or command");const i=n.getSecurityContext();t.setSecurityContext(i);const r=await n.get3DSpaceServiceURL();t.setServiceURL(r);return await t.perform(e,s)}static formatInterfaceAnswer(e){const t={},s={},{results:i}=e;i.forEach((e=>{const{name:i,interfaces:r}=e,a=i;r.forEach((e=>{const{name:i}=e;(e=>{const{automatic:t,name:s}=e;return"string"==typeof t&&"yes"===t.toLowerCase()||!(!s.startsWith("XP_")||!s.endsWith("_Ext"))})(e)?(t[i]||(t[i]=e,t[i].declareIn=[]),t[i].declareIn.push(a)):(s[i]||(s[i]=e,s[i].declareIn=[]),s[i].declareIn.push(a))}))}));return{automaticExtensions:t,extensions:s}}static async formatTypeAnswer(e){const t=Reflect.ownKeys(e),s={};t.forEach((t=>{const i=e[t];i&&Reflect.ownKeys(i).length>0&&(s[t]=i)}));const i=Reflect.ownKeys(s),r=await n.fetchNLSForTypes(i),a=await n.get3DSpaceServiceURL();return i.forEach((e=>{s[e].displayName=r[e]||e,s[e].iconUrl=((e,t)=>"string"==typeof e&&e.trim().length?`${t}/snresources/images/icons/small/${e}.png`:"")(s[e].IconName,a)})),s}static async fetchNLSForTypes(e){const t={"ds6w:type":e},{"ds6w:type":s}=await new Promise((e=>{i.getNlsOfPropertiesValues(JSON.stringify(t),{tenantId:n.getTenant(),lang:n.getLanguage(),apiVersion:"R2019x",onComplete:t=>{const s="string"==typeof t?JSON.parse(t):t;e(s)},onFailure:()=>{e({})}})}));return n.updateLocalNLSCacheWith(s),s}static updateLocalNLSCacheWith(e){n.typesNLS||(n.typesNLS={});Reflect.ownKeys(e).forEach((t=>{n.typesNLS[t]||(n.typesNLS[t]=e[t])}))}}return n})),define("DS/ENOX3DSpaceAttributesMgt/services/fetchDictionaryServices",["UWA/Core","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/ENOX3DSpaceAttributesMgt/services/dictionaryServices"],((e,t,s)=>{class i{static async fetchTypesClasses(e){if(!Array.isArray(e)||!e.length)throw new Error("fetchExtensionsForTypes invalid input arguments");if(i.lastFetchedTypesClasses&&i.lastFetchedTypesClasses.isValidWith(e))return i.lastFetchedTypesClasses.getTypesClasses();const t={classes:[],getNLSForType:e=>s.getNLSForTypes(e),getTypesMapToBaseTypes(e){const t={unknown:new Set};return Reflect.ownKeys(e).forEach((s=>{t[s]=Array.isArray(e[s])?new Set(e[s]):new Set})),Reflect.ownKeys(this.classes).forEach((s=>{const i=this.classes[s].parent||s,r=Reflect.ownKeys(e).find((e=>t[e].has(i)));r?t[r].add(s):t.unknown.add(s)})),Reflect.ownKeys(t).forEach((e=>{t[e]=[...t[e]]})),t}};try{t.classes=await s.getTypesInfo(e)}catch(e){throw new Error(`fetchExtensionsForTypes fails ${e}`)}finally{i.lastFetchedTypesClasses={types:e,typesClasses:t,isValidWith(e){if(e.length!==this.types.length)return!1;return-1===e.findIndex((e=>-1===this.types.indexOf(e)))},getTypesClasses(){return this.typesClasses}}}return t}static syncFetchTypesClasses(){return i.lastFetchedTypesClasses?e.clone(i.lastFetchedTypesClasses.getTypesClasses()):[]}static async fetchExtensionsClassesForTypes(e,t=!1){if(!Array.isArray(e)||!e.length)throw new Error("fetchExtensionsForTypes invalid input arguments");if(i.lastFetchedExtensionsClasses&&i.lastFetchedExtensionsClasses.isValidWith(e,t))return i.lastFetchedExtensionsClasses.getExtensionClasses();let r=null;try{r=await s.getInterfacesForTypes(e)}catch(e){throw new Error(`fetchExtensionsForTypes fails ${e}`)}finally{i.lastFetchedExtensionsClasses={types:e,extensionsClasses:r,onlyCustomer:t,isValidWith(e,t){if(t!==this.onlyCustomer)return!1;if(e.length!==this.types.length)return!1;return-1===e.findIndex((e=>-1===this.types.indexOf(e)))},getExtensionClasses(){return this.extensionsClasses}}}return r}static syncFetchExtensionsClassesForTypes(){return i.lastFetchedExtensionsClasses?e.clone(i.lastFetchedExtensionsClasses.getExtensionClasses()):[]}static async fetchPredicatesForClasses(e,s){if(!Array.isArray(e))throw new Error("invalid inputs");const{settingManager:r}=s||{};if(!r||"function"!=typeof r.getPlatformId||"function"!=typeof r.getLanguage)throw new Error("invalid inputs");if(i.lastFetchedPredicatesClasses&&i.lastFetchedPredicatesClasses.isValidWith(e)){return e.map((e=>{const t=i.lastFetchedPredicatesClasses.classes.indexOf(e);return i.lastFetchedPredicatesClasses.getPredicates()[t]}))}const a=e.join(",");let n=null;try{n=await new Promise(((e,s)=>{t.getPropertiesForClass(a,{tenantId:r.getPlatformId(),lang:r.getLanguage(),apiVersion:"R2019x",onComplete:t=>{const s="string"==typeof t?JSON.parse(t):t;e(s)},onFailure:e=>{s(e)}})}))}catch(e){throw new Error(`fetchClassificationAttributes fails ${e}`)}finally{i.lastFetchedPredicatesClasses={classes:e,predicatesClasses:n,isValidWith(e){if(e.length!==this.classes.length)return!1;return-1===e.findIndex((e=>-1===this.classes.indexOf(e)))},getPredicates(){return this.predicatesClasses}}}return n}}return i}));