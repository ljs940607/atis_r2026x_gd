define("DS/WAfrContainer/ContainerComAbstraction",[],(function(){"use strict";var e=function(){};return e.prototype.GetA2XClient=function(){return this._a2xClient},e.prototype.SetA2XClient=function(e){this._a2xClient=e,window&&(window._a2xClient=e)},e})),define("DS/WAfrModelEvents/mod_ModelEvents",["UWA/Core","DS/CoreEvents/ModelEvents"],(function(e,t){"use strict";var n=function(){this._modelEvents=new t,this._applicativeModelEvents=new t};return n.DEFAULT_COMPONENT_NAME="AFR_ModelEvents",n.prototype.initialize=function(){return Promise.resolve()},n.prototype.subscribe=function(e,t){return this._modelEvents.subscribe(e,t)},n.prototype.subscribeOnce=function(e,t){this._modelEvents.subscribeOnce(e,t)},n.prototype.unsubscribe=function(e){this._modelEvents.unsubscribe(e)},n.prototype.unsubscribeAll=function(e){this._modelEvents.unsubscribeAll(e)},n.prototype.publish=function(e){if("ALL"===e.scope)return this._modelEvents.publish(e),void this._applicativeModelEvents.publish(e);this._modelEvents.publish(e)},n.prototype.destroy=function(){return this._modelEvents.destroy(),this._applicativeModelEvents.destroy(),Promise.resolve()},n.prototype.createExposedComponent=function(){return{subscribe:this._applicativeModelEvents.subscribe.bind(this._applicativeModelEvents),subscribeOnce:this._applicativeModelEvents.subscribeOnce.bind(this._applicativeModelEvents),unsubscribe:this._applicativeModelEvents.unsubscribe.bind(this._applicativeModelEvents),unsubscribeAll:this._applicativeModelEvents.unsubscribeAll.bind(this._applicativeModelEvents),publish:this._applicativeModelEvents.publish.bind(this._applicativeModelEvents)}},n})),define("DS/WAfrUtils/Logger",[],(function(){"use strict";let e=!1;const t=localStorage.getItem("DEBUG_WAFR_LOGGER");var n;function r(...t){e&&console.error("[WAFR-LOGGER]",...t)}return null!==t&&("string"==typeof t&&"true"===t||"boolean"==typeof t&&t)&&(n=!0,console.warn("[DEBUG] DS/WAfrUtils/Logger: Debug mode activated.","\n[DEBUG] DO NOT USE IN PRODUCTION.","\n[DEBUG] DO NOT USE IF YOU ARE NOT PART OF THE WAFR TEAM.",'\n[DEBUG] Be sure to activate "Verbose" level in the DevTools to see all logs.'),e=Boolean(n)),{getDebugMode:function(){return e},log:function(...t){e&&console.log("[WAFR-LOGGER]",...t)},warn:function(...t){e&&console.warn("[WAFR-LOGGER]",...t)},debug:function(...t){e&&console.debug("[WAFR-LOGGER]",...t)},error:r,severe:r}})),define("DS/WAfrUtils/mod_ConcatenationUtils",[],(function(){"use strict";const e=Object.create(null);return e.hasConfigurationFor=function(e,t){return Boolean(e&&t&&e.stdConf&&e.stdConf[t])},e.getConfigurationFor=function(e,t){let n;return e&&t&&e.stdConf&&e.stdConf[t]&&(n=e.stdConf[t]),n},e.getConfiguration=function(e){let t;return e&&e.stdConf&&(t=e.stdConf),t},e})),define("DS/WAfrHandlers/private/private_Utilities",[],(function(){"use strict";let e=Object.create(null);return e.enums=Object.create(null),e.enums.HandlerType={},e.executeHandlerFunctions=[],e.registerLeafHandler=function(t,n){const r=e.enums.HandlerType;if(r.hasOwnProperty(t))throw new Error("There already are a handler registered using the same handlerId",t);if(!n||!n.executeFunc)throw new Error("Missing parameters");let i=-1;for(let e in r)r.hasOwnProperty(e)&&(i=i>r[e]?i:r[e]);++i,r[t]=i,e.executeHandlerFunctions[i]=n.executeFunc},e.publishHandlerAvailability=function(e){const t=e.getHandlerComponent();if(!t)throw new Error("There is no HandlerComponent related to this Handler",e);const n=t.getEventChannel();if(!n)throw new Error("Retrieved eventChannel is undefined");const r=e.getId();if(!r)throw new Error("handlerIdentfier has to be a non empty string.");setTimeout((function(){n.publish({event:r+"/AVAILABILITY",data:{newValue:e.isAvailable()}})}),0)},e.computeArgs=function(e,t){const n=e.getArgs();if(t&&n)for(let e in n)n.hasOwnProperty(e)&&!t.hasOwnProperty(e)&&(t[e]=n[e]);else n&&(t=n);return t},e})),define("DS/WAfrExecutionContext/mod_Component",["UWA/Core"],(function(e){"use strict";var t=Object.create(null),n=function(){};function r(e,t){if("object"!=typeof t)throw new Error("target obj to update must be an object");var n;n=e.prototype,Object.keys(n).forEach((function(e){t.hasOwnProperty(e)||Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}function i(e,t){if("function"!=typeof t)throw new Error("parameters must be constructors (i.e. functions)");r(e,t.prototype)}t.Component=n,n.implementsBy=function(e){i(n,e)},n.mixinProperties=function(e){r(n,e)},n.prototype.getExecutionContext=function(){return this._private._executionContext},n.prototype.setExecutionContext=function(e){this._private=this._private||Object.create(null),this._private._executionContext=e},n.prototype.getRegisteredIdentifier=function(){return this._private._identifier},n.prototype.setRegisteredIdentifier=function(e){this._private=this._private||Object.create(null),this._private._identifier=e},n.prototype.setInitializedState=function(e){if("boolean"!=typeof e)throw new Error("Initialization state must be a boolean value");this._private=this._private||Object.create(null),this._private._initialized=e},n.prototype.isInitialized=function(){return this._private._initialized},n.prototype.initialize=function(){return Promise.resolve()},n.prototype.clean=function(){return Promise.resolve()},n.prototype.destroy=function(){return Promise.resolve()},n.prototype.canBeParallelized=function(){return!0};var o=function(){};t.StandardComponent=o,n.implementsBy(o),o.implementsBy=function(e){i(o,e)},o.prototype.configure=function(){return Promise.resolve()},o.prototype.getExposedComponentCtor=function(){return null},o.prototype.getExposedComponent=function(){return this._private?this._private._publicComponent:null},o.prototype.setExposedComponent=function(e){this._private=this._private||Object.create(null),this._private._publicComponent=e},o.prototype.generateInterpreter=function(e){return null},o.prototype.getCurrentInterpreter=function(){return this._private._currentInterpreter},o.prototype.setCurrentInterpreter=function(e){this._private=this._private||Object.create(null),this._private._currentInterpreter=e},o.prototype.canBeParallelized=function(){return!1};var a=function(){};return t.Interpreter=a,a.prototype.interpret=function(e,t){throw new Error("Not implemented")},a.prototype.commit=function(e,t){throw new Error("Not implemented")},a.prototype.enrich=function(e,t){},t})),define("DS/WAfrUtils/mod_Performances",[],(function(){"use strict";var e="[WAFR]",t=e+"[STD]",n=e+"[INC]",r=t+"b_",i=t+"e_",o=n+"b_",a=n+"e_";function s(){this._private=Object.create(null),this._private._probes=[]}function d(e){var r,i=performance.getEntriesByType("measure").filter((function(e){return-1!==e.name.indexOf(t)})).map((function(n){var r=n.name.replace(t,"");if(e&&e.removeTimestamp){var i=r.split("_");i.pop(),r=i.join("_")}return{name:r,startTime:n.startTime,duration:n.duration}})),s=performance.getEntriesByType("mark").filter((function(e){return-1!==e.name.indexOf(n)})),d=(r="name",s.reduce((function(e,t){const n=t[r];return e[n]=e[n]||[],e[n].push(t),e}),{})),c=Object.keys(d).filter((function(e){return-1!==e.indexOf(o)})),l=c.map((function(t){var n=t.replace(o,"");if(e&&e.removeTimestamp){var r=n.split("_");r.pop(),n=r.join("_")}var i={name:n,count:d[t].length},s=t.replace(o,a),c=d[t],l=c.length,p=d[s],h=p.length,u=Math.min(l,h);if(h>l)throw new Error("Internal Error");for(var m=0,_=0;_<u;++_)m+=p[_].startTime-c[_].startTime;return i.totalTime=m,i}));return{stdMeasures:i,incMeasures:l}}return s.prototype.isProdMode=function(){var e=!0;return"true"===localStorage.getItem("DEBUG_WAFR_PERFORMANCE")&&(e=!1),e},s.prototype.start=function(e){if(!this.isProdMode()){var t=this._private._probes,n=t.length,i=(new Date).valueOf(),o={label:e,timestamp:i},a=r+e+"_"+i;performance.mark(a);var s=performance.getEntriesByName(a);return o.start=s[s.length-1],t[n]=o,n}},s.prototype.stop=function(e){if(!this.isProdMode()){var n=this._private._probes[e];if(!n||!n.start)throw new Error("Trying to stop a measure without a corresponding start item");var o=n.label+"_"+n.timestamp,a=i+o,s=t+o;performance.mark(a);var d=performance.getEntriesByName(a);n.stop=d[d.length-1],performance.measure(s,r+o,a),d=performance.getEntriesByName(s),n.measure=d[d.length-1]}},s.prototype.log=function(e){if(!this.isProdMode())for(var t=0,n=this._private._probes,r=n.length,i=null;t<r;++t)(i=n[t]).measure?e.log(i):"INCREMENTAL"!==i.type||void 0===i.isActive||i.isActive||e.log(i)},s.prototype.startIncrementalProbe=function(e){if(!this.isProdMode()){var t=this._private._probes,n=t.length,r={label:e,timestamp:(new Date).valueOf(),type:"INCREMENTAL",totalTime:0,isActive:!0,count:0};return t[n]=r,n}},s.prototype.startIncrement=function(e){if(!this.isProdMode()){var t=this._private._probes[e];if(!t||t.lastStart||!t.isActive)throw new Error("Trying to start to increment a probe without defining it OR without stoping the previous increment transaction.");var n=t.label+"_"+t.timestamp,r=o+n;performance.mark(r);var i=performance.getEntriesByName(r);t.lastStart=i[i.length-1]}},s.prototype.stopIncrement=function(e){if(!this.isProdMode()){var t=this._private._probes[e];if(!(t&&t.lastStart&&t.isActive))throw new Error("Trying to stop to increment a probe without defining it OR without staring it.");var n=t.label+"_"+t.timestamp,r=a+n;performance.mark(r);var i=performance.getEntriesByName(r),o=i[i.length-1];t.totalTime+=o.startTime-t.lastStart.startTime,delete t.lastStart,++t.count}},s.prototype.stopIncrementalProbe=function(e){if(!this.isProdMode()){var t=this._private._probes[e];if(!t||!t.totalTime)throw new Error("Trying to stop a probe which does not exist");console.debug("⏱️",t.label+"_"+t.timestamp,"count:",t.count,"duration:",t.totalTime,"ms"),t.isActive=!1}},{Performances:s,logProbes:function(){var e=d(),t=e.stdMeasures,n=e.incMeasures;if(-1===window.navigator.userAgent.indexOf("MSIE ")&&-1===window.navigator.userAgent.indexOf("Trident/")){var r="[WAFR] Performances";console.groupCollapsed(r);var i=r+" - Standard";console.groupCollapsed(i),console.table(t,["name","startTime","duration"]),console.groupEnd(i);var o=r+" - Incremental";console.groupCollapsed(o),console.table(n,["name","count","totalTime"]),console.groupEnd(o),console.groupEnd(r)}return{stdMeasures:t,incMeasures:n}},getProbes:d}})),define("DS/WAfrHandlers/mod_Handler",[],(function(){"use strict";function e(e,t){if(!e)throw new Error("clients must be defined");if(void 0===t)throw new Error("value must be defined.");for(const n in e)e[n](t)}let t=Object.create(null);return t.Handler=class{constructor(e){if(this._private||(this._private=Object.create(null)),this._private._currentAvailability=!0,this._private._isEnabled=!0,this._private._isEnabledChangeClients={},this._private._isEnabledNextClientUid=0,!e)throw new Error("Missing parameters. Please see the Handler documentation to see the required parameters.");if(!e.id)throw new Error("Missing parameter. id has to be defined.");this._private._id=e.id,e.i18n&&(this._private._i18n=e.i18n),e.accelerator&&(this._private._accelerator=e.accelerator)}getAccelerator(){return this._private._accelerator}getId(){return this._private._id}setI18n(e){if(!(e&&e.title&&e.shortHelpImage&&e.shortHelpImage.uri&&e.longHelpImage&&e.longHelpImage.uri))throw new Error("One or many parameters are missing.");e&&(this._private._i18n=e)}getI18n(){return this._private._i18n}beingInitialized(){let e=!1;return this.getHandlerComponent()&&(e=!0),e}getHandlerComponent(){throw new Error("getHandlerComponent has to be implemented on subclasses.")}onAvailabilityChanged(){throw new Error("onAvailabilityChanged has to be implemented on subclasses")}onAvailabilityEvent(e){if(!e||"function"!=typeof e)throw new Error("cb has to be a function",e);const t=this.getHandlerComponent();if(!t)throw new Error("There is no HandlerComponent related to this Handler",this);const n=t.getEventChannel();if(!n)throw new Error("Retrieved eventChannel is undefined");const r=this.getId();if(!r)throw new Error("handlerIdentifier has to be a non empty string.");return n.subscribe({event:r+"/AVAILABILITY"},e)}removeAvailabilityEventSubscription(e){if(void 0===e)throw new Error("token has to be defined");const t=this.getHandlerComponent();if(!t)throw new Error("There is no HandlerComponent related to this Handler",this);const n=t.getEventChannel();if(!n)throw new Error("Retrieved eventChannel is undefined");if(!this.getId())throw new Error("handlerIdentifier has to be a non empty string.");return n.unsubscribe(e)}isAvailable(){return this._private._currentAvailability}isEnabled(){return this._private._isEnabled}disable(){this._private._isEnabled&&(this._private._isEnabled=!1,e(this._private._isEnabledChangeClients,!1))}enable(){this._private._isEnabled||(this._private._isEnabled=!0,e(this._private._isEnabledChangeClients,!0))}isExecutable(){return this.isAvailable()&&this.isEnabled()}onIsEnabledChangeEvent(e){if(!e||"function"!=typeof e)throw new TypeError("cb must be a function.");const t=this._private._isEnabledNextClientUid++;return this._private._isEnabledChangeClients[t]=e,t}removeIsEnabledChangeEventSubscription(e){const t=this._private._isEnabledChangeClients;if(!t.hasOwnProperty(e))throw new Error("No element registered with this token",e);delete t[e]}onIconChanged(){throw new Error("onIconChanged has to be implemented on subclasses")}destroy(){this._private._isEnabledChangeClients&&delete this._private._isEnabledChangeClients}},t})),define("DS/WAfrAvailabilityModes/mod_AvailabilityModesComponent",["text!DS/WAfrAvailabilityModes/assets/afr/availabilitymodes/AFR_DEFAULT_AVAILABILITY_MODES.json"],(function(e){"use strict";const t="DEACTIVATED",n=JSON.parse(e);let r=Object.create(null);r.DEFAULT_COMPONENT_NAME="AFR_AvailabilityModesComponent";const i="[AVAILABILITY_MODE]";let o=!1;r.setDebugMode=function(e){if(void 0!==e&&"boolean"==typeof e&&o!==e){let t;o=e,o?(t=new Error("Debug mode activated - DO NOT USE IN PRODUCTION"),t.name="Warning",console.warn(t.stack)):(t=new Error("Debug mode deactivated - DO NOT USE IN PRODUCTION"),t.name="Warning",console.warn(t.stack))}};const a="[DS/WAfrAvailabilityModes/mod_AvailabilityModesComponent]",s=a+"_b_",d=a+"_e_",c=a+"_m_";let l=!1;function p(e,t){if(null==e||null==t)throw new Error("probesId and identifier has to be defined");l&&window.performance.mark(s+t+e)}function h(e,t){if(null==e||null==t)throw new Error("probesId and identifier has to be defined");if(l){window.performance.mark(d+t+e);const a=c+t+e;if(window.performance.measure(a,s+t+e,d+t+e),o){var n=window.performance.getEntriesByName(a),r=n[n.length-1];console.log(i+" [PROBES] "+t,r)}}}function u(e){for(let t in e)e.hasOwnProperty(t)&&delete e[t]}function m(){return Promise.resolve()}function _(e,t){let n=Promise.resolve();const r=e._private._defaultModesValues,o=e._private._currentModes,a=t.getAvailabilityModesInfo();if(!a||void 0===a.currentAvailability)throw new Error("Cannot retrieve availabilityModes information for this client",t);let s=null,d=null;s=a.modes||{},d=a.currentAvailability;const c=function(e,t){let n=JSON.parse(JSON.stringify(e)),r=JSON.parse(JSON.stringify(t));for(let e in r)if(r.hasOwnProperty(e)){if(!n[e])throw new Error(i+" Unsupported availability mode ("+e+")");let t=n[e].values,o=r[e].values;for(let e in o)o.hasOwnProperty(e)&&o[e]!==t[e]&&(t[e]=o[e])}return n}(r,s);let l=null,p=null,h=!1;for(l in o)if(o.hasOwnProperty(l)&&(p=o[l],!1===c[l].values[p.selected])){h=!0,d&&(n=Promise.resolve().then(t.onAvailabilityChanged.bind(t,!1,{mode:p,value:p.selected})));break}return h||d||(n=Promise.resolve().then(t.onAvailabilityChanged.bind(t,!0))),n}r.setProbeMode=function(e){if(void 0!==e&&"boolean"==typeof e&&l!==e){let t;l=e,l?(t=new Error("Probe mode activated - DO NOT USE IN PRODUCTION"),t.name="Warning",console.warn(t.stack)):(t=new Error("Probe mode deactivated - DO NOT USE IN PRODUCTION"),t.name="Warning",console.warn(t.stack))}};return r.AvailabilityModesComponent=class{constructor(){this._private=Object.create(null),this._private._probesId=(new Date).valueOf()}initialize(){p(this._private._probesId,"AvailabilityModesComponent.prototype.initialize"),this._private._currentModes={},this._private._clients={},this._private._nextClientUid=0;const e=this;if(this._private._defaultModesValues)return h(this._private._probesId,"AvailabilityModesComponent.prototype.initialize"),Promise.resolve();return Promise.resolve(n).then((function(t){return e._private._defaultModesValues=t,h(e._private._probesId,"AvailabilityModesComponent.prototype.initialize"),Promise.resolve()}),(function(e){throw e}))}clean(){if(p(this._private._probesId,"AvailabilityModesComponent.prototype.clean"),!this._private||!this._private._clients||!this._private._currentModes)throw new Error("AvailabilityModeComponent state is corrupted. You may have call clean before initialize");return u(this._private._currentModes),u(this._private._clients),this._private._nextClientUid=0,h(this._private._probesId,"AvailabilityModesComponent.prototype.clean"),Promise.resolve()}destroy(){if(p(this._private._probesId,"AvailabilityModesComponent.prototype.destroy"),!this._private||!this._private._clients||!this._private._currentModes)throw new Error("AvailabilityModeComponent state is corrupted. You may have call clean before initialize");return delete this._private._currentModes,delete this._private._clients,delete this._private._nextClientUid,delete this._private._defaultModesValues,h(this._private._probesId,"AvailabilityModesComponent.prototype.destroy"),Promise.resolve()}getExposedComponentCtor(){p(this._private._probesId,"AvailabilityModesComponent.prototype.getExposedComponentCtor");const e=this;function t(){}return t.prototype.initialize=m,t.prototype.clean=m,t.prototype.destroy=m,t.prototype.subscribe=e.subscribe.bind(e),t.prototype.unsubscribe=e.unsubscribe.bind(e),t.prototype.publish=e.publish.bind(e),t.prototype.canBeParallelized=e.canBeParallelized.bind(e),t.prototype.getCurrentModeValue=e.getCurrentModeValue.bind(e),h(this._private._probesId,"AvailabilityModesComponent.prototype.getExposedComponentCtor"),t}subscribe(e,t){p(this._private._probesId,"AvailabilityModesComponent.prototype.subscribe"),t||console.warn("[DEPRECATED] Usage of AvailabilityModesComponent.prototype.subscribe must not be used in a synchronous way. Please refer to its documentation in order to migrate your code.");let n=Promise.resolve();!function(e){if(!e||!e.getAvailabilityModesInfo||"function"!=typeof e.getAvailabilityModesInfo||!e.onAvailabilityChanged||"function"!=typeof e.onAvailabilityChanged)throw new Error("element is not defined or it does not implement required methods")}(e);const r=this._private._clients;for(var i in r)if(r.hasOwnProperty(i)&&r[i]===e){let n=new Error("Trying to subscribe an element which is already registered",e);if(t)return Promise.reject(n);throw n}if(r.hasOwnProperty(this._private._nextClientUid))throw new Error("Internal Error");var o;return r[this._private._nextClientUid]=e,++this._private._nextClientUid,o=this._private._nextClientUid-1,n=_(this,e).then((function(){return o})),h(this._private._probesId,"AvailabilityModesComponent.prototype.subscribe"),t?n:this._private._nextClientUid-1}unsubscribe(e){p(this._private._probesId,"AvailabilityModesComponent.prototype.unsubscribe");const t=this._private._clients;if(!t.hasOwnProperty(e))throw new Error("No element registered with this token",e);delete t[e],h(this._private._probesId,"AvailabilityModesComponent.prototype.unsubscribe")}publish(e){o&&console.log(i+" [MODES_ARRAY] AvailabilityModesComponent.prototype.publish - Before computation",this._private._currentModes),p(this._private._probesId,"AvailabilityModesComponent.prototype.publish");let n=e.mode,r=e.data,a=e.value;if(!n||void 0===a)throw new Error("settings.mode, settings.value has to be defined");if(!function(e,n,r){let i=!1;const o=e._private._defaultModesValues;return o.hasOwnProperty(n)&&(o[n].values.hasOwnProperty(r)||r===t)&&(i=!0),i}(this,n,a))throw new Error("INVALID MODE OR VALUE",n,a);let s=!1;this._private._currentModes.hasOwnProperty(n)?this._private._currentModes[n].value!==a&&(a===t?delete this._private._currentModes[n]:this._private._currentModes[n]={selected:a,data:r},s=!0):a!==t&&(this._private._currentModes[n]={selected:a,data:r},s=!0);let d=Promise.resolve();return s&&(d=function(e){o&&console.log(i+" [AVAILABILITY_COMPUTATION] AvailabilityModesComponent~computeAvailabilityAndPublishAsync - Begin computation",e._private._clients),p(e._private._probesId,"AvailabilityModesComponent~computeAvailabilityAndPublishAsync");let t=[];const n=e._private._clients;for(let r in n)n.hasOwnProperty(r)&&t.push(_(e,n[r]));return h(e._private._probesId,"AvailabilityModesComponent~computeAvailabilityAndPublishAsync"),o&&console.log(i+" [AVAILABILITY_COMPUTATION] AvailabilityModesComponent~computeAvailabilityAndPublishAsync - End computation",e._private._clients),Promise.all(t)}(this)),o&&console.log(i+" [MODES_ARRAY] AvailabilityModesComponent.prototype.publish - After computation",this._private._currentModes),h(this._private._probesId,"AvailabilityModesComponent.prototype.publish"),d}getCurrentModeValue(e){let t="DEACTIVATED";return this._private._currentModes.hasOwnProperty(e)&&(t=this._private._currentModes[e].selected),t}},r.AvailabilityModesComponent.DEFAULT_COMPONENT_NAME=r.DEFAULT_COMPONENT_NAME,r})),define("DS/WAfrUtils/mod_APIRegistry",[],(function(){"use strict";return{APIRegistry:class{constructor(){this._private=Object.create(null),this._private.apis=new Map}register(e,t){if(!e)throw new Error("Missing identifier.");if(!t)throw new Error("Missing api.");const n=this._private.apis;if(n.has(e))throw new Error(`${e} already registered.`);t.registry=this,n.set(e,t)}unregister(e){if(!e)throw new Error("Missing identifier");const t=this._private.apis;if(!t.has(e))throw new Error(`${e} is not registered.`);t.get(e).registry=null,t.delete(e)}get(e){if(!e)throw new Error("Missing identifier");const t=this._private.apis;if(!t.has(e))throw new Error(`${e} is not registered.`);return t.get(e).get()}waitDispose(){let e=[];for(const[t,n]of this._private.apis)e.push(n.waitDispose());return Promise.all(e)}},AbstractAPI:class{constructor(){this._private=Object.create(null),this._private.pendingExecution=0,this._private.waitForDispose=!1,this._private.disposeResolve=null,this._private.registry=null}set registry(e){if(this._private.registry&&e)throw new Error("Cannot set another registry.");this._private.registry=e}get registry(){return this._private.registry}async execute(...e){return Promise.reject("Abstract execute must be reimplemented by subclasses.")}get(){return async(...e)=>{if(!this._private||this._private.waitForDispose)return Promise.reject("Cannot execute a disposed API.");let t;return++this._private.pendingExecution,t=await this.execute(...e),--this._private.pendingExecution,this._private.waitForDispose&&this._private.pendingExecution<=0&&this._dispose(),t}}_dispose(){const e=this._private.disposeResolve;delete this._private,e()}async waitDispose(){if(this._private.waitForDispose=!0,!(this._private.pendingExecution<=0))return new Promise(((e,t)=>{this._private.disposeResolve=e}));this._dispose()}}}})),define("DS/WAfrUtils/mod_PromiseUtils",[],(function(){"use strict";const e=Object.create(null);return e.promisifiedRequire=function(e){return new Promise(((t,n)=>{require([e],t,n)}))},e})),define("DS/WAfrContainer/App",["UWA/Core","UWA/Class","DS/Utilities/UUID"],(function(e,t,n){"use strict";var r=t.extend({defaultOptions:{id:null,uuid:n.createUUID(),startTimeApp:Date.now(),appTitle:null,title:null,brand:null,appConfig:{afrVersion:"0.1",afrCode:null,afrFamily:null,afrTransitionsFrom:{},afrTransitionsTo:{},afrTransitionsFromFamily:{},afrTransitionsToFamily:{}}},disposeOptions:{disposeFrameWindow:!0},init:function(t){if(n=(t=t||{}).appConfig,Boolean(n&&n.stdConf&&n.stdConf.a2x)){if(!t.appInfo)throw new Error("WAfrContainer/App : appInfo not found");t.nativeInformation=t.appInfo.nativeInformation,t.defaultPage=t.appInfo.defaultPage,t.type=t.appInfo.type,delete t.appInfo}var n;if(this.options=e.extend(e.clone(this.defaultOptions),t),!this.options.id){const e=t&&t.appIds;e&&e.appId?this.options.id=e.appId:this.options.id=this.options.appConfig.appId||this.options.appConfig.afrAppId,e&&e.afrAppId?this.options.afrAppId=e.afrAppId:this.options.afrAppId=this.options.appConfig.afrAppId||this.options.appConfig.appId,this.options.appConfig.appId&&delete this.options.appConfig.appId,this.options.appConfig.afrAppId&&delete this.options.appConfig.afrAppId}if(!this.options.appTitle){const e=t&&t.appIds;e&&e.appTitle?this.options.appTitle=e.appTitle:(this.options.appTitle=this.options.appConfig.appTitle||this.options.appConfig.title,this.options.appConfig.appTitle&&delete this.options.appConfig.appTitle)}this.options.brand||(this.options.brand=this.options.appConfig.brand,this.options.appConfig.brand&&delete this.options.appConfig.brand),this._parent(this.options),this._frmWindow=void 0,this._disposeCalled=!1,this._executionContext=void 0},getIdCard:function(){return this.options.appConfig},getTransitionFrom:function(e){return this.options.appConfig.afrTransitionsFrom?this.options.appConfig.afrTransitionsFrom[e]:null},getTransitionFromFamily:function(e){return this.options.appConfig.afrTransitionsFromFamily?this.options.appConfig.afrTransitionsFromFamily[e]:null},getExecutionContext:function(){return this._executionContext},getFrameWindow:function(){return this._frmWindow},getStartTimeApp:function(){return this.options.startTimeApp},getId:function(){return this.options.id},getUUID:function(){return this.options.uuid},getAfrAppId:function(){return this.options.afrAppId},getTitle:function(){return this.options.appTitle},getBrand:function(){return this.options.brand},getFamily:function(){return this.options.appConfig.afrFamily},onWillEnter:function(t){return e.Class.Promise.resolve()},onWillLeave:function(t){return e.Class.Promise.resolve()},setUp:function(e){e.done&&e.done()},setUpWS:function(t){return t.done?t.done():e.Class.Promise.resolve()},isDisposeCalled:function(){return this._disposeCalled},dispose:function(t){e.extend(e.clone(this.disposeOptions),t).disposeFrameWindow&&this._frmWindow&&(this._frmWindow.dispose(),this._frmWindow=void 0),this._disposeCalled=!0},getContainer:function(){return this._container},setContainer:function(e){this._container=e,this._container&&this._container.addEvent&&(this._container.addEvent("onDestroy",this.onContainerDestroy.bind(this)),this._container.addEvent("onRefresh",this.onContainerRefresh.bind(this)))},onContainerDestroy:function(e){this.dispose()},onContainerRefresh:function(e){},switchApp:function(e){"ENOR3D_AP"!==this.options.id&&"ENX3DIR_AP"!==this.options.id&&"ENOI3D_AP"!==this.options.id||this._executionContext.switchApp(e)},getNativeInformation:function(){return this.options.nativeInformation},isDefaultPage:function(){return this.options.defaultPage}});return r.inherits=function(e){e.prototype=Object.create(r.prototype,{constructor:{value:e,enumerable:!1}})},r}));var wafrVersion="WAFR2.0";define("DS/WAfrAppManager/mod_AppManager",["UWA/Class/Promise","DS/WAfrUtils/Logger","DS/WAfrUtils/mod_ConcatenationUtils","i18n!DS/WAfrContainer/assets/nls/Notification"],(function(e,t,n,r){"use strict";var i=Object.create(null);const o=n.hasConfigurationFor;var a=function(e){this._options=e};return a.DEFAULT_COMPONENT_NAME="AFR_AppManager",a.prototype.setCurrentConfig=function(e){this._config=e},a.prototype.initialize=function(){this._executionContext=this.getExecutionContext(),this._container=this._executionContext._container;var e=this._executionContext.getComponent(WAfrStandardComponentKey.ModelEvents);if(this._subscriptionsTokens=[],e){var t=this;["onWillLoadApp","onDidLoadApp","onDidFailToLoadApp"].forEach((function(n){let r=e.subscribe({event:n},t[n].bind(t));t._subscriptionsTokens.push(r)}))}return Promise.resolve()},a.prototype.clean=function(){this._executionContext=this.getExecutionContext(),this._container=this._executionContext._container;var e=this._executionContext.getComponent(WAfrStandardComponentKey.ModelEvents);e&&this._subscriptionsTokens.forEach((function(t){e.unsubscribe(t)}))},a.prototype.onWillLoadApp=function(e){this._appId=e,this._sourceApp=this._executionContext.getSourceApp()},a.prototype.onDidLoadApp=function(){if(void 0===this._executionContext._masterAppId){var e=this._executionContext.getSourceApp();void 0===e.options.brand&&(this._container._view.getValue("brand")?e.options.brand=this._container._view.getValue("brand"):this._container._view.getTitleHeader().brand&&(e.options.brand=this._container._view.getTitleHeader().brand));var t=this._executionContext.getComponent(WAfrStandardComponentKey.NotificationManager);this._appId=e.getId();var n=this._sourceApp?this._sourceApp.getTitle()||this._container._view.getTitleHeader().appTitle||this._sourceApp.getId():null,i=this._container._view.getValue("afrExecutionContexts");if(!i)throw new Error("The persisted contexts must not be undefined");i[this._container._currentExecutionContext].currentappId=e.getId(),this._container._view.setValue("afrCode",e.getIdCard().afrCode),this._container._view.setValue("afrExecutionContexts",i.slice()),this._container._view.setValue("afrCurrentExecutionContextIdx",this._container._currentExecutionContext),this._container._view.setValue("afrAppId",e.getAfrAppId()),this._container._view.setValue("appId",e.getId()),this._container._view.setValue("afrPrdId",e.getId()),this._container._view.setBrand(e.options.brand),this._container._view.setValue("appTitle",e.getTitle()),this._container.updateAppTitle(e.getTitle()),this._container.updateTitle({title:this._container.productTitle},e),this._container._view.setValue("brand",e.getBrand()||this._container._view.getValue("brand")),this._container._view.setValue("afrFamily",e.getIdCard().afrFamily),this._container._view.setValue("afrTransitionsFrom",e.getIdCard().afrTransitionsFrom),this._container._view.setValue("afrTransitionsFromFamily",e.getIdCard().afrTransitionsFromFamily),this._container._view.setValue("afrTransitionsTo",e.getIdCard().afrTransitionsTo),this._container._view.setValue("afrTransitionsToFamily",e.getIdCard().afrTransitionsToFamily),this._container._view.setValue("afrStdConf",e.getIdCard().stdConf);var a=e.getTitle(),s={containerId:this._container.id,contextId:this._executionContext.getId(),targetApp:{options:e.options}};s.targetApp.options.appConfig.appId=e.getId(),this._container.publish("onAppReady."+this._appId,s);if(o(e.getIdCard(),"a2x"))this._container._view.setValue("nativeInformation",e.getNativeInformation()),this._container._view.setValue("defaultPage",e.isDefaultPage()),this._container.publish("TransEnd",s);else if(n){var d,c={};d="WAfrTransitionSuccessful",c[0]=a,c[1]=n;var l=r.get(d+".message"),p=r.get(d+".title");c&&l&&(l=r.replace(l,c)),t&&t.notifySuccess({title:p,message:l})}this._appId=null,this._sourceApp=null}},a.prototype.onDidFailToLoadApp=function(e){const n=this._executionContext.getComponent(WAfrStandardComponentKey.NotificationManager),i=this._executionContext.getTargetApp()&&this._executionContext.getTargetApp().getTitle(),o={containerId:this._container.id,contextId:this._executionContext.getId()};let a=this._sourceApp?"WAfrTransitionFailed":"WAfrLoadingFailed";var s={0:i};if(i){s[1]=e&&e.message||"";var d=r.get(a+".message");d=r.replace(d,s);var c=r.get(a+".title");n&&n.notifyError({title:c,message:d})}e&&(t.severe("Error when loading configuration \n"+e.stack),o.error={name:e?e.name:"Error",message:e?e.message:""}),this._container.publish("onAppFail."+this._appId,o)},a.prototype.createExposedComponent=function(){return{launchApp:this.getExecutionContext()._container.launchApp.bind(this.getExecutionContext()._container)}},i.AppManager=a,i})),define("DS/WAfrHandlers/private/private_CheckHandlerUtilities",["DS/CoreUtilities/ErrorManagement","DS/WAfrHandlers/private/private_Utilities"],(function(e,t){"use strict";let n=Object.create(null);return n.executeCheckHandler=function(n,r){if(!n)throw new Error("checkHandler has to be defined and cannot be null");const i=n.getHandlerComponent();if(!i)throw new Error("handlerComponent must be defined.");if(!i.getExecutionContext())throw new Error("Execution Context not found.");if(!r||void 0===r.action||"boolean"!=typeof r.action)throw new Error("Wrong parameters");let o=!0;(n.beingInitialized()||n._private._isChecked!==r.action)&&(n._private._isChecked=r.action,function(e){const t=e.getHandlerComponent();if(!t)throw new Error("There is no HandlerComponent related to this CheckHandler",e);const n=t.getEventChannel();if(!n)throw new Error("Retrieved eventChannel is undefined");const r=e.getId();if(!r)throw new Error("handlerIdentfier has to be a non empty string.");const i=e._private._isChecked?"/CHECK":"/UNCHECK";n.publish({event:r+i})}(n),n._private._isChecked?n._private._check&&void 0!==n._private._check._private._type&&(o=!1,t.executeHandlerFunctions[n._private._check._private._type]({handler:n._private._check,cb:r.cb,args:r.args})):n._private._uncheck&&void 0!==n._private._uncheck._private._type&&(o=!1,t.executeHandlerFunctions[n._private._uncheck._private._type]({handler:n._private._uncheck,cb:r.cb,args:r.args}))),o&&r.cb&&setTimeout((function(){const t=e.getErrorManager(),n=e.createReturnObject(t.SUCCEEDED);r.cb(n)}),0)},n})),define("DS/WAfrHandlers/mod_HandlerComponent",["DS/CoreUtilities/ErrorManagement","DS/CoreEvents/ModelEvents","DS/WAfrHandlers/private/private_Utilities","DS/WAfrUtils/mod_Performances"],(function(e,t,n,r){"use strict";var i=r.Performances,o="[DS/WAfrHandlers/mod_HandlerComponent]",a=Object.create(null);function s(t){if(!(this&&this.resolve&&this.reject&&t))throw new Error;e.hasSucceeded(t)?this.resolve(t):this.reject(t)}a.DEFAULT_COMPONENT_NAME="AFR_HandlerComponent";var d=Object.create(null);function c(e,t,n){if(!(e&&t&&n&&e._private.hasOwnProperty(t)))throw new Error;const r=e._private[t],i=n.getId();if(!r||!i)throw new Error;if(!n.setHandlerComponent(e))throw new Error;r[i]=n}function l(e,t,n){if(!(e&&t&&n&&e._private.hasOwnProperty(t)))throw new Error;const r=e._private[t],i=n.getId();if(!r||!i)throw new Error;if(!n.setHandlerComponent(null))throw new Error;delete r[i]}function p(){return Promise.resolve()}function h(e,t){const n=e._perf.start([o,"cleanUpHandlers"].join(" ")),r=d.HandlerMap;for(var i in r)if(r.hasOwnProperty(i)){const n=r[i],o=e._private[n];for(let e in o)o.hasOwnProperty(e)&&o[e].destroy();delete e._private[n],t&&(e._private[n]={})}e._perf.stop(n)}function u(e,t){let n={};if(void 0!==t&&e&&e._private&&e._private._hdlrMap){const i=e._private._hdlrMap;for(var r in i)if(i.hasOwnProperty(r)){const o=i[r]._private._type;e.hasHandler(r)&&o===t&&(n[r]=e._private._hdlrMap[r])}}return n}d.HandlerMap={HANDLER:"_hdlrMap",CHECK_HANDLER:"_chkHdlrMap",RADIO_HANDLER:"_radioHdlrMap"};class m{constructor(){this._perf=new i,this._private={};var e=d.HandlerMap;for(var n in e)if(e.hasOwnProperty(n)){var r=e[n];this._private[r]={}}this._private._eventChannel=new t}getExposedComponentCtor(){const e=this;function t(){}return t.prototype.initialize=p,t.prototype.clean=p,t.prototype.destroy=p,t.prototype.hasHandler=e.hasHandler.bind(e),t.prototype.executeHandler=e.executeHandler.bind(e),t.prototype.hasCheckHandler=e.hasCheckHandler.bind(e),t.prototype.toggleCheck=e.toggleCheck.bind(e),t.prototype.setCheckState=e.setCheckState.bind(e),t.prototype.getCheckState=e.getCheckState.bind(e),t.prototype.hasRadioHandler=e.hasRadioHandler.bind(e),t.prototype.toggleRadioItemState=e.toggleRadioItemState.bind(e),t.prototype.setRadioItemState=e.setRadioItemState.bind(e),t.prototype.getRadioItemState=e.getRadioItemState.bind(e),t.prototype.enableHandler=e.enableHandler.bind(e),t.prototype.disableHandler=e.disableHandler.bind(e),t.prototype.isHandlerExecutable=e.isHandlerExecutable.bind(e),t.prototype.enableCheck=e.enableCheck.bind(e),t.prototype.disableCheck=e.disableCheck.bind(e),t.prototype.isCheckExecutable=e.isCheckExecutable.bind(e),t.prototype.enableRadio=e.enableRadio.bind(e),t.prototype.disableRadio=e.disableRadio.bind(e),t.prototype.isRadioExecutable=e.isRadioExecutable.bind(e),t}initialize(){return Promise.resolve()}async configure(){const e={ActionHandler:"executeHandler",CommandHandler:"executeHandler",CheckHandler:"setCheckState",RadioHandler:"setRadioItemState"},t=this._private._initializationData||[];for(let n=0;n<t.length;++n){const r=t[n],i=e[r.type];try{r&&void 0!==r.wait&&!0!==r.wait?this[i](r):await this[i](r)}catch(e){if(!e||!e.getError||"NOT_EXECUTABLE"!==e.getReturnValue().internalValue)throw e}}return function(e){if(!e)throw new Error("handlerComponent has to be defined");const t=e._perf,n=t.start([o,"manageDefaultCommand"].join(" ")),r=e._private._defaultCommandIdentifier;return new Promise((function(i,o){if(r){const a=e.getExecutionContext();a?require(["DS/WAfrCommandsArchitecture/mod_CommandsManagerComponent"],(function(s){const d=a.getComponent(s.CommandsManagerComponent.DEFAULT_COMPONENT_NAME);d?(d.subscribeOnceToCmdState(r,"begin",(function(){return t.stop(n),i()})),d.setDefaultCommand(r),delete e._private._defaultCommandIdentifier):(t.stop(n),o(new Error("No commandsManagerComponent found using this executionContext",a)))}),(function(){t.stop(n),o(new Error("Require failed (DS/WAfrCommandsArchitecture/mod_CommandsManagerComponent)"))})):(t.stop(n),o(new Error("executionContext is undefined")))}else t.stop(n),i()}))}(this)}async configureHandlerbyId(e){if(!this._private._initializationData){const t=this._private._initializationData.indexOf(e);if(-1!=t){await this.configureHandler(this._private._initializationData[t]);const e={ActionHandler:"executeHandler",CommandHandler:"executeHandler",CheckHandler:"setCheckState",RadioHandler:"setRadioItemState"},n=this._private._initializationData[t],r=e[n.type];try{n&&void 0!==n.wait&&!0!==n.wait?this[r](n):await this[r](n)}catch(e){if(!e||!e.getError||"NOT_EXECUTABLE"!==e.getReturnValue().internalValue)throw e}}}}async configureHandler(e){const t={ActionHandler:"executeHandler",CommandHandler:"executeHandler",CheckHandler:"setCheckState",RadioHandler:"setRadioItemState"}[e.type];try{e&&void 0!==e.wait&&!0!==e.wait?this[t](e):await this[t](e)}catch(e){if(!e||!e.getError||"NOT_EXECUTABLE"!==e.getReturnValue().internalValue)throw e}}clean(){return h(this,!0),this._private._eventChannel.unsubscribeAll(),this._private._availabilityModesComponent=null,this._private._defaultCommandIdentifier=void 0,Promise.resolve()}destroy(){return h(this,!1),this._private._eventChannel.destroy(),delete this._private._eventChannel,delete this._private._availabilityModesComponent,Promise.resolve()}getEventChannel(){return this._private._eventChannel}setInitializationDefaultCommand(e){if(!e||"string"!=typeof e)throw new Error("commandIdentifier has to be a string");this._private._defaultCommandIdentifier=e}setInitializationData(e){if(!Array.isArray(e))throw new Error("data has to be an array");this._private._initializationData=e}addInitializationData(e){if(!Array.isArray(e))throw new Error("data has to be an array");this._private._initializationData?this._private._initializationData=this._private._initializationData.concat(e):this._private._initializationData=e}setAvailabilityModesComponent(e){if(void 0===e)throw new Error("component has to be defined");if(null!==e&&this._private._availabilityModesComponent)throw new Error("There is already one AvailabilityModesComponent attached to this HandlerComponent");this._private._availabilityModesComponent=e}getAvailabilityModesComponent(){return this._private._availabilityModesComponent}hasHandler(e){return Object.hasOwn(this._private._hdlrMap,e)}addHandler(e){c(this,d.HandlerMap.HANDLER,e)}removeHandler(e){l(this,d.HandlerMap.HANDLER,e)}hasCheckHandler(e){return Object.hasOwn(this._private._chkHdlrMap,e)}addCheckHandler(e){c(this,d.HandlerMap.CHECK_HANDLER,e)}removeCheckHandler(e){l(this,d.HandlerMap.CHECK_HANDLER,e)}hasRadioHandler(e){return Object.hasOwn(this._private._radioHdlrMap,e)}addRadioHandler(e){c(this,d.HandlerMap.RADIO_HANDLER,e)}removeRadioHandler(e){l(this,d.HandlerMap.RADIO_HANDLER,e)}executeHandler(t){if(t&&t.cb)throw new Error;const n=this;return new Promise((function(r,i){var o=e.getErrorManager();t||i(e.createReturnObject(o.MISSING_PARAMETERS,{description:"parameters has to be defined"}));const a=t.id;a&&"string"==typeof a||i(e.createReturnObject(o.MISSING_PARAMETERS,{description:"parameters.id has to be defined"})),n.hasHandler(a)?n._private._hdlrMap[a].execute({cb:s.bind({resolve:r,reject:i}),args:t.args}):i(e.createReturnObject(o.FAILED,{description:"No Handler corresponding to the following id: "+a}))}))}toggleCheck(t){if(t&&t.cb)throw new Error;const n=this;return new Promise((function(r,i){const o=e.getErrorManager();t||i(e.createReturnObject(o.MISSING_PARAMETERS,{description:"parameters has to be defined"}));const a=t.id,d=t.args;if(a&&"string"==typeof a||i(e.createReturnObject(o.MISSING_PARAMETERS,{description:"parameters.id has to be defined"})),n.hasCheckHandler(a)){const e=n._private._chkHdlrMap[a],t=e.getState();e.setState({state:!t,cb:s.bind({resolve:r,reject:i}),args:d})}else i(e.createReturnObject(o.FAILED,{description:"No CheckHandler corresponding to the following id: "+a}))}))}setCheckState(t){if(t&&t.cb)throw new Error;const n=this;return new Promise((function(r,i){const o=e.getErrorManager();t||i(e.createReturnObject(o.MISSING_PARAMETERS,{description:"parameters has to be defined"}));const a=t.id,d=t.state,c=t.args;a&&"string"==typeof a||i(e.createReturnObject(o.MISSING_PARAMETERS,{description:"parameters.id has to be defined"})),void 0!==d&&"boolean"==typeof d||i(new Error),n.hasCheckHandler(a)?n._private._chkHdlrMap[a].setState({state:d,cb:s.bind({resolve:r,reject:i}),args:c}):i(e.createReturnObject(o.FAILED,{description:"No CheckHandler corresponding to the following id: "+a}))}))}getCheckState(e){if(!e)throw new Error;const t=e.id;if(!t||"string"!=typeof t)throw new Error;if(!this.hasCheckHandler(t))throw new Error;return this._private._chkHdlrMap[t].getState()}toggleRadioItemState(t){if(t&&t.cb)throw new Error;const n=this;return new Promise((function(r,i){const o=e.getErrorManager();t||i(e.createReturnObject(o.MISSING_PARAMETERS,{description:"parameters has to be defined"}));const a=t.id,d=t.radioId,c=t.args;a&&"string"==typeof a||i(e.createReturnObject(o.MISSING_PARAMETERS,{description:"parameters.id has to be defined"})),d&&"string"==typeof d||i(e.createReturnObject(o.MISSING_PARAMETERS,{description:"parameters.radioId has to be defined"}));const l=n._private._radioHdlrMap;if(n.hasRadioHandler(d)){const e=!l[d].getRadioItemState(a);l[d].setRadioItemState({radioHdlrItemId:a,state:e,cb:s.bind({resolve:r,reject:i}),args:c})}else i(e.createReturnObject(o.FAILED,{description:"No item corresponding to the following id: "+d}))}))}setRadioItemState(t){if(t&&t.cb)throw new Error;const n=this;return new Promise((function(r,i){var o=e.getErrorManager();t||i(e.createReturnObject(o.MISSING_PARAMETERS,{description:"parameters has to be defined"}));const a=t.id,d=t.radioId,c=t.state,l=t.args;a&&"string"==typeof a||i(new Error),d&&"string"==typeof d||i(e.createReturnObject(o.MISSING_PARAMETERS,{description:"parameters.id has to be defined"})),void 0!==c&&"boolean"==typeof c||i(e.createReturnObject(o.MISSING_PARAMETERS,{description:"parameters.state has to be defined"}));var p=n._private._radioHdlrMap;n.hasRadioHandler(d)?p[d].setRadioItemState({radioHdlrItemId:a,state:c,cb:s.bind({resolve:r,reject:i}),args:l}):i(e.createReturnObject(o.MISSING_PARAMETERS,{description:"No CheckHandler corresponding to the following id: "+a}))}))}getRadioItemState(e){if(!e)throw new Error;const t=e.id,n=e.radioId;if(!t||"string"!=typeof t)throw new Error;if(!n||"string"!=typeof n)throw new Error;const r=this._private._radioHdlrMap;if(!this.hasRadioHandler(n))throw new Error;return r[n].getRadioItemState(t)}enableHandler(e){if(!e||"string"!=typeof e)throw new TypeError("[HandlerComponent] enableHandler - id has to be defined.");const t=this._private._hdlrMap;if(!this.hasHandler(e))throw new Error(`[HandlerComponent] enableHandler - Handler not found: ${e}`);t[e].enable()}disableHandler(e){if(!e||"string"!=typeof e)throw new TypeError("[HandlerComponent] disableHandler - id has to be defined.");const t=this._private._hdlrMap;if(!this.hasHandler(e))throw new Error(`[HandlerComponent] disableHandler - Handler not found: ${e}`);t[e].disable()}isHandlerExecutable(e){if(!e||"string"!=typeof e)throw new TypeError("[HandlerComponent] isHandlerExecutable - id has to be defined.");const t=this._private._hdlrMap;if(!this.hasHandler(e))throw new Error(`[HandlerComponent] isHandlerExecutable - Handler not found: ${e}`);return t[e].isExecutable()}enableCheck(e){if(!e||"string"!=typeof e)throw new TypeError("[HandlerComponent] enableCheck - id has to be defined.");const t=this._private._chkHdlrMap;if(!this.hasCheckHandler(e))throw new Error(`[HandlerComponent] enableCheck - Handler not found: ${e}`);t[e].enable()}disableCheck(e){if(!e||"string"!=typeof e)throw new TypeError("[HandlerComponent] disableCheck - id has to be defined.");const t=this._private._chkHdlrMap;if(!this.hasCheckHandler(e))throw new Error(`[HandlerComponent] disableCheck - Handler not found: ${e}`);t[e].disable()}isCheckExecutable(e){if(!e||"string"!=typeof e)throw new TypeError("[HandlerComponent] isCheckExecutable - id has to be defined.");const t=this._private._chkHdlrMap;if(!this.hasCheckHandler(e))throw new Error(`[HandlerComponent] isCheckExecutable - Handler not found: ${e}`);return t[e].isExecutable()}enableRadio(e){if(!e||"string"!=typeof e)throw new TypeError("[HandlerComponent] enableRadio - id has to be defined.");const t=this._private._radioHdlrMap;if(!this.hasRadioHandler(e))throw new Error(`[HandlerComponent] enableRadio - Handler not found: ${e}`);t[e].enable()}disableRadio(e){if(!e||"string"!=typeof e)throw new TypeError("[HandlerComponent] disableRadio - id has to be defined.");const t=this._private._radioHdlrMap;if(!this.hasRadioHandler(e))throw new Error(`[HandlerComponent] disableRadio - Handler not found: ${e}`);t[e].disable()}isRadioExecutable(e){if(!e||"string"!=typeof e)throw new TypeError("[HandlerComponent] isRadioExecutable - id has to be defined.");const t=this._private._radioHdlrMap;if(!this.hasRadioHandler(e))throw new Error(`[HandlerComponent] isRadioExecutable - Handler not found: ${e}`);return t[e].isExecutable()}getActionHandlerMap(){return u(this,n.enums.HandlerType.ACTION_HANDLER)}getCommandHandlerMap(){return u(this,n.enums.HandlerType.COMMAND_HANDLER)}getLeafHandlerMaps(){let e=Object.create(null);if(e.actionHandlers={},e.commandHandlers={},this._private&&this._private._hdlrMap){const r=this._private._hdlrMap;for(var t in r)if(r.hasOwnProperty(t)){const i=r[t]._private._type;i===n.enums.HandlerType.ACTION_HANDLER?e.actionHandlers[t]=r[t]:i===n.enums.HandlerType.COMMAND_HANDLER?e.commandHandlers[t]=r[t]:console.warn("Unknown LeafHandler type",r[t]._private._type)}}return e}getCheckHandlerMap(){return this._private[d.HandlerMap.CHECK_HANDLER]}getRadioHandlerMap(){return this._private[d.HandlerMap.RADIO_HANDLER]}}return m.DEFAULT_COMPONENT_NAME=a.DEFAULT_COMPONENT_NAME,a.HandlerComponent=m,a})),define("DS/WAfrExecutionContext/mod_HomePageManager",["DS/WAfrUtils/Logger"],(function(e){"use strict";function t(e){return"mod_WelcomeScreen"===e}function n(e){return e.options&&e.options.welcomeScreen}function r(e){let t=[];return e&&e.components&&e.components.keep&&(t=e.components.keep),t}return{HomePageManager:class{constructor(){this._private=Object.create(null),this._private.homePageRequested=!1,this._private.homePageDisplayed=!1,this._private.componentKeys=[]}get homePageRequested(){return this._private.homePageRequested}set homePageRequested(e){this._private.homePageRequested=e}get homePageDisplayed(){return this._private.homePageDisplayed}set homePageDisplayed(e){this._private.homePageDisplayed=e}set componentKeys(e){if(!Array.isArray(e))throw new Error("componentKeys must be an array");this._private.componentKeys=e}get componentKeys(){return this._private.componentKeys}hasComponentKey(e){return this._private.componentKeys.includes(e)}removeComponentKey(e){const t=this._private.componentKeys.findIndex((t=>t===e));-1!==t&&this._private.componentKeys.splice(t,1)}isHomePageAvailableComponent(e){let r=!1;return(n(e)||t(e.key))&&(r=!0),r}parseComponent(e,t,n){let r=t;return this.homePageRequested&&(this.isHomePageAvailableComponent(e)?n.push(e.key):r=!1),r}async initializeSequence(t){e.log("[Home Page Manager] Initialize WS applicative components"),await t.initializeApplicativeComponents(t.createComponentIterator(this.componentKeys)),e.log("[Home Page Manager] Set Up the application Home Screen"),await this.setUp(t),this.homePageDisplayed=!0}async setUp(e){const t=e.getSourceApp(),n=e.getProcessingApplication();await new Promise(((e,r)=>{const i=n.setUpWS({sourceApp:t,done:e,failure:r});i&&i.then(e,r)}))}cleanComponentMetadata(e){if(this.homePageRequested){const t=e.getSourceApp(),i=e.getTargetApp();if(!t||!i)throw new Error("Missing sourceApp or targetApp");const o=i.getTransitionFrom(t.getId()),a=i.getTransitionFromFamily(t.getFamily());let s=[];s=r(o),s=s.concat(r(a));(t.getIdCard().components||[]).forEach((t=>{-1===s.indexOf(t.key)&&(n(t)||e.removeMetadata(t.key))}))}}},isHomePageComponent:t}})),define("DS/WAfrHandlers/mod_LeafHandler",["DS/WAfrHandlers/mod_Handler","DS/CoreUtilities/ErrorManagement"],(function(e,t){"use strict";const n=e.Handler;class r{constructor(e,t){if(!e||!t)throw new Error("handler and manager have to be defined");this._handler=e,this._manager=t}execute(e){return this._manager.handleExecute({cb:e.cb,manageable:this._handler,args:e.args})}setHandlerComponent(){return console.warn("Impossible to set a HandlerComponent to a LeafHandler which is managed."),!1}getHandlerComponent(){return this._manager.getHandlerComponent()}onAvailabilityChanged(e,t){const n=this._handler;return this._manager.handleOnAvailabilityChanged({manageable:n,args:{newValue:e,info:t}})}isExecutable(){return this._manager.handleIsExecutable({manageable:this._handler})}disable(){throw new Error("Impossible to disable a Managed Handler")}enable(){throw new Error("Impossible to enable a Managed Handler")}onIsEnabledChangeEvent(){throw new Error("Impossible to subscribe to isEnabledChangeEvent from a Managed Handler")}removeIsEnabledChangeEventSubscription(){throw new Error("Impossible to unsubscribe to isEnabledChangeEvent from a Managed Handler")}onIconChangedEvent(){throw new Error("Impossible to subscribe to onIconChangedEvent from a Managed Handler")}removeIconChangedEventSubscription(){throw new Error("Impossible to unsubscribe to removeIconChangedEventSubscription from a Managed Handler")}onIconChanged(e,t){const n=this._handler;return this._manager.handleOnIconChanged({manageable:n,args:{newValue:e,info:t}})}onI18nChangedEvent(){throw new Error("Impossible to subscribe to onI18nChangedEvent from a Managed Handler")}removeI18nEventSubscription(){throw new Error("Impossible to unsubscribe to removeI18nEventSubscription from a Managed Handler")}}let i=Object.create(null);return i.LeafHandler=class extends n{constructor(e){if(super(e),!e)throw new Error("Missing parameters. Please see the LeafHandler documentation to see the required parameters.");e.availabilityMode&&(this._private._availabilityMode=e.availabilityMode),this._private._currentAvailability=!0,e.icon&&(e.icon.uri||e.icon.fonticon)&&(this._private._icon=e.icon)}initAvailabilityModesSubscription(){const e=this.getHandlerComponent();if(!e)throw new Error("Impossible to retrieve the HandlerComponent.");const t=e.getAvailabilityModesComponent();if(!t)throw new Error("Impossible to retrieve the AvailabilityModesComponent.");return t.subscribe(this,!0).then(function(e){this._private._availabilityModesSubscriptionToken=e}.bind(this))}destroy(){super.destroy();const e=this.getHandlerComponent();if(!e)throw new Error("Impossible to retrieve the HandlerComponent.");const t=e.getAvailabilityModesComponent();t&&t.unsubscribe(this._private._availabilityModesSubscriptionToken)}getAvailabilityModesInfo(){return{modes:this._private._availabilityMode,currentAvailability:this._private._currentAvailability}}onAvailabilityChanged(e,t){return this._private._currentAvailability=e,this._private._handlerState.onAvailabilityChanged(e,t)}getIcon(){return this._private._icon}makeManaged(e){if(this._private._handlerState instanceof r)throw new Error("Call makeManaged method on an LeafHandler which is already managed");this._private._handlerState=new r(this,e)}isExecutable(){return this._private._handlerState.isExecutable()}disable(){return this._private._handlerState.disable()}enable(){return this._private._handlerState.enable()}onIsEnabledChangeEvent(e){return this._private._handlerState.onIsEnabledChangeEvent(e)}removeIsEnabledChangeEventSubscription(e){return this._private._handlerState.removeIsEnabledChangeEventSubscription(e)}onIconChangedEvent(e){}removeIconChangedEventSubscription(e){}onI18nChangedEvent(){}removeI18nEventSubscription(){}execute(e){if(e&&"object"!=typeof e)throw new Error("parameters has to be an object if defined");if(this.isExecutable())return this._private._handlerState.execute(e);e&&e.cb?setTimeout((function(){const n=t.getErrorManager(),r=t.createReturnObject(n.NOT_EXECUTABLE,{description:"This LeafHandler is not executable"});e.cb(r)}),0):console.warn("This LeafHandler is not executable",this.getId())}setArgs(e){if("object"!=typeof e)throw new Error("args has to be an object");this._private._args=e}getArgs(){return this._private._args}},i.StandaloneLeafHandlerState=class{constructor(e){if(!e)throw new Error("handler has to be defined");this._handler=e}execute(){throw new Error("execute has to be implemented on subclasses")}setHandlerComponent(e){if(void 0===e)throw new Error("component has to be defined");return this._handler._private._handlerComponent=e,!0}getHandlerComponent(){return this._handler._private._handlerComponent}onAvailabilityChanged(e){const t=this._handler;t._private._currentAvailability=e;const n=t.getHandlerComponent();if(!n)throw new Error("There is no HandlerComponent related to this LeafHandler",t);const r=n.getEventChannel();if(!r)throw new Error("Retrieved eventChannel is undefined");const i=t.getId();if(!i)throw new Error("handlerIdentfier has to be a non empty string.");r.publish({event:i+"/AVAILABILITY",data:{newValue:e}})}isExecutable(){return n.prototype.isExecutable.call(this._handler)}disable(...e){return n.prototype.disable.call(this._handler,...e)}enable(...e){return n.prototype.enable.call(this._handler,...e)}onIsEnabledChangeEvent(...e){return n.prototype.onIsEnabledChangeEvent.call(this._handler,...e)}removeIsEnabledChangeEventSubscription(...e){return n.prototype.removeIsEnabledChangeEventSubscription.call(this._handler,...e)}onIconChangedEvent(e){if(!e||"function"!=typeof e)throw new Error("cb has to be a function",e);const t=this.getHandlerComponent();if(!t)throw new Error("There is no HandlerComponent related to this Handler",this);const n=t.getEventChannel();if(!n)throw new Error("Retrieved eventChannel is undefined");const r=this.getId();if(!r)throw new Error("handlerIdentifier has to be a non empty string.");return n.subscribe({event:r+"/ICON",data:{newValue:newValue}})}removeIconChangedEventSubscription(e){if(void 0===e)throw new Error("token has to be defined");const t=this.getHandlerComponent();if(!t)throw new Error("There is no HandlerComponent related to this Handler",this);const n=t.getEventChannel();if(!n)throw new Error("Retrieved eventChannel is undefined");if(!this.getId())throw new Error("handlerIdentifier has to be a non empty string.");return n.unsubscribe(e)}onI18nChangedEvent(e){if(!e||"function"!=typeof e)throw new Error("cb has to be a function",e);const t=this.getHandlerComponent();if(!t)throw new Error("There is no HandlerComponent related to this Handler",this);const n=t.getEventChannel();if(!n)throw new Error("Retrieved eventChannel is undefined");const r=this.getId();if(!r)throw new Error("handlerIdentifier has to be a non empty string.");return n.subscribe({event:r+"/TITLE"},e)}removeI18nEventSubscription(e){if(void 0===e)throw new Error("token has to be defined");const t=this.getHandlerComponent();if(!t)throw new Error("There is no HandlerComponent related to this Handler",this);const n=t.getEventChannel();if(!n)throw new Error("Retrieved eventChannel is undefined");if(!this.getId())throw new Error("handlerIdentifier has to be a non empty string.");return n.unsubscribe(e)}},i.ManagedLeafHandlerState=r,i})),define("DS/WAfrHandlers/private/private_RadioHandlerUtilities",["DS/CoreUtilities/ErrorManagement","DS/WAfrHandlers/private/private_CheckHandlerUtilities"],(function(e,t){"use strict";let n=Object.create(null);return n.fireEvent=function(e,t,n){if(!e||!t||void 0===n)throw new Error("radioHandler, itemIdentifier and state has to be defined");const r=e.getHandlerComponent();if(!r)throw new Error("There is no HandlerComponent related to this RadioHandler",e);const i=r.getEventChannel();if(!i)throw new Error("Retrieved eventChannel is undefined");const o=e.getId();if(!o)throw new Error("radioHandlerIdentifier has to be a non empty string.");const a="/"+t,s=n?"/SELECT":"/UNSELECT";i.publish({event:o+a+s})},n.checkOnUncheck=function(r){if(!(this&&this.manager&&this.manageable&&r))throw new Error("Internal error. Manageable has to be defined");if(e.hasSucceeded(r))n.fireEvent(this.manager,this.manageable.getId(),!0),t.executeCheckHandler(this.manageable,{cb:this.cb,action:!0,args:this.args});else{if(!this.cb)throw r.getError();this.cb(r)}},n.isManagedByRadioHandler=function(e,t){let n=!1,r=0;const i=t._private._elements.length;for(;!n&&r<i;)t._private._elements[r]===e&&(n=!0),++r;return n},n})),define("DS/WAfrHandlers/private/private_CommandHandlerUtilities",["DS/CoreUtilities/ErrorManagement","DS/WAfrHandlers/private/private_Utilities"],(function(e,t){"use strict";let n=Object.create(null);function r(t){if(!this)throw new Error("this (commandHandler) is undefined.");if(this.getState()!==n.HandlerState.ENDED)throw new Error("The command ended with the status Stated");if(!t||!t.notStarted)for(let n=0;n<this._private._appCB.length;n++)if(this._private._appCB[n]&&"function"==typeof this._private._appCB[n]){if(!t){const n=e.getErrorManager();t=e.createReturnObject(n.SUCCEEDED)}this._private._appCB[n](t)}}return n.CmdMode={EXCLUSIVE:0,NESTED:1},n.RepeatMode={NEVER:0,STANDARD:1,ALWAYS:2},n.LifeCycleEvents={BEGIN:"BEGIN",PAUSE:"PAUSE",RESUME:"RESUME",CANCEL:"CANCEL",COMPUTE:"COMPUTE",END:"END"},n.HandlerState={EXECUTING:"EXECUTING",PAUSED:"PAUSED",CANCELED:"CANCELED",ENDING:"ENDING",COMPUTING:"COMPUTING",ENDED:"ENDED"},n.isValidHandlerState=function(e){return Boolean(e)&&this.HandlerState.hasOwnProperty(e)},n.executeCommandHandler=function(e){if(!e||!e.handler)throw new Error("parameters.handler has to be defined");e.args=t.computeArgs(e.handler,e.args),e.handler._private._cmdsManager.stackCommandExecutionRequest(r.bind(e.handler),e)},n})),define("DS/WAfrHandlers/mod_CommandHandler",["DS/WAfrHandlers/private/private_Utilities","DS/WAfrHandlers/private/private_CommandHandlerUtilities","DS/WAfrHandlers/mod_LeafHandler"],(function(e,t,n){"use strict";const r=n.LeafHandler,i=n.StandaloneLeafHandlerState,o="COMMAND_HANDLER";e.registerLeafHandler(o,{executeFunc:t.executeCommandHandler});let a=Object.create(null);function s(e){return Boolean(e)&&a.LifeCycleEvents.hasOwnProperty(e)}a.CmdMode={EXCLUSIVE:t.CmdMode.EXCLUSIVE,NESTED:t.CmdMode.NESTED},a.RepeatMode={NEVER:t.RepeatMode.NEVER,STANDARD:t.RepeatMode.STANDARD,ALWAYS:t.RepeatMode.ALWAYS},a.LifeCycleEvents={BEGIN:t.LifeCycleEvents.BEGIN,PAUSE:t.LifeCycleEvents.PAUSE,RESUME:t.LifeCycleEvents.RESUME,CANCEL:t.LifeCycleEvents.CANCEL,COMPUTE:t.LifeCycleEvents.COMPUTE,END:t.LifeCycleEvents.END};class d extends i{constructor(e){super(e)}execute(e){const n=e?e.cb:void 0,r=e?e.args:void 0;return t.executeCommandHandler({handler:this._handler,cb:n,args:r})}}return a.CommandHandler=class extends r{constructor(t){if(super(t),!t)throw new Error("DS/WAfrHandlers/mod_CommandHandler.CommandHandler: parameters has to be defined");if(!t.module||"string"!=typeof t.module)throw new Error("DS/WAfrHandlers/mod_CommandHandler.CommandHandler: parameters.module has to be defined and to be a non empty string");if(!t.cmdsManager||"object"!=typeof t.cmdsManager)throw new Error("DS/WAfrHandlers/mod_CommandHandler.CommandHandler: parameters.cmdsManager has to be defined and to be Object of type DS/WAfrCommandsArchitecture/mod_CommandsManagerComponent");if(t.dynamicModeModule||t.dynamicModeFunction){if(!t.dynamicModeModule)throw new Error("DS/WAfrHandlers/mod_CommandHandler.CommandHandler: the handler has a compute mode function field but no compute mode module");if(!t.dynamicModeFunction)throw new Error("DS/WAfrHandlers/mod_CommandHandler.CommandHandler: the handler has a compute mode module field but no compute mode function");if(void 0!==t.cmdMode)throw new Error("DS/WAfrHandlers/mod_CommandHandler.CommandHandler: the command handler has a mode declared although it shall compute its mode. Either remove the computed mode fields or the mode field from the wafrac.")}this._private||(this._private=Object.create(null)),this._private._type=e.enums.HandlerType[o],this._private._command=Object.create(null),this._private._command._module=t.module,this._private._command._instance=null,this._private._command._mode=t.cmdMode?t.cmdMode:a.CmdMode.EXCLUSIVE,this._private._command._dynamicModeModule=t.dynamicModeModule?t.dynamicModeModule:null,this._private._command._dynamicModeFunction=t.dynamicModeFunction?t.dynamicModeFunction:null,this._private._repeatMode=t.repeatMode?t.repeatMode:a.RepeatMode.NEVER,this._private._cmdsManager=t.cmdsManager,this._private._useComputeServer=!!t.computeServer&&t.computeServer,this._private._cb=null,this._private._cbIfCommandNotStarted=null,this._private._handlerState=new d(this)}makeStandalone(){if(this._private._handlerState instanceof d)throw new Error("Call makeStandalone method on an CommandHandler which is already a standalone item");this._private._handlerState=new d(this)}execute(e){super.execute(e)}getMode(){return this._private._command._mode}isDynamic(){return null!==this._private._command._dynamicModeModule&&null!==this._private._command._dynamicModeFunction}setMode(e){if("string"!=typeof e&&"number"!=typeof e||!t.CmdMode.hasOwnProperty(e)&&(e<0||e>t.CmdMode.NESTED))throw new Error("CommandHandler.setMode : command mode value illegal. The command mode must be defined on mod_CommandHandler.CmdMode");if(this._private._command._instance)throw new Error("CommandHandler.setMode : command mode cannot be changed during command execution");this._private._command._mode=e}getRepeatMode(){return this._private._repeatMode}setRepeatMode(e){if("number"!=typeof e||e<0||e>t.RepeatMode.ALWAYS)throw new Error("CommandHandler.setRepeatMode : command repeat mode value illegal. The command repeat mode must be defined on mod_CommandHandler.RepeatMode");this._private._repeatMode=e}getCSIdentifier(){return this._private._command._instance}isUsingComputeServer(){return this._private._useComputeServer}setHandlerComponent(e){return this._private._handlerState.setHandlerComponent(e)}getHandlerComponent(){return this._private._handlerState.getHandlerComponent()}setStateAndSendEvent(e){if(!e||!e.state)throw new Error("parameters has to be defined with a non empty and valid state property (mod_CommandHandler.HandlerState) ");const n=e.state.toUpperCase();if(!t.isValidHandlerState(e.state))throw new Error("There is no state corresponding to the event "+e.state+" for a CommandHandler");if(this._private._command._state=t.HandlerState[n],e.event){const n=e.event.toUpperCase();if(s(n)){const r=this.getHandlerComponent();if(!r)throw new Error("There is no HandlerComponent related to this CommandHandler",this);const i=r.getEventChannel();if(!i)throw new Error("Retrieved eventChannel is undefined");const o=this.getId();if(!o)throw new Error("handlerIdentifier has to be a non empty string.");i.publish({event:o+"/"+t.LifeCycleEvents[n],data:{repeated:e.repeated,canceled:e.canceled,notStarted:e.notStarted}})}}}getState(){return this._private._command._state}onLifeCycleEvent(e,t){if(!e||"string"!=typeof e)throw new Error("identifier has to be a non empty string");const n=e.toUpperCase();if(!s(n))throw new Error("The given identifier is not supported by an CommandHandler",e);if(!t||"function"!=typeof t)throw new Error("cb has to be a function",t);const r=this.getHandlerComponent();if(!r)throw new Error("There is no HandlerComponent related to this CommandHandler",this);const i=r.getEventChannel();if(!i)throw new Error("Retrieved eventChannel is undefined");const o=this.getId();if(!o)throw new Error("handlerIdentifier has to be a non empty string.");return i.subscribe({event:o+"/"+n},t)}removeLifeCycleEventSubscription(e){if(void 0===e)throw new Error("token has to be defined");const t=this.getHandlerComponent();if(!t)throw new Error("There is no HandlerComponent related to this CommandHandler",this);const n=t.getEventChannel();if(!n)throw new Error("Retrieved eventChannel is undefined");if(!this.getId())throw new Error("handlerIdentifier has to be a non empty string.");return n.unsubscribe(e)}},a})),define("DS/WAfrCommandsArchitecture/mod_CommandsManagerComponent",["DS/WAfrHandlers/private/private_CommandHandlerUtilities","DS/WAfrHandlers/mod_HandlerComponent","DS/CoreEvents/ModelEvents","DS/CoreEvents/Events","DS/CoreUtilities/ErrorManagement","DS/WAfrUtils/mod_Performances","DS/WAfrUtils/Logger","DS/Utilities/UUID","DS/WAfrModelEvents/mod_ModelEvents"],(function(e,t,n,r,i,o,a,s,d){"use strict";const c=d.DEFAULT_COMPONENT_NAME,l={DYNAMIC_COMMAND_CANCELED:"Dynamic Command Canceled",COMPUTE_COMMAND_MODE_FAILED:"Dynamic Command Mode computation failed",CLIENT_COMPUTE_COMMAND_MODE_FAILED:"Applicative Code for Dynamic Command Mode computation failed"};let p=[i.generateReturnValue("COMMAND_NOT_STARTED",!1)],h=i.getErrorManager(p,{merge:!1});var u={exclusiveCmdCalled:0,secondExecuteCalled:1,killedByInfra:2,askedByCmd:3};const m={CANCELED:"Canceled",VALIDATED:"Validated"};function _(e){const t=e.getI18n?.()?e.getI18n():null;return{pd1:e._private._cmdUUID,pd2:t?t.title:"None",pd3:e._private._handlerTrigger}}var f=!1;function g(e,t){f&&console.log(t+" : "+e)}let v=!1;function C(e){if(e.commandHandlerId){if(!e.executionCtx)throw new Error("mod_commandsManagerComponent.js cannot execute a command without an execution context");var n=e.executionCtx.getComponent(t.DEFAULT_COMPONENT_NAME);if(!n)throw new Error("mod_commandsManagerComponent.js cannot execute a command without a handler component registered on the execution context");n.executeHandler({id:e.commandHandlerId})}}function E(t){if(t.cmdsManager._private._runningCmd)throw new Error("CmdsManager.runNextCmd a command is already running");if(t.cmdsManager._private._currentExecutionDone){var n;if(t.cmdsManager._private._executionChain.length>0&&(n=t.cmdsManager._private._executionChain[0].caller.cmdHandler),t.cmdsManager._private._pausedCmds.length>0&&(!t.cmdsManager._private._waitingExecution||n===t.cmdsManager._private._pausedCmds[0]||n.getMode()!==e.CmdMode.NESTED)){var r=Object.create(null);return r.cmdsManager=t.cmdsManager,r.cmdHandler=t.cmdsManager._private._pausedCmds.pop(),void function(t){g("resume",t.cmdHandler.getId()),t.cmdHandler.setStateAndSendEvent({state:e.HandlerState.EXECUTING,event:e.LifeCycleEvents.RESUME}),t.cmdsManager._private._runningCmd=t.cmdHandler,t.cmdHandler._private._command._instance.resumeExecute?(t.cmdHandler._private._command._instance.done=R.bind(t),H({callback:t.cmdHandler._private._command._instance.resumeExecute,caller:t.cmdHandler._private._command._instance})):H({callback:R,caller:t});if(H({callback:function(){t.cmdsManager._private._currentExecutionDone&&b(t.cmdHandler)&&M.call(t.cmdsManager)}}),t.cmdsManager._private._modelEvents.publish({event:t.cmdHandler.getId()+"/resume"}),t.cmdsManager._private._modelEvents.publish({event:"resume",data:t.cmdHandler.getId()}),t.cmdHandler){const e=_(t.cmdHandler),n=t.cmdsManager.getExecutionContext?.()?t.cmdsManager.getExecutionContext():null,r=n.getSourceApp?.()?n.getSourceApp():null,i={id:t.cmdHandler.getId()?t.cmdHandler.getId():"",appID:r?.getId()||"",pds:e},o=n.getComponent(c);o?o.publish({event:"command_resume",data:i}):console.error("Model events is undefined")}}(r)}if(0===t.cmdsManager._private._waitingExecution&&t.cmdsManager._private._currentExecutionDone){var i=t.cmdsManager.getDefaultCommand();i&&C({commandHandlerId:i,executionCtx:t.cmdsManager.getExecutionContext()})}setTimeout((function(){t.cmdsManager._private._waitingExecution||t.cmdsManager._private._executionChain.length>0?M.call(t.cmdsManager):t.cmdsManager._private._currentExecution&&t.cmdsManager._private._currentExecutionDone&&(t.cmdsManager._private._currentExecution=null)}),0)}}function b(t){return t.getState()===e.HandlerState.EXECUTING}var w=new Array(50),y=0;function A(){for(var e=0;e<y;e+=3){var t=w[e],n=w[e+1],r=w[e+2];t.call(n,r),w[e]=void 0,w[e+1]=void 0,w[e+2]=void 0}y=0}function H(e){w[y]=e.callback,w[y+1]=e.caller,w[y+2]=e.arg,3===(y+=3)&&setTimeout(A,0)}function I(e){if(!e.caller.cmdsManager._private._currentExecutionDone)throw new Error("begin forbidden");return e.caller.cmdsManager._private._waitingExecution--,e.caller.cmdsManager._private._currentExecutionDone=!1,setTimeout((function(){e.callback.call(void 0,e.caller)}),0),e.caller}function x(t){var n;if(t.caller.cmdHandler.getState()!==e.HandlerState.PAUSED)return t.caller.cmdsManager._private._runningCmd&&t.caller.cmdsManager._private._runningCmd!==t.caller.cmdHandler&&b(t.caller.cmdsManager._private._runningCmd)&&(t.caller.cmdsManager._private._waitingExecution++,(n=Object.create(null)).caller=Object.create(null),n.caller.cmdsManager=t.caller.cmdsManager,n.caller.cmdHandler=t.caller.cmdsManager._private._runningCmd,t.caller.cmdHandler.getMode()===e.CmdMode.EXCLUSIVE||!0===t.caller.cmdsManager._private._runningCmd._private._command._instance.cancelWhenPaused?(n.callback=W,n.caller.cmdHandler._private._command._instance.params=Object.create(null),n.caller.cmdHandler._private._command._instance.params.cancelReason=u.exclusiveCmdCalled):t.caller.cmdHandler.getMode()===e.CmdMode.NESTED&&(n.callback=O)),n}function M(){return new Promise(((t,n)=>{if(!this._private._currentExecutionDone)return t();if(this._private.executionChaining)return t();if(0===this._private._executionChain.length)return this._private._waitingExecution=0,this._private._executionChain=[],this._private._currentExecution=null,this._private._currentExecutionDone=!0,this._private._runningCmd||E({cmdsManager:this,cmdHandler:void 0}),t();{let r=Promise.resolve();const i=this._private._executionChain[0];if(i.caller.cmdHandler.isDynamic()&&!i.caller.cmdHandler._private._command._dynamicModeComputed){void 0===i.caller.cmdsManager._private._uExecID&&(i.caller.cmdsManager._private._uExecID=0);const t=i.caller.cmdsManager._private._uExecID;i.caller.cmdsManager._private._uExecID++,i.caller.cmdsManager._private._currentComputations||(i.caller.cmdsManager._private._currentComputations=new Map),i.caller.cmdsManager._private._currentComputations.set(t,r),this._private._executionChain[0].caller.cmdHandler.setStateAndSendEvent({state:e.HandlerState.COMPUTING,event:e.LifeCycleEvents.COMPUTE}),i.caller.cmdHandler._private._command._dynamicModeComputed=!0,r=D(i),i.caller.cmdsManager._private._modelEvents.publish({event:i.caller.cmdHandler.getId()+"/compute"})}r.then((()=>{if(0===this._private._executionChain.length)return t();let e=x(this._private._executionChain[0]);return e||(e=this._private._executionChain.shift()),this._private._currentExecution=I(e),t()})).then((()=>{i.caller.cmdsManager._private._currentComputations&&i.caller.cmdsManager._private._currentComputations.delete(currExecID)})).catch((e=>e.cause?n(e):n(new Error(e,{cause:l.COMPUTE_COMMAND_MODE_FAILED}))))}}))}function S(e){var t=!1;if(!e._dirtyUndoStack)return t;var n=this.cmdsManager.getExecutionContext(),r=n.getComponent("AFR_UndoRedoComponent");if(r){var o=r.getLastStepId();if(e._previousUndoId<o){var a=!0;"shared"===e._mode&&e._executeUndoAtEnd&&(a=!1);var s=r._createUndoStep({undoTitle:e.getId(),exclusivity:a,redoEnabled:!e._executeUndoAtEnd});r.registerAction(s);var d=r.groupSteps(s.getId(),e._previousUndoId+1,n);if(i.hasSucceeded(d))t=!0;else{var c=r.removeStepWithId(r.getLastStepId());i.hasSucceeded(c)||i.logResult(c)}}}return t}function D(t){const n=new(0,o.Performances),r=n.start("[DS/WAfrCommandsArchitecture/mod_CommandsManagerComponent::ComputeCmdMode]");if(!t.caller||!t.caller.cmdsManager||!t.caller.cmdHandler)return Promise.reject(new Error("pauseCmd requires the parameter caller with a valid cmdsManager and cmdHandler with a valid command instance"));return new Promise(((i,o)=>{if(t.caller.cmdHandler._private._command._dynamicModeModule&&t.caller.cmdHandler._private._command._dynamicModeFunction)require([t.caller.cmdHandler._private._command._dynamicModeModule],(function(a){if(!a)return o(new Error("Call to "+t.caller.cmdHandler._private._command._dynamicModeMod+" constructor returned undefined"));{const s=t.caller.cmdHandler._private._command._dynamicModeFunction,d=a;if(!d)return o(new Error("Unable to retrieve Dynamic Mode ctor : "+t.caller.cmdHandler._private._command._dynamicModeModule+" in Dynamic Mode Module : "+s));let c=null;const p=t.caller.cmdsManager.getExecutionContext();p&&(c=p.exposedApi,c.ID=t.caller.cmdsManager._private._executionContext.getId());let h=new d;if(!h[s])return o(new Error("Invalid function name for Dynamic Mode computation"));const u=e.CmdMode;let m=h[s](c,u);n.stop(r),m.then((n=>Object.values(e.CmdMode).includes(n)?(t.caller.cmdHandler.setMode(n),i(n)):o(new Error("Invalid return type for Dynamic Mode. Please check doc to see valid types.")))).catch((e=>o(new Error(e,{cause:l.CLIENT_COMPUTE_COMMAND_MODE_FAILED}))))}}),(function(){return o(new Error("Require to "+t.caller.cmdHandler._private._command._dynamicModeMod+" has failed."))}));else{if(t.caller.cmdHandler._private._command._dynamicModeModule&&t.caller.cmdHandler._private._command._dynamicModeFunction)return o(new Error("Missing dynamic mode module in commandHandler parameters."));if(t.caller.cmdHandler._private._command._dynamicModeModule&&!t.caller.cmdHandler._private._command._dynamicModeFunction)return o(new Error("Missing dynamic mode function in commandHandler parameters."))}}))}function T(){this.cmdHandler._private._command._instance.done=function(){},g("paused",this.cmdHandler.getId()),this.cmdsManager._private._modelEvents.publish({event:this.cmdHandler.getId()+"/paused"}),this.cmdsManager._private._modelEvents.publish({event:"paused",data:this.cmdHandler.getId()}),this.cmdsManager._private._runningCmd=null,this.cmdsManager._private._currentExecution&&(this.cmdsManager._private._currentExecutionDone=!0);var e=this;setTimeout((function(){M.call(e.cmdsManager)}),0)}function O(t){if(!t||!t.cmdsManager||!t.cmdHandler)throw new Error("pauseCmd require the parameter capsuleObject with a valid cmdsManager and cmdHandler with a valid command instance");if(t.cmdsManager._private._unstackingCommand&&t.cmdsManager._private._unstackingCommand.length>0)return t.cmdsManager._private._currentExecutionDone=!0,t.cmdsManager._private._unstackingCommand=[],void setTimeout((function(){M.call(t.cmdsManager)}),0);if(b(t.cmdHandler)&&(g("pause",t.cmdHandler.getId()),t.cmdsManager._private._modelEvents.publish({event:t.cmdHandler.getId()+"/pause"}),t.cmdsManager._private._modelEvents.publish({event:"pause",data:t.cmdHandler.getId()}),t.cmdHandler.setStateAndSendEvent({state:e.HandlerState.PAUSED,event:e.LifeCycleEvents.PAUSE}),t.cmdsManager._private._pausedCmds.push(t.cmdHandler),t.cmdHandler._private._command._instance.pauseExecute?(t.cmdHandler._private._command._instance.done=T.bind(t),H({callback:t.cmdHandler._private._command._instance.pauseExecute,caller:t.cmdHandler._private._command._instance})):H({callback:T,caller:t}),t.cmdHandler)){const e=t.cmdHandler.getI18n()?t.cmdHandler.getI18n().title:t.cmdHandler.getId?.(),n=t.cmdsManager._private._executionChain[0];let r="None";n&&(r=n.caller?.cmdHandler?.getI18n()?n.caller.cmdHandler.getI18n().title:n.caller?.cmdHandler?.getId?.());const i=_(t.cmdHandler);i.pd4=e+" paused by "+r;const o=t.cmdsManager.getExecutionContext?.()?t.cmdsManager.getExecutionContext():null,a=o.getSourceApp?.()?o.getSourceApp():null,s={id:t.cmdHandler.getId?.()?t.cmdHandler.getId():"",appID:a?.getId()||"",pds:i},d=o.getComponent(c);d?d.publish({event:"command_pause",data:s}):console.error("Model events is undefined")}}function k(t){var n,r=this.cmdsManager.getExecutionContext();if(r){var i=r.getComponent("AFR_UndoRedoComponent");i&&!0===this.cmdsManager._private._runningCmd._private._command._instance._endUndoGroupingRequested&&(i._stopConcatenateUS(this.cmdsManager._private._runningCmd._private._command._instance._undoGroupID),this.cmdsManager._private._runningCmd._private._command._instance._endUndoGroupingRequested=!1);var o=this.cmdsManager._private._runningCmd._private._command._instance;if(n=S.call(this,o),o.params&&o.params.undoOnEnd&&n){var a=!1;this.cmdsManager&&"WAFRRedoCmd"===this.cmdsManager.getRunningCommand()&&(a=!0),0===i.getUndoStack().getSize()||a||i.undo()}this.cmdsManager._private._runningCmd=null,this.cmdsManager._private._currentExecution&&(this.cmdsManager._private._currentExecutionDone=!0);var s=this.cmdHandler.getState()===e.HandlerState.CANCELED,d=this.cmdHandler.getRepeatMode()===e.RepeatMode.ALWAYS&&!s&&0===this.cmdsManager._private._waitingExecution;if(this.cmdHandler.setStateAndSendEvent({state:e.HandlerState.ENDED,event:e.LifeCycleEvents.END,repeated:d,canceled:s}),g("end",this.cmdHandler.getId()),this.cmdsManager._private._modelEvents.publish({event:this.cmdHandler.getId()+"/end",data:{repeated:d,canceled:s}}),this.cmdsManager._private._modelEvents.publish({event:"end",data:{handlerId:this.cmdHandler.getId(),repeated:d,canceled:s}}),this.cmdHandler._private._cb&&"function"==typeof this.cmdHandler._private._cb&&(this.cmdHandler._private._cb(t?t.error:void 0),d||(this.cmdHandler._private._appCB=[],this.cmdHandler._private._cbIfCommandNotStarted=null)),this.cmdHandler._private._command._instance.destroy&&this.cmdHandler._private._command._instance.destroy(),this.cmdHandler._private._command._instance.stateGraph&&this.cmdHandler._private._command._instance._clearGraph(),this.cmdHandler._private._command._instance=null,this.cmdHandler._private._command._dynamicModeComputed=null,d)this.cmdHandler.execute(),M.call(this.cmdsManager);else{var c=this;setTimeout((function(){c.cmdsManager._private._runningCmd||E(c)}),0)}}}function N(t){if(t&&t.undoOnEnd&&(this.cmdsManager._private._runningCmd._private._command._instance.params||(this.cmdsManager._private._runningCmd._private._command._instance.params={}),this.cmdsManager._private._runningCmd._private._command._instance.params.undoOnEnd=t.undoOnEnd),("CANCELED"===this.cmdHandler._private._command._state||t&&t.undoOnEnd)&&this.cmdHandler){const e=_(this.cmdHandler),t=this.cmdHandler._private._command._instance.params.cancelReason,n=this.cmdHandler.getI18n()?this.cmdHandler.getI18n().title:this.cmdHandler.getId?.();let r="None";switch(t){case 0:const t=this.cmdsManager._private._executionChain[0];t&&(r=t.caller?.cmdHandler?.getI18n()?t.caller.cmdHandler.getI18n().title:t.caller?.cmdHandler?.getId?.()),e.pd4=`${n} canceled by ${r}`;break;case 1:e.pd4=`${n} canceled by itself`;break;default:e.pd4=`${n} canceled internally`}const i=this.cmdsManager.getExecutionContext?.()?this.cmdsManager.getExecutionContext():null,o=i.getSourceApp?.()?i.getSourceApp():null,a={id:this.cmdHandler.getId()?this.cmdHandler.getId():"",appID:o?.getId()||"",pds:e},s=i.getComponent(c);s?s.publish({event:"command_cancel",data:a}):console.error("Model events is undefined")}var n=this.cmdsManager.getExecutionContext();this.cmdHandler._private._command._instance.done=function(){};let r=m.CANCELED;if(this.cmdHandler.getState()!==e.HandlerState.CANCELED&&(this.cmdHandler.setStateAndSendEvent({state:e.HandlerState.ENDING}),r=m.VALIDATED),this.cmdHandler.isUsingComputeServer()){var i={from:this.cmdHandler._private._command._instance},o=n.getComponent("AFR_CSComponent");o&&o.sendStopCommand(i)}else{var a=this;setTimeout((function(){k.call(a,t)}),0)}if("Internal"!==this.cmdHandler._private._handlerTrigger&&this.cmdHandler){const e=_(this.cmdHandler);e.pd4=r;const t=this.cmdsManager.getExecutionContext?.()?this.cmdsManager.getExecutionContext():null,n=t.getSourceApp?.()?t.getSourceApp():null,i={pv1:Date.now()-this.cmdHandler._private._startTimeCmd},o={id:this.cmdHandler.getId()?this.cmdHandler.getId():"",appID:n?.getId()||"",pds:e,pvs:i},a=t.getComponent(c);a?a.publish({event:"command_end",data:o}):console.error("Model events is undefined")}}function R(e){this.cmdHandler._private._command._instance.done=function(){},this.cmdsManager._private._runningCmd===this.cmdHandler&&b(this.cmdHandler)?(e&&e.error&&(this.cmdHandler._private._command._instance.params.error=e.error),e&&e.cancel?(this.cmdHandler._private._command._instance.params.cancelReason=u.askedByCmd,e.undoOnEnd&&(this.cmdHandler._private._command._instance.params.undoOnEnd=e.undoOnEnd),W(this)):N.call(this)):g("done execute callback called but command paused/canceled in between",this.cmdHandler.getId())}function P(){this.cmdHandler._private._command._instance.done=R.bind(this),this.cmdsManager._private._runningCmd===this.cmdHandler&&b(this.cmdHandler)?H({callback:this.cmdHandler._private._command._instance._initGraph,caller:this.cmdHandler._private._command._instance}):g("done execute callback called but command paused/canceled in between",this.cmdHandler.getId())}function U(e){if(!(e&&e.cmdsManager&&e.cmdHandler&&e.cmdHandler._private._command._instance&&e.cmdHandler._private._cb&&e.cmdHandler._private._cb))throw new Error("executeCmd require the parameter capsuleObject with a valid CommandsManager and cmdHandler with a valid command instance");if(g("begin",e.cmdHandler.getId()),e.cmdsManager._private._modelEvents.publish({event:e.cmdHandler.getId()+"/begin"}),e.cmdsManager._private._modelEvents.publish({event:"begin",data:e.cmdHandler.getId()}),e.cmdsManager._private._runningCmd=e.cmdHandler,!e.cmdHandler._private._command._instance.beginExecute&&!0!==e.cmdHandler._private._command._instance.stateGraph)throw new Error("mod_CommandsManagerComponent.executeCmd : Cannot execute a command without a beginExecute method defined on it. It has no sense. BAD Command : "+e.cmdHandler._private._command._module);var t=e.cmdsManager.getExecutionContext(),n=t.getComponent("AFR_UndoRedoComponent");if(n&&(e.cmdHandler._private._command._instance._previousUndoId=n.getLastCreatedUndoStepId()),e.cmdHandler.isUsingComputeServer()){var r={from:e.cmdHandler._private._command._instance},i=t.getComponent("AFR_CSComponent");i&&i.sendStartCommand(r)}!0!==e.cmdHandler._private._command._instance.stateGraph?(e.cmdHandler._private._command._instance.done=R.bind(e),H({callback:e.cmdHandler._private._command._instance.beginExecute,caller:e.cmdHandler._private._command._instance})):(!0===e.cmdHandler._private._command._instance.asyncGraph?e.cmdHandler._private._command._instance.done=P.bind(e):e.cmdHandler._private._command._instance.done=R.bind(e),H({callback:e.cmdHandler._private._command._instance.buildGraph,caller:e.cmdHandler._private._command._instance}),!0!==e.cmdHandler._private._command._instance.asyncGraph&&H({callback:e.cmdHandler._private._command._instance._initGraph,caller:e.cmdHandler._private._command._instance})),e.cmdsManager._private._currentExecution&&(e.cmdsManager._private._currentExecutionDone=!0),H({callback:function(){e.cmdsManager._private._currentExecutionDone&&b(e.cmdHandler)&&M.call(e.cmdsManager)}});const o=s.createUUID();if(e.cmdHandler._private._cmdUUID=o,"Internal"!==e.cmdHandler._private._handlerTrigger&&e.cmdHandler){const t=_(e.cmdHandler),n=e.cmdsManager.getExecutionContext?.()?e.cmdsManager.getExecutionContext():null,r=n.getSourceApp?.()?n.getSourceApp():null;e.cmdHandler._private._startTimeCmd=Date.now();const i={id:e.cmdHandler.getId?.()?e.cmdHandler.getId():"",appID:r?.getId()||"",pds:t},o=n.getComponent(c);o?o.publish({event:"command_launch",data:i}):console.error("Model events is undefined")}}function W(t){if(!(t&&t.cmdsManager&&t.cmdHandler&&t.cmdHandler._private._cb))throw new Error("cancelCmd require the parameter capsuleObject with a valid cmdsManager and cmdHandler with a valid command instance");b(t.cmdHandler)&&(t.cmdHandler.setStateAndSendEvent({state:e.HandlerState.CANCELED,event:e.LifeCycleEvents.CANCEL}),g("canceling",t.cmdHandler.getId()),t.cmdsManager._private._modelEvents.publish({event:t.cmdHandler.getId()+"/canceling"}),t.cmdsManager._private._modelEvents.publish({event:"canceling",data:t.cmdHandler.getId()}),t.cmdHandler._private._command._instance.cancelExecute?(t.cmdHandler._private._command._instance.done=N.bind(t),H({callback:t.cmdHandler._private._command._instance.cancelExecute,caller:t.cmdHandler._private._command._instance,arg:t.cmdHandler._private._command._instance.params})):H({callback:N,caller:t,arg:t.cmdHandler._private._command._instance.params}))}var L=Object.create(null);return L.CommandsManagerComponent=function(){var e=this;this._private||(this._private=Object.create(null)),this._private._defaultCommand=null,this._private._runningCmd=null,this._private._pausedCmds=[],this._private._executionChain=[],this._private._currentExecution=null,this._private._currentExecutionDone=!0,this._private._waitingExecution=0,this._private._modelEvents=new n,this._private._endingCommandsToken=r.subscribe({event:"COMMAND_MANAGER/Ending_Commands"},(function(){e.endAll(void 0)})),this._private._configurations=new Map},L.CommandsManagerComponent.DEFAULT_COMPONENT_NAME="AFR_CommandsManager",L.CommandsManagerComponent.prototype.initialize=function(e){if(v=!1,e){this.getExecutionContext().setContext("usingCS",!0)}return Promise.resolve()},L.CommandsManagerComponent.prototype.setUseEscape=function(e){e?this._boundOnKeyup||(this._boundOnKeyup=function(e){const t=Object(null);let n;if(e.defaultPrevented||e.actionPerformed)return;const r=e.key||e.keyCode;if("Escape"===r||"Esc"===r||27===r)if(this._private._runningCmd)e.preventDefault(),e.stopPropagation(),n=this._private._runningCmd._private._command._instance,n.buildGraph&&n._unsubscribeFromAllEvents(n._stateId),n.params||(n.params=Object(null)),n.params.undoOnEnd=!0,t.cmdHandler=this._private._runningCmd,t.cmdsManager=this,W(t);else{if(Boolean(this.getConfiguration("a2x"))){const e=localStorage.getItem("WAFR_A2X_NO_ESCAPE");if(null!==e&&("string"==typeof e&&"true"===e||"boolean"==typeof e&&e))return void console.warn("A2X Command Escape is deactivated (WAFR_A2X_NO_ESCAPE set to true in your localStorage)");new Promise(((e,t)=>{require(["DS/WA2XCommunication/WA2XClient","DS/CSICommandBinder/CSICommandBinder"],(function(t,n){return e([t,n])}),t)})).then((e=>{const t=e[0],n=e[1],r=t.getA2XClient(),i=n.createParameters(),o="afrA2XCommandEscape",s={name:o,version:1,parameters:i,onSuccess:()=>{a.debug(`${o} onSuccess`)},onError:e=>{const t=e&&e.readString("error"),n=e&&e.readString("errorMessage");a.error(`${o} onError. Escape key to manage command escape failed to execute. Error: ${t}, Error Message: ${n}`)}};r.call(s)}),(e=>{console.error("ESCAPE - Impossible to retrieve prerequisites",e)}))}}}.bind(this),document.addEventListener("keyup",this._boundOnKeyup)):this._boundOnKeyup&&document.removeEventListener("keyup",this._boundOnKeyup)},L.CommandsManagerComponent.prototype.clean=function(){var e=this;v=!0;let t=[];this._private._currentComputations&&this._private._currentComputations.forEach((e=>{t.push(e)})),Promise.allSettled(t).then((()=>this.endAll().then((function(){e.setDefaultCommand(null)}))))},L.CommandsManagerComponent.prototype.destroy=function(){return this._boundOnKeyup&&document.removeEventListener("keyup",this._boundOnKeyup),r.unsubscribe(this._private._endingCommandsToken),delete this._private._endingCommandsToken,Promise.resolve()},L.CommandsManagerComponent.prototype.isCmdExecuting=function(t){return t.getState()===e.HandlerState.EXECUTING},L.CommandsManagerComponent.prototype.setDefaultCommand=function(e){if(void 0===e||e&&"string"!=typeof e)throw new Error("CommandsManagerComponent.setDefaultCommand can only take null or a string (commandHandlerID) as input parameter");e&&null===this._private._runningCmd&&0===this._private._pausedCmds.length&&0===this._private._waitingExecution&&this._private._currentExecutionDone&&C({commandHandlerId:e,executionCtx:this._private._executionContext});this._private._defaultCommand=e},L.CommandsManagerComponent.prototype.getDefaultCommand=function(){return this._private._defaultCommand},L.CommandsManagerComponent.prototype.subscribeToCmdState=function(e,t,n){var r;return r=""===e?t:e+"/"+t,this._private._modelEvents.subscribe({event:r},(function(e){n(e)}))},L.CommandsManagerComponent.prototype.subscribeOnceToCmdState=function(e,t,n){var r;return r=""===e?t:e+"/"+t,this._private._modelEvents.subscribeOnce({event:r},(function(e){n(e)}))},L.CommandsManagerComponent.prototype.unsubscribeToCmdState=function(e){this._private._modelEvents.unsubscribe(e)},L.CommandsManagerComponent.prototype.getRunningCommand=function(){return this._private._runningCmd?this._private._runningCmd.getId():null},L.CommandsManagerComponent.prototype.getExposedComponentCtor=function(){var e=this;function t(){this.cancelReason=u}return t.prototype.getDefaultCommand=e.getDefaultCommand.bind(e),t.prototype.getRunningCommand=e.getRunningCommand.bind(e),t.prototype.setDefaultCommand=e.setDefaultCommand.bind(e),t.prototype.isCmdExecuting=e.isCmdExecuting.bind(e),t.prototype.subscribeToCmdState=e.subscribeToCmdState.bind(e),t.prototype.unsubscribeToCmdState=e.unsubscribeToCmdState.bind(e),t.prototype.subscribeOnceToCmdState=e.subscribeOnceToCmdState.bind(e),t},L.CommandsManagerComponent.prototype.stackCommandExecutionRequest=function(t,n){var r=Object.create(null);r.cmdsManager=this,r.cmdHandler=n.handler;var o=n.cb;r.cmdHandler._private._cbIfCommandNotStarted=o,function(t){const n=t.caller.cmdHandler,r=t.caller.cmdsManager;if(void 0===n||void 0===r||void 0===r._private)throw new Error("Error on arguments in chainNewExecution, please check.");void 0===r._private._uExecID&&(r._private._uExecID=0);const o=r._private._uExecID;r._private._uExecID++,r._private.unstartedExecutions||(r._private.unstartedExecutions=new Map);let a=r._private.unstartedExecutions;return new Promise(((s,d)=>{if(t.caller.cmdsManager._private._waitingExecution++,t.caller.cmdsManager._private.executionChaining||t.caller.cmdsManager._private._currentExecution||!t.caller.cmdsManager._private._currentExecutionDone||t.caller.cmdsManager._private._runningCmd&&!b(t.caller.cmdsManager._private._runningCmd)){if(t.caller.cmdsManager._private._executionChain.length>0){t.caller.cmdsManager._private._waitingExecution--;let n=t.caller.cmdsManager._private._executionChain.pop();if(n.caller.cmdHandler.setStateAndSendEvent({state:e.HandlerState.ENDED,event:e.LifeCycleEvents.END,notStarted:!0}),n.caller.cmdHandler._private._cb&&"function"==typeof n.caller.cmdHandler._private._cb){const e=i.createReturnObject(h.COMMAND_NOT_STARTED,{description:"Can't start the command as another one has been started as the same time."});n.caller.cmdHandler._private._cbIfCommandNotStarted&&n.caller.cmdHandler._private._appCB.push(n.caller.cmdHandler._private._cbIfCommandNotStarted),n.caller.cmdHandler._private._cb(e),n.caller.cmdHandler._private._appCB=[]}n.caller.cmdHandler===t.caller.cmdHandler?t.caller.cmdsManager._private._waitingExecution--:(t.caller.cmdsManager._private._unstackingCommand=[],t.caller.cmdsManager._private._unstackingCommand.push({discardedCommand:n,newCommandToExecute:t}),t.caller.cmdsManager._private._executionChain.push(t))}else t.caller.cmdsManager._private._executionChain.push(t);return s()}{r._private.unstartedExecutions.set(o,n);let i=Promise.resolve();t.caller.cmdHandler.isDynamic()&&!t.caller.cmdHandler._private._command._dynamicModeComputed&&(r._private._currentComputations||(r._private._currentComputations=new Map),t.caller.cmdHandler.setStateAndSendEvent({state:e.HandlerState.COMPUTING,event:e.LifeCycleEvents.COMPUTE}),t.caller.cmdsManager._private._modelEvents.publish({event:t.caller.cmdHandler.getId()+"/compute"}),t.caller.cmdHandler._private._command._dynamicModeComputed=!0,i=D(t),r._private._currentComputations.set(o,i)),n.isDynamic()||(r._private.executionChaining=!0),i.then((()=>{let i;if(r._private&&r._private._runningCmd&&(i=r._private._runningCmd.getState()),i===e.HandlerState.ENDING)return r._private._executionChain.push(t),r._private.executionChaining=!1,s();if(n._private._command.killed)return n._private._command._instance=null,n._private._command._dynamicModeComputed=null,n._private._command.killed=null,d(new Error("Dynamic mode canceled during mode computation",{cause:l.DYNAMIC_COMMAND_CANCELED}));let c=new Map(a);if(a.size>1&&a.forEach(((t,i)=>{i>o&&(r._private._waitingExecution--,c.delete(o),n.isDynamic()&&(n._private._command._instance=null,n._private._command._dynamicModeComputed=null,n._private._command.killed=null),n.setStateAndSendEvent({state:e.HandlerState.CANCELED,event:e.LifeCycleEvents.CANCEL})),t.isDynamic()&&i<o&&(r._private._waitingExecution--,t._private._command.killed=!0,t.setStateAndSendEvent({state:e.HandlerState.CANCELED,event:e.LifeCycleEvents.CANCEL}),c.delete(i)),!t.isDynamic()&&i<o&&(t.setStateAndSendEvent({state:e.HandlerState.CANCELED,event:e.LifeCycleEvents.CANCEL}),c.delete(i))})),r._private.unstartedExecutions=c,r._private.unstartedExecutions.size>1)return d(new Error("Dynamic mode canceled during mode computation",{cause:l.DYNAMIC_COMMAND_CANCELED}));if(1!==r._private.unstartedExecutions.size)return d(new Error("ASYNC FAILURE ON DYNAMIC MODE COMMANDS"));{let e=r._private.unstartedExecutions.entries().next();if(e.value[1]!==n)return d(new Error("ASYNC FAILURE ON DYNAMIC MODE COMMANDS"));r._private.unstartedExecutions.delete(e.value[0])}if(n._private._command.killed)return d(new Error("Dynamic mode canceled during mode computation",{cause:l.DYNAMIC_COMMAND_CANCELED}));let p=x(t);return r._private.executionChaining=!1,p?(r._private._executionChain.push(t),p.caller.cmdsManager._private._currentExecution=I(p)):r._private._currentExecution=I(t),s()})).then((()=>{r._private._currentComputations&&r._private._currentComputations.delete(o)})).catch((e=>e.cause?d(e):d(new Error(e,{cause:l.COMPUTE_COMMAND_MODE_FAILED}))))}}))}({callback:function(r){if(!r)throw new Error("mod_CommandsManagerComponent.js callback in chainNewExecution cannot start a command is no capsuleObject is passed");if(!v){if(null!==o&&"function"==typeof o||(o=void 0),r.cmdHandler.getState()===e.HandlerState.PAUSED)return r.cmdsManager._private._currentExecution&&(r.cmdsManager._private._currentExecutionDone=!0),void setTimeout((function(){M.call(r.cmdsManager)}),0);b(r.cmdHandler)?(r.cmdHandler._private._appCB||(r.cmdHandler._private._appCB=[]),o&&r.cmdHandler._private._appCB.push(o),r.cmdHandler._private._command._instance.params=Object.create(null),r.cmdHandler._private._command._instance.params.cancelReason=u.secondExecuteCalled,W(r)):(r.cmdHandler.setStateAndSendEvent({state:e.HandlerState.EXECUTING,event:e.LifeCycleEvents.BEGIN}),require([r.cmdHandler._private._command._module],(function(e){if(!e)throw new Error("Failed to load the module related to the command",r.cmdHandler._private._id);var i=null,a=r.cmdsManager.getExecutionContext();a&&((i=a.exposedApi).ID=r.cmdsManager._private._executionContext.getId()),n.args||(n.args=Object.create(null)),n.args.cmdLifeCyleEventsChanel=r.cmdsManager._private._modelEvents,n.ID=r.cmdHandler.getId(),e.prototype.isNewInfraActivated=function(){return!0};var s=new e({args:n.args,executionContext:i,ID:n.ID});if(!s)throw M.call(r.cmdsManager),new Error("Call to "+r.cmdHandler._private._command._module+" constructor returned undefined");n.args&&(r.cmdHandler._private._handlerTrigger=n.args.handlerTrigger?n.args.handlerTrigger:"Internal"),r.cmdHandler.isUsingComputeServer()&&(s.getCSIdentifier=function(){return s},s.hasDecalredCS=function(){return!0},s.onCmdEnded=function(e){return k.call(r,e)}),s.getId=function(){return r.cmdHandler.getId()},s.askForUndoGroupingAtEnd=function(e,t){s._endUndoGroupingRequested=!0,s._concatenateServerStep=t,s._undoGroupID=e},s._evtID=i.ID+n.ID,r.cmdHandler._private._command._instance=s,r.cmdHandler._private._command._instance.params={},r.cmdHandler._private._cb=t,r.cmdHandler._private._appCB||(r.cmdHandler._private._appCB=[]),o&&r.cmdHandler._private._appCB.push(o),U(r)}),(function(){var e=new Error("Require failed ("+r.cmdHandler._private._command._module+")");if(!o||"function"!=typeof o)throw e;o(e),M.call(r.cmdsManager)})))}},caller:r}).catch((e=>{if(e.cause!==l.DYNAMIC_COMMAND_CANCELED){if(!o||"function"!=typeof o)throw e;o(e)}}))},L.CommandsManagerComponent.prototype.endAll=function(){var e=this;return new UWA.Promise((function(t,n){var i=e._private._pausedCmds.length;if(i>0)var o=e.subscribeToCmdState("","resume",(function(n){var a=Object.create(null);if(a.cmdsManager=e,a.cmdHandler=e._private._runningCmd,W(a),0===--i)return e.unsubscribeToCmdState(o),r.publish({event:"COMMAND_MANAGER/ALL_CMD_ENDED"}),t()}));if(e._private._runningCmd&&("WAFRUndoCmd"!==e._private._runningCmd._private._id||"Undo"!==e._private._runningCmd._private._id)){var a=Object.create(null);a.cmdsManager=e,a.cmdHandler=e._private._runningCmd,W(a)}if(0===i)return r.publish({event:"COMMAND_MANAGER/ALL_CMD_ENDED"}),t()}))},L.CommandsManagerComponent.prototype.setConfiguration=function(e,t){if(!e||null==t)throw new Error("Missing parameters");this._private._configurations.set(e,t)},L.CommandsManagerComponent.prototype.getConfiguration=function(e){let t;return this._private._configurations.has(e)&&(t=this._private._configurations.get(e)),t},L})),define("DS/WAfrCommandsArchitecture/mod_CommandsInterpreter",["UWA/Class/Promise","DS/WAfrUtils/mod_ConcatenationUtils","DS/WAfrCommandsArchitecture/mod_CommandsManagerComponent"],(function(e,t,n){"use strict";const r=t.getConfigurationFor,i=n.CommandsManagerComponent.DEFAULT_COMPONENT_NAME;var o=function(){};o.prototype.interpret=function(t,n){var o=!1,a=function(e,t){Object.keys(e).some((function(n){n===t&&!0===e[n]?o=!0:e[n]&&"object"==typeof e[n]&&a(e[n],t)}))};a(t,"computeServer"),o&&n.setContext("usingCS",!0);const s=Boolean(r(t,"a2x")),d=Boolean(r(t,"useEscape"))||s,c=n.getComponent(i);if(!c)throw new Error("Missing Commands Manager Component");return c.setUseEscape(d),c.setConfiguration("a2x",s),e.resolve(o)};var a=Object.create(null);return a.generateInterpreter=function(e,t){return Promise.resolve(new o)},a})),define("DS/WAfrExecutionContext/mod_ExecutionContextInterpreter",["DS/WAfrUtils/mod_Performances","DS/WAfrExecutionContext/mod_HomePageManager"],(function(e,t){"use strict";const n=e.Performances,r=t.isHomePageComponent;function i(e,t){const n=e.split("==");if(2!==n.length)throw new Error("Bad syntax, expected expression like A == B, found "+e);const r=n[0].trim(),i=n[1].trim();if(r.indexOf('"')>=0||i.indexOf('"')>=0)throw new Error('Bad syntax, key and value should not contain double quote ", found '+e);if(r.indexOf(" ")>=0||i.indexOf(" ")>=0)throw new Error("Bad syntax, key and value should not contain space, found "+e);t[r]=i}function o(e,t,n){const r="["+e.module+"] "+e.func,i=n.start(r);return new Promise(((r,o)=>{function a(){n.stop(i),r()}function s(){n.stop(i),o()}require([e.module],(function(n){return(0,n[e.func])(a,s,t)}),(function(e){return n.stop(i),o(e)}))}))}class a{constructor(){this._perf=new n,this._executionContext=void 0,this._components=[],this._UIModel=void 0}interpret(e,t,n){this._executionContext=t,this._components=e.components,this._UIModel=e.UIModel;let i=!1;this._components&&this._components.forEach((function(e){e&&r(e.key)&&(i=!0)}));const o=this._executionContext._homePageManager;if(!o)throw new Error("No HomePageManager associated to the ExecutionContext");return this._components&&i&&!this._executionContext.getSourceApp()?o.homePageRequested=!0:i||(o.homePageRequested=!1,o.homePageDisplayed=!1),Promise.resolve()}updateConditionalContent(e){let t=Promise.resolve();if(e.conditions){const n={appId:e.appId};let r=[],i=[];for(const[t,a]of Object.entries(e.conditions))r.push(t),i.push(o(a,n,this._perf));t=Promise.allSettled(i).then((t=>{let n={};for(let e=0;e<r.length;++e)n[r[e]]=t[e];let i=e.components;if(i)for(let e=i.length-1;e>=0;--e)i[e].condition&&"rejected"===n[i[e].condition].status&&i.splice(e,1);let o=e.handlers.default;if(o)for(let e=o.length-1;e>=0;--e)o[e].condition&&"rejected"===n[o[e].condition].status&&o.splice(e,1);let a=e.handlers.check;if(a)for(let e=a.length-1;e>=0;--e)a[e].condition&&"rejected"===n[a[e].condition].status&&a.splice(e,1);let s=e.radioGroup;if(s&&(s=s.items,s))for(let e=s.length-1;e>=0;e--)s[e].condition&&"rejected"===n[s[e].condition].status&&s.splice(e,1);let d=e.UIModel;if(d&&(d=d.handlerList,d))for(let e=d.length-1;e>=0;e--)d[e].condition&&"rejected"===n[d[e].condition].status&&d.splice(e,1);let c=e.UIModel;if(c&&(c=c.categories,c))for(let e=c.length-1;e>=0;e--)c[e].condition&&"rejected"===n[c[e].condition].status&&c.splice(e,1)}))}return t}}return{generateExecutionContextInterpreter:function(e){return new a},parseWhen:function(e){const t={};if(e.indexOf("&&")>=0){const n=e.split("&&");if(n.length<2)throw new Error("Bad syntax, expected expression like A == B && C == D, found "+e);n.forEach((e=>{i(e,t)}))}else i(e,t);return t},evaluate:function(e,t){let n=!0;Object.keys(t.when).forEach((function(r){n=n&&t.when[r]===e[r]})),n&&!t.fit?t.fit=!0:n||(t.fit=!1)}}})),define("DS/WAfrAppManager/App",["UWA/Core","UWA/Class","UWA/Class/Promise","DS/WAfrContainer/App"],(function(e,t,n,r){"use strict";var i=function(e){r.call(this,e),this._frmWindow=void 0,this._disposeCalled=!1,this._executionContext=void 0};return r.inherits(i),i.prototype.onWillEnter=function(e){return n.resolve()},i.prototype.setUp=function(e){return n.resolve()},i.inherits=function(e){e.prototype=Object.create(i.prototype,{constructor:{value:e,enumerable:!1}})},i.Extend=function(){var e=function(e){i.call(this,e)};return i.inherits(e),e},i})),define("DS/WAfrExecutionContext/mod_ExecutionContext",["UWA/Utils","UWA/Core","DS/WAfrExecutionContext/mod_Component","DS/WAfrExecutionContext/mod_ExecutionContextInterpreter","DS/WAfrExecutionContext/mod_HomePageManager","DS/WAfrUtils/Logger","DS/WAfrContainer/App","DS/WAfrUtils/mod_PromiseUtils","DS/WAfrUtils/mod_ConcatenationUtils","DS/WAfrUtils/mod_Performances","DS/WebUAUtils/WebUAUtils","DS/WAfrModelEvents/mod_ModelEvents","UWA/Class/Promise"],(function(e,t,n,r,i,o,a,s,d,c,l,p){"use strict";const h=p.DEFAULT_COMPONENT_NAME,u=s.promisifiedRequire,m=d.hasConfigurationFor,_=d.getConfiguration,f=c.Performances,g="WAFR: ",v=i.HomePageManager,C=Object.create(null),E="a2x";function b(e){return e._extensions.get(E)}function w(e){const t=e._homePageManager;if(!t)throw new Error("No HomePageManager associated to the ExecutionContext");return t}function y(e){try{const t=e.getComponent(h),n={pv1:Date.now()-e.getSourceApp()?.getStartTimeApp()},r={pd1:e.getSourceApp()?.getUUID()||"None"},i={appID:e.getSourceApp()?.getId?.()||"None",pds:r,pvs:n};t?t.publish({event:"app_end",data:i}):console.error("Model events is undefined")}catch(e){console.error(e)}}function A(e){return{current:0,next:function(){return this.current>=e.length?null:e[this.current++]}}}function H(e){const t=n.Component.prototype,r=Object.keys(t);for(let t=0;t<r.length;t++){const n=r[t];if(!e.hasOwnProperty(n))return!1}return!0}async function I(e,t){for(let n=0;n<e.length;++n)await t(e[n])}async function x(e,t,n){const r=e.length,i=[];let o=null;for(let a=n?r-1:0;n?a>=0:a<r;n?--a:++a)o=t(e[a]),i.push(o);await Promise.all(i)}async function M(e){const t=e.iterator,n=e.action,r=e.inverse;if(null===n||"function"!=typeof n)throw new Error("The action cannot be null and must be a function returning a promise");if(!t)throw new Error("iterator must be defined.");const i=[],o=[];let a=t.next(),s=0;for(;a;)a.canBeParallelized()?i.push(a):r?o.unshift(a):o.push(a),a=t.next(),s+=1;r?(await x(i,n,r),await I(o,n)):(await I(o,n),await x(i,n,r))}function S(e,t,n){const r=e._stdComponents,i=e._appComponents,o=e._components;if(n){for(let e=i.length-1;e>=0;--e){const n=i[e];t(o[n],n)}for(let e=r.length-1;e>=0;--e){const n=r[e];t(o[n],n)}}else{for(const e of r)t(o[e],e);for(const e of i)t(o[e],e)}}function D(e,t,r){return r?n.Component.implementsBy(e):n.StandardComponent.implementsBy(e),new e(t)}async function T(e,t){if(e&&e._registry){o.log("[Execution context] getConfigurationData using registry.");const n=e._registry,r=n.get("getAppInfo"),i=n.get("setBrand"),a=n.get("getConfiguration"),s=n.get("setViewData"),d=e.getContainerView(),c=await r(t);let l="";c&&(l=await i(d,c.brand));let p=await a(c,d,this);return p?await s(d,p):p={},p.appId=t,p.title=c.title,p.brand=l,p.afrAppId||(p.afrAppId=t),p}throw new Error("Error while retrieving the Execution Context or its registry")}async function O(e){if(!e)throw new Error("The execution context must be defined to fetch its widget's data");const t=e.getContainerView();if(!t)throw new Error("Impossible to retrieve the execution context's widget data.");return t.getValues()}function k(e){return{getId:e.getId.bind(e),getComponent:function(t){return e.getComponent(t,!0)},registerComponent:function(t,n){e.registerApplicationComponent(t,n)},createAndRegisterComponent:e.createAndRegisterApplicationComponent.bind(e),unregisterComponent:e.unregisterApplicationComponent.bind(e),isRegisteredComponent:e.isRegisteredComponent.bind(e),recycleComponent:e.recycleComponent.bind(e),getData:function(){},getSourceApp:e.getSourceApp.bind(e),getTargetApp:e.getTargetApp.bind(e),getComponents:function(t){return e.getComponents(t,!0)},getContext:function(){return t.clone(e._contexts)},setContext:e.setContext.bind(e),switchApp:function(t,n){return t&&n?async function(e,t,n){if(!e)throw new Error("Execution context must be defined to perform a switch of application specialization");const r=e.getSourceApp(),i=e._masterAppId;let o;("localhost"===location.hostname||i===t||r&&r.getId()===t)&&(o=await O(e)),o&&o.afrSpecializations||(o=await T(e,t));let a=o&&o.afrSpecializations;if(!a||!Array.isArray(a))throw new Error("No compatible applications found in the declared configuration");if(!a.includes(n))throw new Error("The given application is not authorized to switch in the current execution context");if(!e._container)throw new Error("Cannot find the related container to the current Execution Context.");const s=await e._container.getApplicationJSON({afrAppId:n});e._masterAppId=t;const d={appIds:{appId:s.appId,afrAppId:s.appId},appInfo:null};return await e.load(s,void 0,d)}(e,t,n):async function(e,t){if(!e)throw new Error("Execution Context must be defined !");e._masterAppId!==t&&e._cleanSpecializationsData();const n=await T(e,t);if(n&&n.afrVersion&&"0.1"===n.afrVersion){const r={appId:t,afrAppId:t};return await e.load(n,void 0,r)}{const r=n&&n.afrAppId||t;if(!e._container)throw new Error("Cannot find the related container.");const i=await e._container.getApplicationJSON({afrAppId:r}),o={appId:t,afrAppId:r};return await e.load(i,void 0,o)}}(e,t)},gotoWelcomeScreen:function(){return e.gotoWelcomeScreen()},gotoApp:function(){return e.gotoApp()},getWelcomeScreenState:function(){return e.getWelcomeScreenState()},getWidgetID:e.getWidgetID.bind(e)}}return C.ExecutionContext=class{constructor(n){this._perf=new f,n=t.merge(n||{},{config:{components:[],interpreters:[]}}),this._id=n.id||e.getUUID(),this._registry=n&&n.registry,this._registry||o.error("[Execution context] No registry found"),this._config=n.config,this._config.interpreters=this._config.interpreters||[],this._interpreter=r.generateExecutionContextInterpreter(),this._extensions=new Map,this._components=Object.create(null),this._stdComponents=[],this._appComponents=[],this._handlers={},this.exposedApi=k(this),this._version=null,this._container=n.container,this._contexts=Object.create(null),this._homePageManager=new v,this._isConfigured=!1,this._container&&(this._container.subscribe("onReuseContext."+this.getId(),(e=>{this._cleanSpecializationsData();const t=e.applicationConcatenation||e;n={appIds:e.appIds,appInfo:e.appInfo},this.load(t,void 0,n).then(console.log,console.warn)})),this._container.subscribe("displayAfrLoader",(e=>{this.displayLoader(e)})),this._container.subscribe("hideAfrLoader",(()=>{this.hideLoader()})))}_cleanSpecializationsData(){const e=this.getContainerView();if(!e)throw new Error("Error while retrieving the containerView related to the current ExecutionContext");e.setValue("afrSpecializations",void 0),this._masterAppId&&delete this._masterAppId}async _initExecutionContext(e,n,r){await this._interpreter.updateConditionalContent(e),await this._interpreter.interpret(e,this),await this.registerStandardComponents();let i=await this.loadApp(e,r);if(this._targetApp=i.app,!this._targetApp)throw new Error("Not found a target app !");await this.prepareTransition(i),this._isConfigured=!1,this._components=t.merge(this._components,i.metaDatas),Object.keys(i.metaDatas).forEach((e=>{this._components[e].resetInfo&&!this._components[e].ctor&&(delete this._components[e],this._components[e]=i.metaDatas[e])})),this._appComponents=i.componentsKeys;w(this).componentKeys=i.WSComponentsKeys;let a=!1;for(let t in this._handlers){a=!1;for(let n=0;n<e.handlers.check.length;n++)e.handlers.check[n].identifier===t&&(e.handlers.check[n].defaultState=this._handlers[t],a=!0);if(!a){const n="default";for(let r=0;r<e.radioGroup.items.length;r++)e.radioGroup.items[r].identifier===t&&(e.radioGroup.items[r][n]=this._handlers[t])}}return await this.callAllInterpreters(e,n),o.log("[Execution context] Initialize standard components"),await this.initializeStandardComponents(this.createComponentIterator(this._stdComponents)),i}async _appPromiseSequence(e){let t=[],n=[],r=[];e&&0!==Object.keys(e).length&&e.componentsKeys&&e.componentsKeys.forEach((e=>{this._components[e].component&&n.push(this._components[e].component)}));for(const i of this._appComponents){const o=this._components[i];o.component?e||o.component.isInitialized()||(o.context&&o.context.fit||!o.context)&&n.push(o.component):(o.context&&o.context.fit||!o.context)&&(o.ctor?(this.registerComponentThruMetaData(i,o),n.push(o.component)):(r.push(o.module),t.push(i)))}await new Promise(((e,i)=>{require(r,function(){let i,o,a,s;for(arguments.length!=r.length&&e(),i=0;i<arguments.length;i++)o=arguments[i],a=t[i],s=this._components[a],s.ctor=o,this.registerComponentThruMetaData(a,s),n.push(s.component);e()}.bind(this),i)})),await this.initializeApplicativeComponents(A(n)),o.log("[Execution context] Configure standard components"),this._isConfigured||await this.configureComponents({iterator:this.createComponentIterator(this._stdComponents),setConfiguredFlag:!0}),o.log("[Execution context] Initialize application");const i=await this.setUpApp();i&&(o.warn("[WARNING] App should use the UIFrame component to add UI to their App"),i.inject(this.getUiContainer()));w(this).homePageDisplayed=!1}createComponentIterator(e){return t=e,n=this._components,{current:0,next:function(){let e;for(;this.current<t.length&&!e;){const r=t[this.current];e=n[r]?n[r].component:void 0,this.current+=1}return e}};var t,n}whenAvailable(){return Promise.resolve()}_disposeExecutionContext(){this._timerHandle&&clearTimeout(this._timerHandle),this._sourceApp&&this._sourceApp.dispose(),S(this,(e=>{e.component&&(e.component.clean(!0),e.component.setInitializedState(!1),e.component.destroy(!0),e.component.setExecutionContext(null),this.removeComponent(e))}),!0),delete this._components,delete this._stdComponents,delete this._appComponents,delete this.exposedApi,delete this._contexts,this._container=null}whenAvailableAfterClose(){return Promise.resolve()}setView(e){this._view=e}getUiContainer(){return this._view.getDom()}getContainerView(){return this._container?this._container._view:null}getTargetApp(){return this._targetApp}getWidgetID(){if(!this._container)throw new Error("No container attached to this execution context.");return this._container.id}getSourceApp(){return this._sourceApp}getProcessingApplication(){let e=this.getTargetApp();if(!e&&(e=this.getSourceApp(),!e))throw new Error("No processing application found (no source app, no target app)");return e}getId(){return this._id}get applicationContext(){return console.warn("[WAfrExecutionContext] Deprecated getter applicationContext on ExecutionContext. Use exposedApi instead."),this.exposedApi}getComponent(e,t){if(!e)throw new Error(`Invalid identifier ${e}`);let n;if(this._components){const r=this._components[e];if(r&&r.component){const e=r.component;t?e.getExposedComponent&&e.getExposedComponent()?n=e.getExposedComponent():r.standard||(n=e):n=e}}return n}async cleanComponent(e,t){if(!e)throw new Error("Component must be defined");const n=e.getRegisteredIdentifier();if(null==n||"string"!=typeof n)throw new Error(`Invalid identifier ${n}`);const i=this._components[n];if(!i)throw new Error("The MetaData for this component do not exists");return o.log("[Execution context] clean component",n),await e.clean(),i.standard||e.setInitializedState(!1),i.recycled&&i.context&&(r.evaluate(this._contexts,i.context),i.recycled=i.context.fit),i.recycled||i.standard?i.recycled=!1:(o.log("[Execution context] destroy component",n),await e.destroy(),o.log("[Execution context] Remove component",n," from execution context"),this.removeComponent(i,t&&!i.standard)),e}async unregisterComponent(e,t){if(null==e||"string"!=typeof e)throw new Error(`Invalid identifier ${e}`);if(this._components[e]){const n=this._components[e];if(n.standard&&t)throw new Error("Invalid access, try to unregister a standard component from application side");const r=n.component;return o.log("[Execution context] clean component",e),await r.clean(),o.log("[Execution context] destroy component",e),await r.destroy(),o.log("[Execution context] Remove component",e,"from execution context"),this.removeComponent(n,!0),r}}isRegisteredComponent(e){if(!e)throw new Error("The component is null or undefined");let t=!1;const n=e.getRegisteredIdentifier(),r=this._components[n];return r&&r.component&&(r.component===e||r.component.getExposedApi&&r.component.getExposedApi()===e)&&(t=!0),t}async cleanComponents(e){return await M({action:t=>this.cleanComponent(t,!!e&&e.removeForGood),inverse:!0,iterator:e&&e.iterator?e.iterator:this.createComponentIterator(this._appComponents.concat(this._stdComponents))})}async destroyComponents(e){if(!e)throw new Error("Missing iterator");return await M({action:async e=>{o.log("[Execution context] destroy component",e.getRegisteredIdentifier());const t=this._components[e.getRegisteredIdentifier()];await e.destroy();const n=!t.standard;return this.removeComponent(t,n)},inverse:!0,iterator:e})}recycleComponent(e,t){if(null==e||"string"!=typeof e)throw new Error("Invalid identifier "+e);const n=this._components[e];if(n){if(n.standard)throw new Error("Cannot recycle a standard component");if(!n.recycled&&(n.recycled=!0,t)){const t=this._targetApp.options.appConfig.components.find((t=>t.key==e));n.options=t.options,n.component&&(n.component.options=t.options),t.when?(n.context={element:t.key,when:r.parseWhen(t.when)},r.evaluate(this._contexts,n.context)):delete n.context}}}getComponents(e,t){if(!e)throw new Error("Predicate function is mandatory");const n=[];let r;return S(this,((i,o)=>{r=this.getComponent(o,t),r&&e(r)&&n.push(r)})),n}registerComponent(e,t,n,r){if(null==e||"string"!=typeof e)throw new Error("Invalid identifier "+e);if(null==t)throw new Error("Component cannot be null");if(r&&!H(Object.getPrototypeOf(t))&&!H(t))throw new Error("the given component do not contains some methods of DS/WAfrExecutionContext/mod_Component");if("setExecutionContext"in t==!1||"setRegisteredIdentifier"in t==!1)throw new Error("The component do not implements module:DS/WAfrExecutionContext/mod_Component~Component. Use applyComponentMixin first from the context.");if(this._components[e])throw new Error("An component has already been registered with this identifier "+e);const i=n?this._appComponents:this._stdComponents,o={standard:!n};this._components[e]=o,i.push(e),this.registerComponentThruMetaData(e,o,t)}removeComponent(e,t){if(!e)throw new Error("You must provide a metaData");if(!e.component)throw new Error("The component is already removed");const n=e.component.getRegisteredIdentifier();if(e.component.setExecutionContext(null),e.component.setRegisteredIdentifier(null),delete e.component,t){const t=e.standard?this._stdComponents:this._appComponents,r=t.indexOf(n);if(r>=0&&t.splice(r,1),!e.standard){w(this).removeComponentKey(n)}delete this._components[n]}}registerComponentThruMetaData=function(e,t,r){if(!t)throw new Error("The metaData do not exist: the module may not be required");if(t.component)throw new Error("The component: "+t.component._private._identifier+" is already created");if(!r){if(!t.ctor)throw new Error("The Component constructor must be defined.");if("function"!=typeof t.ctor)throw new Error(" Component constructor must be a constructor (i.e. functions)");r=D(t.ctor,t.options,!t.standard)}t.component=r;const i=t.standard?this:this.exposedApi;t.component.setExecutionContext(i),t.component.setRegisteredIdentifier(e);const o=t.component.createExposedComponent&&t.component.createExposedComponent();if(o)n.Component.mixinProperties(o),o.setExecutionContext(this.exposedApi),o.setRegisteredIdentifier(e),t.component.setExposedComponent(o);else{const n=t.component.getExposedComponentCtor&&t.component.getExposedComponentCtor();if(n){const r=D(n,void 0,!0);r.setExecutionContext(this.exposedApi),r.setRegisteredIdentifier(e),t.component.setExposedComponent(r)}}return t.component};removeMetadata(e){this._components&&delete this._components[e]}createAndRegisterComponent(e,t,n,r){if(this._components[e])return;const i=D(t,n,r);if(this.registerComponent(e,i,r),!this._components[e])throw new Error("The metaData for component do not exist !");return this._components[e].ctor=t,i}async requireStandardComponents(e,t){if(e.length!==t.length)throw new Error("Modules and keys do not have the same size!");let n,r,i,o,a;return new Promise(((s,d)=>{require(e,function(){let e;for(n=0;n<arguments.length;n+=1)r=arguments[n],i=t[n],e=this._components[i],o=e.ctorImport,a=o?r[o]:r,e.ctor=a,this.registerComponentThruMetaData(i,e);s()}.bind(this),d)}))}async registerStandardComponents(){o.log("[Execution context] Register standard components if need ");let e=[],n=[];if(this._stdComponents.length>0){let t;const i=[],o=[];for(const a of this._stdComponents){const s=this._components[a];s.context&&(r.evaluate(this._contexts,s.context),t=s.context.fit,s.component?!t&&s.component&&(i.push(s.component),o.push(s.component)):t&&(e.push(s.module),n.push(a)))}await this.cleanComponents({iterator:A(i)}),await this.destroyComponents(A(o))}else{const r=this.parseComponents(this._config.components,!1);this._components=t.merge(this._components,r.metaDatas),this._stdComponents=r.componentsKeys,e=r.readyModules,n=r.readyKeys}return await this.requireStandardComponents(e,n)}async initializeStandardComponents(e){if(!e)throw new Error("Missing iterator parameter");let t=null;return await M({action:async e=>{t=e.getCurrentInterpreter&&e.getCurrentInterpreter(),t&&t.commit&&t.commit(this,{componentId:e.getRegisteredIdentifier()});const n=this._perf.start(g+"initialize std :"+e._private._identifier);await e.initialize(),this._perf.stop(n)},iterator:e})}async enrichStandardComponents(e){const t=this._interpreters;for(let n=0;n<t.length;++n){const r=t[n];r.enrich&&await r.enrich(e,this)}}async configureComponents(e){await M({action:async function(e){return await e.configure()},iterator:e&&e.iterator?e.iterator:this.createComponentIterator(this._stdComponents)}),e&&e.setConfiguredFlag&&(this._isConfigured=!0)}registerApplicationComponent(e,t){if(!t)throw new Error("Component is null");return this.registerComponent(e,t,!0,!0)}createAndRegisterApplicationComponent(e,t,n){if(!t)throw new Error("Component is null");return this.createAndRegisterComponent(e,t,n,!0)}getApplicationComponent(e){return this.getComponent(e,!0)}unregisterApplicationComponent(e){return this.unregisterComponent(e,!0)}isRegisteredApplicationComponent(e){return this.isRegisteredComponent(e)}recycleApplicationComponent(e,t,n){if(t){if(!t.metaDatas[e])throw new Error('The App "'+this._targetApp.getId()+'" has requested to recycle the component "'+e+'" but do not declare it in its list of components :\n'+JSON.stringify(t.metaDatas,null,2))}return this.recycleComponent(e,n)}async prepareTransition(e){let t,n,r=0;if(!this._sourceApp)return;await this._sourceApp.onWillLeave(this._targetApp),await this._targetApp.onWillEnter(this._sourceApp);let i=!0,o=this._targetApp.getTransitionFrom(this._sourceApp.getId());if(o||(o=this._targetApp.getTransitionFromFamily(this._sourceApp.getFamily())),o){const a=o.components||{},s=o.handlers||{};if(null!=o.resetInfo&&(i=o.resetInfo),a.keep)if("@all"===a.keep)for(t in this.exposedApi._components)this.recycleApplicationComponent(t,e,i);else if(Array.isArray(a.keep))for(;r<a.keep.length;r++)n=a.keep[r],this.recycleApplicationComponent(n,e,i);if(s.keep&&Array.isArray(s.keep)){const t=this._sourceApp.options.appConfig.handlers.check,n=e.app.options.appConfig.handlers.check,i=this._sourceApp.options.appConfig.radioGroup.items,o=e.app.options.appConfig.radioGroup.items;let a="",d=a,c=a;const l=this.getComponent(WAfrStandardComponentKey.HandlerComponent);for(r=0;r<s.keep.length;r++){c=s.keep[r],a=d="";for(let e=0;e<t.length;e++)if(t[e].identifier==c){a=t[e].identifier+"-"+t[e].check.identifier+"-"+t[e].uncheck.identifier;break}for(let e=0;e<n.length;e++)if(n[e].identifier===c){d=n[e].identifier+"-"+n[e].check.identifier+"-"+n[e].uncheck.identifier;break}if(d===a&&""!=a){const e=l.getCheckState({id:c});this._handlers[c]=e}else{for(let e=0;e<i.length;e++)if(i[e].identifier==c)for(let t=0;t<i[e].items.length;t++)1==l.getRadioItemState({radioId:i[e].identifier,id:i[e].items[t].identifier})&&(a=i[e].identifier+"-"+i[e].items[t].identifier+"-"+i[e].items[t].check.identifier+"-"+i[e].items[t].uncheck.identifier);for(let e=0;e<o.length;e++)if(o[e].identifier==c)for(let t=0;t<o[e].items.length;t++)if(d=o[e].identifier+"-"+o[e].items[t].identifier+"-"+o[e].items[t].check.identifier+"-"+o[e].items[t].uncheck.identifier,d==a){const n=o[e].items[t].identifier;this._handlers[c]=n;break}}}}}await this.cleanComponents({removeForGood:!0});return w(this).cleanComponentMetadata(this),e}async initializeApplicativeComponents(e){if(!e)throw new Error("Missing iterator in initializeApplicativeComponents");return await M({action:async e=>{let t=this._perf.start(g+"initialize "+e._private._identifier);const n=this._components[e.getRegisteredIdentifier()];await e.initialize(n&&n.options),e.setInitializedState(!0),this._perf.stop(t)},iterator:e})}async load(e,t,n){if(!e.appId&&!e.afrAppId)throw new Error("Not found a valid App id from the current Id Card ");l.setAppid(e.appId||e.afrAppId),this.onWillLoadApp(e.appId||e.afrAppId),t||(t=e.afrVersion||"0.1"),o.log("[Execution context] load new app "+e.appId);try{if(m(e,"a2x")){if(!this._extensions.has(E)){const t=new((await u("DS/WAfrA2XExecutionContext/mod_ExecutionContextA2XExtension")).ExecutionContextA2XExtension)(e);this._extensions.set(E,t)}}else if(this._extensions.has(E)){const e=new Error("Trying to switch from an A2X to a non-A2X Application");console.error(e)}const r=b(this);let i;if(r&&await r.beginLoad(this,e,t,n),this.setInitialContext(e.initialContext),this._sourceApp&&(e.afrTransitionsFrom||e.afrTransitionsFromFamily)&&(i=e.afrTransitionsFrom?e.afrTransitionsFrom[this._sourceApp.getId()]:null,i||(i=e.afrTransitionsFromFamily?e.afrTransitionsFromFamily[this._sourceApp.getFamily()]:null),i&&"ReuseContext"===i.type)){const e=i.components||{};if(e.keep){if("@all"===e.keep)throw"TODO";if(Array.isArray(e.keep)){const t={};for(let n=0;n<e.keep.length;n++){const r=e.keep[n],i=this._components[r];i&&i.context&&!0===i.context.fit&&Object.keys(i.context.when).forEach((function(e){t[e]=i.context.when[e]}))}Object.keys(t).forEach((e=>{const n=t[e];null!=n&&(this._contexts[e]=String(n))}))}}}const a=await this._initExecutionContext(e,t,n),s=w(this);r&&(s.homePageRequested=s.homePageRequested&&r.allowHomePage(this.getWidgetID())),function(e,t){if(!e||!t)throw new Error("Missing parameter in configureApplication.");t._executionContext=e.exposedApi,t.setContainer(e.getContainerView())}(this,a.app),s.homePageRequested?await s.initializeSequence(this):r?await r.load(this):await this._appPromiseSequence(a);const d=this.getComponent(h);o.log("[Execution context] set the target app",this._targetApp,"as source app"),this.getSourceApp()&&!this.getSourceApp().isDisposeCalled()&&(y(this),this.getSourceApp().dispose());const c={pd1:this._targetApp.getUUID?.()||"None"},l={appID:this._targetApp?.getId?.()?this._targetApp.getId():"",pds:c};d?d.publish({event:"app_launch",data:l}):console.error("Model events is undefined"),this._sourceApp=this._targetApp,this._targetApp=null,this.hideLoader(),this.onDidLoadApp()}catch(e){return this.getSourceApp()&&l.setAppid(this.getSourceApp().getId()),this.hideLoader(),this.onDidFailToLoadApp(e),this._targetApp=null,Promise.reject(e)}}async loadApp(e,t){return await new Promise(((n,r)=>{let i=e.afrCode;i||(i="DS/WAfrAppManager/App"),i=i.replace(/\./g,"/");const s=this.parseComponents(e.components||[],!0),d=[i].concat(s.readyModules);let c,l,p,h,u,m;o.log("[Execution Context] Require modules",d),require(d,function(){const r=arguments[0];if(arguments.length!==s.readyKeys.length+1)throw new Error("The count of arguments and components do not fit");for(c=0;c<s.readyKeys.length;c++)l=s.readyKeys[c],p=s.metaDatas[l],h=arguments[c+1],u=p.ctorImport,m=u?h[u]:h,p.ctor=m,this.registerComponentThruMetaData(l,p);const i=new r({appConfig:e,appIds:t?t.appIds:null,appInfo:t?t.appInfo:null});if(i instanceof a==!1)throw new Error("The app loaded is not an instance of DS/WAfrAppManager/App");if(!i.getId())throw new Error("The app loaded do not have an id");const d=b(this);d&&d.overloadApp(i,this),o.log("[App Interpreter] Success require App and components"),n({app:i,metaDatas:s.metaDatas,componentsKeys:s.componentsKeys,WSComponentsKeys:s.WSComponentsKeys})}.bind(this),r)}))}async callAllInterpreters(e,t){o.log("[Execution context] Start interpret id card");const n=[];let r=this._version!==t;const i=_(e);if(!this._interpreters){this._interpreters=[],r=!1;for(let e=0;e<this._config.interpreters.length;++e){const n=this._config.interpreters[e].module,r=await n.generateInterpreter(t,i);this._interpreters.push(r)}}const a=this._interpreters;for(let o=0;o<this._interpreters.length;++o){let s=null;r?(s=await this._config.interpreters[o].module.generateInterpreter(t,i),a[o]=s):s=a[o];const d=this._config.interpreters[o].target,c=this.getComponent(d);if(!c)throw new Error("No component associated to the given interpreter");if(c.setCurrentInterpreter(s),s){const t=s.interpret(e,this,{componentId:d});n.push(t)}}return await Promise.all(n)}async setUpApp(){const e=this.getProcessingApplication(),t=this._sourceApp;if(!e)throw new Error("Missing parameter while calling SetUp function.");return await new Promise(((n,r)=>{const i=e.setUp({sourceApp:t,done:n,failure:r});i&&i.then(n,r)}))}async dispose(){y(this);const e=b(this);e&&await e.dispose(this),await this._disposeExecutionContext()}onDidChangeContext(){this._timerHandle=null;const e=this._contexts;S(this,(function(t){t.context&&r.evaluate(e,t.context)})),this.onDidProcessContextualComponent()}parseComponents(e,t){const n=[],i=[],o={},a=[],s=[];for(let d of e){let e=!0,c={module:d.code,ctorImport:d.ctor,options:d.options,standard:!t,resetInfo:d.resetInfo};if(o[d.key]=c,a.push(d.key),d.when&&(c.context={element:d.key,when:r.parseWhen(d.when)},r.evaluate(this._contexts,c.context),e=c.context.fit),t){e=w(this).parseComponent(d,e,s)}e&&(n.push(d.code),i.push(d.key))}return{readyModules:n,readyKeys:i,metaDatas:o,componentsKeys:a,WSComponentsKeys:s}}setInitialContext(e){const t=Object.create(null);let n;Object.keys(e||t).forEach((function(r){n=e[r],null!=n&&(t[r]=String(n))})),this._contexts=t}setContext(e,t){return this._contexts[e]!==t&&(t?this._contexts[e]=String(t):delete this._contexts[e],this._timerHandle&&clearTimeout(this._timerHandle),this._timerHandle=setTimeout(this.onDidChangeContext.bind(this,this._contexts),0)),this}_dispatchEvent(e,t){const n=this.getComponent("AFR_ModelEvents");n&&n.publish({event:e,scope:"ALL",data:t})}onWillLoadApp(e){this._dispatchEvent("onWillLoadApp",e)}onDidLoadApp(e){this._dispatchEvent("onDidLoadApp",e)}onDidFailToLoadApp(e){this._dispatchEvent("onDidFailToLoadApp",e)}onDidContextualComponentsUpdate(){this._dispatchEvent("onDidContextualComponentsUpdate")}async onDidProcessContextualComponent(){const e=[],t=[],n=[],r=[],i=[],o=[],a=w(this);S(this,((s,d)=>{if(s.context){let c=!0;s.standard||a.hasComponentKey(d)||(c=c&&!a.homePageDisplayed),c&&s.context.fit&&!s.component?s.ctor?(this.registerComponentThruMetaData(d,s),s.standard?i.push(s.component):o.push(s.component)):(e.push(s.module),t.push(d)):s.context.fit||s.component&&(n.push(s.component),s.standard&&r.push(s.component))}})),await new Promise(((n,r)=>{let a,s,d,c;require(e,function(){if(arguments.length!==e.length)return n();for(a=0;a<arguments.length;a++)s=arguments[a],d=t[a],c=this._components[d],c.ctor=s,c=this._components[d],this.registerComponentThruMetaData(d,c),c.standard?i.push(c.component):o.push(c.component);n()}.bind(this),r)})),await this.cleanComponents({iterator:A(n)}),await this.destroyComponents(A(r)),await this.initializeStandardComponents(A(i)),await this.initializeApplicativeComponents(A(o)),a.homePageDisplayed||a.homePageRequested||await this.configureComponents({iterator:A(i),setConfiguredFlag:!1}),this.onDidContextualComponentsUpdate()}displayLoader(e){this._container&&this._container.id!=e.id||this._view&&this._view.displayLoader(e)}hideLoader(){this._view&&this._view.hideLoader()}async gotoWelcomeScreen(){const e=b(this);e&&await e.gotoWelcomeScreen(this);const t=w(this);t.homePageRequested=!0,await t.setUp(this);const n=this.getComponent("AFR_UIFrameManager");n&&n.isStatusBarDisplayed()&&n._privateSetStatusBarWrapperVisibility(!1),t.homePageDisplayed=!0}async gotoApp(){w(this).homePageRequested=!1;const e=b(this);if(e)return await e.gotoApp(this);const t=this.getComponent("AFR_UIFrameManager");return t&&t.isStatusBarDisplayed()&&t._privateSetStatusBarWrapperVisibility(!0),await this._appPromiseSequence()}getWelcomeScreenState(){return w(this).homePageDisplayed}},C})),define("DS/WAfrContainer/Container",["UWA/Core","UWA/Class/Promise","DS/Core/Core","DS/WAfrExecutionContext/mod_ExecutionContext","DS/PlatformAPI/PlatformAPI","DS/WAfrUtils/Logger","WebappsUtils/WebappsUtils","DS/WAFData/WAFData","DS/WAfrUtils/mod_ConcatenationUtils"],(function(e,t,n,r,i,o,a,s,d){"use strict";const c=d.hasConfigurationFor;var l=r.ExecutionContext,p=function(t){var n,r={view:null,debug:!1,infraComponents:[],proxified:!1,baseUrl:a.getWebappsBaseUrl()};if(n=e.extend(e.clone(r),t),this._proxified=n.proxified,this._view=n.view,!this._view)throw new Error("A view must be defined for the container");this.id=this._view.getId(),this._executionContexts=[],this._currentExecutionContext=-1,this._config=n.config,this._forceProxy=n.forceProxy,this._registeredInfraComponents=n.standardComponents,this._baseUrl=n.baseUrl,this._version=n.version,o.debug("Registry",n&&n.registry),this._context=t.context?t.context:void 0;var i=this.destroy.bind(this);this._view.addEvent("onDestroy",i),this._view.addEvent("onBeforeDestroy",i),this._restoreContextsIfNeed({context:this._context,registry:n&&n.registry});var s=this;this.subscribe("onCreateContext."+this.id,(function(e){s.createNewExecutionContext({registry:n&&n.registry}),s.loadCurrentConfig(e)})),Object.defineProperty(this,"currentApp",{get:function(){var e=this.getCurrentExecutionContext();if(e){var t=e.getSourceApp();if(t)return t}}}),Object.defineProperty(this,"lang",{get:function(){return this._view.getLanguage()}}),Object.defineProperty(this,"productTitle",{get:function(){const e=this._view.getValue("afrProductTitle");return e?decodeURI(e):e}})};function h(e,t){return new Promise(((n,r)=>{require([`text!DS/WebAfr/Applications/${e}${void 0===t?"":`_${t}`}.json`],(function(e){let t;try{t=JSON.parse(e)}catch(e){return r(e)}return n(t)}),(function(e){return r(e)}))}))}return p.prototype.destroy=function(e){return this.id==e&&(this._executionContexts.map((function(e){return e.dispose()})),this._executionContexts=[],this._currentExecutionContext=-1,this._view.setValues({afrCode:void 0,afrAppId:void 0,appId:void 0,title:void 0,appTitle:void 0,afrDebug:void 0,components:void 0}),this._view.destroy(),sessionStorage.removeItem("WAfrABV3FirstLaunch")),t.resolve()},p.prototype._restoreContextsIfNeed=function(e){const t=e&&e.context,n=e&&e.registry;var r=this._view.getValue("afrExecutionContexts")||[],i=this._view.getValue("afrCurrentExecutionContextIdx")||0,a=this._view.getValue("afrAppId");if(r.length>0&&!a&&(o.warn("A context has been found "+JSON.stringify({contexts:r})+" but the app id is null,Ignore the restoration of the saved context"),r=[]),0===r.length||"AppsTester"===t||"AppStandalone"===t){var s=this.createNewExecutionContext({registry:n});r.push({id:s.getId(),currentappId:null}),i=this._currentExecutionContext}else{var d=0;for(d=0;d<r.length;d++)this.createNewExecutionContext({id:r[d].id,registry:n});if(i<0||i>=r.length)throw new Error("The current context index must be in the range of the list of contexts");this._currentExecutionContext=i}this._view.setValue("afrExecutionContexts",r.slice()),this._view.setValue("afrCurrentExecutionContextIdx",i)},p.prototype.createNewExecutionContext=function(e){const t=e&&e.id,n=e&&e.registry;var r=new l({id:t,registry:n,container:this,config:this._config});return this._executionContexts.push(r),this._currentExecutionContext=this._executionContexts.length-1,this._view.addExecutionContextView(r,this.onChangeExecutionContext.bind(this)),r},p.prototype.onChangeExecutionContext=function(e){},p.prototype.getApplicationJSON=function(e){var t=e||this.getCurrentConfig();if(!t.afrAppId)return Promise.reject("The current configuration could not locate a WebAfr application");const n=t.afrAppId;return h(n).catch((e=>h(n,"en")))},p.prototype.requestWAfrService=function(e,n){var r,i=this;if(!this._configService)return t.resolve();if(n&&!e)throw new Error("Must provide an app id to call the transition service");e=e||this._configService.afrAppId||this._configService.appId;var o,a=this._configService.afrService,d="GET";if(n&&(a=a.replace("/apps","/transition"),d="POST",o={containers:[{id:this.id,contexts:this._view.getValue("afrExecutionContexts"),currentIndex:this._view.getValue("afrCurrentExecutionContextIdx")}],currentIndex:0}),!(a+=e).startsWith("http")){var c=this._baseUrl.split("/");if(c.length>=2){var l=c[2].split(":"),p=l[0],h="";l.length>1&&!this._configService.afrServicePort&&(h=":"+l[1]),this._configService.afrServicePort&&(h=":"+this._configService.afrServicePort),a=c[0]+"//"+p+h+"/"+a}}this.lang&&(a+="?lang="+this.lang);var u=this._proxified?this._forceProxy?"proxifiedRequest":"authenticatedRequest":"request";return r=i._executionContexts[i._currentExecutionContext]._perf.start("WAFR: request the App data from WAfr Server"),new t((function(e,t){s[u](a,{type:"json",responseType:"json",method:d,data:o,onComplete:function(t){i._executionContexts[i._currentExecutionContext]._perf.stop(r),e(t)},onFailure:function(e){e.url=a,t(e)}})})).catch((function(e){if(e.message.contains("NetworkError"))return i.getApplicationJSON()}))},p.prototype.loadCurrentConfig=function(e,t){var n=e||this.getCurrentConfig();this._configService=null,n.appTitle&&"Apps supporting transition"!==n.appTitle||(n.appTitle=this._view.getTitleHeader().appTitle);var r=this.getCurrentExecutionContext();let i=null;return 1===this._version?i=Promise.resolve():2===this._version&&(n.afrService?(this._configService=n,i=this.requestWAfrService()):i="0.2"===n.afrVersion?Promise.resolve(null):"0.1"===n.afrVersion?this.getApplicationJSON().then((function(e){return Promise.resolve(e)}),(function(e){return Promise.resolve(null)})):this.getApplicationJSON()),i.then((e=>{if(c(e||n,"a2x")){if(window.dsDashboardWindow&&window.dsDashboardWindow.top.dsA2X&&!window.dsDashboardWindow.top.dsA2X._a2XWebFrame){require(["DS/WAfrA2XWebFrame/A2XWebFrame"],(function(e){let n={globalImmersiveFrame:t.globalImmersiveFrame};window.dsDashboardWindow.top.dsA2X._a2XWebFrame=new e(n)}),(()=>{}))}return this.initializeA2XSession(e||n).then((()=>(window.dsDashboardWindow&&window.dsDashboardWindow.top.dsA2X&&window.dsDashboardWindow.top.dsA2X._a2XWebFrame&&window.dsDashboardWindow.top.dsA2X._a2XWebFrame.init(n.afrExecutionContexts[n.afrCurrentExecutionContextIdx],this._context),Promise.resolve(e))))}return Promise.resolve(e)})).then((e=>{const i=t&&t.appInfo?t.appInfo:null;let o=null;n&&(o={appId:n.appId,afrAppId:n.afrAppId,appTitle:n.appTitle});const a={appIds:o,appInfo:i};return r.load(Object.assign(e||n,{winId:t&&t.winId?t.winId:null,nativeAppContent:t&&t.nativeAppContent?t.nativeAppContent:null}),void 0,a)}))},p.prototype.initializeA2XSession=function(e){var t=this;let n=null,r=null;return r=t._a2xClient?Promise.resolve():new Promise((function(e,r){require(["DS/WA2XCommunication/WA2XClient","DS/WA2XCommunicationUI/WA2XClientUI"],(function(r,i){t._a2xClient=r.getA2XClient(),n=i,e()}),r)})),r.then((()=>t.processA2XConfig(e))).then((e=>{let r=t.getCurrentExecutionContext();if(t._a2xClient&&!t._a2xClient.isConnected()&&r){let t=r.getUiContainer();return n.connect(e,t)}})).catch((e=>{throw e}))},p.prototype.processA2XConfig=function(e){const t="default",n="custom",r="afrTest",i={hypervisorUrl:"ws://localhost:2097",poolName:"A2XPool"};let o=e.stdConf.a2x.configurationName;return new Promise((function(a,s){if(o){if(o===t)a(i);else if(o===n){let t=e.stdConf.a2x,n=t.configurationFile;n?require([n],(e=>{a(JSON.parse(e))}),(e=>{s(e)})):a(t)}else if(o===r){if(!window.__karma__||!window.__karma__.config||!window.__karma__.config.json)throw new Error("Impossible to retrieve the json configuration from KARMA_ODT_CLIENT_JSON");const e=window.__karma__.config.json,t=`ws://localhost:${e.websocketPort}`,n=e.poolName;a({hypervisorUrl:t,poolName:n})}}else s(new Error("The configurationName property cannot be empty"))}))},p.prototype.launchApp=function(n,r){var i=this.id;return new t((function(t,o){require(["DS/i3DXCompassServices/i3DXCompassPubSub"],(function(a){a.subscribe("launchAppCallback",(function(e){"COMPLETE"===e.response?t():o()}));var s={widgetId:i,appId:n};s=e.extend(s,r),a.publish("launchApp",s)}))}))},p.prototype.getCurrentConfig=function(){var t=e.clone(this._view.getValues());return t.appId=this._view.getValue("appId"),t.afrAppId||(t.afrAppId=t.appId),t.version=this._view._version,t},p.prototype.publish=function(e,t){i.publish(e,t)},p.prototype.subscribe=function(e,t){i.unsubscribe(e),i.subscribe(e,t)},p.prototype.getCurrentExecutionContext=function(){return this._currentExecutionContext<0?null:this._executionContexts[this._currentExecutionContext]},p.prototype.registerInfraComponents=function(e){for(var t=0;t<this._registeredInfraComponents.length;t++){var n=this._registeredInfraComponents[t],r=n.DEFAULT_COMPONENT_NAME;e.createAndRegisterComponent(r,n,{container:this})}},p.prototype.updateTitle=function(e,t){if(!t){const e=this.getCurrentExecutionContext();e&&(t=e.getTargetApp()||e.getSourceApp())}t&&(e.appTitle=e.appTitle||t.getTitle()||this._view.getValue("appTitle"),e.brand=e.brand||t.getBrand()||this._view.getValue("brand"));const n=e.title?encodeURI(e.title):e.title;this._view.setValue("afrProductTitle",n),this._view.setValue("title",e.title),this._view.setTitleHeader(e)},p.prototype.updateAppTitle=function(e){const t=this._view.getId(),n=window.dsDashboardWindow?window.dsDashboardWindow.top.UWA?window.dsDashboardWindow.top.UWA.Widgets?window.dsDashboardWindow.top.UWA.Widgets.instances:[]:void 0:window.top.UWA?window.top.UWA.Widgets?window.top.UWA.Widgets.instances:[]:void 0;if(n&&n.length){let r=n.findIndex((e=>t===e.id));if(-1!==r){const t=n[r]?n[r].environment:void 0;t&&t.wp&&t.wp.originalTitle&&(t.wp.originalTitle=e)}}},p})),define("DS/WAfrHandlers/private/private_ActionHandlerUtilities",["DS/CoreUtilities/ErrorManagement","DS/WAfrHandlers/private/private_Utilities","DS/Utilities/UUID","DS/WAfrModelEvents/mod_ModelEvents"],(function(e,t,n,r){"use strict";const i=r.DEFAULT_COMPONENT_NAME;let o=Object.create(null);function a(e){const t=e.getI18n()?e.getI18n():null;return{pd1:e._private._cmdUUID,pd2:t?t.title:"",pd3:e._private._handlerTrigger}}function s(t){if(!this.actionHandler)throw new Error("this.action is undefined. A problem occurred when calling this function.");const n=this.actionHandler,r=n.getHandlerComponent();if(!r)throw new Error("There is no HandlerComponent related to this ActionHandler",n);const o=r.getEventChannel();if(!o)throw new Error("Retrieved eventChannel is undefined");const s=n.getId();if(!s)throw new Error("handlerIdentfier has to be a non empty string.");o.publish({event:s+"/END"});const d=r.getExecutionContext?.()?r.getExecutionContext():null,c=d.getSourceApp?.()?d.getSourceApp():null,l=c?.getId?.()||"",p=a(n);p.pd4="Validated";const h={pv1:Date.now()-n._private._startTimeCmd};if("Internal"!==n._private._handlerTrigger){const e={id:s,appID:l,pds:p,pvs:h},t=d.getComponent(i);t?t.publish({event:"command_end",data:e}):console.error("Model events is undefined")}if(!t){const n=e.getErrorManager();t=e.createReturnObject(n.SUCCEEDED)}if(this.cb&&"function"==typeof this.cb)this.cb(t);else if(t&&!e.hasSucceeded(t))throw t.getError()}return o.ImplementationTypes={EXPORTED_FUNCTION:"EXPORTED_FUNCTION",COMPONENT_METHOD:"COMPONENT_METHOD"},o.executeActionHandler=function(r){const d=r.handler;let c=r.cb;if(!d)throw new Error("actionHandler has to be defined and cannot be null");var l=d.getHandlerComponent();if(!l)throw console.warn("NO HANDLER COMPONENT SET"),new Error;if(!l.getExecutionContext())throw console.warn("NO EXECUTION CONTEXT SET"),new Error;null!==c&&"function"==typeof c||(c=void 0);const p=r.args?r.args:null;d._private._cmdUUID=n.createUUID(),d._private._handlerTrigger=p?p.handlerTrigger:"Internal",d._private._startTimeCmd=Date.now();const h=a(d),u=l.getExecutionContext?.()?l.getExecutionContext():null,m=u.getSourceApp?.()?u.getSourceApp():null,_=m?.getId?.()||"";if("Internal"!==d._private._handlerTrigger){const e={id:r.handler.getId?.()?r.handler.getId():"",appID:_,pds:h},t=u.getComponent(i);t?t.publish({event:"command_launch",data:e}):console.error("Model events is undefined")}let f=null;f=d._private._implementationType===o.ImplementationTypes.EXPORTED_FUNCTION?new Promise(((t,n)=>{require([d._private._action._module],(function(r){const i=e.getErrorManager();let o;if(r){const a=r[d._private._action._func];return a&&"function"==typeof a?t(a):(o=e.createReturnObject(i.FAILED,{description:`Unknown function ${d._private._action._func} in ${d._private._action._module}`}),n(o))}return o=e.createReturnObject(i.WRONG_VALUE,{description:"Module require return undefined"}),n(o)}),(function(){const t=e.getErrorManager(),r=e.createReturnObject(t.FAILED,{description:`Require failed (${d._private._action._module})`});return n(r)}))})):new Promise(((t,n)=>{if(!(l=d.getHandlerComponent()))throw new Error("There is no HandlerComponent related to this ActionHandler",d);const r=l.getExecutionContext().exposedApi,i=d._private._action._component,o=r.getComponent(i);if(!o){const t=e.getErrorManager();return n(e.createReturnObject(t.FAILED,{description:`Impossible to retrieve the component (${i})`}))}if(!o[d._private._action._func]){const t=e.getErrorManager();return n(e.createReturnObject(t.FAILED,{description:`No function ${d._private._action._func} exposed by ${i}`}))}return t(o[d._private._action._func].bind(o))})),f.then((function(e){let n=Object.create(null);if(n.cb=c,n.actionHandler=d,!(l=d.getHandlerComponent()))throw new Error("There is no HandlerComponent related to this ActionHandler",d);let i=Object.create(null);d._private._implementationType!==o.ImplementationTypes.COMPONENT_METHOD&&(i.executionContext=l.getExecutionContext().exposedApi),i.args=t.computeArgs(d,r.args);const a=l.getEventChannel();if(!a)throw new Error("Retrieved eventChannel is undefined");const p=d.getId();if(!p)throw new Error("handlerIdentfier has to be a non empty string.");a.publish({event:p+"/BEGIN"});const h=s.bind(n);d._private._implementationType===o.ImplementationTypes.EXPORTED_FUNCTION?e(h,i):e(i).then(h).catch(h)}),(function(t){if(t)if(c)c(t);else if(!e.hasSucceeded(t))throw t.getError()}))},o})),define("DS/WAfrHandlers/mod_ActionHandler",["DS/WAfrHandlers/private/private_Utilities","DS/WAfrHandlers/private/private_ActionHandlerUtilities","DS/WAfrHandlers/mod_LeafHandler","DS/WAfrHandlers/mod_HandlerComponent"],(function(e,t,n){"use strict";let r=Object.create(null);const i=n.LeafHandler,o=n.StandaloneLeafHandlerState,a="ACTION_HANDLER";e.registerLeafHandler(a,{executeFunc:t.executeActionHandler}),r.LifeCycleEvents={BEGIN:"BEGIN",END:"END"},r.ImplementationTypes=t.ImplementationTypes;class s extends o{constructor(e){super(e)}execute(e){const n=e?e.cb:void 0,r=e?e.args:void 0;return t.executeActionHandler({handler:this._handler,cb:n,args:r})}}return r.ActionHandler=class extends i{constructor(t){if(super(t),this._private||(this._private=Object.create(null)),!t)throw new Error("parameters has to be defined");if(this._private._type=e.enums.HandlerType[a],this._private._action=Object.create(null),this._private._implementationType=r.ImplementationTypes.EXPORTED_FUNCTION,void 0!==t.implementationType){if(n=t.implementationType,!Boolean(n)||!r.ImplementationTypes.hasOwnProperty(n))throw new Error(`parameters.implementationType value is not a valid one. (${t.implementationType})`);this._private._implementationType=t.implementationType}var n;if(this._private._implementationType===r.ImplementationTypes.EXPORTED_FUNCTION){if(!t.module||"string"!=typeof t.module)throw new Error('parameters.module has to be defined and to be a non empty string in case of "EXPORTED_FUNCTION"');this._private._action._module=t.module}else{if(!t.component||"string"!=typeof t.component)throw new Error('parameters.component has to be defined and to be a non empty string in case of "COMPONENT_METHOD"');this._private._action._component=t.component}if(!t.func||"string"!=typeof t.func)throw new Error("parameters.func has to be defined and to be a non empty string");this._private._action._func=t.func,this._private._handlerState=new s(this)}makeStandalone(){if(this._private._handlerState instanceof s)throw new Error("Call makeStandalone method on an ActionHandler which is already a standalone item");this._private._handlerState=new s(this)}execute(e){super.execute(e)}setHandlerComponent(e){return this._private._handlerState.setHandlerComponent(e)}getHandlerComponent(){return this._private._handlerState.getHandlerComponent()}onLifeCycleEvent(e,t){if(!e)throw new Error("identifier has to be a non empty string");const n=e.toUpperCase();if(!function(e){return Boolean(e)&&r.LifeCycleEvents.hasOwnProperty(e)}(n))throw new Error("The given identifier is not supported by an ActionHandler",e);if(!t||"function"!=typeof t)throw new Error("cb has to be a function",t);const i=this.getHandlerComponent();if(!i)throw new Error("There is no HandlerComponent related to this ActionHandler",this);const o=i.getEventChannel();if(!o)throw new Error("Retrieved eventChannel is undefined");const a=this.getId();if(!a)throw new Error("handlerIdentfier has to be a non empty string.");return o.subscribe({event:a+"/"+n},t)}removeLifeCycleEventSubscription(e){if(void 0===e)throw new Error("token has to be defined");const t=this.getHandlerComponent();if(!t)throw new Error("There is no HandlerComponent related to this ActionHandler",this);const n=t.getEventChannel();if(!n)throw new Error("Retrieved eventChannel is undefined");if(!this.getId())throw new Error("handlerIdentfier has to be a non empty string.");return n.unsubscribe(e)}},r})),define("DS/WAfrHandlers/mod_CheckHandler",["DS/CoreUtilities/ErrorManagement","DS/WAfrHandlers/private/private_Utilities","DS/WAfrHandlers/private/private_CheckHandlerUtilities","DS/WAfrHandlers/mod_Handler","DS/WAfrHandlers/mod_ActionHandler","DS/WAfrHandlers/mod_CommandHandler"],(function(e,t,n,r,i,o){"use strict";const a=r.Handler,s=i.ActionHandler,d=o.CommandHandler;let c=Object.create(null);function l(e,t){let n=!1;return(e.beingInitialized()||t===e._private._check&&!e._private._isChecked||t===e._private._uncheck&&e._private._isChecked)&&(n=!0),n}function p(e){let t=!1;var n=!0;return(e._private._check&&!e._private._check.isAvailable()||e._private._uncheck&&!e._private._uncheck.isAvailable())&&(n=!1),e.isAvailable()!==n&&(e._private._currentAvailability=n,t=!0),t}c.StateEvents={CHECK:"CHECK",UNCHECK:"UNCHECK"};class h{constructor(e,t){if(!e||!t)throw new Error("manageable and handlerManager have to be define");this._checkHandler=e,this._manager=t}handleExecute(t){if(!t)throw new Error("Wrong parameters");{const n=t.cb,r=t.manageable,i=t.args;if(r!==this._checkHandler._private._check&&r!==this._checkHandler._private._uncheck)throw new Error("Internal error. The manageable calling handle is not managed by this manager.");l(this._checkHandler,r)?this._manager.handleExecute({cb:t.cb,manageable:this._checkHandler,action:!this._checkHandler._private._isChecked,args:i}):n&&"function"==typeof n&&setTimeout((function(){const t=e.getErrorManager();n(e.createReturnObject(t.SUCCEEDED))}),0)}}handleOnAvailabilityChanged(e){const t=this._checkHandler,n=this._manager;p(t)&&(e.args.newValue=t.isAvailable(),e.manageable=t,n.handleOnAvailabilityChanged(e))}isExecutable(){return this.handleIsExecutable()}handleIsExecutable(){return this._manager.handleIsExecutable({manageable:this._checkHandler})}setState(){throw new Error("You can not directly change the state of a CheckHandler which is managed")}setHandlerComponent(){return console.warn("Impossible to set a HandlerComponent to a CheckHandler which is managed."),!1}getHandlerComponent(){return this._manager.getHandlerComponent()}disable(){throw new Error("Impossible to disable a Managed Handler")}enable(){throw new Error("Impossible to enable a Managed Handler")}onIsEnabledChangeEvent(){throw new Error("Impossible to subscribe to isEnabledChangeEvent from a Managed Handler")}removeIsEnabledChangeEventSubscription(){throw new Error("Impossible to unsubscribe to isEnabledChangeEvent from a Managed Handler")}}class u{constructor(e){if(!e)throw new Error("checkHandler has to be defined");this._checkHandler=e}handleExecute(t){if(!t)throw new Error("Wrong parameters");{const r=t.cb,i=t.manageable,o=t.args;if(i!==this._checkHandler._private._check&&i!==this._checkHandler._private._uncheck)throw new Error("Internal error. The manageable calling handleExecute is not managed by this manager.");l(this._checkHandler,i)?n.executeCheckHandler(this._checkHandler,{cb:r,action:!this._checkHandler._private._isChecked,args:o}):r&&"function"==typeof r&&setTimeout((function(){const t=e.getErrorManager();r(e.createReturnObject(t.SUCCEEDED))}),0)}}setState(t){const n=t.state,r=t.cb,i=t.args;if(n!==this._checkHandler._private._isChecked){let e;e=this._checkHandler._private._isChecked?this._checkHandler._private._uncheck:this._checkHandler._private._check,this.handleExecute({cb:r,manageable:e,args:i})}else setTimeout((function(){const t=e.getErrorManager();r(e.createReturnObject(t.SUCCEEDED))}),0)}setHandlerComponent(e){if(void 0===e)throw new Error("component has to be defined");return this._checkHandler._private._handlerComponent=e,!0}getHandlerComponent(){return this._checkHandler._private._handlerComponent}handleOnAvailabilityChanged(){const e=this._checkHandler;p(e)&&t.publishHandlerAvailability(e)}isExecutable(){return this.handleIsExecutable()}handleIsExecutable(){return a.prototype.isExecutable.call(this._checkHandler)}disable(...e){return a.prototype.disable.call(this._checkHandler,...e)}enable(...e){return a.prototype.enable.call(this._checkHandler,...e)}onIsEnabledChangeEvent(...e){return a.prototype.onIsEnabledChangeEvent.call(this._checkHandler,...e)}removeIsEnabledChangeEventSubscription(...e){return a.prototype.removeIsEnabledChangeEventSubscription.call(this._checkHandler,...e)}}return c.CheckHandler=class extends a{constructor(e){if(super(e),this._private._check=null,this._private._uncheck=null,!e||!e.id)throw new Error("Wrong parameters");this._private._id=e.id,this._private._isChecked=!1,this._private._handlerState=new u(this)}makeStandalone(){if(this._private._handlerState instanceof u)throw new Error("Call makeStandalone method on an CheckHandler which is already a standalone item");this._private._handlerState=new u(this)}makeManaged(e){if(this._private._handlerState instanceof h)throw new Error("Call makeManaged method on an CheckHandler which is already managed");this._private._handlerState=new h(this,e),delete this._private._handlerComponent}validateElement(e){return e instanceof s||e instanceof d}addElement(e,t){let n=!1;if(!e||!t||!t.state||"check"!==t.state&&"uncheck"!==t.state)throw new Error("Imcompatible parameters");const r="_"+t.state;return this.validateElement(e)&&!this._private[r]&&(this._private[r]=e,e.makeManaged(this),this._private._handlerState.handleOnAvailabilityChanged({manageable:this,args:{newValue:e.isAvailable()}}),n=!0),n}handleExecute(e){return this._private._handlerState.handleExecute(e)}isExecutable(){return this._private._handlerState.isExecutable()}handleIsExecutable(e){if(!e||!e.manageable)throw new Error("Wrong parameters");if(e.manageable!==this._private._check&&e.manageable!==this._private._uncheck)throw new Error("The given manageable is not managed by this CheckHandler");return this._private._handlerState.handleIsExecutable()}getCheckHandler(){return this._private._check}getUncheckHandler(){return this._private._uncheck}setState(t){if(this.isExecutable())this._private._handlerState.setState(t);else{const n=e.getErrorManager(),r=e.createReturnObject(n.NOT_EXECUTABLE,{description:"This CheckHandler is not executable"});if(!t||!t.cb)throw r.getError();setTimeout((function(){t.cb(r)}),0)}}getState(){return this._private._isChecked}setHandlerComponent(e){return this._private._handlerState.setHandlerComponent(e)}getHandlerComponent(){return this._private._handlerState.getHandlerComponent()}handleOnAvailabilityChanged(e){if(!e||!e.manageable||!e.args||void 0===e.args.newValue)throw new Error("handleExecute was called using wrong parameters",e);return this._private._handlerState.handleOnAvailabilityChanged(e)}onStateEvent(e,t){if(!e)throw new Error("identifier has to be a non empty string");const n=e.toUpperCase();if(!function(e){return Boolean(e)&&c.StateEvents.hasOwnProperty(e)}(n))throw new Error("The given identifier is not supported by a CheckHandler",e);if(!t||"function"!=typeof t)throw new Error("cb has to be a function",t);const r=this.getHandlerComponent();if(!r)throw new Error("There is no HandlerComponent related to this CheckHandler",this);const i=r.getEventChannel();if(!i)throw new Error("Retrieved eventChannel is undefined");const o=this.getId();if(!o)throw new Error("handlerIdentfier has to be a non empty string.");return i.subscribe({event:o+"/"+n},t)}removeStateEventSubscription(e){if(void 0===e)throw new Error("token has to be defined");const t=this.getHandlerComponent();if(!t)throw new Error("There is no HandlerComponent related to this CheckHandler",this);const n=t.getEventChannel();if(!n)throw new Error("Retrieved eventChannel is undefined");if(!this.getId())throw new Error("handlerIdentifier has to be a non empty string.");return n.unsubscribe(e)}disable(){return this._private._handlerState.disable()}enable(){return this._private._handlerState.enable()}onIsEnabledChangeEvent(e){return this._private._handlerState.onIsEnabledChangeEvent(e)}removeIsEnabledChangeEventSubscription(e){return this._private._handlerState.removeIsEnabledChangeEventSubscription(e)}destroy(){super.destroy(),this._private._check&&this._private._check.destroy(),this._private._uncheck&&this._private._uncheck.destroy()}},c})),define("DS/WAfrHandlers/mod_RadioHandler",["DS/CoreUtilities/ErrorManagement","DS/WAfrHandlers/private/private_Utilities","DS/WAfrHandlers/mod_Handler","DS/WAfrHandlers/mod_CheckHandler"],(function(e,t,n,r){"use strict";const i=n.Handler,o=r.CheckHandler;let a=Object.create(null);a.ItemStateEvents={SELECT:"SELECT",UNSELECT:"UNSELECT"};return a.RadioHandler=class extends i{constructor(e){super(e),this._private._checkedElement=null,this._private._elements=[]}validateElement(e){return e instanceof o}addElement(e){let t=!1;if(!e||e===this||!e.makeManaged||"function"!=typeof e.makeManaged)throw new Error;if(!this.validateElement(e))throw new Error("elt is not a valide element to add to a RadioHandler");return this._private._elements.push(e),e.makeManaged(this),this.handleOnAvailabilityChanged({manageable:this,args:{newValue:e.isAvailable()}}),t=!0,t}getElements(){if(!this._private||!this._private._elements||!Array.isArray(this._private._elements))throw new Error("Internal error");return this._private._elements}getElementById(e){const t=this._private._elements.length;let n=0,r=!1,i=null;for(;!r&&n<t;){const t=this._private._elements[n];t.getId()===e&&(r=!0,i=t),++n}return i}getSelectedItem(){let e=null;const t=this.getSelectedItemId();return t&&(e=this.getElementById(t)),e}setRadioItemState(t){const n=t.radioHdlrItemId,r=t.state,i=t.cb,o=t.args,a=e.getErrorManager();let s,d,c=0;const l=this._private._elements.length;for(c=0;c<l;++c)this._private._elements[c].getId()===n&&(d=this._private._elements[c]);if(d)if(this.isExecutable()){let e=Object.create(null);e.cb=i,e.manageable=d,e.action=r,e.args=o,this.handleExecute(e)}else{if(s=e.createReturnObject(a.NOT_EXECUTABLE,{description:"This RadioHandler is not executable"}),!t||!t.cb)throw s;setTimeout((function(){i(s)}),0)}else{if(s=e.createReturnObject(a.FAILED,{description:"Unknown item: "+n}),!i)throw s.getError();setTimeout((function(){i(s)}),0)}}getRadioItemState(e){if(!e||"string"!=typeof e)throw new Error("itemId has to be a non empty string");let t;const n=this._private._elements.length;for(let r=0;r<n;++r)this._private._elements[r].getId()===e&&(t=this._private._elements[r].getState());if(void 0===t)throw new Error("This item does not belong to this RadioHandler");return t}getSelectedItemId(){let e;return this._private._checkedElement&&(e=this._private._checkedElement.getId()),e}setHandlerComponent(e){if(void 0===e)throw new Error("component has to be define");return this._private._handlerComponent=e,!0}getHandlerComponent(){return this._private._handlerComponent}handleOnAvailabilityChanged(e){if(!e||!e.manageable||!e.args||void 0===e.args.newValue)throw new Error("handleExecute was called using wrong parameters",e);(function(e){for(var t=!1,n=!0,r=e._private._elements,i=r.length,o=0;o<i&&n;)n=r[o].isAvailable(),++o;return n!==e.isAvailable()&&(e._private._currentAvailability=n,t=!0),t})(this)&&t.publishHandlerAvailability(this)}handleIsExecutable(e){if(!e||!e.manageable)throw new Error("Wrong parameters");return this.isExecutable()}onItemStateEvent(e,t,n){if(!e)throw new Error("identifier has to be a non empty string");if(!t)throw new Error("itemIdentifier has to be a non empty string");const r=e.toUpperCase();if(!function(e){return Boolean(e)&&a.ItemStateEvents.hasOwnProperty(e)}(r))throw new Error("The given identifier is not supported by an RadioHandler",e);if(!n||"function"!=typeof n)throw new Error("cb has to be a function",n);const i=this.getHandlerComponent();if(!i)throw new Error("There is no HandlerComponent related to this RadioHandler",this);const o=i.getEventChannel();if(!o)throw new Error("Retrieved eventChannel is undefined");const s=this.getId();if(!s)throw new Error("handlerIdentfier has to be a non empty string.");return o.subscribe({event:s+"/"+t+"/"+r},n)}removeItemStateEventSubscription(e){if(void 0===e)throw new Error("token has to be defined");const t=this.getHandlerComponent();if(!t)throw new Error("There is no HandlerComponent related to this RadioHandler",this);const n=t.getEventChannel();if(!n)throw new Error("Retrieved eventChannel is undefined");if(!this.getId())throw new Error("handlerIdentifier has to be a non empty string.");return n.unsubscribe(e)}destroy(){super.destroy();const e=this._private._elements,t=this._private._elements.length;for(var n=0;n<t;++n)e[n].destroy()}},a})),define("DS/WAfrHandlers/mod_RadioHandlerZERO",["DS/WAfrHandlers/private/private_CheckHandlerUtilities","DS/WAfrHandlers/private/private_RadioHandlerUtilities","DS/WAfrHandlers/mod_RadioHandler"],(function(e,t,n){"use strict";const r=n.RadioHandler;let i=Object.create(null);return i.RadioHandlerZERO=class extends r{constructor(e){super(e)}isUnselectAuthorized(){return!0}handleExecute(n){if(!n||!n.manageable)throw new Error("Wrong parameters");{const r=n.manageable;if(!t.isManagedByRadioHandler(r,this))throw new Error("Internal error. The manageable calling handleExecute is not managed by this RadioHandler.");if(n.action)if(this._private._checkedElement){if(this._private._checkedElement!==n.manageable){let r=Object.create(null);r.cb=n.cb,r.manager=this,r.manageable=n.manageable,r.args=n.args,t.fireEvent(this,this._private._checkedElement.getId(),!1),e.executeCheckHandler(this._private._checkedElement,{cb:t.checkOnUncheck.bind(r),action:!1}),this._private._checkedElement=n.manageable}}else t.fireEvent(this,n.manageable.getId(),n.action),e.executeCheckHandler(n.manageable,{cb:n.cb,action:n.action,args:n.args}),this._private._checkedElement=n.manageable;else n.manageable.getState()!==n.action&&(t.fireEvent(this,n.manageable.getId(),n.action),e.executeCheckHandler(n.manageable,{cb:n.cb,action:n.action,args:n.args}),this._private._checkedElement=null)}}},i})),define("DS/WAfrHandlers/mod_RadioHandlerONE",["DS/CoreUtilities/ErrorManagement","DS/WAfrHandlers/private/private_CheckHandlerUtilities","DS/WAfrHandlers/private/private_RadioHandlerUtilities","DS/WAfrHandlers/mod_RadioHandler"],(function(e,t,n,r){"use strict";const i=r.RadioHandler;let o=Object.create(null);return o.RadioHandlerONE=class extends i{constructor(e){super(e)}isUnselectAuthorized(){return!1}handleExecute(r){if(!r||!r.manageable)throw new Error("Wrong parameters");{const i=r.manageable;if(!n.isManagedByRadioHandler(i,this))throw new Error("Internal error. The manageable calling handleExecute is not managed by this RadioHandler.");if(!r.action){const t=e.getErrorManager(),n=e.createReturnObject(t.FAILED,{description:"It is impossible to uncheck the checked element for RadioHandler of type ONE"});if(!r.cb||"function"!=typeof r.cb)throw n.getError();setTimeout((function(){r.cb(n)}),0)}if(this._private._checkedElement)if(r.manageable!==this._private._checkedElement){let e=Object.create(null);e.cb=r.cb,e.manageable=r.manageable,e.manager=this,e.args=r.args,n.fireEvent(this,this._private._checkedElement.getId(),!1),t.executeCheckHandler(this._private._checkedElement,{cb:n.checkOnUncheck.bind(e),action:!1}),this._private._checkedElement=r.manageable}else this.beingInitialized()&&(n.fireEvent(this,r.manageable.getId(),!0),t.executeCheckHandler(r.manageable,{cb:r.cb,action:!0,args:r.args}),this._private._checkedElement=r.manageable);else n.fireEvent(this,r.manageable.getId(),!0),t.executeCheckHandler(r.manageable,{cb:r.cb,action:!0,args:r.args}),this._private._checkedElement=r.manageable}}},o})),define("DS/WAfrHandlers/mod_HandlerInterpreter",["DS/WAfrHandlers/mod_ActionHandler","DS/WAfrHandlers/mod_CommandHandler","DS/WAfrHandlers/mod_CheckHandler","DS/WAfrHandlers/mod_RadioHandlerZERO","DS/WAfrHandlers/mod_RadioHandlerONE","DS/WAfrHandlers/mod_HandlerComponent","DS/WAfrAvailabilityModes/mod_AvailabilityModesComponent","DS/WAfrUtils/mod_PromiseUtils","DS/WAfrUtils/mod_ConcatenationUtils"],(function(e,t,n,r,i,o,a,s,d){"use strict";var c=e.ActionHandler,l=t.CommandHandler,p=n.CheckHandler,h=r.RadioHandlerZERO,u=i.RadioHandlerONE;const m=s.promisifiedRequire,_=d.getConfigurationFor,f={AC_NOT_FOUND:"AC_NOT_FOUND"};var g={};let v=!1;const C=localStorage.getItem("DEBUG_AFR_I18N");null!==C&&("string"==typeof C&&"true"===C||"boolean"==typeof C&&C)&&(console.warn("[DEBUG] DS/WAfrHandlers/mod_HandlerInterpreter: I18N Debug mode activated.","\n[DEBUG] DO NOT USE IN PRODUCTION.",'\n[DEBUG] Be sure to activate "Verbose" level in the DevTools to see all logs.'),v=!0);const E="font-weight:bold;",b="color:#368EC4;",w="color:#EA4F37;";function y(e,t,n){const r="internationalization",i=e[r],o=e.identifier;let a=Promise.resolve();return i&&i.path&&(v&&console.debug(`%c[mod_HandlerInterpreter~computeLeafHandlerI18n][I18N]%c 🏳️🔎 Compute I18n (runtime) for%c ${o}%c in%c ${t}%c filtered with the following array%c [${n?n.join(", "):"en"}]`,`${E} ${b}`,`${b}`,`${E} ${b}`,`${b}`,`${E} ${b}`,`${b}`,`${E} ${b}`),a=function(e,t,n){let r=Promise.resolve();if("string"==typeof e)if(void 0===n||n.includes(t))r=m("i18n!"+e);else{v&&console.debug(`%c[mod_HandlerInterpreter~getI18nFromPath][I18N]%c 🏳️🩹 Fallback I18n (runtime) for%c ${e}%c to %cen%c. Requested%c ${t}%c but filtered by%c [${n?n.join(", "):"en"}]`,`${E} ${b}`,`${b}`,`${E} ${b}`,`${b}`,`${E} ${b}`,`${b}`,`${E} ${b}`,`${b}`,`${E} ${b}`);const i="text!"+e+"_en.json";r=m(i).then((t=>{try{return JSON.parse(t)}catch(t){const n=new Error(`Internal Error. ${e} content is not a valid JSON.`);return v&&console.debug(`%c[mod_HandlerInterpreter~getI18nFromPath][I18N]%c 🏳️❌ Error computing I18n for%c ${i}%c. The content is not a valid JSON]`,`${E} ${w}`,`${w}`,`${E} ${w}`,`${w}`),Promise.reject(n)}}))}else r=Promise.reject(new Error("path is not a string"));return r}(i.path,t,n).then((e=>function(e,t){const n={};if(e){const r=t+".";let i=r+"Title";e.hasOwnProperty(i)&&(n.title=e[i]),i=r+"ShortHelp",e.hasOwnProperty(i)&&(n.shortHelp=e[i]),i=r+"ShortHelpImage",e.hasOwnProperty(i)&&(n.shortHelpImage=e[i]),i=r+"LongHelp",e.hasOwnProperty(i)&&(n.longHelp=e[i]),i=r+"LongHelpImage",e.hasOwnProperty(i)&&(n.longHelpImage=e[i]);for(const[t,i]of Object.entries(e))(t.startsWith(r+"WebHelp")||t.startsWith(r+"PanelHelp"))&&(n[t.replace(r,"")]=i)}return n}(e,o))).then((t=>{e[r]=t,v&&console.debug(`%c[mod_HandlerInterpreter~computeLeafHandlerI18n][I18N]%c 🏳️✔️ Retrieved I18n for%c ${o}%c.`,`${E} ${b}`,`${b}`,`${E} ${b}`,`${b}`,t)})).catch((e=>(console.error(e),v&&console.debug(`%c[mod_HandlerInterpreter~computeLeafHandlerI18n][I18N]%c 🏳️❌ Error computing I18n for%c ${o}%c.`,`${E} ${w}`,`${w}`,`${E} ${w}`,`${w}`,e),Promise.resolve())))),a}function A(e){return{id:e.identifier,i18n:e.internationalization,icon:e.icon,availabilityMode:e.availability,accelerator:e.accelerator}}function H(e){return{id:e.identifier,i18n:e.internationalization,icon:e.icon,availabilityMode:e.availability,accelerator:e.accelerator}}function I(n,r,i){var o,a=null;if(r.declerr&&Array.isArray(r.declerr))for(let e=0,t=r.declerr,n=t.length;e<n;++e){let n=t[e];if(n.id===f.AC_NOT_FOUND)throw new Error(`[HandlerInterpreter] ${n.args.itemName} was not found.`)}if("Action"===r.type)o=function(t,n){var r=n(t);return r.implementationType=t.code.type,void 0===r.implementationType||r.implementationType===e.ImplementationTypes.EXPORTED_FUNCTION?r.module=t.code.module:r.component=t.code.component,r.func=t.code.func,r.args=t.argument,r}(r,i),a=new c(o);else{if("Command"!==r.type)throw new Error("Unknown handler type",r.type);o=function(e,n,r){var i=r(n);i.module=n.code.module;var o=e.getComponent("AFR_CommandsManager");return i.cmdsManager=o,i.cmdMode=t.CmdMode[n.mode],i.repeatMode=t.RepeatMode[n.repeatability],i.args=n.argument,i.computeServer=n.computeServer,i.dynamicModeModule=n.code.dynamicModeMod,i.dynamicModeFunction=n.code.dynamicModeFun,i}(n,r,i),a=new l(o)}return o&&o.args&&a.setArgs(o.args),a}function x(e,t){let n=a.DEFAULT_COMPONENT_NAME;return t&&t[a.DEFAULT_COMPONENT_NAME]&&(n=t[a.DEFAULT_COMPONENT_NAME]),e.getComponent(n)}class M{constructor(){this._initializationValues=[],this._handler=[],this._chkHandler=[],this._radioHandler=[]}addInitializationValue(e){if(void 0===this._initializationValues)throw new Error("Cannot add a new initialization value. Verify interpreter lifecycle.");this._initializationValues.push(e)}createLeafHandler(e,t,n){return I(e,t,n)}createCheckHandler(e,t){return function(e,t){const n=new p({id:t.identifier});t.accelerator&&(t.check.accelerator=t.accelerator,t.uncheck.accelerator=t.accelerator);const r=I(e,t.check,H);n.addElement(r,{state:"check"});const i=I(e,t.uncheck,H);let o;if(n.addElement(i,{state:"uncheck"}),void 0!==t.defaultState&&"string"==typeof t.defaultState&&(t.defaultState="true"===t.defaultState),void 0!==t.defaultState&&t.defaultState){let e=!1;void 0!==t.isA2X&&(e=t.isA2X),e?console.error("The HandlerInterpreter used in not the one dedicated to A2X."):o={type:"CheckHandler",id:t.identifier,state:!0}}return{handler:n,check:r,uncheck:i,initializationValue:o}}(e,t)}createRadioHandler(e,t){return function(e,t){let n,r,i={id:t.identifier};if("ONE"===t.radioType)n=new u(i);else{if("ZERO"!==t.radioType)throw new Error("Unsupported radioType");n=new h(i)}let o,a,s,d,c=0,l=t.items,m=l.length;for(c=0;c<m;++c)a=l[c],o=new p({id:a.identifier}),a.accelerator&&(a.check.accelerator=a.accelerator,a.uncheck.accelerator=a.accelerator),a.check&&(s=I(e,a.check,H),o.addElement(s,{state:"check"})),a.uncheck&&(d=I(e,a.uncheck,H),o.addElement(d,{state:"uncheck"})),n.addElement(o);return t.default&&(r={type:"RadioHandler",id:t.default,radioId:t.identifier,state:!0}),{radioHandler:n,initializationValue:r}}(e,t)}interpretLeafHandler(e,t){if(!t)return;const n=t.length;let r,i;for(let o=0;o<n;++o)r=t[o],i=this.createLeafHandler(e,r,A),this._handler.push(i),this.addToAvailabilityModesSubscribers(i)}interpretCheckHandler(e,t){if(!t)return;const n=t.length;let r;for(let i=0;i<n;++i){r=t[i];const{handler:n,check:o,uncheck:a,initializationValue:s}=this.createCheckHandler(e,r);this.addToAvailabilityModesSubscribers(o),this.addToAvailabilityModesSubscribers(a),this._chkHandler.push(n),s&&this._initializationValues.push(s)}}interpretRadioHandler(e,t){if(!t)return;const n=t.items;if(!Array.isArray(n))return;if(0===n.length)return;const r=n.length;let i,o,a,s,d,c,l,p=0;for(p=0;p<r;++p){i=n[p];const{radioHandler:t,initializationValue:r}=this.createRadioHandler(e,i);for(o=t.getElements(),s=o.length,a=0;a<s;++a)d=o[a],c=d.getCheckHandler(),c&&this.addToAvailabilityModesSubscribers(c),l=d.getUncheckHandler(),l&&this.addToAvailabilityModesSubscribers(l);this._radioHandler.push(t),r&&this._initializationValues.push(r)}}computeRuntimeI18n(e,t){const n=e&&e.internationalization?e.internationalization:void 0;v&&console.debug(`%c[mod_HandlerInterpreter.interpret][I18N]%c🏳️ Environment current lang:%c ${t}`,`${E} ${b}`,`${b}`,`${E} ${b}`);const r=[];if(e&&e.handlers){if(e.handlers.default){const i=e.handlers.default;for(const e of i)if(e.hasOwnProperty("internationalization")){const i=e;r.push(y(i,t,n))}}if(e.handlers.check){const i=e.handlers.check;for(const e of i){const i=e.check;i&&r.push(y(i,t,n));const o=e.uncheck;o&&r.push(y(o,t,n))}}}if(e&&e.radioGroup&&e.radioGroup.items){const i=e.radioGroup.items;for(const e of i)if(e.items){const i=e.items;for(const e of i){if(e.check){const i=e.check;r.push(y(i,t,n))}if(e.uncheck){const i=e.uncheck;r.push(y(i,t,n))}}}}return Promise.all(r)}interpret(e,t,n){if(!e||!t)throw new Error("Missing parameters");var r=o.DEFAULT_COMPONENT_NAME;if(n&&n.componentId?r=n.componentId:console.warn("Caution! You are using the default component name. This is not recommended"),this._executionContext=t,this._handlerComponent=t.getComponent(r),!this._handlerComponent)throw new Error("HandlerComponent not found");let i=Promise.resolve();const a=_(e,"i18n");if(!a||a&&"runtime"===a){const t=window.widget?window.widget.lang:"en";i=this.computeRuntimeI18n(e,t)}return i.then((()=>{if(e){if(e.handlers){if(e.handlers&&e.handlers.default){var n=e.handlers.default;this.interpretLeafHandler(t,n)}if(e.handlers&&e.handlers.check){var r=e.handlers.check;this.interpretCheckHandler(t,r)}e.handlers.defaultCommand&&(this._defaultCommandIdentifier=e.handlers.defaultCommand)}if(e.radioGroup){var i=e.radioGroup;this.interpretRadioHandler(t,i)}}})),i}commitHandlers(){let e=this._handler.length,t=0,n=null;for(t=0;t<e;++t)n=this._handler[t],this._handlerComponent.addHandler(n);for(this._handler.splice(0,e),delete this._handler,e=this._chkHandler.length,t=0;t<e;++t)n=this._chkHandler[t],this._handlerComponent.addCheckHandler(n);for(this._chkHandler.splice(0,e),delete this._chkHandler,e=this._radioHandler.length,t=0;t<e;++t)n=this._radioHandler[t],this._handlerComponent.addRadioHandler(n);this._radioHandler.splice(0,e),delete this._radioHandler}commit(e){this.commitHandlers(),this._handlerComponent.setInitializationData(this._initializationValues),this._defaultCommandIdentifier&&this._handlerComponent.setInitializationDefaultCommand(this._defaultCommandIdentifier);let t=Promise.resolve();const n=x(this._executionContext,e);return n&&(this._handlerComponent.setAvailabilityModesComponent(n),this._availabilityModesSubscribers&&this._availabilityModesSubscribers.length>0&&(t=this.commitAvailabilityModesSubscribers())),t.then((()=>{delete this._handlerComponent,delete this._executionContext,delete this._initializationValues,delete this._availabilityModesSubscribers}))}commitEnrich(e){this.commitHandlers(),this._handlerComponent.addInitializationData(this._initializationValues);let t=Promise.resolve();return x(this._executionContext,e)&&(t=this.commitAvailabilityModesSubscribers()),t.then((()=>{delete this._handlerComponent,delete this._executionContext,delete this._initializationValues,delete this._availabilityModesSubscribers}))}enrich(e,t,n){if(void 0!==this._handler||void 0!==this._chkHandler||void 0!==this._radioHandler||void 0!==this._executionContext||void 0!==this._handlerComponent||void 0!==this._initializationValues||void 0!==this._availabilityModesSubscribers)throw new Error('Enrich was called whereas internal variables are still defined. Possible cause: enrich was called before an "interpret"-"commit" sequence.');return this._enrich(e,t,n)}_enrich(e,t,n){if(!e||!t)throw new Error("Missing parameters");return this._handler=[],this._chkHandler=[],this._radioHandler=[],this._initializationValues=[],this.interpret(e,t).then(this.commitEnrich.bind(this,n)).then((()=>{delete this._handler,delete this._chkHandler,delete this._radioHandler,delete this._handlerComponent,delete this._executionContext,delete this._initializationValues,delete this._availabilityModesSubscribers}))}addToAvailabilityModesSubscribers(e){if(!e||!this._executionContext)throw new Error("element and this._executionContext has to be defined");this._availabilityModesSubscribers||(this._availabilityModesSubscribers=[]),this._availabilityModesSubscribers.push(e)}commitAvailabilityModesSubscribers(){let e=[],t=0,n=0,r=null;if(this._availabilityModesSubscribers)for(n=this._availabilityModesSubscribers.length,t=0;t<n;++t)r=this._availabilityModesSubscribers[t],e.push(r.initAvailabilityModesSubscription());return Promise.all(e)}}function S(e){let t=M;return void 0!==g[e]&&(t=g[e]),new t}var D=Object.create(null);return D.generateInterpreter=function(e,t){let n;return n=void 0!==t?new Promise(((n,r)=>{if(!t.a2x)return n(S(e));require(["DS/WAfrControlledHandlers/mod_ControlledHandlerInterpreter"],(e=>{const t=e.ControlledHandlerInterpreter;return t?n(new t):r("Impossible to find the Handler interpreter constructor.")}),r)})):Promise.resolve(S(e)),n},D.DefaultHandlerInterpreter=M,D}));