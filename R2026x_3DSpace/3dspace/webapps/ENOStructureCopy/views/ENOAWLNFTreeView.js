require.config({paths:{jquery:"../VENCDjquery/latest/dist/jquery.min"}}),define("DS/ENOStructureCopy/views/ENOAWLNFTreeView",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Button","DS/UIKIT/Input/Toggle","DS/UIKIT/SuperModal","DS/UIKIT/Alert","DS/UIKIT/Form","DS/UIKIT/Input/Password","DS/Controls/ComboBox","DS/Tree/TreeListView","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/UIKIT/Mask","DS/ENOStructureCopy/views/ENOAWLAutocomplete","DS/ENOStructureCopy/utils/ENOAWLNFUtil","DS/ENOStructureCopy/utils/ENOAWLNFConstants","jquery","i18n!DS/ENOStructureCopy/assets/nls/ENOStructureCopyNLS","css!DS/ENOStructureCopy/rte/emxUIDefault","css!DS/ENOStructureCopy/ENOStructureCopy"],(function(e,t,o,i,s,n,a,l,r,c,u,h,d,m,g,p,w,v){"use strict";var b=w;return t.extend({hasCreateAccess:null,viewcontrols:{ui:{},button:{},tooltip:{}},rootLocalConfig:null,languageList:null,nutritionDataContainer:null,toolbarContainer:null,baselanguage:null,baselanguageIndex:null,nutritionLabelConfiguration:null,frameName:null,setup:function(){this.frameName=this.options.frameName,this.elements.mContainer=new e.Element("div",{class:"awl-nutritionfacts-view"}),this.container=this.elements.mContainer,this.infoContainer=new e.Element("h3",{class:"awl-nutrition-info",html:v.StructureHeading}).inject(this.container),this.toolbarContainer=new e.Element("div").inject(this.container),this.alertContainer=new e.Element("div",{class:"awl-nutrition-alert"}).inject(this.container),this.nutritionDataContainer=new e.Element("div",{class:"awl-nutrition-data"}).inject(this.container),this.nutritionconfig=this.options.nutritionconfig,this.languagemodel=this.options.languagemodel,this.listenTo(this.model,"onSync",this.render.bind(this)),this.listenTo(this,p.EVENT_MASTER_CREATE_SUCESS,this.onNutritionCreateSucess.bind(this)),this.listenTo(this,p.EVENT_MASTER_CREATE_FAILURE,this.onNutritionCreateFailure.bind(this)),this.listenTo(this,p.EVENT_MASTER_DELETE_SUCESS,this.onNutritionDeleteSucess.bind(this)),this.listenTo(this,p.EVENT_MASTER_DELETE_FAILURE,this.onNutritionDeleteFailure.bind(this)),this.listenTo(this,p.EVENT_ELEMENT_UPDATE_SUCESS,this.onUpdateSucess.bind(this)),this.listenTo(this,p.EVENT_ELEMENT_UPDATE_FAILURE,this.onUpdateFailure.bind(this)),this.listenTo(this,p.EVENT_TASK_PROMOTE_DEMOTE_SUCESS,this.taskPromoteDemoteSucess.bind(this)),this.listenTo(this,p.EVENT_TASK_PROMOTE_DEMOTE_FAILURE,this.taskPromoteDemoteFailure.bind(this)),d.mask(this.container)},render:function(){d.unmask(this.container);var e=this;this.rootLocalConfig=this.languagemodel.get("configuration"),this.languageList=Object.keys(this.rootLocalConfig).sort(),this.hasCreateAccess=this.languagemodel.get("hasCreateAccess"),this.hasEditAccess=this.languagemodel.get("hasEditAccess"),this.createToolbarActions().inject(this.toolbarContainer),this.toolbarContainer.addClassName("awl-nutrition-toolbar"),this.container.alert=new n({hideDelay:2e3,autoHide:!0}).inject(this.alertContainer),this.viewcontrols.mTreeDocument=new u({}),this.createStructureView().inject(this.nutritionDataContainer),this.nutritionLabelConfiguration=this.createAutocomplete(),this.model.forEach((function(t){e.viewcontrols.mTreeDocument.addChild(e.getTreeNodeModel(t))})),this.viewcontrols.manager.loadDocument(this.viewcontrols.mTreeDocument)},createToolbarActions:function(){this.toolbarContaineractions=new e.Element("div",{class:"awl-nutrition-toolbaractions"}),this.viewcontrols.button.addElementButton=new o({className:"info awl-add-element",disabled:!(this.hasCreateAccess&&this.hasEditAccess),attributes:{title:v.AddElement},events:{onClick:this.dispatchAsEventListener("createNutritionElementView")}}).inject(this.toolbarContaineractions),this.viewcontrols.button.deleteButton=new o({className:"info awl-delete-element",disabled:!(this.hasCreateAccess&&this.hasEditAccess),attributes:{title:v.DeleteElement},events:{onClick:this.dispatchAsEventListener("preDeleteValidate")}}).inject(this.toolbarContaineractions);for(var t=0;t<this.languageList.length;t++){var i=this.languageList[t];if(this.rootLocalConfig[i].isbasecopy){this.baselanguageIndex=t,this.baselanguage=i;break}}var s=this.rootLocalConfig[this.baselanguage],n=s.taskid,l=s.taskAction,r=s.copyid,c=s.isbasecopy,u=!0,h=!0;null!=n&&(u=!1,h="Comment"==l),this.viewcontrols.button.promoteTaskButton=new o({className:"info awl-task-promote",disabled:u,attributes:{title:v.Promote},taskid:n,taskaction:l,rootcopyid:r,isbasecopy:c,isFDAEnabled:this.languagemodel.get("isFDAEnabled"),events:{onClick:this.dispatchAsEventListener("taskPromoteDemoteAction",!0)}}).inject(this.toolbarContaineractions),this.viewcontrols.button.demoteTaskButton=new o({className:"info awl-task-demote",disabled:h,attributes:{title:v.Demote},taskid:n,taskaction:"Reject",rootcopyid:r,isbasecopy:c,isFDAEnabled:this.languagemodel.get("isFDAEnabled"),events:{onClick:this.dispatchAsEventListener("taskPromoteDemoteAction",!1)}}).inject(this.toolbarContaineractions),this.addLanguageBox(),this.viewcontrols.tooltip.addElementTooltip=g.addTooltip({position:"left",target:this.viewcontrols.button.addElementButton}),this.viewcontrols.tooltip.deleteElementTooltip=g.addTooltip({position:"left",target:this.viewcontrols.button.deleteButton}),this.viewcontrols.tooltip.promoteTaskTooltip=g.addTooltip({position:"left",target:this.viewcontrols.button.promoteTaskButton}),this.viewcontrols.tooltip.demoteTaskTooltip=g.addTooltip({position:"left",target:this.viewcontrols.button.demoteTaskButton});var d=new e.Element("span",{class:"awl-nutrition-toolbarFiler"}).inject(this.toolbarContaineractions);return this.viewcontrols.button.filter=new a({fields:[{type:"html",html:[{tag:"span",class:"awl-nutrition-filterinput",html:new e.Element("input",{class:"awl-nutrition-filterinput",name:"filter",placeholder:v.FilterElements,events:{keyup:this.dispatchAsEventListener("onFilterElement")}})}]}]}).inject(d),this.toolbarContaineractions},destroyLanguageBox:function(){try{this.viewcontrols.button.languageBox.destroy()}catch(e){}},addLanguageBox:function(){this.baselanguageIndex=this.languageList.indexOf(this.baselanguage),this.viewcontrols.button.languageBox=new r({elementsList:this.languageList.sort(),enableSearchFlag:!1,actionOnClickFlag:!1,selectedIndex:this.baselanguageIndex,touchMode:!0}).inject(this.toolbarContaineractions),this.viewcontrols.button.languageBox.previousValue=this.viewcontrols.button.languageBox.currentValue;var e=this.viewcontrols.button.languageBox.getContent();e.addClassName("language-combobox"),e.addEventListener("change",this.showLocalCopyTextColumn.bind(this));var t=v.LanguageFilter+" - "+this.viewcontrols.button.languageBox.currentValue;this.viewcontrols.tooltip.languageBoxTooltip=g.addTooltip({position:"left",target:this.viewcontrols.button.languageBox,tooltipMsg:t})},createStructureView:function(){var e=this.structureViewColumnDef();return this.treeView=new c(e),this.viewcontrols.manager=this.treeView.getManager(),this.viewcontrols.treeView=this.treeView,this.treeView},structureViewColumnDef:function(){var e=this,t=(this.hasCreateAccess,{allowUnsafeHTMLContent:!1,defaultCellHeight:33,columns:[{text:v.NutritionLabel,dataIndex:"tree",width:"35%"},{text:v.DisplayName,dataIndex:"displayname",isEditable:!1,width:"auto",onCellRequest:function(e){e.isHeader||e.cellView.getContent().setContent(e.nodeModel.options.grid.displayname)}},{text:this.hasCreateAccess?v.CopyText:v.MasterCopyText,dataIndex:"copytext",width:"auto",isSortable:!1,onCellRequest:function(t){if(!t.isHeader){var o=t.nodeModel.options.grid.baselanguage,i=e.rootLocalConfig[o],s={className:i.hasEditAccess?"rte-column rte-edit-column":"rte-column",isLocal:!1,mode:i.hasEditAccess?"edit":"view",mTreeNodeModel:t.nodeModel};t.cellView.getContent().setHTML(e.createCopyTextContainer(s))}}},{text:this.hasCreateAccess?v.State:v.MasterState,dataIndex:"masterstate",isEditable:!1,width:"auto",onCellRequest:function(e){e.isHeader||e.cellView.getContent().setContent(e.nodeModel.options.grid.basestate)}}]});return t.columns.push({text:v.MasterCopyText,dataIndex:e.baselanguage+"-copytext",isEditable:!1,width:"auto",isHidden:!0,isSortable:!1,onCellRequest:function(t){if(!t.isHeader&&t.nodeModel.options.grid[e.baselanguage]){var o={className:"rte-column",isLocal:!0,mode:"view",language:e.baselanguage,mTreeNodeModel:t.nodeModel};t.cellView.getContent().setHTML(e.createCopyTextContainer(o))}}}),t.columns.push({text:v.MasterState,dataIndex:e.baselanguage+"-state",isEditable:!1,width:"auto",isHidden:!0,isSortable:!1,onCellRequest:function(t){if(!t.isHeader){var o=t.nodeModel.options.grid[e.baselanguage];o&&t.cellView.getContent().setContent(o.copystate)}}}),this.addDynamicColumns(this.languageList,t),t.iconsSize=22,t.selection={nodes:!1,cells:!1,toggle:!0},t.columns.splice(0,0,{text:"",dataIndex:"selection",type:"selection",width:40}),t.resize={columns:!0,rows:!0},t.height="auto",t.enableDragAndDrop=!1,t.isEditable=!1,t.apiVersion=2,t},addDynamicColumns:function(e,t){var o=this;e.forEach((function(e){var i=o.rootLocalConfig[e];i.isbasecopy||(t.columns.push({text:i.isbasecopy?v.MasterCopyText:e+" - "+v.CopyText,dataIndex:e+"-copytext",isEditable:!1,width:"auto",isHidden:!0,isSortable:!1,onCellRequest:function(t){if(!t.isHeader&&t.nodeModel.options.grid[e]){var s={className:i.isbasecopy?"rte-column":i.hasEditAccess?"rte-column rte-edit-column":"rte-column",isLocal:!0,mode:i.isbasecopy?"view":i.hasEditAccess?"edit":"view",language:e,mTreeNodeModel:t.nodeModel};t.cellView.getContent().setHTML(o.createCopyTextContainer(s))}}}),t.columns.push({text:i.isbasecopy?v.MasterState:e+" - "+v.State,dataIndex:e+"-state",isEditable:!1,width:"auto",isHidden:!0,isSortable:!1,onCellRequest:function(t){if(!t.isHeader){var o=t.nodeModel.options.grid[e];o&&t.cellView.getContent().setContent(o.copystate)}}}))}))},createCopyTextContainer:function(t){var o=this.getRTEContent(t),i=e.createElement("div",{class:"rte-text-div",html:o}),s=e.createElement("div",{class:t.className,events:{click:this.dispatchAsEventListener("openRTE",t)}});return i.inject(s),s},getRTEContent:function(e){var t=e.mTreeNodeModel.options.grid.copytextrte;return e.isLocal&&(t=e.mTreeNodeModel.options.grid[e.language].copytextrte),t},getTreeNodeModel:function(e){var t={structureid:e.get("structureid"),masterid:e.get("masterid"),displayname:e.get("displayname"),translate:e.get("translate"),inline:e.get("inline"),copytext:e.get("copytext"),copytextrte:e.get("copytextrte"),objectid:e.get("copyid"),basestate:e.get("basestate"),baselanguage:e.get("baselang")},o=e.get("localcopies"),i=null;o&&o.forEach((function(e){t[e.locallang]=e,i=i?i+","+e.localid:e.localid}));var s=this.nutritionLabelConfiguration.getItemByAttributeRange(e.get("label")),n="object"==typeof s?s.label:e.get("label"),a={label:decodeURIComponent(n),icons:[p.RANGE_NO==e.get("translate")?p.NOTRANSLATE_IMAGE:p.RANGE_YES==e.get("inline")?p.INLINE_IMAGE:""],grid:t,localcopyids:i};return new h(a)},disableRTE:function(){b(".rte").get(0).disableRTE()},createRTE:function(){b(".rte").rte({controls_rte:rte_toolbar,controls_html:html_toolbar,resizer:!1,NLS:v})},createAutocomplete:function(){var e=new m({showSuggestsOnFocus:!0,multiSelect:!0,placeholder:v.SelectNutrition,allowFreeInput:!0,typeDelay:0,minLength:1}),t=[],o=[];return this.nutritionconfig.forEach((function(e){e.get("displayname");var i=e.get("config");null!=i?t.push({name:e.get("displayname"),attributerange:e.get("attributerange"),displayName:!0,items:i}):o.push({value:e.get("value"),type:e.get("type"),attributerange:""})})),o.length>0&&e.addDataset({items:o}),t.length>0&&t.forEach((function(t){e.addDataset(t)})),this.viewcontrols.ui.nutritionLabelSelection=e,this.viewcontrols.ui.nutritionLabelSelection},enableInlineSelection:function(e,t){t?(this.viewcontrols.ui.inlineNO.enable().check(),this.viewcontrols.ui.inlineYES.enable()):(this.viewcontrols.ui.inlineNO.check(),this.viewcontrols.ui.inlineNO.disable(),this.viewcontrols.ui.inlineYES.disable())},createNutritionElementView:function(){this.viewcontrols.button.addElementButton.blur(),this.viewcontrols.ui.translateYES=new i({name:"translate",value:"Yes",className:"primary",label:v.Yes,events:{onChange:this.dispatchAsEventListener("enableInlineSelection",!0)}}),this.viewcontrols.ui.translateNO=new i({name:"translate",value:"No",className:"primary",label:v.No,events:{onChange:this.dispatchAsEventListener("enableInlineSelection",!1)}}),this.viewcontrols.ui.inlineYES=new i({name:"inline",value:"Yes",className:"primary",label:v.Yes}),this.viewcontrols.ui.inlineNO=new i({name:"inline",value:"No",className:"primary",label:v.No}),this.viewcontrols.supermodal=new s({closable:!0,renderTo:this.container});var t=this;this.viewcontrols.ui.form=new a({fields:[{type:"html",class:"form-group",html:[{class:"awlnutri-alignment",html:"<label>"+v.NutritionLabel+"<span class='label-field-required'> *</span></label>"},{tag:"div",class:"awlnutri-alinerow",html:t.createAutocomplete()}]},{type:"text",label:v.DisplayName,name:"displayname",placeholder:v.DisplayNamePlaceholder,required:!0},{type:"html",class:"form-group",html:[{class:"awlnutri-alignment",html:"<label>"+v.Translate+"</label>"},{tag:"div",class:"awlnutri-radio-alignment",html:[t.viewcontrols.ui.translateYES.check(),t.viewcontrols.ui.translateNO]}]},{type:"html",class:"form-group",html:[{class:"awlnutri-alignment",html:"<label>"+v.InlineTranslate+"</label>"},{tag:"div",class:"awlnutri-radio-alignment",html:[t.viewcontrols.ui.inlineYES,t.viewcontrols.ui.inlineNO.check()]}]},{type:"text",label:v.CopyText,name:"copytext",multiline:!0,className:"rte"},{type:"html",class:"form-group",html:"<br>"}]});var o=new e.Element("div");this.container.contentAlert=new n({hideDelay:2e3,autoHide:!0}).inject(o),this.viewcontrols.ui.form.inject(o),this.viewcontrols.supermodal.dialog({body:o,title:v.AddDialogTitle,buttons:[{className:"primary",value:v.Apply,action:this.dispatchAsEventListener("createNutritionElementValidation",!1)},{value:v.OK,action:this.dispatchAsEventListener("createNutritionElementValidation",!0)},{value:v.Cancel,action:function(e){e.hide()}}]}),this.createRTE()},createNutritionElementValidation:function(e,t){this.viewcontrols.supermodel=e,this.viewcontrols.isSubmit=t;var o=this.viewcontrols.ui.nutritionLabelSelection.getSelectedValue("type"),i=this.viewcontrols.ui.nutritionLabelSelection.getSelectedValue("attributerange")||"",s=this.viewcontrols.ui.nutritionLabelSelection.getSelectedValue("label"),n=this.viewcontrols.ui.form.getValue("displayname").trim();if(null!==o&&""!=n){var a=!1;if(this.viewcontrols.mTreeDocument.search({match:function(e){e.nodeModel.options.label===s&&(a=!0)}}),a)this.showContentAlert({className:"error",message:s+" - "+v.ExistInStructure});else{var l={type:o,attributerange:i,label:encodeURIComponent(s),inline:this.viewcontrols.ui.form.getValue("inline"),translate:this.viewcontrols.ui.form.getValue("translate"),copytext:this.viewcontrols.ui.form.getValue("copytext"),displayname:n};this.enableOrDisableButtons(!0),this.dispatchEvent(p.EVENT_MASTER_CREATE,l)}}else this.showContentAlert({className:"error",message:v.RequiredFiledError})},onNutritionCreateSucess:function(e){if(p.RANGE_YES==e.get("inline")){var t=e.get("structurecopylanguage"),o=[],i=this;t.forEach((function(e){-1==i.languageList.indexOf(e)&&(i.viewcontrols.manager.getColumnOptions(e+"-copytext")||(o.push(e),i.rootLocalConfig[e]={canPromote:!1,copyid:null,hasEditAccess:!0,isbasecopy:!1,taskAction:null,taskid:null}),i.languageList.push(e))})),this.addDynamicColumns(o,this.viewcontrols.manager.options);var s=this.viewcontrols.button.languageBox.currentValue;this.destroyLanguageBox(),this.addLanguageBox(),this.viewcontrols.button.languageBox.selectedIndex=this.languageList.indexOf(s)}this.viewcontrols.isSubmit&&this.viewcontrols.supermodel.hide();var n=this.getTreeNodeModel(e);(p.RANGE_NO==e.get("translate")&&this.baselanguage!=this.viewcontrols.button.languageBox.currentValue&&n.hide(),this.viewcontrols.mTreeDocument.addChild(n),this.viewcontrols.isSubmit)?this.showAlertMessage({className:"primary",message:v.ElementCreateSucess}):(this.viewcontrols.ui.nutritionLabelSelection.clear(),this.viewcontrols.ui.form.setValue("displayname",""),this.viewcontrols.ui.translateYES.check(),this.enableInlineSelection("dummy",!0),b(".rte").get(0).updateRTE(""),this.showContentAlert({className:"primary",message:v.ElementCreateSucess}),this.enableOrDisableButtons(!1))},onNutritionCreateFailure:function(){this.showContentAlert({className:"error",message:v.ElementCreateFailure})},openRTE:function(e,t){this.supermodal=new s({closable:!0,renderTo:this.container});var o=this.getRTEContent(t)||"",i=t.mTreeNodeModel.options.label;this.form=new a({fields:[{type:"text",label:v.CopyText,name:"copytext",multiline:!0,className:"rte",value:o},{type:"html",class:"form-group",html:"<br>"}]});var n=t.mode==p.MODE_VIEW?v.Close:v.OK,l=[{className:"primary",value:n,action:this.dispatchAsEventListener("updateCopyText",t)},{value:v.Cancel,action:function(e){e.hide()}}];t.mode==p.MODE_VIEW&&(l=[{className:"primary",value:n,action:this.dispatchAsEventListener("updateCopyText",t)}]),this.supermodal.dialog({body:this.form,title:i,buttons:l}),this.createRTE(),t.mode==p.MODE_VIEW&&this.disableRTE()},updateCopyText:function(e,t){this.viewcontrols.supermodel=e,this.viewcontrols.ui.configuration=t;var o=this.form.getValue("copytext").trim();if(o!=(this.getRTEContent(t)||"")){var i=t.mTreeNodeModel.options.grid.objectid;t.isLocal&&(i=t.mTreeNodeModel.options.grid[t.language].localid);var s={objectid:i,copytextrte:o};this.dispatchEvent(p.EVENT_ELEMENT_UPDATE,s)}else e.hide()},onUpdateSucess:function(e){var t=this.viewcontrols.ui.configuration,o=t.mTreeNodeModel,i=e.copytextrte;o.prepareUpdate();var s=t.mTreeNodeModel.options.grid;t.isLocal?(s[t.language].copytextrte=i,o.updateOptions({grid:s})):(s.copytextrte=i,s[s.baselanguage].copytextrte=i,o.updateOptions({grid:s}));o.pushUpdate(),this.viewcontrols.supermodel.hide(),this.showAlertMessage({className:"primary",message:v.ElementUpdateSucess}),this.viewcontrols.manager.updateView()},onUpdateFailure:function(e){this.viewcontrols.supermodel.hide(),this.showAlertMessage({className:"error",message:v.ElementUpdateFailure})},preDeleteValidate:function(){if(this.viewcontrols.button.deleteButton.blur(),0!=this.viewcontrols.mTreeDocument.getSelectedNodes().length){this.supermodal=new s({closable:!0,renderTo:this.container});this.supermodal.dialog({body:v.RemoveDialogBodyMsg,title:v.RemoveDialogTitle,buttons:[{className:"primary",value:v.Ok,action:this.dispatchAsEventListener("proceedDeletion")},{value:v.Cancel,action:function(e){e.hide()}}]})}else this.showAlertMessage({className:"error",message:v.SelectElement})},proceedDeletion:function(e){e.hide();var t={};this.viewcontrols.mTreeDocument.getSelectedNodes().forEach((function(e){t.masterids?(t.masterids=t.masterids+","+e.options.grid.masterid,t.localcopyids=t.localcopyids+","+e.options.localcopyids):(t.masterids=e.options.grid.masterid,t.localcopyids=e.options.localcopyids)})),d.mask(this.container),this.dispatchEvent(p.EVENT_MASTER_DELETE,t)},onNutritionDeleteSucess:function(e){if(d.unmask(this.container),this.viewcontrols.mTreeDocument.getSelectedNodes().forEach((function(e){e.prepareUpdate(),e.remove(),e.pushUpdate()})),e.get("hasInline")){var t=[],o=this,i=e.get("structurecopylanguage");this.languageList.forEach((function(e){-1==i.indexOf(e)&&t.push(e)}));var s=this.viewcontrols.button.languageBox.currentValue;this.viewcontrols.button.languageBox.selectedIndex=this.languageList.indexOf(this.baselanguage),t.forEach((function(e){o.languageList.remove(e)})),this.destroyLanguageBox(),this.addLanguageBox(),this.languageList.indexOf(s)>-1?this.viewcontrols.button.languageBox.selectedIndex=this.languageList.indexOf(s):this.viewcontrols.button.languageBox.selectedIndex=this.languageList.indexOf(this.baselanguage)}this.showAlertMessage({className:"primary",message:v.ElementDeleteSucess})},onNutritionDeleteFailure:function(){this.showAlertMessage({className:"error",message:v.ElementDeleteFailure})},showLocalCopyTextColumn:function(){var e=this.viewcontrols.button.languageBox.currentValue,t=this.viewcontrols.button.languageBox.previousValue;this.viewcontrols.tooltip.languageBoxTooltip.setBody(v.LanguageFilter+" - "+e);var o=this.rootLocalConfig[e],i=o.taskid,s=(o.hasEditAccess,o.taskAction),n=o.copyid,a=o.isbasecopy,l=!0,r=!0;null!=i&&(l=!1,r="Comment"==s),this.viewcontrols.button.promoteTaskButton.setDisabled(l),this.viewcontrols.button.promoteTaskButton.setOption("taskid",i),this.viewcontrols.button.promoteTaskButton.setOption("taskaction",s),this.viewcontrols.button.promoteTaskButton.setOption("rootcopyid",n),this.viewcontrols.button.promoteTaskButton.setOption("isbasecopy",a),this.viewcontrols.button.demoteTaskButton.setDisabled(r),this.viewcontrols.button.demoteTaskButton.setOption("taskid",i),this.viewcontrols.button.demoteTaskButton.setOption("taskaction","Reject"),this.viewcontrols.button.demoteTaskButton.setOption("rootcopyid",n),this.viewcontrols.button.demoteTaskButton.setOption("isbasecopy",a),this.viewcontrols.mTreeDocument.search({match:function(t){t.nodeModel.options.grid[e]||"No"===t.nodeModel.options.grid.translate&&-1==e.indexOf(",")?t.nodeModel.show():t.nodeModel.hide()}}),a?(this.viewcontrols.manager.hideColumn(this.baselanguage+"-copytext"),this.viewcontrols.manager.hideColumn(this.baselanguage+"-state"),this.viewcontrols.manager.hideColumn(t+"-copytext"),this.viewcontrols.manager.hideColumn(t+"-state"),this.viewcontrols.manager.showColumn("copytext"),this.viewcontrols.manager.showColumn("masterstate")):(this.viewcontrols.manager.isColumnHidden("copytext")||(this.viewcontrols.manager.hideColumn("copytext"),this.viewcontrols.manager.hideColumn("masterstate")),this.viewcontrols.manager.isColumnHidden(t+"-copytext")||(this.viewcontrols.manager.hideColumn(t+"-copytext"),this.viewcontrols.manager.hideColumn(t+"-state")),this.viewcontrols.manager.isColumnHidden(this.baselanguage+"-copytext")&&(this.viewcontrols.manager.showColumn(this.baselanguage+"-copytext"),this.viewcontrols.manager.showColumn(this.baselanguage+"-state")),this.viewcontrols.manager.showColumn(e+"-copytext"),this.viewcontrols.manager.showColumn(e+"-state")),this.viewcontrols.button.languageBox.previousValue=e},taskPromoteDemoteAction:function(t,o){if(o?this.viewcontrols.button.promoteTaskButton.blur():this.viewcontrols.button.demoteTaskButton.blur(),this.viewcontrols.isPromote=o,o)for(var i=this.viewcontrols.mTreeDocument.getChildren(),r=this.viewcontrols.button.languageBox.currentValue,c=0;c<i.length;c++){var u=i[c].options.grid[r];if(u&&null==u.copytextrte)return void this.showAlertMessage({className:"error",message:v.CopyTextFieldNotEmpty})}var h=(new Date).getTimezoneOffset()/60,m=this.viewcontrols.button.promoteTaskButton.getOption("taskid"),g=this.viewcontrols.button.demoteTaskButton.getOption("taskaction"),w=this.viewcontrols.button.demoteTaskButton.getOption("rootcopyid");o&&(g=this.viewcontrols.button.promoteTaskButton.getOption("taskaction"));var b={taskid:m,timezone:h,taskaction:g,rootcopyid:w};if("true"!==this.viewcontrols.button.promoteTaskButton.getOption("isFDAEnabled")||"Approve"!==g&&"Reject"!==g)b.isFDAEnabled=!1,this.dispatchEvent(p.EVENT_TASK_PROMOTE_DEMOTE,b),d.mask(this.container);else{this.viewcontrols.supermodal=new s({closable:!0,renderTo:this.container}),this.viewcontrols.ui.password=new l({placeholder:v.PasswordPlaceholder});this.viewcontrols.ui.form=new a({fields:[{type:"text",label:v.Username,name:"username",placeholder:v.UsernamePlaceholder},{type:"html",class:"form-group",html:[{class:"awlnutri-alignment",html:"<label>"+v.Password+"</label>"},{tag:"div",class:"awlnutri-alinerow",html:this.viewcontrols.ui.password}]}]});var E=new e.Element("div");this.container.contentAlert=new n({hideDelay:2e3,autoHide:!0}).inject(E),this.viewcontrols.ui.form.inject(E),this.viewcontrols.supermodal.dialog({body:E,title:v.UserVerification,buttons:[{className:"primary",value:v.Done,action:this.dispatchAsEventListener("taskFDAPromoteDemoteActionProcess",b)},{value:v.Cancel,action:function(e){e.hide()}}]})}},taskFDAPromoteDemoteActionProcess:function(e,t){this.viewcontrols.supermodel=e,this.viewcontrols.isFDAApproveOrReject=!0,t.username=this.viewcontrols.ui.form.getValue("username"),t.password=this.viewcontrols.ui.password.getValue("password")||"",t.isFDAEnabled=!0,this.enableOrDisableButtons(!0),this.dispatchEvent(p.EVENT_TASK_PROMOTE_DEMOTE,t)},taskPromoteDemoteSucess:function(e){var t=v.TaskDemoteSucess;this.viewcontrols.isFDAApproveOrReject&&this.viewcontrols.supermodel.hide();var o=this.viewcontrols.button.languageBox.currentValue,i=this.rootLocalConfig[o];i.hasEditAccess=!1,i.taskid=null,this.viewcontrols.button.promoteTaskButton.setDisabled(!0),this.viewcontrols.button.demoteTaskButton.setDisabled(!0),this.viewcontrols.mTreeDocument.withTransactionUpdate(this.updateElementInfomation(e)),this.showLocalCopyTextColumn(),this.viewcontrols.isPromote&&(t=v.TaskPromoteSucess),this.refreshParentFrame(),d.unmask(this.container),this.showAlertMessage({className:"primary",message:t})},updateElementInfomation:function(e){for(var t=this.viewcontrols.button.languageBox.currentValue,o=this.viewcontrols.button.promoteTaskButton.getOption("isbasecopy"),i=this.viewcontrols.mTreeDocument.getChildren(),s=0;s<i.length;s++){var n=i[s],a=n.options.grid[t];o&&(n.options.grid.basestate=e.state,n.options.grid.copytextrte=a.copytextrte),a&&(a.copystate=e.state)}},taskPromoteDemoteFailure:function(e){var t=this.viewcontrols.isPromote?v.TaskPromoteFailure:v.TaskDemoteFailure;if(this.viewcontrols.isFDAApproveOrReject){if("Authentication failed"!==e.message)return this.viewcontrols.supermodel.hide(),void this.showAlertMessage({className:"error",message:t});this.showContentAlert({className:"error",message:v.InvalidAuthorization}),this.viewcontrols.ui.form.setValue("username",""),this.viewcontrols.ui.password.setValue(""),this.enableOrDisableButtons(!1)}else d.unmask(this.container),this.showAlertMessage({className:"error",message:t})},onFilterElement:function(e){var t=this.viewcontrols.button.filter.getValue("filter"),o=this.viewcontrols.button.languageBox.currentValue;this.viewcontrols.mTreeDocument.search({match:function(e){(e.nodeModel.options.grid[o]||"No"===e.nodeModel.options.grid.translate&&-1==o.indexOf(","))&&-1!=e.nodeModel.options.label.toLowerCase().indexOf(t.toLowerCase())?e.nodeModel.show():e.nodeModel.hide()}})},showAlertMessage:function(e){this.container.alert.add({className:"awl-continer-message "+e.className,message:e.message}),this.container.alert.show()},showContentAlert:function(e){this.container.contentAlert.add({className:"awl-continer-message "+e.className,message:e.message}),this.container.contentAlert.show()},enableOrDisableButtons:function(e){this.viewcontrols.supermodel.getFooter().getChildren().forEach((function(t){t.disabled=e}))},refreshParentFrame:function(){this.frameName&&(this.frameName[0].location.href=this.frameName[0].location.href)}})}));