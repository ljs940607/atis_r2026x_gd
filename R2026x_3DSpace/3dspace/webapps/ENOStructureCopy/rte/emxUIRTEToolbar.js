var rte_tag="-rte-tmp-tag-",emxUIConstants={RTE_BOLD:"Bold",RTE_ITALIC:"Italic",RTE_UNDERLINE:"underline",RTE_STRIKETHROUGH:"strikethrough",RTE_SUPERSCRIPT:"superscript",RTE_SUBSCRIPT:"subscript",RTE_SPECIALCHARACTER:"specialcharacter",RTE_OK:"ok",RTE_CANCEL:"cancel"},rte_toolbar={bold:{command:"bold",tags:["b","strong"],hint:emxUIConstants.RTE_BOLD},italic:{command:"italic",tags:["i","em"],hint:emxUIConstants.RTE_ITALIC},underline:{command:"underline",tags:["u"],hint:emxUIConstants.RTE_UNDERLINE},strikeThrough:{command:"strikethrough",tags:["s","strike"],hint:emxUIConstants.RTE_STRIKETHROUGH},s4:{separator:!0},rtl:{command:"rtl",tags:["div"],hint:"Right to Left"},s6:{separator:!0},superscript:{command:"superscript",tags:["sup"],hint:emxUIConstants.RTE_SUPERSCRIPT},subscript:{command:"subscript",tags:["sub"],hint:emxUIConstants.RTE_SUBSCRIPT},s5:{separator:!0},specialChracter:{exec:lwrte_special_character,hint:emxUIConstants.RTE_SPECIALCHARACTER}},html_toolbar={s1:{separator:!0},word:{exec:lwrte_cleanup_word},clear:{exec:lwrte_clear}};function lwrte_block_compare(e,t){return(t=t.replace(/<([^>]*)>/,"$1")).toLowerCase()==e.nodeName.toLowerCase()}function lwrte_style_init(e){var t=this;t.select='<select><option value="">- no css -</option></select>',e.css.length&&$.ajax({url:"styles.php",type:"POST",data:{css:e.css[e.css.length-1]},async:!1,success:function(e){var n=e.split(","),r="";for(var a in n)r+='<option value="'+n[a]+'">'+n[a]+"</option>";t.select='<select><option value="">- css -</option>'+r+"</select>"}})}function lwrte_style(e){if(e)try{var t=e.options[e.selectedIndex].value,n=this.get_selected_text();n='<span class="'+t+'">'+n+"</span>",this.selection_replace_with(n),e.selectedIndex=0}catch(e){}}function lwrte_color(){var e=this,t=e.create_panel("Set color for text",385),n=!1,r=!1;t.append('<div class="colorpicker1"><div class="rgb" id="rgb"></div></div><div class="colorpicker1"><div class="gray" id="gray"></div></div><div class="colorpicker2">\t<div class="palette" id="palette"></div>\t<div class="preview" id="preview"></div>\t<div class="color" id="color"></div></div><div class="clear"></div><p class="submit"><button id="ok">Ok</button><button id="cancel">Cancel</button></p>').show();for(var a=$("#preview",t),l=$("#color",t),i=$("#palette",t),s=["#660000","#990000","#cc0000","#ff0000","#333333","#006600","#009900","#00cc00","#00ff00","#666666","#000066","#000099","#0000cc","#0000ff","#999999","#909000","#900090","#009090","#ffffff","#cccccc","#ffff00","#ff00ff","#00ffff","#000000","#eeeeee"],o=0;o<s.length;o++)$("<div></div>").addClass("item").css("background",s[o]).appendTo(i);var c=$("#rgb").height(),p=$("#rgb").width()/6;function u(e){var t="0123456789abcdef";return t.charAt(Math.floor(e/16))+t.charAt(e%16)}function d(e){var t={x:e.offsetLeft,y:e.offsetTop};if(e.offsetParent){var n=d(e.offsetParent);t.x+=n.x,t.y+=n.y}return t}function g(e,t){(t=t||window.event).target||t.srcElement;var n=d(e);return{x:t.pageX-n.x,y:t.pageY-n.y}}function f(e,t,n,r,i){var o,d,f,v,m=g(e,i),h=m.x,b=m.y;if(t){var _=(c-b)/c;o=128+((o=(h>=0)*(h<p)*255+(h>=p)*(h<2*p)*(510-255*h/p)+(h>=4*p)*(h<5*p)*(255*h/p-1020)+(h>=5*p)*(h<6*p)*255)-128)*_,d=128+((d=(h>=0)*(h<p)*(255*h/p)+(h>=p)*(h<3*p)*255+(h>=3*p)*(h<4*p)*(1020-255*h/p))-128)*_,f=128+((f=(h>=2*p)*(h<3*p)*(255*h/p-510)+(h>=3*p)*(h<5*p)*255+(h>=5*p)*(h<6*p)*(1530-255*h/p))-128)*_}else n?o=d=f=1.7*(c-b):r&&(h=Math.floor(h/10),b=Math.floor(b/10),v=s[h+5*b]);r||(v="#"+u(o)+u(d)+u(f)),a.css("background",v),l.html(v)}$("#rgb,#gray,#palette",t).mousedown((function(e){return n=!0,!1})).mouseup((function(e){return n=!1,!1})).mouseout((function(e){return r=!1,!1})).mouseover((function(e){return r=!0,!1})),$("#rgb").mousemove((function(e){return n&&r&&f(this,!0,!1,!1,e),!1})),$("#gray").mousemove((function(e){return n&&r&&f(this,!1,!0,!1,e),!1})),$("#palette").mousemove((function(e){return n&&r&&f(this,!1,!1,!0,e),!1})),$("#rgb").click((function(e){return f(this,!0,!1,!1,e),!1})),$("#gray").click((function(e){return f(this,!1,!0,!1,e),!1})),$("#palette").click((function(e){return f(this,!1,!1,!0,e),!1})),$("#cancel",t).click((function(){return t.remove(),!1})),$("#ok",t).click((function(){var n=l.html();return n.length>0&&"#"==n.charAt(0)&&(e.iframe_doc.selection&&e.range.select(),e.editor_cmd("foreColor",n)),t.remove(),!1}))}function lwrte_image(){var self=this,panel=self.create_panel("Insert image",385);panel.append('<p><label>URL</label><input type="text" id="url" size="30" value=""><button id="file">Upload</button><button id="view">View</button></p><div class="clear"></div><p class="submit"><button id="ok">Ok</button><button id="cancel">Cancel</button></p>').show();var url=$("#url",panel),upload=$("#file",panel).upload({autoSubmit:!1,action:"uploader.php",onSelect:function(){var e=this.filename(),t=/[.]/.exec(e)?/[^.]+$/.exec(e.toLowerCase()):"";t&&/^(jpg|png|jpeg|gif)$/.test(t)?this.submit():alert("Invalid file extension")},onComplete:function(response){response.length<=0||(response=eval("("+response+")"),response.error&&response.error.length>0?alert(response.error):url.val(response.file&&response.file.length>0?response.file:""))}});$("#view",panel).click((function(){return url.val().length>0?window.open(url.val()):alert("Enter URL of image to view"),!1})),$("#cancel",panel).click((function(){return panel.remove(),!1})),$("#ok",panel).click((function(){var e=url.val();return self.editor_cmd("insertImage",e),panel.remove(),!1}))}function lwrte_unformat(){this.editor_cmd("removeFormat"),this.editor_cmd("unlink")}function lwrte_clear(){confirm("Clear Document?")&&this.set_content("")}function replaceNestedSpan(e,t){var n=e.indexOf("<span>",t);if(n<0)return e;var r=e.indexOf("</span>",n+6),a=e.indexOf('<span dir="RTL">',n+6);if(r<a)return replaceNestedSpan(e,r+7);if(a<0&&(a=r),a<r){var l=e.substring(0,n).concat('<span dir="LTR">').concat(e.substring(n+6));e=l}return a+26>=e.length?e:replaceNestedSpan(e,a+26)}function lwrte_cleanup_word(){this.set_content(cleanup_word(this.get_content(),!0,!0,!0))}function cleanup_word(e,t,n,r,a){var l=!1;if(void 0!==a&&a&&e.indexOf("bidi")>=0&&(l=!0),e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/<o:p>\s*<\/o:p>/g,"")).replace(/<o:p>[\s\S]*?<\/o:p>/g,"&nbsp;")).replace(/\s*mso-[^:]+:[^;"]+;?/gi,"")).replace(/\s*MARGIN: 0cm 0cm 0pt\s*;/gi,"")).replace(/\s*MARGIN: 0cm 0cm 0pt\s*"/gi,'"')).replace(/\s*TEXT-INDENT: 0cm\s*;/gi,"")).replace(/\s*TEXT-INDENT: 0cm\s*"/gi,'"')).replace(/\s*TEXT-ALIGN: [^\s;]+;?"/gi,'"')).replace(/\s*PAGE-BREAK-BEFORE: [^\s;]+;?"/gi,'"')).replace(/\s*FONT-VARIANT: [^\s;]+;?"/gi,'"')).replace(/\s*tab-stops:[^;"]*;?/gi,"")).replace(/\s*tab-stops:[^"]*/gi,""),t&&(e=(e=(e=e.replace(/\s*face="[^"]*"/gi,"")).replace(/\s*face=[^ >]*/gi,"")).replace(/\s*FONT-FAMILY:[^;"]*;?/gi,"")),e=e.replace(/<(\w[^>]*) class=([^ |>]*)([^>]*)/gi,"<$1$3"),n&&(e=e.replace(/<(\w[^>]*) style="([^\"]*)"([^>]*)/gi,"<$1$3")),e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/<STYLE[^>]*>[\s\S]*?<\/STYLE[^>]*>/gi,"")).replace(/<(?:META|LINK)[^>]*>\s*/gi,"")).replace(/\s*style="\s*"/gi,"")).replace(/<(\w[^>]*) lang=([^ |>]*)([^>]*)/gi,"<$1$3")).replace(/<FONT\s*>([\s\S]*?)<\/FONT>/gi,"$1")).replace(/<\\?\?xml[^>]*>/gi,"")).replace(/<w:[^>]*>[\s\S]*?<\/w:[^>]*>/gi,"")).replace(/<\/?\w+:[^>]*>/gi,"")).replace(/<\!--[\s\S]*?-->/g,"")).replace(/<(U|I|STRIKE)>&nbsp;<\/\1>/g,"&nbsp;")).replace(/<H\d>\s*<\/H\d>/gi,"")).replace(/<(\w+)[^>]*\sstyle="[^"]*DISPLAY\s?:\s?none[\s\S]*?<\/\1>/gi,"")).replace(/<(\w[^>]*) language=([^ |>]*)([^>]*)/gi,"<$1$3")).replace(/<(\w[^>]*) onmouseover="([^\"]*)"([^>]*)/gi,"<$1$3")).replace(/<(\w[^>]*) onmouseout="([^\"]*)"([^>]*)/gi,"<$1$3"),r){e=(e=(e=e.replace(/<H(\d)([^>]*)>/gi,"<h$1>")).replace(/<(H\d)><FONT[^>]*>([\s\S]*?)<\/FONT><\/\1>/gi,"<$1>$2</$1>")).replace(/<(H\d)><EM>([\s\S]*?)<\/EM><\/\1>/gi,"<$1>$2</$1>");var i=new RegExp("<(?!/?("+emxUIRTE.RTE_SUP_TAGS.join("|")+")(?=>|\\s\\S.*>))/?.*?>","gi");e=e.replace(i,"")}else{e=(e=(e=(e=(e=(e=(e=e.replace(/<H1([^>]*)>/gi,'<div$1><b><font size="6">')).replace(/<H2([^>]*)>/gi,'<div$1><b><font size="5">')).replace(/<H3([^>]*)>/gi,'<div$1><b><font size="4">')).replace(/<H4([^>]*)>/gi,'<div$1><b><font size="3">')).replace(/<H5([^>]*)>/gi,'<div$1><b><font size="2">')).replace(/<H6([^>]*)>/gi,'<div$1><b><font size="1">')).replace(/<\/H\d>/gi,"</font></b></div>");i=new RegExp("(<P)([^>]*>[\\s\\S]*?)(</P>)","gi");e=(e=(e=(e=e.replace(i,"<div$2</div>")).replace(/<([^\s>]+)(\s[^>]*)?>\s*<\/\1>/g,"")).replace(/<([^\s>]+)(\s[^>]*)?>\s*<\/\1>/g,"")).replace(/<([^\s>]+)(\s[^>]*)?>\s*<\/\1>/g,"")}var s=/<\/(div|p)>[^<div>|<p>]/g.exec(e);if(s){var o=s.index;e=e.substring(0,o+6)+"<br/>"+e.substring(o+6)}if(e=(e=e.replace(/<span dir="RTL"><\/span>/gi,"")).replace(/<span dir="LTR"><\/span>/gi,""),l){for(var c=(e=(e=(e=(e=replaceNestedSpan(e,0)).replace(/<p dir="RTL">/gi,"")).replace(/<p dir="LTR">/gi,"")).replace(/<\/p>/gi,"")).split(/\r*\n/gi),p="",u=0;u<c.length;u++){var d=c[u].lastIndexOf('<span dir="RTL">'),g=c[u].lastIndexOf("<span>"),f=-1,v=0;if((d>=0||g>=0)&&(d>g?(f=d,v=17):(f=g,v=6)),f>=0){var m=c[u].substring(f+v);if(m.indexOf("</span>")<=0&&">"!=m.charAt(m.length-1)&&(""==m||m.charCodeAt(m.length-1)>255||m.charCodeAt(m.length-1)>33&&m.charCodeAt(m.length-1)<64)&&(c[u]=c[u]+" "),m.indexOf("</span>")>=0){var h=c[u].lastIndexOf("</span>");c[u].substring(f+v-1,h).trim().length>0&&(c[u]=c[u]+" ")}}else c[u].indexOf("</span>")>=0&&(c[u]=c[u]+" ");c[u].length>0&&(p=p.concat(c[u])),console.log(f)}e=c.join(""),e=p}return Browser.IE||l?e.replace(/\r/gi,"").replace(/\n/gi,""):e.replace(/\r*\n<br\/*>/gi,"<br/>").replace(/\r*\n/gi,"<br/>")}function lwrte_link(){var self=this,panel=self.create_panel("Create link / Attach file",385);panel.append('<p><label>URL</label><input type="text" id="url" size="30" value=""><button id="file">Attach File</button><button id="view">View</button></p><div class="clear"></div><p><label>Title</label><input type="text" id="title" size="30" value=""><label>Target</label><select id="target"><option value="">default</option><option value="_blank">new</option></select></p><div class="clear"></div><p class="submit"><button id="ok">Ok</button><button id="cancel">Cancel</button></p>').show(),$("#cancel",panel).click((function(){return panel.remove(),!1}));var url=$("#url",panel),upload=$("#file",panel).upload({autoSubmit:!0,action:"uploader.php",onComplete:function(response){response.length<=0||(response=eval("("+response+")"),response.error&&response.error.length>0?alert(response.error):url.val(response.file&&response.file.length>0?response.file:""))}});$("#view",panel).click((function(){return url.val().length>0?window.open(url.val()):alert("Enter URL to view"),!1})),$("#ok",panel).click((function(){var e=$("#url",panel).val(),t=$("#target",panel).val(),n=$("#title",panel).val();if(self.get_selected_text().length<=0)return alert("Select the text you wish to link!"),!1;if(panel.remove(),e.length<=0)return!1;self.editor_cmd("unlink"),self.editor_cmd("createLink",rte_tag);var r=$("<span></span>").append(self.get_selected_html());return t.length>0&&$('a[href*="'+rte_tag+'"]',r).attr("target",t),n.length>0&&$('a[href*="'+rte_tag+'"]',r).attr("title",n),$('a[href*="'+rte_tag+'"]',r).attr("href",e),self.selection_replace_with(r.html()),!1}))}function lwrte_special_character(){var e=this,t=e.create_panel("");t.append('<div id="specialCharactersPanel"><table><tr><td><input type="button" name="dollar" value="&#36;"></td><td><input type="button" name="copyright" value="&copy;"></td><td><input type="button" name="dagger" value="&#134;"></td></tr><tr><td><input type="button" name="cent" value="&#162;"></td><td><input type="button" name="registered trade mark" value="&reg;"></td><td><input type="button" name="care of" value="&#8453;"></td></tr><tr><td><input type="button" name="pound" value="&#163;"></td><td><input type="button" name="sound recording copyright" value="&#8471;"></td><td><input type="button" name="Number Word" value="&#8470;"></td></tr><tr><td><input type="button" name="yen" value="&#165;"></td><td><input type="button" name="trademark" value="&#153;"></td><td><input type="button" name="open-mid front rounded vowel" value="&#140;"></td></tr><tr><td><input type="button" name="Euro" value="&#128;"></td><td><input type="button" name="service mark" value="&#8480;"></td><td><input type="button" name="degree" value="&#176;"></td></tr></table></div>').show(),$(":button","#specialCharactersPanel",t).click((function(){return e.insert_html_with(this.defaultValue),t.remove(),!1})),$(e.iframe_doc).click((function(e){if(!$(e.target).is(t))return t.remove(),!1}))}