jQuery.fn.rte=function(e,t){return t&&t.constructor==Array||(t=new Array),jQuery(this).each((function(r){var a=this.id?this.id:t.length;t[a]=new lwRTE(this,e||{})})),t};var emxUIRTE=new Object;emxUIRTE.RTE_TAGS=["strong","em","b","i","u","p","sup","sub","strike","s","span","br"],emxUIRTE.RTE_SUP_TAGS=["br","strong","em","b","i","u","p","sup","sub","strike","s","span"],emxUIRTE.get_rte_data=function(e,t){var r=emxUICore.createXMLDOM();r.loadXML("<mxLinkRoot/>");var a=r.createTextNode(e);r.documentElement.appendChild(a);var i="skipInputFilter=true";void 0!==t&&null!=t&&(i="paramName="+t);var n=emxUICore.getTextXMLDataPost("../common/emxFreezePaneValidate.jsp?rteValue=true&"+i,r.xml);return emxUICore.selectSingleNode(n,"/mxRoot/message/display/text()").nodeValue};var lwRTE_resizer=function(e){this.drag=!1,this.rte_zone=jQuery(e).parents(".rte-zone")};lwRTE_resizer.mousedown=function(e,t){return e.drag=!0,e.event=void 0===t?window.event:t,e.rte_obj=jQuery(".rte-resizer",e.rte_zone).prev().eq(0),jQuery("body",document).css("cursor","se-resize"),!1},lwRTE_resizer.mouseup=function(e,t){return e.drag=!1,jQuery("body",document).css("cursor","auto"),!1},lwRTE_resizer.mousemove=function(e,t){if(e.drag){t=void 0===t?window.event:t;var r=Math.max(1,e.rte_zone.width()+t.screenX-e.event.screenX),a=Math.max(1,e.rte_obj.height()+t.screenY-e.event.screenY);e.rte_zone.width(r),e.rte_obj.height(a),e.event=t}return!1};var lwRTE=function(e,t){if(this.css=[],this.css_class=t.frame_class||"",this.base_url=t.base_url||"",this.width=t.width||jQuery(e).width()||"100%",this.height=t.height||jQuery(e).height()||350,this.iframe=null,this.iframe_doc=null,this.textarea=null,this.event=null,this.range=null,this.toolbars={rte:"",html:""},this.controls={rte:{},html:{}},this.callback=t.callback||null,this.ok_cancel=t.ok_cancel||!1,this.NLS=t.NLS,jQuery.extend(this.controls.rte,t.controls_rte||{}),jQuery.extend(this.controls.html,t.controls_html||{}),jQuery.extend(this.css,t.css||{}),document.designMode||document.contentEditable){if(jQuery(e).wrap(jQuery('<div style="height:160px"></div>').addClass("rte-zone").width(this.width)),jQuery('<div class="rte-resizer"><a href="#"></a></div>').insertAfter(e),this.ok_cancel&&(jQuery(".rte-resizer").prepend(jQuery('<input id="rte_ok" class="mx_btn-apply" type="button"><input id="rte_cancel" class="mx_btn-cancel" type="button">')),jQuery("#rte_ok").val(emxUIConstants.RTE_OK).attr("title",emxUIConstants.RTE_OK),jQuery("#rte_cancel").val(emxUIConstants.RTE_CANCEL).attr("title",emxUIConstants.RTE_CANCEL),this.callback)){var r=this;jQuery("#rte_ok").bind("click",(function(){r.callback()})),jQuery("#rte_cancel").bind("click",(function(){jQuery(".formLayer").remove()}))}var a=new lwRTE_resizer(e);jQuery(".rte-resizer a",jQuery(e).parents(".rte-zone")).mousedown((function(e){return jQuery(document).mousemove((function(e){return lwRTE_resizer.mousemove(a,e)})),jQuery(document).mouseup((function(e){return lwRTE_resizer.mouseup(a,e)})),lwRTE_resizer.mousedown(a,e)})),this.textarea=e,this.enable_design_mode()}};lwRTE.prototype.editor_cmd=function(e,t){try{"rtl"==e?this.iframe_doc.dir="rtl"==this.iframe_doc.dir?"ltr":"rtl":(isIE&&this.iframe_doc.body.innerText.length==this.iframe_doc.getSelection().toString().length&&(this.iframe_doc.body.innerHTML=this.iframe_doc.body.innerHTML+""),this.iframe_doc.execCommand(e,!1,t))}catch(e){}this.iframe_doc.body.focus()},lwRTE.prototype.get_toolbar=function(){var e=this.iframe?jQuery(this.iframe):jQuery(this.textarea);return e.prev().hasClass("rte-toolbar")?e.prev():null},lwRTE.prototype.activate_toolbar=function(e,t){var r=this.get_toolbar();r&&r.remove(),jQuery(e).before(jQuery(t).clone(!0))},lwRTE.prototype.enable_design_mode=function(){var e=this;jQuery(e.textarea).attr("id")||jQuery(e.textarea).attr("name");e.iframe=document.createElement("iframe"),e.iframe.frameBorder=0,e.iframe.frameMargin=0,e.iframe.framePadding=0,e.iframe.width="100%",e.iframe.height=e.height||"100%",e.iframe.style.position="relative",e.iframe.src="",e.iframe.setAttribute("sc_dojoType","scayt.ui"),jQuery(e.textarea).attr("class")&&(e.iframe.className=jQuery(e.textarea).attr("class")),jQuery(e.textarea).attr("id")&&(e.iframe.id=jQuery(e.textarea).attr("id")+"_rte"),jQuery(e.textarea).attr("name")&&(e.iframe.title=jQuery(e.textarea).attr("name"));var t=jQuery(e.textarea).val();t=(t=t.replace(/<span dir="LTR"\/>/gi,'<span dir="LTR"></span>')).replace(/<span dir="RTL"\/>/gi,'<span dir="RTL"></span>'),jQuery(e.textarea).hide().after(e.iframe);var r=e.base_url?"<base href='"+e.base_url+"' />":"",a=e.css_class?"class='"+e.css_class+" verbatim'":"class='verbatim'",i=!1;0==t.indexOf("<div")&&(i=!0,t=(t=t.replace('<div dir="rtl">',"")).replace("</div>",""));var n=/(<br\/>)*$/g.exec(t);if(n){var o=Browser.IE?"<p><br></p>":"<div><br></div>",s=n[0].replace(/<br\/>/g,o);t=t.substring(0,n.index)+s}var c="<!DOCTYPE html><head>"+r+"</head><body "+a+" style='padding:5px; background-color:white;'>"+t+"</body></html>";e.iframe_doc=e.iframe.contentWindow.document;try{e.iframe_doc.designMode="on"}catch(t){jQuery(e.iframe_doc).focus((function(){e.iframe_doc.designMode()}))}e.iframe_doc.open(),e.iframe_doc.write(c),e.iframe_doc.close();for(var l=0;l<e.css.length;l++)jQuery("head",e.iframe_doc).append(jQuery("<link type='text/css' rel='stylesheet' href='"+e.css[l]+"' />"));jQuery(e.iframe).bind("blur",(function(){e.update_hidden_field()})),jQuery(e.iframe_doc).bind("blur",(function(){e.update_hidden_field()})),jQuery(e.iframe_doc.body).bind("blur",(function(){e.update_hidden_field()})),jQuery(e.iframe_doc).bind("paste",(function(e){var t;e=jQuery.extend({},e,{type:"afterpaste"}),t="BODY"!==e.target.tagName?jQuery(e.target).closest("body")[0]:e.target,window.setTimeout((function(){jQuery(t).trigger(e.type)}),0)})),jQuery(e.iframe_doc).bind("afterpaste",function(){jQuery("body",e.iframe_doc).html(cleanup_word(jQuery("body",e.iframe_doc).html(),!0,!0,!0,!0))}.bind(this)),jQuery(e.iframe.contentWindow).bind("focus",(function(){"undefined"!=typeof FormHandler&&FormHandler.GetField(e.textarea.name).HandleFocusEvent()})),jQuery(e.iframe.contentWindow).bind("keydown",(function(e){e.ctrlKey&&(65!=e.keyCode&&97!=e.keyCode||e.preventDefault())})),e.toolbars.rte||(e.toolbars.rte=e.create_toolbar(e.controls.rte)),e.activate_toolbar(e.iframe,e.toolbars.rte),jQuery(e.iframe).parents("form").submit((function(){e.disable_design_mode(!0)})),jQuery(e.iframe_doc).mouseup((function(t){e.iframe_doc.selection&&(e.range=e.iframe_doc.selection.createRange()),e.set_selected_controls(t.target?t.target:t.srcElement,e.controls.rte)})),jQuery(e.iframe_doc).blur((function(t){e.iframe_doc.selection&&(e.range=e.iframe_doc.selection.createRange())})),jQuery(e.iframe_doc).keyup((function(t){e.set_selected_controls(e.get_selected_element(),e.controls.rte)})),isIE?isMinIE9&&e.iframe_doc.execCommand("AutoUrlDetect",!1,!1):e.iframe_doc.execCommand("styleWithCSS",!1,!1),e.textarea.updateRTE=function(t){e.update_RTE_values(t)},e.textarea.enableRTE=function(t){e.iframe_doc.designMode="on"},e.textarea.disableRTE=function(){e.iframe_doc.designMode="off"},1==i&&(e.iframe_doc.dir="rtl",$(".rtl").addClass("active"))},lwRTE.prototype.update_hidden_field=function(){var e=this,t=jQuery(e.textarea).val();if(""!=jQuery("body",e.iframe_doc).text().trim()){for(var r=$("body",e.iframe_doc).html(),a=(r=r.replace(/<(\w[^>]*) style="([^\"]*)"([^>]*)/gi,"<$1$3")).replace(/<[\/]{0,1}(A)[^><]*>/gi,"").replace(/&nbsp;/gi," ").replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&amp;/gi,"&").replace(/<br>/gi,"<br/>"),i=Browser.IE?"<p>":"<div>",n=0;n<6;)a=a.replace(/<(b|strong)><br\/><\/\1>/g,"<br/>").replace(/<(i|em)><br\/><\/\1>/g,"<br/>").replace(/<u><br\/><\/u>/g,"<br/>").replace(/<strike><br\/><\/strike>/g,"<br/>").replace(/<sub><br\/><\/sub>/g,"<br/>").replace(/<sup><br\/><\/sup>/g,"<br/>"),n++;a=a.replace(/<(div|p)><br\/><\/\1>/g,"<br/>");var o=/<\/(div|p)>[^<div>|<p>]/g.exec(a);if(o){var s=o.index;a=a.substring(0,s+6)+"<br/>"+a.substring(s+6)}var c=new String(a),l=0==(c=c.replace(/<br\/>/g,"")).indexOf(i);a=a.replace(/<(div|p)>/g,"<br/>").replace(/<\/(div|p)>/g,""),l&&(a=a.replace("<br/>","")),"rtl"==e.iframe_doc.dir&&(a='<div dir="rtl">'+a+"</div>"),jQuery(e.textarea).val(a)}else jQuery(e.textarea).val("");"undefined"!=typeof FormHandler&&FormHandler.GetField(e.textarea.name).FireChangeEvent(),e.textarea.onchange&&t!=jQuery(e.textarea).val()&&e.textarea.onchange()},lwRTE.prototype.update_RTE_values=function(e){jQuery("body",this.iframe_doc).html(e),jQuery(this.textarea).val(e)},lwRTE.prototype.disable_design_mode=function(e){var t=this;t.textarea=e?jQuery('<input type="hidden" />').get(0):jQuery("<textarea></textarea>").width("100%").height(t.height).get(0),t.iframe.className&&(t.textarea.className=t.iframe.className),t.iframe.id&&(t.textarea.id=t.iframe.id.substring(0,t.iframe.id.indexOf("_rte"))),t.iframe.title&&(t.textarea.name=t.iframe.title),jQuery(t.textarea).val(jQuery("body",t.iframe_doc).html()),jQuery(t.iframe).before(t.textarea),t.toolbars.html||(t.toolbars.html=t.create_toolbar(t.controls.html)),1!=e&&(jQuery(t.iframe_doc).remove(),jQuery(t.iframe).remove(),t.iframe=t.iframe_doc=null,t.activate_toolbar(t.textarea,t.toolbars.html))},lwRTE.prototype.toolbar_click=function(e,t){var r=t.exec,a=t.args||[],i="SELECT"==e.tagName.toUpperCase();if(e.className.indexOf("active")>-1?jQuery(e).removeClass("active"):jQuery(e).addClass("active"),jQuery(".rte-panel",this.get_toolbar()).remove(),r){i&&a.push(e);try{r.apply(this,a)}catch(e){}}else if(this.iframe&&t.command){if(i&&(a=e.options[e.selectedIndex].value).length<=0)return;this.editor_cmd(t.command,a)}},lwRTE.prototype.create_toolbar=function(e){var t,r,a=this,i=jQuery("<div></div>").addClass("rte-toolbar").width("100%").append(jQuery("<ul class='inline'></ul>")).append(jQuery("<div></div>").addClass("clear"));for(var n in e){if(e[n].separator)r=jQuery("<li></li>").addClass("separator");else{if(e[n].init)try{e[n].init.apply(e[n],[this])}catch(e){}t=e[n].select?jQuery(e[n].select).change((function(t){return a.event=t,a.toolbar_click(this,e[this.className]),!1})):jQuery("<a href='#'></a>").attr("title",e[n].hint?this.NLS[n]:n).attr("rel",n).click((function(t){return a.event=t,a.toolbar_click(this,e[this.rel]),!1})),r=jQuery("<li></li>").append(t.addClass(n))}jQuery("ul",i).append(r)}return jQuery(".enable",i).click((function(){return a.enable_design_mode(),!1})),jQuery(".disable",i).click((function(){return a.disable_design_mode(),!1})),i.get(0)},lwRTE.prototype.create_panel=function(e,t){var r=this.get_toolbar();if(!r)return!1;jQuery(".rte-panel",r).remove();var a,i,n=8,o=8,s=this.event.currentTarget;do{if("div"==s.tagName.toLowerCase())break;n+=s.offsetLeft,o+=s.offsetTop}while(s=s.offsetParent);var c=jQuery("<div></div>").hide().addClass("rte-panel").css({left:n+"px",top:o+"px"});return jQuery("<div></div>").addClass("rte-panel-title").html(e).append(jQuery("<a class='close' href='#'><img src='./assets/images/rte/buttonMiniCancel.gif'></a>").click((function(){return c.remove(),!1}))).mousedown((function(){return a=!0,!1})).mouseup((function(){return a=!1,!1})).mousemove((function(e){return a&&i&&(n-=i.pageX-e.pageX,o-=i.pageY-e.pageY,c.css({left:n+"px",top:o+"px"})),i=e,!1})).appendTo(c),t&&c.width(t+"px"),r.append(c),c},lwRTE.prototype.get_content=function(){return this.iframe?jQuery("body",this.iframe_doc).html():jQuery(this.textarea).val()},lwRTE.prototype.set_content=function(e){this.iframe?jQuery("body",this.iframe_doc).html(e):jQuery(this.textarea).val(e)},lwRTE.prototype.set_selected_controls=function(e,t){var r,a,i,n,o,s,c,l=this.get_toolbar();if(!l)return!1;try{for(r in t)if(n=t[r],"rtl"!=r&&((i=jQuery("."+r,l)).removeClass("active"),n.tags)){a=e;do{if(1==a.nodeType&&(o=a.nodeName.toLowerCase(),!(jQuery.inArray(o,n.tags)<0)))if(n.select){if("SELECT"==(i=i.get(0)).tagName.toUpperCase())for(i.selectedIndex=0,s=0;s<i.options.length;s++)if((c=i.options[s].value)&&(n.tag_cmp&&n.tag_cmp(a,c)||o==c)){i.selectedIndex=s;break}}else i.addClass("active")}while(a=a.parentNode)}}catch(e){}return!0},lwRTE.prototype.get_selected_element=function(){var e,t=this.iframe.contentWindow;if(t.getSelection)try{e=t.getSelection().getRangeAt(0).commonAncestorContainer}catch(e){return!1}else try{e=t.document.selection.createRange().parentElement()}catch(e){return!1}return e},lwRTE.prototype.get_selection_range=function(){var e=this.iframe.contentWindow;return e.focus(),e.getSelection?e.getSelection().getRangeAt(0):this.iframe_doc.selection.createRange()},lwRTE.prototype.get_selected_text=function(){var e=this.iframe.contentWindow;return e.getSelection?e.getSelection().toString():(this.range.select(),e.document.selection.createRange().text)},lwRTE.prototype.get_selected_html=function(){var e=null,t=this.iframe.contentWindow,r=this.get_selection_range();if(r)if(t.getSelection){var a=document.createElement("div");a.appendChild(r.cloneContents()),e=a.innerHTML}else e=r.htmlText;return e},lwRTE.prototype.selection_replace_with=function(e){var t=this.get_selection_range(),r=this.iframe.contentWindow;t&&(this.editor_cmd("removeFormat"),r.getSelection?(t.deleteContents(),t.insertNode(t.createContextualFragment(e)),this.editor_cmd("delete")):(this.editor_cmd("delete"),t.pasteHTML(e)))},lwRTE.prototype.insert_html_with=function(e){var t=this.get_selection_range(),r=this.iframe.contentWindow;if(t||this.editor_cmd("inserthtml",e),r.getSelection){var a=this.iframe_doc.createTextNode(e),i=r.getSelection();t.deleteContents(),t.insertNode(a),t.selectNodeContents(a),i.collapse(i.focusNode,i.focusOffset)}else t.pasteHTML(e);r.focus()};