/*!  Copyright 2025 Dassault Systemes. All rights reserved. */
define("DS/SMAXCTSimRTWeb/extensions/StuESimulationLegendPrototypeBuild",["UWA/Class/Listener","DS/XCTWebExperienceAppPlay/extensions/StuE3DActorPrototypeBuild"],(function(e,t){"use strict";return t.extend(e,{build:function(e){e.CATICXP3DUIActor,this._isRegisteredToUIEventsManager=!1;let t=this.GetObject().QueryInterface("CATI3DExperienceObject"),n=this.GetObject()._experienceBase.getManager("CXPWebPlayManager"),i=this.GetObject()._experienceBase.getManager("CAT3DXUIEventsManager");return t&&n&&i&&(i.Register3DUIActor(t),this._isRegisteredToUIEventsManager=!0,this.listenTo(n,"PlayStateChanged",this._onPlayStateChanged.bind(this))),this._parent(e)},disposeESObject:function(e){this.stopListening();let t=this.GetObject().QueryInterface("CATI3DExperienceObject"),n=this.GetObject()._experienceBase.getManager("CAT3DXUIEventsManager");t&&n&&(n.Unregister3DUIActor(t),this._isRegisteredToUIEventsManager=!1),this._parent(e)},_onPlayStateChanged:function(e){let t=this.GetObject().QueryInterface("CATI3DExperienceObject"),n=this.GetObject()._experienceBase.getManager("CXPWebPlayManager"),i=this.GetObject()._experienceBase.getManager("CAT3DXUIEventsManager");t&&n&&i&&(e==n.ePlayState.ePlaying?this._isRegisteredToUIEventsManager||(i.Register3DUIActor(t),this._isRegisteredToUIEventsManager=!0):this._isRegisteredToUIEventsManager&&(i.Unregister3DUIActor(t),this._isRegisteredToUIEventsManager=!1))}})})),define("DS/SMAXCTSimRTWeb/StuSimulationAnimationWrapperWeb",["DS/SMAXCTSimBridge/DSXMBridge"],(function(e){"use strict";let t=function(){this._ddAnimation=void 0,this._legendUI=void 0};return t.prototype.initEngineWithAnim=function(t){const n=t.getModelObject().QueryInterface("CATI3DExperienceObject"),i=n.GetValueByName("duration"),o=n.GetValueByName("animateAll"),r=o?[]:n.GetValueByName("animationScope"),s=n.GetParent();let a=e.getDataDisplay(s);const u=e.getAnimationInterface();a.QI(u,(t=>{t.initAnimation((()=>{o||t.setActiveGroups(r),t.updateActiveGroupsTimeProjection(i),this._ddAnimation=t}),{renderRequest:()=>{e.requestRender()},resultActor:s})}))},t.prototype.jumpToTime=function(e){this._ddAnimation&&
//!! if we need to perform an updateTextures, we need to
this._ddAnimation.jumpTo(e)},t.prototype.jumpToFrame=function(e){this._ddAnimation&&this._ddAnimation.animate(e)},t.prototype.getAnimatedObjects=function(e){},t})),define("DS/SMAXCTSimRTWeb/StuAnimationPlayerWeb",["DS/StuCore/StuContext","DS/StuCore/StuManager","DS/StuModel/StuAnimationStartedEvent","DS/StuModel/StuAnimationFinishedEvent","DS/StuModel/StuAnimationPausedEvent","DS/StuModel/StuAnimationResumedEvent","DS/StuModel/StuAnimationStoppedEvent","DS/StuModel/StuAnimationLoopFinishedEvent","DS/StuModel/StuAnimationLoopStartedEvent","DS/EP/EP"],(function(e,t,n,i,o,r,s,a,u,p){"use strict";let c=function(e){p.Task.call(this),this.player=e};(c.prototype=new p.Task).constructor=c,c.prototype.onExecute=function(e){this.player.onExecute(e)},c.prototype.onStop=function(){this.player._registeredAnimations.forEach((e=>{let t=e.simAnim;t._wrapper&&this.player._resetAnimation(t)}))};const m="PLAYING",l="PAUSED",d="STOPPED";let A=function(){t.call(this),this.name="SimulationAnimationPlayer"};return(A.prototype=new t).constructor=A,A.prototype._registeredAnimations=[],A.prototype.onInitialize=function(){A.prototype._task=new c(this),p.TaskPlayer.addTask(A.prototype._task),t.prototype.onInitialize.call(this)},A.prototype.onExecute=function(t){let n=A.prototype._registeredAnimations;for(let s=0;s<n.length;s++){const p=n[s];if(p.state===l||p.state===d)continue;let c=p.simAnim.speedFactor;p.simAnim.reverse&&(c=-c),p.simAnim.bounce?c*=p.bounceDirection:1!==p.bounceDirection&&(p.bounceDirection=1),p.currentTime+=c*t.getDeltaTime()/1e3;if(p.currentTime>p.simAnim.duration||p.currentTime<0){if(p.simAnim.loop){if(!p.simAnim.bounce||-1===p.bounceDirection){if(p.hasBeenLooping){const e=new a(p.simAnim);p.simAnim.dispatchEvent(e)}else p.hasBeenLooping=!0;if(p.state===m){const e=new u(p.simAnim);p.simAnim.dispatchEvent(e)}}}else if(!p.simAnim.bounce||-1===p.bounceDirection){const t=new i(p.simAnim);if(p.simAnim.dispatchEvent(t),p.hasBeenLooping){const e=new a(p.simAnim);p.simAnim.dispatchEvent(e),p.hasBeenLooping=!1}p.simAnim.dispatchEvent(new e.ServiceStoppedEvent("play",p.simAnim)),p.state=d,p.currentTime<0?(p.currentTime=0,p.simAnim._wrapper.jumpToTime(0)):(p.currentTime=p.simAnim.duration,p.simAnim._wrapper.jumpToTime(p.simAnim.duration));continue}p.simAnim.bounce?(p.currentTime<0&&(p.currentTime=Math.abs(p.currentTime)),p.currentTime>p.simAnim.duration&&(p.currentTime=2*p.simAnim.duration-p.currentTime),p.bounceDirection=-p.bounceDirection):p.currentTime=(o=p.currentTime,r=p.simAnim.duration,(o%r+r)%r)}if(p.currentTime<0||p.currentTime>p.simAnim.duration)return void console.error(`iTime must between 0 and ${p.simAnim.duration}s`);p.simAnim._wrapper.jumpToTime(p.currentTime)}var o,r},A.prototype.onDispose=function(){p.TaskPlayer.removeTask(A.prototype._task),delete A.prototype._task,t.prototype.onDispose.call(this)},A.prototype.play=function(e){if(null==e)return;(isNaN(e.duration)||e.duration<=0)&&console.error("Simulation Animation duration is invalid");let t,i=A.prototype._registeredAnimations;for(const n of i)if(n.simAnim===e){if(n.state===m)return void console.warn("Given animation is already playing");t=n}const o=e.CATI3DExperienceObject;if(null==o)return void console.error("Cannot find reference to engine animation, build must be corrupted");if(null===e._wrapper||void 0===e._wrapper){const t=e._getOrCreateWrapper();if(null==t)return void console.error("Animation engine couldn't be started. Animations won't move without it");e._wrapper=t}
//!!!!!!!!we want to initialize the wrapper on every animation play
if(null!==e._wrapper&&void 0!==e._wrapper&&e._wrapper.initEngineWithAnim(o),null==t){t={bounceDirection:1,currentTime:e.reverse?e.duration:0,name:e.name,simAnim:e,state:m,hasBeenLooping:!1},i.push(t)}else{if(t.state===l){const n=new r(e);return e.dispatchEvent(n),void(t.state=m)}t.simAnim.reverse?0===t.currentTime&&(t.currentTime=t.simAnim.duration):t.currentTime===t.simAnim.duration&&(t.currentTime=0),this._resetAnimation(t.simAnim),t.state=m}const s=new n(e);if(e.dispatchEvent(s),e.loop){const n=new u(e);e.dispatchEvent(n),t.hasBeenLooping=!0}},A.prototype.pause=function(e){if(null==e)return;let t=A.prototype._registeredAnimations;for(const n of t)if(n.simAnim===e){if(n.state===m){n.state=l;const t=new o(e);n.simAnim.dispatchEvent(t)}else console.warn("Given animation is not playing");return}console.warn("Given animation is not playing")},A.prototype.stop=function(t){if(null==t)return;let n=A.prototype._registeredAnimations;for(let i=0;i<n.length;i++){const o=n[i];if(o.simAnim===t){o.state=d,n.splice(i,1),this._resetAnimation(t);const r=new s(t);return t.dispatchEvent(r),void t.dispatchEvent(new e.ServiceStoppedEvent("play",t))}}this._resetAnimation(t),console.warn("Given animation isn't playing")},A.prototype._resetAnimation=function(e){null!==e._wrapper&&void 0!==e._wrapper&&(e.authoringFrame>=0?e._wrapper.jumpToTime(e.authoringFrame):e.reverse?e._wrapper.jumpToTime(e.duration):e._wrapper.jumpToTime(0))},A.prototype.isPlaying=function(e){let t=!1,n=A.prototype._registeredAnimations;for(const i of n)if(i.simAnim===e){i.state===m&&(t=!0);break}return t},A.prototype.isPlayingBackward=function(e){let t=A.prototype._registeredAnimations;for(const e of t)if(e.simAnim===iAnimation&&e.state===m)return e.bounceDirection<0?!e.simAnim.reverse:e.simAnim.reverse;return!1},A.prototype.isPaused=function(e){let t=!1,n=A.prototype._registeredAnimations;for(const e of n)if(e.simAnim===iAnimation){e.state===l&&(t=!0);break}return t},A.prototype.isStopped=function(e){let t=A.prototype._registeredAnimations;for(const n of t)if(n.simAnim===e)return n.state===d;return!0},A.prototype.setTime=function(e,t){if(isNaN(t)||t<0||t>e.duration)return void console.error(`iTime must between 0 and ${e.duration}s`);let n,i=A.prototype._registeredAnimations;for(const o of i)o.simAnim===e&&(o.currentTime=t,n=o);if(n||(n={bounceDirection:1,currentTime:t,name:e.name,simAnim:e,state:d,hasBeenLooping:!1},i.push(n)),n.state===l||n.state===d){if(null===e._wrapper||void 0===e._wrapper){const t=e._getOrCreateWrapper();if(null==t)return void console.error("Animation engine couldn't be started. Animations won't move without it");e._wrapper=t;const n=e.CATI3DExperienceObject;if(null==n)return void console.error("Cannot find reference to engine animation, build must be corrupted");t.initEngineWithAnim(n)}e._wrapper&&e._wrapper.jumpToTime(t)}},A.prototype.getTime=function(e){let t=A.prototype._registeredAnimations;for(let n=0;n<t.length;n++){const i=t[n];if(i.simAnim===e)return i.currentTime}return e.reverse?e.duration:0},e.registerManager(A),e.SimulationAnimationPlayer=A,A})),define("DS/SMAXCTSimRTWeb/StuSimulationAnimationWeb",["DS/StuModel/StuAnimation","DS/SMAXCTSimRTWeb/StuAnimationPlayerWeb","DS/SMAXCTSimRTWeb/StuSimulationAnimationWrapperWeb"],(function(e,t,n){"use strict";let i=function(){e.call(this),this._duration=0,this._wrapper=null};return(i.prototype=new e).constructor=i,i.prototype.getDuration=function(){return i.prototype._duration},i.prototype.setDuration=function(e){i.prototype._duration=e},i.prototype.play=function(){let e=t.getInstance();null!=e?e.play(this):console.error("could not play the animation")},i.prototype.pause=function(){let e=t.getInstance();null!=e?e.pause(this):console.error("could not pause the animation")},i.prototype.stop=function(){let e=t.getInstance();null!=e?e.stop(this):console.error("could not stop the animation")},i.prototype.isPlaying=function(){let e=t.getInstance();return null!=e&&e.isPlaying(this)},i.prototype.isPaused=function(){let e=t.getInstance();return null!=e&&e.isPaused(this)},i.prototype.isPlayingBackward=function(){let e=t.getInstance();return null!=e&&e.isPlayingBackward(this)},i.prototype.getTime=function(){let e=t.getInstance();return null!=e?e.getTime(this):0},i.prototype.setTime=function(e){let n=t.getInstance();null!=n&&n.setTime(this,e)},i.prototype.getAnimatedObjects=function(){const e=this._getOrCreateWrapper();if(null!=e){const t=this.CATI3DExperienceObject;return null==t?(console.error("Cannot find reference to engine animation, build must be corrupted"),[]):e.getAnimatedObjects(t)}},i.prototype._getOrCreateWrapper=function(){return null!==this._wrapper&&void 0!==this._wrapper||(this._wrapper=new n),this._wrapper},i.prototype.onInitialize=function(){e.prototype.onInitialize.call(this);const t=this.CATI3DExperienceObject;null!=t&&(e.prototype._duration=t.GetValueByName("duration"))},STU.SimulationAnimation=i,i})),define("DS/SMAXCTSimRTWeb/extensions/StuESimulationAnimationPrototypeBuild",["UWA/Core","DS/XCTWebExperienceAppPlay/extensions/StuEExperienceBasePrototypeBuild","DS/SMAXCTSimRTWeb/StuSimulationAnimationWeb"],(function(e,t,n){"use strict";return t.extend({build:function(e){return this.CATI3DExperienceObject=this.GetObject().QueryInterface("CATI3DExperienceObject"),this._parent(e)}})}));