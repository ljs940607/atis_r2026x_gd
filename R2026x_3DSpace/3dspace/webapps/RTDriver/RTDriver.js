define("DS/RTDriver/RTDetectClient",["DS/RTProxyDriver/RTLogger"],(function(e){"use strict";e.debug("RTDetectClient load");var t="2",n=!1;["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].forEach((function(e){n||e in window&&(n=!0)})),e.debug("WebRTCCompatible = "+n);var i=!!(navigator.getDisplayMedia||navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia);e.debug("ScreenSharingCompatible = "+i);var o=navigator.platform.toUpperCase().indexOf("MAC")>=0;e.debug("isMac = "+o);var r=/(iPhone|iPod|iPad)/i.test(navigator.platform);return e.debug("isIOS = "+r),{setCallVersion:function(e){t=e},isIphone:function(){return-1!=navigator.platform.indexOf("iPhone")},getClientInfos:function(){return{WebRTCCompatible:n,ScreenSharingCompatible:i,userAgent:navigator?navigator.userAgent:null,appVersion:navigator?navigator.appVersion:null,platform:navigator?navigator.platform:null,hasMicrophone:!0,hasWebcam:!0,callVersion:t,isIOS:r,isMac:o}}}})),define("DS/RTDriver/RTIdleDetector",["DS/RTProxyDriver/RTLogger"],(function(e){const t=9e5;let n=null,i=null,o=null,r=null,s=null,c=!1,a=null,d=null,u=null;async function l({idle:t,startDate:n}){e.debug("Send idle state to server: "+t+" startDate: "+n),u&&(clearInterval(u),u=null),d=null,"function"==typeof o&&o({idle:t,startDate:n})}async function v({idle:t,startDate:n}){const o=Date.now();if(!a||o-a>=i)return a=o,l({idle:t,startDate:n});if(a=request.receptionDate,d={idle:t,startDate:n},u)return e.debug("Already checking event flooding.");const r=setTimeout((()=>{u&&(clearInterval(u),u=null),d&&(l(d),e.debug("Idle status set after flooding timeout.")),clearTimeout(r)}),6e4);u=setInterval((()=>{Date.now()-a>=i&&(l(d),e.debug("Idle status set after flooding."))}),i)}async function h(){return"string"==typeof r?(e.debug("Idle permission: "+r),r):IdleDetector?(r=await IdleDetector.requestPermission(),e.debug("IdleDetector compatible - permission: "+r),r):(e.debug("Not IdleDetector compatible"),"notSupported")}async function E(){"granted"!==await h()||c?c?e.debug("Idle detection already ON"):e.debug("IdleDetector not supported by your browser"):(e.debug("Starting Idle detection ..."),await async function(){if("granted"===await h())if(c)e.debug("Idle detection already ON");else try{s=new IdleDetector,s.addEventListener("change",(()=>{const t=s.userState,i=s.screenState;e.debug("Idle: user="+t+" screen="+i),v("locked"===i&&"idle"!==t?{idle:!0,startDate:new Date}:"idle"===t?{idle:!0,startDate:new Date-n}:{idle:!1,startDate:null})})),await s.start({threshold:n||t}),c=!0,e.debug("Idle detection ON")}catch(t){e.debug("Idle detector error "+t)}else e.info("Idle detection OFF: "+r)}()),window.removeEventListener("click",E)}return{startIdleDetection:function(r=t,s=1e3,c){if(window.__karma__||!0===navigator.webdriver)return e.warn("IdleDetector disabled for ODT");try{if(!IdleDetector)return e.warn("IdleDetector not supported by your browser")}catch(t){return e.warn("IdleDetector not supported by your browser")}"number"==typeof r&&(n=r>6e4?r:6e4),e.debug("Idle threshold set to (ms): "+r),i="number"==typeof s?s:1e3,e.debug("Idle events threshold set to (ms): "+i),"function"==typeof c&&(o=c),window.addEventListener("click",E)}}})),define("DS/RTDriver/RTSocketIdentifier",["DS/RTProxyDriver/RTLogger"],(function(e){const t=/\btyp\shost\b/i,n=/(?:[0-9]{1,3}\.){3}[0-9]{1,3}/gi,i=/(?:[0-9]{1,3}\.){3}[0-9]{1,3}|[a-zA-Z0-9-]+\.local/gi;return{getSocketIdentifier:async function(o){if(!o)throw new Error("[getSocketIdentifier] Error: No ice servers");let r=await async function(o){globalThis.RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;const r=new Set,s=function(e){if(e&&e.candidate&&"host"===e.candidate.type)r.add(e.candidate.address);else if(e&&e.candidate&&e.candidate.candidate){const n=e.candidate.candidate;if(n.match(t)){const e=n.match(i),t=e&&e[0];t&&r.add(t)}}};return new Promise(((t,i)=>{try{const c=new RTCPeerConnection({iceServers:o});c.onicecandidate=s,c.createDataChannel(""),c.createOffer().then((e=>{c.setLocalDescription(e)}),i),setTimeout((()=>{c.close();const i=[...r];e.debug("Ice candidate IPs: "+i),t(i.find((e=>n.test(e)))||i[0])}),3e3)}catch(e){i(e)}}))}(o);return r&&(r=await async function(t){const n=(new TextEncoder).encode(t),i=await crypto.subtle.digest("SHA-256",n),o=Array.from(new Uint8Array(i)).map((e=>e.toString(16).padStart(2,"0"))).join("");return e.debug("Socket Identifier: "+o),o}(r)),r},getNavigator:function(e){let t="",n=!1;return window.chrome&&(t="Google Chrome"),e.includes("Firefox")?t="Firefox":e.includes("OPR")?t="Opera":e.includes("Edg")?t="Microsoft Edge":e.includes("Safari")&&!e.includes("Chrome")?t="Safari":(window.ds&&"MOBILE"===window.ds.env||window.top&&window.top.ds&&"MOBILE"===window.top.ds.env)&&(t="DesktopApp"),n=e.includes("Mobile"),{browser:t,isMobile:n}}}})),define("DS/RTDriver/RTUserStatus",[],(function(){"use strict";return{Online:"Online",Busy:"Busy",DND:"DND",Away:"Away",Offline:"Offline",OOO:"OOO"}})),define("DS/RTDriver/RTDriver",["UWA/Class","UWA/Class/Events","DS/RTProxyDriver/RTProxyDriver","DS/RTDriver/RTUserStatus","DS/RTProxyDriver/RTLogger"],(function(e,t,n,i,o){"use strict";return o.debug("RTDriver load"),e.extend(t,{init:function(e){var t=this;this.driver=void 0,this.jid=e.credentials.jid,this.options=e,this.driverName=e.driverName,o.debug("RTDriver Require : "+e.driverName),require(["DS/RTDriver/drivers/"+e.driverName],(function(i){o.info("RTDriver driver "+e.driverName+" loaded"),t.driver=new i(e),t.driver&&(n.dispatch(n.eventName.GETSTATUSLIST,[t.getListOfStatus()]),t.connect())}))},connect:function(){var e=this;o.debug("RTDriver login"),this.driver&&(this.driver.addEvent(n.eventName.CONNECTED,(function(e){o.debug("RTDriver CONNECTED"),n.dispatch(n.eventName.CONNECTED,e)})),this.driver.addEvent(n.eventName.SIGNOUT,(function(e){n.dispatch(n.eventName.SIGNOUT,e)})),this.driver.addEvent(n.eventName.RESULTOFSEARCH,(function(e){o.debug("RTDriver RESULTOFSEARCH"),n.dispatch(n.eventName.RESULTOFSEARCH,[e])})),this.driver.addEvent(n.eventName.RESULTOFSEARCHFORSEARCHAPI,(function(e){o.debug("RTDriver RESULTOFSEARCHFORSEARCHAPI"),n.dispatch(n.eventName.RESULTOFSEARCHFORSEARCHAPI,[e])})),this.driver.addEvent(n.eventName.ONPRESENCERECEIVED,(function(e){o.debug("RTDriver ONPRESENCERECEIVED"),n.dispatch(n.eventName.ONPRESENCERECEIVED,[e])})),this.driver.addEvent(n.eventName.STATUSUPDATED,(function(e){o.debug("RTDriver STATUSUPDATED"),n.dispatch(n.eventName.STATUSUPDATED,[e])})),this.driver.addEvent(n.eventName.ONMESSAGERECEIVED,(function(e){o.debug("RTDriver ONMESSAGERECEIVED"),n.dispatch(n.eventName.ONMESSAGERECEIVED,e)})),this.driver.addEvent(n.eventName.ONARCHIVERECEIVED,(function(e){o.debug("RTDriver ONARCHIVERECEIVED"),n.dispatch(n.eventName.ONARCHIVERECEIVED,e)})),this.driver.addEvent(n.eventName.ONDATARECEIVED,(function(e){o.debug("RTDriver ONDATARECEIVED"),n.dispatch(n.eventName.ONDATARECEIVED,e)})),this.driver.addEvent(n.eventName.DISCONNECTED,(function(e){o.debug("RTDriver DISCONNECTED"),n.dispatch(n.eventName.DISCONNECTED,e)})),this.driver.addEvent("mediaSourceReady",(function(e){o.debug("RTDriver mediaSourceReady"),n.dispatch("mediaSourceReady",e)})),this.driver.addEvent("start-streaming",(function(e){o.debug("RTDriver start-streaming"),n.dispatch("start-streaming",e)})),this.driver.addEvent("connectTelWS",(function(e){o.debug("RTDriver connectTelWS"),n.dispatch("connectTelWS",e)})),n.addEvent("coreview",(function(t){e.driver.coreview(t)})),n.addEvent(n.eventName.LOGOUT,(function(t){"XMPP"===e.driverName&&e.closeSession(),e.logout()})),n.addEvent(n.eventName.CLOSESESSION,(function(t){e.closeSession()})),n.addEvent(n.eventName.SENDMSG,(function(t){e.sendMessage(t)})),n.addEvent(n.eventName.SENDDATA,(function(t){e.sendData(t)})),n.addEvent(n.eventName.SENDSYSMSG,(function(t){e.sendSystemMsg(t)})),n.addEvent(n.eventName.SENDNOTIF,(function(t){e.sendNotif(t)})),n.addEvent(n.eventName.GETSTATUS,(function(t){e.getStatus(t)})),n.addEvent(n.eventName.GETALLSTATUS,(function(t){e.getAllStatus(t)})),n.addEvent(n.eventName.SETSTATUS,(function(t){e.setMyStatus(t.myStatus,t.statusMsg)})),n.addEvent("GETROOM",(function(t){e.getRoom(t)})),n.addEvent("JOINROOM",(function(t){e.joinRoom(t)})),n.addEvent("LEAVEROOM",(function(t){e.leaveRoom(t)})),n.addEvent(n.eventName.SEARCHCONTACT,(function(t){e.searchContact(t)})),n.addEvent("discover",(function(t){e.discover(t)})),n.addEvent("startCall",(function(t){e.startCall(t)})),n.addEvent("webrtcIceCandidate",(function(t){e.webrtcIceCandidate(t)})),n.addEvent("SDP",(function(t){e.SDP(t)})),n.addEvent("endCall",(function(t){e.endCall(t)})),n.addEvent("acceptCall",(function(t){e.acceptCall(t)})),n.addEvent("callEventFromView",(function(t){e.driver.onCallEventFromView(t)})),n.addEvent("sendSocketIdentifier",(function(t){e.sendSocketIdentifier(t)})),n.addEvent("setIdlePresence",(function(t){e.setIdlePresence(t)})),n.addEvent("getStrategy",(function(t){e.getStrategy(t)})),this.driver.addEvent("inviteSent",(function(e){n.dispatch("inviteSent",e)})),this.driver.addEvent("callEvent",(function(e){n.dispatch("callEvent",e)})),this.driver.addEvent("inviteToCall",(function(e){n.dispatch("inviteToCall",e)})),this.driver.addEvent("callEnded",(function(e){n.dispatch("callEnded",e)})),this.driver.addEvent("callAccepted",(function(e){n.dispatch("callAccepted",e)})),this.driver.addEvent("webrtcIceCandidateReceived",(function(e){n.dispatch("webrtcIceCandidateReceived",e)})),this.driver.addEvent("SDPreceived",(function(e){n.dispatch("SDPreceived",e)})),this.driver.addEvent("getSocketIdentifier",(function(e){n.dispatch("getSocketIdentifier",e)})),this.driver.addEvent("isElectedSocket",(function(e){n.dispatch("isElectedSocket",e)})),this.driver.addEvent("setStrategy",(function(e){n.dispatch("setStrategy",e)})),this.driver.addEvent("ROOM",(function(e){n.dispatch("ROOM",e)})),this.driver.addEvent("COREVIEW",(function(e){n.dispatch("COREVIEW",e)})),this.driver.addEvent("roomLeft",(function(e){n.dispatch("onLeaveRoom",e)})),this.driver.addEvent("roomJoined",(function(e){n.dispatch("onJoinRoom",e)})),this.driver.addEvent("miscellaneous",(function(e){n.dispatch("miscellaneous",e)})),this.driver.addEvent("discovered",(function(e){n.dispatch("discovered",e)})),this.driver.addEvent("callInfo",(function(e){n.dispatch("callInfo",e)})),this.driver.addEvent("callHistory",(function(e){n.dispatch("callHistory",e)})),this.driver.addEvent("convInfo",(function(e){n.dispatch("convInfo",e)})),n.addEvent("getCallInfo",(function(t){e.driver.getCallInfo(t)})),n.addEvent("subConv",(function(t){e.driver.subConv(t)})),n.addEvent("IAmTyping",(function(t){e.driver.IAmTyping(t)})),n.addEvent("getRoomInfos",(function(t){e.driver.getRoomInfos(t)})),n.addEvent("UPDATEROOM",(function(t){e.driver.updateRoom(t)})),n.addEvent("JOINPUBLICROOM",(function(t){e.driver.joinPublicRoom(t)})),n.addEvent("sipEvent",(function(t){e.driver.sipEvent(t)})),n.addEvent("toRTC",(function(t){e.driver.conversationEvent(t)})),n.addEvent("getRouterRtpCapabilities",(function(t){e.getRouterRtpCapabilities(t)})),n.addEvent("clientRtpCapabilities",(function(t){e.clientRtpCapabilities(t)})),n.addEvent("connectTransport",(function(t){e.connectTransport(t)})),n.addEvent("producer",(function(t){e.producer(t)})),n.addEvent("consumer",(function(t){e.consumer(t)})),this.driver.addEvent("routerRtpCapabilities",(function(e){n.dispatch("routerRtpCapabilities",e)})),this.driver.addEvent("webrtcTransportCreated",(function(e){n.dispatch("webrtcTransportCreated",e)})),this.driver.addEvent("gotNewProducer",(function(e){n.dispatch("gotNewProducer",e)})),this.driver.addEvent("consumerCreated",(function(e){n.dispatch("consumerCreated",e)})),this.driver.addEvent("consumerClosed",(function(e){n.dispatch("consumerClosed",e)})),this.driver.addEvent("consumerPaused",(function(e){n.dispatch("consumerPaused",e)})),this.driver.addEvent("consumerResumed",(function(e){n.dispatch("consumerResumed",e)})),this.driver.addEvent("newMediasoupUser",(function(e){n.dispatch("newMediasoupUser",e)})),this.driver.addEvent("mediasoupUserLeft",(function(e){n.dispatch("mediasoupUserLeft",e)})),this.driver.addEvent("conversation",(function(e){n.dispatch("conversation",e)})),n.addEvent("aiaiToRTC",(function(t){e.driver.aiaiEvent(t)})),this.driver.addEvent("rtcToAiai",(function(e){n.dispatch("rtcToAiai",e)})),n.addEvent("callToRTC",(function(t){e.driver.callEvent(t)})),n.addEvent("sendAlert",(function(t){e.sendAlert(t)})),n.addEvent("sendAlertRemoved",(function(t){e.sendAlertRemoved(t)})),n.addEvent("sendFinalReportCall",(function(t){e.sendFinalReportCall(t)})),this.driver.addEvent("call",(function(e){n.dispatch("call",e)})),this.driver.addEvent("desktopApp",(function(e){n.dispatch("desktopApp",e)})),this.driver.login())},startCall:function(e){this.driver.startCall(e)},endCall:function(e){this.driver.endCall(e)},acceptCall:function(e){this.driver.acceptCall(e)},webrtcIceCandidate:function(e){this.driver.webrtcIceCandidate(e)},SDP:function(e){this.driver.SDP(e)},sendData:function(e){e.from=this.jid,this.driver.sendData(e)},sendMessage:function(e){var t={};t.msg=e,t.from=this.jid,this.driver.sendMessage(t)},sendSystemMsg:function(e){e.from=this.jid,this.driver.sendSystemMsg(e)},sendNotif:function(e){e.from=this.jid,this.driver.sendNotif(e)},getStatus:function(e){this.driver.getStatus(e)},getAllStatus:function(e){this.driver.getAllStatus(e)},setMyStatus:function(e,t){this.driver.setPresence(e,t)},searchContact:function(e){this.driver.searchContact(e)},sendSocketIdentifier:function(e){this.driver.sendSocketIdentifier(e)},setIdlePresence:function(e){this.driver.setIdlePresence(e)},getStrategy:function(e){this.driver.getStrategy(e)},getRouterRtpCapabilities:function(e){this.driver.getRouterRtpCapabilities(e)},clientRtpCapabilities:function(e){this.driver.clientRtpCapabilities(e)},connectTransport:async function(e){this.driver.connectTransport(e)},producer:function(e){this.driver.producer(e)},consumer:function(e){this.driver.consumer(e)},logout:function(){this.driver.logout(),n.removeEvent(n.eventName.SENDMSG),n.removeEvent(n.eventName.SEARCHCONTACT),n.removeEvent(n.eventName.GETARCHIVES),n.removeEvent(n.eventName.RENAMEGROUP),n.removeEvent(n.eventName.SENDDATA),n.removeEvent(n.eventName.SENDDATA),n.removeEvent("startCall"),n.removeEvent("webrtcIceCandidate"),n.removeEvent("SDP"),n.removeEvent("endCall"),n.removeEvent("acceptCall")},closeSession:function(){this.driver.setPresence(i.Offline,i.Offline)},getListOfStatus:function(){return i},getRoom:function(e){this.driver.getRoom(e)},joinRoom:function(e){this.driver.joinRoom(e)},leaveRoom:function(e){this.driver.leaveRoom(e)},discover:function(e){this.driver.discover(e)},sendAlert:function(e){this.driver.sendAlert(e)},sendAlertRemoved:function(e){this.driver.sendAlertRemoved(e)},sendFinalReportCall:function(e){this.driver.sendFinalReportCall(e)}})})),define("DS/RTDriver/RTUser",["UWA/Class","UWA/Class/Events","DS/RTProxyDriver/RTLogger","DS/RTDriver/RTUserStatus"],(function(e,t,n,i){"use strict";return n.debug("3DIM - RTUser load"),e.extend(t,{init:function(e){this.userId=e.userId,this.userName=void 0===e.userName?this.userId:e.userName,this.status=i.Offline,e.status&&(this.status=i[e.status]?i[e.status]:i.Offline)},getId:function(){return this.userId},getName:function(){return this.userName},setStatus:function(e){this.status=e},getStatus:function(){return this.status}})})),define("DS/RTDriver/drivers/NODE",["UWA/Class","UWA/Class/Events","DS/RTDriver/RTUser","DS/RTDriver/RTDetectClient","DS/WAFData/WAFData","DS/PlatformAPI/PlatformAPI","DS/DSNodeSocketioClient_4.7.4/DSNodeSocketioClient_4.7.4","DS/RTProxyDriver/RTLogger","DS/i3DXCompassPlatformServices/i3DXCompassRegistryClient","DS/Usage/TrackerAPI","DS/RTDriver/RTSocketIdentifier","DS/RTDriver/RTIdleDetector"],(function(e,t,n,i,o,r,s,c,a,d,u,l){"use strict";c.addLevel("nodeDriver","green"),c.nodeDriver("driver nodejs load 7/18/2019");var v=void 0;let h,E,f=0;const p=crypto&&"function"==typeof crypto.randomUUID&&crypto.randomUUID()||UWA.Utils.getUUID(),m=e=>{try{c.nodeDriver("Analytics event : "+JSON.stringify(e)),d.trackPageEvent(e)}catch(e){c.nodeDriver("Analytics event request failed : "+e)}},S=(e,t,n)=>{const i={eventCategory:"collaboration.manager",eventAction:"websocketConnection",eventLabel:"Websocket connection time in milliseconds",eventValue:e,persVal:{pv1:t},persDim:{pd2:n?"failure":"success",pd4:p},appID:"X3DIMSG_AP"};if(n){const e=n.message?(n.type?n.type+": ":"")+n.message:n.toString();i.persDim.pd1=e,e.match(/timeout/i)?i.persDim.pd3="timeout":e.match(/socket error/i)?i.persDim.pd3="websocket error":i.persDim.pd3="other"}m(i)};return e.extend(t,{init:function(e){c.nodeDriver("init");const t=r.getApplicationConfiguration("app.swymfeature.activateRTC");this.rtconv=""===t||"true"===t||!0===t||UWA&&UWA.Utils&&"true"==UWA.Utils.getQueryString(document.URL,"rtconv")||location&&location.href&&location.href.includes("rtconv"),this.MAX_CONNECTION_TRIES=10,this.latency=null,this.latencyRegion=null,this.latencyConfig={india:200,usEast:85,usWest:155,singapore:215,southKorea:240},this.setLatency(document.RTCFakeLatencyRegion,document.RTCFakeLatency),r.subscribe("fromDesktopApp.ds.com",this.handlerReconnect.bind(this)),r.subscribe("reliveWebsocket.im.ds.com",this.checkSocketStatus.bind(this));var n=e.url.replace(":5281",":443").replace("/rest","").replace(":443:443",":443");if(n.indexOf("://")>-1){var i=n.split("/");n=-1==i[2].indexOf(":")?i[2]+":443":i[2]}this.url=n,this.credentials=e.credentials,this.start_time=void 0,this.sid=e.sid,this.domaineName=e.domaineName,this.myStatus=void 0,this.username=e.username,this.webSocket={},this.devEnv=e.devEnv,this.passportUrl=e.passportUrl,this.passportUrlAtInit=e.passportUrl,this.connection=void 0,this.loginsToSub=[],this.blockPopup=!1,v=this,document.RTCManager&&(document.RTCManager.driver=this),this.RANDOM_DELAY=Math.floor(10*Math.random()),this.DELAY_TIME=10,this.DELAY_INCREMENT=0,this.DELAY_MAX=36e5,this.DELAY_429=3e5,this.USE_RETRY=!0,this.IN_RETRY=!1,this.IS_LOGINOK=!1,this.retryTimeOut=null,this.listenNetworkEvent(),this.listenVisibilityEvent()},setLatency(e,t){this.latency=t||e&&this.latencyConfig[e],"number"!=typeof this.latency&&(this.latency=0),e&&(this.latencyRegion=e)},simulateLatency(e,t){if(!t)return console.error("RTC simulateLatency - No callback.");e?(c.nodeDriver("RTC event delayed with a fake latency of (ms)"+e),setTimeout((()=>{t()}),e/2)):(console.error("RTC simulateLatency - Region not configured for latency simulation."),t())},handlerReconnect:function(e){if(e&&"rtc"===e.socket)if(e.checkSocketStatus)this.dispatchEventToApp("socketStatus",{isConnected:this.webSocket&&this.webSocket.connected,authenticated:this.IS_LOGINOK});else if(e.forceSocketReconnect){this.USE_RETRY||(this.USE_RETRY=!0),this.checkSocketStatus(!0)?this.dispatchEventToApp("socketReconnect",{inRetry:this.IN_RETRY,isConnected:this.webSocket&&this.webSocket.connected,authenticated:this.IS_LOGINOK,retryCount:f}):this.dispatchEventToApp("socketReconnect",{inRetry:this.IN_RETRY,isConnected:this.webSocket&&this.webSocket.connected,authenticated:this.IS_LOGINOK})}},dispatchEventToApp:function(e,t){r.publish("toDesktopApp.ds.com",{type:"SocketMonitorEvent",payload:{event:e,data:t,socket:"rtc"}})},listenVisibilityEvent:function(){var e,t;void 0!==document.hidden?(e="hidden",t="visibilitychange"):void 0!==document.msHidden?(e="msHidden",t="msvisibilitychange"):void 0!==document.webkitHidden&&(e="webkitHidden",t="webkitvisibilitychange"),void 0===document.addEventListener||void 0===e?c.nodeDriver("RTC Node requires a browser that supports the Page Visibility API."):document.addEventListener(t,(function(e){document.hidden||(v.IN_RETRY?c.nodeDriver("RTC Node visible but in retry process."):v.DELAY_INCREMENT=0,v.checkSocketStatus())}))},listenNetworkEvent:function(){this.USE_RETRY&&(window.addEventListener("online",this.checkSocketStatus.bind(this)),window.addEventListener("offline",this.checkSocketStatus.bind(this)))},removeNetworkEvent:function(){window.removeEventListener("online",this.checkSocketStatus.bind(this)),window.removeEventListener("offline",this.checkSocketStatus.bind(this))},alertRetryEvent:function(e){if(document&&document.IMCall)try{c.nodeDriver(e)}catch(e){}},checkSocketStatus:function(e){setTimeout((()=>{this.checkSocketStatus_delayed(e)}),this.RANDOM_DELAY)},checkSocketStatus_delayed:function(e){const t=!0===e;return c.nodeDriver("RTC NODE checkSocketStatus use retry "+v.USE_RETRY),!!v.USE_RETRY&&(navigator.onLine?(v.webSocket&&v.webSocket.disconnected?v.IN_RETRY?t?(v.login(),c.nodeDriver("RTC NODE retry process force reconnect socket.")):c.nodeDriver("RTC NODE already in retry process!"):(v.alertRetryEvent("alert_reconnectOngoing"),v.IN_RETRY=!0,v.webSocket.io.reconnection(!0),f++,h=(new Date).getTime(),v.webSocket.connect(),c.nodeDriver("RTC NODE retry process connect socket.")):v.webSocket&&v.webSocket.connected?t&&!v.IS_LOGINOK?(v.IN_RETRY=!0,v.webSocket.io.reconnection(!1),v.webSocket.disconnect(),v.login(),c.nodeDriver("RTC NODE retry process force reconnect socket.")):v.IS_LOGINOK?c.nodeDriver("RTC NODE checkSocketStatus terminated (maybe KO)!!!"):(v.IN_RETRY=!0,v.getServiceTicket(!0)):!v.webSocket&&t&&(v.alertRetryEvent("alert_reconnectOngoing"),v.login(),c.nodeDriver("RTC NODE need to do whole login again!")),!0):(v.webSocket&&(!v.webSocket.connected&&v.webSocket.disconnected||(c.nodeDriver("RTC NODE need to disconnect socket before retry."),v.webSocket.io.reconnection(!1),v.webSocket.disconnect())),v.dispatchEvent("DISCONNECTED"),v.IN_RETRY=!1,v.alertRetryEvent("alert_connexionNetworkLost"),c.nodeDriver("RTC NODE no network!"),!1))},postponeReconnect:function(e){return"boolean"==typeof e.USE_RETRY?(v.USE_RETRY=e.USE_RETRY,!0):(e.delay||(e.delay=1e3*(60*Math.floor(5*Math.random()+1)*60+v.RANDOM_DELAY)),v.DELAY_MAX+=e.delay,v.DELAY_TIME=e.delay,c.nodeDriver("postponeReconnect to "+e.delay))},setRetryDelay:function(e){if(!v.USE_RETRY)return e(!1);c.nodeDriver("RTC NODE will set retry with increment..."),v.DELAY_INCREMENT+=5;const t=1e3*(v.DELAY_INCREMENT*v.DELAY_TIME+v.RANDOM_DELAY);t<v.DELAY_MAX?(c.nodeDriver("RTC NODE set retry. Should wait for: "+t),v.alertRetryEvent("alert_reconnectOngoing"),v.retryTimeOut=setTimeout((function(){e&&e(!0)}),t)):(c.nodeDriver("RTC NODE do not set retry. Max delay exceeded: "+t),e&&e(!1))},tryLogin:function(e){c.nodeDriver("login user "+this.credentials.jid+" on tenant "+this.domaineName+"/rtconv="+this.rtconv),this.tryConnect(e)},tryConnect:function(e){try{if(this.webSocket&&this.webSocket.disconnect&&(v.webSocket.io.reconnection(!1),this.webSocket.disconnect(),delete this.webSocket),this.io=e,this.connectionParams={path:this.devEnv?"/socket.io":this.rtconv?"/socketio.conv":"/socketio.rtc",forceNew:!0,reconnection:!0,reconnectionDelay:1e3*(1+this.RANDOM_DELAY),reconnectionDelayMax:this.MAX_CONNECTION_TRIES*this.RANDOM_DELAY*1e3,reconnectionAttempts:this.MAX_CONNECTION_TRIES,timeout:15e3,transports:["websocket"]},this.url&&(this.url=this.url.replace(/^https?:\/\//,""),this.url.startsWith("wss://")||(this.url="wss://"+this.url)),h=(new Date).getTime(),this.webSocket=e.connect(this.url,this.connectionParams),this.devEnv&&(document.webSocket=this.webSocket),v=this,this.webSocket){if(isNaN(this.MAX_CONNECTION_TRIES))return c.nodeDriver("MAX_CONNECTION_TRIES is not a number");this.webSocket.io.reconnectionAttempts(this.MAX_CONNECTION_TRIES),this.webSocket.io.reconnectionDelayMax(this.MAX_CONNECTION_TRIES*this.RANDOM_DELAY*1e3);var t,n={presence:v.onPresenceChanged,search:v.onSearchReceived,data:v.onDataReceived,roomInfos:v.roomInfosReceived,userInfo:v.userInfoReceived,sendScreen:v.onScreenReceived,stream:v.onStreamReceived,"3dimError":function(e){var t=e&&e.error?e.error:e;c.nodeDriver("3DIM [ERROR] "),c.nodeDriver(t)},loginOK:v.onLoginOK,loginKO:v.onLoginKO,getSocketIdentifier:v.onGetSocketIdentifier,isElectedSocket:v.onIsElectedSocket,setStrategy:v.onSetStrategy,connectionOK:function(){},room:v.onRoomReceived,disconnect:v.onDisconnect,leaveroom:v.onLeaveRoom,joinroom:v.onJoinRoom,miscellaneous:v.onSpecialEvent,connect_timeout:v.onConnectError,reconnect:v.onConnectError,reconnecting:v.onConnectError,reconnect_attempt:v.onReConnectAttempt,reconnect_error:v.onConnectError,reconnect_failed:v.onConnectError,connect_error:v.onConnectError,inviteSent:v.onInviteSent,inviteToCall:v.onInviteToCall,callEnded:v.onCallEnded,callAccepted:v.onCallAccepted,webrtcIceCandidate:v.onWebRTCIceCandidate,SDPreceived:v.onSDPreceived,callEvent:v.onCallEvent,callInfo:v.onCallInfo,convInfo:v.onConvInfo,coreview:v.onCoreview,discovered:v.onDiscover,goTo:v.goTo,conversation:v.onConversation,call:v.onCall,rtcToAiai:v.onAiai,desktopApp:v.onDesktopApp,postponeReconnect:v.postponeReconnect,routerRtpCapabilities:v.onRouterRtpCapabilities,webrtcTransportCreated:v.onWebrtcTransportCreated,gotNewProducer:v.onGotNewProducer,consumerCreated:v.onConsumerCreated,consumerClosed:v.onConsumerClosed,consumerPaused:v.onConsumerPaused,consumerResumed:v.onConsumerResumed,newMediasoupUser:v.onNewMediasoupUser,mediasoupUserLeft:v.onMediasoupUserLeft};for(t in n)this.webSocket.on(t,function(e){return function(t){c.nodeDriver("[EVENT RECEIVED] "+e+" [DATA] "+JSON.stringify(t)),c.nodeDriver(t),"function"==typeof n[e]?v.latency?v.simulateLatency(v.latency,(()=>{n[e](t)})):n[e](t):c.nodeDriver("An event is not associated with a function : "+e)}}(t));this.webSocket.io.on("error",(e=>{if(h){const t=(new Date).getTime()-h;S(t,f,e),h=null}v.IN_RETRY=!1,v.dispatchEventToApp("socketError",{inRetry:v.IN_RETRY,isConnected:v.webSocket&&v.webSocket.connected,authenticated:v.IS_LOGINOK,error:e,retryCount:f})})),this.webSocket.on("connect",(function(e){if(h){const e=(new Date).getTime()-h;S(e,f),f=0,h=null}E=(new Date).getTime(),c.nodeDriver("RTC Node connected to server, now trying to login. "+e+" if retry: "+v.IN_RETRY),v.IS_LOGINOK=!1,v.getServiceTicket(!0),v.IN_RETRY&&v.alertRetryEvent("alert_connexionRetrieved"),v.IN_RETRY=!1}))}}catch(e){c.nodeDriver("error login: "+e)}},login:function(){this.tryLogin(s)},getServiceTicket:function(e,t){if(c.nodeDriver("getServiceTicket "),this.passportUrl||(this.passportUrl=r.getApplicationConfiguration("app.urls.passport")),!this.passportUrl)return e&&this.serverLogin(),c.error("NodeDriver has no passportUrl set");var n=this;function i(t){!t&&c.nodeDriver("passportUrl retrieved failbacked to "+n.passportUrl);var i=t||n.passportUrl;if(!i||!n.domaineName||-1==!i.toLowerCase().indexOf(n.domaineName.toLowerCase())){const e="passportUrl is not tenant-aware. passportUrlAtInit="+passportUrlAtInit+"; passportRegistryUrl="+t+"; domaineName"+n.domaineName+"; app.urls.passport="+r.getApplicationConfiguration("app.urls.passport");c.nodeDriver(e),m({eventCategory:"collaboration.manager",eventAction:"getServiceTicket",eventLabel:"getServiceTicket",eventValue:0,persDim:{pd1:e},appID:"X3DIMSG_AP"})}var s=i+"/login?service=3DSIM",a=function(t){try{if(c.nodeDriver("Retrieved from PASSPORT : "+JSON.stringify(t)),!t)throw new Error("no answer from Passport");t.access_token?n.credentials.password=t.access_token:n.credentials.password=JSON.parse(t).access_token}catch(e){return n.IN_RETRY=!1,n.dispatchEventToApp("socketError",{inRetry:n.IN_RETRY,isConnected:n.webSocket&&n.webSocket.connected,authenticated:n.IS_LOGINOK,error:"Authenticaion request failed: "+e,retryCount:f}),console.error(e)}e&&n.serverLogin()},d={type:"json",onComplete:a,onFailure:function(e){i===n.passportUrl?(n.IN_RETRY=!1,n.dispatchEventToApp("socketError",{inRetry:n.IN_RETRY,isConnected:n.webSocket&&n.webSocket.connected,authenticated:n.IS_LOGINOK,error:"Authenticaion request failed",retryCount:f}),c.nodeDriver(e)):o.authenticatedRequest(n.passportUrl,d)},onTimeout:function(e){n.IN_RETRY=!1,n.dispatchEventToApp("socketError",{inRetry:n.IN_RETRY,isConnected:n.webSocket&&n.webSocket.connected,authenticated:n.IS_LOGINOK,error:"Authenticaion request timeout",retryCount:f}),c.nodeDriver(e)}};if(n.devEnv)return a('{"access_token":"osef"}');o.authenticatedRequest(s,d)}r.getApplicationConfiguration("app.urls.registry")&&n.domaineName?a.getServicesByPlatform({services:["3DPassport"],platforms:[n.domaineName],config:{url:r.getApplicationConfiguration("app.urls.registry")}}).then((e=>{let t;e&&e.length>0&&e[0].id&&e[0].id.toLowerCase()===n.domaineName.toLowerCase()&&e[0].services&&e[0].services.length>0&&e[0].services[0].id&&"3dpassport"===e[0].services[0].id.toLowerCase()&&(t=e[0].services[0].url),c.nodeDriver("passportUrl retrieved from Registry "+t),i(t)}),(function(){i()})):i()},serverLogin:function(){this.webSocket.emit("login",{login:this.credentials.jid,username:this.username,st:this.devEnv?"osef":this.credentials.password,tenant:this.domaineName,clientDevice:i.getClientInfos(),bypassGroups:!0,bypassUnreadMessages:!0})},sendSocketIdentifier:async function(e){this.webSocket&&this.webSocket.emit("sendSocketIdentifier",e)},setIdlePresence:async function(e){v.webSocket&&v.webSocket.emit("setIdlePresence",e)},getStrategy:async function(e){this.webSocket&&this.webSocket.emit("getStrategy",e)},getRouterRtpCapabilities:function(e){this.webSocket&&this.webSocket.emit("getRouterRtpCapabilities",e)},clientRtpCapabilities:function(e){this.webSocket&&this.webSocket.emit("clientRtpCapabilities",e)},connectTransport:async function(e){if(this.webSocket){const{callback:t,errback:n,...i}=e;await this.webSocket.emit("connectTransport",i,(function({success:e}){e?t():n()}))}},producer:async function(e){if(this.webSocket)if(e&&"createProducer"===e.action){const{callback:t,errback:n,...i}=e;await this.webSocket.emit("producer",i,(function({success:e,id:i}){e?t({id:i}):n()}))}else this.webSocket.emit("producer",e)},consumer:async function(e){this.webSocket&&this.webSocket.emit("consumer",e)},onReConnectAttempt:function(e){return isNaN(e)?c.nodeDriver("socket io onReConnectAttempt arg is not a number !"):!(!v.webSocket||!v.webSocket.io)&&(v.webSocket.io.reconnectionDelay(1e3*(e+v.RANDOM_DELAY)),c.nodeDriver("RTC NODE "+e+" tries to connect to RTC server have occured, the reconnection delay has been raised to "+e+"s"),void(e>=v.MAX_CONNECTION_TRIES&&v.setRetryDelay((function(e){c.nodeDriver("RTC NODE max tries quantity have been reached."),e?(c.nodeDriver("RTC NODE max tries duration not reached. Retry ongoing: "+v.webSocket.connected),v.webSocket.connected||v.webSocket.disconnect()):(c.nodeDriver("RTC NODE max tries duration have been reached. Stopping connection attempts"),v.IN_RETRY=!1,v.webSocket.io.reconnection(!1),v.webSocket.close())}))))},onConnectError:function(e){c.nodeDriver("generic connection handler raised"),v.IS_LOGINOK=!1,(e?.message?.includes("429")||429===e?.description?.status)&&(console.warn("3DCollaboration connection throttled, postponing reconnection attempt to 5minutes"),v.postponeReconnect(v.DELAY_429),v.webSocket.io.reconnectionDelay(v.DELAY_429))},onLoginOK:function(e){c.nodeDriver("loginOK !");var t={userId:e.user.login,username:e.user.username,user_id:e.user.user_id,status:e.user.presence.show,autoSet:e.user.presence.autoSet,additionalLabels:e.user.presence.additionalLabels,startDate:e.user.presence.startDate,endDate:e.user.presence.endDate,data:e,clientDevice:i.getClientInfos()};v.dispatchEvent("CONNECTED",[t]),v.IS_LOGINOK=!0,v.IN_RETRY=!1,v.dispatchEventToApp("socketStatus",{inRetry:v.IN_RETRY,isConnected:v.webSocket&&v.webSocket.connected,authenticated:v.IS_LOGINOK});const{browser:n}=u.getNavigator(t.clientDevice.userAgent);"DesktopApp"===n&&l.startIdleDetection(e.idleThreshold,e.minTimeBetweenTwoIdleEvents,v.setIdlePresence)},onGetSocketIdentifier:async function(e){let t=await u.getSocketIdentifier(e&&e.iceServers).catch((e=>{c.warn("getSocketIdentifier Error: "+e)}));const{userAgent:n,plateform:o,isIOS:r,isMac:s,WebRTCCompatible:a}=i.getClientInfos(),d={socketIdentifier:t,navigator:{...u.getNavigator(n),plateform:o,isIOS:r,isMac:s,WebRTCCompatible:a},notificationPermission:window.Notification&&window.Notification.permission};v.dispatchEvent("getSocketIdentifier",[d]),v.sendSocketIdentifier(d)},onIsElectedSocket:async function(e){v.dispatchEvent("isElectedSocket",[e])},onSetStrategy:async function(e){v.dispatchEvent("setStrategy",[e])},onLoginKO:function(e){v.IS_LOGINOK=!1,v.IN_RETRY=!1,v.dispatchEventToApp("socketStatus",{inRetry:v.IN_RETRY,isConnected:v.webSocket&&v.webSocket.connected,authenticated:v.IS_LOGINOK}),c.nodeDriver("loginKO : "+JSON.stringify(e))},roomInfosReceived:function(e){c.nodeDriver("roomInfosReceived : "),v.dispatchEvent("ROOMINFOSRECEIVED",[e])},userInfoReceived:function(e){c.nodeDriver("userInfoReceived : "),v.dispatchEvent("USERINFOSRECEIVED",[e])},getUserInfo:function(e){c.nodeDriver("getUserInfo : "),this.webSocket.emit("getUserInfo",e)},logout:function(){this.users={},this.empty={},this.myStatus=void 0,this.webSocket&&this.webSocket.disconnect(),this.retryTimeOut&&clearTimeout(this.retryTimeOut),this.retryTimeOut=null,this.removeNetworkEvent()},onRoomReceived:function(e){var t=e.room;if(!t||!t.room_id)return c.nodeDriver("onRoomReceived bad args");v.rooms&&v.rooms[t.room_id]||(v.rooms&&v.rooms[t.room_id]||(v.rooms={}),v.rooms[t.room_id]=!0),v.dispatchEvent("ROOM",e)},getRoomInfos:function(e){v.webSocket.emit("getRoomInfos",e.room_id)},getRoom:function(e){v.webSocket.emit("getRoom",e)},joinRoom:function(e){v.webSocket.emit("joinRoom",e)},leaveRoom:function(e){v.webSocket.emit("leaveRoom",e)},sendMessage:function(e){this.webSocket.emit("message",{message:btoa(unescape(encodeURIComponent(e.msg.msg))),room:e.msg.room,uuid:e.msg.uuid})},coreview:function(e){this.webSocket.emit("coreview",e)},onDataReceived:function(e){if(c.nodeDriver("onDataReceived : "+JSON.stringify(e)),!e||!e.author||!e.message)return c.nodeDriver("onDataReceived : bad format received");if("string"==typeof e.message&&-1!=e.message.indexOf("CATRTC"))return!1;var t={to:e.author.login===v.credentials.jid?e.room_id:v.credentials.jid,from:e.author.login,username:e.author.username,typeMsg:e.type,status:e.author&&e.author.presence?e.author.presence.show||"Online":"Offline",where:void 0,activeArchive:!1,login:e.from,data:e.message.data||e.message,typeData:e.message.typeData,message_id:e.message_id,roomId:e.room_id,fileName:e.message.fileName,fileId:e.message.fileId,nbpart:1,numpart:1,origin:e.origin};v.dispatchEvent("ONMESSAGERECEIVED",[t])},onScreenReceived:function(e){var t={to:v.credentials.jid,from:e.from,login:e.from,roomId:e.room,screenData:e.screenData};v.dispatchEvent("ONSCREENRECEIVED",[t])},onStreamReceived:function(e){var t={to:v.credentials.jid,from:e.from,login:e.from,roomId:e.room,stream:e.stream};v.dispatchEvent("ONSTREAMRECEIVED",[t])},onPresenceChanged:function(e){var t={...e,userId:e.login,username:e.username,phone:e.phone||e.uri,login:e.login,user_id:e.user_id||e.id,presence:e.presence.show,status:e.presence.show,autoSet:e.presence.autoSet,additionalLabels:e.presence.additionalLabels,startDate:e.presence.startDate,endDate:e.presence.endDate};v.dispatchEvent("ONPRESENCERECEIVED",[t]),e.login===v.credentials.jid&&(v.blockPopup="DND"===e.presence.show)},onDisconnect:function(e){var t;c.nodeDriver("disconnection : "+e),t=(new Date).getTime()-E,m({eventCategory:"collaboration.manager",eventAction:"websocketDisconnection",eventLabel:"Websocket disconnection",eventValue:t,persDim:{pd1:p},appID:"X3DIMSG_AP"}),v.IS_LOGINOK=!1,v.IN_RETRY=!1;var n={userId:v.credentials.jid,status:"Offline"};v.dispatchEvent("ONPRESENCERECEIVED",[n]),v.dispatchEvent("DISCONNECTED",[{forced:"transport close"===e}]),v.dispatchEventToApp("socketStatus",{inRetry:v.IN_RETRY,isConnected:v.webSocket&&v.webSocket.connected,authenticated:v.IS_LOGINOK})},onSearchReceived:function(e){c.nodeDriver("onSearchReceived : "+e);for(var t=[],i=0;i<e.users.length;i++){var o={userId:e.users[i].login,userName:e.users[i].username,status:e.users[i].presence&&e.users[i].presence.show?e.users[i].presence.show:"Offline"},r=new n(o);t.push(r),v.dispatchEvent("ONPRESENCERECEIVED",[r])}return v.nextSearchIsForShareAPI?(v.dispatchEvent("RESULTOFSEARCHFORSEARCHAPI",[t]),v.nextSearchIsForShareAPI=!1,!0):(v.dispatchEvent("RESULTOFSEARCH",[t]),!0)},setPresence:function(e,t){c.nodeDriver("setPresence : "+e+" - "+t),this.webSocket&&this.webSocket.emit("setPresence",{login:this.credentials.jid,statusMsg:e,show:t})},sendData:function(e){c.nodeDriver("sendData "+e.data);var t=1e4,n=e.data.length,i=Math.floor(n/t);i*t<n&&i++;this.webSocket.emit("data",{from:v.credentials.jid,data:{robotName:e.robotName,typeData:e.typeData,type:"DSRTData",dataSize:n,data:e.data,persisted:e.persisted,accept:e.accept,fileName:e.fileName,fileId:e.fileId,nbpart:"progress"==e.data?e.nbpart:i,numpart:"progress"==e.data?e.numpart:0},room:e.roomId,uuid:e.roomId})},sendStream:function(e){c.nodeDriver("sendData"),this.webSocket.emit("stream",{from:v.credentials.jid,stream:e.stream,room:e.roomId})},getStatus:function(e){this.webSocket&&this.webSocket.emit("getPresence",{from:this.credentials.jid,users:[{login:e.login,to:e.userId}]})},getAllStatus:function(e){this.webSocket&&this.webSocket.emit("getPresence",{from:this.credentials.jid,users:e})},searchContact:function(e){this.webSocket&&this.webSocket.emit("search",{login:this.credentials.jid,text:e,tenant:this.domaineName}),e.isForShareAPI&&(this.nextSearchIsForShareAPI=!0)},auth:function(e){},startCall:function(e){c.nodeDriver("NODE startCall "+JSON.stringify(e)),this.webSocket&&this.webSocket.emit("startCall",e)},endCall:function(e){c.nodeDriver("NODE endCall "+JSON.stringify(e)),this.webSocket&&this.webSocket.emit("endCall",e),this.telwebsocket&&this.telwebsocket.close()},acceptCall:function(e){c.nodeDriver("NODE acceptCall "+JSON.stringify(e)),this.webSocket&&this.webSocket.emit("acceptCall",e)},webrtcIceCandidate:function(e){c.nodeDriver("NODE webrtcIceCandidate "+JSON.stringify(e)),this.webSocket&&this.webSocket.emit("iceCandidate",e)},SDP:function(e){c.nodeDriver("NODE SDP "+JSON.stringify(e)),this.webSocket&&this.webSocket.emit("SDP",e)},onInviteSent:function(e){v.dispatchEvent("inviteSent",[e])},onCallEvent:function(e){v.dispatchEvent("callEvent",[e])},onCallInfo:function(e){v.dispatchEvent("callInfo",[e])},onCallHistory:function(e){v.dispatchEvent("callHistory",[e])},onConvInfo:function(e){v.dispatchEvent("convInfo",[e])},onCallEventFromView:function(e){c.nodeDriver("NODE onCallEventFromView "+JSON.stringify(e)),this.webSocket&&this.webSocket.emit("callEvent",e)},onInviteToCall:function(e){v.dispatchEvent("inviteToCall",[e])},onCallEnded:function(e){v.dispatchEvent("callEnded",[e])},onCallAccepted:function(e){v.dispatchEvent("callAccepted",[e])},onWebRTCIceCandidate:function(e){v.dispatchEvent("webrtcIceCandidateReceived",[e])},onSDPreceived:function(e){v.dispatchEvent("SDPreceived",[e])},onCoreview:function(e){v.dispatchEvent("COREVIEW",[e])},onLeaveRoom:function(e){v.dispatchEvent("roomLeft",[e])},onJoinRoom:function(e){v.dispatchEvent("roomJoined",[e])},onSpecialEvent:function(e){v.dispatchEvent("miscellaneous",[e])},updateRoom:function(e){this.webSocket&&this.webSocket.emit("updateRoom",e)},onDiscover:function(e){v.dispatchEvent("discovered",[e])},discover:function(e){this.webSocket&&this.webSocket.emit("discover",e)},joinPublicRoom:function(e){this.webSocket&&this.webSocket.emit("joinPublicRoom",e)},getCallInfo:function(e){this.webSocket&&this.webSocket.emit("getCallInfo",e)},subConv:function(e){this.webSocket&&this.webSocket.emit("subConv",e)},IAmTyping:function(e){this.webSocket&&this.webSocket.emit("IAmTyping",e)},goTo:function(e){v.dispatchEvent("connectTelWS",{url:e.telUrl||v.url,connectionParams:v.connectionParams,call_id:e.call_id,cookie:e.telCookie})},sipEvent:function(e){if(!v.telwebsocket)return c.nodeDriver("cant send sipEvent without telwebsocket "+e.action);c.nodeDriver("send sipEvent "+e.action),v.telwebsocket.emit(e.action,e.data)},onConversation:function(e){v.dispatchEvent("conversation",[e]),e&&e.action&&e.tenant&&e.data&&e.data.convId&&("readConversation"===e.action?r.publish("3dnotifinterne",{action:"readConversation",data:{tenant:e.tenant,convId:e.data.convId}}):"deleteMessage"===e.action&&r.publish("3dnotifinterne",{action:"deleteMessage",data:{tenant:e.tenant,convId:e.data.convId,msgId:e.data.deletedMessage}}))},onCall:function(e){v.dispatchEvent("call",[e])},conversationEvent:function(e){this.webSocket&&this.webSocket.emit("toRTC",e)},onCall:function(e){v.dispatchEvent("call",[e])},aiaiEvent:function(e){this.webSocket&&this.webSocket.emit("aiaiToRTC",e)},onAiai:function(e){v.dispatchEvent("rtcToAiai",[e])},callEvent:function(e){this.webSocket&&e.TxID&&!e.TxID.includes("callEvent")&&this.webSocket.emit("callToRTC",e)},onDesktopApp:function(e){if(v.blockPopup)return c.debug("[onDesktopApp] Block popup ON");e&&e.channel&&e.data&&r.publish(e.channel,e.data)},onRouterRtpCapabilities:async function(e){v.dispatchEvent("routerRtpCapabilities",[e])},onWebrtcTransportCreated:async function(e){v.dispatchEvent("webrtcTransportCreated",[e])},onGotNewProducer:async function(e){v.dispatchEvent("gotNewProducer",[e])},onConsumerCreated:async function(e){v.dispatchEvent("consumerCreated",[e])},onConsumerPaused:async function(e){v.dispatchEvent("consumerPaused",[e])},onConsumerResumed:async function(e){v.dispatchEvent("consumerResumed",[e])},onConsumerClosed:async function(e){v.dispatchEvent("consumerClosed",[e])},onNewMediasoupUser:async function(e){v.dispatchEvent("newMediasoupUser",[e])},onMediasoupUserLeft:async function(e){v.dispatchEvent("mediasoupUserLeft",[e])},sendAlert:function(e){this.webSocket&&this.webSocket.emit("newAlert",e)},sendAlertRemoved:function(e){this.webSocket&&this.webSocket.emit("alertRemoved",e)},sendFinalReportCall:function(e){this.webSocket&&this.webSocket.emit("callFinalReport",e)}})}));