/*!  Copyright 2021 Dassault Systemes. All rights reserved. */
define("DS/CATWebUXCVS/CATWebUXCVSComponent",["UWA/Core","UWA/Class","DS/Windows/Dialog","DS/Controls/Button","DS/UIKIT/Spinner"].concat(["DS/Utilities/Dom","i18n!DS/CATWebUXCVS/assets/nls/CATWebUXCVS","css!DS/CATWebUXCVS/CATWebUXCVS.css"]),(function(t,e,i,a,n,s,r){"use strict";return e.extend({init:function(e){if(!(e.title&&e.physicalId&&e.platformSettings&&e.tenant&&e.securityContext))return;var l,o,d,c,g=this,S=null,u=null,v=100,p=140,C=40,h=100,b=20,f=[{id:"inProgress"},{id:"passed"},{id:"failed"}],m=e.title,A=e.physicalId,y=e.isrType;Array.isArray(e.platformSettings)&&e.platformSettings.length>0&&(c=e.platformSettings);var V,w=e.tenant;"function"==typeof e.securityContext.getSecurityContext&&(V=e.securityContext);var T,x=e.onChangeValidationStateCompleted,W=e.onChangeValidationStateClose,U=e.onChangeValidationStateFailure,j=function(t){var e;switch(t){case"inProgress":e="InProgress";break;case"passed":e="Passed";break;case"failed":e="Failed"}return e},X=function(t){var e;switch(t){case"InProgress":e="inProgress";break;case"Failed":e="failed";break;case"Passed":e="passed"}return e},k=function(t){d=!1;for(var e=0;e<f.length;e++)if(f[e].beingchanged){f[e].div.getElementsByClassName("CATWebUXCVS-valstate-text")[0].setStyle("visibility","visible"),o.destroy(),f[e].beingchanged=!1;break}U(t)},I=function(t){if(T)t();else{require(["DS/WAFData/WAFData"],(function(e){T=e,I(t)}))}},E=t.createElement("div",{class:"CATWebUXCVS-valstate-content"}),D=t.createElement("div",{class:"CATWebUXCVS-valstate-div"}).inject(E);D.setStyles({height:p.toString()+"px",width:380..toString()+"px","margin-left":50..toString()+"px"});var P=t.createElement("div",{class:"CATWebUXCVS-svg-container"}).inject(D);P.setStyles({position:"absolute",top:"0",left:"0",width:"100%",height:"100%",visibility:"visible"});var L=t.createElement("div",{class:"CATWebUXCVS-valstate-container"}).inject(D);L.setStyles({display:"flex",position:"absolute","z-index":"10"});var F=t.createElement("div",{class:"CATWebUXCVS-valstate-inprogress-container"}).inject(L);F.setStyles({"vertical-align":"middle","left-margin":h.toString()+"px"}),t.createElement("div",{class:"CATWebUXCVS-valstate-connectors"}).inject(L).setStyles({width:v.toString()+"px",height:p.toString()+"px"});var N=t.createElement("div",{class:"CATWebUXCVS-valstate-passedfailed-container"}).inject(L);N.setStyles({display:"block"});!function(){var e=function(t){return document.createElementNS("http://www.w3.org/2000/svg",t)};(u=e("svg")).setAttribute("id","svgCanvas"),u.setAttribute("width","100%"),u.setAttribute("height","100%");var i=e("path");i.setAttribute("d","M "+(90+b).toString()+" "+70..toString()+" L "+180..toString()+" "+70..toString()),i.setAttribute("class","line");var a=e("path");a.setAttribute("d","M "+180..toString()+" "+(b+20).toString()+" L "+180..toString()+" "+(p-(b+20)).toString()),a.setAttribute("class","line");var n=e("path");n.setAttribute("marker-end","url(#arrow)"),n.setAttribute("d","M "+180..toString()+" "+(b+20).toString()+" L "+(230+b).toString()+" "+(b+20).toString()),n.setAttribute("class","line");var s,r,l,o=e("path");o.setAttribute("marker-end","url(#arrow)"),o.setAttribute("d","M "+180..toString()+" "+(p-(b+20)).toString()+" L "+(230+b).toString()+" "+(p-(b+20)).toString()),o.setAttribute("class","line"),u.appendChild((s=e("marker"),r=e("defs"),l=e("path"),s.appendChild(l),r.appendChild(s),s.setAttribute("id","arrow"),s.setAttribute("markerWidth","10"),s.setAttribute("markerHeight","8"),s.setAttribute("refX","9"),s.setAttribute("refY","4"),s.setAttribute("orient","auto"),l.setAttribute("d","M 3 1 L 10 4 L 3 7"),l.setAttribute("class","arrow"),r)),u.appendChild(i),u.appendChild(a),u.appendChild(n),u.appendChild(o),t.extendElement(u).inject(P)}(),f.forEach((function(i){i.div=t.createElement("div",{class:"CATWebUXCVS-valstate"}),i.div.setStyles({width:90..toString(),height:C.toString(),margin:b.toString()}),i.id===e.current?i.div.addClassName("CATWebUXCVS-valstate-current-"+i.id.toString()):(i.div.addClassName("CATWebUXCVS-valstate-"+i.id.toString()),i.div.addClassName("CATWebUXCVS-valstate-clickable"),i.div.onclick=function(){if(!d){d=!0,i.div.getElementsByClassName("CATWebUXCVS-valstate-text")[0].setStyle("visibility","hidden"),o=new n({visible:!0});var t,e=0;"inProgress"===i.id?(t=60,e=50):"passed"===i.id?(t=b+20-10,e=280):"failed"===i.id&&(t=p-b-20-10,e=280),o.inject(i.div),o.getContent().addClassName("CATWebUXCVS-valstate-spinner"),o.getContent().setStyles({top:t.toString()+"px",left:e.toString()+"px"}),i.beingchanged=!0,a={physicalId:A,state:i.id},I((function(){if(V&&c&&w){var t=V.getSecurityContext();if(t&&t.hasOwnProperty("SecurityContext")){for(var e,i={Accept:"application/json","Content-Type":"application/json","Accept-Language":window.widget.lang,SecurityContext:t.SecurityContext},n=0;n<c.length;n++)if(c[n].platformId===w){e=c[n]["3DSpace"];break}var s,r,l=function(t){if(null===t&&void 0===t)return"";var e="";if(Array.isArray(t))for(var i=t.length/2,a=0;a<i;a++)e+=0===a?"?":"&",e+=t[2*a]+"="+t[2*a+1];return encodeURI(e)},o=[];o.push("securityContext"),o.push(t),o.push("tenant"),o.push(w),y?(s=e+"/resources/PIMwebModel/services/setAttributeValue"+l(o),r={id:a.physicalId,attrName:"SIMItfSimulation.V_ValidationState",attrValue:j(a.state)}):(s=e+"/resources/validationauthoring/service/modifyAttributes"+l(o),r={sValidationId:a.physicalId,listObjects:[{sObjectId:a.physicalId,sListOfAttributesToModify:[{sValidationState:j(a.state)}]}]}),T.authenticatedRequest(s,{method:"POST",type:"json",headers:i,data:JSON.stringify(r),onComplete:function(t){t&&t.modifiedObjects&&1===t.modifiedObjects.length||t&&y?(d=!1,x({sValidationState:y?a.state:X(t.modifiedObjects[0].sValidationState)}),g.clean()):k(t)},onFailure:function(t){k(t)}})}else k()}else k()}))}var a}),i.div.addClassName(e.current);var a=t.createElement("span",{class:"CATWebUXCVS-valstate-text"}).inject(i.div);switch(i.id){case"inProgress":i.div.setStyles({"margin-top":50..toString()+"px"}),i.div.inject(F),a.setText(r.valStateChange.inProgress);break;case"passed":i.div.inject(N),a.setText(r.valStateChange.passed);break;case"failed":i.div.inject(N),a.setText(r.valStateChange.failed)}}));var O=new a({label:r.valStateChange.closeBtn,onClick:function(){W(),g.clean()}});let M={ensureHeightDefinitionOnHierarchy:!0,title:r.valStateChange.dlgTitle+" - "+m,resizableFlag:!1,buttons:{Close:O},width:480,content:E};function z(t,e){var i=t.getSize(),a=e.getSize(),n=(a.width-i.width)/2,s=(a.height-i.height)/2;t.setStyles({left:n<0?0:n,top:s<0?0:s})}e.parent.appendChild||(M.modalFlag=!0,M.immersiveFrame=e.parent),(S=new i(M)).addEventListener("close",(function(){W(),g.clean()})),M.modalFlag||(l=t.createElement("div",{class:"wux-windows-modalDialog",styles:{}}).inject(e.parent),S.elements.container.inject(l),z(S.elements.container,e.parent),s.addResizeListener(e.parent,(function(){z(S.elements.container,e.parent)}))),this.clean=function(){S&&S.destroy(),l&&(s.removeResizeListener(e.parent),l.destroy(),l=null)}}})}));