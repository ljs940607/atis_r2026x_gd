"undefined"==typeof define&&(define=function(e){PropertiesParser=e(),define=void 0}),define("DS/CSIJSONToolsWeb/CSIGrammarUpgraderPropertiesParser",[],(function(){"use strict";const e=/^[a-z][A-Za-z0-9]*$/,t=/[^a-zA-Za-z0-9]/gi;class r{constructor(e){this.properties_=void 0,this.parser_=e}parseV1(e){this.properties_=[];for(const t in e)if(e.hasOwnProperty(t)){const r=new a(this.parser_);r.parseV1(t,e[t]),this.properties_.push(r)}return this}parseV2(e){this.properties_=[];for(let t=0;t<e.length;++t){const r=new a(this.parser_);r.parseV2(e[t]),this.properties_.push(r)}return this}upgradeV2(){const e=[];if(void 0!==this.properties_)for(let t=0;t<this.properties_.length;++t)e[t]=this.properties_[t].upgradeV2();return e}}r.prototype.parseV3=r.prototype.parseV2,r.prototype.upgradeV3=r.prototype.upgradeV2;const s=["string","bool","int8","uint8","int16","uint16","int32","uint32","int64","uint64","float","double","buffer","string[]","bool[]","int8[]","uint8[]","int16[]","uint16[]","int32[]","uint32[]","int64[]","uint64[]","float[]","double[]","buffer[]"];class a{constructor(e){this.clear(),this.parser_=e}clear(){this.label="",this.typeType="",this.typeName="",this.array=!1,this.isOptional=!1,this.defaultValue="",this.subProperties=[]}getTypeFromString(e){this.typeName=e.replace("[]",""),s.indexOf(e)>=0?this.typeType="basic":this.typeType="type",e.indexOf("[]")>=0&&(this.array=!0,this.typeType+="Array")}parseV1(e,t){return this.clear(),this.label=e,"string"==typeof t?this.getTypeFromString(t):"object"==typeof t?(t.hasOwnProperty("type")&&this.getTypeFromString(t.type),t.hasOwnProperty("desc")&&(this.desc=t.desc),t.hasOwnProperty("parameters")&&(this.typeType="parameters",t.parameters instanceof Object?this.subProperties=new r(this.parser_).parseV1(t.parameters).properties_:(this.typeType="type",this.typeName="Parameters",console.warn("Grammar Upgrader : parameters file not supported, will be turned into a global parameters - "+JSON.stringify(t)))),t.hasOwnProperty("parameters[]")&&(this.array=!0,this.typeType="parametersArray",this.subProperties=new r(this.parser_).parseV1(t["parameters[]"]).properties_),t.hasOwnProperty("defaultValue")&&("string"==typeof t.defaultValue?(this.defaultValue=t.defaultValue,this.isOptional=!0):(this.defaultValue=JSON.stringify(t.defaultValue),this.isOptional=!0))):(this.typeType="type",this.typeName="Unknown Type"),this}parseV2(e){if(this.clear(),e.hasOwnProperty("label")&&(this.label=e.label),e.hasOwnProperty("desc")&&(this.desc=e.desc),e.hasOwnProperty("basic")&&(this.typeType="basic",this.typeName=e.basic),e.hasOwnProperty("basicArray")&&(this.typeType="basicArray",this.typeName=e.basicArray,this.array=!0),e.hasOwnProperty("type")&&(this.typeType="type",this.typeName=e.type),e.hasOwnProperty("typeArray")&&(this.typeType="typeArray",this.typeName=e.typeArray,this.array=!0),e.hasOwnProperty("typeRef")&&(this.typeType="typeRef",this.typeName=e.typeRef),e.hasOwnProperty("parameters")){this.typeType="parameters";for(let t=0;t<e.parameters.length;t++){const r=new a(this.parser_);r.parseV2(e.parameters[t]),this.subProperties.push(r)}}if(e.hasOwnProperty("parametersArray")){this.array=!0,this.typeType="parametersArray";for(let t=0;t<e.parametersArray.length;t++){const r=new a(this.parser_);r.parseV2(e.parametersArray[t]),this.subProperties.push(r)}}return e.hasOwnProperty("enum")&&(this.enum=e.enum),e.hasOwnProperty("optional")&&(!0===e.optional.isOptional&&(this.isOptional=!0),void 0!==e.optional.default_value&&(this.isOptional=!0,"string"==typeof e.optional.default_value?this.defaultValue=e.optional.default_value:this.defaultValue=JSON.stringify(e.optional.default_value))),this}upgradeV2(){this.label=function(r){if(e.test(r))return r;let s=r.replaceAll(t,"");for(var a=0;s[a]>="0"&&s[a]<="9";)++a;const p=s.slice(a);p.length>0&&(s=p);try{return s.replace(s[0],s[0].toLocaleLowerCase())}catch(e){return console.error("Grammar Upgrader : error "+e),r}}(this.label);const r={};return this.parser_.ParsingOrder.parameters.forEach((e=>{if(this.hasOwnProperty(e))r[e]=this[e];else if(this.typeType===e)this.typeName.length>0?r[this.typeType]=this.typeName:r[this.typeType]=this.subProperties.map((e=>e.upgradeV2()));else if("optional"===e&&!0===this.isOptional){const t={};this.defaultValue.length>0?t.default_value=this.defaultValue:t.isOptional=!0,r[e]=t}})),r}}return a.prototype.parseV3=a.prototype.parseV2,a.prototype.upgradeV3=a.prototype.upgradeV2,new r}));