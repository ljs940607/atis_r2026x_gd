"undefined"==typeof define&&(define=function(e){RulesV2V3=e(),define=void 0}),define("DS/CSIJSONToolsWeb/CSIGrammarUpgraderRulesV2V3",["DS/CSIJSONToolsWeb/CSIGrammarUpgraderJsonField","DS/CSIJSONToolsWeb/CSIGrammarUpgraderPropertiesParser"],(function(e,r){"use strict";const n={parser_:void 0,grammarVersion:function(){const r=Math.min(3,this.parser_.getCurrentFileMaxGrammarVersion());return new e("grammarVersion",{grammarVersion:r})},implementation:function(r){const n=r.getValue();if(this.parser_.isFunctionFile()||this.parser_.isCommandFile()){const t={};if(n.hasOwnProperty("library"))return t.implementation={name:"library",version:2,settings:{library:n.library}},new e("implementation",t);if(n.hasOwnProperty("javaClassPath"))return t.implementation={name:"java",version:1,settings:{javaClassPath:n.javaClassPath}},new e("implementation",t);if(n.hasOwnProperty("name")&&n.hasOwnProperty("version")&&n.hasOwnProperty("settings"))return r}else if(this.parser_.isTypeFile()||this.parser_.isPoolFile()){const r={implementation:{}};return n.hasOwnProperty("library")&&(r.implementation.library=n.library,r.implementation.version=void 0===n.version?1:n.version),n.hasOwnProperty("jsModule")&&(r.implementation.jsModule=n.jsModule),n.hasOwnProperty("javaClassPath")&&(r.implementation.javaClassPath=n.javaClassPath,r.implementation.version=1),new e("implementation",r)}console.warn('GrammarUpdater : bad "implementation" in V2 '+JSON.stringify(n))},onCall:function(r){const n=r.getValue(),t={onCall:{}};return this.parser_.parseObject(n,t.onCall,this.parser_.ParsingOrder.signature,2),new e("onCall",t)},signature:function(n,t){const i=n.getValue(),s={};if(s[t]={},i.hasOwnProperty("parameters")){const e=r.parseV2(i.parameters).upgradeV2();e.length>0&&(s[t].parameters=e)}else i.hasOwnProperty("type")&&(s[t].type=i.type,i.hasOwnProperty("desc")&&(s[t].desc=i.desc));return new e(t,s)},in:function(e){return this.signature(e,"in")},out:function(e){return this.signature(e,"out")},answers:function(e){return this.signature(e,"answers")},definition:function(n){const t=n.getValue(),i={};return t instanceof Array?(i.definition=r.parseV2(t).upgradeV2(),new e("definition",i)):n},progress:function(e){return this.signature(e,"progress")},throwError:function(e){return this.signature(e,"throwError")},importCommandsFromPool:function(r){const n=r.getValue(),t={imports:[]};if(n instanceof Array)for(let e=0;e<n.length;++e)t.imports.push({pool:n[e]});return new e("imports",t)},pools:function(r){const n=r.getValue(),t=[];if(n instanceof Array)for(const e of n){const r={name:e.name};e.poolDefinition&&(r.poolDefinition=this.parser_.grammarUpgrader_.upgradeObject(e.poolDefinition));const n=[];for(const r of e.functions){const e=this.parser_.grammarUpgrader_.upgradeObject(r);n.push(e)}r.functions=n;const i=[];for(const r of e.commands){const e=this.parser_.grammarUpgrader_.upgradeObject(r);i.push(e)}r.commands=i,t.push(r)}return this.parser_.fileType_=this.parser_.FileType.csiBundle,new e("pools",{pools:t})},types:function(r){const n=r.getValue(),t=[];if(n instanceof Array)for(const e of n){const r=this.parser_.grammarUpgrader_.upgradeObject(e);t.push(r)}return this.parser_.fileType_=this.parser_.FileType.csiBundle,new e("types",{types:t})},events:function(r){const n=r.getValue(),t=[];if(n instanceof Array)for(const e of n){const r=this.parser_.grammarUpgrader_.upgradeObject(e);t.push(r)}return this.parser_.fileType_=this.parser_.FileType.csiBundle,new e("events",{events:t})},customImplementations:function(r){this.parser_.fileType_=this.parser_.FileType.csiCustomImpl;const n=r.getValue(),t=[];if(n instanceof Array)for(const e of n){const r=this.parser_.grammarUpgrader_.upgradeObject(e);t.push(r)}return this.parser_.fileType_=this.parser_.FileType.csiBundle,new e("customImplementations",{customImplementations:t})},languageLibrary:function(r){const n=r.getField(),t=r.getValue(),i={};return this.parser_.isFunctionFile()||this.parser_.isCommandFile()?(i.implementation={library:t},this.implementation(new e("implementation",i))):this.parser_.isTypeFile()||this.parser_.isPoolFile()?(i.implementation={},i.implementation[n]=t,i.implementation.version=1,new e("implementation",i)):void console.warn('GrammarUpdater : bad "implementation" in V1 of '+JSON.stringify(t))},library:function(e){return this.parser_.isCustomImplFile()?e:n.languageLibrary(e)}};return n}));