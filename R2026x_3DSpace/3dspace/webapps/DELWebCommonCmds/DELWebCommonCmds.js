define("DS/DELWebCommonCmds/DELWeb3DFilterCmd",["DS/PlatformAPI/PlatformAPI","DS/ENONextGenFilterCmd/commands/ENONextGenFilterCmd","DS/DELWebComponentManager/DELWebComponentManager","DS/ENOFilterBIUX/FilterBIComponentProxy","DS/Logger/Logger","DS/Controls/ModalContainer","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Button","DS/ApplicationFrame/CommandsManager","DS/DELWebComponentManager/XSOManager","DS/DELWeb3DUtils/DELOERNodeUtils","DS/DELWebComponentManager/DELWebTypesUtil","i18n!DS/DELWebCommonCmds/assets/nls/DELWeb3DFilterCmd"],(function(e,t,o,n,i,r,l,s,a,d,c,p,g,m){"use strict";return t.extend({name:"DELWeb3DFilterCmd",_roots:[],_modelTokens:[],logger:i.getLogger("DELWeb3DFilterCmd"),initProxy:function(e={}){var t=this,i=o.getComponent("Utils"),c={onOpenFilter:function(e={}){var n,i,c,p,g=e.data||{},u=g.items||[],I=g.showConfirmationDialog,f=g.onApply,h=g.onCancel,y=!1,F=[],C=function(e){r.removeModal(widget.body),o.getComponent("ModelEvents").publish({event:"onFilterCancel",data:{data:e,origin:"DELWeb3DFilterCmd"}}),h&&h(e)};c=function(){n(),t.resetFilterUI(),I?p():C({result:!1,filterData:u})},i=function(e){e&&!e.empty&&(F.push(e),y&&F.length!==u.length||(n(),r.removeModal(widget.body),f&&f(F)))},n=function(){t._BIProxy.removeEvent("ApplyNGFilter",i),t._BIProxy.removeEvent("NGFilter_Close",c)},p=function(){var e,o,n,i=document.getElementsByClassName("wux-controls-modalContainer"),r=function(e){let t=d.getCommand("VolumeQueryHdr"),i={result:e,filterData:u};t&&t.isRunning()&&t.end(),o.removeEventListener("close",n),o.destroy(),C(i)};n=r.bind(r,!1),UWA.is(i,"array"),i.length>0?((e=new l({})).inject(i[0]),(o=new s({immersiveFrame:e,title:m.get("Dialog.Title"),content:m.get("Dialog.FilterCancelled.Message"),buttons:{Ok:new a({onClick:r.bind(r,!0)}),Cancel:new a({onClick:r.bind(r,!1)})}})).addEventListener("close",n)):t.logger.error("App Overlay container not found, so dialog cannot be created")},UWA.is(u,"array")&&u.length>0&&(t._BIProxy.addEvent("NGFilter_Close",c),t._BIProxy.addEvent("ApplyNGFilter",i),t.setRoots(u.map((e=>({id:e.id,filtered:!1})))),function(){let e=!1,o=u.filter((e=>e.filterSpec||e.publicFilterSpec));return o.length>0&&(e=!0,y=!0,o.forEach((e=>{let o={rootID:e.id,rootAlias:e.label,applyFilter:1,displayFilter:0,forceUpdate:0,serviceId:"3DSpace"};e.filterSpec?t._BIProxy.setFilterSpecification({...o,...e.filterSpec}):e.publicFilterSpec&&t._BIProxy.setPublicFilterSpecification({...o,...e.publicFilterSpec})}))),e}()||t.execute(),r.createModal(widget.body,document.createElement("span")))},onRootAdded:function(e={}){if(e.data&&e.data.id){t._roots.some((t=>t.id===e.data.id))||t._roots.push({id:e.data.id,filtered:!1})}},onRootRemoved:function(e={}){if(e.data&&e.data.id){let o=t._roots.findIndex((t=>t.id===e.data.id));-1!==o&&t._roots.splice(o,1)}}};if(e&&e.filterProxy&&!e.NGFUXId)throw new Error("Invalid Input, NGFUXId is mandatory when filterProxy is used");!function(){var e=o.getComponent("ModelEvents");for(let o in c)Object.prototype.hasOwnProperty.call(c,o)&&t._modelTokens.push(e.subscribe({event:o},c[o]))}(),e=e||{},this._NGFUXId=e.NGFUXId||i.getNGFUXId(),this._BIProxy=e.filterProxy?e.filterProxy:new n({tenant:i.getPlatformId(),processingMode:"appProcessing",ExpandSynthesisON:!1,colorize:!0,widgetId:i.getWidgetId(),volumeFilterAvailable:!0,NGFUXId:this._NGFUXId,appId:i.getAppId(),synthesis_priority:2,shareFilterSpec:!0,selectionFilterAvailable:!1,attributeFilterAvailable:!1,securityContext:i.getCurrentSecurityContext()})},getProxy:function(){return this._BIProxy},getNGFUXId:function(){return this._NGFUXId},getAppParams:function(){var e=o.getComponent("Utils");return{widgetId:e.getWidgetId(),appId:e.getAppId(),NGFUXId:this.getNGFUXId(),shareFilterspec:!0}},shareFilterSpec:function(e){this._BIProxy.shareFilterSpec(e)},getRoots:function(){return this._roots},setRoots:function(e){this._roots=e},getSelectorManager:function(){return c.getCSO()},getSelection:function(){var e=c.getCSO().get()||[],t=[];return e.forEach((e=>{t.push(p.getRirPath(e))})),{path:t}},resetFilterUI:function(){let e=o.getComponent("Utils");e&&this._BIProxy&&this._BIProxy.resetNGFilterUI&&this._BIProxy.resetNGFilterUI({appId:e.getAppId(),widgetId:e.getWidgetId(),rootIds:this.getRoots().map((e=>e.id))}),this.setRoots([])},cleanProxy:function(){if(this._BIProxy&&this._BIProxy.cleanProxy(),this._BIProxy=null,this._modelTokens.length>0){let e=o.getComponent("ModelEvents");this._modelTokens.forEach((t=>{e.unsubscribe(t)}))}this._roots=[],this._modelTokens=[]}})}));