var multiTabDecorations=function(){var t=2048,e=null,i=[],r=0,n=0;this.addDecoration=function(o){e||(e=new Uint8Array(t),i=[e]);var s=r;if(n+o.length>t){var a=t-n,u=n+o.length-t;this.writeDecoration(o,0,a),n=0,e=new Uint8Array(t),i.push(e),this.writeDecoration(o,a,u)}else this.writeDecoration(o,0,o.length);return r+=o.length,s+1},this.writeDecoration=function(t,i,r){for(var o=0;o<r;o++)e[n++]=t[i+o]},this.getConcatenatedBlocks=function(){if(0==r)return null;for(var e=new Uint8Array(r),n=0,o=0;o<i.length;o++)for(var s=0;s<t;s++)e[n++]=i[o][s];return e}};define("DS/Mesh/Mesh",["DS/Mesh/ThreeJS_Base"],(function(t){"use strict";var e=-2,i=i||{REVISION:"1"},r=new Set,n=null!=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(navigator.userAgent),o=new RegExp("Edge","i").test(navigator.userAgent);i.VertexComponentEnum={POSITION:0,NORMAL:1,DIFFUSE_COLOR:2,TEX_COORD_0:3,TEX_COORD_1:4,TEX_COORD_2:5,TEX_COORD_3:6,TEX_COORD_4:7,TEX_COORD_5:8,TEX_COORD_6:9,TEX_COORD_7:10,USER_COMPONENT_0:11},i.DataTypeEnum={UCHAR:0,USHORT:1,UINT:2,CHAR:3,SHORT:4,INT:5,FLOAT:6,DOUBLE:7},i.GeomTypeString={},function(){var e,r,n=["EDGE","WIRE_EDGE","BOUNDARY_EDGE","SHARP_EDGE","SMOOTH_EDGE","HIDDEN_SEAM_EDGE","BOUNDARY_POINT","SHARP_POINT","SMOOTH_POINT","HIDDEN_SEAM_POINT","SURFACIC_POINT","FREE_POINT","INFINITE_FACE","FACE","UNKNOWN","AXIS_SYSTEM"];for(e=0;e<n.length;e++)r=n[e],i.GeomTypeString[t.GeomTypeEnum[r]]=r;i.GeomTypeString[t.GeomTypeEnum.SMOOTH_EDGE|t.GeomTypeEnum._HIGH_CURVATURE_EDGE]="SMOOTH_EDGE"}(),i.sizeOfDataType=function(t){switch(t){case i.DataTypeEnum.FLOAT:case i.DataTypeEnum.INT:case i.DataTypeEnum.UINT:return 4;case i.DataTypeEnum.CHAR:case i.DataTypeEnum.UCHAR:return 1;case i.DataTypeEnum.SHORT:case i.DataTypeEnum.USHORT:return 2;case i.DataTypeEnum.DOUBLE:return 8;default:return 0}},i.ConnectivityTypeEnum={TRIANGLES:0,TRIANGLE_FAN:1,TRIANGLE_STRIP:2,LINES:3,LINE_STRIP:4,LINE_LOOP:5,POINTS:6},i.PointSymbolEnum={CROSS:0,PLUS:1,CONCENTRIC:2,COINCIDENT:3,FULLCIRCLE:4,FULLSQUARE:5,STAR:6,DOT:7,SMALLDOT:8,MISC1:9,MISC2:10,FULLCIRCLE2:11,FULLSQUARE2:12,LOSANGEBORDER:13,FULLLOSANGE:14,FULLCIRCLE3:15,OUTLINE_DOUBLEROTATEARROW:16,FILLED_DOUBLEROTATEARROW:17,OUTLINE_SQUARE:18,FILLED_SQUARE:19,OUTLINE_DIAMOND:20,FILLED_DIAMOND:21,UNKNOWN:255},i.LinePatternEnum={UNKNOWN:0,SOLID:1,DOTTED:2,DASHED:3,DOTDASHED:4,PHANTOM:5,SMALLDOTTED:6,JISAXIS:7},i.CATSGPlayRepDataOptions={QuantBBoxPerGP:1,BBoxPerRep:2,PositionBoxCompression:4,NormalOct16Compression:8,NormalOct24Compression:16},i.NOPICKABLE=0,i.PICKABLE=1,i.PICKTHROUGH=2;var s=0;Object.defineProperty(i,"NODRAWHL",{get:function(){return s<20&&(t.getWebVisualizationLevel()>425?console.error("NODRAWHL deprecated, use PICKTHROUGH instead"):console.warn("NODRAWHL deprecated, use PICKTHROUGH instead"),s++),i.PICKTHROUGH},set:function(t){}}),i.INVISIBLE=2,i.PICK_NEVER=0,i.PICK_ALWAYS=1,i.PICK_VISIBLE=2,i.PICK_INVISIBLE=3,i.Color=function(t,e,i,r){this.r=t||0,this.g=e||0,this.b=i||0,this.a=null==r?1:r},i.Color.prototype={constructor:i.Color,setRGBA:function(t,e,i,r){this.r=t,this.g=e,this.b=i,this.a=r},copy:function(t){this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a},isEqual:function(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a},clone:function(){return new i.Color(this.r,this.g,this.b,this.a)}},i.FillAttributes=function(t,e,r){this.color=t||new i.Color,this.solid=e||this.solid||0,this.basic=r||this.basic||!1},i.FillAttributes.prototype={constructor:i.FillAttributes,isEqual:function(t){return null!==t&&this.color.isEqual(t.color)&&this.solid===t.solid&&this.basic===t.basic},clone:function(){return new i.FillAttributes(this.color.clone(),this.solid)}},i.LineAttributes=function(t,e,r){this.color=t||new i.Color,this.thickness=Math.round(e)>1?Math.round(e):1,this.pattern=r||i.LinePatternEnum.SOLID,this.forceMaterial=!1},i.LineAttributes.prototype={constructor:i.LineAttributes,isEqual:function(t){return null!==t&&this.color.isEqual(t.color)&&this.thickness===t.thickness&&this.pattern===t.pattern&&this.forceMaterial===t.forceMaterial&&(this.forceLineWidth===t.forceLineWidth||1==this.thickness)},clone:function(){return new i.LineAttributes(this.color.clone(),this.thickness,this.pattern)}},i.PointAttributes=function(t,e,r){this.color=t||new i.Color,this.size=e||1,this.symbol=r||i.PointSymbolEnum.CROSS,this.forceMaterial=!1},i.PointAttributes.prototype={constructor:i.PointAttributes,isEqual:function(t){return null!==t&&this.color.isEqual(t.color)&&this.size===t.size&&this.forceMaterial===t.forceMaterial&&this.symbol===t.symbol},clone:function(){return new i.PointAttributes(this.color.clone(),this.size,this.symbol)}};var a=new i.FillAttributes,u=new i.LineAttributes,l=new i.PointAttributes;i.PrimitiveGroup=function(t){this.identifier=0,this.nbPrimitives=0,this.primitives=[],this.nbBuffers=0,this.buffers=[],this.material=null,this.fillAttr=a,this.lineAttr=u,this.pointAttr=l,this.noz=!1,this.editable=!1,t&&(void 0!==t.fillGAS&&(this.fillAttr=t.fillGAS),void 0!==t.lineGAS&&(this.lineAttr=t.lineGAS),void 0!==t.pointGAS&&(this.pointAttr=t.pointGAS),void 0!==t.identifier&&(this.identifier=t.identifier),void 0!==t.editable&&(this.editable=t.editable),void 0!==t.noz&&(this.noz=t.noz))},i.PrimitiveGroup.prototype={constructor:i.PrimitiveGroup,addPrimitive:function(t){return this.primitives.push(t),this.nbPrimitives++,this},addBuffer:function(t,e){return this.buffers[t]=e,this.nbBuffers++,this},removeBuffer:function(t){this.buffers[t]=null,this.nbBuffers--},getBuffer:function(t){var e;for(e in this.buffers){var i=this.buffers[e];if(i.component===t)return i}return null},getBufferFromId:function(t){var e=this.buffers[t];return void 0!==e?e:null}},i.Buffer=function(t){this.indexBuffer=!1,this.size=0,this.component=i.VertexComponentEnum.POSITION,this.format=i.DataTypeEnum.FLOAT,this.dimension=3,this.data=null,t&&(t.indexBuffer&&(this.indexBuffer=!0),void 0!==t.component&&(this.component=t.component),void 0!==t.format&&(this.format=t.format),t.dimension&&(this.dimension=t.dimension),t.data&&(this.data=t.data))},i.Primitive=function(t){this.identifier=0,this.nbIndices=0,this.connectivity=i.ConnectivityTypeEnum.TRIANGLES,this.nbVertexComponents=0,this.geomType=null,this.vertexComponents=[],this.attr=null,this.material=null,t&&(void 0!==t.nbIndices&&(this.nbIndices=t.nbIndices),void 0!==t.connectivity&&(this.connectivity=t.connectivity),void 0!==t.geomType&&(this.geomType=t.geomType),void 0!==t.identifier&&(this.identifier=t.identifier),(t.fillGAS||t.lineGAS||t.pointGAS)&&(this.attr||(this.attr={fill:a,line:u,point:l}),t.fillGAS&&(this.attr.fill=t.fillGAS),t.lineGAS&&(this.attr.line=t.lineGAS),t.pointGAS&&(this.attr.point=t.pointGAS)))},i.Primitive.prototype={constructor:i.Primitive,addVertexComponent:function(t){return this.vertexComponents.push(t),this.nbVertexComponents++,this},_usedVertexColor:function(){for(var t=0;t<this.vertexComponents.length;t++)if(2==this.vertexComponents[t].component)return this.vertexComponents[t];return!1}},i.VertexComponent=function(t){this.component=i.VertexComponentEnum.POSITION,this.nbVertices=0,this.nbValuesPerVertex=0,this.format=i.DataTypeEnum.FLOAT,this.cardinality=0,this.bufferId="",this.offset=0,this.indices=null,t&&(void 0!==t.nbVertices&&(this.nbVertices=t.nbVertices),void 0!==t.cardinality&&(this.cardinality=t.cardinality),void 0!==t.bufferId&&(this.bufferId=t.bufferId),void 0!==t.indices&&(this.indices=t.indices),void 0!==t.offset&&(this.offset=t.offset))},i.IndexArray=function(t){this.format=i.DataTypeEnum.UINT,this.bufferId="",this.offset=0,t&&(void 0!==t.bufferId&&(this.bufferId=t.bufferId),void 0!==t.offset&&(this.offset=t.offset))},i.Material=function(){this.type="material",this.identifier=0,this._MaterialPropertiesActivate=1,this.colorAmbient=[],this.colorDiffuse=[],this.colorSpecular=[],this.shininess=0,this.ambientCoef=0,this.diffuseCoef=0,this.specularCoef=0,this.transparent=0,this.reflectivityCoef=0,this.textureId=-1,this.textureImageNumberComposante=0,this.textureBlending=t.TextureBlendOperations.BLEND,this.magFilter=0,this.minFilter=0,this.mappingFunction=0,this.textureWrapS=0,this.textureWrapT=0,this.addedComposantInTexEnv=0,this.shaderMaterial=null},i.Material.prototype={constructor:i.Material,clone:function(){return new i.Material}},i.SGNode=function(t){this.type=0,this.modelIdentification=null,t?(this.cgmId=void 0!==t.cgmId?t.cgmId:-1,void 0!==t.parent?this.parents=[t.parent]:void 0!==t.parents?this.parents=t.parents.slice():this.parents=[],this.solid=void 0!==t.solid&&t.solid):(this.cgmId=-1,this.parents=[],this.solid=!1)},i.SGNode.prototype={constructor:i.SGNode,getModelIdentification:function(){return this.modelIdentification},setModelIdentification:function(t){this.modelIdentification=t},getIdentificationObject:function(){return this.modelIdentification},setIdentificationObject:function(t){this.modelIdentification=t}},Object.defineProperty(i.SGNode.prototype,"parent",{get:function(){return this.parents.length?this.parents[0]:null},set:function(t){this.parents[0]=t}}),i.ThicknessTable=[1,1,2,3,4,5,6,7,8],i.GASCacheMask=4294963376,i.GASNoPriorityMask=4294963455,i.colorTransparencyMask=4278190208,i.GraphicAttributeSet=function(t,e,i){this.set=t||0,this.rgba=e||0,this.webOverride=i||0},i.GraphicAttributeSet.prototype={constructor:i.GraphicAttributeSet,dump:function(){console.log("set  isNopick "+this.isNopick()+" isHighlight "+this.isHighlight()+" isLowlight "+this.isLowlight()+" isHidden "+this.isHidden()+" getType "+this.getType()+" isShowFree "+this.isShowFree()+" isTransparent "+this.isTransparent()+" getPriority "+this.getPriority()+" getThickness "+this.getThickness()+" getLineType "+this.getLineType()+" getColor "+this.getColor()),console.log("webOverride  getConnectivity "+this.getConnectivity()+" isBasic "+this.isBasic()+" isPBR "+this.isPBR()+" getPointSize "+this.getPointSize()+" isBlankingRep "+this.isBlankingRep()+" getVertexColor "+this.getVertexColor()+" getSymbol "+this.getSymbol()),console.log("color "+this.rgba)},setCacheValue:function(){this.set=this.set&i.GASCacheMask,this.getConnectivity()<2&&this.setBasic(!1)},getLineTypeKeys:function(){return[this.set&i.colorTransparencyMask,this.rgba]},setConnectivity:function(t){var e;switch(t){case i.ConnectivityTypeEnum.POINTS:e=0;break;case i.ConnectivityTypeEnum.LINES:case i.ConnectivityTypeEnum.LINE_STRIP:case i.ConnectivityTypeEnum.LINE_LOOP:e=1;break;case i.ConnectivityTypeEnum.TRIANGLES:case i.ConnectivityTypeEnum.TRIANGLE_STRIP:case i.ConnectivityTypeEnum.TRIANGLE_FAN:default:e=2}this._setConnectivity(e)},setNoPick:function(t){this.set&=-2,this.set|=1&t},setHighlight:function(t){this.set&=-3,this.set|=(1&t)<<1},setLowlight:function(t){this.set&=-5,this.set|=(1&t)<<2},setNoShow:function(t){this.set&=-9,this.set|=(1&t)<<3},setType:function(t){this.set&=-49,this.set|=(3&t)<<4},setShowFree:function(t){this.set&=-65,this.set|=(1&t)<<6},setTransparent:function(t){this.set&=-129,this.set|=(1&t)<<7},setPriority:function(t){this.set&=-3841,this.set|=(15&t)<<8},setLineThickness:function(t){this.set&=-258049,this.set|=(63&t)<<12},setLineType:function(t){this.set&=-16515073,this.set|=(63&t)<<18},setColor:function(t){this.set&=16777215,this.set|=(255&t)<<24},isNopick:function(){return 1&this.set},isHighlight:function(){return this.set>>1&1},isLowlight:function(){return this.set>>2&1},isHidden:function(){return this.set>>3&1},getType:function(){return this.set>>4&3},isShowFree:function(){return this.set>>6&1},isTransparent:function(){return this.set>>7&1},getPriority:function(){return this.set>>8&15},getThickness:function(){return this.set>>12&63},getLineType:function(){return this.set>>18&63},getColor:function(){return this.set>>24&255},setRGBAColor:function(t){this.rgba=t},setRGBAColorRGBChannel:function(t,e,i){this.rgba&=255,this.rgba|=(16777215&(t<<16|e<<8|i))<<8},setRGBAColorAlphaChannel:function(t){this.rgba&=-256,this.rgba|=255&t},getRGBAColor:function(){var t=[];return t[0]=this.rgba>>24&255,t[1]=this.rgba>>16&255,t[2]=this.rgba>>8&255,t[3]=255&this.rgba,t},_setConnectivity:function(t){this.webOverride&=-4,this.webOverride|=3&t},setBasic:function(t){this.webOverride&=-5,this.webOverride|=(1&t)<<2},setPBR:function(){this.webOverride&=-9,this.webOverride|=8},setPointSize:function(t){this.webOverride&=-1009,this.webOverride|=(63&t)<<4},_setBlanking:function(t){this.webOverride&=-3073,this.webOverride|=(3&t)<<10},setVertexColor:function(){this.webOverride&=-4097,this.webOverride|=4096},setSymbol:function(t){this.webOverride&=-253953,this.webOverride|=(31&t)<<13},setDepthMode:function(t){this.webOverride&=-262145,this.webOverride|=(1&t)<<18},setSceneGraphOrder:function(t){this.webOverride&=-1572865,this.webOverride|=(3&t)<<19},setAdvancedPriority:function(t){this.webOverride&=-2097153,this.webOverride|=(1&t)<<21},getConnectivity:function(){return 3&this.webOverride},isBasic:function(){return this.webOverride>>2&1},isPBR:function(){return this.webOverride>>3&1},getPointSize:function(){return this.webOverride>>4&63},isBlankingRep:function(){return this.webOverride>>10&3},isTransparentBlankingRep:function(){return 1==(this.webOverride>>10&3)},getVertexColor:function(){return this.webOverride>>12&1},getSymbol:function(){return this.webOverride>>13&31},getDepthMode:function(){return this.webOverride>>18&1},getSceneGraphOrder:function(){return this.webOverride>>19&3},getAdvancedPriority:function(){return this.webOverride>>21&1},isEqual:function(t,e){return!!(e&&3&this.webOverride)||this.set==t.set&&this.rgba==t.rgba&&this.webOverride==t.webOverride},getBlankingRep:function(t){var e=this.getPriority();this.set=0,this.rgba=0,this.setConnectivity(i.ConnectivityTypeEnum.TRIANGLES),this.setPriority(e),this.setBasic(!0),this._setBlanking(t)},set2DMode:function(){this.setRGBAColorAlphaChannel(255)},getDisplayedColor:function(){if(255==this.getColor())return this.getRGBAColor();var t=[];switch(this.getColor()){case 254:case 253:case 249:default:t[0]=0,t[1]=0,t[2]=0,t[3]=255;break;case 252:t[0]=62,t[1]=102,t[2]=85,t[3]=255;break;case 251:case 250:t[0]=255,t[1]=128,t[2]=0,t[3]=255;break;case 248:t[0]=255,t[1]=255,t[2]=255,t[3]=255;break;case 247:case 240:case 239:t[0]=255,t[1]=0,t[2]=0,t[3]=255;break;case 246:case 241:t[0]=0,t[1]=255,t[2]=0,t[3]=255;break;case 245:t[0]=0,t[1]=0,t[2]=255,t[3]=255;break;case 244:t[0]=255,t[1]=255,t[2]=0,t[3]=255;break;case 243:t[0]=255,t[1]=0,t[2]=255,t[3]=255;break;case 242:t[0]=0,t[1]=255,t[2]=255,t[3]=255}return t},getLineThicknessID:function(){return this.set>>12&63},getLineThickness:function(){var t=this.getLineThicknessID();return t=t>i.ThicknessTable.length?1:i.ThicknessTable[t]},isBackgroundColor:function(){return 254==this.getColor()},isForegroundColor:function(){return 253==this.getColor()},isNoZ:function(){return 0==this.getType()},isSolid:function(){return 3==this.getType()?1:0},clone:function(){return new i.GraphicAttributeSet(this.set,this.rgba,this.webOverride)}},i.GraphicAttributeSetForDepth=function(t,e,r,n){i.GraphicAttributeSet.call(this,t,e,r),this.depthPriority=void 0!==n?n:4,this.depthMode=!0},i.GraphicAttributeSetForDepth.prototype=Object.create(i.GraphicAttributeSet.prototype),i.GraphicAttributeSetForDepth.prototype.constructor=i.GraphicAttributeSetForDepth,i.GraphicAttributeSetForDepth.prototype.clone=function(){return new i.GraphicAttributeSetForDepth(this.set,this.rgba,this.webOverride,this.depthPriority)},i.GraphicAttributeSetForDepth.prototype.setDepthPriority=function(t){this.depthPriority=t},i.GraphicAttributeSetForDepth.prototype.getDepthPriority=function(){return this.depthPriority},i.GraphicAttributeSetForDepth.prototype.isEqual=function(t,e){return!!(e&&3&this.webOverride)||this.set==t.set&&this.rgba==t.rgba&&this.depthPriority==t.depthPriority&&this.webOverride==t.webOverride},i.SGBag=function(t){i.SGNode.call(this,t),t=t||{},this.type=1,this.attributes=void 0!==t.attributes?t.attributes:[],this.batchInfo=void 0!==t.batchInfo?t.batchInfo:null,this.matrix=void 0!==t.matrix?t.matrix:null,this.children=void 0!==t.children?t.children:[],this.namingContext=void 0!==t.namingContext?t.namingContext:0,this.uuid_1=void 0!==t.uuid_1?t.uuid_1:null,this.uuid_2=void 0!==t.uuid_2?t.uuid_2:null,this.uuid_3=void 0!==t.uuid_3?t.uuid_3:null,this.uuid_4=void 0!==t.uuid_4?t.uuid_4:null,this.noShow=void 0!==t.noShow&&t.noShow},i.SGBag.prototype=Object.create(i.SGNode.prototype),i.SGBag.prototype.constructor=i.SGBag,i.SGBag.prototype.childClone=function(){var t=new Array;for(var e in this.children)t[e]="object"==typeof this.children[e]?this.children[e].clone():this.children[e];return t},i.SGBag.prototype.addBatchInfo=function(t,e){this.batchInfo||(this.batchInfo=[]),this.batchInfo.push({typeGeom:t,batchIndex:e})},i.SGBag.prototype.clone=function(){return new i.SGBag({cgmId:this.cgmId,type:this.type,attributes:this.attributes,children:this.childClone(),matrix:null!==this.matrix?this.matrix.clone():null,parents:this.parents,solid:this.solid,uuid_1:this.uuid_1,uuid_2:this.uuid_2,uuid_3:this.uuid_3,uuid_4:this.uuid_4,noShow:this.noShow})},i.SGBag.prototype.copyNoChildren=function(t){this.cgmId=t.cgmId,this.attributes=t.attributes,this.batchInfo=t.batchInfo,this.matrix=t.matrix,this.parents=t.parents.slice(),this.solid=t.solid,this.namingContext=t.namingContext,this.noShow=t.noShow,t.uuid_1&&(this.uuid_1=t.uuid_1,this.uuid_2=t.uuid_2,this.uuid_3=t.uuid_3,this.uuid_4=t.uuid_4)},i.SGBag.prototype.computeBoundingSphere=function(e){var i,r=new t.Sphere;for((e=e||new t.Sphere).reset(),i=0;i<this.children.length;i++)this.children[i].computeBoundingSphere(r),r.mergeWithSphere(e,e);return e},i.SGBag.prototype._computeOrientedBoundingBox=function(e,i,r,n,o){for(var s,a=new t.Box3,u=0;u<this.children.length;u++){(s=this.children[u]._computeOrientedBoundingBox(e,i,r,n,o))&&(a=a.union(s))}return a},i.UUID=function(){this.uuid_1=0,this.uuid_2=0,this.uuid_3=0,this.uuid_4=0},i.UUID.prototype={constructor:i.UUID,setFromUint32:function(t,e,i,r){this.uuid_1=t,this.uuid_2=e,this.uuid_3=i,this.uuid_4=r},toString:function(){return this.uuid_1.toString(16)+"_"+this.uuid_2.toString(16)+"_"+this.uuid_3.toString(16)+"_"+this.uuid_4.toString(16)},isEqual:function(t){return this.uuid_1===t.uuid_1&&this.uuid_2===t.uuid_2&&this.uuid_3===t.uuid_3&&this.uuid_4===t.uuid_4},clone:function(){var t=new i.UUID;return t.uuid_1=this.uuid_1,t.uuid_2=this.uuid_2,t.uuid_3=this.uuid_3,t.uuid_4=this.uuid_4,t}},i.SGRep=function(t){i.SGNode.call(this,t),this.type=2,this.attributes=[],t?(this.matrix=void 0!==t.matrix?t.matrix:null,this._primitives=void 0!==t.primitives?t.primitives:[],this.boundingSphere=void 0!==t.boundingSphere?t.boundingSphere:null,this.sag=void 0!==t.sag?t.sag:null,this.namingContext=void 0!==t.namingContext?t.namingContext:0,this.attributes=void 0!==t.attributes?t.attributes:0,this.batchInfo=void 0!==t.batchInfo?t.batchInfo:null):(this.matrix=null,this._primitives=[],this.boundingSphere=null,this.sag=null,this.namingContext=0,this.batchInfo=null),this._binary=!1},i.SGRep.prototype=Object.create(i.SGNode.prototype),Object.assign(i.SGRep.prototype,{constructor:i.SGRep,primitivesClone:function(){for(var t=[],e=0;e<this._primitives.length;e++){var i=this._primitives[e];i.clone?t.push(i.clone()):t.push(i)}return t},addBatchInfo:function(t,e){this.batchInfo||(this.batchInfo=[]),this.batchInfo.push({typeGeom:t,batchIndex:e})},clone:function(){var t=new i.SGRep({attributes:this.attributes,cgmId:this.cgmId,type:this.type,primitives:this.primitivesClone(),matrix:this.matrix?this.matrix.clone():null,parent:this.parent,solid:this.solid,sag:this.sag,boundingSphere:this.boundingSphere?{radius:this.boundingSphere.radius,center:[this.boundingSphere.center[0],this.boundingSphere.center[1],this.boundingSphere.center[2]]}:null});return t._binary=this._binary,t},_getIndex:function(t){var e={ind:-1,subInd:-1};if(!this._binary)return e.ind=t,e;for(var i=0,r=0;r<this._primitives.length;r++){var n=this._primitives[r];if(t<i+n.count){e.ind=r,e.subInd=t-i+n.start;break}i+=n.count}return e},getPrimitiveCgmId:function(t){var e=this._getIndex(t),i=this._primitives[e.ind];return-1!==e.subInd?i.binary.getPrimitiveCgmId(e.subInd):i.cgmId},_setPrimitiveCgmId:function(t,e){var i=this._getIndex(e),r=this._primitives[i.ind];-1===i.subInd?r.cgmId=t:r.binary._setPrimitiveCgmId(t,i.subInd)},getPrimitiveType:function(t){var e=this._getIndex(t),i=this._primitives[e.ind];return-1!==e.subInd?i.binary.getPrimitiveType(e.subInd):i.type},_getSGPrimitive:function(t,e){var i=this._getIndex(t),r=this._primitives[i.ind];return-1!==i.subInd?r.binary._getSGPrimitive(i.subInd,e):e?r:r.clone()},_getPrimitiveInternalNode:function(t){var e=this._getIndex(t),i=this._primitives[e.ind];return-1!==e.subInd?i.binary._getPrimitiveInternalNode(e.subInd):i.internalNode},_setPrimitiveRep:function(t,e){var i=this._getIndex(e),r=this._primitives[i.ind];-1===i.subInd?r.rep=t:r.binary._setPrimitiveRep(t,i.subInd)},_setPrimitiveInternalNode:function(t,e){var i=this._getIndex(e),r=this._primitives[i.ind];-1===i.subInd?r.internalNode=t:r.binary._setPrimitiveInternalNode(t,i.subInd)},getPrimitiveRep:function(t){var e=this._getIndex(t),i=this._primitives[e.ind];return-1!==e.subInd?i.binary.getPrimitiveRep(e.subInd):i.rep},_setPrimitiveStart:function(t,e){var i=this._getIndex(e),r=this._primitives[i.ind];-1===i.subInd?r.start=t:r.binary._setPrimitiveStart(t,i.subInd)},_setPrimitiveCount:function(t,e){var i=this._getIndex(e),r=this._primitives[i.ind];-1===i.subInd?r.count=t:r.binary._setPrimitiveCount(t,i.subInd)},getPrimitiveStart:function(t){var e=this._getIndex(t),i=this._primitives[e.ind];return-1!==e.subInd?i.binary.getPrimitiveStart(e.subInd):i.start},getPrimitiveCount:function(t){var e=this._getIndex(t),i=this._primitives[e.ind];return-1!==e.subInd?i.binary.getPrimitiveCount(e.subInd):i.count},getPrimitiveGroup:function(t){var e=this._getIndex(t),i=this._primitives[e.ind];return-1!==e.subInd?i.binary.getPrimitiveGroup(e.subInd):i.group},getPrimitiveDecoration:function(t){var e=this._getIndex(t),i=this._primitives[e.ind];return-1!==e.subInd?i.binary.getPrimitiveDecoration(e.subInd):i.decoration},getPrimitiveBoundingSphere:function(t){var e=this._getIndex(t),i=this._primitives[e.ind];return-1!==e.subInd?i.binary.getPrimitiveBoundingSphere(e.subInd):i.boundingSphere},setPrimitiveBoundingSphere:function(t,e){var i=this._getIndex(t),r=this._primitives[i.ind];-1===i.subInd?r.boundingSphere=e:r.binary.setPrimitiveBoundingSphere(i.subInd,e)},getPrimitivesCount:function(){if(!this._binary)return this._primitives.length;for(var t=0,e=0;e<this._primitives.length;e++){t+=this._primitives[e].count}return t},getPrimitivesCountWithGLType:function(t){let e,i=0;if(this._binary)for(e=0;e<this._primitives.length;e++){let r=this._primitives[e],n=r.binary&&r.binary.dg;n&&n.glType===t&&(i+=r.count)}else{let r=this.getPrimitivesCount();for(e=0;e<r;e++){let r=this.getPrimitiveGroup(e);r&&r.glType===t&&i++}}return i},getPrimitiveIdentificationObject:function(t){var e=this._getIndex(t),i=this._primitives[e.ind];return-1!==e.subInd?i.binary.getPrimitiveIdentificationObject(e.subInd):i.IdentObj},setPrimitiveIdentificationObject:function(t,e){var i=this._getIndex(e),r=this._primitives[i.ind];-1!==i.subInd&&r.binary.setPrimitiveIdentificationObject(t,i.subInd),r.IdentObj=t},computePrimitiveBoundingSphere:function(t){var e=this._getIndex(t),i=this._primitives[e.ind];return-1!==e.subInd?i.binary.computePrimitiveBoundingSphere(e.subInd):i.computeBoundingSphere()},startIteration:function(){return!0},endIteration:function(){return!0},computeBoundingSphere:function(e){if(!this.boundingSphere){this.boundingSphere=new t.Sphere;var i,r,n,o=new t.Sphere;for(i=0;i<this._primitives.length;i++)if(this._binary)for(n=(r=this._primitives[i]).start;n<r.start+r.count;n++)r.binary.computePrimitiveBoundingSphere(n,o),o.mergeWithSphere(this.boundingSphere,this.boundingSphere);else this._primitives[i].computeBoundingSphere(o),o.mergeWithSphere(this.boundingSphere,this.boundingSphere)}return e?(e.copy(this.boundingSphere),e):this.boundingSphere},_computeOrientedBoundingBox:function(e,i,r,n,o){var s,a,u,l,h=new t.Box3;for(s=0;s<this._primitives.length;s++)if(l=this._primitives[s],this._binary)for(a=l.start;a<l.start+l.count;a++)null!==(u=l.binary._computePrimitiveOrientedBoundingBox(a,e,i,r,n,o))&&(h=h.union(u));else null!==(u=l._computeOrientedBoundingBox(e,i,r,n,o))&&(h=h.union(u));return h},_computePrimitiveOrientedBoundingBox:function(t,e,i,r,n,o){var s=this._getIndex(t),a=this._primitives[s.ind];return-1!==s.subInd?a.binary._computePrimitiveOrientedBoundingBox(s.subInd,e,i,r,n,o):a._computeOrientedBoundingBox(e,i,r,n,o)}});var h=0;Object.defineProperty(i.SGRep.prototype,"primitives",{get:function(){if(h<10){var t=new Error,e="#PrimApi - SGRep.GetPrimitives - "+(t.stack?t.stack.split("\n")[1]+" - "+t.stack.split("\n")[2]:"");r.has(e.hashCode())||(r.add(e.hashCode()),console.error(e),h++)}return this._primitives},set:function(){throw"NO"}}),i.BinarySGPrimitiveArray=function(t,e,i,r,n){this.data=t,this.size=n,this.sgRep=i,this.dg=e,this.bSpheres=r||null,this.IdentObj=[],this.internalNodes=[]},i.BinarySGPrimitiveArray.prototype.constructor=i.BinarySGPrimitiveArray,i.BinarySGPrimitiveArray.prototype.clone=function(){return new i.BinarySGPrimitiveArray(this.data.slice(),this.dg,this.sgRep,this.bSpheres?this.bSpheres.slice():null,this.size)},i.BinarySGPrimitiveArray.prototype._compactArrays=function(){var t=this.IdentObj;this.IdentObj=new Array(t.length);for(var e=0;e<t.length;e++)this.IdentObj[e]=t[e];var i=this.internalNodes;this.internalNodes=new Array(i.length);for(e=0;e<i.length;e++)this.internalNodes[e]=i[e]},i.BinarySGPrimitiveArray.prototype._getSGPrimitive=function(t,e){var r=this.size*t,n=this.data,o=n[r]-1,s=this.getPrimitiveRep(t),a=n[r+2],u=n[r+3],l=n[r+4],h=this.getPrimitiveBoundingSphere(t),c=new i.SGPrimitive;return c.decoration=l,c.group=this.dg,c.rep=s,c.count=u,c.start=a,c.cgmId=o,c.boundingSphere=h,c},i.BinarySGPrimitiveArray.prototype.getPrimitiveCgmId=function(t){var e=this.size*t;return this.data[e]-1},i.BinarySGPrimitiveArray.prototype._setPrimitiveCgmId=function(t,e){if("number"!=typeof t)throw"Cgmid must be a number";var i=this.size*e;this.data[i]=t+1},i.BinarySGPrimitiveArray.prototype.getPrimitiveType=function(t){return 3},i.BinarySGPrimitiveArray.prototype._getPrimitiveInternalNode=function(t){return this.internalNodes[t]},i.BinarySGPrimitiveArray.prototype._setPrimitiveInternalNode=function(t,e){0===this.internalNodes.length&&(this.internalNodes=new Array(this.getPrimitivesCount())),this.internalNodes[e]=t},i.BinarySGPrimitiveArray.prototype._setPrimitiveRep=function(t,e){var i=this.sgRep.indexOf(t);i>=0?this.data[this.size*e+1]=i:(this.sgRep.push(t),this.data[this.size*e+1]=this.sgRep.length-1)},i.BinarySGPrimitiveArray.prototype.getPrimitiveRep=function(t){var e=this.data[this.size*t+1];return this.sgRep[e]},i.BinarySGPrimitiveArray.prototype.getPrimitiveStart=function(t){var e=this.size*t;return this.data[e+2]},i.BinarySGPrimitiveArray.prototype.getPrimitiveGroup=function(t){return this.dg},i.BinarySGPrimitiveArray.prototype._setPrimitiveStart=function(t,e){var i=this.size*e;this.data[i+2]=t},i.BinarySGPrimitiveArray.prototype.getPrimitiveCount=function(t){var e=this.size*t;return this.data[e+3]},i.BinarySGPrimitiveArray.prototype._setPrimitiveCount=function(t,e){var i=this.size*e;this.data[i+3]=t},i.BinarySGPrimitiveArray.prototype.getPrimitiveDecoration=function(t){var e=this.size*t;return this.data[e+4]},i.BinarySGPrimitiveArray.prototype.getPrimitiveBoundingSphere=function(e){if(null!==this.bSpheres){var i=new t.Sphere;return i.setSimple(this.bSpheres[4*e],this.bSpheres[4*e+1],this.bSpheres[4*e+2],this.bSpheres[4*e+3]),i.radius>=0?i:null}return null},i.BinarySGPrimitiveArray.prototype._computePrimitiveOrientedBoundingBox=function(t,e,i,r,n,o){return this.dg._computeOrientedBoundingBox(e,i,r,n,this.getPrimitiveStart(t),this.getPrimitiveCount(t),o)},i.BinarySGPrimitiveArray.prototype.setPrimitiveBoundingSphere=function(t,e){null===this.bSpheres&&(this.bSpheres=new Float32Array(4*this.getPrimitivesCount()),this.bSpheres.fill(-1)),null===e?(this.bSpheres[4*t]=-1,this.bSpheres[4*t+1]=-1,this.bSpheres[4*t+2]=-1,this.bSpheres[4*t+3]=-1):(this.bSpheres[4*t]=e.center.x,this.bSpheres[4*t+1]=e.center.y,this.bSpheres[4*t+2]=e.center.z,this.bSpheres[4*t+3]=e.radius)},i.BinarySGPrimitiveArray.prototype.getPrimitivesCount=function(){return this.data.length/this.size},i.BinarySGPrimitiveArray.prototype.getPrimitiveIdentificationObject=function(t){return this.IdentObj[t]},i.BinarySGPrimitiveArray.prototype.setPrimitiveIdentificationObject=function(t,e){0===this.IdentObj.length&&(this.IdentObj=new Array(this.getPrimitivesCount())),this.IdentObj[e]=t},i.BinarySGPrimitiveArray.prototype.computePrimitiveBoundingSphere=function(e,i){let r=this.getPrimitiveCount(e);if(0==r)return;let n=this.getPrimitiveStart(e);const o=this.dg.geometry;let s=o.vertexIndexArray[n],a=new t.Vector3;o.getVertexPosition(s,a);let u=(new t.Vector3).copy(a),l=(new t.Vector3).copy(a);for(let t=1;t<r;++t)s=o.vertexIndexArray[n+t],o.getVertexPosition(s,a),u.x=Math.min(u.x,a.x),u.y=Math.min(u.y,a.y),u.z=Math.min(u.z,a.z),l.x=Math.max(l.x,a.x),l.y=Math.max(l.y,a.y),l.z=Math.max(l.z,a.z);let h=(new t.Vector3).addVectors(u,l);h.multiplyScalar(.5);let c=0;for(let t=0;t<r;++t)s=o.vertexIndexArray[n+t],o.getVertexPosition(s,a),a.sub(h),c=Math.max(a.lengthSq(),c);return c=Math.sqrt(c),(i=i||new t.Sphere).set(h,c),i},i.SGPrimitive=function(t){this.type=3,this.IdentObj=null,this.internalNode=null,t?(this.cgmId=void 0!==t.cgmId?t.cgmId:-1,this.rep=void 0!==t.rep?t.rep:null,this.group=void 0!==t.group?t.group:null,this.start=void 0!==t.start?t.start:0,this.count=void 0!==t.count?t.count:0,this.boundingSphere=void 0!==t.boundingSphere?t.boundingSphere:void 0,this.decoration=void 0!==t.decoration?t.decoration:0):(this.cgmId=-1,this.rep=null,this.group=null,this.start=0,this.count=0,this.boundingSphere=void 0,this.decoration=0)},i.SGPrimitive.prototype={constructor:i.SGPrimitive,getIdentificationObject:function(){return this.IdentObj},setIdentificationObject:function(t){this.IdentObj=t},isEqual:function(t){return this.getGroup()===t.getGroup()&&this.getRep()===t.getRep()&&this.getStart()===t.getStart()&&this.getCount()===t.getCount()&&this.getCgmId()===t.getCgmId()},computeBoundingSphere:function(e){const i=this.count;if(0==i)return;const r=this.start,n=this.group.geometry,o=n.vertexIndexArray;let s=o[r],a=new t.Vector3;n.getVertexPosition(s,a);let u=(new t.Vector3).copy(a),l=(new t.Vector3).copy(a);for(let t=1;t<i;++t)s=o[r+t],n.getVertexPosition(s,a),u.x=Math.min(u.x,a.x),u.y=Math.min(u.y,a.y),u.z=Math.min(u.z,a.z),l.x=Math.max(l.x,a.x),l.y=Math.max(l.y,a.y),l.z=Math.max(l.z,a.z);let h=(new t.Vector3).addVectors(u,l);h.multiplyScalar(.5);let c=0;for(let t=0;t<i;++t)s=o[r+t],n.getVertexPosition(s,a),a.sub(h),c=Math.max(a.lengthSq(),c);return c=Math.sqrt(c),(e=e||new t.Sphere).set(h,c),e},_computeOrientedBoundingBox:function(t,e,i,r,n){return this.group._computeOrientedBoundingBox(t,e,i,r,this.start,this.count,n)},getCgmId:function(){return this.cgmId},_setCgmId:function(t){this.cgmId=t},getType:function(){return this.type},_getInternalNode:function(){return this.internalNode},_setInternalNode:function(t){this.internalNode=t},getRep:function(){return this.rep},getStart:function(){return this.start},getCount:function(){return this.count},getGroup:function(){return this.group},getDecoration:function(){return this.decoration},getBoundingSphere:function(){return this.boundingSphere},startIteration:function(){return this.group.startIteration()},endIteration:function(){return this.group.endIteration()},_copyPrimitive:function(t){this.cgmId=t.cgmId,this.rep=t.rep,this.group=t.group,this.start=t.start,this.count=t.count,this.boundingSphere=t.boundingSphere?{radius:t.boundingSphere.radius,center:[t.boundingSphere.center[0],t.boundingSphere.center[1],t.boundingSphere.center[2]]}:void 0,this.decoration=t.decoration},clone:function(){var t=new i.SGPrimitive;return t._copyPrimitive(this),t}},i.SGPrimitiveHelper=function(){this.container=null,this.index=-1},i.SGPrimitiveHelper.prototype={constructor:i.SGPrimitiveHelper,clone:function(){var t=new i.SGPrimitiveHelper;return t.set(this.container,this.index),t},set:function(t,e){if(!t instanceof i.DrawingGroup||!t instanceof i.SGRep)throw"Error: container must be a Mesh.DrawingGroup or Mesh.SGRep";this.container=t,this.index=e},isEqual:function(t){return this.getGroup()===t.getGroup()&&this.getRep()===t.getRep()&&this.getStart()===t.getStart()&&this.getCount()===t.getCount()&&this.getCgmId()===t.getCgmId()},getCgmId:function(){return this.container.getPrimitiveCgmId(this.index)},_setCgmId:function(t){this.container._setPrimitiveCgmId(t,this.index)},getType:function(){return this.container.getPrimitiveType(this.index)},_getSGPrimitive:function(t){return this.container._getSGPrimitive(this.index,t)},_getInternalNode:function(){return this.container._getPrimitiveInternalNode(this.index)},_setInternalNode:function(t){this.container._setPrimitiveInternalNode(t,this.index)},_setRep:function(t){return this.container._setPrimitiveRep(t,this.index)},getRep:function(){return this.container.getPrimitiveRep(this.index)},getStart:function(){return this.container.getPrimitiveStart(this.index)},getCount:function(){return this.container.getPrimitiveCount(this.index)},getGroup:function(){return this.container.getPrimitiveGroup(this.index)},getDecoration:function(){return this.container.getPrimitiveDecoration(this.index)},getBoundingSphere:function(){return this.container.getPrimitiveBoundingSphere(this.index)},setBoundingSphere:function(t){this.container.setPrimitiveBoundingSphere(this.index,t)},getIdentificationObject:function(){return this.container.getPrimitiveIdentificationObject(this.index)},setIdentificationObject:function(t){this.container.setPrimitiveIdentificationObject(t,this.index)},computeBoundingSphere:function(t){return this.container.computePrimitiveBoundingSphere(this.index,t)},_computeOrientedBoundingBox:function(t,e,i,r,n){return this.container._computePrimitiveOrientedBoundingBox(this.index,t,e,i,r,n)},startIteration:function(){return this.container.startIteration()},endIteration:function(){return this.container.endIteration()},__getNodes:function(){const t=this.getGroup().geometry.meshList;let e=new Set;for(let i=0;i<t.length;i++){let r=t[i];r._occurrence&&e.add(r._occurrence.node)}return e},setMaterial:function(t){this.__getNodes().forEach((e=>{e.setMaterial([this],t)}))},_setGAS:function(t){this.__getNodes().forEach((e=>{e._setGAS([this],t)}))}};var c=0,p=25;Object.defineProperty(i.SGPrimitiveHelper.prototype,"start",{get:function(){if(c<p){var t=new Error,e="#PrimApi - helper.GetStart - "+(t.stack?t.stack.split("\n")[1]+" - "+t.stack.split("\n")[2]:"");r.has(e.hashCode())||(r.add(e.hashCode()),console.error(e)),c++}return this.getStart()},set:function(){throw"NO"}}),Object.defineProperty(i.SGPrimitiveHelper.prototype,"count",{get:function(){if(c<p){var t=new Error,e="#PrimApi - helper.GetCount - "+(t.stack?t.stack.split("\n")[1]+" - "+t.stack.split("\n")[2]:"");r.has(e.hashCode())||(r.add(e.hashCode()),console.error(e)),c++}return this.getCount()},set:function(){throw"NO"}}),Object.defineProperty(i.SGPrimitiveHelper.prototype,"cgmId",{get:function(){if(c<p){var t=new Error,e="#PrimApi - helper.GetCgmId - "+(t.stack?t.stack.split("\n")[1]+" - "+t.stack.split("\n")[2]:"");r.has(e.hashCode())||(r.add(e.hashCode()),console.error(e)),c++}return this.getCgmId()},set:function(t){if(c<p){var e=new Error,i="#PrimApi - helper.SetCgmId - "+(e.stack?e.stack.split("\n")[1]+" - "+e.stack.split("\n")[2]:"");r.has(i.hashCode())||(r.add(i.hashCode()),console.error(i)),c++}this._setCgmId(t)}}),Object.defineProperty(i.SGPrimitiveHelper.prototype,"rep",{get:function(){if(c<p){var t=new Error,e="#PrimApi - helper.GetRep - "+(t.stack?t.stack.split("\n")[1]+" - "+t.stack.split("\n")[2]:"");r.has(e.hashCode())||(r.add(e.hashCode()),console.error(e)),c++}return this.getRep()},set:function(){throw"NO"}}),Object.defineProperty(i.SGPrimitiveHelper.prototype,"boundingSphere",{get:function(){if(c<p){var t=new Error,e="#PrimApi - helper.GetBS - "+(t.stack?t.stack.split("\n")[1]+" - "+t.stack.split("\n")[2]:"");r.has(e.hashCode())||(r.add(e.hashCode()),console.error(e)),c++}return this.getBoundingSphere()},set:function(){throw"NO"}}),Object.defineProperty(i.SGPrimitiveHelper.prototype,"type",{get:function(){if(c<p){var t=new Error,e="#PrimApi - helper.GetType - "+(t.stack?t.stack.split("\n")[1]+" - "+t.stack.split("\n")[2]:"");r.has(e.hashCode())||(r.add(e.hashCode()),console.error(e)),c++}return this.getType()},set:function(){throw"NO"}}),Object.defineProperty(i.SGPrimitiveHelper.prototype,"group",{get:function(){if(c<p){var t=new Error,e="#PrimApi - helper.GetGroup - "+(t.stack?t.stack.split("\n")[1]+" - "+t.stack.split("\n")[2]:"");r.has(e.hashCode())||(r.add(e.hashCode()),console.error(e)),c++}return this.getGroup()},set:function(){throw"NO"}}),Object.defineProperty(i.SGPrimitiveHelper.prototype,"decoration",{get:function(){if(c<p){var t=new Error,e="#PrimApi - helper.GetDeco - "+(t.stack?t.stack.split("\n")[1]+" - "+t.stack.split("\n")[2]:"");r.has(e.hashCode())||(r.add(e.hashCode()),console.error(e)),c++}return this.getDecoration()},set:function(){throw"NO"}});var d={EDGE:1,WIRE_EDGE:2,BOUNDARY_EDGE:3,SHARP_EDGE:4,SMOOTH_EDGE:5,BOUNDARY_POINT:6,SHARP_POINT:7,SMOOTH_POINT:8,SURFACIC_POINT:9,FREE_POINT:10,INFINITE_FACE:11,FACE:12,UNKNOWN:13};i.getConvertedVec3=function(e,i){var r=[e[i],e[i+1],e[i+2]];return new t.Vector3(r[0],r[1],r[2])},i.isEqualGAS=function(t,e){return null==t&&null==e||!(null==t&&null!=e||null!=t&&null==e)&&(t.fill.isEqual(e.fill)&&t.line.isEqual(e.line)&&t.point.isEqual(e.point))},i.isEqualMaterial=function(t,e){return null==t&&null==e||!(null==t&&null!=e||null!=t&&null==e)&&(t.id==e.id&&t.file==e.file)},i.convertToMaterial3js=function(e,i){if(null==e)return null;var r=null,n=1,o=null;switch(i){case 0:n=null==e.point.color.a?1:e.point.color.a,o=new t.Color,e.point.color&&(o.setRGB(e.point.color.r,e.point.color.g,e.point.color.b),r={color:o,opacity:n,symbol:e.point.symbol,pointsize:e.point.size},e.point.forceMaterial&&(r.forceMaterial=!0));break;case 1:n=null==e.line.color.a?1:e.line.color.a,o=new t.Color,e.line.color&&(o.setRGB(e.line.color.r,e.line.color.g,e.line.color.b),r={color:o,opacity:n,lineWidth:e.line.thickness,pattern:e.line.pattern},e.line.forceMaterial&&(r.forceMaterial=!0));break;case 2:n=null==e.fill.color.a?1:e.fill.color.a,o=new t.Color,e.fill.color&&(o.setRGB(e.fill.color.r,e.fill.color.g,e.fill.color.b),r={color:o,opacity:n,solid:e.fill.solid,basic:e.fill.basic})}return r},i.areEqualGraphicProperties=function(t,e){return null!=t.color&&null!=e.color&&(t.color.r==e.color.r&&t.color.g==e.color.g&&t.color.b==e.color.b&&((!t.thickness||!e.thickness||t.thickness==e.thickness)&&((!t.pointsize||!e.pointsize||t.pointsize==e.pointsize)&&t.opacity==e.opacity)))},i.validatePrimitiveGroup=function(t){var e,r;for(e=0;e<t.buffers.length;e++){(s=t.buffers[e])&&(s.size=s.data.byteLength/i.sizeOfDataType(s.format),s.indexBuffer&&(s.format=i.DataTypeEnum.UINT,s.dimension=1))}for(e=0;e<t.primitives.length;e++){var n=t.primitives[e];for(n.attr||(n.attr={fill:t.fillAttr,line:t.lineAttr,point:t.pointAttr}),r=0;r<n.nbVertexComponents;r++){var o=n.vertexComponents[r],s=t.getBufferFromId(o.bufferId);o.component=s.component,o.nbValuesPerVertex=s.dimension,o.format=s.format}}},i.checkMeshOptimizable=function(t){for(var e=null,r=[],n=0;n<t.buffers.length;n++){var o=t.buffers[n];if(o)if(o.indexBuffer){if(e)return!1;e=o}else{if(r[o.component])return!1;r[o.component]=o}}for(var s=0;s<t.primitives.length;s++){var a=t.primitives[s];if(a.connectivity===i.ConnectivityTypeEnum.TRIANGLE_STRIP||a.connectivity===i.ConnectivityTypeEnum.TRIANGLE_FAN||a.connectivity===i.ConnectivityTypeEnum.LINE_STRIP)return!1}return!0},i.createGeometryOptimized=function(e,r){var n=new i.Mesh;n.rep=r;for(var o=0;o<e.buffers.length;o++){var s=e.buffers[o],a=s.component,u=s.data;if(s.indexBuffer)n.vertexIndexArray=u;else switch(a){case i.VertexComponentEnum.POSITION:n.vertexPositionArray=u;break;case i.VertexComponentEnum.NORMAL:n.vertexNormalArray=u;break;case i.VertexComponentEnum.DIFFUSE_COLOR:n.vertexColorArray=u;break;case i.VertexComponentEnum.TEX_COORD_0:n.vertexUvArray=u;break;case i.VertexComponentEnum.TEX_COORD_1:n.vertexUv2Array=u;break;case i.VertexComponentEnum.TEX_COORD_2:n.vertexTangentArray=u;break;case i.VertexComponentEnum.TEX_COORD_3:n.vertexBinormalArray=u}}var l=[],h=[],c=e.nbPrimitives;for(o=0;o<c;o++){var p=e.primitives[o],m=!!p.vertexComponents[0].indices,g=0,f=l.length;if(m){for(g=0;g<f;g++){var v=l[g];if(v.connectivity==p.connectivity&&v.geomType==p.geomType&&i.isEqualGAS(v.gas,p.attr)&&(null==v.material&&null==p.material||v.material.id==p.material.id&&v.material.file==p.material.file)){v.set.push(p),v.nbIndices+=p.nbIndices;break}}if(g===l.length){var y={connectivity:p.connectivity,geomType:p.geomType,gas:p.attr,material:p.material,nbIndices:p.nbIndices,set:[p]};l.push(y)}}else h.push(p)}l.sort((function(t,e){if(t.connectivity<e.connectivity)return-1;if(t.connectivity>e.connectivity)return 1;if(t.geomType&&e.geomType){var i=d[t.geomType],r=d[e.geomType];if(i&&r)return i-r}return 0}));for(o=0;o<l.length;o++)l[o].set.sort((function(t,e){var i=t.vertexComponents[0].indices,r=e.vertexComponents[0].indices;return i&&r?i.offset-r.offset:0}));for(o=0;o<l.length;o++)for(var x=l[o],b=[],I=x.set[0].vertexComponents[0].indices.offset,A=x.set[0].vertexComponents[0].indices.offset,_=0,S=0;S<x.set.length;)for(g=S;g<x.set.length;g++){var P=x.set[g];if(!P.vertexComponents[0].indices||P.vertexComponents[0].indices.offset!==A||g===x.set.length-1){g===x.set.length-1?(b.push(P),_+=P.nbIndices,S=g+1):S=g;var w=4===(B=x.connectivity===i.ConnectivityTypeEnum.TRIANGLES?4:x.connectivity===i.ConnectivityTypeEnum.LINES?1:0)?2:B;(O=new i.DrawingGroup(i.convertToMaterial3js(x.gas,w),x.material,B,I,_,void 0,void 0,t.GeomTypeEnum[x.geomType]))._geomType=x.geomType?t.GeomTypeEnum[x.geomType]:0,n.drawingGroups.push(O);for(var T=0;T<b.length;T++){var C=b[T],G=new i.SGPrimitive({cgmId:C.identifier,rep:n.rep,group:O,start:C.vertexComponents[0].indices.offset,count:C.nbIndices});O._primitives.push(G),n.rep._primitives.push(G)}I=P.vertexComponents[0].indices.offset,A=P.vertexComponents[0].indices.offset,_=0,b.length=0;break}b.push(P),A+=P.nbIndices,_+=P.nbIndices}for(o=0;o<h.length;o++){var B,O;w=4===(B=(C=h[o]).connectivity===i.ConnectivityTypeEnum.TRIANGLES?4:C.connectivity===i.ConnectivityTypeEnum.LINES?1:0)?2:B;(O=new i.DrawingGroup(i.convertToMaterial3js(C.attr,w),C.material,B,C.vertexComponents[0].offset,C.nbIndices,void 0,void 0,t.GeomTypeEnum[C.geomType]))._geomType=C.geomType?t.GeomTypeEnum[C.geomType]:0,O.nonIndexed=!0,n.drawingGroups.push(O);G=new i.SGPrimitive({cgmId:C.identifier,rep:n.rep,group:O,start:C.vertexComponents[0].offset,count:C.nbIndices});O._primitives.push(G),n.rep._primitives.push(G)}var M=new t.Color,E=new t.Color,N=new t.Color;e.fillAttr.color&&M.setRGB(e.fillAttr.color.r,e.fillAttr.color.g,e.fillAttr.color.b),e.lineAttr.color&&E.setRGB(e.lineAttr.color.r,e.lineAttr.color.g,e.lineAttr.color.b),n.gas.fill={color:M,opacity:null==e.fillAttr.color.a?1:e.fillAttr.color.a,solid:e.fillAttr.solid},n.gas.line={color:E,opacity:null==e.lineAttr.color.a?1:e.lineAttr.color.a,lineWidth:e.lineAttr.thickness,pattern:e.lineAttr.pattern||1},e.pointAttr&&(e.pointAttr.color&&N.setRGB(e.pointAttr.color.r,e.pointAttr.color.g,e.pointAttr.color.b),n.gas.point={color:N,opacity:null==e.pointAttr.color.a?1:e.pointAttr.color.a,pointsize:e.pointAttr.size});var z=[0,0,0],D=[0,0,0];if(n.vertexPositionArray){const t=n.vertexPositionArray;var R=t.length;if(R>=3){z=[t[0],t[1],t[2]],D=[t[0],t[1],t[2]];for(var V=0;V<R;V+=3)t[V]<z[0]&&(z[0]=t[V]),t[V+1]<z[1]&&(z[1]=t[V+1]),t[V+2]<z[2]&&(z[2]=t[V+2]),t[V]>D[0]&&(D[0]=t[V]),t[V+1]>D[1]&&(D[1]=t[V+1]),t[V+2]>D[2]&&(D[2]=t[V+2])}}return n.AABB={min:z,max:D},n},i.convertToGeometry3js=function(e,r,n,o,s,a,u){var l=o,h=[],c=0,p=0,m=e.nbPrimitives,g=i.isEqualGAS;a&&(g=function(t,e){return t.set==e.set&&t.rgba==e.rgba});for(var f="auto"===s,v=!0,y=!0,x=0;x<m;x++){var b=e.primitives[x];if(f&&v&&y)for(var I=-1,A=-1,_=0;_<b.vertexComponents.length;_++){var S=b.vertexComponents[_];if(S.indices){if(-1!==I&&S.indices.bufferId!==I){v=!1;break}if(I=S.indices.bufferId,-1!==A&&S.indices.offset!==A){y=!1;break}A=S.indices.offset}}var P=0,w=h.length;for(P=0;P<w;P++){var T=h[P];if(T.connectivity==b.connectivity&&T.geomType==b.geomType&&g(T.gas,b.attr)&&(null==T.material&&null==b.material||T.material.id==b.material.id&&T.material.file==b.material.file)){switch(c+=b.nbIndices,T.connectivity){case i.ConnectivityTypeEnum.TRIANGLE_STRIP:case i.ConnectivityTypeEnum.TRIANGLE_FAN:p+=2*(b.nbIndices-3),T.more_indices+=2*(b.nbIndices-3);break;case i.ConnectivityTypeEnum.LINE_STRIP:p+=b.nbIndices-2,T.more_indices+=b.nbIndices-2}T.set.push(b),T.nbIndices+=b.nbIndices;break}}if(P==h.length)switch((G={}).connectivity=b.connectivity,G.geomType=b.geomType,G.gas=b.attr,G.material=b.material,G.nbIndices=b.nbIndices,G.more_indices=0,G.set=[],G.set.push(b),h.push(G),c+=b.nbIndices,h[P].connectivity){case i.ConnectivityTypeEnum.TRIANGLE_STRIP:case i.ConnectivityTypeEnum.TRIANGLE_FAN:p+=2*(b.nbIndices-3),G.more_indices=2*(b.nbIndices-3);break;case i.ConnectivityTypeEnum.LINE_STRIP:p+=b.nbIndices-2,G.more_indices=b.nbIndices-2}}h.sort((function(t,e){if(t.connectivity<e.connectivity)return-1;if(t.connectivity>e.connectivity)return 1;if(t.geomType&&e.geomType){var i=d[t.geomType],r=d[e.geomType];if(i&&r)return i-r}return 0}));var C=[];for(P=0;P<h.length;P++){var G=h[P];for(x=0;x<G.set.length;x++)C.push(G.set[x])}var B=null;B=null!=s&&"multi"!=s&&("auto"!==s||v&&y)?void 0!==r?i.monoIndex(C,e.buffers,r,n):i.monoIndex(C,e.buffers):void 0!==r?i.deMultiIndex(C,e.buffers,r,n):i.deMultiIndex(C,e.buffers);var O=new i.Mesh;O.vertexPositionArray=B.VB[0],O.vertexNormalArray=B.VB[1],O.vertexColorArray=B.VB[2],O.vertexUvArray=B.VB[3],O.vertexUv2Array=B.VB[4],O.vertexTangentArray=B.VB[5],O.vertexBinormalArray=B.VB[6];for(var M=new Uint32Array(c+p),E=0,N=0,z=0;z<h.length;z++){var D,R=null==(G=h[z]).material?e.material:G.material;switch(G.connectivity){case i.ConnectivityTypeEnum.TRIANGLES:(U=G.gas)&&!U.set&&(U=i.convertToMaterial3js(G.gas,2)),(D=new i.DrawingGroup(U,R,4,N,G.nbIndices,void 0,void 0,t.GeomTypeEnum[G.geomType],void 0,u))._geomType=G.geomType?t.GeomTypeEnum[G.geomType]:0,O.drawingGroups.push(D);for(x=0;x<G.set.length;x++){b=G.set[x];var V=new i.MeshPrimitive(b.identifier,D,N,b.nbIndices);b.cgmId&&(V.cgmId=b.cgmId),b.decoration&&(V.decoration=b.decoration),b.boundingSphere&&(V.boundingSphere=b.boundingSphere),D._primitives.push(V);for(P=0;P<b.nbIndices;P++)M[N++]=B.IB[E++]}break;case i.ConnectivityTypeEnum.TRIANGLE_FAN:(U=G.gas)&&!U.set&&(U=i.convertToMaterial3js(G.gas,2)),(D=new i.DrawingGroup(U,R,4,N,G.nbIndices+G.more_indices,void 0,void 0,t.GeomTypeEnum[G.geomType],void 0,u))._geomType=G.geomType?t.GeomTypeEnum[G.geomType]:0,O.drawingGroups.push(D);for(x=0;x<G.set.length;x++){b=G.set[x];var F=N,L=E;for(P=0;P<b.nbIndices-2;P++)M[N++]=B.IB[L],M[N++]=B.IB[E+1],M[N++]=B.IB[E+2],E++;E+=2;V=new i.MeshPrimitive(b.identifier,D,F,N-F);b.cgmId&&(V.cgmId=b.cgmId),b.decoration&&(V.decoration=b.decoration),b.boundingSphere&&(V.boundingSphere=b.boundingSphere),D._primitives.push(V)}break;case i.ConnectivityTypeEnum.TRIANGLE_STRIP:(U=G.gas)&&!U.set&&(U=i.convertToMaterial3js(G.gas,2)),(D=new i.DrawingGroup(U,R,4,N,G.nbIndices+G.more_indices,void 0,void 0,t.GeomTypeEnum[G.geomType],void 0,u))._geomType=G.geomType?t.GeomTypeEnum[G.geomType]:0,O.drawingGroups.push(D);for(x=0;x<G.set.length;x++){b=G.set[x],F=N;var k=0;for(P=0;P<b.nbIndices-2;P++)M[N++]=B.IB[E],M[N++]=B.IB[E+1+k],M[N++]=B.IB[E+2-k],E++,k=1-k;E+=2;V=new i.MeshPrimitive(b.identifier,D,F,N-F);b.cgmId&&(V.cgmId=b.cgmId),b.decoration&&(V.decoration=b.decoration),b.boundingSphere&&(V.boundingSphere=b.boundingSphere),D._primitives.push(V)}break;case i.ConnectivityTypeEnum.LINES:R&&(R.shading="Basic"),(U=G.gas)&&!U.set&&(U=i.convertToMaterial3js(G.gas,1)),(D=new i.DrawingGroup(U,R,1,N,G.nbIndices,void 0,void 0,t.GeomTypeEnum[G.geomType],void 0,u))._geomType=G.geomType?t.GeomTypeEnum[G.geomType]:0,O.drawingGroups.push(D);for(x=0;x<G.set.length;x++){b=G.set[x],V=new i.MeshPrimitive(b.identifier,D,N,b.nbIndices);b.cgmId&&(V.cgmId=b.cgmId),b.decoration&&(V.decoration=b.decoration),b.boundingSphere&&(V.boundingSphere=b.boundingSphere),D._primitives.push(V);for(P=0;P<b.nbIndices;P++)M[N++]=B.IB[E++]}break;case i.ConnectivityTypeEnum.LINE_STRIP:R&&(R.shading="Basic"),(U=G.gas)&&!U.set&&(U=i.convertToMaterial3js(G.gas,1)),(D=new i.DrawingGroup(U,R,1,N,G.nbIndices+G.more_indices,void 0,void 0,t.GeomTypeEnum[G.geomType],void 0,u))._geomType=G.geomType?t.GeomTypeEnum[G.geomType]:0,O.drawingGroups.push(D);for(x=0;x<G.set.length;x++){for(b=G.set[x],F=N,P=0;P<b.nbIndices-1;P++)M[N++]=B.IB[E++],M[N++]=B.IB[E];E++;V=new i.MeshPrimitive(b.identifier,D,F,N-F);b.cgmId&&(V.cgmId=b.cgmId),b.decoration&&(V.decoration=b.decoration),b.boundingSphere&&(V.boundingSphere=b.boundingSphere),D._primitives.push(V)}break;case i.ConnectivityTypeEnum.POINTS:var U;(U=G.gas)&&!U.set&&(U=i.convertToMaterial3js(G.gas,0)),(D=new i.DrawingGroup(U,R,0,N,G.nbIndices,void 0,void 0,t.GeomTypeEnum[G.geomType],void 0,u))._geomType=G.geomType?t.GeomTypeEnum[G.geomType]:0,O.drawingGroups.push(D);for(x=0;x<G.set.length;x++){b=G.set[x],V=new i.MeshPrimitive(b.identifier,D,N,b.nbIndices);b.cgmId&&(V.cgmId=b.cgmId),b.decoration&&(V.decoration=b.decoration),b.boundingSphere&&(V.boundingSphere=b.boundingSphere),D._primitives.push(V);for(P=0;P<b.nbIndices;P++)M[N++]=B.IB[E++]}}}O.vertexIndexArray=M;var j=new t.Color,H=new t.Color,q=new t.Color;if(e.fillAttr.color&&j.setRGB(e.fillAttr.color.r,e.fillAttr.color.g,e.fillAttr.color.b),e.lineAttr.color&&H.setRGB(e.lineAttr.color.r,e.lineAttr.color.g,e.lineAttr.color.b),O.gas.fill={color:j,opacity:null==e.fillAttr.color.a?1:e.fillAttr.color.a,solid:e.fillAttr.solid},O.gas.line={color:H,opacity:null==e.lineAttr.color.a?1:e.lineAttr.color.a,lineWidth:e.lineAttr.thickness,pattern:e.lineAttr.pattern||1},e.pointAttr&&(e.pointAttr.color&&q.setRGB(e.pointAttr.color.r,e.pointAttr.color.g,e.pointAttr.color.b),O.gas.point={color:q,opacity:null==e.pointAttr.color.a?1:e.pointAttr.color.a,pointsize:e.pointAttr.size}),!l){var W=[0,0,0],X=[0,0,0];if(O.vertexPositionArray){const t=O.vertexPositionArray;var K=t.length;if(K>=3){W=[t[0],t[1],t[2]],X=[t[0],t[1],t[2]];for(var Z=0;Z<K;Z+=3)t[Z]<W[0]&&(W[0]=t[Z]),t[Z+1]<W[1]&&(W[1]=t[Z+1]),t[Z+2]<W[2]&&(W[2]=t[Z+2]),t[Z]>X[0]&&(X[0]=t[Z]),t[Z+1]>X[1]&&(X[1]=t[Z+1]),t[Z+2]>X[2]&&(X[2]=t[Z+2])}}O.AABB={min:W,max:X}}return O},i.monoIndex=function(e,r,n,o){for(var s=0,a=0;a<e.length;a++)s+=e[a].nbIndices;var u=[];for(a=0;a<i.NumberOfComponents;a++)u[a]=[];var l=0;for(a=0;a<r.length;a++){if(null!=(v=r[a])&&(!(v.component>=i.NumberOfComponents)&&!v.indexBuffer&&v.data.length&&(void 0===v._isPlanar||!v._isPlanar))){var h=0;if(m=u[v.component].length){var c=u[v.component][m-1];h=c.offset+c.buffer.data.length/3}u[v.component].push({buffer:v,offset:h}),v._newOffset=h,h+v.data.length/3>l&&(l=h+v.data.length/3)}}for(a=0;a<r.length;a++){if(null!=(v=r[a])&&(!(v.component>=i.NumberOfComponents)&&!v.indexBuffer&&v.data.length&&null!=v._isPlanar&&v._isPlanar)){h=l;u[v.component].push({buffer:v,offset:h}),v._newOffset=h}}var p=new Uint32Array(s),d=[];for(a=0;a<i.NumberOfComponents;a++){var m;if(m=u[a].length){var g=u[a][m-1];d[a]=new Float32Array(3*g.offset+g.buffer.data.length);h=0;for(var f=0;f<m;f++){var v,y=(v=u[a][f]).buffer.data.length,x=v.buffer.data;if(h<3*v.offset){for(var b=h;b<3*v.offset;b++)d[a][b]=0;h=3*v.offset}if(null==n)d[a].set(x,h);else for(b=0;b<y;b+=3){var I=new t.Vector3(x[b],x[b+1],x[b+2]);1==a?I.applyMatrix4(o):0==a&&I.applyMatrix4(n),d[a][h+b]=I.x,d[a][h+b+1]=I.y,d[a][h+b+2]=I.z}h+=y}}else d[a]=null}var A=0;for(a=0;a<e.length;a++){var _=e[a],S=_.vertexComponents[0],P=r[S.bufferId];if(null!=P){var w=P._newOffset;if(null!=S.indices){var T=r[S.indices.bufferId];for(b=0;b<_.nbIndices;b++)p[A+b]=T.data[S.indices.offset+b]+S.offset+w}else for(b=0;b<_.nbIndices;b++)p[A+b]=w+S.offset+b;A+=_.nbIndices}}return{IB:p,VB:d}},i.deMultiIndex=function(e,r,n,o){null!=n&&null!=o||(n=null),void 0!==o&&o instanceof t.Matrix4&&((o=(new t.Matrix4).copy(o)).elements[12]=0,o.elements[13]=0,o.elements[14]=0);for(var s=0,a=0;a<e.length;a++)s+=e[a].nbIndices;var u=[],l=[],h=0;for(a=0;a<i.NumberOfComponents;a++)u[a]=null;for(a=0;a<e.length;a++){for(var c=e[a],p=0;p<c.nbVertexComponents;p++){var d=c.vertexComponents[p];if(null==u[d.component]){u[d.component]=[],l[d.component]=d.bufferId;for(var m=0;m<s;m++)u[d.component][m]=null}r[d.bufferId];var g=null;if(null!=d.indices&&(g=r[d.indices.bufferId]),null!=g)for(m=0;m<c.nbIndices;m++)u[d.component][h+m]={bufferId:d.bufferId,index:d.offset+g.data[d.indices.offset+m]};else for(m=0;m<c.nbIndices;m++)u[d.component][h+m]={bufferId:d.bufferId,index:d.offset+m}}h+=c.nbIndices}var f=[];for(p=0;p<s;p++){(A=new i.MultiIndexMultiBuffer).old_index=p;for(a=0;a<i.NumberOfComponents;a++)null!==u[a]&&(A.comp[a]=u[a][p]);f.push(A)}f.sort((function(t,e){for(var r=0,n=0,o=0;o<i.NumberOfComponents;o++)if(null!=t.comp[o]&&null!=e.comp[o]){if(t.comp[o].index<e.comp[o].index)return-1;if(t.comp[o].index>e.comp[o].index)return 1;if(t.comp[o].bufferId<e.comp[o].bufferId)return-1;if(t.comp[o].bufferId>e.comp[o].bufferId)return 1}else null==t.comp[o]&&r++,null==e.comp[o]&&n++;return r<n?-1:r>n?1:0}));var v=new Uint32Array(s),y=[];for(a=0;a<i.NumberOfComponents;a++)if(null!==u[a]){var x=r[l[a]].dimension;y[a]=new Float32Array(x*s)}else y[a]=null;var b=-1,I=null;for(a=0;a<f.length;a++){var A,_=(A=f[a]).old_index;if(!a||!A.componentsEqual(I)){b++,I=A;for(p=0;p<i.NumberOfComponents;p++)if(null!=A.comp[p]){var S=r[A.comp[p].bufferId].data,P=r[A.comp[p].bufferId].dimension;if(null==n)for(m=0;m<P;m++)y[p][P*b+m]=S[P*u[p][A.old_index].index+m];else{var w=new t.Vector3(S[3*u[p][A.old_index].index],S[3*u[p][A.old_index].index+1],S[3*u[p][A.old_index].index+2]);1==p?(w.applyMatrix4(o),y[p][3*b]=w.x,y[p][3*b+1]=w.y,y[p][3*b+2]=w.z):0==p?(w.applyMatrix4(n),y[p][3*b]=w.x,y[p][3*b+1]=w.y,y[p][3*b+2]=w.z):(y[p][3*b]=w.x,y[p][3*b+1]=w.y,y[p][3*b+2]=w.z)}}}v[_]=b}var T=[];for(a=0;a<i.NumberOfComponents;a++){var C=y[a];if(null!==C){var G=r[l[a]].dimension*(b+1),B=new Float32Array(G);for(p=0;p<G;p++)B[p]=C[p];T[a]=B}else T[a]=null}return{IB:v,VB:T}},i.MeshContextEnum={UNKNOWN:0,DATA:1,FLOATBUFFER:2,INDEXBUFFER:3,COMPRESSEDBUFFER:4,PRIMITIVE:5,VERTEXCOMPONENT:6,GRAPHICPROPERTIES:7,APPEARANCE:8,BAG:9,MESH:10,TEXT:11},i.NumberOfComponents=7,i.MultiIndex=function(){this.old_index=0,this.comp=[],this.comp[0]=-1,this.comp[1]=-1,this.comp[2]=-1,this.comp[3]=-1,this.comp[4]=-1,this.comp[5]=-1,this.comp[6]=-1},i.MultiIndex.prototype={constructor:i.MultiIndex,componentsEqual:function(t){for(var e=0;e<i.NumberOfComponents;e++)if(-1!=this.comp[e]&&-1!=t.comp[e]&&this.comp[e]!=t.comp[e])return!1;return!0}},i.MultiIndexMultiBuffer=function(){this.old_index=0,this.comp=[];for(var t=0;t<i.NumberOfComponents;t++)this.comp[t]=null},i.MultiIndexMultiBuffer.prototype={constructor:i.MultiIndexMultiBuffer,componentsEqual:function(t){for(var e=0;e<i.NumberOfComponents;e++)if(null!=this.comp[e]&&null!=t.comp[e]){if(this.comp[e].bufferId!=t.comp[e].bufferId)return!1;if(this.comp[e].index!=t.comp[e].index)return!1}return!0}},i.Node=function(t,e,i,r,n,o,s){this.id=void 0!==t?t:"",this.type=void 0!==e?e:"Bag",this.childNodes=void 0!==i?i:[],this.matrix=void 0!==r?r:null,this.position=void 0!==n?n:{},this.rotation=void 0!==o?o:{},this.scale=void 0!==s?s:{}},i.Node.prototype={constructor:i.Node,add:function(t){null!=t&&this.childNodes.push(t)},childClone:function(){var t=new Array;for(var e in this.childNodes)t[e]="object"==typeof this.childNodes[e]?this.childNodes[e].clone():this.childNodes[e];return t},matrixClone:function(){if(this.matrix){var e=new t.Matrix4;return e.copy(this.matrix),e}},clone:function(){return new i.Node(this.id,this.type,this.childClone(),this.matrixClone(),this.position,this.rotation,this.scale)}},i.Mesh=function(t,e,r,n,o,s,a,u,l,h,c,p,d,m,g){this.id=void 0!==t?t:"",this.type=void 0!==e?e:"Mesh",this.vertexPositionArray=void 0!==r?r:null,this.positionCompression=void 0!==m?m:0,this.normalCompression=void 0!==g?g:0,this.vertexNormalArray=void 0!==n?n:null,this.vertexIndexArray=void 0!==o?o:null,this.vertexUvArray=void 0!==s?s:null,this.drawingGroups=void 0!==a?a:[],this.noZDgIndex=[],this._advancedInheritance=void 0!==d?d:null,this.gas=void 0!==u?u:{fill:{},line:{}},this.AABB=void 0!==l?l:{},this._radius=0,this.material=void 0!==h?h:null,this.matrix=void 0!==p?p:null,this.rep=void 0!==c?new i.SGRep({cgmId:c.cgmId}):new i.SGRep},i.Mesh.prototype={constructor:i.Mesh,setMatrix:function(t){this.matrix=t},indexCopy:function(){return this.vertexIndexArray instanceof Uint32Array?new Uint32Array(this.vertexIndexArray):this.vertexIndexArray instanceof Uint16Array?new Uint16Array(this.vertexIndexArray):this.vertexIndexArray instanceof Array?new Uint32Array(this.vertexIndexArray):void 0},compressedTabCopy:function(t,e){if(t instanceof Uint16Array){for(var i=new Uint16Array(t.length),r=0;r<t.length;r++)i[4*r]=t[4*r],i[4*r+1]=t[4*r+1],i[4*r+2]=t[4*r+2],i[4*r+3]=e;return i}},tabCopy:function(t){return t instanceof Float32Array?new Float32Array(t):t instanceof Uint8Array?new Uint8Array(t):t instanceof Array?new Float32Array(t):void 0},gasCopy:function(){var t;return this.gas&&(t={fill:this.gas.fill,line:this.gas.line}),t},AABBCopy:function(){return this.AABB.min&&this.AABB.max?{min:[this.AABB.min[0],this.AABB.min[1],this.AABB.min[2]],max:[this.AABB.max[0],this.AABB.max[1],this.AABB.max[2]]}:{}},dGCopy:function(){var t=new Array;for(var e in this.drawingGroups)t[e]="object"==typeof this.drawingGroups[e]?this.drawingGroups[e].clone():this.drawingGroups[e];return t},clone:function(){var t=new i.Mesh(this.id,this.type,this.tabCopy(this.vertexPositionArray),this.tabCopy(this.vertexNormalArray),this.indexCopy(),this.tabCopy(this.vertexUvArray),this.dGCopy(),this.gasCopy(),this.AABBCopy(),this.material,this.rep,null,this._advancedInheritance,this.positionCompression,this.normalCompression);return this.vertexBinormalArray&&(t.vertexBinormalArray=this.tabCopy(this.vertexBinormalArray)),this.vertexTangentArray&&(t.vertexTangentArray=this.tabCopy(this.vertexTangentArray)),t},cloneCompressedCGR:function(t){var e=new i.Mesh(this.id,this.type,this.compressedTabCopy(this.vertexPositionArray,t),this.tabCopy(this.vertexNormalArray),this.indexCopy(),this.tabCopy(this.vertexUvArray),this.dGCopy(),this.gasCopy(),this.AABBCopy(),this.material,this.rep,null,this._advancedInheritance,this.positionCompression,this.normalCompression);return this.vertexBinormalArray&&(e.vertexBinormalArray=this.tabCopy(this.vertexBinormalArray)),this.vertexTangentArray&&(e.vertexTangentArray=this.tabCopy(this.vertexTangentArray)),e}},i.MeshPrimitive=function(t,e,i,r,n){this.cgmId=t||0,this.groupIndex=e||0,this.start=i||0,this.count=r||0,this.boundingSphere=void 0,this.rep=0,this.decoration=n||0},i.MeshPrimitive.prototype={constructor:i.MeshPrimitive,clone:function(){if(this.boundingSphere){var t=new i.MeshPrimitive(this.cgmId,this.groupIndex,this.start,this.count,this.decoration);return t.boundingSphere={center:this.boundingSphere.center,radius:this.boundingSphere.radius},t}return this}};i.DGCullingData=class{constructor(t={}){t.repArraysToCull?this.repArraysToCull=t.repArraysToCull:(this.repArraysToCull=[t.generic||[]],t.planar&&this.repArraysToCull.push(t.planar))}set(t,e){this.repArraysToCull[t]=e}get(t){return this.repArraysToCull[t]}get generic(){return this.get(0)}set generic(t){return this.set(0,t)}get planar(){return this.get(1)}set planar(t){return this.set(1,t)}numReps(){let t=0;for(let e=0;e<this.repArraysToCull.length;e++)t+=this.repArraysToCull[e].length;return t}},i.DrawingGroup=function(t,e,r,n,o,s,a,u,l,h,c,p){this.gas=t||null,this.material=e||null,this.glType=r,this._geomType=u||0,this.gasIndex=l,this.start=n||0,this.count=o||0,this._primitives=void 0!==s?s:[],this.geometry=null,this._noZPriority=void 0!==h?h:-1/0,this._advancedInheritance=void 0!==c?c:null,this.nonIndexed=!1,this.cullingData=null,this._nonBinary=!(this._primitives instanceof i.BinarySGPrimitiveArray),this._dimension=-1,this._instancingInfos=null,this._dependentDGs=null,this._updateLineWithShapes=null,this._completeSolid=!1,this._noPick=p||!1,this.numPlanarIndices=0,this.indirectBuffer=null,this.indirectBufferOffset=0},i.DrawingGroup.prototype={constructor:i.DrawingGroup,clone:function(){var t=new i.DrawingGroup(this.gas&&this.gas.clone(),this.material,this.glType,this.start,this.count,void 0,void 0,this._geomType,this.gasIndex,this._noZPriority,this._advancedInheritance,this._noPick);if(t.copyPrimitives(this._primitives),t.geometry=this.geometry,t._dimension=this._dimension,t._instancingInfos=this._instancingInfos,t._instancingInfos){const e=t._instancingInfos.instanceAttribArrays;for(let t in e)e[t].buffer=null}return t._updateLineWithShapes=this._updateLineWithShapes,t._completeSolid=this._completeSolid,t.numPlanarIndices=this.numPlanarIndices,t},setInstancingParameters:function(t,i,r){let n={};if(null!==this._instancingInfos){let t=this._instancingInfos.instanceAttribArrays;for(let e in t)null!==t[e].buffer&&void 0!==t[e].buffer&&(n[e]=t[e].buffer)}e--,this._instancingInfos={nbInstances:t,drawCount:t,instancingSelectionMode:r||"instance",instanceAttribArrays:{},instanceAttribArrays_id:e,pickedInstanceId:-1,staleGLBuffers:[],useDefaultInstancing:!1};let o=this._instancingInfos.instanceAttribArrays,s=new Float32Array(t);for(var a=0;a<t;a++)s[a]=5+5*a;o.instanceId={},o.instanceId.array=s,o.instanceId.buffer=null,o.instanceId.itemSize=1,o.instanceId.type="f";for(let e=0;e<i.length;e++){const r=i[e];switch(o[r.attribName]={isMat4:!1,itemSize:0,array:r.isFlattened?new Float32Array(r.data):null,buffer:null,type:r.type},r.type){case"f":o[r.attribName].itemSize=1;break;case"v2":o[r.attribName].itemSize=2;break;case"v3":o[r.attribName].itemSize=3;break;case"v4":o[r.attribName].itemSize=4;break;case"m4":o[r.attribName].itemSize=4,o[r.attribName].isMat4=!0}if(!r.isFlattened)switch(r.type){case"v2":o[r.attribName].array=new Float32Array(2*t);for(var u=0;u<t;u++)o[r.attribName].array[2*u+0]=r.data[u].x,o[r.attribName].array[2*u+1]=r.data[u].y;break;case"v3":o[r.attribName].array=new Float32Array(3*t);for(u=0;u<t;u++)o[r.attribName].array[3*u+0]=r.data[u].x,o[r.attribName].array[3*u+1]=r.data[u].y,o[r.attribName].array[3*u+2]=r.data[u].z;break;case"v4":o[r.attribName].array=new Float32Array(4*t);for(u=0;u<t;u++)o[r.attribName].array[4*u+0]=r.data[u].x,o[r.attribName].array[4*u+1]=r.data[u].y,o[r.attribName].array[4*u+2]=r.data[u].z,o[r.attribName].array[4*u+3]=r.data[u].w;break;case"m4":o[r.attribName].array=new Float32Array(16*r.data.length);for(var l=0;l<r.data.length;l++){var h=new Float32Array(16);h=r.data[l].elements;for(a=0;a<16;a++)o[r.attribName].array[16*l+a]=h[a]}}}for(let t in n)void 0!==o[t]?(o[t].buffer=n[t],o[t].isDynamic=!0):this._instancingInfos.staleGLBuffers.push(n[t]);if(this.material._PDSFXData&&this.material._PDSFXData.PDSFX){const t=this.material;t._PDSFXData.pdsfxAttributesInternal={};for(let e=0;e<i.length;e++)t._PDSFXData.pdsfxAttributesInternal[i[e].attribName]={type:i[e].type,instancing:!0}}},_compactArrays:function(){if(this._nonBinary){var t=this._primitives;this._primitives=new Array(t.length);for(var e=0;e<t.length;e++)this._primitives[e]=t[e]}else this._primitives._compactArrays()},_getDimension:function(t,e){var i=2,r=this;if(r._geomType)i=t[r._geomType];else switch(r.glType){case 0:i=0;break;case 1:i=1;break;default:i=2}return 2===i&&(i=r.gas&&0===r.gas.side?5:2),this._dimension=i,i},copyPrimitives:function(t){var e=null;if(t instanceof i.BinarySGPrimitiveArray)return this._primitives=t.clone(),void(this._nonBinary=!1);this._nonBinary=!0,this._primitives=new Array(t.length);for(var r=0;r<t.length;r++)if((e=t[r])instanceof i.SGPrimitive)this._primitives[r]=e.clone();else{var n=new i.SGPrimitive;n.cgmId=e.cgmId,n.rep=e.rep,n.group=this,n.start=e.start,n.count=e.count,this._primitives[r]=n}},_computeOrientedBoundingBox:function(e,i,r,n,o,s,a){if(!e||this.isFiltered(i,a)||n&&r===t.FixedSizeFiltering.Exclude)return null;if(n&&r===t.FixedSizeFiltering.CenterOnly)return new t.Box3(new t.Vector3(0,0,0),new t.Vector3(0,0,0)).applyMatrix4(e);var u=new t.Vector3,l=new t.Vector3,h=new t.Vector3,c=new t.Vector3,p=null!==o?o:this.start,d=null!==s?s:this.count,m=this.geometry.vertexIndexArray;if(this.geometry.getVertexCount()){var g=m[p];this.geometry.getVertexPosition(g,c),l.set(c.x,c.y,c.z).applyMatrix4(e),h.set(c.x,c.y,c.z).applyMatrix4(e);for(var f=p+1;f<p+d;f++)g=m[f],this.geometry.getVertexPosition(g,c),u.set(c.x,c.y,c.z).applyMatrix4(e),u.x<l.x&&(l.x=u.x),u.y<l.y&&(l.y=u.y),u.z<l.z&&(l.z=u.z),u.x>h.x&&(h.x=u.x),u.y>h.y&&(h.y=u.y),u.z>h.z&&(h.z=u.z)}return new t.Box3(l,h)},_computePrimitiveOrientedBoundingBox:function(t,e,i,r,n,o){return this._nonBinary?this._primitives[t]._computeOrientedBoundingBox(e,i,r,n,o):this._primitives._computePrimitiveOrientedBoundingBox(t,e,i,r,n,o)},disabled:function(t,e,i){return console.warn("Deprecated, use isFiltered instead"),e=e||0,this.isFiltered(t&~e,i)},isFiltered:function(t,e){var i=e||this._geomType;return!(t<0||0===i)&&!((i&t)>0)},getPrimitiveCgmId:function(t){return this._nonBinary?this._primitives[t].cgmId:this._primitives.getPrimitiveCgmId(t)},_setPrimitiveCgmId:function(t,e){this._nonBinary?this._primitives[e].cgmId=t:this._primitives._setPrimitiveCgmId(t,e)},getPrimitiveType:function(t){return this._nonBinary?this._primitives[t].type:this._primitives.getPrimitiveType(t)},getPrimitiveRep:function(t){return this._nonBinary?this._primitives[t].rep:this._primitives.getPrimitiveRep(t)},_getSGPrimitive:function(t,e){return this._nonBinary?e?this._primitives[t]:this._primitives[t].clone():this._primitives._getSGPrimitive(t,e)},_getPrimitiveInternalNode:function(t){return this._nonBinary?this._primitives[t].internalNode:this._primitives._getPrimitiveInternalNode(t)},_setPrimitiveRep:function(t,e){this._nonBinary?this._primitives[e].rep=t:this._primitives._setPrimitiveRep(t,e)},_setPrimitiveInternalNode:function(t,e){this._nonBinary?this._primitives[e].internalNode=t:this._primitives._setPrimitiveInternalNode(t,e)},_setPrimitiveStart:function(t,e){this._nonBinary?this._primitives[e].start=t:this._primitives._setPrimitiveStart(t,e)},_setPrimitiveCount:function(t,e){this._nonBinary?this._primitives[e].count=t:this._primitives._setPrimitiveCount(t,e)},getPrimitiveStart:function(t){return this._nonBinary?this._primitives[t].start:this._primitives.getPrimitiveStart(t)},getPrimitiveCount:function(t){return this._nonBinary?this._primitives[t].count:this._primitives.getPrimitiveCount(t)},getPrimitiveGroup:function(t){return this._nonBinary?this._primitives[t].group:this._primitives.getPrimitiveGroup(t)},getPrimitiveDecoration:function(t){return this._nonBinary?this._primitives[t].decoration:this._primitives.getPrimitiveDecoration(t)},getPrimitiveBoundingSphere:function(t){return this._nonBinary?this._primitives[t].boundingSphere:this._primitives.getPrimitiveBoundingSphere(t)},setPrimitiveBoundingSphere:function(t,e){this._nonBinary?this._primitives[t].boundingSphere=e:this._primitives.setPrimitiveBoundingSphere(t,e)},getPrimitivesCount:function(){return this._nonBinary?this._primitives.length:this._primitives.getPrimitivesCount()},getPrimitiveIdentificationObject:function(t){return this._nonBinary?this._primitives[t].IdentObj:this._primitives.getPrimitiveIdentificationObject(t)},setPrimitiveIdentificationObject:function(t,e){this._nonBinary?this._primitives[e].IdentObj=t:this._primitives.setPrimitiveIdentificationObject(t,e)},computePrimitiveBoundingSphere:function(t,e){return this._nonBinary?this._primitives[t].computeBoundingSphere(e):this._primitives.computePrimitiveBoundingSphere(t,e)},startIteration:function(){return!0},endIteration:function(){return!0},computeCompleteSolidStatus:function(){let t=!0;if(4===this.glType){let e,i=new Map,r=new Set,n=this.getPrimitivesCount();for(e=0;t&&e<n;e++){let n=this.getPrimitiveRep(e);if(n&&1===n.solid){let t=i.get(n)||0;t++,i.set(n,t),r.add(n)}else t=!1}r.forEach((e=>{if(e){i.get(e)!==e.getPrimitivesCountWithGLType(4)&&(t=!1)}else t=!1}))}else t=!1;t&&(this._completeSolid=!0)}},Object.defineProperty(i.DrawingGroup.prototype,"geomType",{get:function(){return console.warn("[Mesh.DrawingGroup] DOT NOT ACCESS geomType directly !\n"),i.GeomTypeString[this._geomType]},set:function(e){console.warn("[Mesh.DrawingGroup] DOT NOT ACCESS geomType directly !\n"),this._geomType=t.GeomTypeEnum[e]}});var m=0;Object.defineProperty(i.DrawingGroup.prototype,"primitives",{get:function(){if(m<10){var t=new Error,e="#PrimApi - DG.GetPrimitives - "+(t.stack?t.stack.split("\n")[1]+" - "+t.stack.split("\n")[2]:"");r.has(e.hashCode())||(r.add(e.hashCode()),console.error(e)),m++}return this._primitives},set:function(){throw"NO"}}),i.SelectionGroup=function(){this.geometries={}},i.SelectionGroup.prototype={constructor:i.SelectionGroup,contains:function(t){for(var e in this.geometries)for(var i=this.geometries[e],r=0;r<i.length;r++)for(var n=i[r].primitives,o=0;o<n.length;o++)if(n[o].isEqual(t))return!0;return!1},getFirstPrimitive:function(){for(var t in this.geometries){var e=this.geometries[t];if(e.length&&e[0].primitives.length)return e[0].primitives[0]}return null},getPrimitives:function(){var t=[];for(var e in this.geometries)for(var i=this.geometries[e],r=0;r<i.length;r++)for(var n=i[r].primitives,o=0;o<n.length;o++)t.push(n[o]);return t},applyToPrimitives:function(t){for(var e in this.geometries)for(var i=this.geometries[e],r=0;r<i.length;r++)for(var n=i[r].primitives,o=0;o<n.length;o++)t&&t(n[o])},addPrimitive:function(t){var e=0,i=t.getGroup(),r=i.geometry.id,n=this.geometries[r];for(n||(n=[],this.geometries[r]=n),e=0;e<n.length;e++)if(n[e].drawingGroup===i){n[e].primitives.push(t);break}e===n.length&&n.push({drawingGroup:i,primitives:[t]})},clone:function(){var t=new i.SelectionGroup;for(var e in this.geometries){var r=this.geometries[e];t.geometries[e]=[];for(var n=0;n<r.length;n++)t.geometries[e][n]={drawingGroup:r[n].drawingGroup,primitives:r[n].primitives.slice()}}return t},getIdentificationObject:function(){for(const t in this.geometries){const e=this.geometries[t];for(let t=0;t<e.length;t++){const i=e[t];for(let t=0;t<(i?.primitives?.length??0);t++){const e=i.primitives[t],r=e?.getIdentificationObject();if(r&&!r.isEmpty())return r}}}},computeBoundingSphere:function(){for(var e=null,i=new t.Sphere,r=this.getPrimitives(),n=0;n<r.length;n++){r[n].computeBoundingSphere(i),e?i.mergeWithSphere(e,e):e=i.clone()}return e},_computeOrientedBoundingBox:function(e,i,r,n,o){for(var s,a=new t.Box3,u=this.getPrimitives(),l=0;l<u.length;l++){(s=u[l]._computeOrientedBoundingBox(e,i,r,n,o))&&(a=a.union(s))}return a}};class g{constructor({computeCullingData:t,withBoundingElement:e,maintainMaterial:i,containNoShow:r}){this.options={computeCullingData:t,withBoundingElement:e,maintainMaterial:i,containNoShow:r},this.mergedGroup=[],this.glType=0,this.geomType=0,this.gas=null,this.material=null,this.gasIndex=-1,this.refGasForGasIndex=null,this._advancedInheritance=null,this.start=0,this.count=0,this.numPlanarIndices=0}compatible(t){return t.glType==this.glType&&t._geomType===this.geomType&&this.gas.isEqual(t.gas)&&(null==this.material&&null==t.material||null!=this.material&&null!=t.material&&this.material.id==t.material.id&&this.material.file==t.material.file)&&(null==this._advancedInheritance&&null==t._advancedInheritance||null!=this._advancedInheritance&&null!=t._advancedInheritance&&this._advancedInheritance.lineWeight==t._advancedInheritance.lineWeight&&this._advancedInheritance.lineType==t._advancedInheritance.lineType&&this._advancedInheritance.lineTypeScale==t._advancedInheritance.lineTypeScale)}reset(t){this.mergedGroup=[],this.refGasForGasIndex&&this.refGasForGasIndex.isEqual(t.gas)||(this.refGasForGasIndex=t.gas,this.gasIndex++),this.glType=t.glType,this._advancedInheritance=t._advancedInheritance,this.geomType=t._geomType,this.gas=t.gas,this.options.maintainMaterial||(this.material=t.material),this.start+=this.count,this.count=0,this.numPlanarIndices=0}add(t){this.count+=t.count,this.numPlanarIndices+=t.numPlanarIndices,this.mergedGroup.push(t)}write_indices(t,e,i){if(0===this.count)return;let r=this.start;for(let n=0;n<this.mergedGroup.length;n++){const o=this.mergedGroup[n],s=o.count-o.numPlanarIndices,a=e.get(o),u=i.get(o);for(let e=0;e<s;e++)t[r++]=u+a[o.start+e]}for(let n=0;n<this.mergedGroup.length;n++){const o=this.mergedGroup[n],s=o.count-o.numPlanarIndices,a=e.get(o),u=i.get(o);for(let e=s;e<o.count;e++)t[r++]=u+a[o.start+e]}}get_culling_data(){if(!this.options.computeCullingData||0===this.count||this.mergedGroup.length<2)return null;let t=this.start;const e=new i.DGCullingData;for(let i=0;i<this.mergedGroup.length;i++){const r=this.mergedGroup[i],n=r.count-r.numPlanarIndices;e.generic.push({start:t,count:n,radius:r.geometry._radius,rep:r.geometry.rep}),t+=n}for(let i=0;i<this.mergedGroup.length;i++){const r=this.mergedGroup[i];0!==r.numPlanarIndices&&(void 0===e.planar&&(e.planar=[]),e.planar.push({start:t,count:r.numPlanarIndices,radius:r.geometry._radius,rep:r.geometry.rep}),t+=r.numPlanarIndices)}return e}get_merged_drawing_group({sgPrimLength:t,bsPrimLength:e}){if(0===this.count)return null;const r=new i.DrawingGroup(this.gas,this.material,this.glType,this.start,this.count,void 0,void 0,this.geomType,this.gasIndex,void 0,this._advancedInheritance);r.cullingData=this.get_culling_data(),r.numPlanarIndices=this.numPlanarIndices;let n=0;for(let t=0;t<this.mergedGroup.length;++t)n+=this.mergedGroup[t]._primitives.length;const o=new Uint32Array(t*n);let s=null;this.options.withBoundingElement&&r.glType>0&&(s=new Float32Array(e*n));let a=0,u=this.start;const l=[];for(let i=0;i<this.mergedGroup.length;++i){const r=this.mergedGroup[i];let n=t*a;if(r.geometry.noShow&&this.options.containNoShow)for(let t=0;t<r._primitives.length;t++){const i=r._primitives[t];if(l.push(a),o[n++]=i.cgmId+1,o[n++]=i.rep,o[n++]=u,o[n++]=i.count,o[n++]=i.decoration,s&&i.boundingSphere){const t=a*e;s[t]=i.boundingSphere.center[0],s[t+1]=i.boundingSphere.center[1],s[t+2]=i.boundingSphere.center[2],s[t+3]=i.boundingSphere.radius}a++,u+=i.count}else for(let t=0;t<r._primitives.length;t++){const i=r._primitives[t];if(o[n++]=i.cgmId+1,o[n++]=i.rep,o[n++]=u,o[n++]=i.count,o[n++]=i.decoration,s&&i.boundingSphere){const t=a*e;s[t]=i.boundingSphere.center[0],s[t+1]=i.boundingSphere.center[1],s[t+2]=i.boundingSphere.center[2],s[t+3]=i.boundingSphere.radius}a++,u+=i.count}}return r._primitives=s?{prims:o,bs:s}:o,l.length&&(r.noShowPrim=l),r}extract(t,{indexArray:e,group_indices:i,group_vbStart:r,sgPrimLength:n,bsPrimLength:o}){this.write_indices(e,i,r);const s=this.get_merged_drawing_group({sgPrimLength:n,bsPrimLength:o});s&&t.push(s)}}i.processRepsCGR=function(e,r,n,o,s,a,u,l){for(var h=0,c=0,p=0,d=0,m=!r,f=[],v=!(!a||!a.length),y=[],x=o||{},b=!1,I=!1,A=!1,_=!1,S=!1,P=!1,w=0;w<e.length;w++)h+=e[w].vertexPositionArray?e[w].vertexPositionArray.length:0,d+=e[w].vertexIndexArray.length,b||null===e[w].vertexNormalArray||(b=!0),I||null===e[w].vertexUvArray||(I=!0),!A&&e[w].vertexUv2Array&&(A=!0),!_&&e[w].vertexTangentArray&&(_=!0),!S&&e[w].vertexBinormalArray&&(S=!0),!P&&e[w].vertexColorArray&&(P=!0);var T,C=null;u?(c=h/4,C=new Uint16Array(h)):(c=h/3,C=new Float32Array(h)),T=c<65535?new Uint16Array(d):new Uint32Array(d);var G=null;b&&(l?(p=l==i.CATSGPlayRepDataOptions.NormalOct16Compression?c:h/3,G=new Float32Array(p)):G=new Float32Array(h));var B=I?new Float32Array(3*c):null,O=A?new Float32Array(3*c):null,M=_?new Float32Array(3*c):null,E=S?new Float32Array(3*c):null,N=P?new Float32Array(4*c):null,z=0,D=0,R=0;const V=new Map,F=new Map;for(w=0;w<e.length;w++){var L=e[w];if(!L.disable){var k=L.vertexPositionArray;if(k){if(u?C.set(k,D):C.set(k,z),null!==G&&L.vertexNormalArray)if(l&&l==i.CATSGPlayRepDataOptions.NormalOct16Compression){let t=L.vertexNormalArray.length;for(var U=0;U<t;U++){var j=L.vertexNormalArray[2*U],H=L.vertexNormalArray[2*U+1];G[R+U]=256*j+H}R+=L.vertexNormalArray.length/2}else if(l&&l==i.CATSGPlayRepDataOptions.NormalOct24Compression){let t=L.vertexNormalArray.length;for(U=0;U<t;U++){j=L.vertexNormalArray[3*U],H=L.vertexNormalArray[3*U+1];var q=L.vertexNormalArray[3*U+2],W=16*j+Math.floor(H/16),X=H%16*256+q;G[R+U]=4096*W+X}R+=L.vertexNormalArray.length/3}else G.set(L.vertexNormalArray,z);null!==B&&L.vertexUvArray&&B.set(L.vertexUvArray,z),null!==O&&L.vertexUv2Array&&O.set(L.vertexUv2Array,z),null!==M&&L.vertexTangentArray&&M.set(L.vertexTangentArray,z),null!==E&&L.vertexBinormalArray&&E.set(L.vertexBinormalArray,z),null!==N&&L.vertexColorArray&&N.set(L.vertexColorArray,z)}for(var K=0;K<L.drawingGroups.length;K++){var Z=L.drawingGroups[K];L._advancedInheritance&&(Z._advancedInheritance=L._advancedInheritance),F.set(Z,z/3),V.set(Z,L.vertexIndexArray),Z.geometry=e[w],null==Z.gas&&(4==Z.glType||5==Z.glType?Z.gas=e[w].gas.fill:1==Z.glType?Z.gas=e[w].gas.line:0==Z.glType&&(Z.gas=e[w].gas.point));for(U=0;U<Z._primitives.length;U++){var Y=Z._primitives[U];if(Y.rep=L.rep,Y.boundingSphere){var Q=new t.Vector3(Y.boundingSphere.center[0],Y.boundingSphere.center[1],Y.boundingSphere.center[2]);!!L.globalMatrix&&!L.globalMatrix.isIdentity()&&(Q.applyMatrix4(e[w].globalMatrix),Y.boundingSphere.center=[Q.x,Q.y,Q.z],Y.boundingSphere.radius*=e[w].globalMatrix.getMaxScaleOnAxis())}}o.withSceneGraphOrder||v&&(!v||Z.gas.isNoZ())||f.push(Z)}var J=0;if(k&&(J=k.length),u?(D+=J,z+=J/4*3):z+=J,v||o.withSceneGraphOrder)for(U=0;U<L.noZDgIndex.length;U++)y.push(L.noZDgIndex[U])}}if(f.length&&f.sort((function(t,e){if(t.glType<e.glType)return 1;if(t.glType>e.glType)return-1;if(null==t.material&&null!=e.material)return-1;if(null!=t.material&&null==e.material)return 1;if(null!=t.material&&null!=e.material){if(t.material.id<e.material.id)return-1;if(t.material.id>e.material.id)return 1;if(t.material.file<e.material.file)return-1;if(t.material.file>e.material.file)return 1}if(null==t.gas&&null!=e.gas)return-1;if(null!=t.gas&&null==e.gas)return-1;if(null!=t.gas&&null!=e.gas){if(t.gas.set<e.gas.set)return 1;if(e.gas.set<t.gas.set)return-1;if(t.gas.rgba<e.gas.rgba)return 1;if(e.gas.rgba<t.gas.rgba)return-1}if(t._geomType&&e._geomType){if(t._geomType<e._geomType)return-1;if(t._geomType>e._geomType)return 1;if(n){if(t.geometry._radius<e.geometry._radius)return 1;if(t.geometry._radius>e.geometry._radius)return-1}}if(null!=t._advancedInheritance&&null!=e._advancedInheritance){if(t._advancedInheritance.lineWeight<e._advancedInheritance.lineWeight)return-1;if(t._advancedInheritance.lineWeight>e._advancedInheritance.lineWeight)return 1;if(t._advancedInheritance.lineType<e._advancedInheritance.lineType)return-1;if(t._advancedInheritance.lineType>e._advancedInheritance.lineType)return 1;if(t._advancedInheritance.lineTypeScale<e._advancedInheritance.lineTypeScale)return-1;if(t._advancedInheritance.lineTypeScale>e._advancedInheritance.lineTypeScale)return 1}if(n){if(t.geometry._radius<e.geometry._radius)return 1;if(t.geometry._radius>e.geometry._radius)return-1}return 0})),v){var $=y.length!==a.length;if($||f.length)if($){y.sort((function(t,e){return t-e}));for(var tt=0;tt<y.length;tt++)f.push(a[y[tt]])}else for(tt=0;tt<a.length;tt++)f.push(a[[tt]]);else f=a}const et=[],it=new g({computeCullingData:n,withBoundingElement:x.withBoundingElement,maintainMaterial:!1,containNoShow:x.containNoShow});it.reset(f[0]);for(let t=0;t<f.length;t++){const e=f[t];it.compatible(e)||(it.extract(et,{indexArray:T,group_indices:V,group_vbStart:F,sgPrimLength:5,bsPrimLength:4}),it.reset(e)),it.add(e)}it.extract(et,{indexArray:T,group_indices:V,group_vbStart:F,sgPrimLength:5,bsPrimLength:4});var rt=new i.Mesh;if(rt.positionCompression=u||0,rt.normalCompression=l||0,rt.vertexPositionArray=C,rt.vertexNormalArray=G,rt.vertexUvArray=B,rt.vertexUv2Array=O,rt.vertexTangentArray=M,rt.vertexBinormalArray=E,rt.vertexIndexArray=T,rt.vertexColorArray=N,rt.drawingGroups=et,void 0===e[0]){var nt=new t.Color;nt.setRGB(.5,.5,.5),rt.gas.fill={color:nt,opacity:1,solid:0},rt.gas.line={color:nt,opacity:1,lineWidth:1},rt.gas.point={color:nt,opacity:1,pointsize:1}}else rt.gas=e[0].gas;if(m){var ot=[0,0,0],st=[0,0,0];if(h>=3){ot=[C[0],C[1],C[2]],st=[C[0],C[1],C[2]];for(w=0;w<h;w+=3)C[w]<ot[0]&&(ot[0]=C[w]),C[w+1]<ot[1]&&(ot[1]=C[w+1]),C[w+2]<ot[2]&&(ot[2]=C[w+2]),C[w]>st[0]&&(st[0]=C[w]),C[w+1]>st[1]&&(st[1]=C[w+1]),C[w+2]>st[2]&&(st[2]=C[w+2])}rt.AABB={min:ot,max:st}}return rt},i.processReps=function(e,r,n){for(var o=0,s=0,a=!r,u=[],l=!1,h=!1,c=!1,p=!1,d=!1,m=0;m<e.length;m++)o+=e[m].vertexPositionArray?e[m].vertexPositionArray.length:0,s+=e[m].vertexIndexArray.length,l||null===e[m].vertexNormalArray||(l=!0),h||null===e[m].vertexUvArray||(h=!0),!c&&e[m].vertexUv2Array&&(c=!0),!p&&e[m].vertexTangentArray&&(p=!0),!d&&e[m].vertexBinormalArray&&(d=!0);var g,f=new Float32Array(o);g=o/3<65535?new Uint16Array(s):new Uint32Array(s);var v=l?new Float32Array(o):null,y=h?new Float32Array(o):null,x=c?new Float32Array(o):null,b=p?new Float32Array(o):null,I=d?new Float32Array(o):null,A=0;const _=new Map,S=new Map;for(m=0;m<e.length;m++){if(e[m].vertexPositionArray)for(var P=0;P<e[m].vertexPositionArray.length;P++)f[A+P]=e[m].vertexPositionArray[P],null!==v&&(v[A+P]=null!==e[m].vertexNormalArray?e[m].vertexNormalArray[P]:0),null!==y&&(y[A+P]=null!==e[m].vertexUvArray?e[m].vertexUvArray[P]:0),null!==x&&(x[A+P]=e[m].vertexUv2Array?e[m].vertexUv2Array[P]:0),null!==b&&(b[A+P]=e[m].vertexTangentArray?e[m].vertexTangentArray[P]:0),null!==I&&(I[A+P]=e[m].vertexBinormalArray?e[m].vertexBinormalArray[P]:0);for(P=0;P<e[m].drawingGroups.length;P++){var w=e[m].drawingGroups[P];S.set(w,A/3),_.set(w,e[m].vertexIndexArray),w.geometry=e[m],null==w.gas&&(4==w.glType||5==w.glType?w.gas=e[m].gas.fill:1==w.glType?w.gas=e[m].gas.line:0==w.glType&&(w.gas=e[m].gas.point));for(var T=0;T<w._primitives.length;T++){if((j=w._primitives[T]).rep=e[m].rep,j.boundingSphere){var C=new t.Vector3(j.boundingSphere.center[0],j.boundingSphere.center[1],j.boundingSphere.center[2]);!!e[m].globalMatrix&&!e[m].globalMatrix.isIdentity()&&(C.applyMatrix4(e[m].globalMatrix),j.boundingSphere.center=[C.x,C.y,C.z],j.boundingSphere.radius*=e[m].globalMatrix.getMaxScaleOnAxis())}}u.push(w)}A+=e[m].vertexPositionArray?e[m].vertexPositionArray.length:0}u.sort((function(t,e){if(t.glType<e.glType)return-1;if(t.glType>e.glType)return 1;if(null==t.material&&null!=e.material)return-1;if(null!=t.material&&null==e.material)return 1;if(null!=t.material&&null!=e.material){if(t.material.id<e.material.id)return-1;if(t.material.id>e.material.id)return 1;if(t.material.file<e.material.file)return-1;if(t.material.file>e.material.file)return 1}if(null==t.gas&&null!=e.gas)return-1;if(null!=t.gas&&null==e.gas)return-1;if(null!=t.gas&&null!=e.gas){var r=i.compareGASMaterial(t.gas,e.gas);if(r)return r}if(t._geomType&&e._geomType){if(t._geomType<e._geomType)return-1;if(t._geomType>e._geomType)return 1;if(t.geometry._radius<e.geometry._radius)return 1;if(t.geometry._radius>e.geometry._radius)return-1}return t.geometry._radius<e.geometry._radius?1:t.geometry._radius>e.geometry._radius?-1:0}));var G=[],B=[],O=u.length>0?u[0].gas:null,M=u.length>0?u[0].material:null,E=u.length>0?u[0].glType:0,N=u.length>0?u[0]._geomType:0,z=0,D=0,R=0,V=0,F=O,L=[];for(m=0;m<u.length;m++){if((w=u[m]).glType==E&&w._geomType===N&&!i.compareGASMaterial(O,w.gas)&&(null==M&&null==w.material||null!=M&&null!=w.material&&M.id==w.material.id&&M.file==w.material.file)){n&&L.push({start:z,count:w.count,radius:w.geometry._radius,rep:w.geometry.rep}),R+=w.count;for(var k=z,U=0;U<w._primitives.length;U++){var j=w._primitives[U],H=new i.SGPrimitive({cgmId:j.cgmId,rep:j.rep,start:k,count:j.count});j.decoration&&(H.decoration=j.decoration),j.boundingSphere&&(H.boundingSphere=j.boundingSphere),B.push(H),j.rep._primitives.push(H),k+=j.count}const t=_.get(w),e=S.get(w);for(P=0;P<w.count;P++)g[z++]=e+t[w.start+P]}else{var q=null;if(R>0){(q=new i.DrawingGroup(O,M,E,D,R,void 0,void 0,N,V))._primitives=B,n&&(q.cullingData=new i.DGCullingData({generic:L}));for(var W=0;W<B.length;W++)B[W].group=q;G.push(q)}B=[],L=[],0!==i.compareGASMaterial(F,w.gas)&&(F=w.gas,V++),E=w.glType,N=w._geomType,O=w.gas,M=w.material,D=z,R=w.count,n&&L.push({start:z,count:w.count,radius:w.geometry._radius,rep:w.geometry.rep});for(k=z,U=0;U<w._primitives.length;U++){j=w._primitives[U],H=new i.SGPrimitive({cgmId:j.cgmId,rep:j.rep,start:k,count:j.count});j.decoration&&(H.decoration=j.decoration),j.boundingSphere&&(H.boundingSphere=j.boundingSphere),B.push(H),j.rep._primitives.push(H),k+=j.count}const t=_.get(w),e=S.get(w);for(P=0;P<w.count;P++)g[z++]=e+t[w.start+P]}}if(R>0){(q=new i.DrawingGroup(O,M,E,D,R,void 0,void 0,N,V))._primitives=B,n&&(q.cullingData=new i.DGCullingData({generic:L}));for(W=0;W<B.length;W++)B[W].group=q;G.push(q)}var X=new i.Mesh;if(X.vertexPositionArray=f,X.vertexNormalArray=v,X.vertexUvArray=y,X.vertexUv2Array=x,X.vertexTangentArray=b,X.vertexBinormalArray=I,X.vertexIndexArray=g,X.drawingGroups=G,void 0===e[0]){var K=new t.Color;K.setRGB(.5,.5,.5),X.gas.fill={color:K,opacity:1,solid:0},X.gas.line={color:K,opacity:1,lineWidth:1},X.gas.point={color:K,opacity:1,pointsize:1}}else X.gas=e[0].gas;if(a){var Z=[0,0,0],Y=[0,0,0];if(o>=3){Z=[f[0],f[1],f[2]],Y=[f[0],f[1],f[2]];for(m=0;m<o;m+=3)f[m]<Z[0]&&(Z[0]=f[m]),f[m+1]<Z[1]&&(Z[1]=f[m+1]),f[m+2]<Z[2]&&(Z[2]=f[m+2]),f[m]>Y[0]&&(Y[0]=f[m]),f[m+1]>Y[1]&&(Y[1]=f[m+1]),f[m+2]>Y[2]&&(Y[2]=f[m+2])}X.AABB={min:Z,max:Y}}return X},i.divideRep=function(t,e,r){var n=t.vertexPositionArray?t.vertexPositionArray.length:0,o=(t.vertexIndexArray.length,[]),s=r||{};if(e)for(var a=0,u=(s=r||{}).withBoundingElement,l=0;l<t.drawingGroups.length;l++){null==(x=t.drawingGroups[l]).gas&&(4==x.glType||5==x.glType?x.gas=t.gas.fill:1==x.glType?x.gas=t.gas.line:0==x.glType&&(x.gas=t.gas.point)),a=x._primitives.length;var h=new Uint32Array(5*a),c=null;u&&x.glType>0&&(c=new Float32Array(4*a));var p=0,d=0,m=[];if(t.noShow&&s.containNoShow)for(var g=0;g<x._primitives.length;g++){var f=x._primitives[g];m.push(g),h[p++]=f.cgmId+1,h[p++]=t.rep,h[p++]=f.start,h[p++]=f.count,h[p++]=f.decoration,c&&f.boundingSphere&&(c[d++]=f.boundingSphere.center[0],c[d++]=f.boundingSphere.center[1],c[d++]=f.boundingSphere.center[2],c[d++]=f.boundingSphere.radius)}else for(g=0;g<x._primitives.length;g++){f=x._primitives[g];h[p++]=f.cgmId+1,h[p++]=t.rep,h[p++]=f.start,h[p++]=f.count,h[p++]=f.decoration,c&&f.boundingSphere&&(c[d++]=f.boundingSphere.center[0],c[d++]=f.boundingSphere.center[1],c[d++]=f.boundingSphere.center[2],c[d++]=f.boundingSphere.radius)}x._primitives=c?{prims:h,bs:c}:h,m.length&&(x.noShowPrim=m)}else for(g=0;g<t.drawingGroups.length;g++){null==(x=t.drawingGroups[g]).gas&&(4==x.glType||5==x.glType?x.gas=t.gas.fill:1==x.glType?x.gas=t.gas.line:0==x.glType&&(x.gas=t.gas.point));for(l=0;l<x._primitives.length;l++){f=x._primitives[l];var v=new i.SGPrimitive({cgmId:f.cgmId,rep:t.rep,group:x,start:f.start,count:f.count});f.decoration&&(v.decoration=f.decoration),f.boundingSphere&&(v.boundingSphere=f.boundingSphere),x._primitives[l]=v,t.rep._primitives.push(v)}}var y,x,b=t.vertexIndexArray;y=n/3<65535?new Uint16Array(b.length):new Uint32Array(b.length);for(var g=0;g<b.length;g++)y[g]=b[g];return t.vertexIndexArray=y,i.unindexPoints(t),o.push(t),o},i.unindexPoints=function(t){if(!n&&!o)return!1;if(!t.vertexPositionArray)return!1;var e,i,r=!1,s=t.vertexPositionArray.length/3,a=new Int32Array(s);for(e=0;e<s;e++)a[e]=-1;var u=0;for(e=0;e<t.drawingGroups.length;e++){if(!((h=t.drawingGroups[e]).glType>0)){for(r=!0,i=h.start;i<h.start+h.count;i++){-1===a[c=t.vertexIndexArray[i]]?(t.vertexIndexArray[i]=u,a[c]=u,u++):t.vertexIndexArray[i]=a[c]}h.nonIndexed=!0,h.start=t.vertexIndexArray[h.start]}}if(!r)return!1;var l=u;for(e=0;e<u;e++)if(-1===a[e])for(;l<s;){if(-1!==a[l]){a[e]=l,l++;break}a[l]=l,l++}for(;l<s;)-1===a[l]&&(a[l]=l),l++;for(e=0;e<t.drawingGroups.length;e++){var h;if(0!==(h=t.drawingGroups[e]).glType)for(i=h.start;i<h.start+h.count;i++){var c=t.vertexIndexArray[i];t.vertexIndexArray[i]=a[c]}}var p=[];t.vertexPositionArray&&p.push(t.vertexPositionArray),t.vertexNormalArray&&p.push(t.vertexNormalArray),t.vertexUvArray&&p.push(t.vertexUvArray),t.vertexUv2Array&&p.push(t.vertexUv2Array),t.vertexTangentArray&&p.push(t.vertexTangentArray),t.vertexBinormalArray&&p.push(t.vertexBinormalArray);var d=new Float32Array(3*p.length),m=new Float32Array(3*p.length);for(e=0;e<s;e++){var g=e,f=a[g];if(f!==g&&-1!==f){for(i=0;i<p.length;i++){var v=p[i];d[3*i]=v[3*g],d[3*i+1]=v[3*g+1],d[3*i+2]=v[3*g+2]}for(;-1!==f;){for(i=0;i<p.length;i++){v=p[i];m[3*i]=v[3*f],m[3*i+1]=v[3*f+1],m[3*i+2]=v[3*f+2],v[3*f]=d[3*i],v[3*f+1]=d[3*i+1],v[3*f+2]=d[3*i+2],d[3*i]=m[3*i],d[3*i+1]=m[3*i+1],d[3*i+2]=m[3*i+2]}a[g]=-1,f=a[g=f]}}}return!0},i.compareGASMaterial=function(t,e){if(t.opacity<e.opacity)return-1;if(t.opacity>e.opacity)return 1;if(t.color.r<e.color.r)return-1;if(t.color.r>e.color.r)return 1;if(t.color.g<e.color.g)return-1;if(t.color.g>e.color.g)return 1;if(t.color.b<e.color.b)return-1;if(t.color.b>e.color.b)return 1;if(t.thickness&&e.thickness){if(t.thickness<e.thickness)return-1;if(t.thickness>e.thickness)return 1}if(t.lineWidth&&e.lineWidth){if(t.pattern<e.pattern)return-1;if(t.pattern>e.pattern)return 1;if(t.lineWidth<e.lineWidth)return-1;if(t.lineWidth>e.lineWidth)return 1;if((t.forceMaterial||e.forceMaterial)&&(!t.forceMaterial||!e.forceMaterial))return t.forceMaterial?-1:1}if(t.pointsize&&e.pointsize){if(t.pointsize<e.pointsize)return-1;if(t.pointsize>e.pointsize)return 1;if((t.forceMaterial||e.forceMaterial)&&(!t.forceMaterial||!e.forceMaterial))return t.forceMaterial?-1:1}if(t.symbol&&e.symbol){if(t.symbol<e.symbol)return-1;if(t.symbol>e.symbol)return 1;if(t.symbol.id<e.symbol.id)return-1;if(t.symbol.id>e.symbol.id)return 1}if(null!=t.solid&&null!=e.solid){if(t.solid<e.solid)return-1;if(t.solid>e.solid)return 1}return 0},i.applyMat=function(e,i,r,n){if(null!=i){if(e.vertexNormalArray)for(var o=0;o<e.vertexNormalArray.length;o+=3){(s=new t.Vector3(e.vertexNormalArray[o],e.vertexNormalArray[o+1],e.vertexNormalArray[o+2])).applyMatrix4(n),e.vertexNormalArray[o]=s.x,e.vertexNormalArray[o+1]=s.y,e.vertexNormalArray[o+2]=s.z}if(e.vertexPositionArray){for(o=0;o<e.vertexPositionArray.length;o+=3){var s;(s=new t.Vector3(e.vertexPositionArray[o],e.vertexPositionArray[o+1],e.vertexPositionArray[o+2])).applyMatrix4(i),e.vertexPositionArray[o]=s.x,e.vertexPositionArray[o+1]=s.y,e.vertexPositionArray[o+2]=s.z}var a=e.drawingGroups;for(o=0;o<a.length;++o){var u=(d=a[o]).material;if(!(!u||u.id<0||(r[u.id].physicalMaterial&&r[u.id].physicalMaterial.PhysicalMaterial.MappingOperator?"None"==r[u.id].physicalMaterial.PhysicalMaterial.MappingOperator.Type:!r[u.id].mapping||r[u.id].mapping.type<0))){var l=(new t.Matrix4).getInverse(i),h=JSON.parse(JSON.stringify(r[u.id])),c=h.physicalMaterial&&h.physicalMaterial.PhysicalMaterial.MappingOperator;c||(c=h.mapping),c&&c.UvTransformation&&(c.UvTransformation=c.UvTransformation.slice(0));var p=new t.Matrix4;c&&c.ObjectTransformation&&(p.elements=c.ObjectTransformation.slice(0)),p.multiply(l),c.ObjectTransformation=p.elements,d.material.id=r.length,r.push(h)}}if(i.determinant()<0)for(o=0;o<a.length;++o){var d;if(4==(d=a[o]).glType)for(var m=d.count/3,g=0;g<m;g++){var f=e.vertexIndexArray[d.start+3*g],v=e.vertexIndexArray[d.start+3*g+1];e.vertexIndexArray[d.start+3*g]=v,e.vertexIndexArray[d.start+3*g+1]=f}}}}},i.computeBB=function(t){var e=[0,0,0],i=[0,0,0];if(t.vertexPositionArray){var r=t.vertexPositionArray.length;if(r>=3){e=[t.vertexPositionArray[0],t.vertexPositionArray[1],t.vertexPositionArray[2]],i=[t.vertexPositionArray[0],t.vertexPositionArray[1],t.vertexPositionArray[2]];for(var n=0;n<r;n+=3)t.vertexPositionArray[n]<e[0]&&(e[0]=t.vertexPositionArray[n]),t.vertexPositionArray[n+1]<e[1]&&(e[1]=t.vertexPositionArray[n+1]),t.vertexPositionArray[n+2]<e[2]&&(e[2]=t.vertexPositionArray[n+2]),t.vertexPositionArray[n]>i[0]&&(i[0]=t.vertexPositionArray[n]),t.vertexPositionArray[n+1]>i[1]&&(i[1]=t.vertexPositionArray[n+1]),t.vertexPositionArray[n+2]>i[2]&&(i[2]=t.vertexPositionArray[n+2])}}t.AABB={min:e,max:i}},i.getCompressInfo=function(e,i,r){let n=e,o=i,s=new t.Vector3(Math.max(o.x-n.x,1e-6),Math.max(o.y-n.y,1e-6),Math.max(o.z-n.z,1e-6));return s.multiplyScalar(1/65535),oOffsetVector=new t.Vector3(n.x,n.y,n.z),oOffsetVector.applyMatrix4(r),oOffsetVector.x/=s.x,oOffsetVector.y/=s.y,oOffsetVector.z/=s.z,oOffsetVector.x=Math.floor(oOffsetVector.x),oOffsetVector.y=Math.floor(oOffsetVector.y),oOffsetVector.z=Math.floor(oOffsetVector.z),{quantizedVector:s,offsetVector:oOffsetVector}},i.compressVertices=function(e,i,r,n){let o=e.length/3,s=i,a=r;if(!s&&!a){let i=new t.Vector3(e[0],e[2],e[2]),r=new t.Vector3(e[0],e[2],e[2]);for(let t=1;t<o;++t)i.x=Math.min(i.x,e[3*t]),r.x=Math.max(r.x,e[3*t]),i.y=Math.min(i.y,e[3*t+1]),r.y=Math.max(r.y,e[3*t+1]),i.z=Math.min(i.z,e[3*t+2]),r.z=Math.max(r.z,e[3*t+2]);s=[i.x,i.y,i.z],a=[r.x,r.y,r.z]}let u=s,l=a,h=new t.Vector3(Math.max(l.x-u.x,1e-6),Math.max(l.y-u.y,1e-6),Math.max(l.z-u.z,1e-6));h.multiplyScalar(1/65535);let c=new t.Vector3(u.x,u.y,u.z);c.x/=h.x,c.y/=h.y,c.z/=h.z,c.x=Math.floor(c.x),c.y=Math.floor(c.y),c.z=Math.floor(c.z);let p=new Uint16Array(4*o);for(let t=0;t<o;++t)p[4*t]=e[3*t]/h.x-c.x,p[4*t+1]=e[3*t+1]/h.y-c.y,p[4*t+2]=e[3*t+2]/h.z-c.z,p[4*t+3]=n;return{quantizedVector:h,offsetVector:c,buffer:p}},i.compressNormals=function(t,e){let r,n=t.length/3;if(e===i.CATSGPlayRepDataOptions.NormalOct24Compression)r=new Uint8Array(3*n);else{if(e!==i.CATSGPlayRepDataOptions.NormalOct16Compression)return;r=new Uint8Array(2*n)}let o=function(t){return t>=0?1:-1};for(let s=0;s<n;++s){let n=t[3*s],a=t[3*s+1],u=t[3*s+2],l=Math.abs(n)+Math.abs(a)+Math.abs(u),h=n/l,c=a/l;if(u<0){let t=h;h=(1-Math.abs(c))*o(h),c=(1-Math.abs(t))*o(c)}e===i.CATSGPlayRepDataOptions.NormalOct24Compression?(h=Math.round(2047.5*h+2047.5),c=Math.round(2047.5*c+2047.5),r[3*s]=Math.floor(h/16),r[3*s+1]=h%16*16+Math.floor(c/256),r[3*s+2]=c%256):e===i.CATSGPlayRepDataOptions.NormalOct16Compression&&(r[2*s]=Math.round(127.5*h+127.5),r[2*s+1]=Math.round(127.5*c+127.5))}return r},i._getCurrentSag=function(t,e){let i=.2;if(!t)return console.warn("No sag setting"),i;let r=i,n=t.scale?t.scale:1;switch(t.sagMode){case 0:e>0&&(r=.01*e*t.sag);break;case 1:r=t.sag*n;break;case 2:r=i*n;break;case 3:r=.4*n}return r<.01&&(r=.01),e>0&&r>.1*e&&(r=.1*e),r},i._computeMaxAngleStep=function(t,e){let i=2*Math.acos(1-t/e);return i<.001&&(i=.001),i},i._computeAngleStep=function(t,e){return t/e},i._computeNbCirclePoints=function(t,e){let i=Math.PI/4;e>i&&(e=i);let r=Math.ceil(t/e);return r<3&&(r=3),[r,e=this._computeAngleStep(t,r)]},i._createCustomCylindricalMesh=function(e,r,n,o,s,a,u,l,h,c,p){var d=o>0,m=n>0,g=new t.Vector3(r[0],r[1],r[2]),f=new t.Vector3(e[0],e[1],e[2]),v=new t.Vector4;v.subVectors(g,f),v.w=0,v.normalize();var I=new t.Matrix4;0===v.x&&0===v.y?I.identity():I.set(v.x/Math.sqrt(v.x*v.x+v.y*v.y),v.y/Math.sqrt(v.x*v.x+v.y*v.y),0,0,-v.y/Math.sqrt(v.x*v.x+v.y*v.y),v.x/Math.sqrt(v.x*v.x+v.y*v.y),0,0,0,0,1,0,0,0,0,1);var A=new t.Matrix4;0===v.x&&0===v.y&&0===v.z?A.identity():A.set(v.z/Math.sqrt(v.x*v.x+v.y*v.y+v.z*v.z),0,-Math.sqrt(v.x*v.x+v.y*v.y)/Math.sqrt(v.x*v.x+v.y*v.y+v.z*v.z),0,0,1,0,0,Math.sqrt(v.x*v.x+v.y*v.y)/Math.sqrt(v.x*v.x+v.y*v.y+v.z*v.z),0,v.z/Math.sqrt(v.x*v.x+v.y*v.y+v.z*v.z),0,0,0,0,1);var _=new t.Matrix4;_.multiplyMatrices(A,I),_.transpose();var S=new t.Vector3(f.x,f.y,f.z),P=_.clone();_.elements[12]=S.x,_.elements[13]=S.y,_.elements[14]=S.z;var w=Math.sqrt((f.x-g.x)*(f.x-g.x)+(f.y-g.y)*(f.y-g.y)+(f.z-g.z)*(f.z-g.z));let T=Math.max(n,o),C=this._getCurrentSag(u,T),G=this._computeMaxAngleStep(C,T),B=0;[B,G]=this._computeNbCirclePoints(2*Math.PI,G);var O=(n-o)/w,M=6*B,E=2*B,N=2*B;d&&(M+=3*(B-2),p||(M+=2*B),B,N+=B,E+=B),m&&(M+=3*(B-2),p||(M+=2*B),B,N+=B,E+=B);for(var z=new Uint16Array(M),D=z,R=0,V=0;V<B-1;++V){var F=V+1;D[R++]=V,D[R++]=F,D[R++]=B+F,D[R++]=V,D[R++]=B+F,D[R++]=B+V}F=0;if(D[R++]=B-1,D[R++]=F,D[R++]=B+F,D[R++]=B-1,D[R++]=B+F,D[R++]=B+B-1,d)for(V=0;V<B-2;V++)D[R++]=2*B,D[R++]=2*B+V+1,D[R++]=2*B+V+2;if(m)if(d)for(V=0;V<B-2;V++)D[R++]=3*B,D[R++]=3*B+V+2,D[R++]=3*B+V+1;else for(V=0;V<B-2;V++)D[R++]=2*B,D[R++]=2*B+V+2,D[R++]=2*B+V+1;if(!p){if(d){for(V=0;V<B-1;++V)D[R++]=B+V,D[R++]=B+V+1;D[R++]=B+B-1,D[R++]=B}if(m){for(V=0;V<B-1;++V)D[R++]=V,D[R++]=V+1;D[R++]=B-1,D[R++]=0}}var L=new Float32Array(3*E),k=new Float32Array(3*E),U=L,j=k,H=0;for(V=0;V<B;V++,H+=3){var q=V/B*2*Math.PI;U[H]=n*Math.cos(q),U[H+1]=n*Math.sin(q),U[H+2]=0,j[H]=V/B,j[H+1]=1,j[H+2]=0}H=3*B;for(V=0;V<B;V++,H+=3){q=V/B*2*Math.PI;U[H]=o*Math.cos(q),U[H+1]=o*Math.sin(q),U[H+2]=w,j[H]=V/B,j[H+1]=0,j[H+2]=0}if(d){q=0;for(var W=0;W<B;W++)q=W/B*2*Math.PI,U[H]=U[3*(B+W)],j[H++]=(Math.cos(q)+1)/2,U[H]=U[3*(B+W)+1],j[H++]=1-(Math.sin(q)+1)/2,U[H]=U[3*(B+W)+2],j[H++]=0}if(m)for(q=0,W=0;W<B;W++)q=W/B*2*Math.PI,U[H]=U[3*W],j[H++]=(Math.cos(q)+1)/2,U[H]=U[3*W+1],j[H++]=1-(Math.sin(q)+1)/2,U[H]=U[3*W+2],j[H++]=0;var X=new Float32Array(3*N);U=X;H=0;for(var K=0;K<2;K++)for(V=0;V<B;V++){q=V/B*2*Math.PI;(Z=new t.Vector3).x=L[3*V],Z.y=L[3*V+1],Z.z=L[3*V+2],Z.z=Math.sqrt(Z.x*Z.x+Z.y*Z.y)*O,Z.normalize(),U[H++]=Z.x,U[H++]=Z.y,U[H++]=Z.z}if(d)for(K=0;K<B;K++)U[H++]=0,U[H++]=0,U[H++]=1;if(m)for(K=0;K<B;K++)U[H++]=0,U[H++]=0,U[H++]=-1;for(W=0;W<E;W++){(Z=new t.Vector3).x=L[3*W],Z.y=L[3*W+1],Z.z=L[3*W+2],Z.applyMatrix4(_),L[3*W]=Z.x,L[3*W+1]=Z.y,L[3*W+2]=Z.z}for(W=0;W<N;W++){var Z;(Z=new t.Vector3).x=X[3*W],Z.y=X[3*W+1],Z.z=X[3*W+2],Z.applyMatrix4(P),X[3*W]=Z.x,X[3*W+1]=Z.y,X[3*W+2]=Z.z}var Y,Q=new i.Mesh;Q.vertexPositionArray=L,Q.vertexNormalArray=X,Q.vertexUVArray=k,Q.vertexIndexArray=z,Q.gas=s,Q.matId=a,l?(s.setConnectivity(0),(Y=c).setConnectivity(3)):Y=s.line?s.line:s;var J=6*B+(d?3*(B-2):0)+(m?3*(B-2):0),$=p?0:(d?2*B:0)+(m?2*B:0);let tt=0,et=[r[0]-e[0],r[1]-e[1],r[2]-e[2]];var it=new i.DrawingGroup(s,a,4,0,J,[],null,t.GeomTypeEnum.FACE);if(!p){var rt=new i.DrawingGroup(Y,a,1,J,$,[],null,t.GeomTypeEnum.SHARP_EDGE);if(d||m){let t=new i.SGPrimitive({cgmId:tt++,group:rt,start:J,count:2*B});if(rt._primitives.push(t),h){let i;i=d?b(r,et,o):b(e,et,n),t.decoration=h.addDecoration(i)}}if(d&&m){let t=new i.SGPrimitive({cgmId:tt++,group:rt,start:J+2*B,count:2*B});if(rt._primitives.push(t),h){let i=b(e,et,n);t.decoration=h.addDecoration(i)}}Q.drawingGroups.push(rt)}var nt=new i.SGPrimitive({cgmId:tt++,group:it,start:0,count:6*B});if(it._primitives.push(nt),h)if(o==n){let t=y(e,et,o);nt.decoration=h.addDecoration(t)}else{if(o>n){let t=e;e=r,r=t,t=n,n=o,o=t}let i=[e[0]-r[0],e[1]-r[1],e[2]-r[2]],s=new t.Vector3(i[0],i[1],i[2]).length(),a=s/(1-o/n);i[0]*=a/s,i[1]*=a/s,i[2]*=a/s;let u=[e[0]-i[0],e[1]-i[1],e[2]-i[2]],l=180*Math.atan(n/a)/Math.PI,c=x(u,i,l);nt.decoration=h.addDecoration(c)}return(d||m)&&(nt=new i.SGPrimitive({cgmId:tt++,group:it,start:6*B,count:3*(B-2)}),it._primitives.push(nt)),d&&m&&(nt=new i.SGPrimitive({cgmId:tt++,group:it,start:6*B+3*(B-2),count:3*(B-2)}),it._primitives.push(nt)),Q.drawingGroups.push(it),i.computeBB(Q),Q},i._createCustomSphereMesh=function(e,r,n,o,s,a,u,l,h,c,p,d){var m=new t.Vector3(a[0],a[1],a[2]),g=new t.Vector3(u[0],u[1],u[2]),v=m.length();e<-Math.PI/2&&(e=-Math.PI/2),e>Math.PI/2&&(e=Math.PI/2),r<-Math.PI/2&&(r=-Math.PI/2),r>Math.PI/2&&(r=Math.PI/2);var y=r-e;y<0&&(y=0),n<0&&(n=0),n>2*Math.PI&&(n=2*Math.PI),o<0&&(o=0),o>2*Math.PI&&(o=2*Math.PI);var x=o-n;x<0&&(x=0);let b=this._getCurrentSag(c,v),I=this._computeMaxAngleStep(b,v),A=0,_=0,S=0,P=0;[A,S]=this._computeNbCirclePoints(x,I),[_,P]=this._computeNbCirclePoints(2*y,I),A+=1,_+=1;this._computeAngleStep(x,A-1),this._computeAngleStep(y,_-1);for(var w=3*(A+1)*_,T=6*A*(_-1),C=new Float32Array(w),G=new Float32Array(w),B=new Float32Array(w),O=new Uint16Array(T),M=C,E=G,N=B,z=m.normalize(),D=g.normalize(),R=(new t.Vector3).crossVectors(z,D),V=O,F=0,L=0;L<_-1;L++)for(K=0;K<A;K++)V[F++]=L*(A+1)+K,V[F++]=(L+1)*(A+1)+K+1,V[F++]=(L+1)*(A+1)+K,V[F++]=L*(A+1)+K,V[F++]=L*(A+1)+K+1,V[F++]=(L+1)*(A+1)+K+1;F=0;var k=1/(_-1),U=(new t.Vector3,new t.Vector3),j=new t.Vector3,H=new t.Vector3;for(L=0;L<_;L++)for(var q=L*k,W=Math.sin(e+q*y),X=Math.cos(e+q*y),K=0;K<=A;K++,F+=3){var Z=K/A,Y=Math.sin(n+Z*x),Q=Math.cos(n+Z*x);U.copy(z),U.multiplyScalar(Q),j.copy(D),j.multiplyScalar(Y),H.copy(R),H.multiplyScalar(W),U.add(j),U.multiplyScalar(X),U.add(H);var J=U;E[F]=J.x,M[F]=s[0]+J.x*v,N[F]=Z,E[F+1]=J.y,M[F+1]=s[1]+J.y*v,N[F+1]=L/_,E[F+2]=J.z,M[F+2]=s[2]+J.z*v,N[F+2]=0}var $=new i.Mesh;$.vertexPositionArray=C,$.vertexNormalArray=G,$.vertexUVArray=B,$.vertexIndexArray=O,$.gas=l,$.matId=h,p&&l.setConnectivity(0);var tt=new i.DrawingGroup(l,h,4,0,T,[],null,t.GeomTypeEnum.FACE),et=new i.SGPrimitive({cgmId:0,group:tt,start:0,count:T});if(d){let t=f(s,v);et.decoration=d.addDecoration(t)}return tt._primitives.push(et),$.drawingGroups.push(tt),i.computeBB($),$},i._buildCurvedPipeDataFromTorus=function(e,i,r,n,o,s){var a=[],u=(new t.Vector3).copy(i),l=(new t.Vector3).copy(r);let h=u.length();s&&(h+=s);let c=this._getCurrentSag(o,h),p=this._computeMaxAngleStep(c,h),d=0;[d,p]=this._computeNbCirclePoints(n,p);for(var m=0,g=0;g<d+1;g++){var f=Math.cos(m),v=Math.sin(m);u.copy(i).multiplyScalar(f),l.copy(r).multiplyScalar(v),u.add(l).add(e),a.push(u.x),a.push(u.y),a.push(u.z),m+=p}if(i.normalize(),r.normalize(),n==2*Math.PI){a.push(a[0]),a.push(a[1]),a.push(a[2]);var y=[-r.x,-r.y,-r.z],x=[r.x,r.y,r.z]}else{y=[-r.x,-r.y,-r.z];u.crossVectors(i,r);var b=a.length;l.set(a[b-3],a[b-2],a[b-1]).sub(e).normalize(),u.cross(l).normalize();x=[u.x,u.y,u.z]}return{centers:a,startNormal:y,endNormal:x}},i._createTorusMesh=function(e,r,n,o,s,a,u,l,h){var c=new t.Vector3,p=new t.Vector3;c.subVectors(r[0],e);let d=c.length();p.crossVectors(c,o).normalize();let m=this._getCurrentSag(u,n[0]),g=this._computeMaxAngleStep(m,n[0]),f=0;[f,g]=this._computeNbCirclePoints(2*Math.PI,g);for(var y=3*r.length*f,x=6*f*(r.length-1),b=new Float32Array(y),I=new Float32Array(y),A=new Float32Array(y),_=new Uint16Array(x),S=b,P=I,w=A,T=_,C=new t.Vector3,G=new t.Vector3,B=new t.Vector3,O=new t.Vector3,M=0,E=0;E<r.length;E++){0==E||E==r.length-1?C.copy(o).negate():(B.subVectors(r[E],r[E-1]),C.subVectors(r[E+1],r[E]),C.add(B)),C.normalize(),G.crossVectors(C,p),G.normalize();for(var N=0,z=0;z<f;z++)B.copy(G).multiplyScalar(Math.cos(N)),O.copy(p).multiplyScalar(Math.sin(N)),B.add(O),P[M]=B.x,P[M+1]=B.y,P[M+2]=B.z,B.multiplyScalar(n[E]),B.add(r[E]),S[M]=B.x,S[M+1]=B.y,S[M+2]=B.z,w[M++]=z/f,w[M++]=E/r.length,w[M++]=0,N+=g}M=0;for(E=0;E<r.length-1;E++)for(z=0;z<f;z++){var D=(z+1)%f;T[M++]=E*f+z,T[M++]=(E+1)*f+z,T[M++]=(E+1)*f+D,T[M++]=E*f+z,T[M++]=(E+1)*f+D,T[M++]=E*f+D}var R=new i.Mesh;R.vertexPositionArray=b,R.vertexNormalArray=I,R.vertexUVArray=A,R.vertexIndexArray=_,R.gas=s,R.matId=a,l&&s.setConnectivity(0);var V=new i.DrawingGroup(s,a,4,0,x,[],null,t.GeomTypeEnum.FACE),F=new i.SGPrimitive({cgmId:0,group:V,start:0,count:6*f*(r.length-1)});if(V._primitives.push(F),h){let t=v(e,p,n[0],d);F.decoration=h.addDecoration(t)}return R.drawingGroups.push(V),i.computeBB(R),R},i._createCurvedPipeMesh=function(e,r,n,o,s,a,u,l,h,c,p,d,m){let g=r[0];for(let t=1;t<r.length;t++)r[t]>g&&(g=r[t]);let f=this._getCurrentSag(l,g),y=this._computeMaxAngleStep(f,g),x=0;[x,y]=this._computeNbCirclePoints(2*Math.PI,y);var b=3*e.length*x,I=6*x*(e.length-1),A=0;s&&(b+=6*x,I+=6*(x-2),A=m?0:4*x);var _=new Float32Array(b),S=new Float32Array(b),P=new Float32Array(b),w=new Uint16Array(I+A),T=_,C=S,G=P,B=w,O=new t.Vector3,M=new t.Vector3,E=new t.Vector3,N=new t.Vector3,z=new t.Vector3;if(e.length>=3)N.subVectors(e[1],e[0]),E.subVectors(e[2],e[1]),O.crossVectors(N,E).normalize(),N.copy(n).negate(),E.crossVectors(N,O);else{N.copy(n).negate();var D=Math.abs(N.x),R=Math.abs(N.y),V=Math.abs(N.z),F=.001;D>R?R>V||D>V?z.set(0,R+F,V+F):z.set(D+F,R+F,0):D>V||R>V?z.set(D+F,0,V+F):z.set(D+F,R+F,0),E.crossVectors(N,z)}for(var L=0,k=0;k<e.length;k++){E.normalize(),0==k?M.copy(n).negate():k==e.length-1?M.copy(o):(N.subVectors(e[k],e[k-1]),M.subVectors(e[k+1],e[k]),M.add(N)),M.normalize(),O.crossVectors(E,M),O.normalize(),k>0&&E.crossVectors(M,O);for(var U=0,j=0;j<x;j++)N.copy(E).multiplyScalar(Math.cos(U)),z.copy(O).multiplyScalar(Math.sin(U)),N.add(z),C[L]=N.x,C[L+1]=N.y,C[L+2]=N.z,N.multiplyScalar(r[k]),N.add(e[k]),T[L]=N.x,T[L+1]=N.y,T[L+2]=N.z,G[L++]=j/x,G[L++]=k/e.length,G[L++]=0,U+=y}if(s){for(j=0;j<x;j++)C[L]=n.x,C[L+1]=n.y,C[L+2]=n.z,T[L++]=T[3*j],T[L++]=T[3*j+1],T[L++]=T[3*j+2];var H=x*(e.length-1)*3;for(j=0;j<x;j++)C[L]=o.x,C[L+1]=o.y,C[L+2]=o.z,T[L++]=T[H+3*j],T[L++]=T[H+3*j+1],T[L++]=T[H+3*j+2]}L=0;for(k=0;k<e.length-1;k++)for(j=0;j<x;j++){var q=(j+1)%x;B[L++]=k*x+j,B[L++]=(k+1)*x+j,B[L++]=(k+1)*x+q,B[L++]=k*x+j,B[L++]=(k+1)*x+q,B[L++]=k*x+q}if(s){for(k=0;k<x-2;k++)B[L++]=e.length*x,B[L++]=e.length*x+k+1,B[L++]=e.length*x+k+2;for(k=0;k<x-2;k++)B[L++]=(e.length+1)*x,B[L++]=(e.length+1)*x+k+2,B[L++]=(e.length+1)*x+k+1;if(!m){for(k=0;k<x;k++)B[L++]=e.length*x+k,B[L++]=e.length*x+(k+1)%x;for(k=0;k<x;k++)B[L++]=(e.length+1)*x+k,B[L++]=(e.length+1)*x+(k+1)%x}}var W=new i.Mesh;W.vertexPositionArray=_,W.vertexNormalArray=S,W.vertexUVArray=P,W.vertexIndexArray=w,W.gas=a,W.matId=u,h&&a.setConnectivity(0);var X=new i.DrawingGroup(a,u,4,0,I,[],null,t.GeomTypeEnum.FACE);let K=0;var Z=new i.SGPrimitive({cgmId:K++,group:X,start:0,count:6*x*(e.length-1)});if(X._primitives.push(Z),c&&p){let e=new t.Vector3(p.center[0],p.center[1],p.center[2]),i=new t.Vector3(p.firstAxis[0],p.firstAxis[1],p.firstAxis[2]),n=i.length(),o=new t.Vector3(p.secondAxis[0],p.secondAxis[1],p.secondAxis[2]),s=(new t.Vector3).crossVectors(i.normalize(),o.normalize()),a=v(e,s,r[0],n);Z.decoration=c.addDecoration(a)}if(Z=new i.SGPrimitive({cgmId:K++,group:X,start:6*x*(e.length-1),count:3*(x-2)}),X._primitives.push(Z),Z=new i.SGPrimitive({cgmId:K++,group:X,start:6*x*(e.length-1)+3*(x-2),count:3*(x-2)}),X._primitives.push(Z),W.drawingGroups.push(X),A){var Y;h?(Y=d).setConnectivity(3):Y=a.line?a.line:a;var Q=new i.DrawingGroup(Y,u,1,I,A,[],null,t.GeomTypeEnum.SHARP_EDGE);Z=new i.SGPrimitive({cgmId:K++,group:Q,start:I,count:A/2}),Q._primitives.push(Z),Z=new i.SGPrimitive({cgmId:K++,group:Q,start:I+A/2,count:A/2}),Q._primitives.push(Z),W.drawingGroups.push(Q)}return i.computeBB(W),W},i._createCuboidMesh=function(e,r,n,o,s,a,u,l,h,c){var p=new i.Mesh;p.gas=s,p.matId=a;var d=new t.Vector3(e[0],e[1],e[2]),m=new t.Vector3(r[0],r[1],r[2]),g=new t.Vector3(n[0],n[1],n[2]),f=(new t.Vector3).crossVectors(m,g).normalize().multiplyScalar(o);p.vertexPositionArray=new Float32Array(72),p.vertexNormalArray=new Float32Array(72),p.vertexUVArray=new Float32Array(72);var v=p.vertexPositionArray,y=p.vertexNormalArray,x=p.vertexUVArray,b=new t.Vector3,I=new t.Vector3;I.copy(f).normalize();var A=new t.Vector3;A.copy(I).negate();var _=new t.Vector3;_.copy(g).normalize();var S=new t.Vector3;S.copy(_).negate();var P=new t.Vector3;P.copy(m).normalize();var w=new t.Vector3;w.copy(P).negate();var T=new t.Vector3(d.x,d.y,d.z),C=new t.Vector3(d.x,d.y,d.z),G=new t.Vector3(0,0,0),B=new t.Vector3(1,0,0),O=new t.Vector3(1,1,0),M=new t.Vector3(0,1,0);b.addVectors(d,f),T.min(b),C.max(b),v[9]=b.x,v[10]=b.y,v[11]=b.z,v[24]=b.x,v[25]=b.y,v[26]=b.z,v[48]=b.x,v[49]=b.y,v[50]=b.z,y[9]=I.x,y[10]=I.y,y[11]=I.z,y[24]=S.x,y[25]=S.y,y[26]=S.z,y[48]=w.x,y[49]=w.y,y[50]=w.z,x[9]=M.x,x[10]=M.y,x[11]=M.z,x[24]=G.x,x[25]=G.y,x[26]=G.z,x[48]=G.x,x[49]=G.y,x[50]=G.z,b.add(m),T.min(b),C.max(b),v[6]=b.x,v[7]=b.y,v[8]=b.z,v[27]=b.x,v[28]=b.y,v[29]=b.z,v[60]=b.x,v[61]=b.y,v[62]=b.z,y[6]=I.x,y[7]=I.y,y[8]=I.z,y[27]=S.x,y[28]=S.y,y[29]=S.z,y[60]=P.x,y[61]=P.y,y[62]=P.z,x[6]=O.x,x[7]=O.y,x[8]=O.z,x[27]=B.x,x[28]=B.y,x[29]=B.z,x[60]=G.x,x[61]=G.y,x[62]=G.z,b.add(g),T.min(b),C.max(b),v[3]=b.x,v[4]=b.y,v[5]=b.z,v[36]=b.x,v[37]=b.y,v[38]=b.z,v[63]=b.x,v[64]=b.y,v[65]=b.z,y[3]=I.x,y[4]=I.y,y[5]=I.z,y[36]=_.x,y[37]=_.y,y[38]=_.z,y[63]=P.x,y[64]=P.y,y[65]=P.z,x[3]=B.x,x[4]=B.y,x[5]=B.z,x[36]=G.x,x[37]=G.y,x[38]=G.z,x[63]=B.x,x[64]=B.y,x[65]=B.z,b.addVectors(d,f),b.add(g),T.min(b),C.max(b),v[0]=b.x,v[1]=b.y,v[2]=b.z,v[39]=b.x,v[40]=b.y,v[41]=b.z,v[57]=b.x,v[58]=b.y,v[59]=b.z,y[0]=I.x,y[1]=I.y,y[2]=I.z,y[39]=_.x,y[40]=_.y,y[41]=_.z,y[57]=w.x,y[58]=w.y,y[59]=w.z,x[0]=G.x,x[1]=G.y,x[2]=G.z,x[39]=B.x,x[40]=B.y,x[41]=B.z,x[57]=M.x,x[58]=M.y,x[59]=M.z,b.addVectors(d,g),T.min(b),C.max(b),v[21]=b.x,v[22]=b.y,v[23]=b.z,v[42]=b.x,v[43]=b.y,v[44]=b.z,v[54]=b.x,v[55]=b.y,v[56]=b.z,y[21]=A.x,y[22]=A.y,y[23]=A.z,y[42]=_.x,y[43]=_.y,y[44]=_.z,y[54]=w.x,y[55]=w.y,y[56]=w.z,x[21]=M.x,x[22]=M.y,x[23]=M.z,x[42]=O.x,x[43]=O.y,x[44]=O.z,x[54]=O.x,x[55]=O.y,x[56]=O.z,b.add(m),T.min(b),C.max(b),v[18]=b.x,v[19]=b.y,v[20]=b.z,v[45]=b.x,v[46]=b.y,v[47]=b.z,v[66]=b.x,v[67]=b.y,v[68]=b.z,y[18]=A.x,y[19]=A.y,y[20]=A.z,y[45]=_.x,y[46]=_.y,y[47]=_.z,y[66]=P.x,y[67]=P.y,y[68]=P.z,x[18]=O.x,x[19]=O.y,x[20]=O.z,x[45]=M.x,x[46]=M.y,x[47]=M.z,x[66]=O.x,x[67]=O.y,x[68]=O.z,b.addVectors(d,m),T.min(b),C.max(b),v[15]=b.x,v[16]=b.y,v[17]=b.z,v[30]=b.x,v[31]=b.y,v[32]=b.z,v[69]=b.x,v[70]=b.y,v[71]=b.z,y[15]=A.x,y[16]=A.y,y[17]=A.z,y[30]=S.x,y[31]=S.y,y[32]=S.z,y[69]=P.x,y[70]=P.y,y[71]=P.z,x[15]=B.x,x[16]=B.y,x[17]=B.z,x[30]=O.x,x[31]=O.y,x[32]=O.z,x[69]=M.x,x[70]=M.y,x[71]=M.z,v[12]=d.x,v[13]=d.y,v[14]=d.z,v[33]=d.x,v[34]=d.y,v[35]=d.z,v[51]=d.x,v[52]=d.y,v[53]=d.z,y[12]=A.x,y[13]=A.y,y[14]=A.z,y[33]=S.x,y[34]=S.y,y[35]=S.z,y[51]=w.x,y[52]=w.y,y[53]=w.z,x[12]=G.x,x[13]=G.y,x[14]=G.z,x[33]=M.x,x[34]=M.y,x[35]=M.z,x[51]=B.x,x[52]=B.y,x[53]=B.z,p.vertexIndexArray=new Uint16Array(60);for(var E=p.vertexIndexArray,N=0,z=0;z<6;z++)E[N++]=4*z,E[N++]=4*z+2,E[N++]=4*z+1,E[N++]=4*z,E[N++]=4*z+3,E[N++]=4*z+2;if(!c){for(z=0;z<2;z++)E[N++]=4*z,E[N++]=4*z+1,E[N++]=4*z+1,E[N++]=4*z+2,E[N++]=4*z+2,E[N++]=4*z+3,E[N++]=4*z+3,E[N++]=4*z;E[N++]=0,E[N++]=7,E[N++]=1,E[N++]=6,E[N++]=2,E[N++]=5,E[N++]=3,E[N++]=4}u&&s.setConnectivity(0);var D=new i.DrawingGroup(s,a,4,0,36,[],null,t.GeomTypeEnum.FACE);let R=0;for(z=0;z<6;z++){var V=new i.SGPrimitive({cgmId:R++,cgmId:z,group:D,start:6*z,count:6});D._primitives.push(V)}if(p.drawingGroups.push(D),!c){var F;u?(F=h).setConnectivity(3):F=s.line?s.line:s;var L=new i.DrawingGroup(F,a,1,36,24,[],null,t.GeomTypeEnum.SHARP_EDGE);for(z=0;z<12;z++){V=new i.SGPrimitive({cgmId:R++,cgmId:z,group:L,start:36+2*z,count:2});L._primitives.push(V)}p.drawingGroups.push(L)}var k=[T.x,T.y,T.z],U=[C.x,C.y,C.z];return p.AABB={min:k,max:U},p};let f=function(t,e){let i=[0,52,53];return _(i,t[0]),_(i,t[1]),_(i,t[2]),_(i,e),i[0]=i.length,i},v=function(t,e,i,r){let n=[0,52,56];return _(n,t.x),_(n,t.y),_(n,t.z),_(n,e.x),_(n,e.y),_(n,e.z),_(n,r),_(n,i),n[0]=n.length,n},y=function(t,e,i){let r=[0,52,51];return _(r,t[0]),_(r,t[1]),_(r,t[2]),_(r,e[0]),_(r,e[1]),_(r,e[2]),_(r,i),r[0]=r.length,r},x=function(t,e,i){let r=[0,52,52];return _(r,t[0]),_(r,t[1]),_(r,t[2]),_(r,e[0]),_(r,e[1]),_(r,e[2]),_(r,i),r[0]=r.length,r},b=function(t,e,i){let r=[0,52,55];return _(r,t[0]),_(r,t[1]),_(r,t[2]),_(r,e[0]),_(r,e[1]),_(r,e[2]),_(r,i),r[0]=r.length,r},I=new Uint8Array(8),A=new DataView(I.buffer,0,8),_=function(t,e){A.setFloat64(0,e),t.push(I[0]),t.push(I[1]),t.push(I[2]),t.push(I[3]),t.push(I[4]),t.push(I[5]),t.push(I[6]),t.push(I[7])},S=new Uint8Array(4);new DataView(S.buffer,0,4);return i})),define("Mesh/Mesh",["DS/Mesh/Mesh","DS/DSMigration/DSMigration"],(function(t,e){return e.deprecateModule("Mesh/Mesh"),t}));