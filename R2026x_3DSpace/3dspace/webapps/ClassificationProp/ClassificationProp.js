define("DS/ClassificationProp/UI/ClassifPropSkeleton",["UWA/Json","DS/ClassificationProp/UI/IDCardManager","DS/ClassificationProp/constants/ClassifPropConstants","DS/WidgetServices/WidgetServices","css!DS/ClassificationProp/ClassificationProp.css","i18n!DS/ClassificationProp/assets/nls/langEditProp"],(function(e,t,i,n){"use strict";var s="ClassificationAttMasterContain";return t.extend({defaultOptions:{className:"",typeOfDisplay:i.ALL,setEditButton:!1,displayType:i.STANDARD},init:function(e,t){var n=this;t.typeOfDisplay=t.typeOfDisplay?t.typeOfDisplay:i.ALL,t.displayType=t.displayType?t.displayType:i.STANDARD,t.className=t.className?t.className:"",t.className+=" "+s,t.className+=t.typeOfDisplay?" "+t.typeOfDisplay:"",t.name=s,t.showIdCard=void 0!==t.showIdCard?t.showIdCard:t.typeOfDisplay!==i.ONLY_EDIT_PROPERTIES,t.showFacets=t.typeOfDisplay===i.ALL,t.showExpander=t.typeOfDisplay===i.ALL,t.closeButton=i.isCloseButton(t.displayType),t.defaultFacetName=t.defaultFacetName?t.defaultFacetName:"",t.infoForFacet=t.infoForFacet?t.infoForFacet:null,t.indexModeParameter=!!t.indexModeParameter&&t.indexModeParameter,t.idCardOptions={events:{thumbnailClick:function(){n._getFirstPropertiesModel().get("activeThumbnail")?(n.elements.postIdCard&&n.elements.postIdCard.maskThumbnail(),require(["DS/ImageManager/ImageManager","DS/ClassificationProp/ajaxRequests/ServicesAjaxRequests"],(function(e,t){n.elements.postIdCard&&n.elements.postIdCard.unmaskThumbnail();var i=n._getFirstPropertiesModel(),s=i?i.get("objectId"):null;!s||n.elements.imageManager&&n.elements.imageManager.getModelId()===s||(n.elements.imageManager&&n.elements.imageManager.destroy(),n.elements.imageManager=new e({modelId:s,tenantId:t.getTenantFromModel(i),events:{onPrimaryChange:function(e){(i=n._getFirstPropertiesModel()).set("previewUrl",e?e.url:"");var t=i?i.get("objectId"):null;t&&n.dispatchEvent("onPrimaryChange",{id:t,image:e}),n._updateThumbnailForModel(i)}}})),n.elements.imageManager&&n.elements.imageManager.execute()}))):n._isFacetAuthorized(i.FACET_VIEWS)&&n.selectFacet(i.FACET_VIEWS)}}},this._parent(e,t),this._sharedOptions.readOnly=!1!==t.readOnly,this.options.typeOfDisplay===i.ONLY_IDENTITY_CARD&&(this.options.setEditButton=!1),this.editMode=!0===t.editMode,this.options.typeOfDisplay===i.ALL&&(this.elements.containerError=this.elements.globalDiv),this.elements.mainError=UWA.createElement("div",{class:"EditProp_MainError"}).inject(this.elements.globalDiv).hide()},setReadonlyStatus:function(e){this._sharedOptions.readOnly=e,this.onRefresh()},setOccurrences:function(e){this.elements.imageManager&&(this.elements.imageManager.destroy(),delete this.elements.imageManager),this._parent(e)},_manageEvent:function(e){this._parent(e);var t=this._getCurrentSelectedFacet(),i=this._getFacetName(t);e.facet===i&&"switchMode"===e.eventID&&this.elements.postIdCard&&this._manageActionVisibility()},clearPanel:function(){this._parent(),this._getErrorManager((function(e){e.clearAllMessages()}))},_getErrorManager:function(e){var t=this;this.errorOverlay?e.call(null,this.errorOverlay):require(["DS/ErrorWidget/ErrorWidget"],(function(i){t.errorOverlay||(t.errorOverlay=new i(n.getWidgetObject(),t.elements.containerError,{className:"editProperties_errorManager"})),e.call(null,t.errorOverlay)}))},_addNotif:function(e){var t=e.msg,i=e.eventID,n=e.customClass;switch(i){case"mainstaticerror":t=t||e.json,this.showMainErrorArea(t);break;case"error":t=t||e.json,this._addError(t,n);break;case"warning":this._addWarning(t,n);break;case"success":this._addSuccess(t,n);break;default:this._addInfo(t,n)}},_addInfo:function(e,t){var i=this;this._getErrorManager((function(n){var s=n.addInfo(e,t);i.dispatchEvent("onNotification",s)}))},_addWarning:function(e,t){var i=this;this._getErrorManager((function(n){var s=n.addWarning(e,t);i.dispatchEvent("onNotification",s)}))},_addSuccess:function(e,t){var i=this;this._getErrorManager((function(n){var s=n.addSuccess(e,t);i.dispatchEvent("onNotification",s)}))},_addError:function(t,i){var n=this;this._getErrorManager((function(s){var a=t;if(null!=a&&("string"==typeof a||a instanceof String)&&a.includes("ErrorCode:1501009")){a={level:"error",title:UWA.i18n("InvalidCSCreationfailed"),subtitle:UWA.i18n("InvalidCSCreationFailedSubtitle"),message:UWA.i18n("NoAccessToCS")};var r=s.display(a)}else r=s.displayJSONError(e.encode(t),i);n.dispatchEvent("onNotification",r)}))},hideMainErrorArea:function(){this.elements.mainError.hide()},showMainErrorArea:function(e){null!=e&&""!=e&&(this.clearAllMainError(),this.addMainError(e)),this.elements.mainError.show()},addMainError:function(e){new UWA.createElement("div",{text:e}).inject(this.elements.mainError)},clearAllMainError:function(){this.elements.mainError.setContent("")},showMainComponent:function(){this._parent(),this.hideMainErrorArea()}})})),define("DS/ClassificationProp/ajaxRequests/MultipleAsynchronousRequests",[],(function(){"use strict";return function(e,t){var i={},n=e.length,s=t;this.setAnswer=function(t,a){e.indexOf(t)>=0&&(void 0===i[t]&&n--,i[t]=a),n<=0&&null!==s&&s.call(this)},this.getAnswer=function(e){return i[e]}}})),define("DS/ClassificationProp/utils/ClassifSecurityContextServices",["UWA/Class","UWA/Json","DS/WidgetServices/WidgetServices","i18n!DS/WidgetServices/assets/nls/SecurityContextNls"],(function(e,t,i,n){"use strict";return e.singleton({_currentSecurityContext:"",_preferedSecurityContext:"",_validSecurityContext:"",options:{serverName:"",serverUri:"",isStandalone:!1,alwaysUpdate:!1,context:null,wintop:!1,tenant:null,source:null},init:function(e){this._parent(),this._assignedSecurityContextOfLoggedInUser=[],this._numberOfTimesAPICalled=0,this.errorObject=null,this._validSecurityContext=null},getInstance:function(e){try{this.init(e)}catch(e){}for(var t in e)this.options[t]=e[t];return this.options.source||(this.options.source="3DSpace"),this},getSecurityContext:function(e,t){if(this._currentSecurityContext=null,this.options.context&&"function"==typeof this.options.context.getSecurityContext){var i=this.options.context.getSecurityContext();if(i&&i.SecurityContext)return this._currentSecurityContext=i,void this._computeSecurityContext(e)}var n=!1;if(null!=t&&(null!=t.serverName&&(t.serverName!=this.options.serverName&&(n=!0),this.options.serverName=t.serverName),null!=t.serverUri&&(t.serverUri!=this.options.serverUri&&(n=!0),this.options.serverUri=t.serverUri)),!0===this.options.alwaysUpdate&&(n=!0),1==n||""==this._preferedSecurityContext||null==this._preferedSecurityContext.SecurityContext)return this._getSecurityContext(!0,e);this._computeSecurityContext(e)},_computeSecurityContext:function(e){if(null===this._currentSecurityContext&&(this._currentSecurityContext=this._preferedSecurityContext),null!=e)if(this._currentSecurityContext&&this._currentSecurityContext.SecurityContext){var t=this._currentSecurityContext.SecurityContext,i="";0!=t.indexOf("ctx::")&&(i="ctx::"),this._currentSecurityContext.SecurityContext=i+t,e.onSuccess.call(this,this._currentSecurityContext)}else{var s={message:n.get("ErrorSecurityContextEmpty"),code:"ERROR"};e.onFailure.call(this,s)}},_getSecurityContext:function(e,t){var n=this,s=i._getCancelObject();if(!1!==e||""!=this.options.serverName||""!=this.options.serverUri){var a={Accept:"application/json","Content-Type":"application/json"};if(!1===e)this.options.serverName,this.options.serverUri;return require(["DS/WAFData/WAFData","DS/WidgetServices/WidgetServices"],(function(i,r){if(!1===s.isCancelled()){var o=n.options.tenant;o=o||r.getTenantID(),s.handler=r.getSourceUrlAsync({platformId:o,source:n.options.source,onComplete:function(o){var l=o+"/resources/pno/person/getsecuritycontext",c=n.options.tenant;(c=c||r.getTenantID())&&(l+="?tenant="+c);var u="";!1===n.options.isStandalone&&2==n.prodLevel&&(u="passport"),a["Accept-Language"]=r.getLanguage();var d={type:"json",method:"GET",proxy:u,headers:a,onComplete:function(i){n._onCompleteGetSecurityContext(i,e,t)},onFailure:function(i,s,a){n._onFailureGetSecurityContext(i,s,a,e,t)},onTimeout:function(){n._onTimeoutGetSecurityContext(e,t)}};!1===n.options.isStandalone&&(d.authentication="passport"),s.handler=i.handleRequest(l,d)},serverUrl:n.options.serverUrl,wintop:n.options.wintop})}})),s}this._onFailureGetSecurityContext(null,null,null,e,t)},_onCompleteGetSecurityContext:function(e,t,i){null!=e&&""!=e||0==t?(this._preferedSecurityContext=e,null!=i&&this._computeSecurityContext(i)):this._getSecurityContext(!1,i)},_onTimeoutGetSecurityContext:function(e,t){if(0!=e)this._getSecurityContext(!1,t);else{var i={message:n.get("ErrorTimeOut"),code:"TO"};null!=t&&t.onFailure.call(this,i)}},_onFailureGetSecurityContext:function(e,i,s,a,r){if(this._request=null,0!=a)this._getSecurityContext(!1,r);else{t.isJson(i)&&(i=t.decode(i));var o={};o=null!=i&&i.hasOwnProperty("error")?i.error:{message:n.get("ErrorSecurityContext"),code:"ERROR"},r&&"function"==typeof r.onFailure&&r.onFailure.call(this,o)}},getValidSecurityContext:function(e,t){let i=this;i._validSecurityContext=null;let s=function(){if(i.options.context&&"function"==typeof i.options.context.getSecurityContext){let e=i.options.context.getSecurityContext();if(e&&e.SecurityContext){let t=e.SecurityContext,n="";0!=t.indexOf("ctx::")&&(n="ctx::",t=n+t),i._isSecurityContextValid(t)?i._validSecurityContext={SecurityContext:t}:i._assignedSecurityContextOfLoggedInUser.length>0&&(i._validSecurityContext={SecurityContext:i._assignedSecurityContextOfLoggedInUser[0]})}else i._assignedSecurityContextOfLoggedInUser.length>0&&(i._validSecurityContext={SecurityContext:i._assignedSecurityContextOfLoggedInUser[0]})}else i._assignedSecurityContextOfLoggedInUser.length>0&&(i._validSecurityContext={SecurityContext:i._assignedSecurityContextOfLoggedInUser[0]});if(null!=i._validSecurityContext&&i._validSecurityContext.SecurityContext)e&&"function"==typeof e.onSuccess&&e.onSuccess.call(i,i._validSecurityContext);else{let t={message:n.get("ErrorSecurityContextEmpty"),code:"ERROR"};if(i.options.source&&"3DSPACE"!==i.options.source.toUpperCase()&&e&&"function"==typeof e.onSuccess)return void e.onSuccess.call(i,null);e&&"function"==typeof e.onFailure&&e.onFailure.call(i,t)}};0===i._assignedSecurityContextOfLoggedInUser.length&&"3DSPACE"===i.options.source.toUpperCase()?i._getSecurityContextAssignedToLoggedInUser(s):s()},_getSecurityContextAssignedToLoggedInUser:function(e){let t=this;t._numberOfTimesAPICalled++;let i={Accept:"application/json","Content-Type":"application/json"};require(["DS/WAFData/WAFData","DS/WidgetServices/WidgetServices"],(function(n,s){let a=t.options.tenant;a=a||s.getTenantID(),s.getSourceUrlAsync({platformId:a,source:t.options.source,onComplete:function(a){let r=a+"/resources/modeler/pno/person?current=true&select=collabspaces",o=t.options.tenant;o=o||s.getTenantID(),o&&(r+="&tenant="+o),i["Accept-Language"]=s.getLanguage();let l={type:"json",method:"GET",headers:i,onComplete:function(i){t._onCompleteGetSecurityContextAssignedToLoggedInUser(i,e)},onFailure:function(i,n,s){t._onFailureGetSecurityContextAssignedToLoggedInUser(i,n,s,e)},onTimeout:function(){t._onTimeoutGetSecurityContextAssignedToLoggedInUser(e)}};n.authenticatedRequest(r,l)},serverUrl:t.options.serverUrl,wintop:t.options.wintop})}))},_onCompleteGetSecurityContextAssignedToLoggedInUser:function(e,t){let i=this;e&&"object"==typeof e&&e.hasOwnProperty("collabspaces")&&Array.isArray(e.collabspaces)&&(e.collabspaces.forEach((e=>{let t=null;e.name&&(t=e.name),e.couples&&Array.isArray(e.couples)&&e.couples.forEach((e=>{let n=null,s=null;if(e.organization&&e.organization.name&&(n=e.organization.name),e.role&&e.role.name&&(s=e.role.name),t&&n&&s){let e=`ctx::${s}.${n}.${t}`;i._assignedSecurityContextOfLoggedInUser.push(e)}}))})),t())},_onFailureGetSecurityContextAssignedToLoggedInUser:function(e,i,s,a){let r=this;if(r._numberOfTimesAPICalled<2)r._getSecurityContextAssignedToLoggedInUser(a);else{t.isJson(i)&&(i=t.decode(i));let e={};e=null!=i&&i.hasOwnProperty("error")?i.error:{message:n.get("ErrorSecurityContext"),code:"ERROR"},r.errorObject=e,a()}},_onTimeoutGetSecurityContextAssignedToLoggedInUser:function(e){let t=this;if(t._numberOfTimesAPICalled<2)t._getSecurityContextAssignedToLoggedInUser(e);else{let i={message:n.get("ErrorTimeOut"),code:"TO"};t.errorObj=i,e()}},_isSecurityContextValid:function(e){let t=this;if(t.options.source&&"3DSPACE"!==t.options.source.toUpperCase())return!0;if(t._assignedSecurityContextOfLoggedInUser.length>0){return t._assignedSecurityContextOfLoggedInUser.includes(e)}return!1}})})),define("DS/ClassificationProp/controllers/ClassifPropUIController",["UWA/Class"],(function(e){"use strict";return e.extend({defaultOptions:{},init:function(e,t){this.allModels=[],this.editPropModelList=e,this._parent(t)},setModels:function(e){this.editPropModelList=e},getModels:function(){return this.editPropModelList},getModel:function(e){var t=null;return this.editPropModelList.every((function(i){var n=!0;return e==i.get("objectId")&&(t=i,n=!1),n})),t},getModifiedModels:function(){var e=[];return this.editPropModelList.forEach((function(t){if(!0!==t.get("isTransient")){var i=t.getChangedValues();Object.keys(i).length>0&&e.push(t)}})),e},getLabel:function(){var e="";return 1===this.editPropModelList.length&&(e=this.editPropModelList[0].get("label")),e}})})),define("DS/ClassificationProp/helpers/TweakerInfoWebUX",["DS/WidgetServices/WidgetServices","DS/WidgetServicesUI/helpers/Constants","DS/WidgetServicesUI/infra/TweakerBaseWebUX","DS/Controls/Label","DS/Controls/TooltipModel","i18n!DS/WidgetServicesUI/assets/nls/i18nWidgetService","css!DS/WidgetServicesUI/WidgetServicesUI"],(function(e,t,i,n,s,a){"use strict";return i.extend({init:function(e){this._parent(e)},_build:function(e,t){let i=this,s=new n({value:"",icon:"info"});i._element=s,i.setStyleForWuxComponent(s,"background","none"),i.setStyleForWuxComponent(s,"color","#77797C"),t.call(this,s)},_injectData:function(e,t){if(this._element){let t=new UWA.createElement("span");if(e&&Array.isArray(e)){new UWA.createElement("span",{html:e[0]}).inject(t);for(let i=1;i<e.length;i++)new UWA.createElement("br").inject(t),new UWA.createElement("span",{html:e[i]}).inject(t)}this._element.tooltipInfos=new s({title:a["Suggested Units"],shortHelp:t,allowUnsafeHTMLShortHelp:!0,mouseRelativePosition:!0,reshowDelay:0})}}})})),define("DS/ClassificationProp/utils/AttributesUtils",["UWA/Array","DS/WidgetServices/WidgetServices","i18n!DS/ClassificationProp/assets/nls/langEditProp"],(function(e,t,i){"use strict";return{defaultOptions:{},validateModels:function(e){for(var t=null,i=e.length,n=0;n<i;n++){var s=e[n];t=this._validateAllAttributes(s)}return t},validateAttributes:function(e,t){var i=this,n=[],s=[];return t.forEach((function(t){if(t?t.name:null){!0!==t.get("error").server&&t.resetError();var n=t.valueDB,a=null;if(e.isMergedModel()){var r=Object.keys(n);r.length>0&&(a=r[0])}if(null!=a&&(n=n[a]),null!==(n=n||(!0===t.get("readOnly")?null:null!=a?t.value[a]:t.value))){var o=i.checkValueForAttribute(t,n,s);o&&o.message&&t.setError(o.message,o.type)}}})),s.length>0?s.forEach((function(e){var t={customClass:e.attrName&&e.attrName.length>0?"EP_Warning_"+e.attrName:"EP_Warning_Message",message:e.message,code:"ERROR",eventID:"warning"};n.push(t)})):n=null,n},checkValueForAttribute:function(n,s,a){var r=this,o=n?n.name:null,l={message:null,type:null};if(o&&!0!==n.get("readOnly")){var c=n.label;return c=c?c.toLowerCase():"",null!==s&&(Array.isArray(s)||(s=[s]),0==s.length&&!0===n.mandatory&&(l=r.addError(a,n,c,"MandatoryAttribute")),s.every((function(s){var o=null;if("function"==typeof n.validationFunction&&(o=n.validationFunction(n)),o&&((l=r.addError(a,n,n.label,o.message)).type=o.type),!0===n.mandatory){var u=s+"",d=new RegExp(" ","g");""===(u=u.replace(d,""))&&(l=r.addError(a,n,c,"MandatoryAttribute"))}if(n.maxlength>0&&s.length>n.maxlength&&(l=r.addErrorWithValue(a,n,c,n.maxlength,"MaxLengthAttribute")),"real"===n.type||"integer"===n.type){u=s;if(UWA.is(s,"string")&&""!==n.unitName){var h=s.split(" ");2==h.length&&h[1]===n.dimension&&(u=h[0])}e.isArray(u)?u.forEach((function(e){isNaN(e)&&(l=r.addErrorWithValue(a,n,n.label,e,"NotaNumber"))})):isNaN(u)?l=r.addErrorWithValue(a,n,n.label,u,"NotaNumber"):"integer"===n.type&&u%1!=0&&(l=r.addErrorWithValue(a,n,n.label,u,"IntegerIsDecimal"))}if(""!==n.minval){var f=parseFloat(n.minval),p=n.value;if(e.isArray(p))p.forEach((function(e){var t=parseFloat(e);t<f&&(l=r.addErrorWithValue(a,n,n.label,e,"OutOfMinVal")),n.minvalincluded||t!==f||(l=r.addErrorWithValue(a,n,n.label,e,"OutOfMinVal"))}));else(m=parseFloat(n.value))<f&&(l=r.addErrorWithValue(a,n,n.label,n.value,"OutOfMinVal")),n.minvalincluded||m!==f||(l=r.addErrorWithValue(a,n,n.label,n.value,"OutOfMinVal"))}if(""!==n.maxval){var m,g=parseFloat(n.maxval);p=n.value;if(e.isArray(p))p.forEach((function(e){var t=parseFloat(e);t>g&&(l=r.addErrorWithValue(a,n,n.label,e,"OutOfMaxVal")),n.maxvalincluded||t!==g||(l=r.addErrorWithValue(a,n,n.label,e,"OutOfMaxVal"))}));else(m=parseFloat(n.value))>g&&(l=r.addErrorWithValue(a,n,n.label,n.value,"OutOfMaxVal")),n.maxvalincluded||m!==g||(l=r.addErrorWithValue(a,n,n.label,n.value,"OutOfMaxVal"))}var v=n.get("forbiddenChar");if(v){u=s;if(t.commonChar(u,v,!0)>0){var _=i.replace(i.get("ForbiddenCharacters"),{label:n.label,badChars:v});a.push({message:_,attrName:n.getIdentifier()}),l.message=_,l.type="error"}}if("unit"===n.get("tw_type")){let e=n.get("dimensionType"),i=n.get("dimension");if(e&&i){let s=t.getValue("DimensionsDictionary");if(e&&s){e.startsWith("DSDim_")&&(e=e.substring(6,e.length));let t=s.get(e),o=!1;if("object"!=typeof i||Array.isArray(i)){if(t&&t.Units&&Array.isArray(t.Units))for(let e=0;e<i.length;e++){let s=i[e],c=t.Units.filter((e=>e.label?e.label===s||e.NLSName===s:e.Name===s||e.NLSName===s));if(Array.isArray(c)&&c.length>0&&(o=!0),!o){l=r.addErrorWithValue(a,n,n.label,s,"NotAValidDimension");break}}}else{let e=Object.keys(i);for(let s=0;s<e.length;s++){let c=i[e[s]];if(t&&t.Units&&Array.isArray(t.Units))for(let e=0;e<c.length;e++){let i=c[e],s=t.Units.filter((e=>e.label?e.label===i||e.NLSName===i:e.Name===i||e.NLSName===i));if(Array.isArray(s)&&s.length>0&&(o=!0),!o){l=r.addErrorWithValue(a,n,n.label,i,"NotAValidDimension");break}}}}}}}return null===l.message}))),l}},getUXBLErrors(e){var t=[];if(!e)return t;var i=e.values();return i&&i.forEach((e=>{e&&e.name&&e.visible&&(UWA.is(e.uxBLerror,"object")?t.push(e.uxBLerror):UWA.is(e.notif,"object")&&1==e.notif.sev&&t.push(e.notif))})),t},_validateAllAttributes:function(e){var t=e.values();return this.validateAttributes(e,t)},addErrorWithValue:function(e,t,n,s,a){i.get(a);var r=i.replace(i.get(a),{label:n,value:s});return e.push({message:r,attrName:t.getIdentifier()}),{message:r,type:"error"}},addError:function(e,t,n,s){i.get(s);var a=i.replace(i.get(s),{label:n});return e.push({message:a,attrName:t.getIdentifier()}),{message:a,type:"error"}}}})),define("DS/ClassificationProp/constants/ClassifPropConstants",[],(function(){"use strict";return{ONLY_IDENTITY_CARD:"editProp_onlyIC",ONLY_EDIT_PROPERTIES:"editProp_onlyProperties",ALL:"editProp_all",ALL_SELECTION:"allSelection",RESTRICTED_SELECTION:"restrictSelection",NO_SELECTION:"noSelection",MVA_SEP:"|",POPUP:"editProp_popup",TRANSIENT:"editProp_transient",STANDARD:"editProp_standard",FORCE_READWRITE:"force_readWrite",FORCE_READONLY:"force_readonly",FORCE_DEFAULT:"force_default",NO_CHANGES:"no_changes",ACTION_REFRESH:"cw",FACET_NONE:"none",FACET_VIEWS:"views",FACET_PROPERTIES:"classificationAttiProp",FACET_SWYM_COMMUNITY_PROPERTIES:"swym_community_properties",FACET_SWYM_USER_PROPERTIES:"swym_user_properties",FACET_SWYM_SURVEY_PROPERTIES:"swym_survey_properties",FACET_SPECIFICATIONS:"Specifications",FACET_Variability:"Variability",FACET_EFFECTIVITY:"Effectivity",FACET_CHANGE:"Change",FACET_iCHANGE:"iChange",FACET_ALTERNATE:"Alternate",FACET_IPPROTECTION:"IPProtection",FACET_RICHCONTENT:"Rich Content Attr",FACET_DOCUMENTS:"documents",FACET_FILES:"Files",FACET_PROXY:"proxyFacet",FACET_ADMIN:"adminFacet",FACET_RELATIONS:"relations",FACET_DERIVEDOUTPUT:"derivedoutputs",FACET_REVISIONS:"revisions",FACET_SHARING:"sharing",FACET_PHYSICSSIMULATION:"physicssimulation",FACET_POSTERRORANALYSIS:"postErrorAnalysis",FACET_PC_CONTENT:"product_configuration_content",FACET_FL_SPECIFICATION:"catfl_specification_document",FACET_CLASSIFICATIONPROP:"classificaiton_prop",MODEL_INIT:"Classification_INIT",MODEL_FACET_INFO_PREFIX:"_DS_FACET_",MODEL_DS_ATTR:"_DS_ATTR_",METATYPE_BUS:"businessobject",METATYPE_REL:"relationship",METATYPE_PATH:"path",METATYPE_UNKNOWN:"unknown",MULTISEL_STD:"yes",MULTISEL_NO:"no",MULTISEL_MERGE:"merge",COLLAPSE_IC_PREFERENCE:{type:"hidden",name:"editProperty_collapseIC",label:"is IC collapse",defaultValue:"false"},TYPES:{INTEGER:"integer",REAL:"real",TIMESTAMP:"timestamp",PERSON:"person",BOOLEAN:"boolean",ENUM:"enum"},MIN_WIDTH_FOR_TABLE:200,WIDTH_SWITCH_MODE:150,VARIABLES:{minWidthForTable:200},ACCORDION:{ATTRIBUTES:"Attributes"},isCloseButton:function(e){return e!==this.STANDARD}}})),define("DS/ClassificationProp/utils/ClassifPropControl",["UWA/Controls/Abstract"],(function(e){return e.singleton({_Context:null,_informationPanel:!1,_plmNewPanel:!1,_objectId:!1,_dataProvider:null,_ipClassifyAlertProvider:null,_classifPropController:null,_conflictPanelsResolved:null,_searchFilterforDefinition:null,_searchFilterforCategorization:null,getContext:function(){return this._Context},setContext:function(e){this._Context=e},setIsPLMNewCreation:function(e){this._plmNewPanel=e,e&&(this._informationPanel=!1)},getIsPLMNewCreation:function(){return this._setActiveComponentValues(),this._plmNewPanel},_setActiveComponentValues:function(){var e=document.querySelectorAll(".IPClassificationCreationPanel");e&&e.length>0?(this._plmNewPanel=!0,this._informationPanel=!1):(this._plmNewPanel=!1,this._informationPanel=!0)},getInformationPanel:function(){return _conflictPanelsResolved=!0,this._setActiveComponentValues(),this._informationPanel},setInformationPanel:function(e){e&&(this._plmNewPanel=!1),this._informationPanel=e},getCurrentPanel:function(){return this._setActiveComponentValues(),this._plmNewPanel?"plmNewCreationPanel":this._informationPanel?"informationPanel":null},getObjectId:function(){return this._objectId},setObjectId:function(e){this._objectId=e},getProvider:function(){return this._dataProvider},setProvider:function(e){this._dataProvider=e},getIPClassifyAlertProvider:function(){return this._ipClassifyAlertProvider},setIPClassifyAlertProvider:function(e){this._ipClassifyAlertProvider=e},getClassifPropController:function(e){return this._classifPropController},setClassifPropController:function(e){this._classifPropController=e},setSearchQueryFilter:function(e,t){this._searchFilterforDefinition=e,this._searchFilterforCategorization=t},getSearchQueryFilter:function(){return!0===this._searchFilterforDefinition&&1==this._searchFilterforCategorization?null:!0===this._searchFilterforDefinition?"Definition":!0===this._searchFilterforCategorization?"Standard":null}})})),define("DS/ClassificationProp/changeAction/passThruJS",[],(function(){"use strict";return{onReady:function(e){require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext"],(function(t){var i={changeIsSetChecker:function(e){return e&&e.AuthoringContextHeader&&Object.keys(e.AuthoringContextHeader).length>0}},n=[],s=[];for(var a in t)"function"==typeof t[a]&&(n.push(t[a]),s.push(a));s.forEach((function(e,s){i[e]=function(i,a){if("init"!==e&&"constructor"!==e&&"initialize"!==e&&"undefined"==typeof enoviaServerAuthoringWidget)return console.log("Authoring context not initialized"),void("function"==typeof i?i({}):"function"==typeof a&&a({}));n[s].apply(t,arguments)}})),e.call(null,i)}),(function(){e.call(null,null)}))}}})),define("DS/ClassificationProp/comm/CommManager",["UWA/Class"],(function(e){"use strict";return e.extend({subscriptions:[],lCurrentListId:[],_nbOfCancelReceived:0,_statusReady:"ready",_statusRunning:"running",_commName:null,_currentStatus:null,_currentListenStatus:null,init:function(e){this._currentStatus=null,this._currentListenStatus=null,this.subscriptions=[],this.lCurrentListId=[],this._nbOfCancelReceived=0,e||(e="default"),this._commName=e},getCommObject:function(e){var t=window.top.EP_CommManager;return t||!0===e||(t=window.top.EP_CommManager={}),t},getCurrentComm:function(e){var t=this.getCommObject(e);return(t=t||{})[this._commName]||e||(t[this._commName]={callbacks:[]}),t[this._commName]},_removeCurrentComm:function(){this.getCommObject(!0)&&delete window.top.EP_CommManager[this._commName]},createRunningEvent:function(e){this.lCurrentListId=e,this._currentStatus={status:this._statusRunning,answer:this.lCurrentListId},this.getCurrentComm().status=this._currentStatus},createReadyEvent:function(e){this._currentStatus={status:this._statusReady,answer:e};var t=this.getCurrentComm();t.status=this._currentStatus,t.callbacks&&t.callbacks.length>0&&(t.callbacks.forEach((function(t){t.call(null,e)})),this._removeCurrentComm())},createListenEvent:function(e){var t=this.getCurrentComm(!0);t&&(t.status.status===this._statusReady?(e.call(null,t.status.answer),this._removeCurrentComm()):t.callbacks.push(e))},getCurrentListenStatus:function(){var e=this.getCurrentComm(!0),t=null;return e&&(t=e.status.status),t},destroy:function(){this._removeCurrentComm(),this._parent()}})})),define("DS/ClassificationProp/helpers/TweakerNumberWebUX",["DS/WidgetServices/WidgetServices","DS/WidgetServicesUI/helpers/Constants","DS/WidgetServicesUI/infra/TweakerBaseWebUX","DS/UIKIT/Input/Text","DS/Controls/SpinBox","i18n!DS/WidgetServicesUI/assets/nls/i18nWidgetService","css!DS/WidgetServicesUI/WidgetServicesUI"],(function(e,t,i,n,s,a){"use strict";return i.extend({init:function(e){this._parent(e)},_postInit:function(){this.getType(),t.TYPES.INTEGER_WUX},_build:function(i,n){var r=this,o=""===i.value?i.value:parseFloat(i.value),l=null;if(i.placeholder)l=i.placeholder;else switch(l=a["Enter a value"],this.getType()){case t.TYPES.INTEGER_WUX:l=a["Enter an integer"];break;case t.TYPES.NUMBER_WUX:l=a["Enter a number"]}var c={value:o||0===o&&""!==o?o:void 0,units:i.units?i.units:"",minValue:r.options.minValue?r._getMinValue():void 0,maxValue:r.options.maxValue?r._getMaxValue():void 0,stepValue:r.options.stepValue?r.options.stepValue:1,placeholder:l,allowUndefinedFlag:!0,decimals:null,useScientificNotationFlag:!1,highExponentProperty:void 0,lowExponentProperty:void 0},u=new s(c);r.twElement=u;var d=u._myInput;d.addEventListener("blur",(function(e){var t=u.value;if(!0!==r.options.multivalued&&!0!==r.options.multisel||""!==t&&void 0!==t){t=r._checkAndAdaptValue(t);i.multivalued&&(t=t.toString()),r._dispatchChange(t,!0)}})),u.addEventListener("keydown",(function(e){13===e.keyCode&&setTimeout((function(){var t=u.value;t=r._checkAndAdaptValue(t),i.multivalued&&(t=t.toString()),r._dispatchLiveChange(t,e)}))})),u.addEventListener("change",(function(e){var t=e.dsModel.value;t=r._checkAndAdaptValue(t);r._dispatchLiveChange(t.toString())}));var h="input-number-label ";r.options.multivalued&&(h+="multivaluedAttribute MVANumber"),r.setClassNameForWebUXComponent(u,h),r.setStyleForWuxComponent(u,"width","100%");var f=e.getLanguage();d.setAttribute("lang",f);var p={input:function(t){setTimeout((function(){var t=u.valueToCommit,i=e.getLanguage(),n=.1.toLocaleString(i)[1];t=t.replace(n,"."),r._dispatchLiveChange(t)}))}};u.elements.inputField.addEvents(p),n.call(this,u)},_computeValueForRO:function(t,i){var n=null,s=Math.pow(10,6),a=Math.pow(10,-5);if(isNaN(t)||""===t)n=this._parent(t);else{var r=parseFloat(t),o=!i||!0!==i.detailed;n=r;var l=Math.abs(r);l>0&&(l>=s||l<a)?n=r.toExponential():o&&(n=r.toString()),n=this._removeTrailingZeros(n+"");var c=e.getLanguage(),u=.1.toLocaleString(c)[1];n=n.replace(".",u)}return n},_removeTrailingZeros:function(e){return e.replace(/((\.[0-9]*[1-9])|\.)0*(([eE])|[^eE]?.?\d*$)/,"$2$4")},_checkAndAdaptValue:function(e){if(""===e||void 0===e)return"";if(isNaN(e))return e;var t=parseFloat(e),i=1;if(this.options.stepValue){var n=this.options.minValue?this.options.minValue:0,s=(i=this.options.stepValue)+"",a=0,r=s.indexOf(".");r<0&&(r=s.indexOf(",")),r>=0&&(a=s.length-r-1);var o=Math.pow(10,a),l=parseInt(i*o),c=parseInt((t-n)*o);t=(c-c%l+n*o)/o}if(this.options.minValue){var u=this._getMinValue();t=Math.max(t,u)}if(this.options.maxValue){var d=this._getMaxValue();t=Math.min(t,d)}return t},areEquals:function(e,t){return!isNaN(e)&&!isNaN(t)&&(this._parent(e,t)||parseFloat(e)===parseFloat(t))},checkValue:function(e){var t=isNaN(e)?a["Please enter a correct value"]:null,i=null;return t&&(i={message:t}),i},_changeRW:function(e,t){var i=this;null===e||""===e?i.getElement().value=void 0:(t||document.activeElement!==i.getElement().elements.input)&&(i.getElement().value=parseFloat(e))},focus:function(){var e=this.getHTMLElement();e&&e.select()},_validate:function(t){var i=e.getLanguage(),n=.1.toLocaleString(i)[1];return t=t.replace(n,"."),t=this._checkAndAdaptValue(t)},resetTweaker:function(){this.twElement.value=void 0}})})),define("DS/ClassificationProp/models/ClassifPropAttributeModel",[],(function(){"use strict";return function(e){for(var t in this._identifier=null,this.isTransient=!1,this.name="",this.label="",this.select="",this.path="",this.value="",this.valueDB="",this.type="text",this.tw_type=null,this.authorizedValues=[],this.authorizedValuesNLS=[],this.authorizedValuesRequired=!0,this.deprecatedAuthorizedValues=[],this.dimension="",this.unitName=null,this.dimensionType=null,this.dimensionUnits=null,this.displayAsEntered=!1,this.keepformat=!1,this.maxlength=-1,this.positionUI="0",this.positionIdentityCard=-1,this.sectionIdentityCard="",this.masked=!0,this.forbiddenChar=null,this.mandatory=!1,this.modified=!1,this.multiline=!1,this.multivalue=!1,this.multisel=!1,this.readOnly=!0,this.minval="",this.maxval="",this.minvalincluded=!1,this.maxvalincluded=!1,this.attributeID="",this.facet="",this.section="",this.extension="",this.group="Default",this.urlIcon=null,this.from=null,this.navType=null,this.relation=null,this.dbValues={value:"",valueDB:""},this.initialsValues={value:"",valueDB:"",dimension:""},this.error={message:null,type:"error"},this.validationFunction=function(){},e)this[t]=e[t];this.getIdentifier=function(){var e=this._identifier;return e||(e="",e+=this.facet?this.facet+"-":"",e+=this.path,this._identifier=e),e},this.set=function(e,t){void 0!==t&&(this[e]=t,"modified"!==e&&(this.modified=!0))},this.saveInitialValues=function(){for(var e in this.initialsValues)this.initialsValues[e]=UWA.clone(this[e]),this.dbValues[e]=UWA.clone(this[e])},this.resetError=function(){this.error={message:null,type:"error"}},this.setError=function(e,t,i){e&&(t||(t="error"),this.error={message:e,type:t,server:!0===i})},this.resetInitialValues=function(){for(var e in this.initialsValues)this[e]=UWA.clone(this.initialsValues[e])},this.get=function(e){return this[e]},this.isSameValueSet=function(e){var t=!0;if(t=!(null===e.value||null===this.value||null===e.valueDB||null===this.valueDB))if(this.multisel){for(var i in this.value)if(!(t=t&&this._isSameValueSet(e.value[i],this.value[i],e.valueDB[i],this.valueDB[i])))break}else t=this._isSameValueSet(e.value,this.value,e.valueDB,this.valueDB,e.dimension,this.dimension);return!t},this._isSameValueSet=function(e,t,i,n,s,a){var r=!0;if("boolean"===this.type)r=i===n||(i+"").toLowerCase()===(n+"").toLowerCase();else{var o=e.length;if((r=null==t||o===t.length)&&null!=s&&null!=a&&(r=a.length===s.length),r){if("relation"!==this.type)for(var l=0;l<o&&(r=e[l]===t[l]);l++);if(r){r=(o=i.length)===(n?n.length:0);for(l=0;l<o&&(r=i[l]===n[l]);l++);}r&&(r=s===a)}}return r},this.getChangedIds=function(){var e={};if(!0===this.multisel)for(var t in this.value){var i=this.value[t],n=this.valueDB[t],s=s&&this._isSameValueSet(this.initialsValues.value[t],i,this.initialsValues.valueDB[t],n);s||(e[t]={value:i,valueDB:n})}else e.a={value:this.value,valueDB:this.valueDB};return e},this.hasChanged=function(){return this.isSameValueSet(this.initialsValues)},this.applySort=!1}})),define("DS/ClassificationProp/comm/EventManager",["UWA/Class"],(function(e){"use strict";var t=0,i=e.singleton({init:function(){this._parent.apply(this,arguments),this._events={},this._queueStack=[]},publish:function(e){var i=this,n={index:++t},s=this._events[e];Array.prototype.shift.apply(arguments);var a=arguments;s&&s.forEach((function(e){i._queueStack.push({callback:e,context:n,args:a})}));for(var r=null;r=this._queueStack.shift();)r.callback.apply(r.context,r.args)},subscribe:function(e,t){var i=this._events[e];i||(i=[],this._events[e]=i),i.push(t)},subscribeSingleInstance:function(e,t){var i=this._events[e];i||(i=[],this._events[e]=i),0!=i.length&&(i=[]),i.push(t)},remove:function(e,t){var i=this._events[e];if(i){for(var n=-1;(n=i.indexOf(t))>=0;)i.splice(n,1);0==i.length&&delete this._events[e]}}});return i})),define("DS/ClassificationProp/models/CommonAbstract",["DS/ClassificationProp/comm/EventManager","UWA/Controls/Abstract"],(function(e,t){var i=0,n=t.extend({_callbacks:{},init:function(e){i++,e&&!e.eventThread&&(e.eventThread="CT"+i),this._parent.apply(this,arguments),this._callbacks={}},publishEvt:function(t){var i=this._getEventThread(t);arguments[0]=i,e.publish.apply(e,arguments)},subscribeEvt:function(t,i,n){var s=this._getEventThread(t);arguments[0]=s,e.subscribe.apply(e,arguments),this._callbacks[s]=i},destroy:function(){for(var t in this._callbacks)e.remove(t,this._callbacks[t]);this._parent.apply(this,arguments)},_getEventThread:function(e){return(this.options.eventThread?this.options.eventThread+".":"")+e},_callMethodOnEach:function(e,t){var i=e,n=t;for(var s in Array.prototype.shift.apply(arguments),Array.prototype.shift.apply(arguments),i)i[s][n].apply(this,arguments)}});return n})),define("DS/ClassificationProp/models/ClassifPropModel",["UWA/Class/Model","UWA/Class/Debug","DS/WidgetServices/WidgetServices","DS/ClassificationProp/models/ClassifPropAttributeModel","DS/ClassificationProp/constants/ClassifPropConstants","i18n!DS/ClassificationProp/assets/nls/langEditProp"],(function(e,t,i,n,s){"use strict";return e.extend(t,{METATYPE_BUS:s.METATYPE_BUS,METATYPE_REL:s.METATYPE_REL,METATYPE_PATH:s.METATYPE_PATH,changedValues:{},_locked:!1,_lockedAttributes:[],_initProperties:{},defaults:{metatype:s.METATYPE_UNKNOWN,source:"3DSpace",sourceName:"",tenant:i.getTenantID(),objectId:"",label:"",labelAttribute:"",type_icon_url:"",previewUrl:"",isTransient:!1,_changeId:"",instrefid:""},isMergedModel:function(){return!1},getOptions:function(){var e={};for(var t in this.defaults)e[t]=this.get(t);return e},lockModel:function(e){var t=this;this._locked=!0===e,this._locked||(this._lockedAttributes.forEach((function(e){var i=t.get(e);null!=i&&(i=new n(i),t.set(e,i))})),this._lockedAttributes=[])},isLocked:function(){return!0===this._locked},setFloatingAttribute:function(e,t,i){this.isLocked()?(this._attributes[e]=t,this._lockedAttributes.indexOf(e)<0&&this._lockedAttributes.push(e)):(!0!==i&&(t=new n(t)),this.set(e,t))},getComputedTitle:function(){return this.get("label")},setup:function(){for(var e in this._lockedAttributes=[],this._locked=!1,this.changedValues={},this._initProperties={},this.defaults)this._initProperties[e]=this.get(e)},getChangeId:function(){return this.get("_changeId")},getTenant:function(){return this.get("tenant")},saveInitialValues:function(e,t){var i=this,n=this.keys(),s=[];n.forEach((function(t){var n=i.get(t);null!==n&&"object"==typeof n&&"function"==typeof n.saveInitialValues&&(null==e||e.indexOf(t)>=0)&&(n.saveInitialValues(),s.push(t))})),!1!==t&&this._dispatchChangedAttributes(i,s,!1),this._clearChangedValue(e),this.modelSaved()},isTransientModel:function(){return this.get("isTransient")},getAttributeFromField:function(e,t,i){var n=this;i=i||0;var s=[];return this.keys().every((function(a){var r=n.get(a);return null!==r&&"object"==typeof r&&"function"==typeof r.get&&r.get(e)===t&&s.push(r),0===i||s.length<i})),1===i?s.length>0?s[0]:null:s},resetInitialValues:function(){var e=this;this.keys().forEach((function(t){var i=e.get(t);i&&"object"==typeof i&&"function"==typeof i.resetInitialValues&&(i.resetInitialValues(),e._dispatchChangedAttributes(e,[t],!0))})),this._clearChangedValue()},resetAllErrors:function(e){var t=this;this.keys().forEach((function(i){var n=t.get(i);n&&"object"==typeof n&&"function"==typeof n.resetError&&(n.resetError(),!1!==e&&t._dispatchChangedAttributes(t,[i],!0))}))},clearChangedValue:function(e){this._clearChangedValue(e)},_clearChangedValue:function(e){var t=this;e?e.forEach((function(e){t._removeChangedValue(e)})):this.changedValues={}},removeChangedValue:function(e){this._removeChangedValue(e)},_removeChangedValue:function(e){this.changedValues[e]&&delete this.changedValues[e]},attributeHasChanged:function(e){return!!this.changedValues[e]},removeEvent:function(e,t){this.removeEvent2("onChange:"+e,t)},removeEvent2:function(e,t){var i=this._dispatchers[e];if(i)for(var n=i.bindings.length-1;n>=0;n--){i.bindings[n].listener===t&&i.bindings.splice(n,1)}},getChangedValues:function(){return this.changedValues},setChangedValues:function(e){"object"==typeof e&&(this.changedValues=e)},hasSameAttributesThan:function(e){var t=Object.keys(this._attributes),i=Object.keys(e._attributes),n=!1;return t.length===i.length&&(n=!0,t.every((function(e){return i.indexOf(e)<0&&(n=!1),n}))),n},onChange:function(e){var t=this._getChangedAttributes(e);t.length>0&&this._dispatchChangedAttributes(e,t,!1)},_getChangedAttributes:function(e){var t=e.changedAttributes(),i=[];for(var s in t){var a=t[s],r=!1;a instanceof n&&((r=a.hasChanged())?e.changedValues[s]=a:((r=void 0!==e.changedValues[s])&&delete e.changedValues[s],r=r||!this._previousAttributes[s]),r&&i.push(s))}return i},_dispatchChangedAttributes:function(e,t,i){var n=this,s=[];t.forEach((function(t){i&&n.dispatchEvent("onChange:"+t),s.push(e.get(t))})),this.dispatchEvent("onChangeAttributes",[e,s])},modelSaved:function(){this.dispatchEvent("onSave")},getAllAttributes:function(){return this._attributes}})})),define("DS/ClassificationProp/constants/ConstantsMapping",["DS/ClassificationProp/constants/ClassifPropConstants","DS/WidgetServices/WidgetServices","i18n!DS/ClassificationProp/assets/nls/langEditProp"],(function(e,t,i){"use strict";var n={"3dspace":{name:"3DSpace",fedPrefix:"physicalid",require:"DS/ClassificationProp/ajaxRequests/3DSpaceAjaxRequests",identifire:"pid:",path:"/resources"},fedsearch:{name:"3DSearch",require:"DS/ClassificationProp/ajaxRequests/FederatedAjaxRequests"}};return{getSupportedServices:function(){return n},getSupportedServicesArray:function(){var e=this.getSupportedServices(),t=[],i=[];for(var n in e){var s=e[n];!0!==s.modelRequired&&(s.isSource?t.push(s.id?s.id:n):i.push(s.name))}return{sources:t,services:i}},getServiceBySource:function(e){return n[e]},getServiceForModel:function(e){var t=null,i=null;if(e){if(i=e.get("_sourceId"),!(t=n[i])){var s=e.get("sourceName");s&&(i=s.toLowerCase(),t=n[i]),t||(s=e.get("source"))&&(i=s.toLowerCase(),t=n[i]),e.set("_sourceId",i)}null!=t&&(e.identifire=t.identifire?t.identifire:"",e.path=t.path?t.path:"")}return t},getMapping:function(t){var i={};return i[e.FACET_PROPERTIES]={alwaysCalled:!1,supportMerge:!0,require:"DS/ClassificationProp/facets/Properties/ClassifPropController",options:t,facet:{name:e.FACET_PROPERTIES,text:"classification attributes",icon:"attributes"}},i},getDefaultFacets:function(i,n){var s=this.getMapping(),a=[e.FACET_PROPERTIES],r=a,o=t.isWebInWinEnvironment();return!0!==o&&!0!==i&&!0!==n||(r=[],a.forEach((function(e){var t=!0,a=s[e];!0===i&&(t=!a||!0===a.supportMerge),t&&!0===o&&(t=!1!==a.webInWin),t&&(!0===n?r.push(a):r.push(e))}))),r}}})),define("DS/ClassificationProp/comm/DistantAjax",["UWA/Class","DS/ClassificationProp/comm/CommManager","DS/WidgetServices/WidgetServices"],(function(e,t,i){"use strict";return window.top.perfoIncrem=window.top.perfoIncrem?window.top.perfoIncrem:0,e.singleton({_isAsynchronous:!1,_valuesAsync:{},init:function(){this._isAsynchronous=!0===widget.getValue("asynchronousRequest")||"true"===widget.getValue("asynchronousRequest"),widget.setValue("asynchronousRequest","false"),this._valuesAsync={}},_getCommManager:function(e){e.call(this,t)},getAsyncRead:function(e){this._getAsync("read",e)},getAsyncFacetCheck:function(e){this._getAsync("facetCheck",e)},_getAsync:function(e,t){this._isAsynchronous?this._getCommManager((function(i){var n=new i(e);n.createListenEvent((function(e){t(e),n.destroy()})),setTimeout((function(){n.getCurrentListenStatus()||t(null)}),100)})):t(null)},_distantCall:function(e,t,i,n){this._getCommManager((function(s){var a=new s(e),r=!1,o=++window.top.perfoIncrem;window.top.performance.mark("start_getAsync:"+o),this._getAsync(e,(function(e){e&&window.top.performance.mark("end_getAsync:"+o),!1===r&&e&&e.discriminant===t&&(r=!0,i&&i(e?e.value:e))})),setTimeout((function(){!1===r&&(a.createRunningEvent(),n.call(this,(function(e){!1===r&&(r=!0,a.createReadyEvent({value:e,discriminant:t}),i&&i(e))})))})),setTimeout((function(){a&&a.destroy()}),12e4)}))},getRoles:function(e,t){var n=this;this._distantCall("role",e,t,(function(t){i.getGrantedRoles((function(e){t.call(n,e)}),e)}))},getServices:function(e,t){var n=this;this._distantCall("services",e,t,(function(e){i.getServicesUrl({onComplete:function(t){e.call(n,t)}})}))},launchMainRead:function(e,i){require(["DS/ClassificationProp/ajaxRequests/ClassifPropAjaxRequests","DS/ClassificationProp/ajaxRequests/ServicesAjaxRequests"],(function(n,s){var a=new t("read");a.createRunningEvent(e),n.getListOfAttributes({modelList:e,tenant:s.getTenantFromModel(e&&e.length>0?e[0]:null),handleRequest:{},navigateToMain:!0,securityContext:i.securityContext,index_mode:i.index_mode,onComplete:function(e){a.createReadyEvent(e)}}),setTimeout((function(){a&&a.destroy()}),12e4)}))},launchFacetsVisibility:function(e,t,n,s,a){var r=this,o=["DS/ClassificationProp/ajaxRequests/ClassifPropAjaxRequests","DS/ClassificationProp/ajaxRequests/ServicesAjaxRequests"];void 0===this._valuesAsync.facetCheck&&(this._valuesAsync.facetCheck=this._isAsynchronous);var l=this._valuesAsync.facetCheck&&!s,c=!1,u=0;n.handleRequest=n.handleRequest?n.handleRequest:{},n.handleRequest&&(n.handleRequest.handle=i.getCancelObject());var d=n.handleRequest.handle;s?o.push("DS/ClassificationProp/comm/CommManager"):l&&(u=200,this.getAsyncFacetCheck((function(e){1==c||d.isCancelled()||e&&(c=!0,r._valuesAsync.facetCheck=!1,n.onComplete(e))}))),require(o,(function(i,s,o){setTimeout((function(){if(!0!==c&&!d.isCancelled()){var l=null;o&&((l=new o("facetCheck")).createRunningEvent(e),setTimeout((function(){l&&l.destroy()}),12e4)),i.checkFacetsVisibility({handleRequest:n.handleRequest,context:n.context,tenant:s.getTenantFromModel(e),model:e,facets:t,sourceAppId:a,onComplete:function(e){l&&l.createReadyEvent(e),"function"==typeof n.onComplete&&!0!==c&&n.onComplete(e),c=!0,r._valuesAsync.facetCheck=!1}})}}),u)}))}})})),define("DS/ClassificationProp/models/ClassifPropModelMerge",["DS/ClassificationProp/models/ClassifPropModel","DS/ClassificationProp/models/ClassifPropAttributeModel","i18n!DS/ClassificationProp/assets/nls/langEditProp"],(function(e,t,i){var n=e.extend({_innerModels:{},setup:function(){this._parent(),this._innerModels={}},getMergingModels:function(){return this._innerModels},getMergedModelIds:function(){var e=this.getMergingModels();return Object.keys(e)},setMergingModels:function(e){var t=this;if(this._innerModels)for(var i in this._innerModels){(n=this._innerModels[i])._callbackMerge&&n.removeEvent("onChangeAttributes",n._callbackMerge[t.get("objectId")])}for(var i in this._innerModels=e,this._innerModels){var n;(n=this._innerModels[i])._callbackMerge=n._callbackMerge?n._callbackMerge:{},n._callbackMerge[t.get("objectId")]=function(e,i){var n=e.get("objectId");i.forEach((function(e){var i=e.getIdentifier(),s=t.get(i);s&&(s.get("value")[n]=e.get("value"),s.get("valueDB")[n]=e.get("valueDB"),t.setFloatingAttribute(i,s))}))},n.addEvent("onChangeAttributes",n._callbackMerge[t.get("objectId")])}},isMergedModel:function(){return!0},set:function(e,i){i instanceof t&&i.set("multisel",!0),this._parent(e,i)},getComputedTitle:function(){var e=this.getMergedModelIds().length;return newLabel=i.replace(i.get("{0} objects selected"),{0:e}),newLabel},resetAllErrors:function(){var e=this;this.lockModel(!0);var t=this.getMergingModels();for(var i in t)t[i].resetAllErrors();setTimeout((function(){e.lockModel(!1)})),e._parent(!1)},clearChangedValue:function(e){var t=this;this.lockModel(!0);var i=this.getMergingModels();for(var n in i);setTimeout((function(){t.lockModel(!1)}))},resetInitialValues:function(){this._parent.apply(this,arguments);var e=this.getMergingModels();for(var t in e){var i=e[t];i.resetInitialValues.apply(i,arguments)}},getChangedValues:function(){var e={},t=this.getMergingModels();for(var i in t){var n=t[i];if(n){var s=n.getChangedValues();if(s)for(var a in s){var r=this.get(a);r&&(e[a]=r)}}}return e},_getChangedAttributes:function(e){var t=e.changedAttributes(),i=e.getChangedValues(),n=[];for(var s in t)null!==i[s]&&n.push(s);return n}});return n})),define("DS/ClassificationProp/utils/ClassifPropUtils",["DS/ClassificationProp/models/ClassifPropModel","DS/ClassificationProp/constants/ClassifPropConstants","DS/WidgetServices/WidgetServices","DS/ClassificationProp/models/ClassifPropAttributeModel","DS/ClassificationProp/constants/ClassifPropConstants","i18n!DS/ClassificationProp/assets/nls/langEditProp"],(function(e,t,i,n,s,a){"use strict";var r=a.get("accordion_parameters"),o=function(e,t,i){var s=[];if(t){t.forEach((function(t,a){var o=function(e,t,i){var s=new n,a=null;i&&t.extension&&(a=i[t.extension]),a=a||{};var o=1;s.set("multisel",e.isMergedModel()),s.set("name",t.name),s.set("label",t.name+" (NLS not defined)"),s.set("path",t.selectable),s.set("select",t.selectable),s.set("select",t.select),s.set("classUsage",i[t.extension].classUsage),s.set("type",t.type),t.speType&&s.set("type",t.speType),s.set("multiline",null!=t.multiline&&!1!==t.multiline);var l=null!=t.multivalue&&!1!==t.multivalue;s.set("multivalue",l);var c=t.value,u=t.valueDB;if(e.isMergedModel()||(c={r:c},u&&(u={r:u})),c)for(var d in c){var h=c[d],f=u?u[d]:f;!1===l?(h=null===h?"":h,f=null===f?"":f,Array.isArray(h)&&(h=h.length>0?h[0]:"",f&&(f=f.length>0?f[0]:"")),h=void 0===h?"":h):""!==h&&null!=h||(h=[],f=[]),c[d]=h,u&&(u[d]=f)}else if(e.isMergedModel()){var p=e.getMergingModels();for(var m in c={},u={},p){var g=p[m],v=!1===l?"":[];c[g.get("objectId")]=v,u[g.get("objectId")]=v}}if(e.isMergedModel()||(c=c.r,u&&(u=u.r)),t.range){let e=[];"string"==typeof t.range&&(t.range=t.range.split(",")),t.value&&(Array.isArray(t.value)?t.value.forEach((i=>{Array.isArray(i)?i.forEach((i=>{t.range.includes(i)||e.push(i)})):t.range.includes(i)||e.push(i)})):console.error("Attribure range not returned as expected format",t.value)),s.set("deprecatedAuthorizedValues",e),s.set("authorizedValues",t.range)}t.rangeNLS&&("string"==typeof t.rangeNLS&&(t.rangeNLS=t.rangeNLS.split(",")),s.set("authorizedValuesNLS",t.rangeNLS)),void 0!==t.range_required&&s.set("authorizedValuesRequired",!0===t.range_required),t.originalAuthVal&&s.set("originalAuthVal",t.originalAuthVal);var _=!0;if(t.readOnly||"owner"!==t.selectable||(_=!1),"No"!==t.readOnly&&!1!==t.readOnly||(_=!1),s.set("readOnly",_),s.set("value",c),u?s.set("valueDB",u):s.set("valueDB",c),s.set("mandatory","Yes"===t.mandatory||!0===t.mandatory),s.set("label",t.nls),s.set("path",t.path),t.dimensionType){e.isMergedModel(),t.unitName;let i=[t.dimension];s.set("displayAsEntered",t.displayAsEntered),s.set("dimension",i),s.set("unitName",t.unitName)}s.set("dimensionUnits",t.dimensionUnits),s.set("dimensionType",t.dimensionType),s.set("maxlength",t.maxlength),s.set("forbiddenChar",t.forbiddenChar),t.minval&&(s.set("minval",t.minval),t.minvalincluded&&s.set("minvalincluded",t.minvalincluded)),t.maxval&&(s.set("maxval",t.maxval),t.maxvalincluded&&s.set("maxvalincluded",t.maxvalincluded)),t.attrID&&(s.set("attributeID",t.attrID),s.set("facet",r),s.set("section",r)),t.facet?(s.set("facet",t.facet),s.set("section",t.facet)):a.name&&!0!==a.deploymentExtension&&(s.set("facet",a.name),s.set("section",a.nameNLS?a.nameNLS:a.name)),t.facetName&&s.set("section",t.facetName),t.extension&&s.set("extension",t.extension),void 0!==t.from&&s.set("from",t.from),t.relation&&s.set("relation",t.relation),t.rules&&s.set("rules",t.rules),t.applysort&&s.set("applySort",t.applysort);var C=t.UIPosition,S=(o=1,1);a.deploymentExtension&&!0!==t.maskedByType&&(o=2),C||0===C||(S=2,C=0,s.set("masked",!1));var b=o+"-"+S+"-"+C;return s.set("positionUI",b),t.group&&"Default"!==t.group&&(s.set("group",t.group),s.set("groupNLS",t.groupNLS),s.set("groupWeight",t.groupWeight)),t.forUI&&(s.set("forUIBL",t.forUI),t.blAccess&&s.set("blAccess",t.blAccess)),t.uxNotif&&s.set("notif",t.uxNotif),UWA.is(t.visible)&&s.set("visible",t.visible),t.basicAttribute&&s.set("basicAttribute",t.basicAttribute),s.set("keepformat",t.keepformat),s.set("displayAsEntered",t.displayAsEntered),s.saveInitialValues(),s}(e,t,i),l=o.get("positionUI");l+="-"+a,o.set("positionUI",l),s.push(o)}))}return s};return{getModelFromSelectedNode:function(n){var s,a=null;null!=(s=!(s=n&&"function"==typeof n.getInstID?n.getInstID():null)&&n&&"function"==typeof n.getRelationID?n.getRelationID():s)&&Array.isArray(s)&&(s=s.length>0?s[0]:null);var r=!!s,o=r?"relationship":"businessobject";if((s=(s=s||n.getID())||n.id)===n.plmType)return null;var l=!r&&n.metatype?n.metatype:o,c=n.source?n.source:null,u=n.tenant?n.tenant:null,d=!r&&n.type?n.type:null;if(null===d&&!r&&n.options&&n.options.type&&(d=n.options.type),s){var h={metatype:l,objectId:s};(u=u||i.getTenantID())&&(h.tenant=u),c&&(h.source=c),d&&(h.type=d,h[t.MODEL_DS_ATTR+"type"]=d),a=new e(h)}return a},getModelFromPath:function(i,n,s){var a=i.length,r=1==a||(s||a%2==0),o=r?a-1:a-2,l=i[o],c=n?n[l]:null,u="";n&&!r&&(c=n[u=i[o+1]]);var d={objectId:l,metatype:m=s||!r?"relationship":"businessobject"};if(c){var h=c.source?c.source:null,f=c.type?c.type:null,p=c.tenant?c.tenant:null,m=r&&c.metatype?c.metatype:m;p&&(d.tenant=p),h&&(d.source=h),f&&(d[t.MODEL_DS_ATTR+"type"]=f),m&&(d.metatype=m),u&&(d.selReferenceID=u)}return new e(d)},getPreviewUrl:function(e){var t=e.preview_url;return t||""},fillFromServer:function(e,t,a){var r={modifyAccess:!0,success:!1,allAttributeAreRO:!0,plmparams:!1};if(!1!==e.success){r.success=!0,r.modifyAccess=!1!==e.modifyAccess;var l=this.getPreviewUrl(e),c=e.type_icon_url||"",u=function(e){var t=e.type_icon_large_url;return t||""}(e);c===u&&(u="");var d=t.getChangedValues(),h={};l&&(h.previewUrl=l),u&&(h.type_icon_url=u),c&&(h.type_small_icon=c),e.thumbnailsRW&&(h.activeThumbnail=!0),r.allAttributeAreRO=function(e,t,n){var s=!0;n||(n={});var a=["owner","modified","branch.owner","branch.modified"];(i.getWidgetValue("index_mode")||"Federated"===t.source)&&(a=["ds6w:responsible","ds6w:modified"]);var r=n.type_small_icon;return o(e,t.data,t.extensions).forEach((function(t,i){s=s&&!0===t.get("readOnly"),"ds6w:type"===t.name&&t.set("urlIcon",r);var o=0,l=a.indexOf(t.name);t.get("positionUI")&&(o=t.get("positionUI")),!e.isMergedModel()&&l>=0&&(0===l||2===l?t.set("sectionIdentityCard","ownerName"):1===l||3===l?t.set("sectionIdentityCard","date"):t.set("positionIdentityCard",l)),t.set("positionUI",o),n[t.getIdentifier()]=t})),s}(t,e,h);var f=function(e){var t={},i=e.computed;if(i&&i.label){var n=i.label;if(n.value&&"object"==typeof n.value)for(var s in n.value){var a=n.value[s];n.value[s]=Array.isArray(a)&&a.length>0?a[0]:a}t.label=n.value,n.path&&(t.attributeId=n.path),!n.path&&n.name&&(t.attributeId=n.name)}return t}(e),p=f.label;p||(t.isMergedModel()?(p={},t.getMergedModelIds().forEach((function(e){p[e]=""}))):p=""),p&&(h.label=Array.isArray(p)?p[0]:p),f.attributeId&&h[f.attributeId]?(h.labelAttribute=f.attributeId,h[f.attributeId].set("sectionIdentityCard","title"),t.addEvent("onChange:"+f.attributeId,(function(){var e=t.get(f.attributeId);e&&t.set("label",e.valueDB)}))):h[s.MODEL_DS_ATTR+"label"]=new n({sectionIdentityCard:"title",value:p,valueDB:p,multisel:t.isMergedModel(),isTransient:!0,path:s.MODEL_DS_ATTR+"label"});var m={};for(var g in d)h[g]||(m[g]=d[g]);e.type&&(h.type?h.type.set("valueDB",e.type):h.type=e.type);var v=t.getAllAttributes();for(var g in v){var _=v[g];"object"==typeof _&&_ instanceof n&&!_.isTransient&&(a.initTable||_.attributeID)&&delete v[g]}if(t.set(h),t&&t.isMergedModel()){var C=t.getMergingModels();for(var S in C){var b=C[S];b.clearChangedValue();var E=UWA.clone(h);for(var g in h){var y=h[g];if(y instanceof n){var A=new n(E[g]);A.set("value",y.get("value")[S]),A.set("valueDB",y.get("valueDB")[S]),A.set("multisel",!1),A.saveInitialValues(),E[g]=A}}b.set(E),b.setChangedValues(m)}}t.clearChangedValue(),t.setChangedValues(m),function(e){!e.get("type")||"true"!==i.getWidgetValue("admin")||"CATProduct"!==e.get("type").value&&"CATPart"!==e.get("type").value||e.get("project")&&e.get("project").set("readOnly",!1)}(t),r.plmparams=!0===function(e){var t=e.PLMParametersAvailable;return t||!1}(e)}return r},getModelFromPathInIndexMode:function(e,i,n,s){let a="";e&&e.length>0&&(a=e[0]);let r="";i&&i.length>0&&(r=i[0]);let o=a;r&&(o=r);let l=n?n[o]:null,c={metatype:"businessobject"};if(s&&(s.source&&(c.source=s.source),s.sourceName&&(c.sourceName=s.sourceName),void 0!==s.indexModeParameter&&(c.indexModeParameter=s.indexModeParameter)),a&&(c.objectId=a),r&&(c.i3dx=r),l){let e=l.type?l.type:null;e&&(c[t.MODEL_DS_ATTR+"type"]=e,c.type=e)}return new EditPropModel(c)},getDimensions:function(){let e=this;return new Promise((function(t,n){e._dictionary=new Map;var s=i.getCancelObject(),a=ConstantsMapping.getServiceBySource("3dspace"),r=i.getLanguage(),o={tenant:i.getTenantID(),lang:r,handleRequest:{handle:s},defService:a,onComplete:function(n){n&&"object"==typeof n&&n.results&&n.results.length>0&&(n.results.forEach((function(t){e._dictionary.set(t.Name,t)})),i.setValue("DimensionsDictionary",e._dictionary),t(!0))},onFailure:function(e){var t="Exception in '/resources/dictionary/dimensions' ws";e&&e.error&&e.error.message&&(t+=` -> error Message = ${e.error.message}`),console.log(t),n(e)}};EditPropAjaxRequests.getListOfDimensions(o)}))},_getDictionary:function(){return this._dictionary&&this._dictionary.size>=0?this._dictionary:null},getDimensionUnitName:function(e,t){let i=this._getDictionary();if(null===i)return null;let n=e;e.startsWith("DSDim_")&&(n=e.substring(6,e.length)),n||(n=e);let s=i.get(n),a=[],r=[];return s&&s.Units&&Array.isArray(s.Units)&&t.map((e=>{e=e.trim(),a=s.Units.filter((t=>t.Name===e||t.label===e||t.NLSName===e)),a.length>0&&a[0].Name&&r.push(a[0].Name)})),r},getDimensionUnitNLSName:function(e,t){let i=this._getDictionary();if(null===i)return null;let n=e;e.startsWith("DSDim_")&&(n=e.substring(6,e.length)),n||(n=e);let s=i.get(n),a=[];return s&&s.Units&&Array.isArray(s.Units)&&t.map((e=>{e=e.trim();let t=s.Units.filter((t=>t.Name===e||t.label===e||t.NLSName===e));t.length>0&&t[0].NLSName&&a.push(t[0].NLSName)})),a},getUnits:function(e){let t=this._getDictionary();if(null===t)return null;let i=e;e.startsWith("DSDim_")&&(i=e.substring(6,e.length)),i||(i=e);let n=t.get(i),s=[];return n&&n.Units&&Array.isArray(n.Units)&&n.Units.forEach((e=>{let t="";e.label?t=`${e.NLSName} (${e.label})`:e.Name&&(t=`${e.NLSName} (${e.Name})`),s.push(t)})),s}}})),define("DS/ClassificationProp/ajaxRequests/ServicesAjaxRequests",["DS/WidgetServices/WidgetServices","DS/ClassificationProp/utils/ClassifSecurityContextServices","DS/ClassificationProp/ajaxRequests/MultipleAsynchronousRequests","DS/WAFData/WAFData","i18n!DS/ClassificationProp/assets/nls/langEditProp"],(function(e,t,i,n,s){"use strict";return{createRequest:function(e,t,i,n){var s=this;e&&!1===e.withChange?s._createRequestWithAuthoringContext(e,t,i,n):require(["DS/ClassificationProp/changeAction/passThruJS"],(function(a){a.onReady((function(a){s._createRequestWithAuthoringContext(e,t,i,n,a)}))}))},_createRequestWithAuthoringContext:function(s,a,r,o,l){var c=this;if(s.handleRequest){if(s.handleRequest.handle&&"function"==typeof s.handleRequest.handle.isCancelled&&s.handleRequest.handle.isCancelled())return}else s.handleRequest={};var u=["A"];e.isChangeAvailable()&&l&&u.push("B"),!0===s.withSC&&u.push("C");var d=new i(u,(function(){var t=this.getAnswer("A"),i=this.getAnswer("B"),l=this.getAnswer("C");l=l||s.securityContext;var u=t+r,d={Accept:"application/json","content-type":"application/json"};if(d["Accept-Language"]=e.getLanguage(),i){var h="silent"===s.withChange&&"object"==typeof o;for(var f in i)h?void 0===o[f]&&(o[f]=i[f]):d[f]=i[f]}l&&(d.SecurityContext=encodeURIComponent(l));var p=s.contentType?s.contentType:"json";if(s.headers)for(var f in s.headers)d[f]=s.headers[f];var m={type:p,method:a,timeout:36e5,proxy:"passport",headers:d,cache:-1,onComplete:function(e){"POST"===a&&r.includes("attributes/update")?s.onCompleteWS(o,s,e):s.onCompleteWS(e,s)},onFailure:function(e,t,i){c._onFailure(e,t,i,s)},onTimeout:function(e){c._onTimeout(s)}};e.getWidgetValue("isStandalone")||(m.authentication="passport"),o&&(m.data="json"!==p?o:UWA.Json.encode(o)),s.handleRequest.handle=n.handleRequest(c._formatUrl(s.model,u),m)}));s.handleRequest.handle=e.getSourceUrlAsync({platformId:this.getTenantFromModel(s.model),source:s.source?s.source:this.getSourceFromModel(s.model),onComplete:function(e){d.setAnswer("A",e)}}),!0===s.withSC&&t.getInstance({tenant:this.getTenantFromModel(s.model)}).getSecurityContext({onSuccess:function(e){d.setAnswer("C",e.SecurityContext)},onFailure:function(e){console.log(" -- >> Can't get the security context"),d.setAnswer("C",null)}}),e.isChangeAvailable()&&l&&l.get2((function(e){var t=null;l.changeIsSetChecker(e)&&(t=e.AuthoringContextHeader),e.errorMessage&&console.log("Change : "+e.errorMessage),d.setAnswer("B",t)}))},getTenantFromModel:function(t){var i=t?t.get("tenant"):null;return i=i||e.getTenantID()},getSourceFromModel:function(e){return e?e.get("source"):null},_formatUrl:function(e,t){var i=this.getTenantFromModel(e);return this._formatUrl2(i,t)},_formatUrl2:function(e,t){if(e){var i=t.indexOf("?");i<0&&(t+="?"),i>0&&i<t.length-1&&(t+="&"),t=t+="tenant="+e}return t},getExtraValues:function(e,t){var i={},n=[];return e.forEach((function(e){i[e]=!0})),t.forEach((function(e){i[e]||n.push(e)})),n},_createJSONModifiedAttribute:function(e){var t,i=[],n=["physicalid","modified"],s={},a=new Map,r=new Map,o=e.getChangedValues(),l={};for(var c in o){var u=e.get(c),d=u.facet;if(t=u.classUsage,"object"==typeof u&&!u.isTransient){var h=u.attributeID;if(null!=h&&h.length>0)this._addPLMParameterQuery(u,i);else{var f=u.getChangedIds();for(var p in f){var m=f[p];if("a"===p&&(p=e.get("objectId")),!a.has(d)){var g=[];g=[].concat(n),a.set(d,new Array)}if(g.push(u.select),a.set(d,g),"Definition"==t){var v=l[d];v||(v=[],l[d]=v)}else{var _=l[d];_||(_=[],l[d]=_)}var C=m.valueDB;!1!==C&&null==C&&(C=m.value);var S=null;Array.isArray(C)||"string"==typeof C||(S=C.toString()),null===S&&(S=C);var b=null;b={op:"replace",path:u.path,value:S},d&&(b.facet=d);var E=u.get("unitName");E&&(b.unitName=E,b.dimensionType=u.get("dimensionType")),b&&"Definition"==t&&(v.push(b),r.has("Definition")||r.set("Definition",new Map),r.get("Definition").set(d,v)),b&&"Standard"==t&&(_.push(b),r.has("Standard")||r.set("Standard",new Map),r.get("Standard").set(d,_)),b&&null==t&&"IP Export Control"==e.component&&(_.push(b),r.set("IPX",new Map),r.get("IPX").set(d,_))}}}}var y=e.get("metatype"),A="model/";A+="businessobject"==y||"bus"==y?"bus/":"EBOM"==y?"EBOM/":"rel/";var I=[];if(r){var T=r.get("Definition"),w=r.get("Standard"),P=r.get("IPX");T&&D(T,"Definition"),w&&D(w,"Standard"),P&&D(P," ")}function D(t,i){t&&t.forEach((function(t,n){let r=n;var o=e.get("objectId"),l={path:A+o,method:"POST",body:t,classUsage:i,classId:r},c=a.get(n);c&&(s={select:[...c]},l.queryParams=s),I.push(l)}))}return{requests:I,plmParametersRequests:i}},_addPLMParameterQuery:function(e,t){var i=e.valueDB;!1===i||i||(i=e.value);var n=[],s=[],a={},r=null;if(Array.isArray(i)||"string"==typeof i||(r=i.toString()),null===r&&(r=i),n.push(e.name),s.push({op:"replace",path:e.path,value:r}),null!=n){var o={select:n};a.queryParams=o}a.body=s;var l="plmparameter/"+e.attributeID;a.path="model/"+l;a.method="PATCH",t.push(a)},_concatRequestListComposite:function(e,t){t.forEach((function(t,i){var n=!1;e.every((function(i,s){return t.path!=i.path||t.method!=i.method||(e[s].body=e[s].body.concat(t.body),e[s].queryParams.select=e[s].queryParams.select.concat(t.queryParams.select),n=!0,!1)})),!1===n&&e.push(t)}))},securityContextDispatcher:function(e,i){var n=this;if(e.securityContext)i.call(this,e);else{var s=t.getInstance({tenant:e.tenant}).getSecurityContext({context:e.context,onSuccess:function(t){e.securityContext=t.SecurityContext,i.call(n,e)},onFailure:function(t){n._onFailure(null,{error:t},null,e)}});e.handleRequest&&s&&(e.handleRequest.handle=s);//!!handle IR-635449-3DEXPERIENCER2018x                
}},_onCompleteAttributes:function(e,t){t.onComplete.call(null,e)},_onCompleteCommit:function(e,t,i){t.onComplete.call(null,e,t,i)},_onFailure:function(e,t,i,n){var a={};if(null!=t&&t.hasOwnProperty("error")&&"EDITPROP_ERROR_0001"===t.error)a={message:s.get("UpdateFailedDueToFrozenModelConnected"),code:"ERROR"},this._raiseError(a,n);else if(null!=t&&t.hasOwnProperty("error")&&"ErrorCode:1500572"===t.error)UWA.i18n("InvalidCSCreationfailed"),UWA.i18n("InvalidCSCreationFailedSubtitle"),UWA.i18n("NoAccessToCS");else if(null!=t&&t.hasOwnProperty("error")&&"INF102"===t.error.code)UWA.i18n("NoaccesstoApptitle"),UWA.i18n("NoaccesstoAppDesc");else a=null!=t&&t.hasOwnProperty("error")?t.error:{message:s.get("Error Server"),code:"ERROR"},this._raiseError(a,n)},_raiseError:function(e,t){"object"!=typeof e&&(e={message:e}),t.onComplete.call(null,{success:!1,error:e})},_onTimeout:function(e){var t={message:s.get("ErrorTimeOut"),code:"TO"};this._raiseError(t,e)}}})),define("DS/ClassificationProp/helpers/Helpers",["DS/WidgetServices/MultipleAsynchronousRequests","DS/WidgetServicesUI/helpers/Constants","DS/WidgetServicesUI/tweakers/TweakerPerson","DS/WidgetServicesUI/tweakers/TweakerString","DS/WidgetServicesUI/tweakers/TweakerNumber","DS/WidgetServicesUI/tweakers/TweakerDate","DS/WidgetServicesUI/tweakers/TweakerBoolean","DS/WidgetServicesUI/tweakers/TweakerOutput","DS/ClassificationProp/helpers/TweakerNumberWebUX","DS/WidgetServicesUI/tweakers/TweakerStringWebUX","DS/WidgetServicesUI/tweakers/TweakerDateWebUX","DS/WidgetServicesUI/tweakers/TweakerBooleanWebUX","DS/WidgetServicesUI/tweakers/TweakerPersonWebUX","DS/WidgetServicesUI/tweakers/TweakerEnumWebUX","DS/WidgetServicesUI/tweakers/TweakerMVAWebUX","DS/WidgetServicesUI/tweakers/TweakerUnitWebUX"],(function(e,t,i,n,s,a,r,o,l,c,u,d,h,f,p,m){var g={},v={};v[t.TYPES.BOOLEAN]={req:"DS/WidgetServicesUI/tweakers/TweakerBoolean"},v[t.TYPES.STRING]={req:"DS/WidgetServicesUI/tweakers/TweakerString"},v[t.TYPES.NUMBER]={req:"DS/WidgetServicesUI/tweakers/TweakerNumber"},v[t.TYPES.INTEGER]={req:"DS/WidgetServicesUI/tweakers/TweakerNumber"},v[t.TYPES.ENUM]={req:"DS/WidgetServicesUI/tweakers/TweakerEnum"},v[t.TYPES.PERSON]={req:"DS/WidgetServicesUI/tweakers/TweakerPerson"},v[t.TYPES.DATE]={req:"DS/WidgetServicesUI/tweakers/TweakerDate"},v[t.TYPES.DATETIME]={req:"DS/WidgetServicesUI/tweakers/TweakerDate"},v[t.TYPES.HTML]={req:"DS/WidgetServicesUI/tweakers/TweakerHTML"},v[t.TYPES.OUTPUT]={req:"DS/WidgetServicesUI/tweakers/TweakerOutput"},v[t.TYPES.BUTTONWEB]={req:"DS/WidgetServicesUI/tweakers/TweakerButtonWeb"},v[t.TYPES.DROPDOWN]={req:"DS/WidgetServicesUI/tweakers/TweakerDropdown"},v[t.TYPES.REPLACEMENT]={req:"DS/WidgetServicesUI/tweakers/TweakerReplacement"},v[t.SPE_TYPES.MVA]={req:"DS/WidgetServicesUI/tweakers/TweakerMVA"},v[t.TYPES.IMAGE]={req:"DS/WidgetServicesUI/tweakers/TweakerImage"},v[t.TYPES.MULTIPLE]={req:"DS/WidgetServicesUI/tweakers/TweakerMultiple"},v[t.TYPES.RELATION]={req:"DS/WidgetServicesUI/tweakers/TweakerRelation"},v[t.TYPES.BOOLEAN_WUX]={req:"DS/WidgetServicesUI/tweakers/TweakerBooleanWebUX"},v[t.TYPES.NUMBER_WUX]={req:"DS/WidgetServicesUI/tweakers/TweakerNumberWebUX"},v[t.TYPES.INTEGER_WUX]={req:"DS/WidgetServicesUI/tweakers/TweakerNumberWebUX"},v[t.TYPES.STRING_WUX]={req:"DS/WidgetServicesUI/tweakers/TweakerStringWebUX"},v[t.TYPES.DATE_WUX]={req:"DS/WidgetServicesUI/tweakers/TweakerDateWebUX"},v[t.TYPES.DATETIME_WUX]={req:"DS/WidgetServicesUI/tweakers/TweakerDateWebUX"},v[t.TYPES.PERSON_WUX]={req:"DS/WidgetServicesUI/tweakers/TweakerPersonWebUX"},v[t.TYPES.ENUM_WUX]={req:"DS/WidgetServicesUI/tweakers/TweakerEnumWebUX"},v[t.SPE_TYPES.MVA_WUX]={req:"DS/WidgetServicesUI/tweakers/TweakerMVAWebUX"},v[t.TYPES.MULTIPLE_WUX]={req:"DS/WidgetServicesUI/tweakers/TweakerMultipleWebUX"},v[t.TYPES.REPLACEMENT_WUX]={req:"DS/WidgetServicesUI/tweakers/TweakerReplacementWebUX"},v[t.TYPES.DUMMY_BOOKMARK]={req:"DS/WidgetServicesUI/tweakers/TweakerDummyBookmark"},v[t.TYPES.UNIT]={req:"DS/WidgetServicesUI/tweakers/TweakerUnitWebUX"},v[t.TYPES.USAGE_DIM]={req:"DS/SpecRawMaterial/tweakers/UsageDimensionTweaker"},v[t.TYPES.REFERENCEQTY]={req:"DS/CreateSpecification/tweakers/ReferenceBatchQtyTweaker"};var _=function(e,t,i){g[e]={element:i,requireStr:t}},C=function(e,t,i){var n=g[e];if(n&&n.requireStr===t)i.call(null,n.element);else require([t],(function(n){_(e,t,n),i.call(null,n)}))};return _(t.TYPES.STRING,v[t.TYPES.STRING].req,n),_(t.TYPES.PERSON,v[t.TYPES.PERSON].req,i),_(t.TYPES.NUMBER,v[t.TYPES.NUMBER].req,s),_(t.TYPES.INTEGER,v[t.TYPES.INTEGER].req,s),_(t.TYPES.DATETIME,v[t.TYPES.DATETIME].req,a),_(t.TYPES.DATE,v[t.TYPES.DATE].req,a),_(t.TYPES.OUTPUT,v[t.TYPES.OUTPUT].req,o),_(t.TYPES.STRING_WUX,v[t.TYPES.STRING_WUX].req,c),_(t.TYPES.NUMBER_WUX,v[t.TYPES.NUMBER_WUX].req,l),_(t.TYPES.INTEGER_WUX,v[t.TYPES.INTEGER_WUX].req,l),_(t.TYPES.DATETIME_WUX,v[t.TYPES.DATETIME_WUX].req,u),_(t.TYPES.DATE_WUX,v[t.TYPES.DATE_WUX].req,u),_(t.TYPES.PERSON_WUX,v[t.TYPES.PERSON_WUX].req,h),_(t.TYPES.UNIT,v[t.TYPES.UNIT].req,m),{getTweaker:function(i,n,s){var a,r=this,o=!0===n.multivalued,l=i!==t.TYPES.ENUM&&i!==t.TYPES.ENUM_WUX&&n.data&&void 0!==n.data.list,c=l&&n.data&&!1!==n.data.range_required,u=!0===n.multisel,d=["A"];o&&d.push("B"),l&&d.push("C"),u&&d.push("D");var h=new e(d,(function(){var e=this.getAnswer("A"),a=this.getAnswer("B"),o=this.getAnswer("C"),l=this.getAnswer("D");a&&(o||i===t.TYPES.ENUM)&&(n.data=n.data?n.data:{},n.data.placeholder=!n.data.placeholder||n.data.placeholder);var c=UWA.clone(n);c.tw_type=i,a||l?(c.value=null,c.nested=null!=a||null!=l,c.events={}):o||(c.value=n.value);var u=new e(c);if(o){var d=null!=a||null!=l,h=a?UWA.clone(c):UWA.clone(n);h.tweaker=u,h.nested=null!=a||null!=l,h.value=d?null:n.value,u=new o(h)}if(a){d=null!=l;var f=UWA.clone(n);f.tweaker=u,f.nested=null!=l,f.value=d?[]:n.value,f.events=d?{}:f.events,u=new a(f)}if(l){var p=UWA.clone(n);p.tweaker=u,p.value=n.value,u=new l(p)}s.call(r,u)}));if(o&&!r.isTwTypeIsWUX(i)?C(t.SPE_TYPES.MVA,"DS/WidgetServicesUI/tweakers/TweakerMVA",(function(e){h.setAnswer("B",e)})):o&&r.isTwTypeIsWUX(i)&&C(t.SPE_TYPES.MVA_WUX,v[t.SPE_TYPES.MVA_WUX].req,(function(e){h.setAnswer("B",e)})),l&&!r.isTwTypeIsWUX(i)){var f=c?t.TYPES.ENUM:t.TYPES.DROPDOWN;C(t.SPE_TYPES.ENUM,v[f].req,(function(e){h.setAnswer("C",e)}))}else if(l&&r.isTwTypeIsWUX(i)){f=c?t.TYPES.ENUM_WUX:t.TYPES.DROPDOWN;C(t.SPE_TYPES.ENUM,v[f].req,(function(e){h.setAnswer("C",e)}))}u&&!r.isTwTypeIsWUX(i)?C(t.TYPES.MULTIPLE,v[t.TYPES.MULTIPLE].req,(function(e){h.setAnswer("D",e)})):u&&r.isTwTypeIsWUX(i)&&C(t.TYPES.MULTIPLE_WUX,v[t.TYPES.MULTIPLE_WUX].req,(function(e){h.setAnswer("D",e)}));var p=v[i];p||(p=!0===n.readOnly?v[t.TYPES.OUTPUT]:v[t.TYPES.STRING]),a=p.req;var m=!1;try{window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.isDebug:window.top.isDebug,m=!0}catch(e){}m&&!0===(window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.isDebug:window.top.isDebug)&&console.log("Load Tweaker "+i+" : "+(window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.now():window.top.performance.now())),C(i,a,(function(e){m&&!0===(window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.isDebug:window.top.isDebug)&&console.log("Tweaker Loaded "+i+" : "+(window.dsDashboardWindow&&window.dsDashboardWindow.top?window.dsDashboardWindow.top.performance.now():window.top.performance.now())),h.setAnswer("A",e)}))},getAdvTweaker:function(e,i,n){var s=this,a=null;switch(i.touchMode=!0,e){case t.TYPES.BOOLEAN:a="DS/Tweakers/TweakerBoolean";break;case t.TYPES.NUMBER:a="DS/Tweakers/TweakerNumber";break;default:a=null}null!==a?C(e,a,(function(e){var t=new e(i);if(i.events)for(var a in i.events)t.addEventListener(a,i.events[a]);n.call(s,t)})):this.getTweaker(e,i.value,i,n)},isTwTypeIsWUX:function(e){return e===t.TYPES.BOOLEAN_WUX||e===t.TYPES.STRING_WUX||e===t.TYPES.NUMBER_WUX||e===t.TYPES.INTEGER_WUX||e===t.TYPES.DATE_WUX||e===t.TYPES.DATETIME_WUX||e===t.TYPES.PERSON_WUX||e===t.TYPES.ENUM_WUX||e===t.TYPES.UNIT}}})),define("DS/ClassificationProp/facets/Properties/TweakerManager",["UWA/Core","UWA/Class","DS/ClassificationProp/helpers/Helpers","DS/IPClassifyUXUtil/IPClassifyConfirmation","DS/WidgetServicesUI/helpers/Constants","DS/ClassificationProp/models/ClassifPropAttributeModel","DS/WidgetServices/WidgetServices","DS/ClassificationProp/utils/AttributesUtils","DS/WebappsUtils/WebappsUtils","DS/ClassificationProp/comm/EventManager","DS/ClassificationProp/utils/ClassifPropControl","DS/ClassificationProp/models/ClassifPropModel","i18n!DS/ClassificationProp/assets/nls/langEditProp"],(function(e,t,i,n,s,a,r,o,l,c,u,d,h){var f="DEFAULT",p={};p[f]={type:f,from:function(e){return e.valueDB},to:function(e){return{valueDB:e.value,value:e.displayValue?e.displayValue:e.value}},extraOptions:function(e,t){var i=t.authorizedValuesNLS,n=t.authorizedValues,s=t.authorizedValuesGroup,a=t.authorizedValuesIcon,r=t.customSelect,o=t.sortedOptions,c=!0===t.autocomplete,u=i.length;if(u>0){var d=!0,h=t.get("tw_type"),m=p[h];m&&m.from||(m=p[f]);for(var g=[],v=[],_=0;_<u;_++){var C=i[_],S=n[_],b={label:C,value:S,group:s?s[_]:null};if(a&&a[_]){var E="icons/16/"+a[_]+".png",y=l.getWebappsAssetUrl("ENOCollabSharingCmds",E);b.icon=y}v.push(b),d||i[_]!==n[_]?d=!0:(S=m.from({value:C,valueDB:S}),C=null,g.push({label:C,value:S}))}return t.deprecatedAuthorizedValues&&t.deprecatedAuthorizedValues.length>0&&t.deprecatedAuthorizedValues.forEach((e=>{v.push({label:e+"    (Deprecated)",value:e,icon:"attention wux-ui-3ds warningIconColor"})})),{autocomplete:c,sortedOptions:o,customSelect:r,trueEnum:d,data:{list:d?v:g,range_required:t.authorizedValuesRequired}}}}},p[s.TYPES.BOOLEAN]={type:s.TYPES.BOOLEAN,from:function(e){return!0===e.valueDB||"string"==typeof e.valueDB&&"true"===e.valueDB.toLowerCase()}},p[s.TYPES.RELATION]={type:s.TYPES.RELATION,from:function(e){return{id:e.valueDB,label:e.value&&e.value.label?e.value.label:""}},to:function(e){return{valueDB:e.value?e.value.id:"",value:e.value?e.value:""}},extraOptions:function(e,t){return{data:{rules:t.get("rules")}}}},p[s.TYPES.PERSON]={type:s.TYPES.PERSON,from:function(e){return{personID:e.valueDB,fullName:e.value}},to:function(e){return{valueDB:e.value.personID,value:e.value.fullName}},extraOptions:function(e){return{data:{objectIDs:e.isMergedModel()?e.getMergedModelIds():[e.get("objectId")]}}},check:function(e,t){if(null===t)return{message:h.UnvalidAttribute,type:"error"}}},p[s.TYPES.DATE]={type:s.TYPES.DATE,from:function(e){return r.formatDateObj(e.valueDB)},to:function(e){e.value=new Date(e.value);var t=r.convertDateToStandard(e.value,!0);return""==e.displayValue&&(t.valueDB=""),{valueDB:t.valueDB,value:e.displayValue}}},p[s.TYPES.DATETIME]=p[s.TYPES.DATE],p[s.TYPES.BOOLEAN_WUX]=p[s.TYPES.BOOLEAN],p[s.TYPES.DATE_WUX]=p[s.TYPES.DATE],p[s.TYPES.DATETIME_WUX]=p[s.TYPES.DATE],p[s.TYPES.PERSON_WUX]=p[s.TYPES.PERSON],p[s.TYPES.UNIT]={type:s.TYPES.UNIT,from:function(e){return{valueDB:e.valueDB,dimension:e.dimension}},to:function(e){return{valueDB:e.value.valueDB,value:e.displayValue?e.displayValue:e.value.valueDB,dimension:e.value.dimension}}};var m=function(e){var t=p[e.get("tw_type")],i=null;if(t&&t.check){var n=e.get("valueDB");e.multisel&&(n=n[Object.keys(n)[0]]),Array.isArray(n)||(n=[n]),n.every((function(n){return null===(i=t.check(e,n))}))}return i},g=t.extend({_sharedOptions:null,init:function(e,t){this._parent(e),this.elements={},this.elements.fields={},this.updateAttributeData={isInProgress:!1,isUpdateFailure:!1,oldValue:"",hasErrors:!1},this._sharedOptions=t,this.onNotification=e.onNotification?e.onNotification:function(){},this.options=this.options?this.options:{},this._setEditable(e&&!0===e.editable)},isReadOnly:function(){var e=this._sharedOptions;return!e||!0===e.readOnly},clear:function(){for(var e in this.elements.fields)this._removeField(e);this.elements.fields={}},actionOnScroll:function(){for(var e in this.elements.fields){var t=this.elements.fields[e];t.field&&"function"==typeof t.field.actionOnScroll&&t.field.actionOnScroll()}},getValidationFunction:function(e){var t=p[e];if(t&&t.check)return m},_getValueForTweaker:function(e,t){var i=e,n=p[i];n&&n.from||(n=p[i=f]);return t.multisel?this.__getValueFromMultiselForConvert(n,t):this.__getValueFromStandardForConvert(n,t)},__getValueFromStandardForConvert:function(e,t){var i=!0===t.multivalue,n=e.type,s=t.value,a=Array.isArray(s)?s:[s],r=s,o=a;n===f&&t.readOnly||(r=t.valueDB,o=Array.isArray(r)?r:[r]);let l=null;t.dimension&&1!=i&&(l=t.dimension,l=Array.isArray(l)?l:[l]);for(var c=Array.isArray(s)&&Array.isArray(a[0])&&void 0!==a[0]?a[0].length:a.length,u=[],d=0;d<c;d++){var h=null;h=l&&l.length>0?e.from({value:a[d],valueDB:o[d],dimension:l[d]}):e.from({value:Array.isArray(s)&&void 0!==a[0]&&Array.isArray(a[0])?a[0][d]:a[d],valueDB:Array.isArray(s)&&void 0!==a[0]&&Array.isArray(a[0])?o[0][d]:o[d]}),u.push(h)}return i?u:c>0?u[0]:null},__getValueFromMultiselForConvert:function(e,t){var i=t.value,n=t.valueDB;let s=t.dimension;var a={};for(var r in i){var o={value:i[r],valueDB:n[r],multivalue:t.multivalue,readOnly:t.readOnly};if(s){let e=s[r]?s[r]:s;o.dimension=e}var l=this.__getValueFromStandardForConvert(e,o);a[r]=l}return a},__getValueFromStandardFromTweaker:function(e,t){var i=t.value,n=t.displayValue,s={},a={},r=void 0;if(Array.isArray(i)){r=[];s=[],a=[];for(var o=i.length,l=0;l<o;l++){var c=e.to({value:i[l],displayValue:n[l]});s.push(c.value),a.push(c.valueDB),c.dimension&&r.push(c.dimension)}}else{s=(c=e.to({value:i,displayValue:n})).value,a=c.valueDB,c.dimension&&(r=c.dimension,Array.isArray(r)||(r=[r]))}return{value:s,valueDB:a,dimension:r}},__getValueFromMultiselFromTweaker:function(e,t,i){var n=t.value,s=t.displayValue;valueAttr={},valueDBAttr={};let a={};for(var r in n){i&&i.multivalue&&(n[r]=Array.isArray(n[r])?n[r]:[n[r]],s[r]=Array.isArray(s[r])?s[r]:[s[r]]);var o=this.__getValueFromStandardFromTweaker(e,{value:n[r],displayValue:s[r]});valueAttr[r]=o.value,valueDBAttr[r]=o.valueDB,void 0!==o.dimension&&null!==o.dimension&&(a[r]=o.dimension)}let l={value:valueAttr,valueDB:valueDBAttr};return Object.keys(a).length>0&&(l.dimension=a),l},_getValueFromTweaker:function(e,t,i){var n=p[e];n&&n.to||(n=p[f]);i.multivalue;var s={value:t.getValue(),displayValue:t.getDisplayValues()};return!0===i.multisel?this.__getValueFromMultiselFromTweaker(n,s,i):this.__getValueFromStandardFromTweaker(n,s)},_generateOptions:function(e,t,i){var n={units:i.dimension,minValue:i.minval,maxValue:i.maxval,minValueIncluded:i.minvalincluded,maxValueIncluded:i.maxvalincluded,multiline:i.multiline,multisel:i.multisel,icon:i.urlIcon,parameter:!!i.attributeID,multivalued:i.multivalue,mandatory:i.mandatory,readOnly:i.readOnly,applySort:i.applySort,type:i.type,placeholder:i.placeholder,disable:i.disable,keepformat:i.keepformat,displayAsEntered:i.displayAsEntered};this.isReadOnly()&&(n.editable=!1),"prop"===t.facet&&(n.prop=!0);var s=p[e];if(s&&s.extraOptions||(s=p[f]),s&&s.extraOptions){var a=s.extraOptions(t,i);for(var r in a)n[r]=a[r]}i.dropdownMode&&(n.dropdownMode=i.dropdownMode),i.dimensionType&&(n.dimensionType=i.dimensionType),n.hasDimension=!(!t.propertiesWidgetUI&&!t.newInfraUI||!i.dimensionType||!i.authorizedValues||0!==i.authorizedValues.length),n.newInfraUI=!!t.newInfraUI;let o=t.get("_sourceId");return o||(o=t.get("source")),o||(o=t.get("sourceName")),n.source=o,t.newInfraUI&&(n.newInfraUI=!!t.newInfraUI),n},_updateValue:function(e,t,i,n,s){if(e.isMergedModel()){var a=e.getMergingModels();for(var r in e.lockModel(!0),a)innerModel=a[r],this.__updateValue(innerModel,innerModel.get(t.getIdentifier()),i[r],n[r],s);setTimeout((function(){e.lockModel(!1)}))}else this.__updateValue(e,t,i,n,s)},__updateValue:function(e,t,i,n,s){var a=e.getChangedValues(),r=t.getIdentifier(),o=(t.value,t.valueDB),l=t.dimension,c=a[r];if(c)c.value,o=c.valueDB;var u=!1,d="",h="",f="",p="";if(d=null==n||null==n?"":Array.isArray(n)?n.sort().toString():n,h=null==o||null==o?"":Array.isArray(o)?o.sort().toString():o,null==s)f="";else if(Array.isArray(s)&&s.length>0){f=[...s].sort().toString()}else f=s;if(null==l)p="";else if(Array.isArray(l)&&l.length>0){p=[...l].sort().toString()}else p=l;if(u=d===h,null!=s&&null!=s&&(u=u&&p===f),!u&&e.isMergedModel()){u=!0;var m=e.getMergingModels();for(var g in m)u=u&&m[g]===o[g]}u||this._modelChangeValue(e,e.get(r),i,n,s)},_modelChangeValue:function(t,i,n,s,r){var o=new a(e.clone(i));if(o.set("oldValue",o.value),o.set("oldValueDB",o.valueDB),o.set("value",n),o.set("valueDB",s),null!=r&&null!=r&&Array.isArray(r)&&r.length>0&&(o.set("oldDimension",o.dimension),o.set("dimension",r)),r&&i.get("dimensionUnits")&&i.get("dimensionUnits").Units&&i.displayAsEntered){let e=i.get("dimensionUnits").Units.find((e=>e.label===r[0]));e&&e.Name?o.set("unitName",e.Name):this.updateAttributeData.hasErrors=!0}return t.set(i.getIdentifier(),o),t.changedValues&&!t.changedValues[i.getIdentifier()]&&(t.changedValues[i.getIdentifier()]=o),o.set("classUsage",i.classUsage),o},_getOrCreateField:function(e,t){var i=this.elements.fields[e];return i||t||(i=this.elements.fields[e]={}),i},_addEventToField:function(e,t,i){var n=this._getOrCreateField(t);n.events||(n.events=[]),n.events.push(i),n.model=e},_addTweakerToField:function(e,t){this._getOrCreateField(e).field=t},_removeField:function(e){var t=this.elements.fields[e];t.field&&("function"==typeof t.destroy?t.destroy():"function"==typeof t.field.destroy&&t.field.destroy()),t.events&&t.model&&t.events.forEach((function(i){t.model.removeEvent(e,i)})),delete this.elements.fields[e]},setError:function(e){},onNotification:function(e){},_manageOnChangeEvent:function(e,t,i,n){var s=function(){setTimeout((function(){i.elements.container?n.call():e.removeEvent(t,s)}))};this._addEventToField(e,t,s),e.addEvent("onChange:"+t,s)},_setEditable:function(e){this.editable=e&&!this.isReadOnly()},underEdition:function(){return this.editable&&!this.isReadOnly()},switchMode:function(e){for(var t in this._setEditable(e),this.elements.fields){var i=this.elements.fields[t];i&&i.field&&i.field.switchMode(this.underEdition())}},getTweakerFromId:function(e){return this.elements.fields[e]},getTweaker:function(e,t,a,r,o){var l,f=this,p=e.get(t),m=this._generateOptions(a,e,p),g=0;(l=u.getInformationPanel())&&(g=1e3),(e.webUxTweakers||e.propertiesWidgetUI)&&!0===m.trueEnum?a=s.TYPES.ENUM_WUX:e.propertiesWidgetUI||e.webUxTweakers||!0!==m.trueEnum||(a=s.TYPES.ENUM);var v=this._getValueForTweaker(a,p);if(p.displayAsEntered,m.value=v,m.events={changes:f.debounce((function(){if(f.updateAttributeData.isInProgress)f.updateAttributeData.isInProgress=!1;else{f.updateAttributeData.hasErrors=!1;var i=e.get(t);if(i){var s=f._getValueFromTweaker(a,this,i);l&&e&&e.clearChangedValue();var r=s.value;if("boolean"==i.type&&i.multivalue){let _=[];s.valueDB.forEach((e=>{_.push(e.toString())})),s.valueDB=_}if(Date.parse(s.value)&&"function"==typeof r.getMonth){var o=r.getUTCFullYear()+"/"+(parseInt(format(r.getUTCMonth()))+1)+"/"+format(r.getUTCDate())+"@"+format(r.getUTCHours())+":"+format(r.getUTCMinutes())+":"+format(r.getUTCSeconds())+":GMT";s.value=o}if(f._updateValue(e,i,s.value,s.valueDB,s.dimension),i.deprecatedAuthorizedValues&&i.deprecatedAuthorizedValues.length>0){!0;var p=!1;if(Array.isArray(s.value))for(let C=0;C<s.value.length;C++)if(i.deprecatedAuthorizedValues.includes(s.value[C])){p=!0;break}if(p)v();else{var m={titleLabel:h.replace(h.deprecatedValueUpdate.title,{attrName:i.label}),moreInfo:h.deprecatedValueUpdate.moreInfo,deleteButtonLabel:h.deprecatedValueUpdate.buttonLabel,warningMessage:h.deprecatedValueUpdate.warningMessage,buttonColor:"blue"};n.confirmDialog(m,g,v,this)}}else g();function g(){if(f._updateValue(e,i,s.value,s.valueDB,s.dimension),!0===l&&1!=f.updateAttributeData.hasErrors){var t=new d({objectId:u.getObjectId()});c.publish("onInformationAttributeUpdate",{model:e,selection:t,dataprovider:u.getProvider(),informationPanelContext:u.getContext(),ObjectId:u.getObjectId()})}}function v(){for(var t in e.changedValues)e.changedValues[t].isResetOnAttributeUpdateFailure=!0,e.changedValues[t].value=e.changedValues[t].oldValue,e.changedValues[t].valueDB=e.changedValues[t].oldValueDB,c.publish("onAttributeUpdate",e.changedValues[t],e,!0)}}f.updateAttributeData.isInProgress=!1}}),g,!1),notification:function(e){f.onNotification(e)}},r)for(var _ in r)m[_]=r[_];i.getTweaker(a,m,(function(i){f._addTweakerToField(t,i),f._manageOnChangeEvent(e,t,i,(function(){var n=e.get(t),s=f._getValueForTweaker(a,n);i.setValue(s),f._sharedOptions.editMode&&c.publish("onAttributeUpdate",n)})),i.switchMode(f.underEdition()),o.call(this,i)}))},_debounceTimeouts:[],debounce:function(e,t,i){var n,s=this;return function(){var a=this,r=arguments,o=i&&!n;clearTimeout(n);var l=s._debounceTimeouts.indexOf(n);-1!==l&&s._debounceTimeouts.splice(l,1),n=setTimeout((function(){n=null,i||e.apply(a,r)}),t),s._debounceTimeouts.push(n),o&&e.apply(a,r)}}});return g})),define("DS/ClassificationProp/ajaxRequests/FederatedAjaxRequests",["DS/IPClassifyUtil/IPClassifyUtility","DS/WidgetServices/WidgetServices","DS/ClassificationProp/ajaxRequests/ServicesAjaxRequests","DS/ClassificationProp/constants/ClassifPropConstants","DS/ClassificationProp/constants/ConstantsMapping","DS/ClassificationProp/utils/ClassifPropUtils","DS/WAFData/WAFData","DS/FedDictionaryAccess/FedDictionaryAccessAPI","i18n!DS/ClassificationProp/assets/nls/langEditProp"],(function(e,t,i,n,s,a,r,o,l){"use strict";var c={},u={},d={},h=function(e,t,i){var n=e[t];n?(!0==!n.multivalue&&(n.value=[n.value],n.valueDB=[n.valueDB],n.multivalue=!0),n.value.push(i.value),n.valueDB.push(i.valueDB)):e[t]=i};return{getPreviewUrl:function(e){if(!e.ids&&e.modelList){var t=this;e.ids=[],e.modelList.forEach((function(i){var n=t.getIdFromModel(i);n&&e.ids.push(n)}))}this._getPreviewUrl(e)},_getPreviewUrl:function(n){var s=this,a=n.ids,o=a.length;o&&(n.handleRequest.handle=t.get3DSearchUrlAsync({platformId:n.tenant,onComplete:function(l){var c=l+"/search",u=t.getLanguage(),d="",h="";a.forEach((function(e){d+=h+e,h=" OR "}));var f={with_indexing_date:!1,with_synthesis:!1,with_synthesis_attribute:!1,with_nls:!1,nresults:o,locale:u,query:d,tenant:n.tenant,start:0,select_file:["icon","thumbnail_2d"]},p="PropertiesPanel-"+e.getUserId()+"-"+(new Date).getTime();f.label=p;var m={Accept:"application/json","content-type":"application/json"};m["Accept-Language"]=t.getLanguage();var g={type:"json",method:"POST",timeout:24e4,data:UWA.Json.encode(f),proxy:"passport",headers:m,cache:-1,onComplete:function(e){s.onCompletePreview(e,n)},onFailure:function(e,t,s){i._onFailure(e,t,s,n)},onTimeout:function(e){i._onTimeout(n)}};t.getWidgetValue("isStandalone")||(g.authentication="passport"),n.handleRequest.handle=r.handleRequest(i._formatUrl2(n.tenant,c),g)}}))},onCompletePreview:function(e,t){var i=[];e&&e.results&&e.results.forEach((function(e){var t=null,n=null,s=!0;e.attributes&&e.attributes.every((function(e){return"resourceid"===e.name&&(t=e.value),"preview_url"===e.name&&(n=e.value),s=!(null!=t&&null!=n)})),s||i.push({id:t,preview:n})})),t.onComplete(i)},checkFacetsVisibility:function(e){var t={};t[n.FACET_PROPERTIES]=!0,e.onComplete.call(this,{id:e.model.get("objectId"),facets:t})},getSourceId:function(e){var t=e.get("sourceName");t=t||e.get("source");var i="",n=s.getSupportedServices()[t.toLowerCase()];return n&&n.fedPrefix&&(i=n.fedPrefix),i},fillModel:function(e,t){var i=e.onComplete;return e.onComplete=function(e){e&&e.results&&e.results.length>0&&a.fillFromServer(e.results[0],t,{}),i.apply(this,[t])},e.modelList=[t],this.getListOfAttributes(e)},getIdFromModel:function(e){var t=this.getSourceId(e),i=e.get("objectId");return i=i||"",t&&0!==i.indexOf(t)?t+':"'+i+'"':i},_getModelType:function(e){var t,i=e.get("ds6w:type");t="string"==typeof i?i:i?i.get("valueDB"):"";var n=e.get("source");t||"3DSwym"!==n||0==e.get("objectId").indexOf("iam")&&(t="pno:Person");return t},getListOfAttributes:function(n){var s=n.modelList;n.securityContext;if(s.length){var a=s[0],r=a.get("objectId"),o="";if(r){o="/search";var l=[];a.get("indexSource")?l.push(a.get("indexSource")):a.get("sourceName")&&l.push(a.get("sourceName")),n.model=a,n.idModel=r,n.onCompleteWS=this._onCompleteFederated.bind(this);var c=t.getLanguage(),u=t.getCancelObject();this.getMask({"ds6w:type":{valueDB:this._getModelType(a)}},(function(t){var s=[];t.Write.attributes.forEach((function(e){var t=e.name;s.push(t)}));var r=this.getIdFromModel(a),d={with_indexing_date:!1,with_synthesis:!1,with_synthesis_attribute:!0,with_nls:!1,locale:c,query:r,tenant:i.getTenantFromModel(a),source:l,select_predicate:n.select_predicates?n.select_predicates:s,start:0,select_file:["icon","thumbnail_2d"]},h="PropertiesPanel-"+e.getUserId()+"-"+(new Date).getTime();d.label=h,n.source="3DSearch",u.handler=i.createRequest(n,"POST",o,d)}));return u}}},getElementsNls:function(e,i){e&&e.length>0?o.getResourcesInfo(e.join(","),{tenantId:i.tenant,lang:t.getLanguage(),apiVersion:"R2018x",onComplete:function(e){i.onComplete.call(this,e)},onFailure:function(e){console.log(" --\x3e> Can't get ElementsNls "+e),i.onComplete.call(this,{success:!1})}}):i.onComplete.call(this,null)},getValuesNls:function(e,i){e?(o.getNlsOfPropertiesValues(JSON.stringify(e),{tenantId:i.tenant,serviceName:i.service,lang:t.getLanguage(),apiVersion:"R2019x",onComplete:function(e){i.onComplete.call(this,e)},onFailure:function(e){console.log(" --\x3e> Can't get ValuesNls "+e),i.onComplete.call(this,e)}}),o.getPropertiesForClass(JSON.stringify(e),{tenantId:i.tenant,serviceName:i.service,lang:t.getLanguage(),apiVersion:"R2019x",onComplete:function(e){i.onComplete.call(this,e)},onFailure:function(e){console.log(" --\x3e> Can't get ValuesNls "+e),i.onComplete.call(this,e)}})):i.onComplete.call(this,null)},_callMask:function(e,t,i){var n=this;d[e]?i.call(n,d[e]):require([t],(function(t){(t=JSON.parse(t))[e]?d[e]=t[e]:d[e]=t,i.call(n,d[e])}),(function(t){require(["text!DS/ClassificationProp/assets/masks/Federated/default.json"],(function(t){(t=JSON.parse(t))[e]?d[e]=t[e]:d[e]=t,i.call(n,d[e])}))}))},getMask:function(e,t){var i=e["ds6w:type"];if(i&&"pno:Person"===i.valueDB)this._callMask("Person","text!DS/ClassificationProp/assets/masks/3DSwym/Person.json",t);else{var n=i.valueDB;if(null!=n&&""!=n){var s=n.split(":")[1];if(null!=s&&null!=s&&""!=s){var a="text!DS/ClassificationProp/assets/masks/Federated/"+(s+".json");this._callMask(i&&i.valueDB,a,t)}else this._callMask("Default","text!DS/ClassificationProp/assets/masks/Federated/default.json",t)}else this._callMask("Default","text!DS/ClassificationProp/assets/masks/Federated/default.json",t)}},_onCompleteFederated:function(e,n){var s=this,a=e.results,r={source:"Federated"},o=[],d={};if(r.data=o,a&&a.length>0){var f={},p={},m={},g={},v=null,_=null,C=a[0],S={};for(var b in C.attributes.forEach((function(e){var i=e.name,n=i,s=e.value;s=void 0===s?"":s;var a="ds6w_facet"===e.format,o=a;if(a){var l=i.split("/");n=l[l.length-1]}if(a=a||"attribute"===e.format){v=!0===o?g:p,_=!0===o?m:f;var C=e.type,b=!1;if("date"===C){var E=Date.parse(s),y=new Date(E);y&&(s=(s=t.convertDateToStandard(y,!0)).valueDB,"ds6w:modified"!==n&&"ds6w:created"!==n||(C="datetime"))}else b="STRING"===C.toUpperCase();0===s.indexOf(n)&&(s=s.replace(n+".",""));var A=void 0!==e.dispValue,I=A?e.dispValue:s;if(b&&!A){var T=u[n];I=s;var w=T?T[s]:null;if(w)I=w;else{var P=S[n];P||(P=[],S[n]=P),P.push(s)}}var D={name:n,selectable:n,path:i,type:C,value:I,valueDB:s,readOnly:!0,nls:n};"ds6w:label"===n&&(d=D);var M=c[n];M?(D.nls=M.nlsName,h(v,n,D)):h(_,n,D)}else"resourceid"===n?r.physicalID=s:r[i]=s})),m)f[b]||(f[b]=m[b]);for(var b in g)p[b]||(p[b]=g[b]);n.idModel&&(r.physicalID=n.idModel),r.computed={label:d};var E=Object.keys(f),y=new Promise((function(e){s.getElementsNls(E,{tenant:i.getTenantFromModel(n.model),onComplete:function(t){e(t)}})})),A=new Promise((function(e){s.getValuesNls(S,{tenant:i.getTenantFromModel(n.model),service:n.model.get("sourceName"),onComplete:function(t){e(t)}})}));Promise.all([y,A]).then((function(e){var t=e[0],a=e[1];if(t)if(!1!==t.success){var l=t||{};l.vocabularyElementNLSInfo&&l.vocabularyElementNLSInfo.forEach((function(e){var t=f[e.uri];"Predicate"===e.type?c[e.uri]=e:u[e.uri]=e,t&&e.nlsName&&(t.nls=e.nlsName,p[e.uri]=t)}))}else i._raiseError(t.error?t.error.message:"Error",n);for(var d in a){var h=p[d];if(h){var m=a[d];if(h.multivalue){var g=[];h.value.forEach((function(e){var t=m[e];g.push(t||e)})),h.value=g}else h.value=m[h.value]?m[h.value]:h.value}}s.getMask(p,(function(e){e.Write.attributes.forEach((function(e){var t=e.name,i=p[t];i&&o.push(i)})),n.onComplete.call(null,{results:[r]})}))}))}else i._raiseError(l.get("FedAjax_NotFound"),n)}}})),define("DS/ClassificationProp/facets/Properties/ClassifPropBase",["UWA/Class","DS/UIKIT/Tooltip","DS/WidgetServicesUI/helpers/Constants","DS/ClassificationProp/facets/Properties/TweakerManager"],(function(e,t,i,n){"use strict";return e.extend({lTooltip:[],elements:{},_sharedOptions:null,init:function(e,t){var i=this;this._sharedOptions=t||{},this._parent(e),this.tweakerManager=new n({editable:!0===e.editMode,onNotification:function(e){i._manageError(e)}},t)},getSharedOptions:function(){return this._sharedOptions},isReadOnly:function(){var e=this.getSharedOptions();return!e||!0===e.readOnly},switchTweakersStatus:function(e){this.tweakerManager.switchMode(e)},_clearAllFields:function(){this.tweakerManager.clear()},_actionOnScroll:function(){this.tweakerManager.actionOnScroll()},_valueIsChanging:function(e,t){},setError:function(e){},_manageError:function(e,t){}})})),define("DS/ClassificationProp/facets/Properties/ClassifPropUIController",["DS/ClassificationProp/controllers/ClassifPropUIController","DS/ClassificationProp/utils/AttributesUtils","i18n!DS/ClassificationProp/assets/nls/langEditProp"],(function(e,t,i){"use strict";return e.extend({defaultOptions:{},validateModels:function(e){return t.validateModels(e)},validateAttributes:function(e,i){return t.validateAttributes(e,i)},resetValueOfModels:function(e){e||(e=this.getModels()),e.forEach((function(e){e.resetInitialValues()}))}})})),define("DS/ClassificationProp/facets/Common/ClassifFacetsCore",["DS/ClassificationProp/models/CommonAbstract"],(function(e){return e.extend({_sharedContext:null,destroyComponent:function(){},onResize:function(){},updateFacet:function(){},getButtons:function(){},onAction:function(e){},onSave:function(){},getExtensions:function(){},nothingToSave:function(){return!0},isActionAvailable:function(e){return!0},init:function(e){this._parent(e),this.elements||(this.elements={})},getTabId:function(){return this.options.tabId?this.options.tabId:""},onRefresh:function(){this.updateFacet()},getContext:function(){return this._sharedContext},switchSaveButton:function(e){this._raiseEvent("switchSave",e)},switchAddButton:function(e){this._raiseEvent("switchAdd",e)},refreshActions:function(){this._raiseEvent("updateActions")},updateReadWriteAccess:function(e){this._raiseEvent("updateRWA",e)},_raiseNotification:function(e,t,i){t=t||"error",this.dispatchEvent("onNotification",{msg:e,eventID:t,customClass:i})},_raiseEvent:function(e,t){e&&this.dispatchEvent("onEvent",{facet:this.getTabId(),eventID:e,value:t})},inject:function(e){var t=this.getUI();t&&(t.hide(),t.inject(e))},show:function(){return this.__callMethodOnUI("show")},hide:function(){return this.__callMethodOnUI("hide")},getOptimalSize:function(){return this.__callMethodOnUI("getSize")},__callMethodOnUI:function(e){var t=this._getUI(),i=t[e];return"function"!=typeof i&&(i=(t=this._getDOMUI())[e]),t?i.call(t):null},getUI:function(){return this._getUI()},_getDOMUI:function(){for(var e=this._getUI();"function"==typeof e.getContent;)e=e.getContent();return e},_getUI:function(){return this.elements?this.elements.container:null},showLoader:function(){this._raiseEvent("switchLoader",!0)},hideLoader:function(){this._raiseEvent("switchLoader",!1)},display:function(e){this.setContext(e),this.show()},setContext:function(e){this._sharedContext!==e&&(this._sharedContext=e,this.updateFacet())}})})),define("DS/ClassificationProp/ICard/IdCard",["UWA/Controls/Abstract","DS/Controls/Button","DS/Controls/TooltipModel","DS/UIKIT/Mask","DS/ClassificationProp/helpers/Helpers","DS/WidgetServicesUI/helpers/Constants","DS/WidgetServices/WidgetServices","DS/ClassificationProp/facets/Properties/TweakerManager","DS/ClassificationProp/constants/ClassifPropConstants","DS/ClassificationProp/models/ClassifPropAttributeModel","i18n!DS/ClassificationProp/assets/nls/langEditProp"],(function(e,t,i,n,s,a,r,o,l,c,u){var d=function(){this.dispatchEvent("thumbnailClick")},h=e.extend({init:function(e){this._parent.apply(this,arguments),this._showThumbnailsCondition={},this._currentModel=null,this._titleAttr=null,this.elements.container=UWA.createElement("div",{class:"idCardContainer"}),this.elements.thumbnail=UWA.createElement("div",{class:"thumbnail"}),this.elements.attrContainer=UWA.createElement("div",{class:"attributes"}),this.elements.thumbnail.inject(this.elements.container),this.elements.attrContainer.inject(this.elements.container),this.elements.headerContainer=UWA.createElement("div",{class:"header-section"}),this.elements.titleContainer=UWA.createElement("div",{class:"title-section"}),this.elements.title=UWA.createElement("div",{class:"title"}),this.elements.revision=UWA.createElement("div",{class:"revision"}),this.elements.multititles=UWA.createElement("div",{class:"multititles"}),this.elements.title.inject(this.elements.titleContainer),this.elements.revision.inject(this.elements.titleContainer),this.elements.multititles.inject(this.elements.titleContainer),this.elements.detailsContainer=UWA.createElement("div",{class:"details-section"}),this.elements.headerContainer.inject(this.elements.attrContainer),this.elements.detailsContainer.inject(this.elements.attrContainer),this.elements.owner=UWA.createElement("span",{class:"owner"}),this.elements.date=UWA.createElement("span",{class:"lastModified text-muted"}),this.elements.owner.inject(this.elements.detailsContainer),this.elements.date.inject(this.elements.detailsContainer),this.tweakerManager=new o({},{readOnly:!1}),this._handlerThumbnailClick=d.bind(this);var t=this,i=[{icon:"expand-up",text:u.get("hideIDCard"),method:"show"},{icon:"expand-down",text:u.get("showIDCard"),method:"hide"}],n=r.getWidgetValue(l.COLLAPSE_IC_PREFERENCE.name),s=0===n||1===n?n:0;this.defaultAction={name:"actionHide",text:i[s].text,icon:i[s].icon,handler:function(){var e=i[s=s?0:1];t.defaultAction.text=i[s].text,t.defaultAction.icon=i[s].icon,r.setWidgetValue(l.COLLAPSE_IC_PREFERENCE.name,s),t._updateFromExpandButton(e)}},this.setActions(e.actions);e=i[s];this._updateFromExpandButton(e)},_updateFromExpandButton:function(e){this.showThumbnail("collapse","show"===e.method),this.elements.detailsContainer[e.method](),this.elements.multititles[e.method]()},setActions:function(e){},fillFromModel:function(e){this.clearValues();var t=e.getAllAttributes();if(t)for(var i in t){var n=t[i];n instanceof c&&this.setValueForSection(e,n)}if(!e.get("labelAttribute")){var s=e.get(l.MODEL_DS_ATTR+"label");s&&this.setValueForSection(e,s)}},clearValues:function(){this.elements.container&&(this.elements.owner.empty(),this.elements.date.empty(),this.elements.title.empty(),this.elements.multititles.empty(),this.elements.revision.empty())},onResize:function(){this._manageThumbnailDisplay(),this._computeTitle()},maskThumbnail:function(){var e=this.getThumbnailElement();e&&n.mask(e)},unmaskThumbnail:function(){var e=this.getThumbnailElement();e&&n.unmask(e)},changeThumbnail:function(e,t){this.elements.thumbnail.setStyle("background-image","url("+e+")");var i=this.getThumbnailElement();i&&(this.showThumbnail("url",!!e),!0===t&&i.addClassName("clickable"),i.removeEvent("click",this._handlerThumbnailClick),i.addEvent("click",this._handlerThumbnailClick))},showThumbnail:function(e,t){this._showThumbnailsCondition[e]!==t&&(this._showThumbnailsCondition[e]=t,this.__manageThumbnailDisplay())},_manageThumbnailDisplay:function(){var e=this.elements.container.getSize();showThumbnails=e.width>=350,this.showThumbnail("width",showThumbnails)},__manageThumbnailDisplay:function(){var e=!0;for(var t in this._showThumbnailsCondition)if(!(e=this._showThumbnailsCondition[t]))break;e?this.elements.container.removeClassName("noThumbnail"):this.elements.container.addClassName("noThumbnail")},getThumbnailElement:function(){return this.elements.thumbnail},injectValue:function(e,t,i,n){this.elements[i]&&this._injectValue(e,t,this.elements[i],n)},_injectValue:function(e,t,i,n){var a={readOnly:!0,value:e,postBuild:!1};if(n)for(var r in n)a[r]=n[r];i.empty(),s.getTweaker(t,a,(function(e){i.empty(),e.inject(i),n&&n.callback&&n.callback()}))},addRevision:function(){if(this.elements.title){var e=this.elements.title.getElementsByClassName("tw_ROValue_content");e&&e.length>0&&this.elements.revision.inject(e[0])}},_computeTitle:function(e){if(this._currentModel){var t=this,i=this._currentModel.getComputedTitle(),n=e;e||(n=this._currentModel.get(this._titleAttr)),n&&(this._titleAttr=n.getIdentifier(),i||(i=n.get("value")));var s=!!(this.elements.container.getSize().width>380);s?this.elements.container.removeClassName("smallSize"):this.elements.container.addClassName("smallSize");var r=this.elements.attrContainer.getSize().width/4,o=i.length>r,l=s,c=s;this.injectValue(i,a.TYPES.STRING,"title",{postBuild:o,maxCharacters:r,multiline:l,forHTML:c,callback:function(){t.addRevision()}})}},setValueForSection:function(e,t){var i=t.get("sectionIdentityCard"),n=!!i;if(n){this._currentModel=e;var s="title"===i;if(s&&(this._computeTitle(t),!0===e.isMergedModel()?this.elements.title.addClassName("EP_MergedTitle"):this.elements.title.removeClassName("EP_MergedTitle")),!0!==e.isMergedModel()){if(s){var o=e.get("revision");o&&this.injectValue(" "+o.get("value"),a.TYPES.STRING,"revision")}else if("ownerName"===i)this.injectValue(t.get("value")+" ",a.TYPES.STRING,"owner");else if("date"===i){var l=t.get("value");l=l||t.get("valueDB"),computedDate=r.formatDateObj(l),this._injectValue(computedDate,a.TYPES.DATETIME,this.elements.date)}}else this.injectValue(t.get("value"),a.TYPES.STRING,"multititles",{multisel:!0})}return n}});return h})),define("DS/ClassificationProp/ajaxRequests/3DSpaceAjaxRequests",["DS/WidgetServices/WidgetServices","DS/ClassificationProp/ajaxRequests/ServicesAjaxRequests","DS/ClassificationProp/ajaxRequests/FederatedAjaxRequests","DS/ClassificationProp/constants/ClassifPropConstants","DS/WAFData/WAFData"],(function(e,t,i,n,s){"use strict";return{commitModels:function(e){var i=e.modelList,n=(e.securityContext,"/resources/IPClassificationReuse/classifiedItem/attributes/update"),s=[],a=!1;i.forEach((function(e,i){"IP Export Control"==e.component&&!0===window.enableExportAttributes&&(n="/resources/IPProtectionService/read/attributes/update");var r=t._createJSONModifiedAttribute(e);a=a||r.requests.length>0,s=s.concat(r.requests);var o=r.plmParametersRequests;o.length>0&&t._concatRequestListComposite(s,o)}));var r=i.length>0?i[0]:null,o={requests:s};a&&null!=r&&r.isMergedModel()&&(o.transactionid=r.get("objectId")),e.model=r,e.onCompleteWS=t._onCompleteCommit,o&&0!=o.requests.length?t.createRequest(e,"POST",n,o):e.returnCallback&&e.returnCallback()},getPreviewUrl:function(e){var t=e.modelList,n=(t.length,[]),s="";t.forEach((function(e){var t=e.get("objectId");s=s||e.get("tenant"),t&&n.push("physicalid:"+e.get("objectId"))})),n.length>0&&(e.ids=n,e.tenant=s,i.getPreviewUrl(e))},getHistory:function(e){t.securityContextDispatcher(e,this._getHistory)},_getHistory:function(i){var n=i.modelList,a=i.nbResult,r=i.lastDate,o=i.securityContext;i.handleRequest||(i.handleRequest={}),a=a||20;if(n.length){var l="",c="";n.forEach((function(e){var t=e.get("objectId");l+=c+"id="+t,c="&"}));var u=n.length>0?n[0]:null;i.handleRequest.handle=e.getSourceUrlAsync({platformId:t.getTenantFromModel(u),source:t.getSourceFromModel(u),onComplete:function(c){var u="",d="";u="passport",d=c+"/resources/v1/collabServices/attributes/op/history",d+="?"+l,d+="&nbResults="+a,r&&(d+="&lastDate="+r);var h={Accept:"application/json","content-type":"application/json"};h["Accept-Language"]=e.getLanguage(),o&&(h.SecurityContext=encodeURIComponent(o));var f={type:"json",method:"GET",timeout:36e5,proxy:u,headers:h,cache:-1,onComplete:function(e){t._onCompleteAttributes(e,i)},onFailure:function(e,n,s){t._onFailure(e,n,s,i)},onTimeout:function(e){t._onTimeout(i)}};e.getWidgetValue("isStandalone")||(f.authentication="passport");var p=n.length>0?n[0]:null;i.handleRequest.handle=s.handleRequest(t._formatUrl(p,d),f)}})}},checkFacetsVisibility:function(e){t.securityContextDispatcher(e,this._checkFacetsVisibility)},_checkFacetsVisibility:function(i){var n=i.model,a=n.get("objectId"),r=i.facets,o=i.sourceAppId,l=i.securityContext;i.handleRequest||(i.handleRequest={});var c={id:a,facets:r,sourceAppId:o};n.isMergedModel()&&(c.ids=n.getMergedModelIds());i.handleRequest.handle=e.getSourceUrlAsync({platformId:t.getTenantFromModel(n),source:t.getSourceFromModel(n),onComplete:function(a){var r="",o="";r="passport",o=a+"/resources/v1/collabServices/attributes/op/facets/available";var u={Accept:"application/json","content-type":"application/json"};u["Accept-Language"]=e.getLanguage(),l&&(u.SecurityContext=encodeURIComponent(l));var d={type:"json",method:"POST",timeout:36e5,proxy:r,headers:u,data:UWA.Json.encode(c),onComplete:function(e){t._onCompleteAttributes(e,i)},onFailure:function(e,n,s){t._onFailure(e,n,s,i)},onTimeout:function(e){t._onTimeout(i)}};e.getWidgetValue("isStandalone")||(d.authentication="passport"),i.handleRequest.handle=s.handleRequest(t._formatUrl(n,o),d)}})},getClassificationAttributes:function(e){var i=e;if(!UWA.is(i,"object"))throw new Error("Invalid inputs for LibraryEditorWebService.getClassificationAttributes");let n="/resources/IPClassificationReuse/class/"+e.modelList[0]._attributes.objectId+"/getclassificationattributes";e.isExportControl&&!0===window.enableExportAttributes&&(n="/resources/IPProtectionService/read/"+e.modelList[0]._attributes.objectId+"/getclassificationattributes"),e.onCompleteWS=t._onCompleteAttributes,t.createRequest(e,"GET",n)},getListOfAttributes:function(i){var s=i.modelList,a=!0===i.navigateToMain?"true":"false",r=(i.securityContext,e.getWidgetValue("index_mode")),o=s.length,l=!1,c=!1;if(o){for(var u=[],d=[],h=[],f=(T=s[0]).get("objectId"),p=0;p<o;p++){var m=s[p],g={a:m};for(var v in c=c||m.isMergedModel(),m.isMergedModel()&&(g=m.getMergingModels()),g){var _=g[v],C=_.get("metatype"),S=_.get("objectId"),b=_.get("instrefid");l=l||"EBOM"==C,r||C!=n.METATYPE_BUS&&"bus"!=C?r||C!=n.METATYPE_REL?u.push(S):("undefined"!==b&&""!==b&&d.length===h.length&&h.push(b),d.push(S)):h.push(S)}}var E="";E="/resources/v1/proto/attributes/op/read",!1!==l||r?r&&(E="/resources/v1/collabServices/attributes/op/readIndex"):E="/resources/v1/collabServices/attributes/op/read";var y=e.isDebug(),A=e.getWidgetValue("debug_properties")||y?"true":null,I=null;r?I={lIds:u,indexattributes:"true",debug_properties:A||""}:(I={lIds:u,relIDs:d,busIDs:h,plmparameters:i.plmParams?"true":"false",attributes:!1!==i.attributes?"true":"false",navigateToMain:a,readonly:!0===i.readonly?"true":"false",debug_properties:A||""},c&&(I.format="merge"),c&&(I.transactionid=f));var T=s.length>0?s[0]:null;i.model=T,i.withSC=!0,i.withChange="silent",i.onCompleteWS=t._onCompleteAttributes,t.createRequest(i,"POST",E,I)}}}})),define("DS/ClassificationProp/models/OccurrenceModel",["UWA/Class/Model","DS/ClassificationProp/models/ClassifPropModel","UWA/Class/Debug"],(function(e,t,i){"use strict";return e.extend(i,{defaults:{isMerging:!1,modelPrefix:"00"},isMergedOccurrence:function(){return!0===this.get("isMerging")},getMergePrefixe:function(){return this.get("modelPrefix")},getAllModels:function(e,i){var n=this._attributes,s=!0===e?[]:{};for(var a in n)if(n[a].model instanceof t&&(!0===e?s.push(n[a].model):s[a]=n[a].model,!0===i))break;return s},_getModelElement:function(e){var t=this.get(e);return t||(t={model:null,options:null}),t},setOptions:function(e,t){var i=this._getModelElement();i.options=t,this.set(e,i)},getOptions:function(e){var t=this.get(e);return t?t.options:null},setModel:function(e,t){var i=this._getModelElement();i.model=t,this.set(e,i)},getModel:function(e){var t=this.get(e);return t?t.model:null}})})),define("DS/ClassificationProp/facets/Common/ClassifFacetsBase",["DS/ClassificationProp/facets/Common/ClassifFacetsCore","DS/ClassificationProp/constants/ClassifPropConstants"],(function(e,t){var i=e.extend({_lastUpdatedId:null,_sharedOptions:null,init:function(e,t){this._sharedOptions=t,this._parent.apply(this,arguments),this.elements||(this.elements={})},getSharedOptions:function(){return this._sharedOptions},isReadOnly:function(){var e=this.getSharedOptions();return!e||!0===e.readOnly},getOccurrence:function(){return this.getContext()},setContext:function(e){this.setOccurrence(e)},setOccurrence:function(e){var i;if((i=this.getOccurrence())&&e){var n=i.getModel(t.MODEL_INIT),s=i.getModel(t.FACET_PROPERTIES),a=e.getModel(t.MODEL_INIT),r=e.getModel(t.FACET_PROPERTIES);this.getModel();var o=e.getModel(this.getTabId())}if(this._setOccurrence(e),i=this.getOccurrence()){var l=this.getModel();if(!l)return;var c=l.get("objectId");"relationship"==l.get("metatype")&&(c=l.get("selReferenceID"));var u=!0;o&&n.get("objectId")===a.get("objectId")?(u=!1,i.setModel(this.getTabId(),o)):s&&r&&s.get("objectId")===r.get("objectId")?(u=!1,i.setModel(t.FACET_PROPERTIES,s)):n&&n.get("objectId")===a.get("objectId")&&(u=!1,i.setModel(t.MODEL_INIT,n)),(c!=this._lastUpdatedId||u)&&(this._lastUpdatedId=c,this.updateFacet())}},getModel:function(e){var i=null,n=this.getOccurrence();if(n&&(model=this.getOccurrence().getModel(this.getTabId())),e){if(model&&model.get("objectId")===e&&(i=model),!model&&n){var s=n.getAllModels();for(var a in s){var r=s[a];if(r&&r.get("objectId")===e){i=r;break}}}}else n&&(model||(model=this.getOccurrence().getModel(t.FACET_PROPERTIES)),model||(model=this.getOccurrence().getModel(t.MODEL_INIT)),i=model);return i},_setOccurrence:function(e){this._sharedContext=e},setModel:function(e){this.getOccurrence()&&this.getOccurrence().setModel(this.getTabId(),e)}});return i})),define("DS/ClassificationProp/controllers/ClassifPropMainController",["UWA/Class/Model","DS/ClassificationProp/models/OccurrenceModel","DS/ClassificationProp/models/ClassifPropModel","DS/ClassificationProp/models/ClassifPropModelMerge","DS/ClassificationProp/models/ClassifPropAttributeModel","DS/ClassificationProp/utils/ClassifPropUtils","DS/ClassificationProp/UI/ClassifPropSkeleton","DS/ClassificationProp/constants/ClassifPropConstants","DS/ClassificationProp/constants/ConstantsMapping","DS/WidgetServices/WidgetServices","DS/ClassificationProp/utils/ClassifSecurityContextServices"],(function(e,t,i,n,s,a,r,o,l,c,u){"use strict";return UWA.Class.extend({skeleton:null,defaultOptions:{selectionType:o.ALL_SELECTION,displayType:o.STANDARD,context:null,odtUpTransient:!1},init:function(e){var t=this;for(var i in this._parent(e),this._selectionIsStopped=!1,this._currentNewSelection=null,this.options=this.options?this.options:{},this.defaultOptions)this.options[i]=e[i];u.getInstance({context:this.options.context});var n=e.events.onCancel;e.events.onCancel=function(e){t._unsubscribeSelect(),t.skeleton.clearPanel(),t.skeleton.setOccurrences([]),t.skeleton.notifyClose,t.skeleton.notifyClose(),n&&n.call(t,e)},this._setup(e),e.selectionType!==o.NO_SELECTION&&(this._commandProxy=null,require(["DS/WidgetServices/commandProxy/CommandProxy"],(function(e){var i=!1,n=0,s=function(e,s){if(e.paths&&0===e.paths.length||e.pathsInst&&0===e.pathsInst.length)i=!1,setTimeout((function(){!1===i&&t._onSelectionChange(e,s)}),500);else{i=!0;var a=++n;setTimeout((function(){a===n&&t._onSelectionChange(e,s)}),50)}},a={events:{onSelect:s}};t.options.displayType!==o.TRANSIENT&&!0!==t.options.odtUpTransient||(a.events.onUpdateTransient=function(e){e.models;var i=e.options;i&&i.securityContext&&u.getInstance({context:{getSecurityContext:function(){return{SecurityContext:i.securityContext}}}}).getSecurityContext(),t._commandProxy.subscribe({onSelect:s})}),t._commandProxy=e.create(a)})))},getTopBar:function(){return this.skeleton.getTopBar()},_unsubscribeSelect:function(){this._commandProxy&&this._commandProxy.unsubscribe(this._commandProxy.choices.SELECT)},setModels:function(e,t,i,n,s){var a=this;null!=i&&""!==i?(this.skeleton.defaultFacetName=i,this.skeleton.selectFacet(i)):this.skeleton.defaultFacetName=null,null!=n&&""!==n&&(this.skeleton.infoForFacet=n);var r=!!this._currentNewSelection;this._currentNewSelection={models:e,change:t},r||this.skeleton.checkChangeAuthorized((function(e){var t=a._currentNewSelection;a._currentNewSelection=null,!0===e&&a._setModels(t.models,t.change)}),!0)},_setModels:function(a,r){window.top.performance.mark("start_setModelController");var l=(g=a&&a.length>0?a[0]:null)?g instanceof e?g.get("tenant"):g.tenant:null;g&&l&&c.setWidgetValue("x3dPlatformId",l);var u=this,d=a.length,h=[];if(d){var f={},p={},m=null;a.forEach((function(n,r){if("function"!=typeof n.isMergedModel||!0!==n.isMergedModel()){var l=a[r],c=null;n instanceof e?(u._getModel(l.get("objectId"))||l.clearChangedValue(),c=l.getChangedValues()):(l=new i(n),a[r]=l),u._getModel(l.get("objectId"))||(u.editPropModelList=[l],l.clearChangedValue()),l.keys().forEach((function(e){var t=l.get(e),i=t instanceof s;if(!i&&t&&"object"==typeof t&&"EditProp_listOfChange"!==e&&"label"!==e&&(t=new s(t),i=!0,l.set(e,t)),i&&!0===l.isTransientModel()){var n=t.getIdentifier();if(n){var a=p[n];if(a){var r=t.get("value"),o=t.get("valueDB"),c=a.get("value"),u=a.get("valueDB");c[l.get("objectId")]=r,u[l.get("objectId")]=o,"title"===a.get("sectionIdentityCard")&&(m.value[l.get("objectId")]=r,m.valueDB[l.get("objectId")]=o),a.__nbValues++}else{r=(a=new s(UWA.clone(t))).get("value"),o=a.get("valueDB"),u={};(c={})[l.get("objectId")]=r,u[l.get("objectId")]=o,a.set("multisel",!0),a.set("value",c),a.set("valueDB",u),a.__nbValues=1,"title"===a.get("sectionIdentityCard")&&((m={value:{},valueDB:{}}).value[l.get("objectId")]=r,m.valueDB[l.get("objectId")]=o),p[n]=a}}}}));var d=l.get("EditProp_listOfChange");d&&(l.setChangedValues(d),l.unset("EditProp_listOfChange")),c&&l.setChangedValues(c);var g=l;if(!f[g.get("objectId")]){f[g.get("objectId")]=g;var v=new t;v.setModel(o.MODEL_INIT,g),h.push(v)}}}));var g,v=Object.keys(f).length;if(v>1)if(null!=(g=h[0].getModel(o.MODEL_INIT))){var _=UWA.clone(g.getOptions());for(var C in p){p[C].__nbValues===v&&(_[C]=p[C])}null!=m&&(_[o.MODEL_DS_ATTR+"label"]=new s({sectionIdentityCard:"title",value:m.value,valueDB:m.valueDB,isTransient:!0,multisel:!0,path:o.MODEL_DS_ATTR+"label"}));var S=(S=c.getWidgetPreference("transactionId"))&&S.value?S.value:u._generateMergeID(),b=new t({modelPrefix:S,isMerging:!0});_.objectId=S,u.mergeModel=new n(_),u.mergeModel.setMergingModels(f),b.setModel(o.MODEL_INIT,u.mergeModel),h.unshift(b)}else console.log("First model not found in occurrence")}window.top.performance.mark("end_setModelController"),this.skeleton.setOccurrences(h)},_generateMergeID:function(){return c.generateUniqueId()},_getModel:function(e){return this.skeleton.getModel(e)},getModels:function(){return this.skeleton.getModels()},getTitle:function(){return this.skeleton.getTitle()},getOptimalSize:function(){return this.skeleton.getOptimalSize()},getUI:function(){return this.skeleton},onRefresh:function(){var e=this,t=e.getModels();e.setModels([],void 0),e.setModels(t,void 0)},_getFacet:function(e,t){var i=t;if("string"==typeof t)i=e[t];else if("object"==typeof t&&t.id){var n=e[t.id];if(n){for(var s in t)n[s]=t[s];i=n}}return i},addFacets:function(e){if(e){var t=this,i=[],n=this.mapFacet?this.mapFacet:l.getMapping();e.forEach((function(e){i.push(t._getFacet(n,e))}));var s=this.getUI();s&&s.addFacets(i)}},_setup:function(e){var t=this,i=l.getMapping(e);t.mapFacet=i;var n=l.getDefaultFacets();e.facets&&(n=e.facets,delete e.facets);var s=[],a=!1;n.forEach((function(n){var r=t._getFacet(i,n);r&&(!a&&r.facet&&r.facet.name===o.FACET_PROPERTIES&&(a=!0),(!0!==r.blockFromSearch||!e||"searchInformationProperties"!==e.className&&"searchPreviewProperties"!==e.className)&&(r.facet&&r.facet.name!==o.FACET_GENERALHISTORY||(e.displayType===o.TRANSIENT||e.displayType===o.POPUP)&&r.facet&&r.facet.name===o.FACET_GENERALHISTORY)&&s.push(r))})),a||(i[o.FACET_PROPERTIES].visible=!1,s.push(i[o.FACET_PROPERTIES])),this.skeleton=new r(s,e)},destroyComponent:function(){this._commandProxy&&(this._commandProxy.unsubscribe("onUpdateTransient"),this._commandProxy.unsubscribe("onSelect"))},onResize:function(){this.getUI().onResize()},_raiseNotif:function(e,t){this.dispatchEvent("onNotification",{msg:e,eventID:t})},stopSelection:function(e){this._selectionIsStopped=!0===e},_onSelectionChange:function(e,t){if(!(this.options.selectionType===o.NO_SELECTION||!0===this._selectionIsStopped||t&&t.metadata&&t.metadata.originWidgetId===c.getWidgetId()&&"ENORIPE_Relations"===t.metadata.origin)){var i=e.pathsInst,n=!!i,s=(i=i&&i.length>0?i:e.paths).length,r=e.defaultFacetName,l=e.infoForFacet,u=e.attributes,d=this.getModels(),h=[];d.forEach((function(e){h.push(e.get("objectId"))}));if(this.options.selectionType!==o.RESTRICTED_SELECTION||t.metadata&&t.metadata.originWidgetId===c.getWidgetId()){for(var f=[],p=0;p<s;p++){var m=i[p];if(m){var g=a.getModelFromPath(m,u,n);!g.get("tenant")&&e.tenant&&g.set("tenant",e.tenant),f.push(g)}}var v=null;c.isChangeAvailable()&&(v=UWA.clone(e.changeControl)),this.setModels(f,v||null,r,l)}}},changeAttributes:function(e){this.skeleton.changeAttributes(e)}})})),define("DS/ClassificationProp/ClassifPropWidget",["UWA/Core","UWA/Controls/Abstract","DS/WidgetServices/WidgetServices","DS/ClassificationProp/comm/EventManager","DS/ClassificationProp/controllers/ClassifPropMainController"],(function(e,t,i,n,s){"use strict";var a=function(e){this.setReadonlyStatus(e)};return t.extend({defaultOptions:{},_getController:function(e){return this.controller?this.controller:new s(e)},init:function(e,t){t&&i.setWidgetObject(t);var s={};for(var r in e)s[r]=e[r];s.propertiesWidgetUI=!0,null!==s.securityContextFromAppPreference&&void 0!==s.securityContextFromAppPreference||(s.context&&"function"==typeof s.context.getSecurityContext&&s.context.getSecurityContext()&&s.context.getSecurityContext().SecurityContext?s.securityContextFromAppPreference=s.context.getSecurityContext().SecurityContext:s.securityContextFromAppPreference=null),s.sourceAppId||(s.sourceAppId=s.appId);var o=this;this._parent(s),this.elements||(this.elements={}),s.events||(s.events={}),s.events.onInnerCancel=function(){o.destroyComponent()},this.controller=this._getController(s),this.elements.UI=this.controller.getUI(),this.elements.container=this.elements.UI,this.elements.container.getContent().addEvent("resize",(function(){o.onInnerResize()})),(i.isReplayedODT()||!0===i.getWidgetObject().getValue("proto"))&&(this._handlerSwitch=a.bind(this),n.subscribe("switchMode",this._handlerSwitch))},initDatas:function(e,t,i,n){this.controller.setModels(e,void 0,t,i,n)},initData:function(e,t,i){this.initDatas(e,t,i)},changeAttributes:function(e){this.controller.changeAttributes(e)},show:function(e){this.elements.popup&&(this.elements.popup.show(),this.initDatas(e))},centerIt:function(e){this.elements.popup&&this.elements.popup.centerIt()},onRefresh:function(){this.controller.onRefresh()},onResize:function(){},onInnerResize:function(){this.elements.popup?this.elements.popup.onResize():this.elements.UI&&this.elements.UI.onResize()},setReadonlyStatus:function(e){this.elements.UI.setReadonlyStatus(e)},selectFacet:function(e){this.elements.UI.selectFacet(e)},removeFacets:function(e){this.elements.UI.removeFacets(e)},stopSelection:function(e){this.controller.stopSelection(e)},addFacets:function(e){this.controller.addFacets(e)},getTitle:function(){return this.elements.UI.getTitle()},getIdentityCardUI:function(){return this.elements.UI.getIdentityCardUI()},getMainTable:function(e){return this.elements.UI.getMainTable()},getListModel:function(){return this.controller.getModels()},destroyComponent:function(){this._handlerSwitch&&n.remove("switchMode",this._handlerSwitch),this.controller.destroyComponent(),this.elements.popup?this.elements.popup.destroyComponent():this.elements.UI.destroyComponent()},getAccordeonFormSection:function(){return this.editPropertiesUI.elements.formSection}})})),define("DS/ClassificationProp/form/Form",["DS/ClassificationProp/models/CommonAbstract","DS/WidgetServicesUI/helpers/Constants","DS/ClassificationProp/facets/Properties/TweakerManager","DS/ClassificationProp/utils/AttributesUtils","DS/WidgetServices/WidgetServices","DS/WidgetServices/moveHelper/MoveHelper","DS/ClassificationProp/helpers/TweakerInfoWebUX","DS/UIKIT/Tooltip","DS/Controls/TooltipModel","DS/ClassificationProp/models/ClassifPropAttributeModel","css!DS/ClassificationProp/ClassificationProp.css"],(function(e,t,i,n,s,a,r,o,l,c){var u=function(e){var i,n,s=e.get("tw_type");return s||("owner"===e.get("name")?s=t.TYPES.PERSON_WUX:"originated"===e.get("name")||"modified"===e.get("name")||"branch.originated"===e.get("name")||"branch.modified"===e.get("name")?s=t.TYPES.DATETIME_WUX:e.authorizedValues&&0===e.authorizedValues.length&&(e.dimension||e.dimensionType)&&e.displayAsEntered?s=t.TYPES.UNIT:(i=e.get("type"),n="string"===i||"text"===i?"string_wux":i,"integer"===i?n=t.TYPES.INTEGER_WUX:"real"===i?n=t.TYPES.NUMBER_WUX:"timestamp"===i||"date"===i?n=t.TYPES.DATE_WUX:"person"===i?n=t.TYPES.PERSON_WUX:"boolean"===i||"radiobutton"===i||"checkbox"===i?n=t.TYPES.BOOLEAN_WUX:"enum"!==i&&"listbox"!==i&&"listboxmanual"!==i&&"combobox"!==i||(n=t.TYPES.ENUM_WUX),s=n),e.set("tw_type",s)),s},d=function(e){var i,n,s=e.get("tw_type");return s||("owner"===e.get("name")?s=t.TYPES.PERSON:"originated"===e.get("name")||"modified"===e.get("name")||"branch.originated"===e.get("name")||"branch.modified"===e.get("name")?s=t.TYPES.DATETIME:(i=e.get("type"),n=i,"integer"===i?n=t.TYPES.INTEGER:"real"===i?n=t.TYPES.NUMBER:"timestamp"===i||"date"===i?n=t.TYPES.DATE:"person"===i?n=t.TYPES.PERSON:"boolean"===i||"radiobutton"===i||"checkbox"===i?n=t.TYPES.BOOLEAN:"enum"!==i&&"listbox"!==i&&"listboxmanual"!==i&&"combobox"!==i||(n=t.TYPES.ENUM),s=n),e.set("tw_type",s)),s},h="formLabel",f={},p=function(e,t,i){var n=g(e,f[t]?f[t]:"200",t,i);return function(e,t,i){try{localStorage.setItem(e+"_style"+(i?"_"+i:""),JSON.stringify(t))}catch(e){console.log("Local storage full. Current form size can't be saved")}}(e,n,t),n},m=function(e,t){var i=localStorage.getItem(e+"_style"+(t?"_"+t:"")),n=null;try{(n=JSON.parse(i)).width<80&&(n.width=80)}catch(e){}return n||(n=p(e,t)),n},g=function(e,t,i,n){var s={};return s["."+e+" ."+h+(i?"."+i:"")]={width:t+"px"},s["."+e+" .resizeHandler"+(i?"."+i:"")]={left:t-10+"px"},{style:s,width:t,userAction:n}},v=function(e,t,i){var n=null;return e.forEach((function(e){var a=function(e,t){var i=m(e,t),n=e+"_style"+(t?"_"+t:"");return s.addNewStyles(n,i.style,!0),i}(e,i);t===e&&(n=a)})),n},_=e.extend({postBuildTweaker:function(){this._tweaker&&this._tweaker.postBuildUI(),this._finalizeWhenReady=!0},destroy:function(){this._parent.apply(this,arguments),this._model&&this._model.removeEvent(this._idAttr,this._manageMessageHandler)},init:function(e,t,i,n){this._parent(n),this._idAttr=i.getIdentifier(),this._model=t,this._form=e,this._tweaker=null,this._finalizeWhenReady=!1,this._manageMessageHandler=this._manageMessage.bind(this);var s=this;s.propertiesWidgetUI=!!t.propertiesWidgetUI,s.newInfraUI=!!t.newInfraUI,!0!==n.postBuild&&this.subscribeEvt("triggerPostBuild",(function(){s.postBuildTweaker()})),this.elements.container=UWA.createElement("div",{class:"formLine s12 m12"+(i.get("width")?" l"+i.get("width"):" l12")}),this.elements.flexLine=UWA.createElement("div",{class:"flexLine"}).inject(this.elements.container);var a=this._form._sharedOptions.identifier?h+" "+this._form._sharedOptions.identifier:h,o=UWA.createElement("div",{class:a+" s12"}).inject(this.elements.flexLine),c=!0!==this.options.readOnly&&i.get("mandatory");let f=i.get("dimensionType"),p=i.get("authorizedValues"),m=!(!f||!p||0!==p.length),g=[];i.get("dimensionUnits")&&i.displayAsEntered&&i.get("dimensionUnits").Units&&(g=i.get("dimensionUnits").Units.map((e=>e.label)));var v=UWA.createElement("div",{class:"attrLabel"+(c?" mandAttr":"")}).inject(o),_=UWA.createElement("span",{class:"textContainer"}).inject(v);s.elements.errorIcon=UWA.createElement("span",{class:"errorIcon wux-ui-3ds wux-ui-3ds-error",styles:{display:"inline",color:"#ea4f37","font-size":"12px","padding-right":"3px"}}).inject(_),s.elements.errorIcon.addClassName("hide");var C=UWA.createElement("span",{text:i.get("label")}).inject(_);c&&UWA.createElement("span",{class:"mandIcon  wux-ui-3ds wux-ui-3ds-new-create"}).inject(v),UWA.is(i.tooltipInfo,"object")&&this.addHelpInfo(v,i),m&&(s.propertiesWidgetUI||s.newInfraUI)&&(this._addUnitsHelper=function(e){let t=UWA.createElement("span",{class:"DimensionUnitInfoContainer"}).inject(v);s.elements.infoContainer=t;let i=new r(this.options);i._build(this.options,(function(n){if(n){let s=g;s&&s.length>0&&(i._injectData(s,this.options),n.inject(t),"function"==typeof e&&e(!0))}}))},s.newInfraUI&&i.displayAsEntered&&s._addUnitsHelper()),C.tooltipInfos=new l({shortHelp:i.get("label"),mouseRelativePosition:!0}),!0===c&&UWA.createElement("div",{class:"attrMand",html:" *"}).inject(v);var S=this._idAttr,b=UWA.createElement("div",{class:"formValue s12"}).inject(this.elements.flexLine),E=UWA.createElement("div",{class:"formTweakerContainer",id:S}).inject(b);if(!0!==this.options.readOnly){var y=new UWA.createElement("span",{class:"attribute-lineError"}).inject(b);this.elements.errorContent=y}var A=t.propertiesWidgetUI||t.webUxTweakers||t.newInfraUI?u.call(s,i):d(i),I={};this.options.readonly&&(I.readOnly=this.options.readOnly),I.postBuild=this.options.postBuild,!t.propertiesWidgetUI||t.webUxTweakers||"string"!==A&&"string_wux"!==A?I.forClickable=!1:I.forClickable=!0,this._form.tweakerManager.getTweaker(t,this._idAttr,A,I,(function(e){e.inject(E),s._tweaker=e,s._finalizeWhenReady&&s.postBuildTweaker(),s.dispatchEvent("tweakerReady:"+s._idAttr,[e]),"string"!==i.tw_type&&"string_wux"!==i.tw_type||i.multiline||s._tweaker.addEvent("enterKeyDown",(function(){t.dispatchEvent("onEnterKeyDown",[i])}));let n=i.get("visible");UWA.is(n)&&s.elements.container.toggle(!!n),s._tweaker.addEvent("valid",(function(){t.dispatchEvent("validateValue",[s._model.get(s._idAttr)])}))})),t.addEvent("onChange:"+this._idAttr,this._manageMessageHandler)},addHelpInfo(e,t){var i=this;setTimeout((()=>{i.elements.tooltip=UWA.createElement("div",{class:"helpTooltip"}).inject(e),new WUXLabel({icon:"info",tooltipInfos:new l({title:t.tooltipInfo.title,shortHelp:t.tooltipInfo.shortHelp,longHelp:t.tooltipInfo.longHelp,moreHelpCB:t.tooltipInfo.moreHelpCB})}).inject(i.elements.tooltip)}))},showNotificationOnField:function(e){this.elements.errorContent&&this.elements.errorContent.setText(e.message?e.message:""),e.message&&"error"===e.type?this.elements.errorIcon.removeClassName("hide"):this.elements.errorIcon.addClassName("hide")},_manageMessage:function(){var e=this._model.get(this._idAttr);this.newInfraUI=!!this._model.newInfraUI;var t=this._model.webUxTweakers||this._model.propertiesWidgetUI?u(e):d(e);e.validationFunction=this._form.tweakerManager.getValidationFunction(t);var i=n.validateAttributes(this._model,[e]);e&&(e.error&&UWA.is(e.error.message)?this.showNotificationOnField(e.error):e&&e.uxBLerror?this.showNotificationOnField(e.uxBLerror):this.showNotificationOnField(e.error)),i&&i.length>0&&(!this._tweaker||!0===this._tweaker.underEdition)&&this.publishEvt("onNotifications",i)},focusTweakerElement:function(){if(this._tweaker){var e=this._tweaker;e&&UWA.is(e.focus,"function")&&e.focus()}else this.addEventOnce("tweakerReady:"+this._idAttr,(function(e){e&&UWA.is(e.focus,"function")&&e.focus()}))}}),C=null,S=null,b=e.extend({defaultOptions:{width:12,label:null,classname:"large",postBuild:!0},_sharedOptions:null,isReadOnly:function(){var e=this._sharedOptions;return!e||!0===e.readOnly},init:function(e,t){this._parent(e),this._sharedOptions=t;var n=this;this.elements.container=UWA.createElement("fieldset",{class:"classifAttContainer s12 m12 l"+this.options.width}),this.fields=[],e.label&&UWA.createElement("legend",{text:e.label}).inject(this.elements.container),this.elements.content=UWA.createElement("div",{class:"classifAttformContent"}).inject(this.elements.container),this.subscribeEvt("editionSwitched",(function(e){n.switchTweakersStatus()})),this.subscribeEvt("innerSwitch",(function(e){if(n.options.sizeClassname=e,S!==this.index){S=this.index;var t=m(e,n._sharedOptions.identifier);n._publishResizeCell(t)}})),this.subscribeEvt("resetDisplay",(function(){C!==this.index&&(C=this.index,n.resetDisplay())})),this.addEvent("resetDisplay1",(function(){var e=n.elements.content.getSize();if(n.idealLabelWidth||n.updateResizeLimit(),e.width){n.maxColWidth=e.width-287;var t=m(n.getClassResize(),n._sharedOptions.identifier);t&&t.width&&t.userAction?(f[n._sharedOptions.identifier]=t.width,n.maxColWidth<80?(f[n._sharedOptions.identifier]=80,n.resetDisplay(["medium","large"],t.userAction)):e.width-t.width<287&&(f[n._sharedOptions.identifier]=n.maxColWidth,n.resetDisplay(["medium","large"],t.userAction))):(f[n._sharedOptions.identifier]=n.idealLabelWidth+1,n.resetDisplay(["medium","large"]))}})),this.tweakerManager=new i({editable:!0===this._sharedOptions.editMode,onNotification:function(e){n.publishEvt("onNotifications",e)}},this._sharedOptions),this._manageEditionStatus(),!0===this.options.automaticCSS&&this.updateCSS()},updateCSS:function(){var e=v(this.options.classnames,this.options.sizeClassname,this._sharedOptions.identifier);this._publishResizeCell(e)},_publishResizeCell:function(e){var t=null;e&&((t=function(e,t,i){var n={};return e.forEach((function(e){var s=m(e,i);t===e&&(s.current=!0),n[e]=s})),n}(this.options.classnames,this.options.sizeClassname,this._sharedOptions.identifier)).userAction=e.userAction),this.publishEvt("onResizeCells",t)},updateResizeLimit:function(){var e=this;e.fields&&e.fields.length&&(e.idealLabelWidth=0,e.fields.forEach((function(t){t.elements.flexLine.getElementsByClassName("formLabel")[0].setStyles({width:"auto"});var i=t.elements.flexLine.getElementsByClassName("formLabel")[0].getSize();i&&i.width&&e.idealLabelWidth<i.width&&(e.idealLabelWidth=i.width),t.elements.flexLine.getElementsByClassName("formLabel")[0].setStyles({width:""})})))},resetDisplay:function(e,t){var i=e||this.options.classnames;i||(i=[this.getClassResize()]);var n=this;i.forEach((function(e){var i=p(e,n._sharedOptions.identifier,t),a=e+"_style"+(n._sharedOptions.identifier?"_"+n._sharedOptions.identifier:"");s.addNewStyles(a,i.style,!0)})),this._publishResizeCell(null)},getClassResize:function(){return this.options.sizeClassname},_manageEditionStatus:function(){var e=!1===this.isReadOnly()&&!0===this._sharedOptions.editMode;e?this.elements.container.addClassName("underEdition"):this.elements.container.removeClassName("underEdition"),this.fields&&Array.isArray(this.fields)&&(!0===e?this.fields.forEach((function(e){!1===e._unitHelperReady&&"function"==typeof e._addUnitsHelper&&e._addUnitsHelper((function(t){t&&(e._unitHelperReady=!0)})),!0===e._unitHelperReady&&e.elements&&e.elements.infoContainer&&e.elements.infoContainer.hasClassName("hide")&&e.elements.infoContainer.removeClassName("hide")})):this.fields.forEach((function(e){e.elements&&e.elements.infoContainer&&!e.elements.infoContainer.hasClassName("hide")&&e.elements.infoContainer.addClassName("hide")}))),this.tweakerManager.switchMode(e)},destroy:function(){this.clear(),this.fields.forEach((function(e){e.destroy()})),this._parent.apply(this,arguments)},switchTweakersStatus:function(){this._manageEditionStatus()},_clearAllFields:function(){this.tweakerManager.clear()},_actionOnScroll:function(){this.tweakerManager.actionOnScroll()},clear:function(){this._clearAllFields(),this.elements.content.empty()},setModel:function(e,t){var i=this;this.clear();var n=null!=t&&t.attrs?t.attrs:e.getAllAttributes(),a=[];for(var r in n){var o=n[r];o instanceof c&&a.push(o)}a.sort((function(e,t){return s.compareValue(t.get("positionUI"),e.get("positionUI"))})),a.forEach((function(t){i._addLine(e,t)}))},_addLine:function(e,t){this.options.readOnly=this.isReadOnly();var i=new _(this,e,t,this.options);this.fields.push(i),i.inject(this.elements.content)},toggleLineById:function(e,t){if(this.fields){var i=this.fields.find((t=>t._idAttr===e));if(i)return i.getContent().toggle(t),!0}},disableInputFields:function(e=!0){this.fields&&this.fields.forEach((t=>{UWA.is(t._tweaker.disableUserInput,"function")&&t._tweaker.disableUserInput(e)}))},focusLine:function(e){this.fields[e].focusTweakerElement()},updateField:function(e,t){var i=this;this.fields&&Object.keys(e).forEach((n=>{var s=e[n];if(s){let d=i.fields.findIndex((e=>e._idAttr===n||e._model.get(e._idAttr).name===n));var a=i.fields[d];if(a){var r=a._model.get(a._idAttr);if(r){if(UWA.is(s.readOnly)&&(r.set("readOnly",s.readOnly),a._tweaker.options.readOnly=s.readOnly,a._tweaker.switchMode(!s.readOnly)),UWA.is(s.authorizedValues)&&(r.set("authorizedValues",s.authorizedValues),r.set("authorizedValuesNLS",s.authorizedValuesNLS?s.authorizedValuesNLS:s.authorizedValues),UWA.is(s.value)&&s.forceValue&&(r.set("value",s.value),r.set("valueDB",s.value)),a=i._rebuildLine(a,d)),UWA.is(s.value)){var o=r.get("authorizedValues");if(!UWA.is(o)||!o.length||o.includes(s.value)){r.set("value",s.value),r.set("valueDB",s.value),a._model.set(r.getIdentifier(),r,{silent:!0});var l=a._model.getChangedValues();l||(l={}),l[r.getIdentifier()]=r,a._model.setChangedValues(l);var c=a._form.tweakerManager._getValueForTweaker(r.tw_type,r);a._tweaker.setValue(c)}}UWA.is(s.disable)&&(r.set("disable",s.disable),a._tweaker.disableUserInput(s.disable)),UWA.is(s.visible)&&(r.set("visible",s.visible),a.getContent().toggle(s.visible)),UWA.is(s.notif,"object")&&UWA.is(s.notif.sev,"number")&&(1==s.notif.sev?r.setUXBLError(s.notif.msg,"error"):r.resetUXBLError(),a._manageMessage()),UWA.is(s.error,"object")&&s.error.msg&&a.showNotificationOnField({type:"error",message:s.error.msg})}}else if(t){var u=t.getAttributeFromField("path",n)[0];u&&(u.set("valueDB",e.value),t.set(e.name,u,!1))}}}))}});return b})),define("DS/ClassificationProp/ajaxRequests/ClassifPropAjaxRequests",["DS/ClassificationProp/ajaxRequests/3DSpaceAjaxRequests","DS/ClassificationProp/ajaxRequests/FederatedAjaxRequests","DS/ClassificationProp/constants/ConstantsMapping","i18n!DS/ClassificationProp/assets/nls/langEditProp"],(function(e,t,i,n){"use strict";var s={checkFacetsVisibility:"_getDefaultFacetsVisibility"},a=i.getSupportedServices(),r=a["3dspace"];r&&(r.service=e);var o=a.fedsearch;return r&&(o.service=t),{_getAjaxService:function(e,t,s){var a=null;i.getSupportedServices();if(s)a=s;else if(e&&e.length>0){var r=e[0];a=i.getServiceForModel(r)}a?a.service?t.call(null,a,e):require([a.require],(function(i){a.service=i,t.call(null,a,e)})):t.call(null,{name:n.get("Unknown")},e)},_onSourceUnavailable:function(e,t){var i={message:n.replace(n.get("sourceUnavailable"),{label:"SourceName",value:t}),code:"SU"};e.onComplete.call(null,{success:!1,error:i})},_callMethodOnSource:function(e,t){var i=this,n=e.modelList;!Array.isArray(n)&&e.model&&(n=[e.model]),this._getAjaxService(n,(function(n,a){var r=n.service;if(r&&"function"==typeof r[t])r[t].call(r,e);else{var o=!0;a.forEach((function(e){o=o&&e.get("isTransient")}));var l=s[t];o&&l?i[l].call(i,e):i._onSourceUnavailable(e,n.name)}}),e.defService)},commitModels:function(e){this._callMethodOnSource(e,"commitModels")},getPreviewUrl:function(e){this._callMethodOnSource(e,"getPreviewUrl")},getHistory:function(e){this._callMethodOnSource(e,"getHistory")},checkFacetsVisibility:function(e){this._callMethodOnSource(e,"checkFacetsVisibility")},getListOfAttributes:function(e){this._callMethodOnSource(e,"getListOfAttributes")},getClassificationAttributes:function(e){this._callMethodOnSource(e,"getClassificationAttributes")},_getDefaultFacetsVisibility:function(e){var t=e.model.get("objectId");e.onComplete.call(null,{id:t,facets:{classificationAttiProp:!0}})}}})),define("DS/ClassificationProp/form/FormOrganizer",["DS/ClassificationProp/models/CommonAbstract","DS/ClassificationProp/models/ClassifPropAttributeModel","DS/WidgetServices/WidgetServices","DS/ClassificationProp/form/Form"],(function(e,t,i,n){var s=e.extend({_sharedOptions:null,init:function(e,t){this._parent(e),this._display=null,this._sharedOptions=t,this._forms=[],this.elements.container=UWA.createElement("div",{class:"ClassifAttformOrganizer "+(this.options.className?this.options.className:"")})},destroy:function(){this.clear(),this._parent.apply(this,arguments)},clear:function(){this._forms.forEach((function(e){e.destroy()})),this._forms=[]},_callOnForms:function(e,t){this._forms.forEach((function(i){i[e].apply(i,t)}))},setModel:function(e,t){var i=e.getAllAttributes();this.setAttributes(e,i,t)},setAttributes:function(e,s,a){var r=this;this.clear();var o={},l=[];for(var c in s){var u=s[c];if(u instanceof t&&!0!==u.isTransient){var d=u.get("form");d||(d="DSDefault");var h=o[d];if(!h){var f=a?a[d]:null;h={list:[],name:d},f&&(h.group=f,void 0!==f.position&&(h.position=f.position)),l.push(h),o[d]=h}h.list.push(u)}}l.sort((function(e,t){n=null;var n=void 0===e.position&&void 0!==t.position?1:null;return n=null===(n=null===(n=null===n&&void 0===t.position&&void 0!==e.position?-1:n)&&void 0!==t.position&&void 0!==e.position?e.position-t.position:n)?i.compareValue(t.name,e.name):n}));var p=++window.top.perfoIncrem;window.top.performance.mark("start_buildForm:"+p),l.forEach((function(t){var i=UWA.clone(r.options);if(t.group)for(var s in t.group)i[s]=t.group[s];i.automaticCSS=!1;var a=new n(i,r._sharedOptions);a.setModel(e,{attrs:t.list}),a.inject(r.elements.container),r._forms.push(a)})),r._forms.length>0&&r._forms[0].updateCSS(),window.top.performance.mark("end_buildForm:"+p)},focusLine:function(e,t){var i=this;setTimeout((function(){i._forms[e].focusLine(t)}),0)},toggleFormLine:function(e,t){this._forms&&this._forms.forEach((function(i){i.toggleLineById(e,t)}))}});return s})),define("DS/ClassificationProp/form/FormSections",["DS/ClassificationProp/models/CommonAbstract","DS/ClassificationProp/models/ClassifPropAttributeModel","DS/ClassificationProp/form/FormOrganizer","DS/ClassificationProp/comm/EventManager","DS/WidgetServices/WidgetServices","DS/UIKIT/Accordion","DS/Controls/Accordeon","DS/ClassificationProp/constants/ClassifPropConstants","i18n!DS/ClassificationProp/assets/nls/langEditProp"],(function(e,t,i,n,s,a,r,o,l){var c=o.ACCORDION.ATTRIBUTES,u=l.get("accordion_attributes"),d=l.get("accordion_parameters"),h=new Map,f=(new Map,e.extend({_sharedOptions:null,defaultOptions:{showSections:!0,sizeClassname:"large"},init:function(e,t){var i=this;this._parent.apply(this,arguments),this.options.classnames=["large","medium","small"],this.openedExpanderItemIndex=[],this._sharedOptions=t,i.elements.accordion=new r({items:[],style:"simple",exclusive:!1}),i.accordeonClassIDandDataMap=new Map,i.elements.accordion.getContent().addEventListener("expand",(function(e){n.publish("onClassificationTableOpen",e.options.expanderTarget.domId);var t={expanderItem:e,action:"opened"};i.getIndexesOfOpenedOrSelectedAccordeonItems(t)})),i.elements.accordion.getContent().addEventListener("collapse",(function(e){var t={expanderItem:e,action:"closed"};i.getIndexesOfOpenedOrSelectedAccordeonItems(t)})),this.elements.container=UWA.createElement("div",{class:this._getDefaultClassname()+" "+this.options.sizeClassname}),this.elements.container.addEvent("resize",(function(){console.log("resize section")})),i.elements.accordion.inject(this.elements.container),this.subscribeEvt("switchDisplay",(function(e){i._switchDisplay(e)||i.publishEvt("innerSwitch",i.options.sizeClassname)})),this.subscribeEvt("switchWrap",(function(){i._switchWrap()})),this.elements._organizers={},this._accordionProperties=[],this._openedSections=[]},_switchWrap:function(){this.options.titleWrap?this.elements.container.removeClassName("formWrap"):this.elements.container.addClassName("formWrap"),this.options.titleWrap=!this.options.titleWrap},_getDefaultClassname:function(){var e="";return s.isTouchDevice()&&(e="touchDevice "),!0===this.options.titleWrap&&(e+="formWrap"),"ClassifAttFormSections "+e},_switchDisplay:function(e){var t=this._display===e;return t||(this._display=e,this._checkSize()),t},_checkSize:function(){var e=this.elements.container.getSize().width,t=this._getDefaultClassname();(null===this._display&&e<500||"s"===this._display)&&(this.options.sizeClassname="small"),(null===this._display&&e<1e3&&e>500||"m"===this._display)&&(this.options.sizeClassname="medium"),(null===this._display&&e>1e3||"l"===this._display)&&(this.options.sizeClassname="large"),t+=this.options.sizeClassname,this.elements.container.className=t},inject:function(){var e=this;this._parent.apply(this,arguments),setTimeout((function(){e._checkSize()}))},getOrganizers:function(){return this.elements._organizers},setAccordionProperties:function(e){this._accordionProperties=e},_callOnOrganizers:function(e,t){for(var i in this.elements._organizers){var n=this.elements._organizers[i];n[e].apply(n,t)}},openSections:function(e){var t=this;e.forEach((function(e){t.openSection(e)}))},openSection:function(e){var t=this.findExpanderIndexFromId(e);-1!=t&&this.elements.accordion.expandItem(t)},destroy:function(){this.clear(),this._parent.apply(this,arguments)},clear:function(){this.reset()},setModel:function(e,i){var n=this;this.clear(),this._model=e,this._groups=i;var a=e.getAllAttributes(),r={},o=[];for(var l in a){var h=a[l];if(h instanceof t&&!0!==h.isTransient){var f,p=h.get("facet"),m=h.get("section"),g=h.get("extension");p=p||m,(n.options.showSections||p===d)&&(f=p||c);var v=r[f];if(!v){var _=n._accordionProperties[f];if(!((_=_||{})&&_.name&&_.nameNLS&&_.icon)){var C=n._accordionProperties[g];C&&(_.icon=C.icon),_.name=f,_.nameNLS=m||(f===c?u:f)}n._accordionProperties[f]=_,"Default"!==h.group&&(_.name=h.group,_.nameNLS=h.groupNLS,_.weight=h.groupWeight),_.weight||(_.weight=0),v={list:[],name:f,section:_},o.push(v),r[f]=v}v.list.push(h)}}o.sort((function(e,t){var i=e.section.weight===t.section.weight?null:e.section.weight<t.section.weight?1:-1;return i=null===i?s.compareValue(t.name,e.name):i}));var S=++window.top.perfoIncrem;window.top.performance.mark("start_buildSections:"+S),o.forEach((function(e){n.addSection(e)})),window.top.performance.mark("end_buildSections:"+S),this.openSections(this._openedSections)},addSection:function(e,t){var i=e.section,n=i,s=i;if("object"==typeof i&&(n=i.name),t){var a=this.findExpanderIndexFromId(n);if(!!this.elements.accordion.getExpanderFromIndex(a))return}var r=this._accordionProperties[n],o=null;r&&(t||r.nameNLS&&(s=r.nameNLS),r.icon&&(o="classif"===r.icon?UWA.createElement("span",{class:"fonticon fonticon-flow-tree",title:l.get("EP_icon_classification")}):UWA.createElement("img",{src:r.icon,width:"10px"})));var c=UWA.createElement("span",{text:s});o&&o.inject(c);var u=s?s.replace(/ /g,"_"):"";this._addSection({expandedFlag:s!==d&&this.options.sectionAutoexpand,name:n,attrs:e.list,title:c,orgClassName:"formSection_"+u})},reset:function(){},_addSection:function(e){var t=this;if(e&&e.name){var n=e.name,s=this.elements._organizers[n];if(!s){var a=UWA.clone(this.options);a.className=e.orgClassName,s=new i(a,this._sharedOptions),this.elements._organizers[n]=s,e.content=s.getContent(),t.elements.accordion.addItem(e);var r=t.elements.accordion.items.indexOf(e),o=t.elements.accordion.getExpanderFromIndex(r);o.domId=e.name,e.title&&e.title.textContent&&(o.header=e.title.textContent)}s.setAttributes(this._model,e.attrs,this._groups),s.classUsage=this._accordionProperties[n].classUsage,t.accordeonClassIDandDataMap.set(e.name,s),h.set(e.name,this)}this._manageAccordionVisibility()},_removeSection:function(e){var t=this;if(e){this.elements._organizers;var i=this.findExpanderIndexFromId(e);-1!=i&&(t.elements.accordion.deleteItem(i),delete this.elements._organizers[e]),h.has(e)&&h.delete(e),t.accordeonClassIDandDataMap.has(e)&&t.accordeonClassIDandDataMap.delete(e)}},getFormSections:function(){return h},getAttributeNameAndOrganiserMap:function(){return this},toggleFormOrgLine:function(e,t){var i=this.elements._organizers;if(i)for(var n in i){i[n].toggleFormLine(e,t)}},getAccordeonDataMap:function(){return this.accordeonClassIDandDataMap},_manageAccordionVisibility:function(){this.elements.accordion.items.length<=1||2==this.elements.accordion.items.length&&this._showAccordion()},_hideAccordion:function(){var e=this,t=e.elements.accordion.getExpanderFromIndex(0);if(t){var i=e.elements.accordion.elements.container.parentElement,n=this.elements._organizers[t.domId];i&&n.inject(i)}e.elements.accordion.hide()},_showAccordion:function(){var e=this.elements.accordion.getExpanderFromIndex(0);e&&this.elements._organizers[e.domId].inject(e.elements.bodyContainer);this.elements.accordion.show()},findExpanderIndexFromId:function(e){for(var t=0;t<this.elements.accordion._expanderItems.length;t++)if(this.elements.accordion._expanderItems[t].domId===e)return t;return-1},getIndexesOfOpenedOrSelectedAccordeonItems:function(e){var t=this,i=e.expanderItem.options.expanderTarget.domId,n=e.action;if("opened"===n){for(var s=0;s<t._openedSections.length;s++)if(i&&t._openedSections[s]===i)return;i&&t._openedSections.push(i)}else if("closed"===n){var a=t._openedSections.filter((e=>e!==i));t._openedSections=a}}}));return f})),define("DS/ClassificationProp/facets/Properties/PropertiesInfo",["UWA/Class","DS/ClassificationProp/models/CommonAbstract","UWA/Json","UWA/Array","DS/WidgetServices/WidgetServices","DS/ClassificationProp/utils/ClassifPropControl","DS/ClassificationProp/form/FormSections","DS/ClassificationProp/comm/EventManager","DS/ClassificationProp/facets/Properties/ClassifPropBase","DS/ClassificationProp/facets/Properties/ClassifPropUIController","DS/ClassificationProp/constants/ClassifPropConstants","DS/ClassificationProp/models/ClassifPropAttributeModel","DS/UIKIT/Input/Button","DS/UIKIT/Scroller","DS/WidgetServicesUI/tweakers/TweakerWUXButton","css!DS/ClassificationProp/ClassificationProp.css","i18n!DS/ClassificationProp/assets/nls/langEditProp"],(function(e,t,i,n,s,a,r,o,l,c,u,d,h,f,p,m,g){"use strict";g.get("accordion_attributes"),g.get("accordion_parameters");var v=new Map,_=new Map,C=new Map,S=new Map,b=null;window.top.perfoIncrem=window.top.perfoIncrem?window.top.perfoIncrem:0;var E=function(e){Date.now()},y=function(){this._switchEditionMode(!0)},A=function(){this._firstModel&&this.dispatchEvent("onTitleChanged",this._firstModel.get("label"))},I=function(){this._ManageValidButton()},T=e.extend(t,l,{_previousScrollerPosition:null,defaultOptions:{setRefreshButton:!1,setValidButton:!1,setCloseButton:!1,setEditButton:!1,showTopBar:!1,editMode:!0,showSections:!0,sectionAutoexpand:!0,readOnly:!1,scroller:!1,displayType:u.STANDARD,updateSession:!1},init:function(e){this._parent.apply(this,arguments),this.wiwListModels=null,this.handlerTouchEnd=E.bind(this),this.handlerDblClick=null,this.handlerAttributeChanged=I.bind(this),this.handlerLabelChanged=A.bind(this),this._firstModel=null,this._previousScrollerPosition=null,this.lastPointedTableCellObj=null,this._sharedOptions.editMode=!0===e.editMode,this._sharedOptions.identifier=e.identifier,e.webUxTweakers&&(this.webUxTweakers=e.webUxTweakers),e.propertiesWidgetUI&&(this.propertiesWidgetUI=e.propertiesWidgetUI),this.elements.UIController=new c([]),this.isReadOnly=this.isReadOnly();var t=this;this.subscribeEvt("onResizeCells",this._onCellResized.bind(this)),this.subscribeEvt("onNotifications",(function(e){t.setError(e)})),this.isPLMNew=e.isPLMNew,this.isInformationPanel=e.isInformationPanel,this.initUI()},_onCellResized:function(e){var t=null,i=!1;if(e){var n=e.medium;i=!0!==(t=n&&!0===n.current?n:e.large).current}var s=!1;if(!i){var a=u.MIN_WIDTH_FOR_TABLE;e&&(a=parseInt(t.width)),s=u.VARIABLES.minWidthForTable!==a,u.VARIABLES.minWidthForTable=a}e&&!0===s&&this.dispatchEvent("refreshActions"),this._updateUI()},setAccordionProperties:function(e){this.elements.formSection.setAccordionProperties(e)},getAccordeon:function(){return[this.elements.formSection,null]},getClassTitleFromID:function(e){return v.get(e)},setClassIDandTitle:function(e,t){v.set(e,t)},removeClassIdandTilefromMap:function(e){v.delete(e)},isReadonly:function(){return!1!==this.isReadOnly},clear:function(){this._clearAllFields()},_clearAllLine:function(){this.elements.formSection.clear()},_getModel:function(e){return this.elements.UIController.getModel(e)},getClassPath:function(e){return _.get(e)},setClassPath:function(e){_=e},getExistingClassAttributes:function(e){return C.get(e)},setExistingClassAttributes:function(e){C=e},setClassUsage:function(e){S=e},getClassUsage:function(e){return S.get(e)},setIsInformationPanel:function(e){b=e},getIsInformationPanel:function(e){return b},initData:function(e,t){this.resetUIValues(),this.elements.UIController.setModels([]),this._clearAllLine();var i=this._sharedOptions.editMode;if(t)switch(t.edition){case u.FORCE_READWRITE:i=!0;break;case u.FORCE_READONLY:i=!1;break;case u.FORCE_DEFAULT:i=!0===this.options.editMode}if(this._sharedOptions.editMode!==i&&this._switchEditionMode(),!0===this.options.updateSession){if("undefined"!=typeof dscef){this.wiwListModels=e;var n=e[0]._attributes,s=[];for(var a in n){if(null!=n[a]){var r=n[a].value,o=n[a].valueDB,l=n[a].readOnly;null!=r&&null!=l&&null!=o&&s.push({attribute:a,value:n[a].value,valueDB:n[a].valueDB,readOnly:n[a].readOnly})}}var c=JSON.stringify(s);dscef.sendString('{"operation":"getData","operationVersion":"1.0","attributes":'+c+"}")}}else this.addData(e)},addData:function(e){this._addData(e)},changeAttributes:function(e){var t=JSON.parse(e);if(null!=this.wiwListModels&&null!=e){for(var i=0;i<t.attributes.length;i++){var n=t.attributes[i],s=n.attribute,a=n.value,r=n.valueDB,o=n.readOnly;null!=a&&null!=r&&null!=o&&(this.wiwListModels[0]._attributes[s].value!=a&&(this.wiwListModels[0]._attributes[s].value=a,this.wiwListModels[0]._attributes[s].initialsValues.value=a),this.wiwListModels[0]._attributes[s].valueDB!=r&&(this.wiwListModels[0]._attributes[s].valueDB=r,this.wiwListModels[0]._attributes[s].initialsValues.valueDB=r),this.wiwListModels[0]._attributes[s].readOnly!=o&&(this.wiwListModels[0]._attributes[s].readOnly=o))}this.addData(this.wiwListModels)}},_getScrollerContent:function(){return this.elements.scroller?this.elements.scroller.elements.content:null},_scrollIsBottom:function(e){var t=!1;if(e){var i=e.scrollHeight,n=e.getDimensions();t=0!==e.scrollTop&&e.scrollTop>i-n.height}return t},_getScrollerPosition:function(){var e=this._getScrollerContent();return e?this._scrollIsBottom(e)?-1:e.scrollTop:null},_setScrollerPosition:function(e){var t=this._getScrollerContent();t&&(t.scrollTop=-1===e?t.scrollHeight:e)},_saveScrollerPosition:function(){this._previousScrollerPosition=this._getScrollerPosition()},_restoreScrollerPosition:function(){null!==this._previousScrollerPosition&&this._setScrollerPosition(this._previousScrollerPosition),this._previousScrollerPosition=null},onResize:function(){},_addData:function(e){var t=++window.top.perfoIncrem;window.top.performance.mark("start_LoadUI:"+t);var i=this;this._ManageValidButton(!1),null!=e&&e.length>0&&this.elements.UIController.setModels([e[0]]);var n=this.elements.UIController.getModels();if(n.length<=0)this._clearAllLine();else{var s=n[0];this._firstModel=s,s.addEvent("onChange:label",this.handlerLabelChanged),s.addEvent("onChange",this.handlerAttributeChanged),this.updateTableManager(),this.onResize(),this._ManageValidButton(),this.endOfLoad()}window.top.performance.mark("end_LoadUI:"+t),this.dispatchEvent("onChangeSize"),this.dispatchEvent("onTitleChanged"),this.elements.UIController.validateModels(this.elements.UIController.getModels()),setTimeout((function(){i._restoreScrollerPosition(),window.top.performance.mark("end_EP_FullTime")})),this.elements.formSection._manageAccordionVisibility()},endOfLoad:function(){var e=this;this.dataLoadedOnce||setTimeout((function(){e.dataLoadedOnce=!0,e.dispatchEvent("onDataLoaded")}),0)},_isCloseButton:function(){return u.isCloseButton(this.options.displayType)},show:function(){this.getUI().show()},setOption:function(e,t){this._parent.apply(this,arguments),this.elements.formSection.options[e]=t},resetDisplay:function(){this.publishEvt("resetDisplay")},initUI:function(){var e=++window.top.perfoIncrem;window.top.performance.mark("start_EP_InitUI:"+e);var t=this;this.elements.mainDiv=this.elements.container=UWA.createElement("div",{class:"EditProp_MainContain includeMenuBar"}),!0!==this.isReadOnly&&!0===this._sharedOptions.editMode||this.elements.container.addClassName("EP_ReadOnly");var i=this.elements.containerProperties=UWA.createElement("div",{class:"ClassifAtt_Container"}),n=this.elements.containerAccordeon=UWA.createElement("div",{class:"ClassifAtt_Scroller"});o.subscribe("onClassificationTableOpen",(function(e){t._saveScrollerPosition()})),t.elements.formSection=new r({postBuild:!0,sectionAutoexpand:this.options.sectionAutoexpand,showSections:this.options.showSections,eventThread:this.options.eventThread},this._sharedOptions),t.elements.formSection.isInformationPanel=this.isInformationPanel,this.elements.formSection.inject(n),o.subscribe("onAttributeUpdate",(function(e,i,n){if(a.getInformationPanel()){var s=t.elements.formSection.getAccordeonDataMap(),r=e.extension;if(e&&s)for(let[t,a]of s){let o=t+"-"+e.name,l=t,c=null,u=null,d=null;if(u=a._forms[0].tweakerManager,u){let t=u._getOrCreateField(o,!0);t&&(d=t.field,d&&0!=Object.keys(d).length&&(c=u._getValueForTweaker(e.tw_type,e),n&&(c=e.oldValueDB,l==r&&(0==u.updateAttributeData.isInProgress&&(u.updateAttributeData.isInProgress=!0),u._updateValue(i,e,e.oldValue,e.oldValueDB),d.setValue(c))),l!=r&&"Definition"==e.classUsage&&"Definition"==s.get(l).classUsage&&(0==u.updateAttributeData.isInProgress&&(u.updateAttributeData.isInProgress=!0),d.setValue(c))))}}}})),n.setStyle("overflow-y","auto"),n.inject(i);var l=this.elements.bottomTable=UWA.createElement("div",{class:"Classif_BottomTableContainer"}),c="true"===s.getWidgetValue(u.COLLAPSE_IC_PREFERENCE.name)&&this.options.typeOfDisplay===u.ALL;null!==c&&!0!==c||s.setWidgetValue(u.COLLAPSE_IC_PREFERENCE.name,"true");var d=this.elements.containerMainTable=UWA.createElement("div",{class:"ClassifTableContainer "}).inject(l);i.inject(d),l.inject(this.elements.container),!0===this.options.showTopBar&&this.ManageButtonDiv.inject(t.elements.container),this.elements.formSection._manageAccordionVisibility(),window.top.performance.mark("end_EP_InitUI:"+e),this.elements.container.addEvent("resize",this._updateUI.bind(this))},getUpdatedValueForAttribute:function(e){var t=this.elements.formSection.getAccordeonDataMap();if(t)for(let[n,s]of t){let t=n+"-"+e;var i=null;let a=null,r=null,o=null,l=null;if(r=s._forms[0].tweakerManager,r&&(l=r._getOrCreateField(t,!0),l&&(a=l.model.getChangedValues()[t],o=l.field,a&&o&&0!=Object.keys(o).length)))return i=r._getValueForTweaker(a.tw_type,a),"date_wux"==a.tw_type?a.valueDB:i}},_updateUI:function(){var e=this.elements.container.getSize();e.width&&e.width<381?this.publishEvt("switchDisplay","s"):this.publishEvt("switchDisplay","m")},getAccordeonFromID:function(e){return this.elements.formSection.getFormSections().get(e)},getUI:function(){return this.elements.container},getclassAndAttributeNameMap:function(){return classAndAttributeNameMap},resetUIValues:function(){this.elements.formSection&&this.elements.formSection.reset()},getComponentMode:function(){return!0===this.options.updateSession||this.isReadOnly},switchComponentMode:function(e){this.isReadOnly=e,this.handlerDblClick&&this.elements.container.removeEvent("dblclick",this.handlerDblClick),this.handlerDblClick=null,!0!==e&&(this.handlerDblClick=y.bind(this),this.elements.container.addEvent("dblclick",this.handlerDblClick))},addSection:function(){this.elements.formSection.addSection.apply(this.elements.formSection,arguments)},_switchEditionMode:function(e){var t=!1;if(e!==(!1===this.isReadOnly&&!0===this._sharedOptions.editMode)){if(!1===this.isReadOnly)if(this._sharedOptions.editMode){if(this.elements.UIController.getModifiedModels().length>0){var i=g.get("Some attributes are in edition. Please valid or cancel the modifications to switch");return this._isCloseButton()&&(i=g.get("Some attributes are in edition. Please valid or refresh to switch")),void this.addWarning(i)}this._sharedOptions.editMode=!1,this._activateAddingButton(!1)}else this._sharedOptions.editMode=!0,this._activateAddingButton(!0);else this._sharedOptions.editMode=!1;t=!0}return t&&this.publishEvt("editionSwitched",this._sharedOptions.editMode),!0!==this._sharedOptions.editMode?this.elements.container.addClassName("EP_ReadOnly"):this.elements.container.removeClassName("EP_ReadOnly"),s.setWidgetValue("editProperties_editMode",this._sharedOptions.editMode),t},_switchEdition:function(e){this._switchEditionMode(e)&&this.onResize(),this.lastPointedTableCellObj=null},resizeActionActive:function(){return u.VARIABLES.minWidthForTable!==u.MIN_WIDTH_FOR_TABLE},getOptimalSize:function(){var e=this.elements.masterTable.getSize(),t=this.elements.containerProperties.getSize(),i=e.height-t.height,n=this.elements.formSection.getContent().getSize();return n.height+=i+60,n.width+=30,n},updateTableManager:function(){this._saveScrollerPosition(),this._clearAllLine(),this.updateTable()},updateTable:function(){var e=this;this._clearAllFields(),this._clearAllLine(),e.modelIdentityCard&&(e.modelIdentityCard.set("title",""),e.modelIdentityCard.set("ownerName",""),e.modelIdentityCard.set("date",""),e.modelIdentityCard.set("description",""));var t=this.elements.UIController.getModels(),i=t.length,n=++window.top.perfoIncrem;window.top.performance.mark("start_addInForm:"+n);for(var s=0;s<i;s++){var a=t[s];this.webUxTweakers&&(a.webUxTweakers=this.webUxTweakers),this.propertiesWidgetUI&&(a.propertiesWidgetUI=this.propertiesWidgetUI),a.newInfraUI=!0,this.elements.formSection.setModel(a)}window.top.performance.mark("end_addInForm:"+n),this._restoreScrollerPosition(),setTimeout((function(){e.publishEvt("triggerPostBuild")}))},saveIsNeeded:function(){var e=!0;return this.elements.UIController.getModifiedModels().every((function(t){var i=t.previousAttributes();for(var n in"function"==typeof t.getChangedValues&&(i=t.getChangedValues()),i){var s=i[n];if(s instanceof d&&!1===s.isTransient){e=!1;break}}return!1!==e})),!e},validateModel:function(e){var t=!1,i=null;if((i=e||this.elements.UIController.getModifiedModels()).length>0){var n=this.elements.UIController.validateModels(i);n?(n.message=g.get("Modification failed")+":"+n.message,this.setError(n)):t=!0}return this._ManageValidButton(),t},_valueIsChanging:function(e,t){this._ManageValidButton();var i={value:t,valueDB:e.get("valueDB")};e.isSameValueSet(i)&&this._activateValidButton()},_activateAddingButton:function(e){this.dispatchEvent("onAddActivation",e)},_activateValidButton:function(e){var t=!e;this.elements.boutonCancel&&(t?this.elements.boutonCancel.show():this.elements.boutonCancel.hide()),this.dispatchEvent("onValidActivation",t)},_ManageValidButton:function(){this._activateValidButton(!this.saveIsNeeded())},getButtons:function(){return this.ManageButtonDiv},getTitle:function(){var e="";return this.elements.UIController&&(e=this.elements.UIController.getLabel()),e},showNotification:function(e){this.addSuccess(e)},setError:function(e){var t=this;if(n.isArray(e))e.forEach((function(e){var i=e&&e.customClass?e.customClass:null;t._manageError(e,i)}));else{var i=e&&e.customClass?e.customClass:null;t._manageError(e,i)}},_manageError:function(e,t){if(e)switch(e.eventID?e.eventID:"error"){case"warning":this.addWarning(e.message?e.message:e,t);break;case"success":this.addSuccess(e.message?e.message:e,t);break;default:this.addError(e,t)}},addWarning:function(e,t){this.dispatchEvent("onNotification",{msg:e,eventID:"warning",customClass:t})},addSuccess:function(e,t){this.dispatchEvent("onNotification",{msg:e,eventID:"success",customClass:t})},addInfo:function(e,t){this.dispatchEvent("onNotification",{msg:e,eventID:"info",customClass:t})},addError:function(e,t){this.dispatchEvent("onNotification",{msg:e.message?e.message:i.encode(e),eventID:"error",customClass:t})}});return T})),define("DS/ClassificationProp/facets/Properties/Properties",["UWA/Class","DS/ClassificationProp/models/CommonAbstract","UWA/Json","UWA/Array","DS/WidgetServices/WidgetServices","DS/ClassificationProp/utils/ClassifPropControl","DS/ClassificationProp/form/FormSections","DS/ClassificationProp/comm/EventManager","DS/ClassificationProp/facets/Properties/ClassifPropBase","DS/ClassificationProp/facets/Properties/ClassifPropUIController","DS/ClassificationProp/constants/ClassifPropConstants","DS/ClassificationProp/models/ClassifPropAttributeModel","DS/UIKIT/Input/Button","DS/UIKIT/Scroller","DS/WidgetServicesUI/tweakers/TweakerWUXButton","css!DS/ClassificationProp/ClassificationProp.css","i18n!DS/ClassificationProp/assets/nls/langEditProp"],(function(e,t,i,n,s,a,r,o,l,c,u,d,h,f,p,m,g){"use strict";g.get("accordion_attributes"),g.get("accordion_parameters");var v=new Map,_=new Map,C=new Map,S=new Map,b=null;window.top.perfoIncrem=window.top.perfoIncrem?window.top.perfoIncrem:0;var E=function(e){Date.now()},y=function(){this._switchEditionMode(!0)},A=function(){this._firstModel&&this.dispatchEvent("onTitleChanged",this._firstModel.get("label"))},I=function(){this._ManageValidButton()},T=e.extend(t,l,{_previousScrollerPosition:null,defaultOptions:{setRefreshButton:!1,setValidButton:!1,setCloseButton:!1,setEditButton:!1,showTopBar:!1,editMode:!0,showSections:!0,sectionAutoexpand:!0,readOnly:!1,scroller:!1,displayType:u.STANDARD,updateSession:!1},init:function(e){this._parent.apply(this,arguments),this.wiwListModels=null,this.handlerTouchEnd=E.bind(this),this.handlerDblClick=null,this.handlerAttributeChanged=I.bind(this),this.handlerLabelChanged=A.bind(this),this._firstModel=null,this._previousScrollerPosition=null,this.lastPointedTableCellObj=null,this._sharedOptions.editMode=!0===e.editMode,this._sharedOptions.identifier=e.identifier,e.webUxTweakers&&(this.webUxTweakers=e.webUxTweakers),e.propertiesWidgetUI&&(this.propertiesWidgetUI=e.propertiesWidgetUI),this.elements.UIController=new c([]),this.isReadOnly=this.isReadOnly();var t=this;this.subscribeEvt("onResizeCells",this._onCellResized.bind(this)),this.subscribeEvt("onNotifications",(function(e){t.setError(e)})),this.initUI()},_onCellResized:function(e){var t=null,i=!1;if(e){var n=e.medium;i=!0!==(t=n&&!0===n.current?n:e.large).current}var s=!1;if(!i){var a=u.MIN_WIDTH_FOR_TABLE;e&&(a=parseInt(t.width)),s=u.VARIABLES.minWidthForTable!==a,u.VARIABLES.minWidthForTable=a}e&&!0===s&&this.dispatchEvent("refreshActions"),this._updateUI()},setAccordionProperties:function(e){this.elements.formSection.setAccordionProperties(e)},getAccordeon:function(){return[this.elements.formSection,null]},getClassTitleFromID:function(e){return v.get(e)},setClassIDandTitle:function(e,t){v.set(e,t)},removeClassIdandTilefromMap:function(e){v.delete(e)},isReadonly:function(){return!1!==this.isReadOnly},clear:function(){this._clearAllFields()},_clearAllLine:function(){this.elements.formSection.clear()},_getModel:function(e){return this.elements.UIController.getModel(e)},getClassPath:function(e){return _.get(e)},setClassPath:function(e){_=e},getExistingClassAttributes:function(e){return C.get(e)},setExistingClassAttributes:function(e){C=e},setClassUsage:function(e){S=e},getClassUsage:function(e){return S.get(e)},setIsInformationPanel:function(e){b=e},getIsInformationPanel:function(e){return b},initData:function(e,t){this.resetUIValues(),this.elements.UIController.setModels([]),this._clearAllLine();var i=this._sharedOptions.editMode;if(t)switch(t.edition){case u.FORCE_READWRITE:i=!0;break;case u.FORCE_READONLY:i=!1;break;case u.FORCE_DEFAULT:i=!0===this.options.editMode}if(this._sharedOptions.editMode!==i&&this._switchEditionMode(),!0===this.options.updateSession){if("undefined"!=typeof dscef){this.wiwListModels=e;var n=e[0]._attributes,s=[];for(var a in n){if(null!=n[a]){var r=n[a].value,o=n[a].valueDB,l=n[a].readOnly;null!=r&&null!=l&&null!=o&&s.push({attribute:a,value:n[a].value,valueDB:n[a].valueDB,readOnly:n[a].readOnly})}}var c=JSON.stringify(s);dscef.sendString('{"operation":"getData","operationVersion":"1.0","attributes":'+c+"}")}}else this.addData(e)},addData:function(e){this._addData(e)},changeAttributes:function(e){var t=JSON.parse(e);if(null!=this.wiwListModels&&null!=e){for(var i=0;i<t.attributes.length;i++){var n=t.attributes[i],s=n.attribute,a=n.value,r=n.valueDB,o=n.readOnly;null!=a&&null!=r&&null!=o&&(this.wiwListModels[0]._attributes[s].value!=a&&(this.wiwListModels[0]._attributes[s].value=a,this.wiwListModels[0]._attributes[s].initialsValues.value=a),this.wiwListModels[0]._attributes[s].valueDB!=r&&(this.wiwListModels[0]._attributes[s].valueDB=r,this.wiwListModels[0]._attributes[s].initialsValues.valueDB=r),this.wiwListModels[0]._attributes[s].readOnly!=o&&(this.wiwListModels[0]._attributes[s].readOnly=o))}this.addData(this.wiwListModels)}},_getScrollerContent:function(){return this.elements.scroller?this.elements.scroller.elements.content:null},_scrollIsBottom:function(e){var t=!1;if(e){var i=e.scrollHeight,n=e.getDimensions();t=0!==e.scrollTop&&e.scrollTop>i-n.height}return t},_getScrollerPosition:function(){var e=this._getScrollerContent();return e?this._scrollIsBottom(e)?-1:e.scrollTop:null},_setScrollerPosition:function(e){var t=this._getScrollerContent();t&&(t.scrollTop=-1===e?t.scrollHeight:e)},_saveScrollerPosition:function(){this._previousScrollerPosition=this._getScrollerPosition()},_restoreScrollerPosition:function(){null!==this._previousScrollerPosition&&this._setScrollerPosition(this._previousScrollerPosition),this._previousScrollerPosition=null},onResize:function(){},_addData:function(e){var t=++window.top.perfoIncrem;window.top.performance.mark("start_LoadUI:"+t);var i=this;this._ManageValidButton(!1),null!=e&&e.length>0&&this.elements.UIController.setModels([e[0]]);var n=this.elements.UIController.getModels();if(n.length<=0)this._clearAllLine();else{var s=n[0];this._firstModel=s,s.addEvent("onChange:label",this.handlerLabelChanged),s.addEvent("onChange",this.handlerAttributeChanged),this.updateTableManager(),this.onResize(),this._ManageValidButton(),this.endOfLoad()}window.top.performance.mark("end_LoadUI:"+t),this.dispatchEvent("onChangeSize"),this.dispatchEvent("onTitleChanged"),this.elements.UIController.validateModels(this.elements.UIController.getModels()),setTimeout((function(){i._restoreScrollerPosition(),window.top.performance.mark("end_EP_FullTime")})),this.elements.formSection._manageAccordionVisibility()},endOfLoad:function(){var e=this;this.dataLoadedOnce||setTimeout((function(){e.dataLoadedOnce=!0,e.dispatchEvent("onDataLoaded")}),0)},_isCloseButton:function(){return u.isCloseButton(this.options.displayType)},show:function(){this.getUI().show()},setOption:function(e,t){this._parent.apply(this,arguments),this.elements.formSection.options[e]=t},resetDisplay:function(){this.publishEvt("resetDisplay")},initUI:function(){var e=++window.top.perfoIncrem;window.top.performance.mark("start_EP_InitUI:"+e);var t=this;this.elements.mainDiv=this.elements.container=UWA.createElement("div",{class:"EditProp_MainContain includeMenuBar"}),!0!==this.isReadOnly&&!0===this._sharedOptions.editMode||this.elements.container.addClassName("EP_ReadOnly");var i=this.elements.containerProperties=UWA.createElement("div",{class:"ClassifAtt_Container"}),n=this.elements.containerAccordeon=UWA.createElement("div",{class:"ClassifAtt_Scroller"});o.subscribe("onClassificationTableOpen",(function(e){t._saveScrollerPosition()})),t.elements.formSection=new r({postBuild:!0,sectionAutoexpand:this.options.sectionAutoexpand,showSections:this.options.showSections,eventThread:this.options.eventThread},this._sharedOptions),this.elements.formSection.inject(n),o.subscribe("onAttributeUpdate",(function(e,i,n){if(a.getIsPLMNewCreation()){var s=t.elements.formSection.getAccordeonDataMap(),r=e.extension;if(e&&s)for(let[t,a]of s){let o=t+"-"+e.name,l=t,c=null,u=null,d=null;if(u=a._forms[0].tweakerManager,u){let t=u._getOrCreateField(o,!0);t&&(d=t.field,d&&0!=Object.keys(d).length&&(c=u._getValueForTweaker(e.tw_type,e),n&&(c=e.oldValueDB,l==r&&(0==u.updateAttributeData.isInProgress&&(u.updateAttributeData.isInProgress=!0),u._updateValue(i,e,e.oldValue,e.oldValueDB),d.setValue(c))),l!=r&&"Definition"==e.classUsage&&"Definition"==s.get(l).classUsage&&(0==u.updateAttributeData.isInProgress&&(u.updateAttributeData.isInProgress=!0),d.setValue(c))))}}}})),n.setStyle("overflow-y","auto"),n.inject(i);var l=this.elements.bottomTable=UWA.createElement("div",{class:"Classif_BottomTableContainer"}),c="true"===s.getWidgetValue(u.COLLAPSE_IC_PREFERENCE.name)&&this.options.typeOfDisplay===u.ALL;null!==c&&!0!==c||s.setWidgetValue(u.COLLAPSE_IC_PREFERENCE.name,"true");var d=this.elements.containerMainTable=UWA.createElement("div",{class:"ClassifTableContainer "}).inject(l);i.inject(d),l.inject(this.elements.container),!0===this.options.showTopBar&&this.ManageButtonDiv.inject(t.elements.container),this.elements.formSection._manageAccordionVisibility(),window.top.performance.mark("end_EP_InitUI:"+e),this.elements.container.addEvent("resize",this._updateUI.bind(this))},getUpdatedValueForAttribute:function(e){var t=this.elements.formSection.getAccordeonDataMap();if(t)for(let[n,s]of t){let t=n+"-"+e;var i=null;let a=null,r=null,o=null,l=null;if(r=s._forms[0].tweakerManager,r&&(l=r._getOrCreateField(t,!0),l&&(a=l.model.getChangedValues()[t],o=l.field,a&&o&&0!=Object.keys(o).length)))return i=r._getValueForTweaker(a.tw_type,a),"date_wux"==a.tw_type?a.valueDB:i}},_updateUI:function(){var e=this.elements.container.getSize();e.width&&e.width<381?this.publishEvt("switchDisplay","s"):this.publishEvt("switchDisplay","m")},getAccordeonFromID:function(e){return this.elements.formSection.getFormSections().get(e)},getUI:function(){return this.elements.container},getclassAndAttributeNameMap:function(){return classAndAttributeNameMap},resetUIValues:function(){this.elements.formSection&&this.elements.formSection.reset()},getComponentMode:function(){return!0===this.options.updateSession||this.isReadOnly},switchComponentMode:function(e){this.isReadOnly=e,this.handlerDblClick&&this.elements.container.removeEvent("dblclick",this.handlerDblClick),this.handlerDblClick=null,!0!==e&&(this.handlerDblClick=y.bind(this),this.elements.container.addEvent("dblclick",this.handlerDblClick))},addSection:function(){this.elements.formSection.addSection.apply(this.elements.formSection,arguments)},_switchEditionMode:function(e){var t=!1;if(e!==(!1===this.isReadOnly&&!0===this._sharedOptions.editMode)){if(!1===this.isReadOnly)if(this._sharedOptions.editMode){if(this.elements.UIController.getModifiedModels().length>0){var i=g.get("Some attributes are in edition. Please valid or cancel the modifications to switch");return this._isCloseButton()&&(i=g.get("Some attributes are in edition. Please valid or refresh to switch")),void this.addWarning(i)}this._sharedOptions.editMode=!1,this._activateAddingButton(!1)}else this._sharedOptions.editMode=!0,this._activateAddingButton(!0);else this._sharedOptions.editMode=!1;t=!0}return t&&this.publishEvt("editionSwitched",this._sharedOptions.editMode),!0!==this._sharedOptions.editMode?this.elements.container.addClassName("EP_ReadOnly"):this.elements.container.removeClassName("EP_ReadOnly"),s.setWidgetValue("editProperties_editMode",this._sharedOptions.editMode),t},_switchEdition:function(e){this._switchEditionMode(e)&&this.onResize(),this.lastPointedTableCellObj=null},resizeActionActive:function(){return u.VARIABLES.minWidthForTable!==u.MIN_WIDTH_FOR_TABLE},getOptimalSize:function(){var e=this.elements.masterTable.getSize(),t=this.elements.containerProperties.getSize(),i=e.height-t.height,n=this.elements.formSection.getContent().getSize();return n.height+=i+60,n.width+=30,n},updateTableManager:function(){this._saveScrollerPosition(),this._clearAllLine(),this.updateTable()},updateTable:function(){var e=this;this._clearAllFields(),this._clearAllLine(),e.modelIdentityCard&&(e.modelIdentityCard.set("title",""),e.modelIdentityCard.set("ownerName",""),e.modelIdentityCard.set("date",""),e.modelIdentityCard.set("description",""));var t=this.elements.UIController.getModels(),i=t.length,n=++window.top.perfoIncrem;window.top.performance.mark("start_addInForm:"+n);for(var s=0;s<i;s++){var a=t[s];this.webUxTweakers&&(a.webUxTweakers=this.webUxTweakers),this.propertiesWidgetUI&&(a.propertiesWidgetUI=this.propertiesWidgetUI),a.newInfraUI=!0,this.elements.formSection.setModel(a)}window.top.performance.mark("end_addInForm:"+n),this._restoreScrollerPosition(),setTimeout((function(){e.publishEvt("triggerPostBuild")}))},saveIsNeeded:function(){var e=!0;return this.elements.UIController.getModifiedModels().every((function(t){var i=t.previousAttributes();for(var n in"function"==typeof t.getChangedValues&&(i=t.getChangedValues()),i){var s=i[n];if(s instanceof d&&!1===s.isTransient){e=!1;break}}return!1!==e})),!e},validateModel:function(e){var t=!1,i=null;if((i=e||this.elements.UIController.getModifiedModels()).length>0){var n=this.elements.UIController.validateModels(i);n?(n.message=g.get("Modification failed")+":"+n.message,this.setError(n)):t=!0}return this._ManageValidButton(),t},_valueIsChanging:function(e,t){this._ManageValidButton();var i={value:t,valueDB:e.get("valueDB")};e.isSameValueSet(i)&&this._activateValidButton()},_activateAddingButton:function(e){this.dispatchEvent("onAddActivation",e)},_activateValidButton:function(e){var t=!e;this.elements.boutonCancel&&(t?this.elements.boutonCancel.show():this.elements.boutonCancel.hide()),this.dispatchEvent("onValidActivation",t)},_ManageValidButton:function(){this._activateValidButton(!this.saveIsNeeded())},getButtons:function(){return this.ManageButtonDiv},getTitle:function(){var e="";return this.elements.UIController&&(e=this.elements.UIController.getLabel()),e},showNotification:function(e){this.addSuccess(e)},setError:function(e){var t=this;if(n.isArray(e))e.forEach((function(e){var i=e&&e.customClass?e.customClass:null;t._manageError(e,i)}));else{var i=e&&e.customClass?e.customClass:null;t._manageError(e,i)}},_manageError:function(e,t){if(e)switch(e.eventID?e.eventID:"error"){case"warning":this.addWarning(e.message?e.message:e,t);break;case"success":this.addSuccess(e.message?e.message:e,t);break;default:this.addError(e,t)}},addWarning:function(e,t){this.dispatchEvent("onNotification",{msg:e,eventID:"warning",customClass:t})},addSuccess:function(e,t){this.dispatchEvent("onNotification",{msg:e,eventID:"success",customClass:t})},addInfo:function(e,t){this.dispatchEvent("onNotification",{msg:e,eventID:"info",customClass:t})},addError:function(e,t){this.dispatchEvent("onNotification",{msg:e.message?e.message:i.encode(e),eventID:"error",customClass:t})}});return T})),define("DS/ClassificationProp/facets/Properties/ClassifPropController",["UWA/Class/Model","UWA/Core","DS/ClassificationProp/utils/ClassifSecurityContextServices","DS/WidgetServices/WidgetServices","DS/ClassificationProp/comm/EventManager","DS/ClassificationProp/facets/Common/ClassifFacetsBase","DS/ClassificationProp/models/ClassifPropModel","DS/ClassificationProp/models/ClassifPropModelMerge","DS/ClassificationProp/models/ClassifPropAttributeModel","DS/ClassificationProp/ajaxRequests/ClassifPropAjaxRequests","DS/ClassificationProp/facets/Properties/Properties","DS/ClassificationProp/facets/Properties/PropertiesInfo","DS/ClassificationProp/constants/ClassifPropConstants","DS/ClassificationProp/constants/ConstantsMapping","DS/ClassificationProp/comm/DistantAjax","DS/ClassificationProp/utils/ClassifPropUtils","DS/ClassificationProp/utils/ClassifPropControl","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/ClassificationProp/assets/nls/langEditProp","DS/PlatformAPI/PlatformAPI"],(function(e,t,i,n,s,a,r,o,l,c,u,d,h,f,p,m,g,v,_,C){"use strict";var S=_.get("accordion_parameters");let b=!0;var E=a.extend({defaultOptions:{serverName:"",serverUri:"",displayType:h.STANDARD,extraNotif:!1,context:null},getListHandle:null,commitHandle:null,previewUrlHandle:null,init:function(e){var t=this;this._parent.apply(this,arguments),this.getListHandle={handle:null},this.commitHandle={handle:null},this.previewUrlHandle={handle:null},this.attributeNameAndClassMap=new Map;var i={};for(var n in e)i[n]=e[n];i.events=i.events?i.events:{},i.events.onNotification=function(e){t._setError(e.msg?e.msg:e.json,e.eventID,e.customClass)},i.events.onValidActivation=function(e){t.switchSaveButton(e)},i.events.onAddActivation=function(e){t.switchAddButton(e)},t.parametersLoaded=!1,t.alreadySelectedModels=[],s.subscribe("onClassificationTableOpen",(function(e){e==S&&!1===t.parametersLoaded&&(t.parametersLoaded=!0,t._loadPLMParameters())})),s.subscribeSingleInstance("onInformationAttributeUpdate",(async function(e){var i=[];e.dataprovider&&e.dataprovider._getComponentName()&&(e.selection.component=e.dataprovider._getComponentName()),i.push(e.model),await t.onSave(e.ObjectId,i,e.selection,e.informationPanelContext).then()})),i.events.refreshActions=function(e){t.refreshActions()},this._createUI(i)},isUIReadonly:function(){return this.editPropertiesUI.isReadonly()},_createUI:function(e){e.className=this.getTabId(),e.eventThread=this.options.eventThread,g.getInformationPanel()?this.editPropertiesUI=new d(e,this.getSharedOptions()):this.editPropertiesUI=new u(e,this.getSharedOptions())},nothingToSave:function(){return!this.editPropertiesUI.saveIsNeeded()},onSave:async function(e,t,i,n){var s,a=[],r=this;s=this.editPropertiesUI.validateModel(t),t.forEach((function(e){a.push(e.getChangedValues())}));var o={},l=i;[...a].forEach((function(e){for(let t in e)o[t]=e[t]})),l.setChangedValues(o);for(const e in l.changedValues)l._attributes[e]=l.changedValues[e];if(s){if(!0!==this.options.updateSession){l._attributes;return l._attributes.objectId=e,l.set("metatype","bus"),new Promise((function(e){r._commitModels([l],n).then((function(){e()}))}))}var c=l.changedValues,u=[];for(var d in c)if(null!=d){var h=c[d].value,f=c[d].valueDB;null!=h&&null!=f&&u.push({attribute:d,value:h,valueDB:f})}var p=JSON.stringify(u);"undefined"!=typeof dscef&&dscef.sendString('{"operation":"onOk","operationVersion":"1.0","attributes":'+p+"}")}},getExtensions:function(){var e=this;require(["DS/EditPropExtensions/UI/AddExtensionsWidget"],(function(t){var n=e.getModel(),s=n.getTenant();i.getInstance({tenant:s}).getSecurityContext({context:e.options.context,onSuccess:function(i){e.showLoader();new t(widget,e._parent,e.options,i,n,(function(){e.hideLoader(),e.onRefresh()}),(function(t){e.hideLoader(),v.displayNotification({className:"string"==typeof type?type:"info",message:t})}))},onFailure:function(t){e._setError(t)}})}),(function(){e._setError("AddExtensionWidget do not exist")}))},switchEdition:function(){this.editPropertiesUI._switchEdition()},getButtons:function(){return this.editPropertiesUI.getButtons()},_getUI:function(){return this.editPropertiesUI},onLoad:function(){this.clearAllDatas()},updateFacet:function(){this.onRefresh()},onRefresh:function(){this.loadModels(this.getModel(),{parameters:!0===this.parametersLoaded})},_cancelListRequest:function(){this.getListHandle&&this.getListHandle.handle&&(this.getListHandle.handle.cancel(),this.getListHandle.handle=null)},_cancelCommitHandle:function(){this.commitHandle&&this.commitHandle.handle&&(this.commitHandle.handle.cancel(),this.commitHandle=null)},_cancelPreviewUrlHandle:function(){this.previewUrlHandle&&this.previewUrlHandle.handle&&(this.previewUrlHandle.handle.cancel(),this.previewUrlHandle=null)},destroyComponent:function(){this._cancelCommitHandle(),this._cancelListRequest(),this._cancelPreviewUrlHandle(),this.clearAllDatas(),this._commandProxy&&this._commandProxy.destroy()},clearAllDatas:function(){var e=this.getModel();e&&e.destroy(),this.setModel(null)},_loadPLMParameters:function(){this.loadModels(this.getModel(),{parameters:!0,attributes:!1})},loadModels:function(t,i){window.top.performance.mark("start_PrepareAjax");var a=this;this.showLoader(),s.subscribe("getnoClassificationAttribute",(function(e,t){if(b=t,null==t&&(b=!1),e){var i=a.alreadySelectedModels.indexOf(e);i>-1&&a.alreadySelectedModels.splice(i,1)}}));var o=t;if(t){f.getServiceForModel(t);var u=null;t instanceof e?(a.getModel(o.get("objectId"))||o.clearChangedValue(),u=o.getChangedValues()):o=new r(t),a.getModel(o.get("objectId"))||(a.setModel(o),o.clearChangedValue()),o.keys().forEach((function(e){var t=o.get(e);t instanceof l||"object"!=typeof t||"EditProp_listOfChange"===e||"label"===e||e.startsWith(h.MODEL_FACET_INFO_PREFIX)||e.startsWith(h.MODEL_DS_ATTR)||o.set(e,new l(t))})),a._resetModifFlag(o);var d=o.get("EditProp_listOfChange");if(d&&(o.setChangedValues(d),o.unset("EditProp_listOfChange")),u&&o.setChangedValues(u),window.top.performance.mark("end_PrepareAjax"),i&&!1===i.loadModel)this.setModel(o),this.editPropertiesUI.initData([this.getModel()],{classificationAttiProp:!0});else{window.top.performance.mark("start_EP_AJAXRequest");var m=!1;window.top.performance.mark("start_EP_GetFromDistant"),p.getAsyncRead((function(e){!1===m&&(e?(window.top.performance.mark("end_EP_GetFromDistant"),m=!0,a._cancelListRequest(),a._onCompleteLoadModel(e)):b&&function(){var e=i&&!0===i.parameters,t=i&&!1!==i.attributes,r=[];if(o.isMergedModel()){var l=o.getMergingModels(),u=o._initProperties.objectId;for(var d in l){var f=l[d];r.push(f._attributes.objectId),console.log(f)}function v(e,t){var i=[];return e.forEach((function(e){t.includes(e)||i.push(e)})),i}v(r,a.alreadySelectedModels).forEach((function(e){p(o=l[e],u)}))}else p(o);function p(i,r){var o={modelList:[i],tenant:i.getTenant(),onAttributesLoad:function(r){if(!1===m){var o,l,c={data:[]};if(i._attributes.objectId=r.id?r.id:i._attributes.objectId,o=i._attributes.objectId,r.results=[],r.attribute){console.log();var u=[],d=[];r.attribute.forEach((function(e,t){-1!==r.attribute[t].classAttributeOrder?u.push(r.attribute[t]):d.push(r.attribute[t])})),d.length>0&&d.sort(((e,t)=>e.nls_label.toLowerCase().localeCompare(t.nls_label.toLowerCase()))),u.length>0&&u.sort(((e,t)=>{const i=e.classAttributeOrder,n=t.classAttributeOrder;return i<n?-1:i>n?1:0})),r.attribute=[],u.forEach((function(e){r.attribute.push(e)})),d.forEach((function(e){r.attribute.push(e)}));let e=n.getValue("DimensionsDictionary");r.attribute.forEach((function(t){l=t.name;var n={path:t.name,extension:i._attributes.objectId,nls:t.nls_label,selectable:"attribute["+t.name+"]",name:t.name,readOnly:!1,type:t.type,value:[t.default]};if(""==t.default&&(n.value=[]),"false"==t.isEditable&&(n.readOnly=!0),1==window.enableExportAttributes&&(n.readOnly=!1),t.dimensionUnits&&t.dimensionUnits.defaultUnit&&(n.dimension=t.dimensionUnits.defaultUnit),t.dimensionUnits&&t.manipulationUnit&&(""==t.default||g.getInformationPanel())&&(n.dimension=t.dimensionUnits[t.manipulationUnit]),t.dimensionUnits&&(n.dimensionUnits=t.dimensionUnits,n.dimensionType=t.dimension),t.displayAsEntered&&(n.displayAsEntered=t.displayAsEntered),t.dimension&&t.displayAsEntered){n.dimensionType=t.dimension;let i=e.get(t.dimension.replace("DSDim_",""));i.Units.map((e=>e.label)),n.dimensionUnits=i}if(t.manipulationUnit&&(""==t.default||g.getInformationPanel())&&(n.unitName=t.manipulationUnit),"multival"==t.valuetype&&(n.multivalue=!0),"TRUE"==t.multiline&&(n.multiline=!0),t.range&&t.range.length>0){let e=[],i=[];if(Object.values(t.range).forEach((function(n){"between"!=n.operator&&e.push(n.value),t.nls_range&&(t.nls_range[n.value]?i.push(t.nls_range[n.value]):i.push(n.value))})),t.rangeNLS){var s=0;Object.values(t.rangeNLS).forEach((function(t){"between"!=t.operator&&(""==t.value?i.push(e[s]):i.push(t.value),s++)}))}n.rangeNLS=i,n.range=e,n.rangeNLS=n.rangeNLS?n.rangeNLS:e}var r=a.editPropertiesUI.getUpdatedValueForAttribute(n.name);r&&"Definition"==a.editPropertiesUI.getClassUsage(o)&&(n.value=r),c.data.push(n)}))}c.extensions={};var f=a.editPropertiesUI.getClassTitleFromID(o),p=a.editPropertiesUI.getClassPath(o),v=a.editPropertiesUI.getClassUsage(o);c.extensions[o]={name:o,nameNLS:g.getInformationPanel()&&null!=v?p:f,classUsage:v,weight:0,icon:"classif"},c.modifyAccess=!0,c.physicalID=i._attributes.objectId,c.metatype="bus",c.PLMParametersAvailable=!1,c.computed={label:{path:i._attributes.objectId+"-"+l,selectable:"attribute["+i._attributes.objectId+"]",name:i._attributes.objectId+"-"+l}},r.results[0]=c,s.publish("getAttributesDone",!0),!0===window.top.isDebug&&console.log("Ajax 2 answered "+window.top.performance.now()),a.getListHandle.handle=null,a._onCompleteLoadModel(r,{initTable:!e,buildBehavior:t?h.FORCE_DEFAULT:h.NO_CHANGES})}},onComplete:function(e){a.hideLoader(),o.onAttributesLoad(e)}};o.plmParams=e,o.attributes=t,o.readonly=a.isUIReadonly(),o.navigateToMain=a.getTabId()===h.FACET_CLASSIFICATIONPROP,a.alreadySelectedModels.push(i._attributes.objectId),a.editPropertiesUI.getExistingClassAttributes(i._attributes.objectId)&&a.editPropertiesUI.getExistingClassAttributes(i._attributes.objectId).isExisting?a.editPropertiesUI.getExistingClassAttributes(i._attributes.objectId).attribute&&o.onAttributesLoad(a.editPropertiesUI.getExistingClassAttributes(i._attributes.objectId)):!g.getInformationPanel()||g.getInformationPanel()&&"function"!=typeof g.getProvider().getClassificationAttributesForAClass?("IP Export Control"==g.getProvider()._getComponentName()&&(o.isExportControl=!0),c.getClassificationAttributes(o)):g.setClassifPropController(o)}}())}))}1==(t._innerModels?Object.keys(t._innerModels).length:1)&&t._attributes&&t._attributes._DS_ATTR_type&&t._attributes._DS_ATTR_type.valueDB&&t._attributes._DS_ATTR_type.valueDB}else this.editPropertiesUI.clear(),this._onCompleteLoadModel({results:[]})},hide:function(){this._parent(),this.editPropertiesUI.clear()},_commitModels:function(e,t){var i=this,n=null;return t&&"string"==typeof t&&(n=t),i.commitHandle.handle=null,i.showLoader(),new Promise((function(t){c.commitModels({handleRequest:i.commitHandle,serverName:i.options.serverName,serverUri:i.options.serverUri,modelList:e,tenant:e[0].getTenant(),securityContext:n,onComplete:function(e,n,a){if(i.hideLoader(),a&&a.errors){for(var r in i._onCompleteCommit(e,n,a),n.model.changedValues)n.model.changedValues[r].isResetOnAttributeUpdateFailure=!0,n.model.changedValues[r].value=n.model.changedValues[r].oldValue,n.model.changedValues[r].valueDB=n.model.changedValues[r].oldValueDB,s.publish("onAttributeUpdate",n.model.changedValues[r],n.model,!0);var o=a.errors;a.errors.contains("No 'modify' access on Attribute")&&(o=_.UpdateObjectfailedSubtitle),v.displayNotification({message:o,className:"error"})}else{i.commitHandle.handle=null;var l=[];let t={};e&&e.requests&&(e.requests[0].body.forEach((e=>{l.push({attributeName:e.path,attributeValue:e.value})})),t.objectId=n&&n.model&&n.model._attributes.objectId,t.attributes=l),C.publish("ClassificationAttributeUpdate",t)}t()},returnCallback:function(){t()}})}))},_manageNotificationFromAnswer:function(e,t){var i=t,n="error",s="undefined";if(e)if(e.hasOwnProperty("error"))i=e.error;else if(e.hasOwnProperty("notification")){i=(a=e.notification).message,n=a.type?a.type:n,(s=a.code?a.code:"LCERR400100")&&(i={type:"MainStaticError",message:a.message})}else if(e.hasOwnProperty("errors")&&e.errors.length>0){var a;i=(a=e.errors[e.errors.length-1]).message,n=a.type?a.type:n}else!1===e.success&&(i={message:_.get("Server error"),code:"ERROR"});if(i)if(void 0!==e&&void 0!==e.errors&&null!=e.errors&&2==e.errors.length&&void 0!==e.errors[0].code&&"1900068"===e.errors[0].code&&void 0!==e.errors[1]&&"1500188"!=e.errors[1].code)UWA.i18n("UpdateObjectfailed"),UWA.i18n("UpdateObjectfailedSubtitle");else s&&0==s.localeCompare("LCERR400100")?this._setMainError(i.message,i.type.toLowerCase(),i.customClass):this._setError(i,n.toLowerCase(),i.customClass);return{message:i,type:n.toLowerCase()}},_setError:function(e,t,i){t=t||"error",this._raiseNotification(e,t,i)},_setMainError:function(e,t,i){t=t||"mainstaticerror",this._raiseNotification(e,t,i)},_onCompleteCommit:function(e){},_buildFromResponse:function(e,t,i){var n=this,s={modifyAccess:!0,oneSuccess:!1,allAttributeAreRO:!0,plmparams:null};if(!1!==e.success){for(var a=e.transactionid,l=e.results,c=l.length,u=0;u<c;u++){var d=l[u];n._manageNotificationFromAnswer(d);var h=null;h=null!=a?a:n._getID(d);var f=n.getModel(h);if(null==f)(E=(b=n.getOccurrence()).getModel(this.getTabId()))&&E.getMergingModels&&(f=E.getMergingModels()[h]);var p=n._getMetaType(d),v=null,_=!1;if(f&&f.isMergedModel()){v={};var C=n.alreadySelectedModels,S=f.getMergingModels();C.forEach((function(e){var t=S[e];if(null==t){_=!0;var i=UWA.clone(f.getOptions());i.objectId=e,i.metatype=p,t=new r(i)}v[e]=t}))}if(_||null==f){if(!_){var b;if(null===(b=n.getOccurrence()))return console.log(" --- >> No current occurence"),{};var E=b.getModel(this.getTabId());if(!g.getInformationPanel()){if(null!==E)return console.log(" --- >> A model already exist for properties tab"),{addAttributeTab:!0};if(!f&&a)return console.log(" --- >> A merged model is returned for a single model"),{}}}var y=n.getOccurrence().getAllModels(!0,!0);t={metatype:p,objectId:h};y&&y.length>0&&((t=UWA.clone(y[0].getOptions())).objectId=h,t.metatype=p),null!=v?(f=new o(t)).setMergingModels(v):f=new r(t),f.clearChangedValue()}if(null!=v&&(f=new o(t)).setMergingModels(v),p&&f.set("metatype",p),n.setModel(f),d.extensions)for(var A in d.extensions)i[A]=d.extensions[A];var I=m.fillFromServer(d,f,t);s.modifyAccess=!1!==I.modifyAccess&&s.modifyAccess,s.oneSuccess=s.oneSuccess||I.success,s.allAttributeAreRO=s.allAttributeAreRO&&I.allAttributeAreRO,s.plmparams=!1!==s.plmparams&&I.plmparams}n.editPropertiesUI._ManageValidButton()}return s},_onCompleteLoadModel:function(e,t){this.hideLoader(),window.top.performance.mark("end_EP_AJAXRequest"),window.top.performance.mark("start_EP_DataTreatement"),t||(t={initTable:!0,buildBehavior:h.FORCE_DEFAULT});var i=e.options;i&&(void 0!==i.showSections&&this.editPropertiesUI.setOption("showSections",!0===i.showSections),void 0!==i.autoExpand&&this.editPropertiesUI.setOption("sectionAutoexpand",!0===i.autoExpand));var n={};this._manageNotificationFromAnswer(e);var s=this._buildFromResponse(e,t,n),a=s.modifyAccess&&!s.allAttributeAreRO&&(!this.isReadOnly()||"false"===this.isReadOnly());!0!==a&&!0!==t.initTable||(this.editPropertiesUI.switchComponentMode(!a),this.updateReadWriteAccess(a)),window.top.performance.mark("end_EP_DataTreatement"),window.top.performance.mark("start_EP_DataDisplay");var r=this.getModel(),o=s.oneSuccess&&r?[r]:[];this.editPropertiesUI.setAccordionProperties(n),o&&o.length>0&&(o[0].facet="prop"),this.editPropertiesUI.initData(o,{edition:t.buildBehavior,classificationAttiProp:!0}),s.plmparams&&this.editPropertiesUI.addSection({section:S},!0)},_getID:function(e){return e.physicalID},_getMetaType:function(e){return e.metatype},_resetModifFlag:function(e,t){e.clearChangedValue(t),this.editPropertiesUI._ManageValidButton()},changeAttributes:function(e){this.editPropertiesUI.changeAttributes(e)}});return E})),define("DS/ClassificationProp/UI/IDCardSkeleton",["UWA/Class/Model","DS/ClassificationProp/models/CommonAbstract","DS/ClassificationProp/constants/ClassifPropConstants","DS/ClassificationProp/ICard/IdCard","DS/ClassificationProp/facets/Properties/ClassifPropController","DS/WidgetServices/MultipleAsynchronousRequests","DS/WidgetServices/WidgetServices","DS/ClassificationProp/comm/DistantAjax","DS/UIKIT/Tooltip","DS/UIKIT/Input/Button","DS/UIKIT/SuperModal","DS/UIKIT/Spinner","DS/Controls/TabBar","DS/Controls/TooltipModel","DS/PlatformAPI/PlatformAPI","DS/WidgetServicesUI/tweakers/TweakerWUXButton","css!DS/ClassificationProp/ClassificationProp.css","i18n!DS/ClassificationProp/assets/nls/langEditProp"],(function(e,t,i,n,s,a,r,o,l,c,u,d,h,f,p,m,g,v){"use strict";var _={"DS/ClassificationProp/facets/Properties/ClassifPropController":s},C="withMenuBar";window.top.perfoIncrem=window.top.perfoIncrem?window.top.perfoIncrem:0;i.FACET_NONE;var S=t.extend({_lFacets:[],_sharedContext:null,_sharedOptions:{},_RWAccess:!1,defaultOptions:{name:"",className:"",showIdCard:!0,showTopBar:!0,showFacets:!0,warningOnUnsaved:!0,closeButton:!0,noThumbnail:!1,facetLabel:!0,displayType:i.STANDARD},init:function(e,t){this._sharedOptions={},this._parent(t),this.options.actions&&this.options.actions.forEach((function(e){void 0===e.after&&"action_close_panel"===e.name&&(e.after=!0)})),this._sharedContext=t.sharedContext?t.sharedContext:null,this._lFacets=e,this.elements||(this.elements={}),this.loaderFacetList=[],this.idcardInit()},getTopBar:function(){return this.elements.manageButtonDiv},idcardInit:function(e){var t=this,i=this.elements.container=UWA.createElement("div",{name:this.options.name,class:this.options.className}),s="";!0===this.options.showTopBar&&(s=C);this.elements.globalDiv=UWA.createElement("div",{class:"IDCardGlobalContain "+s}).inject(i);var a=t.elements.mainInterface=UWA.createElement("div",{class:"ClassifMainInterface"}).inject(this.elements.globalDiv),r=this.elements.masterTable=UWA.createElement("div",{class:"ClassifAttMasterTable "}).inject(a),o=this.elements.topTable=UWA.createElement("div",{class:"IDCardTopTableContainer"});if(this.elements.bottomMainArea=UWA.createElement("div",{class:"ClassificationCardArea"}),this.elements.bottomInnerArea=UWA.createElement("div",{class:"ClassificationCardInnerArea"}),this.elements.bottomInnerArea.inject(this.elements.bottomMainArea),this.elements.bottomArea=UWA.createElement("div",{class:"ClassifAttributePropContainer"}),this.elements.bottomArea.inject(this.elements.bottomInnerArea),this.elements.bottomMainArea.inject(r),delete this.elements.postIdCard,!0===this.options.showIdCard){var l={};this.options.idCardOptions&&(l=this.options.idCardOptions),l.actions=[],this.elements.postIdCard=new n(l),t.identityCardContainer=UWA.createElement("div",{class:"topTableElement identityCardCell infra"}).inject(o);var c=UWA.createElement("div",{class:"ClassifTableContainer ",events:{click:function(){let e={currentFacet:t.currentFacetName};p.publish(`PropHeaderActivated:${widget.id}`,e)}}}).inject(this.identityCardContainer);this.elements.postIdCard.inject(c),this.currentFacetName=null,this.defaultFacetName=null,this.infoForFacet=null,this._createTabs([]),this.elements.superModal=new u({renderTo:this.container})}var d={className:"TopButtonValid",emphasize:"primary",setAttribute:{name:"TopButtonValid"},clickCallback:function(){t._saveAllFacets()}};if(!0===t.options.updateSession)d.label=v.get("EP_OK"),this.elements.boutonValid=m(d);else{d.label=v.get("EP_Ok"),this.elements.boutonValid=m(d)}require(["DS/EditPropExtensions/UI/AddExtensionsWidget"],(function(e){v.get("EP_Add")}))},_createTabs:function(e){var t=this;!0===this.options.showFacets&&(this.elements.tabs&&this.elements.tabs.getTabCount()>0&&(this.elements.tabs.destroy(),this.elements.tabs=null),this.elements.tabs||(this.elements.tabs=new h({displayStyle:"strip",centeredFlag:!0,showComboBoxFlag:!0,editableFlag:!1,multiSelFlag:!1,reorderFlag:!1}),this.elements.tabs.touchMode=r.isTouchDevice(),this.elements.tabs.onSelectTab((function(e){if(void 0!==e&&void 0!==e.index&&e.index>=0){var i=t.elements.tabs.getValueByIndex(e.index);t._switchFacet(i)}}))),(e=e||this._lFacets).forEach((function(e){var i=t.elements.tabs.add({label:!0===t.options.facetLabel?e.facet.text:void 0,value:e.facet.name,allowClosableFlag:!1,icon:{iconName:e.facet.icon,fontIconFamily:1}});i.getModel().tooltipInfos=new f({shortHelp:e.facet.text,mouseRelativePosition:!1}),i.getContent().setAttribute("tab_name",e.facet.name)})),e.length>1?this.elements.tabs.show():this.elements.tabs.hide())},saveClassificationFacet:async function(e,t,i,n){var s=this,a=this._lFacets.length;return new Promise((function(r,o){s._lFacets.forEach((function(o,l){if("classificationAttiProp"===o.facet.name){var c=s._getFacetContent(o);c?c.onSave(e,t,i,n).then((function(){r()})).catch((function(e){r(e)})):r()}else a==l+1&&r()}))}))},_loadExtensions:function(){var e=this;this._lFacets.forEach((function(t){var i=e._getFacetContent(t);i&&!1!==t._isVisible&&i.getTabId()==e.currentFacetName&&i.getExtensions()}))},checkChangeAuthorized:function(e,t){!0===this.options.warningOnUnsaved&&this._checkSaveForAllFacets();e.call(this,!0)},_checkSaveForAllFacets:function(){var e=this,t=!1;return this._lFacets.every((function(i){var n=e._getFacetContent(i);return n&&!1!==i._isVisible&&(t=!n.nothingToSave()),!t})),t},getSharedContext:function(){return this._sharedContext},setSharedContext:function(e){this._sharedContext=e,this.onRefresh()},getContainer:function(){return this.elements.container},getMainTable:function(){return this.elements.bottomArea},getIdentityCardUI:function(){return this.elements.topTable},getCollapseICPreferenceName:function(){return i.COLLAPSE_IC_PREFERENCE.name},destroyComponent:function(){var e=this;this._lFacets.forEach((function(t){var i=e._getFacetContent(t);i&&i.destroyComponent()})),this.elements.tabs.destroy()},getOptimalSize:function(){var e=this._getCurrentFacetContent(),t=this._getSizeTopTable(),i={width:0,height:0};return e&&((i=e.getOptimalSize()).height+=t.height),i},_getSizeTopTable:function(){var e=this.elements.topTable.getSize();return"none"===this.elements.topTable.getStyle("display")&&(e={height:0,width:0}),e},_getThumbnailDiv:function(){return this.thumbnail||(this.thumbnail=this.elements.container.getElement(".thumbnail-section")),this.thumbnail},_refreshCurrentFacet:function(){var e=this._getCurrentSelectedFacet(),t=this._getFacetContent(e);t&&t.onRefresh()},onRefresh:function(){var e=this,t=this._getCurrentSelectedFacet();this._refreshCurrentFacet(),this._lFacets.forEach((function(i){(!0===i.alwaysCalled&&!1!==i._isVisible||!0===i.calledIfVisible&&!0===i._isVisible)&&e._getFacetName(i)!==e._getFacetName(t)&&e._loadFacet(i,!1,(function(){var t=e._getFacetContent(i);t&&t.onRefresh()}))}))},_manageThumbnailDisplay:function(){var e=this.elements.container.getSize(),t=!0!==this.options.noThumbnail&&e.height>=300;this.elements.postIdCard&&this.elements.postIdCard.showThumbnail("height",t)},onResize:function(e){var t=this._getCurrentFacetContent();t&&t.onResize(),this._manageThumbnailDisplay(),this.elements.postIdCard&&this.elements.postIdCard.onResize()},_getFacetFromName:function(e){var t=null;return this._lFacets.every((function(i){return i.facet&&i.facet.name===e&&(t=i),!t})),t},getFacetContent:function(e){var t=this._getFacetFromName(e);return t?this._getFacetContent(t):null},_getFacetContent:function(e){return e&&e.content&&"object"==typeof e.content?e.content:null},_getCurrentFacetContent:function(){var e=this._getCurrentSelectedFacet();return e?this._getFacetContent(e):null},_getCurrentSelectedFacet:function(){var e=null,t=null;if(this.currentFacetName&&this.options.showFacets)(e=this.currentFacetName)&&this._lFacets.every((function(i){return i.facet&&i.facet.name===e&&(t=i),!t}));else{var i=null;this._lFacets.length>0&&(i=this._lFacets[0],this._lFacets.every((function(e){var t=e.alwaysVisible;return t&&(i=e),!t}))),t=i}return t},_updateFacets:function(){var e=this._getCurrentFacetContent();e&&e.display()},_hideAllFacetsContent:function(e){var t=this,i=e?this._getFacetName(e):null;this._lFacets.forEach((function(e){var n=t._getFacetContent(e);n&&t._getFacetName(e)!==i&&n.hide()}))},_manageFacetLaunching:function(e){var t=++window.top.perfoIncrem;window.top.performance.mark("start_launchFacets:"+t);var i=this,n=this._getCurrentSelectedFacet(),s=this.getSharedContext();!0!==e&&this._launchFacet(),window.top.performance.mark("start_Iterate:"+t);var a=i._getFacetName(n);this.currentFacetName=a,this._lFacets.forEach((function(e){if((!0===e.alwaysCalled&&!1!==e._isVisible||!0===e.calledIfVisible&&!0===e._isVisible)&&i._getFacetName(e)!==a){var t=++window.top.perfoIncrem;window.top.performance.mark("start_loadFacet:"+t),i._loadFacet(e,!1,(function(){window.top.performance.mark("end_loadFacet:"+t);var n=i._getFacetContent(e);n&&n.setContext(s);var a=i._getCurrentSelectedFacet();i._getFacetName(a)===i._getFacetName(e)&&i.__launchFacet(a)}))}})),window.top.performance.mark("end_Iterate:"+t),window.top.performance.mark("end_launchFacets:"+t)},_launchFacet:function(){var e=this,t=this._getCurrentSelectedFacet();return this._hideAllFacetsContent(t),this._loadFacet(t,!0,(function(){e.__launchFacet(t)})),t},_loadFacet:function(e,t,i){var n=this,s="loading";if(e&&e.content!==s)if(e.content)i.call(n);else{e.content=s;var a=++window.top.perfoIncrem;window.top.performance.mark("start_prereqFacet:"+a),function(e,t){var i=[],n=[];e.forEach((function(e){var t=_[e];t?n.push(t):i.push(e)})),i.length>0?require(i,(function(){for(var s=0;s<arguments.length;s++)e[i[s]]=arguments[s],n.push(arguments[s]);t.apply(null,n)})):t.apply(null,n)}([e.require],(function(s){window.top.performance.mark("end_prereqFacet:"+a),e.content=null;var o=n._getCurrentSelectedFacet(),l=n._getFacetName(e)===n._getFacetName(o);if(!t||l){var c=e.options?e.options:{};if(Object.keys(c).length>0){var u=n.infoForFacet;if(c.infoForFacet,null!=u&&(e.options.infoForFacet=u),void 0===c.tenant||null===c.tenant){var d=n._getTenant();null===d&&(d=r.getTenantID()),e.options.tenant=d}}var h=c.events?c.events:{};h.onNotification=function(e){n._addNotif(e)},h.onEvent=function(e){n._manageEvent(e)},c.events=h,e.options=c,e.options.tabId=e.facet.name,e.options.eventThread=n.options.eventThread+"."+e.facet.name,e.content=new s(e.options,n._sharedOptions);var f=e.content.getUI(),p="function"==typeof f.addClassName?f:f.container?f.container:f.elements?f.elements.container:null;p&&p.addClassName("ClassifAttTabContainer Classif_tab_"+e.facet.name),e.content.getUI().inject(n.elements.bottomArea),l||e.content.hide(),n.publishEvt("classifAttributeLoaded",e),i.call(n)}}))}},_switchSave:function(e){e?(this.elements.boutonValid.show(),this.elements.boutonAdd&&(this.elements.boutonAdd.disabled=!0)):(this.elements.boutonValid.hide(),this.elements.boutonAdd&&(this.elements.boutonAdd.disabled=!1))},_switchAdd:function(e){e?!0===this.options.updateSession?this.elements.boutonAdd&&this.elements.boutonAdd.hide():this.elements.boutonAdd&&this.elements.boutonAdd.show():this.elements.boutonAdd&&this.elements.boutonAdd.hide()},_manageActionVisibility:function(){var e=this,t=this._getCurrentSelectedFacet();(i=t?t.actions:null)&&i.forEach((function(i){var n=i;"object"==typeof i&&(n=i.name);var s=e._getFacetContent(t);s&&(("pencil"!==n||"pencil"===n&&!0===e._RWAccess)&&s.isActionAvailable(n))}));var i=this.options.actions;this.elements.postIdCard&&i&&i.length>0&&this.elements.postIdCard.setActions(i)},_manageEvent:function(e){var t=this._getCurrentSelectedFacet(),i=this._getFacetName(t);if("switchSave"===e.eventID){var n=e.value;!0!==n&&(n=this._checkSaveForAllFacets()),this._switchSave(n)}else if("switchAdd"===e.eventID){var s=e.value;this._switchAdd(s)}else if("switchLoader"===e.eventID){var a=e.value,r=this.loaderFacetList.indexOf(e.facet);!0===a&&r<0?this.loaderFacetList.push(e.facet):!1===a&&r>=0&&this.loaderFacetList.splice(r,1),this.loaderFacetList.length>0?this._displayLoadingArea():this._hideLoadingArea()}else e.facet===i&&"updateActions"===e.eventID?this._manageActionVisibility():"updateRWA"===e.eventID&&(this._updateRWA(e.value),this._manageActionVisibility())},_updateRWA:function(e){this._RWAccess=e},_hideLoadingArea:function(){},_displayLoadingArea:function(){},__launchFacet:function(e){var t=++window.top.perfoIncrem,i=this._getFacetContent(e);i&&(!0===this.options.showTopBar?this.elements.globalDiv.addClassName(C):this.elements.globalDiv.removeClassName(C),window.top.performance.mark("start_displayFacets:"+t),i.display(this.getSharedContext()),window.top.performance.mark("end_displayFacets:"+t),this._manageActionVisibility())},_getFacetName:function(e){return e&&e.facet?e.facet.name:""},_updateThumbnail:function(e,t){this.elements.postIdCard&&this.elements.postIdCard.changeThumbnail(e,t)},clearIdentityCard:function(){this.elements.postIdCard&&this.elements.postIdCard.clearValues()},getIdentityCard:function(){return this.elements.postIdCard},selectFacet:function(e){var t=this._getFacetFromName(e);if(this.elements.tabs&&t&&!1!==t._isVisible){var i=this.elements.tabs.getButtonFromValue(e);i&&(i.setProperties({checkFlag:!0}),this._switchFacet(e))}},clearPanel:function(){this._hideAllFacetsContent()},hideMainComponent:function(){this.elements.mainInterface.hide()},showMainComponent:function(){this.elements.mainInterface.show()},_manageFacetVisibility:function(){var e=this;this._hideAllFacets();var t=++window.top.perfoIncrem;window.top.performance.mark("start_facetVisibility:"+t);var i=new a(["B","C"],(function(){var i=this.getAnswer("B"),n=this.getAnswer("C"),s=e._facetCheck(this);if(!0===s.success){var a=e._getCurrentSelectedFacet();this.currentFacetName=e._getFacetName(a);var r=!0,o=null,l=!1;e._lFacets.forEach((function(t){var c=t.facet.name,u=a&&e._getFacetName(a)===c,d=t._isVisible||!0===t.alwaysVisible;d&&t.services&&t.services.forEach((function(e){i[e]||(d=!1)})),d&&t.roles&&(d=!1,t.roles.forEach((function(e){n.indexOf(e)>=0&&(d=!0)}))),!o&&d&&(o=c),d&&u&&(r=!1),t._isVisible=d,"iproperties"===c&&(t._isVisible=!1),!0===s.refreshCurrent&&u&&!r&&(l=!0)})),e._facetVisibilityUpdate(),r&&e.selectFacet(o),!l&&s.refreshAction&&e._manageActionVisibility(),window.top.performance.mark("end_facetVisibility:"+t),e._manageFacetLaunching(!l)}}));if(!0===e._queryFacets(i)){var n=e._getTenant();window.top.performance.mark("start_visibilityUrl"),o.getServices(n,(function(e){window.top.performance.mark("end_visibilityUrl"),i.setAnswer("B",e)})),window.top.performance.mark("start_visibilityRole"),o.getRoles(n,(function(e){window.top.performance.mark("end_visibilityRole"),i.setAnswer("C",e)}))}},_getTenant:function(){return r.getTenantID()},_queryFacets:function(e){return!0},_facetCheck:function(e){return this._lFacets.forEach((function(e){e._isVisible=!0})),{success:!0}},_getPriorityFacetName:function(){var e=null;null===e&&(null!=(t=this.defaultFacetName)&&""!==t&&(e=t));if(null===e&&this.currentFacetName&&this.options.showFacets&&(e=this.currentFacetName),null===e){if(null!==this.options)var t=this.options.defaultFacetName;null!=t&&""!==t&&(e=t)}return null===e&&(e="properties"),e},_facetVisibilityUpdate:function(){var e=this;if(this.elements.tabs){var t=this._getPriorityFacetName(),i=e._getFacetFromName(t),n=this._getCurrentSelectedFacet();i!==n&&(n=i);var s=null,a=!1,r=[];this._lFacets.forEach((function(t){!1!==t._isVisible&&!1!==t.visible&&(!0===e.options.updateSession?"properties"===t.facet.name&&r.push(t):r.push(t),n===t&&(null===s&&(s=t),a=!0))})),null===s&&this._lFacets.forEach((function(e){!1!==e._isVisible&&!1!==e.visible&&null===s&&(s=e)})),this._createTabs(r),a&&n.content&&n.content.display?(this.selectFacet(n.facet.name),n.content.display(this.getSharedContext())):s&&this.selectFacet(s.facet.name)}},removeFacets:function(e){var t=[],i=this._getCurrentSelectedFacet(),n=!1;this._lFacets.forEach((function(s){e.indexOf(s.facet.name)<0?t.push(s):i&&i.facet.name===s.facet.name&&(n=!0)})),this._lFacets=t,this._facetVisibilityUpdate(),n&&this._manageFacetLaunching()},getOrAddFacets:function(e){var t=this,i=[];e.forEach((function(e){t._getFacetFromName(e.facet.name)||i.push(e)})),this.addFacets(i)},addFacets:function(e){if(e&&(!Array.isArray(e)||0!==e.length)){var t=this,i=!0;if(e&&Array.isArray(e)){var n={};t._lFacets.forEach((function(e){e.facet&&(n[e.facet.name]=!0)})),e.forEach((function(e){e.facet&&!n[e.facet.name]&&(e._isVisible=!0===e.alwaysVisible,i=i&&e._isVisible,void 0!==e.position?t._lFacets.splice(Math.min(e.position,Object.keys(t._lFacets).length-1),0,e):t._lFacets.push(e))}))}i?this._facetVisibilityUpdate():this._manageFacetVisibility()}},_hideAllFacets:function(){this._createTabs([])},_isFacetAuthorized:function(e){this._getCurrentModelType();var t=this._getFacetFromName(e);return t&&!1!==t._isVisible},changeAttributes:function(e){var t=this._getCurrentFacetContent();null!=t&&t.changeAttributes(e)}});return S})),define("DS/ClassificationProp/UI/IDCardManager",["DS/ClassificationProp/UI/IDCardSkeleton","DS/ClassificationProp/constants/ClassifPropConstants","DS/ClassificationProp/constants/ConstantsMapping","DS/ClassificationProp/comm/DistantAjax","DS/ClassificationProp/models/ClassifPropModel","DS/ClassificationProp/models/ClassifPropModelMerge","DS/ClassificationProp/models/ClassifPropAttributeModel","css!DS/ClassificationProp/ClassificationProp.css","i18n!DS/ClassificationProp/assets/nls/langEditProp"],(function(e,t,i,n,s,a,r,o,l){"use strict";return window.top.perfoIncrem=window.top.perfoIncrem?window.top.perfoIncrem:0,e.extend({_lOccurrences:[],_faceVisibilityHandler:null,defaultOptions:{multiselection:t.MULTISEL_STD},init:function(e,t){this._lOccurrences=[],this._faceVisibilityHandler={handle:null},this.sourceAppId=t.sourceAppId,this._parent(e,t)},getModels:function(){var e=this.getOccurrences(),i=[];return e&&e.forEach((function(e){var n=e.getModel(t.MODEL_INIT);n&&i.push(n)})),i},notifyClose:function(){var e=this;this._lFacets.forEach((function(t){var i=e._getFacetContent(t);i&&"function"==typeof i.onClose&&i.onClose()}))},getModel:function(e,t){var i=null;return(t?t.getAllModels(!0):this.getModels()).every((function(t){return e!==t.get("objectId")||(i=t,!1)})),i},_getFirstFacetModel:function(e){var t=null,i=this._getFirstOccurrence();return i&&(t=i.getModel(e)),t},_getFirstInitModel:function(){return this._getFirstFacetModel(t.MODEL_INIT)},_getFirstPropertiesModel:function(){return this._getFirstFacetModel(t.FACET_PROPERTIES)},getOccurrences:function(){return this._lOccurrences},_getFirstOccurrence:function(){return this._lOccurrences.length>0?this._lOccurrences[0]:null},getSharedContext:function(){return this._getFirstOccurrence()},setOccurrences:function(e){var i=window.top.perfoIncrem++;window.top.performance.mark("start_setModelSkeleton:"+i);var n=this;this._clearAllFacetsModels(),this.modelHasChanged=!0;var s=e.length<=0,a=null;if(s||this.options.multiselection===t.MULTISEL_NO&&e.length>1)a=l.get(s?"NoItemSelected":"TooManyObjectSelected");else if(e.length>1&&this.options.multiselection===t.MULTISEL_MERGE){var r,o=(r=e[0]).getModel(t.MODEL_INIT);if(o){var c=o.getMergingModels(),u=null,d=null;for(var h in c){var f=c[h],p=f.get("tenant"),m=f.get("source");if(null===u?u=p:u!==p&&(a=l.get("DifferentTenantsNotSupported")),null===d?d=m:d!==m&&(a=l.get("DifferentSourcesNotSupported")),null!==a)break}}}null!==a?(this.clearIdentityCard(),this.showMainErrorArea(a),this.dispatchEvent("onTitleChanged",""),this.hideMainComponent(),this._lOccurrences=[]):(this.showMainComponent(),(r=e[0]).addEvent("onChange:"+t.FACET_PROPERTIES,(function(){n._initializeIDCard(r)})),this._initializeIDCard(r),this._lOccurrences=e);window.top.performance.mark("end_setModelSkeleton:"+i),this._manageFacetVisibility(),this._manageFacetLaunching()},__queryFacets:function(e){var t=this;this._faceVisibilityHandler.handle&&(this._faceVisibilityHandler.handle.cancel(),this._faceVisibilityHandler.handle=null);var i=this._getFirstInitModel();if(i){var s=[],a=!1;t._lFacets.forEach((function(e){i.isMergedModel()&&!e.supportMerge||(s.push({name:e.facet.name,inheritance:e.inheritance}),a=a||e.services&&e.services.length>0)})),n.launchFacetsVisibility(i,s,{context:this.options.context,handleRequest:this._faceVisibilityHandler,onComplete:function(i){i&&!1!==i.success?e.setAnswer("A",i):t._addNotif({msg:i?i.error.message:l["Error Server"],eventID:"error"})}},void 0,t.sourceAppId)}},_queryFacets:function(e){var t=this;e.addRequest("A");var n=this._getFirstInitModel();if(n){var s=i.getServiceForModel(n);n.get("isTransient")||!0!==s.modelNeeded?t.__queryFacets(e):(e.addRequest("Fed"),require(["DS/ClassificationProp/ajaxRequests/FederatedAjaxRequests"],(function(i){i.fillModel({onComplete:function(i){var n=i.get("ds6w:type");if(n=n||i.get("ds6w:what/ds6w:type")){var s=n.get("valueDB");i.set("ds6w:what/ds6w:type_value",s)}i.set("preview_url",i.get("previewUrl")),t.__queryFacets(e),e.setAnswer("Fed",!0)}},n)})))}return!!n},_facetCheck:function(e){var i=this,n=e.getAnswer("A"),o=e.getAnswer("Fed"),l=n.id,c=n.facets,u=i._getFirstInitModel(),d=i._getCurrentSelectedFacet(),h=null!==u&&u.get("objectId")===l,f=null,p=!!o,m=!1;if(h&&n.notification)return this.clearIdentityCard(),this.showMainErrorArea(n.notification.message),this.hideMainComponent(),{success:!1};if(h){var g=i._getFirstOccurrence(),v=n.mains,_=v?v[l]:null,C=l,S="empty",b=null;_&&(C=_.id,S=_.type,b=_.metatype?"bus"==_.metatype?t.METATYPE_BUS:t.METATYPE_REL:t.METATYPE_UNKNOWN);var E=!1,y={};if(f=g.getModel(t.FACET_PROPERTIES),u.isMergedModel()){C=l,S="mergedObject";var A=u.getMergingModels(),I=f&&f.isMergedModel()?f.getMergingModels():null;for(var T in A){var w=A[T],P=v[T],D=null!=P&&P.id?P.id:T,M=t.METATYPE_UNKNOWN;if(M=P.metatype?"bus"==P.metatype?t.METATYPE_BUS:t.METATYPE_REL:M,S=P?P.type:"",!(I?I[D]:null)&&D!==T)E=!0,(O=UWA.clone(w.getOptions())).objectId=D,w=new s(O);w.set("metatype",M),w.set(t.MODEL_DS_ATTR+"type",{valueDB:S,isTransient:!0});var U=M===t.METATYPE_REL?n.hierarchiesRel:n.hierarchiesBus;w.set(t.MODEL_DS_ATTR+"types",{valueDB:U?U[S]:null,isTransient:!0}),y[D]=w}f=g.getModel(t.FACET_PROPERTIES)}else null===f&&C===l&&(f=u);if(E||!f){var O,F=f||u,x=F.getAllAttributes();!0!==F.get("isTransient")&&(x=F.getOptions()),(O=UWA.clone(x)).objectId=C,b&&(O.metatype=b),O[t.MODEL_DS_ATTR+"type"]={valueDB:S,isTransient:!0};U=M===t.METATYPE_REL?n.hierarchiesRel:n.hierarchiesBus;for(var N in O[t.MODEL_DS_ATTR+"types"]={valueDB:U?U[S]:null,isTransient:!0},O)x[N]instanceof r&&(O[N]=new r(O[N]));u.isMergedModel()?(f=new a(O)).setMergingModels(y):f=new s(O)}else if(f){f.set(t.MODEL_DS_ATTR+"type",{valueDB:S,isTransient:!0});U=M===t.METATYPE_REL?n.hierarchiesRel:n.hierarchiesBus;f.set(t.MODEL_DS_ATTR+"types",{valueDB:U?U[S]:null,isTransient:!0})}g.setModel(t.FACET_PROPERTIES,f);c=n.facets;i._lFacets.forEach((function(e){var t=e.facet.name,n=c[t],s=n&&(!0===n||!0===n.available);(e._isVisible=s,!0===e.inheritance&&i._getFacetName(d)===t&&(m=!0),n&&n.information)&&(g.setOptions(t,n.information),i._getFacetName(d)===t&&(p=!0))}))}return{success:!!f,refreshCurrent:p,refreshAction:m}},_getTenant:function(){var e=this._getFirstInitModel(),t=null;return e&&(t=e.getTenant()?e.getTenant():this._parent()),t},_clearAllFacetsModels:function(){var e=this;this._lFacets.forEach((function(t){var i=e._getFacetContent(t);i&&i.setOccurrence(null)}))},_initializeIDCard:function(e){var i=this;if(e){var n=e.getModel(t.FACET_PROPERTIES);n&&(this._updateThumbnailForModel(n),this.elements.postIdCard&&this.elements.postIdCard.fillFromModel(n),this.elements.postIdCard&&n.addEvent("onChangeAttributes",(function(e,t){var n=!1;t.forEach((function(t){t&&t instanceof r&&(n=i.elements.postIdCard.setValueForSection(e,t)||n)}))})),n.addEvent("onChange:label",(function(){var e=n?n.getComputedTitle():"";i.dispatchEvent("onTitleChanged",e),n.get(t.MODEL_DS_ATTR+"label")&&i.elements.postIdCard&&i.elements.postIdCard.setValueForSection(n,n.get(t.MODEL_DS_ATTR+"label"))})),n.addEvent("onChange:previewUrl",(function(){i._updateThumbnailForModel(this)})),n.addEvent("onChange:type_icon_url",(function(){i._updateThumbnailForModel(this)})))}},getTitle:function(){var e=this._getFirstOccurrence(),i=e?e.getModel(t.FACET_PROPERTIES):null;return i?i.getComputedTitle():""},_updateThumbnailForModel:function(e){if(!0!==this.options.noThumbnail){var i=e.get("previewUrl")?e.get("previewUrl"):e.get("type_icon_url");i=i||"";var n=this._isFacetAuthorized(t.FACET_VIEWS)||e.get("activeThumbnail");this._updateThumbnail(i,n)}},_getCurrentModelType:function(){var e=this.getModels(),t=e.length>0?e[0].get("type"):"",i=t;return t&&"object"==typeof t&&(i=(i=t.get("valueDB"))||t.get("value")),i}})}));