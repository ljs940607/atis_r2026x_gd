define("DS/ReserveWidget/ReserveWidget",["UWA/Core","UWA/Controls/Abstract","DS/LifecycleControls/CommandDialog","DS/LifecycleServices/LifecycleServices","DS/WidgetServices/WidgetServices","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/WAFData/WAFData","DS/Controls/Toggle","DS/Controls/TooltipModel","DS/Controls/ButtonGroup","DS/Controls/Label","UWA/Utils/Cookie","DS/LifecycleServices/LifecyclePerfTimer","css!DS/ReserveWidget/ReserveWidget","i18n!DS/ReserveWidget/assets/nls/ReserveWidgetNls","DS/LifecycleServices/LifecycleServicesSettings","DS/Controls/ProgressBar","DS/ENOCollabToolsUI/tracker/ENOCollabTracker","DS/ENOCollabToolsUI/tracker/ENOCollabTrackerBackEnd"],(function(e,t,r,n,s,o,i,a,l,c,h,u,f,d,p,g,v,m,S){"use strict";return t.extend({TYPE_ROOT_FOLDER_1:"Workspace",TYPE_ROOT_FOLDER_2:"RootFolder",TYPE_FOLDER_1:"Workspace Vault",TYPE_FOLDER_2:"Folder",TYPE_FOLDER_3:"Workspace Folder",TYPE_PERSONAL_FOLDER_1:"Personal Workspace",instToggleCookieNameReserve:"ReserveWidget.InstanceReserve.Toggled",refToggleCookieNameReserve:"ReserveWidget.ReferenceReserve.Toggled",instToggleCookieNameUnreserve:"ReserveWidget.InstanceUnreserve.Toggled",refToggleCookieNameUnreserve:"ReserveWidget.ReferenceUnreserve.Toggled",CAD_ORIGIN_ATTR_NAME:"attribute[XCADExtension.V_CADOrigin]",defaultOptions:{serverName:"",serverUri:"",operation:"",currentUser:"",localContext:""},init:function(e){this._parent(e),this.SelectedItems=[],this.FailureInfo=[],this.SuccessIds=[],this.V5DataIndex=[],this.SuccessInfo=[],this.listOfModified=[];this.refreshDatas={created:[],deleted:[],modified:[]},this.labelWaitingOperation="",this.localContext=this.options.localContext,this._perfTimer=f,this._perfTimer.init("Reserve"),this._perfTimer.start("CommandExecutionDurationLockUnlock");var t={context:this.localContext};o.getInstance(t).getSecurityContext()},isRootFolder:function(e){return e===this.TYPE_ROOT_FOLDER_1||e===this.TYPE_ROOT_FOLDER_2},isFolder:function(e){return e===this.TYPE_FOLDER_1||e===this.TYPE_FOLDER_2||e===this.TYPE_FOLDER_3},isPersonalFolder:function(e){return e===this.TYPE_PERSONAL_FOLDER_1},inFamilyFolder:function(e){return this.isRootFolder(e)||this.isFolder(e)||this.isPersonalFolder(e)},setObjects:function(e){if(console.log("reserveWidget::SetObjects"),console.log(e),0===e.length)throw p.noObject;var t=this;s.removeDuplicate(e,(function(e){return console.log("removing duplicates"),e.physicalId})),e.forEach((function(e){e.hasOwnProperty("physicalId")&&""!=e.physicalId?(console.log("adding an element in SelectedItems"),t.SelectedItems.push(e)):console.log("the element has no physicalid")})),t.trackAppContent()},updateDlg:function(){var e=this.instanceBtn.checkFlag,t=this.referenceBtn.checkFlag,r=this.referenceInstanceBtn.checkFlag;e||t||r?this.cmdDlg._okButton.setDisabled(!1):this.cmdDlg._okButton.setDisabled(!0)},getDefaultToggles:function(e){if("reserve"===this.options.operation)var t=u.get(this.instToggleCookieNameReserve),r=u.get(this.refToggleCookieNameReserve);else t=u.get(this.instToggleCookieNameUnreserve),r=u.get(this.refToggleCookieNameUnreserve);return["false"===t&&"true"===r,"true"===t&&"false"===r,"true"===t&&"true"===r]},saveDefaultToggles:function(e){var t=this.instanceBtn.checkFlag,r=this.referenceBtn.checkFlag,n=this.referenceInstanceBtn.checkFlag;this.cmdDlg._checkboxWithText.checkFlag&&("reserve"===this.options.operation?(u.set(this.instToggleCookieNameReserve,t||n),u.set(this.refToggleCookieNameReserve,r||n)):(u.set(this.instToggleCookieNameUnreserve,t||n),u.set(this.refToggleCookieNameUnreserve,r||n)))},onToggle:function(){this.updateDlg()},getRefAndInstCount:function(){var e={ref:0,inst:0,refTitle:"",instTitle:"",isSW:!1},t=0,r=0,n=[],s=[],o=[],i=[],a=!1;return this.SelectedItems.forEach((function(e){e.hasOwnProperty("cadMaster")&&"3DEXPERIENCE"!==e.cadMaster&&(a=!0),e.hasOwnProperty("objlID")&&""!=e.objlID&&(n.includes(e.objlID)||(t++,n.push(e.objlID),o.push(e.objTitle))),e.hasOwnProperty("relID")&&""!=e.relID&&(s.includes(e.relID)||(r++,s.push(e.relID),i.push(e.relTitle)))})),e.ref=t,e.inst=r,e.refTitle=o,e.instTitle=i,e.isSW=a,e},renderDlgContent:function(){var e=this,t="reserve"==e.options.operation,r=this.getRefAndInstCount(),n=document.createElement("div"),s=this.getDefaultToggles(),o=p.reference,i=p.instance,l=p.referenceInstance,u=t?p.referenceLockTooltip:p.referenceUnlockTooltip,f=t?p.instanceLockTooltip:p.instanceUnlockTooltip,d=t?p.referenceInstanceLockTooltip:p.referenceInstanceUnlockTooltip;if(r.isSW){var g=new h({value:p.swInfo,icon:"info"});g._content.setHTML(p.swInfo),g._content.setStyles({"background-color":"white",color:"#42a2da"}),g._content.parentNode.setStyles({"background-color":"white",color:"#42a2da"}),g.elements._icon.setStyles({"background-color":"white",color:"#42a2da"}),g.inject(n)}this.referenceHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-info ",title:u}),this.instanceHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-info ",title:f}),this.bothHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-info ",title:d});var v=!1;1==r.ref&&1==r.inst?v=!0:l=(o=p.references+" ("+r.ref+")")+" & "+(i=p.instances+" ("+r.inst+")");var m,S=new c({type:"radio"});return o+=" #HELP",i+=" #HELP",l+=" #HELP",this.referenceBtn=new a({type:"radio",label:o,checkFlag:s[0],tooltipInfos:"reference lock tooltip"}),this.referenceSpace=new a({type:"radio",label:r.refTitle[0],checkFlag:!1,tooltipInfos:"",disabled:!0}),m=(m=this.referenceBtn.elements.container.innerHTML).replaceAll("#HELP",this.referenceHelp.outerHTML),this.referenceBtn.elements.container.innerHTML=m,this.instanceBtn=new a({type:"radio",label:i,checkFlag:s[1],tooltipInfos:"instance lock tooltop"}),this.instanceSpace=new a({type:"radio",label:r.instTitle[0],checkFlag:!1,tooltipInfos:"",disabled:!0}),m=(m=this.instanceBtn.elements.container.innerHTML).replaceAll("#HELP",this.instanceHelp.outerHTML),this.instanceBtn.elements.container.innerHTML=m,this.referenceInstanceBtn=new a({type:"radio",label:l,checkFlag:s[2],tooltipInfos:"ref and instance tooltip"}),this.referenceInstanceSpace=new a({type:"radio",label:r.refTitle[0]+" & "+r.instTitle[0],checkFlag:!1,tooltipInfos:"",disabled:!0}),m=(m=this.referenceInstanceBtn.elements.container.innerHTML).replaceAll("#HELP",this.bothHelp.outerHTML),this.referenceInstanceBtn.elements.container.innerHTML=m,S.addChild(this.referenceBtn),v&&S.addChild(this.referenceSpace),S.addChild(this.instanceBtn),v&&S.addChild(this.instanceSpace),S.addChild(this.referenceInstanceBtn),v&&S.addChild(this.referenceInstanceSpace),this.referenceBtn.getContent().setStyles({"margin-right":"5px","margin-left":"5px"}),v&&(this.referenceSpace.getContent().setStyles({"margin-right":"5px","margin-left":"5px"}),this.referenceSpace.getContent().getElementsByClassName("wux-toggle-icon-placeholder wux-icon wux-ui-fa")[0].setStyles({"background-color":"#ffffff",border:"1px solid #ffffff"})),this.instanceBtn.getContent().setStyles({"margin-right":"5px","margin-left":"5px"}),v&&(this.instanceSpace.getContent().setStyles({"margin-right":"5px","margin-left":"5px"}),this.instanceSpace.getContent().getElementsByClassName("wux-toggle-icon-placeholder wux-icon wux-ui-fa")[0].setStyles({"background-color":"#ffffff",border:"1px solid #ffffff"})),this.referenceInstanceBtn.getContent().setStyles({"margin-right":"5px","margin-left":"5px"}),v&&(this.referenceInstanceSpace.getContent().setStyles({"margin-right":"5px","margin-left":"5px"}),this.referenceInstanceSpace.getContent().getElementsByClassName("wux-toggle-icon-placeholder wux-icon wux-ui-fa")[0].setStyles({"background-color":"#ffffff",border:"1px solid #ffffff"})),this.referenceBtn.elements.label.style.marginRight="10px",this.referenceBtn.elements.label.style.marginLeft="10px",this.instanceBtn.elements.label.style.marginRight="10px",this.instanceBtn.elements.label.style.marginLeft="10px",this.referenceInstanceBtn.elements.label.style.marginRight="10px",this.referenceInstanceBtn.elements.label.style.marginLeft="10px",v&&(this.referenceSpace.elements.label.style.marginRight="10px",this.referenceSpace.elements.label.style.marginLeft="10px",this.instanceSpace.elements.label.style.marginRight="10px",this.instanceSpace.elements.label.style.marginLeft="10px",this.referenceInstanceSpace.elements.label.style.marginRight="10px",this.referenceInstanceSpace.elements.label.style.marginLeft="10px"),this.referenceBtn.addEventListener("buttonclick",(function(t){e.onToggle()})),this.instanceBtn.addEventListener("buttonclick",(function(t){e.onToggle()})),this.referenceInstanceBtn.addEventListener("buttonclick",(function(t){e.onToggle()})),S.inject(n),{content:n,count:r}},requestCADOrigins:function(e,t,r){var o=s.getTenantID(),i=["physicalid",this.CAD_ORIGIN_ATTR_NAME,"baseType"];n.listAttributes(o,e,i,t,r)},requestInstanceNames:function(e,t,r){var o=s.getTenantID(),i=e.toString();n.post(o,"/resources/v1/collabServices/reservation/op/getInstanceNames",i,t,r)},checkIfAllRoots:function(){for(var e=0,t=this.SelectedItems.length,r=0;r<t;r++){""==this.SelectedItems[r].relID&&e++}var n=!1;return e==t&&(n=!0),n},checkIfAnyV6Instance:function(){for(var e=this.SelectedItems.length,t=0;t<e;t++)if(this.SelectedItems[t].isV6Rel)return!0;return!1},loadInstanceCADOrig:function(e,t){for(var r=this,n=[],s=this.SelectedItems.length,o=0;o<s;o++){var i=this.SelectedItems[o].parentID;""!=i&&n.push(i)}0==n.length?e():r.requestCADOrigins(n,(function(t){var n=[];t.results&&(n=t.results);for(var o=n.length,i=0;i<o;i++){var a=n[i],l=a.physicalid,c=a.baseType,h=!0;"PLMEntity"==c&&a[r.CAD_ORIGIN_ATTR_NAME]&&(h=!1);for(var u=0;u<s;u++){var f=r.SelectedItems[u];f.baseType=c,f.parentID==l&&"PLMEntity"==c?f.isV6Rel=h:"PLMEntity"!=c&&(f.isV6Rel=!1)}}e()}),t)},checkInputs:function(e,t){var r=this;this.loadInstanceCADOrig((function(){r.checkIfAllRoots()||!r.checkIfAnyV6Instance()||1==r.SelectedItems.length&&"Drawing"===r.SelectedItems[0].type?e(!1):e(!0)}),t)},launchCmd:function(){var e=this;e.checkInputs((function(t){var n=!1;if(e.options.hasOwnProperty("executeOptions")&&void 0!==e.options.executeOptions&&null!==e.options.executeOptions&&e.options.executeOptions.hasOwnProperty("doNotDisplayCmdDialog")&&void 0!==e.options.executeOptions.doNotDisplayCmdDialog&&e.options.executeOptions.doNotDisplayCmdDialog&&(n=!0),t&&!n){var s=e.renderDlgContent(),o=s.content,i=s.count,a="reserve"==e.options.operation?p.reserveTitle:p.unreserveTitle,l=a;if(1==i.inst&&1==i.ref)a=a+" - "+i.refTitle+" ("+i.instTitle+")";else a=a+" - "+(i.inst+i.ref)+" "+p.selections;e.cmdDlg=new r;var c=e.cmdDlg.create(o,{title:a,closeButton:!0,OKBtnText:l,checkboxWithText:p.choiceButton,className:"reserveRefInst",onOk:function(){e.saveDefaultToggles(),e.execute(),e.cmdDlg.destroy()}});if(c.inject(widget.body),c.elements&&c.elements.container){var h=c.elements.container.querySelector(".btn-primary"),u=0,f=0;if(h){var d=h.getSize().width;d>72&&(u=d-72)}var g=c.elements.container.querySelector(".btn-default");if(g){var v=g.getSize().width;v>74&&(f=v-74)}var m=c.elements.container.getElementsByClassName("CommandDialogButtons");if(m.length>0){var S=m[0].getSize().width+u+f;m[0].setStyles({width:S})}}c.setNewSize({}),e.updateDlg()}else e.execute()}),(function(e){console.log(e)}))},reportV5Instances:function(e){if(e.length>0){var t=this;t.requestInstanceNames(e,(function(e){var r=p.v5InstancesExcluded+"<br>";if(Array.isArray(e))for(var n=0;n<e.length;n++)r+=e[n].name+"<br>";t.showError(r)}),(function(e){t.showError(e)}))}},startProgress:function(t,r){var n=this;if(n.chunkSize=r,n.labelWaitingOperation="reserve"==t?UWA.i18n(p.reserving):UWA.i18n(p.unreserving),n.localContext){(void 0===n.localContext.elements||null===n.localContext.elements||n.localContext.elements.hasOwnProperty("container"))&&void 0!==n.localContext.elements&&null!==n.localContext.elements&&n.localContext.elements.hasOwnProperty("container")||(n.localContext.elements.container=widget.body),n.localContext.elements.container.addClassName("masked");var s=e.createElement("div",{class:"mask"}),o=e.createElement("div",{class:"PBwrapper"}),i=e.createElement("div",{class:"PBcontent"});e.createElement("span",{class:"text",text:n.labelWaitingOperation}).inject(i),new UWA.Element("div",{class:"wux-control-inline-container",style:{"vertical-align":"top"}}).inject(i),i.inject(o),o.inject(s),s.inject(n.localContext.elements.container),n.options.renderTo=i,n.chunkSize>0?n.progressbar=new v({value:0}).inject(i):(n.progressbar=void 0,s.style.cursor="wait")}if(null!=n.modifiedElement){n.modifiedElement.forEach((function(e){e.hasClassName("wux-ui-state-disabled")&&e.removeClassName("wux-ui-state-disabled")}))}n.modifiedElement=[];var a=[],l=document.querySelectorAll(".wux-afr-cmdstarter");"function"==typeof l.forEach&&l.forEach((function(e){e.hasClassName("wux-ui-state-disabled")||(e.addClassName("wux-ui-state-disabled"),a.push(e))})),n.modifiedElement=a},stopProgress:function(){var e=this;if(e.localContext){var t=e.localContext.elements.container.getElement(" > .mask");t&&t.destroy(),e.localContext.elements.container.removeClassName("masked")}e.modifiedElement.forEach((function(e){e.hasClassName("wux-ui-state-disabled")&&e.removeClassName("wux-ui-state-disabled")})),e.options.renderTo=e.localContext.elements.container},updateProgress:function(e){var t=this;if(null!=t.progressbar){var r=t.progressbar,n=r.value+100/(e.length/t.chunkSize)/1;n=Math.min(n,100),console.log(n),r.value=n,console.log(r.value)}},getUrls:function(e,t,r){var n=this,s=[],o=[],i=0;i=null==t?(t=0)+e.length-1:t+n.chunkSize-1;for(var a=t;a<=i&&a<e.length;a++){var l=e[a];if(!(l in s)){s[l]="";var c="";if((p=l.split("/")).length>0&&(c=p.length>1&&p[p.length-2].startsWith("cid")?p[p.length-2]+"/"+p[p.length-1]:p[p.length-1]),c in n.SuccessIds||o.push(l),null!=r&&r.length>0){var h=n.V5DataIndex[c];if(h>=0&&h<r.length)for(var u=r[h].rel.split(","),f=0;f<u.length;f++)if(u[f]&&u[f].length>0){var d="model/rel/"+u[f];s[d]="";var p;c="";(p=d.split("/")).length>0&&(c=p.length>1&&p[p.length-2].startsWith("cid")?p[p.length-2]+"/"+p[p.length-1]:p[p.length-1]),c in n.SuccessIds||o.push(d)}}}}return{urls:o,branchorcontent:"type"}},ReserveUnreserveServiceRequest:function(e,t,r,n,s,i){var a=this,l=[];t&&t.forEach((function(e){if(!(e.physicalid in a.V5DataIndex)){var t=l.push(e);a.V5DataIndex[e.physicalid]=t-1}})),o.getInstance().getSecurityContext({onSuccess:function(o){a.ReserveUnreserveServiceRequestWithRefreshCheck(e,t,r,o,n,s,i)},onFailure:function(e){console.log("securityContext is null"),a.stopProgress()}})},execute:function(){var e=this,t=null!=this.instanceBtn&&this.instanceBtn.checkFlag,r=null==this.referenceBtn||this.referenceBtn.checkFlag,n=null!=this.referenceInstanceBtn&&this.referenceInstanceBtn.checkFlag,o=t||n,a=r||n;this.options.hasOwnProperty("executeOptions")&&void 0!==this.options.executeOptions&&null!==this.options.executeOptions&&this.options.executeOptions.hasOwnProperty("entity")&&void 0!==this.options.executeOptions.entity&&null!==this.options.executeOptions.entity&&("reference"===this.options.executeOptions.entity?(o=!1,a=!0):"instance"===this.options.executeOptions.entity&&(o=!0,a=!1));var l=this.options.operation;console.log("reserveWidget::launchCmd "+l);var c=!1,h=[],u=[],f=0,d=[];this.SelectedItems.forEach((function(e){if(a&&(h.push("model/bus/"+e.getPhysicalId()),"3DEXPERIENCE"!=e.cadMaster&&d.push(e.physicalId),f++),o&&"PLMEntity"==e.baseType){var t=e.relID;""!=t&&(e.isV6Rel?(h.push("model/rel/"+e.relID),f++):u.push(t))}}));var p=[],g=[];h.forEach((function(e){e in g||(p.push(e),g[e]="")}));var v=[],m=[];u.forEach((function(e){e in m||(v.push(e),m[e]="")}));var S=-1;this.SelectedItems.length>5&&((S=Math.ceil(p.length/20))>50?S=50:S<5&&(S=5)),this.startProgress(l,S),f>1&&(c=!0);var y=JSON.stringify(this.SelectedItems);console.log("jsonSelectedItems = "+y);var R=void 0;if(e.chunkSize>0&&(R=0),d.length>0){var E=d.join();e._perfTimer.start("Reserve: getV5Instances"),s.get3DSpaceUrlAsync({onComplete:function(t){var r="?",n=s.getTenantID();n&&(r+="tenant="+n);var o=t+"/resources/v1/collabServices/reservation/op/getV5Instances"+r;i.authenticatedRequest(o,{method:"POST",type:"json",timeout:108e5,data:E,headers:{Accept:"application/json","Content-Type":"application/json"},onComplete:function(t){e._perfTimer.stop("Reserve: getV5Instances"),e.ReserveUnreserveServiceRequest(v,t,l,p,c,R)}})}})}else{e.ReserveUnreserveServiceRequest(v,undefined,l,p,c,R)}},onRefresh:function(){console.log("onRefresh->")},showNotification:function(e){var t={eventID:"primary",msg:e};this.dispatchEvent("onNotification",t)},showError:function(e){console.log("showError "+e);var t={eventID:"error",msg:e};this.dispatchEvent("onNotification",t)},ReserveUnreserveServiceRequestWithRefreshCheck:function(e,t,r,n,o,a,l){var c=this;return new UWA.Class.Promise((function(h,u){var f;if(null==n||""==n||!n.hasOwnProperty("SecurityContext")){var d={message:UWA.i18n("ErrorSecurityContextEmpty"),code:"ERROR"};return this.showError(d),void console.log("***** Empty security context *****")}var p="";0!=n.SecurityContext.indexOf("ctx::")&&(p="ctx::"),f=p+n.SecurityContext,console.log("SecurityContext="),console.log(f);var v=g.get3DSpaceWSUrl(s.getTenantID(),"/resources/lifecycle/util/getExpression",null);i.authenticatedRequest(v,{type:"json",method:"GET",proxy:"passport",headers:g.getHeaders(f),data:{expression:"StopRefreshViewForReserveExpression"},onComplete:function(n){var s=!1;n.hasOwnProperty("result")?"true"!==n.result&&(s=!0):s=!0;"reserve"==r?c.ReserveServiceRequest(e,t,o,f,a,s,l):"unreserve"==r&&c.UnReserveServiceRequest(e,t,o,f,a,s,l)},onFailure:function(n,s,i){if(null!=s&&s.hasOwnProperty("error")&&void 0!==s.error&&null!==s.error&&s.error.trim().length>0){var h=s.error;(h.contains("1501009")||h.contains("1500178"))&&(h=lifecycleWidgetNls.invalidCredential),c.showError(h)}console.log("ReserveUnreserveServiceRequestWithRefreshCheck: Failure..."+n),"reserve"==r?c.ReserveServiceRequest(e,t,o,f,a,performRefreshView,l):"unreserve"==r&&c.UnReserveServiceRequest(e,t,o,f,a,performRefreshView,l)},onTimeout:function(){"reserve"==r?c.ReserveServiceRequest(e,t,o,f,a,performRefreshView,l):"unreserve"==r&&c.UnReserveServiceRequest(e,t,o,f,a,performRefreshView,l)}})}))},refreshView:function(e){var t=this;console.log("******* refreshing PADCommandProxy *************");var r;r="undefined"!=typeof widget&&null!==widget?{authored:{modified:t.listOfModified,originWidgetId:widget.id}}:{authored:{modified:t.listOfModified}};var n=e.create();n.authored({authored:!0}),n.refresh(r),void 0!==t.localContext.refreshView?(console.log("$$$ calling refreshView - Product Editor case $$$"),t.localContext.refreshView(t.refreshDatas)):t.refreshDatas.modified.length>0&&(console.log("$$$ Folder Editor - RefreshView $$$"),void 0!==t.localContext.RefreshView&&t.localContext.RefreshView(t.refreshDatas)),n.destroy()},showSuccessMessage:function(e,t){var r=this;if(0!=r.SuccessInfo.length){var n=1==t?UWA.i18n("reservationSucceeded"):UWA.i18n("unreservationSucceeded");if(1==e){var s=UWA.i18n("instance"),o=UWA.i18n("reference"),i=[];r.SuccessInfo.forEach((function(e){var t=e.url.includes("model/rel/")?s:o;t+=" "+e.title,-1==i.indexOf(t)&&(i.push(t),n+="<br>"+t)}))}r.showNotification(n),console.log("RESERVE SUCCESS")}},ReserveServiceRequest:function(e,t,r,n,o,a,l){var c=this;console.log("RESERVE:");var h=c.getUrls(r,l,t);console.log(h);this.localContext;c.fakeItemInProcess=l;var u=function(s){c._perfTimer.stop("Reserve: reserve"),console.log("reserve: COMPLETED"),c.updateProgress(r);var i=[];s.results&&(i=s.results),console.log(i);i.length;i.forEach((function(e){if(e.errors){var t=e.errors.length;if(t<=0)c.FailureInfo[e.errors[t-1].physicalid]={physicalid:e.errors[t-1].physicalid,message:""};else{var r=e.errors[t-1].message;c.FailureInfo[e.errors[t-1].physicalid]={physicalid:e.errors[t-1].physicalid,message:r}}}else{c.listOfModified.push(e.physicalid);var n="";void 0!==e.reservedby&&(n=e.reservedby),void 0!==e.locker&&(n=e.locker),console.log("&&&& locker ="+n),c.refreshDatas.modified.push({physicalid:e.physicalid,attributes:[{name:"ds6w:reserved",value:"TRUE"},{name:"ds6w:reservedBy",value:e.lockerName},{name:"ds6w:displayName",value:e.lockerName}]}),c.SuccessInfo.push(e),c.SuccessIds[e.physicalid]=""}})),null!=l&&l+c.chunkSize<r.length?c.ReserveServiceRequest(e,t,r,n,o,a,l+c.chunkSize):require(["DS/PADUtils/PADCommandProxy"],(function(t){var r=!1;for(var s in c.FailureInfo){r=!0;break}for(var o in c.chunkSize>0&&1==r&&c.SuccessInfo.forEach((function(e){e.physicalid in c.FailureInfo&&delete c.FailureInfo[e.physicalid]})),r=!1,c.FailureInfo){r=!0;var i=c.FailureInfo[o].message;c.showError(i),console.log("RESERVE ERROR "+i)}c.reportV5Instances(e),c.showSuccessMessage(r,!0),1==a&&c.listOfModified.length>0&&c.refreshView(t),c.stopProgress(),c._perfTimer.stop("CommandExecutionDurationLockUnlock");c._perfTimer.printTimeShowDialogAndProcess(["CommandExecutionDurationLockUnlock","Reserve: getV5Instances","Reserve: reserve","Reserve: unreserve"],n)}))},f=function(e,t){if(c._perfTimer.stop("Reserve: reserve"),console.log("Failed to reserve data"),null!=t){if(t.hasOwnProperty("error")&&void 0!==t.error&&null!==t.error&&t.error.trim().length>0){var r=t.error;c.showError(r)}}else e.hasOwnProperty("error")?c.showError(e.error):e.hasOwnProperty("message")&&c.showError(e.message);c.showSuccessMessage(!0,!0),require(["DS/PADUtils/PADCommandProxy"],(function(e){1==a&&c.refreshView(e)})),c.stopProgress(),c._perfTimer.stop("CommandExecutionDurationLockUnlock");c._perfTimer.printTimeShowDialogAndProcess(["CommandExecutionDurationLockUnlock","Reserve: getV5Instances","Reserve: reserve","Reserve: unreserve"],n)},d=function(e){c._perfTimer.stop("Reserve: reserve"),console.log("Timeout error"),e.hasOwnProperty("error")?c.showError(e.error):e.hasOwnProperty("message")&&c.showError(e.message),c.showSuccessMessage(!0,!0),require(["DS/PADUtils/PADCommandProxy"],(function(e){1==a&&c.refreshView(e)})),c.stopProgress(),c._perfTimer.stop("CommandExecutionDurationLockUnlock");c._perfTimer.printTimeShowDialogAndProcess(["CommandExecutionDurationLockUnlock","Reserve: getV5Instances","Reserve: reserve","Reserve: unreserve"],n)};this.options.serverName,this.options.serverUri;s.get3DSpaceUrlAsync({onComplete:function(e){c.options.currentUser;var t="?",r=s.getTenantID();r&&(t+="tenant="+r+"&"),t+=o?"isMultiSel=1&":"isMultiSel=0&";["physicalid"].forEach((function(e){t+="select="+e+"&"}));var a=e+"/resources/v1/collabServices/reservation/op/reserve"+t;console.log("url="+a),S.enrichRequestWithMetrics(h,{UXName:"Lock"});var l=g.getHeaders(encodeURIComponent(n));c._perfTimer.start("Reserve: reserve"),i.authenticatedRequest(a,{method:"POST",type:"json",timeout:108e5,headers:l,cache:-1,proxy:"passport",onComplete:u,data:JSON.stringify(h),onFailure:f,onTimeout:d})}})},UnReserveServiceRequest:function(e,t,r,n,o,a,l){var c=this;console.log("UNRESERVE:");var h=c.getUrls(r,l,t);console.log(h);var u=function(s){c._perfTimer.stop("Reserve: unreserve"),console.log("unreserve: COMPLETED"),c.updateProgress(r);var i=[];s.results&&(i=s.results),console.log(i),i.forEach((function(e){if(e.errors){var t=e.errors.length;if(t<=0)c.FailureInfo[e.errors[t-1].physicalid]={physicalid:e.errors[t-1].physicalid,message:""};else{var r=e.errors[t-1].message;c.FailureInfo[e.errors[t-1].physicalid]={physicalid:e.errors[t-1].physicalid,message:r}}}else c.listOfModified.push(e.physicalid),c.refreshDatas.modified.push({physicalid:e.physicalid,operation:"update",attributes:[{name:"ds6w:reserved",value:"FALSE"},{name:"ds6w:reservedBy",value:""}]}),c.SuccessInfo.push(e),c.SuccessIds[e.physicalid]=""})),null!=l&&l+c.chunkSize<r.length?c.UnReserveServiceRequest(e,t,r,n,o,a,l+c.chunkSize):require(["DS/PADUtils/PADCommandProxy"],(function(t){var r=!1;for(var s in c.FailureInfo){r=!0;break}for(var o in c.chunkSize>0&&1==r&&c.SuccessInfo.forEach((function(e){e.physicalid in c.FailureInfo&&delete c.FailureInfo[e.physicalid]})),r=!1,c.FailureInfo){r=!0;var i=c.FailureInfo[o].message;c.showError(i),console.log("RESERVE ERROR "+i)}c.reportV5Instances(e),c.showSuccessMessage(r,!1),1==a&&c.listOfModified.length>0&&c.refreshView(t),c.stopProgress(),c._perfTimer.stop("CommandExecutionDurationLockUnlock");c._perfTimer.printTimeShowDialogAndProcess(["CommandExecutionDurationLockUnlock","Reserve: getV5Instances","Reserve: reserve","Reserve: unreserve"],n)}))},f=function(e,t){if(c._perfTimer.stop("Reserve: unreserve"),console.log("Failed to unreserve data"),null!=t){if(t.hasOwnProperty("error")&&void 0!==t.error&&null!==t.error&&t.error.trim().length>0){var r=t.error;c.showError(r)}}else e.hasOwnProperty("error")?c.showError(e.error):e.hasOwnProperty("message")&&c.showError(e.message);c.showSuccessMessage(!0,!1),require(["DS/PADUtils/PADCommandProxy"],(function(e){1==a&&c.refreshView(e)})),c.stopProgress(),c._perfTimer.stop("CommandExecutionDurationLockUnlock");c._perfTimer.printTimeShowDialogAndProcess(["CommandExecutionDurationLockUnlock","Reserve: getV5Instances","Reserve: reserve","Reserve: unreserve"],n)},d=function(e){c._perfTimer.stop("Reserve: unreserve"),console.log("Timeout error"),e.hasOwnProperty("error")?c.showError(e.error):e.hasOwnProperty("message")&&c.showError(e.message),c.showSuccessMessage(!0,!1),require(["DS/PADUtils/PADCommandProxy"],(function(e){1==a&&c.refreshView(e)})),c.stopProgress(),c._perfTimer.stop("CommandExecutionDurationLockUnlock");c._perfTimer.printTimeShowDialogAndProcess(["CommandExecutionDurationLockUnlock","Reserve: getV5Instances","Reserve: reserve","Reserve: unreserve"],n)};this.options.serverName,this.options.serverUri;c._perfTimer.start("Reserve: unreserve"),s.get3DSpaceUrlAsync({onComplete:function(e){var t="?",r=s.getTenantID();r&&(t+="tenant="+r+"&"),t+=o?"isMultiSel=1&":"isMultiSel=0&";["physicalid"].forEach((function(e){t+="select="+e+"&"}));var a=e+"/resources/v1/collabServices/reservation/op/unreserve"+t;console.log("url="+a),S.enrichRequestWithMetrics(h,{UXName:"Unlock"});var l=g.getHeaders(encodeURIComponent(n));i.authenticatedRequest(a,{method:"POST",type:"json",timeout:108e5,headers:l,cache:-1,proxy:"passport",onComplete:u,data:JSON.stringify(h),onFailure:f,onTimeout:d})}})},trackAppContent:function(){var e=this,t={UXName:"reserve"==e.options.operation?"Lock":"Unlock",models:e.SelectedItems};e.trackerEvent=m.createInitActionEvent(t,e.trackerEvent),m.checkAndTrackPageEvent(e.trackerEvent)}})}));