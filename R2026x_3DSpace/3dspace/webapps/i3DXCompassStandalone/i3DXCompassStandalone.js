require(["UWA/Core","UWA/Utils","DS/i3DXCompass/i3DXCompass","DS/i3DXCompassServices/i3DXCompassPubSub","DS/i3DXCompass/Feature","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],(function(o,e,s,a,n,r){"use strict";var i,t,l=o.extendElement(document.querySelector(".column-left")),d=null,c=null,p={},u=!1,m=function(){return"undefined"!=typeof compassRichWithCef&&compassRichWithCef},w=function(){return window.ds&&"MOBILE"===window.ds.env};a.subscribe("initializeCompassStandalone",(function(o){y(o)})),window.location.hash&&window.location.hash.substring(1,window.location.hash.length).split("/").forEach((function(o){var e=o.split(":");p[e[0]]=e[1]})),l.addClassName("compass-standalone"),p.userId||l.addClassName("compass-standalone-public"),p.emulateMobile&&(u=!0),window.addEventListener("hashchange",(function(){m()?(window.location.hash.substring(1,window.location.hash.length).split("/").forEach((function(o){var e=o.split(":");p[e[0]]=e[1]})),(n.getExtraWhereUsedRoles()||p.processes)&&n.getExtraWhereUsedRoles()!==p.processes?window.location.reload():s._private._loadQuadrant(p.quadrant)):window.location.reload()}),!1),m()?o.extendElement(document.querySelector("body")).addClassName("compassRichWithCef"):o.extendElement(document.querySelector("body")).addClassName("compass-standalone-v3"),p.quadrant&&s._private._setQuadrant(p.quadrant),!p.platform&&m()&&(t=!0);var f="",h="";if(w())d=e.buildUrl(window.location.href.replace(window.location.hash,""),"../../"),d+="enovia/";else if("dsrtv:"===window.location.protocol)d=window.location.href.replace(window.location.hash,"");else{var v,g;d=e.buildUrl(window.location.href.replace(window.location.hash,""),"../../"),f=e.buildUrl(window.location,"assets/PassportStub"),h=e.buildUrl(d,"resources/AppsMngt/user/proxyticket"),t?(v=d+"common/emxCrossDomainProxy.jsp",g=d+"common/emxDownloadPlatform.jsp",o.Data.proxies.ajax=g,o.Data.proxies.passport=v):(v=d+"resources/AppsMngt/emxCrossDomainProxy.jsp",g=d+"resources/AppsMngt/api/v1/proxy/download-platform",o.Data.proxies.ajax=g,o.Data.proxies.passport=v)}var C=o.Utils.getQueryString(window.location.href,"addinmode");C&&(i={value:C}),p.links&&"false"!==p.links&&(c="V2",document.querySelector("body").addClassName("support-quick-link-fix-mobile-app")),t&&(p.platform="OnPremise",console.warn("Legacy usage of the compass, Platform is MANDATORY"));var b=p.platform||null;!b&&window.location.host.contains("-compass.")&&(b=window.location.host.replace(/^([^-]+)-.*$/,"$1").toUpperCase());var y=function(e){p.processes&&n.setExtraWhereUsedRoles(p.processes),s.initialize({proxy:"passport",compassTarget:"compass-container",appsTarget:"my-apps-container",closable:!(!m()&&!w()),version:c,addinMode:i,platform:b,myAppsBaseUrl:e&&e.myAppsBaseUrl||d,passportUrl:e&&e.passportUrl||f,userId:p.userId,proxyTicketUrl:e&&e.myAppsBaseUrl||h,launchOnSameDomain:function(e){return o.log(e+" is on same domain"),window.open(e,"_blank"),!0},lang:p.lang||"en",onOpen:function(){l.addClassName("opened")},onClose:function(){m()||l.removeClassName("opened")},enableWidgetDrag:function(){},onRoleChange:function(e,s){o.log("role change"),o.log(e+":"+s)}}),window.ds&&"MOBILE"===window.ds.env&&a.subscribe("private.viewIsReady",(function(o){s.showAccordion()}))};"dsrtv:"===window.location.protocol?y():window.ds&&"MOBILE"===window.ds.env||(u&&(window.ds={env:"MOBILE"}),r.getServiceUrl({config:{lang:p.lang||"en",userId:p.userId,myAppsBaseUrl:d},platformId:b,serviceName:"3dpassportnta",onComplete:function(o){var e;e=Array.isArray(o)?o[0]&&o[0].url:o,y({passportUrl:e?e.replace("/cas",""):""})}})),a.subscribe("compassEvent",(function(o){s.showAccordion()}))}));