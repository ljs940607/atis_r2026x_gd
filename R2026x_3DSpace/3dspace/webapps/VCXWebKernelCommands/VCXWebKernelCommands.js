var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebKernelCommands/VCXCommandManager",["require","exports","DS/CoreEvents/Events","DS/VCXWebComponents/VCXWebComponentBaseExperience"],(function(e,t,i,r){"use strict";r=__importDefault(r);class s extends r.default{constructor(){super(),this._stackCmd=[],this._stackCmdUndo=[],this._isUnDoRunning=!1,this._isReDoRunning=!1,this._isDoRunning=!1,this._pushLevel=0,this._bTransaction=!1,this._stackLevelOfTransaction=[],this._stackMaxSize=500}unInitialize(){this._stackCmd=[],this._stackCmdUndo=[],this._isUnDoRunning=!1,this._isReDoRunning=!1,this._isDoRunning=!1,this._pushLevel=0,this._bTransaction=!1,this._stackLevelOfTransaction=[],this._stackMaxSize=500}postInitialize(){}SetStackMaxSize(e){this._stackMaxSize=e}GetStackMaxSize(){return this._stackMaxSize}async Do(e){"VCXCmdChangeSelection"!==e.GetType()?(0===this._pushLevel&&(this._isDoRunning=!0),this._pushLevel++,i.publish({event:"VCX_COMMAND_MANAGER_DO",data:{command:e,pushLevel:this._pushLevel}}),e.IsAsync()?await e.Do():e.Do(),this._pushLevel--,0===this._pushLevel&&(this._isDoRunning=!1)):e.Do()}async Push(e){this._isUnDoRunning||(this._isReDoRunning||(this._isDoRunning?e.IsAsync()?await this.Do(e):this.Do(e):(this._pushLevel>0&&e.SetLinkedCmd(!0),this._bTransaction&&(e=this.MergeTransaction(e)),this._stackCmdUndo=[],this._pushLevel++,this._stackCmd.length===this._stackMaxSize&&(this._stackCmd.shift(),this._stackLevelOfTransaction=this._stackLevelOfTransaction.map((e=>Math.max(e-1,0)))),this._stackCmd.push(e),e.SaveContext(),i.publish({event:"VCX_COMMAND_MANAGER_DO",data:{command:e,pushLevel:this._pushLevel}}),e.IsAsync()?await e.Do():e.Do(),this._pushLevel--,i.publish({event:"VCX_UNDOREDO_STACK_UPDATE"}))))}MergeTransaction(e){var t=e.GetType();if(!e.IsMergeable())return e;for(var i=this._stackLevelOfTransaction.length,r=this._stackLevelOfTransaction[i-1],s=null,o=this._stackCmd.length-1;o>=r;o--){var n=this._stackCmd[o];if(n)if(!n.IsLinkedCmd()){s=n;break}}return s?s.GetType()!==t?e:(this.Undo(!0),e=s.Merge(e)):e}async Undo(e=!1){if(e);else if(this._bTransaction)return void console.log("#### ERROR : undo inside a start transaction");this._isUnDoRunning=!0;for(var t=this._stackCmd.pop();t&&t.IsLinkedCmd();)t.IsAsync()?await t.Undo():t.Undo(),this._stackCmdUndo.push(t),t=this._stackCmd.pop();t&&(t.IsAsync()?await t.Undo():t.Undo(),this._stackCmdUndo.push(t)),this._isUnDoRunning=!1,this._bTransaction||i.publish({event:"VCX_UNDOREDO_DONE"})}async Redo(){console.log("#### Redo"),this._isReDoRunning=!0;var e=this._stackCmdUndo.pop();for(e&&(this._stackCmd.push(e),e.IsAsync()?await e.Redo():e.Redo()),e=this._stackCmdUndo.pop();e&&e.IsLinkedCmd();)e.IsAsync()?await e.Redo():e.Redo(),this._stackCmd.push(e),e=this._stackCmdUndo.pop();e&&this._stackCmdUndo.push(e),this._isReDoRunning=!1,i.publish({event:"VCX_UNDOREDO_DONE"})}Empty(){this._stackCmd=[],this._stackCmdUndo=[],i.publish({event:"VCX_UNDOREDO_STACK_UPDATE"})}StartTransaction(){this._bTransaction&&console.error("### ERROR : WE ARE ALREADY INSIDE A TRANSACTION ###"),this._bTransaction=!0,this._stackLevelOfTransaction.push(this._stackCmd.length),i.publish({event:"VCX_STARTED_TRANSACTION"})}CancelTransaction(){var e=this._stackLevelOfTransaction.pop();let t=this._stackCmd.length-e;for(let e=0;e<t;e++){var r=this._stackCmd.pop();r&&r.Undo()}this._bTransaction=!1,i.publish({event:"VCX_END_TRANSACTION"})}EndTransaction(e){var t=this._stackLevelOfTransaction.pop();if(!(this._stackLevelOfTransaction.length>0))if(void 0!==t){for(var r=t+1;r<this._stackCmd.length;r++){this._stackCmd[r].SetLinkedCmd(!0)}if(t<this._stackCmd.length){var s=this._stackCmd[t];if(s){var o="Transaction commands";e&&(o=e),s.GetTitle=function(){return o}}}this._bTransaction=!1,i.publish({event:"VCX_END_TRANSACTION"})}else console.log("No index of start found here !")}}return Object.defineProperty(s.prototype,"componentType",{enumerable:!0,get:function(){return"VCXCommandManager"}}),s})),define("DS/VCXWebKernelCommands/VCXCommand",["require","exports"],(function(e,t){"use strict";return class{constructor(e){this._type="",this._title="",this._experienceBase=e,"_experienceBase"in this._experienceBase&&(this._experienceBase=this._experienceBase._experienceBase),this._bLinkedCmd=!1,this.__callback=null,this._isAsync=!1,this._parameter=null,this._deferredCBPromise=null}SetCallback(e,t){this.__callback=e,this._parameter=t,this._deferredCBPromise=UWA.Promise.deferred(),this._isAsync||(console.warn("The command is not set to _isAsync. Setting it automatically"),this._isAsync=!0)}GetType(){return this._type}GetTitle(){return this._title}async _callback(){this.__callback&&await this.__callback(this._parameter),this._deferredCBPromise&&(this._deferredCBPromise.resolve(this._parameter),this._deferredCBPromise=null)}IsLinkedCmd(){return this._bLinkedCmd}SetLinkedCmd(e){this._bLinkedCmd=e}Do(){if(this._deferredCBPromise)return this._deferredCBPromise.promise}Redo(){return this.Do()}Undo(){if(this.Invert(),this.IsAsync())return new Promise((async e=>{let t=await this.Do();this.Invert(),e(t)}));this.Do(),this.Invert()}Invert(){}SaveContext(){}IsMergeable(){return!1}Merge(e){throw new Error("Not implemented here")}IsAsync(){return this._isAsync}persistencyInformation(){return{implemented:!1,module:"DS/VCXWebKernelCommands",toPersistentObject:null,fromPersistentObject:null}}}}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebKernelCommands/VCXCmdChangeProperties",["require","exports","DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebProperties/VCXPropertyMap"],(function(e,t,i,r,s){"use strict";r=__importDefault(r),s=__importDefault(s);class o extends r.default{constructor(e){super(e),this._type="VCXCmdChangeProperties",this._title="Change properties",this._propertyMap=new s.default,this._bLockEvents=!1}ChangeProperty(e,t,i=null){var r=e.GetHashing();if(r);else{const t=this._experienceBase.getManager("VCXScenarioManager");t.ModifiableServer?.AddModifiable(e),r=e.GetHashing()}this._propertyMap.AddOrModifyProperty(r,t.Clone())}ChangePropertyValue(e,t,i){var r=e.GetHashing();if(r);else{const t=this._experienceBase.getManager("VCXScenarioManager");t.ModifiableServer?.AddModifiable(e),r=e.GetHashing()}let s=e.GetProperty(t);s.SetPropertyValue(i),this._propertyMap.AddOrModifyProperty(r,s)}ChangePropertiesFromMap(e){this._propertyMap=e.Clone()}ChangePropertiesFromSet(e,t){var i=e.GetHashing();if(i);else{let t=this._experienceBase.getManager("VCXScenarioManager");t.ModifiableServer?.AddModifiable(e),i=e.GetHashing()}this._propertyMap.AddOrModifyPropertySet(i,t.Clone())}SetLockEvents(e){this._bLockEvents=e}}return o}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebKernelCommands/VCXCmdChangeComponent",["require","exports","DS/VCXWebKernelCommands/VCXCommand"],(function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{constructor(e){super(e),this._type="VCXCmdChangeComponent",this._title="Change component",this._listCompToAdd=[],this._listCompToRemove=[],this._bLockEvents=!1}RemoveComponents(e){this._listCompToRemove=this._listCompToRemove.concat(e)}AddComponents(e){this._listCompToAdd=this._listCompToAdd.concat(e)}Do(){for(var e=0;e<this._listCompToAdd.length;e++){(i=this._listCompToAdd[e])&&this._experienceBase.ComponentsMap.AddComponent(i)}for(var t=0;t<this._listCompToRemove.length;t++){var i;if(i=this._listCompToRemove[t]){var r=this._listCompToRemove[t].GetID();this._experienceBase.ComponentsMap.RemoveComponent(r)}}}Invert(){var e=this._listCompToAdd;this._listCompToAdd=this._listCompToRemove,this._listCompToRemove=e}}return r}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebKernelCommands/VCXCmdChangeModifiable",["require","exports","DS/CoreEvents/Events","DS/VCXWebProperties/VCXPropertyMap","DS/VCXWebKernelCommands/VCXCommand"],(function(e,t,i,r,s){"use strict";r=__importDefault(r),s=__importDefault(s);class o extends s.default{constructor(e){super(e),this._type="VCXCmdChangeModifiable",this._title="Change modifiable",this._modTracks={},this._styles={},this._neutrals=new r.default,this._listModToAdd=[],this._listModToRemove=[],this._bLockEvents=!1}RemoveModifiables(e){this._listModToRemove=this._listModToRemove.concat(e)}AddModifiables(e){this._listModToAdd=this._listModToAdd.concat(e)}Do(){let e=this._experienceBase.getManager("VCXScenarioManager");for(var t=e.ModifiableServer,r=e.GetScenarios(),s=0;s<this._listModToAdd.length;s++){var o=this._listModToAdd[s];if(d=o.GetHashing()){var n=this._modTracks[d];if(n)for(var a in n)if(n.hasOwnProperty(a)){var l=n[a];e.AddObjectAnimation(this._listModToAdd[s],r[a],l)}if(this._styles[d]){const e=o.QueryInterface("VCXIStylesHolder");e&&e.SetStyle(this._styles[d])}}t?.AddModifiable(o);var h=this._neutrals.GetPropertySet(o.GetHashing());h&&e.AddNeutrals(o,h)}for(var c=0;c<this._listModToRemove.length;c++){var d=this._listModToRemove[c].GetHashing(),_=e.GetScenarios();for(var p in _)if(_.hasOwnProperty(p)){var u=_[p];e.RemoveObjectAnimation(d,u)}e.RemoveModifiableFromRestoreSet(d),t?.RemoveModifiable(d),e.RemoveNeutrals(d)}this._bLockEvents||(i.publish({event:"VCX_MODIFIABLE_CHANGED"}),i.publish({event:"VCX_KEYS_CHANGED"}))}Invert(){var e=this._listModToAdd;this._listModToAdd=this._listModToRemove,this._listModToRemove=e}SaveContext(){let e=this._experienceBase.getManager("VCXScenarioManager");for(var t=e.GetScenarios(),i=0;i<this._listModToRemove.length;i++){var r=!1,s={},o=this._listModToRemove[i],n=o.GetHashing();for(var a in this._styles[n]=o._styleID,t)if(t.hasOwnProperty(a)){var l=t[a].GetObjectAnimation(n);l&&(s[a]=l,r=!0)}r&&(this._modTracks[n]=s);var h=e.GetNeutrals(n);h&&this._neutrals.AddOrModifyPropertySet(n,h)}}SetLockEvents(e){this._bLockEvents=e}}return o}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebKernelCommands/VCXCmdChangePropertiesVolatile",["require","exports","DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCmdChangeProperties","DS/VCXWebProperties/VCXPropertyMap"],(function(e,t,i,r,s){"use strict";r=__importDefault(r),s=__importDefault(s);class o extends r.default{constructor(e){super(e),this._type="VCXCmdChangePropertiesVolatile",this._title="Change properties volatile",this._propertyMap=new s.default,this._propertyMapOld=new s.default,this.mapModifiables={},this._bLockEvents=!1}ChangeProperties(e){for(var t in e.map)if(e.map.hasOwnProperty(t)){var i=this.mapModifiables[t],r=e.GetPropertySet(t);if(r.map.hasOwnProperty("Modifiable.StyleID")){var s=r.map["Modifiable.StyleID"];i.OnChangeProperty("Modifiable.StyleID",s.GetPropertyValue())}for(var o in r.map)if(r.map.hasOwnProperty(o)){if("Modifiable.StyleID"==o)continue;s=r.map[o];i.OnChangeProperty(o,s.GetPropertyValue())}i.OnChangePropertiesEnd()}}ChangeProperty(e,t){var i=e.GetHashing();this.mapModifiables[i]=e,this._propertyMap.AddOrModifyProperty(i,t.Clone())}Do(){this.ChangeProperties(this._propertyMap);this._bLockEvents||i.publish({event:"VCX_PROPERTIES_CHANGED",data:this._propertyMap}),this._callback()}Invert(){var e=this._propertyMap;this._propertyMap=this._propertyMapOld,this._propertyMapOld=e}SaveContext(){for(var e in this._propertyMap.map)if(this._propertyMap.map.hasOwnProperty(e)){var t=this.mapModifiables[e],i=this._propertyMap.GetPropertySet(e);for(var r in i.map)if(i.map.hasOwnProperty(r)){var s=t.GetProperty(r);this._propertyMapOld.AddOrModifyProperty(e,s)}}}}return o}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebKernelCommands/VCXCmdChangeKeys",["require","exports","DS/CoreEvents/Events","DS/WebRBTree/WebRBIterator","DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebTracks/VCXKey","DS/VCXWebTracks/VCXTrack","DS/VCXKeyFramer/VCXObjectAnimation"],(function(e,t,i,r,s,o,n,a){"use strict";s=__importDefault(s),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a);class l extends s.default{constructor(e){super(e),this._type="VCXCmdChangeKeys",this._title="Change keys",this._keysForDo=[],this._keysForUndo=[],this._bLockEvents=!1,this._bLockUpdateProperties=!1,this._bCloneValues=!0}Do(){for(var e={setModifiablesTrackRemoved:{},setModifiablesTrackModified:{},keysForDo:[]},t=0;t<this._keysForDo.length;t++){var r=this._keysForDo[t],s=r.scenario.GetObjectAnimation(r.modifiable.GetHashing());if(s||r.value&&(s=new a.default,r.scenario.AddObjectAnimation(r.modifiable.GetHashing(),s)),s){var l=s.GetTrack(r.propertyName);if(l||r.value&&(l=new n.default,s.AddTrack(r.propertyName,l)),l){if(e.setModifiablesTrackModified[r.modifiable.GetHashing()]=!0,r.value){let e=this._bCloneValues?r.value.Clone():r.value;var h=new o.default(r.frame,e);r.easing&&h.SetEasing(r.easing),l.AddKey(h)}else l.RemoveKey(r.frame),l.IsEmpty()&&(s.RemoveTrack(r.propertyName),e.setModifiablesTrackRemoved[r.modifiable.GetHashing()]=!0,0===s.GetTrackNumber()&&r.scenario.RemoveObjectAnimation(r.modifiable.GetHashing()));this._bLockUpdateProperties||this._experienceBase.getManager("VCXScenarioManager").UpdateProperty(r.modifiable.GetHashing(),r.propertyName)}}}this._bLockEvents||(e.keysForDo=this._keysForDo,i.publish({event:"VCX_KEYS_CHANGED",data:e}),i.publish({event:"VCX_PROPERTIES_CHANGED"}))}Invert(){var e=this._keysForDo;this._keysForDo=this._keysForUndo,this._keysForUndo=e}SaveContext(){for(var e=0;e<this._keysForDo.length;e++){var t=this._keysForDo[e],i={scenario:t.scenario,modifiable:t.modifiable,propertyName:t.propertyName,frame:t.frame,value:t.value,easing:t.easing};this._keysForUndo.push(i)}}ChangeKey(e,t,i,r,s=null,o){if(e){var n={scenario:e,modifiable:t,propertyName:i,frame:r,easing:o};s&&(this._bCloneValues?n.value=s.Clone():n.value=s),this._keysForDo.push(n)}}MoveKey(e,t,i,r,s){if(null!==t){var o=null,n=e.GetObjectAnimation(t.GetHashing());if(n){var a=n.GetTrack(i);if(a){var l=a.GetKey(r);l&&(o=l.GetValue())}}o&&(this.ChangeKey(e,t,i,r,null),this.ChangeKey(e,t,i,s,o))}}RemoveTracks(e,t,i){var s=e.GetObjectAnimation(t.GetHashing());if(s){i&&i.length>0||(i=[],s.GetListTrackNames(i));for(var o=0;o<i.length;o++){var n=i[o],a=s.GetTrack(n);if(a)for(var l=a._treekeys,h=new r(l),c=h.next();null!==c;)this.ChangeKey(e,t,n,c.GetFrame()),c=h.next()}}}SetLockEvents(e){this._bLockEvents=e}SetLockUpdateProperties(e){this._bLockUpdateProperties=e}SetCloneValues(e){this._bCloneValues=e}}return l}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebKernelCommands/VCXCmdApplyScenario",["require","exports","DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebProperties/VCXPropertyMap"],(function(e,t,i,r){"use strict";i=__importDefault(i),r=__importDefault(r);class s extends i.default{constructor(e){super(e),this._type="VCXCmdApplyScenario",this._title="Apply scenario",this._propMapForUndo=new r.default,this._scenarioForDo=null,this._viewForUndo=null,this._bDoNotApplyVis=!1}ApplyScenario(e,t=!1,i){this._scenarioForDo=e,t&&(this._bDoNotApplyVis=t),i&&(this._viewForUndo=i)}Do(){var e=this._experienceBase.getManager("VCXVisuManager");let t=this._experienceBase.getManager("VCXScenarioManager");if(e&&(e.CameraControlsViewpoint=!0),!this._scenarioForDo)throw new Error("No scenario do");if(t.ApplyView(this._scenarioForDo,this._bDoNotApplyVis),e&&(e.CameraControlsViewpoint=!1),this._scenarioForDo.GetZoomFitAll()){var i=this._experienceBase.getManager("VCXContextManager");i&&i.zoomFitAll()}}SaveContext(){let e=this._experienceBase.getManager("VCXScenarioManager");this._viewForUndo||(this._viewForUndo=e.CaptureCurrentView())}Undo(){let e=this._experienceBase.getManager("VCXScenarioManager");if(this._viewForUndo){var t=this._experienceBase.getManager("VCXVisuManager");t&&(t.CameraControlsViewpoint=!0),e.ApplyView(this._viewForUndo),t&&(t.CameraControlsViewpoint=!1)}}}return s}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebKernelCommands/VCXCmdChangeTimePos",["require","exports","DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCommand"],(function(e,t,i,r){"use strict";r=__importDefault(r);class s extends r.default{constructor(e){super(e),this._timePosForUndo=-1,this._type="VCXCmdChangeTimePos",this._title="Change time position",this._timePosForDo=-1,this._scenarioForDoUndo=null,this._bLockEvents=!1,this._viewForUndo=null}Do(){let e=!1,t=this._experienceBase.getManager("VCXVisuManager");t&&(e=t.CameraControlsViewpoint,t.CameraControlsViewpoint=!0);let r=this._experienceBase.getManager("VCXScenarioManager");var s=this._experienceBase.ComponentsMap.GetComponentFromID(this._scenarioForDoUndo);if(s&&s.SetCurrentFrame(this._timePosForDo),r.UpdateProperties(),this._bLockEvents);else{i.publish({event:"VCX_TIMEPOS_CHANGED",data:this._timePosForDo}),i.publish({event:"VCX_PROPERTIES_CHANGED"});var o=this._experienceBase.getManager("VCXExperience");o&&o.SetVolatileNotSaved(!1)}t&&(t.CameraControlsViewpoint=e)}Undo(){this._experienceBase.ComponentsMap.GetComponentFromID(this._scenarioForDoUndo).SetCurrentFrame(this._timePosForUndo),this._experienceBase.getManager("VCXScenarioManager").ApplyView(this._viewForUndo,!0),this._bLockEvents||(i.publish({event:"VCX_TIMEPOS_CHANGED",data:this._timePosForUndo}),i.publish({event:"VCX_PROPERTIES_CHANGED"}))}SaveContext(){let e=this._experienceBase.getManager("VCXScenarioManager");this._timePosForUndo=e.GetCurrentFrame(),null===this._viewForUndo&&(this._viewForUndo=e.CaptureCurrentView())}ChangeTimePos(e,t){let i=this._experienceBase.getManager("VCXScenarioManager");this._scenarioForDoUndo=i.GetCurrentScenario(),this._timePosForDo=e,t&&(this._timePosForUndo=t)}SetViewForUndo(e){this._viewForUndo=e}SetLockEvents(e){this._bLockEvents=e}}return s}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebKernelCommands/VCXCmdGoToScenario",["require","exports","DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebKernelCommands/VCXCmdApplyScenario","DS/VCXWebKernelCommands/VCXCmdChangeTimePos"],(function(e,t,i,r,s,o){"use strict";r=__importDefault(r),s=__importDefault(s),o=__importDefault(o);class n extends r.default{constructor(e){super(e),this._type="VCXCmdGoToScenario",this._title="Go to scenario",this._bSetActiveScenario=!0,this._bLockEvents=!1,this._viewForUndo=null}GoToScenario(e,t){const i=this._experienceBase.getManager("VCXVisuManager");i&&i.getNonVisibleSpaceState()&&i.setNonVisibleSpaceState(!1);let r=this._experienceBase.getManager("VCXScenarioManager");this._scenarioIdForDo=e,this._timePosForUndo=r.GetCurrentFrame(),t&&(this._viewForUndo=t)}Do(){const e=this._experienceBase.getManager("VCXVisuManager");e&&e.getNonVisibleSpaceState()&&e.setNonVisibleSpaceState(!1);let t=this._experienceBase.getManager("VCXScenarioManager"),r=this._experienceBase.getManager("VCXCommandManager");if(this._bSetActiveScenario){this._scenarioIdForDo&&t.SetCurrentScenario(this._scenarioIdForDo);var n=new o.default(this._experienceBase);n.ChangeTimePos(0),n.SetLockEvents(this._bLockEvents),n.SetViewForUndo(this._viewForUndo),r.Push(n);var a=this._scenarioIdForDo&&t.GetScenarios()[this._scenarioIdForDo];if(a){var l=new s.default(this._experienceBase);l.ApplyScenario(a,!1,this._viewForUndo),r.Push(l),this._bLockEvents||i.publish({event:"VCX_CURRENT_SCENARIO_CHANGED",data:a})}else console.log("VCXCmdGoToScenario : scenario NOT found !")}}SaveContext(){let e=this._experienceBase.getManager("VCXScenarioManager");this._bSetActiveScenario&&(this._scenarioIdForUndo=e.GetCurrentScenario(),""===this._scenarioIdForUndo&&console.log("No current scenario !!"))}Redo(){let e=this._experienceBase.getManager("VCXScenarioManager");if(this._bLockEvents);else if(this._bSetActiveScenario){if(!this._scenarioIdForDo)throw new Error("No scenario do");e.SetCurrentScenario(this._scenarioIdForDo);var t=this._scenarioIdForDo&&e.GetScenarios()[this._scenarioIdForDo];i.publish({event:"VCX_CURRENT_SCENARIO_CHANGED",data:t})}}Undo(){let e=this._experienceBase.getManager("VCXScenarioManager");if(this._bLockEvents);else if(this._bSetActiveScenario&&this._scenarioIdForUndo){if(!this._scenarioIdForUndo)throw new Error("No scenario do");e.SetCurrentScenario(this._scenarioIdForUndo);var t=e.GetScenarios()[this._scenarioIdForUndo];i.publish({event:"VCX_CURRENT_SCENARIO_CHANGED",data:t})}}SetLockEvents(e){this._bLockEvents=e}SetActiveScenario(e){this._bSetActiveScenario=e}}return n}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebKernelCommands/VCXCmdChangeVisibility",["require","exports","DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebProperties/VCXPropertyMap","DS/VCXWebVisibility/VCXIVisibility"],(function(e,t,i,r,s,o){"use strict";r=__importDefault(r),s=__importDefault(s),o=__importDefault(o);class n extends r.default{constructor(e){super(e),this._type="VCXCmdChangeVisibility",this._title="Change Visibility",this._propertyMap=new s.default,this._listChange=[],this._visibility=o.default.EVisState.Hidden,this._bLockEvents=!1}_switchListChangeVisibilityIfNeeded(e,t){var i=t;if("boolean"==typeof t&&(console.warn("There shouldn't be a boolean in argument for this method. Use instead a Number, with 0 for hidden, 1 for visible."),i=t?o.default.EVisState.Visible:o.default.EVisState.Hidden),i===e)for(var r=0;r<this._listChange.length;++r){var s=this._listChange[r];if(s){var n=s.QueryInterface("VCXIVisibility");n&&n.SetVisibility(e)}}}Do(){if(0===this._listChange.length)return void console.log("nothing to change visibility on");this._switchListChangeVisibilityIfNeeded(o.default.EVisState.Visible,this._visibility),this._switchListChangeVisibilityIfNeeded(o.default.EVisState.Hidden,this._visibility);let e=this._experienceBase.getManager("VCXScenarioManager"),t=this._experienceBase.getManager("VCXContextManager");if(e.GetAutoKey()){var r=e.GetCurrentScenario(),s=e.GetScenarios()[r];e.CaptureCurrentVisibility(s),this._experienceBase.getManager("VCXExperience")&&this._experienceBase.getManager("VCXExperience").UpdateScenarioThumbnail(s)}for(var n=0;n<this._listChange.length;++n){if(this._listChange[n]&&!t){t.traverseGraphMustBePerformed=!0;break}}let a=t.getFrameWindow().getContextualUIManager();a&&a.hideContextualMenus(),this._bLockEvents||i.publish({event:"VCX_VISIBILITY_CHANGED",data:{components:this._listChange.slice(),visibility:this._visibility}}),i.publish({event:"VCX_MATERIALS_PANEL_UPDATE",data:null})}Invert(){var e=this._visibility===o.default.EVisState.Hidden;this._visibility=e?o.default.EVisState.Visible:o.default.EVisState.Hidden}SetLockEvents(e){this._bLockEvents=e}ChangeVisibility(e,t){for(var i=0;i<e.length;i++){var r=e[i];if(r){var s=r.QueryInterface("VCXIVisibility");s&&s.GetVisibility()!==t&&this._listChange.push(r)}}return this._visibility=t,this._listChange&&this._listChange.length}persistencyInformation(){return{implemented:!0,module:"DS/VCXWebKernelCommands",toPersistentObject:()=>({visibility:this._visibility,listChange:this._listChange.map((e=>e.GetID()))}),fromPersistentObject:e=>{this._visibility=e.visibility,this._listChange=e.listChange.map((e=>this._experienceBase.ComponentsMap.GetComponentFromID(e)))}}}static buildCmd(e){return new n(e)}}return n}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebKernelCommands/VCXCmdChangeScenario",["require","exports","DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebKernelCommands/VCXCmdChangeModifiable","DS/VCXWebKernelCommands/VCXCmdChangeComponent"],(function(e,t,i,r,s,o){"use strict";r=__importDefault(r),s=__importDefault(s),o=__importDefault(o);class n extends r.default{constructor(e){super(e),this._type="VCXCmdChangeScenario",this._title="Change scenario",this._scenariosToAdd=[],this._scenariosToRemove=[],this._bLockEvents=!1}AddScenarios(e){this._scenariosToAdd=this._scenariosToAdd.concat(e)}RemoveScenarios(e){this._scenariosToRemove=this._scenariosToRemove.concat(e)}Do(){let e=this._experienceBase.getManager("VCXScenarioManager"),t=this._experienceBase.getManager("VCXCommandManager");var r=new s.default(this._experienceBase),n=new o.default(this._experienceBase);if(this._scenariosToAdd.forEach((function(e){n.AddComponents(e),r.AddModifiables(e.QueryInterface("VCXIModifiable"))})),this._scenariosToRemove.forEach((function(e){n.RemoveComponents(e),r.RemoveModifiables(e.QueryInterface("VCXIModifiable"))})),t.Push(n),t.Push(r),this._scenariosToAdd.forEach((t=>{e.AddScenario2(t)})),this._scenariosToRemove.forEach((t=>{e.RemoveScenario(t.GetID())})),this._bLockEvents);else{var a={arrayToAdd:this._scenariosToAdd,arrayToRemove:this._scenariosToRemove};i.publish({event:"VCX_SCENARIOS_CHANGED",data:a})}}Undo(){let e=this._experienceBase.getManager("VCXScenarioManager");if(this._scenariosToAdd.forEach((t=>{e.RemoveScenario(t.GetID())})),this._scenariosToRemove.forEach((t=>{e.AddScenario2(t)})),this._bLockEvents);else{var t={arrayToAdd:this._scenariosToRemove,arrayToRemove:this._scenariosToAdd};this._scenariosToRemove.forEach((e=>{e.SetDocDirty(!0)})),i.publish({event:"VCX_SCENARIOS_CHANGED",data:t})}}Redo(){let e=this._experienceBase.getManager("VCXScenarioManager");if(this._scenariosToAdd.forEach((t=>{e.AddScenario2(t)})),this._scenariosToRemove.forEach((t=>{e.RemoveScenario(t.GetID())})),this._bLockEvents);else{var t={arrayToAdd:this._scenariosToAdd,arrayToRemove:this._scenariosToRemove};i.publish({event:"VCX_SCENARIOS_CHANGED",data:t})}}SetLockEvents(e){this._bLockEvents=e}}return n}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebKernelCommands/VCXCmdPlayScenario",["require","exports","DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebKernelCommands/VCXCmdApplyScenario"],(function(e,t,i,r,s){"use strict";r=__importDefault(r),s=__importDefault(s);class o extends r.default{constructor(e){super(e),this._isAsync=!0,this._type="VCXCmdPlayScenario",this._title="Play Scenario",this._scenarioToPlay=null,this._startFrame=0,this._bLockEvents=!1,this._playCurrent=!1,this._bDoNotApplyVis=!1,this._bIsBounce=!1,this._bIsLoop=!1,this._bIsReverse=!1,this._speed=1}PlayScenario(e,t,i,r,s,o,n){this._scenarioToPlay=e,void 0!==t?this._startFrame=t:-1===t&&(this._startFrame=e.GetCurrentFrame()),i&&(this._bDoNotApplyVis=i),void 0!==s&&(this._bIsBounce=s),void 0!==r&&(this._bIsLoop=r),void 0!==o&&(this._bIsReverse=o),void 0!==n&&(this._speed=Math.round(n))}async Do(){if(!this._scenarioToPlay)return void i.publish({event:"VCX_END_PLAY_SCENARIO"});let e=this._experienceBase.getManager("VCXScenarioManager"),t=this._experienceBase.getManager("VCXCommandManager");var r=e.PlayScenario(this._scenarioToPlay,this._startFrame,this._bIsLoop,this._bIsBounce,this._bIsReverse,this._speed);r&&this._scenarioToPlay.SetID(r);var o=new s.default(this._experienceBase);o.ApplyScenario(this._scenarioToPlay,this._bDoNotApplyVis),t.Do(o),await new Promise((e=>{this._pPlayEnd=e,this._playEndEvent=i.subscribe({event:"VCX_SCENARIO_PLAY_END_REACHED"},(t=>{this._scenarioToPlay.GetID()===t&&(i.publish({event:"VCX_END_PLAY_SCENARIO",data:t}),e(this._parameter))}))})),i.unsubscribe(this._playEndEvent),this._playEndEvent=null,this._pPlayEnd=null,this._callback&&(this._callback(),e.SetCallback(null,null))}StopPlayingScenario(){let e=this._experienceBase.getManager("VCXScenarioManager");this._pPlayEnd&&this._pPlayEnd(),e.StopPlayingScenario(this._scenarioToPlay.GetID())}Undo(){console.log("apply undo VCXCmdPlayScenario"),this.StopPlayingScenario()}SaveContext(){}SetLockEvents(e){this._bLockEvents=e}}return o}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebKernelCommands/VCXCmdUpdateThumbnail",["require","exports","DS/VCXWebKernelCommands/VCXCommand"],(function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{constructor(e,t,i){super(e),this._type="VCXCmdUpdateThumbnail",this._title="Update Thumbnail",this._scenario=t,this._noLatency=i}async Do(){this._experienceBase&&(this._experienceBase.getManager("VCXContextualContentManager")&&this._experienceBase.getManager("VCXContextualContentManager").contextualShortcutToolbarCtrl&&this._experienceBase.getManager("VCXContextualContentManager").contextualShortcutToolbarCtrl.isContextualBarDisplayed()?this._experienceBase.getManager("VCXContextualContentManager").contextualShortcutToolbarCtrl.contextualBarContextualMenuObserver(!1,"wux-afr-contextual-bar",(async()=>{await this._experienceBase.getManager("VCXExperience").UpdateScenarioThumbnail(this._scenario,this._noLatency)})):await this._experienceBase.getManager("VCXExperience").UpdateScenarioThumbnail(this._scenario,this._noLatency))}IsAsync(){return this._noLatency}}return r}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebKernelCommands/VCXCmdChangePropertyMap",["require","exports","DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXProperty"],(function(e,t,i,r,s,o){"use strict";i=__importDefault(i),r=__importDefault(r),s=__importDefault(s),o=__importDefault(o);class n extends i.default{constructor(e){super(e),this._type="VCXCmdChangePropertyMap",this._title="Change property map",this._keysForDo=[],this._keysForUndo=[]}Do(){for(var e=0;e<this._keysForDo.length;e++){var t=this._keysForDo[e],i=t.propertyMap.GetPropertySet(t.modifiable.GetHashing());if(i||t.value&&(i=new r.default,t.propertyMap.AddOrModifyPropertySet(t.modifiable.GetHashing(),i)),i)if(n=i.GetProperty(t.propertyName))t.value?n.SetPropertyValue(t.value.Clone()):(i.RemoveProperty(t.propertyName),0===i.GetPropertyNumber()&&t.propertyMap.RemovePropertySet(t.modifiable.GetHashing()));else if(t.value){let e=0;t.behaviorType&&(e=t.behaviorType);var n=new o.default(new s.default(t.propertyName,e),t.value.Clone());t.propertyMap.AddOrModifyProperty(t.modifiable.GetHashing(),n)}}}Invert(){var e=this._keysForDo;this._keysForDo=this._keysForUndo,this._keysForUndo=e}SaveContext(){for(var e=0;e<this._keysForDo.length;e++){var t,i=this._keysForDo[e],r=null,s=i.modifiable.GetHashing();if(s?r=i.propertyMap.GetPropertySet(s):console.log("VCXCmdChangePropertyMap: hashing is empty !"),r){var o=r.GetProperty(i.propertyName);o&&(t=o.GetPropertyValue().Clone())}this._keysForUndo.push({propertyMap:i.propertyMap,modifiable:i.modifiable,propertyName:i.propertyName,value:t})}}ChangePropertyBasic(e,t,i,r,s){this._keysForDo.push({propertyMap:e,modifiable:t,propertyName:i,behaviorType:s,value:r?.Clone()})}}return n}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebKernelCommands/VCXCmdChangeNeutralProperties",["require","exports","DS/VCXWebKernelCommands/VCXCmdChangePropertyMap"],(function(e,t,i){"use strict";i=__importDefault(i);class r extends i.default{constructor(e){super(e),this.neutrals=this._experienceBase.getManager("VCXScenarioManager")._keyframer._Neutrals,this._type="VCXCmdChangeNeutrals",this._title="Change neutral properties"}ChangeProperty(e,t,i,r){super.ChangePropertyBasic(this.neutrals,e,t,i,r)}CaptureNeutralProperties(e){var t=e.GetProperties();if(t)for(var i in t.map)if(t.map.hasOwnProperty(i)){var r=t.GetProperty(i);r&&this.ChangeProperty(e,i,r.GetPropertyValue(),r.GetPropertyInfo().GetBehaviorType())}}}return r}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebKernelCommands/VCXCmdReplaceNeutralTrackProperties",["require","exports","DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebKernelCommands/VCXCmdChangeNeutralProperties","DS/VCXWebKernelCommands/VCXCmdChangeKeys"],(function(e,t,i,r,s){"use strict";i=__importDefault(i),r=__importDefault(r),s=__importDefault(s);class o extends i.default{constructor(e){super(e),this._type="VCXCmdReplaceNeutralTrackProperties",this._title="Replace Track & neutral properties",this.propNameSource=null,this.valuesSource=[],this.filterMethod=null,this.targetPropertyValue=null}SetSourcePropertyName(e){this.propNameSource=e}SetSourcePropertyValues(e){Array.isArray(e)||(e=[e]),this.valuesSource=e}SetFilterType(e){this.filterMethod=t=>t.GetObject().IsKindOf(e)}SetFilterMethod(e){this.filterMethod=e}SetTargetPropertValue(e){this.targetPropertyValue=e}Do(){if(!this.propNameSource)throw new Error("No prop name source");const e=this._experienceBase.getManager("VCXScenarioManager"),t=this._experienceBase.getManager("VCXCommandManager"),i=new r.default(this._experienceBase),o=new s.default(this._experienceBase);let n=0,a=0;for(let t of this.valuesSource)e.SearchAllValuesForOneProperty({propertyName:this.propNameSource,oldValue:t},(e=>{e&&"Neutrals"===e.type&&(i.ChangeProperty(e.modifiable,this.propNameSource,this.targetPropertyValue),n++),e&&"Track"===e.type&&(o.ChangeKey(e.Scenario,e.modifiable,this.propNameSource,e.Frame,this.targetPropertyValue,e.Easing),a++)}));n&&t.Push(i),a&&t.Push(o)}}return o}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebKernelCommands/VCXCmdReplaceScenario",["require","exports","DS/VCXWebExperienceLoader/VCXExperienceSaverBase","DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebKernelCommands/VCXCmdChangeNeutralProperties"],(function(e,t,i,r,s,o){"use strict";s=__importDefault(s),o=__importDefault(o);class n extends s.default{constructor(e){super(e),this._type="VCXCmdReplaceScenario",this._title="Replace scenario",this._scenarioToModify=null,this._dataForDo={},this._dataForUndo={},this._bLockEvents=!1}ReplaceScenario(e,t){this._scenarioToModify=e;var i=t.QueryInterface("VCXIModifiable"),r=this._experienceBase.getManager("VCXScenarioManager").GetNeutrals(i.GetHashing());this._dataForDo.neutrals=r?.Clone(),this._dataForDo.scenario=t.Clone()}Do(){let e=this._experienceBase.getManager("VCXScenarioManager");var t=this._scenarioToModify.QueryInterface("VCXIModifiable");e.RemoveNeutrals(t.GetHashing()),e.AddNeutrals(t,this._dataForDo.neutrals.Clone()),this._dataForDo.scenario.Clone(this._scenarioToModify);var s=this._experienceBase.getManager("VCXEWSManager"),n=this._experienceBase.getManager("VCXContextManager").IsLocalMode();if(s&&!n){var a=this._experienceBase.getManager("VCXDocManager").actorDocManager.QueryInterface("VCXIModifiable"),l=new o.default(this._experienceBase);l.CaptureNeutralProperties(a),l.Do();var h=this._scenarioToModify.GetID(),c="",d=this._experienceBase.getManager("VCXSequenceManager").GetSequenceFromScenarioId(h);d&&(c=d.GetID());var _=new i,p=_._ScenarioToJson(this._experienceBase,this._scenarioToModify),u=_._VisibilityToJson(this._scenarioToModify.GetVisibility(),this._experienceBase);p.visibility=u;var C=[];C.push(p);var m={};m.listScenarios=C;var f=JSON.stringify(m,null,4),v={};v.neutrals=_._NeutralsToJson(this._experienceBase);var S=JSON.stringify(v,null,4),V=s.UpdateState(h,c,S,f).then((function(){console.log("--------\x3e vcxEWSManager.UpdateState DONE")})),g=this._scenarioToModify.QueryInterface("VCXIReadiness");g&&(g.clearPromises(),g.registerPromise(V),console.log("--------\x3e registerPromise for vcxEWSManager.UpdateState................"))}this._bLockEvents||r.publish({event:"VCX_SCENARIO_REPLACED",data:this._scenarioToModify})}SaveContext(){let e=this._experienceBase.getManager("VCXScenarioManager");var t=this._scenarioToModify.QueryInterface("VCXIModifiable"),i=e.GetNeutrals(t.GetHashing());this._dataForUndo.neutrals=i?.Clone(),this._dataForUndo.scenario=this._scenarioToModify.Clone()}Invert(){var e=this._dataForDo;this._dataForDo=this._dataForUndo,this._dataForUndo=e}SetLockEvents(e){this._bLockEvents=e}}return n}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebKernelCommands/VCXCmdChangeLinkedProperties",["require","exports","DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebKernelCommands/VCXCmdChangeNeutralProperties"],(function(e,t,i,r,s){"use strict";r=__importDefault(r),s=__importDefault(s);class o extends r.default{constructor(e){super(e),this._type="VCXCmdChangeLinkedProperties",this._title="Modify properties links",this._linksToAdd=[],this._linksToRemove=[],this._bLockEvents=!1}Do(){let e=this._experienceBase.getManager("VCXScenarioManager"),t=this._experienceBase.getManager("VCXCommandManager"),r=this._experienceBase.getManager("VCXLinkedPropertyManager");if(this._linksToRemove.length>0){for(var o=0;o<this._linksToRemove.length;o++){if(this._linksToRemove[o].converter=r.RemoveLink(this._linksToRemove[o].inID,this._linksToRemove[o].inProp,this._linksToRemove[o].outID,this._linksToRemove[o].outProp),h=this._experienceBase.ComponentsMap.GetComponentFromID(this._linksToRemove[o].outID)){let t=h.QueryInterface("VCXIModifiable");if(t){var n=e.GetNeutrals(t.GetHashing())?.GetProperty(this._linksToRemove[o].outProp);if(n){var a=n.GetPropertyValue();t.OnChangeProperty(this._linksToRemove[o].outProp,a)}e.UpdateProperties(t.GetHashing(),this._linksToRemove[o].outProp),t.OnChangePropertiesEnd()}}}i.publish({event:"VCX_LINKS_REMOVED"})}if(this._linksToAdd.length>0){var l=new s.default(this._experienceBase);for(o=0;o<this._linksToAdd.length;o++){var h;if(r.AddLink(this._linksToAdd[o].inID,this._linksToAdd[o].inProp,this._linksToAdd[o].outID,this._linksToAdd[o].outProp,this._linksToAdd[o].converter),h=this._experienceBase.ComponentsMap.GetComponentFromID(this._linksToAdd[o].outID)){let t=h.QueryInterface("VCXIModifiable");if(t&&!e.GetNeutrals(t.GetHashing())?.GetProperty(this._linksToAdd[o].outProp)){var c=t.GetProperty(this._linksToAdd[o].outProp);c&&l.ChangeProperty(t,this._linksToAdd[o].outProp,c.GetPropertyValue())}}}t.Push(l),i.publish({event:"VCX_LINKS_ADDED"})}r.UpdateProperties(),i.publish({event:"VCX_PROPERTIES_CHANGED"})}Invert(){var e=this._linksToAdd;this._linksToAdd=this._linksToRemove,this._linksToRemove=e}AddLink(e,t,i,r,s){let o={inID:e,inProp:t,outID:i,outProp:r,converter:s};this._linksToAdd.push(o)}RemoveLink(e,t,i,r){let s={inID:e,inProp:t,outID:i,outProp:r};this._linksToRemove.push(s)}RemoveLinksFromPropertyName(e,t){var i=this._experienceBase.getManager("VCXLinkedPropertyManager").GetLinksFromPropertyName(e,t);this._linksToRemove=this._linksToRemove.concat(i)}RemoveLinks(e){this._linksToRemove=this._linksToRemove.concat(e)}}return o}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey",["require","exports","DS/VCXWebKernelCommands/VCXCmdChangeProperties","DS/VCXWebProperties/VCXPropertyMap","DS/VCXWebKernelCommands/VCXCmdChangeNeutralProperties","DS/VCXWebKernelCommands/VCXCmdChangePropertiesVolatile","DS/VCXWebKernelCommands/VCXCmdUpdateThumbnail","DS/VCXWebKernelCommands/VCXCmdChangeKeys"],(function(e,t,i,r,s,o,n,a){"use strict";i=__importDefault(i),r=__importDefault(r),s=__importDefault(s),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a);class l extends i.default{constructor(e,t=!1){super(e),this._type="VCXCmdChangePropertiesAutokey",this._title="Change properties autokey",this.ImmediateThumbnail=!1,this._propertyMap=new r.default,this._bForceAutokey=t,this._bLockEvents=!1,this._bLockUpdateThumbnail=!1}Do(){let e=this._experienceBase.getManager("VCXScenarioManager"),t=this._experienceBase.getManager("VCXCommandManager");var i=e.GetCurrentFrame(),r=e.GetAutoKey(),l=e.GetCurrentScenario(),h=e.GetScenarios()[l],c=new a.default(this._experienceBase),d=new o.default(this._experienceBase),_=new s.default(this._experienceBase);if(this._experienceBase.getManager("VCXContextManager").isSupported("VCXTrackFaultyLinkedProp")){let t=this._experienceBase.getManager("VCXLinkedPropertyManager");this._propertyMap.Iterate(((i,r)=>{let s=e.ModifiableServer?.GetModifiableFromHashing(i);return r.GetProperty("Modifiable.Style.Exclusion")||r.Iterate((e=>{if(t.IsLinkedAndNotInFollow(s?.GetObject().GetID(),e))throw new Error("Found one property ("+e+") that is edited without the style exclusion, please use RequestModification instead of autokey");return!0})),!0}))}for(var p in this._propertyMap.map)if(this._propertyMap.map.hasOwnProperty(p)){var u=e.ModifiableServer?.GetModifiableFromHashing(p);if(u){var C=this._propertyMap.GetPropertySet(p);for(var m in C.map)if(C.map.hasOwnProperty(m)){var f=C.map[m],v=f.GetPropertyInfo().GetBehaviorType(),S=f.GetPropertyInfo().IsPersistent();if(S)if(2===v)_.ChangeProperty(u,m,f.GetPropertyValue(),v);else if(!e.GetNeutrals(p)?.GetProperty(m)){var V=u.GetProperty(m);V&&_.ChangeProperty(u,m,V.GetPropertyValue(),V.GetPropertyInfo().GetBehaviorType())}if(d.ChangeProperty(u,f),S&&2!==v&&(r||this._bForceAutokey)){var g=i;1===v&&(g=0),h&&c.ChangeKey(h,u,m,g,f.GetPropertyValue())}}}}if(this._bLockEvents&&(d.SetLockEvents(this._bLockEvents),c.SetLockEvents(this._bLockEvents)),0===i&&(r||this._bForceAutokey)&&e._experienceBase.getManager("VCXExperience")&&h&&!this._bLockUpdateThumbnail){var y=new n.default(e._experienceBase,h,this.ImmediateThumbnail);t.Push(y)}if(t.Push(d),t.Push(c),t.Push(_),0===i&&(r||this._bForceAutokey)&&e._experienceBase.getManager("VCXExperience")&&h&&!this._bLockUpdateThumbnail){y=new n.default(e._experienceBase,h,this.ImmediateThumbnail);t.Push(y)}}Redo(){}Undo(){}Invert(){}SaveContext(){}Merge(e){if(!(e&&e instanceof l))throw new Error("No cmd in input");var t=new l(this._experienceBase),i=this._propertyMap.Clone(),r=e._propertyMap;return i.Merge(r),t.ChangePropertiesFromMap(i),t}IsMergeable(){return!0}SetAutoKey(e){this._bForceAutokey=e}static buildCmd(e){return new l(e)}}return l}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebKernelCommands/VCXCmdRequestChangeProperties",["require","exports","DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebProperties/VCXPropertyMap","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey"],(function(e,t,i,r,s){"use strict";i=__importDefault(i),r=__importDefault(r),s=__importDefault(s);class o extends i.default{constructor(e){super(e),this._type="VCXCmdRequestChangeProperties",this._title="Request modification and change properties autokey",this.modificationMap=new r.default,this._bLockEvents=!1}Do(){let e=new s.default(this._experienceBase);e.ChangePropertiesFromMap(this.modificationMap),this._experienceBase.getManager("VCXCommandManager").Push(e),this.modificationMap=new r.default}Redo(){}Undo(){}Invert(){}SaveContext(){}async ChangeProperty(e,t){"odt"in this._experienceBase&&void 0!==this._experienceBase.odt&&"record"===this._experienceBase.odt&&this._experienceBase.getManager("VCXODTManager").LogAPI("VCXRequestModificationCmd",{modifiableList:[e.GetObject()?.GetID()],strPropertyName:t.GetPropertyInfo().GetPropertyName(),newPropertyValue:t.GetPropertyValue()}),await e.RequestModification(t,this.modificationMap)}async ChangePropertyValue(e,t,i){const r=e&&e.GetProperty(t);if(r){const t=r.Clone();return t&&t.SetPropertyValue(i),this.ChangeProperty(e,t)}}async RequestModification(e,t,i,r){if(!Array.isArray(e))return void console.error("ERROR: Request modification function works on arrays of modifiables");let s=!1;"odt"in this._experienceBase&&void 0!==this._experienceBase.odt&&"record"===this._experienceBase.odt&&this._experienceBase.getManager("VCXODTManager").LogAPI("VCXRequestModificationCmd",{modifiableList:e.map((e=>e.GetObject()?.GetID())),strPropertyName:t,newPropertyValue:i,newValue:r});for(let o=0;o<e.length;o++){const n=e[o];let a=null,l=n.GetProperty(t);if(!0===l.GetPropertyValue()._bUndefined){let e=l.GetPropertyValue().ToString();(r=r||i?.ToString())===e&&(s=!0)}if(!s){let e=l.Clone();if(i)e.SetPropertyValue(i);else if(r){e.GetPropertyValue().FromString(r)}a=e}a&&await n.RequestModification(a,this.modificationMap)}return this.modificationMap}static buildCmd(e){return new o(e)}}return o}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebKernelCommands/VCXCmdApplyPropertyTo",["require","exports","DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebKernelCommands/VCXCmdGoToScenario","DS/VCXWebProperties/VCXPropertyMap","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey"],(function(e,t,i,r,s,o,n){"use strict";r=__importDefault(r),s=__importDefault(s),o=__importDefault(o),n=__importDefault(n);class a extends r.default{constructor(e,t,i){super(e),this._type="VCXCmdApplyPropertyTo",this._title="Update Thumbnail",this._selectionContext=t,this._scope=i}Do(){const e=this._experienceBase,t=e.getManager("VCXScenarioManager").GetCurrentScenario(),i=e.getManager("VCXCommandManager");for(let t=0;t<this._selectionContext.scenarios.length;t++){const r=this._selectionContext.scenarios[t],a=new s.default(e);a.GoToScenario(r.GetID()),i.Push(a);const l=new o.default;for(let e=0;e<this._selectionContext.changes.length;e++){const t=this._selectionContext.changes[e];let i=t.modifiable.GetProperty(t.propertyName).Clone(),r=t.modifiable.GetProperty(t.propertyName).GetPropertyValue().Clone();r.SetValue(t.propertyValue),i.SetPropertyValue(r),l.AddOrModifyProperty(t.modifiable.GetHashing(),i)}const h=new n.default(e,!0);h.ChangePropertiesFromMap(l),i.Push(h)}const r=new s.default(e);r.GoToScenario(t),i.Push(r),this.RefreshThumbnails()}RefreshThumbnails(){if(this._selectionContext.scenarios.length>0){const e=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario();this._selectionContext.scenarios.forEach((t=>{t.GetID()===e&&"all"!==this._scope||t.SetDocDirty(!0)}))}}Redo(){let e=i.subscribe({event:"VCX_UNDOREDO_DONE"},(()=>{this.RefreshThumbnails(),i.unsubscribe(e),e=null}))}Undo(){let e=i.subscribe({event:"VCX_UNDOREDO_DONE"},(()=>{this.RefreshThumbnails(),i.unsubscribe(e),e=null}))}}return a}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebKernelCommands/VCXCmdRestoreNeutralProperties",["require","exports","DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey"],(function(e,t,i,r){"use strict";i=__importDefault(i),r=__importDefault(r);class s extends i.default{constructor(e){super(e),this._type="VCXCmdRestoreNeutralProperties",this._title="Restore neutral properties",this._listActors=[],this._updateOnlyLocation=!1}AddActor(e){this._listActors.push(e)}SetActors(e){this._listActors=e}SetUpdateOnlyLocation(e){this._updateOnlyLocation=e}Do(){let e=this._experienceBase.getManager("VCXScenarioManager"),t=this._experienceBase.getManager("VCXCommandManager"),i=0,s=null;for(var o=new r.default(this._experienceBase),n=0;n<this._listActors.length;n++){var a=this._listActors[n].QueryInterface("VCXIModifiable"),l=a?.GetHashing();l?s=e.GetNeutrals(l):console.log("VCXCmdRestoreNeutralProperties: hashing is empty !"),a?._bIsMagnetLine&&a?.cleanModifiableAttached(),s&&s.Iterate(((e,t)=>(this._updateOnlyLocation&&"Actor.Position"!==e||(o.ChangeProperty(a,t),i++),!0)))}t.Push(o),console.log("push de "+i+" changements <<======")}static buildCmd(e){return new s(e)}}return s}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebKernelCommands/VCXCmdApplyTo",["require","exports","DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebVisibility/VCXIVisibility","DS/VCXWebProperties/VCXPropertyMap","DS/VCXWebKernelCommands/VCXCmdChangeVisibility","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebKernelCommands/VCXCmdChangePropertiesVolatile","DS/VCXWebKernelCommands/VCXCmdGoToScenario"],(function(e,t,i,r,s,o,n,a,l,h,c){"use strict";r=__importDefault(r),s=__importDefault(s),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),l=__importDefault(l),h=__importDefault(h),c=__importDefault(c);class d extends r.default{constructor(e,t){super(e),this._scenarioCommands=[],this._type="VCXCmdApplyTo",this._title="Update Thumbnail",this._selectionContext=t}Do(){if(this._selectionContext.availability||this._selectionContext.selectionContext.cameraSelected){const e=this._experienceBase,t=e.getManager("VCXScenarioManager"),i=e.getManager("VCXExperience"),r=e.getManager("VCXCommandManager"),d=t.GetCurrentScenario(),_=e.getManager("VCXVisuManager"),p=e.getManager("VCXContextManager"),u=p.getActiveViewport(),C=u&&u.QueryInterface("VCXIViewpointController"),m=u&&u.QueryInterface("VCXIModifiable"),f=new s.default;C.fromViewpoint(f);const v=f.Clone(),S=[];v.GetListPropertyNames(S),S.forEach((e=>{"Camera.Position"!==e&&(v.GetProperty(e).GetPropertyInfo()._bPersistent=!0)}));const V=[];[...this._selectionContext.selectionContext.parts,...this._selectionContext.selectionContext.dressups].forEach((e=>{const t=e.QueryInterface("VCXIVisibility"),i=e.QueryInterface("VCXIModifiable");if(!i||!t)return;const r=t.GetVisibility(),o=i.GetProperties(),n=i.GetHashing();if(V.push({element:e,modifiableHash:n,visibility:r,properties:o}),m&&!this._selectionContext.selectionContext.viewportSelected&&e.IsKindOf("AmbienceModel_Spec")&&m.GetPropertyValue("Viewport.ActiveAmbience")===e.GetID()){const e=new s.default,t=m.GetProperty("Viewport.ActiveAmbience");e.AddOrModifyProperty(t.Clone()),V.push({element:u,modifiableHash:m.GetHashing(),visibility:-2,properties:e})}})),this._scenarioCommands=[];for(let t=0;t<this._selectionContext.selectionContext.scenarios.length;t++){const s=this._selectionContext.selectionContext.scenarios[t];this._scenarioCommands[t]={scenario:s,id:s.GetID(),name:s.GetName()};const h=new c.default(e);h.GoToScenario(s.GetID()),r.Push(h),this._scenarioCommands[t].VCXCmdGoToScenario=h,i._ManagerSet.update({viewer:p.getMainViewer(),viewpoint:p.getMainViewer().currentViewpoint});const u=new n.default;if(s.GetID()!==d){const t={},i=[o.default.EVisState.Hidden,o.default.EVisState.Visible,o.default.EVisState.Ghost];i.forEach((e=>{V.forEach((i=>{i.visibility===e&&(t[e]||(t[e]=[]),t[e].push(i.element))}))})),i.forEach((i=>{if(t[i]&&t[i].length){const s=new a.default(e);s.ChangeVisibility(t[i],i)&&r.Push(s)}})),V.forEach((e=>{e.visibility!==o.default.EVisState.Hidden&&u.AddOrModifyPropertySet(e.modifiableHash,e.properties.Clone())}))}if(this._selectionContext.selectionContext.cameraSelected){const e=p.getActiveCamera(),t=e?.QueryInterface("VCXIModifiable");t&&u.AddOrModifyPropertySet(t.GetHashing(),v.Clone()),_.CameraControlsViewpoint=!0}const C=new l.default(e,!0);C.ChangePropertiesFromMap(u),r.Push(C)}let g=new c.default(e);g.GoToScenario(d),r.Do(g);let y=new h.default(e);S.forEach((e=>{y.ChangeProperty(m,v.GetProperty(e).Clone())})),r.Do(y),C.toViewpoint(),this.RefreshThumbnails()}}RefreshThumbnails(){if(this._scenarioCommands){const e=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario();this._scenarioCommands.forEach((t=>{const i=t.scenario;i.GetID()!==e&&i.SetDocDirty(!0)}))}}Redo(){let e=i.subscribe({event:"VCX_UNDOREDO_DONE"},(()=>{this.RefreshThumbnails(),i.unsubscribe(e),e=null}))}Undo(){let e=i.subscribe({event:"VCX_UNDOREDO_DONE"},(()=>{this.RefreshThumbnails(),i.unsubscribe(e),e=null}))}static checkSelectionContext(e,t){const i=e&&e.getManager("VCXSelectionManager"),r=i&&i.getSelectionContext(t),s=r&&r.scenarios.length>0&&(r.dressups.length>0||r.parts.length>0||r.cameraSelected);return{availability:s,state:s?"enabled":"disabled",selectionContext:r}}}return d}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebKernelCommands/VCXCmdChangeViewpoint",["require","exports","DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXPropertyMap"],(function(e,t,i,r,s,o){"use strict";r=__importDefault(r),s=__importDefault(s),o=__importDefault(o);class n extends r.default{constructor(e,t=!1){super(e,t);var r=this._experienceBase.getManager("VCXContextManager").getActiveCamera(),n=r?.QueryInterface("VCXIModifiable"),a=r?.QueryInterface("VCXIViewpointController");if(a&&n){var l=new s.default;a.fromViewpoint(l);var h=new o.default;h.AddOrModifyPropertySet(n.GetHashing(),l),this.ChangePropertiesFromMap(h),i.publish({event:"VCX_SCENE_UPDATE"})}}}return n}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebKernelCommands/VCXCmdGoToScenarioWithInterpolation",["require","exports","DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebKernelCommands/VCXCmdGoToScenario","DS/VCXWebKernelCommands/VCXCmdPlayScenario","DS/VCXWebProperties/VCXPropertyMap","DS/VCXWebVisibility/VCXIVisibility","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebTracks/VCXEasing","DS/VCXWebTracks/VCXKey","DS/VCXWebTracks/VCXTrack","DS/VCXKeyFramer/VCXObjectAnimation"],(function(e,t,i,r,s,o,n,a,l,h,c,d,_){"use strict";r=__importDefault(r),s=__importDefault(s),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),l=__importDefault(l),h=__importDefault(h),c=__importDefault(c),d=__importDefault(d),_=__importDefault(_);class p extends r.default{constructor(e){super(e),this._viewForUndo=null,this._type="VCXCmdGoToScenarioWithInterpolation",this._title="Go To Scenario With Interpolation",this._isAsync=!0,this._scenarioForDo=null,this._scenarioTransition=null,this._wuxEventScenarioPlayed=null,this._bSetActiveScenario=!0,this._bLockEvents=!1,this._transitionTime=null}SetTransitionTime(e){this._transitionTime=e}async Do(){let e=this._experienceBase.getManager("VCXScenarioManager"),t=this._experienceBase.getManager("VCXCommandManager");if(!this._scenarioTransition||!this._scenarioForDo)return;let r=this._scenarioTransition.GetMaxFrame(),n=e.GetTransitionTime();this._transitionTime&&(n=this._transitionTime),this._scenarioTransition.SetSpeed(10),this._bLockEvents||i.publish({event:"VCX_BEGIN_TRANSITION",data:{maxframe:n/1e3,scenario:this._scenarioForDo}});let a=null;if(this._bSetActiveScenario){let e=new s.default(this._experienceBase);e.GoToScenario(this._scenarioForDo.GetID(),this._viewForUndo),e.SetActiveScenario(this._bSetActiveScenario),a=e}let l=this._experienceBase.getManager("VCXVisuManager");l&&l.setTransitionMode(!0);let h=e.GetFPS();if(e.SetFPS(50),0!=n){let t=r/(n/1e3);e.SetFPS(t)}let c=e.GetInterFramesMax();e.SetInterFramesMax(-1);let d=new o.default(this._experienceBase);d.PlayScenario(this._scenarioTransition);const _=new Promise((r=>{this._wuxEventScenarioPlayed=i.subscribe({event:"VCX_END_PLAY_SCENARIO"},(async s=>{if("VCX_Scenario_Transition"===s){e.SetInterFramesMax(c),e.SetFPS(h),i.unsubscribe(this._wuxEventScenarioPlayed),a&&(a.SetLinkedCmd(!0),t.Push(a)),l&&l.setTransitionMode(!1);let s=e._experienceBase.getManager("VCXExperience");await s.getAllActorsReadiness(),this._bLockEvents||i.publish({event:"VCX_END_TRANSITION",data:this._scenarioForDo}),this._callback&&this._callback(),r(this._parameter)}}))})),p=t.Do(d);return Promise.all([p,_])}Undo(){}Redo(){}SaveContext(){let e=this._experienceBase.getManager("VCXScenarioManager");this._viewForUndo=e.CaptureCurrentView()}BuildTransitionTo(e){this._scenarioForDo=e,this._scenarioTransition=this.BuildScenarioForTransition(this._scenarioForDo),this._scenarioTransition.SetID("VCX_Scenario_Transition")}BuildScenarioForTransition(e){console.time("BuildScenarioForTransition"),this._bLockEvents||i.publish({event:"VCX_PREPARE_TRANSITION",data:{scenario:e}});let t=this._experienceBase,r=this._experienceBase.getManager("VCXScenarioManager"),s=t.Factory?.BuildComponent("VCXScenario");if(!s)throw new Error("Issue with dicos");s.SetPersistency(2),s.SetApplyNeutralAtGoToScenario(!1),s.SetIsTransition(!0);let o=new n.default,p={propMapDiffNeutrals:o},u=r.CaptureCurrentView(p),C=t.getManager("VCXVisuManager");if(C&&(C.CameraControlsViewpoint=!0),a.default.lockVisibilityOpacity=!0,r.ApplyView(e),a.default.lockVisibilityOpacity=!1,e.GetZoomFitAll()){let e=this._experienceBase.getManager("VCXContextManager");e&&e.zoomFitAll()}C&&(C.CameraControlsViewpoint=!1);let m=new n.default;r.CaptureDiffOfNeutrals(m,!0);for(let e in o.map)if(o.map.hasOwnProperty(e)){let t=r.ModifiableServer?.GetModifiableFromHashing(e);if(!t)continue;let i=o.GetPropertySet(e);for(let r in i.map)if(i.map.hasOwnProperty(r)){if(m.GetProperty(e,r))continue;let i=t.GetProperty(r);i&&m.AddOrModifyProperty(e,i)}}a.default.lockVisibilityOpacity=!0,r.ApplyView(u),a.default.lockVisibilityOpacity=!1;let f=s.GetVisibility(),v=!1,S=this._experienceBase.getManager("VCXContextManager").getActiveViewport();if(S){let e=S.QueryInterface("VCXIModifiable");if(!e)throw new Error("Error Dico");let t=e.GetProperties(!1),i=m.GetPropertySet(e.GetHashing());i&&t&&(t.IsEqualTo(i,{intersection:!0})||(v=!0))}for(let t in m.map)if(m.map.hasOwnProperty(t)){let i=r.ModifiableServer?.GetModifiableFromHashing(t);if(!i)continue;let o=i.GetObject(),n=i.GetRequiredPropertiesForTransition(),l=m.GetPropertySet(t);for(let p in l.map)if(l.map.hasOwnProperty(p)){let u=i.GetProperty(p);if(u){if(0!==u.GetPropertyInfo().GetBehaviorType())continue;let C=u.GetPropertyValue(),m=l.GetProperty(p).GetPropertyValue();if(!C.IsEqualTo(m)||n&&n.hasOwnProperty(p)){if(!0===C._bUndefined)continue;let n=s.GetObjectAnimation(t);n||(n=new _.default,void 0===t&&(r.ModifiableServer?.AddModifiable(i),console.log("hashing is undefined")),s.AddObjectAnimation(t,n));let l=n.GetTrack(p);if(l||(l=new d.default,n.AddTrack(p,l)),(o.IsKindOf("VCXWebComponentCamera")||o.IsKindOf("CXPCameraActor_Spec")||o.IsKindOf("VCXViewport_Spec")||o.IsKindOf("VCXViewpoint_Spec"))&&v){l.easing=h.default.easeInOutPower3;let e=new c.default(0,C);l.AddKey(e);let t=new c.default(60,m);l.AddKey(t)}else{let t=C.GetType();"VCXPropertyValueLocation"!==t&&"VCXPropertyValueFrame"!==t&&"VCXPropertyValueFloat"!==t&&"VCXPropertyValuePoint2D"!==t&&"VCXPropertyValueVector"!==t||(l.easing=h.default.easeInOutPower3);let r=new c.default(0,C),s=new c.default(0,m);if(!o.IsKindOf("CXPCameraActor_Spec")&&!o.IsKindOf("VCXViewpoint_Spec")&&!o.IsKindOf("VCXViewport_Spec")){let e=i.QueryInterface("VCXIVisibility");if(e){e.GetVisibility()===a.default.EVisState.Hidden&&r.SetValue(m)}}let n=e.GetVisibility();if(n){let e=n.IsVisibleWithParents(i.GetObject()),t=n.GetMode(),r=0;(1===e||-1===e&&2===t||-1===e&&0===t||0===e&&1===t)&&(r=1),0===r&&s.SetValue(C)}if(v){let e=new c.default(60,r.GetValue());l.AddKey(e),s.SetFrame(120)}else s.SetFrame(60);l.AddKey(s),l.AddKey(r)}}}}}let V="Actor.Visibility.Opacity",g=e;if(g){let e=g.GetVisibility();if(e){let i=t.ComponentsMap.GetComponentFromType("VCXWebComponentOccurrence"),o=e.GetMode();for(let t=0;t<i.length;t++){let n=i[t];if(n){let t=1,i=1,h=n.QueryInterface("VCXIVisibility");if(h){t=h.GetVisibility()!==a.default.EVisState.Hidden?1:0,i=t;let p=e.IsVisibleWithParents(n);if(0===o?1===p?i=1:0===p&&(i=0):1===o?i=1===p?1:0:2===o&&(i=0===p?0:1),t!==i){f.AddVisible(n);let e=n.QueryInterface("VCXIModifiable");if(!e)throw new Error("Error dico");e.GetHashing()||r.ModifiableServer?.AddModifiable(e);let o=new d.default,a=s.GetObjectAnimation(e.GetHashing());null===a&&(a=new _.default,s.AddObjectAnimation(e.GetHashing(),a)),a.AddTrack(V,o);let h=new l.default;h.SetValue(t);let p=new c.default(0,h),u=new c.default(0,p.GetValue()),C=new l.default;C.SetValue(i);let m=new c.default(0,C);1===t&&0===i?v?(u.SetFrame(60),m.SetFrame(75)):(u.SetFrame(0),m.SetFrame(15)):0===t&&1===i?v?(u.SetFrame(105),m.SetFrame(120)):(u.SetFrame(45),m.SetFrame(60)):(u.SetFrame(0),m.SetFrame(135)),o.AddKey(p),o.AddKey(u),o.AddKey(m)}}}}let n=t.getManager("VCXDressupManager").getDressups();for(let t in n)if(n.hasOwnProperty(t)){let i=n[t];if(i){let t=1,r=1,o=i.QueryInterface("VCXIVisibility");if(o){if(t=o.GetVisibility()!==a.default.EVisState.Hidden?1:0,e.FindVisibleCollab(i.GetID())>=0?r=1:(g.GetApplyNeutralAtGoToScenario()||g.GetIsTransition()||0===t)&&(r=0),0!==t||0!==r){let e=i.QueryInterface("VCXIModifiable");f.AddVisibleCollab(i);let o=new d.default,n=s.GetObjectAnimation(e.GetHashing());null===n&&(n=new _.default,s.AddObjectAnimation(e.GetHashing(),n)),n.AddTrack(V,o);let a=new l.default;a.SetValue(t);let h=new c.default(0,a),p=new c.default(0,h.GetValue()),u=new l.default;u.SetValue(r);let C=new c.default(0,u);1===t&&0===r?v?(p.SetFrame(60),C.SetFrame(75)):(p.SetFrame(0),C.SetFrame(15)):0===t&&1===r?v?(p.SetFrame(120),C.SetFrame(135)):(p.SetFrame(60),C.SetFrame(75)):(p.SetFrame(0),C.SetFrame(135)),o.AddKey(h),o.AddKey(p),o.AddKey(C)}}}}}}return console.timeEnd("BuildScenarioForTransition"),s}SetActiveScenario(e){this._bSetActiveScenario=e}SetLockEvents(e){this._bLockEvents=e}persistencyInformation(){return{implemented:!0,module:"DS/VCXWebKernelCommands",toPersistentObject:()=>this._scenarioForDo?{scenarioID:this._scenarioForDo.GetID(),activeScenario:this._bSetActiveScenario,transitionTime:this._transitionTime}:{},fromPersistentObject:e=>{if(e&&e.scenarioID){this.SetTransitionTime(e.transitionTime),this.SetActiveScenario(e.activeScenario);let t=this._experienceBase.getManager("VCXScenarioManager").GetScenarios()[e.scenarioID];this.BuildTransitionTo(t)}}}}static buildCmd(e){return new p(e)}}return p}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebKernelCommands/VCXCmdChangePropertiesWithAnimation",["require","exports","DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCmdChangeProperties","DS/VCXWebProperties/VCXPropertyMap","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebKernelCommands/VCXCmdGoToScenarioWithInterpolation"],(function(e,t,i,r,s,o,n){"use strict";r=__importDefault(r),s=__importDefault(s),o=__importDefault(o),n=__importDefault(n);class a extends r.default{constructor(e){super(e),this._isAsync=!0,this._type="VCXCmdChangePropertiesWithAnimation",this._title="Change properties with animation",this._propertyMap=new s.default,this.easingFunctions={},this._bLockEvents=!1,this._transitionTime=void 0}SetTransitionTime(e){this._transitionTime=e}async Do(){let e=this._experienceBase.getManager("VCXScenarioManager"),t=this._experienceBase.getManager("VCXCommandManager");var i=this._experienceBase.getManager("VCXContextManager").getActiveCamera();if(i){var r=i.QueryInterface("VCXIViewpointController");r&&r.fromViewpoint()}let s=e.CaptureCurrentView({bIsPartialView:!0});s.SetPropertyMapAtFrame(this._propertyMap,0);var a=new n.default(this._experienceBase);a.SetActiveScenario(!1),this.__callback&&a.SetCallback(this.__callback,this._parameter),a.SetLockEvents(this._bLockEvents),this._transitionTime&&a.SetTransitionTime(this._transitionTime),a.BuildTransitionTo(s);var l=new o.default(this._experienceBase);l.ChangePropertiesFromMap(this._propertyMap),l.SetLockEvents(!0),t.Push(l),await t.Do(a)}Undo(){this._bLockEvents||i.publish({event:"VCX_PROPERTIES_CHANGED"})}Redo(){this._bLockEvents||i.publish({event:"VCX_PROPERTIES_CHANGED"})}SaveContext(){}ChangeProperty(e,t,i){super.ChangeProperty(e,t);const r=e.GetHashing();if(i){var s=t.GetPropertyInfo().GetPropertyName(),o=this.easingFunctions[r];o||(o={},this.easingFunctions[r]=o),o[s]=i}}SetLockEvents(e){this._bLockEvents=e}}return a}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebKernelCommands/VCXCmdChangeScenarioSequence",["require","exports","DS/CoreEvents/Events","DS/VCXWebExperienceLoader/VCXExperienceSaverBase","DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebKernelCommands/VCXCmdChangeScenario","DS/VCXWebKernelCommands/VCXCmdChangeNeutralProperties"],(function(e,t,i,r,s,o,n){"use strict";s=__importDefault(s),o=__importDefault(o),n=__importDefault(n);class a extends s.default{constructor(e){super(e),this._type="VCXCmdChangeScenarioSequence",this._title="Change scenario sequence",this._scenarioToAdd=null,this._scenarioToRemove=null,this._sequenceIDForAdd="",this._sequenceIDForRemove="",this._scenarioAddIdx=-1,this._scenarioRemoveIdx=-1,this._bPush=!1,this._bLockEvents=!1,this._bMove=!1,this._bIsLoading=!1}MoveScenario(e,t,i){this._bMove=!0;var r=this._experienceBase.ComponentsMap.GetComponentFromID(e);r&&(this.RemoveScenarioFromSequence(r),void 0!==i?this.InsertScenarioInSequence(r,t,i):this.PushScenarioInSequence(r,t))}PushScenarioInSequence(e,t){this._bPush=!0,this._scenarioToAdd=e;let i=this._experienceBase.getManager("VCXSequenceManager");var r=null,s=i.GetListSequences();s[0]&&(r=s[0]);var o=i.GetSequenceFromId(t);if(o)this._sequenceIDForAdd=t;else{if(!r)return;this._sequenceIDForAdd=r.GetID(),o=r}var n=(o?.GetListScenariosId()??[]).length;this._scenarioAddIdx=n}InsertScenarioInSequence(e,t,i){this._scenarioToAdd=e,this._sequenceIDForAdd=t,this._scenarioAddIdx=i}RemoveScenarioFromSequence(e){this._scenarioToRemove=e}Do(){var e={};let t=this._experienceBase.getManager("VCXSequenceManager"),s=this._experienceBase.getManager("VCXCommandManager");if(this._scenarioToAdd)if(e={sequenceIdForAdd:this._sequenceIDForAdd,scenarioToAdd:this._scenarioToAdd,bLinked:this._bLinkedCmd,scenarioAddIdx:this._scenarioAddIdx},this._bMove)t.MoveScenarioInSequence(this._scenarioToAdd.GetID(),this._sequenceIDForAdd,this._scenarioAddIdx);else{(b=new o.default(this._experienceBase)).AddScenarios(this._scenarioToAdd),s.Push(b);var a=this._scenarioToAdd.GetID();if(this._bPush?t.PushScenarioInSequence(a,this._sequenceIDForAdd):t.InsertScenarioAtIndex(a,this._sequenceIDForAdd,this._scenarioAddIdx),!1===this._bIsLoading){var l=this._experienceBase.getManager("VCXEWSManager"),h=this._experienceBase.getManager("VCXContextManager").IsLocalMode();if(l&&!h){var c=this._experienceBase.getManager("VCXDocManager").actorDocManager.QueryInterface("VCXIModifiable");if(!c)return;var d=new n.default(this._experienceBase);d.CaptureNeutralProperties(c),d.Do();var _=a,p=this._sequenceIDForAdd,u=new r,C=u._ScenarioToJson(this._experienceBase,this._scenarioToAdd),m=u._VisibilityToJson(this._scenarioToAdd.GetVisibility(),this._experienceBase);C.visibility=m;var f=[];f.push(C);var v={};v.listScenarios=f;var S=JSON.stringify(v,null,4),V={};V.neutrals=u._NeutralsToJson(this._experienceBase);var g=JSON.stringify(V,null,4);l.CreateState(g,p,_,S)}}}if(this._scenarioToRemove){var y={sequenceIdForRemove:this._sequenceIDForRemove,scenarioToRemove:this._scenarioToRemove,scenarioRemovedIdx:this._scenarioRemoveIdx,bLinked:this._bLinkedCmd};a=this._scenarioToRemove.GetID();if(this._bMove)Object.assign(e,y);else{var b;e=y,(b=new o.default(this._experienceBase)).RemoveScenarios(this._scenarioToRemove),s.Push(b);var D=t.GetSequenceFromId(this._sequenceIDForRemove);if(!D)return;if(D.RemoveScenario(a),!1===this._bIsLoading){l=this._experienceBase.getManager("VCXEWSManager"),h=this._experienceBase.getManager("VCXContextManager").IsLocalMode();l&&!h&&l.DeleteState(a,D.GetID()).then((()=>{var e=this._experienceBase.getManager("VCXDocManager").actorDocManager.QueryInterface("VCXIModifiable"),t=new n.default(this._experienceBase);if(!e)return null;t.CaptureNeutralProperties(e),t.Do();var i=new r,s={};s.neutrals=i._NeutralsToJson(this._experienceBase);var o=JSON.stringify(s,null,4);l.CreateState(o,"","",""),console.log("DeleteState DONE")}))}}}this._bLockEvents||(this._bMove?i.publish({event:"VCX_SCENARIO_MOVED",data:e}):i.publish({event:"VCX_SCENARIO_CHANGED",data:e}))}SaveContext(){if(this._scenarioToRemove){var e=this._experienceBase.getManager("VCXSequenceManager").GetSequenceFromScenarioId(this._scenarioToRemove.GetID());if(!e)return;this._sequenceIDForRemove=e.GetID(),this._scenarioRemoveIdx=e.GetIndexOfScenario(this._scenarioToRemove.GetID())}}Invert(){var e=this._scenarioToAdd;this._scenarioToAdd=this._scenarioToRemove,this._scenarioToRemove=e;var t=this._sequenceIDForAdd;this._sequenceIDForAdd=this._sequenceIDForRemove,this._sequenceIDForRemove=t;var i=this._scenarioAddIdx;this._scenarioAddIdx=this._scenarioRemoveIdx,this._scenarioRemoveIdx=i}SetLockEvents(e){this._bLockEvents=e}}return a}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebKernelCommands/VCXCmdChangeSequence",["require","exports","DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCommand","DS/VCXWebKernelCommands/VCXCmdChangeScenarioSequence","DS/VCXWebKernelCommands/VCXCmdChangeModifiable","DS/VCXWebKernelCommands/VCXCmdChangeComponent"],(function(e,t,i,r,s,o,n){"use strict";r=__importDefault(r),s=__importDefault(s),o=__importDefault(o),n=__importDefault(n);class a extends r.default{constructor(e){super(e),this._type="VCXCmdChangeSequence",this._title="Change sequence",this._sequenceToAdd=null,this._sequenceToRemove=null,this._scenariosToRemove=[],this._prevSequence=null,this._bPush=!1,this._bLockEvents=!1,this._bIsLoading=!1}PushSequence(e){this._bPush=!0,this._sequenceToAdd=e}InsertSequence(e,t){this._sequenceToAdd=e,this._prevSequence=t}RemoveSequence(e){this._sequenceToRemove=e}Do(){var e=new o.default(this._experienceBase),t=new n.default(this._experienceBase);this._sequenceToAdd?(t.AddComponents(this._sequenceToAdd),e.AddModifiables(this._sequenceToAdd.QueryInterface("VCXIModifiable"))):this._sequenceToRemove&&(t.RemoveComponents(this._sequenceToRemove),e.RemoveModifiables(this._sequenceToRemove.QueryInterface("VCXIModifiable")));let r=this._experienceBase.getManager("VCXCommandManager"),a=this._experienceBase.getManager("VCXSequenceManager");if(r.Push(t),r.Push(e),this._sequenceToAdd){if(!this._bIsLoading){var l=this._experienceBase.getManager("VCXEWSManager");if(l){var h=this._sequenceToAdd.GetName(),c=this._sequenceToAdd.GetID();l.CreateStateCollection(h,c)}}this._bPush?a.PushSequence(this._sequenceToAdd):a.InsertSequenceAfter(this._sequenceToAdd,this._prevSequence);for(var d=0;d<this._scenariosToRemove.length;d++){var _=this._scenariosToRemove[d];(p=new s.default(this._experienceBase)).PushScenarioInSequence(_,this._sequenceToAdd.GetID()),r.Do(p)}}else if(this._sequenceToRemove){for(d=0;d<this._scenariosToRemove.length;d++){var p;_=this._scenariosToRemove[d];(p=new s.default(this._experienceBase)).RemoveScenarioFromSequence(_),r.Do(p),_=this._scenariosToRemove.pop()}a.RemoveSequence(this._sequenceToRemove.GetID())}if(this._bLockEvents);else{var u={previousSeqIndex:a.GetIndexOfSequence(this._prevSequence),sequenceToAdd:this._sequenceToAdd,sequenceToRemove:this._sequenceToRemove};i.publish({event:"VCX_SEQUENCE_CHANGED",data:u})}}SaveContext(){let e=this._experienceBase.getManager("VCXSequenceManager");var t=this._experienceBase.getManager("VCXScenarioManager").GetScenarios();if(this._sequenceToAdd){if(this._bPush){var i=e.GetListSequences(),r=i.length-1;this._prevSequence=i[r]}}else if(this._sequenceToRemove){this._prevSequence=e.GetPreviousSequence(this._sequenceToRemove);for(var s=this._sequenceToRemove.GetListScenariosId(),o=s.length-1;o>=0;o--){var n=t[s[o]];this._scenariosToRemove.push(n)}}}Invert(){var e=this._sequenceToAdd;this._sequenceToAdd=this._sequenceToRemove,this._sequenceToRemove=e}SetLockEvents(e){this._bLockEvents=e}}return a}));