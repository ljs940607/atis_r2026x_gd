define("DS/XSRCompare/compare/plugins/CHAR_STRUCT_FETCH_plugin",["UWA/Core","DS/CompareWidget2/plugins/plugin","DS/WAFData/WAFData","DS/XSRCompare/compare/expansionAdapters/CharAdapter","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInstTreeAug","DS/XSRCommonComponents/utils/ItemServiceProvider","DS/XSRCommonComponents/utils/RequestUtil","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInstTreeEditor","DS/CompareWidget2/support/typeHierMgr"],(function(e,t,n,o,r,i,s,c,a){"use strict";function u(e,t){return new Promise(((n,o)=>{let i=[],s=[];e.forEach((e=>{let n={securityContext:e._objIDSpec._securityContext,tenant:e._objIDSpec._tenant,serviceName:e._objIDSpec._serviceName};s.push(r.augment(e,n,t))})),Promise.allSettled(s).then((function(e){e.forEach((e=>{i.push(e.value)})),n(i)}),(function(e){t.errout("FAILURE AUGMENTING TREE:"+e),o(e)}))}))}function l(e){let t=this;console.log(e);let n=e.data.selectedData.map((e=>e.length?e[0].ObjIDSpec:"")),r=!1;n.forEach((e=>{e._objType&&e._objType.contains("Characteristic")&&(r=!0)})),r||p(n).then((e=>{console.log(e);let r=[];for(let i=0;i<2;i++)e[i]&&r.push(o.convert(n[i],e[i],t._plugSvcs,{filteringCondition:"LatestRevision"}));u(r,t._plugSvcs).then((e=>{t.updateOutput(r)}))}))}const p=async function(e){const t=e.map((e=>e&&e.getPhysID()));return new Promise((e=>{const n=t.map((e=>{return e&&(t=e,(new i).fetchSpecificationsData(t));var t}));Promise.allSettled(n).then((t=>{console.log(t);const n=t.map((e=>e.value.data&&e.value.data.specsData));e(n)})).catch((e=>console.log(e)))}))};return t.extend({init:function(e,t,n,o){this._parent(e,t,n,o),this.charLimitsConfig={displayRoutineLimits:!0,displaySpecificationLimits:!0}},handleCommandSelection:function(e,t){let n=this;console.log(t);let r=t.data.id,i=[];for(let t=0;t<2;t++)i.push(o.convert(e[t],n._specsData[t],n._plugSvcs,{filteringCondition:r}));u(i,n._plugSvcs).then((e=>{n.updateOutput(i)}))},execute:function(e,t){let n=this;n._parent(e,t),this.subscribeEvent("NEW_CURRENT_SELECTION_EVENT",l.bind(this)),this.subscribeEvent("CHAR_COMMAND_SELECTION",n.handleCommandSelection.bind(n,e)),e.length>0?(widget.setValue("XSRExtensions",[]),widget.setValue("Current_security_credentials",e[0].getSecurityContext().substring(5)),s.set3DSpaceURL().then((()=>{let t=[s.setSecurityContext(),s.setCSRFToken()];Promise.allSettled(t).then((()=>{p(e).then((t=>{console.log(t);const r=t;n._specsData=t;let i=[];for(let t=0;t<2;t++)i.push(o.convert(e[t],r[t],n._plugSvcs,{filteringCondition:"LatestRevision"}));console.log(i),u(i,n._plugSvcs).then((e=>{n.reportOK(e)}))}))}))}))):n.reportOK(e)},updateView:function(e,t){let n=this;const o=(r=e,i=[],s=[],u=[],l={},t.forEach((function(e){var t=e.getObjIDSpec().getUniqueID();l[t]||(l[t]=[]),l[t].push(e)})),r.forEach((function(e){var t=e.getUniqueID(),n=l[t].pop();i.push(n),u.push(t)})),Object.keys(l).forEach((function(e){l[e].forEach((function(e){s.push(e)}))})),{orderedTrees:i,extraTrees:s});var r,i,s,u,l;o.orderedTrees.forEach((function(e){var t=e.getEditCommands();null!==t&&c.applyCommands(e,t,o.extraTrees,n._plugSvcs,!0)})),function(e){const t={};e.forEach((function(e){e.visit_riTreeAndFN((function(e){const n=e.getAttr("REF.ds6w:type"),o=e.getAttr("INST.ds6w:type");return t[n]=!0,null!==o&&(t[o]=!0),!0}))}));const n=Object.keys(t);return a.loadUp(n)}(o.orderedTrees).then((function(e){n.reportOK(o.orderedTrees)}),(function(e){n._plugSvcs.warnout("failed to load type hierarchies:: "+e),n._plugSvcs.warnout("continuing..."),n.reportOK(o.orderedTrees)}))}})}));