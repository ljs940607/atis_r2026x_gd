/*!  COPYRIGHT DASSAULT SYSTEMES 2025   */
define("DS/ENOXCustomTableEditor/utils/UpdateMechanism",[],(function(){"use strict";return class{constructor(e){this.options=e}post(e){let t=this.options.messageBuilder.build(e);this.options.iframeContentWindow.postMessage(t,this.options.mepOrigin)}}})),define("DS/ENOXCustomTableEditor/model/TreeDocClass",["DS/TreeModel/TreeDocument"],(function(e){"use strict";class t{constructor(t){e.call(this,t)}}let i=Object.keys(e.prototype);for(let o=0;o<i.length;o++){let n=i[o];t.prototype[n]=e.prototype[n]}return t})),define("DS/ENOXCustomTableEditor/utils/Toolbox",["DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen"],(function(e,t){"use strict";var i=null;return class{static getUrlParam(e,t){let i=new URL(t.location.href).searchParams;return new Map(i.entries()).get(e)}static displayNotif(o){null===i&&(i=e,t.setNotificationManager(i),t.setStackingPolicy(5));o=UWA.extend({level:"info",sticky:!1},o),i.addNotif(o)}}})),define("DS/ENOXCustomTableEditor/utils/EventSigs",[],(function(){"use strict";return{ONREADY:"Dialog/onReady",ONCHANGE:"Dialog/onChange"}})),define("DS/ENOXCustomTableEditor/utils/MessageBuilder",[],(function(){"use strict";return class{constructor(e){this.options=e}build(e){let t=this.options.provider.buildData(e);return{message:"com.ds.mep:OnPrefUpdated_msg",jsonData:JSON.stringify(t)}}}})),define("DS/ENOXCustomTableEditor/utils/PubSub",["DS/CoreEvents/ModelEvents"],(function(e){"use strict";class t{static{this._modelEvents=new e}static publish(e,t){this._modelEvents.publish({event:e,data:t})}static subscribe(e,t){return this._modelEvents.subscribe({event:e},t)}static subscribeOnce(e,t){this._modelEvents.subscribeOnce({event:e},t)}static unsubscribe(e){this._modelEvents.unsubscribe(e)}}return t})),define("DS/ENOXCustomTableEditor/views/private/DataGridViewBuilder",["text!DS/ENOXCustomTableEditor/assets/html/loader.html","DS/DataGridView/DataGridView","DS/FindEx/FindDialog"],(function(e,t,i){"use strict";const o={defaultColumnDef:{width:"auto",typeRepresentation:"string"},showContextualMenuColumnFlag:!1,showRowBorderFlag:!0,showColumnBorderFlag:!0,alternateBackgroundFlag:!1,showRowIndexFlag:!1,showSelectionCheckBoxesFlag:!1,showOutlineFlag:!0,cellDragEnabledFlag:!1,rowSelection:"single",cellSelection:"none",cellActivationFeedback:"none",selectionBehavior:{canInteractiveMultiselectWithCheckboxClick:!1,canMultiSelect:!1,enableFeedbackForActiveCell:!1,enableShiftSelection:!1,toggle:!0,unselectAllOnEmptyArea:!0},placeholder:"",rowReorderEnabledFlag:!1,rowDragEnabledFlag:!0,columns:[],layoutOptions:{rowsHeader:!1,layoutDensity:"compact"}};return class{constructor(e){this.options=e,this._setup()}_setup(){this._dgvOptions=window.structuredClone(o),this._dgvOptions.placeholder=function(){let t=document.createElement("div");return t.innerHTML=e,t}()}get dgvOptions(){return this._dgvOptions}create(e){this._dgv=new t(this._dgvOptions);let o=this._dgv.getContent();if(this.options.styles&&o.setStyles(this.options.styles),this.options.classList)for(let e=0;e<this.options.classList.length;e++)o.classList.add(this.options.classList[e]);return this.options.findDialog&&(this._dgv.findDialog=new i({domId:this.options.classPrefix+"-find-dialog",visibleFlag:!1,findWidgetOptions:{relatedWidget:this._dgv,showAdditionnalOptions:!1,inputValidationThreshold:2},position:{my:"top",at:"top",of:e.findDialogContainer}})),e.parent.appendChild(this._dgv.getContent()),this._dgv}}})),define("DS/ENOXCustomTableEditor/utils/Consts",[],(function(){"use strict";return{ATT_TYPE:{REFERENCE:"Ref",INSTANCE:"Inst",CLASSIFICATION:"Classif",COMPUTED:"Computed",COMMAND:"Cmd"},ICON_TYPE:{REFERENCE:[{iconName:"object-reference",fontIconFamily:1}],INSTANCE:[{iconName:"object-instance",fontIconFamily:1}],CLASSIFICATION:[{iconName:"library-class",fontIconFamily:1}],COMPUTED:[{iconName:"compute",fontIconFamily:1}],COMMAND:[{iconName:"run",fontIconFamily:1}]}}})),define("DS/ENOXCustomTableEditor/views/private/ToolItemEnabler",[],(function(){"use strict";return class{constructor(e){this.options=e}enable(){this.options.toolbar.updateNodeModel(this.options.entryName,{disabled:!1,grid:{disabled:!1}})}disable(){this.options.toolbar.updateNodeModel(this.options.entryName,{disabled:!0,grid:{disabled:!0}})}}})),define("DS/ENOXCustomTableEditor/utils/PropCache",["UWA/Widget"],(function(e){"use strict";class t{static{window.widget=new e}static get Tenant(){return window.widget.getValue("x3dPlatformId")}static set Tenant(e){window.widget.setValue("x3dPlatformId",e)}static get Lang(){return window.widget.getValue("lang")}static set Lang(e){window.widget.setValue("lang",e)}static get AppId(){return window.widget.getValue("x3dAppId")}static set AppId(e){window.widget.setValue("x3dAppId",e)}static get IsDefaultView(){return window.widget.getValue("cte_IsDefaultView")}static set IsDefaultView(e){window.widget.setValue("cte_IsDefaultView",e)}}return t})),define("DS/ENOXCustomTableEditor/views/private/ToolBarBuilder",["DS/Tweakers/GeneratedToolbar","DS/ENOXCustomTableEditor/views/private/ToolItemEnabler"],(function(e,t){"use strict";return class{constructor(e){this.options=e}_setup(){}create(t){let i=t.ptrs.toolbarModel=e.prototype.createTreeDocument(this.options.toolbarDef);this._toolbar=new e({executionContext:this.options.executionContext,overflowManagement:this.options.overflowManagement,direction:this.options.direction,items:i});let o=this._toolbar.getContent();if(this.options.classList)for(let e=0;e<this.options.classList.length;e++)o.classList.add(this.options.classList[e]);return t.parent.appendChild(this._toolbar.getContent()),this._toolbar}createEnabler(e){return new t({toolbar:this._toolbar,entryName:e})}}})),define("DS/ENOXCustomTableEditor/utils/UrlCache",["DS/ENOXCustomTableEditor/utils/PropCache"],(function(e){"use strict";return class{static initialize(e){this._map=new Map;let t=this;return new Promise(((i,o)=>{require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],(function(n){n.getPlatformServices({config:e,onComplete:function(e){t.platformServices=e;let o=e.map((e=>[e.platformId,e]));t._map=new Map(o),i()},onFailure:o})}))}))}static getSpaceBaseUrl(){return this._map.get(e.Tenant)["3DSpace"]}}})),define("DS/ENOXCustomTableEditor/utils/Marshal",["DS/ENOXCustomTableEditor/utils/Consts"],(function(e){"use strict";return class{static toNodeOptions(t){return t.map((t=>{let i=e.ATT_TYPE.REFERENCE,o=e.ICON_TYPE.REFERENCE,n="boolean"!=typeof t.exportableFlag||t.exportableFlag,s="boolean"==typeof t.blockExportedFlag&&t.blockExportedFlag;switch(t.attType){case e.ATT_TYPE.INSTANCE:i=e.ATT_TYPE.INSTANCE,o=e.ICON_TYPE.INSTANCE;break;case e.ATT_TYPE.CLASSIFICATION:i=e.ATT_TYPE.CLASSIFICATION,o=e.ICON_TYPE.CLASSIFICATION,n="boolean"==typeof t.exportableFlag&&t.exportableFlag}return{id:t.dataIndex?t.dataIndex:t.ds6w,ds6w:t.ds6w,label:t.ds6w?t.ds6w:t.dataIndex,icons:t.icon?[t.icon]:o,grid:{mandatory:t.mandatory,attVisible:"boolean"!=typeof t.attVisible||t.attVisible,attType:i,exportCol:n,blockExportedFlag:s,pinCol:"string"==typeof t.pinned?t.pinned:"unpinned",localnls:t.localnls,width:"number"==typeof t.width?t.width:void 0,maxWidth:"number"==typeof t.maxWidth?t.maxWidth:void 0,minWidth:"number"==typeof t.minWidth?t.minWidth:void 0,alignment:"string"==typeof t.alignment?t.alignment:void 0}}}))}static toStorage(e){return e.map((e=>{let t={dataIndex:e.id,ds6w:e.ds6w},i=e.grid;return t.attType=i.attType,t.dataType=i.dataType,t.exportableFlag=i.exportableFlag,t.blockExportedFlag=i.blockExportedFlag,t.localnls=i.localnls,void 0!==i.attVisible&&(t.attVisible=i.attVisible),i.attType&&(t.attType=i.attType),i.mandatory&&(t.mandatory=i.mandatory),i.pinCol?t.pinned=i.pinCol:t.pinned="unpinned",i.width&&(t.width=i.width),i.maxWidth&&(t.maxWidth=i.maxWidth),i.minWidth&&(t.minWidth=i.minWidth),i.alignment&&(t.alignment=i.alignment),i.groupableFlag&&(t.groupableFlag=i.groupableFlag),t}))}}})),define("DS/ENOXCustomTableEditor/proxy/private/WSDictionary",["DS/ENOXCustomTableEditor/utils/UrlCache","DS/ENOXCustomTableEditor/utils/PropCache"],(function(e,t){"use strict";const i="R2019x",o="DS/FedDictionaryAccess/FedDictionaryAccessAPI";return{getPropertiesForClassBatched(e){return new Promise(((t,i)=>{let o=function(e,t,i){var o=[],n=e.length;if(n>=t)for(var s=0;s<n;s+=i)o.push(e.slice(s,s+i));else o.push(e);return o}(e.classURIs,100,100),n=[];for(let e=0;e<o.length;e++)n.push(this.getPropertiesForClassWork({classURIs:o[e]}));Promise.allSettled(n).then((e=>{let i=e.filter((e=>"fulfilled"===e.status)).map((e=>e.value)),o=[];for(let e=0;e<i.length;e++)o=o.concat(i[e]);t(o)}))}))},getPropertiesForClassWork:e=>new Promise(((n,s)=>{require([o],(function(o){o.getPropertiesForClass(e.classURIs.join("\n"),{apiVersion:i,lang:t.Lang,tenantId:t.Tenant,onComplete:function(e){var t="string"==typeof e?JSON.parse(e):e;n(t)},onFailure:function(e,t){let i={error:e,isApiFailure:!0,isTimeout:!1};t&&(i.serverError=t),s(i)},onTimeout:function(e){s({error:e,isApiFailure:!1,isTimeout:!0})}})}))})),getClassificationAttributes:e=>new Promise((function(e,o){require(["DS/ClassificationUtil/ClassificationUtil"],(function(n){n.fetchClassificationAttributes({apiVersion:i,lang:t.Lang,onComplete:t=>{e(t)},onFailure:function(e,t){let i={error:e,isApiFailure:!0,isTimeout:!1};t&&(i.serverError=t),o(i)},onTimeout:function(e){o({error:e,isApiFailure:!1,isTimeout:!0})}})}))})),async getTypesInfo(t){let i=this;return new Promise((async o=>{this.getTypeInfo({url_parameters:{parentInfo:!0,$select:"IconName"},body:t.baseTypes}).then((t=>{t="string"==typeof t?JSON.parse(t):t;for(var n=Object.getOwnPropertyNames(t),s=0;s<n.length;s++)t[n[s]]&&0===Object.keys(t[n[s]]).length&&delete t[n[s]];var l=Object.getOwnPropertyNames(t),a={"ds6w:type":l.map((e=>({value:e,source:["3DSpace"]})))};i.retrieveNLS({nlsData:a}).then((i=>{for(var n=0;n<l.length;n++)i&&(i["ds6w:type"][l[n]]?t[l[n]].displayName=i["ds6w:type"][l[n]]:t[l[n]].displayName=l[n]),t[l[n]].iconUrl=(s=t[l[n]].IconName)?e.getSpaceBaseUrl()+"/snresources/images/icons/small/"+s+".png":"";var s;o(t)}))}))}))},getResourcesInfo(e){let n=e.join(",");return new Promise(((e,s)=>{require([o],(function(o){o.getResourcesInfo(n,{tenantId:t.Tenant,lang:t.Lang,apiVersion:i,onComplete:function(t){e(t)},onFailure:function(e){s(e)}})}))}))},getTypeInfo(i){let o=new URL(e.getSpaceBaseUrl()+"/resources/dictionary/getTypeInfo"),n=o.searchParams;if(n.set("tenant",t.Tenant),i.url_parameters)for(var s=Object.keys(i.url_parameters),l=0;l<s.length;l++)n.set(s[l],i.url_parameters[s[l]]);var a={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":t.Lang}};a.data=JSON.stringify(i.body),delete a.body;let r=o.toString();return this._execute(r,a)},retrieveNLS:async e=>new Promise((function(o,n){require(["DS/SearchDictionaryAccess/SearchDictionaryAccessAPI"],(function(n){n.getNlsOfSearchValuesBySource(e.nlsData,{tenantId:t.Tenant,lang:t.Lang,apiVersion:i,onFailure:function(e){o({})},onComplete:function(e){var t=UWA.is(e,"string")?JSON.parse(e):e;o(t)}})}))})),interfaces(i){let o=new URL(e.getSpaceBaseUrl()+"/resources/dictionary/class/interfaces");o.searchParams.set("tenant",t.Tenant);var n={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":t.Lang}};n.data=JSON.stringify(i.data);let s=o.toString();return this._execute(s,n,"gridcusto/getexts")},extensions(e){let t=this;return new Promise(((i,o)=>{let n=[],s=[],l=new Set,a=new Set;t.interfaces({data:{classes:e.selectedTypes}}).then((e=>{for(let i=0;i<e.results.length;i++){let r=e.results[i];for(let e=0;e<r.interfaces.length;e++){let i=r.interfaces[e],d=i.name;o=i,((t=d).startsWith("XP_")&&t.endsWith("_Ext")||o.automatic&&"yes"===o.automatic.toLowerCase())&&(l.has(d)||(s.push({name:d,data:i}),l.add(d))),a.has(d)||(n.push({name:d,data:i}),a.add(d))}}var t,o;i({extensions:n,automaticExtensions:s})})).catch(o)}))}}})),define("DS/ENOXCustomTableEditor/proxy/WSProxy",["DS/WAFData/WAFData","DS/ENOXCustomTableEditor/proxy/private/WSDictionary"],(function(e,t){"use strict";class i{_execute(t,i){return new Promise(((o,n)=>{i.onComplete=function(e){let t="string"==typeof e?JSON.parse(e):e;o(t)},i.onFailure=function(e,t){let i={error:e,isApiFailure:!0,isTimeout:!1};t&&(i.serverError=t),n(i)},i.onTimeout=function(e){n({error:e,isApiFailure:!1,isTimeout:!0})},e.authenticatedRequest(t,i)}))}}let o;return Object.assign(i.prototype,t),o||(o=new i)})),define("DS/ENOXCustomTableEditor/model/SelectionModel",["DS/ENOXCustomTableEditor/model/TreeDocClass"],(function(e){"use strict";function t(e){e.__keepSelection=!0}function i(e){delete e.__keepSelection}return class extends e{constructor(e){super(e)}hookSelectionUpdates(e){let t=this.getXSO();t.onPostAdd(e),t.onPostRemove(e),t.onEmpty(e)}insertBefore(e,o){let n=this._getTrueRoot();t(e);let s=n.insertBefore(e,o);return i(e),s}insertAfter(e,o){let n=this._getTrueRoot();t(e);let s=n.insertAfter(e,o);return i(e),s}}})),define("DS/ENOXCustomTableEditor/views/ExtensionChooser",["i18n!DS/ENOXCustomTableEditor/assets/nls/ENOXCustomTableEditor","DS/ENOXCustomTableEditor/views/private/DataGridViewBuilder","DS/Windows/Dialog","DS/Controls/Button","DS/Utilities/Dom","DS/Controls/Tab","DS/TreeModel/TreeDocument","DS/DataGridView/DataGridView","DS/ENOXCustomTableEditor/proxy/WSProxy"],(function(e,t,i,o,n,s,l,a,r){"use strict";const d="ext-chooser";return class{constructor(e){this.options=e,this._extsChangeCounter=0,this._typesChangeCounter=0,this.elements={}}show(){let e=this;return new Promise(((t,i)=>{e.buildDialog(t,i)}))}buildDialog(t,s){this.elements.container=n.createElement("div",{class:d}),this.buildContent();var l={resizableFlag:!0,title:e.extensionChooser.title,content:this.elements.container,modalFlag:!0,usePaddingFlag:!0,position:{my:"center",at:"center"},width:350,minWidth:250,height:320,buttons:{Ok:new o({domId:d+"-ok-btn",label:e.dialog.okBtn,onClick:e=>{this.elements.creationModal.close();let i={hasChanges:!1,selectedTypes:[],selectedExtensions:[]};if(this._typesChangeCounter?(i.hasChanges=!0,i.selectedTypes=this.options.typesModel.getRoots().filter((e=>e.getReferenceValue("selectedIdx"))).map((e=>e.getReferenceValue("type")))):i.selectedTypes=window.structuredClone(this.options.selectedTypes),this._extsChangeCounter){if(i.hasChanges=!0,i.selectedExtensions=this.options.extsModel.getRoots().filter((e=>e.getReferenceValue("selectedIdx"))).map((e=>e.getReferenceValue("extension"))),this.options.automaticExtensions){let e=this.options.automaticExtensions.map((e=>e.name));e.length&&(i.selectedExtensions=i.selectedExtensions.concat(e))}}else i.selectedExtensions=window.structuredClone(this.options.selectedExtensions);t(i)}}),Cancel:new o({domId:d+"-cancel-btn",label:e.dialog.cancelBtn,onClick:e=>{this.elements.creationModal.close(),s()}})}};this._populateTypes(),this._populateExtensions(),this.elements.creationModal=new i(l)}buildContent(){this.elements.tab=new s({displayStyle:"strip"}),this.elements.tab.getContent().addClassName(d+"-tab"),this._buildContentTypes(),this._buildContentExtensions()}_buildContentTypes(){this.elements.typesDiv=n.createElement("div",{class:d+"-types"});let i=new t({classList:[d+"-dgv"]}),o=i.dgvOptions;this.options.typesModel=new l,o.layoutOptions.useLastColumnWidthAutoFlag=!1,o.columns=[{dataIndex:"selectedIdx",typeRepresentation:"boolean",visibleFlag:!0,width:40,resizableFlag:!1,sortableFlag:!0,editableFlag:!0,editionPolicy:"EditionInPlace",getCellEditableState:e=>-1===this.options.appBaseTypes.indexOf(e.nodeModel.getReferenceValue("type"))},{dataIndex:"tree",width:"auto",text:e.extensionChooser.typeName,visibleFlag:!0}],o.treeDocument=this.options.typesModel,o.onContextualEvent=this._onCtxMenuEvent.bind(this),o.sortModel=[{dataIndex:"selectedIdx",sort:"desc"}];let s=n.createElement("div",{class:d+"-dgv"});this.elements.typesDiv.appendChild(s),this.elements.typesDgv=i.create({parent:s}),this.elements.typesDgv.treeDocument.setFilterModel({label:{filterId:"stringRegexp",filterModel:{}}});let a=this;this.elements.typesDgv.addEventListener("change",(function(e,t){console.log(e),console.log(t),a._flagTypesChanged()}));var r=this.elements.typesDgv.setToolbar({entries:[{id:"findDialogIdTypes",position:"far",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"filter",fontIconFamily:1},value:()=>{this.elements.typesDgv.getFilterViewManager().getFilterPopups().label.showPopup()}}}]});this.elements.typesDiv.appendChild(r.getContent())}_buildContentExtensions(){this.elements.extsDiv=n.createElement("div",{class:d+"-exts"});let i=new t({}),o=i.dgvOptions;this.options.extsModel=new l,o.layoutOptions.useLastColumnWidthAutoFlag=!1,o.columns=[{dataIndex:"selectedIdx",typeRepresentation:"boolean",visibleFlag:!0,width:40,resizableFlag:!1,sortableFlag:!0,editableFlag:!0,editionPolicy:"EditionInPlace",getCellEditableState:e=>-1===this.options.selectedExtensions.indexOf(e.nodeModel.getReferenceValue("extension"))},{dataIndex:"tree",width:"auto",text:e.extensionChooser.extName,visibleFlag:!0}],o.treeDocument=this.options.extsModel,o.onContextualEvent=this._onCtxMenuEvent.bind(this),o.sortModel=[{dataIndex:"selectedIdx",sort:"desc"}];let s=n.createElement("div",{class:d+"-dgv"});this.elements.extsDgv=i.create({parent:s});let a=this;this.elements.extsDgv.addEventListener("change",(function(e,t){console.log(e),console.log(t),a._flagExtsChanged()})),this.elements.extsDgv.treeDocument.setFilterModel({label:{filterId:"stringRegexp",filterModel:{}}});var r=this.elements.extsDgv.setToolbar({entries:[{id:"findDialogIdExts",position:"far",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"filter",fontIconFamily:1},value:()=>{this.elements.extsDgv.getFilterViewManager().getFilterPopups().label.showPopup()}}}]});this.elements.extsDiv.appendChild(r.getContent()),this.elements.extsDiv.appendChild(s),this.elements.tab.add({label:e.extensionChooser.selectionTypeTitle,icon:{iconName:"3d-object",fontIconFamily:WUXManagedFontIcons.Font3DS},content:this.elements.typesDiv,isSelected:!0}),this.elements.tab.add({label:e.extensionChooser.selectionExtTitle,icon:{iconName:"3dproduct-add",fontIconFamily:WUXManagedFontIcons.Font3DS},content:this.elements.extsDiv}),this.elements.container.appendChild(this.elements.tab.getContent())}_populateTypes(){let e=this;r.getTypesInfo({baseTypes:this.options.selectedTypes}).then((t=>{this.options.typesModel.prepareUpdate();let i=Object.keys(t).map((i=>{let o=t[i],n=e.options.selectedTypes.includes(i);return{label:o.displayName,icons:[o.iconUrl],grid:{type:i,iconName:o.iconName,selectedIdx:n},children:null}}));this.options.typesModel.loadModel(i),this.options.typesModel.pushUpdate()}))}_populateExtensions(){let e=this.options.extsModel,t=this;r.extensions({selectedTypes:t.options.selectedTypes}).then((i=>{let o=i.extensions.map((e=>{let i=t.options.selectedExtensions.includes(e.name);return{label:e.data.nlsName,grid:{extension:e.name,iconName:e.data.iconName,selectedIdx:i,valueItem:e.name},children:null}}));t.options.automaticExtensions=i.automaticExtensions,e.prepareUpdate(),e.empty(),e.loadModel(o);let n=e.getRoots().filter((e=>!0===e.options.grid.selectedIdx));e.getXSO().add(n),e.pushUpdate()}))}_onCtxMenuEvent(e){return Promise.resolve([])}_flagExtsChanged(){this._extsChangeCounter++}_flagTypesChanged(){this._typesChangeCounter++}}})),define("DS/ENOXCustomTableEditor/views/ColumnChooser",["i18n!DS/ENOXCustomTableEditor/assets/nls/ENOXCustomTableEditor","DS/Utilities/Dom","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/DataGridView/DataGridView","DS/Tweakers/GeneratedToolbar","DS/ENOXCustomTableEditor/views/private/DataGridViewBuilder","DS/ENOXCustomTableEditor/views/private/ToolItemEnabler","DS/ENOXCustomTableEditor/views/private/ToolBarBuilder","DS/ENOXCustomTableEditor/model/SelectionModel","DS/ENOXCustomTableEditor/utils/Consts","DS/ENOXCustomTableEditor/views/ExtensionChooser","DS/ENOXCustomTableEditor/utils/PubSub","DS/ENOXCustomTableEditor/utils/EventSigs","DS/ENOXCustomTableEditor/utils/Marshal","DS/ENOXCustomTableEditor/proxy/WSProxy"],(function(e,t,o,n,s,l,a,r,d,c,p,h,u,m,g,b){"use strict";const E="col-chooser";function f(e,t){if(!1===e.hasChildren())e.addRoot(t);else{let i,o=e.getChildren(),n=t.getLabel();for(let e=0;e<o.length;e++)if(o[e].getLabel()>n){i=o[e];break}void 0===i?e.addRoot(t):e.insertBefore(t,i)}}function C(e,t){let i=new Set(e);for(let e=0;e<t.length;e++)i.add(t[e]);return Array.from(i.values())}return class{constructor(e){this.options=e,this.attrMap=new Map,this._build(),!0===this.options.lockState?this._populateSelection():this._populate()}get content(){return this.elements.container}_build(){this.elements={},this.elements.container=t.createElement("div",{class:E}),this.elements.containerColumns=t.createElement("div",{class:E+"-columns"}),this.elements.containerSelection=t.createElement("div",{class:E+"-selection"});const i=this.elements.container;!1===this.options.lockState?(this.elements.container.appendChild(this.elements.containerColumns),this._buildArrows(),this.elements.container.appendChild(this.elements.containerSelection),i.classList.remove("col-chooser-modified"),i.classList.add("col-chooser-default")):(this.elements.container.appendChild(this.elements.containerSelection),i.classList.remove("col-chooser-default"),i.classList.add("col-chooser-modified"));this.options.availableModel=new o({shouldAcceptDrag:function(){return!1},shouldBeSelected:function(e){return void 0===e.getReferenceValue("shouldBeSelected")||e.getReferenceValue("shouldBeSelected")}}),this.options.availableModel.getXSO().onPostAdd(this.__availableChange.bind(this)),this.options.availableModel.getXSO().onPostRemove(this.__availableChange.bind(this)),this.options.availableModel.getXSO().onEmpty(this.__availableChange.bind(this));let n=t.createElement("div",{class:E+"-title-chooser"});n.innerText=e.columnChooser.title,this.elements.containerColumns.appendChild(n);let s={entries:[{id:"addTypesAndExt",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"attributes-add",fontIconFamily:1},value:this.__launchExtensionChooser.bind(this),position:"far",category:"addAtt",tooltip:e.extensionChooser.title}},{id:"findInAtt",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"search",fontIconFamily:1},value:this.__launchFindDialog.bind(this),position:"far",category:"find",tooltip:e.columnChooser.tooltips.findDialog}}]},l=new d({executionContext:this,toolbarDef:s,classList:[E+"-avail-toolbar"],overflowManagement:"dropdown",direction:"horizontal"});this.elements.toolbar=l.create({ptrs:{},parent:this.elements.containerColumns});let r=new a({findDialogContainer:this.elements.container,classPrefix:E,findDialog:!0,classList:[E+"-dgv"],styles:{overflow:""}}),c=r.dgvOptions;c.columns=[{dataIndex:"tree",text:e.columnChooser.treeTitle,width:"auto",visibleFlag:!0}],c.treeDocument=this.options.availableModel,c.onContextualEvent=this._onCtxMenuEvent.bind(this),c.identifier="dgv_selection"+window.crypto.randomUUID(),c.treeNodeCellOptions={expanderStyle:"triangle",buildLinks:!1},c.identifier="dgv_columns"+window.crypto.randomUUID(),c.height="",this.elements.dgvAvailable=r.create({parent:this.elements.containerColumns}),this._buildSelection()}__launchFindDialog(){this.elements.dgvAvailable.findDialog.visibleFlag=!this.elements.dgvAvailable.findDialog.visibleFlag}__launchExtensionChooser(){let e=this;(this.elements.dialogExt=new h({classId:this.elements.container.className,appBaseTypes:this.options.columnOptions.appBaseTypes,selectedTypes:this.options.columnOptions.selectedTypes,selectedExtensions:this.options.columnOptions.selectedExtensions})).show().then((t=>{if(t.hasChanges){let i=e.options.columnOptions;i.selectedExtensions=C(i.selectedExtensions,t.selectedExtensions),i.selectedTypes=C(i.selectedTypes,t.selectedTypes),e._populate(!1)}}))}_buildArrows(){let i=t.createElement("div",{class:E+"-arrows"});if(this.elements.container.appendChild(i),!1===this.options.lockState){let t={entries:[{id:"arrowRight",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"right",fontIconFamily:1},value:this.__addColumns.bind(this),position:"center",category:"hdrArrow",disabled:!0,tooltip:e.columnChooser.tooltips.arrowRight}},{id:"arrowLeft",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"left",fontIconFamily:1},value:this.__removeColums.bind(this),position:"center",category:"hdrArrow",tooltip:e.columnChooser.tooltips.arrowLeft}}]},o=new d({executionContext:this,toolbarDef:t,overflowManagement:"dropdown",direction:"vertical"});this.elements.toolbarArrow=o.create({ptrs:{},parent:i}),this._leftEnabler=o.createEnabler("arrowLeft"),this._rightEnabler=o.createEnabler("arrowRight"),this._leftEnabler.disable(),this._rightEnabler.disable()}}_buildSelection(){let i=this;this.options.selectionModel=new c({shouldAcceptDrag:function(e){return!0},shouldAcceptDrop:function(e){let t=e.dropNode.getReferenceValue("pinCol")===e.draggedTreeNodeModel.getReferenceValue("pinCol");return"middle"!==e.dropPosition&&t}}),this.options.selectionModel.hookSelectionUpdates(this.__selectionChange.bind(this));let o=t.createElement("div",{class:E+"-title-selection"});if(o.innerText=e.selectedAtt.title,this.elements.containerSelection.appendChild(o),!0!==this.options.lockState){let t={entries:[{id:"moveUp",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"up",fontIconFamily:1},value:this._moveUp.bind(this),position:"far",category:"move",disabled:!0,tooltip:e.columnChooser.tooltips.moveUp}},{id:"moveDown",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"down",fontIconFamily:1},value:this._moveDown.bind(this),position:"far",category:"move",disabled:!0,tooltip:e.columnChooser.tooltips.moveDown}},{id:"moveTop",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"move-to-top",fontIconFamily:1},value:this._moveTop.bind(this),position:"far",category:"move",disabled:!0,tooltip:e.columnChooser.tooltips.moveTop}},{id:"moveBottom",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"move-to-bottom",fontIconFamily:1},value:this._moveBottom.bind(this),position:"far",category:"move",disabled:!0,tooltip:e.columnChooser.tooltips.moveBottom}}]},i=new d({executionContext:this,overflowManagement:"dropdown",direction:"horizontal",classList:[E+"-select-toolbar"],toolbarDef:t});this.elements.toolbarSelection=i.create({ptrs:{},parent:this.elements.containerSelection}),this._moveUpEnabler=i.createEnabler("moveUp"),this._moveDownEnabler=i.createEnabler("moveDown"),this._moveTopEnabler=i.createEnabler("moveTop"),this._moveBottomEnabler=i.createEnabler("moveBottom")}let n=new a({classList:[E+"-dgvSelection"],styles:{overflow:""}}),s=n.dgvOptions;this.options.lockState?(s.cellDragEnabledFlag=!1,s.rowDragEnabledFlag=!1,s.rowReorderEnabledFlag=!1,s.layoutOptions.rowsHeader=!1):(s.cellDragEnabledFlag=!0,s.rowDragEnabledFlag=!0,s.rowReorderEnabledFlag=!0,s.layoutOptions.rowsHeader=!0),s.columns=[{dataIndex:"attVisible",typeRepresentation:"boolean",icon:{iconName:"eye",fontIconFamily:1},width:40,visibleFlag:!0,editableFlag:!this.options.lockState,editionPolicy:"EditionInPlace",getCellEditableState:e=>{let t=!this.options.lockState;return!0===e.nodeModel.getReferenceValue("mandatory")&&(t=!1),t}},{dataIndex:"tree",text:e.selectedAtt.colName,width:"auto",visibleFlag:!0},{dataIndex:"pinCol",icon:{iconName:"pin",fontIconFamily:1},typeRepresentation:"customEnumMember",text:e.selectedAtt.pin,visibleFlag:!0,alignmentValue:"center",width:75,minWidth:75,maxWidth:75,editableFlag:!this.options.lockState,editionPolicy:"EditionOnOver",sortableFlag:!1,resizableFlag:!1,getCellSemantics:function(t){return{possibleValues:[{value:"left",label:e.selectedAtt.pinLeft},{value:"right",label:e.selectedAtt.pinRight},{value:"unpinned",label:""}]}}}],s.treeDocument=this.options.selectionModel,s.onContextualEvent=this._onCtxMenuEvent.bind(this),s.identifier="dgv_selection"+window.crypto.randomUUID(),s.height="",this.elements.dgvSelection=n.create({parent:this.elements.containerSelection}),this.elements.dgvSelection.getContent().addClassName(E+"-dgvSelection"),this.elements.dgvSelection.addEventListener("change",(function(e,t){console.log(e),console.log(t),u.publish(m.ONCHANGE),i._rebuildSelectedColumns()}))}update(e){this.options.columnOptions=e,this._populate()}updateTimeStamp(){this.options.columnOptions.viewTimeStamp=Date.now()}_moveTop(e){let t=this.options.selectionModel,i=t.getXSO();if(!i.isEmpty()){let e=i.get()[0],o=t.getRoots()[0];t.insertBefore(e,o),i.empty(),i.add(e),this._rebuildSelectedColumns(),u.publish(m.ONCHANGE)}}_moveBottom(e){let t=this.options.selectionModel,i=t.getXSO();if(!i.isEmpty()){let e=i.get()[0],o=t.getRoots(),n=o[o.length-1];t.insertAfter(e,n),this._rebuildSelectedColumns(),i.empty(),i.add(e),u.publish(m.ONCHANGE)}}_moveUp(e){let t=this.options.selectionModel,i=t.getXSO();if(!i.isEmpty()){let e=i.get()[0],o=t.getRoots(),n=o.indexOf(e);n--;let s=o[n];t.insertBefore(e,s),this._rebuildSelectedColumns(),u.publish(m.ONCHANGE)}}_moveDown(e){let t=this.options.selectionModel,i=t.getXSO();if(!i.isEmpty()){let e=i.get()[0],o=t.getRoots(),n=o.indexOf(e);n++;let s=o[n];t.insertAfter(e,s),this._rebuildSelectedColumns(),u.publish(m.ONCHANGE)}}async _populate(t){let i=this.options.columnOptions,o=i.selectedColumns.map((e=>e.dataIndex&&"tree"!==e.dataIndex?e.dataIndex:e.ds6w));this.options.availableModel.removeRoots(),this.options.availableModel.prepareUpdate(),this.attrMap.clear();let s=i.selectedTypes.map((e=>"XP_"+e+"_Ext")),l=[].concat(i.selectedTypes).concat(s).concat(i.selectedExtensions),a=[].concat(i.selectedTypes).concat(i.selectedExtensions);b.getPropertiesForClassBatched({classURIs:l}).then((s=>{b.getTypesInfo({baseTypes:a}).then((l=>{let a=new n({icons:[{iconName:"attributes",fontIconFamily:1}],label:e.columnGroups.commonAttributes,grid:{shouldBeSelected:!1}});this.options.availableModel.addRoot(a);let r=new n({icons:[{iconName:"attributes",fontIconFamily:1}],label:e.columnGroups.typesAttributes,grid:{shouldBeSelected:!1}});this.options.availableModel.addRoot(r);let d=new n({icons:[{iconName:"attributes-add",fontIconFamily:1}],label:e.columnGroups.extsAttributes,grid:{shouldBeSelected:!1}});this.options.availableModel.addRoot(d);for(let e=0;e<s.length;e++){let t=s[e],n=!1,l=t.classInfo.curi.replace("ds6wg:","");"ds6wg:VPMInstance"!==t.classInfo.curi&&"ds6wg:VPMRepInstance"!==t.classInfo.curi||(n=!0);let a=-1!==i.selectedTypes.indexOf(l)?"FromType":"FromExt",r=t.properties;for(let e=0;e<r.length;e++){let t=r[e];if(!t.label||""===t.label.trim())continue;if("Not to be displayed in UI"===t.label)continue;if("ds6wg:PLMReference.V_isLastVersion"===t.curi)continue;let i=t.curi+(n?"-Instance":""),s=!1;-1!==o.indexOf(i)&&(s=!0);let d=this.attrMap.get(i);if(d)d.grid.declaredIn.push(l),this.attrMap.set(d.id,d);else{let e=n?p.ATT_TYPE.INSTANCE:p.ATT_TYPE.REFERENCE,o=n?p.ICON_TYPE.INSTANCE:p.ICON_TYPE.REFERENCE,r={id:i,label:t.label,icons:o,grid:{dataType:t.dataType,dimension:t.dimension,attType:e,kind:a,exportableFlag:!0,declaredIn:[l],selectedAtt:s,width:t.width,alignment:t.alignment},children:null};this.attrMap.set(r.id,r)}}}let c={id:"positionMatrix-Instance",ds6w:"matrixtxt",label:e.columnsHardCoded["positionMatrix-Instance"],icons:p.ICON_TYPE.INSTANCE,grid:{dataType:"Instance",attType:"Instance",kind:"FromType",exportableFlag:!1,declaredIn:["VPMInstance","VPMRepInstance"],selectedAtt:!0,localnls:!0,groupableFlag:!1},children:null};this.attrMap.set(c.id,c);let h={id:"thumbnail",icons:p.ICON_TYPE.REFERENCE,label:e.columnsHardCoded.thumbnail,grid:{kind:"FromType",exportableFlag:!1,declaredIn:["VPMReference","VPMRepReference","3DShape"],groupableFlag:!1,localnls:!0},children:null};this.attrMap.set(h.id,h);let u={};this.attrMap.forEach(((e,t,i)=>{let o=new n(e);if(0!==e.id.indexOf("ds6wg:")||"positionMatrix-Instance"===e.dw6w||"thumbnail"===e.dw6w)f(a,o);else if("FromType"===e.grid.kind){let t=u[e.grid.declaredIn[0]];void 0===t&&(t=new n({id:e.grid.declaredIn[0],label:l[e.grid.declaredIn[0]]&&l[e.grid.declaredIn[0]].displayName?l[e.grid.declaredIn[0]].displayName:e.grid.declaredIn[0],icons:l[e.grid.declaredIn[0]]?[l[e.grid.declaredIn[0]].iconUrl]:[],grid:{shouldBeSelected:!1}}),u[e.grid.declaredIn[0]]=t,f(r,t)),f(t,o)}else{let t=u[e.grid.declaredIn[0]];void 0===t&&(t=new n({id:e.grid.declaredIn[0],label:l[e.grid.declaredIn[0]]&&l[e.grid.declaredIn[0]].displayName?l[e.grid.declaredIn[0]].displayName:e.grid.declaredIn[0],icons:l[e.grid.declaredIn[0]]?[l[e.grid.declaredIn[0]].iconUrl]:[],grid:{shouldBeSelected:!1}}),u[e.grid.declaredIn[0]]=t,f(d,t)),f(t,o)}!0===o.getReferenceValue("selectedAtt")&&o.hide()})),b.getClassificationAttributes().then((i=>{if(i&&i.length){let t;for(let s=0;s<i.length;s++){let l=i[s];for(let i=0;i<l.properties.length;i++){void 0===t&&(t=new n({icons:p.ICON_TYPE.CLASSIFICATION,label:e.columnGroups.classifAttributes,grid:{shouldBeSelected:!1}}),this.options.availableModel.addRoot(t));let s=l.properties[i],a=!1;if(-1!==o.indexOf(s.curi)&&(a=!0),!this.attrMap.get(s.curi)){let e={id:s.curi,label:s.label,icons:p.ICON_TYPE.CLASSIFICATION,grid:{dataType:s.dataType,dimension:s.dimension,attType:"Classif",kind:"Classif",exportableFlag:!1,selectedAtt:a},children:null},i=new n(e);f(t,i),!0===i.getReferenceValue("selectedAtt")&&i.hide(),this.attrMap.set(e.id,e)}}}}this.options.availableModel.pushUpdate(),t||this._populateSelection()}))}))}))}_populateSelection(){this.options.selectionModel.empty(),this.options.selectionModel.prepareUpdate();let t=window.structuredClone(this.options.columnOptions.selectedColumns),i=new Set,o=new Map,n=g.toNodeOptions(t);for(let t=0;t<n.length;t++){let s=n[t];if(s.grid.localnls)s.label=e.localnls[s.ds6w];else{let e=s.ds6w;i.add(e);let t=o.get(e);t?t.push(s):(t=[s],o.set(e,t))}}let s=this;b.getResourcesInfo(Array.from(i.values())).then((e=>{let t=e.filter((e=>void 0!==e.curi));for(let e=0;e<t.length;e++){let i=t[e];o.get(i.curi).map((e=>{e.label=i.label}))}s.options.selectionModel.loadModel(n),s.options.selectionModel.pushUpdate(),u.publish(m.ONREADY,{})}))}__selectionChange(e){let t=this.options.selectionModel.getXSO();if(t.isEmpty())this._leftEnabler.disable(),this._moveBottomEnabler.disable(),this._moveTopEnabler.disable(),this._moveUpEnabler.disable(),this._moveDownEnabler.disable();else{this._leftEnabler.enable();let e=t.get();if(1===e.length){let t=e[0],i=this.options.selectionModel.getRoots(),o=i.length-1,n=i.indexOf(t);0===n?(this._moveTopEnabler.disable(),this._moveUpEnabler.disable(),this._moveBottomEnabler.enable(),this._moveDownEnabler.enable()):n===o?(this._moveTopEnabler.enable(),this._moveUpEnabler.enable(),this._moveBottomEnabler.disable(),this._moveDownEnabler.disable()):(this._moveTopEnabler.enable(),this._moveUpEnabler.enable(),this._moveBottomEnabler.enable(),this._moveDownEnabler.enable())}}}__availableChange(e){this.options.availableModel.getXSO().isEmpty()?this._rightEnabler.disable():this._rightEnabler.enable()}__removeColums(e){let t=this.options.selectionModel.getSelectedNodes();if(t.length){let e=t.map((e=>e.options.id));for(this.options.availableModel.search({match:function(t){let i=t.nodeModel.options.id;return!!i&&e.includes(i)},useTransaction:!1}).forEach((e=>{e.show()}));t.length;){t.pop().remove()}this._rebuildSelectedColumns(),u.publish(m.ONCHANGE)}}__addColumns(e){let t=this.options.availableModel.getSelectedNodes();if(t.length){let e=t.map((e=>{let t=e.options;return{id:t.id,ds6w:t.id.replaceAll("-Instance",""),label:e.getLabel(),icons:e.getIcons(),grid:{mandatory:!1,attVisible:!0,attType:e.getReferenceValue("attType"),dataType:e.getReferenceValue("dataType"),exportCol:e.getReferenceValue("exportableFlag"),blockExportedFlag:!0===e.getReferenceValue("blockExportedFlag"),pinCol:e.getReferenceValue("pinCol")?nodesToAdd[i].getReferenceValue("pinCol"):"unpinned",localnls:!0===e.getReferenceValue("localnls"),width:"number"==typeof e.getReferenceValue("width")?nodesToAdd[i].getReferenceValue("width"):void 0,maxWidth:"number"==typeof e.getReferenceValue("maxWidth")?nodesToAdd[i].getReferenceValue("maxWidth"):void 0,minWidth:"number"==typeof e.getReferenceValue("minWidth")?nodesToAdd[i].getReferenceValue("minWidth"):void 0,alignment:"string"==typeof e.getReferenceValue("alignment")?nodesToAdd[i].getReferenceValue("alignment"):void 0,groupableFlag:"boolean"==typeof e.getReferenceValue("groupableFlag")?nodesToAdd[i].getReferenceValue("groupableFlag"):void 0}}}));this.options.selectionModel.addRoot(e),t.forEach((e=>{e.hide()})),this._rebuildSelectedColumns(),u.publish(m.ONCHANGE)}}_rebuildSelectedColumns(){let e=this.options.selectionModel.getRoots().map((e=>e.options)),t=g.toStorage(e);this.options.columnOptions.selectedColumns=t}_onCtxMenuEvent(e){return Promise.resolve([])}}})),define("DS/ENOXCustomTableEditor/views/Component",["DS/Utilities/Dom","DS/Controls/ComboBox","DS/Controls/Button","DS/Controls/LineEditor","DS/Tweakers/GeneratedToolbar","DS/ENOXCustomTableEditor/views/private/ToolBarBuilder","DS/ENOXCustomTableEditor/views/private/ToolItemEnabler","DS/ENOXCustomTableEditor/views/ColumnChooser","DS/ENOXCustomTableEditor/utils/PropCache","DS/ENOXCustomTableEditor/utils/Toolbox","DS/ENOXCustomTableEditor/utils/PubSub","DS/ENOXCustomTableEditor/utils/EventSigs","i18n!DS/ENOXCustomTableEditor/assets/nls/ENOXCustomTableEditor","DS/TreeModel/TreeDocument"],(function(e,t,i,o,n,s,l,a,r,d,c,p,h,u){"use strict";const m="tableedit";return class{constructor(e){this.options=e,this._changeCounter=0,this.options.paramName=d.getUrlParam("prefName",this.options.localWindow),r.IsDefaultView="TABLE_DEFAULT"===this.options.paramName,this._buildView(),c.subscribe(p.ONCHANGE,this._onChangeEvent.bind(this))}_buildView(){this.elements={container:null},this.elements.container=e.createElement("div",{class:m+"-frame "+(this.options.lockState?m+"-locked":"")}),this.elements.hdr=e.createElement("div",{class:m+"-hdr"}),this.elements.container.appendChild(this.elements.hdr);let i=e.createElement("div",{class:m+"-hdr-label"});i.innerText="Product Structure Table Views",this.elements.hdr.appendChild(i);let n=this.options.jsonData.ENO2D_VIEWS.map((e=>h.component.views[e.ENO2D_VIEW_NAME]?h.component.views[e.ENO2D_VIEW_NAME]:e.ENO2D_VIEW_NAME)),l=e.createElement("div",{class:m+"-hdr-both"});this.elements.hdr.appendChild(l);let d=e.createElement("div",{class:m+"-hdr-view"});l.appendChild(d),this.options.viewModel=new u;for(let e=0;e<n.length;e++)this.options.viewModel.addRoot({label:n[e],value:n[e]});let c=this.elements.hdrCombo=new t({disabled:r.IsDefaultView,enableSearchFlag:!1,elementsTree:this.options.viewModel,selectedIndex:0});c.getContent().addEventListener("change",(e=>{let t=e.dsModel.elementsTree.getSelectedNodes()[0].options.value;console.log("== Change view to "+t),this.options.activeView=t;let i=this.options.jsonModifiedViews.find((e=>e.viewName===t));this.elements.columnChooser.update(i)})),c.getContent().addClassName(m+"-hdr-combo"),d.appendChild(c.getContent());let p=!1;if(!r.IsDefaultView&&!1===this.options.lockState){let t=this.elements.hdrEditor=new o({requiredFlag:!0,displayClearFieldButtonFlag:!0});t.addEventListener("change",(e=>{e.dsModel.value.length>2&&this.__editInProgress&&this._applyEdit()})),t.getContent().addClassName(m+"-hdr-editor hidden"),d.appendChild(t.getContent());let i=e.createElement("div",{class:m+"-hdr-toolbar"});l.appendChild(i);let n={entries:[{id:"addView",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"plus",fontIconFamily:1},value:this._createView.bind(this),position:"near",category:"hdrcmd",disabled:!1,tooltip:h.component.tooltips.addView}},{id:"editView",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"pencil",fontIconFamily:1},value:this._beginEdit.bind(this),position:"near",category:"hdrcmd",tooltip:h.component.tooltips.editView}},{id:"removeView",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"trash",fontIconFamily:1},value:this._removeView.bind(this),position:"near",category:"hdrcmd",disabled:!1,tooltip:h.component.tooltips.removeView}}]},a=new s({executionContext:this,overflowManagement:"dropdown",direction:"horizontal",toolbarDef:n});a.create({ptrs:{},parent:i}),this._createViewEnabler=a.createEnabler("addView"),this._editViewEnabler=a.createEnabler("editView"),this._removeViewEnabler=a.createEnabler("removeView"),r.IsDefaultView?(this._createViewEnabler.disable(),this._editViewEnabler.disable(),this._removeViewEnabler.disable()):p=!0}this.elements.content=e.createElement("div",{class:m+"-content "+(this.options.lockState?m+"content-locked":"")}),this.elements.container.appendChild(this.elements.content),this.options.jsonModifiedViews=this.options.jsonData.ENO2D_VIEWS.map((e=>function(e){let t={viewName:e.ENO2D_VIEW_NAME,defaultTypes:e.ENO2D_DEFAULT_TYPES,defaultExts:e.ENO2D_DEFAULT_EXTS,defaultColumns:e.ENO2D_DEFAULT_COLS,appBaseTypes:e.ENO2D_BASED_TYPES,selectedTypes:e.ENO2D_SELECTED_TYPES,selectedExtensions:e.ENO2D_SELECTED_EXTS,selectedColumns:e.ENO2D_SELECTED_COLS};return e.ENO2D_VIEW_TS&&(t.viewTimeStamp=e.ENO2D_VIEW_TS),t}(e))),p&&this._updateCreateEditRemove();let g=this.options.jsonModifiedViews[0];this.elements.columnChooser=new a({columnOptions:g,jsonData:this.options.jsonData,lockState:this.options.lockState}),this.elements.content.appendChild(this.elements.columnChooser.content),this.elements.targetDiv=document.getElementById(this.options.targetId),this.elements.targetDiv.innerHTML="",this.elements.targetDiv.appendChild(this.elements.container)}_updateCreateEditRemove(){1===this.options.jsonModifiedViews.length?(this._createViewEnabler.enable(),this._editViewEnabler.enable(),this._removeViewEnabler.disable()):(this.options.jsonModifiedViews.length<4&&this._createViewEnabler.enable(),this._editViewEnabler.enable(),this._removeViewEnabler.enable())}_createView(e){let t=window.structuredClone(this.options.jsonModifiedViews[0]),i=this.options.jsonModifiedViews.map((e=>e.viewName));t.viewName=function(e,t){let i=e,o=1;for(;t.includes(i);)i=e+o,o++;return i}("customview",i),this.options.jsonModifiedViews.push(t),this.options.viewModel.empty();let o=this.options.jsonModifiedViews.map((e=>({label:e.viewName,value:e.viewName}))),n=this.options.viewModel.loadModel(o);this.options.jsonModifiedViews.length>=4&&this._createViewEnabler.disable(),n&&n.select(),this._updateCreateEditRemove(),this._incrementChange()}_applyEdit(){if(delete this.__editInProgress,0===this.options.viewModel.search({match:e=>e.nodeModel.getLabel()===this.elements.hdrEditor.value}).length){let e=this.options.viewModel.getSelectedNodes()[0];this.options.viewModel.prepareUpdate(),e.updateOptions({label:this.elements.hdrEditor.value,value:this.elements.hdrEditor.value}),this.options.viewModel.pushUpdate();const t=this.options.jsonModifiedViews.findIndex((e=>e.viewName===this.options.activeView));-1!==t&&(this.options.jsonModifiedViews[t].viewName=this.elements.hdrEditor.value)}else d.displayNotif({level:"warning",title:h.warning.viewAlreadyExistsMod.title,message:h.replace(h.warning.viewAlreadyExistsMod.msg,{viewName:this.elements.hdrEditor.value}),sticky:!1,key:"viewAlreadyExistsMod"});this.elements.hdrEditor.getContent().toggleClassName("hidden"),this.elements.hdrCombo.getContent().toggleClassName("hidden"),this.elements.hdrCombo._selectedIndexModified(),this.__updToolbarIcon=!0,this.elements.columnChooser.elements.toolbar.updateNodeModel("validateView",{visibleFlag:!1}),this.elements.columnChooser.elements.toolbar.updateNodeModel("editView",{visibleFlag:!0}),this.elements.content.removeAttribute("disabled")}_beginEdit(e){this.elements.hdrCombo.getContent().toggleClassName("hidden");let t=this.options.viewModel.getSelectedNodes()[0];this.elements.hdrEditor.value=t.getLabel(),this.elements.hdrEditor.getContent().toggleClassName("hidden"),this.elements.columnChooser.elements.toolbar.updateNodeModel("editView",{visibleFlag:!1}),this.elements.columnChooser.elements.toolbar.updateNodeModel("validateView",{visibleFlag:!0}),this.__editInProgress=!0,this.elements.content.setAttribute("disabled","")}_removeView(e){var t=this.options.viewModel.getSelectedNodes()[0];t.remove(),this.options.jsonModifiedViews.forEach((e=>{if(e.viewName===t.options.label){let t=this.options.jsonModifiedViews.indexOf(e);this.options.jsonModifiedViews.splice(t,1)}})),this.options.viewModel.getRoots()[0].select(),this._updateCreateEditRemove(),this._incrementChange()}_onChangeEvent(e){this._incrementChange()}_incrementChange(){this._changeCounter++,this.elements.columnChooser.updateTimeStamp()}get hasChanges(){return this._changeCounter>0}buildData(e){if(this.hasChanges){let e={ENO2D_VIEWS:[]};return e.ENO2D_VIEWS=this.options.jsonModifiedViews.map((e=>function(e){let t={ENO2D_VIEW_NAME:e.viewName,ENO2D_DEFAULT_TYPES:e.defaultTypes,ENO2D_DEFAULT_EXTS:e.defaultExts,ENO2D_DEFAULT_COLS:e.defaultColumns,ENO2D_BASED_TYPES:e.appBaseTypes,ENO2D_SELECTED_TYPES:e.selectedTypes,ENO2D_SELECTED_EXTS:e.selectedExtensions,ENO2D_SELECTED_COLS:e.selectedColumns};return e.viewTimeStamp&&(t.ENO2D_VIEW_TS=e.viewTimeStamp),t}(e))),e}return this.options.jsonData}}})),define("DS/ENOXCustomTableEditor/Main",["css!DS/ENOXCustomTableEditor/ENOXCustomTableEditor.css","css!DS/Core/wux-3ds-fonticons.css","DS/ENOXCustomTableEditor/views/Component","DS/ENOXCustomTableEditor/utils/PropCache","DS/ENOXCustomTableEditor/utils/UrlCache","DS/ENOXCustomTableEditor/utils/UpdateMechanism","DS/ENOXCustomTableEditor/utils/MessageBuilder"],(function(e,t,i,o,n,s,l){"use strict";return class{constructor(e){this.options=e,this._setup()}_setup(){let e=this;o.Tenant=this.options.tenantID,o.AppId=this.options.appId,o.Lang=this.options.compassConfig.lang,this._boundMessageEvent=this._messageEvent.bind(this),this.options.localWindow.addEventListener("message",this._boundMessageEvent),n.initialize(this.options.compassConfig).then((()=>{e._buildUX()}))}_buildUX(){this._component=new i({localWindow:this.options.localWindow,targetId:this.options.targetId,jsonData:this.options.jsonData,prefName:this.options.prefName,lockState:this.options.lockState})}_buildAndSendMessage(){new s({mepOrigin:this.options.mepOrigin,iframeContentWindow:this.options.iframeContentWindow,messageBuilder:new l({provider:this._component})}).post({})}_messageEvent(e){if("MessageBus:queryOrigin"===e.data.type)return;"com.ds.mep:OnOKBtnClicked_msg"===e.data.message&&(this.options.localWindow.removeEventListener("message",this._boundMessageEvent),this._buildAndSendMessage())}}}));