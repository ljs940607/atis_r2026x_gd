define("DS/DELWebViewerBuildUpControllerV2/BuildUpHelper",["UWA/Core","DS/DELWebViewerModel/Buildup/BuildUpSettings","DS/DELWebViewerUtils/Utils"],(function(e,t,n){"use strict";return function(n,i,r){var o=r.getOption("logger"),u=i.getInstance("BuildUpBehaviorModelService"),l=r.getOption("mappingKeys"),a=l.GRAPHICPROPERTIES;return{set:u.set,getCurrentBuildUpContent:function(){let t,n=u.get("currentBuildupContent");return n&&(t=e.clone(n,!0)),t},setCurrentBuildUpContent:function(e){u.set("currentBuildupContent",e)},removeCurrentBuildUpContent:function(){u.set("currentBuildupContent",null)},getMfgAndResourceBuildup:function(){return u.getMfgAndResourceBuildup()},getFTABuildup:function(){return u.getFTABuildup()},isBuildUpApplied:function(){return e.is(u.get("currentBuildupContent"))},getBuildUpData:async function(t){let n=u.getProcessInfo();if(!(t&&e.is(t.path,"array")&&t.path.length>0)){let e=new Error(r.getNLSValue("Error.StepPathInvalid.Message"));throw e.code="DELVIEWER_E001",e}return o.info("getBuildUpData method invoked with parameters :",t),await u.getBuildUp(function(t){var i=e.clone(t);return e.is(i.session,"object")||(i.session={}),e.is(i.scopedMfg,"object")||(i.scopedMfg={}),i.session.id=i.session.id?i.session.id:u.getSessionId(),i.scopedMfg.id=i.scopedMfg.id?i.scopedMfg.id:n&&e.is(n.scopedMfg,"array")&&n.scopedMfg.length>0?n.scopedMfg[0].id:null,i.id=i&&i.id?i.id:n&&n.id?n.id:null,i}(t))},getBuildUpGlobalSettings:function(){return u.getBuildUpGlobalSettings()},reset:function(){n&&n.reset(),u.reset()},destroy:function(){u&&u.destroy(),o=u=l=a=null},getComputedBuildUpData:function(n,i){let r=l.BUILDUPKEYS.CATEGORY,s=l.BUILDUPKEYS.PATH,d=l.BUILDUPKEYS.POSITION,p={mfgAndResourceBuildup:[],ftaBuildup:[]},c=e.is(i)?i:u.getBuildUpGlobalSettings(),g=t.getParsedBuildUpSettings(c),f=function(t={},n={}){let i=e.is(n[a.VISIBILITY],"boolean")?n[a.VISIBILITY]:null;t[a.VISIBILITY]=i,t[a.VISIBILITYFREE]=!i,t[a.COLOR]=n[a.COLOR]?n[a.COLOR]:null,t[a.OPACITY]=e.is(n[a.OPACITY],"number")?n[a.OPACITY]:null},B=function(e){var n,i={},o=e[r]?e[r].toLowerCase():"";return o?(n=t.getGraphicProperties(g,o),i[s]=e[s],n&&f(i,n),i[d]=e[d]?e[d]:"",i[r]=o,i.type=e.type,i.isSymbolic=e.isSymbolic):i=e,i},h=function(e){let n,i=l.BUILDUPKEYS.FTAGEOMID,o={},a=e[r]?e[r].toLowerCase():"";return a?(n=t.getGraphicsPropertiesForFTA(u.getBuildUpGlobalSettings()),n&&f(o,n),o[i]=e[i],o[s]=e[s],o[d]=e[d]?e[d]:"",o[r]=a,o.type=e.type):o=e,o.usePathElement=!0,o};return o.info("getComputedBuildUpData method invoked with parameters : ",n),n&&e.is(n.mfgAndResourceBuildup,"array")&&(p.mfgAndResourceBuildup=n.mfgAndResourceBuildup.map(B)),n&&e.is(n.ftaBuildup,"array")&&(p.ftaBuildup=n.ftaBuildup.map(h)),p},isObjectAvailable:u.isObjectAvailable}}})),define("DS/DELWebViewerBuildUpControllerV2/BuildUpCommandsBehavior",["UWA/Core","DS/DELWebViewerModel/Buildup/BuildUpSettings"],(function(e,t){"use strict";return function(e,n,i){const r=i.getOption("mappingKeys");var o=n.getInstance("BuildUpBehaviorModelService"),u=i.getOption("eventCollection").getViewerCtrlEventHnd(),l=function(){return e.getMode()===r.VIEWERMODES.BUILDUP},a=function(e){let n;e&&l()&&(n=o.getBuildUpGlobalSettings(),n&&(t.updateBuildUpColorSettings(n,e.state),o.setBuildUpGlobalSettings({settings:n})))},s=function(e){let n;e&&l()&&(n=o.getBuildUpGlobalSettings(),t.updateBuildUpOptions(n,e),o.setBuildUpGlobalSettings({settings:n}))},d=function(){if(l()){let e=o.getProcessInfo();o.updateBuildUpSettings({processId:e&&e.id?e.id:null,clear:!0})}};return function(){var e={onShowBuildupColorChange:a,onBuildUpDisplayOptionsChange:s,onBuildUpDisplayOptionsReset:d};for(let t in e)Object.prototype.hasOwnProperty.call(e,t)&&u.subscribe(u.events[t],e[t])}(),{reset:function(){}}}})),define("DS/DELWebViewerBuildUpControllerV2/BuildUpController",["UWA/Core","DS/DELWebViewerBuildUpControllerV2/BuildUpHelper","DS/DELWebViewerBuildUpControllerV2/BuildUpCommandsBehavior","DS/DELWebUiComponent/NotificationUtils"],(function(e,t,n,i){"use strict";return function(r,o,u,l){let a;var s=l.getOption("logger"),d=o.getToolBar(),p=l.getOption("eventCollection").getModelCtrlEventHnd(),c=d?new n(o,u,l):null,g=new t(c,u,l),f=l.getOption("eventCollection").getViewerCtrlEventHnd(),B=l.getOption("mappingKeys"),h=function(t){d&&e.is(t,"boolean")&&!0===l.getOption("quickToolBar")&&(t?d.show():d.hide())},U=[],S=[],C=function(){U.length>0&&(o.getContext().getController().unlockNodes({ids:U}),U=[])},I=function(){o.removeSceneGraphOverrideSet(B.SCENEGRAPHKEYS.PUBLIC)},P=function(t){return function(t){return new e.Promise((function(n,i){var r;e.is(g.getBuildUpGlobalSettings(),"object")?n(t):(r=l.getNLSValue("Error.BuildUpSettingsNotFound.Message"),s.error(r),i(r))}))}(t).then((function(t){return new e.Promise((function(n,i){var r;e.is(t.path,"array")?n(t):(r=l.getNLSValue("Error.StepPathInvalid.Message"),s.error(r),i(r))}))})).then((function(e){return g.getBuildUpData(e)})).then((function(e){return g.getComputedBuildUpData(e)}))},E=function(t){let n=[];return t&&e.is(t.mfgAndResourceBuildup,"array")&&(n=n.concat(t.mfgAndResourceBuildup)),t&&e.is(t.ftaBuildup,"array")&&(n=n.concat(t.ftaBuildup)),n},v=function(t,n,i=!1){let r=!t||!1!==t.clear;return new e.Promise((function(u,d){var p=function(e=[]){o.render(),i||f.publish(f.events.onGlobalBuildUpComplete,{pathIds:t.path,graphicData:e}),u(n)};if(n&&e.is(n.mfgAndResourceBuildup,"array"))if(a.isBuildUpApplied()&&!r||I(),o.setPickability(B.PICKABILITY.BUILDUP),o.deleteOverrides(B.SCENEGRAPHKEYS.BUILDUP),h(!0),g.setCurrentBuildUpContent({pathIds:t.path,buildupData:n}),n.mfgAndResourceBuildup.length>0){let e=E(n);o.setGraphicProperties({graphicProperties:e},B.SCENEGRAPHKEYS.BUILDUP).then((function(){p(e)})).fail(d)}else p();else s.error("BuildUp Graphic data not found"),d(l.getNLSValue("Error.GraphicDataNotFound.Message"))}))},b=function(){let e=g.getCurrentBuildUpContent();if(e){let t=g.getComputedBuildUpData(e.buildupData);v({path:e.pathIds,clear:!1},t)}};return function(){if(f&&p){let e=[{name:p.events.onSetBuildUpGlobalSettingsComplete,callback:b,handler:p}];for(let t of e)S.push({handler:t.handler,token:t.handler.subscribe(t.name,t.callback)})}}(),a={applyBuildupSettings:async function(e){let t=g.getCurrentBuildUpContent();if(t){let n=g.getComputedBuildUpData(t.buildupData,e);return new Promise(((i,r)=>{v({path:t.pathIds,clear:!1},n,!0).then((function(){f.publish(f.events.updateToolbar,{settings:e}),i()})).fail((function(e){r(e),s.error("Applying buildup setting failed due to ",e)}))}))}},applyBuildUp:function(t){let n=async function(t){var n=[],i=o.getContext().getController(),r=function t(n,i){var r=n.getChildren();0===r.length&&e.is(n.getReferenceId)&&n.isRepRef()&&-1===i.indexOf(n.getReferenceId())&&i.push(n.getReferenceId()),r.forEach((function(e){var n=e.getReferenceIterator();t(n,i)}))};return l.getOption("forceLoad")?(C(),t&&e.is(t.mfgAndResourceBuildup,"array")&&t.mfgAndResourceBuildup.forEach((function(t){var o,u;t&&t[B.BUILDUPKEYS.CATEGORY]&&t[B.BUILDUPKEYS.CATEGORY].toLowerCase()===B.BUILDUPCATEGORY.Implement&&e.is(t.path,"array")&&t.path.length>0&&(o=t.path[t.path.length-1],i.isRegistered(o)&&!i.getNode({id:o})&&(u=i.createReferenceIterator(o),r(u,n)))})),s.debug("3DShape reference ids to force load : ",n),n.length>0&&(U=n,i.lockNodes({ids:U}),await new Promise((e=>{i.setForceReferencesLoad({data:n.map((function(e){return{id:e,state:!0}})),callback:e})})),s.debug("Forcely loaded 3DShape successfully for ids : ",n)),t):t},i=function(e){var t=[];g.isObjectAvailable(B.BUILDUPKEYS.BUILDUPDEFKEYS.PLANNINGOBJECTS)&&(e.forEach((function(e){e.type!==B.BUILDUPKEYS.BUILDUPDEFKEYS.PLANNINGOBJECTS||o.isRegistered(e[B.BUILDUPKEYS.PATH])||t.push({path:e[B.BUILDUPKEYS.PATH]})})),t.length>0&&o.addRoots({objects:t},!0,!1))},u=async function(t){let n=r.getInstance("FTABehavior");if(n){let i=[];t&&e.is(t.ftaBuildup,"array")&&t.ftaBuildup.length>0&&(t.ftaBuildup.forEach((e=>{let t=B.BUILDUPKEYS.FTAGEOMID;e[B.BUILDUPKEYS.CATEGORY]&&e[t]&&i.push({[t]:e[t],path:e.path.slice()})})),await n.loadFTAPaths(i))}return t};return new e.Promise((function(e,r){h(!1),P(t).then(n).then(u).then(v.bind(this,t)).then(i).then(e).fail((function(e){r(e)}))}))},applyCurrentBuildUp:function(){let t=g.getMfgAndResourceBuildup(),n=g.getFTABuildup();if(e.is(t,"array")){let i=e.is(n,"array")&&n.length>0?t.concat(n):t;i.length>0&&o.setGraphicProperties({graphicProperties:i},B.SCENEGRAPHKEYS.BUILDUP).then(o.render).fail((function(e){s.error(e)}))}},getCurrentBuildUpContent:function(){return g.getCurrentBuildUpContent()},getMfgAndResourceBuildup:function(){return g.getMfgAndResourceBuildup()},isBuildUpApplied:function(){return g.isBuildUpApplied()},removeBuildUp:function(e=!0){if(a.isBuildUpApplied()){let t=r.getInstance("FTABehavior");if(t){let e=u.getInstance("BuildUpBehaviorModelService").getFTAReqsPaths();e.length>0&&t.removeFTAPaths(e)}g.removeCurrentBuildUpContent(),o.removeSceneGraphOverrideSet(B.SCENEGRAPHKEYS.BUILDUP),I(),e&&o.render(),h(!1),f.publish(f.events.onGlobalBuildUpRemoved,{}),C(),o.setPickability(B.PICKABILITY.DEFAULT)}else s.warn("BuildUp is not applied")},initializeBuildup:function(t={}){let n=u.getInstance("BuildUpBehaviorModelService"),r=l.getOption("dynamicBuildUp"),a=function(e,n){let i={info:"Info",warning:"Warn"};if(!0===t.displayNotif){let t=i[e],r={eventID:e,msg:l.getNLSValue(`${t}.${n}.Message`),message:l.getNLSValue(`${t}.${n}.Message`),title:l.getNLSValue(`${t}.${n}.Title`),level:e};o.getContext().displayNotification(r)}};return new e.Promise((function(o,u){t&&t.id&&e.is(t.scopedMfg,"array")?n.initialize(t).then((function(){if(!0!==r){a("info",t.publishedRep&&t.publishedRep.id?"FilteredPublishedContentFound":"FullPublishedContentFound");let i=e.is(t.scopedMfg,"array")&&t.scopedMfg.length>0?t.scopedMfg:[],r=n.getScopedMfgsIds();if(e.is(r,"array")&&r.length>0){let t=i.every((e=>-1!==r.indexOf(e.id))),o=!0;if(1===i.length){let t=i[0],r=t?e.is(t.occurrence,"array")&&t.occurrence.length>0?t.occurrence[0]:t.id:null;o=n.isBuildupAvailableForContext(r)}!1!==t&&!1!==o||a("warning","ScopedItemNotAvailableInPublication")}}})).then(o).catch((function(e){if(!0===t.displayNotif){let t={...e};t.level="warning",i.displayNotificationWithCustomCode(t)}u(e)})):u(l.getNLSValue("Error.InvalidInput.Message"))}))},reset:function(){a.removeBuildUp(),g.reset()},destroy:function(){[g].forEach((e=>{e&&e.destroy()})),B&&o.removeSceneGraphOverrideSet(B.SCENEGRAPHKEYS.BUILDUP),C(),S&&S.forEach((function(e){e.handler.unSubscribe(e.token)})),S=[],s=g=f=B=U=null},getPartPosition:function(t){var n=function(e){return g.getBuildUpData({path:e})},i=function(n){return new e.Promise((function(i,r){let o;n&&e.is(n.mfgAndResourceBuildup,"array")&&(o=n.mfgAndResourceBuildup.filter((function(e){var n=e[B.BUILDUPKEYS.PATH];return!!(n&&n.length>1)&&(t.part.path?n.toString().replace(/\s/g,"")===t.part.path.toString().replace(/\s/g,""):!!t.part.id&&(n[n.length-1]===t.part.id||n[n.length-2]===t.part.id))}))),o&&o.length>0?i(o):r(l.getNLSValue("Error.PartNotFound.Message"))}))},r=function(e){return e.map((function(e){return{path:e.path,position:e.position}}))};return s.debug("BuildUpController::getPartPosition event received with parameters :",t),new e.Promise((function(o,a){new e.Promise((function(e,n){t&&t.operation?t.operation.path?e(t.operation.path):u.getOperationPath(t.operation.id).then(e).fail(n):n(l.getNLSValue("Error.InvalidInput.Message"))})).then(n).then(i).then(r).then(o).fail((function(e){s.error("BuildUpController::getPartPosition failed due to ",e),a(e)}))}))},getBuildUpGlobalContent:async function(e){let t=await P(e);return E(t)}},a}}));