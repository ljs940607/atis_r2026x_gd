define("DS/MPFModel/ModelValidator",["UWA/Core","UWA/Class","UWA/Class/Model","DS/MPFServices/ObjectService","DS/MPFError/BadArgumentError","DS/MPFConstraintModel/ConstraintModel","DS/MPFDataProxy/NoDataProxy"],(function(t,e,r,i,s,n,o){"use strict";const a=Object.freeze({REQUIRED:"required",INVALID:"invalid"}),c=e.extend({init:function(t){i.requiredOfPrototype(t.model,r,"options.model must be a UWA/Model"),this.model=t.model,this.keyAttribute=t.keyAttribute;t.model.constraints&&t.model.constraints.size&&t.model.constraints.size()>0&&(this.keyAttribute||this.model.constraints.first().idAttribute?this.constraints=this.model.constraints:console.warn("No idAttribute for model found and no keyAttribute defined - constraints cannot be used!")),this.validations={},t.validations&&this._registerValidations(t.validations)},validate:function(e){this.constraints&&this._updateConstraints(e);const r=[];if(t.is(e,"string"))this._validateAttribute(e,this.model.get(e),r);else if(Array.isArray(e))for(let i=0;i<e.length;i++)t.is(e[i],"string")&&this._validateAttribute(e[i],this.model.get(e[i]),r);else if(t.is(e,"object")){const t=Object.keys(e);for(let i=0;i<t.length;i++)this._validateAttribute(t[i],e[t[i]],r)}else{const t=Object.keys(this.validations);for(let e=0;e<t.length;++e)this._validateAttribute(t[e],this.model.get(t[e]),r)}if(r.length>0)return r},_validateAttribute:function(e,r,i){const s=this.validations[e];if(Array.isArray(s))for(let e=0;e<s.length;e++){const n=s[e];if(this._checkConditions(n.getConditions())){const e=t.is(r,"string")&&""===r.trim();n.isRequired()&&(!t.is(r)||n.isString()&&e)?i.push(this._getValidationError(a.REQUIRED,n)):!t.is(r)||e||n.isCorrectType(r)&&n.patternIsFoundIn(r)||i.push(this._getValidationError(a.INVALID,n))}}},_checkConditions:function(t){for(let e=0;e<t.length;e++){const r=t[e];if(Array.isArray(r)&&r.length>=2)if(r.length>2&&!0===r[2]){if(this.model.get(r[0])===r[1])return!1}else if(this.model.get(r[0])!==r[1])return!1}return!0},_getValidationError:function(e,r){const i={field:r.getAttribute(),errorType:e};if(e===a.REQUIRED){const e=r.getRequiredError();t.is(e)?i.message=e:(console.warn('No "required" error message defined for attribute "'+i.field+'"!'),i.message=i.field+" is required")}else if(e===a.INVALID){const e=r.getInvalidError();t.is(e)?i.message=e:(console.warn('No "invalid" error message defined for attribute "'+i.field+'"!'),i.message=i.field+" is invalid")}return i},_updateConstraints:function(e){let r;const i=this.keyAttribute||this.constraints.first().idAttribute;if(t.is(e,"object")&&e[i]?r=this.constraints.get(e[i])?this.constraints.get(e[i]):this.constraints.get("DEFAULT"):this.model.has(i)?r=this.constraints.get(this.model.get(i))?this.constraints.get(this.model.get(i)):this.constraints.get("DEFAULT"):(r=this.constraints.get("DEFAULT"),console.warn("Model does not have the key attribute corresponding to the idAttribute defined in the constraints -> default used for validation")),this._deleteReplaceableConstraints(),t.is(r,"object")){const t=r.keys(),e=!0;for(let i=0;i<t.length;i++){const s=t[i],n=r.get(s);if(Array.isArray(n))for(let t=0;t<n.length;t++)this._addConstraintModel(n[t],e);else this._addConstraintModel(n,e)}}},_deleteReplaceableConstraints:function(){const t=Object.keys(this.validations);for(let e=0;e<t.length;e++){const r=t[e],i=this.validations[r];if(Array.isArray(i)&&i.length>0)for(let t=i.length-1;t>=0;t--)i[t].isReplaceable&&i.splice(t,1)}},_addConstraintModel:function(t,e){if(n.prototype.isPrototypeOf(t)){t.isReplaceable=!0===e;const r=t.getAttribute();Array.isArray(this.validations[r])?this.validations[r].push(t):this.validations[r]=[t]}},_registerValidations:function(e){for(let r=0;r<e.length;r++){const i=e[r];if(t.is(i[n.Fields.ATTRIBUTE])){const t=new n(i,{dataProxy:o.getInstance()});this._addConstraintModel(t)}}}});return c.ErrorTypes=a,c})),define("DS/MPFModel/CollectionFetchOptions",[],(()=>{"use strict";return Object.freeze({START:"start",SIZE:"size",SEARCH:"search",COMPANY:"company",ONLINEINSTANCE:"online-instance"})})),define("DS/MPFModel/ModelChangeTracker",["UWA/Core","UWA/Class"],(function(t,e){"use strict";const r='"DS/MPFModel/ModelChangeTracker" is deprecated. Please use the new tracker via the MPFModel functions "hasPendingChanges" and "getPendingChanges" and "clearPendingChanges".';return e.extend({init:function(){this.changes={}},track:function(e,{ignoreDeprecation:i}={}){if(i||console.warn(r),!t.is(e,"object"))throw new Error("change must be an object");t.extend(this.changes,e)},getChanges:function(){return console.warn(r),this._deepCloneData(this.changes)},_deepCloneData(t){if(t instanceof e)return this._deepCloneData(t.omit());if(Array.isArray(t)){const e=[];for(let r=0;r<t.length;r++){const i=t[r];e.push(this._deepCloneData(i))}return e}if(t&&"object"==typeof t){const e={},r=Object.keys(t);for(let i=0;i<r.length;i++){const s=r[i],n=t[r[i]];e[s]=this._deepCloneData(n)}return e}return t},isEmpty:function(){let t;for(t in console.warn(r),this.changes)if(Object.prototype.hasOwnProperty.call(this.changes,t))return!1;return!0},reset:function(){this.changes={}}})})),define("DS/MPFModel/ModelCache",["UWA/Class"],(function(t){"use strict";return t.singleton({init:function(){this._cache={}},has:function(t){var e,r;return!1,"string"===(e=typeof t)||"number"===e?r=t:"object"===e&&(r=t.id),this._cache.hasOwnProperty(r)},add:function(t){var e,r,i,s;return e=!1,i=t._type||"global",this._cache.hasOwnProperty(i)||(this._cache[i]={}),r=this._cache[i],(s=t.id)&&(r.hasOwnProperty(s)?r[s].lastAccess=(new Date).toISOString():(r[s]=this._createCacheEntry(t),e=!0)),e},get:function(t,e){var r,i;return t||(t="global"),this._cache.hasOwnProperty(t)&&(i=this._cache[t]).hasOwnProperty(e)&&(r=i[e].model),r},remove:function(t,e){var r,i;return t||(t="global"),this._cache.hasOwnProperty(t)&&(i=this._cache[t],r=this.get(t,e),delete i[e]),r},clear:function(){this._cache={}},_createCacheEntry:function(t){var e;return{created:e=(new Date).toISOString(),lastAccess:e,model:t}}})}));var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};define("DS/MPFModel/ModelChangeTrackerV2",["require","exports","UWA/Class/Model","UWA/Class/Collection"],(function(t,e,r,i){"use strict";r=__importDefault(r),i=__importDefault(i);return class{constructor(t={},{trackNestedAttibutes:e=!1,ignoredAttributes:r=[]}={}){this.trackNestedAttibutes=e,this.ignoredAttributes=r,this.trackNestedAttibutes?this._originalAttributes=this._deepCloneData(t):this._originalAttributes={...t}}getChanges(t){if("object"!=typeof t)throw new Error("attributes must be an object");const e={};return Object.keys(t).forEach((r=>{this.ignoredAttributes.includes(r)||t[r]===this._originalAttributes[r]||(e[r]=t[r])})),this._deepCloneData(e)}getNestedChanges(t,e=this._originalAttributes){if("object"!=typeof t)throw new Error("attributes must be an object");const r={};return Object.keys(t).forEach((i=>{const s=t[i];if(Array.isArray(s)){const t=this._getArrayChanges(s,e[i]);t&&(r[i]=t)}else if("object"==typeof s){const t=this.getNestedChanges(s,e[i]);Object.keys(t).length>0&&(r[i]=t)}else this.ignoredAttributes.includes(i)||s===e[i]||(r[i]=s)})),r}getOriginalAttributes(){return this._originalAttributes}ignoreAttribute(t){this.ignoredAttributes.includes(t)||this.ignoredAttributes.push(t)}unignoreAttribute(t){if(this.ignoredAttributes.includes(t)){const e=this.ignoredAttributes.indexOf(t);this.ignoredAttributes.splice(e,1)}}_getArrayChanges(t,e){if(!Array.isArray(t))throw new Error("First argument must be an array");const r=[];if(t.forEach(((t,i)=>{Array.isArray(t)?r.push(this._getArrayChanges(t,e[i])):"object"==typeof t?r.push(this.getNestedChanges(t,e[i])):r.push(t!==e[i]?t:void 0)})),r.filter((t=>!!t)).length>0)return t}hasChanges(t){if("object"!=typeof t)throw new Error("attributes must be an object");const e=this.getChanges(t);return Object.keys(e).length>0}reset(t){if("object"!=typeof t)throw new Error("attributes must be an object");Object.keys(t).forEach((e=>{this.trackNestedAttibutes?this._originalAttributes[e]=this._deepCloneData(t[e]):this._originalAttributes[e]=t[e]}))}_deepCloneData(t){if(t instanceof r.default)return this._deepCloneData(t.omit(""));if(t instanceof i.default)return this._deepCloneData(t.toArray());if(Array.isArray(t)){const e=[];for(let r=0;r<t.length;r++){const i=t[r];e.push(this._deepCloneData(i))}return e}if(t&&"object"==typeof t){const e={},r=Object.keys(t);for(let i=0;i<r.length;i++){const s=r[i],n=t[r[i]];e[s]=this._deepCloneData(n)}return e}return t}}})),define("DS/MPFModel/MPFCollection",["UWA/Core","UWA/Promise","UWA/Class/Collection","DS/MPFError/BadArgumentError","DS/MPFUtils/MPFUtils"],((t,e,r,i,s)=>{"use strict";return r.extend({setup(e,r){if(!t.is(r))throw new Error("options object param is required");if(!t.is(r.dataProxy))throw new Error("options.dataProxy param is required");this._parent(e,r),this.dataProxy=r.dataProxy,this.modelDataProxy=r.modelDataProxy||r.dataProxy,this.parentResourceId=r.parentResourceId||null,this.cache=r.cache,this.isFetching=!1,this.lastOptionsHash=0},sync(t,e,r){return(r=r||{}).url=this.dataProxy.url(e,t,r),r.ajax=this.dataProxy.request.bind(this.dataProxy),r.isCollectionSyncOperation=!0,this._parent(t,e,r)},fetch(t={}){t.dataProxy=this.dataProxy;const e=t.onComplete;return t.onComplete=function(t,r,i){const s=i&&i.responseHeaders&&i.responseHeaders["MP-Total-Model-Count"];s&&(this.totalModelCount=s),t.forEach((function(t){t.clearPendingChanges()})),e(t,r,i)},this._parent(t)},fetchPromise(t={}){const r=this,i=s.objectHashCode(t);return this.isFetching&&i===this.lastOptionsHash||(this.isFetching=!0,this.lastOptionsHash=i,this.deferredFetch=e.deferred(),t.onComplete=function(){r.isFetching=!1,r.deferredFetch.resolve(r)},t.onFailure=function(t,e,i){r.isFetching=!1,r.deferredFetch.reject({collection:t,response:e,options:i})},this.fetch(t)),this.deferredFetch.promise},getTotalModelCount(){return this.totalModelCount},create(t,e){return(e=e||{}).dataProxy=this.dataProxy,e.cache=this.cache,this._parent(t,e)},setParentResourceId(t){if(!t)throw new i("resourceId must be defined");this.parentResourceId=t},clone(){return new this.constructor(this._models,{dataProxy:this.dataProxy,modelDataProxy:this.modelDataProxy,parentResourceId:this.parentResourceId,cache:this.cache})},_prepareModel(t,e){let r=!1;return this.cache&&(r=this.cache.get(this.model._type,t.id)),r||(r=this._parent(t,e),this.cache&&this.cache.add(r)),r}})})),define("DS/MPFModel/MPFModel",["UWA/Core","UWA/Promise","UWA/Class/Model","DS/MPFModel/ModelChangeTracker","DS/MPFModel/ModelChangeTrackerV2","DS/MPFUtils/MPFUtils","DS/MPFError/BadArgumentError","DS/MPFError/ValidationError","DS/MPFError/SyncError"],(function(t,e,r,i,s,n,o,a,c){"use strict";function h(t,e,r){r=!0===r;const i={};for(const s in t)if(Object.prototype.hasOwnProperty.call(t,s)){const n=e.get(s);n?i[n]=t[s]:r&&(i[s]=t[s])}return i}function l(t){const e={};for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&null!==t[r]&&(e[r]=t[r]);return e}const d=r.extend({init:function(e,r){if(!t.is(r))throw new Error("options object param is required");if(!t.is(r.dataProxy))throw new Error("options.dataProxy param is required");return this.cache=r.cache,this.dataProxy=r.dataProxy,this.changeTracker=new i,this._parent(e,r)},setup:function(t,e){this._parent(t,e),this.mapper=e.mapper,this.parentResourceId=e.parentResourceId||null,this.changeTrackerV2=new s(this.omit(),{trackNestedAttibutes:e.trackNestedAttibutes,ignoredAttributes:e.ignoredAttributes}),this.listenTo(this,"onSync",(()=>{this.changeTracker.reset({ignoreDeprecation:!0}),this.changeTrackerV2.reset(this.omit())}))},sync:function(t,e,r={}){const i=r.dataProxy||this.dataProxy;return r.url=i.url(e,t,r),r.ajax=i.request.bind(i),this._parent(t,e,r)},fetch:function(t={}){const e=this;let r,i;if(this.cache&&!1!==t.cache)if(i=this.cache.get(this.id),i)t&&"function"==typeof t.onComplete&&t.onComplete(i,null,t),r={cancel(){}};else{const i=t.onComplete;t.onComplete=function(t,r,s){"function"==typeof i&&(e.cache.add(t,r,s),i(t))},r=this._parent(t)}else r=this._parent(t);return r},fetchPromise:function(t={}){return new Promise(((e,r)=>{this.fetch({...t,onComplete:()=>{e(this)},onFailure:(t,e,i)=>{r(new c({model:t,response:e,options:i}))}})}))},save:function(e,r,i){t.is(e)&&"object"!==t.typeOf(e)||(i=r);const s=(i=i||{}).onComplete;i.onComplete=(t,e,r)=>(this.cache&&!1!==r.cache&&(this.cache.has(t)||this.cache.add(t)),s&&s(t,e,r),this.dispatchEvent("onSave",{ok:!0,model:t,message:"model succesfully saved"}));const n=i.onFailure;return i.onFailure=(t,e,r)=>(n&&n(t,e,r),this.dispatchEvent("onSave",{ok:!1,model:t,message:"unable to save model"})),t.is(r)||(r=i),this._parent(e,r,i)},savePromise:function(e,r,i){return t.is(e)&&"object"!==t.typeOf(e)||(i=r),i=i||{},new Promise(((s,n)=>{i.onComplete=()=>{s(this)},i.onFailure=(t,e,r)=>{n(new c({model:t,response:e,options:r}))},t.is(r)||(r=i);!1!==this.save(e,r,i)||n(new c({model:this,response:new a("Validation before save failed"),options:i}))}))},set:function(e,r,i){let s;return t.is(e,"object")?(s=e,i=r||{}):(s={},s[e]=r,i||(i={})),!0!==i.isCollectionSyncOperation&&!1!==i.track?this.changeTracker.track(s,{ignoreDeprecation:!0}):this.changeTrackerV2&&this.changeTrackerV2.reset(s),this._parent(s,i)},getPendingChanges:function(t){return this.changeTrackerV2.getChanges(t||this.omit())},getNestedChanges(t){return this.changeTrackerV2.getNestedChanges(t||this.omit())},hasPendingChanges:function(t){return this.changeTrackerV2.hasChanges(t||this.omit())},clearPendingChanges:function(t){return this.changeTracker.reset({ignoreDeprecation:!0}),this.changeTrackerV2.reset(t||this.omit())},resetPendingChanges(){this.set(this.changeTrackerV2.getOriginalAttributes())},ignoreAttribute(t){this.changeTrackerV2.ignoreAttribute(t)},unignoreAttribute(t){this.changeTrackerV2.unignoreAttribute(t)},toJSON:function(t){let e;const r=this._parent(t);return e=this.mapper?h(r,this.mapper,!1):this._parent(r),e=l(e),e},parse:function(t){let e;return e=this.mapper?h(t,this.mapper.inverse(),!0):t,e||{}},clone:function(){return new this.constructor(this._attributes,{dataProxy:this.dataProxy,cache:this.cache,mapper:this.mapper})},setParentResourceId:function(t){if(!t)throw new o("resourceId must be defined");this.parentResourceId=t},destroyPromise:function(t={}){return new Promise(((e,r)=>{t.onComplete=()=>{e(this)},t.onFailure=r,this.destroy(t)}))},validate:n.doNothing});return d.mapObjectKey=h,d.removeNullAttributes=l,d}));