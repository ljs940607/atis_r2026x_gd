define("DS/DELWeb3DViewerComp/DELWeb3DViewer",["DS/DELWebViewerComponent/Component","UWA/Class/Promise","DS/Logger/Logger","DS/PlatformAPI/PlatformAPI","DS/DELWebWidgetLinkInfra/WidgetLinkInfraController","DS/DELWebComponentManager/DELWebComponentManager","DS/DELWebLandingPage/DELWebDragAndDropPage","DS/PADUtils/PADContext","DS/DELWebComponentManager/DELWebTypesUtil","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/UIKIT/Mask","i18n!DS/DELWeb3DViewerComp/assets/nls/messages","css!DS/DELWeb3DViewerComp/assets/css/DELWeb3DViewer.css"],(function(e,t,o,n,i,r,a,d,l,s,g,c,u){"use strict";return function(c,p){const h="scopedMfg",f="resource",v="mode",m="Graphics",b="onRootsRemoved",w="onApplyNGFilter";var V,E,P,y,S,B=[],D=[],C=[],R=[],I=o.getLogger("DELWeb3DViewer"),U=function(e){return e&&e.origin!==c&&e.data},A=function(e={}){let t=e[h]||{},o=e[f]||{};return{mfgId:t.id,installPath:t.occurrence,resourceId:o.id,processId:e.occurrence&&e.occurrence.length>0?e.occurrence[0]:e.id,publishedRepId:e.publishedRep?e.publishedRep.id:null,defaultShow:!0,displayNotif:!0,filter:e.filter?e.filter:null,reframe:!UWA.is(e.reframe,"boolean")||e.reframe}},M=function(t){let o=r.getComponent("ModelEvents");U(t)&&(r.getComponent("SessionModel").set(v,e.getViewerBehavior().getMode()),e.getViewerBehavior().setOperation({...t.data,clear:!0}).then((()=>{o.publish({event:"onBuildUpActivated",data:{data:t.data,origin:c}})})).fail((e=>{o.publish({event:"onBuildUpActivateFailed",data:{data:e.input,error:e.error,origin:c}}),e&&e.error&&"DELVIEWER_E003"===e.error.code&&o.publish({event:"onBuildupConnectionFailed",data:{data:t.data,error:e.error,origin:c}})})))},F=function(t){t&&(y=t,function(){let t,o=A(y);t=e.getViewerBehavior().setProcess(o).then((function(){y.operation&&UWA.is(y.operation.occurrence,"array")&&y.operation.occurrence.length>0&&M({data:{path:y.operation.occurrence}}),r.getComponent("ModelEvents").publish({event:"onProcessLoadCompleted",data:{data:y,origin:c}})})).fail((function(e){r.getComponent("ModelEvents").publish({event:"onProcessLoadFailed",data:{data:y,origin:c}})}))}())},L=function(t){var o=function(o){if(o===l.PPRTYPES.PROCESS)F(t.data);else!function(t){let o=!UWA.is(t.reframe,"boolean")||t.reframe;!0!==t.withFilter&&e.getViewerBehavior().addRoots({objects:[{path:[t.id]}],reframe:o})}(t.data)};U(t)&&(t.data.id?t.data.pprType?o(t.data.pprType):l.getTaxonomies([t.data.id]).then((function(e){e&&o(l.getPPRType(e[t.data.id]))})).fail((function(e){I.debug(e.toString()),I.error("Error occurred while checking type for id ",t.data.id)})):(I.log("Invalid Input Provided, object id is missing"),I.error(u.get("Error.InvalidInput.Message"))))},N=function(e,t){var o=r.getComponent("ModelEvents");e&&UWA.is(t,"array")&&t.forEach((t=>{var n={};Object.assign(n,t,{path:t.paths}),delete n.paths,o.publish({event:e,data:{data:n,origin:c}})}))},W=function(e,t){r.getComponent("ModelEvents").publish({event:e,data:{data:t,origin:c}})},O=function(t){U(t)&&e.getViewerBehavior().hideNode({path:t.data.path})},H=function(t){U(t)&&e.getViewerBehavior().showNode({path:t.data.path})},G=function(t){U(t)&&e.getViewerBehavior().reframeOn(t.data)},T=function(){return y={},S&&S.removeAll({dispatchEvent:!1}),e.getViewer()?e.getViewerBehavior().empty():t.reject(u.get("Error.Viewer.NotInitialized"))},x=function(t){let o=e.getViewerBehavior();o&&U(t)&&o.updateOptions(t.data)},z=function(e,t){r.getComponent("ModelEvents").publish({event:e,data:{data:t,origin:c}})},k=function(e,t){let o=r.getComponent("ModelEvents"),n={data:t,origin:c};o.publish({event:e,data:n})},j=async function(t,o,n){I.debug(`viewer proxy invoked with the params api - ${t} with params ${JSON.stringify(n)}`);try{if(t&&U(n)){let i,r,a=e.getViewerBehavior();a&&(i=a[t],i?(r=await i(n.data),o&&k(o,r)):I.error("Invalid api name, please check viewer behavior api name"))}}catch(e){I.error(e)}},_={Model:{setGraphicProperties:function(t){U(t)&&e.getViewerBehavior().setGraphicProperties(t.data)},removeGraphicProperties:function(t){U(t)&&e.getViewerBehavior().removeGraphicProperties(t.data)},setMode:function(t){U(t)&&(r.getComponent("SessionModel").set(v,t.data.mode),e.getViewerBehavior().setMode(t.data))},loadData:L,onHide:O,onShow:H,notifyRootVisibilityChange:function(t){e.getViewerBehavior().notifyRootVisibilityChange(t.data.id,t.data.visibility)},onSelect:function(t){U(t)&&e.getViewerBehavior().selectNode(t.data)},onUnSelect:function(t){U(t)&&e.getViewerBehavior().unSelectNode(t.data)},onReframe:G,onSearch:function(t){U(t)&&e.getViewer()&&e.getViewerBehavior().search({searchQuery:t.data})},onRefresh:async function(){let t=e.getViewerBehavior();t&&t.refresh().then((function(){r.getComponent("ModelEvents").publish({event:"onViewerRefreshed",data:{data:{isRefreshed:!0},origin:c}})})).fail((function(e){r.getComponent("ModelEvents").publish({event:"onViewerRefreshFailed",data:{data:{isRefreshed:!1},origin:c}})}))},onHighlight:function(t){U(t)&&e.getViewerBehavior().highlightNode(t.data)},onUnHighlight:function(t){U(t)&&e.getViewerBehavior().unHighlightNode(t.data)},onPreHighlight:function(t){U(t)&&e.getViewerBehavior().preHighlightNode(t.data)},onUnPreHighlight:function(t){U(t)&&e.getViewerBehavior().unPreHighlightNode(t.data)},onEmpty:T,onRemoveRoots:async function(t){let o=r.getComponent("ModelEvents");if(U(t)&&t.data.items&&t.data.items.length>0){let n,i,r=t.data.items;y&&y.pprType===l.PPRTYPES.PROCESS?(i=r.find((e=>e.id===y.id)),i&&(await T(),o.publish({event:b,data:{data:{items:[i]},origin:c}}))):(n=r.map((e=>e.id)),e.getViewerBehavior().removeRoots({pids:n}))}},activateBuildup:M,deactivateBuildup:function(t){U(t)&&(r.getComponent("SessionModel").set(v,m),e.getViewerBehavior().removeOperation().then((()=>{r.getComponent("ModelEvents").publish({event:"onBuildUpDeactivated",data:{data:t.data,origin:c}})})))},initializeBuildup:function(t){let o=r.getComponent("ModelEvents");if(U(t)){let n=t.data;e.getViewerBehavior().initializeBuildup(A(n)).then((function(){o.publish({event:"onBuildupInitialized",data:{data:n,origin:c}})})).fail((function(e){o.publish({event:"onBuildupInitializationFailed",data:{data:n,error:e.error,origin:c}})}))}},onPreAddSelect:function(){var e=s.get();UWA.is(e,"array")&&e.length>0&&(g.remove(e),s.empty())},onUpdatePreferences:x,updateOptions:x,highlightLinkedViews:function(t){U(t)&&e.getViewerBehavior().highlightLinkedViews(t.data)},onLoadFTA:j.bind(j,"loadFTA",null),onRemoveFTA:j.bind(j,"removeFTA",null),setBuildUpGlobalSettings:j.bind(j,"setBuildUpGlobalSettings","onSetBuildUpGlobalSettings"),getBuildUpGlobalSettings:j.bind(j,"getBuildUpGlobalSettings","onGetBuildUpGlobalSettings"),getBuildUpGlobalContent:j.bind(j,"getBuildUpGlobalContent","onGetBuildUpGlobalContent")},Viewer:{onHideNode:N.bind(N,"onHide"),onShowNode:N.bind(N,"onShow"),onSelectNode:N.bind(N,"onSelect"),onUnSelectNode:N.bind(N,"onUnSelect"),onHighlightNode:N.bind(N,"onHighlight"),onUnHighlightNode:N.bind(N,"onUnHighlight"),onPreHighlightNode:N.bind(N,"onPreHighlight"),onUnPreHighlightNode:N.bind(N,"onUnPreHighlight"),onWKIFailed:function(e){e=e||{},I.error(JSON.stringify(e)),r.getComponent("Utils").displayNotification({level:"warning",message:u.get("Warn.WKIFailed.Message")})},onSelectView:W.bind(W,"onSelectView"),onStartupViewSet:W.bind(W,"onStartupViewSet"),onStartupViewRemoved:W.bind(W,"onStartupViewRemoved")},Platform:{"DS/PADUtils/PADCommandProxy/focus":function(e){e&&e.data&&UWA.is(e.data.paths,"array")&&e.data.paths.forEach((e=>{r.getComponent("ModelEvents").publish({event:"onFocus",data:{data:{path:e},origin:c}})}))}},FilterBIProxy:{FilterBIColorize:z.bind(z,"onBIColorize"),FilterBIUnColorize:z.bind(z,"onBIUnColorize"),ApplyNGFilter:function(e){let t,o=V.getFilterProxy();e&&e.filterRootIds&&(t=e.filterRootIds[0],e.CVQueryV2||(e.CVQueryV2=o.getFilterSpec(t,{V2:{}})),k(w,e))}},PAD3DViewer:{onEndProgressiveLoad:function(e){r.getComponent("ModelEvents").publish({event:"onLoadGraphicsComplete",data:{data:e,origin:c}})},onEndRootRemoved:function(e){var t,o,n=r.getComponent("ModelEvents");e.ids&&(o={data:{items:t=e.ids.map((e=>({id:e})))},origin:c},S&&S.removeRoots({items:t,dispatchEvent:!1}),n.publish({event:b,data:o}))},onRootAdded:function(e){k("onRootAdded",e)},onRootRemoved:function(e){k("onRootRemoved",e)},onLoadingFailure:function(e){k("onLoadingFailure",e)}}};return V={initialize:function(o={}){return new t((function(t){var l;!function(){let e=p.viewerOptions.delviewer.run_options.propertiesFacet;e&&UWA.is(e.value,"array")&&e.value.forEach((e=>{e&&e.facet&&e.facet.name&&(e.facet.text=u.get("Facet."+e.facet.name+".Text"))})),p=UWA.extend(p,o,!0)}(),e.init(p),function(){var e=r.getComponent("ModelEvents");for(let t in _.Model)Object.prototype.hasOwnProperty.call(_.Model,t)&&B.push(e.subscribe({event:t},_.Model[t]))}(),function(){var t=e.getEventHnd();for(let e in _.Viewer)Object.prototype.hasOwnProperty.call(_.Viewer,e)&&D.push(t.subscribe(t.events[e],_.Viewer[e]))}(),Object.keys(_.Platform).forEach((e=>{C.push(n.subscribe(e,_.Platform[e]))})),l=e.getEventHnd().subscribe(e.getEventHnd().events.onReady,(function(n){e.getEventHnd().unSubscribe(l),e.getViewer().addClassName("del-viewer-component-container"),function(e){let t=V.getFilterProxy(),o=[{eventToAdd:"onAddRoots",modelEventToPublish:"loadDataFromOtherWidget"},{eventToAdd:"onRemoveRoots",modelEventToPublish:"removeRoots"},{eventToAdd:"onRemoveAll",modelEventToPublish:"removeAll"}];e&&(e.proxy=t,e.NGFUXId=d.get().getNGFUXID(),S=new i(e),o.forEach((e=>{S.addEvent(e.eventToAdd,(function(t){k(e.modelEventToPublish,t)}))})))}(p.widget_link_controller_config),p&&p.dragAndDrop&&o.dndOptions&&o.dndOptions.onDrop&&(P=new a({onDrop:o.dndOptions.onDrop,body:e.getViewer(),nls:o.dndOptions.nls})).initialize(),function(){if(E=d&&d.get()&&d.get().getController()?d.get().getController().getBIProxy():null)for(let e in _.FilterBIProxy)Object.prototype.hasOwnProperty.call(_.FilterBIProxy,e)&&E.addEvent(e,_.FilterBIProxy[e])}(),Object.keys(_.PAD3DViewer).forEach((e=>{R.push(d.get().subscribe({event:e},_.PAD3DViewer[e]))})),r.getComponent("ModelEvents").publish({event:"onViewerReady",data:{data:n,origin:c}}),t()}))}))},destroy:function(){V.clean()},loadData:function(e){L(e)},hide:function(e){O(e)},show:function(e){H(e)},reframe:function(e){G(e)},empty:T,getViewer:e.getViewer,showViewer:function(){e.getViewer().removeClassName("del-viewer-component-container-hidden")},hideViewer:function(){e.getViewer().addClassName("del-viewer-component-container-hidden")},clean:async function(){if(B.forEach((e=>{r.getComponent("ModelEvents").unsubscribe(e)})),B=[],D.forEach((t=>{e.getEventHnd().unSubscribe(t)})),D=[],E)for(let e in _.FilterBIProxy)Object.prototype.hasOwnProperty.call(_.FilterBIProxy,e)&&E.removeEvent(e,_.FilterBIProxy[e]);C.forEach((e=>{n.unsubscribe(e)})),C=[],P&&P.destroy(),e.dispose()},getVisualizedRoots:function(){let e=d.get(),t=[];return e&&(t=e.getRoots().map((e=>({id:e.getModelIdentification()})))),t},getFilterProxy:function(){let e,t=d.get();return t&&(e=t.getBIController().getBIProxy()),e},getNGFUXID:function(){let e,t=d.get();return t&&(e=t.getNGFUXID()),e}}}}));