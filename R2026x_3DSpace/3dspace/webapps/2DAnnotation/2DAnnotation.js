define("DS/2DAnnotation/interface/Command",["UWA/Class","DS/Logger/Logger","i18n!DS/2DAnnotation/assets/nls/2DAnnotation","css!DS/2DAnnotation/2DAnnotation.css"],(function(e,o){"use strict";return e.extend({name:"DS/2DAnnotation/interface/Command",_logger:null,init:function(e){var t=this;t._parent(e),t._logger=o.getLogger(t.name),t.imageEditor=e.imageEditor},start:function(e){throw new Error("should be implemented")},end:function(){throw new Error("should be implemented")}})})),define("DS/2DAnnotation/views/Workspace",["UWA/Class/View","UWA/Core","DS/Logger/Logger","DS/IssueServices/utils/Performance","i18n!DS/2DAnnotation/assets/nls/2DAnnotation","css!DS/2DAnnotation/2DAnnotation.css"],(function(e,o,t,a){"use strict";return e.extend({name:"DS/2DAnnotation/Workspace",tagName:"div",className:"annotation-workspace-container",_logger:null,setup:function(e){var o=this;a.start(o.name+" setup"),o._parent(e),o._logger=t.getLogger(o.name),a.end(o.name+" setup")},render:function(){var e=this;return a.start(e.name+" render"),a.end(e.name+" render"),e},destroy:function(){this.container.empty()}})})),define("DS/2DAnnotation/components/ColorPicker",["UWA/Core","DS/Controls/ColorPicker"],(function(e,o){"use strict";var t={COLORS:{PRESELECTION:["#000000","#FEE000","#FF8A2E","#CC092F","#009DDB","#8DDEE4","#6FBC48","#FFFFFF"]}};return o.extend({buildView:function(){this._parent();var o=this;this.popupBody=e.createElement("div",{class:"annotation-colorpicker"});var a=e.createElement("div",{class:"annotation-colorpicker-selection"}).inject(this.popupBody);t.COLORS.PRESELECTION.forEach((function(t){var n=e.createElement("div",{class:"annotation-colorpicker-selection-button wux-controls-colorpicker-button"});n.setStyle("background",t),n.addEventListener("click",(function(){o.value=t,o.currentValue=t})),n.inject(a)})),this.elements._colorChooser&&this.elements._colorChooser.inject(this.popupBody),this.currentValue=this.value,this.initialValue=void 0},handleEvents:function(){this._parent(),this.addEventListener("show",this._onShow.bind(this))},_onShow:function(e){this.getPopup()&&this.getPopup().setBody(this.popupBody)}})})),define("DS/2DAnnotation/commands/Highlight",["DS/Logger/Logger","DS/FabricJS/FabricJS","DS/2DAnnotation/interface/Command","i18n!DS/2DAnnotation/assets/nls/2DAnnotation","css!DS/2DAnnotation/2DAnnotation.css"],(function(e,o,t){"use strict";var a=window.fabric;return t.extend({name:"DS/2DAnnotation/commands/Highlight",init:function(e){var o=this;o._parent(e),o._handlers={mousedown:o._onMouseDown.bind(o),mouseup:o._onMouseUp.bind(o),mousemove:o._onMouseMove.bind(o)}},start:function(e){var o=this,t=o.imageEditor.canvas;t.defaultCursor="crosshair",o._color=new a.Color(e.color||"#000000").toRgba(),o._opacity=e.opacity||.5,t.on({"mouse:down":o._handlers.mousedown})},end:function(){var e=this.imageEditor.canvas;e.defaultCursor="default",e.off({"mouse:down":this._handlers.mousedown})},setColor:function(e){this._color=new a.Color(e).toRgba()},setOpacity:function(e){this._opacity=e},_onMouseDown:function(e){var o=this,t=o.imageEditor.canvas;t.getActiveObject()||t.getActiveGroup()||(o._startPoint=t.getPointer(e.e),o._shapeObj=null,t.selection=!1,t.uniScaleTransform=!0,t.on({"mouse:move":o._handlers.mousemove,"mouse:up":o._handlers.mouseup}))},_onMouseUp:function(){var e=this,o=e.imageEditor.canvas;o.selection=!0,o.uniScaleTransform=!1,o.off({"mouse:move":e._handlers.mousemove,"mouse:up":e._handlers.mouseup});var t=o.getActiveObject();null!=t&&(t.setCoords(),t.selectable=!0,o.calcOffset(),o.selection=!0,o.uniScaleTransform=!1,o.renderAll())},_onMouseMove:function(e){var o=this,t=o.imageEditor.canvas,n=t.getPointer(e.e),r=o._startPoint.x,i=o._startPoint.y,l=Math.min(r,n.x),c=Math.min(i,n.y),s=Math.abs(r-n.x),d=Math.abs(i-n.y),u=o._shapeObj;u?u.set("width",s).set("height",d).set("top",c).set("left",l):((u=new a.Rect({top:r,left:i,width:s,height:d,fill:o._color,color:o._color,cornerSize:20,transparentCorners:!0})).set({opacity:o._opacity}),u.annotationType="highlight",t.add(u),t.setActiveObject(u),o._shapeObj=u),t.renderAll()}})})),define("DS/2DAnnotation/commands/CreateText",["DS/Logger/Logger","DS/FabricJS/FabricJS","DS/2DAnnotation/interface/Command","i18n!DS/2DAnnotation/assets/nls/2DAnnotation","css!DS/2DAnnotation/2DAnnotation.css"],(function(e,o,t,a){"use strict";var n=window.fabric,r={WIDTH:200,HEIGHT:30};return t.extend({name:"DS/2DAnnotation/commands/CreateText",init:function(e){var o=this;o._parent(e),o._handlers={mousedown:o._onMouseDown.bind(o),mouseup:o._onMouseUp.bind(o),mousemove:o._onMouseMove.bind(o)}},start:function(e){var o=this,t=o.imageEditor.canvas;t.defaultCursor="crosshair",o._fontSize=e.fontSize||10,o._fillColor=new n.Color(e.fillColor||"#000000").toRgba(),o._strokeColor=new n.Color(e.strokeColor||"#000000").toRgba(),o._backgroundColor=new n.Color(e.backgroundColor||"#ffffff").toRgba(),o._text=e.text||null,o._centered=e.centered||!1,t.on({"mouse:down":o._handlers.mousedown})},end:function(){var e=this.imageEditor.canvas;e.defaultCursor="default",e.off({"mouse:down":this._handlers.mousedown})},setFontSize:function(e){this._fontSize=e},setFillColor:function(e){this._fillColor=new n.Color(e).toRgba()},setStrokeColor:function(e){this._strokeColor=new n.Color(e).toRgba()},setBackgroundColor:function(e){this._backgroundColor=new n.Color(e).toRgba()},_onMouseDown:function(e){var o=this,t=o.imageEditor.canvas;t.getActiveObject()||t.getActiveGroup()||(o._startPoint=t.getPointer(e.e),o._shapeObj=null,t.selection=!1,t.uniScaleTransform=!0,t.on({"mouse:move":o._handlers.mousemove,"mouse:up":o._handlers.mouseup}))},_onMouseUp:function(){var e=this,o=e.imageEditor.canvas;o.selection=!0,o.uniScaleTransform=!1,o.off({"mouse:move":e._handlers.mousemove,"mouse:up":e._handlers.mouseup}),null!==e._shapeObj&&void 0!==e._shapeObj||e._createTextShape(e._startPoint.x,e._startPoint.y,e._startPoint.x+r.WIDTH,e._startPoint.y+r.HEIGHT);var t=o.getActiveObject();t.setCoords(),t.selectable=!0,t.enterEditing(),t.selectAll(),o.calcOffset(),o.selection=!0,o.uniScaleTransform=!1,o.renderAll()},_onMouseMove:function(e){var o=this,t=o.imageEditor.canvas,a=t.getPointer(e.e),n=o._startPoint.x,r=o._startPoint.y;o._createTextShape(n,r,a.x,a.y),t.renderAll()},_createTextShape:function(e,o,t,r){var i=this,l=i.imageEditor.canvas,c=Math.min(e,t),s=Math.min(o,r),d=Math.abs(e-t),u=Math.abs(o-r),v=i._shapeObj,g=a.tools.createText.emptyText;null!==i._text&&(g=i._text),v?v.set("width",d).set("height",u).set("top",s).set("left",c):((v=new n.IText(g,{top:s,left:c,width:d,height:u,fill:i._fillColor,stroke:i._strokeColor,backgroundColor:i._backgroundColor,fontSize:i._fontSize,cornerSize:20,transparentCorners:!0})).set({opacity:i._opacity}),v.annotationType="createText",l.add(v),!1!==i._centered&&(v.top=(i.imageEditor.elements.container.height-v.height)/2,v.left=(i.imageEditor.elements.container.width-v.width)/2),l.setActiveObject(v),i._shapeObj=v)}})})),define("DS/2DAnnotation/commands/CreateLine",["DS/Logger/Logger","DS/FabricJS/FabricJS","DS/2DAnnotation/interface/Command","i18n!DS/2DAnnotation/assets/nls/2DAnnotation","css!DS/2DAnnotation/2DAnnotation.css"],(function(e,o,t){"use strict";var a=window.fabric;return t.extend({name:"DS/2DAnnotation/commands/CreateLine",init:function(e){var o=this;o._parent(e),o._handlers={mousedown:o._onMouseDown.bind(o),mouseup:o._onMouseUp.bind(o),mousemove:o._onMouseMove.bind(o)}},start:function(e){var o=this,t=o.imageEditor.canvas;t.defaultCursor="crosshair",o._dashLine=e.dashLine||!1,o._strokeWidth=e.strokeWidth||2,o._fillColor=new a.Color(e.fillColor||"#000000").toRgba(),o._strokeColor=new a.Color(e.strokeColor||"#000000").toRgba(),t.on({"mouse:down":o._handlers.mousedown})},end:function(){var e=this.imageEditor.canvas;e.defaultCursor="default",e.off({"mouse:down":this._handlers.mousedown})},setDashLine:function(e){this._dashLine=e},setStrokeWidth:function(e){this._strokeWidth=e},setStrokeColor:function(e){this._strokeColor=new a.Color(e).toRgba()},setOpacity:function(e){this._opacity=e},_onMouseDown:function(e){var o=this,t=o.imageEditor.canvas;t.getActiveObject()||t.getActiveGroup()||(o._startPoint=t.getPointer(e.e),o._shapeObj=null,t.selection=!1,t.uniScaleTransform=!0,t.on({"mouse:move":o._handlers.mousemove,"mouse:up":o._handlers.mouseup}))},_onMouseUp:function(){var e=this,o=e.imageEditor.canvas;o.selection=!0,o.uniScaleTransform=!1,o.off({"mouse:move":e._handlers.mousemove,"mouse:up":e._handlers.mouseup});var t=o.getActiveObject();null!=t&&(t.setCoords(),t.selectable=!0,o.calcOffset(),o.selection=!0,o.uniScaleTransform=!1,o.renderAll())},_onMouseMove:function(e){var o=this,t=o.imageEditor.canvas,n=t.getPointer(e.e),r=[o._startPoint.x,o._startPoint.y,n.x,n.y],i=o._shapeObj;i?i.set({x2:n.x,y2:n.y}):((i=new a.Line(r,{stroke:o._strokeColor,strokeWidth:o._strokeWidth,strokeDashArray:!0===o._dashLine?[5,5]:null,originX:"center",originY:"center",cornerSize:20,transparentCorners:!0})).annotationType="createLine",t.add(i),t.setActiveObject(i),o._shapeObj=i),t.renderAll()}})})),define("DS/2DAnnotation/commands/CreateArrow",["DS/Logger/Logger","DS/FabricJS/FabricJS","DS/2DAnnotation/interface/Command","i18n!DS/2DAnnotation/assets/nls/2DAnnotation","css!DS/2DAnnotation/2DAnnotation.css"],(function(e,o,t){"use strict";var a=window.fabric;return t.extend({name:"DS/2DAnnotation/commands/CreateArrow",init:function(e){var o=this;o._parent(e),o._handlers={mousedown:o._onMouseDown.bind(o),mouseup:o._onMouseUp.bind(o),mousemove:o._onMouseMove.bind(o)}},start:function(e){var o=this,t=o.imageEditor.canvas;t.defaultCursor="crosshair",o._size=e.size||18,o._fillColor=new a.Color(e.fillColor||"#000000").toRgba(),o._strokeColor=new a.Color(e.strokeColor||"#000000").toRgba(),t.on({"mouse:down":o._handlers.mousedown})},end:function(){var e=this.imageEditor.canvas;e.defaultCursor="default",e.off({"mouse:down":this._handlers.mousedown})},setSize:function(e){this._size=e},setFillColor:function(e){this._fillColor=new a.Color(e).toRgba()},setStrokeColor:function(e){this._strokeColor=new a.Color(e).toRgba()},_onMouseDown:function(e){var o=this,t=o.imageEditor.canvas;t.getActiveObject()||t.getActiveGroup()||(o._startPoint=t.getPointer(e.e),o._shapeObj=null,t.selection=!1,t.uniScaleTransform=!0,t.on({"mouse:move":o._handlers.mousemove,"mouse:up":o._handlers.mouseup}))},_onMouseUp:function(){var e=this,o=e.imageEditor.canvas;o.selection=!0,o.uniScaleTransform=!1,o.off({"mouse:move":e._handlers.mousemove,"mouse:up":e._handlers.mouseup});var t=o.getActiveObject();null!=t&&(t.setCoords(),t.selectable=!0,o.calcOffset(),o.selection=!0,o.uniScaleTransform=!1,o.renderAll())},_onMouseMove:function(e){var o=this,t=o.imageEditor.canvas.getPointer(e.e),a=o._shapeObj;o._shapeObj=o.updateShape(a,o._startPoint,t)},updateShape:function(e,o,t){var n=this,r=n.imageEditor.canvas,i=n._size,l=o&&o.x?o.x:e.points[0].x,c=o&&o.y?o.y:e.points[0].y,s=t&&t.x?t.x:e.points[4].x,d=t&&t.y?t.y:e.points[4].y,u=Math.atan2(d-c,s-l),v=s-i*Math.cos(u),g=d-i*Math.sin(u);null!=e&&r.remove(e);var m=[{x:l,y:c},{x:l-i/4*Math.cos(u-Math.PI/2),y:c-i/4*Math.sin(u-Math.PI/2)},{x:v-i/4*Math.cos(u-Math.PI/2),y:g-i/4*Math.sin(u-Math.PI/2)},{x:v-i*Math.cos(u-Math.PI/2)+10*Math.sin(u-Math.PI/2),y:g-i*Math.sin(u-Math.PI/2)-10*Math.cos(u-Math.PI/2)},{x:v+i*Math.cos(u),y:g+i*Math.sin(u)},{x:v-i*Math.cos(u+Math.PI/2)+10*Math.sin(u-Math.PI/2),y:g-i*Math.sin(u+Math.PI/2)-10*Math.cos(u-Math.PI/2)},{x:v-i/4*Math.cos(u+Math.PI/2),y:g-i/4*Math.sin(u+Math.PI/2)},{x:l-i/4*Math.cos(u+Math.PI/2),y:c-i/4*Math.sin(u+Math.PI/2)},{x:l,y:c}],h=new a.Polyline(m,{fill:n._fillColor,stroke:n._strokeColor,opacity:1,strokeWidth:1,originX:"left",originY:"top",selectable:!0,lockScalingFlip:!0,cornerSize:20,transparentCorners:!0});return h.annotationType="createArrow",h.arrowSize=i,h.setControlsVisibility({bl:!1,br:!0,tl:!0,tr:!1,mt:!1,mb:!1,ml:!1,mr:!1}),r.add(h),r.setActiveObject(h),h.on("modified",(function(){var e=this.calcTransformMatrix();h.points=this.get("points").map((function(e){return new a.Point(e.x-h.minX-h.width/2,e.y-h.minY-h.height/2)})).map((function(o){return a.util.transformPoint(o,e)})),n.updateShape(h)})),h}})})),define("DS/2DAnnotation/commands/CreateRectangle",["DS/Logger/Logger","DS/FabricJS/FabricJS","DS/2DAnnotation/interface/Command","i18n!DS/2DAnnotation/assets/nls/2DAnnotation","css!DS/2DAnnotation/2DAnnotation.css"],(function(e,o,t){"use strict";var a=window.fabric;return t.extend({name:"DS/2DAnnotation/commands/CreateRectangle",init:function(e){var o=this;o._parent(e),o._handlers={mousedown:o._onMouseDown.bind(o),mouseup:o._onMouseUp.bind(o),mousemove:o._onMouseMove.bind(o)}},start:function(e){var o=this,t=o.imageEditor.canvas;t.defaultCursor="crosshair",o._strokeWidth=e.strokeWidth||2,o._fillColor=new a.Color(e.fillColor||"#000000").toRgba(),o._strokeColor=new a.Color(e.strokeColor||"#000000").toRgba(),t.on({"mouse:down":o._handlers.mousedown})},end:function(){var e=this.imageEditor.canvas;e.defaultCursor="default",e.off({"mouse:down":this._handlers.mousedown})},setStrokeWidth:function(e){this._strokeWidth=e},setFillColor:function(e){this._fillColor=new a.Color(e).toRgba()},setStrokeColor:function(e){this._strokeColor=new a.Color(e).toRgba()},setOpacity:function(e){this._opacity=e},_onMouseDown:function(e){var o=this,t=o.imageEditor.canvas;t.getActiveObject()||t.getActiveGroup()||(o._startPoint=t.getPointer(e.e),o._shapeObj=null,t.selection=!1,t.uniScaleTransform=!0,t.on({"mouse:move":o._handlers.mousemove,"mouse:up":o._handlers.mouseup}))},_onMouseUp:function(){var e=this,o=e.imageEditor.canvas;o.selection=!0,o.uniScaleTransform=!1,o.off({"mouse:move":e._handlers.mousemove,"mouse:up":e._handlers.mouseup});var t=o.getActiveObject();null!=t&&(t.setCoords(),t.selectable=!0,o.calcOffset(),o.selection=!0,o.uniScaleTransform=!1,o.renderAll())},_onMouseMove:function(e){var o=this,t=o.imageEditor.canvas,n=t.getPointer(e.e),r=o._startPoint.x,i=o._startPoint.y,l=Math.min(r,n.x),c=Math.min(i,n.y),s=Math.abs(r-n.x),d=Math.abs(i-n.y),u=o._shapeObj;u?u.set("width",s).set("height",d).set("top",c).set("left",l):((u=new a.Rect({top:r,left:i,width:s,height:d,fill:o._fillColor,stroke:o._strokeColor,strokeWidth:o._strokeWidth,cornerSize:20,transparentCorners:!0})).annotationType="createRectangle",t.add(u),t.setActiveObject(u),o._shapeObj=u),t.renderAll()}})})),define("DS/2DAnnotation/commands/CreateCircle",["DS/Logger/Logger","DS/FabricJS/FabricJS","DS/2DAnnotation/interface/Command","i18n!DS/2DAnnotation/assets/nls/2DAnnotation","css!DS/2DAnnotation/2DAnnotation.css"],(function(e,o,t){"use strict";var a=window.fabric;return t.extend({name:"DS/2DAnnotation/commands/CreateCircle",init:function(e){var o=this;o._parent(e),o._handlers={mousedown:o._onMouseDown.bind(o),mouseup:o._onMouseUp.bind(o),mousemove:o._onMouseMove.bind(o)}},start:function(e){var o=this,t=o.imageEditor.canvas;t.defaultCursor="crosshair",o._strokeWidth=e.strokeWidth||2,o._fillColor=new a.Color(e.fillColor||"#000000").toRgba(),o._strokeColor=new a.Color(e.strokeColor||"#000000").toRgba(),t.on({"mouse:down":o._handlers.mousedown})},end:function(){var e=this.imageEditor.canvas;e.defaultCursor="default",e.off({"mouse:down":this._handlers.mousedown})},setStrokeWidth:function(e){this._strokeWidth=e},setFillColor:function(e){this._fillColor=new a.Color(e).toRgba()},setStrokeColor:function(e){this._strokeColor=new a.Color(e).toRgba()},_onMouseDown:function(e){var o=this,t=o.imageEditor.canvas;t.getActiveObject()||t.getActiveGroup()||(o._startPoint=t.getPointer(e.e),o._shapeObj=null,t.selection=!1,t.uniScaleTransform=!0,t.on({"mouse:move":o._handlers.mousemove,"mouse:up":o._handlers.mouseup}))},_onMouseUp:function(){var e=this,o=e.imageEditor.canvas;o.selection=!0,o.uniScaleTransform=!1,o.off({"mouse:move":e._handlers.mousemove,"mouse:up":e._handlers.mouseup});var t=o.getActiveObject();null!=t&&(t.setCoords(),t.selectable=!0,o.calcOffset(),o.selection=!0,o.uniScaleTransform=!1,o.renderAll())},_onMouseMove:function(e){var o=this,t=o.imageEditor.canvas.getPointer(e.e),a=o._shapeObj;o._shapeObj=o.updateShape(a,o._startPoint,t)},updateShape:function(e,o,t){var n=this,r=n.imageEditor.canvas,i=o&&o.x?o.x:e.initialCoords.start.x,l=o&&o.y?o.y:e.initialCoords.start.y,c=t&&t.x?t.x:e.initialCoords.end.x,s=t&&t.y?t.y:e.initialCoords.end.y,d=Math.min(i,c),u=Math.min(l,s),v=0;null!=e&&(null!==e.angle&&void 0!==e.angle&&(v=e.angle),r.remove(e));var g=new a.Ellipse({angle:v,left:d,top:u,stroke:n._strokeColor,strokeWidth:n._strokeWidth,fill:n._fillColor,rx:Math.abs(i-c)/2,ry:Math.abs(l-s)/2,cornerSize:20,transparentCorners:!0});return g.annotationType="createCircle",r.add(g),r.setActiveObject(g),n._shapeObj=g,g.initialCoords={start:{x:i,y:l},end:{x:c,y:s}},g.on("modified",(function(){var e=this;e.initialCoords={start:{x:e.aCoords.tl.x,y:e.aCoords.tl.y},end:{x:e.aCoords.br.x,y:e.aCoords.br.y}}})),g}})})),define("DS/2DAnnotation/commands/FreeDrawing",["DS/Logger/Logger","DS/FabricJS/FabricJS","DS/2DAnnotation/interface/Command","i18n!DS/2DAnnotation/assets/nls/2DAnnotation","css!DS/2DAnnotation/2DAnnotation.css"],(function(e,o,t){"use strict";var a=window.fabric;return t.extend({name:"DS/2DAnnotation/commands/FreeDrawing",init:function(e){var o=this;o._parent(e),o._onPathCreated=o._handlers.onPathCreated.bind(o)},start:function(e){var o=this,t=o.imageEditor.canvas;t.isDrawingMode=!0,o.setBrush(e),t.on("path:created",o._onPathCreated)},end:function(){var e=this.imageEditor.canvas;e.isDrawingMode=!1,e.off("path:created",this._onPathCreated)},setBrush:function(e){var o=this.imageEditor.canvas.freeDrawingBrush;if(e.width&&(o.width=e.width),e.color){var t=new a.Color(e.color);o.color=t.toRgba()}},_handlers:{onPathCreated:function(e){e.path.annotationType="freedrawing"}}})})),define("DS/2DAnnotation/views/Toolbar",["UWA/Class/Promise","UWA/Controls/Abstract","UWA/Core","DS/Controls/Button","DS/Controls/Popup","DS/Controls/Slider","DS/Controls/SpinBox","DS/Controls/Toggle","DS/Logger/Logger","DS/Windows/Dialog","DS/Windows/Panel","DS/2DAnnotation/components/ColorPicker","DS/IssueServices/utils/Performance","i18n!DS/2DAnnotation/assets/nls/2DAnnotation","css!DS/2DAnnotation/2DAnnotation.css"],(function(e,o,t,a,n,r,i,l,c,s,d,u,v,g){"use strict";var m={PREFERENCES:{TOOL_PREFERENCES:{KEY:"2DAnnotation.Toolbar.ToolPreferences",DEFAULT_VALUES:{freedrawing:{weight:5,colorOpacity:1,color:"CC092F"},highlight:{color:"ffff00",opacity:.3},createText:{weight:40,colorOpacity:1,color:"CC092F",strokeColorOpacity:0,strokeColor:"000000",backgroundColorOpacity:0,backgroundColor:"ffffff"},createLine:{weight:4,strokeColorOpacity:1,strokeColor:"000000",dashLine:!1},createArrow:{weight:20,colorOpacity:1,color:"CC092F",strokeColorOpacity:1,strokeColor:"000000"},createRectangle:{weight:10,colorOpacity:0,color:"000000",strokeColorOpacity:1,strokeColor:"CC092F"},createCircle:{weight:10,colorOpacity:0,color:"000000",strokeColorOpacity:1,strokeColor:"CC092F"}}}},FONT_FAMILY:{FontAwesome:WUXManagedFontIcons.FontAwesome,Font3DS:WUXManagedFontIcons.Font3DS},TOOLS:{OPEN:"open",SELECT:"select",FREEDRAWING:"freedrawing",HIGHLIGHT:"highlight",ERASE:"erase",TEXT:"createText",LINE:"createLine",ARROW:"createArrow",RECTANGLE:"createRectangle",CIRCLE:"createCircle",INSERT_IMAGE:"insertImage"},KEY_CODES:{Z:90,Y:85,DEL:46,BACKSPACE:8},FIRST_ELEMENT:0};return o.extend({name:"DS/2DAnnotation/views/Toolbar",isLoaded:null,_deferred:{resolve:null,reject:null},_logger:null,immersiveFrame:null,imageEditor:null,sidebar:{panel:null,remove:null,open:null,select:null,freedrawing:null,highlight:null,text:null,line:null,circle:null,arrow:null},_tooltips:[],activeTool:{id:"",panel:null,toolsUI:{select:{container:null},freedrawing:{container:null,weightSpinBox:null,weightSlider:null,colorOpacitySlider:null,colorPicker:null},highlight:{container:null,opacitySpinBox:null,opacitySlider:null,colorPicker:null},createText:{container:null,weightSpinBox:null,weightSlider:null,colorPicker:null,strokeColorPicker:null,backgroundColorPicker:null},createLine:{container:null,weightSpinBox:null,weightSlider:null,strokeColorPicker:null,dashLineToggle:null},createArrow:{container:null,weightSpinBox:null,weightSlider:null,colorPicker:null,strokeColorPicker:null},createRectangle:{container:null,colorPicker:null,strokeColorPicker:null},createCircle:{container:null,colorPicker:null,strokeColorPicker:null}}},activeObjects:[],callbacks:{saveCallback:null,exitCallback:null},preferences:{},init:function(e,o,a){var n=this;v.start(n.name+" init"),n._logger=c.getLogger(n.name),n.immersiveFrame=e,n.imageEditor=o,n.sidebar={panel:null,remove:null,open:null,select:null,freedrawing:null,highlight:null,text:null,line:null,circle:null,arrow:null},n._tooltips=[],n.activeTool={id:"",panel:null,toolsUI:{select:{container:null},freedrawing:{container:null,weightSpinBox:null,weightSlider:null,colorOpacitySlider:null,colorPicker:null},highlight:{container:null,opacitySpinBox:null,opacitySlider:null,colorPicker:null},createText:{container:null,weightSpinBox:null,weightSlider:null,colorPicker:null,strokeColorPicker:null,backgroundColorPicker:null},createLine:{container:null,weightSpinBox:null,weightSlider:null,strokeColorPicker:null,dashLineToggle:null},createArrow:{container:null,weightSpinBox:null,weightSlider:null,colorPicker:null,strokeColorPicker:null},createRectangle:{container:null,colorPicker:null,strokeColorPicker:null},createCircle:{container:null,colorPicker:null,strokeColorPicker:null}}},n.activeObjects=[],n.callbacks={saveCallback:a.saveCallback,exitCallback:a.exitCallback};try{var r=localStorage.getItem(m.PREFERENCES.TOOL_PREFERENCES.KEY);n.preferences=null===r||""===r?m.PREFERENCES.TOOL_PREFERENCES.DEFAULT_VALUES:t.merge(JSON.parse(r),m.PREFERENCES.TOOL_PREFERENCES.DEFAULT_VALUES)}catch(e){n.preferences=m.PREFERENCES.TOOL_PREFERENCES.DEFAULT_VALUES}v.end(n.name+" init")},destroy:function(){var e=this;e.immersiveFrame=null,e.imageEditor=null,e.sidebar={panel:null,remove:null,open:null,select:null,freedrawing:null,highlight:null,text:null,line:null,circle:null,arrow:null},e._tooltips.forEach((function(e){e.hide()})),e.activeTool={id:"",panel:null,toolsUI:{select:{container:null},freedrawing:{container:null,weightSpinBox:null,weightSlider:null,colorOpacitySlider:null,colorPicker:null},highlight:{container:null,opacitySpinBox:null,opacitySlider:null,colorPicker:null},createText:{container:null,weightSpinBox:null,weightSlider:null,colorPicker:null,strokeColorPicker:null,backgroundColorPicker:null},createLine:{container:null,weightSpinBox:null,weightSlider:null,strokeColorPicker:null,dashLineToggle:null},createArrow:{container:null,weightSpinBox:null,weightSlider:null,colorPicker:null,strokeColorPicker:null},createRectangle:{container:null,colorPicker:null,strokeColorPicker:null},createCircle:{container:null,colorPicker:null,strokeColorPicker:null}}},e.activeObjects=[],e.callbacks={saveCallback:null,exitCallback:null},e.preferences={},document.removeEventListener("keydown",e._onKeyDown)},render:function(){var o=this;return v.start(o.name+" render"),o.isLoaded=new e((function(e,t){o._deferred.resolve=e,o._deferred.reject=t})),o._createSidebar(),o._createActiveToolPanel(),o._onToolSelected(m.TOOLS.HIGHLIGHT),o._deferred.resolve(),v.end(o.name+" render"),o},listen:function(){var e=this;return e.imageEditor.canvas.on("selection:cleared",(function(){e.sidebar.remove.disabled=!0,e.activeObjects=[],e._onToolSelected(m.TOOLS.SELECT,!0)})),e.imageEditor.canvas.on("object:selected",(function(o){e.sidebar.remove.disabled=!1;var t=o.target,a=null,n={};if("group"===t.type){e.activeObjects=e.imageEditor.canvas._activeGroup._objects;var r=e.activeObjects.every((function(o){return e.activeObjects[m.FIRST_ELEMENT].annotationType===o.annotationType}));e.activeObjects.length&&r&&(a=e.activeObjects[m.FIRST_ELEMENT].annotationType)}else if(e.activeObjects=[e.imageEditor.canvas.getActiveObject()],t.annotationType)switch(a=t.annotationType,t.annotationType){case m.TOOLS.HIGHLIGHT:n={color:e.imageEditor.utils.RGBAtoHex(e.activeObjects[m.FIRST_ELEMENT].get("fill")).hex,opacity:e.activeObjects[m.FIRST_ELEMENT].get("opacity")};break;case m.TOOLS.TEXT:n={fontSize:e.activeObjects[m.FIRST_ELEMENT].get("fontSize"),fillColor:e.imageEditor.utils.RGBAtoHex(e.activeObjects[m.FIRST_ELEMENT].get("fill")).hex,fillOpacity:e.imageEditor.utils.RGBAtoHex(e.activeObjects[m.FIRST_ELEMENT].get("fill")).opacity,strokeColor:e.imageEditor.utils.RGBAtoHex(e.activeObjects[m.FIRST_ELEMENT].get("stroke")).hex,strokeOpacity:e.imageEditor.utils.RGBAtoHex(e.activeObjects[m.FIRST_ELEMENT].get("stroke")).opacity,backgroundColor:e.imageEditor.utils.RGBAtoHex(e.activeObjects[m.FIRST_ELEMENT].get("backgroundColor")).hex,backgroundOpacity:e.imageEditor.utils.RGBAtoHex(e.activeObjects[m.FIRST_ELEMENT].get("backgroundColor")).opacity};break;case m.TOOLS.LINE:n={strokeWidth:e.activeObjects[m.FIRST_ELEMENT].get("strokeWidth"),strokeColor:e.imageEditor.utils.RGBAtoHex(e.activeObjects[m.FIRST_ELEMENT].get("stroke")).hex,strokeOpacity:e.imageEditor.utils.RGBAtoHex(e.activeObjects[m.FIRST_ELEMENT].get("stroke")).opacity,dashLine:Array.isArray(e.activeObjects[m.FIRST_ELEMENT].get("strokeDashArray"))};break;case m.TOOLS.ARROW:n={size:e.activeObjects[m.FIRST_ELEMENT].get("arrowSize"),fillColor:e.imageEditor.utils.RGBAtoHex(e.activeObjects[m.FIRST_ELEMENT].get("fill")).hex,fillOpacity:e.imageEditor.utils.RGBAtoHex(e.activeObjects[m.FIRST_ELEMENT].get("fill")).opacity,strokeColor:e.imageEditor.utils.RGBAtoHex(e.activeObjects[m.FIRST_ELEMENT].get("stroke")).hex,strokeOpacity:e.imageEditor.utils.RGBAtoHex(e.activeObjects[m.FIRST_ELEMENT].get("stroke")).opacity};break;case m.TOOLS.RECTANGLE:case m.TOOLS.CIRCLE:n={strokeWidth:e.activeObjects[m.FIRST_ELEMENT].get("strokeWidth"),fillColor:e.imageEditor.utils.RGBAtoHex(e.activeObjects[m.FIRST_ELEMENT].get("fill")).hex,fillOpacity:e.imageEditor.utils.RGBAtoHex(e.activeObjects[m.FIRST_ELEMENT].get("fill")).opacity,strokeColor:e.imageEditor.utils.RGBAtoHex(e.activeObjects[m.FIRST_ELEMENT].get("stroke")).hex,strokeOpacity:e.imageEditor.utils.RGBAtoHex(e.activeObjects[m.FIRST_ELEMENT].get("stroke")).opacity};break;default:n=null}a&&a!==m.TOOLS.FREEDRAWING?e._onToolSelected(a,!0,n):e._onToolSelected(m.TOOLS.SELECT,!0)})),document.addEventListener("keydown",e._onKeyDown.bind(e)),e},_createSidebar:function(){var e=this,o=t.createElement("div",{class:"annotation-toolbar-sidebar"}),r=t.createElement("div",{class:"annotation-toolbar-tools-container"}).inject(o);e.sidebar.open=new a({emphasize:"secondary",type:"button",icon:{iconName:"folder-open",fontIconFamily:m.FONT_FAMILY.Font3DS},touch:!0,onClick:function(){var o=t.createElement("div",{class:"annotation-open-confirm",html:g.toolbar.sidebar.openConfirmDialog.content}),n=new s({title:g.toolbar.sidebar.openConfirmDialog.title,content:o,immersiveFrame:e.immersiveFrame,resizableFlag:!1,snappableFlag:!1,modalFlag:!0,buttons:{Cancel:new a({label:g.toolbar.sidebar.openConfirmDialog.cancel,onClick:function(){n.destroy()},allowUnsafeHTMLLabel:!0}),Ok:new a({label:g.toolbar.sidebar.openConfirmDialog.ok,onClick:function(){n.destroy(),e.imageEditor.openFile()},allowUnsafeHTMLLabel:!0})}})},allowUnsafeHTMLLabel:!0}).inject(r);var i=new n({target:e.sidebar.open,trigger:"hover"});i.setBody(g.toolbar.sidebar.panel.open),i.getContent().addClassName("annotation-toolbar-tools-popup"),e._tooltips.push(i);var l=function(o){return function(){e._onToolSelected(o)}},c=t.createElement("div",{class:"annotation-toolbar-tools-container"}).inject(o);e.sidebar[m.TOOLS.SELECT]=new a({emphasize:"secondary",type:"radio",checkFlag:!0,icon:{iconName:"target",fontIconFamily:m.FONT_FAMILY.Font3DS},onClick:l(m.TOOLS.SELECT),allowUnsafeHTMLLabel:!0}).inject(c);var u=new n({target:e.sidebar[m.TOOLS.SELECT],trigger:"hover"});u.setBody(g.tools[m.TOOLS.SELECT].title),u.getContent().addClassName("annotation-toolbar-tools-popup"),e._tooltips.push(u),e.sidebar[m.TOOLS.FREEDRAWING]=new a({emphasize:"secondary",type:"radio",icon:{iconName:"pencil",fontIconFamily:m.FONT_FAMILY.Font3DS},onClick:l(m.TOOLS.FREEDRAWING),allowUnsafeHTMLLabel:!0}).inject(c);var v=new n({target:e.sidebar[m.TOOLS.FREEDRAWING],trigger:"hover"});v.setBody(g.tools[m.TOOLS.FREEDRAWING].title),v.getContent().addClassName("annotation-toolbar-tools-popup"),e._tooltips.push(v),e.sidebar[m.TOOLS.HIGHLIGHT]=new a({emphasize:"secondary",type:"radio",icon:{iconName:"highlighter",fontIconFamily:m.FONT_FAMILY.Font3DS},onClick:l(m.TOOLS.HIGHLIGHT),allowUnsafeHTMLLabel:!0}).inject(c);var h=new n({target:e.sidebar[m.TOOLS.HIGHLIGHT],trigger:"hover"});h.setBody(g.tools[m.TOOLS.HIGHLIGHT].title),h.getContent().addClassName("annotation-toolbar-tools-popup"),e._tooltips.push(h),e.sidebar[m.TOOLS.TEXT]=new a({emphasize:"secondary",type:"radio",icon:{iconName:"text",fontIconFamily:m.FONT_FAMILY.Font3DS},onClick:l(m.TOOLS.TEXT),allowUnsafeHTMLLabel:!0}).inject(c);var T=new n({target:e.sidebar[m.TOOLS.TEXT],trigger:"hover"});T.setBody(g.tools[m.TOOLS.TEXT].title),T.getContent().addClassName("annotation-toolbar-tools-popup"),e._tooltips.push(T),e.sidebar[m.TOOLS.LINE]=new a({emphasize:"secondary",type:"radio",icon:{iconName:"minus",fontIconFamily:m.FONT_FAMILY.Font3DS},onClick:l(m.TOOLS.LINE),allowUnsafeHTMLLabel:!0}).inject(c);var p=new n({target:e.sidebar[m.TOOLS.LINE],trigger:"hover"});p.setBody(g.tools[m.TOOLS.LINE].title),p.getContent().addClassName("annotation-toolbar-tools-popup"),e._tooltips.push(p),e.sidebar[m.TOOLS.ARROW]=new a({emphasize:"secondary",type:"radio",icon:{iconName:"right",fontIconFamily:m.FONT_FAMILY.Font3DS},onClick:l(m.TOOLS.ARROW),allowUnsafeHTMLLabel:!0}).inject(c);var f=new n({target:e.sidebar[m.TOOLS.ARROW],trigger:"hover"});f.setBody(g.tools[m.TOOLS.ARROW].title),f.getContent().addClassName("annotation-toolbar-tools-popup"),e._tooltips.push(f),e.sidebar[m.TOOLS.RECTANGLE]=new a({emphasize:"secondary",type:"radio",icon:{iconName:"checkbox-off",fontIconFamily:m.FONT_FAMILY.Font3DS},onClick:l(m.TOOLS.RECTANGLE),allowUnsafeHTMLLabel:!0}).inject(c);var E=new n({target:e.sidebar[m.TOOLS.RECTANGLE],trigger:"hover"});E.setBody(g.tools[m.TOOLS.RECTANGLE].title),E.getContent().addClassName("annotation-toolbar-tools-popup"),e._tooltips.push(E),e.sidebar[m.TOOLS.CIRCLE]=new a({emphasize:"secondary",type:"radio",icon:{iconName:"radiobutton-off",fontIconFamily:m.FONT_FAMILY.Font3DS},onClick:l(m.TOOLS.CIRCLE),allowUnsafeHTMLLabel:!0}).inject(c);var C=new n({target:e.sidebar[m.TOOLS.CIRCLE],trigger:"hover"});C.setBody(g.tools[m.TOOLS.CIRCLE].title),C.getContent().addClassName("annotation-toolbar-tools-popup"),e._tooltips.push(C),e.sidebar[m.TOOLS.INSERT_IMAGE]=new a({emphasize:"secondary",type:"radio",icon:{iconName:"picture",fontIconFamily:m.FONT_FAMILY.Font3DS},onClick:l(m.TOOLS.INSERT_IMAGE),allowUnsafeHTMLLabel:!0}).inject(c);var O=new n({target:e.sidebar[m.TOOLS.INSERT_IMAGE],trigger:"hover"});O.setBody(g.tools[m.TOOLS.INSERT_IMAGE].title),O.getContent().addClassName("annotation-toolbar-tools-popup"),e._tooltips.push(O);var S=t.createElement("div",{class:"annotation-toolbar-tools-container"}).inject(o);e.sidebar.remove=new a({emphasize:"secondary",type:"button",icon:{iconName:"trash",fontIconFamily:m.FONT_FAMILY.Font3DS},disabled:!0,onClick:e._toolsCallbacks.remove.bind(e),allowUnsafeHTMLLabel:!0}).inject(S);var b=new n({target:e.sidebar.remove,trigger:"hover"});b.setBody(g.toolbar.sidebar.panel.remove),b.getContent().addClassName("annotation-toolbar-tools-popup"),e._tooltips.push(b);var w=t.createElement("div",{class:"annotation-toolbar-tools-container"}).inject(o);e.sidebar.download=new a({emphasize:"secondary",type:"button",icon:{iconName:"download",fontIconFamily:m.FONT_FAMILY.Font3DS},onClick:function(){e.imageEditor.download()},allowUnsafeHTMLLabel:!0}).inject(w);var L=new n({target:e.sidebar.download,trigger:"hover"});L.setBody(g.toolbar.sidebar.panel.download),L.getContent().addClassName("annotation-toolbar-tools-popup"),e._tooltips.push(L),e.sidebar.save=new a({emphasize:"secondary",type:"button",icon:{iconName:"floppy",fontIconFamily:m.FONT_FAMILY.Font3DS},onClick:function(){e.callbacks.saveCallback(e.imageEditor.save())},allowUnsafeHTMLLabel:!0}).inject(w);var k=new n({target:e.sidebar.save,trigger:"hover"});k.setBody(g.toolbar.sidebar.panel.save),k.getContent().addClassName("annotation-toolbar-tools-popup"),e._tooltips.push(k),e.sidebar.close=new a({emphasize:"secondary",type:"button",icon:{iconName:"close",fontIconFamily:m.FONT_FAMILY.Font3DS},onClick:function(){var o=t.createElement("div",{class:"annotation-close-confirm",html:g.toolbar.sidebar.closeConfirmDialog.content}),n=new s({title:g.toolbar.sidebar.closeConfirmDialog.title,content:o,immersiveFrame:e.immersiveFrame,resizableFlag:!1,snappableFlag:!1,modalFlag:!0,buttons:{Cancel:new a({label:g.toolbar.sidebar.closeConfirmDialog.cancel,onClick:function(){n.destroy()},allowUnsafeHTMLLabel:!0}),Ok:new a({label:g.toolbar.sidebar.closeConfirmDialog.save,onClick:function(){e.callbacks.saveCallback(e.imageEditor.save())},allowUnsafeHTMLLabel:!0}),Discard:new a({label:g.toolbar.sidebar.closeConfirmDialog.discard,onClick:function(){e.callbacks.exitCallback()},allowUnsafeHTMLLabel:!0})}})},allowUnsafeHTMLLabel:!0}).inject(w);var I=new n({target:e.sidebar.close,trigger:"hover"});I.setBody(g.toolbar.sidebar.panel.close),I.getContent().addClassName("annotation-toolbar-tools-popup"),e._tooltips.push(I),e.sidebar.panel=new d({content:o,position:{offsetX:20,offsetY:20},immersiveFrame:e.immersiveFrame,resizableFlag:!1,closeButtonFlag:!1,snappableFlag:!1,minWidth:54,width:54,allowedDockAreas:0})},_createActiveToolPanel:function(){var e=this,o=t.createElement("div",{class:"annotation-toolbar-active-panel-header",html:""}),a=t.createElement("div",{class:"annotation-toolbar-active-panel-container"});e._createSelectPanel(a),e._createFreeDrawingToolPanel(a),e._createHighlightToolPanel(a),e._createTextToolPanel(a),e._createLineToolPanel(a),e._createArrowToolPanel(a),e._createRectangleToolPanel(a),e._createCircleToolPanel(a),e.activeTool.panel=new d({title:g.activeTool,header:o,content:a,position:{offsetX:90,offsetY:20},immersiveFrame:e.immersiveFrame,resizableFlag:!0,closeButtonFlag:!1,height:240,width:280,allowedDockAreas:0}),e._onToolSelected(m.TOOLS.SELECT)},_createSelectPanel:function(e){this.activeTool.toolsUI.select.container=t.createElement("div",{class:"annotation-toolbar-active-panel-select"}).inject(e).hide()},_createFreeDrawingToolPanel:function(e){var o=this,a=t.createElement("div",{class:"annotation-toolbar-active-panel-freedrawing"}).inject(e).hide();o.activeTool.toolsUI.freedrawing.container=a;var n=t.createElement("div",{class:"annotation-toolbar-active-panel-freedrawing-weight"}).inject(a);t.createElement("div",{class:"annotation-toolbar-active-panel-freedrawing-weight-label",html:g.tools.freedrawing.labels.weight}).inject(n);var l=new i({value:o.preferences.freedrawing.weight,units:"px",minValue:1,maxValue:50,stepValue:1,pageStepValue:1}).inject(n);o.activeTool.toolsUI.freedrawing.weightSpinBox=l;var c=new r({value:o.preferences.freedrawing.weight,minValue:1,maxValue:50,stepValue:1}).inject(n);o.activeTool.toolsUI.freedrawing.weightSlider=c,l.addEventListener("change",(function(e){c.value=e.dsModel.value,o.imageEditor.getCommand(m.TOOLS.FREEDRAWING).setBrush({width:e.dsModel.value}),o._saveToolPreferences(m.TOOLS.FREEDRAWING,"weight",e.dsModel.value)})),c.addEventListener("change",(function(e){l.value=e.dsModel.value}));var s=t.createElement("div",{class:"annotation-toolbar-active-panel-freedrawing-color"}).inject(a);t.createElement("div",{class:"annotation-toolbar-active-panel-freedrawing-color-label",html:g.tools.freedrawing.labels.color}).inject(s);var d=new r({value:o.preferences.freedrawing.colorOpacity,minValue:0,maxValue:1,stepValue:.01}).inject(s);o.activeTool.toolsUI.freedrawing.colorOpacitySlider=d,d.addEventListener("change",(function(e){o.imageEditor.getCommand(m.TOOLS.FREEDRAWING).setBrush({color:o.imageEditor.utils.hexToRGBA("#"+o.activeTool.toolsUI.freedrawing.colorPicker.value,e.dsModel.value)}),o._saveToolPreferences(m.TOOLS.FREEDRAWING,"colorOpacity",e.dsModel.value)})),o.activeTool.toolsUI.freedrawing.colorPicker=new u,o.activeTool.toolsUI.freedrawing.colorPicker.value=o.preferences.freedrawing.color,o.activeTool.toolsUI.freedrawing.colorPicker.inject(s),o.activeTool.toolsUI.freedrawing.colorPicker.addEventListener("liveChange",(function(e){o.imageEditor.getCommand(m.TOOLS.FREEDRAWING).setBrush({color:o.imageEditor.utils.hexToRGBA("#"+e.dsModel.value,o.activeTool.toolsUI.freedrawing.colorOpacitySlider.value)}),o._saveToolPreferences(m.TOOLS.FREEDRAWING,"color",e.dsModel.value)}))},_createHighlightToolPanel:function(e){var o=this,a=t.createElement("div",{class:"annotation-toolbar-active-panel-highlight"}).inject(e).hide();o.activeTool.toolsUI.highlight.container=a;var n=t.createElement("div",{class:"annotation-toolbar-active-panel-highlight-color"}).inject(a);t.createElement("div",{class:"annotation-toolbar-active-panel-highlight-color-label",html:g.tools.highlight.labels.color}).inject(n),o.activeTool.toolsUI.highlight.colorPicker=new u,o.activeTool.toolsUI.highlight.colorPicker.value=o.preferences[m.TOOLS.HIGHLIGHT].color,o.activeTool.toolsUI.highlight.colorPicker.inject(n),o.activeTool.toolsUI.highlight.colorPicker.addEventListener("liveChange",(function(e){o.imageEditor.getCommand(m.TOOLS.HIGHLIGHT).setColor(e.dsModel.value),o.activeObjects.forEach((function(o){o.setColor("#"+e.dsModel.value)})),o.imageEditor.canvas.renderAll(),o._saveToolPreferences(m.TOOLS.HIGHLIGHT,"color",e.dsModel.value)}));var l=t.createElement("div",{class:"annotation-toolbar-active-panel-highlight-opacity"}).inject(a);t.createElement("div",{class:"annotation-toolbar-active-panel-highlight-opacity-label",html:g.tools.highlight.labels.opacity}).inject(l);var c=new i({value:o.preferences[m.TOOLS.HIGHLIGHT].opacity,units:"",minValue:0,maxValue:1,stepValue:.01,pageStepValue:.01}).inject(l);o.activeTool.toolsUI.highlight.opacitySpinBox=c;var s=new r({value:o.preferences[m.TOOLS.HIGHLIGHT].opacity,minValue:0,maxValue:1,stepValue:.01}).inject(l);o.activeTool.toolsUI.highlight.opacitySlider=s,c.addEventListener("change",(function(e){s.value=e.dsModel.value,o.imageEditor.getCommand(m.TOOLS.HIGHLIGHT).setOpacity(e.dsModel.value),o.activeObjects.forEach((function(o){o.set("opacity",e.dsModel.value)})),o.imageEditor.canvas.renderAll(),o._saveToolPreferences(m.TOOLS.HIGHLIGHT,"opacity",e.dsModel.value)})),s.addEventListener("change",(function(e){c.value=e.dsModel.value}))},_createTextToolPanel:function(e){var o=this,a=t.createElement("div",{class:"annotation-toolbar-active-panel-createtext"}).inject(e).hide();o.activeTool.toolsUI.createText.container=a;var n=t.createElement("div",{class:"annotation-toolbar-active-panel-createtext-weight"}).inject(a);t.createElement("div",{class:"annotation-toolbar-active-panel-createtext-weight-label",html:g.tools.createText.labels.weight}).inject(n);var l=new i({value:o.preferences[m.TOOLS.TEXT].weight,units:"px",minValue:1,maxValue:100,stepValue:1,pageStepValue:1}).inject(n);o.activeTool.toolsUI.createText.weightSpinBox=l;var c=new r({value:o.preferences[m.TOOLS.TEXT].weight,minValue:1,maxValue:100,stepValue:1}).inject(n);o.activeTool.toolsUI.createText.weightSlider=c,l.addEventListener("change",(function(e){c.value=e.dsModel.value,o.imageEditor.getCommand(m.TOOLS.TEXT).setFontSize(e.dsModel.value),o.activeObjects.forEach((function(o){o.set("fontSize",e.dsModel.value)})),o.imageEditor.canvas.renderAll(),o._saveToolPreferences(m.TOOLS.TEXT,"weight",e.dsModel.value)})),c.addEventListener("change",(function(e){l.value=e.dsModel.value}));var s=t.createElement("div",{class:"annotation-toolbar-active-panel-createtext-color"}).inject(a);t.createElement("div",{class:"annotation-toolbar-active-panel-createtext-color-label",html:g.tools.createText.labels.color}).inject(s);var d=new r({value:o.preferences[m.TOOLS.TEXT].colorOpacity,minValue:0,maxValue:1,stepValue:.01}).inject(s);o.activeTool.toolsUI.createText.colorOpacitySlider=d,d.addEventListener("change",(function(e){var t=o.imageEditor.utils.hexToRGBA("#"+o.activeTool.toolsUI.createText.colorPicker.value,e.dsModel.value);o.imageEditor.getCommand(m.TOOLS.TEXT).setFillColor(t),o.activeObjects.forEach((function(e){e.setColor(t)})),o.imageEditor.canvas.renderAll(),o._saveToolPreferences(m.TOOLS.TEXT,"colorOpacity",e.dsModel.value)})),o.activeTool.toolsUI.createText.colorPicker=new u,o.activeTool.toolsUI.createText.colorPicker.value=o.preferences[m.TOOLS.TEXT].color,o.activeTool.toolsUI.createText.colorPicker.inject(s),o.activeTool.toolsUI.createText.colorPicker.addEventListener("liveChange",(function(e){var t=o.imageEditor.utils.hexToRGBA("#"+e.dsModel.value,o.activeTool.toolsUI.createText.colorOpacitySlider.value);o.imageEditor.getCommand(m.TOOLS.TEXT).setFillColor(t),o.activeObjects.forEach((function(e){e.setColor(t)})),o.imageEditor.canvas.renderAll(),o._saveToolPreferences(m.TOOLS.TEXT,"color",e.dsModel.value)}));var v=t.createElement("div",{class:"annotation-toolbar-active-panel-createtext-color"}).inject(a);t.createElement("div",{class:"annotation-toolbar-active-panel-createtext-strokecolor-label",html:g.tools.createText.labels.strokeColor}).inject(v);var h=new r({value:o.preferences[m.TOOLS.TEXT].strokeColorOpacity,minValue:0,maxValue:1,stepValue:.01}).inject(v);o.activeTool.toolsUI.createText.strokeColorOpacitySlider=h,h.addEventListener("change",(function(e){var t=o.imageEditor.utils.hexToRGBA("#"+o.activeTool.toolsUI.createText.strokeColorPicker.value,e.dsModel.value);o.imageEditor.getCommand(m.TOOLS.TEXT).setStrokeColor(t),o.activeObjects.forEach((function(e){e.set("stroke",t)})),o.imageEditor.canvas.renderAll(),o._saveToolPreferences(m.TOOLS.TEXT,"strokeColorOpacity",e.dsModel.value)})),o.activeTool.toolsUI.createText.strokeColorPicker=new u,o.activeTool.toolsUI.createText.strokeColorPicker.value=o.preferences[m.TOOLS.TEXT].strokeColor,o.activeTool.toolsUI.createText.strokeColorPicker.inject(v),o.activeTool.toolsUI.createText.strokeColorPicker.addEventListener("liveChange",(function(e){var t=o.imageEditor.utils.hexToRGBA("#"+e.dsModel.value,o.activeTool.toolsUI.createText.strokeColorOpacitySlider.value);o.imageEditor.getCommand(m.TOOLS.TEXT).setStrokeColor(t),o.activeObjects.forEach((function(e){e.set("stroke",t)})),o.imageEditor.canvas.renderAll(),o._saveToolPreferences(m.TOOLS.TEXT,"strokeColor",e.dsModel.value)}));var T=t.createElement("div",{class:"annotation-toolbar-active-panel-createtext-color"}).inject(a);t.createElement("div",{class:"annotation-toolbar-active-panel-createtext-backgroundcolor-label",html:g.tools.createText.labels.backgroundColor}).inject(T);var p=new r({value:o.preferences[m.TOOLS.TEXT].backgroundColorOpacity,minValue:0,maxValue:1,stepValue:.01}).inject(T);o.activeTool.toolsUI.createText.backgroundColorOpacitySlider=p,p.addEventListener("change",(function(e){var t=o.imageEditor.utils.hexToRGBA("#"+o.activeTool.toolsUI.createText.backgroundColorPicker.value,e.dsModel.value);o.imageEditor.getCommand(m.TOOLS.TEXT).setBackgroundColor(t),o.activeObjects.forEach((function(e){e.set("backgroundColor",t)})),o.imageEditor.canvas.renderAll(),o._saveToolPreferences(m.TOOLS.TEXT,"backgroundColorOpacity",e.dsModel.value)})),o.activeTool.toolsUI.createText.backgroundColorPicker=new u,o.activeTool.toolsUI.createText.backgroundColorPicker.value=o.preferences[m.TOOLS.TEXT].backgroundColor,o.activeTool.toolsUI.createText.backgroundColorPicker.inject(T),o.activeTool.toolsUI.createText.backgroundColorPicker.addEventListener("liveChange",(function(e){var t=o.imageEditor.utils.hexToRGBA("#"+e.dsModel.value,o.activeTool.toolsUI.createText.backgroundColorOpacitySlider.value);o.imageEditor.getCommand(m.TOOLS.TEXT).setBackgroundColor(t),o.activeObjects.forEach((function(e){e.set("backgroundColor",t)})),o.imageEditor.canvas.renderAll(),o._saveToolPreferences(m.TOOLS.TEXT,"backgroundColor",e.dsModel.value)}))},_createArrowToolPanel:function(e){var o=this,a=t.createElement("div",{class:"annotation-toolbar-active-panel-createarrow"}).inject(e).hide();o.activeTool.toolsUI.createArrow.container=a;var n=t.createElement("div",{class:"annotation-toolbar-active-panel-createarrow-weight"}).inject(a);t.createElement("div",{class:"annotation-toolbar-active-panel-createarrow-weight-label",html:g.tools.createArrow.labels.weight}).inject(n);var l=new i({value:o.preferences[m.TOOLS.ARROW].weight,units:"px",minValue:1,maxValue:100,stepValue:1,pageStepValue:1}).inject(n);o.activeTool.toolsUI.createArrow.weightSpinBox=l;var c=new r({value:o.preferences[m.TOOLS.ARROW].weight,minValue:1,maxValue:100,stepValue:1}).inject(n);o.activeTool.toolsUI.createArrow.weightSlider=c,l.addEventListener("change",(function(e){c.value=e.dsModel.value,o.imageEditor.getCommand(m.TOOLS.ARROW).setSize(e.dsModel.value),o.activeObjects.forEach((function(e){o.imageEditor.getCommand(m.TOOLS.ARROW).updateShape(e)})),o.imageEditor.canvas.renderAll(),o._saveToolPreferences(m.TOOLS.ARROW,"weight",e.dsModel.value)})),c.addEventListener("change",(function(e){l.value=e.dsModel.value}));var s=t.createElement("div",{class:"annotation-toolbar-active-panel-createarrow-color"}).inject(a);t.createElement("div",{class:"annotation-toolbar-active-panel-createarrow-color-label",html:g.tools.createArrow.labels.color}).inject(s);var d=new r({value:o.preferences[m.TOOLS.ARROW].colorOpacity,minValue:0,maxValue:1,stepValue:.01}).inject(s);o.activeTool.toolsUI.createArrow.colorOpacitySlider=d,d.addEventListener("change",(function(e){var t=o.imageEditor.utils.hexToRGBA("#"+o.activeTool.toolsUI.createArrow.colorPicker.value,e.dsModel.value);o.imageEditor.getCommand(m.TOOLS.ARROW).setFillColor(t),o.activeObjects.forEach((function(e){e.setColor(t)})),o.imageEditor.canvas.renderAll(),o._saveToolPreferences(m.TOOLS.ARROW,"colorOpacity",e.dsModel.value)})),o.activeTool.toolsUI.createArrow.colorPicker=new u,o.activeTool.toolsUI.createArrow.colorPicker.value=o.preferences[m.TOOLS.ARROW].color,o.activeTool.toolsUI.createArrow.colorPicker.inject(s),o.activeTool.toolsUI.createArrow.colorPicker.addEventListener("liveChange",(function(e){var t=o.imageEditor.utils.hexToRGBA("#"+e.dsModel.value,o.activeTool.toolsUI.createArrow.colorOpacitySlider.value);o.imageEditor.getCommand(m.TOOLS.ARROW).setFillColor(t),o.activeObjects.forEach((function(e){e.setColor(t)})),o.imageEditor.canvas.renderAll(),o._saveToolPreferences(m.TOOLS.ARROW,"color",e.dsModel.value)}));var v=t.createElement("div",{class:"annotation-toolbar-active-panel-createarrow-color"}).inject(a);t.createElement("div",{class:"annotation-toolbar-active-panel-createarrow-strokecolor-label",html:g.tools.createArrow.labels.strokeColor}).inject(v);var h=new r({value:o.preferences[m.TOOLS.ARROW].strokeColorOpacity,minValue:0,maxValue:1,stepValue:.01}).inject(v);o.activeTool.toolsUI.createArrow.strokeColorOpacitySlider=h,h.addEventListener("change",(function(e){var t=o.imageEditor.utils.hexToRGBA("#"+o.activeTool.toolsUI.createArrow.strokeColorPicker.value,e.dsModel.value);o.imageEditor.getCommand(m.TOOLS.ARROW).setStrokeColor(t),o.activeObjects.forEach((function(e){e.set("stroke",t)})),o.imageEditor.canvas.renderAll(),o._saveToolPreferences(m.TOOLS.ARROW,"strokeColorOpacity",e.dsModel.value)})),o.activeTool.toolsUI.createArrow.strokeColorPicker=new u,o.activeTool.toolsUI.createArrow.strokeColorPicker.value=o.preferences[m.TOOLS.ARROW].strokeColor,o.activeTool.toolsUI.createArrow.strokeColorPicker.inject(v),o.activeTool.toolsUI.createArrow.strokeColorPicker.addEventListener("liveChange",(function(e){var t=o.imageEditor.utils.hexToRGBA("#"+e.dsModel.value,o.activeTool.toolsUI.createArrow.strokeColorOpacitySlider.value);o.imageEditor.getCommand(m.TOOLS.ARROW).setStrokeColor(t),o.activeObjects.forEach((function(e){e.set("stroke",t)})),o.imageEditor.canvas.renderAll(),o._saveToolPreferences(m.TOOLS.ARROW,"strokeColor",e.dsModel.value)}))},_createLineToolPanel:function(e){var o=this,a=t.createElement("div",{class:"annotation-toolbar-active-panel-createline"}).inject(e).hide();o.activeTool.toolsUI.createLine.container=a;var n=t.createElement("div",{class:"annotation-toolbar-active-panel-createline-weight"}).inject(a);t.createElement("div",{class:"annotation-toolbar-active-panel-createline-weight-label",html:g.tools.createLine.labels.weight}).inject(n);var c=new i({value:o.preferences[m.TOOLS.LINE].weight,units:"px",minValue:1,maxValue:50,stepValue:1,pageStepValue:1}).inject(n);o.activeTool.toolsUI.createLine.weightSpinBox=c;var s=new r({value:o.preferences[m.TOOLS.LINE].weight,minValue:1,maxValue:50,stepValue:1}).inject(n);o.activeTool.toolsUI.createLine.weightSlider=s,c.addEventListener("change",(function(e){s.value=e.dsModel.value,o.imageEditor.getCommand(m.TOOLS.LINE).setStrokeWidth(e.dsModel.value),o.activeObjects.forEach((function(o){o.set("strokeWidth",e.dsModel.value)})),o.imageEditor.canvas.renderAll(),o._saveToolPreferences(m.TOOLS.LINE,"weight",e.dsModel.value)})),s.addEventListener("change",(function(e){c.value=e.dsModel.value}));var d=t.createElement("div",{class:"annotation-toolbar-active-panel-createline-color"}).inject(a);t.createElement("div",{class:"annotation-toolbar-active-panel-createline-strokecolor-label",html:g.tools.createLine.labels.strokeColor}).inject(d);var v=new r({value:o.preferences[m.TOOLS.LINE].strokeColorOpacity,minValue:0,maxValue:1,stepValue:.01}).inject(d);o.activeTool.toolsUI.createLine.strokeColorOpacitySlider=v,v.addEventListener("change",(function(e){var t=o.imageEditor.utils.hexToRGBA("#"+o.activeTool.toolsUI.createLine.strokeColorPicker.value,e.dsModel.value);o.imageEditor.getCommand(m.TOOLS.LINE).setStrokeColor(t),o.activeObjects.forEach((function(e){e.set("stroke",t)})),o.imageEditor.canvas.renderAll(),o._saveToolPreferences(m.TOOLS.LINE,"strokeColorOpacity",e.dsModel.value)})),o.activeTool.toolsUI.createLine.strokeColorPicker=new u,o.activeTool.toolsUI.createLine.strokeColorPicker.value=o.preferences[m.TOOLS.LINE].strokeColor,o.activeTool.toolsUI.createLine.strokeColorPicker.inject(d),o.activeTool.toolsUI.createLine.strokeColorPicker.addEventListener("liveChange",(function(e){var t=o.imageEditor.utils.hexToRGBA("#"+e.dsModel.value,o.activeTool.toolsUI.createLine.strokeColorOpacitySlider.value);o.imageEditor.getCommand(m.TOOLS.LINE).setStrokeColor(t),o.activeObjects.forEach((function(e){e.set("stroke",t)})),o.imageEditor.canvas.renderAll(),o._saveToolPreferences(m.TOOLS.LINE,"strokeColor",e.dsModel.value)}));var h=t.createElement("div",{class:"annotation-toolbar-active-panel-createline-dashline"}).inject(a);t.createElement("div",{class:"annotation-toolbar-active-panel-createline-dashline-label",html:g.tools.createLine.labels.dashLine}).inject(h),o.activeTool.toolsUI.createLine.dashLineToggle=new l({type:"switch"}),o.activeTool.toolsUI.createLine.dashLineToggle.checkFlag=o.preferences[m.TOOLS.LINE].dashLine,o.activeTool.toolsUI.createLine.dashLineToggle.inject(h),o.activeTool.toolsUI.createLine.dashLineToggle.addEventListener("change",(function(e){var t=e.dsModel.checkFlag;o.imageEditor.getCommand(m.TOOLS.LINE).setDashLine(t),o.activeObjects.forEach((function(e){e.set("strokeDashArray",!0===t?[5,5]:null)})),o.imageEditor.canvas.renderAll(),o._saveToolPreferences(m.TOOLS.LINE,"dashLine",e.dsModel.checkFlag)}))},_createRectangleToolPanel:function(e){var o=this,a=t.createElement("div",{class:"annotation-toolbar-active-panel-createrectangle"}).inject(e).hide();o.activeTool.toolsUI.createRectangle.container=a;var n=t.createElement("div",{class:"annotation-toolbar-active-panel-createrectangle-weight"}).inject(a);t.createElement("div",{class:"annotation-toolbar-active-panel-createrectangle-weight-label",html:g.tools.createRectangle.labels.weight}).inject(n);var l=new i({value:o.preferences[m.TOOLS.RECTANGLE].weight,units:"px",minValue:1,maxValue:50,stepValue:1,pageStepValue:1}).inject(n);o.activeTool.toolsUI.createRectangle.weightSpinBox=l;var c=new r({value:o.preferences[m.TOOLS.RECTANGLE].weight,minValue:1,maxValue:50,stepValue:1}).inject(n);o.activeTool.toolsUI.createRectangle.weightSlider=c,l.addEventListener("change",(function(e){c.value=e.dsModel.value,o.imageEditor.getCommand(m.TOOLS.RECTANGLE).setStrokeWidth(e.dsModel.value),o.activeObjects.forEach((function(o){o.set("strokeWidth",e.dsModel.value)})),o.imageEditor.canvas.renderAll(),o._saveToolPreferences(m.TOOLS.RECTANGLE,"weight",e.dsModel.value)})),c.addEventListener("change",(function(e){l.value=e.dsModel.value}));var s=t.createElement("div",{class:"annotation-toolbar-active-panel-createrectangle-color"}).inject(a);t.createElement("div",{class:"annotation-toolbar-active-panel-createrectangle-color-label",html:g.tools.createRectangle.labels.color}).inject(s);var d=new r({value:o.preferences[m.TOOLS.RECTANGLE].colorOpacity,minValue:0,maxValue:1,stepValue:.01}).inject(s);o.activeTool.toolsUI.createRectangle.colorOpacitySlider=d,d.addEventListener("change",(function(e){var t=o.imageEditor.utils.hexToRGBA("#"+o.activeTool.toolsUI.createRectangle.colorPicker.value,e.dsModel.value);o.imageEditor.getCommand(m.TOOLS.RECTANGLE).setFillColor(t),o.activeObjects.forEach((function(e){e.setColor(t)})),o.imageEditor.canvas.renderAll(),o._saveToolPreferences(m.TOOLS.RECTANGLE,"colorOpacity",e.dsModel.value)})),o.activeTool.toolsUI.createRectangle.colorPicker=new u,o.activeTool.toolsUI.createRectangle.colorPicker.value=o.preferences[m.TOOLS.RECTANGLE].color,o.activeTool.toolsUI.createRectangle.colorPicker.inject(s),o.activeTool.toolsUI.createRectangle.colorPicker.addEventListener("liveChange",(function(e){var t=o.imageEditor.utils.hexToRGBA("#"+e.dsModel.value,o.activeTool.toolsUI.createRectangle.colorOpacitySlider.value);o.imageEditor.getCommand(m.TOOLS.RECTANGLE).setFillColor(t),o.activeObjects.forEach((function(e){e.setColor(t)})),o.imageEditor.canvas.renderAll(),o._saveToolPreferences(m.TOOLS.RECTANGLE,"color",e.dsModel.value)}));var v=t.createElement("div",{class:"annotation-toolbar-active-panel-createrectangle-color"}).inject(a);t.createElement("div",{class:"annotation-toolbar-active-panel-createrectangle-strokecolor-label",html:g.tools.createRectangle.labels.strokeColor}).inject(v);var h=new r({value:o.preferences[m.TOOLS.RECTANGLE].strokeColorOpacity,minValue:0,maxValue:1,stepValue:.01}).inject(v);o.activeTool.toolsUI.createRectangle.strokeColorOpacitySlider=h,h.addEventListener("change",(function(e){var t=o.imageEditor.utils.hexToRGBA("#"+o.activeTool.toolsUI.createRectangle.strokeColorPicker.value,e.dsModel.value);o.imageEditor.getCommand(m.TOOLS.RECTANGLE).setStrokeColor(t),o.activeObjects.forEach((function(e){e.set("stroke",t)})),o.imageEditor.canvas.renderAll(),o._saveToolPreferences(m.TOOLS.RECTANGLE,"strokeColorOpacity",e.dsModel.value)})),o.activeTool.toolsUI.createRectangle.strokeColorPicker=new u,o.activeTool.toolsUI.createRectangle.strokeColorPicker.value=o.preferences[m.TOOLS.RECTANGLE].strokeColor,o.activeTool.toolsUI.createRectangle.strokeColorPicker.inject(v),o.activeTool.toolsUI.createRectangle.strokeColorPicker.addEventListener("liveChange",(function(e){var t=o.imageEditor.utils.hexToRGBA("#"+e.dsModel.value,o.activeTool.toolsUI.createRectangle.strokeColorOpacitySlider.value);o.imageEditor.getCommand(m.TOOLS.RECTANGLE).setStrokeColor(t),o.activeObjects.forEach((function(e){e.set("stroke",t)})),o.imageEditor.canvas.renderAll(),o._saveToolPreferences(m.TOOLS.RECTANGLE,"strokeColor",e.dsModel.value)}))},_createCircleToolPanel:function(e){var o=this,a=t.createElement("div",{class:"annotation-toolbar-active-panel-createcircle"}).inject(e).hide();o.activeTool.toolsUI.createCircle.container=a;var n=t.createElement("div",{class:"annotation-toolbar-active-panel-createcircle-weight"}).inject(a);t.createElement("div",{class:"annotation-toolbar-active-panel-createcircle-weight-label",html:g.tools.createCircle.labels.weight}).inject(n);var l=new i({value:o.preferences[m.TOOLS.CIRCLE].weight,units:"px",minValue:1,maxValue:50,stepValue:1,pageStepValue:1}).inject(n);o.activeTool.toolsUI.createCircle.weightSpinBox=l;var c=new r({value:o.preferences[m.TOOLS.CIRCLE].weight,minValue:1,maxValue:50,stepValue:1}).inject(n);o.activeTool.toolsUI.createCircle.weightSlider=c,l.addEventListener("change",(function(e){c.value=e.dsModel.value,o.imageEditor.getCommand(m.TOOLS.CIRCLE).setStrokeWidth(e.dsModel.value),o.activeObjects.forEach((function(o){o.set("strokeWidth",e.dsModel.value)})),o.imageEditor.canvas.renderAll(),o._saveToolPreferences(m.TOOLS.CIRCLE,"weight",e.dsModel.value)})),c.addEventListener("change",(function(e){l.value=e.dsModel.value}));var s=t.createElement("div",{class:"annotation-toolbar-active-panel-createcircle-color"}).inject(a);t.createElement("div",{class:"annotation-toolbar-active-panel-createcircle-color-label",html:g.tools.createCircle.labels.color}).inject(s);var d=new r({value:o.preferences[m.TOOLS.CIRCLE].colorOpacity,minValue:0,maxValue:1,stepValue:.01}).inject(s);o.activeTool.toolsUI.createCircle.colorOpacitySlider=d,d.addEventListener("change",(function(e){var t=o.imageEditor.utils.hexToRGBA("#"+o.activeTool.toolsUI.createCircle.colorPicker.value,e.dsModel.value);o.imageEditor.getCommand(m.TOOLS.CIRCLE).setFillColor(t),o.activeObjects.forEach((function(e){e.setColor(t)})),o.imageEditor.canvas.renderAll(),o._saveToolPreferences(m.TOOLS.CIRCLE,"colorOpacity",e.dsModel.value)})),o.activeTool.toolsUI.createCircle.colorPicker=new u,o.activeTool.toolsUI.createCircle.colorPicker.value=o.preferences[m.TOOLS.CIRCLE].color,o.activeTool.toolsUI.createCircle.colorPicker.inject(s),o.activeTool.toolsUI.createCircle.colorPicker.addEventListener("liveChange",(function(e){var t=o.imageEditor.utils.hexToRGBA("#"+e.dsModel.value,o.activeTool.toolsUI.createCircle.colorOpacitySlider.value);o.imageEditor.getCommand(m.TOOLS.CIRCLE).setFillColor(t),o.activeObjects.forEach((function(e){e.setColor(t)})),o.imageEditor.canvas.renderAll(),o._saveToolPreferences(m.TOOLS.CIRCLE,"color",e.dsModel.value)}));var v=t.createElement("div",{class:"annotation-toolbar-active-panel-createcircle-color"}).inject(a);t.createElement("div",{class:"annotation-toolbar-active-panel-createcircle-strokecolor-label",html:g.tools.createCircle.labels.strokeColor}).inject(v);var h=new r({value:o.preferences[m.TOOLS.CIRCLE].strokeColorOpacity,minValue:0,maxValue:1,stepValue:.01}).inject(v);o.activeTool.toolsUI.createCircle.strokeColorOpacitySlider=h,h.addEventListener("change",(function(e){var t=o.imageEditor.utils.hexToRGBA("#"+o.activeTool.toolsUI.createCircle.strokeColorPicker.value,e.dsModel.value);o.imageEditor.getCommand(m.TOOLS.CIRCLE).setStrokeColor(t),o.activeObjects.forEach((function(e){e.set("stroke",t)})),o.imageEditor.canvas.renderAll(),o._saveToolPreferences(m.TOOLS.CIRCLE,"strokeOpacity",e.dsModel.value)})),o.activeTool.toolsUI.createCircle.strokeColorPicker=new u,o.activeTool.toolsUI.createCircle.strokeColorPicker.value=o.preferences[m.TOOLS.CIRCLE].strokeColor,o.activeTool.toolsUI.createCircle.strokeColorPicker.inject(v),o.activeTool.toolsUI.createCircle.strokeColorPicker.addEventListener("liveChange",(function(e){var t=o.imageEditor.utils.hexToRGBA("#"+e.dsModel.value,o.activeTool.toolsUI.createCircle.strokeColorOpacitySlider.value);o.imageEditor.getCommand(m.TOOLS.CIRCLE).setStrokeColor(t),o.activeObjects.forEach((function(e){e.set("stroke",t)})),o.imageEditor.canvas.renderAll(),o._saveToolPreferences(m.TOOLS.CIRCLE,"strokeColor",e.dsModel.value)}))},_onToolSelected:function(e,o,t){var a=this;o||(a.sidebar.remove.disabled=!0,a.imageEditor.canvas.deactivateAll().renderAll(),a.activeObjects=[]),Object.keys(a.activeTool.toolsUI).forEach((function(e){a.activeTool.toolsUI[e].container.hide()})),a.sidebar[e].checkFlag=!0,a.activeTool.panel.header.innerHTML=g.tools[e].title,e in a.activeTool.toolsUI&&a.activeTool.toolsUI[e].container.show(),e in a._toolsCallbacks&&a._toolsCallbacks[e].call(a,t),a.activeTool.id=e},_toolsCallbacks:{remove:function(){var e=this;e.activeObjects.forEach((function(o){e.imageEditor.canvas.remove(o)})),e.imageEditor.canvas.deactivateAll().renderAll()},select:function(){this.imageEditor.stopCommand()},freedrawing:function(){var e=this,o=e.imageEditor.utils.hexToRGBA("#"+e.activeTool.toolsUI.freedrawing.colorPicker.value,e.activeTool.toolsUI.freedrawing.colorOpacitySlider.value);e.imageEditor.startCommand(m.TOOLS.FREEDRAWING,{width:e.activeTool.toolsUI.freedrawing.weightSpinBox.value,color:o})},highlight:function(e){var o=this;null!=e&&(e.hasOwnProperty("color")&&(o.activeTool.toolsUI.highlight.colorPicker.value=e.color),e.hasOwnProperty("opacity")&&(o.activeTool.toolsUI.highlight.opacitySpinBox.value=e.opacity)),o.imageEditor.startCommand(m.TOOLS.HIGHLIGHT,{color:o.activeTool.toolsUI.highlight.colorPicker.value,opacity:o.activeTool.toolsUI.highlight.opacitySpinBox.value})},createText:function(e){var o=this,t=null,a=null;null!=e&&(e.hasOwnProperty("fillColor")&&(o.activeTool.toolsUI.createText.colorPicker.value=e.fillColor),e.hasOwnProperty("fillOpacity")&&(o.activeTool.toolsUI.createText.colorOpacitySlider.value=e.fillOpacity),e.hasOwnProperty("strokeColor")&&(o.activeTool.toolsUI.createText.strokeColorPicker.value=e.strokeColor),e.hasOwnProperty("strokeOpacity")&&(o.activeTool.toolsUI.createText.strokeColorOpacitySlider.value=e.strokeOpacity),e.hasOwnProperty("backgroundColor")&&(o.activeTool.toolsUI.createText.backgroundColorPicker.value=e.backgroundColor),e.hasOwnProperty("backgroundOpacity")&&(o.activeTool.toolsUI.createText.backgroundColorOpacitySlider.value=e.backgroundOpacity),e.hasOwnProperty("fontSize")&&(o.activeTool.toolsUI.createText.weightSpinBox.disabled=!0,o.activeTool.toolsUI.createText.weightSlider.disabled=!0,o.activeTool.toolsUI.createText.weightSpinBox.value=e.fontSize,o.activeTool.toolsUI.createText.weightSlider.value=e.fontSize,o.activeTool.toolsUI.createText.weightSpinBox.disabled=!1,o.activeTool.toolsUI.createText.weightSlider.disabled=!1),e.hasOwnProperty("text")&&(t=e.text),e.hasOwnProperty("centered")&&(a=e.centered));var n=o.imageEditor.utils.hexToRGBA("#"+o.activeTool.toolsUI.createText.colorPicker.value,o.activeTool.toolsUI.createText.colorOpacitySlider.value),r=o.imageEditor.utils.hexToRGBA("#"+o.activeTool.toolsUI.createText.strokeColorPicker.value,o.activeTool.toolsUI.createText.strokeColorOpacitySlider.value),i=o.imageEditor.utils.hexToRGBA("#"+o.activeTool.toolsUI.createText.backgroundColorPicker.value,o.activeTool.toolsUI.createText.backgroundColorOpacitySlider.value);o.imageEditor.startCommand(m.TOOLS.TEXT,{fontSize:o.activeTool.toolsUI.createText.weightSpinBox.value,fillColor:n,strokeColor:r,backgroundColor:i,text:t,centered:a})},createLine:function(e){var o=this;null!=e&&(e.hasOwnProperty("strokeColor")&&(o.activeTool.toolsUI.createLine.strokeColorPicker.value=e.strokeColor),e.hasOwnProperty("strokeOpacity")&&(o.activeTool.toolsUI.createLine.strokeColorOpacitySlider.value=e.strokeOpacity),e.hasOwnProperty("strokeWidth")&&(o.activeTool.toolsUI.createLine.weightSpinBox.disabled=!0,o.activeTool.toolsUI.createLine.weightSlider.disabled=!0,o.activeTool.toolsUI.createLine.weightSpinBox.value=e.strokeWidth,o.activeTool.toolsUI.createLine.weightSlider.value=e.strokeWidth,o.activeTool.toolsUI.createLine.weightSpinBox.disabled=!1,o.activeTool.toolsUI.createLine.weightSlider.disabled=!1),e.hasOwnProperty("dashLine")&&(o.activeTool.toolsUI.createLine.dashLineToggle.checkFlag=e.dashLine));var t=o.imageEditor.utils.hexToRGBA("#"+o.activeTool.toolsUI.createLine.strokeColorPicker.value,o.activeTool.toolsUI.createLine.strokeColorOpacitySlider.value);o.imageEditor.startCommand(m.TOOLS.LINE,{strokeWidth:o.activeTool.toolsUI.createLine.weightSpinBox.value,strokeColor:t,dashLine:o.activeTool.toolsUI.createLine.dashLineToggle.checkFlag})},createArrow:function(e){var o=this;null!=e&&(e.hasOwnProperty("fillColor")&&(o.activeTool.toolsUI.createArrow.colorPicker.value=e.fillColor),e.hasOwnProperty("fillOpacity")&&(o.activeTool.toolsUI.createArrow.colorOpacitySlider.value=e.fillOpacity),e.hasOwnProperty("strokeColor")&&(o.activeTool.toolsUI.createArrow.strokeColorPicker.value=e.strokeColor),e.hasOwnProperty("strokeOpacity")&&(o.activeTool.toolsUI.createArrow.strokeColorOpacitySlider.value=e.strokeOpacity),e.hasOwnProperty("size")&&(o.activeTool.toolsUI.createArrow.weightSpinBox.disabled=!0,o.activeTool.toolsUI.createArrow.weightSlider.disabled=!0,o.activeTool.toolsUI.createArrow.weightSpinBox.value=e.size,o.activeTool.toolsUI.createArrow.weightSlider.value=e.size,o.activeTool.toolsUI.createArrow.weightSpinBox.disabled=!1,o.activeTool.toolsUI.createArrow.weightSlider.disabled=!1));var t=o.imageEditor.utils.hexToRGBA("#"+o.activeTool.toolsUI.createArrow.colorPicker.value,o.activeTool.toolsUI.createArrow.colorOpacitySlider.value),a=o.imageEditor.utils.hexToRGBA("#"+o.activeTool.toolsUI.createArrow.strokeColorPicker.value,o.activeTool.toolsUI.createArrow.strokeColorOpacitySlider.value);o.imageEditor.startCommand(m.TOOLS.ARROW,{size:o.activeTool.toolsUI.createArrow.weightSpinBox.value,fillColor:t,strokeColor:a})},createRectangle:function(e){var o=this;null!=e&&(e.hasOwnProperty("fillColor")&&(o.activeTool.toolsUI.createRectangle.colorPicker.value=e.fillColor),e.hasOwnProperty("fillOpacity")&&(o.activeTool.toolsUI.createRectangle.colorOpacitySlider.value=e.fillOpacity),e.hasOwnProperty("strokeColor")&&(o.activeTool.toolsUI.createRectangle.strokeColorPicker.value=e.strokeColor),e.hasOwnProperty("strokeOpacity")&&(o.activeTool.toolsUI.createRectangle.strokeColorOpacitySlider.value=e.strokeOpacity),e.hasOwnProperty("strokeWidth")&&(o.activeTool.toolsUI.createRectangle.weightSpinBox.disabled=!0,o.activeTool.toolsUI.createRectangle.weightSlider.disabled=!0,o.activeTool.toolsUI.createRectangle.weightSpinBox.value=e.strokeWidth,o.activeTool.toolsUI.createRectangle.weightSlider.value=e.strokeWidth,o.activeTool.toolsUI.createRectangle.weightSpinBox.disabled=!1,o.activeTool.toolsUI.createRectangle.weightSlider.disabled=!1));var t=o.imageEditor.utils.hexToRGBA("#"+o.activeTool.toolsUI.createRectangle.colorPicker.value,o.activeTool.toolsUI.createRectangle.colorOpacitySlider.value),a=o.imageEditor.utils.hexToRGBA("#"+o.activeTool.toolsUI.createRectangle.strokeColorPicker.value,o.activeTool.toolsUI.createRectangle.strokeColorOpacitySlider.value);o.imageEditor.startCommand(m.TOOLS.RECTANGLE,{strokeWidth:o.activeTool.toolsUI.createRectangle.weightSpinBox.value,fillColor:t,strokeColor:a})},createCircle:function(e){var o=this;null!=e&&(e.hasOwnProperty("fillColor")&&(o.activeTool.toolsUI.createCircle.colorPicker.value=e.fillColor),e.hasOwnProperty("fillOpacity")&&(o.activeTool.toolsUI.createCircle.colorOpacitySlider.value=e.fillOpacity),e.hasOwnProperty("strokeColor")&&(o.activeTool.toolsUI.createCircle.strokeColorPicker.value=e.strokeColor),e.hasOwnProperty("strokeOpacity")&&(o.activeTool.toolsUI.createCircle.strokeColorOpacitySlider.value=e.strokeOpacity),e.hasOwnProperty("strokeWidth")&&(o.activeTool.toolsUI.createCircle.weightSpinBox.disabled=!0,o.activeTool.toolsUI.createCircle.weightSlider.disabled=!0,o.activeTool.toolsUI.createCircle.weightSpinBox.value=e.strokeWidth,o.activeTool.toolsUI.createCircle.weightSlider.value=e.strokeWidth,o.activeTool.toolsUI.createCircle.weightSpinBox.disabled=!1,o.activeTool.toolsUI.createCircle.weightSlider.disabled=!1));var t=o.imageEditor.utils.hexToRGBA("#"+o.activeTool.toolsUI.createCircle.colorPicker.value,o.activeTool.toolsUI.createCircle.colorOpacitySlider.value),a=o.imageEditor.utils.hexToRGBA("#"+o.activeTool.toolsUI.createCircle.strokeColorPicker.value,o.activeTool.toolsUI.createCircle.strokeColorOpacitySlider.value);o.imageEditor.startCommand(m.TOOLS.CIRCLE,{strokeWidth:o.activeTool.toolsUI.createCircle.weightSpinBox.value,fillColor:t,strokeColor:a})},insertImage:function(){this.imageEditor.stopCommand(),this.imageEditor.insertImage()}},_onKeyDown:function(e){var o=this;if(e.keyCode!==m.KEY_CODES.BACKSPACE&&e.keyCode!==m.KEY_CODES.DEL||o._toolsCallbacks.remove.call(o),65===e.keyCode&&e.ctrlKey&&(e.preventDefault(),o.imageEditor.selectAll()),67===e.keyCode&&e.ctrlKey){e.stopPropagation();var t=o.imageEditor.canvas.getActiveObject();null===t&&(t=o.imageEditor.canvas.getActiveGroup()),t.clone((function(e){o._clipboard=e}))}if(86===e.keyCode&&e.ctrlKey){var a=o.imageEditor.canvas.getActiveObject();if(null!==a&&a.annotationType===m.TOOLS.TEXT&&a.isEditing)return;if(null===o._clipboard||void 0===o._clipboard)return;e.stopPropagation(),o._clipboard.clone((function(e){o.imageEditor.canvas.deactivateAll(),e.set({left:e.left+30,top:e.top+30,evented:!0}),"group"===e.type?(e.forEachObject((function(e){o.imageEditor.canvas.add(e)})),e.setCoords(),o.imageEditor.canvas.setActiveGroup(e)):(o.imageEditor.canvas.add(e),o.imageEditor.canvas.setActiveObject(e)),o._clipboard.top+=30,o._clipboard.left+=30})),o.imageEditor.canvas.renderAll()}},_saveToolPreferences:function(e,o,t){this.preferences[e][o]=t,localStorage.setItem(m.PREFERENCES.TOOL_PREFERENCES.KEY,JSON.stringify(this.preferences))}})})),define("DS/2DAnnotation/components/ImageEditor",["UWA/Class/Promise","UWA/Controls/Abstract","UWA/Core","DS/FabricJS/FabricJS","DS/Logger/Logger","DS/VENWebHtml2Canvas/Html2Canvas","DS/WAFData/WAFData","DS/2DAnnotation/commands/CreateArrow","DS/2DAnnotation/commands/CreateCircle","DS/2DAnnotation/commands/CreateLine","DS/2DAnnotation/commands/CreateRectangle","DS/2DAnnotation/commands/CreateText","DS/2DAnnotation/commands/FreeDrawing","DS/2DAnnotation/commands/Highlight","DS/IssueCommon/utils/Utils","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","i18n!DS/2DAnnotation/assets/nls/2DAnnotation","css!DS/2DAnnotation/2DAnnotation.css"],(function(e,o,t,a,n,r,i,l,c,s,d,u,v,g,m,h,T){"use strict";var p=window.fabric,f={FREE_DRAWING:"freedrawing",HIGHLIGHT:"highlight",TEXT:"createText",LINE:"createLine",ARROW:"createArrow",RECTANGLE:"createRectangle",CIRCLE:"createCircle"},E=o.extend({name:"DS/2DAnnotation/components/ImageEditor",_logger:null,commands:{},elements:{},canvas:null,init:function(){var e=this;T.start(e.name+" init"),e._logger=n.getLogger(e.name);var o=t.createElement("canvas");e.commands={},e.commands[f.FREE_DRAWING]=new v({imageEditor:e}),e.commands[f.HIGHLIGHT]=new g({imageEditor:e}),e.commands[f.TEXT]=new u({imageEditor:e}),e.commands[f.LINE]=new s({imageEditor:e}),e.commands[f.ARROW]=new l({imageEditor:e}),e.commands[f.RECTANGLE]=new d({imageEditor:e}),e.commands[f.CIRCLE]=new c({imageEditor:e}),e.activeCommand="",e.elements={container:o},e.centeringDev=null,e.canvas=null,T.end(e.name+" init")},load:function(o){var a=this;return new e((function(e){var n,r,i;if(a.canvas&&a.canvas.dispose(),o){var l=t.createElement("div",{class:"annotation-canvas-centering"});l.inject(o),a.centeringDev=l,a.elements.container.inject(l);var c=o.getSize();r=c.width,i=c.height}n=new p.Canvas(a.elements.container,{width:a.defaultWidth||r,height:a.defaultHeight||i,containerClass:"annotation-canvas-container"}),a.centeringDev&&(a.centeringDev.setStyle("min-width",a.defaultWidth||r),a.centeringDev.setStyle("min-height",a.defaultHeight||i)),a.canvas=n,e(a)}))},destroy:function(){var e=this;e.canvas.dispose(),e.canvas=null,e.commands={},e.elements.container.empty(),e.elements.container.destroy(),e.elements={container:null}},openURL:function(o){var t=this;return new e((function(e,a){i.authenticatedRequest(o,{method:"GET",responseType:"blob",onComplete:function(o){t.loadFile(o).then(e).catch(a)},onFailure:a})}))},openFile:function(){var e=this;return m.uploadImages(!1).then((function(o){return e.loadFile(o[0])}))},loadFile:function(e){var o=this;return m.readImageURI(e).then((function(e){return o.loadURI(e)}))},loadURI:function(o){var t=this;return new e((function(e,a){p.util.loadImage(o,(function(o){if(o){t.canvas.clear(),t.bgImage=o.src;var n=new p.Image(o);t.canvas.setBackgroundImage(n,(function(){t.canvas.setWidth(o.width),t.canvas.setHeight(o.height),t.canvas.renderAll(),e()}),{originX:"left",originY:"top"}),t.centeringDev&&(t.centeringDev.setStyle("min-width",o.width),t.centeringDev.setStyle("min-height",o.height))}else a(new Error("error during image loading."))}))}))},insertImage:function(){var o=this;return m.uploadImages(!1).then((function(e){return m.readImageURI(e[0])})).then((function(t){return new e((function(e,a){p.util.loadImage(t,(function(e){if(e){var t=new p.Image(e,{left:o.canvas.width/2-e.width/2,top:o.canvas.height/2-e.height/2});o.canvas.add(t),o.canvas.renderAll()}else a(new Error("error during image loading."))}))}))}))},capture:function(e,o){var t=this;return t.utils.capture(e).then((function(e){return t.loadURI(e.dataURL,o)}))},save:function(){var e=this;if(e.canvas){var o={dataURL:null,blob:null};return o.dataURL=e.canvas.toDataURL("image/jpeg"),o.blob=e.utils.b64toBlob(o.dataURL),o}throw new Error("canvas not instantiated")},download:function(e){var o,a=this.save();e?o=e:o=(o=(new Date).toLocaleString().replace(",","")+".png").replace(/\s/g,"_");if(window.navigator.msSaveBlob)window.URL.createObjectURL(a.blob),window.navigator.msSaveBlob(a.blob,o);else{var n=t.createElement("a",{id:"download-image"});n.setAttribute("download",o),n.href=a.dataURL;var r=document.createEvent("MouseEvents");r.initEvent("click",!1,!0),n.dispatchEvent(r)}},clear:function(){var o=this;return new e((function(e,t){o.canvas?(o.canvas.clear(),o.bgImage?o.canvas.setBackgroundImage(o.bgImage,(function(){o.canvas.renderAll(),e()}),{originX:"left",originY:"top"}):e()):t(new Error("canvas not instantiated"))}))},selectAll:function(){var e=this,o=e.canvas.getObjects().map((function(e){return e.set("active",!0)})),t=new p.Group(o,{originX:"center",originY:"center"});e.canvas._activeObject=null,e.canvas.setActiveGroup(t.setCoords()).renderAll()},getCommand:function(e){var o=null;return e in this.commands&&(o=this.commands[e]),o},startCommand:function(e,o){var t=this;return t.activeCommand in t.commands&&(t.commands[t.activeCommand].end(),t.activeCommand=""),e in t.commands&&(t.commands[e].start(o),t.activeCommand=e),t},stopCommand:function(){var e=this;return e.activeCommand in e.commands&&(e.commands[e.activeCommand].end(),e.activeCommand=""),e},click:function(e){var o=0,t=0;e&&(o=e.x||0,t=e.y||0),this.canvas.upperCanvasEl.dispatchEvent(new MouseEvent("mousedown",{clientX:o,clientY:t})),document.dispatchEvent(new MouseEvent("mouseup",{clientX:o,clientY:t}))},utils:{hexToRGBA:function(e,o){var t,a;if(/^#([A-Fa-f0-9]{3}){1,2}$/.test(e))return 3===(t=e.substring(1).split("")).length&&(t=[t[0],t[0],t[1],t[1],t[2],t[2]]),a=null==o?0:o,"rgba("+[(t="0x"+t.join(""))>>16&255,t>>8&255,255&t].join(",")+","+a+")";throw new Error("Bad Hex")},RGBAtoHex:function(e){var o={};if(e.startsWith("rgba(")){var t=function(e){return e.replace(/^\s+|\s+$/gm,"")},a=e.substring(e.indexOf("(")).split(","),n=parseInt(t(a[0].substring(1)),10),r=parseInt(t(a[1]),10),i=parseInt(t(a[2]),10),l=parseFloat(t(a[3].substring(0,a[3].length-1)));o.hex="#"+n.toString(16).padStart(2,"0")+r.toString(16).padStart(2,"0")+i.toString(16).padStart(2,"0"),o.opacity=l}else e.startsWith("#")&&(o.hex=e);return o},b64toBlob:function(e){for(var o=atob(e.split(",")[1]),t=new ArrayBuffer(o.length),a=new Uint8Array(t),n=0;n<o.length;n++)a[n]=o.charCodeAt(n);return new Blob([t],{type:"image/jpeg"})},capture:function(o,a){var n,i=this;return(n=a||{timeout:100}).scale=1,new e((function(e){var a=null,l=!1;if(t.is(o.getContext,"function")&&(a=o.getContext("2d"),l=!0),l&&null===a){var c=h.get("pad3DViewer"),s=i.computeImage(c,o),d={canvas:s,dataURL:s.toDataURL("image/jpeg"),blob:null};d.blob=i.b64toBlob(d.dataURL),e(d)}else{(new r).htmlToCanvas(o,n,(function(o){var t={canvas:o,dataURL:o.toDataURL("image/jpeg"),blob:null};t.blob=i.b64toBlob(t.dataURL),e(t)}))}}))},computeImage:function(e,o){var t=e.getViewer(),a=o.width,n=o.height,r={data:null,width:a,height:n},i=document.createElement("canvas");i.width=a,i.height=n,t.renderToTarget(r,e.getViewpoint());var l,c,s,d,u=i.getContext("2d"),v=u.getImageData(0,0,i.width,i.height),g=(r.width-1)/(v.width-1),m=(r.height-1)/(v.height-1),h=r.data,T=v.data;if(1===g&&1===m){var p=v.height,f=4*v.width;for(c=0;c<p;c++)for(s=f*c,d=f*(p-c),l=f;l--;)T[s+l]=h[d+l]}else{var E=function(e,o,t,a,n){return n&&(o=a-o),t*o+e},C=v.height,O=v.width,S=r.height,b=r.width;for(c=0;c<C;c++){var w=Math.floor(m*c);for(l=0;l<O;l++)s=4*E(l,c,O,C),d=4*E(Math.floor(g*l),w,b,S,!0),T[s]=h[d],T[s+1]=h[d+1],T[s+2]=h[d+2],T[s+3]=h[d+3]}}return u.putImageData(v,0,0,0,0,i.width,i.height),i}}});return E.utils=E.prototype.utils,E})),define("DS/2DAnnotation/2DAnnotation",["UWA/Class/View","UWA/Core","UWA/Promise","DS/Logger/Logger","DS/UIKIT/Mask","DS/Windows/ImmersiveFrame","DS/2DAnnotation/views/Toolbar","DS/2DAnnotation/views/Workspace","DS/2DAnnotation/components/ImageEditor","DS/IssueServices/utils/Performance","DS/IssueServices/Contexts","i18n!DS/2DAnnotation/assets/nls/2DAnnotation","css!DS/2DAnnotation/2DAnnotation.css"],(function(e,o,t,a,n,r,i,l,c,s,d){"use strict";var u="ENX3DIR_AP";return e.extend({name:"DS/2DAnnotation/2DAnnotation",tagName:"div",className:"annotation-container",isLoaded:null,_deferred:{resolve:null,reject:null},_logger:null,setup:function(e){var t=this;s.start(t.name+" setup"),t._parent(e),t._logger=a.getLogger(t.name),t.callbacks={saveCallback:e.saveCallback,exitCallback:e.exitCallback},t.imageEditor=new c({}),e.hasOwnProperty("defaultDimensions")&&(o.is(e.defaultDimensions.width,"number")&&(t.imageEditor.defaultWidth=e.defaultDimensions.width),o.is(e.defaultDimensions.height,"number")&&(t.imageEditor.defaultHeight=e.defaultDimensions.height)),t.immersiveFrame=new r,t.immersiveFrame.elements.container.addClassName("annotation-frame-container"),t.workspace=new l({}),t.toolbar=new i(t.immersiveFrame,t.imageEditor,t.callbacks),t.imageURL=e.imageURL,t.captureTarget=e.captureTarget,s.end(t.name+" setup")},render:function(){var e=this;return s.start(e.name+" render"),e.isLoaded=new t((function(o,t){e._deferred.resolve=o,e._deferred.reject=t})),n.mask(e.container),e.imageEditor.load(e.workspace.container).then((function(){var o;return e.imageURL?o=e.openURL(e.imageURL,e.workspace.container):e.captureTarget&&(o=e.capture(e.captureTarget,e.workspace.container)),o})).then((function(){e.immersiveFrame.inject(e.container),e.workspace.render().inject(e.immersiveFrame.getFreeZone()),e.toolbar.render().listen(),e._managePADStatusBarDisplay(!1),n.unmask(e.container),e._deferred.resolve(),s.end(e.name+" render")})).catch(e._deferred.reject),e._addEventListeners(),e},capture:function(e){return this.imageEditor.capture(e,this.workspace.container)},openURL:function(e){return this.imageEditor.openURL(e,this.workspace.container)},destroy:function(){var e=this;e._managePADStatusBarDisplay(!0),e.imageEditor.destroy(),e.imageEditor=null,e.immersiveFrame.destroy(),e.immersiveFrame=null,e.workspace.destroy(),e.workspace=null,e.toolbar.destroy(),e.toolbar=null,e.container.empty(),e.container.destroy()},_managePADStatusBarDisplay:function(e){var o=d.get("widget");if(o&&o.name===u){var t=d.get("pad3DViewer");t&&t.displayStatusBar(e)}},_addEventListeners:function(){var e=this;e.listenTo(e,"onAddNewObject",(function(o){var t=o.data;if(e.toolbar._onToolSelected(t.tool,null,t.options),e.imageEditor.click(),t.select){e.toolbar._onToolSelected("select");var a=e.imageEditor.canvas.getObjects();a&&a[a.length-1]&&e.imageEditor.canvas.setActiveObject(a[a.length-1])}}))}})}));