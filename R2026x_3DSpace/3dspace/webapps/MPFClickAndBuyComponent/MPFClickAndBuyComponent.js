define("DS/MPFClickAndBuyComponent/MarketingPortfolioPage",["UWA/Class/View","UWA/Core","DS/UIKIT/Carousel","DS/UIKIT/Scroller","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],((e,t,i,r)=>{"use strict";return e.extend({className:"mpf-marketing-portfolio",setup(e={}){this._parent(e),this.portfolioInfo=e.portfolioInfo},render(){const e=this._getVideoContainer(),i=t.is(e)?[this._getTagLineContainer(),e,this._getDescription(),this._getCarousel()]:[this._getTagLineContainer(),this._getCarousel(),this._getDescription()],s=t.createElement("div",{class:"mpf-scroll",html:t.createElement("div",{class:"mpf-marketing-content",html:i})});return this.container.setContent(s),new r({element:s}).inject(this.container),this},_getDescription(){return t.createElement("div",{class:"mpf-description",html:this.portfolioInfo.getDescription()})},_getCarousel(){const e=this.portfolioInfo.getDescriptionMedias(),r=e=>"png"===e.split(".").pop();if(e){const s=e.filter(r).map((e=>t.createElement("img",{src:e,width:"350px",height:"200px"})));return t.createElement("div",{class:"mpf-carousel",html:new i({slides:s,slideSelector:"> img",infinite:!1,autoPlay:!1})})}},_getTagLineContainer(){return t.createElement("div",{class:"mpf-tagline",html:this.portfolioInfo.tagLine})},_getVideoContainer(){const e=this.portfolioInfo.descriptionMedias,i=e=>{const t=e.split(".").pop();return"mp4"===t||"webm"===t};if(e){if(e.some(i)){const r=e.filter(i),s=t.createElement("video",{controls:!0,width:"350",html:r.map((e=>({tag:"source",src:e,type:"video/"+e.split(".").pop()})))});return t.createElement("div",{class:"mpf-video",html:s})}}},destroy(){this.stopListening(),this.portfolioInfo=null,this._parent(),this.container=null}})})),define("DS/MPFClickAndBuyComponent/MaintenancePage",["UWA/Class/View","UWA/Core","DS/MPFAmdLazyLoader/AmdLazyLoader","DS/WebappsUtils/WebappsUtils","DS/MPFTracker/Tracker","DS/MPFTracker/Dimension","DS/MPFServices/MarketplaceServices","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],((e,t,i,r,s,n,o)=>{"use strict";return e.extend({className:"mpf-clicknbuy-maintenance",setup(){},async load(){const[e]=await i.getInstance().get(["i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent"]);this.I18n=e},render(){return this.container.setContent([{tag:"img",src:r.getWebappsAssetUrl("MPFClickAndBuyComponent","graphics/pictures")+"/store_down.jpg"},{tag:"div",class:"mpf-maintenance-header",text:this.I18n.get("storeUpdate").toUpperCase()},{tag:"div",class:"mpf-maintenance-disclaimer",text:this.I18n.get("engineersPerformingMaintenance")},{tag:"div",class:"mpf-maintenance-tryagain",text:this.I18n.get("tryAgainLater")}]),this._sendTrackerPage(),this},_sendTrackerPage(){s.createPageBuilder({url:window.location.pathname}).setTitle("MaintenancePage").addDimension(n.MARKETPLACE_SERVICE,o.CLICK_AND_BUY).send()}})})),define("DS/MPFClickAndBuyComponent/ClickAndBuyTracker",["DS/MPFTracker/Tracker","DS/MPFTracker/Category","DS/MPFTracker/Dimension","DS/MPFServices/MarketplaceServices","DS/MPFCartModel/CartModelHelper"],(function(e,t,i,r,s){"use strict";const n=Object.freeze({QUOTE:"quote",CHECKOUT:"checkout",OFFER:"buy"});class o{constructor({service:e}={}){this.service=e||r.CLICK_AND_BUY}trackPage({cart:t,url:r,title:n,portfolioPacks:o,portfolios:a,offerName:c}){const l=e.createPageBuilder({url:r}).setTitle(n).addDimension(i.MARKETPLACE_SERVICE,this.service);return t&&s.addTrackerInformation(l,t),o&&this._addPortfolioPackInformation(l,o),a&&this._addPortfolioInformation(l,a),l.addDimension(i.MARKETPLACE_SERVICE,this.service).addDimension(i.BUYER_TYPE,"company").addDimension(i.OFFER_NAME,c).send()}sendEvent({cart:r,action:n,label:o,value:a,category:c=t.CART}){const l=e.createEventBuilder({category:c,action:n});o&&l.setLabel(o),a&&l.setValue(a),r&&s.addTrackerInformation(l,r),l.addDimension(i.MARKETPLACE_SERVICE,this.service).addDimension(i.BUYER_TYPE,"company").send()}_addPortfolioPackInformation(e,t){const r=t.map((e=>e.getDisplayName())).filter(((e,t,i)=>i.indexOf(e)===t)).join(","),s=t.map((e=>e.getOffers())).map((e=>e.map((e=>e.get("externalOfferId"))))).flat().filter(((e,t,i)=>i.indexOf(e)===t)).join(","),n=0===s.length&&t.map((e=>e.getOffers())).map((e=>e.map((e=>e.get("productNumber"))))).flat().filter(((e,t,i)=>i.indexOf(e)===t)).join(",");e.addDimension(i.EXTERNAL_OFFER_ID,n||s).addDimension(i.EXTERNAL_OFFER_NAME,r)}_addPortfolioInformation(e,t){const r=t.map((e=>e.getProductDisplayName())).filter(((e,t,i)=>i.indexOf(e)===t)).join(","),s=t.map((e=>e.getProductNumber())).filter(((e,t,i)=>i.indexOf(e)===t)).join(","),n=t.map((e=>e.getExternalOfferId())).filter(((e,t,i)=>i.indexOf(e)===t)).join(",");e.addDimension(i.EXTERNAL_OFFER_NAME,r).addDimension(i.EXTERNAL_OFFER_ID,s||n)}}return o.Titles=n,o})),define("DS/MPFClickAndBuyComponent/CnbChatBotStarter",["DS/MPFUrl/UrlUtils"],(function(e){"use strict";return class{static run(){if(!window.HubSpotConversations){const t=e.isSandbox()?"https://engage-qal.itvpc.3ds.com/hs/scriptloader/139877947.js":"https://engage.3ds.com/hs/scriptloader/139786927.js";if(!document.head.querySelector(`script[src="${t}"]`)){const e=document.createElement("script");e.setAttribute("src",t),document.head.appendChild(e)}}}}})),define("DS/MPFClickAndBuyComponent/offerList/OfferTile",["UWA/Class/View","UWA/Core","DS/UIKIT/Input/Button","DS/UIKIT/Input/Number","DS/UIKIT/Popover","DS/MPFServices/ObjectService","DS/MPFPortfolioModel/PortfolioModel","DS/MPFPortfolioModel/PortfolioHelper","DS/MPFTracker/Tracker","DS/MPFTracker/Dimension","DS/MPFTracker/Value","DS/MPFTracker/Category","DS/MPFServices/MarketplaceServices","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],((e,t,i,r,s,n,o,a,c,l,d,h,u)=>{"use strict";const p=Object.freeze({SELECTED:"selected",ADD_TO_CART:"addToCart",QUANTITY_CHANGED:"QuantityChanged",REASSURE_PAYMENT:"ReassurePayment",PAYMENT_MORE_INFO:"PaymentMoreInfo"}),m=Object.freeze({YSC:"YearlySubTypeSelected",QRC:"QuarterlySubTypeSelected",QSC:"QuarterlySubTypeSelected",MSC:"MonthlySubtypeSelected"}),f=e.extend({className:"mpf-offer-tile",domEvents:{click:"_onSelectOffer"},setup(e={}){this._checkPrototypes(e),this.portfolio=e.portfolio,this.I18n=e.I18n,this.locale=e.locale||"en-US",this.selected=!0===e.selected,this.disabled=!0===e.disabled,this.isStudentPortfolio=this._isEduPortfolio(),this.isMakerPortfolio=this._isMakerPortfolio(),this.periodicityContainer=this._createPeriodicityContainer(),this.priceContainer=this._createPriceContainer(),this.addToCartButton=this._createAddToCartButton(),this.quantityInput=this._createQuantityInput(),this.quantityContainer=this._createQuantityContainer(),this.totalPriceContainer=this._createTotalPriceContainer(),this.secureTransactionContainer=this._createSecureTransactionContainer()},render(){const e=[this.periodicityContainer,this.priceContainer];return this.selected?(this.container.addClassName("selected"),this.periodicityContainer.getElement(".fonticon").removeClassName("fonticon fonticon-radiobutton-on").addClassName("fonticon fonticon-status-ok"),this.isStudentPortfolio||(e.push(this.quantityContainer),e.push(this.totalPriceContainer)),e.push(t.createElement("div",{class:"mpf-button",html:this.addToCartButton})),e.push(this.secureTransactionContainer)):(this.container.removeClassName("selected"),this.periodicityContainer.getElement(".fonticon").removeClassName("fonticon fonticon-status-ok").addClassName("fonticon fonticon-radiobutton-on")),this.portfolio.has("fullPrice")?this.container.addClassName("full-price"):this.container.removeClassName("full-price"),this.disabled?this.container.addClassName("disabled"):this.container.removeClassName("disabled"),this.container.setContent(e),this},isDisabled(){return!0===this.disabled},isSelected(){return!0===this.selected},select(){this.selected=!0,this.render()},deselect(){this.selected=!1,this.render()},_createSecureTransactionContainer(){const e=t.createElement("span",{class:"fonticon fonticon-lock"}),r=new i({className:"link",value:this.I18n.get("secureTransaction"),events:{onClick:()=>{c.createEventBuilder({category:h.OFFER,action:p.REASSURE_PAYMENT}).addDimension(l.MARKETPLACE_SERVICE,u.CLICK_AND_BUY).send()}}}),n=t.createElement("div",{class:"mpf-popoverContent",html:[t.createElement("div",{class:"mpf-secureTransactionPopover",text:this.I18n.get("secureTransactionPopover")}),new i({className:"link",value:this.I18n.get("moreInformation"),events:{onClick:()=>{c.createEventBuilder({category:h.OFFER,action:p.PAYMENT_MORE_INFO}).addDimension(l.MARKETPLACE_SERVICE,u.CLICK_AND_BUY).send(),window.open("https://discover.3ds.com/privacy-policy","_blank")}}})]}),o=t.createElement("div",{class:"mpf-secure-transaction",html:[e,r]});return new s({className:"mpf-secure-transaction-popover",target:r.getContent(),position:"right",allowedPositions:["right"],trigger:"touch",title:this.I18n.get("secureTransaction"),body:n}),o},_isEduPortfolio(){return a.isEduOffer(this.portfolio)},_isMakerPortfolio(){return a.isMakerOffer(this.portfolio)},_createQuantityContainer(){const e=this.portfolio.isCreditOffer()?this.I18n.get("quantityOfCredits"):this.I18n.get("numberOfUsers");return t.createElement("div",{class:"mpf-offer-quantity",html:[t.createElement("div",{class:"mpf-offer-quantity-label",text:e}),this.quantityInput]})},_createQuantityInput(){return new r({min:this.portfolio.isCreditOffer()?2500:1,step:1,max:this.isMakerPortfolio?5:99999,decimalPrecision:1,events:{onChange:this._updateTotalPrice.bind(this)}})},_updateTotalPrice(){if(t.is(this.quantityInput)){const e=parseInt(this.quantityInput.getValue()),t=c.createEventBuilder({category:h.OFFER,action:p.QUANTITY_CHANGED}).addDimension(l.MARKETPLACE_SERVICE,u.CLICK_AND_BUY);Number.isNaN(e)?(this.quantityInput.setValue(1),t.addPersonalValue(d.QUANTITY,1)):(t.addPersonalValue(d.QUANTITY,e),this.totalPriceContainer=this._createTotalPriceContainer(),this.render()),t.send()}},_createAddToCartButton(){return new i({className:"primary",value:this.I18n.get("addToCart"),events:{onClick:this._onAddToCart.bind(this)}})},_onAddToCart(){const e=parseInt(this.quantityInput.getValue(),10);this.dispatchEvent(p.ADD_TO_CART,{portfolio:this.portfolio,quantity:e});const t=c.createEventBuilder({category:h.OFFER,action:p.ADD_TO_CART}).addDimension(l.MARKETPLACE_SERVICE,u.CLICK_AND_BUY).addPersonalValue(d.QUANTITY,e);a.addTrackerInformation(t,this.portfolio),t.send()},_onSelectOffer(){if(!this.disabled&&!this.selected){this.dispatchEvent(p.SELECTED,this);const e=c.createEventBuilder({category:h.OFFER,action:m[this.portfolio.getLicensingScheme()]||p.SELECTED}).addDimension(l.MARKETPLACE_SERVICE,u.CLICK_AND_BUY);a.addTrackerInformation(e,this.portfolio),e.send()}},_createTotalPriceContainer(){const e=(t.is(this.quantityInput)?this.portfolio.getPricelistPrice()*parseInt(this.quantityInput.getValue()):this.portfolio.getPricelistPrice()).toLocaleString(this.locale,{style:"currency",currency:this.portfolio.getPricelistCurrency()}),i=this.portfolio.get("licensingScheme");let r="";return i===o.RevTypes.YSC?r=this.I18n.get("paidYearly"):i===o.RevTypes.MSC?r=this.I18n.get("paidMonthly"):i!==o.RevTypes.QSC&&i!==o.RevTypes.QRC||(r=this.I18n.get("paidQuarterly")),t.createElement("div",{class:"mpf-total-price",html:[t.createElement("div",{class:"mpf-total-price-value",text:this.I18n.get("totalPrice")+": "+e}),t.createElement("div",{class:"mpf-total-price-tax",text:this.I18n.get("excludingTax")+", "+r})]})},_createPeriodicityContainer(){let e,i;if(this.portfolio.isCreditOffer())i=this.I18n.get("yearlyCredits");else{const r=this.portfolio.get("licensingScheme");r===o.RevTypes.YSC?e=this.isStudentPortfolio?this.I18n.get("oneYear"):this.I18n.get("yearly"):r===o.RevTypes.MSC?e=this.I18n.get("monthly"):r!==o.RevTypes.QSC&&r!==o.RevTypes.QRC||(e=this.I18n.get("quarterly")),i=this.isStudentPortfolio?e:this.I18n.get("typeOfSubscription",{period:t.createElement("span",{text:e}).outerHTML})}return t.createElement("div",{class:"mpf-type-name",html:[this._createFonticon(),i]})},_createFonticon(){let e;return e=this.selected?"fonticon fonticon-status-ok":"fonticon fonticon-radiobutton-on",t.createElement("span",{class:e})},_createPriceContainer(){const e=this.portfolio.getPricelistPrice().toLocaleString(this.locale,{style:"currency",currency:this.portfolio.getPricelistCurrency()}),i=this.portfolio.has("fullPrice"),r=[t.createElement("div",{class:"mpf-price-value",text:e})],s=this.portfolio.isDisplayingPrice();if(i&&s){const e=this.portfolio.get("fullPrice").toLocaleString(this.locale,{style:"currency",currency:this.portfolio.getPricelistCurrency()}),i=t.createElement("div",{class:"mpf-full-price",text:e});r.unshift(i)}return t.createElement("div",{class:"mpf-price",html:r})},_checkPrototypes(e){n.requiredOfPrototype(e.portfolio,o,"options.portfolio must be a PortfolioModel")},destroy(){this.stopListening(),this.portfolio=null,this.I18n=null,this._parent(),this.container=null},_createTrackerEventBuilder:e=>new c.createEventBuilder({category:h.OFFER,action:p.QUANTITY_CHANGED})});return f.Events=p,f})),define("DS/MPFClickAndBuyComponent/orderList/OfferItemsModal",["UWA/Core","UWA/Class/View","DS/UIKIT/Modal","DS/UIKIT/Input/Button","DS/UIKIT/Scroller","DS/MPFServices/ObjectService","DS/MPFPortfolioModel/compass/CompassPortfolioCollection"],(function(e,t,i,r,s,n,o){"use strict";const a=Object.freeze({}),c=t.extend({className:"mpf-offer-items-modal",setup({compassPortfolios:e}={}){n.requiredOfPrototype(e,o,"compassPortfolios must be a CompassPortfolioCollection"),this.compassPortfolios=e,this.modal=new i,this.scroller=new s},render(){return this.modal.inject(this.container),this},show({I18n:e,portfolio:t}){const i=this._setBody(e,t);this.modal.setHeader(this._setHeader(e)),this.modal.setBody(new s({element:i})),this.modal.setFooter(this._setFooter(e)),this.modal.show()},hide(){this.modal.hide()},destroy(){this.modal.destroy(),this.modal=null,this.compassPortfolios=null,this._parent(),this.container=null},_renderItem({item:e,I18n:t}){const i=this.compassPortfolios.getWithTrigram(e.productTrigram.split("-")[0]);return{tag:"div",class:"mpf-bundle-product",html:[{tag:"span",class:"mpf-product-name",text:e.productDisplayName},{tag:"div",class:"mpf-product-number",text:t.get("productNumber")+" "+e.productNumber},{tag:"span",class:"mpf-product-description",html:i&&i.getTagLine()}]}},_setHeader:t=>e.createElement("h4",{text:t.get("includedItems")}),_setBody(t,i){return e.createElement("div",{class:"mpf-offer-items-list",html:i.getSoftwareOfferDetails().map((e=>this._renderItem({item:e,I18n:t})))})},_setFooter(e){return new r({className:"primary",value:e.get("ok"),events:{onClick:this.hide.bind(this)}})}});return c.Events=a,c})),define("DS/MPFClickAndBuyComponent/CnbLanguageHelper",["DS/MPFServices/ObjectService","DS/MPFAmdLazyLoader/AmdLazyLoader"],(function(e,t){"use strict";const i=["en","fr","de","es","cs","it","ja","ko","pl","pt-BR","ru","zh","zh-TW"];return class{static defineI18nLanguage(t){e.requiredOfType(t,"string","argument must be a string"),requirejs&&requirejs.s&&requirejs.s.contexts&&requirejs.s.contexts._&&(requirejs.s.contexts._.defined&&requirejs.s.contexts._.defined.i18n&&(requirejs.s.contexts._.defined.i18n.locale=t),requirejs.s.contexts._.config&&(requirejs.s.contexts._.config.locale=t,requirejs.s.contexts._.config.config&&requirejs.s.contexts._.config.config.i18n&&(requirejs.s.contexts._.config.config.i18n.locale=t)))}static getI18nLanguage(){try{return requirejs.s.contexts._.defined.i18n.locale||requirejs.s.contexts._.config.locale||requirejs.s.contexts._.config.config.i18n.locale}catch(e){console.error(e)}}static loadLanguageFiles(e,{allowCache:r=!0}={}){if(!Array.isArray(e))throw new Error('Expected array with file names with "i18n!" prefix');if(!r){let t;e.map((e=>{if(e.startsWith("i18n!"))return e.split("i18n!")[1];throw new Error("Please pass file names with i18n! prefix")})).forEach((e=>{requirejs.undef(e)})),e.forEach((e=>{requirejs.undef(e)}));try{t=Object.keys(requirejs.s.contexts._.defined.i18n.getSupportedLanguages())}catch(e){console.error(e),t=i}t.forEach((e=>{e=e.split("-")[0],requirejs.undef("DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent_"+e)}))}return t.getInstance().get(e)}}})),define("DS/MPFClickAndBuyComponent/orderList/SecureTransaction",["UWA/Class/View","UWA/Core","DS/UIKIT/Popover","DS/MPFServices/ObjectService","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],((e,t,i,r)=>{"use strict";const s=Object.freeze({MORE_INFO_CLICKED:"moreInfoClicked",SECURE_TRANSACTION_CLICKED:"secureTransactionClicked"}),n=e.extend({className:"mpf-secure-transaction",setup(e={}){r.requiredOfType(e.moreInformationLink,"string","options.moreInformationLink must be a string"),this.moreInformationLink=e.moreInformationLink,this.lockIcon=this._getLockIcon()},render({I18n:e}){const t=[this.lockIcon,this._getPopover({I18n:e})];return this.container.setContent(t),this},_getLockIcon:()=>t.createElement("span",{class:"fonticon fonticon-lock"}),_getPopover({I18n:e}){const r=t.createElement("a",{class:"mpf-secure-transaction-title",text:e.get("secureTransaction"),events:{click:()=>{this.dispatchEvent(s.SECURE_TRANSACTION_CLICKED)}}}),n=t.createElement("div",{class:"fonticon fonticon-info"}),o=t.createElement("a",{text:e.get("moreInformation"),href:this.moreInformationLink,target:"_blank",events:{click:()=>{this.dispatchEvent(s.MORE_INFO_CLICKED)}}});return new i({target:r,position:"left",trigger:"touch",title:e.get("secureTransaction"),body:[{text:e.get("secureTransactionPopover")},{tag:"div",class:"more-information",html:[n,o]}]}),r},destroy(){this._parent(),this.container=null}});return n.Events=s,n})),define("DS/MPFClickAndBuyComponent/ClickAndBuyCartHelper",["UWA/Core","DS/PlatformAPI/PlatformAPI","DS/MPFDataProxy/NoDataProxy","DS/MPFCartModel/CartPatchArray","DS/MPFCartModel/CartPatchOperation","DS/MPFCartModel/CartFactory","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartItemModel","DS/MPFCouponModel/CouponCreationModel","DS/MPFPspModel/PspModel","DS/MPFPortfolioModel/PortfolioHelper","DS/MPFPortfolioModel/PortfolioFactory","DS/MPFUtils/MPFUtils","DS/MPFUrl/UrlUtils","DS/MPFError/ValidationError"],((e,t,i,r,s,n,o,a,c,l,d,h,u,p,m)=>{"use strict";const f={},g=Object.freeze({EDU_NON_EDU:"eduNonEduProducts",MAKERS_NON_MAKERS:"makersNonMakersProducts",EDU_IN_CART:"eduProductAlreadyInCart",BE_NON_BE:"businessExperienceNonBusinessExperienceProducts"}),C=Object.freeze({MpfCartUpdated:"MpfCartUpdated"});function P(e){const i=[],r=e.getItems().filter((e=>{let t=!0;const r=e.getOfferId();return r&&(i.includes(r)?t=!1:i.push(r)),t})).reduce(((e,t)=>e+=parseInt(t.getQuantity())),0);t.publish(C.MpfCartUpdated,{nbItems:r})}return f.saveSubscriptionAndPreReq=function(t,i,r,s){const n=t.getItems(),o=u.findInArray(n,(e=>!e.getOfferId()&&e.getSkuId()===i.get("skuid")));return e.is(o)?o.setQuantity(parseInt(o.getQuantity())+parseInt(r)):n.push(f.getSubscriptionOp(t,i,r)),s.forEach((r=>{const s=u.findInArray(n,(e=>!e.getOfferId()&&e.getSkuId()===r.skuid));e.is(s)?s.setQuantity(parseInt(r.quantity)):n.push(f.getPreReqOp(t,i,r))})),t.setItems(n),P(t),Promise.resolve(t)},f.getSubscriptionOp=function(e,t,r){const s={[a.Fields.OFFER_ID]:"",[a.Fields.SKU_ID]:t.get("skuid"),[a.Fields.LICENSING]:t.get("licensing"),[a.Fields.LICENSING_SCHEME]:t.get("licensingScheme"),[a.Fields.PRODUCT_DISPLAY_NAME]:t.getProductDisplayName(),[a.Fields.PRODUCT_TRIGRAM]:t.get("productTrigram"),[a.Fields.PRODUCT_NUMBER]:t.get("productNumber"),[a.Fields.ACTION]:e.getActionType()||o.ActionTypes.START,[a.Fields.UNIT_NET_AMOUNT]:t.getPricelistPrice().toString(),[a.Fields.TYPE]:e.get(o.Fields.TYPE)||o.Types.SOFTWARE_REQUEST,[a.Fields.QUANTITY]:parseInt(r),[a.Fields.TEMP_UUID]:u.generateUUID()};return new a(s,{dataProxy:i.getInstance(),parse:!0})},f.getPreReqOp=function(e,t,r){const s={[a.Fields.OFFER_ID]:"",[a.Fields.SKU_ID]:r.skuid,[a.Fields.LICENSING]:r.licensing,[a.Fields.LICENSING_SCHEME]:r.licensingScheme,[a.Fields.PRODUCT_DISPLAY_NAME]:r.productDisplayName,[a.Fields.PRODUCT_TRIGRAM]:r.productTrigram,[a.Fields.PRODUCT_NUMBER]:r.productNumber,[a.Fields.ACTION]:e.getActionType()||o.ActionTypes.START,[a.Fields.UNIT_NET_AMOUNT]:r.pricelist[0].price.toString(),[a.Fields.TYPE]:e.get(o.Fields.TYPE)||o.Types.SOFTWARE_REQUEST,[a.Fields.QUANTITY]:parseInt(r.quantity),[a.Fields.TEMP_UUID]:u.generateUUID()};return new a(s,{dataProxy:i.getInstance(),parse:!0})},f.patchCartAndItems=function(e,t,{country:i}){if(e.isRenewal())return Promise.resolve();const n=new r;n.addOperation(s.Operations.MODIFY,"/",{[o.Fields.COUNTRY]:i});const c=e.getItems(),l=[];if(c.forEach((e=>{let t;e.isNew()?l.push(e):t=new s(s.Operations.MODIFY,"/cart-items/"+e.id,{[a.Fields.QUANTITY]:e.getOfferId()?parseInt(e.getOfferQuantity()):parseInt(e.getQuantity())}),n.add(t)})),l.length>0&&n.addAll(f.getNewItemsPatchOperations(l,t)),e.hasPendingChanges(e.pick(o.Fields.COUPON_SOFTWARE))){const t={[o.Fields.COUPON_SOFTWARE]:!!e.getCouponSoftware()&&e.getCouponSoftware().getCommercialName()||"",[a.Fields.TEMP_UUID]:u.generateUUID()};n.addOperation(s.Operations.MODIFY,"/",t)}return 0===n.getOperations().length?Promise.resolve():e.megaPatch(n).then(P.bind(this,e))},f.removeItem=function(e,t){if(e.isNew()||t.isNew()){const i=e.getItems().filter((e=>e.getProductTrigram()!==t.getProductTrigram()));return e.setItems(i),P(e),Promise.resolve(e)}{const i=new r,n=new s(s.Operations.REMOVE,"/cart-items/"+t.get("id"));i.add(n);const o={onPassportError(e,t){console.error(e),window.location.href=t.replace("/logout","")+"/login?service="+encodeURIComponent(window.location.href)}};return e.megaPatch(i,o).then(P.bind(this,e))}},f.addOffer=function(t,r,s){const n=t.getItems().filter((e=>e.getOfferId()!==r.getId()));return r.getSoftwareOfferDetails().forEach(((c,l)=>{const d=u.findInArray(t.getItems(),(e=>e.getOfferId()===r.getId()&&e.getProductTrigram()===c.productTrigram));if(e.is(d)){const e=d.getQuantity()+parseInt(s)*c.quantity,t=d.getOfferQuantity()+parseInt(s);d.set({[a.Fields.QUANTITY]:e,[a.Fields.OFFER_QUANTITY]:t}),n.push(d)}else{const e={[a.Fields.TITLE]:r.getProductDisplayName(),[a.Fields.EXTERNAL_OFFER_ID]:r.get("externalOfferId"),[a.Fields.OFFER_ID]:r.getId(),[a.Fields.LICENSING]:r.get("licensing"),[a.Fields.LICENSING_SCHEME]:r.getLicensingScheme(),[a.Fields.PRODUCT_DISPLAY_NAME]:c.productDisplayName,[a.Fields.PRODUCT_TRIGRAM]:c.productTrigram,[a.Fields.PRODUCT_NUMBER]:c.productNumber,[a.Fields.ACTION]:t.getActionType()||o.ActionTypes.START,[a.Fields.UNIT_NET_AMOUNT]:0===l?r.getPricelistPrice():0,[a.Fields.TOTAL_NET_AMOUNT]:0===l?r.getPricelistPrice()*parseInt(s):0,[a.Fields.DISPLAY_PRICE]:!1,[a.Fields.TYPE]:t.get(o.Fields.TYPE)||o.Types.SOFTWARE_REQUEST,[a.Fields.OFFER_QUANTITY]:parseInt(s),[a.Fields.QUANTITY]:parseInt(c.quantity)*parseInt(s),[a.Fields.TEMP_UUID]:u.generateUUID()};n.push(new a(e,{dataProxy:i.getInstance(),parse:!0}))}})),t.setItems(n),P(t),Promise.resolve(t)},f.removeItems=function(e,t){if(e.isNew()){const i=e.getItems();for(let e=i.length-1;e>=0;--e){const r=i[e];t.indexOf(r)>-1&&i.splice(e,1)}return e.setItems(i),P(e),Promise.resolve(e)}return f.removeItem(e,t[0])},f.getConflictingItems=function(e,t){const i=d.isEduOffer(t),r=d.isMakerOffer(t);let s,n=[];const o=e.getItems(),a=o.filter((e=>e.isEduItem()!==i)),c=o.filter((e=>e.isMakerItem()!==r));if(a.length>0)s=r?g.MAKERS_NON_MAKERS:g.EDU_NON_EDU,n=a;else if(c.length>0)s=i?g.EDU_NON_EDU:g.MAKERS_NON_MAKERS,n=c;else if(i){const e=t.getId();n=o.filter((t=>t.getOfferId()===e)),n.length>0&&(s=g.EDU_IN_CART)}return{conflictingItems:n,conflictType:s}},f.loadCartItemPortfolios=async function({cart:e,country:t,portfolioFactory:i,needAllLicensingSchemes:r}){const[s,n]=function(e){const t=e.getItems(),i=[],r=[];for(let e=0;e<t.length;++e){const s=t[e],n=s.getOfferId();n?r.find((e=>e.getOfferId()===n))||r.push(s):i.find((e=>e.getProductTrigram()===s.getProductTrigram()&&e.getLicensingScheme()===s.getLicensingScheme()))||i.push(s)}return[i,r]}(e);let o=[],a=[];try{if(r){let e;e=await Promise.all(s.map((async e=>{const r=i.createPackCollection(h.Types.BY_TRIGRAM_V2);return r.productTrigram=d.addProductSuffix(e.getProductTrigram()),await r.fetchPromise({country:t}),r.first().getOffers()}))),e.forEach((e=>e.forEach((e=>{o.push(e)}))));let r=await Promise.all(n.map((async e=>i.createModel(h.Types.SOFTWARE_OFFER,{id:e.getOfferId()}).fetchPromise({country:t}))));e=await Promise.all(r.map((e=>{const r=i.createPackCollection(h.Types.BY_NAME);return r.searchName=e.getMidMarketPromotionName(),r.fetchPromise({country:t})}))),e.forEach((e=>{e.first().getOffers().forEach((e=>{a.push(e)}))}))}else o=await Promise.all(s.map((async e=>{const r=i.createPackCollection(h.Types.BY_TRIGRAM_V2);return r.productTrigram=d.addProductSuffix(e.getProductTrigram()),await r.fetchPromise({country:t}),r.first().getOffers().find((t=>t.getLicensingScheme()===e.getLicensingScheme()))}))),a=await Promise.all(n.map((e=>i.createModel(h.Types.SOFTWARE_OFFER,{id:e.getOfferId()}).fetchPromise({country:t}))))}catch(e){console.error(e),o=[],a=[]}return i.createCollection(h.Types.PORTFOLIO,[...o,...a])},f.filterCommonLicensingSchemesPortfolios=function({portfolios:e,portfolioFactory:t,offers:i}){let r,s=[],n=[],o="";i.forEach((t=>{t.skuId?(o=t.items[0].getProductTrigram(),n.includes(o)||n.push(o)):(r=e.find((e=>e.getId()===t.offerId)).getGroupId(),s.includes(r)||s.push(r))})),e=e.filter((e=>n.includes(e.getProductTrigram())||s.includes(e.getGroupId())));let a={YSC:0,MSC:0,QSC:0},c=[];const l=e.filter((e=>e.isCreditOffer()));(e=e.filter((e=>!e.isCreditOffer()))).forEach((e=>{const t="QRC"===e.getLicensingScheme()?"QSC":e.getLicensingScheme();a[t]++}));const d=Math.max.apply(null,Object.values(a));return Object.keys(a).forEach((e=>{a[e]===d&&c.push(e)})),c.includes("QSC")&&c.push("QRC"),e=e.filter((e=>c.includes(e.getLicensingScheme()))),l.length>0&&l.forEach((t=>e.push(t))),t.createCollection(h.Types.PORTFOLIO,e)},f.getNewItemsPatchOperations=function(e,t){const i=[];return e.filter((e=>{const t=e.getOfferId();return(!t||i.indexOf(t)<0)&&(i.push(t),!0)})).map((e=>{let i;const r=e.getOfferId(),n=e.getSkuId();i=r?t.find((e=>e.get("id")===r)):t.find((e=>e.getSkuId()===n));const c={},l=s.Operations.ADD;return c[a.Fields.OFFER_ID]=r,c[a.Fields.SKU_ID]=n,c[a.Fields.LICENSING]=i.getLicensing(),c[a.Fields.LICENSING_SCHEME]=i.getLicensingScheme(),c[a.Fields.PRODUCT_DISPLAY_NAME]=i.getProductDisplayName(),c[a.Fields.PRODUCT_TRIGRAM]=i.getProductTrigram(),c[a.Fields.PRODUCT_NUMBER]=i.getProductNumber(),c[a.Fields.ACTION]=o.ActionTypes.START,c[a.Fields.UNIT_NET_AMOUNT]=i.getPricelistPrice().toString(),c[a.Fields.TYPE]=o.Types.SOFTWARE_REQUEST,c[a.Fields.QUANTITY]=parseInt(r?e.getOfferQuantity():e.getQuantity(),10),c[a.Fields.TEMP_UUID]=u.generateUUID(),new s(l,"/cart-items",c)}))},f.hasMakerItemsExceededLimit=function(e,t={quantity:0}){if(e.hasMakerItems()){const i=[];return e.getItems().filter((e=>{if(e.isMakerItem()){const t=e.getOfferId();return!i.includes(t)&&(i.push(t),!0)}return!1})).reduce(((e,t)=>e+parseInt(t.getQuantity())),0)+t.quantity>5}return!1},f.saveCartAndItems=function(e,t,i){const c=new r,l=f.getNewItemsPatchOperations(e.getItems(),t);if(c.addAll(l),e.hasPendingChanges(e.pick(o.Fields.COUPON_SOFTWARE))){const t={[o.Fields.COUPON_SOFTWARE]:!!e.getCouponSoftware()&&e.getCouponSoftware().getCommercialName()||"",[a.Fields.TEMP_UUID]:u.generateUUID()};c.addOperation(s.Operations.MODIFY,"/",t)}const d=t.first(),h=d.getCurrency()||d.getPricelistCurrency(),m=new p(window.location.href).getValueParameter("partnerId")||"";return e.set({[o.Fields.PARTNER_ID]:m,[o.Fields.ONLINE_INSTANCE]:"",[o.Fields.CURRENCY]:h,[o.Fields.STATE]:o.States.DRAFT,legalEntityId:d.getCompanyId(),licensorId:d.getLicensorId(),type:o.Types.SOFTWARE_REQUEST,isSelfOrder:!0}),e.savePromise(void 0,i).then((()=>{const t=new n(e.dataProxy.connector);return e.dataProxy=t.getDataProxy(n.Types.CART),e.id=e.get("id"),e.megaPatch(c)})).then(P.bind(this,e))},f.calculateTotalPrices=function(e,t,i){const r=[],s=i&&parseInt(i.getPercentage());let n={oldPrice:0,newPrice:0};return e.forEach((e=>{const o=e.getOfferId();if(o){if(!r.includes(o)){const a=t.find((e=>e.get("id")===o));n.oldPrice+=e.getOfferQuantity()*a.getPricelistPrice(),i&&i.getOfferPids().includes(o)?n.newPrice+=e.getOfferQuantity()*a.getPricelistPrice()*(1-s/100):n.newPrice+=e.getOfferQuantity()*a.getPricelistPrice(),r.push(o)}}else{const r=t.find((t=>t.getSkuId()===e.getSkuId()));n.oldPrice+=e.getQuantity()*r.getPricelistPrice(),i&&i.getProductSkuIds().includes(e.getSkuId())?n.newPrice+=e.getQuantity()*r.getPricelistPrice()*(1-s/100):n.newPrice+=e.getQuantity()*r.getPricelistPrice()}})),n},f.checkCartMaxChargeCompliance=async function({cart:e,portfolios:t,psp:i,service:r,country:s,redirectUrlParam:n}){const o=t.at(0);await i.fetchPromise({service:r,country:s,licensorId:o.getLicensorId(),currency:o.getPricelistCurrency()||o.getCurrency(),onPassportError(e,t){console.error(e);const i=window.location.pathname.includes("welcome/cart")?window.location.origin+"/welcome/compass-world/3dexperience-collaborative-innovation/3dswymer/buy/cart"+window.location.search:window.location.href,r=new URL(i);n&&r.searchParams.append(n.key,n.value),window.location.href=t.replace("/logout","")+"/login?service="+encodeURIComponent(r.toString())+"&theme=clicknbuy"}});const a=i.get(l.Fields.MAX_CHARGE_AMOUNT),c=this.calculateTotalPrices(e.getItems(),t,e.getCouponSoftware()).newPrice;if(a&&c>parseFloat(a))throw new m("Maximum charge exceeded",{errorCode:"MaxChargeExceeded"})},f.removeAndAddItems=async function({cart:e,portfolios:t,itemsToBeReplaced:i}){const n=new r,o={onPassportError(e,t){console.error(e),window.location.href=t.replace("/logout","")+"/login?service="+encodeURIComponent(window.location.href)}};let a=!1,c=[],l=[],d=[];return e.getItems().forEach((t=>{const r=t.getOfferId(),o=i.find((e=>t===e.itemToRemove||Array.isArray(e.itemToRemove)&&e.itemToRemove.includes(t)));if(o)if(e.isNew())r&&!d.includes(r)?c.push(...o.itemToAdd):r||c.push(o.itemToAdd);else{let e=o.itemToRemove;if(r&&(e=o.itemToRemove[0]),!e.isNew()&&(!r||r&&!d.includes(r))){const t=new s(s.Operations.REMOVE,"/cart-items/"+e.get("id"));n.add(t),a=!0}r?l.push(...o.itemToAdd):l.push(o.itemToAdd)}else c.push(t),!e.isNew()&&t.isNew()&&l.push(t);r&&!d.includes(r)&&d.push(r)})),l.length>0&&(n.addAll(f.getNewItemsPatchOperations(l,t)),a=!0),a?await e.megaPatch(n,o):e.setItems(c),P(e),Promise.resolve(e)},f.ConflictTypes=g,f.Events=C,f})),define("DS/MPFClickAndBuyComponent/orderList/EmptyCartComponent",["UWA/Class/View","DS/UIKIT/Input/Button"],(function(e,t){"use strict";const i=Object.freeze({ADD_ITEMS:"addItems"}),r=e.extend({className:"mpf-empty-cart-component",setup(){this.addItemsButton=this._createAddItemsButton()},render({I18n:e}){return this.container.setContent([{tag:"div",class:"mpf-icon fonticon fonticon-shopping-cart"},{tag:"div",class:"mpf-message",text:e.get("yourCartIsEmpty")},this.addItemsButton.setValue(e.get("addItems"))]),this},destroy(){this._parent(),this.container=null},_createAddItemsButton(){return new t({className:"primary",events:{onClick:this.dispatchEvent.bind(this,i.ADD_ITEMS)}})}});return r.Events=i,r})),define("DS/MPFClickAndBuyComponent/ErrorPage",["UWA/Class/View","DS/MPFAmdLazyLoader/AmdLazyLoader"],(function(e,t){"use strict";const i=Object.freeze({OFFER_NOT_FOUND:"offerNotFound",RENEWAL_EXPIRED:"error.renewallinkexpired",UNAVAILABLE_IN_COUNTRY:"unavailableInCountry",DEFAULT:"default"}),r=e.extend({className:"mpf-error-page",setup({error:e}={}){this.error=e||i.DEFAULT},async load(){[this.I18n]=await t.getInstance().get(["i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent"])},setError(e){this.error=e},render({I18n:e,error:t}={}){return e&&(this.I18n=e),t&&(this.error=t),this.container.setContent([{tag:"div",class:"mpf-icon fonticon fonticon-"+this._getIconClassName(this.error)},{tag:"div",class:"mpf-error-message",html:this._getMessage()}]),this},destroy(){this._parent(),this.container=null},_getIconClassName(e){let t;switch(e){case i.OFFER_NOT_FOUND:t="help";break;case i.UNAVAILABLE_IN_COUNTRY:t="globe-location";break;default:t="attention"}return t},_getMessage(){let e;switch(this.error){case i.OFFER_NOT_FOUND:e=this.I18n.get("offerNotFoundMessage");break;case i.RENEWAL_EXPIRED:e=this.I18n.get("errorRenewalExpired",{link:"https://www.3ds.com/store/audiences"});break;case i.UNAVAILABLE_IN_COUNTRY:e=this.I18n.get("unavailableInCountryMessage");break;default:e=[{text:this.I18n.get("defaultErrorMessage1")},{text:"- "+this.I18n.get("defaultErrorMessage2")},{html:"- "+this.I18n.get("defaultErrorMessage3",{link:"https://www.3ds.com/online-store/support-form/"})}]}return e}});return r.Errors=i,r})),define("DS/MPFClickAndBuyComponent/orderList/CustomNumberInput",["DS/UIKIT/Input/Number"],(function(e){"use strict";const t=Object.freeze({UPDATE:"update"}),i=e.extend({init({isCreditCount:e,I18n:t,...i}){this.isCreditCount=e,this.I18n=t,this._parent({...i})},setValue(e){const t=parseInt(this.getValue());return this.syncInput({newValue:e}),t!==e&&this.dispatchOnChange(),this},syncInput({newValue:e}={}){const t=e;if(!(!t||t<1)){const e=this.options.decimalPrecision;let i=Math.round(this.parseInput(t)*e)/e;if(i>this.options.max)return this.setValue(this.options.max);if(i<this.options.min||isNaN(i))return this.setValue(this.options.min);this.elements.input.value=i+this._addUserOrCredit(i)}},setFocus(e){return this._parent(e),e?(this.previousValue=!!this._getIntegerValue()&&this._getIntegerValue(),this.elements.input.value=""):this._getIntegerValue()||(this.elements.input.value=this.previousValue+this._addUserOrCredit(this.previousValue)),this},_getIntegerValue(){return parseInt(this.elements.input.value)},_addUserOrCredit(e){return this.isCreditCount?" "+this.I18n.get("credits"):1===e?" "+this.I18n.get("user"):" "+this.I18n.get("users")}});return i.Events=t,i})),define("DS/MPFClickAndBuyComponent/PreReqTableLineComponent",["UWA/Class/View","DS/UIKIT/Input/Number","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],((e,t)=>{"use strict";return e.extend({tagName:"tr",className:"mpf-item-order",setup(e={}){this._parent(e),this.locale=e.locale||"en-US",this.preReq=e.preReq,this.initialQuantity=e.initialQuantity,this.isQuantityInputDisabled=!0===e.isQuantityInputDisabled,this.preReq.quantity=this.initialQuantity},render({I18n:e}){const i=parseFloat(this.preReq.pricelist[0].monthlyDisplay).toLocaleString(this.locale,{style:"currency",currency:this.preReq.pricelist[0].currency});let r=parseFloat(this.preReq.pricelist[0].monthlyDisplay);r=this.preReq.quantity*r;const s=r.toLocaleString(this.locale,{style:"currency",currency:this.preReq.pricelist[0].currency});return this.container.setContent([{tag:"td",class:"mpf-product-name",text:this.preReq.productDisplayName},{tag:"td",class:"mpf-order-price",text:e.get("unitPricePerUserPerMonth",{price:i})},{tag:"td",class:"mpf-order-quantity",html:new t({value:this.preReq.quantity,min:1,max:99999,step:1,decimalPrecision:1,disabled:this.isQuantityInputDisabled,events:{onChange:t=>{const i=parseInt(t.target.value);i!==this.preReq.quantity&&(Number.isNaN(i)?this.preReq.quantity=this.initialQuantity:this.preReq.quantity=i,this.render({I18n:e}))}}})},{tag:"td",class:"mpf-price",text:e.get("unitPricePerMonth",{price:s})}]),this},destroy(){this.preReq=null,this._parent(),this.container=null}})})),define("DS/MPFClickAndBuyComponent/orderList/CouponInput",["UWA/Class/View","UWA/Core","DS/UIKIT/Input/Button","DS/UIKIT/Input/Text"],(function(e,t,i,r){"use strict";const s=Object.freeze({APPLY_COUPON:"applyCoupon",CLEAR_COUPON:"clearCoupon"}),n=e.extend({className:"mpf-coupon-input",domEvents:{keyup:"_onKeyUp"},setup(){},render({cart:e,I18n:t}){return this.couponInput=this._createInput(e,t),this.applyButton=this._createApplyButton(t),this.trashSpan=this._createTrashSpan(),this.container.setContent([this.couponInput,this.trashSpan,this.applyButton]),this},setValue(e){this.tempValue=e,this.couponInput.setValue(e)},getValue(){return!!this.couponInput&&this.couponInput.getValue()},addClassName(e){this.container.addClassName(e)},removeClassName(e){this.container.removeClassName(e)},disableTrashApply(){this.applyButton.disable(),this.trashSpan.addClassName("hidden")},enableTrashApply(){this.applyButton.enable(),this.trashSpan.removeClassName("hidden")},destroy(){this.couponInput&&this.couponInput.destroy(),this.applyButton&&this.applyButton.destroy(),this.tempValue=null,this.couponInput=null,this.applyButton=null,this.trashSpan=null,this._parent(),this.container=null},_createInput(e,t){let i="";return this.tempValue?i=this.tempValue:e.getCouponSoftware()&&(i=e.getCouponSoftware().getCommercialName(),this.tempValue=i),new r({placeholder:t.get("inputCoupon"),value:i,name:"coupon"})},_createApplyButton(e){return new i({className:"default mpf-apply-button",value:e.get("applyButton"),disabled:!this.getValue(),events:{onClick:()=>{this.setValue(this.getValue().toUpperCase().replace(/[^A-Z0-9]+/g,"")),this.dispatchEvent(s.APPLY_COUPON)}}})},_createTrashSpan(){return t.createElement("span",{class:this.getValue()?"fonticon fonticon-trash":"fonticon fonticon-trash hidden",events:{click:()=>{this.tempValue="",this.dispatchEvent(s.CLEAR_COUPON)}}})},_onKeyUp(e){e.target&&"INPUT"===e.target.tagName&&(e.preventDefault(),e.stopPropagation(),this.removeClassName("mpf-coupon-error"),this.tempValue=this.couponInput.getValue(),this.tempValue?this.enableTrashApply():this.dispatchEvent(s.CLEAR_COUPON))}});return n.Events=s,n})),define("DS/MPFClickAndBuyComponent/orderList/GettingStarted",["UWA/Class/View","UWA/Core","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],((e,t)=>{"use strict";return e.extend({className:"mpf-getting-started",setup(){},render({isRenewal:e,I18n:t}){let i;return i=e?[this._getRenewalTitle({I18n:t}),this._getRenewalMessage({I18n:t})]:[this._getTitle({I18n:t}),this._getIntro({I18n:t}),this._getTextContent({I18n:t})],this.container.setContent(i),this},_getRenewalTitle:({I18n:e})=>t.createElement("div",{text:e.get("renewalGettingStartedTitle")}),_getRenewalMessage:({I18n:e})=>t.createElement("div",{class:"mpf-getting-started-textcontent",text:e.get("renewalGettingStartedMessage")}),_getTitle:({I18n:e})=>t.createElement("div",{text:e.get("gettingStarted")}),_getIntro:({I18n:e})=>t.createElement("div",{class:"mpf-getting-started-intro",text:e.get("gettingStarted_intro")}),_getTextContent:({I18n:e})=>t.createElement("div",{class:"mpf-getting-started-textcontent",html:[{text:"- "+e.get("gettingStarted_part1")},{text:"- "+e.get("gettingStarted_part2")},{text:"- "+e.get("gettingStarted_part3")}]}),destroy(){this._parent(),this.container=null}})})),define("DS/MPFClickAndBuyComponent/platformSelection/TenantSelectionModal",["UWA/Class/View","UWA/Core","DS/UIKIT/Alert","DS/UIKIT/Input/Button","DS/UIKIT/Input/Select","DS/MPFView/ManuallyClosedModal","DS/MPFTracker/Tracker","DS/MPFTracker/Dimension","DS/MPFServices/MarketplaceServices","DS/MPFServices/ObjectService","DS/MPFFiniteStateMachine/FiniteStateMachine","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartModelHelper"],((e,t,i,r,s,n,o,a,c,l,d,h,u)=>{"use strict";const p=Object.freeze({ON_HIDE:"onHide",CONTINUE:"continue",ON_ERROR:"onError"}),m=Object.freeze({ADMIN:"admin",MEMBER:"member",ADMIN_AND_MEMBER:"adminAndMember"}),f=Object.freeze({SELECT_TENANT:"SelectTenant",TENANT_SELECTED:"TenantSelected",CANCEL_TENANT_SELECTION:"CancelTenantSelection"}),g=e.extend({className:"mpf-tenant-modal",setup(){this.alert=this._createAlert()},render({cart:e,platforms:t,I18n:i}){l.requiredOfPrototype(e,h,"options.cart must be a CartModel"),l.requiredOfType(t,"array","options.platforms must be an array of TenantModels"),this.cart=e,this.platforms=t;const r=t.some((e=>e.isMember())),s=t.some((e=>e.isAdmin()));return this.container.setContent([this.alert,this._createHeader({isMember:r,isAdmin:s,I18n:i}),this._createBody({isMember:r,isAdmin:s,I18n:i}),this._createFooter({I18n:i})]),this._sendTrackingPage(),this},_createAlert:()=>new i({visible:!1,autoHide:!1,hideDelay:6e3}),_createHeader({isMember:e,isAdmin:t,I18n:i}){let r;return t?r=i.get("orderDeploymentOptions"):e&&(r=i.get("orderDeployment")),{tag:"div",class:"mpf-tenant-selection-header",html:[{tag:"h4",text:r}]}},_createBody({isAdmin:e,isMember:t,platforms:i,I18n:r}){let s;return e&&t?s=this._getAdminAndMemberContent({platforms:i,I18n:r}):e?s=this._getAdminContent({platforms:i,I18n:r}):t&&(s=this._getMemberContent({platforms:i,I18n:r})),{tag:"div",class:"mpf-tenant-selection-body",html:s}},_getAdminAndMemberContent({I18n:e}){const i=t.createElement("ul",{html:this.platforms.filter((e=>e.isMember())).map((e=>t.createElement("li",{text:e.id})))});this.platformSelection=this._createPlatformSelection({I18n:e});return[t.createElement("p",{text:e.get("youAreMemberOfThesePlatforms")}),i,t.createElement("p",{text:e.get("memberAdminDeployOnExistingPlatform_1")}),t.createElement("p",{html:e.get("memberAdminDeployOnExistingPlatform_2",{bold3D:t.createElement("span",{text:"3D",class:"mpf-bold"}).outerHTML})}),this.platformSelection]},_getMemberContent({I18n:e}){const i=t.createElement("ul",{html:this.platforms.filter((e=>e.isMember())).map((e=>t.createElement("li",{text:e.id})))});return[t.createElement("p",{text:e.get("youAreMemberOfThesePlatforms")}),i,t.createElement("p",{text:e.get("memberDeployOnExistingPlatform")}),t.createElement("p",{text:e.get("proceedToCreateNewPlatform")})]},_getAdminContent({I18n:e}){return this.platformSelection=this._createPlatformSelection({I18n:e}),[t.createElement("p",{html:e.get("selectPlatform",{bold3D:t.createElement("span",{text:"3D",class:"mpf-bold"}).outerHTML})}),this.platformSelection]},_createPlatformSelection({I18n:e}){const t=this.platforms.filter((e=>e.isAdmin())).map((t=>({value:t.id,label:e.get("deployOnThisPlatformOption",{platform:t.id})})));return this.cart.isBeDev()||t.push({value:"new",label:e.get("deployOnNewPlatformOption")}),new s({placeholder:e.get("selectPlatformLabel"),options:t,events:{onChange:()=>{this._sendTrackingEvent(f.SELECT_TENANT)}}})},_createFooter({I18n:e}){return{tag:"div",class:"mpf-tenant-selection-footer",html:[new r({value:e.get("cancel"),events:{onClick:()=>{this._sendTrackingEvent(f.CANCEL_TENANT_SELECTION),this.dispatchEvent(p.ON_HIDE)}}}),new r({className:"primary",value:e.get("next"),events:{onClick:this._onContinue.bind(this,{cart:this.cart,I18n:e})}})]}},_onContinue({I18n:e}){const i=t.is(this.platformSelection)?this.platformSelection.getValue()[0]:"new",r=this._validatePreReq({cart:this.cart,selectedPlatform:i,I18n:e});r.isValid?(this._sendTrackingEvent(f.TENANT_SELECTED,i),this.dispatchEvent(p.CONTINUE,{selectedPlatform:i})):(this.alert.add({className:"error",message:r.errorMsg}).show(),this.dispatchEvent(p.ON_ERROR))},_validatePreReq({selectedPlatform:e,I18n:i}){const r={};if("new"===e){const e=this.cart.getItems().find((e=>"IFW-OC"===e.getProductTrigram())),s=t.is(e);r.isValid=s,r.errorMsg=i.get("businessInnovatorMissing")}else r.isValid=""!==e,r.errorMsg=i.get("selectPlatformError");return r},_createStateMachine(){return new d({state:this._getInitialState(),states:[m.ADMIN,m.MEMBER,m.ADMIN_AND_MEMBER],transitions:[]})},destroy(){this.cart=null,this.platforms=null,this._parent(),this.container=null},_sendTrackingPage(){const e=o.createPageBuilder({url:"/cart/tenantconfiguration"}).setTitle("Tenant Configuration");u.addTrackerInformation(e,this.cart),this._addTrackerDimensions(e),e.send()},_sendTrackingEvent(e,t){const i=o.createEventBuilder({category:"Cart",action:e}).setLabel(t);u.addTrackerInformation(i,this.cart),this._addTrackerDimensions(i),i.send()},_addTrackerDimensions(e){const t=this.platforms.map((e=>e.getShortDescription())).join(",");e.addDimension(a.MARKETPLACE_SERVICE,c.CLICK_AND_BUY).addDimension(a.BUYER_TYPE,"company").addDimension(a.PLATFORMS,t)}});return g.Events=p,g})),define("DS/MPFClickAndBuyComponent/ClicknbuyHeader",["UWA/Class/View","DS/WebappsUtils/WebappsUtils","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],((e,t)=>{"use strict";const i=Object.freeze({ENOVIA:"#E87722",SOLIDWORKS:"#DA291C",CATIA:"#001871",DELMIA:"#FFCD00",BIOVIA:"#C8D300","3DEXCITE":"#E87722",PLATFORM:"#005685"});return e.extend({className:"mpf-clicknbuy-header",setup({stateMachine:e}){this.stateMachine=e},render({portfolioPack:e,title:r,I18n:s}={}){const n=this.stateMachine&&this.stateMachine.isOfferView(),o=[{tag:"div",class:"mpf-header-title",html:[{tag:"span",text:r||(n?e.getDisplayName():s.get("myCart"))}]}];let a;if(n&&e&&!e.isBundle()){const i=e.getCompassRoleInfo().getBrand();o.push({tag:"div",class:"mpf-icon-role",html:[{tag:"img",src:t.getWebappsAssetUrl("i3DXCompass","v3.1/images/role")+"/"+i.toUpperCase()+"_Role.png"}]}),a=this._getBorderColor({brand:i})}else a=i.PLATFORM;return this.container.setStyle("border-bottom","2px solid "+a),this.container.setContent(o),this},_getBorderColor:({brand:e})=>i[e.toUpperCase()],destroy(){this.stateMachine=null,this._parent(),this.container=null}})})),define("DS/MPFClickAndBuyComponent/orderList/OrderListTitle",["UWA/Class/View","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e=>{"use strict";const t=Object.freeze({ADD_ADDITIONAL_ITEMS:"addAdditionalItems"}),i=e.extend({className:"mpf-order-list-title",setup(){},render({cart:e,I18n:t}){const i=[{class:"mpf-title",tag:"span",text:t.get("DSStore")},this._createSubtitle({cart:e,I18n:t})];return this.container.setContent(i),this},destroy(){this._parent(),this.container=null},_createSubtitle({cart:e,I18n:t}){return{tag:"div",class:"mpf-subtitle",html:[{tag:"span",class:"mpf-product-number",text:this._getItemsQuantity({cart:e})+" "+t.get("products")},!1]}},_getItemsQuantity({cart:e}){let t=[],i=0;return e.getItems().forEach((e=>{e.getOfferId()?t.includes(e.getOfferId())||(t.push(e.getOfferId()),i+=parseInt(e.getOfferQuantity())):i+=parseInt(e.getQuantity())})),i},_createAddMoreItems({I18n:e}){return{tag:"div",class:"mpf-add-more-items",html:[{tag:"span",class:"fonticon fonticon-plus"},{tag:"span",text:e.get("addMoreItems")}],events:{click:this.dispatchEvent.bind(this,t.ADD_ADDITIONAL_ITEMS)}}}});return i.Events=t,i})),define("DS/MPFClickAndBuyComponent/PreReqTableComponent",["UWA/Class/View","UWA/Core","DS/UIKIT/Input/Number","DS/MPFServices/ObjectService","DS/MPFUtils/MPFUtils","DS/MPFCartModel/CartModel","DS/MPFPortfolioModel/PortfolioModel","DS/MPFPortfolioModel/PortfolioHelper","DS/MPFPortfolioModel/LicensingHelper","DS/MPFView/ResponsiveTable","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],((e,t,i,r,s,n,o,a,c,l)=>{"use strict";return e.extend({tagName:"div",className:"mpf-pre-req-table-component",setup(){},render({cart:e,selectedPortfolio:t,preReqs:i,productQuantityAddedToCart:s,I18n:c,locale:d}){r.requiredOfPrototype(e,n,"options.cart must be a CartModel"),r.requiredOfPrototype(t,o,"options.selectedPortfolio must be a PortfolioModel");const h=this._computeInitialValuePreReq({cart:e,selectedPortfolio:t,productQuantityAddedToCart:s});i.forEach((e=>e.quantity=h));const u=a.isEdu(t.getProductTrigram());return this.table&&this.table.destroy(),this.table=new l({headerCells:[{tag:"div",text:c.get("name")},{tag:"div",class:"mpf-order-right",text:c.get("unitPriceTaxExcl")},{tag:"div",class:"mpf-order-center",text:c.get("quantityToAdd")},{tag:"div",class:"mpf-order-right",text:c.get("priceTaxExcl")}],rows:i.map((e=>this._createLine({preReq:e,initialQuantity:h,isQuantityInputDisabled:u,I18n:c,locale:d})))}),this.container.setContent([this.table.render()]),this},_createHeader({I18n:e}){const i=t.createElement("th"),r=t.createElement("th",{class:"mpf-order-right",text:e.get("unitPriceTaxExcl")}),s=t.createElement("th",{class:"mpf-order-center",text:e.get("quantityToAdd")}),n=t.createElement("th",{class:"mpf-order-right",text:e.get("priceTaxExcl")});return t.createElement("thead",{html:t.createElement("tr",{html:[i,r,s,n]})})},_createLine({preReq:e,initialQuantity:i,isQuantityInputDisabled:r,I18n:s,locale:n}){const o=parseFloat(e.pricelist[0].monthlyDisplay).toLocaleString(n,{style:"currency",currency:e.pricelist[0].currency});let a,c,l,d;return a=t.createElement("div",{class:"mpf-price",text:this._createTotalPriceContent({preReq:e,locale:n,I18n:s})}),c=t.createElement("div",{class:"mpf-price",text:this._createTotalPriceContent({preReq:e,locale:n,I18n:s})}),l=this._createQuantityInput({preReq:e,isQuantityInputDisabled:r,onChange:t=>{const r=parseInt(t.target.value);r!==e.quantity&&(Number.isNaN(r)?e.quantity=i:e.quantity=r,a.setText(this._createTotalPriceContent({preReq:e,locale:n,I18n:s})),c.setText(this._createTotalPriceContent({preReq:e,locale:n,I18n:s})),d&&d.setValue(e.quantity))}}),d=this._createQuantityInput({preReq:e,isQuantityInputDisabled:r,onChange:t=>{const r=parseInt(t.target.value);r!==e.quantity&&(Number.isNaN(r)?e.quantity=i:e.quantity=r,a.setText(this._createTotalPriceContent({preReq:e,locale:n,I18n:s})),c.setText(this._createTotalPriceContent({preReq:e,locale:n,I18n:s})),l&&l.setValue(e.quantity))}}),[{tag:"div",class:"mpf-product-name",text:e.productDisplayName},{tag:"div",class:"mpf-order-price",text:s.get("unitPricePerUserPerMonth",{price:o})},{mobile:{tag:"div",class:"mpf-order-quantity",html:l},desktop:{tag:"div",class:"mpf-order-quantity",html:d}},{mobile:a,desktop:c}]},_createQuantityInput:({preReq:e,isQuantityInputDisabled:t,onChange:r})=>new i({value:e.quantity,min:1,max:99999,step:1,decimalPrecision:1,disabled:t,events:{onChange:r}}),_createTotalPriceContent({preReq:e,locale:t,I18n:i}){let r=parseFloat(e.pricelist[0].monthlyDisplay);r=e.quantity*r;const s=r.toLocaleString(t,{style:"currency",currency:e.pricelist[0].currency});return i.get("unitPricePerMonth",{price:s})},_computeInitialValuePreReq({cart:e,selectedPortfolio:i,productQuantityAddedToCart:r}){const n=e.getItems(),o=n.filter((e=>!c.isCredit(e.getLicensing()))).map((e=>e.getQuantity())),a=0===o.length?0:o.reduce(((e,t)=>Math.max(e,t))),l=s.findInArray(n,(e=>e.getProductTrigram()===i.getProductTrigram()&&e.getSkuId()===i.get("skuid"))),d=t.is(l)?parseInt(l.getQuantity())+r:r;return Math.max(a,d)},destroy(){this.table&&this.table.destroy(),this.table=null,this._parent(),this.container=null}})})),define("DS/MPFClickAndBuyComponent/PreReqMoreInfoSection",["UWA/Class/View","UWA/Core","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],((e,t)=>{"use strict";return e.extend({className:"mpf-more-info-section",setup({compassPortfolios:e}){this.compassPortfolios=e,this.body=this._createBodyContainer()},render({preReqs:e,I18n:t}){return this.body.hide(),this.body.empty(),this.container.setContent([{tag:"div",class:"mpf-more-info-section-title",html:[{tag:"span",class:"mpf-expand-icon fonticon fonticon-expand-right"},t.get("moreInformation")],events:{click:this._extendMoreInformationSection.bind(this)}},this.body]),this._getPreReqDescriptions({preReqs:e}),this},destroy(){this.body=null,this.compassPortfolios=null,this._parent(),this.container=null},_extendMoreInformationSection(){const e=this.container.getElement(".mpf-expand-icon");this.body.isHidden()?(e.removeClassName("fonticon fonticon-expand-right"),e.addClassName("fonticon fonticon-expand-down"),this.body.show()):(e.removeClassName("fonticon fonticon-expand-down"),e.addClassName("fonticon fonticon-expand-right"),this.body.hide())},_createBodyContainer(){const e=t.createElement("div",{class:"mpf-more-info-section-content"});return e.hide(),e},_getPreReqDescriptions({preReqs:e}){e.forEach((e=>{const t=this.compassPortfolios.getWithTrigram(e.productTrigram.split("-")[0]);this._addDescriptionInBody(e,t)}))},_addDescriptionInBody(e,i){const r=t.createElement("div",{class:"mpf-role-description",html:[t.createElement("h4",{text:e.productDisplayName}),i.getDescription()]});this.body.addContent(r)}})})),define("DS/MPFClickAndBuyComponent/checkout/LegalAgreementsSection",["UWA/Core","UWA/Class/View","UWA/Promise","DS/MPFServices/ObjectService","DS/UIKIT/Input/Toggle","DS/UIKIT/Alert","DS/MPFTCContractModel/TCContractFactory","DS/MPFTcDocumentModel/TCDocumentFactory","DS/MPFCartModel/CartModel","DS/MPFTCContractModel/TCContractModel","DS/MPFTCContractModel/SoftwareAgreementModel","DS/MPFCompanyModel/CompanyModel","DS/MPFPersonModel/PersonModel","DS/MPFBuyer/BuyerType","i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent"],(function(e,t,i,r,s,n,o,a,c,l,d,h,u,p,m){"use strict";var f,g={};return g.ON_RENDER="onRender",g.VALID_SECTION="validSection",g.INVALID_SECTION="invalidSection",(f=t.extend({className:"mpf-legal-section",setup:function(e){e||(e={}),this._parent(e),this._checkPrototypes(e),this.cart=e.cart,this.buyer=e.buyer,this.tcContractFactory=e.tcContractFactory,this.tcDocumentFactory=e.tcDocumentFactory,this.softwareAgreement=e.softwareAgreement,this.tcContracts=this.tcContractFactory.createCollection(o.Types.TERMS_AND_CONDITIONS),this.tcDocument=this.tcDocumentFactory.createModel(a.Types.CLICKNBUY_TC),this.checkbox=this._createToggle()},render:function(){var e=this;return this._getDocuments().then((function(){e.container.setContent([e.checkbox,e._getLabel()]),e.dispatchEvent(g.ON_RENDER)})).catch(this._displayAlert.bind(this)),this},save:function(){return i.all([this._saveClosaContract(),this._saveTermsOfUseContract()])},isChecked:function(){return this.checkbox.isChecked()},_saveTermsOfUseContract:function(){var e,t={};return e=this._findContract(),t[l.FIELDS.CURRENT_STATE]=l.STATUS.inEffect,e.getCurrentState()===l.STATUS.draft?e.savePromise(t,{patch:!0}):i.resolve()},_saveClosaContract:function(){return this.tcContractFactory.createModel(o.Types.EXISTING_DOCUMENT,{documentID:this.softwareAgreement.get("id"),currentState:l.STATUS.inEffect,consumerID:this.buyer.get("id"),cartItemID:this.cart.getItems()[0].get("id")}).savePromise()},_getDocuments:function(){return i.all([this._fetchTermsAndConditions(),this._fetchClosa()])},_fetchTermsAndConditions:function(){return i.all([this.tcDocument.fetchPromise(),this.tcContracts.fetchPromise({type:[l.TcTypes.CLICKNBUY_TC]})])},_fetchClosa:function(){return this.softwareAgreement.fetchPromise({cartId:this.cart.get("id")})},_getLabel:function(){const e=[{tag:"li",text:m.get("allBillingInformationIsCorrect")},{tag:"li",text:h.prototype.isPrototypeOf(this.buyer)?m.get("authorizedToRepresentCompany"):m.get("consentAccess")},{tag:"li",html:m.get("agreeTermsAndConditions",{termsAndConditions:this._getTermsAndConditionsLink().outerHTML})},{tag:"li",html:m.get("agreeClosa",{closa:this._getClosaLink().outerHTML})}];return this.cart.hasMakerItems()&&e.splice(1,0,{tag:"li",text:m.get("iAmAMakerOrHobbyist")}),{tag:"div",class:"mpf-switch-label",html:[m.get("acknowledgeThat"),{tag:"ul",html:e}]}},_getClosaLink:function(){return e.createElement("a",{target:"_blank",href:this.softwareAgreement.getUrl(),text:m.get("closaLabel")})},_getTermsAndConditionsLink:function(){return e.createElement("a",{target:"_blank",href:this.tcDocument.getDocUrl(),text:m.get("termsAndConditionsLabel")})},_findContract:function(){var e,t=this;return(e=this.tcContracts.filter((function(e){return e.getConsumerID()===t.buyer.get("id")&&e.getDocumentType()===l.DOCUMENT_TYPES.CLICKNBUY_TC&&e.getCurrentState()!==l.STATUS.archived&&e.getSigningRevision()===e.getActiveRevision()})).shift()).dataProxy=t.tcContractFactory.getDataProxy(o.Types.CONTRACTS),e},_displayAlert:function(){new n({className:"error",icon:!0,closable:!0,visible:!0,messages:{className:"error",message:m.get("errorLoadingDocuments")}}).inject(document.body.getElementsByClassName("mpf-order-confirmation-page")[0],"top")},_createToggle:function(){var e=this;return new s({type:"switch",className:"primary",value:"",events:{onChange:function(){this.isChecked()?e.dispatchEvent(g.VALID_SECTION):e.dispatchEvent(g.INVALID_SECTION)}}})},_checkPrototypes:function(e){r.requiredAsOneOf(e.buyer,[h,u],"options.buyer must either be a CompanyModel or a PersonModel"),r.requiredOfPrototype(e.cart,c,"options.cart must be a CartModel"),r.requiredOfPrototype(e.tcContractFactory,o,"options.tcContractFactory must be a TcContractFactory"),r.requiredOfPrototype(e.tcDocumentFactory,a,"options.tcDocumentFactory must be a TcDocumentFactory"),r.requiredOfPrototype(e.softwareAgreement,d,"options.softwareAgreement must be a SoftwareAgreementModel")}})).Events=Object.freeze(g),f})),define("DS/MPFClickAndBuyComponent/discoverBundle/DiscoverBundleSection",["UWA/Class/View","UWA/Core","DS/UIKIT/Input/Button","DS/MPFServices/ObjectService","DS/MPFPortfolioModel/PortfolioPackModel","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],((e,t,i,r,s)=>{"use strict";const n=Object.freeze({DISCOVER_BUNDLE:"discoverBundle"}),o=e.extend({className:"mpf-discover-bundle-section",setup({bundle:e,locale:t,I18n:i}={}){r.requiredOfPrototype(e,s,"options.bundle must be a PortfolioPackModel"),this.bundle=e,this.locale=t,this.I18n=i,this.priceInfo=this._createPriceInfo(),this.discoverButton=this._createDiscoverButton()},render(){return this.container.setContent([{tag:"div",class:"mpf-left",html:[this._createTitle(),this._createSubtitle()]},{tag:"div",class:"mpf-right",html:[{tag:"div",class:"mpf-left-in-right",html:[{tag:"span",class:"mpf-price-start",text:this.I18n.get("startingFrom")},this._createPriceInfo(),{tag:"div",class:"mpf-price-month",text:this.I18n.get("perMonth")},this.discoverButton]},{tag:"div",class:"mpf-right-in-right",html:this.discoverButton}]}]),this},_createPriceInfo(){let e;return this.bundle.getOffers().forEach((i=>{const r=i.getPriceList()[0].monthlyDisplay;(!t.is(e)||r<e)&&(e=r)})),t.createElement("span",{class:"mpf-price",text:e.toLocaleString(this.locale,{style:"currency",currency:this.bundle.getOffers().first().getPricelistCurrency()})})},_createDiscoverButton(){return new i({className:"primary",value:this.I18n.get("discover"),events:{onClick:async()=>{this.dispatchEvent(n.DISCOVER_BUNDLE,{bundle:this.bundle})}}})},_createTitle(){return t.createElement("div",{class:"mpf-title",text:this.bundle.getDisplayName()})},_createSubtitle(){const e=this.bundle.getOffers().first().getSoftwareOfferDetails().reduce(((e,t,i)=>0===i?t.productDisplayName:e+" | "+t.productDisplayName),"");return t.createElement("div",{class:"mpf-subtitle",text:e})},destroy(){this.stopListening(),this.bundle=null,this.I18n=null,this._parent(),this.container=null}});return o.Events=n,o})),define("DS/MPFClickAndBuyComponent/M3DEInit",["DS/MPFAmdLazyLoader/AmdLazyLoader"],(function(e){"use strict";return async function(){const[t,i,r]=await e.getInstance().get(["DS/TopBarProxy/TopBarProxy","DS/SwymUICore/script/utils/utils","i18n!DS/MPFMyAccount/assets/nls/MyAccount"]),s=new t({id:i.getTopBarMainId()});s.addContent({profile:[{label:r.get("myAccount"),onExecute:()=>{window.open("/cnb/my-account","_self")}}]}),s.activate()}})),define("DS/MPFClickAndBuyComponent/offerList/AvailableCountriesComponent",["UWA/Class/View","DS/UIKIT/Input/Select","DS/UIKIT/Input/Button","DS/MPFServices/ObjectService","DS/MPFCountryModel/CountryCollection","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],((e,t,i,r,s)=>{"use strict";const n=Object.freeze({ON_CHANGE_COUNTRY:"onChangeCountry"}),o=Object.freeze({NEED_HELP:"NeedHelp",COUNTRY_CHANGED:"CountryChanged"}),a=e.extend({className:"mpf-offer-list-available-countries",setup(e={}){r.requiredOfPrototype(e.countries,s,"options.countries must be a CountryCollection"),this.countries=e.countries,this.stateMachine=e.stateMachine,this.isEduOffer=!0===e.isEduOffer,this.isMakerOffer=!0===e.isMakerOffer,this.useIso3=!0===e.useIso3,this.tracker=e.tracker},render({I18n:e}){return this.selectedCountry=this.stateMachine.getCountry(),this.container.setContent([this._createSelect({I18n:e}),{tag:"div",class:"mpf-help",html:new i({className:"link",value:e.get("needHelp"),events:{onClick:async()=>{const e=this.stateMachine.getPage(),t=e.charAt(0).toUpperCase()+e.slice(1);this.tracker.sendEvent({action:o.NEED_HELP,category:t}),window.open("https://www.3ds.com/support/3dexperience-platform-on-cloud-support/support-for-online-purchase/","_blank")}}})}]),this},getSelectedCountry(){return this.select.getValue()[0]},_createSelect({I18n:e}){return new t({placeholder:!1,options:this._getOptions({I18n:e}),events:{onChange:e=>{if(e&&e.target&&e.target.value!==this.selectedCountry){this.selectedCountry=e.target.value;const t=this.stateMachine.doesLanguageChangeForCountry(this.selectedCountry);this.stateMachine.setCountry(this.selectedCountry);const i=this.stateMachine.getPage(),r=i.charAt(0).toUpperCase()+i.slice(1);this.tracker.sendEvent({action:o.COUNTRY_CHANGED,category:r,label:this.selectedCountry}),this.dispatchEvent(n.ON_CHANGE_COUNTRY,{country:this.selectedCountry,requiresLanguageChange:t})}}}})},_getOptions({I18n:e}){return this.countries.map((t=>{const i=this.useIso3?t.getIso3():t.getIso2();return{value:i,label:e.get(t.getIso2()),selected:i===this.selectedCountry}})).sort(((e,t)=>e.label<t.label?-1:e.label>t.label?1:0))},destroy(){this.stopListening(),this.countries=null,this._parent(),this.container=null}});return a.Events=n,a})),define("DS/MPFClickAndBuyComponent/SubscriptionInformationComponent",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFPortfolioModel/PortfolioModel","DS/MPFPortfolioModel/PortfolioPackModel","DS/MPFPortfolioModel/PortfolioHelper"],(function(e,t,i,r,s,n){"use strict";return t.extend({className:"mpf-subscription-information",setup(){},render({portfolioPack:e,I18n:t}){i.requiredOfPrototype(e,s,"options.portfolioPack must be a PortfolioPackModel");const r=e.getOffers().first(),n=[{tag:"div",class:"mpf-title",text:t.get("subscriptionInformation")},{tag:"div",class:"mpf-subsection-container",html:[this._renderOfferDetailsSection({portfolio:r,I18n:t}),this._renderWhoIsEligibleSection({portfolio:r,I18n:t}),this._renderGettingStartedSection({portfolio:r,I18n:t}),this._renderSubscrpitionAndRenewalsSection({portfolio:r,I18n:t}),this._renderNeedMoreInfoSection({portfolio:r,I18n:t})]}];return this.container.setContent(n),this},_renderOfferDetailsSection({portfolio:e,I18n:t}){return this._renderSubSectionIfPortfolioContains({portfolio:e,attribute:r.Fields.OFFER_DETAILS,title:t.get("offerDetails")})},_renderWhoIsEligibleSection({portfolio:e,I18n:t}){return this._renderSubSectionIfPortfolioContains({portfolio:e,attribute:r.Fields.WHO_IS_ELIGIBLE,title:t.get("whoIsEligible")})},_renderGettingStartedSection({portfolio:e,I18n:t}){let i;if(e.has(r.Fields.GETTING_STARTED))i=this._renderSubSection(t.get("gettingStarted"),e.get(r.Fields.GETTING_STARTED));else{const e=[];for(let i=1;i<=3;i++)e.push({tag:"li",text:t.get("gettingStarted_part"+i)});i=this._renderSubSection(t.get("gettingStarted"),[{tag:"div",class:"mpf-intro",text:t.get("gettingStarted_intro")},{tag:"ul",html:e}])}return i},_renderSubscrpitionAndRenewalsSection({portfolio:e,I18n:t}){let i;return i=e.getRenewal()?this._renderSubSection(t.get("subscriptionsAndRenewals"),e.getRenewal()):this._renderSubSection(t.get("subscriptionsAndRenewals"),n.isRenewableOffer(e)?e.getRenewWith()?t.get("subscriptionsAndRenewals_text_renewable_renewWithDefined"):t.get("subscriptionsAndRenewals_text_renewable_renewWithBlank"):t.get("subscriptionsAndRenewals_text_noRenewable")),i},_renderNeedMoreInfoSection({portfolio:e,I18n:t}){return this._renderSubSection(t.get("needMoreInfo"),e.get(r.Fields.MORE_INFO)||t.get("needMoreInfo_text",{faq:this._createLink(t.get("faq"),"https://www.3ds.com/support/3dexperience-platform-on-cloud-support/support-for-online-purchase")}))},_createLink:(t,i)=>e.createElement("a",{text:t,href:i,target:"_blank"}).outerHTML,_renderSubSectionIfPortfolioContains({portfolio:e,attribute:t,title:i}){const r=e.get(t);if(r)return this._renderSubSection(i,r)},_renderSubSection:(e,t)=>({tag:"div",class:"mpf-sub-section",html:[{tag:"div",class:"mpf-sub-section-title",text:e},{tag:"div",class:"mpf-sub-section-content",html:t}]}),destroy(){this._parent(),this.container=null}})})),define("DS/MPFClickAndBuyComponent/offerList/OfferDescriptionComponent",["UWA/Class/View","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(e=>{"use strict";return e.extend({className:"mpf-description-offer",setup(){},render({portfolioPack:e}){const t=this._getDesription({portfolioPack:e});return t&&this.container.setContent({tag:"div",class:"mpf-product-info",html:t}),this},_getDesription({portfolioPack:e}){let t;if(e.isBundle()){const i=e.getOffers().find((e=>e.getDescription()&&""!==e.getDescription()));t=i&&i.getDescription()}else{const i=e.getCompassRoleInfo();t=i&&i.getTagLine()}return t},destroy(){this._parent(),this.container=null}})})),define("DS/MPFClickAndBuyComponent/ClickAndBuyStateMachine",["UWA/Class","UWA/Class/Events","DS/MPFUrl/UrlUtils","DS/MPFUtils/StorageUtils","DS/MPFUtils/CountryDetector","DS/MPFPortfolioModel/PortfolioHelper","DS/MPFServices/MarketplaceServices","DS/MPFClickAndBuyComponent/CnbLanguageHelper"],(function(e,t,i,r,s,n,o,a){"use strict";const c=Object.freeze({BUY:"buy",OFFER:"offer",OFFERS:"offers",CART:"cart",PLATFORM_SELECTION:"platform-selection",CHECKOUT:"checkout",PAYMENT_RESULT:"payment-result"}),l=Object.freeze({OFFER:"offer",CART:"cart",PLATFORM_SELECTION:"platformSelection",CHECKOUT:"checkout",PAYMENT_RESULT:"paymentResult"}),d=Object.freeze({GO_TO_PAYMENT:"goToPayment",BUNDLE:"bundle",ORDER_STATUS:"orderStatus",ORDER_ID:"orderId",COUNTRY:"country",LANGUAGE:"lang",LICENCING_SCHEME:"licencingScheme",TENANT:"mpfTenant",PARTNER_ID:"partnerId"}),h=new Map;h.set(l.OFFER,c.OFFER),h.set(l.CART,c.CART),h.set(l.PLATFORM_SELECTION,c.PLATFORM_SELECTION),h.set(l.CHECKOUT,c.CHECKOUT),h.set(l.PAYMENT_RESULT,c.PAYMENT_RESULT);const u=new Map;u.set(c.BUY,l.OFFER),u.set(c.OFFER,l.OFFER),u.set(c.CART,l.CART),u.set(c.PLATFORM_SELECTION,l.PLATFORM_SELECTION),u.set(c.CHECKOUT,l.CHECKOUT),u.set(c.PAYMENT_RESULT,l.PAYMENT_RESULT);const p=new Map;p.set("AT","de"),p.set("AU","en"),p.set("BE","fr"),p.set("CA","en"),p.set("CH","fr"),p.set("CZ","cs"),p.set("CS","cs"),p.set("DE","de"),p.set("DK","en"),p.set("DZ","fr"),p.set("ES","es"),p.set("FI","en"),p.set("FR","fr"),p.set("GB","en"),p.set("IN","en"),p.set("IE","en"),p.set("IT","it"),p.set("JP","ja"),p.set("LU","fr"),p.set("MA","fr"),p.set("NL","en"),p.set("NO","en"),p.set("PL","pl"),p.set("PT","en"),p.set("SE","en"),p.set("US","en");const m=new Map;m.set("cs","CZ"),m.set("cz","CZ"),m.set("de","DE"),m.set("en","US"),m.set("es","ES"),m.set("fr","FR"),m.set("it","IT"),m.set("ja","JP"),m.set("pl","PL"),m.set("pt","PT"),m.set("zh","CH");const f=Object.freeze({PAGE_CHANGE_REQUESTED:"onPageChangeRequested"}),g=e.extend(t,{init({page:e,service:t,cookieKey:i,me:r,countries:s,doChangeUrls:n}){this.page=e,this.service=t,this._cookieKey=i,this.doChangeUrls="boolean"==typeof n?n:this.isUrlDedicatedPage()||this.isCurrentUrlACompassUrl(),this._setInitialCountryAndLanguage({me:r,countries:s,service:t}),this.updateUrl(e)},getPage(){return this.page},isOfferView(){return this.page===l.OFFER},isCartView(){return this.page===l.CART},isPlatformSelectionView(){return this.page===l.PLATFORM_SELECTION},isCheckoutView(){return this.page===l.CHECKOUT},isPaymentRedirectResult(){return this.page===l.PAYMENT_RESULT},isCurrentUrlACompassUrl(){const e=window.location.pathname;return e.contains("/compass-world")&&e.contains("/buy")},isUrlDedicatedPage:()=>window.location.pathname.contains("/cnb"),changePage(e,t){this.page!==e&&(this.page=e,this.updateUrl(e),this.dispatchEvent(f.PAGE_CHANGE_REQUESTED,t))},clearUrl(){const e=new URL(window.location.href),t=e.pathname.split("/").pop();if(this.isUrlDedicatedPage())e.pathname="";else if(Object.values(c).includes(t)){const i=e.pathname.replace(new RegExp("/"+t+"$"),"");e.pathname=i}this._deleteSearchParams(e,[d.BUNDLE,d.ORDER_STATUS,d.ORDER_ID,d.TENANT,d.PARTNER_ID]);const i=e.toString();try{window.history.pushState(null,null,i)}catch(e){console.warn(e)}},convertPageToUrlPath:e=>h.get(e),updateUrl(e){let t;if(this.doChangeUrls){const i=new URL(window.location.href).pathname.split("/").pop(),r=this.convertPageToUrlPath(e);i!==r&&(t=this.generateNewUrl(e,i,r))}else{const e=new URL(window.location.href);this._deleteSearchParams(e,[d.BUNDLE,d.ORDER_STATUS,d.ORDER_ID,d.PARTNER_ID]),t=e.toString()}if(t)try{window.history.pushState(null,null,t),this._updateChatBotPath(e)}catch(e){console.warn(e)}},generateNewUrl(e,t,i){const r=new URL(window.location.href);let s;t=t||r.pathname.split("/").pop(),i=i||this.convertPageToUrlPath(e);return s=Object.values(l).map((e=>h.get(e))).includes(t)?r.pathname.replace(new RegExp(t+"$"),i):r.pathname.endsWith("/")?r.pathname+i:r.pathname+"/"+i,r.pathname=s,this._deleteSearchParams(r,[d.BUNDLE,d.ORDER_STATUS,d.ORDER_ID]),r.toString()},_updateChatBotPath(e){window._hsq&&window._hsq.push&&(window._hsq.push(["setPath","/"+e]),window._hsq.push(["trackPageView"]))},_initSearchParamsObj(){const e=new URL(window.location.href);return new URLSearchParams(e.search)},_setSearchParam(e,t){const i=this._initSearchParamsObj();return i.set(e,t),i.toString()},_deleteSearchParams(e,t){t.forEach((t=>{e.searchParams.delete(t)}))},getBundleParam(){return this._initSearchParamsObj().get(d.BUNDLE)},setBundleParam(e){const t=new URL(window.location.href);t.searchParams.append(d.BUNDLE,e);const i=t.toString();window.history.pushState(null,null,i)},clearSearchParams(e){const t=new URL(window.location.href);let i=!1;e.forEach((e=>{t.searchParams.has(e)&&(t.searchParams.delete(e),i=!0)})),i&&window.history.pushState(null,null,t.toString())},getLocale(){return this.getLanguage()},doesLanguageChangeForCountry(e){const t=a.getI18nLanguage();return t?p.get(e)!==t:p.get(e)!==p.get(this.getCountry())},getCountry(){return this.getCountryFromLocalStorage()},setCountry(e,{setLanguage:t=!0}={}){this.setCountryInLocalStorage(e.toUpperCase());const i=p.get(e);i&&t&&this.setLanguage(i.toLowerCase());const r=new URL(window.location.href),s=/(\/welcome\/)[a-z]{2}(\/compass-world)/;if(r.pathname.search(s)>-1){const e=r.pathname.replace(s,`$1${i}$2`),t=`${r.origin}${e}${r.search}`;window.history.pushState(null,null,t)}},getLanguage(){const e=this.getLanguageFromCookie();if(e)return e;{const e=this.getCountryFromLocalStorage();if(e)return p.get(e)}},setLanguage(e){p.has(e)?e=p.get(e):[...p.values()].includes(e)||(console.error('Unknown language parameter! Using default "en".'),e="en"),this.setLanguageCookie(e),window.dsLang=e,a.defineI18nLanguage(e)},getCountryFromLocalStorage(){return r.getStoredCountry(this.service)},setCountryInLocalStorage(e){r.storeCountry(this.service,e)},getCountryFromUrl:()=>new URL(window.location.href).searchParams.get("country"),getLanguageFromCookie(){return r.getCookie(this._cookieKey)},setLanguageCookie(e){r.setCookie(this._cookieKey,e)},_setInitialCountryAndLanguage({me:e,countries:t,service:i}){const r=new URL(window.location.href),n=r.searchParams.get("country"),a=r.searchParams.get("lang"),c=this.getCountry(),l=this.getLanguageFromCookie(),d=e&&e.hasCountry()&&t.some((t=>t.getIso2()===e.getCountry()))&&e.getCountry(),h=s.getCountryIso2Code(),u=h&&t.some((e=>e.getIso2()===h))&&h;let p,f,g;i===o.SUBSCRIPTIONS?(f=d||"US",g=!1):i===o.INNOVATE?(f=c||"USA",g=!1):a?(p=a,f=n||c||d||u||m.get(a)||"US",g=!1):n?(f=n,g=!0):c?l?(f=c,g=!1):(f=c,g=!0):l?d?(f=d,g=!1):(f=u||m.get(l)||"US",g=!1):d?(f=d,g=!0):(f=u||"US",g=!0),this.setCountry(f,{setLanguage:g}),p&&this.setLanguage(p)}});return g._getOfferName=function(e){const t=e.getPath().split("/"),i=t.indexOf(c.OFFERS);if(i>-1&&i<t.length)return t[i+1]},g._getPageFromUrl=function(){const e=window.location.pathname.split("/").pop();return u.get(e)},g.getInitialState=function(e){let t;const r=new i(window.location.href),s=Array.isArray(e)?n.findTrigramInArray(e):e,o=this._getOfferName(r),a=r.getValueParameter("licencingScheme"),c=r.getValueParameter("cartId")||r.getValueParameter("orderId"),d=this._getPageFromUrl();return d===l.PAYMENT_RESULT&&c?t=l.PAYMENT_RESULT:d===l.CHECKOUT?t=l.CHECKOUT:d===l.PLATFORM_SELECTION?t=l.PLATFORM_SELECTION:c||d===l.CART||(o||s)&&a?t=l.CART:(d===l.OFFER||o||s)&&(t=l.OFFER),{page:t,offerTrigram:s,offerName:o,cartId:c,licencingScheme:a}},g.Events=f,g.Pages=l,g.PageToUrlMap=h,g.UrlToPageMap=u,g.Urls=c,g.UrlParams=d,g})),define("DS/MPFClickAndBuyComponent/orderList/PriceAndTaxHandler",["UWA/Class","UWA/Class/Events","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFTaxModel/TaxEstimationModel","DS/MPFPortfolioModel/PortfolioHelper","DS/MPFClickAndBuyComponent/ClickAndBuyCartHelper"],(function(e,t,i,r,s,n,o){"use strict";const a=Object.freeze({INITIAL:"initial",TAX_NOT_AVAILABLE:"taxNotAvailable",TAX_LOADED:"taxLoaded"}),c=Object.freeze({LOADING:"loading",TAXES_LOADED:"taxesLoaded"}),l=e.extend(t,{init({taxEstimation:e,stateMachine:t,service:r}){i.requiredOfPrototype(e,s,"options.taxEstimation must be a TaxEstimationModel"),this.taxEstimation=e,this.stateMachine=t,this.service=r,this.state=a.INITIAL},resetTaxes({cart:e,portfolios:t}){let i=this._getSubTotals({cart:e,portfolios:t});this.state=a.INITIAL,this.oldSubtotal=i.oldPrice,this.subtotal=i.newPrice,this.currency=this._getCurrency({cart:e,portfolios:t}),this.isPayable=this.isCartPayable({cart:e,portfolios:t}),this.total=null,this.tax=null},async updateTaxes({cart:e,portfolios:t}){await this.loadTaxes({cart:e,portfolios:t}),this.dispatchEvent(c.TAXES_LOADED)},async loadTaxes({cart:e,portfolios:t}){let s,n,o,c;i.requiredOfPrototype(e,r,"options.cart must be a CartModel");const l=this._getCurrency({cart:e,portfolios:t}),d=e.getItems();d&&d.length>0?(n=this._getSubTotals({cart:e,portfolios:t}),c=await this._loadTaxes({cart:e,subtotal:n.newPrice,currency:l}),o=this._getTax({cart:e,portfolios:t}),s=this._getTotal({cart:e,subtotal:n.newPrice,tax:o})):(n={oldPrice:0,newPrice:0},o=0,s=0,c=a.TAX_LOADED),this.total=s,this.oldSubtotal=n.oldPrice,this.subtotal=n.newPrice,this.tax=o,this.currency=l,this.state=c,this.isPayable=this.isCartPayable({cart:e,portfolios:t})},getPriceInfos(){return{total:this.total,oldSubtotal:this.oldSubtotal,subtotal:this.subtotal,tax:this.tax,currency:this.currency,state:this.state,isPayable:this.isPayable}},formatPrice(e,t){const i=this.stateMachine.getLocale();return e.toLocaleString(i,{style:"currency",currency:t,minimumFractionDigits:e%1==0?0:2,maximumFractionDigits:e%1==0?0:2})},isCartPayable({cart:e,portfolios:t}){const i=e.isRenewal(),s=t.some((e=>n.isOfferExpired(e))),o=e.getItems(),a=o&&0===o.length,c=[r.States.SUBMITTED,r.States.PAYMENT_INITIATED,r.States.PENDING_PAYMENT].includes(e.getState());return!(!i&&s||i&&!c||a)},_loadTaxes({cart:e,subtotal:t,currency:i}){return this.taxEstimation.clear(),this.taxEstimation.fetchPromise({amount:t,currency:i,country:this.stateMachine.getCountry(),salesContext:e.hasMakerItems()||e.hasEduItems()?"B2C":"B2B",onPassportError:()=>a.TAX_NOT_AVAILABLE}).then((()=>isNaN(parseFloat(this.taxEstimation.getAmount()))?a.TAX_NOT_AVAILABLE:a.TAX_LOADED)).catch((e=>(console.error(e),a.TAX_NOT_AVAILABLE)))},_getSubTotals({cart:e,portfolios:t}){const i=t.at(0);let r={oldPrice:0,newPrice:0};return e.isRenewal()?r={oldPrice:e.getNetAmountTotal(),newPrice:e.getNetAmountTotal()}:i&&(r=o.calculateTotalPrices(e.getItems(),t,e.getCouponSoftware())),r},_getTax({cart:e,portfolios:t}){const i=t.at(0);let s;return s=e.isRenewal()?e.get(r.Fields.TAXES_AMOUNT_TOTAL):i?this.taxEstimation&&this.taxEstimation.getAmount():0,s},_getTotal({cart:e,subtotal:t,tax:i}){let r;return e.isRenewal()?r=e.getGrossAmountTotal():"number"==typeof t&&"number"==typeof i&&(r=t+i),r},_getCurrency({cart:e,portfolios:t}){const i=t.at(0);let r;return e.isRenewal()?r=e.getCurrency():i&&(r=i.getCurrency()||i.getPricelistCurrency()),r}});return l.States=a,l.Events=c,l})),define("DS/MPFClickAndBuyComponent/platformSelection/PlatformSelectionDataLoader",["DS/MPFUtils/StorageUtils","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartFactory","DS/MPFTenantModel/TenantFactory","DS/MPFClickAndBuyComponent/CnbLanguageHelper"],(function(e,t,i,r,s){"use strict";return class{constructor({cartFactory:e,tenantFactory:t,service:i}){this.cartFactory=e,this.tenantFactory=t,this.service=i}async loadData(){const[t]=await s.loadLanguageFiles(["i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent"],{allowCache:!0}),r=this.cartFactory.createModel(i.Types.ME,{});e.loadStoredCart(this.service,r);return{I18n:t,cart:r,platforms:await this.loadPrivatePlatforms({cart:r})}}async loadPrivatePlatforms({cart:e}){const t=this.tenantFactory.createCollection(r.Types.TENANTS,[],{parentResourceId:e.get("id")});let i;return e.hasMakerItems()?i="makers":e.hasEduItems()&&(i="edu"),await t.fetchPromise({cartType:i}),t.filter((e=>!e.isPublic()))}saveSelectedPlatform({cart:e,platform:i}){return e.savePromise({[t.Fields.ONLINE_INSTANCE]:i,[t.Fields.STATE]:t.States.SUBMITTED},{patch:!0})}isIFWInCart(e){return e.getItems().some((e=>e.getProductTrigram().startsWith("IFW-")))}}})),define("DS/MPFClickAndBuyComponent/PreReqModal",["UWA/Class/View","UWA/Core","DS/UIKIT/Modal","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/MPFUtils/StorageUtils","DS/MPFTracker/Tracker","DS/MPFTracker/Dimension","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartModelHelper","DS/MPFPortfolioModel/PortfolioModel","DS/MPFPortfolioModel/PortfolioCollection","DS/MPFClickAndBuyComponent/ClickAndBuyCartHelper","DS/MPFClickAndBuyComponent/PreReqMoreInfoSection","DS/MPFClickAndBuyComponent/PreReqTableComponent","DS/MPFServices/MarketplaceServices","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],((e,t,i,r,s,n,o,a,c,l,d,h,u,p,m,f,g)=>{"use strict";const C=Object.freeze({ON_HIDE:"onHide",PRE_REQ_ADDED:"preReqAdded"}),P=Object.freeze({PREREQUISITE_ADDED:"PrerequisiteAdded",ALREADY_HAVE_PREREQUISITE:"AlreadyHavePrerequisite"}),I=e.extend({className:"mpf-pre-req-modal",setup({service:e,compassPortfolios:t}={}){this.service=e,this.moreInfoSection=new m({compassPortfolios:t}),this.preReqTable=new f,this.modal=this._createModal()},render(){return this.modal.inject(this.container),this},show({cart:e,selectedPortfolio:t,portfolioDependencies:i,locale:r,I18n:s,productQuantityAddedToCart:n=1}){c.requiredOfPrototype(e,l,"options.cart must be a CartModel"),c.requiredOfPrototype(i,u,"options.portfolioDependencies must be a PortfolioCollection"),c.requiredOfPrototype(t,h,"options.selectedPortfolio must be a PortfolioModel");const o=this._getPreReqs({selectedPortfolio:t,portfolioDependencies:i});this.modal.setHeader(this._createModalHeader({preReqs:o,I18n:s})),this.modal.setBody(this._createModalBody({cart:e,selectedPortfolio:t,preReqs:o,productQuantityAddedToCart:n,I18n:s,locale:r})),this.modal.setFooter(this._createModalFooter({cart:e,preReqs:o,selectedPortfolio:t,productQuantityAddedToCart:n,I18n:s})),this.modal.show(),this._sendTrackingPage({cart:e})},_getPreReqs:({portfolioDependencies:e,selectedPortfolio:t})=>e.map((e=>e.get("productOffers"))).flat().filter((e=>e.licensingScheme===t.get("licensingScheme"))),_createModal(){return new i({events:{onHide:()=>{this.dispatchEvent(C.ON_HIDE)}}})},_createModalHeader:({preReqs:e,I18n:i})=>t.createElement("h4",{text:e.length>1?i.get("preReqTitle"):i.get("preReqTitleSingular")}),_createModalBody({cart:e,selectedPortfolio:i,preReqs:r,productQuantityAddedToCart:s,I18n:n,locale:o}){return t.createElement("div",{class:"mpf-pre-req-list",html:[this.preReqTable.render({cart:e,selectedPortfolio:i,preReqs:r,productQuantityAddedToCart:s,I18n:n,locale:o}),this.moreInfoSection.render({preReqs:r,I18n:n}),t.createElement("div",{class:"mpf-pre-req-explanation",text:n.get("preReqExplanation")})]})},_createModalFooter({cart:e,preReqs:i,selectedPortfolio:s,productQuantityAddedToCart:n,I18n:o}){return[t.createElement("div",{class:"mpf-want-add-roles",text:o.get("wantToAddRoles")}),new r({className:"default mpf-already-have-prereq-btn",value:o.get("alreadyHaveRoles"),events:{onClick:this._patchCart.bind(this,{addPreReq:!1,cart:e,preReqs:i,selectedPortfolio:s,productQuantityAddedToCart:n,I18n:o})}}),new r({className:"primary",value:o.get("ok"),events:{onClick:this._patchCart.bind(this,{addPreReq:!0,cart:e,preReqs:i,selectedPortfolio:s,productQuantityAddedToCart:n,I18n:o})}})]},_patchCart({addPreReq:e,cart:t,preReqs:i,selectedPortfolio:r,productQuantityAddedToCart:o,I18n:a}){let c;if(e||(i=[]),t.hasEduItems()){const e=t.getItems().map((e=>e.getProductTrigram()));c=i.filter((t=>-1===e.indexOf(t.productTrigram)))}return s.mask(this.modal.getBody(),a.get("loading")),p.saveSubscriptionAndPreReq(t,r,o,t.hasEduItems()?c:i).then((()=>{s.unmask(this.modal.getBody()),n.storeCart(this.service,t),e?this._sendTrackingEvent.bind(this,P.PREREQUISITE_ADDED,{cart:t}):this._sendTrackingEvent.bind(this,P.ALREADY_HAVE_PREREQUISITE,{cart:t}),this.modal.hide(),this.dispatchEvent(C.PRE_REQ_ADDED)}))},destroy(){this.modal.destroy(),this._parent(),this.container=null},_sendTrackingPage({cart:e}){const t=o.createPageBuilder({url:"/configurator/prerequisite"}).setTitle("Prerequisite").addDimension(a.MARKETPLACE_SERVICE,g.CLICK_AND_BUY);d.addTrackerInformation(t,e),t.addDimension(a.BUYER_TYPE,"company").send()},_sendTrackingEvent(e,{cart:t}){const i=o.createEventBuilder({category:"Cart",action:e}).addDimension(a.MARKETPLACE_SERVICE,g.CLICK_AND_BUY);d.addTrackerInformation(i,t),i.addDimension(a.BUYER_TYPE,"company").send()}});return I.Events=C,I})),define("DS/MPFClickAndBuyComponent/checkout/ThankYouForPurchasePanel",["UWA/Core","UWA/Class/View","DS/PlatformAPI/PlatformAPI","DS/MPFUrl/UrlUtils","DS/MPFUtils/StorageUtils","DS/MPFServices/MarketplaceServices","DS/MPFCartModel/CartModel","DS/MPFClickAndBuyComponent/ClickAndBuyCartHelper","DS/MPFClickAndBuyComponent/ClickAndBuyStateMachine","DS/MPFTracker/Tracker","DS/MPFTracker/Category","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(function(e,t,i,r,s,n,o,a,c,l,d){"use strict";const h=Object.freeze({PAYMENT_COMPLETED:"paymentCompleted",GO_TO_CART:"goToCart"}),u=Object.freeze({PAYMENT_COMPLETED:"PaymentCompleted",PAYMENT_DECLINED:"PaymentDeclined",PAYMENT_CANCELLED:"PaymentCancelled"}),p=Object.freeze({SUCCESS:"success",FAILURE:"failure",CANCELLED:"cancelled"});function m(e){let t;const i=new r(window.location.href),s=[o.States.PAYMENT_COMPLETE,o.States.PAYMENT_ACCEPTED,o.States.DELIVERED].includes(e.getState()),n=e.getPaymentStatus()===o.States.PAYMENT_ACCEPTED,a=i.getValueParameter("orderStatus");return t=a===p.SUCCESS||s||n?p.SUCCESS:a===p.CANCELLED?p.CANCELLED:p.FAILURE,t}const f=t.extend({className:"mpf-cab-thank-you-for-purchase-panel",setup({cart:e,me:t,service:i,stateMachine:r}={}){this.cart=e,this.me=t,this.service=i,this.stateMachine=r,this.isClickAndBuy=this.service===n.CLICK_AND_BUY,this.isEduOrMaker=this.cart.hasEduItems()||this.cart.hasMakerItems(),this.isRenewal=this.cart.isRenewal(),this.isInnovateBusinessExperienceOrder=this.cart.isInnovateBusinessExperienceOrder(this.service),this.iframe=this._createIframe()||"",l.createEventBuilder({category:d.CHECKOUT,action:"ThankYouForYourPurchase_init"}).send()},render({I18n:e}){const t=this.getOrderStatus();return this.container.setContent([[this._renderMessage({status:t,I18n:e})]]),this._sendTrackerPaymentCompleteIfCCAvenue({status:t}),t===p.SUCCESS&&(s.clearCart(this.service),this.stateMachine&&this.stateMachine.clearUrl(),this._sendTrackerEvent("ThankYouForYourPurchase","Success"),i.publish(a.Events.MpfCartUpdated,{nbItems:0})),this},_createIframe(){if(this.isClickAndBuy&&r.isProduction()&&!this.isRenewal&&!this.isInnovateBusinessExperienceOrder)return this._sendIframeTracking(),e.createElement("iframe",{src:this.isEduOrMaker?"https://assets.3ds.com/store/tracking-store-individual.html":"https://assets.3ds.com/store/confirmation.html",class:"iframe-thanks-purchasing"})},_sendIframeTracking(){this.isEduOrMaker?this._sendTrackerEvent("ThankYouForYourPurchase_Individuals"):this._sendTrackerEvent("ThankYouForYourPurchase_Companies")},_renderMessage({status:e,I18n:t}){let i;return i=e===p.SUCCESS?this._renderPaymentCompleteMessage({I18n:t}):e===p.CANCELLED?this._renderPaymentCancelledMessage({I18n:t}):this._renderPaymentFailureMessage({I18n:t}),i},_sendTrackerPaymentCompleteIfCCAvenue({status:e}){e===p.SUCCESS?this._sendTrackerEvent(u.PAYMENT_COMPLETED):e===p.CANCELLED?this._sendTrackerEvent(u.PAYMENT_CANCELLED):e&&this._sendTrackerEvent(u.PAYMENT_DECLINED)},_sendTrackerEvent(e,t){const i=l.createEventBuilder({category:d.CHECKOUT,action:e});t&&i.setLabel(t),i.send()},_renderPaymentCompleteMessage({I18n:t}){const i=this.isClickAndBuy&&this.isEduOrMaker||this.isInnovateBusinessExperienceOrder?"mpf-grid-2":"mpf-grid-3";return[this.isRenewal?"":{tag:"div",class:"mpf-timeline-container "+i,html:this.isClickAndBuy&&this.isEduOrMaker||this.isInnovateBusinessExperienceOrder?[this._renderTimelineStatus({numberChar:"1",text:t.get("orderConfirmed"),isActive:!0,isBold:!0}),this._renderTimelineStatus({numberChar:"2",text:t.get("getStarted"),isActive:!1,isBold:!1})]:[this._renderTimelineStatus({numberChar:"1",text:t.get("orderConfirmed"),isActive:!0,isBold:!0}),this._renderTimelineStatus({numberChar:"2",text:t.get("subscriptionReady"),isActive:!1,isBold:!1}),this._renderTimelineStatus({numberChar:"3",text:t.get("dedicatedLearningSupport"),isActive:!1,isBold:!1})]},{tag:"div",class:"mpf-title-container",html:[{tag:"span",class:"fonticon fonticon-check"},{tag:"span",class:"mpf-title",html:t.get(this.isRenewal?"thankYouforRenewal":"thankYouforPurchase",{thankYou:e.createElement("span",{class:"mpf-bold",text:t.get("thankYou")}).outerHTML})}]},this.isRenewal?"":{tag:"div",class:"mpf-welcome",html:[{tag:"p",html:t.get("welcome",{firstName:e.createElement("span",{text:this.me?this.me.getFirstName():""}).outerHTML,lastName:e.createElement("span",{text:this.me?this.me.getLastName():""}).outerHTML})}]},this.isInnovateBusinessExperienceOrder?{tag:"div",class:"mpf-business-experience",text:t.get("businessExperience")}:"",this.isRenewal?{tag:"div",class:"mpf-license-renewal",html:t.get("licenseRenewal",{bold3D:e.createElement("b",{text:"3D"}).outerHTML})}:"",this.isRenewal?"":{tag:"ol",class:"mpf-ol-status",html:[{tag:"li",text:t.get("emailOrderConfirmation")},{tag:"li",html:this.isInnovateBusinessExperienceOrder?t.get("emailGetStartedBE",{bold3D:e.createElement("b",{text:"3D"}).outerHTML}):t.get("emailGetStarted",{bold3D:e.createElement("b",{text:"3D"}).outerHTML})},this.isClickAndBuy&&this.isEduOrMaker||this.isInnovateBusinessExperienceOrder?"":{tag:"li",html:t.get("accessDedicated",{bold3D:e.createElement("b",{text:"3D"}).outerHTML})},this.iframe]},this.isRenewal||this.isInnovateBusinessExperienceOrder?"":{tag:"div",class:"mpf-learn-more",html:this.isClickAndBuy&&this.isEduOrMaker?"":[{tag:"h5",text:t.get("learnMoreTitle")},{tag:"p",html:t.get("learnMore",{linkLearnMore:e.createElement("a",{target:"_blank",href:"https://www.3ds.com/store/get-started?utm_content=3ds&utm_term=companygspage&utm_source=ordconfpage",text:"click here to learn the essentials"}).outerHTML,bold3D:e.createElement("b",{text:"3D"}).outerHTML})}]},this.isRenewal?"":{tag:"div",class:"mpf-spam-folder-hint",text:t.get("spamFolderHint")},{tag:"div",class:"mpf-any-question",html:!this.isClickAndBuy&&this.service!==n.SUBSCRIPTIONS||!this.isEduOrMaker&&!this.isRenewal?"":[{tag:"p",html:t.get(this.isRenewal?"anyQuestionRenewal":"anyQuestionOrder",{linkFAQ:e.createElement("a",{target:"_blank",href:"https://www.3ds.com/store/faq",text:"FAQ"}).outerHTML,linkHere:e.createElement("a",{target:"_blank",href:"https://www.3ds.com/online-store/support-form/",text:"here"}).outerHTML})}]}]},_renderPaymentCancelledMessage:({I18n:e})=>[{tag:"div",class:"mpf-error-title-container",html:[{tag:"span",class:"fonticon fonticon-info"},{tag:"span",class:"mpf-title",html:e.get("paymentCancelled")}]},{tag:"div",class:"mpf-error-message-container",html:[{tag:"div",text:e.get("paymentCancelledMessage")}]}],_renderTimelineStatus:({numberChar:e,text:t,isActive:i,isBold:r})=>({tag:"div",class:"mpf-status",html:[{tag:"div",class:i?"mpf-circle mpf-active":"mpf-circle",text:e},{tag:"p",class:r?"mpf-bold":"mpf-paragraph",text:t}]}),_goToCart(){this.stateMachine?this.stateMachine.changePage(c.Pages.CART):this.dispatchEvent(h.GO_TO_CART)},_renderPaymentFailureMessage({I18n:t}){return[{tag:"div",class:"mpf-error-title-container",html:[{tag:"span",class:"fonticon fonticon-error"},{tag:"span",class:"mpf-title",html:t.get("anIssueOccured")}]},{tag:"div",class:"mpf-error-message-container",html:[{tag:"div",text:t.get("couldNotConfirmOrder")},{tag:"div",class:"mpf-check-payment-details",html:[{tag:"span",text:t.get("checkPaymentDetailsPart1")},{tag:"a",text:t.get("tryAgain"),events:{click:this._goToCart.bind(this)}},{tag:"span",text:t.get("checkPaymentDetailsPart2")}]},{tag:"div",html:t.get("stillFacingIssues",{linkForm:e.createElement("a",{target:"_blank",href:"https://www.3ds.com/online-store/support-form/",text:"online sales support form"}).outerHTML})},{tag:"div",text:t.get("sorryForInconvenience")}]}]},getOrderStatus(){return m(this.cart)},destroy(){this.cart=null,this.me=null,this.stateMachine=null,this._parent(),this.container=null}});return f.getOrderStatus=m,f.OrderStatus=p,f.Events=h,f})),define("DS/MPFClickAndBuyComponent/offerList/OfferListDataLoader",["DS/MPFServices/MarketplaceServices","DS/MPFCartModel/CartFactory","DS/MPFPortfolioModel/PortfolioFactory","DS/MPFPortfolioModel/PortfolioHelper","DS/MPFCartModel/CartModel","DS/MPFClickAndBuyComponent/CnbLanguageHelper","DS/MPFClickAndBuyComponent/ClickAndBuyStateMachine","DS/MPFUtils/StorageUtils"],(function(e,t,i,r,s,n,o,a){"use strict";return class{constructor({compassPortfolios:t,cartFactory:i,portfolioFactory:r,stateMachine:s,service:n=e.CLICK_AND_BUY}){this.compassPortfolios=t,this.cartFactory=i,this.portfolioFactory=r,this.stateMachine=s,this.service=n}async loadData({portfolioPacks:e,portfolioDependencies:s,offerTrigram:c,offerName:l,reloadLanguageFiles:d=!0}){const h=this.stateMachine.getCountry();if(e)try{await Promise.all([e.fetchPromise({country:h}),s?s.fetchPromise({country:h}):Promise.resolve(),this.compassPortfolios.fetchPromise()])}catch(e){console.error(e)}else if(c){(e=this.portfolioFactory.createPackCollection(i.Types.BY_TRIGRAM_V2)).productTrigram=r.addProductSuffix(c),(s=this.portfolioFactory.createCollection(i.Types.PRODUCT_DEPENDENCIES)).productTrigram=r.addProductSuffix(c);try{await Promise.all([e.fetchPromise({country:h}),s.fetchPromise({country:h}),this.compassPortfolios.fetchPromise()])}catch(e){console.error(e)}}else if(l){(e=this.portfolioFactory.createPackCollection(i.Types.BY_NAME)).searchName=l;try{await Promise.all([await e.fetchPromise({country:h}),this.compassPortfolios.fetchPromise()])}catch(e){console.error(e)}}let u;e.size()>0&&(e.forEach((e=>{e.setRoleInfo(this.compassPortfolios)})),u=this.cartFactory.createModel(t.Types.ME),a.hasStoredCart(this.service)&&a.loadStoredCart(this.service,u));const[p,m,f]=await n.loadLanguageFiles(["i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent","i18n!DS/MPFClickAndBuyComponent/assets/nls/SubscriptionInformation","i18n!DS/MPFClickAndBuyComponent/assets/nls/AvailableCountries"],{allowCache:!d});return this.stateMachine.clearSearchParams([o.UrlParams.COUNTRY,o.UrlParams.LANGUAGE]),{I18n:p,SubI18n:m,CountriesI18n:f,cart:u,portfolioPacks:e,portfolioDependencies:s}}}})),define("DS/MPFClickAndBuyComponent/offerList/OfferListSection",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFUtils/MPFUtils","DS/MPFPortfolioModel/PortfolioModel","DS/MPFClickAndBuyComponent/offerList/OfferTile","DS/MPFClickAndBuyComponent/ClickAndBuyCartHelper","DS/MPFPortfolioModel/LicensingHelper","DS/MPFClickAndBuyComponent/ClickAndBuyStateMachine","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],((e,t,i,r,s,n,o,a,c)=>{"use strict";const l=Object.freeze({ADD_TO_CART:"addToCart"}),d=t.extend({className:"mpf-offer-list-section",setup({stateMachine:e,isOfferSelectedByDefault:t=!1}={}){i.requiredOfPrototype(e,c,"options.stateMachine must be a ClickAndBuyStateMachine"),this.stateMachine=e,this.isOfferSelectedByDefault=t},render({cart:e,portfolioPack:t,I18n:i}){const r=t.getOffers();return this._destroyTiles(),this.tiles=this._createTiles({cart:e,portfolios:r,I18n:i}),this.container.setContent([{tag:"div",class:"mpf-product-tiles",html:this.tiles.map((e=>e.render()))}]),this},_renderTileContainer(){return e.createElement("div",{class:"mpf-product-tiles",html:this.tiles.map((e=>e.render()))})},_onSelectedTile(e){return this.tiles.forEach((t=>{t===e?!t.isDisabled()&&t.isSelected()?t.deselect():t.select():t.deselect()}))},_destroyTiles(){this.tiles&&this.tiles.forEach((e=>{this.stopListening(e),e.destroy()})),this.tiles=null},_createTiles({cart:e,portfolios:t,I18n:i}){const c=e.getItems(),d=r.findInArray(c,(e=>!a.isCredit(e.getLicensing()))),h=d&&d.getLicensingScheme(),u=h&&t.getPortfolioWithLicensingScheme(h);return t.sortBy((e=>-s.NumberMonths[e.getLicensingScheme()])).map((r=>{let s,a;o.getConflictingItems(e,r).conflictingItems.length>0||!h?(s=!1,a=t.isLongestLicensingScheme(r.getLicensingScheme())):r.isCreditOffer()?(s=!1,a=u?h===r.getLicensingScheme():t.isLongestLicensingScheme(r.getLicensingScheme())):(s=h!==r.getLicensingScheme(),a=h===r.getLicensingScheme());const c=new n({portfolio:r,disabled:s,selected:a&&this.isOfferSelectedByDefault,locale:this.stateMachine.getLocale(),I18n:i});return this.listenTo(c,n.Events.SELECTED,this._onSelectedTile.bind(this,c)),this.listenTo(c,n.Events.ADD_TO_CART,this.dispatchEvent.bind(this,l.ADD_TO_CART)),c}))},destroy(){this.stopListening(),this._destroyTiles(),this.stateMachine=null,this._parent(),this.container=null}});return d.Events=l,d})),define("DS/MPFClickAndBuyComponent/platformSelection/PlatformSelectionPage",["UWA/Class/View","DS/UIKIT/Mask","DS/MPFUtils/StorageUtils","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartFactory","DS/MPFTenantModel/TenantFactory","DS/MPFAmdLazyLoader/AmdLazyLoader","DS/MPFClickAndBuyComponent/ClickAndBuyStateMachine","DS/MPFClickAndBuyComponent/platformSelection/PlatformSelectionDataLoader","DS/MPFClickAndBuyComponent/platformSelection/TenantSelectionModal"],(function(e,t,i,r,s,n,o,a,c,l,d){"use strict";const h=Object.freeze({}),u=e.extend({className:"mpf-platform-selection-page",setup({stateMachine:e,cartFactory:t,tenantFactory:i,service:s}={}){r.requiredOfPrototype(e,c,"options.stateMachine must be a ClickAndBuyStateMachine"),r.requiredOfPrototype(t,n,"options.cartFactory must be a CartFactory"),r.requiredOfPrototype(i,o,"options.tenantFactory must be a TenantFactory"),this.stateMachine=e,this.service=s,this.dataLoader=new l({cartFactory:t,tenantFactory:i,service:s})},async load(){const{I18n:e,cart:t,platforms:i}=await this.dataLoader.loadData();return this.I18n=e,this.cart=t,this.platforms=i,this.platforms.length>0?1===this.platforms.length&&this.cart.isBeDev()?(await this._onPlatformSelected({selectedPlatform:this.platforms[0].get("id")}),{skipRendering:!0}):void(this.tenantSelectionModal=this._createTenantSelectionModal()):this.dataLoader.isIFWInCart(this.cart)?(this.stateMachine.changePage(c.Pages.CHECKOUT),{skipRendering:!0}):(this.stateMachine.changePage(c.Pages.CART,{errorMessage:this.I18n.get("noIfwInCart")}),{skipRendering:!0})},render(){return this.container.setContent([this.tenantSelectionModal.render({cart:this.cart,platforms:this.platforms,I18n:this.I18n})]),this},destroy(){this.cart=null,this.platforms=null,this.cartFactory=null,this.tenantFactory=null,this._parent(),this.container=null},_isIFWInCart(){return this.cart.getItems().some((e=>e.getProductTrigram().startsWith("IFW-")))},async _onPlatformSelected({selectedPlatform:e}){if(e&&"new"!==e){t.mask(this.container,this.I18n.get("checkoutLoading"));try{await this.dataLoader.saveSelectedPlatform({cart:this.cart,platform:e}),t.unmask(this.container),this.stateMachine.changePage(c.Pages.CHECKOUT)}catch(e){t.unmask(this.container),this.stateMachine.changePage(c.Pages.CART,{errorMessage:this.I18n.get("errorSavingCart")})}}else this.stateMachine.changePage(c.Pages.CHECKOUT)},_createTenantSelectionModal(){const e=new d;return this.listenTo(e,d.Events.CONTINUE,(({selectedPlatform:e})=>{this._onPlatformSelected({selectedPlatform:e})})),this.listenTo(e,d.Events.ON_HIDE,(()=>{this.stateMachine.changePage(c.Pages.CART)})),e}});return u.Events=h,u})),define("DS/MPFClickAndBuyComponent/checkout/PaymentRedirectResultPage",["UWA/Class/View","DS/UIKIT/Spinner","DS/MPFServices/ObjectService","DS/MPFCartModel/CartFactory","DS/MPFCartModel/CartModel","DS/MPFClickAndBuyComponent/CnbLanguageHelper","DS/MPFClickAndBuyComponent/ClickAndBuyStateMachine","DS/MPFClickAndBuyComponent/checkout/ThankYouForPurchasePanel","DS/MPFClickAndBuyComponent/ClicknbuyHeader"],(function(e,t,i,r,s,n,o,a,c){"use strict";const l=Object.freeze({PAYMENT_COMPLETED:"paymentCompleted"}),d=Object.freeze({SUCCESS:"success",FAILURE:"failure",CANCELLED:"cancelled"}),h=e.extend({className:"mpf-payment-redirect-result-page",setup({cartFactory:e,service:s,stateMachine:n,me:a}={}){i.requiredOfPrototype(n,o,"options.stateMachine must be a ClickAndBuyStateMachine"),i.requiredOfPrototype(e,r,"options.cartFactory must be a CartFactory"),this.stateMachine=n,this.cartFactory=e,this.service=s,this.me=a,this.spinner=new t,this.pageHeader=this._createPageHeader()},async load({cartId:e}){this.cart=this.cartFactory.createModel(r.Types.CART,{id:e}),await this.cart.fetchPromise({expands:[s.Expands.CART_ITEMS]});const t=a.getOrderStatus(this.cart);if(t===a.OrderStatus.CANCELLED||t===a.OrderStatus.FAILURE)try{await this.cart.savePromise({[s.Fields.STATE]:this.cart.isRenewal()?s.States.SUBMITTED:s.States.DRAFT},{patch:!0})}catch(e){console.error("Cart state reset failure.")}const[i]=await n.loadLanguageFiles(["i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent"],{allowCache:!0});this.I18n=i},render(){return this.component=this._createComponent(),this.container.setContent([this.pageHeader.render({title:this._setPageHeadertitle()}),this.component.render({I18n:this.I18n})]),this},destroy(){this.stopListening(),this._destroyComponent(),this.pageHeader.destroy(),this.pageHeader=null,this.cart=null,this.cartFactory=null,this.I18n=null,this.stateMachine=null,this._parent(),this.container=null},async _goBackToCart(){this.container.setContent([this.spinner.show()]),await this.cart.savePromise({[s.Fields.STATE]:s.States.DRAFT},{patch:!0}),this.stateMachine.changePage(o.Pages.CART)},_destroyComponent(){this.component&&(this.stopListening(this.component),this.component.destroy())},_createPageHeader(){return new c({stateMachine:this.stateMachine})},_setPageHeadertitle(){switch(this.component.getOrderStatus()){case d.SUCCESS:return this.cart.isRenewal()?this.I18n.get("renewalConfirmed"):this.I18n.get("orderConfirmed");case d.FAILURE:return this.cart.isRenewal()?this.I18n.get("renewalFailed"):this.I18n.get("orderNotConfirmed");case d.CANCELLED:return this.cart.isRenewal()?this.I18n.get("renewalCancelled"):this.I18n.get("orderCancelled")}},_createComponent(){this._destroyComponent();return new a({cart:this.cart,service:this.service,stateMachine:this.stateMachine,me:this.me})}});return h.Events=l,h})),define("DS/MPFClickAndBuyComponent/orderList/ProductCard",["UWA/Class/View","UWA/Core","DS/MPFUtils/FormatUtils","DS/UIKIT/Input/Select","DS/UIKIT/Badge","DS/UIKIT/Accordion","DS/MPFServices/MarketplaceServices","DS/MPFServices/ObjectService","DS/MPFPortfolioModel/LicensingHelper","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartItemModel","DS/MPFPortfolioModel/PortfolioModel","DS/MPFPortfolioModel/PortfolioHelper","DS/MPFClickAndBuyComponent/orderList/CustomNumberInput"],(function(e,t,i,r,s,n,o,a,c,l,d,h,u,p){"use strict";const m=Object.freeze({LICENSING_SCHEME_CHANGED:"licensingSchemeChanged",QUANTITY_CHANGED:"quantityChanged",REMOVE_ITEM:"removeItem",SHOW_OFFER_ITEMS_MODAL:"showOfferItemsModal"}),f=Object.freeze({ITEM_REMOVED:"ItemRemoved",QUANTITY_CHANGED:"QuantityChanged",OFFER_INFO_CART:"OfferInfoCart",ADDITIONAL_INFO:"AdditionalInfo"}),g=e.extend({className:"mpf-product-card",setup({cart:e,cartItems:t,portfolio:i,tracker:r,locale:s,service:n,I18n:o,SubI18n:c,licensingSchemeOptions:d}={}){a.requiredOfPrototype(e,l,"options.cart must be a CartModel"),a.requiredOfPrototype(i,h,"options.portfolio must be a PortfolioModel"),this.cart=e,this.cartItems=t,this.portfolio=i,this.locale=s,this.tracker=r,this.service=n,this.I18n=o,this.SubI18n=c,this.licensingSchemeOptions=d,this.licensingSchemeInput=this._createLicensingSchemeInput(),this.numberInput=this._createQuantityInput()},render({isMobileView:e}){if(this.portfolio){let t="";t=e?{tag:"div",class:"mpf-main-content",html:[{tag:"div",class:"mpf-header",html:[this._createNameCell(),this._getDeleteButton()]},{tag:"div",class:"mpf-prices",html:[this._getUnitPriceCell({isMobileView:e}),this._getTotalPriceCell({isMobileView:e})]},{tag:"div",class:"mpf-selections",html:[{tag:"div",class:"mpf-licensing-scheme-container",html:[{tag:"span",class:"mpf-label",text:this.I18n.get("subscription")},this.licensingSchemeInput]},{tag:"div",class:"mpf-quantity-container",html:[{tag:"span",class:"mpf-label",text:this.I18n.get("quantity")},this.numberInput]}]}]}:{tag:"div",class:"mpf-main-content",html:[this._createNameCell(),this.licensingSchemeInput,this.numberInput,this._getUnitPriceCell({isMobileView:e}),this._getTotalPriceCell({isMobileView:e}),this._getDeleteButton()]},this.container.setContent([t,{tag:"div",class:"mpf-sub-content",html:[this._getSubscriptionInfo(),this.portfolio.isBundleOffer()&&this._createDetailsContainer()]}])}else this.container.setContent([{tag:"div",class:"mpf-header",html:[{tag:"span",class:"mpf-not-available",text:this.I18n.get("Product not available in the selected country.")},this._getDeleteButton()]}]);return this},destroy(){this.stopListening(),this.licensingSchemeInput&&this.licensingSchemeInput.destroy&&this.licensingSchemeInput.destroy(),this.numberInput&&this.numberInput.destroy&&this.numberInput.destroy(),this.licensingSchemeInput=null,this.numberInput=null,this.cart=null,this.cartItems=null,this.portfolio=null,this.tracker=null,this.licensingSchemeOptions=null,this._parent(),this.container=null},_createNameCell(){let e="";e=this.portfolio.isBundleOffer()?this.portfolio.getExternalOfferId()&&this.I18n.get("productNumber")+" "+this.portfolio.getExternalOfferId():this.portfolio.getProductNumber()&&this.I18n.get("productNumber")+" "+this.portfolio.getProductNumber();return{tag:"div",class:"mpf-name-container",html:[{tag:"div",class:"mpf-name",html:{tag:"span",text:this.portfolio.getProductDisplayName()||this.portfolio.getProductName()}},{tag:"div",class:"mpf-product-number",text:e},this.portfolio.isBundleOffer()?this._createOfferItemsLink():""]}},_createOfferItemsLink(){return t.createElement("div",{class:"mpf-offer-items-link",html:[{tag:"span",class:"mpf-link",text:this.I18n.get("numberIncludedItems",{number:Object.keys(this.portfolio.getProducts()).length})},{tag:"span",class:"fonticon fonticon-eye"}],events:{click:()=>{this.tracker&&this.tracker.sendEvent({cart:this.cart,action:f.OFFER_INFO_CART,label:this.portfolio.getProductDisplayName()}),this.dispatchEvent(m.SHOW_OFFER_ITEMS_MODAL,{portfolio:this.portfolio})}}})},_createLicensingSchemeInput(){const e="QRC"===this.portfolio.getLicensingScheme()?"QSC":this.portfolio.getLicensingScheme(),i=this.service===o.SUBSCRIPTIONS||this.cart.isRenewal()||this.licensingSchemeOptions.length<2;return i?t.createElement("div",{class:"mpf-licensing-scheme mpf-text-type",name:e,text:this.licensingSchemeOptions.find((t=>t.value===e)).label}):new r({className:"mpf-licensing-scheme",placeholder:!1,value:e,options:this.licensingSchemeOptions,disabled:i,events:{onChange:this._onLicensingSchemeChange.bind(this)}})},_createQuantityInput(){const e=u.isEduOffer(this.portfolio)||u.isOfferExpired(this.portfolio)||this.cart.isRenewal(),i=this.cartItems[0],r=!!i.getOfferId(),s=c.isCredit(this.portfolio.getLicensing());let n=parseInt(r?i.getOfferQuantity():i.getQuantity());if(e)return n+=s?" "+this.I18n.get("credits"):1===n?" "+this.I18n.get("user"):" "+this.I18n.get("users"),t.createElement("div",{class:"mpf-quantity mpf-text-type",text:n});{const t=s?2500:1,i=u.isMakerOffer(this.portfolio)?5:99999;return n>i?(n=i,this._changeItemQuantities(n)):n<t&&(n=t,this._changeItemQuantities(n)),new p({className:"mpf-quantity",value:""+n,min:t,max:i,step:1,decimalPrecision:1,disabled:e,isCreditCount:s,I18n:this.I18n,events:{onChange:this._onQuantityChange.bind(this)}})}},_getUnitPriceCell({isMobileView:e}){let t;if(this.cart.isRenewal()){const e=this.cartItems.reduce(((e,t)=>e+t.getUnitNetAmount()),0);t=this._getPriceCell({price:e,className:"mpf-unit-price"})}else if(u.isOfferExpired(this.portfolio))t=this._renderExpiredMessage();else{const e=this.portfolio.getPricelistPrice();t=this._hasDiscountedPrice()?this._getDiscountedPriceCell({price:e,className:"mpf-unit-price",coupon:this.cart.getCouponSoftware()}):this._getPriceCell({price:e,className:"mpf-unit-price"})}return e?{tag:"div",class:"mpf-unit-price-container",html:[{tag:"span",class:"mpf-label",text:this.I18n.get("unitPrice")},t]}:t},_getTotalPriceCell({isMobileView:e}){let t;if(this.cart.isRenewal()){const e=this.cartItems.reduce(((e,t)=>e+t.getTotalNetAmount()),0);t=this._getPriceCell({price:e,className:"mpf-total-price"})}else if(u.isOfferExpired(this.portfolio))t={tag:"div",class:"mpf-expired-message-cell",text:"-"};else{const e=this.cartItems[0],i=e.getOfferId()?e.getOfferQuantity():e.getQuantity(),r=this.portfolio.getPricelistPrice()*i;t=this._hasDiscountedPrice()?this._getDiscountedPriceCell({price:r,className:"mpf-total-price",coupon:this.cart.getCouponSoftware()}):this._getPriceCell({price:r,className:"mpf-total-price"})}return e?{tag:"div",class:"mpf-total-price-container",html:[{tag:"span",class:"mpf-label",text:this.I18n.get("price")},t]}:t},_hasDiscountedPrice(){const e=this.cart.getCouponSoftware();return!!e&&(!!this.portfolio.getGroupId()&&e.getOfferPids().includes(this.portfolio.getId())||!this.portfolio.getGroupId()&&e.getProductSkuIds().includes(this.portfolio.getSkuId()))},_getPriceCell({price:e,className:t}){const r=this.cart.isRenewal()?this.cart.getCurrency():this.portfolio.getCurrency()||this.portfolio.getPricelistCurrency();return{tag:"div",class:t,text:i.formatPrice(e,{currency:r,locale:this.locale,codeStyle:!1})}},_getDiscountedPriceCell({price:e,className:r,coupon:s}){const n=this.portfolio.getCurrency()||this.portfolio.getPricelistCurrency(),o=e*(1-parseInt(s.getPercentage())/100);return t.createElement("div",{class:r+" mpf-discount",html:[{tag:"span",class:"mpf-old-price",text:i.formatPrice(e,{currency:n,locale:this.locale,codeStyle:!1})},{tag:"span",class:"mpf-new-price",text:i.formatPrice(o,{currency:n,locale:this.locale,codeStyle:!1})}]})},_getSubscriptionInfo(){const e=this.portfolio.getMidMarketPromotionName(),t=!!e&&e.startsWith("OS4P");return{tag:"div",class:"mpf-subscription-info",html:[{tag:"div",class:"mpf-renewal-text",text:this.portfolio.getRenewal()?this.portfolio.getRenewal():u.isRenewableOffer(this.portfolio)?this.portfolio.getRenewWith()?this.SubI18n.get("subscriptionsAndRenewals_text_renewable_renewWithDefined"):this.SubI18n.get("subscriptionsAndRenewals_text_renewable_renewWithBlank"):this.SubI18n.get("subscriptionsAndRenewals_text_noRenewable")},!!t&&{tag:"div",class:"mpf-helping-partner",text:this.I18n.get("helpingPartner")}]}},_createDetailsContainer(){return new n({className:"mpf-details-section",items:[{title:this.I18n.get("additionalInformation"),content:[this.portfolio.getOfferDetails()]}],events:{onOpen:()=>{this.tracker&&this.tracker.sendEvent({cart:this.cart,action:f.ADDITIONAL_INFO,label:this.portfolio.getProductDisplayName()})}}})},_getDeleteButton(){let e;return e=this.cart.isRenewal()?document.createElement("div",{class:"mpf-empty"}):t.createElement("span",{class:"fonticon fonticon-trash",events:{click:()=>{this.tracker&&this.tracker.sendEvent({cart:this.cart,action:f.ITEM_REMOVED,label:this.portfolio.getProductDisplayName()}),this.dispatchEvent(m.REMOVE_ITEM)}}}),e},_renderExpiredMessage(){return{tag:"div",class:"mpf-expired-message-cell",html:new s({content:this.I18n.get("offerExpired"),className:"warning",icon:"attention"})}},_changeItemQuantities(e){this.cartItems.forEach((t=>{t.getOfferId()?t.set(d.Fields.OFFER_QUANTITY,e):t.setQuantity(e)}))},_onLicensingSchemeChange(e){const t=e&&e.target.value,i="QRC"===this.cartItems[0].getLicensingScheme()?"QSC":this.cartItems[0].getLicensingScheme();t&&t!==i&&this.dispatchEvent(m.LICENSING_SCHEME_CHANGED,{newLicensingScheme:t,cart:this.cart,forCredits:this.portfolio.isCreditOffer()})},_onQuantityChange(e){const t=parseInt(e.target.value),i=!!this.cartItems[0].getOfferId(),r=parseInt(i?this.cartItems[0].getOfferQuantity():this.cartItems[0].getQuantity());if(t&&"number"==typeof t&&t!==r&&"Nan"!==r){this._changeItemQuantities(t);const e=t-r>0?"added":"removed";this.tracker&&this.tracker.sendEvent({cart:this.cart,action:f.QUANTITY_CHANGED,label:e,value:parseInt(t)}),this.dispatchEvent(m.QUANTITY_CHANGED)}else isNaN(t)&&this.numberInput.setValue(1)}});return g.Events=m,g})),define("DS/MPFClickAndBuyComponent/discoverBundle/DiscoverBundleComponent",["UWA/Class/View","UWA/Core","DS/MPFClickAndBuyComponent/discoverBundle/DiscoverBundleSection","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],((e,t,i)=>{"use strict";const r=Object.freeze({DISPLAY_INFO_BUNDLE:"displayInfoBundle"}),s=e.extend({className:"mpf-discover-bundle",setup({stateMachine:e}={}){this.stateMachine=e},render({bundles:e,I18n:t}){return this._destroySections(),e.length>0?(this.sections=this._createSections({bundles:e,I18n:t}),this.container.setContent([{tag:"div",class:"mpf-intro",text:t.get("interestingOffers")},...this.sections.map((e=>e.render()))])):this.container.setContent([]),this},_createSections({bundles:e,I18n:t}){return e.map((e=>{const s=new i({locale:this.stateMachine.getLocale(),bundle:e,I18n:t});return this.listenTo(s,i.Events.DISCOVER_BUNDLE,this.dispatchEvent.bind(this,r.DISPLAY_INFO_BUNDLE)),s}))},_destroySections(){this.sections&&this.sections.forEach((e=>{this.stopListening(e),e.destroy()}))},destroy(){this.stopListening(),this.stateMachine=null,this._parent(),this.container=null}});return s.Events=r,s})),define("DS/MPFClickAndBuyComponent/orderList/MarketingModal",["UWA/Class/View","DS/UIKIT/Modal","DS/MPFCartModel/CartItemModel","DS/MPFClickAndBuyComponent/MarketingPortfolioPage"],(function(e,t,i,r){"use strict";const s=Object.freeze({}),n=e.extend({className:"mpf-marketing-modal",setup({compassPortfolios:e}={}){this.compassPortfolios=e,this.modal=this._createModal()},render({I18n:e}){return this.I18n=e,this.container.setContent(this.modal),this},async show({item:e}){e instanceof i&&(e=e.omit());const t=this.compassPortfolios.getWithTrigram(e.productTrigram.split("-")[0]);this.modal.setHeader({tag:"h4",text:e?e.productDisplayName:t.getTitle()});const s=new r({portfolioInfo:t});this.modal.setBody(s.render()),this.modal.show()},hide(){this.modal.hide()},destroy(){this.modal.destroy(),this.modal=null,this.I18n=null,this.compassPortfolios=null,this._parent(),this.container=null},_createModal:()=>new t({className:"mpf-marketing-offer"})});return n.Events=s,n})),define("DS/MPFClickAndBuyComponent/orderList/OrderListContent",["UWA/Class/View","UWA/Core","DS/UIKIT/Mask","DS/MPFUtils/MPFUtils","DS/MPFCartModel/CartItemFactory","DS/MPFCartModel/CartItemModel","DS/MPFClickAndBuyComponent/ClickAndBuyCartHelper","DS/MPFClickAndBuyComponent/orderList/ProductCard","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],((e,t,i,r,s,n,o,a)=>{"use strict";const c=Object.freeze({ORDER_CHANGED:"orderChanged",SHOW_OFFER_ITEMS_MODAL:"showOfferItemsModal",REMOVE_ITEM_ERROR:"removeItemError"}),l=Object.freeze({SUB_TYPE_CHANGED:"SubTypeChange"}),d=e.extend({className:"mpf-order-list-content",setup(e={}){this.tracker=e.tracker,this.service=e.service,this.portfolioFactory=e.portfolioFactory,this.cartItemFactory=e.cartItemFactory},render({cart:e,portfolios:t,I18n:i,SubI18n:r,locale:s,isMobileView:n}){return this._clearCards(),this.cards=this._createCards({cart:e,portfolios:t,locale:s,I18n:i,SubI18n:r}),this.container.setContent([n?"":this._createListHeader(i),{tag:"div",class:"mpf-cards-list",html:this.cards.map((e=>e.render({isMobileView:n})))},{tag:"div",class:"mpf-quote-information",html:[{tag:"span",class:"fonticon fonticon-info"},{tag:"span",class:"mpf-quote-information-text",text:i.get("quoteInformation")}]}]),this},async _removeItems({cart:e,I18n:t,items:r,offerId:s}){i.mask(this.container,t.get("loading"));try{s?await o.removeItems(e,r,!0):await o.removeItem(e,r[0]),i.unmask(this.container),this.dispatchEvent(c.ORDER_CHANGED)}catch(e){i.unmask(this.container),console.error(e),this.dispatchEvent(c.REMOVE_ITEM_ERROR)}},_orderChanged(){this.dispatchEvent(c.ORDER_CHANGED)},_clearCards(){this.cards&&this.cards.length>0&&(this.cards.forEach((e=>{this.stopListening(e),e.destroy(),e=null})),this.cards=null)},_createCards({cart:e,portfolios:t,locale:i,I18n:r,SubI18n:s}){const n=this._groupItemsByOfferId({cart:e});this.filteredPortfolios=o.filterCommonLicensingSchemesPortfolios({portfolios:t,portfolioFactory:this.portfolioFactory,offers:n});const l=this._getLicensingSchemeOptions({I18n:r}),d=this._getLicensingSchemeOptions({I18n:r,forCredits:!0});return n.map((t=>{let n;n=t.offerId?this.filteredPortfolios.find((e=>e.get("id")===t.offerId)):this.filteredPortfolios.find((e=>e.getSkuId()===t.skuId));const o=new a({cart:e,portfolio:n,locale:i,I18n:r,SubI18n:s,licensingSchemeOptions:n.isCreditOffer()?d:l,cartItems:t.items,tracker:this.tracker,service:this.service});return this.listenTo(o,a.Events.REMOVE_ITEM,this._removeItems.bind(this,{cart:e,I18n:r,...t})),this.listenTo(o,a.Events.QUANTITY_CHANGED,this._orderChanged.bind(this)),this.listenTo(o,a.Events.LICENSING_SCHEME_CHANGED,(({newLicensingScheme:e,cart:t,forCredits:i})=>{this._licensingSchemeChanged({I18n:r,newLicensingScheme:e,cart:t,forCredits:i})})),this.listenTo(o,a.Events.SHOW_OFFER_ITEMS_MODAL,this.dispatchEvent.bind(this,c.SHOW_OFFER_ITEMS_MODAL)),o}))},_groupItemsByOfferId({cart:e}){const i=[];return e.getItems().forEach((e=>{const s=e.getOfferId();if(s){const n=r.findInArray(i,(e=>e.offerId===s));t.is(n)?n.items.push(e):i.push({offerId:s,items:[e]})}else i.push({skuId:e.getSkuId(),items:[e]})})),i},_getLicensingSchemeOptions({I18n:e,forCredits:t}){let i=[];return(t?this.filteredPortfolios.filter((e=>e.isCreditOffer())):this.filteredPortfolios.filter((e=>!e.isCreditOffer()))).forEach((e=>{const t="QRC"===e.getLicensingScheme()?"QSC":e.getLicensingScheme();i.includes(t)||i.push(t)})),i.map((t=>{let i;switch(t){case"YSC":i={value:"YSC",label:e.get("yearly")};break;case"MSC":i={value:"MSC",label:e.get("monthly")};break;case"QSC":i={value:"QSC",label:e.get("quarterly")};break;default:i=[]}return i}))},async _licensingSchemeChanged({I18n:e,newLicensingScheme:t,cart:r,forCredits:a}){i.mask(this.container,e.get("loading"));let d=[];this._groupItemsByOfferId({cart:r}).forEach((e=>{const i=e.items[0];if(!i.isCreditOffer()&&!a||i.isCreditOffer()&&a)if(e.skuId){let e=this.filteredPortfolios.getByLicensingSchemeAndTrigramOrOfferId({licensingScheme:t,trigram:i.getProductTrigram()}),r=i.getQuantity(),o=this.cartItemFactory.createModel(s.Types.CART_CART_ITEM,{[n.Fields.QUANTITY]:r,[n.Fields.SKU_ID]:e.getSkuId(),[n.Fields.PRODUCT_TRIGRAM]:e.getProductTrigram(),[n.Fields.LICENSING_SCHEME]:e.getLicensingScheme()});d.push({itemToRemove:i,itemToAdd:o})}else if(e.offerId){let r=this.filteredPortfolios.getByLicensingSchemeAndTrigramOrOfferId({licensingScheme:t,offerId:e.offerId}),o=i.getOfferQuantity(),a=[];a=r.getSoftwareOfferDetails().map((e=>this.cartItemFactory.createModel(s.Types.CART_CART_ITEM,{...e,[n.Fields.OFFER_QUANTITY]:o,[n.Fields.QUANTITY]:e.quantity*o,[n.Fields.OFFER_ID]:r.get("id"),[n.Fields.LICENSING_SCHEME]:r.getLicensingScheme()}))),d.push({itemToRemove:e.items,itemToAdd:a})}})),await o.removeAndAddItems({cart:r,portfolios:this.filteredPortfolios,itemsToBeReplaced:d}),this.tracker&&this.tracker.sendEvent({cart:r,action:l.SUB_TYPE_CHANGED,label:t}),i.unmask(this.container),this.dispatchEvent(c.ORDER_CHANGED)},_createListHeader:e=>({tag:"div",class:"mpf-list-header",html:[{tag:"div",class:"mpf-product",text:e.get("products")},{tag:"div",class:"mpf-licensing-scheme",text:e.get("subscription")},{tag:"div",class:"mpf-quantity",text:e.get("quantity")},{tag:"div",class:"mpf-unit-price",text:e.get("unitPrice")},{tag:"div",class:"mpf-total-price",text:e.get("price")},{tag:"div",class:"mpf-remove"}]}),destroy(){this.stopListening(),this._clearCards(),this.cart=null,this.tracker=null,this.filteredPortfolios=null,this._parent(),this.container=null}});return d.Events=c,d})),define("DS/MPFClickAndBuyComponent/orderList/PriceDetails",["UWA/Class/View","UWA/Core","DS/UIKIT/Input/Button","DS/UIKIT/Tooltip","DS/UIKIT/Spinner","DS/WebappsUtils/WebappsUtils","DS/MPFServices/ObjectService","DS/MPFTaxModel/TaxEstimationModel","DS/MPFClickAndBuyComponent/orderList/PriceAndTaxHandler","DS/MPFClickAndBuyComponent/orderList/SecureTransaction"],(function(e,t,i,r,s,n,o,a,c,l){"use strict";const d=Object.freeze({GO_TO_PAYMENT:"goToPayment",SECURE_TRANSACTION_CLICKED:"secureTransactionClicked",VIEW_TAX_DETAILS:"viewTaxDetails",ON_TAXES_LOADED:"onTaxesLoaded"}),h=Object.freeze({LOADING_TAX:"loadingTax",TAX_NOT_AVAILABLE:"taxNotAvailable",TAX_LOADED:"taxLoaded"}),u=e.extend({className:"mpf-price-details",setup({taxEstimation:e,stateMachine:t,priceAndTaxHandler:i,service:r}){o.requiredOfPrototype(e,a,"options.taxEstimation must be a TaxEstimationModel"),this.taxEstimation=e,this.stateMachine=t,this.priceAndTaxHandler=i,this.service=r,this.state=h.LOADING_TAX,this.taxEstimationSpinner=new s,this.totalSpinner=new s,this.listenTo(this.priceAndTaxHandler,c.Events.TAXES_LOADED,this.render.bind(this))},render({I18n:e,moreInformationLink:t}={}){e&&(this.I18n=e),t&&(this.moreInformationLink=t),this.paymentButton=this._createPaymentButton(),this.secureTransaction=this._createSecureTransaction({moreInformationLink:this.moreInformationLink});const{total:i,oldSubtotal:r,subtotal:s,tax:n,currency:o,state:a,isPayable:c}=this.priceAndTaxHandler.getPriceInfos();return c?this.paymentButton.enable():this.paymentButton.disable(),this.container.setContent([{tag:"div",class:"mpf-price-details-header",text:this.I18n.get("priceDetails")},this._createSubTotalLine({oldSubtotal:r,subtotal:s,currency:o}),this._createTaxEstimationLine({state:a,subtotal:s,tax:n,currency:o}),this._createTotalEstimationLine({state:a,total:i,subtotal:s,currency:o}),this.paymentButton,{tag:"div",class:"mpf-price-details-footer",html:[this.renderIcons(),this.secureTransaction.render({I18n:this.I18n})]}]),this},resetState(){this.state=h.LOADING_TAX},enablePaymentButton(){this.paymentButton.enable()},disablePaymentButton(){this.paymentButton.disable()},destroy(){this.stopListening(),this.paymentButton&&this.paymentButton.destroy(),this.secureTransaction&&this.secureTransaction.destroy(),this.taxEstimationSpinner.destroy(),this.totalSpinner.destroy(),this.taxEstimationSpinner=null,this.totalSpinner=null,this.paymentButton=null,this.secureTransaction=null,this.stateMachine=null,this.taxEstimation=null,this.priceAndTaxHandler=null,this.I18n=null,this.moreInformationLink=null,this._parent(),this.container=null},_createSubTotalLine({oldSubtotal:e,subtotal:t,currency:i}){let r;return r=t?this.priceAndTaxHandler.formatPrice(t,i):0,t!==e?this._createDiscountedSubtotal({oldSubtotal:this.priceAndTaxHandler.formatPrice(e,i),newPrice:r}):this._createLine({className:"mpf-subtotal",label:this.I18n.get("subtotal"),price:r})},_createTaxEstimationLine({state:e,subtotal:i,tax:s,currency:n}){const o=t.createElement("div",{class:"fonticon fonticon-i-question"});let a;return new r({target:o,trigger:"hover touch",body:this.I18n.get("taxInformation"),events:{onShow:this.dispatchEvent.bind(this,d.VIEW_TAX_DETAILS)}}),e===c.States.INITIAL?a=this.taxEstimationSpinner.show():e===c.States.TAX_LOADED?a="number"==typeof s&&n?this.priceAndTaxHandler.formatPrice(s,n):0!==i?this.I18n.get("notAvailableYet"):"0":e===c.States.TAX_NOT_AVAILABLE&&(a=this.I18n.get("notAvailableYet")),this._createLine({className:"mpf-estimated-tax",label:[this.I18n.get("estimatedTax"),o],price:a})},_createTotalEstimationLine({state:e,total:t,subtotal:i,currency:r}){let s;return s=e===c.States.INITIAL?this.totalSpinner.show():this.priceAndTaxHandler.formatPrice(t||i,r),this._createLine({className:"mpf-estimated-total",label:this.I18n.get("estimatedTotal"),price:s})},_createLine:({className:e,label:t,price:i})=>({tag:"div",class:e+" mpf-line",html:[{tag:"span",class:"mpf-label",html:t},{tag:"span",class:"mpf-price",html:[i]}]}),_createDiscountedSubtotal({oldSubtotal:e,newPrice:t}){return{tag:"div",class:"mpf-subtotal mpf-line",html:[{tag:"span",class:"mpf-label",html:this.I18n.get("subtotal")},{tag:"span",class:"mpf-price mpf-discount",html:[{tag:"span",class:"mpf-old-price",text:e},{tag:"span",class:"mpf-new-price",text:t}]}]}},_createPaymentButton(){return new i({className:"primary mpf-payment-button",value:this.I18n.get("checkout"),icon:"shopping-cart",events:{onClick:this.dispatchEvent.bind(this,d.GO_TO_PAYMENT)}})},_createSecureTransaction(){const e=new l({moreInformationLink:this.moreInformationLink});return this.listenTo(e,l.Events.SECURE_TRANSACTION_CLICKED,this.dispatchEvent.bind(this,d.SECURE_TRANSACTION_CLICKED)),e},renderIcons(){return{tag:"div",class:"mpf-icon-container",html:[{tag:"img",class:"mpf-bank-card-icon mpf-visa-icon",src:this._getImageSourceFor("VISA_512px.png")},{tag:"img",class:"mpf-bank-card-icon mpf-master-card-icon",src:this._getImageSourceFor("MasterCard_512px.png")},{tag:"img",class:"mpf-bank-card-icon mpf-amex-card-icon",src:this._getImageSourceFor("american-express.png")}]}},_getImageSourceFor:e=>n.getWebappsAssetUrl("MPFClickAndBuyComponent","graphics/pictures/")+e});return u.Events=d,u})),define("DS/MPFClickAndBuyComponent/checkout/CabCheckoutPage",["UWA/Class/View","DS/MPFUtils/StorageUtils","DS/MPFServices/ObjectService","DS/MPFServices/MarketplaceServices","DS/MPFAmdLazyLoader/AmdLazyLoader","DS/MPFClickAndBuyComponent/ClickAndBuyTracker","DS/MPFClickAndBuyComponent/ClickAndBuyCartHelper","DS/MPFPortfolioModel/PortfolioFactory","DS/MPFError/ValidationError","DS/MPFCartModel/CartFactory","DS/MPFClickAndBuyComponent/CnbLanguageHelper","DS/MPFClickAndBuyComponent/ClickAndBuyStateMachine","DS/MPFView/TemporaryBanner"],(function(e,t,i,r,s,n,o,a,c,l,d,h,u){"use strict";const p=Object.freeze({ON_ERROR:"onError",ON_CHECKOUT_LOADED:"onCheckoutLoaded",ON_CLOSED:"onClosed",ON_PAYMENT_COMPLETED:"onPaymentCompleted"}),m=e.extend({className:"mpf-click-and-buy-checkout-page",setup({stateMachine:e,cartFactory:t,portfolioFactory:r,tracker:s,service:o,my3dExpConnector:c}){i.requiredOfPrototype(e,h,"options.stateMachine must be a ClickAndBuyStateMachine"),i.requiredOfPrototype(t,l,"options.cartFactory must be a CartFactory"),i.requiredOfPrototype(r,a,"options.portfolioFactory must be a PortfolioFactory"),i.requiredOfPrototype(s,n,"options.tracker must be a ClickAndBuyTracker"),this.stateMachine=e,this.cartFactory=t,this.portfolioFactory=r,this.tracker=s,this.service=o,this.my3dExpConnector=c},async load({I18n:e,cart:i,portfolios:r}={}){i?this.cart=i:(this.cart=this.cartFactory.createModel(l.Types.ME),t.loadStoredCart(this.service,this.cart)),this.portfolios=r||await o.loadCartItemPortfolios({cart:this.cart,country:this.stateMachine.getCountry(),portfolioFactory:this.portfolioFactory}),e?this.I18n=e:[this.I18n]=await d.loadLanguageFiles(["i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent"]),this.tracker.trackPage({cart:this.cart,url:window.location.pathname,title:n.Titles.CHECKOUT,portfolios:this.portfolios}),this.checkoutPage&&(this.stopListening(this.checkoutPage),this.checkoutPage.destroy()),await this._loadCheckoutPage()},render(){return this.container.setContent([this.checkoutPage.render()]),this},destroy(){this.stopListening(),this.checkoutPage&&this.checkoutPage.destroy(),this.checkoutPage=null,this.temporaryBanner=null,this.stateMachine=null,this.tracker=null,this.cart=null,this.portfolios=null,this.I18n=null,this.cartFactory=null,this.portfolioFactory=null,this._parent(),this.container=null},async _loadCheckoutPage(){const e=new URL(this.stateMachine.isCurrentUrlACompassUrl()||this.stateMachine.isUrlDedicatedPage()?this.stateMachine.generateNewUrl(h.Pages.PAYMENT_RESULT):this._generateMy3dExperienceUrl());e.searchParams.append(h.UrlParams.ORDER_ID,this.cart.get("id"));try{const[i]=await s.getInstance().get(["DS/MPFCheckoutPage/CheckoutPageFactory"]);this.checkoutPage=await i.createComponent({cartId:this.cart.get("id"),service:r.CLICK_AND_BUY,paymentResultUrl:e.toString()}),this.listenTo(this.checkoutPage,i.Events.BACK_TO_CART,(({cart:e})=>{t.storeCart(this.service,e,{merge:!0}),this.stateMachine.changePage(h.Pages.CART)})),this.listenTo(this.checkoutPage,i.Events.PAYMENT_DONE,(()=>{this.stateMachine.changePage(h.Pages.PAYMENT_RESULT,{cartId:this.cart.get("id")})})),this.dispatchEvent(p.ON_CHECKOUT_LOADED)}catch(e){this._handleError(e)}},_handleError(e){console.error(e);const t=this._parseCheckoutError(e);this.stateMachine.changePage(h.Pages.CART,{errorMessage:t}),this.dispatchEvent(p.ON_ERROR,e)},_parseCheckoutError(e){const t=e&&e.response;let i;if(t)switch(t.errorCode){case"Error.EduLicenceLimited":i=this.I18n.get("eduLicenceAlreadyPurchased");break;case"Error.EduCartProcessing":i=this.I18n.get("cartModificationsInProgress");break;case"Error.PrereqMandatory":i=this.I18n.get("ifwIsMandatory");break;case"Error.MakersLicenceLimited":i=this.I18n.get("makersLicenceLimited");break;case"Error.NsrOnly":i=this.I18n.get("errorPurchaseWithoutPlatform");break;case"Error.IncompatibleProductsTypes":i=this.I18n.get("errorIncompatibleProductTypes");break;default:i=this.I18n.get("errorSavingCart")}else i=e&&e instanceof c&&"MaxChargeExceeded"===e.errorCode?this.I18n.get("maxChargeExceeded"):this.I18n.get("errorSavingCart");return i},_generateMy3dExperienceUrl(){const e=new URL(window.location.href),t=this.my3dExpConnector&&this.my3dExpConnector.rootUrl?this.my3dExpConnector.rootUrl:e.origin.replace(/(-)\w+(.3dexperience|.3dx-staging).3ds.com/,"$1my3dexperience$2"),i=this.my3dExpConnector?this.my3dExpConnector.tenant:this.cartFactory.connector.tenant;return e.searchParams.append(h.UrlParams.TENANT,i),`${t}/cnb/${h.PageToUrlMap.get(h.Pages.PAYMENT_RESULT)}${e.search}`},_createTemporaryBanner:()=>new u({message:"We are currently upgrading our systems. Please complete your order once the upgrade is over on Wednesday, May 22nd. We are sorry for the inconvenience.",from:new Date("2024-05-20T22:00:00Z"),until:new Date("2024-05-21T21:59:59Z")})});return m.Events=p,m})),define("DS/MPFClickAndBuyComponent/orderList/OrderListDataLoader",["DS/MPFUtils/StorageUtils","DS/MPFCartModel/CartFactory","DS/MPFCartModel/CartItemFactory","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartItemModel","DS/MPFPortfolioModel/PortfolioFactory","DS/MPFPortfolioModel/PortfolioHelper","DS/MPFClickAndBuyComponent/ClickAndBuyCartHelper","DS/MPFClickAndBuyComponent/CnbLanguageHelper","DS/MPFClickAndBuyComponent/ClickAndBuyStateMachine","DS/MPFClickAndBuyComponent/platformSelection/PlatformSelectionDataLoader","DS/MPFError/ValidationError"],(function(e,t,i,r,s,n,o,a,c,l,d,h){"use strict";return class{constructor({psp:e,compassPortfolios:t,stateMachine:i,service:r,cartFactory:s,cartItemFactory:n,portfolioFactory:o,tenantFactory:a,priceAndTaxHandler:c}){this.psp=e,this.compassPortfolios=t,this.stateMachine=i,this.service=r,this.cartFactory=s,this.cartItemFactory=n,this.portfolioFactory=o,this.priceAndTaxHandler=c,this.platformLoader=new d({cartFactory:s,tenantFactory:a})}async loadData({cart:a,cartId:d,offerTrigram:h,offerName:u,licencingScheme:p,quantity:m=1,reloadLanguageFiles:f=!0}){const[g,C,P]=await c.loadLanguageFiles(["i18n!DS/MPFClickAndBuyComponent/assets/nls/MPFClickAndBuyComponent","i18n!DS/MPFClickAndBuyComponent/assets/nls/SubscriptionInformation","i18n!DS/MPFClickAndBuyComponent/assets/nls/AvailableCountries"],{allowCache:!f});a=a||this.cartFactory.createModel(t.Types.ME);const I=this.stateMachine.getCountry();let y;if(p&&(u||h)){let t,r;if(u)t=this.portfolioFactory.createPackCollection(n.Types.BY_NAME),t.searchName=u,await Promise.all([t.fetchPromise({country:I}),this.compassPortfolios.fetchPromise()]);else{t=this.portfolioFactory.createPackCollection(n.Types.BY_TRIGRAM_V2),t.productTrigram=o.addProductSuffix(h);const e=this.portfolioFactory.createPackCollection(n.Types.PRODUCT_DEPENDENCIES);e.productTrigram=o.addProductSuffix(h),await Promise.all([t.fetchPromise({country:I}),e.fetchPromise({country:I}),this.compassPortfolios.fetchPromise()]),r=e.map((e=>e.getOffers().getPortfolioWithLicensingScheme(p)))}if(y=this.portfolioFactory.createCollection(n.Types.PORTFOLIO,[]),t.size()>0){const n=t.first().getOffers().getPortfolioWithLicensingScheme(p);if(n){let o;t.first().getOffers().forEach((e=>y.push(e))),o=n.isBundleOffer()?n.getSoftwareOfferDetails().map((e=>this.cartItemFactory.createModel(i.Types.CART_CART_ITEM,{...e,[s.Fields.OFFER_QUANTITY]:m,[s.Fields.QUANTITY]:e.quantity*m,[s.Fields.OFFER_ID]:n.get("id"),[s.Fields.LICENSING_SCHEME]:n.getLicensingScheme()}))):[this.cartItemFactory.createModel(i.Types.CART_CART_ITEM,{[s.Fields.QUANTITY]:m,[s.Fields.SKU_ID]:n.getSkuId(),[s.Fields.PRODUCT_TRIGRAM]:n.getProductTrigram(),[s.Fields.LICENSING_SCHEME]:n.getLicensingScheme()})],r&&r.length>0&&r.forEach((e=>{const t=e.getSkuId(),r=e.getProductTrigram(),n=y.find((e=>e.isBundleOffer()?e.containsProductWithTrigram(r):e.getSkuId()===t));n||y.push(e);o.find((e=>e.getSkuId()?e.getSkuId()===t:e.getProductTrigram()===r))||o.push(this.cartItemFactory.createModel(i.Types.CART_CART_ITEM,{[s.Fields.QUANTITY]:m,[s.Fields.SKU_ID]:e.getSkuId(),[s.Fields.PRODUCT_TRIGRAM]:e.getProductTrigram(),[s.Fields.LICENSING_SCHEME]:e.getLicensingScheme()}))})),a.setItems(o),e.storeCart(this.service,a),this.stateMachine.clearSearchParams([l.UrlParams.LICENCING_SCHEME,l.UrlParams.COUNTRY,l.UrlParams.LANGUAGE])}}}else if(d){a.set("id",d);try{await a.fetchPromise({expand:[r.Expands.CART_ITEMS]}),!a.isRenewal()&&e.storeCart(this.service,a),y=await this._loadCartItemPortfolios({cart:a,country:I}),this.stateMachine.clearSearchParams([l.UrlParams.COUNTRY,l.UrlParams.LANGUAGE])}catch(e){throw a=null,y=null,console.log(e),e}}else a.isNew()?e.loadStoredCart(this.service,a):e.storeCart(this.service,a),y=await this._loadCartItemPortfolios({cart:a,country:I}),this.stateMachine.clearSearchParams([l.UrlParams.COUNTRY,l.UrlParams.LANGUAGE]);return await this.priceAndTaxHandler.loadTaxes({cart:a,portfolios:y}),this.I18n=g,this.cart=a,this.portfolios=y,{I18n:g,SubI18n:C,CountriesI18n:P,cart:a,portfolios:y}}async _loadCartItemPortfolios({cart:e,country:t}){const[i]=await Promise.all([a.loadCartItemPortfolios({cart:e,country:t,portfolioFactory:this.portfolioFactory,needAllLicensingSchemes:!0}),this.compassPortfolios.fetchPromise()]);return i}async checkAndSaveCart(){let t,i;try{await a.checkCartMaxChargeCompliance({cart:this.cart,portfolios:this.portfolios,country:this.stateMachine.getCountry(),psp:this.psp,service:this.service,redirectUrlParam:{key:l.UrlParams.GO_TO_PAYMENT,value:!0}});const s=this.stateMachine.getCountry();if(this.cart.getState()!==r.States.SUBMITTED||this.cart.isRenewal()||await this.cart.savePromise({[r.Fields.STATE]:r.States.DRAFT},{patch:!0}),this.cart.isNew()?await a.saveCartAndItems(this.cart,this.portfolios,{country:s}):await a.patchCartAndItems(this.cart,this.portfolios,{country:s}),e.storeCart(this.service,this.cart),this.cart.isRenewal())i=l.Pages.CHECKOUT;else{const e=await this.platformLoader.loadPrivatePlatforms({cart:this.cart});e.length>0?1===e.length&&this.cart.isBeDev()?(await this.platformLoader.saveSelectedPlatform({cart:this.cart,platform:e[0].get("id")}),i=l.Pages.CHECKOUT):i=this.cart.hasMakerItems()||this.cart.hasEduItems()?l.Pages.CHECKOUT:l.Pages.PLATFORM_SELECTION:this.platformLoader.isIFWInCart(this.cart)?i=l.Pages.CHECKOUT:t=this.I18n.get("noIfwInCart")}}catch(e){t=e&&e instanceof h&&"MaxChargeExceeded"===e.errorCode?this.I18n.get("maxChargeExceeded"):this._parseCheckoutError(e)}return{errorMessage:t,newPage:i}}_parseCheckoutError(e){const t=e&&e.response;let i;if(t)switch(t.errorCode){case"Error.EduLicenceLimited":i=this.I18n.get("eduLicenceAlreadyPurchased");break;case"Error.EduCartProcessing":i=this.I18n.get("cartModificationsInProgress");break;case"Error.PrereqMandatory":i=this.I18n.get("ifwIsMandatory");break;case"Error.MakersLicenceLimited":i=this.I18n.get("makersLicenceLimited");break;case"Error.NsrOnly":i=this.I18n.get("errorPurchaseWithoutPlatform");break;case"Error.IncompatibleProductsTypes":i=this.I18n.get("errorIncompatibleProductTypes");break;default:i=this.I18n.get("errorSavingCart")}else i=this.I18n.get("errorSavingCart");return i}}})),define("DS/MPFClickAndBuyComponent/offerList/IconRoleSection",["UWA/Class/View","UWA/Core","DS/WebappsUtils/WebappsUtils","DS/MPFServices/ObjectService","DS/MPFPortfolioModel/PortfolioPackModel","DS/MPFClickAndBuyComponent/orderList/MarketingModal","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],((e,t,i,r,s,n)=>{"use strict";return e.extend({className:"mpf-icon-role-section",setup({compassPortfolios:e}={}){this.marketingModal=new n({compassPortfolios:e})},render({portfolioPack:e,I18n:t}){let i;return r.requiredOfPrototype(e,s,"options.portfolioPack must be a PortfolioPackModel"),i=e.isBundle()?[this.marketingModal.render({I18n:t}),{tag:"div",class:"mpf-section-title",text:t.get("includedRoles").toUpperCase()},{tag:"div",class:"mpf-icon-list",html:this._createIcons({portfolioPack:e})}]:[],this.container.setContent(i),this},_displayMarketingModal(e,t){this.marketingModal.show({compassPortfolio:e,item:t})},_createIconRoleContainer:e=>t.createElement("img",{src:i.getWebappsAssetUrl("i3DXCompass","v3.1/images/role")+"/"+e+"_Role.png"}),_createIcons({portfolioPack:e}){return e.getOffers().first().getSoftwareOfferDetails().map((i=>{const r=i.productTrigram,s=r.lastIndexOf("-"),n=e.getCompassRoleInfo(r.slice(0,s)),o=i.productDisplayName;return t.is(n)?t.createElement("div",{class:"mpf-role-icon",events:{click:this._displayMarketingModal.bind(this,n,i)},html:[this._createIconRoleContainer(n.getBrand().toUpperCase()),t.createElement("div",{text:o,class:"mpf-role-title"}),t.createElement("div",{class:"mpf-overlay",html:t.createElement("div",{class:"fonticon fonticon-2x fonticon-play"})})]}):""}))},destroy(){this.marketingModal.destroy(),this.marketingModal=null,this._parent(),this.container=null}})})),define("DS/MPFClickAndBuyComponent/orderList/Coupon",["UWA/Core","UWA/Class/View","DS/MPFClickAndBuyComponent/orderList/CouponInput","DS/MPFCartModel/CartModel","DS/MPFCouponModel/CouponCreationFactory","DS/MPFServices/ObjectService"],(function(e,t,i,r,s,n){"use strict";const o=Object.freeze({NO_COUPON:"noCoupon",VALID_COUPON:"validCoupon",INVALID_COUPON:"invalidCoupon"}),a=Object.freeze({ORDER_CHANGED:"orderChanged"}),c=Object.freeze({COUPON_TERMS:"CouponTerms"}),l=Object.freeze({NO_QUALIFIED_ITEMS:"Error.HasNoQualifiedItems",INVALID:"Error.CouponInvalid",EXPIRED:"Error.CouponCampaignClosed",NOT_ACTIVE:"Error.CouponCampaignNotStarted",MIN_ORDER:"Error.CouponMinOrder",SERVICE:"Error.CouponService",CURRENCY:"Error.CouponCurrency",QUANTITY_REACHED:"Error.CouponCampaignQuantityReached"}),d=t.extend({className:"mpf-coupon",setup({tracker:e,couponFactory:t,priceAndTaxHandler:i}={}){n.requiredOfPrototype(t,s,"couponFactory must be a CouponCreationFactory"),this.tracker=e,this.couponFactory=t,this.priceAndTaxHandler=i,this.couponInput=this._createCouponInput(),this.state=o.NO_COUPON},render({I18n:e,cart:t}={}){return this.I18n=e,this.cart=t,(this.cart.getCouponSoftware()||this.coupon)&&(this.cart.getCouponSoftware()||this.couponInput.getValue()&&this.coupon.getCommercialName()===this.couponInput.getValue()?this._validate():this.state=o.NO_COUPON),this.container.setContent([{tag:"div",class:"mpf-coupon-header",text:this.I18n.get("coupon")},this.couponInput.render({I18n:e,cart:t}),this._createCouponSubcontent(),this._createCouponTermsLink()]),this},destroy(){this.stopListening(),this.couponInput.destroy(),this.cart=null,this.coupon=null,this.couponInput=null,this.errorMessage=null,this.tracker=null,this._parent(),this.container=null},_createCouponSubcontent(){let t="";if(this.state===o.INVALID_COUPON)t=e.createElement("div",{class:"mpf-coupon-subcontent",html:[{tag:"p",class:"mpf-coupon-error",text:this.errorMessage}]});else if(this.state===o.VALID_COUPON){const{oldSubtotal:i,subtotal:r,currency:s}=this.priceAndTaxHandler.getPriceInfos();t=e.createElement("div",{class:"mpf-coupon-subcontent",html:[{tag:"div",class:"mpf-coupon-discount",text:this.I18n.get("percentageDiscount",{percentage:parseInt(this.coupon.getPercentage())})},{tag:"div",class:"mpf-coupon-total-saved",text:this.I18n.get("savedAmount",{amount:this.priceAndTaxHandler.formatPrice(i-r,s)})}]})}return t},_createCouponInput(){const e=new i;return this.listenTo(e,i.Events.APPLY_COUPON,this._applyCoupon.bind(this)),this.listenTo(e,i.Events.CLEAR_COUPON,this._clearCoupon.bind(this)),e},_createCouponTermsLink(){return e.createElement("div",{class:"mpf-coupon-link",html:[{tag:"span",class:"fonticon fonticon-tag-alt"},{tag:"a",class:"mpf-coupon-terms",text:this.I18n.get("couponTerms")}],events:{click:()=>{this.tracker&&this.tracker.sendEvent({action:c.COUPON_TERMS}),window.open("https://www.3ds.com/store/about#Brick-c0f5de5a-16fa-41b7-afb6-ac20788a38c1","_blank")}}})},_clearCoupon(){this.state=o.NO_COUPON,this.coupon=null,this.cart.getCouponSoftware()?this._removeCouponFromCart():this.render({I18n:this.I18n,cart:this.cart})},_removeCouponFromCart(){this.cart.getCouponSoftware()&&(this.cart.set(r.Fields.COUPON_SOFTWARE,""),this.dispatchEvent(a.ORDER_CHANGED))},async _applyCoupon(){if(!this.cart.getCouponSoftware()&&this.couponInput.getValue()||this.cart.getCouponSoftware()&&this.cart.getCouponSoftware().getCommercialName()!==this.couponInput.getValue()){this.coupon=this.couponFactory.createModel(s.Types.BY_NAME),this.coupon.couponName=this.couponInput.getValue();try{await this.coupon.fetchPromise(),this._validate()||this.render({I18n:this.I18n,cart:this.cart})}catch(e){this.state=o.INVALID_COUPON,this.errorMessage=this._handleError(e),this.couponInput.addClassName("mpf-coupon-error"),this.coupon=null,this.cart.getCouponSoftware()?this._removeCouponFromCart():this.render({I18n:this.I18n,cart:this.cart})}}},_validate(){const e=this.cart.getCouponSoftware();let t=!1;return this._hasQualifiedItems()?(this.state=o.VALID_COUPON,t=!0,this.coupon?(!e||e&&e.getCommercialName()!==this.coupon.getCommercialName())&&(this.cart.set(r.Fields.COUPON_SOFTWARE,this.coupon),this.couponInput.removeClassName("mpf-coupon-error"),this.dispatchEvent(a.ORDER_CHANGED)):this.coupon=e):(this.state=o.INVALID_COUPON,this.errorMessage=this._handleError({response:{errorCode:l.NO_QUALIFIED_ITEMS}}),this.couponInput.addClassName("mpf-coupon-error"),this._removeCouponFromCart()),t},_hasQualifiedItems(){const e=this.coupon||this.cart.getCouponSoftware();return this.cart.getItems().some((t=>t.getOfferId()?e.getOfferPids().includes(t.getOfferId()):e.getProductSkuIds().includes(t.getSkuId())))},_handleError(e){const t=e&&e.response;let i;if(t)switch(t.errorCode){case l.EXPIRED:i=this.I18n.get("errorCouponExpired");break;case l.NOT_ACTIVE:i=this.I18n.get("errorCouponNotActive");break;case l.MIN_ORDER:i=this.I18n.get("errorCouponMinOrder");break;case l.CURRENCY:i=this.I18n.get("errorCouponCurrency");break;case l.QUANTITY_REACHED:i=this.I18n.get("errorCouponUsageLimit");break;case l.NO_QUALIFIED_ITEMS:i=this.I18n.get("errorNoQualifyItems");break;default:i=this.I18n.get("errorInvalidCoupon")}return i}});return d.Events=a,d})),define("DS/MPFClickAndBuyComponent/ClearCartModal",["UWA/Class/View","DS/UIKIT/Modal","DS/UIKIT/Input/Button","DS/UIKIT/Alert","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFClickAndBuyComponent/ClickAndBuyCartHelper"],((e,t,i,r,s,n,o)=>{"use strict";const a=Object.freeze({ON_CANCEL:"onCancel",ON_ITEMS_DELETED:"onItemsDeleted",ON_HIDE:"onHide"}),c=e.extend({className:"mpf-clear-cart-modal",setup(){this.submitButton=this._createSubmitButton(),this.cancelButton=this._createCancelButton(),this.alert=this._createAlert(),this.modal=this._createModal(this.submitButton,this.cancelButton)},render(){return this.container.setContent(this.modal),this},show({cart:e,conflictingItems:t,conflictType:i,portfolio:r,addedQuantity:a,I18n:c}){let l,d,h,u;if(s.requiredOfPrototype(e,n,"options.cart must be a CartModel"),s.requiredOfType(t,"array","Expected array of conflicting items as argument"),s.requiredOfType(i,"string","options.conflictType must be a string"),this.cart=e,this.conflictingItems=t,i===o.ConflictTypes.EDU_NON_EDU){const e=this._isItemAcOffer(this.conflictingItems[0]);h=c.get(e?"educational":"nonEducational"),u=c.get(e?"nonEducational":"educational"),l=c.get("eduCartConflictMessage",{existingType:h,newType:u}),d=c.get("eduConflictButtonLabel",{existingType:h})}else if(i===o.ConflictTypes.EDU_IN_CART)l=c.get("eduProdAlreadyInCartMsg"),d=c.get("deleteDuplicates");else if(i===o.ConflictTypes.MAKERS_NON_MAKERS){const e=this.conflictingItems[0].isMakerItem();h=c.get(e?"makers":"nonMakers"),u=c.get(e?"nonMakers":"makers"),l=c.get("makersCartConflictMessage",{existingType:h,newType:u}),d=c.get("eduConflictButtonLabel",{existingType:h})}return this.submitButton.removeEvent("onClick"),this.submitButton.addEvent("onClick",this._deleteItems.bind(this,{portfolio:r,addedQuantity:a,I18n:c})),this.submitButton.setValue(d),this.cancelButton.setValue(c.get("cancel")),this.modal.setHeader({tag:"h4",text:c.get("eduCartConflictHeader")}),this.modal.setBody([this.alert,l]),this.modal.show(),this},hide(){return this.modal.hide(),this},destroy(){this.modal.destroy(),this.cart=null,this.conflictingItems=null,this._parent(),this.container=null},_setLoading(e=!0){this.submitButton.load(e),this.cancelButton.setDisabled(e)},_isItemAcOffer(e){const t=e.getProductTrigram();return t&&t.endsWith("AC")},_deleteItems({portfolio:e,addedQuantity:t}){const i=this.cart.getItems().filter((e=>!this.conflictingItems.includes(e)));this.cart.clear(),this.cart.setItems(i),this.dispatchEvent(a.ON_ITEMS_DELETED,{portfolio:e,quantity:t}),this.hide()},_getAllItemsFromOffer(e){const t=[],i=e.map((e=>e.getOfferId()));return this.cart.getItems().forEach((e=>{-1!==i.indexOf(e.getOfferId())&&t.push(e)})),t},_createModal(e,i){return new t({footer:[e,i],events:{onHide:this.dispatchEvent.bind(this,a.ON_HIDE)}})},_createAlert:()=>new r({autoHide:!0,visible:!1}),_createSubmitButton:()=>new i({className:"primary"}),_createCancelButton(){return new i({events:{onClick:()=>{this.dispatchEvent(a.ON_CANCEL),this.hide()}}})}});return c.Events=a,c})),define("DS/MPFClickAndBuyComponent/offerList/OfferListComponent",["UWA/Class/View","DS/MPFView/EmptyView","UWA/Core","DS/UIKIT/Badge","DS/UIKIT/Popover","DS/MPFServices/MarketplaceServices","DS/MPFServices/ObjectService","DS/MPFPortfolioModel/compass/CompassPortfolioCollection","DS/MPFClickAndBuyComponent/offerList/OfferDescriptionComponent","DS/MPFClickAndBuyComponent/offerList/IconRoleSection","DS/MPFClickAndBuyComponent/offerList/OfferListSection","DS/MPFPortfolioModel/PortfolioHelper","DS/MPFClickAndBuyComponent/ClickAndBuyStateMachine","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],((e,t,i,r,s,n,o,a,c,l,d,h,u)=>{"use strict";const p=Object.freeze({ADD_TO_CART:"addToCart",BACK:"back",ON_CHANGE_COUNTRY:"onChangeCountry"}),m=e.extend({className:"mpf-offer-list-component",setup({compassPortfolios:e,stateMachine:t,service:i=n.CLICK_AND_BUY}={}){o.requiredOfPrototype(e,a,"options.compassPortfolios must be a CompassPortfolioCollection"),o.requiredOfPrototype(t,u,"options.stateMachine must be a ClickAndBuyStateMachine"),this.stateMachine=t,this.service=i,this.iconRoleSection=new l({compassPortfolios:e}),this.descriptionSection=new c,this.offerSection=this._createOfferSection()},render({I18n:e,cart:t,portfolioPack:r}){const s=[this.descriptionSection.render({portfolioPack:r})];if(r.isBundle()){const t=this._createEduOrMakersProductMessage({portfolioPack:r,I18n:e});s.push(t),this._createPopover({portfolioPack:r,badge:t})}return s.push(this.iconRoleSection.render({portfolioPack:r,I18n:e})),r.getOffers().size()>1&&s.push(i.createElement("div",{class:"mpf-select-subs-label",text:e.get("selectSubscriptionPlan").toUpperCase()})),s.push(this.offerSection.render({cart:t,portfolioPack:r,I18n:e})),this.container.setContent(s),this},_createPopover({portfolioPack:e,badge:t}){const i=e.getOffers().first();if(i.get("eligibility")&&i.get("eligibilityToolTip"))return new s({target:t.elements.icon,trigger:"hover",body:i.get("eligibilityToolTip")})},_createIconRoleSection:({portfolioPack:e})=>e.isBundle()?new l({portfolioPack:e}):t.getInstance(),_createDescriptionComponent:({portfolioPack:e})=>new c({portfolioPack:e}),_createButtonContainer(){return i.createElement("div",{class:"mpf-buttons",html:this.backButton})},_createEduOrMakersProductMessage({portfolioPack:e,I18n:t}){let i;const s=e.getOffers().first();return i=s.get("eligibility")?s.get("eligibility"):h.isEduOffer(s)?t.get("eduIndividualUseMessage"):t.get("makersConsumersUseMessage"),new r({className:"primary mpf-edu-notice",content:i,closable:!1,selectable:!1,icon:s.get("eligibility")&&"info"})},_createOfferSection(){const e=new d({stateMachine:this.stateMachine,isOfferSelectedByDefault:!0});return this.listenTo(e,d.Events.ADD_TO_CART,this.dispatchEvent.bind(this,p.ADD_TO_CART)),e},destroy(){this.stopListening(),this.descriptionSection.destroy(),this.iconRoleSection.destroy(),this.offerSection.destroy(),this.descriptionSection=null,this.iconRoleSection=null,this.offerSection=null,this.stateMachine=null,this.service=null,this._parent(),this.container=null}});return m.Events=p,m})),define("DS/MPFClickAndBuyComponent/orderList/MobileFooter",["UWA/Class/View","DS/UIKIT/Spinner","DS/UIKIT/Input/Button","DS/MPFServices/ObjectService","DS/MPFClickAndBuyComponent/orderList/PriceAndTaxHandler"],(function(e,t,i,r,s){"use strict";const n=Object.freeze({GO_TO_PAYMENT:"goToPayment"}),o=e.extend({className:"mpf-mobile-footer",setup({priceAndTaxHandler:e,priceDetailsComponent:i}={}){this.priceAndTaxHandler=e,this.priceDetailsComponent=i,this.spinner=new t,this.checkoutBtnObserver=new IntersectionObserver(this._handleIntersect.bind(this),{threshold:.5}),this.listenTo(this.priceAndTaxHandler,s.Events.TAXES_LOADED,this._onTaxUpdate.bind(this))},render({I18n:e}={}){e&&(this.I18n=e);const{total:t,subtotal:r,currency:o,state:a,isPayable:c}=this.priceAndTaxHandler.getPriceInfos();let l,d;return a===s.States.INITIAL?l=this.spinner.show():a===s.States.TAX_NOT_AVAILABLE||isNaN(parseFloat(t))?(l=this.priceAndTaxHandler.formatPrice(r,o),d=this.I18n.get("taxExcl")):a===s.States.TAX_LOADED&&(l=this.priceAndTaxHandler.formatPrice(t,o)),this.container.setContent([{tag:"div",class:"mpf-left-column",html:[{tag:"div",class:"mpf-total-price",html:l},d&&{tag:"div",class:"mpf-comment",text:d}]},new i({className:"primary mpf-payment-button",value:this.I18n.get("checkout"),icon:"shopping-cart",disabled:!c,events:{onClick:()=>{this.dispatchEvent(n.GO_TO_PAYMENT)}}})]),this},destroy(){this.stopListening(),this.checkoutBtnObserver.disconnect(),this.spinner.destroy(),this.checkoutBtnObserver=null,this.spinner=null,this.priceAndTaxHandler=null,this.priceDetailsComponent=null,this.I18n=null,this._parent(),this.container=null},updateObserver(){this.checkoutBtnObserver.takeRecords().forEach((e=>{this.checkoutBtnObserver.unobserve(e.target)}));const e=this.priceDetailsComponent.container.getElement(".mpf-payment-button");e&&this.checkoutBtnObserver.observe(e)},_onTaxUpdate(){this.render(),this.updateObserver()},_handleIntersect(e){e[0].isIntersecting?this.container.addClassName("mpf-off"):this.container.removeClassName("mpf-off")}});return o.Events=n,o})),define("DS/MPFClickAndBuyComponent/offerList/OfferListPage",["UWA/Class/View","DS/UIKIT/Alert","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/MPFUtils/StorageUtils","DS/MPFClickAndBuyComponent/ClickAndBuyCartHelper","DS/MPFClickAndBuyComponent/offerList/OfferListDataLoader","DS/MPFClickAndBuyComponent/ClickAndBuyStateMachine","DS/MPFClickAndBuyComponent/ClickAndBuyTracker","DS/MPFClickAndBuyComponent/ClicknbuyHeader","DS/MPFClickAndBuyComponent/offerList/AvailableCountriesComponent","DS/MPFClickAndBuyComponent/offerList/OfferListComponent","DS/MPFClickAndBuyComponent/discoverBundle/DiscoverBundleComponent","DS/MPFClickAndBuyComponent/SubscriptionInformationComponent","DS/MPFClickAndBuyComponent/ClearCartModal","DS/MPFClickAndBuyComponent/PreReqModal","DS/MPFClickAndBuyComponent/ErrorPage","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],(function(e,t,i,r,s,n,o,a,c,l,d,h,u,p,m,f,g){"use strict";const C=Object.freeze({ADD_TO_CART:"addToCart"}),P=Object.freeze({OFFER:"offer",BUNDLE_DETAILS:"bundleDetails"}),I=e.extend({className:"mpf-offer-list-page",setup({stateMachine:e,service:t,compassPortfolios:i,countries:r,cartFactory:s,portfolioFactory:n,tracker:a}={}){this.stateMachine=e,this.service=t,this.tracker=a,this.dataLoader=new o({compassPortfolios:i,cartFactory:s,portfolioFactory:n,stateMachine:e,service:t}),this.alert=this._createAlert(),this.clearCartModal=this._createClearCartModal(),this.preReqModal=this._createPreReqModal({compassPortfolios:i}),this.pageHeader=this._createPageHeader(),this.countrySelect=this._createCountrySelect({countries:r,stateMachine:e}),this.offerList=this._createOfferList({compassPortfolios:i}),this.bundleSection=this._createBundleSection(),this.subcriptionInfo=this._createSubscriptionInformationComponent(),this.backButton=this._createBackButton(),this.errorPage=new g,this.state=P.OFFER},load({portfolioPacks:e,portfolioDependencies:t,offerTrigram:i,offerName:r,reloadLanguageFiles:s}){return this.dataLoader.loadData({portfolioPacks:e,portfolioDependencies:t,offerTrigram:i,offerName:r,reloadLanguageFiles:s}).then((({cart:e,portfolioPacks:t,portfolioDependencies:i,I18n:s,SubI18n:n,CountriesI18n:o})=>{this.cart=e,this.portfolioPacks=t,this.portfolioDependencies=i,this.I18n=s,this.SubI18n=n,this.CountriesI18n=o,this.offerName=r}))},render(){let e;const t=this.stateMachine.getBundleParam();return t?(e=this.portfolioPacks.find((e=>e.getDisplayName()===t)),this.backButton.setValue(this.I18n.get("back"))):e=this.portfolioPacks.getStandardOffer()||this.portfolioPacks.first(),e?this.container.setContent([this.clearCartModal.render(),this.preReqModal.render(),this.alert,this.pageHeader.render({portfolioPack:e,I18n:this.I18n}),{tag:"div",class:"mpf-cab-main-panel",html:[this.countrySelect.render({I18n:this.CountriesI18n}),this.offerList.render({portfolioPack:e,cart:this.cart,I18n:this.I18n})]},this.subcriptionInfo.render({I18n:this.SubI18n,portfolioPack:e}),!!t&&{tag:"div",class:"mpf-back-button-container",html:[this.backButton]}]):this.container.setContent([this.pageHeader.render({title:this.I18n.get("offerNotFound")}),this.countrySelect.render({I18n:this.CountriesI18n}),this.errorPage.render({I18n:this.I18n,error:g.Errors.OFFER_NOT_FOUND})]),this.tracker&&this.tracker.trackPage({cart:this.cart,url:window.location.pathname,title:c.Titles.OFFER,portfolioPacks:e&&[e],offerName:this.offerName}),this},destroy(){this.stopListening(),this.clearCartModal.destroy(),this.preReqModal.destroy(),this.pageHeader.destroy(),this.countrySelect.destroy(),this.offerList.destroy(),this.bundleSection.destroy(),this.subcriptionInfo.destroy(),this.errorPage.destroy(),this.clearCartModal=null,this.preReqModal=null,this.pageHeader=null,this.countrySelect=null,this.offerList=null,this.bundleSection=null,this.subcriptionInfo=null,this.errorPage=null,this.I18n=null,this.SubI18n=null,this.CountriesI18n=null,this.cart=null,this.portfolioPacks=null,this.stateMachine=null,this.dataLoader=null,this._parent(),this.container=null},_displayPreReqModal({portfolio:e,quantity:t}){if(e.isBundleOffer()||0===this.portfolioDependencies.length){const i=e.isBundleOffer()?n.addOffer(this.cart,e,t):n.saveSubscriptionAndPreReq(this.cart,e,t,[]);return r.mask(this.container,this.I18n.get("loading")),i.then((()=>{r.unmask(this.container),s.storeCart(this.service,this.cart)})).then((()=>{this.stateMachine.changePage(a.Pages.CART)}))}this.preReqModal.show({cart:this.cart,selectedPortfolio:e,portfolioDependencies:this.portfolioDependencies,productQuantityAddedToCart:t,locale:this.stateMachine.getLanguage(),I18n:this.I18n})},_createPageHeader(){return new l({stateMachine:this.stateMachine})},_createCountrySelect({countries:e,stateMachine:t}){const i=new d({stateMachine:t,countries:e,tracker:this.tracker});return this.listenTo(i,d.Events.ON_CHANGE_COUNTRY,(({requiresLanguageChange:e})=>{requirejs.defined("DS/MPFCheckoutPage/CheckoutPageFactory")&&e&&(this.stateMachine.isCurrentUrlACompassUrl()||this.stateMachine.isUrlDedicatedPage())?window.location.reload():(r.mask(this.container,this.I18n.get("loading")),this.load({portfolioPacks:this.portfolioPacks,portfolioDependencies:this.portfolioDependencies,reloadLanguageFiles:e}).then((()=>{r.unmask(this.container),this.render()})))})),i},_createOfferList({compassPortfolios:e}){const t=new h({stateMachine:this.stateMachine,cart:this.cart,service:this.service,compassPortfolios:e});return this.listenTo(t,h.Events.ADD_TO_CART,(({portfolio:t,quantity:i})=>{const{conflictingItems:r,conflictType:s}=n.getConflictingItems(this.cart,t);r.length>0?this.clearCartModal.show({cart:this.cart,conflictingItems:r,conflictType:s,portfolio:t,addedQuantity:i,I18n:this.I18n}):n.hasMakerItemsExceededLimit(this.cart,{portfolio:t,quantity:i})?this.alert.add({className:"error",message:this.I18n.get("makerItemLimit",{nb:parseInt(this.cart.getItems()[0].getOfferQuantity())})}).show():this._displayPreReqModal({portfolio:t,quantity:i,compassPortfolios:e})})),t},_createBundleSection(){const e=new u({stateMachine:this.stateMachine});return this.listenTo(e,u.Events.DISPLAY_INFO_BUNDLE,(({bundle:e})=>{this.stateMachine.setBundleParam(e.getDisplayName()),this.render()})),e},_createSubscriptionInformationComponent:()=>new p,_createBackButton(){return new i({events:{onClick:()=>{this.stateMachine.clearSearchParams([a.UrlParams.BUNDLE]),this.render()}}})},_createClearCartModal(){const e=new m;return this.listenTo(e,m.Events.ON_ITEMS_DELETED,(({portfolio:e,quantity:t})=>{this._displayPreReqModal({portfolio:e,quantity:t})})),this.listenTo(e,m.Events.ON_CANCEL,(()=>{this.dispatchEvent(C.ADD_ADDITIONAL_ITEMS)})),this.listenTo(e,m.Events.ON_HIDE,(()=>{e.hide()})),e},_createPreReqModal({compassPortfolios:e}){const t=new f({service:this.service,compassPortfolios:e});return this.listenTo(t,f.Events.PRE_REQ_ADDED,(()=>{this.stateMachine.changePage(a.Pages.CART)})),t},_createAlert:()=>new t({visible:!1,autoHide:!0,hideDelay:1e4,closable:!0})});return I.States=P,I.Events=C,I})),define("DS/MPFClickAndBuyComponent/orderList/OrderList",["UWA/Class/View","UWA/Core","UWA/Event","DS/UIKIT/Alert","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/MPFUtils/StorageUtils","DS/MPFServices/ObjectService","DS/MPFServices/MarketplaceServices","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartFactory","DS/MPFCartModel/CartItemFactory","DS/MPFCouponModel/CouponCreationFactory","DS/MPFPspModel/PspModel","DS/MPFTaxModel/TaxEstimationModel","DS/MPFPortfolioModel/PortfolioFactory","DS/MPFPortfolioModel/compass/CompassPortfolioCollection","DS/MPFCountryModel/CountryCollection","DS/MPFPortfolioModel/PortfolioHelper","DS/MPFClickAndBuyComponent/orderList/PriceAndTaxHandler","DS/MPFClickAndBuyComponent/orderList/OrderListDataLoader","DS/MPFClickAndBuyComponent/ClickAndBuyStateMachine","DS/MPFClickAndBuyComponent/ClickAndBuyTracker","DS/MPFClickAndBuyComponent/orderList/OrderListContent","DS/MPFClickAndBuyComponent/offerList/AvailableCountriesComponent","DS/MPFClickAndBuyComponent/ErrorPage","DS/MPFClickAndBuyComponent/orderList/EmptyCartComponent","DS/MPFClickAndBuyComponent/orderList/OrderListTitle","DS/MPFClickAndBuyComponent/orderList/PriceDetails","DS/MPFClickAndBuyComponent/orderList/Coupon","DS/MPFClickAndBuyComponent/orderList/MobileFooter","DS/MPFClickAndBuyComponent/orderList/OfferItemsModal","css!DS/MPFClickAndBuyComponent/MPFClickAndBuyComponent"],((e,t,i,r,s,n,o,a,c,l,d,h,u,p,m,f,g,C,P,I,y,E,S,T,_,M,A,D,F,O,v,k)=>{"use strict";const N=Object.freeze({ADD_ADDITIONAL_ITEMS:"addAdditionalItems",GO_TO_PAYMENT:"goToPayment",DISPLAY_CHECKOUT:"displayCheckout",REDIRECT_TO_COMPASS:"compassRedirection",CHECKOUT_CLOSED:"checkoutClosed",ON_COUNTRY_CHANGE:"onCountryChange",ORDER_UPDATED:"orderUpdated"}),b=Object.freeze({CART_MORE_ITEMS:"CartMoreItems",GO_TO_PAYMENT:"GoToPayment",REASSURE_PAYMENT:"ReassurePayment",CART_TAX_DETAILS:"Cart_TaxDetails"}),L=e.extend({className:"mpf-order-list",domEvents:{resize:"_onResize"},setup({psp:e,taxEstimation:t,compassPortfolios:i,countries:r,portfolioFactory:s,cartFactory:n,cartItemFactory:o,tenantFactory:c,couponFactory:l,stateMachine:P,tracker:S,moreInformationLink:T,service:_,showPageHeader:A=!0,showCountrySelect:D=!0}={}){a.requiredOfPrototype(e,p,"options.psp must be a PspModel"),a.requiredOfPrototype(t,m,"options.taxEstimation must be a TaxEstimationModel"),a.requiredOfPrototype(P,E,"options.stateMachine must be a ClickAndBuyStateMachine"),a.requiredOfPrototype(i,g,"options.compassPortfolios must be a CompassPortfolioCollection"),a.requiredOfPrototype(r,C,"options.countries must be a CountryCollection"),a.requiredOfPrototype(s,f,"options.portfolioFactory must be a PortfolioFactory"),a.requiredOfPrototype(n,d,"options.cartFactory must be a CartFactory"),a.requiredOfPrototype(o,h,"options.cartItemFactory must be a CartItemFactory"),a.requiredOfPrototype(s,f,"options.portfolioFactory must be a PortfolioFactory"),a.requiredOfPrototype(l,u,"options.couponFactory must be a CouponCreationFactory"),this.countries=r,this.service=_,this.portfolioFactory=s,this.cartItemFactory=o,this.couponFactory=l,this.stateMachine=P,this.tracker=S,this.showPageHeader=A,this.showCountrySelect=D,this.moreInformationLink=T||"https://discover.3ds.com/privacy-policy",this.isMobileView=!1,this.priceAndTaxHandler=new I({stateMachine:P,taxEstimation:t,service:_}),this.dataLoader=new y({psp:e,compassPortfolios:i,stateMachine:P,service:_,cartFactory:n,cartItemFactory:o,portfolioFactory:s,tenantFactory:c,priceAndTaxHandler:this.priceAndTaxHandler}),this.alert=this._createAlert(),this.offerItemsModal=new k({compassPortfolios:i}),this.orderListTitle=this._createOrderListTitle(),this.availableCountriesComponent=this._createAvailableCountriesComponent(),this.orderListContent=this._createOrderListContent(),this.priceDetails=this._createPriceDetails({taxEstimation:t,stateMachine:P,priceAndTaxHandler:this.priceAndTaxHandler}),this.coupon=this._createCoupon(),this.mobileFooter=this._createMobileFooter(),this.errorPage=new M,this.emptyCartComponent=this._createEmptyCartComponent()},load({offerName:e,offerTrigram:t,licencingScheme:i,quantity:r,cartId:s,loadedCart:n,reloadLanguageFiles:o}={}){return this.dataLoader.loadData({offerName:e,offerTrigram:t,licencingScheme:i,quantity:r,cartId:s,cart:n,reloadLanguageFiles:o}).then((({I18n:e,SubI18n:t,CountriesI18n:i,cart:r,portfolios:s})=>{this.cart=r,this.portfolios=s,this.I18n=e,this.SubI18n=t,this.CountriesI18n=i}))},render(){const e=this.stateMachine.getLocale(),i=this.cart.isRenewal(),r=this.showCountrySelect&&!i&&this.availableCountriesComponent.render({I18n:this.CountriesI18n}),s=this.cart.getItems();if(s.length>0&&this.portfolios.size()>0){const s=t.createElement("div",{class:"mpf-order-list-body",html:[{tag:"div",class:"mpf-order-list-container",html:[this.orderListContent.render({cart:this.cart,portfolios:this.portfolios,I18n:this.I18n,SubI18n:this.SubI18n,locale:e,isMobileView:this.isMobileView}),{tag:"div",class:"mpf-price-coupon-container",html:[this.priceDetails.render({cart:this.cart,portfolios:this.portfolios,locale:e,I18n:this.I18n,moreInformationLink:this.moreInformationLink}),!i&&this.coupon.render({I18n:this.I18n,cart:this.cart})]}]},this.isMobileView&&r]}),n=[this.alert,this.offerItemsModal.render(),{tag:"div",class:"mpf-order-list-header",html:[this.showPageHeader&&this.orderListTitle.render({cart:this.cart,I18n:this.I18n}),!this.isMobileView&&r]},i?this._createRenewalWarning(this.I18n):"",s,this.mobileFooter.render({I18n:this.I18n})];this.container.setContent(n)}else s.length>0?this.container.setContent([this.showCountrySelect&&this.availableCountriesComponent.render({I18n:this.CountriesI18n}),this.errorPage.render({I18n:this.I18n,error:M.Errors.OFFER_NOT_FOUND})]):this.container.setContent([this.showCountrySelect&&this.availableCountriesComponent.render({I18n:this.CountriesI18n}),this.emptyCartComponent.render({I18n:this.I18n})]);return this.tracker&&this.tracker.trackPage({cart:this.cart,url:window.location.pathname,title:S.Titles.QUOTE,portfolios:this.portfolios}),this._goToPaymentIfUrlParamFound(),this.mobileFooter.updateObserver(),this},destroy(){this.stopListening(),this.alert.destroy(),this.offerItemsModal.destroy(),this.orderListTitle.destroy(),this.availableCountriesComponent&&this.availableCountriesComponent.destroy(),this.orderListContent.destroy(),this.priceDetails.destroy(),this.coupon.destroy(),this.mobileFooter.destroy(),this.errorPage.destroy(),this.emptyCartComponent&&this.emptyCartComponent.destroy(),this.dataLoader=null,this.alert=null,this.offerItemsModal=null,this.orderListTitle=null,this.availableCountriesComponent=null,this.orderListContent=null,this.priceDetails=null,this.coupon=null,this.mobileFooter=null,this.errorPage=null,this.emptyCartComponent=null,this.priceAndTaxHandler=null,this.cart=null,this.portfolios=null,this.countries=null,this.tracker=null,this.I18n=null,this.SubI18n=null,this.CountriesI18n=null,this._parent(),this.container=null},_hasExpiredItems(){return this.portfolios.some((e=>P.isOfferExpired(e)))},_onOrderChanged(){o.storeCart(this.service,this.cart),this.priceAndTaxHandler.resetTaxes({cart:this.cart,portfolios:this.portfolios}),this.render(),this.priceAndTaxHandler.updateTaxes({cart:this.cart,portfolios:this.portfolios}),0===this.cart.getItems().length&&(o.clearCart(this.service),this.dispatchEvent(N.ADD_ADDITIONAL_ITEMS)),this.dispatchEvent(N.ORDER_UPDATED)},_goToPaymentIfUrlParamFound(){new URL(window.location.href).searchParams.has(E.UrlParams.GO_TO_PAYMENT)&&this._goToPaymentHandler()},async _goToPaymentHandler(){if(this.service===c.SUBSCRIPTIONS)this.dispatchEvent(N.DISPLAY_CHECKOUT);else if(this.stateMachine.clearSearchParams([E.UrlParams.GO_TO_PAYMENT]),this.cart.getItems().length>0){n.mask(this.container,this.I18n.get("checkoutLoading")),this.tracker&&await this.tracker.sendEvent({cart:this.cart,action:b.GO_TO_PAYMENT});const{errorMessage:e,newPage:t}=await this.dataLoader.checkAndSaveCart();n.unmask(this.container),e?(this.render(),this.alert.add({className:"error",message:e}).show()):t&&this.stateMachine.changePage(t)}},_createOrderListTitle(){const e=new D;return this.listenTo(e,D.Events.ADD_ADDITIONAL_ITEMS,(()=>{o.storeCart(this.service,this.cart),this.tracker&&this.tracker.sendEvent({cart:this.cart,action:b.CART_MORE_ITEMS}),this.dispatchEvent(N.ADD_ADDITIONAL_ITEMS)})),e},_createPriceDetails({taxEstimation:e,stateMachine:t}){const i=new F({taxEstimation:e,stateMachine:t,service:this.service,moreInformationLink:this.moreInformationLink,priceAndTaxHandler:this.priceAndTaxHandler});return this.listenTo(i,F.Events.GO_TO_PAYMENT,this._goToPaymentHandler.bind(this)),this.listenTo(i,F.Events.SECURE_TRANSACTION_CLICKED,(()=>{this.tracker&&this.tracker.sendEvent({cart:this.cart,action:b.REASSURE_PAYMENT})})),this.listenTo(i,F.Events.VIEW_TAX_DETAILS,(()=>{this.tracker&&this.tracker.sendEvent({cart:this.cart,action:b.CART_TAX_DETAILS})})),i},_createCoupon(){const e=new O({tracker:this.tracker,couponFactory:this.couponFactory,priceAndTaxHandler:this.priceAndTaxHandler});return this.listenTo(e,O.Events.ORDER_CHANGED,this._onOrderChanged.bind(this)),e},_createAvailableCountriesComponent(){const e=new _({countries:this.countries,stateMachine:this.stateMachine,tracker:this.tracker});return this.listenTo(e,_.Events.ON_CHANGE_COUNTRY,(async({country:e,requiresLanguageChange:t})=>{requirejs.defined("DS/MPFCheckoutPage/CheckoutPageFactory")&&t&&(this.stateMachine.isCurrentUrlACompassUrl()||this.stateMachine.isUrlDedicatedPage())?window.location.reload():(n.mask(this.container,this.I18n.get("loading")),await this.load({reloadLanguageFiles:t}),n.unmask(this.container),this.render(),this.dispatchEvent(N.ON_COUNTRY_CHANGE,{country:e}))})),e},_createAlert:()=>new r({visible:!1,autoHide:!0,closeOnClick:!1,hideDelay:1e4}),_createRenewalWarning:e=>({tag:"div",class:"mpf-renewal-warning",html:[{tag:"span",class:"fonticon fonticon-attention"},{tag:"span",class:"mpf-renewal-warning-text",text:e.get("renewalWarning")}]}),_createTitle(){return t.createElement("div",{class:"mpf-my-order-title",text:this.I18n.get("myOrder")})},_createOrderListContent(){const e=new T({cart:this.cart,tracker:this.tracker,service:this.service,portfolioFactory:this.portfolioFactory,cartItemFactory:this.cartItemFactory});return this.listenTo(e,T.Events.ORDER_CHANGED,this._onOrderChanged.bind(this)),this.listenTo(e,T.Events.SHOW_OFFER_ITEMS_MODAL,(({portfolio:e})=>{this.offerItemsModal.show({I18n:this.I18n,portfolio:e})})),this.listenTo(e,T.Events.REMOVE_ITEM_ERROR,(()=>{this.alert.add({className:"error",message:this.I18n.get("itemDeletionError")}).show()})),e},_createEmptyCartComponent(){const e=new A;return this.listenTo(e,A.Events.ADD_ITEMS,this.dispatchEvent.bind(this,N.ADD_ADDITIONAL_ITEMS)),e},_createPaymentButton(e){return new s({className:"primary mpf-payment-button",value:e.get("checkout"),icon:"shopping-cart",events:{onClick:this._goToPaymentHandler.bind(this)}})},_createMobileFooter(){const e=new v({priceAndTaxHandler:this.priceAndTaxHandler,priceDetailsComponent:this.priceDetails});return this.listenTo(e,v.Events.GO_TO_PAYMENT,this._goToPaymentHandler.bind(this)),e},_onResize(){this.container.getSize().width<1024&&!this.isMobileView?(this.isMobileView=!0,this.container.addClassName("mpf-mobile-view"),this.render()):this.container.getSize().width>=1024&&this.isMobileView&&(this.isMobileView=!1,this.container.removeClassName("mpf-mobile-view"),this.render())}});return L.Events=N,L})),define("DS/MPFClickAndBuyComponent/ClickAndBuyComponent",["UWA/Class/View","DS/UIKIT/Alert","DS/UIKIT/Mask","DS/MPFClickAndBuyComponent/ClickAndBuyTracker","DS/MPFClickAndBuyComponent/ErrorPage","DS/MPFClickAndBuyComponent/offerList/OfferListPage","DS/MPFClickAndBuyComponent/orderList/OrderList","DS/MPFClickAndBuyComponent/platformSelection/PlatformSelectionPage","DS/MPFClickAndBuyComponent/checkout/CabCheckoutPage","DS/MPFClickAndBuyComponent/checkout/PaymentRedirectResultPage","DS/MPFClickAndBuyComponent/ClickAndBuyStateMachine","DS/MPFClickAndBuyComponent/CnbChatBotStarter"],(function(e,t,i,r,s,n,o,a,c,l,d,h){"use strict";const u=Object.freeze({ADD_ADDITIONAL_ITEMS:"addAdditionalItems",ON_PAGE_RENDERED:"onPageRendered"}),p=e.extend({className:"mpf-click-and-buy",setup({stateMachine:e,me:t,psp:i,taxEstimation:n,compassPortfolios:o,countries:a,allCountries:c,tenantFactory:l,cartFactory:u,cartItemFactory:p,portfolioFactory:m,couponFactory:f,my3dExpConnector:g,service:C,initialErrorMessage:P}={}){this.stateMachine=e,this.me=t,this.service=C,this.countries=a,this.allCountries=c,this.tracker=new r,this.alert=this._createAlert(P),this.errorPage=new s,this.offerListPage=this._createOfferListPage({compassPortfolios:o,cartFactory:u,portfolioFactory:m}),this.orderListPage=this._createOrderListPage({psp:i,taxEstimation:n,compassPortfolios:o,cartFactory:u,cartItemFactory:p,portfolioFactory:m,tenantFactory:l,couponFactory:f}),this.platformSelectionPage=this._createPlatformSelectionPage({cartFactory:u,tenantFactory:l}),this.checkoutPage=this._createCheckoutPage({cartFactory:u,portfolioFactory:m,tenantFactory:l,my3dExpConnector:g}),this.paymentRedirectResultPage=this._createPaymentRedirectResultPage({cartFactory:u,service:C,me:t}),h.run(),this.listenTo(this.stateMachine,d.Events.PAGE_CHANGE_REQUESTED,((e={})=>{this.load(e).then((({skipRendering:t=!1})=>{t||this.render(e)}))}))},async load({offerTrigram:e,offerName:t,cartId:i,licencingScheme:r,cart:n,I18n:o}={}){this._setLoading(!0),this.stateMachine.isPaymentRedirectResult()?this.page=this.paymentRedirectResultPage:this.stateMachine.isOfferView()?this.page=this.offerListPage:this.stateMachine.isCartView()?this.page=this.orderListPage:this.stateMachine.isPlatformSelectionView()?this.page=this.platformSelectionPage:this.stateMachine.isCheckoutView()&&(this.page=this.checkoutPage);try{const s=await this.page.load({offerTrigram:e,offerName:t,cartId:i,cart:n,licencingScheme:r,I18n:o});return this.I18n=this.page.I18n,s||{}}catch(e){console.error(e);const t=e&&e.response&&e.response.errorCode;this.page=t?new s({error:t}):this.errorPage,await this.page.load()}},render({errorMessage:e}={}){return this._setLoading(!1),this.container.setContent([this.alert,this.page.render()]),e&&this.alert.add({className:"error",message:e}).show(),this.dispatchEvent(u.ON_PAGE_RENDERED),this},destroy(){this.stopListening(),this.offerListPage.destroy(),this.orderListPage.destroy(),this.checkoutPage.destroy(),this.paymentRedirectResultPage.destroy(),this.stateMachine.clearUrl(),this.page=null,this.stateMachine=null,this.psp=null,this.countries=null,this.tracker=null,this.I18n=null,this._parent(),this.container=null},_setLoading(e=!0){if(e)if(this.I18n){let e;switch(this.stateMachine.page){case d.Pages.CART:e=this.I18n.get("cartLoading");break;case d.Pages.PLATFORM_SELECTION:case d.Pages.CHECKOUT:e=this.I18n.get("checkoutLoading");break;default:e=this.I18n.get("loading")}i.mask(this.container,e)}else i.mask(this.container);else i.unmask(this.container)},_toCompass(){this.stateMachine.clearUrl(),this.dispatchEvent(u.ADD_ADDITIONAL_ITEMS)},_createTracker(){return new r({cart:this.cart})},_createAlert(e){const i=new t({visible:!1,autoHide:!0,hideDelay:1e4,closable:!0});return e&&this.listenToOnce(this,"onInjected",(()=>{this.alert.add({className:"error",message:e}).show()})),i},_createOfferListPage({compassPortfolios:e,cartFactory:t,portfolioFactory:i}){return new n({compassPortfolios:e,cartFactory:t,portfolioFactory:i,stateMachine:this.stateMachine,countries:this.countries,locale:this.locale,tracker:this.tracker,service:this.service})},_createOrderListPage({psp:e,taxEstimation:t,compassPortfolios:i,cartFactory:r,cartItemFactory:s,portfolioFactory:n,tenantFactory:a,couponFactory:c}){const l=new o({psp:e,taxEstimation:t,compassPortfolios:i,cartFactory:r,cartItemFactory:s,portfolioFactory:n,tenantFactory:a,couponFactory:c,stateMachine:this.stateMachine,countries:this.countries,allCountries:this.allCountries,service:this.service,tracker:this.tracker,moreInformationLink:this.moreInformationLink});return this.listenTo(l,o.Events.ADD_ADDITIONAL_ITEMS,this._toCompass.bind(this)),l},_createPlatformSelectionPage({cartFactory:e,tenantFactory:t}){return new a({cartFactory:e,tenantFactory:t,stateMachine:this.stateMachine,service:this.service,tracker:this.tracker})},_createCheckoutPage({psp:e,cartFactory:t,portfolioFactory:i,tenantFactory:r,my3dExpConnector:s}){const n=new c({psp:e,cartFactory:t,portfolioFactory:i,tenantFactory:r,my3dExpConnector:s,stateMachine:this.stateMachine,tracker:this.tracker,service:this.service});return this.listenTo(n,c.Events.ON_PAYMENT_COMPLETED,this._toCompass.bind(this)),n},_createPaymentRedirectResultPage({cartFactory:e,service:t,me:i}){const r=new l({stateMachine:this.stateMachine,cartFactory:e,service:t,me:i});return this.listenTo(r,l.Events.PAYMENT_COMPLETED,this._toCompass.bind(this)),r}});return p.Events=u,p})),define("DS/MPFClickAndBuyComponent/ClickAndBuyWrapper",["DS/MPFServices/MarketplaceServices","DS/MPFConnector/MarketplaceConnector","DS/MPFConnector/AppsConnector","DS/MPFPortfolioModel/compass/CompassPortfolioCollection","DS/MPFPortfolioModel/compass/CompassPortfolioDataProxy","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFPersonModel/PersonFactory","DS/MPFPspModel/PspFactory","DS/MPFCountryModel/CountryFactory","DS/MPFTaxModel/TaxEstimationFactory","DS/MPFClickAndBuyComponent/ErrorPage","DS/MPFClickAndBuyComponent/ClickAndBuyStateMachine","DS/MPFClickAndBuyComponent/ClickAndBuyComponent"],(function(e,t,i,r,s,n,o,a,c,l,d,h,u){"use strict";return class{static async getClickAndBuyComponent({product:t}={}){try{const{connector:d,my3dExpConnector:p,myAppsConnector:m}=await this._fetchConnectors(),f=n.getInstance(d),[g,C,P,I,y,E,S,T,_]=await f.getFactories([n.Types.PERSON,n.Types.COUNTRY,n.Types.PORTFOLIO,n.Types.TENANT,n.Types.PSP,n.Types.CART,n.Types.CART_ITEM,n.Types.TAX_ESTIMATION,n.Types.COUPON_CREATION]),M=g.createModel(o.Types.ME),A=C.createCollection(c.Types.SP_PUBLIC_OPENED_COUNTRIES),D=C.createCollection(c.Types.COUNTRY),F=y.createModel(a.Types.PARAM_PSP),O=T.createModel(l.Types.TAX_ESTIMATION),[v]=await Promise.all([this._fetchCompassInfo(m),this._fetchMeWithoutError(M),A.fetchPromise(),D.fetchPromise()]),k=new i(v.portfolio),N=new r([],{dataProxy:new s(k)}),{offerTrigram:b,offerName:L,cartId:R,licencingScheme:w,page:U}=h.getInitialState(t),B=new h({page:U,cookieKey:"swymlang",me:M,countries:A,service:e.CLICK_AND_BUY}),x=new u({stateMachine:B,me:M,psp:F,taxEstimation:O,compassPortfolios:N,cartFactory:E,cartItemFactory:S,portfolioFactory:P,tenantFactory:I,couponFactory:_,countries:A,allCountries:D,my3dExpConnector:p,service:e.CLICK_AND_BUY});return await x.load({offerTrigram:b,offerName:L,cartId:R,licencingScheme:w}),x}catch(e){console.error(e);const t=new d({error:d.Errors.DEFAULT});return await t.load(),t}}static _fetchCompassInfo(e){return new Promise(((t,i)=>{e.request(e.url("/infos/feature/compass"),{onComplete:t,onFailure:i})}))}static _getTenantFromUrlParam(){return new URL(window.location.href).searchParams.get(h.UrlParams.TENANT)}static _fetchMeWithoutError(e){return new Promise(((t,i)=>e.fetch({onComplete:t,onFailure:i,onPassportError:e=>{console.error(e),t()}})))}static async _fetchConnectors(){const r=this._getTenantFromUrlParam();if(!r)return await this._fetchConnectorsWithoutPlatformId();try{const[s,n,o]=await Promise.all([t.fetchPromise({service:e.CLICK_AND_BUY,platformId:r}),t.fetchPromise({backend:"my3dexperience",service:e.CLICK_AND_BUY,platformId:r}),i.fetchPromise()]);return{connector:s,my3dExpConnector:n,myAppsConnector:o}}catch(e){return await this._fetchConnectorsWithoutPlatformId()}}static async _fetchConnectorsWithoutPlatformId(){const r=await t.fetchPromise({service:e.CLICK_AND_BUY});return{connector:r,my3dExpConnector:await t.fetchPromise({backend:"my3dexperience",service:e.CLICK_AND_BUY,platformId:r.platformId}),myAppsConnector:await i.fetchPromise({platformId:r.platformId})}}}})),define("DS/MPFClickAndBuyComponent/ClickAndBuyWidget",["UWA/Element","DS/UIKIT/Spinner","DS/UIKIT/Scroller","DS/MPFClickAndBuyComponent/ClickAndBuyWrapper","DS/MPFAmdLazyLoader/AmdLazyLoader"],((e,t,i,r,s)=>{"use strict";return class{constructor(e){this.widget=e}async load(){this.widget.body.addClassName("mpf-cnb-widget");let t;this._createLoader().inject(this.widget.body);if(new URL(window.location.href).pathname.includes("cnb/my-account")){const[e]=await s.getInstance().get(["DS/MPFMyAccount/MyAccountComponentFactory"]);t=await e.createComponent()}else t=await r.getClickAndBuyComponent();const n=new i({element:new e("div",{class:"page-container mpf-page-container",html:{tag:"div",class:"page-content mpf-page-content",html:[t.render()]}})}),o=document.querySelector(".topbar"),a=o&&o.offsetHeight||0,c=document.querySelector(".mp-nav-bar"),l=a+(c&&c.offsetHeight||0);n.getContent().setStyle("height",`calc(100dvh - ${l}px)`),this.widget.setBody(n),this.widget.globalPageScroller=n}_createLoader(){return new e("div",{class:"mpf-spinner-container",html:[(new t).show()]})}}}));