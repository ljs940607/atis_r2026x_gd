define("DS/ENOXVersionExplorerModelManager/ModelManagerP",["DS/ENOXVersionExplorerModelWebServices/ModelWebServicesP","DS/ENOXVersionExplorerUtils/ENOXVersionExplorerUtils","DS/ENOXVersionExplorerModel/VersionTreeNodeModel","DS/WebappsUtils/WebappsUtils","i18n!DS/ENOXVersionExplorerController/assets/nls/NodeDropdownMenuNLS"],(function(e,t,n,i,r){"use strict";return e.extend({_onCompleteLoadVersions:function(e,t){var n=this;setTimeout((function(){!0!==t&&(n._loadBranchFilters(),n._loadPersonInfo(),n._loadThumbnailsAsync(),n._trackInitAction())}),100)},getNewVersionName:function(){var e,t=this;if(t.isLoaded()&&t.getNumberOfNodes()>0){var i=t._nodeList[0];i instanceof n&&(e=r.version+(t.getNumberOfNodes()+1).toString()+"_"+i.options.grid.title)}return e},_createVersionData:function(e,n,r){var o=this.__proto__._createVersionData.call(this,e,n,r),s=t.getHistoryCustomAttribute(e);if(this.mainBranchRoot||(this.mainBranchRoot=r.find((function(e){return!Array.isArray(e.ancestors)||Array.isArray(e.ancestors)&&0===e.ancestors.length}))),o.conx&&o.conx.length||(o.data.position=0),s){if(o.data.custom_node_color="string"==typeof s.node_color&&s.node_color.length?s.node_color:"",Array.isArray(o.conx)&&o.conx.length){var a,c=o.conx.filter((function(e){return!("E"==e.semantic||"I"==e.semantic)}));if(o.conx&&1===c.length&&s&&"true"===s.setAsTree&&(a=s.position,!isNaN(a)))c[0].semantic="I",o.data.position=a,o.data.redrawFlag=!0,c[0].reference=this.mainBranchRoot.id,c[0].mergeBetweenRoots=!0,c[0].mergeLeft=!0,"string"==typeof s.icon&&s.icon.length&&(c[0].icon=i.getWebappsBaseUrl()+"HistoryExplorer/assets/icons/32/"+s.icon),"string"==typeof s.line_color&&s.line_color.length&&(c[0].custom_line_color=s.line_color);else for(var l=0,d=o.conx.length;l<d;l++){var p=o.conx[l];"I"!==p.semantic&&"string"==typeof s.line_color&&s.line_color.length?p.custom_line_color=s.line_color:p.redrawFlag=!0,"string"==typeof s.icon&&s.icon.length&&(p.icon=i.getWebappsBaseUrl()+"HistoryExplorer/assets/icons/32/"+s.icon)}}}else o.data.custom_node_color="";return o}})})),define("DS/ENOXVersionExplorerModelManager/ModelManagerHistory",["UWA/Core","DS/ENOXVersionExplorerModelWebServices/ModelWebServicesHistory","DS/LifecycleServices/LifecycleServicesSettings","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","DS/ENOXVersionExplorerUtils/ENOXVersionExplorerUtils","DS/WebappsUtils/WebappsUtils","i18n!DS/ENOXVersionExplorerModelManager/assets/nls/SemanticRelationships"],(function(e,t,n,i,r,o){"use strict";return t.extend({_processVersions:function(e,t,n){var i;return i=this[1==n?"_UpdateTree":"_loadTree"](e),this.itemID=t,i},_getVersionArray:function(e){for(var t=e.nodes.length>1?e.nodes.sort((function(e,t){return e.nId-t.nId})):e.nodes,n=e.connections,i=0,r=n.length;i<r;i++){var o=n[i],s=t[o.src-1],a=t[o.trg-1],c=o.typ;a.ancestor={historySemantic:c,id:s.id}}return t.sort((function(e,t){return new Date(e.originated).getTime()-new Date(t.originated).getTime()}))},_loadPersonInfo:function(){for(var t=0,n=this._nodeList.length;t<n;t++){var i=this._nodeList[t],r=i.options.grid.description,o=i.options.grid.owner,s=i.options.grid.reservedby;if("string"==typeof r&&r.length){var a={};if(i.options.eStrings&&(a=i.options.eStrings),!0===a[r]){var c=e.String.unescapeHTML(r);i.setAttribute("description",c)}}"string"==typeof o&&o.length?i.setAttribute("ownerName",o):o||i.setAttribute("ownerName",null),"string"==typeof s&&s.length?i.setAttribute("reservedbyName",s):s||i.setAttribute("reservedbyName",null)}},_createVersionData:function(t,s,a){var c=r.getHistoryCustomAttribute(t),l=[],d={},p={title:"",thumbnail:""};for(var h in t)switch(h){case"displayName":var f=t[h];p.title=e.String.escapeHTML(f),f.length!==p.title.length&&(d[p.title]=!0);break;case"currentUntranslated":var u=t[h];p.maturity=u,p.currentUntranslated=u;break;case"current":var g=t[h];p.maturity_nls=g,p.current=g;break;case"ancestor":if(t.ancestor){var m={semantic:i.historySemantics[t.ancestor.historySemantic].symbol,id:t.ancestor.id,icon:o.getWebappsBaseUrl()+"HistoryExplorer/assets/icons/32/"+(c&&c.icon?c.icon:i.historySemantics[t.ancestor.historySemantic].icon),historySemantic:t.ancestor.historySemantic};c&&"string"==typeof c.line_color&&c.line_color.length&&(m.custom_line_color=c.line_color),l.push(m),t.ancestor.historySemantic.contains("From")&&"string"==typeof t.revisedFrom&&t.revisedFrom&&a.find((function(e){return e.id===t.revisedFrom}))&&l.push({semantic:"I",id:t.revisedFrom,historySemantic:t.ancestor.historySemantic})}break;case"originated":p.creationDate=new Date(t[h]);break;case"modified":p.modified=new Date(t[h]);break;case"revision":p.code=t[h];break;case"thumbnail":case"icon":p[h]=t[h].length&&t[h].indexOf("http")<0?n.get3DSpaceBaseUrl(this.getTenantId())+t[h]:t[h];break;default:if("string"==typeof(f=t[h]))if(f.endsWith("Z")&&!isNaN(Date.parse(f)))p[h]=new Date(f);else{var v=e.String.escapeHTML(f);p[h]=v,f.length!==v.length&&(d[v]=!0)}else p[h]=f}return p.custom_node_color=c&&"string"==typeof c.node_color&&c.node_color.length?c.node_color:"",{data:p,conx:l,eStrings:d}}})})),define("DS/ENOXVersionExplorerModelManager/ModelManagerRDF",["UWA/Promise","DS/ENOXVersionExplorerModelWebServices/ModelWebServicesRDF","DS/LifecycleServices/LifecycleServicesSettings","DS/ENOXVersionExplorerModel/VersionTreeNodeModel","DS/ENOXVersionExplorerUtils/ENOXVersionExplorerUtils","i18n!DS/ENOXVersionExplorerController/assets/nls/NodeDropdownMenuNLS","i18n!DS/ENOXVersionExplorerModelManager/assets/nls/SemanticRelationships"],(function(e,t,n,i,r,o,s){"use strict";return t.extend({_createVersionData:function(e,t,i){var o,s={},a={title:"",thumbnail:""};for(var c in e)switch(c){case"label":var l=e[c];a.title=UWA.String.escapeHTML(l),l.length!==a.title.length&&(s[a.title]=!0);break;case"semanticInfo":if(e.semanticInfo.member&&e.semanticInfo.member.length&&(o=e.semanticInfo.member.map((function(e){return{semantic:r.getSemanticSymbol(e.semantic),id:e.toVersion["@id"]}}))).filter((function(e){return"I"!==r.getSemanticSymbol(e.semantic)})).length>1)throw Error("_createVersionData: Version "+e.id+"has more than one non-integrate connections");break;case"@id":a.id=e[c];break;case"creationDate":a[c]=new Date(a[c]);break;case"modificationDate":a.modified=new Date(a[c]);break;case"thumbnail":case"icon":a[c]=e[c].length&&e[c].indexOf("http")<0?n.get3DSpaceBaseUrl(this.getTenantId())+e[c]:e[c];break;default:if("string"==typeof(l=e[c]))if(l.endsWith("Z")&&!isNaN(Date.parse(l)))a[c]=new Date(l);else{var d=UWA.String.escapeHTML(l);a[c]=d,l.length!==d.length&&(s[d]=!0)}else a[c]=l}return a.code="",{data:a,conx:o,eStrings:s}},_getItemID:function(e){return e["@id"]},_getVersionArray:function(e){return e.versions.member},_onCompleteLoadVersions:function(e){},createNewVersionPromise:function(t){if(!t||"string"!=typeof t.title||!t.title.length)throw Error("createNewVersion: Title cannot be null");if(!t||"string"!=typeof t.parentid||!t.parentid.length)throw Error("createNewVersion: Title cannot be null");var n=this;return new e((function(e,i){n.addVersionPromise(t).then((function(r){n._onNewVersionCreated(t,r,e,i)}),i)}))},_onNewVersionCreated:function(e,t,n,i){var r=this;r.getVersionsFromVersion(r.itemID).then((function(e){r._processVersions(e);var t=r._nodeList[r._nodeList.length-1];n(t),r._onCompleteLoadVersions(t.options.id)}))},getNewVersionName:function(){var e,t=this;if(t.isLoaded()&&t.getNumberOfNodes()>0){var n=t._nodeList[0];n instanceof i&&(e=o.version+(t.getNumberOfNodes()+1).toString()+"_"+n.options.grid.title)}return e},getLegend:function(){return s.P_PRIME},_processVersions:function(e){var t=this,n=!1;return e.versions&&(t.itemID===t._getItemID(e)?n=t._updateTree.bind(t)(e):(t.itemID=t._getItemID(e),t._loadTree.bind(t)(e),n=!0)),n}})})),define("DS/ENOXVersionExplorerModelManager/ModelManagerBase",["UWA/Core","UWA/Promise","DS/ENOXVersionExplorerModel/VersionTreeDocumentModel","DS/ENOXVersionExplorerModel/VersionTreeNodeModel","DS/TreeModel/TreeDocument","DS/LifecycleServices/LifecycleServicesSettings","DS/ENOXVersionExplorerUtils/VersionExplorerSettings","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","DS/ENOXVersionExplorerUtils/ENOXVersionExplorerUtils","DS/ENOXVersionExplorerUtils/ArrayFunctions","DS/WebappsUtils/WebappsUtils","DS/ENOCollabToolsUI/tracker/ENOCollabTracker","i18n!DS/ENOXVersionExplorerModelManager/assets/nls/ScaleRanges"],(function(e,t,n,i,r,o,s,a,c,l,d,p,h){"use strict";var f=e.Class.extend({_manager:null,pollingInterval:void 0,init:function(e){this._previous&&this._previous(e),this._pruneHash={}},setManager:function(t){if(!(this instanceof n))throw Error("ModelManagerBase.setManager: ModelManagerBase can only extend a VersionTreeDocument");if(this._manager=t,this._iconCache||(this._iconCache={}),e.Class.implement.call(this,new(f.extend(t))),window.widget.options&&window.widget.options._pruneHash){for(var i=Object.keys(window.widget.options._pruneHash),r=0;r<i.length;r++)this._pruneHash[i[r]]=window.widget.options._pruneHash[i[r]];delete window.widget.options._pruneHash}},_processVersions:function(e,t,n){var i=this,r=!1;if(((e=Array.isArray(e.graphs)&&e.graphs.length&&e.graphs[0]?e.graphs[0]:e).items||e.item)&&e.versions){var o=!1;Array.isArray(e.items)?(o=i._checkIfItemsPreviouslyLoaded(e.items),i.items=e.items):e.item&&(o=i._checkIfItemsPreviouslyLoaded([e.item]),i.items=[e.item]);var s=t&&"string"==typeof t&&0==t.indexOf("cid:");(i._forceLoadTree||Object.keys(i._pruneHash).length>0||s)&&(i._forceLoadTree=!1,o=!1),1==n&&(o=!0),r=i[o?"_updateTree":"_loadTree"].bind(i)(e),r=!0}return r},_getVersionArray:function(e){for(var t=0;t<e.versions.length;t++)Array.isArray(e.versions[t].contents)&&1==e.versions[t].contents.length&&(e.versions[t]["PLMReference.V_versionComment"]=e.versions[t].description,e.versions[t].description="",Object.keys(e.versions[t].contents[0]).map((function(n){"id"!==n&&"creation"!==n&&"modification"!==n&&"policy"!==n&&"project"!==n&&(e.versions[t][n]=e.versions[t].contents[0][n])}))),this.getKind()&&(e.versions[t]["ds6w:kind"]=this.getKind());return e.versions},_loadThumbnailsAsync:function(){var e=this;if(!e._isODT&&(!e._thumbnailsLoaded&&(s.UserSettings.displayMode===a.DISPLAY_MODES.THUMBNAIL_VIEW||s.UserSettings.displayMode!==a.DISPLAY_MODES.THUMBNAIL_VIEW&&!0===e._isThumbnailsForListView))){for(const n in e._iconCache){if(r=e._iconCache[n]){var t=e._nodeList.find((function(e){return n===e.options.id}));t&&t.setAttribute("thumbnail",r)}}for(var n=[],i=0;i<e._nodeList.length;i++){var r,o=e._nodeList[i].options.id;(r=e._iconCache[o])||n.push(o)}if(0!=n.length){e.getVersionsFromVersion(n,[],!0).then((function(t){e._GraphListView&&e._GraphListView.prepareUpdateView();var n=[];t.graphs?t.graphs.length>0&&(n=e._getVersionArray(t.graphs[0])):n=e._getVersionArray(t);for(var i=0;i<n.length;i++){var r=e._nodeList.find((function(e){return n[i].id===e.options.id}));if(!e._iconCache[n[i].id]&&(n[i].thumbnail&&(e._iconCache[n[i].id]=n[i].thumbnail),r)){var o=n[i].thumbnail;r.setAttribute("thumbnail",o)}}e._GraphListView&&(e._GraphListView.prepareUpdateView(),e._GraphListView.pushUpdateViewAndUpdateGraph())}))}else e._GraphListView&&(e._GraphListView.prepareUpdateView(),e._GraphListView.pushUpdateViewAndUpdateGraph())}},_getXRevisionIDFromGraphPromise:function(e){var n=this;return new t((function(t,i){n.getXRevisionFromVersion(e).then((function(e){t(e.graphs[0].versions[0].id)}))}))},_checkIfItemsPreviouslyLoaded:function(e){return!!Array.isArray(this.items)&&l.intersectionDifference(this.items,e,(function(e,t){return null!=t.id&&null!=e.id&&t.id===e.id||null!=t.vid&&null!=e.vid&&t.vid===e.vid||null!=t.mid&&null!=e.mid&&t.mid===e.mid}))[0].intersection.length>0},loadVersionModelPromise:function(e){this.trackerEventBeginTime=Date.now();var n=this,i=e.id;return this._bLoadThumbnail="boolean"!=typeof e.loadThumbnail||e.loadThumbnail,"string"==typeof e.tenantId&&e.tenantId.length&&n.setTenantId(e.tenantId),"string"==typeof e.ds6w_kind&&e.ds6w_kind.length&&n.setKind(e.ds6w_kind),"string"==typeof e.serviceId&&e.serviceId.length?n.setServiceId(e.serviceId):n.setServiceId("3DSpace"),"string"==typeof e.securityContext&&e.securityContext.length&&n.setSecurityContext(e.securityContext),new t((function(t,o){n instanceof r||o("ModelManager.createVersionModel: 'this' must be an instance of TreeDocument"),"string"==typeof i&&i.length?n.getVersionsFromVersion(c.getSanitizedID(i),Array.isArray(e.attributeList)&&e.attributeList.length?e.attributeList:void 0).then((function(r){t(n._processVersions(r,i,e.contextualMenu)),n._onCompleteLoadVersions(i,e.contextualMenu)}),o):"object"==typeof i?(t(n._processVersions(i,i,e.contextualMenu)),n._onCompleteLoadVersions(i,e.contextualMenu)):o("loadVersionModel: Input should be object or string")}))},createNewVersionPromise:function(e,n,i){if(!e||"string"!=typeof e.title||!e.title.length)throw Error("createNewVersion: Title cannot be null");if(!e||"string"!=typeof e.parentid||!e.parentid.length)throw Error("createNewVersion: Title cannot be null");var r=this;return this._bLoadThumbnail="boolean"!=typeof e.loadThumbnail||e.loadThumbnail,new t((function(t,n){var i=[c.getSanitizedID(e.parentid)],o=[e.title!==r.searchByID(e.parentid)[0].options.label?e.title:void 0];r.reviseAsMajor({physIds:i,titles:o}).then((function(i){r._onNewVersionCreated(e,i,t,n)}),n)}))},_getNewVersionID:function(e,t){var n,i=e.results,r=i.find((function(e){return t.parentid===e["attribute[PLMReference.V_DerivedFrom]"]}));return(r=r||i[0])&&(n=r.physicalid),n},_onNewVersionCreated:function(e,t,n,i){var r=this,o=("boolean"!=typeof e.loadThumbnail||e.loadThumbnail,r._getNewVersionID(t,e));"string"==typeof o&&o.length&&(e.description&&e.description.length?r.getUpdateNameAndDescriptionPromise({id:o,attributes:[{key:"description",value:e.description},{key:"V_description",value:e.description}]}).then((function(){r.getVersionsFromVersion(o).then((function(e){r._processVersions(e);var t=r._nodeList.find((function(e){return e.options.id===o}));n(t),r._onCompleteLoadVersions(o)}))}),i):r.getVersionsFromVersion(o).then((function(e){r._processVersions(e);var t=r._nodeList.find((function(e){return e.options.id===o}));n(t),r._onCompleteLoadVersions(o)})))},getNewVersionName:function(){throw Error("getNewVersionName: no implement")},_onCompleteLoadVersions:function(e,t){var n=this;setTimeout((function(){!0!==t&&(n._loadBranchFilters(),n._loadPersonInfo(),!0===n._bLoadThumbnail&&s.POLL_UPDATE_THUMBNAIL&&n._loadThumbnailAndTitle(e),n._trackInitAction())}),100)},getLegend:function(e){},_loadBranchFilters:function(){var e=this;if(e.filterHash&&(!e.filterHash||0!=Object.keys(e.filterHash).length)){var t=[],n=[];Object.keys(e.filterHash).map((function(t){e.filterHash[t]&&n.push(t)})),t.push(e.getBranchFilterPromise(n));var i={branchFilterRequests:[]};t.length&&Promise.all(t).then((function(e){e.length>0&&!e[0].errorID&&(i=e[0])})).catch((function(e){})).finally((function(t){var n=!1;i.branchFilterRequests.forEach((function(t){if(e.filterHash[t.id]){var i=void 0;t.snapshot?"string"!=typeof t.snapshot&&(i=t.snapshot.filter):t.filter&&(i=t.filter),i&&(n=!0,e.filterHash[t.id].filterQuery={filter:i,filterTitle:i.title})}}));for(var r=0,o=e._nodeList.length;r<o;r++){var s=e._nodeList[r];s.options.grid.id;if(s.options.ancestors){var a=s.options.ancestors.find((function(e){return e.hasExpand}));if(a){var c=e.filterHash[a.filterid];c&&c.filterQuery&&(a.filterQuery=c.filterQuery)}}}n&&e._GraphListView&&(e._GraphListView.prepareUpdateColumns(),e._GraphListView.pushUpdateColumns())}))}},_loadPersonInfo:function(){for(var t=this,n=[],i=this.personInfo=this.personInfo||{},r=0,o=t._nodeList.length;r<o;r++){var s=t._nodeList[r],a=s.options.grid.description,c=s.options.grid.owner,l=s.options.grid.reservedby;if("string"==typeof c&&c.length&&!i.hasOwnProperty(c)?(n.push(t.getPersonInfoPromise(c)),i[c]=void 0):"string"==typeof c&&c.length&&i[c]&&s.options.grid.ownerName!==i[c].firstname+" "+i[c].lastname?s.setAttribute("ownerName",i[c].firstname+" "+i[c].lastname):c||s.setAttribute("ownerName",null),"string"==typeof l&&l.length&&!i.hasOwnProperty(l)?(n.push(t.getPersonInfoPromise(l)),i[l]=void 0):"string"==typeof l&&l.length&&i[l]&&s.options.grid.reservedbyName!==i[l].firstname+" "+i[l].lastname?s.setAttribute("reservedbyName",i[l].firstname+" "+i[l].lastname):l||s.setAttribute("reservedbyName",null),"string"==typeof a&&a.length){var d={};if(s.options.eStrings&&(d=s.options.eStrings),!0===d[a]){var p=e.String.unescapeHTML(a);s.setAttribute("description",p)}}}n.length&&Promise.all(n).then((function(e){for(var n=0,r=e.length;n<r;n++)e&&e[n]&&e[n].name&&(i[e[n].name]=e[n]);for(var o=0,s=t._nodeList.length;o<s;o++){var a=t._nodeList[o],c=a.options.grid.owner,l=a.options.grid.reservedby;"string"==typeof c&&c.length&&i[c]&&a.options.grid.ownerName!==i[c].firstname+" "+i[c].lastname&&a.setAttribute("ownerName",i[c].firstname+" "+i[c].lastname),"string"==typeof l&&l.length&&i[l]&&a.options.grid.reservedbyName!==i[l].firstname+" "+i[l].lastname&&a.setAttribute("reservedbyName",i[l].firstname+" "+i[l].lastname)}}))},_loadThumbnailAndTitle:function(e){var t,n=this,r=4,s=0;function a(){var c=[],l=n._branchArray.reduce((function(e,t){return Array.isArray(t.nodeList)&&t.nodeList.length&&t.nodeList[0]instanceof i&&e.push(n.getVersionFamilyData(t.nodeList[0].options.id)),e}),[]);Promise.all(l).then((function(i){for(var l=0,d=i.length;l<d;l++)i[l]&&Array.isArray(i[l].data)&&i[l].data.length&&(c=c.concat(i[l].data));!function(i){var c=i.length;t=!1;for(var l=0;l<c;l++){var d=i[l];if(u=n._nodeList.find((function(e){return d.id===e.options.id}))){d.modified&&new Date(d.modified);var p=d.modified3DShape?new Date(d.modified3DShape):void 0,h=d.thumbnailModified?new Date(d.thumbnailModified):void 0,f=!0===d.isAssembly;-1===d.thumbnail.indexOf("http")?(d.thumbnail=o.get3DSpaceBaseUrl(n.getTenantId())+d.thumbnail,u.setAttribute("_mask",!0),t=!0,u.options.repmoddate=p,u.options.thumbnaildate=h):p&&h&&p-h>0?(u.setAttribute("_mask",!0),t=!0):f&&e===u.options.id?u.options.thumbnaildate&&h&&h-u.options.thumbnaildate<=0?(u.setAttribute("_mask",!0),t=!0):(u.setAttribute("_mask",!1),u.options.repmoddate=p,u.options.thumbnaildate=h):(u.options.repmoddate=p,u.options.thumbnaildate=h,u.setAttribute("_mask",!1)),u.options.grid.thumbnail!==d.thumbnail&&u.setAttribute("thumbnail",d.thumbnail),u.options.grid.title!==d.displayName&&u.setAttribute("title",d.displayName)}}if((s>=r||!t)&&void 0!==n.pollingInterval){clearInterval(n.pollingInterval),n.pollingInterval=void 0;for(l=0,c=n._nodeList.length;l<c;l++){var u;!0===(u=n._nodeList[l]).options.grid._mask&&u.setAttribute("_mask",!1)}}else t&&void 0===n.pollingInterval&&(n.pollingInterval=setInterval((function(){a(),s++}),3e4))}(c)}))}"undefined"!==n.pollingInterval&&(clearInterval(n.pollingInterval),n.pollingInterval=void 0),a()},_getPreContextualMenuPromise:function(e,n,i){return new t((function(t,n){t(e)}))},_loadTree:function(e){var t=this,n={},i={},r={},o={},s=[],a=void 0,l=void 0;t.prepareAddDelete();t.getSelectedNodes();t.manageNodeSelectionOff=!0,t.empty(),t.manageNodeSelectionOff=!1;for(var d=this._createNodeArray.bind(t)(e,!0),p=0;p<d.length;p++){var h=d[p],f=h._getID();i[f]=h;var u=t._pruneHash[f];if(u&&"down"==u.pruneMode?(s.length=0,l=f):!Array.isArray(h.options.ancestors)||!h.options.ancestors.length||Array.isArray(h.options.ancestors)&&1===h.options.ancestors.length&&!0===h.options.ancestors[0].mergeBetweenRoots?l||null==o[f]&&(o[f]=!0,s.push(f)):void 0===h.options.copyFrom&&(a=f),Array.isArray(h.options.ancestors)&&h.options.ancestors.length)for(var g=h.options.ancestors,m=0,v=g.length;m<v;m++){var _=g[m].id;if(t._isMinorRevision(h)){var y=t._getPreviousMinorRevision(h);y&&(_=y.id)}var b=r[_],S=g[m].semantic;void 0===b&&(r[_]=[]),"I"!==S.toUpperCase()&&r[_].indexOf(f)<0&&r[_].push(f)}}function I(e){if(!(v=t._pruneHash[e.options.grid.id])||"out"!=v.pruneMode){var o=[];for(o.push(e);o.length>0;){var s=o;o=[];for(var a=0;a<s.length;a++){var l=s[a];if(!n[l.options.grid.id]){n[l.options.grid.id]=!0;var d=l._getID();if(!(v=t._pruneHash[d])||"out"!=v.pruneMode){if(Array.isArray(l.options.ancestors)&&l.options.ancestors.length)for(var p=l.options.ancestors,h=0,f=p.length;h<f;h++)if("I"===c.getSemanticSymbol(p[h].semantic.toUpperCase())){var u=t._pruneHash[p[h].id];u&&"up"==u.pruneMode||t.addMerge(p[h].id,l,p[h])}if(!v||"up"!=v.pruneMode){var g=r[d];if(void 0!==g)for(var m=0;m<g.length;m++){var v,_=g[m],y=i[_];if(!(v=t._pruneHash[_])||"out"!=v.pruneMode){var b=null;if(y.options.ancestors.find((function(e){return"E"===e.semantic.toUpperCase()})))b=0;else 0===l.getNumberOfChildren()&&y.options.ancestors.find((function(e){return"I"!==e.semantic.toUpperCase()&&"MI"!==e.semantic.toUpperCase()}))&&(b=1);t.addChildNode(y,b,l,void 0,void 0,!0),o.push(y)}}}}}}}}}0==s.length&&(l||a)&&s.push(l||a);for(var D=0;D<s.length;D++){var V=s[D],N=i[V];t.addChildNode(N),I(N)}return t._isLoaded=!0,t.pushAddDelete(),!0},_updateTree:function(e){var t,n,r,o,s=!1,a=this,d=a._nodeList;if(o=a._createNodeArray.bind(a)(e),r=l.intersectionDifference(o,d,(function(e,t){return e.options.id===t.options.id&&e.options.grid.redrawFlag===t.options.grid.redrawFlag})),n=(t=r[1].difference).length,a.prepareAddDelete(),n>0)for(s=!0;m=t.shift();){if(d.indexOf(m)>=0){var p,h=m.getParent();Array.isArray(m.options.ancestors)&&m.options.ancestors.length?(m.options.ancestors.find((function(e){return"E"===e.semantic.toUpperCase()}))&&h.getNumberOfChildren()>0&&a.addChildNode(new i,0,h,!0),a.removeChildNode(m),1===h.getNumberOfChildren()&&(p=h.getNthChild(0)).isEmpty()&&h.removeChild(p)):a.removeChildNode(m)}Array.isArray(m.options.ancestors)&&m.options.ancestors.filter((function(e){return"I"===e.semantic})).forEach((function(e){a.removeMerge(e.id,m)})),a._mergeConnections.filter((function(e){return e.parent===m})).forEach((function(e){a.removeMerge(m,e.child)}))}r=l.intersectionDifference(o,d,(function(e,t){var n=e.options.id===t.options.id;if(n){if(e.options.ancestors&&e.options.ancestors.length&&t.options.ancestors&&t.options.ancestors.length){var i=e.options.ancestors.filter((function(e){return"I"===e.semantic})),r=t.options.ancestors.filter((function(e){return"I"===e.semantic}));if(i.length||r.length){var o=l.intersectionDifference(i,r,(function(e,t){return e.id===t.id&&e.redrawFlag===t.redrawFlag})),d=o[0].difference,p=o[1].difference;(d.length||p.length)&&(p.length&&p.forEach((function(e){a.removeMerge(e.id,t)})),d.length&&d.forEach((function(e){a.addMerge(c.getSanitizedID(e.id),t,e)})),s=!0)}}s|=t.refreshNodeData(e)}return n}));var f,u=r[0].difference;if(f=u.length){s=!0;for(var g=-1;f>0;f=u.length){var m;if(m=u[g+=1])if(Array.isArray(m.options.ancestors)&&m.options.ancestors.findIndex((function(e){return!0===e.mergeBetweenRoots}))<0)for(var v=0;v<m.options.ancestors.length;v++){var _=m.options.ancestors[v];if("I"!==c.getSemanticSymbol(_.semantic.toUpperCase())){if(h=a._nodeList.find((function(e){return _.id===e.options.id}))){var y=null,b=h.getNumberOfChildren();"E"===c.getSemanticSymbol(_.semantic.toUpperCase())?y=0:0===b&&(y=1),a.addChildNode(u.splice(u.indexOf(m),1)[0],y,h),g=-1}}else a.addMerge(_.id,m,_)}else a.addChildNode(u.splice(u.indexOf(m),1)[0],o.findIndex((function(e){return e===m}))),Array.isArray(m.options.ancestors)&&1===m.options.ancestors.length&&!0===m.options.ancestors[0].mergeBetweenRoots&&a.addMerge(m.options.ancestors[0].id,m,m.options.ancestors[0]),g=-1;else u.splice(u.indexOf(m),1)}}return s?a.pushAddDelete():a.cancelAddDelete(),s&&a._GraphListView&&(a._GraphListView.prepareUpdateView(),a._GraphListView.pushUpdateViewAndUpdateGraph()),s},_createNodeArray:function(e,t){var n=this,i=this._getVersionArray(e);n.objectHash={},n.linkHash={},n.filterHash&&1!=t||(n.filterHash={});for(var r=0;r<i.length;r++){var o=i[r],s=null!=o.id?o.id:o["@id"];if(n.objectHash[s]=o,n.linkHash[s]||(n.linkHash[s]={ancestorId:null,childId:null}),Array.isArray(o.ancestors)&&o.ancestors.length){if("E"===(b=o.ancestors[0]).semantic.toUpperCase()){var a=b.id;void 0===n.linkHash[a]&&(n.linkHash[a]={ancestorId:null,childId:null}),n.linkHash[a].childId=s,n.linkHash[s].ancestorId=a}n.filterHash&&1==b.hasExpand&&1==t&&(n.filterHash[b.filterid]={id:s,ancestorid:b.id,filterQuery:void 0})}}function c(e,t,n,i,r){if(e){e.ancestors[0].title=r;var o=i[t].childId;if(o)c(n[o],o,n,i,r)}}for(var l=Object.entries(n.linkHash).filter((e=>null===e[1].ancestorId)),d=0;d<l.length;d++){var p=l[d][0];if((y=n.objectHash[p]).ancestors&&y.ancestors[0].title){var h=y.ancestors[0].title;if(n.linkHash[p].childId){var f=n.linkHash[p].childId;c(n.objectHash[f],f,n.objectHash,n.linkHash,h)}}}function u(e,t,r,o,s,a,c){t&&(void 0===c[t.id]&&(c[t.id]=!0,e.push(n._newVersionTreeNode.bind(n)(t,r,i)),r++,a[t.id].ancestorId&&u(e,s[a[t.id].ancestorId],r,o,s,a,c)))}var g=[],m={},v=Object.entries(n.linkHash).filter((e=>null===e[1].childId)),_=0;for(d=0;d<v.length;d++){p=v[d][0];var y=n.objectHash[p];if(g.push(n._newVersionTreeNode.bind(n)(y,_,i)),_++,n.linkHash[p].ancestorId){var b;a=n.linkHash[p].ancestorId;u(g,b=n.objectHash[a],_,n,n.objectHash,n.linkHash,m)}}return g.sort((function(e,t){return e.options.creationDate.getTime()-t.options.creationDate.getTime()})),g},_newVersionTreeNode:function(e,t,n){var r=this,o=this._createVersionData(e,t,n);return new i(c.getSanitizedID(o.data.id),o.data,o.data.creationDate,o.data.fakeDate,r.getServiceId(),o.data.copyFrom,r.getSecurityContext(),o.conx,o.eStrings,!0,r.type)},_isMinorRevision:function(e){return e&&e.minororder>0&&e.secondaries},_getPreviousMinorRevision:function(e){var t=e.options&&e.options.grid?e.options.grid:e;if(t.secondaries&&t.secondaries[0].id!=t.majorid){var n=this.objectHash[t.secondaries[0].id];if(void 0!==n)return n}},_createVersionData:function(t,n,i){this._isMinorRevision(t)&&(null==this._getPreviousMinorRevision(t)?(t.isFirstMinor=!0,t.ancestors=[{semantic:"S",id:t.copyFrom,isMinorBranch:!0}]):t.ancestors=[{semantic:"MI",id:t.secondaries?t.secondaries[0].id:t.copyFrom}]);var r,s={},a={title:"",thumbnail:""},l=this;for(var p in t)switch(p){case"label":var f=t[p];a.title=e.String.escapeHTML(f),f.length!==a.title.length&&(s[a.title]=!0);break;case"ancestors":if(Array.isArray(t.ancestors)&&t.ancestors.length){r=[];for(var u=0,g=t.ancestors.length;u<g;u++){var m=t.ancestors[u],v=l.objectHash[m.id];if(v){var _=void 0,y=!1;m.icon=t.isFirstMinor?c.getSemanticIcon("MI"):c.getSemanticIcon(m.semantic),"S"===m.semantic||"PS"===m.semantic?t.copyFrom&&t.copyFrom!==m.id&&l._isMinorRevision(l.objectHash[t.copyFrom])&&(m.id=t.copyFrom):"E"===m.semantic?!l._isMinorRevision(t)&&l._isMinorRevision(v)&&(_=l.objectHash[v.majorid]):"SO"===m.semantic&&t.ancestors.length>1&&(i.findIndex((function(e){return e.id===t.copyFrom}))>=0?m.icon=l._isMinorRevision(l.objectHash[t.copyFrom])?c.getSemanticIcon("E"):c.getSemanticIcon("I"):(m.icon=d.getWebappsBaseUrl()+"HistoryExplorer/assets/icons/32/"+c.getSemanticIcon("I"),y=!0),m.semantic="I");var b={dontHighlightLink:y,semantic:c.getSemanticSymbol(m.semantic),id:c.getSanitizedID(_?_.id:m.id),icon:d.getWebappsBaseUrl()+"HistoryExplorer/assets/icons/32/"+m.icon,fid:_?_.fid:m.fid,filterid:_?_.filterid:m.filterid,hasExpand:_?_.hasExpand:m.hasExpand,rootPid:_?_.rootPid:m.rootPid,title:_?_.title:m.title};if(r.push(b),_)r.push({semantic:"I",id:t.copyFrom,icon:d.getWebappsBaseUrl()+"HistoryExplorer/assets/icons/32/"+c.getSemanticIcon("E")});else if("E"===m.semantic&&t.copyFrom&&t.copyFrom!==m.id&&l.objectHash[t.copyFrom]){var S=l._isMinorRevision(l.objectHash[t.copyFrom])?c.getSemanticIcon("E"):c.getSemanticIcon("I");i.findIndex((function(e){return e.id===t.copyFrom&&t.majorid}))>=0?r.push({semantic:"I",id:t.copyFrom,icon:d.getWebappsBaseUrl()+"HistoryExplorer/assets/icons/32/"+S}):(b.icon=d.getWebappsBaseUrl()+"HistoryExplorer/assets/icons/32/"+c.getSemanticIcon("I"),b.dontHighlightLink=!0)}}}}break;case"creation":case"creation date":a.creationDate=new Date(t[p]);var I,D=l.linkHash[t.id].childId;if(I=D?l.objectHash[D]:void 0){var V=I.fakeDate?I.fakeDate:I[p];t[p]>V?(a.fakeDate=new Date(Date.parse(V)-1),t.fakeDate=a.fakeDate.toISOString()):a.fakeDate=new Date(t[p])}else a.fakeDate=new Date(t[p]);break;case"modification":a.modified=new Date(t[p]);break;case"thumbnail":var N=t[p].length&&t[p].indexOf("://")>=0?t[p]:"";a[p]=N;break;case"icon":a[p]=t[p].length&&t[p].indexOf("://")>=0?t[p]:"",0==a[p].length&&(a[p]=o.get3DSpaceBaseUrl(l.getTenantId())+"/snresources/images/icons/large/"+t.icon+"108x144.png");break;case"LPAbstractReference.V_Scale":case"LPAbstractRepReference.V_Scale":switch(t[p]){case 1:a[p]=h.normalRange;break;case 2:a[p]=h.largeRange;break;case 3:a[p]=h.extraLargeRange;break;case 4:a[p]=h.smallRange;break;case 5:a[p]=h.extraSmallRange;break;case 6:a[p]=h.nanometricRange;break;default:a[p]=t[p]}break;default:if("string"==typeof(f=t[p]))if(f.endsWith("Z")&&!isNaN(Date.parse(f)))a[p]=new Date(f);else{var E=e.String.escapeHTML(f);a[p]=E,f.length!==E.length&&(s[E]=!0)}else a[p]=f}return t.code&&(!s||!s[a.code])&&(a.code=t.code),null==t.reservedby&&(a.reservedby=null),{data:a,conx:r,eStrings:s}},_trackInitAction:function(e){try{let t=1,n=this._nodeList.length,i={UXName:"Revisions",numberObjects:t,typeObjects:this.type,pv16:n};e&&e.showDuplicatesIsChecked&&(i.pv17=1),this.trackerEventBeginTime&&(i.actionTime=Date.now()-this.trackerEventBeginTime,delete this.trackerEventBeginTime),this.initActionEvent=p.createInitActionEvent(i,this.initActionEvent),p.checkAndTrackPageEvent(this.initActionEvent)}catch(e){console.log("trackInitAction error: "+e)}}});return f})),define("DS/ENOXVersionExplorerModelManager/ModelManagerHistory2",["DS/ENOXVersionExplorerModelWebServices/ModelWebServicesHistory2","DS/ENOXVersionExplorerModel/VersionTreeNodeModel","DS/ENOXVersionExplorerUtils/ENOXVersionExplorerUtils","DS/WebappsUtils/WebappsUtils","i18n!DS/ENOXVersionExplorerController/assets/nls/NodeDropdownMenuNLS","i18n!DS/ENOXVersionExplorerModelManager/assets/nls/SemanticRelationships"],(function(e,t,n,i,r){"use strict";return e.extend({_onCompleteLoadVersions:function(e,t){var n=this;setTimeout((function(){!0!==t&&(n._loadBranchFilters(),n._loadPersonInfo(),n._loadThumbnailsAsync(),n._trackInitAction({showDuplicatesIsChecked:!0}))}),100)},_createVersionData:function(e,t,r){(e.copyFrom&&!e.ancestors||Array.isArray(e.ancestors)&&!e.ancestors.length)&&r.findIndex((function(t){return t.id===e.copyFrom}))>=0&&(this.__proto__._isMinorRevision.call(this,e)||(e.ancestors=[{semantic:"SO",id:e.copyFrom}]));var o=this.__proto__._createVersionData.call(this,e,t,r),s=n.getHistoryCustomAttribute(e);if(this.mainBranchRoot||(this.mainBranchRoot=r.find((function(e){return!Array.isArray(e.ancestors)||Array.isArray(e.ancestors)&&0===e.ancestors.length}))),o.conx&&o.conx.length||(o.data.position=0),s){if(o.data.custom_node_color="string"==typeof s.node_color&&s.node_color.length?s.node_color:"",Array.isArray(o.conx)&&o.conx.length){var a,c=o.conx.filter((function(e){return!("E"==e.semantic||"I"==e.semantic)}));if(o.conx&&1===c.length&&s&&"true"===s.setAsTree&&(a=s.position,!isNaN(a)))c[0].semantic="I",o.data.position=a,o.data.redrawFlag=!0,c[0].reference=this.mainBranchRoot.id,c[0].mergeBetweenRoots=!0,c[0].mergeLeft=!0,"string"==typeof s.icon&&s.icon.length&&(c[0].icon=i.getWebappsBaseUrl()+"HistoryExplorer/assets/icons/32/"+s.icon),"string"==typeof s.line_color&&s.line_color.length&&(c[0].custom_line_color=s.line_color);else for(var l=0,d=o.conx.length;l<d;l++){var p=o.conx[l];"I"!==p.semantic&&"string"==typeof s.line_color&&s.line_color.length?p.custom_line_color=s.line_color:p.redrawFlag=!0,"string"==typeof s.icon&&s.icon.length&&(p.icon=i.getWebappsBaseUrl()+"HistoryExplorer/assets/icons/32/"+s.icon)}}}else o.data.custom_node_color="";return o},_createNodeArray:function(e,t){for(var n=this.__proto__._createNodeArray.call(this,e,t),i=[],r=0,o=n.length;r<o;r++)isNaN(n[r].options.grid.position)||(i.push(n.splice(r,1)[0]),o-=1,r-=1);return i.length&&i.sort((function(e,t){return e.options.grid.position-t.options.grid.position})),n=i.concat(n)},getNewVersionName:function(){var e,n=this;if(n.isLoaded()&&n.getNumberOfNodes()>0){var i=n._nodeList[0];i instanceof t&&(e=r.version+(n.getNumberOfNodes()+1).toString()+"_"+i.options.grid.title)}return e},_updateMerges:function(){var e=this;if(void 0!==this.mainBranchRoot){var n=e.searchByID(this.mainBranchRoot.id)[0];this._mergeConnections.forEach((function(i,r,o){i.mergeBetweenRoots&&(i.reference=i.reference instanceof t?i.reference:e.searchByID(i.reference)[0],i.referenceBranch=i.reference.__BRANCH__,!i.child instanceof t&&(i.child=e.searchByID(i.child)[0]),i.child instanceof t&&i.child.processDescendants({async:!1,onlyVisibleNodes:!0,processNode:function(r){var o=r.nodeModel;e._mergeConnections.filter((function(e){return e.child===o})).forEach((function(r){r.parent instanceof t||(r.parent=e.searchByID(r.parent)[0]),r.parent instanceof t&&n.isAscendantOf(r.parent)&&(r.mergeLeft=!0,r.referenceBranch=i.referenceBranch)}))}}))})),this.__proto__._updateMerges.call(this)}},empty:function(){this.__proto__.empty.call(this),this.mainBranchRoot=void 0}})}));