define("DS/ENOCollabRouteTask/RouteTaskHelper",["DS/RDFFoundation/SecurityContextUtils","DS/E6WCommonUI/PlatformManager","DS/E6WCommonUI/Models/BulkModel","DS/ControlsEx/LoadingPanel","DS/RouteWebAppUX/scripts/RouteWebAppApprovalStatusUX","DS/ENORouteMgmt/Views/Panels/RouteTaskPanel","DS/E6WCommonApps/Views/ConfirmDialog","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS"],(function(e,t,n,o,a,s,i,r){"use strict";var l={};return l.getIconValue=function(e){return require.toUrl("DS/E6WCommonApps/assets/img/I_RouteTask"+(e?"_16.png":"_22.png"))},l.validate=function(e,t,n,o){return n=l._validateApprovalComments(e,n,o),n=l._validateApprovalAction(e,n,o),n=l._validateEnforceOwnerReviewComments(e,n,o),(n=l._validateSignatureRequired(e,t,n,o))&&n.fields.length?n:void 0},l._validateApprovalComments=function(e,t,n){if(n.currentState!==n.newState&&e.hasOwnProperty("routeTaskAction")){var o=e.routeTaskApprovalComments&&e.routeTaskApprovalComments.trim();n.enforceAssigneeApprovalComments&&!o&&t.fields.push("routeTaskApprovalComments")}return t},l._validateApprovalAction=function(e,t,n){return n.currentState!==n.newState&&e.hasOwnProperty("routeTaskApprovalAction")&&"Approve"===e.routeTaskAction&&"None"===e.routeTaskApprovalAction&&t.fields.push("routeTaskApprovalAction"),t},l._validateEnforceOwnerReviewComments=function(e,t,n){return"Yes"===n.needsReview&&n.enforceOwnerReviewComments&&e.hasOwnProperty("routeTaskReviewerComments")&&("Complete"!==n.newState||e.routeTaskReviewerComments.trim()||t.fields.push("routeTaskReviewerComments")),t},l._validateSignatureRequired=function(e,t,n,o){return o.currentState!==o.newState&&e.hasOwnProperty("routeTaskApprovalAction")&&"Approve"===e.routeTaskAction&&"None"!==e.routeTaskApprovalAction&&(0!==n.fields.length||"True"!==e.routeTaskRequiresESign||t._signature||(n.fields.push("signature_required"),n.fields.push(e.routeTaskApprovalAction))),n},l.loadPanel=function(n,a,i,r){var l=UWA.clone(r||{},!1);a.securityContext=e.getDefaultSecurityContext(),a.tenant=t.getTenant(),a.collection=i;let u={cbtModel:a,collection:a.collection};var c=new o({value:75,width:"400px",shape:"circular",modalFlag:!0});a.preSave=function(){a.nbInFlightRequests=1,a.dispatchEvent("onChange:nbInFlightRequests",[this,l])},a.postSave=function(e,t){a.nbInFlightRequests=0,a.collection.fetch({server:!0,partialRefresh:!0,noTag:!0}),a.dispatchEvent("onChange:nbInFlightRequests",[this,l]),("true"==t&&l.close||this.closePanel)&&l.close(),"true"==e&&(document.getElementById("RouteTaskRightPanelContainer")&&document.getElementById("RouteTaskRightPanelContainer").remove(),n&&n.empty(),c.inject(n),c.value=void 0,c.on(),l.loadingPanel=c,s.init(n,u,"taskActionMode",l))},n&&n.empty(),c.inject(n),c.value=void 0,c.on(),l.loadingPanel=c,s.init(n,u,"taskActionMode",l)},l.cancelPanel=function(e,t,n){var o=UWA.clone(n||{},!1),a=this,s=t,r=function(){o.keepPanelOpen||n.close(),UWA.is(o.onCancel,"function")&&o.onCancel()};t.get("inboxTaskModified")?(o.model=s,o.onAbortSave=function(){s.set("inboxTaskModified",!1)},o.onSave=()=>{a.save&&a.save(),s.save&&s.save()},o.callback=r,i.render(o)):r()},l.getCardMenuItems=function(n,o,s){if(null==n.completed)return o;var i=UWA.clone(s||{},!1);let r=[];if(0==i.selectedModels.length?r.push(n):r=i.selectedModels,r.length>0){r.length>1&&(o=[]);for(let o=0;o<r.length;o++)r[o].securityContext=e.getDefaultSecurityContext(),r[o].currentTenant=t.getTenant(),r[o].postMenuSave=function(){n.nbInFlightRequests=0,n.collection.fetch({server:!0,partialRefresh:!0,noTag:!0}),n.dispatchEvent("onChange:nbInFlightRequests",[this,i])};if(void 0!==a)try{let e=a.getCollabTasksStatusMenu(r);for(let t=0;t<e.length;t++)o.push(e[t])}catch{}}return o},l.getChangeAssignee=function(e,t){var o=!1;let a;return(t&&t.selectedModels&&t.selectedModels.length>1||e instanceof n)&&(o=!0,a=t.selectedModels.map((e=>e.id))),{className:"user-change",fonticon:"user-change",text:(s="E6WCommonApps.Label.ChangeAssignee",r.get(s)),handler:function(){const t=function(){var t={taskId:e.id,taskTitle:e._attributes.title,assigneePID:e.get(e.ASSIGNEESATTR)[0].id,type:"Inbox Task",routeOwnerTask:e.get("routeOwnerTask"),routeOwnerUGChoice:e.get("routeOwnerUGChoice"),routeOwnerUGName:e.get("routeOwnerUGName"),routeId:o?a:e.get("route")[0].id,Scope:["All","",""],ScopeMembers:"All"};t.collabstorage=widget.data.collabstorage,t.collabspace=widget.data.collabspace,t.collabspace===WidgetAPIs.TSK_PRIVATE_SPACE&&(t.noSecurityContextForSearch=!0);try{require("DS/ENORouteMgmt/Views/Dialogs/InitiateChangeAssignee").init(t),widget.routeMgmtMediator&&widget.routeMgmtMediator.subscribe("route-task-on-change-assignee",(function(t){e._removeFromCollection()}))}catch{console.log("that.initiateRouteChangeAssignee().init(options);")}};e.get("routeOwner")?t():e.addEventOnce("onSync",t)}};var s},l}));