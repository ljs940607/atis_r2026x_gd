define("DS/DMUControls/DMURequirementCompareLegend",["require","exports","DS/Controls/Label","UWA/Core","DS/Utilities/TouchUtils","css!DS/DMUControls/DMUControls.css"],(function(e,t,n,i,o){"use strict";return class{constructor(e){let t,a;function l(){if(!t)return;let n=e.getImmersiveFrame().getFreeZone().getSize();if(n.width){let i=0,o=e.getImmersiveFrame().getDockingElement(WUXDockAreaEnum.LeftDockArea);(o.getContainedVisibleWindows().length>0||o.interactiveDockAreaVisibleFlag)&&(i=o._collapserSize,o.collapseDockingZoneFlag||(i+=o.dockingZoneSize));let a=t.getSize().width;i+=n.width/2-a/2,t.setStyles({opacity:"1",left:i+"px",width:a+"px"})}}function s(e){if(t&&void 0!==e){let n=i.createElement("div",{class:"DMUSideCircleButton"}).inject(t);return o.getTouchMode()&&n.setStyles({width:"24px",height:"24px"}),n.style.background=e,n}}function r(e){t&&new n({value:e,emphasize:"NONE",width:"100px"}).inject(t)}this.build=function(n){t=new i.Element("div",{class:"DMUReqCompareLegendContainer"}).inject(e.getUIFrame()),t&&(t.setStyles({opacity:"0"}),a=s(n.leftButtonColor),r(n.firstReqName),a=s(n.rightButtonColor),r(n.secondReqName),e.getImmersiveFrame().addEventListener("freeZoneResize",l),l())},this.update=function(e){a&&e.leftButtonColor&&(a.style.background=e.leftButtonColor)},this.clean=function(){e&&t&&t.parentNode===e.getUIFrame()&&e.getUIFrame().removeChild(t),e&&e.getImmersiveFrame().removeEventListener("freeZoneResize",l),t=null}}}})),define("DS/DMUControls/DMUCurrentPageWidget",["UWA/Core","UWA/Class","DS/VisuEvents/EventsManager","css!DS/DMUControls/DMUControls.css"],(function(e,t,n){"use strict";return t.extend({init:function(t){var i=t||{};if(i.frameWindow){this._parent(i);var o,a,l,s=this,r=0;this.setOffset=function(e){o&&r!==e&&(r=e,o.setStyle("left",e+20+"px"))},this.updateCurrentPage=function(e){a&&a.value!==e.toString()&&(a.value=e,l=e.toString())},this.enableCurrentPageEdition=function(){a&&o&&(a.focus(),a.select(),o.addClassName("focused"))},this.setVisibility=function(e){o&&o.setStyle("visibility",e?"visible":"hidden")},this.clean=function(){a&&a.removeEvents(),o&&i.frameWindow.getUIFrame().removeChild(o),n.removeEvent(o,"onPrimaryPointerClick",s.enableCurrentPageEdition),o=a=null},o=e.createElement("div",{id:"DMUCurrentPageWidget",class:"DMUCurrentPageMainDiv"}).inject(i.frameWindow.getUIFrame()),n.addEvent(o,"onPrimaryPointerClick",s.enableCurrentPageEdition);var d=e.createElement("div",{class:"DMUCurrentPageDiv"}).inject(o),c=i.maxValue.toString().length;(a=e.createElement("input",{id:"DMUCurrentPageWidgetInput",class:"DMUCurrentPageInput",maxlength:c,value:1,autocomplete:"off",styles:{width:c+window.devicePixelRatio+"ch"}}).inject(d)).onchange=function(){u(parseInt(a.value)),o.removeClassName("focused")},a.onkeyup=function(e){"Enter"===e.key&&(u(parseInt(a.value)),this.blur())},a.onblur=function(){o.removeClassName("focused")},a.onclick=function(){a.select(),o.addClassName("focused")},e.createElement("span",{text:"/",styles:{margin:"0px 5px"}}).inject(d),e.createElement("span",{text:i.maxValue}).inject(d)}function u(e){isNaN(e)||e<=0||e>i.maxValue?a.value=l:(l=e,i.onValueChanged&&i.onValueChanged(e))}}})})),define("DS/DMUControls/DMUHTMLBox",["UWA/Core","UWA/Controls/Abstract","DS/DMUBaseExperience/EXPUtils","DS/DMUBaseExperience/EXPToolsVisualization","DS/SceneGraphNodes/CSS2DNode","DS/Visualization/ThreeJS_DS","css!DS/DMUControls/DMUControls.css"],(function(e,t,n,i,o,a){"use strict";return t.extend({init:function(t){let l;this._parent(t);let s=new e.Element("div",{class:"DMUHTMLBoxWidget",style:{whiteSpace:"pre-line"}}),r=new e.Element("div",{class:"DMUHTMLMainDiv"}).inject(s),d=e.createElement("p",{contenteditable:!1,class:"DMUHTMLBoxParagraph"}).inject(r);function c(e){e.stopPropagation()}d.addEventListener("contextmenu",c),t.onTextModifiedCB&&t.onTextModificationEndCB&&(s.addEventListener("input",t.onTextModifiedCB),s.addEventListener("paste",(e=>{if(!e)return;e.preventDefault();let t=e.clipboardData.getData("text/plain");document.execCommand("insertText",!1,t)})),s.addEventListener("keydown",(e=>{e&&("Escape"!==e.key&&27!==e.keyCode&&("Enter"!==e.key&&13!==e.keyCode||e.shiftKey)||(e.preventDefault(),t.onTextModificationEndCB()))})));let u=new o({html:s,position:t.positionBreakPoint3D,name:t.title});function h(e,n){l=e.clone();let o=i.getWindowPositionFromPoint(t.viewer,l,t.window);if(u&&u.getElement()&&(u.setMatrix((new a.Matrix4).setPosition(l)),u.updatePosition(),"center"===n)){let e=function(e){let t,n;if(u&&u.getElement()){let e=u.getElement();t=e.offsetHeight||e.style.pixelHeight,n=e.offsetWidth||e.style.pixelWidth}return t&&n?{left:e.left+n/2,top:e.top+t/2}:void 0}(o);e&&e.left&&e.top&&u.setOffset(new a.Vector2((o.left-e.left)*window.devicePixelRatio,(o.top-e.top)*window.devicePixelRatio))}}s.parentNode&&s.parentNode.style&&(s.parentNode.style.border="solid 0px transparent"),u._getExcludeFromCSO=function(){return!0},u.css2DNode.primitive=!0,t.parentNode.addChild(u),this.remove=function(){d&&d.removeEventListener("contextmenu",c),s&&s.destroy(),t&&t.parentNode&&t.parentNode.removeChild(u),u=s=null},this.focusAndSelectText=function(){window.getSelection().removeAllRanges();let e=document.createRange();e.selectNodeContents(d),window.getSelection().addRange(e),d.focus()},this.getText=function(){let e=[],t=(d.innerText||"").split("\n");for(let n=0;n<t.length;n++)(t[n]||n!==t.length-1)&&(t[n]=t[n].replace("\r",""),e.push(t[n]));return e},this.update=function(t){if(t.lOwnerData){let n=new e.Element("div",{class:"DMUHTMLBox"});r.insertBefore(n,d),t.lOwnerData.leftBorder&&r.setStyle("border-left",t.lOwnerData.leftBorder);let i=e.createElement("img",{class:"DMUHTMLBoxImage"}).inject(n);t.lOwnerData.imgURL&&(i.src=t.lOwnerData.imgURL);let o=new e.Element("div",{class:"DMUHTMLImageBox"}).inject(n),a=e.createElement("div",{class:"DMUHTMLOwnerBox"}).inject(o);e.createElement("p",{class:"DMUHTMLBoxOwner",text:t.lOwnerData.owner[0]}).inject(a).setStyles({color:t.lOwnerData.ownerColor}),e.createElement("p",{class:"DMUHTMLBoxDate",text:t.lOwnerData.owner[1]}).inject(a).setStyles({color:t.lOwnerData.dateColor,fontSize:t.lOwnerData.dateFontSize}),e.createElement("p",{class:"DMUHTMLBoxStampParagraph",text:t.lOwnerData.content}).inject(o).setStyles({color:t.lOwnerData.stampColor,fontWeight:t.lOwnerData.stampFontStyle}),d.setStyle("margin-left","30px")}t.textAlign&&(r.style.textAlign=t.textAlign),t.padding&&(r.style.padding=t.padding),t.sFontName&&(r.style.fontFamily=t.sFontName),t.iFontSize&&(r.style.fontSize=t.iFontSize),t.sFontStyle&&("bold"===t.sFontStyle?r.style.fontWeight=t.sFontStyle:r.style.fontStyle=t.sFontStyle),t.cFontColor&&(r.style.color=n.colorToHex(t.cFontColor)),void 0!==t.bIsFilled&&(t.bIsFilled?t.cFillStyleColor&&(r.style.background=n.hexToRgb(n.colorToHex(t.cFillStyleColor),t.fOpacity?t.fOpacity:1)):r.style.background="none"),void 0!==t.bHasBorder&&(t.bHasBorder?(s.style.borderStyle="solid",t.cLineStyleColor&&(s.style.borderColor=n.colorToHex(t.cLineStyleColor)),t.fLineStyleThickness&&(s.style.borderWidth=t.fLineStyleThickness)):s.style.border="none"),t.borderRadius&&(s.style.borderRadius=t.borderRadius,s.parentElement.style.borderRadius=t.borderRadius,r.style.borderRadius=t.borderRadius,r.parentElement.style.borderRadius=t.borderRadius),t.lineHeight&&(s.style.lineHeight=t.lineHeight,d.style.lineHeight=t.lineHeight),t.sTextContents&&(d.innerText=t.sTextContents.join("\n")),void 0!==t.bEditable&&d.contenteditable!==t.bEditable&&d.setAttributes({contenteditable:t.bEditable}),void 0!==t.rotationAngle&&(s.parentElement.style.transform="rotate("+-t.rotationAngle+"rad)"),t.position&&h(t.position,t.anchorMode)}}})})),define("DS/DMUControls/EXPNotify",["UWA/Class","DS/CATWebUXComponents/CATWebUXNotification"],(function(e,t){"use strict";return e.extend({init:function(e){var n=new t;void 0===e.autoHide&&(e.autoHide=!0),n.build(e),this.destroy=function(){n&&n.destroy(),n=null}}})})),define("DS/DMUControls/EXPNavBar",["UWA/Core","UWA/Class","DS/Controls/TabBar","css!DS/DMUControls/DMUControls.css"],(function(e,t,n){"use strict";return t.extend({init:function(t){var i=t||{};if(i.frameWindow){var o;this._parent(i);var a,l={},s=i.offset?i.offset:0,r=i.activeTabIndex?i.activeTabIndex:i.tabs?i.tabs[0].id:null,d=!0,c=function(){if(o&&a){var e=i.frameWindow.getImmersiveFrame().getFreeZone().getSize();if(e.width){var t=a.getWidthWithoutScroll(),n=e.width-s,l=t+100>n?n:t+100;o.setStyles({"max-width":l-50+"px",width:l-50+"px"});var r=0;let d=i.frameWindow.getImmersiveFrame().getDockingElement(WUXDockAreaEnum.LeftDockArea);(d.getContainedVisibleWindows().length>0||d.interactiveDockAreaVisibleFlag)&&(r=d._collapserSize,d.collapseDockingZoneFlag||(r+=d.dockingZoneSize)),r+=(n-l)/2+s+25,o.setStyles({left:r+"px"})}}};this.setOffset=function(e){s!==e&&(s=e,c())},this.getOffset=function(){return s},this.setVisibleFlag=function(e){o.setStyles({display:e?"":"none"})},this.getVisibleFlag=function(){return""===o.style.display},this.setActiveNarBarItem=function(e){a&&(d=!1,a.value=[e],r=e,d=!0)},this.getActiveNarBarItem=function(){if(a)return a.value},this.clean=function(){a&&(a.displayStyle="normal",a.destroy()),o&&i.frameWindow.getUIFrame().removeChild(o),l.onFreeZoneResize&&i.frameWindow&&i.frameWindow.getImmersiveFrame().removeEventListener("freeZoneResize",c),o=a=null,l={}};if((o=e.createElement("div",{class:"EXPNavBar"}).inject(i.frameWindow.getUIFrame())).setStyles({opacity:0}),a=new n({displayStyle:["strip","strip-box"],showComboBoxFlag:!0}).inject(o),i.tabs&&i.tabs.length)for(var u=0;u<i.tabs.length;u++)a.add({value:i.tabs[u].id,label:i.tabs[u].label});a.addEventListener("change",(function(e){d&&e.dsModel.value[0]&&e.dsModel.value[0]!==r&&(r=e.dsModel.value[0],i.onClickCB(r)),d=!0})),l.onFreeZoneResize||(i.frameWindow.getImmersiveFrame().addEventListener("freeZoneResize",c),l.onFreeZoneResize=1),r&&this.setActiveNarBarItem(i.activeTabIndex),setTimeout((function(){o&&(c(),o.setStyles({opacity:1}))}),50)}}})})),define("DS/DMUControls/EXPColorPicker",["UWA/Core","UWA/Class","DS/Controls/Gauge","DS/Visualization/ThreeJS_DS","DS/VisuEvents/EventsManager","DS/WebappsUtils/WebappsUtils","DS/CoreEvents/Events","DS/VisuEvents/EventsManager","css!DS/DMUControls/DMUControls.css"],(function(e,t,n,i,o,a,l,s){"use strict";return t.extend({init:function(t){var r,d,c=t||{};this._parent(c);var u,h,m,p,g,f,C,v,w,b,y=a.getWebappsAssetUrl("DMUBaseUI","images/"),D=!1,S=this,x=!0,E=!0,k={color:!0,opacity:!0},M=!0,P=[{r:0,g:0,b:0},{r:25,g:25,b:25},{r:61,g:61,b:61},{r:75,g:75,b:75},{r:100,g:100,b:100},{r:125,g:125,b:125},{r:150,g:150,b:150},{r:175,g:175,b:175},{r:190,g:190,b:190},{r:205,g:205,b:205},{r:230,g:230,b:230},{r:255,g:255,b:255}],I=[{r:109,g:40,b:40},{r:204,g:9,b:47},{r:143,g:76,b:0},{r:255,g:138,b:46},{r:254,g:224,b:0},{r:87,g:184,b:71},{r:71,g:119,b:56},{r:141,g:222,b:228},{r:54,g:142,b:196},{r:77,g:98,b:186},{r:0,g:37,b:150},{r:155,g:42,b:152}];function U(e){"boolean"==typeof e.color&&(k.color=e.color,C&&C.setStyles({display:e.color?"block":"none"}),(-1!==P.indexOf(b)&&M||-1!==I.indexOf(b)&&!M)&&m()),"boolean"==typeof e.opacity&&(k.opacity=e.opacity,v&&(v.setStyles({display:e.opacity?"block":"none"}),e.opacity&&w.getContent().hasClassName("EXPOpacitySliderDisableHover")?w.getContent().removeClassName("EXPOpacitySliderDisableHover"):e.opacity||w.getContent().addClassName("EXPOpacitySliderDisableHover")))}function T(e){for(var t=e.from[0].view;t;){if(t.className&&-1!==t.className.indexOf("EXPColorPicker"))return;t=t.parentNode}S.clean()}this.getContent=function(){return r},this.build=function(t){if(x=!1,S.clean(),x=!0,t.displayColorSlider||t.displayOpacitySlider){var A,F,B;if(r=e.createElement("div",{class:"EXPColorPicker"}),t.displayColorSlider&&function(t){var a;d=new e.createElement("div",{class:"EXPColorPickerColorSlider"}).inject(r);var l=-1,s=-1;if(t.defaultColor){for(var c=new i.Color,u=0;u<I.length;u++)if(c.setRGB(I[u].r/255,I[u].g/255,I[u].b/255),c.equals(t.defaultColor)){s=u,M=!0,b=I[u];break}if(-1===s)for(var h=0;h<P.length;h++)if(c.setRGB(P[h].r/255,P[h].g/255,P[h].b/255),c.equals(t.defaultColor)){l=h,M=!1,b=P[h];break}}else s=0,M=!0;var g=M?-1!==s?s:6:l;p=new e.Element("div",{class:"EXPColorPickerBWSwitch"}).inject(d);var v=new e.createElement("img").inject(p);v.src=y+(M?"I_SwitchBWPalette.png":"I_SwitchColorPalette.png");var w=new n({className:"EXPColorPickerColorGauge",minValue:0,maxValue:I.length-1,stepValue:1,value:g,graduationsLabel:!1,dynamicGaugeColor:!1,eventsList:[]}).inject(d);a=w.getContent(),w.elements.control.setStyles({height:"30px",margin:0}),(C=w._cursors[1]).setStyles({height:"30px",width:"20px","border-radius":"0px","border-width":"4px 3px","border-style":"solid","border-color":"rgb(240, 240, 240)",outline:"1px solid #adadad"}),C.setHTML(""),w._cursors[0].setStyles({backgroundColor:"none"}),a.setAttributes({id:M?"color_gauge":"bw_gauge"}),a.setStyles({backgroundImage:'url("'+y+(M?"ColorPalette.jpg":"BWPalette.jpg")+'")',position:"absolute","margin-top":"14px",left:"30px"});var D=function(e){var n=[];if("color_gauge"===a.id?n=I:"bw_gauge"===a.id&&(n=P),!isNaN(w.getValue())){var i=w.getValue();b=n[i],C.setHTML(""),C.setStyles({backgroundImage:"none",backgroundColor:"rgb("+n[i].r+","+n[i].g+","+n[i].b+")","-webkit-transform":"translate3d(-50%,0,0)","-moz-transform":"translate3d(-50%,0,0)","-ms-transform":"translate3d(-50%,0,0)","-o-transform":"translate3d(-50%,0,0)",transform:"translate3d(-50%,0,0)"}),t.onColorChangedCB&&(g=i,e.sendCB&&t.onColorChangedCB({color:"rgb("+n[g].r+","+n[g].g+","+n[g].b+")"}))}};w.addEvent("change",(function(){f&&f.hasClassName("EXPColorPickerResetButtonActiveState")&&f.removeClassName("EXPColorPickerResetButtonActiveState"),D({sendCB:!0}),U({color:!0,opacity:t.colorAndOpacityBinded})})),m=function(){M=!M,"color_gauge"===a.id?(a.style.backgroundImage='url("'+y+'BWPalette.jpg")',a.id="bw_gauge",v.src=y+"I_SwitchColorPalette.png"):"bw_gauge"===a.id&&(a.style.backgroundImage='url("'+y+'ColorPalette.jpg")',a.id="color_gauge",v.src=y+"I_SwitchBWPalette.png"),k.color&&(g=-1,D({sendCB:!0}))},o.addEvent(p,"onPrimaryPointerClick",m),U({color:null!==t.defaultColor,opacity:t.colorAndOpacityBinded&&null!==t.defaultColor}),D({sendCB:!1})}(t),t.displayOpacitySlider&&(A=t,B=new e.createElement("div",{class:"EXPColorPickerOpacitySlider"}).inject(r),F=0===A.defaultOpacity?0:A.defaultOpacity?A.defaultOpacity:1,(w=new n({className:"EXPColorPickerOpacityGauge",minValue:A.minOpacity?A.minOpacity:0,maxValue:A.maxOpacity?A.maxOpacity:1,stepValue:.1,value:F,graduationsLabel:!1,dynamicGaugeColor:!1,eventsList:[]}).inject(B)).getContent().setStyles({"margin-top":"5px",border:"none"}),w.elements.control.setStyles({height:"10px",top:"4px"}),v=w._cursors[1],U({opacity:null!==A.defaultOpacity,color:A.colorAndOpacityBinded&&null!==A.defaultOpacity}),w._cursors[1].setStyles({height:"20px",top:"-4px"}),w.addEvent("change",(function(){f&&f.hasClassName("EXPColorPickerResetButtonActiveState")&&f.removeClassName("EXPColorPickerResetButtonActiveState"),U({opacity:!0,color:A.colorAndOpacityBinded}),A.onOpacityChangedCB&&A.onOpacityChangedCB({opacity:this.getValue()}),this._cursors[1].setStyles({"-webkit-transform":"translate3d(-50%,0,0)","-moz-transform":"translate3d(-50%,0,0)","-ms-transform":"translate3d(-50%,0,0)","-o-transform":"translate3d(-50%,0,0)",transform:"translate3d(-50%,0,0)"})}))),t.displayResetButton&&function(t){(f=new e.createElement("div",{class:"EXPColorPickerResetButton"}).inject(d)).title=t.resetButtonLabel,t.defaultResetState&&(f.addClassName("EXPColorPickerResetButtonActiveState"),U({color:!1,opacity:!1})),new e.createElement("img",{class:"EXPColorPickerResetButtonIcon"}).inject(f).src=a.getWebappsAssetUrl("DMUControls","icons/22/")+"I_ResetButton.png",g=function(){f.hasClassName("EXPColorPickerResetButtonActiveState")||(t.onResetButtonPressedCB(),f.addClassName("EXPColorPickerResetButtonActiveState"),U({color:!1,opacity:!1}))},o.addEvent(f,"onPrimaryPointerClick",g)}(t),E=!1!==t.hideWithDistance,c.frameWindow){var R=c.frameWindow.getContextualUIManager().getContextualBar(),j=R.getPosition();if(j&&R||t.position&&t.position.x&&t.position.y){var _=t.displayColorSlider&&t.displayOpacitySlider?80:t.displayColorSlider?53:30,N=238;t.displayResetButton&&(N+=35);var L=t.position?0:R.elements.container.getDimensions().width/2-N/2,O=t.position?0:R.elements.container.getDimensions().height,W=t.position?t.position.x:j.x+L,V=t.position?t.position.y:j.y-O-_-5;V<0&&(V=j.y+5),(u=new e.Element("div",{class:"EXPContextualColorPicker",styles:{position:"absolute",top:V+"px",left:W+"px",width:N+"px",height:_+"px",opacity:1}}).inject(c.frameWindow.getUIFrame())).appendChild(r),h=l.subscribe({event:"/VISU/"},(function(e){var t=e.eventType;if("@onViewpointBeginMove"===t)S.clean();else if("@onMoveEvent"===t&&E){var n=new i.Box2(new i.Vector2(W,V),new i.Vector2(W+N,V+_)).distanceToPoint(e.event.getCurrentPosition(c.frameWindow.getContent()));n>200?S.clean():u.setStyles({opacity:Math.min((200-n)/200,1)})}})),s.addEvent(document,"onLeftMouseDown",T),s.addEvent(document,"onTouch",T)}}D=!0}},this.getVisibleFlag=function(){return!c.frameWindow||D},this.setVisibleFlag=function(e){c.frameWindow&&u&&(!D&&e?u.inject(c.frameWindow.getUIFrame()):D&&!e&&c.frameWindow.getUIFrame().removeChild(u),D=e)},this.clean=function(){c.frameWindow&&u&&u.parentNode===c.frameWindow.getUIFrame()&&c.frameWindow.getUIFrame().removeChild(u),m&&p&&o.removeEvent(p,"onPrimaryPointerClick",m),g&&f&&o.removeEvent(f,"onPrimaryPointerClick",g),h&&l.unsubscribe(h),s.removeEvent(document,"onLeftMouseDown",T),s.removeEvent(document,"onTouch",T),r=u=h=p=m=g=f=null,x&&c.onDestroyCB&&c.onDestroyCB()}}})})),define("DS/DMUControls/DMUAddMembersCommonComponent",["UWA/Core","UWA/Class","DS/WUXAutoComplete/AutoComplete","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","i18n!DS/DMUControls/assets/nls/DMUControls","css!DS/DMUControls/DMUControls.css"],(function(e,t,n,i,o,a){"use strict";return t.extend({init:function(t){this._parent(t);const l=this;let s;this.buildAdditionDiv=function(t){s=t.additionalMembersInfo,l.globalDiv=e.createElement("div",{class:"add-dmu-members-global-div"});var r=e.createElement("div",{class:"add-dmu-coordinators-div"}).inject(l.globalDiv),d=e.createElement("div",{class:"add-dmu-assignees-div"}).inject(l.globalDiv),c=e.createElement("div",{class:"add-dmu-contributors-div"}).inject(l.globalDiv),u=e.createElement("div",{class:"add-dmu-informedusers-div"}).inject(l.globalDiv);new e.Element("div",{text:a.membersAdditionPanel.coordinator,class:"add-dmu-coordinators-title"}).inject(r),new e.Element("div",{text:a.membersAdditionPanel.assignee,class:"add-dmu-assignees-title"}).inject(d),new e.Element("div",{text:a.membersAdditionPanel.contributor,class:"add-dmu-contributors-title"}).inject(c),new e.Element("div",{text:a.membersAdditionPanel.informedUser,class:"add-dmu-informedusers-title"}).inject(u);var h=new e.Element("span",{class:"fonticon fonticon-search dmu-coordinators-field-search"}).inject(r),m=new e.Element("span",{class:"fonticon fonticon-search dmu-assignees-field-search"}).inject(d),p=new e.Element("span",{class:"fonticon fonticon-search dmu-contributors-field-search"}).inject(c),g=new e.Element("span",{class:"fonticon fonticon-search dmu-informedusers-field-search"}).inject(u),f=new i,C=new i,v=new i,w=new i;let b=null;l.coordinatorsAutoComplete=new n({elementsTree:function(e){return new Promise((function(n){b&&clearTimeout(b),b=setTimeout((function(){t.getMembers(e).then((function(e){f.empty(),f.prepareUpdate();var i=t.valCoordinators,a=l.coordinatorsAutoComplete.selectedItems;for(let t=0;t<e.length;t++){var s=[],r=[];a&&a.length>0&&(s=a.filter((n=>"person"===e[t].type.toLowerCase()?n.options.identifier===e[t].identifier:n.options.identifier===e[t].id))),i&&i.length>0&&(r=i.filter((n=>"person"===e[t].type.toLowerCase()?n.user===e[t].identifier:n.user===e[t].id)));var d=null;if((!a||0===a.length||0===s.length)&&0===r.length)if("person"===e[t].type.toLowerCase()){var c=e[t].name+" ("+e[t].identifier.toUpperCase()+")";d=new o({label:c,plmID:e[t].id,value:e[t].identifier,name:e[t].name,identifier:e[t].identifier,type:e[t].type.toLowerCase()}),f.addRoot(d)}else"group"===e[t].type.toLowerCase()&&(d=new o({label:e[t].name,value:e[t].identifier,name:e[t].name,identifier:e[t].id,type:e[t].type.toLowerCase()}),f.addRoot(d))}f.pushUpdate(),n(f)}),(function(){n(f)}))}),1e3)}))},placeholder:a.membersAdditionPanel.typeToSearch,customFilterMessage:a.membersAdditionPanel.noSearchFound,multiSearchMode:!0,allowFreeInputFlag:!1,minLengthBeforeSearch:3,keepSearchResultsFlag:!1}).inject(r),l.coordinatorsAutoComplete.getContent().addClassName("dmu-coordinatorsAutoComplete"),l.coordinatorsAutoComplete.getContent().getChildren()[0].addClassName("dmu-autoCompleteSelectionChip"),l.coordinatorsAutoComplete.getContent().getElementsByClassName("wux-controls-autoComplete-editor")[0].setStyle("min-width","180px"),l.assigneesAutoComplete=new n({elementsTree:function(e){return new Promise((function(n){b&&clearTimeout(b),b=setTimeout((function(){t.getMembers(e).then((function(e){C.empty(),C.prepareUpdate();var i=t.valAssignees,a=l.assigneesAutoComplete.selectedItems;for(let t=0;t<e.length;t++){var s=[],r=[];a&&a.length>0&&(s=a.filter((n=>"person"===e[t].type.toLowerCase()?n.options.identifier===e[t].identifier:n.options.identifier===e[t].id))),i&&i.length>0&&(r=i.filter((n=>"person"===e[t].type.toLowerCase()?n.user===e[t].identifier:n.user===e[t].id)));var d=null;if((!a||0===a.length||0===s.length)&&0===r.length)if("person"===e[t].type.toLowerCase()){var c=e[t].name+" ("+e[t].identifier.toUpperCase()+")";d=new o({label:c,plmID:e[t].id,value:e[t].identifier,name:e[t].name,identifier:e[t].identifier,type:e[t].type.toLowerCase()}),C.addRoot(d)}else"group"===e[t].type.toLowerCase()&&(d=new o({label:e[t].name,value:e[t].identifier,name:e[t].name,identifier:e[t].id,type:e[t].type.toLowerCase()}),C.addRoot(d))}C.pushUpdate(),n(C)}),(function(){n(C)}))}),1e3)}))},placeholder:a.membersAdditionPanel.typeToSearch,customFilterMessage:a.membersAdditionPanel.noSearchFound,multiSearchMode:!0,allowFreeInputFlag:!1,minLengthBeforeSearch:3,keepSearchResultsFlag:!1}).inject(d),l.assigneesAutoComplete.getContent().addClassName("dmu-assigneesAutoComplete"),l.assigneesAutoComplete.getContent().getChildren()[0].addClassName("dmu-autoCompleteSelectionChip"),l.assigneesAutoComplete.getContent().getElementsByClassName("wux-controls-autoComplete-editor")[0].setStyle("min-width","180px"),l.contributorsAutoComplete=new n({elementsTree:function(e){return new Promise((function(n){b&&clearTimeout(b),b=setTimeout((function(){t.getMembers(e).then((function(e){v.empty(),v.prepareUpdate();var i=t.valContributors,a=l.contributorsAutoComplete.selectedItems;for(let t=0;t<e.length;t++){var s=[],r=[];a&&a.length>0&&(s=a.filter((n=>"person"===e[t].type.toLowerCase()?n.options.identifier===e[t].identifier:n.options.identifier===e[t].id))),i&&i.length>0&&(r=i.filter((n=>"person"===e[t].type.toLowerCase()?n.user===e[t].identifier:n.user===e[t].id)));var d=null;if((!a||0===a.length||0===s.length)&&0===r.length)if("person"===e[t].type.toLowerCase()){var c=e[t].name+" ("+e[t].identifier.toUpperCase()+")";d=new o({label:c,plmID:e[t].id,value:e[t].identifier,name:e[t].name,identifier:e[t].identifier,type:e[t].type.toLowerCase()}),v.addRoot(d)}else"group"===e[t].type.toLowerCase()&&(d=new o({label:e[t].name,value:e[t].identifier,name:e[t].name,identifier:e[t].id,type:e[t].type.toLowerCase()}),v.addRoot(d))}v.pushUpdate(),n(v)}),(function(){n(v)}))}),1e3)}))},placeholder:a.membersAdditionPanel.typeToSearch,customFilterMessage:a.membersAdditionPanel.noSearchFound,multiSearchMode:!0,allowFreeInputFlag:!1,minLengthBeforeSearch:3,keepSearchResultsFlag:!1}).inject(c),l.contributorsAutoComplete.getContent().addClassName("dmu-contributorsAutoComplete"),l.contributorsAutoComplete.getContent().getChildren()[0].addClassName("dmu-autoCompleteSelectionChip"),l.contributorsAutoComplete.getContent().getElementsByClassName("wux-controls-autoComplete-editor")[0].setStyle("min-width","180px"),l.informedUsersAutoComplete=new n({elementsTree:function(e){return new Promise((function(n){b&&clearTimeout(b),b=setTimeout((function(){t.getMembers(e).then((function(e){w.empty(),w.prepareUpdate();var i=t.valInformedUsers,a=l.informedUsersAutoComplete.selectedItems;for(let t=0;t<e.length;t++){var s=[],r=[];a&&a.length>0&&(s=a.filter((n=>"person"===e[t].type.toLowerCase()?n.options.identifier===e[t].identifier:n.options.identifier===e[t].id))),i&&i.length>0&&(r=i.filter((n=>"person"===e[t].type.toLowerCase()?n.user===e[t].identifier:n.user===e[t].id)));var d=null;if((!a||0===a.length||0===s.length)&&0===r.length)if("person"===e[t].type.toLowerCase()){var c=e[t].name+" ("+e[t].identifier.toUpperCase()+")";d=new o({label:c,plmID:e[t].id,value:e[t].identifier,name:e[t].name,identifier:e[t].identifier,type:e[t].type.toLowerCase()}),w.addRoot(d)}else"group"===e[t].type.toLowerCase()&&(d=new o({label:e[t].name,value:e[t].identifier,name:e[t].name,identifier:e[t].id,type:e[t].type.toLowerCase()}),w.addRoot(d))}w.pushUpdate(),n(w)}),(function(){n(w)}))}),1e3)}))},placeholder:a.membersAdditionPanel.typeToSearch,customFilterMessage:a.membersAdditionPanel.noSearchFound,multiSearchMode:!0,allowFreeInputFlag:!1,minLengthBeforeSearch:3,keepSearchResultsFlag:!1}).inject(u),l.informedUsersAutoComplete.getContent().addClassName("dmu-informedUsersAutoComplete"),l.informedUsersAutoComplete.getContent().getChildren()[0].addClassName("dmu-autoCompleteSelectionChip"),l.informedUsersAutoComplete.getContent().getElementsByClassName("wux-controls-autoComplete-editor")[0].setStyle("min-width","180px");let y=async function(e,n,i){let a=null;n.selectedItems||(n.selectedItems=[]);let l=[],s=null;if(e.empty(),e.prepareUpdate(),i&&i.length>0)for(let n=0;n<i.length;n++){s=await t.getUserName(t.mode,i[n].user);let r={label:s[0]+" ("+i[n].user.toUpperCase()+")",memberValue:i[n].user,identifier:i[n].user,plmID:i[n].plmID,name:s[0],type:i[n].type.toLowerCase()};a=new o(r),e.addRoot(a),l.push(e.getRoots()[n])}e.pushUpdate(),n.selectedItems=l};t.retrievedCoordinators&&y(f,l.coordinatorsAutoComplete,t.retrievedCoordinators),t.retrievedAssignees&&y(C,l.assigneesAutoComplete,t.retrievedAssignees),t.retrievedContributors&&y(v,l.contributorsAutoComplete,t.retrievedContributors),t.retrievedInformedUsers&&y(w,l.informedUsersAutoComplete,t.retrievedInformedUsers);var D=async function(n,i){var r=null,d=null,c=null,u=null,h=null;let m=null,p=null;var g=null;let b=null;var y=null,D=null,S=null,x=null;if(!n["dswebux/x-controls.selectionchips.items+json"]){let I=[],U=[],T=[];for(n.forEach((e=>{e.objectId.contains("iam:")?I.push(e.objectId.replace("iam:","")):e.identifier&&e.identifier.length?I.push(e.identifier):T.push(e.objectId)})),T.length&&(U=await s(T)),m=I.concat(U),d=0;d<n.length;d++){let s=!1;if("Coordinators"===i){h=l.coordinatorsAutoComplete.selectedItems;var E=t.valCoordinators;if(p=n[d].objectType.replace("pno:",""),g=l.coordinatorsAutoComplete.selectedItems,E)for(u=0;u<E.length;u++)if(E[u].user.toUpperCase()===m[d].toUpperCase()){s=!0;break}if(!s)if(g&&g.length>0){for(b=g.filter((e=>{if("person"===p.toLowerCase())return e.options.identifier===m[d]})),c=0;c<g.length&&(!b||!b.length);c++)if(e.is(n)&&e.is(n.length)&&n.length>0){if("person"===n[d].objectType.toLowerCase()||"person"===p.toLowerCase()){f.prepareUpdate(),r=n[d].displayName+" ("+m[d].toUpperCase()+")",y=new o({label:r,memberValue:m[d],name:n[d].displayName,plmID:n[d].objectId,identifier:m[d],type:n[d].displayType}),f.addRoot(y),h?(h=h.concat(y),l.coordinatorsAutoComplete.selectedItems=h):(h=[y],l.coordinatorsAutoComplete.selectedItems=h),f.pushUpdate();break}t.dropWarningNotif&&t.dropWarningNotif&&t.dropWarningNotif(a.createReview.setMembersNotif)}}else e.is(n)&&e.is(n.length)&&n.length>0&&("person"===n[d].objectType.toLowerCase()||"person"===p.toLowerCase()?(f.prepareUpdate(),r=n[d].displayName+" ("+m[d].toUpperCase()+")",y=new o({label:r,memberValue:m[d],name:n[d].displayName,plmID:n[d].objectId,identifier:m[d],type:n[d].displayType}),f.addRoot(y),h?(h=h.concat(y),l.coordinatorsAutoComplete.selectedItems=h):(h=[y],l.coordinatorsAutoComplete.selectedItems=h),f.pushUpdate()):t.dropWarningNotif&&t.dropWarningNotif(a.createReview.setMembersNotif))}else if("Assignees"===i){h=l.assigneesAutoComplete.selectedItems;var k=t.valAssignees;if(p=n[d].objectType.replace("pno:",""),g=l.assigneesAutoComplete.selectedItems,k)for(u=0;u<k.length;u++)if(k[u].user.toUpperCase()===m[d].toUpperCase()){s=!0;break}if(!s)if(g&&g.length>0){for(b=g.filter((e=>{if("person"===p.toLowerCase())return e.options.identifier===m[d]})),c=0;c<g.length&&(!b||!b.length);c++)if(e.is(n)&&e.is(n.length)&&n.length>0){if("person"===n[d].objectType.toLowerCase()||"person"===p.toLowerCase()){C.prepareUpdate(),r=n[d].displayName+" ("+m[d].toUpperCase()+")",D=new o({label:r,memberValue:m[d],name:n[d].displayName,plmID:n[d].objectId,identifier:m[d],type:n[d].displayType}),C.addRoot(D),h?(h=h.concat(D),l.assigneesAutoComplete.selectedItems=h):(h=[D],l.assigneesAutoComplete.selectedItems=h),C.pushUpdate();break}t.dropWarningNotif&&t.dropWarningNotif(a.createReview.setMembersNotif)}}else e.is(n)&&e.is(n.length)&&n.length>0&&("person"===n[d].objectType.toLowerCase()||"person"===p.toLowerCase()?(C.prepareUpdate(),r=n[d].displayName+" ("+m[d].toUpperCase()+")",D=new o({label:r,memberValue:m[d],name:n[d].displayName,plmID:n[d].objectId,identifier:m[d],type:n[d].displayType}),C.addRoot(D),h?(h=h.concat(D),l.assigneesAutoComplete.selectedItems=h):(h=[D],l.assigneesAutoComplete.selectedItems=h),C.pushUpdate()):t.dropWarningNotif&&t.dropWarningNotif(a.createReview.setMembersNotif))}else if("Contributors"===i){h=l.contributorsAutoComplete.selectedItems;var M=t.valContributors;if(p=n[d].objectType.replace("pno:",""),g=l.contributorsAutoComplete.selectedItems,M)for(u=0;u<M.length;u++)if(M[u].user.toUpperCase()===m[d].toUpperCase()){s=!0;break}if(!s)if(g&&g.length>0){for(b=g.filter((e=>{if("person"===p.toLowerCase())return e.options.identifier===m[d]})),c=0;c<g.length&&(!b||!b.length);c++)if(e.is(n)&&e.is(n.length)&&n.length>0){if("person"===n[d].objectType.toLowerCase()||"person"===p.toLowerCase()){v.prepareUpdate(),r=n[d].displayName+" ("+m[d].toUpperCase()+")",S=new o({label:r,memberValue:m[d],name:n[d].displayName,plmID:n[d].objectId,identifier:m[d],type:n[d].displayType}),v.addRoot(S),h?(h=h.concat(S),l.contributorsAutoComplete.selectedItems=h):(h=[S],l.contributorsAutoComplete.selectedItems=h),v.pushUpdate();break}t.dropWarningNotif&&t.dropWarningNotif(a.createReview.setMembersNotif)}}else e.is(n)&&e.is(n.length)&&n.length>0&&("person"===n[d].objectType.toLowerCase()||"person"===p.toLowerCase()?(v.prepareUpdate(),r=n[d].displayName+" ("+m[d].toUpperCase()+")",S=new o({label:r,memberValue:m[d],name:n[d].displayName,plmID:n[d].objectId,identifier:m[d],type:n[d].displayType}),v.addRoot(S),h?(h=h.concat(S),l.contributorsAutoComplete.selectedItems=h):(h=[S],l.contributorsAutoComplete.selectedItems=h),v.pushUpdate()):t.dropWarningNotif&&t.dropWarningNotif(a.createReview.setMembersNotif))}else if("InformedUsers"===i){h=l.informedUsersAutoComplete.selectedItems;var P=t.valInformedUsers;if(p=n[d].objectType.replace("pno:",""),g=l.informedUsersAutoComplete.selectedItems,P)for(u=0;u<P.length;u++)if(P[u].user.toUpperCase()===m[d].toUpperCase()){s=!0;break}if(!s)if(g&&g.length>0){for(b=g.filter((e=>{if("person"===p.toLowerCase())return e.options.identifier===m[d]})),c=0;c<g.length&&(!b||!b.length);c++)if(e.is(n)&&e.is(n.length)&&n.length>0){if("person"===n[d].objectType.toLowerCase()||"person"===p.toLowerCase()){w.prepareUpdate(),r=n[d].displayName+" ("+m[d].toUpperCase()+")",x=new o({label:r,memberValue:m[d],name:n[d].displayName,plmID:n[d].objectId,identifier:m[d],type:n[d].displayType}),w.addRoot(x),h?(h=h.concat(x),l.informedUsersAutoComplete.selectedItems=h):(h=[x],l.informedUsersAutoComplete.selectedItems=h),w.pushUpdate();break}t.dropWarningNotif&&t.dropWarningNotif(a.createReview.setMembersNotif)}}else e.is(n)&&e.is(n.length)&&n.length>0&&("person"===n[d].objectType.toLowerCase()||"person"===p.toLowerCase()?(w.prepareUpdate(),r=n[d].displayName+" ("+m[d].toUpperCase()+")",x=new o({label:r,memberValue:m[d],name:n[d].displayName,plmID:n[d].objectId,identifier:m[d],type:n[d].displayType}),w.addRoot(x),h?(h=h.concat(x),l.informedUsersAutoComplete.selectedItems=h):(h=[x],l.informedUsersAutoComplete.selectedItems=h),w.pushUpdate()):t.dropWarningNotif&&t.dropWarningNotif(a.createReview.setMembersNotif))}}}},S=null;l.coordinatorsAutoComplete.addEventListener("drop",(e=>{if(S=JSON.parse(e.dataTransfer.getData("text/plain")),e.preventDefault(),e.stopPropagation(),S.data.items){var t=S.data.items;D(t,"Coordinators")}})),l.assigneesAutoComplete.addEventListener("drop",(e=>{if(S=JSON.parse(e.dataTransfer.getData("text/plain")),e.preventDefault(),e.stopPropagation(),S.data.items){var t=S.data.items;D(t,"Assignees")}})),l.contributorsAutoComplete.addEventListener("drop",(e=>{if(S=JSON.parse(e.dataTransfer.getData("text/plain")),e.preventDefault(),e.stopPropagation(),S.data.items){var t=S.data.items;D(t,"Contributors")}})),l.informedUsersAutoComplete.addEventListener("drop",(e=>{if(S=JSON.parse(e.dataTransfer.getData("text/plain")),e.preventDefault(),e.stopPropagation(),S.data.items){var t=S.data.items;D(t,"InformedUsers")}})),h.onclick=function(){t.searchMember({roleType:"coordinator",onSearchOkButtonClicked:function(e){var t=e.data.items;D(t,"Coordinators")}})},m.onclick=function(){t.searchMember({roleType:"assignee",onSearchOkButtonClicked:function(e){var t=e.data.items;D(t,"Assignees")}})},p.onclick=function(){t.searchMember({roleType:"contributor",onSearchOkButtonClicked:function(e){var t=e.data.items;D(t,"Contributors")}})},g.onclick=function(){t.searchMember({roleType:"informedUser",onSearchOkButtonClicked:function(e){var t=e.data.items;D(t,"InformedUsers")}})}}}})})),define("DS/DMUControls/DMUContextToolsMenu",["UWA/Class","UWA/Core","DS/Controls/Button","css!DS/DMUControls/DMUControls.css"],(function(e,t,n){"use strict";return e.extend({init:function(e){var i,o,a=[],l=[],s=t.createElement("div",{id:"DMUContextToolsMenu",class:"DMUContextToolsMenu"}).inject(e.frameWindow.getUIFrame()),r=t.createElement("div",{id:"DMUContextToolsCmdsContainer",class:"DMUContextToolsCmdsContainer"}).inject(s);function d(){var t=0,n=0,i=0,a=e.frameWindow.getImmersiveFrame().getDockingElement(WUXDockAreaEnum.RightDockArea),l=e.frameWindow.getImmersiveFrame().getDockingElement(WUXDockAreaEnum.BottomDockArea),r=e.frameWindow.getImmersiveFrame().getDockingElement(WUXDockAreaEnum.LeftDockArea),d=a.getContainedVisibleWindows().length>0,c=l.getContainedVisibleWindows().length>0,u=r.getContainedVisibleWindows().length>0;(d||a.interactiveDockAreaVisibleFlag)&&(t=a._collapserSize,a.collapseDockingZoneFlag||(t+=a.dockingZoneSize)),(c||l.interactiveDockAreaVisibleFlag)&&(n=l._collapserSize,l.collapseDockingZoneFlag||(n+=l.dockingZoneSize)),(u||r.interactiveDockAreaVisibleFlag)&&(i=r._collapserSize,r.collapseDockingZoneFlag||(i+=r.dockingZoneSize)),o&&o.setStyles({left:"calc("+i+"px + 10px)",bottom:"calc("+n+"px + 40px)"}),s&&(s.setStyles({right:t+"px",top:"50%",transform:"translateY(calc(-50% - "+.5*n+"px))"}),s.getPosition().y<=0&&s.setStyles({right:t+"px",top:"0px",transform:""}))}function c(e){if(a&&a.length)for(var t=0;t<a.length;t++)a[t].buttonDiv.removeClassName("DMUContextToolsSelectedCmd"),a[t].id!==e||a[t].isOneShot||a[t].buttonDiv.addClassName("DMUContextToolsSelectedCmd")}function u(e){if(l&&l.length)for(var t=0;t<l.length;t++)l[t].removeClassName("selected"),l[t].id===e&&l[t].addClassName("selected")}e.frameWindow.getImmersiveFrame().addEventListener("freeZoneResize",d),this.addButton=function(e){if(e&&e.label&&e.id&&e.icon&&e.onClickCB){var i=t.createElement("div",{id:e.id,title:e.label,class:"DMUContextToolsCmdButton"}).inject(r),o=new n({label:e.id,showLabelFlag:!1,icon:e.icon,displayStyle:"lite",onClick:function(t){c(t.dsModel.label),e.onClickCB({id:t.dsModel.label})}}).inject(i),l={id:e.id,type:e.type?e.type:"exclusive",button:o,buttonDiv:i,isOneShot:void 0!==e.isOneShot&&e.isOneShot};a.push(l),e.isSelected&&c(e.id),d()}},this.createCornerButton=function(n){(o=new t.Element("button",{id:n.id,class:"DMUContextToolsCornerButton",styles:{"background-image":"url("+n.disabledIcon+")"}}).inject(e.frameWindow.getUIFrame())).addEvent("click",(function(e){var t=o.hasClassName("selected");t?(o.removeClassName("selected"),o.setStyles({"background-image":"url("+n.disabledIcon+")"})):(o.addClassName("selected"),o.setStyles({"background-image":"url("+n.enabledIcon+")"})),n.onClickCB({id:e.target.id,checked:!t})})),d()},this.addSeparator=function(){t.createElement("div",{id:"DMUContextToolsCmdSeparator",class:"DMUContextToolsCmdSeparator"}).inject(r)},this.createColorPalette=function(e){e&&e.length&&(i||(this.addSeparator(),i=t.createElement("div",{id:"DMUContextColorPalette",class:"DMUContextColorPalette"}).inject(s),e.forEach((function(e){var n=new t.Element("button",{id:e.id,class:"DMUContextColorPaletteButton",styles:{"background-color":e.color.getStyle()}});n.addEvent("click",(function(t){u(t.target.id),e.onClickCB({id:t.target.id})})),n.inject(i),l.push(n),e.isSelected&&n.addClassName("selected")}))),d())},this.setColor=function(e){i&&u(e)},this.isCornerButtonActive=function(){return!(!o||!o.hasClassName("selected"))},this.setVisibleFlag=function(e){e?(o&&o.show(),s&&s.show()):(o&&o.hide(),s&&s.hide())},this.destroy=function(){e.frameWindow.getImmersiveFrame().removeEventListener("freeZoneResize",d),a&&a.length&&(a.forEach((function(e){e.buttonDiv.remove(),e.button=null})),a=null),s&&(e.frameWindow.getUIFrame().removeChild(s),s.remove(),s=null),r&&(r.remove(),r=null),i&&(i.remove(),i=null),o&&(o.remove(),o=null)}}})})),define("DS/DMUControls/EXPFileBrowser",["UWA/Core","UWA/Controls/Abstract"],(function(e,t){"use strict";return t.extend({init:function(t){this._parent(t);var n=null,i=new FileReader,o=!1,a=null;function l(){!o&&t.onErrorCB&&t.onErrorCB()}(n=new e.createElement("input",{id:"DMUFileSelector"}).inject(window.widget.body)).setAttribute("type","file"),n.setAttribute("accept","image/*"),n.setStyles({opacity:0}),n.onchange=function(){if(n){var e=n.files;if(!e||e&&!e.length)return void l();a=e[0].name,i.onload=function(){var e=new Image;e.src=i.result,e.name=a,e.onload=function(){o=!0,t.onFileLoadedCB({img:e,name:a})},e.onerror=l},setTimeout(l,5e3),i.readAsDataURL(e[0])}},this.openFileBrowser=function(){n.click()},this.cleanFileBrowser=function(){n&&n.parentNode===window.widget.body&&window.widget.body.removeChild(n),n=null}}})})),define("DS/DMUControls/DMUBaseSlider",["UWA/Core","UWA/Class","DS/Utilities/TouchUtils","DS/Controls/Slider","DS/Controls/Toggle","DS/Controls/ComboBox","DS/VisuEvents/EventsManager","i18n!DS/DMUControls/assets/nls/DMUControls","css!DS/DMUControls/DMUControls.css"],(function(e,t,n,i,o,a,l,s){"use strict";return t.extend({init:function(t){if(!t)return;let r,d,c,u,h,m=0,p={},g=null,f=null;function C(){if(!r)return;let e=t.getImmersiveFrame().getFreeZone().getSize();if(e.width){let n=0,i=t.getImmersiveFrame().getDockingElement(WUXDockAreaEnum.LeftDockArea);(i.getContainedVisibleWindows().length>0||i.interactiveDockAreaVisibleFlag)&&(n=i._collapserSize,i.collapseDockingZoneFlag||(n+=i.dockingZoneSize)),n+=e.width/2-m/2,r.setStyles({opacity:"1",left:n+"px",width:m+"px"})}}this.build=function(v){let w=v||{};if(isNaN(w.value))return;if(isNaN(w.minValue))return;if(isNaN(w.maxValue))return;if(isNaN(w.stepValue))return;(w.value<w.minValue||w.value>w.maxValue)&&(w.value=.5*(w.minValue+w.maxValue)),w.viewerCanvas&&(g=w.viewerCanvas),r=new e.Element("div",{class:"DMUBaseTranslationSliderSpinnerContainer"}).inject(t.getUIFrame()),r.setStyles({opacity:"0"}),void 0!==w.leftButton&&(void 0!==w.leftButton.color?(c=e.createElement("div",{class:"DMUBaseSideButton",title:w.leftButton.title}).inject(r),n.getTouchMode()&&c.setStyles({width:"24px",height:"24px"}),c.style.background=w.leftButton.color,c.addEventListener("click",(function(){f&&(f.value!==w.minValue?(h=f.value,f.value=w.minValue):h&&(f.value=h,h=void 0))}))):void 0!==w.leftButton.icon&&(c=new e.createElement("img",{class:"DMUBaseSideButton",src:w.leftButton.iconPath,styles:{left:"0px"}}).inject(r)),m+=n.getTouchMode()?36:24);let b,y,D=e.createElement("div",{class:"DMUBaseTranslationSliderContainer",styles:{display:""}}).inject(r);if(f=new i({minValue:w.minValue,maxValue:w.maxValue,stepValue:w.stepValue,value:w.value}).inject(D),m+=220,f.addEventListener("change",(function(){w.onChangeCB&&w.onChangeCB(f.value)})),void 0!==w.rightButton&&(void 0!==w.rightButton.color?(u=e.createElement("div",{class:"DMUBaseSideButton",title:w.rightButton.title}).inject(r),n.getTouchMode()&&u.setStyles({width:"24px",height:"24px"}),u.style.background=w.rightButton.color,u.addEventListener("click",(function(){f&&(f.value!==w.maxValue?(h=f.value,f.value=w.maxValue):void 0!==h&&(f.value=h,h=void 0))}))):void 0!==w.rightButton.icon&&(u=new e.createElement("img",{class:"DMUBaseSideButton",src:w.rightButton.iconPath}).inject(r)),m+=n.getTouchMode()?36:24),w.subMenuItems){let t,i;y=new e.createElement("div",{class:"wux-ui-3ds wux-ui-3ds-lg wux-ui-3ds-menu-dot",title:s.compareMenuIcon}).inject(r),y.addClassName("DMUBaseViewMenuIcon"),n.getTouchMode()&&y.setStyles({"font-size":"24px"}),y.addEventListener("click",(function(){y&&b&&(y.hasClassName("DMUBaseViewMenuIconOnClick")?(y.removeClassName("DMUBaseViewMenuIconOnClick"),b.setStyle("display","none")):(y.addClassName("DMUBaseViewMenuIconOnClick"),b.setStyle("display","")))})),m+=n.getTouchMode()?34:24,b=e.createElement("div",{class:"DMUBaseViewMenuContainer",styles:{display:"none"}}).inject(r),w.subMenuItems.forEach((function(e){"combo"===e.type?(i=new a({elementsList:e.elementList,enableSearchFlag:e.enableSearchFlag,value:e.value}),i.addEventListener("change",(function(){e.callBack&&e.callBack(i.value)})),i.inject(b)):(t=new o({type:e.type,label:e.label,checkFlag:e.checkFlag}),t.addEventListener("buttonclick",(function(){e.callBack&&e.callBack(t.checkFlag)})),t.inject(b))})),w.subMenuItems.length>=1&&b.setStyles({height:10+w.subMenuItems.length*(n.getTouchMode()?38:24)+"px"}),d=function(){y.hasClassName("DMUBaseViewMenuIconOnClick")&&(y.removeClassName("DMUBaseViewMenuIconOnClick"),b.setStyle("display","none"))},g&&l.addEvent(g,"onPrimaryPointerClick",d)}if(w.lastButton){let t=new e.createElement("div",{class:w.lastButton.iconClassName,title:w.lastButton.title}).inject(r);t.addClassName("DMUBaseViewMenuIcon"),n.getTouchMode()&&t.setStyles({"font-size":"24px"}),t.addEventListener("click",(function(){w.lastButton.callBack(!0)})),m+=n.getTouchMode()?34:24}p.onFreeZoneResize||(t.getImmersiveFrame().addEventListener("freeZoneResize",C),p.onFreeZoneResize=1),setTimeout((function(){r&&C()}),50)},this.update=function(e){e.value&&f&&(f.value=e.value),u&&(e.rightButton.color&&(u.style.background=e.rightButton.color),e.rightButton.title&&(u.title=e.rightButton.title)),c&&(e.leftButton.color&&(c.style.background=e.leftButton.color),e.leftButton.title&&(c.title=e.leftButton.title))},this.clean=function(){t&&r&&r.parentNode===t.getUIFrame()&&t.getUIFrame().removeChild(r),p.onFreeZoneResize&&t&&t.getImmersiveFrame().removeEventListener("freeZoneResize",C),g&&d&&l.removeEvent(g,"onPrimaryPointerClick",d),f=g=null,d=null,r=null,h=void 0,m=0}}})})),define("DS/DMUControls/EXPWindow",["UWA/Controls/Abstract","UWA/Controls/Drag","i18n!DS/DMUControls/assets/nls/DMUControls","WebappsUtils/WebappsUtils"],(function(e,t,n,i){"use strict";return e.extend({defaultOptions:{body:null,height:"320",width:"320",title:"Window Title",position:{top:"50",left:"50"},fTopbarHeight:30,fManipulatorSize:10,fMarginAroundViewer:10,fResizeMinHeight:320,fResizeMinWidth:320,fCornerRoundRadius:4,bTopBarButtons:!0,bFullScreenOnDbclickTopbar:!0,bScaleManipulator:!0,bMoveManipulator:!0,bBoxShadow:!0,bBoldTitle:!1},init:function(e){this._domElements={_mainContainer:null,_topbarContainer:null,_topbarTitle:null,_topbarButtonContainer:null,_topbarTitleText:null,_Containerviewer:null,_viewer:null,_sizeControlLeft:null,_sizeControlRight:null,_sizeControlBottom:null,_sizeControlBottomLeft:null,_sizeControlBottomRight:null};var t=UWA.extend(this.defaultOptions,e);this._fullscreenObject={_bFullscreenIsEnable:!1,mainContainerPreFullscreenPosition:null,mainContainerPreFullscreenSize:null},this._dragEventParameters={mainContainerOriginalPosition:null,mainContainerOriginalSize:null},this._parent(t),this._createWindow()},setHTMLContent:function(e){e&&e.inject&&(e.inject(this._domElements._viewer),e.style.width="100%",e.style.height="100%")},setVisibility:function(e){var t=e?"block":"none";this._domElements._mainContainer.setStyle("display",t)},show:function(){this._domElements._mainContainer.setStyle("display","block")},noShow:function(){this._domElements._mainContainer.setStyle("display","none")},clear:function(){this._domElements._mainContainer.destroy()},isShow:function(){return!("none"===this._domElements._mainContainer.getStyle("display"))},setFullScreen:function(e,t){e?(this._fullscreenObject.mainContainerPreFullscreenPosition=this._domElements._mainContainer.getPosition(),this._fullscreenObject.mainContainerPreFullscreenSize=this._domElements._mainContainer.getSize(),this._domElements._mainContainer.setStyle("width",this.options.body.parentElement.getSize().width+"px"),this._domElements._mainContainer.setStyle("height",this.options.body.parentElement.getSize().height+"px"),this._domElements._mainContainer.setPosition({x:0,y:0}),this.options.bTopBarButtons&&(this._domElements._topBarMinimizeButton.setStyle("display","inline-block"),this._domElements._topBarMaximizeButton.setStyle("display","none")),this._fullscreenObject._bFullscreenIsEnable=!0):(this.options.bTopBarButtons&&(this._domElements._topBarMinimizeButton.setStyle("display","none"),this._domElements._topBarMaximizeButton.setStyle("display","inline-block")),t||(this._domElements._mainContainer.setStyle("width",this._fullscreenObject.mainContainerPreFullscreenSize.width+"px"),this._domElements._mainContainer.setStyle("height",this._fullscreenObject.mainContainerPreFullscreenSize.height+"px"),this._domElements._mainContainer.setPosition(this._fullscreenObject.mainContainerPreFullscreenPosition)),this._fullscreenObject._bFullscreenIsEnable=!1),this._updateSize()},isFullScreen:function(){return this._fullscreenObject._bFullscreenIsEnable},_createWindow:function(){this._createMainContainer(),this._createTopbarContainer(),this._createTopbarTitle(),this.options.bTopBarButtons&&this._createTopbarButtonContainer(),this._createViewerContainer(),this._createViewer(),this.options.bScaleManipulator&&this._createSizeControl(),this.setHTMLContent(this.options.HTMLContent)},_createUWADiv:function(e){return UWA.createElement("div",{styles:e})},_createUWATopButton:function(e,t,n){var i='<span title="'+t+'"><img src='+e+" ></span>";return UWA.createElement("button",{html:i,styles:{padding:"0",border:"0",backgroundColor:"#F0F0F0",display:"inline-block",verticalAlign:"middle",marginLeft:"5px",outlineStyle:"none"},events:{click:function(){n()}}})},_createMainContainer:function(){this._domElements._mainContainer=this._createUWADiv({position:"absolute",height:this.options.height,borderRadius:this.options.fCornerRoundRadius+"px",width:this.options.width,backgroundColor:"#F0F0F0",boxShadow:this.options.bBoxShadow?"0 1px 1px 0px rgba(26,25,25,0.24)":"none",top:this.options.position.top+"px",left:this.options.position.left+"px",overflow:"visible",border:"1px solid #D1D1D1"}),this._domElements._mainContainer.inject(this.options.body)},_createTopbarContainer:function(){this._domElements._topbarContainer=this._createUWADiv({position:"relative",height:this.options.fTopbarHeight+"px",width:"100%",cursor:"default",overflow:"hidden"}),this._domElements._topbarContainer.inject(this._domElements._mainContainer);var e=this;if(this.options.bFullScreenOnDbclickTopbar&&this._domElements._topbarContainer.addEvent("dblclick",(function(){e.setFullScreen(!e.isFullScreen())})),this.options.bMoveManipulator){var n=new t({element:this._domElements._topbarContainer});n.move=function(){if(e.isFullScreen()){var t=e._domElements._mainContainer.getSize(),n=e._domElements._mainContainer.getPosition(),i=100*this.currentEvent.clientX/t.width*e._fullscreenObject.mainContainerPreFullscreenSize.width/100,o=this.currentEvent.clientX-i,a=n.y+this.currentDelta.y;e._domElements._mainContainer.setPosition({x:o,y:a}),e._startDrag(this,e),e.setFullScreen(!1)}var l=e._manipulatorComputeChecker(this,"drag");e._domElements._mainContainer.setPosition({x:l.position.x,y:l.position.y})},n.start=function(){e._startDrag(this,e)}}},_createTopbarTitle:function(){this._domElements._topbarTitle=this._createUWADiv({position:"absolute",height:"100%",lineHeight:this.options.fTopbarHeight+"px",width:"auto",overflow:"hidden"}),this._domElements._topbarTitle.className="topbarTitleEXPWin",this._domElements._topbarTitle.inject(this._domElements._topbarContainer),this._domElements._topbarTitleText=this._createUWADiv({display:"inline-block",verticalAlign:"middle",lineHeight:"normal",overflow:"hidden",marginLeft:this.options.fMarginAroundViewer+"px",fontFamily:"Open Sans,Segoe UI,Helvetica,Arial,sans-serif",whiteSpace:"nowrap",textOverflow:"ellipsis",fontSize:"13px",fontWeight:this.options.bBoldTitle?"bold":"normal"}),this._domElements._topbarTitleText.inject(this._domElements._topbarTitle),this._domElements._topbarTitleText.setText(this.options.title)},_createTopbarButtonContainer:function(){var e=this;this._domElements._topbarButtonContainer=this._createUWADiv({position:"absolute",height:"100%",width:100,right:0,textAlign:"right",lineHeight:this.options.fTopbarHeight+"px",marginRight:this.options.fMarginAroundViewer+"px",overflow:"hidden"}),this._domElements._topbarButtonContainer.inject(this._domElements._topbarContainer);var t=i.getWebappsBaseUrl()+"DMUControls/assets/icons/maximize.png",o=n.maximize,a=function(){e.setFullScreen(!0)};this._domElements._topBarMaximizeButton=this._createUWATopButton(t,o,a),this._domElements._topBarMaximizeButton.inject(this._domElements._topbarButtonContainer),t=i.getWebappsBaseUrl()+"DMUControls/assets/icons/minimize.png",o=n.minimize,a=function(){e.setFullScreen(!1)},this._domElements._topBarMinimizeButton=this._createUWATopButton(t,o,a),this._domElements._topBarMinimizeButton.setStyle("display","none"),this._domElements._topBarMinimizeButton.inject(this._domElements._topbarButtonContainer),t=i.getWebappsBaseUrl()+"DMUControls/assets/icons/cancel.png",o=n.close,a=function(){e.setVisibility(!1)},this._createUWATopButton(t,o,a).inject(this._domElements._topbarButtonContainer)},_createViewerContainer:function(){this._domElements._viewerContainer=this._createUWADiv({position:"relative",height:this._domElements._mainContainer.offsetHeight-this.options.fTopbarHeight,width:"100%",overflow:"hidden",paddingRight:this.options.fMarginAroundViewer+"px",paddingLeft:this.options.fMarginAroundViewer+"px",paddingBottom:this.options.fMarginAroundViewer+"px"}),this._domElements._viewerContainer.inject(this._domElements._mainContainer)},_createViewer:function(){this._domElements._viewer=this._createUWADiv({position:"relative",height:"100%",width:"100%",overflow:"hidden"}),this._domElements._viewer.inject(this._domElements._viewerContainer)},_manipulatorComputeChecker:function(e,t){var n={size:{width:null,height:null},position:{x:null,y:null}};if("left"===t){let t=this._dragEventParameters.mainContainerOriginalSize.width-e.currentDelta.x;if(t<this.options.fResizeMinWidth){var i=this._domElements._mainContainer.getPosition().x+this._domElements._mainContainer.getSize().width;n.size.width=this.options.fResizeMinWidth,n.position.x=i-this.options.fResizeMinWidth}else n.size.width=t,n.position.x=this._dragEventParameters.mainContainerOriginalPosition.x+e.currentDelta.x}if("right"===t){let t=this._dragEventParameters.mainContainerOriginalSize.width+e.currentDelta.x;t<this.options.fResizeMinWidth?n.size.width=this.options.fResizeMinWidth:n.size.width=t}if("bottom"===t){var o=this._dragEventParameters.mainContainerOriginalSize.height+e.currentDelta.y;o<this.options.fResizeMinHeight?n.size.height=this.options.fResizeMinHeight:n.size.height=o}if(n.position.x<0){var a=this._dragEventParameters.mainContainerOriginalPosition.x+this._dragEventParameters.mainContainerOriginalSize.width;n.position.x=0,n.size.width=a}return this._domElements._mainContainer.getPosition().x+n.size.width>this.options.body.parentElement.getSize().width&&(n.size.width=this.options.body.parentElement.getSize().width-this._domElements._mainContainer.getPosition().x),this._domElements._mainContainer.getPosition().y+n.size.height>this.options.body.parentElement.getSize().height&&(n.size.height=this.options.body.parentElement.getSize().height-this._domElements._mainContainer.getPosition().y),"drag"===t&&(n.position.x=this._dragEventParameters.mainContainerOriginalPosition.x+e.currentDelta.x,n.position.y=this._dragEventParameters.mainContainerOriginalPosition.y+e.currentDelta.y,n.position.x+this._domElements._mainContainer.getSize().width>this.options.body.parentElement.getSize().width&&(n.position.x=this.options.body.parentElement.getSize().width-this._domElements._mainContainer.getSize().width),n.position.y+this._domElements._mainContainer.getSize().height>this.options.body.parentElement.getSize().height&&(n.position.y=this.options.body.parentElement.getSize().height-this._domElements._mainContainer.getSize().height),n.position.x<0&&(n.position.x=0),n.position.y<0&&(n.position.y=0)),n},_createSizeControl:function(){var e=this;this._domElements._sizeControlLeft=this._createUWADiv({position:"absolute",bottom:0,height:"100%",width:this.options.fManipulatorSize+"px",cursor:"ew-resize",overflow:"hidden"}),this._domElements._sizeControlLeft.inject(this._domElements._mainContainer);var n=new t({element:this._domElements._sizeControlLeft});n.start=function(){e._startDrag(this,e)},n.move=function(){var t=e._manipulatorComputeChecker(this,"left");e._domElements._mainContainer.setStyle("width",t.size.width+"px"),e._domElements._mainContainer.setPosition({x:t.position.x,y:e._dragEventParameters.mainContainerOriginalPosition.y}),e.isFullScreen()&&e.setFullScreen(!1,!0)},this._domElements._sizeControlRight=this._createUWADiv({position:"absolute",bottom:0,right:0,height:"100%",width:this.options.fManipulatorSize+"px",cursor:"ew-resize",overflow:"hidden"}),this._domElements._sizeControlRight.inject(this._domElements._mainContainer);var i=new t({element:this._domElements._sizeControlRight});i.start=function(){e._startDrag(this,e)},i.move=function(){var t=e._manipulatorComputeChecker(this,"right");e._domElements._mainContainer.setStyle("width",t.size.width+"px"),e.isFullScreen()&&e.setFullScreen(!1,!0)},this._domElements._sizeControlBottom=this._createUWADiv({position:"absolute",left:0,bottom:0,height:this.options.fManipulatorSize+"px",width:"100%",cursor:"ns-resize",overflow:"hidden"}),this._domElements._sizeControlBottom.inject(this._domElements._mainContainer);var o=new t({element:this._domElements._sizeControlBottom});o.start=function(){e._startDrag(this,e)},o.move=function(){var t=e._manipulatorComputeChecker(this,"bottom");e._domElements._mainContainer.setStyle("height",t.size.height+"px"),e.isFullScreen()&&e.setFullScreen(!1,!0),e._updateSize()},this._domElements._sizeControlBottomLeft=this._createUWADiv({position:"absolute",left:0,bottom:0,width:this.options.fManipulatorSize+"px",height:this.options.fManipulatorSize+"px",cursor:"nesw-resize",overflow:"hidden"}),this._domElements._sizeControlBottomLeft.inject(this._domElements._mainContainer);var a=new t({element:this._domElements._sizeControlBottomLeft});a.start=function(){e._startDrag(this,e)},a.move=function(){var t=e._manipulatorComputeChecker(this,"left");e._domElements._mainContainer.setStyle("width",t.size.width+"px"),e._domElements._mainContainer.setPosition({x:t.position.x,y:e._dragEventParameters.mainContainerOriginalPosition.y}),t=e._manipulatorComputeChecker(this,"bottom"),e._domElements._mainContainer.setStyle("height",t.size.height+"px"),e.isFullScreen()&&e.setFullScreen(!1,!0),e._updateSize()},this._domElements._sizeControlBottomRight=this._createUWADiv({position:"absolute",right:0,bottom:0,width:this.options.fManipulatorSize+"px",height:this.options.fManipulatorSize+"px",cursor:"nwse-resize",overflow:"hidden"}),this._domElements._sizeControlBottomRight.inject(this._domElements._mainContainer);var l=new t({element:this._domElements._sizeControlBottomRight});l.start=function(){e._startDrag(this,e)},l.move=function(){var t=e._manipulatorComputeChecker(this,"right");e._domElements._mainContainer.setStyle("width",t.size.width+"px"),t=e._manipulatorComputeChecker(this,"bottom"),e._domElements._mainContainer.setStyle("height",t.size.height+"px"),e.isFullScreen()&&e.setFullScreen(!1,!0),e._updateSize()}},_updateSize:function(){this._domElements._viewerContainer.setStyle("height",this._domElements._mainContainer.offsetHeight-this.options.fTopbarHeight+"px")},_startDrag:function(e,t){t._dragEventParameters.mainContainerOriginalPosition=t._domElements._mainContainer.getPosition(),t._dragEventParameters.mainContainerOriginalSize=t._domElements._mainContainer.getSize()}})})),define("DS/DMUControls/panels/DMUCustomColorPanel",["UWA/Core","UWA/Class","DS/Visualization/ThreeJS_DS","DS/Controls/ColorChooser","DS/Controls/Button","DS/WebappsUtils/WebappsUtils","DS/VisuEvents/EventsManager","DS/CoreEvents/ModelEvents","i18n!DS/DMUControls/assets/nls/DMUControls","css!DS/DMUControls/DMUControls.css"],(function(e,t,n,i,o,a,l,s,r){"use strict";return t.extend({init:function(t){let d,c,u=t||{};this._parent(u);let h,m=new s,p=[],g=[];function f(e,t){return m.publish({event:e,data:t,context:this})}function C(e){if(e){let t=e.from[0].view.style.background;h=new n.Color(t.split(" ").join("")).getHexString()}h&&g.forEach((e=>{e.div.setStyles({outline:e.color===h?"4px #42a2da solid":""})}))}function v(){for(;c.firstChild;)c.removeChild(c.firstChild);var t,n;p.forEach((e=>{l.removeEventFromToken(e)})),p.length=0;var i=new e.Element("div",{class:"DMUCustomColorContainer"}).inject(c);if(u.touchMode&&i.setAttributeNode(document.createAttribute("touch-mode")),g.length>0)for(t=0;t<5;t++)g[t]&&(n=new e.Element("div",{class:"DMUCustomColorSquare"}).inject(i),u.touchMode&&n.setAttributeNode(document.createAttribute("touch-mode")),n.style.background="#"+g[t].color,p.push(l.addEvent(n,"onPrimaryPointerClick",C)),g[t].div=n);if(g.length>5)for(i=new e.Element("div",{class:"DMUCustomColorContainer"}).inject(c),u.touchMode&&i.setAttributeNode(document.createAttribute("touch-mode")),t=5;t<10;t++)g[t]&&(n=new e.Element("div",{class:"DMUCustomColorSquare"}).inject(i),u.touchMode&&n.setAttributeNode(document.createAttribute("touch-mode")),n.style.background="#"+g[t].color,p.push(l.addEvent(n,"onPrimaryPointerClick",C)),g[t].div=n);C()}this.build=function(t){d=new e.Element("div",{class:"DMU3DCustomMainDiv"}),c=new e.Element("div",{class:"DMUCustomColorPalette"}).inject(d),u.touchMode&&c.setAttributeNode(document.createAttribute("touch-mode")),t.forEach((e=>{g.push({color:e})})),v();var n=new i({value:"ffffff"});n.getContent().setStyles({width:u.touchMode?"400px":"360px"});var l=new e.Element("div",{class:"DMUCustomPanelBtnDiv"}).inject(d);u.touchMode&&l.setAttributeNode(document.createAttribute("touch-mode"));var s=new o({icon:a.getWebappsAssetUrl("DMUBaseUI","images/")+"I_DMRAddColor.png"}).inject(l);u.touchMode&&s.getContent().setStyles({width:"40px","min-width":"40px"});var m=new o({icon:a.getWebappsAssetUrl("DMUBaseUI","images/")+"I_DMRRemoveColor.png",disabled:0===g.length}).inject(l);u.touchMode&&m.getContent().setStyles({width:"40px","min-width":"40px"});var p=new o({icon:a.getWebappsAssetUrl("DMUBaseUI","images/")+"I_DMRUpdateColor.png",disabled:0===g.length}).inject(l);u.touchMode&&p.getContent().setStyles({width:"40px","min-width":"40px"}),s.getContent().addClassName("DMUCustomSwitchColorButton"),s.addEventListener("click",(function(){if(0===g.length&&(m.disabled=!1,p.disabled=!1),g.length<10){for(let e=0;e<g.length;e++)if(n.value===g[e].color)return;g.push({color:n.value}),null!==h&&(n.referenceValue=h),h=n.value,v(),10===g.length&&(s.disabled=!0)}})),m.getContent().addClassName("DMUCustomSwitchColorButton"),m.addEventListener("click",(function(){if(1===g.length?(m.disabled=!0,p.disabled=!0):10===g.length&&(s.disabled=!1),g.length>0&&h)for(let e=0;e<g.length;e++)if(h===g[e].color)return g.splice(e,1),h=g.length&&g[e]?g[e].color:g[e-1]?g[e-1].color:null,void v()})),p.getContent().addClassName("DMUCustomSwitchColorButton"),p.addEventListener("click",(function(){if(g.length>0&&h){for(let e=0;e<g.length;e++)if(n.value===g[e].color)return;for(let e=0;e<g.length;e++)if(h===g[e].color)return n.referenceValue=h,g[e].color=n.value,h=n.value,void v()}})),n.inject(d);var C=new e.Element("div",{class:"DMUCustomPanelBottomBtnDiv"}).inject(d),w=new o({label:r.grpPanelLabel.ok}).inject(C);w.getContent().addClassName("DMUCustomColorButton"),w.getContent().addEventListener("buttonclick",(function(){f("onCustomColorPanelOk",{customColors:g.map((e=>e.color)),selectedColor:h})}));var b=new o({label:r.grpPanelLabel.cancel}).inject(C);return b.getContent().addClassName("DMUCustomColorButton"),b.getContent().addEventListener("buttonclick",(function(){f("onCustomColorPanelCancel")})),d},this.setCurrentCustomColor=function(e){g.length>0&&g.forEach((t=>{new n.Color("#"+t.color).equals(e)&&(t.div.setStyles({outline:"4px #42a2da solid"}),h=t.color)}))},this.clean=function(){p.forEach((e=>{l.removeEventFromToken(e)})),p.length=0,d=null},this.subscribe=function(e,t){if(e&&t)return m.subscribe({event:e},t)},this.unsubscribe=function(e){null!=e&&m.unsubscribe(e)}}})})),define("DS/DMUControls/DMUPasteWithOptionsPanel",["UWA/Core","UWA/Class","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/Toggle","i18n!DS/DMUControls/assets/nls/DMUControls"],(function(e,t,n,i,o,a){"use strict";return t.extend({init:function(t){var l=t||{};if(this._parent(l),l.frmWindow){var s,r,d=e.createElement("div",{class:"DMUPasteSpecialPanelMainDiv"});if(l.prefs&&l.prefs.overloadPasteSpecial){var c=new o({label:a.PasteSpecialPanel.graphicOverloads,value:"DMUPasteSpecial_OccGraphicProps",type:"checkbox",checkFlag:"false"!==localStorage.getItem("DMUPasteSpecial_OccGraphicProps")}).inject(d),u=new o({label:a.PasteSpecialPanel.positionOverloads,value:"DMUPasteSpecial_OccPositions",type:"checkbox",checkFlag:"false"!==localStorage.getItem("DMUPasteSpecial_OccPositions")}).inject(d);r=function(e){var t={},n=c.checkFlag;localStorage.setItem("DMUPasteSpecial_OccGraphicProps",n?"true":"false"),t.graphicProps=n,n=u.checkFlag,localStorage.setItem("DMUPasteSpecial_OccPositions",n?"true":"false"),t.positions=n,l&&l.cb&&l.cb(t,e),s.close?s.close():s.destroy()}}else{var h;l.prefs&&l.prefs.displayCameraPref&&(h=new o({label:a.PasteSpecialPanel.cameraLabel,value:"DMUPasteSpecial_Camera",type:"checkbox",checkFlag:"false"!==localStorage.getItem("DMUPasteSpecial_Camera")}).inject(d));var m,p,g,f=new o({label:a.PasteSpecialPanel.formattingLabel,value:"DMUPasteSpecial_3DFormatting",type:"checkbox",checkFlag:"false"!==localStorage.getItem("DMUPasteSpecial_3DFormatting")}).inject(d),C=new o({label:a.PasteSpecialPanel.markers3DLabel,value:"DMUPasteSpecial_3DMarkers",type:"checkbox",checkFlag:"false"!==localStorage.getItem("DMUPasteSpecial_3DMarkers")}).inject(d),v=new o({label:a.PasteSpecialPanel.markers2DLabel,value:"DMUPasteSpecial_2DMarkers",type:"checkbox",checkFlag:"false"!==localStorage.getItem("DMUPasteSpecial_2DMarkers")}).inject(d);l.prefs&&l.prefs.displayAssociateFormatPref&&(m=new o({label:a.PasteSpecialPanel.formatLabel,value:"DMUPasteSpecial_Format",type:"checkbox",checkFlag:"false"!==localStorage.getItem("DMUPasteSpecial_Format")}).inject(d)),l.prefs&&l.prefs.displayAssociateFormatToSlidePref&&(p=new o({label:a.PasteSpecialPanel.associateFormatLabel,value:"DMUPasteSpecial_AssociateFormat",type:"switch",checkFlag:"false"!==localStorage.getItem("DMUPasteSpecial_AssociateFormat")}).inject(d)).elements.container.setStyles({"text-align":"right","margin-top":"10px"}),l.prefs&&l.prefs.displayCreateNewSlidePref&&(g=new o({label:a.PasteSpecialPanel.createNewSlideLabel,value:"DMUPasteSpecial_CreateNewSlide",type:"switch",checkFlag:"false"!==localStorage.getItem("DMUPasteSpecial_CreateNewSlide")}).inject(d)).elements.container.setStyles({"text-align":"right","margin-top":"10px"}),r=function(e){var t,n={};h&&(t=h.checkFlag,localStorage.setItem("DMUPasteSpecial_Camera",t?"true":"false"),n.camera=t),t=f.checkFlag,localStorage.setItem("DMUPasteSpecial_3DFormatting",t?"true":"false"),n.formatting=t,t=C.checkFlag,localStorage.setItem("DMUPasteSpecial_3DMarkers",t?"true":"false"),n.markers3D=t,t=v.checkFlag,localStorage.setItem("DMUPasteSpecial_2DMarkers",t?"true":"false"),n.markers2D=t,m&&(t=m.checkFlag,localStorage.setItem("DMUPasteSpecial_Format",t?"true":"false"),n.format=t),p&&(t=p.checkFlag,localStorage.setItem("DMUPasteSpecial_AssociateFormat",t?"true":"false"),n.associateFormat=t),g&&(t=g.checkFlag,localStorage.setItem("DMUPasteSpecial_CreateNewSlide",t?"true":"false"),n.createNewSlide=t),l&&l.cb&&l.cb(n,e),s.close?s.close():s.destroy()}}var w={};w.Ok=new i({emphasize:"primary",onClick:function(){r(!1)}}),w.Abort=new i({label:a.warningPanel.cancelLabel,onClick:function(){s.close?s.close():s.destroy()}}),l.prefs&&l.prefs.applyButtonNls&&(w.Apply=new i({label:l.prefs.applyButtonNls,onClick:function(){r(!0)}})),s=new n({modalFlag:!0,ensureHeightDefinitionOnHierarchy:!0,title:t.panelTitle?t.panelTitle:a.PasteSpecialPanel.pasteSpecialPanelTitle,content:d,immersiveFrame:l.frmWindow.getImmersiveFrame(),buttons:w})}}})})),define("DS/DMUControls/DMUWarningPanel",["UWA/Core","UWA/Class","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/Toggle","i18n!DS/DMUControls/assets/nls/DMUControls","css!DS/DMUControls/DMUControls.css"],(function(e,t,n,i,o,a){"use strict";return t.extend({init:function(t){if(this._parent(t),t&&t.frmWindow&&t.message){var l,s,r=e.createElement("div",{class:"DMUWarningPanelMainDiv"});e.createElement("span",{class:"DMUWarningPanelIcon fonticon fonticon-attention fonticon-3x"}).inject(r),e.createElement("p",{class:"DMUWarningPanelLabel"}).inject(r).innerHTML=t.message,t.checkboxMessage&&(l=new o({type:"checkbox",label:t.checkboxMessage,value:0,checkFlag:t.checked})).inject(r);var d={Ok:new i({emphasize:"primary",label:t.okLabel?t.okLabel:a.warningPanel.okLabel,onClick:function(){t.callbacks&&t.callbacks.onValidateCB&&t.callbacks.onValidateCB(l?l.checkFlag:null),s.close()}})};t.callbacks&&t.callbacks.onCancelCB&&(d.Cancel=new i({label:t.cancelLabel?t.cancelLabel:a.warningPanel.cancelLabel,onClick:function(){t.callbacks.onCancelCB(),s.close()}})),(s=new n({modalFlag:!0,ensureHeightDefinitionOnHierarchy:!0,title:t.title?t.title:a.warningPanel.defaultTitle,content:r,immersiveFrame:"getImmersiveFrame"in t.frmWindow?t.frmWindow.getImmersiveFrame():null,buttons:d})).addEventListener("close",(function(){t.callbacks&&t.callbacks.onCloseCB&&t.callbacks.onCloseCB(),s=null})),this.destroy=function(){s&&s.close()}}}})})),define("DS/DMUControls/DMUInfoModalDiv",["require","exports","DS/UIKIT/Spinner","UWA/Core","DS/Controls/ModalContainer","DS/Controls/ProgressBar"],(function(e,t,n,i,o,a){"use strict";return class{constructor(){let e,t,l,s,r;function d(){let e=0;if(!s)return;let n=s.getImmersiveFrame().getDockingElement(WUXDockAreaEnum.RightDockArea);(n.getContainedVisibleWindows().length>0||n.interactiveDockAreaVisibleFlag)&&(e=n._collapserSize,n.collapseDockingZoneFlag||(e+=n.dockingZoneSize)),e+=20,t&&t.setStyles({right:e+"px"})}this.display=function(c){var u;if(!c||!c.frmWindow||!c.type)return;if(t)return;let h;if(s=c.frmWindow,t=i.createElement("div",{class:"DMUInfoDiv"}),t.dsModel=this,"load"===c.type){if(h=i.createElement("div",{class:"DMULoadingDivProgressBar"}).inject(t),e=new n({visible:!0}).inject(h),c.message){i.createElement("p",{class:"DMULoadingDivLabel"}).inject(t).setText(c.message)}}else if("message"===c.type){i.createElement("p",{class:"DMUMessageDivLabel"}).inject(t).setText(c.message)}else if("save"===c.type)h=i.createElement("div",{class:"DMULoadingDivProgressBar"}).inject(t),e=new a({infiniteFlag:!0,displayStyle:"lite",shape:"circular",height:25,emphasize:"info"}).inject(h),t.setStyles({top:"20px"});else if("error"===c.type)h=i.createElement("div",{class:"DMULoadingDivProgressBar"}).inject(t),e=new a({infiniteFlag:!0,displayStyle:"lite",shape:"circular",height:25,emphasize:"high-attention"}).inject(h),t.setStyles({top:"20px"});else if("button"===c.type){let e;h=i.createElement("button",{class:"DMULoadingDivProgressBarButton"}).inject(t),c.label&&(e=i.createElement("div",{text:c.label}).inject(t),e.addClassName("DMULoadingDivProgressBarLabel")),c.onClick&&h.addEvent("click",c.onClick),h.addEvent("mouseenter",(function(){null==h||h.addClassName("highlighted"),e&&e.addClassName("shown")})),h.addEvent("mouseleave",(function(){null==h||h.removeClassName("highlighted"),e&&e.removeClassName("shown")}))}c.modal?(h&&h.setStyles({position:"absolute",top:"calc(50 % - 13px)",left:"50px"}),l&&(o.removeModal(l),l.destroy()),t.addClassName("DMUModalBackgroundDiv"),l=i.createElement("div",{styles:{position:"fixed",inset:"0px",zIndex:"50000",pointerEvents:"none"}}).inject(s.getUIFrame()),o.createModal(l,t),null===(u=l.firstChild)||void 0===u||u.setStyle("pointerEvents","none"),t.setStyles({top:"calc(50% - "+t.offsetHeight/2+"px)",left:"calc(50% - "+t.offsetWidth/2+"px)"})):(s.getImmersiveFrame().addEventListener("freeZoneResize",d),r=1,t.inject(s.getUIFrame()),d()),c.styles&&t.setStyles(c.styles)},this.updateMessage=function(e){let n=null==t?void 0:t.lastChild;n&&n.setText(e)},this.getContent=function(){return t},this.destroy=function(){s&&r&&s.getImmersiveFrame().removeEventListener("freeZoneResize",d),e&&e.destroy(),l?(o.removeModal(l),l.destroy()):s&&t&&t.destroy(),l=t=e=null}}}})),define("DS/DMUControls/EXPSnapshotControl",["UWA/Core","UWA/Class","DS/Windows/Dialog","DS/Controls/Button","DS/UIKIT/Spinner","i18n!DS/DMUControls/assets/nls/DMUControls","css!DS/DMUControls/DMUControls.css"],(function(e,t,n,i,o,a){"use strict";return void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(e){var t=navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return t?new Promise((function(n,i){t.call(navigator,e,n,i)})):Promise.reject(new Error("getUserMedia is not implemented"))}),t.extend({init:function(t){var l;this._parent(t);var s=e.createElement("div",{class:"EXPSnapshotControl"}),r=e.createElement("div",{class:"EXPSnapshotControlSpinnerDiv"}).inject(s),d=e.createElement("video",{class:"EXPSnapshotVideo"}).inject(s),c=e.createElement("div",{class:"EXPSnapshotControlSnapDiv",styles:{opacity:0}}).inject(s),u=new o({visible:!0}).inject(r),h=new Image,m=e.createElement("canvas"),p=[],g=300;function f(){for(var e=0;e<p.length;e++)for(var t=p[e].getTracks(),n=0;n<t.length;n++)t[n].stop();p.length=0,u&&u.destroy(),l&&l.destroy(),l=u=s=d=null}var C=new i({emphasize:"primary",label:a.snapshotValidate,onClick:function(){var e=h.width,n=h.height;e>g&&(n=g*n/e,e=g),n>g&&(e=g*e/n,n=g),t.onValidateSnapshotCB({img:h,width:e,height:n}),f()}}),v=new i({label:a.snapshotReset,onClick:function(){d.play(),c.removeClassName("EXPSnapshotAnimation"),C.elements.button.setStyles({display:"none"}),v.elements.button.setStyles({display:"none"}),w.elements.button.setStyles({display:""})}}),w=new i({label:a.captureSnapshot,onClick:function(){c.setStyles({width:d.videoWidth,height:d.videoHeight}),c.addClassName("EXPSnapshotAnimation"),d.pause(),m.width=d.videoWidth,m.height=d.videoHeight,m.getContext("2d").drawImage(d,0,0,d.videoWidth,d.videoHeight),h.src=m.toDataURL("image/png"),h.width=d.videoWidth,h.height=d.videoHeight,C.elements.button.setStyles({display:""}),v.elements.button.setStyles({display:""}),w.elements.button.setStyles({display:"none"})}});(l=new n({modalFlag:!0,ensureHeightDefinitionOnHierarchy:!0,title:a.snapshotTitle,content:s,immersiveFrame:t.immersiveFrame,buttons:{Abort:w,Ok:C,Apply:v}})).addEventListener("close",(function(){f(),t.onCloseSnapshotCB&&t.onCloseSnapshotCB()})),w.disabled=!0,w.elements.button.setStyles({display:""}),C.elements.button.setStyles({display:"none"}),v.elements.button.setStyles({display:"none"});var b=navigator.mediaDevices.getUserMedia({video:{width:{min:50,max:640},height:{min:50,max:360}}});b.then((function(e){if(!e)return t.onErrorCB&&t.onErrorCB(),f();"srcObject"in d?d.srcObject=e:d.src=window.URL.createObjectURL(e),p.push(e),d.onloadedmetadata=function(){w.disabled=!1,s.removeChild(r),d.play()}})),b.catch((function(){t.onErrorCB&&t.onErrorCB(),f()}))}})})),define("DS/DMUControls/panels/DMU3DComparePanel",["UWA/Core","UWA/Class","DS/CATWebUXComponents/CATWebUXPanel","DS/Controls/Button","i18n!DS/DMUControls/assets/nls/DMUControls","css!DS/DMUControls/DMUControls.css"],(function(e,t,n,i,o){"use strict";return t.extend({init:function(t){var a,l,s,r,d;this._parent(t);var c=null,u=!0;this.buildPanel=function(t){this.clean(),c=t.displayType,a||(a=e.createElement("div",{id:"DMU3DCompareMainDiv"}));var m=e.createElement("div",{id:"panelcontent",class:"DMU3DCompareContainerDiv"}).inject(a),p=e.createElement("div",{id:"comparecontent",class:"DMU3DCompareCompareContentDiv"}).inject(m);if((s=h({leftLabel:o.dmuCompareNewLabel,color:t.newStyleColor,rightLabel:t.newStyleLabel||o.dmuCompareLoadingLabel})).inject(p),(r=h({leftLabel:o.dmuCompareOldLabel,color:t.oldStyleColor,rightLabel:t.oldStyleLabel||o.dmuCompareLoadingLabel})).inject(p),(d=h({leftLabel:o.dmuCompareCommonLabel,color:t.commonStyleColor,rightLabel:t.commonStyleLabel||null})).inject(p),"reduce"!==c){var g=e.createElement("div",{class:"DMU3DCompareButtonDiv"}).inject(m);new i({label:o.dmuCompareButtonLabel,emphasize:"secondary",onClick:function(){t.onClickCB&&t.onClickCB()}}).inject(g)}var f={id:"DMU3DComparePanel",className:"DMU3DComparePanel",title:t.title||o.dmuCompareTitle,icon:t.icon,immersiveFrame:t.immersiveFrame,content:a,closeButtonFlag:!1,minWidth:250,width:250,allowedDockAreas:WUXDockAreaEnum.RightDockArea|WUXDockAreaEnum.LeftDockArea,position:{at:"top right"}};return l=new n(f),this.displaying(u),a},this.clean=function(){if(a){for(;a.firstChild;)a.removeChild(a.firstChild);l&&l.clean(),a=l=null}},this.displaying=function(e){u=e,l&&l.setPanelVisibilityFlag(u)},this.updatePanel=function(e){a&&(e.firstLabel&&s&&(s.querySelector(".DMU3DCompareRightLabel").innerHTML=e.firstLabel),e.secondLabel&&r&&(r.querySelector(".DMU3DCompareRightLabel").innerHTML=e.secondLabel),e.thirdLabel&&r&&(d.querySelector(".DMU3DCompareRightLabel").innerHTML=e.secondLabel))};var h=function(t){var n=new e.Element("div",{class:"DMU3DCompareLine"});"reduce"!==c&&new e.Element("div",{class:"DMU3DCompareText DMU3DCompareLeftLabel",html:t.leftLabel}).inject(n),e.createElement("div",{class:"DMU3DCompareColorDot"}).inject(n).style.background=t.color;var i=new e.Element("div",{class:"DMU3DCompareText DMU3DCompareRightLabel",html:t.rightLabel});return i.inject(n),"reduce"===c&&i.setStyles({width:"calc(100% - 28px)"}),n}}})})),define("DS/DMUControls/EXPLevelSelector",["UWA/Class","DS/LevelSelector/LevelSelector","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUMeasurable/DMUToolsSceneGraph"],(function(e,t,n,i,o){"use strict";return e.extend({init:function(e){var a=this;if(e&&(!e||e.iFrameWindow)){this.clean=function(){var e=t._noAnim;t._noAnim=!0,t.destroyView(),t._noAnim=e};var l=function(t,i){for(var a=[],l=e.iGetPathElementCB(),s=[],r=l.externalPath.length,d=0;d<r;++d){var c=l.getLastElement(!0);e.iFilterNodeCB(l)&&(a.push({pathElement:l.clone(),name:c.name,internalLevel:r-d}),s.push(c)),l=l.getParentPath()}if(!i){var u=n.getContextViewer({viewer:e.iFrameWindow.getViewer()});u&&o.getName(s,(function(e){for(var n=0;n<e.length;++n)a[n].name=e[n];t()}),u,"")}return a},s=function(t){e.iOnLevelHoverCB&&e.iOnLevelHoverCB(t)},r=function(t){d(e.iGet3DPositionCB,e.iGet2DPositionCB,e.iGetDelta2DPosition),e.iOnLevelSelectCB(t)};d(e.iGet3DPositionCB,e.iGet2DPositionCB,e.iGetDelta2DPosition)}function d(n,o,d){var c=o?o():i.getWindowPositionFromPoint(e.iFrameWindow.getViewer(),n(),e.iFrameWindow),u=d?d():{left:0,top:0},h={positionX:c.left+u.left,positionY:c.top+u.top,uiFrame:e.iFrameWindow.getUIFrame(),getLevels:l,onHover:s,onSelect:r};a.clean(),t.createView(h)}}})})),define("DS/DMUControls/panels/DMUGraphicPropertiesPanel",["UWA/Core","UWA/Class","DS/VisuEvents/EventsManager","DS/Visualization/ThreeJS_DS","DS/Controls/Tab","DS/Controls/ComboBox","DS/Controls/Label","DS/Controls/Slider","DS/Controls/SpinBox","DS/Controls/Button","DS/Controls/Toggle","DS/WebappsUtils/WebappsUtils","DS/CoreEvents/ModelEvents","DS/CATWebUXPreferences/CATWebUXPreferencesUtils","i18n!DS/DMUControls/assets/nls/DMUControls","css!DS/DMUControls/DMUControls.css"],(function(e,t,n,i,o,a,l,s,r,d,c,u,h,m,p){"use strict";return t.extend({init:function(t){var g=t||{};this._parent(g);var f,C,v,w,b=this,y=u.getWebappsAssetUrl("DMUBaseCtxCommands","icons/32/"),D=0,S=[],x=[],E={fill:[],line:[],text:[]},k=[],M={fill:{colors:[],currentColor:null},line:{colors:[],currentColor:null},text:{colors:[],currentColor:null}},P=[{r:255,g:255,b:255},{r:204,g:9,b:47},{r:255,g:138,b:46},{r:254,g:224,b:0},{r:87,g:184,b:71},{r:0,g:0,b:0},{r:155,g:42,b:152},{r:0,g:37,b:150},{r:54,g:142,b:196},{r:71,g:119,b:56}],I=new h;function U(e,t){return I.publish({event:e,data:t,context:this})}function T(){var e;e=S[D],M[e].colors.forEach((t=>{t.div.setStyles({outline:M[e].currentColor&&t.color.equals(M[e].currentColor)?"4px #42a2da solid":""})})),E[e].forEach((t=>{t.div.setStyles({outline:M[e].currentColor&&new i.Color("#"+t.color).equals(M[e].currentColor)?"4px #42a2da solid":""})}))}function A(e){let t=e.from[0].view.style.backgroundColor,n=new i.Color(t.split(" ").join(""));M[S[D]].currentColor=n,T(),U("fill"===S[D]?"onFillColorChanged":"line"===S[D]?"onLineColorChanged":"onTextColorChanged",n.getHex())}function F(t){M[t].colors.length=0;var o,a,l,s=new e.Element("div",{class:"DMU3DColorPalette"}),r=new e.Element("div",{class:"DMU3DColorContainer"}).inject(s);for(g.touchMode&&r.setAttributeNode(document.createAttribute("touch-mode")),o=0;o<5;o++)l="rgb("+P[o].r+","+P[o].g+","+P[o].b+")",(a=new e.Element("div",{class:"DMU3DColorSquare"}).inject(r)).style.background=l,g.touchMode&&a.setAttributeNode(document.createAttribute("touch-mode")),x.push(n.addEvent(a,"onPrimaryPointerClick",A)),M[t].colors.push({color:(new i.Color).setRGB(P[o].r/255,P[o].g/255,P[o].b/255),div:a});for(r=new e.Element("div",{class:"DMU3DColorContainer"}).inject(s),g.touchMode&&r.setAttributeNode(document.createAttribute("touch-mode")),o=5;o<10;o++)l="rgb("+P[o].r+","+P[o].g+","+P[o].b+")",(a=new e.Element("div",{class:"DMU3DColorSquare"}).inject(r)).style.background=l,g.touchMode&&a.setAttributeNode(document.createAttribute("touch-mode")),x.push(n.addEvent(a,"onPrimaryPointerClick",A)),M[t].colors.push({color:(new i.Color).setRGB(P[o].r/255,P[o].g/255,P[o].b/255),div:a});return s}function B(){var e=new d({label:p.customPanelTitle,icon:u.getWebappsAssetUrl("DMUBaseUI","images/")+"I_SwitchColorPalette.png"});return e.getContent().addClassName("DMUAddCustomColorButton"),e.getContent().addEventListener("buttonclick",(function(){U("onCustomColorPanelRequired",M[S[D]].currentColor)})),e}function R(t){var n=new e.Element("div",{class:"GraphicTabContent"});if(void 0!==t.fillColor){F("fill").inject(n),M.fill.currentColor=t.fillColor;let i=new e.Element("div",{class:"DMUGraphicPropCustomColorPaletteDiv"}).inject(n);g.touchMode&&i.setAttributeNode(document.createAttribute("touch-mode")),k.push({tab:"fill",div:i,tokens:[]})}if(void 0!==t.fillOpacity){var i=new e.Element("div",{class:"DMU3DSecondLayerDiv"}).inject(n),o=new s({value:"number"==typeof t.fillOpacity?100*(1-t.fillOpacity):null,minValue:0,maxValue:100,stepValue:1,displayStyle:"horizontal"}).inject(i);o.getContent().setStyles({width:"50%",display:"inline-block"});var a=new r({value:"number"==typeof t.fillOpacity?100*(1-t.fillOpacity):null,minValue:0,maxValue:100,decimals:0,stepValue:1,units:"%",pageStepValue:1}).inject(i);a.getContent().setStyles({width:"50%","min-width":"0px","vertical-align":"top"}),o.addEventListener("change",(function(){a.value=o.value})),a.addEventListener("change",(function(){o.value=a.value,U("onFillOpacityChanged",1-a.value/100)}))}if(void 0!==t.isFilled){var l=new e.Element("div",{class:"DMU3DSecondLayerDiv"}).inject(n);(v=new c({type:"checkbox",label:p.grpFillLabel,checkFlag:"boolean"!=typeof t.isFilled||t.isFilled,mixedState:null===t.isFilled}).inject(l)).getContent().setStyles({"margin-left":"10px"}),v.addEventListener("change",(function(){U("onFilledPropertyChanged",v.checkFlag)}))}return void 0!==t.fillColor&&B().inject(n),n}function j(t){var n,i=new e.Element("div",{class:"GraphicTabContent"});if(void 0!==t.lineColor){F("line").inject(i),M.line.currentColor=t.lineColor;let n=new e.Element("div",{class:"DMUGraphicPropCustomColorPaletteDiv"}).inject(i);g.touchMode&&n.setAttributeNode(document.createAttribute("touch-mode")),k.push({tab:"line",div:n,tokens:[]})}if(void 0!==t.lineOpacity){var o=new e.Element("div",{class:"DMU3DSecondLayerDiv"}).inject(i),d=new s({value:"number"==typeof t.lineOpacity?100*(1-t.lineOpacity):null,minValue:0,maxValue:100,stepValue:1,displayStyle:"horizontal"}).inject(o);d.getContent().setStyles({width:"50%",display:"inline-block"});var u=new r({value:"number"==typeof t.lineOpacity?100*(1-t.lineOpacity):null,minValue:0,maxValue:100,decimals:0,stepValue:1,units:"%",pageStepValue:1}).inject(o);u.getContent().setStyles({width:"50%","min-width":"0px","vertical-align":"top"}),d.addEventListener("change",(function(){u.value=d.value})),u.addEventListener("change",(function(){d.value=u.value,U("onLineOpacityChanged",1-u.value/100)}))}if(void 0!==t.pattern){(n=new e.Element("div",{class:"DMU3DSecondLayerDiv"}).inject(i)).setStyle("text-align","center"),new l({value:p.LineType}).inject(n).getContent().setStyles({"text-align":"left",background:"none"});var h=new a({elementsList:[{label:p.solid,icon:y+"I_DMULineType_1.png"},{label:p.dotted,icon:y+"I_DMULineType_2.png"},{label:p.dashed,icon:y+"I_DMULineType_3.png"},{label:p.dotDashed,icon:y+"I_DMULineType_4.png"},{label:p.phantom,icon:y+"I_DMULineType_5.png"},{label:p.smallDots,icon:y+"I_DMULineType_6.png"},{label:p.jisAxis,icon:y+"I_DMULineType_7.png"}],selectedIndex:"number"==typeof t.pattern?t.pattern-1:-1,enableSearchFlag:!1}).inject(n);h.addEventListener("change",(function(){U("onLineTypeChanged",h.selectedIndex+1)}))}if(void 0!==t.thickness){(n=new e.Element("div",{class:"DMU3DSecondLayerDiv"}).inject(i)).setStyle("text-align","center"),new l({value:p.thickness}).inject(n).getContent().setStyles({"text-align":"left",background:"none"});var m=new a({elementsList:[{label:p.thickness1,icon:y+"I_DMULineThickness_1.png"},{label:p.thickness2,icon:y+"I_DMULineThickness_2.png"},{label:p.thickness3,icon:y+"I_DMULineThickness_3.png"},{label:p.thickness4,icon:y+"I_DMULineThickness_4.png"},{label:p.thickness5,icon:y+"I_DMULineThickness_5.png"},{label:p.thickness6,icon:y+"I_DMULineThickness_6.png"},{label:p.thickness7,icon:y+"I_DMULineThickness_7.png"},{label:p.thickness8,icon:y+"I_DMULineThickness_8.png"},{label:p.thickness9,icon:y+"I_DMULineThickness_16.png"},{label:p.thickness10,icon:y+"I_DMULineThickness_32.png"},{label:p.thickness11,icon:y+"I_DMULineThickness_64.png"}],selectedIndex:"number"==typeof t.thickness?t.thickness:-1,enableSearchFlag:!1}).inject(n);m.addEventListener("change",(function(){U("onLineThicknessChanged",m.selectedIndex)}))}return void 0!==t.hasBorder&&(n=new e.Element("div",{class:"DMU3DSecondLayerDiv"}).inject(i),(w=new c({type:"checkbox",label:p.grpBorderLabel,checkFlag:"boolean"!=typeof t.hasBorder||t.hasBorder,mixedState:null===t.hasBorder}).inject(n)).getContent().setStyles({"margin-left":"10px"}),w.addEventListener("change",(function(){U("onHasBorderPropertyChanged",w.checkFlag)}))),void 0!==t.lineColor&&B().inject(i),i}function _(t){var n=new e.Element("div",{class:"GraphicTabContent"});if(void 0!==t.fontColor){F("text").inject(n),M.text.currentColor=t.fontColor;let i=new e.Element("div",{class:"DMUGraphicPropCustomColorPaletteDiv"}).inject(n);g.touchMode&&i.setAttributeNode(document.createAttribute("touch-mode")),k.push({tab:"text",div:i,tokens:[]})}var i=new e.Element("div",{class:"DMU3DSecondLayerDiv"}).inject(n);if(i.setStyle("text-align","center"),void 0!==t.fontSize){var o=t.fontSize,a=1,l=.5,s="mm",c=t.unitDetails;c&&c.unit&&("Inch"===c.unit||"Foot"===c.unit)&&(s="in",a=2,o=m.convert(o,"Length","Millimeter","Inch"),l=m.convert(l,"Length","Millimeter","Inch")),i.setStyles({"margin-bottom":"10px"});var u=new r({value:o,minValue:0,decimals:a,stepValue:l,units:s,pageStepValue:l}).inject(i);u.getContent().setStyles({width:"100px","vertical-align":"middle"}),u.addEventListener("change",(function(){U("onFontSizeChanged","mm"===u.units?u.value:m.convert(u.value,"Length","Inch","Millimeter"))}))}if(void 0!==t.fontStyle){var h=new d({type:"check",checkFlag:t.fontStyle&&-1!==t.fontStyle.indexOf("bold"),icon:{iconName:"fonticon wux-ui-3ds-text-bold",fontIconFamily:1}}).inject(i);h.getContent().addClassName("FontButton"),g.touchMode&&h.getContent().setStyles({width:"40px","min-width":"40px"});var p=new d({type:"check",checkFlag:t.fontStyle&&-1!==t.fontStyle.indexOf("italic"),icon:{iconName:"fonticon wux-ui-3ds-text-italic",fontIconFamily:1}}).inject(i);p.getContent().addClassName("FontButton"),g.touchMode&&p.getContent().setStyles({width:"40px","min-width":"40px"}),h.addEventListener("click",(function(){var e="normal";h.checkFlag&&p.checkFlag?e="bold italic":h.checkFlag&&!p.checkFlag?e="bold":!h.checkFlag&&p.checkFlag&&(e="italic"),U("onFontStyleChanged",e)})),p.addEventListener("click",(function(){var e="normal";h.checkFlag&&p.checkFlag?e="bold italic":h.checkFlag&&!p.checkFlag?e="bold":!h.checkFlag&&p.checkFlag&&(e="italic"),U("onFontStyleChanged",e)}))}return void 0!==t.fontColor&&B().inject(n),n}this.setCustomColors=function(t){if(0===t.length){var o="rgb("+P[1].r+","+P[1].g+","+P[1].b+")";let e=new i.Color(o.split(" ").join(""));U("fill"===S[D]?"onFillColorChanged":"line"===S[D]?"onLineColorChanged":"onTextColorChanged",e.getHex()),T()}E.fill=t?t.map((e=>({color:e}))):[],E.line=t?t.map((e=>({color:e}))):[],E.text=t?t.map((e=>({color:e}))):[],k.forEach((t=>{!function(t){for(;t.div.firstChild;)t.div.removeChild(t.div.firstChild);let i,o,a;if(t.tokens.forEach((e=>{n.removeEventFromToken(e)})),t.tokens.length=0,E[t.tab].length>0)for(i=new e.Element("div",{class:"DMU3DColorContainer"}).inject(t.div),g.touchMode&&i.setAttributeNode(document.createAttribute("touch-mode")),o=0;o<5;o++)E[t.tab][o]&&(a=new e.Element("div",{class:"DMU3DColorSquare"}).inject(i),g.touchMode&&a.setAttributeNode(document.createAttribute("touch-mode")),a.style.background="#"+E[t.tab][o].color,t.tokens.push(n.addEvent(a,"onPrimaryPointerClick",A)),E[t.tab][o].div=a);if(E[t.tab].length>5)for(i=new e.Element("div",{class:"DMU3DColorContainer"}).inject(t.div),g.touchMode&&i.setAttributeNode(document.createAttribute("touch-mode")),o=5;o<10;o++)E[t.tab][o]&&(a=new e.Element("div",{class:"DMU3DColorSquare"}).inject(i),g.touchMode&&a.setAttributeNode(document.createAttribute("touch-mode")),a.style.background="#"+E[t.tab][o].color,t.tokens.push(n.addEvent(a,"onPrimaryPointerClick",A)),E[t.tab][o].div=a)}(t)}))},this.setCurrentColor=function(e){let t=new i.Color("#"+e);M[S[D]].currentColor=t,U("fill"===S[D]?"onFillColorChanged":"line"===S[D]?"onLineColorChanged":"onTextColorChanged",t.getHex()),T()},this.update=function(e){e&&(void 0!==e.isFilled&&v?(v.checkFlag="boolean"!=typeof e.isFilled||e.isFilled,v.mixedState=null===e.isFilled):void 0!==e.hasBorder&&w&&(w.checkFlag="boolean"!=typeof e.hasBorder||e.hasBorder,w.mixedState=null===e.hasBorder))},this.build=function(t){return f||(f=e.createElement("div",{class:"DMUGraphicPropertyDiv"}),C=new o({displayStyle:["strip"],centeredFlag:!1}).inject(f)),void 0===t.values.isFilled&&void 0===t.values.fillColor&&void 0===t.values.fillOpacity||(C.add({label:p.grpPanelFillTab,icon:{iconName:"fonticon wux-ui-3ds-paint-can-fill",fontIconFamily:1},isSelected:!0,content:R(t.values)}),S.push("fill")),void 0===t.values.hasBorder&&void 0===t.values.lineColor&&void 0===t.values.thickness&&void 0===t.values.pattern&&void 0===t.values.lineOpacity||(C.add({label:p.grpPanelLineTab,icon:{iconName:"fonticon wux-ui-3ds-brush",fontIconFamily:1},isSelected:!1,content:j(t.values)}),S.push("line")),void 0===t.values.fontColor&&void 0===t.values.fontStyle&&void 0===t.values.fontSize||(C.add({label:p.grpPanelTextTab,icon:{iconName:"fonticon wux-ui-3ds-text",fontIconFamily:1},isSelected:!1,content:_(t.values)}),S.push("text")),t.customColors.length&&b.setCustomColors(t.customColors),T(),C.addEventListener("change",(function(e){e&&e.dsModel&&e.dsModel.value&&e.dsModel===C&&(D=e.dsModel.value[0],U("onActiveTabChanged",{activeTab:S[D]}),T())})),t.activeTab&&-1!==S.indexOf(t.activeTab)&&S.length>S.indexOf(t.activeTab)?(C.value=[S.indexOf(t.activeTab)],D=S.indexOf(t.activeTab)):(C.value=[0],D=0),f},this.clean=function(){x.forEach((e=>{n.removeEventFromToken(e)})),x.length=0,C&&C.destroy(),f=C=null},this.subscribe=function(e,t){if(e&&t)return I.subscribe({event:e},t)},this.unsubscribe=function(e){null!=e&&I.unsubscribe(e)}}})})),define("DS/DMUControls/panels/DMUBookmarksPanel",["UWA/Core","UWA/Class","DS/CoreEvents/ModelEvents","UWA/Controls/ThemedScroller","DS/Utilities/TouchUtils","DS/CATWebUXComponents/CATWebUXSectionHeader","DS/CATWebUXComponents/CATWebUXButtonExpander","i18n!DS/DMUControls/assets/nls/DMUControls","css!DS/DMUControls/DMUControls.css"],(function(e,t,n,i,o,a,l,s){"use strict";return t.extend({init:function(){this._parent();var t,r,d,c,u,h,m=this,p=new n,g=o.getTouchMode()?18:14,f=o.getTouchMode()?16:12,C=function(e,t){return p.publish({event:e,data:t,context:this})};function v(e){h&&h!==e.div&&h.setHighlight(!1),h=e.div,e.div.setHighlight(!0),C("onBookmarkSelected",e)}function w(e){C("onBookmarkExpanded",e)}function b(e,t,n,i){if(e&&e.length&&t&&i){var o=Math.max(n,f);e.forEach((function(e){var n={onClickData:e,displayExpander:e.items&&e.items.length>0,icon:e.icon,title:e.title,bold:e.bold,italic:e.italic,fontSize:o,onClickCB:v,onExpandCB:w},a=new l(n),s={view:a,pointedPage:e.pointedPage,pointedPosition:e.pointedPosition,pointedId:e.pointedId,items:[]};i.push(s),t.appendChild(a.getMainDiv()),b(e.items,a.getContentDiv(),o-1,s.items)}))}}function y(e,t,n){if(e&&t){for(var i,o=0;o<e.length;o++)if(e[o].pointedPage<t)i=e[o];else{if(e[o].pointedPage!==t)break;if(!e[o].pointedPosition||e[o].pointedPosition.y>n)i=e[o];else{if(e[o].pointedPosition&&Math.abs(e[o].pointedPosition.y-n)<=1e-4)return e[o];if(e[o].pointedPosition&&e[o].pointedPosition.y<n)break}}return i}}function D(e){for(var t=u;t&&t.length;)t.forEach((function(t){t.view.setExpanded(e)})),t=t.reduce((function(e,t){return e.concat(t.items)}),[]);w()}function S(e,t){return e?e.findIndex((function(e){return e.pointedId===t||S(e.items,t)>=0})):-1}this.buildPanel=function(n){m.cleanPanel(),t||(t=e.createElement("div",{id:"DMUBookmarksPanelMainDiv"})),t.setStyles({height:"100%"});var o=e.createElement("div",{class:"DMUBookmarksPanelSectionMainDiv"}).inject(t);o.setStyles({height:"100%"});var l=n.filter((function(e){return e.items.length}));d=new a({draggable:!1,sectionLabel:s.bookmarksPanel.title,quickAccessBtnList:l.length?[{id:"ExpandAllButton",type:"toggle",initialFontIcon:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-expand-all",alternativeFontIcon:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-collapse-all",title:s.bookmarksPanel.expandOrCollapseAll,cb:D}]:[]}),o.appendChild(d.getContent());return c=e.createElement("div",{id:"DMUBookmarksPanelMainContainer",styles:{"background-color":"white",padding:"5px"}}),(r=(new i).inject(o)).getInnerElement().setContent(c),r.getContent().setStyle("height","calc(100% - 40px)"),u||(u=[]),b(n,c,g,u),1===u.length&&u[0].view.setExpanded(!0),u.sort((function(e,t){return e.pointedPage<t.pointedPage?-1:e.pointedPage>t.pointedPage?1:e.pointedPosition?t.pointedPosition?e.pointedPosition.y>t.pointedPosition.y?-1:e.pointedPosition.y<t.pointedPosition.y?1:0:1:-1})),t},this.highlightBookmark=function(e){if(e){var t,n;if(e.pageNumber&&e.yCoordinate)for(n=y(u,e.pageNumber,e.yCoordinate);n&&(t=n,n.view.isExpanded()&&n.items.length);)n=y(n.items,e.pageNumber,e.yCoordinate);else if(e.elementId){var i=S(u,e.elementId);for(i>=0&&(n=u[i]);n&&i>=0&&(t=n,n.view.isExpanded()&&n.items.length);)(i=S(n.items,e.elementId))>=0&&(n=n.items[i])}t?(h&&h.setHighlight(!1),t.view.setHighlight(!0),h=t.view):h&&(h.setHighlight(!1),h=null)}},this.subscribe=function(e,t){if(e&&t)return p.subscribe({event:e},t)},this.unsubscribe=function(e){null!=e&&p.unsubscribe(e)},this.cleanPanel=function(){if(t){for(h&&h.setHighlight(!1),u&&u.forEach((function(e){e.view.remove()}));t.firstChild;)t.removeChild(t.firstChild);d&&d.clear(),r&&r.destroy(),u=p=d=r=t=h=null}}}})})),define("DS/DMUControls/DMUCustomExpander",["require","exports","UWA/Core","DS/Controls/Toggle","DS/Controls/LineEditor","DS/Utilities/TouchUtils","css!DS/DMUControls/DMUControls.css"],(function(e,t,n,i,o,a){"use strict";return class{constructor(e){let t,l,s,r,d,c,u,h,m,p,g,f=e||{},C=this,v=a.getTouchMode(),w={},b=!1,y=!1,D=!1,S=!1,x=!0,E=!1,k=!0,M=!0,P=!1,I=!1,U=!1,T=!1;function A(){if(T||!l||!m||!t||!r||!c||!u||!s||!h)return;v||y||(I||D?h.show():h.hide()),y&&(D=!1);let e=b&&l.firstChild;t.setStyles({outline:D?"2px solid #368ec4":e||I?"1px solid #c8c8c8":"","background-color":e||I?"rgba(40, 57, 106, 0.06)":"",height:e?"auto":"0px","grid-template-rows":e&&S?v?"50px calc(100% - 50px)":"28px calc(100% - 28px)":v?"30px calc(100% - 30px)":"18px calc(100% - 18px)"}),l.setStyles({opacity:e?1:0}),r.setStyles({display:w.icon||w.fontIcon?"":"none"}),c.setStyles({display:l.firstChild&&E?"":"none"}),I&&!D?P&&w.additionalDiv&&(u.setStyles({display:""}),w.additionalDiv.forEach((e=>{e&&e.querySelector(".hideOnHover")&&e.hide()}))):(D&&w.additionalDiv.forEach((e=>{e&&e.querySelector(".hideOnHover")&&e.show()})),u.setStyles({display:w.additionalDiv&&w.additionalDiv.length&&k?"":"none"})),r.setStyles({display:M?"":"none"})}this.build=e=>{C.clear(),T=!0,w={icon:e.icon,fontIcon:e.fontIcon,fontIconColor:e.fontIconColor,label:e.label,additionalDiv:e.additionalDiv,body:e.body},t=v?new n.Element("div",{class:"DMUCustomExpanderMainDivTouchMode"}):new n.Element("div",{class:"DMUCustomExpanderMainDiv"}),t&&(t.dsModel=this,t.addEventListener("click",(e=>{e.stopPropagation(),function(e){U?U=!1:(!x||e.shiftKey||e.ctrlKey||(b?C.collapse():C.expand()),e.ctrlKey&&!0===D?C.setSelectedFlag(!1,e):C.setSelectedFlag(!0,e))}(e)})),v||(t.addEventListener("mouseenter",(()=>{I=!0,A()})),t.addEventListener("mouseleave",(()=>{I=!1,A()}))),h=new n.Element("div",{class:"DMUCustomExpanderCheckBox"}).inject(t),h&&(m=new i({type:"checkbox",checkFlag:D}).inject(h),m&&(m.getContent().addClassName("checkBox"),m.getContent().getChildren()[0].setStyles({"margin-bottom":"0px"}),m.addEventListener("buttonclick",(function(e){e.stopPropagation(),U=!0,C.setSelectedFlag(!D,e)})),l=new n.Element("div",{class:"DMUCustomExpanderBody"}).inject(t),l&&(e.body&&l.appendChild(e.body),s=new n.Element("div",{class:"DMUCustomExpanderHeader"}).inject(t),r=new n.Element("div",{class:"DMUCustomExpHeaderIconContainer"}).inject(s),d=new n.Element("div",{class:"DMUCustomExpHeaderLabelContainer"}).inject(s),e.checkEditMode&&(p=e.checkEditMode),e.highlightEditMode&&(g=e.highlightEditMode),p&&p.canEditState&&b?d.setStyles({"grid-column":"1 / span 2","padding- left":"1px"}):d.setStyles({"grid-column":"2"}),c=new n.Element("div",{class:"DMUCustomExpHeaderExpCollapseContainer"}).inject(s),new n.Element("div",{class:"DMUCustomExpHeaderExpIcon wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds "+(b?"wux-ui-3ds-resize-small":"wux-ui-3ds-resize-full")}).inject(c),c&&c.addEventListener("click",(e=>{e.stopPropagation(),b?this.collapse():this.expand()})),u=new n.Element("div",{class:"DMUCustomExpHeaderAddDivContainer"}).inject(s),C.setIcon({icon:e.icon,fontIcon:e.fontIcon,fontIconColor:e.fontIconColor}),C.setLabel(e.label),C.setAdditionalDiv(e.additionalDiv),T=!1,A()))))},this.getContent=()=>t,this.setIcon=e=>{if(r){for(w.icon=e?e.icon:"",w.fontIcon=e?e.fontIcon:"";r.firstChild;)r.removeChild(r.firstChild);if(w.icon)new n.Element("img",{class:"DMUCustomExpHeaderIcon",src:w.icon}).inject(r);else if(w.fontIcon){let e=new n.Element("div",{class:"DMUCustomExpHeaderFontIcon wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds "+w.fontIcon}).inject(r);w.fontIconColor&&e.setStyles({color:w.fontIconColor})}A()}},this.setLabel=e=>{if(d){for(;d.firstChild;)d.removeChild(d.firstChild);if(S&&!y){let t=new o({value:e||"",selectAllOnFocus:!0,maxLength:100,displayClearFieldButtonFlag:!1}).inject(d);t.addEventListener("change",(function(){w.label=t.value,f.onLabelChanged&&f.onLabelChanged({value:w.label,type:"name"})})),v?t.elements.inputField.setStyles({width:"82%"}):t.elements.inputField.setStyles({width:"111%"}),t.getContent().title=e}else{b?(p&&p.canEditState||g&&g.canEditPriority)&&(d.style.cssText="grid-column: 1 / span 2; padding-left: 1px;"):d.style.gridColumn="2";let t=new n.Element("p",{class:"DMUCustomExpHeaderLabel"}).inject(d);t.innerText=e,t.title=e}w.label!==e&&f.onLabelChanged&&f.onLabelChanged({value:e,type:"name"}),w.label=e,A()}},this.setAdditionalDiv=e=>{if(!u)return;let t;for(e&&e.length>0&&(t=new n.Element("div",{class:"finalAdditionalDiv"}),t.setStyles({display:"flex"}),e.forEach((e=>{e&&e.inject(t)}))),w.additionalDiv=e;u.firstChild;)u.removeChild(u.firstChild);t&&u.appendChild(t),A()},this.setAdditionalDivVisibleFlag=e=>{k=e,A()},this.setAdditionalDivVisibleFlagOnHover=e=>{P=e,A()},this.setCheckBoxClickedFlag=e=>{U=e,A()},this.setExpandOrCollapseButtonVisibleFlag=e=>{E=e,A()},this.setLabelEditionFlag=e=>{S=e,C.setLabel(w.label)},this.setHeaderIconVisibleFlag=e=>{M=e,A()},this.expandOrCollapseAtClick=e=>{x=e},this.setSelectedFlag=(e,t)=>{e===D&&t&&!t.ctrlKey||(e!==D&&(D=e),m&&(m.checkFlag=D,A()),f.onSelectedFlagChanged&&f.onSelectedFlagChanged({state:D,event:t}))},this.setSelectionVisibility=e=>{e!==D&&(D=e),m&&(m.checkFlag=D,A())},this.setReadOnly=e=>{y!==e&&(y=e,A())},this.expand=()=>{if(!b&&(b=!0,f.onExpandOrCollapse&&f.onExpandOrCollapse({object:C,state:b}),A(),c&&c.setStyles({"grid-column":"3"}),c&&c.getElementsByClassName("DMUCustomExpHeaderExpIcon").length)){c.getElementsByClassName("DMUCustomExpHeaderExpIcon")[0].className="DMUCustomExpHeaderExpIcon wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-resize-small"}},this.collapse=()=>{if(b&&(b=!1,f.onExpandOrCollapse&&f.onExpandOrCollapse({object:C,state:b}),A(),c&&c.setStyles({"grid-column":"4"}),c&&c.getElementsByClassName("DMUCustomExpHeaderExpIcon").length)){c.getElementsByClassName("DMUCustomExpHeaderExpIcon")[0].className="DMUCustomExpHeaderExpIcon wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-resize-full"}},this.clear=()=>{w={},t=m=l=void 0,U=I=!1},this.isCheckBoxClicked=()=>U,this.isSelected=()=>D,this.isReadOnly=()=>y,this.isExpanded=()=>b}}})),define("DS/DMUControls/DMUThumbnailChooser",["UWA/Core","UWA/Class","DS/CATWebUXComponents/CATWebUXThumbnail","UWA/Controls/ThemedScroller","DS/VisuEvents/EventsManager","css!DS/DMUControls/DMUControls.css"],(function(e,t,n,i,o){"use strict";var a=t.extend({init:function(t){var n,i,a=t||{};if(this._parent(a),this.inject=function(e){return n.inject(e),this},this.clear=function(){o.removeEvent(n,"onPrimaryPointerClick",i)},n=e.createElement("div",{class:"DMUAdditionalCommand"}),a.icon){var l=e.createElement("img",{src:a.icon}).inject(n);l.setStyles({width:"22px",height:"22px"}),l.ondragstart=function(){return!1}}i=function(){a.cb()};var s=e.createElement("p").inject(n);s.innerHTML=a.nls,s.title=a.nls,o.addEvent(n,"onPrimaryPointerClick",i)}});return t.extend({init:function(t){var o=t||{};this._parent(o);var l,s,r=this,d=[],c=[],u=121,h=208;this.build=function(t){var o;r.clean(),l=e.createElement("div",{class:"DMUThumbnailChooserMainDiv"}),(s=(new i).inject(l)).getContent().setStyle("height","100%");var m=e.createElement("div",{class:"DMUThumbnailScrollerContainer"});s.getInnerElement().setContent(m);var p=e.createElement("div",{class:"DMUThumbnailChooserMainContainer"}).inject(m);if(!t||!t.thumbnailData)return l;var g,f=function(e){for(o=0;o<d.length;o++)d[o].setDisplayFlag(d[o].getThumbnailID()===e.id);t.onThumbnailSelectedCB&&t.onThumbnailSelectedCB({id:e.id})};for(o=0;o<t.thumbnailData.length;o++)g=new n({id:t.thumbnailData[o].id,icon:t.thumbnailData[o].icon,width:h,height:u,title:t.thumbnailData[o].title,preview:t.thumbnailData[o].preview,displayFlag:t.thumbnailData[o].isSelected,clickCB:f}).inject(p),d.push(g);if(t.additionalCommands)for(o=0;o<t.additionalCommands.length;o++){var C=new a(t.additionalCommands[o]);C.inject(m),c.push(C)}return l.setStyles({width:r.getWidth()+"px",height:r.getHeight()+"px"}),l},this.getHeight=function(){var e=c?40*c.length:0;return d.length<=3?e+u:d.length<=6?e+242:e+363},this.getWidth=function(){return 1===d.length?h:2===d.length?416:624},this.getContent=function(){return l},this.clean=function(){for(var e=0;e<d.length;e++)d[e].clear();d.length=0,s&&s.destroy(),l=s=null}}})})),define("DS/DMUControls/panels/DMUDocumentPanel",["UWA/Core","DS/Windows/Dialog","DS/Controls/Button","DS/DataGridView/DataGridView","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","UWA/Class","i18n!DS/DMUControls/assets/nls/DMUControls"],(function(e,t,n,i,o,a,l,s){"use strict";return l.extend({init:function(l){this._parent(l);let r,d=this;this.build=function(c,u,h){if(d.destroy(),l.immersiveFrame&&c&&c.data&&c.title){let d=new e.Element("div"),C=s.documentPanel?s.documentPanel:{};"delete"===c.mode&&new e.Element("div",{html:"<p>"+C.documentDelete+"</p><p>"+C.documentReroute+"</p>"}).inject(d);var m=new o;c.data.forEach((function(e){m.addRoot(new a({label:e.title,grid:e}))}));var p=[{text:C.documentTitle,dataIndex:"tree"}];c.displayRevisions&&p.push({text:C.documentRevision,dataIndex:"revision"}),p=p.concat([{text:C.documentModificationDate,dataIndex:"modifiedDate"},{text:C.documentCreationDate,dataIndex:"creationDate"}]);var g=new i({identifier:"DMUDocumentPanelDataGrid",treeDocument:m,columns:p,rowSelection:"single",cellSelection:{defaultValue:"none"},rowDragEnabledFlag:!1,allowUnsafeHTMLContent:!1,cellDragEnabledFlag:!1,activateAllCellsRenderedEventFlag:!0,showRowBorderFlag:!0,placeholder:"",recId:"DMUDocumentPanelDataGrid",position:"relative"});if("delete"===c.mode){var f=e.createElement("div",{styles:{position:"relative",height:150,margin:"10px 0px"}});g.inject(f),f.inject(d)}else g.inject(d);let v=new n({label:C.okLabel,onClick:function(){var e=g.getTreeDocument().getSelectedNodes();if(e&&e.length){var t=e[0].options.grid.versions;u(e[0].options.grid.fileId,t),r&&r.destroy(),r=null}}}),w=new n({label:C.cancelLabel,onClick:function(){r&&r.close()}});r=new t({identifier:"dialog",modalFlag:!0,title:c.title,content:d,height:200,width:650,position:{my:"center",at:"center"},resizableFlag:!0,immersiveFrame:l.immersiveFrame,buttons:{Ok:v,Cancel:w}}),r.addEventListener("close",(function(){h&&h(),r&&r.destroy(),r=null}))}},this.destroy=function(){r&&r.destroy(),r=null}}})})),define("DS/DMUControls/DMUOptionsPanel",["UWA/Core","UWA/Class","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/Toggle","i18n!DS/DMUControls/assets/nls/DMUControls"],(function(e,t,n,i,o,a){"use strict";return t.extend({init:function(t){var l=t||{};if(this._parent(l),l.frmWindow&&l.options&&l.options.length&&l.cb){var s,r=e.createElement("div",{class:"DMUPasteSpecialPanelMainDiv"}),d=[];if(t.options&&t.options.length)for(var c=0;c<t.options.length;c++)d.push(new o({label:t.options[c].nls,value:t.options[c].id,type:"checkbox",checkFlag:t.options[c].value}).inject(r));var u={};u.Ok=new i({emphasize:"primary",onClick:function(){h(!1)}}),u.Abort=new i({label:a.cancelButton,onClick:function(){s.close?s.close():s.destroy()}}),l.prefs&&l.prefs.applyButtonNls&&(u.Apply=new i({onClick:function(){h(!0)}})),s=new n({modalFlag:!0,ensureHeightDefinitionOnHierarchy:!0,title:t.panelTitle,content:r,immersiveFrame:l.frmWindow.getImmersiveFrame(),buttons:u})}function h(e){for(var t={},n=0;n<d.length;n++)t[d[n].value]=d[n].checkFlag;l&&l.cb&&l.cb(t,e),e||(s.close?s.close():s.destroy())}}})}));var __classPrivateFieldSet=this&&this.__classPrivateFieldSet||function(e,t,n,i,o){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?o.call(e,n):o?o.value=n:t.set(e,n),n},__classPrivateFieldGet=this&&this.__classPrivateFieldGet||function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};define("DS/DMUControls/DMUCommentFilterView",["require","exports","UWA/Core","DS/Controls/Button","DS/Controls/ButtonGroup","DS/Controls/Toggle","DS/Controls/Expander","DS/DMUBaseUIComponents/DMURichTextServices","DS/DMUBaseUI/DMUToolsUsers","i18n!DS/DMUControls/assets/nls/DMUControls"],(function(e,t,n,i,o,a,l,s,r,d){"use strict";var c,u;const h={1:"noPriority",2:"ratingLow",3:"ratingMedium",4:"ratingHigh",6:"ratingUrgent",5:"processed"},m={noPriority:{id:"noPriority",order:0,label:d.reviewPanel.noStatusDefined},ratingLow:{id:"ratingLow",order:4,label:d.reviewPanel.highlightRatingLow,icon:"wux-ui-3ds-level-low",color:"rgb(71,119,56)"},ratingMedium:{id:"ratingMedium",order:3,label:d.reviewPanel.highlightRatingMedium,icon:"wux-ui-3ds-level-medium",color:"rgb(232, 123, 0)"},ratingHigh:{id:"ratingHigh",order:2,label:d.reviewPanel.highlightRatingHigh,icon:"wux-ui-3ds-level-high",color:"rgb(234, 79, 55)"},ratingUrgent:{id:"ratingUrgent",order:1,label:d.reviewPanel.highlightRatingUrgent,icon:"wux-ui-3ds-alert",color:"rgb(153, 7, 7)"},processed:{id:"processed",order:5,label:d.reviewPanel.highlightRatingProcessed,icon:"wux-ui-3ds-check",color:"rgb(1, 131, 8)"},withdrawn:{id:"withdrawn",order:6,label:d.reviewPanel.statusWithdrawn,icon:"wux-ui-3ds-wrong",color:"rgb(204, 9, 47)"}},p={today:{id:"today",label:d.today,order:1},yesterday:{id:"yesterday",label:d.yesterday,order:2},thisWeek:{id:"thisWeek",label:d.thisWeek,order:3},lastWeek:{id:"lastWeek",label:d.lastWeek,order:4},older:{id:"older",label:d.older,order:5}},g={noHighlight:{id:"noHighlight",label:d.noHighlight,order:1},withIssue:{id:"withIssue",label:d.withIssue,icon:"wux-ui-3ds-issue-type",order:2},withoutIssue:{id:"withoutIssue",label:d.withoutIssue,icon:"wux-ui-3ds-highlight-review",order:3}},f={noImpactedCheck:{id:"noImpactedCheck",label:d.noImpactedCheck,order:1},impactedCheck:{id:"impactedCheck",label:d.impactedCheck,icon:"wux-ui-3ds-check-review",order:2}};function C(e){const t=new Date;return e.toDateString()===t.toDateString()?p.today:e.toDateString()===new Date((new Date).setDate(t.getDate()-1)).toDateString()?p.yesterday:e.getTime()>=new Date(new Date((new Date).setDate(t.getDate()-(t.getDay()+6)%7)).toDateString()).getTime()?p.thisWeek:e.getTime()>=new Date(new Date((new Date).setDate(t.getDate()-(t.getDay()+6)%7-7)).toDateString()).getTime()?p.lastWeek:p.older}const v=[{id:"what",label:d.filterCommentSections.What,icon:"wux-ui-3ds-6w-what",sortMethod:(e,t)=>{var n,i;return(null===(n=m[e.id])||void 0===n?void 0:n.order)-(null===(i=m[t.id])||void 0===i?void 0:i.order)}},{id:"who",label:d.filterCommentSections.Who,icon:"wux-ui-3ds-6w-who",sortMethod:(e,t)=>e.label===d.me?-1:t.label===d.me||e.label>=t.label?1:-1},{id:"when",label:d.filterCommentSections.When,icon:"wux-ui-3ds-6w-when",sortMethod:(e,t)=>p[e.id].order-p[t.id].order},{id:"where",label:d.filterCommentSections.Where,icon:"wux-ui-3ds-6w-where",sortMethod:(e,t)=>e.label>=t.label?1:-1},{id:"how",label:d.filterCommentSections.How,icon:"wux-ui-3ds-6w-how",sortMethod:(e,t)=>g[e.id].order-g[t.id].order},{id:"why",label:d.filterCommentSections.Why,icon:"wux-ui-3ds-6w-why",sortMethod:(e,t)=>f[e.id].order-f[t.id].order}],w=(e,t)=>{if(s.getMentionsFromContent(e.content).forEach((e=>{const n=e.id===r.getUserLogin();t.who.some((t=>t.id===e.id))||t.who.push({id:e.id,label:n?d.me:e.name+` (${e.id.toUpperCase()})`,image:r.getUserImageURL(e.id)})})),!t.who.some((t=>t.id===e.owner.login))){const n=e.owner.login===r.getUserLogin();t.who.push({id:e.owner.login,label:n?d.me:(e.owner.name||e.owner.login)+` (${e.owner.login.toUpperCase()})`,image:e.owner.imageUrl})}},b=(e,t)=>{const n=C(new Date(e.dateInMs));t.when.some((e=>e.id===n.id))||t.when.push(n)};class y{static build(e,t,s){const r=[],p={what:[],who:[],when:[],where:[],how:[],why:[]};let C=structuredClone(t);__classPrivateFieldSet(c,c,n.createElement("div",{id:"DMUCommentsPanelFilterView",class:"DMUCommentsPanelFilter-main"}),"f",u),e.forEach((({commentData:e})=>{var t,n;((e,t)=>{e.highlights&&e.highlights.length?e.highlights.forEach((e=>{t.what.some((t=>t.id===m[h[e.rating]].id))||t.what.push(m[h[e.rating]])})):t.what.some((e=>e.id===m[h[1]].id))||t.what.push(m[h[1]]),e.status&&e.status in m&&(t.what.some((t=>t.id===m[e.status].id))||t.what.push(m[e.status]))})(e,p),w(e,p),null===(t=e.replies)||void 0===t||t.forEach((e=>w(e,p))),b(e,p),null===(n=e.replies)||void 0===n||n.forEach((e=>b(e,p))),e.markupName&&!p.where.some((t=>t.id===e.markupName))&&p.where.push({id:e.markupName,label:e.markupName});const i=e.highlights&&e.highlights.length?e.highlights.some((e=>e.hasIssue))?g.withIssue:g.withoutIssue:g.noHighlight;p.how.some((e=>e.id===i.id))||p.how.push(i);const o=e.highlights&&e.highlights.length&&e.highlights.some((e=>e.hasImpactedChecks))?f.impactedCheck:f.noImpactedCheck;p.why.some((e=>e.id===o.id))||p.why.push(o)})),Object.keys(p).forEach((e=>{var t;p[e].sort(null===(t=v.find((t=>t.id===e)))||void 0===t?void 0:t.sortMethod)}));let y=n.createElement("div",{class:"DMUCommentsPanelFilterExpanders"}).inject(__classPrivateFieldGet(c,c,"f",u));v.forEach((e=>{if(!p[e.id].length)return;let i=n.createElement("div",{styles:{display:"flex","align-items":"center",gap:"5px"}});n.createElement("i",{class:`${e.icon} wux-ui-3ds`}).inject(i);let s=new o({type:"checkbox"});p[e.id].forEach((i=>{var o;const l=n.createElement("div",{class:"DMUCommentsPanelFilter-content"});if(i.image){let e=n.createElement("img",{class:"DMUCommentsPanelFilter-content-image",src:i.image,events:{error:function(){e&&l.removeChild(e);let t=n.createElement("i",{class:"wux-ui-3ds wux-ui-3ds-user DMUCommentsPanelFilter-content-image"});l.insertBefore(t,l.firstElementChild)}}}).inject(l)}i.icon&&n.createElement("i",{class:`${i.icon} wux-ui-3ds`,styles:{color:i.color}}).inject(l),n.createElement("span",{class:"DMUCommentsPanelFilter-content-label",text:i.label}).inject(l);const d=new a({type:"checkbox",label:l.outerHTML,allowUnsafeHTMLLabel:!0,value:0,checkFlag:(null===(o=t[e.id])||void 0===o?void 0:o.includes(i.id))||!1});d.addEventListener("change",(()=>{var t,n,o,a;d.checkFlag?(C[e.id]||(C[e.id]=[]),null===(t=C[e.id])||void 0===t||t.push(i.id)):(null===(n=C[e.id])||void 0===n||n.splice((null===(o=C[e.id])||void 0===o?void 0:o.indexOf(i.id))||0,1),(null===(a=C[e.id])||void 0===a?void 0:a.length)||delete C[e.id])})),r.push(d),s.addChild(d)}));const d=new l({header:e.label,expandedFlag:"false"!==localStorage.getItem("DMUCommentsPanelFilterView-"+e.id),body:s,customHeader:i});d.inject(y),d.addEventListener("expand",(function(){localStorage.setItem("DMUCommentsPanelFilterView-"+e.id,"true")})),d.addEventListener("collapse",(function(){localStorage.setItem("DMUCommentsPanelFilterView-"+e.id,"false")}))}));const D=n.createElement("div",{class:"DMUCommentsPanelFilter-buttons"}).inject(__classPrivateFieldGet(c,c,"f",u)),S=n.createElement("button",{class:"DMUCommentsPanelFilter-buttons-reset",text:d.snapshotReset});S.inject(D),S.addEventListener("click",(function(){r.forEach((e=>e.checkFlag=!1)),C={}}));const x=new i({label:d.documentPanel.okLabel,emphasize:"primary"});x.inject(D),x.addEventListener("buttonclick",(function(){s.onOk(C)}));const E=new i({label:d.documentPanel.cancelLabel,emphasize:"secondary"});return E.inject(D),E.addEventListener("buttonclick",(function(){s.onCancel()})),__classPrivateFieldGet(c,c,"f",u)}static commentMatchesFilters(e,t){return Object.keys(t).every((n=>{var i,o,a,l,r,d,c,u;if("what"===n)return e.highlights&&e.highlights.length?null===(a=e.highlights)||void 0===a?void 0:a.some((e=>{var i;return null===(i=t[n])||void 0===i?void 0:i.includes(h[e.rating.toString()])})):e.status&&e.status in m?null===(i=t[n])||void 0===i?void 0:i.includes(e.status):(null===(o=t[n])||void 0===o?void 0:o.includes(h[1]))&&!e.isReply;if("who"===n){if(null===(l=t[n])||void 0===l?void 0:l.includes(e.owner.login))return!0;return s.getMentionsFromContent(e.content).some((e=>{var i;return null===(i=t[n])||void 0===i?void 0:i.includes(e.id)}))}return"when"===n?null===(r=t[n])||void 0===r?void 0:r.includes(C(new Date(e.dateInMs)).id):"where"===n?e.markupName&&(null===(d=t[n])||void 0===d?void 0:d.includes(e.markupName)):"how"===n?e.highlights&&e.highlights.length?e.highlights.some((e=>{var i;return null===(i=t[n])||void 0===i?void 0:i.includes(e.hasIssue?g.withIssue.id:g.withoutIssue.id)})):(null===(c=t[n])||void 0===c?void 0:c.includes(g.noHighlight.id))&&!e.isReply:"why"===n?e.highlights&&e.highlights.length?e.highlights.some((e=>{var i,o;return e.hasImpactedChecks&&(null===(i=t[n])||void 0===i?void 0:i.includes(f.impactedCheck.id))||!e.hasImpactedChecks&&(null===(o=t[n])||void 0===o?void 0:o.includes(f.noImpactedCheck.id))})):(null===(u=t[n])||void 0===u?void 0:u.includes(f.noImpactedCheck.id))&&!e.isReply:void 0}))}static destroy(){__classPrivateFieldGet(c,c,"f",u)&&(__classPrivateFieldGet(c,c,"f",u).destroy(),__classPrivateFieldSet(c,c,null,"f",u))}}return c=y,u={value:null},y})),define("DS/DMUControls/panels/DMUSlidesPanel",["UWA/Core","UWA/Class","DS/Visualization/ThreeJS_DS","DS/CoreEvents/ModelEvents","DS/CATWebUXComponents/CATWebUXThumbnail","UWA/Controls/ThemedScroller","DS/Controls/Expander","DS/Utilities/TouchUtils","DS/VisuEvents/EventsManager","DS/CATWebUXComponents/CATWebUXSectionHeader","DS/Menu/ContextualMenu","DS/DMUBaseUI/DMUToolsUsers","DS/Controls/TooltipModel","DS/Controls/Button","i18n!DS/DMUControls/assets/nls/DMUControls","css!DS/DMUControls/DMUControls.css"],(function(e,t,n,i,o,a,l,s,r,d,c,u,h,m,p){"use strict";let g,f;const C={1:{icon:"wux-ui-3ds-attention",color:"#007DA3"},2:{icon:"wux-ui-3ds-level-low",color:"rgb(71,119,56)"},3:{icon:"wux-ui-3ds-level-medium",color:"rgb(232,123,0)"},4:{icon:"wux-ui-3ds-level-high",color:"rgb(234,79,55)"},5:{icon:"wux-ui-3ds-check",color:"rgb(71, 119, 56)"},6:{icon:"wux-ui-3ds-alert",color:"rgb(153, 7, 7)"}};let v=l.extend({init:function(t){let n=t||{};if(n.onMarkupCtxMenuCB){n.customHeader||(n.customHeader=e.createElement("div",{class:"DMUBrowserSectionCustomHeader"}));const i=e.createElement("div",{class:"DMUBrowserSectionMenuButton"}).inject(n.customHeader);i.appendChild(e.createElement("div",{class:"wux-ui-3ds wux-ui-3ds-lg wux-ui-3ds-menu-dot"})),i.addEventListener("click",(function(e){e.stopPropagation(),t.onMarkupCtxMenuCB({id:t.id,event:e})}))}this._parent(n);let i,o,a=!1,l=e.createElement("div",{class:"DMUBrowserSectionShadingCol"}),s=this,d=!1,m=[],g=!1,f="",C=e.createElement("div",{class:"DMUBrowserSectionReplySection"}),v=e.createElement("div",{class:"DMUReplySubSectionHeaderDiv"}).inject(C);v.setStyle("padding-left","10px");let w=e.createElement("div",{class:"DMUReplySubSectionArrow wux-ui-3ds wux-ui-3ds-expand-right"}).inject(v),b=e.createElement("p",{class:"DMUReplySubSectionHeaderText"}).inject(v);b.setText(p.showMoreLabel);let y=r.addEvent(v,"onPrimaryPointerClick",(function(){s.setReplySectionExpandedFlag(!g)}));if(this.addChild=function(e,t){null!=t?s.body.insertBefore(e,s.body.children[t]):(e.inject(s.body),m.length&&(s.body.removeChild(C),s.body.appendChild(C)))},this.getChildIndex=function(e){return Array.prototype.indexOf.call(s.body.children,e)},this.removeChild=function(e){s.body.removeChild(e)},this.setNoDiv=function(e){e?(s.body.appendChild(e),o=e):s.body.contains(o)&&s.body.removeChild(o)},this.getContent=function(){return this.elements.container},this.setShadingColor=function(e){a=e,l.setStyle("background-color",a?"rgb(87, 184, 71)":"")},this.addReply=function(e){m.push(e),C.appendChild(e.getContent()),m.length&&s.body.appendChild(C),e.setVisibleFlag(g)},this.setReplySectionExpandedFlag=function(e){if(g!==e){g=e;for(let e=m.length-1;e>=0;e--)m[e].setVisibleFlag(g);b.setText(g?p.showLessLabel:p.showMoreLabel),g?(w.hasClassName("wux-ui-3ds-expand-right")&&w.removeClassName("wux-ui-3ds-expand-right"),w.addClassName("wux-ui-3ds-expand-down")):(w.hasClassName("wux-ui-3ds-expand-down")&&w.removeClassName("wux-ui-3ds-expand-down"),w.addClassName("wux-ui-3ds-expand-right"))}},this.getReplySectionExpandedFlag=function(){return g},this.removeReply=function(e){-1!==m.indexOf(e)&&m.splice(m.indexOf(e,1)),C.removeChild(e.getContent()),m.length||s.body.removeChild(C)},this.setActiveMarkup=function(e){d=e,s.elements.header.setStyles({color:!s.expandedFlag&&d?"#368ec4":""})},this.setCtxMenuVisibility=function(e){n.customHeader&&n.customHeader.setStyle("display",e?"":"none")},this.clear=function(){i&&c.removeEventListener(this.elements.header,i),r.removeEventFromToken(y),i=y=null},this.setTitle=function(e){this.headerTooltipInfos||(this.headerTooltipInfos=new h({title:n.name})),this.headerTooltipInfos.title=f?`${e} - ${f}`:e,s.header=e},this.body=e.createElement("div",{class:"DMUBrowserSectionThumbsMainContainer DMUSlidePanelMarkupDiv"}),this.elements.header.appendChild(l),this.style="simple",this.icon=n.icon,n.onMarkupCtxMenuCB&&(i=c.addEventListener(this.elements.header,{callback:function(e){n.onMarkupCtxMenuCB({id:n.id,event:e.data.event})}})),n.children&&n.children.length)for(let e=0;e<n.children.length;e++)s.addChild(n.children[e].getContent());this.getContent().addEventListener("expand",(function(){s.elements.header.setStyle("color",""),l.setStyle("display","none")})),this.getContent().addEventListener("collapse",(function(){d&&s.elements.header.setStyle("color","#368ec4"),l.setStyle("display","")})),this.getContent().addClassName("DMUMarkupExpander"),this.expand(),this.setTitle(n.name),n.owner&&(f=n.owner,u.getUserName(n.owner).then((t=>{f=t,this.headerTooltipInfos.title=`${n.name} - ${t}`,n.customHeader||(n.customHeader=e.createElement("div",{class:"DMUBrowserSectionCustomHeader"}));const i=e.createElement("span",{class:"DMUBrowserSectionThumbsMarkupName",text:t});n.customHeader.firstElementChild?n.customHeader.insertBefore(i,n.customHeader.firstElementChild):n.customHeader.appendChild(i)})))}}),w=t.extend({init:function(t){let n=t||{};this._parent(n);let i,o,a,l,d,c,u,h,C,w,b,y=null,D=null,S=null,x=e.createElement("div",{class:"DMUBrowserNoSlidesTitleDiv"}),E=!1,k=this,M=[],P=e.createElement("div",{id:"DMUDraggableThumbnailDiv",class:"DMUDraggableThumbnailDiv"}),I=!1,U=!0,T=[],A=!!n.allowSlideReorder&&n.allowSlideReorder,F=!1===n.webMarkup,B=!1,R=0;const j=10*window.devicePixelRatio;function _(e){(("Escape"===e.key||27===e.keyCode)&&"keydown"===e.type||"keyup"===e.type&&"Shift"===e.key)&&(d&&(d.setStyles({"padding-top":"","padding-bottom":""}),d=null),c=!0,O())}function N(e){(!e.shiftKey&&C||e.shiftKey&&!C)&&(w=!0,setTimeout((function(){w=!1}),400))}function L(n){if(w)return void(w=!1);if(h){let e=document.querySelector(".DMUSlidePanelThumbMainContainer");e&&(e.addEventListener("touchstart",V,!1),e.addEventListener("touchmove",V,!1))}c=!1,document.querySelector(".DMUBrowserThumbsMainContainer.DMUSlidePanelMarkupDiv")?b=document.querySelector(".DMUBrowserThumbsMainContainer.DMUSlidePanelMarkupDiv").parentElement.parentElement:document.querySelector(".DMUBrowserSectionThumbsMainContainer.DMUSlidePanelMarkupDiv")&&(b=document.querySelector(".DMUBrowserSectionThumbsMainContainer.DMUSlidePanelMarkupDiv").parentElement.parentElement.parentElement.parentElement.parentElement);let i=n.from[0].view.closest(".DMUSlideAndReplyMainDiv"),o=M.find((function(e){return e.getContent()===i}));if(!o||o.isInEdition())return;document.addEventListener("keydown",_),document.addEventListener("keyup",_),o.isChecked()?M.forEach((function(e){e.isChecked()&&T.push(e)})):T.push(o);let a=o.getContent().getPosition(document.body),l=n.from[0].getCurrentPosition(document.body);u={x:a.x-l.x,y:a.y-l.y},T.forEach((function(e){let t=e.getContent(),n=t.getPosition(document.body),i=t.firstChild.cloneNode(!0);t.setStyle("display","none"),i.removeChild(i.firstElementChild),i.style.opacity=.8,i.style.left=n.x-l.x+"px",i.style.top=n.y-l.y+"px",i.style.position="absolute",i.classList.add("DMUAnimateDrag"),i.addEventListener("transitionend",(function(){i.classList.remove("DMUAnimateDrag")}),{once:!0}),P.appendChild(i)})),T.length>1&&e.createElement("div",{id:"DMUDragThumbnailCount",class:"DMUDragThumbnailCount",text:T.length}).inject(P),P.setStyle("transform",`translate(${l.x}px, ${l.y}px)`),document.body.appendChild(P),U=!0,t.onSlidesDragStart()}function O(){if(h){let e=document.querySelector(".DMUSlidePanelThumbMainContainer");e&&(e.removeEventListener("touchstart",V),e.removeEventListener("touchmove",V)),r.removeEvent(h,"onPrimaryPointerMoveUnique",H),r.removeEvent(h,"onPrimaryPointerUpUnique",O),h=null}if(B=!1,b=null,T.length){for(document.removeEventListener("keydown",_),document.removeEventListener("keyup",_),document.body.contains(P)&&document.body.removeChild(P),P.setStyles({transform:""});P.children.length;)P.removeChild(P.firstElementChild);if(T.forEach((function(e){let t=e.getContent();t.setStyle("display",""),t.remove()})),d){let e;y?(e=y.getChildIndex(d),T.forEach((function(t,n){y.addChild(t.getContent(),(I?e:e+1)+n)}))):(e=Array.prototype.indexOf.call(D.children,d),T.forEach((function(t,n){let i=t.getContent();I?D.insertBefore(i,d):D.insertBefore(i,D.children[e+n+1])}))),M.sort((function(e,t){let n,i;return y?(n=y.getChildIndex(e.getContent()),i=y.getChildIndex(t.getContent())):(n=Array.prototype.indexOf.call(D.children,e.getContent()),i=Array.prototype.indexOf.call(D.children,t.getContent())),n<i?-1:n>i?1:0})),t.onSlidesDragEnd({orderedSlideIDs:M.flatMap((function(e){return[e.getID(),...e.getReplies().map((e=>e.getID()))]}))}),d.addClassName("noTransition"),d.setStyles({"padding-top":"","padding-bottom":""}),window.requestAnimationFrame((function(){d&&(d.removeClassName("noTransition"),d=null)}))}else M.forEach((function(e,t){let n=e.getContent();if(y&&-1===y.getChildIndex(n))if(M[t-1]){let e=y.getChildIndex(M[t-1].getContent());y.addChild(n,e+1)}else y.addChild(n,0);else y||!D||D.contains(n)||(M[t-1]?D.insertBefore(n,M[t-1].getContent().nextSibling):D.insertBefore(n,D.children[1]))})),t.onSlidesDragEnd({});T.length=0,u=null}}function W(){if(!B)return;let e=document.querySelector(".DMUSlidePanelSectionMainDiv"),t=e.getSize().height?e.getSize().height:850;R>=.75*t?b.scrollTo(0,b.scrollTop+j):b.scrollTo(0,b.scrollTop-j),window.requestAnimationFrame((function(){W()}))}function V(e){e.preventDefault()}function H(e){if(c&&"begin"!==e.state)return;let n=e.from[0].event;if(C&&n.shiftKey||!C&&!n.shiftKey)return;let i=n.composedPath();if("begin"===e.state)L(e);else if(i&&i.includes(D)){if(!T.length)return;U&&(U=!1,P.getChildren().forEach((function(e,t,n){let i=2*(n.length-t-1);e.style.left=i+u.x+"px",e.style.top=i+u.y+"px"})),h&&t.onSlidesDragStart({isTouch:s.getTouchMode()}));let n=e.from[0].getCurrentPosition(document.body);if(P.setStyle("transform",`translate(${n.x}px, ${n.y}px)`),!window.__karma__){let e=document.querySelector(".DMUSlidePanelSectionMainDiv"),t=e.getSize().height?e.getSize().height:850;.75*t<=n.y||n.y<=.25*t?(R=n.y,B||(B=!0,window.requestAnimationFrame(W))):B=!1}let i=document.elementFromPoint(n.x,n.y),o=i&&i.hasClassName&&i.getParent?i.hasClassName("DMUSlideAndReplyMainDiv")?i:i.getParent(".DMUSlideAndReplyMainDiv"):null;if(o){let e=P.firstElementChild.offsetHeight;o.firstElementChild.getPosition(document.body,{y:"center"}).y>=n.y?d===o&&I||(d&&d.setStyles({"padding-top":"","padding-bottom":""}),d=o,d.setStyles({"padding-top":e+"px"}),I=!0):(d!==o||I)&&(d&&d.setStyles({"padding-top":"","padding-bottom":""}),d=o,d.setStyles({"padding-bottom":e+"px"}),I=!1)}else d&&(d.setStyles({"padding-top":"","padding-bottom":""}),d=null)}"end"===e.state&&O()}function q(e){C&&(h=e.gesture.view[0],L(e),r.addEvent(h,"onPrimaryPointerMoveUnique",H),r.addEvent(h,"onPrimaryPointerUpUnique",O))}if(this.enableDefaultReorder=function(e){C=e},n.displayInExpanders)n.noSlideDiv=x,y=new v(n),D=y.getContent();else if(D=e.createElement("div",{class:"DMUSlidePanelMarkupDiv DMUBrowserThumbsMainContainer"}),S=e.createElement("div",{class:"DMUBrowserThumbsTitleDiv"}).inject(D),o=e.createElement("div",{class:"DMUBrowserSectionShadingCol"}).inject(S),n.icon&&(l=e.createElement("img",{class:"DMUBrowserThumbsIcon",src:n.icon}).inject(S)),a=e.createElement("p",{class:"DMUBrowserThumbsTitle"}).inject(S),n.name||S.setStyle("display","none"),a.textContent=n.name,n.children&&n.children.length)for(let e=0;e<n.children.length;e++){M.push(n.children[e]);let t=M[e].getContent();i||!A||F||(s.getTouchMode()?r.addEvent(t,"onMediumHold",q):r.addEvent(t,"onPrimaryPointerDownUnique",z)),t.inject(D)}else x.inject(D);function z(e){let t=0,n=0;if(n=window&&window.__karma__?1:4,e.from[0].event.shiftKey&&!C||!e.from[0].event.shiftKey&&C){let i=!1,o=r.addEvent(e.from[0].view.getClosest(".DMUSlidePanelThumbMainContainer"),"onMouseMove",(e=>{t++,t<n||(i?H(e):(L(e),i=!0))})),a=r.addEvent(document.body,"onPrimaryPointerUpUnique",(()=>{r.removeEventFromToken(a),r.removeEventFromToken(o),i&&(O(),i=!1),t=0}))}}this.refreshNoSlideDiv=function(){for(;x.firstChild;)x.firstChild.destroy();let n;if(i||F)n=e.createElement("div",{class:"DMUBrowserNoElementsTitleTextDiv"}).inject(x),n.innerText=f||p.noSlidesTitle;else{new m({displayStyle:"icon",label:g||p.createSlideTitle,icon:{iconName:"plus",fontIconFamily:WUXManagedFontIcons.Font3DS}}).inject(x).addEventListener("buttonclick",t.onNewSlideCreated)}},this.setReadOnlyFlag=function(e){if(i!==e){i=e,k.setAllowSlideReorderFlag(n.allowSlideReorder&&!i&&!F),k.refreshNoSlideDiv(),y&&y.setCtxMenuVisibility(!i);for(let e=0;e<M.length;e++)M[e].setReadOnlyFlag(i)}},this.setAllowSlideReorderFlag=function(e){A!==e&&(A=e&&!i&&!F,M.forEach((function(e){A?s.getTouchMode()?r.addEvent(e.getContent(),"onMediumHold",q):(r.addEvent(e.getContent(),"onPrimaryPointerDownUnique",z),e.getContent().addEventListener("drop",N)):s.getTouchMode()?r.removeEvent(e.getContent(),"onMediumHold",q):(r.removeEvent(e.getContent(),"onPrimaryPointerDownUnique",z),e.getContent().removeEventListener("drop",N))})))},this.setExpandedFlag=function(e){y&&y.expandedFlag!==e&&(e?y.expand():y.close())};let X=!1;this.startTitleEdition=function(){if(y&&!i){let t=y.elements.header.children;for(let e=0;e<t.length;e++)t[e].style.display="none";let i=e.createElement("p",{class:"DMUMarkupEditableDiv",contenteditable:!0}).inject(y.elements.header);i.innerText=n.name,window.getSelection().removeAllRanges();let o=document.createRange();o.selectNodeContents(i),window.getSelection().addRange(o),i.focus(),X=!0;let a=function(e){if(X){X=!1,y.elements.header.removeChild(i);for(let e=0;e<t.length;e++)t[e].style.display="";e||(n.name=i.innerText,y.setTitle(i.innerText),n.onMarkupRenamed(i.innerText))}};i.addEventListener("keyup",(function(e){e.stopPropagation()})),i.addEventListener("click",(function(e){e.stopPropagation()})),i.addEventListener("keydown",(function(e){"Enter"!==e.key&&13!==e.keyCode&&"Escape"!==e.key&&27!==e.keyCode||a("Escape"===e.key||27===e.keyCode)})),i.addEventListener("blur",a)}},this.getExpandedFlag=function(){return Boolean(y&&y.expandedFlag)},this.getExpanderHeader=function(){return y?y.elements.header:null},this.getContent=function(){return D},this.addChild=function(e,t){null!=t&&t<M.length?M.splice(t,0,e):M.push(e);let n,o=e.getContent().getElementsByClassName("CATWebUXThumbnailSubContainer");if(o&&o.length&&(n=o[0]),i||F||!A||(s.getTouchMode()?r.addEvent(e.getContent(),"onMediumHold",q):(r.addEvent(n,"onPrimaryPointerDownUnique",z),n.addEventListener("drop",N))),y){let n;if(t>0){n=0;for(let e=0;e<t;e++)M[e]&&(n+=1,n+=M[e].getReplies().length)}y.addChild(e.getContent(),n),y.icon=void 0,y.setNoDiv(null)}else D.contains(x)&&D.removeChild(x),null!=t?D.insertBefore(e.getContent(),D.children[t+1]):e.getContent().inject(D),l&&(S.removeChild(l),l=null,a&&a.setStyles({"margin-left":"25px"}));e.setReadOnlyFlag(i)},this.removeChild=function(e){let t=M.indexOf(e);-1!==t&&(s.getTouchMode()?r.removeEvent(e.getContent(),"onMediumHold",q):(r.removeEvent(e.getContent(),"onPrimaryPointerDownUnique",z),e.getContent().removeEventListener("drop",N)),y?y.removeChild(e.getContent()):D.removeChild(e.getContent()),e.clear(),M.splice(t,1),M.length||(y?y.setNoDiv(x):x.inject(D)))},this.removeChildren=function(){for(let e=M.length-1;e>=0;e--)k.removeChild(M[e])},this.updateShadingColor=function(){let e,t=!1;if(M&&M.length){for(t=!0,e=0;e<M.length;e++)if(!M[e].getDisplayFlag()){t=!1;break}if(t)for(e=0;e<M.length;e++)M[e].setDisplayFlag(!0,!0)}k.setShadingColor(t)},this.setShadingColor=function(e){y?y.setShadingColor(e):o&&o.setStyles({"background-color":e?"rgb(87, 184, 71)":"",top:"5px",left:"3px"})},this.setActiveMarkup=function(e){if(y&&y.setActiveMarkup(e),E=e,M)for(let e=0;e<M.length;e++)M[e].setReplyButtonActiveFlag(!n.readOnly&&E)},this.isActiveMarkup=function(){return E},this.setTitle=function(e){y&&y.setTitle(e)},this.clear=function(){for(let e=M.length-1;e>=0;e--)k.removeChild(M[e]);M.length=0,y&&y.clear(),y=null};let G=[];this.addReply=function(e){G.push(e),y&&y.addReply(e)},this.removeReply=function(e){if(y&&e&&e.id)for(let t=G.length-1;t>=0;t--)G[t].getThumbnailID()===e.id&&(y.removeReply(G[t]),G.splice(t,1))},this.removeReplies=function(e){if(y&&e&&e.replyID)for(let t=G.length-1;t>=0;t--)G[t].getParentID()===e.replyID&&(y.removeReply(G[t]),G.splice(t,1))},this.setReplySectionExpandedFlag=function(e){y&&y.setReplySectionExpandedFlag(e)},this.updateRepliesShadingColor=function(){let e,t=!1;if(G&&G.length){for(t=!0,e=0;e<G.length;e++)if(!G[e].getDisplayFlag()){t=!1;break}if(t)for(e=0;e<G.length;e++)G[e].setDisplayFlag(!0,!0)}},this.getReplies=function(){return G},this.setReadOnlyFlag(Boolean(n.readOnly)),this.updateShadingColor(),this.refreshNoSlideDiv(),y?y.setNoDiv(x):x.inject(D)}}),b=o.extend({init:function(t){this._parent(t);let n,i,o,a,l=this,s=[],d=e.createElement("div",{class:"DMUSlideAndReplyMainDiv"}),c=!1,u="single",h=t.userName,m=t.showReplyButton,g=!0,f=!1===t.webMarkup,v=!0===t.readOnly;function w(){if(s.length){let e=0;for(let t=0;t<s.length;t++)e++,s[t].setThumbnailPrefix(l.getThumbnailPrefix()+e.toString()+".")}}function b(){let e,t="DMUReplySingleColRepLink"+(h?"_WithUserCred":""),i="DMUReplyMultiColRepLink"+(h?"_WithUserCred":""),o="DMUReplyMultiColAfterLink"+(h?"_WithUserCred":"");for(let n=s.length-1;n>=0;n--)e=s[n].getContent(),"multi"===u?(e.hasClassName("DMUReplySingleColRep")&&e.removeClassName("DMUReplySingleColRep"),e.hasClassName(t)&&e.removeClassName(t),e.hasClassName("DMUReplyMultiColRep")||e.addClassName("DMUReplyMultiColRep"),e.hasClassName(i)||e.addClassName(i),n<s.length-1&&!e.hasClassName(o)?e.addClassName(o):n===s.length-1&&e.hasClassName(o)&&e.removeClassName(o)):"single"===u&&(e.hasClassName("DMUReplyMultiColRep")&&e.removeClassName("DMUReplyMultiColRep"),e.hasClassName(i)&&e.removeClassName(i),e.hasClassName(o)&&e.removeClassName(o),e.hasClassName("DMUReplySingleColRep")||e.addClassName("DMUReplySingleColRep"),n<s.length-1&&!e.hasClassName(t)?e.addClassName(t):n===s.length-1&&e.hasClassName(t)&&e.removeClassName(t));n&&n.setStyles({"text-align":"single"===u?"left":"right"})}let y=this.getContent;this.getContent=function(){return d},this.getDate=function(){return t.creationDate},this.updateReplyButtonVisibility=function(){l.setReplyButtonVisibility(!v&&m&&g&&(!t.isReply||t.isReply&&!f)),s&&s.forEach((e=>{e.updateReplyButtonVisibility()}))};let D=this.setThumbnailPrefix;this.setThumbnailPrefix=function(e){D(e),w()};let S=this.setThumbnailActiveFlag;function x(){let e="DMUSlideWithReplies"+(h?"_WithUserCred":"");"single"!==u&&c&&s.length?y().hasClassName(e)||y().addClassName(e):y().hasClassName(e)&&y().removeClassName(e)}function E(){s&&s.length&&s.sort((function(e,t){return e.getDate()-t.getDate()}))}this.setThumbnailActiveFlag=function(e){S(e),s&&s.forEach((t=>{t.setThumbnailActiveFlag(e)}))};let k=this.setReadOnlyFlag;this.setReadOnlyFlag=function(e){if(k(e||f),v=e,l.setCtxMenuAvailability(!v&&!f),l.setIsCheckableFlag(!v&&!f),l.updateReplyButtonVisibility(),s)for(let t=0;t<s.length;t++)s[t].setReadOnlyFlag(e)},this.allowReply=function(e){m=e,l.updateReplyButtonVisibility()},this.setReplyButtonActiveFlag=function(e){g=e,l.updateReplyButtonVisibility()};let M=this.setVisibleFlag;this.setVisibleFlag=function(e){M(e),d.setStyles({display:e?"":"none"});for(let t=0;t<s.length;t++)s[t].setVisibleFlag(e)},this.getID=function(){return t.id},this.getParentID=function(){return t.parentID},this.setReplySectionExpandedFlag=function(e){if(c!==e){c=e;for(let e=s.length-1;e>=0;e--)s[e].setVisibleFlag(c);i.setText(c?p.hideRepliesLabel:p.showRepliesLabel),c?(o.hasClassName("wux-ui-3ds-expand-right")&&o.removeClassName("wux-ui-3ds-expand-right"),o.addClassName("wux-ui-3ds-expand-down")):(o.hasClassName("wux-ui-3ds-expand-down")&&o.removeClassName("wux-ui-3ds-expand-down"),o.addClassName("wux-ui-3ds-expand-right")),x()}},this.getReplySectionExpandedFlag=function(){return c},this.addReply=function(u){s.push(u),t.markedAsDeleted&&u.allowReply(!1),1!==s.length||n||(n=e.createElement("div",{class:"DMUReplySubSectionHeaderDiv"}).inject(d),o=e.createElement("div",{class:"DMUReplySubSectionArrow wux-ui-3ds wux-ui-3ds-expand-right"}).inject(n),i=e.createElement("p",{class:"DMUReplySubSectionHeaderText"}).inject(n),i.setText(p.showRepliesLabel),a=r.addEvent(n,"onPrimaryPointerClick",(function(){l.setReplySectionExpandedFlag(!c)})));let h=s.length>1?s[s.length-2].getContent():d;h.nextSibling?d.parentNode.insertBefore(u.getContent(),h.nextSibling):d.parentNode.appendChild(u.getContent()),u.setVisibleFlag(c),E(),b(),x(),w()},this.removeReplies=function(e){if(e&&e.replyID){for(let t=s.length-1;t>=0;t--)s[t].getParentID()===e.replyID&&(s[t].getContent().parentNode.removeChild(s[t].getContent()),s[t].clear(),s.splice(t,1));s.length||(a&&r.removeEventFromToken(a),n&&d.removeChild(n),n=null,c=!1),E(),x(),w()}},this.updateCreationDates=function(){t.creationDate&&l.updateUserCredentials({date:e.String.parseRelativeTime(t.creationDate.toString())}),s&&s.length&&s.forEach((e=>{e.updateCreationDates()}))},this.removeReply=function(e){if(e&&e.id)for(let t=s.length-1;t>=0;t--)if(s[t].getThumbnailID()===e.id)return s[t].getContent().parentNode.removeChild(s[t].getContent()),s[t].clear(),s.splice(t,1),s.length||(a&&r.removeEventFromToken(a),d.removeChild(n),n=null,c=!1),E(),x(),w(),!0},this.updateRepliesShadingColor=function(){let e,t=!1;if(s&&s.length){for(t=!0,e=0;e<s.length;e++)if(!s[e].getDisplayFlag()){t=!1;break}if(t)for(e=0;e<s.length;e++)s[e].setDisplayFlag(!0,!0)}},this.updateRepliesPosition=function(){for(let e=s.length-1;e>=0;e--){let t=s[e];t.getContent().remove(),d.nextSibling?d.parentElement.insertBefore(t.getContent(),d.nextSibling):d.parentElement.appendChild(t.getContent())}w()};let P=this.setTitleAndIconSectionVisibleFlag;this.setTitleAndIconSectionVisibleFlag=function(e){P(e),s.forEach((t=>{t.setTitleAndIconSectionVisibleFlag(e)}))},this.getReply=function(e){if(e&&e.id)for(let t=s.length-1;t>=0;t--)if(s[t].getThumbnailID()===e.id)return{reply:s[t],parent:l};return!1},this.getReplies=function(){return s},this.updateReply=function(e){if(e&&e.id&&e.info)for(let n=s.length-1;n>=0;n--)if(s[n].getThumbnailID()===e.id&&(e.info.name&&s[n].setThumbnailTexts({title:e.info.name}),e.info.img&&s[n].setPreview(e.info.img),void 0!==e.info.titleEditionAllowed&&s[n].allowTitleEdition(e.info.titleEditionAllowed),void 0!==e.info.checkFlag&&s[n].setCheckFlag(e.info.checkFlag,null,!1),"isPreview"in e.info&&(e.info.isPreview?s[n].addInformationIcon({id:"favoriteSlide",fontIcon:"wux-ui-3ds-favorite-on"}):s[n].removeInformationIcon("favoriteSlide")),"highlights"in e.info))if(e.info.highlights){let i={id:"",rating:"0"};e.info.highlights.forEach((e=>{(5===parseInt(e.rating)?0:parseInt(e.rating))>=(5===parseInt(i.rating)?0:parseInt(i.rating))&&(i=e)})),s[n].addInformationIcon({id:"highlightData",fontIcon:C[i.rating].icon,color:C[i.rating].color,onClick:function(){t.onInformationIconClickCB({replyId:e.id,highlightId:i.id})}}),s[n].hideReplyButton(!0)}else s[n].removeInformationIcon("highlightData"),s[n].hideReplyButton(!1)},this.clear=function(){for(let e=s.length-1;e>=0;e--)s[e].getContent().parentNode.removeChild(s[e].getContent()),s[e].clear(),s.splice(e,1);a&&r.removeEventFromToken(a)},this.setReplyRepresentation=function(e){u!==e&&(u=e,b(),x())},d.appendChild(y()),l.updateCreationDates(),l.allowReply(m),l.setReadOnlyFlag(Boolean(v))}});return t.extend({init:function(t){this._parent(t);let o,l,c,u,h,m,v,y,D,S,x,E,k=t||{},M=this,P=[],I=[],U=[],T=!1,A=!1,F=!!k.allowReplies&&k.allowReplies,B=!!k.allowSlideReorder&&k.allowSlideReorder,R=!!k.allowMarkupReorder&&k.allowMarkupReorder,j=!1,_=new i,N=-1,L=[],O=[],W=!1,V=e.createElement("div",{id:"DMUDraggableExpanderDiv",class:"DMUDraggableThumbnailDiv"});function H(e,t){return _.publish({event:e,data:t,context:M})}function q(){let e;for(let t=0;t<P.length;t++){if(P[t].markupSlides)for(e=0;e<P[t].markupSlides.length;e++)j?P[t].markupSlides[e].setVisibleFlag(-1!==U.indexOf(P[t].markupSlides[e].getThumbnailID())):P[t].markupSlides[e].setVisibleFlag(!0);if(P[t].section.view&&P[t].section.view.getReplies()){let n=P[t].section.view.getReplies();for(e=n.length-1;e>=0;e--)j?n[e].setVisibleFlag(-1!==U.indexOf(n[e].getThumbnailID())):n[e].setVisibleFlag(!0)}}}function z(e){let t;for(let n=0;n<P.length;n++){if(P[n].markupSlides)for(t=0;t<P[n].markupSlides.length;t++)if(P[n].markupSlides[t]){if(P[n].markupSlides[t].getThumbnailID()===e)return{section:P[n].section,thumbnail:P[n].markupSlides[t]};let i=P[n].markupSlides[t].getReply({id:e});if(i&&i.reply)return{section:P[n].section,thumbnail:i.reply,parent:i.parent}}if(P[n].section.view&&P[n].section.view.getReplies()){let i=P[n].section.view.getReplies();for(t=i.length-1;t>=0;t--)if(i[t].getThumbnailID()===e)return{section:P[n].section,thumbnail:i[t],parent:P[n].section.view}}}}function X(){let e,t=0;for(let n=0;n<P.length;n++){if(P[n].markupSlides)for(e=0;e<P[n].markupSlides.length;e++)P[n].markupSlides[e]&&(t++,P[n].markupSlides[e].setThumbnailPrefix(t.toString()+"."));if(P[n].section.view&&P[n].section.view.getReplies()){let i=P[n].section.view.getReplies();for(e=0;e<i.length;e++)t++,i[e].setThumbnailPrefix(t.toString()+".")}}}function G(e){H("onSlidePreselected",e)}function Z(e){c.closeContextualSectionHeader();let t,n,i=e.isFromCheck?e.event.shiftKey:e.event.from[0].event.shiftKey,o=e.isFromCheck?!i:e.event.from[0].event.ctrlKey,a=e.id,l=0,s=null,r=0;for(t=0;t<P.length;t++)if(P[t].section){if(P[t].markupSlides)for(n=0;n<P[t].markupSlides.length;n++){if(P[t].markupSlides[n].getThumbnailID()===a){s=P[t].markupSlides[n];break}l++}if(P[t].section.view&&P[t].section.view.getReplies()){let e=P[t].section.view.getReplies();for(n=e.length-1;n>=0;n--){if(e[n].getThumbnailID()===a){s=e[n];break}l++}}if(s)break}if(T||!i&&!o)N=l,H("onSlideDisplayed",e);else{if(!s)return;if(i||(N=l),o)H("onSlideSelected",{id:a,checkFlag:e.isFromCheck?s.isChecked():!s.isChecked()});else if(i)if(-1===N)H("onSlideSelected",{id:a,checkFlag:e.isFromCheck?s.isChecked():!s.isChecked()}),N=l;else if(N===l)for(r=0,t=0;t<P.length;t++){if(P[t].section&&P[t].markupSlides)for(n=0;n<P[t].markupSlides.length;n++)H("onSlideSelected",{id:P[t].markupSlides[n].getThumbnailID(),checkFlag:r===l}),r++;if(P[t].section.view&&P[t].section.view.getReplies()){let e=P[t].section.view.getReplies();for(n=e.length-1;n>=0;n--)H("onSlideSelected",{id:e[n].getThumbnailID(),checkFlag:r===l}),r++}}else{let e=l>N?N:l,i=l>N?l:N;for(r=0,t=0;t<P.length;t++)if(P[t].section){if(P[t].markupSlides)for(n=0;n<P[t].markupSlides.length;n++)r<e||r>i?H("onSlideSelected",{id:P[t].markupSlides[n].getThumbnailID(),checkFlag:!1}):r>=e&&r<=i&&H("onSlideSelected",{id:P[t].markupSlides[n].getThumbnailID(),checkFlag:!0}),r++;if(P[t].section.view&&P[t].section.view.getReplies()){let o=P[t].section.view.getReplies();for(n=o.length-1;n>=0;n--)r<e||r>i?H("onSlideSelected",{id:o[n].getThumbnailID(),checkFlag:!1}):r>=e&&r<=i&&H("onSlideSelected",{id:o[n].getThumbnailID(),checkFlag:!0}),r++}}}}}function Y(e){H("onSlideNameChanged",e)}function K(e){e.event?Z({...e,isFromCheck:!0}):H("onSlideSelected",e)}function J(e){H("onSlideUpdateRequired",e)}function $(t,i,o){return new b({id:t.id,parentID:t.parentID,isReply:i,displayPrefix:!0,webMarkup:o,width:240,height:135,readOnly:T||!t.isEditable(),markedAsDeleted:t.markedAsDeleted,displayTitleAndIcon:"boolean"==typeof A&&A,icon:t.icon,title:t.title?t.title:"",subtitle:t.parentSlideName?t.parentSlideName:"",allowCtxMenu:!T,isCheckable:!T&&(!0===o||void 0===o),isFavorite:t.isPreview,enableDrag:v,preview:t.img,userName:i?t.userName:null,userColor:i?t.userColor:null,userPic:i?t.userPic:null,defaultUserPic:i?t.defaultUserPic:null,creationDate:i?t.date:null,date:i&&t.date?e.String.parseRelativeTime(t.date.toString()):null,onEnterCB:G,onLeaveCB:G,clickCB:Z,onTitleEditedCB:Y,checkFlagChangedCB:K,allowTitleEdition:t.titleEditionAllowed,onLabelContentClickCB:J,onCtxMenuCB:function(e){let t={id:e.id,openFromButton:e.openFromButton};t.shiftKeyPressed=e.event.shiftKey,t.ctrlKeyPressed=e.event.ctrlKey;let i=e.event,o=i.pageX?{x:i.pageX,y:i.pageY}:null;o||(o=i.screenX?{x:i.screenX,y:i.screenY}:null),!o&&i.type&&-1!==i.type.indexOf("touch")&&i.changedTouches&&i.changedTouches[0]&&(i=i.changedTouches[0],o=i.pageX?{x:i.pageX,y:i.pageY}:null,o||(o=i.screenX?{x:i.screenX,y:i.screenY}:null)),o||(o={x:0,y:0}),t.position=new n.Vector2(o.x,o.y),setTimeout((function(){H("onSlideCtxMenuRequired",t)}))},showReplyButton:F&&!T&&t.isEditable(),onReplyCB:function(e){H("onSlideReplyCreated",e)},onInformationIconClickCB:function({replyId:e,highlightId:t}){setTimeout((()=>{H("onSlideHighlightSelected",{slideId:e,highlightId:t})}),100)}})}function Q(e){"Escape"!==e.key&&27!==e.keyCode||(D&&(D.setStyles({"padding-top":"","padding-bottom":""}),D=null),S=!0,te())}function ee(e){S=!1;let t=e.gesture.view[0];if(m=P.find((function(e){return e.section.view.getExpanderHeader()===t})),!m)return;document.addEventListener("keydown",Q);let n=m.section.view.getContent(),i=n.getPosition(document.body);P.forEach((function(e){e.section.view.getExpandedFlag()&&(e.section.view.setExpandedFlag(!1),L.push(e.section.view))}));let o=n.cloneNode(!0);n.setStyle("display","none");let a=e.from[0].getCurrentPosition(document.body);o.style.opacity=.8,o.style.left=i.x-a.x+"px",o.style.top=i.y-a.y+"px",o.style.position="absolute",V.appendChild(o),V.setStyle("transform",`translate(${a.x}px, ${a.y}px)`),document.body.appendChild(V)}function te(){if(E&&(r.removeEvent(E,"onPrimaryPointerMoveUnique",ne),r.removeEvent(E,"onPrimaryPointerUpUnique",te),E=null),m){for(document.removeEventListener("keydown",Q),document.body.contains(V)&&document.body.removeChild(V),V.setStyles({transform:""});V.children.length;)V.removeChild(V.firstElementChild);if(m.section.view.getContent().setStyle("display",""),m.section.view.getContent().remove(),D){if(m.section.view.getContent()!==D){let e=Array.prototype.indexOf.call(h.children,D);e>=0&&(h.insertBefore(m.section.view.getContent(),h.children[W?e:e+1]),P.sort((function(e,t){let n,i;return n=Array.prototype.indexOf.call(h.children,e.section.view.getContent()),i=Array.prototype.indexOf.call(h.children,t.section.view.getContent()),n<i?-1:n>i?1:0})),X(),H("onMarkupReordered",{orderedMarkupIDs:P.map((function(e){return e.section.id}))}))}D.addClassName("noTransition"),D.setStyles({"padding-top":"","padding-bottom":""}),window.requestAnimationFrame((function(){D&&(D.removeClassName("noTransition"),D=null)}))}else P.forEach((function(e,t){let n=e.section.view.getContent();h.contains(n)||(P[t-1]?h.insertBefore(n,P[t-1].section.view.getContent().nextSibling):h.insertBefore(n,h.children[0]))}));m=null,window.requestAnimationFrame((()=>{L.forEach((function(e){e.setExpandedFlag(!0)})),L.length=0}))}}function ne(e){if(S&&"begin"!==e.state)return;let t=e.from[0].event.composedPath();if("begin"===e.state)ee(e);else if(t&&t.includes(h)){if(!m)return;let t=e.from[0].getCurrentPosition(document.body);V.setStyle("transform",`translate(${t.x}px, ${t.y}px)`);let n=document.elementFromPoint(t.x,t.y),i=n&&n.hasClassName&&n.getParent?n.hasClassName("wux-controls-expander")?n:n.getParent(".wux-controls-abstract.wux-controls-expander-placeholder.wux-controls-expander.DMUMarkupExpander"):null;if(i){let e=V.firstElementChild.offsetHeight;i.getPosition(document.body,{y:"center"}).y>=t.y?D===i&&W||(D&&D.setStyles({"padding-top":"","padding-bottom":""}),D=i,D.setStyles({"padding-top":e+"px"}),W=!0):(D!==i||W)&&(D&&D.setStyles({"padding-top":"","padding-bottom":""}),D=i,D.setStyles({"padding-bottom":e+"px"}),W=!1)}else D&&(D.setStyles({"padding-top":"","padding-bottom":""}),D=null)}"end"===e.state&&te()}function ie(e){E=e.gesture.view[0],ee(e),r.addEvent(E,"onPrimaryPointerMoveUnique",ne),r.addEvent(E,"onPrimaryPointerUpUnique",te)}function oe(e,t){for(let n=0;n<P.length;n++)P[n].section.view&&P[n].section.view.setActiveMarkup(e===P[n].section.view?t:!t)}this.buildPanel=function(t){M.cleanPanel(),o||(o=e.createElement("div",{id:"DMUSlidePanelThumbMainDiv"})),o.setStyles({height:"100%"});let n=e.createElement("div",{class:"DMUSlidePanelSectionMainDiv"}).inject(o);n.setStyles({height:"100%"}),t.noSlideLabel&&M.setNoSlideLabel(t.noSlideLabel),t.createSlideLabel&&M.setNoSlideLabel(t.createSlideLabel),c=new d({draggable:!0,onDragStart:function(){return m||""},sectionLabel:t.panelTitle?t.panelTitle:p.dmuPanelTitle,cmdList:t.contextualCmdList,quickAccessBtnList:t.quickAccessBtnList,doubleClickCB:function(){H("onTopBarDoubleClick")}}),n.appendChild(c.getContent());return h=e.createElement("div",{class:"DMUSlidePanelThumbMainContainer"}),l=(new a).inject(n),l.getInnerElement().setContent(h),l.getContent().setStyle("height","calc(100% - 40px)"),window&&window.__karma__||(x=setInterval((function(){let e;for(let t=0;t<P.length;t++){if(P[t].markupSlides)for(e=0;e<P[t].markupSlides.length;e++)P[t].markupSlides[e]&&P[t].markupSlides[e].updateCreationDates();if(P[t].section.view&&P[t].section.view.getReplies()){let n=P[t].section.view.getReplies();for(e=n.length-1;e>=0;e--)n[e].updateCreationDates()}}}),6e4)),o},this.cleanPanel=function(){if(o){for(let e=0;e<P.length;e++)P[e].section?P[e].section.view.clear():P[e].clear();for(U.length=0,x&&clearInterval(x),x=null;o.firstChild;)o.removeChild(o.firstChild);P.splice(0,P.length),c&&c.clear(),u&&u.clear(),l&&l.destroy(),c=u=l=P=o=null}},this.setNoSlideLabel=function(e){f=e;for(let e=0;e<P.length;e++)P[e].section&&P[e].section.view.refreshNoSlideDiv()},this.setCreateSlideLabel=function(e){g=e;for(let e=0;e<P.length;e++)P[e].section&&P[e].section.view.refreshNoSlideDiv()},this.setDragContent=function(e){m=e},this.setSlideDragContent=function(e){let t=!1;if(P.length)for(let n=0;n<P.length;n++){let i=P[n].markupSlides;if(i&&i.length){for(let n=0;n<i.length;n++)if(e.parentSlideId){let o=i[n].getReplies();if(o){for(let n=0;n<o.length;n++)if(e.id===o[n].getID()){o[n].setSlideViewTransferDragContent(e.data),o[n].setIsDraggable(!0),t=!0;break}if(t)break}}else if(e.id===i[n].getID()){i[n].setSlideViewTransferDragContent(e.data),i[n].setIsDraggable(!0),t=!0;break}if(t)break}}},this.enableDragContent=function(e){if(v!==e&&(v=e,P.length))for(let t=0;t<P.length;t++){P[t].section.view.enableDefaultReorder(!e);let n=P[t].markupSlides;if(n)for(let t=0;t<n.length;t++){n[t].enableDragContent(e);let i=n[t].getReplies();if(i)for(let t=0;t<i.length;t++)i[t].enableDragContent(e)}}},this.getColumnMinimumWidth=function(){return P&&P.length&&"default"!==P[0].section.id?273:267},this.getColumnWidthStep=function(){return 240},this.resizePanel=function(e){y="single";let t,n=M.getColumnMinimumWidth()-M.getColumnWidthStep();y=e.width-n>=2*M.getColumnWidthStep()?"multi":"single";for(let e=0;e<P.length;e++){if(P[e].markupSlides)for(t=0;t<P[e].markupSlides.length;t++)P[e].markupSlides[t]&&P[e].markupSlides[t].setReplyRepresentation(y);if(P[e].section.view&&P[e].section.view.getReplies()){let n=P[e].section.view.getReplies();for(t=n.length-1;t>=0;t--)n[t].setReplyRepresentation(y)}}},this.setPanelTitle=function(e){c&&c.setHeaderLabel(e)},this.switchFilterActivation=function(){j=!j,q()},this.getFilterActivationFlag=function(){return j},this.setListOfVisibleSlides=function(e){U=e&&e.length?e.slice():[],q()},this.allowReplies=function(e){if(F===e)return;let t;F=e;for(let e=0;e<P.length;e++)if(P[e].markupSlides)for(t=0;t<P[e].markupSlides.length;t++){if(P[e].markupSlides[t]){P[e].markupSlides[t].allowReply(F);let n=P[e].markupSlides[t].getReplies();if(n&&n.length)for(let e=0;e<n.length;e++)n[e].allowReply(F)}if(P[e].section.view&&P[e].section.view.getReplies()){let t=P[e].section.view.getReplies();for(let e=t.length-1;e>=0;e--)t[e].allowReply(F)}}},this.setAllowMarkupReorderFlag=function(e){if(R!==e){R=e;for(let e=0;e<P.length;e++)R&&!T?s.getTouchMode()?r.addEvent(P[e].section.view.getExpanderHeader(),"onMediumHold",ie):r.addEvent(P[e].section.view.getExpanderHeader(),"onDrag",ne):s.getTouchMode()?r.removeEvent(P[e].section.view.getExpanderHeader(),"onMediumHold",ie):r.removeEvent(P[e].section.view.getExpanderHeader(),"onDrag",ne)}},this.setAllowSlideReorderFlag=function(e){if(B!==e){B=e;for(let e=0;e<P.length;e++)P[e].section.view.setAllowSlideReorderFlag(B&&!T)}},this.resetSlideDisplayHistory=function(){let e,t;for(let n=0;n<P.length;n++)if(P[n].markupSlides)for(t=0;t<P[n].markupSlides.length;t++){if(P[n].markupSlides[t]){P[n].markupSlides[t].getDisplayFlag()&&(P[n].markupSlides[t].setDisplayFlag(!1),P[n].section.view&&P[n].section.view.updateShadingColor()),e=P[n].markupSlides[t].getReplies();for(let t=0;t<e.length;t++)e[t].getDisplayFlag()&&e[t].setDisplayFlag(!1)}if(P[n].section.view&&P[n].section.view.getReplies()){e=P[n].section.view.getReplies();for(let t=e.length-1;t>=0;t--)e[t].getDisplayFlag()&&e[t].setDisplayFlag(!1)}}},this.setReadOnlyFlag=function(e){N=-1,T=e,M.enableDragContent(e||v),c.closeContextualSectionHeader(),M.setAllowMarkupReorderFlag(k.allowMarkupReorder&&!T),M.setAllowSlideReorderFlag(k.allowSlideReorder&&!T);for(let e=0;e<P.length;e++)if(P[e].section&&P[e].section.view&&P[e].section.view.setReadOnlyFlag(T),P[e].markupSlides)for(let t=0;t<P[e].markupSlides.length;t++){if(P[e].markupSlides[t]){P[e].markupSlides[t].setReadOnlyFlag(T);let n=P[e].markupSlides[t].getReplies();for(let e=0;e<n.length;e++)n[e].setReadOnlyFlag(T)}if(P[e].section.view&&P[e].section.view.getReplies()){let t=P[e].section.view.getReplies();for(let e=t.length-1;e>=0;e--)t[e].setReadOnlyFlag(T)}}},this.setPanelSubMenuCommands=function(e){c.closeContextualSectionHeader(),c.setSubMenuCommands(e)},this.setPanelQuickAccessCommands=function(e){c.closeContextualSectionHeader(),c.setQuickAccessCommands(e)},this.setQuickAccessCommandActiveFlag=function(e,t){c.setQuickAccessCommandActiveFlag(e,t)};let ae=!0;function le(e){for(let t=P.length-1;t>=0;t--)if(P[t].section&&P[t].section.id===e)return e;for(let t=0;t<I.length;t++)if(I[t].id===e)return le(I[t].parentID)}this.getPanelActiveFlag=function(){return ae},this.setPanelActiveFlag=function(e){let t;e||M.removeSlideUpdateRequiredFlags(),ae=e,c.closeContextualSectionHeader(),c.setAdditionalCheckBoxActiveFlag(0,ae);for(let n=0;n<P.length;n++){if(P[n].markupSlides)for(t=0;t<P[n].markupSlides.length;t++)P[n].markupSlides[t]&&P[n].markupSlides[t].setThumbnailActiveFlag(e);if(P[n].section.view&&P[n].section.view.getReplies()){let i=P[n].section.view.getReplies();for(t=i.length-1;t>=0;t--)i[t].setThumbnailActiveFlag(e)}}},this.addMarkup=function(e){if(N=-1,c.closeContextualSectionHeader(),!e.id)return;let t=P.length,i=0;for(i=0;i<t;i++)if(P[i].section.id===e.id)return;let o={section:{name:e.title,id:e.id,webMarkup:e.webMarkup,view:new w({name:e.title,id:e.id,owner:e.owner,webMarkup:e.webMarkup,allowSlideReorder:B,displayInExpanders:"default"!==e.id,onNewSlideCreated:function(){H("onNewSlideCreated",e)},onSlidesDragStart:function(e){if(e)return H("onSlideDragStart",e);P.forEach((function(e){e!==o?e.section.view.getExpandedFlag()&&(e.section.view.setExpandedFlag(!1),L.push(e.section.view)):e.markupSlides.forEach((function(e){e.getReplySectionExpandedFlag()&&(e.setReplySectionExpandedFlag(!1),O.push(e))}))}))},onSlidesDragEnd:function(t){L.forEach((function(e){e.setExpandedFlag(!0)})),L.length=0,O.forEach((function(e){e.setReplySectionExpandedFlag(!0)})),O.length=0;let n=P.indexOf(o);n>=0&&(t&&t.orderedSlideIDs&&t.orderedSlideIDs.length?(t.orderedSlideIDs.forEach((function(e){let t=P[n].markupSlides.findIndex((t=>t.getID()===e));if(t>=0){let e=P[n].markupSlides.splice(t,1)[0];P[n].markupSlides.push(e)}})),X(),P[n].markupSlides.forEach((function(e){e.updateRepliesPosition()})),H("onSlideReordered",Object.assign(t,{markupID:e.id}))):P[n].markupSlides.forEach((function(e){e.updateRepliesPosition()})))},onMarkupRenamed:function(t){H("onMarkupRenamed",{id:e.id,title:t})},onMarkupCtxMenuCB:function(e){let t=e.event,i=t.pageX?{x:t.pageX,y:t.pageY}:null;i||(i=t.screenX?{x:t.screenX,y:t.screenY}:null),!i&&t.type&&-1!==t.type.indexOf("touch")&&t.changedTouches&&t.changedTouches[0]&&(t=t.changedTouches[0],i=t.pageX?{x:t.pageX,y:t.pageY}:null,i||(i=t.screenX?{x:t.screenX,y:t.screenY}:null)),i||(i={x:0,y:0}),H("onMarkupCtxMenuRequired",{id:e.id,position:new n.Vector2(i.x,i.y)})},readOnly:T})}};"default"!==e.id&&!T&&R&&(s.getTouchMode()?r.addEvent(o.section.view.getExpanderHeader(),"onMediumHold",ie):r.addEvent(o.section.view.getExpanderHeader(),"onDrag",ne)),P.push(o),P[0].section.view.title=e.title,P[0].section.view.id=e.id,o.section.view.enableDefaultReorder(!v),h.appendChild(P[t].section.view.getContent())},this.removeMarkup=function(e){let t;for(let n=P.length-1;n>=0;n--)if(P[n].section&&(P[n].section.id===e||P[n].section.parentID===e)){if(P[n].markupSlides)for(t=P[n].markupSlides.length-1;t>=0;t--)P[n].section.view.removeChild(P[n].markupSlides[t]);P[n].section.view.clear(),h.removeChild(P[n].section.view.getContent()),P.splice(n,1)}X()},this.updateMarkup=function(e,t){for(let n=P.length-1;n>=0;n--)if(P[n].section&&P[n].section.id===e)return void(t.name&&P[n].section.view.setTitle(t.name))},this.editMarkupName=function(e){let t;for(let n=P.length-1;n>=0;n--)if(P[n].section&&P[n].section.id===e){t=P[n].section.view;break}t&&t.startTitleEdition()},this.addReply=function(e){if(N=-1,c.closeContextualSectionHeader(),!e.id||!e.parentID)return;let t;for(t=0;t<I.length;t++)if(I[t].id===e.id)return;I.push(e)},this.removeReply=function(e){let t,n;for(n=I.length-1;n>=0;n--)if(I[n].id===e){t=I[n].parentID;break}if(t)for(n=P.length-1;n>=0;n--)if(P[n].section&&P[n].section.id===t){if(P[n].markupSlides)for(let t=P[n].markupSlides.length-1;t>=0;t--)P[n].markupSlides[t].removeReplies({replyID:e});P[n].section.view&&P[n].section.view.getReplies()&&P[n].section.view.removeReplies({replyID:e})}},this.addSlide=function(e){let t,n,i;if(N=-1,c.closeContextualSectionHeader(),P.length||M.addMarkup({id:"default"}),!e.parentID)for(t=0;t<P.length;t++){if(P[t].section.view&&P[t].section.view.isActiveMarkup()){e.parentID=P[t].section.id;break}t===P.length-1&&P[0].section.view&&(oe(P[0].section.view,!0),e.parentID=P[0].section.id)}for(t=0;t<P.length;t++)if(e.parentID===P[t].section.id){for(i=$(e,null,P[t].section.webMarkup),P[t].markupSlides?null!==e.index&&void 0!==e.index?P[t].markupSlides.splice(e.index,0,i):P[t].markupSlides.push(i):(P[t].section.view.removeChildren(),P[t].markupSlides=[i]),P[t].section.view.addChild(i,e.index),n=0;n<I.length;n++){if(le(I[n].parentID)===P[t].section.id&&I[n].pendingReplies&&I[n].pendingReplies.length)for(let e=I[n].pendingReplies.length-1;e>=0;e--){let o=!1,a=I[n].pendingReplies[e];a.parentSlideID?i.getID()===a.parentSlideID&&(i.addReply(a.thumbnail),o=!0):(P[t].section.view.addReply(a.thumbnail),o=!0),o&&I[n].pendingReplies.splice(e,1)}}break}if(!i){let o=le(e.parentID);for(t=0;t<I.length;t++)if(I[t].id===e.parentID){let a=!1;for(n=0;n<P.length;n++)if(o===P[n].section.id)if(e.parentSlideID){if(P[n].markupSlides)for(let o=0;o<P[n].markupSlides.length;o++)P[n].markupSlides[o].getID()===e.parentSlideID&&(i=$(e,!0,I[t].webMarkup),P[n].markupSlides[o].addReply(i),a=!0)}else e.parentSlideName=I[t].title,i=$(e,!0,I[t].webMarkup),P[n].section.view.addReply(i),a=!0;a||(I[t].pendingReplies||(I[t].pendingReplies=[]),e.parentSlideName=e.parentSlideID?"":I[t].title,i=$(e,!0,I[t].webMarkup),I[t].pendingReplies.push({thumbnail:i,parentSlideID:e.parentSlideID}));break}}X(),i&&i.setReplyRepresentation(y)},this.removeSlide=function(e){let t,n;for(N=-1,t=0;t<P.length;t++)if(P[t].section&&P[t].markupSlides&&P[t].markupSlides.length){for(n=0;n<P[t].markupSlides.length;n++){if(P[t].markupSlides[n].getThumbnailID()===e)return P[t].section.view.removeChild(P[t].markupSlides[n]),P[t].markupSlides[n].clear(),P[t].markupSlides.splice(n,1),void X();if(P[t].markupSlides[n].removeReply({id:e}))return}if(P[t].section.view.removeReply({id:e}))return}},this.updateSlide=function(e,t){let n=function(n){if(t.id&&n.setThumbnailID(t.id),t.name&&n.setThumbnailTexts({title:t.name}),t.img&&n.setPreview(t.img),void 0!==t.titleEditionAllowed&&n.allowTitleEdition(t.titleEditionAllowed),void 0!==t.checkFlag&&n.setCheckFlag(t.checkFlag,null,!0),"isPreview"in t&&(t.isPreview?n.addInformationIcon({id:"favoriteSlide",fontIcon:"wux-ui-3ds-favorite-on"}):n.removeInformationIcon("favoriteSlide")),"highlights"in t)if(t.highlights&&t.highlights.length){let i={id:"",rating:"0"};t.highlights.forEach((e=>{(5===parseInt(e.rating)?0:parseInt(e.rating))>=(5===parseInt(i.rating)?0:parseInt(i.rating))&&(i=e)})),n.addInformationIcon({id:"highlightData",fontIcon:C[i.rating].icon,color:C[i.rating].color,onClick:function(){setTimeout((()=>{H("onSlideHighlightSelected",{slideId:e,highlightId:i.id})}),100)}}),n.hideReplyButton(!0)}else n.removeInformationIcon("highlightData"),n.hideReplyButton(!1)};for(let i=0;i<P.length;i++)if(P[i].section){if(P[i].markupSlides)for(let o=0;o<P[i].markupSlides.length;o++){if(P[i].markupSlides[o].getThumbnailID()===e)return void n(P[i].markupSlides[o]);if(P[i].markupSlides[o].getReply({id:e}))return void P[i].markupSlides[o].updateReply({id:e,info:t})}if(P[i].section.view&&P[i].section.view.getReplies()){let t=P[i].section.view.getReplies();for(let i=0;i<t.length;i++)if(t[i].getThumbnailID()===e)return void n(t[i])}}},this.setActiveSlide=function(e,{recenter:t=!1}={}){c.closeContextualSectionHeader();let n=0,i=0,o=z(e);if(o){if(t&&l){let e=l.getInnerElement();if(e&&o.thumbnail){const t=o.thumbnail.getContent();if(t){let n=t.getPosition().y-e.offsetHeight/2+t.getSize().height/2;e.scrollTo({top:n,behavior:"smooth"})}}}if(T)for(o.thumbnail.getDisplayFlag()||(o.thumbnail.setDisplayFlag(!0),o.parent?o.parent.updateRepliesShadingColor():o.section.view&&o.section.view.updateShadingColor()),n=0;n<P.length;n++){if(P[n].markupSlides)for(i=0;i<P[n].markupSlides.length;i++)P[n].markupSlides[i].highlightThumbnail(P[n].markupSlides[i]===o.thumbnail);if(P[n].section.view&&P[n].section.view.getReplies()){let e=P[n].section.view.getReplies();for(i=0;i<e.length;i++)e[i].highlightThumbnail(e[i]===o.thumbnail)}}else for(n=0;n<P.length;n++){if(P[n].markupSlides)for(i=0;i<P[n].markupSlides.length;i++){P[n].markupSlides[i].setDisplayFlag(P[n].markupSlides[i]===o.thumbnail),P[n].markupSlides[i].highlightThumbnail(P[n].markupSlides[i]===o.thumbnail);let e=P[n].markupSlides[i].getReplies();for(let t=0;t<e.length;t++)e[t].setDisplayFlag(e[t]===o.thumbnail),e[t].highlightThumbnail(e[t]===o.thumbnail)}if(P[n].section.view&&P[n].section.view.getReplies()){let e=P[n].section.view.getReplies();for(i=0;i<e.length;i++)e[i].setDisplayFlag(e[i]===o.thumbnail),e[i].highlightThumbnail(e[i]===o.thumbnail)}}oe(o.section.view,!0),o.parent&&o.parent.setReplySectionExpandedFlag(!0)}else for(n=0;n<P.length;n++){if(P[n].markupSlides)for(i=0;i<P[n].markupSlides.length;i++)P[n].markupSlides[i].setDisplayFlag(P[n].markupSlides[i].getThumbnailID()===e),P[n].markupSlides[i].highlightThumbnail(P[n].markupSlides[i].getThumbnailID()===e);if(P[n].section.view&&P[n].section.view.getReplies()){let t=P[n].section.view.getReplies();for(i=0;i<t.length;i++)t[i].setDisplayFlag(t[i].getThumbnailID()===e),t[i].highlightThumbnail(t[i].getThumbnailID()===e)}}},this.setSlideTitleVisibleFlag=function(e){if(("boolean"==typeof e&&e)!==A){let t;A=e;for(let e=0;e<P.length;e++){if(P[e].markupSlides)for(t=0;t<P[e].markupSlides.length;t++)P[e].markupSlides[t]&&P[e].markupSlides[t].setTitleAndIconSectionVisibleFlag(A);if(P[e].section.view&&P[e].section.view.getReplies()){let n=P[e].section.view.getReplies();for(t=0;t<n.length;t++)n[t].setTitleAndIconSectionVisibleFlag(A)}}}},this.setSlideUpdateRequiredFlag=function(e,t){let n=z(e);n&&n.thumbnail&&n.thumbnail&&n.thumbnail.setThumbnailLabelClickableFlag(t,{title:p.updateSlideViewpoint,fontIcon:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-refresh"})},this.removeSlideUpdateRequiredFlags=function(){let e;for(let t=0;t<P.length;t++){if(P[t].markupSlides)for(e=0;e<P[t].markupSlides.length;e++)if(P[t].markupSlides[e]){P[t].markupSlides[e].setThumbnailLabelClickableFlag(!1);let n=P[t].markupSlides[e].getReplies();for(let e=0;e<n.length;e++)n[e].setThumbnailLabelClickableFlag(!1)}if(P[t].section.view&&P[t].section.view.getReplies()){let n=P[t].section.view.getReplies();for(e=0;e<n.length;e++)n[e].setThumbnailLabelClickableFlag(!1)}}},this.setInProgress=(e,t)=>{let n=z(e);n&&n.thumbnail&&n.thumbnail&&(t?n.thumbnail.displayProgress():n.thumbnail.hideProgress())},this.subscribe=function(e,t){if(e&&t)return _.subscribe({event:e},t)},this.unsubscribe=function(e){null!=e&&_.unsubscribe(e)}}})})),define("DS/DMUControls/DMUToolsSave",["require","exports","DS/CATWebUXComponents/CATWebUXNotification","DS/DMUControls/DMUInfoModalDiv","DS/Windows/Dialog","DS/Controls/Button","UWA/Core","i18n!DS/DMUControls/assets/nls/DMUControls","css!DS/DMUControls/DMUControls"],(function(e,t,n,i,o,a,l,s){"use strict";let r=new Map,d=null,c=null,u="success";return class{static clean(){r.forEach((e=>{clearTimeout(e)})),r.clear(),d&&(d.destroy(),d=null),c&&(c.destroy(),c=null)}static tryToSaveData({saveOperationId:e="default",frameWindow:t,saveFunction:h}){return new Promise(((m,p)=>{const g=r.get(e);g&&clearTimeout(g),d||(d=new i),d.display({frmWindow:t,type:"error"===u?"error":"save"}),r.set(e,setTimeout((async()=>{let g=r.get(e),f=()=>g!==r.get(e);try{if("error"===u)throw new Error;f()||await h()}catch(e){if(f())return p(e);d&&(d.destroy(),d.display({frmWindow:t,type:"error"}));try{if("error"===u)throw new Error;await h()}catch(e){if(f())return p(e);const r=e=>new Promise(((u,m)=>{c&&(c.destroy(),c=null),d||(d=new i),d.display({frmWindow:t,type:"error"}),h().then((()=>{if(e){(new n).build({body:t.getUIFrame(),autoHide:!0,type:"success",message:s.saveSucceeded})}u()})).catch((e=>{if(f())return m(e);if(d){d.destroy();const e=l.createElement("div",{class:"DMUToolsSaveDialog"});l.createElement("i",{class:"wux-ui-3ds wux-ui-3ds-error DMUToolsSaveDialog-icon"}).inject(e),l.createElement("span",{class:"DMUToolsSaveDialog-message",text:s.saveFailedMessage}).inject(e),c=new o({immersiveFrame:t.getImmersiveFrame(),title:s.saveFailed,content:e,modalFlag:!0,buttons:{Retry:new a({onClick:()=>{r(!0).then(u).catch(m)}}),Cancel:new a({onClick:function(){null==c||c.close()}})}}),c.addEventListener("close",(()=>{null==c||c.destroy(),c=null,m(new Error("Last attempt save failed"))}))}}))}));try{await r()}catch(e){return null==d||d.destroy(),d=null,window.console.warn(e),u="error",p(new Error("Save failed"))}}}null==d||d.destroy(),d=null,u="success",m()}),750))}))}}})),define("DS/DMUControls/DMUAddMembersPanel",["UWA/Class","DS/Windows/Dialog","DS/Controls/Button","DS/DMUControls/DMUAddMembersCommonComponent","i18n!DS/DMUControls/assets/nls/DMUControls","css!DS/DMUControls/DMUControls.css"],(function(e,t,n,i,o){"use strict";return e.extend({init:function(e){var a;this._parent(e),this.buildAdditionPanel=function(a){let l=new i;l.buildAdditionDiv({getMembers:a.getMembers,searchMember:a.searchMember,additionalMembersInfo:a.additionalMembersInfo,valCoordinators:a.valCoordinators,valAssignees:a.valAssignees,valContributors:a.valContributors,valInformedUsers:a.valInformedUsers});var s=new t({modalFlag:!0,ensureHeightDefinitionOnHierarchy:!0,title:o.membersAdditionPanel.panelTitle,content:l.globalDiv,resizableFlag:!1,activateButtonsIfActionPerformed:!1,immersiveFrame:e.immersiveFrame,buttons:{Ok:new n({emphasize:"primary",label:o.membersAdditionPanel.addMemberButton,disabled:!0}),Cancel:new n({label:o.membersAdditionPanel.cancelMemberButton,onClick:function(){s.destroy()}})}});s.getContent().ondrop=function(e){e.preventDefault(),e.stopPropagation()},s.getContent().ondragenter=function(e){e.preventDefault(),e.stopPropagation()},s.getContent().ondragover=function(e){e.preventDefault(),e.stopPropagation()},s.getContent().ondragend=function(e){e.preventDefault(),e.stopPropagation()},s.width=450,l.assigneesAutoComplete.addEventListener("change",(function(){s.enableAddButton()})),l.coordinatorsAutoComplete.addEventListener("change",(function(){s.enableAddButton()})),l.contributorsAutoComplete.addEventListener("change",(function(){s.enableAddButton()})),l.informedUsersAutoComplete.addEventListener("change",(function(){s.enableAddButton()})),s.enableAddButton=function(){var e=l.assigneesAutoComplete.selectedItems?l.assigneesAutoComplete.selectedItems.length:0,t=l.coordinatorsAutoComplete.selectedItems?l.coordinatorsAutoComplete.selectedItems.length:0,n=l.contributorsAutoComplete.selectedItems?l.contributorsAutoComplete.selectedItems.length:0,i=l.informedUsersAutoComplete.selectedItems?l.informedUsersAutoComplete.selectedItems.length:0;s.buttons.Ok.disabled=!(e>0||t>0||n>0||i>0)};s.buttons.Ok.addEventListener("buttonclick",(function(){var e=[],t=[],n=[],i=[],o=null,r=null;if(void 0!==l.coordinatorsAutoComplete.selectedItems)for(r=0;r<l.coordinatorsAutoComplete.selectedItems.length;r++){let t=l.coordinatorsAutoComplete.selectedItems[r].options;o={user:t.identifier,type:t.type},e.push(o)}if(void 0!==l.assigneesAutoComplete.selectedItems)for(r=0;r<l.assigneesAutoComplete.selectedItems.length;r++){let e=l.assigneesAutoComplete.selectedItems[r].options;o={user:e.identifier,type:e.type},t.push(o)}if(void 0!==l.contributorsAutoComplete.selectedItems)for(r=0;r<l.contributorsAutoComplete.selectedItems.length;r++){let e=l.contributorsAutoComplete.selectedItems[r].options;o={user:e.identifier,type:e.type},n.push(o)}if(void 0!==l.informedUsersAutoComplete.selectedItems)for(r=0;r<l.informedUsersAutoComplete.selectedItems.length;r++){let e=l.informedUsersAutoComplete.selectedItems[r].options;o={user:e.identifier,type:e.type},i.push(o)}(e.length>0||t.length>0||n.length>0||i.length>0)&&(l.coordinatorsAutoComplete.selectedItems=l.assigneesAutoComplete.selectedItems=l.contributorsAutoComplete.selectedItems=l.informedUsersAutoComplete.selectedItems=void 0,function(e,t,n,i){const o={coordinatorsTab:e,assigneesTab:t,contributorsTab:n,informedusersTab:i},l=Object.fromEntries(Object.entries(o).filter((([,e])=>e.length>0)).map((([e,t])=>[e.replace("Tab",""),{add:t}])));a.saveMembers(l)}(e,t,n,i)),s.destroy()}))},this.cleanPanel=function(){if(a){for(;a.firstChild;)a.removeChild(a.firstChild);a=null}}}})})),define("DS/DMUControls/panels/DMUCommentsPanel",["require","exports","DS/Visualization/ThreeJS_DS","UWA/Controls/ThemedScroller","DS/CATWebUXComponents/CATWebUXSectionHeader","DS/VisuEvents/EventsManager","DS/Menu/ContextualMenu","DS/DMUBaseUIComponents/DMUComment","UWA/Core","DS/CoreEvents/ModelEvents","DS/DMUBaseUI/DMUToolsUsers","DS/Controls/ComboBox","DS/Controls/LineEditor","DS/DMUControls/DMUCommentFilterView","DS/Controls/Button","i18n!DS/DMUControls/assets/nls/DMUControls","css!DS/DMUControls/DMUControls.css"],(function(e,t,n,i,o,a,l,s,r,d,c,u,h,m,p,g){"use strict";const f={1:{icon:"wux-ui-3ds-attention",color:"#007DA3"},2:{icon:"wux-ui-3ds-level-low",color:"rgb(71,119,56)"},3:{icon:"wux-ui-3ds-level-medium",color:"rgb(232,123,0)"},4:{icon:"wux-ui-3ds-level-high",color:"rgb(234,79,55)"},5:{icon:"wux-ui-3ds-check",color:"rgb(71, 119, 56)"},6:{icon:"wux-ui-3ds-alert",color:"rgb(153, 7, 7)"}};class C{constructor(e){let t=[],n=r.createElement("div",{class:"DMUCommentsPanelMarkupCombo"}),i=r.createElement("div",{class:"DMUCommentsPanelMarkupCombo-user_color"}),o=r.createElement("div",{class:"DMUCommentsPanelMarkupCombo-label",text:g.commentsPanel.markup+":"}),s=r.createElement("div",{class:"DMUCommentsPanelMarkupCombo-combo"}),d=new u({enableSearchFlag:!1,placeholder:g.commentsPanel.noActiveMarkup,reachablePlaceholderFlag:!0});d.setProperties({getMainElementCustomization:function(){if(t&&t[d.selectedIndex])return{label:t[d.selectedIndex].name}}}),d.getContent().style.width="100%",s.appendChild(d.getContent());let m=r.createElement("div",{class:"DMUCommentsPanelMarkupCombo-ctx_menu"});m.appendChild(r.createElement("div",{class:"wux-ui-3ds wux-ui-3ds-lg wux-ui-3ds-menu-dot"}));let p=a.addEvent(m,"onPrimaryPointerClick",(function(t){e.onContextMenuRequested&&e.onContextMenuRequested({id:d.value,event:t.from[0].event})}));n.appendChild(o),n.appendChild(i),n.appendChild(s),n.appendChild(m);let f=l.addEventListener(n,{callback:t=>{e.onContextMenuRequested&&e.onContextMenuRequested({id:d.value,event:t.data.event})}});function C(){t&&d&&(t.length?m.setStyle("display",""):m.setStyle("display","none"),d.setProperties({elementsList:t.map((e=>({value:e.id,label:`${e.name} | ${e.ownerName||e.owner}`,description:e.ownerName||e.owner})))}))}d.addEventListener("change",(function(){d.value&&e.onCurrentMarkupChanged(d.value)})),this.addMarkup=e=>{if(!t||t.some((t=>t.id===e.id)))return;const n={id:e.id,name:e.name,owner:e.owner};n.owner&&c.getUserName(n.owner,void 0,(e=>{n.ownerName=e,C()})),t.push(n),C()},this.setVisibility=e=>{e?n.setStyle("display",""):n.setStyle("display","none")},this.startMarkupNameEdition=n=>{if(!t)return;const i=t.findIndex((e=>e.id===n));if(-1!==i){let o=new h({placeholder:"Markup Name",requiredFlag:!0,value:t[i].name});const a=e=>{e&&t&&t[i]&&(t[i].name=e,C()),requestAnimationFrame((()=>{o.removeEvents(),o.remove(),d.show()}))};d.hide(),o.inject(s),o.focus({}),o.addEventListener("change",(function(){e.onMarkupRenamed(n,o.value),a(o.value)})),o.addEventListener("blur",(function(){a()}))}},this.setCurrentMarkup=e=>{if(d&&t){if(e){const n=t.find((t=>t.id===e));if(n&&n.owner){const e=c.getUserColor(n.owner);e&&(i.style.backgroundColor=e.getStyle()),i.title=n.ownerName||n.owner}}else i.style.backgroundColor="#B4B6BA",i.title=g.commentsPanel.noActiveMarkup;d.value=e||void 0}},this.removeMarkup=n=>{if(!t)return;const i=t.findIndex((e=>e.id===n));-1!==i&&(t.splice(i,1),C(),t.length&&e.onCurrentMarkupChanged(t[i%t.length].id))},this.getContent=()=>n,this.remove=()=>{f&&l.removeEventListener(n,f),p&&a.removeEventFromToken(p),d.remove(),f=p=null,t=d=null}}}return class{constructor(){let e,t,a,l,u,h,v,w,b,y,D,S=this,x=!1,E=!1,k=!1,M=new Map,P=new Set,I=new Map,U=new d,T=[],A={},F=!0;function B(e){const t=e.match(/(\d+)/);return t?parseInt(t[1],10):void 0}function R({element:e,page:t,number:n,title:i}){if((null==e?void 0:e.group)&&(e=e.group),e&&e.id)return"number"==typeof e.index||e.id.includes("_")?"-"+e.id:"ErrorContainer";if(i){for(const[e,t]of I)if(t.view.title===i)return e;const e=B(i);if(void 0===e)return;const t=[];for(const[e,n]of I){const i=B(n.view.title);void 0!==i&&t.push({id:e,title:n.view.title,index:i})}t.sort(((e,t)=>e.index-t.index));for(const n of t)if(n.index>e)return n.id}return"-"+(n||(e?e.index:t||"externalComments"))}function j({element:e,page:t,containerId:n,notCreate:i}){if(n)return I.get(n);(null==e?void 0:e.group)&&(e=e.group);let o=R({element:e,page:t}),a=(e?e.index:t)||-1;if(!o)return;const l=I.get(o);if(l)return l;if(!i){let n=e?e.title:t?g.page+" "+t:g.commentsPanel.fileCommentsTitle,i={id:o,number:a,elemID:null==e?void 0:e.id,view:r.createElement("div",{id:`DMUCommentPanelContainer${o}`,text:n||"",class:"DMUCommentContainer",title:n}),commentIds:[]};return h.appendChild(i.view),I.set(o,i),S.sortContainers(),i}}function _(e,t){return U.publish({event:e,data:t,context:S})}function N(e){_("onCommentSelected",e)}function L(e){_("onCommentPreselected",e)}function O(e){if(e.target.isReply){const t=e.target.parentObject,n=M.get(t.getAttribute("sUuid"));n&&n.view.updateTimelineLength()}_("onCommentEditionEnd",e)}function W(e){_("onCommentReply",e)}function V(e){_("onPanelScroll",e)}function H(e){e&&F&&(e.commentIds.sort(((e,t)=>{var n,i,o,a;const l=M.get(e),s=M.get(t);if(l&&s){if(l.commentData.pointedPosition||s.commentData.pointedPosition){if(!l.commentData.pointedPosition)return-1;if(!s.commentData.pointedPosition)return 1;if(l.commentData.pointedPosition.y>s.commentData.pointedPosition.y)return-1;if(l.commentData.pointedPosition.y<s.commentData.pointedPosition.y)return 1}if("number"==typeof(null===(n=l.commentData.pointedElement)||void 0===n?void 0:n.index)||"number"==typeof(null===(i=s.commentData.pointedElement)||void 0===i?void 0:i.index))return"number"!=typeof(null===(o=l.commentData.pointedElement)||void 0===o?void 0:o.index)?-1:"number"!=typeof(null===(a=s.commentData.pointedElement)||void 0===a?void 0:a.index)?1:l.commentData.pointedElement.index<s.commentData.pointedElement.index?-1:l.commentData.pointedElement.index>s.commentData.pointedElement.index||-1===l.commentData.pointedElement.id.indexOf("_")&&s.commentData.pointedElement.id.indexOf("_")>-1?1:-1===s.commentData.pointedElement.id.indexOf("_")&&l.commentData.pointedElement.id.indexOf("_")>-1?-1:Math.sign(l.commentData.dateInMs-s.commentData.dateInMs)}return 0})),e.commentIds.forEach((t=>{const n=M.get(t);n&&(e.view.removeChild(n.view.getCommentDiv()),e.view.appendChild(n.view.getCommentDiv()))})))}function q(e,t){e.owner.login&&(e.owner.name=e.owner.name||e.owner.login,c.getUserName(e.owner.login,void 0,(function(n){e.owner.name!==n&&(e.owner.name=n,e.isReply&&b&&t?function(e,t){if(!e||!t||!M)return;const n=M.get(t);if(n){const t=n.replies.get(e.uuid);t&&(e.dateInMs&&(t.dateInMs=e.dateInMs,e.date=c.formatDate(e.dateInMs)),t.view.update(e).then((()=>n.view.updateTimelineLength())))}}(e,t):S.updateComment(e))})),e.owner.color=c.getUserColor(e.owner.login).getStyle(),e.owner.imageUrl=c.getUserImageURL(e.owner.login))}function z(e){e&&(e.view.getSize().height>t.getInnerElement().getSize().height?e.view.hasClassName("repliesContracted")?e.view.hasClassName("allContracted")||e.view.addClassName("allContracted"):(e.view.addClassName("repliesContracted"),e.view.getSize().height>t.getInnerElement().getSize().height&&e.view.addClassName("allContracted")):e.view.hasClassName("allContracted")?(e.view.removeClassName("allContracted"),z(e)):e.view.hasClassName("repliesContracted")&&(e.view.removeClassName("repliesContracted"),z(e)))}function X(e=!0){if(h)if(M.size)D&&(D.remove(),D=null);else{if(D)for(;D.firstChild;)D.firstChild.destroy();else D=r.createElement("div",{class:"DMUBrowserNoSlidesTitleDiv"}).inject(h);let t;if(x||E||!e)t=r.createElement("div",{class:"DMUBrowserNoElementsTitleTextDiv"}).inject(D),t.innerText=g.commentsPanel.noCommentsTitle;else{new p({displayStyle:"icon",label:g.commentsPanel.createCommentTitle,icon:{iconName:"plus",fontIconFamily:WUXManagedFontIcons.Font3DS}}).inject(D).addEventListener("buttonclick",(function(){_("onNewCommentCreated",void 0)}))}}}function G(e){x&&e&&-1===T.indexOf(e.commentData.uuid)&&(e.view.setDisplayFlag(!0),T.push(e.commentData.uuid),T.length===M.size&&T.forEach((function(e){const t=M.get(e);t&&t.view.setDisplayFlag(!0,!0)})))}this.buildPanel=function(n){S.cleanPanel(),F=n.sortComments,e||(e=r.createElement("div",{id:"DMUCommentsPanelMainDiv"})),e.setStyles({height:"100%"});let l=r.createElement("div",{class:"DMUCommentsPanelSectionMainDiv"}).inject(e);return a=new o({draggable:n.draggable,onDragStart:function(){return w||""},sectionLabel:n.panelTitle,cmdList:n.contextualCmdList,quickAccessBtnList:n.quickAccessBtnList}),l.appendChild(a.getContent()),b=n.allowReplies,h=r.createElement("div",{class:"DMUCommentsPanelMainContainer"}),t=(new i).inject(l),t.getInnerElement().setContent(h),t.getInnerElement().addEventListener("scroll",V),t.getContent().setStyle("flex",1),X(),e},this.addMarkup=function(e){a.closeContextualSectionHeader(),e.id&&(y||(y=new C({onCurrentMarkupChanged:e=>{_("onSetCurrentMarkup",e)},onMarkupRenamed:(e,t)=>{_("onMarkupRenamed",{id:e,title:t})},onContextMenuRequested:function(e){let t=e.event.touchFlag?e.event.touches[0]:e.event,i={x:t.pageX||t.screenX||0,y:t.pageY||t.screenY||0};_("onMarkupCtxMenuRequired",{id:e.id,position:new n.Vector2(i.x,i.y)})}}),a.getContent().appendChild(y.getContent()),y.setVisibility(!x)),y.addMarkup({id:e.id,name:e.title,owner:e.owner}))},this.removeMarkup=function(e){y&&y.removeMarkup(e)},this.editMarkupName=function(e){y&&y.startMarkupNameEdition(e)},this.setCurrentMarkup=function(e){y&&y.setCurrentMarkup(e)},this.setAllowReplies=e=>{b=e},this.addComment=function(e){if(!e||!M)return;q(e),e.date=c.formatDate(e.dateInMs);let t=new s({commentData:e,allowReplies:b,onClickCB:N,onReplyCB:W,onEditionEndCB:O,onEnterCB:L,onLeaveCB:L,onNewMentionsCB:({target:e,mentions:t})=>{_("onNewMentions",{commentId:e.uuid,mentions:t})},onCheckSelectedCB:({target:e,check:t})=>{_("onCommentCheckSelected",{dmuObject:e.dmuObject,checkId:t.id})},onCtxMenuCB:function(e){let t=e.event.touchFlag?e.event.touches[0]:e.event;_("onCommentCtxMenuRequired",{target:e.target,shiftKeyPressed:e.event.shiftKey,ctrlKeyPressed:e.event.ctrlKey,position:new n.Vector2(t.pageX?t.pageX:t.screenX,t.pageY?t.pageY:t.screenY)})}}),i=j({page:e.pointedPage,element:e.pointedElement});if(i){i.commentIds.push(e.uuid);const n=t.getCommentDiv();n&&i.view.appendChild(n),M.set(e.uuid,{containerId:i.id,commentData:e,view:t,replies:new Map}),t.setCtxMenuAvailability(!x),(e.pointedPosition||e.pointedElement)&&H(i),e.replies&&e.replies.length&&e.replies.forEach((function(t){S.addReply(t,e.uuid)})),t.updateRepliesCount(e.replies&&e.replies.length?e.replies.length:0),z(i),X()}},this.updateComment=function(e,t){if(!e||!M)return;const n=M.get(e.uuid);if(n){let i=j({page:e.pointedPage,element:e.pointedElement});q(e);let o=R({element:e.pointedElement,page:e.pointedPage});o&&o!==n.containerId&&(!function(e,t,n){const i=j(t);if(i){i.view.removeChild(e.view.getCommentDiv()),0===i.view.childElementCount?(i.view.remove(),I.delete(i.id)):i.commentIds.splice(i.commentIds.indexOf(e.commentData.uuid),1);const t=j(n);t&&(t.commentIds.push(e.commentData.uuid),t.view.appendChild(e.view.getCommentDiv()))}}(n,{containerId:n.containerId},{page:e.pointedPage,element:e.pointedElement}),n.containerId=o,i=j({page:e.pointedPage,element:e.pointedElement}),i&&H(i)),(e.pointedPosition||e.pointedElement)&&t&&i&&H(i),e.date=c.formatDate(n.commentData.dateInMs);let a=!1;const l={processed:{fontIcon:"wux-ui-3ds-check",color:"rgb(1, 131, 8)"},withdrawn:{fontIcon:"wux-ui-3ds-wrong",color:"rgb(204, 9, 47)"},accepted:{fontIcon:"wux-ui-3ds-thumbs-up",color:"rgb(1, 131, 8)"},rejected:{fontIcon:"wux-ui-3ds-thumbs-down",color:"rgb(204, 9, 47)"}};if(e.status&&e.status in l?(n.view.addInformationIcon({id:"commentStatus",...l[e.status]}),a=!0):n.view.removeInformationIcon("commentStatus"),e.isPreview?n.view.addInformationIcon({id:"favoriteComment",fontIcon:"wux-ui-3ds-favorite-on"}):n.view.removeInformationIcon("favoriteComment"),e.highlights&&e.highlights.length){let t={id:"",rating:"0"};e.highlights.forEach((e=>{(5===parseInt(e.rating)?0:parseInt(e.rating))>=(5===parseInt(t.rating)?0:parseInt(t.rating))&&(t=e)})),n.view.addInformationIcon({id:"highlightData",fontIcon:f[t.rating].icon,color:f[t.rating].color,onClick:function(){var i;(null===(i=e.highlights)||void 0===i?void 0:i.length)&&_("onCommentHighlightSelected",{highlightId:t.id,dmuObject:n.commentData.dmuObject})}}),a=!0}else n.view.removeInformationIcon("highlightData");if(n.view.hideReplyButton(a),n.view.update(e),n.replies){let t=0,i=[];n.replies.forEach((n=>{e.replies&&(q(e.replies[t],e.uuid),e.replies[t].dateInMs&&(n.dateInMs=e.replies[t].dateInMs,e.replies[t].date=c.formatDate(e.replies[t].dateInMs)),e.replies[t].isPreview?n.view.addInformationIcon({id:"favoriteComment",fontIcon:"wux-ui-3ds-favorite-on"}):n.view.removeInformationIcon("favoriteComment"),i.push(n.view.update(e.replies[t]))),t++})),Promise.all(i).then((()=>n.view.updateTimelineLength()))}i&&z(i)}},this.selectComment=function(e,n,i){if(!e)return;const o=M.get(e);o&&(o.view.updateDate(c.formatDate(o.commentData.dateInMs)),o.view.setInEdition(!0),o.replies.forEach((function(e){e.view.updateDate(c.formatDate(e.dateInMs))})),l||(l=[]),l.push(o.view),G(o),("number"==typeof n||i)&&(v&&clearTimeout(v),v=setTimeout((function(){if(t&&M&&o){let e=t.getInnerElement();if(e){let t=o.view.getCommentDiv();if(t){let o=e.scrollTop+t.getPosition().y;i?o-=e.offsetHeight/2-t.getSize().height/2:"number"==typeof n&&(o+=132-n),e.scrollTo({top:o,behavior:"smooth"})}}}v=null}),100)))},this.preSelectComment=function(e){if(!e)return;const t=M.get(e);t&&(t.view.updateDate(c.formatDate(t.commentData.dateInMs)),t.view.setHovered(!0),t.replies.forEach((function(e){e.view.updateDate(c.formatDate(e.dateInMs))})),u||(u=[]),u.push(t.view))},this.updateCommentContainerTitle=function(e,t){if(!e||!t)return;const n=M.get(e);if(n&&n.containerId){const e=j({containerId:n.containerId,notCreate:!0});e&&e.view.firstChild&&(e.view.setAttribute("title",t),e.view.firstChild.nodeValue=t)}},this.updateCommentContainerNumber=function(e,t){const n=M.get(e);if(n&&n.containerId){const e=j({containerId:n.containerId,notCreate:!0});e&&(e.number=t)}},this.removeComment=function(e){if(!e)return;const t=M.get(e);if(t){S.restoreCommentPreSelection(),S.restoreCommentSelection(),t.view.remove();let n=j({containerId:t.containerId});if(n){n.commentIds.splice(n.commentIds.indexOf(e),1),0===n.view.childElementCount?(n.view.remove(),I.delete(n.id)):z(n);const i=T.indexOf(t.commentData.uuid);-1!==i&&T.splice(i,1)}M.delete(e)}X()},this.addReply=function(e,t){if(!e)return;const i=M.get(t);if(i){q(e,t),e.date=c.formatDate(e.dateInMs);let o=new s({commentData:e,allowReplies:b,onClickCB:N,onEditionEndCB:O,onReplyCB:W,onCtxMenuCB:function(e){let t=e.event.touchFlag?e.event.touches[0]:e.event;_("onCommentCtxMenuRequired",{target:e.target,shiftKeyPressed:e.event.shiftKey,ctrlKeyPressed:e.event.ctrlKey,position:new n.Vector2(t.pageX?t.pageX:t.screenX,t.pageY?t.pageY:t.screenY)})},onNewMentionsCB:({target:e,mentions:t})=>{_("onNewMentions",{commentId:e.uuid,mentions:t})},onCheckSelectedCB:({target:e,check:t})=>{_("onCommentCheckSelected",{dmuObject:e.dmuObject,checkId:t.id})}});i.view.getCommentDiv().appendChild(o.getCommentDiv()),i.replies.set(e.uuid,{uuid:e.uuid,dateInMs:e.dateInMs,replyData:e,view:o}),o.setCtxMenuAvailability(!x),i.view.updateRepliesCount(i.replies.size);const a=j({containerId:i.containerId});a&&z(a)}},this.selectReply=function(e,t){if(!e||!t)return;const n=M.get(t);if(n){const t=n.replies.get(e);t&&(n.view.updateDate(c.formatDate(n.commentData.dateInMs)),n.view.setInEdition(!0),t.view.updateDate(c.formatDate(t.dateInMs)),t.view.setInEdition(!0),l||(l=[]),l.push(t.view),l.push(n.view),G(n))}},this.removeReply=function(e,t){if(!e||!t)return;const n=M.get(t);if(n){const t=n.replies.get(e);if(t){S.restoreCommentPreSelection(),S.restoreCommentSelection(),t.view.remove(),n.replies.delete(e),n.view.updateRepliesCount(n.replies.size);const i=j({containerId:n.containerId});i&&z(i)}}},this.getDivPositionFrom=function(e,n,i){if(!e)return;const o=M.get(e);if(o){let e=t.getInnerElement(),a=o.view.getCommentDiv().getPosition(n);a.y+=30;let l=e.getPosition(n);return i&&(l.x+=e.getDimensions().width,a.x+=e.getDimensions().width),a.y<l.y?l:a.y>l.y+e.getDimensions().height-10?{x:l.x,y:l.y+e.getDimensions().height-10}:a}},this.scrollPanelToContainer=function(e){if(!e.containerNumber&&!e.containerName)return;let n=j({containerId:R({number:e.containerNumber,title:e.containerName}),notCreate:!0});n&&(v&&clearTimeout(v),v=setTimeout((function(){if(t&&n){let e=t.getInnerElement();e&&e.scrollTo({top:e.scrollTop+n.view.getPosition().y,behavior:"smooth"})}v=null}),100))},this.updatePanelHeader=function(e){a&&e&&(e.quickAccessBtnList&&a.setQuickAccessCommands(e.quickAccessBtnList),e.contextualCmdList&&a.setSubMenuCommands(e.contextualCmdList),e.panelTitle&&a.setHeaderLabel(e.panelTitle),void 0!==e.headerDrag&&a.enableHeaderDrag(e.headerDrag),e.quickAccessBtnAvailability&&(a.setQuickAccessCommandActiveFlag(e.quickAccessBtnAvailability.id,e.quickAccessBtnAvailability.flag),"newCommentButton"===e.quickAccessBtnAvailability.id&&X(e.quickAccessBtnAvailability.flag)))},this.setDragContent=function(e){w=e},this.setReadOnlyFlag=function(e){x!==e&&(x=e,M&&M.forEach((function(t){t.view.setCtxMenuAvailability(!e),t.replies.forEach((function(t){t.view.setCtxMenuAvailability(!e)}))})),y&&y.setVisibility(!e),X())},this.setRestrictedModeFlag=function(e){E=e,X()},this.sortContainers=()=>{const e=[...I.values()];e.sort((function(e,t){return e.number>t.number?1:e.number<t.number?-1:0})),e.forEach((function(e){h.removeChild(e.view),h.appendChild(e.view)}))},this.setSortComments=e=>{F!==e&&(F=e,I.forEach((e=>{H(e)})))},this.setFilterViewFlag=function(e){if(k=e,e){y&&a.getContent().removeChild(y.getContent());const e=m.build(M,A,{onCancel:()=>{S.setFilterViewFlag(!1)},onOk:e=>{if(P.size&&(P.forEach((e=>{const[t,n]=e.split("/"),i=M.get(t);if(i&&(i.view.setVisibleFlag(!0),n)){const e=i.replies.get(n);e&&e.view.setVisibleFlag(!0)}})),I.forEach((e=>e.view.show()))),A=e,!Object.keys(e).length)return S.setFilterViewFlag(!1),P.clear(),void _("onCommentFiltersApplied",{hasFilters:!1});M.forEach((t=>{const n=t.replies.values();for(let i=0;i<t.replies.size;i++){const t=n.next().value;if(t&&m.commentMatchesFilters(t.replyData,e))return}m.commentMatchesFilters(t.commentData,e)?t.replies.size&&t.replies.forEach((e=>{e.view.setVisibleFlag(!1),P.add(t.commentData.uuid+"/"+e.replyData.uuid)})):(t.view.setVisibleFlag(!1),P.add(t.commentData.uuid))})),I.forEach((e=>{for(let t=0;t<e.view.children.length;t++){if("none"!==e.view.children[t].getStyle("display"))return}e.view.hide()})),S.setFilterViewFlag(!1),_("onCommentFiltersApplied",{hasFilters:!0})}});t.getInnerElement().setContent(e)}else y&&a.getContent().appendChild(y.getContent()),m.destroy(),t.getInnerElement().setContent(h)},this.getFilterViewFlag=()=>k,this.hasFiltersApplied=()=>!k&&Object.keys(A).length>0,this.isCommentFiltered=e=>P.has(e),this.resetCommentDisplayHistory=function(){T.forEach((function(e){const t=M.get(e);t&&t.view.setDisplayFlag(!1)})),T.length=0},this.enableContentEdition=function(e,t,n){const i=M.get(t||e);if(i)if(t){let t=i.replies.get(e);i.view.updateDate(c.formatDate(i.commentData.dateInMs)),i.view.setInEdition(!0),t&&(t.view.updateDate(c.formatDate(t.dateInMs)),t.view.setInEdition(!0),t.view.enableContentEdition(n)),l||(l=[]),l.push(i.view),G(i),t&&l.push(t.view)}else i.view.updateDate(c.formatDate(i.commentData.dateInMs)),i.view.setInEdition(!0),i.view.enableContentEdition(n),G(i),l||(l=[]),l.push(i.view)},this.restoreCommentSelection=function(){l&&l.length&&(l.forEach((function(e){e.setInEdition(!1)})),l.length=0)},this.restoreCommentPreSelection=function(){u&&u.length&&(u.forEach((function(e){e.setHovered(!1)})),u.length=0)},this.setCommentLoading=function(e,t){const n=M.get(e);n&&n.view.setLoadingFlag(t)},this.setCommentUnselectable=function(e,t){const n=M.get(e);n&&n.view.setUnselectableFlag(t)},this.setReviewVisuCheckFlag=function(e){a.closeContextualSectionHeader(),a.setAdditionalCheckBoxActiveFlag(0,e)},this.subscribe=function(e,t){return e&&t?U.subscribe({event:e},t):""},this.unsubscribe=function(e){null!=e&&U.unsubscribe(e)},this.cleanPanel=function(){if(S.restoreCommentPreSelection(),S.restoreCommentSelection(),I&&M.forEach((e=>e.view.remove())),I&&I.forEach((e=>e.view.remove())),e)for(;e.firstChild;)e.removeChild(e.firstChild);v&&clearTimeout(v),M.clear(),I.clear(),y&&y.remove(),X(),v=e=l=u=y=null},this.clear=function(){S.cleanPanel(),a&&a.clear(),t&&t.destroy(),D&&D.remove(),x=!1,U.destroy(),a=t=D=null}}}})),define("DS/DMUControls/DMUReviewExpander",["UWA/Core","UWA/Class","DS/Controls/Button","DS/Controls/Editor","DS/Controls/ComboBox","DS/DMUControls/DMUCustomExpander","DS/Utilities/TouchUtils","i18n!DS/DMUControls/assets/nls/DMUControls"],(function(e,t,n,i,o,a,l,s){"use strict";var r=0;return t.extend({init:function(t){var d=t||{};this._parent(d),r++;var c,u,h,m=this,p=!1,g=!1,f=d.objectData,C=d.icons,v=0,w=0,b=0,y=0,D=0;this.getContent=function(){return z.getContent()},this.getMainDiv=function(){return z},this.inject=function(e){return z.getContent().inject(e),m};var S=e.createElement("div",{id:"expanderView_"+r+"_"+f.id,class:"DMUReviewExpanderContainer"});this.destroy=function(){z.getContent().destroy()},this.expand=function(){z.expand()},this.collapse=function(){z.collapse()},this.setCheckComboValue=function(e){p=e},this.setHighlightComboValue=function(e){g=e},this.unselect=function(){z.setSelectedFlag(!1)},this.updateAdditionalDiv=function(){var t,n,i,o,a,l=[];"Check"===d.type?(v>0&&(t=new e.Element("div",{class:"additionalDiv"}),new e.Element("div",{text:v,class:"number"}).inject(t),new e.Element("span",{class:"additionalDivIcon wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-target"}).inject(t),l.push(t)),w>0&&(n=new e.Element("div",{class:"additionalDiv"}),new e.Element("div",{text:w,class:"number"}).inject(n),new e.Element("span",{class:"additionalDivIcon wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-level-medium"}).inject(n),l.push(n))):"Highlight"===d.type&&(y>0&&(i=new e.Element("div",{class:"additionalDiv"}),new e.Element("div",{text:y,class:"number"}).inject(i),new e.Element("span",{class:"additionalDivIcon wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-change"}).inject(i),l.push(i)),b>0&&(o=new e.Element("div",{class:"additionalDiv"}),new e.Element("div",{text:b,class:"number"}).inject(o),new e.Element("span",{class:"additionalDivIcon wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-issue-type"}).inject(o),l.push(o)),D>0&&(a=new e.Element("div",{class:"additionalDiv"}),new e.Element("div",{text:D,class:"number"}).inject(a),new e.Element("span",{class:"additionalDivIcon wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-task"}).inject(a),l.push(a))),z.setAdditionalDiv(l)},this.deactivatePlusButtons=function(){var e=z.getContent().getElementsByClassName("highlightsPanel-impCheckPlusButton");e.length&&(e[0].dsModel.checkFlag=!1);var t=z.getContent().getElementsByClassName("highlightsPanel-issuePlusButton");t.length&&(t[0].dsModel.checkFlag=!1);var n=z.getContent().getElementsByClassName("highlightsPanel-taskPlusButton");n.length&&(n[0].dsModel.checkFlag=!1);var i=z.getContent().getElementsByClassName("highlightsPanel-caPlusButton");i.length&&(i[0].dsModel.checkFlag=!1)},this.addImpactedCheck=function(t){if("Highlight"===d.type){var n=d.checkIcons[t.check.status-1],i=t.check.name,o=t.check.id,a=_.getElementsByClassName("highlightsPanel-impCheckDiv")[0];if(a){a.show();var l=new e.Element("span",{class:n.fonticonClass}).inject(a);l.addClassName("highlightsPanel-objectIcon"),l.id=f.id+"_"+o,l.setStyles({color:n.fonticonColor,width:"fit-content",margin:"auto"}),new e.Element("div",{text:i,class:"highlightsPanel-check",id:f.id+"_"+o}).inject(a).title=i;var s=new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-remove"}).inject(a);a.show(),s.addClassName("highlightsPanel-impCheckRemoveButton hideOnHover"),s.id=o,s.hide(),s.onclick=function(){d.onImpactedCheckRemoved(f.id,this.id)}}}else{w+=1;var r=d.highlightIcons[t.highlight.rating-1],c=t.highlight.name,u=t.highlight.id,h=_.getElementsByClassName("checksPanel-editableImpHighlightDiv")[0];if(h){h.show();var m=new e.Element("span",{class:r.fonticonClass,id:f.id+"_"+u}).inject(h);m.addClassName("checksPanel-impHighlightIcon"),m.setStyles({color:r.fonticonColor,width:"fit-content",margin:"auto"}),new e.Element("div",{text:c,class:"checksPanel-impHighlight",id:f.id+"_"+u}).inject(h).title=c}}this.updateAdditionalDiv()},this.removeImpactedCheck=function(e,t){if("Highlight"===d.type){var n=z.getContent().getElementsByClassName("highlightsPanel-impCheckDiv")[0],i=n.getElementsByClassName("highlightsPanel-check"),o=n.getElementsByClassName("highlightsPanel-objectIcon"),a=n.getElementsByClassName("highlightsPanel-impCheckRemoveButton");for(let e=0;e<i.length;e++)i[e].id.split("_")[1]===t&&i[e].destroy();for(let e=0;e<o.length;e++)o[e].id.split("_")[1]===t&&o[e].destroy();for(let e=0;e<a.length;e++)a[e].id===t&&a[e].destroy()}else{w-=1;var l=z.getContent().getElementsByClassName("checksPanel-editableImpHighlightDiv"),s=l[0].getElementsByClassName("checksPanel-impHighlightIcon"),r=l[0].getElementsByClassName("checksPanel-impHighlight");for(let t=0;t<s.length;t++)s[t].id.split("_")[1]===e&&s[t].destroy();for(let t=0;t<r.length;t++)r[t].id.split("_")[1]===e&&r[t].destroy()}this.updateAdditionalDiv()},this.updateImpactedCheckDisplay=function(e){var t;let n=z.getContent().getElementsByClassName("highlightsPanel-check"),i=z.getContent().getElementsByClassName("highlightsPanel-objectIcon");if(e.name)for(let i=0;i<n.length;i++)t=n[i].id.split("_")[1],e.id===t&&n[i].setText(e.name);if(e.status)for(let n=0;n<i.length;n++)if(t=i[n].id.split("_")[1],e.id===t){var o=i[n];o.removeClassName(i[n].className),o.addClassName("highlightsPanel-objectIcon "+d.checkIcons[e.status-1].fonticonClass),o.setStyles({color:d.checkIcons[e.status-1].fonticonColor})}},this.updateAssociatedHighlightsDisplay=function(e){var t;let n=z.getContent().getElementsByClassName("checksPanel-impHighlight"),i=z.getContent().getElementsByClassName("checksPanel-impHighlightIcon");if(e.name)for(let i=0;i<n.length;i++)t=n[i].id.split("_")[1],e.id===t&&n[i].setText(e.name);if(e.rating)for(let n=0;n<i.length;n++)if(t=i[n].id.split("_")[1],e.id===t){var o=i[n];o.removeClassName(i[n].className),o.addClassName("checksPanel-impHighlightIcon "+d.highlightIcons[e.rating-1].fonticonClass),o.setStyles({color:d.highlightIcons[e.rating-1].fonticonColor})}},this.addIssue=function(t,n){b+=1,f.issues.push(t);var i=z.getContent().getElementsByClassName("highlightsPanel-issueDiv")[0];i.show();var o=new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-issue-type"}).inject(i);o.setStyles({color:"#77797C"}),o.addClassName("highlightsPanel-issueIcon"),new e.Element("div",{text:n,class:"highlightsPanel-issue"}).inject(i).onclick=function(){d.onAttachedObjClicked(t)},this.updateAdditionalDiv()},this.addTask=function(t,n){D+=1,f.tasks.push(t);var i=z.getContent().getElementsByClassName("highlightsPanel-taskDiv")[0];i.show();var o=new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-task"}).inject(i);o.setStyles({color:"#77797C"}),o.addClassName("highlightsPanel-taskIcon"),new e.Element("div",{text:n,class:"highlightsPanel-task"}).inject(i).onclick=function(){d.onAttachedObjClicked(t)},this.updateAdditionalDiv()},this.addCA=function(t,n){y+=1,f.changeAction.push(t);var i=z.getContent().getElementsByClassName("highlightsPanel-changeActionDiv")[0];i.show(),new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-change"}).inject(i).addClassName("highlightsPanel-caIcon"),new e.Element("div",{text:n,class:"highlightsPanel-ca"}).inject(i).onclick=function(){d.onAttachedObjClicked(t)},this.updateAdditionalDiv()},this.addRequirement=function(t,i,o){v+=1,z.getContent().getElementsByClassName("checksPanel-requirementDropZone")[0].hide();var a=z.getContent().getElementsByClassName("checksPanel-checkExpanderBody")[0],l=new e.Element("div",{class:"checksPanel-requirementDiv"}).inject(a),s=new e.Element("span",{class:C[3].fonticonClass}).inject(l);s.addClassName("checksPanel-requirementIcon"),s.setStyles({color:C[3].fonticonColor});var r=new e.Element("div",{text:o,class:"checksPanel-requirement"});r.inject(l),r.onclick=function(){d.onRequirementObjClicked(i)};var c,u=new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-remove"}).inject(l);u.addClassName("checksPanel-requirementRemoveButton hideOnHover"),u.id=t,u.hide(),u.onclick=function(){d.onRequirementRemove(this.id,i)};var h=new n({displayStyle:"lite",label:"lite displayStyle",icon:{iconName:"open-in-a-new-window wux-ui-3ds",fontIconFamily:WUXManagedFontIcons.Font3DS},showLabelFlag:!1});h.getContent().addClassName("checksPanel-reqOpenWithButton"),h.getContent().id=t,c=new e.Element("div",{class:"checksPanel-reqOpenWithPlaceholder"}),h.inject(c),c.inject(l),h.getContent().onclick=function(e){d.onRequirementOpenWithClicked(e)},this.updateAdditionalDiv()},this.removeRequirement=function(){v-=1;var e=z.getContent().getElementsByClassName("checksPanel-requirementDropZone")[0];e.show(),e.removeClassName("checksPanel-reqDropZoneDrag"),z.getContent().getElementsByClassName("checksPanel-requirementPlusIcon")[0].hide(),z.getContent().getElementsByClassName("infoReq")[0].show(),z.getContent().getElementsByClassName("checksPanel-requirementDiv")[0].destroy(),this.updateAdditionalDiv()},this.updatePreview=function(){var e=z.getContent(),t=e.getElementsByClassName("highlightsPanel-editableHighlightThumbDiv");if(t[0].getElementsByClassName("DMUCommentMainDiv ").length)t[0].getElementsByClassName("lightCommentRepresentation")[0].isHidden()?(t[0].getElementsByClassName("lightCommentRepresentation")[0].show(),t[0].getElementsByClassName("normalCommentRepresentation")[0].hide()):(t[0].getElementsByClassName("lightCommentRepresentation")[0].hide(),t[0].getElementsByClassName("normalCommentRepresentation")[0].show());else{var n=e.getElementsByClassName("highlightsPanel-editableHighlightSlideBlock");t[0].isHidden()&&"false"===localStorage.getItem("DMUReviewPanel_ThumbnailShowState")?(t[0].show(),n[0].hide()):(t[0].hide(),n[0].show())}},this.updateRatingComboValues=function(){6===c.elementsList.length&&(c.elementsList=c.elementsList.slice(0,5))};var x=function(){if(f.description){var t=new e.Element("div",{text:f.description,class:"reviewPanel-description"});t.inject(_),t.setStyles({"grid-column":"1/2 span"})}},E=function(){var e;if("Check"===d.type)e=f.status?f.status:-1,(u=new o({elementsList:[{labelItem:s.reviewPanel.checkStatusInProgress,iconItem:{iconClasses:C[0].fonticonClass+" checkUNDIconColor"},valueItem:0},{labelItem:s.reviewPanel.checkStatusPassed,iconItem:{iconClasses:C[1].fonticonClass+" checkOKIconColor"},valueItem:1},{labelItem:s.reviewPanel.checkStatusFailed,iconItem:{iconClasses:C[2].fonticonClass+" checkKOIconColor"},valueItem:2}],enableSearchFlag:!1,value:-1===e?2:e-1}).inject(_)).getContent().addClassName("checksPanel-statusCombo"),u.getContent().id=f.id,u.elements.iconPlaceholder.style.marginRight="11px",u.elements.mainElement.onclick=function(e){m.getMainDiv().isSelected()||m.getMainDiv().setSelectedFlag(!0,e)},u.elements.expander.onclick=function(e){m.getMainDiv().isSelected()||m.getMainDiv().setSelectedFlag(!0,e)},u.addEventListener("change",(function(){p||d.onCheckAttributeChanged(this.id,"status",this.dsModel.value+1);var e=z.getContent().getElementsByClassName("DMUCustomExpHeaderFontIcon")[0];e.className=C[this.dsModel.value].fonticonClass+" DMUCustomExpHeaderFontIcon",e.setStyles({color:C[this.dsModel.value].fonticonColor,"font-size":"14px"}),p=!1}));else{e=f.rating?f.rating:-1;let t=[];t.push({labelItem:s.reviewPanel.highlightRatingUrgent,iconItem:{iconClasses:C[5].fonticonClass+" highlightUrgentIconColor"},valueItem:5},{labelItem:s.reviewPanel.highlightRatingHigh,iconItem:{iconClasses:C[3].fonticonClass+" highlightHighIconColor"},valueItem:3},{labelItem:s.reviewPanel.highlightRatingMedium,iconItem:{iconClasses:C[2].fonticonClass+" highlightMediumIconColor"},valueItem:2},{labelItem:s.reviewPanel.highlightRatingLow,iconItem:{iconClasses:C[1].fonticonClass+" highlightLowIconColor"},valueItem:1},{labelItem:s.reviewPanel.highlightRatingProcessed,iconItem:{iconClasses:C[4].fonticonClass+" highlightProIconColor"},valueItem:4}),"1"===f.rating&&t.push({labelItem:s.reviewPanel.highlightRatingTBA,iconItem:{iconClasses:C[0].fonticonClass+" highlightTBAIconColor"},valueItem:0}),(c=new o({elementsList:t,enableSearchFlag:!1,value:-1===e?2:e-1}).inject(_)).getContent().addClassName("highlightsPanel-highlightRatingCombo"),c.getContent().id=f.id,c.elements.iconPlaceholder.style.marginRight="11px",l.getTouchMode()&&c.getContent().setStyles({width:"100%"}),c.elements.mainElement.onclick=function(e){m.getMainDiv().isSelected()||m.getMainDiv().setSelectedFlag(!0,e)},c.elements.expander.onclick=function(e){m.getMainDiv().isSelected()||m.getMainDiv().setSelectedFlag(!0,e)},c.addEventListener("change",(function(){g||d.onHighlightAttributeChanged(this.id,"rating",this.dsModel.value+1);var e=z.getContent().getElementsByClassName("DMUCustomExpHeaderFontIcon")[0];e.className=C[this.dsModel.value].fonticonClass+" DMUCustomExpHeaderFontIcon",e.setStyles({color:C[this.dsModel.value].fonticonColor,"font-size":"14px"}),g=!1}))}},k=function(){(h=new i({value:f.description?f.description:"",widthInCharNumber:33,nbRows:4,newLineMode:"shiftEnter",maxLength:256,placeholder:"Check"===d.type?s.reviewPanel.writeCheckDescription:s.reviewPanel.writeHighlightDescription}).inject(_)).getContent().id=f.id,h.getContent().addClassName("Check"===d.type?"checksPanel-checkDescriptionEditor":"highlightsPanel-highlightDescriptionEditor"),h.elements.container.getChildren()[0].setStyles({width:"100%"}),l.getTouchMode()&&h.elements.container.getChildren()[0].setStyles({"margin-top":"4px",width:"100%"}),h.addEventListener("change",(function(){d.onCheckAttributeChanged?d.onCheckAttributeChanged(this.id,"description",this.dsModel.value):d.onHighlightAttributeChanged(this.id,"description",this.dsModel.value)}))},M=function(){if(f.requirements&&f.requirements.length>0){var t=new e.Element("div",{class:"checksPanel-requirementDiv"}).inject(_);for(let r=0;r<f.requirements.length;r++){v+=1;var i=new e.Element("span",{class:C[3].fonticonClass}).inject(t);i.addClassName("checksPanel-requirementIcon"),i.setStyles({color:C[3].fonticonColor});var o,a=f.requirements[r].id,l=f.requirements[r].getName?f.requirements[r].getName():a;new e.Element("div",{id:a||f.requirements[r].getPlmID(),text:l||f.requirements[r].getPlmID(),class:"checksPanel-requirement"}).inject(t).onclick=function(){d.onRequirementObjClicked(this.id)};var s=new n({displayStyle:"lite",label:"lite displayStyle",icon:{iconName:"open-in-a-new-window wux-ui-3ds",fontIconFamily:WUXManagedFontIcons.Font3DS},showLabelFlag:!1});s.getContent().addClassName("checksPanel-reqOpenWithButton"),s.getContent().id=f.id,o=new e.Element("div",{class:"checksPanel-reqOpenWithPlaceholder"}),s.inject(o),o.inject(t),s.getContent().onclick=function(e){d.onRequirementOpenWithClicked(e)}}}},P=function(){var t=new e.Element("div",{class:"highlightsPanel-editableHighlightThumbDiv"}).inject(_);if(l.getTouchMode()&&t.setStyles({"margin-top":"7px"}),d.normalCommentRepresentation&&(d.normalCommentRepresentation.inject(t),d.normalCommentRepresentation.addClassName("normalCommentRepresentation"),"false"===localStorage.getItem("DMUReviewPanel_ThumbnailShowState")?d.normalCommentRepresentation.hide():d.normalCommentRepresentation.show()),d.lightCommentRepresentation)d.lightCommentRepresentation.inject(t),d.lightCommentRepresentation.addClassName("lightCommentRepresentation"),"false"===localStorage.getItem("DMUReviewPanel_ThumbnailShowState")?d.lightCommentRepresentation.show():d.lightCommentRepresentation.hide();else{var n=new e.Element("div",{class:"highlightsPanel-editableHighlightSlideBlock"}).inject(_);new e.Element("span",{class:"highlightsPanel-slideIcon"}).inject(n),new e.Element("div",{class:"highlightsPanel-slide"}).inject(n),"false"===localStorage.getItem("DMUReviewPanel_ThumbnailShowState")?(t.hide(),n.show()):(t.show(),n.hide())}},I=function(){var t,n=d.impChecksInfos[f.id],i=new e.Element("div",{class:"highlightsPanel-impCheckDiv",id:f.id}).inject(_);if(i.hide(),"facet"===d.panelType.type&&i.setStyles({"grid-row":"3"}),n){i.show();for(let o=0;o<n.length;o++)(t=new e.Element("span",{class:d.checkIcons[n[o].status-1].fonticonClass}).inject(i)).addClassName("highlightsPanel-objectIcon"),t.id=f.id+"_"+n[o].id,t.setStyles({color:d.checkIcons[n[o].status-1].fonticonColor,width:"fit-content",margin:"auto"}),new e.Element("div",{text:n[o].name,class:"highlightsPanel-check",id:f.id+"_"+n[o].id}).inject(i).title=n[o].name}},U=function(){var t,n,i=d.impChecksInfos[f.id],o=new e.Element("div",{class:"checksPanel-editableImpHighlightDiv"}).inject(_);if(o.hide(),i){o.show(),"reviewApp"===d.panelType.type&&!d.editionMode&&d.readOnly&&_.setStyles({"grid-template-row":" 20px"});for(let a=0;a<i.length;a++)w+=1,(t=new e.Element("span",{class:d.highlightIcons[i[a].rating-1].fonticonClass,id:f.id+"_"+i[a].id}).inject(o)).addClassName("checksPanel-impHighlightIcon"),t.setStyles({color:d.highlightIcons[i[a].rating-1].fonticonColor}),n=i[a].name,new e.Element("div",{text:n,class:"checksPanel-impHighlight",id:f.id+"_"+i[a].id}).inject(o).title=i[a].name}},T=function(){var t,i=new e.Element("div",{text:s.reviewPanel.issues,class:"highlightsPanel-issueTitle"});i.inject(_);var o=new e.Element("div",{class:"highlightsPanel-issuePlaceholder"}).inject(_),a=new n({displayStyle:"lite",label:"add Impacted Check Button",icon:{iconName:"plus",fontIconFamily:WUXManagedFontIcons.Font3DS},type:"check",showLabelFlag:!1}).inject(o);a.getContent().id=f.id,a.getContent().addClassName("highlightsPanel-issuePlusButton"),a.touchMode=!1,l.getTouchMode()&&(a.getContent().setStyles({"font-size":"14px","min-height":"auto","max-height":"fit-content"}),i.setStyles({"margin-top":"4px"}),o.setStyles({"margin-top":"4px"})),a.getContent().getElementsByClassName("wux-button-icon-placeholder")[0].setStyles({"line-height":"12px"}),o.setStyles({"min-height":"12px"}),a.getContent().onclick=function(e){z.isSelected()&&e.stopPropagation()},a.getContent().addEventListener("change",(function(){!0===this.dsModel.checkFlag&&(z.isSelected()||z.setSelectedFlag(!0),d.onAddIssueRequested(f.id,f.name))}));var r=new e.Element("div",{class:"highlightsPanel-issueDiv",id:f.id}).inject(_);if(r.hide(),f.issues&&f.issues.length){r.show();for(let n=0;n<f.issues.length;n++)b+=1,(t=new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-issue-type"}).inject(r)).setStyles({color:"#77797C"}),t.addClassName("highlightsPanel-issueIcon"),new e.Element("div",{id:f.issues[n].id,text:f.issues[n].name,class:"highlightsPanel-issue"}).inject(r).onclick=function(){d.onAttachedObjClicked(this.id)}}else r.hide()},A=function(){var t,n=new e.Element("div",{class:"highlightsPanel-issueDiv"}).inject(_);if("facet"===d.panelType.type&&n.setStyles({"grid-row":"4"}),n.hide(),f.issues){n.show();for(let i=0;i<f.issues.length;i++)b+=1,(t=new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-issue-type"}).inject(n)).setStyles({color:"#77797C"}),t.addClassName("highlightsPanel-issueIcon"),new e.Element("div",{id:f.issues[i].id,text:f.issues[i].name,class:"highlightsPanel-issue"}).inject(n).onclick=function(){d.onAttachedObjClicked(this.id)}}},F=function(){var t=new e.Element("div",{text:s.reviewPanel.changeActions,class:"highlightsPanel-caTitle"});t.inject(_);var i=new e.Element("div",{class:"highlightsPanel-caPlaceholder"}).inject(_),o=new n({displayStyle:"lite",label:"add Impacted Check Button",icon:{iconName:"plus",fontIconFamily:WUXManagedFontIcons.Font3DS},type:"check",showLabelFlag:!1}).inject(i);o.getContent().id=f.id,o.getContent().addClassName("highlightsPanel-caPlusButton"),o.touchMode=!1,l.getTouchMode()&&(o.getContent().setStyles({"font-size":"14px","min-height":"auto","max-height":"fit-content"}),t.setStyles({"margin-top":"4px"}),i.setStyles({"margin-top":"4px"})),o.getContent().getElementsByClassName("wux-button-icon-placeholder")[0].setStyles({"line-height":"12px"}),i.setStyles({"min-height":"12px"}),o.getContent().onclick=function(e){z.isExpanded()&&e.stopPropagation()},o.getContent().addEventListener("change",(function(){!0===this.dsModel.checkFlag&&(z.isSelected()||z.setSelectedFlag(!0),d.onAddCARequested(f.id,f.name))}));var a=new e.Element("div",{class:"highlightsPanel-changeActionDiv",id:f.id}).inject(_);if(a.hide(),f.changeAction&&f.changeAction.length){a.show();for(let t=0;t<f.changeAction.length;t++)y+=1,new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-change"}).inject(a).addClassName("highlightsPanel-caIcon"),new e.Element("div",{id:f.changeAction[t].id,text:f.changeAction[t].name,class:"highlightsPanel-ca"}).inject(a).onclick=function(){d.onAttachedObjClicked(this.id)}}else a.hide()},B=function(){var t=new e.Element("div",{class:"highlightsPanel-changeActionDiv"}).inject(_);if("facet"===d.panelType.type&&t.setStyles({"grid-row":"5"}),t.hide(),f.changeAction){t.show();for(let n=0;n<f.changeAction.length;n++)y+=1,new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-change"}).inject(t).addClassName("highlightsPanel-caIcon"),new e.Element("div",{id:f.changeAction[n].id,text:f.changeAction[n].name,class:"highlightsPanel-ca"}).inject(t).onclick=function(){d.onAttachedObjClicked(this.id)}}},R=function(){var t,i=new e.Element("div",{text:s.reviewPanel.tasks,class:"highlightsPanel-taskTitle"});i.inject(_);var o=new e.Element("div",{class:"highlightsPanel-taskPlaceholder"}).inject(_),a=new n({displayStyle:"lite",label:"add Impacted Task Button",icon:{iconName:"plus",fontIconFamily:WUXManagedFontIcons.Font3DS},type:"check",showLabelFlag:!1}).inject(o);a.getContent().id=f.id,a.getContent().addClassName("highlightsPanel-taskPlusButton"),a.touchMode=!1,l.getTouchMode()&&(a.getContent().setStyles({"font-size":"14px","min-height":"auto","max-height":"fit-content"}),i.setStyles({"margin-top":"4px"}),o.setStyles({"margin-top":"4px"})),a.getContent().getElementsByClassName("wux-button-icon-placeholder")[0].setStyles({"line-height":"12px"}),o.setStyles({"min-height":"12px"}),a.getContent().onclick=function(e){z.isSelected()&&e.stopPropagation()},a.getContent().addEventListener("change",(function(){!0===this.dsModel.checkFlag&&(z.isSelected()||z.setSelectedFlag(!0),d.onAddTaskRequested(f.id,f.name))}));var r=new e.Element("div",{class:"highlightsPanel-taskDiv",id:f.id}).inject(_);if(r.hide(),f.tasks&&f.tasks.length){r.show();for(let n=0;n<f.tasks.length;n++)D+=1,(t=new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-task"}).inject(r)).setStyles({color:"#77797C"}),t.addClassName("highlightsPanel-taskIcon"),new e.Element("div",{id:f.tasks[n].id,text:f.tasks[n].name,class:"highlightsPanel-task"}).inject(r).onclick=function(){d.onAttachedObjClicked(this.id)}}else r.hide()},j=function(){var t,n=new e.Element("div",{class:"highlightsPanel-taskDiv"}).inject(_);if("facet"===d.panelType.type&&n.setStyles({"grid-row":"4"}),n.hide(),f.tasks){n.show();for(let i=0;i<f.tasks.length;i++)D+=1,(t=new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-task"}).inject(n)).setStyles({color:"#77797C"}),t.addClassName("highlightsPanel-taskIcon"),new e.Element("div",{id:f.tasks[i].id,text:f.tasks[i].name,class:"highlightsPanel-task"}).inject(n).onclick=function(){d.onAttachedObjClicked(this.id)}}},_=new e.Element("div",{class:"Check"===d.type?"checksPanel-checkExpanderBody":"highlightsPanel-highlightExpanderBody"}).inject(S);l.getTouchMode()&&_.addClassName("panelTouchMode"),"reviewApp"===d.panelType.type?d.editionMode&&!d.readOnly?("Check"===d.type&&(_.setStyles({"grid-template-rows":"auto"}),d.checkEditMode.canEditState?E():d.checkEditMode.canEditDef&&function(){let t;if("Check"===d.type){t=f.status?f.status:-1;const o=[{labelItem:s.reviewPanel.checkStatusInProgress,iconItem:{iconClasses:C[0].fonticonClass+" checkUNDIconColor",fonticonColor:C[0].fonticonColor},valueItem:0},{labelItem:s.reviewPanel.checkStatusPassed,iconItem:{iconClasses:C[1].fonticonClass+" checkOKIconColor",fonticonColor:C[1].fonticonColor},valueItem:1},{labelItem:s.reviewPanel.checkStatusFailed,iconItem:{iconClasses:C[2].fonticonClass+" checkKOIconColor",fonticonColor:C[2].fonticonColor},valueItem:2}][-1===t?2:t-1];var n=new e.Element("div",{class:"checksPanel-checkStatusDiv"}).inject(_);n.setStyles({"align-content":"center"});var i=new e.Element("span",{class:o.iconItem.iconClasses}).inject(n);i.addClassName("checksPanel-checkStatusIcon"),i.setStyles({color:o.iconItem.fonticonColor}),new e.Element("div",{text:o.labelItem,class:"checksPanel-checkStatus"}).inject(n)}}(),d.checkEditMode.canEditDef?(k(),function(){var t=new e.Element("div",{class:"checksPanel-requirementDropZone"}).inject(_);l.getTouchMode()&&t.addClassName("reviewTouchMode"),new e.Element("div",{text:s.reviewPanel.reqDropZoneInfo,class:"infoReq"}).inject(t);var i=new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-plus",id:f.id}).inject(t);if(i.addClassName("checksPanel-requirementPlusIcon"),i.hide(),t.ondrop=function(e){e.preventDefault(),e.stopPropagation();var t=JSON.parse(e.dataTransfer.getData("Text"));t.data&&t.data.items&&t.data.items.length>0&&"Requirement"===t.data.items[0].objectType&&d.onRequirementDrop(f.id,t.data.items[0].objectId,t.data.items[0].displayName)},t.ondragenter=function(e){e.preventDefault(),e.stopPropagation(),this.getElementsByClassName("checksPanel-requirementPlusIcon")[0].show(),this.getElementsByClassName("infoReq")[0].hide(),this.addClassName("checksPanel-reqDropZoneDrag")},t.ondragleave=function(){this.getElementsByClassName("checksPanel-requirementPlusIcon")[0].hide(),this.getElementsByClassName("infoReq")[0].show(),this.removeClassName("checksPanel-reqDropZoneDrag")},t.ondragover=function(e){e.preventDefault(),e.stopPropagation()},t.ondragend=function(e){e.preventDefault(),e.stopPropagation()},f.requirements&&f.requirements.length>0){t.hide();var o=new e.Element("div",{class:"checksPanel-requirementDiv"}).inject(_);for(let t=0;t<f.requirements.length;t++){v+=1;var a=new e.Element("span",{class:C[3].fonticonClass}).inject(o);a.addClassName("checksPanel-requirementIcon"),a.setStyles({color:C[3].fonticonColor});var r=f.requirements[t].getPlmID(),c=f.requirements[t].getName();new e.Element("div",{id:r,text:c||r,class:"checksPanel-requirement"}).inject(o).onclick=function(){d.onRequirementObjClicked(this.id)};var u,h=new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-remove"}).inject(o);h.addClassName("checksPanel-requirementRemoveButton hideOnHover"),h.id=f.id,h.hide(),h.onclick=function(){d.onRequirementRemove(this.id,f.requirements[0].getPlmID())};var m=new n({displayStyle:"lite",label:"lite displayStyle",icon:{iconName:"open-in-a-new-window wux-ui-3ds",fontIconFamily:WUXManagedFontIcons.Font3DS},showLabelFlag:!1});m.getContent().addClassName("checksPanel-reqOpenWithButton"),m.getContent().id=f.id,u=new e.Element("div",{class:"checksPanel-reqOpenWithPlaceholder"}),m.inject(u),u.inject(o),m.getContent().onclick=function(e){d.onRequirementOpenWithClicked(e)}}}}()):(x(),M()),U()),"Highlight"===d.type&&(d.highlightEditMode.canEditDef?(E(),k(),P(),function(){var t=new e.Element("div",{text:s.reviewPanel.impactedChecks,class:"highlightsPanel-impCheckTitle"});t.inject(_);var i=new e.Element("div",{class:"highlightsPanel-impCheckPlaceholder"}).inject(_),o=new n({displayStyle:"lite",label:"add Impacted Check Button",icon:{iconName:"plus",fontIconFamily:WUXManagedFontIcons.Font3DS},type:"check",showLabelFlag:!1}).inject(i);o.touchMode=!1,l.getTouchMode()&&(t.setStyles({"margin-top":"4px"}),i.setStyles({"margin-top":"4px"}),o.getContent().setStyles({"font-size":"14px","min-height":"auto","max-height":"fit-content"})),o.getContent().addClassName("highlightsPanel-impCheckPlusButton"),o.getContent().getElementsByClassName("wux-button-icon-placeholder")[0].setStyles({"line-height":"12px"}),i.setStyles({"min-height":"12px"}),o.getContent().addEventListener("change",(function(){!0===this.dsModel.checkFlag?d.onSetImpactedCheckRequested(f.id):d.onSetImpactedCheckCanceled()}));var a=new e.Element("div",{class:"highlightsPanel-impCheckDiv",id:f.id}).inject(_);l.getTouchMode()&&a.setStyles({"grid-template-columns":"20px 130px 30px"}),a.hide();var r,c=d.impChecksInfos[f.id];if(c&&c.length){a.show();for(let t=0;t<c.length;t++){(r=new e.Element("span",{class:d.checkIcons[c[t].status-1].fonticonClass}).inject(a)).addClassName("highlightsPanel-objectIcon"),r.id=f.id+"_"+c[t].id,r.setStyles({color:d.checkIcons[c[t].status-1].fonticonColor,width:"fit-content",margin:"auto"}),new e.Element("div",{text:c[t].name,class:"highlightsPanel-check",id:f.id+"_"+c[t].id}).inject(a).title=c[t].name;var u=new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-remove"}).inject(a);a.show(),u.addClassName("highlightsPanel-impCheckRemoveButton hideOnHover"),u.id=c[t].id,u.hide(),u.onclick=function(){d.onImpactedCheckRemoved(f.id,this.id)}}}else a.hide()}(),T(),R(),"Document"!==d.contextType&&"Specification Report"!==d.contextType&&"Requirement"!==d.contextType&&"Requirement Specification"!==d.contextType&&F()):(_.setStyles({"grid-template-rows":"auto"}),x(),P(),I(),A(),j(),B()))):(_.setStyles({"grid-template-rows":"auto"}),"Check"===d.type&&(x(),M(),U()),"Highlight"===d.type&&(x(),P(),I(),!d.readOnly&&(d.editionMode||!d.editionMode&&"ENOR3R_AP"!==d.panelType.app)&&d.highlightEditMode.canEditDef?(T(),R(),"Document"!==d.contextType&&"Specification Report"!==d.contextType&&"Requirement"!==d.contextType&&"Requirement Specification"!==d.contextType&&F()):(A(),j(),B()))):"facet"===d.panelType.type&&(_.setStyles({"padding-top":"5px"}),"Check"===d.type&&(d.checkEditMode.canEditState&&E(),x(),M(),U()),"Highlight"===d.type&&(d.highlightEditMode.canEditPriority&&E(),x(),I(),A(),j(),B()));var N,L,O,W,V,H,q=(H=[],"Check"===d.type?(v>0&&(N=new e.Element("div",{class:"additionalDiv"}),new e.Element("div",{text:v,class:"number"}).inject(N),new e.Element("span",{class:"additionalDivIcon wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-target"}).inject(N),H.push(N)),w>0&&(L=new e.Element("div",{class:"additionalDiv"}),new e.Element("div",{text:w,class:"number"}).inject(L),new e.Element("span",{class:"additionalDivIcon wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-level-medium"}).inject(L),H.push(L))):"Highlight"===d.type?(y>0&&(O=new e.Element("div",{class:"additionalDiv"}),new e.Element("div",{text:y,class:"number"}).inject(O),new e.Element("span",{class:"additionalDivIcon wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-change"}).inject(O),H.push(O)),b>0&&(W=new e.Element("div",{class:"additionalDiv"}),new e.Element("div",{text:b,class:"number"}).inject(W),new e.Element("span",{class:"additionalDivIcon wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-issue-type"}).inject(W),H.push(W)),D>0&&(V=new e.Element("div",{class:"additionalDiv"}),new e.Element("div",{text:D,class:"number"}).inject(V),new e.Element("span",{class:"additionalDivIcon wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-task"}).inject(V),H.push(V))):"Validated"===d.type?(H.push(d.validRemoveButton),H.push(d.validOpenWithButton)):"Context"===d.type?H.push(d.ctxOpenWithButton):"Change Action"===d.type&&(H.push(d.caRemoveButton),H.push(d.caOpenWithButton)),H),z=new a({onLabelChanged:function(e){"Check"===d.type&&d.onCheckAttributeChanged(f.id,e.type,e.value),"Highlight"===d.type&&d.onHighlightAttributeChanged(f.id,e.type,e.value)},onExpandOrCollapse:"Check"===d.type?function(e){const{editionMode:t,checkEditMode:n,panelType:i}=d;e.state?(e.object.setAdditionalDivVisibleFlag(!1),e.object.setExpandOrCollapseButtonVisibleFlag(!0),e.object.setLabelEditionFlag(t&&n.canEditDef),e.object.setHeaderIconVisibleFlag(!n.canEditDef&&!n.canEditState||"facet"!==i.type&&!t),e.object.expandOrCollapseAtClick(!1)):(e.object.setExpandOrCollapseButtonVisibleFlag(!1),e.object.setHeaderIconVisibleFlag(!0),e.object.setAdditionalDivVisibleFlag(!0),e.object.setLabelEditionFlag(!1),e.object.expandOrCollapseAtClick(!0))}:function(e){e.state?(e.object.setAdditionalDivVisibleFlag(!1),e.object.setExpandOrCollapseButtonVisibleFlag(!0),"facet"===d.panelType.type&&d.highlightEditMode.canEditPriority?(e.object.setHeaderIconVisibleFlag(!1),e.object.setLabelEditionFlag(!1)):d.editionMode&&d.highlightEditMode.canEditDef&&(e.object.setHeaderIconVisibleFlag(!1),e.object.setLabelEditionFlag(!0)),e.object.expandOrCollapseAtClick(!1),"Highlight"===d.type&&d.onHighlightExpandCB&&d.onHighlightExpandCB({object:e.object.getContent(),id:f.id})):(e.object.setExpandOrCollapseButtonVisibleFlag(!1),e.object.setHeaderIconVisibleFlag(!0),e.object.setAdditionalDivVisibleFlag(!0),e.object.setLabelEditionFlag(!1),e.object.expandOrCollapseAtClick(!0))},onSelectedFlagChanged:function(e){e.state?("Validated"!==d.type&&"Context"!==d.type&&"Change Action"!==d.type||z.setAdditionalDivVisibleFlag(!0),d.onExpanderSelectedCB&&d.onExpanderSelectedCB({id:"Validated"===d.type||"Context"===d.type||"Change Action"===d.type?m.getContent().id?parseInt(m.getContent().id):f.id:m.getContent().id,element:z,type:d.type,event:e.event})):("Validated"!==d.type&&"Context"!==d.type&&"Change Action"!==d.type||z.setAdditionalDivVisibleFlag(!1),d.onExpanderUnselectCB&&d.onExpanderUnselectCB({id:"Validated"===d.type||"Context"===d.type||"Change Action"===d.type?m.getContent().id?parseInt(m.getContent().id):f.id:m.getContent().id,element:z,type:d.type}))}});z.build({fontIcon:"Check"===d.type?C[d.objectData.status-1].fonticonClass:"Highlight"===d.type?C[d.objectData.rating-1].fonticonClass:void 0,fontIconColor:"Check"===d.type?C[d.objectData.status-1].fonticonColor:"Highlight"===d.type?C[d.objectData.rating-1].fonticonColor:void 0,icon:"Validated"===d.type||"Context"===d.type||"Change Action"===d.type?d.objectData.icon:void 0,label:d.objectData.name,additionalDiv:q,body:S,checkEditMode:!("Check"!==d.type||!d.editionMode)&&d.checkEditMode,highlightEditMode:"Highlight"===d.type&&d.editionMode?d.highlightEditMode:null}),"Highlight"===d.type&&(z.getContent().draggable=!0,z.getContent().ondragstart=function(e){var t=d.onHighlightDragStart(e);e.dataTransfer.setData("text",t)}),"Validated"!==d.type&&"Context"!==d.type&&"Change Action"!==d.type||z.setAdditionalDivVisibleFlagOnHover(!0),z.setReadOnly(!1),"Validated"!==d.type&&"Context"!==d.type&&"Change Action"!==d.type||z.expandOrCollapseAtClick(!1),d.editionMode||(z.setLabelEditionFlag(!1),z.setHeaderIconVisibleFlag(!0))}})})),define("DS/DMUControls/panels/DMUReviewPanel",["UWA/Core","UWA/Class","DS/Visualization/ThreeJS_DS","UWA/Controls/ThemedScroller","DS/DMUControls/DMUReviewExpander","DS/Controls/Expander","DS/Controls/Button","DS/Utilities/TouchUtils","DS/Windows/Dialog","DS/DMUControls/DMUWarningPanel","DS/CoreEvents/ModelEvents","DS/DMUControls/EXPNotify","DS/DMUBaseExperience/DMUContextManager","DS/CATWebUXComponents/CATWebUXSectionHeader","DS/DMUBaseExperience/EXPToolsContext","DS/Menu/ContextualMenu","DS/Menu/Menu","i18n!DS/DMUControls/assets/nls/DMUControls","css!DS/DMUControls/DMUControls.css"],(function(e,t,n,i,o,a,l,s,r,d,c,u,h,m,p,g,f,C){"use strict";return t.extend({init:function(t){var a,r;this._parent(t);var v,w,b,y,D,S,x,E,k,M,P,I,U,T,A,F,B,R,j,_,N,L=0,O=[],W=new c,V=!1,H=[],q=[];let z,X,G,Z,Y,K,J,$,Q=!1;function ee(e,t){X&&(X.destroy(),X=null),X=new u({body:r.getUIFrame(),type:e,message:t})}var te=function(e,t){return W.publish({event:e,data:t,context:this})};this.subscribe=function(e,t){if(e&&t)return W.subscribe({event:e},t)},this.getColumnMinimumWidth=function(){return 273},this.updateValidatedList=function(e){k=e},this.updateChangeActionList=function(e){E=e},this.getColumnWidthStep=function(){return 240},this.deactiveValidatedButton=function(){v&&(v.checkFlag=!1)},this.setContextType=function(e){z=e},this.setRestrictions=e=>{Z=e},this.getSectionHeader=function(){return S},this.getExpanders=function(){return O},this.deactiveButtons=function(){for(let e=0;e<O.length;e++)"Highlight"===O[e].type&&O[e].expander.deactivatePlusButtons()},this.editMarkupName=function(t){let n,i,o=B.getElementsByClassName("reviewPanel-markupRect");for(let e=o.length-1;e>=0;e--)if(o[e].id===t){n=o[e].getElementsByClassName("reviewPanel-markupName"),i=o[e];break}let a=!1;if(n&&i){n[0].setStyles({display:"none"});let o=e.createElement("p",{class:"DMUMarkupEditableDiv",contenteditable:!0}).inject(i);o.innerText=n[0].innerText,window.getSelection().removeAllRanges();let l=document.createRange();l.selectNodeContents(o),window.getSelection().addRange(l),o.focus(),a=!0;let s=function(e){a&&(a=!1,i.removeChild(o),e||(n[0].innerText=o.innerText,n[0].setStyles({display:"inline-block"}),te("onMarkupRenamed",{id:t,title:o.innerText})))};o.addEventListener("keyup",(function(e){e.stopPropagation()})),o.addEventListener("click",(function(e){e.stopPropagation()})),o.addEventListener("keydown",(function(e){"Enter"!==e.key&&13!==e.keyCode&&"Escape"!==e.key&&27!==e.keyCode||s("Escape"===e.key||27===e.keyCode)})),o.addEventListener("blur",s)}},this.expandAll=function(e){for(let t=0;t<O.length;t++)("Checks"===e&&"Check"===O[t].type||"Highlights"===e&&"Highlight"===O[t].type)&&O[t].expander.expand()},this.collapseAll=function(e){for(let t=0;t<O.length;t++)("Checks"===e&&"Check"===O[t].type||"Highlights"===e&&"Highlight"===O[t].type)&&O[t].expander.collapse()},this.updatePanel=()=>{T.destroy(),A.destroy(),L=0,O=(O=O.filter((e=>"Validated"!==e.type))).filter((e=>"Change Action"!==e.type)),(T=this.buildValidatedObjects(localStorage.getItem("DMUReviewPanel_validExpandedFlags"))).inject(B),z&&"R2V_Activity"!==z&&(A=this.buildChangeAction()).inject(B),te("updateIconValidated")},this.setPanelReadOnlyFlag=function(e){x=e.editionMode,a=e.readOnly,U.destroy(),T.destroy(),A.destroy(),O=(O=(O=O.filter((e=>"Validated"!==e.type))).filter((e=>"Change Action"!==e.type))).filter((e=>"Context"!==e.type)),L=0,(U=this.buildContext()).inject(B),(T=this.buildValidatedObjects()).inject(B),z&&"R2V_Activity"!==z&&(A=this.buildChangeAction()).inject(B),te("updateIconValidated")},this.setAddValidatedButtonVisibilityFlag=function(e){V=e},this.setDropZoneVisibilityFlag=function(e){Q=e},this.unsubscribe=function(e){null!=e&&W.unsubscribe(e)},this._processValidatedObjDeletion=function(){let e=P.getElementsByClassName("reviewPanel-dropValidatedObjZone");var t,n,i=!1;e.length&&Q&&["Requirement","R2V_Activity","Requirement Specification"].includes(z)&&e[0]&&e[0].show();var o=T.getElementsByClassName("validatedObjectExpander");for(t=O.length-1;t>=0;t--)if("Validated"===O[t].type)if(!1===O[t].expander.getMainDiv().isSelected())i||(O[t].id-=7);else{var a=O[t].expander.getMainDiv().getContent().getParent();O[t].expander.getMainDiv().getContent().destroy(),a.destroy(),O.splice(t,1),i=!0}for(L=0,n=0;n<o.length;n++)o[n].id=L,L+=7;var l=T.getElementsByClassName("reviewPanel-addValidatedButton");l.length>0&&l[0].show(),0===o.length&&(T.getElementsByClassName("reviewPanel-noValidatedDisplay")[0].show(),["Requirement","R2V_Activity","Requirement Specification","DELLmiWorkPlanSystemReference"].includes(z)?T.getElementsByClassName("flowContainer").length&&T.getElementsByClassName("flowContainer")[0].destroy():T.getElementsByClassName("validatedPlaceholder")[0].destroy(),l.length>0&&l[0].setStyles({"margin-top":"0px"}))},this.processChangeActionDeletion=function(){for(let t=O.length-1;t>=0;t--)if("Change Action"===O[t].type){var e=O[t].expander.getMainDiv().getContent().getParent();O[t].expander.getMainDiv().getContent().destroy(),e.destroy(),O.splice(t,1)}A.getElementsByClassName("reviewPanel-noCaDisplay")[0].show();let t=M.getElementsByClassName("reviewPanel-dropChangeActionZone");t.length&&t[0].show()},this.updateContextInformations=function(t){var n=N.getElementsByClassName("reviewPanel-contextObjDiv")[0];if(0===n.getElementsByClassName("contextObjectExpander").length){var i=new e.Element("div",{class:"flowContainer"});i.inject(n);var l=new o({objectData:{name:t.name,icon:t.icon,id:-1},editionMode:x,readOnly:a,onExpanderSelectedCB:ne,icons:j,type:"Context",panelType:{type:"reviewApp",app:Y},contextType:z}).inject(i);O.push({expander:l,id:-1,index:O.length,type:"Context"}),l.getContent().addClassName("contextObjectExpander"),l.getContent().id=-1,N.getElementsByClassName("reviewPanel-noContextDisplay")[0].hide()}},this.unSelectAllExpanders=function(){for(let e=0;e<O.length;e++)O[e].expander.getMainDiv().setSelectionVisibility(!1),"Validated"!==O[e].type&&"Context"!==O[e].type&&"Change Action"!==O[e].type||O[e].expander.getMainDiv().setAdditionalDivVisibleFlag(!1)},this.unSelectAllValidated=function(){for(let e=0;e<O.length;e++)"Validated"===O[e].type&&O[e].expander.getMainDiv().setSelectedFlag(!1)},this.unSelectExpander=function(e){for(let t=0;t<O.length;t++)O[t].id===e&&O[t].expander.getMainDiv().setSelectedFlag(!1)};var ne=function(e){var t;for(let t=0;t<O.length;t++)e.id!==O[t].id&&!e.element.isCheckBoxClicked()&&e.element.isSelected()&&(!e.event||e.event.shiftKey||e.event.ctrlKey||O[t].expander.getMainDiv().setSelectedFlag(!1));"Validated"===e.type||"Change Action"===e.type?((t={}).event=e.event,t.element=e.element,t.validatedRects=q,te("onValidatedSelected",t)):"Context"===e.type&&((t={}).event=e.event,t.element=e.element,t.validatedRects=q,te("onContextSelected",t))},ie=function(e){var t={id:e.id,type:e.type,expanders:O};te("onExpanderUnselectRequested",t)};this.updateHeaderIcon=function(e,t){for(let n=0;n<O.length;n++)O[n].id===parseInt(e)&&(O[n].expander.getMainDiv().setIcon({icon:t}),"Change Action"===O[n].type&&O[n].expander.getContent().getElementsByClassName("DMUCustomExpHeaderIcon")[0].setStyles({width:"16px",height:"16px"}))},this.updateHeaderLabel=function(e,t){for(let n=0;n<O.length;n++)O[n].id===parseInt(e)&&O[n].expander.getMainDiv().setLabel(t)};let oe=(t,n)=>{let i,o;if("Change Action"!==n){switch(z){case"Requirement Specification":case"Requirement":o=new e.Element("div",{text:C.reviewPanel.reqDropZoneInfo,class:"infoReq"});break;case"DIFLayout":o=new e.Element("div",{text:C.reviewPanel.difSheetDropZoneInfo,class:"infoReq"});break;case"DesignSight":o=new e.Element("div",{text:C.reviewPanel.msrDropZoneInfo,class:"infoReq"});break;case"DELLmiPPRHeaderProcessReferenceAbstract":case"DELLmiWorkPlanSystemReference":o=new e.Element("div",{text:C.reviewPanel.wkpDropZoneInfo,class:"infoReq"});break;case"R2V_Activity":o=new e.Element("div",{text:C.reviewPanel.r2vDropZoneInfo,class:"infoReq"});break;case null:o=new e.Element("div",{text:C.reviewPanel.noContextDropZoneInfo,class:"infoReq"})}i=new e.Element("div",{class:"reviewPanel-dropValidatedObjZone"}).inject(t),o.inject(i)}else o=new e.Element("div",{text:C.reviewPanel.caDropZoneInfo,class:"infoReq"}),i=new e.Element("div",{class:"reviewPanel-dropChangeActionZone"}).inject(t),o.inject(i);let a=new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-plus"}).inject(i);"check"===n?a.addClassName("objPlusIcon checksPanel-checkObjPlusIcon"):"Change Action"===n?a.addClassName("objPlusIcon reviewPanel-caObjPlusIcon"):a.addClassName("objPlusIcon reviewPanel-validatedObjPlusIcon"),a.hide(),i.ondrop=function(e){let t=h.getReviewContext({viewer:r.getViewer()}),i=t.getValidation().getValidated().getPathElements(),o=[],a=[];i.length>0&&i.forEach((e=>{o.push(e.pathElement)})),this.getElementsByClassName("objPlusIcon")[0].hide(),this.getElementsByClassName("infoReq")[0].show(),this.removeClassName("valDropZoneDrag"),e.preventDefault(),e.stopPropagation();let l=JSON.parse(e.dataTransfer.getData("Text"));if(l.data&&l.data.items&&l.data.items.length>0){let e=G,i=[];if("check"===n){for(let e=0;e<l.data.items.length;e++)-1!==["Requirement","Requirement Specification","Chapter"].indexOf(l.data.items[e].objectType)?i.push(l.data.items[e]):ee("warning",C.reviewPanel.DropRequirementObjError);e.fireEvent("onRequirementDropped",i)}else if("Change Action"===n)1===l.data.items.length&&"Change Action"===l.data.items[0].objectType&&e.fireEvent("onValidatedChangeActionUpdate",{updateType:"add",data:l.data.items[0]});else{let n=z;for(let i=0;i<l.data.items.length;i++)"DIFLayout"===n&&"DIFSheet"!==l.data.items[i].objectType?ee("warning",C.reviewPanel.DropValidatedObjError):"Requirement Specification"!==n||["Requirement Specification","Requirement","Chapter"].includes(l.data.items[i].objectType)?"DesignSight"===n&&"VPMReference"!==l.data.items[i].objectType?ee("warning",C.reviewPanel.DropValidatedObjError):"Requirement"===n&&"Requirement"!==l.data.items[i].objectType?ee("warning",C.reviewPanel.DropRequirementValidatedObjError):"R2V_Activity"!==n||"r2vsurvey"===l.data.items[i].serviceId&&t.getReviewCtxInformation().contextId===l.data.items[i].objectId?["Requirement Specification","Requirement","Chapter"].includes(l.data.items[i].objectType)?new Promise((t=>{let n,i={};i.cb=e=>{n=e},e.fireEvent("onGetLoadedReqSpecInformations",i),t(n)})).then((t=>{-1!==t.indexOf(l.data.items[i].objectId)?new Promise(((e,t)=>{o.forEach((e=>{e.includes(l.data.items[i].objectId)&&t()})),e()})).then((()=>{o.push([l.data.items[i].objectId]),a.push([l.data.items[i].objectId]),i===l.data.items.length-1&&e.fireEvent("onValidatedObjectDropped",{path:o,pathToAdd:a})}),(()=>{ee("warning",C.reviewPanel.ValidatedObjExist)})):["Requirement Specification","Requirement","Chapter"].includes(n)?ee("warning",C.reviewPanel.DropRequirementValidatedObjError):ee("warning",C.reviewPanel.DropValidatedObjError)})):"DIFSheet"===l.data.items[i].objectType?new Promise((t=>{let n,i={};i.cb=e=>{n=e},e.fireEvent("onGetLoadedSheetInformations",i),t(n)})).then((t=>{-1!==t.sheetIDList.indexOf(l.data.items[i].objectId)?new Promise(((e,t)=>{o.forEach((e=>{e.includes(l.data.items[i].objectId)&&t()})),e()})).then((()=>{o.push([l.data.items[0].objectId]),a.push([l.data.items[i].objectId]),i===l.data.items.length-1&&e.fireEvent("onValidatedObjectDropped",{path:o,pathToAdd:a})}),(()=>{ee("warning",C.reviewPanel.ValidatedObjExist)})):ee("warning",C.reviewPanel.DropValidatedObjError)})):"VPMReference"===l.data.items[i].objectType||"r2vsurvey"===l.data.items[i].serviceId?new Promise(((e,t)=>{o.forEach((e=>{e.includes(l.data.items[i].objectId)&&t()})),e()})).then((()=>{o.push([l.data.items[0].objectId]),a.push([l.data.items[i].objectId]),e.fireEvent("onValidatedObjectDropped",{path:o,pathToAdd:a,serviceId:"r2vsurvey"===l.data.items[i].serviceId?"r2vsurvey":""})}),(()=>{ee("warning",C.reviewPanel.ValidatedObjExist)})):"DELLmiWorkPlanSystemReference"===l.data.items[i].objectType?1===l.data.items.length&&"DELLmiWorkPlanSystemReference"===l.data.items[0].objectType&&(o.push([l.data.items[0].objectId]),a.push([l.data.items[0].objectId]),e.fireEvent("onValidatedObjectDropped",{path:o,pathToAdd:a})):"DELLmiHeaderWorkPlanReference"===l.data.items[i].objectType?1===l.data.items.length&&"DELLmiHeaderWorkPlanReference"===l.data.items[0].objectType&&(o.push([l.data.items[0].objectId]),a.push([l.data.items[0].objectId]),e.fireEvent("onValidatedObjectDropped",{path:o,pathToAdd:a})):"DELLmiHeaderOperationReference"===l.data.items[i].objectType&&1===l.data.items.length&&"DELLmiHeaderOperationReference"===l.data.items[0].objectType&&(o.push([l.data.items[0].objectId]),a.push([l.data.items[0].objectId]),e.fireEvent("onValidatedObjectDropped",{path:o,pathToAdd:a})):ee("warning",C.reviewPanel.DropRequirementValidatedObjError):ee("warning",C.reviewPanel.DropValidatedObjError)}}},i.ondragenter=function(e){e.preventDefault(),e.stopPropagation(),this.getElementsByClassName("objPlusIcon")[0].show(),this.getElementsByClassName("infoReq")[0].hide(),this.addClassName("valDropZoneDrag")},i.ondragleave=function(){this.getElementsByClassName("objPlusIcon")[0].hide(),this.getElementsByClassName("infoReq")[0].show(),this.removeClassName("valDropZoneDrag")},i.ondragover=function(e){e.preventDefault(),e.stopPropagation()},i.ondragend=function(e){e.preventDefault(),e.stopPropagation()}};this.buildPanel=function(t){return k=t.validatedNames,E=t.changeActionName,_=t.onAddValidatedClicked,a=t.readOnlyFlag,r=t.frmWindow,x=t.editionMode,z=t.contextType,Y=t.appId,G=h.giveEventsController({viewer:r.getViewer()}),Z=t.restrictions,K=t.openWithMenu,J=t.openWithCAMenu,$=t.openCtxWithMenu,y||(y=e.createElement("div",{class:"DMUReviewPanelMainDiv"})),y.setStyles({height:"98%","overflow-y":"hidden"}),(S=new m({draggable:!0,height:60..toString()+"px",onDragStart:function(){return t.reviewDragContent||""},sectionLabel:t.panelTitle?t.panelTitle:C.dmuPanelTitle,cmdList:t.contextualCmdList,quickAccessBtnList:t.quickAccessBtnList,doubleClickCB:function(){te("onPanelResized")}})).getContent().addClassName("reviewPanelSectionHeader"),y.appendChild(S.getContent()),B=e.createElement("div",{class:"reviewPanel-reviewContent"}),t.contextNames?(R=t.contextNames,(U=this.buildContext()).inject(B)):(U=this.buildContext()).inject(B),(T=this.buildValidatedObjects()).inject(B),z&&"R2V_Activity"!==z&&(A=this.buildChangeAction()).inject(B),(F=this.buildMarkups()).inject(B),F.hide(),(D=(new i).inject(y)).getInnerElement().setContent(B),D.getContent().setStyle("height","calc(100% - 60px)"),y},this.updateReviewPanelContent=function(e){const t=h.getReviewContext({viewer:r.getViewer()}).getValidation();e.reviewNoContextMode?(U.setStyles({display:"block"}),T.setStyles({display:"none"}),t&&"Activated"===t.getRestrictedEditionFlag()&&"PRIVATE"===t.getCurrentState()?F.hide():F.show()):(U.setStyles({display:"block"}),T.setStyles({display:"block"}),!e.rootType||"DIFLayout"!==e.rootType&&"Requirement Specification"!==e.rootType&&"DesignSight"!==e.rootType?"Document"===e.rootType?(T.querySelector(".reviewPanel-addValidatedButton")&&T.querySelector(".reviewPanel-addValidatedButton").hide(),T.querySelector(".reviewPanel-dropValidatedObjZone")&&T.querySelector(".reviewPanel-dropValidatedObjZone").hide()):T.querySelector(".reviewPanel-dropValidatedObjZone")&&T.querySelector(".reviewPanel-dropValidatedObjZone").hide():T.querySelector(".reviewPanel-addValidatedButton")&&T.querySelector(".reviewPanel-addValidatedButton").hide(),F.hide())},this.cleanPanel=function(){if(y){for(;y.firstChild;)y.removeChild(y.firstChild);S&&S.clear(),D&&D.destroy(),S=D=y=null,H=null}},this.buildContext=function(t){(N=new e.Element("div",{class:"reviewPanel-contextDiv"})).setStyles({"padding-top":"10px"}),new e.Element("div",{text:C.reviewPanel.contextExpanderTitle,class:"reviewPanel-contextTitle"}).inject(N);var n,i=new e.Element("div",{class:"reviewPanel-contextObjDiv"}).inject(N),r=new l({displayStyle:"lite",label:"lite displayStyle",icon:{iconName:"open-in-a-new-window wux-ui-3ds",fontIconFamily:WUXManagedFontIcons.Font3DS},showLabelFlag:!1});if(r.getContent().addClassName("reviewPanel-ctxOpenWithButton"),r.getContent().id=L,n=new e.Element("div",{class:"reviewPanel-ctxOpenWithPlaceholder"}),s.getTouchMode()&&(r.getContent().setStyles({"min-height":"23px"}),n.setStyles({height:"auto"})),r.inject(n),r.getContent().onclick=async function(e){if($&&e){let n=await $();var t=e.event?e.event:e;t.stopPropagation();let i=t.pageX?{x:t.pageX,y:t.pageY}:null;i||(i=t.screenX?{x:t.screenX,y:t.screenY}:null),!i&&t.type&&-1!==t.type.indexOf("touch")&&t.changedTouches&&t.changedTouches[0]&&(i=(t=t.changedTouches[0]).pageX?{x:t.pageX,y:t.pageY}:null,i||(i=t.screenX?{x:t.screenX,y:t.screenY}:null)),i||(i={x:0,y:0}),f.show(n,{position:{x:i.x,y:i.y}})}},R&&R.length){var d=new e.Element("div",{class:"flowContainer"});d.inject(i);var c=new o({objectData:{name:"",icon:t,id:-1},editionMode:x,readOnly:a,onExpanderSelectedCB:ne,onExpanderUnselectCB:ie,icons:j,ctxOpenWithButton:n,type:"Context",panelType:{type:"reviewApp",app:Y},contextType:z}).inject(d);O.push({expander:c,id:-1,index:O.length,type:"Context"}),c.getContent().id=-1,c.getMainDiv().setAdditionalDivVisibleFlag(!1),c.getContent().addClassName("contextObjectExpander")}var u=new e.Element("div",{text:C.reviewPanel.noContext,class:"reviewPanel-noContextDisplay"});return u.inject(i),R&&R.length&&u.hide(),N},this.buildValidatedObjects=function(){let t=h.getReviewContext({viewer:r.getViewer()});if(t.getValidation().getContext()){let e=t.getValidation().getContext().getJsonContextTypes()[0],n=p.getParentType(e)?p.getParentType(e):e;if(["Requirement Specification","Requirement","Document","Specification Report","DesignSight","R2V_Activity"].includes(n)){let e=t.getValidation().getValidated().getPathElements();e.length&&e.forEach((e=>{t.getValidation().addValidatedNode({docInfo:{validatedId:t.getValidation().getValidated().getPlmID(),validatedPaths:e.pathElement,validatedName:e.referenceName,validatedType:e.referenceType}})}))}}var n=new e.Element("div",{class:"reviewPanel-validDiv"}),i=new e.Element("div",{class:"reviewPanel-validatedHeaderDiv"}).inject(n);new e.Element("div",{text:C.reviewPanel.validatedObjectsExpanderTitle,class:"reviewPanel-validatedTitle"}).inject(i),P=new e.Element("div",{class:"reviewPanel-validObjDiv"}).inject(n);let o=new e.Element("div",{text:C.reviewPanel.noValidatedObject,class:"reviewPanel-noValidatedDisplay"});const d=["DIFLayout","Requirement Specification","Requirement","DesignSight","R2V_Activity","DELLmiWorkPlanSystemReference","DELLmiPPRHeaderProcessReferenceAbstract"];if(d.includes(z)||!z){if(!a&&x&&Z.review.canEditValObj){var c=new e.Element("div",{class:"validatedPlaceholder"});c.inject(P),oe(c,"validatedObject")}if(k.length>0){o.hide();for(var u=0;u<k.length;u++)this.addValidatedObject(k[u])}}if((!d.includes(z)||!z)&&((v=new l({displayStyle:"icon",icon:{iconName:"plus",fontIconFamily:WUXManagedFontIcons.font3DS},type:"check"}).inject(i)).getContent().addClassName("reviewPanel-addValidatedButton"),s.getTouchMode()||v.getContent().setStyles({"padding-left":"12px"}),v.touchMode=!1,v.hide(),!a&&x&&Z.review.canEditValObj&&(v.show(),V&&v.getContent().hide(),v.getContent().addEventListener("change",(function(e){var t=e.dsModel;!0===t.checkFlag?_(t.checkFlag):te("onUpdateValidatedListCmdCancel")}))),k.length>0)){o.hide();for(var m=0;m<k.length;m++)this.addValidatedObject(k[m])}return new e.Element("div",{class:"validatedObjects"}).inject(P),o.inject(P),n},this.addValidatedObject=function(t,n){let i=P.getElementsByClassName("reviewPanel-addValidatedButton");i.length&&V&&i[0]&&i[0].hide();let c=P.getElementsByClassName("reviewPanel-dropValidatedObjZone");c.length&&!Q&&["Requirement","R2V_Activity"].includes(z)&&c[0]&&c[0].hide();var u=P.getElementsByClassName("reviewPanel-noValidatedDisplay");u.length&&u[0].hide(),v&&!0===v.checkFlag&&(v.checkFlag=!1);let h=P.getElementsByClassName("reviewPanel-dropValidatedObjZone")[0];var m,p=P.getElementsByClassName("validatedPlaceholder")[0];h&&p&&p.removeChild(h),p||(p=new e.Element("div",{class:"validatedPlaceholder"})),p.inject(P);var g,w=new l({displayStyle:"lite",label:"lite displayStyle",icon:{iconName:"remove",fontIconFamily:WUXManagedFontIcons.Font3DS},showLabelFlag:!1});w.getContent().addClassName("reviewPanel-validRemoveButton hideOnHover"),w.getContent().id=L,x&&Z.review.canEditValObj&&(m=new e.Element("div",{class:"reviewPanel-validRemovePlaceholder"}),-1===["Document","Specification Report","DIFSheet","Drawing"].indexOf(z)&&w.inject(m),s.getTouchMode()&&(m.setStyles({height:"auto"}),w.getContent().setStyles({"min-height":"auto",height:"auto","line-height":"unset"}))),w.getContent().onclick=function(e){e.preventDefault(),e.stopPropagation();new d({title:C.reviewPanel.removeValidatedObjectTitle,message:C.reviewPanel.removeValidatedObject,checkboxMessage:null,checked:!1,frmWindow:r.getImmersiveFrame(),callbacks:{onValidateCB:function(){te("onValidatedRemove"),null},onCancelCB:function(){null},onCloseCB:function(){null}}})};var b=new l({displayStyle:"lite",label:"lite displayStyle",icon:{iconName:"open-in-a-new-window wux-ui-3ds",fontIconFamily:WUXManagedFontIcons.Font3DS},showLabelFlag:!1});b.getContent().addClassName("reviewPanel-validOpenWithButton"),b.getContent().id=L,g=new e.Element("div",{class:"reviewPanel-validOpenWithPlaceholder"}),b.inject(g),s.getTouchMode()&&(g.setStyles({height:"auto"}),b.getContent().setStyles({"min-height":"auto",height:"auto","line-height":"unset"})),b.getContent().onclick=async function(e){if(K&&e&&e.currentTarget&&e.currentTarget.id){let n=await K(e.currentTarget.id);var t=e.event?e.event:e;t.stopPropagation();let i=t.pageX?{x:t.pageX,y:t.pageY}:null;i||(i=t.screenX?{x:t.screenX,y:t.screenY}:null),!i&&t.type&&-1!==t.type.indexOf("touch")&&t.changedTouches&&t.changedTouches[0]&&(i=(t=t.changedTouches[0]).pageX?{x:t.pageX,y:t.pageY}:null,i||(i=t.screenX?{x:t.screenX,y:t.screenY}:null)),i||(i={x:0,y:0}),f.show(n,{position:{x:i.x,y:i.y}})}};var y=new e.Element("div",{class:"flowContainer"}).inject(p),D=new o({objectData:{name:t,icon:n,id:L},editionMode:x,readOnly:a,onExpanderSelectedCB:ne,onExpanderUnselectCB:ie,validRemoveButton:m,validOpenWithButton:g,icons:j,type:"Validated",panelType:{type:"reviewApp",app:Y}}).inject(y);return D.getContent().addClassName("validatedObjectExpander"),D.getContent().id=L,q.push(D),O.push({expander:D,id:L,index:O.length,type:"Validated"}),L+=7,D.getMainDiv().setAdditionalDivVisibleFlag(!1),h&&h.inject(p),D},this.buildChangeAction=function(){var t=new e.Element("div",{class:"reviewPanel-caDiv"}),n=new e.Element("div",{class:"reviewPanel-caHeaderDiv"}).inject(t);new e.Element("div",{text:C.reviewPanel.changeActionExpanderTitle,class:"reviewPanel-caTitle"}).inject(n),M=new e.Element("div",{class:"reviewPanel-caObjDiv"}).inject(t);let i=new e.Element("div",{text:C.reviewPanel.noChangeAction,class:"reviewPanel-noCaDisplay"});if(!["R2V_Activity"].includes(z)||!z){if(!a&&x&&Z.review.canEditValObj){var o=new e.Element("div",{class:"caPlaceholder"});o.inject(M),oe(o,"Change Action")}E&&(i.hide(),this.addChangeAction(E))}return i.inject(M),t},this.addChangeAction=function(t,n){var i=M.getElementsByClassName("reviewPanel-noCaDisplay");i.length&&i[0].hide();let c=M.getElementsByClassName("reviewPanel-dropChangeActionZone")[0];var u,h=M.getElementsByClassName("caPlaceholder")[0];c&&c.hide(),h||(h=new e.Element("div",{class:"caPlaceholder"})).inject(M);var m,p=new l({displayStyle:"lite",label:"lite displayStyle",icon:{iconName:"remove",fontIconFamily:WUXManagedFontIcons.Font3DS},showLabelFlag:!1});p.getContent().addClassName("reviewPanel-caRemoveButton hideOnHover"),p.getContent().id=-2,x&&Z.review.canEditValObj&&(u=new e.Element("div",{class:"reviewPanel-caRemovePlaceholder"}),p.inject(u),s.getTouchMode()&&(u.setStyles({height:"auto"}),p.getContent().setStyles({"min-height":"auto",height:"auto","line-height":"unset"}))),p.getContent().onclick=function(e){e.preventDefault(),e.stopPropagation();new d({title:C.reviewPanel.removeChangeActionTitle,okLabel:C.reviewPanel.removeChangeActionTitle,message:C.reviewPanel.removeChangeAction,checkboxMessage:null,checked:!1,frmWindow:r.getImmersiveFrame(),callbacks:{onValidateCB:function(){G.fireEvent("onValidatedChangeActionUpdate",{updateType:"remove",data:void 0}),null},onCancelCB:function(){null},onCloseCB:function(){null}}})};var g=new l({displayStyle:"lite",label:"lite displayStyle",icon:{iconName:"open-in-a-new-window wux-ui-3ds",fontIconFamily:WUXManagedFontIcons.Font3DS},showLabelFlag:!1});g.getContent().addClassName("reviewPanel-caOpenWithButton"),g.getContent().id=L,m=new e.Element("div",{class:"reviewPanel-caOpenWithPlaceholder"}),g.inject(m),s.getTouchMode()&&(m.setStyles({height:"auto"}),g.getContent().setStyles({"min-height":"auto",height:"auto","line-height":"unset"})),g.getContent().onclick=async function(e){if(J){let n=await J();var t=e.event?e.event:e;t.stopPropagation();let i=t.pageX?{x:t.pageX,y:t.pageY}:null;i||(i=t.screenX?{x:t.screenX,y:t.screenY}:null),!i&&t.type&&-1!==t.type.indexOf("touch")&&t.changedTouches&&t.changedTouches[0]&&(i=(t=t.changedTouches[0]).pageX?{x:t.pageX,y:t.pageY}:null,i||(i=t.screenX?{x:t.screenX,y:t.screenY}:null)),i||(i={x:0,y:0}),f.show(n,{position:{x:i.x,y:i.y}})}};var v=new e.Element("div",{class:"flowContainer"}).inject(h),w=new o({objectData:{name:t,icon:n,id:"-2"},editionMode:x,readOnly:a,onExpanderSelectedCB:ne,onExpanderUnselectCB:ie,caRemoveButton:u,caOpenWithButton:m,icons:j,type:"Change Action",panelType:{type:"reviewApp",app:Y}}).inject(v);w.getContent().addClassName("changeActionExpander"),w.getContent().id="-2";var b=w.getContent().getElementsByClassName("DMUCustomExpHeaderIcon");return b.length&&b[0].setStyles({width:"16px",height:"16px"}),O.push({expander:w,id:-2,index:O.length,type:"Change Action"}),w.getMainDiv().setAdditionalDivVisibleFlag(!1),w},this.buildMarkups=function(){var t=new e.Element("div",{class:"reviewPanel-markupsDiv"}),n=new e.Element("div",{class:"reviewPanel-markupsHeaderDiv"}).inject(t);new e.Element("div",{text:"Markups",class:"reviewPanel-markupsTitle"}).inject(n),I=new e.Element("div",{class:"markupsObjDiv"}).inject(t);var i=new e.Element("div",{text:C.reviewPanel.noMarkup,class:"reviewPanel-noMarkupDisplay"});return i.inject(I),H.length>0&&i.hide(),a||((w=new l({displayStyle:"icon",icon:{iconName:"plus",fontIconFamily:WUXManagedFontIcons.font3DS}}).inject(n)).getContent().addClassName("reviewPanel-addMarkupButton"),w.getContent().setStyles({"padding-left":"12px"}),w.getContent().addEventListener("buttonclick",(function(){te("onMarkupCreationRequested")}))),t},this.addNewMarkup=function(t){var i=I.getElementsByClassName("reviewPanel-noMarkupDisplay");i.length&&(i[0].hide(),w&&w.getContent().setStyles({"margin-top":"0px"}));var o=new e.Element("div",{class:"reviewPanel-markupPlaceholder"});o.inject(I);var a=new e.Element("div",{class:"reviewPanel-markupRect",id:t.id});a.inject(o),new e.createElement("span",{class:"reviewPanel-markupIcon wux-ui-3ds wux-ui-3ds-markup-review new-glyph"}).inject(a),new e.Element("div",{text:t.title,class:"reviewPanel-markupName"}).inject(a);let l=g.addEventListener(a,{callback:function(e){let i={id:t.id,event:e.data.event},o=i.event.from?i.event.from[0].event:i.event,a=o.pageX?{x:o.pageX,y:o.pageY}:null;a||(a=o.screenX?{x:o.screenX,y:o.screenY}:null),!a&&o.type&&-1!==o.type.indexOf("touch")&&o.changedTouches&&o.changedTouches[0]&&(o=o.changedTouches[0],a=o.pageX?{x:o.pageX,y:o.pageY}:null,a||(a=o.screenX?{x:o.screenX,y:o.screenY}:null)),a||(a={x:0,y:0}),i.position=new n.Vector2(a.x,a.y),te("onMarkupCtxMenuRequired",i)}});H.push({title:t.title,content:t.content,id:t.id,ctxMenuToken:l})},this.removeMarkup=function(e){b},this.setPanelQuickAccessCommands=function(e){S&&(S.closeContextualSectionHeader(),S.setQuickAccessCommands(e))},this.updateValidationStatusWarning=function(e){}}})})),define("DS/DMUControls/panels/DMUChecksPanel",["UWA/Core","UWA/Class","UWA/Controls/ThemedScroller","DS/DMUControls/DMUReviewExpander","DS/Controls/Button","DS/Windows/Dialog","DS/CoreEvents/ModelEvents","DS/CATWebUXComponents/CATWebUXSectionHeader","DS/Menu/Menu","i18n!DS/DMUControls/assets/nls/DMUControls","css!DS/DMUControls/DMUControls.css"],(function(e,t,n,i,o,a,l,s,r,d){"use strict";return t.extend({init:function(t){var c,u;this._parent(t);var h,m,p,g,f,C,v,w,b,y,D,S,x,E,k=[],M=new l,P=[],I=[];let U,T;var A;let F;var B=function(e,t){return M.publish({event:e,data:t,context:this})};this.subscribe=function(e,t){if(e&&t)return M.subscribe({event:e},t)},this.getColumnMinimumWidth=function(){return 273},this.getColumnWidthStep=function(){return 240},this.setRestrictions=e=>{U=e},this.getSectionHeader=function(){return g},this.expandAll=function(){for(let e=0;e<k.length;e++)k[e].expander.expand()},this.collapseAll=function(){for(let e=0;e<k.length;e++)k[e].expander.collapse()},this.getExpanders=function(){return k},this.updatePanel=()=>{w.destroy(),k=k.filter((e=>"Check"!==e.type)),(w=this.buildChecks(localStorage.getItem("DMUReviewPanel_checkExpandedFlags"))).inject(b)},this.setPanelReadOnlyFlag=function(e){f=e.editionMode,c=e.readOnly,w.destroy();var t=localStorage.getItem("DMUReviewPanel_checkExpandedFlags");(w=this.buildChecks(t)).inject(b)},this.removeRequirement=function(e){for(let t=0;t<k.length;t++)k[t].id===e.checkId&&k[t].expander.removeRequirement()},this.scrollToCheck=function(e,t){if(e&&e.checkId){var n;for(let t=0;t<k.length;t++)k[t].id===e.checkId&&(n=k[t],k[t].expander.getMainDiv().setSelectedFlag(!0));n&&(A&&clearTimeout(A),A=setTimeout((function(){if(p){let e=p.getInnerElement();if(e){let i=n.expander.getContent();if(i){let o=e.scrollTop+i.getPosition().y;e.scrollTo({top:o,behavior:"smooth"}),n.expander.getMainDiv().expand(),t()}}}A=null}),100))}},this.addRequirement=function(e){for(let t=0;t<k.length;t++)k[t].id===e.checkId&&k[t].expander.addRequirement(e.checkId,e.requirementId,e.requirementTitle);for(let t=0;t<C.length;t++)C[t].id===e.checkId&&I[e.checkId]&&(I[e.checkId].requirements=C[t].requirements)},this.unsubscribe=function(e){null!=e&&M.unsubscribe(e)};var R=function(t,n){var i=e.createElement("div",{class:"DMURemoveValidatedMainDiv"});new e.Element("div",{text:d.reviewPanel.removeRequirement,class:"warningMessage"}).inject(i);var l=new o({emphasize:"primary",label:d.reviewPanel.YesBtn?d.reviewPanel.YesBtn:"Yes",onClick:function(){B("onRequirementRemoveRequested",{type:"ValidationRequirement",checkId:t,objectId:n}),y&&y.destroy()}});l.getContent().addClassName("confirmRemoveButton");var s=new o({label:d.reviewPanel.NoBtn?d.reviewPanel.NoBtn:"No",onClick:function(){y&&y.destroy()}});y=new a({modalFlag:!0,ensureHeightDefinitionOnHierarchy:!0,title:d.reviewPanel.removeImpactedCheckTitle,resizableFlag:!0,immersiveFrame:u.getImmersiveFrame(),buttons:{Ok:l,Cancel:s},width:400,content:i})};this.removeImpactedCheck=function(e){var t=e.highlightId,n=e.checkId;for(let e=0;e<k.length;e++)k[e].id===n&&k[e].expander.removeImpactedCheck(t,n);let i=P[n];if(i){let e=-1;for(let n=0;n<i.length;n++)if(i[n]&&i[n].id===t){e=n;break}e>=0&&i.splice(e,1)}},this.updateImpactedCheckDisplay=function(e){if("Highlight"===e.type){let t=v.filter((t=>t.id===e.id))[0];e.name&&(t.name=e.name),e.rating&&(t.rating=parseInt(e.rating)),e.description&&(t.description=e.description);for(let t=0;t<k.length;t++)"Check"===k[t].type&&k[t].expander.updateAssociatedHighlightsDisplay(e)}},this.addImpactedCheck=function(e){var t=e.highlightId,n=e.highlightRating,i=e.highlightTitle,o=e.checkId;P[o]||(P[o]=[]),P[o].push({id:t,rating:n,name:i});for(let e=0;e<k.length;e++)k[e].id===o&&k[e].expander.addImpactedCheck({highlight:{id:t,rating:n,name:i}})},this.unSelectAllExpanders=function(){for(let t=0;t<k.length;t++){k[t].expander.getMainDiv().setSelectionVisibility(!1);var e=k[t].expander.getMainDiv().getContent().getElementsByClassName("checksPanel-requirementRemoveButton");if(e.length)for(let n=0;n<e.length;n++)e[n].id===k[t].id&&e[n].hide()}},this.unSelectAllValidated=function(){for(let e=0;e<k.length;e++)"Validated"===k[e].type&&k[e].expander.getMainDiv().setSelectedFlag(!1)},this.unSelectExpander=function(e){for(let t=0;t<k.length;t++)k[t].id===e&&k[t].expander.getMainDiv().setSelectedFlag(!1)},this.updateCheckStatus=function(e,t){for(let i=0;i<k.length;i++)if(k[i].id===e){k[i].expander.setCheckComboValue(!0);var n=k[i].expander.getContent().getElementsByClassName("checksPanel-statusCombo");n.length&&(n[0].dsModel.value=t-1)}},this.updateCheckDisplay=function(e){for(let n=0;n<e.length;n++){for(let i=0;i<k.length;i++)if(k[i].id===e[n]){var t=k[i].expander.getContent().getParent();k[i].expander.destroy(),t.destroy()}_(e[n])}0===C.length&&w.getElementsByClassName("checksPanel-noCheckDisplay")[0].show()};var j=async function(e){if(F&&e&&e.currentTarget&&e.currentTarget.id){let n=await F(I[e.currentTarget.id].requirements[0].getPlmID());var t=e.event?e.event:e;t.stopPropagation();let i=t.pageX?{x:t.pageX,y:t.pageY}:null;i||(i=t.screenX?{x:t.screenX,y:t.screenY}:null),!i&&t.type&&-1!==t.type.indexOf("touch")&&t.changedTouches&&t.changedTouches[0]&&(i=(t=t.changedTouches[0]).pageX?{x:t.pageX,y:t.pageY}:null,i||(i=t.screenX?{x:t.screenX,y:t.screenY}:null)),i||(i={x:0,y:0}),r.show(n,{position:{x:i.x,y:i.y}})}},_=function(e){var t,n=[];for(t=0;t<C.length;t++)C[t].id!==e?n[C[t].id]={name:C[t].name,id:C[t].id,requirements:C[t].requirements,status:C[t].status,expander:I[C[t].id].expander}:(C.splice(t,1),t-=1);for(t=0;t<k.length;t++)k[t].id===e&&k.splice(t,1);for(t=0;t<k.length;t++)k[t].index=t;I=[],I=n},N=function(e){var t,n=0;for(let t=0;t<k.length;t++)e.id===k[t].id?n=k[t].index:!e.element.isCheckBoxClicked()&&e.element.isSelected()&&(!e.event||e.event.shiftKey||e.event.ctrlKey||k[t].expander.getMainDiv().setSelectedFlag(!1));var i=e.element.getContent().getElementsByClassName("checksPanel-requirementRemoveButton");if(i.length)for(let t=0;t<i.length;t++)i[t].id===e.id&&i[t].show();t={event:e.event,element:e.element,index:n,expanders:k},B("onExpanderSelectionRequested",t)},L=function(e){var t=e.element.getContent().getElementsByClassName("checksPanel-requirementRemoveButton");if(t.length)for(let n=0;n<t.length;n++)t[n].id===e.id&&t[n].hide();var n={id:e.id,type:e.type,expanders:k};B("onExpanderUnselectRequested",n)};this.getImpactedChecksById=function(){for(var e=0;e<C.length;e++)I[C[e].id]=C[e];for(var t=0;t<v.length;t++){var n=v[t].associatedCheck;if(n)for(var i=0;i<n.length;i++)P[n[i]]||(P[n[i]]=[]),P[n[i]].push({id:v[t].id,rating:v[t].rating,name:v[t].name})}},this.updateHeaderIcon=function(e,t){for(let n=0;n<k.length;n++)k[n].id===parseInt(e)&&k[n].expander.getMainDiv().setIcon({icon:t})},this.updateHeaderLabel=function(e,t){for(let n=0;n<k.length;n++)k[n].id===parseInt(e)&&k[n].expander.getMainDiv().setLabel(t)};var O=function(e,t,n){"name"===t&&B("onCheckAttributeChanged",{objectId:e,name:n}),"status"===t&&B("onCheckAttributeChanged",{objectId:e,status:n}),"description"===t&&B("onCheckAttributeChanged",{objectId:e,description:n})},W=function(e,t,n){B("onRequirementAddRequested",{checkId:e,requirementId:t,requirementTitle:n})};this.buildPanel=function(t){var i=localStorage.getItem("DMUReviewPanel_checkExpandedFlags");return F=t.openWithMenu,C=t.checks,v=t.highlights,D=t.icons,S=t.highlightIcons,E=t.onRequirementObjClicked,x=t.onAttachedObjClicked,c=t.readOnlyFlag,u=t.frmWindow,f=t.editionMode,T=t.appId,U=t.restrictions,this.getImpactedChecksById(),m||(m=e.createElement("div",{class:"DMUChecksPanelMainDiv"})),m.setStyles({height:"100%","overflow-y":"hidden"}),(g=new s({draggable:!1,height:60..toString()+"px",onDragStart:function(){return t.reviewDragContent||""},sectionLabel:d.reviewPanel.checksPanelHeaderTitle,cmdList:t.contextualCmdList,quickAccessBtnList:t.quickAccessBtnList,doubleClickCB:function(){B("onPanelResized")}})).getContent().addClassName("reviewPanelSectionHeader"),g.getContent().getElementsByClassName("CATWebUXSectionHeaderLabel")[0].setStyles({"padding-left":"7px"}),m.appendChild(g.getContent()),b=e.createElement("div",{class:"checksPanel-checksContent"}),(w=this.buildChecks(i)).inject(b),(p=(new n).inject(m)).getInnerElement().setContent(b),p.getContent().setStyle("height","calc(100% - 40px)"),m},this.cleanPanel=function(){if(m){for(;m.firstChild;)m.removeChild(m.firstChild);g&&g.clear(),p&&p.destroy(),g=p=m=null}},this.buildChecks=function(){h=new e.Element("div",{class:"checksPanel-checksExpanders"});var t=new e.Element("div",{text:d.reviewPanel.noCheck,class:"checksPanel-noCheckDisplay"});t.inject(h),C.length>0&&t.hide();for(var n=0;n<C.length;n++){I[C[n].id]||(I[C[n].id]={name:C[n].name,status:parseInt(C[n].status),description:C[n].description,id:C[n].id});var o=new e.Element("div",{class:"flowContainer"}).inject(h),a=new i({objectData:C[n],editionMode:f,checkEditMode:U.check,readOnly:c,onCheckAttributeChanged:O,onRequirementDrop:W,onRequirementOpenWithClicked:j,onRequirementRemove:R,onExpanderSelectedCB:N,onExpanderUnselectCB:L,onRequirementObjClicked:E,onAttachedObjClicked:x,icons:D,highlightIcons:S,impChecksInfos:P,type:"Check",panelType:{type:"reviewApp",app:T}}).inject(o);k.push({expander:a,id:C[n].id,index:k.length,type:"Check"}),a.getContent().id=C[n].id}return h},this.addNewCheck=function(t){C.push({name:t.name,description:t.description,requirements:t.requirements?t.requirements:[],status:t.status,id:t.id}),I[t.id]={name:t.name,status:t.status,description:t.description,requirements:t.requirements?t.requirements:[],id:t.id},h.getElementsByClassName("checksPanel-noCheckDisplay")[0].hide();var n=new e.Element("div",{class:"flowContainer"}).inject(h),o=new i({objectData:t,editionMode:f,checkEditMode:U.check,readOnly:c,onCheckAttributeChanged:O,onRequirementDrop:W,onRequirementOpenWithClicked:j,onRequirementRemove:R,onExpanderSelectedCB:N,onExpanderUnselectCB:L,onRequirementObjClicked:E,onAttachedObjClicked:x,icons:D,highlightIcons:S,impChecksInfos:P,type:"Check",panelType:{type:"reviewApp",app:T}}).inject(n);k.push({expander:o,id:t.id,index:k.length,type:"Check"}),o.getContent().id=t.id,o.getMainDiv().setSelectedFlag(!0,t.evt),o.getMainDiv().expand()},this.setPanelQuickAccessCommands=function(e){g&&(g.closeContextualSectionHeader(),g.setQuickAccessCommands(e))}}})})),define("DS/DMUControls/panels/DMUHighlightsPanel",["UWA/Core","UWA/Class","UWA/Controls/ThemedScroller","DS/DMUControls/DMUReviewExpander","DS/Controls/Button","DS/Windows/Dialog","DS/CoreEvents/ModelEvents","DS/CATWebUXComponents/CATWebUXSectionHeader","i18n!DS/DMUControls/assets/nls/DMUControls","css!DS/DMUControls/DMUControls.css"],(function(e,t,n,i,o,a,l,s,r){"use strict";return t.extend({init:function(t){var d,c;this._parent(t);var u,h,m,p,g,f,C,v,w,b,y,D,S,x,E,k=[],M=new l,P=[],I=[];let U,T,A,F;var B=function(e,t){return M.publish({event:e,data:t,context:this})};this.subscribe=function(e,t){if(e&&t)return M.subscribe({event:e},t)},this.getColumnMinimumWidth=function(){return 273},this.getColumnWidthStep=function(){return 240},this.setRestrictions=e=>{A=e},this.getSectionHeader=function(){return p},this.deactiveButtons=function(){for(let e=0;e<k.length;e++)"Highlight"===k[e].type&&k[e].expander.deactivatePlusButtons()},this.expandAll=function(){for(let e=0;e<k.length;e++)k[e].expander.expand()},this.collapseAll=function(){for(let e=0;e<k.length;e++)k[e].expander.collapse()},this.updatePanel=()=>{v.destroy(),(v=this.buildHighlights(localStorage.getItem("DMUReviewPanel_highlightExpandedFlags"))).inject(w)},this.setPanelReadOnlyFlag=function(e){g=e.editionMode,d=e.readOnly,v.destroy();var t=localStorage.getItem("DMUReviewPanel_highlightExpandedFlags");(v=this.buildHighlights(t)).inject(w)},this.addIssue=function(e){I[e.highlightId].issues.push(e.id);for(let t=0;t<k.length;t++)k[t].id===e.highlightId&&k[t].expander.addIssue(e.id,e.name)},this.addTask=function(e){I[e.highlightId].tasks.push(e.id);for(let t=0;t<k.length;t++)k[t].id===e.highlightId&&k[t].expander.addTask(e.id,e.name)},this.addCa=function(e){I[e.highlightId].changeAction.push(e.id);for(let t=0;t<k.length;t++)k[t].id===e.highlightId&&k[t].expander.addCA(e.id,e.name)},this.getExpanders=function(){return k},this.updateSlidePreview=function(e){for(let i=0;i<k.length;i++)if(k[i].id===e.id){var t=k[i].expander.getContent().getElementsByClassName("highlightsPanel-thumbnail");t.length&&t[0].dsModel.remove();var n=k[i].expander.getContent().getElementsByClassName("highlightsPanel-editableHighlightThumbDiv");n.length&&n[0].destroy()}},this.updateHighlightAttributes=function(e){for(let o=0;o<k.length;o++)if(k[o].id===e.objectId){k[o].expander.getMainDiv().setLabel(e.name);var t=k[o].expander.getContent().getElementsByClassName("highlightsPanel-highlightDescriptionEditor");if(t.length&&(t[0].dsModel.value=e.description,W(e.objectId,"description",e.description)),e.priority){var n=k[o].expander.getContent().getElementsByClassName("highlightsPanel-highlightRatingCombo");if(n.length){var i=1;switch(e.priority){case"Low":i=2;break;case"Medium":i=3;break;case"High":i=4;break;case"Urgent":i=6}n[0].dsModel.value=i,W(e.objectId,"rating",i)}}}},this.unsubscribe=function(e){null!=e&&M.unsubscribe(e)},this.updateImpactedCheckDisplay=function(e){if("Check"===e.type){let t=f.filter((t=>t.id===e.id))[0];e.name&&(t.name=e.name),e.status&&(t.status=e.status),e.description&&(t.description=e.description);for(let t=0;t<k.length;t++)"Highlight"===k[t].type&&k[t].expander.updateImpactedCheckDisplay(e)}},this.addImpactedCheck=function(e){var t=e.highlightId,n=e.highlightRating,i=e.highlightTitle,o=e.checkId,a=e.checkStatus,l=e.checkTitle;P[t]||(P[t]=[]),P[t].push({id:o,status:a,name:l}),P[o]||(P[o]=[]),P[o].push({id:t,rating:n,name:i});for(let e=0;e<k.length;e++)k[e].id===t&&k[e].expander.addImpactedCheck({check:{id:o,status:a,name:l}})},this.unSelectAllExpanders=function(){for(let t=0;t<k.length;t++){k[t].expander.getMainDiv().setSelectionVisibility(!1);var e=k[t].expander.getContent().getElementsByClassName("highlightsPanel-impCheckRemoveButton");if(e.length)for(let t=0;t<e.length;t++)e[t].hide()}},this.unSelectAllValidated=function(){for(let e=0;e<k.length;e++)"Validated"===k[e].type&&k[e].expander.getMainDiv().setSelectedFlag(!1)},this.unSelectExpander=function(e){for(let t=0;t<k.length;t++)k[t].id===e&&k[t].expander.getMainDiv().setSelectedFlag(!1)},this.updateHighlightDisplay=function(e){for(let n=0;n<e.length;n++)for(let i=0;i<k.length;i++)if(k[i].id===e[n]){var t=k[i].expander.getContent().getParent();k[i].expander.destroy(),t.destroy(),R(e[n])}0===C.length&&v.getElementsByClassName("highlightsPanel-noHighlightDisplay")[0].show()},this.removeImpactedCheck=function(e){var t=e.highlightId,n=e.checkId;for(let e=0;e<k.length;e++)k[e].id===t&&k[e].expander.removeImpactedCheck(t,n);let i=P[t];if(i){let e=-1;for(let t=0;t<i.length;t++)if(i[t]&&i[t].id===n){e=t;break}e>=0&&i.splice(e,1)}};var R=function(e){var t,n=[];for(t=0;t<C.length;t++)C[t].id!==e?n[C[t].id]={name:C[t].name,id:C[t].id,description:C[t].description,issues:C[t].issues,tasks:C[t].tasks,changeAction:C[t].changeAction,rating:C[t].rating,associatedCheck:C.associatedCheck,expander:I[C[t].id].expander}:(C.splice(t,1),t-=1);for(t=0;t<k.length;t++)k[t].id===e&&k.splice(t,1);for(t=0;t<k.length;t++)k[t].index=t;I=[],I=n},j=function(e){for(let t=0;t<C.length;t++)for(let n=0;n<C[t].associatedCheck.length;n++)if(C[t].associatedCheck[n]===e){C[t].associatedCheck.splice(n,1),I[C[t].id].associatedCheck.splice(n,1);break}};this.updateHighlightSeverity=function(e,t){for(let i=0;i<k.length;i++)if(k[i].id===e){k[i].rating=t,k[i].expander.setHighlightComboValue(!0);var n=k[i].expander.getContent().getElementsByClassName("highlightsPanel-highlightRatingCombo");n.length&&(k[i].expander.updateRatingComboValues(),n[0].dsModel.value=t-1)}},this.updateCheckDisplay=function(e){for(let t=0;t<e.length;t++){j(e[t]);for(let n=0;n<k.length;n++)"Highlight"===k[n].type&&k[n].expander.removeImpactedCheck(e[t])}};var _=function(t,n){var i=e.createElement("div",{class:"DMURemoveValidatedMainDiv"});new e.Element("div",{text:r.reviewPanel.removeImpactedCheck,class:"warningMessage"}).inject(i);var l=new o({emphasize:"primary",label:r.reviewPanel.YesBtn?r.reviewPanel.YesBtn:"Yes",onClick:function(){B("onImpCheckRemoveRequested",{highlightId:t,checkId:n}),T&&T.destroy()}});l.getContent().addClassName("confirmRemoveButton");var s=new o({label:r.reviewPanel.NoBtn?r.reviewPanel.NoBtn:"No",onClick:function(){T&&T.destroy()}});T=new a({modalFlag:!0,ensureHeightDefinitionOnHierarchy:!0,title:r.reviewPanel.removeImpactedCheckTitle,resizableFlag:!0,immersiveFrame:c.getImmersiveFrame(),buttons:{Ok:l,Cancel:s},width:400,content:i})},N=function(e){var t,n=0;for(let t=0;t<k.length;t++)e.id===k[t].id?n=k[t].index:!e.element.isCheckBoxClicked()&&e.element.isSelected()&&(!e.event||e.event.shiftKey||e.event.ctrlKey||k[t].expander.getMainDiv().setSelectedFlag(!1));if("Highlight"===e.type){var i=e.element.getContent().getElementsByClassName("highlightsPanel-impCheckRemoveButton");if(i.length)for(let e=0;e<i.length;e++)i[e].show();t={event:e.event,element:e.element,index:n,expanders:k},B("onExpanderSelectionRequested",t)}},L=function(e){var t=e.element.getContent().getElementsByClassName("highlightsPanel-impCheckRemoveButton");if(t.length)for(let e=0;e<t.length;e++)t[e].hide();var n={id:e.id,type:e.type,expanders:k};B("onExpanderUnselectRequested",n)},O=function(e){D(e)};this.highlightUpdatePreview=function(){for(var e=0;e<k.length;e++)"Highlight"===k[e].type&&k[e].expander.updatePreview();"false"===localStorage.getItem("DMUReviewPanel_ThumbnailShowState")?localStorage.setItem("DMUReviewPanel_ThumbnailShowState",!0):localStorage.setItem("DMUReviewPanel_ThumbnailShowState",!1)},this.scrollToHighlight=function(e,t){if(e&&e.dmuObject&&e.highlightId){var n,i=e.dmuObject.getAttribute("sUuid");for(let t=0;t<k.length;t++)k[t].slideId===i&&(k[t].id===e.highlightId&&(n=k[t]),k[t].expander.getMainDiv().setSelectedFlag(!0));n&&(E&&clearTimeout(E),E=setTimeout((function(){if(m){let e=m.getInnerElement();if(e){let i=n.expander.getContent();if(i){let o=e.scrollTop+i.getPosition().y;e.scrollTo({top:o,behavior:"smooth"}),n.expander.getMainDiv().expand(),t()}}}E=null}),100))}},this.getImpactedChecksById=function(){for(var e=0;e<C.length;e++){I[C[e].id]=C[e];var t=C[e].associatedCheck;if(t)for(var n=0;n<t.length;n++){P[C[e].id]||(P[C[e].id]=[]);for(let i=0;i<f.length;i++)t[n]===f[i].id&&P[C[e].id].push({id:f[i].id,status:f[i].status,name:f[i].name})}}},this.updateHeaderIcon=function(e,t){for(let n=0;n<k.length;n++)k[n].id===parseInt(e)&&k[n].expander.getMainDiv().setIcon({icon:t})},this.updateHeaderLabel=function(e,t){for(let n=0;n<k.length;n++)k[n].id===parseInt(e)&&k[n].expander.getMainDiv().setLabel(t)};var W=function(e,t,n){"name"===t&&B("onHighlightAttributeChanged",{objectId:e,name:n}),"rating"===t&&B("onHighlightAttributeChanged",{objectId:e,rating:n}),"description"===t&&B("onHighlightAttributeChanged",{objectId:e,description:n})},V=function(e){B("onImpCheckRequested",{objectId:e})},H=function(){B("onImpCheckCancelCmd")},q=function(e,t){var n=-1;for(let t=0;t<k.length;t++)if(e===k[t].id){n=k[t].index;break}B("onIssueAddRequested",{id:e,name:t,index:n,expanders:k})},z=function(e,t){var n=-1;for(let t=0;t<k.length;t++)if(e===k[t].id){n=k[t].index;break}B("onTaskAddRequested",{id:e,name:t,index:n,expanders:k})},X=function(e,t){var n=-1;for(let t=0;t<k.length;t++)if(e===k[t].id){n=k[t].index;break}B("onCaAddRequested",{id:e,name:t,index:n,expanders:k})},G=function(e){return S(e.target.id,I[e.target.id].name)};this.buildPanel=function(t){var i=localStorage.getItem("DMUReviewPanel_highlightExpandedFlags");return C=t.highlights,f=t.checks,b=t.icons,y=t.highlightIcons,D=t.onHighlightExpand,S=t.getHighlightDragContent,x=t.onAttachedObjClicked,d=t.readOnlyFlag,c=t.frmWindow,g=t.editionMode,U=t.contextType,F=t.appId,A=t.restrictions,this.getImpactedChecksById(),h||(h=e.createElement("div",{class:"DMUHighlightsPanelMainDiv"})),h.setStyles({height:"100%","overflow-y":"hidden"}),(p=new s({draggable:!1,height:60..toString()+"px",onDragStart:function(){return t.reviewDragContent||""},sectionLabel:r.reviewPanel.highlightsPanelHeaderTitle,cmdList:t.contextualCmdList,quickAccessBtnList:t.quickAccessBtnList,doubleClickCB:function(){B("onPanelResized")}})).getContent().addClassName("reviewPanelSectionHeader"),p.getContent().getElementsByClassName("CATWebUXSectionHeaderLabel")[0].setStyles({"padding-left":"7px"}),h.appendChild(p.getContent()),w=e.createElement("div",{class:"highlightsPanel-highlightsContent"}),(v=this.buildHighlights(i)).inject(w),(m=(new n).inject(h)).getInnerElement().setContent(w),m.getContent().setStyle("height","calc(100% - 40px)"),h},this.updateReviewPanelContent=function(e){e.reviewNoContextMode?v.visibleFlag=!1:v.visibleFlag=!0},this.cleanPanel=function(){if(h){for(;h.firstChild;)h.removeChild(h.firstChild);p&&p.clear(),m&&m.destroy(),p=m=h=null}},this.buildHighlights=function(){u=new e.Element("div",{class:"highlightsPanel-highlightsExpanders"});var t,n=new e.Element("div",{text:r.reviewPanel.noHighlight,class:"highlightsPanel-noHighlightDisplay"});for(n.inject(u),C.length&&n.hide(),t=0;t<C.length;t++){var o=new e.Element("div",{class:"flowContainer"}).inject(u),a=new i({objectData:C[t],editionMode:g,readOnly:d,highlightEditMode:A.highlight,onHighlightAttributeChanged:W,onSetImpactedCheckRequested:V,onSetImpactedCheckCanceled:H,onImpactedCheckRemoved:_,onHighlightExpandCB:O,onExpanderSelectedCB:N,onExpanderUnselectCB:L,onAddIssueRequested:q,onAddTaskRequested:z,onAddCARequested:X,onHighlightDragStart:G,onAttachedObjClicked:x,icons:y,checkIcons:b,impChecksInfos:P,type:"Highlight",panelType:{type:"reviewApp",app:F},contextType:U}).inject(o);k.push({expander:a,id:C[t].id,index:k.length,rating:C[t].rating,slideId:C[t].slideId,type:"Highlight"}),a.getContent().id=C[t].id}return u},this.addNewHighlight=function(t){C.push({name:t.name,id:t.id,description:t.description,issues:t.issues,tasks:t.tasks,changeAction:t.changeAction,rating:t.rating,associatedCheck:t.associatedCheck?t.associatedCheck:[],type:"DMUValidationExposedPresentation",slideId:t.slideObject.getAttribute("sUuid")}),I[t.id]={name:t.name,rating:t.rating,description:t.description,id:t.id,issues:[],tasks:[],changeAction:[]},u.getElementsByClassName("highlightsPanel-noHighlightDisplay")[0].hide();var n=new e.Element("div",{class:"flowContainer"}).inject(u),o=new i({objectData:t,editionMode:g,normalCommentRepresentation:t.normalComment?t.normalComment:void 0,lightCommentRepresentation:t.lightComment?t.lightComment:void 0,readOnly:d,onHighlightAttributeChanged:W,onSetImpactedCheckRequested:V,onSetImpactedCheckCanceled:H,onImpactedCheckRemoved:_,onHighlightExpandCB:O,onExpanderSelectedCB:N,onExpanderUnselectCB:L,onAddIssueRequested:q,onAddTaskRequested:z,onAddCARequested:X,onAttachedObjClicked:x,icons:y,checkIcons:b,impChecksInfos:P,type:"Highlight",panelType:{type:"reviewApp",app:F},contextType:U,highlightEditMode:A.highlight}).inject(n);k.push({expander:o,id:t.id,index:k.length,rating:t.rating,slideId:t.slideObject.getAttribute("sUuid"),type:"Highlight"}),o.getContent().id=t.id,o.getContent().draggable=!0,o.getContent().ondragstart=function(e){var t=S(e.target.id,I[e.target.id].name);e.dataTransfer.setData("text",t)},o.getMainDiv().setSelectedFlag(!0),o.getMainDiv().expand()},this.setPanelQuickAccessCommands=function(e){p&&(p.closeContextualSectionHeader(),p.setQuickAccessCommands(e))}}})})),define("DS/DMUControls/panels/DMUMembersCommonComponent",["UWA/Class","DS/DMUControls/DMUWarningPanel","DS/DataGridView/DataGridView","DS/CATWebUXComponents/CATWebUXSectionHeader","DS/TreeModel/TreeDocument","DS/Utilities/WebUXColorEnums","DS/TreeModel/TreeNodeModel","i18n!DS/DMUControls/assets/nls/DMUControls","css!DS/DMUControls/DMUControls.css"],(function(e,t,n,i,o,a,l,s){"use strict";return e.extend({init:function(e){this._parent(e);const r=this;let d,c,u,h,m,p,g,f,C,v,w;p=e.owner?e.owner:[],g=e.coordinators?e.coordinators:[],f=e.assignees?e.assignees:[],C=e.contributors?e.contributors:[],v=e.informedUsers?e.informedUsers:[];var b=async function(t,n,i,o){let a=!1;"Contributor"!==n&&"Assignee"!==n||(a=!0),await e.cellDataJsonCreation(i,a).then((function(e){if(e=e.filter((e=>null!==e)),"add"===t)e.forEach((function(e){var t=new l({grid:e,nodeType:n});o.addChild(t)}));else if("remove"===t){if(i.length>0)o.getAllDescendants().forEach((function(e){i.forEach((function(t){e.options.grid.name===t.user&&o.removeChild(e)}))}))}}))};this.updateOwnerView=async function(e){if(e){var t=r.dataGridView.treeDocument;t.prepareUpdate(),await b("remove","Owner",p,d),await b("add","Owner",e,d),e.length>0&&e.forEach((e=>{for(let t=p.length-1;t>=0;t--)e.user!==p.user&&(p.splice(t,1),p.push(e))})),d.expandAll(),t.pushUpdate()}},this.updateContributionCells=function(e){var t=r.dataGridView.treeDocument;if(e.bIsAssignee){f.find((t=>t.user===e.user)).contribution=e.contribution}else if(e.bIsContributor){C.find((t=>t.user===e.user)).contribution=e.contribution}t.prepareUpdate(),e&&function(e){f&&f.forEach((t=>{e.user===t.user&&(t.contribution=e.contribution)})),C&&C.forEach((t=>{e.user===t.user&&(t.contribution=e.contribution)})),e.bIsAssignee&&u.options.children.forEach((t=>{t.options.grid.name===e.user&&(t.options.grid.contribution=e.contribution,"NotStarted"===e.contribution?t.options.grid.contributionNls=s.contributionValue.NotStarted:"OnGoing"===e.contribution?t.options.grid.contributionNls=s.contributionValue.OnGoing:t.options.grid.contributionNls=s.contributionValue.Completed)})),e.bIsContributor&&h.options.children.forEach((t=>{t.options.grid.name===e.user&&(t.options.grid.contribution=e.contribution,"NotStarted"===e.contribution?t.options.grid.contributionNls=s.contributionValue.NotStarted:"OnGoing"===e.contribution?t.options.grid.contributionNls=s.contributionValue.OnGoing:t.options.grid.contributionNls=s.contributionValue.Completed)}))}(e),t.pushUpdate(),r.dataGridView.updateColumnView("contributionNls",{updateCellContent:!0});let n=r.buildMenuJson();r.sectionHeader.setSubMenuCommands(n)},this.updateMembersView=async function(e){if(e){var t,n=e.coordinators,i=e.assignees,o=e.contributors,a=e.informedUsers,l=r.dataGridView.treeDocument;l.prepareUpdate(),n&&(n.add&&n.add.length>0&&(n.add.forEach((function(e){g.push(e)})),await b("add","Coordinator",n.add,c)),n.remove&&n.remove.length>0&&((t=n.remove).forEach((e=>{for(let t=g.length-1;t>=0;t--)g[t].user===e.user&&g[t].type.toLowerCase()===e.type.toLowerCase()&&g.splice(t,1)})),await b("remove","Coordinator",t,c)),c.options.label=c.options.grid.Text=s.membersAdditionPanel.coordinator+" ("+g.length+")"),i&&(i.add&&i.add.length>0&&(i.add.forEach((function(e){f.push(e)})),await b("add","Assignee",i.add,u)),i.remove&&i.remove.length>0&&((t=i.remove).forEach((e=>{for(let t=f.length-1;t>=0;t--)f[t].user===e.user&&f[t].type.toLowerCase()===e.type.toLowerCase()&&f.splice(t,1)})),await b("remove","Assignee",t,u)),u.options.label=u.options.grid.Text=s.membersAdditionPanel.assignee+" ("+f.length+")"),o&&(o.add&&o.add.length>0&&(o.add.forEach((function(e){C.push(e)})),await b("add","Contributor",o.add,h)),o.remove&&o.remove.length>0&&((t=o.remove).forEach((e=>{for(let t=C.length-1;t>=0;t--)C[t].user===e.user&&C[t].type.toLowerCase()===e.type.toLowerCase()&&C.splice(t,1)})),await b("remove","Contributor",t,h)),h.options.label=h.options.grid.Text=s.membersAdditionPanel.contributor+" ("+C.length+")"),a&&(a.add&&a.add.length>0&&(a.add.forEach((function(e){v.push(e)})),await b("add","Informed User",a.add,m)),a.remove&&a.remove.length>0&&((t=a.remove).forEach((e=>{for(let t=v.length-1;t>=0;t--)v[t].user===e.user&&v[t].type.toLowerCase()===e.type.toLowerCase()&&v.splice(t,1)})),await b("remove","Informed User",t,m)),m.options.label=m.options.grid.Text=s.membersAdditionPanel.informedUser+" ("+v.length+")"),c.expandAll(),u.expandAll(),h.expandAll(),m.expandAll(),l.pushUpdate()}};var y=function(t,n,i,o){const a={coordinatorsTab:t,assigneesTab:n,contributorsTab:i,informedusersTab:o},l=Object.fromEntries(Object.entries(a).filter((([,e])=>e.length>0)).map((([e,t])=>[e.replace("Tab",""),{add:t}])));e.saveMembers(l)},D=function(t,n,i,o){const a={coordinatorsTab:t,assigneesTab:n,contributorsTab:i,informedusersTab:o},l=Object.fromEntries(Object.entries(a).filter((([,e])=>e.length>0)).map((([e,t])=>[e.replace("Tab",""),{remove:t}])));e.saveMembers(l)};let S=null;this.createQuickAccessCmdButtonsList=function(t){t||(t=e.quickAccessBtnData),S=t;var n=[];if(n.push({id:"contributionStateButton",type:"label",title:s.contributionState,label:s.contributionValue[S.membersContribution],className:"rp-ms-box rp-dmu-contribution-"+S.membersContribution,isUserContribution:!!S.bIsUserContribution&&S.bIsUserContribution}),e.editionMode){let e=!1;S.valCoordinators&&(e=S.valCoordinators.some((e=>S.currentUser===e.user))),(S.currentUser===p[0].user||e)&&n.push({id:"newButton",type:"button",fontIcon:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-users-add",title:s.membersAdditionPanel.addMembersToolTip,cb:S._createAddMembersPanel})}return n};let x=[];var E;this.buildMenuJson=function(n){if(p&&g&&f&&C&&v){var i=[];const p=e.currentUser;let x=e.restrictions.review;var o=null;let E=null;var a=s.team.menu.Ongoing;if(n){var l=n.getTreeDocument().getSelectedNodes();if(l.length>0){var d,c,u,h=l[0].options.grid;E=n.options.grid.contribution;let r=null,k="";n.options.nodeType?(d=n.options.nodeType.contains("Owner"),c=n.options.nodeType.contains("Assignee"),u=n.options.nodeType.contains("Contributor")):n.options.grid.Text&&(d=n.options.grid.Text.contains("Owner"),c=n.options.grid.Text.contains("Assignee"),u=n.options.grid.Text.contains("Contributor"));let M=[],P=[],I=[],U=[],T=[],A=[],F=[],B=[];const R=l.some((e=>f.some((t=>e.options.grid.name===t.user)))),j=l.some((e=>C.some((t=>e.options.grid.name===t.user))));let _="";if(R||j)for(const t of l){const n=e.isMarkupsOfUserExist(t.options.grid.name);if("Markup_Reply"===n||"Markup"===n||"Reply"===n){_=n;break}}const N=l.some((e=>{let t=f.find((t=>e.options.grid.name===t.user))||C.find((t=>e.options.grid.name===t.user));if(t)return"Completed"===t.contribution})),L=l.some((e=>f.some((t=>e.options.grid.name===t.user))||C.some((t=>e.options.grid.name===t.user))||g.some((t=>e.options.grid.name===t.user))||v.some((t=>e.options.grid.name===t.user)))),O=l.some((e=>g.some((t=>e.options.grid.name===t.user))||v.some((t=>e.options.grid.name===t.user))));var m=function(){var e={type:"CheckItem",title:s.team.menu.contributor,action:{callback:function(){"selected"===e.state?N||j&&("Reply"===_||"Markup_Reply"===_)||(F.push({user:h.name,type:h.userType.toLowerCase()}),D(T,A,F,B)):(I.push({user:h.name,type:h.userType.toLowerCase()}),y(M,P,I,U))}}};return C.forEach((function(t){t.user===h.name&&(e.state=N||j&&("Reply"===_||"Markup_Reply"===_)?"selected|disabled":"selected")})),e},w=function(){var e={type:"CheckItem",title:s.team.menu.assignee,action:{callback:function(){"selected"===e.state?N||R&&("Markup"===_||"Markup_Reply"===_)||(A.push({user:h.name,type:h.userType.toLowerCase()}),D(T,A,F,B)):(P.push({user:h.name,type:h.userType.toLowerCase()}),y(M,P,I,U))}}};return f.forEach((function(t){t.user===h.name&&(e.state=N||R&&("Markup"===_||"Markup_Reply"===_)?"selected|disabled":"selected")})),e},b=function(){return{type:"PushItem",title:s.team.menu.remove,fonticon:{family:1,content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-remove"},action:{callback:function(){let n=[],i=[],o=[];function a(e,t,...n){n.forEach((n=>n.push({user:e,type:t})))}var d,c,u,h;l.forEach((t=>{const l=t.options.grid.name;let s=f.find((e=>l===e.user))||C.find((e=>l===e.user));if(!s)return r=t.options.grid,void a(r.name,r.userType.toLowerCase(),i,o,n);if("Completed"===s.contribution)return void a(s.user,s.type.toLowerCase(),n);const d=e.isMarkupsOfUserExist(l),c=f.some((e=>l===e.user)),u=C.some((e=>l===e.user)),h=()=>{""===d?a(s.user,s.type.toLowerCase(),i,o,n):"Markup"===d?a(s.user,s.type.toLowerCase(),o,n):a(s.user,s.type.toLowerCase(),n)};(c&&u||c||u)&&h()})),d=n,c=i,u=o,h=n,new t({title:s.team.removeTitle,message:s.team.removeMessage,frmWindow:e.parentDiv?e.parentDiv:e.frmWindow,callbacks:{onValidateCB:function(){D(d,c,u,h)},onCancelCB:function(){},onCloseCB:function(){}}})}}}};"NotStarted"===E?o="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-double-chevron-right dmu-membersContributionSwitchMenu-OnGoing":"Completed"===E?o="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-double-chevron-left dmu-membersContributionSwitchMenu-OnGoing":(o="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-double-chevron-right dmu-membersContributionSwitchMenu-Completed",a=s.team.menu.Completed);const W=1===l.length,V=!e.readOnlyFlag&&e.editionMode,H=l.some((e=>p===e.options.grid.name));V||(x.canSetContribFromCompletedToOnGoing=!1,e.appId&&(x.canSetContribCompleted=!1,x.canSetContribFromNSToOnGoing=!1));const q=()=>{(c||u)&&(H&&!N&&(x.canSetContribCompleted||x.canSetContribFromNSToOnGoing)||x.canEditMembers&&x.canSetContribFromCompletedToOnGoing&&N)&&i.push({type:"PushItem",title:a,fonticon:{family:1,content:o},action:{callback:function(){l.forEach((t=>{var n=null,i=null;r=t.options.grid,k=t.options.nodeType,"Assignee"===k?f.forEach((e=>{r.name===e.user&&r.userType===e.type&&(n=e.id,i=e.contribution)})):"Contributor"===k&&C.forEach((e=>{r.name===e.user&&r.userType===e.type&&(n=e.id,i=e.contribution)})),"NotStarted"===i?i="OnGoing":"OnGoing"===i?i="Completed":"Completed"===i&&(i="OnGoing");let o={connectionId:n,contribution:i};e.fireContributionEvent(o)}))}}})};let z=m();z.state=N||j&&("Reply"===_||"Markup_Reply"===_)?"selected|disabled":"selected";let X=w();X.state=N||R&&("Markup"===_||"Markup_Reply"===_)?"selected|disabled":"selected",W&&(q(),V&&(x.canEditMembers&&(i.push((S={type:"CheckItem",title:s.team.menu.coordinator,action:{callback:function(){"selected"===S.state?(T.push({user:h.name,type:h.userType.toLowerCase()}),D(T,A,F,B)):(M.push({user:h.name,type:h.userType.toLowerCase()}),y(M,P,I,U))}}},g.forEach((function(e){e.user===h.name&&(S.state="selected")})),S),w(),m(),function(){var e={type:"CheckItem",title:s.team.menu.informedUser,action:{callback:function(){"selected"===e.state?(B.push({user:h.name,type:h.userType.toLowerCase()}),D(T,A,F,B)):(U.push({user:h.name,type:h.userType.toLowerCase()}),y(M,P,I,U))}}};return v.forEach((function(t){t.user===h.name&&(e.state="selected")})),e}(),{type:"SeparatorItem"}),(f.length>0||C.length>0||v.length>0||g.length>0)&&L&&(j||R?N?N&&O&&i.push(b()):(""===_||"Markup"===_&&!R||O)&&i.push(b()):i.push(b()))),d&&x.canChangeOwner&&i.push({type:"PushItem",title:s.team.menu.changeOwner,fonticon:{family:1,content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-user-change"},action:{callback:function(){e.transferOwnership()}}})),i.push({type:"PushItem",title:s.team.menu.profile,fonticon:{family:1,content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-eye"},action:{callback:function(){var t=n.options.grid.name;e.openWindow(t)}}})),l.length>1&&V&&x.canEditMembers&&i.push(b())}else i=r.buildMenuJson()}else{const t=f.some((e=>p===e.user)),n=C.some((e=>p===e.user));let l=null,r=null;t&&(l=f.find((e=>p===e.user)),E=l.contribution),n&&(r=C.find((e=>p===e.user)),E=r.contribution),"NotStarted"===E?o="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-double-chevron-right dmu-membersContributionSwitchMenu-OnGoing":"Completed"===E?o="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-double-chevron-left dmu-membersContributionSwitchMenu-OnGoing":(o="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-double-chevron-right dmu-membersContributionSwitchMenu-Completed",a=s.team.menu.Completed);const d=["NotStarted","OnGoing"].includes(E);(()=>{E&&(x.canSetContribCompleted||x.canSetContribFromNSToOnGoing)&&(x.canEditMembers||d)&&i.push({type:"PushItem",title:a,fonticon:{family:1,content:o},action:{callback:function(){var i=null,o=null;t?(i=l.id,o=l.contribution):n&&(i=r.id,o=r.contribution),"NotStarted"===o?o="OnGoing":"OnGoing"===o?o="Completed":"Completed"===o&&(o="OnGoing");let a={connectionId:i,contribution:o};e.fireContributionEvent(a)}}})})()}return i}var S},x=r.buildMenuJson(),r.sectionHeader=new i({draggable:!1,height:40..toString()+"px",cmdList:x,bIsMembersPanelCmdList:!0}),r.sectionHeader.getContent().getElementsByClassName("CATWebUXSectionHeaderLabel")[0].setStyles({"padding-left":"7px"}),r.sectionHeader.getContent().addClassName("membersSectionHeader"),(p.length>0||g.length>0||f.length>0||C.length>0||v.length>0)&&async function(t,n,i,o,a,r){var p=[];await e.cellDataJsonCreation(n,!1).then((function(e){e=e.filter((e=>null!==e)),p.push({Text:s.membersAdditionPanel.owner+" ("+n.length+")",Type:"Owner",Children:e})})),i&&o&&a&&r?(await e.cellDataJsonCreation(i,!1).then((function(e){e=e.filter((e=>null!==e)),p.push({Text:s.membersAdditionPanel.coordinator+" ("+i.length+")",Type:"Coordinator",Children:e})})),await e.cellDataJsonCreation(o,!0).then((function(e){e=e.filter((e=>null!==e)),p.push({Text:s.membersAdditionPanel.assignee+" ("+o.length+")",Type:"Assignee",Children:e})})),await e.cellDataJsonCreation(a,!0).then((function(e){e=e.filter((e=>null!==e)),p.push({Text:s.membersAdditionPanel.contributor+" ("+a.length+")",Type:"Contributor",Children:e})})),await e.cellDataJsonCreation(r,!1).then((function(e){e=e.filter((e=>null!==e)),p.push({Text:s.membersAdditionPanel.informedUser+" ("+r.length+")",Type:"Informed User",Children:e}),t.prepareUpdate(),p.forEach((function(e){"Owner"===e.Type&&(d=new l({label:e.Text,grid:e}),t.addRoot(d),e.Children&&e.Children.forEach((function(t){var n=new l({label:t.Text,grid:t,nodeType:e.Type});d.addChild(n)}))),"Coordinator"===e.Type&&(c=new l({label:e.Text,grid:e}),t.addRoot(c),e.Children&&e.Children.forEach((function(t){var n=new l({label:t.Text,grid:t,nodeType:e.Type});c.addChild(n)}))),"Assignee"===e.Type&&(u=new l({label:e.Text,grid:e}),t.addRoot(u),e.Children&&e.Children.forEach((function(t){var n=new l({label:t.Text,grid:t,nodeType:e.Type});u.addChild(n)}))),"Contributor"===e.Type&&(h=new l({label:e.Text,grid:e}),t.addRoot(h),e.Children&&e.Children.forEach((function(t){var n=new l({label:t.Text,grid:t,nodeType:e.Type});h.addChild(n)}))),"Informed User"===e.Type&&(m=new l({label:e.Text,grid:e}),t.addRoot(m),e.Children&&e.Children.forEach((function(t){var n=new l({label:t.Text,grid:t,nodeType:e.Type});m.addChild(n)})))})),t.expandAll(),t.pushUpdate()}))):(t.prepareUpdate(),p.forEach((function(e){"Owner"===e.Type&&(d=new l({label:e.Text,grid:e}),t.addRoot(d),e.Children&&e.Children.forEach((function(t){var n=new l({label:t.Text,grid:t,nodeType:e.Type});d.addChild(n)})))})),c=new l({label:s.membersAdditionPanel.coordinator+" (0)",grid:{}}),t.addRoot(c),u=new l({label:s.membersAdditionPanel.assignee+" (0)",grid:{}}),t.addRoot(u),h=new l({label:s.membersAdditionPanel.contributor+" (0)",grid:{}}),t.addRoot(h),m=new l({label:s.membersAdditionPanel.informedUser+" (0)",grid:{}}),t.addRoot(m),t.expandAll(),t.pushUpdate())}(E=new o({shouldBeSelected:function(e){return e.options.grid.Text!==s.membersAdditionPanel.owner+" ("+p.length+")"&&e.options.grid.Text!==s.membersAdditionPanel.coordinator+" ("+g.length+")"&&e.options.grid.Text!==s.membersAdditionPanel.assignee+" ("+f.length+")"&&e.options.grid.Text!==s.membersAdditionPanel.contributor+" ("+C.length+")"&&e.options.grid.Text!==s.membersAdditionPanel.informedUser+" ("+v.length+")"}}),p,g,f,C,v);var k=[{text:s.reviewPanel.membersPanelUsersTitle,dataIndex:"tree",sortableFlag:!0,editableFlag:!1,width:180,typeRepresentation:"user",getCellValue:function(e){if(e.nodeModel){var t=e.nodeModel.getAttributeValue("Text"),n=e.nodeModel.getAttributeValue("siteName");return t?{icon:"user wux-ui-3ds",label:t}:{label:n}}},setCellValue:function(e,t){if(e.nodeModel){var n=null;n={grid:{}},t.hasOwnProperty("icon")&&(n.grid.icon=t.icon),t.hasOwnProperty("label")&&(n.grid.Text=t.label),e.nodeModel.updateOptions(n)}},getCellClassName:function(e){return e.nodeModel?e.nodeModel?"dmuMemberfullNameClass":void 0:"headerClass"}},{text:s.reviewPanel.membersPanelUsersName,dataIndex:"name",width:50,resizableFlag:!0,sortableFlag:!0,typeRepresentation:"string",getCellClassName:function(e){return e.nodeModel?e.nodeModel?"dmuMemberNameClass":void 0:"headerClass"}},{text:s.reviewPanel.membersPanelUsersContribution,dataIndex:"contributionNls",width:80,resizableFlag:!0,sortableFlag:!0,typeRepresentation:"tag",readOnly:!0,getCellSemantics:function(e){return"NotStarted"===e.nodeModel.getAttributeValue("contribution")?{backgroundColor:a.COLORS_STATUS.COLOR_PURPLE_FOR_WHITE_LABEL}:"OnGoing"===e.nodeModel.getAttributeValue("contribution")?{emphasize:"primary"}:"Completed"===e.nodeModel.getAttributeValue("contribution")?{backgroundColor:a.COLORS_STATUS.COLOR_GREEN_FOR_WHITE_LABEL}:void 0},getCellClassName:function(e){return e.nodeModel?e.nodeModel?"dmuMemberContributionClass":void 0:"headerClass"}}];this.dataGridView=new n({showModelChangesFlag:!0,cellSelection:"none",treeDocument:E,sortModel:[{dataIndex:"name",sort:"asc"}],columns:k,rowDragEnabledFlag:!1,showRowIndexFlag:!1,showContextualMenuColumnFlag:!1,selectOnContextualEvent:!0,selection:{unselectAllOnEmptyArea:!0,toggle:!1,enableListSelection:!0,renderingMode:"adaptive"},onContextualEvent:function(e){var t=[];if(e&&e.collectionView&&e.cellInfos)if(e.cellInfos.rowID>-1){var n=e.cellInfos.nodeModel,i=e.data.target;e.cellInfos.nodeModel.options.label===s.membersAdditionPanel.owner+" ("+p.length+")"||e.cellInfos.nodeModel.options.label===s.membersAdditionPanel.coordinator+" ("+g.length+")"||e.cellInfos.nodeModel.options.label===s.membersAdditionPanel.assignee+" ("+f.length+")"||e.cellInfos.nodeModel.options.label===s.membersAdditionPanel.contributor+" ("+C.length+")"||e.cellInfos.nodeModel.options.label===s.membersAdditionPanel.informedUser+" ("+v.length+")"||i.classList.contains("wux-datagridview-selection-checkbox")||i.classList.contains("wux-layouts-datagridview-row-header-cell")||(t=r.buildMenuJson(n))}else{t=e.collectionView.buildDefaultContextualMenu(e,{insertRow:!1,expandCollapse:!1,pin:!0,firstColumnsVisibility:!1,columnsManagement:!1,sortableFlag:!0,deleteSelectedRows:!1})}return t}}).inject(e.membersContent),this.dataGridView.getContent().addClassName("dataGridViewComponent"),e.editionMode?this.dataGridView.rowSelection="multiple":this.dataGridView.rowSelection="single";var M=this.dataGridView.getNodesXSO();M.onPostAdd((function(e){e.forEach((function(e){w=r.buildMenuJson(e),r.sectionHeader.setSubMenuCommands(w)}))})),M.onPostRemove((function(e){e.forEach((function(e){w=r.buildMenuJson(e),r.sectionHeader.setSubMenuCommands(w)}))}))}})})),define("DS/DMUControls/panels/DMUMembersPanel",["UWA/Core","UWA/Class","UWA/Controls/ThemedScroller","DS/CoreEvents/ModelEvents","DS/DMUControls/panels/DMUMembersCommonComponent","css!DS/DMUControls/DMUControls.css"],(function(e,t,n,i,o){"use strict";return t.extend({init:function(t){var a,l,s,r,d,c;this._parent(t);var u,h=new i;let m,p,g,f,C,v;var w;const b=this;this.setRestrictions=e=>{m=e},this.getSectionHeader=function(){return c},this.createQuickAccessCmdButtonsList=function(e){return d.createQuickAccessCmdButtonsList(e)},this.setPanelReadOnlyFlag=function(e){l=e.editionMode,a=e.readOnly},this.updateOwnerView=async function(e){await d.updateOwnerView(e)},this.updateMembersView=async function(e){await d.updateMembersView(e)},this.updateContributionCells=async function(e){await d.updateContributionCells(e)},this.buildGridView=function(e){d&&d.dataGridView.destroy(),e&&(p=e.owner,g=e.coordinators,f=e.assignees,C=e.contributors,v=e.informedUsers,d=new o({quickAccessBtnData:e.quickAccessBtnData,currentUser:e.currentUser,frmWindow:t.frameWindow,cellDataJsonCreation:e.cellDataJsonCreation,membersContent:u,owner:p,coordinators:g,assignees:f,contributors:C,informedUsers:v,readOnlyFlag:a,editionMode:l,appId:e.appId,saveMembers:e.saveMembers,openWindow:e.openWindow,transferOwnership:w.transferOwnership,restrictions:m,fireContributionEvent:e.fireContributionEvent,platformUrl:e.platformUrl,isMarkupsOfUserExist:e.isMarkupsOfUserExist}),c=d.sectionHeader)},this.buildPanel=function(t){return a=t.readOnlyFlag,l=t.editionMode,m=t.restrictions,s||(s=e.createElement("div",{class:"DMUMembersPanelMainDiv"})),s.setStyles({height:"98%","overflow-y":"hidden"}),u=e.createElement("div",{class:"membersPanel-membersContent"}),w=t.options,b.buildGridView(w),c.doubleClickCB=()=>{return e="onPanelResized",h.publish({event:e,data:t,context:b});var e,t},s.appendChild(c.getContent()),(r=(new n).inject(s)).getInnerElement().setContent(u),r.getContent().setStyle("height","calc(100% - 40px)"),s},this.cleanPanel=function(){if(s){for(;s.firstChild;)s.removeChild(s.firstChild);c&&c.clear(),r&&r.destroy(),c=r=s=null}},this.setPanelQuickAccessCommands=function(e){c&&(c.closeContextualSectionHeader(),c.setQuickAccessCommands(e))}}})})),define("DS/DMUControls/EXPWindowWithBar",["DS/DMUControls/EXPWindow","WebappsUtils/WebappsUtils"],(function(e,t){"use strict";return e.extend({defaultOptions:{fLeftPanelSize:40},init:function(e){var t=UWA.extend(this.defaultOptions,e);this._parent(t),this._createBar()},addButton:function(e){var t=this,n=UWA.createElement("div",{class:e.className,title:e.nls,styles:{position:"relative",background:"rgba(255,255,255,0.5)",opacity:"1",borderRadius:"50%",left:this.options.fMarginAroundViewer,height:"30px",width:"30px",marginTop:"7px",marginBottom:"7px",cursor:"pointer",lineHeight:"25px",textAlign:"center",border:"1px solid #727476"},events:{click:function(){e.callback(t)}}}).inject(this._domElements._actionButtonContainer);this._buildButtonIcon(e.url).inject(n)},setFullScreen:function(e,t){this._parent(e,t),e?(this._domElements._leftPanelMainContainer.setStyle("left",0),this._domElements._actionButtonContainer.setStyles({width:"130%",borderBottomRightRadius:"2pc",borderTopRightRadius:"2pc"})):(this._domElements._leftPanelMainContainer.setStyle("left",-this.options.fLeftPanelSize+"px"),this._domElements._actionButtonContainer.setStyles({width:"100%",borderBottomRightRadius:"0",borderTopRightRadius:"0"}))},_createBar:function(){this._createLeftButtonArrowOpenPanel(),this._createLeftButtonsCommandPanel(),this._createLeftPanelContainer(),this._createLeftButtonArrowClosePanel(),this._createLeftActionButtonContainer()},_createLeftButtonArrowOpenPanel:function(){var e=this,n=t.getWebappsBaseUrl()+"DMUControls/assets/icons/expanderBigLeftArrow.png";this._domElements._leftPanelArrow=this._createUWADiv({position:"absolute",left:0,top:"50%",height:"20px",width:"20px",overflow:"hidden",backgroundImage:"url("+n+")",backgroundSize:"contain",backgroundRepeat:"no-repeat",cursor:"pointer"}),this._domElements._leftPanelArrow.addEvent("click",(function(t){e._domElements._leftPanelArrow.setStyle("display","none"),e._domElements._leftPanelMainContainer.setStyle("display","block"),UWA.Event.stop(t)})),this._domElements._leftPanelArrow.inject(this._domElements._mainContainer)},_createLeftButtonsCommandPanel:function(){this._domElements._leftPanelMainContainer=this._createUWADiv({position:"absolute",left:-this.options.fLeftPanelSize+"px",top:0,height:"100%",width:this.options.fLeftPanelSize+"px",overflow:"visible",paddingTop:this.options.fTopbarHeight+"px",lineHeight:this._domElements._mainContainer.getSize().height-this.options.fTopbarHeight+"px",textAlign:"center",display:"none"}),this._domElements._leftPanelMainContainer.inject(this._domElements._mainContainer)},_createLeftPanelContainer:function(){this._domElements._leftPanelContainer=this._createUWADiv({height:"auto",width:"100%",overflow:"visible",display:"inline-block",verticalAlign:"middle",lineHeight:"normal"}),this._domElements._leftPanelContainer.inject(this._domElements._leftPanelMainContainer)},_createLeftButtonArrowClosePanel:function(){var e=this,n=t.getWebappsBaseUrl()+"DMUControls/assets/icons/expanderBigRightArrow.png";this._domElements._leftPanelCloseArrow=this._createUWADiv({height:"20px",width:"100%",overflow:"hidden",backgroundImage:"url("+n+")",backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"center center",cursor:"pointer",position:"relative",right:-this.options.fMarginAroundViewer/2}),this._domElements._leftPanelCloseArrow.addEvent("click",(function(t){e._domElements._leftPanelArrow.setStyle("display","block"),e._domElements._leftPanelMainContainer.setStyle("display","none"),UWA.Event.stop(t)})),this._domElements._leftPanelCloseArrow.inject(this._domElements._leftPanelContainer)},_createLeftActionButtonContainer:function(){this._domElements._actionButtonContainer=this._createUWADiv({height:"auto",width:"100%",backgroundColor:"#F0F0F0",overflow:"visible",borderTop:"1px solid #D1D1D1",borderBottom:"1px solid #D1D1D1",borderLeft:"1px solid #D1D1D1",borderTopLeftRadius:this.options.fCornerRoundRadius+"px",borderBottomLeftRadius:this.options.fCornerRoundRadius+"px",paddingTop:"10px",paddingBottom:"10px"}),this._domElements._actionButtonContainer.inject(this._domElements._leftPanelContainer)},_buildButtonIcon:function(e){var t=new UWA.Controls.Img({url:e});return t.elements.container.setStyles({height:"75%",width:"75%",display:"inline-block",verticalAlign:"middle",lineHeight:"normal"}),t},_updateSize:function(){this._domElements._leftPanelMainContainer.setStyle("lineHeight",this._domElements._mainContainer.getSize().height-this.options.fTopbarHeight+"px"),this._parent()}})})),define("DS/DMUControls/EXPSecondaryViewer",["DS/DMUControls/EXPWindowWithBar","DS/WebappsUtils/WebappsUtils","DS/Visualization/WebGLV6Viewer","i18n!DS/DMUControls/assets/nls/DMUControls"],(function(e,t,n,i){"use strict";return e.extend({init:function(e){this.options=e,this._addViewer(),this._parent(e),this._addDefaultButtons()},_addDefaultButtons:function(){for(var e=t.getWebappsAssetUrl("DMUControls","icons/32/"),n=[{className:"secondaryViewerPrintCmd",nls:i.print,url:e+"I_3DSHAREPROPrint.png",callback:function(e){e._printScreenshot(!0)}},{className:"secondaryViewerReframeCmd",nls:i.reframe,url:e+"I_3DSHAREPROReframe.png",callback:function(e){e.options.viewer.currentViewpoint.reframe()}}],o=0;o<n.length;o++)this.addButton(n[o])},_addViewer:function(){var e=new UWA.Element("div").inject(this.options.body,"top");e.setStyle("visibility","visible");var t={div:e,antiAliasing:!0,useShadowMap:!1,infinitePlane:!1,displayGrid:!1,ssao:!1,debugShadowLight:!1,debugBSphere:!1,debugBBox:!1,multiViewer:!0};this._viewerSecondary=new n(t),this._viewerSecondary.setPrePicking({activated:!0,displayHL:!0,gpu:!0,computeNormalDepth:!1,primitive:!1}),this.options.viewer=this._viewerSecondary,this.options.HTMLContent=e},_printScreenshot:function(){var e=this,t=this.options.viewer;if(t.print)t.print();else{this._iframe=new UWA.Element("iframe",{styles:{position:"fixed",top:"0",left:"-150%",width:"100%",height:"100%"}}).inject(document.body);var n,i=new UWA.Element("img",{src:this._getScreenShot(),styles:{"max-width":"100%","max-height":"100%"}}).inject(this._iframe.contentWindow.document.body);if(window.navigator.userAgent.indexOf("Firefox")>-1)this._doPrint();else e=this,n=setInterval((function(){if(i.offsetHeight){clearInterval(n);try{!1===e._iframe.contentWindow.document.execCommand("print",!1,null)&&e._iframe.contentWindow.print()}catch(t){e._iframe.contentWindow.print()}setTimeout((function(){document.body.removeChild(e._iframe)}),6e4)}}),100)}},_doPrint:function(){var e=this._iframe.contentWindow.document.body.innerHTML,t=window.open("","popup","width=750,height=800,toolbar = no, status = no,resizable =no,location=no");t.document.write(e),t.document.close(),t.focus(),t.print(),t.close(),document.body.removeChild(this._iframe),this._iframe=null},_getScreenShot:function(e,t){var n=this.options.viewer;n.save&&n.save();var i=n.currentViewpoint,o={data:null,width:n.SCREEN_WIDTH,height:n.SCREEN_HEIGHT},a=document.createElement("canvas");a.width=e||o.width,a.height=t||o.height,i.getControl().update(),n.renderToTarget(o,i);var l=a.getContext("2d"),s=l.getImageData(0,0,a.width,a.height);if(s.width===a.width){if(s.height===a.height){var r=(o.width-1)/(s.width-1),d=(o.height-1)/(s.height-1),c=o.data,u=s.data,h=function(e,t,n,i,o){return o?(t=i-t,n*Math.floor(t-1)+Math.floor(e)):n*Math.floor(t)+Math.floor(e)};if(1===r&&1===d){var m=s.height,p=s.width,g=4*p;for(let e=0;e<m;e++){let t=e*p*4,n=(m-e)*p*4;for(let e=g;e>0;e--)u[t+e]=c[n+e]}}else{var f=s.height,C=s.width;for(let e=0;e<f;e++)for(let t=0;t<C;t++){let n=4*h(t,e,s.width,s.height,!1),i=4*h(t,e,o.width,o.height,!0);u[n]=c[i],u[n+1]=c[i+1],u[n+2]=c[i+2],u[n+3]=c[i+3]}}return l.putImageData(s,0,0,0,0,a.width,a.height),a.toDataURL("image/png")}window.console.error("error")}else window.console.error("error")},getViewer:function(){return this._viewerSecondary}})}));