define("DS/TransferOwnershipWebInWinWidget/TransferOwnershipWebInWinWidget",["UWA/Controls/Abstract","DS/WidgetServices/WidgetServices","DS/TransferOwnershipWidget/component/TransferOwnershipWidget","DS/TransferOwnershipWidget/TransferOwnershipConstant","text!DS/TransferOwnershipWidget/assets/TOSettings.json","DS/WebToWinInfra/WebToWinCom","DS/WebInWinHelper/WebInWinHelper","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/ENOCollabSharingCmds/BaseModels/ResultElement","DS/UIKIT/Mask","DS/ENOFloatingPanel/ENOFloatingPanel","css!DS/TransferOwnershipWidget/component/TransferOwnershipWidget.css","css!DS/TransferOwnershipWebInWinWidget/TransferOwnershipWebInWinWidget.css","i18n!DS/TransferOwnershipWidget/assets/nls/TOSNls","i18n!DS/ENOCollabSharingCmds/assets/nls/langSharingCmds"],(function(e,t,n,i,o,a,r,s,l,d,p,g,c,m,w){"use strict";return e.extend({itemListHasPriority:!1,defaultOptions:{className:"transferownership_webinwinwidget",context:null,ForbiddenChar:'"#$@%*,?\\<>[]|:',serverName:"",serverUri:"",activeFirstLineTable:!1,displaySoftDialog:!0,model:!0,wintop:!0,odtMode:!1,serverUrl:""},init:function(e,n,i){var o=null;this._parent(i),this.refreshData={};var l=this;if(this.options=i,r.initTenant(l),this.widget=e,this._parent(i),r.getServices(l),1==i.wintop&&(this.webToWinCom_Socket=a.createSocket({socket_id:"webinwinTransferOwnership_socket_"+Math.floor(1e5*Math.random()+1)})),this.options.webToWinComSocket=this.webToWinCom_Socket,this.options.webInWinHelper=r,this.options=i,this.parentWidget=n,1==i.wintop){void 0!==i.serverUrl&&i.serverUrl.length>0&&void 0!==i.serverUrl[0].platformId&&(o=i.serverUrl[0].platformId,this.tenantId=o,this.serverUrl=i.serverUrl[0]["3DSpace"],t.setTenantID(o)),this.container=UWA.createElement("div",{class:"collab-transfer-ownership-content"}),this.container1=UWA.createElement("div",{class:"collab-transfer-ownership-floatingpanel"});l=this;var d={wintop:i.wintop,serverUrl:i.serverUrl};s.getInstance(d).getSecurityContext()}},initDatafromWin:function(e){this.phyIdList=[],this.mapOfPhyId={};var t=this;e.forEach((function(e){e.physicalId&&(e.physicalId in t.mapOfPhyId||(t.mapOfPhyId[e.physicalId]=e.name),t.phyIdList.push(e.physicalId))})),require(["DS/WidgetServices/WidgetServices","DS/TransferOwnershipWidget/component/TransferOwnershipWidget","DS/PADUtils/PADContext","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleServicesSettings"],(function(e,n,i,o,a){a.app_initialization((function(){o.listAttributes(t.tenantId,t.phyIdList,["attribute[PLMEntity.V_usage]","attribute[XCADEmbeddedCmp.V_IsEmbeddedComponent]","physicalid","owner","revision","attribute[PLMCoreRepReference.V_isOnceInstantiable]","attribute[Marketing Name]","organization","organization.property[Title].value","project","type","displayType","project.property[Title].value"],(function(e){for(var n=0,i=0,o=[],a=0;a<e.results.length;a++){var r=e.results[a],s=r.physicalid,d={},p=t.mapOfPhyId[s];d.physicalId=r.physicalid;"3DPart"==r["attribute[PLMEntity.V_usage]"]&&r.type;null===r["attribute[XCADEmbeddedCmp.V_IsEmbeddedComponent]"]||0==r["attribute[XCADEmbeddedCmp.V_IsEmbeddedComponent]"]?d.v_IsEmbeddedComponent=0:(d.v_IsEmbeddedComponent=1,n++);var g;1==(g="3DPart"==r["attribute[PLMEntity.V_usage]"]&&"3DShape"==r.type)&&i++,d.aggrObj=g,d.Revision=r.revision,d.organization=r.organization,d.owner=r.owner,d.type=r.type,null==r["organization.property[Title].value"]||""===r["organization.property[Title].value"]?d.organizationTitle=r.organization:d.organizationTitle=r["organization.property[Title].value"],d.project=r.project,null===r["project.property[Title].value"]||""===r["project.property[Title].value"]?d.projectTitle=r.project:d.projectTitle=r["project.property[Title].value"],d.owner=r.owner,d.responsibleName=r.ownerFullName,d.typeDisplayName=r.displayType;var c=new l({urlIcon:"",physicalId:d.physicalId,name:p,title:p,category:"bus",type:d.type,typeDisplayName:d.typeDisplayName,relID:"",parentID:"",cadMaster:"",parentCADMaster:"",owner:d.owner,responsibleName:d.responsibleName,Revision:d.Revision,projectTitle:d.projectTitle,project:d.project,organizationTitle:d.organizationTitle,organization:d.organization,aggrObj:d.aggrObj,v_IsEmbeddedComponent:d.v_IsEmbeddedComponent});o.push(c)}if(n!=t.phyIdList.length)if(i!=t.phyIdList.length)t.createWidget(),t.TOSWidget&&t.TOSWidget.initData(o,"");else{m=w.get("selectOwning");t.options.webToWinComSocket.dispatchEvent("onDispatchToWin",{notif_name:"invalidSelection",notif_parameters:{severity:"error",message:m}},"lf_web_in_win")}else{var m=w.get("selectOwning");t.options.webToWinComSocket.dispatchEvent("onDispatchToWin",{notif_name:"invalidSelection",notif_parameters:{severity:"error",message:m}},"lf_web_in_win")}}))}))}))},createWidget:function(){var e=this,t={wintop:e.options.wintop,serverUrl:e.options.serverUrl};s.getInstance(t).getSecurityContext(),s.getInstance(t).getSecurityContext({onSuccess:function(t){if(null!=t&&""!=t&&t.hasOwnProperty("SecurityContext")){0!=t.SecurityContext.indexOf("ctx::")&&"ctx::"}e.TOSWidget=new n(e.widget,e.container1,{className:"transferOwnership_innerComponent",setCloseButton:!0,showTopBar:!0,genericTransfer:!0,topClassHeight:"TOSP_PopupDial",serverName:e.serverUrl,serverUri:e.serverUrl,activeDnD:e.options.activeDnD,activeOptions:e.options.activeOptions,oldClassName:e.options.className,securityContext:t.SecurityContext,serverUrl:e.options.serverUrl,wintop:e.options.wintop,client_app_domain:e.options.client_app_domain?e.options.client_app_domain:null,client_app_name:e.options.client_app_name?e.options.client_app_name:null,odtMode:e.options.odtMode,events:{onNewSize:function(e){},onCancel:function(){e.options.webToWinComSocket.dispatchEvent("onDispatchToWin",{notif_name:"ClosePanel",notif_parameters:{}},"lf_web_in_win")},onValidation:function(t){e.dispatchEvent("onValidation",t)},onTitleChange:function(e){},onLaunchReportingPanel:function(t){e.setRefreshSessionData(t),e.hideWidget()},onTransferStart:function(){e.options.webInWinHelper.transferStart(e.options.webToWinComSocket)},onMaskUnmask:function(t){if(t)if(1==t.mask){var n="";t.message&&(n=t.message),1==e.options.odtMode?d.mask(e.widget.lastChild,n):d.mask(e.widget.body,n)}else 1==e.options.odtMode?d.unmask(e.widget.lastChild,n):d.unmask(e.widget.body)}}}),e.floatingPanel=e.container1=new p({title:"",className:"transferownership_webinwinwidget_floatingpanel",footer:e.TOSWidget.getTopBar(),body:e.TOSWidget,overlay:!1,closable:!1,animate:!0,resizable:!0,events:{widgetFloating:function(){e.onResize(),e.actionOnMove()},onMove:function(){e.actionOnMove()},onClose:function(){e._close()},onHide:function(){e._close()}}}),e.container1.inject(e.container),e.container1.elements.body.setStyle("height","100%"),e.container1.elements.body.setStyle("width","100%"),e.container1.show(),e.container.inject(e.parentWidget)},onFailure:function(e){alert("Error")}})},actionOnMove:function(){this.TOSWidget&&this.TOSWidget.actionOnMove()},hideWidget:function(){var e=this;e.TOSWidget&&e.TOSWidget.hide(),e.widget.getElement(".transferownership_webinwinwidget_floatingpanel")&&(e.widget.getElement(".transferownership_webinwinwidget_floatingpanel").style.display="none",e.widget.getElement(".floatingPanel_RightButtons")&&e.widget.getElement(".fonticon-resize-full")&&e.widget.getElement(".fonticon-resize-full").click(),e.widget.getElement(".modal-body")&&(e.widget.getElement(".modal-body").style.maxHeight="100%",e.widget.getElement(".modal-body").style.maxWidth="100%")),e.widget.getElement(".command_dialog")&&(e.widget.getElement(".modal-header").style.display="none",e.widget.getElement(".floatingPanel_RightButtons")&&e.widget.getElement(".fonticon-resize-full")&&e.widget.getElement(".fonticon-resize-full").click(),e.widget.getElement(".modal-body")&&(e.widget.getElement(".modal-body").style.maxHeight="100%",e.widget.getElement(".modal-body").style.maxWidth="100%"),e.widget.getElement(".toolbar-view-container")&&(e.widget.getElement(".toolbar-view-container").style.display="none")),e.onResize()},setRefreshSessionData:function(e){var t,n=this,i=[];if(e&&e.OKdata&&Array.isArray(e.OKdata))for(var o=0;o<e.OKdata.length;o++)i.push(e.OKdata[o]);i.length>0&&(t=n.options.webInWinHelper.createMoveJSONArray(i),n.refreshData=t,n.options.webToWinComSocket.dispatchEvent("onDispatchToWin",{notif_name:"refreshsession",notif_parameters:t},"lf_web_in_win"))},postResize:function(e){var t=this,n=t.widget.getElement(".command_dialog");n&&n.length>0&&(t.widget.getElement(".command_dialog").style.height="100%",t.widget.getElement(".command_dialog").style.width="100%",t.widget.getElement(".toolbar-view-container").style.display="none"),t.widget.getElement(".transferownership_webinwinwidget_floatingpanel")&&(t.widget.getElement(".transferownership_webinwinwidget_floatingpanel").style.height="100%",t.widget.getElement(".transferownership_webinwinwidget_floatingpanel").style.width="100%")},onResize:function(){var e=this;e.widget.getElement(".transferownership_webinwinwidget_floatingpanel")&&(e.widget.getElement(".transferownership_webinwinwidget_floatingpanel").style.height="100%",e.widget.getElement(".transferownership_webinwinwidget_floatingpanel").style.width="100%"),e.widget.getElement(".command_dialog")&&(e.widget.getElement(".command_dialog").style.height="100%",e.widget.getElement(".command_dialog").style.width="100%",e.widget.getElement(".modal-body")&&(e.widget.getElement(".modal-body").style.maxHeight="100%",e.widget.getElement(".modal-body").style.maxWidth="100%"),e.widget.getElement(".toolbar-view-container").style.display="none")},getDimensions:function(){return this.widget.getElement(".collab-transfer-ownership-floatingpanel").getBoundingClientRect()}})}));