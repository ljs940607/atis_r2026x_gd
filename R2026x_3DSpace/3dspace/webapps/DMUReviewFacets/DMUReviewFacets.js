define("DS/DMUReviewFacets/DMUR3MReviewController",["UWA/Core","UWA/Class","DS/Controls/Expander","DS/Controls/Button","DS/Menu/Menu","DS/DMUReadPersistence/DMUWebServicesUtils","DS/DMUControls/DMUAddMembersPanel","DS/DMUControls/panels/DMUMembersCommonComponent","DS/DMUBaseUI/DMUToolsUsers","DS/DMUControls/DMUReviewExpander","DS/DMUBaseUIControllers/utils/OpenWithMenuBuilder","DS/DMUValidationPersistence/DMUValidationPersistenceServices","DS/DMUBaseUIComponents/DMUSearchMembersServices","DS/PlatformAPI/PlatformAPI","i18n!DS/DMUReviewFacets/assets/nls/DMUReviewFacets","css!DS/DMUReviewFacets/DMUReviewFacets.css"],(function(e,t,n,i,s,a,o,l,r,c,d,h,g,u,p){"use strict";var m=t.extend({init:function(t){this._parent(t);var m=[];m.statusOK={fonticonClass:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-check",fonticonColor:"rgb(71,119,56)"},m.statusKO={fonticonClass:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-wrong",fonticonColor:"rgb(234,79,55)"},m.statusUNK={fonticonClass:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-i-question",fonticonColor:"#007DA3"},m.statusTBA={fonticonClass:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-attention",fonticonColor:"#007DA3"},m.requirement={fonticonClass:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-requirement",fonticonColor:"black"},m.highlight_urgent={fonticonClass:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-alert",fonticonColor:"rgb(153, 7, 7)"},m.highlight_high={fonticonClass:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-level-high",fonticonColor:"rgb(234,79,55)"},m.highlight_medium={fonticonClass:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-level-medium",fonticonColor:"rgb(232,123,0)"},m.highlight_low={fonticonClass:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-level-low",fonticonColor:"rgb(71,119,56)"},m.ca_high={fonticonClass:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-change",fonticonColor:"rgb(234,79,55)"},m.ca_medium={fonticonClass:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-change",fonticonColor:"rgb(232,123,0)"},m.ca_low={fonticonClass:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-change",fonticonColor:"rgb(71,119,56)"};var f,C,v,w,y,b,M,x,D,E,k,I,S,U=[m.statusUNK,m.statusOK,m.statusKO,m.requirement],A=[m.statusTBA,m.highlight_low,m.highlight_medium,m.highlight_high,m.statusOK,m.highlight_urgent],R=[],N=[],j=!1,F=!1,P=[],O=[],T=[],B=[],_={WIDTH:700,HEIGHT:800},V="X3DPRFL_AP",L=function(){},H=function(e){var t=!1;e.stopPropagation();var n,i=this.getParents();for(let e=0;e<i.length;e++){if(i[e].hasClassName("highlightsPanel-highlightsExpanders")){t=!0,n=i[e].getElementsByClassName("highlightFacetExpander");for(let e=0;e<n.length;e++)n[e].dsModel.expand()}if(i[e].hasClassName("checksPanel-checksExpanders")){t=!0,n=i[e].getElementsByClassName("checkFacetExpander");for(let e=0;e<n.length;e++)n[e].dsModel.expand()}}if(!1===t)for(let e=0;e<i.length;e++){if(i[e].hasClassName("highlightsContent")){n=i[e].getElementsByClassName("highlightFacetExpander");for(let e=0;e<n.length;e++)n[e].dsModel.expand()}if(i[e].hasClassName("checksContent")){n=i[e].getElementsByClassName("checkFacetExpander");for(let e=0;e<n.length;e++)n[e].dsModel.expand()}}},W=function(e){var t=!1;e.stopPropagation();var n,i=this.getParents();for(let e=0;e<i.length;e++){if(i[e].hasClassName("highlightsPanel-highlightsExpanders")){t=!0,n=i[e].getElementsByClassName("highlightFacetExpander");for(let e=0;e<n.length;e++)n[e].dsModel.collapse()}if(i[e].hasClassName("checksPanel-checksExpanders")){t=!0,n=i[e].getElementsByClassName("checkFacetExpander");for(let e=0;e<n.length;e++)n[e].dsModel.collapse()}}if(!1===t)for(let e=0;e<i.length;e++){if(i[e].hasClassName("highlightsContent")){n=i[e].getElementsByClassName("highlightFacetExpander");for(let e=0;e<n.length;e++)n[e].dsModel.collapse()}if(i[e].hasClassName("checksContent")){n=i[e].getElementsByClassName("checkFacetExpander");for(let e=0;e<n.length;e++)n[e].dsModel.collapse()}}},q=function(e,t,n){var i=[];t&&t.length>0&&t.forEach((function(e){var t=e.objectId;t||(t=e.object.getPlmID()),i.push({sObjectId:t,sListOfAttributesToModify:e.attributesList})})),h.updateAttributes({validationId:e,objectsToModify:i,platform:f,onAttributesSaveCompleted:function(e){var t,i,s,a=e.modifiedObjects[0];if(t=[a.pId],a.sName&&(t[a.pId]={title:a.sName},M(t)),a.sDescription&&(t[a.pId]={description:a.sDescription},M(t)),"Check"===n){a.iCheckState&&(t[a.pId]={iCheckState:a.iCheckState},M(t));for(let e=0;e<N.length;e++)N[e].updateImpactedCheckDisplay({id:a.pId,status:a.iCheckState?a.iCheckState:void 0,name:a.sName?a.sName:void 0});for(let e=0;e<O.length;e++){var o=T[O[e]].checks[a.pId];if(o&&a.iCheckState?o.status=a.iCheckState:o&&a.sName?o.name=a.sName:o&&a.sDescription&&(o.description=a.sDescription),P[O[e]]&&P[O[e]][a.pId].length){i=P[O[e]][a.pId];for(let t=0;t<i.length;t++){s=P[O[e]][i[t].id];for(let e=0;e<s.length;e++)s[e].id===a.pId&&(a.iCheckState?s[e].status=a.iCheckState:a.sName&&(s[e].name=a.sName))}}}}if("Highlight"===n){for(let e=0;e<R.length;e++)R[e].updateAssociatedHighlightsDisplay({id:a.pId,rating:a.iPresentationRating?a.iPresentationRating:void 0,name:a.sName?a.sName:void 0});for(let e=0;e<O.length;e++){var l=T[O[e]].highlights[a.pId];if(l&&a.iPresentationRating?l.rating=parseInt(a.iPresentationRating):l&&a.sName?l.name=a.sName:l&&a.sDescription&&(l.description=a.sDescription),P[O[e]]&&P[O[e]][a.pId].length){s=P[O[e]][a.pId];for(let t=0;t<s.length;t++){i=P[O[e]][s[t].id];for(let e=0;e<i.length;e++)i[e].id===a.pId&&(a.iPresentationRating?i[e].rating=a.iPresentationRating:a.sName&&(i[e].name=a.sName))}}}}},onAttributesSaveFailed:function(){}})},X=async function(e){if(e&&e.currentTarget&&e.currentTarget.id){var t;for(let n=0;n<O.length;n++){T[O[n]].checks[e.currentTarget.id]&&(t=T[O[n]].checks[e.currentTarget.id].requirements[0].id)}if(t){let a=await(i=t,new Promise(((e,t)=>{var n={id:i,type:"Requirement"};d.openWithApps(n,f).then((function(t){e(t)})).catch((function(){t(new Error)}))})));var n=e.event?e.event:e;n.stopPropagation();let o=n.pageX?{x:n.pageX,y:n.pageY}:null;o||(o=n.screenX?{x:n.screenX,y:n.screenY}:null),!o&&n.type&&-1!==n.type.indexOf("touch")&&n.changedTouches&&n.changedTouches[0]&&(o=(n=n.changedTouches[0]).pageX?{x:n.pageX,y:n.pageY}:null,o||(o=n.screenX?{x:n.screenX,y:n.screenY}:null)),o||(o={x:0,y:0}),s.show(a,{position:{x:o.x,y:o.y}})}}var i},z=function(e,t,n){var i,s=[];"status"===t&&s.push({iCheckState:n}),"name"===t&&s.push({sName:n}),"description"===t&&s.push({sDescription:n});var a=[];a.push({attributesList:s,objectId:e});for(let t=0;t<O.length;t++)T[O[t]].checks[e]&&(i=O[t]);if(q(i,a,"Check"),"status"===t){let t;switch(n){case 1:t="InProgress";break;case 2:t="Passed";break;case 3:t="Failed"}u.publish("DS/PADUtils/PADCommandProxy/validationState",{validationId:i,checkId:e,checkStatus:t})}},K=function(e,t,n){var i,s=[];"rating"===t&&s.push({iPresentationRating:n}),"name"===t&&s.push({sName:n}),"description"===t&&s.push({sDescription:n});var a=[];a.push({attributesList:s,objectId:e});for(let t=0;t<O.length;t++)T[O[t]].highlights[e]&&(i=O[t]);q(i,a,"Highlight")},G=function(e){var t,n;if(e&&e.length)for(let i=0;i<e.length;i++)if(!T[e[i].id]){O.push(e[i].id),T[e[i].id]={highlights:[],checks:[],name:e[i].name},B[e[i].id]={highlights:[],checks:[]},t=e[i].children;for(let s=0;s<t.length;s++)n=t[s].id,"DMUValidationExposedPresentation"===t[s].type&&(T[e[i].id].highlights[n]={id:n,rating:parseInt(t[s].rating),name:t[s].name,description:t[s].description,associatedCheck:t[s].associatedCheck,issues:t[s].Issue,changeAction:t[s].ChangeAction},B[e[i].id].highlights.push({id:n,rating:parseInt(t[s].rating),name:t[s].name,description:t[s].description,associatedCheck:t[s].associatedCheck,issues:t[s].Issue,changeAction:t[s].ChangeAction})),"DMUValidationCheck"===t[s].type&&(T[e[i].id].checks[n]={id:n,status:parseInt(t[s].state),name:t[s].name,description:t[s].description,requirements:t[s].children?t[s].children:void 0},B[e[i].id].checks.push({id:n,status:parseInt(t[s].state),name:t[s].name,description:t[s].description,requirements:t[s].children?t[s].children:void 0}))}},Y=function(e){var t,n,i,s;if(e&&e.length)for(let a=0;a<e.length;a++)if(n=e[a].id,!P[n]){t=B[n].highlights;for(let e=0;e<t.length;e++)if(i=t[e].id,t[e].associatedCheck&&t[e].associatedCheck.length){s=t[e].associatedCheck;for(let e=0;e<s.length;e++)P[n]||(P[n]=[]),P[n][i]||(P[n][i]=[]),P[n][s[e]]||(P[n][s[e]]=[]),P[n][i].push({id:T[n].checks[s[e]].id,status:T[n].checks[s[e]].status,name:T[n].checks[s[e]].name}),P[n][s[e]].push({id:T[n].highlights[i].id,rating:T[n].highlights[i].rating,name:T[n].highlights[i].name})}}},J=function(e,t){var n=new c({objectData:{id:e.id,rating:e.rating,name:e.name,description:e.description?e.description:"",changeAction:e.changeAction?e.changeAction:void 0,issues:e.issues?e.issues:void 0,tasks:e.tasks?e.tasks:void 0},editionMode:!1,readOnly:!1,onHighlightAttributeChanged:K,icons:A,checkIcons:U,impChecksInfos:P[t]?P[t]:[],type:"Highlight",panelType:{type:"facet"},highlightEditMode:Z(t).highlight});return n.getMainDiv().getContent().addClassName("highlightFacetExpander"),n.getMainDiv().expand(),N.push(n),n},Q=()=>{var e=r.getUserLogin(),t="";return e&&(t=e.login?e.login:e),t},Z=e=>{const t=JSON.parse(localStorage.getItem("r3mValidationObjects"))[e],n=()=>{let e=window.widget.getValue("xPref_CREDENTIAL"),n=e.split(".");e=n[0]?n[0]:"";return Q()===t.ownerid||["VPLMProjectLeader","VPLMAdmin"].includes(e)};let i;const s=t.validState;var a;const o=t.maturity;var l=Q();const r=l===t.ownerid;var c=C&&void 0!==C.members,d=c&&C.members[l]&&C.members[l].roles.some((e=>"contributor"===e)),h=c&&C.members[l]&&C.members[l].roles.some((e=>"assignee"===e)),g=c&&C.members[l]&&C.members[l].roles.some((e=>"coordinator"===e));o.contains("IN_WORK")?a="In Work":o.contains("PRIVATE")?a="Draft":o.contains("FROZEN")?a="Frozen":o.contains("RELEASED")?a="Released":o.contains("OBSOLETE")&&(a="Obsolete"),i=t.restrictedEdition?t.restrictedEdition:"Deactivated";const u={Deactivated:!c||g&&n()?"stateEdit":"readOnly",Draft:"readOnly","In Work":"inprogress"!==s.toLowerCase()||!n()||c&&!g?"readOnly":"stateEdit",Frozen:"readOnly",Released:"readOnly",Obsolete:"readOnly"};let p=u[i]||u[a]||"readOnly";const m={Deactivated:!c||g||r?"stateEdit":"readOnly",Draft:"inprogress"===s.toLowerCase()&&c&&g||"inprogress"===s.toLowerCase()&&r?"stateEdit":"readOnly","In Work":"inprogress"===s.toLowerCase()&&c&&g||"inprogress"===s.toLowerCase()&&r?"stateEdit":"readOnly",Frozen:"readOnly",Released:"readOnly",Obsolete:"readOnly"};let f=m[i]||m[a]||"readOnly";const v={Deactivated:!c||d||r?"edit":"readOnly",Draft:"inprogress"===s.toLowerCase()&&c&&(d||h)||!c&&"inprogress"===s.toLowerCase()?"edit":"readOnly","In Work":"inprogress"===s.toLowerCase()&&c&&(d||h)||!c&&"inprogress"===s.toLowerCase()?"edit":"readOnly",Frozen:"readOnly",Released:"readOnly",Obsolete:"readOnly"};let w=v[i]||v[a]||"readOnly";return{check:{canCreate:!1,canEditDef:!1,canEditState:"stateEdit"===p,canDelete:!1},highlight:{canCreate:!1,canEditDef:!1,canEditPriority:"stateEdit"===p,canDelete:!1},review:{canEditMembers:"stateEdit"===f,canChangeOwner:r,canSetContribCompleted:"edit"===w,canSetContribFromNSToOnGoing:"edit"===w,canSetContribFromCompletedToOnGoing:"stateEdit"===f}}},$=function(e,t){var n=new c({objectData:{id:e.id,status:e.status,name:e.name,description:e.description?e.description:"",requirements:e.requirements?e.requirements:void 0},editionMode:!1,readOnly:!1,onRequirementOpenWithClicked:X,onCheckAttributeChanged:z,icons:U,highlightIcons:A,impChecksInfos:P[t]?P[t]:[],type:"Check",panelType:{type:"facet"},checkEditMode:Z(t).check});return n.getMainDiv().getContent().addClassName("checkFacetExpander"),n.getMainDiv().expand(),R.push(n),n},ee=function(){var e=[],t={getID:()=>C.id,getLabel:()=>C.name};e.push(t);require(["DS/ENOCollabSharingCmds/commands/TransferOwnershipCmd/ActionBar_TransferOwnershipCmd","DS/PADUtils/PADSettingsMgt"],(function(t,n){var i={securityContext:{SecurityContext:n.getSetting("pad_security_ctx")},getSecurityContext:function(){return this.securityContext},getSelectedNodes:function(){return e}},s=new t({ID:"ActionBar_TransferOwnershipCmd_"+window.widget.id,context:i});s.onEnd((function(){var e=setInterval((function(){s.transferOwnershipPanel&&s.transferOwnershipPanel.addEvent&&(clearInterval(e),s.transferOwnershipPanel.addEvent("onValidation",(function(e){if((void 0===event||"click"===event.type)&&e.owner){var t=[{user:e.owner.person.personID,type:"person"}];b.updateOwnerView(t)}})))}))}),200),s.begin()}))};function te(e){var t={mode:"panel",height:_.HEIGHT,width:_.WIDTH};require(["DS/TransientWidget/TransientWidget"],(function(n){n.showWidget(V,"",{login:e,url:f.get3DSwymUrl()},t)}))}var ne=function(e,t){let n=null;return t.add&&t.add.length>0&&("assignees"===e?n=k:"contributors"===e&&(n=E),t.add.forEach((e=>{const t=n.find((t=>t.user===e.user));e.contribution=t?t.contribution:"NotStarted"})),t.add=t.add.map((e=>({user:e.user,type:e.type,id:e.id,contribution:e.contribution})))),t};function ie(e){return new Promise((t=>{a.fetchAttributes({ids:e,attributes:["ds6w:identifier"],platform:f}).then((n=>{if(n){var i=[];e.forEach((function(e){n[e]&&i.push(n[e]["ds6w:identifier"])})),t(i)}})).catch((()=>{t()}))}))}var se=function(e,t){return{user:e,type:t.type,id:t.id,contribution:t.contribution}},ae=function(e,t){let n=[];for(let i in e)if(e.hasOwnProperty(i)){let s=e[i];s.roles.includes(t)&&n.push(se(i,s))}return n};this.getValidations=function(t,s,a,c,d,m,U){f=c,M=d;var A=function(t){var s,o,l,r,c,d,h;w=new e.Element("div",{class:"highlightsContent"});var g,u=[];let m=p.noHighlight?p.noHighlight:"The selected Review does not contain any Highlight";if(t&&t.validations&&(G(t.validations),Y(t.validations)),t.validations&&t.validations.length&&t.validations.length>1)for(let i=0;i<t.validations.length;i++){var f=new e.Element("div",{class:"highlightExpanderContent"});if(s=t.validations[i].id,C=t.validations[i],a.length&&t.objects){o=[],h=!1;for(let e=0;e<t.objects.length;e++)(d=t.objects[e].validationId)===s&&(o.push(T[d].highlights[t.objects[e].highlightId]),h=!0);h||(o=B[s].highlights),h=!1}else o=B[s].highlights;if(0===o.length)new e.Element("div",{text:m,class:"noHighlight"}).inject(f).setStyles({"padding-top":"10px"});else for(let t=0;t<o.length;t++)F=!0,g=new e.Element("div",{class:"flowContainer"}).inject(f),J(o[t],s).inject(g).getContent().setStyles({"margin-left":"5px"});l=new e.Element("div",{class:"CollapseExpandAll"}),c=new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-expand-all expandAllIcon"}).inject(l),(r=new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-collapse-all collapseAllIcon"}).inject(l)).onclick=W,c.onclick=H;var v=new n({header:T[s].name,body:f,style:"simple",customHeader:l}).inject(w);v.expand(),v.elements.bodyContainer.setStyles({"padding-top":"0px"}),v.getContent().setStyles({"padding-bottom":"8px"}),v.getContent().addClassName("highlightsPanel-highlightsExpanders")}else if(t.validations.length&&1===t.validations.length){if(C=t.validations[0],a.length&&t.objects){o=[],h=!1;for(let e=0;e<t.objects.length;e++)d=t.objects[e].validationId,u.push(d),o.push(T[d].highlights[t.objects[e].highlightId])}else s=t.validations[0].id,o=B[s].highlights;if(o.length>0){var y=new e.Element("div",{class:"globalDiv"}).inject(w);l=new e.Element("div",{class:"CollapseExpandAll"}).inject(y);var b=new e.Element("div",{class:"expandIconPlaceholder"}).inject(l);(c=new i({displayStyle:"lite",label:"expand All",icon:{iconName:"expand-all",fontIconFamily:WUXManagedFontIcons.Font3DS},showLabelFlag:!1}).inject(b)).getContent().addClassName("expandAllIcon");var M=new e.Element("div",{class:"expandIconPlaceholder"}).inject(l);(r=new i({displayStyle:"lite",label:"collapse All",icon:{iconName:"collapse-all",fontIconFamily:WUXManagedFontIcons.Font3DS},showLabelFlag:!1}).inject(M)).getContent().addClassName("collapseAllIcon"),r.getContent().onclick=W,c.getContent().onclick=H}for(let t=0;t<o.length;t++)F=!0,g=new e.Element("div",{class:"flowContainer"}).inject(w),J(o[t],u.length?u[0]:s).inject(g).getContent().setStyles({"margin-left":"5px"})}F||new e.Element("div",{text:m,class:"noHighlight"}).inject(w),F=!1,U(w)},R=function(t){var a,o,l,r,c,d,h;v=new e.Element("div",{class:"checksContent"});var g,u=[];let m=p.noCheck?p.noCheck:"The selected Review does not contain any Check";if(t&&t.validations&&(G(t.validations),Y(t.validations)),t.validations&&t.validations.length&&t.validations.length>1)for(let i=0;i<t.validations.length;i++){a=t.validations[i].id,C=t.validations[i];var f=new e.Element("div",{class:"highlightExpanderContent"});if(s.length&&t.objects){o=[],h=!1;for(let e=0;e<t.objects.length;e++)(d=t.objects[e].validationId)===a&&(o.push(T[d].checks[t.objects[e].checkId]),h=!0);h||(o=B[a].checks)}else o=B[a].checks;if(0===o.length)new e.Element("div",{text:m,class:"noCheck"}).inject(f).setStyles({"padding-top":"10px"});else for(let t=0;t<o.length;t++)j=!0,g=new e.Element("div",{class:"flowContainer"}).inject(f),$(o[t],a).inject(g).getContent().setStyles({"margin-left":"5px"});l=new e.Element("div",{class:"CollapseExpandAll"}),c=new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-expand-all expandAllIcon"}).inject(l),(r=new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-collapse-all collapseAllIcon"}).inject(l)).onclick=W,c.onclick=H;var w=new n({header:T[a].name,body:f,style:"simple",customHeader:l}).inject(v);w.expand(),w.elements.bodyContainer.setStyles({"padding-top":"0px"}),w.getContent().setStyles({"padding-bottom":"8px"}),w.getContent().addClassName("checksPanel-checksExpanders")}else if(t.validations&&t.validations.length&&1===t.validations.length){if(C=t.validations[0],s.length&&t.objects){o=[];for(let e=0;e<t.objects.length;e++)d=t.objects[e].validationId,u.push(d),o.push(T[d].checks[t.objects[e].checkId])}else a=t.validations[0].id,o=B[a].checks;if(o.length>0){var y=new e.Element("div",{class:"globalDiv"}).inject(v);l=new e.Element("div",{class:"CollapseExpandAll"}).inject(y);var b=new e.Element("div",{class:"expandIconPlaceholder"}).inject(l);(c=new i({displayStyle:"lite",label:"expand All",icon:{iconName:"expand-all",fontIconFamily:WUXManagedFontIcons.Font3DS},showLabelFlag:!1}).inject(b)).getContent().addClassName("expandAllIcon");var M=new e.Element("div",{class:"collapseIconPlaceholder"}).inject(l);(r=new i({displayStyle:"lite",label:"collapse All",icon:{iconName:"collapse-all",fontIconFamily:WUXManagedFontIcons.Font3DS},showLabelFlag:!1}).inject(M)).getContent().addClassName("collapseAllIcon"),r.getContent().onclick=W,c.getContent().onclick=H}for(let t=0;t<o.length;t++)j=!0,g=new e.Element("div",{class:"flowContainer"}).inject(v),$(o[t],u.length?u[0]:a).inject(g).getContent().setStyles({"margin-left":"5px"})}j||new e.Element("div",{text:m,class:"noCheck"}).inject(v),j=!1,U(v)};function N(){var e=[],t={},n={};let i=r.getUserLogin();for(let t of E)e.push(t.contribution);for(let t of k)e.push(t.contribution);n.valAssignees=E,n.valContributors=k,t.valCoordinators=D;let s=function(e){let t=!1,n=!1,i=!1;return e.forEach((e=>{switch(e){case"NotStarted":t=!0;break;case"OnGoing":n=!0;break;case"Completed":i=!0}})),n||t&&i?"OnGoing":t||!t&&!n&&!i?"NotStarted":i?"Completed":void 0}(e);return t.currentUser=i,t.membersContribution=s,t._createAddMembersPanel=_,t}function P(e,t){return new Promise(((n,i)=>{var s=[];for(let n=0;n<e.length;n++){var a=r.getUserName(e[n].user,c);s.push(a.then((function(i){return{siteName:i,name:e[n].user,userType:e[n].type,contribution:!0===t?e[n].contribution:null,contributionNls:!0===t?p.contributionValue[e[n].contribution]:null}})).catch((function(e){i(e)})))}n(Promise.all(s))}))}var O=function(e){h.updateValidationMembers({validationId:C.id,membersUpdate:e,platform:f,onUpdateMembersSuccessful:function(e){if(e){var t=e.result,n=t.assignees,i=t.coordinators,s=t.contributors,a=t.informedusers;n=ne("assignees",n),s=ne("contributors",s),b.updateMembersView({owner:[{user:C.owner,type:"person"}],assignees:n,coordinators:i,contributors:s,informedUsers:a}),z()}},onUpdateMembersFailed:function(){}})},_=function(){new o({parentDiv:x}).buildAdditionPanel({getMembers:function(e){return g.getMembers({text:e,platformOptions:f})},searchMember:function(e){return g.searchMember(e)},saveMembers:O,additionalMembersInfo:ie,owner:S,valCoordinators:D,valAssignees:E,valContributors:k,valInformedUsers:I})},V=function(e){var t=function(e){let t=[];function n(e){e.forEach((e=>{"Markup"===e.type&&t.push(e),"Reply"===e.type&&t.push(e),e.children&&Array.isArray(e.children)&&n(e.children)}))}return n(e),t}(C.children);let n=t.some((t=>"Reply"===t.type&&t.owner===e)),i=t.some((t=>"Markup"===t.type&&t.owner===e));return i&&n?"Markup_Reply":n&&!i?"Reply":i&&!n?"Markup":""},q=function(t){y=new e.Element("div",{class:"membersContent"});let n=p.noMember?p.noMember:"The selected Review does not contain any Member";x=document.getElementsByClassName("appMain")[0];const i=r.getUserLogin(),s=f.get3DSwymUrl();if(t.validations&&t.validations.length)for(let o=0;o<t.validations.length;o++){if(C=t.validations[o],1===t.validations.length){if(""!==C.members){const e=Z(C.id);var a=C.members;if(S=[{user:C.owner,type:"person"}],D=ae(a,"coordinator"),E=ae(a,"assignee"),k=ae(a,"contributor"),I=ae(a,"informeduser"),b)for(let e in b)b.hasOwnProperty(e)&&delete b[e];b=new l({quickAccessBtnData:N(),currentUser:i,parentDiv:x,cellDataJsonCreation:P,membersContent:y,owner:S,coordinators:D,assignees:E,contributors:k,informedUsers:I,readOnlyFlag:!1,editionMode:!0,saveMembers:O,openWindow:te,fireContributionEvent:X,platformUrl:s,restrictions:e,isMarkupsOfUserExist:V,transferOwnership:ee})}""!==C.members&&(D||k||E||I)||new e.Element("div",{text:n,class:"noMember"}).inject(y)}else if(t.validations.length>1){let t=p.multiMembers?p.multiMembers:"Selection of multiple Objects not supported";new e.Element("div",{text:t,class:"multiMembers"}).inject(y).setStyles({"padding-top":"10px","margin-left":"5px","text-align":"center","font-weight":"bold",opacity:"50%"});break}z()}U(y,b.sectionHeader)};function X(e){var t=[];t.push({sObjectId:e.connectionId,sListOfAttributesToModify:[{sContribution:e.contribution}]});h.updateAttributes({objectsToModify:t,platform:f,onAttributesSaveCompleted:function(e){const t=e.modifiedObjects[0];if(t){const e=E,n=k;let i=e.find((e=>e.id===t.pId))||n.find((e=>e.id===t.pId));i&&(i.contribution=t.sContribution,i.bIsAssignee=e.some((e=>e.id===t.pId)),i.bIsContributor=n.some((e=>e.id===t.pId))),b.updateContributionCells(i),z()}},onAttributesSaveFailed:function(){}})}var z=function(){if(b){let e=b.sectionHeader,t=N(),n=b.createQuickAccessCmdButtonsList(t);e.setQuickAccessCommands(n),e.setHeaderLabel(p.membersPanelHeaderTitle)}};const K=()=>{require(["DS/DMUReadPersistence/DMUValidationReadServices"].concat([]),(function(e){(new e).getValidationsFromObjectsIds({highlightIds:a,checkIds:s,validationIds:t,onSuccess:"Highlight"===m?A:"Check"===m?R:q,onFailure:L,platform:c})}))};u.subscribe("DS/DMUwebR3Mctrl/R3MObjectModified",(e=>{"maturity"!==e.modified&&"validationState"!==e.modified||v&&v.destroy(),w&&w.destroy(),K()})),(a.length||s.length||t.length)&&K()},this.clearView=function(e){var t;if("Highlight"===e&&w){N=[];var n=w.getElementsByClassName("highlightsPanel-highlightsExpanders");if(n.length)for(let e=0;e<n.length;e++){n[e].getElementsByClassName("expandAllIcon").length&&n[e].getElementsByClassName("expandAllIcon")[0].destroy(),n[e].getElementsByClassName("collapseAllIcon").length&&n[e].getElementsByClassName("collapseAllIcon")[0].destroy(),t=n[e].getElementsByClassName("highlightFacetExpander");for(let e=0;e<t.length;e++)t[e].dsModel.clear(),t[e].destroy();n[e].getElementsByClassName("noHighlight").length&&n[e].getElementsByClassName("noHighlight")[0].destroy(),n[e].destroy()}else{w.getElementsByClassName("expandAllIcon").length&&w.getElementsByClassName("expandAllIcon")[0].destroy(),w.getElementsByClassName("collapseAllIcon").length&&w.getElementsByClassName("collapseAllIcon")[0].destroy(),t=w.getElementsByClassName("highlightFacetExpander");for(let e=0;e<t.length;e++)t[e].dsModel.clear(),t[e].destroy()}w.destroy()}if("Check"===e&&v){R=[];var i=v.getElementsByClassName("checksPanel-checksExpanders");if(i.length)for(let e=0;e<i.length;e++){i[e].getElementsByClassName("expandAllIcon").length&&i[e].getElementsByClassName("expandAllIcon")[0].destroy(),i[e].getElementsByClassName("collapseAllIcon").length&&i[e].getElementsByClassName("collapseAllIcon")[0].destroy(),t=i[e].getElementsByClassName("checkFacetExpander");for(let e=0;e<t.length;e++)t[e].dsModel.clear(),t[e].destroy();i[e].getElementsByClassName("noCheck").length&&i[e].getElementsByClassName("noCheck")[0].destroy(),i[e].destroy()}else{v.getElementsByClassName("expandAllIcon").length&&v.getElementsByClassName("expandAllIcon")[0].destroy(),v.getElementsByClassName("collapseAllIcon").length&&v.getElementsByClassName("collapseAllIcon")[0].destroy(),t=v.getElementsByClassName("checkFacetExpander");for(let e=0;e<t.length;e++)t[e].dsModel.clear(),t[e].destroy()}v.destroy()}"Member"===e&&y&&(b=null,y.destroy()),O=[],B=[],T=[]}}}),f=[];return t.singleton({init:function(){},getDMUR3MReviewController:function(){for(var e,t=0;t<f.length;t++){f[t].counter++,e=f[t].reviewController;break}if(!e){var n=new m;e={getValidations:function(e,t,i,s,a,o,l){if(n)return n.getValidations(e,t,i,s,a,o,l)},clearView:function(e){if(n)return n.clearView(e)}},f.push({reviewController:e,counter:1})}return e?Object.freeze(e):e},giveDMUR3MReviewController:function(){for(var e,t=0;t<f.length;t++){e=f[t].reviewController;break}return e?Object.freeze(e):e},unreferenceDMUR3MReviewController:function(){for(var e=0;e<f.length;e++){f[e].counter--,f[e].counter<=0&&(f[e].reviewController.clear(),f.splice(e,1));break}}})})),define("DS/DMUReviewFacets/DMUwebR3MinfoRvwHighlightTab",["UWA/Core","DS/EditPropWidget/facets/Common/FacetsBase","UWA/Controls/ThemedScroller","DS/DMUReviewFacets/DMUR3MReviewController"],(function(e,t,n,i){"use strict";return t.extend({init:function(t){this._parent(t);var s,a=t.requestUtils,o=this;this.elements={},this.elements.container=e.createElement("div",{class:"infoRvwHighlight"});var l=[],r=[],c=function(e){var t=e.getElementsByClassName("reviewExpander"),i=e.getElementsByClassName("highlightsPanel-highlightsExpanders");for(let e=0;e<t.length;e++)l.push(t[e].dsModel);for(let e=0;e<i.length;e++)r.push(i[e].dsModel);s||(s=(new n).inject(o.elements.container)).getContent().setStyle("height","100%"),s.getInnerElement().setContent(e),o.hideLoader()};this.updateFacet=function(){var e,n,s=this.getModel(),o=s.get("objectId"),l=s.get("_DS_ATTR_type");l=l&&l.valueDB?l.valueDB:s.get("_DS_ATTR_type");var r=[],d=[],h=[],g=i.giveDMUR3MReviewController();if(g||(g=i.getDMUR3MReviewController()),g.clearView("Highlight"),this.showLoader(),!s)return!1;if(s.getMergingModels){e=s.getMergedModelIds(),n=s.getMergingModels();for(let t=0;t<e.length;t++)"DMUValidationValidation"===(l=(l=n[e[t]].get("_DS_ATTR_type"))&&l.valueDB?l.valueDB:n[e[t]].get("_DS_ATTR_type"))?r.push(e[t]):"DMUValidationCheck"===l?d.push(e[t]):"DMUValidationExposedPresentation"===l&&h.push(e[t])}else"DMUValidationValidation"===l?r.push(o):"DMUValidationCheck"===l?d.push(o):"DMUValidationExposedPresentation"===l&&h.push(o);g.getValidations(r,d,h,a,t.onFacetModification,"Highlight",c)},this.destroyComponent=function(){},this.clearFacet=function(){for(let e=0;e<l.length;e++)l[e].destroy();for(let e=0;e<r.length;e++)r[e].destroy();l=[],r=[]},this.onResize=function(){},this.onRefresh=function(){this.clearFacet(),this.updateFacet()}}})})),define("DS/DMUReviewFacets/DMUwebR3MinfoRvwMembersTab",["UWA/Core","DS/EditPropWidget/facets/Common/FacetsBase","UWA/Controls/ThemedScroller","DS/DMUReviewFacets/DMUR3MReviewController"],(function(e,t,n,i){"use strict";return t.extend({init:function(t){this._parent(t);var s,a,o=t.requestUtils,l=this;this.elements={},this.elements.container=e.createElement("div",{class:"infoRvwMemberTab"});var r=function(e,t){l.clearFacet(),a=t;let i=l.elements.container.getStyle("background-color");a.getContent().getChildren()[0].setStyles({"background-color":i}),a.getContent().setStyles({"background-color":i}),s||(l.elements.container.appendChild(a.getContent()),(s=(new n).inject(l.elements.container)).getContent().setStyle("height","100%")),s.getInnerElement().setContent(e),l.hideLoader()};this.updateFacet=function(){var e,n,s=this.getModel(),a=s.get("objectId"),l=s.get("_DS_ATTR_type");l=l&&l.valueDB?l.valueDB:s.get("_DS_ATTR_type");var c=[],d=[],h=[],g=i.giveDMUR3MReviewController();if(g||(g=i.getDMUR3MReviewController()),g.clearView("Member"),this.showLoader(),!s)return!1;if(s.getMergingModels){e=s.getMergedModelIds(),n=s.getMergingModels();for(let t=0;t<e.length;t++)"DMUValidationValidation"===(l=(l=n[e[t]].get("_DS_ATTR_type"))&&l.valueDB?l.valueDB:n[e[t]].get("_DS_ATTR_type"))?c.push(e[t]):"DMUValidationCheck"===l?d.push(e[t]):"DMUValidationExposedPresentation"===l&&h.push(e[t])}else"DMUValidationValidation"===l?c.push(a):"DMUValidationCheck"===l?d.push(a):"DMUValidationExposedPresentation"===l&&h.push(a);g.getValidations(c,d,h,o,t.onFacetModification,"Member",r)},this.destroyComponent=function(){},this.clearFacet=function(){if(l.elements.container){for(;l.elements.container.firstChild;)l.elements.container.removeChild(l.elements.container.firstChild);a&&a.clear(),s&&s.destroy(),a=s=null}},this.onResize=function(){},this.onRefresh=function(){this.clearFacet(),this.updateFacet()}}})})),define("DS/DMUReviewFacets/DMUwebR3MinfoRvwCheckTab",["UWA/Core","DS/EditPropWidget/facets/Common/FacetsBase","UWA/Controls/ThemedScroller","DS/DMUReviewFacets/DMUR3MReviewController"],(function(e,t,n,i){"use strict";return t.extend({init:function(t){this._parent(t);var s,a=t.requestUtils,o=this;this.elements={},this.elements.container=e.createElement("div",{class:"infoRvwCheckTab"});var l=[],r=[],c=function(e){var t=e.getElementsByClassName("reviewExpander"),i=e.getElementsByClassName("checksPanel-checksExpanders");for(let e=0;e<t.length;e++)l.push(t[e].dsModel);for(let e=0;e<i.length;e++)r.push(i[e].dsModel);s||(s=(new n).inject(o.elements.container)).getContent().setStyle("height","100%"),s.getInnerElement().setContent(e),o.hideLoader()};this.updateFacet=function(){var e,n,s=this.getModel(),o=s.get("objectId"),l=s.get("_DS_ATTR_type");l=l&&l.valueDB?l.valueDB:s.get("_DS_ATTR_type");var r=[],d=[],h=[],g=i.giveDMUR3MReviewController();if(g||(g=i.getDMUR3MReviewController()),g.clearView("Check"),this.showLoader(),!s)return!1;if(s.getMergingModels){e=s.getMergedModelIds(),n=s.getMergingModels();for(let t=0;t<e.length;t++)"DMUValidationValidation"===(l=(l=n[e[t]].get("_DS_ATTR_type"))&&l.valueDB?l.valueDB:n[e[t]].get("_DS_ATTR_type"))?r.push(e[t]):"DMUValidationCheck"===l?d.push(e[t]):"DMUExposedPresentation"===l&&h.push(e[t])}else"DMUValidationValidation"===l?r.push(o):"DMUValidationCheck"===l?d.push(o):"DMUExposedPresentation"===l&&h.push(o);g.getValidations(r,d,h,a,t.onFacetModification,"Check",c)},this.destroyComponent=function(){},this.onResize=function(){},this.onRefresh=function(){this.updateFacet()}}})}));