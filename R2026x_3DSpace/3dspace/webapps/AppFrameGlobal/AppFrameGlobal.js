define("DS/AppFrameGlobal/transition/TransitionDecision",[],(function(){"use strict";var e=function(){};return e.prototype.execute=function(e,t){throw new Error("Not implemented")},e.extend=function(t){t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1}})},e})),define("DS/AppFrameGlobal/model/Container",[],(function(){"use strict";function e(e,t){e.currentIndex=t}var t=function(e){this.id=e.id,this.contexts=e.contexts||[],this.currentIndex=void 0===e.currentIndex?-1:e.currentIndex};return t.prototype.getId=function(){return this.id},t.prototype.getContexts=function(){return this.contexts},t.prototype.getCurrentContext=function(){return this.currentIndex<0?null:this.contexts[this.currentIndex]},t.prototype.getCurrentApp=function(){var e=this.getCurrentContext();return e?e.getCurrentApp():null},t.prototype.addExecutionContext=function(t,n){this.contexts.push(t),n&&e(this,this.contexts.length-1)},t.prototype.setCurrentContextIndex=function(t){if(t>=this.contexts.length)throw new Error("The index "+t+"is out of bound > "+this.contexts.length);t<0&&(t=-1),e(this,t)},t.prototype.toString=function(){return"{\n\tid:"+this.id+",\n\t contexts :"+this.contexts+",\n\t currentIndex :"+this.currentIndex+"\n}"},t})),define("DS/AppFrameGlobal/model/FrameContext",[],(function(){"use strict";function e(e,t){e.currentIndex=t}var t=function(e){this.containers=[],this.currentIndex=-1};return t.prototype.getContainers=function(){return this.containers},t.prototype.getCurrentContainer=function(){return this.currentIndex<0?null:this.containers[this.currentIndex]},t.prototype.getCurrentExecutionContext=function(){var e=this.getCurrentContainer();return e?e.getCurrentContext():null},t.prototype.getCurrentApp=function(){var e=this.getCurrentExecutionContext();return e?e.getCurrentApp():null},t.prototype.indexOfContainer=function(e){for(var t=this.getContainers(),n=0;n<t.length;n++){if(t[n].getId()==e)return n}return-1},t.prototype.addContainer=function(t,n){this.containers.push(t),n&&e(this,this.containers.length-1)},t.prototype.setCurrentContainerIndex=function(t){if(t>=this.containers.length)throw new Error("The index "+t+"is out of bound > "+this.containers.length);t<0&&(t=-1),e(this,t)},t.prototype.getContextOfApp=function(e){var t=this.getContainerOfApp(e);return t?t.getCurrentContext():null},t.prototype.getContainerOfApp=function(e){for(var t=this.containers,n=0;n<t.length;n++){var r=t[n],o=r.getCurrentApp();if(o&&o.getId()==e)return r}return null},t.prototype.forEachContext=function(e){if(e)for(var t=this.containers,n=0;n<t.length;n++)for(var r=t[n].getContexts(),o=0;o<r.length;o++){e(r[o])}},t.prototype.toString=function(){return"{\n\tcontainers :"+this.containers+",\n\t currentIndex :"+this.currentIndex+"\n}"},t}));var AppFramemod_WafData="DS/WAFData/WAFData";define("DS/AppFrameGlobal/DelegateFrame",["UWA/Data",AppFramemod_WafData,"UWA/Class/Promise","DS/WebappsUtils/WebappsUtils"],(function(e,t,n,r,o){"use strict";var i=function(){};return i.WAFData=t,i.prototype.requestJson=function(e){return new n((function(n,r){t.request(e,{type:"json",responseType:"json",onComplete:function(e){n(e)},onFailure:r})}))},i.prototype.requestWebService=function(e){return new n((function(n,r){t.proxifiedRequest(e,{type:"json",responseType:"json",onComplete:function(e){n(e)},onFailure:r})}))},i.prototype.loadIdCard=function(e,t){var r=e.getConfigUrl();if(r){if(r.endsWith(".json")){var o=this;return this.requestJson(r).then((function(e){return e.afrConfigurations?e.afrPreferences?(t=e.afrPreferences,new Promise((function(e,n){var r="DS/MePreferencesClientAPI/MePreferencesClientAPI";require([r],(function(r){if(!r||!r.readPreferences)return e(!1);r.readPreferences([{Repository:t.repositoryName,PreferenceNames:[t.preferenceName]}]).then((function(t){var r;return t&&t.repositories&&t.repositories[0]&&t.repositories[0].preferences&&t.repositories[0].preferences[0]&&t.repositories[0].preferences[0].value&&(r=t.repositories[0].preferences[0].value),"boolean"==typeof r?e(r):"string"==typeof r?e("true"===r.toLowerCase()):n(new Error("[AFR] The AFR preference is not of a good type"))}))}),(function(t){if(t.requireModules&&t.requireModules[0]&&t.requireModules[0].includes&&t.requireModules[0].includes(r))return e(!1);throw new Error("require failed with ",t)}))}))).then((function(t){return t?e.afrConfigurations[1]:e.afrConfigurations[0]})):Promise.reject(new Error("[AFR] Cannot retrieve the correct configuration without preference")):e;var t})).then((function(i){if(i.afrService){var a="";if(i.afrServiceUrl&&""!==i.afrServiceUrl)a=i.afrServiceUrl;else{var s=(a=r).split(":");s.length>=2&&(a=s[0]+":"+s[1])}return i.afrServicePort&&(a+=":"+i.afrServicePort),i.appId=i.appId||i.afrAppId,a+="/"+i.afrService+i.appId,"string"==typeof t&&""!==t&&(a=a+"?lang="+t),o.requestWebService(a).then((e=>Promise.resolve({concatenation:e})))}if(i.afrAppId){const t=i.afrAppId;return r=e.getUrl().replace(/[a-zA-Z0-9]*\/[a-zA-Z0-9]*.html/,"WebAfr/Applications/"+t+".json"),o.requestJson(r).then((e=>Promise.resolve({concatenation:e,configuration:i})))}return n.resolve({concatenation:i})}))}return this.requestWebService(configUrl).then((e=>Promise.resolve({concatenation:e})))}{const t=e.isA2X()&&e.isStandardApp()?"WAfrA2XStandard_AP":e.getId();return r=e.getUrl().replace(/[a-zA-Z0-9]*\/[a-zA-Z0-9]*.html/,"WebAfr/Applications/"+t+".json"),this.requestJson(r).then((e=>Promise.resolve({concatenation:e})))}},i.prototype.buildFrameContext=function(){throw this.options.success&&this.options.success(new FrameContext),new Error("This call must be implemented by sub class")},i.prototype.onTransitionSuccessful=function(e){throw new Error("This call must be implemented by sub class")},i.prototype.createContainer=function(e){throw log("Create container of apps ** To overrride"),errorCallback&&errorCallback.call(),new Error("This call must be implemented by sub class")},i.prototype.publish=function(e,t){throw new Error("This call must be implemented by sub class")},i.prototype.subscribe=function(e,t){throw new Error("This call must be implemented by sub class")},i.prototype.unsubscribe=function(e){throw new Error("This call must be implemented by sub class")},i.prototype.getCurrentLanguage=function(){return o&&o.getCurrentLanguage()},i})),define("DS/AppFrameGlobal/model/App",["UWA/Core"],(function(e){"use strict";const t="AppFrameContainer/container.html",n="WAfrContainerAsWidget/container.html";var r=function(t){this.options={id:null,title:null,brand:null,url:null,configUrl:null},t.appInfo&&(t.nativeInformation=t.appInfo.nativeInformation,t.defaultPage=t.appInfo.defaultPage,t.type=t.appInfo.type,delete t.appInfo),this.options=e.extend(e.clone(this.options),t)};return r.prototype.getId=function(){return this.options.id},r.prototype.getAfrAppId=function(){return this.options.afrAppId||this.options.appConfig.afrAppId},r.prototype.setAfrAppId=function(e){this.options.afrAppId=e},r.prototype.getTitle=function(){return this.options.title},r.prototype.getBrand=function(){return this.options.brand},r.prototype.getUrl=function(){return this.options.url},r.prototype.getBaseUrl=function(){var e=this.options.url.indexOf(t);if(e||(e=this.options.url.indexOf(n)),e)return this.options.url.substring(0,e)},r.prototype.getConfigUrl=function(){return this.options.configUrl},r.prototype.getAppConfig=function(){return this.options.appConfig},r.prototype.getFamily=function(){return this.options.appConfig&&this.options.appConfig.afrFamily},r.prototype.setAppConfig=function(t){this.options.appConfig=e.extend(this.options.appConfig||{},t)},r.prototype.getServiceInfo=function(){if(void 0===this._serviceInfo){var e="?afrWebService",t=this.getUrl(),n=t.indexOf(e);if(n>0){for(var r=t.substring(n+14,t.length).split("/"),o=null,i={protocol:"",host:"",port:"8080",service:null,appId:""},a=0;a<r.length;a++)2===(o=r[a].split(":")).length&&(i[o[0]]=o[1]);var s=i.service?i.service+"/wafr/apps/":"";i.protocol&&i.host&&(s=i.protocol+"://"+i.host+":"+i.port+"/"+s),this._serviceInfo={afrService:s,afrServicePort:i.port,appId:i.appId}}else this._serviceInfo=null}return this._serviceInfo},r.prototype.supportTransition=function(){return this.options.url.endsWith(t)||this.isNewInfra()},r.prototype.isNewInfra=function(){return this.options.url.indexOf(n)>=0||this.options.url.indexOf("WA2XContainer/container.html")>=0},r.prototype.toString=function(){return"{\n\tid:"+this.options.id+", \n\ttitle :"+this.options.title+"\n}"},r.prototype.getStartWb=function(){let e=null;if(this.options.nativeInformation)e=this.options.nativeInformation.workbench;else{const t=this.getAfrAppId().split("_AP");e=t?t[0]:null}if(!e)throw new Error("getStartWb : no start workbench found");return e},r.prototype.isStandardApp=function(){return this.options.defaultPage},r.prototype.isA2X=function(){return this.options.type&&"a2x"===this.options.type.toLowerCase()},r})),define("DS/AppFrameGlobal/model/ExecutionContext",[],(function(){"use strict";var e=function(e,t){this.id=e,this.currentApp=t};return e.prototype.getId=function(){return this.id},e.prototype.getCurrentApp=function(){return this.currentApp},e.prototype.toString=function(){return"{\n\tid:"+this.id+",\n\t currentApp :"+this.currentApp+"\n}"},e})),define("DS/AppFrameGlobal/transition/CreateNewContainer",["DS/AppFrameGlobal/transition/TransitionDecision","UWA/Class/Promise"],(function(e,t){"use strict";var n=function(e){this.containerId=e};return e.extend(n),n.prototype.getContainerId=function(){return this.containerId},n.prototype.execute=function(e){return t.reject(new Error("Transition is not possible"))},n})),define("DS/AppFrameGlobal/transition/ReuseContext",["UWA/Core","DS/AppFrameGlobal/transition/TransitionDecision"],(function(e,t){"use strict";var n=function(e){this.options=e||{}};return t.extend(n),n.prototype.getContextId=function(){return this.contextId},n.prototype.execute=function(t,n){var r=this;return new e.Class.Promise((function(e,o){var i=r.options.contextId,a=n.getAppConfig();if(!i){if(r.options.of)i=t.frameContext.getContextOfApp(r.options.of).getId();if(!i){var s=t.frameContext.getCurrentExecutionContext();s||o(new Error("Cannot reuse the current context cause it do not exist ")),i=s.getId()}}i||o(new Error("The id of the current context is null ! ")),a.baseUrl=n.getBaseUrl(),a.brand=n.options.brand;const p=n.options,u={applicationConcatenation:a,appIds:{appId:n.getId(),afrAppId:n.getAfrAppId(),appTitle:n.getTitle()},appInfo:p};t.delegateFrame.publish("onReuseContext."+i,u)}))},n})),define("DS/AppFrameGlobal/transition/CreateNewContext",["DS/AppFrameGlobal/transition/TransitionDecision","DS/AppFrameGlobal/transition/CreateNewContainer"],(function(e,t){"use strict";var n=function(e){this.options=e};return e.extend(n),n.prototype.getContainerId=function(){return this.containerId},n.prototype.execute=function(e,n){var r=null;if(this.options.of){var o=e.frameContext.getContainerOfApp(this.options.of);if(o){r=o.getId();n.getId();return e.delegateFrame.publish("onCreateContext."+r,n.getAppConfig()),UWAPromise.resolve()}}return t.prototype.execute.call(this,e,n)},n})),define("DS/AppFrameGlobal/transition/ErrorDecision",["DS/AppFrameGlobal/transition/TransitionDecision"],(function(e){"use strict";var t=function(e){this.messageId=e};return e.extend(t),t.prototype.execute=function(e,t){return alert("Error during transition"),UWA.Class.Promise.reject()},t})),define("DS/AppFrameGlobal/AppFrame",["UWA/Core","UWA/Data","UWA/Class","UWA/Class/Promise","UWA/Utils","WebappsUtils/WebappsUtils","DS/AppFrameGlobal/model/App","DS/AppFrameGlobal/model/Container","DS/AppFrameGlobal/model/ExecutionContext","DS/AppFrameGlobal/model/FrameContext","DS/AppFrameGlobal/DelegateFrame","DS/AppFrameGlobal/transition/CreateNewContainer","DS/AppFrameGlobal/transition/CreateNewContext","DS/AppFrameGlobal/transition/ErrorDecision","DS/AppFrameGlobal/transition/ReuseContext"],(function(e,t,n,r,o,i,a,s,p,u,l,c,f,d,m){"use strict";window.performance.mark=window.performance.mark||function(){},window.performance.measure=window.performance.measure||function(){};var g=window.location.href.indexOf("debug")>=0,h={log:function(e){g&&console.log("[Afr]"+e)},warn:function(e){g&&console.warn("[Afr]"+e)},severe:function(e){g&&console.error("[Afr]"+e)},inherit:function(e,t){e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1}})}};h.App=a,h.FrameContext=u,h.FrameContext.ExecutionContext=p,h.FrameContext.Container=s,h.DelegateFrame=l,h.TransitionDecision=Object.create(null),h.TransitionDecision.ErrorDecision=d,h.TransitionDecision.CreateNewContext=f,h.TransitionDecision.CreateNewContainer=c,h.TransitionDecision.ReuseContext=m;var C={type:"CreateNewContext"},A={type:"ReuseContext"};function b(t,n){if(!t)throw new Error("Must define a transition");var r=t.type;if(!r)throw new Error("No defined a type");var o=h.TransitionDecision[r];if(!o)throw new Error("No type "+r+" do not exist");var i=e.clone(t);return delete i.type,new o(i)}var x=b(C),F=function(e){if(this.delegateFrame=e,!this.delegateFrame)throw new Error("Need to provide a delegate Frame");if(!(this.delegateFrame instanceof h.DelegateFrame))throw new Error("Not a valid delagate Frame");this._apps={},this.frameContext=null,this._currentTransition=!1;var t=this;this.delegateFrame.subscribe("TransEnd",(function(e){t.delegateFrame.onTransitionSuccessful(e)}))};F.prototype.doTransition=function(t,n,o){if(n&&"AppTester"==n&&(this._context="AppTester"),this._widgetcreation=!(!o||1!=o),this._currentTransition)return r.reject();if(!t)return r.reject();if(!t.supportTransition())return h.warn("The target app "+t+" do not support the Afr transition"),r.reject(new Error("The target app "+t+" do not support the Afr transition"));var i=this,a=t.getId();return a?(window.performance.mark("WAfrGlobalAppFrame_doTransition_"+a),i._currentTransition=!0,new r((function(n,o){var s=function(e){i.delegateFrame.unsubscribe("onAppReady."+a),i.delegateFrame.unsubscribe("onAppFail."+a),i.delegateFrame.publish("hideAfrLoader"),i._currentTransition=!1,window.performance.mark("WAfrGlobalAppFrame_doTransitionFailure_"+a),window.performance.measure("WAfrGlobalAppFrame_TotalTransition_Failure_"+a,"WAfrGlobalAppFrame_doTransition_"+a,"WAfrGlobalAppFrame_doTransitionFailure_"+a),o(e)},p=setTimeout((function(){s(new Error("Timeout reaches for a transition !"))}),3e7),u=function(e){i._currentTransition&&(i.delegateFrame.unsubscribe("onAppReady."+a),i.delegateFrame.unsubscribe("onAppFail."+a),e.targetApp=t,i.delegateFrame.onTransitionSuccessful(e),i._currentTransition=!1,window.performance.mark("WAfrGlobalAppFrame_doTransitionSuccess_"+a),window.performance.measure("WAfrGlobalAppFrame_TotalTransition_"+a,"WAfrGlobalAppFrame_doTransition_"+a,"WAfrGlobalAppFrame_doTransitionSuccess_"+a),window.clearTimeout(p),n())},l=function(e){s(e),window.clearTimeout(p)},c="";e&&e.Widgets&&e.Widgets.instances&&Array.isArray(e.Widgets.instances)&&e.Widgets.instances.length>0?c=e.Widgets.instances[0].lang:console.error("cannot compute language"),r.all([i._loadAppIdCard(t,c),i._computeCurrentContainer(t).then((function(e){return e}))]).then((function(e){const n=e[0].concatenation||e[0],r=e[0].configuration,o=t.getId();n.appId=o;let p=r&&r.afrAppId?r.afrAppId:o;t.isA2X()&&t.isStandardApp()&&(p="WAfrA2XStandard_AP"),t.setAfrAppId(p),t.setAppConfig(n);var l=e[1];if(i.delegateFrame.subscribe("onAppReady."+a,u),i.delegateFrame.subscribe("onAppFail."+a,s),1==i._widgetcreation){return b(C,i.frameContext).execute(i,t)}return i._computeTransitionDecisionFrom(t,n,l).then((e=>(e.constructor!==h.TransitionDecision.ReuseContext&&l&&i.delegateFrame.publish("hideAfrLoader"),e.execute(i,t))))}),l).then((function(){}),l).catch(l)}))):r.reject(new Error("The target app "+t+" do not have a valid id"))},F.prototype._computeCurrentContainer=function(e){return this.delegateFrame.buildFrameContext().then(function(t){this.frameContext=t;var n=null,o=this.frameContext.getContainers();if(this._context&&"AppTester"==this._context)n=this.frameContext.getCurrentContainer();else if(1===o.length)this.frameContext.setCurrentContainerIndex(0);else if(o.length>1){var i=0,a=!1,s=!1;o.every(function(t){let r=t.getId();if("string"!=typeof r){let o=r.getView();if(o&&("maximized"===o.type||"fullscreen"===o.type)){if(s=!0,r&&r.id&&0===r.id.lastIndexOf("preview"))return a=!0,n=t,this.frameContext.setCurrentContainerIndex(i),!1;a||(n=t,this.frameContext.setCurrentContainerIndex(i))}if(!a&&!s&&r.elements&&r.elements.module&&r.elements.module.classList&&r.elements.module.classList.contains("ifwe-focused")&&(n=t,this.frameContext.setCurrentContainerIndex(i)),!a&&!s&&e.options&&e.options.widgetId&&e.options.widgetId===r.id)return n=t,this.frameContext.setCurrentContainerIndex(i),!1}return i++,!0}.bind(this))}if(n=n||this.frameContext.getCurrentContainer()){var p={appTitle:e.getTitle(),id:n.id&&n.id.id?n.id.id:""};this.delegateFrame.publish("displayAfrLoader",p)}return r.resolve(n)}.bind(this))},F.prototype._loadAppIdCard=function(e,t){var n=this._apps[e.getId()];return n?(e.setAppConfig(n),r.resolve(n)):this.delegateFrame.loadIdCard(e,t)},F.prototype._computeTransitionDecisionFrom=async function(e,t,n){let o=null;const i=n?n.getCurrentApp():null;if(n&&!i)return r.reject(new Error("Found a current container but no compatible app, reject the transition"));if(h.log("Compute Transition From "+(i?i.getId():"None App")+" to "+e.getId()),o=i?await this._computeTransitionDecisionBetween(i,e):await this._computeNonAmbiguousTransition(e),!o)throw new Error("No found transition decision !");return o},F.prototype._computeTransitionDecisionBetween=async function(e,t,n){var r=await this._computeTransitionTypeBetween(e,t,n);return r?b(r,this.frameContext):null},F.prototype._computeTransitionTypeBetween=async function(e,t,n){if(!t)return null;if(!e)return C;if(e.getId()===t.getId())return C;const r=t.getAppConfig(),o=e.getAppConfig(),i=!!o.stdConf&&!!o.stdConf.a2x,a=!!r.stdConf&&!!r.stdConf.a2x;if(i&&a){return await new Promise(((n,r)=>{this.delegateFrame.subscribe("onA2XTransitionDecision",(e=>n(e?A:C)));const o=this.frameContext;if(!o)return r(new Error("frameContext is not defined or is null."));{const n=o.getCurrentContainer();if(!n)return r(new Error("currentContainer is not defined or null"));{const r=function(e){let t;return e&&e.id&&(t="string"==typeof e.id?e.id:e.id.id?e.id.id:""),t}(n),o=t.getStartWb(),i=e.getStartWb();this.delegateFrame.publish("onA2XTransitionRequest."+r,{destinationWb:o,originWb:i})}}}))}const s=r.afrTransitionsFrom||{},p=o.afrTransitionsTo;let u;if(p){var l=p[t.getId()];if(void 0===l&&(u=t.getFamily(),u&&r.afrTransitionsToFamily&&(l=r.afrTransitionsToFamily[u])),void 0!==l&&!1===l)return h.warn("The app "+e+" refuse to transit to "+t),C}if(!s&&n)return null;if(!s)return C;var c=null;return u=e.getFamily(),c=s[e.getId()],u&&!c&&(c=r.afrTransitionsFromFamily[u]),c||n||(c=s._default_)?c||null:(h.log("There is no default transition so create a new container"),C)},F.prototype._computeNonAmbiguousTransition=async function(t){var n=t.getAppConfig().afrTransitionsFrom||{};if(!n)return x;var r=[],o=this;if(h.log("[AppFrame] Deduct transition to "+t.getAppConfig().appId),await this.frameContext.forEachContext((async function(n){if(n){var i=n.getCurrentApp();if(i){var a=await o._computeTransitionTypeBetween(i,t,!0),s=e.clone(a);h.log("[AppFrame] Transition From "+i.getId()+" -> "+JSON.stringify(s||{})),s&&(r.push(s),s.of=i.getId())}}})),r.length>1)throw h.warn("[AppFrame] Ambiguous transition"),new Error("To Many apps to decide the correct transition");var i=null;if(r.length>0)i=r[0];else if(!(i=n._default_))return h.log("There is no default transition so create a new container"),x;return b(i,this.frameContext)};var y=n.extend({init:function(e){this._frame=new F(e)},doTransition:function(e,t,n){return this._frame.doTransition(e,t,n)}});return h.Frame=y,h})),window.performance.mark("AFR_AppFrameGlobal_AppFrame3DD"),define("DS/AppFrameGlobal/AppFrame3DD",["UWA/Core","UWA/Class","UWA/Class/Promise","DS/AppFrameGlobal/AppFrame","DS/PlatformAPI/PlatformAPI"],(function(e,t,n,r,o){"use strict";var i=function(){};return r.inherit(i,r.DelegateFrame),i.prototype.getCurrentTabId=function(){window.performance.mark("AFR_AppFrameGlobal_AppFrame3DD_getCurrentTabId"),window.performance.measure("AppFrame3DD_getCurrentTabId","AFR_AppFrameGlobal_AppFrame3DD_getCurrentTabId"),r.log("AppFrame3DD::getCurrentTabId Enter");var t,n,o,i=void 0,a=(t=e.Widgets.instances||[]).length;for(r.log("AppFrame3DD::getCurrentTabId instance = "+a),n=0;n<a;n++)if(void 0!==(o=t[n]).data&&(r.log("AppFrame3DD::getCurrentTabId instance.data = "+JSON.stringify(o.data)),void 0!==o.data.module&&(r.log("AppFrame3DD::getCurrentTabId instance.data.module = "+JSON.stringify(o.data.module)),"DS/Dashboard/Layout/Dashboard"===o.data.module&&(r.log("AppFrame3DD::getCurrentTabId instance.data.module = DS/Dashboard/Layout/Dashboard = "),void 0!==o.layout&&void 0!==o.layout.selectedTab&&void 0!==o.layout.selectedTab.options)))){i=o.layout.selectedTab.options.id,r.log("AppFrame3DD::getCurrentTabId Id current Tab = "+o.layout.selectedTab.options.id);break}return r.log("AppFrame3DD::getCurrentTabId End oId = "+i),i},i.prototype.onTransitionSuccessful=function(){},i.prototype._createContainerFromWidget=function(e,t){const n=t&&t.appConfig?t.appConfig:null;var o=new r.FrameContext.Container({id:e}),i=n.afrExecutionContexts;if(i){for(var a=0;a<i.length;a++){var s=i[a],p=new r.App({id:n.appId,appConfig:n,appInfo:t.appInfo}),u=new r.FrameContext.ExecutionContext(s.id,p);o.addExecutionContext(u)}var l=n.afrCurrentExecutionContextIdx;r.log("[AppFrame3DD] Widget "+e+" -> "+JSON.stringify(i)),o.setCurrentContextIndex(Math.max(i.length-1,l))}return o},i.prototype.buildFrameContext=function(){r.log("AppFrame3DD::buildFrameContext Start");for(var t,o,i,a,s,p=new r.FrameContext,u=this.getCurrentTabId(),l=e.Widgets.instances||[],c=0;c<l.length;c++){var f=l[c];t=f._view||{},f.getValue("appId")&&(0===f.id.lastIndexOf("preview")&&"maximized"===t.type?a=f.id:"maximized"===t.type&&(s=f.id))}return l.forEach(function(e){if(t=e._view||{},e.getValue("appId")&&(a?i=e.id===a:s&&(i=e.id===s),e.context===u||i&&void 0===e.context)){r.log("AppFrame3DD::buildFrameContext add container (widget) = "+e);var n={appConfig:{appId:e.getValue("afrPrdId")||e.getValue("afrAppId")||e.getValue("appId"),afrAppId:e.getValue("afrAppId"),afrCode:e.getValue("afrCode"),afrCurrentExecutionContextIdx:e.getValue("afrCurrentExecutionContextIdx"),afrExecutionContexts:e.getValue("afrExecutionContexts"),afrFamily:e.getValue("afrFamily"),afrTransitionsFrom:e.getValue("afrTransitionsFrom"),afrTransitionsFromFamily:e.getValue("afrTransitionsFromFamily"),afrTransitionsTo:e.getValue("afrTransitionsTo"),afrVersion:e.getValue("afrVersion"),stdConf:e.getValue("afrStdConf")}};e.getValue("afrStdConf")&&e.getValue("afrStdConf").a2x&&(n.appInfo={nativeInformation:e.getValue("nativeInformation"),defaultPage:e.getValue("defaultPage"),type:"A2x"}),o=this._createContainerFromWidget(e,n),p.addContainer(o),!p.getCurrentContainer()&&i&&p.setCurrentContainerIndex(p.containers.length-1)}}.bind(this)),r.log("AppFrame3DD::buildFrameContext End"),n.resolve(p)},i.prototype.createContainer=function(){return r.log("AppFrame3DD:createContainer"),n.reject()},i.prototype.publish=function(e,t){o.publish(e,t)},i.prototype.subscribe=function(e,t){o.subscribe(e,t)},i.prototype.unsubscribe=function(e){o.unsubscribe(e)},r.Frame.singleton({init:function(){this._parent(new i)},loadAppInfoAndDoTransition:function(e){window.performance.mark("AFR_AppFrameGlobal_AppFrame3DD_loadAppInfoAndDoTransition"),window.performance.measure("AppFrame3DD_loadAppInfoAndDoTransition","AFR_AppFrameGlobal_AppFrame3DD_loadAppInfoAndDoTransition"),r.log("ApplicationFrame:loadAppInfoAndDoTransition = "+JSON.stringify(e));const t={url:e.launchInfos,id:e.id,title:e.title,configUrl:e.config,brand:e.brand,widgetId:e.widgetId};if(e&&e.type&&"a2x"===e.type.toLowerCase()){const n={};n.nativeInformation={workbench:e.workbench},n.type=e.type,n.defaultPage=e.defaultPage,t.appInfo=n}var n=new r.App(t);e.targetApp=n,r.log("ApplicationFrame:loadAppInfoAndDoTransition targetApp = "+JSON.stringify(n)),this.doTransition(e.targetApp).then(e.success,e.failure),r.log("ApplicationFrame:loadAppInfoAndDoTransition End doTransition")}})}));