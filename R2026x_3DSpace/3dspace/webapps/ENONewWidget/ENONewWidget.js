define("DS/ENONewWidget/ENONew/Controller/ENONewController",["UWA/Controls/Abstract","DS/ENONewWidget/ENONew/Controller/ENONewDialogController","DS/ENONewWidget/ENONew/Controller/CredentialsManager","DS/ENONewWidget/ENONew/Model/ENONewModel","DS/ENONewWidget/ENONew/Events","DS/Controls/Button","DS/ENONewWidget/ajaxRequests/ENONewServices","DS/ENONewWidget/utils/Notification","DS/ENOBusinessRuleClient/Services","DS/ENOCollabToolsUI/tracker/ENOCollabTracker","DS/EditPropWidget/utils/EditPropUtils","DS/ENONewWidget/utils/ENONewConstants","i18n!DS/ENONewWidget/assets/nls/ENONewWidgetNls"],(function(e,t,i,n,a,o,r,s,l,c,d,u,p){return e.extend({skeleton:null,defaultAttributes:{},init:function(e,t){console.debug("ENONew Controller init");this.AppPrefInfo={},this.createOptsModel=t,this.id=e.id,this.appName=e.appName,this.context=e.context,this.labelTopBar=e.labelTopBar,this.commandName=e.commandName,this.overlay=e.overlay,this.responseFormat=e.responseFormat,this.facets=e.facets,this.viewType=e.viewType,this.activatelock=e.activatelock,this.activateDraftMode=e.activateDraftMode,this.activateCreateAnother=e.activateCreateAnother,this.showCreateAnother=e.showCreateAnother,this.leadingappspecific=e.leadingappspecific,this._parent(e),this.model=new n(e),this.objInfo={type:e.type,options:e.options,events:e.events},this.silentMode=e.silentMode,this.notification=e.notification,this.Services=new r(e.context,{parsedResult:e.parsed},t),this.credentialsManager=new i({model:this.model},t),this.buttons={};var a=this.objInfo.events;for(eventID in a){var o=a[eventID];this.addEvent(eventID,o)}this.silentMode?this.silentCreation():this._setup()},getUI:function(e){var i=this;return new UWA.Promise((function(e){i.dialog||(i.dialog=new t({},i.createOptsModel)),e(i.dialog)}))},_setup:async function(){var e=this,t=e.getUI(),i=this.credentialsManager.getCredentialsAttribute(this.objInfo.type),n=await this.credentialsManager.getValidPreferredCredential(this.objInfo.type),a={type:this.objInfo.type,preferedType:this.objInfo.options.preferedType,securityContext:n,subTypes:!this.createOptsModel||this.createOptsModel.get("showSubtype")},o=e._getTypeInfo(a);let r=d.getDimensions();i.then((i=>{console.debug("ENONew: Promise complete Credentials"),e.defaultAttributes={},i&&i.project?(e.defaultAttributes[u.ATTR_PROJECT]=i.project,i.organisation&&(e.defaultAttributes[u.ATTR_ORGANISATION]=i.organisation),i.role&&(e.defaultAttributes[u.ATTR_ROLE]=i.role)):(console.log("ENONew: user does not have create access"),e.noCreateAccess=!0),UWA.Promise.all([o,t]).then((function(t){if(console.debug("ENONew: Promise complete typeInfo, dialogController"),e.postFetchAttributes(t[0],"launch"),e.currentType=t[0].type,e.defaultAttributes.Type=t[0].Type,e.attributes=t[0].attributes,e.interfaces=t[0].interfaces,e.isUXBLDeployed=t[0].isUXModifyDeployed,e.basicAttributes=t[0].basicAttributes,t[0].reInitOnSecCtxChange&&e.model.addEvent("onChange:securityContext",(t=>{console.debug("ENONew: onChangeSecurityContext");var i=e.model.getSecurityContext();e.onChangeSecurityContext(i)})),t[0].prefs&&(e.prefs=t[0].prefs),e._checkIfDimensionAttributeAvailabeOnAttrModels(e.attributes))r.then((function(){e.displayDialog();var t={UXName:"New",UXSub:"Generic",numberObjects:1,actionStatus:c.success,pd16:e.options.options.typeName};e._createAndSendAnalyticsEvent(!0,t)})).catch((function(t){e.handleError(t),e.dispatchEvent("onFailure",[t]),e.destroyComponent();var i={UXName:"New",UXSub:"Generic",numberObjects:1,actionStatus:c.failure,pd16:e.options.options.typeName};e._createAndSendAnalyticsEvent(!0,i)}));else{e.displayDialog();var i={UXName:"New",UXSub:"Generic",numberObjects:1,actionStatus:c.success,pd16:e.options.options.typeName};e._createAndSendAnalyticsEvent(!0,i)}})).catch((function(t){e.handleError(t),e.dispatchEvent("onFailure",[t]),e.destroyComponent();var i={UXName:"New",UXSub:"Generic",numberObjects:1,actionStatus:c.failure,pd16:e.options.options.typeName};e._createAndSendAnalyticsEvent(!0,i)}))})).catch((t=>{e.handleError(t),e.dispatchEvent("onFailure",[t]),e.destroyComponent();var i={UXName:"New",UXSub:"Generic",numberObjects:1,actionStatus:c.failure,pd16:e.options.options.typeName};e._createAndSendAnalyticsEvent(!0,i)}))},silentCreation:function(){var e=this,t={type:this.objInfo.type,subTypes:!1},i=e._getTypeInfo(t,!0);UWA.Promise.all([i]).then((function(t){var i=t[0],n=t[0],a={eventID:"createClose",securityContext:i};e._create(n,a)})).catch((function(t){e.handleError(t),e.dispatchEvent("onFailure",[t]),e.destroyComponent()}))},displayDialog:function(){var e=this,t={defaultAttributes:this.defaultAttributes,attributes:this.attributes,interfaces:this.interfaces,prefs:this.prefs,isUXBLDeployed:this.isUXBLDeployed,basicAttributes:this.basicAttributes,model:this.model};this.context&&(this.context.service&&(t.service=this.context.service),this.context.tenant&&(t.tenant=this.context.tenant));var i={overlay:this.overlay,activatelock:this.activatelock,activateDraftMode:this.activateDraftMode,showCreateAnother:this.showCreateAnother,activateCreateAnother:this.activateCreateAnother,title:this.labelTopBar?this.labelTopBar:p.get("new")+" "+e.getCurrentTypeNLS(),persistId:"ENONew_"+(this.id?this.id:this.buildID()),facets:this.facets,viewType:this.viewType};this.noCreateAccess&&(i.noCreateAccess=!0),i.securityContext=e.model.getSecurityContext(),i.tenant=e.model.getTenant();var n={onChangeAttribute:function(t,i){console.debug("ENONew: onChangeAttribute ",t),e._onChangeAttribute(t,i)},runBLForUI:function(t,i){e.runBLForUI(t,i)},onClose:function(){if(e.createdObject&&e.createdObject.result)if("success"===e.createdObject.result.status){var t=e.createdObject.result,i=e.dialog.getFacetData();i&&(t.facetData=i),e.handleFacetErrors(t),e.dispatchEvent("onSuccess",[t])}else"error"===e.createdObject.result.status&&e.dispatchEvent("onFailure",[e.createdObject.result]);e.destroyComponent()},onCreateBtnClick:function(t,i,n){"save"===i.eventID||"saveClose"===i.eventID?e.onCompleteCreate(i):e.onSubmit(t,i,n)}};this.dialog.setup(t,i,this.buttons,n)},refreshDialog:function(){var e={defaultAttributes:this.defaultAttributes,attributes:this.attributes,interfaces:this.interfaces,isUXBLDeployed:this.isUXBLDeployed,basicAttributes:this.basicAttributes};this.dialog.reloadContent(e)},reloadDialog:function(e){var t=this,i={preferedType:e};this._getTypeInfo(i).then((async function(e){var i=await t.credentialsManager.getCredentialsAttribute(e.type);i&&i.project&&(t.defaultAttributes[u.ATTR_PROJECT]=i.project,i.organisation&&(t.defaultAttributes[u.ATTR_ORGANISATION]=i.organisation),i.role&&(t.defaultAttributes[u.ATTR_ROLE]=i.role)),t.currentType=e.type,t.attributes=e.attributes,t.interfaces=e.interfaces,t.isUXBLDeployed=e.isUXModifyDeployed,t.basicAttributes=e.basicAttributes,t.refreshDialog()})).catch((function(e){t.handleError(e),t.dispatchEvent("onFailure",[e]),t.destroyComponent()}))},onSubmit:function(e,t,i){this.defaultAttributes=e.defaultAttributes;let n=e.defaultAttributes.Type;if(n){e.type=n.value;var a=n.persistData;if(a){var o=a.find((e=>e.name===n.value));o&&(e.subTypes=[o])}}t.securityContext=this.model.getSecurityContext(),delete e.defaultAttributes,this._create(e,t,i)},_getTypeInfo:function(e,t){this.createdObject=null;var i=e.type?e.type:this.objInfo.type,n=e.preferedType?e.preferedType:this.objInfo.options.preferedType,a=!!e.subTypes&&e.subTypes,o=e.securityContext?e.securityContext:this.model.getSecurityContext(),r={type:i,preferedType:n,typeName:this.objInfo.options.typeName,parentOrigin:this.objInfo.options.parentOrigin,domainAttributes:this.objInfo.options.domainAttributes,subTypes:a,activatelock:!(!this.activatelock||!this.activatelock.show)||void 0,activateDraftMode:!(!this.activateDraftMode||!this.activateDraftMode.show)||void 0,initAttributes:this.objInfo.options.attributes?this.objInfo.options.attributes:void 0,runUXBL:!0};return this.model.get("context")&&this.model.get("context").isAdminUser&&(r.isAdmin=!0),UWA.is(this.appName)&&(r.appName=this.appName),UWA.is(this.leadingappspecific)&&(r.leadingappspecific=this.leadingappspecific),this.objInfo.options.preferedType=n||i,this.Services.getTypeInfo1(r,o,t)},_onChangeAttribute:function(e,t){var i=this;if(e)for(var n in console.log(e),e)if("New-Type"===n){var a=e[n].valueDB,o={preferedType:a};this.dialog.disableFormInput(),i._getTypeInfo(o).then((async function(e){var t=await i.credentialsManager.getCredentialsAttribute(e.type);t&&t.project&&(i.defaultAttributes[u.ATTR_PROJECT]=t.project,t.organisation&&(i.defaultAttributes[u.ATTR_ORGANISATION]=t.organisation),t.role&&(i.defaultAttributes[u.ATTR_ROLE]=t.role)),i.defaultAttributes.Type.value=a,i.currentType=a,i.attributes=e.attributes,i.interfaces=e.interfaces,i.isUXBLDeployed=e.isUXModifyDeployed,i.basicAttributes=e.basicAttributes,i.postFetchAttributes(e,"onChangeType"),i.refreshDialog()})).catch((function(e){i.dispatchEvent("onFailure",[e]),i.destroyComponent()}))}else if("3DPartTemplate"===n){var r=e[n],s=r.valueDB,l=r.authorizedValues.includes(s);i.PartTemplate3D=l?s:""}else if("New-project"===n){var c=e[n].valueDB;i.credentialsManager.setCurrentProject(c);let t=i.credentialsManager.updateOrgAttribute(c),a=i.credentialsManager.updateRoleAttribute(c,t.value);(p={attribute:{}}).attribute[u.ATTR_ORGANISATION]=t,p.attribute[u.ATTR_ROLE]=a,i.dialog.updateForm(p)}else if("New-organisation"==n){var d=e[n].valueDB;i.credentialsManager.setCurrentOrg(d),i.defaultAttributes.organisation.value=d;let t=i.credentialsManager.updateRoleAttribute(i.credentialsManager.getCurrentProject(),d);var p;(p={attribute:{}}).attribute[u.ATTR_ROLE]=t,i.dialog.updateForm(p)}else if("New-role"==n){var f=e[n].valueDB;i.credentialsManager.setCurrentRole(f),i.defaultAttributes.role.value=f}},onChangeSecurityContext(e){var t=this;this.dialog.disableFormInput(),t._getTypeInfo({securityContext:e}).then((async function(i){t.model.setSecurityContext(e);var n=await t.credentialsManager.getCredentialsAttribute(i.type);n&&n.project&&(t.defaultAttributes[u.ATTR_PROJECT]=n.project,n.organisation&&(t.defaultAttributes[u.ATTR_ORGANISATION]=n.organisation),n.role&&(t.defaultAttributes[u.ATTR_ROLE]=n.role)),t.attributes=i.attributes,t.interfaces=i.interfaces,t.isUXBLDeployed=i.isUXModifyDeployed,t.basicAttributes=i.basicAttributes,t.postFetchAttributes(i,"onChangeSecurityContext"),t.refreshDialog()})).catch((function(e){t.dispatchEvent("onFailure",[e]),t.destroyComponent()}))},runBLForUI:function(e,t){console.log("ENONew: runBLForUI triggered");var i=this.objInfo.type;this.objInfo.options&&this.objInfo.options.preferedType&&(i=this.objInfo.options.preferedType);var n={objectList:[{type:i}],attributes:e.attribute,interfaces:e.interfaces,modifiedAttribute:e.modifiedAttributes};this.clientBLService||(this.clientBLService=new l({tenant:this.model.getTenant(),header:{SecurityContext:this.model.getSecurityContext()}})),this.clientBLService.runBusinessRuleForUI(2,[n],(function(e){t(e)}),(function(){t(),console.log("ENONew: runBLForUI error")}),(function(){t({error:"timeout"})}))},_create:function(e,t,i){var n=this;if(e){t=t||{};var a={};UWA.is(this.appName)&&(a.appName=this.appName),UWA.is(this.leadingappspecific)&&(a.leadingappspecific=this.leadingappspecific),a.typeName=this.objInfo.options.typeName,a.aggregating_context=this.objInfo.options.parentPIDs,a.select=this.objInfo.options.select,a.folderID=this.objInfo.options.folderID,this.objInfo.options.selectedIDs&&(a.selectedIDs=this.objInfo.options.selectedIDs),a.activeFolder=this.objInfo.options.activeFolder;var o={queryParams:a,securityContext:t.securityContext};i&&(e.prefs={},i.footerCreateBtnState&&(e.prefs.createOption=i.footerCreateBtnState),i.toolbarIsLockEnabled&&(e.prefs.lockOption=i.toolbarIsLockEnabled),n.activateDraftMode.preference=i.footerCreateBtnState,n.activatelock.preference=i.toolbarIsLockEnabled),n.Services.createContent(e,o,(function(e,i){n.createdObject={result:e,source:i},n.savePreferredValue(),n.onCompleteCreate(t)}),(function(t){n.dialog.resetButtonLabel(),n.dialog.disableFormInput(!1,!1,!0),n.handleError(t);var i={typeObjects:e.type,actionStatus:c.failure,pd16:n.options.options.typeName};n._createAndSendAnalyticsEvent(!1,i)}))}},onCompleteCreate(e){var t=this,i=t.createdObject&&t.createdObject.result?t.createdObject.result:{};i&&"success"===i.status?t.onSuccessOfCreation(i,t.createdObject?t.createdObject.source:"",(function(){e.eventID.contains("Close")?t.destroyComponent():t.reloadDialog(t.currentType);var i={typeObjects:t.currentType,numberObjects:1,actionStatus:c.success,pd16:t.options.options.typeName};t._createAndSendAnalyticsEvent(!1,i)})):(t.dialog.resetButtonLabel(),t.dialog.disableFormInput(!1,!1,!0),t.handleError(i))},onSuccessOfCreation:function(e,t,i){var n=this;if("success"===e.status){if(n.responseFormat){if(2==n.responseFormat&&(e.parsedResult=JSON.parse(e.parsedResult),"FAILURE"!==e.parsedResult.result&&(e.parsedResult.rawAttr=JSON.parse(e.parsedResult.rawAttr),e.parsedResult.instances))){var a=e.parsedResult.instances;for(var o in a){var r=a[o];r.hasOwnProperty("to[CAD SubComponent].physicalid")?(r.relationphysicalid=r["to[CAD SubComponent].physicalid"],delete r["to[CAD SubComponent].physicalid"]):r.hasOwnProperty("to[VPMInstance].physicalid")&&(r.relationphysicalid=r["to[VPMInstance].physicalid"],delete r["to[VPMInstance].physicalid"]),r.hasOwnProperty("instanceName")&&(r.relationname=r.instanceName,delete r.instanceName)}}}else{var s=e.result,l=[];for(var c in s){var d=s[c],u={identifier:d.identifier?d.identifier:d.physicalid,source:t,type:d.type};d.relations&&(u.relations=d.relations),l.push(u)}e.result=l}n.dialog?n.dialog.completeFacetTasks(e,(function(t){t&&(e.facetData=t),n.dispatchEvent("onSuccess",[e]),i()})):(n.dispatchEvent("onSuccess",[e]),i())}},handleError:function(e){var t=e.result;if(void 0!==t&&this.notification)for(var i in t){var n=t[i];if(n.errors)for(ind1 in n.errors){var a=n.errors[ind1];this.setNotification("error",a)}}},handleFacetErrors:function(e){var t=!1,i=e.facetData;if(i){var n,a={errorCode:"ENONEW_ERROR_8001"};if(Object.keys(i).forEach((function(e){var t=i[e],a=t.info;if(a&&a.errors&&a.errors.length>0){var o=a.errors[0];"ENONEW_FACETS_POSTCREATION"===o.errorCode&&o.errorMessages&&(n||(n=[]),n.push(t.facetNLS+" : "+o.errorMessages[0]))}})),n){t=!0,a.errorMessages=n;var o="error";"success"===e.status&&(o="warning"),this.setNotification(o,a)}}return t},getCurrentTypeNLS:function(){var e=this,t="";if(e.commandName)t=e.commandName;else if(e.defaultAttributes.Type){var i=e.defaultAttributes.Type.value,n=e.defaultAttributes.Type.range,a=e.defaultAttributes.Type.rangeNLS,o=n.indexOf(i);o>=0&&o<a.length&&(t=a[o])}return t},setNotification:function(e,t){var i=this,n=t.errorCode,a=t.errorTitle?t.errorTitle:p.get(n+"_Title",{type:i.getCurrentTypeNLS()}),o=t.errorSubtitle?t.errorSubtitle:p[n+"_Subtitle"],r="";if(t.errorMessages&&0!=t.errorMessages.length)for(var s in t.errorMessages){r&&(r+="<br>"),r+=t.errorMessages[s]}else r=p[n+"_Msg"];"ENONEW_ERROR_5001"!==n&&"InvalidAccess"!==n||t.errorTitle||(a=p.cantCreateObject+": "+i.getCurrentTypeNLS()),"ENONEW_ERROR_0003"!==n&&"ENONEW_ERROR_1003"!==n&&"ENONEW_ERROR_1002"!==n||(a=p.ObjCreationFailed),"ENONEW_ERROR_4005"!==n&&"ENONEW_ERROR_0002"!==n||(a+=": "+i.getCurrentTypeNLS()),"ENONEW_ERROR_0007"===n&&(a+=this.commandName?": "+this.commandName:"."),"ENONEW_ERROR_1004"===n&&(a=p.cantCreateObject1+": "+i.getCurrentTypeNLS(),o=p.contactYourAdmin),"ENONEW_ERROR_8001"===n&&(a=p.get(n+"_Title",{type:i.getCurrentTypeNLS()})),a||"error"!==e||(a=a=p.ObjCreationFailed);var l={level:e,title:a,subtitle:o,message:r};"NoCreateCredential"===n&&(l.webHelp="EXP3DBasicsUserMap/base-m-access-roles-sb.htm"),this._setNotification(l)},_setNotification:function(e){s.display(e)},update:function(e){this.dialogView.updateView(e)},destroyComponent:function(){var e=this.AppPrefInfo?this.AppPrefInfo:{};e.newType=this.objInfo.options.typeName,this.dispatchEvent("onCancel",[e]),a.dispatchEvent("onNewInfraExit",[e]),this.dialog&&this.dialog.destroy(),this.destroy()},savePreferredValue(){var e={preferedType:this.currentType,preferedCredential:this.model.getSecurityContext()};UWA.is(this.activatelock.preference)&&(e.lockStatus=this.activatelock.preference),UWA.is(this.activateDraftMode.preference)&&(e.draftStatus=this.activateDraftMode.preference),UWA.is(this.showCreateAnother)&&(e.activateCreateAnother=this.dialog&&this.dialog.myDialog&&this.dialog.myDialog.checkboxInfos&&this.dialog.myDialog.checkboxInfos.checkFlag),this.AppPrefInfo=e},_createAndSendAnalyticsEvent:function(e,t){var i=this;this.dialog&&this.dialog.View&&this.dialog.View.idCardSkeleton&&(i=this.dialog.View.idCardSkeleton,UWA.is(this.dialog.View.idCardSkeleton.currentFacetName)&&(t.pd18=this.dialog.View.idCardSkeleton.currentFacetName)),i.lastTrackerEvent=e?c.createInitActionEvent(t):c.createValidationEventFromEvent(t,i.lastTrackerEvent),c.checkAndTrackPageEvent(i.lastTrackerEvent)},_raiseNotif:function(e,t){this.dispatchEvent("onNotification",{msg:e,eventID:t})},getSaveBtn:function(){var e=this,t=new o({label:p.saveBtn,onClick:function(i){if(!e.dialog.onEscKeyDown){var n=e.objInfo.options.preferedType;n&&""!=n&&null!=n&&null!=n||(n=e.objInfo.type);var a=n;if(n){var o=e.defaultAttributes.Type.range,r=e.defaultAttributes.Type.rangeNLS,s=o.indexOf(n);s>=0&&s<r.length&&(a=r[s])}a&&require(["DS/UIKIT/SuperModal"],(function(i){new i({closable:!0,animate:!1,overlay:!0}).confirm({title:p.saveSettingsTitle,message:p.get("confirmsaveSettingsMsg",{type:a}),callback:function(i){if(t.label=p.saveBtnLoading,i){var o=e.PartTemplate3D;if(o){var r={type:n,UUID:o},s={securityContext:e.model.getSecurityContext()};e.Services.set3DPartTemplate(r,s,(function(t){e.dialog._addNotif({msg:p.get("confirmsaveSuccessMsg",{type:a}),eventID:"success"})}),(function(t){e.dialog._addNotif({msg:p.get("confirmsaveErrorMsg",{type:a}),eventID:"error"})}))}else e.dialog._addNotif({msg:p.get("confirmsaveErrorMsg",{type:a}),eventID:"error"})}t.label=p.saveBtn}})}))}}});return t},postFetchAttributes:function(e,t){if(e&&e.attributes.volatileAttributes){var i=e.attributes.volatileAttributes;for(var n in i){var a=i[n];if("3DPartTemplate"===a.name&&(this.PartTemplate3D=a.value,"launch"===t)){var o=this.getSaveBtn();o.visibleFlag=!1,this.buttons.Close=o}}}},buildID:function(){var e="ID_";return this.objInfo.options.typeName&&(e+=this.objInfo.options.typeName),this.objInfo.type&&(e+=this.objInfo.type),this.Services&&(e+=this.Services.tenant),e.replace(/ /g,"_")},_checkIfDimensionAttributeAvailabeOnAttrModels:function(e){let t=Object.keys(e);for(let i=0;i<t.length;i++){return!!e[t[i]].find((e=>e.hasOwnProperty("dimensionType")&&!e.hasOwnProperty("range")))}return!1}})})),define("DS/ENONewWidget/ENONew/View/Facet/ENONewFacetBase",["DS/EditPropWidget/facets/Common/FacetsBase"],(function(e){return e.extend({init:function(e,t){this.sharedOptions=t,this.facetValidation=!0,this._parent(e)},updateFacet:function(){console.log("ENONew: ENONewFacetBase updateFacet() "+(this.options?this.options.tabId:""))},setFacetValidation:function(e){this.facetValidation=e,this.getOccurrence().setValidation(this.options.tabId,e)},getFacetvalidation:function(){return this.facetValidation},publishInfo:function(e,t){e&&t&&this.getOccurrence().addInfo(this.options.tabId,e,t)},fetchInfo:function(e,t){if(e)return this.getOccurrence().getInfo(e,t)},listenToPublishedInfo:function(e,t){var i=this;setTimeout((()=>{i.getOccurrence().subscribeInfo(e,t)}))},postCreation:function(e){var t=this;return console.log("ENONew: postCreation default ",this.options?this.options.tabId:""),new UWA.Promise((function(e){e({name:t.options.tabId})}))},destroy:function(){this._parent()}})})),define("DS/ENONewWidget/utils/ENONewConstants",[],(function(){"use strict";return{ATTRIBUTES:"attributes",INTERFACES:"interfaces",PUBLIC_ATTRIBUTES:"publicAttributes",EXTN_ATTRIBUTES:"extensionAttributes",VOLATILE_ATTRIBUTES:"volatileAttributes",ATTR_PROJECT:"project",ATTR_ORGANISATION:"organisation",ATTR_ROLE:"role",TYPES:{INTEGER:"integer",REAL:"real",TIMESTAMP:"timestamp",PERSON:"person",BOOLEAN:"boolean",ENUM:"enum"},DIALOG:{TAB_VIEW:"tabView",WIZARD_VIEW:"wizardView",LIST_VIEW:"listView"},DOMAIN_ATTRIBUTES:"domainAttributes"}})),define("DS/ENONewWidget/command/NewContentDialog",["UWA/Class","DS/Windows/ImmersiveFrame","DS/Windows/Panel","DS/Controls/Expander","DS/Controls/Button","DS/Controls/LineEditor","i18n!DS/ENONewWidget/assets/nls/ENONewWidgetNls","css!DS/ENONewWidget/ENONewWidget.css"],(function(e,t,i,n,a,o,r){var s,l=r.newContentLabel;return e.extend({init:function(e){console.debug("ENONew: NewContentDialog init"),s=new t({identifier:"ENONew_NewContentDialog_Frame"}),this.debugMode=e.debugMode,this.lastUsedType=[]},injectImmersiveFrame(e){e||(e=new UWA.Element("div")).inject(widget.body),s.inject(e)},display(e,t,i){var n,a=this,o=new UWA.Element("div");if(o.inject(widget.body),s.inject(o),e){var l=0;Object.keys(e).forEach((function(t){e[t]&&(l+=e[t].length)})),console.debug("noOfTypesToList: "+l)}if(e&&0!=l){var c={label:r.get("Type"),UIType:"Expander",items:[],expanded:!0};if(this.debugMode&&a.recoverLastUsedTypes(c),e){var d={};for(var u in e){var p=e[u];p&&p.length>0&&p.forEach((function(e){if(e){var i={UIType:"Command",label:e.nls,icon:t.iconBaseURL?t.iconBaseURL+e.icon:e.icon,newType:u,objType:e.name},n=e.package,a=d[n];a||(a={UIType:"Expander",label:n,items:[],expanded:!0},d[n]=a,c.items.push(a)),a.items.push(i)}}))}}for(var f in d)d[f];n=this.displayDialog([c],t,(function(e){var t=e.dsModel.value;a.saveLastUsedType(t),t&&i({type:t.objType,newType:t.newType,commandName:t.label})}))}else n=this.buildInputTypeField(t,i);return n},saveLastUsedType(e){if(e){this.lastUsedType.find((t=>!(t.objType&&t.objType!==e.objType||t.newType&&t.newType!==e.newType)))||(this.lastUsedType.push(e),this.lastUsedType.length>5&&this.lastUsedType.shift())}},recoverLastUsedTypes(e,t){this.lastUsedType.length>0&&e.items.push({label:r.get("Recently Used"),UIType:"Expander",icon:"navigation-history wux-ui-3ds",items:this.lastUsedType.reduce(((e,t)=>(e.push({UIType:"Command",label:t.label,icon:t.icon,newType:t.newType,objType:t.objType}),e)),[]),expanded:!0})},displayDialog:function(e,t,o){var r=new UWA.Element("div");function c(e,t){var i=new UWA.Element("div",{class:"expander_container grid-cell-expander"}),a=e.label?e.label:"",o=!!e.expanded&&e.expanded,r=new UWA.Element("div",{class:"expander_content grid-container-content "+(UWA.is(t,"string")?t:"")}),s=e.items;d(s).inject(r);var l=new n({header:a,body:r,style:"simple",icon:e.icon,expandedFlag:o});return l.inject(i),l}r.inject(widget.body);var d=function(e){var t,i,n,r,s,l;if(e)for(var d in t=new UWA.Element("div",{class:"commands"}),e){var u,p=e[d];"Expander"===p.UIType||"PackageExpander"===p.UIType?u=c(p,p.UIType):"Command"===p.UIType?(i=p,n=void 0,r=void 0,s=void 0,l=void 0,n=new UWA.Element("div",{class:"command_content grid-cell-btn"}),r=i.label?i.label:"",s=i.icon?i.icon:"",(l=i.launcherOptions?i.launcherOptions:"")||(l=i),new a({value:l,label:r,icon:s,displayStyle:"lite",onClick:o,styles:{display:"block",width:"fit-content"}}).inject(n),u=n):console.error("ENONew: Incomplete data",p),u&&u.inject(t)}else console.error("ENONew : No data");return t},u=new UWA.Element("div",{class:"New-content content"});this.buildSearchComponent({},u).inject(u),d(e).inject(u);var p,f,h=t.labelTopBar?t.labelTopBar:l;t.dimension&&(p=void 0!==t.dimension.height?t.dimension.height:-1,f=void 0!==t.dimension.width?t.dimension.width:-1);var m=void 0===t.resizable||t.resizable,v=new i({allowedDockAreas:WUXDockAreaEnum.NoneDockArea,immersiveFrame:s,title:h,content:u,height:p,width:f,resizableFlag:m,position:{my:"center",at:"center",of:s},identifier:"ENONew_NewContentDialog_Dialog"});return s.inject(r),v},buildDialog:function(e){var t,n,a=e.identifier?e.identifier:"ENONew_NewContentDialog",o=e.labelTopBar?e.labelTopBar:l;e.dimension&&(t=void 0!==e.dimension.height?e.dimension.height:-1,n=void 0!==e.dimension.width?e.dimension.width:-1);var r=void 0===e.resizable||e.resizable,c=e.content?e.content:void 0;return new i({identifier:a,allowedDockAreas:WUXDockAreaEnum.NoneDockArea,immersiveFrame:s,title:o,content:c,height:t,width:n,resizableFlag:r,position:{my:"center",at:"center",of:s}})},buildSearchComponent(e,t){var i=this,n=new UWA.Element("div",{class:"searchBox"});return this.findContent=new o({id:"NewContentSearch",placeholder:r.get("placeholder_search"),displayClearFieldButtonFlag:!0,icon:"search wux-ui-3ds"}).inject(n),this.findContent.addEventListener("uncommittedChange",(function(){var e=i.findContent.valueToCommit;if(console.log("search for ",e),""!==e){let i=e.escapeRegExp();var n=new RegExp(i,"gi");t.getElements(".expander_content .wux-controls-expander-container").forEach((t=>{var i=t.getElements(".command_content.grid-cell-btn .wux-controls-abstract.wux-controls-button"),a=!1;i.forEach((t=>{if(t&&t.dsModel){var i=t.dsModel;if(i){var o=!1;""!==e&&i.label.search(n)>-1&&(o=!0),o?(i.elements.text.innerHTML=t.getText().replaceAll(n,"<mark class='wux-ui-currentHighlight'>$&</mark>"),i.show(),a=!0):i.hide()}}})),a?t.show():t.hide()}))}else{t.getElements(".expander_content .wux-controls-expander-container").forEach((e=>{e.getElements(".command_content.grid-cell-btn .wux-controls-abstract.wux-controls-button").forEach((e=>{if(e&&e.dsModel){var t=e.dsModel;if(t)t.elements.text.getElements("mark").forEach((e=>{e.outerHTML=e.innerHTML})),t.show()}})),e.show()}))}})),n},buildInputTypeField(e,t){var i=this,n=new UWA.Element("div",{class:"command_content_vma12 input_type"}),r=new UWA.Element("div",{class:"lineContainer input_type"});r.inject(n),new UWA.Element("span",{text:"Dictionary Type"}).inject(r);var s=new o({placeholder:"Enter a value",value:i.lineEditorValue?i.lineEditorValue:"VPMReference"});s.inject(r),s.addEventListener("change",(function(e){i.lineEditorValue=e.dsModel.value}));var l=new UWA.Element("div",{class:"lineContainer help"}).inject(n);new UWA.Element("span",{class:"labelHelp",text:"(Dictionary Type is name of Type as in DB)"}).inject(l);var c=new UWA.Element("div",{class:"lineContainer button_create"});c.inject(n);var d=function(){t({type:s.value,newType:"Default"})},u=(new a({value:"Create",label:"Create",onClick:d,emphasize:"primary",styles:{display:"block",width:"fit-content"}}).inject(c),this.buildDialog({content:n}));return u.addEventListener("keydown",(function(e){13==e.keyCode&&d()})),u},destroyDialog:function(){s.destroyAllWindows()}})})),define("DS/ENONewWidget/utils/Notification",["UWA/Core","DS/WebappsUtils/Console","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen"],(function(e,t,i,n){"use strict";var a={notificationsManager:null,display:function(e){null===a.notificationsManager&&(a.notificationsManager=i,n.setNotificationManager(a.notificationsManager),n.setStackingPolicy(9));var t={level:e.level,title:e.title,subtitle:e.subtitle,message:e.message?e.message:"",sticky:"error"===e.level,helpResources:{WebHelp:e.webHelp?e.webHelp:""}};a.notificationsManager.addNotif(t)}};return a})),define("DS/ENONewWidget/command/NewContentOptions",["UWA/Class"],(function(e){return e.extend({init(){this.prefType},getNewTypeList:function(){return{typeList:[],showSubtype:!1}},getCreateOptions:function(e){return this.launcherOptions||(this.launcherOptions={type:e.type,context:{service:"3DSpace"},silentMode:!1,notification:!0,options:{typeName:e.newType,parentPIDs:[],selectedIDs:[],domainAttributes:[]},events:{onSuccess:function(e){console.log("Creation Successful",e)},onFailure:function(e){console.log("Creation Error",e)},onCancel:function(e){console.log("Creation dialog closed",e)}}}),this.launcherOptions},getLoginContext:()=>({header:{SecurityContext:""},tenant:"",service:"",serviceBaseUrl:""})})})),define("DS/ENONewWidget/command/NewContentCmdMap",["UWA/Class"],(function(e){var t={MockDocument:{cmdRequire:"DS/ENOCollabSharingCmds/commands/Sample/ENONewMockDocumentCmd"},PhysicalProductCBDAssembly:{cmdRequire:"DS/ENOCollabSharingCmds/commands/ENONew/NewECcompCBDAssembly"},PhysicalProductCBDBoard:{cmdRequire:"DS/ENOCollabSharingCmds/commands/ENONew/NewECcompCBDBoard"},PhysicalProductPLMPCBPhysicalComponent:{cmdRequire:"DS/ENOCollabSharingCmds/commands/ENONew/NewECcompPLMPCBPhysicalComponent"},assembly:{cmdRequire:"DS/ENOCollabSharingCmds/commands/ENONew/NewProduct"},component:{cmdRequire:"DS/ENOCollabSharingCmds/commands/ENONew/NewPart"},drawing:{cmdRequire:"DS/ENOCollabSharingCmds/commands/ENONew/NewDrawing"},constructionProduct:{cmdRequire:"DS/CATCivilNewCommands/command/PLMNew/CATCivilNewConstructionProductCmd"}};return e.singleton({getCmdDetails:e=>t[e],getRegisteredCmd(){}})})),define("DS/ENONewWidget/ENONew/Model/ENONewModel",["UWA/Class/Model"],(function(e){return e.extend({defaults:{},init(){console.debug("ENONew: ENONewModel init"),this._parent.apply(this,arguments)},setup(e){this._parent.apply(this,arguments)},getSecurityContext(){var e=this.get("securityContext");if(!e){let t=this.get("context");t&&t.header&&(e=t.header.SecurityContext)}return e},setSecurityContext(e){e!==this.getSecurityContext()&&this.set("securityContext",e)},getSecurityContextNLS(e){e||(e=this.getSecurityContext());var t=this.getCredentialList();if(t){var i=t.find((t=>"ctx::"+t.ctxname===e));if(i)return i.ctxtitle}},getCredentialList(){return this.get("credentials")},setCredentialList(e){this.set("credentials",e)},getTenant(){let e=this.get("context");return e&&e.tenant?e.tenant:"OnPremise"},getPolicy(){let e=this.get("options");if(e&&e.attributes)return e.attributes.policy}})})),define("DS/ENONewWidget/ENONew/View/TabUtility",[],(function(){return{buildFacetDependencyMap(e){var t={},i=[];return e&&e.forEach((function(e){let n=e.facet.name;e.dependee&&e.dependee.length>0?(t[n]||(t[n]={}),t[n].to=new Set(e.dependee),e.dependee.forEach((function(e){t[e]||(t[e]={});var i=t[e];i.from||(i.from=new Set),i.from.add(n)}))):i.push(n)})),{dependencyMap:t,independentFacets:i}}}})),define("DS/ENONewWidget/utils/ENONewFacetConstants",[],(function(){return{ENONewFACET_CLASSIFICATION:"classificationFacet",ENONewFACET_REVISION:"revisionFacet",ENONewFACET_EIN:"ENONewEINFacet",ENONewFACET_RELEASE_SNAPSHOT_TEMPLATE:"releaseSnapshotFacet",ENONewFACET_MATERIAL:"MaterialFacet",ENONewFACET_Files:"filesFacet",ENONewFACET_Thumbnail:"thumbnailFacet"}})),define("DS/ENONewWidget/ajaxRequests/LifecycleServicesSettings",["UWA/Class","UWA/Class/Options","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],(function(e,t,i){"use strict";return e.singleton(t,{folder_json:null,tenant:"",options:{wintop:!1},init:function(e){this._parent()},getTenant:function(){return this.tenant},setTenant:function(e){this.tenant=e},getInstance:function(e){try{this.init(e)}catch(e){}for(var t in e)this.options[t]=e[t];return this},get3DSpaceUrl:function(e){var t=location.protocol+"//"+location.hostname,i="3DSpace";return e&&(e.serverUrl=t,e.serverUri=i),t+"/"+i},get3DSpaceBaseUrl:function(e){if(!UWA.is(this.getOption("platform_services"),"array"))throw new Error("Platform services not initialize yet");var t;try{for(var i=0;i<this.getOption("platform_services").length;i++)if(this.getOption("platform_services")[i].platformId==e){t=this.getOption("platform_services")[i]["3DSpace"];break}}catch(e){t=this.get3DSpaceUrl()}return t},get3DSpaceWSUrl:function(e,t,i){e&&""!=e||(e=widget.getValue("x3dPlatformId")||"OnPremise");var n=this.get3DSpaceBaseUrl(e)+t+(t.indexOf("?")<0?"?":"&")+"tenant="+e;return null!=i&&null!=i&&(n=n+"&"+i),n},getServerURL:function(){var e="";return i.getPlatformServices({onComplete:function(t){e=t[0]["3DSpace"]}}),e},getPlatformUrl:function(e,t){var i=location.protocol+"//"+location.hostname,n=e;return t&&(t.serverUrl=i,t.serverUri=n),i+"/"+n},getPlatformBaseUrl:function(e,t){if(!UWA.is(this.getOption("platform_services"),"array"))throw new Error("Platform services not initialize yet");var i;try{for(var n=0;n<this.getOption("platform_services").length;n++)if(this.getOption("platform_services")[n].platformId==t){i=this.getOption("platform_services")[n][e];break}}catch(e){i=this.getPlatformUrl()}return i},getPlatformWSUrl:function(e,t,i,n){null!=t&&null!=t&&""!=t||(t="OnPremise");var a=this.getPlatformBaseUrl(e,t)+i+"?tenant="+t;return null!=n&&null!=n&&(a=a+"&"+n),a},service_initialization:function(e,t){var n=this,a=!1;try{UWA.is(this.getOption("platform_services"),"array")||(a=!0)}catch(e){a=!0}a?t?(n.setOption("platform_services",t),e()):i.getPlatformServices({onComplete:function(t){n.setOption("platform_services",t),void 0!==window.widget&&window.widget&&void 0!==window.widget.getValue("x3dPlatformId")&&window.widget.getValue("x3dPlatformId")&&window.widget.getValue("x3dPlatformId").trim().length>0?n.tenant=window.widget.getValue("x3dPlatformId"):n.tenant=t[0].platformId,e()},onFailure:function(t){e()}}):e()},getHeaders:function(e){var t={Accept:"application/json","Content-Type":"application/json","Accept-Language":widget.lang};return e&&(t.SecurityContext=e),t}})})),define("DS/ENONewWidget/ajaxRequests/ENONewAjaxRequests",["DS/WAFData/WAFData"],(function(e){return{_get:function(t,i,n){var a=Date.now().toString(),o="timestamp"+a;t.params[o]=a;var r=t.service+"?tenant="+t.tenant;-1!=r.indexOf("?")?r+="&":r+="?";var s=t.params;for(var l in s){var c=s[l];c instanceof Array?c.forEach((function(e){r+=l+"="+e+"&"})):r+=l+"="+c+"&"}var d=this.getHeaders(t.header);e.authenticatedRequest(r,{method:"GET",headers:d,timeout:864e5,type:"json",onComplete:function(e){i(e)},onFailure:function(e,t){var i=e.message;i.startsWith("NetworkError:")&&i.contains("401")?n({result:[{errors:[{errorCode:"InvalidAccess"}]}]}):n({result:[{errors:[{errorCode:"NetworkError"}]}]})},onTimeout:function(){n({result:[{errors:[{errorCode:"NetworkError"}]}]})}})},_post:function(t,i,n,a){var o=JSON.stringify(t),r=i.service+"?tenant="+i.tenant;for(var s in-1!=r.indexOf("?")?r+="&":r+="?",i.params){var l=i.params[s];l instanceof Array?l.forEach((function(e){r+=s+"="+e+"&"})):r+=s+"="+l+"&"}var c=this.getHeaders(i.header);e.authenticatedRequest(r,{method:"POST",headers:c,timeout:864e5,data:o,type:"json",onComplete:function(e){n(e)},onFailure:function(e,t){var i=e.message;i.startsWith("NetworkError:")&&i.contains("401")?a({result:[{errors:[{errorCode:"InvalidAccess"}]}]}):a({result:[{errors:[{errorCode:"NetworkError"}]}]})},onTimeout:function(){a({result:[{errors:[{errorCode:"NetworkError"}]}]})}})},getHeaders:function(e){var t={Accept:"application/json","Content-Type":"application/json","Accept-Language":widget.lang};for(var i in e){var n=e[i];"SecurityContext"===i&&(n=encodeURIComponent(n)),t[i]=n}return t}}})),define("DS/ENONewWidget/utils/ENONewClientBLUtil",[],(function(){"use strict";var e=["name","description"];return{getUIAttributesForBL:function(t,i){var n=this,a=[];if(t){if(t.attributes){var o=t.attributes;Object.keys(o).forEach((t=>{"publicAttributes"===t||"extensionAttributes"===t?o[t].forEach((t=>{let o=n.getValue(t,i[t.name]);if(!t.basicAttribute||e.includes(t.name)){var r={name:t.name};t.basicAttribute&&(r.basicAttribute=!0),UWA.is(o)&&(r.value=o,UWA.is(t.unitName)&&(r.unitName=t.unitName,r.dimensionType=t.dimensionType),UWA.is(i[t.name])&&UWA.is(i[t.name].unitName)&&(r.unitName=i[t.name].unitName,r.dimensionType=i[t.name].dimensionType)),t.forUI&&(r.forUI=!0,null!=t.isReadOnly&&(r.isReadOnly=t.isReadOnly),null!=t.visible&&(r.visible=t.visible),null!=t.range&&(r.range=t.range),null!=t.blAccess&&(r.blAccess=t.blAccess),null!=t.notif&&(r.notif=t.notif),null!=t.displayAsEntered&&null!=t.displayAsEntered&&(r.displayAsEntered=t.displayAsEntered+""),t.manipulationUnit&&(r.manipulationUnit=t.manipulationUnit),t.mksDBUnit&&(r.mksDBUnit=t.mksDBUnit)),a.push(r)}})):"internalAttributes"===t&&o[t].forEach((e=>{var t={name:e.name,value:e.value};e.value&&e.unitName&&(t.unitName=e.unitName,t.dimensionType=e.dimensionType),e.basicAttribute&&(t.basicAttribute=!0),a.push(t)}))}))}t.basicAttributes&&Object.keys(t.basicAttributes).forEach((e=>{var i=a.find((t=>t.name===e));if(!i){var n=t.basicAttributes[e];i={name:e,value:n,basicAttribute:!0},a.push(i)}}))}return a},updateUIAttributeForBL:function(e,t){for(var i=!1,n=0;n<e.length;n++){var a=e[n];if(Object.hasOwn(t,a.name)){var o=this.getValue(a,t[a.name]);this.isSame(e[n].value,o)||(e[n].value=o,i=!0,UWA.is(t[a.name])&&UWA.is(t[a.name].unitName)&&(e[n].unitName=t[a.name].unitName,e[n].dimensionType=t[a.name].dimensionType));break}}return i},setModifiedAttributes:function(e,t,i,n){var a=this,o={},r=e.attributes;if(n)for(var s=0;s<n.length;s++){var l=n[s];if(l){var c=!1,d=t.find((e=>e.name===l.name));if(d&&r&&Object.keys(r).forEach((e=>{var t=r[e].find((e=>e.name===l.name));if(t)if(c=!0,"publicAttributes"===e||"extensionAttributes"===e){var n=a.pullResultforUI(l,t,d);Object.keys(n).length>0&&(o[l.name]=n)}else"internalAttributes"===e&&a.putUpdatedValue(l,t,d,i)})),!c){var u={name:l.name,type:"string"};d||(d={name:l.name,type:"string"}),a.putUpdatedValue(l,u,d,i),UWA.is(d.value,"array")&&(u.multivalued=!0),l.basicAttribute&&(u.basicAttribute=!0),t.push(d),r.internalAttributes||(r.internalAttributes=[]),r.internalAttributes.push(u)}UWA.is(l.notif)&&(d.notif=l.notif)}}return{updateUIAttribute:o,notifs:[]}},pullResultforUI:function(e,t,i){var n=this,a={};if(UWA.is(e.range)&&!n.isSame(i.range,e.range)){var o,r;t.originalAuthVal?(o=t.originalAuthVal.authVal,r=t.originalAuthVal.authValNLS):(o=t.range,r=t.rangeNLS);var s=[],l=[];if(o&&r&&o.length==r.length)for(var c=0;c<e.range.length;c++){var d=e.range[c],u=o.findIndex((e=>e===d));u>-1?(s.push(o[u]),l.push(r[u])):(s.push(d),l.push(d))}else l=s=e.range;i.range=s,a.authorizedValues=s,a.authorizedValuesNLS=l}UWA.is(e.visible)&&(n.isSame(i.visible,e.visible)||(i.visible=e.visible,a.visible=e.visible)),UWA.is(e.isReadOnly)&&(n.isSame(i.isReadOnly,e.isReadOnly)||(i.isReadOnly=e.isReadOnly,a.readOnly=e.isReadOnly)),UWA.is(e.notif,"object")&&(i.notif=e.notif,a.notif=e.notif);var p=n.putUpdatedValue(e,t,i);return p&&(a.value=p.value,p.unitName&&(a.unitName=p.unitName),p.dimension&&(a.dimension=p.dimension)),a},putUpdatedValue:function(e,t,i,n){let a=!1;if(n&&n.getAttributeFromField&&e&&e.name){let t=n.getAttributeFromField("name",e.name);t&&(a=!!t.multivalue)}if(!n&&t&&t.hasOwnProperty("multivalued")&&t.multivalued&&(a=!0),!a&&Array.isArray(e.value)&&e.value.length>0&&(e.value=e.value[0]),UWA.is(e.value)&&(!this.isSame(i.value,e.value)||!this.isSame(i.unitName,e.unitName))){t&&(t.range&&t.range.length>0&&!t.range.includes(e.value)||(t.value=e.value,t.modified=!0),e.unitName&&e.dimension&&(t.unitName=e.unitName,t.dimension=e.dimension,t.modified||(t.modified=!0))),i.value=e.value,e.unitName&&e.dimension&&(i.unitName=e.unitName,i.dimension=e.dimension);let n={value:e.value};return e.unitName&&e.dimension&&(n.unitName=e.unitName,n.dimension=e.dimension),n}},getValue:function(e,t){var i=null;if(t?(i=t.valueDB)||(i=t.value):(i=e.valueDB)||(i=e.value),UWA.is(i,"array")){for(var n=[],a=0;a<i.length;a++)n.push(String(i[a]));i=n}else i=String(i);return i},isSame:function(e,t){return typeof e==typeof t&&(UWA.is(e,"array")&&UWA.is(t,"array")?e.length==t.length&&!(e.filter(((e,i)=>{if(t[i]!=e)return!0})).length>0):e==t)}}})),define("DS/ENONewWidget/validation/FileName",["UWA/Class"],(function(e){"use strict";var t={name:"CATIAV5",require:"DS/ENOXCADCATIAV5UI/ENOXCADFileNameValidation"};return{validate:function(e,i){var n=e.value,a=t.require;require([a],(function(e){e.checkfilenameValidity(n,(function(e){var t;null!=e&&(console.debug("ENOXCADFileNameValidation : "+e),t={message:e,eventID:"warning"}),i(t)}))}))}}})),define("DS/ENONewWidget/utils/Utils",[],(function(){"use strict";function e(){}return e.prototype={isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},forEach:function(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),this.isArray(e))for(var i=0,n=e.length;i<n;i++)t.call(null,e[i],i,e);else for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.call(null,e[a],a,e)}},new e})),define("DS/ENONewWidget/utils/ENONewAttributeUtil",["DS/EditPropWidget/models/EditPropAttributeModel","DS/EditPropWidget/utils/EditPropUtils","i18n!DS/ENONewWidget/assets/nls/ENONewWidgetNls"],(function(e,t,i){"use strict";var n="attribute";function a(e,t){if(e){console.debug("ENONew: get localPref : "+e);var i="ENONew";return t&&(i+="_"+t),i+="_"+e,localStorage.getItem(i)}}return{_buildAttributesModel:function(t,i,o){var r=[];if(UWA.is(t,"array"))for(var s in t){var l=t[s],c=l.name,d=l.nls,u=l.type,p=l.value,f=l.value,h=l.isReadOnly,m=l.visible,v=l.extension,g=l.range,N=l.authorizedValuesRequired,b=l.rangeNLS,w=l.rangeGroup,E=l.icons,C=l.forbiddenChar,y=l.dimension,O=l.unitName,A=l.dimensionType,S=l.maxlength,D=l.multiline,I=l.multivalued,T=l.positionUI,F=l.positionGroup,_=l.modified,U=l.mandatory,x=l.visibility,W=l.defaultAttribute,L=l.storeLocalPreference,V=l.validationService,M=l.sortedOptions,B=l.dropdownMode,j=l.applysort,P=l.forUI,R=l.tooltipInfo,k=l.placeholder,z=l.disable;let i=l.manipulationUnit,$=l.mksDBUnit,Q=l.displayAsEntered;if(m||P||W){u||(u="string");var q=u;if("string"===(u=u.toLowerCase()))q="text";else if("integer"===u)q="integer";else if("real"===u)q="real";else if("boolean"===u)q="boolean",""!==p&&void 0!==p||(p="False");else if("date"===u||"timestamp"===u){if(""!=p){p.contains("GMT")||(p=parseInt(p));var H=new Date(p);f=this._convertDateToStandard(H,!0).valueDB}q="timestamp"}var X=c;X=v?v+"-"+X:X,W&&(X="New-"+c);var G=new e({path:X,name:c,label:d,value:p,valueDB:f,type:q,readOnly:h});"3DPartTemplate"==c&&G.set("autocomplete",!0),"boolean"!==q&&g&&(g&&G.set("authorizedValues",g),b&&G.set("authorizedValuesNLS",b),w&&G.set("authorizedValuesGroup",w),E&&G.set("authorizedValuesIcon",E),N&&G.set("authorizedValuesRequired",N),G.set("customSelect",!0)),UWA.is(m,"boolean")&&G.set("visible",m),C&&G.set("forbiddenChar",C),M&&G.set("sortedOptions",M),V&&G.set("validationService",V),S>0&&G.set("maxlength",S),x&&G.set("visibility",x),D&&G.set("multiline",D),_&&G.set("modified",_),I&&G.set("multivalue",I),U&&G.set("mandatory",U),W&&G.set("defaultAttribute",W),B&&G.set("dropdownMode",B),j&&G.set("applySort",j),P&&G.set("forUIBL",P),U||G.set("facet","ExtensionsFacet");var K=2;W?K=6:o&&(K=9),F&&(K=F);var J=1;v&&(K="4."+v),T||0===T||(J=2,T=0,G.set("masked",!1));var Y=K+"-"+J+"-"+T;if(G.set("positionUI",Y),L){G.set("storeLocalPreference",L);var Z=a(X,n);Z&&(g&&g.includes(Z)||!g)&&Z!=f&&(G.set("valueDB",Z),G.set("isModified",!0))}null!=y&&(G.set("dimension",y),G.set("unitName",O),G.set("dimensionType",A)),R&&G.set("tooltipInfo",{title:R.title,shortHelp:R.shortHelp,longHelp:R.longHelp,moreHelpCB:R.moreHelpCB}),k&&G.set("placeholder",k),z&&G.set("disable",z),i&&G.set("manipulationUnit",i),null!=Q&&null!=Q&&G.set("displayAsEntered",Q),$&&G.set("mksDBUnit",$)}null!=G&&r.push(G)}return r},_parseAttributeModels:function(e,i){if(i&&e){if(e.hasOwnProperty("value")){if(e.value!==i.valueDB){var a=i.valueDB;"number_wux"!=i.tw_type&&"number"!=i.tw_type||!UWA.is(a,"number")||(a=""+a),e.value=a,e.modified=!0}if(i.hasOwnProperty("dimensionType")&&i.hasOwnProperty("dimension")&&e.hasOwnProperty("dimension")){let n=i.dimension,a=i.dimensionType;if(e.dimension!==i.dimension){let i=t.getDimensionUnitName(a,n);e.unitName=i,e.dimension=n,e.modified||(e.modified=!0)}}}if(e.storeLocalPreference)!function(e,t,i){if(e&&t){console.debug("ENONew: save localPref : "+e+" = "+t);var n="ENONew";i&&(n+="_"+i),n+="_"+e,localStorage.setItem(n,t)}}(i.getIdentifier(),i.valueDB,n)}},_convertDateToStandard:function(e,t){if(!e)return{value:"",valueDB:""};var i=t?e:new Date,n=e.getUTCFullYear(),a=e.getUTCMonth()+1,o=e.getUTCDate(),r=i.getUTCHours(),s=i.getUTCMinutes(),l=i.getUTCSeconds();return a<10&&(a="0"+a),o<10&&(o="0"+o),r<10&&(r="0"+r),s<10&&(s="0"+s),l<10&&(l="0"+l),i.setYear(n),i.setMonth(e.getMonth()),i.setDate(o),{value:i.toLocaleString(widget.lang),valueDB:n+"/"+a+"/"+o+"@"+r+":"+s+":"+l+":GMT"}}}})),define("DS/ENONewWidget/ENONew/Events",["UWA/Class","UWA/Class/Events"],(function(e,t){return e.singleton(t,{init(){this._parent(),console.debug("ENONew: Events init")},dispatchEvent(){this._parent.apply(this,arguments)},addEvent(){this._parent.apply(this,arguments)}})})),define("DS/ENONewWidget/ENONewWidget",[],(function(){})),define("DS/ENONewWidget/command/NewContentAppOptions",["UWA/Class"],(function(e){return e.singleton({setAppContext(e){e?(this.AppContext=e,this.isAppContextSet=!0):isAppContextSet=!1},getAppContext(){return this.AppContext},isAppContextSet:!1})})),define("DS/ENONewWidget/ENONew/Model/CreateOptions",["UWA/Class/Model"],(function(e){return e.extend({defaults:{isNewContentCmd:!1,showSubtype:!0},init(e){console.debug("ENONew CreateOptions init"),this._parent.apply(this,arguments),this.isNewContentCmd="ENONewContentHdr"===e.ID},setup(e){this._parent.apply(this,arguments),e&&(this.isWebInWin=!!e.isWebInWin,UWA.is(e.client_app_name,"string")&&(this.client_app_name=e.client_app_name),UWA.is(e.client_app_domain,"string")&&(this.client_app_domain=e.client_app_domain))},getWIWAppInfo(){return{isWebInWin:this.isWebInWin,client_app_name:this.client_app_name,client_app_domain:this.client_app_domain}},validate(e,t){e&&this.isNewContentCmd}})})),define("DS/ENONewWidget/command/sample/ENONewDummyCmdOptions",["DS/ENONewWidget/command/NewContentOptions"],(function(e){return e.singleton({getCreateOptions:function(e){return this.launcherOptions||(this.launcherOptions={context:{service:"3DSpace"},silentMode:!1,notification:!0,options:{parentPIDs:e.parentPIDs,selectedIDs:[],domainAttributes:[{name:"DummyBookmark"}]}},this.events&&(this.launcherOptions.events=this.events)),this.launcherOptions}})})),define("DS/ENONewWidget/ENONew/ENONewEngine",["UWA/Core","UWA/Controls/Abstract","DS/WidgetServices/WidgetServices","DS/ENONewWidget/ENONew/Controller/ENONewController","DS/ENONewWidget/ENONew/Model/CreateOptions","DS/ENONewWidget/utils/ENONewConstants"],(function(e,t,i,n,a,o){var r=["DummyBookmark","UsageDimension"];return t.extend({objInfo:{id:"",appName:"",context:{header:{SecurityContext:""},tenant:"",service:"",serviceBaseUrl:""},labelTopBar:"",commandName:"",overlay:!0,type:"",silentMode:!1,responseFormat:0,notification:!0,activatelock:{show:!1,preference:""},activateDraftMode:{show:!1,preference:""},activateCreateAnother:!1,showCreateAnother:!0,leadingappspecific:{},options:{preferedType:"",typeName:"",select:[],parentPIDs:[],selectedIDs:[],parentOrigin:[],folderID:[],activeFolder:!1,attributes:{},domainAttributes:[{name:"",value:[]}]},facets:[],viewType:"listView",events:{onSuccess:function(){},onFailure:function(){},onCancel:function(){}}},_getController:function(e,t){return this.controller?this.controller:new n(e,t)},init:function(t,n,s){if(console.log("ENONew Engine init"),n&&i.setWidgetObject(n),this._parent(t),t){this.context=t.context,this.objInfo.id=void 0!==t.id?t.id:"",this.objInfo.appName=e.is(t.appName,"string")?t.appName:void 0,this.objInfo.context=t.context?t.context:{},t.options||(t.options={}),this.objInfo.type=t.type,this.objInfo.silentMode=!0===t.silentMode,this.objInfo.responseFormat=t.responseFormat?t.responseFormat:0,this.objInfo.responseFormat&&(this.objInfo.parsed=!0),this.objInfo.labelTopBar=t.labelTopBar,this.objInfo.commandName=t.commandName,this.objInfo.overlay=0!=t.overlay,this.objInfo.notification=0!=t.notification,this.objInfo.activateCreateAnother=!0===t.activateCreateAnother,this.objInfo.showCreateAnother=!1!==t.showCreateAnother,this.objInfo.leadingappspecific=e.is(t.leadingappspecific,"object")?t.leadingappspecific:void 0,this.objInfo.facets=t.facets?t.facets:[],this.objInfo.viewType=t.viewType?t.viewType:o.DIALOG.LIST_VIEW,t.activatelock||(t.activatelock={}),this.objInfo.activatelock={show:1==t.activatelock.show,preference:t.activatelock.preference},t.activateDraftMode||(t.activateDraftMode={}),this.objInfo.activateDraftMode={show:1==t.activateDraftMode.show,preference:t.activateDraftMode.preference};var l=this.objInfo.options;for(var c in l){if(c===o.DOMAIN_ATTRIBUTES){var d=t.options[c],u=[];d&&(d.forEach((function(e){if(e&&e.name&&r.includes(e.name)){var t={name:e.name};e.value&&(t.value=e.value),u.push(t)}})),t.options[c]=u)}l[c]=t.options[c]}this.objInfo.type||(this.objInfo.type=l.typeName);var p=this.objInfo.events;if(t.events)for(var f in p)p[f]=t.events[f];var h=s instanceof a&&s.isValid()?s:void 0;h&&h.set("createOptions",this.objInfo),this.controller=this._getController(this.objInfo,h)}}})})),define("DS/ENONewWidget/ENONew/View/Facet/ENONewFacetHelper",["DS/ENONewWidget/utils/ENONewFacetConstants","i18n!DS/ENONewWidget/assets/nls/ENONewWidgetNls","i18n!DS/ENONewWidget/assets/nls/ENONewFacetNls"],(function(e,t,i){var n={facetObject:{require:"",alwaysCalled:!0,facet:{name:"",text:"",icon:""},options:{data:{}}},getFacetDefinition:function(t){return(n={},n[e.ENONewFACET_CLASSIFICATION]={require:"DS/ClassificationsFacet/PLMNewClassificationFacet",alwaysCalled:!0,facet:{name:e.ENONewFACET_CLASSIFICATION,text:i.get(e.ENONewFACET_CLASSIFICATION),icon:"classification-book"},dependee:[]},n[e.ENONewFACET_REVISION]={require:"DS/CfgWebAppXRevisionCommands/facets/PLMNewRevisionFacet",alwaysCalled:!1,facet:{name:e.ENONewFACET_REVISION,text:i.get(e.ENONewFACET_REVISION),icon:"flow-branch-list"},dependee:[]},n[e.ENONewFACET_EIN]={require:"DS/EngineeringItemCmd/SetPartNumberFacet/ENONewEINFacet",alwaysCalled:!0,facet:{name:e.ENONewFACET_EIN,text:i.get(e.ENONewFACET_EIN),icon:"progress-3"},dependee:[]},n[e.ENONewFACET_RELEASE_SNAPSHOT_TEMPLATE]={require:"DS/XSRCommonComponents/facets/template/ReleaseSnapshotFacet",alwaysCalled:!1,facet:{name:e.ENONewFACET_RELEASE_SNAPSHOT_TEMPLATE,text:i.get(e.ENONewFACET_RELEASE_SNAPSHOT_TEMPLATE),icon:"picture"},dependee:[]},n[e.ENONewFACET_MATERIAL]={require:"DS/XSRCommonComponents/facets/material/Materialfacet",alwaysCalled:!1,facet:{name:e.ENONewFACET_MATERIAL,text:i.get(e.ENONewFACET_MATERIAL),icon:"material"},dependee:[]},n[e.ENONewFACET_Files]={require:"DS/DocumentCreateNew/PLMNewFilesTab/PLMNewFilesTab",alwaysCalled:!0,facet:{name:e.ENONewFACET_Files,text:i.get(e.ENONewFACET_Files),icon:"docs"},dependee:[]},n[e.ENONewFACET_Thumbnail]={require:"DS/ENOXModelApp/PLMInfra/PLMThumbnailFacet",alwaysCalled:!0,facet:{name:e.ENONewFACET_Thumbnail,text:i.get(e.ENONewFACET_Thumbnail),icon:"view-small-thb wux-ui-3ds "},dependee:[]},n)[t];var n},getFacetList:function(e,t,i){var a=[],o=this.getDefaultFacet();return o.options.data=e,i.buttons&&(o.options.buttons=i.buttons),a.push(o),t&&t.forEach((function(e){var t=n.getFacetDefinition(e.name);t&&(t.options=null!=e.facetoptions?e.facetoptions:{},i.securityContext&&(t.options.securityContext=i.securityContext),i.tenant&&(t.options.tenant=i.tenant),a.push(t))})),a},getDefaultFacet:function(){return{require:"DS/ENONewWidget/ENONew/View/Facet/ENOListViewFacet",facet:{name:this.getDefaultFacetName(),text:i.get("defaultFacetCreate"),icon:"attributes"},options:{}}},getDefaultFacetName:function(){return"ENOCreate"}};return n})),define("DS/ENONewWidget/ENONewLauncher",["UWA/Controls/Abstract","DS/ENONewWidget/ajaxRequests/LifecycleServicesSettings"],(function(e,t){return t.service_initialization((function(){})),e.extend({CreateNew:function(e,t){e&&require(["DS/ENONewWidget/ENONew/ENONewEngine"],(function(i){new i(e,void 0,t)}))}})})),define("DS/ENONewWidget/command/NewContentCommandBase",["DS/ApplicationFrame/Command","DS/ENONewWidget/ENONewLauncher","DS/ENONewWidget/command/NewContentAppOptions","DS/ENONewWidget/ENONew/Model/CreateOptions","i18n!DS/ENONewWidget/assets/nls/ENONewWidgetNls"],(function(e,t,i,n,a){"use strict";return e.extend({init:function(e){if(console.debug("ENONew NewContentCommandBase init"),this._parent(e),i.isAppContextSet)this.ENONewContext=i.getAppContext(),console.debug("cmdID: "+e.ID+"className: "+e.className);else if(e.context){var a=e.context.getENONewContext;UWA.is(a,"function")&&(this.ENONewContext=e.context.getENONewContext(),console.debug("cmdID: "+e.ID+"className: "+e.className))}this.launcher=new t,this.createOptModel=new n(e)},getType(){var e=this.ENONewContext;if(e&&e.getTypeFromApp&&UWA.is(e.getTypeFromApp,"function"))return e.getTypeFromApp(this.options)},launchCreateNew(e){this.launcher&&this.launcher.CreateNew(e,this.createOptModel)},execute(){var e=this.getCreateOptions({newType:this.getType()});this.launchCreateNew(e)},getCreateOptions(e){var t,i,n=this.ENONewContext;if(n&&n.getCreateOptions&&UWA.is(n.getCreateOptions,"function")&&(i=n.getCreateOptions(e)),this.getOptions&&UWA.is(this.getOptions,"function")&&(t=this.getOptions(e)),t){if(i)for(var a in i){var o=i[a];if("events"===a)t[a]||(t[a]={}),Object.assign(t[a],o);else if(null!=o||null!=o)if(UWA.is(o,"object")&&"options"===a)if(t[a])for(var r in o){var s=o[r];s&&(t[a][r]=s)}else t[a]=o;else t[a]=o}}else i&&(t=i);return this.getType&&UWA.is(this.getType,"function")&&(t||(t={}),t.options||(t.options={}),t.options.typeName=this.getType()),t},getCommandLabel:()=>a.get("new")})})),define("DS/ENONewWidget/command/sample/ENONewDummyCmd",["DS/ENONewWidget/command/NewContentCommandBase"],(function(e){"use strict";return e.extend({defaults:{type:"VMADocument"},getType(){return this.defaults.type}})})),define("DS/ENONewWidget/command/sample/ENONewMockDocumentCmd",["DS/ENONewWidget/command/NewContentCommandBase"],(function(e){"use strict";return e.extend({defaults:{type:"MockDocument"},getType(){return this.defaults.type}})})),define("DS/ENONewWidget/ajaxRequests/WebReq",["UWA/Class","DS/WAFData/WAFData","DS/ENONewWidget/utils/Utils","DS/ENONewWidget/ajaxRequests/LifecycleServicesSettings"],(function(e,t,i,n){var a=e.singleton({defaults:{type:"json",timeout:6e4},init:function(){["delete","get","head","options"].forEach((function(e){this[e]=function(t,i){return this.request(UWA.merge(i||{},{url:t,method:e}))}}),this),["post","put","patch"].forEach((function(e){this[e]=function(t,i,n){let a={...n||{}};return this.request(UWA.merge(a,{url:t,method:e,data:i}))}}),this)},request:function(e){return"string"==typeof e?e={url:arguments[0]}:(e=e||{}).data&&"string"!=typeof e.data&&(e.data=JSON.stringify(e.data)),UWA.Utils.parseUrl(e.url).protocol||(e.url=n.get3DSpaceWSUrl(e.tenant,e.url,null)),(e=UWA.merge(e,this.defaults)).method=e.method?e.method.toLowerCase():"get",e.headers=e.headers||n.getHeaders(e.securityContext),e.securityContext||delete e.headers.SecurityContext,this._dispatchPromise(e)},_dispatchPromise:function(e){var i=this;return new UWA.Promise((function(n,a){t.authenticatedRequest(i._createURL(e),{method:e.method,headers:e.headers,timeout:e.timeout,data:e.data,type:e.type,onComplete:function(e){n(e)},onFailure:function(e,t,n){a({error:e,response:t,headers:n,errorMessage:i._parseError(e,t)})},onTimeout:function(){a({isTimeout:!0})}})}))},onWebServiceError:function(e,t,i,n,a){UWA.is(t,"string")&&t.startsWith("NetworkError:")&&e({result:[{errors:[{errorCode:"NetworkError"}]}]})},_parseError:function(e,t){if(t&&t.error)return JSON.stringify(t.error)},_createURL:function(e){var t=e.url;return i.forEach(e.params,(function(e,i){t+=(-1===t.indexOf("?")?"?":"&")+i+"="+e})),t}});return a.init(),a})),define("DS/ENONewWidget/utils/DefaultCredential",["DS/ENONewWidget/ajaxRequests/WebReq","DS/ENONewWidget/ajaxRequests/LifecycleServicesSettings","DS/WAFData/WAFData"],(function(e,t,i){"use strict";let n=(n,a,o)=>{var r=t.get3DSpaceWSUrl(n,"/resources/pno/person/getsecuritycontext",null);i.authenticatedRequest(r,{type:"json",method:"GET",proxy:"passport",headers:t.getHeaders(),timeout:6e5,onComplete:function(e){var t="";if(null!=e&&""!=e&&e.hasOwnProperty("SecurityContext")&&null!=e.SecurityContext){(t=e.SecurityContext.replace("ctx::","")).trim().length>0&&(t="ctx::"+e.SecurityContext),a(t)}},onFailure:function(t,i){console.error("getSecurityContext:Failure..."+t),e.onWebServiceError(o,t,i)},ontimeout:function(){console.error("getSecurityContext: A connection timeout occurred.")}})},a=e=>{if("function"==typeof widget.hasPreference&&widget.hasPreference("xPref_CREDENTIAL")){var t=widget.getPreference("xPref_CREDENTIAL");if(void 0!==t.value&&null!==t.value&&t.hasOwnProperty("value"))return"ctx::"+t.value}return"function"==typeof widget.hasPreference&&null!=widget.getPreference("pad_security_ctx")?widget.getPreference("pad_security_ctx").value:null};return{loadDefaultContexCredential:e=>{return(t=e.tenant,e.context,i=a(t),i?new UWA.Class.Promise.resolve(i):new UWA.Class.Promise((function(e,i){n(t,(function(t){e(t)}),(function(e){i(e)}))}))).then((e=>UWA.Promise.resolve((e=>e.startsWith&&e.startsWith("ctx::")?e:"ctx::"+e)(e))));var t,i}}})),define("DS/ENONewWidget/ENONew/View/ENOListView",["UWA/Core","UWA/Controls/Abstract","DS/EditPropWidget/facets/Properties/Properties","DS/EditPropWidget/models/EditPropAttributeModel","DS/EditPropWidget/models/EditPropModel","DS/EditPropWidget/utils/AttributesUtils","DS/ENONewWidget/utils/ENONewAttributeUtil","DS/ENONewWidget/utils/ENONewClientBLUtil","DS/ENONewWidget/utils/ENONewConstants","DS/EditPropWidget/utils/EditPropUtils","i18n!DS/ENONewWidget/assets/nls/ENONewWidgetNls","css!DS/ENONewWidget/ENONewWidget.css"],(function(e,t,i,n,a,o,r,s,l,c,d){return t.extend({init:function(t){var n=this;this.customEvents=[],this.floatingAttributes={},this.attributesForValidationService=[],this.persistAttribute={},this.enableNotif=!1,this.isFormValid=!0,this.identifier=t.identifier,this.skeleton=e.createElement("div",{class:"Attributes_container","data-rec-id":"Attributes_container_rec-id",styles:{width:"100%",height:"100%",display:"flex","flex-direction":"column"}});var a=t.events;for(eventID in a){var o=a[eventID];this.addEvent(eventID,o)}this.onComplete=t.onComplete,this.buttons=t.buttons;var r=new i({setCloseButton:!1,editMode:!0,readOnly:!1,scroller:!1,identifier:this.identifier,newInfraUI:!0,events:{onCancel:function(){},onNotification:function(e){n.updateValidStatus()},onValidActivation:function(e){}}}).inject(this.skeleton);this.propUI=r;r.setAccordionProperties({ExtensionsFacet:{name:"ExtensionsFacet",nameNLS:"Extensions",weight:-10}})},buildModel:function(e){this.data=e,this.propModel=new a;var t=this._buildAttributesModel(e);this.setPropModel(t),this.UIAttributesforBL=null},setPropModel:function(e){var t,i=this,a=this.propModel;if(e){for(var o in this.customEvents){var r=this.customEvents[o];a.addEvent(r.eventID,r.callback.bind(r))}t=a.set(e)}if(a.addEvent("onEnterKeyDown",(function(e){i.dispatchEvent("onEnterKeyDown",[e])})),a.addEvent("validateValue",(function(e){if(console.debug("ENONew: event-validateValue attr-",e),i.data.isUXBLDeployed&&e.forUIBL){var t={},n={name:e.name,value:e.value,valueDB:e.valueDB};e.dimensionType&&(n.dimensionType=e.dimensionType,e.dimension&&(n.dimension=e.dimension,n.unitName=c.getDimensionUnitName(e.dimensionType,e.dimension))),t[e.get("name")]=n,i.persistAttribute[e.getIdentifier()]=n,i.runClientBL(a,t)}e.defaultAttribute||i.dispatchEvent("publishAttribute",[e])})),t){a.addEvent("onChange",(function(e){var t=e._changed;for(var n in console.debug("ENONew: onChange",t),t){var a=t[n];a.isModified||(a.isModified=!0),a.defaultAttribute||(a.isUIModified=!0)}i.updateValidStatus()})),a.addEvent("onChange:New-Type",(function(){console.debug("ENONew: Type Changed"),i.dispatchEvent("onChangeAttribute",[this._changed])})),a.addEvent("onChange:New-project",(function(){console.debug("ENONew: Project Changed"),i.dispatchEvent("onChangeAttribute",[this._changed,a])})),a.addEvent("onChange:New-organisation",(function(){console.debug("ENONew: Organisation Changed"),i.dispatchEvent("onChangeAttribute",[this._changed,a])})),a.addEvent("onChange:New-role",(function(){console.debug("ENONew: Role Changed"),i.dispatchEvent("onChangeAttribute",[this._changed,a])})),a.get("3DPartTemplate")&&a.addEvent("onChange:3DPartTemplate",(function(e,t){console.debug("ENONew: 3DPartTemplate Changed"),i.dispatchEvent("onChangeAttribute",[this._changed])}));var s=a.get("ExtensionsFacet-Filename")?"ExtensionsFacet-Filename":!!a.get("Filename")&&"Filename";if(s){var l=a.get("PLMEntity.V_Name")?"PLMEntity.V_Name":!!a.get("ExtensionsFacet-PLMEntity.V_Name")&&"ExtensionsFacet-PLMEntity.V_Name";l||(l=a.get("V_Name")?"V_Name":!!a.get("ExtensionsFacet-V_Name")&&"ExtensionsFacet-V_Name");var d=!1;a.addEvent("onChange:"+l,(function(){if(!d){var e=a.get(s),t=a.get(l);if(e&&e.visible){var i=new n(e);i.set("value",t.get("value")),i.set("valueDB",t.get("valueDB")),a.set(i.getIdentifier(),i),d=!1}}})),a.addEvent("onChange:"+s,(function(){d=!0}))}}return t},loadView:function(e){this.propUI.initData([this.propModel]),this.propModel.clearChangedValue(),this._resizeHandler(),this.manageAccordion(this.propUI),this.enableNotif=!0,setTimeout((()=>{this.focusFirstLine(),this.showInitUXnotifs(),this.updateValidStatus()}))},updateValidStatus(){var e=!0;this.checkForMandatoryAttributes()||(e=!1),e&&!this.checkForUIValidation()&&(e=!1),e&&!this.checkForUXBLValidation()&&(e=!1),e&&!this.isFormValid&&(e=!1),this.dispatchEvent("onValidActivation",[e])},checkForMandatoryAttributes(){var e=!0,t=[],i=this.propModel.getAllAttributes();return Object.keys(i).forEach((e=>{var a=i[e];a&&a instanceof n&&a.mandatory&&t.push(a)})),o.validateAttributes(this.propModel,t,!0)&&(e=!1),e},checkForUIValidation(){var e=!0,t=[],i=this.propModel.getAllAttributes(),a=!this.isFormValid;Object.keys(i).forEach((e=>{var o=i[e];o&&o instanceof n&&(o.isUIModified||a)&&t.push(o)}));var r=o.validateAttributes(this.propModel,t);if(r&&r.length>0){e=!1;var s={};r.forEach((e=>{s[e.attrName]={error:{msg:e.message}}})),this.propUI.updateFormSection(s,this.propModel)}return a&&(this.isFormValid=e),e},checkForUXBLValidation(){var t=!0;if(this.UIAttributesforBL){var i=this.UIAttributesforBL.find((e=>{if(e&&!1!==e.visible&&e.notif&&1==e.notif.sev)return!0}));e.is(i,"object")&&(t=!1)}else{var n=this.propUI.elements.UIController.getUXBLErrors(this.propModel);n&&n.length>0&&(t=!1)}return t},disableInputFields:function(){this.propUI.disableInputFields()},refresh:function(){this.enableNotif=!1,this.propUI.addData([this.propModel]),this.manageAccordion(this.propUI),this.enableNotif=!0},focusFirstLine:function(){var e=this;setTimeout((function(){var t=e.propUI.elements.formSection.elements.accordion.items[0].name;e.propUI.elements.formSection.elements._organizers[t].focusLine(0,0)}))},runClientBL:function(t,i){var n=this;return this.existingClientBL||(this.existingClientBL=new e.Promise((function(e){var a=!1;if(i&&n.checkForUIValidation()&&n.isFormValid){var o=!1;n.UIAttributesforBL?o=s.updateUIAttributeForBL(n.UIAttributesforBL,i):(n.UIAttributesforBL=s.getUIAttributesForBL(n.data,i),o=!0),o?n.dispatchEvent("runBLForUI",[{attribute:n.UIAttributesforBL,interfaces:n.data.interfaces,modifiedAttributes:Object.keys(i)},function(i){if(i.result){var o=s.setModifiedAttributes(n.data,n.UIAttributesforBL,t,i.result);Object.keys(o.updateUIAttribute).length>0&&(console.log("update ui postUXBL",o.updateUIAttribute),n.propUI.updateFormSection(o.updateUIAttribute))}i.error&&"timeout"===i.error?n._addNotif({eventID:"warning",msg:d.get("UXBLTimeout"),id:"timeout"}):n.UIAttributesforBL.forEach((e=>{if(e.notif&&e.notif.sev&&e.notif.msg&&t)if(1!=e.notif.sev){var i=t.getAttributeFromField("name",e.name)[0].label+": "+e.notif.msg;n._showUXnotifs(e.notif.sev,i,e.name)}else e.visible&&(a=!0)})),n.existingClientBL=null,n.updateValidStatus(),e(a)}]):setTimeout((function(){n.existingClientBL=null,e()}))}else setTimeout((function(){n.UIAttributesforBL&&n.UIAttributesforBL.forEach((e=>{e.notif&&1==e.notif.sev&&e.notif.msg&&t&&e.visible&&(a=!0)})),n.existingClientBL=null,e(a)}))}))),this.existingClientBL},showInitUXnotifs:function(){var e=this,t=e.data.attributes,i={};Object.keys(t).forEach((n=>{var a=t[n];Object.keys(a).forEach((t=>{var n=a[t];if(n.notif&&n.notif.msg&&n.notif.sev)if(1==n.notif.sev)i[n.name]={notif:{sev:1,msg:n.notif.msg}};else{var o=n.nls+": "+n.notif.msg;e._showUXnotifs(n.notif.sev,o,n.name)}}))})),e.propUI.updateFormSection(i)},_showUXnotifs:function(e,t,i){var n;1!=e&&(2==e?n="warning":3==e&&(n="info"),this._addNotif({eventID:n,msg:t,id:i}))},updateResizeHandler:function(){var e=this.propUI.elements.formSection.elements.accordion.items[0];e&&this.propUI.elements.formSection.elements._organizers[e.name]._forms[0].dispatchEvent("resetDisplay1")},manageAccordion:function(e){var t=e.elements.formSection.elements.accordion;if(t){var i;t._expanderItems[0]&&t._expanderItems[0].elements.header.hide();t._expanderItems[1]&&(i=t._expanderItems[1]),i&&(!0===i.expandedFlag?i.header=d.collapseExtension:i.header=d.expandExtension,t.getContent().addEventListener("expand",(function(e){if("ExtensionsFacet"===e.options.expanderTarget.domId){var t=d.collapseExtension;e.dsModel._expanderItems[e.options.expanderIndex].header=t}})),t.getContent().addEventListener("collapse",(function(e){if("ExtensionsFacet"===e.options.expanderTarget.domId){var t=d.expandExtension;e.dsModel._expanderItems[e.options.expanderIndex].header=t}})))}},destroy:function(){console.debug("ENONew: destroy")},_addNotif:function(e){console.debug(e),this.enableNotif&&this.dispatchEvent("onFacetNotification",[e])},onSubmit:function(t){var i=this;this.runClientBL(i.propModel).then((function(n){if(n)t(!1);else{var a=function(n){if(!0===e.is(n,"array")){var a={};n.forEach((function(e){e&&e.error&&("error"===e.error.eventID?a[e.name]={notif:{sev:1,msg:e.error.message}}:i._addNotif({customClass:e.error.customClass,eventID:e.error.eventID,msg:e.error.message})),"error"===e.eventID&&(a[e.name]={notif:{sev:1,msg:e.message}})})),i.propUI.updateFormSection(a)}t(!1),i.updateValidStatus()},o=[];i.propModel.getAttributeFromField().forEach((function(e){e.visible&&o.push(e)})),i.propModel.lockModel(!0);var r=!i.validateForm();r?a(r):i.validationFromService((function(){var e=i._parseModel(i.data,i.propModel);t(e)}),a)}}))},updateForm(e){e&&e.attribute&&this.propUI.updateFormSection(e.attribute)},validateForm(){var e=this.propUI.validateModel([this.propModel]);return this.isFormValid=e,e},validationFromService:function(t,i){var n=this.attributesForValidationService,a=[];for(var o in n){var r=n[o],s=this.propModel.get(r);if(s&&s.visible){var l=new e.Promise((function(e,t){var i=s.validationService,n={name:s.name,value:s.valueDB};require([i],(function(t){t.validate(n,(function(t){e({name:s.name,error:t})}))}))}));a.push(l)}}e.Promise.all(a).then((function(e){var n=[];for(var a in e){var o=e[a];o&&o.error&&n.push(o)}0==n.length?t():i(n)})).catch((function(e){console.error("ENONew: validation service failed, proceeding for object creation"),t()}))},_buildAttributesModel:function(e){var t=this,i={},n=[];this.attributesForValidationService=[];var a=e.defaultAttributes,o=[];for(var s in a){var c=a[s];o.push(c)}if(o.length>0){var d=r._buildAttributesModel(o);n=n.concat(d)}var u=e[l.ATTRIBUTES],p=e[l.INTERFACES];if(u){var f=u[l.PUBLIC_ATTRIBUTES];if(f){d=r._buildAttributesModel(f,p);n=n.concat(d)}var h=u[l.EXTN_ATTRIBUTES];if(h){d=r._buildAttributesModel(h,p);n=n.concat(d)}var m=u[l.VOLATILE_ATTRIBUTES];if(m){d=r._buildAttributesModel(m,p,!0);n=n.concat(d)}for(var v in n){var g=n[v];if(this.persistAttribute[g.getIdentifier()]){var N=this.persistAttribute[g.getIdentifier()];g.set("value",N.value),g.set("valueDB",N.valueDB),g.set("isModified",!0),N.dimensionType&&(g.set("dimensionType",N.dimensionType),N.unitName&&g.set("unitName",N.unitName),N.dimension&&g.set("dimension",N.dimension))}var b=g.visibility;if(b)for(var s in b){var w={attrID:g.getIdentifier(),list:b[s],eventID:"onChange:"+s,callback:function(e,i){var n=this;console.debug("ENONew: visibility change ",i);var a=i.valueDB,o=!1;n.list.includes(a)&&(o=!0),setTimeout((function(){t.addAttributeOnUI(n.attrID,o)}),0)}};this.customEvents.push(w)}i[g.getIdentifier()]=g,g.validationService&&this.attributesForValidationService.push(g.getIdentifier())}}return i},addAttributeOnUI:function(e,t){var i=this.propModel;if(i&&i.get(e)&&(i.get(e).visible=t,this.propUI.elements.formSection.toggleFormOrgLine(e,t),this.updateValidStatus(),"3DPartTemplate"===e)){var n=this.buttons.Close;n&&(n.visibleFlag=t)}},_parseModel:function(e,t){if(t&&e){var i={},n=t.getAttributeFromField(),a=e.attributes,o=e.defaultAttributes;for(attrId in n)if(attrModel=n[attrId],attrModel.isModified){var s=attrModel.name,l=null,c=!1;if(attrModel.defaultAttribute)for(var d in o)(l=o[d]).name===s&&r._parseAttributeModels(l,attrModel);else if(a){var u=function(e,t){for(ind in t)if((l=t[ind]).name===e&&(c=!0),c)break};for(AttrGrp in a){if(u(s,a[AttrGrp]),c)break;l=null}null!=l&&r._parseAttributeModels(l,attrModel)}if(attrModel.isUIModified){var p={name:attrModel.name,value:attrModel.value,valueDB:attrModel.valueDB};attrModel.dimensionType&&(p.dimensionType=attrModel.dimensionType,attrModel.unitName&&(p.unitName=attrModel.unitName),attrModel.dimension&&(p.dimension=attrModel.dimension)),this.persistAttribute[attrModel.getIdentifier()]=p}}i.attributes=a,i.defaultAttributes=o;var f=e.interfaces;return f&&(i.interfaces=f),i}},getUI:function(){return this.propUI},getContentSize:function(){var e=this.propUI.getContent();if(e)return e.getSize()},_resizeHandler:function(){var e=this;this.propUI.elements.formSection.elements.container.addEvent("resize",(function(){e.isLoaded=!0,e.updateResizeHandler();var t=e.getContentSize();e.dispatchEvent("onResize",[t])}))}})})),define("DS/ENONewWidget/ENONew/View/Facet/ENOListViewFacet",["UWA/Core","DS/UIKIT/Scroller","DS/ENONewWidget/ENONew/View/Facet/ENONewFacetBase","DS/ENONewWidget/ENONew/View/ENOListView","DS/ENONewWidget/ENONew/View/Facet/ENONewFacetHelper"],(function(e,t,i,n,a){return i.extend({init:function(t){console.debug("ENONew: ENOListViewFacet init");var i=this;this._parent(t),this.skeleton=e.createElement("div",{class:"CreateFacet_container"});var a=t.events.onResize;t.events.onResize=function(e){a("ENOCreate",e)};var o=t.events.onChangeAttribute;t.events.onChangeAttribute=e=>{for(var t in e){var n=e[t];i.publishAttributeInfo(n)}o(e)},t.events.publishAttribute=this.publishAttributeInfo.bind(this),this.publishInfoForObjectInit(t),this.listview=new n(t),this.listview.propUI.inject(this.skeleton),this.listview.buildModel(t.data),this.listview.loadView()},updateFacet:function(e){this.publishInfoForObjectInit(e,!0),this.listview.buildModel(e.data),this.listview.loadView()},updateForm(e){this.listview.updateForm(e)},_getUI:function(){return this.skeleton},getUI:function(){return this.skeleton},publishInfoForObjectInit(t,i=!1){var n=this;setTimeout((function(){if(t.data){if(i||(n.publishInfo("tenant",t.data.tenant),n.publishInfo("service",t.data.service)),t.data.defaultAttributes&&(t.data.defaultAttributes.Type&&n.publishInfo("currentObjectType",{value:t.data.defaultAttributes.Type.value}),t.data.model)){var a=t.data.model.getSecurityContext(),o=t.data.model.getSecurityContextNLS();n.publishInfo("currentSecurityContext",{value:a,valueNLS:o}),t.data.model.addEvent("onChange:securityContext",(e=>{var t=e.getSecurityContext(),i=e.getSecurityContextNLS();console.debug("ENONew: publish currentSecurityContext ",t,i),n.publishInfo("currentSecurityContext",{value:t,valueNLS:i})}))}t.data&&t.data.attributes&&Object.keys(t.data.attributes).forEach((i=>{var a=t.data.attributes[i];"internalAttributes"!==i&&a&&a.forEach((t=>{if(t){var i={};e.is(t.valueDB)&&(i.value=t.valueDB),e.is(t.value)&&(i.value=t.value),e.is(t.unitName)&&(i.unitName=t.unitName),n.publishInfo(t.name,i)}}))}))}}))},publishAttributeInfo(t){if(t){var i=t.name,n={value:t.valueDB};"SecurityContext"===i?(i="currentSecurityContext",n.valueNLS=t.value):"Type"===i?i="currentObjectType":e.is(t.unitName)&&(n.unitName=t.unitName),this.publishInfo(i,n)}},onSubmit:function(e,t){this.listview.onSubmit(t)},postCreation(t){return this.listview.disableInputFields(),new e.Promise((function(e){e({name:a.getDefaultFacetName()})}))},onComplete:function(t){return new e.Promise((function(e){e({name:a.getDefaultFacetName()})}))},destroy:function(){this.listview.destroy(),this._parent()}})})),define("DS/ENONewWidget/ENONew/View/ENOTabView",["UWA/Core","UWA/Controls/Abstract","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/UI/IDCardSkeleton","DS/EditPropWidget/models/OccurrenceModel","DS/ENONewWidget/ENONew/View/Facet/ENONewFacetHelper"],(function(e,t,i,n,a,o){var r=t.extend({init:function(t){this.opts=t,this._parent(t),this.sharedInfo={},this.skeleton=e.createElement("div",{class:"ENONewTab_container",styles:{width:"100%",height:"100%"}}),this.facets=t.facets,this.setupDefaultFacet()},setupDefaultFacet:function(){var e=this,t=this._getFacetFromName(o.getDefaultFacetName());t.options.events={};t.options.events.onResize=function(t,i){if(o.getDefaultFacetName()===t&&e.idCardSkeleton.currentFacetName===t){var n={height:e.idCardSkeleton.elements.container.getSize().height,width:i.width};e.dispatchEvent("onResize",[n]),e.isLoaded=!0}},t.options.events.onChangeAttribute=function(t){e.dispatchEvent("onChangeAttribute",arguments)},t.options.events.onEnterKeyDown=function(){e.dispatchEvent("onEnterKeyDown")},t.options.events.onFacetNotification=function(t){e.dispatchEvent("onFacetNotification",[t])},t.options.events.onValidActivation=function(t){e.dispatchEvent("onValidActivation",[t])},t.options.events.runBLForUI=function(){e.dispatchEvent("runBLForUI",arguments)}},_getFacetFromName:function(e){return this.facets.find((t=>t.facet.name===e))},buildModel:function(e){console.log(e)},loadView:function(e){var t=this,r={name:"ENONew tab_content",className:"ENONew_TabView_MasterContain",typeOfDisplay:i.ONLY_EDIT_PROPERTIES,selectionType:i.NO_SELECTION,readOnly:!1,extraNotif:!1,showIdCard:!1,closeButton:!1,showTopBar:!1};r.sharedContext=new a,r.sharedContext.addInfo=function(e,i,n){if(e&&i){t.sharedInfo[e]||(t.sharedInfo[e]={}),t.sharedInfo[e][i]=n;var a=e===o.getDefaultFacetName()?"":e;r.sharedContext.dispatchEvent("publishinfo."+a,[i,n])}},r.sharedContext.getInfo=function(e,i){if(e)return i||(i=o.getDefaultFacetName()),t.sharedInfo[i][e]},r.sharedContext.subscribeInfo=function(e,t){var i=t===o.getDefaultFacetName()?"":t||"";r.sharedContext.addEvent("publishinfo."+i,e)},r.sharedContext.setValidation=function(e,i){t.evaluateFacetIcon(e),t.dispatchEvent("refreshValidationStatus")},this.idCardSkeleton=new n(this.facets,r),this.idCardSkeleton.elements.container.inject(this.skeleton),this.idCardSkeleton.subscribeEvt("facetLoaded",(t=>{t&&o.getDefaultFacetName()===t.facet.name&&e()})),this.idCardSkeleton._manageFacetVisibility(),this.idCardSkeleton.elements.tabs.addEventListener("tabButtonClick",(function(e){var i=e.options.value,n=t._getFacetFromName(i);t.dispatchEvent("onTabChange",[n])}))},loadFacet:function(e,t,i){this.idCardSkeleton._loadFacet(e,t,i)},refreshView:function(){this.idCardSkeleton.selectFacet(o.getDefaultFacetName())},evaluateFacetValidation(){return!this.facets.find((t=>t.content&&e.is(t.content.facetValidation,"boolean")&&!t.content.facetValidation))},evaluateFacetIcon(e){var t=this._getFacetFromName(e);t&&(t.errors||t.content&&!t.content.facetValidation?this.updateTabIconToError(t.facet.name):this.resetTabIconToError(t.facet.name))},updateTabIconToError(e){this.idCardSkeleton.updateTabIcon(e,"wux-ui-3ds wux-ui-3ds-error")},resetTabIconToError(e){this.idCardSkeleton.updateTabIcon(e,this._getFacetFromName(e).facet.icon)},showFacetError(e,t){this.idCardSkeleton.showInlineFacetErrors(e,t)},destroyFacetErrors(e){this.idCardSkeleton.destroyInlineFacetErrors(e)},updatePropertiesForm(e){var t=this._getFacetFromName(o.getDefaultFacetName());t&&t.content&&t.content.updateForm(e)},getUI:function(){return this._getUI()},_getUI:function(){return this.skeleton}});return r})),define("DS/ENONewWidget/ENONew/View/ENOWizardView",["UWA/Class/Events","UWA/Class/Promise","UWA/Controls/Abstract","UWA/Core","DS/EditPropWidget/models/OccurrenceModel","DS/ENONewWidget/ENONew/View/Facet/ENONewFacetHelper"],(function(e,t,i,n,a,o){return i.extend(e,{name:"DS/ENONewWidget/ENONew/View/facet/wizardView",isLoaded:null,init:function(e){var t=this;for(var i in this.options=e,t._parent(e),t.navigator={container:null,toggler:null},t.content={container:null},t.activeView="",t.activeMode="multi-step",this._sharedOptions={},this.facets=e.facets,e.events)this.addEvent(i,e.events[i]);var r=new a;this.setContext(r),r.addInfo=function(e,t,i){},r.getInfo=function(e,t){},r.subscribeInfo=function(e,t){var i=t===o.getDefaultFacetName()?"":t||"";r.addEvent("publishinfo."+i,e)},r.setValidation=function(){t.dispatchEvent("refreshValidationStatus")},t.setupDefaultFacet(),t.addEvent("onTabChange",e.events.onTabChange),this.skeleton=n.createElement("div",{class:"create-view-body multi-step",styles:{width:"100%",height:"100%"}})},setupDefaultFacet:function(){var e=this,t=this._getFacetFromName(o.getDefaultFacetName());t.options.events={};var i=!0;t.options.events.onResize=function(t){if(i){i=!1;var n=e.navigator.container.getSize(),a={height:t.height+n.height+8,width:n.width};e.dispatchEvent("onResize",[a]),e.setRopeLength(e.activeView)}e.isLoaded=!0},t.options.events.onChangeAttribute=function(t){e.dispatchEvent("onChangeAttribute",[t])},t.options.events.onEnterKeyDown=function(){e.dispatchEvent("onEnterKeyDown")},t.options.events.onFacetNotification=function(t){e.dispatchEvent("onFacetNotification",[t])},t.options.events.onValidActivation=function(t){e.dispatchEvent("onValidActivation",[t])}},loadView:function(e){var t=this;t.navigator.container=n.createElement("nav",{class:"create-view-navigator-container"}).inject(t.skeleton),n.createElement("div",{class:"evolve-container",html:[n.createElement("div",{class:"evolve-rope-placeholder"}),n.createElement("div",{class:"evolve-rope"})]}).inject(t.navigator.container);var i=n.createElement("nav",{class:"create-view-navigator"}).inject(t.navigator.container);t.facets.forEach((function(e){if(e.facet){var n=t._tabItem(e.facet);e.navItem=n,n.container.inject(i)}})),t.content.container=n.createElement("div",{class:"create-view-content"}).inject(t.skeleton),t.facetContainer=n.createElement("div",{class:"wizardFacetContainer",styles:{width:"100%",height:"100%"}}).inject(t.content.container),t.addEvent("facetLoaded",(t=>{t&&o.getDefaultFacetName()===t.facet.name&&e()})),t.switchView(o.getDefaultFacetName())},getContext:function(){return this._sharedContext},setContext:function(e){this._sharedContext=e},refreshView:function(){this.switchView(o.getDefaultFacetName())},_tabItem:function(e){var t=this,i={};return i.container=n.createElement("a",{id:e.name,class:"nav-item"}),i.container.addEventListener("dragover",(function(){t.switchView(e.name)})),i.activeIndicator=n.createElement("div",{class:"nav-item-active-indicator"}).inject(i.container),n.createElement("span",{class:"fonticon fonticon-expand-down"}).inject(i.activeIndicator),i.circle=n.createElement("div",{class:"nav-item-circle"}).inject(i.container),n.createElement("span",{class:"fonticon fonticon-"+e.icon}).inject(i.circle),i.label=n.createElement("div",{class:"nav-item-label",html:e.text}).inject(i.container),i},switchView:function(e){var t=this,i=this.activeView;if(t.navigator&&t.navigator.container&&e){var n=t.navigator.container.getElements("a"),a=!1;n.forEach((function(n){!1===a?n.removeClassName("filled").addClassName("filled"):n.removeClassName("filled"),n.id===i&&n.removeClassName("active"),n.id===e&&(n.addClassName("active"),t.setRopeLength(e),a=!0)}))}var o=this._getFacetFromName(i);o&&o.content&&o.content.hide();var r=this._getFacetFromName(e);r&&r.content?r.content.show():t._loadFacet(r,!0,(function(){r.content&&r.content.setContext(this._sharedContext),console.log("Done loading facet")})),t.activeView=e,t.dispatchEvent("onTabChange",[r])},setRopeLength:function(e){var t=this;if(e){var i=t._getFacetFromName(e).navItem.circle;if(i){var n=i.getDimensions().outerWidth,a=(i.getPosition().x-10+n)/t.navigator.container.getSize().width*100;t.navigator.container.getElement(".evolve-rope").setStyles({width:a+"%",height:"2px"})}}},loadFacet:function(e,t,i){this._loadFacet(e,t,i)},_loadFacet:function(e,t,i){var n=this,a="loading";if(e&&e.content!==a)if(e.content)i.call(n);else{e.content=a;var o=++window.top.perfoIncrem;window.top.performance.mark("start_prereqFacet:"+o),require([e.require],(function(a){window.top.performance.mark("end_prereqFacet:"+o),e.content=null;var r=n.activeView,s=e.facet.name===r;if(!t||s){var l=e.options?e.options:{},c=l.events?l.events:{};l.events=c,e.options=l,e.options.tabId=e.facet.name,e.options.eventThread=n.options.eventThread+"."+e.facet.name,e.content=new a(e.options,n._sharedOptions);var d=e.content.getUI(),u="function"==typeof d.addClassName?d:d.container?d.container:d.elements?d.elements.container:null;u&&u.addClassName("ENONew_wizard_Container ENONew_wizard_"+e.facet.name),e.content.getUI().inject(n.facetContainer),s||e.content.hide(),n.dispatchEvent("facetLoaded",e),i.call(n)}}))}},_getFacetFromName:function(e){return this.facets.find((t=>t.facet.name===e))},_getFacetIndexFromName:function(e){return this.facets.findIndex((t=>t.facet.name===e))},getActiveFacet:function(){return this._getFacetFromName(this.activeView)},isFirstFacet:function(e){return 0===this._getFacetIndexFromName(e)},isLastFacet:function(e){return this._getFacetIndexFromName(e)===this.facets.length-1},switchToRelativeFacet:function(e){var t=this.activeView,i=this._getFacetIndexFromName(t),n=this.facets[i+e];this.switchView(n.facet.name)}})})),define("DS/ENONewWidget/ENONew/Controller/ENONewDialogController",["UWA/Controls/Abstract","DS/Windows/ImmersiveFrame","DS/Controls/ComboBox","DS/Controls/Button","DS/Windows/Dialog","DS/Controls/ModalLoader","DS/ENONewWidget/ENONew/Events","DS/ENONewWidget/ENONew/View/ENOListView","DS/ENONewWidget/ENONew/View/ENOTabView","DS/ENONewWidget/ENONew/View/TabUtility","DS/ENONewWidget/ENONew/View/ENOWizardView","DS/ENONewWidget/ENONew/View/Facet/ENONewFacetHelper","i18n!DS/ENONewWidget/assets/nls/ENONewWidgetNls"],(function(e,t,i,n,a,o,r,s,l,c,d,u,p){var f=e.extend({init:function(e,i){this._parent(e),console.debug("ENONew DialogController init"),this.immersiveFrame=new t({}),this.immersiveFrame.inject(widget.body),this.createOptsModel=i,this.userPrefs={},this.footerButtons={}},setup:function(e,t,i,n,a){var o=this;for(eventID in o.dialogContainer=UWA.createElement("div",{class:"ENONewInfra DialogContainer"}),o.elements.dialogContainer=o.dialogContainer,n=n||{}){var r=n[eventID];this.addEvent(eventID,r)}if(o.noCreateAccess=t.noCreateAccess,o.ServiceCallback=a,this.viewType="listView",t){o.prefs=e.prefs,t.facets&&t.facets.length&&t.viewType&&(this.viewType=t.viewType,this.facets=u.getFacetList(e,t.facets,{securityContext:t.securityContext,tenant:t.tenant,buttons:o.footerButtons})),this.identifier=t.persistId?t.persistId:"ENONew_Id";var s=o.getDefaultButtons(this.viewType,t);if(s&&Object.assign(o.footerButtons,s),i&&Object.assign(o.footerButtons,i),t.activateDraftMode&&t.activateDraftMode.show){var l=o.buildDraftModeButton({preference:t.activateDraftMode.preference,optionsList:o.prefs?o.prefs.createBtn:[]});l&&(o.footerButtons.createBtnCombo=l,o.footerButtons.Ok.hide())}var c=o.buildContent(e,t),d=o.buildToolbar(t,e.prefs);UWA.Promise.all([d,c]).then((function(e){var i=UWA.createElement("div",{class:"ENONewInfra ToolbarContainer"});i.inject(o.dialogContainer),o.elements.toolbarContainer=i,o.toolbar=e[0],o.toolbar&&o.toolbar.inject(i);var n=UWA.createElement("div",{class:"ENONewInfra ContentContainer"});n.inject(o.dialogContainer),o.elements.contentContainer=n,e[1].skeleton.inject(n);var a={identifier:o.identifier,title:t.title?t.title:p.CreateNew,modalFlag:t.overlay,maximizedFlag:!(!o.createOptsModel||!o.createOptsModel.isWebInWin),content:o.dialogContainer,width:580,position:{my:"top",at:"top",offsetY:90,collision:"fit"},buttons:o.footerButtons,escapeButton:o.footerButtons.Discard};t.showCreateAnother&&(a.checkboxInfos={label:p.get("repeatCheckbox"),checkFlag:t.activateCreateAnother,tooltipInfos:{shortHelp:p.get("repeatToolTip")}}),o.myDialog=o.buildDialog(a),o.manageButtons(),o.footerButtons.createBtnCombo&&o.footerButtons.createBtnCombo.inject(o.myDialog.elements._buttonsDiv,"top")})).catch((function(e){console.error(e)}))}},buildDialog:function(e){var t=this;e.resizableFlag=!0,e.immersiveFrame=this.immersiveFrame,e.activeFlag=!0;var i=new a(e);return i.addEventListener("close",(function(){t.dispatchEvent("onClose")})),this.disableBtnClickOnEnter=!1,i.addEventListener("keydown",(function(e){13===e.keyCode?t.disableBtnClickOnEnter=!0:27===e.keyCode&&(t.onEscKeyDown=!0)})),i.addEventListener("keyup",(function(e){13===e.keyCode?(t.onEnterKeyDown=!1,t.disableBtnClickOnEnter=!1):27===e.keyCode&&(t.onEscKeyDown=!1,t.dispatchEvent("onClose"))})),i},buildContent:function(e,t,i){var n=this,a=!0;return new UWA.Promise((function(t){if("listView"===n.viewType)n.View=new s({identifier:n.identifier,events:{onChangeAttribute:function(e){n.dispatchEvent("onChangeAttribute",arguments)},onFacetNotification:function(e){n._addNotif(e)},onValidActivation:function(e){n.isPropertiesFormValid=e,n.evaluateValidationStatus()},onEnterKeyDown:function(){n.onEnterKeyDown=!0},runBLForUI:function(){n.dispatchEvent("runBLForUI",arguments)},onResize:function(e){var t="resize";a&&(a=!1,t="ready",n.View.focusFirstLine(),setTimeout((function(){n.myDialog.minHeight=n.myDialog.elements._footerDiv.offsetHeight+80})));var i=parseInt(n.myDialog.elements._contentDiv.getStyle("padding").replace("px","")),o=e.height+n.elements.toolbarContainer.getSize().height+n.myDialog.elements._footerDiv.getSize().height+i;r.dispatchEvent("onCreationDialogAction",[{action:t,dimension:{width:e.width,height:o}},"undefined"!=typeof dscef?n:void 0])}},buttons:n.footerButtons}),n.View.buildModel(e),n.View.loadView(),t(n.View);else{var i={identifier:n.identifier,facets:n.facets,buttons:n.footerButtons,events:{onTabChange:function(e){n.manageButtons(e)},onChangeAttribute:function(e){n.dispatchEvent("onChangeAttribute",[e])},onFacetNotification:function(e){n._addNotif(e)},onValidActivation:function(e){n.isPropertiesFormValid=e,n.evaluateValidationStatus()},onEnterKeyDown:function(){n.onEnterKeyDown=!0},runBLForUI:function(){n.dispatchEvent("runBLForUI",arguments)},onResize:function(e){var t="resize";a&&(a=!1,t="ready",setTimeout((function(){n.myDialog.minHeight=n.myDialog.elements._footerDiv.offsetHeight+80})));var i=parseInt(n.myDialog.elements._contentDiv.getStyle("padding").replace("px","")),o=e.height+n.elements.toolbarContainer.getSize().height+n.myDialog.elements._footerDiv.getSize().height+i;r.dispatchEvent("onCreationDialogAction",[{action:t,dimension:{width:e.width,height:o}},"undefined"!=typeof dscef?n:void 0]),n.myDialog._getDimensionsFromPreferences()},refreshValidationStatus:function(){n.evaluateValidationStatus()}}};"tabView"===n.viewType?n.View=new l(i):"wizardView"===n.viewType&&(n.View=new d(i)),n.View.loadView((()=>{t(n.View)}))}}))},buildToolbar:function(e,t){var i=this;return new UWA.Promise((function(n){if(e&&e.activatelock&&e.activatelock.show){var a=!1;function o(e){return"LOCK"===e?{class:"ENONew-lock-class",icon:"key",label:p.get("locked")}:{class:"ENONew-lock-open-class",icon:"lock-open",label:p.get("unlocked")}}e.activatelock.preference?a=e.activatelock.preference:t&&t.lockState&&(a=t.lockState),i.userPrefs.isLock=a,require(["DS/Tweakers/GeneratedToolbar"],(function(e){let t=o(a);var r={entries:[{id:"toolbarLock_Btn",onNodeUpdate:function(){},dataElements:{typeRepresentation:"function",icon:{iconName:t.icon,fontIconFamily:1,className:t.class},position:"far",category:"2",label:t.label,value:function(e){let t="key"===e.context.nodeModel.getAttributeValue("semantics").icon.iconName?"UNLOCK":"LOCK",n=o(t);i.userPrefs.isLock=t,e.context.nodeModel.setLabel(n.label),e.context.toolbar.updateNodeModel("toolbarLock_Btn",{grid:{semantics:{icon:{iconName:n.icon,fontIconFamily:1,className:n.class}}}})}}}]},s=e.prototype.createTreeDocument(r);s.onNodeModelUpdate((function(e){if("lock_btn"===e.data.nodeModel._ID&&e.data.attributes.hasOwnProperty("data")){var t=o(e.data.nodeModel.getAttributeValue("data"));e.target.setLabel(t.label)}}));var l=new e({executionContext:s,overflowManagement:"dropdown",direction:"horizontal",items:s});n(l)}))}else n()}))},showDialog:function(){this.myDialog.show()},addLoadingOverlay(e){this.myDialog&&o.displayModalLoader(this.myDialog.elements._contentDiv,e)},removeLoadingOverlay(e){this.myDialog&&o.removeModalLoader(this.myDialog.elements._contentDiv,e)},reloadContent:function(e){var t=this;if("listView"===this.viewType)t.View.buildModel(e),t.View.loadView();else{t.View.refreshView();var i=u.getDefaultFacetName();this.View.facets.forEach((function(t){if(t.content&&UWA.is(t.content.updateFacet,"function")){var n=t.options;e&&t.facet.name===i&&(n.data=e),t.content.updateFacet(n)}}))}this.resetButtonLabel(),this.disableFormInput(!1,!1,!0)},updateForm(e){"listView"===this.viewType?this.View.updateForm(e):this.View.updatePropertiesForm(e)},onSubmitDialog:function(e){var t=this,i=function(i){i&&!t.noCreateAccess?"create"!==e&&"createClose"!==e||t.dispatchEvent("onCreateBtnClick",[i,{eventID:e},t.getUserPreferences()]):(t.resetButtonLabel(),t.disableFormInput(!1,!1,!0))};"listView"===this.viewType?this.View.onSubmit(i):this.onSubmit(e,i)},getUserPreferences:function(){if(this.userPrefs&&Object.keys(this.userPrefs).length){var e={};return UWA.is(this.userPrefs.isLock)&&(e.toolbarIsLockEnabled=this.userPrefs.isLock),UWA.is(this.userPrefs.createBtn)&&(e.footerCreateBtnState=this.userPrefs.createBtn),e}},_addNotif:function(e){var t=e.msg,i=e.eventID,n=e.id?e.id:e.eventID;switch(i){case"error":t=t||e.json,this._addError(t,n);break;case"warning":this._addWarning(t,n);break;case"success":this._addSuccess(t,n);break;default:this._addInfo(t,n)}},_addInfo:function(e,t){var i=this;this._getErrorManager((function(n){var a=n.addInfo(e,t);i.dispatchEvent("onNotification",a)}))},_addWarning:function(e,t){var i=this;this._getErrorManager((function(n){var a=n.addWarning(e,t);i.dispatchEvent("onNotification",a)}))},_addSuccess:function(e,t){var i=this;this._getErrorManager((function(n){var a=n.addSuccess(e,t);i.dispatchEvent("onNotification",a)}))},_addError:function(e,t){var i=this;this._getErrorManager((function(n){var a=n.addError(e,t);i.dispatchEvent("onNotification",a)}))},_getErrorManager:function(e){var t=this;this.errorOverlay?e.call(null,this.errorOverlay):require(["DS/ErrorWidget/ErrorWidget"],(function(i){t.errorOverlay||(t.errorOverlay=new i(widget,t.myDialog.elements.container,{className:"newcontent_errorManager"})),e.call(null,t.errorOverlay)}))},getDefaultButtons:function(e,t){var i=this,n={},a=[];return"listView"===e||"tabView"===e?a=["Ok","Save","Discard"]:"wizardView"===e&&(a=["Ok","Reset","RestoreDefaults","Discard"]),a.forEach((function(e){n[e]=i.buildButton(e,t)})),n},buildDraftModeButton(e){var t,n=this;if(e&&e.optionsList&&e.optionsList.length){var a=[],o="";e.optionsList.forEach((t=>{a.push(t.nls),t.name===e.preference&&(o=t.nls)})),n.userPrefs.createBtn=e.preference,(t=new i({name:"createClose",emphasize:"primary",enableSearchFlag:!1,actionOnClickFlag:!0,elementsList:a,value:o})).addEventListener("click",(function(i){if(!n.disableBtnClickOnEnter||n.disableBtnClickOnEnter&&n.onEnterKeyDown){if(n.disableBtnClickOnEnter&&n.onEnterKeyDown&&"wizardView"===n.viewType)return void n.footerButtons.RestoreDefaults.onClick();n.userPrefs.createBtn=e.optionsList[t.selectedIndex].name,this.permanentDisable=!0,n.disableFormInput(),i.dsModel.label=p.creatingButton,n.myDialog.checkboxInfos&&n.myDialog.checkboxInfos.checkFlag?n.onSubmitDialog("create"):n.onSubmitDialog("createClose")}})),t.elements.mainElement.addClassName("wux-ui-state-primary"),t.elements.expander.addClassName("wux-ui-state-primary"),t.elements.expander.setStyle("margin-left",0)}return t},manageButtons:function(e){var t=this;if("wizardView"===this.viewType&&t.View){var i=t.View.getActiveFacet(),n=t.View.isFirstFacet(i.facet.name),a=t.View.isLastFacet(i.facet.name);t.footerButtons.Reset.visibleFlag=!n,t.footerButtons.RestoreDefaults.visibleFlag=!a,t.footerButtons.Ok.visibleFlag=a}this.myDialog&&this.myDialog.buttons&&this.myDialog.buttons.Save&&(this.myDialog.buttons.Save.visibleFlag=!!this.facetFailure,t.footerButtons.createBtnCombo?t.footerButtons.createBtnCombo.visibleFlag=!this.facetFailure:t.footerButtons.Ok.visibleFlag=!this.facetFailure),this.toolbar&&(this.toolbar.disabled=!!this.facetFailure)},_evaluateValidationStatus(){var e=!0;return"tabView"===this.viewType&&(e=this.View.evaluateFacetValidation()),e&&!this.isPropertiesFormValid&&(e=!1),e},evaluateValidationStatus:function(){let e=this._evaluateValidationStatus();this.disableSubmitButton(!e)},buildButton:function(e,t){var i,a=this;switch(e){case"Ok":i=new n({name:"createClose",label:p.createCloseBtn,onClick:function(e){if(!a.disableBtnClickOnEnter||a.disableBtnClickOnEnter&&a.onEnterKeyDown){if(a.disableBtnClickOnEnter&&a.onEnterKeyDown&&"wizardView"===a.viewType)return void a.footerButtons.RestoreDefaults.onClick();this.permanentDisable=!0,a.disableFormInput(),e.dsModel.label=p.creatingButton,a.myDialog.checkboxInfos&&a.myDialog.checkboxInfos.checkFlag?a.onSubmitDialog("create"):a.onSubmitDialog("createClose")}}});break;case"Save":i=new n({name:"SaveCreatedObject",label:p.saveBtn,onClick:function(e){if(!a.disableBtnClickOnEnter||a.disableBtnClickOnEnter&&a.onEnterKeyDown){if(a.disableBtnClickOnEnter&&a.onEnterKeyDown&&"wizardView"===a.viewType)return void a.footerButtons.RestoreDefaults.onClick();this.permanentDisable=!0,a.disableFormInput(),e.dsModel.label=p.saveBtnLoading;var t=a.myDialog&&a.myDialog.checkboxInfos&&a.myDialog.checkboxInfos.checkFlag?"save":"saveClose";a.dispatchEvent("onCreateBtnClick",[{},{eventID:t}])}}});break;case"draftModeButton":i=a.buildDraftModeButton(t.activateDraftMode);break;case"Discard":i=new n({name:"close",label:p.closeBtn,onClick:function(e){a.dispatchEvent("onClose")}});break;case"Reset":i=new n({name:"previous",label:p.previousBtn,onClick:function(e){UWA.is(a.View.switchToRelativeFacet,"function")&&a.View.switchToRelativeFacet(-1)}});break;case"RestoreDefaults":i=new n({name:"next",label:p.nextBtn,onClick:function(e){UWA.is(a.View.switchToRelativeFacet,"function")&&a.View.switchToRelativeFacet(1)}})}return i},disableRepeatButton(e=!0){this.myDialog&&this.myDialog.elements&&this.myDialog.elements._checkbox&&(this.myDialog.elements._checkbox.disabled=e)},disableSubmitButton:function(e=!0){if(this.noCreateAccess&&(e=!0),this.footerButtons)for(var t in this.footerButtons){var i=this.footerButtons[t];i&&("Ok"!=i.value&&"Save"!=i.value&&"createBtnCombo"!==t||(i.disabled=e))}},disableFormInput:function(e=!0,t=!0,i=!1){this.disableSubmitButton(e),this.disableRepeatButton(t),i?this.removeLoadingOverlay():this.addLoadingOverlay()},resetButtonLabel(){if(this.manageButtons(),this.footerButtons)for(var e in this.footerButtons){var t=this.footerButtons[e];t&&("Ok"===t.value?t.label=p.get("createCloseBtn"):"Apply"===t.value?t.label=p.get("createBtn"):"Save"===t.value&&(t.label=p.get("saveBtn")))}},onSubmit:function(e,t){this.View.facets[0].content.onSubmit(e,t)},completeFacetTasks:function(e,t){var i=this;if("listView"===this.viewType)t();else{var n=e.result;this.facetData||(this.facetData={});var a={};this.facetDependency||(this.facetDependency=c.buildFacetDependencyMap(this.View.facets));var o=this.facetDependency.dependencyMap,r=this.independentFacetList;r||(r=new Set(this.facetDependency.independentFacets)),function e(){var s=[];r.forEach((function(e){var t=i.View._getFacetFromName(e);if(t.content&&UWA.is(t.content.postCreation,"function")){var o=UWA.clone(n),r=t.content.postCreation(o,a);r&&(r.then((function(e){i.markComplete(t.facet,e,i.facetData,a)})),s.push(r))}})),UWA.Promise.allSettled(s).then((function(n){if(Object.keys(a).length>0)i.facetFailure=!0,errorenousFacetsList=new Set(Object.keys(a)),i.independentFacetList=errorenousFacetsList,i.resetButtonLabel(),i.disableFormInput(!1,!1,!0),i.evaluateValidationStatus(),i.showFacetErrorNotif(errorenousFacetsList);else{var s=new Set;r.forEach((e=>{if(o[e]){var t=o[e].from;t&&t.forEach((t=>{var i=o[t].to;i&&(i.delete(e),0==i.size&&s.add(t))}))}})),(r=s).size>0?e():(i.facetFailure=!1,t(i.facetData),i.facetData=void 0,i.independentFacetList=void 0)}})).catch((function(e){console.error("ENONew : postCreation failed"),i.facetFailure=!1,t(i.facetData),i.facetData=void 0,i.independentFacetList=void 0}))}()}},markComplete:function(e,t,i,n){var a=this,o=e.name,r=a.View._getFacetFromName(o);console.debug("ENONew: markComplete "+o,t),t&&(i[o]={facetNLS:e.text,info:t},"error"===t.status?(a.View.evaluateFacetIcon(o),t.errors&&t.errors.length>0&&(n[o]=UWA.clone(t.errors),"ENONEW_FACETS_POSTCREATION"===t.errors[0].errorCode&&(r.errors=t.errors,"tabView"===a.viewType&&a.View.showFacetError(o,t.errors[0].errorMessages[0])))):r&&r.errors&&(delete r.errors,a.resetFacetError(o)))},getFacetData(){return this.facetData},showFacetErrorNotif(e){var t;if(e){var i="";let n=this.getFacetData();e.forEach((e=>{n&&n[e]&&(e=n[e].facetNLS),""!==i&&(i+=", "),i+=e})),t=1==e.size?p.get("tabsErrorNotif_single",{tab_name:i}):p.get("tabsErrorNotif_multiple",{multiple_tab_names:i}),UWA.is(t)&&this._addError(t)}},resetFacetError(e){this.View.evaluateFacetIcon(e),this.View.destroyFacetErrors(e)},destroy:function(){this.View&&this.View.destroy&&this.View.destroy(),this.myDialog&&this.myDialog.destroy(),this.immersiveFrame&&this.immersiveFrame.destroy(),this._parent()}});return f})),define("DS/ENONewWidget/utils/CredentialList",["DS/ENONewWidget/ajaxRequests/WebReq"],(function(e){"use strict";const t=e=>e.reduce((function(e,i){return e.concat(Array.isArray(i)?t(i):i)}),[]);return{loadCredentials:i=>new UWA.Class.Promise(((n,a)=>{e.get("/resources/modeler/pno/person",{tenant:i,params:{current:"true",select:"collabspaces&select=preferredcredentials"}}).then((e=>n((e=>{let i=[];if(!UWA.is(e.collabspaces,"array"))return i;let n=[...new Set(t(e.collabspaces.map((e=>e.couples.map((e=>e.organization.name))))))].length>1;return e.collabspaces.forEach((e=>{e.couples.forEach((t=>{var a=null==t.role.nls||""==t.role.nls?t.role.name:t.role.nls,o=t.role.name,r=t.organization.name,s=t.organization.title,l=e.name,c=e.title?e.title:e.name;let d=n?c+"  "+s+"  "+a:c+"  "+a,u="ctx::"+o+"."+r+"."+l;i.push({displayName:d,ctx:u})}))})),i.sort(((e,t)=>e.displayName.localeCompare(t.displayName,void 0,{numeric:!0,sensitivity:"base"})))})(e))))})),loadCreateCredentials:(t,i,n)=>new UWA.Promise(((a,o)=>{e.get("/resources/vplmte/getcreatectx",{tenant:t,params:n?{type:i,policy:n}:{type:i}}).then((e=>a(e))).catch((e=>o(e)))})),filterCredentials:(t,i,n)=>new UWA.Class.Promise(((a,o)=>{e.post("/resources/lifecycle/util/filterValidSCs",((e,t)=>{let i={Command:t,SecurityContexts:e.map((e=>e.ctx))};return JSON.stringify(i)})(i,n),{tenant:t}).then((e=>{e.status&&"success"===e.status?a(e.data.filter((e=>!(e=>{let t=e.match(/(ctx::)([^.]+)/);return t.length>2&&"VPLMAdmin"===t[2]})(e)))):o(e.error?e.error:"/resources/lifecycle/util/filterValidSCs - failed!")})).catch(o)}))}})),define("DS/ENONewWidget/ENONew/Controller/CredentialsManager",["UWA/Controls/Abstract","DS/ENONewWidget/utils/CredentialList","DS/ENONewWidget/ajaxRequests/ENONewAjaxRequests","DS/ENONewWidget/utils/ENONewConstants","DS/WebUAUtils/WebUAUtils","i18n!DS/ENONewWidget/assets/nls/ENONewWidgetNls"],(function(e,t,i,n,a,o){return e.extend({init(e,t){this._parent(e),this.createOptions=t,this.model=e.model,this.userSelection={}},getValidPreferredCredential(e){var t=this;return new UWA.Promise((async(i,n)=>{var a=t.model.getSecurityContext();if(!a){var o=await t.getCredentials(e).catch((e=>n(e)));o&&o[0]&&o[0].ctxname&&(a="ctx::"+o[0].ctxname,t.model.setSecurityContext(a))}i(a)}))},getCredentialsAttribute(e){var t=this;return new UWA.Promise((async(i,n)=>{var a={},o=await t.getCredentials(e).catch((e=>n(t.getError("NoCreateCredential")))),r=t.getProjectAttribute(o);r?a.project=r:this.model.get("context")&&this.model.get("context").isAdminUser||n(t.getError("NoCreateCredential"));var s=t.getOrganisationAttribute(o,r?r.value:void 0);if(s&&(a.organisation=s),t.isCSE){var l=t.getRoleAttribute(o,r?r.value:void 0,s?s.value:null);l&&(a.role=l)}i(a)}))},setCurrentProject(e){this.userSelection.project=e},getCurrentProject(){return this.userSelection.project},setCurrentOrg(e){this.userSelection.org=e,this.updateSecCtx()},getCurrentOrg(){return this.userSelection.org},setCurrentRole(e){this.userSelection.role=e,this.updateSecCtx()},getCurrentRole(){return this.userSelection.role},getProjectAttribute(e){var t=this.getProjectList(e);if(t&&t.authValues.size<1)return;var i=Array.from(t.authValues),r=Array.from(t.authValuesNls);let s=1==this.getPrjCount(e);var l=this.getPreferredProjectValue();s?l=i[0]:t.authValues.has(l)||(l="");var c={helpid:n.ATTR_PROJECT,content:{}};c.content[n.ATTR_PROJECT+".WebHelp"]="EXP3DBasicsUserMap/exp3dconcept-c-collaborative-spaces.htm";var d=a.getMoreHelpCallback(c),u={name:n.ATTR_PROJECT,nls:o.project,value:l||"",range:i,rangeNLS:r,visible:!0,disable:s,positionUI:1,positionGroup:8,defaultAttribute:!0,sortedOptions:!0,mandatory:!0,dropdownMode:"click",placeholder:o.get("placeholder_project"),tooltipInfo:{title:o.get("PrjHelp_title"),shortHelp:o.get("PrjHelp_short"),longHelp:o.get("PrjHelp_long"),moreHelpCB:d}};return this.setCurrentProject(u.value),this.updateSecCtx(),u},getOrganisationAttribute(e,t){if(!(this.getOrgCount(e)<2)){var i={helpid:n.ATTR_ORGANISATION,content:{}};i.content[n.ATTR_ORGANISATION+".WebHelp"]="EXP3DBasicsUserMap/exp3dconcept-c-collaborative-spaces.htm";var r=a.getMoreHelpCallback(i),s={name:n.ATTR_ORGANISATION,nls:o.organisation,positionUI:2,positionGroup:8,defaultAttribute:!0,sortedOptions:!0,mandatory:!0,dropdownMode:"click",placeholder:o.get("placeholder_org"),tooltipInfo:{title:o.get("OrgHelp_title"),shortHelp:o.get("OrgHelp_short"),longHelp:o.get("OrgHelp_long"),moreHelpCB:r}},l=this.getPreferredOrgValue(),c=this.getOrgListForProject(t,e);return c&&c.authValues&&c.authValues.size>0&&c.authValuesNls?(s.range=Array.from(c.authValues),s.rangeNLS=Array.from(c.authValuesNls),t&&1!=c.authValues.size||(s.disable=!0),s.disable&&1==c.authValues.size?l=s.range[0]:c.authValues.has(l)&&t||(l=""),s.value=l):s.visible=!1,this.setCurrentOrg(s.value),s}},updateOrgAttribute(e){var t=this.model.getCredentialList(),i=this.getOrgListForProject(e,t),n=Array.from(i.authValues),a=Array.from(i.authValuesNls);let o=n.length<2,r=o?n[0]:"";var s={authorizedValues:n,authorizedValuesNLS:a,disable:o,value:r,forceValue:!0};return this.setCurrentOrg(r),s},getRoleAttribute(e,t,i){if(!(this.getRoleCount(e)<2)){var r={helpid:n.ATTR_ROLE,content:{}};r.content[n.ATTR_ROLE+".WebHelp"]="EXP3DBasicsUserMap/exp3dconcept-c-collaborative-spaces.htm";var s=a.getMoreHelpCallback(r),l={name:n.ATTR_ROLE,nls:o.role,positionUI:3,positionGroup:8,defaultAttribute:!0,sortedOptions:!0,mandatory:!0,dropdownMode:"click",placeholder:o.get("placeholder_role"),tooltipInfo:{title:o.get("RoleHelp_title"),shortHelp:o.get("RoleHelp_short"),moreHelpCB:s}},c=this.getPreferredRoleValue(),d=this.getRoleList(t,i,e);return d&&d.authValues&&d.authValues.size>0&&d.authValuesNls?(l.range=Array.from(d.authValues),l.rangeNLS=Array.from(d.authValuesNls),t&&void 0!==i&&1!=d.authValues.size||(l.disable=!0),l.disable&&1==d.authValues.size?c=l.range[0]:d.authValues.has(c)&&t&&void 0!==i||(c=""),l.value=c):l.visible=!1,this.setCurrentRole(l.value),l}},updateRoleAttribute(e,t){var i=this.model.getCredentialList(),n=this.getRoleList(e,t,i),a=Array.from(n.authValues),o=Array.from(n.authValuesNls);let r=1==a.length||!t||!e,s=r&&1==a.length?a[0]:"";var l={authorizedValues:a,authorizedValuesNLS:o,disable:r,value:s,forceValue:!0};return this.setCurrentRole(s),l},getCredentials(e){var i=this;return this.getCredentialsPromise||(this.getCredentialsPromise=new UWA.Promise((async(n,a)=>{var o=i.model.getCredentialList();if(o)n(o);else{let o=i.model.getTenant(),r=i.model.getPolicy();t.loadCreateCredentials(o,e,r).then((function(e){if(e&&UWA.is([e.credentials],"array")){var t=e.credentials.filter((e=>!!e.prjname));i.model.setCredentialList(t),e.isOOTB&&(i.isCSE="TRUE"!==e.isOOTB.toUpperCase()),n(t)}else n([])})).catch((e=>{e&&e.response&&e.response.error?n([]):a(e)}))}}))),this.getCredentialsPromise},getPreferredProjectValue(){let e=this.model.getSecurityContext();if(e)return e.split(".")[2]},getPreferredOrgValue(){let e=this.model.getSecurityContext();if(e)return e.split(".")[1]},getPreferredRoleValue(){let e=this.model.getSecurityContext();if(e){let t=e.split(".")[0];return t.startsWith("ctx::")?t.replace("ctx::",""):t}},updateSecCtx(){var e=this.fetchSecCtx(this.getCurrentProject(),this.getCurrentOrg(),this.getCurrentRole());e&&this.model.setSecurityContext(e)},fetchSecCtx(e,t,i){let n=this.model.getCredentialList().filter((n=>{if(e&&e===n.prjname){if(!t)return!0;if(t===n.orgname){if(!i)return!0;if(i===n.rolename)return!0}}return!1}));if(1==n.length)return"ctx::"+n[0].ctxname},getProjectList(e){if(e)return e.reduce(((e,{prjname:t,prjtitle:i,orgname:n,orgtitle:a})=>t?(e.prj.authValues.add(t),e.prj.authValuesNls.add(i),e):e),{prj:{authValues:new Set,authValuesNls:new Set}}).prj},getOrgListForProject(e,t){if(t)return t.reduce(((t,{prjname:i,prjtitle:n,orgname:a,orgtitle:o})=>{if(!e||e===i){if(!a)return t;t.org.authValues.add(a),t.org.authValuesNls.add(o)}return t}),{org:{authValues:new Set,authValuesNls:new Set}}).org},getRoleList(e,t,i){if(i)return i.reduce(((i,{prjname:n,orgname:a,rolename:o,roletitle:r})=>{if(!(e&&e!==n||t&&t!==a)){if(!o)return i;i.role.authValues.add(o),i.role.authValuesNls.add(r)}return i}),{role:{authValues:new Set,authValuesNls:new Set}}).role},getOrgCount(e){return e.orgCount||this.computeCount(e),e.orgCount},getPrjCount(e){return e.prjCount||this.computeCount(e),e.prjCount},getRoleCount(e){return e.roleCount||this.computeCount(e),e.roleCount},computeCount(e){var t=new Set,i=new Set,n=new Set;e.forEach((({prjname:e,prjtitle:a,orgname:o,orgtitle:r,rolename:s})=>{o&&t.add(o),e&&i.add(e),s&&n.add(s)})),e.orgCount=t.size,e.prjCount=i.size,e.roleCount=n.size},getError(e){if("NoCreateCredential"===e)return{result:[{errors:[{errorCode:e}]}]}}})})),define("DS/ENONewWidget/ajaxRequests/ENONewServices",["UWA/Controls/Abstract","DS/ENONewWidget/ajaxRequests/LifecycleServicesSettings","DS/ENONewWidget/ajaxRequests/ENONewAjaxRequests","DS/ENOCollabToolsUI/tracker/ENOCollabTrackerBackEnd","i18n!DS/ENONewWidget/assets/nls/ENONewWidgetNls"],(function(e,t,i,n,a){return Services=e.extend({init:function(e,i,n){this._parent(e),console.debug("ENONew Services init"),e&&(e.tenant?this.tenant=e.tenant:this.tenant=t.getTenant(),e.serviceBaseUrl?this.service=e.serviceBaseUrl:e.service&&(this.service=t.getPlatformBaseUrl(e.service,this.tenant)),this.service||(this.service=t.getPlatformBaseUrl("3DSpace",this.tenant)),e.header&&(this.header=e.header,e.header.SecurityContext&&(this.prefSecCont=e.header.SecurityContext)),i&&(this.parsedResult=!!i.parsedResult)),this.createOptions=n},getTypeInfo1:function(e,t,n){var a=this,o=this.header?this.header:{},r={service:this.service+"/resources/v1/collabServices/authoring/createContent/typeInfo",tenant:this.tenant};Object.keys(e).forEach((t=>(void 0===e[t]||null===e[t])&&delete e[t]));var s=new UWA.Promise((function(s,l){o.SecurityContext=t,r.header=o,a.enrichWithMetrics(e),i._post(e,r,(function(e){e&&"success"===e.status?s(a.parseTypeInfo(e,n)):l(e)}),(function(e){l(e)}))}));return s},parseTypeInfo:function(e,t){var i={};this.rawTypeInfo=e.result;var n=e.result[0];if(t)return n;var o=n.type,r=n.subTypes;if(r=UWA.is(r,"array")?r:[]){var s=[],l=[];for(var c in r){var d=r[c];s.push(d.name),l.push(d.nls)}var u=s.length>1,p={name:"Type",nls:a.Type,type:"String",value:o,range:s,rangeNLS:l,positionUI:1,positionGroup:6,visible:u,defaultAttribute:!0,sortedOptions:!0,mandatory:!0,persistData:r,dropdownMode:"click"};i.Type=p}return i.type=o,i.attributes=n.attributes,i.interfaces=n.interfaces,i.reInitOnSecCtxChange=1==n.reInitOnSecCtxChange,i.prefs=n.prefs,i.isUXModifyDeployed=n.isUXModifyDeployed,i.basicAttributes=n.basicAttributes,i},createContent:function(e,t,n,a){var o=this,r=this.service+"/resources/v1/collabServices/authoring/createContent/Create",s={tenant:this.tenant,service:r},l=this.header?this.header:{};for(var c in l.SecurityContext=t.securityContext,s.header=l,e){var d=e[c];this.rawTypeInfo[0][c]=d}var u={create:this.rawTypeInfo};o.enrichWithMetrics(u);var p={appName:"",typeName:"",select:[],aggregating_context:[],parsed:this.parsedResult,folderID:[],selectedIDs:[],activeFolder:!1};if(e){if(t.queryParams){for(var c in p)val=t.queryParams[c],UWA.is(val)&&(p[c]=val);s.params=p,t.queryParams.leadingappspecific&&(u.options={appInfo:t.queryParams.leadingappspecific})}i._post(u,s,(function(e){n(e,o.service)}),a)}},set3DPartTemplate:function(e,t,n,a){var o=this.service+"/resources/v1/modelerServices/authoring/op/set3DPartTemplateExpression",r={securityContext:t.securityContext,tenant:this.tenant,service:o},s={data:[e]};e&&i._post(s,r,n,a)},getListofTypes:function(e,t,n){var a=this.header?this.header:{},o=this.service+"/resources/v1/collabServices/authoring/createContent/listOfTypes",r={tenant:this.tenant,service:o,header:a};e&&i._post(e,r,t,n)},enrichWithMetrics(e){try{var t={isWebInWin:!1,UXName:"New"};if(this.createOptions&&this.createOptions.getWIWAppInfo){var i=this.createOptions.getWIWAppInfo();i&&i.isWebInWin&&(t.isWebInWin=!0,t.client_app_domain=i.client_app_domain,t.client_app_name=i.client_app_name)}n.enrichRequestWithMetricsWebInWin(e,t)}catch(e){console.warn(e)}}}),Services})),define("DS/ENONewWidget/command/NewContentCmd",["DS/ENONewWidget/command/NewContentCmdMap","DS/ENONewWidget/command/NewContentCommandBase","DS/ENONewWidget/ENONewLauncher","DS/ENONewWidget/command/NewContentDialog","DS/ENONewWidget/ajaxRequests/ENONewServices","DS/ENONewWidget/ajaxRequests/LifecycleServicesSettings"],(function(e,t,i,n,a,o){"use strict";return t.extend({init:function(e){console.debug("ENONew NewContentCmd init"),this._parent(e);var t,o=this.ENONewContext;o?(o.getNewTypeList||(this.existingImpl=!0,o.updatedListOfTypes&&UWA.is(o.updatedListOfTypes,"function")&&(this.updatedListOfTypes=o.updatedListOfTypes),o.getLaunchOptions&&UWA.is(o.getLaunchOptions,"function")&&(this.getLaunchOptions=o.getLaunchOptions)),o.getLoginContext&&UWA.is(o.getLoginContext,"function")&&(t=o.getLoginContext())):console.debug("ENONewContext object is empty"),this.dialog=new n({debugMode:"ENONewContentHdr"===e.ID}),this.launcher=new i,this.services=new a(t),this.isCreateDialogOpen=!1,this.enable(),this.specializedCommands={}},execute:function(){var e,t=this;if(!this.isCreateDialogOpen)if(this.disable(),this.existingImpl){var i=this.updatedListOfTypes();i=i||this.ENONewContext.panelContent.data;var n=this.ENONewContext.options?this.ENONewContext.options:{};(e=this.dialog.displayDialog(i,n,(function(e){var i=e.dsModel;if(i){var n=i.value;n?t.launchPanel(n):console.debug("Failed to get type Info")}else console.debug("Failed to get view Model")})))&&(e.addEventListener("close",(function(e){t.isCreateDialogOpen=!1,t.dialog.destroyDialog(),t.enable()})),t.isCreateDialogOpen=!0)}else{var a=this.getNewTypeList();this.showSubtype=a.showSubtype,this.getTypeList(a,(function(i){var n=o.get3DSpaceBaseUrl(o.getTenant())+"/snresources/images/icons/small/";(e=t.dialog.display(i,{iconBaseURL:n},(function(e){t.launchTypeCmd(e),t.closeNewContentPanel()})))&&(e.addEventListener("close",(function(e){t.closeNewContentPanel()})),t.isCreateDialogOpen=!0)}))}},getType(){return this._type},getNewTypeList(){var e=this.ENONewContext;if(e&&e.getNewTypeList&&UWA.is(e.getNewTypeList,"function"))return e.getNewTypeList(this.options)},getTypeList(e,t){e&&e.typeList?this.services.getListofTypes(e,(function(e){console.debug("vma12:Success:getTypeList"),t(e.result)}),(function(){console.debug("vma12:Fail:getTypeList")})):t()},launchTypeCmd(t){var i=this;if(this._type=t.type,this.typeDetails=t,t.newType){if(this.specializedCommands[t.newType]){var n=this.specializedCommands[t.newType].commandInstance;return n.createOptModel.set("showSubtype",!i.showSubtype),n.execute(t),n}var a=e.getCmdDetails(t.newType);if(a)i.specializedCommands[t.newType]=a,require([a.cmdRequire],(function(e){var n=new e(i.options);return i.specializedCommands[t.newType].commandInstance=n,n.createOptModel.set("showSubtype",!i.showSubtype),n.execute(t),n}));else{this._type=UWA.is(t.newType)?t.newType:"Default";var o=this.getCreateOptions({type:t.type,newType:this._type});this.launchCreateNew(o)}}else console.error("Command launch failed")},addObjectInLifecycleWidget(e){var t;e&&(t=[],e.forEach((function(e){var i={objectId:e.identifier,displayName:e.V_name,objectType:e.type};t.push(i)})),this.options.context.addNewObject1({data:{items:t}}))},getOptions(e){var t=this;return{context:{},type:e.type,options:{typeName:e.newType},events:{onSuccess:function(e){t.addObjectInLifecycleWidget(e.result)},onFailure:function(e){},onCancel:function(e){}}}},closeNewContentPanel(){this.isCreateDialogOpen=!1,this.dialog&&this.dialog.destroyDialog(),this.enable()},launchPanel:function(e){var t=this.getLaunchOptions(e);this.launcher.CreateNew(t),this.isCreateDialogOpen=!1,this.dialog.destroyDialog(),this.enable()}})})),define("DS/ENONewWidget/command/sample/NewContentInputTypeCmd",["DS/ENONewWidget/command/NewContentCmd"],(function(e){"use strict";return e.extend({getNewTypeList:()=>[],getTypeList(e,t){t()},launchTypeCmd(e){this._type=e.newType;var t=this.getCreateOptions(e);this.launchCreateNew(t)}})}));