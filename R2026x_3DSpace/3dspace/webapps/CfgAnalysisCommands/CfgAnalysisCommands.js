define("DS/CfgAnalysisCommands/commands/CfgAnalysisCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/PADUtils/PADContext","DS/Utilities/Utils","DS/CfgBaseUX/scripts/CfgUtility","i18n!DS/CfgAnalysisCommands/assets/nls/CfgSelectByConfigurationCriteriaCmd","i18n!DS/CfgBaseUX/assets/nls/CfgBaseUXNLS","text!DS/CfgBaseUX/assets/CfgUXEnvVariables.json"],(function(e,t,i,n,o,a,s,r){"use strict";return t.extend({init:function(e){var t=this;this._parent(e,{mode:"exclusive",isAsynchronous:!1}),this._isConfigAvailable=0,this.enable();t=this;o.rolesAvailable((function(e){e.isCFGRoleAvail&&(t._isConfigAvailable=1),t._setStateCmd()})),void 0!==i.get&&null!==i.get()?this._SelectorManager=i.get().getPADTreeDocument().getXSO():this._SelectorManager=null,null!==this._SelectorManager&&(void 0!==this._SelectorManager.onPostAdd&&this._SelectorManager.onPostAdd(this._checkSelection.bind(this)),void 0!==this._SelectorManager.onPostRemove&&this._SelectorManager.onPostRemove(this._checkSelection.bind(this)),void 0!==this._SelectorManager.onEmpty&&this._SelectorManager.onEmpty(this._checkSelection.bind(this)));t=this;void 0!==i.get&&null!==i.get()&&i.get().addEvent("editModeModified",(function(e){!0===e&&t._checkSelection()}))},_checkSelection:n.debounce((function(){var e=this;this._SelectedID="";var t=this.getData().selectedNodes;1==t.length&&(e._SelectedID=t[0].id||"",e._SelectedAlias=t[0].alias||"?"),e._setStateCmd()}),200),getDescendantsData:function(){var e={descendantNodes:[],occurrences:[]};if(void 0!==i.get&&null!==i.get()){var t=i.get().getSelectedNodes();t.length;if(1==t.length){var n=0;t[0].isExpanded()&&(n=(n=t[0].getAllDescendants()).filter((function(e){return 1!==e.getNodeSource()})));for(var o=0;o<n.length;o++){var a={physicalID:n[o].getRelationID()};e.descendantNodes.push(a)}if(t[0].isExpanded()){var s=t[0].getLeaves();Array.isArray(s)&&s.length>0&&(s=s.filter((function(e){return 1!==e.getNodeSource()})));for(o=0;o<s.length;o++){for(var r=s[o].getOccurencePath(),l=[],c=0;c<r.length;c++){var g={instancePID:r[c]};l.push(g)}var d={path:l};e.occurrences.push(d)}}}}return e},getData:function(){var e={selectedNodes:[]};if(void 0!==i.get&&null!==i.get()){var t=i.get().getSelectedNodes();t.length;if(1==t.length)if(t[0].isRoot()){var n={rootID:t[0].getID(),rootAlias:t[0].getLabel(),id:t[0].getID(),alias:t[0].getLabel()};e.selectedNodes.push(n)}else{const i=t[0].getRealParent?t[0].getRealParent():t[0].getParent();n={id:t[0].getID(),alias:t[0].getLabel(),parentID:i.getID(),parentalias:i.getLabel(),rootID:t[0].getRoot().getID(),rootAlias:t[0].getRoot().getLabel()};e.selectedNodes.push(n)}}return e},selectInstances:function(e){if(void 0!==i.get&&null!==i.get()&&(i.get().getPADTreeDocument().unselectAll(),null!=e&&null!=e.instances)){for(var t=e.instances,n=0,s=0;s<t.length;s++){if("used"==t[s].status)i.get().getPADTreeDocument().getNodesByRelId(e.instances[s].physicalID).forEach((function(e){e.select(),n++}))}n>1?o.showwarning(n+" "+a.instances_Selected,"info"):o.showwarning(n+" "+a.instance_Selected,"info")}},selectLeaves:function(e){var t=this;if(void 0!==i.get&&null!==i.get()&&(i.get().getPADTreeDocument().unselectAll(),null!=e&&null!=e.occurrences)){var n=e.occurrences;let i=0;for(var s=0;s<n.length;s++)"ErrorTooComplexExpression"==n[s].status&&i++;if(i>0){var r={primaryButton:a.CfgUserChoiceDialog_Yes,secondaryButton:a.CfgUserChoiceDialog_No,messageToDisplayOnDialog:a.StatusNotComputed+i+a.WantToHighlight,dontShowAgain:!1,targetBody:widget.body,primaryCallback:function(){t.highlightLeavesWithStatus(n,"ErrorTooComplexExpression")},secondaryCallback:function(){t.highlightLeavesWithStatus(n,"Valid")}};o.showUserChoiceDialog(r)}else this.highlightLeavesWithStatus(n,"Valid")}},highlightLeavesWithStatus:function(e,t){for(var n=0,s=0;s<e.length;s++)if(e[s].status==t){var r=e[s].pids.replaceAll("[","");r=(r=(r=r.replaceAll("]","")).replaceAll(" ","")).split(","),i.get().getPADTreeDocument().getNodeByOccurencePath(r).select(),n++}n>1?o.showwarning(n+" "+a.instances_Selected,"info"):o.showwarning(n+" "+a.instance_Selected,"info")},_setStateCmd:function(){var e=0;void 0!==this._SelectedID&&""!==this._SelectedID&&(e=1,0==this._isConfigAvailable&&(e=0)),1===e?this.enable():this.disable()},execute:function(){console.log("to be overridden by repsective analysis commands.")},isConfigAuthorized:function(){return 0!==this._isConfigAvailable||(o.showNotifs("error",s.NoCfgRoleError,s.NoCfgRoleErrorSubTitle),this.disable(),!1)}})})),define("DS/CfgAnalysisCommands/commands/CfgSelectByConfigurationCriteriaCmd",["UWA/Core","DS/CfgTracker/CfgTracker","DS/CfgBaseUX/scripts/CfgData","DS/CoreEvents/ModelEvents","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgBaseUX/scripts/CfgDialog","DS/Utilities/TouchUtils","DS/CfgAnalysisCommands/commands/CfgAnalysisCmd","DS/CfgAnalysisEffectivity/scripts/CfgAnalysisUtility","DS/CfgAnalysisEffectivity/scripts/CfgSelectByConfigurationCriteriaDialog","i18n!DS/CfgAnalysisCommands/assets/nls/CfgSelectByConfigurationCriteriaCmd","text!DS/CfgBaseUX/assets/CfgUXEnvVariables.json"],(function(e,t,i,n,o,a,s,r,l,c,g,d){"use strict";var f=r.extend({destroy:function(){this.cfgDialogForSelectByConfigCriteria&&this.cfgDialogForSelectByConfigCriteria.closeDialog()},getModelMarketingName:function(e){for(var t=0;t<e.length;t++)if("Marketing Name"==e[t].name)return e[t].value},getModelName:function(e){for(var t=0;t<e.length;t++)if("name"==e[t].name)return e[t].value},setMagicProbesDataForConfigurationAnalysis:function(e){let i="defaultAppID",n="ODT Environment";widget&&widget.data&&widget.data.appId&&(i=widget.data.appId),widget&&widget.options&&widget.options.title&&(n=widget.options.title);let a={AppId:i,AppName:n,CommandName:t.Labels.SELECT_BY_CONFIGURATION_CRITERIA,CommandOperation:e,ConfigMode:t.ConfigMode.CONTEXTUAL,ApplicationMode:t.ApplicationMode.DASHBOARD};o.sendConfgurationCommandsClickEventForMagicProbes(a)},processOptionsWhereUsed:function(e){var t=this;if("whereUsed"!=e.operation){e.selectedOptionsPIDs=[];for(var i=0;i<e.selection.length;i++)e.selectedOptionsPIDs.push(e.selection[i].optionID)}"whereUsed"==e.operation?l.onApplyWhereUsed(e).then((function(e){null!=e&&("FAILED"==e.status?o.showwarning(g.OWU_Webservice_response_fail,"error"):(t.selectInstances(e),t.setMagicProbesDataForConfigurationAnalysis("Select_By_Configuration_WhereUsed_Criteria_Analysis")))})):"common"==e.operation?l.onApplyCommon(e).then((function(e){null!=e&&("FAILED"==e.status?o.showwarning(g.OWU_Webservice_response_fail,"error"):(t.selectLeaves(e),t.setMagicProbesDataForConfigurationAnalysis("Select_By_Configuration_Common_Criteria_Analysis")))})):"specific"==e.operation&&l.onApplySpecific(e).then((function(e){null!=e&&("FAILED"==e.status?o.showwarning(g.OWU_Webservice_response_fail,"error"):(t.selectLeaves(e),t.setMagicProbesDataForConfigurationAnalysis("Select_By_Configuration_Specific_Criteria_Analysis")))}))},execute:function(){var e=this;if(e.disable(),this.isConfigAuthorized()){this.CfgUXEnvVariables=JSON.parse(d);var t=e.getData();if(t.selectedNodes&&t.selectedNodes.length>0){widget?enoviaServerFilterWidget.tenant=widget.getValue("x3dPlatformId"):enoviaServerFilterWidget.tenant="OnPremise",o.populate3DSpaceURL().then((function(){o.populateSecurityContext().then((function(){!function(){let r={referenceIds:[t.selectedNodes[0].id]};o.getMultipleConfigurationContextInfo(r).then((function(r){console.log(r);let l=[];if(!(r.contextInfo&&r.contextInfo.length>0))return e.enable(),void o.showwarning(g.No_Model_Title+" "+g.No_Model_Msg,"error");if(r.referencesInfo&&r.referencesInfo.length>0&&"YES"==r.referencesInfo[0].hasConfigContext&&"Explicit"==r.referencesInfo[0].revisionMode&&r.contextInfo[0].evolutionPid)for(let e=0;e<r.contextInfo.length;e++){let t=r.contextInfo[e],i=r.description?.[t.descId];i&&i.results&&i.results.length>0&&i.results.forEach((e=>{l.push(e)}))}else for(let e=0;e<r.contextInfo.length;e++){let t=r.contextInfo[e];t.content&&t.content.results&&t.content.results.length>0&&t.content.results.forEach((e=>{l.push(e)}))}f.modelData=l,f.Models=[];for(var d=0;d<f.modelData.length;d++){var u=e.getModelMarketingName(f.modelData[d].data),h=e.getModelName(f.modelData[d].basicData),C={valueItem:f.modelData[d].physicalID,labelItem:u,name:h};f.Models.push(C)}if(f.instances=e.getDescendantsData().descendantNodes,f.occurrences=e.getDescendantsData().occurrences,0==f.instances.length)return o.showwarning(g.SelectByConfigurationCriteria_No_Descendents_nodes,"error"),void e.enable();var D=null!=s.getTouchMode()&&0!=s.getTouchMode(),p={cmd:e,className:"SelectByConfigCriteriaDlg",parent:widget.body,touchMode:D,overlay:!0,mode:"SelectByConfigCriteria",closable:!0,animate:!0,resizable:!0,persistId:"SelectByConfigCriteriaDlg",appNamePosition:0,modalFlag:!0,width:450,height:490,minHeight:406,minWidth:320,style:{"min-height":"350px"},dialogue:{header:g.SelectByConfigurationCriteria_Dialog_Title+" - "+t.selectedNodes[0].alias,target:widget.body}};e.cfgDialogForSelectByConfigCriteria=new a(p),p.parent=e.cfgDialogForSelectByConfigCriteria.container,p.parentElement=e.cfgDialogForSelectByConfigCriteria.container,p.dialogue.object=e.cfgDialogForSelectByConfigCriteria,e.cfgDialogForSelectByConfigCriteria.render(),e.setMagicProbesDataForConfigurationAnalysis("Select_By_Configuration_Criteria_Dialog_Open"),i.clear(),i.ModelEvents=new n;var S={tenant:enoviaServerFilterWidget.tenant,environment:"Dashboard",modelList:f.Models,childInstances:f.instances,displayCompactMode:!D,parent:e.cfgDialogForSelectByConfigCriteria.container,parentElement:e.cfgDialogForSelectByConfigCriteria.container};e.SelectByConfigurationCriteriaDialog=c.create(S),i.ModelEvents.subscribe({event:"SelectByConfigCriteriaDlgClosed"},(function(t){e.cfgDialogForSelectByConfigCriteria.closeDialog()})),i.ModelEvents.subscribe({event:"SelectByConfigCriteriaApply"},(function(t){t.instances=f.instances,t.occurrences=f.occurrences,e.processOptionsWhereUsed(t)})),e.enable()}),(function(t){e.enable(),o.showwarning(g.SelectByConfigurationCriteria_Generic_Error,"error")}))}()}))}))}}}});return f}));