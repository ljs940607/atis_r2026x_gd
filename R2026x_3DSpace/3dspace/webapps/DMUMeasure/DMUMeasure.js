define("DS/DMUMeasure/CATWebUXMultiSelectionPanel",["UWA/Class","DS/Controls/SelectionChips","DS/Windows/Panel","DS/UIKIT/Spinner"],(function(e,t,a,i){"use strict";return e.extend({init:function(e){var r=null,s=null,n=null,l=null,o=t.SELECTION_MODE.SINGLE,u={offsetX:0,offsetY:0},m=null,c=null,d="WebUXMultiSelectionPanel",p="WebUXMultiSelectionPanel",_=100,h=230,M=100,y=230,v=!1,g=!1,D=!1,S=!1,f=!1;e.title&&(d=e.title),e.identifier&&(p=e.identifier),e.immersiveFrame&&(s=e.immersiveFrame),e.height&&(_=e.height),e.minHeight&&(M=e.minHeight),e.width&&(h=e.width),e.minWidth&&(y=e.minWidth),e.bResizable&&(g=e.bResizable),e.bCloseBtn&&(D=e.bCloseBtn),e.bCollapsible&&(S=e.bCollapsible),e.bDisplayMenu&&(v=e.bDisplayMenu),e.bEnableLoadingInProgress&&(f=e.bEnableLoadingInProgress),e.bMultiSelectionMode&&(o=t.SELECTION_MODE.MULTIPLE),e.initialPosition&&(u=e.initialPosition),e.cbFuncOnSelectionChange&&(m=e.cbFuncOnSelectionChange),e.cbFuncOnPostRemove&&(c=e.cbFuncOnPostRemove),this.create=function(){r||n||((n=new t({displayMenu:v,selection:{toggle:!1,mode:o,unselectAllOnEmptyArea:!1}})).getContent().addClassName("CATWebUXMeasureMultiSelectionChips"),m&&n.addEventListener("selectionChange",(function(){m(n)})),c&&n.addEventListener("onPostRemove",(function(e){c(e)})),(r=new a({immersiveFrame:s,title:d,content:n,height:_,width:h,minHeight:M,minWidth:y,resizableFlag:g,closeButtonFlag:D,collapsibleFlag:S,identifier:p,noContextMenu:!0,position:u})).getContent&&r.getContent().addClassName("MeasureMultiSelectionPanel"),r._applyProperties("Position",{offsetX:40,offsetY:100}),f&&!l&&n&&n.getContent&&(l=(new i).inject(n.getContent()).hide()))},this.manageNameLoadingDisplay=function(e){l&&(e?l.show():l.hide())},this.show=function(){r&&r.show()},this.hide=function(){r&&r.hide()},this.addSelection=function(e){n&&e&&n.addChip(e)},this.updateIndicesAsPerSequence=function(e){if(n)for(var t=n.getNumberOfChips(),a=e;a<t;a++)n._items[a].chipOptions.index=a},this.unselectAll=function(){n&&n.unselectAllChips()},this.destroy=function(){n&&n.destroy(),l&&l.destroy(),r&&r.destroy(),n=null,l=null,r=null}}})})),define("DS/DMUMeasure/DMUMeasureProperties",["UWA/Core","UWA/Class","DS/Controls/Toggle","DS/DMUMeasurable/DMUGeometryEnums","i18n!DS/DMUMeasure/assets/nls/DMUMeasure"],(function(e,t,a,i,r){"use strict";return t.extend({init:function(t){var s,n,l,o=t._viewer,u=null,m=null,c=null,d=null,p=null,_=null,h=null,M=null,y=null,v=null,g=null,D=null,S=null,f=null,b=null,C=null,T=null,P=null,A=null,U=null,E=null,I=null,R=null,w=null,k=null,L=null,x=null,N=null,G=null,H=null,O=null,F=null,V=null,B=null,W=null,j=[],z=null,K=null,X=null;this.getPropertiesDisplay=function(t,q){var Y=!1,J=!1,Q=!1,Z=!1,$=!1,ee=!1,te=!1,ae=!1,ie=!1,re=!1,se=!1,ne=!1,le=!1,oe=!1,ue=!1,me=!1,ce=!1,de=!1,pe=!1,_e=!1,he=!1,Me=!1,ye=!1,ve=!1,ge=!1,De=!1,Se=!1,fe=!1,be=!1,Ce=!1,Te=!1,Pe=!1,Ae=!1;function Ue(e,t,i){return new a({label:r.properties[t],value:"dmu"+t+"type",type:"checkbox",checkFlag:e,mixedState:i})}function Ee(e){switch(e){case"point1":ie=!0;break;case"point2":re=!0;break;case"direction":se=!0;break;case"selection":case"centerOfGravity":ne=!0;break;case"computationMode":le=!0;break;case"radius":oe=!0;break;case"diameter":ue=!0;break;case"selection1":me=!0;break;case"selection2":ce=!0;break;case"point3":de=!0;break;case"area":pe=!0;break;case"angle":_e=!0;break;case"halfAngle":he=!0;break;case"apex":Me=!0;break;case"minRadius":case"MinimumRadius":ye=!0;break;case"maxRadius":case"MaximumRadius":ve=!0;break;case"minDiameter":case"MinimumDiameter":ge=!0;break;case"maxDiameter":case"MaximumDiameter":De=!0;break;case"components":Se=!0;break;case"center":fe=!0;break;case"length":be=!0;break;case"arcLength":Ce=!0;break;case"circlePerimeter":Te=!0;break;case"equation":Pe=!0;break;case"volume":Ae=!0}}var Ie=0;function Re(e){var t,a=e.getAttribute("lCustomization"),i=[],r=[];if(0===a.length)for(t=e.getMainValueType(),r=e.getCustoListAsPerMainValue(t),Ie=0;Ie<r.length;Ie++)switch(i[Ie]={custoName:r[Ie],custoValue:!0},t){case"Cylinder_Radius":case"Cylinder_Diameter":"length"===i[Ie].custoName&&(i[Ie].custoValue=!1);break;case"Min_Radius":case"Max_Radius":case"Min_Diameter":case"Max_Diameter":case"Half_Angle":case"Cone_Angle":case"Cone_Length":switch(i[Ie].custoName){case"length":case"angle":case"halfAngle":case"apex":case"minDiameter":case"maxDiameter":case"minRadius":case"maxRadius":case"MinimumDiameter":case"MaximumDiameter":case"MinimumRadius":case"MaximumRadius":i[Ie].custoValue=!1}}else i=a;if("MeasureItem"===e.getAttribute("sType")&&e.getAttribute("bCumulativeMeasure")){for(var s=[],n=["area","volume","selection","computationMode"],l=0;l<i.length;l++)for(var o=0;o<n.length;o++)if(i[l].custoName===n[o]){s.push(i[l]);break}s.length>0&&(i=s)}return i}if(u=null,m=null,c=null,d=null,z=null,K=null,X=null,n=0,l=0,s=0,j=[],t){for(Ie=0;Ie<t.length;Ie++){var we=t[Ie].getAttribute("bShortDisplay");null===u?u=we:we!==u&&(u=void 0),we=t[Ie].getAttribute("bDisplayMeasureType"),null===m?m=we:we!==m&&(m=void 0),we=t[Ie].getAttribute("bDisplayUnit"),null===c?c=we:we!==c&&(c=void 0);var ke=!1;if(null==(z=t[Ie].getAttribute("sComputationMode"))){var Le=null,xe=null,Ne=t[Ie].getMeasurable(1),Ge=t[Ie].getAttribute("sType");"MeasureItem"===Ge?Ne&&Ne.getMode()!==i.Mode.EXACT&&(ke=!0):"MeasureBetween"===Ge?(Le=t[Ie].getMeasurable(2),Ne&&Le&&(Ne.getMode()!==i.Mode.EXACT||Le.getMode()!==i.Mode.EXACT)&&(ke=!0)):"MeasureThickness"===Ge?ke=!0:"Measure3PointsAngle"!==Ge&&"Measure3PointsCircle"!==Ge||(Le=t[Ie].getMeasurable(2),xe=t[Ie].getMeasurable(3),Ne&&Le&&xe&&(Ne.getMode()!==i.Mode.EXACT||Le.getMode()!==i.Mode.EXACT||xe.getMode()!==i.Mode.EXACT)&&(ke=!0))}else"Approximate"===z&&(ke=!0);ke&&(we=t[Ie].getAttribute("bDisplayApproximateSymbol"),null===d?d=we:we!==d&&(d=void 0),s++),K=t[Ie].getAttribute("fRadius"),X=t[Ie].getAttribute("fVolume"),void 0!==K&&n++,void 0!==X&&l++}void 0===u?$=!0:Y=u,void 0===m?ee=!0:J=m,void 0===c?te=!0:Q=c,void 0===d?ae=!0:Z=d,p=new a({label:r.properties.mainValue,value:"DMUMainValue",type:"radio",checkFlag:Y,mixedState:$}).inject(q);var He=e.createElement("div",{styles:{"margin-left":"25px"}}).inject(q);He&&(_=new a({label:r.properties.measureType,value:"DMUMeasureTypeValue",type:"checkbox",checkFlag:J,mixedState:ee}).inject(He),h=new a({label:r.properties.unit,value:"DMUMainValue",type:"checkbox",checkFlag:Q,mixedState:te}).inject(He),s===t.length&&(M=new a({label:r.properties.approximateSymbol,value:"DMUApproximateSymbol",type:"checkbox",checkFlag:Z,mixedState:ae}).inject(He)),Y||(h.disabled=!0,_.disabled=!0,M&&(M.disabled=!0))),y=new a({label:r.properties.extendedDisplay,value:"DMUExtendedDisplayValue",type:"radio",checkFlag:!Y,mixedState:$}).inject(q);var Oe=e.createElement("div",{styles:{"margin-left":"25px"}}).inject(q),Fe=Re(t[0]);if(1===t.length)j=Fe;else for(var Ve=0;Ve<Fe.length;Ve++)for(var Be=!1,We=1;We<t.length;We++){for(var je=Re(t[We]),ze=0;ze<je.length;ze++)Fe[Ve].custoName===je[ze].custoName&&(Be=!0,We===t.length-1&&j.push(Fe[Ve]),Fe[Ve].custoValue!==je[ze].custoValue&&Ee(Fe[Ve].custoName));if(!Be)break}for(Ie=0;Ie<j.length;Ie++){var Ke=j[Ie].custoValue;switch(j[Ie].custoName){case"point1":ie&&(Ke=!1),(v=Ue(Ke,"point1",ie)).inject(Oe);break;case"point2":re&&(Ke=!1),(g=Ue(Ke,"point2",re)).inject(Oe);break;case"direction":se&&(Ke=!1),(D=Ue(Ke,"direction",se)).inject(Oe);break;case"selection":ne&&(Ke=!1),(S=Ue(Ke,"selection",ne)).inject(Oe);break;case"computationMode":le&&(Ke=!1),(f=Ue(Ke,"computationMode",le)).inject(Oe);break;case"radius":oe&&(Ke=!1),(b=Ue(Ke,"radius",oe)).inject(Oe);break;case"diameter":ue&&(Ke=!1),(C=Ue(Ke,"diameter",ue)).inject(Oe);break;case"selection1":me&&(Ke=!1),(T=Ue(Ke,"selection1",me)).inject(Oe);break;case"selection2":ce&&(Ke=!1),(P=Ue(Ke,"selection2",ce)).inject(Oe);break;case"point3":de&&(Ke=!1),(A=Ue(Ke,"point3",de)).inject(Oe);break;case"area":pe&&(Ke=!1),(U=Ue(Ke,"area",pe)).inject(Oe);break;case"centerOfGravity":_e&&(Ke=!1),(E=Ue(Ke,"centerOfGravity",_e)).inject(Oe);break;case"angle":false,(I=Ue(Ke,"angle",false)).inject(Oe);break;case"halfAngle":he&&(Ke=!1),(R=Ue(Ke,"halfAngle",he)).inject(Oe);break;case"apex":Me&&(Ke=!1),(w=Ue(Ke,"apex",Me)).inject(Oe);break;case"minRadius":case"MinimumRadius":n===t.length&&(ye&&(Ke=!1),(k=Ue(Ke,"minRadius",ye)).inject(Oe));break;case"maxRadius":case"MaximumRadius":ve&&(Ke=!1),(L=Ue(Ke,"maxRadius",ve)).inject(Oe);break;case"minDiameter":case"MinimumDiameter":n===t.length&&(ge&&(Ke=!1),(x=Ue(Ke,"minDiameter",ge)).inject(Oe));break;case"maxDiameter":case"MaximumDiameter":De&&(Ke=!1),(N=Ue(Ke,"maxDiameter",De)).inject(Oe);break;case"components":Se&&(Ke=!1),(G=Ue(Ke,"components",Se)).inject(Oe);break;case"center":fe&&(Ke=!1),(H=Ue(Ke,"center",fe)).inject(Oe);break;case"length":be&&(Ke=!1),(O=Ue(Ke,"length",be)).inject(Oe);break;case"arcLength":Ce&&(Ke=!1),(F=Ue(Ke,"arcLength",Ce)).inject(Oe);break;case"circlePerimeter":Te&&(Ke=!1),(V=Ue(Ke,"circlePerimeter",Te)).inject(Oe);break;case"equation":Pe&&(Ke=!1),(B=Ue(Ke,"equation",Pe)).inject(Oe);break;case"volume":l===t.length&&(Ae&&(Ke=!1),(W=Ue(Ke,"volume",Ae)).inject(Oe))}}Y&&(v&&(v.disabled=!0),g&&(g.disabled=!0),D&&(D.disabled=!0),S&&(S.disabled=!0),f&&(f.disabled=!0),b&&(b.disabled=!0),C&&(C.disabled=!0),T&&(T.disabled=!0),P&&(P.disabled=!0),A&&(A.disabled=!0),U&&(U.disabled=!0),E&&(E.disabled=!0),I&&(I.disabled=!0),R&&(R.disabled=!0),w&&(w.disabled=!0),k&&(k.disabled=!0),L&&(L.disabled=!0),x&&(x.disabled=!0),N&&(N.disabled=!0),G&&(G.disabled=!0),H&&(H.disabled=!0),O&&(O.disabled=!0),F&&(F.disabled=!0),V&&(V.disabled=!0),B&&(B.disabled=!0),W&&(W.disabled=!0))}p.addEventListener("buttonclick",(function(){h.disabled=!1,_.disabled=!1,M&&(M.disabled=!1),v&&(v.disabled=!0),g&&(g.disabled=!0),D&&(D.disabled=!0),S&&(S.disabled=!0),f&&(f.disabled=!0),b&&(b.disabled=!0),C&&(C.disabled=!0),T&&(T.disabled=!0),P&&(P.disabled=!0),A&&(A.disabled=!0),U&&(U.disabled=!0),E&&(E.disabled=!0),I&&(I.disabled=!0),R&&(R.disabled=!0),w&&(w.disabled=!0),k&&(k.disabled=!0),L&&(L.disabled=!0),x&&(x.disabled=!0),N&&(N.disabled=!0),G&&(G.disabled=!0),H&&(H.disabled=!0),O&&(O.disabled=!0),F&&(F.disabled=!0),V&&(V.disabled=!0),B&&(B.disabled=!0),W&&(W.disabled=!0)})),y.addEventListener("buttonclick",(function(){h.disabled=!0,_.disabled=!0,M&&(M.disabled=!0),v&&(v.disabled=!1),g&&(g.disabled=!1),D&&(D.disabled=!1),S&&(S.disabled=!1),f&&(f.disabled=!1),b&&(b.disabled=!1),C&&(C.disabled=!1),T&&(T.disabled=!1),P&&(P.disabled=!1),A&&(A.disabled=!1),U&&(U.disabled=!1),E&&(E.disabled=!1),I&&(I.disabled=!1),R&&(R.disabled=!1),w&&(w.disabled=!1),k&&(k.disabled=!1),L&&(L.disabled=!1),x&&(x.disabled=!1),N&&(N.disabled=!1),G&&(G.disabled=!1),H&&(H.disabled=!1),O&&(O.disabled=!1),F&&(F.disabled=!1),V&&(V.disabled=!1),B&&(B.disabled=!1),W&&(W.disabled=!1)})),this.getPropertiesToSet=function(){var e=[],t=p.checkFlag,a=p.mixedState;a||t===u||(e.push({name:"bShortDisplay",value:t}),u=t),t=_.checkFlag,(a=_.mixedState)||t===m||(e.push({name:"bDisplayMeasureType",value:t}),m=t),t=h.checkFlag,(a=h.mixedState)||t===c||(e.push({name:"bDisplayUnit",value:t}),c=t),M&&(t=M.checkFlag,(a=M.mixedState)||t===d||(e.push({name:"bDisplayApproximateSymbol",value:t}),d=t));var i=[],r=0;for(Ie=0;Ie<j.length;Ie++)switch(j[Ie].custoName){case"point1":v&&!v.mixedState&&(i[r]=j[Ie],i[r++].custoValue=v.checkFlag);break;case"point2":g&&!g.mixedState&&(i[r]=j[Ie],i[r++].custoValue=g.checkFlag);break;case"direction":D&&!D.mixedState&&(i[r]=j[Ie],i[r++].custoValue=D.checkFlag);break;case"selection":S&&!S.mixedState&&(i[r]=j[Ie],i[r++].custoValue=S.checkFlag);break;case"computationMode":f&&!f.mixedState&&(i[r]=j[Ie],i[r++].custoValue=f.checkFlag);break;case"radius":b&&!b.mixedState&&(i[r]=j[Ie],i[r++].custoValue=b.checkFlag);break;case"diameter":C&&!C.mixedState&&(i[r]=j[Ie],i[r++].custoValue=C.checkFlag);break;case"selection1":T&&!T.mixedState&&(i[r]=j[Ie],i[r++].custoValue=T.checkFlag);break;case"selection2":P&&!P.mixedState&&(i[r]=j[Ie],i[r++].custoValue=P.checkFlag);break;case"point3":A&&!A.mixedState&&(i[r]=j[Ie],i[r++].custoValue=A.checkFlag);break;case"area":U&&!U.mixedState&&(i[r]=j[Ie],i[r++].custoValue=U.checkFlag);break;case"centerOfGravity":E&&!E.mixedState&&(i[r]=j[Ie],i[r++].custoValue=E.checkFlag);break;case"angle":I&&!I.mixedState&&(i[r]=j[Ie],i[r++].custoValue=I.checkFlag);break;case"halfAngle":R&&!R.mixedState&&(i[r]=j[Ie],i[r++].custoValue=R.checkFlag);break;case"apex":w&&!w.mixedState&&(i[r]=j[Ie],i[r++].custoValue=w.checkFlag);break;case"minRadius":case"MinimumRadius":k&&!k.mixedState&&(i[r]=j[Ie],i[r++].custoValue=k.checkFlag);break;case"maxRadius":case"MaximumRadius":L&&!L.mixedState&&(i[r]=j[Ie],i[r++].custoValue=L.checkFlag);break;case"minDiameter":case"MinimumDiameter":x&&!x.mixedState&&(i[r]=j[Ie],i[r++].custoValue=x.checkFlag);break;case"maxDiameter":case"MaximumDiameter":N&&!N.mixedState&&(i[r]=j[Ie],i[r++].custoValue=N.checkFlag);break;case"components":G&&!G.mixedState&&(i[r]=j[Ie],i[r++].custoValue=G.checkFlag);break;case"center":H&&!H.mixedState&&(i[r]=j[Ie],i[r++].custoValue=H.checkFlag);break;case"length":O&&!O.mixedState&&(i[r]=j[Ie],i[r++].custoValue=O.checkFlag);break;case"arcLength":F&&!F.mixedState&&(i[r]=j[Ie],i[r++].custoValue=F.checkFlag);break;case"circlePerimeter":V&&!V.mixedState&&(i[r]=j[Ie],i[r++].custoValue=V.checkFlag);break;case"equation":B&&!B.mixedState&&(i[r]=j[Ie],i[r++].custoValue=B.checkFlag);break;case"volume":W&&!W.mixedState&&(i[r]=j[Ie],i[r++].custoValue=W.checkFlag)}return e.push({name:"lCustomization",value:i}),e},this.afterSetProperties=function(e,t){if(e&&t)for(Ie=0;Ie<e.length;Ie++)e[Ie].getAttribute("bShortDisplay")?localStorage.setItem("DMUMeasureDisplayPreference","Short"):localStorage.setItem("DMUMeasureDisplayPreference","Extended"),e[Ie].refreshNode(),o&&o.render&&o.render()}},this.getCustomParameter=function(){return{resizableFlag:"vertical",heightToWidthRatio:j.length>5?1.2:0}}}})})),define("DS/DMUMeasure/DMUMeasureExport",["require","exports","DS/DMUBaseExperience/EXPUtils"],(function(e,t,a){"use strict";return class{static getObjectDefinition(e){let t={measurables:[],cumulativeMeasurables:[]};for(let i=1;i<=3;i++)e.getMeasurable(i)&&t.measurables.push(e.getMeasurable(i).exportData(a.typeToStr));if(e.getAttribute("bCumulativeMeasure")){t.cumulativeMeasurables=[];var i=e.getCumulativeMeasurables();if(i&&i.length>0)for(let e=0;e<i.length;e++)t.cumulativeMeasurables.push(i[e].exportData(a.typeToStr))}return t}}})),define("DS/DMUMeasure/DMUMeasureRemoveAllNonPersistentCmd",["DS/CATWebUXComponents/DMUCommand","DS/Selection/CSOManager","DS/DMUBaseExperience/DMUContextManager","DS/DMUControls/DMUWarningPanel","i18n!DS/DMUMeasure/assets/nls/DMUMeasure"],(function(e,t,a,i,r){"use strict";var s;return e.extend({init:function(e){e.mode="shared",this._parent(e)},beginExecute:function(){var e=this;if(s)e.end?e.end():e.done();else{s=new i({title:r.removeAllNonPersistentWarningPanel.title,message:r.removeAllNonPersistentWarningPanel.message,okLabel:r.removeAllNonPersistentWarningPanel.onOKCB,frmWindow:this.getFrameWindow(),callbacks:{onValidateCB:function(){!function(){if(t.get().length>0){var i=a.getReviewContext({viewer:e.getFrameWindow().getViewer()});if(i){var r=i.getTransientReviewBag();if(r){var s=r.getDMUObjects("DMUMeasure");r.removeDMUObjects&&r.removeDMUObjects(s)}}}e.done()}(),s=null},onCancelCB:function(){e.end?e.end():e.done(),s=null},onCloseCB:function(){e.end?e.end():e.done(),s=null}}})}},destroy:function(){s&&s.destroy(),this._parent()}})})),define("DS/DMUMeasure/DMUMeasureCmdMode",[],(function(){"use strict";function e(){}return e.prototype.ComputeCommandMode=function(e,t){return new Promise((a=>{var i=e.getComponent(WAfrStandardComponentKey.CommandsManagerComponent).getRunningCommand();return a(i&&["section2CmdHdr","sectionCmdHdr","DMUPositionOverloadHdr","CAT3DComposeMoveHdr","CAT3DComposeWidgetDefaultHdr","CAT3DComposeExamineSelectionHdr"].includes(i)?t.NESTED:t.EXCLUSIVE)}))},e})),define("DS/DMUMeasure/DMUMeasureArcDisplayTypeCmd",["DS/CATWebUXComponents/DMUCommand","DS/DMUBaseExperience/DMUContextManager","DS/Selection/CSOManager"],(function(e,t,a){"use strict";return e.extend({init:function(e){this._parent(e);var i=this;this.beginExecute=function(){var e=t.getReviewContext({viewer:i.getFrameWindow().getViewer()});if(e){var r=a.get();if(r.length>0){for(var s=0;s<r.length;s++){var n=e.getDMUObjectFromPathElement(r[s].pathElement);if(n){var l;switch(this._id){case"DMUMeasureArcCenterDisplayHdr":l=0;break;case"DMUMeasureArcTangentDisplayHdr":l=1}void 0!==l&&(n.setAttribute("iRadiusResultDisplayType",l),n.updateGlobalRadiusResultDisplayPreference(l),n.refreshNode())}}a.empty(),i.getFrameWindow().getViewer().render()}}i.end?i.end():i.done()}}})})),define("DS/DMUMeasure/DMUMeasureContextualBar",["DS/DMUBaseUI/DMUContextualBarAdapter","DS/DMUBaseExperience/DMUContextManager","DS/DMUMeasurable/DMUMeasureEnums","DS/Visualization/ThreeJS_DS","DS/CATWebUXComponents/DMUCommandsManager","DS/DMUBaseExperience/EXPUtils","DS/DMUMeasurable/DMUGeometryEnums","DS/WebappsUtils/WebappsUtils","i18n!DS/DMUMeasure/assets/nls/DMUMeasure"],(function(e,t,a,i,r,s,n,l,o){"use strict";var u={Measure_DMUStylesStr:"Measure_DMUStylesList",Measure_DMUIncreaseFontSizeStr:"Measure_DMUIncreaseFontSizeHdr",Measure_DMUDecreaseFontSizeStr:"Measure_DMUDecreaseFontSizeHdr",DMUGraphicPropertiesPanelStr:"DMUGraphicPropertiesPanelHdr",DMUMeasureDeleteStr:"DMUMeasureDeleteHdr",DMUMeasureRadiusArcHdrStr:"MeasureRadiusArcHdr",DMUMeasureRadiusDiaHdrStr:"MeasureRadiusDiaHdr",DMUMeasureCylHdrStr:"MeasureCylHdr",DMUMeasureConeHdrStr:"MeasureConeHdr",DMUMeasureHalfConeHdrStr:"MeasureHalfConeHdr",DMUMeasureSphereHdrStr:"MeasureSphereHdr",DMUMeasurePrdHdrStr:"DMUMeasureProductAreaHdr",DMUMeasurePrdVolumeAreaHdrStr:"MeasurePrdVolumeAreaHdr",DMUMeasure3PointsHdrStr:"Measure3PointsHdr",DMUMeasureMinMaxHdrStr:"MeasureMinMaxHdr",DMUMeasureDistanceMinMaxHdrStr:"MeasureDistanceMinMaxHdr",DMUMeasureDistanceHdrStr:"DMUMeasureDistanceHdr",DMUMeasureAngleMinMaxHdrStr:"MeasureAngleMinMaxHdr",DMUMeasureMinMaxHdrStrLocal:"MeasureMinMaxLocalHdr",DMUMeasureDistanceMinMaxHdrStrLocal:"MeasureDistanceMinMaxLocalHdr",DMUMeasureDistanceHdrStrLocal:"MeasureDistanceLocalHdr",DMUMeasureAngleMinMaxHdrStrLocal:"MeasureAngleMinMaxLocalHdr",DMUMeasureDisplayStr:"DMUMeasureDisplayHdr"},m={submenuList:{DMUArrowLeaderHdr:{type:"RadioItem",identifier:"DMUArrowLeaderHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_LeaderArrow.png"},DMUBubbleLeaderHdr:{type:"RadioItem",identifier:"DMUBubbleLeaderHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_LeaderDot.png"},DMUCrossLeaderHdr:{type:"RadioItem",identifier:"DMUCrossLeaderHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_LeaderXCross.png"},DMUSquareLeaderHdr:{type:"RadioItem",identifier:"DMUSquareLeaderHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_LeaderSquare.png"},DMUNoEndLeaderHdr:{type:"RadioItem",identifier:"DMUNoEndLeaderHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_LeaderNoExtremity.png"},DMUNoLeaderHdr:{type:"RadioItem",identifier:"DMUNoLeaderHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_LeaderNoLeader.png"},DMUCrossPointTypeHdr:{type:"RadioItem",identifier:"DMUCrossPointTypeHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_XCross.png"},DMUPlusPointTypeHdr:{type:"RadioItem",identifier:"DMUPlusPointTypeHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_PCross.png"},DMUConcentricPointTypeHdr:{type:"RadioItem",identifier:"DMUConcentricPointTypeHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_Concentric.png"},DMUCoincidentPointTypeHdr:{type:"RadioItem",identifier:"DMUCoincidentPointTypeHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_Coincident.png"},DMUFullCirclePointTypeHdr:{type:"RadioItem",identifier:"DMUFullCirclePointTypeHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_FCircle.png"},DMUFullSquarePointTypeHdr:{type:"RadioItem",identifier:"DMUFullSquarePointTypeHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_FSquare.png"},DMUDotPointTypeHdr:{type:"RadioItem",identifier:"DMUDotPointTypeHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_Dot.png"},DMUSmallDotPointTypeHdr:{type:"RadioItem",identifier:"DMUSmallDotPointTypeHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_SmallDot.png"},DMUNonePointTypeHdr:{type:"RadioItem",identifier:"DMUNonePointTypeHdr",module:"DMUBaseCtxCommands"},DMUStarPointTypeHdr:{type:"RadioItem",identifier:"DMUStarPointTypeHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_Star.png"},DMUNoneExtremityTypeHdr:{type:"RadioItem",identifier:"DMUNoneExtremityTypeHdr",module:"DMUBaseCtxCommands"},DMUSmallDotExtremityTypeHdr:{type:"RadioItem",identifier:"DMUSmallDotExtremityTypeHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_SmallDot.png"},DMUDotExtremityTypeHdr:{type:"RadioItem",identifier:"DMUDotExtremityTypeHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_Dot.png"},DMUStarExtremityTypeHdr:{type:"RadioItem",identifier:"DMUStarExtremityTypeHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_Star.png"},DMUFullSquareExtremityTypeHdr:{type:"RadioItem",identifier:"DMUFullSquareExtremityTypeHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_FSquare.png"},DMUFullCircleExtremityTypeHdr:{type:"RadioItem",identifier:"DMUFullCircleExtremityTypeHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_FCircle.png"},DMUCoincidentExtremityTypeHdr:{type:"RadioItem",identifier:"DMUCoincidentExtremityTypeHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_Coincident.png"},DMUConcentricExtremityTypeHdr:{type:"RadioItem",identifier:"DMUConcentricExtremityTypeHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_Concentric.png"},DMUPlusExtremityTypeHdr:{type:"RadioItem",identifier:"DMUPlusExtremityTypeHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_PCross.png"},DMUCrossExtremityTypeHdr:{type:"RadioItem",identifier:"DMUCrossExtremityTypeHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMU_XCross.png"},DMUMeasureArcCenterDisplayHdr:{type:"PushItem",identifier:"DMUMeasureArcCenterDisplayHdr",module:"DMUMeasure",iconPath:"icons/32/I_CenterDisplay.png"},DMUMeasureArcTangentDisplayHdr:{type:"PushItem",identifier:"DMUMeasureArcTangentDisplayHdr",module:"DMUMeasure",iconPath:"icons/32/I_TangentDisplay.png"}},mainMenuList:{DMUHideShowHdr:{type:"PushItem",identifier:"DMUHideShowHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMUHideShow.png"},DMUCutHdr:{type:"PushItem",identifier:"DMUCutHdr",module:"DMUBaseCommands",iconPath:"icons/32/I_DMUCutCmd.png"},DMUCopyHdr:{type:"PushItem",identifier:"DMUCopyHdr",module:"DMUBaseCommands",iconPath:"icons/32/I_DMUCopyCmd.png"},DMUDeleteHdr:{type:"PushItem",identifier:"DMUDeleteHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMUDelete.png"},DMUSelectMeasuredPrdHdr:{type:"PushItem",identifier:"DMUSelectMeasuredPrdHdr",module:"DMUMeasure",iconPath:"icons/32/I_Meas_Product.png"},DMUPropertiesHdr:{type:"PushItem",identifier:"DMUPropertiesHdr",module:"DMUBaseCtxCommands",iconPath:"icons/32/I_DMUProperties.png"},DMUMeasureRemoveAllNonPersistentHdr:{type:"PushItem",identifier:"DMUMeasureRemoveAllNonPersistentHdr",module:"DMUMeasure"},DMUMeasureAngleSector1Hdr:{type:"RadioItem",identifier:"DMUMeasureAngleSector1Hdr",module:"DMUMeasure",iconPath:"icons/32/I_MeasureAngleSector1.png"},DMUMeasureAngleSector2Hdr:{type:"RadioItem",identifier:"DMUMeasureAngleSector2Hdr",module:"DMUMeasure",iconPath:"icons/32/I_MeasureAngleSector2.png"},DMUMeasureAngleSector3Hdr:{type:"RadioItem",identifier:"DMUMeasureAngleSector3Hdr",module:"DMUMeasure",iconPath:"icons/32/I_MeasureAngleSector3.png"},DMUMeasureAngleSector4Hdr:{type:"RadioItem",identifier:"DMUMeasureAngleSector4Hdr",module:"DMUMeasure",iconPath:"icons/32/I_MeasureAngleSector4.png"},DMUMeasureAngleSectorCHdr:{type:"CheckItem",identifier:"DMUMeasureAngleSectorCHdr",module:"DMUMeasure",iconPath:"icons/32/I_MeasureAngleComplementary.png"},DMULeaderStr:{type:"PushItem",identifier:"DMULeaderStr",module:"DMUMeasure"},DMUExtremityTypeStr:{type:"PushItem",identifier:"DMUExtremityTypeStr"},DMUPointTypeStr:{type:"PushItem",identifier:"DMUPointTypeStr"},DMUMeasureDimensionRepresentationHdr:{type:"PushItem",identifier:"DMUMeasureDimensionRepresentationHdr"},DMUMeasure2DDisplayHdr:{type:"CheckItem",identifier:"DMUMeasure2DDisplayHdr",module:"DMUMeasure",iconPath:"icons/32/I_MeasureDisplayContent.png"}}},c=function(e){return e&&e.getComponent?e.getComponent(WAfrStandardComponentKey.HandlerComponent):void 0};return e.extend({getSharedContextualCommandList:function(e){var t=[];return e&&e.length&&e.forEach((function(e){-1===t.indexOf(e.getType())&&t.push(e.getType())})),1===t.length&&-1!==t[0].indexOf("DMUMeasure")?this.getContextualCommandList():[]},getCmdHdrsFor2DGeometries:function(){var e=[];let t=Boolean(this._resType);if(t&&"angle"===this._resType.toLowerCase())return e;var i,r,s;let l=t&&"dia/rad"===this._resType,o=t&&("angle"===this._resType.toLowerCase()||"chain_stack"===this._resType.toLowerCase());if("MeasureBetween"===this._sType){switch(i="DMUMeasureMinDistanceHdr",this.getAttribute("sDistanceType")){case"Distance":i="DMUMeasureDistanceHdr";break;case"Angle":i="DMUMeasureAngleHdr";break;case"MaximumDistance":i="DMUMeasureMaxDistanceHdr";break;case"LocalMinimumDistance":i="DMUMeasureLocalMinDistanceHdr";break;case"LocalMaximumDistance":i="DMUMeasureLocalMaxDistanceHdr"}r=this._sMeasurable1.getType(),s=this._sMeasurable2.getType();var u=this.getAttribute("sSelectedType1"),m=this.getAttribute("sSelectedType2"),c=!this._objAction&&(u===a.ViewedType.POINT||u===a.ViewedType.CENTER)||r===n.GeometryType.POINT,d=!this._objAction&&(m===a.ViewedType.POINT||m===a.ViewedType.CENTER)||s===n.GeometryType.POINT;if(c&&d);else if(c&&(s===n.GeometryType.CURVE||s===n.GeometryType.SURFACE||s===n.GeometryType.PRODUCT)||(r===n.GeometryType.CURVE||r===n.GeometryType.SURFACE||r===n.GeometryType.PRODUCT)&&d){let t=["DMUMeasureMinDistanceHdr","DMUMeasureMaxDistanceHdr"];e=[{name:"DMUMeasureMinMaxHdrStr",line:1,hdr_list:["DMUMeasureMinDistanceHdr","DMUMeasureMaxDistanceHdr"],selectedHdr:t[1]===i?t[1]:t[0]}]}else if(c&&(s===n.GeometryType.LINE||s===n.GeometryType.CIRCLE||s===n.GeometryType.PLANE||s===n.GeometryType.CYLINDER||s===n.GeometryType.CONE||s===n.GeometryType.SPHERE)||(r===n.GeometryType.LINE||r===n.GeometryType.CIRCLE||r===n.GeometryType.PLANE||r===n.GeometryType.CYLINDER||r===n.GeometryType.CONE||r===n.GeometryType.SPHERE)&&d)e=[{name:"DMUMeasureDistanceMinMaxHdrStr",line:1,hdr_list:["DMUMeasureDistanceHdr","DMUMeasureMinDistanceHdr","DMUMeasureMaxDistanceHdr"],selectedHdr:i}];else if(r===n.GeometryType.CIRCLE||s===n.GeometryType.CIRCLE)e=[{name:"DMUMeasureDistanceMinMaxHdrStr",line:1,hdr_list:["DMUMeasureDistanceHdr","DMUMeasureMinDistanceHdr","DMUMeasureMaxDistanceHdr"],selectedHdr:i}];else if(r===n.GeometryType.POINT&&s===n.GeometryType.POINT)e=[{name:"DMUMeasureDistanceHdrStr",line:1,hdr_list:["DMUMeasureDistanceHdr"]}];else if(r===n.GeometryType.PRODUCT&&(s===n.GeometryType.PRODUCT||s===n.GeometryType.SURFACE||s===n.GeometryType.PLANE||s===n.GeometryType.CURVE||s===n.GeometryType.LINE||s===n.GeometryType.CYLINDER||s===n.GeometryType.CONE||d)||(r===n.GeometryType.SURFACE||r===n.GeometryType.PLANE||r===n.GeometryType.CURVE||r===n.GeometryType.LINE||r===n.GeometryType.CYLINDER||r===n.GeometryType.CONE||c)&&s===n.GeometryType.PRODUCT||r===n.GeometryType.SURFACE&&(s===n.GeometryType.SURFACE||s===n.GeometryType.PLANE||s===n.GeometryType.CURVE||s===n.GeometryType.LINE||d)||(r===n.GeometryType.PLANE||r===n.GeometryType.CURVE||r===n.GeometryType.LINE||c)&&s===n.GeometryType.SURFACE||r===n.GeometryType.PLANE&&s===n.GeometryType.CURVE||r===n.GeometryType.CURVE&&(s===n.GeometryType.CURVE||s===n.GeometryType.PLANE||s===n.GeometryType.LINE||d)||r===n.GeometryType.LINE&&d||c&&s===n.GeometryType.LINE){let t=["DMUMeasureMinDistanceHdr","DMUMeasureMaxDistanceHdr"];e=[{name:"DMUMeasureMinMaxHdrStr",line:1,hdr_list:["DMUMeasureMinDistanceHdr","DMUMeasureMaxDistanceHdr"],selectedHdr:t[1]===i?t[1]:t[0]}]}else{var p=!1;this.getAttribute("fAngle")>0&&(p=!0),t&&!o&&(p=!1),e=p?[{name:"DMUMeasureAngleMinMaxHdrStr",line:1,hdr_list:["DMUMeasureAngleHdr","DMUMeasureMinDistanceHdr","DMUMeasureMaxDistanceHdr"],selectedHdr:i}]:[{name:"DMUMeasureDistanceMinMaxHdrStr",line:1,hdr_list:["DMUMeasureDistanceHdr","DMUMeasureMinDistanceHdr","DMUMeasureMaxDistanceHdr"],selectedHdr:i}]}e.length>0&&e[0].hdr_list&&this._sMeasurable1.extraPolateGeom&&(e[0].name=e[0].name+"Local",e[0].hdr_list.push("DMUMeasureLocalMinDistanceHdr"),e[0].hdr_list.push("DMUMeasureLocalMaxDistanceHdr"))}else if("MeasureItem"!==this._sType||t&&!l||this.getAttribute("bCumulativeMeasure"))"Measure3PointsCircle"!==this._sType&&"Measure3PointsAngle"!==this._sType||(i="DMUMeasureAngleHdr",e=[{name:"DMUMeasure3PointsHdrStr",line:1,hdr_list:["DMUMeasureAngleHdr","DMUMeasureDiameterHdr","DMUMeasureRadiusHdr"],selectedHdr:i="Measure3PointsAngle"===this._sType&&this.getAttribute("fAngle")>0?"DMUMeasureAngleHdr":this.compareAttributes([{name:"bRadiusDisplay",value:!0}])?"DMUMeasureRadiusHdr":"DMUMeasureDiameterHdr"}]);else{var _,h;if(this.getAttribute("sResultingType1")!==a.ResultType.POINT)if(r=this._sMeasurable1.getType(),l)e=[{name:"DMUMeasureRadiusDiaHdrStr",line:1,hdr_list:["DMUMeasureDiameterHdr","DMUMeasureRadiusHdr"],selectedHdr:_}];else if(a.ViewedType.CENTER!==this.getAttribute("sSelectedType1")&&r===n.GeometryType.CIRCLE)_=this.compareAttributes([{name:"bRadiusDisplay",value:!0}])?"DMUMeasureRadiusHdr":"DMUMeasureDiameterHdr",Math.abs(2*Math.PI-this.getMeasurable(1)._arcAngle)>.001?(this.getAttribute("bArcLengthDisplay")&&(_="DMUMeasureArcLengthHdr"),e=[{name:"DMUMeasureRadiusArcHdrStr",line:1,hdr_list:["DMUMeasureDiameterHdr","DMUMeasureRadiusHdr","DMUMeasureArcLengthHdr"],selectedHdr:_}]):e=[{name:"DMUMeasureRadiusDiaHdrStr",line:1,hdr_list:["DMUMeasureDiameterHdr","DMUMeasureRadiusHdr"],selectedHdr:_}];else if(r===n.GeometryType.CYLINDER)void 0===(h=this.getAttribute("sSurfaceDisplayType"))&&(h="Diameter"),e=[{name:"DMUMeasureCylHdrStr",line:1,hdr_list:["DMUMeasureSurfaceDiameterHdr","DMUMeasureSurfaceRadiusHdr","DMUMeasureSurfaceLengthHdr","DMUMeasureSurfaceAreaHdr"],selectedHdr:_="DMUMeasureSurface"+h+"Hdr"}];else if(r===n.GeometryType.CONE){let t="DMUMeasureConeHdrStr";void 0===(h=this.getAttribute("sSurfaceDisplayType"))&&(h="HalfAngle"),_="DMUMeasureSurface"+h+"Hdr";var M=["DMUMeasureSurfaceHalfAngleHdr","DMUMeasureSurfaceAngleHdr","DMUMeasureSurfaceLengthHdr","DMUMeasureSurfaceMaximumDiameterHdr","DMUMeasureSurfaceMaximumRadiusHdr"],y=this.getAttribute("vApex"),v=this._sMeasurable1.getPoints();y&&(Math.abs(y.x-v.beginPoint.x)<.001&&Math.abs(y.y-v.beginPoint.y)<.001&&Math.abs(y.z-v.beginPoint.z)<.001||Math.abs(y.x-v.endPoint.x)<.001&&Math.abs(y.y-v.endPoint.y)<.001&&Math.abs(y.z-v.endPoint.z)<.001)||(t="DMUMeasureHalfConeHdrStr",M.push("DMUMeasureSurfaceMinimumDiameterHdr"),M.push("DMUMeasureSurfaceMinimumRadiusHdr")),M.push("DMUMeasureSurfaceAreaHdr"),e=[{name:t,line:1,hdr_list:M,selectedHdr:_}]}else if(r===n.GeometryType.SPHERE)void 0===(h=this.getAttribute("sSurfaceDisplayType"))&&(h="Diameter"),e=[{name:"DMUMeasureSphereHdrStr",line:1,hdr_list:["DMUMeasureSurfaceDiameterHdr","DMUMeasureSurfaceRadiusHdr","DMUMeasureSurfaceAreaHdr"],selectedHdr:_="DMUMeasureSurface"+h+"Hdr"}];else if(r===n.GeometryType.PRODUCT){let t="DMUMeasurePrdHdrStr";_="DMUMeasureProduct"+this.getAttribute("sProductDisplayType")+"Hdr";var g=[];this.getAttribute("fVolume")>0&&(t="DMUMeasurePrdVolumeAreaHdrStr",g.push("DMUMeasureProductVolumeHdr")),g.push("DMUMeasureProductAreaHdr"),e=1===g.length?[{name:t,line:1,hdr_list:g,type:"handler"}]:[{name:t,line:1,hdr_list:g,selectedHdr:_}]}}return e},getContextualCommandList:function(){var e=null;let r,n;if(this._executionContext&&!this._handler&&(this._handler=c(this._executionContext)),!this.isReadOnly()&&this.isInEdition()){if(this._isInCreationState&&("3dPlay"===this._typeApps||"3dPlayProPointPoint"===this._typeApps))return;if("3dPlay"===this._typeApps||"Geovia"===this._typeApps)return[{name:"DMUMeasureDeleteStr",line:1,hdr_list:["DMUMeasureDeleteHdr"]}];var l="Measure_DMUDefaultStyleHdr";this.compareAttributes([{name:"fOpacity",value:1},{name:"cFontColor",value:new i.Color("#000000")},{name:"sFontStyle",value:"normal"},{name:"cFillStyleColor",value:new i.Color("#ffffff")},{name:"bIsFilled",value:!1},{name:"bHasBorder",value:!1},{name:"sLineStylePattern",value:"1"},{name:"cLineStyleColor",value:new i.Color("#3d3d3d")},{name:"sLeaderStylePattern",value:"1"},{name:"cLeaderStyleColor",value:new i.Color("#3d3d3d")}])&&(this.compareAttributes([{name:"fLineStyleThicknessIndex",value:0}])||this.compareAttributes([{name:"fLineStyleThickness",value:1}]))&&(this.compareAttributes([{name:"fLeaderStyleThicknessIndex",value:0}])||this.compareAttributes([{name:"fLeaderStyleThickness",value:1}]))?l="Measure_DMULightStyleHdr":this.compareAttributes([{name:"fOpacity",value:1},{name:"cFontColor",value:new i.Color("#ffffff")},{name:"sFontStyle",value:"normal"},{name:"cFillStyleColor",value:new i.Color("#368ec4")},{name:"bIsFilled",value:!0},{name:"bHasBorder",value:!1},{name:"sLineStylePattern",value:"1"},{name:"cLineStyleColor",value:new i.Color("#3d3d3d")},{name:"sLeaderStylePattern",value:"1"},{name:"cLeaderStyleColor",value:new i.Color("#3d3d3d")}])&&(this.compareAttributes([{name:"fLineStyleThicknessIndex",value:0}])||this.compareAttributes([{name:"fLineStyleThickness",value:1}]))&&(this.compareAttributes([{name:"fLeaderStyleThicknessIndex",value:0}])||this.compareAttributes([{name:"fLeaderStyleThickness",value:1}]))?l="Measure_DMUMeasureStyleHdr":this.compareAttributes([{name:"fOpacity",value:1},{name:"cFontColor",value:new i.Color("#000000")},{name:"sFontStyle",value:"italic"},{name:"cFillStyleColor",value:new i.Color("#fee000")},{name:"bIsFilled",value:!0},{name:"bHasBorder",value:!1},{name:"sLineStylePattern",value:"1"},{name:"cLineStyleColor",value:new i.Color("#ff8a2e")},{name:"sLeaderStylePattern",value:"1"},{name:"cLeaderStyleColor",value:new i.Color("#ff8a2e")}])&&(this.compareAttributes([{name:"fLineStyleThicknessIndex",value:0}])||this.compareAttributes([{name:"fLineStyleThickness",value:1}]))&&(this.compareAttributes([{name:"fLeaderStyleThicknessIndex",value:0}])||this.compareAttributes([{name:"fLeaderStyleThickness",value:1}]))?l="Measure_DMUPostitStyleHdr":this.compareAttributes([{name:"fOpacity",value:1},{name:"cFontColor",value:new i.Color("#ffffff")},{name:"sFontStyle",value:"normal"},{name:"cFillStyleColor",value:new i.Color("#57b847")},{name:"bIsFilled",value:!0},{name:"bHasBorder",value:!1},{name:"sLineStylePattern",value:"1"},{name:"cLineStyleColor",value:new i.Color("#477738")},{name:"sLeaderStylePattern",value:"1"},{name:"cLeaderStyleColor",value:new i.Color("#477738")}])&&(this.compareAttributes([{name:"fLineStyleThicknessIndex",value:0}])||this.compareAttributes([{name:"fLineStyleThickness",value:1}]))&&(this.compareAttributes([{name:"fLeaderStyleThicknessIndex",value:0}])||this.compareAttributes([{name:"fLeaderStyleThickness",value:1}]))?l="Measure_DMUValidateStyleHdr":this.compareAttributes([{name:"fOpacity",value:1},{name:"cFontColor",value:new i.Color("#ffffff")},{name:"sFontStyle",value:"normal"},{name:"cFillStyleColor",value:new i.Color("#ff8a2e")},{name:"bIsFilled",value:!0},{name:"bHasBorder",value:!1},{name:"sLineStylePattern",value:"1"},{name:"cLineStyleColor",value:new i.Color("#8f4c00")},{name:"sLeaderStylePattern",value:"1"},{name:"cLeaderStyleColor",value:new i.Color("#8f4c00")}])&&(this.compareAttributes([{name:"fLineStyleThicknessIndex",value:0}])||this.compareAttributes([{name:"fLineStyleThickness",value:1}]))&&(this.compareAttributes([{name:"fLeaderStyleThicknessIndex",value:0}])||this.compareAttributes([{name:"fLeaderStyleThickness",value:1}]))?l="Measure_DMUWarningStyleHdr":this.compareAttributes([{name:"fOpacity",value:1},{name:"cFontColor",value:new i.Color("#ffffff")},{name:"sFontStyle",value:"bold"},{name:"cFillStyleColor",value:new i.Color("#cc092f")},{name:"bIsFilled",value:!0},{name:"bHasBorder",value:!1},{name:"sLineStylePattern",value:"1"},{name:"cLineStyleColor",value:new i.Color("#6d2828")},{name:"sLeaderStylePattern",value:"1"},{name:"cLeaderStyleColor",value:new i.Color("#6d2828")}])&&(this.compareAttributes([{name:"fLineStyleThicknessIndex",value:0}])||this.compareAttributes([{name:"fLineStyleThickness",value:1}]))&&(this.compareAttributes([{name:"fLeaderStyleThicknessIndex",value:0}])||this.compareAttributes([{name:"fLeaderStyleThickness",value:1}]))&&(l="Measure_DMUCautionStyleHdr");var o,m=[],d=[];if(s.isEnvActivated("measuredetaildisplay",!0)&&"2D"!==this.getAttribute("sMeasureOnGeometryType")&&(d=[{name:"DMUMeasureDisplayStr",line:1,hdr_list:["DMUMeasureDisplayHdr"],type:"handler",identifier:"DMUMeasureDisplayHdr"}]),this._isInCreationState)m=this.getCmdHdrsFor2DGeometries(),o=[{name:"Measure_DMUStylesStr",line:1,hdr_list:["Measure_DMUDefaultStyleHdr","Measure_DMULightStyleHdr","Measure_DMUMeasureStyleHdr","Measure_DMUPostitStyleHdr","Measure_DMUValidateStyleHdr","Measure_DMUWarningStyleHdr","Measure_DMUCautionStyleHdr"],selectedHdr:l},{name:"Measure_DMUIncreaseFontSizeStr",line:1,hdr_list:["Measure_DMUIncreaseFontSizeHdr"]},{name:"Measure_DMUDecreaseFontSizeStr",line:1,hdr_list:["Measure_DMUDecreaseFontSizeHdr"]}],d.length>0&&(o=d.concat(o));else{o=[{name:"Measure_DMUStylesStr",line:1,hdr_list:["Measure_DMUDefaultStyleHdr","Measure_DMULightStyleHdr","Measure_DMUMeasureStyleHdr","Measure_DMUPostitStyleHdr","Measure_DMUValidateStyleHdr","Measure_DMUWarningStyleHdr","Measure_DMUCautionStyleHdr"],selectedHdr:l},{name:"Measure_DMUIncreaseFontSizeStr",line:1,hdr_list:["Measure_DMUIncreaseFontSizeHdr"]},{name:"Measure_DMUDecreaseFontSizeStr",line:1,hdr_list:["Measure_DMUDecreaseFontSizeHdr"]},{name:"DMUGraphicPropertiesPanelStr",line:1,hdr_list:["DMUGraphicPropertiesPanelHdr"],type:"handler",identifier:"DMUGraphicPropertiesPanelHdr"}],d.length>0&&(o=d.concat(o));for(var p=t.getReviewContext({viewer:this._viewer}).getUIManager().getSelectedObjects(),_=!1,h=0;h<p.length;h++)if("Measure3PointsCircle"===p[h]._sType||"MeasureItem"===p[h]._sType&&(p[h]._sResultingType1===a.ResultType.CIRCLE||p[h]._sResultingType1===a.ResultType.CYLINDER||p[h]._sResultingType1===a.ResultType.SPHERE)){if(p[h]._sResultingType1===a.ResultType.CYLINDER||p[h]._sResultingType1===a.ResultType.SPHERE){var M=this.getAttribute("sSurfaceDisplayType");if("Radius"===M||"Diameter"===M||"MinimumRadius"===M||"MinimumDiameter"===M||"MaximumRadius"===M||"MaximumDiameter"===M){_=!0;break}}else _=!0;break}if(_){var y=this.compareAttributes([{name:"bRadiusDisplay",value:!0}])?"DMUMeasureRadiusHdr":"DMUMeasureDiameterHdr";Math.abs(2*Math.PI-this.getMeasurable(1)._arcAngle)>.001&&this.getAttribute("bArcLengthDisplay")||m.push({name:"DMUMeasureRadiusDiaHdrStr",line:1,hdr_list:["DMUMeasureDiameterHdr","DMUMeasureRadiusHdr"],selectedHdr:y})}}o&&o.length&&"Measure_DMUStylesStr"===o[0].name&&o[0].selectedHdr&&(n={},n.radioGroupID=u[o[0].name],n.radioHdrID=o[0].selectedHdr.replace("_","")),m&&m.length&&m[0].name&&m[0].selectedHdr&&(r={},r.radioGroupID=u[m[0].name],r.radioHdrID=m[0].selectedHdr.replace("DMU","")),e=m.length>0?m.concat(o):o,"DMUTemporaryBag"===this.getParent().getType()&&(this._isInCreationState||(e=e.concat([{name:"DMUMeasureDeleteStr",line:1,hdr_list:["DMUMeasureDeleteHdr"]}])))}let v=e;return this._executionContext&&e&&e.length>0&&(r&&this._handler&&r.radioGroupID&&r.radioHdrID&&this._handler.setRadioItemState({id:r.radioHdrID,radioId:r.radioGroupID,state:!0,args:{ID:r.radioHdrID,Value:null}}),n&&n.radioGroupID&&n.radioHdrID&&this._handler.setRadioItemState({id:n.radioHdrID,radioId:n.radioGroupID,state:!0,args:{ID:n.radioHdrID,Value:null}}),v=[],e.forEach((e=>{e&&e.hdr_list&&e.name&&u[e.name]&&v.push({type:"handler",identifier:u[e.name]})}))),v},getSharedHeaderTypes:function(){var e=!1,t=!1,a=!1;return this.getAttribute("sLeaderEndType")&&(e=!0),this.getAttribute("sPointType")&&(t=!0),this.getAttribute("sExtremityType")&&(a=!0),{fontProperties:!0,leaderProperties:e,hideShowLeaderProperties:!1,pointTypeProperties:t,extremityTypeProperties:a}},getSharedContextualMenuCommandList:function(e){var t=[];e&&e.length&&e.forEach((function(e){-1===t.indexOf(e.getType())&&t.push(e.getType())}));var i,r=!1,n=!0,u=!1,d=!1,p=!1,_=!0,h=!0,M=!0;this.cmdHdrState_list=[];for(var y=0;y<e.length;y++){if(e[y].getSharedHeaderTypes){var v=e[y].getSharedHeaderTypes();v?(v.leaderProperties?(r=!0,v.hideShowLeaderProperties&&(u=!0)):n=!1,v.pointTypeProperties&&(d=!0),v.extremityTypeProperties&&(p=!0)):(r=!1,d=!1,p=!1)}!n||e[0].getAttribute("sLeaderEndType")===e[y].getAttribute("sLeaderEndType")&&e[0].getAttribute("bHasALeader")===e[y].getAttribute("bHasALeader")||(n=!1),_&&e[0].getAttribute("sPointType")!==e[y].getAttribute("sPointType")&&(_=!1),h&&e[0].getAttribute("sExtremityType")!==e[y].getAttribute("sExtremityType")&&(h=!1),M&&e[0].getAttribute("bShortDisplay")!==e[y].getAttribute("bShortDisplay")&&(M=!1)}if(r&&(i={line:1,name:"DMULeaderStr",hdr_list:["DMUArrowLeaderHdr","DMUBubbleLeaderHdr","DMUCrossLeaderHdr","DMUSquareLeaderHdr","DMUNoEndLeaderHdr"],resourceFile:"DMUBaseCtxCommands/DMUBaseCtxCommands"},u&&i.hdr_list.push("DMUNoLeaderHdr"),e.length>0)){var g=!1,D=!1,S=!1,f=!1,b=!1,C=!1;if(n){var T=e[0].getAttribute("sLeaderEndType");switch(e[0].getAttribute("bHasALeader")||(T="None"),T){case"Arrow":g=!0;break;case"Bubble":D=!0;break;case"Cross":S=!0;break;case"Square":f=!0;break;case"No end":b=!0;break;case"None":C=!0}}for(var P=[{name:"DMUArrowLeaderHdr",state:g},{name:"DMUBubbleLeaderHdr",state:D},{name:"DMUCrossLeaderHdr",state:S},{name:"DMUSquareLeaderHdr",state:f},{name:"DMUNoEndLeaderHdr",state:b},{name:"DMUNoLeaderHdr",state:C}],A=0;A<P.length;A++)this.cmdHdrState_list.push(P[A])}if(d){var U=!1,E=!1,I=!1,R=!1,w=!1,k=!1,L=!1,x=!1,N=!1,G=!1,H=e[0].getAttribute("sPointType");if(_)switch(H){case"Cross":U=!0;break;case"Plus":E=!0;break;case"Concentric":I=!0;break;case"Coincident":R=!0;break;case"FullCircle":w=!0;break;case"FullSquare":k=!0;break;case"Star":L=!0;break;case"Dot":x=!0;break;case"SmallDot":N=!0;break;case"None":G=!0}for(var O=[{name:"DMUCrossPointTypeHdr",state:U},{name:"DMUPlusPointTypeHdr",state:E},{name:"DMUConcentricPointTypeHdr",state:I},{name:"DMUCoincidentPointTypeHdr",state:R},{name:"DMUFullCirclePointTypeHdr",state:w},{name:"DMUFullSquarePointTypeHdr",state:k},{name:"DMUStarPointTypeHdr",state:L},{name:"DMUDotPointTypeHdr",state:x},{name:"DMUSmallDotPointTypeHdr",state:N},{name:"DMUNonePointTypeHdr",state:G}],F=0;F<O.length;F++)this.cmdHdrState_list.push(O[F])}if(p){var V=e[0].getAttribute("sExtremityType"),B=!1,W=!1,j=!1,z=!1,K=!1,X=!1,q=!1,Y=!1,J=!1,Q=!1;if(h)switch(V){case"Cross":B=!0;break;case"Plus":W=!0;break;case"Concentric":j=!0;break;case"Coincident":z=!0;break;case"FullCircle":K=!0;break;case"FullSquare":X=!0;break;case"Star":q=!0;break;case"Dot":Y=!0;break;case"SmallDot":J=!0;break;case"None":Q=!0}for(var Z=[{name:"DMUCrossExtremityTypeHdr",state:B},{name:"DMUPlusExtremityTypeHdr",state:W},{name:"DMUConcentricExtremityTypeHdr",state:j},{name:"DMUCoincidentExtremityTypeHdr",state:z},{name:"DMUFullCircleExtremityTypeHdr",state:K},{name:"DMUFullSquareExtremityTypeHdr",state:X},{name:"DMUStarExtremityTypeHdr",state:q},{name:"DMUDotExtremityTypeHdr",state:Y},{name:"DMUSmallDotExtremityTypeHdr",state:J},{name:"DMUNoneExtremityTypeHdr",state:Q}],$=0;$<Z.length;$++)this.cmdHdrState_list.push(Z[$])}var ee=[],te=s.isEnvActivated("measuredetaildisplay",!0);if(!this._isInCreationState&&"MeasureItem"===this._sType&&this.getAttribute("sResultingType1")===a.ResultType.PRODUCT){var ae=this.getListPointedReferencesPath();ae&&ae.length&&ee.push({line:1,name:"DMUSelectMeasuredPrdHdrStr",hdr_list:["DMUSelectMeasuredPrdHdr"]})}if(te||ee.push({line:1,name:"DMUPropertiesStr",hdr_list:["DMUPropertiesHdr"],state:!0}),"Angle"===this.getAttribute("sDistanceType")&&this._isInCreationState){var ie=this.getAttribute("fQuadrant"),re=this.getAttribute("bComplementaryAngle");ee.push({line:1,name:"DMUAngleSectorStr1",hdr_list:["DMUMeasureAngleSector1Hdr"]}),ee.push({line:1,name:"DMUAngleSectorStr2",hdr_list:["DMUMeasureAngleSector2Hdr"]}),ee.push({line:1,name:"DMUAngleSectorStr3",hdr_list:["DMUMeasureAngleSector3Hdr"]}),ee.push({line:1,name:"DMUAngleSectorStr4",hdr_list:["DMUMeasureAngleSector4Hdr"]}),ee.push({line:1,name:"DMUAngleSectorStrC",hdr_list:["DMUMeasureAngleSectorCHdr"]}),this.cmdHdrState_list.push({name:"DMUMeasureAngleSector1Hdr",state:0===ie}),this.cmdHdrState_list.push({name:"DMUMeasureAngleSector2Hdr",state:1===ie}),this.cmdHdrState_list.push({name:"DMUMeasureAngleSector3Hdr",state:3===ie}),this.cmdHdrState_list.push({name:"DMUMeasureAngleSector4Hdr",state:2===ie}),this.cmdHdrState_list.push({name:"DMUMeasureAngleSectorCHdr",state:re})}if(1===t.length&&-1!==t[0].indexOf("DMUMeasure")){if("DMUTemporaryBag"===this.getParent().getType()){if("2D"!==this.getAttribute("sMeasureOnGeometryType")||!this._isInCreationState&&"2D"===this.getAttribute("sMeasureOnGeometryType")){var se=this.getParent().getDMUObjects("DMUMeasure");se&&se.length>1&&ee.push({line:1,name:"DMUMeasureRemoveAllNonPersistentStr",hdr_list:["DMUMeasureRemoveAllNonPersistentHdr"]})}}else{if(this.isEditable()){this._isInCreationState||(ee.push({line:1,name:"DMUCutStr",hdr_list:["DMUCutHdr"]}),ee.push({line:1,name:"DMUCopyStr",hdr_list:["DMUCopyHdr"]}),ee.push({line:1,name:"DMUHideShowStr",hdr_list:["DMUHideShowHdr"]}));var ne=!0;if(void 0!==e&&e.length>0)for(var le=0;le<e.length;le++){if(e[le].getAttribute("sResultingType1")!==a.ResultType.CIRCLE&&"Measure3PointsCircle"!==e[le].getAttribute("sType")){ne=!1;break}"2D"===e[le].getAttribute("sMeasureOnGeometryType")&&e[le].getAttribute("bArcLengthDisplay")&&(ne=!1);break}ne&&ee.push({line:1,name:"DMUMeasureDimensionRepresentationHdr",hdr_list:["DMUMeasureArcCenterDisplayHdr","DMUMeasureArcTangentDisplayHdr"],resourceFile:"DMUMeasure/DMUMeasure"})}this._isInCreationState||ee.push({line:1,name:"DMUDeleteStr",hdr_list:["DMUDeleteHdr"]})}this.isEditable()&&(r&&ee.push(i),d&&this.getPointTypeHdr&&ee.push(this.getPointTypeHdr()),p&&this.getExtremityTypeHdr&&ee.push(this.getExtremityTypeHdr()),"2D"===this.getAttribute("sMeasureOnGeometryType")&&te&&(ee.push({name:"DMUMeasure2DDisplayStr",line:1,hdr_list:["DMUMeasure2DDisplayHdr"]}),M&&this.cmdHdrState_list.push({name:"DMUMeasure2DDisplayHdr",state:!e[0].getAttribute("bShortDisplay")})))}let oe=ee;var ue,me,ce,de,pe,_e=this;this._executionContext&&ee&&ee.length>0&&(_e._handler||(_e._handler=c(this._executionContext)),oe=[],ee.forEach((e=>{if(e&&e.hdr_list&&e.hdr_list.length){let a=[];if(e.hdr_list.length>1){let i=e.hdr_list;for(var t=0;t<i.length;++t){ue=i[t];let e=m.submenuList[ue].identifier;de=m.submenuList[e].type,ce=void 0;const r=_e.cmdHdrState_list.find((t=>t.name===e));"RadioItem"!==de&&"CheckItem"!==de||r&&r.state&&(ce="selected"),me=m.submenuList[e].iconPath?l.getWebappsAssetUrl(m.submenuList[e].module,m.submenuList[e].iconPath):void 0;let s={type:de,handlerId:e,title:o[e]?o[e]:e,icon:me,state:ce,action:{this:_e,callback:function(e){_e._handler||(_e._handler=c(_e._executionContext)),e&&_e._handler.executeHandler({id:e})}.bind(this,e)}};a.push(s)}}ue=e.hdr_list[0],pe=a.length>0?m.mainMenuList[e.name].identifier:m.mainMenuList[ue].identifier,de=m.mainMenuList[pe].type,me=m.mainMenuList[pe].iconPath?l.getWebappsAssetUrl(m.mainMenuList[pe].module,m.mainMenuList[pe].iconPath):void 0,ce=void 0;const i=_e.cmdHdrState_list.find((e=>e.name===pe));"RadioItem"!==de&&"CheckItem"!==de||i&&i.state&&(ce="selected");let r={type:de,handlerId:pe,title:o[pe]?o[pe]:pe,icon:me,state:ce,action:a.length>0?void 0:{this:_e,callback:function(e){_e._handler||(_e._handler=c(_e._executionContext)),e&&_e._handler.executeHandler({id:e})}.bind(this,pe)}};a.length>0&&(r.submenu=a),oe.push(r)}})));return oe},register:function(e){this._parent({frmWindow:e.frmWindow,contextualBar:{type:"DMUMeasure",module:"DMUMeasure",workbenchName:"DMUMeasure"},contextualMenu:{type:"DMUMeasure",module:"DMUMeasure",workbenchName:"DMUMeasure"}})},unregister:function(e){this._parent({frmWindow:e.frmWindow,contextualBar:{type:"DMUMeasure",module:"DMUMeasure",workbenchName:"DMUMeasure"},contextualMenu:{type:"DMUMeasure",module:"DMUMeasure",workbenchName:"DMUMeasure"}})},applyStateToContextHdr:function(e){if(e.length>0)for(var t=0;t<e.length;t++){var a=r.getCommand(e[t].name,"Default");a&&a.setState&&a.setState(e[t].state)}},getPointTypeHdr:function(){return{line:1,name:"DMUPointTypeStr",hdr_list:["DMUCrossPointTypeHdr","DMUPlusPointTypeHdr","DMUConcentricPointTypeHdr","DMUCoincidentPointTypeHdr","DMUFullCirclePointTypeHdr","DMUFullSquarePointTypeHdr","DMUStarPointTypeHdr","DMUDotPointTypeHdr","DMUSmallDotPointTypeHdr","DMUNonePointTypeHdr"],resourceFile:"DMUBaseCtxCommands/DMUBaseCtxCommands"}},getExtremityTypeHdr:function(){return{line:1,name:"DMUExtremityTypeStr",hdr_list:["DMUCrossExtremityTypeHdr","DMUPlusExtremityTypeHdr","DMUConcentricExtremityTypeHdr","DMUCoincidentExtremityTypeHdr","DMUFullCircleExtremityTypeHdr","DMUFullSquareExtremityTypeHdr","DMUStarExtremityTypeHdr","DMUDotExtremityTypeHdr","DMUSmallDotExtremityTypeHdr","DMUNoneExtremityTypeHdr"],resourceFile:"DMUBaseCtxCommands/DMUBaseCtxCommands"}},setCheckCmdHdrState:function(e){this.applyStateToContextHdr&&e.length>0&&this.applyStateToContextHdr(e)}})})),define("DS/DMUMeasure/DMUMeasureContextCmd",["DS/CATWebUXComponents/DMUCommand","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/CATWebUXComponents/DMUCommandsManager","DS/DMUBaseExperience/DMUContextManager"],(function(e,t,a,i,r){"use strict";var s,n,l=e.extend({init:function(e){var i=e||{};if(i.mode="shared",this._parent(i),i&&(this._executionContext=i.executionContext),!this._viewer){if(this._executionContext){let e=this._executionContext.getComponent("Viewer");e&&e.getViewer&&(this._viewer=e.getViewer())}this._viewer||(this._viewer=this.getFrameWindow().getViewer())}this._bCmdState=!1;var s=function(e,t,a){e.setAttribute("bRadiusDisplay",a),"Measure3PointsAngle"===e.getAttribute("sType")&&(e.setAttribute("sType","Measure3PointsCircle"),e.setAttribute("sDistanceType","none"),localStorage.setItem("DMUMeasure3PointsDisplayPreferences","CircleBy3Points"),e.update()),e._sMeasurable1&&e._sMeasurable1.getArcAngle&&Math.abs(2*Math.PI-e._sMeasurable1.getArcAngle())>.001&&localStorage.setItem("DMUMeasureArcRadiusPreferences",t),e.updateGlobalRadiusPreference(a),e.getAttribute("bArcLengthDisplay")&&e.setAttribute("bArcLengthDisplay",!1),e.update2DArcDisplay(),e.updateMainValueDisplayAsPerPref()},n=function(e){e.getParent().removeDMUObjects?e.getParent().removeDMUObjects([e]):e.getParent().getCurrentSlide().removeDMUObject(e)},l=function(e){"Measure3PointsCircle"===e.getAttribute("sType")?(e.setAttribute("sType","Measure3PointsAngle"),e.setAttribute("sDistanceType","Angle"),localStorage.setItem("DMUMeasure3PointsDisplayPreferences","AngleBy3Points")):e.updateFeatureAndDistanceTypePreference("Angle"),e.getNode().cleanAngleCache(),e.update()};this.beginExecute=function(){var e,i,o,u,m=this,c=this._viewer?this._viewer:this.getFrameWindow().getViewer(),d=t.get();d.length>0&&(e=r.getReviewContext({viewer:c}))&&("DMUSelectMeasuredPrdHdr"===m._id?function(){if(!d||!e)return;let i=[];for(var r=0;r<d.length;r++)i.push(e.getDMUObjectFromPathElement(d[r].pathElement));a.empty(),t.empty(),i.forEach((e=>{e&&e.selectPointedReferencesPath&&e.selectPointedReferencesPath()}))}():function(){for(var t=0;t<d.length;t++){var a=e.getDMUObjectFromPathElement(d[t].pathElement);if(a){switch(m._id){case"DMUMeasureArcLengthHdr":a.setAttribute("bArcLengthDisplay",!0),localStorage.setItem("DMUMeasureArcRadiusPreferences","DisplayArcLength"),a.update2DArcDisplay(),a.updateMainValueDisplayAsPerPref();break;case"DMUMeasureDiameterHdr":s(a,"DisplayDiameter",!1);break;case"DMUMeasureRadiusHdr":s(a,"DisplayRadius",!0);break;case"DMUMeasure2DDisplayHdr":(r=a).setAttribute("bShortDisplay",!r.getAttribute("bShortDisplay")),r.getAttribute("bShortDisplay")?localStorage.setItem("DMUMeasureDisplayPreference","Short"):localStorage.setItem("DMUMeasureDisplayPreference","Extended");break;case"DMUMeasureDisplayHdr":a.setAttribute("bShortDisplay",!a.getAttribute("bShortDisplay"));break;case"DMUMeasureAngleHdr":l(a);break;case"DMUMeasureDistanceHdr":a.updateFeatureAndDistanceTypePreference("Distance"),a.update();break;case"DMUMeasureMinDistanceHdr":a.updateFeatureAndDistanceTypePreference("MinimumDistance"),a.update();break;case"DMUMeasureLocalMinDistanceHdr":a.updateFeatureAndDistanceTypePreference("LocalMinimumDistance"),a.update();break;case"DMUMeasureMaxDistanceHdr":a.updateFeatureAndDistanceTypePreference("MaximumDistance"),a.update();break;case"DMUMeasureLocalMaxDistanceHdr":a.updateFeatureAndDistanceTypePreference("LocalMaximumDistance"),a.update();break;case"DMUMeasureSurfaceRadiusHdr":a.setAttribute("bRadiusDisplay",!0),a.updateFeatureAndSurfaceDisplayTypePreference("Radius"),a.update();break;case"DMUMeasureSurfaceDiameterHdr":a.setAttribute("bRadiusDisplay",!1),a.updateFeatureAndSurfaceDisplayTypePreference("Diameter"),a.update();break;case"DMUMeasureSurfaceMaximumRadiusHdr":a.setAttribute("bRadiusDisplay",!0),a.updateFeatureAndSurfaceDisplayTypePreference("MaximumRadius"),a.update();break;case"DMUMeasureSurfaceMaximumDiameterHdr":a.setAttribute("bRadiusDisplay",!1),a.updateFeatureAndSurfaceDisplayTypePreference("MaximumDiameter"),a.update();break;case"DMUMeasureSurfaceMinimumRadiusHdr":a.setAttribute("bRadiusDisplay",!0),a.updateFeatureAndSurfaceDisplayTypePreference("MinimumRadius"),a.update();break;case"DMUMeasureSurfaceMinimumDiameterHdr":a.setAttribute("bRadiusDisplay",!1),a.updateFeatureAndSurfaceDisplayTypePreference("MinimumDiameter"),a.update();break;case"DMUMeasureSurfaceLengthHdr":a.updateFeatureAndSurfaceDisplayTypePreference("Length"),a.update();break;case"DMUMeasureSurfaceAreaHdr":a.updateFeatureAndSurfaceDisplayTypePreference("Area"),a.update();break;case"DMUMeasureSurfaceAngleHdr":a.updateFeatureAndSurfaceDisplayTypePreference("Angle"),a.update();break;case"DMUMeasureSurfaceHalfAngleHdr":a.updateFeatureAndSurfaceDisplayTypePreference("HalfAngle"),a.update();break;case"DMUMeasureProductAreaHdr":a.updateFeatureAndProductDisplayTypePreference("Area"),a.update();break;case"DMUMeasureProductVolumeHdr":a.updateFeatureAndProductDisplayTypePreference("Volume"),a.update();break;case"DMUMeasureAngleSector1Hdr":if(i=a.getAttribute("fAngle"),o=a.getAttribute("fQuadrant"),u=a.getAttribute("bComplementaryAngle"),0===o)break;1!==o&&2!==o||(u?a.setAttribute("fAngle",3*Math.PI-i):a.setAttribute("fAngle",Math.PI-i)),a.setAttribute("fQuadrant",0),a.updateAngleValues();break;case"DMUMeasureAngleSector2Hdr":if(i=a.getAttribute("fAngle"),o=a.getAttribute("fQuadrant"),u=a.getAttribute("bComplementaryAngle"),1===o)break;0!==o&&3!==o||(u?a.setAttribute("fAngle",3*Math.PI-i):a.setAttribute("fAngle",Math.PI-i)),a.setAttribute("fQuadrant",1),a.updateAngleValues();break;case"DMUMeasureAngleSector3Hdr":if(i=a.getAttribute("fAngle"),o=a.getAttribute("fQuadrant"),u=a.getAttribute("bComplementaryAngle"),3===o)break;1!==o&&2!==o||(u?a.setAttribute("fAngle",3*Math.PI-i):a.setAttribute("fAngle",Math.PI-i)),a.setAttribute("fQuadrant",3),a.updateAngleValues();break;case"DMUMeasureAngleSector4Hdr":if(i=a.getAttribute("fAngle"),o=a.getAttribute("fQuadrant"),u=a.getAttribute("bComplementaryAngle"),2===o)break;0!==o&&3!==o||(u?a.setAttribute("fAngle",3*Math.PI-i):a.setAttribute("fAngle",Math.PI-i)),a.setAttribute("fQuadrant",2),a.updateAngleValues();break;case"DMUMeasureAngleSectorCHdr":i=a.getAttribute("fAngle"),u=a.getAttribute("bComplementaryAngle"),a.setAttribute("bComplementaryAngle",!u),a.setAttribute("fAngle",2*Math.PI-i),a.updateAngleValues();break;case"DMUMeasureDeleteHdr":n(a),t--}a.refreshNode()}}var r}(),c.render(),e.getCurrentSessionMarkup()&&e.getCurrentSessionMarkup().isVisible()&&e.getCurrentSessionMarkup().getCurrentSlide()&&e.getCurrentSessionMarkup().getCurrentSlide().fireEvent("onSlidePreviewRefreshRequired",{dmuObject:e.getCurrentSessionMarkup().getCurrentSlide()})),this.done()}},getState:function(){return this._bCmdState},setState:function(e){this._bCmdState=e}});return l.executeContextualBarCmd=function(e,a){if(!s&&a.executionContext&&(s=a.executionContext),a&&a.args&&a.args.Value){let e=0;var l=setInterval((function(){e++;var o,u=t.get();if(1===u.length){if(!n){let e=s.getComponent("Viewer");e&&e.getViewer&&(n=e.getViewer())}if(n){var m=r.getReviewContext({viewer:n});if(m){var c=m.getDMUObjectFromPathElement(u[0].pathElement);c&&c.getType&&"DMUMeasure"===c.getType()&&(o=!0)}}}if(o){let t=i.getCommand(a.args.Value,s);t&&t.begin?(t.begin(),clearInterval(l)):e>20&&clearInterval(l)}else clearInterval(l)}),100)}e&&e()},l.executeContextualBarCmdUnset=function(e){e&&e()},l})),define("DS/DMUMeasure/DMUMeasureBaseCmd",["DS/DMUBaseCommands/EXPStateCommand","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUBaseExperience/EXPUtils","DS/DMUMeasurable/DMUGeometryEnums","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUMeasurable/DMUMeasurableElementAgent","DS/DMUBaseUIControllers/DMUReviewContextInitializer","DS/DMUMeasurable/DMUMeasurable","DS/Web3DUXAssistantTools/Web3DUXAssistantTools","DS/Web3DUXFilterBar/Web3DUXVerticalBar","DS/DMUPlayMeasure/DMUMeasure","DS/DMUMeasurable/DMUMeasureEnums","DS/Visualization/ThreeJS_DS","DS/Visualization/PathElement","DS/LevelSelector/LevelSelector","DS/CoreEvents/Events","DS/WebappsUtils/WebappsUtils","DS/Mesh/Mesh","DS/DMUMeasurable/DMUMathsInfiniteGeometry","DS/Mesh/MeshUtils","DS/DMUBaseExperience/DMUContextManager","DS/CATWebUXComponents/DMUCommandsManager","UWA/Core","UWA/Utils","DS/CATWebUXPreferences/CATWebUXPreferencesManager","DS/CATWebUXSelectionManager/CATWebUXSelectionManager","DS/DMUMeasurable/DMUPreVisuNode3D","DS/Selection/CSOManager","DS/DMUBaseExperience/EXPControllerEvents","DS/DMUMeasurable/DMUSwitchRepService","DS/CATWebUXPreferences/CATWebUXPreferencesUtils","DS/DMUBaseUIControllers/DMUWebPreferencesController","DS/DMUBaseUIServices/DMUObjectsServices","DS/DMUMeasurable/DMUToolsMeasure","DS/Selection/HSOManager","DS/Selection/PSOManager","DS/Windows/ImmersiveFrame","DS/DMUMeasure/CATWebUXMultiSelectionPanel","i18n!DS/DMUMeasure/assets/nls/DMUMeasure","i18n!DS/CATWebUXPreferences/assets/nls/CATWebUXPreferences","css!DS/DMUMeasure/DMUMeasure.css"],(function(e,t,a,i,r,s,n,l,o,u,m,c,d,p,_,h,M,y,v,g,D,S,f,b,C,T,P,A,U,E,I,R,w,k,L,x,N,G,H,O){"use strict";var F,V,B,W;require(["DS/PADUtils/PADSettingsMgt","DS/PADUtils/views/PADAlert"],(function(e,t){F=e,V=t})),localStorage.removeItem("DMUMeasureSelectionFilter");var j=e.extend({init:function(e,t,i){let r=this;this._parent(e,t,i);let s=e.args?e.args:void 0;if(s){let t=Object.keys(s),a=Object.values(s);this._arguments=[];for(let e=0;e<t.length-1;e++)this._arguments.push({ID:t[e],Value:a[e]});this._isRunning=!1,e.args._pathElementAgentWithCSO&&(this._pathElementAgentWithCSO=e.args._pathElementAgentWithCSO),e.args._pathElementAgentWithoutCSO&&(this._pathElementAgentWithoutCSO=e.args._pathElementAgentWithoutCSO)}this._bEnablePrevisualization=!0,this._keepDefaultController=!0,this._notPickableList=[],this._removePreviousNonPersistent=!0,this._objAction=!1,this._bPOISelection=!1,this._bCumulativeMeas=!1,this._multiSelectionPanel=null,this._multiSelectionNames=[],this._bIsMultiSelectionPanelCreated=!1,"ProgressiveVisuLoading"===this._arguments[0].ID&&(this._measureCommandMode="ProgressiveVisuLoading"),this._arguments&&this._arguments.length&&this._arguments.forEach((e=>{"Thickness"!==e.ID&&"Thickness"!==e.Value||(this._measureThickness=!0),"MeasureOn2D"===e.ID&&"true"===e.Value?this._measureOnGeometryType="2D":"RemoveNonPersistent"===e.ID&&"false"===e.Value?this._removePreviousNonPersistent=!1:"RepeatMode"===e.ID&&e.Value?this._repeatType=e.Value:"3dPlayProPointPoint"!==e.ID&&"3dPlay"!==e.ID&&"3dPlayProPointPoint"!==e.Value&&"3dPlay"!==e.Value||(this._measureCommandMode="3dPlay")})),this._defaultDistanceTypes=[{key:"PointPoint",value:"Distance"},{key:"PointLine",value:"MinimumDistance"},{key:"PointCurve",value:"MinimumDistance"},{key:"PointArc",value:"MinimumDistance"},{key:"PointCircle",value:"Distance"},{key:"PointPlane",value:"Distance"},{key:"PointCylinder",value:"Distance"},{key:"PointCone",value:"Distance"},{key:"PointSphere",value:"Distance"},{key:"PointSurface",value:"MinimumDistance"},{key:"PointProduct",value:"MinimumDistance"},{key:"LineLine",value:"Angle"},{key:"LineLineParallel",value:"Distance"},{key:"LineCurve",value:"MinimumDistance"},{key:"LineArc",value:"MinimumDistance"},{key:"LineCircle",value:"Distance"},{key:"LinePlane",value:"Angle"},{key:"LinePlaneNormalPerpendicular",value:"Distance"},{key:"LineCylinder",value:"Angle"},{key:"LineCylinderParallel",value:"Distance"},{key:"LineCone",value:"Angle"},{key:"LineConeParallel",value:"Distance"},{key:"LineSphere",value:"Distance"},{key:"LineSurface",value:"MinimumDistance"},{key:"LineProduct",value:"MinimumDistance"},{key:"CurveCurve",value:"MinimumDistance"},{key:"CurveArc",value:"MinimumDistance"},{key:"CurveCircle",value:"Distance"},{key:"CurvePlane",value:"MinimumDistance"},{key:"CurveCylinder",value:"Distance"},{key:"CurveCone",value:"Distance"},{key:"CurveSphere",value:"Distance"},{key:"CurveSurface",value:"MinimumDistance"},{key:"CurveProduct",value:"MinimumDistance"},{key:"ArcArc",value:"MinimumDistance"},{key:"ArcCircle",value:"MinimumDistance"},{key:"ArcPlane",value:"MinimumDistance"},{key:"ArcCylinder",value:"MinimumDistance"},{key:"ArcCone",value:"MinimumDistance"},{key:"ArcSphere",value:"MinimumDistance"},{key:"ArcSurface",value:"MinimumDistance"},{key:"ArcProduct",value:"MinimumDistance"},{key:"CircleCircle",value:"Distance"},{key:"CirclePlane",value:"Distance"},{key:"CircleCylinder",value:"Distance"},{key:"CircleCone",value:"Distance"},{key:"CircleSphere",value:"Distance"},{key:"CircleSurface",value:"Distance"},{key:"CircleProduct",value:"Distance"},{key:"PlanePlane",value:"Angle"},{key:"PlanePlaneParallel",value:"Distance"},{key:"PlaneCylinder",value:"Angle"},{key:"PlaneCone",value:"Angle"},{key:"PlaneCylinderParallel",value:"Distance"},{key:"PlaneConeParallel",value:"Distance"},{key:"PlaneSphere",value:"MinimumDistance"},{key:"PlaneSurface",value:"MinimumDistance"},{key:"PlaneProduct",value:"MinimumDistance"},{key:"CylinderCylinder",value:"Angle"},{key:"CylinderCylinderParallel",value:"Distance"},{key:"CylinderCone",value:"Angle"},{key:"CylinderConeParallel",value:"Distance"},{key:"CylinderSphere",value:"Distance"},{key:"CylinderSurface",value:"Distance"},{key:"CylinderProduct",value:"MinimumDistance"},{key:"ConeCone",value:"Angle"},{key:"ConeConeParallel",value:"Distance"},{key:"ConeSphere",value:"Distance"},{key:"ConeSurface",value:"Distance"},{key:"ConeProduct",value:"MinimumDistance"},{key:"SphereSphere",value:"Distance"},{key:"SphereSurface",value:"Distance"},{key:"SphereProduct",value:"Distance"},{key:"SurfaceSurface",value:"MinimumDistance"},{key:"SurfaceProduct",value:"MinimumDistance"},{key:"ProductProduct",value:"MinimumDistance"}],r._switchRepInfo={clearTimeout:void 0,lockedNodeIds:[]},r._unlockNodes=function(){r._switchService&&r._switchRepInfo&r._switchRepInfo.lockedNodeIds&&r._switchRepInfo.lockedNodeIds.length&&(r._switchService.unlockNodes({nodeIDsToUnlock:r._switchRepInfo.lockedNodeIds,nodeIDsToUnlockMeshInRAM:r._switchRepInfo.lockedNodeIds}),r._switchRepInfo.lockedNodeIds=[])},r._iconDir=M.getWebappsAssetUrl("DMUMeasure","icons/32/"),!r._bEnablePrevisualization&&a.isEnvActivated("measurepreview",!0)&&(r._bEnablePrevisualization=!0);var n={};""!==window.location.search&&(f.extend(n,b.parseQuery(window.location.search)),n.widgetDomain&&f.extend(n,b.parseQuery(n.widgetDomain))),"MPVLOD"in n&&(r._mPVLOD=!0),D.setAuthoringFeatureTypes("Measure"),this._initPref(),this._partialMeasureDisplay=[null,null],this._firstSelectionLeafNodes=[],this._secondSelectionLeafNodes=[]},_measureCumulativeCB:function(e,t){this._repeatType=e?"None":"Item";var a=this._measurable?this._measurable.length:0;this._multiSelectionPanel&&a>1&&(e?this._multiSelectionPanel.show():t||this._multiSelectionPanel.hide())},addCumulativeKeyEvent:function(){var e=this,t=t=>{e._bCumulativeMeas=t,e._measureCumulativeCB(e._bCumulativeMeas,!0);let a=e.getCumulativeMeaurePref();a&&""!==a&&localStorage.setItem(a,e._bCumulativeMeas),e._bCumulativeMeas?e.publish({event:"cumulative",data:null}):e.publish({event:"noncumulative",data:null})};B||(B=function(a){e&&(!a.ctrlKey&&"Control"!==a.key&&17!==a.keyCode||e._bCumulativeMeas||(t(!0),e._enableSpecialCumulativeMeasure&&(document.removeEventListener("keydown",B),W||(W=function(a){e&&("Control"!==a.key&&17!==a.keyCode||(t(!1),document.removeEventListener("keyup",W),document.addEventListener("keydown",B)))}),document.addEventListener("keyup",W))))},document.addEventListener("keydown",B))},removeCumulativeKeyEvent:function(){W&&document.removeEventListener("keyup",W),B&&document.removeEventListener("keydown",B),W=void 0,B=void 0},_destroy:function(){this.removeCumulativeKeyEvent(),this._filterUI&&this._filterUI.clear(),this._eventController&&(this.CBTokenMeasureDelete&&this._eventController.removeEvent(this.CBTokenMeasureDelete),this.CBTokenSlideChanged&&this._eventController.removeEvent(this.CBTokenSlideChanged),this._eventController.fireEvent("onUnsetPickThroughRequest"),this._eventController=null),this._parent()},_initPref:function(){"2D"===this._measureOnGeometryType&&(localStorage.getItem("DMUMeasBetween2CirclesDistancePref")||localStorage.setItem("DMUMeasBetween2CirclesDistancePref","Distance"),localStorage.getItem("DMUMeasBetweenCircleArcDistancePref")||localStorage.setItem("DMUMeasBetweenCircleArcDistancePref","Distance"),localStorage.getItem("DMUMeasBetweenCircleAnygeomDistancePref")||localStorage.setItem("DMUMeasBetweenCircleAnygeomDistancePref","Distance"),localStorage.getItem("DMUMeasBetween2ArcsDistancePref")||localStorage.setItem("DMUMeasBetween2ArcsDistancePref","MinimumDistance"),localStorage.getItem("DMUMeasBetweenArcAnygeomDistancePref")||localStorage.setItem("DMUMeasBetweenArcAnygeomDistancePref","MinimumDistance"),localStorage.getItem("DMUMeasBetween2ParallelLinesDistancePref")||localStorage.setItem("DMUMeasBetween2ParallelLinesDistancePref","Distance"),localStorage.getItem("DMUMeasBetween2LinesDistancePref")||localStorage.setItem("DMUMeasBetween2LinesDistancePref","Angle"),localStorage.getItem("DMUMeasBetween2AnyGeomsDistancePref")||localStorage.setItem("DMUMeasBetween2AnyGeomsDistancePref","MinimumDistance"),localStorage.getItem("DMUMeasureDisplayPreference")||localStorage.setItem("DMUMeasureDisplayPreference","Short")),localStorage.getItem("DMUMeasureCircleRadiusPreferences")||localStorage.setItem("DMUMeasureCircleRadiusPreferences","DisplayDiameter"),localStorage.getItem("DMUMeasureRadiusResultDisplayPreferences")||localStorage.setItem("DMUMeasureRadiusResultDisplayPreferences","CENTER"),localStorage.getItem("DMUMeasure3PointsCircleRadiusResultDisplayPreferences")||localStorage.setItem("DMUMeasure3PointsCircleRadiusResultDisplayPreferences","CENTER"),localStorage.getItem("DMUMeasureArcRadiusPreferences")||localStorage.setItem("DMUMeasureArcRadiusPreferences","DisplayRadius");for(var e=0;e<this._defaultDistanceTypes.length;e++)if(!localStorage.getItem("DMUMeasureDistanceType"+this._defaultDistanceTypes[e].key+"Preferences")){var t=this._defaultDistanceTypes[e].value;localStorage.setItem("DMUMeasureDistanceType"+this._defaultDistanceTypes[e].key+"Preferences",t)}localStorage.getItem("DMUMeasProductDisplayPref")||localStorage.setItem("DMUMeasProductDisplayPref","Volume"),localStorage.getItem("DMUMeasSurfaceDisplayCylinderPref")||localStorage.setItem("DMUMeasSurfaceDisplayCylinderPref","Diameter"),localStorage.getItem("DMUMeasSurfaceDisplayConePref")||localStorage.setItem("DMUMeasSurfaceDisplayConePref","HalfAngle"),localStorage.getItem("DMUMeasSurfaceDisplaySpherePref")||localStorage.setItem("DMUMeasSurfaceDisplaySpherePref","Diameter"),localStorage.getItem("DMUMeasure3PointsDisplayPreferences")||localStorage.setItem("DMUMeasure3PointsDisplayPreferences","AngleBy3Points")},_addChild:function(e,t){t.setPickParent(!0),t.setVisibilityInTree(!1),e.addChild(t)},_updateFilter:function(e){var t={acceptedGeometries:[],viewedGeometries:[]};return e.getActiveState("pickpoint")?t.viewedGeometries.push(c.ViewedType.POINT):e.getActiveState("product")?t.viewedGeometries.push(c.ViewedType.PRODUCT):(e.getActiveState("center")&&(t.acceptedGeometries.push(i.GeometryType.CIRCLE),t.acceptedGeometries.push(i.GeometryType.SPHERE),t.viewedGeometries.push(c.ViewedType.CENTER)),e.getActiveState("linecurve")&&(t.acceptedGeometries.push(i.GeometryType.LINE),t.acceptedGeometries.push(i.GeometryType.CIRCLE),t.acceptedGeometries.push(i.GeometryType.CURVE),t.viewedGeometries.push(c.ViewedType.CURVE)),e.getActiveState("axis")&&(t.acceptedGeometries.push(i.GeometryType.LINE),t.acceptedGeometries.push(i.GeometryType.CYLINDER),t.acceptedGeometries.push(i.GeometryType.CONE),t.viewedGeometries.push(c.ViewedType.AXIS)),e.getActiveState("circle")&&(t.acceptedGeometries.push(i.GeometryType.CIRCLE),t.viewedGeometries.push(c.ViewedType.CIRCLE)),e.getActiveState("surface")&&(t.acceptedGeometries.push(i.GeometryType.CYLINDER),t.acceptedGeometries.push(i.GeometryType.CONE),t.acceptedGeometries.push(i.GeometryType.SPHERE),t.acceptedGeometries.push(i.GeometryType.PLANE),t.acceptedGeometries.push(i.GeometryType.SURFACE),t.viewedGeometries.push(c.ViewedType.SURFACE)),e.getActiveState("plane")&&(t.acceptedGeometries.push(i.GeometryType.PLANE),t.viewedGeometries.push(c.ViewedType.INFPLANE)),e.getActiveState("cylinder")&&(t.acceptedGeometries.push(i.GeometryType.CYLINDER),t.acceptedGeometries.push(i.GeometryType.CONE),t.acceptedGeometries.push(i.GeometryType.SPHERE),t.viewedGeometries.push(c.ViewedType.CYCOSP)),e.getActiveState("allCanonicGeom")&&(t.acceptedGeometries.push(i.GeometryType.POINT),t.acceptedGeometries.push(i.GeometryType.LINE),t.acceptedGeometries.push(i.GeometryType.CIRCLE),t.acceptedGeometries.push(i.GeometryType.PLANE),t.acceptedGeometries.push(i.GeometryType.CYLINDER),t.acceptedGeometries.push(i.GeometryType.CONE),t.acceptedGeometries.push(i.GeometryType.SPHERE),t.viewedGeometries.push(c.ViewedType.POINT),t.viewedGeometries.push(c.ViewedType.CURVE),t.viewedGeometries.push(c.ViewedType.CIRCLE),t.viewedGeometries.push(c.ViewedType.INFPLANE),t.viewedGeometries.push(c.ViewedType.SURFACE),t.viewedGeometries.push(c.ViewedType.CYCOSP))),this._pathElementAgentWithCSO.options.acceptedGeometries=t.acceptedGeometries,this._pathElementAgentWithCSO.options.viewedGeometries=t.viewedGeometries,this._pathElementAgentWithoutCSO.options.acceptedGeometries=t.acceptedGeometries,this._pathElementAgentWithoutCSO.options.viewedGeometries=t.viewedGeometries,t},_createFilter:function(){var e,t=this,i=[];if(a.isEnvActivated("measure_OldSelectionFilter",!0)){var r,s={pickpoint:{bSelected:!1,bExclusive:!0},center:{bSelected:!1,bExclusive:!1},linecurve:{bSelected:!1,bExclusive:!1},axis:{bSelected:!1,bExclusive:!1},circle:{bSelected:!1,bExclusive:!1},surface:{bSelected:!1,bExclusive:!1},plane:{bSelected:!1,bExclusive:!1},cylinder:{bSelected:!1,bExclusive:!1},product:{bSelected:!1,bExclusive:!0}},n=function(){(e=localStorage.getItem("DMUMeasureSelectionFilter"))&&(r=JSON.parse(e))&&(s=r)};n(),t._activeFilter="SeveralGeometries",s.pickpoint.bSelected?t._activeFilter="pointOnly":s.product.bSelected&&(t._activeFilter="productOnly"),i=[{nls:H.point,url:this._iconDir+"I_Meas_Point.png",id:"pickpoint",type:"element",callback:function(){n(),t._filterUI.getActiveState("pickpoint")?(s.pickpoint.bSelected=!0,s.center.bSelected=!1,s.linecurve.bSelected=!1,s.axis.bSelected=!1,s.circle.bSelected=!1,s.surface.bSelected=!1,s.plane.bSelected=!1,s.cylinder.bSelected=!1,s.product.bSelected=!1,localStorage.setItem("DMUMeasureSelectionFilter",JSON.stringify(s)),t._activeFilter="pointOnly"):(s.pickpoint.bSelected=!1,localStorage.setItem("DMUMeasureSelectionFilter",JSON.stringify(s)),t._activeFilter="SeveralGeometries"),t._filteredGeometries=t._updateFilter(t._filterUI)},bexclude:!0,bstateActif:"3dPlay"===this._measureCommandMode||"Geovia"===this._arguments[0].ID||s.pickpoint.bSelected},{type:"separator"},{nls:H.center+"/"+H.point,url:this._iconDir+"I_Meas_PointCircle.png",id:"center",type:"element",callback:function(){n(),t._filterUI.getActiveState("center")?(s.pickpoint.bSelected=!1,s.product.bSelected=!1,s.center.bSelected=!0):s.center.bSelected=!1,localStorage.setItem("DMUMeasureSelectionFilter",JSON.stringify(s)),t._activeFilter="SeveralGeometries",t._filteredGeometries=t._updateFilter(t._filterUI)},bexclude:!1,bstateActif:s.center.bSelected},{nls:H.line+"/"+H.curve,url:this._iconDir+"I_Meas_LineCurve.png",id:"linecurve",type:"element",callback:function(){n(),t._filterUI.getActiveState("linecurve")?(s.pickpoint.bSelected=!1,s.product.bSelected=!1,s.linecurve.bSelected=!0):s.linecurve.bSelected=!1,localStorage.setItem("DMUMeasureSelectionFilter",JSON.stringify(s)),t._activeFilter="SeveralGeometries",t._filteredGeometries=t._updateFilter(t._filterUI)},bexclude:!1,bstateActif:s.linecurve.bSelected},{nls:H.axis+"/"+H.infiniteline,url:this._iconDir+"I_Meas_AxisInfiniteLine.png",id:"axis",type:"element",callback:function(){n(),t._filterUI.getActiveState("axis")?(s.pickpoint.bSelected=!1,s.product.bSelected=!1,s.axis.bSelected=!0):s.axis.bSelected=!1,localStorage.setItem("DMUMeasureSelectionFilter",JSON.stringify(s)),t._activeFilter="SeveralGeometries",t._filteredGeometries=t._updateFilter(t._filterUI)},bexclude:!1,bstateActif:s.axis.bSelected},{nls:H.circle,url:this._iconDir+"I_Meas_Circle.png",id:"circle",type:"element",callback:function(){n(),t._filterUI.getActiveState("circle")?(s.pickpoint.bSelected=!1,s.product.bSelected=!1,s.circle.bSelected=!0):s.circle.bSelected=!1,localStorage.setItem("DMUMeasureSelectionFilter",JSON.stringify(s)),t._activeFilter="SeveralGeometries",t._filteredGeometries=t._updateFilter(t._filterUI)},bexclude:!1,bstateActif:s.circle.bSelected},{nls:H.surface,url:this._iconDir+"I_Meas_Surface.png",id:"surface",type:"element",callback:function(){n(),t._filterUI.getActiveState("surface")?(s.pickpoint.bSelected=!1,s.product.bSelected=!1,s.surface.bSelected=!0):s.surface.bSelected=!1,localStorage.setItem("DMUMeasureSelectionFilter",JSON.stringify(s)),t._activeFilter="SeveralGeometries",t._filteredGeometries=t._updateFilter(t._filterUI)},bexclude:!1,bstateActif:t._measureThickness||s.surface.bSelected},{nls:H.plane,url:this._iconDir+"I_Meas_Plane.png",id:"plane",type:"element",callback:function(){n(),t._filterUI.getActiveState("plane")?(s.pickpoint.bSelected=!1,s.product.bSelected=!1,s.plane.bSelected=!0):s.plane.bSelected=!1,localStorage.setItem("DMUMeasureSelectionFilter",JSON.stringify(s)),t._activeFilter="SeveralGeometries",t._filteredGeometries=t._updateFilter(t._filterUI)},bexclude:!1,bstateActif:s.plane.bSelected},{nls:H.cylinder+"/"+H.cone+"/"+H.sphere,url:this._iconDir+"I_Meas_Cylinder.png",id:"cylinder",type:"element",callback:function(){n(),t._filterUI.getActiveState("cylinder")?(s.pickpoint.bSelected=!1,s.product.bSelected=!1,s.cylinder.bSelected=!0):s.cylinder.bSelected=!1,localStorage.setItem("DMUMeasureSelectionFilter",JSON.stringify(s)),t._activeFilter="SeveralGeometries",t._filteredGeometries=t._updateFilter(t._filterUI)},bexclude:!1,bstateActif:s.cylinder.bSelected},{type:"separator"},{nls:H.product,url:this._iconDir+"I_Meas_Product.png",id:"product",type:"element",callback:function(){n(),t._filterUI.getActiveState("product")?(t._activeFilter="productOnly",s.pickpoint.bSelected=!1,s.center.bSelected=!1,s.linecurve.bSelected=!1,s.axis.bSelected=!1,s.circle.bSelected=!1,s.surface.bSelected=!1,s.plane.bSelected=!1,s.cylinder.bSelected=!1,s.product.bSelected=!0,localStorage.setItem("DMUMeasureSelectionFilter",JSON.stringify(s))):(s.product.bSelected=!1,localStorage.setItem("DMUMeasureSelectionFilter",JSON.stringify(s)),t._activeFilter="SeveralGeometries"),t._filteredGeometries=t._updateFilter(t._filterUI)},bexclude:!0,bstateActif:s.product.bSelected}]}else{var l=!1,o=!1,m=!1,c=!1;switch(e=localStorage.getItem("DMUMeasureSelectionFilter")){case"pickpoint":t._activeFilter="pointOnly",l=!0;break;case"center":t._activeFilter="SeveralGeometries",m=!0;break;case"product":t._activeFilter="productOnly",o=!0;break;case"allCanonicGeom":t._activeFilter="SeveralGeometries",c=!0}i=[{nls:H.point,url:this._iconDir+"I_Meas_Point.png",id:"pickpoint",type:"element",callback:function(){t._filterUI.getActiveState("pickpoint")?(localStorage.setItem("DMUMeasureSelectionFilter","pickpoint"),t._activeFilter="pointOnly"):(localStorage.removeItem("DMUMeasureSelectionFilter"),t._activeFilter="SeveralGeometries"),t._filteredGeometries=t._updateFilter(t._filterUI)},bexclude:!0,bstateActif:"3dPlay"===this._measureCommandMode||"Geovia"===this._arguments[0].ID||l,bManageOpacity:!1},{type:"separator"},{nls:H.centerpoint,url:this._iconDir+"I_Meas_PointCircle.png",id:"center",type:"element",callback:function(){"center"===localStorage.getItem("DMUMeasureSelectionFilter")?localStorage.removeItem("DMUMeasureSelectionFilter"):localStorage.setItem("DMUMeasureSelectionFilter","center"),t._activeFilter="SeveralGeometries",t._filteredGeometries=t._updateFilter(t._filterUI)},bexclude:!0,bstateActif:m},{type:"separator"},{nls:H.canonicGeometries,url:this._iconDir+"I_Meas_AllGeom.png",id:"allCanonicGeom",type:"element",callback:function(){"allCanonicGeom"===localStorage.getItem("DMUMeasureSelectionFilter")?localStorage.removeItem("DMUMeasureSelectionFilter"):localStorage.setItem("DMUMeasureSelectionFilter","allCanonicGeom"),t._activeFilter="SeveralGeometries",t._filteredGeometries=t._updateFilter(t._filterUI)},bexclude:!0,bstateActif:c},{type:"separator"},{nls:H.product,url:this._iconDir+"I_Meas_Product.png",id:"product",type:"element",callback:function(){t._filterUI.getActiveState("product")?(localStorage.setItem("DMUMeasureSelectionFilter","product"),t._activeFilter="productOnly"):(localStorage.removeItem("DMUMeasureSelectionFilter"),t._activeFilter="SeveralGeometries"),t._filteredGeometries=t._updateFilter(t._filterUI)},bexclude:!0,bstateActif:o}]}this._filterUI=new u({body:this._frmWindow.getUIFrame(),frmWindow:this._frmWindow,title:"Filter Control",actionBar:this._frmWindow.getActionBar(),verticalPanel:!0,lBottom_content:i}),this._filterUI.build()},begin:function(){if(!this._isRunning){var e=S.getCommand(S.getCurrentCmdId(this._ctx),this._ctx),t=e&&e.getRequestedCommandMode?e.getRequestedCommandMode({cmd:"Measure"}):"exclusive";this._mode="shared"===t?"shared":"exclusive"}this._parent.apply(this,arguments)},setCommandMode:function(e){this._measureCommandMode=void 0,"PickingPointOnly"===e?this._measureCommandMode="3dAuthoringPickPoint":"ProgressiveVisuLoading"===e&&(this._measureCommandMode="ProgressiveVisuLoading"),this._filterUI&&this._filterUI.clear()},removeMeasureFromSession:function(e){var t=D.getReviewContext({viewer:this.getFrameWindow().getViewer()});if(t){t.getTransientReviewBag().removeDMUObjects([e]);var a=this.getMeasureContainer();a&&a.getCurrentSlide&&a.getCurrentSlide()&&a.getCurrentSlide().removeDMUObject(e);for(var i=this._createdMeasures.length-1;i>=0;i--)this._createdMeasures[i]===e&&this._createdMeasures.splice(i,1);this._viewer.render()}},_manageCSOElem:function(e){let t=!e||void 0===e.doNotConsiderPrd&&null===e.doNotConsiderPrd?void 0:e.doNotConsiderPrd;var a=A.get(),i=!1;if("3dPlay"===this._measureCommandMode)i=!0,a.length>2&&(this.emptyCSO(),this.emptyHSO());else for(var s=a.length-1;s>=0;s--)if(a[s].pathElement.getLastElement().getDMUType)A.remove(a[s]),i=!0;else if("2D"===this._measureOnGeometryType&&s>0&&a[s].pathElement&&a[0].pathElement){var n=a[0].pathElement.externalPath,l=a[s].pathElement.externalPath;if(n&&l&&n.length>2&&l.length>2)if(n[n.length-2]!==l[l.length-2]){this.emptyCSO(),this.emptyHSO(),i=!0;break}}else{var o,u,m=[];if(this._switchService||(this._switchService=new E({viewer:this._viewer})),this._switchService.retriveNodesFromPath(a[s].pathElement,m),u=a[s].pathElement.getLastElement().sgNode,m&&m.length){for(var c=!1,d=0;d<m.length;d++)if(o=m[d],a[s].pathElement&&a[s].pathElement.getLastElement){if(u&&r.getNodeType(o)&&"cgr"!==this._viewerController.getLoadedStream(o)){A.remove(a[s]),i=!0;break}if(!t&&!u&&null!==this._viewerController.getLoadedStream(o)){c=!0;break}}u||c||(A.remove(a[s]),i=!0)}}i&&(a=A.get()),a.length>0?this._objAction=!0:this.asyncReadPref(this)},_beginExecute:async function(){var e=this;e._switchService||(e._switchService=new E({viewer:e._viewer})),e._count=0,e._interval=null,this.getMeasureContainer=function(){var t=D.getReviewContext({viewer:e.getFrameWindow().getViewer()});if(!t)return;var a=t.getCurrentSessionMarkup();let i=!0;if(a){let e=t.getRestrictions(a);e.markup&&void 0!==e.markup.canEdit&&(i=e.markup.canEdit)}return a&&a.getActiveFlag()&&a.isVisible()&&!a.isReadOnly()&&i&&a.getCurrentSlide()?a:t.getTransientReviewBag()};var t=T.giveSelectionManager({context:D.getContextViewer({viewer:e.getFrameWindow().getViewer()})});t&&t.setActiveState(!1),this._eventController||(this._eventController=D.giveEventsController({viewer:this.getFrameWindow().getViewer()})),this._eventController&&this._eventController.fireEvent("onSetPickThroughtRequest"),this._viewer.currentViewpoint.setDefaultController(!1,"FLY_WALK"),this._bKeepall=!0,this._createdMeasures=[],this._preferences=[],this._treatPrevisualize=!0;var i=D.getContextViewer({viewer:this.getFrameWindow().getViewer()});i.getController&&(this._viewerController=i.getController());var r="primHybrid",l=!1;"3dPlay"!==this._measureCommandMode&&(l=!0),this._pathElementAgentWithCSO=new s({agentId:"_pathElementAgentWithCSO",viewer:this._viewer,engWithPSOHSO:!0,multiAcquisition:!1,multiAcquisitionCtrl:!1,pickingMode:r,prePickingMode:r,valuedFromCSO:!0,saveToCSO:!1,activatePrePicking:!0,acceptedGeometries:[],appli:this,checkAppli:this._checkPicking,displayAppli:this._bEnablePrevisualization?this._previsualize:void 0,switchRepOnPreSelection:l,viewerController:this._viewerController}),this._pathElementAgentWithoutCSO=new s({agentId:"_pathElementAgentWithoutCSO",viewer:this._viewer,engWithPSOHSO:!0,multiAcquisition:!1,multiAcquisitionCtrl:!1,pickingMode:r,prePickingMode:r,valuedFromCSO:!1,saveToCSO:!1,activatePrePicking:!0,acceptedGeometries:[],appli:this,checkAppli:this._checkPicking,displayAppli:this._bEnablePrevisualization?this._previsualize:void 0,switchRepOnPreSelection:l,viewerController:this._viewerController}),"ontouchstart"in window&&this._viewer.setMagnifier({activated:!0,dim:83,shiftVector:{x:-50,y:120}}),this._manageCSOElem(),this._measurable=[],this._measure=null,this._repeatType||(this._repeatType="None"),this._lockedNodes=[],this._lockedMeshInRAM=[],this._overrideSet=null,"3dAuthoringPickPoint"===this._measureCommandMode&&(this._activeFilter="pointOnly"),this._previousLinePickingMode=this._viewer.renderer.renderer.pickLinesMode,this._previousPointPickingMode=this._viewer.renderer.renderer.pickPointsMode,this._previousForcePickingPoints=this._viewer.renderer.renderer.pickPointsMode,this._viewer.setLinePickingMode(y.PICK_ALWAYS),this._viewer.setPointPickingMode(y.PICK_ALWAYS),this._viewer.setForcePickingPoints(!0),this._viewer.render({onlyPostProcess:!1}),a._sendUsageProbe("command","Measure");var o=C?C.givePreferenceManager({context:e.getFrameWindow()}):null;o&&(e._prefSubscribe=o.subscribe("com.ds.mep:onPrefUpdate",(function(t){for(var a=JSON.parse(t[1].preferences).repositories[0],i=0;i<a.preferences.length;i++){let t=a.preferences[i].name;var r=e._preferences.findIndex((e=>e.name===t));-1!==r&&(e._preferences[r].value=a.preferences[i].value)}}))),this._parent();var u=D.getReviewContext({viewer:this.getFrameWindow().getViewer()});if(u||(i=D.getContextViewer({viewer:this.getFrameWindow().getViewer()}),await n.createReviewContext({context:i})),u=D.getReviewContext({viewer:e.getFrameWindow().getViewer()})){var m=R.readPreferences({name:"MeasureRepository",PreferenceNames:["DMUMeasureRemovePreviousNonPersistent"]});m&&m.preferences&&m.preferences.length>0&&"true"===m.preferences[0].value&&u.getTransientReviewBag().removeDMUObjects("DMUMeasure")}e._tokenCancelCmd=h.subscribe({event:e.getId()+"/CANCEL"},(()=>{e.cancelExecute()})),e._tokenEndCmd=h.subscribe({event:e.getId()+"/END"},(()=>{e._endExecute()}))},pauseExecute:function(){this._filterUI&&this._filterUI.setVisibleBottomContentFlag(!1),this._preVisuNode&&this._removePreVisuNode(),this._eventController&&this._eventController.fireEvent("onUnsetPickThroughRequest"),this.done()},resumeExecute:function(){if(this._filterUI&&this._filterUI.setVisibleBottomContentFlag(!0),this._eventController&&this._eventController.fireEvent("onSetPickThroughtRequest"),"Multiple"!==this._repeatType&&this._measure&&this._measure._isInCreationState&&"MeasureItem"===this._measure.getAttribute("sType")&&1===this._measurable.length){var e=this._checkCumulativeMeasureOptionAvailability();e||(this._bCumulativeMeas=!1),this._createAssistantTools({bOK:"3dPlay"!==this._measureCommandMode&&"Geovia"!==this._arguments[0].ID,bRepeatitem:"None"===this._repeatType&&"3dPlay"!==this._measureCommandMode&&"Geovia"!==this._arguments[0].ID,bKeeponlylast:"None"!==this._repeatType&&"3dPlay"!==this._measureCommandMode&&"Geovia"!==this._arguments[0].ID,bMeasCumulative:e}),"cumulativeitemState"!==this._stateId?e&&this._bCumulativeMeas&&this.publish({event:"cumulative",data:null}):this._bCumulativeMeas||this.publish({event:"noncumulative",data:null})}},cancelExecute:function(){this._isCanceled=!0,this._repeatType=void 0,this._endExecute(),this._tokenCancelCmd&&(h.unsubscribe(this._tokenCancelCmd),this._tokenCancelCmd=null)},_endExecute:function(e){this.removeCumulativeKeyEvent();var t=this;this._eventController&&(this._eventController.fireEvent("onUnsetPickThroughRequest"),t.CBTokenMeasureDelete&&t._eventController.removeEvent(t.CBTokenMeasureDelete),t.CBTokenSlideChanged&&t._eventController.removeEvent(t.CBTokenSlideChanged)),t._count=0,t._interval&&(clearInterval(t._interval),t._interval=null);var a=C?C.givePreferenceManager({context:this.getFrameWindow()}):null;if(a&&t._prefSubscribe&&a.unsubscribe(t._prefSubscribe),t._preVisuNode&&t._removePreVisuNode(),t.cleanNotify(),t._treatPrevisualize=!0,t._lockedMeshInRAM){for(var i=0;i<t._lockedMeshInRAM.length;i++)this._viewerController.unlockRepresentationMeshInRAM(t._lockedMeshInRAM[i]);t._lockedMeshInRAM=[]}if(t._lockedNodes&&(this._viewerController.unlockNodes({ids:t._lockedNodes}),t._lockedNodes=[]),t._undisplayPartialLevel(),t.emptyHSO(),t._parent(),t._pathElementAgentWithCSO=null,t._pathElementAgentWithoutCSO=null,t._measurable=null,t._firstSelectionLeafNodes=[],t._secondSelectionLeafNodes=[],"true"===t._bVisibleMagnifier&&t._viewer.setMagnifier({activated:!1}),this._objAction=!1,t.options&&t.options.executionContext&&t._filterUI?(this._filterUI.clear(),this._filterUI=null):t._filterUI&&t._filterUI.setVisibleBottomContentFlag(!1),t._removeAssistantTools(),t._cleanLevelSelector(),t._measure)if(t._measure._bPrevisualized?(t.removeMeasureFromSession(t._measure),t._measure=t._lastMeasure,t._lastMeasure=null):t._bEnablePrevisualization&&t._unprevisualize(),t._measure&&t._measure.isPartialMeasure()&&t._measure.setPartialMeasure("partial"),"3dPlay"!==t._measureCommandMode&&"Geovia"!==t._arguments[0].ID||"MeasureBetween"===t._measure.getAttribute("sType"))if(t._isCanceled){var r=t.getMeasureContainer();r.getDMUObjects&&r.getDMUObjects("DMUMeasure")&&t._createdMeasures&&r.removeDMUObjects(t._createdMeasures)}else{t._measure&&t._measure.setInEdition(!1),D.getReviewContext({viewer:t.getFrameWindow().getViewer()})&&setTimeout((function(){if(t._measure&&t._measure.getNode()){if(t._createdMeasures&&t._createdMeasures.length){for(var e=0;e<t._createdMeasures.length;e++)t._createdMeasures[e].fireEvent("onDMUObjectInitialized",{dmuObject:t._createdMeasures[e]}),t._createdMeasures[e]._isInCreationState&&(t._createdMeasures[e]._isInCreationState=!1,t._createdMeasures[e].manageSelectionHighlight=void 0);t._createdMeasures=null}t._measure&&t._measure._isInCreationState&&(t._measure._isInCreationState=!1,t._measure.manageSelectionHighlight=void 0),t._measure&&t.addInCSO(t._measure),t._measure=null}}),10)}else t.removeMeasureFromSession(t._measure),t._measure=null;else if("Multiple"===t._repeatType&&t._isCanceled){var s=t.getMeasureContainer();s.getDMUObjects&&s.getDMUObjects("DMUMeasure")&&t._createdMeasures&&s.removeDMUObjects(t._createdMeasures)}else if(!t._isCanceled&&t._createdMeasures&&t._createdMeasures.length){for(var n=0;n<t._createdMeasures.length;n++)t._createdMeasures[n].fireEvent("onDMUObjectInitialized",{dmuObject:t._createdMeasures[n]}),t._createdMeasures[n]._isInCreationState&&(t._createdMeasures[n].manageSelectionHighlight=void 0,t._createdMeasures[n]._isInCreationState=!1);t._createdMeasures=null}for(var l=0;l<t._notPickableList.length;l++){var o=t._notPickableList[l];o&&o.getNode()&&t._notPickableList[l].getNode().setPickable(g.PICKABLE)}t._viewer.setLinePickingMode(t._previousLinePickingMode),t._viewer.setPointPickingMode(t._previousPointPickingMode),t._viewer.setForcePickingPoints(t._previousForcePickingPoints),t._viewer.render({onlyPostProcess:!1});var u=T.giveSelectionManager({context:D.getContextViewer({viewer:t.getFrameWindow().getViewer()})});u&&u.setActiveState(!0),t._measure&&t._measure._isInCreationState&&(t._measure._isInCreationState=!1,t._measure.manageSelectionHighlight=void 0),t._viewer.currentViewpoint.setDefaultController(!0,"FLY_WALK"),this.restoreDefaultController(),e&&e(),this._bCumulativeMeas=!1,this._destroyMultiSelectionPanel(),this._tokenEndCmd&&(h.unsubscribe(this._tokenEndCmd),this._tokenEndCmd=null)},addCallBackforMeasureDeleteAndSlideChange:function(){var e=this;e._eventController||(e._eventController=D.getEventsController({viewer:e._viewer})),e._eventController&&(e.CBTokenMeasureDelete=e._eventController.addEvent("onMeasureDeleteWhileActiveCmd",(()=>{e._eventController&&!e.isPaused()&&(e._eventController.removeEvent(e.CBTokenMeasureDelete),e.CBTokenMeasureDelete=null,e._repeatType&&"None"===e._repeatType&&(e.options.executionContext?e._endExecute():e.cancel()))})),e.CBTokenSlideChanged=e._eventController.addEvent("onSlideChanged",(()=>{e._eventController&&!e.isPaused()&&(e._measure||e._createdMeasures&&e._createdMeasures.length)&&(e._eventController.removeEvent(e.CBTokenSlideChanged),e.CBTokenSlideChanged=null,e.options.executionContext?e._endExecute():e.cancel())})))},buildGraph:function(){let e=this;this.changeDefaultController(),this._beginExecute();var t=this.createInitialState("initialState");this.setEnterStateAction(t,this._enterInitialCallback),this.setExitStateAction(t,this._exitInitialCallback);var a=this.getFinalState(),i=this.createState("itemState");this.setEnterStateAction(i,this._enterItemCallback),this.setExitStateAction(i,this._exitItemCallback);var r=this.createState("repeatitemState");this.setEnterStateAction(r,this._enterInitialCallback),this.setExitStateAction(r,this._exitInitialCallback);var s=this.createState("cumulativeitemState");this.setEnterStateAction(s,this._enterItemCallback),this.setExitStateAction(s,this._exitItemCallback);var n=this.createState("betweenState");this.setEnterStateAction(n,this._enterBetweenCallback),this.setExitStateAction(n,this._exitBetweenCallback);var l=this.createState("repeatbetweenState");this.setEnterStateAction(l,this._enterItemCallback),this.setExitStateAction(l,this._exitItemCallback);var o=this.createState("repeatMultipleMeasBetweenState");this.setEnterStateAction(o,this._enterItemCallback),this.setExitStateAction(o,this._exitItemCallback);var u=this.createState("repeatMultipleMeasItemState");this.setEnterStateAction(u,this._enterItemCallback),this.setExitStateAction(u,this._exitItemCallback);var m=this.createState("threepointsState");this.setEnterStateAction(m,this._enterThreepointsCallback),this.setExitStateAction(m,this._exitThreepointsCallback);var c=this._pathElementAgentWithCSO.cso,d=c._items.length;if(d>1&&this._objAction){var p=!1;if(3===d)for(var _=0;_<d;_++)if(c._items[_].pathElement.getLastElement().sgNode){if(0!==c._items[_].pathElement.getLastElement().sgNode.container.glType){p=!1;break}p=!0}if(p){var h={iEvent:this._pathElementAgentWithCSO,iInitialState:t,iFinalState:a,iAction:function(e,t){this._computeThreepointsCallback(e,t,!0)}};this.addTransition(h)}else if(2===d){var M={iEvent:this._pathElementAgentWithCSO,iInitialState:t,iFinalState:"3dPlay"===this._measureCommandMode?a:n,iAction:function(e,t){let a=!1;a="3dPlay"===this._measureCommandMode,this._computeBetweenCallback(e,t,a)}};this.addTransition(M)}else this.addTransition({iEvent:this._pathElementAgentWithCSO,iInitialState:t,iFinalState:d%2?o:u,iAction:this._computeBetweenCallback})}var y={iEvent:this._pathElementAgentWithCSO,iInitialState:t,iFinalState:i,iAction:function(t,a){this._objAction?e.asyncReadPref(e,(()=>{this._computeItemCallback(t,a)})):this._computeItemCallback(t,a)}};this.addTransition(y);var v={iSender:this,iEvent:"failure",iInitialState:t,iFinalState:a,iAction:this._endExecute};if(this.addTransition(v),"3dPlay"===this._measureCommandMode||"Geovia"===this._arguments[0].ID){var g={iEvent:this._pathElementAgentWithoutCSO,iInitialState:i,iFinalState:a,iAction:function(e,t){this._computeBetweenCallback(e,t,!0)}};this.addTransition(g)}else if(!this._measureThickness){var D={iEvent:this._pathElementAgentWithoutCSO,iInitialState:i,iFinalState:n,iAction:this._computeBetweenCallback,iCondition:this._checkForSelection};this.addTransition(D);var S={iSender:this,iEvent:"OK",iInitialState:u,iFinalState:a,iAction:this._endExecute};this.addTransition(S),this.addEmptySelectionTransition(u,a,this._endExecute);var f={iSender:this,iEvent:"failure",iInitialState:u,iFinalState:a,iAction:this._endExecute};this.addTransition(f),this.addTransition({iEvent:this._pathElementAgentWithoutCSO,iInitialState:n,iFinalState:o,iAction:(t,a)=>{e._repeatType="Multiple",e._computeItemCallback(t,a)},iCondition:this._checkForSelection});var b={iEvent:this._pathElementAgentWithoutCSO,iInitialState:u,iFinalState:o,iAction:this._computeItemCallback,iCondition:this._checkForSelection};this.addTransition(b);var C={iEvent:this._pathElementAgentWithoutCSO,iInitialState:o,iFinalState:u,iAction:this._computeBetweenCallback,iCondition:this._checkForSelection};this.addTransition(C)}var T={iSender:this,iEvent:"OK",iInitialState:o,iFinalState:a,iAction:this._endExecute};this.addTransition(T),this.addEmptySelectionTransition(o,a,this._endExecute);var P={iSender:this,iEvent:"failure",iInitialState:o,iFinalState:a,iAction:this._endExecute};this.addTransition(P);var A={iSender:this,iEvent:"OK",iInitialState:i,iFinalState:a,iAction:this._endExecute};this.addTransition(A);var U={iSender:this,iEvent:"failure",iInitialState:i,iFinalState:a,iAction:this._endExecute};this.addTransition(U),"3dPlay"!==this._measureCommandMode&&"Geovia"!==this._arguments[0].ID&&this.addEmptySelectionTransition(i,a,this._endExecute);var E={iSender:this,iEvent:"repeatitem",iInitialState:i,iFinalState:r};this.addTransition(E);var I={iSender:this,iEvent:"OK",iInitialState:n,iFinalState:a,iAction:this._endExecute};this.addTransition(I);var R={iSender:this,iEvent:"failure",iInitialState:n,iFinalState:a,iAction:this._endExecute};this.addTransition(R),this.addEmptySelectionTransition(n,a,this._endExecute);var w={iSender:this,iEvent:"threepoints",iInitialState:n,iFinalState:m};this.addTransition(w);var k={iEvent:this._pathElementAgentWithoutCSO,iInitialState:r,iFinalState:r,iAction:this._computeItemCallback};this.addTransition(k);var L={iSender:this,iEvent:"OK",iInitialState:r,iFinalState:a,iAction:this._endExecute};this.addTransition(L),this.addEmptySelectionTransition(r,a,this._endExecute);var x={iSender:this,iEvent:"noncumulative",iInitialState:s,iFinalState:i,iCondition:this._checkForMeasurable};this.addTransition(x);var N={iSender:this,iEvent:"noncumulative",iInitialState:s,iFinalState:t,iCondition:function(){return!this._checkForMeasurable()}};this.addTransition(N);var G={iSender:this,iEvent:"cumulative",iInitialState:i,iFinalState:s};this.addTransition(G);var H={iEvent:this._pathElementAgentWithoutCSO,iInitialState:s,iFinalState:s,iAction:this._computeItemCallback};this.addTransition(H);var O={iSender:this,iEvent:"OK",iInitialState:s,iFinalState:a,iAction:this._endExecute};this.addTransition(O);var F={iSender:this,iEvent:"repeatitem",iInitialState:s,iFinalState:r};this.addTransition(F),this.addEmptySelectionTransition(s,a,this._endExecute);var V={iEvent:this._pathElementAgentWithoutCSO,iInitialState:m,iFinalState:m,iAction:this._computeThreepointsCallback};this.addTransition(V);var B={iSender:this,iEvent:"OK",iInitialState:m,iFinalState:a,iAction:this._endExecute};this.addTransition(B),this.addEmptySelectionTransition(m,a,this._endExecute),this.addCallBackforMeasureDeleteAndSlideChange()},_checkPicking:function(e,t){var a=!1;return void 0!==e&&(a=t._isItMeasurable(e)),a},_createMeasurables:function(e){if(e||e.data||e.data.length)for(var t=0;t<e.data.length;t++){var a;if(e.data[t]&&e.data[t].pathElement){if(e.data[t].pathElement.getLastElement().sgNode)a=new l({primitive:e.data[t].pathElement.getLastElement().sgNode,pathElement:e.data[t].pathElement,selpoint:e.data[t].position,selnormal:e.data[t].normal});else{var s=this.managePOISelection(e.data[t]);a=new l({canonic:{type:r.isOOCTileSetNodeInPath(e.data[t].pathElement)?i.GeometryType.PICKINGPT:s?i.GeometryType.POINT:i.GeometryType.PRODUCT,position:e.data[t].position},pathElement:e.data[t].pathElement,selpoint:e.data[t].position,selnormal:e.data[t].normal,isApprox:s,bIsPOISelection:s})}a&&(this._measurable[t]=a)}}},_treatSelection:function(e){var t,a=this,s=e&&e.data&&e.data.length?e.data[0]:null;if(s&&s.pathElement){var n=e.callback,o=s.pathElement.getLastElement().sgNode;if(void 0!==o&&function(){var e=!0;if(null!==a._getViewerLoadingMode()){var t=r.getLastRepReference(s.pathElement);if(t){var i=t.getLastElement();r.getNodeType(i)&&"cgr"!==a._viewerController.getLoadedStream(i)&&(e=!1)}}return e}()||e.load&&this._objAction){if(void 0!==o)if(this._objAction)a._createMeasurables(e),a._measurable&&(t=a._measurable[0]);else{let e=!a._bPOISelection&&("3dPlay"===this._measureCommandMode||"pointOnly"===a._activeFilter)&&o.getCount()>1?{type:i.GeometryType.PICKINGPT,isApprox:!0,position:s.position.clone(),primitive:o,pathElement:s.pathElement}:void 0;t=new l({canonic:e,primitive:o,pathElement:s.pathElement,selpoint:s.position,selnormal:s.normal,rayDir:s.ray&&s.ray.direction?s.ray.direction:void 0,bIsPOISelection:a._bPOISelection,isApprox:e?e.isApprox:void 0})}else this._objAction&&(a._createMeasurables(e),a._measurable&&(t=a._measurable[0]));if(n)if(a._measure){var u=!1;if(a._bCumulativeMeas)if(a._bCumulativeMeas&&function(e){var t=!1;if(e){var r=a._measurable[0].getType(),s=e.getType();switch(r){case i.GeometryType.PRODUCT:s===i.GeometryType.PRODUCT&&(t=!0);break;case i.GeometryType.SURFACE:case i.GeometryType.PLANE:s!==i.GeometryType.SPHERE&&s!==i.GeometryType.CONE&&s!==i.GeometryType.CYLINDER&&s!==i.GeometryType.SURFACE&&s!==i.GeometryType.PLANE||(t=!0);break;case i.GeometryType.LINE:case i.GeometryType.CIRCLE:case i.GeometryType.CURVE:s!==i.GeometryType.LINE&&s!==i.GeometryType.CIRCLE&&s!==i.GeometryType.CURVE&&s!==i.GeometryType.CONE&&s!==i.GeometryType.CYLINDER||(t=!0);break;case i.GeometryType.CONE:case i.GeometryType.CYLINDER:case i.GeometryType.SPHERE:"Line_Length"===a._measure._sMainValueType||"Curve_Length"===a._measure._sMainValueType||"Cylinder_Length"===a._measure._sMainValueType||"Cone_Length"===a._measure._sMainValueType?s!==i.GeometryType.LINE&&s!==i.GeometryType.CIRCLE&&s!==i.GeometryType.CURVE&&s!==i.GeometryType.CONE&&s!==i.GeometryType.CYLINDER||(t=!0):"Surface_Area"!==a._measure._sMainValueType&&"PlanarSurface_Area"!==a._measure._sMainValueType||s!==i.GeometryType.SPHERE&&s!==i.GeometryType.CONE&&s!==i.GeometryType.CYLINDER&&s!==i.GeometryType.SURFACE&&s!==i.GeometryType.PLANE||(t=!0)}if(t)for(var n=a._measurable.length,l=0;l<n;l++)if(e._pathElement.isEqual(a._measurable[l]._pathElement)){t=!1;break}}return t}(t)){var m=t.getType()===i.GeometryType.PRODUCT?a._measure.getAttribute("sProductDisplayType"):void 0;void 0===m||"Volume"===m&&t.getVolume()>0||"Area"===m&&t.getArea()>0?(e.measPrevisu||a._measure.setAttribute("bCumulativeMeasure",a._bCumulativeMeas),n(t)):u=!0}else u=!0;else a._measure.setAttribute("bCumulativeMeasure",a._bCumulativeMeas),n(t);u&&(A.remove({pathElement:s.pathElement}),L.remove({pathElement:s.pathElement}),x.remove({pathElement:s.pathElement})),a._measure.manageSelectionHighlight&&a._measure.manageSelectionHighlight()}else n(t)}else{var c=!1,p=!1;if("ProgressiveVisuLoading"===this._measureCommandMode||this._mPVLOD||null!==this._getViewerLoadingMode()){if(c=r.isOOCTileSetNodeInPath(s.pathElement),p=a.managePOISelection(s),!0!==e.load||c||p)if(s.position){var _=s.position.clone();if(s.pathElement.getWorldMatrix()){var h=(new d.Matrix4).getInverse(s.pathElement.getWorldMatrix());_=_.applyMatrix4(h);var M=i.GeometryType.POINT;"productOnly"===a._activeFilter&&(M=i.GeometryType.PRODUCT),r.isOOCTileSetNodeInPath(s.pathElement)&&(M=i.GeometryType.PICKINGPT),p&&(M=i.GeometryType.POINT),t=new l({canonic:{type:M,position:_},pathElement:s.pathElement,selpoint:s.position,selnormal:s.normal,isApprox:c||p,bIsPOISelection:p})}if(n&&a._viewerController)if(a._measure){var y=!1;if(a._bCumulativeMeas)if(a._bCumulativeMeas&&t.getType()===a._measurable[0].getType()){if(!t._pathElement.isEqual(a._measurable[0]._pathElement)){var v=t.getType()===i.GeometryType.PRODUCT?a._measure.getAttribute("sProductDisplayType"):void 0;void 0===v||"Volume"===v&&t.getVolume()>0||"Area"===v&&t.getArea()>0?(e.measPrevisu||a._measure.setAttribute("bCumulativeMeasure",a._bCumulativeMeas),n(t)):y=!0}}else y=!0;else a._measure.setAttribute("bCumulativeMeasure",a._bCumulativeMeas),n(t);y&&(A.remove({pathElement:s.pathElement}),L.remove({pathElement:s.pathElement})),a._measure.manageSelectionHighlight&&a._measure.manageSelectionHighlight()}else n(t)}else n&&n();else if(this._viewerController){var g=[],D=[],S=null,f=r.getLastRepReference(s.pathElement);if(f&&0===f.externalPath.length||!f){S=r.getLastReference(s.pathElement).getLastElement();var b=function(e){if(e)if(r.isRepReference(e))D.push(e);else{var t=[];(t=e.getChildren()).length>0&&t.forEach((function(e){b(e)}))}};b(S)}else{S=r.getLastReference(s.pathElement).getLastElement();var C=f.getLastElement();D.push(C)}D.forEach((function(e){g.push({node:e,stream:"cgr"})}));var T=s.mousePos;!T&&s.eventDatas&&s.eventDatas.event&&(T=a._viewer.getMousePosition(s.eventDatas.event.getCurrentPosition(a._viewer.canvas))),this._switchNodeVisu({nodes_cgr:D,onComplete:function(e){var t=function(){var e,t,i;if(T){var r=a._viewer.pick(T,"primHybrid",!0);r&&r.path&&r.path.length>0&&(e=r.path[0],t=r.normal,i=r.position)}else{var l=a._viewer.castRay(s.ray,S,"prim");l&&l.length>0&&(e=l[0].pathElement,t=l[0].normal,i=l[0].point)}var o=!1;if(e&&(o=a._pathElementAgentWithCSO._filter(e)),!0===o){var u=[{pathElement:e,normal:t,position:i}];a._treatSelection({data:u,load:!1,callback:n})}else if("pointOnly"===a._activeFilter||"productOnly"===a._activeFilter){var m=[];m.push(s),a._treatSelection({data:m,load:!1,callback:n})}},i=[];D.forEach((function(e){i.push(r.getNodeID(e))})),0===a._firstSelectionLeafNodes.length?a._firstSelectionLeafNodes=i.slice():0===a._secondSelectionLeafNodes.length&&(a._secondSelectionLeafNodes=i.slice()),e?a._viewerController.refreshGeometry({ids:i,noMeshInRAM:!1,onComplete:function(){t()},onFailure:function(){if("pointOnly"===a._activeFilter){var e=[];e.push(s),a._treatSelection({data:e,load:!1,callback:n})}}}):t()},onFailure:function(e){if("fullMemory"===e){var t=H.notifyFullMemoryFailure;a._measurable&&a._measurable[0]&&(a._measurable[1]?a._measurable[2]||(t=H.notifyMeasureFailure):t=H.notifyMinDistanceFullMemoryFailure),V&&V.displayNotification({eventID:"error",msg:t}),a.publish({event:"failure",data:null})}else if("pointOnly"===a._activeFilter){var i=[];i.push(s),a._treatSelection({data:i,load:!1,callback:n})}}})}}else{var P=s.position.clone(),U=i.GeometryType.POINT;"productOnly"===a._activeFilter&&(U=i.GeometryType.PRODUCT),(c=r.isOOCTileSetNodeInPath(s.pathElement))?U=i.GeometryType.PICKINGPT:(p=a.managePOISelection(s))&&(U=i.GeometryType.POINT),t=new l({canonic:{type:U,position:P},pathElement:s.pathElement,selpoint:s.position,selnormal:s.normal,isApprox:c||p,bIsPOISelection:p}),n&&n(t)}}}},_selectBestType:function(e,t){var a,i;if("2D"===this._measureOnGeometryType)(i=e.retrievePossibleSelectedType(t)).length&&(a=i[0]);else if(i=e.retrievePossibleSelectedType(t),this._objAction)a="3dPlay"===e._measureCommandMode?c.ViewedType.POINT:i[0];else if("pointOnly"===e._activeFilter)a=c.ViewedType.POINT;else if("productOnly"===e._activeFilter)a=c.ViewedType.PRODUCT;else{a=i[0];for(var r=!1,s=i.length,n=0;!r&&n<s;n++)for(var l=e._filteredGeometries?e._filteredGeometries.viewedGeometries.length:0,o=0;!r&&o<l;o++)e._filteredGeometries.viewedGeometries[o]===i[n]&&(a=i[n],r=!0)}return a},_removePreVisuNode:function(){var e=this;e._preVisuNode&&(r.getSceneRoot(e._viewer).remove(e._preVisuNode),e._viewer.render(),e._preVisuNode.removeChildren(),e._preVisuNode.remove(),e._preVisuNode=void 0)},_preVisualizeMeasure:function(e,t){var a=this;e&&e.pathElement?t._treatSelection({data:[e],load:!1,measPrevisu:!0,callback:function(e){if(e){var i=t._selectBestType(t,e);e.resultType=t.retrieveItemResultType(e.getType(),i),e.drawMode="Measure","2D"===a._measureOnGeometryType&&(e.scale2D=1);let s={data:e,resultType:a.getResultTypeForPreVisu?a.getResultTypeForPreVisu(e.getType()):void 0};a._preVisuNode?a._preVisuNode.buildPreVisuNode(s):(a._preVisuNode=new P(a._viewer),a._preVisuNode.buildPreVisuNode(s),a._preVisuNode.setNoZ(!0),a._preVisuNode.setPickable(g.PICKTHROUGH),a._viewer&&(r.getSceneRoot(a._viewer).add(a._preVisuNode),a._viewer.render())),a._preVisuNode.setVisibility(a._viewer.getVisibleSpace())}return true}}):a._preVisuNode&&a._removePreVisuNode()},_previsualize:function(e,t){if(t._bPOISelection=!1,!t._measureThickness)return t._preVisualizeMeasure(e,t);t._viewer&&(t._bPOISelection=t.managePOISelection(e));if(t._bStartPrevisualize&&(t._bStartPrevisualize=!1),t._measure)"initialState"!==t._stateId&&"repeatitemState"!==t._stateId||t._treatPrevisualize&&e.pathElement&&(t._treatPrevisualize=!1,t._treatSelection({data:[e],load:!0,callback:function(e){if(e){var a=t._selectBestType(t,e);if(t._measure.setMeasurable(1,e),t._measure.setAttribute("sSelectedType1",a),t._measure.setAttribute("sResultingType1",t.retrieveItemResultType(t._measure.getMeasurable(1).getType(),a)),t._measure.update(),"MeasureThickness"===t._measure._sType){var i=t._measure.getMeasurable(1),r=t._measure.getMeasurable(2);if(i&&r){var s=r.getPrimitive();if(s){for(var n=new p,l=[],o=THREEDS.SubElement.getFromSGNode(s);null!==o;)l.unshift(o),o=o.getParent();n.setFromArray(i.getPathElement().externalPath,l),t.addInHSO({path:n},!1)}}}t._measure.getNode()&&t._measure.getNode().setPickable(g.PICKTHROUGH),t._notPickableList.push(t._measure)}return t._treatPrevisualize=!0,true}}));else{var a=function(){t._treatPrevisualize&&e.pathElement&&(t._treatPrevisualize=!1,t._treatSelection({data:[e],load:!0,callback:function(a){if(a){t._measurable[0]=a;var i=t._selectBestType(t,t._measurable[0]);t._measureThickness&&t._bPOISelection&&(e.ray.direction=a._selNormal,e.ray.origin=e.position),t._createMeasure(i),t._measure._bPrevisualized=!0,t._measure.getNode().update(!0,!0),t._measure.getNode().setPickable(g.PICKTHROUGH),t._notPickableList.push(t._measure)}return t._treatPrevisualize=!0,true}}))};t._objAction||0!==t._preferences.length?(a(),t._interval&&(clearInterval(t._interval),t._interval=null)):t._interval||(t._interval=setInterval((function(){t._count++,t._count>60?(0===t._preferences.length&&(t._preferences=t.getDefaultPreference()),t._preferences.length>0&&a(),clearInterval(t._interval),t._interval=null):t._preferences.length>0&&(a(),clearInterval(t._interval),t._interval=null)}),100))}},_unprevisualize:function(){this._measureThickness&&this._measure&&this._measure.getNode()&&this._measure.getNode().setPickable(g.PICKABLE)},_enterInitialCallback:function(){var e=H.notifyinitial;"2D"===this._measureOnGeometryType&&(e=H.notifyinitial2D),"3dPlay"===this._measureCommandMode||"Geovia"===this._arguments[0].ID?e=H.notifyinitialpt:this._measureThickness?e=H.notifythickness:"3dAuthoringPickPoint"===this._measureCommandMode&&(e=H.notifyinitialptauth),"Item"===this._repeatType&&(e=H.notifyrepeatitem,"3dPlay"!==this._measureCommandMode&&"Geovia"!==this._arguments[0].ID||(e=H.notifyrepeatitempt),this._createAssistantTools({bOK:"3dPlay"!==this._measureCommandMode&&"Geovia"!==this._arguments[0].ID,bKeeponlylast:"3dPlay"!==this._measureCommandMode&&"Geovia"!==this._arguments[0].ID}),"productOnly"===this._activeFilter&&"ProgressiveVisuLoading"!==this._measureCommandMode&&this._createLevelSelector(!0)),this.sendNotify("info",e),this._filterUI&&"3dPlay"!==this._measureCommandMode&&!this._measureThickness&&"Geovia"!==this._arguments[0].ID&&"3dAuthoringPickPoint"!==this._measureCommandMode&&this._filterUI.setVisibleBottomContentFlag(!0),this._bStartPrevisualize=this._bEnablePrevisualization},_exitInitialCallback:function(){this.cleanNotify(),"Item"===this._repeatType&&(this._removeAssistantTools(),this._cleanLevelSelector()),this._filterUI&&this._filterUI.setVisibleBottomContentFlag(!1)},_computeItemCallback:function(e,t){t&&t.length>0&&(this._bPOISelection=this.managePOISelection(t[0])),this._measure&&this._measure._bPrevisualized&&(this.removeMeasureFromSession(this._measure),this._measure=void 0),this._removePreVisuNode(),"Item"!==this._repeatType&&"Multiple"!==this._repeatType||this._measure&&(this._measure.setInEdition(!1),this._multiSelectionPanel&&(this._multiSelectionPanel.destroy(),this._multiSelectionPanel=null,this._bIsMultiSelectionPanelCreated=!1),this._bKeepall||this.removeMeasureFromSession(this._measure),this._measure=void 0);var a=this,i=function(){a._treatSelection({data:t,load:!0,callback:function(i){if(i){if(a._measure&&a._measure._bCumulativeMeasure){if(!a._measurable[0]._pathElement.isEqual(i._pathElement)){if(0===a._measure._cumulativeMeasurables.length&&a._measure._cumulativeMeasurables.push(a._measurable[0]),a._measurable.push(i),a._measure._cumulativeMeasurables.push(i),!a._bIsMultiSelectionPanelCreated){var s=a._measure.getAttribute("oProduct1Name");a._multiSelectionNames[0]=s||"",a._updateMultiSelectionPanel({label:a._multiSelectionNames[0],index:0})}var n=!1,l=D.getContextViewer({viewer:a._viewer});if(l&&l.getRoots&&l.getRoots().length>0){var o=l.getController();o&&o.getRootStats(r.getNodeID(l.getRoots()[0]))&&(F.getSetting("enopad3dviewer_lightNodeModel")||F.getSetting("enopad3dviewer_dynamicRepLoading"))&&(n=!0)}var u=a._measurable.length-1;a._multiSelectionPanel&&a._multiSelectionPanel.manageNameLoadingDisplay(!0);let e=function(e){let t=e.name?e.name:"";if(void 0!==t&&(a._multiSelectionNames[e.forPathNum]=t,a._multiSelectionPanel&&a._multiSelectionPanel.manageNameLoadingDisplay(!1),setTimeout((function(){a._updateMultiSelectionPanel({label:a._multiSelectionNames[e.forPathNum],index:e.forPathNum})}),300),a._multiSelectionNames.length>0)){for(var i=a._multiSelectionNames[0],r=1;r<a._multiSelectionNames.length;r++)if(a._multiSelectionNames[r]!==i){i=H.multipleParts;break}a._measure.setAttribute("oProduct1Name",i)}},t=a._measurable[u]._pathElement;var m=D.getReviewContext({viewer:a.getFrameWindow().getViewer()}).getDMUObjectFromPathElement(t);m&&m.getType&&("DMUClipping"===m.getType()||"DMUSection"===m.getType())?e({name:"",forPathNum:u}):r.getRefInstNames({path:t,callback:e,context:l,pathNum:u,fromNode:!n})}}else a._measurable=[],a._measurable.push(i);var c=a._selectBestType(a,a._measurable[0]);"Multiple"===a._repeatType&&(a._measurable[0]&&a._measurable[0].setTypeWithSelFilter&&a._measurable[0].setTypeWithSelFilter(c),a._measurable[1]&&a._measurable.splice(1,a._measurable.length-1)),"Geovia"===a._arguments[0].ID&&(a._measurable[0]=a._transformMeasureToPoint(a._measurable[0]));var d=[],p=[],_=!0,h=[],M=r.getLastRepReference(a._measurable[0].getPathElement());null!==M&&0!==M.getLength()||(M=r.getLastReference(i.getPathElement()));var y=!1;let P=i&&i.getPathElement()?i.getPathElement():t[0].pathElement;if("2D"!==a._measureOnGeometryType&&!r.isOOCTileSetNodeInPath(P)&&(y=!0,M&&M.getLastElement()&&M.getLastElement().getUserData)){let e=M.getLastElement().getUserData();e&&"DesignSight"===e.type&&(y=!1)}if(y&&M&&_)if("DynamicRep"===a._getViewerLoadingMode()){if(_=a._lockNodes(M.getLastElement(!0),d,a._measurable[0].getPathElement().getParentPath()),d.lentgh)for(var v=0;v<d.length;v++)p.push(r.getNodeID(d[v].getLastElement(!0)))}else"ProgressiveFull"!==a._getViewerLoadingMode()&&"ProgressiveLarge"!==a._getViewerLoadingMode()||(_=a._getNodesToSwitchInRAM(M.getLastElement(!0),[],h,p));var g=function(t){var i=function(){if(!a._measure&&t?a._createMeasure(c):a._measure&&a._measure._bCumulativeMeasure&&(a._updateCumulativeMeasure(),"productOnly"===a._activeFilter&&"ProgressiveVisuLoading"!==a._measureCommandMode&&a._createLevelSelector(!0)),(!t&&"Multiple"===a._repeatType||a._IsItemMeasureReq&&!a._IsItemMeasureReq())&&(a._objAction=!1),a._measure&&!_&&a._measure.setPartialMeasure("partialCmd"),a._lockNodeFromMeasurable(a._measurable[0]),!a._measure||"3dPlay"!==a._measureCommandMode&&"Geovia"!==a._arguments[0].ID||(a._measure.setAttribute("bCollapsedDisplay",!1),a._measure.isMeasureDisplayed()&&a._measure.refreshNode()),a._viewer.render(),a._filterUI&&a._measure,a._bStartPrevisualize=a._bEnablePrevisualization,e&&e(),a._highlightAllSelections(),a._checkCumulativeMeasureOptionAvailability()&&"cumulativeitemState"!==a._stateId)a._bCumulativeMeas?a.publish({event:"cumulative",data:null}):a.publish({event:"noncumulative",data:null});else if("cumulativeitemState"===a._stateId&&"productOnly"===a._activeFilter&&"ProgressiveVisuLoading"!==a._measureCommandMode){var i=a._measurable.length-1;a._createLevelSelector(!0,i)}};a._objAction||0!==a._preferences.length?(i(),a._interval&&(clearInterval(a._interval),a._interval=null)):a._interval||(a._interval=setInterval((function(){a._count++,a._count>60?(0===a._preferences.length&&(a._preferences=a.getDefaultPreference()),a._preferences.length>0&&i(),clearInterval(a._interval),a._interval=null):a._preferences.length>0&&(i(),clearInterval(a._interval),a._interval=null)}),100))};if(_||"ProgressiveFull"!==a._getViewerLoadingMode()&&"ProgressiveLarge"!==a._getViewerLoadingMode()){let e=()=>"Multiple"===a._repeatType||a._IsItemMeasureReq&&!a._IsItemMeasureReq();var S=h.concat(p);if(S.length>0){var f=function(){for(var e=0;e<S.length;e++)-1===a._lockedMeshInRAM.indexOf(S[e])&&(a._viewerController.lockRepresentationMeshInRAM(S[e]),a._lockedMeshInRAM.push(S[e])),-1===a._lockedNodes.indexOf(S[e])&&(a._viewerController.lockNodes({ids:[S[e]]}),a._lockedNodes.push(S[e]))};if(0===h.length)f(),e()?g(!1):g(!0);else{var b=0,C=D.getContextViewer({viewer:a.getFrameWindow().getViewer()}),T=C.subscribe({event:"onRepresentationLoaded"},(function(t){-1!==h.indexOf(t)&&b++,b===h.length&&(C.unsubscribe(T),setTimeout(e()?g(!1):g(!0),0))}));f()}}else e()?g(!1):g(!0)}else g(!1)}}})};if(a._objAction){for(var s=[],n=0;n<t.length;n++){if(t[n].pathElement)if(!t[n].pathElement.getLastElement().sgNode){var l=[];a._switchService.retriveNodesFromPath(t[n].pathElement,l),l.forEach((function(e){e&&"thumbnail"===a._viewerController.getLoadedStream(e)&&s.push(e)}))}}s.length?a._switchService.switchToAV1({nodes:s,lockNodesAfterSwitch:!0,lockMeshInRAMAfterSwitch:!0,onCompleteCB:function(e){a._switchRepInfo.clearTimeout=void 0;var t=e.nodeIDsOfLockedNodes;t&&t.length>0&&(a._switchRepInfo.lockedNodeIds||(a._switchRepInfo.lockedNodeIds=[]),t.forEach((function(e){-1===a._switchRepInfo.lockedNodeIds.indexOf(e)&&a._switchRepInfo.lockedNodeIds.push(e)}))),i()},onFailureCB:function(){a._switchRepInfo.clearTimeout=void 0}}):i()}else i()},_createMeasure:function(e){var t=this,a=function(e){t._pathElementAgentWithCSO&&t._pathElementAgentWithCSO.options&&(e?(t._pathElementAgentWithCSO.options.activatePrePicking=!1,t._pathElementAgentWithoutCSO.options.activatePrePicking=!1):(t._pathElementAgentWithCSO.options.activatePrePicking=!0,t._pathElementAgentWithoutCSO.options.activatePrePicking=!0))},i=function(e){if(t._measurable)for(var a=0;a<t._measurable.length;a++)if(t._addElementToHSO(t._measurable[a]),e&&e.length>0)for(var i=0;i<e.length;i++){t._measurable[a].getPathElement().isEqual(e[i])&&t.addInPSO({path:e[i]})}},s=function(){var s=t.getMeasureContainer(),n=t._arguments[0].ID;t._measure&&t._measure._bCumulativeMeasure||(t._measure=new m(t._viewer,s,n),t._measure.managePathElementAgent=a,t._measure.manageSelectionHighlight=i,r.setPickability(t._measure,!1),t._measure._preferences=t._preferences,t._measure._isInCreationState=!0,t._measure._resType=t._resType?t._resType:null,t._createdMeasures.push(t._measure),t._measureThickness?(t._measure.setAttribute("sType","MeasureThickness"),t._measure.setAttribute("sName",s.computeNewName({object:t._measure,prefix:H.measurethicknessname}))):(t._measure.setAttribute("sType","MeasureItem"),t._measure.setAttribute("bCumulativeMeasure",!1),t._measure.setAttribute("sName",s.computeNewName({object:t._measure,prefix:H.measureitemname})),t._measureOnGeometryType&&(t._measure.setAttribute("sMeasureOnGeometryType",t._measureOnGeometryType),"Extended"===localStorage.getItem("DMUMeasureDisplayPreference")&&t._measure.setAttribute("bShortDisplay",!1))),t._measure.setAttribute("iExtensionLinesManipulable",1),t._measure.setAttribute("sID",s.computeNewID()),t._measure.setAttribute("sUuid",b.getUUID()),t._measure.setInEdition(!0),t._measure.setAttribute("sSelectedType1",e)),t._measureItem(),t._measure&&t._measure._bCumulativeMeasure||(t._measure.fireEvent("onDMUObjectInitialized",{dmuObject:t._measure}),s.addDMUObject?s.addDMUObject(t._measure):s.getCurrentSlide&&s.getCurrentSlide()&&s.getCurrentSlide().addDMUObject(t._measure)),t._measure.isMeasureDisplayed()&&t._measure.refreshNode(),t._measure.setInEdition(!1),t._objAction&&t.addInCSO(t._measure),t._objAction=!1};t._objAction&&0===t._preferences.length?t.asyncReadPref(t,s):s()},_highlightAllSelections:function(){if(this.emptyHSO(),this._measurable)for(var e=0;e<this._measurable.length;e++)this._addElementToHSO(this._measurable[e])},_updateMultiSelectionPanel:function(e){var t=this;if(t._multiSelectionNames.length>0){if(!t._multiSelectionPanel){var a={offsetX:0,offsetY:0};let e=t._measure._viewer.SCREEN_WIDTH,i=t._measure._viewer.SCREEN_HEIGHT;if(i>0&&e){let u,m=e;if(t._filterUI&&(u=t._filterUI.getPanelPosition().left),u)m=u;else{let a=t._frmWindow,i=52;if(a&&a.getUIFrame()){let e=a.getUIFrame().getStyle("width").replace(/px/g,"")-i;var r=0,s=a.getImmersiveFrame().getDockingElement(WUXDockAreaEnum.RightDockArea),n=s.getContainedWindows();if(n&&n.length&&(n[0].isAWindowGroup()&&n[0].getEmbeddedWindows().length||!n[0].isAWindowGroup())){var l=n[0].getEmbeddedWindows?n[0].getEmbeddedWindows():n,o=!1;for(let e=0;e<l.length;e++)l[e].visibleFlag&&(o=!0);r=o&&!s.collapseDockingZoneFlag?s.dockingZoneSize+s._collapserSize:s._collapserSize}else s.interactiveDockAreaVisibleFlag&&(r=s.dockingZoneSize+s._collapserSize);m=e-r}else m=e-i}let c=m-235;a.offsetX=c>0?c:0,a.offsetY=i>100?.5*i-50:0}var u=new N;t._multiSelectionPanel=new G({title:H.selections,identifier:"WebUXCumulativeMeasureMultiSelectionPanel",immersiveFrame:u,height:100,width:230,minHeight:100,minWidth:230,bResizable:!0,bCloseBtn:!1,bCollapsible:!1,bDisplayMenu:!0,bMultiSelectionMode:!1,bEnableLoadingInProgress:!0,cbFuncOnSelectionChange:function(){t._multiSelectionPanel&&t._multiSelectionPanel.unselectAll()},cbFuncOnPostRemove:function(e){if(e.options&&e.options.allChipsRemoved)t._multiSelectionNames.splice(0,t._measure._cumulativeMeasurables.length),t._measurable.splice(0,t._measurable.length),t._destroyMultiSelectionPanel(),t.removeMeasureFromSession(t._measure),t._measure=null,t.publish({event:"noncumulative",data:null});else if(e.options&&e.options.chips&&e.options.chips.length>0&&e.options.chips[0].chipOptions&&void 0!==e.options.chips[0].chipOptions.index){var a=e.options.chips[0].chipOptions.index;if(t._measure&&t._measure._cumulativeMeasurables&&t._measure._cumulativeMeasurables.splice(a,1),t._multiSelectionNames.splice(a,1),t._measurable.splice(a,1),t._updateCumulativeMeasure(),t._highlightAllSelections(),"productOnly"===t._activeFilter&&"ProgressiveVisuLoading"!==t._measureCommandMode&&t._createLevelSelector(!0),t._multiSelectionPanel&&t._multiSelectionPanel.updateIndicesAsPerSequence(a),t._multiSelectionNames.length>0){for(var i=t._multiSelectionNames[0],r=1;r<t._multiSelectionNames.length;r++)if(t._multiSelectionNames[r]!==i){i=H.multipleParts;break}t._measure.setAttribute("oProduct1Name",i)}}},initialPosition:a}),t._multiSelectionPanel.create(),u.inject(t._frmWindow.getUIFrame())}if(t._multiSelectionPanel)if(t._bIsMultiSelectionPanelCreated=!0,e){if(e.index<t._measurable.length){var m=t._measurable[e.index].getType(),c=t._multiSelectionNames[e.index];let a;switch(m){case i.GeometryType.LINE:a=O.line;break;case i.GeometryType.CURVE:a=O.curve;break;case i.GeometryType.CIRCLE:a=O.arc;break;case i.GeometryType.PLANE:a=O.plane;break;case i.GeometryType.SURFACE:a=O.surface;break;case i.GeometryType.CYLINDER:a=O.cylinder;break;case i.GeometryType.CONE:a=O.cone;break;case i.GeometryType.SPHERE:a=O.sphere}a?c=c?" "+O.inLabel+" "+c:"":a="",c||m!==i.GeometryType.PRODUCT||(c=O.product),e.label=a+c}t._multiSelectionPanel.addSelection(e)}else{for(var d=[],p=0;p<t._multiSelectionNames.length;p++){var _=t._multiSelectionNames[p];d.push({label:_||"",index:p})}d.length>0&&t._multiSelectionPanel.addSelection(d)}for(var h=document.getElementsByClassName("wux-chip-cell-label"),M=0;M<h.length;M++)h[M].setStyle("text-overflow","unset"),h[M].setStyle("overflow","unset")}},_destroyMultiSelectionPanel:function(){this._multiSelectionPanel&&(this._multiSelectionPanel.destroy(),this._multiSelectionPanel=null),this._multiSelectionNames&&(this._multiSelectionNames=[]),this._bIsMultiSelectionPanelCreated=!1},_checkCumulativeMeasureOptionAvailability:function(){var e=this,t=!1;if("pointOnly"!==e._activeFilter&&"3dPlay"!==e._measureCommandMode&&("None"===e._repeatType||e._enableSpecialCumulativeMeasure)&&(e._measure&&e._measure._isInCreationState&&"MeasureItem"===e._measure.getAttribute("sType")||e._objAction)&&1===e._measurable.length)switch(e._measurable[0].getType()){case i.GeometryType.LINE:case i.GeometryType.CURVE:case i.GeometryType.PLANE:case i.GeometryType.SURFACE:case i.GeometryType.PRODUCT:t=!0;break;case i.GeometryType.CIRCLE:e._measure&&"Arc_Length"===e._measure._sMainValueType&&(t=!0);break;case i.GeometryType.CYLINDER:case i.GeometryType.CONE:case i.GeometryType.SPHERE:!e._measure||"Cylinder_Length"!==e._measure._sMainValueType&&"Cone_Length"!==e._measure._sMainValueType&&"Surface_Area"!==e._measure._sMainValueType||(t=!0)}return t},_updateCumulativeMeasure:function(){var e=this;if(e._measure&&e._measure._bCumulativeMeasure){var a,s,n=e._measurable.length,l=e._measure.getAttribute("sResultingType1");if(1===n){e._measure.setAttribute("bCumulativeMeasure",!1),s=e._measurable[0].getSelPoint(),e._measure.setMeasurable(1,e._measurable[0]);e._measure._removeAttribute(["sLeaderEndType","sExtremityType","sPointType"]),e._measureItem(),e._destroyMultiSelectionPanel(),a=H.notifycumulativeitemsinglesel}else{var o=[],u=0,m=0,d=0,p=0;switch(l){case c.ResultType.CYLINDER:case c.ResultType.CONE:var _=e._measure.getAttribute("sSurfaceDisplayType");if("Length"===_){for(u=0;u<n;u++)m+=Number(e._measurable[u].getHeight());o.push({attribute:"fLength",value:m}),o.push({attribute:"sResultingType1",value:c.ResultType.CURVE})}else if("Area"===_){for(u=0;u<n;u++)d+=Number(e._measurable[u].getArea());o.push({attribute:"fArea",value:d}),o.push({attribute:"sResultingType1",value:c.ResultType.SURFACE})}s=e._measurable[n-1].getSelPoint(),o.push({attribute:"vLeaderPointingPoint3D",value:s.clone()});break;case c.ResultType.LINE:case c.ResultType.CURVE:case c.ResultType.CIRCLE:for(u=0;u<n;u++){var h=e._measurable[u].getType();h===i.GeometryType.CYLINDER||h===i.GeometryType.CONE?m+=Number(e._measurable[u].getHeight()):h===i.GeometryType.CIRCLE?m+=Number(e._measurable[u].getArcLength()):m+=Number(e._measurable[u].getLength())}s=e._measurable[n-1].getSelPoint(),o.push({attribute:"fLength",value:m}),o.push({attribute:"sResultingType1",value:c.ResultType.CURVE}),o.push({attribute:"vLeaderPointingPoint3D",value:s.clone()});break;case c.ResultType.PLANE:case c.ResultType.SURFACE:case c.ResultType.SPHERE:case c.ResultType.PRODUCT:for(u=0;u<n;u++)d+=Number(e._measurable[u].getArea()),l===c.ResultType.PRODUCT&&(p+=Number(e._measurable[u].getVolume()));void 0===(s=e._measurable[n-1].getSelPoint())&&(s=e._measurable[n-1].getCoG()),o.push({attribute:"fArea",value:d}),l===c.ResultType.PRODUCT?(o.push({attribute:"fVolume",value:p}),o.push({attribute:"sResultingType1",value:c.ResultType.PRODUCT})):o.push({attribute:"sResultingType1",value:c.ResultType.SURFACE}),o.push({attribute:"vLeaderPointingPoint3D",value:s.clone()})}var M=30;M=t.getDistanceFromPixel(e._viewer,s,M,e._frmWindow);var y=t.getViewpointInfo(e._viewer.currentViewpoint).up.clone().multiplyScalar(M);o.push({attribute:"vLeaderBreakPoint3D",value:s.clone().add(y)}),e._measure.set(o),e._measure.getAttribute("sMainValueType")!==e._measure.getMainValueType()&&e._measure.updateMainValueDisplayAsPerPref(),a=H.notifycumulativeitem;e._measure._removeAttribute(["sExtremityType","sPointType"]);var v=e._measure.getAttribute("sLeaderEndType");null==v&&e._measure.setAttribute("sLeaderEndType","Bubble"),l===c.ResultType.PRODUCT&&e._measure.updatePrdIDAsPerSelectedLevel()}if(e.sendNotify("info",a),e._measure.isMeasureDisplayed()&&e._measure.refreshNode(),e._measure._isInCreationState)if(e._vAssistantPosition=s.clone(),e._measure&&e._measure.movePosDownByPixels&&(e._vAssistantPosition=e._measure.movePosDownByPixels({position:s.clone(),pixels:45}),e._measure._vAssistantPosition=e._vAssistantPosition,n>1&&e._measure.setAttribute("vFirstExtensionPoint3D",e._measure._vAssistantPosition.clone())),1===n){var g="DMUMeasure";e._measure&&e._measure.getMeasureType&&(g=e._measure.getMeasureType());var D=!0;"Multiple"!==e._repeatType||"DMUMeasure"!==g&&"MeasureItem"!==g||(D=!1,e._measurable[0]&&(e._vAssistantPosition=e._measurable[0].getSelPoint().clone(),e._measure&&e._measure.movePosDownByPixels&&(e._vAssistantPosition=e._measure.movePosDownByPixels({position:e._measurable[0].getSelPoint().clone(),pixels:45}))));var S=e._checkCumulativeMeasureOptionAvailability();S||(e._bCumulativeMeas=!1),this._createAssistantTools({bOK:"3dPlay"!==e._measureCommandMode&&"Geovia"!==e._arguments[0].ID,bRepeatitem:!e._resType&&"None"===e._repeatType&&"3dPlay"!==e._measureCommandMode&&"Geovia"!==e._arguments[0].ID,bKeeponlylast:"None"!==e._repeatType&&"3dPlay"!==e._measureCommandMode&&"Geovia"!==e._arguments[0].ID&&D,bMeasCumulative:S})}else e._createAssistantTools({bOK:"3dPlay"!==e._measureCommandMode&&"Geovia"!==e._arguments[0].ID,bMeasCumulative:e._enableSpecialCumulativeMeasure});r.setPickability(e._measure,!1),e.addInCSO(e._measure)}},_transformMeasureToPoint:function(e){var t,a=e,r=e.getType();if(r===i.GeometryType.CYLINDER||r===i.GeometryType.CONE){var s=e.getSelPoint(),n=e.getPoints(),o=e.getAxis(),u=v.computePointLineDistance(s.toArray(),n.beginPoint.toArray(),o.toArray()).aPosition;t={type:i.GeometryType.POINT,position:new d.Vector3(u[0],u[1],u[2])},a=new l({canonic:t,pathElement:e.getPathElement()})}else r!==i.GeometryType.CIRCLE&&r!==i.GeometryType.SPHERE||(t={type:i.GeometryType.POINT,position:e.getCenter()},a=new l({canonic:t,pathElement:e.getPathElement()}));return a},_enterItemCallback:function(){var e=H.notifyitem;this._measureThickness&&(e=H.notifythicknessitem),"3dPlay"===this._measureCommandMode||"Geovia"===this._arguments[0].ID?e=H.notifyitempt:"3dAuthoringPickPoint"===this._measureCommandMode&&(e=H.notifyrepeatbetweenpt),"None"!==this._repeatType&&(e="3dPlay"===this._measureCommandMode||"Geovia"===this._arguments[0].ID?H.notifyrepeatbetweenpt:"Multiple"===this._repeatType?this._measure&&"MeasureBetween"===this._measure.getMeasureType()?H.notifyrepeatbtwnmultimeasfirstsel:H.notifyrepeatbtwmultimeassecondsel:H.notifyrepeatbetween),this._bCumulativeMeas&&(e=H.notifycumulativeitemsinglesel),this.sendNotify("info",e);var t="DMUMeasure";this._measure&&this._measure.getMeasureType&&(t=this._measure.getMeasureType());var i=!0;"Multiple"!==this._repeatType||"DMUMeasure"!==t&&"MeasureItem"!==t||(i=!1,this._measurable[0]&&(this._vAssistantPosition=this._measurable[0].getSelPoint().clone(),this._measure&&this._measure.movePosDownByPixels&&(this._vAssistantPosition=this._measure.movePosDownByPixels({position:this._measurable[0].getSelPoint().clone(),pixels:45}))));let r=this._checkCumulativeMeasureOptionAvailability();this._createAssistantTools({bOK:"3dPlay"!==this._measureCommandMode&&"Geovia"!==this._arguments[0].ID&&(this._measure||this._createdMeasures&&this._createdMeasures.length),bRepeatitem:"None"===this._repeatType&&"3dPlay"!==this._measureCommandMode&&"Geovia"!==this._arguments[0].ID,bKeeponlylast:"None"!==this._repeatType&&"3dPlay"!==this._measureCommandMode&&"Geovia"!==this._arguments[0].ID&&i,bMeasCumulative:r}),r&&this.addCumulativeKeyEvent(),"productOnly"===this._activeFilter&&"ProgressiveVisuLoading"!==this._measureCommandMode&&this._createLevelSelector(!0),this._filterUI&&"3dPlay"!==this._measureCommandMode&&!this._measureThickness&&"Geovia"!==this._arguments[0].ID&&"3dAuthoringPickPoint"!==this._measureCommandMode&&this._filterUI.setVisibleBottomContentFlag(!0),a.isEnvActivated("measurecsomanagement",!0)||this.addInCSO(this._measure)},_exitItemCallback:function(){this.cleanNotify(),this._cleanLevelSelector(),this._measure&&this._measure._bPrevisualized&&(this.removeMeasureFromSession(this._measure),this._measure=this._lastMeasure,this._lastMeasure=null),this._filterUI&&this._filterUI.setVisibleBottomContentFlag(!1),this._removeAssistantTools()},_computeBetweenCallback:function(e,t,a=!1){var s=this;s._removePreVisuNode(),this._lastMeasure&&(this.removeMeasureFromSession(this._lastMeasure),this._measure._bPrevisualized=!1),s._measure&&s._measure._removeAttribute(["bCumulativeMeasure"]),"Multiple"!==this._repeatType&&"Chain"!==this._repeatType&&"Fan"!==this._repeatType||(this._measure&&this._measure.setInEdition(!1),this._bKeepall||this.removeMeasureFromSession(this._measure),this._measurable&&this._measurable.length&&this._duplicateMeasureForRepeat(this._repeatType));var n=function(){s._treatSelection({data:t,load:!0,callback:function(n){if(s._unlockNodes(),n){s._objAction||(s._measurable[1]=n),"productOnly"!==s._activeFilter||"Multiple"!==s._repeatType&&"Chain"!==s._repeatType&&"Fan"!==s._repeatType||s._createLevelSelector(!1),"Geovia"===s._arguments[0].ID&&(s._measurable[1]=s._transformMeasureToPoint(s._measurable[1]));var l=function(){var n,l=function(){void 0!==s._measure.getAttribute("fDistance")||void 0!==s._measure.getAttribute("fAngle")?(s._lockNodeFromMeasurable(s._measurable[1]),s._filterUI,"partialCmd"===s._measure.isPartialMeasure()&&s._displayPartialLevel(),a&&s._endExecute(),e(),s.emptyHSO(),s._measurable&&(s._addElementToHSO(s._measurable[0]),s._addElementToHSO(s._measurable[1]))):(V&&V.displayNotification({eventID:"error",msg:H.notifyMinDistanceFailure}),s.removeMeasureFromSession(s._measure),s.publish({event:"failure",data:null}))},o=s._arguments[0].ID;if(s._objAction){var u=function(){n=s.getMeasureContainer(),"Chain_Stack"!==s._resType?function(){for(var e=0;e<t.length-1;e+=2)s._measure=new m(s._viewer,n,o),r.setPickability(s._measure,!1),s._measure._preferences=s._preferences,s._measure._isInCreationState=!0,s._measure._resType=s._resType?s._resType:null,s._createdMeasures.push(s._measure),s._measure.setMeasurable(1,s._measurable[e+0]),s._measure.setAttribute("sResultingType1",s.retrieveItemResultType(s._measure.getMeasurable(1).getType(),s._measure.getAttribute("sSelectedType1"))),s._measure.setAttribute("sSelectedType1",s._selectBestType(s,s._measurable[e+0])),s._measure.fireEvent("onDMUObjectInitialized",{dmuObject:s._measure}),n.addDMUObject?n.addDMUObject(s._measure):n.getCurrentSlide&&n.getCurrentSlide()&&n.getCurrentSlide().addDMUObject(s._measure),s._measure.isMeasureDisplayed()&&s._measure.refreshNode(),s._measure.setAttribute("sType","MeasureBetween"),s._measure.setAttribute("sName",n.computeNewName({object:s._measure,prefix:H.measurebetweenname})),s._measure.setAttribute("iExtensionLinesManipulable",e+1),s._measure.setAttribute("sSelectedType2",s._selectBestType(s,s._measurable[e+1])),"3dPlay"!==s._measureCommandMode&&"Geovia"!==s._arguments[0].ID||s._measure.setAttribute("bCollapsedDisplay",!1),s._measure.setMeasurable(2,s._measurable[e+1]),s._measureOnGeometryType?s._measure.setAttribute("sMeasureOnGeometryType",s._measureOnGeometryType):(s._measurable[e].getType()!==i.GeometryType.CYLINDER&&s._measurable[e].getType()!==i.GeometryType.CONE||s._measure.setAttribute("sSelectedType1",c.ViewedType.AXIS),s._measurable[e+1].getType()!==i.GeometryType.CYLINDER&&s._measurable[e+1].getType()!==i.GeometryType.CONE||s._measure.setAttribute("sSelectedType2",c.ViewedType.AXIS)),s._measureBetween();var a=s._measurable.length;a>2&&(a%2&&s._measurable.splice(0,a-1),s._repeatType="Multiple")}():function(){for(var e=0;e<t.length-1;e++){let t="Chain"!==s._repeatType?0:e,a=e+1;s._measure=new m(s._viewer,n,o),r.setPickability(s._measure,!1),s._measure._preferences=s._preferences,s._measure._isInCreationState=!0,s._createdMeasures.push(s._measure),s._measure.setMeasurable(1,s._measurable[t]),s._measure.setAttribute("sResultingType1",s.retrieveItemResultType(s._measure.getMeasurable(1).getType(),s._measure.getAttribute("sSelectedType1"))),s._measure.setAttribute("sSelectedType1",s._selectBestType(s,s._measurable[t])),s._measure.fireEvent("onDMUObjectInitialized",{dmuObject:s._measure}),n.addDMUObject?n.addDMUObject(s._measure):n.getCurrentSlide&&n.getCurrentSlide()&&n.getCurrentSlide().addDMUObject(s._measure),s._measure.isMeasureDisplayed()&&s._measure.refreshNode(),s._measure.setAttribute("sType","MeasureBetween"),s._measure.setAttribute("sName",n.computeNewName({object:s._measure,prefix:H.measurebetweenname})),s._measure.setAttribute("sSelectedType2",s._selectBestType(s,s._measurable[a])),"3dPlay"!==s._measureCommandMode&&"Geovia"!==s._arguments[0].ID||s._measure.setAttribute("bCollapsedDisplay",!1),s._measure.setMeasurable(2,s._measurable[a]),s._measureOnGeometryType?s._measure.setAttribute("sMeasureOnGeometryType",s._measureOnGeometryType):(s._measurable[t].getType()!==i.GeometryType.CYLINDER&&s._measurable[t].getType()!==i.GeometryType.CONE||s._measure.setAttribute("sSelectedType1",c.ViewedType.AXIS),s._measurable[a].getType()!==i.GeometryType.CYLINDER&&s._measurable[a].getType()!==i.GeometryType.CONE||s._measure.setAttribute("sSelectedType2",c.ViewedType.AXIS)),s._measureBetween()}var a=s._measurable.length;a>2&&s._measurable.splice(0,a-2)}(),l(),s._objAction=!1};0===s._preferences.length?s.asyncReadPref(s,u):u()}else n=s.getMeasureContainer(),s._measure.setAttribute("sType","MeasureBetween"),s._measure.setAttribute("sName",n.computeNewName({object:s._measure,prefix:H.measurebetweenname})),s._measure.setAttribute("iExtensionLinesManipulable",1),s._measureOnGeometryType&&s._measure.setAttribute("sMeasureOnGeometryType",s._measureOnGeometryType),s._measure.setAttribute("sSelectedType2",s._selectBestType(s,s._measurable[1])),"3dPlay"!==s._measureCommandMode&&"Geovia"!==s._arguments[0].ID||s._measure.setAttribute("bCollapsedDisplay",!1),s._measureBetween(),l()};if("ProgressiveFull"!==s._getViewerLoadingMode()&&"ProgressiveLarge"!==s._getViewerLoadingMode()||!s._measurable[0].isPartial()||r.isOOCTileSetNodeInPath(t[0].pathElement))s._measurable[0].setPartial(!1),l();else{var o=s._firstSelectionLeafNodes.concat(s._secondSelectionLeafNodes);if(s._lockedMeshInRAM){var u=[];s._lockedMeshInRAM.forEach((function(e){-1===o.indexOf(e)?s._viewerController.unlockRepresentationMeshInRAM(e):u.push(e)})),s._lockedMeshInRAM=[],s._lockedMeshInRAM=u.slice()}if(s._lockedNodes){var d=[],p=[];s._lockedNodes.forEach((function(e){-1===o.indexOf(e)?p.push(e):d.push(e)})),s._viewerController.unlockNodes({ids:p}),s._lockedNodes=[],s._lockedNodes=d.slice()}s._callMinMaxIndexService({onComplete:function(){s._measure.setPartialMeasure(!1),l()},onFailure:function(e){if("fullMemory"===e.cause)if(e.setALoadedState&&e.setBLoadedState){if("partial"===e.setALoadedState){var t=s._measurable[0].getPathElement(),a=s._measurable[0].getLevel();a&&(t=r.truncatePathElement(t,a)),s._partialMeasureDisplay[0]={path:t,lockedNodes:[],opacity:1}}if("partial"===e.setBLoadedState){var i=s._measurable[1].getPathElement(),n=s._measurable[1].getLevel();n&&(i=r.truncatePathElement(i,n)),s._partialMeasureDisplay[1]={path:i,lockedNodes:[],opacity:1}}s._measure.setPartialMeasure("partialCmd"),s._measurable[0].setLevel(null),s._measurable[0].setPartial(!1),s._measurable[1].setLevel(null),s._measurable[1].setPartial(!1),l(),V&&V.displayNotification({eventID:"error",msg:H.notifyRequestedMinDistanceFullMemoryFailure})}else V&&V.displayNotification({eventID:"error",msg:H.notifyMinDistanceFullMemoryFailure}),s.removeMeasureFromSession(s._measure),s.publish({event:"failure",data:null});else V&&V.displayNotification({eventID:"error",msg:H.notifyMinDistanceFailure}),s.removeMeasureFromSession(s._measure),s.publish({event:"failure",data:null})}})}}}})};if(s._objAction){for(var l=[],o=0;o<t.length;o++){if(t[o].pathElement)if(!t[o].pathElement.getLastElement().sgNode){var u=[];s._switchService.retriveNodesFromPath(t[o].pathElement,u),u.forEach((function(e){e&&"thumbnail"===s._viewerController.getLoadedStream(e)&&l.push(e)}))}}l.length?s._switchService.switchToAV1({nodes:l,lockNodesAfterSwitch:!0,lockMeshInRAMAfterSwitch:!0,onCompleteCB:function(e){s._switchRepInfo.clearTimeout=void 0;var t=e.nodeIDsOfLockedNodes;t&&t.length>0&&(s._switchRepInfo.lockedNodeIds||(s._switchRepInfo.lockedNodeIds=[]),t.forEach((function(e){-1===s._switchRepInfo.lockedNodeIds.indexOf(e)&&s._switchRepInfo.lockedNodeIds.push(e)}))),n()},onFailureCB:function(){s._switchRepInfo.clearTimeout=void 0}}):n()}else n()},_duplicateMeasureForRepeat:function(e){var t;"Chain"===e?(this._measurable.length>1&&(this._measurable[0]=this._measurable[1].clone()),t=this._measure?this._measure.getAttribute("sSelectedType2"):this._selectBestType(this,this._measurable[0])):"Fan"===e?(this._measurable[0]=this._measurable[0].clone(),t=this._measure?this._measure.getAttribute("sSelectedType2"):this._selectBestType(this,this._measurable[0])):"Multiple"===e&&this._measurable[0]&&this._measurable[0].getTypeWithSelFilter&&(t=this._measurable[0].getTypeWithSelFilter()),this._createMeasure(t)},_enterBetweenCallback:function(){this.sendNotify("info",H.notifyrepeatbtwnmultimeasfirstsel);var e=this._measure.getAttribute("sSelectedType1")===c.ViewedType.POINT&&this._measure.getAttribute("sSelectedType2")===c.ViewedType.POINT,t=this._pathElementAgentWithCSO.cso;this._objAction&&t._items.length,this._createAssistantTools({bOK:!0,bKeeponlylast:"3dPlay"!==this._measureCommandMode&&"Geovia"!==this._arguments[0].ID,bThreepoints:e&&"3dPlay"!==this._measureCommandMode&&"Geovia"!==this._arguments[0].ID}),this._filterUI&&this._filterUI.setVisibleBottomContentFlag(!0),"productOnly"===this._activeFilter&&"ProgressiveVisuLoading"!==this._measureCommandMode&&this._createLevelSelector(!1),a.isEnvActivated("measurecsomanagement",!0)||this.addInCSO(this._measure)},_exitBetweenCallback:function(){this.cleanNotify(),this._cleanLevelSelector(),this._removeAssistantTools()},_enterThreepointsCallback:function(){var e=this,t="Angle"===e._threepoints?H.notify3pointsangle:"Angle"===e._threepoints?H.notify3pointscircle:H.notify3points;e.sendNotify("info",t),this._filterUI&&this._filterUI.setVisibleBottomContentFlag(!1)},_exitThreepointsCallback:function(){this.cleanNotify()},_computeThreepointsCallback:function(e,t,i=!1){var s=this;s._removePreVisuNode(),this._treatSelection({data:t,load:!0,callback:function(t){if(t){var a=function(){var t=s.getMeasureContainer();t&&(s._measure.setAttribute("sType","AngleBy3Points"===localStorage.getItem("DMUMeasure3PointsDisplayPreferences")?"Measure3PointsAngle":"Measure3PointsCircle"),s._measure.setAttribute("sName",t.computeNewName({object:s._measure,prefix:H.measurethreepointsname})),s._measure.setAttribute("iExtensionLinesManipulable",1),s._measureOnGeometryType&&s._measure.setAttribute("sMeasureOnGeometryType",s._measureOnGeometryType)),s._createAssistantTools({bOK:!0}),s._measureThreePoints(),s._lockNodeFromMeasurable(s._measurable[2]),i&&s._endExecute(),e()};if(s._objAction){var n=function(){var e=s.getMeasureContainer(),t="3dPlay"===s._measureCommandMode?s._measureCommandMode:s._arguments[0].ID;s._measure=new m(s._viewer,e,t),r.setPickability(s._measure,!1),s._measure._preferences=s._preferences,s._measure._isInCreationState=!0,s._createdMeasures.push(s._measure),s._measure.setMeasurable(1,s._measurable[0]),s._measure.setAttribute("sResultingType1",s.retrieveItemResultType(s._measure.getMeasurable(1).getType(),s._measure.getAttribute("sSelectedType1"))),s._measure.setAttribute("sSelectedType1",s._selectBestType(s,s._measurable[0])),s._measure.fireEvent("onDMUObjectInitialized",{dmuObject:s._measure}),e.addDMUObject?e.addDMUObject(s._measure):e.getCurrentSlide&&e.getCurrentSlide()&&e.getCurrentSlide().addDMUObject(s._measure),s._measure.isMeasureDisplayed()&&s._measure.refreshNode(),s._measure.setMeasurable(2,s._measurable[1]),a(),s._objAction=!1};0===s._preferences.length?s.asyncReadPref(s,n):n()}else s._measurable[2]=t,a()}}}),a.isEnvActivated("measurecsomanagement",!0)||s.addInCSO(s._measure)},_createLevelSelector:function(e){var a,i=this,s=e?0:1;if(e&&i._bCumulativeMeas&&i._measure._bCumulativeMeasure&&(s=i._measurable.length-1),this.dataLevels=[],this._getLevels=function(e){i.dataLevels=[];for(var t=i._measurable[s].getPathElement(),a=r.getLastReference(t),n=[],l=a.externalPath.length,o=0;o<l;++o){var u=a.getLastElement(!0);r.isReference(u)&&(i.dataLevels.push({pathElement:a.clone(),name:u.name,internalLevel:l-o}),n.push(u)),a=a.getParentPath()}var m=D.getContextViewer({reviewContext:D.getReviewContext({viewer:i.getFrameWindow().getViewer()})});r.getName(n,(function(t){for(var a=t.length,r=0;r<a;++r)i.dataLevels[r].name=t[r];e()}),m,"");for(var c=0,d=i._measurable[s].getLevel(),p=0;p<i.dataLevels.length;p++)if(i.dataLevels[p].pathElement.getLength()===d){c=p;break}return{currentLevel:c,levels:i.dataLevels}},this._onLevelHover=function(e){e&&i.addInPSO({path:e.pathElement},!1)},this._onLevelSelect=function(t){i._bCumulativeMeas&&(s=i._measurable.length-1);for(var a=0,n=0;0===a&&n<i.dataLevels.length;++n)i.dataLevels[n].pathElement.getLength()===t.pathElement.getLength()&&(a=i.dataLevels[n].internalLevel);var l=!1;a===2*i.dataLevels.length&&(l=!0);var o=[],u=[],m=!0,d=[],p=[],_=r.getLastRepReference(t.pathElement);null!==_&&0!==_.getLength()||(_=r.getLastReference(t.pathElement)),"ProgressiveLarge"===i._getViewerLoadingMode()&&(a&&!l?(m=!1,i._measurable[s].setPartial(!0),V&&V.displayNotification({eventID:"error",msg:H.notifyPartialStructureFailure})):i._measurable[s].setPartial(!1)),m&&("DynamicRep"===i._getViewerLoadingMode()?m=i._lockNodes(_.getLastElement(!0),o,t.pathElement.getParentPath()):"ProgressiveFull"===i._getViewerLoadingMode()&&(a&&!l?(m=i._getNodesToSwitchInRAM(_.getLastElement(!0),p,d,u),i._measurable[s].setPartial(!0)):i._measurable[s].setPartial(!1)));var h=function(a){a?(i._measure&&(i._undisplayPartialLevel(),"errorBtw"===a?i._displayPartialLevel():m?(i._partialMeasureDisplay[s]=null,s>0?(i._partialMeasureDisplay[0]=null,"partialCmd"===i._measure.isPartialMeasure()&&i._displayPartialLevel(),i._partialMeasureDisplay[0]||i._measure.setPartialMeasure(!1)):i._measure.setPartialMeasure(!1)):(i._partialMeasureDisplay[s]={path:t.pathElement,lockedNodes:o},s>0&&i._displayPartialLevel(),i._measure.setPartialMeasure("partialCmd"))),i._measure&&(e?(i._measure.setAttribute("sSelectedType1",c.ViewedType.PRODUCT),i._measure&&i._measure._bCumulativeMeasure?(i._measurable[s].updateProductMeasurable(),i._updateCumulativeMeasure()):i._measureItem({iDoNotUpdateDisplayProp:!0})):(i._measure.setAttribute("sSelectedType2",c.ViewedType.PRODUCT),i._measureBetween({iDoNotUpdateDisplayProp:!0})))):0===s&&i._measure&&i._measure.setPartialMeasure("partialCmd"),i.emptyHSO(),i._measurable&&(i._addElementToHSO(i._measurable[0]),s>0&&i._addElementToHSO(i._measurable[1])),i._measure&&i._measure.isMeasureDisplayed()&&i._measure.refreshNode(),i._viewer.render()};i._measurable[s].setLevel(a),0===s&&i._measurable[s].isPartial()&&i._measure&&i._measure.updatePrdIDAsPerSelectedLevel&&i._measure.updatePrdIDAsPerSelectedLevel();var M=function(){for(var e=0;e<u.length;e++)-1===i._lockedMeshInRAM.indexOf(u[e])&&(i._viewerController.lockRepresentationMeshInRAM(u[e]),i._lockedMeshInRAM.push(u[e])),-1===i._lockedNodes.indexOf(u[e])&&(i._viewerController.lockNodes({ids:[u[e]]}),i._lockedNodes.push(u[e]));"DynamicRep"===i._getViewerLoadingMode()?h(!0):p.length>0||d.length>0?i._switchNodeVisu({nodes_cgr:p,nodes_MIR:d,onComplete:function(){h(!0)},onFailure:function(e){"fullMemory"===e&&(V&&V.displayNotification({eventID:"error",msg:H.notifyFullMemoryFailure}),h(!1))}}):h(!0)};if("ProgressiveFull"===i._getViewerLoadingMode()||"ProgressiveLarge"===i._getViewerLoadingMode())if(i._measure&&"MeasureItem"===i._measure.getAttribute("sType")&&i._measure._bCumulativeMeasure||!i._measurable[1])m?M():h(!1);else if(i._measurable[0].isPartial()||i._measurable[1].isPartial()){var y=i._firstSelectionLeafNodes.concat(i._secondSelectionLeafNodes);if(i._lockedMeshInRAM){var v=[];i._lockedMeshInRAM.forEach((function(e){-1===y.indexOf(e)?i._viewerController.unlockRepresentationMeshInRAM(e):v.push(e)})),i._lockedMeshInRAM=[],i._lockedMeshInRAM=v.slice()}if(i._lockedNodes){var g=[],D=[];i._lockedNodes.forEach((function(e){-1===y.indexOf(e)?D.push(e):g.push(e)})),i._viewerController.unlockNodes({ids:D}),i._lockedNodes=[],i._lockedNodes=g.slice()}i._callMinMaxIndexService({onComplete:function(){m=!0,h(!0)},onFailure:function(e){if("fullMemory"===e.cause)if(e.setALoadedState&&e.setBLoadedState){if("partial"===e.setALoadedState){var t=i._measurable[0].getPathElement(),a=i._measurable[0].getLevel();a&&(t=r.truncatePathElement(t,a)),i._partialMeasureDisplay[0]={path:t,lockedNodes:[],opacity:1}}if("partial"===e.setBLoadedState){var s=i._measurable[1].getPathElement(),n=i._measurable[1].getLevel();n&&(s=r.truncatePathElement(s,n)),i._partialMeasureDisplay[1]={path:s,lockedNodes:[],opacity:1}}i._measure.setPartialMeasure("partialCmd"),i._measurable[0].setLevel(null),i._measurable[0].setPartial(!1),i._measurable[1].setLevel(null),i._measurable[1].setPartial(!1),h("errorBtw"),V&&V.displayNotification({eventID:"error",msg:H.notifyRequestedMinDistanceFullMemoryFailure})}else V&&V.displayNotification({eventID:"error",msg:H.notifyMinDistanceFullMemoryFailure}),i.removeMeasureFromSession(i._measure),i.publish({event:"failure",data:null});else V&&V.displayNotification({eventID:"error",msg:H.notifyMinDistanceFailure}),i.removeMeasureFromSession(i._measure),i.publish({event:"failure",data:null})}})}else m?(i._measure.setPartialMeasure(!1),M()):h(!1);else m?M():i._measure&&(s>0?h(!0):(i._partialMeasureDisplay[s]={path:t.pathElement,lockedNodes:o},i._measure.setPartialMeasure("partialCmd")),i._viewer.render())},this._measure)a=this._measure.getAttribute("vLeaderBreakPoint3D");else if(this._measurable[0]){var n=this._measurable[0].getSelPoint();n||(n=this._measurable[0].getCoG()),a=n.clone()}var l=t.getWindowPositionFromPoint(this._viewer,a,this._frmWindow),o={positionX:l.left,positionY:l.top-110,uiFrame:this._frmWindow.getUIFrame(),selectedPath:this._getLevels,getLevels:this._getLevels,onHover:this._onLevelHover,onSelect:this._onLevelSelect};this._cleanLevelSelector(),_.createView(o)},_cleanLevelSelector:function(){var e=_._noAnim;_._noAnim=!0,_.destroyView(),_._noAnim=e},_measureItem:function(e){if(this._measure.setMeasurable(1,this._measurable[0]),this._measure.setAttribute("sResultingType1",this.retrieveItemResultType(this._measure.getMeasurable(1).getType(),this._measure.getAttribute("sSelectedType1"))),"2D"===this._measureOnGeometryType){var a=this._measure.getMeasurable(1);this._measure.getAttribute("sSelectedType1")===c.ViewedType.POINT&&a.getType()!==i.GeometryType.POINT&&a.setType(i.GeometryType.POINT)}var r,s=this._measure.getAttribute("sResultingType1");if(s===c.ResultType.CIRCLE){var n=0;"TANGENT"===localStorage.getItem("DMUMeasureRadiusResultDisplayPreferences")&&(n=1),this._measure.getAttribute("iRadiusResultDisplayType")!==n&&this._measure.setAttribute("iRadiusResultDisplayType",n),r="DisplayRadius"===localStorage.getItem("DMUMeasureCircleRadiusPreferences"),Math.abs(2*Math.PI-this._measurable[0]._arcAngle)>.001&&("dia/rad"===this._resType||"length"!==this._resType&&"DisplayArcLength"!==localStorage.getItem("DMUMeasureArcRadiusPreferences")?(this._measure.setAttribute("bArcLengthDisplay",!1),r="DisplayRadius"===localStorage.getItem("DMUMeasureArcRadiusPreferences")):this._measure.setAttribute("bArcLengthDisplay",!0)),this._measure.getAttribute("bRadiusDisplay")!==r&&this._measure.setAttribute("bRadiusDisplay",r)}else if(s===c.ResultType.CYLINDER)if("dia/rad"===this._resType)this._measure.setAttribute("sSurfaceDisplayType","Radius"===l||"Diameter"===l?l:"Diameter");else if("length"===this._resType)this._measure.setAttribute("sSurfaceDisplayType","Length");else if("area"===this._resType)this._measure.setAttribute("sSurfaceDisplayType","Area");else{var l=localStorage.getItem("DMUMeasSurfaceDisplayCylinderPref");this._measure.setAttribute("sSurfaceDisplayType",l)}else if(s===c.ResultType.CONE)if("length"===this._resType)this._measure.setAttribute("sSurfaceDisplayType","Length");else if("area"===this._resType)this._measure.setAttribute("sSurfaceDisplayType","Area");else{var o=this._measurable[0].getApex(),u=this._measurable[0].getPoints(),m=localStorage.getItem("DMUMeasSurfaceDisplayConePref");("MinimumRadius"===m||"MinimumDiameter"===m)&&o&&(Math.abs(o.x-u.beginPoint.x)<.001&&Math.abs(o.y-u.beginPoint.y)<.001&&Math.abs(o.z-u.beginPoint.z)<.001||Math.abs(o.x-u.endPoint.x)<.001&&Math.abs(o.y-u.endPoint.y)<.001&&Math.abs(o.z-u.endPoint.z)<.001)?(m="HalfAngle",this._measure.updateFeatureAndSurfaceDisplayTypePreference(m)):this._measure.setAttribute("sSurfaceDisplayType",m)}else if(s===c.ResultType.SPHERE)if("dia/rad"===this._resType)this._measure.setAttribute("sSurfaceDisplayType","Radius"===l||"Diameter"===l?l:"Diameter");else if("area"===this._resType)this._measure.setAttribute("sSurfaceDisplayType","Area");else{var d=localStorage.getItem("DMUMeasSurfaceDisplaySpherePref");this._measure.setAttribute("sSurfaceDisplayType",d)}else if(s===c.ResultType.PRODUCT){var p=localStorage.getItem("DMUMeasProductDisplayPref");this._measure.setAttribute("sProductDisplayType",p)}switch(this._measure.update(e),this._measure.getAttribute("sResultingType1")){case c.ResultType.POINT:case c.ResultType.PICKINGPT:case c.ResultType.CENTER:case c.ResultType.PLANE:case c.ResultType.CURVE:case c.ResultType.SURFACE:this._vAssistantPosition=this._measure.getAttribute("vFirstExtensionPoint3D").clone();break;case c.ResultType.LINE:this._vAssistantPosition=this._measure.getAttribute("vFirstExtensionPoint3D").clone().add(this._measure.getAttribute("vSecondExtensionPoint3D")).multiplyScalar(.5);break;case c.ResultType.AXIS:this._vAssistantPosition=this._measure.getAttribute("vLeaderPointingPoint3D").clone();break;case c.ResultType.CIRCLE:var _=t.getViewpointInfo(this._viewer.currentViewpoint),h=Math.abs(this._measure.getAttribute("vNormal").angleTo(_.sight)-Math.PI/2)<Math.PI/10;this._vAssistantPosition=h?this._measure.getAttribute("vCenter").clone():this._measure.getAttribute("vLeaderPointingPoint3D").clone();break;case c.ResultType.CYLINDER:r="DisplayRadius"===localStorage.getItem("DMUMeasureCylinderRadiusPreferences"),this._vAssistantPosition=this._measure.getAttribute("vPoint1").clone().add(this._measure.getAttribute("vPoint2")).multiplyScalar(.5),this._measure.getAttribute("bRadiusDisplay")!==r&&this._measure.setAttribute("bRadiusDisplay",r);break;case c.ResultType.CONE:this._vAssistantPosition=this._measure.getAttribute("vPoint2").clone();break;case c.ResultType.SPHERE:r="DisplayRadius"===localStorage.getItem("DMUMeasureSphereRadiusPreferences"),this._vAssistantPosition=this._measure.getAttribute("vCenter").clone(),this._measure.getAttribute("bRadiusDisplay")!==r&&this._measure.setAttribute("bRadiusDisplay",r);break;case c.ResultType.PRODUCT:this._vAssistantPosition=this._measure.getAttribute("vLeaderPointingPoint3D").clone()}this._vAssistantPosition=this._measure.movePosDownByPixels({position:this._vAssistantPosition.clone(),pixels:45})},_measureBetween:function(e){if(this._measure._objAction=this._objAction,this._objAction||this._measure.setMeasurable(2,this._measurable[1]),this._measure.setAttribute("sResultingType1",this.retrieveBetweenResultType({selectedType1:this._measure.getAttribute("sSelectedType1"),selectedType2:this._measure.getAttribute("sSelectedType2"),measurable:this._measurable[0]})),this._measure.setAttribute("sResultingType2",this.retrieveBetweenResultType({selectedType1:this._measure.getAttribute("sSelectedType2"),selectedType2:this._measure.getAttribute("sSelectedType1"),measurable:this._measurable[1]})),"2D"===this._measureOnGeometryType){var t=this._measure.getMeasurable(1),a=this._measure.getMeasurable(2);if(this._measure.getAttribute("sSelectedType1")===c.ViewedType.POINT&&t.getType()!==i.GeometryType.POINT&&t.setType(i.GeometryType.POINT),this._measure.getAttribute("sSelectedType2")===c.ViewedType.POINT&&t.getType()!==i.GeometryType.POINT&&a.setType(i.GeometryType.POINT),this._retrieveDistanceTypeFor2DMeasures){var r=this._retrieveDistanceTypeFor2DMeasures();this._measure.setAttribute("sDistanceType",r.distanceType),this._measure._local2DDistancePref=r.localprefName}}if(this._measure.setDistanceType(this._resType),this._measure.update(e),void 0!==this._measure.getAttribute("fDistance")||void 0!==this._measure.getAttribute("fAngle")){var s=this._measure.getAttribute("vSecondExtensionPoint3D").clone();"Angle"===this._measure.getAttribute("sDistanceType")&&(s=this._measure.getMeasurable(2).getSelPoint()),this._vAssistantPosition=this._measure.movePosDownByPixels({position:s,pixels:45})}},_measureThreePoints:function(){if(this._measure.setMeasurable(3,this._measurable[2]),"Measure3PointsCircle"===this._measure.getAttribute("sType")){this._measure.setAttribute("sDistanceType","none");var e=0;"TANGENT"===localStorage.getItem("DMUMeasure3PointsCircleRadiusResultDisplayPreferences")&&(e=1),this._measure.getAttribute("iRadiusResultDisplayType")!==e&&this._measure.setAttribute("iRadiusResultDisplayType",e)}else if("Measure3PointsAngle"===this._measure.getAttribute("sType")){this._measure.setAttribute("sDistanceType","Angle");var t=this._measure.getMeasurable(3).getSelPoint();this._vAssistantPosition=this._measure.movePosDownByPixels({position:t,pixels:45})}this._measure.update(),this._filterUI&&"Angle"===this._measure.getAttribute("sDistanceType")&&this._filterUI._updatePosition()},retrievePossibleSelectedType:function(e){var t=[],a=e.getType();return"2D"===this._measureOnGeometryType?a===i.GeometryType.LINE||a===i.GeometryType.CURVE?t.push(c.ViewedType.CURVE):a===i.GeometryType.CIRCLE?t.push(c.ViewedType.CIRCLE):t.push(c.ViewedType.POINT):(a===i.GeometryType.POINT||a===i.GeometryType.PICKINGPT?t.push(c.ViewedType.POINT):a===i.GeometryType.PLANE?(t.push(c.ViewedType.INFPLANE),t.push(c.ViewedType.POINT),t.push(c.ViewedType.SURFACE)):a===i.GeometryType.CYLINDER||a===i.GeometryType.CONE?(t.push(c.ViewedType.CYCOSP),t.push(c.ViewedType.AXIS),t.push(c.ViewedType.POINT),t.push(c.ViewedType.SURFACE)):a===i.GeometryType.SPHERE?(t.push(c.ViewedType.CYCOSP),t.push(c.ViewedType.CENTER),t.push(c.ViewedType.POINT),t.push(c.ViewedType.SURFACE)):a===i.GeometryType.LINE?(t.push(c.ViewedType.CURVE),t.push(c.ViewedType.AXIS),t.push(c.ViewedType.POINT)):a===i.GeometryType.CIRCLE?(t.push(c.ViewedType.CIRCLE),t.push(c.ViewedType.CENTER),t.push(c.ViewedType.POINT),t.push(c.ViewedType.CURVE)):a===i.GeometryType.CURVE?(t.push(c.ViewedType.CURVE),t.push(c.ViewedType.POINT)):a===i.GeometryType.SURFACE&&(t.push(c.ViewedType.SURFACE),t.push(c.ViewedType.POINT)),t.push(c.ViewedType.PRODUCT)),t},retrieveItemResultType:function(e,t){var a=c.ResultType.POINT;if(t===c.ViewedType.POINT)a=c.ResultType.POINT;else if(t===c.ViewedType.PRODUCT)a=c.ResultType.PRODUCT;else switch(e){case i.GeometryType.POINT:case i.GeometryType.PICKINGPT:a=c.ResultType.POINT;break;case i.GeometryType.LINE:a=this._objAction?c.ResultType.LINE:t===c.ViewedType.AXIS?c.ResultType.AXIS:c.ResultType.LINE;break;case i.GeometryType.CIRCLE:a=this._objAction?c.ResultType.CIRCLE:t===c.ViewedType.CENTER?c.ResultType.CENTER:t===c.ViewedType.CURVE?c.ResultType.CURVE:c.ResultType.CIRCLE;break;case i.GeometryType.CURVE:a=c.ResultType.CURVE;break;case i.GeometryType.PLANE:a=this._objAction?c.ResultType.PLANE:t===c.ViewedType.SURFACE?c.ResultType.SURFACE:c.ResultType.PLANE;break;case i.GeometryType.CYLINDER:a=this._objAction?c.ResultType.CYLINDER:t===c.ViewedType.AXIS?c.ResultType.AXIS:t===c.ViewedType.SURFACE?c.ResultType.SURFACE:c.ResultType.CYLINDER;break;case i.GeometryType.CONE:a=this._objAction?c.ResultType.CONE:t===c.ViewedType.AXIS?c.ResultType.AXIS:t===c.ViewedType.SURFACE?c.ResultType.SURFACE:c.ResultType.CONE;break;case i.GeometryType.SPHERE:a=this._objAction?c.ResultType.SPHERE:t===c.ViewedType.CENTER?c.ResultType.CENTER:t===c.ViewedType.SURFACE?c.ResultType.SURFACE:c.ResultType.SPHERE;break;case i.GeometryType.SURFACE:a=c.ResultType.SURFACE}return a},retrieveBetweenResultType:function(e){var t;if("2D"===this._measureOnGeometryType)t=this.retrieveItemResultType(e.measurable.getType(),e.selectedType1);else{t=c.ResultType.POINT;var a=e.selectedType2;switch(e.selectedType1){case c.ViewedType.POINT:case c.ViewedType.CENTER:t=c.ResultType.POINT;break;case c.ViewedType.AXIS:t=a===c.ViewedType.POINT||a===c.ViewedType.CENTER||a===c.ViewedType.AXIS||a===c.ViewedType.INFPLANE?c.ResultType.AXIS:c.ResultType.CURVE;break;case c.ViewedType.CURVE:t=c.ResultType.CURVE;break;case c.ViewedType.INFPLANE:t=a===c.ViewedType.POINT||a===c.ViewedType.CENTER||a===c.ViewedType.AXIS||a===c.ViewedType.INFPLANE?c.ResultType.PLANE:c.ResultType.SURFACE;break;case c.ViewedType.SURFACE:t=c.ResultType.SURFACE;break;case c.ViewedType.PRODUCT:t=c.ResultType.PRODUCT;break;case c.ViewedType.CIRCLE:t=c.ResultType.CURVE;break;case c.ViewedType.CYCOSP:t=c.ResultType.SURFACE}}return t},getCumulativeMeaurePref:function(){let e="",t=this;if(!t||!t._measurable||!t._measurable.length)return e;switch(t._measurable[0].getType()){case i.GeometryType.LINE:case i.GeometryType.CURVE:e="DMUCumulativeLengthMeasurePref";break;case i.GeometryType.PLANE:case i.GeometryType.SURFACE:e="DMUCumulativeAreaMeasurePref";break;case i.GeometryType.PRODUCT:e="DMUCumulativeVolumeMeasurePref";break;case i.GeometryType.CIRCLE:t._measure&&"Arc_Length"===t._measure._sMainValueType&&(e="DMUCumulativeLengthMeasurePref");break;case i.GeometryType.CYLINDER:case i.GeometryType.CONE:case i.GeometryType.SPHERE:!t._measure||"Cylinder_Length"!==t._measure._sMainValueType&&"Cone_Length"!==t._measure._sMainValueType?t._measure&&"Surface_Area"===t._measure._sMainValueType&&(e="DMUCumulativeAreaMeasurePref"):e="DMUCumulativeLengthMeasurePref"}return e},_createAssistantTools:function(e){var t="",a=this;void 0!==e.bMeasCumulative&&e.bMeasCumulative&&(!a._measure||"MeasureItem"===a._measure.getAttribute("sType"))&&a._measurable.length>0&&(t=a.getCumulativeMeaurePref(),a._bCumulativeMeas=!1,""!==t&&(a._bCumulativeMeas="true"===localStorage.getItem(t)));var i=[];void 0!==e.bOK&&e.bOK&&i.push({nls:H.ok,url:this._iconDir+"I_Validate.png",id:"OK",callback:function(){a.publish({event:"OK",data:null})},bstateActif:!1,triggerEvent:"enter"}),void 0!==e.bRepeatitem&&e.bRepeatitem&&i.push({nls:H.repeatitem,url:this._iconDir+"I_Repeat.png",id:"Repeat",callback:function(){a._repeatType="Item",a.publish({event:"repeatitem",data:null})},bstateActif:!1}),void 0!==e.bKeeponlylast&&e.bKeeponlylast&&i.push({nls:H.keepprevious,url:this._iconDir+"I_KeepOnlyLast.png",id:"Keep",callback:function(){a._bKeepall=!a._bKeepall},bstateActif:this._bKeepall}),void 0!==e.bAnglethreepoints&&e.bAnglethreepoints&&i.push({nls:H.anglethreepoints,url:this._iconDir+"I_MeasureAngle3Points.png",id:"Angle3Points",callback:function(){a._threepoints="Angle",a.publish({event:"threepoints",data:null})}}),void 0!==e.bCirclethreepoints&&e.bCirclethreepoints&&i.push({nls:H.circlethreepoints,url:this._iconDir+"I_MeasureArc3Points.png",id:"Arc3Points",callback:function(){a._threepoints="Circle",a.publish({event:"threepoints",data:null})}}),void 0!==e.bThreepoints&&e.bThreepoints&&i.push({nls:H.threepoints,url:this._iconDir+"I_Measure3Points.png",id:"3Points",callback:function(){a._threepoints="Threepoints",a.publish({event:"threepoints",data:null})}}),void 0!==e.bMeasCumulative&&e.bMeasCumulative&&i.push({nls:H.measCumulative,url:this._iconDir+"I_CumulativeMeasure.png",id:"CumulativeMeasure",callback:function(){a._bCumulativeMeas=!a._bCumulativeMeas,a._resType&&a._enableSpecialCumulativeMeasure&&a._measureCumulativeCB(a._bCumulativeMeas),""!==t&&localStorage.setItem(t,a._bCumulativeMeas),a._bCumulativeMeas?a.publish({event:"cumulative",data:null}):a.publish({event:"noncumulative",data:null})},bstateActif:this._bCumulativeMeas}),i.length>0&&i.push({nls:H.separator,url:this._iconDir+"I_Meas_Separator.png",id:"separator"}),this._removeAssistantTools(),this._filterUI?this._filterUI.setTopContent(i):(this._filterUI=new u({body:this._frmWindow.getUIFrame(),frmWindow:this._frmWindow,title:"Filter Control",actionBar:this._frmWindow.getActionBar(),lTop_content:i}),this._filterUI.build(),this._filterUI.setVisibleTopContentFlag(!0))},_removeAssistantTools:function(){this._filterUI&&(this._filterUI.clear(),this._filterUI.setVisibleTopContentFlag(!1)),this._tokenVISUEvent&&(h.unsubscribe(this._tokenVISUEvent),this._tokenVISUEvent=null)},_isItMeasurable:function(e){var t=!1;if(void 0!==e){if(this._measureThickness&&r.isOOCTileSetNodeInPath(e))return!1;if(r.getFirstReference(e).externalPath.length>0)t=!0;else t=D.getReviewContext({viewer:this.getFrameWindow().getViewer()}).getDMUObjectFromPathElement(e)&&!0===e.getLastElement(!0).measurable;t||this._activeFilter&&"pointOnly"!==this._activeFilter&&("SeveralGeometries"!==this._activeFilter||this._filterUI&&this._filterUI.getActiveState("center"))||(t=r.isOOCTileSetNodeInPath(e)),t||this._activeFilter&&"pointOnly"!==this._activeFilter&&("SeveralGeometries"!==this._activeFilter||this._filterUI&&this._filterUI.getActiveState("center"))||(t=r.isAPOIPath(e))&&this._measureThickness&&(t=this.managePOISelection({pathElement:e}))}return t},_lockNodeFromMeasurable:function(e){if("ProgressiveVisuLoading"===this._measureCommandMode&&this._viewerController&&e&&!r.isOOCTileSetNodeInPath(e.getPathElement())){var t=r.getLastRepReference(e.getPathElement());if(null===t&&(t=r.getLastReference(e.getPathElement())),t){var a=t.getLastElement(!0);if(a&&r.isPLMNode(a)){var i=r.getNodeID(a);this._measure.isNodeLocked(i)||(this._viewerController.lockNodes({ids:[i]}),this._measure.addLockedNode(i))}}}},_lockNodes:function(e,t,a){var i=!0,s=null;if(a&&(s=a.clone()).addElement(e),this._viewerController&&e)if(r.isRepReference(e)&&r.isPLMNode(e)){var n=r.getNodeID(e),l=this._viewerController.isReferenceComplete(n);!0===l||null===l?(-1===this._lockedNodes.indexOf(n)&&(this._viewerController.lockNodes({ids:[n]}),this._lockedNodes.push(n)),t.push(s)):i=!1}else{var o=e.getChildren();if(o)for(var u=0;u<o.length;u++){var m=this._lockNodes(o[u],t,s);i&&!m&&(i=!1)}}return i},_displayPartialLevel:function(){var e=this;this._overrideSet||(this._overrideSet=r.createSceneGraphOverrideSet(this._viewer)),this._overrideSet&&this._partialMeasureDisplay.forEach((function(t){if(t){for(var a=null,i=0;i<t.lockedNodes.length;i++)t.lockedNodes[i]&&(null===(a=e._overrideSet.getUniqueOverrideFromPathElement(t.lockedNodes[i]))&&(a=e._overrideSet.createOverride(t.lockedNodes[i])),a.setOpacity(1,!0));if(null===(a=e._overrideSet.getUniqueOverrideFromPathElement(t.path))&&(a=e._overrideSet.createOverride(t.path)),a){a.setColor(16744448,!1),a.setOpacity(t.opacity?t.opacity:.3,!1)}}}))},_undisplayPartialLevel:function(){this._overrideSet&&(r.removeSceneGraphOverrideSet(this._viewer,this._overrideSet),this._overrideSet=null)},_getNodesToSwitchInRAM:function(e,t,a,i){var s=!0,n=this;if(this._viewerController&&e&&a){var l=r.getNodeID(e),o=this._viewerController.createReferenceIterator(l);if(o){var u=function(e,t,a,i){if(e){var l=e.getChildren();if(l&&l.length>0){for(var o=0;o<l.length;o++)if(u(l[o].getReferenceIterator(),t,a,i),!s){a=[],a=[];break}}else{var m=e.getNode();if(m){var c=r.getNodeID(m),d=n._viewerController.isReferenceComplete(c);if(!0===d||null===d){var p=!0;"cgr"!==n._viewerController.getLoadedStream(m)&&-1===t.indexOf(m)&&(t.push(m),p=!1),!1===n._viewerController.hasMeshInRAM(c)?-1===a.indexOf(c)&&a.push(c):!0===d&&!0===p&&i.push(c)}else s=!1}else e._reference&&e._reference.userData&&"3DShape"===e._reference.userData.type&&(s=!1)}}};u(o,t,a,i)}}return s},_checkForSelection:function(e){let t=!0;if("2D"===this._measureOnGeometryType){var a=this;if(a._measurable&&a._measurable.length&&a._measurable[0]&&a._measurable[0]._pathElement&&a._measurable[0]._pathElement.externalPath&&e&&e[0]&&e[0].pathElement&&e[0].pathElement.externalPath){var i=a._measurable[a._measurable.length-1],r=i._pathElement.externalPath,s=e[0].pathElement.externalPath;if(r&&s&&r.length>2&&s.length>2)r[r.length-2]!==s[s.length-2]&&(t=!1,L.remove(e[0]),L.add({pathElement:i._pathElement}))}}return t},_retrieveDistanceTypeFor2DMeasures:function(){var e,t,a={},r="MinimumDistance",s=this._measurable[0],n=this._measurable[1];if(s.getType()!==i.GeometryType.CIRCLE&&n.getType()!==i.GeometryType.CIRCLE||(Math.abs(2*Math.PI-s._arcAngle)>.001&&(e=!0),Math.abs(2*Math.PI-n._arcAngle)>.001&&(t=!0)),e&&t)localStorage.getItem("DMUMeasBetween2ArcsDistancePref")&&(r=localStorage.getItem("DMUMeasBetween2ArcsDistancePref"),a.localprefName="DMUMeasBetween2ArcsDistancePref");else if(e&&n.getType()===i.GeometryType.CIRCLE||t&&s.getType()===i.GeometryType.CIRCLE)localStorage.getItem("DMUMeasBetweenCircleArcDistancePref")&&(r=localStorage.getItem("DMUMeasBetweenCircleArcDistancePref"),a.localprefName="DMUMeasBetweenCircleArcDistancePref");else if(e&&n.getType()!==i.GeometryType.CIRCLE||t&&s.getType()!==i.GeometryType.CIRCLE)localStorage.getItem("DMUMeasBetweenArcAnygeomDistancePref")&&(r=localStorage.getItem("DMUMeasBetweenArcAnygeomDistancePref"),a.localprefName="DMUMeasBetweenArcAnygeomDistancePref");else if(s.getType()===i.GeometryType.CIRCLE&&n.getType()===i.GeometryType.CIRCLE)localStorage.getItem("DMUMeasBetween2CirclesDistancePref")&&(r=localStorage.getItem("DMUMeasBetween2CirclesDistancePref"),a.localprefName="DMUMeasBetween2CirclesDistancePref");else if(s.getType()===i.GeometryType.CIRCLE&&n.getType()!==i.GeometryType.CIRCLE||n.getType()===i.GeometryType.CIRCLE&&n.getType()!==i.GeometryType.CIRCLE)localStorage.getItem("DMUMeasBetweenCircleAnygeomDistancePref")&&(r=localStorage.getItem("DMUMeasBetweenCircleAnygeomDistancePref"),a.localprefName="DMUMeasBetweenCircleAnygeomDistancePref");else if(s.getType()===i.GeometryType.LINE&&n.getType()===i.GeometryType.LINE){var l=s.getPoints().endPoint.clone().sub(s.getPoints().beginPoint),o=n.getPoints().endPoint.clone().sub(n.getPoints().beginPoint),u=l.normalize().dot(o.normalize());1===Math.abs(u)?localStorage.getItem("DMUMeasBetween2ParallelLinesDistancePref")&&(r=localStorage.getItem("DMUMeasBetween2ParallelLinesDistancePref"),a.localprefName="DMUMeasBetween2ParallelLinesDistancePref"):localStorage.getItem("DMUMeasBetween2LinesDistancePref")&&(r=localStorage.getItem("DMUMeasBetween2LinesDistancePref"),a.localprefName="DMUMeasBetween2LinesDistancePref")}else localStorage.getItem("DMUMeasBetween2AnyGeomsDistancePref")&&(r=localStorage.getItem("DMUMeasBetween2AnyGeomsDistancePref"),a.localprefName="DMUMeasBetween2AnyGeomsDistancePref");return a.distanceType=r,a},_checkForMeasurable:function(){return this._measurable&&0!==this._measurable.length},_addElementToHSO:function(e){if(e){var t,a=new p,i=[],s=e.getPathElement(),n=e.getLevel();if(n)t=r.truncatePathElement(s,n);else{t=s;var l=e.getPrimitive();if(l)for(var o=THREEDS.SubElement.getFromSGNode(l);null!==o;)i.unshift(o),o=o.getParent()}a.setFromArray(t.externalPath,i),this.addInHSO({path:a},!0)}},_getViewerLoadingMode:function(){var e=null,t=D.getContextViewer({viewer:this.getFrameWindow().getViewer()});if(t&&t.getRoots&&t.getRoots().length>0&&this._viewerController&&this._viewerController.getRootStats(r.getNodeID(t.getRoots()[0])))if(F)F.getSetting("enopad3dviewer_lightNodeModel")?e=this._viewerController.isLargeSession()?"ProgressiveLarge":"ProgressiveFull":F.getSetting("enopad3dviewer_dynamicRepLoading")&&(e="DynamicRep");else{let t=setInterval((function(){F&&(clearInterval(t),F.getSetting("enopad3dviewer_lightNodeModel")?e=this._viewerController&&this._viewerController.isLargeSession()?"ProgressiveLarge":"ProgressiveFull":F.getSetting("enopad3dviewer_dynamicRepLoading")&&(e="DynamicRep"))}),100)}return e},_callMinMaxIndexService:function(e){var t=this,a=r.getFirstReference(t._measurable[0].getPathElement()).getLastElement();if(a===r.getFirstReference(t._measurable[1].getPathElement()).getLastElement()){var i=r.getNodeID(a),s=t._measurable[0].getPathElement(),n=t._measurable[0].getLevel();n&&(s=r.truncatePathElement(s,n));var l=t._measurable[1].getPathElement(),o=t._measurable[1].getLevel();o&&(l=r.truncatePathElement(l,o));var u=t._viewerController.buildArrayFromPath(s),m=t._viewerController.buildArrayFromPath(l),c=[],d=[],p=[],_=[],h=D.giveEventsController({viewer:this._viewer}),M=D.getContextViewer({viewer:t.getFrameWindow().getViewer()}),y=null,v=null,g=!1;h&&(y=h.addEvent(U.Events.EXPEndProgressiveLoad,(function(a){if(a.memoryFull){var i,s;g=!0,M.unsubscribe(v),h.removeEvent(y);var n,l=0,o=0,u=0,m=0;if(c.length>0){for(var D=0;D<c.length;D++)(n=c[D].getLastElement(!0))&&"cgr"===t._viewerController.getLoadedStream(n)&&t._viewerController.hasMeshInRAM(r.getNodeID(n))&&(l++,-1!==t._firstSelectionLeafNodes.indexOf(r.getNodeID(n))&&u++);l===c.length?i="full":t._firstSelectionLeafNodes.length===u&&(i="partial")}else p.length>0&&(p.forEach((function(e){var a=t._viewerController.buildPathFromArray(e);a&&(n=a.getLastElement(!0))&&"cgr"===t._viewerController.getLoadedStream(n)&&t._viewerController.hasMeshInRAM(e[e.length-1])&&(l++,-1!==t._firstSelectionLeafNodes.indexOf(e[e.length-1])&&u++)})),l===p.length?i="full":t._firstSelectionLeafNodes.length===u&&(i="partial"));if(d.length>0){for(var S=0;S<d.length;S++)(n=d[S].getLastElement(!0))&&"cgr"===t._viewerController.getLoadedStream(n)&&t._viewerController.hasMeshInRAM(r.getNodeID(n))&&(o++,-1!==t._secondSelectionLeafNodes.indexOf(r.getNodeID(n))&&m++);o===d.length?s="full":t._secondSelectionLeafNodes.length===m&&(s="partial")}else _.length>0&&(_.forEach((function(e){var a=t._viewerController.buildPathFromArray(e);a&&(n=a.getLastElement(!0))&&"cgr"===t._viewerController.getLoadedStream(n)&&t._viewerController.hasMeshInRAM(e[e.length-1])&&(o++,-1!==t._secondSelectionLeafNodes.indexOf(e[e.length-1])&&m++)})),o===_.length?s="full":t._secondSelectionLeafNodes.length===m&&(s="partial"));e.onFailure({cause:"fullMemory",setALoadedState:i,setBLoadedState:s}),window.console.log("MCmd (full mem): MinMax fails ("+i+","+s+")")}}))),t._viewerController.completeSessionWithMinMaxMeasureCandidates({rootPhID:i,mode:"MaximumDistance"===t._measure.getAttribute("sDistanceType")?"max":"min",sets:[{id:"A",paths:[u]},{id:"B",paths:[m]}],stream:"cgr",meshInRAM:!0}).then((function(a){if(a.selectedPaths.length>0&&a.sortedPaths.A.length>0&&a.sortedPaths.B.length>0){p=a.sortedPaths.A,_=a.sortedPaths.B;for(var i=[],s=0;s<a.selectedPaths.length;s++){t._viewerController.buildPathFromArray(a.selectedPaths[s])?t._viewerController.hasMeshInRAM(a.selectedPaths[s][a.selectedPaths[s].length-1])||-1!==i.indexOf(a.selectedPaths[s][a.selectedPaths[s].length-1])||i.push(a.selectedPaths[s][a.selectedPaths[s].length-1]):-1===i.indexOf(a.selectedPaths[s][a.selectedPaths[s].length-1])&&i.push(a.selectedPaths[s][a.selectedPaths[s].length-1])}var n=function(){var s=[],n=0;v=M.subscribe({event:"onRepresentationLoaded"},(function(a){if(t._viewerController.hasMeshInRAM(a)){for(var i=0;i<s.length;i++)if(-1!==s[i].indexOf(a)){n++;break}n===s.length&&(M.unsubscribe(v),v=null,h.removeEvent(y),y=null,e.onComplete())}}));var l,o=function(e){e.forEach((function(e){var a=e.getLastElement(!0);if(a){var i=r.getNodeID(a);-1===t._lockedNodes.indexOf(i)&&(t._viewerController.lockNodes({ids:[i]}),t._lockedNodes.push(i))}}))};i.length&&t._viewerController.setForceReferencesLoad({data:i.map((function(e){return{id:e,state:!1}}))});for(var u=0;u<a.sortedPaths.A.length;u++)(l=t._viewerController.buildPathFromArray(a.sortedPaths.A[u]))&&c.push(l);o(c),r.isPLMNode(t._measurable[0].getPathElement().getLastElement(!0))&&(t._measurable[0].setPartial(!0),t._measurable[0].setPartialPathElements(c));for(var m=0;m<a.sortedPaths.B.length;m++)(l=t._viewerController.buildPathFromArray(a.sortedPaths.B[m]))&&d.push(l);o(d),r.isPLMNode(t._measurable[1].getPathElement().getLastElement(!0))&&(t._measurable[1].setPartial(!0),t._measurable[1].setPartialPathElements(d)),c.length===a.sortedPaths.A.length&&d.length===a.sortedPaths.B.length&&a.selectedPaths.forEach((function(e){var a=e[e.length-1];t._lockedMeshInRAM.push(a),t._viewerController.hasMeshInRAM(a)||-1===s.indexOf(a)&&s.push(a)})),0===s.length&&(M.unsubscribe(v),v=null,h.removeEvent(y),y=null,e.onComplete())};i.length?t._viewerController.forceReferencesLoad({ids:i,callback:function(){g||n()}}):g||n()}else g||(window.console.log("MCmd: MinMax fails (no candidates)"),h.removeEvent(y),y=null,e.onFailure({cause:"noresult"}))}),(function(){window.console.log("MCmd: MinMax fails (reject)"),h.removeEvent(y),y=null,e.onFailure({cause:"index"})}))}else window.console.log("MCmd: MinMax fails (roots)"),e.onFailure({cause:"roots"})},_switchNodeVisu:function(e){var t=this,a=[],i=[],s=!1;if(e.nodes_cgr&&e.nodes_cgr.length>0||e.nodes_MIR&&e.nodes_MIR.length>0){var n=null,l=null,o=!1,u=D.getContextViewer({viewer:t.getFrameWindow().getViewer()}),m=D.giveEventsController({viewer:t.getFrameWindow().getViewer()});m&&(l=m.addEvent(U.Events.EXPEndProgressiveLoad,(function(a){a.memoryFull&&!s&&(o||(s=!0,t._viewerController.setForceReferencesLoad({data:i.map((function(e){return{id:e,state:!1}}))}),u.unsubscribe(n),window.console.log("MCmd (full mem): rep loading fails"),m.removeEvent(l),e.onFailure("fullMemory")))})));var c=function(a){o=!1;var r=a.length,c=[],d=0;n=u.subscribe({event:"onRepresentationLoaded"},(function(a){-1!==c.indexOf(a)&&t._viewerController.hasMeshInRAM(a)&&(s?(m.removeEvent(l),u.unsubscribe(n)):++d===c.length&&(t._viewerController.setForceReferencesLoad({data:i.map((function(e){return{id:e,state:!1}}))}),m.removeEvent(l),u.unsubscribe(n),o=!0,setTimeout(e.onComplete(),0)))}));for(var p=0;p<r;p++)-1===t._lockedNodes.indexOf(a[p])&&(t._viewerController.lockNodes({ids:[a[p]]}),t._lockedNodes.push(a[p])),-1===t._lockedMeshInRAM.indexOf(a[p])&&(t._viewerController.lockRepresentationMeshInRAM(a[p]),t._lockedMeshInRAM.push(a[p]),t._viewerController.hasMeshInRAM(a[p])||c.push(a[p]));0===c.length&&(t._viewerController.setForceReferencesLoad({data:i.map((function(e){return{id:e,state:!1}}))}),u.unsubscribe(n),m.removeEvent(l),e.onComplete())};e.nodes_cgr.length>0?(e.nodes_cgr.forEach((function(e){a.push({node:e,stream:"cgr"}),-1!==i.indexOf(r.getNodeID(e))&&i.push(r.getNodeID(e))})),this._viewerController.setForceReferencesLoad({data:i.map((function(e){return{id:e,state:!0}})),callback:function(){t._viewerController.switchNodeVisuStreamOnDemand({data:a,callbacks:{onComplete:function(){if(o=!0,"ProgressiveFull"===t._getViewerLoadingMode()||"ProgressiveLarge"===t._getViewerLoadingMode()){var a=[];e.nodes_cgr.forEach((function(e){var t=r.getNodeID(e);-1===a.indexOf(t)&&a.push(t)})),e.nodes_MIR&&e.nodes_MIR.forEach((function(e){-1===a.indexOf(e)&&a.push(e)})),c(a)}else m.removeEvent(l),e.onComplete(!0)},onFailure:function(){window.console.log("MCmd: switchNode fails"),t._viewerController.setForceReferencesLoad({data:i.map((function(e){return{id:e,state:!1}}))}),m.removeEvent(l),e.onFailure()}}})}})):e.nodes_MIR.length>0&&c(e.nodes_MIR)}else e.onFailure()},asyncReadPref:async function(e,t){if(e){try{let t=await I.readPreferences([{Repository:"MeasureRepository"}]);if(t.repositories.length>0&&t.repositories[0]&&t.repositories[0].preferences)for(var a=t.repositories[0].preferences.length,i=0;i<a;i++){var r;switch(t.repositories[0].preferences[i].datatype.toLowerCase()){case"string":r=JSON.parse(t.repositories[0].preferences[i].value);break;case"boolean":r="true"===t.repositories[0].preferences[i].value.toLowerCase();break;case"float":r=parseFloat(t.repositories[0].preferences[i].value);break;case"integer":r=parseInt(t.repositories[0].preferences[i].value);break;default:r=t.repositories[0].preferences[i].value}e._preferences.push({name:t.repositories[0].preferences[i].name,value:r})}}catch(t){window.console.log(t),e._preferences=e.getDefaultPreference()}if(D.getReviewContext({viewer:e.getFrameWindow().getViewer()}))for(var s=0;s<e._preferences.length;s++)if("DMUMeasureRemovePreviousNonPersistent"===e._preferences[s].name){e._removePreviousNonPersistent=!1,e._preferences[s].value&&(e._removePreviousNonPersistent=!0);break}t&&t()}},getDefaultPreference:function(){return[{name:"Coordinates_DisplayType",value:"MainValue"},{name:"Coordinates_MeasureType",value:!1},{name:"Coordinates_Unit",value:!0},{name:"Coordinates_ApproximatedValueSymbol",value:!1},{name:"Coordinates_Selection",value:!1},{name:"Coordinates_ComputationMode",value:!0},{name:"Line_Length_DisplayType",value:"MainValue"},{name:"Line_Length_MeasureType",value:!1},{name:"Line_Length_Unit",value:!0},{name:"Line_Length_ApproximatedValueSymbol",value:!1},{name:"Line_Length_Point1",value:!0},{name:"Line_Length_Point2",value:!0},{name:"Line_Length_Direction",value:!0},{name:"Line_Length_Selection",value:!1},{name:"Line_Length_ComputationMode",value:!1},{name:"Curve_Length_DisplayType",value:"MainValue"},{name:"Curve_Length_MeasureType",value:!0},{name:"Curve_Length_Unit",value:!0},{name:"Curve_Length_ApproximatedValueSymbol",value:!1},{name:"Curve_Length_Point1",value:!0},{name:"Curve_Length_Point2",value:!0},{name:"Curve_Length_Selection",value:!1},{name:"Curve_Length_ComputationMode",value:!1},{name:"Arc_Length_DisplayType",value:"MainValue"},{name:"Arc_Length_MeasureType",value:!0},{name:"Arc_Length_Unit",value:!0},{name:"Arc_Length_ApproximatedValueSymbol",value:!1},{name:"Arc_Length_Point1",value:!0},{name:"Arc_Length_Point2",value:!0},{name:"Arc_Length_Radius",value:!0},{name:"Arc_Length_Diameter",value:!1},{name:"Arc_Length_Selection",value:!1},{name:"Arc_Length_ComputationMode",value:!1},{name:"Cylinder_Length_DisplayType",value:"MainValue"},{name:"Cylinder_Length_MeasureType",value:!1},{name:"Cylinder_Length_Unit",value:!0},{name:"Cylinder_Length_ApproximatedValueSymbol",value:!1},{name:"Cylinder_Length_Point1",value:!1},{name:"Cylinder_Length_Point2",value:!1},{name:"Cylinder_Length_Direction",value:!1},{name:"Cylinder_Length_Radius",value:!1},{name:"Cylinder_Length_Diameter",value:!0},{name:"Cylinder_Length_Area",value:!1},{name:"Cylinder_Length_CenterOfGravity",value:!1},{name:"Cylinder_Length_Selection",value:!1},{name:"Cylinder_Length_ComputationMode",value:!1},{name:"Cone_Length_DisplayType",value:"MainValue"},{name:"Cone_Length_MeasureType",value:!1},{name:"Cone_Length_Unit",value:!0},{name:"Cone_Length_ApproximatedValueSymbol",value:!1},{name:"Cone_Length_Point1",value:!1},{name:"Cone_Length_Point2",value:!1},{name:"Cone_Length_Direction",value:!1},{name:"Cone_Length_Angle",value:!1},{name:"Cone_Length_HalfAngle",value:!0},{name:"Cone_Length_Apex",value:!1},{name:"Cone_Length_MinRadius",value:!1},{name:"Cone_Length_MaxRadius",value:!1},{name:"Cone_Length_MinDiameter",value:!0},{name:"Cone_Length_MaxDiameter",value:!0},{name:"Cone_Length_Area",value:!1},{name:"Cone_Length_CenterOfGravity",value:!1},{name:"Cone_Length_Selection",value:!1},{name:"Cone_Length_ComputationMode",value:!1},{name:"Distance_DisplayType",value:"MainValue"},{name:"Distance_MeasureType",value:!1},{name:"Distance_Unit",value:!0},{name:"Distance_ApproximatedValueSymbol",value:!1},{name:"Distance_Point1",value:!0},{name:"Distance_Point2",value:!0},{name:"Distance_Components",value:!1},{name:"Distance_Direction",value:!0},{name:"Distance_Selection1",value:!1},{name:"Distance_Selection2",value:!1},{name:"Distance_ComputationMode",value:!1},{name:"Min_Distance_DisplayType",value:"MainValue"},{name:"Min_Distance_MeasureType",value:!1},{name:"Min_Distance_Unit",value:!0},{name:"Min_Distance_ApproximatedValueSymbol",value:!1},{name:"Min_Distance_Point1",value:!0},{name:"Min_Distance_Point2",value:!0},{name:"Min_Distance_Components",value:!1},{name:"Min_Distance_Direction",value:!0},{name:"Min_Distance_Selection1",value:!1},{name:"Min_Distance_Selection2",value:!1},{name:"Min_Distance_ComputationMode",value:!1},{name:"Max_Distance_DisplayType",value:"MainValue"},{name:"Max_Distance_MeasureType",value:!0},{name:"Max_Distance_Unit",value:!0},{name:"Max_Distance_ApproximatedValueSymbol",value:!1},{name:"Max_Distance_Point1",value:!0},{name:"Max_Distance_Point2",value:!0},{name:"Max_Distance_Components",value:!1},{name:"Max_Distance_Direction",value:!0},{name:"Max_Distance_Selection1",value:!1},{name:"Max_Distance_Selection2",value:!1},{name:"Max_Distance_ComputationMode",value:!1},{name:"Local_Min_Distance_DisplayType",value:"MainValue"},{name:"Local_Min_Distance_MeasureType",value:!1},{name:"Local_Min_Distance_Unit",value:!0},{name:"Local_Min_Distance_ApproximatedValueSymbol",value:!1},{name:"Local_Min_Distance_Point1",value:!0},{name:"Local_Min_Distance_Point2",value:!0},{name:"Local_Min_Distance_Components",value:!1},{name:"Local_Min_Distance_Direction",value:!0},{name:"Local_Min_Distance_Selection1",value:!1},{name:"Local_Min_Distance_Selection2",value:!1},{name:"Local_Min_Distance_ComputationMode",value:!1},{name:"Local_Max_Distance_DisplayType",value:"MainValue"},{name:"Local_Max_Distance_MeasureType",value:!0},{name:"Local_Max_Distance_Unit",value:!0},{name:"Local_Max_Distance_ApproximatedValueSymbol",value:!1},{name:"Local_Max_Distance_Point1",value:!0},{name:"Local_Max_Distance_Point2",value:!0},{name:"Local_Max_Distance_Components",value:!1},{name:"Local_Max_Distance_Direction",value:!0},{name:"Local_Max_Distance_Selection1",value:!1},{name:"Local_Max_Distance_Selection2",value:!1},{name:"Local_Max_Distance_ComputationMode",value:!1},{name:"Angle_Btw2Selections_DisplayType",value:"MainValue"},{name:"Angle_Btw2Selections_MeasureType",value:!1},{name:"Angle_Btw2Selections_Unit",value:!0},{name:"Angle_Btw2Selections_ApproximatedValueSymbol",value:!1},{name:"Angle_Btw2Selections_Center",value:!0},{name:"Angle_Btw2Selections_Selection1",value:!1},{name:"Angle_Btw2Selections_Selection2",value:!1},{name:"Angle_Btw2Selections_ComputationMode",value:!1},{name:"Angle_By3Pts_DisplayType",value:"MainValue"},{name:"Angle_By3Pts_MeasureType",value:!1},{name:"Angle_By3Pts_Unit",value:!0},{name:"Angle_By3Pts_ApproximatedValueSymbol",value:!1},{name:"Angle_By3Pts_Point1",value:!1},{name:"Angle_By3Pts_Point2",value:!1},{name:"Angle_By3Pts_Center",value:!0},{name:"Angle_By3Pts_ComputationMode",value:!1},{name:"Cone_Angle_DisplayType",value:"MainValue"},{name:"Cone_Angle_MeasureType",value:!1},{name:"Cone_Angle_Unit",value:!0},{name:"Cone_Angle_ApproximatedValueSymbol",value:!1},{name:"Cone_Angle_Point1",value:!1},{name:"Cone_Angle_Point2",value:!1},{name:"Cone_Angle_Length",value:!0},{name:"Cone_Angle_Direction",value:!1},{name:"Cone_Angle_Apex",value:!1},{name:"Cone_Angle_MinimumRadius",value:!1},{name:"Cone_Angle_MaximumRadius",value:!1},{name:"Cone_Angle_MinimumDiameter",value:!0},{name:"Cone_Angle_MaximumDiameter",value:!0},{name:"Cone_Angle_Area",value:!1},{name:"Cone_Angle_CenterOfGravity",value:!1},{name:"Cone_Angle_Selection",value:!1},{name:"Cone_Angle_ComputationMode",value:!1},{name:"Half_Angle_DisplayType",value:"MainValue"},{name:"Half_Angle_MeasureType",value:!1},{name:"Half_Angle_Unit",value:!0},{name:"Half_Angle_ApproximatedValueSymbol",value:!1},{name:"Half_Angle_Point1",value:!1},{name:"Half_Angle_Point2",value:!1},{name:"Half_Angle_Length",value:!0},{name:"Half_Angle_Direction",value:!1},{name:"Half_Angle_Apex",value:!1},{name:"Half_Angle_MinimumRadius",value:!1},{name:"Half_Angle_MaximumRadius",value:!1},{name:"Half_Angle_MinimumDiameter",value:!0},{name:"Half_Angle_MaximumDiameter",value:!0},{name:"Half_Angle_Area",value:!1},{name:"Half_Angle_CenterOfGravity",value:!1},{name:"Half_Angle_Selection",value:!1},{name:"Half_Angle_ComputationMode",value:!1},{name:"Radius_DisplayType",value:"MainValue"},{name:"Radius_MeasureType",value:!1},{name:"Radius_Unit",value:!0},{name:"Radius_ApproximatedValueSymbol",value:!1},{name:"Radius_Center",value:!0},{name:"Radius_ArcLength",value:!0},{name:"Radius_CirclePerimeter",value:!1},{name:"Radius_Selection",value:!1},{name:"Radius_ComputationMode",value:!1},{name:"Cylinder_Radius_DisplayType",value:"MainValue"},{name:"Cylinder_Radius_MeasureType",value:!1},{name:"Cylinder_Radius_Unit",value:!0},{name:"Cylinder_Radius_ApproximatedValueSymbol",value:!1},{name:"Cylinder_Radius_Point1",value:!1},{name:"Cylinder_Radius_Point2",value:!1},{name:"Cylinder_Radius_Length",value:!0},{name:"Cylinder_Radius_Direction",value:!1},{name:"Cylinder_Radius_Area",value:!1},{name:"Cylinder_Radius_CenterOfGravity",value:!1},{name:"Cylinder_Radius_Selection",value:!1},{name:"Cylinder_Radius_ComputationMode",value:!1},{name:"Sphere_Radius_DisplayType",value:"MainValue"},{name:"Sphere_Radius_MeasureType",value:!1},{name:"Sphere_Radius_Unit",value:!0},{name:"Sphere_Radius_ApproximatedValueSymbol",value:!1},{name:"Sphere_Radius_Center",value:!0},{name:"Sphere_Radius_Area",value:!1},{name:"Sphere_Radius_Selection",value:!1},{name:"Sphere_Radius_ComputationMode",value:!1},{name:"Min_Radius_DisplayType",value:"MainValue"},{name:"Min_Radius_MeasureType",value:!1},{name:"Min_Radius_Unit",value:!0},{name:"Min_Radius_ApproximatedValueSymbol",value:!1},{name:"Min_Radius_Point1",value:!1},{name:"Min_Radius_Point2",value:!1},{name:"Min_Radius_Length",value:!0},{name:"Min_Radius_Direction",value:!1},{name:"Min_Radius_Angle",value:!1},{name:"Min_Radius_HalfAngle",value:!0},{name:"Min_Radius_Apex",value:!1},{name:"Min_Radius_MaximumRadius",value:!0},{name:"Min_Radius_Area",value:!1},{name:"Min_Radius_CenterOfGravity",value:!1},{name:"Min_Radius_Selection",value:!1},{name:"Min_Radius_ComputationMode",value:!1},{name:"Max_Radius_DisplayType",value:"MainValue"},{name:"Max_Radius_MeasureType",value:!1},{name:"Max_Radius_Unit",value:!0},{name:"Max_Radius_ApproximatedValueSymbol",value:!1},{name:"Max_Radius_Point1",value:!1},{name:"Max_Radius_Point2",value:!1},{name:"Max_Radius_Length",value:!0},{name:"Max_Radius_Direction",value:!1},{name:"Max_Radius_Angle",value:!1},{name:"Max_Radius_HalfAngle",value:!0},{name:"Max_Radius_Apex",value:!1},{name:"Max_Radius_MinimumRadius",value:!0},{name:"Max_Radius_Area",value:!1},{name:"Max_Radius_CenterOfGravity",value:!1},{name:"Max_Radius_Selection",value:!1},{name:"Max_Radius_ComputationMode",value:!1},{name:"Radius_By3Pts_DisplayType",value:"MainValue"},{name:"Radius_By3Pts_MeasureType",value:!1},{name:"Radius_By3Pts_Unit",value:!0},{name:"Radius_By3Pts_ApproximatedValueSymbol",value:!1},{name:"Radius_By3Pts_Point1",value:!1},{name:"Radius_By3Pts_Point2",value:!1},{name:"Radius_By3Pts_Point3",value:!1},{name:"Radius_By3Pts_Center",value:!0},{name:"Radius_By3Pts_ComputationMode",value:!1},{name:"Diameter_DisplayType",value:"MainValue"},{name:"Diameter_MeasureType",value:!1},{name:"Diameter_Unit",value:!0},{name:"Diameter_ApproximatedValueSymbol",value:!1},{name:"Diameter_Center",value:!0},{name:"Diameter_ArcLength",value:!0},{name:"Diameter_CirclePerimeter",value:!1},{name:"Diameter_Selection",value:!1},{name:"Diameter_ComputationMode",value:!1},{name:"Cylinder_Diameter_DisplayType",value:"MainValue"},{name:"Cylinder_Diameter_MeasureType",value:!1},{name:"Cylinder_Diameter_Unit",value:!0},{name:"Cylinder_Diameter_ApproximatedValueSymbol",value:!1},{name:"Cylinder_Diameter_Point1",value:!1},{name:"Cylinder_Diameter_Point2",value:!1},{name:"Cylinder_Diameter_Length",value:!0},{name:"Cylinder_Diameter_Direction",value:!1},{name:"Cylinder_Diameter_Area",value:!1},{name:"Cylinder_Diameter_CenterOfGravity",value:!1},{name:"Cylinder_Diameter_Selection",value:!1},{name:"Cylinder_Diameter_ComputationMode",value:!1},{name:"Sphere_Diameter_DisplayType",value:"MainValue"},{name:"Sphere_Diameter_MeasureType",value:!1},{name:"Sphere_Diameter_Unit",value:!0},{name:"Sphere_Diameter_ApproximatedValueSymbol",value:!1},{name:"Sphere_Diameter_Center",value:!0},{name:"Sphere_Diameter_Area",value:!1},{name:"Sphere_Diameter_Selection",value:!1},{name:"Sphere_Diameter_ComputationMode",value:!1},{name:"Min_Diameter_DisplayType",value:"MainValue"},{name:"Min_Diameter_MeasureType",value:!1},{name:"Min_Diameter_Unit",value:!0},{name:"Min_Diameter_ApproximatedValueSymbol",value:!1},{name:"Min_Diameter_Point1",value:!1},{name:"Min_Diameter_Point2",value:!1},{name:"Min_Diameter_Length",value:!0},{name:"Min_Diameter_Direction",value:!1},{name:"Min_Diameter_Angle",value:!1},{name:"Min_Diameter_HalfAngle",value:!0},{name:"Min_Diameter_Apex",value:!1},{name:"Min_Diameter_MaximumRadius",value:!0},{name:"Min_Diameter_Area",value:!1},{name:"Min_Diameter_CenterOfGravity",value:!1},{name:"Min_Diameter_Selection",value:!1},{name:"Min_Diameter_ComputationMode",value:!1},{name:"Max_Diameter_DisplayType",value:"MainValue"},{name:"Max_Diameter_MeasureType",value:!1},{name:"Max_Diameter_Unit",value:!0},{name:"Max_Diameter_ApproximatedValueSymbol",value:!1},{name:"Max_Diameter_Point1",value:!1},{name:"Max_Diameter_Point2",value:!1},{name:"Max_Diameter_Length",value:!0},{name:"Max_Diameter_Direction",value:!1},{name:"Max_Diameter_Angle",value:!1},{name:"Max_Diameter_HalfAngle",value:!0},{name:"Max_Diameter_Apex",value:!1},{name:"Max_Diameter_MinimumRadius",value:!0},{name:"Max_Diameter_Area",value:!1},{name:"Max_Diameter_CenterOfGravity",value:!1},{name:"Max_Diameter_Selection",value:!1},{name:"Max_Diameter_ComputationMode",value:!1},{name:"Diameter_By3Pts_DisplayType",value:"MainValue"},{name:"Diameter_By3Pts_MeasureType",value:!1},{name:"Diameter_By3Pts_Unit",value:!0},{name:"Diameter_By3Pts_ApproximatedValueSymbol",value:!1},{name:"Diameter_By3Pts_Point1",value:!1},{name:"Diameter_By3Pts_Point2",value:!1},{name:"Diameter_By3Pts_Point3",value:!1},{name:"Diameter_By3Pts_Center",value:!0},{name:"Diameter_By3Pts_ComputationMode",value:!1},{name:"Surface_Area_DisplayType",value:"MainValue"},{name:"Surface_Area_MeasureType",value:!0},{name:"Surface_Area_Unit",value:!0},{name:"Surface_Area_ApproximatedValueSymbol",value:!1},{name:"Surface_Area_CenterOfGravity",value:!0},{name:"Surface_Area_Selection",value:!1},{name:"Surface_Area_ComputationMode",value:!1},{name:"PlanarSurface_Area_DisplayType",value:"MainValue"},{name:"PlanarSurface_Area_MeasureType",value:!0},{name:"PlanarSurface_Area_Unit",value:!0},{name:"PlanarSurface_Area_ApproximatedValueSymbol",value:!1},{name:"PlanarSurface_Area_CenterOfGravity",value:!0},{name:"PlanarSurface_Area_Equation",value:!1},{name:"PlanarSurface_Area_Selection",value:!1},{name:"PlanarSurface_Area_ComputationMode",value:!1},{name:"Product_Area_DisplayType",value:"MainValue"},{name:"Product_Area_MeasureType",value:!0},{name:"Product_Area_Unit",value:!0},{name:"Product_Area_ApproximatedValueSymbol",value:!1},{name:"Product_Area_Volume",value:!0},{name:"Product_Area_CenterOfGravity",value:!0},{name:"Product_Area_Selection",value:!1},{name:"Product_Area_ComputationMode",value:!1},{name:"Volume_DisplayType",value:"MainValue"},{name:"Volume_MeasureType",value:!0},{name:"Volume_Unit",value:!0},{name:"Volume_ApproximatedValueSymbol",value:!1},{name:"Volume_Area",value:!0},{name:"Volume_CenterOfGravity",value:!0},{name:"Volume_Selection",value:!1},{name:"Volume_ComputationMode",value:!1},{name:"Thickness_DisplayType",value:"MainValue"},{name:"Thickness_MeasureType",value:!1},{name:"Thickness_Unit",value:!0},{name:"Thickness_ApproximatedValueSymbol",value:!1},{name:"Thickness_Point1",value:!0},{name:"Thickness_Point2",value:!0},{name:"Thickness_Direction",value:!0},{name:"Thickness_Selection",value:!1},{name:"Thickness_ComputationMode",value:!1},{name:"Measure_GraphicProperties_Fill",value:!0},{name:"Measure_GraphicProperties_FillColor",value:"#368ec4"},{name:"Measure_GraphicProperties_FillTransparency",value:0},{name:"Measure_GraphicProperties_LineBorder",value:!1},{name:"Measure_GraphicProperties_LineColor",value:"#3D3D3D"},{name:"Measure_GraphicProperties_LineThickness",value:"1"},{name:"Measure_GraphicProperties_LineType",value:"Solid"},{name:"Measure_GraphicProperties_TextColor",value:"#ffffff"},{name:"Measure_GraphicProperties_TextSize",value:.0035},{name:"Measure_GraphicProperties_TextBold",value:!1},{name:"Measure_GraphicProperties_TextItalic",value:!1},{name:"DMUMeasureRemovePreviousNonPersistent",value:!1}]},managePOISelection:function(e){var t=!1;if(e&&e.pathElement&&r.isAPOIPath(e.pathElement)){var a=w.getPOIInformationFromPathElement(e.pathElement);if(a&&a.position)if(e.position=a.position.clone(),this._measureThickness){A.remove({pathElement:e.pathElement}),L.remove({pathElement:e.pathElement});var i=k.getSightDirfor3DPoint(this._viewer,a.position.clone()),s=new d.Ray(a.position.clone(),i),n=this._viewer.castRay(s,this._viewer.getRootNode(),"primHybrid"),l=0;for(l=0;l<n.length;l++){var o=!1,u=n[l].pathElement.getElement(0);if(void 0!==u.name&&"DMUReviewBag"===u.name&&(o=!0),!o&&n[l].distance<.001){e.pathElement=n[l].pathElement,e.normal=n[l].normal,x.add({pathElement:e.pathElement}),t=!0;break}}}else t=!0}return this._bPOISelection=t,t}});return j})),define("DS/DMUMeasure/DMUCreateMeasureCmd",["DS/DMUMeasure/DMUMeasureBaseCmd"],(function(e){"use strict";return e.extend({init:function(e){this._parent(e,"exclusive",!0),!this._id&&e.ID&&(this._id=e.ID)},_initPref:function(){localStorage.getItem("DMUMeasureCylinderRadiusPreferences")||localStorage.setItem("DMUMeasureCylinderRadiusPreferences","DisplayDiameter"),localStorage.getItem("DMUMeasureSphereRadiusPreferences")||localStorage.setItem("DMUMeasureSphereRadiusPreferences","DisplayDiameter"),this._parent()},_beginExecute:function(){this._parent(),this._createFilter(),this._objAction||(this._filteredGeometries=this._updateFilter(this._filterUI)),("3dPlay"===this._measureCommandMode||this._measureThickness||"Geovia"===this._arguments[0].ID||"3dAuthoringPickPoint"===this._measureCommandMode||"ProgressiveVisuLoading"===this._measureCommandMode)&&this._filterUI.setVisibleBottomContentFlag(!1)}})})),define("DS/DMUMeasure/DMUCreateMeasure2DCmd",["DS/DMUMeasure/DMUMeasureBaseCmd"],(function(e){"use strict";return e.extend({init:function(e){this._measureOnGeometryType="2D",this._parent(e,"exclusive",!0)}})})),define("DS/DMUMeasure/DMUMeasureSpecializedItemCmd",["DS/DMUMeasure/DMUMeasureBaseCmd","DS/DMUMeasurable/DMUGeometryEnums","DS/DMUMeasurable/DMUMeasureEnums","i18n!DS/DMUMeasure/assets/nls/DMUMeasure"],(function(e,t,a,i){"use strict";return e.extend({init:function(e){this._resType=void 0,this._parent(e,"exclusive",!0)},_updateAuthorizedselectiontypes:function(e){var i={acceptedGeometries:[],viewedGeometries:[]};return"pickpoint"===e?(this._activeFilter="pointOnly",i.viewedGeometries.push(a.ViewedType.POINT)):"volume"===e?(this._activeFilter="productOnly",i.viewedGeometries.push(a.ViewedType.PRODUCT)):"length"===e&&(this._activeFilter="SeveralGeometries",i.acceptedGeometries.push(t.GeometryType.LINE),i.acceptedGeometries.push(t.GeometryType.CIRCLE),i.acceptedGeometries.push(t.GeometryType.CURVE),"2D"!==this._measureOnGeometryType&&(i.acceptedGeometries.push(t.GeometryType.CYLINDER),i.acceptedGeometries.push(t.GeometryType.CONE)),i.viewedGeometries.push(a.ViewedType.CIRCLE),i.viewedGeometries.push(a.ViewedType.CURVE)),"area"===e&&(this._activeFilter="SeveralGeometries",i.acceptedGeometries.push(t.GeometryType.CYLINDER),i.acceptedGeometries.push(t.GeometryType.CONE),i.acceptedGeometries.push(t.GeometryType.SPHERE),i.acceptedGeometries.push(t.GeometryType.PLANE),i.acceptedGeometries.push(t.GeometryType.SURFACE),i.viewedGeometries.push(a.ViewedType.SURFACE)),"dia/rad"===e&&(this._activeFilter="SeveralGeometries",i.acceptedGeometries.push(t.GeometryType.CIRCLE),"2D"!==this._measureOnGeometryType&&(i.acceptedGeometries.push(t.GeometryType.CYLINDER),i.acceptedGeometries.push(t.GeometryType.SPHERE)),i.viewedGeometries.push(a.ViewedType.CIRCLE)),i.viewedGeometries.length&&(this._pathElementAgentWithCSO.options.acceptedGeometries=i.acceptedGeometries,this._pathElementAgentWithCSO.options.viewedGeometries=i.viewedGeometries,this._pathElementAgentWithoutCSO.options.acceptedGeometries=i.acceptedGeometries,this._pathElementAgentWithoutCSO.options.viewedGeometries=i.viewedGeometries),i},_manageCSOElem:function(){this._parent({doNotConsiderPrd:"product"!==this._resType}),this._objAction||this.emptyHSO()},_beginExecute:function(){let e=this;this._repeatType="Item",e._parent(),e._resType&&(e._filteredGeometries=e._updateAuthorizedselectiontypes(e._resType))},getCumulativeMeaurePref:function(){let e;if(this._resType)switch(this._resType){case"length":e="DMUCumulativeLengthMeasurePref";break;case"product":e="DMUCumulativeVolumeMeasurePref";break;case"area":e="DMUCumulativeAreaMeasurePref"}return e||this._parent()},buildGraph:function(){var e=this;e.changeDefaultController(),e._beginExecute();var a=function(t){e.cleanNotify(),e.sendNotify("info",t||e._enableSpecialCumulativeMeasure&&"None"===e._repeatType&&e._bCumulativeMeas&&e._measurable.length>0?i.notifycumulativeitem:i.notifyinitial2D),e._createAssistantTools({bOK:!0,bKeeponlylast:!t,bMeasCumulative:e._enableSpecialCumulativeMeasure}),"volume"===e._resType&&e._createLevelSelector(!0),e._filterUI&&e._filterUI.setVisibleBottomContentFlag(!1),e._measure&&e._measure.manageSelectionHighlight&&e._measure.manageSelectionHighlight()},r=function(){this.cleanNotify(),this._measure&&this._measure._bPrevisualized&&(this.removeMeasureFromSession(this._measure),this._measure=this._lastMeasure,this._lastMeasure=null),this._filterUI&&this._filterUI.setVisibleBottomContentFlag(!1),this._removeAssistantTools()},s=e.createInitialState("initialState");e.setEnterStateAction(s,(function(){this.cleanNotify(),this._cleanLevelSelector(),e.sendNotify("info",i.notifyinitial2D),this._filterUI&&e._filterUI.setVisibleFlag(!1)}));var n=e.getFinalState(),l=e.createState("itemState");if(e.setEnterStateAction(l,(function(){this.addCumulativeKeyEvent(),e.cleanNotify(),a()})),this.setExitStateAction(l,r),e.addTransition({iEvent:e._pathElementAgentWithCSO,iInitialState:s,iFinalState:l,iAction:(a,i)=>{e._objAction?e.asyncReadPref(e,(()=>{let r=!1;i.forEach((a=>{if(e._enableSpecialCumulativeMeasure&&1===e._measurable.length){let t=e.getCumulativeMeaurePref();e._bCumulativeMeas=!1,""!==t&&(e._bCumulativeMeas="true"===localStorage.getItem(t)),e._bCumulativeMeas&&(e._repeatType="None")}("pickpoint"!==e._resType||e._pathElementAgentWithCSO._filter(a.pathElement,[t.GeometryType.POINT]))&&(r=!0,e._computeItemCallback(void 0,[a]))})),a(),r||e.publish({event:"failureObjectAction",data:null})})):e._computeItemCallback(a,i)}}),e.addTransition({iSender:e,iEvent:"failureObjectAction",iInitialState:l,iFinalState:s,iAction:t=>{e._objAction=!1,this.emptyCSO(),this.emptyHSO()}}),e.addTransition({iSender:e,iEvent:"failure",iInitialState:s,iFinalState:n,iAction:e._endExecute}),e.addTransition({iSender:e,iEvent:"OK",iInitialState:l,iFinalState:n,iAction:e._endExecute}),e.addTransition({iEvent:e._pathElementAgentWithoutCSO,iInitialState:l,iFinalState:l,iAction:e._computeItemCallback}),e.addEmptySelectionTransition(l,n,e._endExecute),this._enableSpecialCumulativeMeasure){var o=this.createState("cumulativeitemState");this.setEnterStateAction(o,(function(){"Item"===e._repeatType&&(e._repeatType="None"),a(!0)})),this.setExitStateAction(o,r),e.addTransition({iSender:e,iEvent:"noncumulative",iInitialState:o,iFinalState:l,iCondition:this._checkForMeasurable}),e.addTransition({iSender:e,iEvent:"cumulative",iInitialState:l,iFinalState:o}),e.addTransition({iEvent:this._pathElementAgentWithoutCSO,iInitialState:o,iFinalState:o,iAction:this._computeItemCallback}),e.addTransition({iSender:e,iEvent:"OK",iInitialState:o,iFinalState:n,iAction:this._endExecute}),e.addTransition({iSender:e,iEvent:"repeatitem",iInitialState:o,iFinalState:l}),e.addEmptySelectionTransition(o,n,this._endExecute)}e.addCallBackforMeasureDeleteAndSlideChange()},_endExecute:function(e){this._parent(e)}})})),define("DS/DMUMeasure/DMUMeasureCoordinatesCmd",["DS/DMUMeasure/DMUMeasureSpecializedItemCmd","i18n!DS/DMUMeasure/assets/nls/DMUMeasure"],(function(e){"use strict";return e.extend({init:function(e){this._parent(e)},_beginExecute:function(){let e=this;e._resType="pickpoint",e._measurePointOnly=!0,e._parent()}})})),define("DS/DMUMeasure/DMUMeasureDiameterRadiusCmd",["DS/DMUMeasure/DMUMeasureSpecializedItemCmd","i18n!DS/DMUMeasure/assets/nls/DMUMeasure"],(function(e){"use strict";return e.extend({init:function(e){this.MeasureDiaRadSpeacialMeasurePrefName="DMUMeasureArcRadiusPreferences",localStorage.getItem("DMUMeasureArcRadiusPreferences")||localStorage.setItem("DMUMeasureArcRadiusPreferences","DisplayDiameter"),this._parent(e)},_beginExecute:function(){let e=this;e._resType="dia/rad",e._measurePointOnly=!0,e._parent()}})})),define("DS/DMUMeasure/DMUMeasureAreaCmd",["DS/DMUMeasure/DMUMeasureSpecializedItemCmd"],(function(e){"use strict";return e.extend({init:function(e){this._parent(e)},_beginExecute:function(){let e=this;e._resType="area",e._enableSpecialCumulativeMeasure=!0,e._parent()}})})),define("DS/DMUMeasure/DMUMeasureVolumeCmd",["DS/DMUMeasure/DMUMeasureSpecializedItemCmd"],(function(e){"use strict";return e.extend({init:function(e){this.cumulativeMeasurePrefName="DMUCumulativeSpecialVolumeMeasure",this._parent(e)},_beginExecute:function(){let e=this;e._resType="volume",e._enableSpecialCumulativeMeasure=!0,e._parent()}})})),define("DS/DMUMeasure/DMUMeasureLengthCmd",["DS/DMUMeasure/DMUMeasureSpecializedItemCmd","DS/DMUMeasurable/DMUMeasureEnums"],(function(e,t){"use strict";return e.extend({init:function(e){this._parent(e)},_beginExecute:function(){let e=this;e._resType="length",e._enableSpecialCumulativeMeasure=!0,e._parent()},getResultType:function(){return t.ResultType.LINE}})})),define("DS/DMUMeasure/DMUMeasureSpecializedBetweenCmd",["DS/DMUMeasure/DMUMeasureBaseCmd","DS/DMUMeasurable/DMUGeometryEnums","DS/DMUMeasurable/DMUMeasureEnums","i18n!DS/DMUMeasure/assets/nls/DMUMeasure"],(function(e,t,a,i){"use strict";return e.extend({init:function(e){this._resType=void 0,this._parent(e,"exclusive",!0)},_updateAuthorizedselectiontypes:function(e){var i={acceptedGeometries:[],viewedGeometries:[]};return"angle"===e&&(this._activeFilter="SeveralGeometries",i.acceptedGeometries.push(t.GeometryType.LINE),"2D"!==this._measureOnGeometryType&&(i.acceptedGeometries.push(t.GeometryType.PLANE),i.acceptedGeometries.push(t.GeometryType.CYLINDER),i.acceptedGeometries.push(t.GeometryType.CONE)),i.viewedGeometries.push(a.ViewedType.CURVE),"2D"!==this._measureOnGeometryType&&i.viewedGeometries.push(a.ViewedType.INFPLANE)),i.viewedGeometries.length&&(this._pathElementAgentWithCSO.options.acceptedGeometries=i.acceptedGeometries,this._pathElementAgentWithCSO.options.viewedGeometries=i.viewedGeometries,this._pathElementAgentWithoutCSO.options.acceptedGeometries=i.acceptedGeometries,this._pathElementAgentWithoutCSO.options.viewedGeometries=i.viewedGeometries),i},_beginExecute:function(){let e=this;e._repeatType=e._repeatType?e._repeatType:"Multiple",e._parent(),"2D"!==this._measureOnGeometryType&&("angle"===e._resType?e._filteredGeometries=e._updateAuthorizedselectiontypes(e._resType):(e._createFilter(),e._filteredGeometries=e._updateFilter(e._filterUI),"3dPlay"===this._measureCommandMode&&this._filterUI.setVisibleFlag(!1)))},buildGraph:function(){var e=this;e.changeDefaultController(),e._beginExecute();var t=this.createInitialState("initialState");e.setEnterStateAction(t,(()=>{this.cleanNotify(),this._cleanLevelSelector(),e.sendNotify("info",i.notifyrepeatbtwnmultimeasInit)}));var a=this.createState("firstSelState");this.setEnterStateAction(a,(function(){e._measurable&&e._measurable.length?e._enterItemCallback():e._enterInitialCallback()})),this.setExitStateAction(a,e._exitItemCallback);var r=e.getFinalState(),s=this.createState("secondSelState");this.setEnterStateAction(s,e._enterItemCallback),this.setExitStateAction(s,e._exitItemCallback);var n=this._pathElementAgentWithCSO.cso._items.length;this.addTransition({iEvent:this._pathElementAgentWithCSO,iInitialState:t,iFinalState:0===n||n%2?s:a,iAction:(t,a)=>{e._objAction?e.asyncReadPref(e,(()=>{n<2?this._computeItemCallback(t,a):this._computeBetweenCallback(t,a)})):e._computeItemCallback(t,a)}}),e.addTransition({iEvent:e._pathElementAgentWithCSO,iInitialState:a,iFinalState:s,iAction:e._computeItemCallback}),e.addTransition({iEvent:this._pathElementAgentWithoutCSO,iInitialState:s,iFinalState:a,iAction:this._computeBetweenCallback}),e.addTransition({iSender:e,iEvent:"failure",iInitialState:a,iFinalState:r,iAction:e._endExecute}),e.addTransition({iSender:e,iEvent:"failure",iInitialState:s,iFinalState:r,iAction:e._endExecute}),e.addTransition({iSender:e,iEvent:"OK",iInitialState:a,iFinalState:r,iAction:e._endExecute}),e.addTransition({iSender:e,iEvent:"OK",iInitialState:s,iFinalState:r,iAction:e._endExecute});this.addEmptySelectionTransition(a,r,(function(t){t&&e._measurable&&e._measurable.length&&(this._endExecute(),t())})),this.addEmptySelectionTransition(s,r,(function(t){t&&(e._measure||e._createdMeasures&&e._createdMeasures.length)&&(this._endExecute(),t())})),e.addCallBackforMeasureDeleteAndSlideChange()}})})),define("DS/DMUMeasure/DMUMeasureDistanceCmd",["DS/DMUMeasure/DMUMeasureSpecializedBetweenCmd","i18n!DS/DMUMeasure/assets/nls/DMUMeasure"],(function(e){"use strict";return e.extend({init:function(e){this._parent(e)},_beginExecute:function(){this._resType="distance",this._parent()}})})),define("DS/DMUMeasure/DMUMeasureChainStackCmd",["DS/DMUMeasure/DMUMeasureSpecializedBetweenCmd","i18n!DS/DMUMeasure/assets/nls/DMUMeasure"],(function(e){"use strict";return e.extend({init:function(e){this._parent(e),this._repeatType=!this._repeatType||"Chain"!==this._repeatType&&"Fan"!==this._repeatType?"Chain":this._repeatType},_beginExecute:function(){this._resType="Chain_Stack",this._parent()},buildGraph:function(){var e=this;e.changeDefaultController(),e._beginExecute();var t=this.createInitialState("initState");this.setEnterStateAction(t,e._enterInitialCallback);var a=this.createState("firstSelDoneState"),i=this.createState("secondSelDoneState");this.setEnterStateAction(i,e._enterItemCallback),this.setExitStateAction(i,e._exitItemCallback);var r=e.getFinalState();this._pathElementAgentWithCSO.cso._items.length>1&&e._objAction?e.addTransition({iEvent:e._pathElementAgentWithCSO,iInitialState:t,iFinalState:i,iAction:(t,a)=>{e._objAction?e.asyncReadPref(e,(()=>{this._computeBetweenCallback(t,a)})):e._computeBetweenCallback(t,a)}}):e.addTransition({iEvent:e._pathElementAgentWithCSO,iInitialState:t,iFinalState:a,iAction:(t,a)=>{e._objAction?e.asyncReadPref(e,(()=>{this._computeItemCallback(t,a)})):e._computeItemCallback(t,a)}}),e.addTransition({iEvent:e._pathElementAgentWithoutCSO,iInitialState:a,iFinalState:i,iAction:e._computeBetweenCallback}),e.addTransition({iEvent:this._pathElementAgentWithoutCSO,iInitialState:i,iFinalState:i,iAction:this._computeBetweenCallback}),e.addTransition({iSender:e,iEvent:"failure",iInitialState:a,iFinalState:r,iAction:e._endExecute}),e.addTransition({iSender:e,iEvent:"failure",iInitialState:i,iFinalState:r,iAction:e._endExecute}),e.addTransition({iSender:e,iEvent:"OK",iInitialState:i,iFinalState:r,iAction:e._endExecute}),this.addEmptySelectionTransition(i,r,this._endExecute),e.addCallBackforMeasureDeleteAndSlideChange()},_preVisualizeMeasure:function(){},_IsItemMeasureReq:function(){return!1}})})),define("DS/DMUMeasure/DMUMeasureAngleCmd",["DS/DMUMeasure/DMUMeasureSpecializedBetweenCmd","DS/DMUMeasurable/DMUMeasurable","DS/DMUMeasurable/DMUGeometryEnums","DS/DMUMeasurable/DMUMeasureEnums","DS/DMUMeasurable/DMUToolsMeasure","DS/Selection/CSOManager"],(function(e,t,a,i,r,s){"use strict";return e.extend({init:function(e){this._parent(e)},_manageCSOElem:function(){this._parent({doNotConsiderPrd:!0});var e=s.get().concat([]);let a,i,n,l,o=e.length;if(!(o<2))if(2===o)n=e[0].pathElement,l=e[1].pathElement,a=new t({primitive:n.getLastElement().sgNode,pathElement:n}),i=new t({primitive:l.getLastElement().sgNode,pathElement:l}),r.isMeasurableParallel(a,i)&&s.remove(e[1]);else{let u=0,m=1,c=o-2;for(;u<c;){for(n=e[u].pathElement,a=new t({primitive:n.getLastElement().sgNode,pathElement:n}),m=u+1;m<o&&(l=e[m].pathElement,i=new t({primitive:l.getLastElement().sgNode,pathElement:l}),r.isMeasurableParallel(a,i));m++)s.remove(e[m]);u=m+1}}},_beginExecute:function(){this._resType="angle",this._parent()},_isItMeasurable:function(e){if(!e)return;let a,i,s=this._parent(e);if(s&&this._measurable&&1===this._measurable.length&&e&&e.getLastElement){let n=e.getLastElement().sgNode;n&&(a=this._measurable[0],i=new t({primitive:n,pathElement:e}),s=!r.isMeasurableParallel(a,i))}return s},getResultTypeForPreVisu:function(e){return e===a.GeometryType.CYLINDER||e===a.GeometryType.CONE?i.ResultType.AXIS:i.ResultType.PLANE}})}));