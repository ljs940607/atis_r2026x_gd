define("DS/XCADLoader/XCADLoader",["UWA/Promise","DS/Visualization/Node3D","DS/Visualization/SceneGraphFactory","DS/XCADInputDocuments/XCADRepresentation","DS/XCADLoader/XCADGeomLoader","DS/Mesh/ThreeJS_Base","DS/ZipJS/zip-fs","DS/ZipJS2/LoaderInflate","DS/Visualization/Utils","DS/VisuDataAccess/ProxyAbstraction","DS/XCADLoader/XCADError","DS/XCADLoader/XCADSingleton","DS/XCADLoader/XCADZipUtils"],(function(e,t,I,E,C,o,n,r,T,i,a,l,s){"use strict";const d=["IFCBUILDING","IFCBUILDINGSTOREY","IFCEXTERNALSPATIALELEMENT","IFCEXTERNALSPATIALSTRUCTUREELEMENT","IFCSITE","IFCSPACE","IFCSPATIALELEMENT","IFCSPATIALSTRUCTUREELEMENT","IFCSPATIALZONE"],F=["IFCBEAM","IFCBEAMSTANDARDCASE","IFCBUILDINGELEMENT","IFCBUILDINGELEMENTPROXY","IFCCHIMNEY","IFCCOLUMN","IFCCOLUMNSTANDARDCASE","IFCCOVERING","IFCCURTAINWALL","IFCDOOR","IFCDOORSTANDARDCASE","IFCFOOTING","IFCMEMBER","IFCMEMBERSTANDARDCASE","IFCPILE","IFCPLATE","IFCPLATESTANDARDCASE","IFCRAILING","IFCRAMP","IFCRAMPFLIGHT","IFCROOF","IFCSHADINGDEVICE","IFCSLAB","IFCSLABELEMENTEDCASE","IFCSLABSTANDARDCASE","IFCSTAIR","IFCSTAIRFLIGHT","IFCWALL","IFCWALLELEMENTEDCASE","IFCWALLSTANDARDCASE","IFCWINDOW","IFCWINDOWSTANDARDCASE"],R=["IFCAUDIOVISUALAPPLIANCE","IFCCABLEFITTING","IFCCABLESEGMENT","IFCCOMMUNICATIONSAPPLIANCE","IFCELECTRICAPPLIANCE","IFCELECTRICDISTRIBUTIONBOARD","IFCELECTRICFLOWSTORAGEDEVICE","IFCELECTRICGENERATOR","IFCELECTRICMOTOR","IFCELECTRICTIMECONTROL","IFCJUNCTIONBOX","IFCLAMP","IFCLIGHTFIXTURE","IFCMOTORCONNECTION","IFCOUTLET","IFCPROTECTIVEDEVICE","IFCPROTECTIVEDEVICETRIPPINGUNIT","IFCSOLARDEVICE","IFCSWITCHINGDEVICE","IFCTRANSFORMER"],A=["IFCAIRTERMINAL","IFCAIRTERMINALBOX","IFCAIRTOAIRHEATRECOVERY","IFCBOILER","IFCBURNER","IFCCABLECARRIERFITTING","IFCCABLECARRIERSEGMENT","IFCCHILLER","IFCCOIL","IFCCOMPRESSOR","IFCCONDENSER","IFCCOOLEDBEAM","IFCCOOLINGTOWER","IFCDAMPER","IFCDUCTFITTING","IFCDUCTSEGMENT","IFCDUCTSILENCER","IFCENGINE","IFCEVAPORATIVECOOLER","IFCEVAPORATOR","IFCFAN","IFCFILTER","IFCFLOWMETER","IFCHEATEXCHANGER","IFCHUMIDIFIER","IFCMEDICALDEVICE","IFCPIPEFITTING","IFCPIPESEGMENT","IFCPUMP","IFCSPACEHEATER","IFCTANK","IFCTUBEBUNDLE","IFCUNITARYEQUIPMENT","IFCVALVE","IFCVIBRATIONISOLATOR"],N=["IFCACTUATOR","IFCALARM","IFCALIGNMENT","IFCANNOTATION","IFCBUILDINGELEMENTPART","IFCCIVILELEMENT","IFCCONTROLLER","IFCDISCRETEACCESSORY","IFCDISTRIBUTIONCHAMBERELEMENT","IFCDISTRIBUTIONCONTROLELEMENT","IFCDISTRIBUTIONELEMENT","IFCDISTRIBUTIONFLOWELEMENT","IFCELEMENT","IFCELEMENTASSEMBLY","IFCELEMENTCOMPONENT","IFCENERGYCONVERSIONDEVICE","IFCFASTENER","IFCFEATUREELEMENT","IFCFEATUREELEMENTADDITION","IFCFEATUREELEMENTSUBTRACTION","IFCFIRESUPPRESSIONTERMINAL","IFCFLOWCONTROLLER","IFCFLOWFITTING","IFCFLOWINSTRUMENT","IFCFLOWMOVINGDEVICE","IFCFLOWSEGMENT","IFCFLOWSTORAGEDEVICE","IFCFLOWTERMINAL","IFCFLOWTREATMENTDEVICE","IFCFURNISHINGELEMENT","IFCFURNITURE","IFCGEOGRAPHICELEMENT","IFCGRID","IFCINTERCEPTOR","IFCLINEARPOSITIONINGELEMENT","IFCMECHANICALFASTENER","IFCOPENINGELEMENT","IFCOPENINGSTANDARDCASE","IFCPORT","IFCPOSITIONINGELEMENT","IFCPROJECTIONELEMENT","IFCPROXY","IFCREFERENT","IFCREINFORCINGBAR","IFCREINFORCINGELEMENT","IFCREINFORCINGMESH","IFCSANITARYTERMINAL","IFCSENSOR","IFCSTACKTERMINAL","IFCSTRUCTURALACTION","IFCSTRUCTURALACTIVITY","IFCSTRUCTURALCONNECTION","IFCSTRUCTURALCURVEACTION","IFCSTRUCTURALCURVECONNECTION","IFCSTRUCTURALCURVEMEMBER","IFCSTRUCTURALCURVEMEMBERVARYING","IFCSTRUCTURALCURVEREACTION","IFCSTRUCTURALITEM","IFCSTRUCTURALLINEARACTION","IFCSTRUCTURALMEMBER","IFCSTRUCTURALPLANARACTION","IFCSTRUCTURALPOINTACTION","IFCSTRUCTURALPOINTCONNECTION","IFCSTRUCTURALPOINTREACTION","IFCSTRUCTURALREACTION","IFCSTRUCTURALSURFACEACTION","IFCSTRUCTURALSURFACECONNECTION","IFCSTRUCTURALSURFACEMEMBER","IFCSTRUCTURALSURFACEMEMBERVARYING","IFCSTRUCTURALSURFACEREACTION","IFCSURFACEFEATURE","IFCSYSTEMFURNITUREELEMENT","IFCTENDON","IFCTENDONANCHOR","IFCTRANSPORTELEMENT","IFCUNITARYCONTROLELEMENT","IFCVIRTUALELEMENT","IFCVOIDINGFEATURE","IFCWASTETERMINAL"],L=["IFCBEAMTYPE","IFCBUILDINGELEMENTPROXYTYPE","IFCBUILDINGELEMENTTYPE","IFCCHIMNEYTYPE","IFCCOLUMNTYPE","IFCCOVERINGTYPE","IFCCURTAINWALLTYPE","IFCDOORTYPE","IFCFOOTINGTYPE","IFCMEMBERTYPE","IFCPILETYPE","IFCPLATETYPE","IFCRAILINGTYPE","IFCRAMPFLIGHTTYPE","IFCRAMPTYPE","IFCROOFTYPE","IFCSHADINGDEVICETYPE","IFCSLABTYPE","IFCSTAIRFLIGHTTYPE","IFCSTAIRTYPE","IFCWALLTYPE","IFCWINDOWTYPE"],c=["IFCAUDIOVISUALAPPLIANCETYPE","IFCCABLEFITTINGTYPE","IFCCABLESEGMENTTYPE","IFCCOMMUNICATIONSAPPLIANCETYPE","IFCELECTRICAPPLIANCETYPE","IFCELECTRICDISTRIBUTIONBOARDTYPE","IFCELECTRICFLOWSTORAGEDEVICETYPE","IFCELECTRICGENERATORTYPE","IFCELECTRICMOTORTYPE","IFCELECTRICTIMECONTROLTYPE","IFCJUNCTIONBOXTYPE","IFCLAMPTYPE","IFCLIGHTFIXTURETYPE","IFCMOTORCONNECTIONTYPE","IFCOUTLETTYPE","IFCPROTECTIVEDEVICETRIPPINGUNITTYPE","IFCPROTECTIVEDEVICETYPE","IFCSOLARDEVICETYPE","IFCSWITCHINGDEVICETYPE","IFCTRANSFORMERTYPE"],O=["IFCAIRTERMINALBOXTYPE","IFCAIRTERMINALTYPE","IFCAIRTOAIRHEATRECOVERYTYPE","IFCBOILERTYPE","IFCBURNERTYPE","IFCCABLECARRIERFITTINGTYPE","IFCCABLECARRIERSEGMENTTYPE","IFCCHILLERTYPE","IFCCOILTYPE","IFCCOMPRESSORTYPE","IFCCONDENSERTYPE","IFCCOOLEDBEAMTYPE","IFCCOOLINGTOWERTYPE","IFCDAMPERTYPE","IFCDUCTFITTINGTYPE","IFCDUCTSEGMENTTYPE","IFCDUCTSILENCERTYPE","IFCENGINETYPE","IFCEVAPORATIVECOOLERTYPE","IFCEVAPORATORTYPE","IFCFANTYPE","IFCFILTERTYPE","IFCFLOWMETERTYPE","IFCHEATEXCHANGERTYPE","IFCHUMIDIFIERTYPE","IFCMEDICALDEVICETYPE","IFCPIPEFITTINGTYPE","IFCPIPESEGMENTTYPE","IFCPUMPTYPE","IFCSPACEHEATERTYPE","IFCTANKTYPE","IFCTUBEBUNDLETYPE","IFCUNITARYEQUIPMENTTYPE","IFCVALVETYPE","IFCVIBRATIONISOLATORTYPE"];var P=0;return function(){var n,S=null,u=null,M=null,D=null,b=[],m=0,U=0;function v(e,t,I){var E=void 0,C={};let o=I.ifcEntities[t],n=o.substring(0,o.indexOf("("));if("IFCPROJECT"===n){E=v(e,I.assyProducts2[t].childrenList[0].productReferenceIdx.substring(1),I)}else{C.label=n;var r=[];I.ifcTokenizeArgs(o,r);let i=[];i.push(t);let a=!1;d.includes(n)&&(a=!0);let l={ImportObject:"true",name:0};l.name=I.assyProducts2[t].referenceName,"$"===l.name&&(l.name=""),C.grid=l,a&&(l.ConversionStructure="ForLifecycle");let s={LineType:"Entity",uid:i,inCoord:!0,nbPLMObject:0,nbTotalGeometry:0,nbGeometry:0,nbTotalObjects:1};null!=r[6]&&r[6].length>1&&(s.nbGeometry+=1,s.nbTotalGeometry+=1),a&&(s.inCoord=!1,s.LineType="Spatial",s.NLS_grid={ConversionStructure:"ForLifecycle"},s.nbPLMObject+=1,null!=r[6]&&r[6].length>1&&"IFCSITE"!==n&&(s.nbPLMObject-=1)),"IFCPROJECT"===n&&(s.nbTotalObjects-=1),C.data=s,e.push(C);let P=0;if(P=I.assyProducts2[t].childrenList.length,P>0){C.children=[];let e=[];for(var T=0;T<P;T++){let E,o=I.assyProducts2[t].childrenList[T].productReferenceIdx.substring(1),n=I.ifcEntities[o],r=n.substring(0,n.indexOf("("));if(a&&"IFCSITE"!==r&&"IFCBUILDING"!==r&&"IFCBUILDINGSTOREY"!==r&&"IFCSPACE"!==r){let n;if(F.includes(r))n="IfcBuildingElements";else if(R.includes(r))n="IfcElectricalDomain";else if(A.includes(r))n="IfcHvacDomain";else if(N.includes(r)){let e=I.productTypeMapping[o];n=L.includes(e)?"IfcBuildingElements":c.includes(e)?"IfcElectricalDomain":O.includes(e)?"IfcHvacDomain":"Other Discipline"}else n="Other Discipline";null==e[n]&&(e[n]=f(C.children,n,"Discipline"));let i=e[n].children;s.NLS_grid.ConversionStructure="ForCoordination",l.ConversionStructure="ForCoordination",null==e[n+"_"+r+"S"]&&(e[n+"_"+r+"S"]=f(i,r+"S","GroupOfEntities")),E=v(e[n+"_"+r+"S"].children,I.assyProducts2[t].childrenList[T].productReferenceIdx.substring(1),I),e[n].data.nbGeometry+=E.data.nbGeometry,e[n].data.nbTotalGeometry+=E.data.nbTotalGeometry,e[n].data.nbPLMObject+=E.data.nbPLMObject,e[n].data.nbTotalObjects+=E.data.nbTotalObjects,e[n].grid.nbPLMObject=e[n].data.nbPLMObject+" / "+e[n].data.nbTotalObjects,e[n].grid.nbGeometry=e[n].data.nbGeometry+" / "+e[n].data.nbTotalGeometry,e[n+"_"+r+"S"].data.nbGeometry+=E.data.nbGeometry,e[n+"_"+r+"S"].data.nbTotalGeometry+=E.data.nbTotalGeometry,e[n+"_"+r+"S"].data.nbPLMObject+=E.data.nbPLMObject,e[n+"_"+r+"S"].data.nbTotalObjects+=E.data.nbTotalObjects,e[n+"_"+r+"S"].grid.nbPLMObject=e[n+"_"+r+"S"].data.nbPLMObject+" / "+e[n+"_"+r+"S"].data.nbTotalObjects,e[n+"_"+r+"S"].grid.nbGeometry=e[n+"_"+r+"S"].data.nbGeometry+" / "+e[n+"_"+r+"S"].data.nbTotalGeometry}else E=v(C.children,I.assyProducts2[t].childrenList[T].productReferenceIdx.substring(1),I);C.data.nbGeometry+=E.data.nbGeometry,C.data.nbTotalGeometry+=E.data.nbTotalGeometry,C.data.nbPLMObject+=E.data.nbPLMObject,C.data.nbTotalObjects+=E.data.nbTotalObjects,C.grid.nbGeometry=s.nbGeometry+" / "+s.nbTotalGeometry,C.grid.nbPLMObject=s.nbPLMObject+" / "+s.nbTotalObjects}}else{s.AssociatedGeometry="0",s.nbGeometry=0,s.nbTotalGeometry=0;const e=o.split(",");null!=e[6]&&e[6].length>1&&(s.AssociatedGeometry="1",s.nbGeometry=1,s.nbTotalGeometry=1),a?(s.NLS_grid.ConversionStructure="ForCoordination",l.ConversionStructure="ForCoordination",0==s.nbGeometry?s.nbPLMObject=1:s.nbPLMObject=0,s.nbTotalObjects=1):(s.nbPLMObject=0,s.nbTotalObjects=1),l.nbGeometry=s.nbGeometry+" / "+s.nbTotalGeometry,l.nbPLMObject=s.nbPLMObject+" / "+s.nbTotalObjects}null==E&&(E=C)}return E}function f(e,t,I){var E={};E.label=t;E.grid={ImportObject:"true"};let C={LineType:I,inCoord:!0,nbPLMObject:0,nbTotalGeometry:0,nbGeometry:0,nbTotalObjects:0};E.data=C;return E.children=[],e.push(E),E}this.getProductStructure=async function(e,t,I){return this.ReadProductStructure=!0,this.load(e,void 0,void 0,void 0,void 0,I,void 0,void 0,void 0,void 0,t),e},this.getProductStructureAsJson=async function(e,t,I){this.ReadProductStructure=!0,this.load(e,void 0,void 0,void 0,void 0,I,void 0,void 0,void 0,void 0,t);var E={};return function(e){var t=[];e.columns=t;var I={},E={NLS_text:"IFCType"};I.data=E,I.dataIndex="tree",I.editableFlag=!1,I.text="IFC Structure",I.width="auto",t.push(I);var C={};E={NLS_text:"name"},C.data=E,C.dataIndex="name",C.editableFlag=!1,C.typeRepresentation="string",C.text="Name",C.width=120,t.push(C);var o={};E={NLS_text:"ImportObject"},o.data=E,o.dataIndex="ImportObject",o.editableFlag=!0,o.editionPolicy="EditionInPlace",o.typeRepresentation="boolean",o.text="Import",o.width=64,t.push(o);var n={};E={NLS_text:"ConversionStructure",possibleValues:["ForLifecycle","ForCoordination","ForDesign"],type:"enum"},n.data=E,n.dataIndex="ConversionStructure",n.editableFlag=!0,n.editionPolicy="EditionInPlace",n.typeRepresentation="ConversionStructure",n.text="Profile",n.width=144,t.push(n);var r={};E={NLS_text:"nbGeometry"},r.data=E,r.dataIndex="nbGeometry",r.editableFlag=!1,r.text="Geometries to Convert",r.width=184,t.push(r);var T={};E={NLS_text:"nbPLMObject",type:"runtime"},T.data=E,T.dataIndex="nbPLMObject",T.editableFlag=!1,T.text="Objects to Create",T.width=152,t.push(T)}(E),function(e){e.data={filterID:"TOFILL",formatUsage:"IFC"}}(E),function(e,t){let I=[];e.roots=I,null!=t.rootProducts2?t.rootProducts2.length>0&&v(I,t.rootProducts2[0].substring(1),t):t.rootProducts.length>0&&v(I,t.rootProducts[0].substring(1),t)}(E,e),JSON.stringify(E)},this.load=async function(d,F,R,A,N,L,c,O,v,f,G){if(S=null,u=null,M=null,D=null,null,"",b=[],D=L,1==this.ReadProductStructure){(p=d).forceRead=!0,p.noGeom=!0,await w(G)}else{F,n=F.substr(F.lastIndexOf(".")+1).toUpperCase(),S=R,u=A,M=N;var p=d,y=new o.MeshBasicMaterial({side:o.DoubleSide,transparent:!1}),Y=window.localStorage.getItem("XCAD_DebugMode");if(null!=G){if(1==d.zipped&&2==d.zipMethod&&(G=r.inflate(G)),null!=Y)var h=performance.now();if(await w(G),null!=Y){var g=performance.now();console.log("_processModel_"+P+" in "+(g-h)+" milliseconds."),window.localStorage.setItem("processModel_"+P,"_processModel in "+(g-h)+" milliseconds."),P++}}else if(1==d.zipped){var B=f.serverurl?f.serverurl:"";B+=f.filename?f.filename:"";var V=f.filename.substring(0,f.filename.lastIndexOf(".")),x=[];x.push(s.downloadFiles(B)),e.all(x).then((function(e){let t;console.log("download Zip archive done"),e&&(e.forEach((function(e){l.addData(e),null!=e[V]&&(t=e[V])})),null!=t&&w(t))}))}else{F.startsWith("blob")||(f.proxyurl=null);var _=new i;T.setProxyFromSpec(f,_);B=f.serverurl?f.serverurl:"";B+=f.filename?f.filename:"",_.executeGetHttpRequest(B,v,null,(function(e){if(null!=Y)var t=performance.now();if(w(e),null!=Y){var I=performance.now();console.log("_processModel in "+(I-t)+" milliseconds."),window.localStorage.setItem("processModel_"+P,"_processModel in "+(I-t)+" milliseconds."),P++}}))}}async function w(e){Date.now();var r=new a,T=await p.initialize(e);if(T instanceof a)return D&&D(T),void(u&&u({loaded:0,total:0}));var i=!1,l=void 0;if(1!=p.noGeom){var s=p.getRepresentation(E.XCAD_TESSELLATED_REPRESENTATION);if(void 0!==s)for(var d=(new C).load(s,u),R=0;R<d.length;R++){var A=(G=d[R]).primitive,N=G.transfo,L=G.descendants;if(0!=A.nbPrimitives||0==A.nbPrimitives&&d.length>1)if(void 0===l)(l=s.isIndexed&&!s.isIndexed()?I.createMeshNode(A,y):I.createMeshNode(A,y,0,"mono")).productType="Reference3D",null!=N&&l.setMatrix(N),m++;else{var O=void 0;O=s.isIndexed&&!s.isIndexed()?I.createMeshNode(A,y):I.createMeshNode(A,y,0,"mono"),null!=N&&O.setMatrix(N),l.addChild(O),j(L,O,s)}}else if(void 0!==(s=p.getRepresentation(E.XCAD_PRODUCT_REPRESENTATION)))for(var b=s.getRootProducts(),U=0;U<b.length;U++)0===(l=X(b[U],u,{},null)).children.length&&null==l.mesh3js&&(i=!0,console.error(F+" : "+n+" Root with no supported Geometry"),r.setError("XCADLoader/XCADLoader","error.EMPTY_ROOT",null),D&&D(r)),null!=c&&c.add(l);else i=!0,console.error(F+" : "+n+" file with no supported representation"),r.setError("XCADLoader/XCADLoader","error.NO_REP",null),D&&D(r);var v=p.getRepresentation(E.XCAD_TESSELLATED_ANNOTATION_REPRESENTATION);if(void 0!==v){if(0!=(d=(new C).load(v,u)).length){var f=new t("3DPlay_XCAD_Annotation");for(R=0;R<d.length;R++){var G;A=(G=d[R]).primitive,N=G.transfo;if(A.noz=!0,0!=A.nbPrimitives)for(var h=0;h<A.primitives.length;h++){1===A.primitives[h].attr.fill.color.r&&1===A.primitives[h].attr.fill.color.g&&1==A.primitives[h].attr.fill.color.b&&(A.primitives[h].attr.fill.color.r=0,A.primitives[h].attr.fill.color.g=0,A.primitives[h].attr.fill.color.b=0);var g=new o.LineBasicMaterial({color:A.primitives[h].attr.fill.color,dashType:A.primitives[h].attr.line.pattern,side:o.DoubleSide,force:!0});A.primitives[h].material=g}O=void 0;(O=v.isIndexed&&!v.isIndexed()?I.createMeshNode(A,y):I.createMeshNode(A,y,0,"mono")).productType="Annotation_Representation",O.setRenderLineMode(o.ShowAllRenderLineMode),null!=N&&O.setMatrix(N),f.add(O),null==Y&&f.setVisibility(!1)}null!=l&&null!=f&&l.addChild(f)}null==l&&(l=f)}}if(null!=s&&null!=s._associatedDocument&&0==s._associatedDocument.nbInstPart&&(r.setError("XCADLoader/XCADLoader","error.EMPTY_PROD",null),D&&D(r)),null!=Y){var B="Number of detected instanciate Parts / Number of loaded instanciate Parts: "+s._associatedDocument.nbInstPart+" / "+m;console.log(B),window.localStorage.setItem("processModel_"+P,B),P++,B=m===s._associatedDocument.nbInstPart?"Number of part is OK":"Number of part is KO",console.log(B),window.localStorage.setItem("processModel_"+P,B),P++}v=null,s=null,p.close(),p=null,S&&(l?(S(l),l=null):S(null)),i||M&&M()}function j(e,t,E){for(var C=0;C<e.length;C++){var o=e[C].primitive,n=e[C].transfo,r=e[C].descendants,T=void 0;T=E&&E.isIndexed&&!E.isIndexed()?I.createMeshNode(o,y):I.createMeshNode(o,y,0,"mono"),null!=n&&T.setMatrix(n),t.addChild(T),j(r,T)}}function X(e,o,r,T){var i,l=new a,s=e.getProductAttributes(),d=s[0],R=e.getInstanceList(),A=e.getFilePath();if(void 0!==A){console.log(F+" has an external reference: "+A);var N=s[1];(i=new t(T)).productType="Instance3D",i.name=T,void 0!==N&&(N.name=d,i.add(N)),b[d]=i,m++}else{if(""!==d){var L=b[d];if(null!=L&&"Mesh3D"===L.getNodeType())return m++,L.clone();var c=e.getDocument();if(void 0!==c){c.initialize("");var O=c.getRepresentation(E.XCAD_TESSELLATED_REPRESENTATION);if(void 0!==O)for(var P=(new C).load(O,null),S=(N=void 0,0);S<P.length;S++){var u=P[S],M=u.primitive,v=u.transfo,f=u.descendants;if(0!=M.nbPrimitives||0==M.nbPrimitives&&P.length>1)if(void 0===N)(N=O.isIndexed&&!O.isIndexed()?I.createMeshNode(M,y):I.createMeshNode(M,y,0,"mono")).name=d,N.productType="Reference3D",b[d]=N,null!=v&&N.setMatrix(v),m++;else{var G=void 0;G=O.isIndexed&&!O.isIndexed()?I.createMeshNode(M,y):I.createMeshNode(M,y,0,"mono"),null!=v&&G.setMatrix(v),N.addChild(G),j(f,G,O)}}else console.warn(F+" : "+n+" file with empty representation"),l.setError("XCADLoader/XCADLoader","error.NO_REP",null),D&&D(l);c.close()}}R.length>0?void 0===i&&((i=new t(d)).productType="Instance3D",void 0!==N&&i.add(N),b[d]=i):i=N,U++;var p=Object.keys(e._document.assyProducts).length;o&&o({loaded:U,total:p});for(S=0;S<R.length;S++){var Y=H(R[S]);void 0!==Y&&i.add(Y)}}return i}function H(e){var t=e.getTransformation(),I=new o.Matrix4;if(void 0!==t&&t instanceof o.Matrix4)I=t;else{var E=void 0,C=void 0;void 0!==t?(E=t[1],C=t[0]):(E=[0,0,0],(C=[])[0]=[1,0,0],C[1]=[0,1,0],C[2]=[0,0,1]),I.set(C[0][0],C[0][1],C[0][2],E[0],C[1][0],C[1][1],C[1][2],E[1],C[2][0],C[2][1],C[2][2],E[2],0,0,0,1)}var n={CoordSys:""},r=X(e.getReferenceProduct(),null,0,e.getInstanceAttributes()[0]);if(null!=n.CoordSys&&1==n.CoordSys.Coord&&null!=n.CoordSys.Origin&&0!=n.CoordSys.Origin.length){var T=parseFloat(n.CoordSys.Origin[0]),i=parseFloat(n.CoordSys.Origin[1]),a=parseFloat(n.CoordSys.Origin[2]),l=new o.Matrix3,s=new o.Vector3(n.CoordSys.RefDir[0],n.CoordSys.RefDir[1],n.CoordSys.RefDir[2]),d=new o.Vector3(n.CoordSys.Axis[0],n.CoordSys.Axis[1],n.CoordSys.Axis[2]),F=new o.Vector3;F.crossVectors(d,s),l.set(s.x,F.x,d.x,s.y,F.y,d.y,s.z,F.z,d.z);var R=new o.Matrix4;R.set(l.elements[0],l.elements[3],l.elements[6],T,l.elements[1],l.elements[4],l.elements[7],i,l.elements[2],l.elements[5],l.elements[8],a,0,0,0,1),I.multiply(R)}return void 0!==r&&r.setMatrix(I),r}}}}));