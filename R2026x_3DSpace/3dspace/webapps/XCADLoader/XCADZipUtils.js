define("DS/XCADLoader/XCADZipUtils",["UWA/Core","DS/ZipJS/zip-fs","UWA/Class/Promise"],(function(e,n,t){var o={},i=function(e){var n="";switch(e.toLowerCase()){case"stp":n="text/stp";break;case"cgr":n="text/plain";break;case"stpx":n="text/xml";break;default:n=""}return n};return o.download=function(n,o){return new t((function(t,i){e.is(n.url)&&e.is(n.fileExtension)||(console.log("Invalid / empty ticket for file download"),i());var r=new XMLHttpRequest,a=n.url;r.onload=function(e){if(4===r.readyState)if(200===r.status){var a=new Blob([this.response],{type:"application/"+n.fileExtension}),l=window.URL||window.webkitURL;t(!0===o?a:l.createObjectURL(a))}else i()},r.open("GET",a,!0),r.setRequestHeader("Cache-Control","no-cache"),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.responseType="arraybuffer",r.send()}))},o.importBlobURLToZip=function(o){return new t((function(t,i){if(e.is(o)){n.workerScriptsPath="scripts/ThreeDS/Visualization/zip-js/";var r=new n.fs.FS,a={serverurl:"",filename:o,proxyurl:"none"};r.importHttpContent(a,!1,(function(){t(r)}),(function(){console.log("Failure importing to Zip FS"),i()}))}else i()}))},o.unzip=function(e){var o,i;return o=e,i=function(e){return t.all(e.map((function(e){return function(e,o){return new t((function(t,o){var i=new n.BlobWriter;e.getData(i,(function(n){var o=new FileReader;o.onloadend=function(n){t({name:e.filename,content:this.result})},o.readAsDataURL(n)}))}))}(e)})))},new t((function(e,t){n.createReader(new n.BlobReader(o),(function(n){n.getEntries((function(n){e(i(n))}))}),(function(e){console.log(e),t(e)}))}))},o.importZipFileEntryToBlob=function(e){var n=e.fileName||"",o=e.fileExtension||"",r=i(o),a=t.deferred();try{e.zipFileEntry.getBlob(r,(function(e){var t=new FileReader;t.onload=function(e){a.resolve({name:n,blob:e.target.result})},t.readAsArrayBuffer(e)}))}catch(e){a.reject(e)}return a.promise},o.importZipFileEntryToText=function(e){var n=e.fileName||"",o=e.fileExtension||"",r=(i(o),t.deferred());try{e.zipFileEntry.getText((function(e){r.resolve({name:n,blob:e.currentTarget.result})}))}catch(e){r.reject(e)}return r.promise},o.downloadFiles=function(n){return new t((function(i,r){if(n.length>0){var a={fileExtension:"zip",url:n};o.download(a).then((function(n){o.importBlobURLToZip(n).then((function(n){if(e.is(n)){var a=n.entries;zipPromises=[];for(var l=0;l<a.length;l++)if(!0!==a[l].directory){for(var s="",c=a[l].parent;null!=c;)null!=c.name&&(s=s.length>0?c.name+"_"+s:c.name),c=c.parent;var f,u=a[l].name.split(".");f=s.length>0?s+"_"+u[0]:u[0];var p=u[1],d={fileName:f,fileExtension:p,zipFileEntry:a[l]};"cgr"===p.toLowerCase()?zipPromises.push(o.importZipFileEntryToBlob(d)):zipPromises.push(o.importZipFileEntryToText(d))}t.all(zipPromises).then((function(e){var n={};e.forEach((function(e){n[e.name]=e.blob})),i(n)}),(function(e){console.log("downloadRAEData - zipPromises",e),r(e)}))}else console.log("downloadRAEData - zipPromises NO DATA"),r("NO DATA");0==zipPromises.length&&(console.log("downloadRAEData - zipPromises NO DATA"),r("NO DATA"))}))}),r)}else console.log("empty file names"),r("empty file names")}))},o}));