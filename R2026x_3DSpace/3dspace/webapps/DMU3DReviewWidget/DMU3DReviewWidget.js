/*!  Copyright 2015 Dassault Systemes. All rights reserved. */
define("DS/DMU3DReviewWidget/DMU3DReviewWidgetOptions",["UWA/Core","UWA/Class","UWA/Class/Options","UWA/Utils"],(function(e,t,i,n){"use strict";return t.singleton(i,{init:function(){var t={};""!==window.location.search&&(e.extend(t,n.parseQuery(window.location.search)),t.widgetDomain&&e.extend(t,n.parseQuery(t.widgetDomain))),("debug_me"in t||window.debug)&&(t.debug=!0),("testWkb"in t||window.testWkb||window.widget&&window.widget.data&&window.widget.data.moduleUrl&&window.widget.data.moduleUrl.includes("testWkb"))&&(t.testWkb=!0),("resultFTAUI"in t||window.resultFTAUI)&&(t.resultFTAUI=!0),("pdfReview"in t||window.pdfReview)&&(t.pdfReview=!0),("testMbom"in t||window.testMbom)&&(t.testMbom=!0),this.setOptions(t)}})})),define("DS/DMU3DReviewWidget/DMU3DReviewWidgetDefaultCmdV2",["DS/DMU3DReviewController/DMU3DReviewController","DS/PADUtils/PADContext"],(function(e,t){"use strict";return class{constructor(){this.beginExecute=function(){var i=e.give3DReviewController({context:t.get()});i&&i.enableDMUContextualBar()},this.destroy=function(){var i=e.give3DReviewController({context:t.get()});i&&i.disableDMUContextualBar()}}}})),define("DS/DMU3DReviewWidget/ENOR3DWidgetMain",["DS/DMUBaseUI/DMUReviewDnDComponent","DS/PADUtils/PADSettingsMgt","DS/DMUMeasurable/DMUToolsSceneGraph","DS/CATWebUXComponents/DMUCommandsManager","DS/EditPropWidget/constants/ConstantsMapping","DS/CATWebUXComponents/DMUFrameWindow","DS/DMUReadPersistence/DMUWebServicesUtils","DS/DMUBaseExperience/DMUModelServices","DS/DMUBaseExperience/EXPImportServices","DS/DMUBaseExperience/EXPToolsContext","DS/DMUBaseUIControllers/DMUSlidesController","DS/DMUBaseUIControllers/DMUCommentsController"],(function(e,t,i,n,o,a,r,s,l,d,c,p){"use strict";var u,w,g,D={widget:null,widgetLink:null,viewer:null,viewerAttachment:null};let v,m=null,f=null,h="3D",S=!1;var b="DMU3DMarkupDefaultWkb";let y=window.location.search.includes("appId")?window.location.search.slice(window.location.search.indexOf("appId")+6):"NoID";function A(){D.viewer.getContentName({callbacks:{onComplete:function(e){D.widget.setTitle(e.contentName)},onFailure:function(){}}})}let C=function(e){let t=f.getSourceApp().getId();return"2D"===e||"Drawing"===e?"ENOR3D_AP_2D":"Document"===e||"Specification Report"===e?"ENOR3D_AP_Document":"Requirement"===e||"Requirement Specification"===e?"ENOR3D_AP_Req":"Workplan"===e?"ENOR3D_AP_Workplan":"FMEA"===e?"ENOR3D_AP_2DTable":"ITF"===e?"ENOR3D_AP_PIM":"MSR"===e?"ENOR3D_AP_MSR":"R2V"===e?"ENOR3D_AP_R2V":"R2V3D"===e?"ENOR3D_AP_R2V3D":"R2VFormats"===e?"R3DFormat_AP_R2V":"3DFormats"===e||"ITFFormats"===e?"R3DFormat_AP_3D":"MSRFormats"===e?"R3DFormat_AP_MSR":"DIFSheet"===e||"DIFLayout"===e||"2DFL"===e?"ENOR3D_AP_2DFL":"2DFormats"===e||"2DFLFormats"===e?"R3DFormat_AP_2D":"WorkplanFormats"===e?"R3DFormat_AP_Workplan":t};async function M(e){e&&(e.subscribe("onReviewContextModified",(async function(e){if("ITF"===e.type?D.widget.setValue("mkpSession",JSON.stringify({type:e.type})):"Data"===e.type&&D.widget.deleteValue("mkpSession"),S)return;"Data"===e.type&&(!function(){const e=i.getRoots(D.viewer);let t=!1;for(let n=0;n<e.length;n++){let o=i.getNodeType(e[n]),a=0,r=d.getParentType(o);if("R2V_Activity"===r||"R2V_Activity"===o||a===e.length-1)return"R2V_Activity"!==r&&"R2V_Activity"!==o||(t=!0),t;a++}}()?e.type="3D":e.type="R2V3D"),"RefreshAB"===e.type&&(e.type=v);let t=f.getSourceApp().getId(),o=C(e.type);if(h!==e.type&&"FMEA"!==e.type){if("3D"===h){let e=f.getComponent(WAfrStandardComponentKey.HandlerComponent);if(e.hasCheckHandler("AnnotationSwitchOnOff")&&e.isCheckExecutable("AnnotationSwitchOnOff")){let t=localStorage.getItem("CAT3DAnnotationSwitchOnOffCmd");await e.setCheckState({id:"AnnotationSwitchOnOff",state:!1}),localStorage.setItem("CAT3DAnnotationSwitchOnOffCmd",t)}}S=!0,await f.switchApp(t,o).then((()=>{S=!1,v=h,h=e.type,f.setContext("AppContext",h),n.refreshCommandsManager(f),e.onABReady()}))}else v=h,h=e.type,e.onABReady()})),await e.setActiveState(!0))}var R;function P(t){t.unsubscribe(w),w=null,A(),require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/PADUtils/PADCommandProxy"],(function(e,t){(R=e).renderDiv||R.initialize2(D.viewer.getFrameWindow().getViewerFrame(),t.appId(),D.widget.getValue("changeControlActivation")?"show":"hide","top-right",(function(){R.addEvent("onAuthoringCtxVisible",(function(e){e.showAuthoringContext&&D.widget.setValue("changeControlActivation",!0)}))}))})),require("DS/PADUtils/PADUtilsServices").isCloud()&&!window.__preventPrefPanel&&(D.widget.getValue(b)||D.widget.addPreference({name:b,type:"hidden"}));var i=function(){"1"===D.widget.getValue("widgetForODTReplay")&&(D.widgetViewer3DReview._viewer3DReview=t),D.widget.dispatchEvent("onWidgetAndAppReady","1"===D.widget.getValue("widgetForODTReplay")?[{pad3DViewer:D.viewer}]:void 0),async function(){if(u){var i=u.get3DReviewController({context:t});await M(i),t.getLandingPageComponent().appReady(i,(function(t,i){(i.data&&i.data.items||[]).forEach((function(e){("Drawing"===e.objectType||e.objectTaxonomies&&e.objectTaxonomies.indexOf("Drawing")>-1)&&delete e.path})),i.data&&i.data.items&&i.data&&i.data.items.length&&e.callSpecReportData(t,i,!0)}))}}()};require(["DS/DMU3DReviewController/DMU3DReviewController"],(function(e){u=e,setTimeout(i)})),D.viewerAttachment&&D.viewerAttachment(g),D.viewerAttachment=null,t.getFrameWindow().getContextualUIManager().activateContextualBarOnLeftClic()}function x(e){"string"==typeof e.reviewID&&D.widget.setValue("reviewIdInSession",JSON.stringify(e))}function U(){var e=window.document.getElementsByClassName("DMULoadingPanelInfoDiv"),t=window.document.getElementsByClassName("DMULoadingPanel");e.length&&(e[0].dsModel.off(),e[0].dsModel.destroy(),e=null),t.length&&t[0].destroy()}async function k(e){try{let t=await r.getParentTypes(e);return[e].concat(t)}catch{return[e]}}function E(){if(!D.viewer){var i=new Promise((function(e){require(["text!DS/DMU3DReviewWidget/assets/DMU3DReviewWidget.json"],(function(t){e([t])}))}));Promise.all([i]).then((function(i){var r=JSON.parse(i[0][0]);r.context="Default",require("DS/PADUtils/PADUtilsServices").isCloud()?(t.setSetting("mouseProfile",window.__mouseProfile),r.mouseProfile=window.__mouseProfile):(t.setSetting("mouseProfile","CATIA"),r.mouseProfile="CATIA");D.widget;let s=D.viewer=m;a.init(s,{executionContext:m.getExecutionContext()}),n.dmuSetExecutionContext(m.getExecutionContext()),n.dmuSetHandlerComponent(m.getExecutionContext()),r.mouseProfile&&s.getViewpoint().setDefaultController(!0,r.mouseProfile);var l=t.getSetting("propertiesFacet"),d=o.getMapping();d&&(d.physicssimulation.alwaysVisible=!1,l.push(d.physicssimulation)),s.setOption("propertiesFacet",l),s.subscribe({event:"onRootAdded"},A),s.subscribe({event:"onRootRemoved"},A),s.subscribe({event:"onRootAttached"},A),s.subscribe({event:"onRootDetached"},A),s.subscribe({event:"onContentNameModified"},A),e.initViewerDnd(s,k),localStorage.getItem("defaultSelectedTypeData")||localStorage.setItem("defaultSelectedTypeData","product"),t.setSetting("settypes",!0),"1"===D.widget.getValue("widgetForODTReplay")&&D.widget.dispatchEvent("onPAD3DViewerCreated",[{pad3DViewer:s}]),D.widgetInitDone&&D.widgetInitDone({appMainDiv:g,pad3DViewer:s}),P(s)}))}}async function V(){if(function(){var e=t.getSetting("enopad3dviewer_roles");let i=!0,n=require("DS/PADUtils/PADUtilsServices").isCloud(),o=require("DS/PADUtils/PADSession").isAuthoring();for(var a=0;a<e.length;a++)if("E19"===e[a].id&&(!e[a].platforms||e[a].platforms&&e[a].platforms.indexOf(require("DS/PADUtils/PADUtilsServices").getPlatformId())>-1)){i=!1;break}t.setSetting("enopad3dviewer_flexibleAssemblySupportActivated",i&&!n&&!o),t.setSetting("enopad3dviewer_staticMappingSupportActivated",!o)}(),D.viewer){var e=D.widget.getValue("reviewIdInSession");e=e?JSON.parse(e):void 0;var n,o,a=i.getRoots(D.viewer),r=!1,d=!1,c=[];for(let e=0;e<a.length;e++)if(""!==i.getNodeID(a[e])){if(n=i.getNodeID(a[e]),o=i.getNodeType(a[e]),(c=await k(o)).includes("Document")||c.includes("Specification Report")||c.includes("Requirement")||c.includes("Requirement Specification")){r=!0;break}c.includes("FailureModesEffectsAnalysis")&&(d=!0)}var p=[],w=require("DS/DMUBaseExperience/DMUContextManager").getReviewContext({context:D.viewer});if(w){let e=w.getTransientReviewBag().getDMUObjects();if(e&&e.length>0)for(let t=0;t<e.length;t++){let i=await s.getObjectDefinition(e[t]);p.push(i)}}var g=async function(){if(p&&p.length>0){var e=require("DS/DMUBaseUIControllers/DMUReviewContextInitializer");if(e){await e.createReviewContext({context:D.viewer});var t=require("DS/DMUBaseExperience/DMUContextManager").getReviewContext({context:D.viewer});if(t){let e=t.getTransientReviewBag(),i=new l({viewer:D.viewer.get3DViewer(),experience:e});i.importDataModel({Model:p},(function(){e.refreshNode(),i.postImport()}))}}}},v=function(e){x(e);let t=D.widget.getValue("reviewIdInSession"),i=JSON.parse(t).reviewID,o=JSON.parse(t).reviewType;n&&u&&u.give3DReviewController({context:D.viewer}).loadReview({objectId:i,objectType:o,fromRefresh:!0})},f=D.viewer.subscribe({event:"onRefreshCompleted"},(function(){if(D.viewer.unsubscribe(f),r)if(e)v(e);else{var i=t.getSetting("enopad3dviewer_lightNodeModel")?[{rootID:n,validForServerCall:!0,structure:{rootStats:{infos:{encoding:"UTF-8",kind:"InstRef",version:"1.1"},results:[{resourceid:n,"ds6w:type":o,"ds6w:globaltype":"ds6w:Part","ds6w:globalType":"ds6w:Part",boundingbox:{max:[-1,-1,-1],min:[1,1,1]}},{synthesis:{name:"ProgressiveExpand_FlatSynthesis",value:1}},{synthesis:{name:"ProgressiveExpand_OccSynthesis",value:1}},{synthesis:{name:"ProgressiveExpand_LeafSynthesis",value:1}}]},infos:{encoding:"UTF-8",kind:"InstRef",version:"1.1"},results:[{resourceid:n,"ds6w:type":o,"ds6w:globaltype":"ds6w:Part","ds6w:globalType":"ds6w:Part",nbchildren:"0"}]}}]:[{rootID:n,validForServerCall:!0,structure:{rootId:o,results:[{attributes:[{name:"did",value:n},{name:"physicalid",value:n},{name:"ds6w:type",value:o}]},{path:[n]}]}}];D.viewer.loadJSON({data:i}),g()}else if(c.includes("DesignSight")||c.includes("DIFSheet")||c.includes("DIFLayout"))e?setTimeout((()=>{v(e)})):(D.viewer.publish({event:"widgetReresh",data:{objectId:n,objectType:o}}),g());else if(c.includes("R2V_Activity")){if(!1===D.viewer.getSoIUsability()){D.viewer.toggleSOITimelinesUsability(!0);var a=D.viewer.subscribe({event:"onR2VLoaded"},(function(){D.viewer.getSoIUsability()&&D.viewer.toggleSOITimelinesUsability(!1),D.viewer.unsubscribe(a),a=null,e?v(e):g()}))}}else e?v(e):g()}));if(d){let t=require("DS/DMUBaseExperience/DMUContextManager");if(t){let i=t.giveEventsController({viewer:m.getViewer()}),a=m.getExecutionContext().getComponent("FMEALoaderForDesignValidation");a&&a.remove&&a.remove().then((()=>{i.fireEvent("onRootDataRemoved",{id:n}),t.removeReviewContext({viewer:m.getViewer()}),e?v(e):(D.viewer.publish({event:"widgetReresh",data:{objectId:n,objectType:o}}),g())}))}}else D.viewer.refresh()}}function I(){if(u){var e=u.give3DReviewController({context:D.viewer});e&&e.refreshContext()}}function W(){D.viewer&&(u&&u.unreference3DReviewController({context:D.viewer}),D.viewer.destroy()),D={widget:null,viewer:null,viewerAttachment:null},u=null}function F(e){D.viewer&&D.viewer.search({searchQuery:e})}return class{constructor(e){if(D.widget=e.widget,D.widgetInitDone=e.done,m=e.viewer?e.viewer:e.pad3DViewer,f=e.executionContext,e.data&&(D.data=e.data.wkb?e.data.wkb:e.data,D.controller=e.data.controller?e.data.controller:e.controller,y=e.data.appId?e.data.appId:e.appId),e.pad3DViewer){D.viewer=e.pad3DViewer,a.init(D.viewer,{executionContext:f});var i=require("DS/DMUBaseExperience/DMUContextManager").getReviewContext({context:e.pad3DViewer}),r=i?i.getReviewCtxInformation():null;r&&r.reviewId&&x(r.reviewId)}else e.viewerAttachment?(D.viewerAttachment=e.viewerAttachment,E()):(D.viewerAttachment=function(e){e&&D.widget.setBody(e)},D.widget.addEvent("onLoad",E)),D.widget.addEvent("endEdit",I),D.widget.addEvent("onRefresh",V),D.widget.addEvent("onDestroy",W),D.widget.addEvent("onSearch",F),"1"===D.widget.getValue("widgetForODTReplay")&&(D.widgetViewer3DReview=this),D.widget.addEvent("onDMUMarkupLoaded",x),D.widget.addEvent("onDMUMarkupLoadFailed",U),D.widget.setMetas({helpPath:"3DMarkup"===y?"DMU3DReviewWidget/assets/help":"DMUReviewWebApp/assets/help"});this.setUp=function(e){require("DS/ENOXInterWdgCom/LinkManager").updateLinkability({appIds:[],open:!0,uses:["ENXContent","ENXContentSync3D","ENXContentSync2D","ENXEnrich","ENXAuthoring2D","ENXAuthoring3D","ENXLandingPageSync"],implements:["ENXContent","ENXContentSync3D","ENXEnrich","ENXLandingPageSync"]});let i=D.viewer.getLandingPageComponent();i.setViewer(D.viewer),i.appReady(),t.setSetting("activateWidgetLink",!0),D.widget.addEvent("onRefresh",V),D.widget.addEvent("onSearch",F),D.widget.addEvent("onDMUMarkupLoaded",x),D.widget.setMetas({helpPath:"DMU3DReviewWidget/assets/help"}),e.sourceApp&&e.sourceApp.pad3DViewer!==D.viewer&&(D.viewer=e.sourceApp.pad3DViewer),a.init(D.viewer,{executionContext:m.getExecutionContext()}),n.dmuSetExecutionContext(m.getExecutionContext()),n.refreshCommandsManager(m.getExecutionContext());var r=t.getSetting("propertiesFacet"),s=o.getMapping();s&&s.physicssimulation&&s.physicssimulation.facet&&(r.find((function(e){return!(!e||!e.facet||e.facet.name!==s.physicssimulation.facet.name)}))||(s.physicssimulation.alwaysVisible=!1,r.push(s.physicssimulation))),D.viewer.setOption("propertiesFacet",r),D.viewer.getBIController().toggleBetweenStandaloneAndSlaveMode("DUAL"),D.viewer.getViewer().updateViewPanelUIConfiguration&&D.viewer.getViewer().updateViewPanelUIConfiguration({useShadingIllustration:!1,useOutline:!1}),A(),require(["DS/DMU3DReviewController/DMU3DReviewController"],(function(t){var i=(u=t).get3DReviewController({context:D.viewer});(async()=>{await M(i),e.sourceApp&&e.sourceApp.issues&&1===e.sourceApp.issues.length&&i.appInitFromTransition({issues:e.sourceApp.issues,onNoActionDone:function(){}})})()})),t.setSetting("dynamic_authorized_types",!0),e.done&&e.done()},this.dispose=function(){if(t.setSetting("dynamic_authorized_types",!1),D.widget.removeEvent("onRefresh",V),D.widget.removeEvent("onSearch",F),D.widget.removeEvent("endEdit",undefined),D.widget.removeEvent("onDMUMarkupLoaded",x),D.viewer){var i=t.getSetting("propertiesFacet"),n=o.getMapping();if(n){var r=i.findIndex((function(e){return!(!e||!e.facet||e.facet.name!==n.physicssimulation.facet.name)}));r>=0&&i.splice(r,1)}D.viewer.setOption("propertiesFacet",i)}u&&u.unreference3DReviewController({context:D.viewer,options:e}),u=null;let s=D.viewer&&D.viewer.getExecutionContext&&D.viewer.getExecutionContext()&&D.viewer.getExecutionContext().getTargetApp?D.viewer.getExecutionContext().getTargetApp():void 0;a.reset(s&&"ENX3DIR_AP"===s.getAfrAppId()?D.viewer:void 0)},this.onWillLeave=function(e){if(h="3D",v=void 0,D.viewer){var t=require("DS/DMUBaseExperience/DMUContextManager");if(t){const n=c.giveDMUSlidesController({context:D.viewer.getFrameWindow()});n&&n.setVisibleFlag(!1);const o=p.giveDMUCommentsController({context:D.viewer.getFrameWindow()});o&&o.setVisibleFlag(!1);var i=t.giveEventsController({viewer:D.viewer.getViewer()});i&&i.fireEvent("onLeavingR3DApp",{targetApp:e&&e.options?e.options.id:""})}}},this.onWillEnter=function(){if(D.viewer&&require("DS/DMUBaseExperience/DMUContextManager")){const e=c.giveDMUSlidesController({context:D.viewer.getFrameWindow()});e&&e.setVisibleFlag(!0);const t=p.giveDMUCommentsController({context:D.viewer.getFrameWindow()});t&&t.setVisibleFlag(!0)}}}}})),
/*!  Copyright 2015 Dassault Systemes. All rights reserved. */
define("DS/DMU3DReviewWidget/DMU3DReviewAppInit",["DS/WAfrContainer/App","DS/DMUBaseExperience/DMUContextManager","UWA/Core","DS/Controls/Loader","DS/DMUMeasurable/DMUToolsSceneGraph","i18n!DS/DMU3DReviewWidget/assets/nls/DMU3DReviewWidget"],(function(e,t,i,n,o,a){"use strict";var r,s,l,d;return e.extend({setUp:function(e){var t=this;if(window.widget.getValue("X3DContentId")&&!e.sourceApp){var o="",c=JSON.parse(window.widget.getValue("X3DContentId"));c.data&&c.data.items&&c.data.items[0]&&c.data.items[0].displayName&&(o=c.data.items[0].displayName);var p=i.createElement("div",{class:"DMULoadingPanel"}).inject(document.body);(d=new n({text:a.loadingMessage+" "+o}).inject(p)).on(),d.getContent().addClassName("DMULoadingPanelInfoDiv");var u=d.elements.label.getSize().width,w=d.elements.progressBar.getContent().getSize().width,g=d.elements.progressBar.getContent().getSize().height,D=u+w;p.setStyles({position:"absolute",bottom:"0",left:"0","z-index":"40000","background-color":"rgba(255,255,255,1",height:"100%",width:"100%"}),d.getContent().setStyles({position:"absolute",left:"calc(50% - "+D/2+"px)",top:"calc(50% - "+g/2+"px)"})}e.sourceApp?e.sourceApp.pad3DViewer?(l=e.sourceApp.pad3DViewer,this.pad3DViewer=e.sourceApp.pad3DViewer,this.appMainDiv=e.sourceApp.appMainDiv,new Promise((function(t){r?t():require(["DS/DMU3DReviewWidget/DMU3DReviewWidgetMain"],(function(i){r=new i({widget:window.widget,pad3DViewer:e.sourceApp.pad3DViewer,appMainDiv:e.sourceApp.appMainDiv}),t()}))})).then((function(){e.sourceApp&&!e.sourceApp.isDisposeCalled()&&e.sourceApp.dispose();var i=e.done;e.done=function(n){var o;t.appMainDiv||(t.appMainDiv=n.appMainDiv),e.done=i,"ENX3DIR_AP"===e.sourceApp.options.id&&((o=t).switchApp&&require(["DS/CATWebUXComponents/CATWebUXInfoFlag","DS/CATWebUXSlideShow/CATWebUXSlideShowController","i18n!DS/DMU3DReviewWidget/assets/nls/DMU3DReviewWidget"],(function(e,t,i){var n=new e({frameWindow:o.pad3DViewer.getFrameWindow(),viewer:o.pad3DViewer.getViewer(),dockingSide:"left"});n.display({label:i.backToIssue,style:"webUXStyle",fontIcon:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-move-to-start",onClickCB:function(){s(),s=null,o.switchApp("ENX3DIR_AP")}});var a,r=t.getSlideShowController({context:o.pad3DViewer.getFrameWindow(),id:"DMU3DMarkupSlideShow"});r&&(a=r.subscribe("onActiveStateModified",(function(e){n.setVisibleFlag(!e.state)}))),s=function(){n.clean();var e=t.giveSlideShowController({context:o.pad3DViewer.getFrameWindow(),id:"DMU3DMarkupSlideShow"});e&&e.unsubscribe(a)}}))),e.done()},r.setUp(e)}))):e.done():require(["DS/DMU3DReviewWidget/DMU3DReviewWidgetMain"],(function(i){r=new i({widget:window.widget,viewerAttachment:e.done,done:function(e){l=e.pad3DViewer,t.pad3DViewer=e.pad3DViewer,t.appMainDiv=e.appMainDiv}})}))},dispose:function(e){var i=t.getReviewContext({context:this.pad3DViewer});if(e&&i&&i.getCurrentSessionMarkup())e.preferredType="Markup";else if(e&&this.pad3DViewer.getApplicativeData().getLoadedItfData&&this.pad3DViewer.getApplicativeData().getLoadedItfData().data.length)e.preferredType="SIMItfSimulation";else if(e){var n=o.getRoots(l);let t=1===n.length?o.getNodeType(n[0]):null;"Requirement"!==t&&"Requirement Specification"!==t&&"DesignSight"!==t||(e.preferredType=t)}s&&s(),s=null,r&&r.dispose&&r.dispose(e);var a=window.document.getElementsByClassName("DMULoadingPanel");d&&(d.destroy(),d=null),a.length&&a[0].destroy(),this._parent(e)},onWillEnter:function(e){return r&&r.onWillEnter&&r.onWillEnter(e),require(["DS/DMUBaseExperience/EXPUtils","DS/DMU3DReviewController/DMU3DReviewController","DS/PADUtils/PADSettingsMgt"],(function(t,i,n){n.setSetting("enopad3dviewer_staticMappingSupportActivated",!0);var o=i.get3DReviewController({context:e.pad3DViewer});("string"==typeof e&&"X3DPLAW_AP"===e||e.options&&"X3DPLAW_AP"===e.options.id)&&o.setappTransition(!0),t._sendUsageProbe("appTransitionFrom",e.options.id,"resolved")})),this._parent(e)},onWillLeave:function(e){var i=o.getRoots(l),n=["Document","DIFLayout","DIFSheet"];["X3DPLAW_AP","ENOR3R_AP","ENOR3V_AP","ENOR3D_AP"].indexOf(e.options.id)<0&&n.push("DesignSight");for(var a=0;a<i.length;a++)if(-1!==n.indexOf(o.getNodeType(i[a]))){var s=o.getNodeID(i[a]);t.getReviewContext({context:this.pad3DViewer})&&t.getReviewContext({context:this.pad3DViewer}).getCurrentSessionMarkup()||l.removeRoots({pids:[s]})}return require(["DS/CATWebUXPreferences/CATWebUXPreferencesManager"],(function(i){var n=i.getPreferenceManager({context:l.getFrameWindow()});if(n&&("CATC3D_AP"===e.options.id||"CATA3I_AP"===e.options.id||"ENOI3D_AP"===e.options.id)){n.removeAllPreferences();let i=t.getReviewContext({context:l});"CATA3I_AP"===e.options.id&&i&&i.getCurrentSessionMarkup()&&i.getCurrentSessionMarkup().setActiveFlag(!1)}})),r&&r.onWillLeave&&r.onWillLeave(e),require(["DS/DMUBaseExperience/EXPUtils"],(function(t){t._sendUsageProbe("appTransitionTo",e.options.id,"resolved")})),this._parent(e)}})})),
/*!  Copyright 2015 Dassault Systemes. All rights reserved. */
define("DS/DMU3DReviewWidget/ENOR3DAppInit",["DS/WAfrContainer/App","DS/DMUBaseExperience/DMUContextManager","UWA/Core","DS/Controls/Loader","DS/DMUMeasurable/DMUToolsSceneGraph","i18n!DS/DMU3DReviewWidget/assets/nls/DMU3DReviewWidget"],(function(e,t,i,n,o,a){"use strict";var r,s,l,d;return e.extend({setUp:function(e){if(e.sourceApp&&this.options.id===e.sourceApp.options.id)return e.sourceApp.pad3DViewer&&(this.pad3DViewer=e.sourceApp.pad3DViewer),e.sourceApp.appMainDiv&&(this.appMainDiv=e.sourceApp.appMainDiv),Promise.resolve();var t=this;if(window.widget.getValue("X3DContentId")&&!e.sourceApp){var o="",c=JSON.parse(window.widget.getValue("X3DContentId"));c.data&&c.data.items&&c.data.items[0]&&c.data.items[0].displayName&&(o=c.data.items[0].displayName);var p=i.createElement("div",{class:"DMULoadingPanel"}).inject(document.body);(d=new n({text:a.loadingMessage+" "+o}).inject(p)).on(),d.getContent().addClassName("DMULoadingPanelInfoDiv");var u=d.elements.label.getSize().width,w=d.elements.progressBar.getContent().getSize().width,g=d.elements.progressBar.getContent().getSize().height,D=u+w;p.setStyles({position:"absolute",bottom:"0",left:"0","z-index":"40000","background-color":"rgba(255,255,255,1",height:"100%",width:"100%"}),d.getContent().setStyles({position:"absolute",left:"calc(50% - "+D/2+"px)",top:"calc(50% - "+g/2+"px)"})}return e.sourceApp?e.sourceApp.pad3DViewer?(l=e.sourceApp.pad3DViewer,this.pad3DViewer=e.sourceApp.pad3DViewer,this.appMainDiv=e.sourceApp.appMainDiv,new Promise((function(i){r?(e.done&&e.done(),i()):require(["DS/DMU3DReviewWidget/ENOR3DWidgetMain"],(function(n){r=new n({widget:window.widget,pad3DViewer:t.getExecutionContext?t.getExecutionContext().getComponent("Viewer"):e.sourceApp.pad3DViewer,executionContext:t.getExecutionContext(),appMainDiv:e.sourceApp.appMainDiv}),e.done&&e.done(),i()}))})).then((function(){e.sourceApp&&!e.sourceApp.isDisposeCalled()&&e.sourceApp.dispose();var i=e.done;e.done=function(){var n;e.done=i,"ENX3DIR_AP"===e.sourceApp.options.id&&((n=t).switchApp&&require(["DS/CATWebUXComponents/CATWebUXInfoFlag","DS/CATWebUXSlideShow/CATWebUXSlideShowController","i18n!DS/DMU3DReviewWidget/assets/nls/DMU3DReviewWidget"],(function(e,t,i){var o=new e({frameWindow:n.pad3DViewer.getFrameWindow(),viewer:n.pad3DViewer.getViewer(),dockingSide:"left"});o.display({label:i.backToIssue,style:"webUXStyle",fontIcon:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-move-to-start",onClickCB:function(){s(),s=null,n.switchApp("ENX3DIR_AP")}});var a,r=t.getSlideShowController({context:n.pad3DViewer.getFrameWindow(),id:"DMU3DMarkupSlideShow"});r&&(a=r.subscribe("onActiveStateModified",(function(e){o.setVisibleFlag(!e.state)}))),s=function(){o.clean();var e=t.giveSlideShowController({context:n.pad3DViewer.getFrameWindow(),id:"DMU3DMarkupSlideShow"});e&&e.unsubscribe(a)}}))),e.done()},r.setUp(e)}))):void e.done():new Promise((i=>{require(["DS/DMU3DReviewWidget/ENOR3DWidgetMain"],(function(i){r=new i({widget:window.widget,viewer:t.getExecutionContext().getComponent("Viewer"),executionContext:t.getExecutionContext(),viewerAttachment:e.done,done:function(e){l=e.pad3DViewer,t.pad3DViewer=e.pad3DViewer,t.appMainDiv=e.appMainDiv}})})),e.done&&e.done(),i()}))},dispose:function(e){if(l){if(l&&l.getExecutionContext){let e=l.getExecutionContext(),t=e.getSourceApp(),i=e.getTargetApp();if(t&&i&&t.options.id===i.options.id)return}var i=t.getReviewContext({context:this.pad3DViewer});if(e&&i&&i.getCurrentSessionMarkup())e.preferredType="Markup";else if(e&&this.pad3DViewer.getApplicativeData().getLoadedItfData&&this.pad3DViewer.getApplicativeData().getLoadedItfData().data.length)e.preferredType="SIMItfSimulation";else if(e){var n=o.getRoots(l);let t=1===n.length?o.getNodeType(n[0]):null;"Requirement"!==t&&"Requirement Specification"!==t&&"DesignSight"!==t||(e.preferredType=t)}s&&s(),s=null,r&&r.dispose&&r.dispose(e);var a=window.document.getElementsByClassName("DMULoadingPanel");d&&(d.destroy(),d=null),a.length&&a[0].destroy(),l=void 0,this._parent(e)}},onWillEnter:function(e){if(this.options.id===e.options.id)return Promise.resolve();if(r&&r.onWillEnter&&r.onWillEnter(e),e&&e.pad3DViewer&&t.getReviewContext({context:e.pad3DViewer})&&t.getReviewContext({context:e.pad3DViewer}).getValidation){t.getReviewContext({context:e.pad3DViewer}).getValidation()&&t.removeReviewContext({context:e.pad3DViewer})}return require(["DS/DMUBaseExperience/EXPUtils","DS/DMU3DReviewController/DMU3DReviewController","DS/PADUtils/PADSettingsMgt"],(function(t,i,n){n.setSetting("enopad3dviewer_staticMappingSupportActivated",!0);var o=i.get3DReviewController({context:e.pad3DViewer});("string"==typeof e&&"X3DPLAW_AP"===e||e.options&&"X3DPLAW_AP"===e.options.id)&&o.setappTransition(!0),t._sendUsageProbe("appTransitionFrom",e.options.id,"resolved")})),this._parent(e)},onWillLeave:function(e){if(this.options.id===e.options.id)return Promise.resolve();var i=o.getRoots(l),n=["Document","DIFLayout","DIFSheet"];["X3DPLAW_AP","ENOR3R_AP","ENOR3V_AP","ENOR3D_AP","ENX3DIR_AP"].indexOf(e.options.id)<0&&n.push("DesignSight","R2V_Activity");for(var a=0;a<i.length;a++)if(-1!==n.indexOf(o.getNodeType(i[a]))){var s=o.getNodeID(i[a]);s&&l.removeRoots({pids:[s]})}return require(["DS/CATWebUXPreferences/CATWebUXPreferencesManager"],(function(i){var n=i.getPreferenceManager({context:l.getFrameWindow()});if(n&&("CATC3D_AP"===e.options.id||"CATA3I_AP"===e.options.id||"ENOI3D_AP"===e.options.id)){n.removeAllPreferences();let i=t.getReviewContext({context:l});"CATA3I_AP"===e.options.id&&i&&i.getCurrentSessionMarkup()&&i.getCurrentSessionMarkup().setActiveFlag(!1)}})),r&&r.onWillLeave&&r.onWillLeave(e),require(["DS/DMUBaseExperience/EXPUtils"],(function(t){t._sendUsageProbe("appTransitionTo",e.options.id,"resolved")})),this._parent(e)}})})),define("DS/DMU3DReviewWidget/DMU3DReviewWidgetDefaultCmd",["DS/CATWebUXComponents/DMUCommand","DS/DMU3DReviewController/DMU3DReviewController","DS/PADUtils/PADContext"],(function(e,t,i){"use strict";return e.extend({init:function(e){var n=e||{};this._parent(n,{mode:"exclusive",isAsynchronous:!0}),this.beginExecute=function(){var e=t.give3DReviewController({context:i.get()});e&&e.enableDMUContextualBar()},this.endExecute=function(){var e=t.give3DReviewController({context:i.get()});e&&e.disableDMUContextualBar()}}})})),define("DS/DMU3DReviewWidget/DMU3DReviewWidgetMain",["UWA/Core","DS/DMUControls/EXPNotify","DS/DMUBaseUI/DMUReviewDnDComponent","DS/DMU3DReviewWidget/DMU3DReviewWidgetOptions","DS/PADUtils/PADSettingsMgt","DS/DMUMeasurable/DMUToolsSceneGraph","DS/CATWebUXComponents/DMUCommandsManager","DS/PADServices/views/LandingPage","DS/PADServices/utils/GlobalModelEvents","DS/EditPropWidget/constants/ConstantsMapping","DS/DMUReadPersistence/DMUWebServicesUtils","DS/CATWebUXComponents/DMUFrameWindow","DS/DMUReadPersistence/DMULoadingContextController","DS/DMUBaseUIControllers/DMUSlidesController","i18n!DS/DMU3DReviewWidget/assets/nls/DMU3DReviewWidget"],(function(e,t,i,n,o,a,r,s,l,d,c,p,u,w,g){"use strict";let D;const v=[{key:"mkp",type:"Markup"},{key:"mku",type:"DMUMarkupRepReference"},{key:"isr",type:"SIMItfSimulation"},{key:"itf",type:"PLMPIMMetricReference"},{key:"difLayout",type:"DIFLayout"},{key:"difSheet",type:"DIFSheet"},{key:"difAnnotSet",type:"DIFAnnotationSet"},{key:"doc",type:"Document"},{key:"req",type:"Requirement"},{key:"reqSpec",type:"Requirement Specification"},{key:"msr",type:"DesignSight"},{key:"pointClouds",type:"R2V_Activity"}],m=["ds6w:label","ds6w:type","ds6wg:revision","ds6w:status","owner","ds6w:responsible","ds6w:modified","ds6w:project","ds6w:identifier"];function f(){var e=this.params.widget.getValue("xsceneStoredObjects");return e&&"string"==typeof e||(e='{"products":{},"filters":{}}'),JSON.parse(e)}function h(e){e&&e.length&&(this.showWelcomePanel(!1),this.pad3DViewer.addRootNodesFromContent({json3DXContent:{protocol:"3DXContent",version:"1.1",source:"X3DSEAR_AP",data:{items:e.map((function(e){return{envId:require("DS/PADUtils/PADUtilsServices").getPlatformId(),objectId:e.id,objectType:e.type,displayName:e.displayName}}))}}}))}async function S(e){try{let t=await c.getParentTypes(e);return[e].concat(t)}catch{return[e]}}async function b(e){let i=!0;if(e.length>1)for(const t of e){let e=await S(t["ds6w:type"]);if(!e.includes("VPMReference")&&!e.includes("R2V_Activity")){i=!1;break}}var n,o,a;i?h.call(this,e.map((function(e){return{id:e.resourceid,type:e["ds6w:type_value"],displayName:e["ds6w:label"]}}))):(n="warning",o=g.dropMultiNoAutorized,a=this.pad3DViewer,D&&(D.destroy(),D=null),D=new t({body:a.getFrameWindow().getUIFrame(),type:n,message:o}))}function y(e){if(e&&e.length){l.publish({event:"ENXViews/LandingPage/addOrRefresh",data:{objects:e.map((function(e){return{resourceid:e,openWithFilter:!1,loading:!0,fromCustom:!0}}))}});var t=setInterval(function(){this.isAppReady&&this.welcomePanel&&(clearInterval(t),function(e,t){require("DS/WAFData/WAFData").authenticatedRequest(require("DS/PADUtils/PADUtilsServices").get3DSpaceUrl()+"/cvservlet/fetch/v2?tenant="+require("DS/PADUtils/PADUtilsServices").getPlatformId(),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:require("DS/PADUtils/PADSettingsMgt").getSetting("pad_security_ctx")},data:JSON.stringify({physicalid:e,label:"M3DFetchForWelcomePanel"+Date.now(),select_predicate:m,select_file:["icon","thumbnail_2d"]}),onComplete:t,onFailure:function(){},onTimeout:function(){}})}(e,function(e){if(this.welcomePanel){var t=((e?JSON.parse(e):{}).results||[]).map(function(e){var t={},i=require("DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices"),n=i.getRoots(this.pad3DViewer).map((function(e){return i.getNodeID(e)})),o=require("DS/DMUBaseExperience/DMUContextManager").getReviewContext({context:this.pad3DViewer}),a=o?o.getReviewCtxInformation():{};a&&a.reviewId&&n.push(a.reviewId),this.pad3DViewer.getApplicativeData().getLoadedItfData&&this.pad3DViewer.getApplicativeData().getLoadedItfData().data.forEach((function(e){n=n.concat(e.metricID.length?e.metricID:[e.isrID])})),e.attributes.forEach((function(e){t[e.name]=e.value}));var r=t["ds6w:type"],s={resourceid:t.resourceid,label:t["ds6w:label"],serviceId:"R2V_Activity"===r?"r2vsurvey":void 0,icons:[t.type_icon_url],thumbnail:t.preview_url,grid:t,subLabel:t["ds6w:responsible"]+" | "+new Date(t["ds6w:modified"]).toLocaleString(),description:t["ds6w:identifier"],openWithFilter:!1,fromCustom:!0,loading:void 0,opened:n.indexOf(t.resourceid)>-1,item2Load:{}};return s.item2Load[s.resourceid]={},"SIMItfSimulation"!==r&&"Markup"!==r&&"DMUMarkupRepReference"!==r&&"PLMPIMMetricReference"!==r&&"DIFAnnotationSet"!==r||(s.addRemoveFromViewCtx=!0),s}.bind(this));l.publish({event:"ENXViews/LandingPage/addOrRefresh",data:{objects:t}})}}.bind(this)))}.bind(this),100)}}function A(e){this.isAppReady=!1,this.params=e,this.welcomePanel=this.pad3DViewer=null,this.tokensWelcomePanel=[],this.tokensPAD=[],this.tokensMkp=[],this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/LandingPage/refreshCustom"},y.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/LandingPage/openCustom"},function(e){var t=f.call(this),i=[];e.customitem2open.forEach((function(e){v.some((function(n){if(t[n.key]&&t[n.key][e])return i.push({id:e,type:n.type}),!0}))})),h.call(this,i)}.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/LandingPage/removeFromView"},function(e){if(e&&e.customitem2remove&&e.customitem2remove.length){var t=require("DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices"),i=t.getRoots(this.pad3DViewer).map((function(e){return t.getNodeID(e)})),n=require("DS/DMUBaseExperience/DMUContextManager").getReviewContext({context:this.pad3DViewer}),o=n?n.getReviewCtxInformation():{},a=o?o.reviewId:null,r=[];this.pad3DViewer.getApplicativeData().getLoadedItfData&&(r=this.pad3DViewer.getApplicativeData().getLoadedItfData().data),this.pad3DViewer.getApplicativeData().removeDIFAnnotSetKeepPrd&&e.customitem2remove.forEach((e=>{this.pad3DViewer.getApplicativeData().removeDIFAnnotSetKeepPrd(e)})),e.customitem2remove.indexOf(a)>-1&&require("DS/DMUBaseExperience/DMUContextManager").removeReviewContext({context:this.pad3DViewer}),r.forEach((function(t){(t.metricID.length?t.metricID:[t.isrID]).some((function(i){if(e.customitem2remove.indexOf(i)>-1)return this.pad3DViewer.getApplicativeData().removeIsrKeepContext(t.isrID),!0}),this)}),this),i.forEach((function(t){e.customitem2remove.indexOf(t)>-1&&this.pad3DViewer.removeRoots({pids:[t]})}),this)}}.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/LandingPage/removeFromStore"},function(e){if(e&&e.customitem2remove&&e.customitem2remove.length){var t=f.call(this),i=[];e.customitem2remove.forEach((function(e){v.some((function(n){if(t[n.key]&&t[n.key][e]&&-1===i.indexOf(e))return i.push(e),delete t[n.key][e],!0}))})),this.params.widget.setValue("xsceneStoredObjects",JSON.stringify(t)),l.publish({event:"ENXViews/LandingPage/removeFromView",data:{customitem2remove:i}})}}.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelMkp"},function(){s.launchSearch({title:g.mkp,precondition:'flattenedtaxonomies:"types/Markup"OR flattenedtaxonomies:"types/DMUMarkupRepReference"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelIsr"},function(){s.launchSearch({title:g.isr,precondition:'flattenedtaxonomies:"types/SIMItfSimulation"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelItf"},function(){s.launchSearch({title:g.itf,precondition:'flattenedtaxonomies:"types/PLMPIMMetricReference"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelDrw"},function(){s.launchSearch({title:g.drw,precondition:'flattenedtaxonomies:"types/Drawing"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelDIFLayout"},function(){s.launchSearch({title:g.difLayout,precondition:'flattenedtaxonomies:"types/DIFLayout"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelDIFSheet"},function(){s.launchSearch({title:g.difSheet,precondition:'flattenedtaxonomies:"types/DIFSheet"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelDIFAnnotationSet"},function(){s.launchSearch({title:g.difAnnotSet,precondition:'flattenedtaxonomies:"types/DIFAnnotationSet"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelDocument"},function(){s.launchSearch({title:g.doc,precondition:'flattenedtaxonomies:"types/Document"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelRequirement"},function(){s.launchSearch({title:g.req,precondition:'flattenedtaxonomies:"types/Requirement"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelRequirementSpec"},function(){s.launchSearch({title:g.reqSpec,precondition:'flattenedtaxonomies:"types/Requirement Specification"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/WelcomePanel/action/welcomePanelMsr"},function(){s.launchSearch({title:g.msr,precondition:'flattenedtaxonomies:"types/DesignSight"',showApplyButton:!1,ok:b.bind(this)})}.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/WelcomePanel/action/welcomPanelPrefCmd"},function(){require(["DS/CATWebUXComponents/DMUCommandsManager","DS/CATWebUXPreferences/CATWebUXPreferencesManager"],function(e,t){let i=t.givePreferenceManager({context:this.pad3DViewer.getFrameWindow()});if(i)var n=i.subscribe("onPreferencesPanelDestroyed",function(){i.unsubscribe(n),this.showWelcomePanel(!0)}.bind(this));this.showWelcomePanel(!1),e&&e.getCommand("CATWebUXPreferencesHdr",this.pad3DViewer&&this.pad3DViewer.getCommandContext?this.pad3DViewer.getCommandContext():null).begin()}.bind(this))}.bind(this))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/WelcomePanel/action/userAssistance"},(function(){let e=require("DS/WebUAUtils/WebUAUtils");window.open(e.getHelpFullPath(g.userAssistanceURL))}))),this.tokensWelcomePanel.push(l.subscribe({event:"ENXViews/WelcomePanel/action/whatsNew"},(function(){let e=require("DS/WebUAUtils/WebUAUtils");window.open(e.getEmbeddedHelpFullPath(g.whatsNewURL))})));var t=s.getDefaultActivities();t.activities[0].section.actions.splice(2,0,{id:"welcomePanelMkp",title:g.mkp,icon:"app-3dmarkup"}),t.activities[0].section.actions.splice(5,0,{id:"welcomePanelDIFAnnotationSet",title:g.difAnnotSet,icon:"annotation"}),t.activities[0].section.actions.splice(6,0,{id:"welcomePanelIsr",title:g.isr,icon:"interference-simulation"}),t.activities[0].section.actions.splice(7,0,{id:"welcomePanelItf",title:g.itf,icon:"interference-metric"}),t.activities[0].section.actions.splice(8,0,{id:"welcomePanelMsr",title:g.msr,icon:"physics-simulation"}),t.activities[0].section.actions.splice(9,0,{id:"welcomePanelDrw",title:g.drw,icon:"drawing"}),t.activities[0].section.actions.splice(10,0,{id:"welcomePanelRequirementSpec",title:g.reqSpec,icon:"requirement-specification"}),t.activities[0].section.actions.splice(11,0,{id:"welcomePanelRequirement",title:g.req,icon:"requirement"}),t.activities[0].section.actions.splice(12,0,{id:"welcomePanelDIFLayout",title:g.difLayout,icon:"fl-diagrams"}),t.activities[0].section.actions.splice(13,0,{id:"welcomePanelDIFSheet",title:g.difSheet,icon:"fl-diagram"}),t.activities[0].section.actions.splice(14,0,{id:"welcomePanelDocument",title:g.doc,icon:"doc"}),t.activities.push({section:{id:"customizeAppSection",title:g.customApp,actions:[{id:"welcomPanelPrefCmd",title:g.prefs,icon:"cog"}]}}),t.activities.push({section:{id:"contentAndKnowledge",title:g.contentAndKnowledge,actions:[{id:"userAssistance",title:g.userAssistance,icon:"help"},{id:"whatsNew",title:g.whatsNew,icon:"megaphone"}]}}),this.welcomePanel=new s({widget:e.widget,readOnlyApp:!1,renderDiv:e.renderDiv,externalViewerMgt:!0,externalViewerMgtCB:function(e,t){!0!==t&&this.showWelcomePanel("viewer"!==e)}.bind(this),globalSearchPrecond:'flattenedtaxonomies:"types/Markup" OR flattenedtaxonomies:"types/SIMItfSimulation" OR flattenedtaxonomies:"types/PLMPIMMetricReference" OR flattenedtaxonomies:"types/DIFLayout" OR flattenedtaxonomies:"types/DIFSheet" OR flattenedtaxonomies:"types/DIFAnnotationSet" OR flattenedtaxonomies:"types/VPMReference" OR flattenedtaxonomies:"types/VPMRepReference" OR flattenedtaxonomies:"types/ENOStrRefinementSpecification" OR flattenedtaxonomies:"types/Document" OR flattenedtaxonomies:"types/Requirement" OR flattenedtaxonomies:"types/Requirement Specification" OR flattenedtaxonomies:"types/DesignSight"',defaultActionId:t.defaultActionId,activities:t.activities,onLandingPageReady:e.onLandingPageReady})}A.prototype={constructor:A,initialize:function(){var e=this.welcomePanel.initialize();return e.then(function(){var e=f.call(this),t=Array.prototype.concat.apply([],v.map((function(t){return Object.keys(e[t.key]||[])})));y.call(this,t)}.bind(this)),e},setViewer:function(e){this.pad3DViewer=e,!this.params.initApp&&this.showWelcomePanel(!1);var t=e.render().getContent(),i=t.parentNode;t.style.position="relative",!this.params.renderDiv.parentNode&&i&&i!==this.params.renderDiv&&i.insertBefore(this.params.renderDiv,i.firstChild),this.params.renderDiv.insertBefore(t,this.params.renderDiv.firstChild),this.welcomePanel&&(this.params.renderDiv.insertBefore(this.welcomePanel.elements.mainBody,this.params.renderDiv.firstChild),this.welcomePanel.setViewer(e,!this.params.initApp)),this.tokensPAD.push(e.subscribe({event:"onRootAdded"},function(t){var i=require("DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices"),n=t.id,o=e.getController().getNode({id:n}),a=i.getNodeType(o);if("R2V_Activity"===a){var r=window.document.getElementsByClassName("DMULoadingPanelInfoDiv"),s=window.document.getElementsByClassName("DMULoadingPanel");r.length&&(r[0].dsModel.off(),r[0].dsModel.destroy(),r=null),s.length&&s[0].destroy()}if("DesignSight"===a||"DIFLayout"===a||"DIFSheet"===a||"Document"===a||"Specification Report"===a||"Requirement"===a||"Requirement Specification"===a){if("DesignSight"===a)this.params.widget.setValue("mkpSession",JSON.stringify({type:"msr",plmType:a,id:n}));else{this.params.widget.setValue("mkpSession",JSON.stringify({type:"Document"===a||"Specification Report"===a||"Requirement"===a||"Requirement Specification"===a?a:"2D",plmType:a,id:n}));let t=u.getLoadingContextController({context:e});if(t){let e=t.getSubContextInformations(n);e&&(n=e.id?e.id:n,a=e.type?e.type:a)}}var l=f.call(this);l[a="DIFLayout"===a?"difLayout":"DIFSheet"===a?"difSheet":"Requirement"===a?"req":"Requirement Specification"===a?"reqSpec":"DesignSight"===a?"msr":"VPMReference"===a?"products":"doc"]||(l[a]={}),l[a][n]={},this.params.widget.setValue("xsceneStoredObjects",JSON.stringify(l)),this.showWelcomePanel(!1),y.call(this,[n])}}.bind(this))),this.tokensPAD.push(e.subscribe({event:"onRootRemoved"},function(t){let i=u.getLoadingContextController({context:e});i&&i.removeSubContextInformations(t.id);var n=f.call(this);["difLayout","difSheet","doc","req","reqSpec","msr"].some((function(e){return n[e]&&n[e][t.id]}))&&(y.call(this,[t.id]),this.params.widget.deleteValue("mkpSession"))}.bind(this))),this.tokensPAD.push(e.subscribe({event:"onBeginRootLoading"},(function(){var e=window.document.getElementsByClassName("DMULoadingPanelInfoDiv"),t=window.document.getElementsByClassName("DMULoadingPanel");e.length&&(e[0].dsModel.off(),e[0].dsModel.destroy(),e=null),t.length&&t[0].destroy()}))),require(["DS/DMUBaseExperience/DMUContextManager"],function(t){var i=t.getEventsController({viewer:e.getViewer()});this.tokensMkp.push(i.addEvent("onReviewCtxInformationChanged",function(e){var t=f.call(this);t.mkp||(t.mkp={}),t.mku||(t.mku={}),"Markup"===e.reviewType?t.mkp[e.reviewId]={}:"DMUMarkupRepReference"===e.reviewType&&(t.mku[e.reviewId]={}),this.params.widget.setValue("xsceneStoredObjects",JSON.stringify(t)),y.call(this,[e.reviewId])}.bind(this))),this.tokensMkp.push(i.addEvent("onReviewRemoved",function(e){var t=f.call(this);(e&&t.mkp&&t.mkp[e.reviewId]||e&&t.mku&&t.mku[e.reviewId])&&y.call(this,[e.reviewId]),this.params.widget.deleteValue("reviewIdInSession")}.bind(this)))}.bind(this))},appReady:function(e){if(this.isAppReady=!0,this.params.initApp){let s=this.params.widget.getValue("X3DContentId"),l=this.params.widget.id.indexOf("preview")>-1,d=this;if(this.params.widget.deleteValue("X3DContentId"),s)e&&e.appInitFromTransition({x3dContent:JSON.parse(s),onNoActionDone:function(){setTimeout((function(e){var t=JSON.parse(s);d.showWelcomePanel(!1),(t.data&&t.data.items||[]).forEach((function(e){("Drawing"===e.objectType||e.objectTaxonomies&&e.objectTaxonomies.indexOf("Drawing")>-1)&&delete e.path})),t.data&&t.data.items&&t.data&&t.data.items.length&&i.callSpecReportData(e,t,!0)}),0,this.pad3DViewer)}.bind(this)});else if(!0===this.params.widget.getValue("autoreload")||!0===this.params.widget.getValue("autoreloadPreviewApp")&&!l){var t=this.params.widget.getValue("reviewIdInSession");if(t)h.call(this,[{id:JSON.parse(t).reviewID,type:JSON.parse(t).reviewType}]);else{var n=this.params.widget.getValue("mkpSession");if((n=n?JSON.parse(n):null)&&"ITF"===n.type){var o=this.params.widget.getValue("ItfSimuInSession");if((o=o?JSON.parse(o):null)&&!Array.isArray(o)&&"object"==typeof o){var a=Object.keys(o);if(1===a.length){var r=a[0];Array.isArray(o[r])&&o[r].length?h.call(this,o[r].map((function(e){return{id:e,type:"PLMPIMMetricReference"}}))):h.call(this,[{id:r,type:"SIMItfSimulation"}])}}}else n&&n.id&&("2D"===n.type||"Document"===n.type||"msr"===n.type)&&h.call(this,[{id:n.id,type:n.plmType}])}}l?this.params.widget.setValue("autoreloadPreviewApp",!0):this.params.widget.deleteValue("autoreloadPreviewApp")}var s=this.welcomePanel.appReady();return this.welcomePanel.redraw(),s},dispose:function(){if(this.showWelcomePanel(!1),this.welcomePanel){var e=require("DS/DMUBaseExperience/DMUContextManager").getEventsController({viewer:this.pad3DViewer.getViewer()});this.tokensMkp.forEach(e.removeEvent,e),this.tokensMkp=[],this.tokensPAD.forEach(this.pad3DViewer.unsubscribe,this.pad3DViewer),this.tokensPAD=[],this.pad3DViewer=this.params=null,this.tokensWelcomePanel.forEach(l.unsubscribe,l),this.tokensWelcomePanel.length=0;var t=this.welcomePanel.dispose();return this.welcomePanel=null,t}},showWelcomePanel:function(e){this.welcomePanel&&(this.welcomePanel.elements.mainBody.style.position="relative",this.welcomePanel.elements.mainBody.style.display=e?"":"none",e&&this.welcomePanel.redraw())}};var C,M,R,P,x={widget:null,widgetLink:null,viewer:null,viewerAttachment:null},U="DMU3DMarkupDefaultWkb",k=n.getOption("testWkb"),E={wkb2D:{type:"2D",wkb:[{file:k?"DMU3DReviewWidget2D_TST.xml":"DMU3DReviewWidget2D.xml",module:k?"CAT3DReviewTestWidget":"DMU3DReviewWidget"}]},wkb2DFormats:{type:"2DFormats",wkb:[{file:"DMU2DFormats.xml",module:"DMU3DReviewWidget"}]},wkb3D:{type:"3D",wkb:[{file:k?"DMU3DReviewWidget_TST.xml":"DMU3DReviewWidget.xml",module:k?"CAT3DReviewTestWidget":"DMU3DReviewWidget"}]},wkb3DFormats:{type:"3DFormats",wkb:[{file:"DMU3DFormats.xml",module:"DMU3DReviewWidget"}]},wkbITF:{type:"ITF",wkb:[{file:k?"DMUReviewAndITFWidget_TST.xml":"DMUReviewAndITFWidget.xml",module:k?"CAT3DReviewTestWidget":"DMU3DReviewWidget"}]},wkbITFFormats:{type:"ITFFormats",wkb:[{file:"DMU3DFormats.xml",module:"DMU3DReviewWidget"}]},wkbDocument:{type:"Document",wkb:[{file:k?"DMU3DReviewWidgetDocument_TST.xml":"DMU3DReviewWidgetDocument.xml",module:k?"CAT3DReviewTestWidget":"DMU3DReviewWidget"}]},wkbRequirement:{type:"Requirement",wkb:[{file:k?"DMU3DReviewWidgetRequirement_TST.xml":"DMU3DReviewWidgetRequirement.xml",module:k?"CAT3DReviewTestWidget":"DMU3DReviewWidget"}]},"wkbRequirement Specification":{type:"Requirement Specification",wkb:[{file:k?"DMU3DReviewWidgetRequirement_TST.xml":"DMU3DReviewWidgetRequirement.xml",module:k?"CAT3DReviewTestWidget":"DMU3DReviewWidget"}]},wkb2DFL:{type:"2DFL",wkb:[{file:"DMU3DReviewWidget2DFL.xml",module:"DMU3DReviewWidget"}]},wkb2DFLFormats:{type:"2DFLFormats",wkb:[{file:"DMU2DFormats.xml",module:"DMU3DReviewWidget"}]},wkbMSR:{type:"MSR",wkb:[{file:"DMU3DMarkupWidgetMSR.xml",module:"DMU3DReviewWidget"}]},wkbR2V:{type:"R2V",wkb:[{file:"DMU3DMarkupWidgetR2V.xml",module:"DMU3DReviewWidget"}]},wkbR2VFormats:{type:"R2VFormats",wkb:[{file:"DMUR2VFormats.xml",module:"DMU3DReviewWidget"}]},wkbMSRFormats:{type:"MSRFormats",wkb:[{file:"DMUMSRFormats.xml",module:"DMU3DReviewWidget"}]}};function V(){return x.widget.getValue(U)}function I(e){x.widget.setValue(U,e)}function W(){let e;var t=a.getRoots(x.viewer);let i=u.getLoadingContextController({context:x.viewer});i&&t.length&&(e=i.getSubContextInformations(t[0].getIdentificationObject())),e&&e.label?x.widget.setTitle(e.label):x.viewer.getContentName({callbacks:{onComplete:function(e){x.widget.setTitle(e.contentName)},onFailure:function(){}}})}var F=[],N=function(e){F.push(e),1===F.length&&function e(t){var i={lastCommand:[],currentCommand:null,defaultCommand:null},n=x.viewer.getCommandContext?x.viewer.getCommandContext():null;n?r._commandsState[n]=i:r._commandsState=i,r.resetDefaultCommand(n),r._isCommandEnding=!1,r._ignoreCommandBeginWhileEndingCommand=!1,r._commands&&r._cmdCheckHeader&&["_commands","_cmdCheckHeader"].forEach((function(e){var t=n?r[e][n]:r[e];Object.keys(t).forEach((function(e){var i=t[e];i&&i._destroy&&i._destroy(),delete t[e]}))}));var o=0,a=t.viewer.getFrameWindow().getActionBar(),s=a.onActionBarReady((function(){++o<t.afr.wkb.length&&t.merge?t.viewer.loadActionBar({merge:!0,file:t.afr.wkb[o].file,module:t.afr.wkb[o].module}):(a.removeCallback(s),t.viewer.getFrameWindow().getContextualUIManager().activateContextualBarOnLeftClicAfterCSOChange(),r.setDefaultCommand({ID:"DMU3ReviewWidgetDefaultHdr",className:"DS/DMU3DReviewWidget/DMU3DReviewWidgetDefaultCmd",context:n}),t.actionBarReadyCb&&t.actionBarReadyCb(),t.options&&t.options.done({appMainDiv:R,pad3DViewer:t.viewer})),t.merge&&o!==t.afr.wkb.length||(F.shift(),F.length&&e(F[0]))}));t.viewer.loadActionBar({merge:!1,file:t.afr.wkb[0].file,module:t.afr.wkb[0].module})}(F[0])};async function T(e){e&&(e.subscribe("onReviewContextModified",(function(e){var t=e.onABReady?e.onABReady:function(){},i=V();if("Data"===e.type){if("3D"===e.data.wkb){for(var n=!1,o=0;o<E.wkb3D.wkb.length;o++)E.wkb3D.wkb[o].file===e.data.file&&E.wkb3D.wkb[o].module===e.data.module&&(n=!0);if(n){let e=x.viewer.getCommandContext?x.viewer.getCommandContext():null;r.setDefaultCommand({ID:"DMU3ReviewWidgetDefaultHdr",className:"DS/DMU3DReviewWidget/DMU3DReviewWidgetDefaultCmd",context:e})}else E.wkb3D.wkb.push({file:e.data.file,module:e.data.module}),"3D"===i&&N({merge:!0,afr:E.wkb3D,viewer:x.viewer,actionBarReadyCb:t})}}else if("RefreshAB"===e.type)N({merge:!0,afr:E["wkb"+i],viewer:x.viewer,actionBarReadyCb:t});else if("Document"===e.type||"Specification Report"===e.type)N({merge:!0,afr:E.wkbDocument,viewer:x.viewer,actionBarReadyCb:t}),e.type.contains("Formats")||I("Document");else if("ITF"===e.type||"MSR"===e.type||"R2V"===e.type||"Requirement"===e.type||"Requirement Specification"===e.type||E["wkb"+e.type])if(e.type!==i)N({merge:!0,afr:E["wkb"+e.type],viewer:x.viewer,actionBarReadyCb:t}),e.type.contains("Formats")||I(e.type);else{let e=x.viewer.getCommandContext?x.viewer.getCommandContext():null;r.setDefaultCommand({ID:"DMU3ReviewWidgetDefaultHdr",className:"DS/DMU3DReviewWidget/DMU3DReviewWidgetDefaultCmd",context:e})}"ITF"===e.type?x.widget.setValue("mkpSession",JSON.stringify({type:e.type})):"Data"===e.type&&x.widget.deleteValue("mkpSession")})),await e.setActiveState(!0))}var _,O,L,q=function(){require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/PADUtils/PADCommandProxy"],(function(e,t){(_=e).renderDiv||_.initialize2(x.viewer.getFrameWindow().getViewerFrame(),t.appId(),x.widget.getValue("changeControlActivation")?"show":"hide","top-right",(function(){_.addEvent("onAuthoringCtxVisible",(function(e){e.showAuthoringContext&&x.widget.setValue("changeControlActivation",!0)}))}))}))},X=function(e){require(["DS/PADUtils/PADCommandProxy","DS/PADUtils/PADSharedSettings","DS/DMUBaseExperience/DMUContextManager","i18n!DS/PADUtils/assets/nls/PADUtils"],(function(t,i,a,r){var s,l=[],d=[];L=function(){x.widget.setPreferences([]),s.destroy(),l.forEach((function(e){e.cb&&o.removeEvent(e.cb,e.padFct)})),L=function(){}},O=function(){if(l.forEach((function(e){var t=e.preference.name,i=x.widget.getValue(t),n=o.getSetting(t);(i="boolean"===e.preference.type&&"boolean"!=typeof i?"true"===i:i)!==n&&o.setSetting(t,i),e.fct&&e.fct(i)})),o.updateWidgetPreferences(),!s&&l.length){let e=a.giveEventsController({viewer:x.viewer.getViewer()});s=t.create({events:{onPreferenceModification:function(e){l.some((function(t){if(e.name===t.preference.name){if("boolean"!=typeof e.value&&"string"!=typeof e.value)throw new Error("Value must be a string or a boolean");if(o.getSetting(e.name)!==e.value){if("boolean"===t.preference.type&&"boolean"!=typeof e.value)throw new Error("Preference is a boolean type so value must be a boolean");t.debounce=!0,x.widget.setValue(e.name,e.value),o.setSetting(e.name,e.value)}return t.fct&&t.fct(e.value),!0}}))},onSelect:function(t){e&&e.fireEvent("onCrossWidgetSelection",t)}}}),x.widgetLink&&x.widgetLink.subscribe("DS/ExternalWdgtCom/Find",(t=>{e&&e.fireEvent("onCrossWidgetFind",t)})),e&&(e.addEvent("onFireCrossWidgetSelection",(e=>{s&&s.select(e)})),e.addEvent("onFireCrossWidgetFind",(e=>{e&&e.paths&&e.paths.length&&x.widgetLink&&x.widgetLink.publish("DS/ExternalWdgtCom/Find",{paths:e.paths})}))),l.forEach((function(e){e.cb&&o.addEvent(e.cb,e.padFct=function(t){e.debounce?e.debounce=!1:s.preferenceModification({name:e.preference.name,value:t})})}))}},x.widget.setPreferences([]),o.setSetting("syncAutoReload",!0),i.destroy(),i.addSharedSettings(x.widget),l.push({preference:{name:"changeControlActivation",type:"boolean",label:r.changeControlActivation_label,defaultValue:!1},fct:function(e){_&&_[e?"show":"hide"]()},cb:"onChangeControlActivation",debounce:!1}),l.push({preference:{name:"changeControlPosition",type:"list",label:r.changeControlPosition_label,defaultValue:"top-right",options:[{label:r["top-right_label"],value:"top-right"},{label:r["top-left_label"],value:"top-left"},{label:r["bottom-left_label"],value:"bottom-left"},{label:r["bottom-right_label"],value:"bottom-right"}]},fct:function(e){_&&_.setPosition(e)}}),o.setSetting("authorizeChangeControl",!0),e&&q(),n.getOption("debug")?l.push({preference:{name:"webapi_timeout",type:"text",label:"Query timeout",defaultValue:"60000"}}):d=["webapi_timeout"],d.forEach((function(e){x.widget.deleteValue(e)})),d.length=0,l.forEach((function(e){x.widget.mergePreferences([e.preference])})),O(),require(["i18n!DS/ENOPAD3DViewer/assets/nls/PAD3DViewer"],(e=>{x.widget.addEvent("onChangeFlexibleAssembliesSupport",(function(e,t){o.setSetting(e,t)}));var t=o.getSetting("enopad3dviewer_roles");let i=!0,n=require("DS/PADUtils/PADUtilsServices").isCloud(),a=require("DS/PADUtils/PADSession").isAuthoring();for(var r=0;r<t.length;r++)if("E19"===t[r].id&&(!t[r].platforms||t[r].platforms&&t[r].platforms.indexOf(require("DS/PADUtils/PADUtilsServices").getPlatformId())>-1)){i=!1;break}!i||n||a?(x.widget.addPreference({name:"enopad3dviewer_flexibleAssemblySupportActivated",type:"hidden",defaultValue:!1,label:e.flexibleAssemblySupport,onchange:"onChangeFlexibleAssembliesSupport",value:!1}),o.setSetting("enopad3dviewer_flexibleAssemblySupportActivated",!1)):x.widget.getPreference("enopad3dviewer_flexibleAssemblySupportActivated")||(x.widget.addPreference({name:"enopad3dviewer_flexibleAssemblySupportActivated",type:"boolean",defaultValue:!1,label:e.flexibleAssemblySupport,onchange:"onChangeFlexibleAssembliesSupport",value:void 0!==x.widget.getValue("enopad3dviewer_flexibleAssemblySupportActivated")&&x.widget.getValue("enopad3dviewer_flexibleAssemblySupportActivated")}),o.setSetting("enopad3dviewer_flexibleAssemblySupportActivated",x.widget.getValue("enopad3dviewer_flexibleAssemblySupportActivated"))),o.setSetting("enopad3dviewer_staticMappingSupportActivated",!a)})),x.widget.addEvent("endEdit",O)}))},B=function(e){e.unsubscribe(M),M=null,W(),q(),require("DS/PADUtils/PADUtilsServices").isCloud()&&!window.__preventPrefPanel&&e.getViewer().displayIntroductoryControlPreferencePanel(),x.widget.getValue(U)||x.widget.addPreference({name:U,type:"hidden"});var t=!1,i=async function(){if(t){var i=C.get3DReviewController({context:e});await T(i),P.appReady(i)}else t=!0};require(["DS/DMU3DReviewController/DMU3DReviewController"],(function(e){C=e,i()})),setTimeout((function(){"1"===x.widget.getValue("widgetForODTReplay")&&(x.widgetViewer3DReview._viewer3DReview=e),x.widget.dispatchEvent("onWidgetAndAppReady","1"===x.widget.getValue("widgetForODTReplay")?[{pad3DViewer:x.viewer}]:void 0),i()})),x.viewerAttachment&&x.viewerAttachment(R),x.viewerAttachment=null,e.getFrameWindow().getContextualUIManager().activateContextualBarOnLeftClicAfterCSOChange()};function j(e){"string"==typeof e.reviewID&&x.widget.setValue("reviewIdInSession",JSON.stringify(e))}function J(){var e=window.document.getElementsByClassName("DMULoadingPanelInfoDiv"),t=window.document.getElementsByClassName("DMULoadingPanel");e.length&&(e[0].dsModel.off(),e[0].dsModel.destroy(),e=null),t.length&&t[0].destroy()}function z(t){return R||(R=e.createElement("div",{class:"appMain",styles:{width:"auto",height:"100%"}})),(P=new A({widget:x.widget,readOnlyApp:!1,renderDiv:R,initApp:t&&t.initApp,onLandingPageReady:t&&t.onLandingPageReady})).initialize()}function H(){if(o.setSetting("activateWidgetLink",!0),o.setSetting("useNewUXGuidelinesWP",!0),!x.viewer){x.widget.deleteValue("reviewIdInSession");var e=new Promise((function(e){require(["DS/PADUtils/PADSharedSettings"],(t=>{t.addSharedSettings(x.widget,["showWelcomePanel"]),z({initApp:!0,onLandingPageReady:function(){x.viewerAttachment(R),x.viewerAttachment=null}}).then(e)}))})),t=new Promise((function(e){require(["DS/ENOPAD3DViewer/PAD3DViewer","text!DS/DMU3DReviewWidget/assets/DMU3DReviewWidget.json"],(function(t,i){e([t,i])}))})),n=new Promise((e=>{require(["DS/ENOXInterWdgCom/LinkManager"],(t=>{x.widgetLink=t,t.initializeWidgetLink(x.widget,{appIds:[],uses:["ENXContent","ENXContentSync3D","ENXContentSync2D","ENXEnrich","ENXAuthoring2D","ENXAuthoring3D","ENXLandingPageSync"],implements:["ENXContent","ENXContentSync3D","ENXEnrich","ENXLandingPageSync"],open:!0}).then(e)}))}));Promise.all([e,t,n]).then((function(e){var t=JSON.parse(e[1][1]);t.context="Default",t.mouseProfile=require("DS/PADUtils/PADUtilsServices").isCloud()?window.__mouseProfile:"CATIA";var n=V();t.workbenchModule="2D"===n||"ITF"===n||"R2V"===n||"MSR"===n||"Document"===n||"2DFL"===n||"Requirement"===n||"Requirement Specification"===n?E["wkb"+n].wkb[0].module:E.wkb3D.wkb[0].module,t.workbench="2D"===n||"ITF"===n||"MSR"===n||"R2V"===n||"Document"===n||"2DFL"===n||"Requirement"===n||"Requirement Specification"===n?E["wkb"+n].wkb[0].file:E.wkb3D.wkb[0].file;var a={widget:x.widget,windowOptions:t,enableFiltering:!0,binaryPrimitives:!0,enableSidePanel:!0,readyCB:X,visuProgressiveTileModel:!0};a.windowOptions.allowDnD=!1;var r=x.viewer=new e[1][0](a);p.init(r),t.mouseProfile&&r.getViewpoint().setDefaultController(!0,t.mouseProfile),P.setViewer(r);var s=o.getSetting("propertiesFacet"),l=d.getMapping();l&&(l.physicssimulation.alwaysVisible=!1,s.push(l.physicssimulation)),r.setOption("propertiesFacet",s),r.setAuthorizedRootTypes(o.getSetting("ups_authorized_root_types")),M=r.subscribe({event:"onReady"},B),r.subscribe({event:"onRootAdded"},W),r.subscribe({event:"onRootRemoved"},W),r.subscribe({event:"onRootAttached"},W),r.subscribe({event:"onRootDetached"},W),r.subscribe({event:"onContentNameModified"},W),i.initViewerDnd(r,S),localStorage.getItem("defaultSelectedTypeData")||localStorage.setItem("defaultSelectedTypeData","product"),o.setSetting("settypes",!0),"1"===x.widget.getValue("widgetForODTReplay")&&x.widget.dispatchEvent("onPAD3DViewerCreated",[{pad3DViewer:r}]),x.widgetInitDone&&x.widgetInitDone({appMainDiv:R,pad3DViewer:r})}))}}async function G(){if(function(){var e=o.getSetting("enopad3dviewer_roles");let t=!0,i=require("DS/PADUtils/PADUtilsServices").isCloud(),n=require("DS/PADUtils/PADSession").isAuthoring();for(var a=0;a<e.length;a++)if("E19"===e[a].id&&(!e[a].platforms||e[a].platforms&&e[a].platforms.indexOf(require("DS/PADUtils/PADUtilsServices").getPlatformId())>-1)){t=!1;break}o.setSetting("enopad3dviewer_flexibleAssemblySupportActivated",t&&!i&&!n),o.setSetting("enopad3dviewer_staticMappingSupportActivated",!n)}(),x.viewer){var e=x.widget.getValue("reviewIdInSession");e=e?JSON.parse(e):void 0;var t,i,n=function(e){j(e);let t=x.widget.getValue("reviewIdInSession"),i=JSON.parse(t).reviewID,n=JSON.parse(t).reviewType;i&&C&&C.give3DReviewController({context:x.viewer}).loadReview({objectId:i,objectType:n,fromRefresh:!0})},r=a.getRoots(x.viewer),s=!1,l=[];for(let e=0;e<r.length;e++)if(""!==a.getNodeID(r[e])&&(t=a.getNodeID(r[e]),i=a.getNodeType(r[e]),(l=await S(i)).includes("Document")||l.includes("Specification Report")||l.includes("Requirement")||l.includes("Requirement Specification"))){s=!0;break}var d=x.viewer.subscribe({event:"onRefreshCompleted"},(function(){if(x.viewer.unsubscribe(d),s)if(e)n(e);else{var a=o.getSetting("enopad3dviewer_lightNodeModel")?[{rootID:t,validForServerCall:!0,structure:{rootStats:{infos:{encoding:"UTF-8",kind:"InstRef",version:"1.1"},results:[{resourceid:t,"ds6w:type":i,"ds6w:globaltype":"ds6w:Part","ds6w:globalType":"ds6w:Part",boundingbox:{max:[-1,-1,-1],min:[1,1,1]}},{synthesis:{name:"ProgressiveExpand_FlatSynthesis",value:1}},{synthesis:{name:"ProgressiveExpand_OccSynthesis",value:1}},{synthesis:{name:"ProgressiveExpand_LeafSynthesis",value:1}}]},infos:{encoding:"UTF-8",kind:"InstRef",version:"1.1"},results:[{resourceid:t,"ds6w:type":i,"ds6w:globaltype":"ds6w:Part","ds6w:globalType":"ds6w:Part",nbchildren:"0"}]}}]:[{rootID:t,validForServerCall:!0,structure:{rootId:i,results:[{attributes:[{name:"did",value:t},{name:"physicalid",value:t},{name:"ds6w:type",value:i}]},{path:[t]}]}}];x.viewer.loadJSON({data:a})}else if(l.includes("DesignSight")||l.includes("DIFSheet")||l.includes("DIFLayout"))e?setTimeout((()=>{n(e)})):x.viewer.publish({event:"widgetReresh",data:{objectId:t,objectType:i}});else if(l.includes("R2V_Activity")){if(!1===x.viewer.getSoIUsability()){x.viewer.toggleSOITimelinesUsability(!0);var r=x.viewer.subscribe({event:"onR2VLoaded"},(function(){x.viewer.getSoIUsability()&&x.viewer.toggleSOITimelinesUsability(!1),x.viewer.unsubscribe(r),r=null,e&&n(e)}))}}else e&&n(e)}));x.viewer.refresh()}}function K(){if(C){var e=C.give3DReviewController({context:x.viewer});e&&e.refreshContext()}}function Q(){P&&P.dispose(),P=null,x.viewer&&(C&&C.unreference3DReviewController({context:x.viewer}),x.viewer.destroy()),x={widget:null,viewer:null,viewerAttachment:null},C=null}function Y(e){x.viewer&&x.viewer.search({searchQuery:e})}var Z=function(e){if(x.widget=e.widget,R=e.appMainDiv,x.widgetInitDone=e.done,e.pad3DViewer){x.viewer=e.pad3DViewer,p.init(x.viewer);var t=require("DS/DMUBaseExperience/DMUContextManager").getReviewContext({context:e.pad3DViewer}),i=t?t.getReviewCtxInformation():null;i&&i.reviewId&&j(i.reviewId)}else e.viewerAttachment?(x.viewerAttachment=e.viewerAttachment,H()):(x.viewerAttachment=function(e){x.widget.setBody(e)},x.widget.addEvent("onLoad",H)),x.widget.addEvent("endEdit",K),x.widget.addEvent("onRefresh",G),x.widget.addEvent("onDestroy",Q),x.widget.addEvent("onSearch",Y),"1"===x.widget.getValue("widgetForODTReplay")&&(x.widgetViewer3DReview=this),x.widget.addEvent("onDMUMarkupLoaded",j),x.widget.addEvent("onDMUMarkupLoadFailed",J),x.widget.setMetas({helpPath:"DMU3DReviewWidget/assets/help"})};return Z.prototype.setUp=function(e){function t(){require(["DS/DMU3DReviewController/DMU3DReviewController"],(function(t){var i=(C=t).get3DReviewController({context:x.viewer});(async()=>{await T(i),e.sourceApp&&e.sourceApp.issues&&1===e.sourceApp.issues.length&&i.appInitFromTransition({issues:e.sourceApp.issues,onNoActionDone:function(){}})})()}))}require("DS/ENOXInterWdgCom/LinkManager").updateLinkability({appIds:[],open:!0,uses:["ENXContent","ENXContentSync3D","ENXContentSync2D","ENXEnrich","ENXAuthoring2D","ENXAuthoring3D","ENXLandingPageSync"],implements:["ENXContent","ENXContentSync3D","ENXEnrich","ENXLandingPageSync"]}),o.setSetting("activateWidgetLink",!0),o.setSetting("useNewUXGuidelinesWP",!0),z().then((function(){P.setViewer(x.viewer),P.appReady(),x.widget.addEvent("onRefresh",G),x.widget.addEvent("onSearch",Y),x.widget.addEvent("onDMUMarkupLoaded",j),x.widget.setMetas({helpPath:"DMU3DReviewWidget/assets/help"}),e.sourceApp&&e.sourceApp.pad3DViewer!==x.viewer&&(x.viewer=e.sourceApp.pad3DViewer),p.init(x.viewer);var i=o.getSetting("propertiesFacet"),n=d.getMapping();n&&n.physicssimulation&&n.physicssimulation.facet&&(i.find((function(e){return!(!e||!e.facet||e.facet.name!==n.physicssimulation.facet.name)}))||(n.physicssimulation.alwaysVisible=!1,i.push(n.physicssimulation))),x.viewer.setOption("propertiesFacet",i),x.viewer.getBIController().toggleBetweenStandaloneAndSlaveMode("DUAL"),X(x.viewer),x.viewer.getViewer().updateViewPanelUIConfiguration&&x.viewer.getViewer().updateViewPanelUIConfiguration({useShadingIllustration:!1,useOutline:!1}),W(),"3D"===V()||a.getRoots(x.viewer).length>=0?(N({options:e,merge:!1,afr:E.wkb3D,actionBarReadyCb:t,viewer:x.viewer}),I("3D")):"2DFL"===V()?(N({options:e,merge:!1,afr:E.wkb2DFL,actionBarReadyCb:t,viewer:x.viewer}),I("2DFL")):(N({options:e,merge:!1,afr:E.wkb2D,actionBarReadyCb:t,viewer:x.viewer}),I("2D")),o.setSetting("dynamic_authorized_types",!0)}))},Z.prototype.dispose=function(e){if(o.setSetting("dynamic_authorized_types",!1),x.widget.removeEvent("onRefresh",G),x.widget.removeEvent("onSearch",Y),x.widget.removeEvent("endEdit",O),x.widget.removeEvent("onDMUMarkupLoaded",j),L&&L(),P&&P.dispose(),P=null,x.viewer){var t=o.getSetting("propertiesFacet"),i=d.getMapping();if(i){var n=t.findIndex((function(e){return!(!e||!e.facet||e.facet.name!==i.physicssimulation.facet.name)}));n>=0&&t.splice(n,1)}x.viewer.setOption("propertiesFacet",t),C&&C.unreference3DReviewController({context:x.viewer,options:e})}E.wkb2D.wkb.length>1&&E.wkb2D.wkb.splice(1,E.wkb2D.wkb.length),E.wkb2DFL.wkb.length>1&&E.wkb2DFL.wkb.splice(1,E.wkb2DFL.wkb.length),E.wkb3D.wkb.length>1&&E.wkb3D.wkb.splice(1,E.wkb3D.wkb.length),E.wkb2DFormats.wkb.length>1&&E.wkb2DFormats.wkb.splice(1,E.wkb2DFormats.wkb.length),E.wkb2DFLFormats.wkb.length>1&&E.wkb2DFLFormats.wkb.splice(1,E.wkb2DFLFormats.wkb.length),E.wkb3DFormats.wkb.length>1&&E.wkb3DFormats.wkb.splice(1,E.wkb3DFormats.wkb.length),C=null},Z.prototype.onWillLeave=function(e){if(x.viewer){var t=require("DS/DMUBaseExperience/DMUContextManager");if(t){const n=w.giveDMUSlidesController({context:x.viewer.getFrameWindow()});n&&n.setVisibleFlag(!1);var i=t.giveEventsController({viewer:x.viewer.getViewer()});i&&i.fireEvent("onLeavingR3DApp",{targetApp:e&&e.options?e.options.id:""})}}},Z.prototype.onWillEnter=function(){if(x.viewer&&require("DS/DMUBaseExperience/DMUContextManager")){const e=w.giveDMUSlidesController({context:x.viewer.getFrameWindow()});e&&e.setVisibleFlag(!0)}},Z}));