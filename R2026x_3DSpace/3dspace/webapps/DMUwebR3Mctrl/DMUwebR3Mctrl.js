/*!  Copyright 2021 Dassault Systemes. All rights reserved. */
define("DS/DMUwebR3Mctrl/DMUwebR3MDropManager",["UWA/Core","UWA/Class","DS/Utilities/Dom","css!DS/DMUwebR3Mctrl/assets/css/DMUwebR3Mctrl"],(function(e,t,n){"use strict";return t.extend({init:function(t){this._parent(t);var i={},a={count:0},o=t.onDrop,s=t.openLbl;function r(e){return a.count=0,i.droparea.hide(),e.stopPropagation(),!1}function l(e){return a.count--,0===a.count&&i.droparea.hide(),e.stopPropagation(),!1}function d(e){return n.firstParentWithClass(e.target,"-dropZoneGlobal")&&e.preventDefault(),e.stopPropagation(),!1}function c(e){return a.count<=0&&i.droparea.show(),a.count++,e.stopPropagation(),!1}function u(e){if(a.count=0,i.droparea.hide(),e.stopPropagation(),!e.defaultPrevented){e.preventDefault();let t={mode:"drop",unserializedData:p(e)}.unserializedData.data.items;if(t.length>=1){const e=["Change Action","DMUValidationValidation","DMUMarkupRepReference","SIMItfSimulation","DesignSight","Requirement Specification","Requirement","Document","DIFLayout","DIFSheet","Drawing","VPMReference","VPMRepReference","R2V_Activity","R2V_FeatureOfInterest","FailureModesEffectsAnalysis"];t=t.filter((t=>e.includes(t.objectType)))}t.length>=1&&o(t)}return!1}function p(t){for(var n={data:{items:[]}},i=e.is(t.dataTransfer.types.indexOf,"function")?"indexOf":"contains",a="",o=["text/searchitems","text/plain","Text"],s=0;s<o.length&&""===a;s++){var r=t.dataTransfer.types[i](o[s]);(e.is(r,"number")&&r>=0||e.is(r,"boolean")&&!0===r)&&(a=o[s])}if(""!==a){var l=t.dataTransfer.getData(a);try{n=JSON.parse(l)}catch(e){n={data:{items:[]}}}}return n}this.manageDragAndDrop=function(t){i.container=t,i.container.addEventListener("dragenter",c),i.container.addEventListener("dragover",d),i.container.addEventListener("dragleave",l),i.container.addEventListener("dragend",r),i.container.addEventListener("drop",u);var n=i.droparea=e.createElement("div",{class:"r3mMainView-dropArea"}).inject(i.container);n.hide();for(var a=[{icon:"drag-drop",title:s}],o=0;o<a.length;o++){var p=e.createElement("div",{class:"-dropZoneGlobal ",draggable:!1}),f=e.createElement("div",{class:"-dropZone ",draggable:!1}).inject(p),g=e.createElement("div",{class:"-dropIconAndText "}).inject(f);e.createElement("i",{class:"wux-ui-3ds wux-ui-3ds-4x wux-ui-3ds-"+a[o].icon}).inject(g),e.createElement("h5",{text:a[o].title}).inject(g),p.inject(n)}}}})})),define("DS/DMUwebR3Mctrl/DMUwebR3Mctrl",["UWA/Class","UWA/Core","DS/Controls/ProgressBar","UWA/Utils/InterCom","DS/DMUwebR3Mux/DMUwebR3Mlist","DS/DMUwebR3Mctrl/DMUwebR3MDropManager","DS/ENOXTriptych/js/ENOXTriptych","DS/EditPropWidget/EditPropWidget","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/utils/EditPropUtils","DS/DMUwebR3Mutils/DMUwebR3MserverRequests","DS/DMUwebR3Mutils/DMUwebR3MwidgetUtils","DS/CoreEvents/ModelEvents","DS/PlatformAPI/PlatformAPI","DS/DMUwebR3Mutils/DMUwebR3MCsiServices","UWA/Utils/Client","DS/ApplicationFrame/ActionBar","DS/WebappsUtils/WebappsUtils","i18n!DS/DMUwebR3Mutils/assets/nls/DMUwebR3Mutils.json","i18n!DS/DMUwebR3Mctrl/assets/nls/DMUwebR3Mctrl.json","css!DS/DMUwebR3Mux/assets/css/DMUwebR3Mux"],(function(e,t,n,i,a,o,s,r,l,d,c,u,p,f,g,h,m,v,b,y){"use strict";function w(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function S(e){return new Promise((function(e,t){require("DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices").getPlatformServices({onComplete:function(t){e(t[0]["3DDashboard"])},onFailure:t})})).then((function(t){if(e){e.content.source=u.getWidget().data.appId,e.content.data.items.forEach((function(e){e.contextId=u.getSecurityContext().replace("ctx::","")}));var n=u.getWidget().data.appId;return function(e){var t,n=document.createElement("textarea");if(n.classList.add("bookmark-txt-link"),n.value=e,document.body.appendChild(n),h.Platform&&h.Platform.hasOwnProperty("ios")&&!0===h.Platform.ios){n.contentEditable=!0,n.readOnly=!0;var i=document.createRange();i.selectNodeContents(n);var a=window.getSelection();a.removeAllRanges(),a.addRange(i),n.setSelectionRange(0,n.value.length)}else n.select();try{t=document.execCommand("copy")}catch(e){window.console.log(e)}return document.body.removeChild(n),t?1:0}(t+("#app:"+n+"/content:X3DContentId=")+encodeURIComponent(JSON.stringify(e.content)))}}))}var D=e.extend({init:function(e){let h,D,C,I,j,E,P,O,M=new p,A=e.parent,T={},x={},k=w(),R=0,U=[],L=[],F={all:[],pending:[],completed:[],timeout:[],running:[]},V=[],N=[],_=[],W=[],J=[],q=!1,B=!1,z=[],X=Object.freeze({rvw:1,isr:1,msr:1,mkp:0,owner:0,released:0,obsolete:0,myselection:0,mycreation:0,ownbyme:1,assigntome:1,wherecontribute:1});function H(){return t.extend(t.clone(X,!0),JSON.parse(localStorage.getItem("R3MwebPrefs")||"{}"))}function G(){return localStorage.setItem("R3MwebPrefs",JSON.stringify(O))}O=H();var K={CALabel:"",CATot:0,CAFound:0,nonCATot:0,nonCAFound:0,allDropValObjs:[],openCAs:[],caPropId:-1},$=0,Z=100;function Q(e,t){return e.some((e=>JSON.stringify(e)===JSON.stringify(t)))}function Y(){return new Promise((function(e){var t={onComplete:function(n){for(var i=n.list.length,a=0,o=!1,s=Date.now()-864e5;a<i&&!o;){var r=n.list[a++];let t=""!==r.jobConfiguration?r.jobConfiguration:"8";if(!(1e3*r.startingTime>=s)){o=!0,e(n);break}var l={internalID:r.internalID,status:r.status,startingTime:r.startingTime,completionTime:r.completionTime,isrPrevComputeConfig:t};Q(L,l)||L.push({internalID:r.internalID,status:r.status,startingTime:r.startingTime,completionTime:r.completionTime,isrPrevComputeConfig:t})}o||i<100?e(n):($+=100,g._getIsrJobsListByPage({onComplete:t.onComplete,onFailure:t.onFailure,data:{offset:$,limit:Z}}))},onFailure:function(){e(null)},data:{offset:$,limit:Z}};g._isUpdateSimulationAllowed().then((function(n){q=n,q?($=0,g._getIsrJobsListByPage(t)):e(null)}))}))}function ee(e){function t(e,n){if(n){if(n[e])return 1;if(n.children)return n.children&&n.children[e]?1:Object.keys(n.children).some((i=>t(e,n.children[i])))}}if(T[e])return[e];let n=[];return Object.keys(T).forEach((i=>{t(e,T[i])&&n.push(i)})),n}function te(e){var t=Object.keys(T).length;u.getWidget().setTitle(e?"":0===t?y.noValidObj:y["validObj"+(1===t?"":"s")]+t)}function ne(e){e&&e.id&&(x[e.id]||(x[e.id]=e),Object.keys(e.children||{}).forEach((t=>ne(e.children[t]))))}function ie(e){if(void 0===e.validState)return;if(e.validStateWarning="",c.getIsrTypes().indexOf(e.type)>-1)"InProgress"===e.validState?"donenoko"!==e.analysisState&&"donewithko"!==e.analysisState||(e.validStateWarning=y.itfwarningAnalyzed):"Failed"===e.validState?"notcomputed"===e.analysisState?e.validStateWarning=y.itfwarningNotComputed:"startednoko"===e.analysisState?e.validStateWarning=y.itfwarningNotAnalyzed:"donenoko"===e.analysisState?e.validStateWarning=y.itfwarningNotReported:"computed"===e.analysisState&&(e.validStateWarning=y.itfwarningComputed):"Passed"===e.validState&&("notcomputed"===e.analysisState?e.validStateWarning=y.itfwarningNotComputed:"startednoko"===e.analysisState||"startedwithko"===e.analysisState?e.validStateWarning=y.itfwarningNotAnalyzed:"donewithko"===e.analysisState?e.validStateWarning=y.itfwarningReported:"computed"===e.analysisState&&(e.validStateWarning=y.itfwarningComputed));else{let t=e.children&&e.children[e.id+"_check"];if(t=t&&t.children?Object.keys(t.children).map((e=>x[e])).filter((e=>e)):null,!t||!t.length)return;"InProgress"!==e.validState||t.some((t=>t.validState===e.validState))?"Failed"!==e.validState||t.some((t=>t.validState===e.validState))?"Passed"!==e.validState||t.every((e=>"Passed"===e.validState))||(e.validStateWarning=y.warningpassed):e.validStateWarning=y.warningfailed:e.validStateWarning=y.warninginprogress}}function ae(e,t,n){if(!e||!t)return;let i,a=n||t.issue&&t.issue.length&&t.task&&t.task.length;return["issue","ca","task"].forEach((n=>{if(!t[n]||!t[n].length)return;i=!0;let o=e.children||(e.children={});if(a){let i=e.id+"_"+n;o[i]={id:i,title:y[n+(t[n].length>1?"s":"")],children:{}},o=o[i].children}t[n].forEach((e=>{e.owner&&Array.isArray(e.owner)&&e.owner.length>1&&function(e){return new Promise((function(t){var n=u.get3DSpaceUrl()+"/resources/modeler/pno/person/"+e,i={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:u.getSecurityContext()},onComplete:function(e){var n,i=JSON.parse(e);n=i.firstname+" "+i.lastname,t(n)},onFailure:function(){t()}};require("DS/WAFData/WAFData").authenticatedRequest(n,i)}))}(e.ownerid).then((function(t){e.owner=t})),o[e.id]=e})),delete t[n]})),!n&&a&&(e.noSort=!0),i}function oe(e,t){return new Promise((function(n){e&&e.length>0?require("DS/WAFData/WAFData").authenticatedRequest(u.get3DSpaceUrl()+"/resources/validation/service/getValidationsFromObjectsIds?tenant="+u.getPlatformId(),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:u.getSecurityContext()},data:JSON.stringify({listHighlights:t?e:[],listValidations:t?[]:e}),timeout:6e4,onComplete:function(e){let t=JSON.parse(e);n(t)},onFailure:function(){n()},onTimeout:function(){n()}}):n()}))}function se(e){const t=e.match(/(\d{4})\/(\d{2})\/(\d{2})@(\d{2}):(\d{2}):(\d{2}):GMT/);if(t){const e=t[1],n=t[2],i=t[3],a=t[4],o=t[5],s=t[6];return new Date(`${e}-${n}-${i}T${a}:${o}:${s}Z`)}return e}function re(e){var t,n=[],i=[],a=[],o=[],s=[],r=c.getRvwTypes(),l=c.getIsrTypes(),d=c.getMkpTypes(),u=c.getMsrTypes(),p=c.getNewMkpTypes();Object.keys(e).forEach((function(e){t=this[e].type,r.indexOf(t)>-1?n.push(e):l.indexOf(t)>-1?i.push(e):d.indexOf(t)>-1?a.push(e):p.indexOf(t)>-1?o.push(e):u.indexOf(t)>-1&&s.push(e)}),e);var f={rvwIds:n,isrIds:i,mkpIds:a,newMkpIds:o,msrIds:s};c.navigate(f).then((function(e){var t={};[0,1,2,3,4].forEach((function(e){Object.keys(this[e]).forEach((function(e){let n=T[e];if(!n)return void window.console.log("id: "+e+" not in validated objects list");let i=["validated","check","members","highlight","issue","ca","task"].some((t=>this[e][t]&&this[e][t].length));["context","validated","check","members","highlight"].forEach((function(t){if(!this[t]||!this[t].length)return;"context"===t&&(this[t]=this[t].filter((e=>"Specification Report"!==e.type)));let a=n.children||(n.children={});if(i){let i=e+"_"+t;if(a[i]={id:i,title:y[t+(this[t].length>1?"s":"")],children:{}},"validated"===t&&(a[i].validatedPath=this.validatedPath),"members"===t){n.reviewContriDisplay=function(e){var t=[];e.forEach((e=>{Object.keys(e).forEach((function(n){"contributors"!==n&&"assignees"!==n||(t=0===t.length?Array.from(e[n]):t.concat(e[n]))}))}));var n=t.map((function(e){return e.contribution})).reduce(((e,t)=>(e[t]=e[t]+1||1,e)),{});return n.OnGoing||n.NotStarted&&n.Completed?"OnGoing":n.NotStarted?"NotStarted":n.Completed?"Completed":void 0}(this[t]);var o=[];this[t].forEach((function(t){Object.keys(t).forEach((n=>{var i={};let a=e+"_"+n;t[n].forEach((function(e){var t="";"assignees"!==n&&"contributors"!==n||(t=e.contribution),i[a+"_"+e.user]={id:a+"_"+e.user,title:e.fullName,fullName:e.fullName,type:"person",name:e.user,reviewContriDisplay:t}})),o.push({id:a,title:y[n]+" ("+t[n].length+")",children:i,icons:[{iconName:"user"}]}),delete t[n]}))})),this[t]=o}"highlight"===t&&this[t].forEach((e=>ae(e,e,!1))),"check"===t&&this[t].forEach((function(e){e.children&&e.children.length>=1&&(e.children=e.children.reduce(((e,t)=>(e[t.id]=t,e)),{}))})),a=a[i].children}this[t].forEach((function(e){a[e.id]=T[e.id]||e})),delete this[t]}),this[e]),ae(n,this[e],!0),ne(n),ie(n),i&&(n.noSort=!0),t[e]=n}),this[e])}),e),D.updateValidations(t)}))}function le(e){var n;if(e||(e="showLoadingLoop"),E&&E.dialog&&E.dialog.destroy(),E=null,P&&P.clean(),P=null,U&&U.forEach((e=>e.cancel())),U=[],u.perfoMark("refreshGrid_"+ ++R),"showLoadingLoop"===e){n=t.createElement("div",{class:"r3mLoadingValidations mask wux-datagridview-emptycontentmessage"}).inject(A);const e=t.createElement("div",{class:"spinner spinner-lg spinning fade in",styles:{display:"flex","justify-content":"center"}}).inject(n);t.createElement("span",{class:"spinner-bar"}).inject(e),t.createElement("span",{class:"spinner-bar spinner-bar1"}).inject(e),t.createElement("span",{class:"spinner-bar spinner-bar2"}).inject(e),t.createElement("span",{class:"spinner-bar spinner-bar3"}).inject(e),t.createElement("div",{class:"r3mWelcomeText",html:y.validationLoad,styles:{}}).inject(n)}te(!0),T={},x={},_=[],W=[],J=[],F={all:[],pending:[],completed:[],timeout:[],running:[]},V=[],N=[],L=[];var i=u.getWidget();let a={isCaToRvwFound:!1,caLbl:void 0,status:"",caLen:0,valFndLen:0},o=JSON.parse(localStorage.getItem("r3mDataLoadFromDrop")||"{}");if(o&&o.isCaToRvwFound&&(a.isCaToRvwFound=o.isCaToRvwFound),o&&o.caLen&&(a.caLen=o.caLen),o&&o.valFndLen&&(a.valFndLen=o.valFndLen),a&&(a.caLbl=o&&o.caLbl?o.caLbl:void 0),o&&o.valFndLen&&0===o.valFndLen.length)return a.status&&D.updateFilterSelectionLabel("notstarted",0,a.caLbl),void("showLoadingLoop"===e&&n.destroy());var s=o&&o.data?o.data:u.getDatafromContent(),r={};1===O.mycreation?r=Object.freeze({rvw:0,isr:0,msr:0,mkp:0,obsolete:0,released:0}):(0!==Object.keys(s).length&&i.data&&!i.data.loadDataFromCopiedLink||0!==Object.keys(s).length&&1===O.myselection)&&(r=Object.freeze({rvw:1,isr:1,msr:1,mkp:1,obsolete:1,released:1}));var l,d={},p=[];if(1===O.mycreation&&s&&s.obj){var f={};s.obj.forEach((function(e){f[e.objectId]={id:e.objectId,type:"DMUValidationValidation"}})),p.push((l=f,new Promise((e=>{var t={};const n=[];Object.keys(l).map((e=>{let t={};t.input_object={"ds6w:type":"DMUValidationValidation",physicalid:e},n.push(c.getReviewInfo(t))})),Promise.all(n).then((function(n){var i={},a={},o={},s={ids:[],uris:[]},r=[];function l(e,t,n){return{id:e,title:a[e]?a[e]["ds6w:label"]:t,type:a[e]?a[e]["ds6w:type"]:n,typeDisp:c.getValuesNls("ds6w:type",a[e]?a[e]["ds6w:type"]:n),name:a[e]?a[e]["ds6w:identifier"]:"",owner:a[e]?a[e]["ds6w:responsible"]:"",icon:a[e]&&(a[e].type_icon_url||a[e]["ds6w:icon"])||"",organization:a[e]?a[e]["ds6w:organizationResponsible"]:"",organizationDisp:c.getValuesNls("ds6w:organizationResponsible",a[e]?a[e]["ds6w:organizationResponsible"]:""),dateModif:a[e]?a[e]["ds6w:modified"]:"",dateCreat:a[e]?a[e]["ds6w:created"]:"",collabSpace:a[e]?a[e]["ds6w:project"]:"",ownerid:a[e]?a[e]["ds6w:responsibleuid"]:"",maturity:a[e]?a[e]["ds6w:status"]:"",maturityDisp:c.getValuesNls("ds6w:status",a[e]?a[e]["ds6w:status"]:"")}}n.forEach((function(e){e&&(r.push(e.id),e.owner&&!i[e.owner]&&(i[e.owner]={name:""}),e.members&&(Object.keys(e.members)||[]).forEach((e=>{i[e]||(i[e]={name:""})})),e.children&&e.children.forEach((e=>{e&&e.contexts?e.contexts.forEach((e=>{a[e.id]||(a[e.id]={}),s.ids.push(e.id)})):e&&e.contextURI?(a[e.contextURI]||(a[e.contextURI]={}),s.uris.push(e.contextURI)):e&&e.validatedObjects&&e.validatedObjects.forEach((e=>{if(e.PathElements&&e.PathElements.length>0){let t=e.PathElements[e.PathElements.length-1];a[t]||(a[t]={}),s.ids.push(t)}})),"DMUValidationCheck"!==e.type&&"DMUValidationExposedPresentation"!==e.type||(a[e.id]||(a[e.id]={}),s.ids.push(e.id),(e.children||[]).forEach((e=>{a[e.id]||(a[e.id]={}),s.ids.push(e.id)})))})))}));const d=c.getReviewAttributes(r),u=c.fetchContext(s,(function(e){if(e){var t=JSON.parse(e);"r2vsurvey"===t.serviceId?(t.data||[]).forEach((e=>{var t=e["ds6w:i3dx"];a[t]||(a[t]={}),Object.entries(e).forEach((([e,n])=>{a[t][e]=n}))})):(t.results||[]).forEach((e=>{if(e.attributes&&e.attributes.length>0&&"resourceid"===e.attributes[0].name){var t=e.attributes[0].value;e.attributes.forEach((function(e){a[t][e.name]=e.value}))}}))}}));Promise.all([d,u]).then((function(a){a[0]&&a[0].results&&a[0].results.forEach((function(e){var t=["","","","",""];e.basicData.forEach((function(e){["organization","originated","modified","project"].forEach((function(n,i){n===e.name&&e.value&&1===e.value.length&&(t[i]=e.value[0])}))})),e.data.forEach((function(n){"V_description"===n.name&&n.value&&1===n.value.length&&(t[4]=e.data[1].value[0])})),o[e.physicalID]={organization:t[0],dateCreat:t[1],dateModif:t[2],collabSpace:t[3],description:t[4]}}));var s=0;const r=[];(Object.keys(i)||[]).forEach((e=>{r.push(new Promise((function(t){c.getUserInfo(e).then((function(n){n&&(i[e].name=n.firstname+" "+n.lastname),t()}))})))})),Promise.all(r).then((function(){n.forEach((function(e){if(e){var n={};n.id=e.id,n.title=e.name,n.name=e.name,n.type=e.type,n.maturity="VPLM_SMB_Evaluation_MajorRev."+e.currentState;var a=c.getValuesNls("ds6w:status",n.maturity);n.maturityDisp=a||n.maturity,n.validState=e.status,n.validStateDisp=b["validState"+e.status],n.restrictedEdition=e.restrictedEdition,n.restrictedEditionDisp=e.restrictedEdition,n.ownerid=e.owner,n.owner=i[e.owner]&&i[e.owner].name?i[e.owner].name:e.owner,o[e.id]&&(n.organization=o[e.id].organization,n.organizationDisp=o[e.id].organization,n.dateCreat=o[e.id].dateCreat,n.dateCreat=se(n.dateCreat),n.dateModif=o[e.id].dateModif,n.dateModif=se(n.dateModif),n.collabSpace=o[e.id].collabSpace,n.description=o[e.id].description),n.icon=v.getWebappsAssetUrl("TagNavigator","icons/type_icon/")+"I_VALValidation.png",n.analysisState="unknown",n.analysisStateDisp="",n.analysisStateNbKO=0,n.analysisStateProgress=0,n.r3massignees="",n.ownerImg=c.getUserImage(n.ownerid),n.children={};var r={},d={},u={},p={},f=!1,g=0,h=0;if((e.children||[]).forEach((e=>{"DMUValidationContext"===e.type&&(e.contexts?(e.contexts||[]).forEach((e=>{f=!0,r[e.id]=l(e.id,e.name,e.type)})):e.contextURI&&(f=!0,r[e.contextURI]=l(e.contextURI))),"DMUValidationValidated"===e.type&&e.validatedObjects&&(e.validatedObjects||[]).forEach((e=>{if(e.PathElements&&e.PathElements.length>0){s++;let t=e.PathElements[e.PathElements.length-1];d[s]=l(t,e.referenceName,e.referenceType),d[s].pid=d[s].id,d[s].id=s}else if(e.uri){s++;let t=e.uri;d[s]=l(t)}})),"DMUValidationCheck"===e.type&&e.id&&(g++,u[e.id]=l(e.id,e.name,"DMUValidationCheck"),u[e.id].children=[],(e.children||[]).forEach((t=>{u[e.id].children.push(l(t.id,"",""))}))),"DMUValidationExposedPresentation"===e.type&&e.id&&(h++,p[e.id]=l(e.id,e.name,"DMUValidationExposedPresentation"),p[e.id].children=[])})),f){let t=e.id+"_context";n.children[t]={id:t,title:"Context",children:r}}if(s>0){let t=e.id+"_validated";n.children[t]={id:t,title:"Validated Object",children:d}}if(g>0){let t=e.id+"_check";n.children[t]={id:t,title:"Check",children:u}}if(e.members){let t={owner:"owner",coordinator:"coordinators",assignee:"assignees",contributor:"contributors",informeduser:"informeduser"};var m={},w=0,S=0,D=0;["owner","coordinators","assignees","contributors","informeduser"].forEach((function(e){m[e]={}})),Object.keys(e.members?e.members:{}).forEach((n=>{var a=e.members[n],o=i[n]&&i[n].name?i[n].name:n;a.roles.forEach((i=>{let s=t[i],r=e.id+"_"+s,l="";"assignees"!==s&&"contributors"!==s||(l=a.contribution,w++,"NotStarted"===l?S++:"Completed"===l&&D++),m[s][r+"_"+n]={id:r+"_"+n,title:o,fullName:o,type:"person",name:n,reviewContriDisplay:l}}))}));let a=e.id+"_owner_"+n.ownerid;m.owner[a]={id:a,title:n.owner,fullName:n.owner,type:"person",name:n.ownerid};let o=[];if(["owner","coordinators","assignees","contributors","informeduser"].forEach((function(t){let n=Object.keys(m[t]).length;a=e.id+"_"+t,o.push({id:a,title:y[t]+" ("+n+")",children:m[t],icons:[{iconName:"user"}]})})),o.length>0){let t={};o.forEach((function(e){t[e.id]=e}));let i=e.id+"_members";n.children[i]={id:i,title:y["member"+(o.length>1?"s":"")],children:t}}0===w||(n.reviewContriDisplay=w===S?"NotStarted":w===D?"Completed":"OnGoing")}if(h>0){let t=e.id+"_highlight";n.children[t]={id:t,title:"Highlight",children:p}}n.noSort=!0,n.id&&(t[n.id]=n)}})),e(t)}))}))}))}))))}Promise.all(p).then((function(t){var l,p;t&&1===t.length&&(Object.keys(t[0])||[]).forEach((e=>{d[e]=t[0][e],ne(t[0][e])})),(l=0!==Object.keys(r).length?r:O,p={},l.myselection||l.owner||!l.assigntome&&!l.wherecontribute?Promise.resolve(p):new Promise((function(e){const t={...l,isOnlyRvw:!0};c.search(t,(function(t){0===Object.keys(t).length&&(Object.keys(p).length>0?oe(Object.keys(p),!1).then((t=>{if(t&&t.validations&&t.validations.length>0){var n=u.getUserLogin();const i=t.validations.filter((e=>e.members&&e.members[n]&&e.members[n].roles&&(e.members[n].roles.includes("contributor")&&l.wherecontribute||e.members[n].roles.includes("assignee")&&l.assigntome))),a=Object.keys(p).filter((e=>i.some((t=>t.id===e)))).reduce(((e,t)=>(e[t]=p[t],e)),{});e(a)}})):e(p)),p=Object.assign(p,t)}))}))).then((function(t){const l=c.search(0!==Object.keys(r).length?r:O,(function(r,c){x=Object.assign(x,r);var p={},f=[],g=[];0===c&&(D.removeAll(),p=d,t&&(x=Object.assign(x,t),T=Object.assign(T,t),r=Object.assign(r,t))),s&&0===Object.keys(s).length?localStorage.removeItem("R3MFromCopylink"):s.obj&&Array.isArray(s.obj)&&s.obj.forEach((function(e){e.objectType&&"DMUValidationExposedPresentation"===e.objectType&&f.push(e.objectId)})),Y().then((function(){oe(f).then((t=>{var c=[];(0!==Object.keys(s).length&&i.data&&!i.data.loadDataFromCopiedLink||1===O.myselection)&&(O=H(),i.data.loadDataFromCopiedLink=!0,O.myselection=1,G(),t&&t.validations&&t.validations.length>0&&t.validations.forEach((function(e){r.hasOwnProperty(e.id)&&(g[e.id]=p[e.id]=r[e.id],c.push(e.id))})),s.obj&&s.obj.length>0&&s.obj.forEach((function(e){(!d||d&&!d[e.objectId])&&r.hasOwnProperty(e.objectId)&&(p[e.objectId]=r[e.objectId],c.push(e.objectId))})),localStorage.setItem("R3MFromCopylink",1)),T=p&&0===Object.keys(p).length?Object.assign(T,r):p,localStorage.setItem("r3mValidationObjects",JSON.stringify(T)),D.updateValidations(p&&0===Object.keys(p).length?r:p),D.checkFilterAndFetchValue(),0===O.mycreation&&re(p&&0===Object.keys(p).length?r:p),te(),D.expanReviewNode(g,t);let f=Object.keys(T),h=0,m=0,v=0,b=0;a.isCaToRvwFound&&f.forEach((function(e){let t=T[e];"DMUValidationValidation"===t.type&&(h+=1,"InProgress"===t.validState?m+=1:"Failed"===t.validState?v+=1:"Passed"===t.validState&&(b+=1))})),o&&o.caLen&&(a.caLen=o.caLen),o&&o.valFndLen&&(a.valFndLen=o.valFndLen),a.isCaToRvwFound&&o.caLen>=1&&0===a.valFndLen?D.updateFilterSelectionLabel("notstarted",0,a.caLbl):a.isCaToRvwFound&&(a.valFndLen!==o.caLen?D.updateFilterSelectionLabel("partial",v>0?v:0,a.caLbl):b===h?D.updateFilterSelectionLabel("passed",0,a.caLbl):m>0?D.updateFilterSelectionLabel("inProgress",v>0?v:0,a.caLbl):v>0&&D.updateFilterSelectionLabel("failed",v>0?v:0,a.caLbl)),l.promise.finally(function(){if("showLoadingLoop"===e)n.destroy();else if("deleteCreationLoop"===e){let e=document.getElementsByClassName("r3mLoadingValidations mask wux-datagridview-emptycontentmessage");e&&e.length>0&&e[0].destroy()}u.perfoMeasure("refreshGrid_"+this)}.bind(R)),U.push(l)}))}))}),(function(){if("showLoadingLoop"===e)n.destroy();else if("deleteCreationLoop"===e){let e=document.getElementsByClassName("r3mLoadingValidations mask wux-datagridview-emptycontentmessage");e&&e.length>0&&e[0].destroy()}}))}))}))}function de(e,t){function n(e,t){return e.some((function(e){return t.length===e.length&&e.every((function(e,n){return e===t[n]}))}))}D.getSelectedRows().forEach((function(i){if(!i||!i.id||!x[i.id])return void window.console.error("Unidentified object");let a;a=i.id.search("_")>-1?Object.values(x[i.id].children):[x[i.id]],a.forEach((function(i){var a;if(i.validatedPath&&i.validatedPath.length>2)a=i.validatedPath.map((function(e){return t[e.pid]||(t[e.pid]={type:e.type}),e.pid})),n(e,a)||e.push(a);else{const o=i.i3dx||i.pid||i.id;t[o]||(t[o]={type:i.type}),n(e,a=[o])||e.push(a)}}))}))}function ce(e,t,n){t.forEach((function(t){e.push({envId:u.getPlatformId(),serviceId:"3DSpace",contextId:u.getSecurityContext(),objectId:t[t.length-1],objectType:n[t[t.length-1]].type,path:t.length>2?t.map((function(e){return{resourceid:e,type:n[e]?n[e].type:void 0}})):void 0})}))}function ue(e,t){var n={protocol:"3DXContent",version:"1.0",source:u.getWidgetAppId(),data:{items:[]}};return ce(n.data.items,e,t),n}function pe(e){var t,n=[],a={};if(de(n,a),0===n.length&&0===K.openCAs.length){let e=JSON.parse(localStorage.getItem("r3mDataLoadFromDrop")||"{}");e&&e.openCAs&&(K.openCAs=e.openCAs)}let o=!1;if(0===n.length&&K.openCAs.length>0?(1===K.openCAs.length&&C.options.actions.length>1?ze(!0):K.openCAs.length>1&&1===C.options.actions.length&&ze(!1),K.openCAs.forEach((function(e){n.push([e.id]),a[e.id]={type:e.type}})),o=!0):(K.caPropId=-1,C.options.actions.length>1&&ze(!0)),o&&K.caPropId>=0){let e=n[K.openCAs.length>1?K.caPropId:0];n=n.filter((t=>JSON.stringify(t)===JSON.stringify(e)))}if(t=n.map((function(e){var t=e[e.length-1],n=a[t].type,i={getID:function(){return t},tenant:u.getPlatformId(),type:n};return"R2V_Activity"===n&&(i.getI3DX=function(){return t}),e.length>2&&(i.getRelationID=function(){return e[e.length-2]}),d.getModelFromSelectedNode(i)})),h.getRightOpen()&&C.initDatas(t),!e){var s={version:"1.1",paths:n,attributes:a,tenant:u.getPlatformId()},r={uid:w(),originUid:k,timestamp:Date.now(),appid:u.getWidgetAppId(),originWidgetId:u.getWidgetId()};f.publish("DS/PADUtils/PADCommandProxy/select",{data:s,metadata:r}),I||(j=u.getWidgetAppId()+"_CompassSocket_"+u.getWidgetId(),I=new i.Socket(j),I.subscribeServer("com.ds.compass",window.parent)),n.length?I.dispatchEvent("onSetX3DContent",ue(n,a),j):I.dispatchEvent("onResetX3DContent",{},j)}}function fe(){pe()}function ge(){pe()}function he(e){var t;["rvw","isr","mkp","msr","owner","released","obsolete","myselection","mycreation","ownbyme","assigntome","wherecontribute"].forEach((function(n){e[n]!==O[n]&&(t=!0,O[n]=e[n])})),t&&(Xe(),le(),G())}function me(){return new Promise((function(e){if(B)return e();new m({file:"ENOR3MHeaders.xml",module:"DMUwebR3Mutils",context:"Default"}).onActionBarReady((function(){B=!0,e()}))}))}function ve(){let e=[];z.forEach((t=>{e.push(...t.paths)}));let n=e.map((function(e){return e.objectId})),i=e.filter(((e,t)=>n.indexOf(e.objectId)===t));me().then((function(){require(["DS/ApplicationFrame/CommandsManager"],(function(e){if(e){let n=e.getCommand("DMUReviewHdr","Default");n.initCommandParamters({objects:i,platformUtils:u,onCommandEnded:function(e){if(e&&e.validations){var t=[];let i=[];if((e.validations||[]).forEach((e=>{i.push({objectId:e.pId,serviceId:"3DSpace",objectType:"DMUValidationValidation",displayName:e.validationName})})),e.CA){var n={ids:[e.CA],uris:[]};t.push(c.fetchContext(n,(function(t){if(t){var n=JSON.parse(t);if(n.results&&1===n.results.length&&n.results[0].attributes){let t=n.results[0].attributes.find((e=>"ds6w:label"===e.name)),a=n.results[0].attributes.find((e=>"ds6w:type"===e.name));i.push({objectId:e.CA,serviceId:"3DSpace",objectType:a?a.value:"Change Action",displayName:t?t.value:"Change Action"})}}})))}Promise.all(t).then((function(){He(i,!0),O.myselection=1,O.mycreation=1,G()}))}},startLoadingUI:function(){const e=t.createElement("div",{class:"r3mLoadingValidations mask wux-datagridview-emptycontentmessage"}).inject(A),n=t.createElement("div",{class:"spinner spinner-lg spinning fade in",styles:{display:"flex","justify-content":"center"}}).inject(e);t.createElement("span",{class:"spinner-bar"}).inject(n),t.createElement("span",{class:"spinner-bar spinner-bar1"}).inject(n),t.createElement("span",{class:"spinner-bar spinner-bar2"}).inject(n),t.createElement("span",{class:"spinner-bar spinner-bar3"}).inject(n),t.createElement("div",{class:"r3mWelcomeText",html:y.validationCreation,styles:{}}).inject(e)},startCheckingSelUI:function(){const e=t.createElement("div",{class:"r3mLoadingValidations mask wux-datagridview-emptycontentmessage"}).inject(A),n=t.createElement("div",{class:"spinner spinner-lg spinning fade in",styles:{display:"flex","justify-content":"center"}}).inject(e);t.createElement("span",{class:"spinner-bar"}).inject(n),t.createElement("span",{class:"spinner-bar spinner-bar1"}).inject(n),t.createElement("span",{class:"spinner-bar spinner-bar2"}).inject(n),t.createElement("span",{class:"spinner-bar spinner-bar3"}).inject(n),t.createElement("div",{class:"r3mWelcomeText",html:y.checkingSelections,styles:{}}).inject(e)},endCheckingSelUI:function(){let e=document.getElementsByClassName("r3mLoadingValidations mask wux-datagridview-emptycontentmessage");e&&e.length>0&&e[0].destroy()}}),n.begin()}}))}))}function be(){me().then((function(){window.widget.setValue("appId","ENOR3M_AP"),require(["DS/ApplicationFrame/CommandsManager"],(function(e){e&&e.getCommand("CATWebUXPreferencesHdr","Default").begin()}))}))}function ye(){var e=h.getRightOpen();M.publish({event:e?"triptych-hide-panel":"triptych-show-panel",data:"right"}),D.setInfoState(!e),e||pe(!0)}function we(){var e=[],t={};return de(e,t),e.filter((e=>!(e&&1===e.length&&t[e[0]]&&"DMUValidationCheck"===t[e[0]].type)))}function Se(){let e=D.getSelectedRows(),t=[];return e.length&&1===e.length&&e.forEach((e=>{var n;if(e.parents&&e.parents.length>0&&e.parents[0].contains("_highlight"))n=e.parents[1]?e.parents[1]:"";else{let t=T[e.id];n=t&&-1!==c.getRvwTypes().concat(c.getIsrTypes().concat(c.getMkpTypes()).concat(c.getNewMkpTypes()).concat(c.getMsrTypes())).indexOf(t.type)&&t.id}n&&t.push({physicalid:n,tenant:u.getPlatformId()})})),t}function De(){let e,t,n,i,a,o=D.getSelectedRows(),s=[],r=[];o.length&&o.forEach((o=>{let l=T[o.id];var d;e=t=l.title,i=l.pid||l.id,a=l.type,n=l.description?l.description:"",l.thumbnail_image&&l.thumbnail_image.indexOf("dos/webservices")>=0&&window&&"OnPremise"!==window.widget.getValue("x3dPlatformId")?s.push((d=l.thumbnail_image,new Promise((function(e){c.getDOSDownloadUrl(d,(function(t){e({downloadedUrl:t,imageurl:d})}))})))):r.push({downloadedUrl:l.icon,imageurl:l.icon})})),me().then((function(){require(["DS/ApplicationFrame/CommandsManager"],(function(o){if(o){let l=o.getCommand("DMUPublishToSwymCmdHdr","Default");Promise.all(s).then((function(o){var s;r.push(o[0]),Promise.all([(s=r[0],new Promise((function(e){let t=s.imageurl.indexOf("dos/webservices")>=0;require("DS/WAFData/WAFData").authenticatedRequest(s.downloadedUrl,{proxy:"none",type:"blob",timeout:6e4,onComplete:function(n){var i=new FileReader;i.onload=function(){const n=new Image;n.src=i.result,n.onload=function(){const i=document.createElement("canvas");let a=t?1:8,o=n.width,s=n.height;i.width=o*a*2,i.height=s;const r=i.getContext("2d");a=1;const l=(i.width-o*a)/2,d=(i.height-s*a)/2;r.imageSmoothingEnabled=!1,r.drawImage(n,l,d,o*a,s*a);const c=i.toDataURL("image/png");e(c)}},i.readAsDataURL(n)},onFailure:function(){e(null)},onTimeout:function(){e(null)}})})))]).then((function(o){l.initCommandParamters({titleName:e,contentTitle:t,contentDescription:n,mode:"automatic",objectId:i,envId:u.getPlatformId(),contextId:u.getSecurityContext().replace("ctx::",""),objectType:a,base64image:o[0]}),l.begin()}))}))}}))}))}function Ce(){var e={protocol:"3DXContent",version:"1.1",data:{items:[]},source:u.getWidgetAppId(),widgetId:u.getWidgetId()},t=[],n={};de(t,n),ce(e.data.items,t,n);var i=S({content:e});require(["DS/PADUtils/views/PADAlert"].concat([]),(function(e){i?e.displayNotification({msg:y.replace(y.copyLinkSuccess,{label:x[t[0]].title}).replace(/"/g,"'"),eventID:"success"}):e.displayNotification({msg:y.copyLinkError,eventID:"error"})}))}function Ie(){var e=t.Promise.deferred();return g._getMaxTokensForIsrCompute({onComplete:function(t){e.resolve(t)},onFailure:function(){e.resolve()}}),e.promise}function je(){var e=t.Promise.deferred();if(!q)return 0;let n=0,i=D.getSelectedRows();if(i.length){let t=[];i.forEach((e=>{var n;let i=T[e.id];(n=i&&-1!==c.getIsrTypes().indexOf(i.type)&&i.id)&&t.push(n)})),t.length>=1&&t.length===i.length?(n=1,Y().then((function(){(function(e){var t=[];return e.forEach((e=>{let n=L.filter((t=>t.internalID===e));if(n.length>=1){let i=n.reduce(((e,t)=>e&&e.startingTime>t.startingTime?e:t));t.push({id:e,status:i.status})}else t.push({id:e,status:"succeeded"})})),t})(t).filter((e=>"running"===e.status||"pending"===e.status)).length>=1&&(n=2),e.resolve(n)}))):e.resolve(n)}return e.promise}function Ee(e,t,n,i){e.analysisState=t,e.analysisStateDisp=c.getAnalysisStateNlsValue(t),e.analysisStateNbKO=n;let a={};ie(e),a[e.id]=e,D.updateValidations(a,i)}function Pe(e){var n=[];if(de(n,{}),n.length){var i=y.computeIsrNotifPrefix?y.computeIsrNotifPrefix:"Compute Interference Simulation: ",a="",o="R3M",s=0;n.forEach((r=>{n.length>1&&(o="R3M "+s.toString(),s++);var l=T[r[0]]&&T[r[0]].title?T[r[0]].title:"";a=i+l,function(e){var n=t.Promise.deferred();return g._isUpdateSimulationAllowed().then((function(t){if(t){var i=new Promise((function(t){var n=null;c.navigateFromIsrToContext({isrID:e.isrID}).then((function(e){e.result.length>0&&e.result[0].output&&e.result[0].output.prd&&e.result[0].output.prd.physicalid&&(n=e.result[0].output.prd.physicalid,c.getR3MRootStats({rootPhID:n}).then((function(e){e&&e.results&&e.results.length>=2&&e.results[1].synthesis&&e.results[1].synthesis.value&&t(e.results[1].synthesis.value)})))}))}));g._get3DSpaceUrlAndLoginTicket().then((function(){var t=!1,a=!1;g._readComputeIsrPrefs().then((function(o){o.repositories.forEach((function(e){"PIMwebPref"===e.name&&e.preferences.forEach((function(e){"IDLinksAutomaticReroot"===e.name?t="true"===e.value:"IDTrackPreviousAnalysisStatus"===e.name&&(a="true"===e.value)}))}));var s=localStorage.getItem("PIMCSIInputI3S")?localStorage.getItem("PIMCSIInputI3S"):"",r=e.app,l=e.isrID+"_"+Date.now().toString()+".txt",d=new Date,c=("0"+d.getUTCDate()).substr(-2)+"/"+("0"+(d.getUTCMonth()+1)).substr(-2)+"/"+("0"+d.getUTCFullYear()).substr(-4)+" "+("0"+d.getUTCHours()).substr(-2)+":"+("0"+d.getUTCMinutes()).substr(-2)+":"+("0"+d.getUTCSeconds()).substr(-2),p={version:1,type:"Parameters",content:{sSecurityCtxt:{type:"string",value:u.getSecurityContext()},sIsrObjId:{type:"string",value:e.isrID},sWApp:{type:"string",value:r},sDbgVal:{type:"string",value:s},bReroot:{type:"bool",value:t},bTrackStat:{type:"bool",value:a},jobConfiguration:{type:"int32",value:parseInt(e.isrJobConfig)},sReportName:{type:"string",value:l},sSubmitDate:{type:"string",value:c}}},f={data:{items:[{objectId:e.isrID,objectType:"SIMItfSimulation"}]}};f.source=window.widget&&window.widget.getValue("x3dAppId")?window.widget.getValue("x3dAppId"):"ENOI3S_AP",f.widgetId=window.widget?window.widget.id:void 0,f.data.items[0].envId=u.getPlatformId(),f.data.items[0].serviceId="3DSpace",f.data.items[0].contextId=u.getSecurityContext().replace("ctx::",""),f="content:X3DContentId="+encodeURIComponent(JSON.stringify(f));var h={data:{title:e.title,internalID:e.isrID,inputs:JSON.stringify(p),jobConfiguration:e.isrJobConfig,reportName:l,app:{appContent:f}},onComplete:function(e){var t={data:{jobID:e.jobID},onComplete:function(e){n.resolve({jobStatus:e.jobStatus})},onFailure:function(){n.reject({jobStatus:"failed"})}};g._getComputeIsrJobStatus(t)},onFailure:function(e){n.reject(e)}};g._computeIsr(h),u.sendUsageProbe({eventAction:"ComputeIsr",eventLabel:"sWApp",eventValue:r}),u.sendUsageProbe({eventAction:"ComputeIsr",eventLabel:"jobConfiguration",eventValue:e.isrJobConfig}),u.sendUsageProbe({eventAction:"ComputeIsr",eventLabel:"LinksAutomaticReroot",eventValue:!0===t?"true":"false"}),u.sendUsageProbe({eventAction:"ComputeIsr",eventLabel:"TrackPreviousAnalysisStatus",eventValue:!0===a?"true":"false"}),i.then((function(e){u.sendUsageProbe({eventAction:"ComputeIsr",eventLabel:"nbParts",eventValue:e})}))}))}))}else n.reject("KO")})),n.promise}({isrID:r[0],title:a,app:o,platformId:u.getPlatformId(),isrJobConfig:e.isrJobConfig}).then((function(e){let t=T[r[0]];t&&(L.push({internalID:r[0],status:e.jobStatus,startingTime:Math.floor(Date.now()/1e3)}),Ee(t,"running"===e.jobStatus?"Running":"pending"===e.jobStatus?"Queued":e.jobStatus,0))}))}))}}function Oe(){var e="8";let t=D.getSelectedRows();if(!t.length)return e;var n=[];return t.length&&t.forEach((e=>{let t=T[e.id],i=L.filter((e=>e.internalID===t.id&&"succeeded"===e.status));if(i.length>=1){var a=i.reduce(((e,t)=>e&&e.startingTime>t.startingTime?e:t));n.push({id:a.internalID,prevConfig:a.isrPrevComputeConfig})}})),n.forEach((t=>{e<t.prevConfig&&(e=t.prevConfig)})),e}function Me(){require(["DS/TransientWidget/TransientWidget"].concat([]),(function(e){var t=[],n={};de(t,n),e.showWidget("ENORIPE_AP","",{X3DContentId:JSON.stringify(ue(t,n))},{mode:"panel",width:700,height:800})}))}function Ae(){let e=D.getSelectedRows();if(!e.length)return;let t=[];return e.forEach((e=>{let n=T[e.id],i=n&&-1!==c.getRvwTypes().concat(c.getIsrTypes()).indexOf(n.type)&&n.id;i&&t.push({physicalid:i,tenant:u.getPlatformId()})})),t}function Te(){require(["DS/MaturityWidget/MaturityWidget"].concat([]),(function(e){E&&E.dialog&&E.dialog.destroy(),E=new e({externalSettings:u.getPlatformIdServices()}),E.addEvent("onMaturityCanceled",(()=>{E=null})),E.addEvent("onMaturityTransitionEnd",(e=>{if(!e||!e.data)return;let t={},n=[];e.data.forEach((e=>{let i=T[e.physicalid];if(!i)return;i.maturityDisp=c.getMaturityNlsValue(i.maturity="VPLM_SMB_Evaluation."+e.tostate);let a=e.tostate.toLowerCase();"released"===a&&!O.released||"obsolete"===a&&!O.obsolete?n.push(e.physicalid):t[e.physicalid]=i})),f.publish("DS/DMUwebR3Mctrl/R3MObjectModified",{modified:"maturity",data:T}),localStorage.setItem("r3mValidationObjects",JSON.stringify(T)),D.updateValidations(t),D.removeValidation(n)})),E.executeCmd(Ae(),{context:{getSecurityContext:()=>({SecurityContext:u.getSecurityContext()})}},(()=>{}))}))}function xe(e){c.getR2VActivityInfo(e).then((t=>{let n=T[e.validatedObjId];if(n.children[e.text]&&n.children[e.text].children){let i=n.children[e.text].children[e.objectId];if(i){i.dateCreat=t.result["ds6w:created"],i.dateModif=t.result["ds6w:modified"],i.icon=t.result["ds6w:icon"],i.ownerid=t.result.owner,i.owner=t.result["ds6w:responsible"],i.title=t.result["ds6w:label"],i.type=t.result["ds6w:type"];let e={};e[i.id]=i,D.updateValidations(e,!1,!0)}}}))}function ke(e){-1===W.indexOf(e[0])&&(c.evalTaskCells(e,(function(t){if(0===Object.keys(t).length&&t.constructor===Object){let t={r3mTaskCandiAssignment:"",r3mTaskEstiFinDate:"",r3mTaskEstiDuration:""},n={};n[e[0]]=t,D.updateValidations(n,!1,!0)}let n={},i={};var a=[];t.relateddata.candidateAssignees.forEach((function(e){a.push({label:e.dataelements.firstname+" "+e.dataelements.lastname,url:e.dataelements.image})})),n.r3mTaskCandiAssignment=a.length>=1?a:"",n.r3mTaskEstiFinDate=t.dataelements&&t.dataelements.dueDate?t.dataelements.dueDate:"",n.r3mTaskEstiDuration=function(e,t){var n="";if(void 0!==e&&void 0!==t&&""!==e&&""!==t){var i=e.trim().split(" ")[0];n=i+" "+y[("1"===i?"Single":"Multiple")+t]}return n}(t.dataelements.estimatedDurationInputValue,t.dataelements.estimatedDurationInputUnit),i[t.id]=n,D.updateValidations(i,!1,!0);let o=W.indexOf(e[0]);o>-1&&W.splice(o,1)})),W.push(e[0]))}function Re(e){-1===J.indexOf(e[0])&&(c.evalTaskCells(e,(function(t){if(0===Object.keys(t).length&&t.constructor===Object){let t={r3massignees:""},n={};n[e[0]]=t,D.updateValidations(n,!1,!0)}let n={},i={};var a=[];t.relateddata.assignees.forEach((function(e){a.push({label:e.dataelements.firstname+" "+e.dataelements.lastname,url:e.dataelements.image})})),n.r3massignees=a.length>=1?a:"",i[t.id]=n,D.updateValidations(i,!1,!0);let o=J.indexOf(e[0]);o>-1&&J.splice(o,1)})),J.push(e[0]))}function Ue(e){-1===N.indexOf(e[0])&&(c.evalIssueCells(e,(function(t,n){if(0===t.results.length){let t={r3massignees:""},n={};n[e[0]]=t,D.updateValidations(n,!1,!0)}t.results.forEach((function(e){let t=e.body,i={},a={};var o=[];t.assignees.forEach((function(e){o.push({label:e.fullName,url:n[e.user]})})),i.r3massignees=o.length>=1?o:"",a[t.physicalId]=i,D.updateValidations(a,!1,!0)}));let i=N.indexOf(e[0]);i>-1&&N.splice(i,1)})),N.push(e[0]))}function Le(e){-1===V.indexOf(e[0])&&(c.evalIssueCells(e,(function(t){if(0===t.results.length){let t={r3mIssueApprovals:"",r3mIssueResolvedBy:""},n={};n[e[0]]=t,D.updateValidations(n,!1,!0)}t.results.forEach((function(e){let t=e.body,n={},i={};n.r3mIssueApprovals=!("Unassigned"===t.waitingOn||""===t.waitingOn),n.r3mIssueResolvedBy=0===t.resolvedBy.length?"No":"Yes("+t.resolvedBy.length.toString()+")",n.r3mIssuePriority=t.priority,i[t.physicalId]=n,D.updateValidations(i,!1,!0)}));let n=V.indexOf(e[0]);n>-1&&V.splice(n,1)})),V.push(e[0]))}function Fe(e){let t;function n(){let n=T[e[0]].children;T[e[0]].children={},t=n,T[e[0]].children[e[0]+"_context"]={id:e[0]+"_context",title:"Context",children:n}}-1===_.indexOf(e[0])&&(c.evalMetricIssueCells(e,(function(i){let a=Object.keys(i.issues).length>0,o=Object.keys(i.tasks).length>0;if(a||o){T[e[0]].children||(T[e[0]].children={}),a&&o?(T[e[0]].children[e[0]+"_issue"]||T[e[0]].children[e[0]+"_task"]||(n(),T[e[0]].children[e[0]+"_issue"]={id:e[0]+"_issue",title:"Issues",children:{}},T[e[0]].children[e[0]+"_task"]={id:e[0]+"_task",title:"Tasks",children:{}}),Object.assign(T[e[0]].children[e[0]+"_issue"].children,i.issues),x=Object.assign(x,i.issues),1===Object.keys(T[e[0]].children[e[0]+"_issue"].children).length&&(T[e[0]].children[e[0]+"_issue"].title="Issue"),Object.assign(T[e[0]].children[e[0]+"_task"].children,i.tasks),x=Object.assign(x,i.tasks),1===Object.keys(T[e[0]].children[e[0]+"_task"].children).length&&(T[e[0]].children[e[0]+"_task"].title="Task")):a?(T[e[0]].children[e[0]+"_issue"]||(n(),T[e[0]].children[e[0]+"_issue"]={id:e[0]+"_issue",title:"Issues",children:{}}),Object.assign(T[e[0]].children[e[0]+"_issue"].children,i.issues),x=Object.assign(x,i.issues),1===Object.keys(T[e[0]].children[e[0]+"_issue"].children).length&&(T[e[0]].children[e[0]+"_issue"].title="Issue")):(T[e[0]].children[e[0]+"_task"]||(n(),T[e[0]].children[e[0]+"_task"]={id:e[0]+"_task",title:"Tasks",children:{}}),Object.assign(T[e[0]].children[e[0]+"_task"].children,i.tasks),x=Object.assign(x,i.tasks),1===Object.keys(T[e[0]].children[e[0]+"_task"].children).length&&(T[e[0]].children[e[0]+"_task"].title="Task"));var s={};s[e[0]]=T[e[0]],void 0!==t&&Object.keys(t).length&&Object.keys(t).forEach((function(t){D.deleteNodes(e[0],t)})),D.updateValidations(s,!1,!1,!0)}})),_.push(e[0]))}function Ve(e){let t=T[e[0]];function n(e){let t=F.pending.indexOf(e);if(t>-1&&F.pending.splice(t,1),t=F.completed.indexOf(e),-1===t&&F.completed.push(e),t=F.running.indexOf(e),t>-1&&F.running.splice(t,1),F.pending.length>0){let e=F.running.length;F.pending.forEach((function(t){(0===F.running.length||F.running.length>0&&F.running.indexOf(t))&&(Ve([t]),e+=1)}))}}function i(e,t,n){let i=T[e];if(i){i.analysisStateProgress=Math.ceil(n/t*100);let e={};e[i.id]=i,D.updateValidations(e,!1)}}function a(e){let t="error",i=0,a=e.output[0].simPid;if("timeout"===e.status)n(e.simIds[0]);else if("failure"!==e.status&&Array.isArray(e.output))e.output.forEach((function(o){let s=o.nbTotalItf,r=o.nbOK,l=o.nbKO,d=o.nbPrev,u=o.nbTotalItf-(o.nbKO+o.nbOK),p=o.simPid,f=L.filter((e=>e.internalID===a)),g={};f.length>=1&&(g=f.reduce(((e,t)=>e&&e.startingTime>t.startingTime?e:t))),(q?new Promise((e=>{c.getIndexingTimestamp().then((t=>{e(t)}))})):Promise.resolve(null)).then((e=>{let n=null;e&&e.FTS&&e.FTS.allvaultsacl&&(n=e.FTS.allvaultsacl),"0"===o.ExecStatus?(t=n&&g.completionTime>n?"computedButNotIndexed":"notcomputed",i=0):"1"===o.ExecStatus?(t="Running",i=0):n&&g.completionTime>n?d>0||l>0||r>0?(t="startedButNotIndexed",i=0):0===d&&0===l&&0===r&&(t="computedButNotIndexed",i=0):r===s?t="donenoko":u&&l?(t="startedwithko",i=l):u&&0===l&&r?t="startednoko":u&&0===l&&0===r?(t="computed",i=s):s===l+r?(t="donewithko",i=l):t="startednoko",T[p]&&T[p].analysisState!==t&&(Ee(T[p],t,i),D.updateStatusBar(T[p].id,"success"))})),n(e.output[0].simPid)}));else{let a=e.simIds?e.simIds[0]:"";T[a]&&T[a].analysisState!==t&&(Ee(T[a],t,i),D.updateStatusBar(T[a].id,"failure")),n(e.simIds[0])}}let o=e[0];for(-1===F.all.indexOf(o)&&F.all.push(o),-1===F.pending.indexOf(o)&&F.pending.push(o);F.running.length<4&&-1===F.running.indexOf(o);){let e=T[o];if(!e)return;let n=c.getIsrTypes(),s=e.type;if(n.indexOf(s)>-1&&("unknown"===e.analysisState&&Ee(e,"running",0,!0),-1===F.running.indexOf(o)))if(F.running.push(o),q){let n=L.filter((e=>e.internalID===t.id));if(n.length>=1){let t=n.reduce(((e,t)=>e&&e.startingTime>t.startingTime?e:t));"running"!==t.status&&"pending"!==t.status?c.evalAnalysisStatus(e,a,i):Ee(e,"running"===t.status?"Running":"Queued",0)}else c.evalAnalysisStatus(e,a,i)}else c.evalAnalysisStatus(e,a,i)}}function Ne(){const e=e=>!e.restrictedEditionDisp||"Activated"!==e.restrictedEditionDisp||!(!(e=>{let t=window.widget.getValue("xPref_CREDENTIAL"),n=t.split(".");return t=n[0]?n[0]:"",u.getUserLogin()===e.ownerid||["VPLMProjectLeader","VPLMAdmin"].includes(t)})(e)||"In Work"!==e.maturityDisp);let t=D.getSelectedRows();if(1!==t.length)return;let n=[];return t.forEach((t=>{let i=T[t.id],a=i&&(-1!==c.getRvwTypes().indexOf(i.type)||-1!==c.getIsrTypes().indexOf(i.type))&&i.id;if(!a)return;let o=i.validState;o="Failed"===o?"failed":"Passed"===o?"passed":"inProgress";let s=-1!==c.getIsrTypes().indexOf(i.type);const r=e(i);n.push({title:i.title,physicalid:a,status:o,isrType:s,display:r})})),n}function _e(e,t){let n=T[e];return n.validState="passed"===t?"Passed":"failed"===t?"Failed":"InProgress",n.validStateDisp=c.getValidStateNlsValue(n.validState),ie(n),n}function We(){require(["DS/CATWebUXCVS/CATWebUXCVSComponent"].concat([]),(function(e){P&&P.clean(),P=null;let t=Ne();t&&1===t.length&&(t=t[0],P=new e({title:t.title,physicalId:t.physicalid,current:t.status,isrType:t.isrType,parent:A,platformSettings:u.getPlatformIdServices(),tenant:u.getPlatformId(),securityContext:{getSecurityContext:()=>({SecurityContext:u.getSecurityContext()})},onChangeValidationStateCompleted:function(e){if(T[t.physicalid].validState=e.sValidationState,f.publish("DS/DMUwebR3Mctrl/R3MObjectModified",{modified:"validationState",data:T}),localStorage.setItem("r3mValidationObjects",JSON.stringify(T)),P&&P.clean(),P=null,!e)return;let n=_e(t.physicalid,e.sValidationState);n&&D.updateValidations({[t.physicalid]:n})},onChangeValidationStateClose:function(){P&&P.clean(),P=null},onChangeValidationStateFailure:function(){P&&P.clean(),P=null}}))}))}let Je;function qe(e,t,n){return new Promise((function(t){c.getRvwFromValidatedObject(e).then((e=>{let i=[];e.result.forEach((function(e){e.outputs.review&&(i=i.concat(e.outputs.review.filter((e=>"DMUValidationValidation"===e["ds6w:type"])).map((e=>({id:e.physicalid,"ds6w:type":e["ds6w:type"]})))))})),i=Array.from(new Map(i.map((e=>[e.id,e]))).values()),t({objects:i,isCADroppedData:n})}))}))}function Be(e,t){if(0===e.length)return;let n=[];e.forEach((function(i){const a=i.objects.filter((function(e){return"DMUValidationValidation"===e["ds6w:type"]})).map((function(e){return e.id}));t?(e[0].isCADroppedData&&-1===n.indexOf(e[0].isCADroppedData[0].id)&&K.openCAs.push(e[0].isCADroppedData[0]),K.CAFound=K.CAFound+(a.length>=1?1:0),a.forEach((function(e){K.allDropValObjs.push({objectId:e})}))):(K.nonCAFound=K.nonCAFound+(a.length>=1?1:0),a.forEach((function(e){K.allDropValObjs.push({objectId:e})})))}))}function ze(e,n){if(h){h.getRightPanelContent().querySelectorAll(".r3mRightView").forEach((function(e){h.getRightPanelContent().removeChild(e)}))}var i=t.createElement("div",{class:"r3mRightView"});i.style.height="100%";let a={name:"closeSidePanel",text:y.closeSidePanel,icon:"close",handler:function(){K.caPropId=0,M.publish({event:"triptych-hide-panel"}),D.setInfoState(!1)}};C=new r({className:"r3mProperties",setEditButton:!0,readOnly:!1,setCloseButton:!0,typeOfDisplay:l.ALL,displayType:l.STANDARD,selectionType:l.NO_SELECTION,multiselection:l.MULTISEL_STD,collapseTabs:!1,appId:"ENOR3M_AP",actions:e?[a]:[{name:"prevCa",text:y.prevCa,icon:"chevron-left wux-ui-3ds",handler:function(){K.caPropId>=0&&(K.caPropId=K.caPropId-1,pe())}},{name:"nextCa",text:y.nextCa,icon:"chevron-right wux-ui-3ds",handler:function(){K.caPropId<K.openCAs.length-1&&(K.caPropId=K.caPropId+1,pe())}},a]}).inject(i),n&&C.initDatas([]);let o=require("DS/DMUwebR3Mutils/DMUwebR3MwidgetUtils"),s={requestUtils:{get3DSwymUrl:o.get3DSwymUrl,get3DSearchUrl:o.get3DSearchUrl,get3DSpaceUrl:o.get3DSpaceUrl,getPlatformId:o.getPlatformId,getSecurityContext:o.getSecurityContext,getLang:o.getLang},onFacetModification:function(e){let t=[];Object.keys(e||{}).forEach((function(e){let n=x[e];n&&Object.keys(this[e]||{}).forEach((function(i){let a;"sValidationState"===i?(a=!0,_e(e,this[i])):"iCheckState"===i?(a=!0,c.updateCheckStateValue(this[i],n)):"title"!==i&&"description"!==i||(a=!0,n[i]=this[i]),a&&-1===t.indexOf(e)&&t.push(e)}),this[e])}),e);let n={};t.forEach((e=>{ee(e).forEach((e=>{n[e]||(n[e]=T[e])}))})),D.updateValidations(n)}};return C.addFacets([{position:1,require:"DS/PIMwebPropertiesTabs/PIMwebIsrPropContextTab",supportMerge:!0,options:s,facet:{name:"interference_context",text:y.context,icon:"6w-what"}},{position:2,require:"DS/PIMwebPropertiesTabs/PIMwebIsrPropSpecTab",supportMerge:!0,options:s,facet:{name:"interference_specification",text:y.specifications,icon:"6w-how"}},{position:1,require:"DS/DMUReviewFacets/DMUwebR3MinfoRvwCheckTab",supportMerge:!0,options:s,facet:{name:"review_check",text:y.checks,icon:"check-review"}},{position:2,require:"DS/DMUReviewFacets/DMUwebR3MinfoRvwHighlightTab",supportMerge:!0,options:s,facet:{name:"review_highlight",text:y.highlights,icon:"highlight-review"}},{position:1,require:"DS/DMUReviewFacets/DMUwebR3MinfoRvwMembersTab",supportMerge:!0,options:s,facet:{name:"review_members",text:y.memberTabFacetTitle,icon:"users"}}]),h&&i.inject(h.getRightPanelContent()),i}function Xe(){D.updateFilterSelectionLabel("removeStatusDiv"),require("DS/Notifications/NotificationsManagerViewOnScreen").removeNotifications(),localStorage.removeItem("r3mDataLoadFromDrop"),D.updateFilterSelectionLabel("removeStatusDiv"),K={CALabel:"",CATot:0,CAFound:0,nonCATot:0,nonCAFound:0,allDropValObjs:[],openCAs:[],caPropId:-1},C.initDatas([])}function He(e,i){Xe();let a=[],o=[],s=[];e.forEach((function(e){"Change Action"===e.objectType?a.push({id:e.objectId,serviceId:e.serviceId,type:e.objectType,displayName:e.displayName}):"SIMItfSimulation"===e.objectType||"DMUValidationValidation"===e.objectType||"DMUMarkupRepReference"===e.objectType||"DesignSight"===e.objectType?(K.allDropValObjs.push({objectId:e.objectId}),s.push({id:e.objectId,serviceId:e.serviceId,type:e.objectType,displayName:e.displayName})):o.push({id:e.objectId,serviceId:e.serviceId,type:e.objectType})})),K.nonCATot=o.length;var r,l=[],d=[];if(o.forEach((function(e){l.push(qe([e.id]))})),a.forEach((function(e){d.push(function(e,t,n){return new Promise((function(i){var a=u.get3DSpaceUrl()+"/resources/enorelnav/v2/navigate/getEcosystem?tenant="+u.getPlatformId(),o={items:e,trueREST:!1,direction:t?"out":"in",restrictedMode:!1,relations:t?["carealizedwhere_to"]:["rvw_validated_from"],lang:"en",responseMode:"ObjectsAndLinks",label:"ENOR3M_AP_"+u.getWidgetId(),widgetId:u.getWidgetId()},s={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:u.getSecurityContext()},type:"json",data:JSON.stringify(o),onComplete:function(a){if(t){let t=e;if(e.some((e=>void 0===e.displayName))){let n=a.objects.filter((e=>"Change Action"===e["ds6w:type"]));t=e.map((e=>{const t=n.find((t=>t.id===e.id));return t?{...e,displayName:t.name}:e}))}let n=a.objects.filter((e=>"Change Action"!==e["ds6w:type"])).map((e=>({id:e.physicalid,serviceId:e.serviceId,type:e["ds6w:type"]})));i({dropedData:t,data:n})}else i({objects:a.objects,isCADroppedData:n})},onFailure:function(){i([])}};require("DS/WAFData/WAFData").authenticatedRequest(a,s)}))}([e],!0))})),K.CATot=a.length,O.mycreation=0,O.myselection=1,G(),D.updateFilterSelectionLabel(),D&&D.removeAll(),a.length>0&&0===o.length&&(0===s.length||i)){let e=1===a.length?a[0].displayName:a.length.toString()+" "+y.cas;K.CALabel=e,D.updateFilterSelectionLabel("running",0,e)}if(!i){r=t.createElement("div",{class:"r3mLoadingValidations mask wux-datagridview-emptycontentmessage"}).inject(A);const e=t.createElement("div",{styles:{display:"flex","justify-content":"center"}}).inject(r);new n({shape:"circular",infiniteFlag:!0}).inject(e),t.createElement("div",{class:"r3mWelcomeText",html:y.openValidation,styles:{}}).inject(r)}Promise.all([Promise.all(d),Promise.all(l)]).then((function(e){var t=[];e[0].forEach((function(e){0!==e.data.length&&t.push(qe(e.data.map((e=>e.id)),0,e.dropedData))})),Promise.all(t).then((function(t){t.forEach((function(e){Be([e],!0)})),Be(e[1],!1);let n,l=!1;if(a.length>0&&0===o.length&&(0===s.length||i)){if(i&&1===a.length&&e[0]&&e[0][0]){let t=e[0][0].dropedData.find((e=>e.id===a[0].id));t&&(a[0].displayName=t.displayName)}n=1===a.length?a[0].displayName:a.length.toString()+" "+y.cas,K.CALabel=n,0===K.CAFound&&D.updateFilterSelectionLabel("notstarted",0,n),l=!0}a.length>0&&pe();let d={data:{obj:K.allDropValObjs},openCAs:K.openCAs,caLen:a.length,valFndLen:K.CAFound,caLbl:n,isCaToRvwFound:l};localStorage.setItem("r3mDataLoadFromDrop",JSON.stringify(d)),K.allDropValObjs.length>0&&le(i?"deleteCreationLoop":"dontShowLoader"),require(["DS/PADUtils/views/PADAlert"].concat([]),(function(e){if(K.CATot>0){let t="";0===K.CAFound?t=K.CATot>1?y.novalidationallca:y.novalidationca:K.CAFound!==K.CATot&&(t=y.novalidationsomeca),""!==t&&e.displayNotification({msg:t,eventID:"warning"})}if(K.nonCATot>0){let t="";0===K.nonCAFound?t=K.nonCATot>1?y.novalidationall:y.novalidation:K.nonCAFound!==K.nonCATot&&(t=y.novalidationsome),""!==t&&e.displayNotification({msg:t,eventID:"warning"})}})),r&&setTimeout((function(){r.destroy()}),10)}))}))}te(),u.onTenantModified((e=>{Je||(Je=!0,D.removeAll(),e.then((()=>{Je=!1,le()})))})),c.onTenantModified((()=>{c.getColumnsNls().then(D.onTenantModified)})),u.getWidget().addEvent("onRefresh",(function(){var e=u.getWidgetData();Object.keys(e).length>0&&(window.widget.data=e,window.widget.data.loadDataFromCopiedLink=!1),Je||le()})),this._fillSelectionFrom=function(e,t){e="UnusedToRemove";let n=z.find((t=>t.WidgetId===e));if(n)n.paths=t;else{let n={WidgetId:e,paths:t};z.push(n)}},this._setSelectionFromEvent=function(e){let t=[];ce(t,e.data.paths,e.data.attributes),e.metadata&&e.metadata.originWidgetId&&this._fillSelectionFrom(e.metadata.originWidgetId,t)},this._setSelectionFromListener=function(e){let t=[];e&&e.data&&e.data.items&&e.data.items.forEach((function(e){t.push({envId:u.getPlatformId(),serviceId:e.serviceId?e.serviceId:"3DSpace",contextId:u.getSecurityContext(),objectId:e.objectId,objectType:e.objectType,path:void 0})})),this._fillSelectionFrom("preview",t)},f.subscribe("DS/PADUtils/PADCommandProxy/select",this._setSelectionFromEvent.bind(this)),f.subscribe("DS/ENO/select",this._setSelectionFromEvent.bind(this)),I||(j=u.getWidgetAppId()+"_CompassSocket_"+u.getWidgetId(),I=new i.Socket(j),I.subscribeServer("com.ds.compass",window.parent)),I.subscribeServer("com.ds.compass",window),I.addListener("onSetX3DContent",this._setSelectionFromListener.bind(this)),I.addListener("onResetX3DContent",this._setSelectionFromListener.bind(this)),f.subscribe("DS/PADUtils/PADCommandProxy/validationState",(e=>{const{validationId:t,checkId:n,checkStatus:i}=e,a=T[t];let o=a.children&&a.children[`${a.id}_check`];o&&o.children[n]&&(o.children[n].validState=i,o.children[n].validStateDisp=i),_e(t,a.validState.toLowerCase())})),this.buildUX=function(){return h?Promise.resolve():new Promise(function(e){var n=t.createElement("div",{class:"r3mMainView",styles:{width:"100%",height:"100%"}}),i=ze(!1,!0);function r(){}function l(e,t){if(!D||!t)return!1;var n={protocol:"3DXContent",version:"1.1",data:{items:[]},source:u.getWidgetAppId(),widgetId:u.getWidgetId()},i=[],a={};return de(i,a),ce(n.data.items,i,a),e.dataTransfer.setData("Text",JSON.stringify(n)),!1}h=new s,h.init({withtransition:!0,container:this,right:{withClose:!1},modelEvents:M},null,n,i),c.getColumnsNls().then((t=>{D=new a({parent:n,onSelect:fe,onUnselect:ge,getFilterValues:function(){return Object.assign({},O)},getIsrTypes:function(){return c.getIsrTypes()},getR2VActivityInfo:xe,onFiltersModified:he,onMassCreate:ve,onPref:be,onInfo:ye,allowRelations:we,allowCopyLink:Se,onCopyLink:Ce,onPublishTo3DSwym:De,onRelations:Me,allowMaturityState:Ae,onMaturityState:Te,onAnalysisState:Ve,onMetricIssue:Fe,onIssueCells:Le,onTaskCells:ke,onIssueAssigneesCells:Ue,onTaskAssigneesCells:Re,allowValidationState:Ne,allowUpdateSimulation:je,getCSIcomputeToken:Ie,onValidationState:We,onUpdateSimulation:Pe,getPreviousConfig:Oe,columns:t,cbDnD:{onDragStartCell:l,onDragOverCell:r,onDragEnterBlank:r,onDragOverBlank:r,onDragStartRowHeader:l,onDragOverRowHeader:r}}),D&&(D.updateFilterSelectionLabel(),D.checkFilterAndFetchValue()),new o({onDrop:He,openLbl:"  "+y.openValidation}).manageDragAndDrop(n),e()}))}.bind(this))}.bind(A),this.refresh=function(){let e=u.getDatafromContent();e&&Object.keys(e).length>=1?He(e.obj):le()},this.destroy=function(){window.console.error("TODO!!")}}}),C=[],I=function(e){return e&&e.id?(C.some((function(n){return n.id===e.id&&(t=n.enveloppe)})),t):null;var t};return Object.freeze({giveCtrl:function(e){return I(e)},getCtrl:function(e){if(!e||!e.id)return null;var t=I(e);if(!t){var n=new D({parent:e.parent}),i={buildUX:function(){return n?n.buildUX.apply(null,arguments):null},refresh:function(){return n?n.refresh.apply(null,arguments):null},destroy:function(){n&&(n.destroy.apply(null,arguments),n=null,C.some((function(e,t){if(e.enveloppe===i)return C.splice(t,1),i=null,!0})))}};Object.freeze(i),C.push({id:e.id,enveloppe:i}),t=i}return t}})}));