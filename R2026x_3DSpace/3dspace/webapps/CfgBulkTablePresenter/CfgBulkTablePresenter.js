define("DS/CfgBulkTablePresenter/BulkEdition/Presenter/CfgAutocomplete",["UWA/Core","DS/Utilities/Dom","DS/Controls/Abstract","DS/Controls/SelectionChips","DS/Controls/LineEditor","DS/Controls/Popup","DS/DataGridView/DataGridView","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/Utilities/Array","DS/Utilities/KeyboardUtils","DS/Utilities/Utils","DS/Core/PointerEvents","DS/Menu/Menu","css!DS/CfgBulkTablePresenter/BulkEdition/Presenter/CfgAutoComplete.css"],(function(e,t,i,o,s,n,a,l,r,d,h,u,c,p){"use strict";var _=10;function m(e){return void 0!==e?Array.isArray(e)?this.multiSearchMode?e:[e[0]]:[e]:[]}function f(e){var t=this;E.call(t,t._valueOperation,{operationType:t._valueUpdated.ADD,noOfItemsModified:1},(function(){var i=this.value;this.multiSearchMode?e&&""!==e&&(Array.isArray(i)?(i=i.slice(0),d.pushUnique(i,e)):i=[e],t._editor&&(t._editor.value="")):i=e,t.value=i}))}function g(e){let t=0;if(e){const i=this._dataGridView?this._dataGridView.layout.getRowHeight():27;let o=e.bottom-4,s=o/i;t=Math.floor(s),0===t&&(o=e.top-4,s=o/i,t=Math.floor(s))}else this._numberOfItems=0,this._model&&(this._numberOfItems=this._model.getNumberOfVisibleDescendants()),t=this._numberOfItems;if(this._nbItemsToDisplay=Math.min(t,_),!this._dataGridView||!this._dataGridViewContainer)return!1;let i=!1;const o=this._dataGridView.layout.getRowHeight(),s=0===this._nbItemsToDisplay?1:this._nbItemsToDisplay,n=(this._pendingPromise?80:o*s)+"px";return this._dataGridViewContainer.style.height!==n&&(this._dataGridViewContainer.style.height=n,i=!0),i}function v(e,t){let i=!1,o=0;if(this.popupSizeAdjustPolicy===n.SizeAdjustPolicyEnum.NoAdjust)o=this._DGVContainerFitWidth;else if(this._dataGridView){const e=this._numberOfItems>_?u.getScrollbarWidth():0,t=this._dataGridView._getMaxContentSizeInfo("tree",{computeAllRows:this.popupSizeAdjustPolicy===n.SizeAdjustPolicyEnum.AdjustToAllContents}).maxContentSize;o=Math.max(this._DGVContainerMinWidth,t+e),this._DGVContainerWidth!==o&&(this._DGVContainerMinWidth=o)}if(e){const t=this._DGVContainerFitWidth+e.left+e.right;o=Math.min(o,t)}return 0!==o&&this._DGVContainerWidth!==o&&(this._DGVContainerWidth=o,this._dataGridViewContainer.setStyle("width",o+"px"),i=!0),(i||t)&&this.elements.popup._updateView(),!this._popupVisibility&&this.elements.popup&&this.elements.popup.visibleFlag&&(this._popupVisibility=!0,this.elements.popup.getContent().setStyle("visibility","visible"),this.fire("popupVisibilityChange")),i||t}function C(e){const t=g.call(this,e);return v.call(this,e,t)}function y(){var e=void 0;this._selectionChips&&(e=this._selectionChips.getContent().getDimensions().height),e>this._selectionChipsHeight?null!=this.elements.popup&&this.elements.popup._updateView():e<this._selectionChipsHeight&&C.call(this),this._selectionChipsHeight=e}function b(e){this.filterCB(e),C.call(this)}function M(e){var t=A.call(this,e);if(t.length>0&&t[0])this._model&&this._model.getNthRoot(0)&&this._model.getNthRoot(0).options.customNode&&this._model.removeRoot(this._model.getNthRoot(0));else if(e){if(this.allowFreeInputFlag&&this._model)if(0!=this._model.getRoots().length&&this._model.getNthRoot(0).options.customNode)this._model.getNthRoot(0).updateOptions({label:e,value:e});else{var i=new r({label:e,value:e,icons:[{iconName:"pencil"}],customNode:!0});this._model&&this._model.addRoot(i,0)}}else this._model&&this._model.getNthRoot(0)&&this._model.getNthRoot(0).options.customNode&&this._model.removeRoot(this._model.getNthRoot(0))}function w(){this._model&&(this._addChildCB&&(this._model.unsubscribe(this._addChildCB),this._addChildCB=void 0),this._removeChildCB&&(this._model.unsubscribe(this._removeChildCB),this._removeChildCB=void 0))}function I(e,t){if(!this._modelLoaded)if(this.selectedItems&&t&&(E.call(this,this._valueModifiedbyAPI,!0,(function(){this._model&&(this._model.getXSO().isEmpty()||this._model.getXSO().empty())})),this._properties.value.value=void 0,this._properties.selectedItems.value=void 0,this._selectionChips&&this._selectionChips.removeAllChips(),this._editor&&(this._editor.value="")),w.call(this),void 0===e)this._defaultModel||(this._defaultModel=new l),this._defaultModel.empty(),this._model=this._defaultModel,this._modelLoaded=!0;else{if(e instanceof l)return S.call(this,e);if(Array.isArray(e))return V.call(this,e);if(e instanceof Function)return this._lastSearchedString=this._editor?this._editor.valueToCommit:"",I.call(this,e.call(this,this._lastSearchedString),!1);if(e instanceof Promise){this._pendingPromise=!0,this._dataGridView&&(this._dataGridView.displayModalLoader("Loading..."),this._dataGridView.placeholder="");var i=this;e.then((function(e){I.call(i,e,!1),i._editor&&i.displayCustomNodeInDropDown&&M.call(i,i._editor.valueToCommit)})).finally((function(e){i._pendingPromise=!1,i._dataGridView&&(i._dataGridView.removeModalLoader("Loading..."),i._dataGridView.placeholder=i.customFilterMessage,i._editor&&b.call(i,i._editor.valueToCommit))}))}}}function D(){this._editor&&void 0!==this._editor.valueToCommit&&this._editor.valueToCommit.length>=this.minLengthBeforeSearch&&(!this._modelLoaded&&!this._pendingPromise||!this.keepSearchResultsFlag&&!this._pendingPromise||this.elementsTree instanceof Function&&this.minLengthBeforeSearch>0&&this._editor.valueToCommit.toLowerCase().indexOf(this._lastSearchedString.toLowerCase())<0)&&(this._modelLoaded=!1,I.call(this,this.elementsTree,!1))}function S(e){if(e instanceof l){if(this._model=e,this._modelLoaded=!0,this._dataGridView&&(this._dataGridView.treeDocument=this._model),!this.isDirty("value")&&!this.isDirty("selectedItems")){var t=e.getXSO().get();t.length>0&&E.call(this,this._valueOperation,{operationType:this._valueUpdated.ADD,noOfItemsModified:t.length},(function(){this.selectedItems=t}))}var i=this,o=function(e){C.call(i)};this._addChildCB=this._model.addModelEventListener("addChild",o),this._removeChildCB=this._model.addModelEventListener("removeChild",o),this._model.onPostExpand((function(){C.call(i)})),this._model.onPostCollapse((function(){C.call(i)})),this._model.getXSO().onPostAdd((function(e){i._valueModifiedbyAPI||E.call(i,i._valueOperation,{operationType:i._valueUpdated.ADD,noOfItemsModified:e.length},(function(){if(i.multiSearchMode){var t=[];if(i.selectedItems&&(t=i.selectedItems.slice(0)),e&&e.forEach((function(e){d.pushUnique(t,e)})),i.selectedItems=t,i.easySelectionMode!==G.SELECT_MODE_DISABLE&&"OnOver"===i._dataGridView.showSelectionCheckBoxesFlag)return i.easySelectionMode===G.SELECT_MODE_NONE&&(i.selectedItems=e[0]),void i._hidePopup();y.call(i)}else i._hidePopup(),i.selectedItems=e[0]}))})),this._model.getXSO().onPostRemove((function(e){i.displayCustomNodeInDropDown&&e[0].options&&e[0].options.customNode||i._valueModifiedbyAPI||E.call(i,i._valueOperation,{operationType:i._valueUpdated.REMOVE,noOfItemsModified:e.length},(function(){if(i.multiSearchMode){var t=[];i.selectedItems&&(t=i.selectedItems.slice(0)),e.forEach((function(e){for(var i=t.length-1;i>=0;i--)if(t[i]===e){t.splice(i,1);break}})),i.selectedItems=t,y.call(i)}i.easySelectionMode!==G.SELECT_MODE_DISABLE&&i.easySelectionMode!==G.SELECT_MODE_MULTI&&0===i.selectedItems.length&&i._dataGridView&&(i._dataGridView.selectionBehavior.toggle=!1,i._dataGridView.showSelectionCheckBoxesFlag="OnOver")}))}))}}function V(e){if(Array.isArray(e)){var t=new l;t.prepareUpdate();for(var i=0;i<e.length;i++){var o=e[i];let n="string"==typeof o?o:o.value,a="string"==typeof o?void 0:o.icon;var s=new r({label:n,value:n,icons:a?[a]:[]});t.addRoot(s)}return t.pushUpdate(),S.call(this,t)}}function E(e,t,i){var o=this._valueModifiedbyAPI;!0===e.hasOwnProperty("operationType")&&!0===e.hasOwnProperty("noOfItemsModified")?(this._valueOperation.operationType=t.operationType,this._valueOperation.noOfItemsModified=t.noOfItemsModified):this._valueModifiedbyAPI=t,i.call(this),e.operationType&&e.noOfItemsModified?(this._valueOperation.operationType=void 0,this._valueOperation.noOfItemsModified=void 0):this._valueModifiedbyAPI=o}var T=function(){this._selectionChips=new o({fireOnlyFromUIInteractionFlag:!0,disabled:this.disabled}),this._selectionChips.getContent().addClassName("wux-controls-autoComplete-selectionChips"),this._selectionChips.touchMode=this.touchMode;var e=this;t.addEventOnElement(this,this._selectionChips,"onPostRemove",(function(t){e._valueModifiedbyAPI||E.call(e,e._valueOperation,{operationType:e._valueUpdated.REMOVE,noOfItemsModified:t.options.chips.length},(function(){if(e.multiSearchMode&&t.options.chips){if(t.options.allChipsRemoved)return void(e.selectedItems=[]);for(var i=0;i<t.options.chips.length;i++){const s=t.options.chips[i].chipOptions;if(s.value&&s.value.options.customNode){const t=m.call(e,e.selectedItems).findIndex((e=>e===s.value));if(-1!==t){const i=e.selectedItems.slice(0);i.splice(t,1),e.selectedItems=i}}else if(s.value){var o=A.call(e,s.value);o&&o[0]&&s.value.unselect()}}}}))})),t.addEventOnElement(this,this._selectionChips,"change",(function(e){e.stopPropagation()}))},A=function(t){var i,o=!1,s=[],n=[];if(Array.isArray(t)?s=t:s[0]=t,this._model)for(var a=0;a<s.length;a++){var l=this;o=!1,void 0!==(i=l._model.search({useTransaction:!1,match:function(t){if("string"==typeof s[a]||"number"==typeof s[a]){if(l._valueOperation.operationType===l._valueUpdated.REMOVE||l._valueOperation.operationType===l._valueUpdated.ADD){if("string"==typeof s[a]&&"string"==typeof t.nodeModel.options.label){if(e.equals(s[a].toLowerCase(),t.nodeModel.options.label.toLowerCase()))return o=!0,!0}else if(e.equals(s[a],t.nodeModel.options.label))return o=!0,!0}else if(l.displayCustomNodeInDropDown&&l._model.getNthRoot(0).options.customNode&&t.nodeModel.options.label&&e.equals(s[a].toLowerCase(),t.nodeModel.options.label.toLowerCase()))return o=!0,!0;if(t.nodeModel.options.hasOwnProperty("value")&&void 0!==t.nodeModel.options.value){if(e.equals(s[a],t.nodeModel.options.value))return o=!0,!0}else if(e.equals(s[a],t.nodeModel.options.label))return o=!0,!0}else if("object"==typeof s[a])if(t.nodeModel.options.hasOwnProperty("value")&&void 0!==s[a].options.value&&void 0!==t.nodeModel.options.value){if(e.equals(s[a].options.value,t.nodeModel.options.value))return o=!0,!0}else if((l._valueOperation.operationType===l._valueUpdated.REMOVE||l._valueOperation.operationType===l._valueUpdated.ADD)&&e.equals(s[a].options.label,t.nodeModel.options.label))return o=!0,!0},shouldStop:function(){return o}}))[0]&&d.pushUnique(n,i[0])}return n};function O(){if(this._dataGridView){var e=-1,t=Array.isArray(this.selectedItems)?this.selectedItems[this.selectedItems.length-1]:this.selectedItems;return t&&(e=this._dataGridView.layout.getCellIDFromCoordinates({rowID:t._getRowID(),columnID:0})),this._dataGridView.setActiveCell(e,!0,!0),this._dataGridView.setPreselectedCell(e),this._dataGridView.ensureCellVisible(e,!1,0)}}var G=i.inherit({name:"autoComplete",publishedProperties:{placeholder:{defaultValue:"",type:"string",category:"Appearance"},multiSearchMode:{defaultValue:!0,type:"boolean",category:"Behavior"},displayCustomNodeInDropDown:{defaultValue:!0,type:"boolean",category:"Behavior",noNeedToApplyFlag:!0},value:{defaultValue:void 0,type:"object",category:"Appearance"},elementsTree:{defaultValue:void 0,type:"object",category:"Model"},selectedItems:{defaultValue:void 0,type:"Array",category:"Appearance"},filterCB:{defaultValue:function(e){this.filterItems(e,{filterId:"stringRegexp"})},type:"function"},customFilterMessage:{defaultValue:"",type:"string",category:"Appearance"},allowFreeInputFlag:{defaultValue:!0,type:"boolean",category:"Behavior",noNeedToApplyFlag:!0},allowResetToUndefinedByUIFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},minLengthBeforeSearch:{defaultValue:0,type:"integer",category:"Behavior",noNeedToApplyFlag:!0},typeDelayBeforeSearch:{defaultValue:0,type:"integer",category:"Behavior",noNeedToApplyFlag:!0},keepSearchResultsFlag:{defaultValue:!0,type:"boolean",category:"Behavior",noNeedToApplyFlag:!0},popupSizeAdjustPolicy:{defaultValue:n.SizeAdjustPolicyEnum.AdjustToVisibleContents,type:"integer",category:"Appearance"},getChipInfo:{defaultValue:function(e){return this.getDefaultChipInfo(e)},type:"function"},onClickIcon:{defaultValue:function(e){return null},type:"function"},easySelectionMode:{defaultValue:0,type:"integer",category:"Behavior"},compareCB:{defaultValue:null,type:"function",category:"Behavior"},sortOrder:{defaultValue:void 0,type:"string",category:"Behavior"}},getDefaultChipInfo:function(e){let t="object"==typeof e.options.value?e.options.value.label||e.getLabel():e.getLabel()||e.options.value+"",i=e.options.icon||("object"==typeof e.options.value?e.options.value.icon:void 0),o={roundFlag:"user"===this.getTypeRepresentation(e)||"detailedUser"===this.getTypeRepresentation(e)};return i||"user"!==this.getTypeRepresentation(e)&&"detailedUser"!==this.getTypeRepresentation(e)||(i={userName:"object"==typeof e.options.value?e.options.value.label||e.getLabel():e.getLabel()||e.options.value+""}),{label:t,icon:i,_iconOptions:o}},getTypeRepresentation:function(e){return(e?e.options.typeRepresentation:void 0)||this.columnOptions&&void 0!==this.columnOptions.getTypeRepresentation&&this.columnOptions.getTypeRepresentation({nodeModel:e})||this.columnOptions&&this.columnOptions.typeRepresentation||"string"},keymaps:{tab:"manageTab","shift+tab":"manageTab",esc:"manageEscape",up:"upMove",down:"downMove",pageup:"pageupMove",pagedown:"pagedownMove",home:"homeMove",end:"endMove"},commands:{manageTab:function(e){return this._hidePopup(),f.call(this,this._editor.valueToCommit),{stopPropagation:!1}},manageEscape:function(e){return this.elements.popup&&this.elements.popup.visibleFlag&&(!this.multiSearchMode&&this._editor&&this._editor._myInput&&this.selectedItems&&(this._editor.valueToCommit=this.selectedItems.getLabel(),this._editor.value=this.selectedItems.getLabel()),this.callMethodFromUIInteraction("_hidePopup")),{stopPropagation:!1}},upMove:function(){return this._manageNavigationKey("up")},downMove:function(){return this._manageNavigationKey("down")},pageupMove:function(){return this._manageNavigationKey("pageup")},pagedownMove:function(){return this._manageNavigationKey("pagedown")},homeMove:function(){return this._manageNavigationKey("home",!0)},endMove:function(){return this._manageNavigationKey("end",!0)}},buildView:function(){this.elements.container.addClassName("wux-controls-autoComplete"),this.elements.container.addClassName("cfg-bulkedit-autoComplete"),this.elements.container.setAttribute("tabindex",0),this._modelLoaded=!1,this._defaultModel=void 0,this._lastSearchedString="",this._valueOperation={operationType:void 0,noOfItemsModified:void 0},this._valueUpdated={ADD:1,REMOVE:2},this._nbItemsToDisplay=-1,this._valueModifiedbyAPI=!1,this._selectionChipsHeight=0,this._DGVContainerFitWidth=0,this._DGVContainerMinWidth=0,this._DGVContainerWidth=0},_postBuildView:function(){void 0===this._editor&&(this._editor=new s({placeholder:this.placeholder,displayStyle:"text",fireOnlyFromUIInteractionFlag:!0,selectAllOnFocus:!0,disabled:this.disabled}),this._editor.removeKeyMaps(["ctrl+c","ctrl+v"]),this._editor.getContent().addClassName("wux-controls-autoComplete-editor"),this._selectedImage=e.createElement("div",{class:"cfg-autoComplete-image"}),this._selectedImage.inject(this._editor.getContent(),"top")),this._editor.touchMode=this.touchMode,this._applyMultiSearchMode(),this.multiSearchMode||this.selectedItems&&(this._editor.value=Array.isArray(this.selectedItems)?this.selectedItems[0].options.label:this.selectedItems.options.label),this._delayPopupCreation()},handleEvents:function(){var e=this,i=function(){var t=!1;e._valueModifiedbyAPI||(!(e._editor&&""!==e._editor.valueToCommit&&e._editor.valueToCommit.length>=e.minLengthBeforeSearch)||e.elements.popup&&e.elements.popup.visibleFlag?e.elements.popup&&e.elements.popup.visibleFlag&&e._editor&&void 0!==e._editor.valueToCommit&&e._editor.valueToCommit.length<e.minLengthBeforeSearch&&e._hidePopup():(e._showPopup(),t=!0,e._dataGridView&&(e._dataGridView.setScrollerPosition({x:0,y:0,animate:!1}),e.multiSearchMode||e._dataGridView.unselectAll(),e._dataGridView.setActiveCell(-1,!0,!0),e._dataGridView.setPreselectedCell(-1)))),!t&&e.elements.popup&&e.elements.popup.visibleFlag&&D.call(e),e.displayCustomNodeInDropDown&&M.call(e,e._editor.valueToCommit),b.call(e,e._editor.valueToCommit),e.elements.popup&&e.elements.popup.visibleFlag&&e._dataGridView&&e._dataGridView.setFindStr(e._editor.valueToCommit,!1,void 0,!0)};t.addEventOnElement(this,this._editor,"uncommittedChange",(function(t){!e._valueModifiedbyAPI&&(p.hide(),e.elements.popup&&e.elements.popup.visibleFlag&&e._editor&&void 0!==e._editor.valueToCommit&&e._editor.valueToCommit.length<e.minLengthBeforeSearch)?e._hidePopup():!e._valueModifiedbyAPI&&e.typeDelayBeforeSearch>0?(this._debouncedlaunchSearch||(this._debouncedlaunchSearch=u.debounce(i,e.typeDelayBeforeSearch)),this._debouncedlaunchSearch()):i()})),t.addEventOnElement(this,this._editor,"change",(function(t){t.stopPropagation(),e._valueModifiedbyAPI||(f.call(e,e._editor.value),e._hidePopup())})),t.addEventOnElement(this,this,"keydown",(function(t){t.keyCode!=h.SPACE||t.actionPerformed?t.keyCode===h.HOME?e._manageNavigationKey("home",!0):t.keyCode===h.END?e._manageNavigationKey("end",!0):t.keyCode!=h.ENTER||t.actionPerformed||e._manageReturn(t):e._manageSpace(t)}),!0)},_manageSpace:function(e){if(this.multiSearchMode&&this.elements.popup&&this.elements.popup.visibleFlag&&this._dataGridView){var t=this._dataGridView.getActiveCellID();if(t>=0){var i=this._dataGridView.getNodeModelAt(t);i&&(i.isSelected()?i.unselect():i.select(),e&&(e.stopPropagation(),e.preventDefault()),this._editor&&this._editor._giveFocus())}}},_manageReturn:function(e){var t,i=!1;if(this.elements.popup&&this.elements.popup.visibleFlag){if(this._dataGridView){var o=this._dataGridView.getActiveCellID();o>=0&&(t=this._dataGridView.getNodeModelAt(o))}this._hidePopup()}return t?(t.select(),i=!0):this._editor.value&&(f.call(this,this._editor.value),i=!0),{stopPropagation:!1,infos:{actionPerformed:i}}},_manageNavigationKey:function(e,t){if(p.hide(),this.elements.popup&&this.elements.popup.visibleFlag){if(this._dataGridView){var i=-1,o=this._dataGridView.getActiveCellID();i=void 0===o||o<0?this._dataGridView.layout.getCellIDFromCoordinates({rowID:"end"===e?this._dataGridView.model.length-1:0,columnID:0}):this._dataGridView.computeCellIDFromActiveCell(e,t),this._dataGridView.setActiveCell(i,!0,!0),this._dataGridView.setPreselectedCell(i)}}else this._showPopup();return{preventDefault:!0}},_delayPopupCreation:function(){if(!this._delayPopupCreationInfos){var i=this,o={target:this,position:"bottom",offset:{x:0,y:4},trigger:"click escape keydown",toggleFlag:!0,constraint:"screen",className:"wux-controls-autoComplete-popup wux-controls-popup",alignment:"near",overlap:!1,getBody:function(){i._dataGridViewContainer=new e.Element("div"),i._dataGridViewContainer.addClassName("wux-controls-autoComplete-dataGridViewContainer");var o={treeDocument:i._model,columns:[{text:"Text",dataIndex:"tree",getCellTooltip:function(e){if(e.nodeModel)return{title:e.cellModel,shortHelp:e.nodeModel.getAttributeValue("description")||""}}}],cellSelection:"none",selectionBehavior:{toggle:!0},showAlternateBackgroundFlag:!1,showRowBorderFlag:!0,selectionStyle:"lightSelectionEdging",rowSelection:i.multiSearchMode?"multiple":"single",selectNextCellOnEnterFlag:!1,layoutOptions:{columnsHeader:!1,rowsHeader:!1}};if(i.compareCB&&(o.columns[0].compareFunction=i.compareCB,o.columns[0].getCellValueForSort=function(e){return e}),i.easySelectionMode!==G.SELECT_MODE_DISABLE){var s=i.selectedItems&&i.selectedItems.length>1||i.easySelectionMode===G.SELECT_MODE_MULTI;o=e.merge({rowSelection:"multiple",showRowIndexFlag:!1,selectionStyle:"",selectionBehavior:{toggle:s&&i.easySelectionMode!==G.SELECT_MODE_NONE,unselectAllOnEmptyArea:!1},showSelectionCheckBoxesFlag:!!s||"OnOver",layoutOptions:{columnsHeader:!1,rowsHeader:!0}},o)}return i._dataGridView=new a(o),i.compareCB&&i._applySortOrder(),i._dataGridView.touchMode=i.touchMode,i.customFilterMessage&&(i._dataGridView.placeholder=i.customFilterMessage),i._dataGridView.getContent().addClassName("wux-controls-autoComplete-dataGridView"),i._dataGridView.inject(i._dataGridViewContainer),t.addEventOnElement(i,i._dataGridView,"focus",(function(e){i._editor&&i._editor._giveFocus()})),i._dataGridView._getScroller().onScrollEnd((function(){i.popupSizeAdjustPolicy===n.SizeAdjustPolicyEnum.AdjustToVisibleContents&&v.call(i)})),i._dataGridView.addEventListener("click",(function(e,t){e.target.hasClassName("wux-layouts-datagridview-icon")&&t&&t.rowID>=0&&(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),i.onClickIcon(e,t))})),i._dataGridView.addEventListener("change",(function(e,t){if((i.easySelectionMode===G.SELECT_MODE_SINGLE||i.easySelectionMode===G.SELECT_MODE_MULTI)&&e.target&&t&&-1===t.columnID){var o=e.target.dsModel;if(!e.dsModel.selectionBehavior.toggle&&o.checkFlag)return e.dsModel.selectionBehavior.toggle=!0,void(e.dsModel.showSelectionCheckBoxesFlag=!0)}})),i._dataGridViewContainer},beforeDisplayCallback:function(){if(D.call(i),i._editor&&(""===i._editor.valueToCommit&&(!i._model||0===i._model.getRoots().length)&&!i._pendingPromise||void 0!==i._editor.valueToCommit&&i._editor.valueToCommit.length<i.minLengthBeforeSearch))return{preventDisplay:!0};i.elements.popup.getContent().setStyle("visibility","hidden"),i._popupVisibility=!1;let e=0,t=0;if(!i.multiSearchMode&&i._editor&&i._editor._myInput){const o=window.getComputedStyle(i._editor._myInput);0===parseInt(o.borderLeft.slice(0,-2))&&(e=-1,t=2),i.elements.popup.offset={x:e,y:4}}let o="";i.multiSearchMode&&(o=i._editor.valueToCommit),b.call(i,o),i._dataGridView&&i._dataGridView.setFindStr(o,!1,void 0,!0),i._DGVContainerFitWidth=i.elements.container.getBoundingClientRect().width+t,i._DGVContainerMinWidth=i._DGVContainerFitWidth,i._DGVContainerWidth=i._DGVContainerFitWidth,i._dataGridViewContainer.style.width=i._DGVContainerWidth+"px"}};this._delayPopupCreationInfos=n.delayPopupCreation(o,(function(e){i.elements.popup=e,i._editor.preventBlurForTargetedElements([i.elements.popup]),e.addEventListener("show",(async function(e){e.stopPropagation(),i._dataGridView.subscribeOnceToAllCellsRendered((function(){if(i._dataGridView.layout.prepareLayout(),i.popupSizeAdjustPolicy===n.SizeAdjustPolicyEnum.AdjustToVisibleContents){O.call(i)||v.call(i)}else O.call(i),v.call(i);i.fire("show")}))})),e.addEventListener("hide",(function(e){e.stopPropagation(),i.fire("hide")})),e.addEventListener("mousedown",(function(e){e.preventDefault()}))}))}},_applyProperties:function(e){if(this._parent(e),this.isDirty("placeholder")&&this._applyPlaceholder(e.placeholder),this.isDirty("multiSearchMode")&&this._applyMultiSearchMode(e.multiSearchMode),this.isDirty("elementsTree")&&this._applyElementsTree(e.elementsTree),this.isDirty("value")&&e&&e.hasOwnProperty("value"))this._applyValue(e.value);else if(this.isDirty("selectedItems")&&e&&e.hasOwnProperty("selectedItems"))this._applySelectedItems(e.selectedItems);else if(this.isDirty("elementsTree")&&this.elementsTree&&this.elementsTree instanceof l){var t=this.elementsTree.getXSO().get();t.length>0&&E.call(this,this._valueOperation,{operationType:this._valueUpdated.ADD,noOfItemsModified:t.length},(function(){this.selectedItems=t}))}this.isDirty("customFilterMessage")&&this._applyCustomFilterMessage(e.customFilterMessage),this.isDirty("allowResetToUndefinedByUIFlag")&&this._applyAllowResetToUndefinedByUIFlag(e.allowResetToUndefinedByUIFlag)},_applyDisabled:function(){this._parent(),this._editor&&(this._editor.disabled=this.disabled),this._selectionChips&&(this._selectionChips.disabled=this.disabled)},_applyPlaceholder:function(){this._editor&&(this._editor.placeholder=this.placeholder)},_applyMultiSearchMode:function(e){this.multiSearchMode?(this._editor&&!0===this.elements.container.hasChildNodes()&&this._editor.remove(),void 0!==this.elements.popup&&E.call(this,this._valueModifiedbyAPI,!0,(function(){this._dataGridView.rowSelection="multiple"})),this._selectionChips||T.call(this),this._editor&&this._editor._myInput&&this._selectionChips&&(this._editor._myInput.style.width="100%",this._editor.displayStyle="lite",this._selectionChips.addLastWidget(this._editor)),!1===this.elements.container.hasChildNodes()&&this._selectionChips.inject(this.elements.container)):(this._selectionChips&&!0===this.elements.container.hasChildNodes()&&this._selectionChips.remove(),this.elements.popup&&E.call(this,this._valueModifiedbyAPI,!0,(function(){this._dataGridView.rowSelection="single"})),this._editor&&this._editor._myInput&&!1===this.elements.container.hasChildNodes()&&(this._editor._myInput.style.width="100%",this._editor.displayStyle="text",this._editor.inject(this.elements.container))),this._applyAllowResetToUndefinedByUIFlag(),void 0!==e&&this.multiSearchMode!==e&&(this.isDirty("value")||this.isDirty("selectedItems")||(E.call(this,this._valueModifiedbyAPI,!0,(function(){this._model&&(this._model.getXSO().isEmpty()||this._model.getXSO().empty())})),this._properties.value.value=void 0,this._properties.selectedItems.value=void 0,this._selectionChips&&this._selectionChips.removeAllChips(),this._editor&&(this._editor.value="")))},_applyValue:function(e,t){if(void 0===this.value)return this.selectedItems=void 0,void(this._modelLoaded||this.fire("change"));var i=m.call(this,this.value);this.multiSearchMode?Array.isArray(this.value)||(this._properties.value.value=i):Array.isArray(this.value)&&(this._properties.value.value=i[0]),E.call(this,this._valueModifiedbyAPI,!0,(function(){for(var o=[],s=0;i.length>s;s++){var n=A.call(this,i[s])[0];if(!n&&i[s]&&""!==i[s])if(this.allowFreeInputFlag)n=new r({label:i[s],value:i[s],customNode:!0});else if(!this.multiSearchMode){if(this._modelLoaded)return this.value=e,void(this._editor.value=e);this._editor.value=t}n&&d.pushUnique(o,n)}this.selectedItems=this.multiSearchMode?o:o[0]})),y.call(this)},_applyElementsTree:function(e){this._modelLoaded=!1,(this.elements.popup&&this.elements.popup.visibleFlag||!this.elementsTree||this.elementsTree instanceof l||Array.isArray(this.elementsTree))&&I.call(this,this.elementsTree,!this.isDirty("value")&&!this.isDirty("selectedItems"))},_applyEasySelectionMode:function(){this._dataGridView&&(this.easySelectionMode===G.SELECT_MODE_DISABLE?(this._dataGridView.selectionBehavior.toggle=!0,this._dataGridView.showSelectionCheckBoxesFlag=!1):this.easySelectionMode===G.SELECT_MODE_NONE?(this._dataGridView.selectionBehavior.toggle=!1,this._dataGridView.showSelectionCheckBoxesFlag="OnOver"):this.selectedItems&&this.selectedItems.length>1||this.easySelectionMode===G.SELECT_MODE_MULTI?(this._dataGridView.selectionBehavior.toggle=!0,this._dataGridView.showSelectionCheckBoxesFlag=!0):this.easySelectionMode===G.SELECT_MODE_SINGLE&&(this._dataGridView.selectionBehavior.toggle=!1,this._dataGridView.showSelectionCheckBoxesFlag="OnOver"))},_applySortOrder:function(){this._dataGridView&&(this.sortOrder?this._dataGridView.sortModel=[{dataIndex:"tree",sort:this.sortOrder}]:this._dataGridView.sortModel&&(this._dataGridView.sortModel=null))},filterItems:function(e,t){if(this._model){var i=t&&t.property||"label",o=t&&t.type||"contains",s=t&&t.filterId||"stringRegexp";this._model.getFilterManager().setPropertyFilterModel(i,{filterId:s,filterModel:{condition1:{type:o,filter:e}}})}},_applySelectedItems:function(){var e=this,i=m.call(this,this.selectedItems);this.multiSearchMode?Array.isArray(this.selectedItems)||(this._properties.selectedItems.value=i):Array.isArray(this.selectedItems)&&(this._properties.selectedItems.value=i[0]);for(var o=[],s=0;s<i.length;s++)d.pushUnique(o,i[s]);if(i.length!==o.length&&(i=o,this.multiSearchMode?this._properties.selectedItems.value=i:this._properties.selectedItems.value=i[0]),this.multiSearchMode){this._properties.value.value=[],E.call(this,this._valueModifiedbyAPI,!0,(function(){this._model&&!this._model.getXSO().isEmpty()&&this._model.getXSO().empty();for(var t=0;i.length>t;t++)i[t].select();if(this._selectionChips){var o=[];let t;i.forEach((function(i){t=e.getChipInfo(i),d.pushUnique(o,{id:i.id,label:t.label,value:i,icon:t.icon,_iconOptions:t._iconOptions})})),this._selectionChips.removeAllChips(),this._selectionChips.addChips(o)}b.call(this,""),this._editor&&(this._editor.valueToCommit="",this._editor.value="")}));e=this;i.forEach((function(t){t.options.hasOwnProperty("value")&&void 0!==t.options.value?e._properties.value.value.push(t.options.value):e._properties.value.value.push(t.options.label)})),this._selectedImage&&this._selectedImage.hide()}else E.call(this,this._valueModifiedbyAPI,!0,(function(){if(this._valueOperation.operationType!==this._valueUpdated.REMOVE&&(this._model&&!this._model.getXSO().isEmpty()&&this._model.getXSO().empty(),i.length>0&&i[0]&&i[0].select()),this._editor){this._editor.value=i[0]?i[0].options.label:"";i[0]&&i[0].options.image;var e=i[0]?i[0].options.icons:[];if(e&&this._selectedImage){for(var o of(this._selectedImage.setContent(""),e))this._selectedImage.addContent(t.generateIcon(o));this._selectedImage.isHidden()&&this._selectedImage.show()}}else this._selectedImage&&this._selectedImage.hide();var s=void 0;i[0]&&(s=i[0].options.hasOwnProperty("value")&&void 0!==i[0].options.value?i[0].options.value:i[0].options.label),this._properties.value.value=s}));this.displayCustomNodeInDropDown&&this._model&&this._model.getNthRoot(0)&&this._model.getNthRoot(0).options.customNode&&this._model.removeRoot(this._model.getNthRoot(0)),this.fire("change")},_showPopup:function(){if(this.elements.popup){if(this.elements.popup.visibleFlag)return;this.elements.popup.visibleFlag=!0}else this._delayPopupCreationInfos&&"function"==typeof this._delayPopupCreationInfos.createVisiblePopup&&this._delayPopupCreationInfos.createVisiblePopup()},_hidePopup:function(){if(this.elements.popup&&this.elements.popup.visibleFlag&&(this.elements.popup.visibleFlag=!1,this._editor)){var e=this;setTimeout((function(){e._editor&&!e._editor._isFocused()&&e._editor._giveFocus()}),1)}},_giveFocus:function(){this._parent(),this._editor&&this._editor._giveFocus()},_applyCustomFilterMessage:function(){this._dataGridView&&(this._dataGridView.placeholder=this.customFilterMessage)},_applyAllowResetToUndefinedByUIFlag:function(){this._editor&&(this._editor.displayClearFieldButtonFlag=this.allowResetToUndefinedByUIFlag&&!this.multiSearchMode)},_applyTouchMode:function(){this._parent(),this._getCurrentTouchMode()?this.elements.container.setAttributeNode(document.createAttribute("touch-mode")):this.elements.container.removeAttribute("touch-mode"),this._editor&&(this._editor.touchMode=this.touchMode),this._selectionChips&&(this._selectionChips.touchMode=this.touchMode),this._dataGridView&&(this._dataGridView.touchMode=this.touchMode)},getValueToCommit:function(){return this._editor?this._editor.valueToCommit:""},showLoader:function(e){this._dataGridView.displayModalLoader(e||"")},hideLoader:function(e){this._dataGridView.removeModalLoader(e||"")},updateIcons:function(e,i){if(e)if(this.multiSearchMode)this._selectionChips&&i&&this._applyMultiSearchMode(!1);else if(this._selectedImage)for(var o of(this._selectedImage.setContent(""),e))this._selectedImage.addContent(t.generateIcon(o))},destroy:function(){this._dataGridView&&this._dataGridView.destroy(),this._parent()}});return e.extend(G,{SELECT_MODE_DISABLE:0,SELECT_MODE_NONE:1,SELECT_MODE_SINGLE:2,SELECT_MODE_MULTI:3}),G})),define("DS/CfgBulkTablePresenter/BulkEdition/Model/BulkTableModel",["UWA/Core"],(function(e){"use strict";class t{constructor(e){this._status="Unselected",this._variant=e,this._controlEnabled=!0}disableControl(){this._controlEnabled=!1}enableControl(){this._controlEnabled=!0}get status(){return this._status}set status(e){this._controlEnabled?("Chosen"===e&&this._variant.values.forEach((e=>{"Chosen"!==e.status&&"Selected"!==e.status||(e.status="Unselected")})),this._status=e):this._status=e}}return class{constructor(e){this._variabilityMap=new Map,this._parametersMap={},this._columnsMap={},this._jsonModel={},this._initJsonModel(),this._mapDico=e||{},this._snapshotMatrixColumnsMap=new Map,this._mapDico&&this._mapDico.features&&(this._jsonModel.rowHeaders=this.createRowHeaders(this._mapDico.features),this._initVariabilityValueMap())}_initJsonModel(){this._jsonModel.columnHeaders=[],this._jsonModel.rowHeaders=[],this._jsonModel.columnsValidity=[],this._jsonModel.columnsSuggestions=[],this._jsonModel.matrix=[]}_createVariantValueCellData(e){return new t(e)}_initCellData(t,i){t.status="Unselected",t.stateValidity="V",e.is(t.numericalValue)||(t.Criterion=i.ruleId)}getJsonModel(){return this._jsonModel}getColumnHeader(e){if(e>=0)return this._jsonModel.columnHeaders[e]}createColumn(t){if(t&&this._columnsMap&&!this._columnsMap[t.id]){var i={};i.id=t.id,i.title=t.title+(e.is(t.revision,"string")?" "+t.revision:""),i.type=t.type,i.attributes=t.hasOwnProperty("attributes")?t.attributes:t,i.parentId=t.modelID,i.objectId=t.id,i.isDuplicate=t.isDuplicate,i.isAsReference=!1,this._columnsMap[i.id]={columnID:this._jsonModel.columnHeaders.length,columnData:i},this._jsonModel.columnHeaders.push(i),this._jsonModel.columnsValidity.push("V"),this._jsonModel.columnsSuggestions.push(!1);let o=this.createColumnMap();this._jsonModel.matrix.push(o),this.addColumnToSnapshot(t.id,o)}}removeColumns(t){var i=this;if(t&&e.is(t,"array")&&t.length>0){if(t.length===this._jsonModel.columnHeaders.length)return this._jsonModel.columnHeaders=[],this._jsonModel.matrix=[],this._jsonModel.columnsValidity=[],void(this._columnsMap={});var o=new Set(t.map((e=>i._columnsMap[e.id].columnID)));if(0===o)return;for(var s of(this._jsonModel.columnHeaders=this._jsonModel.columnHeaders.filter(((e,t)=>!o.has(t))),this._jsonModel.matrix=this._jsonModel.matrix.filter(((e,t)=>!o.has(t))),this._jsonModel.columnsValidity=this._jsonModel.columnsValidity.filter(((e,t)=>!o.has(t))),t))delete this._columnsMap[s.id]}}createRowHeaders(e){var t=[];if(e){for(var i=0;i<e.length;i++){var o={};if(o.id=e[i].ruleId,o.title=e[i].displayName,o.description=e[i].description,o.type=e[i].type,o.sequenceNumber=e[i].sequenceNumber,o.image=e[i].image,o.usage=e[i].selectionCriteria,o.mandatory=!0,"Mandatory"!==e[i].selectionCriteria&&(o.mandatory=!1),o.commercial=e[i].commercial,e[i].values&&(o.children=this._getVariabilityValues(e[i])),"Parameter"===e[i].type){var s=[],n={},a={},l={};n.value=e[i].minValue,n.unit=e[i].minUnit,a.value=e[i].maxValue,a.unit=e[i].maxUnit,l.max=a,l.min=n,s.push(l),o.range=s}t.push(o)}return t}}_initVariabilityValueMap(){e.is(this._mapDico)&&e.is(this._mapDico.features,"array")&&this._mapDico.features.forEach((t=>{var i=t.options;i.length>0&&i.forEach((t=>{let i={};i.id=t.ruleId,i.title=t.displayName,this._variabilityMap.set(i.id,e.merge(t,i))}));let o={};o.id=t.ruleId,o.title=t.displayName,this._variabilityMap.set(t.ruleId,e.merge(t,o))}))}createColumnMap(){var e=new Map;return this._mapDico.features.forEach((t=>{if("Parameter"!==t.type){let i={values:new Map};t.options.forEach((o=>{let s=null;s="Option"===o.type?{status:"Unselected",stateValidity:"V",Value:!0}:this._createVariantValueCellData(i,t.selectionCriteria),this._initCellData(s,t),e.set(o.ruleId,s),i.values.set(o.ruleId,s)})),e.set(t.ruleId,i)}else{let i={unit:t.unit,numericalValue:null,status:null,stateValidity:null,minValue:t.minValue,maxValue:t.maxValue};this._initCellData(i,t),e.set(t.ruleId,i)}})),e}_getVariabilityValues(e){var t=[];if(e&&e.values.length>0)for(var i=0;i<e.values.length;i++){var o={};o.id=e.values[i].ruleId,o.title=e.values[i].displayName,o.description=e.values[i].description,o.type=e.values[i].type,o.sequenceNumber=e.values[i].sequenceNumber,o.image=e.values[i].image,t.push(o)}return t}getVariabilityValuesMap(){return this._variabilityMap}getParametersMap(){return this._parametersMap}snapshot(e){this._jsonModel.columnHeaders.forEach(((t,i)=>{e&&e==t.id?this.addColumnToSnapshot(t.id,this._jsonModel.matrix[i]):e||this.addColumnToSnapshot(t.id,this._jsonModel.matrix[i])}))}restoreSnapshot(){this._jsonModel.columnHeaders.forEach(((e,t)=>{this.copyColumnMap(this._snapshotMatrixColumnsMap.get(e.id),this._jsonModel.matrix[t])}))}addColumnToSnapshot(e,t){let i=null;i=this._snapshotMatrixColumnsMap.get(e)?this._snapshotMatrixColumnsMap.get(e):this.createColumnMap(),this.copyColumnMap(t,i),this._snapshotMatrixColumnsMap.set(e,i)}updateSuggestionForColumn(t){e.is(this._jsonModel.columnsSuggestions[t],"boolean")&&(this._jsonModel.columnsSuggestions[t]=!0,!this.getColumnHeader(t).isDirty&&this._snapshotMatrixColumnsMap&&this.copyColumnMap(this._jsonModel.matrix[t],this._snapshotMatrixColumnsMap.get(this._jsonModel.columnHeaders[t].id)))}getColumnData(e){return e>=0&&this._jsonModel&&this._jsonModel.matrix&&this._jsonModel.matrix[e]?this._jsonModel.matrix[e]:null}getColumnHeaders(){return this._jsonModel.columnHeaders}getColumnID(e){var t;if(e)for(var i=0;i<this._jsonModel.columnHeaders.length;i++)if(this._jsonModel.columnHeaders[i].id===e)return t=i;return t}getColumnIndexFromColumnMap(t){if(e.is(t,"string")&&e.is(this._columnsMap[t]))return this._columnsMap[t].columnID}getColumnAttributes(t){if(e.is(t,"string")&&e.is(this._columnsMap[t]))return this._columnsMap[t].columnData.attributes}getColumnLength(){return this._jsonModel.columnHeaders.length}getMatrixCellData(e,t){return this._jsonModel.matrix[e]?this._jsonModel.matrix[e].get(t):null}getDirtyColumnHeaders(){return this._jsonModel.columnHeaders.filter((e=>e.isDirty))}getDirtyColumnIDs(){var e=[];return this.getDirtyColumnHeaders().forEach((function(t){e.push(t.id)})),e}clearColumnHeaders(){this._jsonModel.columnHeaders.forEach((function(e){e.isDirty=!1}))}getRowHeaderData(e){return this._jsonModel.rowHeaders[e]}getNbRows(){for(var e=0,t=0;t<this._jsonModel.rowHeaders.length;t++)this._jsonModel.rowHeaders[t].children&&(e+=this._jsonModel.rowHeaders[t].children.length),e++;return e}isColumnEmpty(t){if(t>=0){var i=this.getColumnData(t);if(i&&i.length>0)for(var o=0;o<i.length;o++)if(e.is(i[o],"array")){if(i[o].length>0)return!1}else if(i[o].title&&""!==i[o].title)return!1}return!0}getCellType(e){if(e>=0)return this.getRowHeaderData(e).type}setColumnAsReferenceInModel(e){this._jsonModel.columnHeaders[e].isAsReference=!0}getColumnAsReference(){for(var e,t=0;t<this._jsonModel.columnHeaders.length;t++)this._jsonModel.columnHeaders[t].isAsReference&&(e=this._jsonModel.columnHeaders[t]);return e}unSetColumnAsReferenceInModel(e){this._jsonModel.columnHeaders[e].isAsReference=!1}getColumnAsReferenceData(){var e,t=this.getColumnAsReference();if(t&&t.id){var i=this.getColumnID(t.id);e=this.getColumnData(i)}return e}getReferenceCellData(e){var t,i=this.getColumnAsReferenceData();return i&&(t=i.get(e)),t}convertBCStatusToPCStatus(e){var t="";switch(e){case"Selected":t="Required";break;case"Default":t="Default";break;case"Not Available":t="Incompatible";break;default:t="Unselected"}return t}checkConflictInBC(e){if(this._mapDico&&this._mapDico.features&&e)for(var t=0;t<this._mapDico.features.length;t++){var i=this._mapDico.features[t];if("Variant"===i.type&&"Optional"!=i.selectionCriteria){for(var o=0,s=0;s<i.options.length;s++){var n=i.options[s].ruleId;if(e.length>0)e.some((e=>e.Id===n&&"Incompatible"===e.State))&&o++}if(o===i.options.length)return!0}}return!1}copyColumnMap(t,i){t.forEach(((t,o)=>{t.status?i.get(o).status=t.status:t.values&&t.values.forEach(((t,o)=>{let s=i.get(o);e.is(s.disableControl,"function")&&s.disableControl(),i.get(o).status=t.status,e.is(s.enableControl,"function")&&s.enableControl()})),t.numericalValue&&(i.get(o).numericalValue=t.numericalValue)}))}duplicateColumn(t){var i=this.getColumnID(t),o=e.clone(this._jsonModel.columnHeaders[i]);o.id="duplicate_"+this._jsonModel.columnHeaders.length+"_"+o.id,o.title="Copy Of "+o.title,o.isDuplicate=!0,this.createColumn(o);let s=this._jsonModel.matrix[i],n=this._jsonModel.matrix[this._jsonModel.columnHeaders.length-1];return this.copyColumnMap(s,n),o}emptyDuplicates(){let e=[];this._jsonModel.columnHeaders.forEach((t=>{t.isDuplicate&&e.push(t.id)}),this),this.removeColumns(e)}getCriteriaType(t){var i="";if(e.is(this._mapDico.features))for(var o=this._mapDico.features,s=0;s<o.length;s++){var n=o[s];if(n.ruleId===t){i=n.type;break}if(e.is(n.options)&&n.options.length>0)for(var a=0;a<n.options.length;a++)if(n.options[a].ruleId===t){i=n.options[a].type;break}}return i}}})),define("DS/CfgBulkTablePresenter/BulkEdition/Presenter/BulkTablePresenter",["UWA/Class","UWA/Core","DS/TreeModel/TreeNodeModel","DS/TreeModel/TreeDocument","DS/DataGridView/DataGridView","DS/ENOXCollectionToolBar/js/ENOXCollectionToolBarV2","DS/UIKIT/Mask","DS/Handlebars/Handlebars","DS/UIKIT/Input/Button","DS/Controls/ProgressBar","i18n!DS/CfgBulkTablePresenter/assets/nls/BulkTablePresenter","text!DS/CfgBulkTablePresenter/BulkEdition/View/BulkTablePresenter.html","css!DS/CfgBulkTablePresenter/BulkEdition/Presenter/BulkTablePresenter.css"],(function(e,t,o,s,n,a,l,r,d,h,u,c){"use strict";return e.extend({init:function(e){e=e||{},this._showEditAction=!!e.showEditAction&&e.showEditAction,this._showCompareAction=!!e.showCompareAction&&e.showCompareAction,this._showPainter=!!e.showPainter&&e.showPainter,this._conflictColumn={},this._editionflag=!1,this._compareFlag=!1,this._columnOptionsForDGV=e.columnOptions||void 0},_createBulkTableDGV:function(e){this._jsonModel=e.jsonModel,this._presenterState=e.presenterState,this._dropDownData=e.dropDownData,this._modelEvent=e.modelEvent,this._expandAll=e.expandAll,this._statusBarOptions=e.statusBarOptions,this._setAsReferenceItem=!!this._showCompareAction&&e.setAsReferenceItem,this.COLUMN_ID_INDEX=e.COLUMN_ID_INDEX,this._createLayout(),this.createDataGridView(),this._subscribeToEvents(),this._createBottomBar(),this._createCollectionToolBar(),this.rendrer()},_createLayout:function(){var e=r.compile(c)();this._container=t.createElement("div",{class:"bulk-edit-container"}),this._container.innerHTML=e},getView:function(){return this._dataGridView},createDataGridView:function(){var e=this;this._treeDocument=this._createTreeDocument(this._jsonModel.rowHeaders);var i={};this._columnOptionsForDGV&&(i.columns=this._columnOptionsForDGV);var o=this.isEditable();return i.treeDocument=this._treeDocument,i.selectionMode="cell",i.defaultColumnDef={editableFlag:o,resizableFlag:!0,sortableFlag:!0,allowUnsafeHTMLContent:!1,width:250},i.showOutlineFlag=!0,this._dataGridView=new n(i),this._createStatusBar(),this._dataGridView.columnDragEnabledFlag=!1,this._dataGridView.columns[0].sortableFlag=!0,this._dataGridView.showRowBorderFlag=!0,this._dataGridView.layout.rowsHeader=!1,this._dataGridView.onContextualEvent=function(i){var o=[];if(i&&i.collectionView&&(i.cellInfos&&i.cellInfos.rowID<=-1)){(o=i.collectionView.buildDefaultContextualMenu(i,{pin:!1,firstColumnsVisibility:!0,columnsManagement:!1,sizeColumnToFit:!1,insertRow:!1}))[0].state="selected|disabled";var s=1;if(t.is(i.collectionView.columns[0])&&("productConfiguration"!==i.collectionView.columns[0].dataIndex&&"tree"!==i.collectionView.columns[0].dataIndex||(s=e.COLUMN_ID_INDEX)),o=o.filter((e=>"type"===e.action.context.id||"sequenceNumber"===e.action.context.id||"commercial"===e.action.context.id)),e._setAsReferenceItem&&i.collectionView.columns.length>=s){var n={type:"CheckItem",title:u.SetAsReference,action:{callback:function(t){e._onChangeCompareFlag(t.context)},context:i.cellInfos}};if(e._jsonModel.columnHeaders.length>=2)if("tree"===this.layout.columns[0].dataIndex)"left"===this.layout.getColumnPinned(i.cellInfos.columnID)&&(n.state="selected|disabled");else{var a=0;a=i.cellInfos.rowID<-1?this.layout.getOrderedColumnsIndexes()[i.cellInfos.columnID]:i.cellInfos.columnID,"left"===this.layout.getColumnPinned(a)&&(n.state="selected|disabled")}else n.state="disabled";o.unshift(n)}}return o},this._dataGridView.onReady((function(){e._treeDocument.prepareUpdate(),e._treeDocument.expandAll(),e._treeDocument.pushUpdate(),e._dataGridView.getContent().setStyles({height:"100%",position:"relative"})})),this._dataGridView.addEventListener("click",(function(t,i){i&&i.rowID>=0&&i.columnID>=3&&e._modelEvent.publish({event:"OnDataGridCellClick",data:{cellInfos:i,event:t}})})),this._treeDocument.setUseChangeTransactionMode(!0),this._dataGridView},getPresenterState:function(){return this._presenterState},isEditable:function(){return"preview-mode"!==this._presenterState},clickSave:function(){l.mask(this._container);var e=this.saveMassEdit(),t=this;return e.then((function(){t.onTableUpdateEnd()})).catch((function(){l.unmask(t._container),t.onTableUpdateEnd()})),e},clickCancel:function(){this._bulkTableModel.restoreSnapshot(),this.onTableUpdateEnd()},_createBottomBar:function(){this._savePCContainer=this._container.querySelector("#bulk-edit-save"),this._cancelPCContainer=this._container.querySelector("#bulk-edit-cancel"),this._saveBtn=new d({value:u.Save,className:"primary",disabled:!0}).inject(this._savePCContainer),this._CancelBtn=new d({value:u.Cancel}).inject(this._cancelPCContainer);var e=this;this._saveBtn.addEvent("onClick",(function(){this.setFocus(!1),e.clickSave()})),this._CancelBtn.addEvent("onClick",(function(){e._saveBtn.disable(),this.setFocus(!1),e.clickCancel()}))},_subscribeToEvents:function(){var e=this;this._modelEvent.subscribe({event:"enox-collection-toolbar-sort-activated"},(function(t){var i={dataIndex:t.sortAttribute,sort:t.sortOrder.toLowerCase(),id:t.sortAttribute,order:t.sortOrder.toLowerCase()};e._collectionToolbar._activateCurrentSort(i),e._dataGridView&&(e._dataGridView.sortModel&&1===e._dataGridView.sortModel.length&&e._dataGridView.sortModel[0].dataIndex===i.dataIndex&&e._dataGridView.sortModel[0].sort===i.sort?e._dataGridView.reapplySortModel():e._dataGridView.sortModel=[i])})),this._modelEvent.subscribe({event:"enox-collection-toolbar-filter-search-value"},(function(i){if(i.searchValue.length>0){for(var o=0,s=[],n=e._bulkTableModel.getJsonModel(),a=e._treeDocument.getRoots().length,l=e._treeDocument.getRoots(),r=0;r<l.length;r++)t.is(l[r].options.children)&&t.is(l[r].options.children.length>0)&&(a+=l[r].options.children.length);var d=e._treeDocument.search({match:function(a){var l,r,d=a.nodeModel.getAttributeValue("title").toLowerCase(),h=i.searchValue[0].toLowerCase();if(t.is(e._dataGridView.columns[1])&&t.is(e._dataGridView.columns[1].visibleFlag)&&"variabilitygroup"===(l=a.nodeModel.getAttributeValue("type").toLowerCase())&&(l=u.OptionGroup.toLocaleLowerCase()),t.is(e._dataGridView.columns[2])&&t.is(e._dataGridView.columns[2].visibleFlag)&&(r=a.nodeModel.getAttributeValue("sequenceNumber").toString()),d.includes(h))return o++,!0;if(l&&l.includes(h))return o++,!0;if(r&&r.includes(h))return o++,!0;if(t.is(e.isSearchedValueInDGVContent,"function")){var c=a.nodeModel.getAttributeValue("id");if(e.isSearchedValueInDGVContent(c,h,n))return o++,!0}return s.push(a.nodeModel),!1},shouldStop:function(){return o===a}});if(s.length>0){var h=[],c=[],p=[];s.forEach((function(e){t.is(e.options.children)&&t.is(e.options.children.length>0)?d.forEach((function(i){t.is(i.options.grid.parentId)&&i.options.grid.parentId===e.options.grid.id?(c.push(e),p.push(i)):h.push(e)})):h.push(e)})),h.forEach((function(e){e.hide()})),d.length>0&&(d.forEach((function(e){t.is(e.options.children)&&t.is(e.options.children.length>0)&&e.options.children.forEach((function(e){e.show()})),e.show()})),c.forEach((function(e){e.show()})),p.forEach((function(e){e.show()})))}else s.length<=0&&d.length>0&&d.forEach((function(e){e.show()}))}else e._treeDocument.getRoots().forEach((function(e){e.show(),t.is(e.options.children)&&t.is(e.options.children.length>0)&&e.options.children.forEach((function(e){e.show()}))}))})),this._modelEvent.subscribe({event:"bulkEdit-on-change"},(function(){e._saveBtn.enable()})),this._privateChannel.subscribe({event:"cell-selected"},(function(t){e._privateChannel.publish({event:"dgv-cell-selected",data:t})}))},onTableUpdateStart:function(){let e={id:"edit-pencil",icon:"pencil",text:u.Disable_Edit};this._privateChannel.publish({event:"enox-collection-toolbar-color-selected-action",data:e}),this._privateChannel.publish({event:"enox-collection-toolbar-change-text-tooltip-action",data:e}),this._presenterState="edition-mode",this._bulkTableModel.snapshot()},onTableUpdateEnd:function(){if(this._saveBtn.disable(),!this._editionflag){let e={id:"edit-pencil",fonticon:"pencil",text:u.Enable_Edit};this._privateChannel.publish({event:"enox-collection-toolbar-color-selected-action",data:e}),this._privateChannel.publish({event:"enox-collection-toolbar-change-text-tooltip-action",data:e}),this._presenterState="preview-mode"}this._bulkTableModel.getDirtyColumnHeaders()&&this._bulkTableModel.clearColumnHeaders(),this._bulkTableModel.snapshot()},saveMassEdit:function(){var e=this._bulkTableModel.getDirtyColumnHeaders(),t=this;return this.batchSaving(e,e.length).then((function(){t._bulkTableModel.clearColumnHeaders()}))},batchSaving:function(e,t,i){var o=this;return o._progressBar.visibleFlag=!0,o._progressBar.infiniteFlag=t-e.length==0,new Promise((s=>{var n=[];e.length&&n.push(o.saveElement(e.shift()));var a=[];i&&i.length>0&&(a=i),n.length?Promise.allSettled(n).then((i=>{var n=[];i.forEach((function(e){"fulfilled"===e.status?n.push(e.value):a.push(e.reason)})),o._progressBar.infiniteFlag=!1,o._progressBar.value=(t-e.length)/t*100,o.batchSaving(e,t,a).then(s()),n&&o._modelEvent.publish({event:"pcsbulk-on-save-update",data:n})})):(a.length>0?(o._modelEvent.publish({event:"pcsbulk-on-save-failed",data:a}),console.error("Save PCs failed",a)):o._modelEvent.publish({event:"pcsbulk-on-save-done"}),s(),o._progressBar.visibleFlag=!1)}))},beforeClosing:function(){var e=this;return new Promise((function(t){e._bulkTableModel.getDirtyColumnHeaders().length?(e._applicationChannel.subscribeOnce({event:"warning-dialog-save-button-clicked"},(function(){e.clickSave().then(t())})),e._applicationChannel.subscribeOnce({event:"warning-dialog-dontsave-button-clicked"},(function(){e.clickCancel(),t()})),e._applicationChannel.subscribeOnce({event:"warning-dialog-cancel-button-clicked"},(function(){t(!0)}))):t()}))},_createStatusBar:function(){var e=[{type:0,id:"totalRows",dataElements:{typeRepresentation:"string",value:this._statusBarOptions.totalRowsLabel+" : "+this._statusBarOptions.nbRows,displayLabel:!0}},{type:0,id:"totalColumn",dataElements:{typeRepresentation:"string",value:this._statusBarOptions.totalColumnLabel+" : "+this._statusBarOptions.nbColumns,displayLabel:!0}},{type:0,id:"nbConflict",dataElements:{typeRepresentation:"string"}}];this._statusBarOptions.withStatusInfo&&(e.push({type:0,id:"statusConflict",dataElements:{position:"far",typeRepresentation:"string",value:u.Conflicts_Computing+" : 0%",displayLabel:!0,icon:"clock"}}),this._statusBarOptions.withStatusComputing&&(e[3].dataElements.value=u.Status_Computing+" : 0%",e[3].id="statusComputing")),this._statusBarOptions.withSuggestionsComputing&&e.push({type:0,id:"statusSuggestion",dataElements:{position:"far",typeRepresentation:"string",value:u.Constraints_Computing+" : 0%",displayLabel:this._statusBarOptions.withSuggestionsComputing,icon:"clock"}}),this._statusBarOptions.withInvalidColumn&&e.push({type:0,id:"invalidColumn",dataElements:{typeRepresentation:"string",displayLabel:!0}}),this._dataGridView.buildStatusBar(e)},_updateStatusBar:function(e){e&&this._dataGridView.elements.statusBar.getNodeModelByID(e.id).updateOptions({grid:{data:e.text,semantics:{icon:e.icon}}})},_createCollectionToolBar:function(){var e=this,i=[{id:"edit-pencil",fonticon:"pencil",text:u.Enable_Edit,handler:function(){e.onChangeEditionFlag()}},{id:"duplicate",fonticon:"duplicate",text:u.Duplicate,handler:function(){e.onCopySelectionFlag()}},{id:"compare-pc",fonticon:"variants-and-options-compare",text:u.HighlightDifferences,handler:function(){e._onChangeCompareFlag()}}];this._showPainter&&i.push({id:"painter",fonticon:"brush",text:u.Painter,disabled:!1,content:[{id:"painter-not-available",text:u.NA,fonticon:"brush-block",changeIconSelection:!0},{id:"painter-available",text:u.Available,fonticon:"brush",changeIconSelection:!0},{id:"painter-default",text:u.Default,fonticon:"brush-favorite",changeIconSelection:!0},{id:"painter-selected",text:u.Selected,fonticon:"brush-ok",changeIconSelection:!0},{id:"painter-none",text:u.None,fonticon:"brush",changeIconSelection:!0}]});var o=[];if(t.is(this._columnOptionsForDGV)&&t.is(this._columnOptionsForDGV,"array"))for(var s=0;s<this._columnOptionsForDGV.length;s++)switch(this._columnOptionsForDGV[s].children?this._columnOptionsForDGV[s].children[0]&&this._columnOptionsForDGV[s].children[0].children?this._columnOptionsForDGV[s].children[0].children[0].dataIndex:"":this._columnOptionsForDGV[s].dataIndex){case"tree":o.push({id:"tree",text:u.Variability,type:"string"});break;case"type":o.push({id:"type",text:u.Type,type:"string"});break;case"sequenceNumber":o.push({id:"sequenceNumber",text:u.SequenceNumber,type:"integer"})}var n={modelEvents:this._modelEvent,touchMode:!0,actions:i,filter:{enableCache:!0,width:400},withStableActions:!0,useGeneratedToolbar:!0,sort:o,withInformation:!1};return this._collectionToolbar=new a(n),this._collectionToolbar},_onChangeCompareFlag:function(e){var t=this,i=this._bulkTableModel.getDirtyColumnHeaders(),o=!1;if(this._bulkTableModel.getJsonModel().columnHeaders.length>=2)if(this._compareFlag)if(e){o=i.some((i=>t._bulkTableModel.getColumnID(i.id)===e.columnID-t.COLUMN_ID_INDEX));var s=0;s=e.rowID<-1?this._dataGridView.layout.getOrderedColumnsIndexes()[e.columnID]:e.columnID,o?this.beforeClosing().then((function(){t.unSetColumnAsReference(!0),t.setColumnAsReference(s)})):(this.unSetColumnAsReference(!0),this.setColumnAsReference(s))}else this.unSetColumnAsReference(!1);else{var n=0;n=e?e.columnID:t.COLUMN_ID_INDEX,(o=i.some((e=>t._bulkTableModel.getColumnID(e.id)===n-t.COLUMN_ID_INDEX)))?this.beforeClosing().then((function(){t.setColumnAsReference(n)})):t.setColumnAsReference(n)}},setColumnAsReference:function(){if(!this._compareFlag){let e={id:"compare-pc",icon:"variants-and-options-compare",text:u.UnHighlightDifferences};this._compareFlag=!0,this._privateChannel.publish({event:"enox-collection-toolbar-color-selected-action",data:e}),this._privateChannel.publish({event:"enox-collection-toolbar-change-text-tooltip-action",data:e})}},unSetColumnAsReference:function(e){if(!e){let e={id:"compare-pc",fonticon:"variants-and-options-compare",text:u.HighlightDifferences};this._compareFlag=!1,this._privateChannel.publish({event:"enox-collection-toolbar-color-selected-action",data:e}),this._privateChannel.publish({event:"enox-collection-toolbar-change-text-tooltip-action",data:e})}},onChangeEditionFlag:function(e=!1){var t=this;this.beforeClosing().then((function(i){if(!i)if(t._editionflag){if(t._editionflag=!1,t._painterEnabled){t._privateChannel.publish({event:"enox-collection-toolbar-change-icon-action",data:{id:"painter",text:"None",fonticon:"brush",changeIconSelection:!0,parent:"painter"}}),t._privateChannel.publish({event:"enox-collection-toolbar-action-activated",data:"painter-none"})}0===t._bulkTableModel.getDirtyColumnHeaders().length&&t.onTableUpdateEnd()}else e||(t._editionflag=!0,t.onTableUpdateStart())})).catch((function(e){console.error(e)}))},_createTreeDocument:function(e){var t,i=new s({useAsyncPreExpand:this._expandAll});i.prepareUpdate();for(var n=0;n<e.length;n++){var a=e[n];if(a.rowIndex=n,t=new o({id:e[n].id,label:e[n].title,icons:[e[n].image],grid:a}),i.addChild(t),e[n].children&&e[n].children.length>0)for(var l=0;l<e[n].children.length;l++){var r=e[n].children[l];r.cellType="content";var d=new o({id:e[n].children[l].id,label:e[n].children[l].title,icons:[e[n].children[l].image],grid:r});t.addChild(d)}this._expandAll&&t.setState({state:"expanded"})}return i.expandAll(),i.pushUpdate(),i},countConflictInColumn:function(e){var t;if(e>=0){var o=this._jsonModel.matrix[e];o&&o.forEach((t=>{if(t&&t.stateValidity&&t.state)if("C"===t.stateValidity)this._conflictColumn[e]?this._conflictColumn[e].rowID.includes(i)||this._conflictColumn[e].rowID.push(i):this._conflictColumn[e]={columnID:e,rowID:[i],visible:!0};else if(this._conflictColumn[e]&&this._conflictColumn[e].rowID.includes(i)){var o=this._conflictColumn[e].rowID.indexOf(i);this._conflictColumn[e].rowID.splice(o,1),0===this._conflictColumn[e].rowID.length&&delete this._conflictColumn[e]}}))}this._conflictColumn[e]&&this._conflictColumn[e].rowID&&(t=this._conflictColumn[e].rowID.length),this.updateNBConflictInStatusBar(t)},updateNBConflictInStatusBar:function(e){var t,i=this._countNotVisibleConflict();if(this._conflictColumn)if(e&&e>0)if(i&&i>0){var o=e-i;t={id:"nbConflict",text:u.Number_Conflict+" : "+o+"/"+e,icon:"attention"},this._updateStatusBar(t)}else t={id:"nbConflict",text:u.Number_Conflict+" : "+e,icon:"attention"},this._updateStatusBar(t);else t={id:"nbConflict"},this._updateStatusBar(t)},_countNotVisibleConflict:function(){var e=0;for(var t in this.conflictColumn)this.conflictColumn[t].rowID&&(this.conflictColumn[t].visible||(e+=this.conflictColumn[t].rowID.length));return e},destroy:function(){this._container.innerHTML=""},rendrer:function(){this._container&&(this._progressBar=new h({displayStyle:"lite",visibleFlag:!1}),this._progressBar.inject(this._container.querySelector("#progressbar")),this._collectionToolbar.inject(this._container.querySelector("#toolbar")),this._dataGridView.inject(this._container.querySelector("#table")),this._showEditAction||this._modelEvent.publish({event:"enox-collection-toolbar-visibility-action",data:{id:"edit-pencil",flag:!1}}),this._showCompareAction||this._modelEvent.publish({event:"enox-collection-toolbar-visibility-action",data:{id:"compare-pc",flag:!1}}))},getConflictColumn:function(){return this._conflictColumns}})})),define("DS/CfgBulkTablePresenter/BulkEdition/Presenter/AbstractBulkTablePresenter",["UWA/Core","DS/CoreEvents/ModelEvents","DS/UIKIT/Mask","DS/xModelEventManager/xModelEventManager","DS/CfgBulkTablePresenter/BulkEdition/Presenter/BulkTablePresenter","i18n!DS/CfgBulkTablePresenter/assets/nls/AbstractBulkTablePresenter"],(function(e,t,i,o,s,n){"use strict";return s.extend({init:function(i){i||(i={}),this._applicationChannel=i.applicationChannel||new t,this._privateChannelForRules=i.privateChannelForRules||new t,e.is(i.showPainter,"boolean")||(i.showPainter=!0),this._painterEnabled=!1,this._previousPainterState=!1,this._parent(i),this._createBulkTableDGV(i)},_createBulkTableDGV:function(e){var t={jsonModel:e.jsonModel,COLUMN_ID_INDEX:e.COLUMN_ID_INDEX,presenterState:"preview-mode",modelEvent:this._privateChannel,statusBarOptions:{nbRows:e.jsonModel.rowHeaders.length,nbColumns:e.jsonModel.columnHeaders.length,totalColumnLabel:n.TotalBaseConfigurations,totalRowsLabel:n.TotalVariability,withStatusInfo:!0,withStatusComputing:!0,withSuggestionsComputing:!0},setAsReferenceItem:!0};this._container&&(this.destroy(),this._eventManager=new o(this._privateChannel,this._applicationChannel,this._privateChannelForRules)),this._parent(t)},_subscribeToEvents:function(){this._parent()},inject:function(e){this._container.inject(e)},getPainterState:function(){return this._painterEnabled},getPainterPreviousState:function(){return this._previousPainterState},setPainterPreviousState:function(e){this._previousPainterState=e}})}));