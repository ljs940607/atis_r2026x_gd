/*!  Copyright 2014 Dassault Systemes. All rights reserved. */
define("DS/CAT3DComposeDirectMove/CAT3DComposeDirectMove",["UWA/Core","UWA/Class","DS/Selection/HSOManager","DS/Selection/CSOManager","DS/CATW3DGeometry/CATW3DEquivalentGeometry","DS/Manipulators/ScreenPlaneManipulator","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Mesh/MeshUtils","DS/SceneGraphNodes/AxisSystemNode","DS/CATW3DConstraints/CATW3DConstraintsController","DS/CATW3DUtils/CATW3DUtils","DS/CATW3DAnims/CATW3DAnimation3D","DS/CATWebUXSelectionManager/CATWebUXSelectionManager","DS/CAT3DComposeUI/CAT3DComposeWidgetOptions","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/CATW3DMoveManager/CATW3DMoveReferent","DS/CATW3DMoveManager/CATW3DMoveManager","DS/Visualization/IdPath","DS/CoreEvents/ModelEvents","DS/SceneGraphOverrides/SceneGraphOverrideSet","DS/Visualization/SceneGraphUtils","DS/CATW3DGeometry/CATW3DGeometryEnums","DS/CATWebUXComponents/DMUCommandsManager","css!DS/CAT3DComposeUI/CAT3DComposeUI.css"],(function(e,t,n,i,a,o,r,l,s,c,p,u,m,v,d,h,f,E,g,y,M,x,C,D){"use strict";var b,T=t.extend({init:function(){var t,b,T=!1,S=null,A=null,P=null,w=this,I={},W=[],G="",R=!0,O=!1,V=null,N=null,L={},F=3394815,k=!1,q={},B=[],H=null,j=null,U=null,_=null,K=null,z=null,X=null,Y=!d.getOption("animationOff"),J=!1,Q={},Z=!1,$=null,ee=!1,te=null,ne=null,ie=new y,ae=new l("LocalAxisSystemNode");ae.exludeFromBounding(!0),ae.setVisibilityInTree(!1),ae.setPickable(s.PICKTHROUGH),ae.setVisibility(!1),ae.setVisibilityFree(!0),ae.updateDisplay=function(e){0===ae.parents.length&&P.addNode(ae),e.visibility&&e.pathElement&&ae.pathElement!==e.pathElement&&(ae.pathElement=e.pathElement,ae.setMatrix(e.pathElement.getWorldMatrix()),ae.setVisibility(!0)),e.visibility||(ae.pathElement=null,ae.setVisibility(!1))};var oe=new l("MovePrevisuNode");oe.exludeFromBounding(!0),oe.setVisibilityFree(!0),oe.setVisibilityInTree(!1),oe.setPickable(s.PICKTHROUGH),oe.setNoZ(!0),oe.updateDisplay=function(e,t,n){0===oe.parents.length&&P.addNode(oe),oe.removeChildren(),e&&e.equivalentGeometry&&e.equivalentGeometry.getPrevisuNode&&oe.addChild(e.equivalentGeometry.getPrevisuNode(t,n))};var re=function(e){if(e.color){var t=new r.MeshBasicMaterial({side:2,forceSide:!0,color:e.color,transparent:!0,depthWrite:!1,depthTest:!1,opacity:.6,overridable:!1});x.applyMaterialToPath(e.path,t)}else x.applyMaterialToPath(e.path,null)},le=function(e){e.objectToMove.override.setColor("#FFFFFF",!1);var t=function(t){e.objectToMove&&X&&!Z&&t&&P.render()},n=S.isPathLocked({pathElement:e.objectToMove.path,onCompleted:function(e){Q.isRunning()||t(e.isLocked)}});0===n.returnCode&&n.hasOwnProperty("isLocked")&&(t(n.isLocked),t=function(){})};function se(){X&&P.getSceneGraphOverrideSetManager().removeSceneGraphOverrideSet(X),X=null,H=null,T=!1,I={},k=!1,q={},N=null,L={},G="",B=[],W.forEach((function(e){e.lockedID&&t.getController().unlockNodes({ids:[e.lockedID]})})),W=[],Z=!1,Y&&(J=!1,ee=!1)}var ce,pe=function(){if(X&&P.getSceneGraphOverrideSetManager().removeSceneGraphOverrideSet(X),X=null,k)B.forEach((function(e){e.path&&n.add({pathElement:e.path})})),S.onMoveEnd({from:w,status:G}),"Moved"===G&&i.get().some((function(e){if(e.pathElement.isEqual(I.pathElement))return e.position=I.beginPosLocal.clone().applyMatrix4(I.pathElement.getWorldMatrix()),!0})),V&&(V.simulateReverseDirection(I.pathElement)||V.getAxisTypeIfCstOnProductAxis(I.pathElement))&&setTimeout((function(){t.getFrameWindow().getContextualUIManager()._showContextualBar({hideWithDistance:!0})}));else if(I.pathElement&&!q.partIsInCSO){var e=I.pathElement;i.add({pathElement:e,event:I.beginEvent,position:I.beginPosLocal.clone().applyMatrix4(e.getWorldMatrix())}),setTimeout((function(){t.getFrameWindow().getContextualUIManager()._showContextualBar({hideWithDistance:!0})}))}se(),ie.publish({event:"onDirectMoveEnd"})},ue={panInterval:void 0,viewpoint:void 0,panDuration:100,x:void 0,y:void 0},me=function(){ue.panInterval&&clearInterval(ue.panInterval),ue.panInterval=void 0,ue.viewpoint=void 0,ue.x=void 0,ue.y=void 0,ue.div=ue.div?ue.div.destroy():void 0,ue.divL=ue.divT=ue.divR=ue.divB=void 0};function ve(e){if(b&&b.cancel&&b.cancel(),b=null,me(),e&&!R?(R=!1,G="Moved"):G="Cancelled",ae&&ae.updateDisplay({visibility:!1}),k)if(Y){if($&&(clearTimeout($),$=null),Q.forward(),Q.addAnimation({animationType:"opacityOff",objectListToAnimate:W,callBackFct:function(){W.forEach((function(e){e.override.setColor(null,!1)})),I.equivalentGeometry&&re({path:I.pathElement})}}),"Cancelled"===G){var a=P.getSceneGraphOverrideSetManager();W.forEach((function(e){e.currentMatrix=a.computeAppliedPosition(e.path)})),Q.addAnimation({animationType:"cancel",objectListToAnimate:W,callBackFct:function(){pe()}})}else Z?pe():J?ee=!0:(ee=!0,Q.addAnimation({animationType:"snap",objectListToAnimate:W,callBackFct:function(){Z=!0,$=!1,ee&&pe()}}));Q.startAnimation()}else pe();else B.forEach((function(a){if(a.path)if(a.path.isEqual(I.pathElement))if(q.partIsInCSO)if(T)i.remove({pathElement:I.pathElement,event:e.event}),n.remove({pathElement:I.pathElement});else{var o=I.pathElement;i.remove({pathElement:o}),i.add({pathElement:o,event:I.beginEvent,position:I.beginPosLocal.clone().applyMatrix4(o.getWorldMatrix())}),t.getFrameWindow().getContextualUIManager()._showContextualBar({hideWithDistance:!0})}else n.add({pathElement:I.pathElement});else a.path.isAParentOf(I.pathElement)&&T&&q.partIsInCSO&&(i.remove({pathElement:I.pathElement,event:e.event}),n.remove({pathElement:I.pathElement}))})),pe();P.render()}function de(l,s){if(ce&&!j){var d=t.getFrameWindow();if(S=E.giveMoveManager({context:t}),A=f.getMoveReferentManager({context:t}),V||(V=p.getConstraintsController({context:t})),te=S?S.subscribe("onValidateMove",(function(){V&&V.deleteAllCst()})):null,ne=S?S.subscribe("onCancelMove",(function(e){V&&e.objectsCancelled.some((function(e){return V.isLevelConstrained(e.path)}))&&V.deleteAllCst()})):null,d)if(S)if(A){var y;if(P=d.getViewer(),Q=m.getAnimation3DEngine({viewer:P}),(j=new o).setDynamic(!0),j.setPrePickingDuringManipulation(!0),j.setPreActivationDuringManipulation(!0),j.setPickingDuringManipulation(!0),j.setExclusive(!0),U=j.linkToNode((y=t.getRootBagPath())?y.getLastElement(!0):null),j.HandleLongHold=function(){return se(),!0},_=j.subscribe("BeginManipulate",(function(e){if(!Q.isRunning()){var o,l=t.getController(),c=l.getRootBagId();if(X=new M(l.getRootBag(),c),P.getSceneGraphOverrideSetManager().pushSceneGraphOverrideSet(X),P.setCursor("pointer"),T=e.event.gesture.events[0].event.ctrlKey,I={},s&&s.isActive())o=P.pick(P.getMousePosition(e.event.from[0].currentPosition),"primHybrid",!1),(I=s.filterPath({pathElement:o.path[0]})).pathReferent=A.getMoveReferent(o.path[0]);else{var p=v.giveSelectionManager({context:t});p&&((o=P.pick(P.getMousePosition(e.event.from[0].currentPosition),p.getPicking()?"mesh":"primHybrid",!1)).path[0]=p.getTruncatedPath(o.path[0]),I.pathElement=o.path[0],I.pathReferent=A.getMoveReferent(o.path[0]),I.equivalentGeometry=a.getEquivalentGeometry({pathElement:o.path[0],viewer:P,nonCanonicGeometry:!0}))}I.pathElement&&(I.beginEvent=e.event,I.beginPosLocal=e.position.clone().applyMatrix4((new r.Matrix4).getInverse(I.pathElement.getWorldMatrix())),B.push({path:I.pathElement}),e&&e.event&&e.event.from&&e.event.from&&e.event.from.length&&"Touch"!==e.event.from[0].type&&i.get().slice(0).forEach((function(t){t.pathElement&&(t.pathElement.isEqual(I.pathElement)?q.partIsInCSO=!0:T?(t.pathElement.isAParentOf(I.pathElement)&&(q.fatherIsInCSO=!0),B.push({path:t.pathElement})):(i.remove({pathElement:t.pathElement,event:e.event}),n.remove({pathElement:t.pathElement})))})),B.forEach((function(e){if(e.path){var n,i=W.slice(0).some((function(n){if(n.path&&(!n.path.isEqual(e.path)&&n.path.isAParentOf(e.path)||(i=e.path,!t.getRootBagPath().isAParentOf(i))))return!0;var i}));if(!O){var a=D.getCommand("CAT3DComposeMoveHdr",t.getCommandContext());!a||a.isRunning()||!t.getExecutionContext&&a.isPaused()||(i=!0)}if(i||!(n=A.getMoveReferent(e.path)))return;for(var o,r=n.externalPath.map((function(e){return h.getNodeID(e)})).filter((function(e){return e})),s=e.path.externalPath.length-1;s>0;--s)if(h.isRepReference(e.path.externalPath[s])){o=h.getNodeID(e.path.externalPath[s]);break}o&&l.lockNodes({ids:[o]}),r.unshift(c),W.push({path:n,lockedID:o,override:X.createIdPathOverride({idPathes:[new g(r)]}),initWorldMatrix:n.getWorldMatrix(),initMatrix:n.getLastElement(!0).getMatrix(),selectionWorldMatrix:I.pathElement.getWorldMatrix(),isAxisSystem:I.pathElement.externalPath.some((function(e){return"AxisSystems"===e.name}))})}})))}})),K=j.subscribe("Manipulate",(function o(c,p){if(b&&b.cancel&&b.cancel(),b=null,!Q.isRunning()&&(P.setCursor("pointer"),!c.event.from[0].currentPosition.equals(c.event.from[0].lastPosition)&&W.length)){var m=l?c.intersection.path[0]:null;if(!k){if(c&&c.event&&c.event.from&&c.event.from&&c.event.from.length&&"Touch"===c.event.from[0].type&&i.get().slice(0).forEach((function(e){e.pathElement&&(e.pathElement.isEqual(I.pathElement)?q.partIsInCSO=!0:T?(e.pathElement.isAParentOf(I.pathElement)&&(q.fatherIsInCSO=!0),B.push({path:e.pathElement})):(i.remove({pathElement:e.pathElement,event:c.event}),n.remove({pathElement:e.pathElement})))})),ie.publish({event:"onDirectMoveBegin"}),!q.partIsInCSO){var v=I.pathElement;i.add({pathElement:v,event:I.beginEvent,position:I.beginPosLocal.clone().applyMatrix4(v.getWorldMatrix())})}B.forEach((function(e){e.path&&n.remove({pathElement:e.path})})),S.onMoveBegin({objectsMoved:W,from:w,moveMode:"Transient"}),W.forEach((function(e){e.path&&e.override.setPickability("IGNORED")})),P.render(),I.equivalentGeometry||(I.equivalentGeometry=a.getEquivalentGeometry({pathElement:I.pathReferent,axis:V.getProductAxisForConstraint(),viewer:P})),Y?(Q.addAnimation({animationType:"opacityOn",objectListToAnimate:W,callBackFct:function(){I.equivalentGeometry&&I.equivalentGeometry.getMode()===C.GeometryMode.REAL&&re({path:I.pathElement,color:F}),W.forEach((function(e){e.path&&le({objectToMove:e})}))}}),Q.startAnimation()):(I.equivalentGeometry&&I.equivalentGeometry.getMode()===C.GeometryMode.REAL&&re({path:I.pathElement,color:F}),W.forEach((function(e){e.path&&(e.override.setOpacity(.35,!1),le({objectToMove:e}))}))),V&&(V.count()>0&&!I.equivalentGeometry||V.count()>0&&!V.isLevelConstrained(I.pathReferent))&&V.deleteAllCst(),k=!0}if(!function(n){function i(){if(ue.viewpoint||(ue.viewpoint=P.currentViewpoint),ue.viewpoint&&ue.viewpoint.control&&void 0!==ue.x&&void 0!==ue.y){var n,i,a=new r.Vector3(ue.x,ue.y,0);if(a.applyQuaternion(ue.viewpoint.control.orientation),a.setLength(.05*ue.viewpoint.control.distanceToTarget),n=ue.viewpoint.target.clone().add(a),i=ue.viewpoint.control.distanceToTarget,ue.viewpoint.moveTo({eyePosition:n.add(ue.viewpoint.getCamera().getLookAt().normalize().multiplyScalar(-i)),duration:Y?ue.panDuration:0}),!ue.div){var o=t.getFrameWindow().getUIFrame();ue.div=e.createElement("div",{id:"C3D-viewpoint",styles:{top:P.SCREEN_HEIGHT/2+"px",left:P.SCREEN_WIDTH/2+"px"}}).inject(o);var l=function(t){var n=e.createElement("div",{class:t.side}).inject(ue.div);n.setStyle(t.posKey,t.posValue+"px");var i=e.createElement("div",{class:"arrow"}).inject(n);return e.createElement("div",{class:"borderBottom"}).inject(i),e.createElement("div",{class:"borderRight"}).inject(i),n},s=Math.min(P.SCREEN_WIDTH/10,P.SCREEN_HEIGHT/10);ue.divL=l({side:"left",posKey:"left",posValue:-s}),ue.divT=l({side:"top",posKey:"top",posValue:-s}),ue.divR=l({side:"right",posKey:"left",posValue:s}),ue.divB=l({side:"bottom",posKey:"top",posValue:s})}ue.x<0?ue.divL.addClassName("active"):ue.divL.removeClassName("active"),ue.x>0?ue.divR.addClassName("active"):ue.divR.removeClassName("active"),ue.y<0?ue.divB.addClassName("active"):ue.divB.removeClassName("active"),ue.y>0?ue.divT.addClassName("active"):ue.divT.removeClassName("active")}}var a=(n.event.gesture?n.event.gesture.getEvents()[0]:n.event.from[0]).getCurrentPosition(t.getViewer().canvas);return ue.x=a.x<=9?-1:a.x>=P.SCREEN_WIDTH-10-1?1:0,ue.y=a.y<=9?1:a.y>=P.SCREEN_HEIGHT-10-1?-1:0,0===ue.x&&ue.y?ue.x=a.x<P.SCREEN_WIDTH/3?-1:a.x>2*P.SCREEN_WIDTH/3?1:0:0===ue.y&&ue.x&&(ue.y=a.y<P.SCREEN_HEIGHT/3?1:a.y>2*P.SCREEN_HEIGHT/3?-1:0),ue.x||ue.y?(clearInterval(ue.panInterval),ue.panInterval=setInterval((function(){i()}),ue.panDuration),i(),1):(me(),0)}({event:c.event})){var d=l?P.pick(P.getMousePosition(c.event.from[0].currentPosition),"primHybrid",!1):{path:[]};d.path[0]&&!h.isAModelPath(d.path[0])&&(d.path[0]=null);var f={pathElement:d.path[0]};!(b=u.switchToAV1withMesh({pathElement:f.pathElement,pad3DViewer:t,selectionFilter:s?s.getFiltersState():null,onComplete:function(){o(c,!0),b=null},onFailure:function(){b=null}}))||"filtered"!==b.status&&"done"!==b.status||(b=null),s&&s.filterPath(f);var E=!1;f.pathElement&&L.pathElement&&(E=L.pathElement.isEqual(f.pathElement)),L=f,N&&!E&&(V.deleteLastCst(),N=null);var g={},y=null,M=null;if(f.pathElement&&m&&!I.pathReferent.isAParentOf(m)){var x=I.equivalentGeometry&&I.equivalentGeometry.getType(),D=f.equivalentGeometry&&f.equivalentGeometry.getType();if(y=x&&x!==C.GeometryType.AXISSYSTEM&&x!==C.GeometryType.SURFACE,M=D&&D!==C.GeometryType.AXISSYSTEM&&D!==C.GeometryType.SURFACE,f.pathElement&&!I.pathReferent.isAParentOf(f.pathElement)&&M&&y){if(!E){N=V.createCst({movable:I,fixed:f});var A=V.simulateSolveCst();if(A){var G=A.matrix;g.rc=A.rc,g.redundancy=A.redundancy,0===g.rc&&G&&!g.redundancy?g.matrix=G.multiply(I.pathReferent.getWorldMatrix()):(0!==g.rc||g.redundancy)&&(V.deleteLastCst(),N=null),L=f}else L={}}}else f&&f.pathElement&&(g.matrix=f.pathElement.getWorldMatrix(),f.pathElement.externalPath.some((function(e){return"AxisSystems"===e.name}))?(g.isAxisSystem=!0,ae.updateDisplay({visibility:!1})):ae.updateDisplay({pathElement:f.pathElement,visibility:!0}))}if(g.matrix){var O;if(g.isAxisSystem&&W[0].isAxisSystem){var U=(new r.Matrix4).copy(g.matrix);U.multiply((new r.Matrix4).getInverse(W[0].selectionWorldMatrix)),U.multiply(W[0].initWorldMatrix),O=(new r.Matrix4).getInverse(W[0].initWorldMatrix).multiply(U)}else(O=(new r.Matrix4).getInverse(W[0].initWorldMatrix).multiply(g.matrix)).multiply((new r.Matrix4).getInverse(I.pathElement.getLastElement(!0).getMatrix()));W.forEach((function(e,t){var n=(new r.Matrix4).copy(e.initWorldMatrix).multiply(O);if(e.path){var i=(new r.Matrix4).getInverse(e.path.getParentPath().getWorldMatrix()),a=(new r.Matrix4).copy(i).multiply(n),o=null;e.snappedPosition&&(o=(new r.Matrix4).copy(e.snappedPosition));var l=o&&o.equals(a);if(e.snappedPosition=(new r.Matrix4).copy(a),Y){var s=(new r.Matrix4).copy(e.initWorldMatrix),u=(new r.Vector3).getPositionFromMatrix(e.initWorldMatrix).add(c.translationVector);s.setPosition(u);var m=(new r.Matrix4).copy(i).multiply(s);Z?l||(e.currentPosition=a):(e.currentPosition=(new r.Matrix4).copy(m),(V&&V.count()<=1&&M&&y||!M&&!y||M&&!y)&&e.override.setPosition(m)),0===t&&(e.snappedTarget=f.pathElement,l||!f.pathElement||e.snappedTarget.isEqual(f.pathElement)||(clearTimeout($),$=null),$||l&&Z||b||($=setTimeout((function(){Q.addAnimation({animationType:"snap",objectListToAnimate:W,callBackFct:function(){Z=!0,$=null,ee&&pe()}}),Q.addAnimation({animationType:"opacityOff",offsetTime:Q.getDefaultDuration("snap"),objectListToAnimate:W,callBackFct:function(){W.forEach((function(e){e.override.setColor(null,!1)})),I.equivalentGeometry&&re({path:I.pathElement})}}),Q.startAnimation()}),p?0:500)))}else e.override.setPosition(a),Z=!0}})),R=!1,S.onMove({objectsMoved:W,transformation:O,from:w})}else if(ae&&ae.updateDisplay({visibility:!1}),void 0===f.pathElement||null===f.pathElement||g.rc&&0!==g.rc||g.redundancy?(R=!0,S.onMove({objectsMoved:W,vector:c.translationVector,from:w})):M&&y&&0===g.rc&&(R=!1),void 0!==f.pathElement||null!==f.pathElement){var _=null;W.forEach((function(e,t){if(e.path){var n=null;if(0===V.count()||1===V.count()&&N){var i=(new r.Matrix4).copy(e.initWorldMatrix),a=(new r.Vector3).getPositionFromMatrix(e.initWorldMatrix).add(c.translationVector);i.setPosition(a);var o=e.path.getParentPath().getWorldMatrix();n=(new r.Matrix4).getInverse(o).multiply(i),Z||e.override.setPosition(n),e.currentPosition=(new r.Matrix4).copy(n)}else{if(0===t){_=null,N&&V.deleteLastCst();var l=(new r.Vector3).addVectors(c.translationVector,j.initial3dIntersectionPoint),s=null;s=H?(new r.Vector3).subVectors(c.translationVector,H):c.translationVector,H=c.translationVector;var p=V.simulateMoveWithCst({movableReference:l,translation:s});p&&0===p.rc&&p.matrix&&(_=p.matrix.multiply(I.pathReferent.getWorldMatrix())),N&&V.restoreLastDeletedCst()}if(_){var u=(new r.Matrix4).getInverse(W[0].initWorldMatrix).multiply(_),m=(new r.Matrix4).copy(e.initWorldMatrix).multiply(u),v=(new r.Matrix4).getInverse(e.path.getParentPath().getWorldMatrix());n=(new r.Matrix4).copy(v).multiply(m),Z||e.override.setPosition(n)}e.currentPosition=(new r.Matrix4).copy(e.initMatrix)}}})),Y?E||($&&(clearTimeout($),$=null),Z&&R&&(Q.addAnimation({animationType:"unsnap",objectListToAnimate:W,callBackFct:function(){Z=!1,W.forEach((function(e){e.snappedPosition=null}))}}),Q.addAnimation({animationType:"opacityOn",objectListToAnimate:W,offsetTime:Q.getDefaultDuration("unsnap"),callBackFct:function(){I.equivalentGeometry&&re({path:I.pathElement,color:F}),W.forEach((function(e){e.path&&le({objectToMove:e})}))}}),Q.startAnimation())):Z&&R&&(W.forEach((function(e){e.path&&e.currentPosition&&e.override.setPosition(e.currentPosition)})),Z=!1)}oe.updateDisplay(f,c.intersection.position,c.intersection.normal),P.render()}}})),z=j.subscribe("EndManipulate",ve),0===ae.getChildren().length){var x=new c({headLength:10,arrowLength:50,arrowWidth:2,head:c.types.ARROW});ae.addChild(x)}ae.updateDisplay({visibility:!1}),P.render({updateInfinitePlane:!0})}else window.console.log("A move referent component must be defined");else window.console.log("A move manager component must be defined");else window.console.log("A frame window must be defined")}}function he(){me(),te&&(S.unsubscribe(te),te=null),ne&&(S.unsubscribe(ne),ne=null),j&&(j.unsubscribe(_),j.unsubscribe(K),j.unsubscribe(z),j.unlink(U),j=_=K=z=U=null),ae&&ae.removeChildren(),oe&&oe.removeChildren()}this.activate=function(e){t=e.context,ce=!0,de(e.withSnap,e.selectionFilter)},this.deactivate=function(){he(),ce=!1},this.unreference=function(){he(),V&&(V.deleteAllCst(),V.unreference()),ae&&P.removeNode(ae),ae=null,oe&&P.removeNode(oe),oe=null,t=null,ie=null,ce=!1},this.subscribe=function(e,t){return"onDirectMoveBegin"===e||"onDirectMoveEnd"===e?ie.subscribe({event:e},t):void 0},this.unsubscribe=function(e){return ie.unsubscribe(e)},this.setAllowManipulation=function(e){O=e}}});return t.singleton({init:function(){},activate:function(e){var t;t=e.context.getExecutionContext?"ENO3DView":"ENOPAD3DViewer",e&&e.context&&e.context.name===t&&(b||(b=new T),b.activate(e))},deactivate:function(e){var t;t=e.context.getExecutionContext?"ENO3DView":"ENOPAD3DViewer",e&&e.context&&e.context.name===t&&b&&b.deactivate()},unreference:function(e){var t;t=e.context.getExecutionContext?"ENO3DView":"ENOPAD3DViewer",e&&e.context&&e.context.name===t&&(b&&b.unreference(),b=null)},subscribe:function(e,t){return b?b.subscribe(e,t):null},unsubscribe:function(e){return b?b.unsubscribe(e):null},give:function(){return b}})}));