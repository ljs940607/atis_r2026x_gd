var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebGUI/ambiences/VCXAmbienceLibraryCard",["require","exports","DS/VCXGUIInfrastructure/VCXUICard","UWA/Core","DS/Controls/Button","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI","DS/Utilities/Dom"],(function(e,t,i,n,a,r,s){"use strict";a=__importDefault(a),r=__importDefault(r),s=__importDefault(s);return class extends i{constructor(e){super(e);let t=this.cardElement.querySelector(".vcxUICard-descriptionContainer"),i=this.cardElement.querySelector(".vcxUICard-thumbnail-container");this.hoverArea=(0,n.createElement)("div",{class:"vcxLibraryAmbienceHover"}),this.buttonInsert=new a.default({emphasize:"primary",displayStyle:"normal",icon:"plus",label:r.default["Ambience.Library.Card.Insert"]}),this.divView=(0,n.createElement)("div",{class:"vcxLibraryAmbienceHoverLabel"});let o=s.default.generateIcon({iconName:"check"});this.divView.appendChild(o);let l=document.createElement("div",{});l.textContent=r.default["Ambience.Library.Card.Inserted"],this.divView.appendChild(l);return this.buttonInsert.addEventListener("click",(()=>this.getThumbnailElement().click())),t.classList.add("vcxMaterialCard-descriptionContainer"),i.appendChild(this.hoverArea),this.hoverArea.appendChild(this.buttonInsert.getContent()),this.hoverArea.appendChild(this.divView),this.cardElement.querySelector(".vcxUICard-descriptionTitle").classList.add("vcxMaterialCard-descriptionTitle"),this.thumbnail.addClassName("ambienceThumbnail"),this.setInsertStatus(!0),this}setInsertStatus(e){let t=e?this.buttonInsert:this.divView;(e?this.divView:this.buttonInsert).hide(),t.show()}}}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebGUI/ambiences/VCXAmbienceCtrlServices",["require","exports","DS/VCXWebComponents/VCXWebComponentBaseExperience","WebappsUtils/WebappsUtils","UWA/Core","DS/VCXWebProperties/VCXPropertyValueLink","DS/VCXWebKernelCommands/VCXCmdReplaceNeutralTrackProperties","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebKernelCommands/VCXCmdRestoreNeutralProperties","DS/Controls/Button","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI","DS/Windows/Dialog","DS/Controls/Toggle","DS/Controls/ButtonGroup","DS/VCXWebIO/VCXMimeTypeServices","DS/VCXWebKernelCommands/VCXCmdApplyTo","DS/VCXWebVisu/VCXAmbienceUtils","DS/VCXWebIO/VCXPixelImage","DS/VCXWebProperties/VCXPropertySet","DS/Controls/LineEditor","DS/VCXWebPlatform/VCX3DSpaceServices","DS/VCXWebKernel/VCXNotificationManager"],(function(e,t,i,n,a,r,s,o,l,c,d,u,h,p,m,C,g,_,b,v,f,S){"use strict";r=__importDefault(r),s=__importDefault(s),o=__importDefault(o),l=__importDefault(l),c=__importDefault(c),d=__importDefault(d),u=__importDefault(u),h=__importDefault(h),p=__importDefault(p),m=__importDefault(m),C=__importDefault(C),g=__importDefault(g),_=__importDefault(_),b=__importDefault(b),v=__importDefault(v),f=__importDefault(f),S=__importDefault(S);return class{constructor(e){this._parent=e}async resetValues(e){let t=this._parent._experienceBase.ComponentsMap.GetComponentFromID(e);if(!t)return;const i=new l.default(this._parent._experienceBase);i.SetActors([t]),i.SetUpdateOnlyLocation(!1),this._parent._experienceBase.getManager("VCXCommandManager").Push(i)}async deleteAmbience(e){if(-1===e)return;let t=this._parent._experienceBase,i=t.ComponentsMap.GetComponentFromType("AmbienceModel_Spec").find((e=>e?.QueryInterface("VCXIModifiable")?.GetProperty("Ambience.DefaultAmbience").GetPropertyValue().GetValue()));if(!i)return;let n=i.GetID();if(n===e)return;const a=t.getManager("VCXContextManager").getActiveViewport(),o=a&&a.QueryInterface("VCXIModifiable");o?.GetProperty("Viewport.ActiveAmbience").GetPropertyValue().GetValue()===e&&await this.activateAmbienceInCurrentScene(n);let l=t.ComponentsMap.GetComponentFromID(e),c=new s.default(t);c.SetSourcePropertyName("Viewport.ActiveAmbience"),c.SetSourcePropertyValues(e),c.SetFilterType("VCXViewport_Spec"),c.SetTargetPropertValue(new r.default(n)),t.getManager("VCXCommandManager").Do(c),await t.getManager("VCXCAT3DXModelManager").DeleteAmbience(l)}async activateAmbienceInCurrentScene(e){let t=this._parent._experienceBase;var i=new o.default(t);if(null!==e){const n=t.getManager("VCXContextManager").getActiveViewport(),a=n?.QueryInterface("VCXIModifiable"),r=a?.GetProperty("Viewport.ActiveAmbience");if(!r||!a)return;let s=r.GetPropertyValue().Clone();s.SetValue(e),await i.ChangePropertyValue(a,"Viewport.ActiveAmbience",s),t.getManager("VCXCommandManager").Do(i)}}async _launchShowChangeSourcePanel(e){let t=this._parent._experienceBase,i=e.blobURL.split(";")[0]?.split(":")[1],r=m.default.GetExtension(i)?.replace(".",""),s=e.blobURL;if("png"!==r&&"jpeg"!==r){let t=null;try{t=await g.default.getPlainImageFromHDR(e.blobURL,92400)}catch(e){console.warn(e)}s=(t&&new _.default(t).toDataUrl())??n.getWebappsAssetUrl("VCXWebAuthoringApp","ambiences/userMade.jpg")}let o=UWA.Promise.deferred(),l=t.getManager("VCXContextManager").getFrameWindow().getImmersiveFrame();var C=(0,a.createElement)("div",{class:"vcx-updateScene-modal",styles:{"min-width":"500px"}});let b=(0,a.createElement)("p",{text:d.default["Ambience.PanelSource.Text"]}),v=(0,a.createElement)("div",{class:"vcx-ambiencesource-container"}),f=(0,a.createElement)("div",{class:"vcx-ambiencesource-containerimage"}),S=(0,a.createElement)("img",{src:s}),V=(0,a.createElement)("div",{class:"vcx-ambiencesource-selectorimage"}),x=(0,a.createElement)("p",{text:d.default["Ambience.PanelSource.UseAs"]});var I=new p.default({type:"checkbox"});let y=2===e.comeFrom,P=3!==e.comeFrom,M=y?"Ambience.PanelSource.Backplate":"Ambience.PanelSource.Background";I.addChild(new h.default({type:"checkbox",label:d.default[M],value:0,checkFlag:P,disabled:P})),I.addChild(new h.default({type:"checkbox",label:d.default["Ambience.PanelSource.Light"],value:1,checkFlag:!P,disabled:!P})),b.inject(C),v.inject(C),f.inject(v),V.inject(v),x.inject(V),I.inject(V),S.inject(f);let w=new c.default({emphasize:"primary",label:d.default["Ambience.PanelSource.Change"],onClick:function(){o.resolve(I.value)}}),D=new c.default({emphasize:"default",label:d.default["Ambience.PanelSource.Cancel"],onClick:function(){o.resolve(!1)}}),X=new u.default({immersiveFrame:l,title:d.default["Ambience.PanelSource.Title"],resizableFlag:!1,content:C,movableFlag:!1,modalFlag:!0,touchMode:!0,identifier:"AmbienceChangeSource_controlPanelForModalDialog",customButtonsDefinition:[w,D]});X.addEventListener("close",(()=>{o.resolve(!1)}));let A=await o.promise;return X.close(),{update:!!A,updateBackground:!y&&A&&A.includes(0),updateBackplate:y&&A&&A.includes(0),updateIBL:A&&A.includes(1)}}async _saveToDatabaseModal(e){let t=this._parent._experienceBase,i=UWA.Promise.deferred(),n=t.getManager("VCXContextManager").getFrameWindow().getImmersiveFrame();var r=(0,a.createElement)("div",{class:"vcx-shareambience-modal",styles:{width:"400px"}});let s=await f.default.GetPreferredSecurityContext(),o=d.default["Ambience.PanelShare.Text"].split("%3dspace_target%"),l=(0,a.createElement)("b",{text:s.collabspace}),h=(0,a.createElement)("p",{html:[o[0],l,o[1]]}),p=(0,a.createElement)("div",{class:"vcx-ambienceshare-container"});h.inject(r),p.inject(r);let m=(0,a.createElement)("div",{class:"vcx-ambienceshare-container-lineeditor"});(0,a.createElement)("span",{text:d.default["Ambience.PanelShare.Field.Text"]}).inject(m);let C=new v.default({value:e}).inject(m);m.inject(p);let g=new c.default({emphasize:"primary",label:d.default["Ambience.PanelShare.Save"],onClick:function(){i.resolve(C.value)}}),_=new c.default({emphasize:"default",label:d.default["Ambience.PanelShare.Cancel"],onClick:function(){i.resolve(!1)}}),b=new u.default({immersiveFrame:n,title:d.default["Ambience.PanelShare.Title"],resizableFlag:!1,content:r,movableFlag:!1,modalFlag:!0,touchMode:!0,identifier:"AmbienceShare_controlPanelForModalDialog",customButtonsDefinition:[g,_]});b.addEventListener("close",(()=>{i.resolve(!1)}));let S=await i.promise;return b.close(),S}getCurrentViewport(){return this._parent._experienceBase.getManager("VCXContextManager").getActiveViewport()}getCurrentAmbience(){let e=this.getCurrentViewport();if(!e)return null;let t=e.QueryInterface("VCXIModifiable")?.GetProperty("Viewport.ActiveAmbience").GetPropertyValue().GetValue()??"";return this._parent._experienceBase.ComponentsMap.GetComponentFromID(t)??null}onRenameAmbience(e,t){let i=this._parent._experienceBase;var n=new o.default(i);let a=this._parent._experienceBase.ComponentsMap.GetComponentFromID(e),r=a?.QueryInterface("VCXIModifiable");if(r){var s=r.GetProperty("Actor.Name");s.GetPropertyValue().SetValue(t),n.ChangeProperty(r,s),i.getManager("VCXCommandManager").Do(n)}else console.error("No ambience found for rename")}async showChangeSourcePanel(e){if(e.blobURL.length/1048576>150){const e={level:"error",title:d.default["Notification.ToBig.Ambience.Error.Title"],subtitle:d.default["Notification.ToBig.Ambience.Error.SubTitle"],sticky:!0};return void this._parent._experienceBase.getManager("VCXNotificationManager").addNotification(e)}let t=await this._launchShowChangeSourcePanel(e);if(!t?.update)return;let i=this.getCurrentAmbience(),n=i?.QueryInterface("VCXIModifiable");if(!n)return;let a=n.GetProperty("Actor.Name").GetPropertyValue().GetValue();(t.updateBackground||t.updateBackplate)&&t.updateIBL?a=d.default["Ambience.CreateCompletlyOnStrach"]:a+=d.default["Ambience.Copy"];let r=new Promise((async(n,r)=>{let s=await(i?.getAmbienceSourceInfo());if(!s)return r();""===s.backgroundImage&&(s.backgroundExtension=s.lightingExtension,s.backgroundImage=s.lightingImage);let l=s.backplateImage,c="jpg",d=s.backgroundImage,u=s.backgroundExtension,h=s.lightingImage,p=s.lightingExtension,C=e.blobURL.split(";")[0]?.split(":")[1],g=m.default.GetExtension(C)?.replace(".","");"jpeg"===g&&(g="jpg"),e.blobURL.startsWith("data:application/octet-stream;base64,Iz9S")&&(g="hdr");let _=e.blobURL.replace(/^data:.*;base64,/,"");if(t.updateBackplate){if(d="",u="",c=g,"png"!==c&&"jpg"!==c)return r(new Error("not supported yet"));l=_}if(t.updateBackground&&(l="",c="",u=g,d=_,"png"!==u&&"jpg"!==u&&"hdr"!==u))return r(new Error("not supported yet"));if(t.updateIBL&&(p=g,h=_,"png"!==p&&"jpg"!==p&&"hdr"!==p))return r(new Error("not supported yet"));t.updateIBL&&(t.updateBackground&&"hdr"===u||t.updateBackplate)&&(l="",c="",d="",u="");let v=await this._createAmbience({isEmbedded:!0,name:a,ambienceParams:{...s,backgroundImage:d,backgroundExtension:u,backplateExtension:c,backplateImage:l,lightingImage:h,lightingExtension:p}}),f=v?.QueryInterface("VCXIModifiable"),S=i?.QueryInterface("VCXIModifiable"),V=i?.QueryInterface("CATI3DExpVCXObjectConvertor");if(f&&S&&V){let e=V.getTab().map((e=>e.propertyName)).filter((e=>"Actor.Name"!==e));var x=new b.default;for(let t of e)x.AddOrModifyProperty(S.GetProperty(t).Clone());var I=new o.default(this._parent._experienceBase);I.ChangePropertiesFromSet(f,x),this._parent._experienceBase.getManager("VCXCommandManager").Push(I)}this._parent._experienceBase.getManager("VCXGUIManager").GetGUIComponentFromName("VCXAmbienceCtrl").notifyPresentation(),n(v)}));return this._parent._experienceBase.getManager("VCXNotificationManager").addProgressNotification({strObjectName:d.default["Ambience.Generation"],iPromise:r,maskDisplayAdd:S.default.FDisplayMode.CONSOLE|S.default.FDisplayMode.LOADINGPANEL,maskDisplayEnd:!0}),r}_convertVisuAndOverrideToPLM(e,t){let i=t.QueryInterface("VCXIModifiable"),n=e=>i?.GetProperty(e).GetPropertyValue().GetValue();return{...e,exposure:n("Ambience.Lighting.Exposure"),backgroundExposure:n("Ambience.Background.Exposure"),backgroundRotationX:0,backgroundRotationY:0,backgroundRotationZ:n("Ambience.Background.Rotation"),cameraHeight:n("Ambience.Ground.Scaleratio"),domeSize:n("Ambience.Background.Finite")?n("Ambience.Background.Radius.Auto")?e.domeSize:n("Ambience.Background.Radius"):0,glossiness:n("Ambience.Ground.Glossiness"),reflectivity:n("Ambience.Ground.Reflectivity"),offset:n("Ambience.Ground.Offset"),lightingRotationX:0,lightingRotationY:0,lightingRotationZ:n("Ambience.Lighting.Rotation")}}async shareAmbience(e){let t=this._parent._experienceBase.ComponentsMap.GetComponentFromID(e);if(!t)return;let i=t.QueryInterface("VCXIModifiable")?.GetProperty("Actor.Name").GetPropertyValue().GetValue();if(!i)return;let n=await this._saveToDatabaseModal(i);if(!n)return;let a=new Promise((async(e,i)=>{let a=await(t?.getAmbienceSourceInfo());if(!a)return i();let r=await this._createAmbience({isEmbedded:!1,name:n,ambienceParams:{...this._convertVisuAndOverrideToPLM(a,t)}});if(e(r),r){var s={level:"success",title:d.default["Notification.ToBig.Ambience.Success.Title"],subtitle:d.default["Notification.ToBig.Ambience.Success.SubTitle"]};this._parent._experienceBase.getManager("VCXNotificationManager").addNotification(s)}else{const e={level:"error",title:d.default["Notification.Ambience.Share.Error.Title"],subtitle:d.default["Notification.Ambience.Share.Error.SubTitle"],sticky:!0};this._parent._experienceBase.getManager("VCXNotificationManager").addNotification(e)}}));return this._parent._experienceBase.getManager("VCXNotificationManager").addProgressNotification({strObjectType:d.default["Ambience.Export"],strObjectName:n,iPromise:a,maskDisplayAdd:S.default.FDisplayMode.CONSOLE|S.default.FDisplayMode.LOADINGPANEL,maskDisplayEnd:!0}),a}async _createAmbience(e){let t=this._parent._experienceBase.getManager("VCXEWSManager").getEmptyCsiParameters();if(t.writeDouble("backgroundExposure",e.ambienceParams.backgroundExposure),t.writeString("backgroundImage",e.ambienceParams.backgroundImage),t.writeString("backgroundImageExtension",e.ambienceParams.backgroundExtension),t.writeDouble("backgroundRotationX",e.ambienceParams.backgroundRotationX),t.writeDouble("backgroundRotationY",e.ambienceParams.backgroundRotationY),t.writeDouble("backgroundRotationZ",e.ambienceParams.backgroundRotationZ),t.writeString("backplateExtension",e.ambienceParams.backplateExtension),t.writeString("backplateImage",e.ambienceParams.backplateImage),t.writeDouble("cameraHeight",e.ambienceParams.cameraHeight),t.writeDouble("domeSize",e.ambienceParams.domeSize),t.writeBool("domeType",0!==e.ambienceParams.domeSize),t.writeDouble("exposure",e.ambienceParams.exposure),t.writeDouble("glossiness",e.ambienceParams.glossiness),t.writeString("lightingImage",e.ambienceParams.lightingImage),t.writeString("lightingImageExtension",e.ambienceParams.lightingExtension),t.writeDouble("offset",e.ambienceParams.offset),t.writeDouble("originX",e.ambienceParams.originX),t.writeDouble("originY",e.ambienceParams.originY),t.writeDouble("originZ",e.ambienceParams.originZ),t.writeDouble("reflectivity",e.ambienceParams.reflectivity),t.writeDouble("rotationX",e.ambienceParams.lightingRotationX),t.writeDouble("rotationY",e.ambienceParams.lightingRotationY),t.writeDouble("rotationZ",e.ambienceParams.lightingRotationZ),t.writeDouble("useGround",e.ambienceParams.useGround),e.isEmbedded)return this._parent._experienceBase.getManager("VCXCAT3DXModelManager").InsertAmbience(e.name,null,null,{embedded:{creationParams:t}});{t.writeString("ambienceName",e.name);let i=await this._parent._experienceBase.getManager("VCXEWSManager").SendFunction({name:"createExpAmbienceFunc",version:1,parameters:t});try{return i.readString("ambienceID").split(",")[1].split(")")[0]}catch(e){console.log("failed")}return null}}async onCallbackApplyTo(e,t){let i=this._parent._experienceBase;await this.activateAmbienceInCurrentScene(e);let n=t?"selected":"all";const a=C.default.checkSelectionContext(i,{scenariosFilter:n,dressups:[i.getManager("VCXContextManager").getActiveViewport()]}),r=new C.default(i,a);i.getManager("VCXCommandManager").Push(r)}onCallbackApplyToAvailable(e,t){let i=this._parent._experienceBase,n=!1,a=t?"selected":"all";return"selected"===a&&this.getCurrentAmbienceID()!==e||(n=!!i.getManager("VCXContextManager").getActiveViewport()&&C.default.checkSelectionContext(i,{scenariosFilter:a,dressups:[i.getManager("VCXContextManager").getActiveViewport()]}).availability),n}getCurrentAmbienceID(){const e=this._parent._experienceBase.getManager("VCXContextManager").getActiveViewport(),t=e?.QueryInterface("VCXIModifiable"),i=t?.GetProperty("Viewport.ActiveAmbience");return i.GetPropertyValue().GetValue()}}})),define("DS/VCXWebGUI/ambiences/VCXAmbienceGUIEnum",["require","exports"],(function(e,t){"use strict";var i;return function(e){let t;!function(e){e[e.Current=1]="Current",e[e.Presentation=2]="Presentation",e[e.Library=3]="Library"}(t=e.SubPanel||(e.SubPanel={}))}(i||(i={})),i}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebGUI/VCXScenesUpdateModalCtrl",["require","exports","DS/VCXGUIInfrastructure/VCXGUIComponentCtrl","DS/Windows/Dialog","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI","UWA/Core","DS/CoreEvents/Events","DS/Controls/ModalContainer","DS/Controls/Loader","DS/Controls/Button","DS/VCXWebKernelCommands/VCXCmdChangeViewpoint"],(function(e,t,i,n,a,r,s,o,l,c,d){"use strict";a=__importDefault(a),d=__importDefault(d);return class extends i{constructor(){super(),this._sceneNeedsUpdate=!1}BuildView(){}initialize(){this._sceneNeedsUpdate=!1}SetSceneNeedsUpdate(e){this._sceneNeedsUpdate=e}GetSceneNeedsUpdate(){return this._sceneNeedsUpdate}displaySceneNeedsUpdateModal(e){let t="",i=a.default["SceneUpdate.DontUpdate"];switch(e){case"close":t=a.default["SceneUpdate.close"];break;case"publish":t=a.default["SceneUpdate.publish"],i=a.default["SceneUpdate.Cancel"];break;case"save":t=a.default["SceneUpdate.save"]}return new r.Promise((e=>{if(!this._sceneNeedsUpdate)return e(!0);var u=new c({label:a.default["SceneUpdate.Update"],onClick:t=>{var i=t.dsModel,n=i.dialog,a=new l;a.on(),o.createModal(i.dialog.elements.container,a.elements.container);let r=s.subscribe({event:"VCX_SCENARIO_REPLACED"},(()=>{o.removeModal(i.dialog.elements.container),s.unsubscribe(r),n.close(),e(!0)}));var c=new d.default(this._experienceBase,!0);this._experienceBase.getManager("VCXCommandManager").Do(c)}}),h=new c({label:i,onClick:t=>{t.dsModel.dialog.close(),e(!1)}}),p=new n({immersiveFrame:this._experienceBase.getManager("VCXGUIManager").immersiveFrame,modalFlag:!0,closeButtonFlag:!1,touchMode:!0,resizableFlag:!1,movableFlag:!1,icon:"camera-refresh",title:a.default["SceneUpdate.title"],content:r.Element("div",{class:"vcx-updateScene-modal",html:t}),buttons:{Open:u,Close:h}});console.log(null===p),this._experienceBase.odt&&u.fire("buttonclick",{ctrlKey:!1,shiftKey:!1,altKey:!1})}))}}})),define("DS/VCXWebGUI/VCXMediaChooserCtrl",["require","exports","DS/VCXGUIInfrastructure/VCXGUIComponentCtrl","DS/VCXMediaChooser/VCXChoosePicture","DS/VCXWebProperties/VCXPropertyValueDocId","UWA/Core"],(function(e,t,i,n,a,r){"use strict";return class extends i{constructor(){super()}GetDocIDFromImageLoadQuery(){if(this._imageUrl=null,this._fileName=null,this._experienceBase.odt){var e=this._experienceBase.getManager("VCXDocManager").QueryInterface("VCXIModifiable"),t=e&&e.GetDefaultImageIdx();return new a(t)}var i=r.Promise.deferred(),s=new n(this._experienceBase);"undefined"!=typeof widget&&s.setWidget(widget),s.open(((e,t)=>{this._imageUrl=e,this._fileName=t}),(()=>{o(this._imageUrl,this._fileName)}));var o=(e,t)=>{if(e){var n=this._experienceBase.getManager("VCXDocManager"),a=n.BuildPathFromString(e,t),r=n.AddOrModifyDoc(a);i.resolve(r)}else i.resolve(null)};return i.promise}}})),define("DS/VCXWebGUI/VCXTimelineController",["DS/CoreEvents/Events","DS/WebRBTree/WebRBIterator","DS/VCXWebTimeline/VCXWebTimelineController","DS/VCXWebKernelCommands/VCXCmdChangeKeys","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebKernelCommands/VCXCmdChangeTimePos","DS/VCXWebKernel/VCXCmdGoToMarker","DS/ApplicationFrame/CommandsManager","DS/VCXWebProperties/VCXPropertyMap","DS/VCXWebProperties/VCXPropertySet"],(function(e,t,i,n,a,r,s,o,l,c){"use strict";var d=i.extend({init:function(e){this._parent(e),this.options=e},BuildView:function(t){this._parent(t);var i=this;this._VCX_Timeline_MODEL_STOP_PLAY=e.subscribe({event:"VCX_STOP_PLAY"},(function(e){i.options.experienceBase.getManager("VCXContextManager")&&i.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(!0);for(var t=0;t<i._timelines.length;t++)i._timelines[t].timeline.playGUIMode();i.updateTimelineFromModel()})),this._VCX_Timeline_MODEL_PAUSE_PLAY=e.subscribe({event:"VCX_PAUSE_PLAY"},(function(e){i.options.experienceBase.getManager("VCXContextManager")&&i.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(!0);for(var t=0;t<i._timelines.length;t++)i._timelines[t].timeline.playGUIMode()})),this._VCX_Timeline_MODEL_START_PLAY=e.subscribe({event:"VCX_START_PLAY"},(function(e){i.options.experienceBase.getManager("VCXContextManager")&&i.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(!1);for(var t=0;t<i._timelines.length;t++)i._timelines[t].timeline.pauseGUIMode()})),this._VCX_SCENARIO_END_REACHED=e.subscribe({event:"VCX_SCENARIO_END_REACHED"},(function(){i.onScenarioEnd()})),this._VCX_GOTO_MARKER=e.subscribe({event:"VCX_GOTO_MARKER"},(function(e){i.goToMarker(e)})),this._VCX_KEYS_CHANGED=e.subscribe({event:"VCX_KEYS_CHANGED"},(function(e){if(null!==i._nodeClass&&null!==e){var t=[];for(var n in e.setModifiablesTrackModified)t.push(n);i._updateListOfMarkers("update",t,e.keysForDo)}})),this._VCX_TIMEPOS_CHANGED=e.subscribe({event:"VCX_TIMEPOS_CHANGED"},(function(e){i.updateTimelineFromModel()}))},RemoveTimelineEvents:function(){this._parent(),e.unsubscribe(this._VCX_SCENARIO_END_REACHED),e.unsubscribe(this._VCX_GOTO_MARKER),e.unsubscribe(this._VCX_KEYS_CHANGED),e.unsubscribe(this._VCX_TIMEPOS_CHANGED),e.unsubscribe(this._VCX_Timeline_MODEL_START_PLAY),e.unsubscribe(this._VCX_Timeline_MODEL_PAUSE_PLAY),e.unsubscribe(this._VCX_Timeline_MODEL_STOP_PLAY),this._VCX_SCENARIO_END_REACHED=0,this._VCX_GOTO_MARKER=0,this._VCX_KEYS_CHANGED=0,this._VCX_TIMEPOS_CHANGED=0,this._VCX_Timeline_MODEL_START_PLAY=0,this._VCX_Timeline_MODEL_PAUSE_PLAY=0,this._VCX_Timeline_MODEL_STOP_PLAY=0},onScenarioEnd:function(){var e=this;e.options.experienceBase.getManager("VCXContextManager")&&e.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(!0),e.options.experienceBase.getManager("VCXScenarioManager").SetIsPlayingCurrentScenario(!1);for(var t=0;t<e._timelines.length;t++)e._timelines[t].timeline.playGUIMode()},actionOnKey:function(e,t,i,a,r,s,o,l){var c=this.getModifiableFromHashing(i);this._parent(e,t,c,a,r,s,o);var d=!1;void 0===l&&(d=!0,l=new n(this.options.experienceBase)),"move"==e?l.MoveKey(t,c,a,r,s):"copy"==e?l.ChangeKey(t,c,a,s,key.GetValue()):"delete"==e&&l.ChangeKey(t,c,a,r,null),d&&this.options.experienceBase.getManager("VCXCommandManager").Push(l)},ChangeTimePos:function(e,t){this._parent(e,t),"record"===this.options.experienceBase.odt&&this.getFrameFromModel()!==e&&this.options.experienceBase.getManager("VCXODTManager").LogAPI("VCXChangeTimePos",e);var i=new r(this.options.experienceBase),n=void 0,a=void 0;void 0!==e.from?(n=e.from,a=e.to):"number"==typeof e&&(a=e),i.ChangeTimePos(a,n),this.options.experienceBase.getManager("VCXCommandManager").Push(i)},onTimelineGoToMarker:function(e){this._parent(e);var t=this;t.options.experienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario()&&(t.options.experienceBase.getManager("VCXContextManager")&&t.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(!0),t.options.experienceBase.getManager("VCXScenarioManager").SetIsPlayingCurrentScenario(!1));var i=new s(t.options.experienceBase.getManager("VCXScenarioManager"),t.options.experienceBase.getManager("VCXCommandManager"),t.getComponentsMap());i.GoToMarker(e.id),t.options.experienceBase.getManager("VCXCommandManager").Push(i)},goToMarker:function(e){this._parent();this.options.experienceBase.getManager("VCXScenarioManager").SetCurrentFrame(e),this.updateTimelineFromModel()},onTimelineNextMarker:function(){this._parent();var e=this;e.options.experienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario()&&(e.options.experienceBase.getManager("VCXContextManager")&&e.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(!0),e.options.experienceBase.getManager("VCXScenarioManager").SetIsPlayingCurrentScenario(!1));var t=new s(e.options.experienceBase.getManager("VCXScenarioManager"),e.options.experienceBase.getManager("VCXCommandManager"),e.getComponentsMap());t.GoToNextMarker(),e.options.experienceBase.getManager("VCXCommandManager").Push(t)},OnTimelinePreviousMarker:function(){this._parent();var e=this;e.options.experienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario()&&(e.options.experienceBase.getManager("VCXContextManager")&&e.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(!0),e.options.experienceBase.getManager("VCXScenarioManager").SetIsPlayingCurrentScenario(!1));var t=new s(e.options.experienceBase.getManager("VCXScenarioManager"),e.options.experienceBase.getManager("VCXCommandManager"),e.getComponentsMap());t.GoToPreviousMarker(),e.options.experienceBase.getManager("VCXCommandManager").Push(t)},onTimelineCamera:function(e){this._parent(e);var t=null,i=this.options.experienceBase.getManager("VCXContextManager");i&&(t=i.getContext());var n=o.getCommandCheckHeader("VCXCameraPlayModeCmd",t);n&&n.setState(e),this.updateTimelineFromModel()},onTimePosChangeStart:function(){this._parent()},onTimePosChangeWhile:function(e){this._startChangeTime&&this.options.experienceBase.getManager("VCXCommandManager").StartTransaction(),this._parent(e),this._startChangeTime=!1},onTimePosChangeEnd:function(e){this._parent(e),this._startChangeTime=!0,this._startChangeTime&&this.options.experienceBase.getManager("VCXCommandManager").EndTransaction()},onStartPlay:function(){if(!this.options.experienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario())this.options.experienceBase.getManager("VCXAPIManager").PlayAnimation()},onStopPlay:function(){var t=this;t.options.experienceBase.getManager("VCXContextManager")&&t.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(!0),t.ChangeTimePos(0,!1),t.options.experienceBase.getManager("VCXScenarioManager").SetIsBouncing(!1),t.options.experienceBase.getManager("VCXScenarioManager").SetIsPlayingCurrentScenario(!1),e.publish({event:"VCX_STOP_PLAY"}),t.updateTimelineFromModel(),t._parent()},onPausePlay:function(){var e=this;e.options.experienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario()&&(e.options.experienceBase.getManager("VCXContextManager")&&e.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(!0),e.options.experienceBase.getManager("VCXAPIManager").PauseAnimation()),e._parent()},setPropertyOnScenario:function(e,t){var i=this.options.experienceBase.getManager("VCXScenarioManager"),n=this.getScenarioM(i.GetCurrentScenario()).QueryInterface("VCXIModifiable"),r=new a(this.options.experienceBase),s=null,o=(s=n.GetProperty(e).Clone()).GetPropertyValue();o.SetValue(t),s.SetPropertyValue(o),r.ChangeProperty(n,s),this.options.experienceBase.getManager("VCXCommandManager").Push(r)},setScenarioAnimationLoop:function(e){this.setPropertyOnScenario("Scenario.bIsLoop",e)},setScenarioAnimationBounce:function(e){this.setPropertyOnScenario("Scenario.bIsBounce",e)},setScenarioAnimationReverse:function(e){this.setPropertyOnScenario("Scenario.bIsReverse",e)},onTimelineStepForward:function(){this._parent();var e=this,t=e.getFrameFromModel();if(t>e.options.maxFrame){e.options.experienceBase.getManager("VCXContextManager")&&e.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(!0),e.options.experienceBase.getManager("VCXScenarioManager").SetIsPlayingCurrentScenario(!1);for(var i=0;i<e._timelines.length;i++)e._timelines[i].timeline.playGUIMode()}else{e.options.experienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario()&&(e.options.experienceBase.getManager("VCXContextManager")&&e.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(!0),e.options.experienceBase.getManager("VCXScenarioManager").SetIsPlayingCurrentScenario(!1)),t++,e.ChangeTimePos(t,!0),e.updateTimelineFromModel()}},onTimelineStepBackward:function(){this._parent();var e=this,t=e.getFrameFromModel();0!=t&&(e.options.experienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario()&&(e.options.experienceBase.getManager("VCXContextManager")&&e.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(!0),e.options.experienceBase.getManager("VCXScenarioManager").SetIsPlayingCurrentScenario(!1)),t--,e.ChangeTimePos(t,!0),e.updateTimelineFromModel())},getFrameFromModel:function(){return this.options.experienceBase.getManager("VCXScenarioManager").GetCurrentFrame()},getSelection:function(){return this._isFilterOnSelectionMode?this.getCurrentSelection():[]},getCurrentSelection:function(){return this.options.experienceBase.getManager("VCXSelectionManager").GetComponentsFromCurrentSelection().map((function(e){return e.QueryInterface("VCXIModifiable")}))},getScenarioM:function(e){return this.options.experienceBase.getManager("VCXScenarioManager")._Scenarios[e]},getComponentsMap:function(){return this.options.experienceBase.ComponentsMap},getModifiableFromHashing:function(e){return this.options.experienceBase.getManager("VCXScenarioManager").ModifiableServer.GetModifiableFromHashing(e)},getTrackModelFromTrackNode:function(e){},convertTrackNameToDisplayName:function(e,t){var i="";switch(this.convertTrackToId(e,t)){case 0:i="Position";break;case 4:i="Properties";break;case 2:i="Opacity";break;case 1:i="Materials";break;case 5:i="Links";break;case 8:i="Others";break;case 6:i="Viewport";break;case 3:i="Camera";break;case 7:i="Digger";break;default:i="unknown"}return i},removeTrackFromModel:function(e,t,i){for(var a=new n(this.options.experienceBase),r=this.getScenarioM(this.options.scenarioID),s=this.options.experienceBase.getManager("VCXScenarioManager").ModifiableServer,o=0;o<e.length;o++)for(var l=e[o].getParent().options._hash,c=s.GetModifiableFromHashing(l),d=e[o].getChildren()||[],u=0;u<d.length;u++){var h=d[u],p=h.options.strPropertyName,m=h.options.key._frame;a.ChangeKey(r,c,p,m,null)}this.options.experienceBase.getManager("VCXCommandManager").Push(a)},removeTrackFromModelFlatten:function(e,i,a){var r=new n(this.options.experienceBase),s=this.getScenarioM(this.options.scenarioID),o=this.options.experienceBase.getManager("VCXScenarioManager").ModifiableServer,l=[];this.modifiables=this.getSelection(),0!==this.modifiables.length&&this.modifiables.forEach((function(e){var t=e.GetObject().GetID();t?l.push(t):console.log("VCXTimelineExtCtrl: hashing is empty !")}));var c=[];if(l&&0!==l.length)for(var d=l.length,u=0;u<d;u++){var h=this.getComponentsMap(),p=l[u],m=h.GetComponentFromID(p);if(m){var C=(v=m.QueryInterface("VCXIModifiable")).GetHashing();c.push(C)}else console.log("component not found here !")}else this.getFilterOnSelectionMode()||s.GetListModifiables(c);var g=c.length;this.flattenKeysArray=[];for(var _=0;_<g;_++){var b=c[_],v=o.GetModifiableFromHashing(b),f=s.GetObjectAnimation(b),S=[];f.GetListTrackNames(S);for(var V=0;V<S.length;V++){if(this.convertTrackNameToDisplayName(S[V],v.GetObject().GetType())===e.options.label){var x=f.GetTrack(S[V]);if(x)for(var I=x._treekeys,y=new t(I),P=y.next();null!==P;){var M=P.GetFrame();i&&a&&(M<i||M>a)?P=y.next():(r.ChangeKey(s,v,S[V],M,null),P=y.next())}}}}this.options.experienceBase.getManager("VCXCommandManager").Push(r)},generateListOfMarkers:function(e,i,n,a){void 0===e&&(e="Add");var r=[];void 0===i&&(this.modifiables=this.getSelection()),0!==this.modifiables.length&&this.modifiables.forEach((function(e){var t=e.GetObject().GetID();t?r.push(t):console.log("VCXTimelineExtCtrl: hashing is empty !")})),this.options.scenarioID;var s=this.getScenarioM(this.options.scenarioID);if(s){if(void 0===i)if(i=[],r&&0!==r.length)for(var o=r.length,l=0;l<o;l++){var c=this.getComponentsMap(),d=r[l],u=c.GetComponentFromID(d);if(u){var h=(C=u.QueryInterface("VCXIModifiable")).GetHashing();i.push(h)}else console.log("component not found here !")}else this.getFilterOnSelectionMode()||s.GetListModifiables(i);var p=i.length;this.flattenKeysArray=[];for(var m=0;m<p;m++){var C,g=i[m],_=s.GetObjectAnimation(g),b=null;if((C=this.getModifiableFromHashing(g))&&(b=C.GetObject().GetID()),_&&b){var v=[];_.GetListTrackNames(v);for(var f=null,S=0;S<v.length;S++){f="#cccccc";var V=v[S],x=_.GetTrack(V);if(x){var I="";I=!0===this.options.flattenKeys?this.convertTrackToId(V,C.GetObject().GetType()):m;for(var y=x._treekeys,P=new t(y),M=P.next();null!==M;){var w=M.GetFrame();w,I,1===I&&!0===this.options.flattenKeys&&M&&M.GetValue()&&M.GetValue()&&M.GetValue().Clone()._value.GetColorHexString&&(f="#"+M.GetValue().Clone()._value.GetColorHexString());var D=null;D||(D={length:1,keyColor:f,componentHash:g,strPropertyName:V,data:M},this.options.flattenKeys,this._addKey(w,1,D.keyColor,I,D.componentHash,D.strPropertyName,D.data,a)),M=P.next()}}}}}}return[]},generateClientTreeTracks:function(e){var t=[],i=this.getScenarioM(this.options.scenarioID);i.GetListModifiables(t);for(var n=0,a=t.length,r=0;r<a;r++){var s=t[r],o=i.GetObjectAnimation(s);if(o){var l=this.getModifiableFromHashing(s),c=this.getModifiableName(l),d=this._createTrackNode(this._nodeClass,c,n,e._getTrueRoot());d._options._hash=s,n=1+d.options.id;var u=[];o.GetListTrackNames(u);for(var h=0;h<u.length;h++){var p=this._createTrackNode(this._nodeClass,u[h],n,d);n=1+p.options.id,p._options.preventDisplayChilds=!0}}}},getTrackTreeListView:function(){for(var e=0;e<this._timelines.length;e++){var t=this._timelines[e].timeline.getTrackTreeListView();if(t)return t}return null},getTimelineModel:function(){for(var e=0;e<this._timelines.length;e++){var t=this._timelines[e].timeline.getTimelineModel();if(t)return t}return null},getModifiableName:function(e){var t=e&&e.GetProperty("Actor.Name"),i=t&&t.GetPropertyValue().GetValue();""===i&&(i=e.GetHashing()+" (no name)");return i},onAddTracksKey:function(e){if(3===e.trackId)o.getCommand("VCXAddCameraKeyCmd",this.options.experienceBase.getManager("VCXContextManager").getContext())&&o.getCommand("VCXAddCameraKeyCmd",this.options.experienceBase.getManager("VCXContextManager").getContext()).begin();else{if(this.modifiables=this.getCurrentSelection(),6===e.trackId){var t=this.options.experienceBase.getManager("VCXContextManager").getActiveViewport();this.modifiables=[],this.modifiables.push(t.QueryInterface("VCXIModifiable"))}if(0!==this.modifiables.length){for(var i=new l,n=0;n<this.modifiables.length;n++){var r=new c,s=this.modifiables[n],d=s.GetProperties();if(d){for(var u in d._map)this.convertTrackToId(u,s.GetObject().GetType())===e.trackId&&r.AddOrModifyProperty(d.GetProperty(u).Clone());i.AddOrModifyPropertySet(s.GetHashing(),r)}}var h=new a(this.options.experienceBase,!0);h.ChangePropertiesFromMap(i),this.options.experienceBase.getManager("VCXCommandManager").Push(h)}}},onSelectionAreaMoveFlatten:function(e){this.getTimelineModel().lock++;for(var t=Math.round(e.timeInitStart*e.timeToFrame),i=Math.round(e.timeInitEnd*e.timeToFrame),a=Math.round(e.timeFinalStart*e.timeToFrame),r=i-t,s=Math.round(e.timeFinalEnd*e.timeToFrame)-a,o=new n(this.options.experienceBase),l=0;l<e.tracks.length;l++){var c=e.tracks[l]._rowID||e.tracks[l]._localID+5,d=this.flattenKeysArray[c];if(d)for(var u in d)if(!(u<t||u>i)){var h=u,p=Math.round(a+(u-t)*s/r);this.actionsOnKeys(null,"move",null,h,p,e.scenarioID,c,o)}}this.getTimelineModel().lock--,this.options.experienceBase.getManager("VCXCommandManager").Push(o)}});return d.VCXWebTimelineGUIEnum=VCXWebTimelineGUIEnum,d})),define("DS/VCXWebGUI/VCXComboBox",["UWA/Class","DS/Controls/ComboBox","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/Windows/Panel"],(function(e,t,i,n,a){return e.extend({init:function(e,t,i){if(!i.referenceUI)return void console.warn("A reference UI component needs to be set to place the comboBox");this._experienceBase=e;const n=this._experienceBase.getManager("VCXGUIManager");let r=new UWA.createElement("div",{class:"contentBar contentBarFlexDirectionColumn"});const s=n.immersiveFrame;if(this.buildComboBox({content:t},r),this.subPanel=new a({immersiveFrame:s,identifier:"wuxComboBoxPanel",allowedDockAreas:WUXDockAreaEnum.NoneDockArea,titleBarVisibleFlag:!1,content:r}),this.subPanel&&this.subPanel.getContent()){const e=i.referenceUI.getBoundingClientRect(),t=i.positionUI.offsetX?i.positionUI.offsetX:0,n=i.positionUI.offsetY?i.positionUI.offsetY:1,a=i.positionUI.at?i.positionUI.at:"bottom-left",r=i.positionUI.my?i.positionUI.my:"top-left",s=i.positionUI.height?i.positionUI.height:e.height;let o=i.positionUI.width?i.positionUI.width:e.width,l=i.offsetUI??{};const c=o*(l.x??0),d=s*(l.y??0);o=Math.max(o,130);let u,h,[p,m]=a.split("-"),C=e[m],g=e[p],[_,b]=r.split("-"),v=C+("left"===b?+t:-t),f=g+("top"===_?+n:-n);u="left"===b?v:v-o,h="top"===_?f:f-s,u=Math.floor(100*u)/100,h=Math.floor(100*h)/100,u+=c,h+=d;const S=`border: transparent; border-radius: 5px 5px 0 0; width: ${o}px; left: ${u}px; top: ${h}px; visibility: visible; height: ${s}px;`;this.subPanel.getContent().style=S,this.subPanel.getContent().id="VCXComboBox",Object.defineProperty(this.subPanel.getContent(),"style",{configurable:!1,writable:!1})}},getElements:function(){return this._comboBox?this._comboBox.elements:null},getMainElement:function(){return this._comboBox?this._comboBox._getMainElement():null},destroy:function(){this._comboBox&&this._comboBox.destroy(),this.subPanel&&this.subPanel.destroy()},buildComboBox:function(e,a){const r=e.content;if(!r)return;const s=new i({shouldBeSelected:e=>"section"!==e.options.comboBoxSemantics});for(let t in r){let i=new n({label:t,icons:[{iconName:e.iconParent?e.iconParent:"attributes"}],comboBoxSemantics:"section",description:t});s.addRoot(i);for(let a of r[t]){const t=new n({label:a.nlsName,icons:[{iconName:e.iconChild?e.iconChild:"properties"}],comboBoxSemantics:"subsection",description:a.nlsName}),r=()=>{a.callback()};t.onSelect(r),t.onPreselect(a.callback),i.addChild(t)}}s.expandAll(),this._comboBox=new t({elementsTree:s,useMatchingSearchFunction:!0,placeholder:"Search Property"}),this._comboBox.inject(a)},_onChangeSelectionInComboBox:function(){console.log("selectedIndex: "+this._comboBox.selectedIndex),console.log("value: "+this._comboBox.value),console.log("label: "+this._comboBox.label),console.log("preselectedIndex: "+this._comboBox.preselectedIndex)}})}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebGUI/ambiences/VCXAmbienceCurrentCard",["require","exports","DS/VCXGUIInfrastructure/VCXUICard","UWA/Core","DS/Controls/Loader"],(function(e,t,i,n,a){"use strict";a=__importDefault(a);return class extends i{constructor(e){super(e);let t=this.cardElement.querySelector(".vcxUICard-thumbnail-container");this.loadingDiv=(0,n.createElement)("div",{class:"vcxCurrentAmbienceLoading ambienceThumbnail"});let i=new a.default;return i.on(),t.appendChild(this.loadingDiv),this.loadingDiv.appendChild(i.getContent()),this.thumbnail.addClassName("ambienceThumbnail"),this}setImage(e){super.setImage(e),null!==e?this.loadingDiv.hide():this.loadingDiv.show()}}})),define("DS/VCXWebGUI/VCXMediaChooserServices",["UWA/Class","DS/VCXWebProperties/VCXPropertyValueDocId","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXMediaChooser/VCXChoosePicture","DS/VCXMediaChooser/VCXImageGallery"],(function(e,t,i,n,a){"use strict";return e.extend({init:function(e){this._experienceBase=e},GetDocIDFromImageLoadQuery:function(){if(this._experienceBase.odt){var e=this._experienceBase.getManager("VCXDocManager").QueryInterface("VCXIModifiable"),i=e&&e.GetDefaultImageIdx();return new t(i)}var a=UWA.Promise.deferred(),r=new n(this._experienceBase);"undefined"!=typeof widget&&r.setWidget(widget),r.open(function(e,t){this._imageUrl=e,this._fileName=t}.bind(this),function(e,t){s(this._imageUrl,this._fileName)}.bind(this));var s=function(e,t){if(e){var i=this._experienceBase.getManager("VCXDocManager"),n=i.BuildPathFromString(e,t),r=i.AddOrModifyDoc(n);a.resolve(r)}else a.resolve(null)}.bind(this);return a.promise}})})),define("DS/VCXWebGUI/VCXMetaPropertiesCtrl",["require","exports"],(function(e,t){"use strict";return class{constructor(e){this._experienceBase=e,this._view=null}buildMetaPropertiesView(e){console.log(e)}unInitialize(){this._view&&(this._view.destroy(),this._view=null)}_getListMetaProperties(){const e=this._experienceBase.getManager("VCXMetaPropertyManager");let t={};if(e&&e.getMetaInfo){const i=e.getMetaInfo(),n=i.extensions.xHighlightAuthoring;if(n&&n.nlsName){t[i.extensions.xHighlightAuthoring.nlsName]=[];for(let e of i.extensions.xHighlightAuthoring.predicates){let n={};n.name=e.name,n.nlsName=e.nlsName,n.extension="xHighlightAuthoring",n.property=e.property,n.callback=()=>this._buildChangePropertyCallback(e.property),n.endCallback=this._buildOnEndCallback,t[i.extensions.xHighlightAuthoring.nlsName].push(n)}}for(let e in i.extensions)if("xHighlightAuthoring"!==e&&i.extensions[e].nlsName){t[i.extensions[e].nlsName]=[];for(let n of i.extensions[e].predicates){let a={};a.name=n.name,a.nlsName=n.nlsName,a.extension=e,a.property=n.property,a.callback=()=>this._buildChangePropertyCallback(n.property),a.endCallback=this._buildOnEndCallback,t[i.extensions[e].nlsName].push(a)}}}else{let e=Math.floor(3*Math.random()+4);for(let i=0;i<=e;i++){t["Extension "+i]=[];let e=Math.floor(8*Math.random()+2);for(let n=0;n<=e;n++){let e={};e.name="property"+i+"."+n,e.nlsName="NLS Property"+i+"."+n,e.extension="extension"+i,e.property="Meta.property"+i+"."+n,e.callback=()=>this._buildChangePropertyCallback("Meta.property"+i+"."+n),e.endCallback=this._buildOnEndCallback,t["Extension "+i].push(e)}}}return t}_buildChangePropertyCallback(e){console.log(e)}_buildOnEndCallback(){}}})),define("DS/VCXWebGUI/VCXMaterialCard",["require","exports","DS/Menu/ContextualMenu","UWA/Core","DS/Utilities/Dom","DS/Core/TooltipModel","DS/VCXGUIInfrastructure/VCXUICard"],(function(e,t,i,n,a,r,s){"use strict";return class extends s{constructor(e){super(e),this.activeClassName="materialCardActive",this.isInternal=e.isInternal??!1,this.experimentFeature=e.experimentFeature??{},this.isVisible=e.isVisible??!1,this.label.addEventListener("keydown",(e=>{"Enter"===e.key&&this.label.blur()})),this.label.tooltipInfos=new r({shortHelp:e.title}),this.isInternal&&this.hideSelectToogle(),this.selectCallback=()=>console.log("Not defined"),this.unSelectCallback=()=>console.log("Not defined"),this.contextMenuButton.getContent().style.display="";let t=this.cardElement.querySelector(".vcxUICard-descriptionActionBar");t.classList.add("materialDescriptionActionBar"),t.classList.add("vcxMaterialCard-descriptionActionBar"),this.cardElement.querySelector(".vcxUICard-descriptionContainer").classList.add("vcxMaterialCard-descriptionContainer"),this.cardElement.querySelector(".vcxUICard-descriptionTitle").classList.add("vcxMaterialCard-descriptionTitle"),this.iconVisible=(0,n.createElement)("div",{html:"",class:"iconVisibleContainer"});let i=a.generateIcon({iconName:"raw-material",fontIconFamily:WUXManagedFontIcons.Font3DS,className:"vcxSceneUpdate materialVisibleInScene"});if(this.iconVisible.style.display="none",i.inject(this.iconVisible),this.iconVisible.inject(t),this.thumbnail.addClassName("materialThumbnail"),this.iconOverruled=(0,n.createElement)("div",{html:"",class:"vcxUICard-thumbnail vcxUICard-thumbnail overlayIndexingMaterial"}),(0,n.createElement)("div",{html:"Overruled",class:"overruledText"}).inject(this.iconOverruled),this.iconOverruled.inject(this.cardElement),this.iconIndexing=(0,n.createElement)("div",{html:"",class:"vcxUICard-thumbnail vcxUICard-thumbnail overlayIndexingMaterial"}),e.cardLayout&&e.cardLayout.ratioX&&e.cardLayout.ratioY&&e.cardLayout.cardWidth){let t=e.cardLayout.cardWidth*e.cardLayout.ratioY/e.cardLayout.ratioX;this.iconIndexing.style.height=t+"px",this.iconOverruled.style.height=t+"px"}return a.generateIcon({iconName:"clock",fontIconFamily:WUXManagedFontIcons.Font3DS,className:"iconIndexingMaterial"}).inject(this.iconIndexing),this.iconIndexing.inject(this.cardElement),this.iconIndexing.style.display="none",this.iconOverruled.style.display="none",this.experimentFeature.splitted&&this.isInternal&&this.getView().addClassName("internalV2"),this}updateThumbnail(e){this.thumbnail.src=e}getIndexingIcon(){return this.iconIndexing}setOverruledIcon(e){this.iconOverruled.style.display=e?"":"none"}setIndexingIcon(e){this.iconIndexing.style.display=e?"none":""}getIsInternal(){return this.isInternal}getVisibleLabel(){return this.iconVisible}activateCard(){this.cardElement.hasClassName("materialCardVisible")&&this.cardElement.removeClassName("materialCardVisible"),this.cardElement.addClassName(this.activeClassName)}deactivateCard(){this.cardElement.removeClassName(this.activeClassName),this.isVisible&&this.cardElement.addClassName("materialCardVisible")}getVisibleState(){return this.isVisible}setVisibleCardIcon(){this.isVisible=!0,this.cardElement.addClassName("materialCardVisible")}setNotVisibleCardIcon(){this.isVisible=!1,this.cardElement.removeClassName("materialCardVisible")}setOnSelectCardCallback(e){this.selectCallback=e}setOnUnselectCardCallback(e){this.unSelectCallback=e}customizeMenu(e){i.addEventListener(this.contextMenuButton.getContent(),{callback:()=>{let t=new Array;for(let i=0;i<e.length;i++){const n=e[i];let a="enabled";(n.considerStateSelect&&!this.getVisibleState()||n.considerStateDelete&&this.getIsInternal())&&(a="disabled"),t.push({type:"PushItem",state:a,title:n.label,fonticon:{content:"wux-ui-3ds-"+n.icon+" wux-ui-3ds"},action:{callback:n.action}})}return t}}),this.contextMenuButton.getContent().style.display=""}}})),define("DS/VCXWebGUI/VCXCardTypeEnum",["require","exports"],(function(e,t){"use strict";var i;return function(e){e.SCENE="SCENE",e.MATERIAL="MATERIAL",e.AMBIENCE="AMBIENCE",e.RATIO="RATIO"}(i||(i={})),i})),define("DS/VCXWebGUI/VCXGettingStartedExperienceInformationModal",["UWA/Class","DS/UIKIT/Form","DS/UIKIT/Spinner","DS/UIKIT/SuperModal","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/LineEditor","DS/Controls/ComboBox","DS/Tweakers/TweakerBlob","DS/UIKIT/Accordion","DS/UIKIT/Input/File","DS/WebappsUtils/WebappsUtils","DS/Core/PointerEvents","DS/VCXWebPlatform/VCX3DSpaceServices","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI"],(function(e,t,i,n,a,r,s,o,l,c,d,u,h,p,m){var C=null,g=null,_=null,b=null,v=null;return e.singleton({initialize:function(){this._parentDivName="vcx-Curtain-Home",this._defautSecurityContext={role:"",collabspace:"",organization:""}},unInitialize:function(){this._parentDivName=null,this._isLocalMode=null,this._experienceBase=null},addTile:function(e,t,i,n,a){var r=UWA.Element("div",{html:"",class:"vcx-Curtain-Experience-Tile"+(n?"":" vcxFreezed")}).inject(e);n&&r.addEvent(h.POINTERUP,(e=>{a()})),UWA.Element("img",{html:"",class:"vcx-Curtain-Experience-Image"+(n?"":" vcxFreezed"),src:u.getWebappsAssetUrl("VCXWebGUI","texture/gui/"+i)}).inject(r).style.animation="unset";var s=UWA.Element("div",{html:"",class:"vcx-Curtain-Experience-Footer"}).inject(r),o=UWA.Element("div",{html:"",class:"vcx-Curtain-Experience-Text"}).inject(s);UWA.Element("span",{text:t,class:"vcx-Curtain-Experience-Text2"}).inject(o)},createSaveBeforeCloseModal:function(e){return this._experienceBase=e,this._isLocalMode=e.getManager("VCXContextManager").IsLocalMode(),this._experienceBase.odt?UWA.Promise.resolve("Discard"):new UWA.Promise(((e,t)=>{var i=new n({renderTo:document.querySelector(this._parentDivName),animate:!0,className:"vcx-project-info-modal",events:{onShow:function(t){this.modals.current.elements.close.addEventListener("click",(()=>{e("Close")}))}}});i.dialog({title:m.ConfirmSavePanel,body:UWA.Element("div",{html:[new UWA.Element("div",{text:m["ConfirmSavePanel.Question"]})]}),buttons:[{className:"primary",value:m["ConfirmSavePanel.Save"],action:t=>{i.next(),e("Save")}},{className:"default",value:m["ConfirmSavePanel.Discard"],action:t=>{i.next(),e("Discard")}}],events:{onShow:function(){this.elements.close.addEventListener("click",(()=>{e("Close")}))}}})}))},createConfirmCancelModal:function(e){return this._experienceBase=e,this._isLocalMode=e.getManager("VCXContextManager").IsLocalMode(),new UWA.Promise(((e,t)=>{var i=new n({renderTo:document.querySelector(this._parentDivName),animate:!0,className:"vcx-project-info-modal",events:{onHide:()=>{e("Close")}}});i.dialog({title:"Cancel Recovering",body:UWA.Element("div",{html:"Are you sure you want to cancel the recovering process? <br/>The Experience will be closed, unsaved changes are lost."}),buttons:[{className:"primary",value:"Yes",action:t=>{i.next(),e("Yes")}},{className:"default",value:"No",action:t=>{i.next(),e("No")}}]})}))},createNewExperienceModal:function(e,a,r){this._experienceBase=e,this._isLocalMode=e.getManager("VCXContextManager").IsLocalMode();var s="vcx-project-info-modal",o=new t({className:"horizontal",grid:"4 6",fields:this._createFormFields(a,r),events:{onChange:()=>{o.submit(!0),this._onUpdateForms(!0)}}});return o.getListInput("collabSpace")&&((C=o.getListInput("collabSpace")).hide(),(new i).show().inject(C.getContent().parentNode)),o.getListInput("filePicker")&&((g=o.getListInput("filePicker")).hide(),(new i).show().inject(g.getContent().parentNode)),o.getListInput("prefix")&&((g=o.getListInput("prefix")).hide(),(new i).show().inject(g.getContent().parentNode)),o.getListInput("asReference")&&((_=o.getListInput("asReference")).hide(),(new i).show().inject(_.getContent().parentNode)),o.getListInput("insertProducts")&&((b=o.getListInput("insertProducts")).hide(),(new i).show().inject(b.getContent().parentNode)),new UWA.Promise(((e,t)=>{new n({renderTo:document.querySelector(this._parentDivName),animate:!0,className:s,events:{onHide:()=>{e("Close")}}}).dialog({title:m["VCXGettingStartedExperienceInformationModal.NewExperience"],body:UWA.Element("div",{html:[o]}),buttons:[{attributes:{styles:{"margin-top":"0px"}},className:"nextButton blueButton primary disable",value:m["VCXGettingStartedExperienceInformationModal.Create"],action:t=>{if(o.submit(!0),1==o.validate(!1,!1)){var i=o.getValue("projectName"),n=o.getField("collabSpace"),a=o.getField("filePicker"),s=o.getField("prefix"),l=o.getField("asReference");let c="",d="",u="",h=!1,p="",m="";if(!this._isLocalMode){let e=JSON.parse(n.value);c=e.collabspace,d=a&&a.files[0],u=s&&s.value,h=l&&l.checked,p=e.role,m=e.organization}t.hide(),e({experienceName:i,collabspace:c,file:d,prefix:u,asReference:h,role:p,organization:m,content:r})}}}]}),this._nextButton=document.querySelector("."+s+" .nextButton"),this._createFieldsContent()}))},Import3dxmlModal:function(e,a,r,s){this._experienceBase=e,this._isLocalMode=e.getManager("VCXContextManager").IsLocalMode();var o=a&&a.replace(".3dxml",""),l="vcx-project-info-modal",c=UWA.Element("div",{class:"vcx-browseFile-container"}),u=UWA.Element("div",{text:a||m["VCXGettingStartedExperienceInformationModal.3dxmlPlaceholder"],class:"vcx-browseFile-text"});u.inject(c);var h=new d({attributes:{accept:".3dxml"},input:!1,icon:"folder",required:!0,events:{onChange:e=>{h.getValue()?(u.textContent=h.getValue(),this._nextButton.removeAttribute("disabled"),v&&!v.isDisabled()&&v.setValue(h.getValue().replace(".3dxml","")+" - Presentation")):(u.textContent=m["VCXGettingStartedExperienceInformationModal.3dxmlPlaceholder"],this._nextButton.setAttribute("disabled",""),v&&!v.isDisabled()&&v.setValue(m["VCXGettingStartedExperienceInformationModal.DefaultPresentationName"]))}}});h.inject(c),h.elements.button.addClassName("btn-with-icon");var p=new UWA.Element("span",{class:"fonticon fonticon-folder"});h.elements.button.insertBefore(p,h.elements.button.firstChild);var f=new t({className:"horizontal",grid:"4 6",fields:this._create3dxmlFormFields(o,r,s),events:{onChange:()=>{f.submit(!0),this._onUpdateForms(s)}}});f.getContent().addClassName("vcx-3dxml-form");return f.getListInput("collabSpace")&&((C=f.getListInput("collabSpace")).hide(),(new i).show().inject(C.getContent().parentNode)),f.getTextInput("prefix")&&(g=f.getTextInput("prefix")),f.getBooleanInput("insertProducts")&&(b=f.getBooleanInput("insertProducts")),f.getBooleanInput("asReference")&&(_=f.getBooleanInput("asReference")),f.getTextInput("projectName")&&(v=f.getTextInput("projectName")),new UWA.Promise((async(e,t)=>{new n({renderTo:document.querySelector(this._parentDivName),animate:!0,className:l,events:{onHide:()=>{e("Close")}}}).dialog({title:s?m["VCXGettingStartedExperienceInformationModal.import3dxmlModal"]:m["VCXGettingStartedExperienceInformationModal.insert3dxmlModal"],body:UWA.Element("div",{html:[c,f]}),buttons:[{attributes:{styles:{"margin-top":"0px"}},className:"nextButton blueButton primary disable",value:m["VCXGettingStartedExperienceInformationModal.Import"],action:t=>{if(f.submit(!0),1==f.validate(!1,!1)){var i=f.getField("collabSpace"),n=f.getField("prefix"),a=f.getField("asReference");f.getField("insertProducts");let s="",o="",l="",c=!1,d=!1,u="",p="";if(!this._isLocalMode){let e=JSON.parse(i.value);s=e.collabspace,o=h&&h.elements.input.files,l=n&&n.value,c=!1,d=!a||a.checked,u=e.role,p=e.organization}t.hide(),e({experienceName:"",collabspace:s,files:o,prefix:l,asReference:d,insertProducts:c,role:u,organization:p,content:r})}}},{value:m["VCXGettingStartedExperienceInformationModal.Cancel"],action:e=>{e.hide()}}]}),await this._createFieldsContent(),this._nextButton=document.querySelector("."+l+" .nextButton"),a||this._nextButton.setAttribute("disabled","")}))},_createFormFields:function(e,t){var i=[],n=null,a="";n&&(a=(a=n.firstName.substring(0,1)+""+n.lastName.substring(0,1)).toUpperCase());var r=m["VCXGettingStartedExperienceInformationModal.DefaultPresentationName"];e&&(r=e+" - Presentation"),r+=a;var s={type:"text",label:m["VCXGettingStartedExperienceInformationModal.ProjectName"],name:"projectName",value:r,pattern:"[a-zA-Z0-9]+",required:!0};if(i.push(s),!this._isLocalMode){var o={type:"list",label:m["VCXGettingStartedExperienceInformationModal.CollabSpace"],name:"collabSpace",options:[{}]};if(i.push(o),t&&"3dxml"===t.type){if(a="",(n=null)&&(a=(a=n.firstName.substring(0,1)+""+n.lastName.substring(0,1)).toUpperCase()),!e){var l={type:"file",label:m["VCXGettingStartedExperienceInformationModal.filePicker"],name:"filePicker",options:[{}]};i.push(l)}var c={type:"text",label:m["VCXGettingStartedExperienceInformationModal.Prefix"],name:"prefix",value:a,options:[{}]};i.push(c);var d={type:"checkbox",label:m["VCXGettingStartedExperienceInformationModal.AsReference"],name:"asReference",value:!1,options:[{}]};i.push(d)}}return i},_create3dxmlFormFields:function(e,t,i){var n=[],a=null,r="";a&&(r=(r=a.firstName.substring(0,1)+""+a.lastName.substring(0,1)).toUpperCase());m["VCXGettingStartedExperienceInformationModal.DefaultPresentationName"];if(e&&e+" - Presentation",r,!this._isLocalMode){var s={type:"list",label:m["VCXGettingStartedExperienceInformationModal.3dxmlLocation"],name:"collabSpace",readOnly:i,options:[{}]};n.push(s),r="",(a=null)&&(r=(r=a.firstName.substring(0,1)+""+a.lastName.substring(0,1)).toUpperCase());var o={type:"text",label:m["VCXGettingStartedExperienceInformationModal.3dxmlPrefix"],placeholder:m["VCXGettingStartedExperienceInformationModal.PrefixPlaceholder"],name:"prefix",value:r,options:[{}]};if(n.push(o),i){var l={type:"checkbox",label:m["VCXGettingStartedExperienceInformationModal.AsReference"],name:"asReference",value:!0,options:[{}]};n.push(l)}}return n},_createFieldsContent:async function(){let e=await p.GetSecurityContextInformations(),t=null;try{t=await p.GetPreferredSecurityContext()}catch(e){console.warn(e),t={role:"",collabspace:"",organization:""}}if(C){this._defautSecurityContext=t;var i=C.getContent().parentNode.getElementsByClassName("spinner");if(i.length>0&&i[0].remove(),e&&Object.keys(e).length>0){var n=this._getCollabSpaceRoleList(e);C.remove(),C.add(n),C.show()}else C.remove(),C.getContent().textContent="No collaborative spaces available",C.getContent().style.padding="10px",C.getContent().style.color="#FF0000",C.getContent().style.cursor="default",C.show()}},_getCollabSpaceRoleList:function(e){let t=[];for(let i in e)if(e.hasOwnProperty(i)){let n=e[i].highPrivilegeRoleOrga,a={};a.label=i+"  "+n.nlsrole,a.value=JSON.stringify(n),this._defautSecurityContext.collabspace===i&&(a.selected=!0),t.push(a)}return t.sort(((e,t)=>{let i=JSON.parse(e.value).collabspace,n=JSON.parse(t.value).collabspace;return i.localeCompare(n)})),t},_onUpdateForms:function(e){if(C){let e=C.getValue();if(e.length){let t=JSON.parse(e[0]);p.SetPreferredSecurityContext(t)}}else console.warn("Fields not found!");g&&_&&(_.isChecked()&&!g.isDisabled()?(g.setValue(" "),g.disable()):_.isChecked()||(" "===g.getValue()&&g.setValue(""),g.enable()))}})})),define("DS/VCXWebGUI/VCXTreeViewCellAbstract",["DS/Tree/TreeNodeView","DS/Core/PointerEvents","DS/CoreEvents/Events"],(function(e,t,i){"use strict";function n(e){var t=e.currentTarget||e.srcElement,i=t.currentStyle||window.getComputedStyle(t,null),n=parseInt(i.borderLeftWidth,10),a=parseInt(i.borderTopWidth,10),r=t.getBoundingClientRect();return{offsetX:e.clientX-n-r.left,offsetY:e.clientY-a-r.top}}return e.extend({init:function(e){this._parent(e),(this._manager.options.resize.rows||this._manager.options.resize.columns)&&this._manageResize()},updateInternalParameters:function(){this._parent();var e=this.getCellInfos();if(e){var t=e.nodeModel,i=t.getNextNode();"collapsed"===t.getState()||i&&"noChildren"!==i.getState()?this.getContent().addClassName("wux-controls-propertylistview-expander"):this.getContent().removeClassName("wux-controls-propertylistview-expander"),t.options.children&&0==t.options.children.length?this.getContent().addClassName("vcx-controls-propertylistview-expander-hide"):this.getContent().removeClassName("vcx-controls-propertylistview-expander-hide")}},destroy:function(){document.removeEventListener(t.POINTERMOVE,this._pointerMoveOnDocumentCB),document.removeEventListener(t.POINTERUP,this._pointerUpOnDocumentCB),this._pointerMoveOnDocumentCB=null,this._pointerUpOnDocumentCB=null,this._isPressed=!1,this.wantToResize=!1,this._pointerMoved=!1,this._deltaMouseInit={},this._parent()},_manageResize:function(){var e=this;e.getGridEngine()._enableInteractiveSort();var i,a,r,s,o=5,l=this.elements.container;this.wantToResize=!1,l.addEvent(t.POINTERMOVE,(function(t){if(!e._isPressed){var l=e.getCellInfos();i=l,a=l.manager,s=a.getColumnWidth(i.virtualColumnID),r=a.getRowHeight(i.virtualRowID);var c=n(t);a.options.resize.columns&&(c.offsetX<s+o&&c.offsetX>s-o?(e._setResizeStyle("r"),e.wantToResize=!0):(e._setResizeStyle(),e.wantToResize=!1)),a.options.resize.rows&&(c.offsetY<r+o&&c.offsetY>r-o?(e._setResizeStyle("b"),e.wantToResize=!0):(e._setResizeStyle(),e.wantToResize=!1))}})),this._pointerMoved=!1,this._isPressed=!1,this._deltaMouseInit={},this._newWidth,this._newHeight;UWA.extendElement(document);this.minWidth=0,this.maxWidth=1/0,l.addEvent(t.POINTERDOWN,(function(t){t&&t.originalEvent&&"touchstart"===t.originalEvent.type&&(e.wantToResize=!0,o=32,i=e.getCellInfos(),a=e.getGridEngine(),s=a.getColumnWidth(i.virtualColumnID),r=a.getRowHeight(i.virtualRowID));var l=n(t);if(e.wantToResize&&(l.offsetY<r+o&&l.offsetY>r-o||l.offsetX<s+o&&l.offsetX>s-o)){t.preventDefault(),a.getScroller().getContent().addClassName("wux-ui-locked"),a.lockUI(),e._deltaMouseInit={x:t.clientX,y:t.clientY},e._newWidth=s,e._newHeight=r,e._isPressed=!0;var c=e.getGridEngine()._getColumnOptionValue(i.virtualColumnID,"maxWidth");e.maxWidth=void 0!==c?c:1/0,e.minWidth=e.getGridEngine()._getColumnOptionValue(i.virtualColumnID,"minWidth"),e.getGridEngine()._disableInteractiveSort(!0)}})),this._pointerMoveOnDocumentCB=this._pointerMoveOnDocument.bind(this),document.addEventListener(t.POINTERMOVE,this._pointerMoveOnDocumentCB),this._pointerUpOnDocumentCB=this._pointerUpOnDocument.bind(this),document.addEventListener(t.POINTERUP,this._pointerUpOnDocumentCB)},_pointerMoveOnDocument:function(e){if(this._isPressed&&this.wantToResize){var t=this.getGridEngine(),i=this.getCellInfos(),n=t.getColumnWidth(i.virtualColumnID);this._pointerMoved||this.getGridEngine()._disableInteractiveSort(),this._pointerMoved=!0;var a={};a.x=e.clientX-this._deltaMouseInit.x,a.y=e.clientY-this._deltaMouseInit.y,n+a.x>=this.minWidth&&n+a.x<=this.maxWidth&&(this._newWidth=n+a.x,this._manager._updateViewOptions={detachAllViews:!1,updateCells:!1,updateColumnsHeaders:!0},t._instance._showColumnInsertionMark(t.getScroller().getPosition().x+t.getHeadersDimensions().width+t.getColumnPosition(i.virtualColumnID)+this._newWidth))}},_pointerUpOnDocument:function(e){if(this._isPressed){e.preventDefault(),e.stopPropagation(),this._setResizeStyle(),this.elements.container&&this.elements.container.removeClassName("wux-ui-state-active");var t=this;setTimeout((function(){t.getGridEngine()._enableInteractiveSort()}),300);var i=this.getGridEngine(),n=this.getCellInfos();-1!==n.virtualRowID&&i.setRowHeight(n.virtualRowID,this._newHeight),-1!==n.virtualColumnID&&(i.prepareUpdateView(),i.setColumnWidth(n.virtualColumnID,this._newWidth),i._requireFullUpdate(),this._manager._updateViewOptions={detachAllViews:!0,updateCells:!0,updateColumnsHeaders:!0},i.pushUpdateView(!0)),i._instance._hideRowInsertionMark(),i._instance._hideColumnInsertionMark(),i.unlockUI(),this._isPressed=!1,this.wantToResize=!1}}})}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebGUI/VCXCameraPanelView",["require","exports","DS/VCXGUIInfrastructure/VCXMainPanelFixed","UWA/Core","DS/VCXGUIInfrastructure/VCXAccordeonUIServices"],(function(e,t,i,n,a){"use strict";i=__importDefault(i),a=__importDefault(a);class r extends i.default{constructor(e,t){super(e,t),this.panelAccordeon=a.default.BuildAccordeon(),this.displayedInfo={}}buildPanelContent(e,t){let i=(0,n.createElement)("div",{class:"vcxPanelContentBody"});this.setPanelContent(i),this.panelAccordeon.getContent().inject(i),console.log(e);let r=[];Object.keys(e).every((i=>{let n=e[i];return r.push(t.createTweakerGroup({group:n,displayedInfo:this.displayedInfo,callbackActivateDeactivateGroup:(e,t)=>{console.log(e,t)},fullDisableGroup:!1})),!0})),console.log("done");for(let e=0;e<r.length;e++){const t=r[e];let i=a.default.AddExpander(this.panelAccordeon,t.groupAccordeonItem),n=this.panelAccordeon.getExpanderFromIndex(this.panelAccordeon.getIndexFromId(i));n.groupID=t.groupAccordeonItem.groupID,n.getContent().style.order=t.groupAccordeonItem.order}}getPanelDisplayedInfo(){return this.displayedInfo}getUIGroupsInfo(){let e=[];for(let t=0;t<this.panelAccordeon.items.length;t++)e.push(this.panelAccordeon.getExpanderFromIndex(t));return e}getGroupExpander(e){return a.default.GetExpanderFromHeader(this.panelAccordeon,e)}destroyGroup(e){var t=this.panelAccordeon.getIndexFromId(e._expanderId);this.panelAccordeon.deleteItem(t),delete this.displayedInfo[e.groupID]}}return r}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebGUI/VCXTreePanelView",["require","exports","DS/DataGridView/DataGridView","DS/VCXGUIInfrastructure/VCXMainPanelFixed","DS/ApplicationFrame/CommandsManager","DS/VCXWebKernel/VCXCmdChangeSelection"],(function(e,t,i,n,a,r){"use strict";i=__importDefault(i),n=__importDefault(n),a=__importDefault(a),r=__importDefault(r);class s extends n.default{constructor(e,t){super(e,t),this._treePanelCtrl=e.treePanelCtrl}preparePanel(e){this._treeDocument=e;const t=[{text:"Label",dataIndex:"tree",typeRepresentation:"string",getCellSemantics:e=>{const t=e.nodeModel&&e.nodeModel.getAttributeValue("type");return"VPMReference"===t?{icon:"object-reference"}:"VPMInstance"===t?{icon:"object-instance"}:"3DShape"===t||"VPMRepInstance"===t?{icon:"object-shape-split"}:"dsc_matref_ref_Covering"===t?{icon:"material"}:{icon:"object-reference"}}},{text:"Type",dataIndex:"type",typeRepresentation:"string"},{text:"PID",dataIndex:"pid",typeRepresentation:"string"},{text:"ID",dataIndex:"id",typeRepresentation:"string",getCellSemantics:e=>{const t=e.nodeModel&&e.nodeModel.getAttributeValue("local");return this._treePanelCtrl.getModelInfoFromNodeModel(e.nodeModel).id?{icon:t?"3d-object":"3d-object-database"}:{icon:"3d-object-question"}}},{text:"appliedMaterial",dataIndex:"appliedMaterial",typeRepresentation:"string"},{text:"fileSize",dataIndex:"fileSize",typeRepresentation:"string"}];var n=new i.default({treeDocument:this._treeDocument,columns:t,defaultColumnDef:{dataIndex:"",editableFlag:!0,typeRepresentation:"string"},onContextualEvent:e=>{var t=[];if(e&&e.collectionView){t=e.collectionView.buildDefaultContextualMenu(e,{expandCollapse:!0});const i=e.cellInfos,n=i?i.columnID:-1;if(i&&n>=0){const e=this._treePanelCtrl.getModelInfoFromNodeModel(i.nodeModel);if(e.actor){const i=e.actor&&e.actor.IsKindOf("VCXVolatileComponentOccurrenceComposer")&&e.actor;i&&0===i.getPreviousComponentID().length&&!i.isRegisteredToPersistent()&&t.push({index:0,type:"PushItem",title:"Create override",icon:{iconName:"3d-object-database"},action:{callback:()=>{i.registerToPersistent()}}});const n=e.actor.QueryInterface("VCXIContextualContent");let s={};n?.appendContent(s,[e.actor],null);for(let i in s){const n=s[i];"button"===n.type&&t.push({type:"PushItem",title:n.name,action:{callback:()=>{if(e.actor){const t=new r.default(e.actor?._experienceBase);t.SetSelection(e.actor),e.actor._experienceBase.getManager("VCXCommandManager").Push(t);const i=e.actor._experienceBase.getManager("VCXContextManager").getContext();let s=n.cmdId,o={};"string"!=typeof s&&(s=n.cmdId.id,o=n.cmdId.args);const l=a.default.getCommand(s,i);l&&l.begin(o)}}}})}}}}return t}});const s=n.getNodesXSO();s.onPostAdd((e=>{const t=this._treePanelCtrl.getModelInfoFromNodeModel(e[0]),i=t?.actor?._experienceBase;if(!i)return;let n=new r.default(i);e.forEach((e=>{const t=this._treePanelCtrl.getModelInfoFromNodeModel(e);t.actor&&n.AddToSelection(t.actor)})),i.getManager("VCXCommandManager").Push(n)})),s.onPostRemove((e=>{const t=this._treePanelCtrl.getModelInfoFromNodeModel(e[0]),i=t?.actor?._experienceBase;if(!i)return;let n=new r.default(i);e.forEach((e=>{const t=this._treePanelCtrl.getModelInfoFromNodeModel(e);t.actor&&n.RemoveFromSelection(t.actor)})),i.getManager("VCXCommandManager").Push(n)})),this.setPanelContent(n.getContent())}}return s}));var VCXThumbnailDisplayModeEnum={List:0,Small:1,Large:2,Tile:3};define("DS/VCXWebGUI/VCXScenarioCtrlExt",["UWA/Class","DS/VCXGUIInfrastructure/VCXGUIComponentCtrl","DS/CoreEvents/Events","DS/Core/PointerEvents","DS/VCXGUIInfrastructure/VCXUISequence","DS/VCXKeyFramer/VCXScenario","DS/VisuEvents/EventsManager","DS/Controls/ThumbnailView","DS/WebappsUtils/WebappsUtils","DS/VCXGUIInfrastructure/VCXTabPageFrame","DS/Layouts/GridEngine","DS/ApplicationFrame/CommandsManager","DS/VCXWebKernel/VCXCmdChangeSelection","DS/VCXWebKernelCommands/VCXCmdGoToScenarioWithInterpolation","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebVisualization/VCXPublishRasterImage","DS/VCXWebIO/VCXFileServices","DS/VCXWebKernelCommands/VCXCmdChangeScenarioSequence","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI","i18n!DS/VCXWebProducts/assets/nls/VCXWebProducts","i18n!DS/VCXWebProducts/assets/nls/VCXWebProductAuthoringCommands"],(function(e,t,i,n,a,r,s,o,l,c,d,u,h,p,m,C,g,_,b,v,f){"use strict";return t.extend({init:function(){},onresizePanel:function(e,t){var i,n,a=0,r=0;for(i in e._thumbnailsList){var s=e._thumbnailsList[i];s.length>r&&(r=s.length)}if(r>0){var o=e.getItemDisplaySize()[0]+10;a=(n=Math.floor(t/o))*o}if(r>=n)for(var l in e._sequenceContent){var c=e._sequenceContent[l];c&&(c.style.width=a+"px")}e.updateToolbar()},getItemDisplaySize:function(){var e=this.getThumbnailDisplaySize(),t=e[0],i=e[1];switch(this._displayMode){case VCXThumbnailDisplayModeEnum.List:return[t,50];case VCXThumbnailDisplayModeEnum.Small:return[t,i];case VCXThumbnailDisplayModeEnum.Large:return[1.5*t,1.5*i];case VCXThumbnailDisplayModeEnum.Tile:return[1.4*t+10,i]}},getThumbnailDisplaySize:function(){return[165,118]},BuildView:function(e){var t="SequenceFolder.Scenarios",n="Sequence.CADViews",r="Sequence.CADCaptures",s="Sequence.Layers";const o=[t=b[t],(n=b[n])+"|"+(r=b[r]),s=b[s]],l=e.playerMode;var d=this;this.playerMode=Boolean(l),this._displayMode=VCXThumbnailDisplayModeEnum.Small,this._vcxGuiManager=this._experienceBase.getManager("VCXGUIManager"),this._sequenceContent={},this._thumbnailsList=[],this.options={_experienceBase:this._experienceBase,_uiLayer:this._vcxGuiManager._uiLayer,classBaseNameCSS:"vcx-scenarios-",sidePanel:{title:"Scenarios",icon:{iconName:"camera",fontIconFamily:WUXManagedFontIcons.Font3DS},side:"left",minWidth:300,styles:{height:"100%"},controller:this,usecallback:this.onresizePanel,currentDockArea:4},onResizeCb:this.onResize,slidingViews:{displayTabAtStart:1,activateViewOn:1,_vcxuiSequencesMaster:{},views:[]},recId:"scenarioCtrlRec"},this._vcxGuiManager.immersiveFrame&&(this.options.immersiveFrame=this._vcxGuiManager.immersiveFrame);for(var u=1,h=0;h<o.length;++h)this.options.slidingViews._vcxuiSequencesMaster[u]={},this.options.slidingViews._vcxuiSequencesMaster[u][o[h]]=new a(this._experienceBase,this),++u,this.options.slidingViews.views.push({title:o[h],content:{html:d.options.slidingViews._vcxuiSequencesMaster[h+1][o[h]],iframe:!1}});this.options.recId="scenarioCtrlRec";b["VCXScenarios.PanelTitle"],this._vcxGuiManager.immersiveFrame,WUXDockAreaEnum.RightDockArea;this._tabPageFrame=new c(this.options),this._tabPageFrame._header.addClassName("vcxNoMenu"),this.onCreateToolBarButtons(this.getFrame().getPanel()),this.updateToolbar(),this._bSelectionMode=!1,this._updateSceneSymbol=new UWA.Element("div",{class:"wux-ui-3ds fonticon-refresh vcx-updateScene-symbol",html:[]}),this.currentViewpoint={angle:-1,eyePos:null,sightDir:null},this._activeSequence=null,this._currentScenarioId=null,this.options.immersiveFrame?(this.getFrame().getPanel().style.minHeight="100%",this.getFrame().getPanel().style.minWidth="300px"):(this.getFrame().getPanel().elements.content.style.minHeight="100%",this.getFrame().getPanel().elements.panel.style.minWidth="300px"),this.activateDisplayStyle("Small");var p=d._experienceBase;p.getManager("VCXSequenceManager");this.onResizeCB=()=>{var e=p.getManager("VCXScenarioManager").GetScenarios()[d._currentScenarioId];this.ChangeTimelinePosition(e,d._currentScenarioId),this.onResize()},window.addEventListener&&(this._tokenResize=window.addEventListener("resize",this.onResizeCB,!0)),this._tokenCreateThumb=i.subscribe({event:"VCX_CREATE_THUMBNAIL"},(function(e){d.onCreateThumbnail(d,e)})),this._tokenScChanged=i.subscribe({event:"VCX_SCENARIO_CHANGED"},(function(e){d.onScenarioChanged(d,e)})),this._tokenScMoved=i.subscribe({event:"VCX_SCENARIO_MOVED"},(function(e){d.onScenarioMoved(d,e)})),this._tokenCurrentScenario=i.subscribe({event:"VCX_CURRENT_SCENARIO_CHANGED"},(function(e){d.onCurrentScenarioChanged(e.GetID(),e)})),this._tokenBeginTrans=i.subscribe({event:"VCX_BEGIN_TRANSITION"},(function(e){document.body.addClassName("waiting"),d.onCurrentScenarioChanged(e.scenario._ID,e.scenario),d.hideNeedForUpdate(),d.stopListeningToViewpointChange(),d.onBeginEndTransition(d,e)})),this._tokenBeginEndTrans=i.subscribe({event:"VCX_END_TRANSITION"},(function(e){var t={};t.maxframe="number"==typeof e&&e||0,d.onBeginEndTransition(d,t),document.body.removeClassName("waiting")})),this._tokenSeqNameChanged=i.subscribe({event:"VCX_SEQUENCE_NAME_CHANGED"},(function(e){d.onSequenceNameRefresh(d,e)})),this._tokenScenarioNameChanged=i.subscribe({event:"VCX_SCENARIO_NAME_CHANGED"},(function(e){d.onScenarioNameRefresh(d,e)})),this._tokenScenarioReplaced=i.subscribe({event:"VCX_SCENARIO_REPLACED"},(function(e){d.onScenarioReplaced(e.GetID(),e)})),this._tokenSeqChanged=i.subscribe({event:"VCX_SEQUENCE_CHANGED"},(function(e){d.onSequenceChanged(d,e)})),this._tokenRefreshIcon=i.subscribe({event:"VCX_REFRESH_ICON"},(function(e){d.RefreshAnimIcon(d,e)}))},unInitialize:function(){if(window.focus(),this._sequenceContent){for(var e in this._sequenceContent){(t=this._sequenceContent[e]).cbonPrimaryPointerUpUnique&&s.removeEventFromToken(t.cbonPrimaryPointerUpUnique),t.removeEvent("dragend"),t.removeEvent("dragover"),t.grid&&t.grid.onCellRequest(null)}this._sequenceContent=[]}if(this._thumbnailsList){for(var e in this._thumbnailsList)for(var t=this._thumbnailsList[e],n=0;n<t.length;n++){var a=t[n];a._pointerDownToken&&(s.removeEventFromToken(a._pointerDownToken),a._pointerDownToken=null),a._pointerUpToken&&(s.removeEventFromToken(a._pointerUpToken),a._pointerUpToken=null),a.cbdragstart&&(a.elements.picture.removeEventListener("dragstart",a.cbdragstart),a.cbdragstart=null),a.cbdragenter&&(a.elements.picture.removeEventListener("dragenter",a.cbdragenter),a.cbdragenter=null),a.cbdragend&&(a.elements.picture.removeEventListener("dragend",a.cbdragend),a.cbdragend=null),a.cbdragover&&(a.elements.picture.removeEventListener("dragover",a.cbdragover),a.cbdragover=null),a.cbCheckBoxChange&&(a.elements.checkbox.removeEventListener("change",a.cbCheckBoxChange),a.cbCheckBoxChange=null),a.cbEditScenario&&(a.elements.container.removeEventListener("keydown",a.cbEditScenario,!0),a.elements.picture.removeEventListener("keydown",a.cbEditScenario,!0),a.cbEditScenario=null),a.cbOnClickScenario&&(a.elements.container.removeEventListener("click",a.cbOnClickScenario),a.elements.title.removeEventListener("click",a.cbOnClickScenario),a.cbOnClickScenario=null)}this._thumbnailsList=[]}i.unsubscribe(this._tokenCreateThumb),delete this._tokenCreateThumb,i.unsubscribe(this._tokenScChanged),delete this._tokenScChanged,i.unsubscribe(this._tokenScMoved),delete this._tokenScMoved,i.unsubscribe(this._tokenCurrentScenario),delete this._tokenCurrentScenario,i.unsubscribe(this._tokenScenarioReplaced),delete this._tokenScenarioReplaced,i.unsubscribe(this._tokenBeginTrans),delete this._tokenBeginTrans,i.unsubscribe(this._tokenBeginEndTrans),delete this._tokenBeginEndTrans,i.unsubscribe(this._tokenSeqNameChanged),delete this._tokenSeqNameChanged,i.unsubscribe(this._tokenScenarioNameChanged),delete this._tokenScenarioNameChanged,i.unsubscribe(this._tokenSeqChanged),delete this._tokenSeqChanged,i.unsubscribe(this._tokenRefreshIcon),delete this._tokenRefreshIcon,this.stopListeningToViewpointChange(),this._viewpointWatcher=null,this._vcxGuiManager&&this._vcxGuiManager._vcxTimeline&&(this.getFrame().getFooter().removeChild(this._vcxGuiManager._vcxTimeline.getView().getContainer()),this._vcxGuiManager._vcxTimeline.unInitialize(),this._vcxGuiManager.RemoveTimelineEvents(),this._vcxGuiManager._vcxTimeline=null),this._scenePanelView&&this._scenePanelView.unInitialize(),this._vcxGuiManager&&this._vcxGuiManager._vcxTimelineMain&&(this._vcxGuiManager._vcxTimelineMain.unInitialize(),this._vcxGuiManager._vcxTimelineMain=null),window.addEventListener&&(window.removeEventListener("resize",this.onResizeCB,!0),delete this._tokenResize),this.onResizeCB=null,this.getFrame().unInitialize()},getFrame:function(){return this._tabPageFrame},updateToolbar:function(){this.getFrame().getToolbar().updateToolbar()},onCreateToolBarButtons:function(e){var t=this,i=this.getFrame().getToolbar(),n=(s=this._vcxGuiManager._experienceBase.getManager("VCXContextManager")).getContextFromName("ProdHighMode"),a=s.getContextFromName("ExperienceIn3DPlay");if(this.playerMode&&(a||n)&&i.addMainItemFixed("VCXPlayGuidedTourCmd","","vcxToolbarButtonIconChecked","VCXWebProducts",v,null,"I_VCX_AB_PlayGuidedTour.png","VCX_PLAY_GUIDED_TOUR_START","VCX_PLAY_GUIDED_TOUR_END",!0),!this.playerMode){var r=this._experienceBase.getManager("VCXExperience");r.updateLogData&&!0===r.updateLogData.showDialog&&i.addMainItemFixed("VCXShowUpdateViewCmd","","vcxToolbarButton wux-ui-3ds-update","VCXWebAuthoringCommands/VCXWebAuthoringCommands",f);var s,o=s&&s.getContext(),l=(u.getCommand("VCXCreateEmptyScenarioCmd",o),[]);if(l[0]=this,l[1]=this.setVisibilityAllChexkBox,l[2]=!0,i.addMainItemFixed(l,"","vcxToolbarButton vcxToolbarButtonSelect","VCXWebGUI/VCXWebGUI",b,null,"VCXSetVisibilityAllChexkBoxCmd"),i.addMainItemFixed("VCXCreateEmptyScenarioCmd","","vcxToolbarButton fonticon-doc-add","VCXWebAuthoringCommands/VCXWebAuthoringCommands",f),i.addMainItemFixed("VCXAddCameraKeyCmd","","vcxToolbarButton fonticon-camera-refresh","VCXWebAuthoringCommands/VCXWebAuthoringCommands",f),i.addMainItemFixed("VCXCreateScenarioCmd","","vcxToolbarButton fonticon-plus","VCXWebAuthoringCommands/VCXWebAuthoringCommands",f),this._scenePanelView){var c=[];c[0]=this,c[1]=function(){this._scenePanelView&&this._scenePanelView.toggleVisibility()},c[2]=!0,i.addMainItemFixed(c,"","vcxToolbarButton vcxToolbarButtonDisplaySimplified","")}(s=this._vcxGuiManager._experienceBase.getManager("VCXContextManager")).isSupported("Timeline")&&!s.getContextFromName("PlayerMode")&&i.addMainItem("VCXDisplayTimelineCmd","","vcxToolbarButton vcxToolbarButtonTimeline","VCXWebAuthoringAppGUICommands","i18n!DS/VCXWebAuthoringAppGUICommands/assets/nls/VCXWebAuthoringAppGUICommands"),i.addMainItemFixed("VCXDeleteSceneSelectionCmd","","vcxToolbarButton vcxToolbarButtonDelete","VCXWebAuthoringCommands/VCXWebAuthoringCommands",f,i.getEditToolbar()),i.addMainItemFixed("VCXReplaceScenarioCmd","","vcxToolbarButton vcxToolbarButtonUpdate","VCXWebAuthoringCommands/VCXWebAuthoringCommands",f,i.getEditToolbar()),i.addMainItemFixed("VCXApplyToSelectedCmd","","vcxToolbarButton wux-ui-3ds-propagate","VCXWebAuthoringCommands/VCXWebAuthoringCommands",f,i.getEditToolbar())}var d=function(e){t.activateDisplayStyle(e)};i.addSubItemFixed(d,"ScenarioViewOptions","vcxToolbarButton vcxToolbarButtonDisplayList","","",b["VCXScenario.Display.List"],"List"),i.addSubItemFixed(d,"ScenarioViewOptions","vcxToolbarButton vcxToolbarButtonDisplaySmall","","",b["VCXScenario.Display.Small"],"Small"),i.addSubItemFixed(d,"ScenarioViewOptions","vcxToolbarButton vcxToolbarButtonDisplayLarge","","",b["VCXScenario.Display.Large"],"Large"),i.addSubItemFixed(d,"ScenarioViewOptions","vcxToolbarButton vcxToolbarButtonDisplayTile","","",b["VCXScenario.Display.Tile"],"Tile"),i.addMenu("","vcxToolbarButtonStarterMenuRight","vcxToolbarButton vcxToolbarButtonLayout","VCXWebGUI",b,"VCXScenarioToolbarDisplayLayout");var h=[];h[0]=this,h[1]=this.setVisibilityAllChexkBox,h[2]=!1,i.addMenu(h,"vcxToolbarButtonStarterMenuRight vcxToolbarButtonStarterMenuRightEdit","vcxToolbarButton vcxToolbarButtonExit","VCXWebGUI/VCXWebGUI",b,"VCXScenarioToolbarExit",i.getEditToolbar()),i.activeSubItemFixed("vcxToolbarButton vcxToolbarButtonDisplaySmall")},activateDisplayStyle:function(e){var t=this;switch(this.getFrame().getToolbar().activeSubItemFixed("vcxToolbarButton vcxToolbarButtonDisplay"+e),this.getFrame().getPanel().removeClassName("vcx-displaySmall"),this.getFrame().getPanel().removeClassName("vcx-displayTile"),this.getFrame().getPanel().removeClassName("vcx-displayList"),this.getFrame().getPanel().removeClassName("vcx-displayLarge"),this.getFrame().getPanel().addClassName("vcx-display"+e),e){case"Tile":t._displayMode=VCXThumbnailDisplayModeEnum.Tile;break;case"List":t._displayMode=VCXThumbnailDisplayModeEnum.List;break;case"Large":t._displayMode=VCXThumbnailDisplayModeEnum.Large;break;case"Small":t._displayMode=VCXThumbnailDisplayModeEnum.Small}t.onResize()},OnEndBuildView:function(){this.loadScenariosFromExperience(),this.onCurrentScenarioChanged(this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario()),this._tabPageFrame&&this._tabPageFrame._panelMaster.windowGroup&&(this._tabPageFrame._panelMaster.windowGroup.multiSelFlag=!1,this._tabPageFrame._panelMaster.windowGroup.currentWindows=[this._tabPageFrame._panelMaster])},RefreshView:function(){var e=this._experienceBase.getManager("VCXContextManager").getPlayerMode(),t=this._experienceBase.getManager("VCXAPIManager").HasAnimation("AnimationSmgID"),i=!1;e?e&&!t&&(i=!0):i=!0,this._vcxScenarioCtrl.onCurrentScenarioChanged(this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario()),i&&1===this._experienceBase.getManager("VCXExperience").GetViewMode()&&this._vcxScenarioCtrl.setSequenceState("Animation",!1)},loadScenariosFromExperience:function(){var e=this,t=e._experienceBase.getManager("VCXSequenceManager").GetListSequences();e.addSequences(e,t)},addSequences:function(e,t){for(var i=0;i<t.length;i++){var n=t[i],a=i-1;e.createSequence(n,a,e),e._scenePanelView&&e._scenePanelView.createSequenceView(n.GetID(),n.GetName(),l.getWebappsAssetUrl("VCXWebGUI","css/img/VCXSequence.png"))}},getUISequenceTarget:function(e){for(var t in this.options.slidingViews._vcxuiSequencesMaster)for(var i in this.options.slidingViews._vcxuiSequencesMaster[t]){if(e===i)return this.options.slidingViews._vcxuiSequencesMaster[t][i];var n=i.split("|");for(var a in n)if(e===n[a])return this.options.slidingViews._vcxuiSequencesMaster[t][i]}return this.options.slidingViews._vcxuiSequencesMaster[1][Object.keys(this.options.slidingViews._vcxuiSequencesMaster[1])[0]]},getUISequenceIndex:function(e,t){var i=0;for(i in e.elements.items){if(e.elements.items[i].childNodes[0].childNodes[1].innerHTML===t)break}return i},createSequence:function(e,t,i){var n=e.GetID(),a=e.GetName();"CAD Captures"!==a&&"CAD Views"!==a||i._tabPageFrame._header.removeClassName("vcxNoMenu");var r=t+1,o=this.getUISequenceTarget(a);0===r&&(r=o.itemLength),o.addItem(r,{text:a});var l=i._sequenceContent[n]=new UWA.Element("div",{class:"VCX container-fluid hidden-print vcx-fluid-content",html:[]});l.sequenceIndex=r,o.setContent(r,l),l.addEvent("dragover",(function(e){if(1!==e.dataTransfer.types.length&&e.dataTransfer.types.includes("text/plain"))e.dataTransfer.dropEffect="none";else if(e.target.hasClassName("VCX container-fluid")){var t="";t=i.amIBefore(i.dragged.elements.container,i.dropTarget)?"afterend":"beforeBegin",i.dropTarget&&i.isThereBrotherAround(e)||(i.dropSequence=i.getSequenceDrop(e),i.dropTarget=i.getLastThumnbailFromSequence(i.dropSequence),t="afterend"),i.dropTarget.elements.container.insertAdjacentElement(t,i.dragged.elements.container),e.preventDefault()}})),l.addEvent("dragend",(e=>{var t=i._vcxGuiManager._experienceBase,n=t.getManager("VCXSequenceManager").GetSequenceFromScenarioId(i.dragged.scenarioID),a="";n&&(a=n.GetID());var r=-1;i.dropTarget&&(i.dropSequence=i.dropTarget.elements.container.parentNode.getAttribute("sequenceid"),r=Array.prototype.indexOf.call(i.dropTarget.elements.container.parentNode.children,i.dragged.elements.container)),i.moveScenarioView(i.dragged.scenarioID,a,i.dropSequence,r);var s=new _(t);s.MoveScenario(i.dragged.scenarioID,i.dropSequence,r),t.getManager("VCXCommandManager").Push(s)}));var c=o.elements.items[r];c.sequenceId=n;var u=c.getElementsByClassName("VCXUISequence-title")[0];c.counterThumbs=new UWA.Element("div",{html:"0",class:"VCXcounterThumbs",styles:{}}),c.counterThumbs.inject(u),1===o.itemLength?(o.elements.container.childNodes[0].childNodes[0].style.opacity="0",o.elements.container.childNodes[0].childNodes[0].style.marginBottom="-15px"):(o.elements.container.childNodes[0].childNodes[0].style.opacity="",o.elements.container.childNodes[0].childNodes[0].style.marginBottom=""),i.activeSequence(c),l.cbonPrimaryPointerUpUnique=s.addEvent(l.parentNode,"onPrimaryPointerUpUnique",(function(){i.activeSequence(c)})),l.sequenceID=n,l.setAttribute("SequenceID",n);for(var h=i._vcxGuiManager._experienceBase.getManager("VCXScenarioManager").GetScenarios(),p=e.GetListScenariosId(),m=(i._thumbnailsList[n]=[],0);m<p.length;m++){var C=p[m];i.createScenarioView(h[C],i,e.GetID(),m)}this.setSequenceState(a,!0),l.grid=new d({model:i._thumbnailsList[n],defaultCellWidth:300,defaultCellHeight:200,showRowsHeader:!0,showColumnsHeader:!0,headersDimensions:{width:20,height:20}}),l.grid.onCellRequest((function(e,t){var i=e.virtualColumnID;if(t._thumbnailsList[i]){var n=t._thumbnailsList[i];e.cellView.getContent().setHTML(n)}}))},createScenarioView:function(e,t,i,a){var o=t._vcxGuiManager._experienceBase;o.getManager("VCXSequenceManager");if(i);else{var c=o.getManager("VCXSequenceManager").GetListSequences();i=c[0].GetID()}var d=0;-1!==a&&(d=a);var u=this._thumbnailsList[i][d],h=!1;if(!u||u.scenarioID&&u.scenarioID!==e.GetID()){h||(u=t.createThumbnailView(e,t,i,a)),(t=this).playerMode?u.elements.thumbnail.draggable=!1:u.elements.thumbnail.draggable=!0,u.cbdragstart=function(e){if(!this.draggable)return e.preventDefault(),void e.stopPropagation();t.dropTarget=u,e.dataTransfer.setData("scene",e.target.id),e.dataTransfer.effectAllowed="move",t.dragged=u,t.dragged.elements.container.classList.add("vcxDrag")},u.elements.thumbnail.addEventListener("dragstart",u.cbdragstart,!1),u.cbdragenter=function(e){if(1!==e.dataTransfer.types.length&&e.dataTransfer.types.includes("text/plain"))e.dataTransfer.dropEffect="none";else if(t.dropTarget=u,e.preventDefault(),void 0===t.dragged&&(t.dragged=u),t.dragged.elements.picture!==e.toElement){var i="";i=t.amIBefore(t.dragged.elements.container,u.elements.container)?"afterend":"beforeBegin",u.elements.container.insertAdjacentElement(i,t.dragged.elements.container),t.dropTarget=u}},u.elements.thumbnail.addEventListener("dragenter",u.cbdragenter,!1),u.cbdragover=function(e){if(1!==e.dataTransfer.types.length&&e.dataTransfer.types.includes("text/plain"))e.dataTransfer.dropEffect="none";else{if(!this.draggable)return e.preventDefault(),void e.stopPropagation();e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault()}},u.elements.thumbnail.addEventListener("dragover",u.cbdragover,!1),u.cbdragend=function(e){t.dragged.elements.container.classList.remove("vcxDrag")},u.elements.thumbnail.addEventListener("dragend",u.cbdragend,!1),u.cbdrop=function(e){(e=e||event).preventDefault()},u.elements.thumbnail.addEventListener("drop",u.cbdrop,!1);var p=e.GetName();u.setTitle(p),u.scenarioID=e.GetID(),u.scenarioIndex=d,u.elements.thumbnail._scenarioID=e.GetID(),e.HasAnimation()&&(u.elements.title.style.left="30px !important",u.elements.subtitle.style.left=u.elements.title.style.left,u.elements.icon.addClassName("hasAnimation"));var m=this._experienceBase.getManager("VCXSequenceManager").GetSequenceFromId(i),C=null,g=e.GetDocId(),_=o.getManager("VCXDocManager").GetPropPath(g);if(_)C=_.GetValueURL().GetValue();if("Animation smg"===p)u.setPicture(l.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_Thumbnail_Animation.png")),this._scenePanelView&&this._scenePanelView.updateScenario(e.GetID(),m.GetID(),p,l.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_Thumbnail_Animation.png"),e.GetID()===t._currentScenarioId);else if(C){var b=new XMLHttpRequest;b.open("GET",C,!0),b.responseType="blob",b.onload=function(i){if(200==this.status){var n=this.response,a=new FileReader;a.onload=function(i){u.setPicture(i.target.result),t._scenePanelView&&t._scenePanelView.updateScenario(e.GetID(),m.GetID(),p,i.target.result,e.GetID()===t._currentScenarioId)},a.readAsDataURL(n)}},b.send()}else e.GetScenarioType()===r.EScenarioType.CADView?u.setPicture(l.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_Thumbnail_CADViews.png")):e.GetScenarioType()===r.EScenarioType.CADCapture?u.setPicture(l.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_Thumbnail_CADCaptures.png")):e.GetScenarioType()===r.EScenarioType.Layer?u.setPicture(l.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_Thumbnail_Layer.png")):this.onScenarioReplaced(e.GetID(),e);var v=m.GetName(),f=this.getUISequenceTarget(v);if(this._vcxGuiManager._experienceBase.getManager("VCXContextManager").getContextFromName("ShowRoomMode"));else{t.targetInteraction=null,u._pointerDownToken=s.addEvent(u.elements.container,"onPrimaryPointerDownUnique",(function(e){f.elements.items[t._sequenceContent[i].sequenceIndex];u.elements.checkbox.elements.container.focus()})),u.cbEditScenario=function(i){"F2"===i.key&&(e.GetID()===t._currentScenarioId||u.elements.container.hasClassName("vcxItemSelected"))&&setTimeout((function(){console.log("F2"),u.elements.title.focus()}),0)},u.cbOnClickScenario=a=>{var r=e=>{var i=a.path&&a.path[0]||a.currentTarget;i&&i.hasClassName("vcx-controls-thumbnail-title")||(t.endRenameScenario(),document.removeEventListener(n.POINTERDOWN,r),document.removeEventListener("keydown",s))},s=e=>{"Enter"===e.key?(t.endRenameScenario(),document.removeEventListener(n.POINTERDOWN,r),document.removeEventListener("keydown",s),u.elements.title.contentEditable=!0):"Escape"===e.key&&(t.endRenameScenario(!0),document.removeEventListener(n.POINTERDOWN,r),document.removeEventListener("keydown",s),u.elements.title.contentEditable=!0)};if(!(o=a.path&&a.path[0]||a.currentTarget).hasClassName("vcx-controls-thumbnail-title")||t.playerMode||t.getFrame().getToolbar().isEditMode()){""!==t.startEditScenarioID&&(t.endRenameScenario(),document.removeEventListener(n.POINTERDOWN,r),document.removeEventListener("keydown",s));var o=a.target;if(t.targetInteraction=o,!t.targetInteraction||t.targetInteraction!=o)return void(t.targetInteraction=null);if(a&&a.gesture&&a.gesture.currentEvent[0]&&a.gesture.currentEvent[0].currentPosition.distanceTo(a.gesture.currentEvent[0].startPosition)>8)return void(t.targetInteraction=null);if(o.hasClassName("wux-ui-fa")||o.hasClassName("vcx-controls-checkbox"))return t.targetInteraction=null,!1;t.targetInteraction=null,t.activeSequence(f.elements.items[t._sequenceContent[i].sequenceIndex]);var l=e.GetID();if(t.getFrame().getToolbar().isEditMode())u.elements.checkbox.toggle();else if(t._experienceBase.getManager("VCXExperience").GoToScenarioContext()&&(t.setVisibilityAllChexkBox(!1),t.onCurrentScenarioChanged(l,e),t._vcxGuiManager._experienceBase.getManager("VCXAPIManager").GoToScenario(l),t._vcxGuiManager._vcxTimelineExtCtrl&&t._vcxGuiManager._vcxTimelineExtCtrl._mainPanel)){var c=t._vcxGuiManager._vcxTimelineExtCtrl._mainPanel.style.display;t._vcxGuiManager._uiLayer.removeChild(t._vcxGuiManager._vcxTimelineExtCtrl._mainPanel),t._vcxGuiManager.InitTimelineExtCtrl(l),t._vcxGuiManager._vcxTimelineExtCtrl._mainPanel.style.display=c}}else a.stopPropagation(),document.addEventListener(n.POINTERDOWN,r),document.addEventListener("keydown",s),t.startEditScenarioID=e.GetID()},this._vcxGuiManager.isTouchActivated()?(u.elements.container.addEventListener("touchstart",u.cbOnClickScenario),u.elements.title.addEventListener("touchstart",u.cbOnClickScenario)):(u.elements.container.addEventListener("click",u.cbOnClickScenario),u.elements.title.addEventListener("click",u.cbOnClickScenario)),u.elements.container.addEventListener("keydown",u.cbEditScenario,!0),u.elements.picture.addEventListener("keydown",u.cbEditScenario,!0);var S=f.elements.items[t._sequenceContent[i].sequenceIndex];S.counterThumbs.innerHTML=parseInt(S.counterThumbs.innerHTML)+1}}else h=!0},endRenameScenario:function(e){if(e)for(var t in this._thumbnailsList)for(var i=this._thumbnailsList[t],n=0;n<i.length;n++){if((r=i[n]).scenarioID===this.startEditScenarioID){var a=(o=(s=this._experienceBase.getManager("VCXScenarioManager").GetScenarios()[r.scenarioID].QueryInterface("VCXIModifiable")).GetProperty("Actor.Name")).GetPropertyValue().GetValue();return r.elements.title.innerHTML=a,void(this.startEditScenarioID="")}}else for(var t in this._thumbnailsList)for(i=this._thumbnailsList[t],n=0;n<i.length;n++){var r;if((r=i[n]).scenarioID===this.startEditScenarioID){var s,o,l=r.elements.title.innerHTML,c=new m(this._experienceBase);return(o=(s=this._experienceBase.getManager("VCXScenarioManager").GetScenarios()[r.scenarioID].QueryInterface("VCXIModifiable")).GetProperty("Actor.Name")).GetPropertyValue().SetValue(l),c.ChangeProperty(s,o),this._experienceBase.getManager("VCXCommandManager").Push(c),void(this.startEditScenarioID="")}}},isThereBrotherAround:function(e){var t=20,i=[{x:t,y:t},{x:t,y:-20},{x:-20,y:-20},{x:-20,y:t}],n=e.clientX,a=e.clientY,r=null;for(var s in i){var o=i[s];if(n+=o.x,a+=o.y,(r=document.elementsFromPoint(n,a)[0])&&(r.hasClassName("vcx-controls-thumbnail-picture")||r.hasClassName("vcx-controls-thumbnail-title")))return this.getThumbnailFromDiv(r)}return null},getSequenceDrop:function(e){for(var t in this._sequenceContent)if(this._sequenceContent[t]===e.target)return t},getLastThumnbailFromSequence:function(e){var t=this._experienceBase.getManager("VCXSequenceManager").GetSequenceFromId(e).GetListScenariosId().slice(-1)[0];for(var i in this._thumbnailsList)for(var n=this._thumbnailsList[i],a=0;a<n.length;a++){var r=n[a];if(r.scenarioID===t)return r}return null},getThumbnailFromDiv:function(e){for(var t in this._thumbnailsList)for(var i=this._thumbnailsList[t],n=0;n<i.length;n++){var a=i[n];if(a.elements.picture===e||a.elements.title===e)return a}return null},amIBefore:function(e,t){for(var i=t.previousElementSibling;i;){if(i===e)return!0;i=i.previousElementSibling}return!1},RefreshAnimIcon:function(e,t){var i=e._vcxGuiManager._experienceBase.getManager("VCXSequenceManager").GetSequenceFromScenarioId(t.GetID()),n=i.GetIndexOfScenario(t.GetID()),a=e._thumbnailsList[i.GetID()][n];t.HasAnimation()&&(a.elements.title.style.left="30px !important",a.elements.subtitle.style.left=a.elements.title.style.left,a.elements.icon.addClassName("hasAnimation"))},RefreshTimeline:function(e,t){if(this.playerMode||this._experienceBase.odt||this._experienceBase.getManager("VCXContextManager").isSupported("Timeline")){var i=document.getElementsByClassName("wux-windows-docking-element-collapser wux-docking-element-left")[0].clientHeight-54-2;if(this._vcxGuiManager.deleteTimeline(),e&&e.HasAnimation()){this.getFrame().getContent().style.maxHeight=i-61+"px",this.getFrame().getFooter().style.height="50px",this.getFrame().getFooter().style.visibility="visible";var n=this._experienceBase.getManager("VCXScenarioManager").GetCurrentFrame();if(this._vcxGuiManager.InitTimelineCtrl(t,n),this._vcxGuiManager._vcxTimelineCtrl._timelines&&this._vcxGuiManager._vcxTimelineCtrl._timelines[1]){var a=this._vcxGuiManager._vcxTimelineCtrl._timelines[1].timeline.getView().getParentPanel().currentDockArea;this._vcxGuiManager._vcxTimelineCtrl.options.frmWindow.getImmersiveFrame().getDockingElement(a).collapseDockingZoneFlag=!1}this._vcxGuiManager._forceDisplayTimeline=!0}else this.getFrame().getContent().style.maxHeight=i+"px",this.getFrame().getFooter().style.height="0px",this.getFrame().getFooter().style.visibility="hidden"}},ChangeTimelinePosition:function(e,t){var i=document.getElementsByClassName("wux-windows-docking-element-collapser wux-docking-element-left")[0].clientHeight-54-2;if(e&&e.HasAnimation()){var n=this._experienceBase.getManager("VCXScenarioManager").GetCurrentFrame();null===this._vcxGuiManager._vcxTimelineCtrl&&this._vcxGuiManager.InitTimelineCtrl(t,n),this.getFrame().getContent().style.maxHeight=i-61+"px",this.getFrame().getFooter().style.height="50px",this.getFrame().getFooter().style.visibility="visible"}else this.getFrame().getContent().style.maxHeight=i+"px",this.getFrame().getFooter().style.height="0px",this.getFrame().getFooter().style.visibility="hidden"},onCreateThumbnail:function(e,t){var i=e._vcxGuiManager._experienceBase,n=t.scenario,a=t.sequenceId,r=parseInt(t.prevIndex),s=e._thumbnailsList[a],o=s[r+1];e.createThumbnailView(n,e,a,r,o),o=s[r+1],n._name&&"Animation smg"===n._name?o.setPicture(l.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_Thumbnail_Animation.png")):e.capturePixels().then((function(e){var t=g.dataURLToBlob(e),a=window.URL.createObjectURL(t);if(o){o.setPicture(e);var r=a,s=i.getManager("VCXDocManager").BuildPathFromString(r),l=i.getManager("VCXDocManager").AddOrModifyDoc(s),c=n.QueryInterface("VCXIModifiable");n.SetDocId(l._value),i.getManager("VCXScenarioManager").AddNeutrals(c,c.GetProperties())}}))},GetActiveSequenceId:function(){return this._activeSequence?this._activeSequence.sequenceId:null},activeSequence:function(e){e!==this._activeSequence&&(this._activeSequence&&this._activeSequence.removeClassName("vcxActiveSequence"),this._activeSequence=e,this._activeSequence.addClassName("vcxActiveSequence"))},setSequenceState:function(e,t){var i=this.getUISequenceTarget(e);if(i){var n=this.getUISequenceIndex(i,e);n&&i.setSequenceItemOpenedState(n,t)}},setDescription:function(e,t){var i=this._experienceBase;let n=i.getManager("VCXSequenceManager").GetSequenceFromScenarioId(e).GetID();i.getManager("VCXSequenceManager").GetSequenceFromId(n).GetName();var a=this._thumbnailsList[n];for(var r in a){if(a[r].scenarioID===e){var s=a[r];s.elements.container.removeClassName("vcx-no-description"),s.elements.subtitle.innerHTML=t;break}}},editDescription:function(e){},createThumbnailView:function(e,t,i,n,a){if(t._activeSequence){var r=t._activeSequence;t.activeSequence(r)}var s=a;if(s);else{(s=new o({size:"small"}).inject(t._sequenceContent[i])).elements.transition=new UWA.Element("div",{html:"",class:"vcxTransition"}).inject(s.elements.container),s.elements.transitionBack=new UWA.Element("div",{html:"",class:"vcxTransitionBack"}).inject(s.elements.container),s.elements.container.id=e.GetID(),s.elements.container.setAttribute("data-rec-id",e.GetID()),s.elements.container.addClassName("vcx-controls-thumbnail"),s.elements.container.getCheckpointData=this.getThumbnailDataForRecord,t._vcxGuiManager._experienceBase.getManager("VCXContextManager").isSupported("PaperControlV2")&&s.elements.container.addClassName("vcx-ratio-compliant"),s.elements.picture.setAttribute("data-rec-id",e.GetID()+"-picture"),s.elements.picture.addClassName("vcx-controls-thumbnail-picture"),s.elements.cartouche.setAttribute("data-rec-id",e.GetID()+"-cartouche"),s.elements.cartouche.addClassName("vcx-controls-thumbnail-cartouche"),s.elements.cartouche.getChildren()[0].setAttribute("data-rec-id",e.GetID()+"-cartouche-content"),s.elements.title.setAttribute("data-rec-id",e.GetID()+"-title"),s.elements.title.addClassName("vcx-controls-thumbnail-title"),s.elements.subtitle.setAttribute("data-rec-id",e.GetID()+"-subtitle"),s.elements.subtitle.addClassName("vcx-controls-thumbnail-subtitle"),s.elements.subtitle.innerHTML="",s.elements.container.addClassName("vcx-no-description"),s.elements.icon.addClassName("vcx-controls-thumbnail-icon"),s.elements.picture.childNodes[0].addClassName("vcx-controls-checkbox");var l=0;-1!==n&&(l=n,t.insertIndex(s.elements.thumbnail,l)),t._thumbnailsList[i].splice(l,0,s),s.elements.menu.innerHTML="",s.elements.menu.addClassName("vcx-controls-thumbnail-menu");var c=t._vcxGuiManager._experienceBase.getManager("VCXSequenceManager").GetSequenceFromId(i).GetName(),d=this.getUISequenceTarget(c);t.playerMode&&(s.elements.checkbox.elements.container.style.display="none"),s.cbCheckBoxChange=function(n){if(!t.playerMode){t.activeSequence(d.elements.items[t._sequenceContent[i].sequenceIndex]);var a=n.dsModel.checkFlag;a?(t.setVisibilityAllChexkBox(!0),s.elements.container.addClassName("vcxItemSelected")):(s.elements.container.removeClassName("vcxItemSelected"),t.getFrame().getToolbar().activateEditMode());var r=new h(t._vcxGuiManager._experienceBase);a?r.AddToSelection(e):r.RemoveFromSelection(e),t._vcxGuiManager._experienceBase.getManager("VCXCommandManager").Do(r)}},s.elements.checkbox.addEventListener("change",s.cbCheckBoxChange)}return t.options.immersiveFrame?t.onresizePanel(t,Math.max(parseInt(t.getFrame().getPanel().style.minWidth),parseInt(t.getFrame().getPanel().offsetWidth))):t.onresizePanel(t,Math.max(parseInt(t.getFrame().getPanel().elements.panel.style.minWidth),parseInt(t.getFrame().getPanel().elements.panel.offsetWidth))),s},getThumbnailDataForRecord:function(e){var t={};t.value=this.getAttributeNames(),e(t,!0)},onResize:function(e){var t=e||this;t.getFrame()._panelMaster.elements.container.parentNode&&t.onresizePanel(t,Math.max(parseInt(0),parseInt(t.getFrame()._panelMaster.elements.container.parentNode.offsetWidth)))},index:function(e){for(var t=e.parentNode.childNodes,i=0;i<t.length;i++){if(t[i]===e)return i}return 0},insertIndex:function(e,t){var i=e.parentNode.childNodes[t];return this.index(e)>t?e.parentNode.insertBefore(e,i):e.parentNode.insertBefore(e,i.nextSibling),e},checkAllCheckBox:function(){for(var e in this._thumbnailsList)for(var t=this._thumbnailsList[e],i=0;i<t.length;i++){if(t[i].elements.checkbox.checkFlag)return!0}return!1},setVisibilityAllChexkBox:function(e){var t=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario();this.setThumbnailCheckBox(e,t)},getNbItems:function(){var e=0;for(var t in this._thumbnailsList){e+=this._thumbnailsList[t].length}return e},getNbSelectedItems:function(){var e=0;for(var t in this._thumbnailsList)for(var i=this._thumbnailsList[t],n=0;n<i.length;n++){i[n].elements.checkbox.checkFlag&&e++}return e},setThumbnailCheckBox:function(e,t){var i,n,a,r=this._activeSequence;for(var s in e?(i="VCXCheckBoxOn",n="VCXCheckBoxOff",a=!1):(i="VCXCheckBoxOff",n="VCXCheckBoxOn",a=!0),this._thumbnailsList)for(var o=this._thumbnailsList[s],l=0;l<o.length;l++){var c=o[l];c.elements.container.hasClassName(i)||(c.elements.container.removeClassName(n),c.elements.container.addClassName(i),c.elements.title.contentEditable=!!a,c===t||e||(c.elements.checkbox.checkFlag=!1,c.elements.container.removeClassName("vcxItemSelected")))}e?this.getFrame().getToolbar().activateEditMode():(this.getFrame().getToolbar().exitEditMode(),this.activeSequence(r))},onScenarioMoved:function(e,t){e.moveScenarioView(t.scenarioToAdd.GetID(),t.sequenceIdForRemove,t.sequenceIdForAdd,t.scenarioAddIdx)},onScenarioChanged:function(e,t){var i=e._vcxGuiManager._experienceBase;if(t.scenarioToAdd){var n=i.getManager("VCXSequenceManager").GetSequenceFromId(t.sequenceIdForAdd),a=n.GetIndexOfScenario(t.scenarioToAdd.GetID());e.createScenarioView(t.scenarioToAdd,e,t.sequenceIdForAdd,a);var r=i.getManager("VCXSequenceManager").GetIndexOfSequence(n),s=n.GetName(),o=e.getUISequenceTarget(s);if(!o.isSequenceOpened(r)){var l=e.getUISequenceIndex(o,s);o.sequenceOpenedItem(l)}if(t.bLinked&&e._selectedScenarioIds)for(var c=i.getManager("VCXScenarioManager").GetScenarios(),d=0;d<e._selectedScenarioIds.length;d++){var u=c[e._selectedScenarioIds[d]];if(u){var p=new h(i);p.RemoveFromSelection(u),i.getManager("VCXCommandManager").Do(p)}}}else if(t.scenarioToRemove){e.removeScenarioView(t.scenarioToRemove.GetID(),t.sequenceIdForRemove);var m=i.getManager("VCXSequenceManager").GetSequenceFromId(t.sequenceIdForRemove);if(!i.getManager("VCXCommandManager")._isUnDoRunning&&!t.bLinked){var C=new h(i),g=m.FindScenario(t.scenarioRemovedIdx);g&&C.SetSelection(g),i.getManager("VCXCommandManager").Do(C)}}},removeScenarioView:function(e,t){var i=this._experienceBase.getManager("VCXSequenceManager");t||(t=i.GetSequenceFromScenarioId(e).GetID());var n=i.GetSequenceFromId(t).GetName(),a=this.getUISequenceTarget(n),r=this._thumbnailsList[t];for(var s in r){if(r[s].scenarioID===e){var o=r[s];this._sequenceContent[t].removeChild(o.elements.thumbnail),this._thumbnailsList[t].splice(s,1);var l=a.elements.items[this._sequenceContent[t].sequenceIndex];l.counterThumbs.innerHTML=parseInt(l.counterThumbs.innerHTML)-1;break}}},moveScenarioView:function(e,t,i,n){var a=this._experienceBase.getManager("VCXSequenceManager");if(t);else{var r=a.GetSequenceFromScenarioId(e);if(null===r)return void console.log("error - Scenario "+e+" unknown in Sequence Manager");t=r.GetID()}var s=a.GetSequenceFromId(t).GetName(),o=this.getUISequenceTarget(s),l=a.GetSequenceFromId(i).GetName(),c=this.getUISequenceTarget(l),d=this._thumbnailsList[t];for(var u in d){if(d[u].scenarioID===e){var h=d[u];if(n<0&&(n=this._thumbnailsList[i].length),this._thumbnailsList[i].splice(n,0,this._thumbnailsList[t].splice(u,1)[0]),t!==i){0===this._sequenceContent[i].childNodes.length?this._sequenceContent[i].insertAdjacentElement("afterBegin",h.elements.container):n>=this._sequenceContent[i].childNodes.length?this._sequenceContent[i].insertAdjacentElement("beforeend",h.elements.container):this._sequenceContent[i].childNodes[n].insertAdjacentElement("beforeBegin",h.elements.container)}else{var p;if(this._sequenceContent[i].childNodes[n]._scenarioID!==e)p=this.amIBefore(h.elements.container,this._sequenceContent[i].childNodes[n])?"afterend":"beforeBegin",this._sequenceContent[i].childNodes[n].insertAdjacentElement(p,h.elements.container)}var m=o.elements.items[this._sequenceContent[t].sequenceIndex];m.counterThumbs.innerHTML=parseInt(m.counterThumbs.innerHTML)-1;var C=c.elements.items[this._sequenceContent[i].sequenceIndex];C.counterThumbs.innerHTML=parseInt(C.counterThumbs.innerHTML)+1;break}}},onCurrentScenarioChanged:function(e,t){if("VCX_Scenario_Transition"!==e){this.hideNeedForUpdate();var i=0,n=0;for(var a in this._thumbnailsList)for(var r=this._thumbnailsList[a],s=0;s<r.length;s++){var o=r[s];o.elements.transition.removeClassName("vcxActiveScenario"),o.elements.transitionBack.removeClassName("vcxActiveScenarioBack"),o.elements.transition.style.webkitTransition="",o.elements.transition.style.transition="",o.elements.transition.style.mozTransition="",o.elements.title.contentEditable=!0,o.scenarioID===e&&(i=o,n=a)}if(i){i.elements.transition.addClassName("vcxActiveScenario"),i.elements.transitionBack.addClassName("vcxActiveScenarioBack"),this.playerMode||this.getFrame().getToolbar().isEditMode()||(i.elements.title.contentEditable=!0),this.scrollToThumbnail(i);var l=this._experienceBase,c=l.getManager("VCXSequenceManager").GetSequenceFromId(n),d=(l.getManager("VCXSequenceManager").GetIndexOfSequence(c),c.GetName()),u=this.getUISequenceTarget(d),h=parseInt(this.getUISequenceIndex(u,d));this.activeSequence(u.elements.items[h])}t&&e!==this._currentScenarioId&&"VCX_Scenario_Transition"!==e&&(this._currentScenarioId=e,this.RefreshTimeline(t,e)),this._currentScenarioId=e}},scrollToThumbnail:function(e){var t=this.getFrame().getContent().getElementsByClassName("wux-layouts-slidingviews-page-content");if(4!==t.length)console.error("Scene panel structure has changed. Automatic scroll will not take place.");else{var i=t[1],n=this.getFrame().getContent().scrollHeight,a=e.elements.container.scrollHeight,r=e.elements.container.offsetTop,s=i.scrollTop;if(r+a>s+n)i.scrollBy({top:r+a-(s+n),behavior:"smooth"});else{if(!(r<s))return;i.scrollBy({top:r-s-10,behavior:"smooth"})}}},onBeginEndTransition:function(e,t){if(e._currentScenarioId)for(var i in e._thumbnailsList){var n=e._thumbnailsList[i];for(var a in n){var r=n[a];if(r.scenarioID===e._currentScenarioId){r.elements.transition.removeClassName("vcxActiveScenario");r.elements.transition.offsetTop;r.elements.transition.removeClassName("vcxNOTransition");var s="height "+t.maxframe+"s linear";if(r.elements.transition.style.webkitTransition=s,r.elements.transition.style.transition=s,r.elements.transition.style.mozTransition=s,r.elements.transition.addClassName("vcxActiveScenario"),0===t.maxframe){r.elements.transition.addClassName("vcxNOTransition");r.elements.transition.offsetTop;r.elements.transition.removeClassName("vcxNOTransition")}}}}},onScenarioNameRefresh:function(e,t){var i=e._vcxGuiManager._experienceBase.getManager("VCXSequenceManager").GetSequenceFromScenarioId(t.GetID());if(i)for(var n=t.GetName(),a=this._thumbnailsList[i.GetID()],r=0;r<a.length;r++){var s=a[r];if(s.scenarioID===t.GetID()){s.setTitle(n);break}}},onScenarioReplaced:function(e,t){this.onScenarioNameRefresh(this,t);var i=this,n=this._experienceBase,a=t.GetDocId(),r=n.getManager("VCXDocManager").GetPropPath(a);if(r){var s=r.GetValueURL().GetValue();if(s){var o=new XMLHttpRequest;o.open("GET",s,!0),o.responseType="blob",o.onload=function(a){if(200==this.status){var r=this.response,s=new FileReader;s.onload=function(a){var r=n.getManager("VCXSequenceManager").GetSequenceFromScenarioId(e).GetID(),s=n.getManager("VCXSequenceManager").GetSequenceFromId(r).GetIndexOfScenario(e);i._thumbnailsList[r][s].setPicture(a.target.result),i._scenePanelView&&i._scenePanelView.updateScenario(e,r,t.GetName(),a.target.result,t.GetID()===i._currentScenarioId)},s.readAsDataURL(r)}},o.send()}}},onSequenceNameRefresh:function(e,t){e._vcxGuiManager._experienceBase.getManager("VCXSequenceManager").GetIndexOfSequence(t)},onSequenceChanged:function(e,t){e._vcxGuiManager._experienceBase.getManager("VCXSequenceManager").GetListSequences();if(t&&t.sequenceToRemove){var i=t.sequenceToRemove,n=i.GetName(),a=e._sequenceContent[i.GetID()].sequenceIndex-1,r=e.getUISequenceTarget(n);r.deleteItem(a),e._sequenceContent[i.GetID()]=null,delete e._thumbnailsList[i.GetID()],e.activeSequence(r.elements.items[0])}t&&t.sequenceToAdd&&(e.createSequence(t.sequenceToAdd,t.previousSeqIndex,e),e._scenePanelView&&e._scenePanelView.createSequenceView(t.sequenceToAdd.GetID(),t.sequenceToAdd.GetName(),l.getWebappsAssetUrl("VCXWebGUI","css/img/VCXSequence.png")))},capturePixels:function(){var e=this._experienceBase,t=new C,i=this.getThumbnailDisplaySize(),n=2*i[0],a=2*i[1];return t.doThumbnailToDataUrl(e,n,a)},OpenScenario:async function(e,t){if(""!==e){var i=this._experienceBase.getManager("VCXScenarioManager"),n=new p(this._experienceBase),a=i.GetScenarios()[e];return this.onCurrentScenarioChanged(e,a),n.BuildTransitionTo(a),n.SetCallback(t),this._experienceBase.getManager("VCXCommandManager").Push(n)}},displayNeedForUpdate:function(){if(!this.getLockSceneUpdateDisplay()&&!this.playerMode){let e=document.querySelector(".vcxActiveScenario")&&document.querySelector(".vcxActiveScenario").getParent(),t=document.querySelector('[data-rec-id*="VCXAddCameraKeyCmd"]');if(!e||!t)return;e.prepend(this._updateSceneSymbol),t.addClassName("vcx-update-available"),t.addEventListener(n.POINTERDOWN,this.hideNeedForUpdate.bind(this)),this.stopListeningToViewpointChange(),this._vcxGuiManager.SetSceneNeedsUpdate(!0)}},hideNeedForUpdate:function(){if(this.playerMode||this.getLockSceneUpdateDisplay())return;this._updateSceneSymbol.remove();let e=document.querySelector('[data-rec-id*="VCXAddCameraKeyCmd"]');e&&(e.removeClassName("vcx-update-available"),e.removeEventListener(n.POINTERDOWN,this.hideNeedForUpdate.bind(this)),this._vcxGuiManager.SetSceneNeedsUpdate(!1),this.listenToViewpointChange())},listenToViewpointChange:function(){let e=this._experienceBase.getManager("VCXContextManager").getMainViewer().currentViewpoint;this.currentViewpoint.angle=e.getAngle(),this.currentViewpoint.eyePos=e.getEyePosition(),this.currentViewpoint.sightDir=e.getSightDirection(),this._tokenSceneUpdate?console.warn("tried to subscribe to existing event"):this._tokenSceneUpdate=i.subscribe({event:"/VISU/"},(e=>{e&&e.viewpoint&&"@onViewpointChange"===e.eventType&&(this.currentViewpoint.angle!==e.viewpoint.getAngle()||e.viewpoint.getEyePosition().distanceTo(this.currentViewpoint.eyePos)>1e-10||e.viewpoint.getSightDirection().distanceTo(this.currentViewpoint.sightDir)>1e-10)&&this.displayNeedForUpdate()}))},stopListeningToViewpointChange:function(){this._tokenSceneUpdate&&(i.unsubscribe(this._tokenSceneUpdate),delete this._tokenSceneUpdate)},unlockSceneUpdateDisplay:function(){this._lockedSceneUpdateDisplay=!1},lockSceneUpdateDisplay:function(){this._lockedSceneUpdateDisplay=!0},getLockSceneUpdateDisplay:function(){return this._lockedSceneUpdateDisplay}})})),define("DS/VCXWebGUI/VCXUpdateView",["UWA/Class","DS/CoreEvents/Events","DS/Controls/Tab","DS/Windows/Dialog","DS/Controls/Accordeon","DS/WebappsUtils/WebappsUtils","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI"],(function(e,t,i,n,a,r,s){"use strict";return e.singleton({initialize:function(e,i){this._experienceBase=i,this.immersiveFrame=e;var n=this;this.event_VCX_END_LOADING_DONE=t.subscribe({event:"VCX_END_LOADING_DONE"},(function(e){n.ShowNotification(),n.addDiv()}))},getNameForComponentID:function(e){var t="unknown",i=this._experienceBase.ComponentsMap.GetComponentFromID(e);if(i){var n=i.QueryInterface("VCXIModifiable");if(n){var a=n.GetProperty("Actor.Name");a&&(t=a.GetPropertyValue().GetValue())}}return t},unInit:function(){this._experienceBase=null,this.event_VCX_END_LOADING_DONE&&(t.unsubscribe(this.event_VCX_END_LOADING_DONE),delete this.event_VCX_END_LOADING_DONE),this.removeDiv()},removeDiv:function(){this.DSFontIconPanel&&this.DSFontIconPanel.close(),this.DSFontIconPanel=null},addDiv:function(){if(this.immersiveFrame&&!this.DSFontIconPanel){var e=null,t=this._experienceBase.getManager("VCXExperience");if(t&&(e=t.updateLogData),e&&e.showDialog){var o=new i({displayStyle:"strip"}),l=new UWA.Element("div",{class:"XCTWebUpdateDialogTab"}),c=s["UpdateSummary.MissingAssets"],d=new UWA.Element("div",{class:"VCXMissingAssets"});(w=new UWA.Element("span",{text:c})).inject(d),d.inject(l),(g=new UWA.Element("div",{})).inject(l),g.style.paddingLeft="13px";var u=r.getWebappsAssetUrl("VCXWebTreeGUI","icons/32/I_VCX_SWXUiComponentPart3DShape.png");if(e.deletedOverides)for(var h=0;h<e.deletedOverides.length;h++){var p=e.deletedOverides[h],m=new UWA.Element("div",{class:"linePart"});(M=new UWA.Element("div",{})).style.backgroundImage="url('"+u+"')",M.style.width="22px",M.style.height="22px",M.style.backgroundSize="contain",M.inject(m),(w=new UWA.Element("span",{text:p.instanceName})).style.paddingLeft="10px",w.inject(m),m.inject(g)}o.add({isSelected:!0,label:s["UpdateSummary.Products"],content:l,icon:{iconName:"3dproduct",fontIconFamily:WUXManagedFontIcons.Font3DS}});var C=[];if(e.deletedMaterials)for(h=0;h<e.deletedMaterials.length;h++){p=e.deletedMaterials[h];var g=new UWA.Element("div",{}),_=p.id;if(P=e.impactedComponentsInverted[_]){var b=[];for(var v in P)if(P.hasOwnProperty(v)){var f=new UWA.Element("div",{});f.style.paddingLeft="25px";var S=P[v];for(var V in S)if(S.hasOwnProperty(V)){m=new UWA.Element("div",{class:"linePart"});(M=new UWA.Element("div",{})).style.backgroundImage="url('"+u+"')",M.style.width="22px",M.style.height="22px",M.style.backgroundSize="contain",M.inject(m),(w=new UWA.Element("span",{text:this.getNameForComponentID(V)})).style.paddingLeft="10px",w.inject(m),m.inject(f)}b.push({header:this.getNameForComponentID(v),content:f,icon:{iconName:"camera",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"5x"},expandedFlag:!0})}new a({items:b,style:"simple",exclusive:!1}).inject(g)}C.push({header:p.instanceName,content:g,icon:{iconName:"material",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"5x"},expandedFlag:!0})}var x=new a({items:C,style:"filled-separate",exclusive:!1}),I=new UWA.Element("div",{class:"XCTWebUpdateDialogTab"});d=new UWA.Element("div",{class:"VCXMissingAssets"}),(w=new UWA.Element("span",{text:c})).inject(d),d.inject(I),x.getContent().inject(I),o.add({isSelected:!1,label:s["UpdateSummary.Materials"],content:I,icon:{iconName:"material",fontIconFamily:WUXManagedFontIcons.Font3DS}});var y=[];if(e.deletedAmbiences)for(h=0;h<e.deletedAmbiences.length;h++){p=e.deletedAmbiences[h];(g=new UWA.Element("div",{})).style.paddingLeft="10px";var P;_=p.id;if(P=e.impactedComponentsInverted[_])for(var v in P)if(P.hasOwnProperty(v)){var M,w;m=new UWA.Element("div",{});(M=new UWA.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-camera"})).inject(m),(w=new UWA.Element("span",{text:this.getNameForComponentID(v)})).style.paddingLeft="10px",w.inject(m),m.inject(g)}y.push({header:p.instanceName,content:g,icon:{iconName:"picture",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"5x"},expandedFlag:!0})}var D=new a({items:y,style:"filled-separate",exclusive:!1}),X=new UWA.Element("div",{class:"XCTWebUpdateDialogTab"});d=new UWA.Element("div",{class:"VCXMissingAssets"}),(w=new UWA.Element("span",{text:c})).inject(d),d.inject(X),D.getContent().inject(X),o.add({label:s["UpdateSummary.Ambiences"],content:X,icon:{iconName:"picture",fontIconFamily:WUXManagedFontIcons.Font3DS}}),this.DSFontIconPanel=new n({immersiveFrame:this.immersiveFrame,identifier:"updateSolveIssuesDialog",title:s["UpdateSummary.DialogHeader"],content:o,icon:"update",horizontallyStretchableFlag:!0,verticallyStretchableFlag:!0,minWidth:10,minHeight:10,width:400,height:450}),this.DSFontIconPanel.getContent().addClassName("XCTWebUpdateDialogClass");var A=this,T=function(e){A.DSFontIconPanel.removeEventListener("close",T),A.DSFontIconPanel=null};this.DSFontIconPanel.addEventListener("close",T)}}},ShowNotification:function(){if(this._experienceBase){var e=null,t=this._experienceBase.getManager("VCXExperience");if(t&&(e=t.updateLogData),e){var i="";if(e.newOverides){i="======= NEW OCCURRENCES =======\n\n";for(var n=0;n<e.newOverides.length;n++){i+="=> "+(a=e.newOverides[n]).instanceName+"("+a.referenceName+")\n"}}if(e.deletedOverides){i+="\n======= REMOVED OCCURRENCES =======\n\n";for(n=0;n<e.deletedOverides.length;n++){i+="=> "+(a=e.deletedOverides[n]).instanceName+"("+a.referenceName+")\n"}}if(e.deletedAmbiences){i+="\n======= REMOVED AMBIENCES =======\n\n";for(n=0;n<e.deletedAmbiences.length;n++){i+="=> "+(a=e.deletedAmbiences[n]).instanceName+"("+a.referenceName+")\n"}}if(e.deletedMaterials){i+="\n======= REMOVED MATERIALS =======\n\n";for(n=0;n<e.deletedMaterials.length;n++){var a;i+="=> "+(a=e.deletedMaterials[n]).instanceName+"("+a.referenceName+")\n"}}var r=0;if(e.impactedComponents)for(var o in i+="\n======= IMPACTED COMPONENT =======\n\n",e.impactedComponents)if(e.impactedComponents.hasOwnProperty(o)){r++;var l="",c=this._experienceBase.ComponentsMap.GetComponentFromID(o);if(c){var d=c.QueryInterface("VCXIModifiable");if(d){var u=d.GetProperty("Actor.Name");u&&(l=u.GetPropertyValue().GetValue())}}i+="=> "+o+" ("+l+")\n"}if(e.showDialog){var h=this._experienceBase.getManager("VCXNotificationManager");if(h){var p="";e.newOverides.length>0&&(p+=e.newOverides.length+" "+s["UpdateNotification.ItemsAdded"]+"<br>"),e.deletedOverides.length>0&&(p+=e.deletedOverides.length+" "+s["UpdateNotification.ItemsRemoved"]+"<br>"),e.deletedAmbiences.length>0&&(p+=e.deletedAmbiences.length+" "+s["UpdateNotification.AmbiencesRemoved"]+"<br>"),e.deletedMaterials.length>0&&(p+=e.deletedMaterials.length+" "+s["UpdateNotification.MaterialsRemoved"]+"<br>"),r>0&&(p+=r+" "+s["UpdateNotification.ItemsToUpdates"]+"<br>");var m={level:"info",title:s["UpdateNotification.NotifTitle"],message:p,sticky:!0};h.addNotification(m)}}console.log(i)}}}})})),define("DS/VCXWebGUI/VCXWebTreesContentCtrl",["require","exports","DS/VCXGUIInfrastructure/VCXGUIComponentCtrl"],(function(e,t,i){"use strict";return class extends i{constructor(){super(),this._treesCtrl={},this._treesTabFrameCtrl={},this._orderTabs=[],this._focusedTab=null}BuildView(e){console.log(e),console.log("TO BE IMPLEMENTED !")}reOrderTreesPanel(){if(0!==this._orderTabs.length){for(var e=null,t=null,i=0;i<this._orderTabs.length;++i)this._orderTabs[i]&&(e=this._orderTabs[i],t&&this._orderTabs[i].getFrame().tabWith(t.getFrame()),t=e);if(this._focusedTab||(this._focusedTab=t),this._focusedTab&&this._focusedTab.getFrame()._panelMaster.windowGroup)for(var n=0;n<this._focusedTab.getFrame()._panelMaster.windowGroup._tab._tabContent.length;n++)if(this._focusedTab.getFrame()._panelMaster.windowGroup._tab._tabContent[n].content===this._focusedTab.getFrame()._panelMaster.elements.container){this._focusedTab.getFrame()._panelMaster.windowGroup._tab.value=[n];break}}}setUpTrees(){console.log("TO BE IMPLEMENTED !")}_setUpTree(e,t,i){if(e&&!e.tree){e.setTabFrameCtrl(t),e.setSlidingViewIndex(i);var n=e.createTree();n||console.warn("Creation of "+e._type+" tree UI failed!"),n&&n.inject(t.getFrame()._slidingViews.getView(i))}}_setUpTreeV2(e,t,i){if(e&&!e.tree){e.setTabFrameCtrl(t),e.setSlidingViewIndex(i);var n=e.createTree();return n||console.warn("Creation of "+e._type+" tree UI failed!"),n}}}})),define("DS/VCXWebGUI/ambiences/VCXAmbienceMainView",["require","exports","DS/VCXGUIInfrastructure/VCXMainPanelFixed","DS/Utilities/WebUXColorEnums"],(function(e,t,i,n){"use strict";class a extends i{constructor(e,t,i,n){super(e,t,void 0,n),this.count=0,this.subView=i,this.buildPanelTabs([{index:1,name:"Current",icon:"presentation-slide",view:this.subView.ambienceCurrentView.getView()},{index:2,name:"Presentation",icon:a.iconPresentation,view:this.subView.ambiencePresentationView.getView()},{index:3,name:"Library",icon:"category-picture-360",view:this.subView.ambienceLibraryView.getView()}],2)}notifyPresentation(){this.count++,this.updateButtonTab(2,{iconName:a.iconPresentation,badges:{topRight:{number:{value:this.count,backgroundColor:n.COLORS_3DEXPERIENCE.COLOR_MEDIUM_ORANGE}}}})}unNotifyPresentation(){this.updateButtonTab(2,{iconName:a.iconPresentation}),this.count=0}setCurrentTab(e){2===e&&this.unNotifyPresentation(),super.setCurrentTab(e)}}return a.iconPresentation="presentation-slides",a})),define("DS/VCXWebGUI/VCXGUIServices",["UWA/Class","DS/Windows/Dialog","DS/Controls/Button","DS/VCXWebKernel/VCXDRMManager","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI"],(function(e,t,i,n,a){"use strict";return e.singleton({displaySignature:function(e,r,s){r.strSignaturePicturePath,r.ulSignatureCRC;var o=!1,l=e.getManager("VCXContextManager").getFrameWindow(),c=(l.getUIFrame(),l.getImmersiveFrame());e.getManager("VCXContextManager").loadCssFile("VCXWebGUI/VCXWebSignature.css",1);var d=r.strAgreement.replace(/#@/g,"</p><p>");d="<p>"+d+"</p>";var u=null;if(r.resources){var h=r.strSignaturePicturePath.replace(/^.*[\\\/]/,"").toLowerCase();u=r.resources[h]}var p='<img src="'+u+'" style="max-width:100%"/>',m=new UWA.Element("div",{class:"Signature"});new UWA.Element("div",{class:"Signature_Cell",html:p}).inject(m),new UWA.Element("div",{class:"Signature_Cell",html:d}).inject(m);var C={},g=document.getElementsByClassName("vcx-Curtain-Home");g[0]&&(g[0].style.zIndex=1,o=!0),r.ulAgreementMode===n.LitSignatureMode.LIT_SIGNATURE_DISPLAY_AND_PASS?C.Ok=new i({label:a["Signature.Ok"],onClick:function(e){o&&(g[0]&&g[0].style.removeProperty("z-index"),o=!1);var t=e.dsModel.dialog;t._closeOK=!0,t.remove(),t.close()}}):(C.Ok=new i({label:a["Signature.Agree"],onClick:function(e){o&&(g[0]&&g[0].style.removeProperty("z-index"),o=!1);var t=e.dsModel.dialog;t._closeOK=!0,t.remove(),t.close()}}),C.Cancel=new i({label:a["Signature.Disagree"],onClick:function(e){o&&(g[0]&&g[0].style.removeProperty("z-index"),o=!1);var t=e.dsModel.dialog;t._closeOK=!1,t.remove(),t.close()}}));var _=new t({title:a.Signature,content:m,modalFlag:!0,resizableFlag:!0,usePaddingFlag:!1,width:400,closeButtonFlag:!1,immersiveFrame:c,buttons:C}),b=r,v=s;_.addEventListener("close",(async function(e){_._closeOK?(b.LoadGeometriesBody(v),b._pause=!1,await b.launchsmgXMLCB(b,b.smgLoader)):await b.launchsmgXMLCB(null,b.smgLoader)}))},hideDockingElements:async function(e,t){for(var i={freeWindowsInfo:{},visiblePanels:[],panelsToReopen:[]},n=e.getImmersiveFrame(),a=n.windows,r={},s=Object.keys(a),o=0;o<s.length;++o){var l=s[o],c=a[l];if(!c.getDockedFlag())if(r[l]=c,i.freeWindowsInfo[l]={pos:{x:c.position.offsetX,y:c.position.offsetY},dims:[c.width,c.height]},c.allowedDockAreas!==WUXDockAreaEnum.NoneDockArea)for(var d=[WUXDockAreaEnum.BottomDockArea,WUXDockAreaEnum.TopDockArea,WUXDockAreaEnum.LeftDockArea,WUXDockAreaEnum.RightDockArea],u=0;u<d.length;++u){var h=d[u];if(c.allowedDockAreas&h){await n.dockWindow(c,h),i.freeWindowsInfo[l].dockedArea=h;break}}else console.log("Some windows aren't allowed to be docked, preventing a correct immersive mode for the Guided Tour.")}var p=e.getImmersiveFrame().dockingElements;for(o=0;o<p.length;++o)t&&(p[o].collapseDockingZoneFlag||(i.panelsToReopen.push(p[o]),p[o].collapseDockingZoneFlag=!0)),p[o].visibleDockingZoneFlag&&(i.visiblePanels.push(p[o]),p[o].visibleDockingZoneFlag=!1);return i},restoreDockingElements:function(e,t){var i=e&&e.getImmersiveFrame();if(i&&t){if(t.freeWindowsInfo&&Object.keys(t.freeWindowsInfo).length>0){i.windows;for(var n in t.freeWindowsInfo)if(t.freeWindowsInfo.hasOwnProperty(n)){var a=i.windows[n];i.undockWindow(a),a.setAbsolutePosition(t.freeWindowsInfo.pos)}}for(var r=t.visiblePanels,s=t.panelsToReopen,o=0;o<s.length;++o){s[o].collapseDockingZoneFlag=!1}for(var l=0;l<r.length;++l){r[l].visibleDockingZoneFlag=!0}}else console.warn("Immersive frame and config of the panels before they were hiding are needed !")},hideActionBar:function(e,t){var i={actionBarShouldBeOpen:null};if(t){var n=e.getActionBar();if(!n||!n.elements)return;(null===n.elements.container.getAttribute("data-open")||"true"===n.elements.container.getAttribute("data-open"))&&(i.actionBarShouldBeOpen=!0,n.close()),n.hide()}return i},restoreActionBar:function(e,t){var i=e.getActionBar();i.show(),t.actionBarShouldBeOpen&&i.open()}})})),define("DS/VCXWebGUI/VCXModifiableGUIManager",["DS/VCXWebModifiables/VCXModifiable","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyValueBoolean"],(function(e,t,i,n,a){"use strict";return e.extend({init:function(){this._parent()},OnChangeProperty:function(e,t){return console.log("property not found!"),!1},GetProperty:function(e){return null},GetProperties:function(){return new t}})})),define("DS/VCXWebGUI/VCXSceneCard",["require","exports","DS/Controls/Button","DS/Menu/ContextualMenu","DS/Controls/Loader","DS/Controls/ModalContainer","DS/VCXGUIInfrastructure/VCXUICard","i18n!DS/VCXWebProducts/assets/nls/VCXWebProductAuthoringCommands","UWA/Core","DS/Utilities/Dom"],(function(e,t,i,n,a,r,s,o,l,c){"use strict";return class extends s{constructor(e){super(e),this.updateButton=new i({emphasize:"primary",icon:{iconName:"refresh",fontIconFamily:WUXManagedFontIcons.Font3DS}}),this.updateButton.elements.container.title=o.VCXAddCameraKeyCmd;let t=this.cardElement.querySelector(".vcxUICard-descriptionActionBar");this.updateButton.inject(t),this.updateButton.getContent().style.display="none",this.updateButton.getContent().addClassName("vcxSceneUpdate"),this.updateButton.getContent().setAttribute("data-rec-id","vcxscenecard-update-button");let n=this.cardElement.querySelector(".vcxUICard-thumbnail-container");this.concealFilter=(0,l.createElement)("div",{class:"vcxSceneCard-conceal"}),this.concealFilter.inject(n),(0,l.createElement)("div",{class:"vcxSceneCard-conceal-filter"}).inject(this.concealFilter);let a=c.generateIcon({iconName:"eye-off",fontIconSize:"3x"});return a.style.position="absolute",a.style.color="white",a.inject(this.concealFilter),this.concealFilter.style.display="none",this}updateInfo(e){if(e.imageUrl&&this.setImage(e.imageUrl),void 0!==e.blur){let t=this.cardElement.getElementsByClassName("vcxUICard-thumbnail")[0];t&&t.classList&&(e.blur?t.classList.add("vcxOutdatedThumbnail"):t.classList.remove("vcxOutdatedThumbnail"))}if(e.scenarioIndex)throw new Error("Updating index not implemented: needs to use insertBefore");e.name&&(this.label.textContent=e.name)}getName(){return this.label}concealCard(e){this.concealFilter.style.display=e?"":"none"}addRenameCardCallback(e){let t=this;this.label.addEventListener("focus",(()=>{window.getSelection()?.selectAllChildren(this.getName())})),this.label.addEventListener("blur",(function(i){let n=i?.target?.textContent??"";(i?.target).scrollLeft=0,t.isCardActive()||t.label.setAttribute("contenteditable","false"),window.getSelection()?.removeAllRanges(),e(t.getID(),n)}))}addUpdateButtonCallback(e){e&&this.updateButton.addEventListener("buttonclick",e)}customizeMenu(e){n.addEventListener(this.contextMenuButton.getContent(),{callback:()=>{let t=new Array;for(let i=0;i<e.length;i++){const n=e[i];let a="enabled",r=n.label,s=n.icon;this.isCardActive()&&n.activeSceneDisabled||(n.concealDependent&&(this.concealFilter.checkVisibility()?(r=n.concealOn.label,s=n.concealOn.icon):(r=n.concealOff.label,s=n.concealOff.icon,!n.sceneCountDependentFunction||n.sceneCountDependentFunction()>1||(a="disabled"))),t.push({type:"PushItem",title:r,state:a,fonticon:{content:"wux-ui-3ds-"+s+" wux-ui-3ds"},action:{callback:n.action}}))}return t}}),this.contextMenuButton.getContent().style.display=""}showUpdateButton(){this.updateButton.getContent().style.display=""}hideUpdateButton(){this.updateButton.getContent().style.display="none"}activateCard(){super.activateCard(),this.label.setAttribute("contenteditable","true")}deactivateCard(){super.deactivateCard(),this.label.setAttribute("contenteditable","false")}activateLoading(){var e=new a;e.on(),r.createModal(this.getView(),e.elements.container)}deactivateLoading(){r.removeModal(this.getView())}}})),define("DS/VCXWebGUI/VCXRatioCard",["require","exports","DS/VCXGUIInfrastructure/VCXUICard","UWA/Core"],(function(e,t,i,n){"use strict";return class extends i{constructor(e){if(e.data&&e.cardLayout){let t=e.data;const i=t["ratio-width"],a=t["ratio-height"];let r="width";e.cardLayout.cardWidth/(e.cardLayout.cardWidth*e.cardLayout.ratioY/e.cardLayout.ratioX)>i/a&&(r="height");let s=(0,n.createElement)("div",{text:"",class:"vcx-temp-ratio-img"});s.style.width="100%",s.style.height="100%";let o=(0,n.createElement)("div",{text:"",class:"vcx-temp-ratio-box"}).inject(s);switch(r){case"height":o.style.height="80%";break;case"width":o.style.width="80%"}o.style.aspectRatio=i+" / "+a,(0,n.createElement)("div",{text:"vcx-temp-ratio-text",class:"ratioText"}).inject(o).textContent=(t.ratioDisplayWidth||i)+":"+(t.ratioDisplayHeight||a),e.image=s}return super(e),this}}})),define("DS/VCXWebGUI/VCXThumbnailChooserView",["require","exports","DS/Controls/Button","UWA/Core"],(function(e,t,i,n){"use strict";return class{constructor(e,t){this.index=0,this.selectIndex=-1,this.parentHoverImage=null,this.hoverImageContainer=null,this.containerDiv=(0,n.createElement)("div",{class:"VCXThumbnailChooserContainer"}).inject(e),this.options=t,this.rightButton=null,this.leftButton=null,this.pictures=[],this.buildLayout()}setupView(){let e=this.options.getNumberThumbnail();for(let e=0;e<this.options.numberShown;e++)this.setupThumbnail(e,e+this.index);this.leftButton&&(this.leftButton.disabled=0===this.index),this.rightButton&&(this.rightButton.disabled=this.index+this.options.numberShown>=e),this.select(this.selectIndex)}setupThumbnail(e,t){let i=this.options.fetchImage(t),a=this.pictures[e];if(i){let e=(0,n.createElement)("img",{class:"VCXThumbnailChooserViewThumbnail"});e.src=i,a.replaceChildren(e)}else a.replaceChildren()}select(e){this.selectIndex=e;for(let t=0;t<this.options.numberShown;t++)this.setVisibilityFlag(this.pictures[t],this.index+t===e,"VCXThumbnailChooserViewThumbnailActive")}getSelection(){return this.selectIndex}setVisibilityFlag(e,t,i){t&&!e?.hasClassName(i)&&e?.addClassName(i),!t&&e?.hasClassName(i)&&e?.removeClassName(i)}createHoverImage(e,t){if(this.parentHoverImage===e)return;if(this.parentHoverImage=e,this.hoverImageContainer&&this.hoverImageContainer.destroy(),!this.parentHoverImage)return;this.hoverImageContainer=(0,n.createElement)("div",{class:"VCXImmersiveNavTopThumbnailContainer"});let i=(0,n.createElement)("img",{class:"VCXImmersiveNavTopThumbnail VCXThumbnailChooserThumbnailChooser VCXImmersiveNavTopThumbnailHidden"}).inject(this.hoverImageContainer);this.options.onHoverCb&&(i.src=this.options.onHoverCb(t)),this.hoverImageContainer?.inject(this.parentHoverImage),setTimeout((()=>i.removeClassName("VCXImmersiveNavTopThumbnailHidden")),10)}buildPictures(){for(let e=0;e<this.options.numberShown;e++){let t=(0,n.createElement)("div",{class:""}).inject(this.containerDiv);this.pictures.push(t),t.addEventListener("click",(()=>{this.select(this.index+e)})),t.addEventListener("mouseover",(()=>{this.createHoverImage(t,this.index+e)})),t.addEventListener("mouseleave",(()=>{this.createHoverImage(null,this.index+e)}))}}buildLayout(){this.leftButton=new i({displayStyle:"lite",iconSize:"15px",icon:{iconName:"chevron-left",fontIconFamily:WUXManagedFontIcons.Font3DS}}).inject(this.containerDiv),this.leftButton?.addEventListener("buttonclick",(()=>{this.index>0&&(this.index-=1,this.setupView())})),this.buildPictures(),this.rightButton=new i({displayStyle:"lite",iconSize:"15px",icon:{iconName:"chevron-right",fontIconFamily:WUXManagedFontIcons.Font3DS}}).inject(this.containerDiv),this.rightButton?.addEventListener("buttonclick",(()=>{let e=this.options.getNumberThumbnail();this.index+this.options.numberShown<e&&(this.index+=1,this.setupView())}))}}})),define("DS/VCXWebGUI/VCXAutoRefreshSubPanelView",["UWA/Class","DS/Controls/Toggle","DS/Windows/Panel"],(function(e,t,i){"use strict";return e.extend({init:function(e,t){this._experienceBase=e,this.displayedValues={};let n=new UWA.createElement("div",{class:"contentBar contentBarFlexDirectionColumn"});const a=e.getManager("VCXGUIManager").immersiveFrame;this._buildCommandsNotButtonUi(n);let r=t.getBoundingClientRect();this.contextualUiBottom=r.bottom,this.subPanel=new i({immersiveFrame:a,identifier:"vcxCommandPanel",allowedDockAreas:WUXDockAreaEnum.NoneDockArea,titleBarVisibleFlag:!1,content:n,position:{my:"top-left",at:"bottom-left",of:t,offsetY:1,offsetX:0}}),this.subPanel.addEventListener("click",(function(e){e.stopPropagation()}))},destroy:function(){this.subPanel.destroy()},_buildCommandsNotButtonUi:function(e){let i,n=new UWA.Element("div",{class:"vcxPropertyLine vcxSubPanelLine",styles:{order:1}}).inject(e);i=new t({type:"switch",checkFlag:this._experienceBase.getManager("VCXScenarioManager").AutoThumbnailUpdate}),i.addEventListener("change",(e=>{this._experienceBase.getManager("VCXScenarioManager").AutoThumbnailUpdate=e.dsModel.checkFlag})),i.inject(n),new UWA.Element("div",{html:"Auto Thumbnail Update",class:"vcxPropertyLineNode vcxPropertyLabel vcxSubPanelLabel"}).inject(n),this.displayedValues.hasOwnProperty("AutoThumbnailUpdate")||(this.displayedValues.AutoThumbnailUpdate={}),this.displayedValues.AutoThumbnailUpdate.elements=[i]}})}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebGUI/ambiences/VCXAmbienceCard",["require","exports","DS/Controls/Button","DS/Core/TooltipModel","DS/VCXGUIInfrastructure/VCXUICard","DS/VCXWebExperienceBase/VCXContextManager"],(function(e,t,i,n,a,r){"use strict";r=__importDefault(r);return class extends a{constructor(e){super(e),this.activeClassName="materialCardActive",this.isDefault=e.isInternal,this.selectCallback=()=>console.log("Not defined"),this.unSelectCallback=()=>console.log("Not defined"),this.propButtonCallback=()=>console.log("Not defined");let t=this.cardElement.querySelector(".vcxUICard-descriptionContainer");this.label.addEventListener("keydown",(e=>{"Enter"===e.key&&this.label.blur()})),this.label.tooltipInfos=new n({shortHelp:e.title}),this.contextMenuButton.getContent().style.display="";let a=this.cardElement.querySelector(".vcxUICard-descriptionActionBar");return a.classList.add("materialDescriptionActionBar"),a.classList.add("vcxMaterialCard-descriptionActionBar"),t.classList.add("vcxMaterialCard-descriptionContainer"),r.default.isForceSupported("VCXNewFrame")&&(this.propPanelButton=new i({displayStyle:"lite",icon:{iconName:"parameters",fontIconFamily:WUXManagedFontIcons.Font3DS}}),this.propPanelButton.inject(a)),this.cardElement.querySelector(".vcxUICard-descriptionTitle").classList.add("vcxMaterialCard-descriptionTitle"),this.thumbnail.addClassName("ambienceThumbnail"),this}getIsDefault(){return this.isDefault}setOnSelectCardCallback(e){this.selectCallback=e}setOnUnselectCardCallback(e){this.unSelectCallback=e}addPropButtonCallback(e){this.propButtonCallback=e,e&&this.propPanelButton?.addEventListener("buttonclick",e)}}}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebGUI/VCXSelectionSetPanel",["require","exports","DS/Controls/Button","DS/Windows/Dialog","DS/Utilities/Dom","DS/Windows/ImmersiveFrame","DS/Controls/Toggle","DS/Controls/LineEditor","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI"],(function(e,t,i,n,a,r,s,o,l){"use strict";l=__importDefault(l);return new class{showChoosePanel(e){return new Promise((t=>{let o=[],c=new i({label:l.default["VCXChooseSelectionSetPanel.Add"],disabled:!0,onClick:e=>{t(o),e.dsModel.dialog.close()}}),d=new r({identifier:"WebUIPanelDocumentation_ChooseSelectionSet"});var u=new i({label:l.default["VCXChooseSelectionSetPanel.Cancel"],onClick:e=>{e.dsModel.dialog.close(),t([])}});let h=UWA.Element("div",{class:"VCXChooseSelectionSetPanel-modal"}),p=UWA.Element("p",{html:l.default["VCXChooseSelectionSetPanel.Text"]}),m=UWA.Element("div",{class:"VCXChooseSelectionSetPanel-containerList"});let C=e._experienceBase.ComponentsMap.GetComponentFromType("VCXSelectionSet_Spec");for(let e=0;e<C.length;e++){let t=C[e],i=t.QueryInterface("VCXIModifiable"),n=UWA.Element("div",{class:"VCXChooseSelectionSetPanel-containerselectionset"}),r=UWA.Element("p",{text:i.GetProperty("Actor.Name").GetPropertyValue().GetValue()}),l=a.generateIcon({iconPath:"../VCXWebTreeGUI/assets/icons/32/I_VCX_Tree_SelectionSetxH.png"}),d=new s({type:"checkbox",value:e});d.inject(n),l.inject(n),r.inject(n),n.inject(m),d.addEventListener("buttonclick",(function(e){if(e.dsModel.checkFlag)o.push(t);else{let e=o.indexOf(t);-1!==e&&o.splice(e)}c.disabled=0===o.length}))}p.inject(h),m.inject(h),new n({immersiveFrame:d,modalFlag:!0,closeButtonFlag:!1,touchMode:!0,resizableFlag:!1,movableFlag:!1,title:l.default["VCXChooseSelectionSetPanel.title"],identifier:"WebUIPanelDocumentation_ChooseSelectionSet",content:h,buttons:{Open:c,Close:u}}).addEventListener("close",(()=>t([]))),d.inject(e.getUIFrame())}))}showRenamePanel(e,t){return new Promise((a=>{let r=null,s=new i({label:l.default["VCXRenameSelectionSetPanel.Apply"],disabled:!0,onClick:e=>{a(r),e.dsModel.dialog.close()}}),c=e.getImmersiveFrame();var d=new i({label:l.default["VCXRenameSelectionSetPanel.Cancel"],onClick:e=>{e.dsModel.dialog.close(),a(null)}});let u=UWA.Element("div",{class:"VCXRenameSelectionSetPanel-modal"}),h=UWA.Element("p",{html:l.default["VCXRenameSelectionSetPanel.Text"]}),p=new o({value:t,sizeInCharNumber:40,selectAllOnFocus:!0,displayClearFieldButtonFlag:!0,maxLength:20});p.addEventListener("uncommittedChange",(function(){r=p.valueToCommit,s.disabled=null===r||0===r.length})),h.inject(u),p.inject(u),new n({immersiveFrame:c,modalFlag:!0,closeButtonFlag:!1,touchMode:!0,resizableFlag:!1,movableFlag:!1,identifier:"WebUIPanelDocumentation_RenameSelectionSet",title:l.default["VCXRenameSelectionSetPanel.title"],content:u,buttons:{Open:s,Close:d}}).addEventListener("close",(()=>a(null)))}))}}})),define("DS/VCXWebGUI/VCXPropertiesPanelModel",["UWA/Class"],(function(e){"use strict";return e.extend({init:function(e){this._experienceBase=e,this._defaultCollapsedGroupsPerObjectType={},this._currentPanelInfos=null},unInitialize:function(){this._experienceBase=null,this._defaultCollapsedGroupsPerObjectType=null,this._currentPanelInfos=null},setPanelState:function(e,t,i){this._currentPanelInfos.propSet=e,t&&(this._currentPanelInfos.arraySelection=t),i&&(this._currentPanelInfos.additionalPropertySettings=i)},getSavedPanelState:function(){return this._currentPanelInfos},resetSavedPanelStateIfNeeded:function(e){var t=!0;if(this._currentPanelInfos&&this._currentPanelInfos.arraySelection&&e.length===this._currentPanelInfos.arraySelection.length){for(var i=0;i<e.length;++i){var n=e[i];if(!this._currentPanelInfos.arraySelection.includes(n))break}i===e.length&&(t=!1)}t&&this.resetSavedPanelState()},resetSavedPanelState:function(){this._currentPanelInfos={propSet:null,arraySelection:null}},isCollapsedGroupsSavedForComponent:function(e){return Boolean(this._defaultCollapsedGroupsPerObjectType[e])},getCollapsedGroupsForComponents:function(e){if(!e)return[];var t=e;if(Array.isArray(t)||(t=[e]),1===t.length)return this._defaultCollapsedGroupsPerObjectType[t[0]]||[];for(var i=[],n=[],a=-1,r=null,s=0;s<e.length;++s){var o=e[s];this._defaultCollapsedGroupsPerObjectType[o]?(n.push(this._defaultCollapsedGroupsPerObjectType[o]),("number"!=typeof r||r>this._defaultCollapsedGroupsPerObjectType[o].length)&&(r=this._defaultCollapsedGroupsPerObjectType[o].length,a=n.length-1)):console.warn("Couldn't find a saved list of collapsed groups for display on property panel for component "+o+".")}if(1===n.length)i=n[0];else if(0!==n.length)for(var l=n.splice(a,1)[0].slice(0);0!==l.length;){var c=l.pop();!l.includes(c)&&n.every((function(e){return e.includes(c)}))&&i.push(c)}return i},setCollapsedGroupsForComponent:function(e,t){this._defaultCollapsedGroupsPerObjectType[e]=t},addCollapsedGroupForComponent:function(e,t){this._modifyCollapsedGroupForComponent(e,t,!0)},removeCollapsedGroupForComponent:function(e,t){this._modifyCollapsedGroupForComponent(e,t,!1)},_modifyCollapsedGroupForComponent:function(e,t,i){if(this._defaultCollapsedGroupsPerObjectType[e]){var n=this._defaultCollapsedGroupsPerObjectType[e].indexOf(t);i?-1===n&&this._defaultCollapsedGroupsPerObjectType[e].push(t):-1!==n&&this._defaultCollapsedGroupsPerObjectType[e].splice(n,1)}else{if(!i)return;this._defaultCollapsedGroupsPerObjectType[e]=[t]}},addCollapsedGroupForComponents:function(e,t){this._modifyCollapsedGroupForComponents(e,t,!0)},removeCollapsedGroupForComponents:function(e,t){this._modifyCollapsedGroupForComponents(e,t,!1)},_modifyCollapsedGroupForComponents:function(e,t,i){if(Array.isArray(e))for(var n=0;n<e.length;++n){var a=e[n];i?this.addCollapsedGroupForComponent(a,t):this.removeCollapsedGroupForComponent(a,t)}}})})),define("DS/VCXWebGUI/VCXStatsCtrl",["DS/VCXGUIInfrastructure/VCXGUIComponentCtrl","DS/CoreEvents/Events","DS/Windows/Panel"],(function(e,t,i){"use strict";return e.extend({init:function(){},BuildView:function(e){var n=this;n.dataMaster={},n.dataMaster.fps="",this.options=e,n.statsContent=new UWA.Element("div"),this._panelMaster=new i({immersiveFrame:e.immersiveFrame,currentDockArea:e.currentDockArea||4,title:"Stats",content:n.statsContent}),e.immersiveFrame.addWindow(this._panelMaster);var a=new Stats,r=function(){a.update(),n.dataMaster.fps=a.domElement.childNodes[0].childNodes[0].childNodes[0].data,n.updateUI(),n.fpsReq=requestAnimationFrame(r)};this.fpsReq=requestAnimationFrame(r),this._tokenChanged=t.subscribe({event:"VCX_STATS_UPDATE"},(function(e){n.updateStatsFromData(e)})),this._tokenRemove=t.subscribe({event:"VCX_STATS_REMOVE"},(function(e){n.removeTrackingData(e)})),this._tokenEmpty=t.subscribe({event:"VCX_STATS_EMPTY"},(function(){n.emptyTrackingData()}))},destroy:function(){window.cancelAnimationFrame(this.fpsReq),this.options.immersiveFrame.removeWindow(this._panelMaster),t.unsubscribe(this._tokenChanged),this._tokenChanged=null,t.unsubscribe(this._tokenRemove),this._tokenRemove=null,t.unsubscribe(this._tokenEmpty),this._tokenEmpty=null},removeTrackingData:function(e){delete this.dataMaster[e.id]},emptyTrackingData:function(e){this.dataMaster={}},updateStatsFromData:function(e){this.dataMaster[e.id]=e.value,this.updateUI()},updateUI:function(){var e="";for(var t in this.dataMaster)e+=t+": "+this.dataMaster[t]+", ";this.statsContent.innerHTML=e}})}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebGUI/VCXPaperPanCmd",["require","exports","DS/VCXWebProducts/VCXAFRCmdBase"],(function(e,t,i){"use strict";i=__importDefault(i);class n extends i.default{constructor(e){super(e,{isAsynchronous:!0})}async beginExecute(){this._activatePanForPaper(!0),(this.getFrameWindow()&&this.getFrameWindow().getViewer()).startPan(this),await super.beginExecute()}async endExecute(){this._activatePanForPaper(!1),this.end=async()=>{};let e=this.getFrameWindow()&&this.getFrameWindow().getViewer();e.endPan(this),e=null}_activatePanForPaper(e){this._experienceBase=this.getFrameWindow()._experienceBase;var t=this._experienceBase&&this._experienceBase.getManager("VCXPaperManager");t&&t.ActivatePaperPan(e)}}return n})),define("DS/VCXWebGUI/VCXPaperCtrlV2",["UWA/Class","DS/VCXGUIInfrastructure/VCXGUIComponentCtrl","DS/CoreEvents/Events","DS/ApplicationFrame/CommandsManager","DS/Tweakers/GeneratedToolbar","DS/VCXWebKernelCommands/VCXCmdRequestChangeProperties","DS/WebappsUtils/WebappsUtils","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI","DS/VCXWebExperienceBase/VCXContextManager"],(function(e,t,i,n,a,r,s,o,l){"use strict";var c=t.extend({init:function(){},BuildView:function(e){if(this._vcxGuiManager=this._experienceBase.getManager("VCXGUIManager"),e&&e.hasOwnProperty("vcxExperBase")&&(this._experienceBase=e.vcxExperBase),this._vcxPaperManager=this._experienceBase.getManager("VCXPaperManager"),this._touchCompliant=this._vcxGuiManager.isTouchActivated(),this._contextManager=this._experienceBase.getManager("VCXContextManager"),this._contextManager){this.listRatios={a4l:{title:o["VCXPaperCtrl.Ratio.A4L"],ratioWidth:297,ratioHeight:210,specificWidth:297,icon:s.getWebappsAssetUrl("VCXWebGUI","css/img/VCXPaperRatio16_9.png")},a4p:{title:o["VCXPaperCtrl.Ratio.A4P"],ratioWidth:210,ratioHeight:297,specificWidth:210,icon:s.getWebappsAssetUrl("VCXWebGUI","css/img/VCXPaperRatio9_16.png")},square:{title:o["VCXPaperCtrl.Ratio.Square"],ratioWidth:1,ratioHeight:1,icon:s.getWebappsAssetUrl("VCXWebGUI","css/img/VCXPaperRatio1_1.png")},default:{title:o["VCXPaperCtrl.Ratio.Wide"],ratioWidth:16,ratioHeight:9,icon:s.getWebappsAssetUrl("VCXWebGUI","css/img/VCXPaperRatio16_9.png")},_35mm:{title:o["VCXPaperCtrl.Ratio.mm35"],ratioWidth:4,ratioHeight:3,icon:s.getWebappsAssetUrl("VCXWebGUI","css/img/VCXPaperRatio4_3.png")},goldenRatio:{title:o["VCXPaperCtrl.Ratio.GoldenRatio"],ratioWidth:16,ratioHeight:10,icon:s.getWebappsAssetUrl("VCXWebGUI","css/img/VCXPaperRatio16_9.png")},wsc:{title:o["VCXPaperCtrl.Ratio.WideScreenCinema"],ratioWidth:2.35,ratioHeight:1,icon:s.getWebappsAssetUrl("VCXWebGUI","css/img/VCXPaperRatio235_1.png")},iphonexP:{title:o["VCXPaperCtrl.Ratio.iPhoneXP"],ratioWidth:9,ratioHeight:19.5,icon:s.getWebappsAssetUrl("VCXWebGUI","css/img/VCXPaperRatio9_195.png")},iphonexL:{title:o["VCXPaperCtrl.Ratio.iPhoneXL"],ratioWidth:19.5,ratioHeight:9,icon:s.getWebappsAssetUrl("VCXWebGUI","css/img/VCXPaperRatio195_9.png")}},this._aspectRatio=this.listRatios.a4l,this._isToolbarReady=!1;var t=this.getPaperCtrlBarModel(),i="scroll";this._touchCompliant&&(i="scroll"),this.paperControlToolbar=new a({overflowManagement:i,direction:"horizontal",items:t}),this.paperControlToolbar.elements.container.addClassName("VCXPaperCtrlV2"),l.isForceSupported("VCXNewFrame")?(document.querySelector(".vcxTopContainer").appendChild(this.paperControlToolbar.getContent()),this.paperControlToolbar.getContent().style.border="solid #E1E1E1",this.paperControlToolbar.getContent().style["border-width"]="1px 0"):(this.paperControlToolbar.inject(this._vcxGuiManager.getUsableArea()),this.updateRatioDisplay()),this.registerToolbarEvents()}else console.error("No ContextManager found, paperCtrl initialization aborted..")},unInitialize:function(){var e=this;e.unRegisterToolbarEvents(),e.paperControlToolbar&&e.paperControlToolbar.destroy(),e.paperControlToolbar=null,e._experienceBase=null},registerToolbarEvents:function(){var e=this;e.paperControlToolbar.addEventListener("onReady",e._onToolbarReady.bind(e)),l.isForceSupported("VCXNewFrame")||(this.tokenPaperRatio=i.subscribe({event:"VCX_PAPER_RATIO_CHANGED"},(function(){e.updateRatioDisplay()})))},unRegisterToolbarEvents:function(){this.tokenPaperRatio&&i.unsubscribe(this.tokenPaperRatio),this._zoomChangedToken&&i.unsubscribe(this._zoomChangedToken),this._panChangedToken&&i.unsubscribe(this._panChangedToken)},GetAspectRatio:function(){return this._aspectRatio},SetAspectRatio:function(e){this._aspectRatio=e},updateUsableArea:function(){if(this._experienceBase){const e=this._experienceBase.getManager("VCXGUIManager"),t=e._getOptiUsableArea(e.getUsableArea(!1)),i=e._getOptiUsableArea(e.getUsableArea(!0));this.updatePaperArea(t,i)}},updatePaperArea:function(e,t){if(this._isToolbarReady){e&&(e.top+=this.paperControlToolbar.elements.container.offsetHeight,e.height-=this.paperControlToolbar.elements.container.offsetHeight),t&&(t.top+=this.paperControlToolbar.elements.container.offsetHeight,t.height-=this.paperControlToolbar.elements.container.offsetHeight);var i=this.paperControlToolbar.elements.container.offsetWidth,n=this.paperControlToolbar.elements.nearContainer.offsetWidth+this.paperControlToolbar.elements.centerContainer.offsetWidth+this.paperControlToolbar.elements.farContainer.offsetWidth+10;n>=i&&!this._wideDisplayWidth&&(this._wideDisplayWidth=n),this._touchCompliant?this._toolbarDisplayStyle!==c.responsiveStyle.NoLabels&&this._changeBarStyle(c.responsiveStyle.NoLabels):this._wideDisplayWidth&&(i>=this._wideDisplayWidth?this._toolbarDisplayStyle!==c.responsiveStyle.Wide&&(this._changeBarStyle(c.responsiveStyle.Wide),this._wideDisplayWidth=null):i<475?this._toolbarDisplayStyle!==c.responsiveStyle.Compact&&this._changeBarStyle(c.responsiveStyle.Compact):this._toolbarDisplayStyle!==c.responsiveStyle.NoLabels&&this._changeBarStyle(c.responsiveStyle.NoLabels))}},_changeBarStyle:function(e){switch(e){default:break;case 1:var t=this._getLabelElements();Array.prototype.forEach.call(t,(function(e){"none"===e.style.display&&(e.style.display="")})),this._toolbarDisplayStyle=c.responsiveStyle.Wide;break;case 2:t=this._getLabelElements();Array.prototype.forEach.call(t,(function(e){e.style.display="none"})),this._toolbarDisplayStyle=c.responsiveStyle.NoLabels;break;case 3:t=this._getLabelElements();Array.prototype.forEach.call(t,(function(e){e.style.display="none"})),this._toolbarDisplayStyle=c.responsiveStyle.Compact}},_getLabelElements:function(){if(this.paperControlToolbar&&this.paperControlToolbar.elements.container)return this.paperControlToolbar.elements.container.querySelectorAll(".VCXPaperCtrlV2 .wux-controls-toolbar-mask-container .wux-toolbar-items .wux-generated-toolbar-items-label, .VCXPaperCtrlV2 .wux-controls-toolbar-mask-container .wux-tweakers-string-label, .VCXPaperCtrlV2 .wux-controls-button > span")},_onToolbarReady:function(){var e=this;this._isToolbarReady=!0,this._vcxPaperManager.getPaperVisibility()&&!l.isForceSupported("VCXNewFrame")&&this.paperControlToolbar.elements.farContainer.getElementsByClassName("wux-tweaker-function")[0].addClassName("vcx-state-active"),e._vcxPaperManager.AutoFit&&e.paperControlToolbar.elements.centerContainer.getElementsByClassName("wux-tweaker-function")[0]&&e.paperControlToolbar.elements.centerContainer.getElementsByClassName("wux-tweaker-function")[0].addClassName("vcx-ui-hidden");var t=this.paperControlToolbar.elements.centerContainer.getElementsByClassName("wux-tweaker-function")[0];this._zoomChangedToken=i.subscribe({event:"/VCX/Paper/ZoomChanged"},(function(i){i&&t&&(i.autoFit?t.addClassName("vcx-ui-hidden"):t.removeClassName("vcx-ui-hidden")),i&&!i.updatePaper&&(e._lockupdatePaper=!0),e.paperControlToolbar.getNodeModelByID("zoomPercentage").getAttributeValue("data")!==100*e._vcxPaperManager.Zoom&&e.paperControlToolbar.updateNodeModel("zoomPercentage",{grid:{data:100*e._vcxPaperManager.Zoom}}),e._lockupdatePaper=!1,e._checkPaperSpace()})),this._panChangedToken=i.subscribe({event:"/VCX/Paper/PanChanged"},(function(i){i&&t&&(i.autoFit?t.addClassName("vcx-ui-hidden"):t.removeClassName("vcx-ui-hidden")),e._checkPaperSpace()})),this._contextManager.isSupported("DisplayPaperCtrlBtns")||this.hide(),this._vcxGuiManager.updateUsableArea(),this.updatePaperArea(),this._checkPaperSpace()},_checkPaperSpace:function(){document.getElementById("divPaperSpace")&&document.getElementById("divPaperSpace").getBoundingClientRect().y<this.paperControlToolbar.elements.container.offsetHeight?this.paperControlToolbar.elements.container.style.background="#FFFFFF91 0% 0% no-repeat padding-box":this.paperControlToolbar.elements.container.style.removeProperty("background")},hidePaperCtrl:function(){this.hide()},showPaperCtrl(){this.show()},isHiddenPaperCtrl(){return this.isHidden()},hide:function(){this.paperControlToolbar.elements.container.hide()},show:function(){this.paperControlToolbar.elements.container.show()},isHidden:function(){return this.paperControlToolbar&&"none"===this.paperControlToolbar.elements.container.style.display},updateRatioDisplay:function(){var e,t=this,i=!1,n=t.GetAspectRatio(),a=Math.round(t._vcxPaperManager.GetWidth()/t._vcxPaperManager.GetHeight()*1e4)/1e4;0!==Object.keys(n).length&&(a!==Math.round(n.ratioWidth/n.ratioHeight*1e4)/1e4||n.specificWidth&&n.specificWidth!==t._vcxPaperManager.GetWidth()||(i=!0));if(!i)for(var r in this.listRatios)if(this.listRatios.hasOwnProperty(r)){var s=this.listRatios[r];if(s.calculatedValue===a&&(!s.specificWidth||s.specificWidth===t._vcxPaperManager.GetWidth())){t.SetAspectRatio(s),i=!0;break}}if(i)e=t.GetAspectRatio().title;else{t.SetAspectRatio({}),e=Math.round(t._vcxPaperManager.GetWidth())+" x "+Math.round(t._vcxPaperManager.GetHeight())}t.paperControlToolbar.updateNodeModel("ratioDisplayText",{grid:{data:e}});let o=t.getPaperChooserMenu(t.GetAspectRatio());t.paperControlToolbar.updateNodeModel("PaperRatioChooser",{grid:{data:o}})},getPaperCtrlBarModel:function(){var e=this._contextManager.getContext();let t=n.getCommand("VisuPanViewPaper",e),i=l.isForceSupported("VCXNewFrame");var r={entries:[...i?[]:[{id:"ratioIcon",dataElements:{typeRepresentation:"default",icon:{iconName:"aspect-ratio",fontIconFamily:1}},position:"near",category:"1",readOnly:!0},{id:"ratioDisplayText",dataElements:{typeRepresentation:"string",value:""},position:"near",category:"1",readOnly:!0},{id:"PaperRatioChooser",dataElements:{typeRepresentation:"chevronMenuIcon",value:{menu:[{type:"TitleItem",title:o["VCXPaperCtrlV2.CanvasAspectRatio"]}]},position:"near",category:"1"}}],...i?[{id:"homeButton",dataElements:{typeRepresentation:"functionIcon",value:{module:"DS/VCXWebGUI/VCXPaperCtrlV2",func:"executeCommand",argument:{this:this,cmdId:"VCXCloseExperienceCmd"}},icon:{iconName:"topbar-home",fontIconFamily:1},position:"near",category:"1"}},{id:"saveButton",dataElements:{typeRepresentation:"functionIcon",value:{module:"DS/VCXWebGUI/VCXPaperCtrlV2",func:"executeCommand",argument:{this:this,cmdId:"VCXSaveCmd"}},icon:{iconName:"floppy",fontIconFamily:1},position:"near",category:"2"}},{id:"saveAsButton",dataElements:{typeRepresentation:"chevronMenuIcon",value:{menu:[{type:"PushItem",icon:{iconName:"floppy-add",fontIconFamily:1},title:o["VCXPaperCtrlV2.SaveAs"],action:{callback:()=>{c.executeCommand({this:this,cmdId:"VCXSaveAsCmd"})}}}]},position:"near",category:"2"}},{id:"undoButton",dataElements:{typeRepresentation:"functionIcon",value:{module:"DS/VCXWebGUI/VCXPaperCtrlV2",func:"executeCommand",argument:{this:this,cmdId:"VCXUndoCmd"}},icon:{iconName:"undo",fontIconFamily:1},position:"near",category:"2"}},{id:"redoButton",dataElements:{typeRepresentation:"functionIcon",value:{module:"DS/VCXWebGUI/VCXPaperCtrlV2",func:"executeCommand",argument:{this:this,cmdId:"VCXRedoCmd"}},icon:{iconName:"redo",fontIconFamily:1},position:"near",category:"2"}}]:[],...i?[{id:"experienceName",dataElements:{typeRepresentation:"string",readOnly:!0,value:this._experienceBase.getManager("VCXContextManager").getRootComponentName(),position:"center",category:"1"}}]:[{id:"ReframePaperButton",dataElements:{typeRepresentation:"function",action:{module:"DS/VCXWebGUI/VCXPaperCtrlV2",func:"reframePaper",argument:this},icon:{iconName:"zoom-fit",fontIconFamily:1},label:o["VCXPaperCtrlV2.Reframe"],position:"center",category:"1"}}],...i?[]:[{id:"ShowHidePaperButton",dataElements:{typeRepresentation:"function",action:{module:"DS/VCXWebGUI/VCXPaperCtrlV2",func:"showHidePaper",argument:this},icon:{iconName:"eye-windowed",fontIconFamily:1},label:o["VCXPaperCtrlV2.Canvas"],displayLabel:!i&&void 0,position:"far",category:"1"}},{id:"ZoomMinus",dataElements:{typeRepresentation:"functionIcon",action:{module:"DS/VCXWebGUI/VCXPaperCtrlV2",func:"incrementZoomTweaker",argument:{this:this,increment:-10}},icon:{iconName:"minus",fontIconFamily:1},position:"far",category:"3"}},{id:"ZoomPlus",dataElements:{typeRepresentation:"functionIcon",action:{module:"DS/VCXWebGUI/VCXPaperCtrlV2",func:"incrementZoomTweaker",argument:{this:this,increment:10}},icon:{iconName:"plus",fontIconFamily:1},position:"far",category:"3"}}],...t?i?[{id:"PanPaperButton",dataElements:{position:"far",category:i?"1":"2",typeRepresentation:"customBoolean",label:o["VCXPaperCtrlV2.Move"],displayLabel:!i&&void 0,possibleValues:[{value:"true",icon:{iconName:"arrow-double-combo",fontIconFamily:1,className:"testClassBlue"}},{value:"false",icon:{iconName:"arrow-double-combo",fontIconFamily:1}}],value:!1,onNodeUpdate:()=>{c.panPaper({this:this,panCmd:t})}}}]:[{id:"PanPaperButton",dataElements:{position:"far",category:i?"1":"2",typeRepresentation:"function",label:o["VCXPaperCtrlV2.Move"],displayLabel:!i&&void 0,action:{module:"DS/VCXWebGUI/VCXPaperCtrlV2",func:"panPaper",argument:{this:this,panCmd:t}},icon:{iconName:"arrow-double-combo",fontIconFamily:1}}}]:[],{id:"zoomPercentage",dataElements:{typeRepresentation:"integer",stepValue:5,minValue:10,maxValue:400,value:100,units:"%",label:o["VCXPaperCtrlV2.Zoom"],position:"far",category:i?"1":"3"},onNodeUpdate:this._percentageTweakerUpdate.bind(this)},...i?[{id:"globalIlluminationButton",dataElements:{typeRepresentation:"functionIcon",value:{module:"DS/VCXWebGUI/VCXPaperCtrlV2",func:"executeCheckCommand",argument:{this:this,cmdId:"VCXDisplayLivePreviewRenderingCmd"}},icon:{iconName:"3d-object",fontIconFamily:1},position:"far",category:"2"}},{id:"previewButton",dataElements:{typeRepresentation:"functionIcon",value:{module:"DS/VCXWebGUI/VCXPaperCtrlV2",func:"executeCommand",argument:{this:this,cmdId:"VCXPreviewModeCmd"}},icon:{iconName:"compass-play",fontIconFamily:1},position:"far",category:"2"}},{id:"JobMonitorButton",dataElements:{typeRepresentation:"functionIcon",value:{module:"DS/VCXWebGUI/VCXPaperCtrlV2",func:"executeCommand",argument:{this:this,cmdId:"VCXOpenJobMonitorCmd"}},icon:{iconName:"media-gallery",fontIconFamily:1},position:"far",category:"3"}},{id:"publishButton",dataElements:{typeRepresentation:"function",label:o["VCXPaperCtrlV2.Publish"],value:{module:"DS/VCXWebGUI/VCXPaperCtrlV2",func:"executeCommand",argument:{this:this,cmdId:"VCXDisplayPanelPublishMediaCmd"}},icon:{iconName:"media-collection",fontIconFamily:1},position:"far",category:"3"}}]:[]]};if(!i)for(var s in this.listRatios)if(this.listRatios.hasOwnProperty(s)){var d=this.listRatios[s];d.calculatedValue=Math.round(d.ratioWidth/d.ratioHeight*1e4)/1e4;var u={type:"RadioItem",title:d.title,state:"selected",action:{module:"DS/VCXWebGUI/VCXPaperCtrlV2",func:"changeRatio",argument:{this:this,ratio:d}},icon:d.icon};r.entries[r.entries.findIndex((function(e){return"PaperRatioChooser"===e.id}))].dataElements.value.menu.push(u)}return a.prototype.createTreeDocument(r)},getPaperChooserMenu:function(e){let t={menu:[{type:"TitleItem",title:o["VCXPaperCtrlV2.CanvasAspectRatio"]}]};for(var i in this.listRatios)if(this.listRatios.hasOwnProperty(i)){var n=this.listRatios[i];n.calculatedValue=Math.round(n.ratioWidth/n.ratioHeight*1e4)/1e4;var a={type:"RadioItem",title:n.title,state:e.title===n.title?"selected":"",action:{module:"DS/VCXWebGUI/VCXPaperCtrlV2",func:"changeRatio",argument:{this:this,ratio:n}},icon:n.icon};t.menu.push(a)}return t},_percentageTweakerUpdate:function(e){if(this._experienceBase&&!this._lockupdatePaper){var t=e.getAttributeValue("data");this._vcxPaperManager.Zoom=t/100}}});return c.showHidePaper=function(e){var t=e,i=!t._vcxPaperManager.getPaperVisibility();t._vcxPaperManager.setPaperVisibility(i);var n=t.paperControlToolbar.elements.farContainer.getElementsByClassName("wux-tweaker-function")[0];i?n.addClassName("vcx-state-active"):n.removeClassName("vcx-state-active")},c.executeCommand=function(e){let t=e.this,i=e.cmdId,a=e.bToStop;if(""!==i){var r=null,s=t._vcxGuiManager._experienceBase.getManager("VCXContextManager");s&&(r=s.getContext()),n.getCommand(i,r)&&(a?n.getCommand(i,r).end():n.getCommand(i,r).begin())}},c.executeCheckCommand=function(e){let t=e.this,i=e.cmdId,n=t._experienceBase.getManager("VCXContextManager").getFrameWindow().getExecutionContext(),a=n&&n.getComponent("AFR_HandlerComponent"),r=a.getCheckState({id:i});""!==i&&a&&a.setCheckState({id:i,state:!r})},c.panPaper=function(e){var t=e.this,i=e.panCmd;let n=l.isForceSupported("VCXNewFrame");if(i){var a,r=t.paperControlToolbar.elements.farContainer.getElementsByClassName("wux-tweaker-function")[1];if(i.isRunning())i.end(),!n&&r&&r.removeClassName("vcx-state-active"),t._vcxGuiManager.GetCanvasView()&&(t._vcxGuiManager.GetCanvasView().style.cursor="auto"),(a=document.getElementById("divPaperSpace"))&&a.removeClassName("paper-highlight");else i.begin(),!n&&r&&r.addClassName("vcx-state-active"),(a=document.getElementById("divPaperSpace"))&&a.addClassName("paper-highlight")}},c.reframePaper=function(e){var t=e,i=t._vcxPaperManager.ToggleAutoFit();if(!l.isForceSupported("VCXNewFrame")){var n=t.paperControlToolbar.elements.centerContainer.getElementsByClassName("wux-tweaker-function")[0];i?n.addClassName("vcx-ui-hidden"):n.removeClassName("vcx-ui-hidden")}t._vcxGuiManager.updateUsableArea()},c.changeRatio=async function(e){var t=e.this,i=e.ratio,n=i.ratioWidth,a=i.ratioHeight,s=i.specificWidth;if(n&&a){var o=t._experienceBase.getManager("VCXContextManager").getActiveViewport();if(o){var l=o.QueryInterface("VCXIModifiable");if(l){var c=t._experienceBase.getManager("VCXCommandManager");t.SetAspectRatio(i);var d=new r(t._experienceBase),u=t._vcxPaperManager.GetWidth();if(s){u=s;var h=l.GetProperty("Paper.Width").Clone(),p=h.GetPropertyValue().Clone();p.SetValue(u),h.SetPropertyValue(p),await d.ChangePropertyValue(l,"Paper.Width",p),c.Push(d)}u*=a/n;var m=l.GetProperty("Paper.Height").Clone(),C=m.GetPropertyValue().Clone();C.SetValue(u),m.SetPropertyValue(C),await d.RequestModification([l],"Paper.Height",C),c.Push(d)}}}},c.incrementZoomTweaker=function(e){var t=e.this,i=e.increment;if(null!==t._experienceBase){var n=100*t._vcxPaperManager.Zoom+i;t.paperControlToolbar.updateNodeModel("zoomPercentage",{grid:{data:n}})}},c.responsiveStyle={Wide:1,NoLabels:2,Compact:3},c})),define("DS/VCXWebGUI/VCXPartListEditModeView",["require","exports","DS/Controls/Button","UWA/Core"],(function(e,t,i,n){"use strict";return class{constructor(e,t){this._referenceUI=e,this._container=(0,n.createElement)("div",{id:"Part_List_Button_Container"}),this._buttonLeft=new i({domId:"Part_List_Button_Left",label:"Add Column to left",showLabelFlag:!1,icon:{iconName:"plus",fontIconFamily:WUXManagedFontIcons.Font3DS},onClick:t.callbackAddLeftButton}),this._buttonLeft.inject(this._container),this._buttonCenter=new i({domId:"Part_List_Button_Middle",label:"Options",showLabelFlag:!1,icon:{iconName:"menu-dot",fontIconFamily:WUXManagedFontIcons.Font3DS},onClick:t.callbackOptionsButton}),this._buttonCenter.inject(this._container),this._buttonRight=new i({domId:"Part_List_Button_Right",label:"Add Column to right",showLabelFlag:!1,icon:{iconName:"plus",fontIconFamily:WUXManagedFontIcons.Font3DS},onClick:t.callbackAddRightButton}),this._buttonRight.inject(this._container)}changeColor(e,t,i){let n=i??t,a=document.getElementById("partListTableContainer");if(a){let i=parseFloat(a.style.transform.replace(/[A-Za-z$-()]/g,""));this._container.style.transform=`scale(${1/i})`;for(let r=0;r<this._referenceUI.getChildren().length;r++)r===t?this._referenceUI.getChildren()[n].getBoundingClientRect().width>120?(this._container.style.transformOrigin="left",this._container.style.width=this._referenceUI.getChildren()[n].getBoundingClientRect().width+30+"px",this._container.style.left=(this._referenceUI.getChildren()[t].getBoundingClientRect().left-this._referenceUI.getBoundingClientRect().left)/i-11+"px",this._container.style.top=i<1?-43/i+"px":"-43px",this._referenceUI.getChildren()[t].style.backgroundColor="#00B8DE"):(this._container.style.transformOrigin="center",this._container.style.top="-43px",this._container.style.left=(this._referenceUI.getChildren()[t].getBoundingClientRect().left-this._referenceUI.getBoundingClientRect().left+this._referenceUI.getChildren()[t].getBoundingClientRect().width/2)/i-60+"px",this._container.style.top=i<1?-43/i+"px":"-43px",this._referenceUI.getChildren()[t].style.backgroundColor="#00B8DE"):this._referenceUI.getChildren()[r].style.backgroundColor=e,a.appendChild(this._container)}}destroy(){this._buttonLeft&&this._buttonLeft.destroy(),this._buttonCenter&&this._buttonCenter.destroy(),this._buttonRight&&this._buttonRight.destroy(),this._container&&this._container.destroy()}}}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebGUI/VCXNoShowVisibleGUICtrl",["require","exports","DS/VCXWebComposer/VCXCommandControllerManager","DS/VCXGUIInfrastructure/VCXGUIComponentCtrlTS"],(function(e,t,i,n){"use strict";i=__importDefault(i),n=__importDefault(n);class a extends n.default{constructor(){super(),this._commandsAuthorized=["VCXTransformFreeDragCmd","VCXTransformCmd","VCXMoveRobotOnBBoxCenterCmd","VCXApplyTransformationCmd","VisuPanViewPaper","VCXShowSelectionInNonVisibleSpaceCmd","VCXMenuCmd","VCXShowNonVisibleSpaceCmd","VCXShowVisibleSpaceCmd","VCXUndoCmd","VCXRedoCmd"],this._commandsWithChangeVisibleSpaceState=["VCXAddCameraKeyCmd","VCXCreateScenarioCmd","VCXPreviewModeCmd","VCXSaveCmd","VCXSaveAsCmd","VCXCloseExperienceCmd","VCXOpenJobMonitorCmd"],this._eventsWithChangeVisibleSpaceState=["VCX_BEGIN_TRANSITION"]}postInitialize(){const e=this._experienceBase.getManager("VCXCommandControllerManager");e&&(e.registerDefaultAvailabilityFilter(new i.default.NoShowSpaceFilter(!1),"onExecute"),e.registerAvailabilityCommands(this._commandsAuthorized.concat(this._commandsWithChangeVisibleSpaceState),new i.default.NoShowSpaceFilter(!0)));for(let e=0;e<this._eventsWithChangeVisibleSpaceState.length;e++){const t=this._eventsWithChangeVisibleSpaceState[e];this.subscribe(t,(()=>{const e=this._experienceBase.getManager("VCXVisuManager");e&&e.getNonVisibleSpaceState()&&e.setNonVisibleSpaceState(!1)}))}this.subscribe("/WUX/AFR/CMD/_Context/BEGIN",(e=>{if(e){let t=e.getId();if(this._commandsWithChangeVisibleSpaceState.includes(t)){const e=this._experienceBase.getManager("VCXVisuManager");e&&e.getNonVisibleSpaceState()&&e.setNonVisibleSpaceState(!1)}}}))}}return a})),define("DS/VCXWebGUI/VCXGettingStartedUI",["UWA/Class","DS/WebappsUtils/WebappsUtils","DS/Core/PointerEvents","DS/CoreEvents/Events","DS/UIKIT/Mask","DS/UIKIT/SuperModal","DS/VCXWebIO/VCXLogServices","DS/VCXWebEWS/VCXExperienceServices","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI"],(function(e,t,i,n,a,r,s,o,l){"use strict";return e.singleton({init:function(){this._experienceName=null,this._collabSpace=null},initialize:function(e){this.home=UWA.Element("div",{html:"",class:"vcx-Curtain-Home"}),this.localMode=e.localMode,this.createDropZone()},unInitialize:function(){this.dropZone.remove(),this.dropZone=null,this.dndObjectOverlay.remove(),this.dndObjectOverlay=null,this.dndForbiddenOverlay.remove(),this.dndForbiddenOverlay=null,this.home.remove(),this.home=null},IsTstProvider:function(){return this.tstProvider},setParentNode:function(e){this.parentNode=e},createDropZone:function(){t.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_G_NXGDragAndDrop.png");this.dropZone=UWA.Element("div",{html:"",class:"vcx-DropZone-Main"}),this.dndObjectOverlay=new UWA.Element("div",{id:"xphoto-full-page-dnd-overlay"}),this.dndObjectOverlay.inject(this.dropZone),new UWA.Element("div",{id:"xphoto-image-dnd-icon",class:"fonticon fonticon-5x fonticon-drag-drop"}).inject(this.dndObjectOverlay),this.dndObjectOverlay.hide(),this.dndForbiddenOverlay=new UWA.Element("div",{id:"xphoto-full-page-dnd-overlay",html:[{tag:"span",class:"wux-ui-3ds wux-ui-3ds-5x wux-ui-3ds-wrong xphoto-image-dnd-icon",styles:{color:"#b4b6ba"}}]}),this.dndForbiddenOverlay.inject(this.dropZone),this.dndForbiddenOverlay.hide()},startLoadingPage:function(e){this.initWidget=UWA.Element("div",{html:"Initializing ...",class:"vcx-Curtain-InitWidget"}).inject(this.parentNode),UWA.Element("div",{html:"",class:"vcx-Curtain-InitWidget-BrandImage",styles:{backgroundImage:e}}).inject(this.initWidget)},clearInitWidget:function(){var e=document.getElementsByClassName("vcx-Curtain")[0];e&&e.destroy()},startLoadingExperience:function(){},failLoadingExperience:function(){this.removeCurtainFade()},endLoadingExperience:function(){this.dropZoneOFF(),this.home&&this.home.hide(),this.removeCurtainFade(),n.publish({event:"VCX_HIDE_CURTAIN"})},startExperiencePage:function(e,n,a,r,s,c,d){this.backgroundImage=a;this.home.inject(this.parentNode),this.dropZone.inject(this.parentNode),d&&this.home.addClassName("vcx-Curtain-MixedLayer"),this.experiencePage=UWA.Element("div",{html:"",class:"vcx-Curtain-Experience-container"}).inject(this.home);var u=UWA.Element("div",{html:"",class:"vcx-Curtain-Experience-Title-Header"}).inject(this.experiencePage);UWA.Element("div",{text:e,class:"vcx-Curtain-Experience-Title"}).inject(u);var h=UWA.Element("div",{html:"",class:"vcx-Curtain-Experience-Row"}).inject(this.experiencePage),p=UWA.Element("div",{html:"",class:"vcx-Curtain-Experience-Tile"+(s?"":" vcxFreezed")}).inject(h);s&&p.addEvent(i.POINTERUP,(e=>{o.onCreateEmptyExperience(this._experienceBase)}));var m=UWA.Element("img",{html:"",class:"vcx-Curtain-Experience-Image"+(s?"":" vcxFreezed"),src:t.getWebappsAssetUrl("VCXWebGUI","texture/gui/"+n)}).inject(p);c||(m.style.boxShadow="unset");var C=UWA.Element("div",{html:"",class:"vcx-Curtain-Experience-Footer"}).inject(p),g=UWA.Element("div",{html:"",class:"vcx-Curtain-Experience-Text"}).inject(C);UWA.Element("span",{text:r,class:"vcx-Curtain-Experience-Text2"}).inject(g);C=UWA.Element("div",{html:"",class:"vcx-Curtain-Footer"+(s?"":" vcxAnimate")}).inject(this.experiencePage);c||C.hide();var _=UWA.Element("div",{html:"",class:"vcx-Curtain-Footer-row"}).inject(C);UWA.Element("img",{html:"",src:t.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_draganddrophp.png"),class:"vcx-Curtain-Footer-Image"}).inject(_),UWA.Element("span",{html:(s?l["VCXGettingStartedUI.OrDropContentMessageBegin"]:l["VCXGettingStartedUI.DropContentMessageBegin"])+l["VCXGettingStartedUI.DropContentMessageEnd"],class:"vcx-Curtain-Footer-Text"}).inject(_)},setExperienceBase:function(e){this._experienceBase=e},getHomeNode:function(){return this.home},dropZoneON:function(){0===document.getElementsByClassName("vcx-DropZone-Main").length&&(this.parentNode?this.dropZone?this.dropZone.inject(this.parentNode):console.error("/! A DOM parent element is assignated to display dropzone but Dropzone element isn't created."):this.dropZone?console.error("/! The dropzone is created but not assigned to a DOM parent."):console.error("/! No visual dropzone element is created.")),this.dropZone.addClassName("vcx-DropZone-Display"),this.dndObjectOverlay.show();for(var e=document.getElementsByClassName("vcx-Curtain-Experience-Tile"),t=0;t<e.length;t++)e[t].style.pointerEvents="none"},dropZoneOFF:function(){for(var e=document.getElementsByClassName("vcx-Curtain-Experience-Tile"),t=0;t<e.length;t++)e[t].style.pointerEvents="";this.dropZone&&this.dropZone.removeClassName("vcx-DropZone-Display"),this.dndObjectOverlay&&this.dndObjectOverlay.hide()},addTile:function(e,n,a,r,s){var o=UWA.Element("div",{html:"",class:"vcx-Curtain-Experience-Tile"+(r?"":" vcxFreezed")}).inject(e);r&&o.addEvent(i.POINTERUP,(function(e){s()})),UWA.Element("img",{html:"",class:"vcx-Curtain-Experience-Image"+(r?"":" vcxFreezed"),src:t.getWebappsAssetUrl("VCXWebGUI","texture/gui/"+a)}).inject(o).style.animation="unset";var l=UWA.Element("div",{html:"",class:"vcx-Curtain-Experience-Footer"}).inject(o),c=UWA.Element("div",{html:"",class:"vcx-Curtain-Experience-Text"}).inject(l);UWA.Element("span",{text:n,class:"vcx-Curtain-Experience-Text2"}).inject(c)},curtainFade:function(){this.experiencePage&&this.experiencePage.addClassName("vcx-Curtain-Fade")},removeCurtainFade:function(){this.experiencePage&&this.experiencePage.removeClassName("vcx-Curtain-Fade")}})})),define("DS/VCXWebGUI/VCXMaterialChooserModal",["require","exports","DS/Windows/Dialog","UWA/Core","DS/Controls/Button"],(function(e,t,i,n,a){"use strict";return class{constructor(e,t,r){this._immersiveFrame=e,this._selectedID="PID_TEST",this._options=[];const s=new n.Element("div",{class:"GlobalContentModalChooser"}),o=new n.Element("div",{class:"ModalDialogMaterialChooserContent"}),l=this.BuildContentMaterialsChoices(r);new n.Element("div",{class:"TextHeaderMaterialModal",html:"The following materials have been inserted. Please choose a material to apply to your selection."}).inject(s);for(let e of l)e.inject(o);o.inject(s);const c={Apply:new a({onClick:async e=>{this._dialog.close(),t.apply&&await t.apply(this._selectedID)}}),Cancel:new a({onClick:async e=>{this._dialog.close(),t.close&&await t.close()}})};this._dialog=new i({immersiveFrame:this._immersiveFrame,title:"Material Chooser",content:s,identifier:"ModalMaterialsChooser",activeFlag:!1,modalFlag:!0,buttons:c})}_ChooseMaterial(e){this._selectedID=e;for(let t of this._options){t.getAttribute("data-rec-id")===e?t.addClassName("SelectedOption"):t.hasClassName("SelectedOption")&&t.removeClassName("SelectedOption")}}BuildContentMaterialsChoices(e){let t=[];for(let i of e){const e=new n.Element("div",{class:"MaterialsOptionsContainer"}),a=new n.Element("img",{class:"PreviewMaterialOption",src:i.preview,draggable:"false"}),r=new n.Element("div",{class:"NameMaterialOption",html:i.name});e.setAttribute("data-rec-id",i.id),a.inject(e),r.inject(e),e.addEventListener("click",(()=>{this._ChooseMaterial(i.id)})),t.push(e)}return this._options=t,t}Destroy(){for(let e of this._options)e.destroy&&e.destroy();this._dialog.destroy(),this._immersiveFrame=null}}}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebGUI/VCXExpBarView",["require","exports","UWA/Core","DS/Controls/Button","DS/Controls/ComboBox","DS/Utilities/Dom","DS/Core/TooltipModel","DS/VCXGUIInfrastructure/VCXView"],(function(e,t,i,n,a,r,s,o){"use strict";o=__importDefault(o);class l extends o.default{constructor(e){super(null),this.tweakerList=[],this.htmlElementList=[];let t=(0,i.createElement)("div",{class:"vcx-ExpBar-Container",html:""}).inject(e);this.htmlElementList.push(t);let n=(0,i.createElement)("div",{class:"vcx-ExpBar-NearContainer",html:""}).inject(t);this.htmlElementList.push(n);let a=(0,i.createElement)("div",{class:"vcx-ExpBar-CenterContainer",html:""}).inject(t);this.htmlElementList.push(a);let r=(0,i.createElement)("div",{class:"vcx-ExpBar-FarContainer",html:""}).inject(t);this.htmlElementList.push(r),this.architecture={container:t,near:n,center:a,far:r}}getView(){return this.architecture.container}uninitialize(){this.tweakerList.forEach((e=>{e.destroy()})),this.tweakerList=[],this.htmlElementList.forEach((e=>{e.remove()})),this.htmlElementList=[]}hide(){this.architecture.container.style.display="none"}show(){this.architecture.container.style.display=""}isHidden(){return this.architecture.container.checkVisibility()}generateButtonsFromJson(e){e.forEach((e=>{let t,o=new s({});switch(e.tooltip&&o.loadFromHelpRscFile(e.tooltip.pathToHelpRsc,e.tooltip.cmdId),e.tweakerType){case"button":t=new n({emphasize:e.emphasize,domId:e.id,tooltipInfos:o,icon:{iconName:e.iconName,fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"22px"},displayStyle:e.displayStyle||"lite",label:e.label}),e.function&&t.addEventListener("buttonclick",e.function),this.tweakerList.push(t);break;case"checkButton":t=new n({domId:e.id,tooltipInfos:o,icon:{iconName:e.iconName,fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"22px"},type:"check",checkFlag:"boolean"==typeof e.value&&e.value,displayStyle:"lite"}),this.tweakerList.push(t),e.function&&t.addEventListener("change",e.function);break;case"text":t=(0,i.createElement)("div",{class:"vcx-expBar-text "+e.id,html:e.value}),t.setStyle("color","var(--secondary-text)"),this.htmlElementList.push(t);break;case"separator":t=(0,i.createElement)("div",{class:"vcx-expBar-separator"}),this.htmlElementList.push(t);break;case"activeCombobox":t=new a({tooltipInfos:o,domId:e.id,elementsList:e.elementsList,enableSearchFlag:!1,actionOnClickFlag:!0,displayStyle:"lite",mainElementContent:"icon"}),e.function&&t.addEventListener("click",(t=>{e.function(t.dsModel.value)})),this.tweakerList.push(t);break;case"comboDropDown":t=new a({tooltipInfos:o,domId:e.id,elementsList:e.elementsList,enableSearchFlag:!1,displayStyle:"lite",mainElementVisibleFlag:!1}),e.function&&t.addEventListener("change",(t=>{e.function(t.dsModel.value)})),this.tweakerList.push(t);break;case"icon":t=r.generateIcon({iconName:e.iconName,fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"22px"}),t.setStyle("color","var(--secondary-text)"),this.htmlElementList.push(t)}switch(e.size?(e.size.height?t.getContent().setStyle("height",e.size.height):t.getContent().setStyle("height","25px"),e.size.width?t.getContent().setStyle("width",e.size.width):t.getContent().setStyle("width","25px")):(t.getContent&&t.getContent().setStyle("height","44px"),t.getContent&&t.getContent().setStyle("width","44px")),e.position){case"near":t.inject(this.architecture.near);break;case"center":t.inject(this.architecture.center);break;case"far":t.inject(this.architecture.far)}}))}updateZoomValue(e){let t=document.querySelector(".vcx-expBar-text.zoomText");t&&(t.textContent=e)}}return l}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebGUI/VCXPlayView",["require","exports","DS/Controls/Button","DS/Core/TooltipModel","UWA/Core","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI","DS/VCXGUIInfrastructure/VCXView"],(function(e,t,i,n,a,r,s){"use strict";s=__importDefault(s);class o extends s.default{constructor(e,t){super(null),this.scenesMap=new Map,this.hoverImageContainer=null,this.parentHoverImage=null,this.containerDiv=(0,a.createElement)("div",{class:"VCXImmersiveNav"}).inject(e),this.topContainer=null,this.closeButton=null,this.immersiveNavTopBar=null,this.arrowContainer=null,this.bottomBarContainer=null,this.fullScreenActiveButton=null,this.leftButton=null,this.rightButton=null,this.canvasButton=null,this.background=null,this.fullScreenButton=null,this.playButton=null,this.immersiveNavButton=null,this.pauseButton=null,this.playPauseContainer=null,this.playPauseContainerFake=null,this.immersiveNavStatus=!1,this.canvasStatus=!1,this.options=t,this.buildLayout(),this.setActiveFullScreen(!1),this.setPlayStatus(!1),this.setAuthoringVisibility(!1)}buildLayout(){this.buildImmersiveNav()}buildImmersiveNav(){this.buildTopBar(),this.buildArrow(),this.bottomBar()}bottomBar(){this.bottomBarContainer=(0,a.createElement)("div",{class:"VCXImmersiveNavBottomContainer"}).inject(this.containerDiv);let e=(0,a.createElement)("div",{class:"VCXImmersiveNavBottomContainerButton"}).inject(this.bottomBarContainer);this.fullScreenButton=(0,a.createElement)("div",{class:"VCXImmersiveNavButtonPlay VCXImmersiveNavButtonBottomBarPlay"}).inject(e);let t=new i({displayStyle:"lite",iconSize:"22px",icon:{iconName:"group",fontIconFamily:WUXManagedFontIcons.Font3DS}}).inject(this.fullScreenButton);t.addEventListener("buttonclick",(()=>{this.setActiveFullScreen(!0),this.options.fullScreenCb&&this.options.fullScreenCb(!0)})),this.fullScreenActiveButton=(0,a.createElement)("div",{class:"VCXImmersiveNavButtonPlay VCXImmersiveNavButtonBottomBarPlay"}).inject(e),t=new i({displayStyle:"lite",iconSize:"22px",icon:{iconName:"resize-small",fontIconFamily:WUXManagedFontIcons.Font3DS}}).inject(this.fullScreenActiveButton),t.addEventListener("buttonclick",(()=>{this.setActiveFullScreen(!1),this.options.fullScreenCb&&this.options.fullScreenCb(!1)})),this.playPauseContainer=(0,a.createElement)("div",{class:"VCXImmersiveNavBottomContainerButtonPlayPause"}).inject(e),this.playButton=(0,a.createElement)("div",{class:"VCXImmersiveNavButtonPlay VCXImmersiveNavButtonBottomBarPlay"}).inject(this.playPauseContainer),t=new i({displayStyle:"lite",iconSize:"22px",icon:{iconName:"play",fontIconFamily:WUXManagedFontIcons.Font3DS}}).inject(this.playButton),t.addEventListener("buttonclick",(()=>{this.setPlayStatus(!0),this.options.playCb&&this.options.playCb(!0)})),this.pauseButton=(0,a.createElement)("div",{class:"VCXImmersiveNavButtonPlay VCXImmersiveNavButtonBottomBarPlay"}).inject(this.playPauseContainer),t=new i({displayStyle:"lite",iconSize:"22px",icon:{iconName:"pause",fontIconFamily:WUXManagedFontIcons.Font3DS}}).inject(this.pauseButton),t.addEventListener("buttonclick",(()=>{this.setPlayStatus(!1),this.options.playCb&&this.options.playCb(!1)})),(0,a.createElement)("div",{class:"VCXImmersiveNavBottomSeparatorPlayPause"}).inject(this.playPauseContainer),this.playPauseContainerFake=(0,a.createElement)("div",{class:"VCXImmersiveNavBottomContainerButtonPlayPauseFake"}).inject(this.bottomBarContainer),this.immersiveNavButton=(0,a.createElement)("div",{class:"VCXImmersiveNavButtonPlay VCXImmersiveNavButtonBottomBarAuth"}).inject(this.bottomBarContainer),t=new i({displayStyle:"lite",iconSize:"25px",icon:{iconName:"media-controller",fontIconFamily:WUXManagedFontIcons.Font3DS}}).inject(this.immersiveNavButton),t.tooltipInfos=new n({shortHelp:r["ImmersiveNavButton.Tooltip"]}),t.addEventListener("buttonclick",(()=>{this.setVisibilityImmersiveNav(!this.immersiveNavStatus),this.options.immersiveNavActiveCb&&this.options.immersiveNavActiveCb(this.immersiveNavStatus)})),this.canvasButton=(0,a.createElement)("div",{class:"VCXImmersiveNavButtonPlay VCXImmersiveNavButtonBottomBarAuth"}).inject(this.bottomBarContainer),t=new i({displayStyle:"lite",iconSize:"22px",icon:{iconName:"eye-windowed",fontIconFamily:WUXManagedFontIcons.Font3DS}}).inject(this.canvasButton),t.addEventListener("buttonclick",(()=>{this.setActiveButtonCanvas(!this.canvasStatus),this.options.canvasActiveCb&&this.options.canvasActiveCb(this.canvasStatus)})),t.tooltipInfos=new n({shortHelp:r["CanvasButton.Tooltip"]})}buildArrow(){this.arrowContainer=(0,a.createElement)("div",{class:"VCXImmersiveNavArrowContainer"}).inject(this.containerDiv),this.leftButton=(0,a.createElement)("div",{class:"VCXImmersiveNavLeftButton VCXImmersiveNavButtonPlay"}).inject(this.arrowContainer);let e=new i({displayStyle:"lite",iconSize:"22px",icon:{iconName:"chevron-left",fontIconFamily:WUXManagedFontIcons.Font3DS}}).inject(this.leftButton);e.addEventListener("buttonclick",(()=>{this.options.onPlaySceneCb&&this.options.onPlaySceneCb(null,!1)})),this.rightButton=(0,a.createElement)("div",{class:"VCXImmersiveNavRightButton VCXImmersiveNavButtonPlay"}).inject(this.arrowContainer),e=new i({displayStyle:"lite",iconSize:"22px",icon:{iconName:"chevron-right",fontIconFamily:WUXManagedFontIcons.Font3DS}}).inject(this.rightButton),e.addEventListener("buttonclick",(()=>{this.options.onPlaySceneCb&&this.options.onPlaySceneCb(null,!0)}))}buildTopBar(){this.topContainer=(0,a.createElement)("div",{class:"VCXImmersiveNavTopContainer"}).inject(this.containerDiv),this.background=(0,a.createElement)("div",{class:"VCXImmersiveNavTopContainerBackGround VCXImmersiveNavTopContainerBackGroundOn"}).inject(this.topContainer),this.immersiveNavTopBar=(0,a.createElement)("div",{class:"VCXImmersiveNavTopContainerGrid"}).inject(this.topContainer),this.closeButton=(0,a.createElement)("div",{class:"VCXImmersiveNavCloseButton"}).inject(this.topContainer),new i({displayStyle:"lite",iconSize:"17px",icon:{iconName:"close",fontIconFamily:WUXManagedFontIcons.Font3DS}}).inject(this.closeButton).addEventListener("buttonclick",(()=>{this._close(),this.options.closeCallBack&&this.options.closeCallBack()}))}destroy(){this.containerDiv.destroy()}updateGridContainer(e){let t=Array.from(this.scenesMap.keys());if(!(e.length==t.length&&t.every((function(t,i){return t==e[i]})))){this.scenesMap.clear();for(let t of e){let e=(0,a.createElement)("div",{class:"VCXImmersiveNavTopContainerBar"});e.setData("scenarioId",t);let i=(0,a.createElement)("div",{class:"VCXImmersiveNavTopBar"}).inject((0,a.createElement)("div",{class:"VCXImmersiveNavTopBackground"}).inject((0,a.createElement)("div",{class:"VCXImmersiveNavTopBackgroundParent"}).inject(e)));e.addEventListener("click",(()=>{this.options.onPlaySceneCb&&this.options.onPlaySceneCb(t,!1)})),e.addEventListener("mouseover",(()=>{this.createHoverImage(e,t)})),e.addEventListener("mouseleave",(()=>{this.createHoverImage(null,t)})),this.scenesMap.set(t,{container:e,bar:i})}this.immersiveNavTopBar?.replaceChildren(...Array.from(this.scenesMap.values()).map((e=>e.container)))}}getHeaderSize(){return this.containerDiv.isHidden()||!this.topContainer?0:this.topContainer?.offsetHeight}createHoverImage(e,t){if(this.parentHoverImage===e)return;if(!this.options.onHoverCb)return;if(this.parentHoverImage=e,this.hoverImageContainer&&this.hoverImageContainer.destroy(),!this.parentHoverImage)return;this.hoverImageContainer=(0,a.createElement)("div",{class:"VCXImmersiveNavTopThumbnailContainer"});let i=(0,a.createElement)("img",{class:"VCXImmersiveNavTopThumbnail VCXImmersiveNavTopThumbnailHidden"}).inject(this.hoverImageContainer);if(this.options.onHoverCb){let e=this.options.onHoverCb(t);e&&(i.src=e)}this.hoverImageContainer?.inject(this.parentHoverImage),setTimeout((()=>i.removeClassName("VCXImmersiveNavTopThumbnailHidden")),10)}updateActiveScenario(e,t,i=!1){let n=this.immersiveNavTopBar?.getChildren();if(n)for(let n of this.scenesMap.entries())i?(n[1].bar.setStyle("width",(n[0]===e?t:0)+"%"),setTimeout((()=>{this.setVisibilityFlag(n[1].container,n[0]===e,"VCXImmersiveNavTopContainerBarActive")}))):(this.setVisibilityFlag(n[1].container,n[0]===e,"VCXImmersiveNavTopContainerBarActive"),n[1].bar.setStyle("width",(n[0]===e?t:0)+"%"))}setVisibility(e){e?this.containerDiv.show():this.containerDiv.hide()}setAuthoringVisibility(e){e?this.immersiveNavButton?.show():this.immersiveNavButton?.hide(),e?this.canvasButton?.show():this.canvasButton?.hide(),e?this.closeButton?.show():this.closeButton?.hide()}setVisibilityPlayPause(e){e?this.playPauseContainer?.show():this.playPauseContainer?.hide(),e?this.playPauseContainerFake?.hide():this.playPauseContainerFake?.show()}setArrowVisibility(e,t){this.setVisibilityFlag(this.leftButton,e,"VCXImmersiveNavOpacityHidden"),this.setVisibilityFlag(this.rightButton,t,"VCXImmersiveNavOpacityHidden")}setVisibilityImmersiveNav(e){this.setVisibilityFlag(this.immersiveNavTopBar,!e,"VCXImmersiveNavHidden"),this.setVisibilityPlayPause(e),this.setVisibilityFlag(this.arrowContainer,!e,"VCXImmersiveNavHidden"),this.setActiveButtonImmersiveNav(e)}setActiveFullScreen(e){e?this.fullScreenButton?.hide():this.fullScreenButton?.show(),e?this.fullScreenActiveButton?.show():this.fullScreenActiveButton?.hide()}setPlayStatus(e){e?this.playButton?.hide():this.playButton?.show(),e?this.pauseButton?.show():this.pauseButton?.hide()}setActiveButtonImmersiveNav(e){this.immersiveNavStatus=e,this.setVisibilityFlag(this.immersiveNavButton,e,"VCXImmersiveNavButtonBottomBarAuthActive")}setActiveButtonCanvas(e){this.canvasStatus=e,this.setVisibilityFlag(this.canvasButton,e,"VCXImmersiveNavButtonBottomBarAuthActive")}_close(){this.setActiveFullScreen(!1),this.setPlayStatus(!1),this.setArrowVisibility(!0,!0),this.updateGridContainer([])}getView(){return this.containerDiv}setVisibilityFlag(e,t,i){t&&!e?.hasClassName(i)&&e?.addClassName(i),!t&&e?.hasClassName(i)&&e?.removeClassName(i)}}return o}));var __decorate=this&&this.__decorate||function(e,t,i,n){var a,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(r<3?a(s):r>3?a(t,i,s):a(t,i))||s);return r>3&&s&&Object.defineProperty(t,i,s),s};__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebGUI/VCXActionBarCtrl",["require","exports","DS/VCXGUIInfrastructure/VCXGUIComponentCtrl","DS/ApplicationFrame/CommandsManager","DS/VCXWebComposer/VCXCommandControllerManager","DS/VCXWebSystem/VCXEvent"],(function(e,t,i,n,a,r){"use strict";n=__importDefault(n),a=__importDefault(a),r=__importDefault(r);class s extends i{constructor(){super(),this.actionBarFile="VCXWebAuthoringApp.xml",this.actionBarModule="VCXWebAuthoringApp",this.actionBar=null,this._ACTIONBAR_OPEN=null,this._ACTIONBAR_CLOSE=null,this._ACTIONBAR_OPEN_timeout=null,this._ACTIONBAR_CLOSE_timeout=null,this.actionbarContainer=document.querySelector(".wux-docking-element-bottom")?.children[2]}BuildView(){this.actionBar=this._experienceBase.getManager("VCXContextManager").getActionBar(),this.getActionBarWUXPanels().map((e=>e.movableFlag=!1));let e=this._experienceBase.getManager("VCXCommandControllerManager");e.registerAvailabilityCommands(["VCXCreateDressupLabelRoundedBoxBlackCmd","VCXCreateDressupCallOutWhiteCmd","VCXCreateDressupTextBoxDefaultWhiteCmd","VCXCreateDressup2DImageCmd","VCXCreateDressup3DImageCmd","VCXCreateDressupLinearArrowCmd","VCXCreateDressupCircularArrowCmd","VCXCreateDressupCircleCmd","VCXAutoCreateAssociativePathCmd","VCXCreateDressupPolylineCmd","VCXCreateDressupRedlineCmd","VCXCreateDressupPointPointMeasCmd","VCXCreateDressupPlanePointMeasCmd","VCXCreateDressupPlanePlaneMeasCmd","VCXCreateDressupCoordMeasCmd","VCXDiggerCmd","VCXCreateDressupDirectSectionCmd","VCXSectionSwitchUnionModeCmd","VCXCreateDressupHotspotCmd","VisuReframeViewCmd","VCXTransformFreeDragCmd","VCXTransformCmd","VCXMoveRobotOnBBoxCenterCmd","VCXExplodeLinearGUICmd","VCXExplodeCylindricalGUICmd","VCXExplodeSphericalGUICmd","VCXCreateDressupMagnetLineCmd","VCXCreateDressup3DGridCmd","VCXCreateDressup3DAlignerCmd","VCXApplyTransformationCmd","VCXSelectSimilarColorActionBar","VCXSelectSimilarInstanceActionBar","VCXSelectMarkups","VCXSelectGeometries"]),e.registerAvailabilityCommands("VCXAutoCreateAssociativePathCmd",new a.default.SelectionFilter({type:"VCXComponentOccurrenceExt"}));var t=this._experienceBase.getManager("VCXSectionManager");e.registerAvailabilityCommands("VCXSectionSwitchUnionModeCmd",(()=>{var e=t&&t.getActiveSections();return e&&Object.values(e).length>0}));const i=this._experienceBase.getManager("VCXDressupManager");e.registerAvailabilityCommands(s.listCmdAlign.concat(s.listCmdDistribute),new a.default.SelectionFilter({preFilterCb:e=>i.CheckDressupIsAlignable(e)?.isAlignableValue??!1,minCount:2})),e.registerAvailabilityCommands(s.listCmdDistribute),new a.default.SelectionFilter({preFilterCb:e=>i.CheckDressupIsAlignable(e)?.isAlignableValue??!1,minCount:3}),e.registerAvailabilityCommands("VCXMoveRobotOnBBoxCenterCmd",[new a.default.SelectionFilter({preFilterCb:e=>e.IsKindOf("VCXComponentOccurrenceExt")}),new a.default.RunningCommandFilter("VCXTransformCmd")])}onSectionListChanged(){this._experienceBase.getManager("VCXCommandControllerManager").evaluateCommandsAvailability()}onSelectionChanged(e){this.updateFormatPainter(e)}updateFormatPainter(e){let t=this._experienceBase.getManager("VCXGUIManager"),i=(e&&e[0])??null;t?.changeFormatPainterUIVisibility(this.isRunning(s.formatPainters)||"VCXScenario"===i?.componentType||i?.QueryInterface("VCXIModifiableFormatPainter"))}isRunning(e){return e.find((e=>n.default.getCommand(e)?.isRunning()??!1))}postInitialize(){this.recordActionBarEvent()}getActionBarWUXPanels(){var e=this._experienceBase.getManager("VCXContextManager").getFrameWindow().getImmersiveFrame().windows??[];return Object.keys(e).filter((e=>e.startsWith("WAfrUIModelMainComponent"))).map((t=>e[t]))}hide(){this.actionBar&&this.actionBar.close()}updatePaperArea(e,t){let i=this.actionbarContainer.getDimensions().height;i-=2,e&&(e.bottom-=i,e.height-=i),t&&(t.bottom-=i,t.height-=i)}unInitialize(){this._ACTIONBAR_OPEN_timeout&&(clearTimeout(this._ACTIONBAR_OPEN_timeout),this._ACTIONBAR_OPEN_timeout=null),this._ACTIONBAR_CLOSE_timeout&&(clearTimeout(this._ACTIONBAR_CLOSE_timeout),this._ACTIONBAR_CLOSE_timeout=null),this.actionBar&&this.actionBar._modelEvents.unsubscribe(this._ACTIONBAR_OPEN),this.actionBar&&this.actionBar._modelEvents.unsubscribe(this._ACTIONBAR_CLOSE)}recordActionBarEvent(){this.actionBar||(this.actionBar=this._experienceBase.getManager("VCXContextManager").getActionBar()),this.actionBar&&(this._experienceBase.getManager("VCXContextManager").getPlayerMode()&&this.actionBar.close(),this._ACTIONBAR_OPEN||(this._ACTIONBAR_OPEN=this.actionBar._modelEvents.subscribe({event:"ACTIONBAR_OPEN"},(()=>{this._ACTIONBAR_OPEN_timeout=setTimeout((()=>{this._experienceBase.getManager("VCXGUIManager").updateUsableArea()}),1e3*parseFloat("0.4"))}))),this._ACTIONBAR_CLOSE||(this._ACTIONBAR_CLOSE=this.actionBar._modelEvents.subscribe({event:"ACTIONBAR_CLOSE"},(()=>{this._ACTIONBAR_CLOSE_timeout=setTimeout((()=>{this._experienceBase.getManager("VCXGUIManager").updateUsableArea()}),1e3*parseFloat("0.4"))}))))}}return s.formatPainters=["VCXMultipleFormatPainterCmd","VCXSingleFormatPainterCmd"],s.listCmdAlign=["VCXAlignBottomCmd","VCXAlignCenterCmd","VCXAlignLeftCmd","VCXAlignMiddleCmd","VCXAlignRightCmd","VCXAlignTopCmd"],s.listCmdDistribute=["VCXDistributeSpaceHorizontallyCmd","VCXDistributeSpaceVerticallyCmd"],__decorate([r.default.Handler("VCX_SECTION_LIST_CHANGED")],s.prototype,"onSectionListChanged",null),__decorate([r.default.Handler(["VCX_SELECTION_COMPONENTSLIST_ADD","VCX_SELECTION_COMPONENTSLIST_REMOVE","VCX_SELECTED_ACTORS_EMPTY"])],s.prototype,"onSelectionChanged",null),__decorate([r.default.subscribeAll],s.prototype,"postInitialize",null),__decorate([r.default.unsubscribeAll],s.prototype,"unInitialize",null),s})),function(){"use strict";if("function"==typeof window.Event)return!1;function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var i=document.createEvent("CustomEvent");return i.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),i}e.prototype=window.Event.prototype,window.Event=e}(),define("DS/VCXWebGUI/VCXGUIManager0",["UWA/Class","DS/CoreEvents/Events","DS/CoreEvents/ModelEvents","DS/Core/PointerEvents","DS/Controls/Tooltip","DS/Core/TooltipModel","DS/WebappsUtils/WebappsUtils","DS/VCXWebGUI/VCXScenarioCtrlExt","DS/VCXWebGUI/VCXSceneCtrl","DS/VCXWebGUI/VCXPlayCtrl","DS/VCXWebGUI/VCXPanelCtrl","DS/VCXWebGUI/VCXPaperCtrl","DS/VCXWebGUI/VCXPaperCtrlV2","DS/VCXWebGUI/VCXRatioCtrl","DS/VCXWebGUI/VCXMaterialCtrl","DS/VCXWebGUI/ambiences/VCXAmbienceMainCtrl","DS/VCXWebGUI/VCXTreePanelCtrl","DS/VCXWebGUI/VCXUIPartListCtrl","DS/VCXWebGUI/VCXPropertiesCtrlExt","DS/VCXWebGUI/VCXStatsCtrl","DS/VCXGUIInfrastructure/VCXTabPageFrame","DS/VCXWebTreeGUI/VCXWebTabFrameCtrl","DS/VCXWebTreeGUI/VCXWebAssemblyTabFrameCtrl","DS/VCXWebTreeGUI/VCXWebDressupTabFrameCtrl","DS/VCXWebTreeGUI/VCXWebStylesTabFrameCtrl","DS/VCXWebTreeGUI/VCXWebAssemblyTreeCtrl","DS/VCXWebTreeGUI/VCXWebSelectionSetsTreeCtrl","DS/VCXWebTreeGUI/VCXWebHotspotsTreeCtrl","DS/VCXWebTreeGUI/VCXWebDressupTreeCtrl","DS/VCXWebTreeGUI/VCXWebStylesTreeCtrl","DS/Windows/WindowManager","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/Loader","DS/Controls/ModalContainer","DS/ApplicationFrame/CommandsManager","DS/VCXWebGUI/VCXTimelineController","DS/VCXWebGUI/VCXGUIServices","DS/VCXWebGUI/VCXGettingStartedUI","DS/VCXWebIO/VCXLogServices","DS/VCXWebVisu/VCXModifiablesAccess","DS/VCXWebGUI/VCXUpdateView","DS/VCXWebGUI/VCXMediaChooserServices","DS/VCXWebEWS/VCXExperienceServices","DS/VCXWebPlatform/VCX3DSpaceServices","DS/VCXWebSystem/VCXHardwareServices","DS/VCXWebGUI/VCXGettingStartedExperienceInformationModal","DS/VCXWebKernelCommands/VCXCmdChangeViewpoint","DS/VCXWebGUIInfra/VCXContainerDivider","DS/VCXWebGUI/VCXSelectionSetPanel","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI","DS/VCXWebGUI/VCXSettingsPanel","DS/VCXWebGUI/VCXLandingPageWAFRAdaptator","DS/VCXWebExperienceBase/VCXContextManager","DS/VCXWebGUI/VCXExpBarCtrl"],(function(e,t,i,n,a,r,s,o,l,d,u,h,p,m,C,g,_,b,v,f,S,V,x,I,y,P,M,w,D,X,A,T,E,B,G,U,k,N,W,F,L,R,O,H,z,q,j,K,Z,Q,Y,J,$,ee,te){"use strict";var ie=e.extend({GetSelectedProperties:function(){if(this._vcxPropertiesCtrl&&this._vcxPropertiesCtrl.GetSelectedProperties)return this._vcxPropertiesCtrl.GetSelectedProperties()},CopyProperties:function(e,t){this._copyProperties=e,this._copyModifiables=t},GetCopiedProperties:function(){var e={};return e.properties=this._copyProperties,e.arrayMod=this._copyModifiables,e},getUsableArea:function(e){if(!this._experienceBase.getManager("VCXContextManager").isSupported("Paper"))return this.GetCanvasView();if(this._experienceBase.getManager("VCXContextManager").IsWAFR()){var t=".wux-windows-docking-element-free-zone.wux-docking-element-right.wux-windows-immersive-frame-freeZone";return"boolean"==typeof e&&e&&(t=".wux-windows-docking-element-free-zone.wux-docking-element-bottom"),document.querySelector(t)}t="wux-windows-docking-element-free-zone wux-docking-element-bottom";return"boolean"==typeof e&&e&&(t="wux-controls-abstract wux-windows-immersive-frame"),document.querySelector('.wux-afr-framewindow-uiframe[datatype="UI-Frame"]').getElementsByClassName(t)[0]},postUpdate:function(e){this._vcxWebAssemblyTreeCtrl&&this._vcxWebAssemblyTreeCtrl.unstackSelect(),this._vcxWebSelectionSetsTreeCtrl&&this._vcxWebSelectionSetsTreeCtrl.unstackSelect(),this._vcxWebHotspotsTreeCtrl&&this._vcxWebHotspotsTreeCtrl.unstackSelect(),this._vcxWebDressupTreeCtrl&&this._vcxWebDressupTreeCtrl.unstackSelect(),this._vcxWebStylesTreeCtrl&&this._vcxWebStylesTreeCtrl.unstackSelect()},_getOptiUsableArea:function(e){var t=document.getElementsByClassName("wux-controls-abstract wux-windows-immersive-frame")[0],i=t&&t.getBoundingClientRect();if(e&&i){var n={},a=e.getBoundingClientRect();n.left=a.left-i.left,n.top=a.top-i.top,n.right=i.right-a.right,n.bottom=a.bottom,n.width=a.width,n.height=a.height;return n.left+=5,n.top+=5,n.right-=5,n.width-=10,n.bottom-=5,n.height-=10,n}},updateUsableArea:function(){this._experienceBase.getManager("VCXContextManager").isSupported("Paper");var e=this._getOptiUsableArea(this.getUsableArea()),i=this._getOptiUsableArea(this.getUsableArea(!0));e&&i&&(this._vcxPaperCtrl&&this._vcxPaperCtrl.updatePaperArea(e),this._vcxPaperCtrlV2&&this._vcxPaperCtrlV2.updatePaperArea(e,i),this._vcxPlayCtrl&&this._vcxPlayCtrl.updatePaperArea(e,i),this._experienceBase.getManager("VCXContextManager").getUrlVars().optimViewportPaper&&(this.GetCanvasView().style.position="absolute",this.GetCanvasView().style.left=e.left+"px",this.GetCanvasView().style.right=e.right+"px",this.GetCanvasView().style.top=e.top+"px",this.GetCanvasView().style.bottom=e.bottom+"px"),t.publish({event:"VCX_GUI_USABLEAREA_UPDATE",data:{area:e,areaWithoutPanels:i}}))},getUIResponsivenessParameters:function(e){var t=this._getUIResponsivenessParametersArray();if(!t)return null;for(var i=0;i<t.length;++i){var n=t[i];if(e<=n.viewportMax&&e>n.viewportMin)return n}},_getUIResponsivenessParametersArray:function(){return[{viewportMin:0,viewportMax:880,panelMinWidth:250,hidePanels:!0,fitBetweenPanels:!1},{viewportMin:880,viewportMax:1080,panelMinWidth:250,hidePanels:!1,fitBetweenPanels:!1},{viewportMin:1080,viewportMax:1/0,panelMinWidth:300,hidePanels:!1,fitBetweenPanels:!0}]},updateDockingElements:function(){if(this.immersiveFrame){var e=[],t=this.immersiveFrame.getDockingElement(WUXDockAreaEnum.RightDockArea);t&&e.push(t);var i=this.immersiveFrame.getDockingElement(WUXDockAreaEnum.LeftDockArea);i&&e.push(i);for(var n=this._getUIResponsivenessParametersArray(),a=document.body.clientWidth,r=null,s=null,o=!1,l=null,c=null,d=!this._previousViewportWidth,u=!!this._previousViewportWidth,h=0;h<n.length;++h){var p=!1,m=n[h];if(!o&&a<=m.viewportMax&&a>m.viewportMin&&(r=m.panelMinWidth,s=m.hidePanels,o=!0,p=!0),!d&&this._previousViewportWidth&&this._previousViewportWidth<=m.viewportMax&&this._previousViewportWidth>m.viewportMin&&(l=m.panelMinWidth,c=m.hidePanels,d=!0,p||(u=!1)),o&&d)break}if(o&&d){if(!u)for(var C=0;C<e.length;++C){var g=e[C];if(l<r)g.minSize=r,g.dockingZoneSize<g.minSize&&(g.dockingZoneSize=g.minSize);else if(l>r){var _=g.dockingZoneSize===g.minSize;g.minSize=r,_&&(g.dockingZoneSize=g.minSize)}c!==s&&g.collapseDockingZoneFlag!==s&&(g.collapseDockingZoneFlag=s)}var b=this._experienceBase.getManager("VCXContextManager");b.isSupported("PropAndScnPanelExpandOverride")&&(b.isSupported("ScenarioPanelExpand")?e[1].collapseDockingZoneFlag=!1:e[1].collapseDockingZoneFlag=!0,b.isSupported("PropertiesPanelExpand")?e[0].collapseDockingZoneFlag=!1:e[0].collapseDockingZoneFlag=!0),this._previousViewportWidth=a}else console.warn("Something went wrong: we didn't get all infos")}},_unInitializeCommandsHeader:function(){},unInitialize:function(){R.unInit(),this._experienceBase.getManager("VCXContextManager").unloadCssFile("VCXWebGUI/VCXGUIManager.css"),this._experienceBase.getManager("VCXContextManager").unloadCssFile("VCXWebGUI/VCXUISequence.css"),this._experienceBase.getManager("VCXContextManager").unloadCssFile("VCXWebTreeGUI/VCXWebTreeGUI.css"),this._experienceBase.getManager("VCXContextManager").unloadCssFile("VCXWebGUI/VCXWebSignature.css"),this._experienceBase.getManager("VCXContextManager").unloadCssFile("VCXWebGUI/VCXUIPaper.css",1),this._experienceBase.getManager("VCXContextManager").unloadCssFile("VCXWebGUI/VCXUIMaterial.css",1),j.unInitialize();var e=this._experienceBase.getManager("VCXContextManager").getActionBar();if(this._ACTIONBAR_OPEN_timeout&&(clearTimeout(this._ACTIONBAR_OPEN_timeout),this._ACTIONBAR_OPEN_timeout=null),this._ACTIONBAR_CLOSE_timeout&&(clearTimeout(this._ACTIONBAR_CLOSE_timeout),this._ACTIONBAR_CLOSE_timeout=null),e&&e._modelEvents.unsubscribe(this._ACTIONBAR_OPEN),e&&e._modelEvents.unsubscribe(this._ACTIONBAR_CLOSE),this._ACTIONBAR_OPEN=0,this._ACTIONBAR_CLOSE=0,this._frmWindow&&this._frmWindow._sceneGraphTree&&this._frmWindow._sceneGraphTree.tree){var i=this._frmWindow._sceneGraphTree.tree._sidePanel;this._VCX_GUI_PANEL_SLIDE_IN&&i&&i._modelEvents.unsubscribe(this._VCX_GUI_PANEL_SLIDE_IN),this._VCX_GUI_PANEL_SLIDE_OUT&&i&&i._modelEvents.unsubscribe(this._VCX_GUI_PANEL_SLIDE_OUT)}for(var a in this._VCX_GUI_PANEL_SLIDE_IN=0,this._VCX_GUI_PANEL_SLIDE_OUT=0,this._tokens)this._tokens.hasOwnProperty(a)&&t.unsubscribe(this._tokens[a]);if(window.removeEventListener&&(window.removeEventListener("dimensionsChanged",this._onResizeDocking,!0),window.removeEventListener("dockIsResizing",this._onResizeDocking,!0),window.removeEventListener("dockResize",this._onResizeDocking,!0),window.removeEventListener("resize",this._onResizeWidget,!0)),this.immersiveFrame)for(var r=this.immersiveFrame.dockingElements,s=0;s<r.length;s++){r[s].removeEventListener(n.POINTERUP,this._updateDockingAreaCB)}this._frmWindow=null,this._uiLayer=null,this.immersiveFrame=null,this._isIE11=null,this._init=0,this._destroyed=0,this._vcxGettingStartedUI&&(this._vcxGettingStartedUI.unInitialize(),this._vcxGettingStartedUI=null),this._vcxPanelCtrl&&(this._vcxPanelCtrl.unInitialize(),this._vcxPanelCtrl=null),this._vcxRatioCtrl&&(this._vcxRatioCtrl.unInitialize(),this._vcxRatioCtrl=null),this._vcxCameraCtrl&&(this._vcxCameraCtrl.unInitialize(),this._vcxCameraCtrl=null),this._vcxScenarioCtrl&&(this._vcxScenarioCtrl.unInitialize(),this._vcxScenarioCtrl=null),this._vcxPlayCtrl&&(this._vcxPlayCtrl.unInitialize(),this._vcxPlayCtrl=null),this._vcxSceneCtrl&&(this._vcxSceneCtrl.unInitialize(),this._vcxSceneCtrl=null),this._vcxMaterialCtrl&&this._vcxMaterialCtrl.unInitialize&&(this._vcxMaterialCtrl.unInitialize(),this._vcxMaterialCtrl=null),this._vcxGUIPartList&&this._vcxGUIPartList.unInitialize&&(this._vcxGUIPartList.unInitialize(),this._vcxGUIPartList=null),this._vcxAmbienceCtrl&&this._vcxAmbienceCtrl.unInitialize&&(this._vcxAmbienceCtrl.unInitialize(),this._vcxAmbienceCtrl=null),this._vcxTreePanelCtrl&&this._vcxTreePanelCtrl.unInitialize&&(this._vcxTreePanelCtrl.unInitialize(),this._vcxTreePanelCtrl=null),this.unInitTreesTabFrames(),this._vcxPaperCtrl&&(this._vcxPaperCtrl.unInitialize(),this._vcxPaperCtrl=null),this._vcxPaperCtrlV2&&(this._vcxPaperCtrlV2.unInitialize(),this._vcxPaperCtrlV2=null),this._vcxExpBarCtrl&&(this._vcxExpBarCtrl.unInitialize(),this._vcxExpBarCtrl=null),this._vcxPropertiesCtrl&&(this._vcxPropertiesCtrl.unInitialize(),this._vcxPropertiesCtrl=null),this._vcxTimelineCtrl&&(this._vcxTimelineCtrl.unInitialize(),this._vcxTimelineCtrl=null),this._forceDisplayTimeline=null,this._vcxSampleCtrl&&(this._vcxSampleCtrl.unInitialize(),this._vcxSampleCtrl=null),this._usableArea&&this._usableArea.parentNode&&this._usableArea.parentNode.removeChild(this._usableArea),this._usableArea=null,this._modelEvent.publish({event:"unInitialize",data:{}}),removeEventListener("keydown",this._onKeydownEvent),this.landingPage&&(this.landingPage.close(),this.landingPage=null),this._touchMultiSelectionDiv&&(this._touchMultiSelectionDiv.remove(),this._touchMultiSelectionDiv=null)},initialize:function(){var e=this._experienceBase.getManager("VCXContextManager"),t=e.getContextFromName("PlayerMode"),n=!!e.getContextFromName("ExperienceIn3DPlay"),a=e.getContextFromName("ProdHighMode");this._modelEvent=new i,this._forceDisplayTimeline=!1,j.initialize(),e.loadCssFile("VCXWebProducts/VCXWebProducts.css",1),e.loadCssFile("VCXWebGUI/VCXGUIManager.css",1),e.loadCssFile("VCXWebGUI/VCXUISequence.css",1),e.loadCssFile("VCXWebTreeGUI/VCXWebTreeGUI.css",1),e.loadCssFile("VCXWebGUI/VCXUIPaper.css",1),e.loadCssFile("VCXWebGUI/VCXPropertyPanel.css",1),e.loadCssFile("VCXWebGUI/VCXUIMaterial.css",1);var r="",o="",l="",c=!0,d=!0,u=!1,h=e.IsLocalMode();a&&!h||n&&a||(this._vcxGettingStartedUI=this.getGettingStartedUI(),this._vcxGettingStartedUI&&(this._vcxGettingStartedUI.initialize({localMode:h}),this._vcxGettingStartedUI.setExperienceBase(this._experienceBase),void 0!==window.widget&&window.widget.body?this._vcxGettingStartedUI.setParentNode(widget.body):document.body?this._vcxGettingStartedUI.setParentNode(document.body):console.error("The widget and the document bodies are undefined."))),l=Y["VCXGettingStartedUI.CreateExperience"],o=Y["VCXGettingStartedUI.WelcomeMessageAuthoring"],t&&n&&!a?(r="url("+s.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_Player_BackgroundLogo_In3DPlay.png")+")",o="",l="",c=!1,d=!1):t?(o=Y["VCXGettingStartedUI.WelcomeMessagePlay"],r="url("+s.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_Player_BackgroundLogo_CATIA.png")+")",c=!1,l="Open an smg",u=!0):a?h&&(u=!0):r="url("+s.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_BackgroundLogo_3DEXCITE_XPC.png")+")",this._firstLoad=!0,this._sceneNeedsUpdate=!1,this._publishAdvancedDisplay=!1,this._vcxSampleCtrl=null,this._isPlayingGoTo=0,this._isAnimationLoop=!1,this._isCameraPlayMode=!1,this._vcxScenarioCtrl=null,this._vcxPlayCtrl=null,this._vcxSceneCtrl=null,this._vcxWebAssemblyTreeCtrl=null,this._vcxWebDressupTreeCtrl=null,this._vcxWebStylesTreeCtrl=null,this._vcxPublishRasterImageCtrl=null,this._vcxPublishVideoCtrl=null,this._vcxPaperCtrl=null,this._vcxPaperCtrlV2=null,this._vcxPropertiesCtrl=null,this._frmWindow=null,this._uiLayer=null,this.immersiveFrame=null,this._backgroundDrop=null,this._backgroundDropText=null,this._dropZone=null,this._usableArea=null,this._touchMultiSelectionDiv=null,this._touchAvailable=!0,this._tokens={},this._vcxDisplayScenarioImmersiveUI=!1,this._tooltipDisplay="true"!==e.getUrlVars().DeactivateTooltipsAtStart,this.isTouchActivated()&&(this._tooltipDisplay=!1),this._init=0;["3ds.com:8176","localhost","devops"].find((t=>e.getMainURL().includes(t)))&&UWA.Element.addEvent.call(document,"keydown",(e=>{if(this._experienceBase.isValid){var t=UWA.Event.whichKey(e);"alt+ctrl+shift+o"!==t&&"ctrl+f12"!==t||J.showChoosePanel(this._experienceBase.getManager("VCXContextManager").getFrameWindow())}})),void 0!==e.getUrlVars().debugsupported&&setTimeout((()=>J.showChoosePanel(this._experienceBase.getManager("VCXContextManager").getFrameWindow())),500);var p=null;if((p=window.widget&&widget.getValue("X3DContentId")&&JSON.parse(widget.getValue("X3DContentId")))&&p.data&&p.data.items[0]&&p.data.items[0].objectId&&"HighlightPresentation3DCom"==p.data.items[0].objectType){var m=p.data.items[0].displayName,C=p.data.items[0].objectId;this._experienceBase.getManager("VCXAnalyticsTrackerAppManager").trackOpenPresentationEvent("xH_OpenWith"),H.onLoadExperienceFromPhysicalID(this._experienceBase,m,C),p.data=null,widget.setValue("X3DContentId",JSON.stringify(p))}else{if(this.landingPage){var g=this,_=this._vcxGettingStartedUI;return this.landingPage.initializeButtons().then((function(){return g.landingPage.displayHome()})).then((function(){"undefined"!=typeof widget&&_&&_.dropZone.inject(_.parentNode)}))}if(this._vcxGettingStartedUI){var b=this.getBrandImage();this._vcxGettingStartedUI.startExperiencePage(o,b,r,l,c,d,u)}}},SetSceneNeedsUpdate:function(e){this._sceneNeedsUpdate=e},GetSceneNeedsUpdate:function(){return this._sceneNeedsUpdate},getBrandImage:function(){var e=this._experienceBase.getManager("VCXContextManager"),t=e.getContextFromName("PlayerMode"),i=!!e.getContextFromName("ExperienceIn3DPlay"),n=e.getContextFromName("ProdHighMode");return t&&i&&!n?"I_VCX_Player_BackgroundLogo_In3DPlay.png":n?"I_VCX_SplashComposer"+Math.floor(5*Math.random()+1)+"_.png":void 0},setPublishAdvancedDisplay:function(e){this._publishAdvancedDisplay=e,this._vcxPublishRasterImageCtrl&&this._vcxPublishRasterImageCtrl.updateAdvancedDisplay(),this._vcxPublishVideoCtrl&&this._vcxPublishVideoCtrl.updateAdvancedDisplay()},getPublishAdvancedDisplay:function(){return this._publishAdvancedDisplay},recordActionBarEvent:function(){var e=this._experienceBase.getManager("VCXContextManager").getActionBar();if(e){this._experienceBase.getManager("VCXContextManager").getContextFromName("PlayerMode")&&e.close();parseFloat(e.elements.container.style.transitionDuration);var t=this;this._ACTIONBAR_OPEN||(this._ACTIONBAR_OPEN=e._modelEvents.subscribe({event:"ACTIONBAR_OPEN"},(function(){t._ACTIONBAR_OPEN_timeout=setTimeout((function(){t.updateUsableArea()}),1e3*parseFloat(.4))}))),this._ACTIONBAR_CLOSE||(this._ACTIONBAR_CLOSE=e._modelEvents.subscribe({event:"ACTIONBAR_CLOSE"},(function(){t._ACTIONBAR_CLOSE_timeout=setTimeout((function(){t.updateUsableArea()}),1e3*parseFloat(.4))})))}},postInitialize:async function(){var e=this;void 0!==this._experienceBase.getManager("VCXContextManager").getUrlVars().debug&&(window.onerror=function(t,i,n){var a;a=Y["Notification.Unstable"];var r={level:"error",title:Y["Notification.Crash"],message:a};e._experienceBase.getManager("VCXNotificationManager").addNotification(r)});var i=this._experienceBase.getManager("VCXContextManager");this._frmWindow=i.getFrameWindow(),this._uiLayer=this._frmWindow&&this._frmWindow.getUIFrame(),this.immersiveFrame=this._frmWindow&&this._frmWindow.getImmersiveFrame(),A._activeWindow=null,this.isTouchActivated()&&this._uiLayer.addClassName("vcxTouchMode");var s=q.GetGraphicCard(),o=null===s,l=!o&&q.isLowGraphicPresent(s),d=!1;i.getContextFromName("ExperienceIn3DPlay")&&(d=!0);if(this._experienceBase.getManager("VCXAnalyticsTrackerAppManager")&&this._experienceBase.getManager("VCXAnalyticsTrackerAppManager").trackGraphicCards(s),o||l)if(this._uiLayer.addClassName("vcxNoGraphiCard"),o){var u="Notification.NoGraphicCardDetected";q.IsFirefox()&&(u="Notification.FirefoxActivateWebGL"),this._experienceBase.getManager("VCXNotificationManager").addNotification({level:"error",title:"error",message:Y[u]})}else{var h;if(d)"true"!==(h=!!localStorage&&localStorage.getItem("DS_COMPOSER_LOW_GRAPHIC_CARD_DETECTED"))&&"1"!==h&&this._experienceBase.getManager("VCXNotificationManager").addNotification({level:"warning",title:Y["Notification.LowGraphicCardTitle"],message:Y["Notification.LowGraphicCardAction"],action:{label:Y["Notification.Confirm"],callback:function(){localStorage&&(localStorage.setItem("DS_COMPOSER_LOW_GRAPHIC_CARD_DETECTED",!0),this.getParent()&&(this.getParent().destroy(),location.reload()))}}});else"true"!==(h=!!localStorage&&localStorage.getItem("DS_COMPOSER_GUI_DONT_SHOW_AGAIN_LOW_GRAPHIC_CARD_DETECTED"))&&"1"!==h&&(console.log("Card Detected : "+s),this._experienceBase.getManager("VCXNotificationManager").addNotification({level:"warning",title:"warning",message:Y["Notification.LowGraphicCardDetected"],action:{label:Y["Notification.DontShowMeAgain"],callback:function(){localStorage&&(localStorage.setItem("DS_COMPOSER_GUI_DONT_SHOW_AGAIN_LOW_GRAPHIC_CARD_DETECTED",!0),this.getParent()&&this.getParent().destroy())}}}))}if(this._frmWindow&&this._frmWindow._sceneGraphTree&&this._frmWindow._sceneGraphTree.tree.slideOut(),this._onResizeDocking=function(t){e.updateUsableArea()},this._onResizeWidget=function(t){t.target===window&&e._onResizeWidgetCB()},window.addEventListener&&(window.addEventListener("dimensionsChanged",(t=>{e.dirtyResizeDocking=t}),!0),window.addEventListener("dockIsResizing",(t=>{e.dirtyResizeDocking=t}),!0),window.addEventListener("dockResize",(t=>{e.dirtyResizeDocking=t}),!0),window.addEventListener("resize",e._onResizeWidget,!0)),e.GetCanvasView().addClassName("vcx-canvas-view"),this._frmWindow.getContent().querySelector(".vcxMiddleContainer")){new ResizeObserver((t=>{e._onResizeDocking()})).observe(this._frmWindow.getContent().querySelector(".vcxMiddleContainer"))}!0===i.getContextFromName("ExperienceIn3DPlay")&&("275px","250px","-125px","-120px",""),this.recordActionBarEvent();var p=i.getContextFromName("PlayerMode"),m=this._experienceBase.getManager("VCXContextManager").IsLocalMode(),C="1"===this._experienceBase.getManager("VCXContextManager").getUrlVars().noSample||!m&&!p;!(!1!==i.getContextFromName("ExperienceIn3DPlay")||this._experienceBase.odt&&"record"!==this._experienceBase.odt||C)&&await new Promise((t=>{require(["DS/VCXWebDebug/VCXSampleCtrl"],(function(i){void 0===e._destroyed&&(e._vcxSampleCtrl=new i(e,c)),t()}))})),e._updateDockingAreaCB=function(t){setTimeout((function(){e.updateUsableArea()}),305)};for(var g=e.immersiveFrame&&e.immersiveFrame.dockingElements,_=0;_<g&&g.length;_++){g[_].addEventListener(n.POINTERUP,e._updateDockingAreaCB)}if(e._frmWindow&&e._frmWindow._sceneGraphTree){var b=e._frmWindow._sceneGraphTree.tree._sidePanel,v=parseFloat(b.elements.panel.style.transitionDuration);this._VCX_GUI_PANEL_SLIDE_IN=b.onSlideIn((function(){setTimeout((function(){t.publish({event:"VCX_GUI_PANEL_SLIDE_IN"})}),1e3*v)})),this._VCX_GUI_PANEL_SLIDE_OUT=b.onSlideOut((function(){setTimeout((function(){t.publish({event:"VCX_GUI_PANEL_SLIDE_OUT"})}),1e3*v)}))}var f=new a({target:e.GetCanvasView()});this._tokens._evtPreHLRemoveToken=t.subscribe({event:"VCX_PREHIGHLIGHT_REMOVE"},(function(t){f&&(f.hide(),f.tooltipInfos=void 0),e.GetCanvasView().tooltipInfos=void 0})),this._tokens._evtPreHLAddToken=t.subscribe({event:"VCX_PREHIGHLIGHT_ADD"},(function(t){if(t[0].event){if(!e._tooltipDisplay)return;var i="";if(t&&Array.isArray(t))for(var n=0;n<t.length;++n){var a=t[n]&&t[n].pathElement,s=L.GetModifiableFromPathElement(a,e._experienceBase);if(s){var o=s.GetProperty("Actor.ToolTip._ComputedText");o&&(i=o.GetPropertyValue().GetValue())}else console.log("no modifiable associated to pathElement.")}e.GetCanvasView().tooltipInfos=new r({shortHelp:i,initialDelay:"1000",reshowDelay:"0"}),f.mousePosition=t[0].event.currentPosition,f.target=e.GetCanvasView(),f.show()}})),this._tokens._VCX_COMPONENTS_CREATED=t.subscribe({event:"VCX_COMPONENTS_CREATED"},(e=>{this._createdComponents||(this._createdComponents=[]),this._createdComponents.push(...e.components)})),this._tokens._VCX_META_UI_Display=t.subscribe({event:"VCX_Meta_Display_UI"},(e=>{this._vcxGUIPartList&&this._vcxGUIPartList.buildMetaUI(e)})),this._tokens._VCX_META_UI_Hide=t.subscribe({event:"VCX_Meta_Hide_UI"},(e=>{this._vcxGUIPartList&&this._vcxGUIPartList.hideMetaUI(e)})),this._tokens._VCX_MENU_PANEL_PARTLIST=t.subscribe({event:"VCX_Menu_Panel_PartList"},(e=>{this._vcxGUIPartList&&this._vcxGUIPartList.rebuildMenuPanel(e)})),this._tokens._VCX_EditModePartList_UI_Display=t.subscribe({event:"VCX_EditMode_PartList_Display_UI"},(e=>{this._vcxGUIPartList&&this._vcxGUIPartList.buildEditModeUI({event:e})})),this._tokens._VCX_PartList_Build_Completed=t.subscribe({event:"VCX_PartList_Build_Complete_Edit_Mode"},(e=>{this._vcxGUIPartList&&this._vcxGUIPartList.buildEditModeUI({event:e})})),this._tokens._VCX_EditModePartList_UI_Hide=t.subscribe({event:"VCX_EditMode_PartList_Hide_UI"},(e=>{const i=this._experienceBase.getManager("VCXSelectionManager").GetComponentsFromSelection("CSO");let n=!0;if(i&&i.length){for(let e of i)if("VCXPartList_Spec"===e.componentType){n=!1;break}}else n=!0;if(n&&this._vcxGUIPartList){this._vcxGUIPartList.hideMetaUI();let i=!1;e&&e.toAddToSelection&&(i=e.toAddToSelection),this._vcxGUIPartList.hideEditModeUI(i),t.publish({event:"VCX_SWITCH_EDIT_SELECTION",data:{mode:2,state:!1}})}})),this._endLoadingDone=!1,this._tokens._VCX_END_LOADING_DONE=t.subscribe({event:"VCX_END_LOADING_DONE"},(function(t){e._endLoadingDone=!0}))},_onResizeWidgetCB:function(){this.updateUsableArea(),this.updateDockingElements()},getTooltipDisplay:function(e){return this._tooltipDisplay},setTooltipDisplay:function(e){"boolean"==typeof e&&(this._tooltipDisplay=e)},requestPropertiesPanelRefresh:function(){this._vcxPropertiesCtrl&&this._vcxPropertiesCtrl.requestRefresh()},update:function(e){for(;this._createdComponents&&this._createdComponents.length;){let e=this._createdComponents.pop();this._vcxWebAssemblyTreeCtrl&&this._vcxWebAssemblyTreeCtrl.getOrCreateTreeNodesModelFromComponent(e)}this._firstLoad&&(this._firstLoad=!1),this._vcxTimelineCtrl&&this._vcxTimelineCtrl.updateTimelineFromModel(),this._vcxPropertiesCtrl&&this._vcxPropertiesCtrl.update(e),this.dirtyResizeDocking&&(this._onResizeDocking(this.dirtyResizeDocking),this.dirtyResizeDocking=null),this.dirtyResizeWidget&&(this._onResizeWidget(this.dirtyResizeWidget),this.dirtyResizeWidget=null)},setAuthoringTooltipVisibility:function(e){},InitGUI:function(){if(1===this._init)return void console.log("VCXGUIManager::InitGUI has already been done");const e=F.generateUUID();this._init=1,F.memoryLog("InitGUI",!0,e);var i=this._experienceBase.getManager("VCXContextManager").getContextFromName("PlayerMode"),n=this._experienceBase.getManager("VCXContextManager").getContextFromName("ExperienceIn3DPlay"),a=(n=this._experienceBase.getManager("VCXContextManager").getContextFromName("ExperienceIn3DPlay"),this._experienceBase.getManager("VCXContextManager").isSupported("DisplayUI")),r=this._experienceBase.getManager("VCXDRMManager");const s=this._experienceBase.getManager("VCXRobotAdapter");if(s&&s.displayRobot(!1,!0),"undefined"!=typeof widget&&n&&(this.immersiveFrame.getDockingElement(WUXDockAreaEnum.RightDockArea).collapseDockingZoneFlag=!0,this.immersiveFrame.getDockingElement(WUXDockAreaEnum.LeftDockArea).collapseDockingZoneFlag=!0),0===a)return this._experienceBase.getManager("VCXContextManager").isSupported("Paper")&&(this._experienceBase.getManager("VCXContextManager").isSupported("PaperControlV2")?ee.isForceSupported("VCXNewFrame")?(this._vcxExpBarCtrl=new te,this._vcxExpBarCtrl._experienceBase=this._experienceBase,this._vcxExpBarCtrl.BuildView()):(this._vcxPaperCtrlV2=new p(this,this._experienceBase),this._vcxPaperCtrlV2._experienceBase=this._experienceBase,this._vcxPaperCtrlV2.BuildView()):(this._vcxPaperCtrl=new h(this,this._experienceBase),this._vcxPaperCtrl._experienceBase=this._experienceBase,this._vcxPaperCtrl.BuildView())),void F.memoryLog("InitGUI",!1,e);if(this._experienceBase.getManager("VCXContextManager").isSupported("DisplayUI")){var c="SequenceFolder.Scenarios",f="Sequence.CADViews",S="Sequence.CADCaptures",V="Sequence.Layers",x=[c=Y[c],(f=Y[f])+"|"+(S=Y[S]),V=Y[V]];this._experienceBase.getManager("VCXContextManager").isSupported("DisplayUIScenariosPanel")&&(this._experienceBase.getManager("VCXContextManager").isSupported("SceneControlV2")?(ee.isForceSupported("VCXNewFrame")&&(this._vcxPanelCtrl=new u(this,i),this._vcxPanelCtrl._experienceBase=this._experienceBase,this._vcxPanelCtrl.BuildView({playerMode:i}),this._vcxRatioCtrl=new m(this),this._vcxRatioCtrl._experienceBase=this._experienceBase,this._vcxRatioCtrl.BuildView()),this._vcxSceneCtrl=new l(this,x,i),this._vcxSceneCtrl._experienceBase=this._experienceBase,this._vcxSceneCtrl.BuildView({playerMode:i}),this._vcxPanelCtrl&&(this._vcxPanelCtrl.createBaseView(document.querySelector(".vcxLeftContainer")),this._vcxPanelCtrl.createButton(this._vcxRatioCtrl.getPanelView(),"Canvas","aspect-ratio",1,!0))):(this._vcxScenarioCtrl=new o(this,x,i),this._vcxScenarioCtrl._experienceBase=this._experienceBase,this._vcxScenarioCtrl.BuildView({playerMode:i}))),this._experienceBase.getManager("VCXContextManager").isSupported("DisplayUIPlay")&&(this._vcxPlayCtrl=new d(this._experienceBase),this._vcxPlayCtrl._experienceBase=this._experienceBase,this._vcxPlayCtrl.BuildView())}if(this._experienceBase.getManager("VCXContextManager").isSupported("VCXMaterialPanel")&&(this._vcxMaterialCtrl=new C(this),this._vcxMaterialCtrl._experienceBase=this._experienceBase,this._vcxMaterialCtrl.BuildView(),this._vcxPanelCtrl&&this._vcxPanelCtrl.createButton(this._vcxMaterialCtrl._viewPanel.panel,"Materials","material",4)),this._experienceBase.getManager("VCXContextManager").isSupported("VCXUIPartList")&&(this._vcxGUIPartList=new b(this._experienceBase),this._vcxGUIPartList._experienceBase=this._experienceBase,this._vcxGUIPartList.BuildView()),this._experienceBase.getManager("VCXContextManager").isSupported("VCXAmbiencePanel")&&(this._vcxAmbienceCtrl=new g(this),this._vcxAmbienceCtrl._experienceBase=this._experienceBase,this._vcxAmbienceCtrl.BuildView(),this._vcxPanelCtrl&&this._vcxPanelCtrl.createButton(this._vcxAmbienceCtrl._viewPanel.panel,"Ambiences","picture-360",5)),this._experienceBase.getManager("VCXContextManager").isSupported("VCXTreePanel")&&(this._vcxTreePanelCtrl=new _(this),this._vcxTreePanelCtrl._experienceBase=this._experienceBase,this._vcxTreePanelCtrl.BuildView()),this._experienceBase.getManager("VCXContextManager").isSupported("Paper")&&(this._experienceBase.getManager("VCXContextManager").isSupported("PaperControlV2")?ee.isForceSupported("VCXNewFrame")?(this._vcxExpBarCtrl=new te,this._vcxExpBarCtrl._experienceBase=this._experienceBase,this._vcxExpBarCtrl.BuildView()):(this._vcxPaperCtrlV2=new p(this,this._experienceBase),this._vcxPaperCtrlV2._experienceBase=this._experienceBase,this._vcxPaperCtrlV2.BuildView()):(this._vcxPaperCtrl=new h(this,this._experienceBase),this._vcxPaperCtrl._experienceBase=this._experienceBase,this._vcxPaperCtrl.BuildView())),this._experienceBase.getManager("VCXContextManager").isSupported("DisplayUI")){var I=this._experienceBase.getManager("VCXContextManager").getUrlVars().ForcePropertiesWriteMode;!1!==this._experienceBase.getManager("VCXContextManager").isSupported("DisplayUIPropertiesPanel")&&r.GetDisplayPropertiesPanel()&&(this._vcxPropertiesCtrl||(this._vcxPropertiesCtrl=new v(this,!I&&i),this._vcxPropertiesCtrl._experienceBase=this._experienceBase,this._vcxPropertiesCtrl.BuildView({playerMode:!I&&i}),this._vcxPanelCtrl&&this._vcxPanelCtrl.createButton(this._vcxPropertiesCtrl.getPanelView(),"Properties","parameters",10))),this._vcxScenarioCtrl&&(this._vcxScenarioCtrl.loadScenariosFromExperience(),this._vcxScenarioCtrl.onCurrentScenarioChanged(this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario())),this._vcxSceneCtrl&&(this._vcxSceneCtrl.loadScenariosFromExperience(),this._vcxSceneCtrl.onCurrentScenarioChanged(this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario())),this._experienceBase.getManager("VCXContextManager").isSupported("Timeline")&&this.InitTimelineCtrl(this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario(),0),this.initTreesTabFrames(),this._vcxScenarioCtrl&&this._vcxScenarioCtrl._tabPageFrame&&this._vcxScenarioCtrl._tabPageFrame._panelMaster.windowGroup&&(this._vcxScenarioCtrl._tabPageFrame._panelMaster.windowGroup.multiSelFlag=!1,this._vcxScenarioCtrl._tabPageFrame._panelMaster.windowGroup.currentWindows=[this._vcxScenarioCtrl._tabPageFrame._panelMaster]),this.immersiveFrame.getDockingElement(WUXDockAreaEnum.RightDockArea).elements.collapser.setAttribute("data-rec-id","right-dock"),this.immersiveFrame.getDockingElement(WUXDockAreaEnum.LeftDockArea).elements.collapser.setAttribute("data-rec-id","left-dock"),this.immersiveFrame.getDockingElement(WUXDockAreaEnum.TopDockArea).elements.collapser.setAttribute("data-rec-id","top-dock"),this.immersiveFrame.getDockingElement(WUXDockAreaEnum.RightDockArea).dockingZoneSize=300,this.immersiveFrame.getDockingElement(WUXDockAreaEnum.LeftDockArea).dockingZoneSize=300,this.updateDockingElements();var y=this;this._onKeydownEvent=function(e){y.onKeydownEvent(e)},addEventListener("keydown",this._onKeydownEvent)}if(R.initialize(this.immersiveFrame,this._experienceBase),F.memoryLog("InitGUI",!1,e),this._experienceBase.getManager("VCXContextManager").isSupported("SceneControlV2")){if(localStorage.getItem("wux-windows-window")&&localStorage.removeItem("wux-windows-window"),!localStorage.getItem("wux-windows-window")){let e=[];e=e.concat(["scenePanelV2","dressupPanelV2","assemblyPanelV2"]),this._vcxMaterialCtrl&&e.push("VCXMaterialPanel"),this._vcxAmbienceCtrl&&e.push("VCXAmbiencePanel"),this._vcxTreePanelCtrl&&e.push("VCXTreePanel");for(let t of e)this.immersiveFrame.windows[t]&&this._addWindowToDockingGroup(this.immersiveFrame.windows[t],4)}this._vcxSceneCtrl&&this._vcxSceneCtrl.getPanelView().ensureVisible&&this._vcxSceneCtrl.getPanelView().ensureVisible()}F.generateUUID();this._init=1;const P=F.generateUUID();F.memoryLog("initGUIEnd",!0,P),t.publish({event:"initGUIEnd",data:{}}),F.memoryLog("initGUIEnd",!1,P)},_addWindowToDockingGroup:function(e,t){let i=!1;if(this.immersiveFrame){for(const[n,a]of Object.entries(this.immersiveFrame.windows))if(e!==a&&a.currentDockArea===t){e.attachToWindow(a,WUXSnapAreaEnum.InsideArea,"after")<0?console.error("the window ",e._properties.title.value," could not be attached to ",a._properties.title.value):i=!0;break}i||(e.currentDockArea=t)}},subscribe:function(e,t){return this._modelEvent.subscribe({event:e},t)},onInitEnd:function(e){return this.subscribe("initGUIEnd",e)},onUnInitialize:function(e){return this.subscribe("unInitialize",e)},unsubscribe:function(e){this._modelEvent.unsubscribe(e)},initTreesTabFrames:function(){var e=this._experienceBase.getManager("VCXDRMManager"),t=this._experienceBase.getManager("VCXContextManager");(t.isSupported("DisplayUIAssemblyPanel")&&"0"!==t.getUrlVars().tree&&e.GetDisplayTree()||0==t.getContextFromName("PlayerMode"))&&(this._vcxWebAssemblyTabFrameCtrl=new x(this._experienceBase),this._vcxWebAssemblyTabFrameCtrl._experienceBase=this._experienceBase,this._vcxWebAssemblyTabFrameCtrl.BuildView(),this._vcxPanelCtrl&&this._vcxPanelCtrl.createButton(this._vcxWebAssemblyTabFrameCtrl.uiPanelClass.panel,"Products","3dproduct",2),this._vcxWebAssemblyTreeCtrl=new P(this._experienceBase),this._vcxWebAssemblyTreeCtrl._experienceBase=this._experienceBase,this._vcxWebAssemblyTreeCtrl.BuildView(),this._vcxWebSelectionSetsTreeCtrl=new M(this._experienceBase),this._vcxWebSelectionSetsTreeCtrl._experienceBase=this._experienceBase,this._vcxWebSelectionSetsTreeCtrl.BuildView(),this._vcxWebHotspotsTreeCtrl=new w(this._experienceBase),this._vcxWebHotspotsTreeCtrl._experienceBase=this._experienceBase,this._vcxWebHotspotsTreeCtrl.BuildView()),(t.isSupported("DisplayUIDressupsPanel")&&"0"!==t.getUrlVars().dressuptree&&e.GetDisplayTree()||0==t.getContextFromName("PlayerMode"))&&(this._vcxWebDressupTabFrameCtrl=new I(this._experienceBase),this._vcxWebDressupTabFrameCtrl._experienceBase=this._experienceBase,this._vcxWebDressupTabFrameCtrl.BuildView(),this._vcxPanelCtrl&&this._vcxPanelCtrl.createButton(this._vcxWebDressupTabFrameCtrl.uiPanelClass.panel,"Markups","media-annotation",3),this._vcxWebDressupTreeCtrl=new D(this._experienceBase),this._vcxWebDressupTreeCtrl._experienceBase=this._experienceBase,this._vcxWebDressupTreeCtrl.BuildView()),"1"==t.getUrlVars().stylestree&&(this._vcxWebStylesTabFrameCtrl=new y(this._experienceBase),this._vcxWebStylesTabFrameCtrl._experienceBase=this._experienceBase,this._vcxWebStylesTabFrameCtrl.BuildView(),this._vcxWebStylesTreeCtrl=new X(this._experienceBase),this._vcxWebStylesTreeCtrl._experienceBase=this._experienceBase,this._vcxWebStylesTreeCtrl.BuildView());var i,n=!1;if(this._vcxWebAssemblyTabFrameCtrl||this._vcxWebDressupTabFrameCtrl||!t.getContextFromName("ExperienceIn3DPlay")||t.getContextFromName("ProdHighMode")||(n=!0,this._vcxWebDressupTabFrameCtrl=new I(this._experienceBase),this._vcxWebDressupTabFrameCtrl._experienceBase=this._experienceBase,this._vcxWebDressupTabFrameCtrl.BuildView(),this._vcxWebDressupTreeCtrl=new D(this._experienceBase),this._vcxWebDressupTreeCtrl._experienceBase=this._experienceBase,this._vcxWebDressupTreeCtrl.BuildView()),t.isSupported("SceneControlV2"))i=[];else{i=[this._vcxWebAssemblyTabFrameCtrl,this._vcxWebDressupTabFrameCtrl,this._vcxScenarioCtrl],t.getContextFromName("ProdHighMode")&&(i=[this._vcxScenarioCtrl,this._vcxWebDressupTabFrameCtrl,this._vcxWebAssemblyTabFrameCtrl],this._vcxMaterialCtrl&&i.push(this._vcxMaterialCtrl),this._vcxAmbienceCtrl&&i.push(this._vcxAmbienceCtrl),this._vcxTreePanelCtrl&&i.push(this._vcxTreePanelCtrl));var a=this._vcxScenarioCtrl}a||(a=i[length-1]),this._vcxSampleCtrl&&!t.isSupported("SceneControlV2")&&i.push(this._vcxSampleCtrl),this._vcxWebStylesTabFrameCtrl&&i.push(this._vcxWebStylesTabFrameCtrl);for(var r=null,s=null,o=0;o<i.length;++o)i[o]&&(r=i[o],s&&r.getFrame().tabWith(s.getFrame()),s=r);if(a||(a=s),a&&a.getFrame()._panelMaster.windowGroup)for(var l=0;l<a.getFrame()._panelMaster.windowGroup._tab._tabContent.length;l++)if(a.getFrame()._panelMaster.windowGroup._tab._tabContent[l].content===a.getFrame()._panelMaster.elements.container){a.getFrame()._panelMaster.windowGroup._tab.value=[l];break}n&&this.unInitTreesTabFrames()},unInitTreesTabFrames:function(){this._vcxWebAssemblyTabFrameCtrl&&(this._vcxWebAssemblyTabFrameCtrl.unInitialize(),this._vcxWebAssemblyTreeCtrl&&this._vcxWebAssemblyTreeCtrl.unInitialize(),this._vcxWebSelectionSetsTreeCtrl&&this._vcxWebSelectionSetsTreeCtrl.unInitialize(),this._vcxWebHotspotsTreeCtrl&&this._vcxWebHotspotsTreeCtrl.unInitialize(),this._vcxWebAssemblyTabFrameCtrl=null,this._vcxWebAssemblyTreeCtrl=null,this._vcxWebSelectionSetsTreeCtrl=null,this._vcxWebHotspotsTreeCtrl=null),this._vcxWebDressupTabFrameCtrl&&(this._vcxWebDressupTabFrameCtrl.unInitialize(),this._vcxWebDressupTreeCtrl.unInitialize(),this._vcxWebDressupTabFrameCtrl=null,this._vcxWebDressupTreeCtrl=null),this._vcxWebStylesTabFrameCtrl&&(this._vcxWebStylesTabFrameCtrl.unInitialize(),this._vcxWebStylesTreeCtrl.unInitialize(),this._vcxWebStylesTabFrameCtrl=null,this._vcxWebStylesTreeCtrl=null)},setUpTrees:function(){if(this._vcxWebAssemblyTabFrameCtrl instanceof V)if(this._experienceBase.getManager("VCXContextManager").isSupported("SceneControlV2")&&this._vcxWebAssemblyTabFrameCtrl.uiPanelClass){let e=this._setUpTreeV2(this._vcxWebAssemblyTreeCtrl,this._vcxWebAssemblyTabFrameCtrl,1),i=this._setUpTreeV2(this._vcxWebSelectionSetsTreeCtrl,this._vcxWebAssemblyTabFrameCtrl,2),n=UWA.Element("div",{class:"vcx-container-assembly-test"}),a=UWA.Element("div",{class:"vcx-container-selectionset-test"}),r=new Z({firstElement:n,secondElement:a,defaultPlacement:0===this._experienceBase.ComponentsMap.GetComponentFromType("VCXSelectionSet_Spec").length?1:.75});r.container.addClassName("vcxcontainerdivider-assemblytree"),this._vcxWebAssemblyTabFrameCtrl.containerDivider=r,this._tokens._VCX_GROUPSELECTIONSETS_UPDATE=t.subscribe({event:"VCX_GROUPSELECTIONSETS_UPDATE"},(e=>{let t=this._experienceBase.ComponentsMap.GetComponentFromType("VCXSelectionSet_Spec").length;0===e&&1===t?r.resize(.75):1===e&&0===t&&r.resize(1)})),e.inject(n),i.inject(a),this._vcxWebAssemblyTabFrameCtrl.uiPanelClass.setPanelContent(r),this._vcxWebAssemblyTabFrameCtrl.setSubTrees([this._vcxWebAssemblyTreeCtrl,this._vcxWebSelectionSetsTreeCtrl])}else this._setUpTree(this._vcxWebAssemblyTreeCtrl,this._vcxWebAssemblyTabFrameCtrl,1),this._setUpTree(this._vcxWebSelectionSetsTreeCtrl,this._vcxWebAssemblyTabFrameCtrl,2),this._setUpTree(this._vcxWebHotspotsTreeCtrl,this._vcxWebAssemblyTabFrameCtrl,3);this._vcxWebDressupTabFrameCtrl instanceof V&&(this._experienceBase.getManager("VCXContextManager").isSupported("SceneControlV2")&&this._vcxWebDressupTabFrameCtrl.uiPanelClass?this._vcxWebDressupTabFrameCtrl.uiPanelClass.setPanelContent(this._setUpTreeV2(this._vcxWebDressupTreeCtrl,this._vcxWebDressupTabFrameCtrl,1)):this._setUpTree(this._vcxWebDressupTreeCtrl,this._vcxWebDressupTabFrameCtrl,1)),this._vcxWebStylesTabFrameCtrl instanceof V&&this._setUpTree(this._vcxWebStylesTreeCtrl,this._vcxWebStylesTabFrameCtrl,1)},_setUpTree:function(e,t,i){if(e&&!e.tree){e.setTabFrameCtrl(t),e.setSlidingViewIndex(i);var n=e.createTree();n||console.warn("Creation of "+e._type+" tree UI failed!"),n&&n.inject(t.getFrame()._slidingViews.getView(i))}},_setUpTreeV2:function(e,t,i){if(e&&!e.tree){e.setTabFrameCtrl(t),e.setSlidingViewIndex(i);var n=e.createTree();return n||console.warn("Creation of "+e._type+" tree UI failed!"),n}},ComputePositionInUI:function(e,t){return e},onKeydownEvent:function(e){},toggleStatsPanel:function(e){if(this._statsCtrl)this._statsCtrl.destroy(),delete this._statsCtrl;else{var t={};t.currentDockArea=WUXDockAreaEnum.BottomDockArea,t.immersiveFrame=this.immersiveFrame,this._statsCtrl=new f(t),this._statsCtrl._experienceBase=this._experienceBase,this._statsCtrl.BuildView(t)}},toggleTouch:function(){this._touchAvailable=!this._touchAvailable,this._vcxPaperCtrl&&(this._vcxPaperCtrl.mainPanel.parentNode.removeChild(this._vcxPaperCtrl.mainPanel),this._vcxPaperCtrl=null),this._vcxExpBarCtrl&&(this._vcxExpBarCtrl.unInitialize(),this._vcxExpBarCtrl=null),this._vcxPaperCtrlV2&&(this._vcxPaperCtrlV2.paperControlToolbar.destroy(),this._vcxPaperCtrlV2=null),this.isTouchAvailable()?this._uiLayer.addClassName("vcxTouchMode"):this._uiLayer.removeClassName("vcxTouchMode"),this._experienceBase.getManager("VCXContextManager").isSupported("Paper")&&(this._experienceBase.getManager("VCXContextManager").isSupported("PaperControlV2")?ee.isForceSupported("VCXNewFrame")?(this._vcxExpBarCtrl=new te,this._vcxExpBarCtrl._experienceBase=this._experienceBase,this._vcxExpBarCtrl.BuildView()):(this._vcxPaperCtrlV2=new p(this,this._experienceBase),this._vcxPaperCtrlV2._experienceBase=this._experienceBase,this._vcxPaperCtrlV2.BuildView()):(this._vcxPaperCtrl=new h(this,this._experienceBase),this._vcxPaperCtrl._experienceBase=this._experienceBase,this._vcxPaperCtrl.BuildView())),this.RefreshGUI()},isTouchAvailable:function(){return this._touchAvailable},isTouchActivated:function(){return q.isTouchCompliantDevice()&&this.isTouchAvailable()||this._experienceBase.getManager("VCXContextManager").isSupported("ForceTouch")},lockLoading:function(){document.body.addClassName("waiting"),document.querySelector(".moduleContent")&&(document.querySelector(".moduleContent").dataset.lockLoading="true")},islockLoading:function(){return!!document.querySelector(".moduleContent")&&"true"===document.querySelector(".moduleContent").lockLoading},unlockLoading:function(){document.querySelector(".moduleContent")&&(document.querySelector(".moduleContent").dataset.lockLoading=""),document.body.removeClassName("waiting")},RefreshGUI:function(){if(!this._init)return;const e=F.generateUUID();if(F.memoryLog("RefreshGUI",!0,e),this._vcxPaperCtrl&&this._vcxScenarioCtrl&&(this._vcxPaperCtrl._experienceBase=this._experienceBase),this._vcxPaperCtrlV2&&this._vcxScenarioCtrl&&(this._vcxPaperCtrlV2._experienceBase=this._experienceBase),this._vcxScenarioCtrl){var t=this._experienceBase.getManager("VCXContextManager").getContextFromName("PlayerMode"),i=this._experienceBase.getManager("VCXAPIManager").HasAnimation("AnimationSmgID"),n=!1;t?t&&!i&&(n=!0):n=!0,this._vcxScenarioCtrl.onCurrentScenarioChanged(this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario()),n&&1===this._experienceBase.getManager("VCXExperience").GetViewMode()&&this._vcxScenarioCtrl.setSequenceState("Animation",!1)}F.memoryLog("RefreshGUI",!1,e),this.unlockLoading()},hidePaperCtrl:function(){this._vcxPaperCtrl&&this._vcxPaperCtrl.hide(),this._vcxPaperCtrlV2&&this._vcxPaperCtrlV2.hide(),this._vcxExpBarCtrl&&this._vcxExpBarCtrl.hideView()},showPaperCtrl:function(){this._vcxPaperCtrl&&this._vcxPaperCtrl.show(),this._vcxPaperCtrlV2&&this._vcxPaperCtrlV2.show(),this._vcxExpBarCtrl&&this._vcxExpBarCtrl.showPaperCtrl()},isHiddenPaperCtrl:function(){return this._vcxPaperCtrl?this._vcxPaperCtrl.isHidden():this._vcxPaperCtrlV2?this._vcxPaperCtrlV2.isHidden():this._vcxExpBarCtrl?this._vcxExpBarCtrl.isHidden():null},RefreshPourcent:function(e){},ChangeTimePos:function(e,t){this._vcxTimelineCtrl&&this._vcxTimelineCtrl.ChangeTimePos(e,t)},InitTimelineCtrl:function(e,t){if(null!==this._vcxScenarioCtrl||null!==this._vcxSceneCtrl){var i=this._experienceBase.getManager("VCXContextManager").getContext();U.getCommandCheckHeader("VCXAutoKeyCmd",i);this._vcxTimelineCtrl&&(this._vcxTimelineCtrl.unInitialize(),this._vcxTimelineCtrl=null);var n={frmWindow:this._frmWindow,experienceBase:this._experienceBase,scenarioID:e,flattenKeys:!0};if(this._vcxTimelineCtrl=new k(n),this._vcxTimelineCtrl._experienceBase=this._experienceBase,this._vcxTimelineCtrl.BuildView(n),""!==e){var a=this._experienceBase.getManager("VCXContextManager"),r=null;a&&(r=a.getContext());var s=U.getCommandCheckHeader("VCXCameraPlayModeCmd",r),o=U.getCommandCheckHeader("VCXAutoKeyCmd",r),l=Math.round(this._experienceBase.getManager("VCXScenarioManager").GetMaxFrame(e));0===l&&(l=500);var c={frmWindow:this._frmWindow,parent:this._vcxScenarioCtrl?this._vcxScenarioCtrl.getFrame().getFooter():this._vcxSceneCtrl.getPanelView().getContent(),displayToolbar:!0,displaySlider:!0,displayPlayBack:!1,displayLoop:!0,displayBounce:!0,displayReverse:!0,displayMarkers:!0,displayCamera:!!s,displayCameraMode:this._isCameraPlayMode=!!s&&s.getState(),maxFrame:l,timelineGUI:VCXWebTimelineGUIEnum.Light,title:"Light Timeline"};if(this._vcxTimelineCtrl.createTimeline(c),!this._experienceBase.getManager("VCXContextManager").getContextFromName("PlayerMode")){var d={timelineGUI:VCXWebTimelineGUIEnum.Main,maxFrame:l,numberOfTracks:5,step_time_min:.1,scenario:this._experienceBase.getManager("VCXScenarioManager").GetScenarios()[e],propertiesTreeWidth:130},u=c;u.displayAutoKey=!!o,u.displayAutoKeyMode=this._isAutoKeyMode=!!o&&o.getState(),u.displayRemoveTracks=!0,u.parent=null,u.displaySlider=!1,u.displayPlayBack=!1,u.displayFilterOnSelection=!0,u.filterOnSelectionMode=!1;u.customButtons=[],d.toolbar=u,this._vcxTimelineCtrl.createTimeline(d)}for(var h=[],p=this._experienceBase.getManager("VCXScenarioManager").GetScenarios()[e].QueryInterface("VCXIModifiable").GetProperty("Actor.Scenario.Markers").GetPropertyValue().GetValue(),m=0;m<p.length;m++){var C={},g=p[m];if("VCXPropertyValueLink"===g.GetType()){var _=g.GetValue(),b=this._experienceBase.ComponentsMap.GetComponentFromID(_);m.toString();if(b&&b.GetName){C.name=b.GetName(),C.id=b.GetID(),C.component=b;var v=b.QueryInterface("VCXIModifiable");C.type=v.GetProperty("Actor.IsMilestone").GetPropertyValue().GetValue()?"milestone":"marker",C.frame=v.GetProperty("Actor.TimePos").GetPropertyValue().GetValue(),h.push(C)}}}this._vcxTimelineCtrl.addMarkers(h),this._vcxTimelineCtrl.setIndexValue(t)}}},deleteTimeline:function(){if(this._vcxTimelineCtrl){this._vcxTimelineCtrl.unInitialize(),this._vcxTimelineCtrl=null;var e=this._experienceBase.getManager("VCXContextManager").getContext(),t=U.getCommandCheckHeader("VCXAutoKeyCmd",e);if(t)this._experienceBase.getManager("VCXContextManager").getContextFromName("PlayerMode")||t.setState(!0);var i=U.getCommandCheckHeader("VCXCameraPlayModeCmd",e);i&&i.setState(!0)}},GoToScenarioContext:function(){this._experienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario();return!this._isPlayingGoTo},SetIsPlaying:function(){this._isPlayingGoTo=1},UnSetIsPlaying:function(){this._isPlayingGoTo=0},SetPropertiesPanelVisibility:function(e){this._vcxPropertiesCtrl._mainPanel.style.display=e?"":"none"},AddDropZone:function(){this._vcxGettingStartedUI&&this._vcxGettingStartedUI.dropZoneON()},RemoveDropZone:function(){this._vcxGettingStartedUI&&this._vcxGettingStartedUI.dropZoneOFF()},GetCanvasView:function(){let e=this._experienceBase.getManager("VCXContextManager"),t=e&&e.getMainViewer();return t&&t.div},SetCursor:function(e){var t=this.GetCanvasView();t&&t.setStyle("cursor",e)},GetCursor:function(){var e=this.GetCanvasView();if(e)return e.style.cursor;console.log("viewer.div not found !!")},GetActiveSequenceId:function(){return this._vcxScenarioCtrl?this._vcxScenarioCtrl.GetActiveSequenceId():this._vcxSceneCtrl?this._vcxSceneCtrl.GetActiveSequenceId():null},getGUIServices:function(){return N},getGettingStartedUI:function(){return this.landingPage?this.landingPage:this.landingPageAdaptator?this.landingPageAdaptator:W},getGettingStartedNode:function(){if(this._vcxGettingStartedUI)return this._vcxGettingStartedUI.getHomeNode()},SetVisibilityPlay:function(e){this._vcxPlayCtrl&&this._vcxPlayCtrl.setVisibility(e)},createTabPageFrame:function(e){return new S(e)},addDivUpdateView:function(){R.addDiv()},displaySceneNeedsUpdateModal:function(e){let i="",n=Y["SceneUpdate.DontUpdate"];switch(e){case"close":i=Y["SceneUpdate.close"];break;case"publish":i=Y["SceneUpdate.publish"],n=Y["SceneUpdate.Cancel"];break;case"save":i=Y["SceneUpdate.save"]}return new UWA.Promise(((e,a)=>{if(!this._sceneNeedsUpdate)return e(!0);var r=new E({label:Y["SceneUpdate.Update"],onClick:i=>{var n=i.dsModel,a=n.dialog,r=new B;r.on(),G.createModal(n.dialog.elements.container,r.elements.container);let s=t.subscribe({event:"VCX_SCENARIO_REPLACED"},(i=>{this._vcxScenarioCtrl&&this._vcxScenarioCtrl.hideNeedForUpdate&&this._vcxScenarioCtrl.hideNeedForUpdate(),G.removeModal(n.dialog.elements.container),t.unsubscribe(s),a.close(),e(!0)}));var o=new K(this._experienceBase,!0);this._experienceBase.getManager("VCXCommandManager").Do(o)}}),s=new E({label:n,onClick:t=>{t.dsModel.dialog.close(),e(!1)}});new T({immersiveFrame:document.querySelector(this._parentDivName),modalFlag:!0,closeButtonFlag:!1,touchMode:!0,resizableFlag:!1,movableFlag:!1,icon:"camera-refresh",title:Y["SceneUpdate.title"],content:UWA.Element("div",{class:"vcx-updateScene-modal",html:i}),buttons:{Open:r,Close:s}});this._experienceBase.odt&&r.fire("buttonclick",{ctrlKey:!1,shiftKey:!1,altKey:!1})}))},changeFormatPainterUIVisibility:function(e){this._vcxPropertiesCtrl&&this._vcxPropertiesCtrl.changeFormatPainterUIVisibility(e)},GetDocIDFromImageLoadQuery:function(){return new O(this._experienceBase).GetDocIDFromImageLoadQuery()},displayFakePropertiesForODT:function(){if(this._vcxPropertiesCtrl.displayFakePropertiesForODT)return this._vcxPropertiesCtrl.displayFakePropertiesForODT()},DisplayModalPanelInit:async function(e,t,i){if((this._experienceBase.getManager("VCXContextManager").IsLocalMode()||this._experienceBase.odt)&&!localStorage.getItem("VCX_Enable_DisplayModal"))return{};let n="";return n=t&&"3dxml"===t.type?await j.Import3dxmlModal(this._experienceBase,e,t,i):await j.createNewExperienceModal(this._experienceBase,e,t),this.getGettingStartedUI().removeCurtainFade(),n},createSaveBeforeCloseModal:function(){return j.createSaveBeforeCloseModal(this._experienceBase)},showSelectionSetChoosePanel:function(){return Q.showChoosePanel(this._experienceBase.getManager("VCXContextManager").getFrameWindow())},showSelectionSetRenamePanel:function(e){return Q.showRenamePanel(this._experienceBase.getManager("VCXContextManager").getFrameWindow(),e)},saveToMRU:async function(e){if(window.widget){let t,i=e;e||(i=await this._experienceBase.getManager("VCXEWSManager").GetCAT3DXModel().GetExperiencePhysicalID());let n={};if(widget.getValue("MRUData")){n=JSON.parse(widget.getValue("MRUData")),t=n.arrayRecentExperiences;let e=t.indexOf(i);if(-1===e){if(3===t.length){delete n[t.pop()]}t.unshift(i),n[i]=new Date}else t.splice(e,1),t.unshift(i),n[i]=new Date}else t=[i],n.arrayRecentExperiences=t,n[i]=new Date;widget.setValue("MRUData",JSON.stringify(n))}}});return Object.defineProperty(ie.prototype,"componentType",{enumerable:!0,get:function(){return"VCXGUIManager0"}}),ie}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebGUI/VCXPanelCtrl",["require","exports","DS/VCXGUIInfrastructure/VCXGUIComponentCtrl","UWA/Core","DS/Utilities/Dom","DS/Core/PointerEvents","DS/CoreEvents/Events","DS/ApplicationFrame/CommandsManager","DS/CoreEvents/Events"],(function(e,t,i,n,a,r,s,o,l){"use strict";l=__importDefault(l);return class extends i{constructor(){super(),this.buttonSystem={},this.stackingOrder=5,this.container=(0,n.createElement)()}BuildView(e){e||console.warn("No options given to build the view"),this.guiManager=this._experienceBase.getManager("VCXGUIManager"),this.container=(0,n.createElement)("div",{class:"vcx-Panel-Controller",html:""}),this.buttonSystem={};let t=(0,n.createElement)("button",{class:"vcx-panel-controller-button vcx-panel-controller-pref-button",type:"button",html:""});t.inject(this.container),t.style.order="100",a.generateIcon("cog").inject(t),t.addEventListener(r.POINTERDOWN,this.openPrefCommand.bind(this)),this.propPanelToken=s.subscribe({event:"FinalizeDressup"},(()=>{this.toggleShowPanelByName("Properties",!0)}))}unInitialize(){this.container&&this.container.destroy(),this.propPanelToken&&s.unsubscribe(this.propPanelToken),this.propPanelToken=null,this.buttonSystem={},this.stackingOrder=5}async openPrefCommand(){var e=this._experienceBase.getManager("VCXContextManager").getContext(),t=o.getCommand("VCXUserPreferencesCmd",e);await t.begin()}isPanelVisible(e){return this.buttonSystem[e].panelView.checkVisibility({checkOpacity:!0})}createBaseView(e){this.container.inject(e)}createButton(e,t,i,r,s=!1){let o=(0,n.createElement)("button",{class:"vcx-panel-controller-button",type:"button",html:""});o.inject(this.container),o.style.order=r.toString(),a.generateIcon(i).inject(o),(0,n.createElement)("div",{class:"vcx-panel-controller-button-text",html:t}).inject(o),o.dataset.panelName=t,this.buttonSystem[t]={panelView:e,button:o,isStacked:!1},s?this.toggleShowPanelByName(t,!0):this.hidePanel(t);let l=this.getPersistentInfo();l[t]&&this.toggleStackPanelByName(t,l[t]),o.addEventListener("click",this._clickManagerCallback.bind(this))}updatePersistentInfo(e,t,i){const n=JSON.parse(localStorage.getItem("vcx-panel-stacking")||"{}");i?delete n[e]:n[e]=t,localStorage.setItem("vcx-panel-stacking",JSON.stringify(n))}getPersistentInfo(){return JSON.parse(localStorage.getItem("vcx-panel-stacking")||"{}")}toggleShowPanelByName(e,t){let i=this.buttonSystem[e].panelView;if(this.buttonSystem[e].isStacked)i.checkVisibility({checkOpacity:!0})||this.showAllAvailablePanels();else{let n,a=this.getCurrentPanel();if(a&&(n=this.buttonSystem[a].panelView.style.width),!i.checkVisibility({checkOpacity:!0})||t)this.buttonSystem[e].button.classList.add("panelSelectedButton"),this.showPanel(e),this._experienceBase.getManager("VCXAnalyticsTrackerAppManager")&&this._experienceBase.getManager("VCXAnalyticsTrackerAppManager").trackSinglePanel(e),n&&(this.buttonSystem[e].panelView.style.width=n),this.showAllAvailablePanels([e]);else{this.buttonSystem[e].button.classList.remove("panelSelectedButton");for(const e in this.buttonSystem)Object.prototype.hasOwnProperty.call(this.buttonSystem,e)&&this.hidePanel(e)}}}showAllAvailablePanels(e){let t=e||[];for(const e in this.buttonSystem)if(Object.prototype.hasOwnProperty.call(this.buttonSystem,e)){const i=this.buttonSystem[e];t.includes(e)||(i.isStacked?this.showPanel(e,Number(i.panelView.style.order)):this.hidePanel(e),i.button.classList.remove("panelSelectedButton"))}}toggleStackPanelByName(e,t){if(this.buttonSystem[e].isStacked)this.buttonSystem[e].isStacked=!1,this.buttonSystem[e].button.classList.remove("vcxButtonStacked"),this.buttonSystem[e].panelView.classList.remove("vcxPanelStacked"),this.buttonSystem[e].panelView.style.order="",this.updatePersistentInfo(e,0,!0);else{if(this.getCurrentPanel()===e){let t,i=e;for(const n in this.buttonSystem)if(Object.prototype.hasOwnProperty.call(this.buttonSystem,n)&&(i=this.getNextButtonName(i),i!==e&&!this.buttonSystem[i].isStacked)){t=i;break}t?this.toggleShowPanelByName(t):this.toggleShowPanelByName(e)}for(const e in this.buttonSystem)if(Object.prototype.hasOwnProperty.call(this.buttonSystem,e)){const t=this.buttonSystem[e];t.isStacked&&this.showPanel(e,Number(t.panelView.style.order))}this.buttonSystem[e].isStacked=!0,this.buttonSystem[e].button.classList.add("vcxButtonStacked"),this.buttonSystem[e].panelView.classList.add("vcxPanelStacked"),t?(this.buttonSystem[e].panelView.style.order=t.toString(),this.stackingOrder.toString()<t.toString()&&(this.stackingOrder=t)):(this.buttonSystem[e].panelView.style.order=this.stackingOrder.toString(),this.stackingOrder++,this.updatePersistentInfo(e,this.stackingOrder)),this._experienceBase.getManager("VCXAnalyticsTrackerAppManager")&&this._experienceBase.getManager("VCXAnalyticsTrackerAppManager").trackStackingPanel(e)}}getNextButtonName(e){let t,i=this.buttonSystem[e],n=Number(i.button.style.order),a=1/0;for(const e in this.buttonSystem)if(Object.prototype.hasOwnProperty.call(this.buttonSystem,e)){const i=this.buttonSystem[e],r=Number(i.button.style.order);r>n&&r-n<a&&(a=r-n,t=e)}return t||(t=this.getFirstButtonName()),t}getFirstButtonName(){let e,t=1/0;for(const i in this.buttonSystem)if(Object.prototype.hasOwnProperty.call(this.buttonSystem,i)){const n=this.buttonSystem[i];Number(n.button.style.order)<t&&(t=Number(n.button.style.order),e=i)}return e}hidePanel(e){this.buttonSystem[e].isStacked?this.buttonSystem[e].panelView.classList.remove("vcxPanelStacked"):this.buttonSystem[e].panelView.style.display="none",l.default.publish({event:"VCXPANEL_VISIBILITY_CHANGED",data:{panelName:e,visible:!1}})}showPanel(e,t){this.buttonSystem[e].panelView.style.order=t?.toString()||"2",this.buttonSystem[e].isStacked?this.buttonSystem[e].panelView.classList.add("vcxPanelStacked"):this.buttonSystem[e].panelView.style.display="",l.default.publish({event:"VCXPANEL_VISIBILITY_CHANGED",data:{panelName:e,visible:!0}})}getCurrentPanel(){let e=document.querySelector(".panelSelectedButton"),t=e?.dataset.panelName;return t}_onClickCallback(e){e&&e.dataset.panelName&&this.toggleShowPanelByName(e.dataset.panelName)}_onDoubleClickCallback(e){e&&e.dataset.panelName&&this.toggleStackPanelByName(e.dataset.panelName)}_clickManagerCallback(e){let t=e.currentTarget;2===e.detail?(this.doubleClickTimeout&&(clearTimeout(this.doubleClickTimeout),delete this.doubleClickTimeout),this._onDoubleClickCallback(t)):this.doubleClickTimeout=setTimeout((()=>{1===e.detail&&(delete this.doubleClickTimeout,this._onClickCallback(t))}),250)}}}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebGUI/VCXSettingsPanel",["require","exports","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI","UWA/Core","DS/Controls/Toggle","DS/Controls/Label","DS/Controls/LineEditor","DS/Windows/ImmersiveFrame","DS/Controls/Button","DS/Windows/Dialog","DS/VCXWebExperienceBase/VCXContextManager"],(function(e,t,i,n,a,r,s,o,l,c,d){"use strict";i=__importDefault(i),a=__importDefault(a),r=__importDefault(r),s=__importDefault(s),o=__importDefault(o),l=__importDefault(l),c=__importDefault(c),d=__importDefault(d);class u{constructor(){this.restart=!1,this.wantrestart=!1}computePref(){this.supportFeature={};let e=this.expBase.getManager("VCXContextManager");for(let t of Object.keys(e._supportedFeatures).sort()){let e=d.default.isForceSupported(t);null!==e&&(this.supportFeature[t]=e)}this.savedsupportFeature={...this.supportFeature}}applyPref(){localStorage.setItem("VCX_ForceSupportedFeature",JSON.stringify(this.supportFeature));let e=this.expBase.getManager("VCXContextManager");for(let t of Object.keys(e._supportedFeatures).sort())localStorage.removeItem(t);for(let e of Object.keys(this.supportFeature))localStorage.setItem(e,this.supportFeature[e]);this.computePref(),this.wantrestart&&(this.restart=!0)}updatePref(e,t=null){e.replaceChildren([]);let i=this.expBase.getManager("VCXContextManager"),s=Object.keys(i._supportedFeatures).sort();t&&(s=s.filter((e=>e.toUpperCase().includes(t.toUpperCase()))));for(let t of s){let s=n.Element("div",{class:"VCXSettingsPanel-container-toggle"}),o=!!d.default.getUrlVars(t),l=new a.default({type:"switch",value:0,checkFlag:i._supportedFeatures[t]}),c=(u.list_restart.includes(t)?"(restart) ":"")+t,h=new r.default({value:c});void 0!==this.supportFeature[t]&&(h.value=c+" * ",h.emphasize="success",l.checkFlag=this.supportFeature[t]),o&&(h.value+=" (overriden by URL)"),l.inject(s),h.inject(s),l.addEventListener("change",(e=>{u.list_restart.includes(t)&&(this.wantrestart=!0),void 0===this.supportFeature[t]?(this.supportFeature[t]=e.dsModel.checkFlag,h.value=c+" * ",h.emphasize=o?"error":"highlight"):(delete this.supportFeature[t],h.value=c,void 0!==this.supportFeature[t]?h.emphasize="success":void 0!==this.savedsupportFeature[t]?h.emphasize=o?"error":"highlight":h.emphasize="secondary"),o&&(h.value+=" (overriden by URL)")})),s.inject(e)}}async showChoosePanel(e){this.expBase=e._experienceBase,this.computePref();let t=new s.default({placeholder:"Find me",autoCommitFlag:!0});await new Promise((e=>{let a=n.Element("div",{class:"VCXSettingsPanel-containerbuttons"}),r=new o.default({identifier:"WebUIPanelDocumentation_VCXSettingsPanel"});var s=new l.default({emphasize:"medium-attention",label:i.default["VCXSettingsPanel.Reset"],onClick:()=>{this.supportFeature={},this.updatePref(a,t.value)}}),d=new l.default({emphasize:"primary",label:i.default["VCXSettingsPanel.Apply"],onClick:()=>{this.applyPref(),this.updatePref(a,t.value)}}),u=new l.default({label:i.default["VCXSettingsPanel.Share"],showLabelFlag:!1,icon:{iconName:"topbar-share",fontIconFamily:WUXManagedFontIcons.Font3DS},displayStyle:"icon",onClick:()=>{var e,t={};window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,((e,i,n)=>{t[i]=decodeURIComponent(n)})),t.widgetDomain?e=t.widgetDomain:t.uwaUrl&&(e=t.uwaUrl),e||(e=window.location.href),navigator.clipboard.writeText(e+(Object.keys(this.supportFeature).length>0?"?_ForceSupportedFeature_=1"+Object.keys(this.supportFeature).map((e=>"&"+e+"="+this.supportFeature[e])):""));this.expBase.getManager("VCXNotificationManager").addNotification({level:"info",title:"Info",message:"Url copied in the clipboard"})}}),h=new l.default({label:i.default["VCXSettingsPanel.Close"],onClick:t=>{t.dsModel.dialog.close(),e([])}});let p=n.Element("div",{class:"VCXSettingsPanel-modal"});t.addEventListener("change",(()=>{this.updatePref(a,t.value)})),t.inject(p);let m=n.Element("p",{html:i.default["VCXSettingsPanel.Text"]});this.updatePref(a),m.inject(p),a.inject(p);let C=n.Element("p",{html:i.default["VCXSettingsPanel.Text2"]});u.inject(C),C.inject(p),new c.default({immersiveFrame:r,modalFlag:!0,closeButtonFlag:!1,touchMode:!0,resizableFlag:!1,movableFlag:!1,title:i.default["VCXSettingsPanel.Title"],content:p,customButtonsDefinition:[s,d,h]}).addEventListener("close",(()=>e([]))),r.inject(document.body)})),this.restart&&location.reload()}}return u.list_restart=["Debug"],new u})),define("DS/VCXWebGUI/VCXHardwareStatusUICtrl",["require","exports","DS/VCXGUIInfrastructure/VCXGUIComponentCtrl","DS/VCXWebSystem/VCXHardwareServices","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI"],(function(e,t,i,n,a){"use strict";return class extends i{constructor(){super()}postInitialize(){const e=n.GetGraphicCard(),t=null===e,i=!t&&n.isLowGraphicPresent(e);if(this._experienceBase.getManager("VCXAnalyticsTrackerAppManager")&&this._experienceBase.getManager("VCXAnalyticsTrackerAppManager").trackGraphicCards(e),t||i){const e=this._experienceBase.getManager("VCXGUIManager")._uiLayer;if(e.addClassName("vcxNoGraphiCard"),this._experienceBase.getManager("VCXGUIManager")._uiLayer=e,t){var r="Notification.NoGraphicCardDetected";n.IsFirefox()&&(r="Notification.FirefoxActivateWebGL"),this._experienceBase.getManager("VCXNotificationManager").addNotification({level:"error",title:"error",message:a[r]})}}}}})),define("DS/VCXWebGUI/VCXPartListColumnMenuPanel",["UWA/Class","DS/Menu/ContextualMenu","DS/CoreEvents/Events"],(function(e,t,i){"use strict";return e.extend({init:function(e,n,a,r,s,o,l){this._experienceBase=e,this._content?t.removeEventListener(this._content,this._uid):(this._content=new UWA.Element("div",{class:"VCXcontentMenu"}),this._content.style.position="absolute",this._content.inject(n)),this._uid=t.addEventListener(this._content,{callback:()=>{let e=[];return e.push({type:"PushItem",title:"Sorting A to Z",fonticon:{content:"wux-ui-3ds wux-ui-3ds-alpha-sorting-a-z"},action:{callback:function(){r("ascending",a)}}}),e.push({type:"PushItem",title:"Sorting Z to A",fonticon:{content:"wux-ui-3ds wux-ui-3ds-alpha-sorting-z-a"},action:{callback:function(){r("descending",a)}}}),e.push({type:"PushItem",title:"Change Property",fonticon:{content:"wux-ui-3ds wux-ui-3ds-properties-pencil"},action:{callback:function(){const e=document.getElementById("Part_List_Button_Container");e&&e.remove(),l(a),i.publish({event:"VCX_Meta_Display_UI",data:{indexColumn:a+1}})}}}),e.push({type:"PushItem",title:"Move Left",fonticon:{content:"wux-ui-3ds wux-ui-3ds-left"},action:{callback:function(){o("left",a)}}}),e.push({type:"PushItem",title:"Move Right",fonticon:{content:"wux-ui-3ds wux-ui-3ds-right"},action:{callback:function(){o("right",a)}}}),e.push({type:"PushItem",title:"Delete",fonticon:{content:"wux-ui-3ds wux-ui-3ds-trash"},action:{callback:function(){s(a)}}}),e}});if(n){var c=n.getBoundingClientRect(),d=c.bottom,u=c.right;let e=c.width;t.buildAndDisplayContextualMenu(this._content,{clientX:u-e/2,clientY:d+15})}},destroy:function(){this._content&&(this._content.destroy(),this._content=null)}})}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebGUI/VCXAccordeonPanel",["require","exports","DS/Controls/Accordeon","DS/VCXGUIInfrastructure/VCXMainPanelFixed"],(function(e,t,i,n){"use strict";n=__importDefault(n);class a extends n.default{constructor(e,t){super(e,t),this.panelAccordeon=this._buildAccordeon()}_buildAccordeon(){return new i({exclusive:!1,style:"divided",items:[]})}addExpander(e){return this.panelAccordeon.addItem(e)}getExpanderFromHeader(e){let t=this.panelAccordeon.getIndexFrom({header:e});return this.panelAccordeon.getExpanderFromIndex(t)}}return a}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebGUI/VCXGUIManager",["require","exports","DS/VCXGUIInfrastructure/VCXGUIComponentCtrl","DS/VCXWebComponents/VCXWebComponentBaseExperience","DS/VCXWebIO/VCXLogServices"],(function(e,t,i,n,a){"use strict";n=__importDefault(n);class r extends n.default{constructor(){super(),this._guiManagerUsed=null,this._uiDescription={},this._uiCallbacksComponents={},this._bGUIArchitectureV2=!1,this._proxyPropertiesList={},this._proxyPropertiesList={_vcxScenarioCtrl:"VCXScenarioCtrl",_vcxPlayCtrl:"VCXPlayCtrl",_vcxSceneCtrl:"VCXScenarioCtrl",_vcxWebAssemblyTreeCtrl:"VCXWebAssemblyTreeCtrl",_vcxWebDressupTreeCtrl:"VCXWebDressupTreeCtrl",_vcxWebStylesTreeCtrl:"VCXWebStylesTreeCtrl",_vcxPublishRasterImageCtrl:"VCXPublishRasterImageCtrl",_vcxPublishVideoCtrl:"VCXPublishVideoCtrl",_vcxPaperCtrl:"VCXPaperCtrl",_vcxPaperCtrlV2:"VCXPaperCtrl",_vcxPropertiesCtrl:"VCXPropertiesCtrl",_vcxDocManagerCtrl:"VCXDocManagerCtrl",_vcxLinkedPropCtrl:"VCXLinkedPropCtrl",_vcxSampleCtrl:"VCXSampleCtrl",_vcxPanelCtrl:"VCXPanelCtrl",_vcxMaterialCtrl:"VCXMaterialCtrl",_vcxGUIPartList:"VCXUIPartListCtrl",_vcxAmbienceCtrl:"VCXAmbienceCtrl",_vcxTreePanelCtrl:"VCXTreePanelCtrl",_vcxWebSelectionSetsTreeCtrl:"VCXWebSelectionSetsTreeCtrl",_vcxWebHotspotsTreeCtrl:"VCXWebHotspotsTreeCtrl",_vcxWebDressupTabFrameCtrl:"VCXWebDressupTabFrameCtrl",_vcxWebStylesTabFrameCtrl:"VCXWebStylesTabFrameCtrl",_vcxWebAssemblyTabFrameCtrl:"VCXWebAssemblyTabFrameCtrl",_vcxTimelineCtrl:"VCXTimelineCtrl"}}init(){}initialize(){this.SetUsedGUIManager()}postInitialize(){console.log(this._uiDescription),console.log(this._uiCallbacksComponents)}unInitialize(){}update(){}postUpdate(){}preRender(){}postRender(){}SetUsedGUIManager(){const e=this._experienceBase.getManager("VCXContextManager");this._bGUIArchitectureV2=e.isSupported("GUIArchitectureV2"),this._bGUIArchitectureV2?this._guiManagerUsed=this._experienceBase.getManager("VCXGUIManager1"):this._guiManagerUsed=this._experienceBase.getManager("VCXGUIManager0")}SetGUIAppDescription(e){this.SetUsedGUIManager(),this._bGUIArchitectureV2&&this._guiManagerUsed.SetGUIAppDescription(e)}SetGUIConditionsCallback(e){this._uiCallbacksComponents=e,this._bGUIArchitectureV2&&this._guiManagerUsed.SetGUIConditionsCallback(e)}_adaptatorGUIMethod(e,t,i){if(!this._bGUIArchitectureV2||""===e){if(t in this._guiManagerUsed&&"function"==typeof this._guiManagerUsed[t])return this._guiManagerUsed[t](...i);{const e=`[ADAPTATOR] ${t} is not found in VCXGUIManager`;return void a.log(e,a.EMessageType.Warning)}}{const n=this._guiManagerUsed.GetGUIComponentFromName(e);if(n){if(t in n&&"function"==typeof n[t])return n[t](...i);{const i=`[ADAPTATOR] ${t} is not found in GUI component ${e}`;return void a.log(i,a.EMessageType.Warning)}}a.log(`[ADAPTATOR] No GUI component is found with the following name: ${e}`,a.EMessageType.Warning)}}GetSelectedProperties(){return this._adaptatorGUIMethod("VCXPropertiesCtrl","GetSelectedProperties",[])}CopyProperties(e,t){return this._adaptatorGUIMethod("VCXPropertiesCtrl","CopyProperties",[e,t])}GetCopiedProperties(){return this._adaptatorGUIMethod("VCXPropertiesCtrl","GetCopiedProperties",[])}getUsableArea(e){return this._adaptatorGUIMethod("","getUsableArea",[e])}_getOptiUsableArea(e){return this._adaptatorGUIMethod("","_getOptiUsableArea",[e])}updateUsableArea(){return this._adaptatorGUIMethod("","updateUsableArea",[])}getUIResponsivenessParameters(e){return this._adaptatorGUIMethod("","getUIResponsivenessParameters",[e])}_getUIResponsivenessParametersArray(){return this._adaptatorGUIMethod("","_getUIResponsivenessParametersArray",[])}updateDockingElements(){return this._adaptatorGUIMethod("","updateDockingElements",[])}ComputePositionInUI(e,t){return this._adaptatorGUIMethod("","ComputePositionInUI",[e,t])}getBrandImage(){return this._adaptatorGUIMethod("VCXWelcomePageCtrl","getBrandImage",[])}setPublishAdvancedDisplay(e){return this._adaptatorGUIMethod("","setPublishAdvancedDisplay",[e])}getPublishAdvancedDisplay(){return this._adaptatorGUIMethod("","getPublishAdvancedDisplay",[])}recordActionBarEvent(){return this._adaptatorGUIMethod("VCXActionBarCtrl","recordActionBarEvent",[])}_onResizeWidgetCB(){return this._adaptatorGUIMethod("","_onResizeWidgetCB",[])}getTooltipDisplay(e){return this._adaptatorGUIMethod("","getTooltipDisplay",[e])}setTooltipDisplay(e){return this._adaptatorGUIMethod("","setTooltipDisplay",[e])}requestPropertiesPanelRefresh(){return this._adaptatorGUIMethod("","requestPropertiesPanelRefresh",[])}setAuthoringTooltipVisibility(e){return this._adaptatorGUIMethod("","setAuthoringTooltipVisibility",[e])}InitGUI(){return this._adaptatorGUIMethod("","InitGUI",[])}_addWindowToDockingGroup(e,t){return this._adaptatorGUIMethod("","_addWindowToDockingGroup",[e,t])}subscribe(e,t){return this._adaptatorGUIMethod("","subscribe",[e,t])}onInitEnd(e){return this._adaptatorGUIMethod("","onInitEnd",[e])}onUnInitialize(e){return this._adaptatorGUIMethod("","onUnInitialize",[e])}unsubscribe(e){return this._adaptatorGUIMethod("","unsubscribe",[e])}reveal3DContent(){return this._adaptatorGUIMethod("","reveal3DContent",[])}initTreesTabFrames(){return this._adaptatorGUIMethod("","initTreesTabFrames",[])}unInitTreesTabFrames(){return this._adaptatorGUIMethod("","unInitTreesTabFrames",[])}async setUpTrees(){return this._adaptatorGUIMethod("VCXWebTreesContentCtrl","setUpTrees",[])}_setUpTree(e,t,i){return this._adaptatorGUIMethod("VCXWebTreesContentCtrl","_setUpTree",[e,t,i])}_setUpTreeV2(e,t,i){return this._adaptatorGUIMethod("VCXWebTreesContentCtrl","_setUpTreeV2",[e,t,i])}onKeydownEvent(e){return this._adaptatorGUIMethod("","onKeydownEvent",[e])}toggleStatsPanel(e){return this._adaptatorGUIMethod("","toggleStatsPanel",[e])}toggleTouch(){return this._adaptatorGUIMethod("","toggleTouch",[])}isTouchAvailable(){return this._adaptatorGUIMethod("","isTouchAvailable",[])}isTouchActivated(){return this._adaptatorGUIMethod("","isTouchActivated",[])}lockLoading(){return this._adaptatorGUIMethod("","lockLoading",[])}islockLoading(){return this._adaptatorGUIMethod("","islockLoading",[])}unlockLoading(){return this._adaptatorGUIMethod("","unlockLoading",[])}RefreshGUI(){return this._adaptatorGUIMethod("","RefreshGUI",[])}hidePaperCtrl(){return this._adaptatorGUIMethod("VCXPaperCtrl","hidePaperCtrl",[])}showPaperCtrl(){return this._adaptatorGUIMethod("VCXPaperCtrl","showPaperCtrl",[])}isHiddenPaperCtrl(){return this._adaptatorGUIMethod("VCXPaperCtrl","isHiddenPaperCtrl",[])}RefreshPourcent(e){return this._adaptatorGUIMethod("","RefreshPourcent",[e])}ChangeTimePos(e,t){return this._adaptatorGUIMethod("VCXTimelineCtrl","ChangeTimePos",[e,t])}InitTimelineCtrl(e,t){return this._adaptatorGUIMethod("VCXTimelineCtrl","InitTimelineCtrl",[e,t])}deleteTimeline(){return this._adaptatorGUIMethod("VCXTimelineCtrl","deleteTimeline",[])}GoToScenarioContext(){return this._experienceBase.getManager("VCXExperience").GoToScenarioContext()}SetIsPlaying(){return this._experienceBase.getManager("VCXExperience").SetIsPlaying()}UnSetIsPlaying(){return this._experienceBase.getManager("VCXExperience").UnSetIsPlaying()}SetPropertiesPanelVisibility(e){return this._adaptatorGUIMethod("","SetPropertiesPanelVisibility",[e])}AddDropZone(){return this._adaptatorGUIMethod("VCXWelcomePageCtrl","AddDropZone",[])}RemoveDropZone(){return this._adaptatorGUIMethod("VCXWelcomePageCtrl","RemoveDropZone",[])}GetCanvasView(){return this._adaptatorGUIMethod("","GetCanvasView",[])}SetCursor(e){return this._adaptatorGUIMethod("","SetCursor",[e])}GetCursor(){return this._adaptatorGUIMethod("","GetCursor",[])}GetActiveSequenceId(){return this._adaptatorGUIMethod("VCXScenarioCtrl","GetActiveSequenceId",[])}getGUIServices(){return this._adaptatorGUIMethod("","getGUIServices",[])}getGettingStartedUI(){return this._adaptatorGUIMethod("VCXWelcomePageCtrl","getGettingStartedUI",[])}getGettingStartedNode(){return this._adaptatorGUIMethod("VCXWelcomePageCtrl","getGettingStartedNode",[])}SetVisibilityPlay(e){return this._adaptatorGUIMethod("VCXPlayCtrl","SetVisibilityPlay",[e])}createTabPageFrame(e){return this._adaptatorGUIMethod("","createTabPageFrame",[e])}addDivUpdateView(){return this._adaptatorGUIMethod("VCXUpdateCtrl","addDivUpdateView",[])}SetSceneNeedsUpdate(e){return this._adaptatorGUIMethod("VCXScenesUpdateModalCtrl","SetSceneNeedsUpdate",[e])}GetSceneNeedsUpdate(){return this._adaptatorGUIMethod("VCXScenesUpdateModalCtrl","GetSceneNeedsUpdate",[])}async displaySceneNeedsUpdateModal(e){return this._adaptatorGUIMethod("VCXScenesUpdateModalCtrl","displaySceneNeedsUpdateModal",[e])}changeFormatPainterUIVisibility(e){return this._adaptatorGUIMethod("VCXPropertiesCtrl","changeFormatPainterUIVisibility",[e])}GetDocIDFromImageLoadQuery(){return this._adaptatorGUIMethod("VCXMediaChooserCtrl","GetDocIDFromImageLoadQuery",[])}displayFakePropertiesForODT(){return this._adaptatorGUIMethod("VCXPropertiesCtrl","displayFakePropertiesForODT",[])}createSaveBeforeCloseModal(){return this._adaptatorGUIMethod("VCXWelcomePageCtrl","createSaveBeforeCloseModal",[])}showSelectionSetChoosePanel(){return this._adaptatorGUIMethod("VCXSelectionSetPanel","showSelectionSetChoosePanel",[])}showSelectionSetRenamePanel(e){return this._adaptatorGUIMethod("VCXSelectionSetPanel","showSelectionSetRenamePanel",[e])}async DisplayModalPanelInit(e,t,i){return this._adaptatorGUIMethod("VCXWelcomePageCtrl","DisplayModalPanelInit",[e,t,i])}async saveToMRU(e){return this._adaptatorGUIMethod("VCXWelcomePageCtrl","saveToMRU",[e])}get componentType(){return"VCXGUIManager"}get(e){return e in this._proxyPropertiesList?this._bGUIArchitectureV2?this._guiManagerUsed.GetGUIComponentFromName(this._proxyPropertiesList[e]):this._guiManagerUsed[e]:void a.log(`${e} is not found in the GUIManager`,a.EMessageType.Error)}set(e,t){e in this._proxyPropertiesList?this._bGUIArchitectureV2?this._guiManagerUsed.SetGUIComponentFromName(this._proxyPropertiesList[e],t):this._guiManagerUsed[e]=t:a.log(`${e} is not found in the GUIManager`,a.EMessageType.Error)}GetGUIComponentFromName(e){if(this._guiManagerUsed){if(this._bGUIArchitectureV2)return this._guiManagerUsed.GetGUIComponentFromName(e);for(let t in this._proxyPropertiesList)if(e===this._proxyPropertiesList[t])return this.get(t)}return null}SetGUIComponentFromName(e,t){if(this._guiManagerUsed)if(this._bGUIArchitectureV2)this._guiManagerUsed.SetGUIComponentFromName(e,t);else for(let i in this._proxyPropertiesList)e===this._proxyPropertiesList[i]&&this.set(i,t)}get _uiLayer(){return this._guiManagerUsed._uiLayer}set _uiLayer(e){this._guiManagerUsed&&"_uiLayer"in this._guiManagerUsed&&(this._guiManagerUsed._uiLayer=e)}get _vcxSampleCtrl(){return this.get("_vcxSampleCtrl")}get _vcxWebAssemblyTreeCtrl(){return this.get("_vcxWebAssemblyTreeCtrl")}get _vcxWebDressupTreeCtrl(){return this.get("_vcxWebDressupTreeCtrl")}get _vcxWebStylesTreeCtrl(){return this.get("_vcxWebStylesTreeCtrl")}get _vcxPublishRasterImageCtrl(){return this.get("_vcxPublishRasterImageCtrl")}get _vcxPublishVideoCtrl(){return this.get("_vcxPublishVideoCtrl")}get _vcxPaperCtrl(){return this.get("_vcxPaperCtrl")}get _vcxPaperCtrlV2(){return this.get("_vcxPaperCtrlV2")}get _vcxPropertiesCtrl(){return this.get("_vcxPropertiesCtrl")}get _vcxDocManagerCtrl(){return this.get("_vcxDocManagerCtrl")}get _vcxLinkedPropCtrl(){return this.get("_vcxLinkedPropCtrl")}get _vcxPanelCtrl(){return this.get("_vcxPanelCtrl")}get _vcxScenarioCtrl(){return this.get("_vcxScenarioCtrl")}get _vcxPlayCtrl(){return this.get("_vcxPlayCtrl")}get _vcxMaterialCtrl(){return this.get("_vcxMaterialCtrl")}get _vcxGUIPartList(){return this.get("_vcxGUIPartList")}get _vcxAmbienceCtrl(){return this.get("_vcxAmbienceCtrl")}get _vcxTreePanelCtrl(){return this.get("_vcxTreePanelCtrl")}get _vcxWebSelectionSetsTreeCtrl(){return this.get("_vcxWebSelectionSetsTreeCtrl")}get _vcxWebHotspotsTreeCtrl(){return this.get("_vcxWebHotspotsTreeCtrl")}get _vcxWebDressupTabFrameCtrl(){return this.get("_vcxWebDressupTabFrameCtrl")}get _vcxWebStylesTabFrameCtrl(){return this.get("_vcxWebStylesTabFrameCtrl")}get _vcxWebAssemblyTabFrameCtrl(){return this.get("_vcxWebAssemblyTabFrameCtrl")}get _vcxSceneCtrl(){return this.get("_vcxSceneCtrl")}get _vcxTimelineCtrl(){return this.get("_vcxTimelineCtrl")}set _vcxSampleCtrl(e){this.set("_vcxSampleCtrl",e)}set _vcxWebAssemblyTreeCtrl(e){this.set("_vcxWebAssemblyTreeCtrl",e)}set _vcxWebDressupTreeCtrl(e){this.set("_vcxWebDressupTreeCtrl",e)}set _vcxWebStylesTreeCtrl(e){this.set("_vcxWebStylesTreeCtrl",e)}set _vcxPublishRasterImageCtrl(e){this.set("_vcxPublishRasterImageCtrl",e)}set _vcxPublishVideoCtrl(e){this.set("_vcxPublishVideoCtrl",e)}set _vcxPaperCtrl(e){this.set("_vcxPaperCtrl",e)}set _vcxPaperCtrlV2(e){this.set("_vcxPaperCtrlV2",e)}set _vcxPropertiesCtrl(e){this.set("_vcxPropertiesCtrl",e)}set _vcxDocManagerCtrl(e){this.set("_vcxDocManagerCtrl",e)}set _vcxLinkedPropCtrl(e){this.set("_vcxLinkedPropCtrl",e)}set _vcxPanelCtrl(e){this.set("_vcxPanelCtrl",e)}set _vcxScenarioCtrl(e){this.set("_vcxScenarioCtrl",e)}set _vcxPlayCtrl(e){this.set("_vcxPlayCtrl",e)}set _vcxMaterialCtrl(e){this.set("_vcxMaterialCtrl",e)}set _vcxGUIPartList(e){this.set("_vcxGUIPartList",e)}set _vcxAmbienceCtrl(e){this.set("_vcxAmbienceCtrl",e)}set _vcxTreePanelCtrl(e){this.set("_vcxTreePanelCtrl",e)}set _vcxWebSelectionSetsTreeCtrl(e){this.set("_vcxWebSelectionSetsTreeCtrl",e)}set _vcxWebHotspotsTreeCtrl(e){this.set("_vcxWebHotspotsTreeCtrl",e)}set _vcxWebDressupTabFrameCtrl(e){this.set("_vcxWebDressupTabFrameCtrl",e)}set _vcxWebStylesTabFrameCtrl(e){this.set("_vcxWebStylesTabFrameCtrl",e)}set _vcxWebAssemblyTabFrameCtrl(e){this.set("_vcxWebAssemblyTabFrameCtrl",e)}set _vcxSceneCtrl(e){this.set("_vcxSceneCtrl",e)}set _vcxTimelineCtrl(e){this.set("_vcxTimelineCtrl",e)}get _isPlayingGoTo(){return this._guiManagerUsed._isPlayingGoTo}get immersiveFrame(){return this._guiManagerUsed.immersiveFrame}set immersiveFrame(e){this._guiManagerUsed.immersiveFrame=e}}return r}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebGUI/VCXPreviewThumbnailCtrl",["require","exports","DS/VCXWebGUI/VCXPlayView"],(function(e,t,i){"use strict";i=__importDefault(i);return class{constructor(e,t){t.addClassName("VCXSmallImmersiveNav"),this._experienceBase=e,this.playView=new i.default(t,{playCb:()=>this.setupPlayer(),fullScreenCb:()=>this.setupPlayer()}),this.playView.setVisibility(!0),this.playView.setAuthoringVisibility(!1),this.setupPlayer()}unInitialize(){this.playView.destroy()}updateScenarioRelatedView(){let e=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario();if(!e)return;var t=this._experienceBase.getManager("VCXSequenceManager").GetSequenceFromScenarioId(e),i=this._experienceBase.getManager("VCXSequenceManager").GetListScenariosInSequence(t,!0).map((e=>e.GetID()));this.playView.setArrowVisibility(!0,0==i.length-1),this.playView.updateGridContainer(i.length>1?i:[]),i.length<=1&&this.playView.setVisibilityPlayPause(!1),this.playView.updateActiveScenario(i[0],100)}setupPlayer(){let e=this._experienceBase.getManager("VCXPlayManager").QueryInterface("VCXIModifiable");this.playView.setVisibilityPlayPause(e.GetPropertyValue("VCXPlayManager.showPlayStopButton")),this.playView.setActiveFullScreen(!1),this.updateScenarioRelatedView(),this.playView.setVisibilityImmersiveNav(e.GetPropertyValue("VCXPlayManager.immersiveNav"))}}})),define("DS/VCXWebGUI/VCXWebTreesContentSMGCtrl",["require","exports","DS/VCXWebTreeGUI/VCXWebTabFrameCtrl","DS/VCXWebGUI/VCXWebTreesContentCtrl"],(function(e,t,i,n){"use strict";return class extends n{constructor(){super(),this._experienceBase=null}BuildView(e){console.log(e);const t=this._experienceBase.getManager("VCXGUIManager");["VCXSampleCtrl","VCXScenarioCtrl","VCXWebDressupTabFrameCtrl","VCXWebAssemblyTabFrameCtrl","VCXWebDressupTabFrameCtrl"].forEach((e=>{const i=t.GetGUIComponentFromName(e);i&&this._orderTabs.push(i)})),this._focusedTab=t.GetGUIComponentFromName("VCXScenarioCtrl"),this.reOrderTreesPanel()}setUpTrees(){const e=this._experienceBase.getManager("VCXGUIManager"),t=e.GetGUIComponentFromName("VCXWebAssemblyTabFrameCtrl"),n=e.GetGUIComponentFromName("VCXWebAssemblyTreeCtrl"),a=e.GetGUIComponentFromName("VCXWebSelectionSetsTreeCtrl"),r=e.GetGUIComponentFromName("VCXWebHotspotsTreeCtrl");t&&t instanceof i&&(this._setUpTree(n,t,1),this._setUpTree(a,t,2),this._setUpTree(r,t,3));const s=e.GetGUIComponentFromName("VCXWebDressupTabFrameCtrl"),o=e.GetGUIComponentFromName("VCXWebDressupTreeCtrl");s&&s instanceof i&&this._setUpTree(o,s,1);const l=e.GetGUIComponentFromName("VCXWebStylesTabFrameCtrl"),c=e.GetGUIComponentFromName("VCXWebStylesTreeCtrl");l&&l instanceof i&&this._setUpTree(c,l,1)}}}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebGUI/VCXExpBarCtrl",["require","exports","DS/VCXGUIInfrastructure/VCXGUIComponentCtrl","DS/ApplicationFrame/CommandsManager","DS/VCXWebGUI/VCXExpBarView","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI","DS/CoreEvents/Events"],(function(e,t,i,n,a,r,s){"use strict";a=__importDefault(a),r=__importDefault(r),s=__importDefault(s);return class extends i{constructor(){super(),this._lockupdatePaper=!1,this._zoomChangedToken=s.default.subscribe({event:"/VCX/Paper/ZoomChanged"},(e=>{e&&!e.updatePaper&&(this._lockupdatePaper=!0),this.updateZoomValue(Math.round(100*this._experienceBase.getManager("VCXPaperManager").Zoom)+"%"),this._lockupdatePaper=!1}))}BuildView(){let e=document.querySelector(".vcxTopContainer");e&&(this.expBarView=new a.default(e),this.expBarView.generateButtonsFromJson(this.getModelArray()))}unInitialize(){s.default.unsubscribe(this._zoomChangedToken),delete this._zoomChangedToken,this.expBarView?.uninitialize()}hideView(){this.expBarView?.hide()}showPaperCtrl(){this.showView()}hidePaperCtrl(){this.hideView()}showView(){this.expBarView?.show()}isHidden(){return this.expBarView?.isHidden()||!0}getModelArray(){return[{id:"homeButton",tweakerType:"button",iconName:"topbar-home",position:"near",function:this.executeCommand.bind(this,"VCXCloseExperienceCmd"),size:{width:"54px"},tooltip:{cmdId:"VCXCloseExperienceCmd",pathToHelpRsc:"VCXWebAuthoringApp/VCXWebAuthoringAppHelpForCommands"}},{tweakerType:"separator",position:"near"},{id:"saveButton",tweakerType:"activeCombobox",iconName:"floppy",position:"near",elementsList:[{label:r.default["ExpBar.VCXSaveCmd"],icon:{iconName:"floppy",fontIconSize:"22px"}},{label:r.default["ExpBar.VCXSaveAsCmd"],icon:{iconName:"floppy-add",fontIconSize:"22px"}}],size:{width:"min-content"},tooltip:{cmdId:"VCXSaveCmd",pathToHelpRsc:"VCXWebAuthoringCommands/VCXWebAuthoringCommandsHelpForCommands"},function:this.executeSave.bind(this)},{id:"undoButton",tweakerType:"button",iconName:"undo",position:"near",tooltip:{cmdId:"VCXUndoCmd",pathToHelpRsc:"VCXWebProducts/VCXWebProductsHelpForCommands"},function:this.executeCommand.bind(this,"VCXUndoCmd")},{id:"redoButton",tweakerType:"button",iconName:"redo",position:"near",tooltip:{cmdId:"VCXRedoCmd",pathToHelpRsc:"VCXWebProducts/VCXWebProductsHelpForCommands"},function:this.executeCommand.bind(this,"VCXRedoCmd")},{id:"cloud",tweakerType:"icon",iconName:"topbar-cloud",position:"center"},{id:"experienceName",value:this._experienceBase.getManager("VCXContextManager").getRootComponentName(),tweakerType:"text",position:"center"},{id:"ShowHidePaperButton",tweakerType:"checkButton",value:!0,iconName:"canvas",position:"far",function:this.showHidePaper.bind(this)},{id:"reframePaperButton",tweakerType:"button",iconName:"zoom-fit",position:"far",value:!1,function:this.reframePaper.bind(this)},{id:"panPaperButton",tweakerType:"checkButton",iconName:"arrow-double-combo",position:"far",value:!1,function:this.panPaper.bind(this)},{id:"zoomText",value:Math.round(100*this._experienceBase.getManager("VCXPaperManager").Zoom)+"%",tweakerType:"text",position:"far"},{id:"zoomCombo",tweakerType:"comboDropDown",position:"far",elementsList:["10%","20%","30%","40%","50%","60%","70%","80%","90%","100%"],size:{width:"unset"},function:this.updateZoomValue.bind(this)},{tweakerType:"separator",position:"far"},{id:"globalIlluminationButton",tweakerType:"checkButton",iconName:"3d-object-sparkle",position:"far",tooltip:{cmdId:"VCXDisplayLivePreviewRenderingCmd",pathToHelpRsc:"VCXWebAuthoringCommands/VCXWebAuthoringCommandsHelpForCommands"},function:this.executeCheckCommand.bind(this,"VCXDisplayLivePreviewRenderingCmd")},{id:"previewButton",tweakerType:"button",iconName:"compass-play",position:"far",tooltip:{cmdId:"VCXPreviewModeCmd",pathToHelpRsc:"VCXWebAuthoringCommands/VCXWebAuthoringCommandsHelpForCommands"},function:this.executeCommand.bind(this,"VCXPreviewModeCmd")},{id:"jobMonitorButton",tweakerType:"button",iconName:"picture-progress-bar",position:"far",tooltip:{cmdId:"VCXOpenJobMonitorCmd",pathToHelpRsc:"VCXWebAuthoringCommands/VCXWebAuthoringCommandsHelpForCommands"},function:this.executeCommand.bind(this,"VCXOpenJobMonitorCmd")},{tweakerType:"separator",position:"far"},{id:"publishButton",tweakerType:"button",emphasize:"primary",position:"far",displayStyle:"normal",size:{height:"24px",width:"min-content"},label:r.default["VCXPaperCtrlV2.Publish"],tooltip:{cmdId:"VCXDisplayPanelPublishMediaCmd",pathToHelpRsc:"VCXWebAuthoringCommands/VCXWebAuthoringCommandsHelpForCommands"},function:this.executeCommand.bind(this,"VCXDisplayPanelPublishMediaCmd")}]}_preExecuteCommand(){}executeCommand(e){if(this._preExecuteCommand(),""!==e){var t=null,i=this._experienceBase.getManager("VCXContextManager");i&&(t=i.getContext()),n.getCommand(e,t)&&n.getCommand(e,t).begin()}}executeSave(e){let t=r.default["ExpBar.VCXSaveCmd"],i=r.default["ExpBar.VCXSaveAsCmd"];switch(e){case t:this.executeCommand("VCXSaveCmd");break;case i:this.executeCommand("VCXSaveAsCmd")}}executeCheckCommand(e){this._preExecuteCommand();let t=this._experienceBase.getManager("VCXContextManager").getFrameWindow().getExecutionContext(),i=t&&t.getComponent("AFR_HandlerComponent"),n=i.getCheckState({id:e});""!==e&&i&&i.setCheckState({id:e,state:!n})}reframePaper(){this._experienceBase.getManager("VCXPaperManager").ToggleAutoFit(),this._experienceBase.getManager("VCXGUIManager").updateUsableArea()}showHidePaper(){let e=this._experienceBase.getManager("VCXPaperManager"),t=!e.getPaperVisibility();e.setPaperVisibility(t)}panPaper(){var e,t=n.getCommand("VisuPanViewPaper",this._experienceBase.getManager("VCXContextManager").getContext());t&&(t.isRunning()?(t.end(),this._experienceBase.getManager("VCXGUIManager").GetCanvasView()&&(this._experienceBase.getManager("VCXGUIManager").GetCanvasView().style.cursor="auto"),(e=document.getElementById("divPaperSpace"))&&e.classList.remove("paper-highlight")):(t.begin(),(e=document.getElementById("divPaperSpace"))&&e.classList.add("paper-highlight")))}updateZoomValue(e){this._experienceBase&&!this._lockupdatePaper&&(this._experienceBase.getManager("VCXPaperManager").Zoom=parseFloat(e)/100),this.expBarView?.updateZoomValue(e)}}})),define("DS/VCXWebGUI/VCXUpdateCtrl",["require","exports","DS/VCXGUIInfrastructure/VCXGUIComponentCtrl","DS/VCXWebGUI/VCXUpdateView"],(function(e,t,i,n){"use strict";return class extends i{constructor(){super()}initialize(){const e=this._experienceBase.getManager("VCXContextManager").getFrameWindow(),t=e&&e.getImmersiveFrame();n.initialize(t,this._experienceBase)}addDivUpdateView(){n.addDiv()}unInitialize(){n.unInit()}}})),define("DS/VCXWebGUI/VCXTreePanelCtrl",["require","exports","DS/Visualization/IdPath","DS/VCXGUIInfrastructure/VCXGUIComponentCtrl","DS/VCXWebGUI/VCXTreePanelView","DS/CoreEvents/Events","DS/TreeModel/TreeDocument"],(function(e,t,i,n,a,r,s){"use strict";return class extends n{constructor(){super(),this._viewPanel=null,this._events={},this._treeDocument=new s}GetIdentifier(){return"VCXTreePanel"}GetDockingInfo(){return{area:WUXDockAreaEnum.LeftDockArea,order:80}}BuildView(e){e||console.warn("No options given to build the view");const t=this._experienceBase.getManager("VCXGUIManager");this._events._evtOnAddAssetToken=r.subscribe({event:"VCX_PRODUCT_ADDED"},(e=>{const t=e&&e.product&&e.product.productIndex&&e.product.productIndex.getRootTreeNodeModel();t&&(this._treeDocument.prepareUpdate(),this._treeDocument.addRoot(t),this._treeDocument.pushUpdate())})),this._events._evtOnAddAssetToken=r.subscribe({event:"VCX_COMPONENTS_CREATED"},(async e=>{if(e&&e.components&&e.components.length&&e.product){this._treeDocument.prepareUpdate();for(let t of e.components){const i=await this.getNodeModelFromComponent(t,e.product);i&&(i.setAttribute("id",t.GetID()),i.setAttribute("local",t.GetPersistency()))}this._treeDocument.pushUpdate()}})),this._experienceBase=t._experienceBase;let i={title:"Tree",icon:"tree-table",currentDockArea:WUXDockAreaEnum.LeftDockArea,immersiveFrame:t.immersiveFrame,identifier:this.GetIdentifier(),treePanelCtrl:this};this._viewPanel=new a(i,this._experienceBase.getManager("VCXContextManager"));let n=[{id:"defaultTreeHeader",title:"Tree",default:!0,commands:[{type:"callback",icon:"eye-partial",callback:this._changeSelectionVisibility.bind(this),i18n:"VCXTreeToolbarChgSelectionVis",hidden:!1,disabled:!1}]}];this._viewPanel.generateHeaders(n),this.createViewPanel()}OnEndBuildView(){const e=this._experienceBase.getManager("VCXGUIManager").GetGUIComponentFromName("VCXPanelCtrl");e&&e.createButton(this.getPanelView(),"Tree","tree-view-leaf",10)}_changeSelectionVisibility(e){}getModelInfoFromNodeModel(e){const t={pathOfInstances:[]};let n=[],a=e;for(;a;){if(a&&a.getAttributeValue){const e=a.getAttributeValue("type"),i=a.getAttributeValue("pid");i&&("VPMInstance"===e&&t.pathOfInstances.push(i),n.push(i))}a=a.getParent()}n=n.reverse(),t.pathOfInstances=t.pathOfInstances.reverse(),t.idPath=new i(n),t.productActor=this._experienceBase.getManager("VCXCAT3DXModelManager").getProductFromPID(n[0]);let r=t.productActor?.productIndex?.getRefInstNode(n);for(t.refInstNode=r,t.actor=r?.component||r?.reference?.component;!t.actor&&r;)r=r.parent,t.actor=r?.component||r?.reference?.component;return t.id=t.actor?.GetID(),t}getNodeModelFromPID(e,t,i,n){if(!e)return null;for(let a of e)if(a?.getAttributeValue("pid")===t&&(0!==n||0===n&&i.GetID()===a?.getAttributeValue("id")))return a;return e&&1===e.length&&"VPMInstance"!==e[0]?.getAttributeValue("type")?this.getNodeModelFromPID(e[0].getChildren(),t,i,n+1):null}async getNodeModelFromComponent(e,t){let i=e.QueryInterface("W3AISGNodeHolder")?.getPathOfIDs()?.ids;if(i||(i=await(e.QueryInterface("CATI3DXOverrideAssetProperties")?.getPathOfPhysicalId()),i=[t._pid,...i]),!i)return null;let n=this._treeDocument?.getRoots(),a=null,r=0;for(let e of i)a=this.getNodeModelFromPID(n,e,t,r),r++,n=a?.getChildren();return a}async createViewPanel(){const e=this._experienceBase.getManager("VCXCAT3DXModelManager");for(const t in e.products){let i=e.products[t];const n=i&&i.productIndex&&i.productIndex.getRootTreeNodeModel();n&&(this._treeDocument.prepareUpdate(),this._treeDocument.addRoot(n),this._treeDocument.pushUpdate())}this._viewPanel?.preparePanel(this._treeDocument)}unInitialize(){if(this._viewPanel?.unInitialize(),this._viewPanel=null,this._events)for(let e in this._events)this._events.hasOwnProperty(e)&&r.unsubscribe(this._events[e])}getPanelView(){return this._viewPanel?.panel??null}}}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebGUI/ambiences/VCXAmbienceMainCtrl",["require","exports","DS/VCXGUIInfrastructure/VCXGUIComponentCtrlTS","DS/VCXWebExperienceBase/VCXContextManager","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI","DS/VCXWebGUI/ambiences/VCXAmbienceMainView","DS/VCXWebExperienceBase/VCXComponentCreationHelper","DS/VCXWebPlatform/VCXSearchServices","DS/VCXWebDragDrop/VCXDragDropServices","DS/VCXWebGUI/ambiences/VCXAmbienceCtrlServices","DS/VCXWebIO/VCXFileServices","DS/VCXWebIO/VCXPixelImage","DS/VCXWebKernel/VCXNotificationManager"],(function(e,t,i,n,a,r,s,o,l,c,d,u,h){"use strict";i=__importDefault(i),n=__importDefault(n),a=__importDefault(a),r=__importDefault(r),s=__importDefault(s),o=__importDefault(o),l=__importDefault(l),c=__importDefault(c),d=__importDefault(d),u=__importDefault(u),h=__importDefault(h);class p extends i.default{GetIdentifier(){return"VCXAmbiencePanel"}GetDockingInfo(){return{area:WUXDockAreaEnum.LeftDockArea,order:50}}constructor(){super(),this._viewPanel=null,this._ambiencePresentationCtrl=null,this._ambienceCurrentCtrl=null,this._ambienceLibraryCtrl=null,this._ambienceService=null}async initialize(){this._ambienceCurrentCtrl=await s.default.CreateComponent(this._experienceBase,"VCXAmbienceCurrentCtrl",null,!0),this._ambiencePresentationCtrl=await s.default.CreateComponent(this._experienceBase,"VCXAmbiencePresentationCtrl",null,!0),this._ambienceLibraryCtrl=await s.default.CreateComponent(this._experienceBase,"VCXAmbienceLibraryCtrl",null,!0),this._ambienceCurrentCtrl?.initialize(),this._ambiencePresentationCtrl?.initialize(),this._ambienceLibraryCtrl?.initialize()}async postInitialize(){this._ambienceService=new c.default(this),this._ambienceCurrentCtrl?.postInitialize(),this._ambiencePresentationCtrl?.postInitialize(),this._ambienceLibraryCtrl?.postInitialize()}BuildView(e){let t=n.default.isForceSupported("VCXNewFrame"),i={title:a.default["VCXAmbienceCtrl.Title"],icon:"picture-360",immersiveFrame:this._experienceBase.getManager("VCXGUIManager").immersiveFrame,identifier:this.GetIdentifier(),currentDockArea:t?WUXDockAreaEnum.LeftDockArea:void 0,minWidth:void 0};if(t&&(i.minWidth=250),!this._ambiencePresentationCtrl||!this._ambienceCurrentCtrl||!this._ambienceLibraryCtrl)throw new Error("no view");this._ambiencePresentationCtrl.BuildView(e),this._ambienceCurrentCtrl.BuildView(e),this._ambienceLibraryCtrl.BuildView(e),this._viewPanel=new r.default(i,this._experienceBase.getManager("VCXContextManager"),{ambiencePresentationView:this._ambiencePresentationCtrl._viewPanel,ambienceCurrentView:this._ambienceCurrentCtrl._viewPanel,ambienceLibraryView:this._ambienceLibraryCtrl._viewPanel},"ambiencePanel"),this.createViewPanel()}notifyPresentation(){this._viewPanel?.notifyPresentation()}update(){this._ambiencePresentationCtrl?.update(),this._ambienceCurrentCtrl?.update(),this._ambienceLibraryCtrl?.update()}createViewPanel(){let e=[{id:"defaultMaterialHeader",title:a.default["VCXAmbienceCtrl.Title"],default:!0,commands:[{type:"callback",icon:"trash",position:"far",hidden:!1,disabled:!1,i18n:a.default["VCXAmbienceCtrl.ClearAmb"],callback:()=>{let e=this.onDeleteUnusedAmbience();this._experienceBase.getManager("VCXNotificationManager").addProgressNotification({iPromise:e,strObjectName:a.default["VCXAmbienceCtrl.ClearAmb.Title"],maskDisplayAdd:h.default.FDisplayMode.LOADINGPANEL|h.default.FDisplayMode.CONSOLE,maskDisplayEnd:!0})}},{type:"callback",icon:"plus",position:"far",hidden:!1,disabled:!1,i18n:a.default["VCXAmbienceCtrl.InsertNewAmbience"],callback:async()=>{await this.onInsertNewAmbience()}}]}];this._viewPanel?.generateHeaders(e),this._viewPanel?.getPanel().addEventListener("drop",this._onDrop.bind(this))}_onDrop(e){console.log(e);let t=l.default.GetRawDataFromDragEvent(e),i=t.files?.[0];i&&(this._processFile(i),e.preventDefault(),e.stopPropagation())}async _processFile(e){let t=e.name.split(".")[1];if("hdr"===t){let t=new Blob([e],{type:"application/octet-stream"}),i=await d.default.GetBase64FromBlobObject(t);this._ambienceService?.showChangeSourcePanel({blobURL:i,comeFrom:1})}else if("png"===t||"jpeg"===t||"jpg"===t){let i=new Blob([e],{type:"image/"+("png"===t?"png":"jpeg")}),n=await d.default.GetBase64FromBlobObject(i),a=await u.default.createFrom(n),r=a._width/a._height;this._ambienceService?.showChangeSourcePanel({blobURL:n,comeFrom:2===r?1:2})}}async showChangeSourcePanel(e){return this._ambienceCurrentCtrl.showChangeSourcePanel(e)}async onInsertNewAmbience(){const e=await o.default.SearchInApp("[ds6w:type]:AmbienceEnvironment",void 0,!1);e&&e.id&&e.label&&await this._experienceBase.getManager("VCXCAT3DXModelManager").InsertAmbience(e.label,null,e.id)}isDefaultAmbience(e){return e.QueryInterface("VCXIModifiable")?.GetProperty("Ambience.DefaultAmbience").GetPropertyValue().GetValue()}async onDeleteUnusedAmbience(){const e=this._experienceBase.ComponentsMap.GetComponentFromType("AmbienceModel_Spec");for(let t of e)this.isDefaultAmbience(t)||this.isUsedAmbience(t)||this._ambienceService?.deleteAmbience(t.GetID())}isUsedAmbience(e){var t=this._experienceBase.getManager("VCXContextManager").getActiveViewport(),i=t?.QueryInterface("VCXIModifiable");let n=!1;if(i){this._experienceBase.getManager("VCXScenarioManager").SearchForVisibleComponent(i,"Viewport.ActiveAmbience",(t=>{(t&&t.property&&t.property.GetPropertyValue()&&t.property.GetPropertyValue().GetValue())===e.GetID()&&(n=!0)}))}return n}setCurrentTab(e){this._viewPanel?.setCurrentTab(e)}OnEndBuildView(){const e=this._experienceBase.getManager("VCXGUIManager").GetGUIComponentFromName("VCXPanelCtrl");e&&e.createButton(this._viewPanel?.panel,"Ambiences","picture-360",5)}unInitialize(){super.unInitialize(),this._viewPanel&&(this._viewPanel.unInitialize(),this._viewPanel=null),this._ambienceCurrentCtrl?.unInitialize(),this._ambiencePresentationCtrl?.unInitialize(),this._ambienceLibraryCtrl?.unInitialize(),this._ambienceCurrentCtrl=null,this._ambienceLibraryCtrl=null,this._ambiencePresentationCtrl=null}}return p})),define("DS/VCXWebGUI/VCXSettingsPanelCtrl",["require","exports","DS/VCXGUIInfrastructure/VCXGUIComponentCtrl","DS/VCXWebGUI/VCXSettingsPanel","UWA/Core"],(function(e,t,i,n,a){"use strict";return class extends i{constructor(){super(),this.onKeyDownBinded=this.onKeyDown.bind(this)}BuildView(){}onKeyDown(e){if(this._experienceBase.isValid){var t=a.Event.whichKey(e);"alt+ctrl+shift+o"!==t&&"ctrl+f12"!==t||n.showChoosePanel(this._experienceBase.getManager("VCXContextManager").getFrameWindow())}}initialize(){const e=this._experienceBase.getManager("VCXContextManager");["3ds.com:8176","localhost","devops"].find((t=>e.getMainURL().includes(t)))&&a.Element.addEvent.call(document,"keydown",this.onKeyDownBinded),void 0!==e.getUrlVars().debugsupported&&setTimeout((()=>n.showChoosePanel(this._experienceBase.getManager("VCXContextManager").getFrameWindow())),500)}unInitialize(){a.Element.removeEvent.call(document,"keydown",this.onKeyDownBinded)}}})),define("DS/VCXWebGUI/VCXPaperCtrl",["UWA/Class","DS/VCXGUIInfrastructure/VCXGUIComponentCtrl","DS/CoreEvents/Events","UWA/Element","DS/Core/PointerEvents","DS/Controls/Timeline","DS/ApplicationFrame/CommandsManager","DS/VCXWebGUI/VCXPaperCtrlV2","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI","DS/WebappsUtils/WebappsUtils"],(function(e,t,i,n,a,r,s,o,l,c){"use strict";return t.extend({init:function(){},BuildView:function(e){var t=this;this._vcxGuiManager=this._experienceBase.getManager("VCXGUIManager"),this._touchCompliant=t._vcxGuiManager.isTouchActivated(),this._buttonsAvailable={showPaper:!1,zoomFit:!1,pan:!1,zoom:!1,zoomSlider:!1},this._zoomFactorButtons=t._touchCompliant?2:1,this._paneHeight=t._touchCompliant?50:42,this._timelineProgress=50,this._timeoutStartHideAnimation=2e3,this._speedDisplayAnimation=200,this._speedHideAnimation=700,this._iconPaperExpander="",this._iconPaperExpanderOver="",this._iconPaperBackgroundOver="rgb(231, 241, 248)",this._animateUI={},this._zoomChangedToken=null,this._panChangedToken=null;var n=this._experienceBase.getManager("VCXContextManager");if(n){var o=n.getActionBar();o&&(t._actionBar_sectionChangeToken=o._modelEvents.subscribe({event:"EVT_SECTION_CHANGE"},(function(){t.CheckSize(o,t.mainPanel)})),t._actionBar_openToken=o._modelEvents.subscribe({event:"ACTIONBAR_OPEN"},(function(){t.CheckSize(o,t.mainPanel)})),t._actionBar_closeToken=o._modelEvents.subscribe({event:"ACTIONBAR_CLOSE"},(function(){t.CheckSize(o,t.mainPanel)}))),t.mainPanel=new UWA.Element("div",{html:"",class:"VCXPaperCtrl",styles:{height:t._paneHeight},events:{touchstart:function(){t.mainPanel.addClassName("hover")},touchend:function(){t.mainPanel.removeClassName("hover")}}}).inject(this._vcxGuiManager._uiLayer);var d="VCX_UI_Paper_Ctrl_Up",u="VCX_UI_Paper_Ctrl_Bottom";"0px"===document.querySelector('div[data-type="ui-frame-2d"]').style.bottom&&(d+="_3DPlay",u+="_3DPlay"),t.mainPanel._styleUp=d,t.mainPanel._styleBottom=u;var h="";if(h=l["PaperCtrl.DisplayPaperButton"],this.buttonShowPaper=new UWA.Element("div",{html:"",class:"vcxPaperCtrlButton wux-button-icon-fi wux-ui-3ds wux-ui-3ds-discovery-project wux-ui-3ds-lg wux-afr-cmdstarter",title:h,events:{click:function(){var e=!t._experienceBase.getManager("VCXPaperManager").getPaperVisibility();t._experienceBase.getManager("VCXPaperManager").setPaperVisibility(e),e?t.buttonShowPaper.addClassName("wux-ui-state-active"):t.buttonShowPaper.removeClassName("wux-ui-state-active")},mouseover:function(){this.style.backgroundColor=t._iconPaperBackgroundOver},mouseout:function(){this.style.backgroundColor=""}}}).inject(t.mainPanel),t._experienceBase.getManager("VCXPaperManager").getPaperVisibility()&&t.buttonShowPaper.addClassName("wux-ui-state-active"),t.buttonShowPaper.addEvent(a.POINTERDOWN,(function(){this.style.backgroundColor=t._iconPaperBackgroundOver})),t.buttonShowPaper.addEvent(a.POINTERUP,(function(){this.style.backgroundColor=""})),this._buttonsAvailable.showPaper=!0,t._touchCompliant){var p=n.getContext(),m=(n.getMainViewer(),s.getCommand("VisuPanViewPaper",p));m&&(n.isSupported("DisplayPaperCtrlBtns")&&(h="",h=l["PaperCtrl.PanPaperButton"],t.buttonPan=new UWA.Element("div",{html:"",class:"vcxPaperCtrlButton wux-button-icon-fi wux-ui-3ds wux-ui-3ds-arrow-double-combo wux-ui-3ds-lg wux-afr-cmdstarter",title:h,events:{click:function(){m&&(m.isRunning()?(m.end(),t.buttonPan.removeClassName("wux-ui-state-active")):(m.begin(),t.buttonPan.addClassName("wux-ui-state-active")))},mouseover:function(){this.style.backgroundColor=t._iconPaperBackgroundOver},mouseout:function(){this.style.backgroundColor=""}}}).inject(t.mainPanel),t.buttonPan.addEvent(a.POINTERDOWN,(function(){this.style.backgroundColor=t._iconPaperBackgroundOver})),t.buttonPan.addEvent(a.POINTERUP,(function(){this.style.backgroundColor=""})),this._buttonsAvailable.pan=!0),m.onBegin((function(){t.buttonPan&&!t.buttonPan.classList.contains("wux-ui-state-active")&&t.buttonPan.addClassName("wux-ui-state-active")})),m.onPause((function(e){m.end()})),m.onEnd((function(){t.buttonPan&&t.buttonPan.removeClassName("wux-ui-state-active")})))}h="",h=l["PaperCtrl.FitPaperButton"],this.buttonZoomFit=new UWA.Element("div",{html:"",class:"vcxPaperCtrlButton wux-button-icon-fi wux-ui-3ds wux-ui-3ds-zoom-fit wux-ui-3ds-lg wux-afr-cmdstarter",title:h,events:{click:function(){t._experienceBase.getManager("VCXPaperManager").ToggleAutoFit()?t.buttonZoomFit.addClassName("wux-ui-state-active"):t.buttonZoomFit.removeClassName("wux-ui-state-active"),t._vcxGuiManager.updateUsableArea()},mouseover:function(){this.style.backgroundColor=t._iconPaperBackgroundOver},mouseout:function(){this.style.backgroundColor=""}}}).inject(t.mainPanel),t._experienceBase.getManager("VCXPaperManager")._autoFit&&t.buttonZoomFit.addClassName("wux-ui-state-active"),t.buttonZoomFit.addEvent(a.POINTERDOWN,(function(){this.style.backgroundColor=t._iconPaperBackgroundOver})),t.buttonZoomFit.addEvent(a.POINTERUP,(function(){this.style.backgroundColor=""})),this._buttonsAvailable.zoomFit=!0,n.isSupported("DisplayPaperCtrlBtns")||(this.buttonZoomFit.style.visibility="hidden"),h="",h=l["PaperCtrl.ZoomMinusButton"],t.buttonZoomMinus=t.createButton("wux-ui-3ds wux-ui-3ds-minus","url("+t._iconPaperZoomMinus+")",h),t.buttonZoomMinus.inject(t.mainPanel),t.AddEvents(t.buttonZoomMinus,"Minus",t,-1),h="",h=l["PaperCtrl.ZoomPlusButton"],t.buttonZoomPlus=t.createButton("wux-ui-3ds wux-ui-3ds-plus","url("+t._iconPaperZoomPlus+")",h),t.buttonZoomPlus.inject(t.mainPanel),t.AddEvents(t.buttonZoomPlus,"Plus",t,1),this._buttonsAvailable.zoom=!0,n.isSupported("DisplayPaperCtrlBtns")||(this.buttonZoomPlus.style.visibility="hidden",this.buttonZoomMinus.style.visibility="hidden"),this._vcxGuiManager.isTouchActivated()||(this._timelineDiv=new UWA.Element("div",{html:"",class:"VCXPaperCtrlTimelineDiv",styles:{}}).inject(t.mainPanel),this._timeline=new r({minValue:0,maxValue:100,value:this._timelineProgress,dynamicGraduations:!1,dynamicGaugeColor:!1,graduationsLabel:!1,graduations:0,eventsList:[{label:"100",value:100,onEvent:function(){}}],activeGraduationsColor:"#3CF",inactiveGraduationsColor:"#CCC"}),this._timeline.elements.container.style.margin="initial",this._timeline.inject(t._timelineDiv),this._buttonExpander=new UWA.Element("div",{html:"",class:"VCXPaperCtrlTimelineArrow",styles:{backgroundImage:"url("+t._iconPaperExpander+")"}}),this._buttonExpander.inject(this.mainPanel),document.querySelectorAll(".wux-Gauge-scale",".VCXPaperCtrlTimelineDiv")[0].style.opacity=0,this.UpdatePercentage(this),this._timeline.addEvent("change",(function(){t._timelineProgress=t._timeline.getValue(),t.UpdatePercentage(t,0)})),this._buttonsAvailable.zoomSlider=!0,n.isSupported("DisplayPaperCtrlBtns")||(this._timelineDiv.style.visibility="hidden",this._buttonExpander.style.visibility="hidden")),this._checkSizeCB=this.checksizeFct.bind(this),window.addEventListener&&(window.addEventListener("expand",this._checkSizeCB,!0),window.addEventListener("collapse",this._checkSizeCB,!0),window.addEventListener("dockIsResizing",this._checkSizeCB,!0),window.addEventListener("dockResize",this._checkSizeCB,!0)),this._buttonsAvailable.zoomSlider&&(t._iconPaperExpander=c.getWebappsAssetUrl("VCXWebSMGApp","icons/32/expanderBigLeftArrow.png"),t._iconPaperExpanderOver=c.getWebappsAssetUrl("VCXWebSMGApp","icons/32/expanderBigLeftArrowOver.png"),t._buttonExpander.style.backgroundImage="url("+t._iconPaperExpander+")"),this._zoomChangedToken=i.subscribe({event:"/VCX/Paper/ZoomChanged"},(function(e){e&&t.buttonZoomFit&&(e.autoFit?t.buttonZoomFit.addClassName("wux-ui-state-active"):t.buttonZoomFit.removeClassName("wux-ui-state-active")),e&&!e.updatePaper&&(t._lockupdatePaper=!0),t.SetZoomFactor(e),t._lockupdatePaper=!1})),this._panChangedToken=i.subscribe({event:"/VCX/Paper/PanChanged"},(function(e){e&&t.buttonZoomFit&&(e.autoFit?t.buttonZoomFit.addClassName("wux-ui-state-active"):t.buttonZoomFit.removeClassName("wux-ui-state-active"))}))}else console.log("No ContextManager found, paperCtrl initialization aborted..")},checksizeFct:function(){var e=this._experienceBase&&this._experienceBase.getManager("VCXContextManager").getActionBar();this.CheckSize(e,this.mainPanel)},updateUsableArea:function(){if(this._experienceBase){const e=this._experienceBase.getManager("VCXGUIManager"),t=e._getOptiUsableArea(e.getUsableArea());e._getOptiUsableArea(e.getUsableArea(!0));this.updatePaperArea(t)}},unInitialize:function(){this._zoomChangedToken&&(i.unsubscribe(this._zoomChangedToken),this._zoomChangedToken=null),this._panChangedToken&&(i.unsubscribe(this._panChangedToken),this._panChangedToken=null);var e=this._experienceBase&&this._experienceBase.getManager("VCXContextManager").getActionBar();e&&(this._actionBar_sectionChangeToken&&e._modelEvents.unsubscribe(this._actionBar_sectionChangeToken),this._actionBar_openToken&&(e._modelEvents.unsubscribe(this._actionBar_openToken),this._actionBar_openToken=null),this._actionBar_closeToken&&(e._modelEvents.unsubscribe(this._actionBar_closeToken),this._actionBar_closeToken=null),e=null),this.buttonZoomFit&&(this.buttonZoomFit.removeEvent(a.POINTERDOWN),this.buttonZoomFit.removeEvent(a.POINTERUP)),this.buttonShowPaper&&(this.buttonShowPaper.removeEvent(a.POINTERDOWN),this.buttonShowPaper.removeEvent(a.POINTERUP)),this.buttonPan&&(this.buttonPan.removeEvent(a.POINTERDOWN),this.buttonPan.removeEvent(a.POINTERUP)),this.RemoveEvents(this.buttonZoomMinus),this.RemoveEvents(this.buttonZoomPlus),this._timeline&&this._timeline.removeEvent("change"),window.addEventListener&&(window.removeEventListener("expand",this._checkSizeCB,!0),window.removeEventListener("collapse",this._checkSizeCB,!0),window.removeEventListener("dockIsResizing",this._checkSizeCB,!0),window.removeEventListener("dockResize",this._checkSizeCB,!0)),this._checkSizeCB=null,this.mainPanel&&this.mainPanel.parentNode&&this.mainPanel.parentNode.removeChild(this.mainPanel),this.mainPanel=null},createButton:function(e,t,i){return new UWA.Element("div",{html:"",class:e+" vcxPaperCtrlButton wux-button-icon-fi wux-ui-3ds-lg wux-afr-cmdstarter",title:i})},AddEvents:function(e,t,i,n){var a=this;e._useTouch=!1,e.addEvent("touchstart",(function(){e.style.backgroundColor=a._iconPaperBackgroundOver,e._useTouch=!0;var t=e;return t.delta=5*n,i.UpdateSlider(i,t.delta,!1),t.delta+=5*n,t.waitPressTimer=window.setTimeout((function(){t.pressTimer=window.setInterval((function(){i.UpdateSlider(i,t.delta,!1),t.delta+=5*n}),100)}),300),!1})),e.addEvent("mouseover",(function(){if(e._useTouch)return!1;e.style.backgroundColor=a._iconPaperBackgroundOver})),e.addEvent("mousemove",(function(){})),e.addEvent("mouseup",(function(){if(!0===e._useTouch)return!1;window.clearTimeout(e.waitPressTimer),window.clearInterval(e.pressTimer),e.style.backgroundColor=""})),e.addEvent("mousedown",(function(){if(!0===e._useTouch)return!1;var t=e;return t.delta=5*n,e.style.backgroundColor=a._iconPaperBackgroundOver,i.UpdateSlider(i,t.delta,!1),t.waitPressTimer=window.setTimeout((function(){t.pressTimer=window.setInterval((function(){i.UpdateSlider(i,t.delta,!1),t.delta+=5*n}),100)}),300),!1})),e.addEvent("touchend",(function(){window.clearTimeout(e.waitPressTimer),window.clearInterval(e.pressTimer),e.style.backgroundColor=""})),e.addEvent("mouseout",(function(){e._useTouch=!1,window.clearTimeout(e.waitPressTimer),window.clearInterval(e.pressTimer),e.style.backgroundColor=""}))},RemoveEvents:function(e){e.removeEvent("touchstart"),e.removeEvent("mouseover"),e.removeEvent("mousemove"),e.removeEvent("mouseup"),e.removeEvent("mousedown"),e.removeEvent("touchend"),e.removeEvent("mouseout")},UpdatePercentage:function(e){if("number"==typeof e._timelineProgress){e._timelineProgress;var t=0;t=e._timelineProgress<=49?90/49*e._timelineProgress+10:e._timelineProgress>=51?6*e._timelineProgress-200:100,e.zoomPaper=t/100,null===e._experienceBase||e._lockupdatePaper||(e._experienceBase.getManager("VCXPaperManager").Zoom=e.zoomPaper),e._timeline&&(e._timeline.elements.container.children[2].children[0].children[0].innerHTML=Math.floor(t)+" %")}},UpdateSlider:function(e,t,i){if("number"==typeof e._timelineProgress){var n=0;n=e._timelineProgress<=49?90/49*e._timelineProgress+10:e._timelineProgress>=51?6*e._timelineProgress-200:100,i?n=t:n+=t,e.zoomPaper=n/100,e._timelineProgress=n<=99?(n-10)/(90/49):n>=101?(n+200)/6:50,e._timelineProgress=Math.max(0,Math.min(100,e._timelineProgress)),e._timeline?e._timeline.setValue(e._timelineProgress):e.UpdatePercentage(e)}},CheckSize:function(e,t){if(1!==document.querySelectorAll("div.wux-ui-state-close").length){var i=0;if(e.elements.sectionsBar)i=e.elements.sectionsBar.getDimensions().outerWidth+50;else{var n=e.elements.container.childNodes[0].childNodes[2];n&&(i=n.getBoundingClientRect().left)}var a=t&&t.getBoundingClientRect().width;this._touchCompliant||i-parseInt(a)<0||0==e._isShownWhenLarge&&0==e._isShownWhenSmall?(t.classList.contains(t._styleBottom)&&t.classList.remove(t._styleBottom),!t.classList.contains(t._styleUp)&&t.classList.add(t._styleUp)):(t.classList.contains(t._styleUp)&&t.classList.remove(t._styleUp),!t.classList.contains(t._styleBottom)&&t.classList.add(t._styleBottom))}else t.classList.add(t._styleBottom)},SetZoomFactor:function(e){this.UpdateSlider(this,100*e.value,!0)},updatePaperArea:function(e){this.mainPanel.style.left=e.left+"px"},hidePaperCtrl:function(){this.hide()},showPaperCtrl(){this.show()},isHiddenPaperCtrl(){return this.isHidden()},hide:function(){this.mainPanel.hide()},show:function(){this.mainPanel.show()},isHidden:function(){return this.mainPanel&&"none"===this.mainPanel.style.display}})}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebGUI/VCXCameraPanelCtrl",["require","exports","DS/VCXGUIInfrastructure/VCXGUIComponentCtrl","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI","DS/VCXWebGUI/VCXCameraPanelView","DS/VCXGUIInfrastructure/VCXPropertiesGUIService","DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCmdApplyTo","i18n!DS/VCXWebKernel/assets/nls/VCXWebKernel","DS/VCXWebModifiables/VCXPropertiesObserver"],(function(e,t,i,n,a,r,s,o,l,c){"use strict";n=__importDefault(n),a=__importDefault(a),r=__importDefault(r),s=__importDefault(s),o=__importDefault(o),l=__importDefault(l),c=__importDefault(c);return class extends i{constructor(){super(),this._propertyObserverViewpoint=new c.default,this.updateLock=!1}BuildView(){this.propertiesService=new r.default(this._experienceBase);let e={title:n.default["VCXCamera.PanelTitle"],icon:"",immersiveFrame:this._experienceBase.getManager("VCXGUIManager").immersiveFrame,currentDockArea:WUXDockAreaEnum.LeftDockArea,identifier:"CameraPanel",minWidth:250};this.panelView=new a.default(e,this._experienceBase.getManager("VCXContextManager").getContext());let t=[{id:"defaultCameraHeader",title:n.default["VCXCamera.PanelTitle"],default:!0,commands:[],specialButtons:[{id:"vcxApplyTo",type:"contextualMenuButton",icon:"propagate",commandList:[{commandID:"vcxApplyToAll",label:l.default["Cmd.ApplyTo.All"],icon:"select-all-checkboxes",executeCallback:()=>{const e=o.default.checkSelectionContext(this._experienceBase,{scenariosFilter:"all",dressups:[this.cameraModifiable.GetObject()]}),t=new o.default(this._experienceBase,e);this._experienceBase.getManager("VCXCommandManager").Push(t)}},{commandID:"vcxApplyToSelected",label:l.default["Cmd.ApplyTo.Selected"],icon:"select-on",executeCallback:()=>{const e=o.default.checkSelectionContext(this._experienceBase,{scenariosFilter:"selected",dressups:[this.cameraModifiable.GetObject()]}),t=new o.default(this._experienceBase,e);this._experienceBase.getManager("VCXCommandManager").Push(t)},stateCheckingCallback:()=>o.default.checkSelectionContext(this._experienceBase,{scenariosFilter:"selected",dressups:[this.cameraModifiable.GetObject()]}).availability}],i18n:l.default["Cmd.ApplyTo"],hidden:this.playerMode}]}];this.panelView.generateHeaders(t),this.init();let i=this.getPanelView();i&&this.propertiesService.subscribePropertyEvents(i,{preEditCB:this.onPreEditCb.bind(this),postEditCB:this.onPostEditCb.bind(this),cancelEditCB:this.onCancelEditCb.bind(this),changeCB:this.onChangeCb.bind(this)})}OnEndBuildView(){const e=this._experienceBase.getManager("VCXGUIManager").GetGUIComponentFromName("VCXPanelCtrl");e&&e.createButton(this.getPanelView(),"Camera","videocamera",6)}init(){this.event_VCX_END_LOADING_DONE=s.default.subscribe({event:"VCX_END_LOADING_DONE"},(()=>{this.instanciatePanel();let e=this._experienceBase.ComponentsMap.GetComponentFromType("VCXViewpoint_Spec")[0];this.propertiesService?.setLastSelection([e]),this._propertyObserverViewpoint.addAll(e),this._propertyObserverViewpoint.add(e,"Camera.DOF.Blur")}))}update(){}lateUpdate(){this._propertyObserverViewpoint.update(),this._propertyObserverViewpoint.isDirty()&&this.onPropertiesChanged(),this._propertyObserverViewpoint.reset()}instanciatePanel(){let e=this._experienceBase.ComponentsMap.GetComponentFromType("VCXViewpoint_Spec");if(1!==e.length)return void console.error("Multiple viewpointsfound, cannot compute modifiable for camera");this.cameraModifiable=e[0].QueryInterface("VCXIModifiable");let t=this.propertiesService?.BuildIntersectionPropertyGroups([e[0]]),i=t?.getOrderedPropertyGroupsArray();var n={};for(var a in i){var r=i[a];this.propertiesService?.getGroupUIInformation(r,n,e)}this.propertiesService&&this.panelView?.buildPanelContent(n,this.propertiesService)}onPropertiesChanged(){!this.cameraModifiable||this.updateLock||this.propertiesService?.getModificationStatus()||(this.updateLock=!0,this.propertiesService?.updatePanel([this.cameraModifiable.GetObject()],this.panelView),this.updateLock=!1)}async onPreEditCb(e){this.updateLock=!0,await(this.propertiesService?._onPreEdit(e))}async onPostEditCb(e){this.updateLock=!1,await(this.propertiesService?._onPostEdit(e)),this.onPropertiesChanged()}async onCancelEditCb(e){this.updateLock=!1,await(this.propertiesService?._onCancelEdit(e)),this.onPropertiesChanged()}async onChangeCb(e){this.updateLock||await(this.propertiesService?._onChange(e))}unInitialize(){let e=this.getPanelView();e&&this.propertiesService?.unsubscribePropertyEvents(e),this.panelView?.unInitialize(),s.default.unsubscribe(this.event_VCX_END_LOADING_DONE),this.event_VCX_END_LOADING_DONE=null}getPanelView(){return this.panelView?.panel??null}}}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebGUI/VCXMaterialChooserCtrl",["require","exports","DS/VCXGUIInfrastructure/VCXGUIComponentCtrl","DS/VCXWebGUI/VCXMaterialChooserModal"],(function(e,t,i,n){"use strict";n=__importDefault(n);return class extends i{constructor(){super(),this._view=null}ReBuildView(e,t){const i=this._experienceBase.getManager("VCXContextManager");this._view=new n.default(i.getFrameWindow().getImmersiveFrame(),t,e)}DestroyView(){this._view?.Destroy()}unInitialize(){}}}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebGUI/VCXPlayCtrl",["require","exports","DS/CoreEvents/Events","UWA/Core","DS/VCXGUIInfrastructure/VCXGUIComponentCtrl","DS/VCXWebSystem/VCXScreenFullTools","DS/VCXWebGUI/VCXPlayView"],(function(e,t,i,n,a,r,s){"use strict";s=__importDefault(s);return class extends a{constructor(){super(),this.playView=null,this.tokens={},this._currentPlayPauseStatus=!1,this.blockScenarioUpdate=!1,this.isVisible=!1}BuildView(e){e||console.warn("No options given to build the view");let t=document.querySelector(".Content[data-type=modal-dialog]");t||(t=document.querySelector(".Content[data-type=ui-frame-2d]")),this.playView=new s.default(t,{closeCallBack:this.onCloseCb.bind(this),canvasActiveCb:this.onCanvasCb.bind(this),immersiveNavActiveCb:this.onImmersiveNavCb.bind(this),fullScreenCb:this.onFullScreenCb.bind(this),playCb:this.setPlayPauseStatus.bind(this),onPlaySceneCb:this.onPlaySceneCb.bind(this),onHoverCb:this.onHoverCb.bind(this)}),this.setVisibility(!1),this.tokenEventFullscreen=this.onFullScreenCbEvent.bind(this),r.on("change",this.tokenEventFullscreen),this._currentPlayPauseStatus=!1,this.tokens.VCX_BEGIN_TRANSITION=i.subscribe({event:"VCX_BEGIN_TRANSITION"},(e=>{if(!e||!e.scenario)return;let t=e.scenario;this._currentPlayPauseStatus||this.blockScenarioUpdate||this.playView?.updateActiveScenario(t.GetID(),80),this._currentPlayPauseStatus&&!this.blockScenarioUpdate&&this.playView?.updateActiveScenario(t.GetID(),60)})),this.tokens.VCX_END_TRANSITION=i.subscribe({event:"VCX_END_TRANSITION"},(e=>{e&&(this.updateScenarioRelatedView(),this._currentPlayPauseStatus||this.blockScenarioUpdate||this.playView?.updateActiveScenario(e.GetID(),100))})),this.tokens.VCX_ARROW_INPUT=i.subscribe({event:"VCX_ARROW_INPUT"},(e=>{if("previewPlay"===e.context.vcxAppContext){if(!this.isVisible)return;let t=e.key;"right"!==t&&"down"!==t||this.onPlaySceneCb(null,!0,!1),"left"!==t&&"up"!==t||this.onPlaySceneCb(null,!1,!1)}})),this.tokens.VCX_SPACE_INPUT=i.subscribe({event:"VCX_SPACE_INPUT"},(e=>{"previewPlay"===e.vcxAppContext&&(this._currentPlayPauseStatus?this.setPlayPauseStatus(!1):this.setPlayPauseStatus(!0),this._currentPlayPauseStatus?(this.setPlayPauseStatus(!0),this.playView?.setPlayStatus(!0)):(this.setPlayPauseStatus(!1),this.playView?.setPlayStatus(!1)))}))}updatePaperArea(e,t){if(!this.isVisible)return;let i=this.playView?.getHeaderSize();i-=2,e&&(e.top+=i,e.height-=i),t&&(t.top+=i,t.height-=i)}onCloseCb(){r.isFullscreen&&this.onFullScreenCb(!1),this._experienceBase.getManager("VCXUserInputControllerManager").setInnerAppContext(void 0),i.publish({event:"VCX_PREVIEW_CLOSE"})}onCanvasCb(e){this._experienceBase.getManager("VCXPaperManager").setPaperVisibility(e),this._experienceBase.getManager("VCXPlayManager").saveProperty("VCXPlayManager.showCanvas",e)}onImmersiveNavCb(e){this._experienceBase.getManager("VCXPlayManager").saveProperty("VCXPlayManager.immersiveNav",e)}async onFullScreenCbEvent(){r.isFullscreen||this.onFullScreenCb(!1)}async onFullScreenCb(e){e?(r.isFullscreen||(await r.request(),await this._experienceBase.getManager("VCXExperience").waitLoops(5)),this._experienceBase.getManager("VCXGUIManager").updateUsableArea()):(r.isFullscreen&&(await r.exit(),await this._experienceBase.getManager("VCXExperience").waitLoops(5)),this._experienceBase.getManager("VCXGUIManager").updateUsableArea(),this.playView?.setActiveFullScreen(!1))}onHoverCb(e){let t=this._experienceBase.getManager("VCXScenarioManager").GetScenarios()[e];if(!t)return null;let i=t.GetDocId(),n=this._experienceBase.getManager("VCXDocManager").GetPropPath(i);return n?n.GetValueURL().GetValue():null}SetVisibilityPlay(e){this.setVisibility(e)}updateScenarioRelatedView(){let e=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario();if(!e)return;var t=this._experienceBase.getManager("VCXSequenceManager").GetSequenceFromScenarioId(e),i=this._experienceBase.getManager("VCXSequenceManager").GetListScenariosInSequence(t,!0).map((e=>e.GetID()));let n=i.indexOf(e);this.playView?.setArrowVisibility(0===i.length||0===n,0===i.length||n===i.length-1),this.playView?.updateGridContainer(i.length>1?i:[]),i.length<=1&&(this.playView?.setVisibilityPlayPause(!1),this.setPlayPauseStatus(!1))}async onPlaySceneCb(e,t,n=!0){var a=this._experienceBase.getManager("VCXScenarioManager");if(a._scenariosToPlay.VCX_Scenario_Transition){await a.StopPlayingScenario("VCX_Scenario_Transition"),i.publish({event:"VCX_SCENARIO_PLAY_END_REACHED",data:"VCX_Scenario_Transition"});var r=this._experienceBase.getManager("VCXExperience");await r.getAllActorsReadiness()}let s=a.GetCurrentScenario();var o=this._experienceBase.getManager("VCXSequenceManager").GetSequenceFromScenarioId(s),l=this._experienceBase.getManager("VCXSequenceManager").GetListScenariosInSequence(o,!0).map((e=>e.GetID()));let c=null;if(e)l.includes(e)&&(c=e,this.playView?.createHoverImage(null,e));else{let e=l.indexOf(s);-1===e?(console.warn("current scene is not available in the play mode"),e=0):e+=t?1:-1,n?c=l[(e+l.length)%l.length]:(t&&e<l.length||!t&&e>=0)&&(c=l[e])}c&&this.OpenScenario(c)}forceScenarioPourcent(e,t){this.playView?.updateActiveScenario(e,t,!0),this.blockScenarioUpdate=!0}unBlockScenario(){this.blockScenarioUpdate=!1}setPlayPauseStatus(e){if(this._currentPlayPauseStatus=e,this.tokens.event_VCX_SCENARIO_CHANGED&&(i.unsubscribe(this.tokens.event_VCX_SCENARIO_CHANGED),delete this.tokens.event_VCX_SCENARIO_CHANGED),this.tokens.event_onViewpointEndMove&&(i.unsubscribe(this.tokens.event_onViewpointEndMove),delete this.tokens.event_onViewpointEndMove),this._currentPlaytimer&&(clearTimeout(this._currentPlaytimer),this._currentPlaytimer=null),this._currentPlayPauseStatus){this.tokens.event_VCX_SCENARIO_CHANGED=i.subscribe({event:"VCX_CURRENT_SCENARIO_CHANGED"},this.gotoNextScenarioTimed.bind(this)),this.tokens.event_onViewpointEndMove=i.subscribe({event:"/VISU/"},(e=>{e&&"@onViewpointEndMove"===e.eventType&&"controller"===e.from&&this.gotoNextScenarioTimed(),e&&"@onViewpointBeginMove"===e.eventType&&"controller"===e.from&&this.clearNextScenarioTimed()}));let e=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario();this.playView?.updateActiveScenario(e,0),this._currentPlaytimer=setTimeout((()=>{this.onPlaySceneCb(e,!0)}),2e3)}}clearNextScenarioTimed(){this._currentPlaytimer&&(clearTimeout(this._currentPlaytimer),this._currentPlaytimer=null);let e=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario();this.playView?.updateActiveScenario(e,0)}gotoNextScenarioTimed(){this.clearNextScenarioTimed();let e=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario();this.playView?.updateActiveScenario(e,100),this._currentPlaytimer=setTimeout((()=>{this.onPlaySceneCb(null,!0)}),2e3)}async OpenScenario(e){if(""!==e){var t=this._experienceBase.getManager("VCXScenarioManager").GetScenarios()[e];this._experienceBase.getManager("VCXAPIManager").GoToScenario(t.GetID())}}setVisibility(e){this.setPlayPauseStatus(!1),this.playView?.setVisibility(e),this.isVisible=e}unInitialize(){this.playView?.destroy(),this.tokenEventFullscreen&&r.off("change",this.tokenEventFullscreen);for(let e of Object.keys(this.tokens))i.unsubscribe(this.tokens[e])}setupPlayer(){let e=this._experienceBase.getManager("VCXPlayManager").QueryInterface("VCXIModifiable");e.GetPropertyValue("VCXPlayManager.autoPlay")&&(this.setPlayPauseStatus(!0),this.playView?.setPlayStatus(!0)),this.playView?.setVisibilityPlayPause(e.GetPropertyValue("VCXPlayManager.showPlayStopButton")),this.playView?.setVisibilityImmersiveNav(e.GetPropertyValue("VCXPlayManager.immersiveNav")),this.playView?.setActiveButtonCanvas(this._experienceBase.getManager("VCXPaperManager").getPaperVisibility()),this.updateScenarioRelatedView(),this._experienceBase.getManager("VCXUserInputControllerManager").setInnerAppContext("previewPlay")}setAuthoringVisibility(e){this.playView?.setAuthoringVisibility(e)}}})),define("DS/VCXWebGUI/VCXWebTreesContentProdHighlightCtrl",["require","exports","DS/VCXWebTreeGUI/VCXWebTabFrameCtrl","DS/VCXWebGUIInfra/VCXContainerDivider","DS/CoreEvents/Events","DS/VCXWebGUI/VCXWebTreesContentCtrl","UWA/Core"],(function(e,t,i,n,a,r,s){"use strict";return class extends r{constructor(){super(),this._experienceBase=null,this._tokens={}}BuildView(e){console.log(e)}setUpTrees(){const e=this._experienceBase.getManager("VCXGUIManager"),t=e.GetGUIComponentFromName("VCXWebAssemblyTabFrameCtrl"),r=e.GetGUIComponentFromName("VCXWebAssemblyTreeCtrl"),o=e.GetGUIComponentFromName("VCXWebSelectionSetsTreeCtrl");if(t&&t instanceof i){let e=this._setUpTreeV2(r,t,1),i=this._setUpTreeV2(o,t,2),l=s.Element("div",{class:"vcx-container-assembly-test"}),c=s.Element("div",{class:"vcx-container-selectionset-test"}),d=new n({firstElement:l,secondElement:c,defaultPlacement:0===this._experienceBase.ComponentsMap.GetComponentFromType("VCXSelectionSet_Spec").length?1:.75});d.container.addClassName("vcxcontainerdivider-assemblytree"),t.containerDivider=d,this._tokens._VCX_GROUPSELECTIONSETS_UPDATE=a.subscribe({event:"VCX_GROUPSELECTIONSETS_UPDATE"},(e=>{0===e.previous&&1===e.actual?d.resize(.75):1===e.previous&&0===e.actual&&d.resize(1)})),e.inject(l),i.inject(c),t.uiPanelClass.setPanelContent(d),t.setSubTrees([r,o])}const l=e.GetGUIComponentFromName("VCXWebDressupTabFrameCtrl"),c=e.GetGUIComponentFromName("VCXWebDressupTreeCtrl");l&&l instanceof i&&l.uiPanelClass.setPanelContent(this._setUpTreeV2(c,l,1));const d=e.GetGUIComponentFromName("VCXWebStylesTabFrameCtrl"),u=e.GetGUIComponentFromName("VCXWebStylesTreeCtrl");d&&d instanceof i&&this._setUpTree(u,d,1)}unInitialize(){if(this._tokens)for(var e in this._tokens)this._tokens.hasOwnProperty(e)&&a.unsubscribe(this._tokens[e])}}})),define("DS/VCXWebGUI/VCXSelectionSetOptionsChooserCtrl",["require","exports","DS/VCXGUIInfrastructure/VCXGUIComponentCtrl","DS/VCXWebGUI/VCXSelectionSetPanel"],(function(e,t,i,n){"use strict";return class extends i{constructor(){super()}showSelectionSetChoosePanel(){return n.showChoosePanel(this._experienceBase.getManager("VCXContextManager").getFrameWindow())}showSelectionSetRenamePanel(e){return n.showRenamePanel(this._experienceBase.getManager("VCXContextManager").getFrameWindow(),e)}}}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebGUI/VCXGUIManager1",["require","exports","DS/VCXGUIInfrastructure/VCXGUIComponentCtrl","DS/CoreEvents/ModelEvents","DS/CoreEvents/Events","DS/Windows/WindowManager","DS/VCXWebGUI/VCXGUIServices","DS/Controls/Tooltip","DS/VCXWebVisu/VCXModifiablesAccess","DS/Core/PointerEvents","DS/VCXWebGUI/VCXGettingStartedUI","DS/VCXGUIInfrastructure/VCXTabPageFrame","DS/Visualization/ThreeJS_DS","DS/VCXWebSystem/VCXHardwareServices","DS/VCXWebComponents/VCXWebComponentBaseExperience","DS/VCXWebIO/VCXLogServices","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI","DS/VCXWebExperienceBase/VCXContextManager","DS/Core/TooltipModel"],(function(e,t,i,n,a,r,s,o,l,c,d,u,h,p,m,C,g,_,b){"use strict";m=__importDefault(m),_=__importDefault(_),b=__importDefault(b);class v extends m.default{constructor(){super(),this._guiComponents={},this._uiDescription=[],this._uiCallbacks={},this._frmWindow=null,this._uiLayer=null,this._touchAvailable=!0,this._tooltipDisplay=!1,this._tokens={},this._init=0,this._previousViewportWidth=0,this._deltaAcc=0,this.immersiveFrame=null}init(){}_decideAddRemoveComponent(e){let t=v.DynamicComponentStatus.ADDED;return this._guiComponents.hasOwnProperty(e)?t=this._uiCallbacks.hasOwnProperty(e)&&this._uiCallbacks[e].callback?this._uiCallbacks[e].callback()?v.DynamicComponentStatus.NEUTRAL:v.DynamicComponentStatus.REMOVED:v.DynamicComponentStatus.NEUTRAL:this._uiCallbacks.hasOwnProperty(e)&&this._uiCallbacks[e].callback&&(t=this._uiCallbacks[e].callback()?v.DynamicComponentStatus.ADDED:v.DynamicComponentStatus.NEUTRAL),t}_dynamicAddBuildRemoveMissingComponents(e){const t=this._decideAddRemoveComponent(e);if(t===v.DynamicComponentStatus.ADDED){const t=this._experienceBase.Factory.BuildComponent(e);t?this._guiComponents[e]=t:console.error(`The component ${e} has not been built`)}else t===v.DynamicComponentStatus.REMOVED&&delete this._guiComponents[e]}async initialize(){this._guiComponents={};for(let e of this._uiDescription)this._dynamicAddBuildRemoveMissingComponents(e);const e=this._experienceBase.getManager("VCXContextManager");this._frmWindow=null,this._uiLayer=null,this.immersiveFrame=null,this._touchAvailable=!0,this._tooltipDisplay="true"!==e.getUrlVars().DeactivateTooltipsAtStart,this.isTouchActivated()&&(this._tooltipDisplay=!1),this._tokens={},this._init=0;for(let e in this._guiComponents)this._guiComponents[e]&&this._guiComponents[e].initialize&&await this._guiComponents[e].initialize()}async postInitialize(){void 0!==this._experienceBase.getManager("VCXContextManager").getUrlVars().debug&&(window.onerror=()=>{var e;e=g["Notification.Unstable"];var t={level:"error",title:g["Notification.Crash"],message:e};this._experienceBase.getManager("VCXNotificationManager").addNotification(t)});const e=this._experienceBase.getManager("VCXContextManager");this._frmWindow=e.getFrameWindow(),this._uiLayer=this._frmWindow&&this._frmWindow.getUIFrame(),this._uiLayer.setAttribute("data-vcxContext","UILayer"),this.immersiveFrame=this._frmWindow&&this._frmWindow.getImmersiveFrame(),r._activeWindow=null,this.isTouchActivated()&&this._uiLayer.addClassName("vcxTouchMode"),window.addEventListener&&(window.addEventListener("dimensionsChanged",this._onResizeDocking.bind(this),!0),window.addEventListener("dockIsResizing",this._onResizeDocking.bind(this),!0),window.addEventListener("dockResize",this._onResizeDocking.bind(this),!0),window.addEventListener("resize",this._onResizeWidget.bind(this),!0));for(var t=this.immersiveFrame&&this.immersiveFrame.dockingElements,i=0;i<t&&t.length;i++){t[i].addEventListener(c.POINTERUP,this._updateDockingAreaCB.bind(this))}for(let e of this._uiDescription)this._dynamicAddBuildRemoveMissingComponents(e);for(let e in this._guiComponents)this._guiComponents[e]&&this._guiComponents[e].postInitialize&&await this._guiComponents[e].postInitialize();if(this._frmWindow.getContent().querySelector(".vcxMiddleContainer")){new ResizeObserver((e=>{this._onResizeDocking()})).observe(this._frmWindow.getContent().querySelector(".vcxMiddleContainer"))}const n=new o({target:this.GetCanvasView()});this._tokens._evtPreHLRemoveToken=a.subscribe({event:"VCX_PREHIGHLIGHT_REMOVE"},(()=>{n&&(n.hide(),n.tooltipInfos=void 0),this.GetCanvasView().tooltipInfos=void 0})),this._tokens._evtPreHLAddToken=a.subscribe({event:"VCX_PREHIGHLIGHT_ADD"},(e=>{if(e[0].event){if(!this._tooltipDisplay)return;let s="";if(e&&Array.isArray(e))for(var t=0;t<e.length;++t){var i=e[t]&&e[t].pathElement,a=l.GetModifiableFromPathElement(i,this._experienceBase);if(a){var r=a.GetProperty("Actor.ToolTip._ComputedText");r&&(s=r.GetPropertyValue().GetValue())}else console.log("no modifiable associated to pathElement.")}this.GetCanvasView().tooltipInfos=new b.default({shortHelp:s,initialDelay:1e3,reshowDelay:0});const o=this.ComputePositionInUI(e[0].event.currentPosition,{useRatio:!1,isInsideCanvas:!0});n.mousePosition=new h.Vector2(o.x,o.y),n.target=this.GetCanvasView(),n.show()}}))}async unInitialize(){for(let e of this._uiDescription)this._dynamicAddBuildRemoveMissingComponents(e);for(let e in this._guiComponents)this._guiComponents[e]&&this._guiComponents[e].unInitialize&&await this._guiComponents[e].unInitialize();for(var e in this._tokens)this.unsubscribe(e);if(window.removeEventListener&&(window.removeEventListener("dimensionsChanged",this._onResizeDocking.bind(this),!0),window.removeEventListener("dockIsResizing",this._onResizeDocking.bind(this),!0),window.removeEventListener("dockResize",this._onResizeDocking.bind(this),!0),window.removeEventListener("resize",this._onResizeWidget.bind(this),!0)),this.immersiveFrame)for(var t=this.immersiveFrame.dockingElements,i=0;i<t.length;i++){t[i].removeEventListener(c.POINTERUP,this._updateDockingAreaCB.bind(this))}}preRender(e){for(let t in this._guiComponents)this._guiComponents[t]&&this._guiComponents[t].preRender&&this._guiComponents[t].preRender(e)}update(e){for(let t in this._guiComponents)this._guiComponents[t]&&this._guiComponents[t].update&&this._guiComponents[t].update(e);if(this._deltaAcc+=e.deltaTime,this._deltaAcc>500){for(let t in this._guiComponents)this._guiComponents[t]&&this._guiComponents[t].lateUpdate&&this._guiComponents[t].lateUpdate(e);this._deltaAcc=0}}postUpdate(e){for(let t in this._guiComponents)this._guiComponents[t]&&this._guiComponents[t].postUpdate&&this._guiComponents[t].postUpdate(e)}onInitEnd(e){this.subscribe("initGUIEnd",e)}onUnInitialize(e){this.subscribe("unInitialize",e)}onInitBegin(){return 1===this._init?(console.log("VCXGUIManager::InitGUI has already been done"),!1):(this._init=1,!0)}InitGUI(){if(!this.onInitBegin())return;const e=C.generateUUID();C.memoryLog("InitGUI",!0,e);const t=this._experienceBase.getManager("VCXContextManager").getPlayerMode();for(let e of this._uiDescription)this._dynamicAddBuildRemoveMissingComponents(e);for(let e in this._guiComponents)this._guiComponents[e]&&this._guiComponents[e].BuildView&&this._guiComponents[e].BuildView({playerMode:t});for(let e in this._guiComponents)this._guiComponents[e]&&this._guiComponents[e].OnEndBuildView&&this._guiComponents[e].OnEndBuildView();var i=this._experienceBase.getManager("VCXContextManager").getMainViewer();i?.getRobot()&&(i.getRobot().setVisibility(!1),i.setReferenceAxisSystem(!0)),this.immersiveFrame.getDockingElement(WUXDockAreaEnum.RightDockArea).elements.collapser.setAttribute("data-rec-id","right-dock"),this.immersiveFrame.getDockingElement(WUXDockAreaEnum.LeftDockArea).elements.collapser.setAttribute("data-rec-id","left-dock"),this.immersiveFrame.getDockingElement(WUXDockAreaEnum.TopDockArea).elements.collapser.setAttribute("data-rec-id","top-dock"),this.immersiveFrame.getDockingElement(WUXDockAreaEnum.RightDockArea).dockingZoneSize=300,this.immersiveFrame.getDockingElement(WUXDockAreaEnum.LeftDockArea).dockingZoneSize=300,localStorage.getItem("wux-windows-window")&&localStorage.removeItem("wux-windows-window");let n={};n[WUXDockAreaEnum.RightDockArea]=[],n[WUXDockAreaEnum.LeftDockArea]=[],n[WUXDockAreaEnum.TopDockArea]=[],n[WUXDockAreaEnum.BottomDockArea]=[];for(let e in this._guiComponents){const t=this._guiComponents[e];if(t){const e=t.GetDockingInfo();if(e&&null!==e.area&&n.hasOwnProperty(e.area)){let i=t.GetIdentifier();i&&n[e.area].push({identifier:i,order:e.order??100,component:t})}}}for(let e in n){n[e].sort(((e,t)=>e.order-t.order));for(let t of n[e])this.immersiveFrame.windows[t.identifier]&&this._addWindowToDockingGroup(this.immersiveFrame.windows[t.identifier],parseInt(e))}for(let e in this._guiComponents)this._guiComponents[e]&&this._guiComponents[e].EnsureVisible&&this._guiComponents[e].EnsureVisible();this.updateDockingElements(),C.memoryLog("InitGUI",!1,e);const r=C.generateUUID();return C.memoryLog("initGUIEnd",!0,r),a.publish({event:"initGUIEnd",data:{}}),C.memoryLog("initGUIEnd",!1,r),0}RefreshGUI(){if(!this._init)return;const e=C.generateUUID();C.memoryLog("RefreshGUI",!0,e);for(let e of this._uiDescription)this._dynamicAddBuildRemoveMissingComponents(e);for(let e in this._guiComponents)this._guiComponents[e]&&this._guiComponents[e].RefreshView&&this._guiComponents[e].RefreshView();C.memoryLog("RefreshGUI",!1,e)}subscribe(e,t){this._tokens[e]=a.subscribe({event:e},t)}unsubscribe(e){this._tokens.hasOwnProperty(e)&&a.unsubscribe(this._tokens[e])}_onResizeDocking(){this.updateUsableArea()}_onResizeWidget(e){e.target===window&&this._onResizeWidgetCB()}_onResizeWidgetCB(){this.updateUsableArea(),this.updateDockingElements()}getTooltipDisplay(){return this._tooltipDisplay}setTooltipDisplay(e){this._tooltipDisplay=e}_updateDockingAreaCB(){setTimeout((()=>{this.updateUsableArea()}),305)}get componentType(){return"VCXGUIManager1"}lockLoading(){document.body.addClassName("waiting"),document.querySelector(".moduleContent")&&(document.querySelector(".moduleContent").dataset.lockLoading="true")}unlockLoading(){document.querySelector(".moduleContent")&&(document.querySelector(".moduleContent").dataset.lockLoading=""),document.body.removeClassName("waiting")}islockLoading(){return!!document.querySelector(".moduleContent")&&"true"===document.querySelector(".moduleContent").lockLoading}_addWindowToDockingGroup(e,t){let i=!1;if(this.immersiveFrame){for(const[,n]of Object.entries(this.immersiveFrame.windows))if(e!==n&&n.currentDockArea===t){e.attachToWindow(n,WUXSnapAreaEnum.InsideArea,"after")<0?console.error("the window ",e._properties.title.value," could not be attached to ",n._properties.title.value):i=!0;break}i||(e.currentDockArea=t)}}_getOptiUsableArea(e){var t=this._experienceBase.getManager("VCXContextManager")?.getMainViewer()?.div;const i=t&&t.getBoundingClientRect();if(!e||!i)return;let n={};const a=e.getBoundingClientRect();n.left=a.left-i.left,n.top=a.top-i.top,n.right=i.right-a.right,n.bottom=a.bottom,n.width=a.width,n.height=a.height;return n.left+=5,n.top+=5,n.right-=5,n.width-=10,n.bottom-=5,n.height-=10,n}getUsableArea(e){if(!this._experienceBase.getManager("VCXContextManager").isSupported("Paper"))return this.GetCanvasView();if(this._experienceBase.getManager("VCXContextManager").IsWAFR()){if(_.default.isForceSupported("VCXNewFrame"))return document.querySelector(".vcxMiddleContainer");var t=".wux-windows-docking-element-free-zone.wux-docking-element-right.wux-windows-immersive-frame-freeZone";return"boolean"==typeof e&&e&&(t=".wux-windows-docking-element-free-zone.wux-docking-element-bottom"),document.querySelector(t)}t="wux-windows-docking-element-free-zone wux-docking-element-bottom";"boolean"==typeof e&&e&&(t="wux-controls-abstract wux-windows-immersive-frame");let i=document.querySelector('.wux-afr-framewindow-uiframe[datatype="UI-Frame"]');return i?.getElementsByClassName(t)[0]}updateUsableArea(){const e=this._getOptiUsableArea(this.getUsableArea(!1)),t=this._getOptiUsableArea(this.getUsableArea(!0));if(e&&t){for(let i in this._guiComponents)this._guiComponents[i]&&this._guiComponents[i].updatePaperArea&&this._guiComponents[i].updatePaperArea(e,t);if(this._experienceBase.getManager("VCXContextManager").getUrlVars().optimViewportPaper){let t=this.GetCanvasView();t&&(t.style.position="absolute",t.style.left=e.left+"px",t.style.right=e.right+"px",t.style.top=e.top+"px",t.style.bottom=e.bottom+"px")}a.publish({event:"VCX_GUI_USABLEAREA_UPDATE",data:{area:e,areaWithoutPanels:t}})}}getUIResponsivenessParameters(e){var t=this._getUIResponsivenessParametersArray();if(!t)return null;for(var i=0;i<t.length;++i){var n=t[i];if(e<=n.viewportMax&&e>n.viewportMin)return n}}_getUIResponsivenessParametersArray(){return[{viewportMin:0,viewportMax:880,panelMinWidth:250,hidePanels:!0,fitBetweenPanels:!1},{viewportMin:880,viewportMax:1080,panelMinWidth:250,hidePanels:!1,fitBetweenPanels:!1},{viewportMin:1080,viewportMax:1/0,panelMinWidth:300,hidePanels:!1,fitBetweenPanels:!0}]}updateDockingElements(){if(this.immersiveFrame){var e=[],t=this.immersiveFrame.getDockingElement(WUXDockAreaEnum.RightDockArea);t&&e.push(t);var i=this.immersiveFrame.getDockingElement(WUXDockAreaEnum.LeftDockArea);i&&e.push(i);for(var n=this._getUIResponsivenessParametersArray(),a=document.body.clientWidth,r=!1,s=!this._previousViewportWidth,o=0;o<n.length;++o){var l=n[o];if(!r&&a<=l.viewportMax&&a>l.viewportMin&&(r=!0,!0),!s&&this._previousViewportWidth&&this._previousViewportWidth<=l.viewportMax&&this._previousViewportWidth>l.viewportMin&&(s=!0),r&&s)break}if(r&&s){var c=this._experienceBase.getManager("VCXContextManager");c.isSupported("PropAndScnPanelExpandOverride")&&(c.isSupported("ScenarioPanelExpand")?e[1].collapseDockingZoneFlag=!1:e[1].collapseDockingZoneFlag=!0,c.isSupported("PropertiesPanelExpand")?e[0].collapseDockingZoneFlag=!1:e[0].collapseDockingZoneFlag=!0),this._previousViewportWidth=a}else console.warn("Something went wrong: we didn't get all infos")}}GetCanvasView(){let e=this._experienceBase.getManager("VCXContextManager"),t=e&&e.getMainViewer();return t&&t.div}SetCursor(e){const t=this.GetCanvasView();t&&t.setStyle("cursor",e)}GetCursor(){var e=this.GetCanvasView();return e?e.style.cursor:(console.log("viewer.div not found !!"),null)}ComputePositionInUI(e,t){const i=this.GetCanvasView();if(i){let n={};const a=i.getBoundingClientRect().left,r=i.getBoundingClientRect().top;let s=1;return t&&(s=t.useRatio?window.devicePixelRatio:1),e.x&&(t&&t.isInsideCanvas?n.x=(e.x+a)*s:n.x=(e.x-a)*s),e.y&&(t&&t.isInsideCanvas?n.y=(e.y+r)*s:n.y=(e.y-r)*s),null!=n.x&&(n.x=n.x+window.scrollX),null!=n.y&&(n.y=n.y+window.scrollY),n}return C.log("Immersive Frame is not found",C.EMessageType.Warning),e}getGUIServices(){return s}GetGUIComponentFromName(e){return this._guiComponents?this._guiComponents.hasOwnProperty(e)?this._guiComponents[e]:null:(console.warn("[GUI Manager] No gui components has been added !"),null)}SetGUIComponentFromName(e,t){return this._guiComponents?(this._guiComponents[e]=t,t):(console.warn("[GUI Manager] No gui components has been added !"),null)}SetGUIAppDescription(e){e&&(this._uiDescription=e)}SetGUIConditionsCallback(e){e&&(this._uiCallbacks=e)}GetUIDescription(){return this._uiDescription}isTouchAvailable(){return this._touchAvailable}isTouchActivated(){return p.isTouchCompliantDevice()&&this.isTouchAvailable()||this._experienceBase.getManager("VCXContextManager").isSupported("ForceTouch")}get uiLayer(){return this._uiLayer}set uiLayer(e){this._uiLayer=e}setPublishAdvancedDisplay(e){return e}getPublishAdvancedDisplay(){return!1}setAuthoringTooltipVisibility(e){return e}initTreesTabFrames(){}unInitTreesTabFrames(){}onKeydownEvent(e){}toggleStatsPanel(e){}toggleTouch(){}RefreshPourcent(){}ChangeTimePos(e){}InitTimelineCtrl(e,t){}deleteTimeline(){}SetPropertiesPanelVisibility(e){}createTabPageFrame(e){return new u(e)}}return function(e){let t;!function(e){e[e.ADDED=0]="ADDED",e[e.REMOVED=1]="REMOVED",e[e.NEUTRAL=2]="NEUTRAL"}(t=e.DynamicComponentStatus||(e.DynamicComponentStatus={}))}(v||(v={})),v})),define("DS/VCXWebGUI/VCXWelcomePageCtrl",["require","exports","DS/VCXGUIInfrastructure/VCXGUIComponentCtrl","DS/VCXWebGUI/VCXGettingStartedExperienceInformationModal","DS/VCXWebGUI/VCXGettingStartedUI"],(function(e,t,i,n,a){"use strict";return class extends i{constructor(){super(),this._cssFile=[],this._cssFiles=[{name:"VCXWebProducts/VCXWebProducts.css",useWebApp:1},{name:"VCXWebGUI/VCXGUIManager.css",useWebApp:1},{name:"VCXWebGUI/VCXUISequence.css",useWebApp:1},{name:"VCXWebTreeGUI/VCXWebTreeGUI.css",useWebApp:1},{name:"VCXWebGUI/VCXUIPaper.css",useWebApp:1},{name:"VCXWebGUI/VCXPropertyPanel.css",useWebApp:1},{name:"VCXWebGUI/VCXUIMaterial.css",useWebApp:1}],this.backgroundImage="",this.titleStr="",this.strCreateExperience="",this.vcxGettingStartedUI=null,this.allowDrop=!0,this.allowEmpty=!0,this.mixedLayer=!0}async initialize(){n.initialize(),this.loadCssFiles(),this.vcxGettingStartedUI=this.getGettingStartedUI(),this.vcxGettingStartedUI&&(this.vcxGettingStartedUI.initialize({localMode:!0}),this.vcxGettingStartedUI.setExperienceBase(this._experienceBase),"undefined"!=typeof widget&&widget.body?this.vcxGettingStartedUI.setParentNode(widget.body):document.body?this.vcxGettingStartedUI.setParentNode(document.body):console.error("The widget and the document bodies are undefined."));var e=this.getBrandImage();this.vcxGettingStartedUI.startExperiencePage(this.titleStr,e,this.backgroundImage,this.strCreateExperience,this.allowEmpty,this.allowDrop,this.mixedLayer)}unInitialize(){this.unLoadCssFile(),n.unInitialize(),this.vcxGettingStartedUI&&(this.vcxGettingStartedUI.unInitialize(),this.vcxGettingStartedUI=null)}loadCssFiles(){const e=this._experienceBase.getManager("VCXContextManager");for(let t of this._cssFiles)e.loadCssFile(t.name,t.useWebApp)}unLoadCssFile(){const e=this._experienceBase.getManager("VCXContextManager");for(let t of this._cssFiles)e.unloadCssFile(t.name)}getGettingStartedUI(){return a}getGettingStartedNode(){if(this.vcxGettingStartedUI)return this.vcxGettingStartedUI.getHomeNode()}getBrandImage(){return""}AddDropZone(){this.vcxGettingStartedUI&&this.vcxGettingStartedUI.dropZoneON()}RemoveDropZone(){this.vcxGettingStartedUI&&this.vcxGettingStartedUI.dropZoneOFF()}}})),define("DS/VCXWebGUI/VCXSMGAuthorWelcomePageCtrl",["require","exports","DS/VCXWebGUI/VCXWelcomePageCtrl","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI"],(function(e,t,i,n){"use strict";return class extends i{constructor(){super(),this.strCreateExperience=n["VCXGettingStartedUI.CreateExperience"],this.titleStr=n["VCXGettingStartedUI.WelcomeMessageAuthoring"]}async initialize(){await super.initialize()}unInitiliaze(){super.unInitialize()}getBrandImage(){return"I_VCX_SplashComposer"+Math.floor(5*Math.random()+1)+"_.png"}}})),define("DS/VCXWebGUI/VCXMaterialView",["require","exports","DS/VCXGUIInfrastructure/VCXMainPanel","DS/VCXGUIInfrastructure/VCXMainPanelFixed","DS/Core/TooltipModel","DS/WebappsUtils/WebappsUtils","DS/VCXWebGUI/VCXMaterialCard","DS/VCXWebDragDrop/VCXDraggableMaterial","UWA/Core","DS/Controls/Button","DS/VCXGUIInfrastructure/VCXCardTypeEnum","DS/Utilities/Dom","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI"],(function(e,t,i,n,a,r,s,o,l,c,d,u,h){"use strict";let p=i;"true"===localStorage.getItem("VCXNewFrame")&&(p=n);return class extends p{constructor(e,t,i,n){super(e,t,void 0,n),this.classNameIcon="",this.experimentFeature=i??{tweaking:!1,splitted:!1},this.materialsList=[],this.cardLayout={ratioX:16,ratioY:9,cardWidth:130,descriptionHeight:24},this.setDragDropEvents(t._experienceBase),this.subscribe("VCXCardMATERIALSelected",(e=>{let t=e.id;e.checkflag&&(this.activateSelectionMode(),this.applyHeader("editHeader"));let i=this.getCardFromId(t);t&&i&&(e.checkflag?(i.selectCard(),i.selectCallback()):(i.unselectCard(),i.unSelectCallback()))}))}getAllMaterialsCard(){return this.materialsList}selectAll(){for(let e of this.materialsList)e.getIsInternal()||e?.selectCard()}getCardFromId(e){for(let t=0;t<this.materialsList.length;t++){const i=this.materialsList[t];if(i.getID()===e)return i}}getCardIndexInList(e){for(let t=0;t<this.materialsList.length;t++){if(this.materialsList[t].getID()===e)return t}return-1}updatePanelWithNewThumbnail(e,t){const i=this.getCardFromId(e);i&&(i.setIndexingIcon(!0),t&&i.updateThumbnail(t))}setOverruledMaterials(e){for(let t of this.materialsList)if(e.hasOwnProperty(t.getID())){const i=t;i?.setOverruledIcon(e[t.getID()])}}updatePanel(e){for(let t in e)if(e.hasOwnProperty(t)){let i=this.getCardFromId(t);i&&(e[t].state?i.setVisibleCardIcon():i.setNotVisibleCardIcon(),e[t].isOverruled?i.setOverruledIcon(!0):i.setOverruledIcon(!1))}}setOverriddenMaterialHeadSection(e){this.setMiddleSection(e.middle.statusSelection,e.middle.text),this.setRightSection(e.right)}setMiddleSection(e,t){this.iconTextSection.style.opacity=e?1:.3,this.middleTextSection.setText(t),this.middleTextSection.tooltipInfos=new a({shortHelp:t})}setRightSection(e){e.restore?(this.restoreButton.getContent().style.display="",this.goToParent.getContent().style.display="none",this.restoreButton.disabled=e.restore.disabled,this.callbackRestore=e.restore.callback):this.restoreButton.getContent().style.display="none",e.goToParent?(this.restoreButton.getContent().style.display="none",this.goToParent.getContent().style.display="",this.goToParent.icon=e.goToParent.image,this.callbackGoToParent=e.goToParent.callback):this.goToParent.getContent().style.display="none"}setBulkOfActiveCards(e){for(let t=0;t<this.materialsList.length;t++){const i=this.materialsList[t];e.includes(i.getID())&&i?.activateCard()}}changeStateActiveCard(){for(let e=0;e<this.materialsList.length;e++){const t=this.materialsList[e];t.isCardActive()&&t?.deactivateCard()}}setActiveCardFromId(e){for(let t=0;t<this.materialsList.length;t++){const i=this.materialsList[t];i.getID()===e&&i?.activateCard()}}activateSelectionMode(){this.getPanelContent().addClassName("vcxSceneSelectionMode")}deactivateSelectionMode(){this.getPanelContent().removeClassName("vcxSceneSelectionMode");for(let e of this.materialsList)e?.unselectCard()}preparePanel(){this.panelContainer=(0,l.createElement)("div",{class:"materialPanel",html:""}),this.headSection=(0,l.createElement)("div",{class:"headSectionMaterial",html:""});let e=(0,l.createElement)("div",{class:"panelMainMaterials",html:""});this.headSection.inject(e),this.panelContainer.inject(e),this.middleSection=(0,l.createElement)("div",{class:"section middleSection",html:""}),this.middleSection.inject(this.headSection);this.classNameIcon="vcxSceneUpdate";let t=(0,l.createElement)("div",{class:"sectionTextSection",html:""});this.iconTextSection=u.generateIcon({iconPath:r.getWebappsAssetUrl("VCXWebGUI","icons/32/I_VPMNavProduct.png"),className:this.classNameIcon}),this.middleTextSection=(0,l.createElement)("div",{class:"textB",html:"No Selection"}),this.iconTextSection.inject(t),this.middleTextSection.inject(t),t.inject(this.middleSection),this.rightSection=(0,l.createElement)("div",{class:"section rightSection",html:""}),this.restoreButtonContainer=(0,l.createElement)("div",{class:"",html:""}),this.restoreButton=new c({label:"",displayStyle:"lite",showLabelFlag:!1,icon:{iconName:"3d-object-reset",fontIconFamily:WUXManagedFontIcons.Font3DS},disabled:!1}),this.restoreButton.inject(this.rightSection),this.restoreButton.getContent().style.display="none",this.restoreButton.addEventListener("buttonclick",this.clickOnRestore.bind(this)),this.goToParent=new c({label:"Go to parent",showLabelFlag:!0,icon:{iconPath:"",iconSize:{height:"22px",width:"22px"}}}),this.goToParent.addEventListener("buttonclick",this.clickOnGoToParent.bind(this)),this.goToParentImg=(0,l.createElement)("div",{class:"goToParentImg",html:""}),this.goToParentText=(0,l.createElement)("div",{class:"goToParentText",html:"Go To Parent"}),this.goToParent.inject(this.rightSection),this.goToParent.getContent().style.display="none",this.goToParent.getContent().addClassName("buttonGoToParentSize"),this.rightSection.inject(this.headSection),this.setPanelContent(e)}clickOnGoToParent(){this.callbackGoToParent&&this.callbackGoToParent()}clickOnRestore(){this.callbackRestore&&this.callbackRestore()}updatePanelWithNewMaterials(e){for(let t of e)this.addMaterialCard(t)}destroyMaterialByID(e){const t=this.getCardFromId(e);t&&t.destroy();let i=this.getCardIndexInList(e);i&&i>-1&&this.materialsList.splice(i,1)}unInitialize(){for(let e of this.materialsList)e.destroy();super.unInitialize()}addMaterialCard(e){let t={id:e.id,title:e.name,image:e.image,isInternal:e.isInternal,selectableFlag:!0,type:d.MATERIAL,experimentFeature:this.experimentFeature,isVisible:!!e.hasOwnProperty("isVisible")&&e.isVisible,cardLayout:this.cardLayout},i=new s(t);return this.materialsList.push(i),i.setIndexingIcon(e.isIndexed),i.setOnSelectCardCallback(e.callbackOnSelectCard),i.setOnUnselectCardCallback(e.callbackOnUnselectCard),this.setContextualMenu(i,e.callbackSelect,e.callbackDelete,e.callbackTweak),i.getThumbnailElement().addEventListener("click",(()=>{e.callbackClickMaterial()})),i.getThumbnailElement().addEventListener("mouseover",(()=>{e.callbackPrehighlight()})),i.getThumbnailElement().addEventListener("mouseout",(()=>{e.callbackOnMouseOutMaterial()})),i.getIndexingIcon().addEventListener("mouseover",(()=>{e.callbackPrehighlight()})),i.getIndexingIcon().addEventListener("mouseout",(()=>{e.callbackOnMouseOutMaterial()})),i.getView().addClassName("materialCard"),i.getView().inject(this.panelContainer),i}setDragDropEvents(e){this.getPanelContent()?.addEventListener("dragstart",(t=>{const i=e.getManager("VCXDragDropManager");if(i){let n=t.target;t.dataTransfer?.clearData(),t.dataTransfer?.setData("draggedmaterialid",n.getAttribute("data-card-id"));const a=new o(n.getAttribute("data-card-id"),e);i.SetCurrentDraggableItem(a)}})),this.getPanelContent()?.addEventListener("dragend",(()=>{const t=e.getManager("VCXDragDropManager");t&&t.SetCurrentDraggableItem(null)}))}setContextualMenu(e,t,i,n){let a=[];this.experimentFeature.tweaking&&a.push({icon:"mouse",action:()=>{n()},label:"test"}),a.push({icon:"raw-material",considerStateSelect:!0,action:()=>{t(),this.materialsList.forEach((e=>e.deactivateCard())),e.activateCard()},label:h.get("VCXMaterialView.RawMaterial.SelectMaterial")}),a.push({icon:"trash",considerStateDelete:!0,action:()=>{i()},label:h.get("VCXMaterialView.RawMaterial.DeleteMaterial")}),e.customizeMenu(a)}}})),define("DS/VCXWebGUI/VCXMaterialCtrl",["DS/VCXGUIInfrastructure/VCXGUIComponentCtrl","DS/VCXWebGUI/VCXMaterialView","DS/VCXWebPlatform/VCXPlatformServices","DS/VCXWebPlatform/VCX3DSpaceServices","DS/VCXWebPlatform/VCXSearchServices","DS/VCXWebPlatform/VCXIndexCheckHelper","DS/CoreEvents/Events","DS/VCXWebKernel/VCXCmdChangeSelection","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebIO/VCXLogServices","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI","DS/VCXWebMaterials/VCXEInternalMaterialCache","DS/VCXWebExperienceBase/VCXContextManager"],(function(e,t,i,n,a,r,s,o,l,c,d,u,h){"use strict";return e.extend({init:function(){},GetIdentifier:function(){return"VCXMaterialPanel"},GetDockingInfo:function(){return{area:WUXDockAreaEnum.LeftDockArea,order:40}},BuildView:function(e){this._vcxGuiManager=this._experienceBase.getManager("VCXGUIManager"),this._materialsDescription=[],this._simulateResult=[],this._selectedMaterial=[],this._indexCheckHelper=new r,this._materialManager=this._experienceBase.getManager("VCXMaterialManager"),this._visuManager=this._experienceBase.getManager("VCXVisuManager"),this._contextManager=this._experienceBase.getManager("VCXContextManager"),this._commandManager=this._experienceBase.getManager("VCXCommandManager"),this._selectionManager=this._experienceBase.getManager("VCXSelectionManager"),this._scenarioManager=this._experienceBase.getManager("VCXScenarioManager"),this._selectionOverridenMaterials={overridenComponent:[],materialsImpacted:{}},this._events={};let i=h.isForceSupported("VCXNewFrame"),n={title:"Materials",icon:"material",immersiveFrame:this._vcxGuiManager.immersiveFrame,identifier:this.GetIdentifier(),currentDockArea:i?WUXDockAreaEnum.LeftDockArea:void 0};i&&(n.minWidth=250),this._viewPanel=new t(n,this._contextManager,{splitted:this._contextManager.isSupported("VCXMaterialPanel_Splitted"),tweaking:this._contextManager.isSupported("TweakingMaterial")},"materialPanel");let a=[{id:"defaultMaterialHeader",title:d["VCXMaterialCtrl.Title"],default:!0,commands:[{type:"callback",icon:"select-on",position:"far",i18n:d["VCXMaterialCtrl.ActivateMultiSelectionMode"],callback:()=>{this._viewPanel.activateSelectionMode(),this._viewPanel.applyHeader("editHeader")}},{type:"callback",icon:"plus",position:"far",i18n:d["VCXMaterialCtrl.InsertNewMaterial"],callback:async()=>{await this.insertNewMaterial()}}]},{id:"editHeader",title:"",commands:[{type:"callback",icon:"close",position:"near",callback:()=>{this._viewPanel.deactivateSelectionMode(),this._selectedMaterial=[],this._viewPanel.displayDefaultHeader()},i18n:d["VCXMaterialCtrl.ExitMultiSelectionMode"],hidden:!1},{type:"callback",icon:"trash",i18n:d["VCXMaterialCtrl.DeleteMaterials"],callback:async()=>{let e=[...this._selectedMaterial];for(let t of e)this.onUnselectCardMaterial(t),await this.onDeleteMaterial(t)},hidden:!1}]}];this._viewPanel.generateHeaders(a),this._events._tokenOnLoadMaterial=s.subscribe({event:"initGUIEnd"},(e=>{this.createViewPanelEmpty()})),this._events._tokenOnUpdateV2Material=s.subscribe({event:"VCX_MATERIALS_PANEL_UPDATE_V2"},(async e=>{await this.createViewPanel(),this.updatePanelOnChangeScene()})),this._events._tokenOnChangeScene=s.subscribe({event:"VCX_UPDATE_MATERIALS_ON_CHANGE_SCENE"},(e=>{this.updatePanelOnChangeScene()})),this._events._tokenUpdatePanel=s.subscribe({event:"VCX_MATERIALS_PANEL_UPDATE"},(e=>{this.updateViewPanel()})),this._events._tokenOnInsertMaterial=s.subscribe({event:"VCX_MATERIAL_INSERTED"},(async e=>{this.addNewMaterial(e)})),this._events._tokenOnApplyMaterial=s.subscribe({event:"VCX_MATERIAL_APPLIED"},(e=>{e&&(this._materialManager.addPartsWhereAppliedToMaterial(e.ID,e.components),this._viewPanel.changeStateActiveCard(),this._viewPanel.getCardFromId(e.ID).getVisibleState()&&this._viewPanel.getCardFromId(e.ID).activateCard())})),this._events._tokenOnDeleteMaterial=s.subscribe({event:"VCX_MATERIAL_DELETED"},(e=>{this._viewPanel.destroyMaterialByID(e.materialID),this.updateViewPanel()})),this._events._tokenSelectAll=s.subscribe({event:"VCX_SELECT_ALL"},(e=>{if(e&&"materialPanel"===e.vcxContextType){this._experienceBase.getManager("VCXSelectionManager").setComponentsAsSelection([],!1),this._viewPanel.selectAll()}})),this._events._tokenOnRemoveSelection=s.subscribe({event:"VCXActiveCardMATERIAL"},(e=>{const t=this._materialManager.getMaterials();let i=this.updateOverruledAndAppliedMaterial(),n={};for(let e of t){let t=e.GetID();n[t]=!!this._selectionOverridenMaterials.materialsImpacted[t]}let a=this._selectionManager.GetComponentsFromSelection("CSO");a=a.filter((e=>e.IsKindOf("VCXComponentOccurrenceComposer"))),this.updateViewPanel(),this.updateOverriddenMaterialsSectionInPanel(a),this._viewPanel.setOverruledMaterials(n),this._viewPanel.changeStateActiveCard(),this._viewPanel.setBulkOfActiveCards(i)}))},OnEndBuildView:function(){const e=this._experienceBase.getManager("VCXGUIManager").GetGUIComponentFromName("VCXPanelCtrl");e&&e.createButton(this._viewPanel.panel,"Materials","material",4)},updateOverruledAndAppliedMaterial:function(){let e=this._selectionManager.GetComponentsFromSelection("CSO");if(e=e.filter((e=>e.IsKindOf("VCXComponentOccurrenceComposer"))),this._experienceBase.getManager("VCXContextManager").isSupported("MaterialManagementV2")){let t=new Set,i=new Set(e.flatMap((e=>{let t=[];return e.QueryInterface("VCXIModelNavigable").traverse((e=>t.push(e.GetObject())),null,null),t})));for(let e of i)if(e.IsKindOf("VCXComponentOccurrenceComposer")){let i=e.GetCurrentMaterial(),n=i&&i.QueryInterface("VCXIMaterialCache").GetInternalMaterial();n&&(i=n),i&&t.add(i.GetID())}return Array.from(t)}{this._selectionOverridenMaterials={overridenComponent:[],materialsImpacted:{}};let t=[];for(let i of e){let e=i;if(!e)continue;let n=e.GetCurrentMaterial(),a=!1,r=null;for(;e&&(e=e.QueryInterface("VCXIModelNavigable").getParent(),e&&e.GetObject()&&e.GetObject().IsKindOf("VCXComponentOccurrenceComposer"));){let t=e.GetObject().GetCurrentMaterial();t&&t.IsKindOf("CXPCoveringMaterial_Spec")&&(a=!0,r=e.GetObject())}if(n){let e=n.QueryInterface("VCXIMaterialCache").GetInternalMaterial();e&&(n=e),t.push(n.GetID())}a&&(this._selectionOverridenMaterials.overridenComponent.push(r),n&&(this._selectionOverridenMaterials.materialsImpacted[n.GetID()]={materialCache:n,objectOverridingMaterial:r,status:1}))}return t}},navigateToParentCmd:function(){if(this._selectionOverridenMaterials.overridenComponent.length>0){const e=new o(this._experienceBase);e.SetSelection(this._selectionOverridenMaterials.overridenComponent[0]),this._commandManager.Do(e),s.publish({event:"VCXActiveCardMATERIAL",data:null})}},checkRestoreCommandStatus:function(e){if(this._experienceBase.getManager("VCXContextManager").isSupported("MaterialManagementV2"))return;let t=["Actor.Env.Effect","Actor.PLM.Material"];for(let i=0;i<t.length;i++)if(this._scenarioManager.IsCurrentPropertyDifferentFromNeutral(e,t[i]))return!0},restoreDefaultMaterial:function(e){if(e){const c=["Actor.Env.Effect","Actor.PLM.Material"],d=e.QueryInterface("VCXIModifiable");if(d){var t=d.GetHashing();if(t){var i=this._scenarioManager.GetNeutrals(t);if(i){for(var n=0;n<c.length;n++){var a=c[n];if(i._map.hasOwnProperty(a)){var r=i.GetProperty(a);if(r){var o=new l(this._experienceBase);o.ChangeProperty(d,r),this._commandManager.Push(o)}}}s.publish({event:"VCXActiveCardMATERIAL",data:null})}}}}},restoreDefaultMaterialMiac:async function(e){await this._materialManager.applyMaterialOnComponents(null,e.map((e=>this._experienceBase.ComponentsMap.GetComponentFromID(e))))},updateOverriddenMaterialsSectionInPanel:function(e){let t={middle:{},right:{restore:{disabled:!1},goToParent:null}};if(0===e.length)console.log("0 selected component"),t.middle.text="No selection",t.middle.statusSelection=!1;else if(e.length>1||this._selectionOverridenMaterials.overridenComponent.length>1)console.log(e.length," elements"),t.middle.text=e.length+" elements",t.middle.statusSelection=!0;else{const i=e[0],n=i&&i.QueryInterface("VCXIModifiable");if(!n)return;const a=n.GetProperty("Actor.Name").GetPropertyValue().GetValue();let r=this._selectionOverridenMaterials.overridenComponent[0];if(r){let e=r.GetCurrentMaterial();const i=e&&e.QueryInterface("VCXIMaterialCache");i&&(t.right.goToParent={},t.right.goToParent.image=i.GetImage(),t.right.goToParent.callback=this.navigateToParentCmd.bind(this))}else{let e=this.checkRestoreCommandStatus(n);t.right.restore={},t.right.restore.disabled=!e,t.right.restore.callback=this.restoreDefaultMaterial.bind(this,i)}t.middle.text=a,t.middle.statusSelection=!0}if(this._experienceBase.getManager("VCXContextManager").isSupported("MaterialManagementV2")&&(t.right.restore.disabled=!0,0!==e.length)){let i=[],n=new Set(e.flatMap((e=>{let t=[];return e.QueryInterface("VCXIModelNavigable").traverse((e=>t.push(e.GetObject())),null,null),t})));for(let e of n)if(e.IsKindOf("VCXComponentOccurrenceComposer")){let t=e.GetCurrentMaterial();t&&i.push(t)}for(let e of i)e.GetID().includes("VCXInternalMaterial_Spec")||(t.right.restore.disabled=!1);t.right.restore.callback=this.restoreDefaultMaterialMiac.bind(this,e.map((e=>e.GetID())))}this._viewPanel&&this._viewPanel.setOverriddenMaterialHeadSection(t)},onTweakMaterial:async function(e){let t=this._experienceBase.ComponentsMap.GetComponentFromID(e);t&&(t.GetType("VCXInternalMaterial_Spec")&&await t.QueryInterface("VCXIMaterialCache").exposeTweak(),this.onSelectCardMaterial(t.GetID()))},onDeleteMaterial:async function(e){"record"===this._experienceBase.odt&&this._experienceBase.getManager("VCXODTManager").LogAPI("VCXDeleteMaterial",e);let t=this._experienceBase.ComponentsMap.GetComponentFromID(e);if(!t||!t.IsKindOf("CXPCoveringMaterial_Spec"))return;let i=t.QueryInterface("VCXIMaterialCache").GetWhereApplied();if(this._experienceBase.getManager("VCXContextManager").isSupported("MaterialManagementV2"))await this.restoreDefaultMaterialMiac(i);else for(let e of i){let t=this._experienceBase.ComponentsMap.GetComponentFromID(e);this.restoreDefaultMaterial(t)}await this._experienceBase.getManager("VCXCAT3DXModelManager").DeleteMaterial([t],!1);let n=this._materialsDescription.indexOf(t.GetID());this._materialsDescription.splice(n,1),this._viewPanel.destroyMaterialByID(t.GetID()),this.updateViewPanel()},updatePanelOnChangeScene:function(){const e=this._materialManager.getMaterials();let t=this.updateOverruledAndAppliedMaterial(),i={};for(let t of e){let e=t.GetID();i[e]=!!this._selectionOverridenMaterials.materialsImpacted[e]}let n=this._selectionManager.GetComponentsFromSelection("CSO");n=n.filter((e=>e.IsKindOf("VCXComponentOccurrenceComposer"))),this.updateViewPanel(),this.updateOverriddenMaterialsSectionInPanel(n),this._viewPanel.changeStateActiveCard(),this._viewPanel.setBulkOfActiveCards(t),this._viewPanel.setOverruledMaterials(i)},insertNewMaterial:function(){let e=[];this._selectionManager.ProcessComponentsFromSelection("CSO",(t=>{t.IsKindOf("VCXComponentOccurrenceComposer")&&e.push(t)})),a.SearchInApp("[ds6w:type]:dsc_matref_ref_Covering",void 0,!0).then((t=>{if(!Array.isArray(t))return this._experienceBase.getManager("VCXCAT3DXModelManager").InsertMaterial(t.label,null,t.id,e);if(t&&t.length>0){if(1===t.length){const i=t[0];return this._experienceBase.getManager("VCXCAT3DXModelManager").InsertMaterial(i.label,null,i.id,e)}{let e={};return t.forEach((t=>e[t.id]=t.label)),this._experienceBase.getManager("VCXCAT3DXModelManager").InsertMaterials(e,null)}}}))},updateViewPanel:function(){let e={},t=this._materialManager.getMaterials();for(let i of t){let t=i.QueryInterface("VCXIMaterialCache"),n=i.GetID(),a=t.GetWhereApplied();a=a.filter((e=>{let t=this._experienceBase.ComponentsMap.GetComponentFromID(e),i=t&&t.QueryInterface("VCXIVisibility");return i&&1===i.GetVisibility()})),e[n]={},e[n].image=t.GetImage(),e[n].state=a.length>0,e[n].selectCallback=this.onClickMaterial.bind(this,n),e[n].isOverruled=!!this._selectionOverridenMaterials.materialsImpacted[n]}this._viewPanel.updatePanel(e)},onMouseOutMaterial:function(){WUX.Selection.PSOManager.empty(),this._selectionManager.RefreshXSO()},onMouseOverMaterial:function(e){this.prehighlightId&&window.clearTimeout(this.prehighlightId),this.prehighlightId=window.setTimeout((()=>{this.prehighlightAllPartsByMaterialId(e)}),300)},prehighlightAllPartsByMaterialId:function(e){let t=this._selectionManager.GetComponentsFromSelection("CSO");if(t=t.filter((e=>e.IsKindOf("VCXComponentOccurrenceComposer"))).map((e=>e.GetID())),t&&t.length)return;let i=this._experienceBase.ComponentsMap.GetComponentFromID(e);WUX.Selection.PSOManager.empty();let n=i.QueryInterface("VCXIMaterialCache").GetWhereApplied();n&&n.length>0&&(n.forEach((e=>{let t=this._experienceBase.ComponentsMap.GetComponentFromID(e),i=t&&t.QueryInterface("W3AISGNodeHolder").getPathElement();i&&WUX.Selection.PSOManager.add({pathElement:i})})),this._selectionManager.RefreshXSO())},selectAllPartsByMaterialId:function(e){"record"===this._experienceBase.odt&&this._experienceBase.getManager("VCXODTManager").LogAPI("VCXSelectPartsFromMaterialCard",e);const t=c.generateUUID();WUX.Selection.CSOManager.empty();let i=this._experienceBase.ComponentsMap.GetComponentFromID(e).QueryInterface("VCXIMaterialCache").GetWhereApplied();if(i=[...new Set(i)],i&&i.length>0){c.memoryLog("SelectPartsWithMaterial",!0,t,{N:i.length,parameterName:"parts where applied"});const e=new o(this._experienceBase);let n=[...i];i=i.map((e=>this._experienceBase.ComponentsMap.GetComponentFromID(e))).filter((e=>!!e)),e.AddComponentsToSelection(i),this._commandManager.Do(e),c.memoryLog("SelectPartsWithMaterial",!1,t,{N:i.length,parameterName:"parts where applied"});let a={};const r=this._materialManager.getMaterials();for(let e of r){let t=e.GetID();a[t]=!!this._selectionOverridenMaterials.materialsImpacted[t]}this._viewPanel.setOverruledMaterials(a);let s=n.map((e=>this._experienceBase.ComponentsMap.GetComponentFromID(e))).filter((e=>!!e));this.updateOverriddenMaterialsSectionInPanel(s)}},onClickMaterial:async function(e){return"record"===this._experienceBase.odt&&this._experienceBase.getManager("VCXODTManager").LogAPI("VCXApplyMaterialFromPanel",e),this._visuManager.hideDecorations("PanelMaterialLiveChange",this._contextManager.getMainViewer(),!0),this.applyMaterial(e).then((e=>{e&&(this.updateViewPanel(),this._viewPanel.changeStateActiveCard(),this._viewPanel.getCardFromId(e.GetID()).getVisibleState()&&this._viewPanel.getCardFromId(e.GetID()).activateCard()),this._visuManager.showDecorations("PanelMaterialLiveChange",this._contextManager.getMainViewer(),!0)})).catch((e=>{console.warn(e),this._visuManager.showDecorations("PanelMaterialLiveChange",this._contextManager.getMainViewer(),!0)}))},applyMaterial:async function(e){const t=c.generateUUID();let i=this._selectionManager.GetComponentsFromSelection("CSO");i=i.filter((e=>e.IsKindOf("VCXComponentOccurrenceComposer")));let n=null;return i&&i.length&&(c.memoryLog("ApplyMaterial",!0,t,{N:i.length,parameterName:"selected parts"}),n=await this.applyMaterialToSelection(e,i,!0),c.memoryLog("ApplyMaterial",!1,t,{N:i.length,parameterName:"selected parts"})),s.publish({event:"VCXActiveCardMATERIAL",data:null}),n},applyMaterialToSelection:async function(e,t){this._commandManager,this._scenarioManager;let i=null;return e&&(i=this._experienceBase.ComponentsMap.GetComponentFromID(e)),this._selectionOverridenMaterials.overridenComponent.length>0?(this._experienceBase.getManager("VCXNotificationManager").addNotification({level:"warning",title:d["VCXMaterialCtrl.ApplyMaterial.NotificationTitle"],message:d["VCXMaterialCtrl.ApplyMaterial.NotificationMessage"]}),null):(await this._materialManager.applyMaterialOnComponents(i,t),i)},onSelectCardMaterial:function(e){const t=this._experienceBase.ComponentsMap.GetComponentFromID(e),i=new o(this._experienceBase);i.AddToSelection(t),this._commandManager.Do(i),this._selectedMaterial.push(t.GetID())},onUnselectCardMaterial:function(e){const t=this._experienceBase.ComponentsMap.GetComponentFromID(e),i=new o(this._experienceBase);i.RemoveFromSelection(t),this._commandManager.Do(i);let n=this._selectedMaterial.indexOf(t.GetID());n>=0&&this._selectedMaterial.splice(n,1),this._selectedMaterial.length||(this._viewPanel.deactivateSelectionMode(),this._viewPanel.displayDefaultHeader())},addNewMaterial:function(e){if(!this._materialsDescription.includes(e.GetID())){let t=this._viewPanel.addMaterialCard(this._generateCardFormat(e));this.updateViewPanel(),this._viewPanel.changeStateActiveCard(),t.getVisibleState()&&t.activateCard(),this._materialsDescription.push(e.GetID())}},_generateCardFormat:function(e){let t=e.QueryInterface("VCXIMaterialCache");const i=t instanceof u;let n=t.GetWhereApplied();return n=[...new Set(n)],{id:e.GetID(),name:t.GetTitle(),image:t.GetImage(),isIndexed:!0,isInternal:i,isVisible:n.length>0,callbackClickMaterial:this.onClickMaterial.bind(this,e.GetID()),callbackPrehighlight:this.onMouseOverMaterial.bind(this,e.GetID()),callbackOnMouseOutLabel:()=>{WUX.Selection.PSOManager.empty()},callbackOnMouseOverMaterial:null,callbackOnMouseOutMaterial:this.onMouseOutMaterial.bind(this),callbackOnSelectCard:this.onSelectCardMaterial.bind(this,e.GetID()),callbackOnUnselectCard:this.onUnselectCardMaterial.bind(this,e.GetID()),callbackSelect:this.selectAllPartsByMaterialId.bind(this,e.GetID()),callbackReplace:()=>console.warn("Replace material not yet implemented !"),callbackTweak:this.onTweakMaterial.bind(this,e.GetID()),callbackDelete:this.onDeleteMaterial.bind(this,e.GetID())}},createViewPanelEmpty:function(){this._viewPanel.preparePanel()},createViewPanel:async function(){let e=[];const t=this._materialManager.getMaterials();let a=!1;for(let i of t){let t=i.QueryInterface("VCXIMaterialCache");t.GetImage().includes("enovia")&&(a=!0,t.SetIndexingState(!1)),a=a||t.GetImage().includes("enovia"),this._materialsDescription.includes(i.GetID())||(this._materialsDescription.push(i.GetID()),e.push(this._generateCardFormat(i)))}if(a){const e=async()=>{const e=await n.Get3DSpaceURL();let t=this._materialManager.getMaterials(),a=0;for(let n of t){let t=n.QueryInterface("VCXIMaterialCache");if(!t.GetIndexingState()&&t.GetImage().includes("enovia")){t.SetIndexingState(!0);let r=e&&await i.getObjectInfo(t.GetPID(),e);r.dataelements&&r.dataelements.hasOwnProperty("image")&&(r.dataelements.image.includes("enovia")||(a++,t.SetImage(r.dataelements.image),this._viewPanel.updatePanelWithNewThumbnail(n.GetID(),r.dataelements.image)))}}return a===t.length},t=async()=>{let e=this._materialManager.getMaterials();for(let t of e){t.QueryInterface("VCXIMaterialCache").SetIndexingState(!0),this._viewPanel.updatePanelWithNewThumbnail(t.GetID(),null)}};this._indexCheckHelper&&this._indexCheckHelper.checkIndexing(t,e,null)}this._viewPanel.updatePanelWithNewMaterials(e)},unInitialize:function(){if(this._viewPanel&&(this._viewPanel.unInitialize(),this._viewPanel=null),this._events)for(let e in this._events)this._events.hasOwnProperty(e)&&s.unsubscribe(this._events[e]);this._indexCheckHelper&&(this._indexCheckHelper.unInitialize(),this._indexCheckHelper=null),this._materialManager=null,this._visuManager=null,this._contextManager=null,this._commandManager=null,this._selectionManager=null,this._scenarioManager=null}})}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebGUI/VCXPartListEditModeCtrl",["require","exports","DS/CoreEvents/Events","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueMap","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebGUI/VCXPartListEditModeView","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey"],(function(e,t,i,n,a,r,s,o){"use strict";o=__importDefault(o);return class{get modifiable(){return this._modifiable}set modifiable(e){this._modifiable=e}constructor(e){this._editModeActiveColumn=0,this._modifiable=null,this._experienceBase=e,this._view=null,this._referenceUI=null,this._modifiable=null}buildEditModeView(e){e.referenceUI?this._referenceUI=e.referenceUI:document.getElementById("divBom")?.children&&document.getElementById("divBom")?.children.length&&(this._referenceUI=document.getElementById("divBom")?.children[0]);let t=e.columnNumber;if(!t){t=1;let i=e.event?.target;if(i&&i.getChildren()&&i.getChildren().length){for(let n=0;n<i.getChildren().length;n++)if(i.getChildren()[n].getBoundingClientRect().right>=e.event.clientX&&i.getChildren()[n].getBoundingClientRect().left<=e.event.clientX){t=n;break}}else t=this._editModeActiveColumn}this._backToEditMode(t)}hideEditModeView(){if(this._view&&(this._view.destroy(),this._view=null),!this._modifiable&&(this._modifiable=this._getPartListModifiable(),!this._modifiable))return;let e="#"+this._modifiable.GetProperty("Collab.PartList.Header.Background.Color").GetPropertyValue().GetValue().getHexString(),t=document.getElementById("divBom")?.children[0];if(t){t.children[this._editModeActiveColumn].style.backgroundColor=e;let i=[];for(let e=0;e<t.children.length;e++)t.children[e].classList.contains("New.Column")&&i.push(e);let r=this._modifiable.ExperienceBase.getManager("VCXComponentPartListManager"),s=this._modifiable.GetProperty("Collab.PartList.ColumnList"),o=r.GetColumnsList(),l=[];for(let e=0;e<o.length;e++)i.includes(e)||l.push(o[e]);let c=new a;for(let e=0;e<l.length;e++){let t=new n;t.SetValue(l[e]),c.SetValueAtIndex(e,t)}if(o.length>1?this._editModeActiveColumn=1:this._editModeActiveColumn=0,"record"===this._experienceBase.odt){const e={};this._experienceBase.getManager("VCXODTManager").LogAPI("VCXPartListHideEditMode",e)}this._updatePropertyValues([s],[c])}}unInitialize(){this._view&&(this._view.destroy(),this._view=null)}_backToEditMode(e,t=void 0){this._referenceUI&&(this._referenceUI=null,document.getElementById("divBom")?.children&&document.getElementById("divBom")?.children.length&&(this._referenceUI=document.getElementById("divBom")?.children[0]),i.publish({event:"VCX_SWITCH_EDIT_SELECTION",data:{mode:0,state:!0}}),this._displayButtonsAtRightPosition(e,t))}_getPartListModifiable(){const e=this._experienceBase.ComponentsMap.GetComponentFromType("VCXPartList_Spec");return e&&e.length?e[0].QueryInterface("VCXIModifiable"):null}_displayButtonsAtRightPosition(e,t){if(!this._modifiable&&(this._modifiable=this._getPartListModifiable(),!this._modifiable))return;this._view&&(this._view.destroy(),this._view=null);const i={callbackOptionsButton:()=>this._handleOptionsButton(e),callbackAddLeftButton:()=>this._handleColumnAddButton("addLeft",e),callbackAddRightButton:()=>this._handleColumnAddButton("addRight",e)};this._view=new s(this._referenceUI,i);let n="#"+this._modifiable.GetProperty("Collab.PartList.Header.Background.Color").GetPropertyValue().GetValue().getHexString();this._view.changeColor(n,e,t),this._editModeActiveColumn=e}_handleColumnAddButton(e,t){if(!this._modifiable&&(this._modifiable=this._getPartListModifiable(),!this._modifiable))return;let r=this._experienceBase.getManager("VCXComponentPartListManager").GetColumnsList();"addRight"===e?(r.splice(t+1,0,"New Column"),this._editModeActiveColumn=t+1):"addLeft"===e?(r.splice(t,0,"New Column"),this._editModeActiveColumn=t):console.error("Unable to add column");let s=this._modifiable.GetProperty("Collab.PartList.ColumnList"),o=new a;for(let e=0;e<r.length;e++){let t=new n;t.SetValue(r[e]),o.SetValueAtIndex(e,t)}if("record"===this._experienceBase.odt){const i={addDirection:e,columnNumber:t};this._experienceBase.getManager("VCXODTManager").LogAPI("VCXHandleAddColumnButtonPartList",i)}this._updatePropertyValues([s],[o]),setTimeout((()=>{if(this._view){let e="#"+this._modifiable.GetProperty("Collab.PartList.Header.Background.Color").GetPropertyValue().GetValue().getHexString();this._view.changeColor(e,this._editModeActiveColumn),this._view.destroy(),this._view=null}i.publish({event:"VCX_Meta_Display_UI",data:{indexColumn:this._editModeActiveColumn+1}})}),100)}_handleOptionsButton(e){i.publish({event:"VCX_Menu_Panel_PartList",data:{columnButtonsContainer:this._view._container,columnNumber:e,handleSortButton:this._handleSortButton.bind(this),handleDeleteButton:this._handleDeleteButton.bind(this),handleMoveButton:this._handleMoveButton.bind(this),handleUpdateProperty:this._handleUpdateProperty.bind(this)}})}_handleUpdateProperty(e){this._editModeActiveColumn=e}_handleMoveButton(e,t){if(!this._modifiable&&(this._modifiable=this._getPartListModifiable(),!this._modifiable))return;let i=this._experienceBase.getManager("VCXComponentPartListManager").GetColumnsList();if("left"===e&&0===t||"right"===e&&t===i.length-1)return;let r=this._modifiable.GetProperty("Collab.PartList.ColumnList"),s=new a;"left"===e?([i[t-1],i[t]]=[i[t],i[t-1]],this._editModeActiveColumn=t-1):"right"===e?([i[t],i[t+1]]=[i[t+1],i[t]],this._editModeActiveColumn=t+1):console.error("Something went wrong with the move column command");for(let e=0;e<i.length;e++){let t=new n;t.SetValue(i[e]),s.SetValueAtIndex(e,t)}if("record"===this._experienceBase.odt){const i={moveDirection:e,columnNumber:t};this._experienceBase.getManager("VCXODTManager").LogAPI("VCXHandleMoveButtonPartList",i)}this._updatePropertyValues([r],[s])}_handleDeleteButton(e){if(!this._modifiable&&(this._modifiable=this._getPartListModifiable(),!this._modifiable))return;let t=this._experienceBase.getManager("VCXComponentPartListManager").GetColumnsList();if("Actor.PartList.ID"===t[e])return;t.splice(e,1);let i=this._modifiable.GetProperty("Collab.PartList.SortColumn"),r=i.GetPropertyValue().GetValue(),s=new n(r);r===t[e]&&(r="Actor.PartList.ID",s.SetValue(r));let o=this._modifiable.GetProperty("Collab.PartList.ColumnList"),l=new a;for(let e=0;e<t.length;e++){let i=new n;i.SetValue(t[e]),l.SetValueAtIndex(e,i)}if(this._editModeActiveColumn=0===e?0:e-1,"record"===this._experienceBase.odt){const t={columnNumber:e};this._experienceBase.getManager("VCXODTManager").LogAPI("VCXHandleDeleteButtonPartList",t)}this._updatePropertyValues([o,i],[l,s])}_handleSortButton(e,t){if(!this._modifiable&&(this._modifiable=this._getPartListModifiable(),!this._modifiable))return;let i=this._experienceBase.getManager("VCXComponentPartListManager").GetColumnsList(),a=this._modifiable.GetProperty("Collab.PartList.SortColumn"),s=this._modifiable.GetProperty("Collab.PartList.SortAscending"),o=new n;o.SetValue(i[t]);let l=new r;if("ascending"===e?l.SetValue(!0):"descending"===e?l.SetValue(!1):console.error("Invalid Sort Type"),this._editModeActiveColumn=t,"record"===this._experienceBase.odt){const i={sortType:e,columnNumber:t};this._experienceBase.getManager("VCXODTManager").LogAPI("VCXHandleSortButtonPartList",i)}this._updatePropertyValues([a,s],[o,l])}_updatePropertyValues(e,t){if((this._modifiable||(this._modifiable=this._getPartListModifiable(),this._modifiable))&&this._modifiable&&e&&e.length&&t&&t.length){let i=new o.default(this._experienceBase);for(let n=0;n<e.length;n++)e[n].type?"fontHeight"===e[n].type&&e[n].GetPropertyValue().SetHeight(t[n]):e[n].SetPropertyValue(t[n]),i.ChangeProperty(this._modifiable,e[n]);this._experienceBase.getManager("VCXCommandManager").Do(i)}}}}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebGUI/VCXScenePanelView",["require","exports","DS/Controls/Button","DS/VCXGUIInfrastructure/VCXMainPanel","DS/VCXGUIInfrastructure/VCXMainPanelFixed","DS/VCXGUIInfrastructure/VCXCardTypeEnum","DS/VCXWebGUI/VCXSceneCard","UWA/Core","i18n!DS/VCXWebProducts/assets/nls/VCXWebProductAuthoringCommands","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI","DS/CoreEvents/Events","DS/VCXWebExperienceBase/VCXContextManager","DS/VCXWebDragDrop/VCXDraggableScene"],(function(e,t,i,n,a,r,s,o,l,c,d,u,h){"use strict";u=__importDefault(u);let p=n;"true"===localStorage.getItem("VCXNewFrame")&&(p=a);return class extends p{constructor(e,t,n){super(e,t.getContext(),void 0,n),this.sceneList=new Array,this.cardLayout={ratioX:16,ratioY:9,cardWidth:u.default.isForceSupported("VCXNewFrame")?150:170,descriptionHeight:24},this.captureButton=new i({emphasize:"primary",icon:{iconName:"camera",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"22px"}}),this.captureButton.elements.container.title=l.VCXCreateScenarioCmd,this.captureButton.getContent().setAttribute("data-rec-id","New-Scene-Capture-Button"),this.newSceneButton=new i({displayStyle:"lite",icon:{iconName:"plus",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"16px"}}),this.newSceneButton.elements.container.title=l.VCXCreateEmptyScenarioCmd,this.newSceneButton.getContent().setAttribute("data-rec-id","New-Scene-Empty-Button"),this.preparePanel(),this.getPanelContent().addClassName("vcxDisplayModeSmall"),this.setDragDropEvents(t._experienceBase),this.subscribe("VCXCardSCENESelected",(e=>{let t=e.id;e.checkflag&&(this.activateSceneSelectionMode(),this.applyHeader("editScenesHeader")),t&&this.selectSceneCallback&&(e.checkflag?this.selectScene(t):this.deselectScene(t),this.selectSceneCallback(t,e.checkflag))})),this.subscribe("VCX_CLOSE_TOOLBAR",(()=>{this.deactivateSceneSelectionMode()}))}deselectScene(e){this.getCardFromId(e)?.unselectCard(),this.getSelectedSceneIds&&0===this.getSelectedSceneIds().length&&this.deactivateSceneSelectionMode()}selectScene(e){this.getCardFromId(e)?.selectCard()}unInitialize(){for(let e=0;e<this.sceneList.length;e++){this.sceneList[e].destroy()}super.unInitialize()}createSequenceView(e,t){console.warn("Create sequence view currently does nothing"),(0,o.createElement)("div",{class:"scenesContainer",html:"","data-sequence-id":e}).inject(this.sequenceContainer).style.gridTemplateColumns="repeat(auto-fill, "+this.cardLayout.cardWidth+"px)"}getSequenceViewFromId(e){if(this.sequenceContainer){let t=this.sequenceContainer.children;for(let i=0;i<t.length;i++){const n=t[i];if(n.getAttribute("data-sequence-id")===e)return n}}return null}activateSequence(e){console.warn("activate sequence currently does nothing: ",e)}preparePanel(){let e=(0,o.createElement)("div",{class:"panelContainer",html:""});this.sequenceContainer=(0,o.createElement)("div",{class:"sequencesContainer",html:""}).inject(e);let t=(0,o.createElement)("div",{class:"vcxScenePanelFooter",html:""}).inject(e);this.setPanelContent(e),this.captureButton.inject(t),this.captureButton.getContent().addClassName("vcxCaptureButton"),this.newSceneButton.inject(t),this.newSceneButton.getContent().addClassName("vcxNewSceneButton"),new IntersectionObserver((([e])=>e.target.classList.toggle("vcx-sticky",e.intersectionRatio<1)),{threshold:[1]}).observe(t)}createScenario(e,t,i,n,a,o,l){if(this.sequenceContainer){let c=this.getSequenceViewFromId(t);if(!c)return void console.warn("sequence not found");let d={id:e,title:i,image:a,selectableFlag:!0,type:r.SCENE,cardLayout:this.cardLayout},u=new s(d),h=u.getView();this.sceneList.push(u),c.insertBefore(h,c.getChildren()[n]),l&&u.concealCard(!0);let p=this.getPanelContent()?.parentElement,m=document.getElementsByClassName("vcxScenePanelFooter")[0];p&&(p.scrollTop>h.offsetTop?p.scrollTo({top:h.offsetTop,behavior:"smooth"}):h.offsetTop>p.scrollTop+p.offsetHeight-h.offsetHeight-m.offsetHeight&&p.scrollTo({top:h.offsetTop-p.offsetHeight+h.offsetHeight+m.offsetHeight,behavior:"smooth"})),o&&this.changeCurrentScenario(e),this.setContextualMenu(u),this.renameSceneCallback&&u.addRenameCardCallback(this.renameSceneCallback);let C=this;u.addCardClickCallback((e=>{(e.target===u.getView()||e.target===u.getView().getElementsByClassName("vcxUICard-descriptionContainer")[0]||!u.isCardActive()&&e.target===u.getView().getElementsByClassName("vcxUICard-descriptionTitle")[0]||e.target===u.getView().getElementsByClassName("vcxUICard-thumbnail")[0]||e.target&&null!==e.target?.closest(".vcxSceneCard-conceal"))&&C.sceneClickCallback&&C.sceneClickCallback(u.getID())})),u.addUpdateButtonCallback((()=>{C.updateButtonCallback()}))}else console.error("tried to update a scene with no scene container in the view: this.sceneContainer")}setContextualMenu(e){e.customizeMenu([{icon:"duplicate",action:()=>{this.duplicateSceneCallback&&this.duplicateSceneCallback(e.getID())},label:c["VCXSceneCard.DuplicateScene"]},{icon:"camera-refresh",activeSceneDisabled:!0,action:()=>{this.replaceSceneCallback&&this.replaceSceneCallback(e.getID())},label:c["VCXSceneCard.ReplaceScene"]},{sceneCountDependentFunction:this.getScenarioCount,concealDependent:!0,concealOn:{label:c["VCXSceneCard.ShowScene"],icon:"eye"},concealOff:{label:c["VCXSceneCard.HideScene"],icon:"eye-off"},action:()=>{this.concealSceneCallback&&this.concealSceneCallback(e.getID())}},{icon:"picture-add",action:()=>{this.createPIPCallback?this.createPIPCallback(e.getID()):console.warn("no callback set for PIP Creation")},label:c["VCXSceneCard.Create2DImage"]},{icon:"trash",action:()=>{this.deleteSceneCallback?this.deleteSceneCallback(e.getID()):console.warn("no callback set for this button")},label:c["VCXSceneCard.DeleteScene"]},{icon:"rename",action:()=>{console.log("rename"),e!==this.getActiveCard()&&e.getName().setAttribute("contenteditable","true"),e.getName().focus()},label:c["VCXSceneCard.RenameScene"]}])}removeScenario(e){let t=this.getCardFromId(e);if(!t)return;let i=this.sceneList.indexOf(t);t.destroy(),i>-1&&this.sceneList.splice(i,1)}updateScenario(e,t){let i=this.getCardFromId(e);i?.updateInfo(t)}concealScenario(e,t){let i=this.getCardFromId(e);i?.concealCard(t)}changeCurrentScenario(e){this.getActiveCard()?.deactivateCard(),this.getCardFromId(e)?.activateCard()}getCardFromId(e){for(let t=0;t<this.sceneList.length;t++){const i=this.sceneList[t];if(i.getID()===e)return i}}getActiveCard(){for(let e=0;e<this.sceneList.length;e++){const t=this.sceneList[e];if(t.isCardActive())return t}}displaySceneUpdateButton(){this.getActiveCard()?.showUpdateButton()}hideSceneUpdateButton(){for(let e=0;e<this.sceneList.length;e++){this.sceneList[e].hideUpdateButton()}}updateButtonCallback(){}setSceneClickFunction(e){this.sceneClickCallback=e}setSceneRenameFunction(e){this.renameSceneCallback=e}setConcealSceneFunction(e){this.concealSceneCallback=e}setSceneSelectionFunction(e){this.selectSceneCallback=e}setSceneMoveFunction(e){this.moveSceneCallback=e}setSceneGetSelectedIds(e){this.getSelectedSceneIds=e}setSceneDeleteFunction(e){this.deleteSceneCallback=e}setSceneDuplicateFunction(e){this.duplicateSceneCallback=e}setSceneReplaceFunction(e){this.replaceSceneCallback=e}setCreatePIPFunction(e){this.createPIPCallback=e}setCreateBaseSceneFunction(e){this.newSceneButton.addEventListener("buttonclick",e)}setScenarioCountFunction(e){this.getScenarioCount=e}setCameraButtonFunction(e){this.captureButton.addEventListener("buttonclick",(()=>{e();let t=d.subscribe({event:"VCX_CURRENT_SCENARIO_CHANGED"},(()=>{this.editCurrentSceneName(),d.unsubscribe(t)}))}))}editCurrentSceneName(){let e=this.getActiveCard();e&&e.getName().focus({preventScroll:!0})}selectAll(){this.sceneList.forEach((e=>(e.selectCard(),!0)))}activateSceneSelectionMode(){this.getPanelContent().addClassName("vcxSceneSelectionMode")}deactivateSceneSelectionMode(){if(this.getPanelContent().removeClassName("vcxSceneSelectionMode"),this.displayDefaultHeader(),this.getSelectedSceneIds&&this.selectSceneCallback){let e=this.getSelectedSceneIds();for(let t=0;t<e.length;t++){const i=e[t];let n=this.getCardFromId(i);n?.unselectCard()}}}getUICardIndexInSequence(e){let t=-1,i=this.getCardFromId(e);if(i){t=Array.from(i.getView().getParent().children).indexOf(i.getView())}return t}getSequenceView(e){return this.getPanelContent().querySelectorAll('[data-sequence-id="'+e+'"]')[0]}getSequenceIDfromSceneID(e){let t=null,i=this.getCardFromId(e);return i&&(t=i.getView().getParent().getAttribute("data-sequence-id")),t||""}moveSceneView(e,t,i,n){let a=this.getSequenceView(t),r=this.getSequenceView(i),s=this.getCardFromId(e)?.getView();s&&(a.removeChild(s),r.insertBefore(s,r.children[n]))}setDragDropEvents(e){this.getPanelContent()?.addEventListener("dragstart",(t=>{let i=t.target;i.style.opacity="20%",t.dataTransfer?.clearData(),t.dataTransfer?.setData("draggedsceneid",i.getAttribute("data-card-id")),this.draggingScene=i,t.dataTransfer&&(t.dataTransfer.effectAllowed="copyMove",t.dataTransfer.dropEffect="move");const n=e.getManager("VCXDragDropManager");if(n){const t=new h(i.getAttribute("data-card-id"),e);n.SetCurrentDraggableItem(t)}})),this.getPanelContent()?.addEventListener("dragend",(t=>{t.target.style.opacity="";const i=e.getManager("VCXDragDropManager");i&&i.SetCurrentDraggableItem(null)})),this.getPanelContent()?.addEventListener("dragenter",(e=>{let t=this.draggingScene?.getAttribute("data-card-id");if(t){let i=this.getCardFromId(t)?.getView(),n=e.target.closest(".vcxUICard");if(n&&i){let e=n.getAttribute("data-card-id"),a=this.getSequenceIDfromSceneID(t),r=this.getUICardIndexInSequence(t),s=this.getSequenceIDfromSceneID(e),o=this.getUICardIndexInSequence(e);if(s!==a||t===e)return;let l=n.parentElement;o<r?(l.insertBefore(i,n),this.draggingIndex=this.getUICardIndexInSequence(t)):o>r&&(l.insertBefore(n,i),this.draggingIndex=this.getUICardIndexInSequence(t))}}})),this.getPanelContent()?.addEventListener("dragover",(e=>{e.preventDefault()})),this.getPanelContent()?.addEventListener("drop",(()=>{if("number"==typeof this.draggingIndex&&this.draggingScene&&this.moveSceneCallback){let e=this.draggingScene.getAttribute("data-card-id");this.moveSceneCallback(e,this.getSequenceIDfromSceneID(e),this.draggingIndex)}this.draggingScene=void 0,this.draggingIndex=void 0}))}displayLoading(e){this.getCardFromId(e)?.activateLoading()}hideLoading(e){this.getCardFromId(e)?.deactivateLoading()}}})),define("DS/VCXWebGUI/VCXSceneCtrl",["UWA/Class","DS/VCXGUIInfrastructure/VCXGUIComponentCtrl","DS/CoreEvents/Events","DS/ApplicationFrame/CommandsManager","DS/VCXWebGUI/VCXScenePanelView","DS/VCXWebKernelCommands/VCXCmdGoToScenario","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebKernelCommands/VCXCmdChangePropertiesVolatile","DS/VCXWebKernelCommands/VCXCmdChangeScenarioSequence","DS/VCXWebKernel/VCXCmdChangeSelection","DS/VCXWebKernelCommands/VCXCmdChangeVisibility","DS/VCXWebVisibility/VCXIVisibility","DS/WebappsUtils/WebappsUtils","DS/Tweakers/TypeEnums","DS/VCXKeyFramer/VCXScenario","DS/VCXWebProperties/VCXPropertySet","DS/Visualization/ThreeJS_DS","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI","i18n!DS/VCXWebProducts/assets/nls/VCXWebProductAuthoringCommands","DS/VCXWebExperienceBase/VCXContextManager","DS/VCXWebKernelTools/VCXAnalyticsTrackerAppManager"],(function(e,t,i,n,a,r,s,o,l,c,d,u,h,p,m,C,g,_,b,v,f){"use strict";return t.extend({init:function(){},GetIdentifier:function(){return"scenePanelV2"},GetDockingInfo:function(){return{area:WUXDockAreaEnum.LeftDockArea,order:10}},EnsureVisible:function(){this.getPanelView()&&this.getPanelView().ensureVisible&&this.getPanelView().ensureVisible()},BuildView:function(e){var t=this;this.currentScenarioID="";const n=this._experienceBase.getManager("VCXGUIManager");this.playerMode=Boolean(e.playerMode);let r=v.isForceSupported("VCXNewFrame"),s={title:_["VCXScenarios.PanelTitle"],icon:"camera",immersiveFrame:n.immersiveFrame,currentDockArea:r?WUXDockAreaEnum.RightDockArea:void 0,identifier:this.GetIdentifier(),width:"170px"};r&&(s.minWidth=170),this._scenePanelView=new a(s,this._experienceBase.getManager("VCXContextManager"),"scenePanel");let o=[{id:"defaultSceneHeader",title:_["VCXScenarios.PanelTitle"],default:!0,commands:[{type:"callback",icon:"picture-update",position:"far",callback:()=>{const e=this._experienceBase.getManager("VCXExperience");e&&e.RefreshThumbnails()},i18n:_.get("VCXThumbnailsRefresh"),disabled:this._experienceBase.getManager("VCXScenarioManager").AutoThumbnailUpdate,hidden:this.playerMode},{type:"brut",id:"autoRefreshChoice",position:"far",category:"1",dataElements:{typeRepresentation:"functionMenuIcon",value:{menu:[]}}},{type:"callback",icon:"select-on",callback:()=>{this._scenePanelView.activateSceneSelectionMode(),this._scenePanelView.applyHeader("editScenesHeader")},i18n:_.get("VCXScenarioToolbar.ActivateMultiSelectionMode"),hidden:this.playerMode},{type:"layout",possibleValues:[p.Layout.SmallThumbnail,p.Layout.BigThumbnail,p.Layout.BigTile,p.Layout.List],value:p.Layout.SmallThumbnail,icon:"",commandID:"",i18n:"",hidden:!1}]},{id:"editScenesHeader",title:"",commands:[{type:"callback",icon:"close",position:"near",callback:()=>{this._scenePanelView.deactivateSceneSelectionMode()},i18n:_.get("VCXScenarioToolbarExit"),hidden:this.playerMode},{type:"command",icon:"propagate",commandID:"VCXApplyToSelectedCmd",i18n:b.get("VCXApplyToSelectedCmd"),hidden:this.playerMode},{type:"command",icon:"refresh",commandID:"VCXReplaceScenarioCmd",i18n:b.get("VCXReplaceScenarioCmd"),hidden:this.playerMode},{type:"command",icon:"trash",commandID:"VCXDeleteSceneSelectionCmd",i18n:b.get("VCXDeleteSceneSelectionCmd"),hidden:this.playerMode}]}];this._scenePanelView.generateHeaders(o),this.updateAutoRefreshStates();this._scenePanelView.setSceneClickFunction((e=>{(this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario()!==e||this._experienceBase.getManager("VCXGUIManager").GetSceneNeedsUpdate())&&this._experienceBase.getManager("VCXAPIManager").GoToScenario(e)}).bind(this)),this._scenePanelView.setSceneRenameFunction(this.renameScene.bind(this)),this._scenePanelView.setSceneSelectionFunction(this.changeSceneSelection.bind(this)),this._scenePanelView.setSceneReplaceFunction(this.replaceScene.bind(this)),this._scenePanelView.setCreatePIPFunction(this.createPIP.bind(this)),this._scenePanelView.setSceneDuplicateFunction(this.duplicateScene.bind(this)),this._scenePanelView.setSceneDeleteFunction(this.deleteScene.bind(this)),this._scenePanelView.setSceneGetSelectedIds(this.getSelectedSceneIDs.bind(this)),this._scenePanelView.setCreateBaseSceneFunction(this.createBaseScene.bind(this)),this._scenePanelView.setConcealSceneFunction(this.concealScene.bind(this)),this._scenePanelView.setScenarioCountFunction(this.getScenarioCount.bind(this)),this._scenePanelView.setSceneMoveFunction(this.moveScenarioIndex.bind(this)),this._scenePanelView.setCameraButtonFunction(this.captureInNewSceneCallback.bind(this)),this._scenePanelView.updateButtonCallback=this.updateSceneCallback.bind(this),this.currentViewpoint={angle:-1,eyePos:null,sightDir:null},this._tokenScChanged=i.subscribe({event:"VCX_SCENARIO_CHANGED"},(function(e){t.onScenarioChanged(e)})),this._tokenScMoved=i.subscribe({event:"VCX_SCENARIO_MOVED"},(e=>{this.onScenarioMoved(e)})),this._tokenCurrentScenario=i.subscribe({event:"VCX_CURRENT_SCENARIO_CHANGED"},(function(e){t.onCurrentScenarioChanged(e.GetID(),e)})),this._tokenBeginTrans=i.subscribe({event:"VCX_BEGIN_TRANSITION"},(function(e){document.body.addClassName("waiting"),t.onCurrentScenarioChanged(e.scenario._ID,e.scenario),t.hideNeedForUpdate(),t.stopListeningToViewpointChange()})),this._tokenBeginEndTrans=i.subscribe({event:"VCX_END_TRANSITION"},(function(e){document.body.removeClassName("waiting"),i.publish({event:"VCX_UPDATE_MATERIALS_ON_CHANGE_SCENE",data:null}),t.listenToViewpointChange()})),this._tokenScenarioNameChanged=i.subscribe({event:"VCX_SCENARIO_NAME_CHANGED"},(function(e){t.onScenarioNameRefresh(e)})),this._tokenScenarioConcealChanged=i.subscribe({event:"VCX_SCENARIO_CONCEAL_CHANGED"},(function(e){t.onScenarioConceal(e)})),this._tokenScenarioReplaced=i.subscribe({event:"VCX_SCENARIO_REPLACED"},(function(e){t.onScenarioReplaced(e)})),this._tokenScenarioBlured=i.subscribe({event:"VCX_SCENARIO_BLURED"},(function(e){t.onScenarioBlured(e&&e.scenario)})),this._tokenSceneUpdated=i.subscribe({event:"VCX_SCENE_UPDATE"},(function(){t.hideNeedForUpdate()})),this._tokenSelectAll=i.subscribe({event:"VCX_SELECT_ALL"},(function(e){if(e&&"scenePanel"===e.vcxContextType){t._experienceBase.getManager("VCXSelectionManager").setComponentsAsSelection([],!1),t._scenePanelView.selectAll()}})),this._tokenSeqChanged=i.subscribe({event:"VCX_SEQUENCE_CHANGED"},(function(e){t.onSequenceChanged(e)})),this._tokenSelectionRemove=i.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_REMOVE"},(e=>{this.onSelectionRemovedEvent(e)})),this.onResizeCB=function(){}},unInitialize:function(){this._scenePanelView&&this._scenePanelView.unInitialize(),i.unsubscribe(this._tokenScChanged),delete this._tokenScChanged,i.unsubscribe(this._tokenScMoved),delete this._tokenScMoved,i.unsubscribe(this._tokenCurrentScenario),delete this._tokenCurrentScenario,i.unsubscribe(this._tokenBeginTrans),delete this._tokenBeginTrans,i.unsubscribe(this._tokenBeginEndTrans),delete this._tokenBeginEndTrans,i.unsubscribe(this._tokenEndTrans),delete this._tokenEndTrans,i.unsubscribe(this._tokenScenarioNameChanged),delete this._tokenScenarioNameChanged,i.unsubscribe(this._tokenScenarioConcealChanged),delete this._tokenScenarioConcealChanged,i.unsubscribe(this._tokenSelectionRemove),delete this._tokenSelectionRemove,i.unsubscribe(this._tokenSeqChanged),delete this._tokenSeqChanged,i.unsubscribe(this._tokenScenarioReplaced),delete this._tokenScenarioReplaced,i.unsubscribe(this._tokenScenarioBlured),delete this._tokenScenarioBlured,i.unsubscribe(this._tokenSceneUpdated),delete this._tokenSceneUpdated,i.unsubscribe(this._tokenSelectAll),delete this._tokenSelectAll,window.addEventListener&&(window.removeEventListener("resize",this.onResizeCB,!0),delete this._tokenResize),this.onResizeCB=null,this.stopListeningToViewpointChange()},updateAutoRefreshStates:function(){const e=this._experienceBase.getManager("VCXScenarioManager").AutoThumbnailUpdate;this._scenePanelView.headers.defaultSceneHeader.headerToolbar.updateNodeModel("picture-update",{disabled:e}),this._scenePanelView.headers.defaultSceneHeader.headerToolbar.updateNodeModel("autoRefreshChoice",{grid:{data:{menu:[{type:"CheckItem",title:"Auto refresh",state:this._experienceBase.getManager("VCXScenarioManager").AutoThumbnailUpdate?"selected":"unselected",action:{callback:()=>{this._experienceBase.getManager("VCXScenarioManager").AutoThumbnailUpdate=!0,this.updateAutoRefreshStates()}}},{type:"CheckItem",title:"Manual refresh",state:this._experienceBase.getManager("VCXScenarioManager").AutoThumbnailUpdate?"unselected":"selected",action:{callback:()=>{this._experienceBase.getManager("VCXScenarioManager").AutoThumbnailUpdate=!1,this.updateAutoRefreshStates()}}}]}}})},onScenarioChanged:function(e){e.scenarioToAdd?this.createScenarioView(e.scenarioToAdd,e.sequenceIdForAdd,e.scenarioAddIdx):e.scenarioToRemove&&this.removeScenarioView(e.scenarioToRemove.GetID(),e.sequenceIdForRemove)},createScenarioView:function(e,t,i){let n=e.GetName(),a=e.GetID(),r=e.GetScenarioType();var s=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario()===a;"Animation smg"===e.GetName()?this._scenePanelView.createScenario(a,t,n,-1,h.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_Thumbnail_Animation.png"),s,e.GetConcealed()):r===m.EScenarioType.CADView||r===m.EScenarioType.CADCapture||r===m.EScenarioType.Layer||(this._scenePanelView.getCardFromId(a)?(this.onScenarioReplaced(e),this.onScenarioBlured(e)):(this._scenePanelView.createScenario(a,t,n,i,"",s,e.GetConcealed()),this.updateScenarioThumbnail(e),this.updateScenarioBlur(e)))},updateScenarioThumbnail:function(e){let t=this,i=e.GetID(),n=null,a=e.GetDocId(),r=this._experienceBase.getManager("VCXDocManager").GetPropPath(a);if(r){n=r.GetValueURL().GetValue()}if(n){let a=new XMLHttpRequest;a.open("GET",n,!0),a.responseType="blob",a.onload=function(n){if(200==this.status){let n=this.response,a=new FileReader;a.onload=function(n){t._scenePanelView.updateScenario(i,{imageUrl:n.target.result,blur:e.GetDocDirty()})},a.readAsDataURL(n)}},a.send()}else t._scenePanelView.updateScenario(i,{imageUrl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNgYAAAAAMAASsJTYQAAAAASUVORK5CYII=",blur:!1})},updateScenarioBlur:function(e){let t=e.GetID();this._scenePanelView.updateScenario(t,{blur:e.GetDocDirty()})},removeScenarioView:function(e,t){this._scenePanelView.removeScenario(e)},onScenarioNameRefresh:function(e){var t=e.GetID(),i=e.GetName();this._experienceBase.getManager("VCXSequenceManager").GetSequenceFromScenarioId(t);this._scenePanelView.updateScenario(t,{name:i})},onScenarioConceal:function(e){let t=e.scenario.GetID();this._scenePanelView.concealScenario(t,e.concealStatus)},onSelectionRemovedEvent:function(e){for(let t=0;t<e.length;t++){const i=e[t];"VCXScenario"===i.GetType()&&this._scenePanelView.deselectScene(i.GetID())}},onScenarioMoved:function(e){this.moveScenarioView(e.scenarioToAdd.GetID(),e.sequenceIdForRemove,e.sequenceIdForAdd,e.scenarioAddIdx)},moveScenarioView:function(e,t,i,n){this._scenePanelView.moveSceneView(e,t,i,n)},OnEndBuildView:function(){const e=this._experienceBase.getManager("VCXGUIManager"),t=e.GetGUIComponentFromName("VCXPanelCtrl");if(t){t.createBaseView(document.querySelector(".vcxLeftContainer"));const i=e.GetGUIComponentFromName("VCXRatioCtrl");i&&t.createButton(i.getPanelView(),"Canvas","aspect-ratio",1,!0)}this.loadScenariosFromExperience(),this.onCurrentScenarioChanged(this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario())},onCurrentScenarioChanged:function(e,t){"VCX_Scenario_Transition"!==e&&(e&&""!==e&&this.currentScenarioID!==e&&(this.currentScenarioID=e,this._scenePanelView.changeCurrentScenario(e)),this.hideNeedForUpdate())},scrollToThumbnail:function(e){},activateSequence:function(e){this._scenePanelView.activateSequence(e)},onScenarioReplaced:function(e){this.onScenarioNameRefresh(e),this.updateScenarioThumbnail(e),this.hideNeedForUpdate()},onScenarioBlured:function(e){this.updateScenarioBlur(e)},onSequenceChanged:function(e){this.createSequence(e.sequenceToAdd,e.previousSeqIndex)},createSequence:function(e,t){var i=e.GetID(),n=e.GetName();this._scenePanelView.createSequenceView(i,n,h.getWebappsAssetUrl("VCXWebGUI","css/img/VCXSequence.png")),e.GetListScenariosId().every((t=>{let n=e.GetIndexOfScenario(t),a=this._experienceBase.getManager("VCXScenarioManager").GetScenarios()[t];return this.createScenarioView(a,i,n),!0}),this)},RefreshAnimIcon:function(e,t){},loadScenariosFromExperience:function(){for(var e=this._experienceBase.getManager("VCXSequenceManager").GetListSequences(),t=0;t<e.length;t++){var i=e[t],n=t-1;this.createSequence(i,n)}},displayNeedForUpdate:function(){this.getLockSceneUpdateDisplay()||this.playerMode||(this._scenePanelView.displaySceneUpdateButton(),this.stopListeningToViewpointChange(),this._experienceBase.getManager("VCXGUIManager").SetSceneNeedsUpdate(!0))},hideNeedForUpdate:function(){this.playerMode||this.getLockSceneUpdateDisplay()||(this._scenePanelView.hideSceneUpdateButton(),this._experienceBase.getManager("VCXGUIManager").SetSceneNeedsUpdate(!1),this.listenToViewpointChange())},listenToViewpointChange:function(){if(this.getLockSceneUpdateDisplay())return;let e=this._experienceBase.getManager("VCXContextManager").getMainViewer().currentViewpoint;this.currentViewpoint.angle=e.getAngle(),this.currentViewpoint.eyePos=e.getEyePosition(),this.currentViewpoint.sightDir=e.getSightDirection(),this._tokenSceneUpdate||(this._tokenSceneUpdate=i.subscribe({event:"/VISU/"},(e=>{e&&e.viewpoint&&"@onViewpointChange"===e.eventType&&this._experienceBase.getManager("VCXContextManager").getMainViewer()===e.viewpoint.viewer&&(this.currentViewpoint.angle!==e.viewpoint.getAngle()||e.viewpoint.getEyePosition().distanceTo(this.currentViewpoint.eyePos)>1e-10||e.viewpoint.getSightDirection().distanceTo(this.currentViewpoint.sightDir)>1e-10)&&this.displayNeedForUpdate()})))},stopListeningToViewpointChange:function(){this.getLockSceneUpdateDisplay()||this._tokenSceneUpdate&&(i.unsubscribe(this._tokenSceneUpdate),delete this._tokenSceneUpdate)},unlockSceneUpdateDisplay:function(){this._lockedSceneUpdateDisplay=!1},lockSceneUpdateDisplay:function(){this._lockedSceneUpdateDisplay=!0},getLockSceneUpdateDisplay:function(){return this._lockedSceneUpdateDisplay},renameScene:function(e,t){var i=new s(this._experienceBase),n=this._experienceBase.getManager("VCXScenarioManager").GetScenarios()[e].QueryInterface("VCXIModifiable"),a=n.GetProperty("Actor.Name");a.GetPropertyValue().SetValue(t),i.ChangeProperty(n,a),this._experienceBase.getManager("VCXCommandManager").Push(i)},moveScenarioIndex:function(e,t,i){var n=new l(this._experienceBase);n.MoveScenario(e,t,i),this._experienceBase.getManager("VCXCommandManager").Push(n)},changeSceneSelection:function(e,t){let i=this._experienceBase.getManager("VCXScenarioManager").GetScenarios()[e],n=new c(this._experienceBase);t?n.AddToSelection(i):n.RemoveFromSelection(i),this._experienceBase.getManager("VCXCommandManager").Do(n)},deleteScene:function(e){this.changeSceneSelection(e,!0);const t=n.getCommand("VCXDeleteSceneSelectionCmd",this._experienceBase.getManager("VCXContextManager").getContext());t&&t.begin()},replaceScene:async function(e){this.changeSceneSelection(e,!0);const t=n.getCommand("VCXReplaceScenarioCmd",this._experienceBase.getManager("VCXContextManager").getContext());t&&await t.begin(),this.changeSceneSelection(e,!1)},createPIP:function(e){const t=this._experienceBase.getManager("VCXDocManager");console.log(t);const i=n.getCommand("VCXCreateDressup2DImageCmd",this._experienceBase.getManager("VCXContextManager").getContext());i&&i.begin({_sceneIDToUse:e})},duplicateScene:async function(e){const t=this._experienceBase.getManager("VCXScenarioManager"),i=this._experienceBase.getManager("VCXCommandManager");i.StartTransaction();let n=t.GetCurrentScenario();const a=new r(this._experienceBase);a.GoToScenario(e),i.Push(a),await this._experienceBase.getManager("VCXExperience").CreateNewScenario(!1,!1);const s=new r(this._experienceBase);s.GoToScenario(n),i.Push(s),i.EndTransaction()},getSelectedSceneIDs:function(){let e=this._experienceBase.getManager("VCXSelectionManager").GetScenariosComponentsFromCurrentSelection(),t=[];for(let i=0;i<e.length;i++){const n=e[i];t.push(n.GetID())}return t},captureInNewSceneCallback:function(){n.getCommand("VCXCreateScenarioCmd",this._experienceBase.getManager("VCXContextManager").getContext()).begin();let e=this._experienceBase.getManager("VCXAnalyticsTrackerAppManager");e&&e.trackNewSceneCaptureSceneEvent()},updateSceneCallback:function(){const e=n.getCommand("VCXAddCameraKeyCmd",this._experienceBase.getManager("VCXContextManager").getContext());e&&e.begin(),this.hideNeedForUpdate()},concealScene:function(e){var t=new s(this._experienceBase),i=this._experienceBase.getManager("VCXScenarioManager").GetScenarios()[e].QueryInterface("VCXIModifiable"),n=i.GetProperty("Scenario.Conceal");let a=!n.GetPropertyValue().GetValue();n.GetPropertyValue().SetValue(a),t.ChangeProperty(i,n),this._experienceBase.getManager("VCXCommandManager").Push(t)},getScenarioCount:function(){return Object.values(this._experienceBase.getManager("VCXScenarioManager").GetScenariosFromType(m.EScenarioType.Scenario)).length},GetDefaultAmbience:function(){let e=this._experienceBase,t=e.getManager("VCXScenarioManager");for(let i of e.ComponentsMap.GetComponentFromType("AmbienceModel_Spec")){let e=i.QueryInterface("VCXIModifiable");if(!e)continue;let n=t.GetNeutrals(e.GetHashing()),a=n&&n.GetProperty("Ambience.DefaultAmbience");if(a&&a.GetPropertyValue().GetValue())return i}return null},createBaseScene:async function(){let e=this._experienceBase.getManager("VCXCommandManager");this._experienceBase.getManager("VCXScenarioManager");e.StartTransaction();let t=await this._experienceBase.getManager("VCXExperience").CreateNewScenario(!1,!1),a=this._experienceBase.getManager("VCXAnalyticsTrackerAppManager");a&&a.trackNewSceneFromScratchEvent();const s=new r(this._experienceBase);s.GoToScenario(t.GetID()),e.Push(s),this._scenePanelView.displayLoading(t.GetID());let o=this._experienceBase.ComponentsMap.GetComponentFromType("VCXComponentOccurrenceExt");const l=this._experienceBase.ComponentsMap.GetComponentFromType("VCXDressup_Spec"),c=new d(this._experienceBase);c.ChangeVisibility(o,u.EVisState.Visible),e.Push(c);const h=new d(this._experienceBase);h.ChangeVisibility(l,u.EVisState.Hidden),e.Push(h);let p=this._experienceBase.getManager("VCXSelectionManager"),m=this._experienceBase.getManager("VCXContextManager").getActiveViewport(),_=[...o,m],b=this.GetDefaultAmbience();b&&_.push(b),p.setComponentsAsSelection(_,!0);const v=n.getCommand("VCXRestoreNeutralsCmd",this._experienceBase.getManager("VCXContextManager").getContext());v&&await v.begin();let f=this._experienceBase.getManager("VCXContextManager").getMainViewer(),S=f.getSceneBoundingSphere(),V=S.radius,x=S.center,I=V/Math.tan(Math.PI*f.currentViewpoint.getAngle()/360),y=x.clone().add(new g.Vector3(1,1,1).multiplyScalar(I));f.currentViewpoint.setSightDirection(new g.Vector3(-1,-1,-1)),f.currentViewpoint.setUpDirection(new g.Vector3(0,0,1)),f.currentViewpoint.setSightDirection(new g.Vector3(-1,-1,-1)),f.currentViewpoint.setEyePosition(y);const P=m&&m.QueryInterface("VCXIViewpointController"),M=new C;P.fromViewpoint(M),this.updateSceneCallback(),this._scenePanelView.hideLoading(t.GetID()),p.removeComponentsFromSelection(_),this._scenePanelView.editCurrentSceneName(),e.EndTransaction(),i.publish({event:"VCX_UPDATE_MATERIALS_ON_CHANGE_SCENE",data:null})},getPanelView:function(){return this._scenePanelView.panel},GetActiveSequenceId:function(){let e=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario(),t=this._experienceBase.getManager("VCXSequenceManager"),i=t.GetSequenceFromScenarioId(e);return i?i.GetID():t.GetListSequences()[0].GetID()}})}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebGUI/ambiences/VCXAmbienceCurrentView",["require","exports","UWA/Core","DS/VCXGUIInfrastructure/VCXView","DS/VCXGUIInfrastructure/VCXAccordeonUIServices","DS/Controls/Tab","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI","i18n!DS/VCXWebKernel/assets/nls/VCXWebKernel","DS/VCXWebGUI/ambiences/VCXAmbienceCurrentCard"],(function(e,t,i,n,a,r,s,o,l){"use strict";n=__importDefault(n),a=__importDefault(a),r=__importDefault(r),s=__importDefault(s),o=__importDefault(o),l=__importDefault(l);class c extends n.default{constructor(e){super("ambienceCurrentPanel"),this.tabView=null,this.card=null,this.options=e,this.panelAccordeonBackground=a.default.BuildAccordeon(),this.panelAccordeonLightning=a.default.BuildAccordeon(),this.displayedInfo={}}getView(){return this.panelContainer}preparePanel(){this.panelContainer=(0,i.createElement)("div",{class:"vcxPanelContentBody"}),this.uiCardContainer=(0,i.createElement)("div",{class:"vcxUICardContainerAmbience"}),this.uiCardContainer.inject(this.panelContainer),this.tabView=new r.default({displayStyle:"strip"}),this.tabView?.add({label:s.default["Ambience.Current.Background"],content:this.panelAccordeonBackground.getContent(),isSelected:!0}),this.tabView?.add({label:s.default["Ambience.Current.Lightning"],content:this.panelAccordeonLightning.getContent(),isSelected:!1}),this.tabView.inject(this.panelContainer),this.tabView.addEventListener("change",(e=>e.dsModel===this.tabView&&this.options.changeTab(e.dsModel.value)))}getCurrentTab(){return this.tabView?.value[0]}updateImageUICard(e){this.card?.setImage(e)}_updateUICardName(e){this.card?.setLabel(e)}updateUICard(e){this.card?.destroy(),this.card=new l.default({...e,id:e.id}),this.card.getView().inject(this.uiCardContainer),this.card.addRenameCardCallback(e.callbacks.rename),this.card.customizeMenu([{icon:"propagate",subMenu:[{label:o.default["Cmd.ApplyTo.All"],icon:"select-all-checkboxes",stateCheckingCallback:e.callbacks.applyToAvailable.bind(null,!1),action:()=>{e.callbacks.applyTo(!1)}},{label:o.default["Cmd.ApplyTo.Selected"],icon:"select-on",availabilityCheckingCallback:e.callbacks.applyToAvailable.bind(null,!0),action:()=>{e.callbacks.applyTo(!0)}}],label:o.default["Cmd.ApplyTo"]},{icon:"reset",action:e.callbacks.resetValues,label:s.default["VCXAmbienceCtrl.ResetDefaultValues"]},{icon:"trash",...e.callbacks.delete?{action:e.callbacks.delete}:{action:()=>{},state:"disabled"},label:s.default["VCXAmbienceCtrl.DeleteAmbience"]},{icon:"rename",action:()=>this.card?.setEditableLabel(!0,!0),label:s.default["VCXAmbienceCtrl.Rename"]},{icon:"logo-3dspace",action:e.callbacks.share,label:s.default["VCXAmbienceCtrl.Share"]}])}buildPanelContent(e,t){console.log(e);let i=[],n=[];Object.keys(e).every((a=>{let r=e[a];return("background"===r.category?i:"lighting"===r.category?n:[]).push(t.createTweakerGroup({group:r,displayedInfo:this.displayedInfo,callbackActivateDeactivateGroup:(e,t)=>{console.log(e,t)},fullDisableGroup:!1})),!0})),console.log("done"),this._generateProperties(i,this.panelAccordeonBackground),this._generateProperties(n,this.panelAccordeonLightning)}_generateProperties(e,t){for(let i=0;i<e.length;i++){const n=e[i];let r=a.default.AddExpander(t,n.groupAccordeonItem),s=t.getExpanderFromIndex(t.getIndexFromId(r));s.groupID=n.groupAccordeonItem.groupID,s.getContent().style.order=n.groupAccordeonItem.order}}getPanelDisplayedInfo(){return this.displayedInfo}getUIGroupsInfo(){let e=[];for(let t=0;t<this.panelAccordeonBackground.items.length;t++)e.push(this.panelAccordeonBackground.getExpanderFromIndex(t));for(let t=0;t<this.panelAccordeonLightning.items.length;t++)e.push(this.panelAccordeonLightning.getExpanderFromIndex(t));return e}getGroupExpander(e){return a.default.GetExpanderFromHeader(this.panelAccordeonBackground,e)??a.default.GetExpanderFromHeader(this.panelAccordeonLightning,e)}destroyGroup(e){var t=this.panelAccordeonBackground.getIndexFromId(e._expanderId);this.panelAccordeonBackground.deleteItem(t);t=this.panelAccordeonLightning.getIndexFromId(e._expanderId);this.panelAccordeonLightning.deleteItem(t),delete this.displayedInfo[e.groupID]}}return c}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebGUI/ambiences/VCXAmbienceCurrentCtrl",["require","exports","DS/VCXGUIInfrastructure/VCXGUIComponentCtrlTS","DS/VCXWebGUI/ambiences/VCXAmbienceCurrentView","DS/VCXGUIInfrastructure/VCXPropertiesGUIService","DS/VCXWebModifiables/VCXPropertiesObserver","DS/VCXWebGUI/ambiences/VCXAmbienceCtrlServices"],(function(e,t,i,n,a,r,s){"use strict";i=__importDefault(i),n=__importDefault(n),a=__importDefault(a),r=__importDefault(r),s=__importDefault(s);class o extends i.default{GetIdentifier(){return"VCXAmbienceCurrentPanel"}constructor(){super(),this._viewPanel=null,this.initialized=!1,this._ambienceService=null,this.updateLock=!1,this._propertyObserverViewport=new r.default,this._propertyObserverAmbienceCurrent=new r.default}postInitialize(){this._ambienceService=new s.default(this),this.subscribe("VCX_END_LOADING_DONE",(()=>{this.updateSelection();let e=this._ambienceService?.getCurrentViewport();e&&this._propertyObserverViewport.add(e,"Viewport.ActiveAmbience")}))}isDefaultAmbience(){let e=this._ambienceService?.getCurrentAmbience();return!e||e.QueryInterface("VCXIModifiable")?.GetProperty("Ambience.DefaultAmbience").GetPropertyValue().GetValue()}async updateSelection(){let e=this._ambienceService?.getCurrentAmbience();if(!e)return;!this.initialized&&this.instanciatePanel(),this.propertiesService?.setLastSelection([e]);let t=e.QueryInterface("VCXIModifiable");this._viewPanel?.updateUICard({title:t?.GetProperty("Actor.Name").GetPropertyValue().GetValue(),id:e.GetID(),callbacks:{resetValues:()=>e&&this._ambienceService?.resetValues(e.GetID()),applyTo:this._ambienceService.onCallbackApplyTo.bind(this._ambienceService,e.GetID()),applyToAvailable:this._ambienceService.onCallbackApplyToAvailable.bind(this._ambienceService,e.GetID()),delete:this.isDefaultAmbience()?null:()=>e&&this._ambienceService?.deleteAmbience(e.GetID()),rename:(e,t)=>this._ambienceService?.onRenameAmbience(e,t),share:()=>e&&this._ambienceService?.shareAmbience(e.GetID())}}),this._propertyObserverAmbienceCurrent.clear(),this._propertyObserverAmbienceCurrent.addAll(e),this._propertyObserverAmbienceCurrent.dirtify(),this._updateImage()}async _updateImage(){let e=this._ambienceService?.getCurrentAmbience();if(!e)return;let t=this._viewPanel?.getCurrentTab();this._viewPanel?.updateImageUICard(null),setTimeout((async()=>{let i=t?await e.getLightningURL():await e.getBackgroundURL();this._viewPanel?.getCurrentTab()===t&&e===this._ambienceService?.getCurrentAmbience()&&this._viewPanel?.updateImageUICard(i)}),10)}_updateName(){let e=this._ambienceService?.getCurrentAmbience();if(!e)return;let t=e.QueryInterface("VCXIModifiable");this._viewPanel?._updateUICardName(t?.GetProperty("Actor.Name").GetPropertyValue().GetValue())}update(){this._propertyObserverViewport.update(),this._propertyObserverViewport.isDirty()&&this.updateSelection(),this._propertyObserverViewport.reset(),this._propertyObserverAmbienceCurrent.update(),this._propertyObserverAmbienceCurrent.isDirty()&&(this.updateLock=!0,this.propertiesService?.updatePanel([this._ambienceService?.getCurrentAmbience()],this._viewPanel),this.updateLock=!1,this._propertyObserverAmbienceCurrent.isDirtyProperty("Actor.Name")&&this._updateName()),this._propertyObserverAmbienceCurrent.reset()}async showChangeSourcePanel(e){await(this._ambienceService?.showChangeSourcePanel(e))}BuildView(){this.propertiesService=new a.default(this._experienceBase),this._viewPanel=new n.default({changeTab:()=>this._updateImage()}),this._viewPanel.preparePanel();let e=this._viewPanel.getView();e&&this.propertiesService.subscribePropertyEvents(e,{preEditCB:this.onPreEditCb.bind(this),postEditCB:this.onPostEditCb.bind(this),cancelEditCB:this.onCancelEditCb.bind(this),changeCB:this.onChangeCb.bind(this)})}async onPreEditCb(e){this.updateLock=!0,await(this.propertiesService?._onPreEdit(e))}async onPostEditCb(e){this.updateLock=!1,await(this.propertiesService?._onPostEdit(e))}async onCancelEditCb(e){this.updateLock=!1,await(this.propertiesService?._onCancelEdit(e))}async onChangeCb(e){this.updateLock||await(this.propertiesService?._onChange(e))}instanciatePanel(){this.initialized=!0;let e=this._ambienceService?.getCurrentAmbience(),t=this.propertiesService?.BuildIntersectionPropertyGroups([e]),i=t?.getOrderedPropertyGroupsArray();var n={};for(var a in i){var r=i[a];if(this.propertiesService?.getGroupUIInformation(r,n,[e]),n[r.groupID])switch(r.groupID){case"Group.Ambience.Background":case"Group.Ambience.Ground":n[r.groupID].category="background";break;case"Group.Ambience.Lighting":n[r.groupID].category="lighting";break;default:n[r.groupID].category="hidden"}}this.propertiesService&&this._viewPanel?.buildPanelContent(n,this.propertiesService)}unInitialize(){if(super.unInitialize(),this._viewPanel){let e=this._viewPanel.getView();this.propertiesService?.unsubscribePropertyEvents(e),this._viewPanel.unInitialize(),this._viewPanel=null}this._propertyObserverAmbienceCurrent.clear(),this._propertyObserverViewport.clear()}}return o})),define("DS/VCXWebGUI/VCXPropertiesPanelViewV2",["UWA/Class","DS/Windows/Panel","DS/Tweakers/TypeRepresentationFactory","DS/Controls/Button","DS/Controls/Accordeon","DS/WebappsUtils/WebappsUtils","DS/CoreEvents/Events","DS/Core/PointerEvents","DS/Menu/ContextualMenu","DS/VCXGUIInfrastructure/VCXMainPanel","DS/VCXGUIInfrastructure/VCXMainPanelFixed","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI","DS/VCXWebExperienceBase/VCXContextManager","DS/VCXWebGUI/VCXAccordeonPanel"],(function(e,t,i,n,a,r,s,o,l,c,d,u,h,p){"use strict";return e.extend({init:function(e,t,n){this.factory=new i,this.guiService=t,this._selectElementMessage=new UWA.Element("div",{html:"",class:"vcxPanelWatermarkContainer"});let a=new UWA.Element("div",{html:"",class:"vcxSelectEltNode vcxSelectEltIcon fonticon fonticon-touch"}),r=new UWA.Element("div",{html:u["VCXProperties.SelectObj"],class:"vcxSelectEltNode vcxSelectEltTxt"});a.inject(this._selectElementMessage),r.inject(this._selectElementMessage);let s=h.isForceSupported("VCXNewFrame");var o={icon:"attributes",currentDockArea:s?WUXDockAreaEnum.LeftDockArea:WUXDockAreaEnum.RightDockArea,title:u["VCXProperties.PanelTitle"],recId:"vcx-property-panel",immersiveFrame:e,identifier:"propertiesPanelV2",minWidth:250};this.uiPanelClass=s?new p(o,n):new c(o,n),this.uiPanelClass.setPanelContent(this._selectElementMessage),this.panelContentContainer=new UWA.Element("div",{html:"",class:"vcxPanelContentContainer"}),this.panelContentHeader=new UWA.Element("div",{html:"",class:"vcxPanelContentHeader"}),this.panelContentHeader.inject(this.panelContentContainer),this.panelContentBody=new UWA.Element("div",{html:"",class:"vcxPanelContentBody"}),this.panelContentBody.inject(this.panelContentContainer),this.panelContentFooter=new UWA.Element("div",{html:"",class:"vcxPanelContentFooter"}),this.panelContentFooter.inject(this.panelContentContainer),this._displayedInfo={}},unInitialize:function(){this.factory=null,this._displayedInfo=null,this.uiPanelClass.unInitialize()},rebuildPanelUI:function(e,t){if(!e)return void console.error("no information is given to the UI property panel");this.emptyPanelContent();let i=Object.keys(e);this.uiPanelClass.panelAccordeon=this.uiPanelClass._buildAccordeon?this.uiPanelClass._buildAccordeon():new a({items:[],style:"divided",exclusive:!1}),this.panelContentBody.setContent(this.uiPanelClass.panelAccordeon),this.fillPanelWithProperties();let n=[];i.every((i=>{let a=e[i];return n.push(this.guiService.createTweakerGroup({group:a,displayedInfo:this._displayedInfo,callbackActivateDeactivateGroup:this.activateDeactivateGroup.bind(this),fullDisableGroup:t,specialHeaderElement:this.panelContentHeader})),!0}));for(let t=0;t<n.length;t++){const i=n[t];let a=this.uiPanelClass.addExpander?this.uiPanelClass.addExpander(i.groupAccordeonItem):this.uiPanelClass.panelAccordeon.addItem(i.groupAccordeonItem),r=this.uiPanelClass.panelAccordeon.getExpanderFromIndex(this.uiPanelClass.panelAccordeon.getIndexFromId(a));r.groupID=i.groupAccordeonItem.groupID,r.getContent().style.order=i.groupAccordeonItem.order,void 0!==e[i.groupAccordeonItem.groupID].checkbox&&(e[i.groupAccordeonItem.groupID].checkbox||this.activateDeactivateGroup(!1,e[i.groupAccordeonItem.groupID].name))}this.uiPanelClass.panelAccordeon.getContent().style.display="flex",this.uiPanelClass.panelAccordeon.getContent().style.flexDirection="column",this.uiPanelClass.panelAccordeon.getContent().addEventListener("expand",this._expanderExpandCB),this.uiPanelClass.panelAccordeon.getContent().addEventListener("collapse",this._expanderCollapseCB)},rebuildHeaderUI:function(e){e},addPropThumbnail:function(e){new UWA.Element("img",{src:e,class:"vcxPropThumbnail"}).inject(this.panelContentHeader)},getPanelDisplayedInfo:function(){return this._displayedInfo},addPropertyGroup:function(e){this._displayedInfo=e.displayInfo;let t=this.uiPanelClass.panelAccordeon.addItem(e.groupAccordeonItem),i=this.uiPanelClass.panelAccordeon.getExpanderFromIndex(this.uiPanelClass.panelAccordeon.getIndexFromId(t));i.groupID=e.groupAccordeonItem.groupID,i.getContent().style.order=e.groupAccordeonItem.order},getGroupExpander:function(e){if(this.uiPanelClass.getExpanderFromHeader)return this.uiPanelClass.getExpanderFromHeader(e);{let t=this.uiPanelClass.panelAccordeon.getIndexFrom({header:e});return t<0?null:this.uiPanelClass.panelAccordeon.getExpanderFromIndex(t)}},activateDeactivateGroup:function(e,t){let i=this.getGroupExpander(t);!1===e?(i.expandedFlag=!1,i.getContent().style.pointerEvents="none",i.elements.headerArrow.style.color="#b1b1b1"):(i.expandedFlag=!0,i.getContent().style.pointerEvents="",i.elements.headerArrow.style.color="")},getUIGroupsInfo:function(){return this.uiPanelClass.panelAccordeon&&[...this.uiPanelClass.panelAccordeon._expanderItems]},ambienceApplyFunction:function(){console.warn("button did nothing: callback was not given to PanelView")},onClickLabel:function(){},onDoubleClickLabel:function(){},uiSelect:function(e,t){let i=Object.keys(this._displayedInfo);for(let n in i){let a=i[n],r=this._displayedInfo[a];if(r[e]){let i,n=r[e].tweakers;n.length>0&&(i=n[0].getContent().closest(".vcxPropertyLine")),i.style.backgroundColor=t?"#4f91cd":""}}},selectAllProps:function(){let e=[],t=document.getElementsByClassName("vcxPropertyLabel");for(let i=0;i<t.length;i++){let n=t[i];e.includes(n.propertyId)||e.push(n.propertyId),this.uiSelect(n.propertyId,!0)}return e},deselectAllProps:function(){let e=document.getElementsByClassName("vcxPropertyLabel");for(let t=0;t<e.length;t++){let i=e[t];this.uiSelect(i.propertyId,!1)}},generateHeaders:function(e){this.uiPanelClass.generateHeaders(e)},emptyPanelContent:function(){let e=Object.keys(this._displayedInfo);for(let t in e){let i=this._displayedInfo[e[t]],n=Object.keys(i);for(let e in n){let i=n[e];this.guiService.destroyTweakerLine(i,t,this._displayedInfo)}}this.uiPanelClass.setPanelContent(this._selectElementMessage),this.uiPanelClass.panelAccordeon&&this.uiPanelClass.panelAccordeon.clear(),this.uiPanelClass.getPanel().removeEventListener("change",this.changeEvent),this.panelContentHeader.replaceChildren(),this.panelContentBody.replaceChildren(),this.panelContentFooter.replaceChildren(),this._displayedInfo={}},destroyGroup:function(e){var t=this.uiPanelClass.panelAccordeon.getIndexFromId(e._expanderId);this.uiPanelClass.panelAccordeon.deleteItem(t),delete this._displayedInfo[e.groupID]},fillPanelWithProperties:function(){this.uiPanelClass.setPanelContent(this.panelContentContainer),this.uiPanelClass.getPanel().addEventListener("change",this.changeEvent)},changeEvent:function(e){},subscribeTweakerEvent:function(e,t){"string"==typeof e&&"function"==typeof t&&this.uiPanelClass.getPanel().addEventListener(e,t)},unsubscribeTweakerEvent:function(e,t){"string"==typeof iEventName&&"function"==typeof iEvtCb&&this.uiPanelClass.getPanel().removeEventListener(e,t)},changeFormatPainterButtonVisibility:function(e){let t=this.uiPanelClass.getPanel().getElementsByClassName("VCXSingleFormatPainterCmd")[0];t&&(e?t.removeClassName("vcxHidden"):t.addClassName("vcxHidden"))}})})),define("DS/VCXWebGUI/VCXPropertiesCtrlExt",["DS/VCXGUIInfrastructure/VCXGUIComponentCtrl","DS/Controls/Button","DS/CoreEvents/Events","DS/Tweakers/TweakerBlob","DS/Tweakers/TweakerBoolean","DS/Tweakers/TweakerColor","DS/Tweakers/TweakerDate","DS/Tweakers/TweakerNumber","DS/Tweakers/TweakerString","DS/Tweakers/TweakerVector","DS/WebappsUtils/WebappsUtils","DS/VCXWebGUI/VCXPropertiesPanelModel","DS/VCXWebGUI/VCXPropertiesPanelViewV2","DS/VCXGUIInfrastructure/VCXPropertiesGUIService","DS/VCXWebIO/VCXFileServices","DS/VCXWebKernel/VCXCmdChangeSelection","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebKernelCommands/VCXCmdRequestChangeProperties","DS/VCXWebSystem/VCXObjectTools","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyGroupSet","DS/VCXWebProperties/VCXPropertyValueDate","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueLink","DS/VCXWebPlatform/VCXPlatformServices","DS/VCXWebPlatform/VCX3DSpaceServices","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI","i18n!DS/VCXWebModifiables/assets/nls/VCXWebModifiables","i18n!DS/VCXWebProducts/assets/nls/VCXWebProductAuthoringCommands"],(function(e,t,i,n,a,r,s,o,l,c,d,u,h,p,m,C,g,_,b,v,f,S,V,x,I,y,P,M,w,D,X){"use strict";var A="vcx-properties-group-propsContainer",T="vcx-propNode-prop",E="vcx-propNode-label",B="vcx-propNode-prop-tweakers",G=e.extend({init:function(){},BuildView:function(e){G.PlayerMode=Boolean(e.playerMode),this._vcxGuiManager=this._experienceBase.getManager("VCXGUIManager"),this._propertiesPanelModel=new u(this._experienceBase),this._propertiesService=new p(this._experienceBase),this._cmdApplyRequestChangeProperty=new _(this._experienceBase),this._cmdSimulateRequestChangeProperty=new _(this._experienceBase);var t=this._vcxGuiManager.immersiveFrame;if(t||(t=this._experienceBase.getManager("VCXContextManager").getFrameWindow().getImmersiveFrame()),this._propertiesPanelViewV2=new h(t,this._propertiesService,this._experienceBase.getManager("VCXContextManager").getContext()),this._selectedPropsArray=[],this._disableLinkedProperties=!1,this._listTweakersWithPtrUpEvt=null,this._listButtonsLockToUnsubscribe=null,this._tokenSelectionAdd=i.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_ADD"},(e=>{e.includes(this._experienceBase.ComponentsMap.GetComponentFromID("ViewpointID"))&&(this._viewportInSelection=!0),this.requestRefresh(!1)})),this._tokenSelectionRemove=i.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_REMOVE"},(e=>{e.includes(this._experienceBase.ComponentsMap.GetComponentFromID("ViewpointID"))&&(this._viewportInSelection=!1),this.requestRefresh(!1)})),this._tokenPropertiesChanged=i.subscribe({event:"VCX_PROPERTIES_CHANGED"},(()=>{this.onPropertiesChanged()})),this._tokenTimePosChanged=i.subscribe({event:"VCX_TIMEPOS_CHANGED"},(()=>{this.requestRefresh(!1)})),this._textureUploadPlaceHolder="",this._imageUploadPlaceHolder="",this._textureUploadPlaceHolder=w.get("VCXProperties.TextureUploadPlaceHolder"),this._imageUploadPlaceHolder=w.get("VCXProperties.ImageUploadPlaceHolder"),!G.PlayerMode){var n="1"==this._experienceBase.getManager("VCXContextManager").getUrlVars().linkedProperties,a="1"==this._experienceBase.getManager("VCXContextManager").getUrlVars().stylestree;this._propertiesPanelView&&this._propertiesPanelView.createToolbarCommands(n,a)}this._copyProperties=null,this._copyModifiables=null,this._onShowTweakerCB=this._onShowTweaker.bind(this),this._onHideTweakerCB=this._onHideTweaker.bind(this),this._onCancelEditCB=e=>{this._propertiesService._onCancelEdit(e)},this._onPreEditCB=async e=>{this._preventRefresh=!0,this._propertiesService._onPreEdit(e)},this._onPostEditCB=async e=>{this._propertiesService._onPostEdit(e)},this._onLiveChangeCB=e=>{this._propertiesService._onLiveChange(e)},this._onChangeCB=async e=>{this.controllerIsUpdatingUI||(this._preventRefresh=!0,await this._propertiesService._onChange(e),i.publish({event:"VCXActiveCardMATERIAL",data:null}),this._experienceBase.getManager("VCXCommandManager").EndTransaction())},this._onButtonClickCB=this._onButtonClick.bind(this),this._onExpandCB=this._onExpand.bind(this),this._onCollapseCB=this._onCollapse.bind(this),this._propertiesPanelView&&(this._propertiesPanelView.subscribeTweakerEvt("show",this._onShowTweakerCB),this._propertiesPanelView.subscribeTweakerEvt("hide",this._onHideTweakerCB),this._propertiesPanelView.subscribeTweakerEvt("cancelEdit",this._onCancelEditCB),this._propertiesPanelView.subscribeTweakerEvt("preEdit",this._onPreEditCB),this._propertiesPanelView.subscribeTweakerEvt("liveChange",this._onLiveChangeCB),this._propertiesPanelView.subscribeTweakerEvt("change",this._onChangeCB),this._propertiesPanelView.subscribeTweakerEvt("postEdit",this._onPostEditCB),this._propertiesPanelView.subscribeTweakerEvt("buttonclick",this._onButtonClickCB)),this._propertiesService.subscribePropertyEvents(this.getPanelView(),{preEditCB:this._onPreEditCB,changeCB:this._onChangeCB}),this._propertiesPanelViewV2._expanderExpandCB=this._onExpandCB,this._propertiesPanelViewV2._expanderCollapseCB=this._onCollapseCB,this._propertiesService.restoreFunction=this.restoreProperties.bind(this),this._propertiesService.goToParentFunction=this.navigateToParent.bind(this),this._propertiesService.clearFunction=this.clearProperties.bind(this);let r=[{id:"defaultPropHeader",title:w["VCXProperties.PanelTitle"],default:!0,commands:[{type:"command",icon:"reset",commandID:"VCXRestoreNeutralsCmd",i18n:X.get("VCXRestoreNeutralsCmd"),hidden:G.PlayerMode},{type:"command",icon:"floppy",commandID:"VCXCaptureInNeutralsCmd",i18n:X.get("VCXCaptureInNeutralsCmd"),hidden:G.PlayerMode}],specialButtons:[{type:"clickDblClick",icon:"brush-large",commandIDClick:"VCXSingleFormatPainterCmd",commandIDDlbClick:"VCXMultipleFormatPainterCmd",i18n:X.get("VCXFormatPainterCmd"),hidden:!0}]}];this._propertiesPanelViewV2.generateHeaders(r),this._propertiesService.setLastSelection([]),this._changeInLocks=!1,this._preventRefresh=!1},GetIdentifier:function(){return"propertiesPanelV2"},GetDockingInfo:function(){return{area:WUXDockAreaEnum.RightDockArea,order:10}},OnEndBuildView:function(){const e=this._experienceBase.getManager("VCXGUIManager").GetGUIComponentFromName("VCXPanelCtrl");e&&e.createButton(this.getPanelView(),"Properties","parameters",10)},CopyProperties:function(e,t){this._copyProperties=e,this._copyModifiables=t},GetCopiedProperties:function(){var e={};return e.properties=this._copyProperties,e.arrayMod=this._copyModifiables,e},requestRefresh:function(e){this._refreshRequested=e?2:1,this._refreshMaxinterval=500},update:function(e){(2===this._refreshRequested&&(this.requestChangeInPanel(),this._refreshRequested=0),1===this._refreshRequested&&(this._refreshMaxinterval<=0&&(this.requestChangeInPanel(),this._refreshRequested=0),this._refreshMaxinterval-=e.deltaTime),this._viewportInSelection)&&(this._experienceBase.getManager("VCXVisuManager").viewpointHasMoved&&this.requestRefresh(!1))},_onNodeModelUpdate:async function(e,t){if(!(e&&e.dsModel&&e.dsModel.internalOptions))return;var i=e.dsModel;i.propName=e.dsModel.internalOptions.propName,this._propertiesService.getModificationStatus()&&(i.std=i.value||void 0!==i.checkFlag&&i.checkFlag);var n={};this._experienceBase;this.getCID4Property(i,n,e);var a=n.vcxValue,r=n.propertyName;if("VCXPropertyValueColor"===i.dataType){let e=d.GetProperty(r).GetPropertyValue();if(!e)return;var s=e.GetPropertyValue().ToString(),o=a;if(o.substr(0,o.lastIndexOf(","))===s.substr(0,s.lastIndexOf(",")))return}for(var l=this._propertiesService.getLastSelection().map((e=>e.QueryInterface("VCXIModifiable"))),c=0;c<l.length;c++){var d=l[c];if(-1!==r.search("Hyperlink_")){r="Actor.Hyperlink";let e=d.GetProperty(r).GetPropertyValue(),t=d.GetProperty(r).GetPropertyInfo();a=this._propertiesService.getNewValueFromBoxedProperty("hyperlink",e,t,i).GetValue(),this._propertiesPanelModel.resetSavedPanelState()}else if(-1!==r.search("Text.Font")){r="Collab.Text.Font";let e=d.GetProperty(r).GetPropertyValue(),t=d.GetProperty(r).GetPropertyInfo();a=this._propertiesService.getNewValueFromBoxedProperty("font",e,t,i)}else if(-1!=r.search("_Position")||-1!=r.search("_Orientation")||-1!=r.search("_Scale")||-1!=r.search("_Pivot")){(r=r.replace(/(\_\w+$)/,""))||console.log("Issue computing mainPropName from boxedProperty name");let e=d.GetProperty(r).GetPropertyValue(),t=d.GetProperty(r).GetPropertyInfo();a=this._propertiesService.getNewValueFromBoxedProperty("frame",e,t,i)}}let u;if(t){u=(await this._cmdSimulateRequestChangeProperty.RequestModification(l,r,null,a)).Clone()}else{u=(await this._cmdApplyRequestChangeProperty.RequestModification(l,r,null,a)).Clone()}this.applyOrSimulate(t)},applyOrSimulate:function(e){if(!e&&(this._propertiesService.getModificationStatus()&&(this._preventRefresh=!0),this._experienceBase.getManager("VCXCommandManager").Push(this._cmdApplyRequestChangeProperty),this._cmdApplyRequestChangeProperty=new _(this._experienceBase),!this._propertiesService.getModificationStatus())){this._canceledEdit&&("Transaction: Canceled edit Properties via Panel",this._canceledEdit=!1)}},_getNewPropFromNewValue:function(e,t,i){var n=!1,a=e.GetProperty(t);!0===a.GetPropertyValue()._bUndefined&&(i===a.GetPropertyValue().ToString()&&(n=!0));var r=null;n||(r=a.Clone()).GetPropertyValue().FromString(i);return r},unInitialize:function(){i.unsubscribe(this._tokenSelectionAdd),delete this._tokenSelectionAdd,i.unsubscribe(this._tokenSelectionRemove),delete this._tokenSelectionRemove,i.unsubscribe(this._tokenTimePosChanged),delete this._tokenTimePosChanged,i.unsubscribe(this._tokenPropertiesChanged),delete this._tokenPropertiesChanged,this._onPreEditCB=null,this._onPostEditCB=null,this._onLiveChangeCB=null,this._onChangeCB=null,this._onButtonClickCB=null,this._propertiesPanelModel&&(this._propertiesPanelModel.unInitialize&&this._propertiesPanelModel.unInitialize(),this._propertiesPanelModel=null),this._propertiesPanelView&&(this._propertiesPanelView.unInitialize&&(this._propertiesPanelView.unsubscribeTweakerEvt("show",this._onShowTweakerCB),this._propertiesPanelView.unsubscribeTweakerEvt("hide",this._onHideTweakerCB),this._propertiesPanelView.unsubscribeTweakerEvt("cancelEdit",this._onCancelEditCB),this._propertiesPanelView.unsubscribeTweakerEvt("preEdit",this._onPreEditCB),this._propertiesPanelView.unsubscribeTweakerEvt("liveChange",this._onLiveChangeCB),this._propertiesPanelView.unsubscribeTweakerEvt("change",this._onChangeCB),this._propertiesPanelView.unsubscribeTweakerEvt("postEdit",this._onPostEditCB),this._propertiesPanelView.unsubscribeTweakerEvt("buttonclick",this._onButtonClickCB),this._propertiesPanelView.unInitialize()),this._propertiesPanelView=null),this._propertiesPanelViewV2&&(this._selectedPropsArray=null,this._propertiesPanelViewV2.unInitialize&&this._propertiesPanelViewV2.unInitialize(),this._propertiesPanelViewV2=null),delete G.PlayerMode,this.options&&delete this.options,this._vcxGuiManager&&delete this._vcxGuiManager},getCID4Property:function(e,t,i){if(t.propertyName=e.propName,t.vcxValue=e.value+"",e.propName.endsWith(".Availability"))t.vcxValue=e.value?3:4;else if("tweakerEnum"===e.name||"TweakerString"===e.name&&("combo"===e.displayStyle||"buttonGroup"===e.displayStyle)){var n=e.value,a={},r=this._propertiesService.getLastSelection()[0].QueryInterface("VCXIModifiable").GetProperty(t.propertyName);if(r){var s=r.GetPropertyInfo();a=e.internalOptions&&e.internalOptions.mapChoiceEnum?e.internalOptions.mapChoiceEnum:s.GetMapChoiceEnum()}for(var o in a)if(a.hasOwnProperty(o)){var l=a[o],c=l,d=c;if("1"!=this._experienceBase.getManager("VCXContextManager").getUrlVars().noNLS){let e=s.Geti18n();if(e&&(d=e[c]),void 0===d)this._experienceBase.getManager("VCXStylesManager")&&(d=D[c]);void 0===d&&(d=c)}if(d===n){t.vcxValue=o;break}if(l===n){t.vcxValue=o;break}}}else if("tweakerBlob"===e.name&&"VCXPropertyValueDocId"===e.internalOptions.dataType){var u="";i&&(u=i.target.dsModel._blobName);var h=m.dataURLToBlob(t.vcxValue),p=window.URL.createObjectURL(h),C=this._experienceBase.getManager("VCXDocManager").BuildPathFromString(p),g=new I;g.SetValue(u),C.SetFileName(g);var _=this._experienceBase.getManager("VCXDocManager").AddOrModifyDoc(C);t.vcxValue=String(_.GetValue())}else if("TweakerColor"===e.name){var b="#"+t.vcxValue,v=new x;v.GetValue().FromHexString(b);var f=v.ToString();t.vcxValue=f}else if("TweakerVector"===e.name)t.vcxValue="["+t.vcxValue+"]";else if("TweakerString"===e.name)if(e.propName.includes("StipplingMotif")&&e.value.length>0)if(e.value===""+parseFloat(e.value))t.vcxValue=e.value;else{var S=e.value.match(/\d+(?:\.\d+)?/g),V=S&&S.map((e=>parseFloat(e)));t.vcxValue=V?V.join(" "):"0"}else t.vcxValue=e.value},onPropertiesChanged:function(e){this._preventRefresh||this.requestRefresh(!1),this._preventRefresh=!1},getGroupUIInformation:function(e,t){if(!1!==e.availability){var i=e.groupID;""===i&&(i="Group.Essentials");var n={propertyGroup:e,modifiableViewList:this._propertiesService.getSelectedModifiableviews(this._propertiesService.getLastSelection())},a={name:this._propertiesService._getTranslationI18n(n).groupName,arrayProps:[],groupID:i};if(t[i]=a,t[i].order=e.priority,t[i].collapsed=this.getCollapsedGroupIds().includes(i),"boolean"!=typeof e.availability&&"boolean"==typeof e.visibility){if(void 0===e.availability&&"boolean"==typeof e.visibility&&""===e.PropertyControlingGroupVisibility)throw new Error("PropertyControlingGroupVisibility is undefined but a visibility was set on this group. Check the type of Availability given to the group.");t[i].checkbox=e.visibility,t[i].showPropName=e.PropertyControlingGroupVisibility}var r=new S;r.AddOrModifyGroup(e.clone());var s=this._propertiesService._getPropertiesFromPropertyGroups(this._propertiesService.getLastSelection(),r)._map,o=e.getPropertiesIDsOrderedArray();for(var l in o){var c=o[l],d=s[c];this._propertiesService.getPropertyUIInformation(c,d,e,s,t[i],this._propertiesService.getLastSelection())}0!==t[i].arrayProps.length||"checkbox"in t[i]||delete t[i]}},getCollapsedGroupIds:function(){var e=[],t=this._propertiesService.getSelectedModifiableviews(this._propertiesService.getLastSelection()),i=this;return t.every((t=>{var n,a=t.GetObject();if(this._propertiesPanelModel.isCollapsedGroupsSavedForComponent(a)){var r=[a];n=i._propertiesPanelModel.getCollapsedGroupsForComponents(r)}else n=t.getCollapsedGroupsNames(),this._propertiesPanelModel.setCollapsedGroupsForComponent(a,n);return n.every((t=>(e.includes(t)||e.push(t),!0))),!0})),e},RebuildPanel:async function(e){this._propertiesService.setLastSelection(e);var t=this._propertiesService.BuildIntersectionPropertyGroups(e).getOrderedPropertyGroupsArray(),i=this._propertiesService.getSelectedModifiableviews(this._propertiesService.getLastSelection()),n={};for(var a in t){var r=t[a];this.getGroupUIInformation(r,n)}if(this._propertiesPanelViewV2.rebuildPanelUI(n,G.PlayerMode),1===i.length&&this._propertiesPanelViewV2.rebuildHeaderUI(i[0].GetObject().GetType()),this._experienceBase.getManager("VCXContextManager").isSupported("VCXPropertyThumbnailSupport")&&1===i.length){const e=i[0].GetObject(),t=e._refid||e.QueryInterface("CATI3DXAssetProperties")&&await e.QueryInterface("CATI3DXAssetProperties").getPhysicalId(),n=await M.Get3DSpaceURL(),a=n&&t&&await P.getObjectInfo(t,n);a&&this._propertiesPanelViewV2.addPropThumbnail(a&&a.dataelements&&a.dataelements.image)}},EnsureVisible:function(){this.getPanelView()&&this.getPanelView().ensureVisible&&this.getPanelView().ensureVisible()},compareValues:function(e,t,i,n){var a=!1,r=!1,s=t,o=e.GetPropertyInfo().GetPropertyName();if("VCXPropertyValueDocId"===i){if(t!==n&&t>=0){var l=this._experienceBase.getManager("VCXDocManager").GetPropPath(t);s=l&&l.GetFileName().GetValue(),a=!0}t<0&&(s=null)}return"VCXPropertyValueBase64"===i||(e.GetPropertyValue().GetType()!==i?r=!0:t.GetColorHexString?"#"+t.GetColorHexString()!==n&&(s=t.GetColorHexString(),a=!0):n.equals?n.equals(t.toArray())||(s=t.toArray(),a=!0):"VCXPropertyValueEnum"===e.GetPropertyValue().GetType()?e.GetPropertyInfo().GetMapChoiceEnum()[t]!==n&&(s=e.GetPropertyInfo().GetMapChoiceEnum()[t],a=!0):n!==t&&(typeof n==typeof t?a=!0:console.log("%c there is an comparison issue with property: "+o,"color: red"))),{needToRebuild:r,needToUpdate:a,valueForTweaker:s}},comparePropSettingsButtons:function(e,t){if(!e||!t)return;let i={add:[],remove:[],update:[],rebuild:[]},n={...t};for(let a=0;a<e.length;a++){let r=e[a],s=t[r.type];if(s){b.deepCompare(r,t[r.type].buttonInfo)||(r.data&&!b.deepCompare(r.data,s.buttonInfo.data)?i.rebuild.push(r):i.update.push(r)),delete n[r.type]}else i.add.push(r)}for(const e in n)if(Object.hasOwnProperty.call(n,e)){const t=n[e];i.remove.push(t.buttonInfo)}return i},getAdditionalSettingsForProp:function(e){var t=this._propertiesService.getSelectedModifiableviews(this._propertiesService.getLastSelection())[0],i=t.getAdditionalPropertySettings&&t.getAdditionalPropertySettings();return i&&i[e]?i[e]:null},emptyPanel:function(){this._propertiesPanelViewV2&&(this._propertiesPanelViewV2.emptyPanelContent(),this._propertiesService.setLastSelection([]),this._selectedPropsArray=[])},requestChangeInPanel:function(){var e=this._experienceBase.getManager("VCXSelectionManager").GetComponentsFromCurrentSelection(),t=!0;this._experienceBase.getManager("VCXContextManager").isSupported("PropertyPanelV2")||(t=!1),this._propertiesService.getModificationStatus()&&(t=!1);var i=this._experienceBase.getManager("VCXManipulatorManager").checkManipulationInProgress();for(var n in i&&(t=!1),e)if(!e[n].QueryInterface("VCXIModifiableView")){t=!1,console.warn("No modifiable view found for some elements selected");break}t&&(this._propertiesService.getLastSelection().equals(e)?(this.controllerIsUpdatingUI=!0,this._propertiesService.updatePanel(e,this._propertiesPanelViewV2),this.controllerIsUpdatingUI=!1):0===e.length?this.emptyPanel():this.RebuildPanel(e))},ambienceApplyFunction:function(){var e=this._propertiesService.getLastSelection()[0],t=this._experienceBase.getManager("VCXContextManager").getActiveViewport();if(t){var i=t.QueryInterface("VCXIModifiable");if(i){var n=e.GetObject().GetID(),a=new y(n),r=new v(new f("Viewport.ActiveAmbience",0),a),s=new g(this._experienceBase,!0);s.ChangeProperty(i,r),this._experienceBase.getManager("VCXCommandManager").Push(s)}}},activateLabelSelection:function(){this._propertiesPanelViewV2.onClickLabel=this.onClickLabel.bind(this),this._propertiesPanelViewV2.onDoubleClickLabel=this.onDoubleClickLabel.bind(this)},onClickLabel:function(e){if(2===e.detail)return;let t=e.target.propertyId;if(this._selectedPropsArray&&t)if(this._selectedPropsArray.includes(t)){let e=this._selectedPropsArray.indexOf(t);this._selectedPropsArray.splice(e,1),this._propertiesPanelViewV2.uiSelect(t,!1)}else this._selectedPropsArray.push(t),this._propertiesPanelViewV2.uiSelect(t,!0)},requestPropertiesPanelRefresh:function(){this.requestRefresh()},onDoubleClickLabel:function(e){if(this._selectedPropsArray.includes(e.target.propertyId)){let e=this._propertiesPanelViewV2.selectAllProps();this._selectedPropsArray=e}else this._propertiesPanelViewV2.deselectAllProps(),this._selectedPropsArray=[]},GetSelectedProperties:function(){if(this._selectedPropsArray)return this._selectedPropsArray},_generateDivForProperty:function(e){var i=new UWA.Element("div",{class:T});if(new UWA.Element("div",{html:e.label,class:E}).inject(i),e.tweaker&&e.tweaker.inject(i),e.propSettings&&(e.propSettings.disableLiveChange&&"number"==typeof e.propSettings.disableLiveChange&&i.addEventListener("liveChange",(t=>{t.stopPropagation(),this._liveChangeTimeout&&clearTimeout(this._liveChangeTimeout),this._liveChangeTimeout=setTimeout((()=>{this._onLiveChange(t),this._liveChangeTimeout=void 0}),e.propSettings.disableLiveChange)})),e.propSettings.buttons))for(var n=0;n<e.propSettings.buttons.length;n++){var a=e.propSettings.buttons[n],r=null;if(a.available){if("Restore"===a.type){var s=!1;if(a.data&&a.data.propertiesToRestore&&a.data.object)for(var o=this._experienceBase.getManager("VCXScenarioManager"),l=a.data.object.QueryInterface("VCXIModifiable"),c=0;c<a.data.propertiesToRestore.length;c++){var u=a.data.propertiesToRestore[c];if(o.IsCurrentPropertyDifferentFromNeutral(l,u)){s=!0;break}}(r=new t({displayStyle:"lite",disabled:!s,icon:{iconPath:d.getWebappsAssetUrl("VCXWebGUI","icons/32/VCX_Restore_grey.png")}})).elements.container.title=a.tooltip||"Restore Default Value",a.location=20,r.additionalButtonFunction=this.restoreProperties.bind(this),r.additionalButtonFunctionArgs={data:a.data},i.addClassName("vcx-prop-restorable")}else if("NavigateTo"===a.type){i.getChildren().every((e=>(e.hasClassName("vcx-propNode-label")||i.removeChild(e),!0))),new UWA.Element("div",{html:"Overruled",class:"vcx-prop-overruled"}).inject(i),r=new t({label:"Go to parent"}),a.location=20,r.additionalButtonFunction=this.navigateToParent.bind(this),r.additionalButtonFunctionArgs={data:a.data},r.getContent().addClassName("vcx-goToParent-button")}else"ChangeProperties"===a.type?(r=new t({displayStyle:"lite",icon:{iconName:"3dproduct",fontIconFamily:WUXManagedFontIcons.Font3DS}}),a.location=20,r.additionalButtonFunction=this.changePropsOfModifiable.bind(this),r.additionalButtonFunctionArgs={data:a.data}):((r=new t({displayStyle:"lite",icon:{iconName:a.iconName||"i-question",fontIconFamily:WUXManagedFontIcons.Font3DS}})).additionalButtonFunction=a.functionCB,r.additionalButtonFunctionArgs={name:a.name,propertyName:e.propSettings.propertyName,data:a.data},r.elements.container.title=a.tooltip||"");a.location?a.location>i.getChildren().length?r.inject(i):i.insertBefore(r.getContent(),i.getChildren()[a.location-1]):console.warn("A button "+a.name+" was attempted to be created without location: button not created")}}return i},_generateExpanderInfosForGroup:function(e){var t={header:e.label,body:null,groupID:e.groupID};if(e.group){var i=null;"boolean"==typeof e.toggle&&"Actor.Hyperlink_Action"!==e.propName&&(i=new a({displayStyle:"switch",value:e.toggle,disabled:e.disabled||G.PlayerMode}),e.groupID&&i.elements.container.addClassName("vcx-tweaker-group-"+e.groupID.replaceAll(".","-").replaceAll("_","-")),i.internalOptions={propName:e.propName,touch:this._vcxGuiManager.isTouchActivated()},t.customHeader=i,t.hideArrow=!e.toggle,G.PlayerMode||(i.addEventListener("pointerup",this._onTweakerPointerUpCB),this._listTweakersWithPtrUpEvt.push(i)))}return t},navigateToParent:function(e){if(e&&e.data&&e.data.objectToNavigateTo){var t=this._experienceBase.getManager("VCXCommandManager"),n=(this._experienceBase.getManager("VCXSelectionManager"),new C(this._experienceBase));n.SetSelection(e.data.objectToNavigateTo),t.Do(n),i.publish({event:"VCXActiveCardMATERIAL",data:null})}},restoreProperties:function(e){if(e&&e.data&&e.data.propertiesToRestore&&e.data.object){var t=this._experienceBase,n=t.getManager("VCXCommandManager"),a=t.getManager("VCXScenarioManager"),r=e.data.object.QueryInterface("VCXIModifiable"),s=r.GetHashing();if(s){var o=a.GetNeutrals(s);if(o){this._preventRefresh=!0;for(var l=0;l<e.data.propertiesToRestore.length;l++){var c=e.data.propertiesToRestore[l];if(o._map.hasOwnProperty(c)){var d=o.GetProperty(c);if(d){var u=new g(t);u.ChangeProperty(r,d),n.Push(u)}}}i.publish({event:"VCXActiveCardMATERIAL",data:null}),this._preventRefresh=!1}}}},clearProperties:function(e){if(e&&e.data&&e.data.propertiesToClear&&e.data.object&&this._vcxGuiManager&&this._experienceBase){let t=this._experienceBase,i=t.getManager("VCXCommandManager");t.getManager("VCXScenarioManager");for(let n=0;n<e.data.object.length;n++){let a=e.data.object[n].QueryInterface("VCXIModifiable");this._preventRefresh=!0;for(let n=0;n<e.data.propertiesToClear.length;n++){let r=e.data.propertiesToClear[n],s=a.GetProperty(r);if("Actor.PartList.ID"!==r&&"Actor.PartList.Description"!==r||(s._propertyValue._value=""),s){let e=new g(t);e.ChangeProperty(a,s),i.Push(e)}}}this._preventRefresh=!1}},changePropsOfModifiable:function(e){if(e&&e.data&&e.data.propertyMapToApply){var t=this._experienceBase,i=t.getManager("VCXCommandManager"),n=new g(t),a=e.data.propertyMapToApply,r=[];if(a&&a.GetListModifiables&&a.GetPropertySet){i.StartTransaction();var s=t.getManager("VCXScenarioManager").ModifiableServer;a.GetListModifiables(r);for(var o=0;o<r.length;o++){var l=r[o],c=a.GetPropertySet(l)._map;for(var d in c)if(c.hasOwnProperty(d)){var u=a.GetPropertySet(l).GetProperty(d);u&&n.ChangeProperty(s.GetModifiableFromHashing(l),u)}}t.getManager("VCXCommandManager").Push(n),i.EndTransaction()}else console.error("argument is not a VCXPropertyMap")}else console.warn("Arguments not suitable to change properties")},_onShowTweaker:function(e){},_onHideTweaker:function(e){},_onButtonClick:function(e){e.dsModel&&e.dsModel.additionalButtonFunction&&e.dsModel.additionalButtonFunction(e.dsModel.additionalButtonFunctionArgs)},_onExpand:function(e){var t=e.options.expanderTarget.groupID;t&&this._propertiesPanelModel.removeCollapsedGroupForComponents(this._propertiesService.getLastSelection(),t)},_onCollapse:function(e){var t=e.options.expanderTarget.groupID;t&&this._propertiesPanelModel.addCollapsedGroupForComponents(this._propertiesService.getLastSelection(),t)},_isPropLocked:function(e){return e.GetLockedStatus()},getPanelView:function(){return this._propertiesPanelViewV2.uiPanelClass.panel},_simplifyNumberDisplay:function(e,t){if(Number.isInteger(e))return e;if(Math.abs(e)<1e-5)return 0;var i="number"==typeof t?t:2;return"number"!=typeof e?void 0===e?e:(console.warn("TweakerNumber object needs a number as input"),null):Math.abs(e)<1?Number(e.toPrecision(i)):Number(e.toFixed(i))},changeFormatPainterUIVisibility:function(e){this._propertiesPanelViewV2&&this._propertiesPanelViewV2.changeFormatPainterButtonVisibility(e)},displayFakePropertiesForODT:function(){this._listTweakersWithPtrUpEvt=[];var e=this._generateAllTweakersTypes(),t=Object.keys(e),i=null,n=null,a=new UWA.Element("div",{class:A}),r=this._generateExpanderInfosForGroup({label:"Group ODT",group:!0,toggle:!0,disabled:!1,propName:"groupODT"});r.body=a;for(var s=0;s<t.length;++s){var o=t[s],l=e[o];i=new UWA.Element("div",{class:B+" "+o});l.inject(i),n={label:o,tweaker:i,experienceBase:this._experienceBase,touch:!1};var c=this._generateDivForProperty(n);c&&c.inject(a)}return this._propertiesPanelView.putContainer(),this._propertiesPanelView.emptyContainerContent(),this._propertiesPanelView.updateAccordeonForODT([r]),t},_generateAllTweakersTypes:function(){var e={};e.blobEnabled=new n({placeholder:"Upload texture",disabled:!1}),e.blobDisabled=new l({value:"",disabled:!1});var t=(new V).GetValue();e.dateEnabled=new s({value:t,timePickerFlag:!0,timePickerPrecision:"sec",disabled:!1}),e.dateDisabled=new s({value:t,timePickerFlag:!0,timePickerPrecision:"sec",disabled:!0});var i="00FF00";e.colorEnabled=new r({value:i,disabled:!1}),e.colorDisabled=new r({value:i,disabled:!0}),e.colorNullEnabled=new r({value:null,disabled:!1}),e.colorNullDisabled=new r({value:null,disabled:!0});var d=.45;e.floatBoundedEnabled=this._createSliderTweaker(d,0,1,.01,!1,{}),e.floatBoundedDisabled=this._createSliderTweaker(d,0,1,.01,!0,{}),e.floatUnboundedEnabled=new o({value:this._simplifyNumberDisplay(d),stepValue:.1,disabled:!1}),e.floatUnboundedDisabled=new o({value:this._simplifyNumberDisplay(d),stepValue:.1,disabled:!0});e.booleanEnabled=new a({displayStyle:"switch",value:true,disabled:!1}),e.booleanDisabled=new a({displayStyle:"switch",value:true,disabled:!0});var u=[.654327,168532].map((e=>this._simplifyNumberDisplay(e))),h=["x","y"],p=[.654327,168532,245.24986].map((e=>this._simplifyNumberDisplay(e))),m=["x","y","z"];e.point2dEnable=new c({value:u,definition:h,readOnly:!1}),e.point2dDisable=new c({value:u,definition:h,readOnly:!0}),e.point3dEnable=new c({value:p,definition:m,readOnly:!1}),e.point3dDisable=new c({value:p,definition:m,readOnly:!0});var C=["Option 0","Option 1","Option 2","Option 3"];return e.comboEnable=new l({displayStyle:"combo",possibleValues:Object.values(C),value:C[2],disabled:!1}),e.comboDisable=new l({displayStyle:"combo",possibleValues:Object.values(C),value:C[2],disabled:!0}),e},removeFakePropertiesForODT:function(){if(Array.isArray(this._listTweakersWithPtrUpEvt)){for(var e=0;e<this._listTweakersWithPtrUpEvt.length;++e){this._listTweakersWithPtrUpEvt[e].removeEventListener("pointerup",this._onTweakerPointerUpCB)}this._listTweakersWithPtrUpEvt=null}},getPropertiesService:function(){return this._propertiesService}});return G.setChildrenDataRecID=function(e,t){for(var i=e.getChildren(),n=0;n<i.length;n++){var a=i[n],r=t+"_"+n;a.setAttribute("data-rec-id",r),G.setChildrenDataRecID(a,r)}},G}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebGUI/ambiences/VCXAmbienceLibraryView",["require","exports","UWA/Core","DS/VCXGUIInfrastructure/VCXView","DS/VCXWebGUI/ambiences/VCXAmbienceLibraryCard","DS/VCXGUIInfrastructure/VCXCardTypeEnum"],(function(e,t,i,n,a,r){"use strict";n=__importDefault(n),a=__importDefault(a),r=__importDefault(r);class s extends n.default{constructor(){super("ambienceLibraryPanel"),this.ambiencesList=[],this.cardLayout={ratioX:16,ratioY:9,cardWidth:130,descriptionHeight:24}}preparePanel(e){this.panelContainer=(0,i.createElement)("div",{class:"materialPanel",html:""});for(let t of e)this.addAmbienceCard(t)}addAmbienceCard(e){let t={id:e.id,title:e.name,image:e.image,type:r.default.AMBIENCE,cardLayout:this.cardLayout},i=new a.default(t);this.ambiencesList.push(i),i.getThumbnailElement().addEventListener("click",e.callbackClick),i.getView().addClassName("materialCard"),i.getView().inject(this.panelContainer)}getView(){return this.panelContainer}unInitialize(){for(let e of this.ambiencesList)e.destroy();super.unInitialize()}setInsertStatus(e,t){this.ambiencesList.find((t=>t.getID()===e))?.setInsertStatus(t)}}return s}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebGUI/ambiences/VCXAmbienceLibraryCtrl",["require","exports","DS/WebappsUtils/WebappsUtils","DS/VCXGUIInfrastructure/VCXGUIComponentCtrlTS","DS/VCXWebGUI/ambiences/VCXAmbienceLibraryView","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI"],(function(e,t,i,n,a,r){"use strict";n=__importDefault(n),a=__importDefault(a),r=__importDefault(r);class s extends n.default{GetIdentifier(){return"VCXAmbienceLibraryCtrl"}constructor(){super(),this._viewPanel=null,this.cards=[{name:"Preset_Default",linkDescriptionName:"Preset_Default"},{name:"Black_Wall_Dome",linkDescriptionName:"Black_Wall"},{name:"Blue",linkDescriptionName:"Studio_Blue_Design"},{name:"Crossed_Windows_Dome",linkDescriptionName:"Studio_CrossedWindows_Dome"},{name:"Dark",linkDescriptionName:"Studio_Dark_Design"},{name:"Light_Corridor_Dome",linkDescriptionName:"Studio_LightCorridor_Dome"},{name:"Round_Top_Light",linkDescriptionName:"Studio_ll"},{name:"Apartment",linkDescriptionName:"Interior_Apartment_1"},{name:"Conference_Room",linkDescriptionName:"Interior_Conference_Room"},{name:"Hall_1",linkDescriptionName:"Interior_Hall_1"},{name:"Hall_2",linkDescriptionName:"Interior_Hall_3"},{name:"Hall_3",linkDescriptionName:"Interior_Hall_3_a"},{name:"Kitchen",linkDescriptionName:"Interior_Kitchen_1"},{name:"Modern_Loft_1",linkDescriptionName:"Indoor_ModernLoft_Backplate_001"},{name:"Modern_Loft_2",linkDescriptionName:"Indoor_ModernLoft_Backplate_002"},{name:"Modern_Loft_3",linkDescriptionName:"Indoor_ModernLoft_Backplate_003"},{name:"Parking",linkDescriptionName:"Interior_Parking"},{name:"Warehouse",linkDescriptionName:"Interior_Warehouse"},{name:"Afternoon_Salt_Lake",linkDescriptionName:"Outdoor_Afternoon_SaltLake_Dome"},{name:"Airstrip",linkDescriptionName:"Exterior_Airstrip"},{name:"California_Speedway",linkDescriptionName:"Exterior_California_Speedway"},{name:"City_Night_Place",linkDescriptionName:"Exterior_City_Night_Place"},{name:"Early_Morning_Quiet_Sea",linkDescriptionName:"Outdoor_EarlyMorning_QuietSea_Dome"},{name:"Highland_Drive_1",linkDescriptionName:"Outdoor_HighlandDrive_Backplate_001"},{name:"Highland_Drive_2",linkDescriptionName:"Outdoor_HighlandDrive_Backplate_002"},{name:"Highland_Drive_3",linkDescriptionName:"Outdoor_HighlandDrive_Backplate_003"},{name:"Ocean",linkDescriptionName:"Exterior_Ocean_3"},{name:"Plaza_1",linkDescriptionName:"Exterior_Plaza_1"},{name:"Plaza_2",linkDescriptionName:"Exterior_Plaza_2"},{name:"Road_1",linkDescriptionName:"Exterior_Road_1"},{name:"Road_2",linkDescriptionName:"Exterior_Road_2"},{name:"Scenic_1",linkDescriptionName:"Exterior_Scenic_1"},{name:"Scenic_2",linkDescriptionName:"Exterior_Scenic_2"},{name:"Scenic_3",linkDescriptionName:"Exterior_Scenic_5"},{name:"Scenic_4",linkDescriptionName:"Exterior_Scenic_7"},{name:"Sky",linkDescriptionName:"Exterior_Sky"}]}initialize(){this.subscribe("initGUIEnd",this.updateAmbienceInsertStatus.bind(this)),this.subscribe("VCX_AMBIENCE_DELETE",this.updateAmbienceInsertStatus.bind(this))}getLibrarySourceNameUsed(){return this._experienceBase.ComponentsMap.GetComponentFromType("AmbienceModel_Spec").map((e=>e.QueryInterface("VCXIModifiable")?.GetProperty("Ambience.LibrarySourceName").GetPropertyValue().GetValue()??""))}updateAmbienceInsertStatus(){let e=this.getLibrarySourceNameUsed();this.cards.forEach((t=>this._viewPanel?.setInsertStatus(t.name,!e.includes(t.name))))}BuildView(e){this.options=e,this._viewPanel=new a.default,this._viewPanel?.preparePanel(this.cards.map((e=>({id:e.name,name:r.default["Ambience.Library."+e.name],image:i.getWebappsAssetUrl("VCXWebAuthoringApp","ambiences/library/"+e.name+".jpg"),callbackClick:this.onClick.bind(this,e.name)}))))}async onClick(e){let t=this.getCardFromName(e);t&&(this.getLibrarySourceNameUsed().includes(t.name)||(await this._experienceBase.getManager("VCXCAT3DXModelManager").InsertAmbience(t.name,null,t.linkDescriptionName,{embedded:{librarySourceName:t.name}}),this._viewPanel?.setInsertStatus(e,!1),this._experienceBase.getManager("VCXGUIManager").GetGUIComponentFromName("VCXAmbienceCtrl").notifyPresentation()))}getCardFromName(e){return this.cards.find((t=>t.name===e))}unInitialize(){super.unInitialize(),this._viewPanel&&(this._viewPanel.unInitialize(),this._viewPanel=null)}}return s})),define("DS/VCXWebGUI/VCXMetaPropertiesPartListCtrl",["require","exports","DS/VCXWebGUI/VCXComboBox","DS/VCXWebGUI/VCXMetaPropertiesCtrl","DS/CoreEvents/Events"],(function(e,t,i,n,a){"use strict";return class extends n{get indexColumn(){return this._indexColumn}set indexColumn(e){this._indexColumn=e}constructor(e){super(e),this._indexColumn=0,this._referenceUI=null}get ReferenceUI(){return this._referenceUI}set ReferenceUI(e){this._referenceUI=e}unInitialize(){super.unInitialize(),a.publish({event:"VCX_SWITCH_EDIT_SELECTION",data:{mode:1,state:!1}})}buildMetaPropertiesView(e){this._view&&(this._view.destroy(),this._view=null);const t=this._getListMetaProperties(),n=this.ReferenceUI;this._view=new i(this._experienceBase,t,{...e,referenceUI:n}),a.publish({event:"VCX_SWITCH_EDIT_SELECTION",data:{mode:1,state:!0}})}_buildChangePropertyCallback(e){e&&a.publish({event:"VCXEditColumn",data:{indexColumn:this._indexColumn,nameProperty:e}})}_buildOnEndCallback(){}}})),define("DS/VCXWebGUI/VCXUIPartListCtrl",["require","exports","DS/VCXGUIInfrastructure/VCXGUIComponentCtrl","DS/CoreEvents/Events","DS/VCXWebGUI/VCXMetaPropertiesPartListCtrl","DS/VCXWebGUI/VCXPartListColumnMenuPanel","DS/VCXWebGUI/VCXPartListEditModeCtrl"],(function(e,t,i,n,a,r,s){"use strict";return class extends i{constructor(){super(),this._tokens={}}BuildView(e){e||console.warn("No options given to build the view"),this._vcxMetaCtrl=new a(this._experienceBase),this._vcxEditModeCtrl=new s(this._experienceBase)}postInitialize(){this._tokens._VCX_META_UI_Display=n.subscribe({event:"VCX_Meta_Display_UI"},(e=>{this.buildMetaUI(e)})),this._tokens._VCX_META_UI_Hide=n.subscribe({event:"VCX_Meta_Hide_UI"},(()=>{this.hideMetaUI()})),this._tokens._VCX_MENU_PANEL_PARTLIST=n.subscribe({event:"VCX_Menu_Panel_PartList"},(e=>{this.rebuildMenuPanel(e)})),this._tokens._VCX_EditModePartList_UI_Display=n.subscribe({event:"VCX_EditMode_PartList_Display_UI"},(e=>{this.buildEditModeUI({event:e})})),this._tokens._VCX_PartList_Build_Completed=n.subscribe({event:"VCX_PartList_Build_Complete_Edit_Mode"},(e=>{this.buildEditModeUI({event:e})})),this._tokens._VCX_EditModePartList_UI_Hide=n.subscribe({event:"VCX_EditMode_PartList_Hide_UI"},(e=>{const t=this._experienceBase.getManager("VCXSelectionManager").GetComponentsFromSelection("CSO");let i=!0;if(t&&t.length){for(let e of t)if("VCXPartList_Spec"===e.componentType){i=!1;break}}else i=!0;if(i){this.hideMetaUI();let t=!1;e&&e.toAddToSelection&&(t=e.toAddToSelection),this.hideEditModeUI(t),n.publish({event:"VCX_SWITCH_EDIT_SELECTION",data:{mode:2,state:!1}})}}))}buildMetaUI(e){if(this._vcxMetaCtrl){const t=e&&e.hasOwnProperty("indexColumn")&&e.indexColumn>0?e.indexColumn:2;"record"===this._experienceBase.odt&&this._experienceBase.getManager("VCXODTManager").LogAPI("VCXBuildMetaPartList",{indexColumn:t}),null!==this._vcxMetaCtrl.indexColumn&&void 0!==this._vcxMetaCtrl.indexColumn&&(this._vcxMetaCtrl.indexColumn=t);const i=document.getElementById("divBomRowHead");if(i&&i.children.length>=t){const e=i.children[t-1];this._vcxMetaCtrl.ReferenceUI=e;const n={positionUI:{my:"bottom-left",at:"top-left",height:30,offsetY:2,offsetX:0},offsetUI:{x:.5}};this._vcxMetaCtrl.buildMetaPropertiesView(n)}}}hideMetaUI(){this._vcxMetaCtrl&&this._vcxMetaCtrl.unInitialize()}buildEditModeUI(e){this._vcxEditModeCtrl&&this._vcxEditModeCtrl.buildEditModeView(e)}hideEditModeUI(e){this._vcxEditModeCtrl&&this._vcxEditModeCtrl.hideEditModeView(e)}rebuildMenuPanel(e){this._menuPanel&&(this._menuPanel.destroy&&this._menuPanel.destroy(),this._menuPanel=null),this._menuPanel=new r(this._experienceBase,e.columnButtonsContainer,e.columnNumber,e.handleSortButton,e.handleDeleteButton,e.handleMoveButton,e.handleUpdateProperty)}unInitialize(){if(this._menuPanel&&(this._menuPanel.destroy&&this._menuPanel.destroy(),this._menuPanel=null),this._vcxEditModeCtrl&&this._vcxEditModeCtrl.unInitialize(),this.hideMetaUI(),this._tokens)for(var e in this._tokens)this._tokens.hasOwnProperty(e)&&n.unsubscribe(this._tokens[e])}}}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebGUI/VCXLandingPageWAFRAdaptator",["require","exports","DS/VCXWebGUI/VCXGettingStartedUI","DS/VCXWebKernel/VCXNotificationManager"],(function(e,t,i,n){"use strict";n=__importDefault(n);return class{constructor(e){this.expBase=e}clearInitWidget(){i.clearInitWidget()}endLoadingExperience(){let e=this.expBase.getManager("VCXContextManager").getFrameWindow().getExecutionContext().getComponent("mod_WelcomeScreen");e&&e.hideWelcomeScreen(),n.default._removeTempStyle()}failLoadingExperience(){this.expBase.getManager("VCXContextManager").getFrameWindow().getExecutionContext().getComponent("mod_WelcomeScreen")&&this.expBase.getManager("VCXContextManager").getFrameWindow().getExecutionContext().gotoWelcomeScreen(),n.default._removeTempStyle()}curtainFade(){}removeCurtainFade(){}}})),define("DS/VCXWebGUI/VCXStoryTellerWelcomePageCtrl",["require","exports","DS/VCXWebGUI/VCXGettingStartedExperienceInformationModal","DS/VCXWebGUI/VCXLandingPageWAFRAdaptator","DS/VCXWebEWS/VCXExperienceServices","DS/VCXWebGUI/VCXWelcomePageCtrl"],(function(e,t,i,n,a,r){"use strict";return class extends r{constructor(){super(),this._landingPageAdaptator=null,this._cssFiles.push({name:"VCXWebGUICommandHelper/VCXWebGUICommandHelper.css",useWebApp:1})}async initialize(){i.initialize(),this.loadCssFiles(),this._landingPageAdaptator=new n(this._experienceBase);var e=null;if((e=window.widget&&window.widget.getValue("X3DContentId")&&JSON.parse(window.widget.getValue("X3DContentId")))&&e.data&&e.data.items[0]&&e.data.items[0].objectId&&"HighlightPresentation3DCom"==e.data.items[0].objectType){var t=e.data.items[0].displayName,r=e.data.items[0].objectId;this._experienceBase.getManager("VCXAnalyticsTrackerAppManager").trackOpenPresentationEvent("xH_OpenWith"),a.onLoadExperienceFromPhysicalID(this._experienceBase,t,r),e.data=null,window.widget&&window.widget.setValue("X3DContentId",JSON.stringify(e))}}getGettingStartedUI(){return this._landingPageAdaptator}unInitialize(){this._landingPageAdaptator=null,this.unLoadCssFile(),i.unInitialize()}async DisplayModalPanelInit(e,t,n){if((this._experienceBase.getManager("VCXContextManager").IsLocalMode()||this._experienceBase.odt)&&!localStorage.getItem("VCX_Enable_DisplayModal"))return{};let a="";return a=t&&"3dxml"===t.type?await i.Import3dxmlModal(this._experienceBase,e,t,n):await i.createNewExperienceModal(this._experienceBase,e,t),this.getGettingStartedUI().removeCurtainFade(),a}displayOpenOrPlayExperience(e){return i.displayOpenOrPlayExperience(e,this._experienceBase)}createSaveBeforeCloseModal(){return i.createSaveBeforeCloseModal(this._experienceBase)}async saveToMRU(e){if(widget&&widget.getValue&&widget.setValue){let t,i=e;e||(i=await this._experienceBase.getManager("VCXEWSManager").GetCAT3DXModel().GetExperiencePhysicalID());let n={};if(widget.getValue("MRUData")){n=JSON.parse(widget.getValue("MRUData")),t=n.arrayRecentExperiences;let e=t.indexOf(i);if(-1===e){if(3===t.length){delete n[t.pop()]}t.unshift(i),n[i]=new Date}else t.splice(e,1),t.unshift(i),n[i]=new Date}else t=[i],n.arrayRecentExperiences=t,n[i]=new Date;widget.setValue("MRUData",JSON.stringify(n))}}}}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebGUI/VCXRatioPanelView",["require","exports","DS/VCXGUIInfrastructure/VCXMainPanelFixed","DS/VCXGUIInfrastructure/VCXCardTypeEnum","UWA/Core","DS/VCXWebDragDrop/VCXDraggableRatio","i18n!DS/VCXWebKernel/assets/nls/VCXWebKernel","DS/VCXWebGUI/VCXRatioCard"],(function(e,t,i,n,a,r,s,o){"use strict";s=__importDefault(s),o=__importDefault(o);return class extends i{constructor(e,t){super(e,t.getContext()),this.cardList={},this.cardLayout={ratioX:16,ratioY:9,cardWidth:130,descriptionHeight:24},this.ratioContainer=(0,a.createElement)("div",{html:"",class:"ratiosContainer"}),this.setPanelContent(this.ratioContainer),this.setDragDropEvents(t._experienceBase)}setDragDropEvents(e){this.getPanelContent()?.addEventListener("dragstart",(t=>{const i=e.getManager("VCXDragDropManager");if(i){const n=t.target,a=new r(n.getAttribute("data-card-id"),e);i.SetCurrentDraggableItem(a)}})),this.getPanelContent()?.addEventListener("dragend",(()=>{const t=e.getManager("VCXDragDropManager");t&&t.SetCurrentDraggableItem(null)}))}setRatioClickFunction(e){this.ratioSelectCallback=e}activateRatioCard(e){this.activeCard&&this.activeCard.deactivateCard(),this.activeCard=e,e.activateCard()}generateRatioCard(e,t){let i={"ratio-width":t.ratioWidth,"ratio-height":t.ratioHeight,"specific-width":t.specificWidth,ratioDisplayHeight:t.displayRatioHeight,ratioDisplayWidth:t.displayRatioWidth},a={id:e,title:t.title,subTitle:t.subtitle,image:t.icon,selectableFlag:!1,type:n.RATIO,data:i,cardLayout:this.cardLayout},r=new o.default(a);t.default&&this.activateRatioCard(r);let s=r.getView();this.cardList[e]=r,this.setContextualMenu(r),this.ratioContainer.appendChild(s),r.addCardClickCallback((e=>{(e.target===r.getView()||e.target===r.getView().getElementsByClassName("vcxUICard-descriptionContainer")[0]||e.target===r.getView().getElementsByClassName("vcxUICard-descriptionTitle")[0]||e.target.closest(".vcxUICard-thumbnail"))&&this.ratioSelectCallback&&(this.ratioSelectCallback(t.ratioWidth,t.ratioHeight,t.specificWidth),this.activateRatioCard(r))}))}setContextualMenu(e){e.customizeMenu([{icon:"propagate",subMenu:[{label:s.default["Cmd.ApplyTo.All"],icon:"select-all-checkboxes",action:()=>{this.applyToCallback&&this.applyToCallback(e.getID(),!1)}},{label:s.default["Cmd.ApplyTo.Selected"],icon:"select-on",availabilityCheckingCallback:this.applyToAvailableCallback,action:()=>{this.applyToCallback&&this.applyToCallback(e.getID(),!0)}}],label:s.default["Cmd.ApplyTo"]}])}activateRatio(e){let t=this.cardList[e];t&&this.activateRatioCard(t)}emptyActiveRatio(){for(const e in this.cardList)if(Object.prototype.hasOwnProperty.call(this.cardList,e)){this.cardList[e].deactivateCard()}}setApplyToCallback(e){this.applyToCallback=e}setApplyToAvailableCallback(e){this.applyToAvailableCallback=e}}}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebGUI/VCXRatioCtrl",["require","exports","DS/VCXGUIInfrastructure/VCXGUIComponentCtrl","DS/WebappsUtils/WebappsUtils","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI","DS/VCXWebGUI/VCXRatioPanelView","DS/CoreEvents/Events","DS/VCXWebKernelCommands/VCXCmdRequestChangeProperties","DS/VCXWebKernelCommands/VCXCmdApplyPropertyTo"],(function(e,t,i,n,a,r,s,o,l){"use strict";o=__importDefault(o);return class extends i{constructor(){super(),this.listRatios={a4l:{title:a["VCXPaperCtrl.Ratio.A4L"],ratioWidth:297,displayRatioWidth:1.4,ratioHeight:210,displayRatioHeight:1,specificWidth:297,icon:n.getWebappsAssetUrl("VCXWebGUI","css/img/VCXPaperRatio16_9.png")},a4p:{title:a["VCXPaperCtrl.Ratio.A4P"],ratioWidth:210,displayRatioWidth:1,ratioHeight:297,displayRatioHeight:1.4,specificWidth:210,icon:n.getWebappsAssetUrl("VCXWebGUI","css/img/VCXPaperRatio9_16.png")},square:{title:a["VCXPaperCtrl.Ratio.Square"],ratioWidth:1,ratioHeight:1,icon:n.getWebappsAssetUrl("VCXWebGUI","css/img/VCXPaperRatio1_1.png")},default:{title:a["VCXPaperCtrl.Ratio.Wide"],ratioWidth:16,ratioHeight:9,icon:n.getWebappsAssetUrl("VCXWebGUI","css/img/VCXPaperRatio16_9.png")},_35mm:{title:a["VCXPaperCtrl.Ratio.mm35"],ratioWidth:4,ratioHeight:3,icon:n.getWebappsAssetUrl("VCXWebGUI","css/img/VCXPaperRatio4_3.png")},goldenRatio:{title:a["VCXPaperCtrl.Ratio.GoldenRatio"],ratioWidth:16,ratioHeight:10,icon:n.getWebappsAssetUrl("VCXWebGUI","css/img/VCXPaperRatio16_9.png")},wsc:{title:a["VCXPaperCtrl.Ratio.WideScreenCinema"],ratioWidth:2.35,ratioHeight:1,icon:n.getWebappsAssetUrl("VCXWebGUI","css/img/VCXPaperRatio235_1.png")},iphonexP:{title:a["VCXPaperCtrl.Ratio.iPhoneXP"],ratioWidth:9,ratioHeight:19.5,icon:n.getWebappsAssetUrl("VCXWebGUI","css/img/VCXPaperRatio9_195.png")},iphonexL:{title:a["VCXPaperCtrl.Ratio.iPhoneXL"],ratioWidth:19.5,ratioHeight:9,icon:n.getWebappsAssetUrl("VCXWebGUI","css/img/VCXPaperRatio195_9.png")}},this._aspectRatio=null,this._ratioPanelView=null}BuildView(e){e||console.warn("No options given to build the view"),this.guiManager=this._experienceBase.getManager("VCXGUIManager"),this._aspectRatio=this.listRatios.a4l;let t={title:a["VCXRatios.PanelTitle"],icon:"",immersiveFrame:this.guiManager.immersiveFrame,currentDockArea:WUXDockAreaEnum.LeftDockArea,identifier:"ratioPanel",minWidth:250};this._ratioPanelView=new r(t,this._experienceBase.getManager("VCXContextManager")),this._ratioPanelView.setRatioClickFunction(this.ratioSelectCallback.bind(this)),this._ratioPanelView.setApplyToCallback(this.ratioApplyToCallback.bind(this)),this._ratioPanelView.setApplyToAvailableCallback(this.ratioApplyToAvailableCallback.bind(this)),this.init()}init(){for(const e in this.listRatios)if(Object.prototype.hasOwnProperty.call(this.listRatios,e)){const t=this.listRatios[e];"default"===e&&(t.default=!0),this._ratioPanelView?.generateRatioCard(e,t)}this._tokenCurrentScenario=s.subscribe({event:"VCX_CURRENT_SCENARIO_CHANGED"},(()=>{this.onRatioChanged()})),this.tokenPaperRatio=s.subscribe({event:"VCX_PAPER_RATIO_CHANGED"},(()=>{this.onRatioChanged()}))}unInitialize(){this._ratioPanelView?.unInitialize(),this._tokenCurrentScenario&&(s.unsubscribe(this._tokenCurrentScenario),delete this._tokenCurrentScenario),this.tokenPaperRatio&&(s.unsubscribe(this.tokenPaperRatio),delete this.tokenPaperRatio)}getPanelView(){return this._ratioPanelView?this._ratioPanelView.panel:null}getRatioFromInfo(e,t,i){for(const n in this.listRatios)if(Object.prototype.hasOwnProperty.call(this.listRatios,n)){const a=this.listRatios[n];if(a.ratioHeight===t&&a.ratioWidth===e&&a.specificWidth===i)return a}return null}async ratioSelectCallback(e,t,i){let n=this.getRatioFromInfo(e,t,i);if(n){let e=n.ratioWidth,t=n.ratioHeight,i=n.specificWidth;if(e&&t){let a=this._experienceBase.getManager("VCXContextManager").getActiveViewport();if(a){let r=a.QueryInterface("VCXIModifiable");if(r){let a=this._experienceBase.getManager("VCXCommandManager");this.aspectRatio=n,a.StartTransaction();let s=new o.default(this._experienceBase),l=this._experienceBase.getManager("VCXPaperManager").GetWidth();if(i){l=i;let e=r.GetProperty("Paper.Width").Clone(),t=e.GetPropertyValue().Clone();t.SetValue(l),e.SetPropertyValue(t),await s.ChangePropertyValue(r,"Paper.Width",t),a.Push(s)}l*=t/e;let c=r.GetProperty("Paper.Height").Clone(),d=c.GetPropertyValue().Clone();d.SetValue(l),c.SetPropertyValue(d),await s.RequestModification([r],"Paper.Height",d),a.Push(s),a.EndTransaction()}}}}}ratioApplyToCallback(e,t){let i=this.listRatios[e],n=this._experienceBase.getManager("VCXScenarioManager");const a=this._experienceBase.getManager("VCXCommandManager");let r=this._experienceBase.getManager("VCXContextManager").getActiveViewport().QueryInterface("VCXIModifiable"),s=[];if(t){s=this._experienceBase.getManager("VCXSelectionManager").GetComponentsFromSelection("CSO").filter((e=>e.IsKindOf("VCXScenario")))}else{let e=n.GetScenarios();for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){const i=e[t];s.push(i)}}let o=this._experienceBase.getManager("VCXPaperManager"),c=i.specificWidth?i.specificWidth:o.GetWidth(),d=c*i.ratioHeight/i.ratioWidth,u=new l(this._experienceBase,{scenarios:s,changes:[{modifiable:r,propertyName:"Paper.Height",propertyValue:d},{modifiable:r,propertyName:"Paper.Width",propertyValue:c}]},"all");a.Do(u)}ratioApplyToAvailableCallback(){return this._experienceBase.getManager("VCXSelectionManager").GetComponentsFromSelection("CSO").filter((e=>e.IsKindOf("VCXScenario"))).length>0}findCurrentRatio(){let e=this._experienceBase.getManager("VCXPaperManager"),t=Math.round(e.GetWidth()/e.GetHeight()*1e4)/1e4;for(let i in this.listRatios)if(this.listRatios.hasOwnProperty(i)){let n=this.listRatios[i];if(Math.round(n.ratioWidth/n.ratioHeight*1e4)/1e4===t&&(!n.specificWidth||n.specificWidth===e.GetWidth()))return i}return null}onRatioChanged(){let e=this.findCurrentRatio();e?this._ratioPanelView?.activateRatio(e):this._ratioPanelView?.emptyActiveRatio()}get aspectRatio(){return this._aspectRatio}set aspectRatio(e){this._aspectRatio=e}}}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebGUI/ambiences/VCXAmbiencePresentationView",["require","exports","DS/VCXWebGUI/ambiences/VCXAmbienceCard","UWA/Core","DS/VCXGUIInfrastructure/VCXCardTypeEnum","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI","i18n!DS/VCXWebKernel/assets/nls/VCXWebKernel","DS/VCXGUIInfrastructure/VCXView"],(function(e,t,i,n,a,r,s,o){"use strict";r=__importDefault(r),s=__importDefault(s),o=__importDefault(o);class l extends o.default{constructor(){super("ambienceLibraryPanel"),this.ambiencesList=[],this.cardLayout={ratioX:16,ratioY:9,cardWidth:130,descriptionHeight:24},this.panelContainer=(0,n.createElement)("div",{class:"materialPanel",html:""})}getCardFromId(e){for(let t=0;t<this.ambiencesList.length;t++){const i=this.ambiencesList[t];if(i.getID()===e)return i}}getCardIndexInList(e){for(let t=0;t<this.ambiencesList.length;t++){if(this.ambiencesList[t].getID()===e)return t}return-1}deleteAmbienceCardFromID(e){const t=this.getCardFromId(e);t&&t.destroy();let i=this.getCardIndexInList(e);i&&i>-1&&this.ambiencesList.splice(i,1)}changeActiveCardFromId(e){for(let t=0;t<this.ambiencesList.length;t++){const i=this.ambiencesList[t];i.isCardActive()&&i?.deactivateCard(),i.getID()===e&&i?.activateCard()}}preparePanel(e){for(let t of e)this.addAmbienceCard(t)}getView(){return this.panelContainer}unInitialize(){for(let e of this.ambiencesList)e.destroy();super.unInitialize()}addAmbienceCard(e){let t={id:e.id,title:e.name,image:e.image,isInternal:e.defaultAmbience,selectableFlag:!1,type:a.AMBIENCE,cardLayout:this.cardLayout},n=new i(t);this.ambiencesList.push(n),n.setOnSelectCardCallback(e.callbackOnSelectCard),n.setOnUnselectCardCallback(e.callbackOnUnselectCard),n.addRenameCardCallback(e.callbackOnRenameCard),n.addPropButtonCallback(e.callbackGoToPropPanel),this.setContextualMenu(n,e.callbackApplyTo,e.callbackApplyToAvailable,e.callbackDelete,e.callbackShare),n.getThumbnailElement().addEventListener("click",e.callbackClick),n.getView().addClassName("materialCard"),n.getView().inject(this.panelContainer)}updateAmbienceView(e,t){let i=this.getCardFromId(e);i&&t.name&&(i.getLabel().innerHTML=t.name)}setContextualMenu(e,t,i,n,a){e.customizeMenu([{icon:"propagate",subMenu:[{label:s.default["Cmd.ApplyTo.All"],icon:"select-all-checkboxes",stateCheckingCallback:i.bind(null,!1),action:()=>{t(!1),this.ambiencesList.forEach((e=>e.deactivateCard())),e.activateCard()}},{label:s.default["Cmd.ApplyTo.Selected"],icon:"select-on",availabilityCheckingCallback:i.bind(null,!0),action:()=>{t(!0),this.ambiencesList.forEach((e=>e.deactivateCard())),e.activateCard()}}],label:s.default["Cmd.ApplyTo"]},{icon:"parameters",action:()=>{e.propButtonCallback()},label:r.default["VCXAmbienceCtrl.ShowProperties"]},{icon:"trash",stateCheckingCallback:()=>!e.getIsDefault(),action:()=>{n()},label:r.default["VCXAmbienceCtrl.DeleteAmbience"]},{icon:"rename",action:()=>{console.log("rename"),e.setEditableLabel(!0,!0)},label:r.default["VCXAmbienceCtrl.Rename"]},{icon:"logo-3dspace",action:a,label:r.default["VCXAmbienceCtrl.Share"]}])}}return l})),define("DS/VCXWebGUI/ambiences/VCXAmbiencePresentationCtrl",["DS/VCXGUIInfrastructure/VCXGUIComponentCtrl","DS/VCXWebGUI/ambiences/VCXAmbiencePresentationView","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebKernel/VCXCmdChangeSelection","DS/CoreEvents/Events","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI","DS/VCXWebExperienceBase/VCXContextManager","DS/VCXWebGUI/ambiences/VCXAmbienceCtrlServices","DS/VCXWebModifiables/VCXPropertiesObserver","DS/VCXWebGUI/ambiences/VCXAmbienceGUIEnum"],(function(e,t,i,n,a,r,s,o,l,c){"use strict";return e.extend({init:function(){this._propertyObserverViewport=new l},GetIdentifier:()=>"VCXAmbiencePanel",GetDockingInfo:function(){return{area:WUXDockAreaEnum.LeftDockArea,order:50}},BuildView:async function(e){this._propertyObserverViewport=new l,this.ambienceService=new o(this),this._vcxGuiManager=this._experienceBase.getManager("VCXGUIManager"),this._ambiencesDescription={},this._events={},this._selectedAmbiences=[];let i=s.isForceSupported("VCXNewFrame"),n={title:r["VCXAmbienceCtrl.Title"],icon:"picture-360",immersiveFrame:this._vcxGuiManager.immersiveFrame,identifier:this.GetIdentifier(),currentDockArea:i?WUXDockAreaEnum.LeftDockArea:void 0};i&&(n.minWidth=250),this._viewPanel=new t;let c=this._experienceBase.getManager("VCXContextManager").getActiveViewport();c&&this._propertyObserverViewport.add(c,"Viewport.ActiveAmbience"),this._events._tokenOnLoadAmbiences=a.subscribe({event:"initGUIEnd"},(async()=>{await this.OnAmbienceLoaded()})),this._events._tokenOnInsertAmbience=a.subscribe({event:"VCX_AMBIENCE_INSERT"},(async e=>{let t=await this.loadAmbience(e);t&&(this._viewPanel.addAmbienceCard(this.generateCardFormat(t)),this._viewPanel.changeActiveCardFromId(e.GetID()))})),this._events._tokenOnDeleteAmbience=a.subscribe({event:"VCX_AMBIENCE_DELETE"},(async e=>{this.onDeleteAmbiencePanel(e)})),this._events._tokenOnPropertiesChanged=a.subscribe({event:"VCX_PROPERTIES_CHANGED"},(async e=>{if(e){let t=this._experienceBase.getManager("VCXScenarioManager").ModifiableServer,i=[];e.GetListModifiables&&e.GetListModifiables(i);for(let n=0;n<i.length;n++){const a=i[n];let r=e.GetPropertySet(a).GetProperty("Actor.Name");if(r){let e=t.GetModifiableFromHashing(a);if("AmbienceModel_Spec"===e.GetObject().GetType()){let t=r.GetPropertyValue().GetValue();this.updateAmbience(e.GetObject().GetID(),{name:t})}}}}}))},update:function(){if(this._propertyObserverViewport.update(),this._propertyObserverViewport.isDirty()){const e=this.ambienceService.getCurrentAmbienceID();this._experienceBase.ComponentsMap.GetComponentFromID(e)&&this._viewPanel.changeActiveCardFromId(e)}this._propertyObserverViewport.reset()},OnAmbienceLoaded:async function(){const e=this._experienceBase.ComponentsMap.GetComponentFromType("AmbienceModel_Spec");let t=[];for(let i of e)t.push(this.loadAmbience(i));await UWA.Promise.allSettled(t),this.createViewPanel()},OnEndBuildView:function(){const e=this._experienceBase.getManager("VCXGUIManager").GetGUIComponentFromName("VCXPanelCtrl");e&&e.createButton(this._viewPanel.panel,"Ambiences","picture-360",5)},loadAmbience:async function(e){let t=e.QueryInterface("VCXIModifiable"),i=e.QueryInterface("VCXIModifiable").GetPropertyValue("Actor.Name");return this.addNewAmbienceFromObjectInfo({ID:e.GetID(),type:"Ambience Environnement",typeNLS:"Ambience Environnement",name:i,title:i,image:await e.getImageThumbnail()},e),this._ambiencesDescription[e.GetID()].defaultAmbience=t.GetProperty("Ambience.DefaultAmbience").GetPropertyValue().GetValue(),this._ambiencesDescription[e.GetID()]},onDeleteAmbiencePanel(e){this._viewPanel.deleteAmbienceCardFromID(e),delete this._ambiencesDescription[e]},changeSelectionCardAmbience:function(e,t,i){let a;const r=new n(this._experienceBase);if(e){let n=this._ambiencesDescription[e];if(n&&n.ambienceObject&&n.ambienceObject.length&&(a=n.ambienceObject[0],a)){if(t)i?(r.SetSelection(a),this._selectedAmbiences.push(e)):(r.AddToSelection(a),this._selectedAmbiences.push(e));else{r.RemoveFromSelection(a);let t=this._selectedAmbiences.indexOf(e);t>=0&&this._selectedAmbiences.splice(t,1)}this._experienceBase.getManager("VCXCommandManager").Do(r)}}else""===e&&(r.SetSelection(),this._experienceBase.getManager("VCXCommandManager").Do(r))},generateCardFormat:function(e){return{id:e.ID,name:e.title,image:e.image,defaultAmbience:e.defaultAmbience,callbackApplyTo:this.ambienceService.onCallbackApplyTo.bind(this.ambienceService,e.ID),callbackApplyToAvailable:this.ambienceService.onCallbackApplyToAvailable.bind(this.ambienceService,e.ID),callbackReplace:()=>console.warn("Replace ambience not yet implemented !"),callbackOnRenameCard:(e,t)=>this.ambienceService.onRenameAmbience(e,t),callbackGoToPropPanel:this.openPropPanel.bind(this,e.ID),callbackDelete:()=>this.ambienceService.deleteAmbience(e.ID),callbackClick:()=>this.ambienceService.activateAmbienceInCurrentScene(e.ID),callbackShare:()=>this.ambienceService?.shareAmbience(e.ID)}},addNewAmbienceFromObjectInfo:function(e,t){return e.ambienceObject=[],t&&e.ambienceObject.push(t),this._ambiencesDescription[e.ID]=e,e},getAmbiencesDetails:function(){return this._ambiencesDescription},openPropPanel(e){this.changeSelectionCardAmbience(e,!0,!0),this.ambienceService.getCurrentAmbienceID()===e?this._experienceBase.getManager("VCXGUIManager").GetGUIComponentFromName("VCXAmbienceCtrl").setCurrentTab(c.SubPanel.Current):this._vcxGuiManager.GetGUIComponentFromName("VCXPanelCtrl").toggleShowPanelByName("Properties",!0)},createViewPanel:function(){let e=[];for(let t in this._ambiencesDescription)this._ambiencesDescription.hasOwnProperty(t)&&e.push(this.generateCardFormat(this._ambiencesDescription[t]));this._viewPanel.preparePanel(e);const t=this._experienceBase.getManager("VCXContextManager").getActiveViewport();if(!t)return;const i=t.QueryInterface("VCXIModifiable").GetProperty("Viewport.ActiveAmbience").GetPropertyValue().GetValue();if(i){let e=this._experienceBase.ComponentsMap.GetComponentFromID(i);this._viewPanel.changeActiveCardFromId(e.GetID())}},updateAmbience:function(e,t){t.name&&(this._ambiencesDescription[e].title=t.name),this._viewPanel.updateAmbienceView(e,t)},unInitialize:function(){if(this._viewPanel&&(this._viewPanel.unInitialize(),this._viewPanel=null),this._events)for(let e in this._events)this._events.hasOwnProperty(e)&&a.unsubscribe(this._events[e])}})}));