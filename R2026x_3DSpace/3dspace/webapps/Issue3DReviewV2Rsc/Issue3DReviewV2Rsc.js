define("DS/Issue3DReviewV2Rsc/models/Marker",["UWA/Core","UWA/Class/Model","DS/Logger/Logger","DS/Visualization/ThreeJS_DS","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","DS/IssueServices/services/PlatformServices"],(function(e,t,n,s,i,o,r,a){"use strict";var l="(╯°□°）╯︵ ┻━┻",c="x",u="y",d="z",p=0;return t.extend({name:"DS/Issue3DReviewV2Rsc/models/Marker",defaults:{id:"",physicalId:"",issue:"",type:"",name:"",revision:"",title:"",node:null,position:null,original:null,inverse:null,path:[],color:"",default:null,temporary:!1,path_str:""},_logger:null,setup:function(){var e=this;e._logger=n.getLogger("DS/Issue3DReviewV2Rsc/Model"),e._logger.debug("Marker for issue %s (%s) has been initialized",e.get("title"),e.get("name")),r.start(e.name+" setup");var t=e.get("id").split(l);e.set("issueId",t[0]),e.set("physicalId",t[1]),e.set("instanceIdx",t[2]);var o=e.get("path_str");if(o){var a=o.split(","),p=a[a.length-1];e.set("physicalId",p),e.set("node",p)}e.set("default",e.utils.getCenterBoundingSphere(e.get("path"),e.get("node"))),e.set("axis",e.utils.getAxisSystem(e.get("path"),e.get("node")));var g=i.get("component").get3DContext().controller,m=new s.Matrix4;m.extractRotation(g._model.getWorldMatrix(e.get("path"))),e.set("inverse",(new s.Matrix4).getInverse(m));var h=e.get("position");if(!0===e.utils.isValidPosition(h)){var f=new s.Vector3(h[c],h[u],h[d]);e.set("original",f),f.applyMatrix4(m);var v=e.utils.getRelativePosition(e.get("axis"),f);e.set("position",v)}else e.set("position",null);r.end(e.name+" setup")},save:function(t,n){var i=this;i._logger.debug("Saving marker %s from issue %s (%s)",i.get("id"),i.get("title"),i.get("name")),r.start(i.name+" save");var l=i.get("issue").get("id"),p=i.utils.convert(i,e.clone(t));p.physicalId=i.get("physicalId");var g=i.get("path_str");p.path=g.split(","),p.objectType=i.get("type"),p.serviceId="3DSpace",p.envId=a.getTenant();var m=new s.Vector3(p.position[c],p.position[u],p.position[d]);o.issues.update({data:{objects:[{physicalId:l,reportedAgainst:[p]}]},onComplete:function(e){i.set("position",t.position),i.set("original",m),n&&"function"==typeof n.onComplete&&n.onComplete(e.results),r.end(i.name+" save")},onFailure:function(e){n&&"function"==typeof n.onFailure&&n.onFailure(e),r.end(i.name+" save")}})},destroy:function(){var e=this;e._logger.debug("Destroying marker %s from issue %s (%s)",e.get("id"),e.get("title"),e.get("name")),e.clear({silent:!0}).set(e.defaults)},utils:{isValidPosition:function(e){return e&&e.hasOwnProperty(c)&&e.hasOwnProperty(u)&&e.hasOwnProperty(d)},getPosition:function(e,t){var n=i.get("component").get3DContext().controller,o=new s.Matrix4;o.extractRotation(n.buildPathFromArray(e.get("path")).getWorldMatrix());var r=t;return r.applyMatrix4(o),this.getRelativePosition(e.get("axis"),r)},getCenterBoundingSphere:function(e,t){var n=i.get("component").get3DContext(),o=(n=i.get("component").get3DContext()).controller.getReferenceBoundingBox(t),r=new s.Vector3((o.min.x+o.max.x)/2,(o.min.y+o.max.y)/2,(o.min.z+o.max.z)/2),a=n.controller._model.getWorldMatrix(e),l=r.clone();return l.applyProjection(a),l},getAxisSystem:function(e,t){return i.get("component").get3DContext().controller._model.getWorldMatrix(e).decompose()[p]},getRelativePosition:function(e,t){var n=e.x,i=e.y,o=e.z,r=parseFloat(t.x),a=parseFloat(t.y),l=parseFloat(t.z);return new s.Vector3(n+r,i+a,o+l)},convert:function(e,t){var n={};if("position"in t){var i=new s.Vector3;i.subVectors(t.position,e.get("axis")),i.applyMatrix4(e.get("inverse")),n.position={x:i.x,y:i.y,z:i.z}}return n}}})})),define("DS/Issue3DReviewV2Rsc/commandsWebAfr/Templates",["DS/IssueCommon/commands/Templates"],(function(e){"use strict";function t(e){this.ec=e.executionContext}return t.prototype.beginExecute=function(){require(["DS/PADServices/utils/PADTrackerManager"],(e=>{const t=e.getPADTracker({eventCategory:"usage",eventAction:"command-3D"});t.setEventData({eventLabel:"Templates"}),t.trackPageEvent()})),(new e).execute(),this.done()},t.prototype.endExecute=function(){this.destroy(),this.done()},t.prototype.destroy=function(){delete this.ec},t})),define("DS/Issue3DReviewV2Rsc/utils/ISURightSidePanelUtils",["DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/PADUtils/PADSettingsMgt","DS/EditPropWidget/constants/EditPropConstants","DS/Selection/CSOManager","DS/IssueServices/Contexts","i18n!DS/PADUtils/assets/nls/PADUtils.json","i18n!DS/Issue3DReviewV2Rsc/assets/nls/Issue3DReview"],(function(e,t,n,s,i,o,r){"use strict";function a(){return"object"==typeof a.instance?a.instance:(this.name="ISURightSidePanelUtils",a.instance=this,this)}return a.prototype.initializeFacets=function(e,t){t.removeFacets([n.FACET_VIEWS]),t.removeFacets([n.FACET_DERIVEDOUTPUT]);const s=e.getPropertiesFacet(),i=[];for(let e=0;e<s.length;++e){const n=new Promise((n=>{const i=s[e];if(i.facet){if(i.facet.text||(i.facet.text=o[`${i.facet.name}_cmd_title`]),i.actions&&i.actions.length>0)for(let e=0;e<i.actions.length;++e)i.actions[e].text=o[i.facet.name+i.actions[e].text];t.addFacets([i])}n()}));i.push(n)}return i},a.prototype.getSelectedNodes=function(n){var o=function(){return this.refID},r=function(){return this.instID},a=function(){return this.i3dx},l=i.get("component").getSelectedIssues().length>0?i.get("component").getSelectedIssues():s.get();if(l&&Array.isArray(l)&&l.length>0&&("Issue"==l[0].type||"Issue"==l[0].baseType)){var c=[];return l.forEach((e=>{c.push({id:e.id,tenant:t.getSetting("x3dPlatformId"),source:"3DSpace",getID:()=>e.id,getRelationID:()=>{}})})),c}{const i=s.get(),l=[];for(let t=0;t<i.length;++t){let s=i[t].pathElement;for(;s&&!e.isPLMNode(s.getLastElement(!0))&&!e.isTileSetNode(s.getLastElement(!0));)s=s.getParentPath();if(!s&&n.isSelectiveLoadingActivated());else{const t=e.getRootReferences(s.getLastElement(!0)),i=e.getNodeID(t[0]);l.push({refID:e.getNodeID(s.getLastElement(!0)),instID:e.getNodeID(s.getParentPath().getLastElement(!0)),i3dx:e.getNodeI3DX(s.getLastElement(!0)),source:n.getController().getRootStats(i).serviceId})}}const c=[];for(let e=0;e<l.length;++e)c.push({id:l[e].refID,tenant:t.getSetting("x3dPlatformId"),source:l[e].source,getID:o.bind(l[e]),getRelationID:r.bind(l[e]),getI3DX:a.bind(l[e])});return c}},a.prototype.selectionChange=function(e,t,a){var l=this;if(l.component=i.get("component"),!l.component||!l.component.isPickIn3DProcessing){var c=(a=a||this.component.getSelectedIssues())||s.get();if(c=c.filter((e=>!("function"==typeof e.getNodeSource&&1===e.getNodeSource()))),c.length)for(let s=0;s<c.length;++s){const i=c[s];if("r2vsurvey"===this.getServiceId(e,i)||!0===this.isInternalJSONObject(i)){const n=e.getPropertiesFacet();for(let e=0;e<n.length;++e){const s=n[e];if(s.facet){if(s.facet.text||(s.facet.text=o[`${s.facet.name}_cmd_title`]),s.actions&&s.actions.length>0)for(let e=0;e<s.actions.length;++e)s.actions[e].text=o[s.facet.name+s.actions[e].text];t.removeFacets([s.facet.name])}}}else if(!0!==this.isInternalJSONObject(i))if(t.removeFacets([n.FACET_VIEWS]),t.removeFacets([n.FACET_DERIVEDOUTPUT]),"Issue"==i.type||"Issue"==i.baseType){t.removeFacets([n.FACET_DERIVEDOUTPUT,"referencedocuments","specificationdocuments"]);var u=[];u.push({require:"DS/IssueCommon/facets/CommentsFacet",alwaysVisible:!0,supportMerge:!0,visible:!0,services:["3DSpace"],content:null,facet:{name:"Issue-Comments",icon:"comment",text:r.comments}}),t.addFacets(u),t.removeFacets([n.FACET_SWYMCOMMENTS])}else{const n=e.getPropertiesFacet();for(let e=0;e<n.length;++e){const s=n[e];if(s.facet){if(s.facet.text||(s.facet.text=o[`${s.facet.name}_cmd_title`]),s.actions&&s.actions.length>0)for(let e=0;e<s.actions.length;++e)s.actions[e].text=o[s.facet.name+s.actions[e].text];t.removeFacets(["Issue-Comments"]),t.addFacets([s])}}}}}},a.prototype.getID=function(t,n){for(var s,i=n.pathElement;i&&!e.isPLMNode(i.getLastElement(!0))&&!e.isTileSetNode(i.getLastElement(!0));)i=i.getParentPath();if(!i&&t.isSelectiveLoadingActivated())s=t.getController().getOOCSelectedReferenceID();else{var o=i.getLastElement(!0);s=e.getNodeID(o)}return s},a.prototype.getI3DX=function(t){let n,s=t.pathElement;for(;s&&!e.isPLMNode(s.getLastElement(!0))&&!e.isTileSetNode(s.getLastElement(!0));)s=s.getParentPath();if(s){const t=s.getLastElement(!0);n=e.getNodeI3DX(t)}return n},a.prototype.getRelationID=function(t){for(var n,s=t.pathElement;s&&!e.isPLMNode(s.getLastElement(!0))&&!e.isTileSetNode(s.getLastElement(!0));)s=s.getParentPath();if(s){var i=s.getLastElement(!0);if(e.isInstance(i))n=e.getNodeID(i);else{var o=s.getParentPath().getLastElement(!0);n=e.getNodeID(o)}}return n},a.prototype.getType=function(t){for(var n,s=t.pathElement;s&&!e.isPLMNode(s.getLastElement(!0))&&!e.isTileSetNode(s.getLastElement(!0));)s=s.getParentPath();if(s){var i=s.getLastElement(!0);n=e.getNodeType(i)}return n},a.prototype.getServiceId=function(n,s){if("Issue"==s.type||"Issue"==s.baseType)return"3DSpace";const i=e.getNodeID(s.pathElement.externalPath[1]);return t.getSetting("enopad3dviewer_lightNodeModel")&&n.getController().getRootStats(i)?n.getController().getRootStats(i).serviceId:"3DSpace"},a.prototype.isInternalJSONObject=function(t){let n=!1,s=t.pathElement;for(;s&&!e.isPLMNode(s.getLastElement(!0));)s=s.getParentPath();if(s){const t=s.getLastElement(!0);n=e.isInternalJSONObject(t)}return n},new a})),define("DS/Issue3DReviewV2Rsc/commandsWebAfr/CommandsManager",["DS/ApplicationFrame/CommandsManager","DS/Logger/Logger","DS/IssueServices/Contexts"],(function(e,t,n){"use strict";var s=t.getLogger("DS/Issue3DReviewV2Rsc/commandsWebAfr/CommandsManager"),i={disabled:!1,commands:{toEnable:[],toDisable:[]},commandCheckHeaders:{toEnable:[],toDisable:[]}},o="Default";return{setContext:function(e){o=e},select:function(e){var t=[],n=[];e&&e.length>0?(e.length>=1&&t.push("Open","Inspect","Share"),1===e.length?t.push("AttachmentManager","Mockup"):n.push("AttachmentManager","Mockup")):n.push("Open","AttachmentManager","Mockup","Inspect","Share"),this._switchCommands(t,!0),this._switchCommands(n,!1)},getCommand:function(e){return n.get("pad3DViewer").getExecutionContext().getComponent(WAfrStandardComponentKey.HandlerComponent).hasHandler(e)},getCheckCommand:function(e){return n.get("pad3DViewer").getExecutionContext().getComponent(WAfrStandardComponentKey.HandlerComponent).hasCheckHandler(e)},getCommandCheckHeader:function(t){var n=o;return e.getCommandCheckHeader(t,n)},disableAll:function(){if(!0!==i.disabled){var t=o,n=e.getCommands(t),s=Object.keys(n),r=e.getCommandCheckHeaders(t),a=Object.keys(r);i={disabled:!0,commands:{toEnable:[],toDisable:[]},commandCheckHeaders:{toEnable:[],toDisable:[]}};for(var l=0;l<s.length;l++)n[s[l]].isEnabled()?i.commands.toEnable.push(s[l]):i.commands.toDisable.push(s[l]);for(var c=0;c<a.length;c++)r[a[c]].isEnabled()?i.commandCheckHeaders.toEnable.push(a[c]):i.commandCheckHeaders.toDisable.push(a[c])}},enable:function(e){n.get("pad3DViewer").getExecutionContext().getComponent(WAfrStandardComponentKey.HandlerComponent).enableHandler(e)},disable:function(e){n.get("pad3DViewer").getExecutionContext().getComponent(WAfrStandardComponentKey.HandlerComponent).disableHandler(e)},enableCheck:function(e){n.get("pad3DViewer").getExecutionContext().getComponent(WAfrStandardComponentKey.HandlerComponent).enableCheck(e)},disableCheck:function(e){n.get("pad3DViewer").getExecutionContext().getComponent(WAfrStandardComponentKey.HandlerComponent).disableCheck(e)},checkStatus:function(){var e;e="true"===localStorage.getItem("Issue3DReviewDisplay"),localStorage.getItem("Issue3DReviewFocus"),n.get("pad3DViewer").getExecutionContext().getComponent(WAfrStandardComponentKey.HandlerComponent).setCheckState({id:"Display",state:e,args:{displayNotification:!1}})},enableAll:function(){if(!1!==i.disabled){var t=o;e.enableAll(t);var n=e.getCommands(t);if(i&&i.commands){for(var s=0;s<i.commands.toEnable.length;s++)n[i.commands.toEnable[s]].enable();for(var r=0;r<i.commands.toDisable.length;r++)n[i.commands.toDisable[r]].disable()}var a=e.getCommandCheckHeaders(t);if(i&&i.commandCheckHeaders){for(var l=0;l<i.commandCheckHeaders.toEnable.length;l++)a[i.commandCheckHeaders.toEnable[l]].enable();for(var c=0;c<i.commandCheckHeaders.toDisable.length;c++)a[i.commandCheckHeaders.toDisable[c]].disable()}i={disabled:!1,commands:{toEnable:[],toDisable:[]},commandCheckHeaders:{toEnable:[],toDisable:[]}}}},_switchCommands:function(e,t){for(var n=this,i=0;i<e.length;i++){if(n.getCommand(e[i]))try{!0===t?n.enable(e[i]):n.disable(e[i])}catch(n){s.error("Error "+(t?"enabling":"disabling"),e[i],n)}else if(1==n.getCheckCommand(e[i]))try{!0===t?n.enableCheck(e[i]):n.disableCheck(e[i])}catch(n){s.error("Error "+(t?"enabling":"disabling"),e[i],n)}}},inspectingIssue:function(){var e=[];e.push("ENO3DCleanViewCmd","CreateFromBlank","CreateFromTemplate","Display","Focus","Refresh","Templates","CreateFrom3D"),this._switchCommands(e,!1)},releasingIssue:function(){var e=[],t=[];e.push("ENO3DCleanViewCmd","CreateFromBlank","CreateFromTemplate","Display","Focus","Refresh","Templates","CreateFrom3D"),t.push("Inspect"),this._switchCommands(e,!0),this._switchCommands(t,!1)},clean:function(t){t||(t="Default"),e._commandsState||(e._commandsState={}),e._commandsState[t]={lastCommand:[],currentCommand:null,defaultCommand:null},e.resetDefaultCommand(t),e._isCommandEnding=!1,e._ignoreCommandBeginWhileEndingCommand=!1,["_commands","_cmdCheckHeader"].forEach((function(n){var s;null!=(s=t&&null!=e[n]&&e[n][t]?e[n][t]:e[n])&&Object.keys(s).forEach((function(e){var t=s[e];t&&t._destroy&&t._destroy(),delete s[e]}))}))}}})),define("DS/Issue3DReviewV2Rsc/components/header/Filter",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/DropdownMenu","DS/UIKIT/Iconbar","DS/UIKIT/Input/Toggle","DS/PADUtils/views/PADAlert","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","DS/IssueCommon/utils/Utils","i18n!DS/Issue3DReviewV2Rsc/assets/nls/Issue3DReview"],(function(e,t,n,s,i,o,r,a,l,c,u){"use strict";var d=1e3;return t.extend({name:"DS/Issue3DReviewV2Rsc/components/header/Filter",tagName:"div",className:"filter-container",_logger:null,elements:{bar:null,menu:null},filter:{},setup:function(e){var t=this;l.start(t.name+" setup"),t._parent(e),t.elements={bar:null,menu:null},l.end(t.name+" setup")},render:function(){var t=this;l.start(t.name+" render");var o=a.get("widget")||window.widget;t.elements.bar=new i({renderTo:t.container,items:[{name:"Filter",fonticon:"list-filter",text:u.filter.title,handler:function(){}}]});var p=JSON.parse(o.getValue("filter")),g=[{text:u.filter.synchronize.header,className:"header"},{name:"synchronize",title:u.filter.synchronize.tooltip,text:u.filter.synchronize.title,selectable:!0,selected:!0===p.synchronize,disabled:!1}];!0!==p.synchronize&&(t.elements.bar.menu.items.splice(1,0),g=g.concat([{className:"divider"},{name:"owned",text:u.filter.owned,selectable:!0,selected:!0===p.owned,disabled:!0===p.synchronize},{name:"assigned",text:u.filter.assigned,selectable:!0,selected:!0===p.assigned,disabled:!0===p.synchronize},{className:"divider"},{name:"contributed",text:u.filter.others.contributed,selectable:!0,selected:!0===p.contributed,disabled:!0===p.synchronize},{className:"divider"},{name:"closed",text:u.filter.others.closed,selectable:!0,selected:!0===p.closed,disabled:!0===p.synchronize}])),!0!==p.synchronize&&o.getPreference("organizationFilter").value&&(t.elements.bar.menu.items.splice(1,0),g.splice(6,0,{name:"reported",text:u.filter.others.reported,selectable:!0,selected:!0===p.reported,disabled:!0===p.synchronize},{name:"responsible",text:u.filter.others.responsible,selectable:!0,selected:!0===p.responsible})),t.elements.menu=new s({target:t.elements.bar.getItem("Filter").elements.icon,multiSelect:!0,closeOnClick:!1,items:g,events:{onClick:function(s,i){var l=new e((function(e,s){if("synchronize"===i.name){var l=a.get("component");if(!0===i.selected){t.elements.menu.items.forEach((function(e){"synchronize"!==e.name&&"others"!==e.name&&t.elements.menu.disableItem(e.name)}));var p=!1;l.taskManager.addGetFilteredIssuesTask((function(t){var s=n.is(t,"object")&&n.is(t.filter,"object")&&Array.isArray(t.filter.issues)?n.clone(t.filter.issues):null;l.setFilteredIssues(s),p=!0;var i=JSON.parse(o.getValue("filter"));i.synchronize=!0,e(JSON.stringify(i))})),setTimeout((function(){!1===p&&(r.displayNotification({msg:u.filter.synchronize.timeout,eventID:"info"}),s(new Error("getFilteredIssuesTask timeout")))}),d);try{c.cloudProbeUtils.sendI3DRCommandsTrackerEvent({options:{pd1:"Issue",pd2:"3DViewer",pd3:"Filter",pd4:"Synchronised",pd5:"Issue/3DViewer/Filter/Synchronised"}})}catch(e){}}else{t.elements.menu.items.forEach((function(e){"synchronize"!==e.name&&"others"!==e.name&&t.elements.menu.enableItem(e.name)})),l.setFilteredIssues(null);var g=JSON.parse(o.getValue("filter"));g.synchronize=!1,e(JSON.stringify(g))}}else{var m={};if(t.elements.menu.getSelectedItems().forEach((function(e){m[e.name]=!0})),e(JSON.stringify(m)),i.name){var h="";(i.name="owned")&&(h="OwnedByMe"),(i.name="assigned")&&(h="AssignedToMe"),(i.name="contributed")&&(h="WhereIContribute"),(i.name="completed")&&(h="Completed");try{c.cloudProbeUtils.sendI3DRCommandsTrackerEvent({options:{pd1:"Issue",pd2:"3DViewer",pd3:"Filter",pd4:h,pd5:"Issue/3DViewer/Filter/"+h}})}catch(e){}}}}));l.then((function(e){n.is(e,"string")&&""!==e&&o.setValue("filter",e),setTimeout((function(){a.get("application").refresh(null,!0)}),0)})).finally((function(){t.refresh()}))}}});var m=o.getValue("roots");return Array.isArray(m)&&m.length>0&&(t.elements.menu.addItem({className:"divider"}),t.elements.menu.addItem({name:"session",text:u.replace(u.filter.session,{number:m.length}),selectable:!0,selected:!0===p.session})),l.end(t.name+" render"),t},refresh:function(){this.destroy(),this.render()},destroy:function(){var e=this;e.elements.menu.hide(),e.elements={bar:null,menu:null},e.container.empty()}})})),define("DS/Issue3DReviewV2Rsc/views/Balloon",["UWA/Class","UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Input/Button","DS/UIKIT/Popover","DS/CoreEvents/Events","DS/Core/PointerEvents","DS/ENOjquery/ENOjquery","DS/ENOjqueryUI/jQueryUI","DS/IssueServices/utils/Performance","DS/IssueServices/Contexts","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/SceneGraphNodes/CSS2DNode","DS/Visualization/Node3D","DS/Visualization/ThreeJS_DS","DS/VisuEvents/EventsManager","i18n!DS/Issue3DReviewV2Rsc/assets/nls/Issue3DReview","css!DS/Issue3DReviewV2Rsc/Issue3DReviewV2Rsc.css"],(function(e,t,n,s,i,o,r,a,l,c,u,d,p,g,m,h,f,v,D){"use strict";var I=200,b=100,w={height:45,width:25},y="1",S="#3D3D3D",C="#3D3D3D",_=0,E=0,R=function(e,t,n,s){return'<svg class="balloon-svg" width="25" height="45" viewBox="0 0 25 45" preserveAspectRatio="xMaxYMax" xmlns="http://www.w3.org/2000/svg"><g><g class="balloon-container" opacity="'+t+'"><path class="balloon-path" stroke-width="1" stroke="'+n+'" fill="'+e+'" d="m12.50023,0.61752c-6.51488,0 -11.79788,5.59224 -11.79788,12.48846c0,2.80815 0.87686,5.40025 2.35194,7.48519c0.005,0.00289 0.00727,0.00818 0.00727,0.01059c0.28047,0.43643 9.31685,14.46321 9.43822,23.78072c0.12182,-9.31751 9.15775,-23.34429 9.43867,-23.78072c0.005,-0.0077 0.00727,-0.01059 0.00727,-0.01059c1.47599,-2.08494 2.35194,-4.67704 2.35194,-7.48519c0,-6.89575 -5.28209,-12.48846 -11.79743,-12.48846zm0,6.57288c2.94833,0 5.34028,2.53195 5.34028,5.65287c0,3.12091 -2.39194,5.65287 -5.34028,5.65287s-5.33982,-2.53195 -5.33982,-5.65287c0,-3.12091 2.39149,-5.65287 5.33982,-5.65287z" /></g><ellipse class="balloon-inner" opacity="'+t+'" stroke="'+s+'" ry="4.16736" rx="3.95816" id="svg_6" cy="12.83264" cx="12.5" stroke-width="2" fill="'+s+'" /></g></svg><div class="pulse"></div>'},A=function(){return s.createElement("div",{class:"issue-reposition-confirmation",html:'<div class="issue-reposition-confirmation-label">'+D.inspect.relocate+"</div>"})},x=function(){return'<span class="dnd-status dnd-status-ok"><span class="fonticon fonticon-check"></span></span>'},P=function(){return'<span class="dnd-status dnd-status-ko"><span class="fonticon fonticon-cancel"></span></span>'};return n.extend({name:"DS/Issue3DReviewV2Rsc/views/Balloon",tagName:"div",className:"issue-balloon",_logger:null,defaultOptions:{parent:null,viewer:null,window:null,controller:null},isSelected:!1,isVisible:!1,isEnabled:!0,node:null,balloon:null,_visualizationEvents:[],_preventEvents:!1,setup:function(e){var t=this;t._logger=p.getLogger("DS/Issue3DReviewV2Rsc/View"),t._logger.debug("Setup for balloon %s %s %s for issue %s (%s)",t.model.get("type"),t.model.get("name"),t.model.get("revision"),t.model.get("issue").get("title"),t.model.get("issue").get("name")),u.start(t.name+" setup"),t.options=s.merge(e||{},t.defaultOptions);var n=new h;n.name="issue-balloon-3D",n.setVisibilityInTree(!1),n.exludeFromBounding(!0),n._excludeFromCSO=!0,t.options.viewer.addNode(n,!1),t.isSelected=!1,t.isVisible=!1,t.node=n,t.balloon=null,t._visualizationEvents=[],t._preventEvents=!1,u.end(t.name+" setup")},destroy:function(){var e=this;e.stopListening(e.model,"onChange"),e._visualizationEvents.forEach((function(e){v.removeEvent(e.container,e.event,e.cb)})),e.enable(!0),null!==e.balloon&&(e.balloon.html.destroy(),e.node.removeChild(e.balloon.node)),null!==e.node&&e.node.remove(),e.isSelected=!1,e.isVisible=!1,e.node=null,e.balloon=null,e._preventEvents=!1,e.options={},e.container.empty(),e.container.destroy(),e.dispatchEvent("onDestroy")},render:function(e){var t=this;t._logger.debug("Rendering balloon %s %s %s for issue %s (%s)",t.model.get("type"),t.model.get("name"),t.model.get("revision"),t.model.get("issue").get("title"),t.model.get("issue").get("name")),u.start(t.name+" render");var n=t.model.get("color"),s=t.model.get("default");return null!==t.model.get("position")&&(s=t.model.get("position")),t.balloon=t.create(t.node,n,s),t.model.get("temporary")?t.container.addClassName("issue-balloon-temporary"):(t.container.setData("markerId",t.model.get("id")),t.draggable()),t.enableOptimization=!0,d.add("enableOptimization",!0),t.promiseWhileRendering=t.show().then((function(){e&&"function"==typeof e.callback&&e.callback()})),t._subscribers(),u.end(t.name+" render"),t},create:function(e,t,n){var s=this;u.start(s.name+" create");var i=R(t,y,S,C);s.container.setContent(i+'<div class="issue-balloon-information"></div>'),s.container.setAttribute("data-name",s.model.get("issue").get("name"));var o=new m({html:s.container,name:"issue-balloon-2D"});o.setVisibilityInTree(!1),o.exludeFromBounding(!0),o.setOffset(new f.Vector2(-w.width/2,-w.height)),o._excludeFromCSO=!0,s.container.setOpacity(1);var r=s.container.getElement(".issue-balloon-information");return e.setMatrix((new f.Matrix4).setPosition(n)),o.setNoZ(!0),e.addChild(o),u.end(s.name+" create"),{node:o,html:s.container,information:r}},show:function(){var e=this;return!0===e.isVisible?t.resolve():new t((function(t){e.balloon.html.addEventListener("animationend",(function(){e.isVisible=!0,e.balloon,t()})),e.balloon.html.removeClassName("issue-balloon-animation-hide").addClassName("issue-balloon-animation-show"),e.balloon.node.setVisibility(!0),e.balloon.html.hidden=!1,e.enable()}))},hide:function(){var e=this;return!1===e.isVisible?t.resolve():new t((function(t){var n=function(){e.isVisible=!1,null!==e.balloon?(e.balloon.html.removeEventListener("animationend",n),e.balloon.node.setVisibility(!1),e.balloon.html.hidden=!0,e.disable(),e.options.viewer.render(),t()):t()};!0===e.isBalloonInViewport()?e.balloon.html.addEventListener("animationend",n):setTimeout((function(){n()}),0),e.balloon.html.removeClassName("issue-balloon-animation-show").addClassName("issue-balloon-animation-hide")}))},enable:function(e){var t=this;t.isEnabled=!0,e||t.container.getParent().removeClassName("issue-balloon-fade-out-element").addClassName("fade-in-element"),t.container.getParent().setStyle("opacity",1),t.container.getParent().setStyle("pointer-events","auto")},disable:function(e){var t=this;t.isEnabled=!1,e||t.container.getParent().removeClassName("issue-balloon-fade-in-element").addClassName("fade-out-element"),t.container.getParent().setStyle("opacity",0),t.container.getParent().setStyle("pointer-events","none")},over:function(){var e=this;!0===e.isEnabled&&!0!==e.isSelected&&e.balloon.node.getElement().addClassName("hover")},out:function(){!0!==this.isSelected&&this.balloon.node.getElement().removeClassName("hover")},select:function(){var e=this;e.isSelected=!0,e.balloon.node.getElement().addClassName("selection"),e.dispatchEvent("onSelect")},unselect:function(){var e=this;e.isSelected=!1,e.balloon.node.getElement().removeClassName("selection").removeClassName("hover"),e.dispatchEvent("onUnselect")},draggable:function(){var e=this;u.start(e.name+" draggable"),e.balloon.node.css2DNode.element.ondragstart=null;var t=null,n=x(),s=P(),a=function(t){var n=e.options.viewer.getMousePosition(new f.Vector2(t.clientX,t.clientY)),s=e.options.viewer.pick(n,"primHybrid",!0);if(s.position&&s.path.length){var i=e.options.controller.buildArrayFromPath(s.path[_]).join(","),o=e.model.get("path").join(",");return-1!==i.indexOf(o)?s:null}return null},c=null;l(e.balloon.html).draggable({delay:b,revert:function(){return null===a({clientX:c.clientX,clientY:c.clientY})},revertDuration:2*b,cursorAt:{left:w.width/2,top:w.height},opacity:.6,drag:function(t){c=t,null!==a({clientX:t.clientX,clientY:t.clientY})?e.balloon.information.setContent(n):e.balloon.information.setContent(s)},start:function(s,i){t=i.helper.position(),e.options.parent.dispatchEvent("onMouseLeave",{id:e.model.get("physicalId"),object:e,balloon:e.balloon.html,event:s}),e._preventEvents=!0,e.balloon.information.setContent(n)},stop:function(n){c=n;var s=a({clientX:n.clientX,clientY:n.clientY});if(null===s)return e.balloon.information.setContent(""),void(e._preventEvents=!1);l(e.balloon.html).draggable("disable"),e.balloon.node.getElement().addClassName("waiting");var u=A(),d=new o({target:e.container,trigger:"manual",position:"right",autoHideOnClickOutside:!1,autoHide:!1,delay:{show:b,hide:b},body:u});d.shouldListenForScroll=!1;var p=r.subscribe({event:"/VISU/"},(function(e){"@onViewpointEndMove"===e.eventType&&d.updatePosition()}));new i({value:D.inspect.yes,className:"primary",events:{onClick:function(){e.balloon.node.getElement().removeClassName("waiting"),d.destroy(),r.unsubscribe(p),e.balloon.information.setContent(""),l(e.balloon.html).draggable("enable"),e.model.save({position:s.position},{onComplete:function(){e.options.parent.dispatchEvent("onChange:position",{id:e.model.get("id"),physicalId:e.model.get("physicalId"),model:e.model})},onFailure:function(){g.displayNotification({msg:D.notifications.cannotRelocateBalloon,eventID:"error"}),l(e.balloon.html).animate({top:t.top,left:t.left},I)}}),e._preventEvents=!1}}}).inject(u),new i({value:D.inspect.no,className:"default",events:{onClick:function(){e.balloon.node.getElement().removeClassName("waiting"),d.destroy(),r.unsubscribe(p),l(e.balloon.html).animate({top:t.top,left:t.left},I),e.balloon.information.setContent(""),l(e.balloon.html).draggable("enable"),e._preventEvents=!1}}}).inject(u),d.show(),d.updatePosition()}}),u.end(e.name+" draggable")},isBalloonInViewport:function(){var e=this;if(!e.balloon||!e.balloon.html)return!1;var t=e.balloon.html.getBoundingClientRect();return(0!==t.top||0!==t.left||0!==t.bottom||0!==t.right)&&(t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth))},_onChangePosition:function(){var e=this;e._logger.debug("Changing the position for balloon %s %s %s for issue %s (%s)",e.model.get("type"),e.model.get("name"),e.model.get("revision"),e.model.get("issue").get("title"),e.model.get("issue").get("name")),u.start(e.name+" _onChangePosition");var n=e.isVisible;e.hide().then((function(){var s=null!==e.model.get("position")?e.model.get("position"):e.model.get("default");return e.node.setMatrix((new f.Matrix4).setPosition(s)),e.balloon.html.setStyle("left","initial"),e.balloon.html.setStyle("top","initial"),e.options.viewer.render(),u.end(e.name+" _onChangePosition"),!0===n?e.show():t.resolve()}))},_onChangeColor:function(){var e=this;e._logger.debug("Changing the color for balloon %s %s %s for issue %s (%s)",e.model.get("type"),e.model.get("name"),e.model.get("revision"),e.model.get("issue").get("title"),e.model.get("issue").get("name")),u.start(e.name+" _onChangeColor");var n=e.isVisible;e.hide().then((function(){var s=e.balloon.html,i=e.model.get("color");return s.getElement(".balloon-path").setAttribute("fill",i),u.end(e.name+" _onChangeColor"),!0===n?e.show():t.resolve()}))},_subscribers:function(){var e=this;e.listenTo(e.model,"onChange:position",e._onChangePosition),e.listenTo(e.model,"onChange:color",e._onChangeColor),e._visualizationEvents=[{container:e.balloon.html.getParent(),event:"onPrimaryPointerClick",cb:function(t){!0!==e._preventEvents&&e.options.parent.dispatchEvent("onClick",{id:e.model.get("physicalId"),object:e,balloon:e.balloon.html,isMultipleSelection:e.utils.isMultipleSelection(t),event:t})}},{container:e.balloon.html,event:"onPrimaryPointerDoubleClick",cb:function(t){!0!==e._preventEvents&&e.options.parent.dispatchEvent("onDoubleClick",{id:e.model.get("physicalId"),object:e,balloon:e.balloon.html,isMultipleSelection:e.utils.isMultipleSelection(t),event:t})}}],e._visualizationEvents.forEach((function(e){v.addEvent(e.container,e.event,e.cb)})),e.balloon.html.getParent().addEventListener("mouseover",(function(t){!0!==e._preventEvents&&e.options.parent.dispatchEvent("onMouseOver",{id:e.model.get("physicalId"),object:e,balloon:e.balloon.html,event:t})})),e.balloon.html.getParent().addEventListener("mouseleave",(function(t){if(!0!==e._preventEvents){for(var n=t.toElement||t.relatedTarget;n&&n.parentNode&&n.parentNode!==window;){if(n.parentNode===this||n===this)return void(n.preventDefault&&n.preventDefault());n=n.parentNode}e.options.parent.dispatchEvent("onMouseLeave",{id:e.model.get("physicalId"),object:e,balloon:e.balloon.html,event:t})}})),e.balloon.html.addEventListener("contextmenu",(function(t){return!0===e._preventEvents||(t.preventDefault(),t.stopPropagation(),e.options.parent.dispatchEvent("onContextMenu",{id:e.model.get("physicalId"),object:e,balloon:e.balloon.html,isMultipleSelection:e.utils.isMultipleSelection(t),event:t})),!1})),e.balloon.html.addEventListener(a.LONGHOLD,(function(t){return!0===e._preventEvents||a.isTouchEvent(t)&&(t.preventDefault(),t.stopPropagation(),e.options.parent.dispatchEvent("onContextMenu",{id:e.model.get("physicalId"),object:e,balloon:e.balloon.html,isMultipleSelection:e.utils.isMultipleSelection(t),event:t})),!1}));var t=0,n=0,s=0;e.balloon.html.addEventListener("touchstart",(function(e){if(e.touches&&1===e.touches.length){var i=(new Date).getTime(),o=i-t,r=Math.abs(n-e.touches[E].clientX),a=Math.abs(s-e.touches[E].clientY);r<10&&a<10&&o<500&&e.preventDefault(),n=e.touches[E].clientX,s=e.touches[E].clientY,t=i}}))},utils:{isMultipleSelection:function(e){var t=!1;try{t=e.gesture.events[E].event.ctrlKey}catch(e){}return void 0!==e.ctrlKey&&(t=e.ctrlKey),t}}})})),define("DS/Issue3DReviewV2Rsc/commandsWebAfr/Inspect",["DS/IssueCommon/utils/Utils"],(function(e){"use strict";function t(e){this.ec=e.executionContext}return t.prototype.beginExecute=function(){require(["DS/PADServices/utils/PADTrackerManager"],(e=>{const t=e.getPADTracker({eventCategory:"usage",eventAction:"command-3D"});t.setEventData({eventLabel:"Inspect"}),t.trackPageEvent()})),require(["DS/IssueServices/Contexts"],(function(e){for(var t=e.get("component"),n=t.getSelectedIssues(),s=[],i=0;i<n.length;i++)s.push(n[i].id);t.inspect(s)})),this.done();try{e.cloudProbeUtils.sendI3DRCommandsTrackerEvent({options:{pd1:"Issue",pd2:"3DViewer",pd3:"Issue3DReviewToolbar",pd4:"InspectIssues",pd5:"Issue/3DViewer/Issue3DReviewToolbar/InspectIssues"}}),e.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"Issue3DReviewToolbar"}})}catch(e){}},t.prototype.endExecute=function(){this.destroy(),this.done()},t.prototype.destroy=function(){delete this.ec},t})),define("DS/Issue3DReviewV2Rsc/commandsWebAfr/3DMarkup",["DS/IssueCommon/utils/Utils"],(function(e){"use strict";function t(e){this.ec=e.executionContext}return t.prototype.beginExecute=function(){require(["DS/i3DXCompassServices/i3DXCompassPubSub"],(function(t){var n={appId:"ENOR3D_AP",widgetId:widget.id,fileName:"-file",fileContent:""};t.publish("launchApp",n);try{e.cloudProbeUtils.sendI3DRCommandsTrackerEvent({options:{pd1:"Issue",pd2:"3DViewer",pd3:"Issue3DReviewToolbar",pd4:"3DMarkup",pd5:"Issue/3DViewer/Issue3DReviewToolbar/3DMarkup"}}),e.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"Issue3DReviewToolbar"}})}catch(e){}}))},t.prototype.endExecute=function(){this.destroy(),this.done()},t.prototype.destroy=function(){delete this.ec},t})),define("DS/Issue3DReviewV2Rsc/commandsWebAfr/CollaborativeLifecycle",["DS/IssueCommon/commands/CollaborativeLifecycle"],(function(e){"use strict";function t(e){this.ec=e.executionContext}return t.prototype.beginExecute=function(){require(["DS/PADServices/utils/PADTrackerManager"],(e=>{const t=e.getPADTracker({eventCategory:"usage",eventAction:"command-3D"});t.setEventData({eventLabel:"CollaborativeLifecycle"}),t.trackPageEvent()})),(new e).execute(),this.done()},t.prototype.endExecute=function(){this.destroy(),this.done()},t.prototype.destroy=function(){delete this.ec},t})),define("DS/Issue3DReviewV2Rsc/commandsWebAfr/Move",["DS/IssueCommon/commands/Move"],(function(e){"use strict";function t(e){this.ec=e&&e.executionContext?e.executionContext:{}}return t.prototype.beginExecute=function(){require(["DS/PADServices/utils/PADTrackerManager"],(e=>{const t=e.getPADTracker({eventCategory:"usage",eventAction:"command-3D"});t.setEventData({eventLabel:"Move"}),t.trackPageEvent()})),(new e).execute(),this.done()},t.prototype.endExecute=function(){this.destroy(),this.done()},t.prototype.destroy=function(){delete this.ec},t})),define("DS/Issue3DReviewV2Rsc/commandsWebAfr/CreateFrom3D",["DS/IssueCommon/utils/Utils","DS/IssueCommon/commands/CommandsManager","DS/IssueCommon/commands/CreateIssuePLMNew","DS/IssueServices/Contexts","DS/IssueServices/utils/Parser"],(function(e,t,n,s,i){"use strict";var o="ENX3DIR_AP",r="PLMNewEnablement";function a(e){this.ec=e.executionContext,this.ID=e.ID}var l=function(e){(widget.getElement(".wux-afr-contextual-bar")&&(widget.getElement(".wux-afr-contextual-bar").style.opacity="0"),c.isPLMNew_Enabled())?new n({app:"ISU_3D"}).execute():require(["UWA/Class/Promise","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/Selection/CSOManager","DS/IssueComponents/create/Create","DS/IssueServices/services/IssueServices"],(function(t,n,o,r,a){for(var l=s.get("widget")||window.widget,c=o.get(),u=[],d=[],p=0;p<c.length;p++)u.push(c[p].pathElement);u.forEach((function(e){for(;!n.isReference(e.getLastElement());)e=e.getParentPath();var t=e.getLastElement();/^[0-9a-fA-F]{32}$/.test(n.getNodeID(t))?d.push(n.getNodeID(t)):n.getNodeI3DX(t)?d.push(n.getNodeI3DX(t)):d.push(n.getNodeID(t))})),new t((function(e){var t=[];a.fetch({data:{objects:d.map((function(e){return{physicalId:e}}))},onComplete:function(n){var s=n.body;"results"in s&&s.results.forEach((function(e){var n={},s=i.parseFetchResponse(e);n.fullName=s.display.responsible,n.user=s.display.owner,n.organization=s.display.organization,t.push(n)})),e(t)},onFailure:function(){e(t)}})})).then((function(t){var n=new r(l.body,{issueCreationType:e});n.render();var s=t.map((function(e){return{user:e.user}})),i={};"true"===localStorage.getItem("assignPreferenceTemplate")&&(i=t.reduce((function(e,t){return e[t.user]={user:t.user,fullName:t.fullName,organization:t.organization},e}),{})),n.isLoaded.then((function(){var e="";for(var t in i)i.hasOwnProperty(t)&&(e=i[t].organization);new Date;var o=n.finalize.getTasks(),r={id:"template-"+Date.now(),info:{name:"",description:"",lastUsed:null},data:{title:"",description:"",resolutionRecommendation:"",priority:"Low",resolutionDate:"",estimatedStartDate:"",estimatedEndDate:"",reportedAgainst:d.map((function(e){var t="";return t=e.includes("i3dx:r2vsurvey!")?"r2vsurvey":"3dspace",{physicalId:e,serviceId:t}})),positions:[],contexts:[],assignees:s,reportingOrganization:e,attachments:[],primaryAttachment:null,automationTasks:o,attributes:{}},ui:{assignees:i}};return n.applyTemplate(r)})).catch((function(e){n._logger.error(e)})).finally((function(){}))}))}))},c={isAlreadyRunning:function(){var e=s.get("widget")||window.widget;return null!==e.body.getElement(".create-template-chooser-dialog")||null!==e.body.getElement(".create-view-dialog")},isPLMNew_Enabled:function(){return s.get(r)}};return a.prototype.beginExecute=function(){require(["DS/PADServices/utils/PADTrackerManager"],(e=>{const t=e.getPADTracker({eventCategory:"usage",eventAction:"command-3D"});t.setEventData({eventLabel:"CreateFrom3D"}),t.trackPageEvent()}));var t=this;if(!0!==c.isAlreadyRunning()){var n=s.get("widget"),i=s.get("component");new Promise((function(e){n.name===o&&!0!==i.isDisplayed()?require(["DS/UIKIT/Mask"],(function(t){t.mask(n.body),s.get("pad3DViewer").getExecutionContext().getComponent(WAfrStandardComponentKey.HandlerComponent).setCheckState({id:"Display",state:!0}),t.unmask(n.body),e()})):e()})).then((function(){l(t.ID);try{e.cloudProbeUtils.sendI3DRCommandsTrackerEvent({options:{pd1:"Issue",pd2:"3DViewer",pd3:"Issue3DReviewToolbar",pd4:"NewIssue",pd5:"Issue/3DViewer/Issue3DReviewToolbar/NewIssue"}}),e.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"Issue3DReviewToolbar"}})}catch(e){}})),this.done()}},a.prototype.endExecute=function(){this.destroy(),this.done()},a.prototype.destroy=function(){delete this.ec},a})),define("DS/Issue3DReviewV2Rsc/commandsWebAfr/Mockup",["i18n!DS/IssueAttachmentManager/assets/nls/IssueAttachmentManager"],(function(e){"use strict";var t=50,n=/[/\\?%*:|"<>]/g,s=!1,i=null,o=Object.create(null);return o.handlerComponent=null,o.execute=function(o){require(["UWA/Core","DS/Selection/HSOManager","DS/2DAnnotation/2DAnnotation","DS/PADUtils/views/PADAlert","DS/UIKIT/Mask","DS/IssueAttachmentManager/services/AttachmentServices","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueCommon/utils/Utils","DS/PlatformAPI/PlatformAPI"],(function(r,a,l,c,u,d,p,g,m,h){if(!0!==s){var f=p.get("widget"),v=p.get("component"),D=v.get3DContext().root,I=v.getSelectedIssues();if(1===I.length){i=null;var b=v.getIssues().map[I[I.length-1].id],w=b.model.get("id");b.utils.unhighlight(b),s=!0,a.empty();var y=function(){b.utils.highlight(b),s=!1,i=null,this.destroy()};setTimeout((function(){var t=D.getViewer().canvas;(i=new l({className:"create-attachments-annotation",saveCallback:function(t){u.mask(f.body),u.mask(i.immersiveFrame.elements.container);var s=(new Date).toLocaleString();s=m.formatDate(s,{timePrecision:"sec"}).replace(n,"-");var o=e.replace(e.annotate.defaultName,{date:s}),r=new File([t.blob],o,{type:"image/png",lastModified:Date.now()});d.uploadFile(r,w).then((function(t){if(c.displayNotification({msg:e.replace(e.notifications.Annotation.uploadSuccess,{fileName:o}),eventID:"info"}),t&&t.data&&t.data.length>0&&t.data[0].id){var n=t.data[0];return d.setAsPrimary(n.id,w).then((function(t){var s=[[w]],i={};i[w]={id:w};var o=Math.floor(Date.now());h.publish("DS/Object/update",{metadata:{appId:f.id,appName:f.name,timestamp:o,options:{force:!0}},data:{paths:s,attributes:i},version:"1.0"});var r=JSON.parse(t);n.id===r.documentId&&c.displayNotification({msg:e.notifications.SetAsPrimary.success,eventID:"info"})}),(function(t){c.displayNotification({msg:e.notifications.SetAsPrimary.failure,eventID:"error"}),i._logger.error(t)}))}return Promise.reject(new Error("Unexpected empty response for upload."))}),(function(t){c.displayNotification({msg:e.notifications.Annotation.uploadFailure,eventID:"error"}),i._logger.error(t)})).finally((function(){u.unmask(f.body),u.unmask(i.immersiveFrame.elements.container),y.apply(i)}))},exitCallback:function(){y.apply(i)},captureTarget:t})).render(),i.isLoaded.then((function(){i.container.inject(f.body)})).catch((function(e){y.apply(i)})).finally((function(){}))}),t),o();try{m.cloudProbeUtils.sendI3DRCommandsTrackerEvent({options:{pd1:"Issue",pd2:"3DViewer",pd3:"Issue3DReviewToolbar",pd4:"New2DMarkup",pd5:"Issue/3DViewer/Issue3DReviewToolbar/New2DMarkup"}}),m.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"Issue3DReviewToolbar"}})}catch(e){}}}}))},o})),define("DS/Issue3DReviewV2Rsc/commandsWebAfr/Share",["DS/IssueCommon/commands/Share"],(function(e){"use strict";function t(e){this.ec=e.executionContext}return t.prototype.beginExecute=function(){return require(["DS/PADServices/utils/PADTrackerManager"],(e=>{const t=e.getPADTracker({eventCategory:"usage",eventAction:"command-3D"});t.setEventData({eventLabel:"Share"}),t.trackPageEvent()})),new Promise((t=>{(new e).execute(),this.done()}))},t.prototype.endExecute=function(){this.destroy(),this.done()},t.prototype.destroy=function(){delete this.ec},t})),define("DS/Issue3DReviewV2Rsc/commandsWebAfr/Duplicate",["DS/IssueCommon/commands/Duplicate"],(function(e){"use strict";function t(e){this.ec=e.executionContext}return t.prototype.beginExecute=function(){require(["DS/PADServices/utils/PADTrackerManager"],(e=>{const t=e.getPADTracker({eventCategory:"usage",eventAction:"command-3D"});t.setEventData({eventLabel:"Duplicate"}),t.trackPageEvent()})),(new e).execute(),this.done()},t.prototype.endExecute=function(){this.destroy(),this.done()},t.prototype.destroy=function(){delete this.ec},t})),define("DS/Issue3DReviewV2Rsc/utils/WidgetEventManagerWebAfr",["DS/PADUtils/PADSettingsMgt","DS/IssueServices/Contexts"],(function(e,t){"use strict";function n(){}return n.prototype._initWidgetEvents=function(){return console.log("WidgetEventManagerWebAfr._initWidgetEvents called"),this._DEBUG&&console.log("WidgetEventManagerWebAfr._initWidgetEvents called"),new Promise(((t,n)=>{this.getModelEvent()?(widget.addEvent("onRefresh",this._onRefresh.bind(this)),widget.addEvent("onSearch",this._onSearch.bind(this)),widget.addEvent("endEdit",e.updateWidgetPreferences.bind(e)),widget.addEvent("endEdit",this._onEndEdit.bind(this)),t()):n("Empty or undefined model events")}))},n.prototype._subscribeModelEvents=function(){return console.log("WidgetEventManagerWebAfr._subscribeModelEvents called"),this._DEBUG&&console.log("WidgetEventManagerWebAfr._subscribeModelEvents called"),new Promise(((e,t)=>{this.getModelEvent()?(this.subscribe({event:"onRootAdded"},this._onRootAdded.bind(this)),this.subscribe({event:"onEndRootRemoved"},this._onEndRootRemoved.bind(this)),e()):t("Empty or undefined model events")}))},n.prototype._onRefresh=function(e){this._DEBUG&&console.log("WidgetEventManagerWebAfr._onRefresh called");let n=t.get("component"),s=t.get("pad3DViewer"),i=t.get("filter");n.clear().then((function(){var e=!1;"HIGH"===t.get("widget").getValue("enopad3dviewer_CGRorTHB")&&(e=!0),s.setDefaultStreamToLoad(e),s.refresh(),i.refresh()}))},n.prototype._onSearch=function(e){this._DEBUG&&console.log("WidgetEventManagerWebAfr._onSearch called"),this.getViewer().search({searchQuery:e})},n.prototype._onEndEdit=function(e){this._DEBUG&&console.log("WidgetEventManagerWebAfr._onEndEdit called")},n.prototype._onRootAdded=function(e){this._DEBUG&&console.log("WidgetEventManagerWebAfr._onRootAdded called")},n.prototype._onRootRemoved=function(e){this._DEBUG&&console.log("WidgetEventManagerWebAfr._onRootAdded called")},n.prototype._onEndRootRemoved=function(){this._DEBUG&&console.log("WidgetEventManagerWebAfr._onEndRootRemoved called")},n.prototype._onReady=function(){this._DEBUG&&console.log("WidgetEventManagerWebAfr._onEndRootRemoved called")},n})),define("DS/Issue3DReviewV2Rsc/utils/ModelParser",["UWA/Core","DS/Logger/Logger","DS/IssueCommon/utils/Utils","DS/IssueServices/utils/Performance"],(function(e,t,n,s){"use strict";var i={NODE:{id:"",type:"",name:"",title:"",baseType:"",actionTaken:"",actualEndDate:"",actualStartDate:"",assignees:[],contexts:[],coOwners:[],created:"",description:"",estimatedEndDate:"",estimatedStartDate:"",modified:"",owner:{},priority:"",reportedAgainst:[],reportingOrganization:"",resolutionDate:"",resolutionRecommendation:"",resolutionStatement:"",resolvedBy:[],resolvedItems:[],responsibleOrganization:"",revision:"",state:"",iconurl:"",custom:{}}},o=function(t){var s=e.clone(i.NODE);for(var o in s.icons=[],i.NODE)i.NODE.hasOwnProperty(o)&&(s[o]=t[o]?t[o]:i.NODE[o]);s.id=t.physicalId?t.physicalId:s.id,s.physicalId=s.id,s.resourceid=s.id;var r=n.getIconByState(s.state,s.type,s.iconurl);return s.icons.push(r),s},r=function(t){var n=e.clone(i.NODE);n.icons=[];for(var s=t.attributes,o=0;o<s.length;o++){var r=s[o];switch(r.name){case"resourceid":n.id=r.value;break;case"ds6w:identifier":n.name=r.value;break;case"ds6w:label":n.title=r.value;break;case"ds6w:status":n.state=r.value;break;case"ds6w:type":n.type=r.value;break;case"ds6w:responsible":n.owner=r.value;break;case"type_icon_url":n.icons.push(r.value);break;case"ds6w:modified":n.modified=r.value;break;case"ds6w:created":n.created=r.value;break;case"ds6wg:revision":n.revision=r.value}}return n};return{name:"DS/Issue3DReviewV2Rsc/utils/ModelParser",parse:function(e,t){var n=[];if(s.start(this.name+" parse"),t=t||{},Array.isArray(e))if(!0===t.useIndex)for(var i=0;i<e.length;i++)n.push(r(e[i]));else for(var a=0;a<e.length;a++)n.push(o(e[a]));else n=!0===t.useIndex?r(e):o(e);return s.end(this.name+" parse"),n}}})),define("DS/Issue3DReviewV2Rsc/LandingPage_V2",["UWA/Class","UWA/Class/Promise","UWA/Core","DS/ENO3DUtils/ENO3DBaseComponent"],(function(e,t,n,s){"use strict";function i(e){this._options=e,this._landingPage=null,this._identifiers={widget:e.widgetIdentifier}}return i.prototype=Object.create(s.prototype),i.prototype.createLandingPage=function(){return new t((e=>{e(null)}))},i.prototype.getLandingPage=function(){return this._landingPage},i.prototype.getWidget=function(){return this.getComponentFromIdentifier(this._identifiers.widget).getSessionWidget()},i})),define("DS/Issue3DReviewV2Rsc/commandsWebAfr/ChangeAction",["DS/IssueCommon/commands/ChangeAction"],(function(e){"use strict";function t(e){this.ec=e.executionContext}return t.prototype.beginExecute=function(){require(["DS/PADServices/utils/PADTrackerManager"],(e=>{const t=e.getPADTracker({eventCategory:"usage",eventAction:"command-3D"});t.setEventData({eventLabel:"ChangeAction"}),t.trackPageEvent()})),(new e).execute(),this.done()},t.prototype.endExecute=function(){this.destroy(),this.done()},t.prototype.destroy=function(){delete this.ec},t})),define("DS/Issue3DReviewV2Rsc/commandsWebAfr/Open",["DS/IssueCommon/commands/Open"],(function(e){"use strict";function t(e){this.ec=e.executionContext}return t.prototype.beginExecute=function(){return require(["DS/PADServices/utils/PADTrackerManager"],(e=>{const t=e.getPADTracker({eventCategory:"usage",eventAction:"command-3D"});t.setEventData({eventLabel:"Open"}),t.trackPageEvent()})),new Promise((t=>{(new e).execute(),this.done()}))},t.prototype.endExecute=function(){this.destroy(),this.done()},t.prototype.destroy=function(){delete this.ec},t})),define("DS/Issue3DReviewV2Rsc/commandsWebAfr/Display",["UWA/Core","DS/Controls/Loader","DS/PADUtils/views/PADAlert","DS/IssueServices/Contexts","DS/IssueCommon/utils/Utils","i18n!DS/Issue3DReviewV2Rsc/assets/nls/Issue3DReview"],(function(e,t,n,s,i,o){"use strict";var r=!0,a=function(e){var t=s.get("application");localStorage.setItem("Issue3DReviewDisplay",e),!0===e?t.display():t.clear(),s.get("pad3DViewer").getExecutionContext().getComponent(WAfrStandardComponentKey.HandlerComponent).setCheckState({id:"Display",state:e});try{i.cloudProbeUtils.sendI3DRCommandsTrackerEvent({options:{pd1:"Issue",pd2:"3DViewer",pd3:"Issue3DReviewToolbar",pd4:"ShowHideIssues",pd5:"Issue/3DViewer/Issue3DReviewToolbar/ShowHideIssues"}}),i.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"Issue3DReviewToolbar"}})}catch(e){}},l=function(){return!!s.get("component").isProcessing()&&(r&&n.displayNotification({msg:o.notifications.commandAlreadyProcessing,eventID:"info"}),r=!0,!0,u="true"===localStorage.getItem("Issue3DReviewDisplay"),s.get("pad3DViewer").getExecutionContext().getComponent(WAfrStandardComponentKey.HandlerComponent).setCheckState({id:"Display",state:u}),!0)},c=Object.create(null),u=!1;return c.handlerComponent=null,c.checked=function(e,t){u="true"===localStorage.getItem("Issue3DReviewDisplay"),null!=t?.args?.displayNotification&&(r=t.args.displayNotification),l()||(a(!0),e())},c.unchecked=function(e,t){s.get("syncFilter").getContent().hide(),null!=t?.args?.displayNotification&&(r=t.args.displayNotification),l()||(a(!1),e())},e.namespace("Issue3DReviewV2Rsc/commandsWebAfr/Display",c)})),define("DS/Issue3DReviewV2Rsc/commandsWebAfr/Reopen",["DS/IssueCommon/commands/Reopen"],(function(e){"use strict";function t(e){this.ec=e.executionContext}return t.prototype.beginExecute=function(){require(["DS/PADServices/utils/PADTrackerManager"],(e=>{const t=e.getPADTracker({eventCategory:"usage",eventAction:"command-3D"});t.setEventData({eventLabel:"reopen"}),t.trackPageEvent()})),(new e).execute(),this.done()},t.prototype.endExecute=function(){this.destroy(),this.done()},t.prototype.destroy=function(){delete this.ec},t})),define("DS/Issue3DReviewV2Rsc/commandsWebAfr/CreateTask",["DS/IssueCommon/commands/CreateTask"],(function(e){"use strict";function t(e){this.ec=e.executionContext}return t.prototype.beginExecute=function(){require(["DS/PADServices/utils/PADTrackerManager"],(e=>{const t=e.getPADTracker({eventCategory:"usage",eventAction:"command-3D"});t.setEventData({eventLabel:"CreateTask"}),t.trackPageEvent()})),(new e).execute(),this.done()},t.prototype.endExecute=function(){this.destroy(),this.done()},t.prototype.destroy=function(){delete this.ec},t})),define("DS/Issue3DReviewV2Rsc/commandsWebAfr/Delete",["DS/IssueCommon/commands/Delete"],(function(e){"use strict";function t(e){this.ec=e.executionContext}return t.prototype.beginExecute=function(){require(["DS/PADServices/utils/PADTrackerManager"],(e=>{const t=e.getPADTracker({eventCategory:"usage",eventAction:"command-3D"});t.setEventData({eventLabel:"Delete"}),t.trackPageEvent()})),(new e).execute(),this.done()},t.prototype.endExecute=function(){this.destroy(),this.done()},t.prototype.destroy=function(){delete this.ec},t})),define("DS/Issue3DReviewV2Rsc/commandsWebAfr/Refresh",[],(function(){"use strict";function e(e){this.ec=e.executionContext}return e.prototype.beginExecute=function(){require(["DS/PADServices/utils/PADTrackerManager"],(e=>{const t=e.getPADTracker({eventCategory:"usage",eventAction:"command-3D"});t.setEventData({eventLabel:"Refresh"}),t.trackPageEvent()})),require(["DS/PADUtils/views/PADAlert","DS/IssueServices/Contexts","i18n!DS/Issue3DReviewV2Rsc/assets/nls/Issue3DReview"],(function(e,t,n){t.get("component").isProcessing()?e.displayNotification({msg:n.notifications.commandAlreadyProcessing,eventID:"info"}):t.get("application").refresh()})),this.done()},e.prototype.endExecute=function(){this.destroy(),this.done()},e.prototype.destroy=function(){delete this.ec},e})),define("DS/Issue3DReviewV2Rsc/commandsWebAfr/Relations",["DS/IssueCommon/commands/RelationalExplorer"],(function(e){"use strict";function t(e){this.ec=e.executionContext}return t.prototype.beginExecute=function(){require(["DS/PADServices/utils/PADTrackerManager"],(e=>{const t=e.getPADTracker({eventCategory:"usage",eventAction:"command-3D"});t.setEventData({eventLabel:"Relations"}),t.trackPageEvent()})),(new e).execute(),this.done()},t.prototype.endExecute=function(){this.destroy(),this.done()},t.prototype.destroy=function(){delete this.ec},t})),define("DS/Issue3DReviewV2Rsc/commandsWebAfr/Release",[],(function(){function e(e){this.ec=e.executionContext}return e.prototype.beginExecute=function(){return require(["DS/PADServices/utils/PADTrackerManager"],(e=>{const t=e.getPADTracker({eventCategory:"usage",eventAction:"command-3D"});t.setEventData({eventLabel:"Release"}),t.trackPageEvent()})),new Promise((e=>{require(["DS/IssueServices/Contexts"],(function(e){e.get("component").release()}))}))},e.prototype.endExecute=function(){this.destroy(),this.done()},e.prototype.destroy=function(){delete this.ec},e})),define("DS/Issue3DReviewV2Rsc/commandsWebAfr/CreateFromTemplate",["DS/IssueServices/Contexts","DS/IssueCommon/commands/Create"],(function(e,t){"use strict";var n=Object.create(null);return n.handlerComponent=null,n.execute=function(e){new t({ID:"CreateFromTemplate",context:"Default",isAsynchronous:!0,isEnabled:!0,arguments:[{ID:"mode",Value:"IFT"}]}).execute(),e()},n})),define("DS/Issue3DReviewV2Rsc/commandsWebAfr/AttachmentManager",[],(function(){"use strict";function e(e){this.ec=e.executionContext}return e.prototype.beginExecute=function(){return require(["DS/PADServices/utils/PADTrackerManager"],(e=>{const t=e.getPADTracker({eventCategory:"usage",eventAction:"command-3D"});t.setEventData({eventLabel:"AttachmentManager"}),t.trackPageEvent()})),new Promise((e=>{require(["DS/IssueCommon/commands/AttachmentManager"],(function(e){(new e).execute()})),this.done(),e()}))},e.prototype.endExecute=function(){this.destroy(),this.done()},e.prototype.destroy=function(){delete this.ec},e})),define("DS/Issue3DReviewV2Rsc/commandsWebAfr/Close",["DS/IssueCommon/commands/Close"],(function(e){"use strict";function t(e){this.ec=e.executionContext}return t.prototype.beginExecute=function(){require(["DS/PADServices/utils/PADTrackerManager"],(e=>{const t=e.getPADTracker({eventCategory:"usage",eventAction:"command-3D"});t.setEventData({eventLabel:"Close"}),t.trackPageEvent()})),(new e).execute(),this.done()},t.prototype.endExecute=function(){this.destroy(),this.done()},t.prototype.destroy=function(){delete this.ec},t})),define("DS/Issue3DReviewV2Rsc/commandsWebAfr/AddUsingSearchAsResolvedBy",["DS/IssueCommon/commands/AddUsingSearchAsResolvedBy"],(function(e){"use strict";function t(e){this.ec=e.executionContext}return t.prototype.beginExecute=function(){require(["DS/PADServices/utils/PADTrackerManager"],(e=>{const t=e.getPADTracker({eventCategory:"usage",eventAction:"command-3D"});t.setEventData({eventLabel:"AddUsingSearchAsResolvedBy"}),t.trackPageEvent()})),(new e).execute(),this.done()},t.prototype.endExecute=function(){this.destroy(),this.done()},t.prototype.destroy=function(){delete this.ec},t})),define("DS/Issue3DReviewV2Rsc/commandsWebAfr/CreateFromBlank",["UWA/Class","UWA/Class/Listener","DS/ApplicationFrame/Command","DS/IssueCommon/utils/Utils","DS/IssueCommon/commands/Create","DS/IssueServices/Contexts","DS/IssueServices/utils/Parser"],(function(e,t,n,s,i,o,r){"use strict";var a=Object.create(null);return a.handlerComponent=null,a.execute=function(e){new i({ID:"CreateFromBlank",context:"Default",isAsynchronous:!0,isEnabled:!0,arguments:[{ID:"mode",Value:"IFB"}]}).execute(),e()},a})),define("DS/Issue3DReviewV2Rsc/ContextMenu_V2",["DS/ENO3DUtils/ENO3DBaseComponent","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/PADUtils/PADSettingsMgt","DS/WebappsUtils/WebappsUtils","DS/Selection/CSOManager","i18n!DS/Issue3DReviewV2Rsc/assets/nls/Issue3DReviewCommands"],(function(e,t,n,s,i,o){"use strict";function r(t){e.call(this,t),this._identifiers={view:t.viewIdentifier},this._contextConfigPath=t.ctxOptions,this._nlsAMDPath=t.nlsAMDPath,this._contextConfig=[],this._nls=null,this._nlsAMDPromises=[],this._wafrContextContainer=null,this._isContextBarVisible=!1,this._view=null,this._widget=null,this._ambience=window.localStorage.getItem("ENO3DViewViewerAmbience")||"VisuWhiteExperienceOCACmd"}return r.prototype=Object.create(e.prototype),r.prototype.initialize=function(){return this._DEBUG&&console.log("ContextMenu.initialize called"),new Promise(function(e,t){this._identifiers.view&&this._contextConfigPath||t("Invalid parameters sent from .wafrapp file"),!0===this._isComponentInitialized?e():(this._view=this.getComponentFromIdentifier(this._identifiers.view),this._widget=widget,this._loadConfigurationFromFile().then(this._loadContextNLS.bind(this)).then(this._updateCommandState.bind(this)).then(this._setWafrContextBar.bind(this)).then(this._contextReady.bind(this)).then(e).catch(function(e){this._DEBUG&&console.error("ContextMenu.initialize failed to init"+e),this.destroy(),t(new Error(e))}.bind(this)))}.bind(this))},r.prototype.clean=function(){return this._DEBUG&&console.log("ContextMenu.clean called"),new Promise((function(e){e()}))},r.prototype.destroy=function(){return this._DEBUG&&console.log("ContextMenu.destroy called"),new Promise((function(e){e()}))},r.prototype._loadConfigurationFromFile=function(){this._DEBUG&&console.log("ContextMenu._loadConfigurationFromFile called");const e=[];return new Promise(((t,n)=>{for(let t=0;t<this._contextConfigPath.length;++t)e.push(new Promise((e=>{this.loadText(this._contextConfigPath[t]).then((t=>{try{this._contextConfig.push(JSON.parse(t)),e()}catch(e){this._DEBUG&&console.error("ContextMenu._loadConfigurationFromFile failed to load configuration"+e),n(e)}})).catch(n)})));Promise.all(e).then(t).catch(n)}))},r.prototype._loadContextNLS=function(){return new Promise(((e,t)=>{this.loadNls(this._nlsAMDPath).then((t=>{this._nls={...t,...o},e()})).catch(t)}))},r.prototype._updateCommandState=function(){return new Promise((e=>{for(let e=0;e<this._contextConfig.length;++e)for(let t=0;t<this._contextConfig[e].ContextMenu.onEmptiness.length;++t){const n=this._contextConfig[e].ContextMenu.onEmptiness[t];if(n.submenu)for(let e=0;e<n.submenu.length;++e)"ENO3DToggleStatusBarCmd"===n.submenu[e].handlerId?n.submenu[e].state="true"===window.localStorage.getItem("ENO3DViewStatusBarExpandState")?"selected":void 0:n.submenu[e].handlerId===window.localStorage.getItem("ENO3DViewViewerAmbience")&&(n.submenu[e].state="selected",this._executeCommand({handlerId:n.submenu[e].handlerId}))}this._updateCommandsForGeometryQuality(),e()}))},r.prototype._updateCommandsForGeometryQuality=function(){var e=i.get(),n=e.length,s=this._view._getAllLeavesForGeometryQuality(e,2);const o={optimized:void 0,high:void 0};if(this.enableCmd("OptimizedQualityCmd"),this.enableCmd("HighQualityCmd"),0===s.length)return o.optimized="disabled",o.high="disabled",this.disableCmd("OptimizedQualityCmd"),this.disableCmd("HighQualityCmd"),o;if(this._view._isGeometryQualityAvailable("optimized"))if(0===n)o.optimized=!0;else if(1===n){if(1===s.length)if(a=this._view.getController().getNode({id:s[0]})){var r=t.getLoadedStream(a,this._view);o.optimized="thumbnail"===r?"selected":void 0}else o.optimized=void 0,this.disableCmd("OptimizedQualityCmd");else o.optimized=void 0}else o.optimized=void 0;else o.optimized=void 0,this.disableCmd("OptimizedQualityCmd");if(this._view._isGeometryQualityAvailable("high"))if(0===n)o.high=!0;else if(1===n){var a;if(1===s.length)if(a=this._view.getController().getNode({id:s[0]})){r=t.getLoadedStream(a,this._view);o.high="cgr"===r?"selected":void 0}else this.disableCmd("HighQualityCmd"),o.high=void 0;else o.high=void 0}else o.high=void 0;else o.high=void 0,this.disableCmd("HighQualityCmd");return o},r.prototype._contextReady=function(){return this._DEBUG&&console.log("ContextMenu._contextReady called"),new Promise((e=>{this.getExecutionContext().setContext("ContextReady",!0),this._isComponentInitialized=!0,e()}))},r.prototype._prepareContextMenu=function(e,t,n){this._DEBUG&&console.log("ContextMenu._prepareContextMenu called");const o=this._updateCommandState();var r=[],a=[];if(!0===(0===t.length))a=e.ContextMenu.onEmptiness;else{if(!(i.get().length>0&&this._view._areValidPaths(i.get())))return[];a=e.ContextMenu.onGeometry}for(var l=0;l<a.length;++l){var c=a[l];let e=[];if(c.submenu){let t="ambience"===c.identifier;for(let n=0;n<c.submenu.length;++n)if("SeparatorItem"===c.submenu[n].type)e.push({type:c.submenu[n].type});else{let i=c.submenu[n].state;"quality"===c.identifier&&(i=this._view.getController().isAdaptativeLoadingGranted()?"OptimizedQualityCmd"===c.submenu[n].handlerId?o.optimized:o.high:"disabled"),e.push({title:this._nls[c.submenu[n].handlerId],type:c.submenu[n].type,handlerId:c.submenu[n].handlerId,icon:c.submenu[n].iconPath?s.getWebappsAssetUrl(c.submenu[n].module,c.submenu[n].iconPath):void 0,state:c.submenu[n].state,action:{this:this,callback:function(e,t,n){if("CheckItem"===e[t].type&&(e[t].state="selected"===e[t].state?void 0:"selected"),!0===n){for(let t=0;t<e.length;++t)e[t].state=void 0;e[t].state="selected",window.localStorage.setItem("ENO3DViewViewerAmbience",e[t].handlerId)}this._executeCommand({handlerId:e[t].handlerId})}.bind(this,c.submenu,n,t)}})}}const t={title:e.length>0?this._nls[c.identifier]:null,type:c.type,handlerId:e.length>0?null:c.handlerId,state:e.length>0?null:c.state,action:e.length>0?null:{this:this,callback:function(e){e&&this._executeCommand({handlerId:e})}.bind(this,c.handlerId)}};e.length>0&&(t.submenu=e),r.push(t)}return r},r.prototype._prepareContextBar=function(e,n,s){if(!0===(0===n.length))return[];if(1==i.get().length&&this._view._areValidPaths(i.get())){const n=this._view.getController().getRoots(),s=i.get();let r=!1;for(let e=0;e<s.length;++e){const i=this._view.streamPath(s[e].pathElement);for(let e=0;e<n.length;++e){var o=t.getNodeID(n[e]);if(1===i.length&&o===i[0]){r=!0;break}}if(!0===r)break}return e.ContextBar}return[]},r.prototype._setWafrContextBar=function(){return this._DEBUG&&console.log("ContextMenu._setWafrContextBar called"),new Promise(((e,t)=>{var n=this.getWafrUIComponent();this._wafrContextContainer=n.getContextualUIComponentManager();for(let e=0;e<this._contextConfig.length;++e){const t={subscriberId:`ENO3DContextualBar-${e}`,merge:!0,onContextualMenuReady:function(e,t){return this._prepareContextMenu(e,this.getPickedPath(t),t)}.bind(this,this._contextConfig[e]),onContextualBarReady:function(e,t,n){return this._prepareContextBar(e,this.getPickedPath(n),n)}.bind(this,this._contextConfig[e])};this._wafrContextContainer.register(t)}e()}))},r.prototype.getPickedPath=function(e){return this._view.get3DViewer().pick({xPix:e.XmousePositionWithDevPxRatio,yPix:e.YmousePositionWithDevPxRatio},"mesh",!0).path},r.prototype.setContextBarVisibility=function(e){this._DEBUG&&console.log("ContextMenu.setContextBarVisibility called");var t=this._wafrContextContainer.getContextualBar();!0===e?(this._isContextBarVisible=!0,t.show()):(this._isContextBarVisible=!1,t.hide())},r.prototype.canBeParallelized=function(){return!1},r})),define("DS/Issue3DReviewV2Rsc/utils/BaseComponentUtilsWebAfr",["DS/WAfrUIStandardComponents/UIFrame"],(function(e){"use strict";function t(e){this._DEBUG="true"===e.DEBUG,this._eventTokens=[],this._isComponentInitialized=!1}return t.prototype.destroyParent=function(){return new Promise((e=>{for(let e=0;e<this._eventTokens.length;++e)this._unsubscribe(this._eventTokens[e]);delete this._DEBUG,delete this._eventTokens,delete this._isComponentInitialized,e()}))},t.prototype.getComponentFromIdentifier=function(e){try{return this.getExecutionContext().getComponent(e)}catch(e){return null}},t.prototype.getModelEvent=function(){return this.getComponentFromIdentifier(WAfrStandardComponentKey.ModelEvents)},t.prototype.getWafrUIFrame=function(){return this.getComponentFromIdentifier(e.DEFAULT_COMPONENT_NAME)},t.prototype.getWafrUIComponent=function(){return this.getComponentFromIdentifier(WAfrStandardComponentKey.UIComponent)},t.prototype.getCommandHandler=function(){return this.getComponentFromIdentifier(WAfrStandardComponentKey.HandlerComponent)},t.prototype.subscribe=function(e,t,n=!1){const s=this.getModelEvent().subscribe(e,t);return!0===n&&this._eventTokens.push(s),s},t.prototype.unsubscribe=function(e){const t=this.getModelEvent();t&&t.unsubscribe(e),this._eventTokens.filter(((t,n,s)=>t===e&&(s.splice(n,1),!0)))},t.prototype.publish=function(e){this.getModelEvent().publish(e)},t.prototype.loadText=function(e){return new Promise(((t,n)=>{this.loadSource(`text!${e}`).then(t).catch(n)}))},t.prototype.loadJSON=function(e){return new Promise(((t,n)=>{this.loadSource(`text!${e}`).then((e=>t(JSON.parse(e)))).catch(n)}))},t.prototype.loadNls=function(e){return new Promise(((t,n)=>{this.loadSource(`i18n!${e}`).then(t).catch(n)}))},t.prototype.loadSource=function(e){return new Promise(((t,n)=>{require([e],t,n)}))},t.prototype.enableCmd=function(e){return this.getCommandHandler().enableHandler(e)},t.prototype.disableCmd=function(e){return this.getCommandHandler().disableHandler(e)},t.prototype.enableCheck=function(e){return this.getCommandHandler().enableCheck(e)},t.prototype.disableCheck=function(e){return this.getCommandHandler().disableCheck(e)},t.prototype._executeCommand=function(e){return this.getCommandHandler().executeHandler({id:e.handlerId,args:e.args}).then((t=>{t.getReturnValue&&"SUCCEEDED"!==t.getReturnValue().internalValue&&console.warn(a.getDescription(),a.getError(),a.getReturnValue(),e)})).catch((t=>{console.error(t,e)}))},t})),define("DS/Issue3DReviewV2Rsc/Component_V2",["DS/WAfrUIStandardComponents/mod_WidgetProxyComponent","DS/Issue3DReviewV2Rsc/utils/BaseComponentUtilsWebAfr","DS/Issue3DReviewV2Rsc/utils/WidgetEventManagerWebAfr","DS/ENOXInterWdgCom/LinkManager","DS/PADUtils/PADSettingsMgt","DS/IssueServices/Contexts","DS/PADServices/utils/GlobalModelEvents"],(function(e,t,n,s,i,o,r){"use strict";return class{constructor(e){let t,n=[];this.initialize=function(){return t=this.getExecutionContext(),this.enableSwitchApp(),new Promise((t=>{e&&e.appOptionsFilePath?require(["text!"+e.appOptionsFilePath],(function(e){let n=JSON.parse(e);i.setApp(n,"eno3dviewerinfra",!1).then((function(){i.setSetting("activateWidgetLink",!0),s.initializeWidgetLink(widget,i.getSetting("widgetLink_options"));var e="ctx::"+widget.data.xPref_CREDENTIAL;e&&widget.setValue("pad_security_ctx",e),t()}))})):t()}))},this.enableSwitchApp=function(){n.push(r.subscribe({event:"ExternalSwitchRequested"},(function(e){t.switchApp(e.id+"WebApp").then((()=>{r.publish({event:"SwitchSuccessful"})}))})))},this.clean=function(){return new Promise((e=>{t=void 0,e()}))},this.destroy=function(){return new Promise((e=>{n.forEach(r.unsubscribe,r),e()}))},this.getSessionWidget=function(){return window.widget},this.canBeParallelized=function(){return!1}}}})),define("DS/Issue3DReviewV2Rsc/Issue3DReview_V2",["i18n!DS/Issue3DReviewV2Rsc/assets/nls/Issue3DReview","i18n!DS/ENOPAD3DViewer/assets/nls/PAD3DViewer.json","i18n!DS/Issue3DReviewV2Rsc/assets/nls/Issue3DReview.json","DS/WAfrAppManager/App","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/PADTrackerManager","DS/PADServices/utils/SGIUtils","DS/UIKIT/Modal","DS/UIKIT/Tooltip","DS/UIKIT/Mask","DS/Controls/Button","DS/IssueCommon/utils/Selector","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Support","DS/IssueCommon/utils/Utils","DS/IssueComponents/helper/Helper","DS/IssueServices/utils/Performance","DS/Issue3DReviewV2Rsc/commandsWebAfr/CommandsManager","DS/IssueCommon/commands/CommandsManager","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/ENOXInterWdgCom/LinkManager","text!DS/Issue3DReviewV2Rsc/assets/Issue3DReview.3D.json","text!DS/Issue3DReviewV2Rsc/assets/Issue3DReview.PADSettings.json","text!DS/Issue3DReviewV2Rsc/assets/Issue3DReviewOptions.json"],(function(e,t,n,s,i,o,r,a,l,c,u,d,p,g,m,h,f,v,D,I,b,w,y,S,C,_,E,R){"use strict";var A=function(){return UWA.createElement("div",{class:"issue-3d-placeholder fade-in-element",html:['<div class="pin"><span class="fonticon fonticon-5x fonticon-location"></span></div>','<div class="pulse"></div>']})},x=function(e){return UWA.createElement("div",{class:"loading-error-container",html:UWA.createElement("div",{class:"loading-error",html:[UWA.createElement("div",{class:"loading-error-label",html:e.label}),UWA.createElement("div",{class:"loading-error-sub-label",html:e.sub})]})})},P="Issue",k="PLMNewEnablement",V="IssueTemplatesEnabled",T=1e3,O=1e3,N="X3DContentId";return class extends s{component=null;filter=null;statusHelper=null;elements={header:null};isLoaded=null;_deferred={resolve:null,reject:null};_pad3DViewerTokens=[];_widgetEventTokens=[];_placeholder=null;displayLevelSelector=!0;constructor(e){super(e),this._blockUX=null,this._deferred={resolve:null,reject:null},this.isLoaded=null;var t=this;t.settings=JSON.parse(E),setTimeout((function(){let e=f.initPlatformServices();Promise.all([e]).then((function(){var e=f.getSecurityContexts(),n=f.getTenants();t._setPreferences({securityContexts:e,tenants:n})}))}),1e3),console.log("i3d webafr constructor")}setUp(e){var t=this;m.add("widget",window.widget),m.get("widget").name="ENX3DIR_AP",m.add("application",t),t.component=null,t.filter=null,e&&UWA.is(e.sourceApp,"object")?(t.pad3DViewer=e.sourceApp.pad3DViewer,"ENX3DIR_AP"!=e.sourceApp.options.afrAppId?t.categories=e.sourceApp?.options?.appConfig?.UIModel?.categories:t.categories=[]):t.categories=[],t.isLoaded=new Promise((function(e,n){t._deferred.resolve=e,t._deferred.reject=n})),t._placeholder=A(),t._subscribers(),t.displayLevelSelector=!0,this.widget=widget,i.setSetting("activateWidgetLink",!0),require("DS/ENOXInterWdgCom/LinkManager").updateLinkability({appIds:[],open:!0,uses:["ENXContent","ENXContentSync2D","ENXContentSync3D","ENXLandingPageSync","ENXAuthoring2D","ENXAuthoring3D"],implements:["ENXContent","ENXContentSync3D","ENXLandingPageSync"]});var n="ctx::"+widget.data.xPref_CREDENTIAL;return n&&widget.setValue("pad_security_ctx",n),this.initialize3DReviewApp(e),new Promise(((t,n)=>{e.done()}))}initialize3DReviewApp(e){var t=this;this.view=this._executionContext.getComponent("Viewer"),m.get("widget").setMetas({helpPath:"Issue3DReviewV2Rsc/assets/help"}),t._placeholder.inject(m.get("widget").body),m.get("widget").body.addEventListener("drop",(function(e){e.preventDefault(),e.stopPropagation()}));let n=!1,s=new Promise(((e,s)=>{if(t.pad3DViewer)n=!0,e();else{var i=!1;n=!1,t._pad3DViewerTokens.push(t.view.subscribe({event:"onReady"},(function(n){!0!==i&&(i=!0,t.view._context="Default",w.setContext(t.view._context),y.setContext(t.view._context),t._placeholder.destroy(),n.getLevelSelectorCommand&&n.getLevelSelectorCommand((function(e){e&&e.displayLabels(!0)})),t.pad3DViewer=n,e(n))})))}})),i=f.initPlatformServices();Promise.all([s,i]).then((function(){try{v.checkSwymSupport()}catch(e){}console.log("init app i3dwebafr");var e=f.getSecurityContexts(),n=f.getTenants();return t._setPreferences({securityContexts:e,tenants:n})})).then((function(){var e=f.getCurrentCredentials();return m.get("widget").setValue("xPref_CREDENTIAL",e.role+"."+e.organization+"."+e.collaborativeSpace),h.preferences.getServerSettings({}).then((e=>{e.body&&(m.add(k,e.body.IssueCreationByPLMNew),m.add(V,e.body.IssueNewTemplate))})).catch((e=>{})),t.isWidgetRefresh=!1,n?t._reusePAD3DViewer(t.pad3DViewer):t._initializePAD3DViewer()})).then((function(){return new Promise((function(e){var t=[P];h.type.getSubType().then((n=>{e(null!=n?Object.keys(n):t)})).catch((()=>{e(t)}))}))})).then((function(e){t._setLoadingDelegations(e)})).then((function(){t._computeFilter()})).then((function(){return t._initializeComponent({})})).then((function(){e.done(),t._deferred.resolve()}),(function(e){t._deferred.reject(e);var n=t.utils.getNLSMsg(e);m.get("widget").body.appendChild(x(n)),"Oops! Something went wrong."===n.label&&t.utils.error(e)}))}_subscribers(){var e=this,t=m.get("widget")||window.widget;e._widgetEventTokens=[{eventName:"onRefresh",listener:e.onRefresh.bind(e)},{eventName:"onResize",listener:e.onResize.bind(e)},{eventName:"onDestroy",listener:e.onDestroy.bind(e)},{eventName:"endEdit",listener:function(){e.onEdit(),e._setENOPADSecurityContext()}}],e._widgetEventTokens.forEach((function(e){t.addEvent(e.eventName,e.listener)})),t.body.addEventListener("contextmenu",(function(e){e.preventDefault()}),e)}onRefresh(){var e=this;if(e.isWidgetRefresh=!0,void 0!==widget.getValue("xPref_CREDENTIAL")){var t=f.getCurrentCredentials();widget.setValue("xPref_CREDENTIAL",t.role+"."+t.organization+"."+t.collaborativeSpace)}e.component.clear().then((function(){var t=!1;"HIGH"===m.get("widget").getValue("enopad3dviewer_CGRorTHB")&&(t=!0),e.pad3DViewer.setDefaultStreamToLoad(t),e.pad3DViewer.refresh(),e.filter.refresh()}))}onResize(e){this.component&&this.component.resize()}onDestroy(){this.destroy()}onEdit(){i.updateWidgetPreferences.bind(i),console.log("edit")}destroy(e){var t=this;null!==t.filter&&t.filter.destroy(),t.filter=null,m.remove("filter"),t.helper.destroy(),null!==t.statusHelper&&t.statusHelper.destroy(),t.statusHelper=null,t.hud.destroy(),null!==t.elements.header&&t.elements.header.destroy(),t.elements.header=null,null!==t.component&&t.component.destroy(),t.component=null,m.remove("component"),UWA.is(e,"object")&&!0===e.keepPAD3DViewer?(t._pad3DViewerTokens.forEach((function(e){t.pad3DViewer.unsubscribe(e)})),t.pad3DViewer.addRootNodesFromContent=t.defaultAddRootNodesFromContent):(null!==t.pad3DViewer&&t.pad3DViewer.destroy(),t.pad3DViewer=null),1!=m.get("R2VMode")&&(m.remove("pad3DViewer"),m.remove("application"),m.remove("widget"))}_initializePAD3DViewer(){var t=this,n=m.get("widget")||window.widget;return new Promise((function(e){var s=JSON.parse(_);s.context="Default",s.mouseProfile=require("DS/PADUtils/PADUtilsServices").isCloud()?window.__mouseProfile:"COMBINED",s.mouseProfile&&t.view.getViewpoint().setDefaultController(!0,s.mouseProfile),m.add("pad3DViewer",t.view);n.getValue("enopad3dviewer_CGRorTHB");var o=n.getValue("enopad3dviewer_displayCandidateQueue"),r=n.getValue("enopad3dviewer_displayCandidateQueue_color");o&&i.setSetting("enopad3dviewer_displayCandidateQueue",o),r&&i.setSetting("enopad3dviewer_displayCandidateQueue_color",r);var a=n.getValue("enopad3dviewer_selectionFilter");a&&i.setSetting("enopad3dviewer_selectionFilter",a),i.setSetting("enopad3dviewer_staticMappingSupportActivated",!1),e()})).then((()=>{var s=n.getValue("Issue3DReviewViewerPathsInSession");s=s?JSON.parse(s):[];var i=n.getValue("Issue3DReviewViewerR2VPathsInSession");i=i?JSON.parse(i):[];var o=n.getValue("Issue3DReviewViewerRootsDetached");o=o?JSON.parse(o):[];var r=[],a=n.getValue("Issue3DReviewViewerFilterPathsInSession");return r.push({objectId:a}),new Promise((function(e){if(s&&s.length>0||i&&i.length>0){setTimeout((function(){""!=a&&null!=a?t.pad3DViewer.getController().addFilter(r):i.length?(t.pad3DViewer.openStoredObjects({pointClouds:i}),e(t.pad3DViewer)):s.length&&t.pad3DViewer.getController().addRoots({paths:s,pids_hidden:o},!1,!1)}),0);var n=t.pad3DViewer.subscribe({event:"onEndProgressiveLoad"},(function(){t.pad3DViewer.unsubscribe(n),e(t.pad3DViewer)})),l=[];l.push("ENO3DCleanViewCmd"),w._switchCommands(l,!0)}else{e(t.pad3DViewer);var c=[];c.push("ENO3DCleanViewCmd"),w._switchCommands(c,!1)}})).then((s=>{var i=function(e){n.setValue("Issue3DReviewViewerPathsInSession",JSON.stringify(e.rootLog)),t._updateSharedSettings()},o=function(e){n.setValue("Issue3DReviewViewerFilterPathsInSession",e.filter.objects[0].filterId)};t._pad3DViewerTokens.push(s.subscribe({event:"onLoadingComplete"},(function(){if(null!==t.component&&t.component.isDisplayed()&&!t.component.isInspected())var e=s.subscribe({event:"onEndProgressiveLoad"},(function(){s.unsubscribe(e),t.display()}))}))),"ENX3DIR_AP"===m.get("widget").name&&(this._switchInProgress=!1,this._pad3DViewerTokens.push(m.get("pad3DViewer").subscribe({event:"onRealAssetLoaded"},(e=>{if(this._switchInProgress)this._switchInProgress=!1,e.callback();else{m.add("R2VMode",!0);var t=m.get("pad3DViewer").getExecutionContext().switchApp("ENX3DIR_AP","ENX3DIR_AP_RealAssets");this._switchInProgress=!0,t?t.then((()=>{this._switchInProgress=!1,e.callback()})).catch((t=>{console.error(t),this._switchInProgress=!1,e.callback()})):(this._switchInProgress=!1,e.callback())}}))),this._pad3DViewerTokens.push(m.get("pad3DViewer").subscribe({event:"onEndRootRemoved"},(e=>{if(!e.fromTimeline&&!e.fromRefresh&&!e.fromWidgetLink){const e=this.view.getRoots();let t=!1;for(let n=0;n<e.length;++n)if(S.isTileSetNode(e[n])){t=!0;break}t||1==m.get("R2VMode")&&(n.setValue("Issue3DReviewVieweR2VPathsInSession",JSON.stringify([])),m.get("pad3DViewer").getExecutionContext().switchApp("ENX3DIR_AP").catch((e=>{console.error(e)})))}})))),t._pad3DViewerTokens.push(s.subscribe({event:"onRootAdded"},(function(e){if(t.isWidgetRefresh=!1,null!==t.component){if(t.component.isInspected()||i(e),t.view.getController().getRoots().length>0){var n=[];n.push("ENO3DCleanViewCmd"),w._switchCommands(n,!0)}}else i(e)}))),t._pad3DViewerTokens.push(s.subscribe({event:"onFilterApplied"},(function(e){if(t.isWidgetRefresh=!1,null!==t.component){if(t.component.isInspected()||o(e),t.view.getController().getRoots().length>0){var n=[];n.push("ENO3DCleanViewCmd"),w._switchCommands(n,!0)}}else o(e)}))),t._pad3DViewerTokens.push(s.subscribe({event:"onRootRemoved"},(function(e){if(null!==t.component){if(!t.component.isInspected())if(i(e),!t.component.isProcessing())0===t.view.getController().getRoots().length?t.clear():t.display();if(m.get("syncFilter").getContent().hide(),t.isWidgetRefresh||n.setValue("Issue3DReviewViewerFilterPathsInSession",""),0==t.view.getController().getRoots().length){var s=[];s.push("ENO3DCleanViewCmd"),w._switchCommands(s,!1)}}else i(e)}))),t._pad3DViewerTokens.push(s.subscribe({event:"onRootAttached"},(function(e){var t=n.getValue("Issue3DReviewViewerRootsDetached");(t=t?JSON.parse(t):[]).some((function(s,i){return s===e.id&&(t.splice(i,1),n.setValue("Issue3DReviewViewerRootsDetached",JSON.stringify(t)),!0)}))}))),t._pad3DViewerTokens.push(s.subscribe({event:"onRootDetached"},(function(e){var t=n.getValue("Issue3DReviewViewerRootsDetached");null===(t=t?JSON.parse(t):null)&&(t=[]),t.some((function(t){return t===e.id}))||(t.push(e.id),n.setValue("Issue3DReviewViewerRootsDetached",JSON.stringify(t)))}))),t._pad3DViewerTokens.push(s.subscribe({event:"onBIColorize"},(function(t){"true"===localStorage.getItem("Issue3DReviewFocus")&&require(["DS/PADUtils/views/PADAlert"],(function(t){t.displayNotification({msg:e.notifications.noFocusedViewWhenColorized,eventID:"info"})}))})))}))}))}_setPreferences(t){var n=this,s=m.get("widget")||window.widget;if(!0===f.isCloudEnvironment()&&UWA.is(t.tenants,"object")&&s.addPreference({name:"x3dPlatformId",type:"list",label:e.preferences.tenant,options:t.tenants.platforms,defaultValue:t.tenants.tenant}),UWA.is(t.securityContexts,"object")){var i=s.getValue("pad_security_ctx"),o=t.securityContexts.cspaces.findIndex((e=>e.value==i))>=0?i:"";let r="";""!==o?(s.setValue("pad_security_ctx",o),r=o):(s.setValue("pad_security_ctx",t.securityContexts.securityContext),r=t.securityContexts.securityContext),s.addPreference({name:"pad_security_ctx",type:"list",label:e.preferences.securityContext,options:t.securityContexts.cspaces,defaultValue:r}),n._setENOPADSecurityContext()}return s.addPreference({name:"myTitle",type:"text",label:e.preferences.name.title,onchange:"onTitleChange",defaultValue:e.WidgetTitle}),n.settings.hideNoFilterSelectionPreference||s.addPreference({name:"defaultFilterForAll",type:"list",label:e.preferences.defaultFilterForAll.title,options:[{label:e.preferences.defaultFilterForAll.organizationAndProject,value:"organization-project",isDefault:!0},{label:e.preferences.defaultFilterForAll.organization,value:"organization"},{label:e.preferences.defaultFilterForAll.project,value:"project"},{label:e.preferences.defaultFilterForAll.policy,value:"policy"}],defaultValue:"organization-project"}),s.addPreference({name:"organizationFilter",type:"boolean",label:e.preferences.organizationFilter,defaultValue:"false"}),s.addPreference({name:"activateBIFilter",type:"boolean",label:e.preferences.tagger,defaultValue:"true"}),s.addPreference({name:"enopad3dviewer_selectionFilter",value:"PRODUCT",defaultValue:"PRODUCT",type:"list",label:"enopad3dviewer_selectionFilter_label",options:[{label:"enopad3dviewer_selectionFilter_Ref",value:"PRODUCT"},{label:"enopad3dviewer_selectionFilter_Rep",value:"SHAPE"}],dispatch:!0}),s.addPreference({name:"filter",type:"hidden",defaultValue:JSON.stringify({owned:!0,assigned:!0,reported:!1,responsible:!1,contributed:!1,closed:!1,synchronize:!1})}),s.addPreference({name:"Issue3DReviewViewerPathsInSession",type:"hidden"}),s.addPreference({name:"Issue3DReviewViewerRootsDetached",type:"hidden"}),s.addPreference({name:"Issue3DReviewViewerFilterPathsInSession",type:"hidden"}),require(["DS/PADUtils/PADSharedSettings"],(function(e){try{e.destroy()}catch(e){}e.addSharedSettings(s,["enopad3dviewer_displayCandidateQueue","enopad3dviewer_displayCandidateQueue_color","enopad3dviewer_CGRorTHB"]),e.addSharedSettings(s,["synthesisModeOnInstance"]),e.addSharedSettings(s,["pgpFromServer"]),""==e.sharedSettings.x3dPlatformId.value&&(e.sharedSettings.x3dPlatformId.value=f.getTenant()),f.isCloudEnvironment()&&(e.addAsyncSharedSettings(s,["activateSGI"]),n._setActivateSGI())})),s.getPreferences()}_setENOPADSecurityContext(){var e=m.get("widget")||window.widget;try{if(e.getPreference("pad_security_ctx")){var t=e.getPreference("pad_security_ctx").value,n=e.getPreference("synthesisModeOnInstance").value,s=e.getPreference("pgpFromServer").value;require(["DS/PADUtils/PADSettingsMgt"],(function(e){e.setSetting("pad_security_ctx",t),e.setSetting("synthesisModeOnInstance",n),e.setSetting("pgpFromServer",s)})),sessionStorage.setItem("PADSecurityCtx",t),e.setValue("pad_security_ctx",t)}}catch(e){}}_setActivateSGI(){var e=m.get("widget")||window.widget;try{require(["DS/PADUtils/PADSettingsMgt"],(function(t){l.isSGIAvailable().then((function(n){if(!0===n){var s=!!e.getPreference("activateSGI")&&e.getPreference("activateSGI").value;t.setSetting("activateSGI",s)}}))}))}catch(e){}}onTitleChange(){var t=this,n=m.get("widget"),s=t.getTitle();if(!1===t.component.isDisplayed())s=e.preferences.name.default+" - "+e.titles.issuesNotDisplayed;else{var i=Object.keys(t.component.getIssues().map);s=0===i.length?e.preferences.name.default+" - "+e.titles.noIssuesToShow:e.preferences.name.default+" ("+i.length+")"}n.getTitle()!==s&&n.setTitle(s)}getTitle(){var t=m.get("widget")||window.widget,n=t.getValue("myTitle"),s=t.getPreference("myTitle");return t&&s?n=(n=n&&n.trim())||s.defaultValue:e.WidgetTitle}_computeFilter(){try{var e=m.get("widget")||window.widget,t=e.getValue(N)?JSON.parse(e.getValue(N)):null;e.deleteValue(N),null!==t&&this.view.addRootNodesFromContent({json3DXContent:t,dispatch:!1}),f.getCompassPubSub().publish("resetX3DContent")}catch(e){}}refresh(t,n){var s=this,i=m.get("widget")||window.widget,o=JSON.parse(i.getValue("filter"));i.setTitle(s.getTitle()+" - "+e.notifications.refreshIssues),s.hud.on(e.notifications.refreshIssues,"50");var r=s.view.getController().getRoots();return s.component.refresh(r,t,n).then((function(){s.hud.update(s.hud.getHUDLabel(),"100"),s.onTitleChange(),s.hud.off(),1==o.synchronize&&require(["DS/PADUtils/views/PADAlert"],(function(t){t.displayNotification({msg:e.syncFilterMsg,eventID:"success"})}))}))}_initializeComponent(){var t=this,n=null,s=null,i=null,o=null;return new Promise((function(e){require(["DS/PADUtils/views/PADAlert","DS/PADUtils/views/PADStatusInfos","DS/Issue3DReviewV2Rsc/commandsWebAfr/CommandsManager","DS/Issue3DReviewV2Rsc/Component","DS/Issue3DReviewV2Rsc/components/header/Filter","DS/IssueCommon/commands/CommandsManager"],(function(t,r,a,l,c,u){n=r,s=a,u,i=l,o=c,e()}))})).then((function(){return t.elements.header=UWA.createElement("div",{class:"im-3d-header"}),t.elements.header.inject(t._executionContext.getComponent("Viewer").elements.container),t.filter=(new o).render(),t.syncFilter=new p({displayStyle:"lite",icon:{iconName:"refresh",fontIconFamily:WUXManagedFontIcons.Font3DS},tooltipInfos:{title:e.syncTitle,shortHelp:e.syncShortMsg}}),t.syncFilter.getContent().addClassName("syncFilter"),t.syncFilter.getContent().hide(),m.add("filter",t.filter),m.add("syncFilter",t.syncFilter),t.hud.init().then((function(e){t.filter.inject(t.elements.header),t.syncFilter.inject(t.elements.header),e.container.inject(t.elements.header)}))})).then((function(){if(t.component=new i({events:{onIssuesAdded:function(){t.onTitleChange()},onIssuesRemoved:function(){t.onTitleChange()}}}),m.add("component",t.component),s.select(null),t.view.getController().getRoots().length>0){var o=[];o.push("ENO3DCleanViewCmd"),s._switchCommands(o,!0)}t.helper.init(),t.helper.container.inject(t.view.getContent()),t.statusHelper=new n({renderTo:t.view.getContent(),events:{onShow:function(){b.start(t.name+" render status");var n=t.component.getIssues().map,s=t.component.getSelectedIssues(),i=UWA.createElement("div",{class:"im-status-msg"});UWA.createElement("div",{class:"im-status-msg-issues",text:e.replace(e.titles.issues,{number:Object.keys(n).length})}).inject(i),UWA.createElement("div",{class:"im-status-msg-selection",text:e.replace(e.tooltips.selectedIssues,{number:Object.keys(s).length})}).inject(i),t.statusHelper.setStatus(i),b.end(t.name+" render status")}}});let r=m.get("widget").body.getElementsByClassName("pad_status_footer"),a=r.length>0?r[0]:null;if(null!==a){let e=a.getSize().height-2+"px";t.helper.container.setAttribute("style","bottom:"+e+";position:fixed !important ; z-index: 51"),t.statusHelper.elements.container.setAttribute("style","bottom:"+e+"!important;position:fixed !important")}else t.helper.container.setStyle("bottom","25px"),t.statusHelper.elements.container.setStyle("bottom","25px");t.defaultAddRootNodesFromContent=t.view.addRootNodesFromContent;var l=function(n){if(m.get("syncFilter")&&m.get("syncFilter").getContent()&&m.get("syncFilter").getContent().hide(),t.component.isInspected())null.displayNotification({msg:e.notifications.dropPreventedForInspection,eventID:"info"});else{t.view.addRootNodesFromContent=t.defaultAddRootNodesFromContent,t.view.addRootNodesFromContent(n),t.view.addRootNodesFromContent=l;var s=n.dndEvent.dataTransfer.getData("text/plain");s=(s=(s=JSON.parse(s)).data.items).filter((e=>"r2vsurvey"===e.serviceId));var i=JSON.stringify(s);c.setValue("Issue3DReviewViewerR2VPathsInSession",i)}};t.view.addRootNodesFromContent=l;var c=m.get("widget")||window.widget;return new Promise((function(n){try{var s=JSON.parse(c.getValue("filter"));if(!0===s.synchronize){var i=!1;t.component.taskManager.addGetFilteredIssuesTask((function(e){var s=UWA.is(e,"object")&&UWA.is(e.filter,"object")&&Array.isArray(e.filter.issues)?UWA.clone(e.filter.issues):null;t.component.setFilteredIssues(s),i=!0,n()})),setTimeout((function(){!1===i&&(null.displayNotification({msg:e.filter.synchronize.timeout,eventID:"info"}),s.synchronize=!1,c.setValue("filter",JSON.stringify(s)),t.filter.refresh(),n())}),T)}else n()}catch(e){n()}}))})).then((function(){s.checkStatus(),t.display()}))}_reusePAD3DViewer(e){var t=this,n=m.get("widget"),s=e.getRoots(),i=[],o=[];return s&&UWA.is(s,"array")?require(["DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices"],(function(e){s.forEach((function(t){i.push(e.getNodeID(t))})),i.length>0&&o.push(i),1==m.get("R2VMode")?n.setValue("Issue3DReviewViewerPathsInSession",JSON.stringify([])):n.setValue("Issue3DReviewViewerPathsInSession",JSON.stringify(o))})):(n.setValue("Issue3DReviewViewerPathsInSession",JSON.stringify(o)),n.setValue("Issue3DReviewViewerR2VPathsInSession",JSON.stringify([]))),new Promise((function(s){require(["DS/Issue3DReviewV2Rsc/commandsWebAfr/CommandsManager","DS/IssueCommon/commands/CommandsManager"],(function(i,o){i.clean(t.pad3DViewer._context),i.setContext(t.pad3DViewer._context),o.clean(t.pad3DViewer._context),o.setContext(t.pad3DViewer._context),t.pad3DViewer=e,m.add("pad3DViewer",e),t._placeholder.destroy();var r=function(e){n.setValue("Issue3DReviewViewerPathsInSession",JSON.stringify(e.rootLog)),t._updateSharedSettings()},a=function(e){n.setValue("Issue3DReviewViewerFilterPathsInSession",JSON.stringify(e.filter.objects[0].path))};t._pad3DViewerTokens.push(e.subscribe({event:"onLoadingComplete"},(function(){if(null!==t.component&&t.component.isDisplayed()&&!t.component.isInspected())var n=e.subscribe({event:"onEndProgressiveLoad"},(function(){e.unsubscribe(n),t.display()}))}))),t._pad3DViewerTokens.push(e.subscribe({event:"onRootAdded"},(function(e){if(t.isWidgetRefresh=!1,null!==t.component){if(t.component.isInspected()||r(e),t.pad3DViewer.getController().getRoots().length>0){var n=[];n.push("ENO3DCleanViewCmd"),i._switchCommands(n,!0)}}else r(e)}))),t._pad3DViewerTokens.push(e.subscribe({event:"onFilterApplied"},(function(e){if(t.isWidgetRefresh=!1,null!==t.component){if(t.component.isInspected()||a(e),t.pad3DViewer.getController().getRoots().length>0){var n=[];n.push("ENO3DCleanViewCmd"),i._switchCommands(n,!0)}}else a(e)}))),t._pad3DViewerTokens.push(e.subscribe({event:"onRootRemoved"},(function(e){if(null!==t.component){if(!t.component.isInspected())if(r(e),!t.component.isProcessing())0===t.pad3DViewer.getController().getRoots().length?t.clear():t.display();if(m.get("syncFilter").getContent().hide(),t.isWidgetRefresh||n.setValue("Issue3DReviewViewerFilterPathsInSession",""),0==t.pad3DViewer.getController().getRoots().length){var s=[];s.push("ENO3DCleanViewCmd"),i._switchCommands(s,!1)}}else r(e)}))),t._pad3DViewerTokens.push(e.subscribe({event:"onRootAttached"},(function(e){var t=n.getValue("Issue3DReviewViewerRootsDetached");(t=t?JSON.parse(t):[]).some((function(s,i){return s===e.id&&(t.splice(i,1),n.setValue("Issue3DReviewViewerRootsDetached",JSON.stringify(t)),!0)}))}))),t._pad3DViewerTokens.push(e.subscribe({event:"onRootDetached"},(function(e){var t=n.getValue("Issue3DReviewViewerRootsDetached");null===(t=t?JSON.parse(t):null)&&(t=[]),t.some((function(t){return t===e.id}))||(t.push(e.id),n.setValue("Issue3DReviewViewerRootsDetached",JSON.stringify(t)))}))),"ENX3DIR_AP"===m.get("widget").name&&(t._switchInProgress=!1,t._pad3DViewerTokens.push(m.get("pad3DViewer").subscribe({event:"onRealAssetLoaded"},(e=>{if(t._switchInProgress)t._switchInProgress=!1,e.callback();else{m.add("R2VMode",!0);var n=m.get("pad3DViewer").getExecutionContext().switchApp("ENX3DIR_AP","ENX3DIR_AP_RealAssets");t._switchInProgress=!0,n?n.then((()=>{t._switchInProgress=!1,e.callback()})).catch((n=>{console.error(n),t._switchInProgress=!1,e.callback()})):(t._switchInProgress=!1,e.callback())}})))),t._pad3DViewerTokens.push(m.get("pad3DViewer").subscribe({event:"onEndRootRemoved"},(e=>{if(!e.fromTimeline&&!e.fromRefresh&&!e.fromWidgetLink){const e=t.view.getRoots();let s=!1;for(let t=0;t<e.length;++t)if(S.isTileSetNode(e[t])){s=!0;break}s||1==m.get("R2VMode")&&(n.setValue("Issue3DReviewVieweR2VPathsInSession",JSON.stringify([])),m.get("pad3DViewer").getExecutionContext().switchApp("ENX3DIR_AP").catch((e=>{console.error(e)})))}}))),s()}))}))}_setLoadingDelegations(t){var n=this;n.issueLoadDelegationFunc=function(t){require(["DS/PADUtils/views/PADAlert","DS/PADUtils/PADTypesMgt"],(function(s,i){function o(o){if(!UWA.is(o,"array"))return null;var r=[],a={},l=[],c=[],u=o.forEach((function(e){var t,n=UWA.is(e.objectType)?e.objectType:e.type,s=UWA.is(e.objectId)?e.objectId:e.physicalId;UWA.is(e.path)&&(t=UWA.is(e.path,"string")?e.path.split(","):e.path,Array.isArray(t)&&(s=t));r.includes(n)||(r.push(n),l.push({type:n})),a[n]||(a[n]=[]),a[n].push(s)}));if(r.length>0){u=[];i.isTypesAuthorized(l,(function(i){if(i.length>0)i.forEach((function(e){"ENOStrRefinementSpecification"==e?a[e]&&a[e].forEach((function(e){c.push({objectId:e[0]})})):a[e]&&a[e].forEach((function(e){Array.isArray(e)?u.push({path:[e[0]]}):u.push({path:[e]})}))}));else{var o=e.replace(e.notifications.noSupportedReportedAgainstData,{name:t.displayName});s.displayNotification({msg:o,eventID:"warning"})}n.view.addRoots({objects:u}),c.length>0&&(c.reverse(),c.forEach((e=>{var t=[e];setTimeout((()=>{n.view.getController().addFilter(t)}),0)})))}))}}h.getAdditionalObjectInfo({pidArray:[t.objectId]}).then((i=>{if(console.log(i),"Issue Template"==i.additionObjectInfo[t.objectId].policy)s.displayNotification({msg:e.templateDndErrorMsg,eventID:"error"});else if(UWA.is(t.relatedObjects,"object")&&Array.isArray(t.relatedObjects.reportedAgainst)&&t.relatedObjects.reportedAgainst.length>0){var r=t.relatedObjects.reportedAgainst;r[0].hasOwnProperty("objectType")?o(r):n._retrieveAffectedItems(t).then((e=>{o(e)}))}else UWA.is(t.objectId,"string")&&""!==t.objectId?n._retrieveAffectedItems(t).then((e=>{o(e)})):s.displayNotification({msg:e.notifications.serverError,eventID:"error"})}))}))};var s={};t.forEach((e=>{s["_"+e]=n.issueLoadDelegationFunc})),n.view.setLoadingDelegations(s)}_retrieveAffectedItems(t){return new Promise(((n,s)=>{h.issues.retrieve({data:{objects:[{physicalId:t.objectId}]},onComplete:function(e){e.results&&e.results.length&&e.results[e.results.length-1].body?n(e.results[e.results.length-1].body.reportedAgainst):n([])},onFailure:function(){PADAlert.displayNotification({msg:e.notifications.serverError,eventID:"error"})}})}))}display(){var t=this;return t.component.isDisplayed()?(t.hud.on(e.notifications.lookingIssues),t.component.clear().then((function(){return t.hud.update(e.notifications.lookingIssues,"50"),t.component.display(t.view.getController().getRoots())})).then((function(){t.hud.update(t.hud.getHUDLabel(),"100"),t.onTitleChange(),t.component.isFocused()&&t.component.focus(),t.hud.off(),setTimeout((()=>{if(t.categories.find((e=>"Real"===e.identifier))){const e=t.pad3DViewer.getRoots();let n=!1;for(let t=0;t<e.length;++t)if(S.isTileSetNode(e[t])){n=!0;break}n&&(m.add("R2VMode",!0),t.pad3DViewer.getExecutionContext().switchApp("ENX3DIR_AP","ENX3DIR_AP_RealAssets"))}}),0)})).catch((function(e){}))):(t.hud.on(t.hud.getHUDLabel(),"100"),t.onTitleChange(),t.hud.off(),setTimeout((()=>{if(t.categories.find((e=>"Real"===e.identifier))){const e=t.pad3DViewer.getRoots();let n=!1;for(let t=0;t<e.length;++t)if(S.isTileSetNode(e[t])){n=!0;break}n&&(m.add("R2VMode",!0),t.pad3DViewer.getExecutionContext().switchApp("ENX3DIR_AP","ENX3DIR_AP_RealAssets"))}}),0),Promise.resolve())}clear(){var t=this;return(m.get("widget")||window.widget).setTitle(t.getTitle()+" - "+e.notifications.clearIssues),t.hud.on(e.notifications.clearIssues,"50"),t.component.clear().then((function(){t.hud.update(e.notifications.clearIssues,"100"),t.onTitleChange(),t.hud.off()})).catch((function(e){console.log("error =",e)}))}_updateSharedSettings(){var e=m.get("widget")||window.widget;require(["DS/PADUtils/PADSettingsMgt"],(function(t){try{var n=e.getValue("enopad3dviewer_displayCandidateQueue"),s=t.getSetting("enopad3dviewer_displayCandidateQueue");n!=s&&t.setSetting("enopad3dviewer_displayCandidateQueue",n),(n=e.getValue("enopad3dviewer_displayCandidateQueue_color"))!=(s=t.getSetting("enopad3dviewer_displayCandidateQueue_color"))&&t.setSetting("enopad3dviewer_displayCandidateQueue_color",n),(n=e.getValue("enopad3dviewer_selectionFilter"))!=(s=t.getSetting("enopad3dviewer_selectionFilter"))&&t.setSetting("enopad3dviewer_selectionFilter",n)}catch(e){}}))}hud={_loader:null,_container:null,init(){var e=this;if(UWA.is(e._loader,"object"))return Promise.resolve({loader:e._loader,container:e._container});var t=null;return new Promise((function(e){require(["DS/Controls/Loader"],(function(n){t=n,e()}))})).then((function(){return e._container=UWA.createElement("div",{class:"issue-3d-review-display-loader fade-in-element"}),e._loader=new t({text:"",showButtonFlag:!1}),e._loader.inject(e._container),{loader:e._loader,container:e._container}}))},on(e,t){var n=UWA.is(e,"string")?e:"";this._loader.on(),this._loader.elements.label.innerHTML=n},off(){var e=this;setTimeout((function(){new UWA.Fx(e._loader.elements.container,{duration:O,transition:"linear",events:{onStart:function(){},onComplete:function(){UWA.is(e._loader,"object")&&e._loader.off()}}}).start({opacity:[1,0]})}),0)},update(e,t){this._loader.elements.label.innerHTML=e},destroy(){var e=this;UWA.is(e._loader,"object")&&(e._loader.destroy(),e._container.destroy()),e._loader=null,e._container=null},getHUDLabel(){var t=m.get("component");if(!1===t.isDisplayed())return e.titles.issuesNotDisplayed;var n=Object.keys(t.getIssues().map).length;return 0===n?e.titles.noIssuesToShow:e.replace(e.titles.issues,{number:n})}};helper={container:null,_tooltip:null,init(){var t=m.get("widget")||window.widget,n=this.container=UWA.createElement("span",{class:"issue-status-left fonticon fonticon-help-circled"}),s=this._tooltip=new u({className:"helper-tooltip",position:"top",target:n,body:e.tooltips.helper,trigger:"touch"});return n.addEventListener("click",(function(){s.hide(),I.show(t.body)})),this},on(){this.container.show()},off(){this.container.hide()},destroy(){var e=this;null!==e._tooltip&&e._tooltip.destroy(),null!==e.container&&e.container.destroy(),e._tooltip=null,e.container=null}};utils={error(e){UWA.is(e,"object")&&UWA.is(e.error,"object")&&UWA.is(e.error.message,"string")&&require(["DS/PADUtils/views/PADAlert"],(function(t){t.displayNotification({msg:e.error.message,eventID:"error"})}))},getNLSMsg(t){var n={label:e.error.generic.label,sub:e.error.generic.sub},s="";return UWA.is(t,"object")&&UWA.is(t.error,"object")&&UWA.is(t.error.message,"string")&&(s=t.error.message),s.contains("The server cannot obtain the license for user")&&(n.label=e.replace(e.error.licensing.label,{user:f.getUserName()}),n.sub=e.error.licensing.sub),n}};onWillEnter(e){console.log("issue3dreview.onWillEnter called with ",e),e.pad3DViewer&&e.pad3DViewer.getController&&(this.issues={},e.pad3DViewer.toggleStartupView(!0),i.setSetting("enopad_webapis",!1),require("DS/PADUtils/PADSession").softInit(!0,!0))}onWillLeave(e){var t=this;if(t.component&&t.component.informationRightSidePanel){m.get("pad3DViewer").getExecutionContext().getComponent(WAfrStandardComponentKey.HandlerComponent).setCheckState({id:"ISURightSidePanel",state:!1})}return new Promise((function(n,s){var i={issues:g.getSelection({type:"issue"})};t.issues=i.issues&&i.issues.map?Object.values(i.issues.map):[],t.issues.forEach((function(e){e.physicalid=e.physicalId})),e&&"ENX3DIR_AP"!=e.options.afrAppId&&m.add("R2VMode",!1),t.component?t.component.clear(e).then((function(){n(i)})).catch(s):n(i)}))}dispose(e){var t=this,n=m.get("widget")||window.widget;n.setTitle(""),t._widgetEventTokens.forEach((function(e){n.removeEvent(e.eventName,e.listener)})),t._widgetEventTokens=[],t.destroy({keepPAD3DViewer:!0})}}})),define("DS/Issue3DReviewV2Rsc/components/ContextualMenu",["UWA/Class/Promise","UWA/Core","DS/Menu/ContextualMenu","DS/WebappsUtils/WebappsUtils","DS/Issue3DReviewV2Rsc/commandsWebAfr/CommandsManager","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","DS/IssueServices/utils/Views","DS/IssueCommon/utils/Utils","i18n!DS/Issue3DReviewV2Rsc/assets/nls/Issue3DReview","text!DS/IssueCommon/assets/Settings.json"],(function(e,t,n,s,i,o,r,a,l,c,u,d,p){"use strict";var g="Issue",m="Closed",h="Review",f="Assign",v="Active",D={REPORTED_AGAINST:"reportedAgainst",RESOLVED_BY:"resolvedBy",RESOLVED_ITEMS:"resolvedItems",CONTEXTS:"contexts",OPEN_WITH:"Open with",OPEN:"Open"},I={REPORTED_AGAINST:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-location",RESOLVED_BY:"wux-ui-3ds wux-ui-3ds-1x fonticon-resolved-by",RESOLVED_ITEMS:"wux-ui-3ds wux-ui-3ds-1x fonticon-markup-review",CONTEXTS:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-3d-object",OPEN_WITH:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-open-menu-dot",OPEN:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-open"},b="DS/Issue3DReviewV2Rsc/components/ContextualMenu";return{getWUXContextualMenu:function(){return n},getContextualMenu:function(){try{u.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"Bubble"}})}catch(e){}finally{var t=o.get("component").getIssues(),n=o.get("component").getSelectedIssues();if(0===n.length)return e.resolve([]);var s=n.reduce((function(e,n){var s=[],i=[],o=[],r=[];return t.map[n.id].model.get(D.REPORTED_AGAINST).forEach((function(e){s.push({physicalId:e.physicalId,type:e.type,name:e.name,title:e.title?e.title:e.name,kind:e.kind})})),t.map[n.id].model.get(D.RESOLVED_BY).forEach((function(e){i.push({physicalId:e.physicalId,type:e.type,name:e.name,title:e.title?e.title:e.name})})),t.map[n.id].model.get(D.RESOLVED_ITEMS).forEach((function(e){o.push({physicalId:e.physicalId,type:e.type,name:e.name,title:e.title?e.title:e.name,kind:e.kind})})),t.map[n.id].model.get(D.CONTEXTS).forEach((function(e){r.push({physicalId:e.physicalId,type:e.type,name:e.name,title:e.title?e.title:e.name,kind:e.kind})})),e.push({physicalId:n.id,type:n.type,name:n.name,title:n.title,reportedAgainst:s,resolvedBy:i,resolvedItems:o,contexts:r,baseType:n.baseType,state:n.state,coOwners:n.coOwners}),e}),[]);return this._getMenu({objects:s})}},_getMenu:function(t){var n=this,s=[];return 0===(Array.isArray(t.objects)?t.objects:[]).length?e.resolve([]):(l.start(n.name+" getFullMenu"),n._getOpenWithMenu(t).then((function(e){s=s.concat(e)})).then((function(){return n._getBasicMenu(t)})).then((function(e){return s=s.concat(e),l.end(n.name+" getFullMenu"),s})))},_getBasicMenu:function(e){l.start(this.name+" getMenu");var t=[],n=Array.isArray(e.objects)?e.objects:[],s=o.get("component").getSelectedIssues(),i=JSON.parse(p),r=i.duplicateIssues;return 0===n.length||(1!==s.length||s[0].state!=f&&s[0].state!=v||(t.push({name:"ResolveIssue",title:d.resolveTheIssue,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-resolved-by"},id:"resolvedBy",submenu:[{type:"PushItem",title:d.taskAsResolvedBy,fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-task"},id:"createTask",action:{callback:function(){o.get("pad3DViewer").getExecutionContext().getComponent(WAfrStandardComponentKey.HandlerComponent).executeHandler({id:"CreateTask"})}}},{type:"PushItem",title:d.caAsResolvedBy,fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-change"},id:"changeAction",action:{callback:function(){o.get("pad3DViewer").getExecutionContext().getComponent(WAfrStandardComponentKey.HandlerComponent).executeHandler({id:"ChangeAction"})}}},{type:"PushItem",title:d.addExistingAsResolvedBy,fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-search"},id:"addResolvedByUsingSearch",action:{callback:function(){o.get("pad3DViewer").getExecutionContext().getComponent(WAfrStandardComponentKey.HandlerComponent).executeHandler({id:"AddUsingSearchAsResolvedBy"})}}}]}),t.push({type:"SeparatorItem"})),s.length<=r&&t.push({name:"Duplicate",title:d.commands.duplicate,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-duplicate"},data:null,action:{callback:function(){o.get("pad3DViewer").getExecutionContext().getComponent(WAfrStandardComponentKey.HandlerComponent).executeHandler({id:"Duplicate"});try{u.cloudProbeUtils.sendI3DRCommandsTrackerEvent({options:{pd1:"Issue",pd2:"3DViewer",pd3:"Bubble",pd4:"Duplicate",pd5:"Issue/3DViewer/Bubble/Duplicate"}})}catch(e){}}}}),!(!0===e.atLeastOneIssueIsNotClosed&&n.length<=i.maxNumberOfIssueToClose)||e.allIssuesAreInApprovalState&&e.userIsCoordinator||t.push({name:"Close",title:d.commands.close,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-status-change"},data:null,action:{callback:function(){o.get("pad3DViewer").getExecutionContext().getComponent(WAfrStandardComponentKey.HandlerComponent).executeHandler({id:"Close"});try{u.cloudProbeUtils.sendI3DRCommandsTrackerEvent({options:{pd1:"Issue",pd2:"3DViewer",pd3:"Bubble",pd4:"MarkAsComplete",pd5:"Issue/3DViewer/Bubble/MarkAsComplete"}})}catch(e){}}}}),!0===e.atLeastOneIssueIsClosed&&t.push({name:"Reopen",title:d.reopen,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-open"},data:null,action:{callback:function(){o.get("pad3DViewer").getExecutionContext().getComponent(WAfrStandardComponentKey.HandlerComponent).executeHandler({id:"Reopen"});try{var e=o.get("component").getCurrentView();u.cloudProbeUtils.sendIMCommandsTrackerEvent({options:{pd1:"Issue",pd2:e,pd3:"SummaryViewActions",pd4:"Reopen",pd5:"Issue/"+e+"/SummaryViewActions/Reopen"}})}catch(e){}}}}),t.push({name:"CollaborativeLifecycle",title:d.commands.collaborativeLifecycle,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-collaborative-lifecycle-management"},data:null,action:{callback:function(){o.get("pad3DViewer").getExecutionContext().getComponent(WAfrStandardComponentKey.HandlerComponent).executeHandler({id:"CollaborativeLifecycle"});try{u.cloudProbeUtils.sendI3DRCommandsTrackerEvent({options:{pd1:"Issue",pd2:"3DViewer",pd3:"Bubble",pd4:"Maturity",pd5:"Issue/3DViewer/Bubble/Maturity"}})}catch(e){}}}}),t.push({type:"SeparatorItem"}),t.push({name:"Share",title:d.commands.share,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-link"},data:null,action:{callback:function(){o.get("pad3DViewer").getExecutionContext().getComponent(WAfrStandardComponentKey.HandlerComponent).executeHandler({id:"Share"});try{u.cloudProbeUtils.sendI3DRCommandsTrackerEvent({options:{pd1:"Issue",pd2:"3DViewer",pd3:"Bubble",pd4:"CopyLink",pd5:"Issue/3DViewer/Bubble/CopyLink"}})}catch(e){}}}}),t.push({type:"SeparatorItem"}),t.push({name:"RelationalExplorer",title:d.commands.relationalExplorer,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-object-related"},data:null,action:{callback:function(){o.get("pad3DViewer").getExecutionContext().getComponent(WAfrStandardComponentKey.HandlerComponent).executeHandler({id:"Relations"});try{u.cloudProbeUtils.sendI3DRCommandsTrackerEvent({options:{pd1:"Issue",pd2:"3DViewer",pd3:"Bubble",pd4:"Relations",pd5:"Issue/3DViewer/Bubble/Relations"}})}catch(e){}}}}),1===n.length&&t.push({name:"Attachments",title:d.commands.attachments,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-attach"},data:null,action:{callback:function(){o.get("pad3DViewer").getExecutionContext().getComponent(WAfrStandardComponentKey.HandlerComponent).executeHandler({id:"AttachmentManager"});try{u.cloudProbeUtils.sendI3DRCommandsTrackerEvent({options:{pd1:"Issue",pd2:"3DViewer",pd3:"Bubble",pd4:"Attachments",pd5:"Issue/3DViewer/Bubble/Attachments"}})}catch(e){}}}}),t.push({type:"SeparatorItem"}),t.push({title:d.commands.inspect,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-location"},action:{callback:function(){o.get("pad3DViewer").getExecutionContext().getComponent(WAfrStandardComponentKey.HandlerComponent).executeHandler({id:"Inspect"});try{u.cloudProbeUtils.sendI3DRCommandsTrackerEvent({options:{pd1:"Issue",pd2:"3DViewer",pd3:"Bubble",pd4:"Inspect",pd5:"Issue/3DViewer/Bubble/Inspect"}})}catch(e){}}}}),t.push({name:"Delete",title:d.commands.delete,type:"PushItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-trash"},data:null,action:{callback:function(){o.get("pad3DViewer").getExecutionContext().getComponent(WAfrStandardComponentKey.HandlerComponent).executeHandler({id:"Delete"});try{u.cloudProbeUtils.sendI3DRCommandsTrackerEvent({options:{pd1:"Issue",pd2:"3DViewer",pd3:"Bubble",pd4:"Delete",pd5:"Issue/3DViewer/Bubble/Delete"}})}catch(e){}}}}),l.end(this.name+" getMenu")),t},_getOpenWithMenu:function(t){var n=this,s=[],i=Array.isArray(t.objects)?t.objects:[];if(0===i.length)return e.resolve([]);if(t.allObjectsAreIssues=i.every((function(e){return e.baseType===g})),t.allObjectsAreNotIssues=i.every((function(e){return e.baseType!==g})),t.atLeastOneIssueIsClosed=i.some((function(e){return e.state===m})),t.atLeastOneIssueIsNotClosed=i.some((function(e){return e.state!==m})),t.allIssuesAreInApprovalState=i.every((function(e){return e.state===h})),t.userIsCoordinator=i.every((function(e){return!!(e&&e.coOwners&&e.coOwners.length>0)&&e.coOwners.some((e=>e.user==a.getUserName()))})),!0===t.allObjectsAreIssues){var o=[],r=[],l=[],c=[];t.objects.forEach((function(e){o=o.concat(e.contexts),r=r.concat(e.reportedAgainst),l=l.concat(e.resolvedBy),c=c.concat(e.resolvedItems)}));var u=[];return e.all([n._getOpenWithSubMenu({name:D.CONTEXTS,label:d.commands.open.contexts,objects:o,icon:I.CONTEXTS}),n._getOpenWithSubMenu({name:D.REPORTED_AGAINST,label:d.commands.open.reportedAgainst,objects:r,icon:I.REPORTED_AGAINST}),n._getOpenWithSubMenu({name:D.RESOLVED_BY,label:d.commands.open.resolvedBy,objects:l,icon:I.RESOLVED_BY}),n._getOpenWithSubMenu({name:D.RESOLVED_ITEMS,label:d.commands.open.resolvedItems,objects:c,icon:I.RESOLVED_ITEMS})]).then((function(e){return(u=e.reduce((function(e,t){return e.concat(t)}),[])).length>0&&s.push({name:D.OPEN,title:d.commands.open.multiple,type:"PushItem",data:null,fonticon:{content:I.OPEN},submenu:u}),s}))}return!0===t.allObjectsAreNotIssues?n._getOpenWithSubMenu({name:D.OPEN_WITH,label:d.commands.open.single,objects:t.objects,icon:I.OPEN_WITH}):e.resolve([])},_getOpenWithSubMenu:function(n){if(!n||!Array.isArray(n.objects)||0===n.objects.length)return e.resolve([]);var s=[],i=[],u=n.objects;return l.start(b+" _getOpenWithSubMenu"),new e((function(e){l.start(b+" _getOpenWithSubMenu getOpenWithMenu");for(var d=[],p=0;p<u.length;p++){var g=u[p],m=[];m.push(g.type),g.kind&&""!=g.kind&&m.push(g.kind),d.push(g.type),i.push({envId:a.getTenant(),serviceId:"3DSpace",objectId:g.physicalId,objectType:g.type,objectTaxonomies:m,displayName:g.title+"("+g.name+")"})}r.getTypesHierarchy({types:d,onComplete:function(r){if(t.is(r.types_hierarchies,"array")&&r.types_hierarchies.forEach((function(e,t){i.forEach((function(t,n){t.objectTaxonomies[0]===e.type&&(t.objectTaxonomies=t.objectTaxonomies.concat(e.hierarchy))}))})),0===i.length)return l.end(b+" _getOpenWithSubMenu"),void e(s);var a=o.get("widget")||window.widget;c.getOpenWith().set3DXContent({protocol:"3DXContent",version:"1.1",source:a.name,widgetId:a.id,data:{items:i}},!0).retrieveCompatibleApps((function(t){if(t&&t.length>0){var i=[],r=[];if(t.forEach((function(e){r={name:e.text.replace(/ /g,""),type:"PushItem",title:e.text,action:{callback:function(t){o.get("component").utils.setTypesCallbackForOFW(u),e.handler.call(t)}}},null!=e.fonticon?r.fonticon={content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+e.fonticon}:e.className&&1==e.className.contains("app-widget")?r.icon={iconPath:e.icon,className:"issue-widget"}:r.icon=e.icon,i.push(r)})),i.length>0){var a={name:n.name,type:"PushItem",fonticon:{content:n.icon},title:n.label,submenu:i};s.push(a)}}l.end(b+" _getOpenWithSubMenu"),e(s)}))},onFailure:function(t){e(s)}}),l.end(b+" _getOpenWithSubMenu")}))}}})),define("DS/Issue3DReviewV2Rsc/collections/Markers",["UWA/Class/Collection","DS/Logger/Logger","DS/Issue3DReviewV2Rsc/models/Marker"],(function(e,t,n){"use strict";return e.extend({name:"DS/Issue3DReviewV2Rsc/collections/Markers",model:n,comparator:"state",_logger:null,setup:function(){var e=this;return e._logger=t.getLogger("DS/Issue3DReviewV2Rsc/Model"),e._logger.debug("Initializing the marker collection"),e.addEvents({onRemove:e._onRemove,onAdd:e._onAdd,onReset:e._onReset},e),e},fetch:function(e){e.onComplete()},_onRemove:function(){},_onAdd:function(){},_onReset:function(){}})})),define("DS/Issue3DReviewV2Rsc/models/Issue",["UWA/Class/Model","UWA/Core","DS/Logger/Logger","DS/Issue3DReviewV2Rsc/collections/Markers","DS/Issue3DReviewV2Rsc/utils/ModelParser","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance"],(function(e,t,n,s,i,o,r){"use strict";var a="(╯°□°）╯︵ ┻━┻",l=0;return e.extend({name:"DS/Issue3DReviewV2Rsc/models/Issue",defaults:{id:"",type:"",name:"",title:"",state:"",description:"",owner:"",reportingOrganization:"",created:"",modified:"",resolutionDate:"",estimatedStartDate:"",estimatedEndDate:"",actualStartDate:"",actualEndDate:"",contexts:{},reportedAgainst:[],resolvedBy:[],resolvedItems:[],assignees:[],markers:null,primaryImage:null},_logger:null,setup:function(){var e=this;e._logger=n.getLogger("DS/Issue3DReviewV2Rsc/Model"),e._logger.debug("%s (%s) has been initialized with %s reported against",e.get("title"),e.get("name"),e.get("reportedAgainst").length)},fetch:function(e){var n=this;r.start(n.name+" fetch"),o.issues.retrieve({timestamp:e.timestamp?e.timestamp:null,data:{objects:[{physicalId:n.get("id")}]},onComplete:function(s){var o=i.parse(s.results[l].body,e),a=[];o.reportedAgainst.forEach((function(e){var t=e.physicalId;t.includes("i3dx")&&a.push(t)})),a=[...new Set(a)],n.retrieveFetchData(a).then((e=>{if(Array.isArray(e.body.results)){let s={};e.body.results.forEach((e=>{var n="",i="",o="";e.attributes.forEach((e=>{"ds6w:dataSource"==(t.is(e.name,"string")?e.name.replace("ds6w:what/","").replace("ds6w:when/","").replace("ds6w:who/",""):e.name)&&(o=e.value)})),e.attributes.forEach((e=>{switch(t.is(e.name,"string")?e.name.replace("ds6w:what/","").replace("ds6w:when/","").replace("ds6w:who/",""):e.name){case"resourceid":""==n&&(n=e.value);break;case"ds6w:identifier":""==n&&"r2vsurvey"!=o&&(n=e.value);break;case"ds6w:i3dx":i=e.value}})),s[i]=n}));var n=[];o.reportedAgainst.forEach((function(e){s[e.physicalId]&&(e.path=[s[e.physicalId]],e.physicalId=s[e.physicalId]),n.push(e)})),o.reportedAgainst=n}})).catch((function(e){})).finally((function(){o=n.parse(o,e),n.merge(o,e),n.set(o),e&&"function"==typeof e.onComplete&&e.onComplete(o),r.end(n.name+" fetch")}))},onFailure:function(t){e&&"function"==typeof e.onFailure&&e.onFailure(t),r.end(n.name+" fetch")}})},merge:function(e,n){var s=this;r.start(s.name+" merge");var i=e.reportedAgainst.reduce((function(e,t){return e[t.path.join()]=t,e}),{}),o=s.get("markers")||e.markers,a=[];o.forEach((function(e){a.push(e.get("path_str"))})),a.forEach((function(e){if(!t.is(i[e],"object"))for(var r=o.where({path_str:e}),a=0;a<r.length;a++)o.remove(r[a]),n.collection.setNodeAsNeutral(e),s.unset(e,{silent:n.silent})}));var l=!1;t.is(e.markers,"object")||(e.markers=s.get("markers"),l=!0),s._addMarkers(e,n),!0===l&&delete e.markers,r.end(s.name+" merge")},fetchPrimaryImage:function(e){var n=this;n._logger.debug("Fetching primary image for issue %s (%s)",n.get("title"),n.get("name")),r.start(n.name+" primaryImage"),o.images.retrieve({data:{objects:[{physicalId:n.get("id")}]},onComplete:function(s){var i=s.results[l].body;n._logger.debug("Primary image for the issue %s have been fetched",n.get("title")+"("+n.get("name")+")");var o=null;t.is(i,"object")&&t.is(i.fileName,"string")&&""!==i.fileName&&t.is(i.url,"string")&&""!==i.url&&(o=i,n.set("primaryImage",i,{silent:!0})),e.onComplete(o),r.end(n.name+" primaryImage")},onFailure:function(t){n._logger.debug("Fetch primary image failed for issue %s (%s)",n.get("title"),n.get("name")),e.onFailure(t),r.end(n.name+" primaryImage")}})},parse:function(e,t){var n=this;return r.start(n.name+" parse"),!0===t.add&&(e.markers=new s([],{}),n._addMarkers(e,t)),r.end(n.name+" parse"),e},save:function(e,n){var s=this;s._logger.debug("Saving issue %s (%)",s.get("title"),s.get("name")),r.start(s.name+" save");var i=t.clone(e);i.physicalId=s.get("id"),o.issues.update({id:s.get("id"),data:{objects:[i]},onComplete:function(e){n&&"function"==typeof n.onComplete&&n.onComplete(e.results),r.end(s.name+" save")},onFailure:function(e){n&&"function"==typeof n.onFailure&&n.onFailure(e),r.end(s.name+" save")}})},destroy:function(){var e=this;e._logger.debug("Destroying issue %s (%s)",e.get("title"),e.get("name")),e.clear({silent:!0}).set(e.defaults)},_addMarkers:function(e,t){var n=this,s=e.markers.groupBy("path_str");e.reportedAgainst.forEach((function(i){var o=i.physicalId,r=i.path,l=t.collection.getNodesById(o),c=l.nodes,u=l.paths;if(c.length>0&&!s[r.join()])for(var d=0;d<c.length;d++){if(u[d].toString().includes(r.toString())){e.markers.add({id:e.id+a+r.join()+a+d,issue:n,type:i.type,name:i.name,revision:i.revision,title:i.title,position:i.position,node:c[d],path:u[d],path_str:r.join()},{silent:t.silent});var p=r.join();n.set(p,p,{silent:t.silent}),t.collection.setNodeAsReported(p)}}}))},retrieveFetchData:function(e){var t=this;return new Promise(((n,s)=>{var i=parseInt(e.length/1e4);e.length/1e4>parseInt(e.length/1e4)&&i++;const r=[];t.results=[];for(let n=1;n<=i;n++){var a=e.map((function(e,t){if(t>=1e4*(n-1)&&t<1e4*n)return{physicalId:e}})).filter((function(e){return void 0!==e}));let i=o.fetch({data:{objects:a}}).then((function(e){t.results.push(...e.body.results)})).catch((function(e){s(e)}));r.push(i)}Promise.all(r).then((function(){let e={body:{results:t.results}};n(e)}))}))}})})),define("DS/Issue3DReviewV2Rsc/views/Inspector",["UWA/Class","UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Input/Toggle","DS/UIKIT/Mask","DS/UIKIT/Tooltip","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/Visualization/ThreeJS_DS","DS/Visualization/IdPath","DS/Issue3DReviewV2Rsc/commandsWebAfr/CommandsManager","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","DS/IssueServices/services/IssueServices","DS/SceneGraphOverrides/SceneGraphOverrideSet","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/PADUtils/PADTypesMgt","i18n!DS/Issue3DReviewV2Rsc/assets/nls/Issue3DReview","css!DS/Issue3DReviewV2Rsc/Issue3DReviewV2Rsc.css"],(function(e,t,n,s,i,o,r,a,l,c,u,d,p,g,m,h,f,v,D){"use strict";var I=300,b=function(){return s.createElement("ul",{class:"navigation-inspect-mode is-ground-level"})},w=function(){return s.createElement("li",{id:"navigation-inspect-exit",class:"navigation-inspect-mode home-section",html:'<span class="home-section wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-move-to-start"></span>'})},y=function(){return s.createElement("li",{id:"navigation-inspect-back",class:"navigation-inspect-mode home-section",html:'<span class="home-section wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-back "></span>'})},S=function(e){return s.createElement("li",{id:"navigation-inspect-info",class:"navigation-inspect-mode first-crumb crumbs-with-home",html:"<p>"+D.replace(D.inspect.title,{number:e.number})+"</p><span></span>"})};return n.extend({name:"DS/Issue3DReviewV2Rsc/views/Inspector",tag:"div",className:"inspect-options-container",_logger:null,manager:null,elements:{bar:null,info:null,context:null,related:null,tooltips:[]},isProcessing:!1,isInspectioneering:!1,isInContext:!1,isRelatedSwitch:!1,_toBeRemovedAtRelease:{contexts:[],resolvedItems:[]},_inspectedIssues:{},_currentLevel:-1,_restoreFocus:!1,_levels:{},_session:{paths:{inspected:[],added:[],showed:[]},issues:[]},defaultOptions:{manager:null},_viewPoint:null,_overrideAll:[],_overrideSet:null,_overrideManager:null,setup:function(e){var t=this;return t._logger=a.getLogger("DS/Issue3DReviewV2Rsc/View"),t._parent(e),t.manager=t.getOption("manager"),t.elements={bar:null,info:null,context:null,related:null,tooltips:[]},t._viewPoint=null,t.reset(),t},render:function(){var e=this,t=b(),n=w(),o=y(),a=S({number:Object.keys(e._inspectedIssues).length});e.elements.bar=t,e.elements.info=a,t.appendChild(n),t.appendChild(o),t.appendChild(a),n.addEventListener("click",(function(){p.get("component").release()})),n.addEventListener("touchstart",(function(e){e.preventDefault(),p.get("component").release()})),o.addEventListener("click",(function(){e._goToLevel(e._currentLevel-1)})),o.addEventListener("touchstart",(function(t){t.preventDefault(),e._goToLevel(e._currentLevel-1)})),a.addEventListener("click",(function(){})),e.container.appendChild(t),e.elements.context=new i({type:"switch",value:"with-context",label:D.inspect.withContext,disabled:!0,events:{onChange:function(){!0===this.isChecked()&&!1===e.isInContext?e.showContext().catch((function(){setTimeout((function(){e.elements.context.uncheck()}),I)})):e.hideContext()}}}).inject(e.container),e.elements.tooltips.push(new r({position:"top",target:e.elements.context.elements.container,body:D.inspect.withContextTooltip})),e.elements.related=new i({type:"switch",disabled:!0,label:D.inspect.switchRelated,events:{onChange:function(){e.switchRelatedObjects().catch((function(){setTimeout((function(){e.elements.related.uncheck()}),I)}))}}}).inject(e.container),e.elements.tooltips.push(new r({position:"top",target:e.elements.related.elements.container,body:D.inspect.switchRelatedTooltip}));var c=p.get("pad3DViewer").render();c.insertBefore(e.container,c.firstChild);var u=Object.keys(e._levels[e._currentLevel].inspectedIssues);return m.issues.retrieve({data:{objects:u.map((e=>({physicalId:e})))},onComplete:function(t){if(t.results&&t.results.length&&t.results[t.results.length-1].body){e.issueData=t.results[t.results.length-1].body;let n=[];e.issueData.reportedAgainst.forEach((e=>{n.push(e.physicalId)})),e.issueData.resolvedBy.forEach((e=>{n.push(e.physicalId)})),e.issueData.contexts.forEach((e=>{n.push(e.physicalId)})),e.issueData.resolvedItems.forEach((e=>{n.push(e.physicalId)})),n=[...new Set(n)],m.fetch({data:{objects:n.map((function(e){return{physicalId:e}}))},onComplete:function(t){let n={};t.body.results.forEach((e=>{let t={};var i="";e.attributes.forEach((e=>{switch(s.is(e.name,"string")?e.name.replace("ds6w:what/","").replace("ds6w:when/","").replace("ds6w:who/",""):e.name){case"resourceid":i=e.value;break;case"ds6w:type":t.type=e.value}})),n[i]=t}));var i={contexts:[],reportedAgainst:[],resolvedBy:[],resolvedItems:[]};let o=e.issueData.contexts,r=e.issueData.reportedAgainst,a=e.issueData.resolvedBy,l=e.issueData.resolvedItems;o.forEach((e=>{if(n[e.physicalId]){let t={};t={...e,...n[e.physicalId]},i.contexts.push(t)}})),r.forEach((e=>{if(n[e.physicalId]){let t={};t={...e,...n[e.physicalId]},i.reportedAgainst.push(t)}})),a.forEach((e=>{if(n[e.physicalId]){let t={};t={...e,...n[e.physicalId]},i.resolvedBy.push(t)}})),l.forEach((e=>{if(n[e.physicalId]){let t={};t={...e,...n[e.physicalId]},i.resolvedItems.push(t)}})),e.issueData.contexts=i.contexts,e.issueData.reportedAgainst=i.reportedAgainst,e.issueData.resolvedBy=i.resolvedBy,e.issueData.resolvedItems=i.resolvedItems}})}else resolve([])},onFailure:function(t){l.displayNotification({msg:D.notifications.serverError,eventID:"error"}),g.end(e.name+" fetch")}}),e},destroy:function(){var e=this;e.reset(),e.manager=null,e.elements.tooltips.forEach((function(e){e.destroy()})),e.elements={bar:null,info:null,context:null,related:null,tooltips:[]},e._viewPoint=null},reset:function(){var e=this;e.isProcessing=!1,e.isInspectioneering=!1,e.isInContext=!1,e.isRelatedSwitch=!1,e._toBeRemovedAtRelease={contexts:[],resolvedItems:[]},e._inspectedIssues={},e._currentLevel=-1,e._restoreFocus=!1,e._levels={0:{inspectedIssues:{},session:{paths:{inspected:[],contexts:{added:[],showed:[]},resolvedItems:{added:[],showed:[]}}}}}},inspect:function(e){var t=this;g.start(t.name+" inspect");var n=e.ids;return t.isInspectable(n).then((function(){return-1===t._currentLevel?t._startInspect2(n):t._goDeeper(n)})).then((function(){g.end(t.name+" inspect")}))},_startInspect2:function(e){var n=this,s=n.manager.options.context.window.getViewpoint(),i={target:s.control.target,orientation:s.control.orientation,distanceToTarget:s.control.distanceToTarget};n._viewPoint=JSON.stringify(i);var o=!1;return new t((function(e){n.loading(),n.reset(),p.get("filter").hide(),p.get("pad3DViewer").getExecutionContext().getComponent(WAfrStandardComponentKey.HandlerComponent).getCheckState({id:"Focus"})&&(n._restoreFocus=!0,p.get("pad3DViewer").getExecutionContext().getComponent(WAfrStandardComponentKey.HandlerComponent).setCheckState({id:"Focus",state:!1})),n.manager.options.context.window.getViewer().visibleSpace?e():(o=!0,d.getCommand("VisuVisibleSpace").onEnd(e),d.getCommand("VisuVisibleSpace").begin())})).then((function(){return n._currentLevel++,d.inspectingIssue(),n.isInspectioneering=!0,n.isProcessing=!0,n.manager.optimizeBalloonVisualization(),n.manager.hide()})).then((function(){for(var s=n.manager.getIssues().map,i=[],o=[],r=0;r<e.length;r++){var a=s[e[r]];void 0!==a&&(n._inspectedIssues[e[r]]=a,a.model.get("markers").forEach((function(e){i.push(e.get("path"))})),o.push(a.show()))}return n._levels[n._currentLevel].inspectedIssues=n._inspectedIssues,n._levels[n._currentLevel].session.paths.inspected=i,n._renderViewer({pathsToShow:i,isInspect:!0}),t.all(o)})).then((function(){return!0===o?new t((function(e){d.getCommand("VisuVisibleSpace").onEnd(e),d.getCommand("VisuVisibleSpace").begin()})):t.resolve()})).then((function(){n.render(),n._refreshNavigationBar(),n.isProcessing=!1,n.unloading()}))},_renderViewer:function(e){var t=this,n=t.manager.options.context.root.getController(),s=p.get("component").context.root,i=e.pathsToShow,o=!!e.isInspect,r=i.map((function(e){return e.toString()}));null!==t._overrideManager&&null!==t._overrideSet&&(t._overrideAll.forEach((function(e){e.setVisibility(!0),e.setVisibilityFree(!1),t._overrideSet.deleteOverride(e)})),t._overrideManager.removeSceneGraphOverrideSet(t._overrideSet),t._overrideAll.length=0),t._overrideManager=s.getViewer().getSceneGraphOverrideSetManager(),t._overrideSet=new h(n.getRootBag(),n.getRootBagId(),!0),t._overrideManager.insertSceneGraphOverrideSetAt(t._overrideSet,0);var a=[],l={};for(var c in l=o?t.manager.paths:t.manager.utils.parseChildren2(n).paths)if(l.hasOwnProperty(c))for(var d=0;d<l[c].length;d++){var g=l[c][d],m=g.toString(),f=[n.getRootBagId()];f=f.concat(g);var v=new u(f),D=t._overrideSet.createIdPathOverride({idPathes:v});if(null!==D)r.some((function(e){var t=m.includes(e),n=m===e,s=e.includes(m);return t||n||s}))?(D.setVisibility(!0),D.setVisibilityFree(!1),t._overrideAll.push(D),o&&a.push(c)):(D.setVisibility(!1),D.setVisibilityFree(!0),t._overrideAll.push(D))}n._viewer.render({updateInfinitePlane:!0}),t.manager.options.context.window.getViewpoint().reframe(null),o&&a.forEach((function(e){n._model._OOCManager.isReferenceLoaded(e)||n._model._OOCManager.forceReferenceLoad(e,null)}))},_goDeeper:function(e){var n=this,s=!1;return new t((function(e){n.loading(),n.isProcessing=!0,n._currentLevel++,n.manager.options.context.window.getViewer().visibleSpace?e():(s=!0,d.getCommand("VisuVisibleSpace").onEnd(e),d.getCommand("VisuVisibleSpace").begin())})).then((function(){n._levels[n._currentLevel]={inspectedIssues:{},session:{paths:{inspected:[],contexts:{added:[],showed:[]},resolvedItems:{added:[],showed:[]}}}};for(var s=n.manager.getIssues().map,i=[],o=0;o<e.length;o++){var r=s[e[o]];void 0!==r&&(n._levels[n._currentLevel].inspectedIssues[e[o]]=r,r.model.get("markers").forEach((function(e){i.push(e.get("path"))})))}n._levels[n._currentLevel].session.paths.inspected=i;for(var a=[],l=Object.keys(n._levels[n._currentLevel-1].inspectedIssues),c=0;c<l.length;c++)-1===e.indexOf(l[c])&&a.push(n._levels[n._currentLevel-1].inspectedIssues[l[c]].hide());return t.all(a)})).then((function(){return n._refreshVisualization(!0)})).then((function(){return s?new t((function(e){d.getCommand("VisuVisibleSpace").onEnd(e),d.getCommand("VisuVisibleSpace").begin()})):t.resolve()})).then((function(){n._refreshNavigationBar(),n.manager.component.dispatchEvent("onInspect"),n.isProcessing=!1,n.unloading()}))},_goToLevel:function(e){var n=this;if(null===n._levels[e]||void 0===n._levels[e])return t.reject(new Error("The level does not exist"));var s=t.resolve(),i=!1;return n.manager.options.context.window.getViewer().visibleSpace||(i=!0,s.then((function(){return new t((function(e){d.getCommand("VisuVisibleSpace").onEnd(e),d.getCommand("VisuVisibleSpace").begin()}))}))),!0===n.isInContext&&(s=s.then((function(){return n.hideContext().then((function(){n.elements.context.uncheck()}))}))),!0===n.isRelatedSwitch&&(s=s.then((function(){return n.switchRelatedObjects().then((function(){n.elements.related.uncheck()}))}))),s.then((function(){return n.loading(),n.isProcessing=!0,n._currentLevel=e,n._refreshVisualization(!0)})).then((function(){for(var e=[],s=Object.keys(n._levels[n._currentLevel].inspectedIssues),i=0;i<s.length;i++)e.push(n._levels[n._currentLevel].inspectedIssues[s[i]].show());return t.all(e)})).then((function(){return i?new t((function(e){d.getCommand("VisuVisibleSpace").onEnd(e),d.getCommand("VisuVisibleSpace").begin()})):t.resolve()})).then((function(){n._refreshNavigationBar(),n.manager.component.dispatchEvent("onInspect"),n.isProcessing=!1,n.unloading()}))},_refreshNavigationBar:function(){var e=this,t=Object.keys(e._levels[e._currentLevel].inspectedIssues).length;0===e._currentLevel?e.elements.bar.addClassName("is-ground-level"):e.elements.bar.removeClassName("is-ground-level"),e.elements.info.innerHTML="<p>"+D.replace(D.inspect.title,{number:t})+"</p><span></span>",1===t?(e.elements.context.enable(),e.elements.related.enable()):(e.elements.context.disable(),e.elements.related.disable())},release:function(){var e=this;if(!0===e.isProcessing)return t.reject(new Error("We are already processing an inspection"));if(!1===e.isInspectioneering)return t.resolve();g.start(e.name+" release"),e.isProcessing=!0,e.loading();var n=[],i=!1;return e.manager.options.context.window.getViewer().visibleSpace||(i=!0,n.push(new t((function(e){d.getCommand("VisuVisibleSpace").onEnd(e),d.getCommand("VisuVisibleSpace").begin()})))),t.all(n).then((function(){d.releasingIssue(),e.container.destroy();var n=t.resolve();return!0===e.isInContext&&(n=n.then((function(){return e.hideContext()}))),!0===e.isRelatedSwitch&&(n=n.then((function(){return e.switchRelatedObjects()}))),n})).then((function(){e.manager.unselectAll({publish:!0});var t=e.manager.options.context.root.getController();if(e._toBeRemovedAtRelease.contexts.length>0&&t.removeRoots({pids:s.clone(e._toBeRemovedAtRelease.contexts)},!0),e._toBeRemovedAtRelease.resolvedItems.length>0){t.removeRoots({pids:s.clone(e._toBeRemovedAtRelease.resolvedItems)},!0);var n=widget.getValue("Issue3DReviewViewerPathsInSession");n=n?JSON.parse(n):[];var i=widget.getValue("Issue3DReviewViewerRootsDetached");i=i?JSON.parse(i):[],n&&n.length>0&&p.get("pad3DViewer").getController().addRoots({paths:n,pids_hidden:i},!1,!1)}if(e._overrideAll.forEach((function(t){t.setVisibility(!0),t.setVisibilityFree(!1),e._overrideSet.deleteOverride(t)})),e._overrideManager.removeSceneGraphOverrideSet(e._overrideSet),e._overrideAll.length=0,t._viewer.render({updateInfinitePlane:!0}),s.is(e._viewPoint,"string")){var o=JSON.parse(e._viewPoint),r={};r.target=new c.Vector3(o.target.x,o.target.y,o.target.z),r.orientation=new c.Quaternion(o.orientation.x,o.orientation.y,o.orientation.z,o.orientation.w),r.distanceToTarget=o.distanceToTarget,e.manager.options.context.window.getViewpoint().control.moveTo(r)}else e.manager.options.context.window.getViewpoint().reframe(null)})).then((function(){return e.manager.show()})).then((function(){return i?new t((function(e){d.getCommand("VisuVisibleSpace").onEnd(e),d.getCommand("VisuVisibleSpace").begin()})):t.resolve()})).then((function(){!0===e._restoreFocus&&p.get("pad3DViewer").getExecutionContext().getComponent(WAfrStandardComponentKey.HandlerComponent).setCheckState({id:"Focus",state:!1}),p.get("filter").show(),e.isProcessing=!1,e.reset(),e.unloading(),g.end(e.name+" release")}))},refresh:function(){var e=this,n=t.resolve();return!0===e.isInContext&&(n=n.then((function(){return e.hideContext()})).then((function(){return e.showContext()}))),e.isRelatedSwitch&&(n=n.then((function(){return e.switchRelatedObjects()})).then((function(){return e.switchRelatedObjects()}))),n},showContext:function(){var e=this,n=e.manager.options.context.root.getController();return!1===e.isInspectioneering||!0===e.isInContext?t.reject(new Error("You need to be in inspect mode to display the context")):Object.keys(e._levels[e._currentLevel].inspectedIssues).length>1?(l.displayNotification({msg:D.inspect.inspectNotAvailable,eventID:"info"}),t.reject(new Error("You need to inspect only ONE issue to display the context"))):(g.start(e.name+" showContext"),new t((function(t,n){e.loading(),e.isInContext=!0;var s=[];let i={},o=[];Object.keys(e._levels[e._currentLevel].inspectedIssues).forEach((function(t){var n=e._levels[e._currentLevel].inspectedIssues[t].model.get("contexts").map((t=>{const n=e.issueData.contexts.findIndex((e=>e.physicalId==t.physicalId)),{type:s}=-1!==n?e.issueData.contexts[n]:{};return{...t,type:s}}));Array.isArray(n)&&n.forEach((e=>{"Change Action"!==e.type&&(i.hasOwnProperty(e.type)?i[e.type].push(e.physicalId):(i[e.type]=[e.physicalId],o.push({type:e.type})))}))}));let r=[];v.isTypesAuthorized(o,(function(o){o.forEach((function(e){s=[...s,...i[e]],r[e]=i[e]})),s.length>0?t({types:r}):(e.isInContext=!1,l.displayNotification({msg:D.inspect.noContext,eventID:"info"}),n(new Error("No context for this issue")))}))})).then((function(e){var n=[];for(var s in e.types)n.push(new t((function(t,n){let i=s;"ENOStrRefinementSpecification"===s?p.get("pad3DViewer").getController().getPrdIdFromFilterId(e.types[s]).then((function(n){t({type:i,ids:e.types[i],resolvedPrdIds:[n]})})):t({type:i,ids:e.types[i],resolvedPrdIds:[]})})));return t.all(n)})).then((function(n){let s=new Set,i=new Set;n.forEach((e=>{"ENOStrRefinementSpecification"!=e.type&&e.ids.forEach((e=>s.add(e)))}));let o=[...s];return n.forEach((e=>{"ENOStrRefinementSpecification"!==e.type||o.includes(e.resolvedPrdIds[0])||e.ids.forEach((e=>i.add(e)))})),new t((function(t,s){t({pathsInfo:e.getPathsInSession([...o,...i]),ctx:n})}))})).then((function(s){return Object.keys(s.pathsInfo.inSession).length>0&&(e._levels[e._currentLevel].session.paths.contexts.showed=[].concat(s.pathsInfo.inSession)),new t((function(t,i){if(s.pathsInfo.notInSession.length>0){var o=0,r=e.manager.options.context.root.subscribe({event:"onRootAdded"},(function(i){o+=1;var a=n.buildArrayFromPath(i.path);e._levels[e._currentLevel].session.paths.contexts.added.push(a),e._toBeRemovedAtRelease.contexts=e._toBeRemovedAtRelease.contexts.concat(a),o===s.pathsInfo.notInSession.length&&(e.manager.options.context.root.unsubscribe(r),t())})),a=e.manager.options.context.root.subscribe({event:"onLoadingFailure"},(function(){e.manager.options.context.root.unsubscribe(a),l.displayNotification({msg:D.inspect.objectLoadError,eventID:"error"}),e.isInContext=!1,i(new Error("Object(s) failed to load"))}));let d=s.ctx.filter((e=>"ENOStrRefinementSpecification"==e.type));var c=[],u=[];s.pathsInfo.notInSession.forEach((function(e){d.length>0&&d[0].ids&&d[0].ids.includes(e)?u.push({objectId:e}):c.push([e])})),n.addRoots({paths:c},!1,!0,!1),u.length>0&&n.addFilter(u)}else t()}))})).then((function(){return e._refreshVisualization(!0)})).finally((function(){e.unloading(),e.isInContext&&d.inspectingIssue(),g.end(e.name+" showContext")})))},hideContext:function(){var e=this;return g.start(e.name+" hideContext"),e.loading(),e.isInContext=!1,e._levels[e._currentLevel].session.paths.contexts.showed=[],e._levels[e._currentLevel].session.paths.contexts.added=[],e._refreshVisualization(!0).then((function(){e.unloading(),g.end(e.name+" hideContext")}))},switchRelatedObjects:function(){var e=this,n=e.manager.options.context.root.getController();if(!1===e.isInspectioneering)return t.reject(new Error("You need to be in inspect mode to switch the related objects"));if(Object.keys(e._levels[e._currentLevel].inspectedIssues).length>1)return l.displayNotification({msg:D.inspect.inspectNotAvailable,eventID:"info"}),t.reject(new Error("You need to inspect only ONE issue to switch the related objects"));g.start(e.name+" switchRelatedObjects"),e.isRelatedSwitch=!e.isRelatedSwitch,e.loading();return(!0===e.isRelatedSwitch?new t((function(t,n){var s=[];let i={},o=[];Object.keys(e._levels[e._currentLevel].inspectedIssues).forEach((function(t){var n=e._levels[e._currentLevel].inspectedIssues[t].model.get("resolvedItems").map((t=>{const n=e.issueData.resolvedItems.findIndex((e=>e.physicalId==t.physicalId)),{type:s}=-1!==n?e.issueData.resolvedItems[n]:{};return{...t,type:s}}));n&&Array.isArray(n)&&n.forEach((e=>{"Change Action"!==e.type&&(i.hasOwnProperty(e.type)?i[e.type].push(e.physicalId):(i[e.type]=[e.physicalId],o.push({type:e.type})))}))}));let r=[];v.isTypesAuthorized(o,(function(o){o.forEach((function(e){s=[...s,...i[e]],r[e]=i[e]})),s.length>0?t({types:r}):(e.isRelatedSwitch=!1,l.displayNotification({msg:D.inspect.noResolvedItemsForSwitch,eventID:"info"}),n(new Error("No resolved by objects found")))}))})).then((function(e){var n=[];for(var s in e.types)n.push(new t((function(t,n){let i=s;"ENOStrRefinementSpecification"===s?p.get("pad3DViewer").getController().getPrdIdFromFilterId(e.types[s]).then((function(n){t({type:i,ids:e.types[i],resolvedPrdIds:[n]})})):t({type:i,ids:e.types[i],resolvedPrdIds:[]})})));return t.all(n)})).then((function(n){let s=new Set,i=new Set;n.forEach((e=>{"ENOStrRefinementSpecification"!=e.type&&e.ids.forEach((e=>s.add(e)))}));let o=[...s];return n.forEach((e=>{"ENOStrRefinementSpecification"!==e.type||o.includes(e.resolvedPrdIds[0])||e.ids.forEach((e=>i.add(e)))})),new t((function(t,s){t({pathsInfo:e.getPathsInSession([...o,...i]),ctx:n})}))})).then((function(s){return Object.keys(s.pathsInfo.inSession).length>0&&(e._levels[e._currentLevel].session.paths.resolvedItems.showed=[].concat(s.pathsInfo.inSession)),new t((function(t,i){if(s.pathsInfo.notInSession.length>0){var o=0,r=e.manager.options.context.root.subscribe({event:"onRootAdded"},(function(i){o+=1;var a=n.buildArrayFromPath(i.path);e._levels[e._currentLevel].session.paths.resolvedItems.added.push(a),e._toBeRemovedAtRelease.resolvedItems=e._toBeRemovedAtRelease.resolvedItems.concat(a),o===s.pathsInfo.notInSession.length&&(e.manager.options.context.root.unsubscribe(r),t())})),a=e.manager.options.context.root.subscribe({event:"onLoadingFailure"},(function(){e.manager.options.context.root.unsubscribe(a),l.displayNotification({msg:D.inspect.objectLoadError,eventID:"error"}),e.isRelatedSwitch=!1,i(new Error("Object(s) failed to load"))}));let d=s.ctx.filter((e=>"ENOStrRefinementSpecification"==e.type));var c=[],u=[];s.pathsInfo.notInSession.forEach((function(e){d.length>0&&d[0].ids&&d[0].ids.includes(e)?u.push({objectId:e}):c.push([e])})),n.addRoots({paths:c},!1,!0,!1),u.length>0&&(s.ctx.forEach((e=>{null!=e.resolvedPrdIds&&e.resolvedPrdIds.length>0&&n.removeRoots({pids:e.resolvedPrdIds},!0)})),n.addFilter(u))}else t()}))})):new t((function(t){e._levels[e._currentLevel].session.paths.resolvedItems.showed=[],e._levels[e._currentLevel].session.paths.resolvedItems.added=[],t()}))).then((function(){return e._refreshVisualization(!1)})).finally((function(){e.unloading(),e.isRelatedSwitch&&d.inspectingIssue(),g.end(e.name+" switchRelatedObjects")}))},_refreshVisualization:function(e){var n=this;n.manager.options.context.root.getController();return new t((function(t){var s=n._levels[n._currentLevel].session,i=[];n.isInContext&&(i=i.concat(s.paths.contexts.showed).concat(s.paths.contexts.added)),i=n.isRelatedSwitch?i.concat(s.paths.resolvedItems.showed).concat(s.paths.resolvedItems.added):i.concat(s.paths.inspected),n._renderViewer({pathsToShow:i}),!0===e&&n.manager.options.context.window.getViewpoint().reframe(null),t()}))},isInspected:function(){return this.isInspectioneering},isInspectable:function(e){var n=this;if(!0===n.isProcessing)return t.reject(new Error("We are already processing an inspection"));if(n._currentLevel>=0){var s=Object.keys(n._levels[n._currentLevel].inspectedIssues);if(s.length===e.length)if(e.filter((function(e){return s.includes(e)})).length===e.length)return t.reject(new Error("You are trying to inspect the same issue(s)"))}return t.resolve()},getInspectedIssues:function(){var e=[],t=this._levels[this._currentLevel].inspectedIssues;for(var n in t)if(t.hasOwnProperty(n)){var s=t[n].model,i={id:s.get("id"),type:s.get("type"),name:s.get("name"),title:s.get("title")};e.push(i)}return e},getPathsInSession:function(e){for(var t={inSession:[],notInSession:[]},n=p.get("pad3DViewer").getController(),s=this.manager.utils.parseChildren2(n),i=0;i<e.length;i++){var o=[],r=s.paths[e[i]];if(r&&r.length>0)for(var a=0;a<r.length;a++)o.push(r[a]);o.length>0?t.inSession=t.inSession.concat(o):t.notInSession.push(e[i])}return t},loading:function(){},unloading:function(){}})})),define("DS/Issue3DReviewV2Rsc/views/ConflictBalloon",["UWA/Class","UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/Core/PointerEvents","DS/Logger/Logger","DS/UIKIT/Popover","DS/VisuEvents/EventsManager","DS/Issue3DReviewV2Rsc/components/ContextualMenu","DS/IssueServices/utils/Performance","i18n!DS/Issue3DReviewV2Rsc/assets/nls/Issue3DReview","i18n!DS/IssueCommon/assets/nls/IssueCommon"],(function(e,t,n,s,i,o,r,a,l,c,u,d){"use strict";var p="Create",g="Assign",m="Active",h="Review",f="Closed",v="1",D="#F9F9F9",I="#3D3D3D",b="#3D3D3D",w=0,y=function(e,t,n,s){return'<svg class="balloon-svg" width="25" height="45" viewBox="0 0 25 45" preserveAspectRatio="xMaxYMax" xmlns="http://www.w3.org/2000/svg"><g><g class="balloon-container" opacity="'+t+'"><path class="balloon-path" stroke-width="1" stroke="'+n+'" fill="'+e+'" d="m12.50023,0.61752c-6.51488,0 -11.79788,5.59224 -11.79788,12.48846c0,2.80815 0.87686,5.40025 2.35194,7.48519c0.005,0.00289 0.00727,0.00818 0.00727,0.01059c0.28047,0.43643 9.31685,14.46321 9.43822,23.78072c0.12182,-9.31751 9.15775,-23.34429 9.43867,-23.78072c0.005,-0.0077 0.00727,-0.01059 0.00727,-0.01059c1.47599,-2.08494 2.35194,-4.67704 2.35194,-7.48519c0,-6.89575 -5.28209,-12.48846 -11.79743,-12.48846zm0,6.57288c2.94833,0 5.34028,2.53195 5.34028,5.65287c0,3.12091 -2.39194,5.65287 -5.34028,5.65287s-5.33982,-2.53195 -5.33982,-5.65287c0,-3.12091 2.39149,-5.65287 5.33982,-5.65287z" /></g><ellipse class="balloon-inner" opacity="'+t+'" stroke="'+s+'" ry="4.16736" rx="3.95816" id="svg_6" cy="12.83264" cx="12.5" stroke-width="2" fill="'+s+'" /></g></svg><div class="pulse"></div>'},S=function(e){return'<div class="issue-preview-conflict"><div class="issue-preview-conflict-body">'+e+'</div><div class="issue-preview-conflict-enhanced"></div></div>'};return n.extend({name:"DS/Issue3DReviewV2Rsc/views/ConflictBalloon",tagName:"div",className:"issue-balloon-conflict issue-balloon-fade-in-element",setup:function(e){var t=this;t._logger=o.getLogger("DS/Issue3DReviewV2Rsc/View"),t._visualizationEvents=[],t.isSelected=!1,t.options=s.merge(e||{},t.defaultOptions)},destroy:function(){var e=this;e.isSelected=!1;for(var t=0;t<e.options.balloons.length;t++)e.stopListening(e.options.balloons[t],"onSelect"),e.stopListening(e.options.balloons[t],"onUnselect"),e.stopListening(e.options.balloons[t],"onDestroy");e._visualizationEvents.forEach((function(e){a.removeEvent(e.container,e.event,e.cb)})),e._visualizationEvents=[],null!==e._preview&&(e._preview.destroy(),e._preview=null),e.container.empty(),e.container.destroy()},render:function(){var e=this;e.container.setStyle("display","block"),e.container.setStyle("position","absolute"),e.container.setStyle("pointer-events","auto"),e.container.setStyle("left",e.options.posX),e.container.setStyle("top",e.options.posY),e.container.setStyle("z-index",1e3);var t=y(D,v,I,b),n=s.createElement("div",{class:"issue-balloon-information",html:[{tag:"span",class:"issue-counter",html:e.options.count.toString()}]});return e._createPopover(),e._subscribers(),e.balloonContainer=s.createElement("div",{class:"issue-balloon",html:[t,n]}),e.container.setContent(e.balloonContainer),e},_createPopover:function(){var e=this,t=e.options.issues,n={};n[p]=0,n[g]=0,n[m]=0,n[h]=0,n[f]=0;for(var s=0;s<t.length;s++){n[t[s].get("state")]+=1}for(var i=Object.keys(n),o="",a=0;a<i.length;a++)0!==n[i[a]]&&(o+='<span class="issue-label-'+i[a].toLowerCase()+'"></span>'+n[i[a]].toString()+" "+d.maturity[i[a].toLowerCase()]+"</br>");e._preview=new r({target:e.container,trigger:"manual",position:"right",autoHideOnClickOutside:!1,autoHide:!1,delay:{show:200,hide:200},body:S(o)})},_subscribers:function(){for(var e=this,t=0;t<e.options.balloons.length;t++)e.listenTo(e.options.balloons[t],"onSelect",(function(){e.select()})),e.listenTo(e.options.balloons[t],"onUnselect",(function(){e.options.balloons.every((function(e){return!1===e.isSelected}))&&e.unselect()})),e.listenTo(e.options.balloons[t],"onDestroy",(function(){e.options.parent._throttledRender()}));e.container.addEventListener("mouseover",(function(){e.balloonContainer.toggleClassName("hover",!0),e._preview.show()})),e.container.addEventListener("mouseleave",(function(){e.balloonContainer.toggleClassName("hover",!1),e._preview.hide()})),e._visualizationEvents=[{container:e.container,event:"onPrimaryPointerClick",cb:function(t){var n=e.options.issues.map((function(e){return e.get("id")})),s=t.from[w].event.ctrlKey;e.isSelected&&s?e.options.manager.unselect({ids:n,publish:!0}):e.options.manager.select({ids:n,publish:!0,unselectAll:!s})}},{container:e.container,event:"onPrimaryPointerDoubleClick",cb:function(t){var n=e.options.issues.map((function(e){return e.get("id")}));e.options.manager.select({ids:n,publish:!0,unselectAll:!t.from[w].event.ctrlKey}),e.options.manager.dispatchEvent("onInspect")}}],e._visualizationEvents.forEach((function(e){a.addEvent(e.container,e.event,e.cb)})),e.container.addEventListener("contextmenu",(function(t){t.preventDefault(),t.stopPropagation();var n=e.options.issues.map((function(e){return e.get("id")}));e.options.manager.select({ids:n,publish:!0,unselectAll:!0})})),l.getWUXContextualMenu().addEventListener(e.container,{callback:function(){return l.getContextualMenu()}})},select:function(){this.isSelected=!0,this.balloonContainer.toggleClassName("selection",!0)},unselect:function(){this.isSelected=!1,this.balloonContainer.toggleClassName("selection",!1)}})})),define("DS/Issue3DReviewV2Rsc/collections/Issues",["UWA/Class/Collection","DS/Logger/Logger","DS/Issue3DReviewV2Rsc/models/Issue","DS/Issue3DReviewV2Rsc/utils/ModelParser","DS/IssueComponents/utils/Utils","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","DS/IssueCommon/utils/Utils"],(function(e,t,n,s,i,o,r,a,l){"use strict";return e.extend({name:"DS/Issue3DReviewV2Rsc/collections/Issues",model:n,comparator:"name",_logger:null,_nodes:{},_paths:{},_neutralNodes:{},_reportedNodes:{},setup:function(e,n){var s=this;for(var i in s._logger=t.getLogger(s.name),s._logger.debug("Initializing the issue collection"),a.start(s.name+" setup"),s.addEvents({onRemove:s._onRemove,onAdd:s._onAdd,onReset:s._onReset},s),s._nodes=n.nodes,s._paths=n.paths,s._neutralNodes={},n.nodes)n.nodes.hasOwnProperty(i)&&(s._neutralNodes[i]=n.nodes[i]);return s._reportedNodes={},a.end(s.name+" setup"),s},fetch:function(e){var t=this;t._logger.info("Fetching all issues..."),a.start(t.name+" fetch");var n=o.get("widget")||window.widget,s=n.getValue("filter");!0===i.isJson(s)?(s=JSON.parse(s),n.getPreference("organizationFilter").value||(s.reported=!1,s.responsible=!1,n.setValue("filter",JSON.stringify(s)))):s={},e.filter=s,r.issues.filter({version:"2.0",data:{filter:s}}).then((function(n){var s=n.body,i=[];t._logger.debug("Issues fetched");for(var o=[],r=0;r<s.length;r++)for(var c=0;c<s[r].reportedAgainst.length;c++){var u=s[r].reportedAgainst[c].physicalId;u.includes("i3dx")&&o.push(u)}o=[...new Set(o)],t.retrieveFetchData(o).then((e=>{if(Array.isArray(e.body.results)){let t={};e.body.results.forEach((e=>{var n="",s="",i="";e.attributes.forEach((e=>{"ds6w:dataSource"==(UWA.is(e.name,"string")?e.name.replace("ds6w:what/","").replace("ds6w:when/","").replace("ds6w:who/",""):e.name)&&(i=e.value)})),e.attributes.forEach((e=>{switch(UWA.is(e.name,"string")?e.name.replace("ds6w:what/","").replace("ds6w:when/","").replace("ds6w:who/",""):e.name){case"resourceid":""==n&&(n=e.value);break;case"ds6w:identifier":""==n&&"r2vsurvey"!=i&&(n=e.value);break;case"ds6w:i3dx":s=e.value}})),t[s]=n})),s.forEach((e=>{var n=[];Array.isArray(e.reportedAgainst)&&(e.reportedAgainst.forEach((e=>{if(t[e.physicalId]){var s=[];s.push(t[e.physicalId]),e.path=s,e.i3dx=e.physicalId,e.physicalId=t[e.physicalId]}n.push(e)})),e.reportedAgainst=n)}))}})).catch((function(e){})).finally((function(){for(var n=0;n<s.length;n++)for(var o=0;o<s[n].reportedAgainst.length;o++){t.getNodesById(s[n].reportedAgainst[o].physicalId).nodes.length>0&&i.push(s[n])}e.updateContentsOfIssues(i).then((function(){t.reset(i,{parse:!0}),e&&"function"==typeof e.onComplete&&e.onComplete(i),e.filterChange&&(l.cloudProbeUtils.sendFilterIssue3DReviewTrackerEvent({filter:e.filter,noOfIssues:i.length}),l.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"FilterIssue3DReview"}}))})),a.end(t.name+" fetch")}))})).catch((function(n){t._logger.error("Fetch issues failed"),e&&"function"==typeof e.onFailure&&e.onFailure(n),a.end(t.name+" fetch")}))},retrieveFetchData:function(e){var t=this;return new Promise(((n,s)=>{var i=parseInt(e.length/1e4);e.length/1e4>parseInt(e.length/1e4)&&i++;const o=[];t.results=[];for(let n=1;n<=i;n++){var a=e.map((function(e,t){if(t>=1e4*(n-1)&&t<1e4*n)return{physicalId:e}})).filter((function(e){return void 0!==e}));let i=r.fetch({data:{objects:a}}).then((function(e){t.results.push(...e.body.results)})).catch((function(e){s(e)}));o.push(i)}Promise.all(o).then((function(){let e={body:{results:t.results}};n(e)}))}))},parse:function(e,t){var n=this;return n._logger.debug("Parsing issues..."),a.start(n.name+" parse"),e=s.parse(e,t),a.end(n.name+" parse"),e},getNodes:function(){return this._nodes},getNodesById:function(e){var t=[],n=this._paths[e];if(n&&n.length>0)for(var s=0;s<n.length;s++)t.push(this._nodes[n[s].join(",")]);return{nodes:t,paths:n}},getNeutralNodes:function(){return this._neutralNodes},getReportedNodes:function(){return this._reportedNodes},setNodeAsReported:function(e){var t=this,n=e.split(","),s=n[n.length-1],i=t._paths[s];if(i&&i.length>0)for(var o=0;o<i.length;o++){var r=i[o].join(",");r.includes(e)&&(delete t._neutralNodes[r],t._reportedNodes[r]=t._nodes[r])}},setNodeAsNeutral:function(e){var t=this,n=e.split(","),s=n[n.length-1],i=t._paths[s];if(i&&i.length>0)for(var o=0;o<i.length;o++){var r=i[o].join(",");r.includes(e)&&(delete t._reportedNodes[r],t._neutralNodes[r]=t._neutralNodes[r])}},_onRemove:function(){},_onAdd:function(){},_onReset:function(){}})})),define("DS/Issue3DReviewV2Rsc/views/BalloonMerger",["UWA/Class","UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/CoreEvents/Events","DS/Logger/Logger","DS/Issue3DReviewV2Rsc/views/ConflictBalloon","DS/IssueCommon/utils/Utils","DS/IssueServices/Contexts","DS/IssueServices/utils/Performance","i18n!DS/Issue3DReviewV2Rsc/assets/nls/Issue3DReview","css!DS/Issue3DReviewV2Rsc/Issue3DReviewV2Rsc.css"],(function(e,t,n,s,i,o,r,a,l){"use strict";var c={X:25,Y:45},u=1e3;return n.extend({name:"DS/Issue3DReviewV2Rsc/views/BalloonMerger",_logger:null,manager:null,conflictBalloons:[],visualizationEventToken:null,defaultOptions:{manager:null},setup:function(e){var t=this;return t._logger=o.getLogger("DS/Issue3DReviewV2Rsc/View"),t._parent(e),t.manager=t.getOption("manager"),t.conflictBalloons=[],t._throttledRender=a.throttle(t.render.bind(t),u),t.visualizationEventToken=i.subscribe({event:"/VISU/"},(function(e){if("@onViewpointEndMove"===e.eventType)t.isRendering=!0,setTimeout((()=>{t._throttledRender({})}),1e3);else if("@onViewpointChange"===e.eventType){if(!t.isRendering)for(var n=0;n<t.conflictBalloons.length;n++)t.conflictBalloons[n].hide();t.isRendering=!0,t._throttledRender({})}})),t},render:function(){var e=this,t=l.get("widget")||window.widget;if(e.isRendering=!0,e.clean(),s.is(e.manager)&&s.is(e.manager.inspector)&&!0!==e.manager.inspector.isInspected()){var n={dom:t.body.getElement("#divCss2DElement"),width:0,height:0};if(s.is(n.dom)){n.width=n.dom.getDimensions().width,n.height=n.dom.getDimensions().height;var i=n.dom.getElements(".issue-balloon:not(.issue-balloon-temporary)");if(i.length>0){for(var o=[],a=0;a<i.length;a++){var u=i[a],d=u.getParent().getPosition().x,p=u.getParent().getPosition().y;if(!(d<0||d>n.width)||!(p<0||p>n.height)){var g={markerId:u.getData("markerId"),absX:d,absY:p,gridX:Math.round(d/c.X),gridY:Math.round(p/c.Y)};o.push(g)}}for(var m=o.reduce((function(e,t){var n=t.gridX+";"+t.gridY;return e.hasOwnProperty(n)||(e[n]=[]),e[n].push(t),e}),{}),h=Object.keys(m),f=0;f<h.length;f++){var v=m[h[f]];if(v=e.removeDuplicateIssues(v),(v=e.removeDuplicateIssues(v)).length>1){for(var D={x:0,y:0},I=0,b=[],w=[],y=0;y<v.length;y++){var S=e.manager.getBalloon(v[y].markerId);null!==S&&(D.x+=v[y].absX,D.y+=v[y].absY,I++,w.push(S),b.push(S.model.get("issue")),S.disable())}if(D.x=D.x/I,D.y=D.y/I,I>0){var C=new r({parent:e,posX:D.x,posY:D.y,count:v.length,issues:b,balloons:w,manager:e.manager});C.render(),C.inject(n.dom),e.conflictBalloons.push(C)}}else if(1===v.length){var _=e.manager.getBalloon(v[0].markerId);_&&_.enable()}}}}}e.isRendering=!1},clean:function(){for(var e=this,t=0;t<e.conflictBalloons.length;t++)e.conflictBalloons[t].destroy();e.conflictBalloons=[]},destroy:function(){var e=this;e.visualizationEventToken&&(i.unsubscribe(e.visualizationEventToken),e.visualizationEventToken=null),e.clean(),e.manager=null},removeDuplicateIssues:function(e){let t={},n=[];return e.forEach((e=>{t[e.markerId.substring(0,e.markerId.length-1)]||(t[e.markerId.substring(0,e.markerId.length-1)]=!0,n.push(e))})),n}})})),define("DS/Issue3DReviewV2Rsc/utils/ViewerManipulator",["UWA/Class/Promise","UWA/Core","DS/UIKIT/Input/Button","DS/ENOFloatingPanel/ENOFloatingPanel","DS/LevelSelector/LevelSelector","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/Selection/HSOManager","DS/SceneGraphOverrides/SceneGraphOverrideSet","DS/Visualization/SceneGraphUtils","DS/Visualization/ThreeJS_DS","DS/Visualization/IdPath","DS/IssueCommon/utils/Utils","DS/Issue3DReviewV2Rsc/commandsWebAfr/CommandsManager","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Parser","DS/IssueServices/utils/Performance","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/Windows/Panel","DS/Controls/Button","i18n!DS/Issue3DReviewV2Rsc/assets/nls/Issue3DReview"],(function(e,t,n,s,i,o,r,a,l,c,u,d,p,g,m,h,f,v,D,I,b,w){"use strict";var y="DS/Issue3DReviewV2Rsc/utils/ViewerManipulator",S=0,C=27,_=!1,E=[],R=[],A=null,x=null,P=function(){return t.createElement("ul",{class:"task-manager-cancel is-ground-level"})},k=function(){return t.createElement("li",{id:"task-manager-cancel-exit",class:"task-manager-cancel home-section",html:'<span class="home-section wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-move-to-start"></span>'})},V=function(){return t.createElement("li",{id:"task-manager-cancel-info",class:"task-manager-cancel first-crumb crumbs-with-home",html:"<p>"+w.tasks.cancel+"</p><span></span>"})},T=o.getLogger(y);return{focus2:function(e){var t=e.application,n=e.toggle,s=e.neutrals,i=e.reported;if(!1===n)return E.length>0&&(E.forEach((function(e){e.resetOpacity(),A.deleteOverride(E)})),E.length=0),R.length>0&&(R.forEach((function(e){e.resetOpacity(),A.deleteOverride(E)})),R.length=0),x.removeSceneGraphOverrideSet(A),A=null,t.getViewer().render(),_=!1,v.end(y+" focus"),!0;var o=m.get("component").get3DContext().controller;if(!0===_)return!1;v.start(y+" focus"),o.isColorizeActivated()&&r.displayNotification({msg:w.notifications.noFocusedViewWhenColorized,eventID:"info"}),_=!0,x=t.getViewer().getSceneGraphOverrideSetManager(),A=new l(o.getRootBag(),o.getRootBagId(),!0),x.insertSceneGraphOverrideSetAt(A,0);for(var a=Object.keys(s),c=0;c<a.length;c++){s[a[c]];var u=new d([o.getRootBagId()].concat(a[c].split(",")));(h=A.createIdPathOverride(u)).setOpacity(.15,!1),E.push(h)}for(var p=Object.keys(i),g=0;g<p.length;g++){var h;u=new d([o.getRootBagId()].concat(p[g].split(",")));(h=A.createIdPathOverride(u)).setOpacity(1,!0),R.push(h)}return t.getViewer().render(),_=!1,v.end(y+" focus"),!0},reportedAgainstDummyBalloons:[],OccurrenceSelectionInfo:{isOccurrenceSelection:!1,intermidiateLeafSelection:!1,leafId:null,leafPosition:null},occurrenceSelectionDialog:null,selectIn3D:function(e,o){var l=this,c=m.get("widget"),d=m.get("component"),v=m.get("application");m.get("component").isPickIn3DProcessing=!0,v.displayLevelSelector=!1;var I=d.get3DContext(),b=c.body.querySelector(".eno3dview");d.stopListeningToCSO(),I.root.setDefaultContextualMenuVisibility(!1);var y,_,E,R,A,x,O=null,N=null,M=null,L=null,U=t.createElement("div",{class:"task-manager-cancel-container"}),F=P(),W=k(),j=V();F.appendChild(W),F.appendChild(j),F.addEventListener("click",(function(){O()})),F.addEventListener("touchstart",(function(e){e.preventDefault(),O()})),U.appendChild(F);var B=t.createElement("div",{id:"vertical-line-select-reported"}),z=t.createElement("div",{id:"horizontal-line-select-reported"});b.appendChild(B),b.appendChild(z);var H=null,K=null;return y=function(){null===M&&!0!==L&&(B.setStyle("display","initial"),z.setStyle("display","initial"))},_=function(e){if(null===M&&!0!==L){var t=e.offsetX||e.layerX,n=e.offsetY||e.layerY;void 0!==t&&void 0!==n||e.targetTouches[0]&&(t=e.targetTouches[0].clientX-e.currentTarget.getOffsets().x,n=e.targetTouches[0].clientY-e.currentTarget.getOffsets().y),B.setStyle("left",t),z.setStyle("top",n);var s=I.viewer.getMousePosition(new u.Vector2(t,n)),i=I.viewer.pick(s,"primHybrid",!0);return i.position&&i.path.length?(B.setStyle("background-color","#57B847"),z.setStyle("background-color","#57B847"),H=i):(B.setStyle("background-color","#E87B00"),z.setStyle("background-color","#E87B00"),H=null),{x:t,y:n}}},E=function(){null===M&&!0!==L&&(B.setStyle("display","none"),z.setStyle("display","none"),H=null)},O=function(e){e&&(e.stopPropagation(),e.preventDefault()),H=null,N(!0)},A=function(e){e.keyCode===C&&document.activeElement===e.target&&(H=null,N(!0))},R=function(t){if(null===M&&!0!==L){var o=_(t);if(H&&H.position&&H.path.length){var u=function(){1==l.OccurrenceSelectionInfo.intermidiateLeafSelection&&(l._intersectionForOccurrenceSelection=H),1==l.OccurrenceSelectionInfo.isOccurrenceSelection&&(H=l._intersectionForOccurrenceSelection);var n={x:H.position.x,y:H.position.y,z:H.position.z},s=H.path[S];if(K=(K=(K="CGR"==s.getLastElement().name?s.getParentPath():s).getParentPath()).getParentPath(),K=I.controller.buildArrayFromPath(K),1==l.OccurrenceSelectionInfo.isOccurrenceSelection&&(s=m.get("component").get3DContext().root.unstreamPath(K)),1==l.OccurrenceSelectionInfo.isOccurrenceSelection){K.splice(K.indexOf(l.OccurrenceSelectionInfo.leafId)+1,K.length-1);var c=K[K.length-1],d=m.get("component").getManager().getNodesById(c),g={};l.convertAbsoluteToRelativePosition(K,n,c).then((function(e){c=K.join(),g[c]={x:e.position.x,y:e.position.y,z:e.position.z,balloons:[]},l.addReportedAgainstDummyBalloons(c,g,d)}))}var v=[],y=!1,C="",_=function(e){if(e&&e.externalPath.length>0&&e.getLastElement()){var n=e.getLastElement();1==l.OccurrenceSelectionInfo.isOccurrenceSelection&&(n.modelIdentification==l.OccurrenceSelectionInfo.leafId&&(y=!0),n.userData&&(C=n.userData.type)),n.userData&&n.userData.type&&1==m.get("R2VMode")&&v.push({pathElement:e,event:t,objectType:C}),D.isReference(n)&&D.getNodeID(n)&&(1==l.OccurrenceSelectionInfo.isOccurrenceSelection&&1==y||0==l.OccurrenceSelectionInfo.isOccurrenceSelection)&&v.push({pathElement:e,event:t,objectType:C}),_(e.getParentPath())}};1==l.OccurrenceSelectionInfo.isOccurrenceSelection&&(s=m.get("component").get3DContext().root.unstreamPath(K),K.splice(K.indexOf(l.OccurrenceSelectionInfo.leafId)+1,K.length-1)),_(s);var E=function(t){try{var s=t.pathElement,o=I.controller.buildArrayFromPath(s),a=D.getNodeID(t.pathElement.getLastElement()),c="";(a.length>32||D.isTileSetNode(t.pathElement.getLastElement()))&&(c=D.getNodeI3DX(t.pathElement.getLastElement()));var d=null,p=v[v.length-1].pathElement.getLastElement(),g=D.getNodeID(p);g!==a&&(d=g);var h=m.get("component").getManager().getNodesById(a);if(p.userData)var f=p.userData.type;var b={};l.convertAbsoluteToRelativePosition(o,n,a).then((function(t){if(b[a]={x:t.position.x,y:t.position.y,z:t.position.z,balloons:[]},1==l.OccurrenceSelectionInfo.intermidiateLeafSelection)return l.OccurrenceSelectionInfo.leafId=a,l.OccurrenceSelectionInfo.leafPosition=b,l.OccurrenceSelectionInfo.isOccurrenceSelection=!0,l.OccurrenceSelectionInfo.intermidiateLeafSelection=!1,!0===L&&(i.destroyView(),L=!1),l.setLeafReferenceForOccurrence(),void u();N(!1),m.get("component").isPickIn3DProcessing=!1,e(a,b,h,d,f,c)}))}catch(e){T.error(e),r.displayNotification({msg:w.notifications.notValidReportedAgainst,eventID:"info"})}};if(0===v.length)T.error(new Error("no proper path found.")),r.displayNotification({msg:w.notifications.notValidReportedAgainst,eventID:"info"});else if(1===v.length){var R={pathElement:v[0].pathElement};E(R),setTimeout((function(){l.removeReportedAgaistDummyBalloons()}),500)}else{var A=b,x={positionX:o?o.x+5:A.offsetWidth/2,positionY:o?o.y-5:A.offsetHeight/2,uiFrame:A,getLevels:function(e){var t=v.map((function(e){var t=e.pathElement.getLastElement();return D.getNodeID(t)}));return h.fetch({data:{objects:t.map((function(e){return{physicalId:e}}))},onComplete:function(t){var n=t.body,s={};if("results"in n)for(var i=0;i<n.results.length;i++){var o=f.parseFetchResponse(n.results[i]);s[o.value.physicalId]=o.value}for(var r=0;r<v.length;r++){var a=v[r].pathElement.getLastElement(),l=D.getNodeID(a);v[r].name=s[l]?s[l].title:"",v[r].icon=s[l]?s[l].typeIcon:""}e(v)},onFailure:function(t){T.warn("Fetching attributes for LevelSelector failed.",t),e(v)}}),v},onHover:function(e){1==l.OccurrenceSelectionInfo.isOccurrenceSelection?function(e){try{var t=e.pathElement,s=(I.controller.buildArrayFromPath(t),D.getNodeID(e.pathElement.getLastElement())),i=K[K.length-1],o=m.get("component").getManager().getNodesById(i),a=l.calculateReferenceInstanceOccurrencePath(K,s),c={};l.convertAbsoluteToRelativePosition(K,n,i).then((function(e){i=a.join(),c[i]={x:e.position.x,y:e.position.y,z:e.position.z,balloons:[]},l.removeReportedAgaistDummyBalloons(),l.addReportedAgainstDummyBalloons(i,c,o)}))}catch(e){T.error(e),r.displayNotification({msg:w.notifications.notValidReportedAgainst,eventID:"info"})}}(e):(a.empty(),a.add(e))},onLeave:function(){l.removeReportedAgaistDummyBalloons()},onSelect:function(t){l.removeReportedAgaistDummyBalloons(),1==l.OccurrenceSelectionInfo.isOccurrenceSelection?function(t){try{l.removeReportedAgaistDummyBalloons();var s=t.pathElement,i=(I.controller.buildArrayFromPath(s),D.getNodeID(t.pathElement.getLastElement())),o=K[K.length-1],a=null,c=v[v.length-1].pathElement.getLastElement(),u=D.getNodeID(c);u!==o&&(a=u);var d=m.get("component").getManager().getNodesById(o),g=l.calculateReferenceInstanceOccurrencePath(K,i);if(c.userData)var h=c.userData.type;var f={};l.convertAbsoluteToRelativePosition(K,n,o).then((function(t){o=g.join(),f[o]={x:t.position.x,y:t.position.y,z:t.position.z,balloons:[]},N(!1),m.get("component").isPickIn3DProcessing=!1,e(o,f,d,a,h)})),p.cloudProbeUtils.sendI3DRCommandsTrackerEvent({options:{pd1:"Issue",pd2:"3DViewer",pd3:"Issue3DReviewToolbar",pd4:"PickAffectedItemsOccurrenceUsingSelector",pd5:"Issue/3DViewer/Issue3DReviewToolbar/PickAffectedItemsOccurrenceUsingSelector"}})}catch(e){T.error(e),r.displayNotification({msg:w.notifications.notValidReportedAgainst,eventID:"info"})}}(t):E(t)}};0===i.createView(x)?L=!0:T.error(new Error("Unexpected error during LevelSelector instantiation."))}};"touchstart"===t.type?(t.preventDefault(),M=new s({animate:!0,autocenter:!0,closable:!0,limitParent:!0,overlay:!0,resizable:!0,visible:!0,className:"confirm-select-in-3d-dialog",title:w.selectIn3D.confirmTitle,header:null,body:w.selectIn3D.confirmBody,footer:[new n({value:w.selectIn3D.confirmOK,className:"primary",events:{onClick:function(){u(),setTimeout((function(){M.destroy(),M=null}),100)}}}),new n({value:w.selectIn3D.confirmCancel,className:"default",events:{onClick:function(){setTimeout((function(){M.destroy(),M=null}),100)}}})],events:{onClose:function(){setTimeout((function(){M.destroy(),M=null}),100)}}}).inject(c.body)):u()}}},b.ontouchstart=R,x=function(e){e.preventDefault(),e.stopPropagation()},b.addEventListener("mouseenter",y),b.addEventListener("mousemove",_),b.addEventListener("mouseleave",E),b.addEventListener("click",R),b.addEventListener("touchstart",R),b.addEventListener("touchend",x),b.addEventListener("touchmove",x),b.addEventListener("contextmenu",O),document.addEventListener("keydown",A),N=function(e,t){l.removeReportedAgaistDummyBalloons(),l.occurrenceSelectionDialog&&(l.occurrenceSelectionDialog.hide(),l.occurrenceSelectionDialog=null,setTimeout((()=>{var e=document.getElementsByClassName("wux-menu wux-menu-mouse");e.length>0&&e[0].remove()}),10)),v.displayLevelSelector=!0,B.destroy(),z.destroy(),b.removeEventListener("mouseenter",y),b.removeEventListener("mousemove",_),b.removeEventListener("mouseleave",E),b.removeEventListener("click",R),b.removeEventListener("touchstart",R),b.removeEventListener("touchend",x),b.removeEventListener("touchmove",x),b.removeEventListener("contextmenu",O),document.removeEventListener("keydown",A),b.ontouchstart=null,null!==M&&(M.destroy(),M=null),!0===L&&(i.destroyView(),L=!1),d.listenToCSO(),I.root.setDefaultContextualMenuVisibility(!0),g.enableAll(),U.destroy(),a.empty(),e&&o&&o()},1==l.OccurrenceSelectionInfo.intermidiateLeafSelection&&l.createOccurrenceSelectionDialog(N),N},_addBalloon:function(e,t,n,s){m.get("component").utils.createBalloon({id:t,position:e,path:n,color:"red",parent:this,temporary:!0}).then((function(e){s.call(e)}))},addReportedAgainstDummyBalloons:function(t,n,s){for(var i=this,o=[],r=t.split(","),l=0;l<s.nodes.length;l++){if(s.paths[l].toString().includes(r.toString())){var c=s.paths[l].filter((e=>!r.includes(e)));c.push(r[0]),c={pathElement:m.get("component").get3DContext().root.unstreamPath(c)},a.add(c),o.push(new e((function(e){i._addBalloon(n[t],t,s.paths[l],(function(){i.reportedAgainstDummyBalloons.push(this),e()}))})))}}},removeReportedAgaistDummyBalloons:function(){var e=this;a.empty();for(var t=0;t<e.reportedAgainstDummyBalloons.length;t++)e.reportedAgainstDummyBalloons[t].destroy();e.reportedAgainstDummyBalloons=[]},calculateReferenceInstanceOccurrencePath:function(e,t){return[...e].splice(e.indexOf(t))},setOccurenceMode:function(e){1==m.get("R2VMode")&&(e=!1),this.OccurrenceSelectionInfo.intermidiateLeafSelection=e,this.OccurrenceSelectionInfo.isOccurrenceSelection=!1},createOccurrenceSelectionDialog:function(e){var n=this,s=new t.Element("div",{html:'<div>                            <li class="ISUListType">                                <div class="ISUNode ISUNodeSelect"></div>                                <div class="ISUConnector"></div>                                <div  class="ISUHeaderOccurenceSelection ISUSelect fonticon fonticon-location"></div>                                <div class="ISUHeaderOccurenceSelection ISUSelect">'+w.selectIn3D.selectAffectedItem+'</div>                            </li>                            <li class="ISUListType ISUSubListMargin ISUselectedReferencePlace">'+w.selectIn3D.pickUpFrom3DApplication+'</li>                            <li class="ISUListType ISUselectedOccurrencePlace">                                <div class="ISUNode ISUOccurrenceNode"></div>                                <div  class="ISUHeaderOccurenceSelection fonticon fonticon-location"></div>                                <div class="ISUHeaderOccurenceSelection">'+w.selectIn3D.selectApplicableContext+'</div>                                </li>                            <li class="ISUListType ISUSubListMargin">'+w.selectIn3D.pickUpOccurrenceFrom3DApplication+"</li>                        </div>"});new b({label:w.selectIn3D.cancel,allowUnsafeHTMLLabel:!1,onClick:function(t){t.dsModel.dialog.close(),n.occurrenceSelectionDialog=null,e(!0)}.bind(this)});this.occurrenceSelectionDialog=new I({title:w.selectIn3D.pickIn3D,immersiveFrame:m.get("component").get3DContext().controller._context.getFrameWindow().getImmersiveFrame(),content:s,resizableFlag:!1,width:270,height:150,movableFlag:!0,position:{at:"top right",my:"top right"}}),this.occurrenceSelectionDialog.addEventListener("close",(()=>{n.occurrenceSelectionDialog=null,e(!0)}));var i=this.occurrenceSelectionDialog.elements.container;i&&i.getElement(".wux-windows-window-content").addClassName("ISUDialogBackground")},setLeafReferenceForOccurrence:function(){var e=this,t=[e.OccurrenceSelectionInfo.leafId];h.fetch({data:{objects:t.map((function(e){return{physicalId:e}}))},onComplete:function(t){var n=t.body,s={};if("results"in n)for(var i=0;i<n.results.length;i++){var o=f.parseFetchResponse(n.results[i]);s[o.value.physicalId]=o}if(e.occurrenceSelectionDialog){var r='<img src="'+s[e.OccurrenceSelectionInfo.leafId].display.typeIcon+'">',a=e.occurrenceSelectionDialog.elements.container;a&&(a.getElement(".ISUselectedReferencePlace").setContent(r+" "+s[e.OccurrenceSelectionInfo.leafId].display.title),a.getElement(".ISUselectedOccurrencePlace").addClassName("ISUSelect"),a.getElement(".ISUOccurrenceNode").addClassName("ISUNodeSelect"),a.getElement(".wux-windows-window-content").addClassName("ISUDialogBackground"))}},onFailure:function(e){T.warn("Fetching attributes for occurrence dialog failed.",e),callback(levels)}})},convertAbsoluteToRelativePosition:function(t,n,s){return new e((function(e){require(["DS/Issue3DReviewV2Rsc/models/Marker"],(function(i){var o=new i({id:Date.now().toString(),name:"",title:"",state:"",description:"",path:t,node:s,path_str:t.join()}),r=o.utils.convert(o,{position:n});e(r)}))}))}}})),define("DS/Issue3DReviewV2Rsc/commandsWebAfr/Focus",["DS/PADUtils/views/PADAlert","DS/Issue3DReviewV2Rsc/utils/ViewerManipulator","DS/IssueServices/Contexts","DS/IssueCommon/utils/Utils","i18n!DS/Issue3DReviewV2Rsc/assets/nls/Issue3DReview"],(function(e,t,n,s,i){"use strict";var o=function(e){var i=n.get("component");localStorage.setItem("Issue3DReviewFocus",e),t.focus2({application:i.context.root,toggle:e,neutrals:i.getManager().getNeutralNodes(),reported:i.getManager().getReportedNodes()});try{s.cloudProbeUtils.sendI3DRCommandsTrackerEvent({options:{pd1:"Issue",pd2:"3DViewer",pd3:"Issue3DReviewToolbar",pd4:"FocusView",pd5:"Issue/3DViewer/Issue3DReviewToolbar/FocusView"}}),s.cloudProbeUtils.sendIssueFacetsTrackerEvent({options:{pd1:"Issue3DReviewToolbar"}})}catch(e){}},r=Object.create(null);return r.handlerComponent=null,r.checked=function(t,s){var r,a=n.get("component"),l=null!==a?a.getManager():null;return null===a||null===l?(e.displayNotification({msg:i.notifications.noIssuesInSession,eventID:"info"}),!0,r=!1,void n.get("pad3DViewer").getExecutionContext().getComponent(WAfrStandardComponentKey.HandlerComponent).setCheckState({id:"Focus",state:r})):a.isProcessing()?(e.displayNotification({msg:i.notifications.commandAlreadyProcessing,eventID:"info"}),void!0):(o(!0),void t())},r.unchecked=function(t,s){var r=n.get("component"),a=null!==r?r.getManager():null;return null===r||null===a?(e.displayNotification({msg:i.notifications.noIssuesInSession,eventID:"info"}),void!0):r.isProcessing()?(e.displayNotification({msg:i.notifications.commandAlreadyProcessing,eventID:"info"}),void!0):(o(!1),void t())},UWA.namespace("Issue3DReviewV2Rsc/commandsWebAfr/Focus",r)})),define("DS/Issue3DReviewV2Rsc/commandsWebAfr/ISURightSidePanel",["UWA/Class","DS/Issue3DReviewV2Rsc/utils/ISURightSidePanelUtils","DS/InformationWebAfrCmd/cmd/InformationCmd","DS/PADUtils/PADSettingsMgt","DS/Selection/CSOManager","DS/Utilities/Utils","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/utils/EditPropUtils","DS/IssueServices/Contexts","i18n!DS/PADUtils/assets/nls/PADUtils.json"],(function(e,t,n,s,i,o,r,a,l,c){"use strict";var u=e.extend({init:function(){console.log("inside init")},beginExecute:function(){widget.setValue("informationCheckStatus",!0),this.ec=l.get("pad3DViewer").getExecutionContext(),this.cmd=null,this._readOnly=!0,this._canceled=!1,this._tkAdd=null,this._tkRemove=null,this._tkEmpty=null,this.refreshOutput=null,widget.setValue("isManagerInitialize",!1),console.log("inside begin execute"),this.createInformationCmd(),this.cmd.beginExecute();const e=t.initializeFacets(this.ec.getComponent("Viewer"),this.cmd);Promise.all(e).then((()=>{this._subscribers(),t.selectionChange(this.ec.getComponent("Viewer"),this.cmd),this.subscribeToCSOEvents()}))},cancelExecute:function(){this._canceled=!0,this.cmd&&this.cmd.closePanel(),this.endExecute()},endExecute:function(){(console.log("inside end execute"),!0!==this._canceled&&this.cmd&&this.cmd.closePanel(),this.cmd=null,this.destroy(),widget.getValue("informationCheckStatus"))&&(widget.setValue("informationCheckStatus",!1),l.get("pad3DViewer").getExecutionContext().getComponent(WAfrStandardComponentKey.HandlerComponent).setCheckState({id:"ISURightSidePanel",state:!1}))},destroy:function(){delete this.ec,delete this.cmd,delete this._readOnly,i.unsubscribe(this._tkAdd),i.unsubscribe(this._tkRemove),i.unsubscribe(this._tkEmpty)},createInformationCmd:function(){this.cmd=new n({executionContext:this.ec,args:{appId:"undefined"!=typeof widget&&null!==widget?widget.getValue("appId"):"",className:"enxpropertiestab",multiselection:r.MULTISEL_NO,setEditButton:!this._readOnly,readOnly:!this._readOnly,typeOfDisplay:r.ALL,selectionType:r.NO_SELECTION,actions:[{name:"action_close_panel",text:c.closeProperties,icon:"close",handler:()=>{this._canceled||(this._canceled=!0,this.cmd.closePanel()),this.endExecute()}}],events:{onCancel:()=>{this._canceled||(this._canceled=!0,this.cmd.closePanel()),this.endExecute()}},context:{getSelectedNodes:this.getSelectedNodes.bind(this),getSecurityContext:function(){return{SecurityContext:s.getSetting("pad_security_ctx"),tenant:s.getSetting("x3dPlatformId")}}}}}),this.cmd.done=()=>{}},subscribeToCSOEvents:function(){const e=o.debounce((e=>{if(this.component&&this.component.isPickIn3DProcessing)return;let n=this.component&&this.component.getSelectedIssues().length>0?this.component.getSelectedIssues():i.get();if(0!==n.length){t.selectionChange(this.ec.getComponent("Viewer"),this.cmd,n);const e=[];n.forEach((n=>{const s=new Promise((e=>{let s={ID:"",relation:"",type:"",i3dx:"",getID:function(){return this.ID},getRelationID:function(){return this.relation},getType:function(){return this.type},getI3DX:function(){return n.options&&n.options.grid?n.getI3DX():t.getI3DX(n)}};const i=this;"function"!=typeof n.getID&&(n.getID=function(){return"Issue"==n.type||"Issue"==n.baseType?n.id:t.getID(i.ec.getComponent("Viewer"),this)}),"function"!=typeof n.getRelationID&&(n.getRelationID=function(){return t.getRelationID(this)}),void 0===n.type&&(n.options&&n.options.type?n.type=n.options.type:n.type=t.getType(n)),"r2vsurvey"===t.getServiceId(this.ec.getComponent("Viewer"),n)?R2VProperties.getPropModel({objectId:t.getID(this.ec.getComponent("Viewer"),n),type:t.getType(n),serviceId:t.getServiceId(this.ec.getComponent("Viewer"),n)}).then(e).catch((e=>{console.error(e)})):(s.ID=n.getID(),!0===t.isInternalJSONObject(n)?s.relation=void 0:s.relation=n.getRelationID(),s.type=n.type,e(a.getModelFromSelectedNode(s)))}));e.push(s)})),Promise.all(e).then((e=>{this.cmd.initDatas(e)})).catch((e=>{console.warn("Cannot retrieve properties model")}))}else this.cmd.initDatas([])}),100);this.refreshOutput=e,this._tkAdd=i.onPostAdd(e),this._tkRemove=i.onPostRemove(e),this._tkEmpty=i.onEmpty(e),this.ec.getComponent("Viewer").subscribe({event:"informationPanel_externalSelection"},(()=>{}))},_subscribers:function(){var e=this;this.component=l.get("component"),!e.component||null!=e.component.informationRightSidePanel&&null!=e.component.informationRightSidePanel||(e.component.informationRightSidePanel=u),(e.component&&null!=e.component.manager||null!=e.component.manager)&&(e.component.manager.listenTo(e.component.manager,"onSelect",e._onSelect.bind(e)),e.component.manager.listenTo(e.component.manager,"onUnselect",e._onUnselect.bind(e)),widget.setValue("isManagerInitialize",!0))},_onSelect:function(e){if(e){this.isIssueSelected=!0;var t=e.issue.model.get("id");if(t&&!e.isMultipleSelection){var n=[{type:"Issue",getID:function(){return t},getRelationID:function(){}}];this.refreshOutput(n)}}},_onUnselect:function(){this.isIssueSelected=!1},getSelectedNodes:function(){return t.getSelectedNodes(this.ec.getComponent("Viewer"))}});return u})),define("DS/Issue3DReviewV2Rsc/commandsWebAfr/ISURightSidePanelStart",["UWA/Core","DS/Controls/Loader","DS/PADUtils/views/PADAlert","DS/IssueServices/Contexts","DS/IssueCommon/utils/Utils","DS/Issue3DReviewV2Rsc/commandsWebAfr/ISURightSidePanel","i18n!DS/Issue3DReviewV2Rsc/assets/nls/Issue3DReview"],(function(e,t,n,s,i,o,r){"use strict";var a=Object.create(null);o=new o;return s.get("component").informationRightSidePanel=o,a.checked=function(e,t){o.beginExecute(),e()},a.unchecked=function(e,t){console.log("inside uncheck"),o.cancelExecute(),e()},e.namespace("Issue3DReviewV2Rsc/commandsWebAfr/ISURightSidePanelStart",a)})),define("DS/Issue3DReviewV2Rsc/views/Preview",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Popover","DS/UIKIT/Scroller","DS/UIKIT/Tooltip","DS/CoreEvents/Events","DS/ENOjquery/ENOjquery","DS/ENOjqueryUI/jQueryUI","DS/Logger/Logger","DS/SocialToolbar/SocialToolbar","DS/IssueTracker/IssueTracker","DS/Issue3DReviewV2Rsc/commandsWebAfr/CommandsManager","DS/Issue3DReviewV2Rsc/utils/ModelParser","DS/IssueCommon/utils/Utils","DS/IssueServices/services/IssueServices","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices","DS/IssueServices/utils/Performance","i18n!DS/Issue3DReviewV2Rsc/assets/nls/Issue3DReview","css!DS/Issue3DReviewV2Rsc/Issue3DReviewV2Rsc.css"],(function(e,t,n,s,i,o,r,a,l,c,u,d,p,g,m,h,f,v,D,I){"use strict";var b=100,w=function(e){return n.createElement("div",{class:"card",html:n.createElement("div",{class:"card-block",html:[e.header,e.image,e.content]})})},y=function(e){return n.createElement("div",{class:"card-header",html:[n.createElement("h4",{class:"card-title",html:[n.createElement("img",{class:"card-icon",src:e.icon}),n.createElement("span",{class:"card-label",html:m.getTextFromHTML(e.title)})],title:m.getTextFromHTML(e.title)}),n.createElement("div",{class:"card-owner",html:[n.createElement("div",{class:"fonticon fonticon-user"}),e.owner]}),n.createElement("h5",{class:"card-subtitle",html:m.getTextFromHTML(e.subtitle)})]})},S=function(e){var t="";return t=n.is(e.image,"object")&&n.is(e.image.url,"string")&&""!==e.image.url?n.createElement("img",{class:"issue-latest-image",src:e.image.url}):n.createElement("div",{class:"issue-latest-image-placeholder",html:'<span class="fonticon fonticon-5x fonticon-issue-type"></span>'}),n.createElement("div",{class:"card-img",html:t})},C=function(e){return""!=v.get3DSwymUrl()?n.createElement("div",{class:"second-card-block",html:[n.createElement("p",{class:"card-content",html:[e.reported,n.createElement("div",{class:"card-description",html:m.getTextFromHTML(e.description)})]}),n.createElement("div",{class:"card-extra-content",html:e.extra})]}):n.createElement("div",{class:"second-card-block"})};return t.extend({name:"DS/Issue3DReviewV2Rsc/views/Preview",tagName:"div",className:"issue-preview-container",_logger:null,domEvents:{"click .card-img":"_onClickImage","click .issue-preview-assignee":"_onClickUserIcon","click .issue-preview-owner-image":"_onClickUserIcon"},issue:null,balloon:null,comments:null,_popover:null,_firstRendering:!0,_isHovered:!1,_isFixed:!1,_closable:{element:null,tooltip:null},_visualizationEventToken:null,setup:function(e){var t=this;D.start(t.name+" setup"),t._logger=c.getLogger("DS/Issue3DReviewV2Rsc/View"),t._parent(e),t._popoverParent=n.createElement("div",{class:"issue-preview parent"}),t.issue=e.issue,t._popover=new s({className:"issue-preview",target:t.issue.container,trigger:"manual",position:"right",autoHideOnClickOutside:!1,autoHide:!1,body:"",events:{onHide:function(){t._onHide()}}}),t.addCloseButtonIfMobile(),t._firstRendering=!0,t._closable={element:null,tooltip:null},t._popover.shouldListenForScroll=!1,t.comments=new u({subjectURI:"pid:"+t.issue.model.get("id"),enableShare:!1,enableComment:!0,enableLike:!1,tenantId:v.getTenant(),commentProxyToken:{header:"X-DS-CSRFTOKEN"},serviceURL:v.get3DSpaceUrl()+"/resources","3DSwymUrl":v.get3DSwymUrl(),commentsNumberAtInit:1,enableUpload:!1}),t._subscribers(),D.end(t.name+" setup")},render:function(){var e=this;e.container.empty();var t=e.issue.model.get("primaryImage"),s=null,o=null,r=null,a=v.getUserImageElement(e.issue.model.get("owner"),!1,{cssClass:"issue-preview-owner-image"});a.setData("user",e.issue.model.get("owner").user);var l=y({icon:m.getIconByState(e.issue.model.get("state"),e.issue.model.get("type"),e.issue.model.get("iconurl")),title:e.issue.model.get("title")+" ("+e.issue.model.get("name")+")",owner:a,subtitle:I.replace(I.preview.modified,{date:m.timeSince(new Date(e.issue.model.get("modified")))})}),c=S({image:null!==t?t:""}),u=C({reported:n.createElement("div",{class:"issue-preview-reported-container",html:[n.createElement("span",{class:"fonticon fonticon-location"}),s=n.createElement("span",{class:"issue-preview-reported",html:n.createElement("div",{class:"issue-preview-reported-placeholder"})})]}),description:e.issue.model.get("description"),extra:[n.createElement("div",{class:"issue-preview-assignees",html:[n.createElement("div",{class:"fonticon fonticon-users"}),0===e.issue.model.get("assignees").length?I.preview.noAssignees:e.issue.model.get("assignees").reduce((function(e,t){var s=n.createElement("img",{src:v.getUserImage(t.user),title:m.getTextFromHTML(t.fullName)+" ("+m.getTextFromHTML(t.user)+")"});return s.setData("user",t.user),e.push(n.createElement("div",{class:"issue-preview-assignee",html:s})),e}),[])]}),n.createElement("div",{class:"fonticon fonticon-comment primary"}),o=n.createElement("span",{class:"issue-preview-nb-comments"}),r=n.createElement("div",{class:"issue-preview-comments enhanced-only",html:""})]}),d=n.createElement("div",{html:"",styles:{height:"100%",width:"100%"}});r.setContent(d);var p=new i({element:d}).inject(r);return e.comments.inject(p.getInnerElement()),e.container.setContent(w({header:l,image:c,content:u})),h.fetch({data:{objects:[{physicalId:e.balloon.model.get("physicalId")}]},onComplete:function(e){e.body.results.forEach((function(e){var t=g.parse(e,{useIndex:!0});s.setContent([n.createElement("img",{src:t.icons.length>0?t.icons[t.icons.length-1]:"",title:t.title+" ("+t.name+") "+t.revision}),n.createElement("span",{html:m.getTextFromHTML(t.title)+" ("+m.getTextFromHTML(t.name)+") "+m.getTextFromHTML(t.revision),title:m.getTextFromHTML(t.title)+" ("+m.getTextFromHTML(t.name)+") "+m.getTextFromHTML(t.revision)})])}))},onFailure:function(t){e._logger.error("Could not fetch data for %s because %s",e.balloon.model.get("physicalId"),t),s.setContent(n.createElement("div",{class:"issue-preview-reported-error",html:I.preview.errorFetch}))}}),o.setContent("..."),e._popover.removeEvent("onShow"),e._popover.addEvent("onShow",(function(){h.comments.retrieve({data:{physicalId:e.issue.model.get("id")}}).then((function(t){var n=0;try{n=t.body.result.nbComments}catch(e){n=0}e.utils.isInteger(n)||(n=0),o.setContent(I.replace(I.preview.comments,{number:n}))}))})),!0===e._firstRendering&&(e._firstRendering=!1,e._getPrimaryImage().then((function(t){n.is(t)&&n.is(t.url,"string")&&""!==t.url&&e.container.getElement("div.card-img").setContent(n.createElement("img",{class:"issue-latest-image",src:t.url}))})).catch((function(t){e._logger.error(t)}))),e},destroy:function(){var e=this;null!==e._visualizationEventToken&&r.unsubscribe(e._visualizationEventToken),e.issue=null,e.balloon=null,e.comments.destroy(),e.comments=null,e._popover.destroy(),e._popover=null,e._firstRendering=!0,null!==e._closable.tooltip&&(e._closable.tooltip.destroy(),e._closable.tooltip=null),null!==e._closable.element&&(e._closable.element.destroy(),e._closable.element=null),e._isHovered=!1,e._isFixed=!1,e._visualizationEventToken=null,e.container.empty()},refresh:function(){this.render()},show:function(e){var t=this;return!0===t.isFixed()?(t._logger.debug("Preview for issue %s (%s) is fixed, no need to show again",t.issue.model.get("title"),t.issue.model.get("name")),t):(!0===t._popover.isVisible||(t._logger.debug("Showing preview for issue %s (%s)",t.issue.model.get("title"),t.issue.model.get("name")),t.balloon=e,t._logger.debug("Balloon is reported on %s (%s)",t.balloon.model.get("title"),t.balloon.model.get("name")),t._popover.setOption("target",t.balloon.container),t._popover.getContent().getElement(".popover-arrow").setStyle("display","initial"),t._popover.show(),t._popover.updatePosition(),t._popover.setBody(t.render()),t.container.removeClassName("enhanced"),!0===t.issue.isSelected&&t.enhance()),t)},hide:function(){var e=this;if(!0===e.isFixed())return e;if(!0===e.isEnhanced())var t=setInterval((function(){!0===e.shouldHide()&&(clearInterval(t),!0===e.shouldKaboom()&&e.kaboom())}),b);else e.kaboom();return e},brake:function(){var e=this;!1===e.isFixed()?e.kaboom():e.hide()},kaboom:function(){this._popover.hide()},enhance:function(){var e=this;!0!==e.isEnhanced()&&(null===e._visualizationEventToken&&(e._visualizationEventToken=r.subscribe({event:"/VISU/"},(function(t){"@onViewpointEndMove"===t.eventType&&e._popover.updatePosition()}))),e.container.addClassName("enhanced"),e._popover.updatePosition(),e._popover.getContent().addEventListener("mouseover",(function(){e._isHovered=!0})),e._popover.getContent().addEventListener("mouseout",(function(t){for(var n=t.toElement||t.relatedTarget;n&&n.parentNode&&n.parentNode!==window;){if(n.parentNode===this||n===this)return void(n.preventDefault&&n.preventDefault());n=n.parentNode}e._isHovered=!1})),e.draggable())},draggable:function(){var e=this,t=e._popover.getContent();a(t).draggable({handle:t.getElement(".card-title"),start:function(){!0!==e._isFixed&&(e._isFixed=!0,null!==e._visualizationEventToken&&r.unsubscribe(e._visualizationEventToken),t.getElement(".popover-arrow").setStyle("display","none"),e._closable.element=n.createElement("span",{class:"issue-preview-closable",html:'<span class="fonticon fonticon-cancel"></span>',events:{click:function(){e._isFixed=!1,e.kaboom()}}}).inject(t),e._closable.tooltip=new o({target:e._closable.element,body:I.preview.close}))}})},isEnhanced:function(){return this.container.hasClassName("enhanced")},isFixed:function(){return this._isFixed},isFocused:function(){var e=document.activeElement;return function(e,t){for(var n=t.parentNode;null!==n;){if(n===e)return!0;n=n.parentNode}return!1}(this._popover.getContent(),e)},shouldHide:function(){return!this._isHovered},shouldKaboom:function(){var e=this;return null!==e._popover&&(!e.isFixed()&&!e.isFocused())},_onHide:function(){var e=this;e._isFixed=!1,e._isHovered=!1;try{null!==e._closable.tooltip&&(e._closable.tooltip.destroy(),e._closable.tooltip=null),null!==e._closable.element&&(e._closable.element.destroy(),e._closable.element=null),a(e._popover.getContent()).draggable("destroy")}catch(e){}e.container.removeClassName("enhanced")},_onClickImage:function(){this._isFixed=!1,this.kaboom(),f.get("pad3DViewer").getExecutionContext().getComponent(WAfrStandardComponentKey.HandlerComponent).executeHandler({id:"AttachmentManager"})},_onClickUserIcon:function(e){var t=e.target.getData("user");n.is(t,"string")&&v.getUserProfile(t)},_getPrimaryImage:function(){var t=this;return new e((function(e){t.issue.model.fetchPrimaryImage({onComplete:e,onFailure:function(){}})}))},_subscribers:function(){var e=this;e.listenTo(e.issue.model,"onChange",(function(){e.kaboom()}))},utils:{isInteger:function(e){return Number.isInteger?Number.isInteger(e):"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}},addCloseButtonIfMobile:function(){var e=this;e.media=d.getDeviceUsedForOperation(),"Desktop"!=e.media&&e.insertCloseButton()},insertCloseButton:function(){var e=this;e.closeButton=n.createElement("span",{class:"wux-ui-3ds-close wux-ui-3ds closeIcon",title:I.close,events:{click:function(){e.kaboom()}}});var t=e._popover.elements.container.getChildren()[0];e._popover.elements.container.insertBefore(e.closeButton,t)}})})),define("DS/Issue3DReviewV2Rsc/views/Sack",["UWA/Class","UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/CoreEvents/Events","DS/Logger/Logger","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/Issue3DReviewV2Rsc/components/ContextualMenu","DS/Issue3DReviewV2Rsc/views/Balloon","DS/Issue3DReviewV2Rsc/views/Preview","DS/IssueCommon/utils/Utils","DS/IssueServices/utils/Performance","i18n!DS/Issue3DReviewV2Rsc/assets/nls/Issue3DReview","css!DS/Issue3DReviewV2Rsc/Issue3DReviewV2Rsc.css"],(function(e,t,n,s,i,o,r,a,l,c,u,d,p){"use strict";var g="Create",m="Assign",h="Active",f="Review",v="Closed",D="#9B2C98",I="#E03400",b="#007DA3",w="#018308",y="#757575";return n.extend({name:"DS/Issue3DReviewV2Rsc/views/Sack",_logger:null,defaultOptions:{manager:null,viewer:null,window:null,controller:null},balloons:[],clones:[],linked:[],preview:null,color:"",isSelected:!1,isHovered:!1,isInspected:!1,_preventPreview:!1,setup:function(e){var t=this;p.start(t.name+" setup"),t._logger=o.getLogger("DS/Issue3DReviewV2Rsc/View"),t.options=s.merge(e||{},t.defaultOptions);var n={};n[g]=D,n[m]=I,n[h]=b,n[f]=w,n[v]=y,t.options.colors=n,t.balloons=[],t.clones=[],t.linked=[],t.preview=null,t.isSelected=!1,t.isHovered=!1,t.preview=new u({issue:t}),t._subscribers(),p.end(t.name+" setup")},render:function(e){var t=this;p.start(t.name+" render"),t._logger.debug("Rendering issue %s (%s)",t.model.get("title"),t.model.get("name")),e=e||{},t.color=t.options.colors[t.model.get("state")];for(var n=t.model.get("markers"),s=0;s<n.length;s++)t.add(n.at(s),e);return p.end(t.name+" render"),t},destroy:function(){var e=this;e.stopListening(e,"onMouseOver"),e.stopListening(e,"onMouseLeave"),e.stopListening(e,"onClick"),e.stopListening(e,"onDoubleClick"),e.stopListening(e,"onContextMenu"),e.stopListening(e.model,"onChange"),e.unselect();for(var n=[],s=0;s<e.balloons.length;s++)n.push(e.balloons[s].destroy());return t.all(n).then((function(){e.preview.destroy(),e.preview=null,e.balloons=[],e.clones=[],e.isSelected=!1,e.options.manager.getCollection().remove(e.model,{internal:!0}),e.model=null,e.options={}}))},add:function(e){var t=this;p.start(t.name+" add"),t._logger.debug("Adding balloon %s %s %s from issue %s (%s)",e.get("type"),e.get("name"),e.get("revision"),t.model.get("title"),t.model.get("name"));var n=t.options.manager;e.set("color",t.color,{silent:!0});var s=new c({model:e,parent:t,viewer:t.options.viewer,window:t.options.window,controller:t.options.controller}).render();return l.getWUXContextualMenu().addEventListener(s.container,{callback:function(){return l.getContextualMenu()}}),t.balloons.push(s),n.registerBalloon(e.get("id"),s),p.end(t.name+" add"),!0},remove:function(e){var t=this,n=t.options.manager;t.utils.unhighlightMarker.call(t,e);for(var s=0;s<t.balloons.length;s++)t.balloons[s].model.get("path_str")===e.get("path_str")&&(t._logger.debug("Removing balloon %s from issue %s (%s)",t.balloons[s].model.get("id"),t.model.get("title"),t.model.get("name")),t.balloons[s].destroy(),t.balloons.splice(s,1),n.deregisterBalloon(e.get("id")));return 0===t.balloons.length?(t.destroy(),null):t},select:function(){var e=this;e._logger.debug("Selecting issue %s",e.model.get("title")),e.isSelected=!0;for(var t=0;t<e.balloons.length;t++)e.balloons[t].select();return e.utils.highlight(e),e.preview.enhance(),e},unselect:function(){var e=this;e._logger.debug("Unselecting issue %s",e.model.get("title")),e.isSelected=!1;for(var t=0;t<e.balloons.length;t++)e.balloons[t].unselect();return e.utils.unhighlight(e),e.preview.brake(),e},show:function(){for(var e=[],n=0;n<this.balloons.length;n++)e.push(this.balloons[n].show());return t.all(e)},hide:function(){for(var e=[],n=0;n<this.balloons.length;n++)e.push(this.balloons[n].hide());return t.all(e)},_subscribers:function(){var e=this;e.listenTo(e,"onMouseOver",e._onMouseOver),e.listenTo(e,"onMouseLeave",e._onMouseLeave),e.listenTo(e,"onClick",e._onClick),e.listenTo(e,"onDoubleClick",e._onDoubleClick),e.listenTo(e,"onContextMenu",e._onContextMenu),e.listenTo(e.model,"onChange",e._onChange),e.listenTo(e.model.get("markers"),"onRemove",e._onRemoveMarker),e.listenTo(e.model.get("markers"),"onAdd",e._onAddMarker),e.listenTo(e,"onChange:position",e._onChangePosition)},_onMouseOver:function(e){var t=this;t._logger.debug("Issue %s mouseover with %s balloons",t.model.get("title"),t.balloons.length),t.isHovered=!0;for(var n=0;n<t.balloons.length;n++)t.balloons[n].over();var s=e.object;e.object.container=e.balloon,!0!==t._preventPreview&&t.preview.show(s)},_onMouseLeave:function(){var e=this;e._logger.debug("Issue %s mouseout with %s balloons",e.model.get("title"),e.balloons.length),e.isHovered=!1;for(var t=0;t<e.balloons.length;t++)e.balloons[t].out();e.preview.hide()},_onChangePosition:function(e){var t=this.model.get("markers");null!==t&&t.forEach((function(t){t.get("physicalId")===e.physicalId&&t.get("id")!==e.id&&(t.set("position",t.utils.getPosition(t,e.model.get("original"))),t.set("original",e.model.get("original")))}))},_onClick:function(e){var t=this;return t._logger.debug("Issue %s clicked with multiple selection to %s",t.model.get("title"),e.isMultipleSelection),t._onMouseOver(e),t.preview.enhance(),!0===t.isSelected&&!0===e.isMultipleSelection?(t.unselect(),t.options.manager.dispatchEvent("onUnselect",{id:e.id,issue:t,publish:!0}),!1):(t.options.manager.dispatchEvent("onSelect",{id:e.id,issue:t,isMultipleSelection:e.isMultipleSelection}),t.select(),!0)},_onDoubleClick:function(e){var t=this;return t._preventPreview=!0,t.preview.brake(),!0!==t.isSelected&&(t.options.manager.dispatchEvent("onSelect",{id:e.id,issue:t,isMultipleSelection:e.isMultipleSelection}),t.select()),t.options.manager.dispatchEvent("onInspect",{id:e.id}),t._preventPreview=!1,!0},_onContextMenu:function(e){var t=this;t.preview.brake(),t._logger.debug("Issue %s context menu with multiple selection to %s",t.model.get("title"),e.isMultipleSelection),!1===t.isSelected&&(t.select(),t.options.manager.dispatchEvent("onSelect",{id:e.id,issue:t,isMultipleSelection:e.isMultipleSelection}))},_onChange:function(){var e=this;e._logger.debug("The model of the issue %s (%s) changed",e.model.get("title"),e.model.get("name")),e.color=e.options.colors[e.model.get("state")];var t=e.model.get("markers");null!==t&&t.forEach((function(t){t.set({color:e.color})})),e.model.fetchPrimaryImage({onComplete:function(){}})},_onRemoveMarker:function(e,t){var n=this;n._logger.debug("The balloon %s %s %s from issue %s (%s) has been removed",e.get("type"),e.get("name"),e.get("revision"),n.model.get("title"),n.model.get("name")),n.remove(e,t)},_onAddMarker:function(e){var t=this;t._logger.debug("The balloon %s %s %s for issue %s (%s) has been added",e.get("type"),e.get("name"),e.get("revision"),t.model.get("title"),t.model.get("name")),t.add(e)},utils:{highlight:function(e){if(e.hasOwnProperty("model")&&null!==e.model){var t=[];e.model.get("markers").forEach((function(e){var n=e.get("path");t.push(n)}));var n=[];t.forEach((function(t){if(t.length){var s=e.options.controller.buildPathFromArray(t);s&&n.push({pathElement:s})}})),r.add(n),a.add(n)}},unhighlight:function(e){if(e.hasOwnProperty("model")&&null!==e.model){var t=[];e.model.get("markers").forEach((function(e){var n=e.get("path");t.push(n)}));var n=[];t.forEach((function(t){if(t.length){var s=e.options.controller.buildPathFromArray(t);s&&n.push({pathElement:s})}})),r.remove(n),a.remove(n)}},unhighlightMarker:function(e){var t=this,n=[],s=e.get("path");n.push(s);var i=[];n.forEach((function(e){if(e.length){var n=t.options.controller.buildPathFromArray(e);n&&i.push({pathElement:n})}})),r.remove(i),a.remove(i)}}})})),define("DS/Issue3DReviewV2Rsc/views/Manager",["UWA/Class","UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/UIKIT/Mask","DS/UIKIT/Popover","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/PlatformAPI/PlatformAPI","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/Visualization/SceneGraphUtils","DS/Issue3DReviewV2Rsc/collections/Issues","DS/Issue3DReviewV2Rsc/commandsWebAfr/CommandsManager","DS/Issue3DReviewV2Rsc/models/Issue","DS/Issue3DReviewV2Rsc/views/BalloonMerger","DS/Issue3DReviewV2Rsc/views/Inspector","DS/Issue3DReviewV2Rsc/views/Sack","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","DS/IssueServices/Contexts","text!DS/Issue3DReviewV2Rsc/assets/Issue3DReview.PADSettings.json","i18n!DS/Issue3DReviewV2Rsc/assets/nls/Issue3DReview"],(function(e,t,n,s,i,o,r,a,l,c,u,d,p,g,m,h,f,v,D,I,b,w,y){"use strict";var S,C,_,E,R="maturityGraph",A=100,x=n.extend({name:"DS/Issue3DReviewV2Rsc/views/Manager",_logger:null,defaultOptions:{component:null,context:null,roots:[],callback:null},component:null,nodes:{},paths:{},collection:null,inspector:null,balloonMerger:null,_issues:[],_mapper:{},_balloons:{},_linker:{},_selectedIssues:{},_subscriberTokens:[],setup:function(e){var t=this;b.start(t.name+" setup"),t._parent(e),t.settings=JSON.parse(y),t.isAnyFilterSelected=!1,t._logger=a.getLogger("DS/Issue3DReviewV2Rsc/View"),t._logger.debug("Initializing the manager..."),t.component=e.component;var n=t.utils.parseChildren2(e.context.controller);t.nodes=n.nodes,t.paths=n.paths,t.collection=new g([],{nodes:t.nodes,paths:t.paths}),t.inspector=new v({manager:t.getManager()}),t.balloonMerger=new f({manager:t.getManager()}),t._issues=[],t._mapper={},t._balloons={},t._linker={},t._selectedIssues={};var s=Object.keys(t.nodes),i=Object.keys(t.paths);t.isAnyFilterSelected=t.isFilteringRequestEligible();var o=!1;t.settings.hideNoFilterSelectionPreference&&t.isAnyFilterSelected?o=!0:t.settings.hideNoFilterSelectionPreference||(o=!0),s.length>0&&i.length>0&&o?t.collection.fetch({updateContentsOfIssues:function(e){return t.updateAffectedItemContextResolvedItem(e)},onComplete:function(e){t.render(),null!==t.getOption("callback")&&t.getOption("callback")(e)},filterChange:e.filterChange}):null!==t.getOption("callback")&&t.getOption("callback")([]),t._subscriberTokens=[],t._subscribers(),c.subscribe("Lifecycle.Modification",(function(e){var n=JSON.parse(e).Refresh.modified;if(Array.isArray(n)){const e=n.map((e=>e.physicalid));t.refreshIssuesById({ids:e}).then((function(){t.optimizeBalloonVisualization()}))}})),b.end(t.name+" setup")},isFilteringRequestEligible:function(){let e=w.get("filter");var t=!1;if(e){let n=e.elements.menu.items.filter((e=>{if(e.selected)return t=!0,e.name})).map((e=>e.name));1==n.length&&"closed"==n[0]&&this.settings.hideNoFilterSelectionPreference&&(t=!1)}return t},render:async function(){var e=this;if(e._logger.debug("%s issue(s) to be displayed",e.collection.length),e.collection.forEach((function(t){var n=new D({manager:e,model:t,viewer:e.getOption("context").viewer,controller:e.getOption("context").controller,window:e.getOption("context").window}).render();e._issues.push(n),e._mapper[t.get("id")]=n})),e.component&&e.component.informationRightSidePanel&&e.component.informationRightSidePanel._subscribers(),!w.get(R)){let e=await I.issues.getIssueMaturityGraph({});if(null!=e&&""!==e&&""!==e.body){var t=e.body[R];w.add(R,t)}}return e},destroy:function(){var e=this;e._logger.info("Destroying the manager..."),e.stopListening(e,"onSelect"),e.stopListening(e,"onUnselect"),e.stopListening(e,"onInspect"),e.stopListening(e.collection,"onReset"),e.stopListening(e.collection,"onRemove"),e.stopListening(e.collection,"onAdd"),e._subscriberTokens.forEach((function(e){u.unsubscribe(e)})),e._subscriberTokens=[],e.unselectAll({publish:!1}),e.inspector.destroy(),e.inspector=null,e.balloonMerger.destroy(),e.balloonMerger=null;for(var n=[],s=0;s<e._issues.length;s++)n.push(e._issues[s].destroy());return e.component=null,e.nodes={},e.paths={},t.all(n).then((function(){e.collection=null,e._issues=[],e._mapper={},e._balloons={},e._linker={},e._selectedIssues={},e._subscriberTokens=[]}))},refreshIssuesById:function(e){var n=this;b.start(n.name+" refreshIssuesById");var i=e.ids,o=[];return i.forEach((function(i){o.push(new t((function(t){var o=n.collection.get(i);if(o&&s.is(o,"object"))o.fetch({timestamp:e.timestamp,onComplete:function(e){t(e)},collection:n.collection}),o.fetchPrimaryImage({onComplete:function(){},onFailure:function(e){n._logger.error(e)}});else{var r=new h({id:i});r.fetch({timestamp:e.timestamp,add:!0,onComplete:function(e){r.get("markers")&&r.get("markers").length>0?(n.collection.add(r,{}),t(e)):r=null},collection:n.collection,parse:!0})}})))})),t.all(o)},removeIssuesById:function(e){var n=this;return e.ids.forEach((function(e){n.collection.remove(e)})),t.resolve()},show:function(){for(var e=[],n=0;n<this._issues.length;n++)e.push(this._issues[n].show());return t.all(e)},hide:function(){for(var e=[],n=0;n<this._issues.length;n++)e.push(this._issues[n].hide());return t.all(e)},optimizeBalloonVisualization:function(){s.is(this.balloonMerger)&&this.balloonMerger._throttledRender()},select:function(e){var t=this,n=e.ids,s=!0===e.unselectAll,i=!0===e.publish;!0===s&&t.unselectAll({publish:!1});for(var o=0;o<n.length;o++){var r=t._mapper[n[o]];void 0!==r&&(t._selectedIssues[n[o]]=r,r.select(),r.utils.highlight(r))}m.select(Object.keys(t._selectedIssues)),t.component.dispatchEvent("onSelect"),!0===i&&t.pushBroadcastSelect()},unselect:function(e){for(var t=this,n=e.ids,s=!0===e.publish,i=0;i<n.length;i++)!0!==e.internal&&t._selectedIssues[n[i]].unselect(),delete t._selectedIssues[n[i]];m.select(Object.keys(t._selectedIssues)),t.component.dispatchEvent("onUnselect"),!0===s&&t.pushBroadcastSelect()},unselectAll:function(e){var t=this,n=!0===e.publish;t.unselect({ids:Object.keys(t._selectedIssues),publish:n}),t._selectedIssues={}},buildBroadcastSelect:function(){var e=this;b.start(e.name+" buildBroadcastSelect");var t=[],n={};return e.getSelectedIssues().forEach((function(e){t.push([e.id]),n[e.id]={id:e.id,type:e.type,name:e.name,title:e.title}})),b.end(e.name+" buildBroadcastSelect"),{paths:t,attributes:n}},pushBroadcastSelect:(S=function(){var e=this;if(b.start(e.name+" pushBroadcastSelect"),null!==e.component){var t=e.buildBroadcastSelect();e.component.publishSelect(t),e.component.publishCompass()}b.end(e.name+" pushBroadcastSelect")},C=A,function(){var e=this,t=arguments,n=_&&!E;clearTimeout(E),E=setTimeout((function(){E=null,_||S.apply(e,t)}),C),n&&S.apply(e,t)}),inspect:function(e){return this.inspector.inspect({ids:e})},release:function(){var e=this;return e.inspector.release().then((function(){e.optimizeBalloonVisualization()}))},groupBy:function(e){return this.collection.groupBy(e)[e]},getManager:function(){return this},getCollection:function(){return this.collection},getIssues:function(){return{map:this._mapper,array:this._issues}},getNodes:function(){return this.nodes},getNodesById:function(e){return this.collection.getNodesById(e)},getNeutralNodes:function(){return this.collection.getNeutralNodes()},getReportedNodes:function(){return this.collection.getReportedNodes()},getSelectedIssues:function(){var e=this,t=[];for(var n in e._selectedIssues)if(e._selectedIssues.hasOwnProperty(n)){var s=e._selectedIssues[n].model,i={id:s.get("id"),type:s.get("type"),title:s.get("title"),name:s.get("name"),baseType:s.get("baseType"),state:s.get("state"),coOwners:s.get("coOwners")};t.push(i)}return t},getInspectedIssues:function(){return this.inspector.getInspectedIssues()},getReportedAgainstFromSelectedIssues:function(){for(var e=this.getSelectedIssues(),t=this.getIssues().map,n=[],i=0;i<e.length;i++)s.is(t[e[i].id],"object")&&(n=n.concat(t[e[i].id].model.get("reportedAgainst")));return n.reduce((function(e,t){return e.push(t.physicalId),e}),[])},registerBalloon:function(e,t){var n=this;n._balloons[e]=t,t.promiseWhileRendering.then((function(){w.get("enableOptimization")&&(w.add("enableOptimization",!1),n.optimizeBalloonVisualization())}))},deregisterBalloon:function(e){delete this._balloons[e]},getBalloon:function(e){return this._balloons.hasOwnProperty(e)?this._balloons[e]:null},_onSelect:function(e){var t=this,n=e.issue.model.get("id");if(!1===e.isMultipleSelection){var s=Object.keys(t._selectedIssues);1===s.length&&-1!==s.indexOf(n)||(t.unselectAll({publish:!1}),d.empty())}t.select({ids:[n],publish:!0,unselectAll:!1})},_onUnselect:function(e){var t=this;t.unselect({ids:[e.issue.model.get("id")]});for(var n=Object.keys(t._selectedIssues),s=0;s<n.length;s++)t._selectedIssues[n[s]].utils.highlight(t._selectedIssues[n[s]]);!0===e.publish&&t.pushBroadcastSelect()},_onInspect:function(){w.get("pad3DViewer").getExecutionContext().getComponent(WAfrStandardComponentKey.HandlerComponent).executeHandler({id:"Inspect"})},_subscribers:function(){var e=this;e.listenTo(e,"onSelect",e._onSelect),e.listenTo(e,"onUnselect",e._onUnselect),e.listenTo(e,"onInspect",e._onInspect),e._listenToCSO(),e.listenTo(e.collection,"onReset",e._onReset),e.listenTo(e.collection,"onRemove",e._onRemove),e.listenTo(e.collection,"onAdd",e._onAdd)},_listenToCSO:function(){var e=this;e._stopListeningToCSO(),e._subscriberTokens.push(u.onEmpty((function(){e.unselectAll({publish:!0})})))},_stopListeningToCSO:function(){this._subscriberTokens.forEach((function(e){u.unsubscribe(e)})),this._subscriberTokens=[]},_onReset:function(){},_onRemove:function(e,t,n){var i=this;i.unselect({ids:[e.get("id")],internal:n.internal,publish:!1}),s.is(n,"object")&&!0===n.internal||s.is(i._mapper[e.get("id")])&&i._mapper[e.get("id")].destroy();for(var o=[],r=e.get("id"),a=0;a<i._issues.length;a++)i._issues[a].model.get("id")!==r&&o.push(i._issues[a]);i._issues=o,delete i._mapper[e.get("id")]},_onAdd:function(e){var t=this;t._logger.debug("The issue %s (%s) has been added to the collection, now creating the view",e.get("title"),e.get("name"));var n=new D({manager:t,model:e,viewer:t.getOption("context").viewer,controller:t.getOption("context").controller,window:t.getOption("context").window}).render();t._issues.push(n),t._mapper[e.get("id")]=n},utils:{parseChildren2:function(e){var t={},n={};widget.setValue("isAECDataLoaded",!1);for(var s=e._model._OOCManager.getAllReferences(),i=0;i<s.length;i++){var o=s[i];o.length>32&&widget.setValue("isAECDataLoaded",!0);var r=e.getIdPathesLeadingToReference(o);n[o]=[];for(var a=0;a<r.length;a++){var l=r[a].ids;t[l]=o,n[o].push(l)}}return{nodes:t,paths:n}}},updateAffectedItemContextResolvedItem:function(e){var t=this.retriveContentIds(e);return t=[...new Set(t)],this.retriveFetchData(t).then((t=>{if(Array.isArray(t.body.results)){let n={};t.body.results.forEach((e=>{let t={};var i="",o="";e.attributes.forEach((e=>{switch(s.is(e.name,"string")?e.name.replace("ds6w:what/","").replace("ds6w:when/","").replace("ds6w:who/",""):e.name){case"resourceid":i=e.value,t.physicalId=e.value;break;case"ds6w:label":t.title=e.value;break;case"ds6w:type":t.type=e.value;break;case"ds6w:identifier":t.name=e.value,o=e.value;break;case'ds6wg:"ds6w:responsible':t.coowner=e.value?e.value:null;break;case"ds6wg:revision":t.revision=e.value;break;case"ds6w:kind":t.kind=e.value;break;case"ds6w:i3dx":t.i3dx=e.value}})),""==i?(t.physicalId=o,n[o]=t):(t.physicalId=i,n[i]=t)})),e.forEach((e=>{var t=[],s=[],i=[],o=[];Array.isArray(e.reportedAgainst)&&(e.reportedAgainst.forEach((e=>{if(n[e.physicalId]){if(e.name=n[e.physicalId].name,e.type=n[e.physicalId].type,e.title=n[e.physicalId].title,e.kind=n[e.physicalId].kind,n[e.physicalId].i3dx&&""!==n[e.physicalId].i3dx){var s=[];s.push(n[e.physicalId].physicalId),e.path=s,e.physicalId=n[e.physicalId].physicalId,e.i3dx=n[e.physicalId].i3dx}t.push(e)}})),e.reportedAgainst=t),Array.isArray(e.contexts)&&(e.contexts.forEach((e=>{n[e.physicalId]&&(e.name=n[e.physicalId].name,e.type=n[e.physicalId].type,e.title=n[e.physicalId].title,e.kind=n[e.physicalId].kind,s.push(e))})),e.contexts=s),Array.isArray(e.resolvedItems)&&(e.resolvedItems.forEach((e=>{n[e.physicalId]&&(e.name=n[e.physicalId].name,e.type=n[e.physicalId].type,e.title=n[e.physicalId].title,e.kind=n[e.physicalId].kind,i.push(e))})),e.resolvedItems=i),Array.isArray(e.resolvedBy)&&(e.resolvedBy.forEach((e=>{n[e.physicalId]&&(e.name=n[e.physicalId].name,e.type=n[e.physicalId].type,e.title=n[e.physicalId].title,o.push(e))})),e.resolvedBy=o)}))}}))},retriveContentIds:function(e){let t=[];return e.forEach((e=>{e.reportedAgainst.forEach((e=>{e.i3dx&&""!==e.i3dx?t.push(e.i3dx):t.push(e.physicalId)})),e.contexts.forEach((e=>{t.push(e.physicalId)})),e.resolvedItems.forEach((e=>{t.push(e.physicalId)})),e.resolvedBy.forEach((e=>{t.push(e.physicalId)}))})),t},retriveFetchData:function(e){var n=this;return new t(((s,i)=>{var o=parseInt(e.length/1e4);e.length/1e4>parseInt(e.length/1e4)&&o++;const r=[];n.results=[];for(let t=1;t<=o;t++){var a=e.map((function(e,n){if(n>=1e4*(t-1)&&n<1e4*t)return{physicalId:e}})).filter((function(e){return void 0!==e}));let s=I.fetch({data:{objects:a}}).then((function(e){n.results.push(...e.body.results)})).catch((function(e){i(e)}));r.push(s)}t.all(r).then((function(){let e={body:{results:n.results}};s(e)}))}))}});return x})),define("DS/Issue3DReviewV2Rsc/Component",["UWA/Class/Promise","UWA/Class/View","UWA/Core","DS/Logger/Logger","DS/PlatformAPI/PlatformAPI","DS/IssueCommon/utils/TaskManager","DS/IssueCommon/utils/Utils","DS/IssueComponents/open/Open","DS/Issue3DReviewV2Rsc/commandsWebAfr/CommandsManager","DS/Issue3DReviewV2Rsc/views/Manager","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices","DS/IssueServices/utils/Performance","DS/IssueServices/utils/Views","DS/IssueServices/services/PlatformServices","i18n!DS/Issue3DReviewV2Rsc/assets/nls/Issue3DReview","css!DS/Issue3DReviewV2Rsc/Issue3DReviewV2Rsc.css","css!DS/UIKIT/UIKIT.css"],(function(e,t,n,s,i,o,r,a,l,c,u,d,p,g,m,h){"use strict";var f="ENXISSU_AP",v="ENX3DIR_AP",D=0,I={ISU_TASK_MANAGER:"ISU_TASK_MANAGER"},b={SELECT_IN_3D:"SELECT_IN_3D",TAKE_SCREENSHOT:"TAKE_SCREENSHOT"},w=/[/\\?%*:|"<>]/g;return t.extend({name:"DS/Issue3DReviewV2Rsc/Component",_logger:null,manager:null,context:{},taskManager:null,_issues:{},_nodes:{},_temporary:[],_isProcessing:!1,_subscriberTokens:[],_tasks:{subscriberTokens:[],current:null},_timestampUpdate:0,setup:function(e){var t=this;p.start(t.name+" setup"),t._parent(e),t._logger=s.getLogger(t.name),t._logger.log("Initializing the main component..."),t.manager=null;var n=u.get("pad3DViewer");return t.context={root:n,viewer:n.getViewer(),window:n.getFrameWindow(),controller:n.getController()},t.taskManager=o,n.getViewpoint().getControl().lockZ=!1,n.getViewpoint().getControl().rotateSpeed=1,t._issues={},t._nodes={},t._filteredIssues=null,t._temporary=[],t._isProcessing=!1,t._subscriberTokens=[],t._tasks={subscriberTokens:[],current:null},t._timestampUpdate=0,t.utils._setTypesCallbackSubscribe=!1,t._subscribers(),t._subscribersTaskManager(),t},render:function(){return this},resize:function(){null!==this.manager&&this.manager.optimizeBalloonVisualization()},display:function(t,s){var i=this;return!0===i.isProcessing()?e.reject(new Error("A command is already processing, please wait")):(i._isProcessing=!0,i._logger.info("Displaying all the issues, parsing roots and instantiating manager"),new e((function(e){null!==i.manager?i.manager.destroy().then((function(){i.manager=null,e()})):e()})).then((function(){return new e((function(e){i.manager=new c({component:i,roots:t,context:i.context,filterChange:s,callback:function(){i._isProcessing=!1,i.dispatchEvent("onDisplay"),e()}});var o=i.getOption("events");i.listenTo(i.manager.getCollection(),"onAdd",(function(){o&&n.is(o.onIssuesAdded,"function")&&o.onIssuesAdded()})),i.listenTo(i.manager.getCollection(),"onRemove",(function(){o&&n.is(o.onIssuesRemoved,"function")&&o.onIssuesRemoved()}))}))})))},destroy:function(){var e=this;e._subscriberTokens.forEach((function(e){i.unsubscribe(e)})),e._tasks.subscriberTokens.forEach((function(e){i.unsubscribe(e)})),null!==e.manager&&(e.manager.getCollection().stopListening("onAdd"),e.manager.getCollection().stopListening("onRemove"),e.manager.destroy(),e.manager=null),e._timestampUpdate=0,e._subscriberTokens=[],e.utils._setTypesCallbackSubscribe=!1,e._tasks={subscriberTokens:[],current:null},e.taskManager.destroy(),e.taskManager=null},clear:function(t){var n=this;let s=u.get("pad3DViewer").getExecutionContext().getComponent(WAfrStandardComponentKey.HandlerComponent);return!0===n.isProcessing()?e.reject(new Error("A command is already processing, please wait")):null===n.manager?e.resolve():(!0===n.isFocused()&&s.setCheckState({id:"Focus",state:!1}),n._isProcessing=!0,n.isInspected()?n.release().then((function(){return n.manager.destroy()})).then((function(){n.manager=null,n._isProcessing=!1,n.dispatchEvent("onClear")})):t&&"ENX3DIR_AP"==t.options.afrAppId?(n._isProcessing=!1,n.dispatchEvent("onClear"),e.resolve()):n.manager.destroy().then((function(){n.manager=null,n._isProcessing=!1,n.dispatchEvent("onClear")})))},refresh:function(t,n,s){var i=this;return!0===i.isProcessing()?e.reject(new Error("A command is already processing, please wait")):(u.get("filter").refresh(),Array.isArray(n)&&i.setFilteredIssues(n),null===i.manager?e.resolve():i.clear().then((function(){return i.display(t,s)})))},focus:function(){l.getCommandCheckHeader("Focus").toggleState()},inspect:function(t){var n=this;return null===n.manager?e.resolve():n.manager.inspect(t).then((function(){n.dispatchEvent("onInspect")}))},release:function(){var t=this;return null===t.manager?e.resolve():t.manager.release().then((function(){t.dispatchEvent("onRelease")}))},publishSelect:function(e){var t=u.get("widget")||window.widget,n=t.getValue("appId")+"_"+t.id;i.publish("DS/Object/select",{metadata:{appId:t.id,appName:t.name,timestamp:Math.floor(Date.now())},data:{paths:e.paths,attributes:e.attributes},version:"1.0"}),this.getSelectedIssues().length>0&&i.publish("DS/PADUtils/PADCommandProxy/select",{metadata:{uid:Math.random(),originUid:Math.random(),appid:n,originWidgetId:t.id,timestamp:Math.floor(Date.now())},data:{paths:e.paths,attributes:e.attributes,version:"1.1",tenant:m.getTenant()}})},publishCompass:function(){var e=this;if(null!==e.manager){var t=e.manager.getSelectedIssues();e.utils.setTypesCallbackForOFW(t)}},isDisplayed:function(){let e=!1;try{e=u.get("pad3DViewer").getExecutionContext().getComponent(WAfrStandardComponentKey.HandlerComponent).getCheckState({id:"Display"})}catch(t){e=!1}return e},isFocused:function(){return u.get("pad3DViewer").getExecutionContext().getComponent(WAfrStandardComponentKey.HandlerComponent).getCheckState({id:"Focus"})},isInspected:function(){var e=this.getManager();return null!==e&&null!==e.inspector&&e.inspector.isInspected()},isProcessing:function(){return this._isProcessing},getManager:function(){return this.manager},getIssues:function(){return null===this.manager?[]:this.manager.getIssues()},getSelectedIssues:function(){return null===this.manager?[]:this.manager.getSelectedIssues()},getInspectedIssues:function(){return null===this.manager?[]:this.manager.getInspectedIssues()},get3DContext:function(){return this.context},listenToCSO:function(){this.manager&&this.manager._listenToCSO()},stopListeningToCSO:function(){this.manager&&this.manager._stopListeningToCSO()},setFilteredIssues:function(e){this._filteredIssues=e},getSessionOrFilteredRoots:function(){var e=this,t=[],s=u.get("widget");try{var i=JSON.parse(s.getValue("filter"));!0===i.synchronize&&Array.isArray(e._filteredIssues)?t=n.clone(e._filteredIssues):!0===i.session&&(t=s.getValue("roots"))}catch(t){e._logger.error(t)}return t},_subscribers:function(){var t=this,s=u.get("widget")||window.widget;t._subscriberTokens.push(i.subscribe("DS/Object/create",(function(e){if(p.start(t.name+" DS/Object/create"),null!==t.manager){var n=e.data.attributes;t.manager.refreshIssuesById({timestamp:e.metadata.timestamp,ids:Object.keys(n)}).then((function(){p.end(t.name+" DS/Object/create")}))}}))),t._subscriberTokens.push(i.subscribe("DS/Object/update",(function(n){if(null!==t.manager&&t._timestampUpdate!==n.metadata.timestamp){p.start(t.name+" DS/Object/update"),t._timestampUpdate=n.metadata.timestamp;var s=n.data.attributes;t.manager.refreshIssuesById({timestamp:n.metadata.timestamp,ids:Object.keys(s)}).then((function(){return t.isInspected()?t.getManager().inspector.refresh():e.resolve()})).then((function(){t.dispatchEvent("onUpdate"),p.end(t.name+" DS/Object/update")}))}}))),t._subscriberTokens.push(i.subscribe("DS/Object/delete",(function(e){if(p.start(t.name+" DS/Object/delete"),null!==t.manager){var n=[];e.data.paths.forEach((function(e){n.push(e.pop())})),t.manager.removeIssuesById({timestamp:e.metadata.timestamp,ids:n}).then((function(){t.dispatchEvent("onDelete"),p.end(t.name+" DS/Object/delete")}))}}))),t._subscriberTokens.push(i.subscribe("DS/Object/select",(function(e){if(null!==t.manager&&e.metadata.appId!==s.id){null!==t._tasks.current&&t._tasks.current.taskType===b.SELECT_IN_3D&&t.taskManager.cancel(t._tasks.current.taskId);var n=Object.keys(e.data.attributes);t.manager.select({ids:n,publish:!1,unselectAll:!0}),t.dispatchEvent("onSelect")}}))),t._subscriberTokens.push(i.subscribe("DS/ENXISSU_AP/Filter/Issues",(function(e){if(e.metadata.appId!==s.id&&e.metadata.appName===f){var i=JSON.parse(s.getValue("filter"));if(!0===i.synchronize){var o=n.is(e.data,"object")&&n.is(e.data.filter,"object")&&Array.isArray(e.data.filter.issues)?n.clone(e.data.filter.issues):null;t.setFilteredIssues(o)}t.isDisplayed()&&!0===i.synchronize?u.get("syncFilter").getContent().show():u.get("syncFilter").getContent().hide(),u.get("syncFilter").getContent().onclick=function(){try{var i=JSON.parse(s.getValue("filter")),o=n.is(e.data,"object")&&n.is(e.data.filter,"object")&&Array.isArray(e.data.filter.issues)?n.clone(e.data.filter.issues):null;!0===i.synchronize&&Array.isArray(o)&&setTimeout((function(){u.get("application").refresh(o),u.get("syncFilter").getContent().hide()}),0)}catch(e){t._logger.error(e)}}}})))},_subscribersTaskManager:function(){var t=this,s=u.get("widget")||window.widget;t._tasks.subscriberTokens.push(i.subscribe("DS/IssueManagementTask/add",(function(e){if(p.start(t.name+" DS/IssueManagementTask/add"),n.is(e.metadata,"object")&&n.is(e.metadata.options,"object")&&n.equals(e.metadata.options[I.ISU_TASK_MANAGER],I.ISU_TASK_MANAGER)&&Array.isArray(e.data.paths)&&e.data.paths.length>0){var o,r=e.data.paths[D][D],a=e.data.attributes[r];if(null!=a&&""!==a&&(o=a.taskType),!n.is(t._tasks.current)&&function(e){var n=s.body.getDimensions().height,i=window.getComputedStyle(s.body);return 0!==n&&"none"!==i.display&&(!0!==t.isInspected()||e===b.TAKE_SCREENSHOT)}(o)&&-1!==Object.keys(b).indexOf(a.taskType)){var l=[],c={};l.push([r]),c[r]={taskType:a.taskType,widgetIdIM:a.widgetIdIM,widgetId3D:s.id},i.publish("DS/IssueManagementTask/ready",{metadata:{appId:s.id,appName:s.name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:l,attributes:c},version:"1.0"})}}p.end(t.name+" DS/IssueManagementTask/add")}))),t._tasks.subscriberTokens.push(i.subscribe("DS/IssueManagementTask/exec",(function(i){if(p.start(t.name+" DS/IssueManagementTask/exec"),n.is(i.metadata,"object")&&n.is(i.metadata.options,"object")&&n.equals(i.metadata.options[I.ISU_TASK_MANAGER],I.ISU_TASK_MANAGER)&&Array.isArray(i.data.paths)&&i.data.paths.length>0){var o=i.data.paths[D][D],r=i.data.attributes[o];s.name===v&&r.widgetId3D===s.id&&new e((function(e){!0!==t.isDisplayed()?require(["DS/UIKIT/Mask","DS/Issue3DReviewV2Rsc/commandsWebAfr/CommandsManager"],(function(n,i){n.mask(s.body),t.listenTo(t,"onDisplay",(function(){t.stopListening(t,"onDisplay"),n.unmask(s.body),e()})),u.get("pad3DViewer").getExecutionContext().getComponent(WAfrStandardComponentKey.HandlerComponent).setCheckState({id:"Display",state:!0})})):e()})).then((function(){t._tasks.current={taskId:o,taskType:r.taskType,widgetIdIM:r.widgetIdIM,widgetId3D:s.id}})).then((function(){return n.is(t._taskHandlers[r.taskType],"function")?t._taskHandlers[r.taskType].call(t,r.args):e.resolve()})).then((function(e){n.is(e,"object")&&(t._tasks.current.cancel=e)})).catch((function(e){t._tasks.current=null,t._logger.error(e)}))}p.end(t.name+" DS/IssueManagementTask/exec")}))),t._tasks.subscriberTokens.push(i.subscribe("DS/IssueManagementTask/cancel",(function(e){if(p.start(t.name+" DS/IssueManagementTask/cancel"),n.is(e.metadata,"object")&&n.is(e.metadata.options,"object")&&n.equals(e.metadata.options[I.ISU_TASK_MANAGER],I.ISU_TASK_MANAGER)&&Array.isArray(e.data.paths)&&e.data.paths.length>0){var i=e.data.paths[D][D],o=e.data.attributes[i];if(o.taskId===t._tasks.current.taskId&&o.widgetId3D===s.id&&o.widgetIdIM===t._tasks.current.widgetIdIM){if(n.is(t._tasks.current.cancel,"object")&&n.is(t._tasks.current.cancel.method,"function")){var r=t._tasks.current.cancel.method,a=t._tasks.current.cancel.context||null,l=t._tasks.current.cancel.args||[];r.apply(a,l)}t._tasks.current=null}}p.end(t.name+" DS/IssueManagementTask/cancel")})))},_taskHandlers:{SELECT_IN_3D:function(e){var t=this,n=u.get("widget")||window.widget;return t.utils.selectIn3D((function(e,s,o,r,a,l){var c=[],u={},d={nodes:[]};o.nodes.forEach((function(){d.nodes.push("node")})),d.paths=o.paths,c.push([t._tasks.current.taskId]),u[t._tasks.current.taskId]={taskType:t._tasks.current.taskType,widgetIdIM:t._tasks.current.widgetIdIM,widgetId3D:t._tasks.current.widgetId3D,response:{target:e,positions:s,nodes:d,context:r,objectType:a,i3dx:l}},i.publish("DS/IssueManagementTask/done",{metadata:{appId:n.id,appName:n.name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:c,attributes:u},version:"1.0"}),t._tasks.current=null}),(function(){var e=[],s={};e.push([t._tasks.current.taskId]),s[t._tasks.current.taskId]={taskType:t._tasks.current.taskType,widgetIdIM:t._tasks.current.widgetIdIM,widgetId3D:t._tasks.current.widgetId3D},i.publish("DS/IssueManagementTask/done",{metadata:{appId:n.id,appName:n.name,timestamp:Math.floor(Date.now()),options:{canceled:!0}},data:{paths:e,attributes:s},version:"1.0"}),t._tasks.current=null}),e)},TAKE_SCREENSHOT:function(){var e=this,t=u.get("widget")||window.widget;return e.utils.takeAnnotation((function(n){var s=(new Date).toLocaleString();s=r.formatDate(s,{timePrecision:"sec"}).replace(w,"-");var o={data:n.dataURL,fileName:"screenshot_"+s+".png",fileType:"image/png",lastModified:new Date},a=[],l={};a.push([e._tasks.current.taskId]),l[e._tasks.current.taskId]={taskType:e._tasks.current.taskType,widgetIdIM:e._tasks.current.widgetIdIM,widgetId3D:e._tasks.current.widgetId3D,response:o},i.publish("DS/IssueManagementTask/done",{metadata:{appId:t.id,appName:t.name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:a,attributes:l},version:"1.0"}),e._tasks.current=null}),(function(){var n=[],s={};n.push([e._tasks.current.taskId]),s[e._tasks.current.taskId]={taskType:e._tasks.current.taskType,widgetIdIM:e._tasks.current.widgetIdIM,widgetId3D:e._tasks.current.widgetId3D},i.publish("DS/IssueManagementTask/done",{metadata:{appId:t.id,appName:t.name,timestamp:Math.floor(Date.now()),options:{canceled:!0}},data:{paths:n,attributes:s},version:"1.0"}),e._tasks.current=null}),(function(t){e._logger.error(t)}))}},utils:{pathUtils:{convertInstancePath:function(e){for(var t=e.split(","),n=[],s=0;s<t.length;s++)0!=s&&s%2!=1&&s!=t.length-1||n.push(t[s]);return n.toString()},convertReferencePath:function(e){for(var t=e.split(","),n=t[t.length-1],s=u.get("component").getManager().getNodesById(n).paths,i=0;i<s.length;i++){if(this.convertInstancePath(s[i].toString())==e)return s[i].toString()}return""},compareInstancePaths:function(e,t){var n=e.split(","),s=t.split(",");return n.shift(),s.shift(),!!n.toString().includes(s.toString())}},_setTypesCallbackSubscribe:!1,setTypesCallbackForOFW:function(e){a.setTypesCallbackForOFW(e,{setTypesCallbackSubscribe:this._setTypesCallbackSubscribe}),this._setTypesCallbackSubscribe=!0},createBalloon:function(t){return new e((function(e){require(["DS/Issue3DReviewV2Rsc/views/Balloon","DS/Issue3DReviewV2Rsc/models/Issue","DS/Issue3DReviewV2Rsc/models/Marker"],(function(n,s,i){var o=u.get("component").get3DContext(),r="";Array.isArray(t.path)&&(r=t.path.join());var a=new i({id:t.id,issue:new s({}),name:"",title:"",state:"",description:"",position:t.position,path:t.path,node:t.id,path_str:r,temporary:t.temporary||!1});a.set("color",t.color);var l=new n({parent:t.parent,model:a,isInspected:!1,viewer:o.viewer,window:o.window,controller:o.controller});l.render({callback:function(){e(l)}})}))}))},selectIn3D:function(t,n,s){return new e((function(e){require(["DS/Issue3DReviewV2Rsc/utils/ViewerManipulator"],(function(i){widget.getValue("isAECDataLoaded")?i.setOccurenceMode(!1):s&&1==s.length&&null!=s[0]?i.setOccurenceMode(s[0].isOccurenceSelection):i.setOccurenceMode(!1);var o={method:i.selectIn3D(t,n),context:null,args:[!0]};e(o)}))}))},takeAnnotation:function(t,n,s){return new e((function(e,i){require(["DS/2DAnnotation/2DAnnotation","DS/UIKIT/Mask"],(function(o,r){var a=u.get("widget")||window.widget;r.mask(a.body);var l=new o({className:"create-attachments-annotation",saveCallback:function(e){t(e),l.destroy()},exitCallback:function(){n(),l.destroy()},captureTarget:u.get("component").get3DContext().root.getViewer().canvas});l.render(),l.isLoaded.then((function(){r.unmask(a.body),l.container.inject(a.body),e({method:l.callbacks.exitCallback,context:null,args:[!0]})})).catch((function(e){r.unmask(a.body),s(e),i(e)}))}))}))}}})}));