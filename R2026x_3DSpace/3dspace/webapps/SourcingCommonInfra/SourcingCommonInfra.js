define("DS/SourcingCommonInfra/utils/NotificationsUtil",["DS/UIKIT/Mask","UWA/Class","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen"],(function(e,t,n,i){"use strict";var o=t.singleton({_notificationsMgr:{},_defaultLevel:"info",_msgLevels:{INFO:"info",WARNING:"warning",ERROR:"error",SUCCESS:"success"},init:function(){this._notificationsMgr=n,i.setNotificationManager(this._notificationsMgr)},showMessage:function(e){if(e&&e.subtitle)return this._notificationsMgr.addNotif({category:e.category,level:e.level?e.level:this._defaultLevel,subtitle:e.subtitle,sticky:!!e.isSticky&&e.isSticky,allowUnsafeHTML:!!e.allowUnsafeHTML&&e.allowUnsafeHTML})},showError:function(t){if(t&&""!==t)return widget.app&&widget.app.logger&&widget.app.logger.error(t),this.showMessage({level:this._msgLevels.ERROR,subtitle:t});e.unmask(widget.body)}});return o.init(),o})),define("DS/SourcingCommonInfra/utils/Constants",["UWA/Class/Debug"],(function(e){"use strict";return UWA.Class.singleton(e,{ONPREMISE:"OnPremise",SESSSION_EXPIRED:401,UNAUTHORISED_REQUEST:403,SERVICE_3DSPACE:"3DSpace",SOURCE_SOURCING:"sourcing",VPMREFERENCE:"VPMReference",OR:" OR ",SOURCE_3DSPACE:"3dspace",RELEASED:"Released",RELEASED_MEI_STATE:"RELEASED",OBSOLETE:"Obsolete",MEI_EXTENSION:"ManufacturerEquivalentItemExtension",MEI_PROXY:"SRC Manufacturer Equivalent Item Proxy Item",EEQ_TYPE:"SRC Engineering Equivalent Qualification",TYPE_SRC_GENERAL_QUALIFICATION:"SRC General Qualification",MEI:"Manufacturer Equivalent Item",PREFERRED:"SRC Preferred",APPROVED:"SRC Approved",EFFECTIVITY_START:"Effectivity Start Date",EFFECTIVITY_END:"Effectivity End Date",LAST_TIME_BUY:"Last Time Buy",UTILITY_PREDICATE_SELECTORS:["ds6w:label","physicalid","name","ds6w:description","ds6w:identifier","ds6w:created","ds6w:modified","ds6w:responsible","ds6w:responsibleUid","ds6w:project","ds6w:dataSource","ds6w:community","ds6wg:revision","ds6w:what/ds6w:status","ds6w:status","partnumber","ds6w:type","organization","owner","ds6wg:EnterpriseExtension.V_PartNumber","bo.ManufacturerEquivalentItemExtension.ManufacturerName","ds6wg:ManufacturerEquivalentItemExtension.ManufacturerPartNumber","ds6wg:ManufacturerEquivalentItemExtension.ManufacturerName","ds6wg:ManufacturerEquivalentItemExtension.ManufacturerTitle","bo.srcQualification.MEI","bo.srcQualification.ENGINEERING_ITEM","bo.srcQualification.PREREQ","bo.srcQualification.Preferred","bo.srcQualification.Approved","bo.srcQualification.Comments","bo.srcQualification.IsOrderable","bo.srcQualification.USAGE_CONTEXT_ID"],UTILITY_FILE_SELECTORS:["icon","thumbnail_2d"]})})),define("DS/SourcingCommonInfra/utils/PlatformServices",["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","UWA/Class/Debug","DS/WAFData/WAFData","DS/UIKIT/Mask","i18n!DS/SourcingCommonInfra/assets/nls/SourcingCommonInfra"],(function(e,t,n,i,o){"use strict";return UWA.Class.singleton(t,{_platforms:[],csrfTokenMap:{},init:function(){this._platforms=[]},getServiceURL:function(e){return this._platforms[e]?this._platforms[e]:null},getPlatformId:function(){let e=this;if(e._platformId)return e._platformId;try{return widget&&(e._platformId=widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise"),e._platformId}catch(e){return"OnPremise"}},getPlatformServices:function(t){let n=this;return new Promise((function(i,o){let r={platformId:n.getPlatformId(),onComplete:function(e){t.logger.info("Platform Services successfully retrieved");let o=e.hasOwnProperty("length")?e[0]:e;n._platforms=o,"OnPremise"===n.getPlatformId()&&(n._platforms.sourcing=n._platforms["3DSpace"],o.sourcing=n._platforms["3DSpace"]),i(o)},onFailure:function(e){t.logger.error("Failed to get platform Services"),t.logger.error("Reason: "+e),n.displayAlert("error","appLoadMessage"),o(e)}};e.getPlatformServices(r)})).catch((e=>{t.logger.error(e)}))},getCSRFToken:function(e,t){let i=this,o=t||"3DSpace";return new Promise((function(t,r){if(i.csrfTokenMap&&i.csrfTokenMap[o])return void t(i.csrfTokenMap[o]);let a={},s=e+"/resources/v1/application/CSRF?tenant="+i.getPlatformId();a.method="GET",a.proxy="passport",a.onComplete=function(e){i.app&&i.app.logger.info("CSRF Token retrieved successfully"),i.csrfTokenMap[o]=e.csrf.value,t(e.csrf.value)},a.onFailure=function(e){i.app&&i.app.logger.error("Error while getting CSRF token"),r(e)},a.type="json",n.authenticatedRequest(s,a)}))},displayAlert:function(e,t){widget.notificationUtil.showMessage({level:e,subtitle:o[t]}),i.mask(widget.body,o.loading)}})})),define("DS/SourcingCommonInfra/utils/Services",["UWA/Class","DS/WAFData/WAFData","DS/WidgetServices/WidgetServices","DS/SourcingCommonInfra/utils/PlatformServices","DS/SourcingCommonInfra/utils/Constants","i18n!DS/SourcingCommonInfra/assets/nls/SourcingCommonInfra"],(function(e,t,n,i,o,r){"use strict";return e.singleton({initialize:function(){},isSessionExpired:function(e){let t=e.status||e.statusCode,n=!1;return!t||t!==o.SESSSION_EXPIRED&&t!==o.UNAUTHORISED_REQUEST||(widget.notificationUtil.showError(r.session_expired),n=!0),n},getServiceURL:function(e){let t=i.getServiceURL(e.source?e.source:"3DSpace")+e.endpoint;return t.includes("?")?t+"&tenant="+i.getPlatformId():t+"?tenant="+i.getPlatformId()},getSecurityContext:async function(e,t){let n="",r=e||o.SERVICE_3DSPACE;if(i.getPlatformId()!==o.ONPREMISE&&r===o.SOURCE_SOURCING)return"ctx::VPLMProjectLeader.Company Name.SOURCING";if(t)return t;if(n=widget.getValue("SC")||widget.getValue("xPref_CREDENTIAL")||this._securityContext||"",""===n){let e=await this.getUserSecurityContext();return this._securityContext=e,"ctx::"+this._securityContext}return"ctx::"+n},getUserSecurityContext:function(){var e=this.getServiceURL({endpoint:"/resources/modeler/pno/person?current=true"});return e+="&select=preferredcredentials&select=collabspaces",new Promise((function(n,i){t.authenticatedRequest(e,{method:"GET",type:"json",onComplete:function(e){var t="",i=e.preferredcredentials;i.collabspace&&i.role&&i.organization&&(t=i.role.name+"."+i.organization.name+"."+i.collabspace.name),n(t)},onFailure:function(){i()}})}))},getDataPromise:function(e){let r=this;return i.getCSRFToken(i.getServiceURL(e.source?e.source:o.SERVICE_3DSPACE),e.source).then((function(i){return new Promise((async function(o,a){let s=r.getServiceURL(e),c={"Content-Type":"application/json",ENO_CSRF_TOKEN:i,SecurityContext:await r.getSecurityContext(e.source,e.sc),"Accept-Language":n.getLanguage()};t.authenticatedRequest(s,{method:"GET",type:"json",headers:c,onComplete:function(e){o(e)},onFailure:function(e,t){t&&r.isSessionExpired(t)||a(t||(e.message?e.message:e))}})}))}),(function(){}))},performPostPromise:async function(e){let r=this;return i.getCSRFToken(i.getServiceURL(e.source?e.source:o.SERVICE_3DSPACE),e.source).then((function(i){return new Promise((async function(a,s){let c=r.getServiceURL(e),u=e.postData;"object"==typeof e.postData&&(u=UWA.Json.encode(e.postData),e.postData.csrf={name:"ENO_CSRF_TOKEN",value:i},e.postData.SecurityContext3DSpace=await r.getSecurityContext(o.SERVICE_3DSPACE)),t.authenticatedRequest(c,{method:"POST",type:"json",headers:{"Content-Type":e.contentType?e.contentType:"application/json",ENO_CSRF_TOKEN:i,SecurityContext:await r.getSecurityContext(e.source),"Accept-Language":n.getLanguage()},data:u,onComplete:function(e){a(e)},onFailure:function(e,t){t&&r.isSessionExpired(t)||s(t)}})}))}),(function(){}))},getFederatedSearchDataPromise:async function(e){let a=this;return new Promise((async function(s,c){if(!e.searchPayLoad.login){let t={};t[o.SOURCE_3DSPACE]={SecurityContext:await a.getSecurityContext(o.SOURCE_3DSPACE)},e.searchPayLoad.login=t}t.authenticatedRequest(i.getServiceURL("3DSearch")+(e.recent?"/recent":"/search"),{method:"POST",type:"json",headers:{"Content-Type":"application/json",SecurityContext:await a.getSecurityContext(e.source),"Accept-Language":n.getLanguage()},onComplete:function(e){s(e)},data:UWA.Json.encode(e.searchPayLoad),onFailure:function(e,t){t&&a.isSessionExpired(t)||(widget.notificationUtil.showError(r.error_search_index_get),c(e))},onTimeout:function(e){c(e)}})}))}})})),define("DS/SourcingCommonInfra/utils/SearchUtility",["DS/SourcingCommonInfra/utils/Services","DS/SourcingCommonInfra/utils/PlatformServices","DS/SourcingCommonInfra/utils/Constants","DS/SearchDictionaryAccess/SearchDictionaryAccessAPI"],(function(e,t,n,i){"use strict";var o=function(){};return o.prototype.getSearchPayload=async function(e,i,o){let r="";return i.map((function(e){r+=' flattenedtaxonomies:"types/'+e+'"'+n.OR})),r=r.substring(0,r.length-3),(o=o.map((e=>e.toLowerCase())))&&0!==o.length||(o=[n.SOURCE_3DSPACE]),{nresults:e.length>1e3?999:e.length,order_field:"ds6w:label",with_indexing_date:!0,with_synthesis:!0,order_by:"asc",start:0,label:"test",login:await this.prepareSecurityContexts(o),locale:widget.lang,select_predicate:n.UTILITY_PREDICATE_SELECTORS,select_file:n.UTILITY_FILE_SELECTORS,query:r,source:o,tenant:t.getPlatformId(),resourceid_in:e,with_nls:!0,specific_source_parameter:{}}},o.prototype.callFederatedSearch=function(t){return new Promise((n=>{t.nresults>0?e.getFederatedSearchDataPromise({searchPayLoad:t}).then((function(e){n(e)})):n([])}))},o.prototype.processFedSearchData=function(e){if(!e.results)return[];let t=[];return e.results.forEach((e=>{let n={};e.attributes.forEach((e=>{e.dispValue?(n[e.name]=e.dispValue,e.dispValue!==e.value&&(n[e.name+"_value"]=e.value)):n[e.name]=e.value})),t.push(n)})),t},o.prototype.prepareSecurityContexts=async function(t){let i={},o=await e.getSecurityContext(n.SOURCE_3DSPACE);return t.map((function(){i[n.SOURCE_3DSPACE]={SecurityContext:o}})),i},o.prototype.getNlsOfPropertiesValues=function(e){return new Promise((function(n){i.getNlsOfSearchValuesBySource(e,{apiVersion:"R2019x",tenantId:t.getPlatformId(),lang:widget.lang,onComplete:function(e){n(e)},onFailure:function(){n()}})}))},o})),define("DS/SourcingCommonInfra/models/Model",["DS/SourcingCommonInfra/utils/Services"],(function(e){"use strict";var t=function(){this.source="sourcing"};return t.prototype.init=function(){e.initialize()},t.prototype.getTypesHierarchy=function(t){let n={endpoint:"/resources/enong/dico/gettypeshierarchy"};return n.postData={types:[t]},e.performPostPromise(n)},t})),define("DS/SourcingCommonInfra/utils/OpenWithService",["UWA/Core","UWA/Class","DS/i3DXCompassPlatformServices/OpenWith","UWA/Class/Promise","DS/SourcingCommonInfra/utils/PlatformServices","DS/SourcingCommonInfra/utils/Constants","DS/SourcingCommonInfra/models/Model"],(function(e,t,n,i,o,r,a){"use strict";return t.singleton({init:function(e){this.option=e,this.meiModel=new a},initialize:function(e){this.app=e},getOpenWithMenu:function(t){let o=this;return o.meiModel.getTypesHierarchy(o.getObjectActualType(t)).then((function(r){let a=o.getContentForCompassInteraction(t,r),s=new n;s.set3DXContent(a);let c=[];if(e.is(s.retrieveCompatibleApps,"function"))return new i((function(e,t){s.retrieveCompatibleApps((function(t){t.forEach((function(e){c.push(o.getSubmenuOptions(e,null))})),e(c)}),(function(){t(new Error("Error while getting Open with menus"))}))}))})).catch((function(e){widget.notificationUtil.showError(e)}))},getSubmenuOptions:function(e,t){return{id:e.text,title:e.text,icon:e.icon?e.icon:e.fonticon,type:"PushItem",multisel:!1,action:{context:t,callback:e.handler}}},getContentForCompassInteraction:function(e,t){let n=this,i=e,o=[],r={envId:widget.getValue("x3dPlatformId"),serviceId:n.getServiceId(i),contextId:"",objectId:n.getObjectId(i),objectType:n.getObjectActualType(i),displayName:n.getDisplayName(i),displayType:n.getObjectActualType(i),facetName:"realized",path:[{resourceid:n.getObjectId(i),type:n.getObjectActualType(i)}],objectTaxonomies:n.getObjectTaxonomies(i,t)};return o.push(r),{protocol:"3DXContent",version:"1.1",source:widget.data.appId,widgetId:widget.id,data:{items:o}}},getServiceId:function(){let e=r.SOURCE_3DSPACE;return r.ONPREMISE===o.getPlatformId()&&(e=r.SERVICE_3DSPACE),e},getObjectId:function(e){let t="";return t=e&&e.options.grid.id&&r.ONPREMISE===o.getPlatformId()?e.options.grid.id:e.options.grid.actualId?e.options.grid.actualId:e.options.grid.id,t},getObjectActualType:function(e){let t="";return e&&e.options.grid.id&&(t=e.options.grid.actualType?e.options.grid.actualType:e.options.grid.type),t},getDisplayName:function(e){let t="";return e&&e.options.grid.id&&(t=e.options.grid.title),t},getObjectTaxonomies:function(e,t){let n=[];return e.options.grid.actualType===r.VPMREFERENCE?e.options.grid.additionalDragData&&e.options.grid.additionalDragData.objectTaxonomies.includes(r.MEI_EXTENSION)?(n.push(r.VPMREFERENCE),n.push(r.MEI_EXTENSION)):n.push(r.VPMREFERENCE):e.options.grid.actualType===r.MEI_PROXY?(n.push(r.VPMREFERENCE),n.push(r.MEI_EXTENSION)):e.options.grid.actualType&&n.push(e.options.grid.actualType),n=[...n,...t.types_hierarchies[0].hierarchy],n}})}));