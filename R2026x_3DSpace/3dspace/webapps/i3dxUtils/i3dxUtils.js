define("DS/i3dxUtils/i3dxUtils",["UWA/Core","DS/WAFData/WAFData","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],(function(e,t,o){"use strict";let n={},r=function(e){let t=e.match(/i3dx:([^!]+)!(.+)/);return t&&3===t.length?{domain:t[1],id:t[2]}:{}},i=e=>({"ds6w:i3dx":e});n.split3dx=r;let l=(t,o)=>{if(!o||!o.onComplete){if(n.registry)return t();throw new Error("registry not initialized")}if(n.registry)return t();{let r=e.clone(o,!1);r.onComplete=t,n.initRegistry(r)}};return n.initRegistry=function(e){o.getServiceUrl({serviceName:"3dspace",platformId:widget.getValue("x3dPlatformId"),onComplete:function(o){let r=o;if(!o)return e&&e.onFailure&&e.onFailure(),void console.log("failed to get 3dspace url");let i=r+"/resources/domains/v1/registry/items";t.authenticatedRequest(i,{type:"json",headers:{"Content-Type":"application/json"},method:"GET",contentType:"application/json",onComplete:t=>{n.registry=t,e&&e.onComplete&&e.onComplete()},onFailure:function(){e&&e.onFailure&&e.onFailure()}})}})},n.getAllDomains=function(t){return l((()=>{let o=e.clone(n.registry.data,!0);return t&&t.onComplete&&t.onComplete(o),o}),t)},n.getDomain=function(t,o){return l((()=>{let r=n.registry.data&&e.clone(n.registry.data[t],!0);return o&&o.onComplete&&o.onComplete(r),r}),o)},n.getDomainByI3dx=function(t,o){return l((()=>{let i=r(t),l=n.registry.data&&e.clone(n.registry.data[i.domain],!0);return o&&o.onComplete&&o.onComplete(l),l}),o)},n.getOperationForResources=function(e,t,o){let i=new Map;t.forEach((e=>{let t=r(e),o=i.get(t.domain);o||(o=[],i.set(t.domain,o)),o.push(e)}));return l((()=>{let t=new Map;i.entries().forEach((([o,r])=>{let i=n.getDomain(o);if(i){let o=i.operationURLs[e];if(o){let e=i.service+"/"+o,n=t.get(e);n||(n={service:i.service,URL:o,URIs:[]},t.set(e,n)),n.URIs.push(...r)}}}));let r=[...t.values()];return o&&o.onComplete&&o.onComplete(r),r}),o)},n.getFetchForResources=function(e,t){return l((()=>{let o=n.getOperationForResources("fetch",e);return o.forEach((e=>{e.payload={data:e.URIs.map(i)}})),t&&t.onComplete&&t.onComplete(o),o}),t)},n}));