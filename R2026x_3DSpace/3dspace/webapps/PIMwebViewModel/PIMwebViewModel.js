/*!  Copyright 2018 Dassault Systemes. All rights reserved. */
define("DS/PIMwebViewModel/PIMwebUtils",["DS/WAFData/WAFData","UWA/Core","DS/PlatformAPI/PlatformAPI","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSettingsMgt","DS/PADServices/utils/GlobalUtils","DS/Usage/TrackerAPI"].concat([]),(function(e,t,i,n,r,o,s){"use strict";let a={get3DSpaceUrl:()=>n.get3DSpaceUrl(),getPlatformId:()=>n.getPlatformId(),getSecurityContext:()=>r.getSetting("pad_security_ctx"),getLang:()=>o.getLang()};function l(e){var t=i.getUser();return e+"-"+(t?t.login:"")+"-"+Date.now()}function c(e){var i=t.Promise.deferred();return function(e,i){var n=t.Promise.deferred();return require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"].concat([]),(function(t){t.getServiceUrl({serviceName:e,platformId:i,onComplete:function(e){n.resolve(e)},onFailure:function(e){n.reject(new Error(e))}})})),n.promise}("djc",e).then((function(e){var t="";e&&(t=e+"/api"),i.resolve(t)})),i.promise}function u(e){return{input_physical_ids:[e],label:l("PIMwebIsr"),primitives:[{navigate_to_rel:{id:1,filter:{bo_type:["dsc_Result_Category_Ref"]}}},{navigate_to_rel:{id:2}}],patterns:{itfCtxt:[{id:1},{id:2}]},fileAttributes:[],attributes:["ds6w:label","ds6wg:EnterpriseExtension.V_PartNumber","ds6w:responsible","owner","ds6w:type","ds6w:description"],version:3}}function f(e,t,i,n){let r=Object.assign({},e);return r.method=t,r.url=a.get3DSpaceUrl()+i+"?tenant="+a.getPlatformId(),r.securityContext=a.getSecurityContext(),n&&(r.data=n),r}function p(e,i,n,r){var o=t.Promise.deferred();let s=a.getPlatformId(),l=Object.assign({},e);return l.method=i,c(s).then((function(e){l.url=e+n,r&&(l.data=r),o.resolve(l)})),o.promise}function d(t){return e.authenticatedRequest(t.url+"&SecurityContext="+t.securityContext+(t.outputFormat?"&output_format="+t.outputFormat:""),{method:t.method,headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:t.securityContext},data:JSON.stringify(t.data),timeout:t.timeout,onComplete:t.onComplete,onFailure:t.onFailure,onTimeout:t.onTimeout||t.onFailure})}function I(t){return e.authenticatedRequest(t.url,{method:t.method,headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:t.securityContext},data:JSON.stringify(t.data),timeout:t.timeout,onComplete:t.onComplete,onFailure:t.onFailure,onTimeout:t.onTimeout||t.onFailure})}var m=Object.create({}),_=Object.getPrototypeOf(m);function h(e){let t=new Blob([e.stream],{type:"application/json"}),i=new FormData;i.append("__fcs__jobTicket",e.preCheckIn.checkinTicket),i.append("file_0",t,"WebIsrScenarioContent.json");var n=new XMLHttpRequest;n.open("POST",e.preCheckIn.actionURL,!0),n.onload=function(){if(200===n.status){d(f({onComplete:e.onComplete,onFailure:e.onFailure},"POST","/resources/pimauthoring/service/checkinStreamInfo",{repRefId:e.repRefID,receipt:n.responseText,simuContent:e.stream}))}else e.onFailure()},n.send(i)}_._DEFAULT_PAGGING=500,_._navigateFromIsr=function(e){let t,i=[],n=t=>{i.forEach((e=>e.cancel())),e.onFailure(t)},r=i=>(i=JSON.parse("string"==typeof i?i:null))?t?(t.result&&t.result.length?i.result&&i.result.length&&(Object.assign(t.result[0].input_object,i.result[0].input_object),Object.assign(t.result[0].outputs,i.result[0].outputs)):t=i,delete t.version,void e.onComplete(JSON.stringify(t))):t=i:n(),o={onComplete:r,onFailure:n},s={onComplete:r,onFailure:n,isrID:e.isrID};return i.push(d(f(o,"POST","/cvservlet/navigate",u(e.isrID)))),i.push(m._navigateFromIsrToContext(s)),{cancel:()=>i.forEach((e=>e.cancel()))}},_._navigateFromIsrToResult=function(e){return d(f({onComplete:t=>{if(!(t=JSON.parse("string"==typeof t?t:null)))return e.onFailure();e.onComplete(JSON.stringify(t))},onFailure:e.onFailure},"POST","/cvservlet/navigate",u(e.isrID)))},_._navigateFromIsrToContext=function(e){return d(f({onComplete:t=>{if(!(t=JSON.parse("string"==typeof t?t:null))||!t.infos||"OK"!==t.infos.status||!t.result)return e.onFailure();e.onComplete(JSON.stringify({infos:t.infos,result:t.result.map((e=>({input_object:e.input,outputs:e.output})))}))},onFailure:e.onFailure},"POST","/resources/pimauthoring/service/readItfSimulationContent",Array.isArray(e.isrID)?e.isrID:[e.isrID]))},_._navigateFromContextualInterferences=function(e){return d(f(e,"POST","/cvservlet/navigate",{input_physical_ids:e.ctxIDs,label:l("PIMwebItfCtxt"),primitives:[{navigate_to_sr:{id:1,filter:{semantics:["6"],role:["198"]},mode:"last"}},{navigate_to_rel:{id:2}},{navigate_to_sr:{id:3,filter:{semantics:["5"],role:["201"]},mode:"path"}},{navigate_to_sr:{id:4,filter:{semantics:["5"],role:["197"]},mode:"path"}},{navigate_to_sr:{id:5,filter:{semantics:["6"],role:["200"]},mode:"path"}},{navigate_to_rel:{id:6,filter:{bo_type:["PLMPIMGeometricResultRepReference"]}}}],patterns:{ms:[{id:1}],r2sca:[{id:4}],sca2occ:[{id:1},{id:2},{id:3}],sca:[{id:1},{id:2},{id:5}],repRef:[{id:1},{id:6}]},attributes:["ds6w:label","ds6wg:EnterpriseExtension.V_PartNumber","ds6w:identifier","ds6w:responsible","owner","ds6w:type","ds6w:status","ds6w:description","ds6w:project","ds6wg:revision","organization","current","bo.PLMPIMMetricReference.V_Itf_Analysis","bo.PLMPIMMetricReference.V_Itf_Previous_Analysis","bo.PLMPIMMetricReference.V_Itf_Type","bo.PLMPIMMetricReference.V_Itf_User_Type","bo.PLMPIMMetricReference.V_Itf_Real_Tolerance_Used_For_First_Occurence","bo.PLMPIMMetricReference.V_Itf_Real_Tolerance_Used_For_Second_Occurence","bo.PLMPIMMetricReference.V_Itf_Real_Tolerance_Used_For_Computation","bo.PLMPIMMetricReference.V_Itf_Spec_Clearance_value","bo.PLMPIMMetricReferenceClashContact.V_Itf_Penetration_Value","bo.PLMPIMMetricReferenceClashContact.V_Itf_Clash_Volume","bo.PLMPIMMetricReferenceClashContact.V_Itf_FirstPointFoundClash","bo.PLMPIMMetricReferenceClashContact.V_Itf_SecondPointFoundClash","bo.PLMPIMMetricReferenceClearance.V_Itf_Distance_Min","bo.PLMPIMMetricReferenceClearance.V_Itf_FirstPointFoundClearance","bo.PLMPIMMetricReferenceClearance.V_Itf_SecondPointFoundClearance","bo.PLMPIMMetricReferenceFeature.V_Itf_Feature_UUID_1","bo.PLMPIMMetricReferenceFeature.V_Itf_Feature_UUID_2","bo.PLMPIMMetricReferenceFeature.V_Itf_Feature_Name_1","bo.PLMPIMMetricReferenceFeature.V_Itf_Feature_Name_2","bo.PLMPIMMetricReferenceIFC.V_Itf_IFC_UUIDs_1","bo.PLMPIMMetricReferenceIFC.V_Itf_IFC_UUIDs_2","bo.PLMPIMMetricReferenceIFC.V_Itf_IFC_Names_1","bo.PLMPIMMetricReferenceIFC.V_Itf_IFC_Names_2","bo.SIMItfContextOfInterferenceIFC.V_Itf_IFC_UUIDs","bo.SIMItfContextOfInterferenceIFC.V_Itf_IFC_Names"],fileAttributes:[],version:3}))},_._setAttrValue=function(e){return e.data.attrValue=String(e.data.attrValue),d(f(e,"POST","/resources/PIMwebModel/services/setAttributeValue",e.data))},_._navigateFromMetricToIsr=function(e){return d(f(e,"POST","/cvservlet/navigate",{input_physical_ids:e.metricIDs,label:l("PIMwebItfMetric"),primitives:[{navigate_from_sr:{id:1,filter:{semantics:["6"],role:["198"]}}},{navigate_from_rel:{id:2}}],patterns:{itfCtxt:[{id:1}],isr:[{id:1},{id:2,iter:2}]},attributes:["ds6w:label","ds6w:responsible","owner","ds6w:type","ds6w:description"],fileAttributes:[],version:3}))},_._navigateOneLevel=function(e){return d(f(e,"POST","/cvservlet/navigate",{input_physical_ids:e.ids,label:l("PIMwebNavigateOneLevel"),primitives:[{navigate_to_rel:{id:1}}],patterns:{ref:[{id:1}]},attributes:["ds6w:label","ds6w:identifier","ds6wg:EnterpriseExtension.V_PartNumber","ds6w:responsible","owner","ds6w:type","ds6w:project","ds6wg:revision","organization","current"],fileAttributes:[],version:3}))},_._getLabelAndIconAttr=function(e){return d(f(e,"POST","/cvservlet/fetch/v2",{physicalid:e.ids,label:l("PIMwebFetchForLabelandIcon"),select_predicate:["ds6w:label"],select_file:["icon"]}))},_._getIndexingTimestamp=function(e){return d(f(e,"POST","/cvservlet/indexingdate",{select_service:["FTS","EXPAND"]}))},_._fetchForWelcomePanel=function(e){return d(f(e,"POST","/cvservlet/fetch/v2",{physicalid:e.ids,label:l("PIMwebFetchForWelcomePanel"),select_predicate:["ds6w:label","ds6w:type","ds6wg:revision","ds6w:status","owner","ds6w:responsible","ds6w:modified","ds6w:project","ds6w:identifier","ds6w:status"],select_file:["icon","thumbnail_2d"]}))},_._fetchValidationState=function(e){return d(f(e,"POST","/cvservlet/fetch/v2",{physicalid:e.ids,label:l("PIMwebFetchValidationState"),select_predicate:["bo.SIMItfSimulation.V_ValidationState"],select_file:[]}))},_._getInterferenceAnalysisProgress=function(e){return d(f(e,"POST","/resources/PIMwebModel/services/getInterferenceAnalysisProgress",e.ids))},_._updateIsrContextAndSpec=function(e){let t={onFailure:e.onFailure,onComplete:function(t){if(!(t=JSON.parse("string"==typeof t?t:null))||!t.infos||"OK"!==t.infos.status)return e.onFailure();h({stream:t.output.simuContent,repRefID:e.repRefID,preCheckIn:{checkinTicket:t.output.checkinTicket,actionURL:t.output.actionURL},onFailure:e.onFailure,onComplete:()=>e.onComplete({filter:t.output.filter})})}};return e.data.isrPid=e.isrID,d(f(t,"POST","/resources/pimauthoring/service/updateItfSimulationContent",e.data))},_._readIsrSpecStream=(()=>{let e,t=function(t,i){e||(e=i);try{e.Load({IRPC:!0,serverUrl:a.get3DSpaceUrl(),physicalid:t.repRefID,boType:"dsc_Scenario_CLASH_Rep",format:"1",persistancyType:"json",streamType:"text",onStreamLoaded:e=>t.onComplete({infos:{status:"OK"},stream:JSON.parse(e)}),onError:e=>t.onComplete({infos:{status:e}})})}catch(e){t.onComplete({infos:{status:"KO"}})}};return function(i){e?t(i,e):require(["DS/VisuDataAccess/Ox4StreamLoader"].concat([]),t.bind(null,i))}})(),_._createIsr=function(e){return d(f({onFailure:e.onFailure,onComplete:function(t){if(!(t=JSON.parse("string"==typeof t?t:null))||!t.infos||"OK"!==t.infos.status)return e.onFailure();h({stream:t.output.simuContent,repRefID:t.output.specID,preCheckIn:{checkinTicket:t.output.checkinTicket,actionURL:t.output.actionURL},onFailure:e.onFailure,onComplete:()=>e.onComplete({isrID:t.output.pId,isrTitle:t.output.title})})}},"POST","/resources/pimauthoring/service/createInterferenceSimulation",e.data))},_._computeIsr=function(e){p({onFailure:e.onFailure,onComplete:function(t){var i=JSON.parse("string"==typeof t?t:null);if(!i||!i.jobID||0!==i.status||"OK"!==i.message)return e.onFailure();e.onComplete(i)}},"POST","/v1/job/submit/interference",e.data).then((function(e){return I(e)}))},_._getComputeIsrJobStatus=function(e){p({onFailure:e.onFailure,onComplete:function(t){var i=JSON.parse("string"==typeof t?t:null);if(!i||!i.jobID||0!==i.status||"OK"!==i.message)return e.onFailure();e.onComplete(i)}},"GET","/v1/job/status/"+e.data.jobID,null).then((function(e){return I(e)}))},_._getIsrJobsList=function(e){p({onFailure:e.onFailure,onComplete:function(t){var i=JSON.parse("string"==typeof t?t:null);if(!i||0!==i.status)return e.onFailure();e.onComplete(i)}},"GET","/v1/job/list",null).then((function(e){return I(e)}))},_._getIsrJobsListByPage=function(e){p({onFailure:e.onFailure,onComplete:function(t){var i=JSON.parse("string"==typeof t?t:null);if(!i||0!==i.status)return e.onFailure();e.onComplete(i)}},"POST","/v1/job/list",e.data).then((function(e){return I(e)}))},_._getMaxTokensForIsrCompute=function(e){p({onFailure:e.onFailure,onComplete:function(t){var i=JSON.parse("string"==typeof t?t:null);if(!i||0!==i.status||"OK"!==i.message)return e.onFailure();e.onComplete(i)}},"GET","/v1/job/tokenscount/interference",null).then((function(e){return I(e)}))},_._getSGIAvailable=function(e){return d(f(e,"GET","/cvservlet/isalive/isTenantDeclaredAsEnabledInSGIDB"))},_._readMetricGeomStream=(()=>{let e,t=function(t,i){e||(e=i);try{e.Load({IRPC:!0,serverUrl:a.get3DSpaceUrl(),physicalid:t.repRefID,boType:"PLMPIMGeometricResultRepReference",persistancyType:"json",streamType:"text",onStreamLoaded:e=>t.onComplete({infos:{status:"OK"},buffer:e.replace(/\0+$/,"")}),onError:e=>t.onComplete({infos:{status:e}})})}catch(e){t.onComplete({infos:{status:"KO"}})}};return function(i){e?t(i,e):require(["DS/VisuDataAccess/Ox4StreamLoader"].concat([]),t.bind(null,i))}})();var P,g,y=["SIMItfSimulationDS","ENOSTItfSimulationDS"];function C(e,t){return e?Promise.resolve(e):new Promise((function(i){d(f({onComplete:function(n){e||(-1===(e="string"==typeof n?Object.keys(JSON.parse(n)):[]).indexOf(t)&&e.push(t),Object.freeze(e=e.filter((e=>-1===y.indexOf(e))))),i(e)},onFailure:function(){i([t])}},"POST","/resources/dictionary/getTypeInfo",[t]))}))}_._getIsrTypes=function(){return C(P,"SIMItfSimulation").then((e=>P=e))},_._checkParentType=function(e){return e.typeToCheck===e.parentType?Promise.resolve(!0):new Promise((function(t){return d(f({onFailure:function(){t(!1)},onComplete:function(i){let n=JSON.parse(i).parentTypes.indexOf(e.parentType);t(n>=0)}},"POST","/resources/markup/service/getParentTypes",{sType:e.typeToCheck}))}))},_._getBundleFasternerTypes=function(){return C(g,"BundleFastener").then((e=>g=e))};var b,F={};_._getTypeNLS=function(e){var t={},i=e.filter((function(e){var i=F[e];return t[e]=i||e,!i}));return i.length?new Promise((function(e){require(["DS/FedDictionaryAccess/FedDictionaryAccessAPI"],(function(n){n.getNlsOfPropertiesValues(JSON.stringify({"ds6w:type":i}),{tenantId:a.getPlatformId(),lang:a.getLang(),apiVersion:"R2019x",onComplete:function(i){Object.keys((i||{})["ds6w:type"]||{}).forEach((function(e){t[e]=F[e]=i["ds6w:type"][e]})),e(t)},onFailure:function(){e(t)}})}))})):Promise.resolve(t)},_._getCustomAttributesFromType=function(e){return new Promise((function(t){require(["DS/FedDictionaryAccess/FedDictionaryAccessAPI"],(function(i){i.getPropertiesForClass(e.data,{tenantId:a.getPlatformId(),lang:a.getLang(),apiVersion:"R2019x",onComplete:function(e){if(e&&e.length){var i={};e.forEach((function(e){var t=[];e.properties.forEach((function(e){void 0!==e.userAccess&&t.push(e)})),i[e.classInfo.curi.substring(e.classInfo.curi.lastIndexOf(":")+1)]=t})),t(i)}else t()},onFailure:function(){t()}})}))}))},_._getCreationParams=function(e){return d(f({onFailure:e.onFailure,onComplete:function(t){return(t=JSON.parse("string"==typeof t?t:null))&&t&&t.infos&&"OK"===t.infos.status&&t.result?void _._getTypeNLS(P).then((function(i){t.result.types=i,e.onComplete(t.result)})):e.onFailure()}},"POST","/resources/pimauthoring/service/generateName",{type:e.type,lang:a.getLang()}))},_._sendUsageProbe=function(e,t,i){if(b){var n=b.getPADTracker({eventCategory:"usage",eventAction:e}),r={eventLabel:t};void 0!==i&&(r.eventValue=i),n.setEventData(r),n.trackPageEvent()}else require(["DS/PADServices/utils/PADTrackerManager"],function(e,t,i,n){b=n,this._sendUsageProbe(e,t,i)}.bind(this,e,t,i))},_._sendUsageProbeNew=function(e){var i=e.eventValue&&Number.isInteger(e.eventValue)?e.eventValue:void 0,n=e.eventValue&&!Number.isInteger(e.eventValue)?e.eventValue:void 0,r={eventCategory:"usage",eventAction:e.eventAction?e.eventAction:void 0,eventLabel:e.eventLabel?e.eventLabel:void 0,appID:window.widget.data.appId,tenant:a.getPlatformId()};if(r.eventCategory&&r.eventAction){void 0!==i&&(r.eventValue=i),void 0!==n&&(r.persDim={pd1:n});try{s.trackPageEvent(r)}catch(e){t.log("Analytics request failed : "+e)}}else t.log("Not able to send trackpageEvent query: check eventCategory and eventAction input")},_._setRequestUtils=function(e){e.get3DSpaceUrl&&(a.get3DSpaceUrl=e.get3DSpaceUrl),e.getPlatformId&&(a.getPlatformId=e.getPlatformId),e.getSecurityContext&&(a.getSecurityContext=e.getSecurityContext),e.getLang&&(a.getLang=e.getLang)},_.getPlatformId=()=>a.getPlatformId(),_.getSecurityContext=()=>a.getSecurityContext(),_.getLang=()=>a.getLang(),_.get3DSpaceUrl=e=>a.get3DSpaceUrl(e);var v;return _._isDJCUrlAvailable=function(){var e=t.Promise.deferred();return v&&v.length>0?e.resolve(!0):require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"].concat([]),(function(t){t.getGrantedRoles((function(t){if(t.some((function(e){return"ICS"===e.id||1===window.top.__PIM_ICSRoleBypass}))){c(n.getPlatformId()).then((function(t){v=t,e.resolve(v&&v.length>0)}))}else e.resolve(!1)}))})),e.promise},_.getI3SRootStats=function(e){return new Promise((function(t){var i,n,r,o;d(f({onFailure:function(){t({})},onComplete:function(e){let i=JSON.parse(e);t(i)},outputFormat:"cvjson"},"POST","/cvservlet/progressiveexpand/v2",(n=[{physical_id_path:[(i=e).rootPhID]}],r={descending_condition:{uql:"availability:2"},descending_condition_object:{uql:'[ds6w:globaltype]:"ds6w:Document" OR [ds6w:globaltype]:"ds6w:Part"'},descending_condition_relation:{uql:"NOT (flattenedtaxonomies:'reltypes/XCADBaseDependency')"}},o=[{truncate:{max_distance_from_prefix:0,prefix_filter:{prefix_path:n}}}],{batch:{expands:[{label:l("I3SwebGetRootStats_ProgressiveExpand_Synthesis"),root:{physical_id:i.rootPhID},filter:{all:1},graph:r,aggregation_processors:[{synthesis:{name:"ProgressiveExpand_LeafSynthesis",mode:"tree_leaf",synthesis_only:1}}]},{label:l("I3SwebGetRootStats_ProgressiveExpand_Expand0"),root:{physical_id:i.rootPhID},filter:{prefix_filter:{prefix_path:n}},graph:r,aggregation_processors:o}]},outputs:{select_object:["physicalid","ds6w:type","ds6w:globalType","ds6w:label"],synthesis:["ProgressiveExpand_LeafSynthesis"]}})))}))},_.getLoginTicket=function(){return new Promise((function(t){var i=a.get3DSpaceUrl()+"/ticket/get?runasctx="+encodeURIComponent(a.getSecurityContext()).trim()+"&tenant="+a.getPlatformId();e.authenticatedRequest(i,{headers:{Accept:"application/json"},method:"GET",type:"json",onComplete:function(e){t(e.ticket)},onFailure:function(e){reject(new Error(e))}})}))},m})),define("DS/PIMwebViewModel/PIMwebIsr",["UWA/Core","UWA/Class","DS/CoreEvents/ModelEvents","DS/PIMwebViewModel/PIMwebUtils"],(function(e,t,i,n){"use strict";let r,o,s,a=1,l="ds6w:label",c="ds6w:type",u="ds6w:identifier",f="ds6wg:EnterpriseExtension.V_PartNumber",p="ds6w:responsible",d="owner",I="ds6w:description",m={1:"Clash",2:"Contact",3:"Clearance",4:"Contact",5:"NoInterference",6:"Undefined"},_={Clash:1,Contact:2,Clearance:3,NoInterference:5,Undefined:6},h={1:"OK",2:"KO",3:"NotAnalyzed",4:"NotAnalyzed",5:"NotAnalyzed"},P={1:"OK",2:"KO",3:"NotAnalyzed",4:"",5:"NotAnalyzed"},g={OK:1,KO:2,NotAnalyzed:3},y={"ds6w:description":"itfDescription","bo.PLMPIMMetricReference.V_Itf_Analysis":"itfAnalysis","bo.PLMPIMMetricReference.V_Itf_Previous_Analysis":"itfPrevAnalysis","bo.PLMPIMMetricReference.V_Itf_Type":"itfSystemType","bo.PLMPIMMetricReference.V_Itf_User_Type":"itfUserType","bo.PLMPIMMetricReference.V_Itf_Real_Tolerance_Used_For_First_Occurence":"itfLbl3DAccuracy1Shape","bo.PLMPIMMetricReference.V_Itf_Real_Tolerance_Used_For_Second_Occurence":"itfLbl3DAccuracy2Shape","bo.PLMPIMMetricReference.V_Itf_Real_Tolerance_Used_For_Computation":"itfTolerance","bo.PLMPIMMetricReference.V_Itf_Spec_Clearance_value":"itfClearVal","bo.PLMPIMMetricReferenceClashContact.V_Itf_Penetration_Value":"itfPenVec","bo.PLMPIMMetricReferenceClashContact.V_Itf_Clash_Volume":"itfPenVol","bo.PLMPIMMetricReferenceClearance.V_Itf_Distance_Min":"itfMinDist","bo.PLMPIMMetricReferenceClashContact.V_Itf_FirstPointFoundClash":"itfQtfPt1","bo.PLMPIMMetricReferenceClashContact.V_Itf_SecondPointFoundClash":"itfQtfPt2","bo.PLMPIMMetricReferenceClearance.V_Itf_FirstPointFoundClearance":"itfQtfPt1","bo.PLMPIMMetricReferenceClearance.V_Itf_SecondPointFoundClearance":"itfQtfPt2","bo.PLMPIMMetricReferenceFeature.V_Itf_Feature_UUID_1":"itfFeat1","bo.PLMPIMMetricReferenceFeature.V_Itf_Feature_UUID_2":"itfFeat2","bo.PLMPIMMetricReferenceFeature.V_Itf_Feature_Name_1":"itfFeatName1","bo.PLMPIMMetricReferenceFeature.V_Itf_Feature_Name_2":"itfFeatName2","bo.PLMPIMMetricReferenceIFC.V_Itf_IFC_UUIDs_1":"itfIFC1","bo.PLMPIMMetricReferenceIFC.V_Itf_IFC_UUIDs_2":"itfIFC2","bo.PLMPIMMetricReferenceIFC.V_Itf_IFC_Names_1":"itfIFCName1","bo.PLMPIMMetricReferenceIFC.V_Itf_IFC_Names_2":"itfIFCName2","bo.SIMItfContextOfInterferenceIFC.V_Itf_IFC_UUIDs":"ctxIFC","bo.SIMItfContextOfInterferenceIFC.V_Itf_IFC_Names":"ctxIFCName","ds6w:responsible":"itfOwner",owner:"itfOwnerID","ds6w:status":"itfCurrent"},C=["physicalid","type","itfMetricName","itfOwner","itfOwnerID","itfCurrent","itfDescription","itfAnalysis","itfPrevAnalysis","itfSystemType","itfUserType","itfLbl3DAccuracy1Shape","itfLbl3DAccuracy2Shape","itfTolerance","itfClearVal","itfPenVec","itfPenVol","itfMinDist","itfQtfPt1","itfQtfPt2","itfFeat1","itfFeat2","itfFeatName1","itfFeatName2","itfIFC1","itfIFC2","itfIFCName1","itfIFCName2"],b=["physicalid","itfCtxName","ctxIFC","ctxIFCName"];var F,v={};function M(){return Object.keys(v).length?Promise.resolve():(F||(F=new Promise((e=>{require(["DS/FedDictionaryAccess/FedDictionaryAccessAPI"],(function(t){t.getNlsOfPropertiesValues(JSON.stringify({"ds6w:status":["VPLM_SMB_Evaluation.PRIVATE","VPLM_SMB_Evaluation.IN_WORK","VPLM_SMB_Evaluation.FROZEN","VPLM_SMB_Evaluation.RELEASED","VPLM_SMB_Evaluation.OBSOLETE"]}),{tenantId:n.getPlatformId(),lang:n.getLang(),apiVersion:"R2019x",onComplete:function(t){v=t["ds6w:status"],F=null,e()},onFailure:function(){F=null,e()}})}))}))),F)}function D(e){var t=Number(e);return isNaN(t)||t<0?null:t}function S(e){var t=Number(e);return isNaN(t)?null:t}function w(e){return Object.keys(e).forEach((function(t){var i=y[t];i&&(e[i]=e[t],delete e[t])})),e.itfCurrent&&(e.itfCurrent=v[e.itfCurrent]||e.itfCurrent),e}function x(e){return e.itfCtxName=e[l],w(e),Object.keys(e).forEach((function(t){-1===b.indexOf(t)&&delete e[t]})),e}function L(e){return e.itfMetricName=e[l],e.type=e[c],w(e),Object.keys(e).forEach((function(t){-1===C.indexOf(t)&&delete e[t]})),e}function O(e){if(!e)return null;var t={physicalid:e.physicalid,label:e[l],owner:e[p],ownerID:e[d],type:e[c],revision:e["ds6wg:revision"],project:e["ds6w:project"],current:e.current?e.current:e["ds6w:status"],organization:e.organization};return e[f]&&(t.pn=e[f]),e[u]&&(t.identifier=e[u]),s&&s.indexOf(t.type)>-1&&(t.isBundleFst=!0),Object.freeze(t)}function N(t,i,n){var r=i.lIds.length;if(i.lNames.length!==r)return;if(!o[t])return;let s,a=[];for(s=0;s<r;s++){let l=i.lIds[s];if(!o[l]){let a=e.clone(o[t],!0);a.isIfcElt=!0,a.physicalid=l,a.label=i.lNames[s],a.type=s%2?"VPMReference":"VPMInstance",n&&s===r-2?a.type="VPMRepInstance":n&&s===r-1&&(a.type="VPMRepReference"),o[l]=a}a.push(i.lIds[s])}return a}function V(e){var t=String(window.widget?window.widget.id+"_":"")+e;window.top.performance.measure(t,t)}function T(e){window.top.performance.mark(String(window.widget?window.widget.id+"_":"")+e)}var R,A,U,E,j=(R=[],A=0,U=0,E=function(e,t,i){V("PIM_QueryCtx_"+e),A--,j(),setTimeout((function(){M().then((()=>{i(t)}))}),0)},function(t){t&&R.push(t),R.length&&A<5&&(A++,U++,function(t,i){T("PIM_QueryCtx_"+i);var r=e.clone(t,!1);r.onComplete=function(e){E(i,e,t.onComplete)},r.onFailure=function(e){E(i,e,t.onFailure)},r.onTimeout=function(e){E(i,e,t.onTimeout||t.onFailure)},n._navigateFromContextualInterferences(r)}(R.shift(),U))});return t.extend({init:function(e){let t=this,u={physicalid:e.id,isrContext:[],isrSpec:null,nbItfs:-2,itfs:{}},f=new i,y=function(e,i){return f.publish({event:e,data:i,context:t})};function C(){s=null,n._getBundleFasternerTypes().then((function(e){s=e.slice()}))}function b(e){if(e&&e.contextualIDs&&e.onProgress&&e.onComplete&&e.onFailure)if(0!==e.contextualIDs.length){var t,i=Math.floor((e.contextualIDs.length-1)/n._DEFAULT_PAGGING)+1,s=0,a=[],l=!1;for(t=function(t){e.onProgress({itfIDs:t.itfIDs,isrID:u.physicalid,metrics:t.metricIDs});var i=t.itfIDs,s=[],a=u.isrContext&&u.isrContext.length?u.isrContext[0].prd.physicalid:null;a&&i.forEach((function(e){var t=u.itfs[e];if(t.r2sca&&t.r2sca.forEach((function(e){-1===s.indexOf(e.physicalid)&&s.push(e.physicalid)})),t.metricID&&r[t.metricID]&&r[t.metricID].sca2occ){var i=[Boolean(r[t.metricID].itfIFC1),Boolean(r[t.metricID].itfIFC2)];r[t.metricID].sca2occ.forEach((function(e,t){let n=-1;i[t]?i[t]&&(n=e?e.length:-1):n=e?e.length-2:-1;for(var r=0;r<n;++r)-1===s.indexOf(e[r].physicalid)&&s.push(e[r].physicalid)}))}})),s.length?n._navigateOneLevel({ids:s,onComplete:function(n){var s,l,f=JSON.parse(n),p={};f&&f.infos&&"OK"===f.infos.status&&f.result&&(f.result.forEach((function(e){s=e.input_object,(l=e.outputs&&e.outputs.ref&&e.outputs.ref.length?e.outputs.ref[0]:null)&&(o[l.physicalid]||(o[l.physicalid]=O(l)),p[s.physicalid]=l.physicalid)})),t.metricIDs.forEach((function(e){var t=r[e];if(t){if(!t.path&&t.sca&&t.sca2occ&&t.sca2occ.length){var i=[Boolean(t.itfIFC1),Boolean(t.itfIFC2)];t.path=[null,null],t.sca2occ.forEach((function(e,t){if(e){var n,r;for(this[t]=[],i[t]?i[t]&&(r=e?e.length:-1):r=e?e.length-2:-1,n=0;n<r;++n){var o=e[n].physicalid;if(this[t].push(o),!(o=p[o])){this[t]=null;break}this[t].push(o)}this[t]&&r===e.length-2&&(this[t].push(e[n].physicalid),this[t].push(e[n+1].physicalid))}}),t.path),t.path[0]||t.path[1]||(t.path=null),delete t.sca2occ}}else window.console.log("No metric! At this point this is not possible")})),i.forEach((function(e){var t,i,n=u.itfs[e],o=r[n.metricID],s=[],l=0;if(a){if(s.push(a),t=(n.r2sca||[]).some((function(e){var t=e.physicalid;if(s.push(t),!(t=p[t]))return!0;s.push(t)})),i=s[s.length-1],n.ctxIFC&&!t){let e=N(i,{lIds:n.ctxIFC,lNames:n.ctxIFCName},!1);l=e.length,s=s.concat(e)}o&&o.path&&!t&&i&&i===o.sca&&(n.path=[null,null],o.path[0]&&(n.path[0]=s.concat(o.path[0])),o.path[1]&&(n.path[1]=s.concat(o.path[1]))),delete n.r2sca,o&&(o.itfIFC1&&o.itfIFCName1||o.itfIFC2&&o.itfIFCName2)&&(!t&&i&&i===o.sca&&(n.path||(n.path=[null,null]),n.ifcLen=[null,null],[{lIds:o.itfIFC1,lNames:o.itfIFCName1},{lIds:o.itfIFC2,lNames:o.itfIFCName2}].forEach((function(e,t){if(e&&e.lIds&&e.lNames){let r=N(n.path[t]?n.path[t][n.path[t].length-1]:i,e,!0);r&&(n.ifcLen[t]=l+r.length,n.path[t]=n.path[t]?n.path[t].concat(r):s.concat(r))}}))),o.itfIFC1&&delete o.itfIFC1,o.itfIFC2&&delete o.itfIFC2,o.itfIFCName1&&delete o.itfIFCName1,o.itfIFCName2&&delete o.itfIFCName2)}})),e.onProgress({interferingPathsReady:!0,itfIDs:i,isrID:u.physicalid,metrics:t.metricIDs}),c({itfIDs:i}))},onFailure:function(){c({itfIDs:i})}}):c({itfIDs:i})};s<i&&!l;)performance.mark("iteration"+s),j({ctxIDs:e.contextualIDs.slice(s*n._DEFAULT_PAGGING,(s+1)*n._DEFAULT_PAGGING),onComplete:function(e){if(!l){var i=JSON.parse(e);if(i&&i.infos&&"OK"===i.infos.status&&i.result){var n,s,a,c,f,p,d,I,m,_,h,P,g=(i=i.result).length,y=[],C=[];for(c=0;c<g;++c){if(s=x((n=i[c]).input_object),a=n.outputs.ms?n.outputs.ms[0]:null,y.push(s.physicalid),a&&-1===C.indexOf(a.physicalid)&&C.push(a.physicalid),a&&!r[a.physicalid]?r[a.physicalid]=L(a):a&&r[a.physicalid]&&(a=r[a.physicalid]),a&&!a.ctxt&&(a.ctxt=[]),a&&a.ctxt&&-1===a.ctxt.indexOf(s.physicalid)&&a.ctxt.push(s.physicalid),s.metricID=a?a.physicalid:null,u.itfs[s.physicalid]=s,n.outputs.r2sca&&n.outputs.r2sca.length)for(s.r2sca=[],f=0,_=n.outputs.r2sca[0].elements.length;f<_;++f)P=O(I=n.outputs.r2sca[0].elements[f]),o[I.physicalid]||(o[I.physicalid]=P),s.r2sca.push(P);if(n.outputs.sca&&n.outputs.sca.length>0&&a&&!a.sca&&(I=n.outputs.sca[0].elements[0],a.sca=I.physicalid,o[a.sca]||(o[a.sca]=O(I))),n.outputs.sca2occ&&a&&!a.sca2occ)for(a.sca2occ=[],f=0,_=n.outputs.sca2occ.length;f<_;++f){if(m=[],(d=n.outputs.sca2occ[f]).elements.length>1)for(p=0;p<d.elements.length;++p)P=O(I=d.elements[p]),o[I.physicalid]||(o[I.physicalid]=P),m.push(P);h="number"==typeof d.app_index&&d.app_index?d.app_index-1:"number"==typeof d.sr_id?d.sr_id-1:f,a.sca2occ[h]=m}n.outputs.repRef&&n.outputs.repRef.length&&a&&!a.repRef&&(a.repRef=n.outputs.repRef[0].physicalid)}t({itfIDs:y,metricIDs:C})}}},onFailure:function(t){l=!0,t||(t={}),t.step="Metrics",e.onFailure(t)}}),s++}else e.onComplete({itfIDs:[],metricIDs:[]});function c(t){l||(a.push.apply(a,t.itfIDs),t.error?(l=!0,t.error.step="Metrics",t.error.isrID=u.physicalid,e.onFailure(t.error)):a.length===e.contextualIDs.length&&e.onComplete({isrID:u.physicalid,itfIDs:a}))}}r={},o={},M(),this._fetch=function(e){u.physicalid&&e&&e.onProgress&&e.onComplete&&e.onFailure?e.contextualIDs?e.contextualIDs.length>0&&function(e){var t=a++;C(),T("PIM_QueryIsrToContext_"+t+"_"+u.physicalid),n._navigateFromIsrToContext({isrID:u.physicalid,onComplete:function(i){V("PIM_QueryIsrToContext_"+t+"_"+u.physicalid);var n,r,s,a=JSON.parse(i);a&&a.result&&1===a.result.length?(u.label=a.result[0].input_object[l],u.type=a.result[0].input_object[c],u.description=a.result[0].input_object[I],u.owner=a.result[0].input_object[p],u.ownerID=a.result[0].input_object[d],n=a.result[0].outputs&&a.result[0].outputs.prd,r=a.result[0].outputs&&a.result[0].outputs.filter,s=a.result[0].outputs&&a.result[0].outputs.spec,n=O(n),r=O(r),u.isrSpec=s,u.isrContext=n?[{prd:n,filter:r}]:[],u.nbItfs=-1,n&&!o[n.physicalid]&&(o[n.physicalid]=n),b({contextualIDs:e.contextualIDs,onProgress:e.onProgress,onComplete:e.onComplete,onFailure:e.onFailure})):e.onFailure()},onFailure:function(){V("PIM_QueryIsrToContext_"+t+"_"+u.physicalid),e.onFailure()}})}(e):function(e){if(!u.physicalid)return e.onFailure({error:"No valid Simulation ID parameter (iSimulationID)"}),void e.onFailure({step:"Simulation"});C();var i=a++;T("PIM_QueryIsr_"+i+"_"+u.physicalid),n._navigateFromIsr({isrID:u.physicalid,onComplete:function(r){V("PIM_QueryIsr_"+i+"_"+u.physicalid),n._sendUsageProbe("load","Isr");var s,a=JSON.parse(r);if(!a||!a.result||1!==a.result.length)return void e.onFailure({step:"Simulation"});if(!(s=a.result[0])||0===Object.keys(s.outputs).length)return void e.onFailure({step:"Simulation"});u.label=s.input_object[l],u.type=s.input_object[c],u.description=s.input_object[I],u.owner=s.input_object[p],u.ownerID=s.input_object[d],u.nbItfs=s.outputs.itfCtxt?s.outputs.itfCtxt.length:0,n._sendUsageProbe("load","IsrNbItfs",u.nbItfs);let f=O(s.outputs.prd),m=O(s.outputs.filter),_=(s.outputs.itfCtxt||[]).map((function(e){return e.physicalid}));u.isrSpec=s.outputs.spec,u.isrContext=f?[{prd:f,filter:m}]:[],f&&!o[f.physicalid]&&(o[f.physicalid]=f),e.onProgress({context:t.getIsrContexts()}),n._sendUsageProbe("load","IsrWithFilter",m?"Yes":"No"),b({contextualIDs:_,onProgress:e.onProgress,onComplete:e.onComplete,onFailure:e.onFailure})},onFailure:function(t){V("PIM_QueryIsr_"+i+"_"+u.physicalid),n._sendUsageProbe("load","IsrFailed"),t||(t={}),t.step="Simulation",e.onFailure(t)}})}(e):e.onFailure()},this.getAttributes=function(){return{physicalid:u.physicalid,label:u.label,type:u.type,description:u.description,owner:u.owner,ownerID:u.ownerID}},this.getIsrContexts=function(){return JSON.parse(JSON.stringify(u.isrContext))},this.getItfIDs=function(){return Object.keys(u.itfs)},this.getInterferences=function(e){var t=[];return(e?Array.isArray(e)?e:[e]:Object.keys(u.itfs)).forEach((function(e){var i=u.itfs[e],n=r[i.metricID],s={itfuid:e,itfModelId:u.physicalid,itfCtxName:i.itfCtxName,itfPath1:i.path&&i.path.length&&i.path[0]?i.path[0].map((function(e){return o[e]})):null,itfPath2:i.path&&i.path.length>1&&i.path[1]?i.path[1].map((function(e){return o[e]})):null,ifcLen1:i.ifcLen&&i.ifcLen.length>1&&i.ifcLen[0]&&i.ifcLen[0]>0?i.ifcLen[0]:0,ifcLen2:i.ifcLen&&i.ifcLen.length>1&&i.ifcLen[1]&&i.ifcLen[1]>0?i.ifcLen[1]:0};n?(s.itfMetricName=n.itfMetricName,s.itfSystemType=m[n.itfSystemType],s.itfUserType=m[n.itfUserType],s.itfAnalysis=h[n.itfAnalysis],s.itfPrevAnalysis=P[n.itfPrevAnalysis],s.itfPenVec=D(n.itfPenVec),s.itfPenVol=D(n.itfPenVol),s.itfMinDist=D(n.itfMinDist),s.itfDescription=n.itfDescription,s.itfLbl3DAccuracy1Shape=D(n.itfLbl3DAccuracy1Shape),s.itfLbl3DAccuracy2Shape=D(n.itfLbl3DAccuracy2Shape),s.itfTolerance=D(n.itfTolerance),s.itfClearVal=D(n.itfClearVal),s.itfOwner=n.itfOwner,s.itfOwnerID=n.itfOwnerID,s.itfCurrent=n.itfCurrent,s.itfQtfPt1=(s.itfPenVec||s.itfPenVol||s.itfMinDist)&&n.itfQtfPt1&&3===n.itfQtfPt1.length?n.itfQtfPt1.map(S):null,s.itfQtfPt2=(s.itfPenVec||s.itfPenVol||s.itfMinDist)&&n.itfQtfPt2&&3===n.itfQtfPt2.length?n.itfQtfPt2.map(S):null,s.itfQtfPt1&&s.itfQtfPt2||(s.itfQtfPt1=s.itfQtfPt2=null),s.itfFeat1=n.itfFeat1,s.itfFeat2=n.itfFeat2,s.itfFeatName1=n.itfFeatName1,s.itfFeatName2=n.itfFeatName2,s.mID=n.physicalid,s.mType=n.type,s.mRepRef=n.repRef,s.msca=n.sca):(s.itfMetricName=s.itfSystemType=s.itfUserType=s.itfAnalysis=s.itfPrevAnalysis=s.itfPenVec=s.itfPenVol=s.itfMinDist=s.itfClearVal=void 0,s.itfDescription=s.itfTolerance=s.itfOwner=s.itfOwnerID=s.itfCurrent=s.itfQtfPt1=s.itfQtfPt2=void 0,s.itfFeat1=s.itfFeat2=s.itfFeatName1=s.itfFeatName2=s.mID=s.mType=s.mRepRef=s.msca=void 0),t.push(s)})),t},this.reloadContextuals=function(e){!function(e){if(!u.physicalid)return e.onFailure({error:"No valid Simulation ID parameter (iSimulationID)"}),void e.onFailure({step:"Simulation"});var t=a++;T("PIM_QueryResult_"+t+"_"+u.physicalid),n._navigateFromIsrToResult({isrID:u.physicalid,onComplete:function(i){V("PIM_QueryResult_"+t+"_"+u.physicalid);var r,o=JSON.parse(i);o&&o.result&&1===o.result.length&&(r=o.result[0])&&0!==Object.keys(r.outputs).length?(u.nbItfs=r.outputs.itfCtxt?r.outputs.itfCtxt.length:0,n._sendUsageProbe("load","IsrNbItfs",u.nbItfs),b({contextualIDs:(r.outputs.itfCtxt||[]).map((function(e){return e.physicalid})),onProgress:e.onProgress,onComplete:e.onComplete,onFailure:e.onFailure})):e.onFailure({step:"Simulation"})},onFailure:function(i){V("PIM_QueryResult_"+t+"_"+u.physicalid),n._sendUsageProbe("load","IsrItfsFailed"),i||(i={}),i.step="Simulation",e.onFailure(i)}})}(e)},this.updateInterference=function(e){if(e.id&&u.itfs[e.id]&&"string"==typeof e.param){var t,i,o,s=u.itfs[e.id],a=r[s.metricID];switch(e.param){case"itfCtxName":t=s.physicalid,i="PLMEntity.V_Name",o=e.newValue;break;case"itfMetricName":t=a?a.physicalid:null,i="PLMEntity.V_Name",o=e.newValue;break;case"itfUserType":t=a?a.physicalid:null,i="PLMPIMMetricReference.V_Itf_User_Type",o=_[e.newValue];break;case"itfAnalysis":t=a?a.physicalid:null,i="PLMPIMMetricReference.V_Itf_Analysis",o=g[e.newValue];break;case"itfDescription":t=a?a.physicalid:null,i="PLMEntity.V_description",o=e.newValue;break;default:t=a?a.physicalid:null,i=e.param.replace("M:",""),o=e.newValue}if(t){var l={data:{id:t,attrName:i,attrValue:o},onComplete:function(t){var i="string"==typeof t?JSON.parse(t):{},n=[];i&&"success"===i.status?"itfCtxName"===e.param?(s.itfCtxName=o,n.push(e.id)):(a[e.param]=o,Array.prototype.push.apply(n,a.ctxt)):n.push(e.id),y("itfUpdateSuccess",n.map((function(e){return{id:e}})))},onFailure:function(){y("itfUpdateFailed",[{id:e.id}])}};n._setAttrValue(l)}else setTimeout((function(){y("itfUpdateFailed",[{id:e.id}])}),0)}else y("itfUpdateFailed",[{id:e.id}])},this.getLoadStatus=()=>-2===u.nbItfs?"notLoaded":-1===u.nbItfs?"partiallyLoaded":"fullyLoaded",this.getSpecAndContextInfo=function(e){if(!u.isrSpec||!u.isrSpec.physicalid)return window.console.error("isr without context and spec"),e.onFailure({error:"No specification available"});n._readIsrSpecStream({repRefID:u.isrSpec.physicalid,onComplete:function(i){if(!i||!i.infos||"OK"!==i.infos.status||!i.stream)return e.onFailure(i.infos.status);var n=i.stream;n.context=t.getIsrContexts()[0],n.isEditable=u.isrSpec.isEditable,e.onComplete(n)},onFailure:e.onFailure})},this.setSpecAndContextInfo=function(e){let t=u.isrSpec;if(!t||!t.physicalid||!t.isEditable)return window.console.error("isr without context and spec"),e.onFailure({error:"No specification available"});n._updateIsrContextAndSpec({isrID:u.physicalid,repRefID:t.physicalid,data:e.data,onFailure:e.onFailure,onComplete:t=>{u.isrContext[0].filter=O(t.filter),e.onComplete()}})},this.subscribe=function(e,t){return e&&t?f.subscribe({event:e},t):null},this.unsubscribe=function(e){null!=e&&f.unsubscribe(e)}}})})),define("DS/PIMwebViewModel/PIMwebIsrMgr",["DS/PIMwebViewModel/PIMwebIsr","DS/PIMwebViewModel/PIMwebUtils","DS/CoreEvents/ModelEvents"],(function(e,t,i){"use strict";var n={},r={},o=new i;function s(e,t){return o.publish({event:e,data:t})}function a(t){var i=n[t];if(!i){var o=new e({id:t});n[t]=i={isr:o,lock:0},r[t]=[],r[t].push(o.subscribe("itfUpdateSuccess",(function(e){e.isrID=t,s("itfUpdateSuccess",e)}))),r[t].push(o.subscribe("itfUpdateFailed",(function(e){e.isrID=t,s("itfUpdateFailed",e)})))}return i.isr}function l(e){var i=UWA.Promise.deferred(),n=e&&e.platformId?e.platformId:t.getPlatformId(),r=t.getSecurityContext(),o=t.get3DSpaceUrl(n);return function(){var e=UWA.Promise.deferred();return t.getLoginTicket().then((function(t){e.resolve(t)})),e.promise}().then((function(e){i.resolve({url:o,loginTicket:e,securityContext:r})})),i.promise}return Object.freeze({subscribe:function(e,t){return!e||!t||"itfUpdateSuccess"!==e&&"itfUpdateFailed"!==e?(window.console.error("Invalid event name"),null):o.subscribe({event:e},t)},unsubscribe:function(e){if(null!=e)return o.unsubscribe(e)},getLoadedIsr:function(){var e={};return Object.keys(n).forEach((function(t){e[t]=n[t].isr})),e},getCreationParams:e=>t._getCreationParams(e),createIsr:e=>t._createIsr(e),computeIsr:e=>t._computeIsr(e),getComputeIsrJobStatus:e=>t._getComputeIsrJobStatus(e),getIsrJobsList:e=>t._getIsrJobsList(e),getIsrJobsListByPage:e=>t._getIsrJobsListByPage(e),getMaxTokensForIsrCompute:e=>t._getMaxTokensForIsrCompute(e),getIsr:function(e){var t=n[e];return t?t.isr:null},isCSIExecuteUrlAvailable:function(){var e=UWA.Promise.deferred();return t._isDJCUrlAvailable().then((function(t){e.resolve(t)})),e.promise},isUpdateSimulationAllowed:function(e){var i=UWA.Promise.deferred();return t._isDJCUrlAvailable().then((function(t){var n,r="";window&&window.widget&&(n=window.widget,t&&(n.data&&n.data.appId&&(r=n.data.appId),("ENOR3M_AP"===r||"ENOI3S_AP"===r||e&&e.transAppID&&"I3S"===e.transAppID)&&i.resolve(!0))),i.resolve(!1)})),i.promise},get3DSpaceUrlAndLoginTicket:function(){var e=UWA.Promise.deferred();return l().then((function(t){e.resolve(t)})),e.promise},loadIsr:function(e){if(e&&e.isrID&&e.onProgress&&e.onComplete&&e.onFailure){var t=e.isrID,i=a(t);"fullyLoaded"!==i.getLoadStatus()?i._fetch({onProgress:function(n){e.onProgress({itfIDs:n.itfIDs,context:n.context,interferingPathsReady:n.interferingPathsReady,isrID:t,isr:i})},onComplete:function(){e.onComplete({isrID:t,isr:i,wasFullyLoaded:!1}),0===n[t].lock&&window.console.log("isr has not been locked!!!")},onFailure:function(r){delete n[t],i=null,e.onFailure(r)}}):(e.onProgress({itfIDs:i.getItfIDs(),context:i.getIsrContexts(),isrID:t,isr:i}),e.onComplete({isrID:t,isr:i,wasFullyLoaded:!0}))}else window.console.error("Invalid arguments")},reloadContextuals:function(e){if(e&&e.isrID&&e.onProgress&&e.onComplete&&e.onFailure){var t=e.isrID,i=a(t);i.reloadContextuals({onProgress:function(n){e.onProgress({itfIDs:n.itfIDs,context:n.context,interferingPathsReady:n.interferingPathsReady,isrID:t,isr:i})},onComplete:function(r){e.onComplete({isrID:t,isr:i,wasFullyLoaded:!1,itfIDs:r.itfIDs}),0===n[t].lock&&window.console.log("isr has not been locked!!!")},onFailure:function(t){e.onFailure(t)}})}else window.console.error("Invalid arguments")},loadIsrFromMetrics:function(e){e&&e.metrics&&e.onProgress&&e.onComplete&&e.onFailure?t._navigateFromMetricToIsr({metricIDs:e.metrics,onComplete:function(t){var i,r=JSON.parse(t),o={},s=[];r&&r.infos&&"OK"===r.infos.status&&r.result&&(r=r.result)&&Array.isArray(r)?(r.forEach((function(e){(i=e.outputs.isr?e.outputs.isr[0].physicalid:null)?(o[i]||(o[i]={itfC:[],itfM:[],label:e.outputs.isr[0]["ds6w:label"]}),o[i].itfC=o[i].itfC.concat(e.outputs.itfCtxt.map((function(e){return e.physicalid}))),-1===o[i].itfM.indexOf(e.input_object.physicalid)&&o[i].itfM.push(e.input_object.physicalid)):s.push(e.input_object.physicalid)})),Object.freeze(o),e.onFilterIsr({isrIDs:o,metricsWithoutIsr:s,onComplete:function(t){var i=t.length,r=function(){0==--i&&e.onComplete()};if(0===t.length)return i=1,void r();t.forEach((function(t){if(o[t]){var i=a(t);i._fetch({contextualIDs:o[t].itfC,onProgress:e.onProgress,onComplete:function(){e.onComplete({isrID:t,isr:i,wasFullyLoaded:!1}),0===n[t].lock&&window.console.log("isr has not been locked!!!"),r()},onFailure:function(){e.onFailure({isrID:t,isr:i,wasFullyLoaded:!1})}})}}))}})):e.onFailure()},onFailure:function(){e.onFailure()}}):e.onFailure()},lockIsr:function(e){var t=n[e];return t?(t.lock++,0):(window.console.log(e+" has not been loaded"),-1)},unlockIsr:function(e){var t=n[e];return t?(t.lock--,0===t.lock&&(t=n[e]=null,delete n[e]),0):(window.console.log(e+" has not been loaded"),-1)}})}));