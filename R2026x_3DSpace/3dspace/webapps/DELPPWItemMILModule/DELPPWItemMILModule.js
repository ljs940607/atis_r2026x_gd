define("DS/DELPPWItemMILModule/MfgItemMILBaseUI",["UWA/Core"],(function(e){"use strict";return function(t,n,o,a,l,i){var s,r,c,u={className:""},d=null;return s=function(s){var g,p,f=n.create("Element","div",{class:"mil-panel-container"}),m=n.create("Element","div",{class:"mil-tree-container"}).inject(f),I=n.getComponent("Button"),L=s.cancelButtonLabel||l.getNLSValue("PanelButton.Cancel"),M=s.manageInconsistentLinksCmdId;c=e.is(s.cleanup,"function")?s.cleanup:null,g=a.getWUXNodeModel(),o.loadDocument(g),o.getContent().inject(m),p={shouldBeSelected:function(t){const n=t.options.milStatus;let o=!0;return e.is(n)&&(o="success"!==n),o}},e.extend(g.options,p),(d=n.create("Dialog",{identifier:"MIL-UI",domId:"MILUI-dialog",title:l.getNLSValue("ManageInconsistentLinksUI.PanelTitle"),resizableFlag:!0,visibleFlag:!1,modalFlag:!0,content:f,height:315,width:600,snappableFlag:!1,buttons:{Ok:new I({disabled:!0,label:l.getNLSValue("MIL.PanelOkButton"),emphasize:"primary",onClick:function(){e.is(u.onApplyCallBack,"function")&&u.onApplyCallBack()}}),Cancel:new I({label:L,onClick:function(){d.close()}})}})).close=function(){i.getBICmdState()||i.resetBIModelCollection(),e.is(M)?t.notify("toggleCmdCheckHeaderState",{cmdName:M,cmdState:!1}):r()}},r=function(){d.hide()},{buildSkeleton:function(t){u=e.extend(u,t),s(u)},destroy:function(t){!!e.is(t,"boolean")&&t?e.is(c,"function")&&c():this.isActive()&&r(),e.is(a)&&a.emptyNodeModel(),e.is(d)&&(d.destroy(),d=null)},isActive:function(){return!!e.is(d)&&d.visibleFlag},loadUI:function(){e.is(d)&&!1===d.visibleFlag&&d.show()},setApplyButtonState:function(){var e=!1;a.getSelectedNodesInfo().length>0&&(e=!0),d.buttons.Ok.disabled=!e},updateApplyButtonState:function(t){const n=!!e.is(t,"boolean")&&t;d.buttons.Ok.disabled=!n}}}})),define("DS/DELPPWItemMILModule/MFNChangeImpactMgmtUI",["UWA/Core","DS/DELPPWItemMILModule/MfgItemMILBaseUI"],(function(e,t){"use strict";const n=function(t,n){const o=n||null;let a=new Map;return(...n)=>{const l=e.is(o,"function")?o(...n):n[0];let i;return a.has(l)?i=a.get(l):(i=t(...n),a.set(l,i)),i}},o=function(e){return Array.isArray(e)&&e.length>1},a=function(e,t=null){const n=e.length;return n>0?e[n-1]:t},l=function(e,t=null){return e.length>0?e[0]:t},i=function(e,t){return e.add(t)},s=function(e,t){let n=new Set(e);for(const e of t)n.add(e);return n},r=(...e)=>t=>e.reduce(((e,t)=>t(e)),t),c=(u=",",e=>e.split(u));var u;const d=r(c,a),g=r(c,l),p=e=>(...t)=>t.join(e),f=p(" "),m=p(","),I=function(e){let t,n=new Map;return{from(e){return t=e,this},addDefaultOption(){return n.set(t.value,{labelItem:t.label,valueItem:t.value,tooltipItem:t.tooltip}),this},addReplaceByBranchOption(){return n.set(e.Replace_By_NewBranch.value,{labelItem:e.Replace_By_NewBranch.label,valueItem:e.Replace_By_NewBranch.value,tooltipItem:e.Replace_By_NewBranch.tooltip}),this},addReplaceByNewOption(){return n.set(e.Replace_By_New.value,{labelItem:e.Replace_By_New.label,valueItem:e.Replace_By_New.value,tooltipItem:e.Replace_By_New.tooltip}),this},addDeleteOption(){return n.set(e.Delete.value,{labelItem:e.Delete.label,valueItem:e.Delete.value,tooltipItem:e.Delete.tooltip}),this},addMadeFromUseCaseAssembly(){n.set(e.MadeFrom_UseCase_Att_Add_ManufacturingAssembly.value,{labelItem:e.MadeFrom_UseCase_Att_Add_ManufacturingAssembly.label,valueItem:e.MadeFrom_UseCase_Att_Add_ManufacturingAssembly.value,tooltipItem:e.MadeFrom_UseCase_Att_Add_ManufacturingAssembly.tooltip})},addMadeFromUseCaseFabrication(){return n.set(e.MadeFrom_UseCase_Att_Add.value,{labelItem:e.Delete.label,valueItem:e.Delete.value,tooltipItem:e.Delete.tooltip}),this},addRerouteOption(){return n.set(e.Reroute_ImplementAndScopeLink.value,{labelItem:e.Reroute_ImplementAndScopeLink.label,valueItem:e.Reroute_ImplementAndScopeLink.value,tooltipItem:e.Reroute_ImplementAndScopeLink.tooltip}),this},addReplaceByNewRevisionOption(){return n.set(e.Replace_By_NewRev.value,{labelItem:e.Replace_By_NewRev.label,valueItem:e.Replace_By_NewRev.value,tooltipItem:e.Replace_By_NewRev.tooltip}),this},addEvolveInstanceOption(){return n.set(e.Evolve_Instance.value,{labelItem:e.Evolve_Instance.label,valueItem:e.Evolve_Instance.value,tooltipItem:e.Evolve_Instance.tooltip}),this},addRerouteOnlyOption(){return n.set(e.Reroute_ImplementLink.value,{labelItem:e.Reroute_ImplementLink.label,valueItem:e.Reroute_ImplementLink.value,tooltipItem:e.Reroute_ImplementLink.tooltip}),this},addAdditionalOptions(){switch(t){case e.Replace_By_NewRev:this.addReplaceByNewOption().addReplaceByBranchOption().addRerouteOption().addDeleteOption().addEvolveInstanceOption();break;case e.Replace_By_NewBranch:this.addReplaceByNewRevisionOption().addReplaceByNewOption().addRerouteOption().addDeleteOption().addEvolveInstanceOption();break;case e.Replace_By_New:this.addReplaceByNewRevisionOption().addReplaceByBranchOption().addRerouteOption().addDeleteOption().addEvolveInstanceOption();break;case e.Replace_By_Existing:case e.Reroute_ImplementAndScopeLink:this.addReplaceByNewRevisionOption().addReplaceByNewOption().addReplaceByBranchOption().addRerouteOption().addDeleteOption().addEvolveInstanceOption();break;case e.Reroute_ImplementLink:this.addReplaceByNewRevisionOption().addReplaceByNewOption().addReplaceByBranchOption().addDeleteOption().addEvolveInstanceOption();break;case e.Evolve_Instance:this.addReplaceByNewRevisionOption().addReplaceByNewOption().addReplaceByBranchOption().addDeleteOption().addRerouteOnlyOption();break;case e.MadeFrom_UseCase_Att_Add:this.addMadeFromUseCaseAssembly()}return this},addIgnoreOption(){return n.set(e.Ignore.value,{labelItem:e.Ignore.label,valueItem:e.Ignore.value}),this},removeOptions(e){for(const t of e)n.delete(t);return this},toArray:()=>Array.from(n.values())}};return function(u,p,L,M,v,_,h,b,R,S){let y,N,A,P=null,B=null;const w="#SELECT",O="success",C={Reroute_ScopeLink:{label:h.getNLSValue("MIL.Reroute.ScopeLink"),value:1,tooltip:h.getNLSValue("MIL.ToolTip.RerouteScope"),getLabel:function(){return this.tooltip}},Reroute_ImplementAndScopeLink:{label:h.getNLSValue("MIL.Reroute.ImplementAndScopeLink"),value:2,tooltip:h.getNLSValue("MIL.ToolTip.Reroute"),getLabel:function(){return this.tooltip}},Reroute_ImplementLink:{label:h.getNLSValue("MIL.Reroute.ImplementLink"),value:3,tooltip:h.getNLSValue("MIL.ToolTip.RerouteImplement"),getLabel:function(){return this.tooltip}},Replace_By_Existing:{label:h.getNLSValue("MIL.ReplaceByExisting"),value:5,tooltip:h.getNLSValue("MIL.ToolTip.ReplaceByExisting"),getLabel:function(){return this.tooltip}},Delete:{label:h.getNLSValue("MIL.Delete"),value:6,tooltip:h.getNLSValue("MIL.ToolTip.Delete"),getLabel:function(){return this.tooltip}},Ignore:{label:h.getNLSValue("MIL.Ignore"),value:7,getLabel:function(){return this.label}},Ambiguous:{label:h.getNLSValue("MIL.Ambiguous"),value:8,getLabel:function(){return this.label}},Replace_By_NewRev:{label:h.getNLSValue("MIL.ReplaceByNewRevision"),value:9,tooltip:h.getNLSValue("MIL.ToolTip.ReplaceByNewRev"),getLabel:function(){return this.tooltip}},Replace_By_New:{label:h.getNLSValue("MIL.ReplaceByNew"),value:10,tooltip:h.getNLSValue("MIL.ToolTip.ReplaceByNew"),getLabel:function(){return this.tooltip}},Replace_By_NewBranch:{label:h.getNLSValue("MIL.ReplaceByNewBranch"),value:11,tooltip:h.getNLSValue("MIL.ToolTip.ReplaceByNewBranch"),getLabel:function(){return this.tooltip}},Evolve_Instance:{label:h.getNLSValue("MIL.EvolveInstance"),value:12,tooltip:h.getNLSValue("MIL.ToolTip.EvolveInstance"),getLabel:function(){return this.tooltip}},MadeFrom_UseCase_Att_Add:{label:h.getNLSValue("MIL.MadeFrom_UseCase_Att_Add.ManufacturingMadeFrom"),value:13,tooltip:h.getNLSValue("BI.MfgStatus.MadeFrom_UseCase_Att_Good.ManufacturingMadeFrom"),getLabel:function(){return this.tooltip}},MadeFrom_UseCase_Att_Add_ManufacturingAssembly:{label:h.getNLSValue("MIL.MadeFrom_UseCase_Att_Add.ManufacturingAssembly"),value:14,tooltip:h.getNLSValue("BI.MfgStatus.MadeFrom_UseCase_Att_Good.ManufacturingAssembly"),getLabel:function(){return this.tooltip}},MadeFrom_UseCase_Att_Remove:{label:h.getNLSValue("MIL.MadeFrom_UseCase_Att_Remove"),value:15,tooltip:h.getNLSValue("BI.MfgStatus.MadeFrom_UseCase_Att_Remove"),getLabel:function(){return this.tooltip}}},k="ReplaceByNewRev",D="ReplaceByExisting",U="ReplaceByNew",E="ReplaceByNewBranch",V="RerouteIL",F="ReconnectSLnIL",T="ReconnectSL",x="Delete",j="EvolveInstance",W="ManufacturingMadeFrom",z="ManufacturingAssembly",H="RemoveUseCase",$=function(t,n){let o=f(t.get("PLMEntity.V_Name"),t.get("revision"));return e.is(n)&&(o+="("+n.get("PLMInstance.PLM_ExternalID")+")"),o},G=e=>!_.isReference(e),X=e=>!_.isInstance(e),q=function(e){e.data.nodeModel.select()},K=function(t){return e.is(t.options.unselectEventToken)},J=function(e){return e.options.grid.MIL_suggestion},Q=t=>n=>{let o=!1;const a=J(n);return e.is(a)&&(o=a.value===t),o},Y=function(t){let n=!1;if(function(t){let n=!1;const o=(e=>e.options.defaultMILSuggestionValue)(t);return e.is(o)&&(n=Q(o)(t)),n}(t)){const o=J(t);e.is(o)&&(n=[C.Replace_By_NewRev,C.Replace_By_NewBranch,C.Reroute_ScopeLink].some((e=>e.value===o.value)))}return n},Z=function(e){K(e)&&(e.removeEventListener(e.options.unselectEventToken),e.options.unselectEventToken=null)},ee=function(e){return e.getAttributeValue("cellInfo")},te=function(e){return g(e)},ne=function(t,n){const o=(e,t)=>({invalidNodes:e,errorMessage:t}),a=(e=>{let t=null;const n=e.filter((e=>(e=>"collapsed"===e.getState())(e)||(e=>e.isVisible()&&"partiallyExpanded"===e.getState())(e)&&J(e).value!==C.Ignore.value));if(n.length>0)if(n[0].isRoot()){const e=h.getNLSValue("MIL.expandNeededRoots");t=o(n,e)}else{const e=h.getNLSValue("MIL.expandNeededSAs");t=o(n,e)}return t})(t);const l=e.is(a);return l&&p.showWithMessage("",a.errorMessage,{messages:a.invalidNodes.map((e=>e.getLabel())),token:n}),!l},oe=function(t,n){const o=(e,t)=>({invalidNodes:e,errorMessage:t}),a=t=>{let n=null;const a=t.filter((t=>((e=>"partiallyExpanded"===e.getState())(t)||(e=>"collapsed"===e.getState())(t))&&function(t){let n=!1;return(t=>{let n=!1;const o=ee(t);return e.is(o)&&(n=o.isLeaf),n})(t)||(n=Y(t)),n}(t)));if(a.length>0){const e=h.getNLSValue("MIL.expandNeededSAs");n=o(a,e)}return n},l=t=>{let n=null;const a=t.filter((t=>(t=>{let n=!1;const o=J(t);if(e.is(o)&&o.value!==C.Delete.value&&o.value!==C.Ignore.value&&o.value!==C.MadeFrom_UseCase_Att_Remove.value&&o.value!==C.MadeFrom_UseCase_Att_Add.value&&o.value!==C.MadeFrom_UseCase_Att_Add_ManufacturingAssembly.value){const o=ee(t);if(e.is(o)){const t=o.candidateId;n=!e.is(t)}}return n})(t)));if(a.length>0){const e=h.getNLSValue("MIL.candidateNeeded");n=o(a,e)}return n},i=(t=>{let n=a(t);return e.is(n)||(n=l(t)),n})(t),s=e.is(i);return s&&p.showWithMessage("",i.errorMessage,{messages:i.invalidNodes.map((e=>e.getLabel())),token:n}),!s},ae=function(t){return e.owns(t,"isRef")&&!0===t.isRef},le=function(t){return e.owns(t,"isLeaf")&&!0===t.isLeaf},ie=e=>o(e),se=function(t){const o=Q(C.Ignore.value),i=n((t=>{let n={};if(!o(t)&&t.options.milStatus!==O){const o=ee(t);if(e.is(o)){let l,s=e.clone(o.inconsistentObject);if(ie(o.candidateEntries)){const{candidatePathStr:t,candidateProductRefId:n}=(t=>{let n={candidatePathStr:null,candidateProductRefId:null};if(e.owns(t,"candidateOccPath")&&Array.isArray(t.candidateOccPath)){const o=t.candidateOccPath;if(n.candidatePathStr=o.join(","),ae(t.inconsistentObject))n.candidateProductRefId=a(o);else{const t=_.getInstance(a(o));e.is(t)&&(n.candidateProductRefId=t.get("isInstanceOf"))}}return n})(o);e.is(t)&&e.is(n)&&(s.candidatePaths=[t],e.owns(s,"candidateProduct")&&(s.candidateProduct=n))}if(s=((e,t)=>{let n=e;switch(t){case C.Replace_By_Existing.value:n.MbomUpdateAction=D,Array.isArray(n.candidateScopedMfgItem)&&1===n.candidateScopedMfgItem.length&&(n.referecePID=n.candidateScopedMfgItem[0]);break;case C.Reroute_ImplementLink.value:n.MbomUpdateAction=V,n.referecePID=n.isInstanceOf;break;case C.Evolve_Instance.value:n.MbomUpdateAction=j,n.referecePID=n.isInstanceOf;break;case C.Reroute_ImplementAndScopeLink.value:n.MbomUpdateAction=F,n.referecePID=n.isInstanceOf;break;case C.Replace_By_New.value:n.MbomUpdateAction=U,n.referecePID=n.isInstanceOf;break;case C.Replace_By_NewBranch.value:n.MbomUpdateAction=E,n.referecePID=n.isInstanceOf;break;case C.Delete.value:n.MbomUpdateAction=x;break;case C.Replace_By_NewRev.value:n.MbomUpdateAction=k,n.referecePID=n.isInstanceOf;break;case C.Reroute_ScopeLink.value:n.MbomUpdateAction=T;break;case C.MadeFrom_UseCase_Att_Add.value:n.MbomUpdateAction="ManufacturingMadeFrom";break;case C.MadeFrom_UseCase_Att_Add_ManufacturingAssembly.value:n.MbomUpdateAction="ManufacturingAssembly";break;case C.MadeFrom_UseCase_Att_Remove.value:n.MbomUpdateAction="RemoveUseCase"}return n})(s,o.action),e.owns(s,"aggregatedByPath")&&(s.rootMfgItemPID=te(s.aggregatedByPath)),s.MbomUpdateAction===T?s.referecePID=s.id:(s.instancePID=d(s.id),s.mfgOccPathPIDs=s.id),s.brokenMfgPID=o.mbomId,l=s.MbomUpdateAction!==x&&s.MbomUpdateAction!==W&&s.MbomUpdateAction!==z&&s.MbomUpdateAction!==H?m(s.candidatePaths):s.id,t.hasChildren()){let e={};for(const n of t.getChildren(!0)){const t=i(n);e={...e,...t}}s.children=e}n[l]=[s]}}return n})),s=(t,n)=>{let o={...t};const a=(t=>Object.values(t).reduce(((t,n)=>{const o=n.reduce(((t,n)=>(e.owns(n,"children")&&(t=t.concat(n.children)),t)),[]);return t.concat(o)}),[]))(n);a.length>0&&a.forEach((e=>{Object.keys(e).forEach((e=>{delete o[e]}))}));const l=Object.entries(n).reduce(((t,[n,a])=>(t[n]=e.owns(o,n)?o[n].concat(a):a,t)),{});return{...o,...l}},r=n((n=>{let o=t.filter((e=>e.isRoot())).find((e=>e.getReferencePID()===n));return e.is(o)||(o=null),o})),c=t=>{let n=null;if((t=>e.is(r(t)))(t)){const o=r(t),{candidateId:a}=(t=>{let n={candidateId:null,candidateOccPath:null};const o=ee(t);return e.is(o)&&(n.candidateId=o.candidateId,n.candidateOccPath=o.candidateOccPath),n})(o);n=a}else n=function(e){let t=null;const n=S.getScopeLinksOfImplementing(e);return 1===n.length&&(t=l(n).get("to")),t}(t);let o="";return e.is(n)&&e.owns(A,n)&&(o=A[n]),o},u=(t,n)=>{let o;if(e.owns(n,"engConfigFilter")&&e.owns(n,"mfgConfigFilter"))o=n;else{const l=(a=t,e.owns(N,a)?N[a]:""),i=c(t);o={...n,engConfigFilter:i,mfgConfigFilter:l}}var a;return o},g=e=>(e=>{let t;return t=e.MbomUpdateAction===T?e.brokenMfgPID:e.rootMfgItemPID,t})(l(e)),p=new Set(t),f=(t=>{const n=Object.entries(t).reduce(((t,[n,o])=>{const a=g(o),l={brokenMfgItems:{[n]:o}};if(e.owns(t,a)){const e=t[a];t[a]={...e,brokenMfgItems:{...e.brokenMfgItems,...l.brokenMfgItems}}}else t[a]=l;return t[a]=u(a,t[a]),t}),{});return n})(t.filter((e=>e.getParents().every((e=>!p.has(e))))).reduce(((e,t)=>{const n=i(t);return e=s(e,n)}),{}));return f},re=function(){const t=(t,n)=>t.filter((t=>{let o=!1;const a=ee(t);return e.is(a)&&(o=n(a)),o})),n=M.getAllDescendants(),o=n.filter((e=>e.isRoot())),a=h.getNLSValue("MIL.LogMessage"),l=u.log(a);if(ne(o,l)){const o=n.filter((e=>!(e.isRoot()&&null===e.options.defaultMILSuggestionValue)));if(o.length>0)if(oe(o,l)){o.filter((e=>Q(C.Ignore.value)(e))).forEach((e=>{e.options.grid.MIL_status="",e.options.milStatus=null,e.updateOptions(e.options)})),(t=>new Promise(((n,o)=>{let a=!1;const l=t.filter((e=>K(e)));if(l.length>0){const t=C.Ignore.value,i=l.filter((e=>J(e).value===t));if(i.length>0){a=!0;const t=h.getNLSValue("MIL.confirmIgnoreToLooseIL.Title"),l=h.getNLSValue("MIL.confirmIgnoreToLooseIL"),s=i.map((e=>_.getReference(e.getReferencePID())));p.showConfirmation(t,l,{attributes:["PLMEntity.V_Name","revision"],models:s},(function(t){e.is(t,"boolean")?n(t):o("Unknown value")}))}}a||n(!0)})))(o).then((function(n){if(n){const n=o.filter((t=>e.is(ee(t)))),i=se(n),r=h.getNLSValue("MIL.confirmationDialog.Title");if(e.is(i))if(0===Object.keys(i).length||0===n.filter((e=>e.options.grid.MIL_status!==h.getNLSValue("MIL.Status.Success"))).length)u.warn(h.getNLSValue("MIL.WarnMsg.NoActionChosen"));else{let o=h.getNLSValue("MIL.confirmationDialog.Message"),c=null,g="";n.forEach((t=>{if(e.is(t)&&t.options.grid.MIL_status!==h.getNLSValue("MIL.Status.Success")){const e=t.getRoot().getLabel();e!==c&&(null!==c&&(o+=g),c=e,g=`<br> <strong><u>${e}</u></strong>`);let n=function(e){let t="";const n=`<b>${_.sanitizeHTML(e.options.grid.MIL_previous)}</b>`,o=`<b>${_.sanitizeHTML(e.options.grid.MIL_rerouting.label)}</b>`,a=`<b>${_.sanitizeHTML(e.options.label)}</b>`,l=e.options.grid.MIL_suggestion.value,i={[C.Replace_By_NewRev.value]:h.getNLSValue("MIL.confirmationDialog.ReplacedByNewRev"),[C.Replace_By_NewBranch.value]:h.getNLSValue("MIL.confirmationDialog.ReplacedByNewBranch"),[C.Replace_By_New.value]:h.getNLSValue("MIL.confirmationDialog.Replaced"),[C.Replace_By_Existing.value]:h.getNLSValue("MIL.confirmationDialog.Existing"),[C.Ignore.value]:h.getNLSValue("MIL.confirmationDialog.Ignored"),[C.Delete.value]:h.getNLSValue("MIL.confirmationDialog.Deleted"),[C.Reroute_ImplementLink.value]:h.getNLSValue("MIL.confirmationDialog.Rerouted"),[C.Reroute_ImplementAndScopeLink.value]:h.getNLSValue("MIL.confirmationDialog.Rerouted"),[C.Evolve_Instance.value]:h.getNLSValue("MIL.confirmationDialog.Evolved"),[C.Reroute_ScopeLink.value]:h.getNLSValue("MIL.confirmationDialog.Reconnect"),[C.MadeFrom_UseCase_Att_Add_ManufacturingAssembly.value]:h.getNLSValue("MIL.confirmationDialog.UseCaseAssembly"),[C.MadeFrom_UseCase_Att_Add.value]:h.getNLSValue("MIL.confirmationDialog.UseCaseFabrication"),[C.MadeFrom_UseCase_Att_Remove.value]:h.getNLSValue("MIL.confirmationDialog.Remove")}[l];switch(t=h.getNLSValue("MIL.confirmationDialog.ContentLine",{obj1:a,pointingProductName:n,action:i}),l){case C.Replace_By_NewRev.value:case C.Replace_By_NewBranch.value:case C.Replace_By_New.value:case C.Replace_By_Existing.value:case C.Reroute_ImplementLink.value:case C.Reroute_ImplementAndScopeLink.value:case C.Evolve_Instance.value:case C.Reroute_ScopeLink.value:t=h.getNLSValue("MIL.confirmationDialog.ContentLineCandPrd",{obj1:a,pointingProductName:n,action:i,candidateProductName:o});break;case C.MadeFrom_UseCase_Att_Add_ManufacturingAssembly.value:case C.MadeFrom_UseCase_Att_Add.value:case C.MadeFrom_UseCase_Att_Remove.value:t=h.getNLSValue("MIL.confirmationDialog.ContentLineOnlyAction",{obj1:a,action:i})}return t}(t);g+=`<br> &nbsp; â†’ ${n}`}})),null!==c&&(o+=g),p.showConfirmation(r,o,{models:i},(function(o,i){var r;o&&(r=i,new Promise(((t,n)=>{v.webservice("rerouteLink",null,r,(function(o){e.is(o)?t(o):n()}))}))).then((function(o){M.prepareUpdate();const i=o.succeeded;if(e.is(i)){const e=Object.values(i);if(e.length>0){const o=e.reduce(((e,t)=>{const n=Object.keys(t).map((e=>d(e)));return s(e,new Set(n))}),new Set),a=t(n,(e=>o.has(e.mbomId))),i=e=>{let t=[];if(e.hasChildren()){const n=e.getChildren(!0);t=n.filter((e=>!Q(C.Ignore.value)(e))),t.forEach((e=>{t=t.concat(i(e))}))}return t},r=a.reduce(((e,t)=>(e.push(t),e=e.concat(i(t)))),[]),c=(e=>t=>{let n=t;const o=function(e){return e.getInstancePID()||e.getReferencePID()}(n);M.unSelectNode(o),n.options.grid.MIL_status=h.getNLSValue("MIL.Status.Success"),n.options.milStatus=O,n.updateOptions(n.options);const a=n.options.grid,l=h.getNLSValue("MIL.Message.Success",{suggestion:a.MIL_suggestion.label,mfg:n.getLabel()});u.log(l,e)})(l);r.forEach(c)}}const r=o.failed;e.is(r)&&Object.values(r).forEach((e=>{const o=Object.keys(e).reduce(((e,t)=>{const n=d(t);return e.set(n,t)}),new Map),a=t(n,(e=>o.has(e.mbomId))),i=(e=>(t,n)=>{let o=t;o.options.grid.MIL_status=n,o.options.milStatus="fail",o.options.grid.cellInfo.inconsistentObject.MbomUpdateAction=null,o.updateOptions(o.options);const a=o.options.grid,l=h.getNLSValue("MIL.Message.Failure",{suggestion:a.MIL_suggestion.label,mfg:o.getLabel(),failureMsg:n});u.log(l,e)})(l);a.forEach((t=>{const n=ee(t).mbomId,a=o.get(n),l=h.getNLSValue(e[a].message,null,"MIL","FailureMessage");i(t,l)}))})),M.pushUpdate(),(t=>{let n=!1;return e.is(t.failed,"object")&&(n=Object.keys(t.failed).length>0),n})(o)?u.warn(h.getNLSValue("MIL.Failure"),l):u.info(h.getNLSValue("MIL.Success"),l),u.log(f(a,h.getNLSValue("completed")),l,"completed")})).catch((function(){u.log("rerouteLink webservice failed"),u.log(f(a,h.getNLSValue("failed")),l,"failed")}))}),{buttonOkLabel:h.getNLSValue("MIL.PanelApplyButton"),isHTML:!0})}else u.log("rerouteLink webservice failed")}else u.log(f(a,h.getNLSValue("failed")),l,"failed")}))}else u.log(f(a,h.getNLSValue("failed")),l,"failed")}},ce=function(t,n){const o=t=>new Promise(((o,a)=>{if(n.size>0){const l=t.filter((function(t){return!e.owns(t._attributes,"isInstanceOf")})).map((e=>e.get("PID")));if(l.length===n.size&&l.every((e=>n.has(e))))o();else{const e=new Set(l),t=function(e,t){const n=e.size<t.size;let o=new Set(e);for(const e of t)if(o.delete(e),n&&0===o.size)break;return o}(n,e);t.size>0?_.fetchRoot(Array.from(t),{forceDBMode:!0,silent:!0,onComplete:o,onFailure:a}):o()}}else o()}));return(a=Array.from(t),new Promise(((t,n)=>{a.length>0?_.fetchInstancesAndTheirReferences(a,{onComplete:function(o){e.owns(o,"instancesAndReferences")?t(o.instancesAndReferences):n("callbackResult.instancesAndReferences is not valid")},onFailure:n}):t([])}))).then((function(e){return o(e)}));var a},ue=function(t){const n=e.owns(t,"candidatePaths"),o=t.status;let a=null;if(n){const n=e.owns(t,"candidateScopedMfgItem");switch(t.status){case"ImplCandidatePrdOccWithScopeToOldRev":case"ImplCandPrdOccToOtherRev":a=n?C.Replace_By_Existing:C.Replace_By_NewRev;break;case"ImplCandidatePrdOccButNotCorrespondingScope":case"ImplCandPrdOccToDiffPrd":a=n?C.Replace_By_Existing:C.Replace_By_New;break;case"ImplCandidatePrdOccWithGoodScope":a=C.Reroute_ImplementLink;break;case"ImplCandPrdOccToSamePrdEvolveInstance":case"ImplCandidatePrdOccWithGoodScopeEvolveInstance":a=C.Evolve_Instance;break;case"ImplCandPrdOccToSamePrd":a=C.Reroute_ImplementAndScopeLink;break;case"ImplNoProductOccurence":a=C.Delete;break;case"ScopeToAncestorBranch":case"ScopeToOldRev":case"ScopeToNew":a=C.Reroute_ScopeLink;break;case"ImplCandPrdOccToAncestorBranch":case"ImplCandidatePrdOccWithScopeToAncestorBranch":a=n?C.Replace_By_Existing:C.Replace_By_NewBranch}}else a="MadeFrom_UseCase_Att_Add"===o?C.MadeFrom_UseCase_Att_Add:"MadeFrom_UseCase_Att_Remove"===o?C.MadeFrom_UseCase_Att_Remove:C.Delete;return a},de=t=>n=>{let o=null;if(e.owns(n,"pointedPaths")){const e=d(n.pointedPaths);o=t(e)}return o},ge=de((e=>_.getInstance(e))),pe=de((e=>_.getReference(e))),fe=function(e){return e.get("type")},me=r(fe,h.getIconURLFromKey),Ie=function(t,n){const a=t=>{let n={productName:null,iconURL:null};const o=pe(t);return e.is(o)&&(n.productName=$(o,null),n.iconURL=me(o)),n},i=(e,t)=>({productName:e,candidatePath:t}),s=t=>{const n=ae(t)?t=>{let n=null;const o=_.getReference(d(t));return e.is(o)&&(n=$(o,null)),i(n,t)}:t=>{let n=null;const o=_.getInstance(d(t));if(e.is(o)){const t=_.getReferenceModelFromInstance(o);e.is(t)&&(n=$(t,o))}return i(n,t)};let o=[];return Array.isArray(t.candidatePaths)&&(o=t.candidatePaths.map((e=>n(e)))),o},r=e=>({labelItem:e.productName,valueItem:e.candidatePath.toString()}),u=e=>({candidateEntries:[{labelItem:h.getNLSValue("MIL.SelectCandidate"),valueItem:w},...e],firstCandidateProduct:(()=>{const e=h.getNLSValue("MIL.SelectCandidate");return i(e,w)})()}),g=(e,t)=>{const n=e=>({label:e.labelItem,value:e.valueItem,tooltip:e.labelItem,getLabel:function(){return this.label}});let o;if(e.length>0)o=n(r(t));else{const e=h.getNLSValue("MIL.RerouteNone");o=n({labelItem:e,valueItem:e})}return o},p=(t,n,o,a,l,i,s,r,u)=>{const p=e.is(n)?n:null,f=me(t),m=(t=>{let n=null;return e.is(t)&&e.owns(t,"candidatePath")&&t.candidatePath!==w&&(n=t.candidatePath),n})(a);return{label:$(t,p),icons:[f],useAsyncPreExpand:!0,referencePID:t.get("PID"),referenceType:fe(t),instancePID:e.is(p)?p.get("PID"):null,mfgOccPathArr:e.is(p)?c(u.id):[],defaultMILSuggestionValue:s.value,milStatus:null,children:[],grid:{MIL_suggestion:s,MIL_rerouting:g(o,a),MIL_previous:e.owns(i,"productName")?i.productName:h.getNLSValue("MIL.PrevisionUnknown"),MIL_status:"",cellInfo:{mbomId:e.is(p)?p.get("PID"):t.get("PID"),candidateId:e.is(m)?d(m):null,candidateOccPath:e.is(m)?c(m):null,action:s.value,candidateEntries:l,suggestionToPerformEntries:r,PreviousProdIconUrl:e.owns(i,"iconURL")?i.iconURL:null,MfgItemIconUrl:f,inconsistentObject:e.clone(u),isLeaf:le(u)}}}},f=n||{},m=Array.isArray(f.forbiddenSuggestions)?f.forbiddenSuggestions:[];let L;if(ae(t)){const n=_.getReference(t.id),o=a(t),i=s(t);let c=i.map((e=>r(e))),d=l(i,null),g=ue(t);if(e.is(g)){let e=new I(C);e.from(g).addDefaultOption().addAdditionalOptions(),ie(i)&&({candidateEntries:c,firstCandidateProduct:d}=u(c)),e.addIgnoreOption(),L=p(n,null,i,d,c,o,g,e.toArray(),t)}}else{const n=d(t.id),i=_.getInstance(n),c=_.getReferenceModelFromInstance(i),g=(t=>{let n={productName:null,iconURL:null};const o=ge(t);if(e.is(o)){const t=_.getReferenceModelFromInstance(o);e.is(t)&&(n.productName=$(t,o),n.iconURL=me(t))}else if(e.owns(t,"isInstanceOf")){const o=v.getBIModel(t.isInstanceOf);if(e.is(o)&&ae(o._attributes)){const e=o._attributes;n=a(e)}}return n})(t),f=s(t);let M=f.map((e=>r(e))),h=l(f,null),b=ue(t);if(e.is(b)){let e=new I(C);e.from(b).addDefaultOption().addAdditionalOptions(),o(f)&&({candidateEntries:M,firstCandidateProduct:h}=u(M)),e.addIgnoreOption(),e.removeOptions(m),L=p(c,i,f,h,M,g,b,e.toArray(),t)}}return L},Le=function(t,n,o,a){const i=e=>_.isReferencesHasReadOnlyType(e.referenceType),s=e=>o.some((t=>d(t.id)===e)),r=(t,n=null)=>{let o=null;const a=M.getNodeModel(t);if(Array.isArray(a))if(1===a.length)o=l(a);else if(a.length>1)if(Array.isArray(n)){const t=a.find((t=>e.equals(t.options.mfgOccPathArr,n)));e.is(t)&&(o=t)}else o=l(a);return o},u=(t,n=null)=>e.is(r(t,n));let g=a||{};if(!(!!e.is(g.considerInstancesOnly,"boolean")&&g.considerInstancesOnly)){const o=t.reduce(((e,t)=>e.set(t.id,t)),new Map),a=n.reduce(((e,t)=>{const n=t.isInstanceOf;if(o.has(n)){const t=o.get(n);e.add(t)}return e}),new Set);(a.size>0?t.filter((e=>!a.has(e))):t).forEach((t=>{const n=Ie(t,g);if(e.is(n)&&function(e){let t,n=!1;const o=b.getRoots();return 2===o.length&&(t=o[1]),Array.isArray(t)&&(n=t.includes(e)),n}(n.referencePID)&&!i(n)){const e=(o=n,M.addNodeModel(o)),a=le(t)?"noChildren":"partiallyExpanded";M.updateNodeState(e,a)}var o}))}const p=(t=>{const n="V_TreeOrder";return t.map((t=>{const o=d(t.id),a=_.getInstance(o);let l=e.clone(t);return l[n]=a.get(n),l})).slice().sort(((e,t)=>Number(e[n])-Number(t[n])))})(n);p.forEach((t=>{if(e.owns(t,"aggregatedByPath")){const n=e.owns(t,"aggregatedByPathTillRoot")?t.aggregatedByPathTillRoot:t.aggregatedByPath,o=te(n);let a=u(o)?r(o):(e=>{const t=_.getReference(e),n={label:$(t,null),icons:[me(t)],useAsyncPreExpand:!0,referencePID:t.id,referenceType:fe(t),instancePID:null,mfgOccPathArr:[],defaultMILSuggestionValue:null,grid:{},children:[],milStatus:O,cellInfo:{mbomId:null,candidateId:null,candidateOccPath:null,action:null,candidateEntries:null,suggestionToPerformEntries:null,PreviousProdIconUrl:null,MfgItemIconUrl:null,inconsistentObject:null}};return M.addNodeModel(n)})(o),l=!e.is(a.options.defaultMILSuggestionValue);const d=c(t.id),p=d.length>0?d.slice(0,d.length-1):d;if(p.length>0){const e=p.length;for(let t=0;t<e;t++){const e=p[t];if(!s(e)){const n=p.slice(0,t+1);u(e,n)&&(a=r(e,n))}}}let f=!1;if(!l){!!t.status.startsWith("MadeFrom_UseCase_Att")&&(f=!0)}if(e.is(a)&&!f){const n=Ie(t,g);if(e.is(n)&&!i(n)){const e=((e,t)=>M.addNodeModel(t,e))(a,n),o=le(t)?"noChildren":"partiallyExpanded";M.updateNodeState(e,o)}}}}))},Me=function(t,n,o){const a=t=>n=>{let o=[];const a=d(n.id);if(t(a)&&o.push(a),Array.isArray(n.candidatePaths)){const e=n.candidatePaths.map((e=>d(e))).filter(t);o=o.concat(e)}if(e.owns(n,"pointedPaths")){const e=d(n.pointedPaths);t(e)&&o.push(e)}return o},l=a(G),i=a(X);return new Promise(((e,a)=>{if(Array.isArray(t)){const r=function(e,t){let n=new Map;n.set(!0,[]),n.set(!1,[]);for(const o of e){const e=t(o),a=o;n.set(e,n.get(e).concat(a))}return n}(t.map((e=>e._attributes)),(e=>ae(e))),c=r.get(!0),u=r.get(!1),d=c.reduce(((e,t)=>{const n=l(t);return n.length>0&&(e=s(e,new Set(n))),e}),new Set),g=u.reduce(((e,t)=>{const n=i(t);return n.length>0&&(e=s(e,new Set(n))),e}),new Set);ce(g,d).then((function(){Le(c,u,n,o),e()})).catch((function(e){a(e)}))}else a("brokenMfgItems is not a valid array")}))},ve=function(t,n){return new Promise(((o,l)=>{const s=v.getPhantomNodeItems(),r=t.map((t=>(t=>{let n=null;if(ae(t)){if(e.owns(t,"pointedPaths")){const e=c(t.pointedPaths);n=a(e)}}else{const o=ge(t);e.is(o)&&(n=o.get("isInstanceOf"))}return n})(t._attributes))).filter((t=>e.is(t))).reduce(i,new Set),u=Array.from(r).filter(G);var d;(d=u,new Promise(((e,t)=>{d.length>0?_.fetchRoot(d,{forceDBMode:!0,silent:!0,onComplete:e,onFailure:t}):e()}))).then((function(){Me(t,s,n).then(o,l)}))}))},_e=function(e){let t=!1;return e.isRoot()||(t=K(e.getParent())),t},he=function(e){return e.getBrothers().some((e=>K(e)))},be=function(t){let n=!1;return t.isRoot()&&(n=e.is(J(t))),n},Re=function(t){const n=(t,n,o)=>{t.preExpandDone(),t.pushUpdate(),e.is(o)&&""!==o&&M.updateNodeState(t,o),u.notify("stopProgress",n)},o=e=>e.options.grid.cellInfo.inconsistentObject,a=t=>new Promise((function(n,a){let l={};const i=t.getReferencePID(),s=(t=>{const n=o(t);let a=null;return a=e.owns(n,"candidateProduct")?n.candidateProduct:(e=>e.options.grid.cellInfo.candidateId)(t),a})(t);if(e.is(i)&&e.is(s)){const r=o(t);let c={rootEBOM:[s],rootMBOM:[i],areRootsBroken:!0,rootMBOMConfigFilter:N,rootEBOMConfigFilter:A,forceBIComputation:!0};e.owns(r,"aggregatedByPath")&&(c.prefix={mfgAggByPath:r.aggregatedByPath,mfgOccPath:r.id,mfgInstanceLID:r.instanceLID}),u.notify("startProgress",l),v.getBrokenMfgItemStatus(c,(function(e){ve(e,{considerInstancesOnly:!0}).then((function(){(_e(t)||he(t))&&function(e){if(!K(e)){e.isSelected()||e.select();const t=e.onUnselect(q);e.options.unselectEventToken=t}}(t),u.notify("stopProgress",l),n()})).catch((function(e){u.notify("stopProgress",l),a(e)}))}))}else a()}));if(e.is(t)&&e.owns(t,"data")&&e.owns(t.data,"nodeModel")){let e=t.data.nodeModel,o={};((e,t)=>{u.notify("startProgress",t),e.prepareUpdate()})(e,o),e.isRoot()||K(e)&&(_e(e)||he(e)||Z(e)),(e=>{let t=!1;return e.isRoot()&&!be(e)||Y(e)&&(t=!0),t})(e)?a(e).then((function(){n(e,o)})).catch((function(){n(e,o)})):n(e,o)}},Se=function(t){const n=e=>{e.hasChildren()&&(e.getAllDescendants(null,!0).forEach((e=>{Z(e),e.isSelected()&&e.unselect()})),e.removeChildren())};if(e.is(t)&&e.owns(t,"data")&&e.owns(t.data,"nodeModel")){let e=t.data.nodeModel;e.isRoot()?be(e)&&(n(e),K(e)&&Z(e)):(n(e),K(e)&&(_e(e)||Z(e))),Y(e)&&M.updateNodeState(e,"partiallyExpanded")}},ye=function(){const t=M.getSelectedNodes();Array.isArray(t)&&t.length>0&&t.forEach((e=>Z(e))),e.is(P)&&(M.removeEventListener(P),P=null),e.is(B)&&(M.removeEventListener(B),B=null),R.clearPseudoBIStatus()};return y=new t(u,p,L,M,h,R),e.extend(y,{init(t){const n=e=>Array.isArray(e)&&e.length>0;let o=t||{},a=M.getWUXNodeModel();M.removePreExpandListener(),P=a.onPreExpand(Re),B=a.onPostCollapse(Se);const{rootProducts:l,rootProcesses:i}=function(){let e=null,t=null;const n=b.getRoots();return 2===n.length&&(e=n[0],t=n[1]),{rootProducts:e,rootProcesses:t}}();if(function(e){var t,n,o=[];for(t=0;t<e.length;t++)n=_.getReferenceModel(e[t]),_.checkForContextualImplementLink(n)&&(o.push(n._attributes["PLMEntity.V_Name"]),e.splice(t,1),t--);o.length>0&&u.warn(h.getNLSValue("MIL.HasOccOccLink.Failure",{object:o}))}(i),((e,t)=>n(e)&&n(t))(l,i)){const t=b.getAllCompatibleFilters(i),n=b.getAllCompatibleFilters(l);if(e.is(t)&&e.is(n)){N=t,A=n,this.buildSkeleton({manageInconsistentLinksCmdId:o.manageInconsistentLinksCmdId,onApplyCallBack:re,cancelButtonLabel:h.getNLSValue("MIL.PanelCloseButton"),cleanup:ye});let e={};u.notify("startProgress",e),v.getBrokenMfgItemStatus({rootEBOM:l,rootMBOM:i,rootMBOMConfigFilter:N,rootEBOMConfigFilter:A,forceBIComputation:!0},(function(t){ve(t).then((function(){u.notify("stopProgress",e),M.getRoots().length>0&&y.updateApplyButtonState(!0),u.notify("CIMLoaded")}))}))}else u.warn(h.getNLSValue("BI.Computation.IncompatibleFilter"))}else{let t=o.manageInconsistentLinksCmdId;e.is(t)&&u.notify("toggleCmdCheckHeaderState",{cmdName:t,cmdState:!1})}}})}})),define("DS/DELPPWItemMILModule/MILModule",["UWA/Core","DS/DELPPWItemMILModule/MFNChangeImpactMgmtUI"],(function(e,t){"use strict";return{behaviors:["UXFactoryBehavior","TreeListViewBehavior","WUXNodeModelBehavior","MfgItemBehavior","ModelBehavior","ResourceBehavior","RootsBehavior","BIBehavior","ProductImplementBehavior"],creator:function(e,n,o,a,l,i,s,r,c,u){var d=null,g=function(){};return{name:"MILModule",listenTo:function(){return{select:g}},onStart:function(g){let p=g||{};(d=new t(e,n,o,a,l,i,s,r,c,u)).init(p),d.loadUI()},onStop:function(){d.destroy(!0),d=void 0}}}}}));