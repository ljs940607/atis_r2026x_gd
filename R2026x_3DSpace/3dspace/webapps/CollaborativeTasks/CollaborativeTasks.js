define("DS/CollaborativeTasks/TaskGrid/TasksTableConfig",["UWA/Core","DS/E6WCommonUI/UIHelper","DS/E6WCommonApps/Models/TaskModelMixin","DS/Handlebars/Handlebars4","DS/E6WCommonApps/TreeDocument/TreeNodeUtil","i18n!DS/E6WCommonApps/assets/nls/CollaborativeTasksNLS","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/E6WCommonApps/Views/ObjectIDPanelUtil","text!DS/CollaborativeTasks/assets/templates/personFieldOnGrid.html.handlebars","text!DS/CollaborativeTasks/assets/templates/contextFieldOnGrid.html.handlebars"],(function(e,t,i,s,o,a,n,l,r,c,d){"use strict";var h=function(e){var t=a.get(e);return t===e&&(t=n.get(e)),t},u=(s.compile(c),s.compile(d)),p="references",m="deliverables",g={attachment_or_deliverable:"attachmentOrDeliverableIconContent",context:"contextContent",project:"projectContent",description:"descriptionContent",assignee:"taskAssigneesContent",owner:"taskOwnerContent"},C=function(e,t){return(e=e?new Date(e):new Date("10/10/200"))-(t=t?new Date(t):new Date("10/10/200"))},T={[o.COLUMN_DATA_INDICES.context]:"contextForSort",[o.COLUMN_DATA_INDICES.assignees]:"assigneesForSort",[o.COLUMN_DATA_INDICES.owner]:"ownerForSort",[o.COLUMN_DATA_INDICES.project]:"parentForSort"},f=function(e,t,i){var s=this.reuseCellContent(g.attachment_or_deliverable);s.empty(),e.getAttributeValue("correspondingModel").get(i).length?t._setReusableContent(s):t._setReusableContent(null)},v=function(e,t){var i=e.getAttributeValue("correspondingModel"),s=this.reuseCellContent(g.context);s.empty();var a={};i.isRDFTask()||(a=i.dataForRendering().context,s.setHTML(u({lData:a}))),t._setReusableContent(s),e.setAttribute(T[o.COLUMN_DATA_INDICES.context],a)},S=function(e,t){var i,s=e.getAttributeValue("correspondingModel"),a=this.reuseCellContent(g.project);a.empty(),i=s.isRDFTask()?s.getParent()&&s.getParent().dataForRendering({level:0,attributes:["title","image"]}):s.dataForRendering().DPMProject,a.setHTML(u({lData:i})),t._setReusableContent(a);var n=e.getAttributeValue(T[o.COLUMN_DATA_INDICES.project]);n&&n.isNoAccessModel&&i.isNoAccessModel||e.setAttribute(T[o.COLUMN_DATA_INDICES.project],i)},D=function(e,t){var i="",s=e.rdfModel&&e.rdfModel.get(t)&&e.rdfModel.get(t).getModels()||e.getAttributeValue(T[t]);return s?(Array.isArray(s)&&s.length>=1?s.forEach((e=>{i=i+" "+(e.name||e.get&&e.get("name"))})):(s.name||s.get&&s.get("name"))&&(i=i+" "+(s.name||s.get&&s.get("name"))),i):i},b={[h("E6WCommonApps.Label.Low")]:1,[h("E6WCommonApps.Label.Medium")]:2,[h("E6WCommonApps.Label.High")]:3,[h("E6WCommonApps.Label.Urgent")]:4};let _=o.assigneesColumn;_.sortableFlag=!0;let k=o.ownerColumn;k.sortableFlag=!0;var w=[{text:h("E6WCommonApps.Label.Title"),dataIndex:o.COLUMN_DATA_INDICES.title,typeRepresentation:"string",editableFlag:!1,sortableFlag:!0,visibleFlag:!0,className:"grid-title-cell",getCellSemantics:function(e){return{icon:e.nodeModel.getAttributeValue("icon")}}},{...r.getObjectIDFieldForTableConfig(!1),sortableFlag:!0},{...o.descriptionColumn,sortableFlag:!0},{text:h("emxCollaborativeTasks.Label.Contributing"),dataIndex:o.COLUMN_DATA_INDICES.context,typeRepresentation:"string",editableFlag:!1,sortableFlag:!0,visibleFlag:!0,customContentId:g.context,onCellRequest:function(e){v.call(this,e.nodeModel,e.cellView)},getCellValueForSort:D},{text:h("E6WCommonApps.Label.Parent"),dataIndex:o.COLUMN_DATA_INDICES.project,typeRepresentation:"string",editableFlag:!1,sortableFlag:!0,visibleFlag:!0,customContentId:g.project,onCellRequest:function(e){S.call(this,e.nodeModel,e.cellView)},getCellValueForSort:D},{text:h("E6WCommonApps.Label.RouteContent"),dataIndex:o.COLUMN_DATA_INDICES.routeContent,typeRepresentation:"string",editableFlag:!1,sortableFlag:!0,visibleFlag:!0},{text:h("E6WCommonApps.Label.RouteTaskAction"),dataIndex:o.COLUMN_DATA_INDICES.routeTaskAction,typeRepresentation:"string",editableFlag:!1,sortableFlag:!0,visibleFlag:!0},{text:h("E6WCommonApps.Label.RouteTaskInstructions"),dataIndex:o.COLUMN_DATA_INDICES.routeTaskInstructions,typeRepresentation:"string",editableFlag:!1,sortableFlag:!0,visibleFlag:!0},{text:h("E6WCommonApps.Label.MaturityState"),dataIndex:o.COLUMN_DATA_INDICES.maturity,typeRepresentation:"string",editableFlag:!1,sortableFlag:!0,visibleFlag:!0,getCellClassName:function(e){return o.getClassForState(e.cellModel)}},{text:h("E6WCommonApps.Label.Priority"),dataIndex:o.COLUMN_DATA_INDICES.priority,typeRepresentation:"string",editableFlag:!1,sortableFlag:!0,visibleFlag:!0,getCellSemantics:function(e){var t={icon:"fonticon fonticon-medium priority-for-grid"};return e.cellModel===h("E6WCommonApps.Label.Low")?t.icon="fonticon fonticon-low":e.cellModel===h("E6WCommonApps.Label.High")?t.icon="fonticon fonticon-high":e.cellModel===h("E6WCommonApps.Label.Urgent")&&(t.icon="fonticon fonticon-alert"),t},getCellValueForSort:function(e,t){var i=e.getAttributeValue(t);return b[i]?b[i]:0}},{text:h("E6WCommonApps.Label.Percent"),dataIndex:o.COLUMN_DATA_INDICES.percent,typeRepresentation:"number",editableFlag:!1,sortableFlag:!0,visibleFlag:!0},{...o.plannedStartColumn,sortableFlag:!0},{...o.plannedEndColumn,sortableFlag:!0},{...o.durationColumn,sortableFlag:!0},{text:h("E6WCommonApps.Label.Attachments"),dataIndex:o.COLUMN_DATA_INDICES.attachments,typeRepresentation:"string",editableFlag:!1,sortableFlag:!1,customContentId:g.attachment_or_deliverable,onCellRequest:function(e){f.call(this,e.nodeModel,e.cellView,p)}},{text:h("E6WCommonApps.Label.Deliverables"),dataIndex:o.COLUMN_DATA_INDICES.deliverables,typeRepresentation:"string",editableFlag:!1,sortableFlag:!1,customContentId:g.attachment_or_deliverable,onCellRequest:function(e){f.call(this,e.nodeModel,e.cellView,m)}},{text:h("E6WCommonApps.Label.Community"),dataIndex:o.COLUMN_DATA_INDICES.community,typeRepresentation:"string",editableFlag:!1,sortableFlag:!0},{...o.actualStartColumn,sortableFlag:!0},{...o.actualEndColumn,sortableFlag:!0},{text:h("E6WCommonApps.Label.Created"),dataIndex:o.COLUMN_DATA_INDICES.created,typeRepresentation:"date",editableFlag:!1,sortableFlag:!0,visibleFlag:!0,compareFunction:C},{text:h("E6WCommonApps.Label.LastUpdated"),dataIndex:o.COLUMN_DATA_INDICES.modified,typeRepresentation:"date",editableFlag:!1,sortableFlag:!0,visibleFlag:!0,compareFunction:C},_,k];return window.widget&&window.widget.getValue("appId")===l.APP_3DPLAN&&(w.splice(5,3),w.splice(3,1)),{columns:w,reusableComponentIDs:g,lengthOfEachCharacter:10}})),define("DS/CollaborativeTasks/Views/CollaborativeTasksUtils",["UWA/Core","DS/CoreEvents/ModelEvents","i18n!DS/E6WCommonApps/assets/nls/CollaborativeTasksNLS"],(function(e,t,i){"use strict";var s={getErrorMessageForInvalidCredentials:function(e){var t,s;return e&&401===e.statusCode&&e.error&&-1!==e.error.indexOf("ErrorCode:1501009")&&(s="emxCollaborativeTasks.Error.InvalidCredentials",t=i.get(s)),t},initModelEventsBroker:function(){this.modelEventsBroker=new t},publishModelEvents:function(e,t){this.modelEventsBroker&&this.modelEventsBroker.publish({event:e,data:t})},STATE_CHANGE_MODEL_EVENT:"collaborative-tasks-state-change"};return s})),define("DS/CollaborativeTasks/Models/UserGroupModel",["DS/Foundation2/Models/ReferenceModel","DS/E6WCommonUI/PlatformManager","DS/E6WCommonUI/UIHelper","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/FederatedSearchUtil","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],(function(e,t,i,s,o,a){"use strict";var n=e.extend({_uwaClassName:"UserGroupModel",source:"usersgroup",serviceId:"usersgroup",idAttribute:"id",idAttributeForFederatedSearch:"[ds6w:resourceUid]",optimizeSearchQuery:!0,getIdForFederatedSearch:function(){return s.jsonURIToSparqlURI(this.get("dataelements")&&this.get("dataelements").groupURI||this.get("groupURI")||this.id)},getObjectType:function(){return"Group Proxy"},dataForRendering:function(){return this._parent.apply(this,arguments)},setup:function(){let e=this._rowObjects&&this._rowObjects.length&&"assignees"===this._rowObjects[0]._relationship;return t.isOnPremise()||e||this.fetch(),this.setViewAccess(Boolean(this.get("Title"))),this._parent.apply(this,arguments)},setViewAccess:function(e){this._hasViewAccess=e},canShowProperties:function(){return!1},sync:function(e,i,s){if(t.isOnPremise())return this._parent.apply(this,arguments);var a=this;if("read"===e){var n=this.getIdForFederatedSearch(),l=[n='"'+n+'"'],r={query:l,nresults:l.length+10,sources:[this.source],select_predicate:["ds6w:label","ds6w:type","type_icon_url","preview_url","resourceid","ds6w:resourceUid"],searchQueryPrefix:this.idAttributeForFederatedSearch,onComplete:function(e){var t=e.results&&e.results.length&&e.results[0].attributes&&e.results[0].attributes.find((e=>"ds6w:label"===e.name)).value,i=e.results&&e.results.length&&e.results[0].attributes&&e.results[0].attributes.find((e=>"resourceid"===e.name)).value;a.set("Title",t),i&&a.set("groupURI",i),t||a.set("type",void 0),a.setViewAccess(Boolean(a.get("Title"))),a.dispatchEvent("onFetchDone",arguments)},onFailure:function(){var e=s.onFailure;e&&e.apply(this,arguments),a.set("type",void 0),a.set("Title",void 0),a.setViewAccess(Boolean(a.get("Title"))),a.dispatchEvent("onFetchDone")}};o.sendRequestWithDelimiter(r)}},hasViewAccess:function(){return this._hasViewAccess},get:function(e){var i=this._parent.apply(this,arguments);switch(e){case"name":return this.hasViewAccess()?this.get("Title")||i:a.get("E6WCommonUI.Label.PrivateGroup");case"image":try{return this.hasViewAccess()?t.getServiceUrl("usersgroup")+"/3drdfpersist/common/images/T_dsaccess_Group.png":require.toUrl("DS/E6WCommonApps/assets/img/defaultGroupPrivate.png")}catch(e){return i}}return i}});return n})),define("DS/CollaborativeTasks/Views/TasksViewSelectionMixin",[],(function(){"use strict";return{enableMultiSelectMode:function(){this._multiSelectMode||(this._multiSelectMode=!0),this._multiSelectButton.toggleClassName("fonticon-select-on",!0),this._multiSelectButton.toggleClassName("fonticon-select-off",!1)},updateSingleCardSelection:function(e){this._selectedView=e,this._selectedChildView=e.getColumn(),this.handleTagCollect(e)},addToMultiCardSelection:function(e){(this._selectedModels.indexOf(e.model)>-1||this._selectedCards.indexOf(e)>-1)&&console.error("Adding card to selection which is already added"),this._selectedModels.push(e.model),this._selectedCards.push(e)},removeFromMultiCardSelection:function(e){-1===this._selectedModels.indexOf(e.model)&&console.error("Removing card from selection which is not selectd");var t=this._selectedModels.indexOf(e.model);if(this._selectedModels.splice(t,1),-1!==this._selectedCards.indexOf(e)){var i=this._selectedCards.indexOf(e);this._selectedCards.splice(i,1)}},clearSelectedCards:function(){this._selectedView?this.clearSingleCardSelection():this.clearMultiCardSelection()},clearSingleCardSelection:function(){this._selectedView=void 0,this._selectedChildView=void 0,this.handleTagCollect()},clearMultiCardSelection:function(){this._columnViews.forEach((function(e){e._childrenViews&&e._childrenViews.forEach((function(e){e.isSelected()&&e.multiUnselect()}))})),this._selectedModels=[],this._selectedCards=[],this._selectedCardsCount.innerHTML="",this.handleTagCollect()},isSelected:function(e){return this._selectedModels.includes(e)},multiSelectCardActual:function(e,t){var i=this;e.forEach((function(e){i.multiSelectCardSimple(e)})),t&&this.detailsPanelManager.openDetailsPanel(1,e[0].model),this._selectedModels.length>0?this._selectedCardsCount.innerHTML=this._selectedModels.length:this._selectedCardsCount.innerHTML="",this.handleTagCollect()},multiSelectCardBasic:function(e){this.enableMultiSelectMode(),e.multiSelect()},multiSelectCardSimple:function(e){this.addToMultiCardSelection(e),this.multiSelectCardBasic(e)},openCloseMultiSelectDetailsPanel:function(){this.detailsPanelManager.getActivePanel()?this.cancelDetailsPanel(!1):this.detailsPanelManager.openDetailsPanel(1)},multiSelectCardFull:function(e,t){var i=this;let s=this.detailsPanelManager.getActivePanel()||t;this.cancelDetailsPanel(!1,{onCancel:function(){i._selectedView&&i.singleUnselectCardActual(i._selectedView),i.multiSelectCardActual(e,s)}})},singleSelectCardActual:function(e){this.updateSingleCardSelection(e),e.onSelect(),this.detailsPanelManager.openDetailsPanel(this._childrenViews.indexOf(this._selectedChildView)+1),this.handleTagCollect(e)},singleUnselectCardActual:function(e){this.clearSingleCardSelection(),e.isMultiSelected()||this.singleUnselectCardSimple(e)},singleUnselectCardSimple:function(e){e.onUnselect()},multiUnselectCardActual:function(e,t){var i=this;1===e.length?(e[0].multiUnselect(),this.removeFromMultiCardSelection(e[0]),this._selectedModels.length>0&&t&&this.detailsPanelManager.openDetailsPanel(1)):e.forEach((function(e){i.removeFromMultiCardSelection(e),e.multiUnselect()})),this._selectedModels.length>0?this._selectedCardsCount.innerHTML=this._selectedModels.length:this._selectedCardsCount.innerHTML="",this.handleTagCollect()},multiUnselectCardFull:function(e){let t=this.detailsPanelManager.multiDetailsPanelIsOpen();this.cancelDetailsPanel(!1,{onCancel:this.multiUnselectCardActual.bind(this,e,t)})},singleSelectCardFull:function(e){var t=this;this.cancelDetailsPanel(!1,{onCancel:function(){t._selectedView&&t.singleUnselectCardActual(t._selectedView),t.singleSelectCardActual(e)}})},singleUnselectCardFull:function(e){this.cancelDetailsPanel(!1,{onCancel:this.singleUnselectCardActual.bind(this,e)})},cancelDetailsPanelAndUnselectAllBeforeAction:function(e){var t=this;this.cancelDetailsPanel(!1,{onCancel:function(){t.clearMultiCardSelection(),e()}})}}})),define("DS/CollaborativeTasks/Models/RDFTasksWorkscopeModel",["UWA/Core","DS/E6WCommonApps/Models/WorkscopeModel","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/RDFFoundation/RDFUtils","DS/E6WCommonApps/XTaskScope","DS/E6WCommonApps/SmartSchedulerUtils"],(function(e,t,i,s,o,a){"use strict";var n=t.extend({_uwaClassName:"RDFTasksWorkscopeModel",getTaskCollectionForFilter:function(i,s){var o=this.getCollectionAttribute(t.TASK_RELATION_ATTR,{mask:"dsplan:MVMask.Task.Complex",detailsMask:"dsplan:MVMask.Task.Complex"});o.setIdForCreateChild(this.id+"/dsxplan:hasTask");var a=e.clone(s||{},!1),n=this.getTaskFetchOptions(i);return e.merge(a,n),o.fetch(a),o},getTaskFetchOptions:function(e){var t={};t.url=s.expandUrl(i.GET_FIRST_LEVEL_LEAF_TASKS_URL);var o=a.getCompletedTaskFilter(),n=[{versionURI:this.id,filter:e,fromCompletionDate:o}];return t.data=JSON.stringify(n),t.headers={"Content-Type":"application/json"},t.method="POST",t},hasFetchedAttribute:function(e){return"dsxplan:hasTask"===e?this._collections[e]:this._parent.apply(this,arguments)}});return n})),define("DS/CollaborativeTasks/Views/IteropTaskDetailsPanelConfig",["DS/Foundation2/FoundationV2Data","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/FederatedSearchUtil","DS/E6WCommonApps/Models/IteropTaskModel","DS/E6WCommonUI/Views/ObjectCardView","DS/E6WCommonUI/Models/DropValidator","DS/E6WCommonUI/UIHelper","DS/E6WCommonApps/Views/LinkLauncherUtils","DS/E6WCommonApps/SmartSchedulerUtils","DS/E6WCommonApps/Views/E6WObjectCardView","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/E6WCommonApps/Views/RichTextEditorView","DS/E6WCommonUI/Views/PriorityView","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS","i18n!DS/E6WCommonApps/assets/nls/CollaborativeTasksNLS"],(function(e,t,i,s,o,a,n,l,r,c,d,h,u,p,m){"use strict";var g=function(t){var i=e.getWidgetConstant.apply(this,arguments);return i===t&&(i=p.get(t)),i},C={config:function(e){return[{name:"title",label:g("E6WCommonApps.Label.Title"),type:"text",maxLength:128},{name:"description",label:g("E6WCommonApps.Label.Description"),type:"RichText",customView:h},{name:"processName",label:g("emxCollaborativeTasks.Label.TaskProcess"),type:"text"},{name:"processIdentificator",label:g("emxCollaborativeTasks.Label.TaskProcessIdentifier"),type:"text"},{name:"priority",label:g("E6WCommonApps.Label.Priority"),customView:u,priorityMapping:{Low:"dsxplan:Low",Medium:"dsxplan:Medium",High:"dsxplan:High",Urgent:"dsxplan:Urgent"}},{name:"date",label:g("E6WCommonApps.Label.Created"),type:"date"}]}};return C})),define("DS/CollaborativeTasks/Collections/MergingSplitCollection",["UWA/Core","DS/E6WCommonUI/Collections/MergingCollection"],(function(e,t){"use strict";var i=t.extend({_uwaClassName:"MergingSplitCollection",getSaveAttributes:function(){return this._subCollections[0].getSaveAttributes.apply(this,arguments)},dataForRendering:function(e){var t=this._subCollections[0],i=t.dataForRendering.apply(t,arguments);return i.filteredCount=this._subCollections.reduce(((t,i)=>t+i.dataForRendering(e).filteredCount),0),i},cancelCurrentRequest:Function.prototype});return Object.defineProperty(i.prototype,"extid",{get:function(){return this._subCollections[0].extid}}),Object.defineProperty(i.prototype,"_valueForFiltering",{get:function(){return this._subCollections[0]._valueForFiltering}}),Object.defineProperty(i.prototype,"_filterAttr",{get:function(){return this._subCollections[0]._filterAttr}}),i})),define("DS/CollaborativeTasks/XTaskTagUtils",[],(function(){"use strict";var e={setTagColors:function(t){e.colorData={values:{}},e.colorData.attr=t.tagColors[0].predicate.split(":").pop(),t.tagColors.forEach((function(t){e.colorData.values[t.object]=t.color}))},unsetTagColors:function(){e.colorData=void 0},hasTagColors:function(){return Boolean(e.colorData)},getColorForModel:function(t){var i;if(e.hasTagColors()){var s=t.get("_tagData");if(s){var o=s[e.colorData.attr];i=e.colorData.values[o]}}return i}};return e})),define("DS/CollaborativeTasks/Views/CustomizedStartStopView",["UWA/Core","DS/E6WCommonUI/Views/StartStopView"],(function(e,t){"use strict";var i=t.extend({_uwaClassName:"E6WCommonUIStartStopView",template:function(){var e=arguments[0].data;return e&&this.setEditFlagOnFields(e),this._parent.apply(this,arguments)},_clearValidationErrors:function(){this._parent.apply(this,arguments);var e=this.container.getElements(".has-error");if(e.length>0)for(var t=0;t<e.length;t++)e[t].toggleClassName("has-error",!1)}});return i})),define("DS/CollaborativeTasks/Models/TaskModel",["UWA/Core","DS/Foundation2/FoundationV2Data","DS/Foundation2/Models/FoundationBaseModel","DS/Foundation2/Models/ReferenceModel","DS/Foundation2/Collections/FoundationBaseCollection","DS/E6WCommonUI/UIHelper","DS/TreeModel/TreeNodeModel","DS/E6WCommonApps/Models/TaskModelMixin","DS/E6WCommonApps/Models/FileManagementMixin","DS/E6WCommonApps/XTaskScope","DS/Foundation2/Collections/ProxyFoundationBaseCollection","DS/CollaborativeTasks/Models/UserGroupModel","DS/E6WCommonApps/TreeDocument/TreeNodeUtil","DS/E6WCommonApps/Models/E6WCommonAppsConstants","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],(function(e,t,i,s,o,a,n,l,r,c,d,h,u,p,m){"use strict";var g=function(e){var i=m.get(e);return i===e&&(i=t.getWidgetConstant.apply(this,arguments)),i},C="assignees",T="candidateAssignees",f="references",v="scopes",S="ownerInfo",D="ObjectInfo",b="referencedSimulations",_="deliverables",k="DPMProject",w="state",E="stateForDisplay",A={"To Do":"Assign","In Progress":"Active",Done:"Complete"},y={Create:"To Do",Assign:"To Do",Active:"In Progress",Review:"In Progress",Complete:"Done"},M=s.extend({}),I=null;M.typeAheadCallback=function(e,i,s){return null!==I&&(I.cancel(),I=null),I=t.ajaxRequest({url:"/resources/v2/e6w/service/PersonSearch?searchStr="+i+"*",type:"get",dataType:"json",callback:function(e){var t=[];if(I=null,e.success&&e.data&&e.data.length)for(var i=e.data.length,o=0;o<i;o++){var n=e.data[o];if(n.dataelements){var l=n.dataelements.firstname||"",r=n.dataelements.lastname||"",c=n.dataelements.name||"";t.push({value:n.id,label:l+" "+r,image:a.userPictureURL(c)})}}s(t)},headers:{"content-type":"application/json"}})},M.get=function(e){var t=this._parent.apply(this,arguments);return"dsaccess:accountName"===e?!t&&this.get("name"):t};var V=function(e,t){switch(e.type){case"Group":case"Group Proxy":return new h(e,t);default:return new M(e,t)}};V.prototype.idAttribute="id";var F=o.childCollection.extend({}),P=i.extend({ASSIGNEESATTR:C,_relations:[{key:C,collectionType:F,serviceName:D,relatedModel:V},{key:"originatorInfo",relatedModel:M,collectionType:F,serviceName:D,isCardinalityOne:!0},{key:T,relatedModel:V,collectionType:F,serviceName:D},{key:S,relatedModel:M,collectionType:F,serviceName:D,isCardinalityOne:!0},{key:p.COOWNERATTR,relatedModel:M,collectionType:F,serviceName:D},{key:f,serviceName:D,collectionType:d},{key:v,serviceName:D,relatedModel:s,isCardinalityOne:!0},{key:"contents",serviceName:D,relatedModel:s},{key:_,serviceName:D,collectionType:d},{key:b,serviceName:D,collectionType:d},{key:"dependenciesPredecessors",serviceName:D,relatedModel:s},{key:k,serviceName:D,relatedModel:s,isCardinalityOne:!0},{key:"route",serviceName:D,relatedModel:s,isCardinalityOne:!0},{key:"dependenciesSuccessors",serviceName:D,relatedModel:s},{key:"predecessors",relatedModel:s},{key:"successors",relatedModel:s}],_uwaClassName:"TaskModel",addAssigneesByName:function(e){var t=e.map((function(e){return{image:a.userPictureURL(e)}}));return this.addObjects(e,this.getMappedAttribute(this.ASSIGNEESATTR),"name",{otherObjectAttributes:t})},getTreeNodeModel:function(){if(this._treeNodeModel)this._treeNodeModel.show();else{var e=this.createNodeData();this._treeNodeModel=new n({label:e.title,grid:e}),u.addListenersOnTreeNode(this._treeNodeModel)}return this._treeNodeModel},assignToSelf:function(t){var i=e.clone(t||{},!1),s=this;this.addAssigneesByName([window.enoviaServer.user]);let o={patch:!0};i.multiEdit?(i.isRDF?o.ajax=i.batchGenerator&&i.batchGenerator.ajax:o.delayedSave=!0,o.onComplete=function(){s.dispatchEvent("onChange:"+s.ASSIGNEESATTR,[s])}):(o.onComplete=function(){s.dispatchEvent("onChange:"+s.ASSIGNEESATTR,[s]);var e=g("emxCollaborativeTasks.Label.SuccessfullyAssignedToSelf");a.displaySuccess(e)},o.onFailure=function(){var e=g("emxCollaborativeTasks.Error.FailAssignToSelf");a.displayError(e)}),this.save(null,o)},_getValidationOptions:function(e){var t=g("emxComponents.Routes.ShowCommentsForTaskApproval")&&"false"!==g("emxComponents.Routes.ShowCommentsForTaskApproval").toLowerCase().trim(),i=t&&"false"!==g("emxComponents.Routes.EnforceAssigneeApprovalComments").toLowerCase().trim(),s=g("emxComponents.Routes.EnforceOwnerReviewComments")&&"false"!==g("emxComponents.Routes.EnforceOwnerReviewComments").toLowerCase().trim();return{needsReview:e.needsReview,newState:e.state,currentState:this.get("state"),showComments:t,enforceAssigneeApprovalComments:i,enforceOwnerReviewComments:s}},_validateNeedsReview:function(e,t,i){"Review"!==i.currentState&&"Complete"!==i.currentState&&"Complete"===i.newState&&"Yes"===i.needsReview&&t.fields.push("needsReview")},validate:function(e){var t,i={fields:[]},s=this._getValidationOptions(e);return this._validateNeedsReview(e,i,s),i.fields.length&&(t=i),t},get:function(e){switch(e){case"endDate":return this.get("dueDate");case"canEdit":return!this.isComplete()&&"TRUE"===this.get("modifyAccess");case E:return this.getStateForDisplayValue();case this.DUEDATECATEGORY:return this.dueDateCategory(this.get(this.DUEDATEATTR));case p.DESCRIPTION_ATTR:return this.get("description")||this.get("routeTaskInstructions");case"card_icon":return this.getFonticonValue(!0);case"tagsData":return this.userTagsData}return this._parent.apply(this,arguments)},getFonticonValue:function(e){var t,i=this.getObjectType();return t=a.isGate(i)?"I_Gate":a.isMilestone(i)?"I_Milestone":a.isPhaseTask(i)?"I_Phase":this.isIteropTask()?"I_BusinessProcessTask":this.isProjectTask()?"I_ProjectTask":"I_SimpleTask",require.toUrl("DS/E6WCommonApps/assets/img/"+t+(e?"_16.png":"_22.png"))},getStateForDisplayValue:function(){return y[this.get(w)]},getFieldDef:function(e){var t=this.getInMemoryData(),i=t&&t.getAllFields();return(i=i||{})[e]},getDeliverables:function(){return this.get("deliverables")&&this.get("deliverables")},getContext:function(){return this.get(p.SCOPEATTR)},getProject:function(){return this.get(p.DPMPROJECTATTR)},createNodeData:function(){var e={title:this.get("title"),description:u.getDisplayLabelForDescription(this.get("description")),context:this.getContext(),project:this.getProject(),maturity:u.getDisplayLabelForState(this.get("state")),percent:u.getDisplayLabelForPercent(this),estimatedFinishDate:this.get("dueDate"),estimatedDuration:u.getDisplayLabelForDuration(this),attachments:this.get("references"),deliverables:this.getDeliverables(),estimatedStartDate:this.get("estimatedStartDate"),actualStartDate:this.get("actualStartDate"),actualFinishDate:this.get("actualFinishDate"),created:this.get("originated"),modified:this.get("modified"),assignees:u.getAssigneesOnUpdate(this,this.get(C)),owner:u.getOwnerForRow(this,this.get(S)),correspondingModel:this};return e.icon=this.getFonticonValue(),e},set:function(){var t=a.setHelper.apply(this,arguments),i=e.clone(t.attrs||{},!1),s=t.options;if(i){if(i.hasOwnProperty(E)){var o=i[E];delete i[E],i[w]=A[o]}if(i.hasOwnProperty(this.DUEDATECATEGORY)){var n=i[this.DUEDATECATEGORY];delete i[this.DUEDATECATEGORY],this.isProjectTask()&&"NO_DATE"===n||(i[this.DUEDATEATTR]=this.dueDateCategory2DueDate(n))}return i.hasOwnProperty("tagsData")&&(this.userTagsData=i.tagsData,delete i.tagsData,this.dispatchEvent("onChange:tagsData")),this._parent(i,s)}return this._parent.apply(this,arguments)},toJSON:function(e){var t=this._parent.apply(this,arguments);return e&&e.onlyUpdated&&!e.dataForRendering&&delete t.dueDateCategory,e&&e.dataForRendering&&(t[this.DUEDATECATEGORY]=this.get(this.DUEDATECATEGORY),t[E]=this.get(E),t.card_icon=this.get("card_icon"),t.userTagsData=this.userTagsData),t.percentComplete&&(t.percentComplete=parseInt(t.percentComplete).toString()),t},setup:function(){this.nbInFlightRequests=0,this.listenTo(this,"onChange:"+k,(function(){this._filterDatabyScope()})),this.listenTo(this,"onChange:"+v,(function(){this._filterDatabyScope()})),this.listenTo(this,"onChange:"+C,(function(){this._filterDatabyScope()})),this.listenTo(this,"onChange:"+T,(function(){this._filterDatabyScope()})),this.listenTo(this,"onChange:"+p.COOWNERATTR,(function(){this._filterDatabyScope()})),this.listenTo(this,"onChange:"+S,(function(){this._filterDatabyScope()})),this.listenTo(this,"onChange:"+this.DUEDATEATTR,(function(e,t,i){i.silent||e.dispatchEvent("onChange:"+this.DUEDATECATEGORY,arguments)})),this.listenTo(this,"onChange:"+w,(function(e,t,i){var s=y[e.previousAttributes()[w]],o=y[t];s===o||i.silent||e.dispatchEvent("onChange:"+E,[e,o,i])})),this.collection&&this.listenTo(this.collection,"onComplete",this._filterDatabyScope),this._parent.apply(this,arguments)},dataForRendering:function(){var e=this._parent.apply(this,arguments);return this.isComplete()?e.date=e.actualFinishDate:e.date=e.dueDate,e.context=e.scopes&&e.scopes[0],e.DPMProject=e.DPMProject&&e.DPMProject[0],e.canEdit=this.get("canEdit"),e},getPredecessors:function(){return this.get("predecessors")},getSuccessors:function(){return this.get("successors")},isDPMMilestoneGate:function(){var e=this.get("dsxplan:jsType")||this.get("type");return a.isMilestone(e)||a.isGate(e)},isProjectTask:function(){var e=!1,t=this.get("hasProject");if(t&&"TRUE"===t.toUpperCase())e=!0;else{var i=this.get(k);e=Boolean(i&&i.length)}return e},isRouteTask:function(){return!1},hasExternalPanel:function(){return!0},isRDFTask:function(){return!1},isIteropTask:function(){return!1},hasChangeSOVAccess:function(){return"TRUE"===this.get("changeSOVAccess")},subscriptionsEnabled:function(){var e=t.getWidgetConstant("ENABLE_SUBSCRIPTIONS");return!this.isProjectTask()&&("true"===e||"TRUE"===e)},addObjects:function(t,i,s,o){var n,l,r=e.clone(o||{},!1),c=!1;if(r.values&&"assignees"===i)for(var d=r.values.length,h=0;h<d;h++)n=!1,l=r.values[h].get("name"),(n=a._alreadyHasObjectInRelatedData(this,i,l))&&(c=!0,a.displayAlreadyAttachedErrorMessage(this.get("title"),n));else for(var u=t.length,p=0;p<u;p++)n=!1,l=t[p],(n=a._alreadyHasObjectInRelatedData(this,i,l))&&(c=!0,a.displayAlreadyAttachedErrorMessage(this.get("title"),n,i));return c?{}:this._parent.apply(this,arguments)},_belongsInCurrentScope:function(e,t){var i;if(!(i=-1!==this.collection.projectTypes().split(",").indexOf(t)?this.get(this.DPMPROJECTATTR):this.get(this.SCOPESATTR))){if(e)return!1;i=[]}for(var s=0;s<i.length;s++){var o=i[s].id||i[s].get("objectId");if(o&&e&&o.toUpperCase()===e.toUpperCase())return!0}return!1},_belongsInCurrentFilter:function(){var e,t,i=window.enoviaServer.user,s=c.getFilter(),o=[],a=this.get(this.ASSIGNEESATTR),n=this.get(S),l=this.get(p.COOWNERATTR),r=this.get(T);s===c.FILTER_OWNED?o=o.concat(n,l):s===c.FILTER_ASSIGNED?o=o.concat(n,a):s===c.FILTER_ALL?o=o.concat(n,l,a):s===c.FILTER_CANDIDATE_ASSIGNEE&&(o=o.concat(r)),n&&n.length||!this.isNew()||(n={get:function(e){var t;return"name"===e&&(t=i),t}});for(var d=0;d<o.length;d++){if((e=(t=o[d]).get("name",{noMapping:!0}))&&i&&i.toUpperCase&&e.toUpperCase()===i.toUpperCase())return!0;if(["Group","Group Proxy"].indexOf(t.get("type"))>-1)return!0}return!1},_removeFromCollection:function(t){var i=this;e.Utils.setImmediate((function(){i.collection&&i.collection.remove(i),"function"==typeof t&&t()}))},_filterDatabyScope:function(e){if(this.noFilter||0===this.get(S).length||this.fetching)"function"==typeof e&&e();else if(this.collection){var t=!0,i=c.getScopeId(),s=c.getScopeType(),o=c.getObjectData(),a=window.widget.getValue("showProjectTasks"),n=this.isProjectTask();this.isRouteTask()?t=!1:n?(t=!1===a||"false"===a,!1===a&&n&&this._belongsInCurrentScope(i,s)&&(t=!1)):i&&"tempfix"!==i&&!c.isScopeRDF()?t=!this._belongsInCurrentScope(i,s):c.isScopeRDF()?c.isAgileWorkContext()&&(t=!this._belongsInCurrentScope(o.id,o.type)):t=!this._belongsInCurrentFilter(),t?this._removeFromCollection(e):"function"==typeof e&&e()}},sync:function(t,i,s){var o=Array.prototype.slice.call(arguments,0),a=e.clone(s||{},!1);if(o[2]=a,"create"===t){var n=this,l=a.onComplete;a.onComplete=function(){n.completed=!0,l&&l.apply(this,arguments)}}return this._parent.apply(this,o)},handleSelfAssignToInWorkTask:function(){var e=a.setHelper.apply(this,arguments).attrs||{},t=this.get(this.ASSIGNEESATTR),i=!t||0===t.length,s=e.state,o=e.stateForDisplay,n=e.percentComplete,l=this.get("state"),r="Active"===s||"In Progress"===o,c=this.isProjectTask()&&"Active"!==l&&n&&parseFloat(n)!==parseFloat(0)&&parseFloat(n)!==parseFloat(100);i&&(r||c)&&(this.addAssigneesByName([window.enoviaServer.user]),this.addSelfAssignToInWorkMessage.apply(this,arguments))},save:function(t,i,s){this.markDeliverablesOn3DNavigate(),this.handleSelfAssignToInWorkTask.apply(this,arguments);var o=e.clone(s||{},!1);if(!this.isRouteTask()&&s&&s.onComplete){var a=this,n=s.onComplete;o.onComplete=function(){c.getFilter()===c.FILTER_CANDIDATE_ASSIGNEE&&a.get(C)&&a.get(C).length&&a._removeFromCollection(),n&&n.apply(this,arguments)}}let l="$fields=deliverablesInheritance,isAssigneeAccessRestricted,calculateDuration,revision,custom,references.description,deliverables.description";t?o.urlParam=l:i&&(i.urlParam=l),this._parent(t,i,o)},isStarted:function(){var e=this.get(w);return"Active"===e||"Review"===e},getStartDate:function(){return this.isStarted()?this.get(this.ACTUALSTARTDATEATTR):this.get("estimatedStartDate")},getPercentComplete:function(){return void 0===this.get("percentComplete")?-1:parseFloat(this.get("percentComplete"))},getEstimatedDuration:function(){var e=this.get("estimatedDuration")||0;return e&&parseFloat(e)},getDefinedDuration:function(){return this.getEstimatedDuration()},getTransferObject:function(t){var i=this.get("type"),s=e.clone(t||{},!1);s&&delete s.parentObject;var o=e.merge(s,{source:window.widget.getValue("appId")||p.APP_TSK,envId:window.enoviaServer.tenant||window.widget.getValue("x3dPlatformId"),objectId:this.id,objectType:i,displayType:a.translateType(i),objectType_Internal:i,displayName:this.get("title"),image:this.get("typeicon")});return a.getTransferObject(o)},canDelete:function(){var e=this.get("deleteAccess");e="FALSE"!==e&&e;var t=this.get("state");return e&&("Assign"===t||"Create"===t)},isReadyToStart:function(){var e=this.get("estimatedStartDate"),t=this.get("state");return this.isProjectTask()&&t&&("Create"===t||"Assign"===t)&&e&&!(new Date(new Date(e)-l.THRESHOLD)<=new Date)},getCompressionLevel:function(){return this.isProjectTask()&&"behindSchedule"===this.get("status")?1:0},hasFetchedAccessData:function(){return!0},getParentAsLabel:function(){var e;if(this.isProjectTask()){var t=this.get(k);if(t&&t[0]){var i=t[0].get("name");e={key:g("emxCollaborativeTasks.Label.Project"),value:i}}}return e},getTaggerURI:function(){return this.getTagPrefix()+this.id}});return P.implement(l,r),P.getAttachmentErrorMessage=function(e,t){var i="";return e===C?i=g("emxCollaborativeTasks.Error.FailedToAssignUser"):e===f?i=g("emxCollaborativeTasks.Error.FailedToCreateReference"):e===_?i=g("emxCollaborativeTasks.Error.FailedToCreateDeliverable"):e===v?i=g("emxCollaborativeTasks.Error.FailedToCreateScope"):e===p.COOWNERATTR?i=g("emxCollaborativeTasks.Error.FailedToAddCoOwner"):e===b&&(i=g("emxCollaborativeTasks.Error.FailedToAddProcess")),i=i.replace("%NAME%",a.escapeHTML(t))},P.getAttachmentSuccessMessage=function(e,t){var i="";return e===f?i=g("emxCollaborativeTasks.Success.ObjectAddedAsReference"):e===_?i=g("emxCollaborativeTasks.Success.ObjectAddedAsDeliverable"):e===b&&(i=g("emxCollaborativeTasks.Success.ProcessAdded")),i=i.replace("%NAME%",a.escapeHTML(t))},P.PersonModel=M,P.ReferenceModel=s,Object.defineProperty(P.prototype,"extid",{get:function(){return this.id}}),P.ASSIGNEESATTR=C,P})),define("DS/CollaborativeTasks/Views/ERTasksDetailsPanelConfig",["UWA/Core","DS/Foundation2/FoundationV2Data","DS/CollaborativeTasks/Models/TaskModel","DS/E6WCommonApps/Views/LinkLauncherUtils","DS/RDFFoundation/FederatedSearchUtil","DS/E6WCommonApps/SmartSchedulerUtils","DS/RDFFoundation/RDFUtils","DS/CollaborativeTasks/Views/CustomizedStartStopView","DS/E6WCommonUI/MultiEdit/MultiStartStopView","DS/CollaborativeTasks/Views/CollaborativeTasksUtils","DS/E6WCommonApps/Views/CommonPropertiesConfig","DS/E6WCommonApps/Views/DependencyGroupView","DS/E6WCommonApps/Views/E6WObjectCardView","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/E6WCommonUI/Models/DropValidator","DS/E6WCommonUI/UIHelper","DS/E6WCommonUI/PlatformManager","DS/E6WCommonUI/FeatureFlagUtils","DS/E6WCommonUI/MultiEdit/MultiObjectCardView","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS","i18n!DS/E6WCommonApps/assets/nls/CollaborativeTasksNLS"],(function(e,t,i,s,o,a,n,l,r,c,d,h,u,p,m,g,C,T,f,v,S){"use strict";var D=function(e){var i=t.getWidgetConstant.apply(this,arguments);return i===e&&(i=v.get(e)),i},b={config:function(){var e=D("emxCollaborativeTasks.GroupLabel.More"),t={"3dspace":[p.SIMULATION_TYPE,p.SIMULATION_TEMPLATE_TYPE]},i=[{readWrite:!0,name:"title",label:D("E6WCommonApps.Label.Title"),type:"text",removeCarriageReturns:!0,numberOfEditableLines:4,maxLength:128,required:!0,validate:!0},{readWrite:!0,name:"description",label:D("emxCollaborativeTasks.Label.TaskDescription"),type:"textarea",numberOfDisplayLines:3,numberOfEditableLines:6},{readWrite:!0,name:"scopes",attributeToDisplay:"name",imageAttribute:"image",singleObjectOnly:!0,label:D("emxCollaborativeTasks.Label.Contributing"),type:"object",showRevisionDetails:!0,searchTitle:D("emxCollaborativeTasks.Label.ContributingSearchTitle"),customView:u,typeAheadCallback:n.typeAheadCallback,searchSource:o.filterSearchSources(["3dspace"]),linkCallback:s.launchProperties,placeHolder:D("emxCollaborativeTasks.Label.ObjectPlaceHolder"),excludeSearchTypes:{"3dspace":["Task","Inbox Task","Project Baseline","Experiment","Project Snapshot","Project Space"]},getDropDownMenuItems:a.getDocumentTypeDropDownMenuItems},{readWrite:!0,name:"DPMProject",attributeToDisplay:"name",imageAttribute:"image",singleObjectOnly:!0,label:D("emxCollaborativeTasks.Label.Project"),type:"object",searchTitle:D("emxCollaborativeTasks.Label.ProjectSearchTitle"),customView:u,typeAheadCallback:n.typeAheadCallback,searchSourceTypes:{"3dspace":["Project Space"]},searchSource:o.filterSearchSources(["3dspace"]),linkCallback:s.launchProperties,placeHolder:D("emxCollaborativeTasks.Label.ObjectPlaceHolder"),getDropDownMenuItems:a.getDocumentTypeDropDownMenuItems},{readWrite:!0,name:"state",label:D("emxCollaborativeTasks.Label.TaskMaturityState"),type:"select"},{name:"dueDate",readWrite:!0,label:D("emxCollaborativeTasks.Label.EstimatedFinishDate"),type:"date",validate:!0},{readWrite:!0,name:"estimatedDurationInputValue",unitAttribute:"estimatedDurationInputUnit",label:D("emxCollaborativeTasks.Label.estimatedDuration"),type:"uom",uomValues:[D("emxCollaborativeTasks.Label.Days"),D("emxCollaborativeTasks.Label.Hours"),D("emxCollaborativeTasks.Label.Weeks"),D("emxCollaborativeTasks.Label.Months")],minimumValue:"0",maximumValue:"2147483647",conversionTable:[1,24]},b.assigneeFieldConfig(),b.candidateAssigneeFieldConfig(),{readWrite:!0,name:"taskCompletionType",label:D("emxCollaborativeTasks.Label.TaskCompletionType"),type:"select"},b.attachmentFieldConfig,b.deliverablesFieldConfig,{name:"project",label:D("emxCollaborativeTasks.Label.CollaborativeSpace"),type:"text"},d.getTagsFieldConfig(),{readWrite:!0,name:"actualStartDate",label:D("emxCollaborativeTasks.Label.ActualDates"),type:"startStop",customView:l,startDateLabel:D("emxCollaborativeTasks.Label.StartDate"),multiCustomView:r,canEditStartDate:function(e){var t=e.get("state");return"Create"!==t&&"Assign"!==t},endDateAttribute:"actualFinishDate",endDateLabel:D("emxCollaborativeTasks.Label.FinishDate"),canEditEndDate:function(e){return"Complete"===e.get("state")},validate:!0,group:e},{name:"originatorInfo",attributeToDisplay:"nameAndAccount",imageAttribute:"image",label:D("emxCollaborativeTasks.Label.TaskOriginator"),type:"person",customView:u,multiCustomView:f,searchSource:["swym"],linkCallback:s.launchProperties,singleObjectOnly:!0},{name:"ownerInfo",attributeToDisplay:"nameAndAccount",imageAttribute:"image",label:D("emxCollaborativeTasks.Label.TaskOwner"),type:"person",customView:u,multiCustomView:f,searchSource:["swym"],linkCallback:s.launchProperties,singleObjectOnly:!0},b.coOwnerFieldConfig(),{name:"originated",label:D("emxCollaborativeTasks.Label.TaskCreated"),type:"date",group:e},{name:"modified",label:D("emxCollaborativeTasks.Label.TaskModified"),type:"date",group:e},{name:"dependencies",customView:h}];return T.referencedSimulationsEnabled()&&i.splice(9,0,{readWrite:!0,name:"referencedSimulations",attributeToDisplay:"name",searchTitle:D("emxCollaborativeTasks.Label.ProcessesSearchTitle"),imageAttribute:"image",label:D("emxCollaborativeTasks.Label.Processes"),type:"object",customView:u,typeAheadCallback:n.typeAheadCallback,linkCallback:s.launchProperties,placeHolder:D("emxCollaborativeTasks.Label.ObjectPlaceHolder"),dropTypes:t,searchSourceTypes:t,searchSource:o.filterSearchSources(["3dspace"]),validateSameTenant:!0,getDropDownMenuItems:a.getDocumentTypeDropDownMenuItems}),i},projectConfig:function(){var e=D("emxCollaborativeTasks.GroupLabel.More");return[{readWrite:!0,name:"percentComplete",label:D("emxCollaborativeTasks.Label.Percent"),type:"range",step:5,percents:!0,insertIndex:4},{readWrite:!0,name:"estimatedStartDate",label:D("emxCollaborativeTasks.Label.EstimatedDates"),type:"startStop",customView:l,multiCustomView:r,canEditStartDate:function(e){var t=e.get("state");return"Review"!==t&&"Active"!==t&&"Complete"!==t},canEditEndDate:function(e){return"Complete"!==e.get("state")},startDateLabel:D("emxCollaborativeTasks.Label.StartDate"),endDateAttribute:"dueDate",endDateLabel:D("emxCollaborativeTasks.Label.FinishDate"),insertIndex:5},{readWrite:!0,name:"taskRequirement",insertIndex:10,label:D("emxCollaborativeTasks.Label.TaskRequirement"),type:"select"},{name:"actualDuration",label:D("emxCollaborativeTasks.Label.ActualDuration"),type:"uom",uomValues:[D("emxCollaborativeTasks.Label.Days"),D("emxCollaborativeTasks.Label.Hours"),D("emxCollaborativeTasks.Label.Weeks"),D("emxCollaborativeTasks.Label.Months")],conversionTable:[1,24],group:e,insertIndex:12},{readWrite:!0,name:"needsReview",label:D("emxProgramCentral.Task.NeedsReview"),type:"checkbox",insertIndex:18,group:e},{readWrite:!0,name:"deliverablesInheritance",label:D("emxProgramCentral.common.DeliverablesInheritance"),type:"checkbox",insertIndex:20,group:e},{readWrite:!0,name:"calculateDuration",label:D("emxProgramCentral.common.CalculateDuration"),type:"checkbox",insertIndex:21,group:e}]}},_=function(e,t,i){var s,o;return"assignees"===e?s=D("emxCollaborativeTasks.Error.FailedToDisconnectUser"):"references"===e?s=D("emxCollaborativeTasks.Error.FailedToDisconnectReference"):"scopes"===e?s=D("emxCollaborativeTasks.Error.FailedToDisconnectScope"):e===p.COOWNERATTR&&(s=D("emxCollaborativeTasks.Error.FailedToRemoveCoOwner")),o=w(t),s=i&&i.response&&400===i.response.statusCode&&i.response.error?g.escapeHTML(i.response.error):o?s.replace("%NAME%",g.escapeHTML(o)):i&&i.response&&g.escapeHTML(i.response.error)},k=function(t,s,o,a){var n,l=w(s);return n=o&&o.response&&400===o.response.statusCode&&o.response.error?g.escapeHTML(o.response.error):l?i.getAttachmentErrorMessage(t,l):o&&o.response&&g.escapeHTML(o.response.error),"assignees"===t&&a&&e.is(a.isRouteTask,"function")&&a.isRouteTask()&&"TRUE"===a.get("routeOwnerTask")&&a.get("routeOwnerUGTitle")&&o&&o.response&&o.response.error&&(n+="<br>"+g.escapeHTML(o.response.error)),n},w=function(i){let s;if("Person"===i.type){let t=i._mvcModel.get("firstname"),o=i._mvcModel.get("lastname");s=e.is(t,"string")&&e.is(o,"string")?t+" "+o:""}else s=t.getFieldValue(i,"title")||t.getFieldValue(i,"name");return s},E=function(e){var t=D("emxCollaborativeTasks.Error.FailedToModify");return e&&e.response&&400===e.response.statusCode&&e.response.error&&(t+="<br>"+D(g.escapeHTML(e.response.error))),t},A=function(e,t,i,s,o){if(t===p.COOWNERATTR&&o&&o.response&&o.response.internalError){o.response.internalError.contains("#1500028")&&("CONNECT"===i?e=D("emxCollaborativeTasks.Error.FailedToAddCoOwnerAccessIssue"):"DISCONNECT"===i&&(e=D("emxCollaborativeTasks.Error.FailedToRemoveCoOwnerAccessIssue")));var a=w(s);e=e.replace("%NAME%",g.escapeHTML(a))}return e},y=function(e){var t=[];return C.getServiceUrl("3DSwym",!0)?(t.push("swym"),e&&C.getServiceUrl("usersgroup",!0)&&t.push("usersgroup")):t.push("3dspace"),t},M=function(e){return"swym"===e.toString()?{swym:[p.PERSON_TYPE]}:{"3dspace":["Person"]}},I=function(e){let t={"3dspace":["Group","Person"],swym:[p.PERSON_TYPE],usersgroup:[p.USER_GROUP_TYPE]};const i={};return e.forEach((e=>(i[e]=t[e],i))),i},V=function(e){var t;return"swym"===e.toString()||(t={"3dspace":["Security Context"]}),t};return b.options={onFailure:function(e,t,i){var s;if(i.clonedInfo)for(var o=Object.keys(i.clonedInfo),a=o.length,n=0;n<a;n++){var l=o[n],r=i.clonedInfo[l].item,d=i.clonedInfo[l].source,h=i.clonedInfo[l].source._relationship,u=r.updateAction;(s=c.getErrorMessageForInvalidCredentials(i.response))||("DISCONNECT"===u?s=_(h,d,i):"CONNECT"===u?s=k(h,d,i,e):"MODIFY"===u&&(s=E(i))),s&&(s=A(s,h,u,d,i),g.displayError(s,{noEscape:!0}))}else i.response&&"nothing to save"!==i.response.error&&g.displayError(D("E6WCommonApps.Error.SaveFailed"))}},b.assigneeFieldConfig=function(){return{readWrite:!0,name:"assignees",attributeToDisplay:"nameAndAccount",imageAttribute:"image",label:D("emxCollaborativeTasks.Label.Assignees"),searchTitle:D("E6WCommonApps.Label.assigneeSearchTitle"),typeAheadCallback:n.typeAheadCallback,dropTypes:m.PERSON_DROP_TYPES,searchSourceTypes:M(y()),type:"person",searchSource:o.filterSearchSources(y()),customView:u,multiCustomView:f,linkCallback:s.launchProperties,placeHolder:D("emxCollaborativeTasks.Label.ObjectPlaceHolder"),validateSameTenant:!0,excludeSearchTypes:V(y()),excludePendingUser:!0,addMembers:!0,customButtons:[g.assignToSelfButtonConfig()]}},b.candidateAssigneeFieldConfig=function(){let t=y(!0);var i=e.extend(b.assigneeFieldConfig(),{name:"candidateAssignees",label:D("E6WCommonApps.Label.CandidateAssignees"),searchTitle:D("E6WCommonApps.Label.candidateAssigneeSearchTitle"),searchSourceTypes:I(t),multiCustomView:f,searchSource:o.filterSearchSources(t),dropTypes:{swym:[p.PERSON_TYPE],usersgroup:[p.USER_GROUP_TYPE],"3dspace":["Person","Group Proxy","Group"]},customButtons:null});return delete i.excludeSearchTypes,i},b.coOwnerFieldConfig=function(){return{name:p.COOWNERATTR,attributeToDisplay:"nameAndAccount",imageAttribute:"image",label:D("emxCollaborativeTasks.Label.TaskCoOwners"),searchTitle:D("emxCollaborativeTasks.Label.coOwnerSearchTitle"),typeAheadCallback:n.typeAheadCallback,dropTypes:m.PERSON_DROP_TYPES,searchSourceTypes:M(y()),type:"person",searchSource:o.filterSearchSources(y()),customView:u,multiCustomView:f,linkCallback:s.launchProperties,placeHolder:D("emxCollaborativeTasks.Label.ObjectPlaceHolder"),validateSameTenant:!0,excludeSearchTypes:V(y()),excludePendingUser:!0,addMembers:!0}},Object.defineProperty(b,"attachmentFieldConfig",{get:function(){return{readWrite:!0,name:"references",attributeToDisplay:"name",imageAttribute:"image",allowFileManagement:!0,showRevisionDetails:!0,label:D("emxCollaborativeTasks.Label.References"),searchTitle:D("emxCollaborativeTasks.Label.referencesSearchTitle"),typeAheadCallback:n.typeAheadCallback,type:"object",customView:u,linkCallback:s.launchProperties,dropTypes:{"3dplan":["dsplan:url"]},placeHolder:D("emxCollaborativeTasks.Label.ObjectPlaceHolder"),searchSource:o.filterSearchSources(["3dspace","drive"]),excludeSearchTypes:{"3dspace":["Person","Security Context","Business Role"]},validateSameTenant:!0,allowUrlLink:!0,limit:100,getDropDownMenuItems:a.getDocumentTypeDropDownMenuItems}}}),Object.defineProperty(b,"deliverablesFieldConfig",{get:function(){return{readWrite:!0,name:"deliverables",attributeToDisplay:"name",allowFileManagement:!0,showRevisionDetails:!0,searchTitle:D("emxCollaborativeTasks.Label.deliverablesSearchTitle"),imageAttribute:"image",label:D("emxCollaborativeTasks.Label.Deliverables"),type:"object",customView:u,typeAheadCallback:n.typeAheadCallback,linkCallback:s.launchProperties,placeHolder:D("emxCollaborativeTasks.Label.ObjectPlaceHolder"),searchSource:o.filterSearchSources(["3dspace","drive"]),validateSameTenant:!0,allowUrlLink:!0,dropTypes:{"3dplan":["dsplan:url"]},limit:100,getDropDownMenuItems:a.getDocumentTypeDropDownMenuItems}}}),b})),define("DS/CollaborativeTasks/Models/TskCloneModel",["UWA/Core","DS/Foundation/WidgetUwaUtils","DS/Foundation2/FoundationV2Data","DS/CollaborativeTasks/Models/TaskModel","DS/E6WCommonUI/Models/CloneModel","DS/E6WCommonUI/UIHelper","DS/E6WCommonUI/Models/DropValidator","DS/RDFFoundation/RDFUtils","DS/E6WCommonApps/CSRFUtil","DS/E6WCommonApps/Models/E6WCommonAppsConstants","i18n!DS/E6WCommonApps/assets/nls/CollaborativeTasksNLS"],(function(e,t,i,s,o,a,n,l,r,c,d){"use strict";var h="Create",u="Assign",p="Active",m="Review",g="Complete",C=i.getWidgetConstant;i.getWidgetConstant=function(e){return C.apply(this,arguments)||d.get(e)};var T=function(){return i.getWidgetConstant.apply(this,arguments)},f={d:0,h:1,w:2,mon:3},v=["d","h","w","mon"],S=o.extend({_uwaClassName:"TskCloneModel",i18n:T,_attributesGet:function(e,t){return e?e[t]:this.get(t)},validate:function(e){var t=!0,s={fields:[],messages:{}},o=this._attributesGet(e,"title"),a=!(this.model.isRouteTask()||this.model.isIteropTask())&&i.containsBadChars(o);return o&&o.length&&!a||(s.fields.push("title"),a&&(s.messages.title=T("emxCollaborativeTasks.Validate.TitleError")),t=!1),(t=t&&this._validateActualDates(e,s))?void 0:s},_validateConstraintsData:function(e,t){var i=!0,s=this._attributesGet(e,c.CONSTRAINT_DATE),o=this._attributesGet(e,c.CONSTRAINT_TYPE);return"As Soon As Possible"!==o&&"As Late As Possible"!==o&&""===s&&(t.fields.push(c.CONSTRAINT_DATE),i=!1),i},_validateActualDates:function(e,t){var i=!0,s=this._attributesGet(e,"actualStartDate"),o=this._attributesGet(e,"actualFinishDate"),a=this._attributesGet(e,"state");"Create"===a||"Assign"===a||s&&void 0!==s&&""!==s||this._hasModifiedProperty("actualStartDate")&&(t.fields.push("actualStartDate"),i=!1),"Complete"!==a||o&&void 0!==o&&""!==o||(t.fields.push("actualFinishDate"),i=!1);var n=new Date;return s=s&&new Date(s).setHours(0,0,0,0),o=o&&new Date(o).setHours(0,0,0,0),s&&s>n&&(t.fields.push("actualStartDate"),i=!1),o&&o>n&&(t.fields.push("actualFinishDate"),i=!1),s&&o&&s>o&&(t.fields.push("actualStartDate"),i=!1),i},get:function(e){var t=this._parent.apply(this,arguments);if("needsReview"===e||"deliverablesInheritance"===e||"calculateDuration"===e)return"Yes"===t?"TRUE":"FALSE";switch(e){case"estimatedDurationInputUnit":t=f[t];break;case"modified":case"originated":t=a.getIntlDateTimeFormat(t);break;case"actualStartDate":case"actualFinishDate":case"constraintDate":t=a.getIntlDateFormat(t)}return t},dataForRendering:function(){var i,s,o=this._parent();this.model&&e.is(this.model.isRouteTask,"function")&&this.model.isRouteTask()||(s=(i=this.get("scopes"))&&i.length?[i[0].dataForRendering()]:[],o.scopes=s),o.route&&o.route.forEach((function(e){e.image={imageValue:window.enoviaServer.computeUrl("/common/images/iconSmallRoute.gif")}}));var a=this.get("estimatedDurationInputUnit");void 0!==a&&(o.estimatedDurationInputUnit=a);var n=this.get("needsReview");void 0!==n&&(o.needsReview=n);var l=this.get("deliverablesInheritance");void 0!==l&&(o.deliverablesInheritance=l);var r=this.get("calculateDuration");return void 0!==r&&(o.calculateDuration=r),void 0!==o.modified&&(o.modified=this.get("modified")),void 0!==o.originated&&(o.originated=this.get("originated")),void 0!==o.actualStartDate&&(o.actualStartDate=this.get("actualStartDate")),void 0!==o.actualFinishDate&&(o.actualFinishDate=this.get("actualFinishDate")),void 0!==o.constraintDate&&(""!==o.constraintDate?o.constraintDate=this.get("constraintDate"):o.constraintDate={displayValue:"--"}),void 0!==o.project&&(o.project=t.getContextDisplayValueForContext(this.get("project"))),o},isProjectTask:function(){return this.model.isProjectTask()},set:function(e,t,i){var s=t;if(t.actualValue&&void 0!==t.actualValue&&""!==t.actualValue){var o=this.model.getFieldDef(e);if(o&&o.format&&("UTC"===o.format||"date"===o.format)){var n=new Date(t.actualValue),l=n.getDate(),r=n.getMonth(),c=n.getFullYear();n.setUTCHours(12,0,0,0),n.setMonth(r,l),n.setFullYear(c),s=n}}if(void 0!==s.actualValue&&(s=s.actualValue),"title"===e&&(s=s.trim()),"percentComplete"===e&&i&&!i.doNotSetState){const e=this.get("dsxplan:jsType")||this.get("type"),i=function(e,t){return 0===e?t?{actualValue:h,displayValue:T("emxCollaborativeTasks.Label.Preliminary")}:{actualValue:u,displayValue:T("emxCollaborativeTasks.Label.ToDo")}:e>0&&e<100?{actualValue:p,displayValue:T("emxCollaborativeTasks.Label.InWork")}:100===e?t?{actualValue:m,displayValue:T("emxCollaborativeTasks.Label.InReview")}:{actualValue:g,displayValue:T("emxCollaborativeTasks.Label.Done")}:null}(t,a.isMilestone(e)||a.isGate(e));i&&this.set("state",i,{doNotSetPercentComplete:!0})}if("state"===e&&i&&!i.doNotSetPercentComplete){const e=function(e,t){return{[T("emxCollaborativeTasks.Label.Draft")]:0,[T("emxCollaborativeTasks.Label.Open")]:0,[T("emxCollaborativeTasks.Label.InWork")]:t<10||100===t?10:void 0,[T("emxCollaborativeTasks.Label.InReview")]:100,[T("emxCollaborativeTasks.Label.Done")]:100}[e.displayValue]}(t,this.get("percentComplete"));void 0!==e&&this.set("percentComplete",e,{doNotSetState:!0})}return"needsReview"!==e&&"deliverablesInheritance"!==e&&"calculateDuration"!==e||(s="TRUE"===s?"Yes":"No"),"estimatedDurationInputUnit"===e&&(s=v[s]),this._parent(e,s,i)},add:function(e,t,i){var s,o=i&&i.dropObj;return o&&(s=n.validateTenant(o)),s?(a.displayError(s),[]):this._parent.apply(this,arguments)},addIndividualObject:function(e,t){return"scopes"!==e&&"contents"!==e||(this._addForScopes.apply(this,arguments),t instanceof FileList||t instanceof File)?this._parent.apply(this,arguments):{}},getObjectToBeAdded:function(t,i,s){var o;if((s.dropObj||s.detailedObject)&&(o=a.getObjectDataFromDropSearchOrTypeAhead(s)),o&&("usersgroup"===o.serviceId&&"foaf:Group"===o.type||"3DSpace"===o.serviceId&&"Group Proxy"===o.type||"dsplan:url"===o.type)){"foaf:Group"===o.type&&(o.type="Group",o.Title=o.title,delete o.title);let a="3DSpace"!==o.serviceId;if("dsplan:url"===o.type){let t=e.clone(s.dropObj||{},!1);t.serviceId="3DSpace",t.type="URL",o=t,a=!0}return e.is(this.model.collection.getRelatedObject,"function")&&this.model.collection.getRelatedObject(t,l.jsonURIToSparqlURI(i),a,void 0,{attributes:o})}return this._parent.apply(this,arguments)},_addForScopes:function(t,i,s,o){var a=e.clone(o||{},!1),n=function(e){return this._addCompletedModelToScopeOrContents(e,t,a)},l=this.model.collection.getRelatedObject(t,i);return l.get("type")?n.call(this,l):(this.listenToOnce(l,"onChange:type",n),{ret:l})},_addCompletedModelToScopeOrContents:function(t,i,s){var n={};if("scopes"===i||"contents"===i){var l=t.get("type");if(-1!==("scopes"===i?this.scopesTypes:this.contentsTypes).indexOf(l)){var r=this.get(i),c=e.clone(s||{},!1);c.silent=!0,r&&r.length&&r[0]===t||(s&&s.config.singleObjectOnly&&this.remove(i,0,c),(n=o.prototype.addIndividualObject.call(this,i,t.id,t,c)).changedModificationPending&&this.dispatchEvent("onChange:modificationsPending"),n.changed&&((c=e.clone(s||{},!1)).operation="add",this._fireRelationshipChangeEvents(i,c)))}else{var d=T("emxCollaborativeTasks.Error.InvalidScopesType");d=d.replace("%TYPE%",l),a.displayError(d)}}return n},save:function(){var e=this.localAttributes;this._parent.apply(this,arguments),this.model.validationError&&(this.localAttributes=e,this.modificationsPending=!0,this.dispatchEvent("onChange:modificationsPending",[this]))},assignToSelf:function(t){var i=e.clone(t||{},!1),o="iam:"+window.enoviaServer.user,a=[{id:o,serviceId:"3DSwym"}];if(i.detailedObjects=[a[0]],t.config.singleObjectOnly&&a&&a.length>0){var n=this.get(s.ASSIGNEESATTR);if(n&&e.is(n,"array")&&n.length>0&&e.is(this.model.remove,"function")){var l=i.singleObjectRemove;i.singleObjectRemove=!0,this.remove(s.ASSIGNEESATTR,0,i),i.singleObjectRemove=l}}this.add(s.ASSIGNEESATTR,o,i),this.model.isRouteTask()&&this.model.isAssignedToUserGroup()&&this.remove("assignees",1)},checkAndSetCSRF:function(e,t){r.checkAndSetCSRF(e,t)}});return S})),define("DS/CollaborativeTasks/Models/RouteTaskModel",["UWA/Core","DS/Foundation2/FoundationV2Data","DS/CollaborativeTasks/Models/TaskModel","DS/E6WCommonUI/UIHelper","DS/E6WCommonApps/TreeDocument/TreeNodeUtil","DS/ENOCollabRouteTask/RouteTaskHelper","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],(function(e,t,i,s,o,a,n){"use strict";var l=function(e){var i=t.getWidgetConstant.apply(this,arguments);return i===e&&(i=n.get(e)),i},r=i.extend({_uwaClassName:"RouteTaskModel",ROUTETASKDUEDATE:"routeTaskDueDate",setup:function(){this.listenTo(this,"onChange:"+this.ROUTETASKDUEDATE,(function(e,t,i){i.silent||e.dispatchEvent("onChange:"+this.DUEDATECATEGORY,arguments)})),this._parent.apply(this,arguments)},dataForRendering:function(){var e=this._parent.apply(this,arguments);return this.isComplete()?e.date=e.routeTaskActualFinishDate:e.date=e.routeTaskDueDate,e.routeOwnerTask&&(e.routeOwnerTask=this.isTaskReassignmentRequired()),1===e.contents.length?e.cardTitle=e.title+" | "+e.contents[0].title+" ("+(e.contents[0].actualName||e.contents[0].name)+")":e.contents.length>1&&(e.cardTitle=e.title+" | "+l("E6WCommonUI.Label.ShowContentInfo").replace("{Number}",e.contents.length)),e.context="",e},toJSON:function(){return this._parent.apply(this,arguments)},isTaskReassignmentRequired:function(){return"TRUE"===this.get("routeOwnerTask")},isAssignedToUserGroup:function(){var e=this.get("assignees");return e&&e.length&&("Group"===e[0].get("type")||"Group Proxy"===e[0].get("type"))},get:function(e){return("canEdit"!==e||!this.isAssignedToUserGroup())&&("dueDate"===e||"endDate"===e?new Date(this.get(this.ROUTETASKDUEDATE)):"routeOwner"===e?this._parent.apply(this,arguments):"canApproveRejectAbstain"===e?this.isRouteTask()&&"Assign"===this.get("state")&&"Approve"===this.get("routeTaskAction")&&this.get("canEdit")&&""!==this.get("routeTaskApprovalComments"):this._parent.apply(this,arguments))},set:function(){var t=s.setHelper.apply(this,arguments),i=e.clone(t.attrs||{},!1),o=t.options;if(i){if(i.hasOwnProperty(this.DUEDATECATEGORY)){var a=i[this.DUEDATECATEGORY];delete i[this.DUEDATECATEGORY],i[this.ROUTETASKDUEDATE]=this.dueDateCategory2DueDate(a)}return this._parent(i,o)}return this._parent.apply(this,arguments)},subscriptionsEnabled:function(){return!1},isRouteTask:function(){return!0},hasExternalPanel:function(){return!0},isIteropTask:function(){return!1},getContext:function(){return""},canAssignToSelf:function(){return!this.isComplete()&&(this.isAssignedToUserGroup()||this.get("canEdit"))&&!this.isAssignedToCurrentUser()},validate:function(e){var t=this._parent.apply(this,arguments)||{fields:[]},i=this._getValidationOptions(e);return a.validate(e,this,t,i)},getParentIdForRelationship:function(e){return"contents"===e?this.get("route")[0].id:this.id},assignToSelf:function(){var e=this;this.addAssigneesByName([window.enoviaServer.user]),this.isAssignedToUserGroup()&&this.removeObject("assignees",this.get("assignees")[0]),this.save(null,{patch:!0,onComplete:function(){e.dispatchEvent("onChange:"+e.ASSIGNEESATTR);var t=l("emxCollaborativeTasks.Label.SuccessfullyAssignedToSelf");s.displaySuccess(t),e.dispatchEvent("onModifyAccessChanged")},onFailure:function(){var e=l("emxCollaborativeTasks.Error.FailAssignToSelf");s.displayError(e)}})},save:function(e,t){var i=arguments;arguments.length>0?this._saveArgs=arguments:i=this._saveArgs;var s=this;return t&&t.onComplete&&this._shouldDoAutoRefresh(e)&&(t.onComplete=function(){s.collection.fetch({server:!0,partialRefresh:!0,noTag:!0})}),this._parent.apply(this,i)},_shouldDoAutoRefresh:function(e){var t=this.get("assignees")[0].get("dsaccess:accountName"),i=e&&e.state;return!s.isLoggedInUser(t)||i&&("Review"===i||"Complete"===i)},createNodeData:function(){return e.merge(this._parent.apply(this,arguments),{contents:o.getDisplayLabelForRouteContent(this),routeTaskAction:this.get("routeTaskAction"),routeTaskInstructions:this.get("routeTaskInstructions")})},getFonticonValue:function(e){return a.getIconValue(e)},getParentAsLabel:function(){var e,t=this.get("route");if(t&&t[0]){var i=t[0].get("name");e={key:l("emxCollaborativeTasks.Label.Route"),value:i}}return e}});return r})),define("DS/CollaborativeTasks/Sourcing/SourcingTaskModel",["DS/CollaborativeTasks/Models/RouteTaskModel","DS/E6WCommonUI/PlatformManager"],(function(e,t){"use strict";var i=e.extend({_uwaClassName:"SourcingTaskModel",ROUTETASKDUEDATE:"routeTaskDueDate",get:function(e){if("_isSourcingTask"===e)return!0;if("canApproveRejectAbstain"===e)return this.isRouteTask()&&"Assign"===this.get("state")&&"Approve"===this.get("routeTaskAction")&&this.get("canEdit");return this._parent.apply(this,arguments)},sync:function(){enoviaServer.setTempUrl(t.getServiceUrl("sourcing"));const e=enoviaServer.space;enoviaServer.space=void 0;const i=this._parent.apply(this,arguments);return enoviaServer.setTempUrl(),enoviaServer.space=e,i},hasExternalPanel:function(){return!1},getFonticonValue:function(){return require.toUrl("DS/E6WCommonApps/assets/img/I_SourcingRouteTask_16.png")}});return i})),define("DS/CollaborativeTasks/Views/TaskMenuMixin",["UWA/Core","DS/Foundation/WidgetAPIs","DS/Foundation2/FoundationV2Data","DS/UIKIT/DropdownMenu","DS/UIKIT/Input/ButtonGroup","DS/UIKIT/Input/Button","DS/i3DXCompassServices/i3DXCompassPubSub","DS/E6WCommonUI/UIHelper","DS/E6WCommonUI/PlatformManager","DS/E6WCommonUI/Models/BulkModel","DS/E6WCommonApps/DeleteUtil","DS/E6WCommonApps/DuplicateItemUtils","DS/E6WCommonApps/SmartSchedulerUtils","DS/E6WCommonApps/MultiEdit/MultiEditMenuUtil","DS/E6WCommonApps/Models/NoAccessModel","DS/E6WCommonApps/Models/WorkscopeModel","DS/ENOCollabRouteTask/RouteTaskHelper","DS/E6WCommonApps/Models/RDFTaskCloneModel","DS/CollaborativeTasks/Sourcing/SourcingTaskModel","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/RDFFoundation/BusinessProcessUtils","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS","i18n!DS/E6WCommonApps/assets/nls/CollaborativeTasksNLS"],(function(e,t,i,s,o,a,n,l,r,c,d,h,u,p,m,g,C,T,f,v,S,D,b,_){"use strict";var k=function(e){var t=D.get(e);return t===e&&(t=_.get(e)),t===e&&(t=b.get(e)),t===e&&(t=i.getWidgetConstant.apply(this,arguments)),t};return{createMenuButtons:function(e){var t=this,i=[];if(!this.model)return;let s=this.getParentView()&&(this.getParentView()._selectedModels||this.getParentView()._parentView&&this.getParentView()._parentView._selectedModels);if(this.isRouteTask(this.model)&&!this.model.get("_isSourcingTask")){i.push(this.getEditItemConfig()),this.model instanceof c&&s&&s.length>1||i.push(this.getBookmarkMenuConfig(this.model));let o=C.getCardMenuItems(this.model,i,{selectedModels:s});return e?t.getCardMenu(i):t.getCardMenu(o)}if(!(this.model instanceof c)){if(this.isIteropTask()){var o=this.getIteropOpenMenu(this.model);return i.push(o),t.getCardMenu(i)}if(i.push(this.getEditItemConfig()),s&&s.length>1){let e={dropdownItems:i,selectedModels:s};return this.createMultiItemsMenu(e),t.getCardMenu(i)}if(i.push(this.getAssignToSelfMenuConfig([this.model])),this.model.get("_hasProcessModelButNoInstance")&&i.push(S.getStartProcessButtonConfig({model:new T(this.model)})),i=t.getConditionalDropMenuItems(i),(this.isRouteTask(this.model)&&"Assign"===this.model.get("state")&&"TRUE"===this.model.get("routeTaskDelegationAllowed")||"FALSE"===this.model.get("routeTaskDelegationAllowed")&&this.model.get("routeOwner")===r.getContextUser())&&i.push(C.getChangeAssignee(this.model)),this.isRouteTask(this.model)&&"Assign"===this.model.get("state")&&"Approve"===this.model.get("routeTaskAction")?i=this.getApprovalMenuItems(i,this.model):i.push(this.getCompleteMenuConfig(this.model)),this.shouldShowDuplicateOption()&&i.push(this.getDuplicateMenuConfig({model:this.model,parentView:this.getParentView()})),i.push(this.getBookmarkMenuConfig(this.model)),this.model.isRDFTask()||this.model.isRouteTask()||i.push(this.getOpenRelationEditorMenuConfig(this.model)),i.push({className:"divider"}),i.push(this.getDeleteMenuConfig({model:this.model,parentView:this.getParentView()})),this.model instanceof f){i=this.filterDropdownItems(i)}}return t.getCardMenu(i)},launchRelationsEditorApp:function(){var e=this.getLaunchOptions();n.publish("setX3DContent",e),n.publish("launchApp",{appId:v.APP_RELATIONS})},filterDropdownItems:function(e){let t=["INFO","THUMBS-UP","THUMBS-DOWN"];return e.filter((e=>{if(e.fonticon){let i=e.fonticon.toUpperCase();return t.includes(i)}return!1}))},createMultiItemsMenu:function(e){let t=e&&e.selectedModels;this.getDisabledAccessMenuItems(t),this.getMultiTaskMenus(e)},getDisabledAccessMenuItems:function(e){p.checkIsMenuDisabled({selectedModels:e,assignToSelfItemAccess:this.assignToSelfItemAccess.bind(this),completeItemAccess:this.completeItemAccess.bind(this),reOpenItemAccess:this.reOpenItemAccess.bind(this),deleteItemAccess:this.deleteItemAccess.bind(this),duplicateItemAccess:this.duplicateItemAccess.bind(this)})},getEditItemConfig:function(){var e=this;return{className:e.editItemClassName(),fonticon:"info",text:k("emxCollaborativeTasks.Command.Edit"),func:function(){e.dispatchEvent("onTaskCardClickedForTableView",e),e.dispatchEvent("onTaskCardEdit",e)}}},getMultiTaskMenus:function(t){let i=e.clone(t||{},!1),s=i.model||this.model,o=i.selectedModels||s.models,a=i.dropdownItems;if(a){!i.isDetailsPanel&&a.push(this.getAssignToSelfMenuConfig(o)),a.push(this.getCompleteMenuConfig(s,o));var n=e.merge({multiEditModels:o,parentView:this.getParentView()},t);!p.hideDuplicateMenu&&a.push(this.getDuplicateMenuConfig(n)),this.addDeleteMenuConfig(a,o,t)}},addDeleteMenuConfig:function(t,i,s){var o={multiEditModels:i,parentView:this.getParentView()};e.merge(o,s),t.push(this.getDividerConfig(),this.getDeleteMenuConfig(o))},getLaunchOptions:function(){return{protocol:"3DXContent",version:"1.0",data:{items:[{objectId:this.model.get("physicalId")||this.model.id,objectType:this.model.get("type"),image:this.model.get("image"),serviceId:"3DSpace",displayName:this.model.get(v.TITLE_ATTR),source:window.widget.getValue("appId"),envId:r.getTenant()}]}}},getOpenRelationEditorMenuConfig:function(e){var t=this;return{id:"openRelationEditorItem",fonticon:"object-related",text:k("emxCollaborativeTasks.Command.Relations"),func:function(){t.launchRelationsEditorApp()}}},shouldShowDuplicateOption:function(){return!(this.isRouteTask(this.model)||this.model&&this.model.isProjectTask&&this.model.isProjectTask())},isRouteTask:function(e){var t=e||this.model;return t&&t.isRouteTask&&t.isRouteTask()},isIteropTask:function(e){var t=e||this.model;return t&&t.isRouteTask&&t.isIteropTask()},getBookmarkMenuConfig:function(e){var t=u.getBookmarkURLMenuConfig(e);return this.isIteropTask(e)&&(t.disabled=!0),this._bookmarkHandler=function(){t.handler(),l.trackPageEvent({eventCategory:"taskMenu",eventAction:"copyLink",eventLabel:"model",eventValue:e})},t},getIteropOpenMenu:function(e){var t=this;return{className:t.launchItemClassName(),fonticon:"logout",text:k("emxCollaborativeTasks.Command.OpenIteropTask"),func:function(e){t.openIteropItemCallback(e),l.trackPageEvent({eventCategory:"taskMenu",eventAction:"open",eventLabel:"ID",eventValue:e})}}},getDividerConfig:u.getDividerConfig,getAssignToSelfMenuConfig:function(e){var t,i=this,s=!1,o=e.length>0&&e[0];return e.length>1||this.model instanceof c?(t=e||this.model.models,s=p.isAssignToSelfDisabled):(s=!i.assignToSelfItemAccess(o),o.isWedo&&o.isWedo()&&(s=!0)),{className:i.assignToSelfItemClassName(),fonticon:"user-add",multiEditSameTypes:!0,disabled:s,text:k("E6WCommonUI.Command.AssignToSelf"),handler:function(){t?p.isSelectionValid(t,{displayWarning:!0})&&p.assignToSelf(t,i.assignToSelf.bind(i)):(i.assignToSelf(o),l.trackPageEvent({eventCategory:"taskMenu",eventAction:"assignToSelf",eventLabel:"model",eventValue:o}))}}},getDuplicateMenuConfig:function(t){var i=this,s=e.clone(t||{},!1),o=s.model,a=!1;let n;s.multiEditModels||this.model instanceof c?(n=s.multiEditModels||this.model.models,a=p.isDuplicateDisabled):o&&o.hasFetchedAccessData()&&(a=this.duplicateItemAccess(o,t)),a||(a=!s.multiEditModels&&e.is(s.taskHasSubTasks,"function")&&s.taskHasSubTasks(o));const l=o&&o.getParent&&o.getParent()&&o.getParent()instanceof g&&o.getParent().isComplete&&o.getParent().isComplete();return(n&&n.find((e=>e.getParent&&e.getParent()&&e.getParent()instanceof g&&e.getParent().isComplete&&e.getParent().isComplete()))||l)&&(a=!0),{id:"duplicateItem",className:"item-duplicate",fonticon:"duplicate",disabled:a,multiEditSameTypes:!0,text:k("E6WCommonUI.Label.Duplicate"),func:function(e){n?p.isSelectionValid(n,{displayWarning:!0})&&h.duplicateItem({selectedModels:n,parentView:s.parentView}):i.duplicateItemCallback(e,t)}}},getCompleteMenuConfig:function(e,t){var i=this,s=!1;let o,a=!1;t||this.model instanceof c?(o=t||this.model.models,s=p.isMarkAsCompleteDisabled,a=p.isComplete):e.hasFetchedAccessData()&&(s=!i.completeItemAccess(e)&&!i.reOpenItemAccess(e),a=e&&e.isComplete());var n=e&&e.isRouteTask();return{id:"completeItem",multiEditSameTypes:!0,className:n?i.completeItemClassName():i.completeItemClassName()+(a?"re-open":""),fonticon:n?"status-change":a?"reset":"status-change",disabled:s,text:k(n?"emxCollaborativeTasks.Command.Complete":a?"emxCollaborativeTasks.Command.ReOpen":"emxCollaborativeTasks.Command.Complete"),handler:()=>{o?p.isSelectionValid(o,{displayWarning:!0})&&p.updateState(o,i.toggleStateIntoOrOutOfDone.bind(i)):i.toggleStateIntoOrOutOfDone(e)}}},getDeleteMenuConfig:function(t){var i=this,s=e.clone(t||{},!1),o=s.model,a=!1;let n;s.multiEditModels||this.model instanceof c?(n=s.multiEditModels||this.model.models,a=p.isDeleteDisabled):(o&&o.hasFetchedAccessData()&&(a=this.isRouteTask(o)||!this.deleteItemAccess(o)||this.isIteropTask(o)),!a&&(a=o&&l.isWedoTask(o.get("dsxplan:jsType"))));const r=o&&o.getParent&&o.getParent()&&o.getParent()instanceof g&&o.getParent().isComplete(),h=n&&n.find((e=>e.getParent&&e.getParent()&&e.getParent()instanceof g&&e.getParent().isComplete()||e.isComplete&&e.isComplete()));return(r||h)&&(a=!0),{id:"deleteButton",className:this.deleteItemClassName(),fonticon:"trash",disabled:a,multiEditDifferentTypes:!0,multiEditSameTypes:!0,text:k("emxCollaborativeTasks.Command.Delete"),func:function(e){n?p.isSelectionValid(n,{displayWarning:!0})&&(s.selectedModels=n,d.deleteItem(s)):i.deleteItemCallback(e,t)}}},getApprovalMenuItems:function(e,t){var i,s=!1,o=function(e){var i=t.collection&&t.collection.allRouteTaskApprovalActions&&t.collection.allRouteTaskApprovalActions();return i&&i.find((t=>t.actualValue===e))};return t&&t.hasFetchedAccessData()&&(s=!this.approvalActionsItemAccess(t)),t&&"Assign"===t.get("state")&&"Approve"===t.get("routeTaskAction")&&((i=o("Approve"))&&e.push({className:this.approveItemClassName(),fonticon:"thumbs-up",disabled:s,name:"approve",selectable:!0,selected:t&&"Approve"===t.get("routeTaskApprovalAction"),text:i.displayValue,handler:this.handleApprovalActions.bind(this,t,"Approve")}),(i=o("Reject"))&&e.push({className:this.rejectItemClassName(),fonticon:"thumbs-down",disabled:s,name:"reject",selectable:!0,selected:t&&"Reject"===t.get("routeTaskApprovalAction"),text:i.displayValue,handler:this.handleApprovalActions.bind(this,t,"Reject")}),(i=o("Abstain"))&&e.push({className:this.abstainItemClassName(),fonticon:"ignore",disabled:s,name:"abstain",selectable:!0,selected:t&&"Abstain"===t.get("routeTaskApprovalAction"),text:i.displayValue,handler:this.handleApprovalActions.bind(this,t,"Abstain")})),e},getConditionalDropMenuItems:function(e,t){var i=this.isRouteTask(),s=this,o=this.isModelAProjectTask();if(this.subscribedToItem()&&!o&&!i&&this.model.subscriptionsEnabled()?e.push({id:"unsubscribeToItem",className:s.unsubscribeItemClassName(),fonticon:"rss",visible:!1,text:k("emxCollaborativeTasks.Command.Unsubscribe"),func:function(){s.toggleSubscription(),l.trackPageEvent({eventCategory:"taskMenu",eventAction:"unsubscribe",eventLabel:"taskModel",eventValue:this.model})}}):o||i||!this.model.subscriptionsEnabled()||e.push({id:"subscribeToItem",className:s.subscribeItemClassName(),fonticon:"rss",text:k("emxCollaborativeTasks.Command.Subscribe"),func:function(){s.toggleSubscription(),l.trackPageEvent({eventCategory:"taskMenu",eventAction:"subscribe",eventLabel:"taskModel",eventValue:this.model})}}),o){let i={id:"openProjectItem",className:s.launchItemClassName(),fonticon:"logout",text:k("emxCollaborativeTasks.Command.OpenProjectItem"),func:function(e){s.openProjectItemCallback(e),l.trackPageEvent({eventCategory:"taskMenu",eventAction:"open",eventLabel:"ID",eventValue:e})}};t?e.splice(0,0,i):e.splice(1,0,i)}if(this.isIteropTask()){let t=this.getIteropOpenMenu(this.model);e.push(t)}return e},getCardMenu:function(e){return{value:"",dropdownCaret:!1,removeOnHide:!0,id:this.menuId(),className:"link",icon:"fonticon-open-down",dropdown:{items:e},events:{onDropdownClick:function(e,t){t&&"function"==typeof t.func&&t.func()}}}},setDescriptionForLargeCards:function(e,t){var i=t.get(v.DESCRIPTION_ATTR);if(i){var s='<div class="card-description">';t.isRDFTask()?e.replace("<pre></pre>",""):s+="<pre>";var o=e.indexOf(s)+s.length;e=e.slice(0,o)+i+e.slice(o)}return e},deleteItemClassName:function(){return"item-delete"},completeItemClassName:function(){return"item-complete"},launchItemClassName:function(){return"item-launch"},subscribeItemClassName:function(){return"item-subscribe"},unsubscribeItemClassName:function(){return"item-unsubscribe"},assignToSelfItemClassName:function(){return"item-assign"},editItemClassName:function(){return"item-edit"},approveItemClassName:function(){return"item-approve"},rejectItemClassName:function(){return"item-reject"},abstainItemClassName:function(){return"item-abstain"},toggleSubscription:function(){this.model.save("subscribed",String(!this.subscribedToItem()).toUpperCase(),{patch:!0,onFailure:function(){var e=k("emxCollaborativeTasks.Error.FailSubscription");l.displayError(e)}})},deleteItemAccess:function(e){return(e||this.model).canDelete(!0)},duplicateItemAccess:function(t){var i=!1,s=t||this.model;return i=e.is(s.canModify,"function")&&!s.canModify(!0),s.get&&!s.get("dsxplan:jsType")&&(i=!0),i},completeItemAccess:function(t){var i=t||this.model,s=!i.isComplete()&&i.get("canEdit");return s&&e.is(i.isProjectTask,"function")&&i.isProjectTask()&&"Yes"===i.get("needsReview")&&"Review"!==i.get("state")&&(s=!1),s},approvalActionsItemAccess:function(e){return(e||this.model).get("canApproveRejectAbstain")},reOpenItemAccess:function(t){var i=t||this.model,s=e.is(i.isRouteTask,"function")&&!i.isRouteTask()&&i.isComplete();return i.isRDF&&(s=s&&i.get("canEdit")),s},subscribedToItem:function(){var e=this.model&&this.model.get("subscribed");return void 0===e&&(e="false"),"TRUE"===e},isModelAProjectTask:function(){return this.model&&this.model.isProjectTask()},deleteItemCallback:function(t,i){var s=e.clone(i||{},!1),o=s.model||this.model,a=s.parentView||this._parentView;e.extend(s,{model:o,parentView:a}),this.deleteItemAccess(o)&&(d.deleteItem(s),l.trackPageEvent({scope:window.widget&&window.widget.getValue("appId"),eventCategory:"taskMenu",eventAction:"delete",eventLabel:"model",eventValue:o}))},duplicateItemCallback:function(t,i){var s=e.clone(i||{},!1),o=s.model||this.model,a=s.parentView||this._parentView;e.extend(s,{model:o,parentView:a}),this.duplicateItemAccess(o)||h.duplicateItem(s)},openProjectItemCallback:function(t){var s="string"===e.typeOf(t)?t:this.model.id,o=i.calculateFinalUrl("/emxLogin.jsp?appName=ENOPRPR_AP&physicalId="+s);return window.open(o,"projectWindow"),!0},openIteropItemCallback:function(t){var i="string"===e.typeOf(t)?t:this.model.id;return require(["DS/TransientWidget/TransientWidget"],(function(e){e.showWidget("ENXBPPY_AP","Widget title",{objectType:"bpa:Task",objectId:i})})),!0},getStateValues:function(){return this.options&&this.options.stateValues||this.getColumn&&this.getColumn().options.stateValues||[{actualValue:v.ACTIVE,displayValue:k("E6WCommonApps.Label.InWork")},{actualValue:v.COMPLETE,displayValue:k("E6WCommonApps.Label.Completed")}]},toggleStateIntoOrOutOfDone:function(t,i){var s,o,a=e.clone(i||{},!1),n=t||this.model,r=this.getStateValues(),c=r&&r.length,d=n.get("dsxplan:jsType")||n.get("type");o=l.isMilestone(d)||l.isGate(d)?n.isComplete()?"Review":"Complete":n.isComplete()?"Active":"Complete";for(var h=0;h<c;h++)if(r[h].actualValue===o){s=r[h];break}let u={};a.multiEdit&&(u=a,a.batchGenerator&&(a.batchGenerator.iState=s)),n.isComplete()?this.reOpenItem(s,n,u):this.completeItem(s,n,u)},reOpenItem:function(t,i,s){var o=e.clone(s||{},!1),a=i||this.model,n=e.clone(t,!1);a.isRDF&&(n.displayValue=k("emxCollaborativeTasks.Label.InProgress"));var l=this.stateChangeOptions(n.displayValue,"",a);o.multiEdit?p.massStateUpdate({model:a,attrs:{state:n.actualValue},callbackOptions:o,iState:t}):a.save("state",n.actualValue,l)},completeItem:function(t,i,s){var o=e.clone(s||{},!1),a=i||this.model;if(!a.isComplete()){var n=e.clone(t,!1);a.isRDF&&(n.displayValue=k("emxCollaborativeTasks.Label.Done"));var l=k("emxCollaborativeTasks.Error.FailSetToComplete"),r=this.stateChangeOptions(n.displayValue,l,a),c={state:n.actualValue};if(o.multiEdit)return void p.massStateUpdate({model:a,attrs:c,callbackOptions:o,iState:t});a.save(c,r)}},handleApprovalActions:function(e,t){var i=e||this.model,s=i&&"No"!==i.get("needsReview");if(!i.isComplete()){this._detailsView&&this._detailsView.model.modificationsPending&&this._detailsView.model.save();var o={};o.routeTaskApprovalAction=t;for(var a,n=this.options&&(this.options.stateValues||this._parentView.options.stateValues),l=n&&n.length,r=s?"Review":"Complete",c=0;c<l;c++)if(n[c].actualValue===r){a=n[c].displayValue;break}var d={actualValue:r,displayValue:a},h=k("emxCollaborativeTasks.Error.FailSetToComplete"),u=this.stateChangeOptions(d.displayValue,h,i);o.state=d.actualValue,i.save(o,u)}},stateChangeOptions:function(e,t,i){return{patch:!0,onComplete:function(){var t=k("emxCollaborativeTasks.Label.SuccessfullyChangedAttribute");t=(t=t.replace("%ATTRIBUTE_NAME%",k("emxCollaborativeTasks.Command.View.state"))).replace("%ATTRIBUTE_VALUE%",e),l.displaySuccess(t),l.trackPageEvent({eventCategory:"taskMenu",eventAction:"complete-reOpen",eventLabel:"state, model",eventValue:{state:e,model:i}})},onFailure:function(i,s,o){var a;a=t||(a=(a=k("emxCollaborativeTasks.Error.FailedToChangeAttribute")).replace("%ATTRIBUTE_NAME%",k("emxCollaborativeTasks.Command.View.state"))).replace("%ATTRIBUTE_VALUE%",l.escapeHTML(e)),o&&o.response&&400===o.response.statusCode&&o.response.error&&(a+="<br>"+k(l.escapeHTML(o.response.error))),l.displayError(a,{noEscape:!0})}}},assignToSelfItemAccess:function(t){var i=t||this.model;return e.is(i.canAssignToSelf,"function")&&i.canAssignToSelf()},assignToSelf:function(e,t){var i=e||this.model;this.assignToSelfItemAccess(i)&&i.assignToSelf(t)},menuId:function(){return"menu-card"},getParentView:function(){return(this._column||this)._parentView}}})),define("DS/CollaborativeTasks/Views/CardViewHandler",["UWA/Core","UWA/Class","DS/Handlebars/Handlebars4","DS/UIKIT/Input/Button","DS/Utilities/DateUtils","DS/CollaborativeTasks/Views/TaskMenuMixin","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/E6WCommonApps/Preferences","DS/E6WCommonApps/TaggerChipColorMixin","DS/E6WCommonUI/Views/E6WHandlebarsHelpers","DS/E6WCommonUI/E6WCommonUIConstants","text!DS/CollaborativeTasks/assets/templates/cardContent.html.handlebars","text!DS/CollaborativeTasks/assets/templates/cardHandler.html.handlebars","i18n!DS/E6WCommonApps/assets/nls/CollaborativeTasksNLS"],(function(e,t,i,s,o,a,n,l,r,c,d,h,u,p){"use strict";var m=p.get.bind(p),g=i.compile(h),C=i.compile(u),T=new Map;T.set("Low",d.PRIORITY_LOW_ICON),T.set("Medium",d.PRIORITY_MEDIUM_ICON),T.set("High",d.PRIORITY_HIGH_ICON),T.set("Urgent",d.PRIORITY_URGENT_ICON);var f=t.extend({_uwaClassName:"CardViewHandler",init:function(e){this._column=e.column},getCardHtml:function(e,t,i){return C({index:t,id:e.id,isChecked:i,color:!e.isBlank&&r.getChipColor(e),hasProgress:!e.isBlank,cardContent:this.getCardContentHtml(e,i)}).trim()},generateMenu:function(e){var i=e.querySelector(".card-menu"),o=this.createMenuButtons(),a=i.querySelector("button");i.removeChild(a),(o=new s(o)).inject(i);var n=new t.Listener;return n.listenTo(o.dropdown,"onShow",(function(){document.addEventListener("contextmenu",o.dropdown.events.document.click,!0)})),n.listenTo(o.dropdown,"onHide",(function(){document.removeEventListener("contextmenu",o.dropdown.events.document.click,!0)})),o},getCardContentHtml:function(e,t){e.calculateAndSetUpListenersForVisualAttributesIfNeeded();var i=e.dataForRendering({attributes:["id","title","card_icon","dueDate","assignees","name","firstname","lastname","state","stateForDisplay","priority",n.USER_DEFINED_START_DATE_ATTR,n.USER_DEFINED_END_DATE_ATTR,n.ACTUAL_DELIVERABLE_ATTR,n.ATTACHMENT_ATTR,"hasFiles","atRisk","readyToStart","late","compressionLevel","percentComplete"]});e.isBlank||this._addDataForLargeCards(e,i),i.multiselect=this.getColumn()._parentView._multiSelectMode,i.isChecked=t,i.priority=T.get(i.priority),i.isFixed=i[n.USER_DEFINED_START_DATE_ATTR]||i[n.USER_DEFINED_END_DATE_ATTR],i.isComplete="Complete"===i.state,i.late?(i.status="late",i.percentCompleteTooltip=m("emxCollaborativeTasks.Label.Late")):i.atRisk?i.status="at-risk":i.readyToStart?(i.status="ready-to-start",i.compression=i.compressionLevel?"at-risk":"on-time"):i.isComplete?i.status="complete":i.status=i.compressionLevel?"at-risk":"on-time","at-risk"!==i.status&&"at-risk"!==i.compression||(i.percentCompleteTooltip=m("emxCollaborativeTasks.Label.Risk")),i.assignees&&i.assignees.length>3&&(i.moreAssignees=!0);var s=i.date&&i.date.actualValue;s&&(i.date.displayValue=o.formatDateToString(new Date(Number(s)),{dateStyle:"short"})),s&&(i.date.displayValue+=l.getWeekNumber(new Date(Number(s))));var a=c.i18n;c.i18n=m;var r=g(i).trim();return c.i18n=a,r=this.setDescriptionForLargeCards(r,e)},_addDataForLargeCards:function(e,t){t.parent=e.getParentAsLabel(),t.explicitTagsData=e.get(n.EXPLICIT_TAGS_DATA)},setModel:function(e,t){this.model=e,this.cardDiv=t},dispatchEvent:function(e){"onTaskCardEdit"===e&&this._column.onTaskCardEdit(this.cardDiv,this.model),this.model.isBlank||this._column.cardClicked(this.cardDiv,this.model)},getColumn:function(){return this._column}});return f.implement(a),f})),define("DS/CollaborativeTasks/Collections/TasksCollection",["UWA/Core","UWA/Class/Promise","DS/Foundation/CsvParser","DS/Foundation/WidgetUwaUtils","DS/Foundation2/FoundationV2Data","DS/Foundation2/Collections/FoundationBaseCollection","DS/RDFFoundation/SecurityContextUtils","DS/CollaborativeTasks/Models/TaskModel","DS/CollaborativeTasks/Models/RouteTaskModel","DS/E6WCommonUI/UIHelper","DS/E6WCommonApps/XTaskScope","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/E6WCommonApps/Collections/TasksSplitCollection","DS/RDFFoundation/Collections/CollectionTaggerHelper","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS","i18n!DS/E6WCommonApps/assets/nls/CollaborativeTasksNLS"],(function(e,t,i,s,o,a,n,l,r,c,d,h,u,p,m,g){"use strict";var C=function(e){var t=m.get(e);return t===e&&(t=g.get(e)),t===e&&(t=o.getWidgetConstant.apply(this,arguments)),t},T=h.DUE_DATE_CATEGORY,f="priority",v="routeTaskValidStates",S="$include=co-owners,predecessors,successors",D="actualValue",b="displayValue",_=h.PAST_DUE,k=h.NO_DATE,w=h.DUE_TODAY,E=h.DUE_TOMORROW,A=h.DUE_THIS_WEEK,y=h.DUE_FUTURE,M=function(e){return e&&e.actualValue||e},I=a.extend({_uwaClassName:"TasksCollection",model:l,getModelBasedOnType:function(e){var t=l;return"Inbox Task"===e&&(t=r),t},_prepareModel:function(e){return this.model=this.getModelBasedOnType(e.type),this._parent.apply(this,arguments)},setAttrToSplitBy:function(e,t){if(t&&this._attrToSplitBy!==e){var i=Object.prototype.hasOwnProperty;for(var s in this._TasksByAttr)i.call(this._TasksByAttr,s)&&this._cleanupSubCollectionForAttr(s)}this._attrToSplitBy=e},addNewTask:function(){var e=this.add.apply(this,arguments);if(window.widget){var t=d.getScopeId(),i=d.getScopeType(),s=d.getObjectData();if(t&&(!d.isScopeRDF()||d.isAgileWorkContext())){var o=-1===this.projectTypes().split(",").indexOf(i)?"scopes":"DPMProject";"tempfix"!==(t=s?s.id:t)&&e.addObjects([t],o)}}return e},setup:function(t,i){var a=Array.prototype.slice.call(arguments,0);if(window.widget){var n=s.getContext().split(".");n&&n.length&&(this.collabSpace=n[n.length-1])}Object.defineProperty(this,"fetching",{get:()=>this._fetching,set:e=>{this._fetching=e,this.dispatchEvent(h.ON_FETCH_COUNT_CHANGED)}}),this._allSelectFieldValues={},this.fetching=0,this._TasksByAttr={},this._attrToSplitBy="state",this.extid="allTasks";var l=e.clone(i,!1);l.serviceName="/resources/v1/modeler/tasks",l.initialLoadOptions="$include=none&$fields=none,title,modifyAccess,hasWorkContext,deleteAccess,state,dueDate,routeTaskDueDate,routeOwnerTask,routeTaskRouteId,routeOwner,constraintType,constraintDate&$definition=true&$terse=true",l.completeOptions="$terse=true&"+S+"&$fields=deliverablesInheritance,isAssigneeAccessRestricted,calculateDuration,revision,custom,references.description,references.islast,deliverables.description,deliverables.islast,scopes.islast,routeTaskRouteId,routeOwner,constraintType,constraintDate,taskCompletionType",a[1]=l,this._translate=i.translate,this.addEvent("onSync",this._onSync),this.dictionaryLoaded=!1,this._allStates=[{actualValue:"Create",displayValue:C("emxCollaborativeTasks.Label.Preliminary")},{actualValue:"Assign",displayValue:C("emxCollaborativeTasks.Label.ToDo")},{actualValue:"Active",displayValue:C("emxCollaborativeTasks.Label.InWork")},{actualValue:"Review",displayValue:C("emxCollaborativeTasks.Label.InReview")},{actualValue:"Complete",displayValue:C("emxCollaborativeTasks.Label.Completed")}];for(var r=this._allStates.length,c=0;c<r;c++){var d=this._allStates[c];o.setWidgetConstant(d.actualValue,d.displayValue)}var u=this.data();u&&u.definitions?this._allDueDates=this._getDefRange(T):this._allDueDates=[{actualValue:_,displayValue:C("emxCollaborativeTasks.Label.Overdue")},{actualValue:k,displayValue:C("emxCollaborativeTasks.Label.NoDate")},{actualValue:w,displayValue:C("emxCollaborativeTasks.Label.Today")},{actualValue:E,displayValue:C("emxCollaborativeTasks.Label.Tomorrow")},{actualValue:A,displayValue:C("emxCollaborativeTasks.Label.ThisWeek")},{actualValue:y,displayValue:C("emxCollaborativeTasks.Label.Future")}],this._allStatesForDisplay=[{actualValue:"To Do",displayValue:C("emxCollaborativeTasks.Label.ToDo")},{actualValue:"In Progress",displayValue:C("emxCollaborativeTasks.Label.InProgress")},{actualValue:"Done",displayValue:C("emxCollaborativeTasks.Label.Done")}],r=this._allStatesForDisplay.length;for(c=0;c<r;c++)d=this._allStatesForDisplay[c],o.setWidgetConstant(d.actualValue,d.displayValue);this._parent.apply(this,a)},setSearch:function(e){this._search=e,this._cleanupSubCollections(),this.dispatchEvent("onChange:search")},resetSearch:function(){delete this._search,this._cleanupSubCollections(),this.dispatchEvent("onChange:search")},getSearch:function(){return this._search},dataForRendering:function(){return{collabSpace:this.collabSpace}},tasksWithAttrValue:function(e,t){var i=this,s=t||this._attrToSplitBy,o=M(e);return this.filter((function(e){var t=M(e.get("state")),a=M(e.get(s)),n=M(e.get("title")||e.get("text")),l=!i._search||c.match(i._search,n);return(s!==h.DUE_DATE_CATEGORY||"Complete"!==t)&&(a===o&&l)}))},tasksWithAttrValueCollection:function(e,t){if(void 0!==e){var i=t||this._attrToSplitBy,s=M(e),o=this._TasksByAttr[i];if(!o||!o[s]){var a=this.tasksWithAttrValue(e,i),n={filterAttr:i,valueForFiltering:e,parentCollection:this},l=new I.TasksSplitCollection(a,n);l.extid="tasks-"+i+"-"+s,o||(this._TasksByAttr[i]=o={}),o[s]=l}return o[s]}},_getDefRange:function(e,t){var i,s=o.getAllFields(this.data())[e],a=[];if(s&&s.range)for(var n=s.range.item,l=n.length,r=0;r<l;r++){var c=n[r];i=t&&t.translateUsingE6WCommonAppsNLS?C("E6WCommonApps.Label."+c.display):C("emxCollaborativeTasks.Label."+c.display.replace(/ /g,"")),a.push({actualValue:c.value,displayValue:this._translate?i:c.display})}return a},allSelectFieldValues:function(e){if(!this._allSelectFieldValues[e]){var t=this.data();t&&t.definitions&&(this._allSelectFieldValues[e]=this._getDefRange(e))}return this._allSelectFieldValues[e]},allStates:function(){return this._allStates},allDueDates:function(){return this._allDueDates},allRouteTaskApprovalActions:function(e){return this._allRouteTaskApprovalActions||(this._allRouteTaskApprovalActions=this._getTranslatedAttributeValues("routeTaskApprovalAction",e)),this._allRouteTaskApprovalActions},allRouteTaskActions:function(e){return this._allRouteTaskActions||(this._allRouteTaskActions=this._getTranslatedAttributeValues("routeTaskAction",e)),this._allRouteTaskActions},allRouteTaskStates:function(e){return this._allRouteTaskStates||(this._allRouteTaskStates=this._getTranslatedAttributeValues(v,e)),this._allRouteTaskStates},allRouteTaskNoReviewStates:function(e){return this._allRouteTaskNoReviewStates||(this._allRouteTaskNoReviewStates=this._getTranslatedAttributeValues(v,e),this._allRouteTaskNoReviewStates&&this._allRouteTaskNoReviewStates.splice(1,1)),this._allRouteTaskNoReviewStates},_getTranslatedAttributeValues:function(e,t){var i,s=this.data();if(s&&s.definitions)for(var a=(i=this._getDefRange(e,t)).length,n=0;n<a;n++){var l=i[n];o.setWidgetConstant(l.actualValue,l.displayValue)}return i},setFlagForReferencedSimulationsService:function(e){widget.setValue("referencedSimulations",e.some((function(e){return"referencedSimulations"===e.name})))},allStatesForDisplay:function(){return this._allStatesForDisplay},allPrioritiesForDisplay:function(){return this._allPrioritiesForDisplay||(this._allPrioritiesForDisplay=this._getTranslatedAttributeValues(f,{translateUsingE6WCommonAppsNLS:!0})),this._allPrioritiesForDisplay},allValues:function(){switch(this._attrToSplitBy){case T:return this.allDueDates();case"state":return this.allStates();case"stateForDisplay":return this.allStatesForDisplay();case f:return this.allPrioritiesForDisplay();default:return[]}},getSearchTypes:function(e,t){var i,s=this._getDefRange(e);return s&&s.length&&(i=s[0][t]),i},scopesTypesForSearch:function(){return this.getSearchTypes("scopes.scopesTypesForSearch",D)},scopesTypes:function(){return this.getSearchTypes("scopes.scopesTypesForSearch",b)},contentsTypesForSearch:function(){return this.getSearchTypes("contents.contentsTypesForSearch",D)},contentsTypes:function(){return this.getSearchTypes("contents.contentsTypesForSearch",b)},deliverablesTypesForSearch:function(){return this.getSearchTypes("deliverables.deliverablesTypesForSearch",D)},deliverablesTypes:function(){return this.getSearchTypes("deliverables.deliverablesTypesForSearch",b)},projectTypesForSearch:function(){return this.getSearchTypes("projectTypesForSearch",D)},projectTypes:function(){return this.getSearchTypes("projectTypesForSearch",b)},importTasksFromCSV:function(e,s){var o,a,n,l,r,c=i.parse(e),d={},h=c.length,u=[],p=[],m="";function g(e,i,s,o){return new t((function(t,s){var a={onComplete:function(){i.forEach((function(e){e._onCompleteRequest()})),t(i)},onFailure:function(){i.forEach((function(e){e._onCompleteRequest()})),s(new Error("timeout for: "+o))}};e.save(null,a)}))}if(h)for(n=(a=c[0]).length,l=0;l<n;l++)(r=a[l].toLowerCase().trim()).match(/^(name|estimated duration|estimated finish date|type|description|assignee)$/)&&u.push({index:l,value:r.trim()});for(var C=this.allStates()[0],T=u.length,f=[],v=1;v<h;v++){a=c[v],(d={}).state=C;var S=[];for(l=0;l<T;l++){switch(r=a[u[l].index].trim(),u[l].value){case"name":d.title=r;break;case"estimated duration":d.estimatedDuration={actualValue:parseFloat(r),displayValue:r};break;case"estimated finish date":d.dueDate={actualValue:new Date(r).getTime(),displayValue:r};break;case"description":d.description={actualValue:r,displayValue:r};break;case"type":d.type=r.toLowerCase();break;case"assignee":S=r.split(";")}}"task"!==d.type||isNaN(d.estimatedDuration.actualValue)||isNaN(d.dueDate.actualValue)||(o=this.addNewTask(d),S&&S.length&&o.addAssigneesByName(S),p.push(o),o._onRequest(),this.updateModelInFoundation("create",o,null),m+=", "+d.title),p.length&&p.length%5==0&&(f.push(g(o,p,0,m)),p=[],m="")}p.length&&f.push(g(o,p,0,m)),t.all(f).then((function(){s.onComplete()}),(function(){s.onFailure()}))},_cleanupSubCollections:function(){var e=Object.prototype.hasOwnProperty;for(var t in this._TasksByAttr)e.call(this._TasksByAttr,t)&&this._cleanupSubCollectionForAttr(t)},_cleanupSubCollectionForAttr:function(e){var t=Object.prototype.hasOwnProperty,i=this._TasksByAttr[e];for(var s in i){if(t.call(i,s))i[s].stopListening(),delete i[s]}},sync:function(t,i,s){var a=s||{},n=this,r=n._getStorage();if("read"===t&&n.isServerFetch(i,a)&&a.partialRefresh){var c={data:[]},d=this.data();if(d&&d.data){d.data.forEach((function(e){var t={id:e.id,cestamp:e.cestamp};e.serviceId&&(t.serviceId=e.serviceId),c.data.push(t)}));var h="refreshWidget="+JSON.stringify(c);return o.loadServiceData(this._partialRefreshServiceName,(function(t){var i,s=n.data();if(o.copyDefinition(s,t),o.__updateCsrf(s,t),t&&t.success&&t.data){for(var l=t.data,c=l.length,d=0;d<c;d++){var h=l[d];switch(h.updateAction.toUpperCase()){case"DELETE":n.remove(h.tempId),o.unloadObjects(n.data(),[h.tempId]);break;case"MODIFY":var u=h,p=o.__getSourceObjectFromServerObject(s,u);o.__synchronizeSourceObjectFromServerObject(s,u,p,!0,!0);break;case"CREATE":delete(u=h).updateAction;var m=new(n.getModelBasedOnType(h.type))(u);o.__addOrConnectObjectToStructure(s,void 0,void 0,u,void 0,m),n.add(m)}}r&&o.saveCachedData(r,n._serviceName,s),e.is(a.onComplete,"function")&&(i=a.onComplete(t,a))}else e.is(a.onFailure,"function")&&(i=a.onFailure(t,a));return i}),!0,h,"application/x-www-form-urlencoded; charset=utf-8",S)}}else if(i instanceof l){var u=i;!u.toJSON({onlyUpdated:!0}).subscribed&&u.subscriptionsEnabled()&&u.set("sendEmail","sendEmail")}return this._parent.apply(this,arguments)},_onSync:function(e,t,i){if(e===this&&!this.dictionaryLoaded){var s=this.data();s&&s.definitions&&(this.dictionaryLoaded=!0,this.setFlagForReferencedSimulationsService(s.definitions),this.dispatchEvent("onChange:dictionary"))}},fetch:function(t){var i=this,s=e.clone(t||{},!1),o=d.getObjectData();if(!(!o||d.isAgileWorkContext()&&"3DSpace"===o.serviceId)&&(d.isScopeRDF()||s.forceRDF))return"local"===this.lastReadFrom&&(this.lastReadFrom="server",this.dispatchEvent("onChange:lastReadFrom",[this,this.lastReadFrom,t])),this.clearData(),this.reset(void 0,s),this.getTNProxy().setSubjectsTags({},"foundation2"),{cancel:function(){},noFetch:!0};const a=function(){i.fetching--};this.fetching++;const n=s.onComplete,l=s.onFailure;return s.partialRefresh?(void 0===s.parse&&(s.parse=!0),s.onComplete=function(e){a(),n&&n(i,e,s)},s.onFailure=function(e){a(),l&&l(i,e,s),i.dispatchEvent("onError",[i,e,s])},i.sync("read",i,s)):(s.onComplete=function(e){a(),n&&n(i,e,s)},s.onFailure=function(e){a(),l&&l(i,e,s)},this._parent(s))},fetchTaskById:function(t,i){this.fetch(e.extend({server:!0,url:"/resources/v1/modeler/tasks",method:"POST",data:"$ids="+t,contentType:"application/x-www-form-urlencoded"},i))},getModelsAsArrayToHandleTagger:p.getModelsAsArrayToHandleTagger});return I.optimized=!0,I.TasksSplitCollection=u.extend({model:l}),I})),define("DS/CollaborativeTasks/Views/CardView",["UWA/Core","DS/UIKIT/Tooltip","DS/UIKIT/Input/Button","DS/Handlebars/Handlebars4","DS/E6WCommonUI/Views/E6WHandlebarsHelpers","DS/E6WCommonUI/Views/FoundationBaseView","DS/CollaborativeTasks/Models/TaskModel","DS/E6WCommonUI/UIHelper","DS/E6WCommonUI/DragUtil","DS/CollaborativeTasks/Views/TaskMenuMixin","DS/CollaborativeTasks/Models/TskCloneModel","DS/E6WCommonApps/Models/RDFTaskCloneModel","DS/Foundation2/FoundationV2Data","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/Models/ComponentProxyModel","DS/CollaborativeTasks/Views/ERTasksDetailsPanelConfig","DS/E6WCommonApps/Views/RDFTaskDetailsPanelConfig","DS/E6WCommonUI/Models/DropValidator","DS/E6WCommonUI/CompassUtil","DS/E6WCommonApps/TaggerChipColorMixin","DS/E6WCommonApps/CSRFUtil","DS/E6WCommonUI/URLUtils","DS/E6WCommonUI/FeatureFlagUtils","DS/E6WCommonUI/E6WCommonUIConstants","DS/E6WCommonApps/Preferences","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS","i18n!DS/E6WCommonApps/assets/nls/CollaborativeTasksNLS","text!DS/CollaborativeTasks/assets/templates/card.html.handlebars","DS/Utilities/DateUtils"],(function(e,t,i,s,o,a,n,l,r,c,d,h,u,p,m,g,C,T,f,v,S,D,b,_,k,w,E,A,y,M,I){"use strict";l.fixDisplayMessageMethod();var V=function(e){var t=u.getWidgetConstant.apply(this,arguments);return t===e&&(t=E.get(e)),t},F=s.compile(M),P="DPMProject",R=".wux-controls-responsivetileview-checkbox",N=a.extend({_uwaClassName:"CardView",className:"card real-card drop-target",name:"CollaborativeTasks.CardView",domEvents:{"click .card-content":"onClickTaskCard","dragover ":"handleDragOver","dragleave ":"handleDragLeave","drop ":"handleDrop","dragend .drop-target":"handleDragEnd","dragstart ":"handleDragStart","mouseover .card-content":"handleMouseOver","mouseout .card-content":"handleMouseLeave"},droppedData:null,onClickTaskCard:function(e,t){e&&e.target&&e.target.hasClassName&&e.target.hasClassName("wux-controls-responsivetileview-checkbox")?this.onClickSelection():this.dispatchEvent("onTaskCardClicked",[this,t])},_toggleMultiSelectUI:function(e){try{let t=this.getColumn(),i=t&&t.getParentView();e=!!(e||i&&i._multiSelectMode),this.container.getElement(R).toggleClassName("wux-ui-state-prehighlighted",e)}catch(e){console.error(e)}},handleMouseOver:function(){this.container.addClassName("border-active"),this._toggleMultiSelectUI(!0)},handleMouseLeave:function(){this.container.removeClassName("border-active"),this._toggleMultiSelectUI(!1)},onClickSelection:function(){this.container.getElement(R).classList.remove("wux-ui-state-prehighlighted"),this.dispatchEvent("onMultiSelection",[this,{multiselect:!0}])},multiSelect:function(){this.onSelectCheckbox(),this.onSelect()},multiUnselect:function(){this.onUnselect(),this.onUnselectCheckbox()},onSelectCheckbox:function(){this.container.toggleClassName("checkbox-selected",!0),this.container.getElement(R).toggleClassName("wux-ui-state-highlighted",!0),this.getColumn().getParentView().getElements(`.collaborative-tasks-content ${R}`).forEach((function(e){e.classList.add("wux-ui-state-prehighlighted")}))},onUnselectCheckbox:function(){this.container.toggleClassName("checkbox-selected",!1),this.container.getElement(R).removeClassName("wux-ui-state-highlighted")},isSelected:function(){return this.container.className.contains(this._getActiveClassName())},isMultiSelected:function(){var e=this.container&&this.container.getElement(R);if(e)return e.className.contains("wux-ui-state-highlighted")},onSelect:function(){this.container.toggleClassName(this._getActiveClassName(),!0),v.publishOnPlatformAPI(window.widget.getValue("appId")+".select",this.model)},onUnselect:function(){this.container.toggleClassName(this._getActiveClassName(),!1),v.publishOnPlatformAPI(window.widget.getValue("appId")+".unselect",this.model)},_getActiveClassName:function(){return l.isTouchDevice()?"touch-active":"active"},id:function(){return"card"+(this.model.extid?this.model.extid:this.model.cid)},destroy:function(){this.container.innerHTML="",this._tooltip&&this._tooltip.destroy(),this.cardMenu&&this.cardMenu.dropdown&&this.cardMenu.dropdown.destroy(),this.cardMenu&&this.cardMenu.destroy(),delete this.cardMenu,this._parent()},_changeDirty:function(){this.container.toggleClassName("pending-modification",this.model.nbInFlightRequests>0),this.showSubscriptionIcon()},setup:function(e){var t=this;return this._parent.apply(this,arguments),!l.isTouchDevice()&&this.container.addEventListener("contextmenu",(function(e){e.preventDefault();let i=t.displayMenu.bind(t,e);return t.dispatchEvent("onTaskCardContextMenu",[t,i]),!1}),!1),this.listenToModelEvent(),e},updateButtons:function(){this._emptyMenuButtons(),this._drawMenuButtons()},listenToModelEvent:function(){var e=this,t={onChange:function(t,i){i&&i.relationshipChanged||e.render(),"assignees"===i.relationshipChanged||"contents"===i.relationshipChanged?e.render():!i||"references"!==i.relationshipChanged&&"deliverables"!==i.relationshipChanged&&"referencedSimulations"!==i.relationshipChanged||e.showAttachmentIcon()},"onChange:nbInFlightRequests":this._changeDirty};t["onChange:"+p.USER_DEFINED_START_DATE_ATTR]=this.showFixedIcon,t["onChange:"+p.USER_DEFINED_END_DATE_ATTR]=this.showFixedIcon,t["onChange:"+p.COMPLETE_PERCENT_ATTR]=this.showProgress,t["onChange:hasProject"]=this.updateButtons,t["onChange:"+P]=function(){this.updateButtons();var e=this.model.get(P);e&&e[0]&&this.render()},t["onChange:route"]=this.render,t["onChange: "+p.EXPLICIT_TAGS_DATA]=this.render,t.onModifyAccessChanged=this.updateButtons,t.onDeleteAccessChanged=this.updateButtons,t.onUserGroupMembersFetched=function(){this._event?this.displayMenu(this._event):this.updateButtons()},this.addTaggerChipColorChangeEvents(),this.listenTo(this.model,t)},template:function(){var e,t=this.model.dataForRendering({attributes:["id","card_icon","title","cardTitle","actualName","dueDate","assignees","name","firstname","lastname","state","stateForDisplay","priority","percentComplete"]});switch(t.cardTitle=t.cardTitle||t.title,this._addDataForLargeCards(t),t&&t.priority){case"Low":e=k.PRIORITY_LOW_ICON;break;case"Medium":e=k.PRIORITY_MEDIUM_ICON;break;case"High":e=k.PRIORITY_HIGH_ICON;break;case"Urgent":e=k.PRIORITY_URGENT_ICON}t.priority=e,t.notRDF=!(this.model.isRDFTask()||this.model.isIteropTask()),t.subtitle=this.model.get(p.DESCRIPTION_ATTR);var i=t.date&&t.date.actualValue;i&&(t.date.displayValue=I.formatDateToString(new Date(Number(i)),{dateStyle:"short"})),i&&(t.date.displayValue+=w.getWeekNumber(new Date(Number(i))));var s=o.i18n;o.i18n=V;var a=F(t);return o.i18n=s,a},_addDataForLargeCards:function(e){e.parent=this.model.getParentAsLabel(this.model),e.explicitTagsData=this.model.get(p.EXPLICIT_TAGS_DATA)},updateCardViewonScroll:function(){try{let t=this.getColumn();var e=t&&t.getParentView();e&&(e._selectedModels.length>0&&!e._selectedModels.includes(this.model)?(this.onUnselect(),this.onUnselectCheckbox()):e._multiSelectMode&&e._selectedModels.includes(this.model)&&(this.onSelect(),this.onSelectCheckbox()))}catch(e){console.error(e)}},render:function(){if(this.container){this.container.innerHTML=this.template(),this.container.setAttribute("draggable","true"),this._drawMenuButtons(!0),this.setDefaultImages(),this.showAttachmentIcon(),this._changeDirty(),this.showFixedIcon(),this.showAtRiskOrLateness(),this.showGreyPriorityIcon(),this.showProgress(),this.colorTaggerChip(),this._toggleMultiSelectUI(),this.updateCardViewonScroll();var e=this.model.get("assignees");e&&this.container.toggleClassName("more-assignees",Boolean(e.length>3))}return this},showAtRiskOrLateness:function(){var e=this.model.isLate(),t=this.model.isAtRisk(),i=this.model.isComplete(),s=this.model.isReadyToStart(),o=this.container.getElement(".card-progress span");this.container.removeClassName("at-risk"),this.container.removeClassName("late"),this.container.removeClassName("ready-to-start"),this.container.removeClassName("complete"),this.container.removeClassName("on-time"),e?(this.container.addClassName("late"),o&&o.setAttribute("title",V("emxCollaborativeTasks.Label.Late"))):t?(this.container.addClassName("at-risk"),s&&this.container.addClassName("ready-to-start")):s?(this.container.addClassName("ready-to-start"),this.container.addClassName("on-time")):i?this.container.addClassName("complete"):this.container.addClassName("on-time"),this.container.hasClassName("at-risk")&&o&&o.setAttribute("title",V("emxCollaborativeTasks.Label.Risk"))},showFixedIcon:function(){this.container.getElement(".card-properties")&&this.container.getElement(".card-properties").toggleClassName("is-fixed",Boolean(this.model.fixed))},showAttachmentIcon:function(){var e=this.model.get("references")||[],t=this.model.get("deliverables")||[],i=[];e.toArray&&(e=e.toArray()),t.toArray&&(t=t.toArray());var s=e.concat(t);_.referencedSimulationsEnabled()&&((i=this.model.get("referencedSimulations")||[]).toArray&&(i=i.toArray()),s=s.concat(i)),this.container.getElement(".card-properties")&&this.container.getElement(".card-properties").toggleClassName("has-files",Boolean(s.length))},showSubscriptionIcon:function(){var e=this.model.get("subscribed");this.container.getElement(".card-properties")&&this.container.getElement(".card-properties").toggleClassName("subscribed",this.model.subscriptionsEnabled()&&"TRUE"===e&&!this.model.isProjectTask()&&!this.model.isRouteTask())},showGreyPriorityIcon:function(){this.container.getElement(".card-properties")&&this.container.getElement(".card-properties").toggleClassName("is-complete",Boolean(this.model.isComplete()))},showProgress:function(){this.container.toggleClassName("has-progress",this.model.isRDFTask()||this.model.isProjectTask())},_emptyMenuButtons:function(){var e=this.getElement(".card-menu");e&&(this.cardMenu.dropdown&&this.cardMenu.dropdown.destroy(),e.empty())},displayMenu:function(e){var t=this;(this.updateButtons(),l.showAndUpdateContextualDropdownMenuPosition(t.cardMenu.dropdown,e),this._event=e,this.model.hasFetchedAccessData())||this.model.getAccessBatch().sendBatch({onComplete:function(){t.displayMenu(e)}})},_drawMenuButtons:function(e){var s=this.getElement(".card-menu"),o=this.createMenuButtons(e);if(s){this.cardMenu&&this.cardMenu.destroy(),this.cardMenu=new i(o).inject(s);var a=this;this.cardMenu.addEvent("onClick",(function(e){let t=a.displayMenu.bind(a,e);return a.dispatchEvent("onTaskCardContextMenu",[a,t]),!1})),this.cardMenu.elements.container.setStyle("min-width",""),this._tooltip=new t({target:this.cardMenu.elements.container,body:V("emxCollaborativeTasks.Label.TaskMenu")}),this.listenTo(this.cardMenu.dropdown,"onShow",(function(){this._parentView&&this._parentView.setDropdown(this.cardMenu.dropdown),document.addEventListener("contextmenu",this.cardMenu.dropdown.events.document.click,!0)})),this.listenTo(this.cardMenu.dropdown,"onHide",(function(){document.removeEventListener("contextmenu",this.cardMenu.dropdown.events.document.click,!0)}))}},handleDragStart:function(t){var i=[],s=this.getColumn&&this.getColumn().getParentView()._selectedModels;let o;s&&0!==s.length?i=s:e.is(this.model,"array")?i=this.model:i.push(this.model),i.forEach((function(e){try{if(!e.isIteropTask()){var t=e.getTransferObject();o?o.data.items.push(t.data.items[0]):o=t}}catch(e){console.error(e)}})),o&&(r.setDragModels(i),r.setDragTransferData(t,o))},canDragOverCard:function(){var e=!1;return!r.getDragModels()&&(e=this.model.isRDFTask()||"complete"!==this.model.get("state").toLowerCase()),e},handleDragOver:function(e){return e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),!!this.canDragOverCard()&&(e.dataTransfer.dropEffect="copy",this.container.addClassName(p.DROP_CLASS_NAME),!1)},handleDragEnter:function(){if(!this.canDragOverCard())return!1;a.getViewFromContainer(this.container.getClosest(".column"))._parentView.clearAllDropZoneMasks(),this.container.addClassName(p.DROP_CLASS_NAME)},handleDragLeave:function(e){e.target.getParent().toggleClassName(p.DROP_CLASS_NAME,!1)},handleDrop:function(e){if(e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),this.container.removeClassName(p.DROP_CLASS_NAME),!this.canDragOverCard())return!1;var t=e.dataTransfer.files;if(t&&t.length){if(this.model.uploadFiles){var i=this,s=this.model.get("state");s=s?s.toLowerCase():s;var o="references";"active"!==s&&"review"!==s&&"complete"!==s||(o="deliverables");var a={onFailure:function(e,t,s){var a={fieldName:i.model.getMappedAttribute(o),fileName:s&&s.file&&s.file.name};i.model.onFileUploadFailureMessage(a,e)}};if(a.fieldName=this.model.getMappedAttribute(o),a.onComplete=function(e,s,a){var r=a.documentObject,c=a.fileName,d=V("emxCollaborativeTasks.Label.SuccessfulSave");1===t.length&&(r.relateddata&&r.relateddata.files&&r.relateddata.files.length?c=r.relateddata.files[0].dataelements.title:r.dataelements&&r.dataelements&&r.dataelements.length&&(c=r.dataelements[0].title),d=n.getAttachmentSuccessMessage(o,c)),a.onComplete=function(){l.displaySuccess(d,{noEscape:!0})},i.model.onFileUploadCompleteMessage(a,r)},this.model.hasFetchedAccessData&&this.model.hasFetchedAccessData()&&this.model.canModify&&!this.model.canModify(!0))return l.displayError(A.get("E6WCommonUI.Error.noAccessOnObject")),!1;this.model.uploadFiles(t,o,a)}else l.displayError("emxCollaborativeTasks.Error.NoFileDrop");return!1}var r=l.getDataTransferJSON(e.dataTransfer);return r&&this.processDropData(r,e.dataTransfer),!1},handleDragEnd:function(){this.container.removeClassName(p.DROP_CLASS_NAME)},isValidObjectType:function(e){return"Person"===e.objectType||"pno:Person"===e.objectType||"Group Proxy"===e.objectType||"Group"===e.objectType||"foaf:Group"===e.objectType||e.objectType===p.LOGICAL_USER_TYPE},processDropData:function(e){var t=e.data.items,i=this.model.get("state");i=i?i.toLowerCase():i;for(let e=0;e<t.length;e++){const i=t[e];if(this.validateDroppedObject(i))return}let s="references";for(let e=0;e<t.length;e++){const d=t[e];var o=this.model instanceof n&&!this.model.isRouteTask(),a=d.objectType===p.SIMULATION_TYPE||d.objectType===p.SIMULATION_TEMPLATE_TYPE,r=d.objectType===p.TASK_RDF_TYPE||d.objectType===p.MILESTONE_RDF_TYPE,c=d.objectType===p.PROJECT_RDF_TYPE||d.objectType===p.XPROJECT_RDF_TYPE;this.isValidObjectType(d)?s="assignees":a&&o&&_.referencedSimulationsEnabled()?s="referencedSimulations":r||c||"active"!==i&&"review"!==i&&"complete"!==i||(s="deliverables");const h={save:e===t.length-1,onComplete:function(){if(1===t.length){var e=n.getAttachmentSuccessMessage(s,d.displayName);e&&l.displaySuccess(e,{noEscape:!0})}else y.get("emxCollaborativeTasks.Success.ManyObjectsAdded").replace({OBJECT_COUNT:t.length})},onFailure:function(){if(1===t.length){var e=n.getAttachmentErrorMessage(s,d.displayName);e&&l.displayError(e,{noEscape:!0})}else l.displayMessage(E.get("E6WCommonApps.Error.SaveFailed"))}};!d.objectType||"URL"!==d.objectType&&"dsplan:url"!==d.objectType?this.addAttributeToTask(d,s,h):this.createNewUrlObject&&this.createNewUrlObject(d,s,h)}},addAttributeToTask:function(e,t,i){this.model.isRDFTask()?this.addAttributeToRDFTask(e,t,i):this.addAttributeToNonRDFTask(e,t,i)},createNewUrlObject:function(t,i,s){let o=this,a={},n={id:t.objectId,name:t.displayName,title:t.displayName,type:t.objectType,linkURL:t.linkURL,description:t.description},l=function(a){let n=e.clone(t||{},!1),l=e.clone(a||{},!1);n.objectId=l.urlModel&&l.urlModel.id,o.addAttributeToTask(n,i,s)};if(this.model.isRDFTask())s.callback=l,"URL"===n.type&&(n=g.getNewProxyModel(n)),b.createURLForRDFObjects(this.model,n,s);else{if("dsplan:url"===n.type){let e=m.getObjectById(n.id);n={id:"dummyID",name:e.get("title"),type:"URL",linkURL:e.get("dsplan:linkURL"),description:""}}let l=g.getNewProxyModel(n);a[i]=[l],D.checkAndSetCSRF({targetObj:a,model:this.model,operation:"add",fieldName:i,callback:function(a){let n=e.clone(t||{},!1);n.objectId=a,o.addAttributeToTask(n,i,s)}},b.createOrDeleteURLForERTasks)}},addAttributeToRDFTask:function(e,t,i){if(this._tempCloneModel=this._tempCloneModel||new h(this.model),this._tempCloneModel.add(t,[e.objectId],{dropObj:e})&&i&&i.save){this._tempCloneModel.save({onComplete:function(){var i=n.getAttachmentSuccessMessage(t,e.displayName);i&&l.displaySuccess(i,{noEscape:!0})},onFailure:function(){var i=n.getAttachmentErrorMessage(t,e.displayName);i&&l.displayError(i,{noEscape:!0})},relationshipName:t,objectName:e.displayName}),delete this._tempCloneModel}},addAttributeToNonRDFTask:function(e,t,i){var s,o,a=e.objectType,r=this._getIdForDroppedItem(e);"pno:Person"===a&&(s="name",o=[{type:"Person",displayName:e.displayName}]);var c=this.model.addObjects([r],t,s,{otherObjectAttributes:o,attributes:{service:e.serviceId,tenant:e.envId},onFailure:function(e){l.displayError(e)}});c&&c.length&&i.save&&this.model.save(null,{onComplete:function(){var i=n.getAttachmentSuccessMessage(t,e.displayName);i&&l.displaySuccess(i,{noEscape:!0})},onFailure:function(e,t,i){l.displayError(n.getAttachmentErrorMessage(i.relationshipName,i.objectName),{noEscape:!0})},relationshipName:t,objectName:e.displayName,at:0})},_getFieldConfigForValidatingDrop:function(e){var t;return t=this.model instanceof n?C:T,this.isValidObjectType(e)?t.assigneeFieldConfig(this.model):t.attachmentFieldConfig},validateDroppedObject:function(e){var t,i=this._getFieldConfigForValidatingDrop(e);return(t=i.readWrite?f.validateDroppedObject(e,i):A.replace(A.get("E6WCommonUI.Alert.FailedToAttachObjectBadType"),{TYPE:e.displayType||l.translateType(e.objectType)}))&&l.displayError(t),t},_getIdForDroppedItem:function(e){var t=e.objectId;return this.model.isRDFTask()||"pno:Person"!==e.objectType||(t=m.splitUri(e.objectId)[1]),t},getColumn:function(){return this._parentView}});return N.implement(c,S),N})),define("DS/CollaborativeTasks/Sourcing/SourcingDetailsPanelConfig",["DS/Foundation2/FoundationV2Data","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/FederatedSearchUtil","DS/CollaborativeTasks/Models/TaskModel","DS/CollaborativeTasks/Views/ERTasksDetailsPanelConfig","DS/E6WCommonUI/Views/ObjectCardView","DS/E6WCommonUI/Models/DropValidator","DS/E6WCommonUI/UIHelper","DS/E6WCommonApps/Views/LinkLauncherUtils","DS/E6WCommonApps/SmartSchedulerUtils","DS/E6WCommonApps/Views/E6WObjectCardView","DS/E6WCommonApps/Views/RichTextEditorView","DS/E6WCommonApps/Views/CommonPropertiesConfig","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS","DS/E6WCommonUI/PlatformManager"],(function(e,t,i,s,o,a,n,l,r,c,d,h,u,p,m){"use strict";var g=function(t){var i=e.getWidgetConstant.apply(this,arguments);return i===t&&(i=p.get(t)),i},C={},T=function(e){var t=e&&e.isTaskReassignmentRequired()&&e.get("routeOwnerUGName");return m.getServiceUrl("swym",!0)&&!t?["swym"]:["3dspace"]};return C.config=function(e){var s=g("emxCollaborativeTasks.GroupLabel.More"),o="false"!==g("emxComponents.Routes.ShowCommentsForTaskApproval").toLowerCase().trim()||e&&"Comment"===e.get("routeTaskAction"),a="false"!==g("emxComponents.Routes.EnforceAssigneeApprovalComments").toLowerCase().trim(),n=e&&"No"!==e.get("routeTaskDueDate"),l=e&&"FALSE"!==e.get("routeTaskDelegationAllowed"),u=e.collection&&e.collection.contentsTypesForSearch(),p=e.collection&&e.collection.contentsTypes(),m=[{name:"title",label:g("emxCollaborativeTasks.Label.Title"),type:"text",numberOfEditableLines:4,maxLength:128},{name:"routeTaskAction",label:g("emxCollaborativeTasks.Label.TaskExpectedAction"),type:"select"},{name:"routeTaskInstructions",label:g("emxCollaborativeTasks.Label.TaskInstructions"),type:"textarea"},{name:"route",attributeToDisplay:"name",imageAttribute:"image",singleObjectOnly:!0,label:g("emxCollaborativeTasks.Label.Route"),type:"object",customView:d,linkCallback:r.launchProperties},{readWrite:"true",required:a,name:"routeTaskApprovalComments",label:g("emxCollaborativeTasks.Label.TaskApproverComments"),type:"RichText",titleAttribute:"title",customView:h,validate:a,isRoute:!0,numberOfDisplayLines:3,numberOfEditableLines:6},{name:"state",label:g("emxCollaborativeTasks.Label.TaskMaturityState"),type:"select"},{name:"routeTaskDueDate",label:g("emxCollaborativeTasks.Label.TaskDueDate"),type:"date"},{name:"assignees",attributeToDisplay:"name",imageAttribute:"image",label:g("emxCollaborativeTasks.Label.Assignees"),type:"person",customView:d,linkCallback:r.launchProperties,searchSource:i.filterSearchSources(T())},{name:"originatorInfo",attributeToDisplay:"name",imageAttribute:"image",label:g("emxCollaborativeTasks.Label.TaskOriginator"),type:"person",customView:d,linkCallback:r.launchProperties,searchSource:["swym"]},{name:"ownerInfo",attributeToDisplay:"name",imageAttribute:"image",label:g("emxCollaborativeTasks.Label.TaskOwner"),type:"person",customView:d,linkCallback:r.launchProperties,searchSource:["swym"]},{name:"contents",attributeToDisplay:"name",imageAttribute:"image",label:g("emxCollaborativeTasks.Label.Content"),searchTitle:g("emxCollaborativeTasks.Label.contentsSearchTitle"),typeAheadCallback:t.typeAheadCallback,type:"object",customView:d,linkCallback:r.launchProperties,placeHolder:g("emxCollaborativeTasks.Label.ObjectPlaceHolder"),searchSource:i.filterSearchSources(["3dspace"]),dropTypes:{"3dspace":p&&p.split(",")},searchSourceTypes:{"3dspace":u&&u.split(",")},excludeSearchTypes:{"3dspace":["Person","Security Context"]},allowFileManagement:!0,validateSameTenant:!0,getDropDownMenuItems:c.getDocumentTypeDropDownMenuItems},{name:"project",label:g("emxCollaborativeTasks.Label.CollaborativeSpace"),type:"text"},{name:"originated",label:g("emxCollaborativeTasks.Label.TaskCreated"),type:"date",group:s},{name:"modified",label:g("emxCollaborativeTasks.Label.TaskModified"),type:"date",group:s}],C=e.get("routeOwner"),f=(e.get("routeOwnerUGName"),e.get("state")),v=l||enoviaServer.user===C;o||m.splice(4,1);for(var S=0;S<m.length;S++)("assignees"===m[S].name&&!v||"routeTaskDueDate"===m[S].name&&!n||"routeTaskReviewerComments"===m[S].name&&(enoviaServer.user!==C||"Review"!==f))&&delete m[S].readWrite,("routeTaskReviewerComments"===m[S].name&&(enoviaServer.user!==C||"Review"!==f)||"routeTaskApprovalComments"===m[S].name&&"Complete"===f)&&(delete m[S].required,delete m[S].validate,delete m[S].numberOfDisplayLines);return m},C})),define("DS/CollaborativeTasks/Views/DetailsPanelMixin",["UWA/Core","DS/UIKIT/Input/Button","DS/UIKIT/DropdownMenu","DS/Foundation2/FoundationV2Data","DS/E6WCommonUI/UIHelper","DS/E6WCommonUI/Models/BulkModel","DS/E6WCommonUI/Models/CloneModel","DS/E6WCommonUI/Models/BulkCloneModel","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/E6WCommonApps/Models/NoAccessModel","DS/E6WCommonApps/Models/RDFTaskModel","DS/E6WCommonApps/Models/RDFTaskCloneModel","DS/E6WCommonApps/Models/IteropTaskModel","DS/E6WCommonApps/Views/PropertyPanel","DS/E6WCommonApps/Utils/RestrictUtils","DS/E6WCommonApps/Utils/ScenariosUtils","DS/E6WCommonApps/SmartSchedulerUtils","DS/CollaborativeTasks/Sourcing/SourcingTaskModel","DS/E6WCommonApps/Views/RDFTaskDetailsPanelConfig","DS/CollaborativeTasks/Views/ERTasksDetailsPanelConfig","DS/CollaborativeTasks/Views/IteropTaskDetailsPanelConfig","DS/CollaborativeTasks/Sourcing/SourcingDetailsPanelConfig","DS/CollaborativeTasks/Models/TskCloneModel","DS/DocumentManagement/DocumentManagement","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],(function(e,t,i,s,o,a,n,l,r,c,d,h,u,p,m,g,C,T,f,v,S,D,b,_,k,w){"use strict";var E=function(e){var t=s.getWidgetConstant.apply(this,arguments);if(t===e||null==t){var i=k.get(e);return i===e&&(i=w.get(e)),i}return t},A="DPMProject",y=!0,M="column ds-dialog property-panel off",I="off",V="state",F="estimatedDurationInputValue",P="Create",R="Review",N="Complete";I="active";var L={_durationOfDetailOpening:500,className:M="slide-in-panel right ds-dialog",tagName:"div",domEvents:{"click #subscribeToItem":"toggleSubscription",resize:function(){delete this._width,this._adjustHeader()}},bookmarkItem:function(){this._bookmarkHandler()},open:function(e){var t=this;this.container.toggleClassName(I,y),this._width=e,this._isOpen||(this._isOpen=!0,this._unlockWidths(),this.dispatchEvent("onOpen",[this.getContent()])),this._detailsView&&!this.maximize&&(this._detailsView.container.style.width=e+"px",setTimeout((function(){t._detailsView&&(t._detailsView.container.style.width="")}),this._durationOfDetailOpening),this._detailsView._resizeHandler()),this._parent.apply(this,arguments)},close:function(){this._parent.apply(this,arguments),this.container&&(this.container.toggleClassName(I,!1),this._isOpen&&(this._isOpen=!1,this._lockWidths(),this.dispatchEvent("onCloseIfOpen")))},isOpen:function(){return this._isOpen},init:function(t){var i=e.clone(t||{},!1);t.collection&&(i.scopesTypes=t.collection.scopesTypes(),i.scopesTypesForSearch=t.collection.scopesTypesForSearch(),i.contentsTypes=t.collection.contentsTypes(),i.contentsTypesForSearch=t.collection.contentsTypesForSearch(),i.projectTypes=t.collection.projectTypes(),i.projectTypesForSearch=t.collection.projectTypesForSearch(),i.deliverablesTypes=t.collection.deliverablesTypes(),i.deliverablesTypesForSearch=t.collection.deliverablesTypesForSearch()),delete i.collection,this._parent(i)},setup:function(t){var i=e.clone(t||{},!1);if(this.erTaskConfig=v.config(),this.projectConfig=v.projectConfig(),this.erTaskConfig.options=v.options,this.scopesTypes=t&&t.scopesTypes?t.scopesTypes.split(","):[],this.projectTypes=t&&t.projectTypes?t.projectTypes.split(","):[],this.contentsTypes=t&&t.contentsTypes?t.contentsTypes.split(","):[],this._updateConfigValues(t),e.Utils.Client.Platform.ios||e.Utils.Client.Platform.android)for(var s=this.erTaskConfig.length,o=0;o<s;o++){var a=this.erTaskConfig[o];switch(a.type){case"object":case"person":a.appendTo=".collaborative-tasks"}}return i.buttons=this._getButtonConfig(),i.detailsViewParameters={DocumentManagement:_},this._parent(i),this.model&&this._detailsView.setConfig(this.getConfig()),this._callbackForVisibleTasks=t.callbackForVisibleTasks,t},getDropDownMenu:function(){var t=[];if(this.model){if(this.model instanceof a){let e={dropdownItems:t,model:this.model,selectedModels:this.model&&this.model.models,isDetailsPanel:!0};this.createMultiItemsMenu(e)}else this.model&&this.model.hasExternalPanel&&!this.model.hasExternalPanel()&&(this.getApprovalMenuItems&&this.getApprovalMenuItems(t,this.model),this.getConditionalDropMenuItems&&this.getConditionalDropMenuItems(t,!0),this.getCompleteMenuConfig&&t.push(this.getCompleteMenuConfig(this.model)),this.isRouteTask(this.model)&&"Approve"===this.model.get("routeTaskAction")&&"Assign"===this.model.get("state")&&t.pop(),t.push(this.getBookmarkMenuConfig(this.model)),t.push(this.getDuplicateMenuConfig({model:this.model,parentView:this.getParentView()})),e.is(this.getSelectedTab,"function")&&this.getSelectedTab()===p.HISTORY_TAB&&this.model.isRDF&&t.push(this.getExportHistoryDropdownMenuItem()),t.push(this.getDividerConfig()),t.push(this.getDeleteMenuConfig({model:this.model})));t.forEach((function(e){!e.handler&&e.func&&(e.handler=e.func)}))}if(this.model instanceof T){t=this.filterDropdownItems(t)}var s={className:"properties-menu",target:this.container.getElement(".fonticon-down-open"),items:t};return new i(s)},_updateConfigValues:function(t){this.erTaskConfig.detect((function(e){return"state"===e.name})).values=t.stateValues;var i=this.erTaskConfig.detect((function(e){return"scopes"===e.name}));i.dropTypes={"3dspace":t.scopesTypes?t.scopesTypes.split(","):[]},i.searchSourceTypes={"3dspace":t.scopesTypesForSearch?t.scopesTypesForSearch.split(","):[]};var s=this.erTaskConfig.detect((function(e){return"DPMProject"===e.name}));s.dropTypes={"3dspace":t.projectTypes?t.projectTypes.split(","):[]},s.searchSourceTypes={"3dspace":t.projectTypes?t.projectTypes.split(","):[]};var o={dropTypes:{"3dspace":t.deliverablesTypes?t.deliverablesTypes.split(","):[]},searchSourceTypes:{"3dspace":t.deliverablesTypesForSearch?t.deliverablesTypesForSearch.split(","):[]}},a=this.erTaskConfig.detect((function(e){return"deliverables"===e.name}));-1!==a.searchSource.indexOf("drive")&&(o.dropTypes.drive=["DriveFile"],o.searchSourceTypes.drive=["DriveFile"]),a.dropTypes=Object.assign({},a.dropTypes,o.dropTypes),e.merge(a,o),this.projectConfig.detect((function(e){return"taskRequirement"===e.name})).values=t.taskRequirementValues,this.erTaskConfig.detect((function(e){return"taskCompletionType"===e.name})).values=t.taskCompletionTypeValues},onFieldValueChange:function(){var e=this._scroller&&this._scroller.getInnerElement().scrollTop,t=this._scroller&&this._scroller.getInnerElement().scrollLeft;this._detailsView.setConfig(this.getConfig()),this.render(),this._scroller&&this._scroller.scrollTo(t,e)},filterDropdownItems:function(e){let t=["INFO","THUMBS-UP","THUMBS-DOWN"];return e.filter((e=>{if(e.fonticon){let i=e.fonticon.toUpperCase();return t.includes(i)}return!1}))},getConfig:function(e){var t=this.getOriginalConfig(e);return this._parent(t)},getOriginalConfig:function(){var t;if(!this.model)return this.erTaskConfig;var i=this.model;let s={};if(i instanceof a){if(!i.models.length)return this.erTaskConfig;i=i.models[0],s.multiSelect=!0}!o.isTask(i.getObjectType())&&i.isRDFTask()||(this.model instanceof T?(t=this._getSourcingTaskConfig()).options=v.options:i.isRDFTask()?((t=this._getRDFTaskConfig(this._detailsView&&this._detailsView.model&&this._detailsView.model.model===i?this._detailsView.model:i,s)).options=f.options,this.showOrHideBookmarkForRepositoryField(t)):i.isIteropTask()?(t=this._getIteropTaskConfig(i)).options=S.options:(t=this._getERTaskConfig(i)).options=v.options);var n=e.clone(t,!0);if(n.options=t.options,!(i instanceof a)){(i.isProjectTask()||"TRUE"===i.get("hasProject"))&&this.treatProjectTaskAttributes(n);var l=i.getCustomFields();l&&!s.multiSelect&&this.treatCustomFields(n,l);let e=i.get("restrictedAccess")&&i.get("restrictedAccess").split(",");if(e)if("all"===e)for(let e=0;e<n.length;e++)n[e].readWrite=!1;else{var r=n.filter((function(t){return e.includes(t.name)}));for(let e=0;e<r.length;e++){const t=r[e];var c=n.findIndex((function(e){return e.name===t.name}));n[c].readWrite=!1}}m.updateRestrictedAttributes(n,i),g.inScenario()&&g.updateScenarioAttributes(t,i.get("dsxplan:jsType"))}return this.config=n,n},subscribedToItem:function(){return"TRUE"===this.model.get("subscribed")},_emptyMenu:function(){this._menu&&(this._menu.destroy(),delete this._menu)},_drawMenu:function(){var e=this.getElement(".panel-overflow");e&&(e.empty(),this._menu=new t(this._panelActionsMenu).inject(e),this._menu.elements.container.setStyle("min-width","")),this._adjustHeader()},render:function(){return this._parent.apply(this,arguments),this._dropDownMenu&&this._dropDownMenu.destroy(),this._dropDownMenu=this.getDropDownMenu(),this._updateActionButtonsState(),this.toggleLaunchControl(),this},_adjustHeader:function(){var t=this.getContent(),i=this.getElement(".panel-tabs"),s=this.getElement(".panel-actions");if(t&&i&&s){t.removeClassName("overflow");var o=e.is(this._width)?this._width:t.offsetWidth;s.offsetWidth>=o-i.offsetWidth?t.addClassName("overflow"):t.removeClassName("overflow")}},toggleLaunchControl:function(){var e=this.getElement("#openProjectItem");if(e){var t=this.model.get(A);t&&t.length?e.toggleClassName("disabled",!1):e.toggleClassName("disabled",!0)}},getDPMGateMilestoneStates:function(){return[{actualValue:P,displayValue:E("emxCollaborativeTasks.Label.Preliminary")},{actualValue:R,displayValue:E("emxCollaborativeTasks.Label.InReview")},{actualValue:N,displayValue:E("emxCollaborativeTasks.Label.Completed")}]},getStates:function(){var e=[];return e.push({actualValue:r.STATE_OPEN,displayValue:E("emxCollaborativeTasks.Label.ToDo")}),e.push({actualValue:r.STATE_IN_PROGRESS,displayValue:E("emxCollaborativeTasks.Label.InProgress")}),e.push({actualValue:r.STATE_DONE,displayValue:E("emxCollaborativeTasks.Label.Done")}),e},redrawPanel:function(){this.resetModel(this.model||this._detailsView.model,{},!0)},destroy:function(){this._emptyMenu(),this._dropDownMenu&&this._dropDownMenu.destroy(),delete this._panelActionsMenu,delete this.erTaskConfig,delete this.config,delete this.projectConfig,delete this.scopesTypes,delete this.projectTypes,delete this.contentsTypes,this._unlockTimeout&&clearTimeout(this._unlockTimeout),delete this._unlockTimeout,delete this._bookmarkHandler,this._parent.apply(this,arguments)},_lockWidths:function(){var e=this.container.getSize().width,t=this.container.getElement(".body");t&&(t.setStyle("width",e),this.container.getElement(".footer").setStyle("width",e),this.container.getElement(".header").setStyle("width",e),this._unlockTimeout&&clearTimeout(this._unlockTimeout),this._unlockTimeout=setTimeout(this._unlockWidths.bind(this),this._durationOfDetailOpening))},_unlockWidths:function(){if(this.container){var e=this.container.getElement(".body");e&&(e.setStyle("width",""),this.container.getElement(".footer").setStyle("width",""),this.container.getElement(".header").setStyle("width",""))}},_getButtonConfig:function(){const e=[];return!this.model||!this.model.isRDF||this.model instanceof a||e.push({id:"openSubButtonPropertPanel",title:E("E6WCommonApps.Label.Subscription"),fonticon:this.model.get("_xplanSubscribed")?"bell active no-hover":"bell-off"}),e.push({id:"openMenuButton",title:E("E6WCommonApps.Label.OpenMenu"),fonticon:"down-open"}),e},_getSourcingTaskConfig:function(){for(var t=D.config(this.model),i=this.model&&"No"!==this.model.get("needsReview"),s=this.options,o=t.length,a=0;a<o;a++){var n=t[a];"state"===n.name?n.values=i?s.routeTaskStateValues:s.routeTaskNoReviewStateValues:"routeTaskApprovalAction"===n.name?n.values=s.routeTaskApprovalActionValues:"routeTaskAction"===n.name&&(n.values=s.routeTaskActionValues)}if(e.Utils.Client.Platform.ios||e.Utils.Client.Platform.android)for(var l=0;l<o;l++){var r=t[l];switch(r.type){case"object":case"person":r.appendTo=".collaborative-tasks"}}return t},_getRDFTaskConfig:function(e,t){for(var i=f.config(e||this.model,t),s=i.length,o=0;o<s;o++){var a=i[o];a.name===r.STATE_ATTR?a.values=this.getStates():"dependencies"===a.name&&(a.getVisibleModels=this._callbackForVisibleTasks)}return i},_getERTaskConfig:function(t){var i=e.clone(this.erTaskConfig,!1);if(i.find((function(e){return e.name===r.COOWNERATTR})).readWrite=t.hasChangeSOVAccess(),!this.model.isProjectTask()){var s=i.findIndex((function(e){return"dependencies"===e.name}));s>=0&&i.splice(s,1)}var a=t&&(t.get("dsxplan:jsType")||t.get("type"));return o.isMilestone(a)||o.isGate(a)?this._getDPMGateMilestoneConfig(i):i},_getDPMGateMilestoneConfig:function(t){for(var i=e.clone(t,!0),s=i.length,o=-1,a=0;a<s;a++){var n=i[a];n.name===V?n.values=this.getDPMGateMilestoneStates():n.name===F&&(o=a)}return o>-1&&i.splice(o,1),i},_getIteropTaskConfig:function(e){return S.config(e)},treatCustomFields:function(t,i){for(var s=Object.keys(i),o=s.length,a=0;a<o;a++){var n=i[s[a]],l={};if(l.name=n.name,l.label=n.label,void 0!==this.model.get(n.name)){var r=n.viewConfig;try{if(l.name&&l.label&&r){e.extend(l,r),l.multivalue&&delete l.readWrite,n.mandatory&&(l.required=!0,l.validate=!0);var c=l.insertIndex||0;void 0!==l.insertIndex?t.splice(c,0,l):t.push(l)}}catch(e){console.log(e)}}}},_updateCompleteButton:function(){var e,t=this.getElement("#completeItem");if(this.model&&this.model.isRouteTask()&&"Assign"===this.model.get("state")&&"Approve"===this.model.get("routeTaskAction")?t.toggleClassName("hidden",!0):t.toggleClassName("hidden",!1),!this.model||this.completeItemAccess()||this.reOpenItemAccess()?t.toggleClassName("disabled",!1):t.toggleClassName("disabled",!0),this.reOpenItemAccess()){e=E("emxCollaborativeTasks.Command.ReOpen"),t.setAttribute("title",E("emxCollaborativeTasks.Command.ReOpen"));var i=t.getElement(".fonticon-check");i&&i.removeClassName("fonticon-check").addClassName("fonticon-reset")}else{e=E("emxCollaborativeTasks.Command.Complete"),t.setAttribute("title",E("emxCollaborativeTasks.Command.Complete"));var s=t.getElement(".fonticon-reset");s&&s.removeClassName("fonticon-reset").addClassName("fonticon-check")}const a=this._childrenViews.find((e=>e&&e.options&&e.options.target&&e.options.target.getElement("#completeItem")));this.removeChildView(a),a&&a.elements&&a.destroy(),this.addChildView(o.createTooltip(t,e))},treatProjectTaskAttributes:function(t){for(var i=t.length,a=3,n=-1,l=0;l<i;l++){if("DPMProject"===t[l].name){var c=e.clone(t[l]);delete c.readWrite,t[l]=c,a--}else if("dueDate"===t[l].name)n=l,a--;else if("estimatedDuration"===t[l].name){if("Review"===this.model.get("state")){var d=e.clone(t[l]);delete d.readWrite,t[l]=d}a--}if(0===a)break}n>-1&&t.splice(n,1);var h=this.projectConfig,u=this.model.get("dsxplan:jsType")||this.model.get("type");if(this.model.isProjectTask()){var p=this.model.get("state"),m=h.find((function(e){return"needsReview"===e.name}));m&&(m.readWrite="Review"!==p&&"Complete"!==p)}var g=!1;if((o.isMilestone(u)||o.isGate(u))&&(g=!0,h=h.filter((e=>!["needsReview","calculateDuration"].includes(e.name)))),h&&h.length>0)for(var C=0,T=h.length;C<T;C++){if("calculateDuration"===h[C].name)if(this.model&&this.model.collection&&e.is(this.model.collection.data,"function"))if(!s.getAllFields(this.model.collection.data()).calculateDuration)continue;if(g&&h[C].name===r.PERCENT_COMPLETE){var f=e.clone(h[C],!1);f.step=100,t.splice(h[C].insertIndex,0,f)}else t.splice(h[C].insertIndex,0,h[C])}},cloneModelForDetailDisplayView:function(){if(this.model){var e,t=this.CloneClass;return(this.model instanceof d||this.model.isRDF)&&(t=h),t?this.model instanceof u&&(t=n):t=b,this.model instanceof a?e=new l(this.model,t,v.options,{scopesTypes:this.scopesTypes,projectTypes:this.projectTypes,contentsTypes:this.contentsTypes}):((e=new t(this.model,v.options)).scopesTypes=this.scopesTypes,e.projectTypes=this.projectTypes,e.contentsTypes=this.contentsTypes),e}},resetModel:function(e,t){var i=this;this._parent(e,t);var s=function(){i._panelActionsMenu=i.createMenuButtons(),i.onFieldValueChange()};this.listenTo(this.model,"onChange:hasProject",s),this.listenTo(this.model,"onChange:"+A,s),this.listenTo(this.model,"onChange:PALId",this.onFieldValueChange),this.listenTo(this.model,"onChange:subscribed",this.onFieldValueChange),this.listenTo(this.model,"onChange:_xplanSubscribed",this._updateActionButtonsState),this.listenTo(this.model,"onChange:routeOwner",this.onFieldValueChange);var o={onDeleteAccessChanged:this._updateStateOfDeleteButton,onDestroy:this.close};this.listenTo(this.model,o),this.listenTo(this.model,"onModifyAccessChanged",this._updateStateOfAssignToSelfButton);const n=this.container.getElement(".panel-actions");n&&n.empty(),this.buttonConfig=this._getButtonConfig(),this._initButtons(this.buttonConfig),this._dropDownMenu&&this._dropDownMenu.destroy(),this._dropDownMenu=this.getDropDownMenu(),this.listenTo(this.model,"onChange:"+r.STATE_ATTR,this.redrawPanel),this.listenTo(this.model,"onChange:routeTaskAction",this.redrawPanel),this.model instanceof a&&this.listenTo(this.model,"onChange:"+r.TSK_STATE_ATTR,this.onFieldValueChange),this.listenTo(this.model,"onChange:"+r.PARENT_HAS_SWYM_COMMUNITY,this.onFieldValueChange),this.listenTo(this.model,"onChange:"+r.PARENT_HAS_LEAN_BOARD,this.onFieldValueChange),this.listenTo(this.model,"onChange:"+r.PARENT_ATTR,this.onFieldValueChange),this.listenTo(this.model,"onChange:"+r.TASK_PARENT_ATTR,this.onFieldValueChange),this.listenTo(this.model,"onChange:"+r.RESTRICT_ASSIGNEE_ATTR,this.onFieldValueChange)}};return L.i18n=E,L.DPM_PROJECT=A,L.maximize=y,L.CLASS_NAME=M,L.ACTIVE_CLASS_NAME=I,L.DETAILSPANEL_MAX_WIDTH=400,L.MATURITY_STATE_CONFIG_ATTR=V,L.ESTIMATED_DURATION_CONFIG_ATTR=F,L.STATE_CREATE_VALUE=P,L.STATE_REVIEW_VALUE=R,L.STATE_COMPLETE_VALUE=N,L})),define("DS/CollaborativeTasks/Views/ExternalDetailsPanel",["DS/E6WCommonApps/Views/PropertyPanel","DS/E6WCommonUI/UIHelper","DS/CollaborativeTasks/Views/DetailsPanelMixin","DS/ENOCollabRouteTask/RouteTaskHelper","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS"],(function(e,t,i,s,o){"use strict";var a=!0,n="column ds-dialog property-panel off",l="off",r=function(e){return o.get(e)};n="slide-in-panel right ds-dialog",l="active";var c=e.extend({_uwaClassName:"ExternalDetailsPanel",tagName:"div",className:n,name:"E6WCommonUI.ExternalDetailsPanelView",close:function(){this.container.toggleClassName(l,!1),this.dispatchEvent("onClose")},open:function(){this._parent.apply(this,arguments)},id:function(){return"ExternalDetailsPanel_"+this.cid},clear:function(){this.container.innerHTML=""},cloneModelForDetailDisplayView:function(){return this.model},getOriginalConfig:function(){return this.erTaskConfig},resetModel:function(e,i){this.clear(),this.container.toggleClassName(l,a),this.model=e,this._detailsView.model=e,this.model&&this.getTagInfoForModel(e);var n=this,c=UWA.clone(i||{},!1);c.close=function(){n.close(),n.dispatchEvent("onCancel")},e.isRouteTask()?this.panel=s.loadPanel(this.container,e,this._parentView.collection,i):require(["DS/ENOProjectMgmtList/views/ProjectDetailsView"],(function(i){new i({container:n.container,models:e.models?e.models:[e],onUpdateComplete:function(e){n.collection.get(e.get("id")).fetch()},onDeleteComplete:function(e){var i=o.replace(r("E6WCommonApps.Alert.ObjectDeleted"),{OBJECT_NAME:r("E6WCommonApps.Type."+n.model.getObjectType())});n.model._removeFromCollection(),t.displaySuccess(i),n.close()},onDeleteFailure:function(e){var i=o.replace(r("E6WCommonApps.Error.FailedToDeleteObject"),{OBJECT_NAME:r("E6WCommonApps.Type."+n.model.getObjectType())});t.displayError(i)},closePanel:function(e){n.close(),n.cancel(c)}}).render()}))},cancel:function(e){var t=UWA.clone(e||{},!1);let i=this;t.close=function(){i.close(),i.dispatchEvent("onCancel")},this.model&&this.model.isRouteTask()?s.cancelPanel(this.modal,this.model,t):this.model&&this.model.hasExternalPanel()&&UWA.is(t.onCancel,"function")&&t.onCancel()},_updateActionButtonsState:Function.prototype,getDropDownMenu:function(){},getOriginalConfig:function(){return{}},save:function(){},_getButtonConfig:Function.prototype,_initCommentsView:Function.prototype,_resetHistoryTab:Function.prototype,_resetCharacteristicsTab:Function.prototype,_setupStoryTaskListeners:Function.prototype,_initCharacteristicsView:Function.prototype,toggleSubscription:Function.prototype});return UWA.extend(c,i),c.maximize=a,c})),define("DS/CollaborativeTasks/Views/DetailsPanel",["UWA/Core","UWA/Class/Events","DS/Foundation2/FoundationV2Data","DS/E6WCommonApps/Views/PropertyPanel","DS/DocumentManagement/DocumentManagement","DS/UIKIT/Input/Button","DS/UIKIT/DropdownMenu","DS/CollaborativeTasks/Views/ERTasksDetailsPanelConfig","DS/CollaborativeTasks/Models/TskCloneModel","DS/CollaborativeTasks/Sourcing/SourcingTaskModel","DS/CollaborativeTasks/Views/TaskMenuMixin","DS/E6WCommonApps/Models/NoAccessModel","DS/E6WCommonApps/Models/RDFTaskModel","DS/E6WCommonApps/Models/RDFTaskCloneModel","DS/E6WCommonApps/Checklist/ChecklistView","DS/CollaborativeTasks/Views/DetailsPanelMixin","DS/E6WCommonApps/Models/AssigneeTypeAhead","DS/E6WCommonApps/Views/RDFTaskDetailsPanelConfig","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/E6WCommonApps/Models/IteropTaskModel","DS/CollaborativeTasks/Views/IteropTaskDetailsPanelConfig","DS/E6WCommonUI/Models/CloneModel","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS","DS/E6WCommonUI/UIHelper"],(function(e,t,i,s,o,a,n,l,r,c,d,h,u,p,m,g,C,T,f,v,S,D,b,_){"use strict";var k=function(e){var t=i.getWidgetConstant.apply(this,arguments);if(t===e||null==t){var s=b.get(e);return s===e&&(s=_.get(e)),s}return t},w="column ds-dialog property-panel off",E="off";w="slide-in-panel right ds-dialog",E="active";var A=s.extend({_uwaClassName:"DetailsPanel",className:w,name:"CollaborativeTasks.DetailsPanel",id:function(){return"DetailsPanelView"},getOriginalConfig:function(){var t=this.erTaskConfig;if(!this.model)return t;this.model instanceof c?(t=this._getSourcingTaskConfig()).options=l.options:this.model instanceof u?((t=this._getRDFTaskConfig(this._detailsView.model&&this._detailsView.model.model===this.model?this._detailsView.model:this.model)).options=T.options,this.showOrHideBookmarkForRepositoryField(t)):this.model instanceof v?(t=this._getIteropTaskConfig(this.model)).options=S.options:(t=this._getERTaskConfig(this.model)).options=l.options;var i=e.clone(t,!0);i.options=t.options,(this.model.isProjectTask()||"TRUE"===this.model.get("hasProject"))&&this.treatProjectTaskAttributes(i);var s=this.model.getCustomFields();return s&&this.treatCustomFields(i,s),this.config=i,i},getChecklistConfig:function(){return[{name:f.HAS_CHECKLIST_ATTR,customView:m}]},_updateActionButtonsState:function(){delete this._panelActionsMenu,this._panelActionsMenu=this.createMenuButtons();var t=this.getElement(".panel-actions #openSubButtonPropertPanel .fonticon"),i=this.getElement("#subscribeToItem"),s=this.getElement("#openProjectItem"),o=this.getElement("#duplicateButton");if(this._updateStateOfAssignToSelfButton(),this._updateStateOfDeleteButton(),t&&(t.className=this.model.get("_xplanSubscribed")?"fonticon fonticon-bell active no-hover":"fonticon fonticon-bell-off"),o){var a=e.is(this.model.getParent,"function")&&this.model.getParent();(this.model.isProjectTask()||this.model.isRouteTask()||!a||a&&a instanceof h)&&o.remove()}if(s&&(this.isModelAProjectTask()?s.toggleClassName("disabled",!1):s.remove()),i){i.toggleClassName("active",this.subscribedToItem());var n=this.getElement("#subscribeToItem");this.subscribedToItem()?n.set("title",k("emxCollaborativeTasks.Command.UnsubscribeFromNotifications")):n.set("title",k("emxCollaborativeTasks.Command.SubscribeToNotifications")),this.model.subscriptionsEnabled()||i.remove()}this._emptyMenu(),this._drawMenu()}});return A.implement(d,g),A.maximize=true,A.CLASS_NAME=w,A.ACTIVE_CLASS_NAME=E,A.STATE_CREATE_VALUE="Create",A.STATE_REVIEW_VALUE="Review",A.STATE_COMPLETE_VALUE="Complete",A.DETAILSPANEL_MAX_WIDTH=400,A.MATURITY_STATE_CONFIG_ATTR="state",A.ESTIMATED_DURATION_CONFIG_ATTR="estimatedDurationInputValue",A})),define("DS/CollaborativeTasks/MultiEdit/MultiDetailsPanel",["UWA/Core","UWA/Class/Events","DS/Foundation2/FoundationV2Data","DS/E6WCommonApps/Views/PropertyPanel","DS/E6WCommonApps/MultiEdit/MultiPropertyPanel","DS/DocumentManagement/DocumentManagement","DS/UIKIT/Input/Button","DS/UIKIT/DropdownMenu","DS/CollaborativeTasks/Views/ERTasksDetailsPanelConfig","DS/CollaborativeTasks/Models/TskCloneModel","DS/CollaborativeTasks/Sourcing/SourcingTaskModel","DS/CollaborativeTasks/Views/TaskMenuMixin","DS/CollaborativeTasks/Views/DetailsPanelMixin","DS/E6WCommonApps/Models/NoAccessModel","DS/E6WCommonApps/Models/RDFTaskModel","DS/E6WCommonApps/Models/RDFTaskCloneModel","DS/E6WCommonApps/Models/AssigneeTypeAhead","DS/E6WCommonApps/Views/RDFTaskDetailsPanelConfig","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/E6WCommonApps/Models/IteropTaskModel","DS/CollaborativeTasks/Views/IteropTaskDetailsPanelConfig","DS/E6WCommonUI/Models/CloneModel","DS/E6WCommonUI/Models/BulkCloneModel","DS/E6WCommonUI/Models/BulkModel","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS","DS/E6WCommonUI/UIHelper"],(function(e,t,i,s,o,a,n,l,r,c,d,h,u,p,m,g,C,T,f,v,S,D,b,_,k,w){"use strict";var E="column ds-dialog property-panel off",A="off";E="slide-in-panel right ds-dialog",A="active";var y=o.extend({_uwaClassName:"MultiDetailsPanel",_durationOfDetailOpening:500,tagName:"div",name:"CollaborativeTasks.MultiDetailsPanel",bookmarkItem:function(){this._bookmarkHandler()},id:function(){return"MultiDetailsPanelView"},getOriginalConfig:function(){var t;if(!this.model)return this.erTaskConfig;var i=this.model;i instanceof _&&(i=i.models[0]),this.model instanceof d?(t=this._getSourcingTaskConfig()).options=r.options:i.isRDFTask()?((t=this._getRDFTaskConfig(this._detailsView&&this._detailsView.model&&this._detailsView.model.model===i?this._detailsView.model:i)).options=T.options,this.showOrHideBookmarkForRepositoryField(t)):i.isIteropTask()?(t=this._getIteropTaskConfig(i)).options=S.options:(t=this._getERTaskConfig(i)).options=r.options;var s=e.clone(t,!0);if(s.options=t.options,!(i instanceof _)){(i.isProjectTask()||"TRUE"===i.get("hasProject"))&&this.treatProjectTaskAttributes(s);var o=i.getCustomFields();o&&this.treatCustomFields(s,o)}return this.config=s,s},_updateActionButtonsState:Function.prototype});return y.implement(h,u),y.maximize=true,y.CLASS_NAME=E,y.ACTIVE_CLASS_NAME=A,y.STATE_CREATE_VALUE="Create",y.STATE_REVIEW_VALUE="Review",y.STATE_COMPLETE_VALUE="Complete",y.DETAILSPANEL_MAX_WIDTH=400,y.MATURITY_STATE_CONFIG_ATTR="state",y.ESTIMATED_DURATION_CONFIG_ATTR="estimatedDurationInputValue",y})),define("DS/CollaborativeTasks/Sourcing/SourcingTaskCollection",["UWA/Core","DS/Foundation2/FoundationV2Data","DS/CollaborativeTasks/Sourcing/SourcingTaskModel","DS/CollaborativeTasks/Collections/TasksCollection","DS/E6WCommonApps/Collections/TasksSplitCollection","DS/E6WCommonUI/PlatformManager"],(function(e,t,i,s,o,a){"use strict";var n=s.extend({_uwaClassName:"SourcingTaskCollection",model:i,getModelBasedOnType:function(e){return i},setAttrToSplitBy:function(e){this._attrToSplitBy=e},_convertFoundationData:function(e){return e&&e.data&&(void 0===e.success||e.success)&&(e.definitions=this._3dspaceDefinitions),this._parent(e)},fetch:function(i){const s=e.clone(i||{},!1);return s.ignoreData||this.data()?this._parent.apply(this,arguments):(s.ignoreData=!0,t.loadServiceData("/resources/v1/modeler/tasks",(e=>{this._3dspaceDefinitions=e.definitions,this.fetch(s)}),!1,null,null,"$definition=nodata"))},sync:function(e,t,i){enoviaServer.setTempUrl(a.getServiceUrl("sourcing"));const s=enoviaServer.space;enoviaServer.space="ctx::VPLMProjectLeader.Company Name.SOURCING",i.noTag=!0;let o="";try{arguments[1]&&arguments[1]._initialLoadOptions&&arguments[1]._initialLoadOptions.includes("&$definition=true")&&(arguments[1]._initialLoadOptions=arguments[1]._initialLoadOptions.replace("&$definition=true","")),o=this._parent.apply(this,arguments)}catch(e){console.error(e)}finally{enoviaServer.setTempUrl(),enoviaServer.space=s}return o},complete:function(e,t,i){this._getStorage();enoviaServer.setTempUrl(a.getServiceUrl("sourcing"));const s=enoviaServer.space;enoviaServer.space="ctx::VPLMProjectLeader.Company Name.SOURCING";let o="";try{o=this._parent.apply(this,arguments)}catch(e){console.error(e)}finally{enoviaServer.setTempUrl(),enoviaServer.space=s}return o}});return n.optimized=!0,n.TasksSplitCollection=o.extend({model:i}),n})),define("DS/CollaborativeTasks/Views/ColumnView",["UWA/Core","UWA/Event","UWA/Class/View","DS/Windows/Dialog","DS/Controls/Button","DS/UIKIT/Scroller","DS/Handlebars/Handlebars4","DS/RDFFoundation/BusinessProcessUtils","DS/E6WCommonUI/Views/FoundationBaseView","DS/CollaborativeTasks/Collections/TasksCollection","DS/CollaborativeTasks/Views/CardView","DS/CollaborativeTasks/Views/CollaborativeTasksUtils","DS/UIKIT/Tooltip","DS/E6WCommonUI/UIHelper","DS/E6WCommonUI/DragUtil","DS/E6WCommonApps/SmartSchedulerUtils","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/E6WCommonApps/XTaskScope","DS/E6WCommonApps/Models/RDFTaskModel","DS/RDFFoundation/RDFUtils","text!DS/CollaborativeTasks/assets/templates/column.html.handlebars","DS/Foundation2/FoundationV2Data","DS/E6WCommonUI/Views/E6WHandlebarsHelpers","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS"],(function(e,t,i,s,o,a,n,l,r,c,d,h,u,p,m,g,C,T,f,v,S,D,b,_){"use strict";var k=function(e){var t=D.getWidgetConstant.apply(this,arguments);return t===e&&(t=_.get(e)),t},w=n.compile(S),E=r.extend({_uwaClassName:"ColumnView",tagName:"div",className:"column ds-dialog drop-target",name:"CollaborativeTasks.ColumnView",id:function(){return this.collection.extid},domEvents:{"dragstart .ui-droppable":"handleDragStart","dragenter .ui-droppable":"handleDragEnter","dragleave .ui-droppable":"handleDragLeave","dragover .ui-droppable":"handleDragOver","dragend .ui-droppable":"handleDragEnd","drop .ui-droppable":"handleDrop"},_addChildrenViewAtBack:function(){var e=this._childrenViews.length;this.resetChildViews(this._firstChild+e,!0),this._addChildrenToDom(e,void 0,!0)},_addChildrenViewAtFront:function(){var e=this._childrenViews.length,t=E.nbCardsBuffer-e;this.resetChildViews(Math.max(this._firstChild-t,0),!0,!0),this._addChildrenToDom(0,this._childrenViews.length-e,!0)},resizeBuffer:function(){var e=this._childrenViews.length;if(e<E.nbCardsBuffer&&e<this.collection.size()){var t=this.collection.size();if(this._firstChild+e>=t)this._addChildrenViewAtFront();else{this._addChildrenViewAtBack();var i=this._childrenViews.length;i<E.nbCardsBuffer&&i<this.collection.size()&&this._addChildrenViewAtFront()}}else if(e>E.nbCardsBuffer)for(var s;this._childrenViews.length>E.nbCardsBuffer;)s=this._childrenViews.pop(),this._recycleChild(s);this._adjustBufferHeights()},_onScroll:function(t){if(this.clearDropdown(),this.collection&&this.container){var i=e.Event.getElement(t);if(i&&this._childrenViews.length&&this.collection.length-this._childrenViews.length>0){E._cardHeight||this._computeCardHeight();var s=i.scrollTop,o=Math.floor(s/E._cardHeight),a=Math.max(o-E.nbCardsTopBuffer,0),n=(a=Math.min(a,this.collection.length-E.nbCardsBuffer))-this._firstChild;if(0!==n){if(n>0)if(n>=this._childrenViews.length)this.resetChildViews(a),this._addChildrenToDom(0,void 0);else{for(var l=0;l<n;l++){var r=this._childrenViews.shift();this._recycleChild(r)}this.resetChildViews(a+this._childrenViews.length,!0),this._addChildrenToDom(this._childrenViews.length-n,void 0)}else if(n<0)if((n=-n)>=this._childrenViews.length)this.resetChildViews(a),this._addChildrenToDom(0,void 0);else{for(var c=this._childrenViews.length-E.nbCardsBuffer+n,d=0;d<c;d++){var h=this._childrenViews.pop();this._recycleChild(h)}var u=this._childrenViews.length;this.resetChildViews(a,!0,!0),this._addChildrenToDom(0,this._childrenViews.length-u)}this._adjustBufferHeights()}}}},setDropdown:function(e){this.dropdown=e},clearDropdown:function(){this.dropdown&&(this.dropdown.hide(),delete this.dropdown)},_createTaskView:function(e){var t=new d({model:e,parentView:this});return this.listenTo(t,{onMultiSelection:function(){this.dispatchEvent("onMultiSelection",arguments)},onTaskCardClicked:function(){this.dispatchEvent("onTaskCardClicked",arguments)},onTaskCardEdit:function(){this.dispatchEvent("onTaskCardEdit",arguments)},onTaskCardContextMenu:function(){this.dispatchEvent("onTaskCardContextMenu",arguments)},onDestroy:function(){this.dispatchEvent("onTaskDestroyed",arguments)}}),t},_getRecycledChild:function(e){var t;return this._recycleBin&&this._recycleBin.length?((t=this._recycleBin.pop()).model=e,t.container.id=t.id(),t.listenToModelEvent(),delete t._recycled):t=this._createTaskView(e),t},_recycleChild:function(e,t){this.dispatchEvent("onTaskDestroyed",arguments),e._recycled=!0,e.container.remove(),e.container.empty(!0),this._recycleBin.push(e)},getNonRDFSelectedViewId:function(){var e=this.getParentView(),t=e&&e._selectedView;if(t&&!t.isDeleted&&t.model&&!t.model.isRDFTask())return t.model.id},resetChildViews:function(e,t,i){var s=e||0,o=this;this._childrenViews||(this._childrenViews=[]);var a=t?this._childrenViews.length:0;this._firstChild=s-(i?0:a);var n=o.collection.length,l=(s=Math.max(0,s))+(E.nbCardsBuffer-a);l=Math.min(n,l);var r={},c={};if(t)this._childrenViews.forEach((function(e){var t=e.model;r[t.id]=e}));else{var d=[];for(let e=s;e<l;e++){let t=o.collection.at(e);c[t.id]=e}this._childrenViews.forEach((function(e){var t=e.model;void 0===c[t.id]||isNaN(c[t.id])?o._recycleChild(e):(t.isRDFTask()||(o._recycleChild(e),e=o._getRecycledChild(o.collection.get(e.model.id))),d.push(e),r[t.id]=e)})),this._childrenViews=d}if(i)for(var h=l-1;h>=s;h--){var u=o.collection.at(h);if(u&&r[u.id])continue;let e=o._getRecycledChild(u);o._childrenViews.unshift(e)}else for(let e=s;e<l;e++){var p=o.collection.at(e);if(!p||!r[p.id]){var m=o._getRecycledChild(p);if(c&&void 0!==c[p.id]&&!isNaN(c[p.id])){let e=l>E.nbCardsBuffer?c[p.id]-s:c[p.id];o._childrenViews||(o._childrenViews=[]),o._childrenViews[e]?o._childrenViews.splice(e,0,m):o._childrenViews[e]=m}else o.addChildView(m)}}},tasksChanged:function(){this.container.innerHTML="",this.resetChildViews(),this.render()},_onAdd:function(e,t,i){const s=this.getElement(".ui-droppable");if(!(i&&i.fromServer||!s)){var o,a=i&&i.at,n=this._getRecycledChild(e);if(n){this._childrenViews.splice(a,0,n);var l=this.getElement(E.CssSelectorMarkingInsertionPoint);n.render(),0===a?n.container.inject(l,"after"):n.container.inject(this.getElement(E.CssSelectorMarkingBottomInsertionPoint),"before")}if(E.lastCardAdded=n,this._scroller&&this._scroller.scrollToElement(n.container),this._childrenViews.length>E.nbCardsBuffer)o=0!==a?this._childrenViews.shift():this._childrenViews.pop(),this._recycleChild(o);e.id&&(E.pushToComplete(n),this.scheduleComplete()),this._adjustBufferHeights(),this.getElement(E.TitleObjectCountId).setText(E.TitleObjectCountString.replace("%COUNT%",this.collection.length))}},_onRemove:function(e,t,i){var s=this;this._childrenViews=this._childrenViews.filter((function(t){return t.model!==e||(s._recycleChild(t,i),!1)}));var o=this._childrenViews.length,a=this.collection.length;this._firstChild+E.nbCardsBuffer>a&&E.nbCardsBuffer<a?(this.resetChildViews(this._firstChild-1,!0,!0),this._addChildrenToDom(0,this._childrenViews.length-o,!0)):(this.resetChildViews(this._firstChild+this._childrenViews.length,!0),this._addChildrenToDom(o,void 0,!0)),this._adjustBufferHeights(),this.getElement(E.TitleObjectCountId).setText(a?E.TitleObjectCountString.replace("%COUNT%",a):"")},onSortComplete:function(){let e=this._scroller.getInnerElement()&&this._scroller.getInnerElement().scrollTop;this.container.innerHTML="",this.resetChildViews(this._firstChild,!1),this.render(),this._scroller.scrollTo(0,e),this.resizeBuffer()},setup:function(e){return this._parent.apply(this,arguments),this._firstChild=0,this._scrolling=0,this.resetChildViews(),this.listenTo(this.collection,"sortComplete",this.onSortComplete),this.listenTo(this.collection,"onReset",this.tasksChanged),this.listenTo(this.collection,"onTaskCollectionFetchComplete",(function(){this._parentView.isBeingTagFiltered()||this.tasksChanged()})),this.listenTo(this.collection,"onAdd",this._onAdd),this.listenTo(this.collection,"onRemove",this._onRemove),this.listenTo(this.collection,"onValidationFailure",(function(e,t){var i;if(!(this._parentView&&this._parentView._multiSelectMode&&this._parentView._multiSelectMode.selectedModels&&this._parentView._multiSelectMode.selectedModels.length>1)){for(var s=0;s<t.fields.length;s++)"needsReview"===t.fields[s]?i=k("emxCollaborativeTasks.Error.needsReview"):"routeTaskApprovalComments"===t.fields[s]?i=k("emxCollaborativeTasks.Error.needsApprovalComments"):"routeTaskApprovalAction"===t.fields[s]?i=k("emxCollaborativeTasks.Error.needsApprovalAction"):"routeTaskReviewerComments"===t.fields[s]&&(i=k("emxCollaborativeTasks.Error.needsReviewerComments"));i&&p.displayError(i)}})),this._recycleBin=[],this.$dsTaskManagement=e.$dsTaskManagement,e},destroy:function(){clearTimeout(this.completeTimeout),delete this.completeTimeout,this.container.remove(),this._scroller&&this._scroller.destroy();for(var e=this._recycleBin.length,t=0;t<e;t++){this._recycleBin[t].destroy()}delete this._recycleBin,this._parent(),this.$dsTaskManagement=null,this.container=null,delete this._BottomPlaceholder,delete this._TopPlaceholder,this._taskFilterTooltip&&this._taskFilterTooltip.destroy(),delete this._taskFilterTooltip},template:function(){var e=b.i18n;b.i18n=k;var t=this.collection.dataForRendering(),i=t.filteredByValue&&t.filteredByValue.actualValue;"all"===widget.getValue(g.COMPLETED_TASK_PREF_NAME)||"Done"!==i&&"Complete"!==i||(t.completedTaskFilterOn=!0);var s=w(t);return b.i18n=e,s},displayDragAndDropSuccessMessage:function(){var e=this.getColumnFilterAttrValue(),t=k("emxCollaborativeTasks.Label.SuccessfullyChangedAttribute"),i=this.collection._valueForFiltering;i=i.displayValue?i.displayValue:i,t=(t=t.replace("%ATTRIBUTE_NAME%",k("emxCollaborativeTasks.Command.View."+e))).replace("%ATTRIBUTE_VALUE%",i),p.displaySuccess(t)},getErrorMessageForProcessControlledObject:function(e){let t;return e&&"E6WCommonApps.Error.noModifyFromOpenToCompleted"===e.message?t=_.replace(_.get("E6WCommonApps.Error.noModifyFromOpenToCompleted")):e&&"E6WCommonApps.Error.noModifyMaturityOnProcessControlledObject"===e.message&&(t=_.replace(_.get("E6WCommonApps.Error.noModifyMaturityOnProcessControlledObject"))),t},getDragAndDropFailureMessage:function(e,t){var i=this.getColumnFilterAttrValue(),s=k("emxCollaborativeTasks.Error.FailedToChangeAttribute"),o=this.collection._valueForFiltering;return o=o.displayValue?o.displayValue:o,s=(s=s.replace("%ATTRIBUTE_NAME%",k("emxCollaborativeTasks.Command.View."+i))).replace("%ATTRIBUTE_VALUE%",o),t&&t.response&&400===t.response.statusCode&&t.response.error?s+="<br>"+k(t.response.error):e&&"E6WCommonApps.Error.NoModifyAccess"===e.message?s=_.replace(_.get("E6WCommonApps.Error.NoModifyAccess")):e&&"E6WCommonApps.Error.MandatoryChecklistError"===e.message&&(s=_.replace(_.get("E6WCommonApps.Error.MandatoryChecklistError"))),s=this.getErrorMessageForProcessControlledObject(e)?this.getErrorMessageForProcessControlledObject(e):s},processModelDrop:function(e,t){var i=this,s=this.getElement(".drop-zone-mask");s.addClassName("dropping");var o=this.collection.getSaveAttributes();return setTimeout((function(){s.removeClassName("dropping")}),500),new Promise(((s,a)=>{e.save(o,{patch:!0,ajax:t&&t.ajax,onComplete:function(){h.publishModelEvents(h.STATE_CHANGE_MODEL_EVENT,{data:e.id}),s()},onFailure:function(e,t,s){s&&s.response&&"nothing to save"===s.response.error||a(i.getDragAndDropFailureMessage(t,s))}})}))},_addChildrenToDom:function(e,t,i){for(var s=e||0,o=t?t+e:this._childrenViews.length,a=document.createDocumentFragment(),n=[],l=s;l<o;l++){var r=this._childrenViews[l];r.container.inject(a),n.push(r)}var c,d,h=this,u=function(){var e,t=n.length;e=!1;for(var s=0;s<t;s++){var o=n[s];!o._recycled&&o.model&&o.container&&(o.render(),o.model.completed||(e=!0,E.pushToComplete(o)))}E.toComplete&&E.toComplete.length&&e&&(i?h.complete():h.scheduleComplete())};n.length&&(i?u():setTimeout(u,21),t&&e+t<this._childrenViews.length&&(d=(c=this._childrenViews[e+t].container).parentElement),c&&!c._recycled||(d=(c=this._BottomPlaceholder).parentElement),d.insertBefore(a,c))},scheduleComplete:function(){this.completeTimeout||(this.completeTimeout=setTimeout(this.complete.bind(this),200))},complete:function(){if(this.collection&&E.toComplete){for(var e=[],t=0,i=E.toComplete.length;t<i;t++){var s=E.toComplete[t];!s._recycled&&s.model&&s.container&&e.push(s.model)}this.collection.complete(e,{onlyIfNeeded:!0}),delete E.toComplete}delete this.completeTimeout},_computeCardHeight:function(){var e=this._childrenViews[0];if(e){var t=e.container.getDimensions();t.height>0&&(E._cardHeight=t.outerHeight)}},_adjustBufferHeights:function(){if(this.collection){var e=Math.max(this.collection.length-this._childrenViews.length-this._firstChild,0);if(this._childrenViews[0]){E._cardHeight||this._computeCardHeight(),E._cardHeight||setTimeout(this._adjustBufferHeights.bind(this),0);var t=E._cardHeight||80;this._BottomPlaceholder&&this._BottomPlaceholder.setStyle("height",e*t),this._TopPlaceholder&&this._TopPlaceholder.setStyle("height",this._firstChild*t)}}},render:function(){for(var t=this,i=this._childrenViews.length,s=0;s<i;s++){t._childrenViews[s].container.remove()}t.container.empty(!0),delete this._BottomPlaceholder,delete this._TopPlaceholder,t.container.setHTML(this.template());var o=this.container.getElement(".fonticon-filter");o&&this.setCompletedTaskFilterToolTip(o),this._BottomPlaceholder=this.getElement(".bottom-buffer"),this._TopPlaceholder=this.getElement(".top-buffer");var n=t.getElement(E.CssSelectorMarkingInsertionPoint);n.getParent().setSelectable(!1),this._columnContent=t.getElement(".body"),this._scroller&&this._scroller.destroy();return this._scroller=new a({element:n.parentElement}).inject(this._columnContent),this.getElement(".scroller-content").addEventListener("scroll",(function(i){if(t.container){var s=t.lastScrollEvtTime?t.lastScrollEvtTime:0,o=i.timeStamp-s>1e3,a=t.container.getElement(".scroller-content").scrollTop;if(0===t._scrolling&&(t.scrollTopPos!==a||o)){t.scrollTopPos=a,t.lastScrollEvtTime=i.timeStamp,t._scrolling++;var n=e.clone(i,!1);window.requestAnimationFrame((function(){t._onScroll(n),t._scrolling--}))}}})),this._addChildrenToDom(0,void 0,!0),this._adjustBufferHeights(),this.container.addEvent("dragenter",this.handleDragEnter.bind(this)),this},setCompletedTaskFilterToolTip:function(e){var t=widget.getValue("completedTasksDisplayPref"),i=k("emxCollaborativeTasks.Label.CompletedTaskTopCountFilterToolTip");i=i.replace("%DAY_COUNT%",t),this._taskFilterTooltip=new u({target:e,body:i+"<br><br>"+k("emxCollaborativeTasks.Label.ChangeCompletedTaskFiltering")})},getVisibleModels:function(){var e=[];E._cardHeight||this._computeCardHeight();var t=this._scroller.getInnerElement(),i=t.scrollTop,s=Math.floor(i/E._cardHeight),o=t.getSize().height,a=Math.ceil(o/E._cardHeight);a=Math.min(a,this.collection.length);for(var n=0;n<a;n++)e.push(this.collection.at(n+s));return e},getColumnViewName:function(){var e=this.collection._valueForFiltering;return e.actualValue||e},getColumnFilterAttrValue:function(){var e=this.collection._filterAttr;return e.actualValue||e},canDragOverColumn:function(){var e=!1,t=m.getDragModels(),i=this;return t&&t.some((function(t){return e=i._canDropModel(t)})),e},_canDropModel:function(e){let t=!1;if(e){var i=this.getColumnViewName(),s=this.getColumnFilterAttrValue();t=e.get(s)!==i;var o=e.get("dsxplan:jsType")||e.get("type");t&&e.isRDFTask()?"state"===s?t="Assign"===i||"Active"===i||"Complete"===i:"dueDateCategory"===s&&(t="NO_DATE"!==i):t&&(p.isMilestone(o)||p.isGate(o))&&"state"===s&&(t="Create"===i||"Review"===i||"Complete"===i)}return t},handleDragStart:function(e){var t=e.target,i=r.getViewFromContainer(t);m.setDragView(i),this.container.click()},handleDragEnter:function(){if(!this.canDragOverColumn())return this.container.toggleClassName(C.DROP_CLASS_NAME,!1),!1;this._parentView.clearAllDropZoneMasks(),this.container.getElement(".ui-droppable").toggleClassName(C.DROP_CLASS_NAME,!0)},handleDragOver:function(e){return e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.dataTransfer.dropEffect="copy",!!this.canDragOverColumn(e)&&(this.container.getElement(".ui-droppable").toggleClassName(C.DROP_CLASS_NAME,!0),!1)},handleDragLeave:function(e){e.target.getParent().toggleClassName(C.DROP_CLASS_NAME,!1),this.adjustScrolling(e)},handleDragEnd:function(){const e=this._parentView.confirmDialog;e&&e.elements.container||(m.setDragModels(),m.setDragView(),this._parentView.clearAllDropZoneMasks())},_getEndDateConfirmModalBody:function(t,i){var s=e.createElement("div");return e.createElement("p",{html:_.replace(k("E6WCommonApps.Warning.PastEndDateConfirm"),{ACTUAL_START_DATE:t,FIXED_END_DATE:i})}).inject(s),e.createElement("p",{html:k("E6WCommonApps.Warning.PastEndDateConfirmNote")}).inject(s),s},renderConfirmDialog:function(e,t){var i=this;let a={};a.Ok=new o({label:k("E6WCommonApps.Label.OK"),onClick:function(){i._parentView.confirmDialog.close(),i.confirmDrop()}}),a.Cancel=new o({label:k("E6WCommonApps.Command.Cancel"),onClick:function(){i._parentView.confirmDialog.close(),i.handleDragEnd()}}),this._parentView.confirmDialog=new s({content:this._getEndDateConfirmModalBody(e,t),title:k("E6WCommonApps.Command.EndDateConstraint"),buttons:a,resizableFlag:!1,position:{my:"center",at:"center"},closeButtonFlag:!1,modalFlag:!0})},handleDrop:function(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault();var t,i,s=m.getDragModels(),o=!1;if(this.getColumnViewName()===C.COLUMN_IN_PROGRESS&&s&&!this._parentView._multiSelectMode&&this.canDragOverColumn())for(const e of s)if(e.get(C.USER_DEFINED_END_DATE_ATTR)&&new Date(e.get(C.ENDDATE_ATTR))<new Date){t=p.getIntlDateFormat(e.get(C.STARTDATE_ATTR)).displayValue,i=p.getIntlDateFormat(e.get(C.ENDDATE_ATTR)).displayValue,o=!0;break}return o?(this.renderConfirmDialog(t,i),!1):(this.confirmDrop(),!1)},confirmDrop:function(){var e=m.getDragModels()||[];this._parentView.detailsPanelManager.closeDetailPanelsIfTheyExist();const t=v.getBatchGenerator(),i=[],s=[];e.forEach((e=>e.isRDFTask()?i.push(e):s.push(e))),this.getColumnViewName()===C.COLUMN_IN_PROGRESS&&i.length?v.complete(f,i.map((e=>e.id)),{mask:"dsplan:MVMask.Task.Complex",onComplete:()=>{this._bpmPromises=[];var e={batch:t,onComplete:()=>{this.processDrop([...i,...s],t)}};l.startProcessForMassEdit(i,this._bpmPromises,e)}}):this.processDrop(e,t)},processDrop:function(e,t){var i=this;this._dropPromises=[],e.forEach((e=>{i._canDropModel(e)&&this._dropPromises.push(i.processModelDrop(e,e.isRDFTask()?t:void 0))})),t.sendBatch(),Promise.allSettled(this._dropPromises).then((e=>{if(!this._dropPromises.length)return;this._dropPromises=[];const t=new Set(e.filter((e=>"rejected"===e.status)).map((e=>e.reason)));t.size?t.forEach((e=>p.displayError(e,{noEscape:!0}))):this.displayDragAndDropSuccessMessage()})),m.setDragModels(),m.setDragView(),this._parentView.clearAllDropZoneMasks()},adjustScrolling:function(e){var t,i;if(!this._parentView.autoScrolling)try{t=m.getDragView().container.offsetWidth,i=e.clientX;var s=this._parentView.container.offsetWidth,o=this._parentView.container.getOffsets().x;i+t-o>s+t/3?this._parentView.scrollRight():i-o<=t/3&&this._parentView.scrollLeft()}catch(e){}},getParentView:function(){return this._parentView},getSuperModal:function(){return this.getParentView().getSuperModal()}});return E.nbCardsBuffer=20,E.nbCardsTopBuffer=5,E.CssSelectorMarkingInsertionPoint=".top-buffer",E.CssSelectorMarkingBottomInsertionPoint=".bottom-buffer",E.TitleObjectCountId=".object-count",E.TitleObjectCountString="(%COUNT%)",E.pushToComplete=function(){E.toComplete||(E.toComplete=[]),E.toComplete.push.apply(E.toComplete,arguments)},E})),define("DS/CollaborativeTasks/Views/DetailsPanelManager",["UWA/Core","UWA/Class","UWA/Class/Events","UWA/Class/Listener","DS/E6WCommonUI/UIHelper","DS/E6WCommonUI/Models/BulkModel","DS/CollaborativeTasks/Views/DetailsPanel","DS/CollaborativeTasks/MultiEdit/MultiDetailsPanel","DS/CollaborativeTasks/Views/ExternalDetailsPanel","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],(function(e,t,i,s,o,a,n,l,r,c){"use strict";var d=function(e){return c.get(e)},h=t.extend(i,s,{init:function(e){this._parentView=e.parentView,delete e.parentView,this._postResetAction=e.postResetAction,delete e.postResetAction,this.panelsList=[],this._detailPanel=this.createPanel(n,e),this._externalPanel=this.createPanel(r,e),this._multiDetailPanel=this.createPanel(l,e),this._activePanel=null,this.currentModel=null,this._parent.apply(this,arguments)},createPanel:function(e,t){let i=new e(t);return this.listenTo(i,{onCloseIfOpen:t.onCloseDetail,onClose:function(){this._activePanel=null,this.currentModel=null,this.dispatchEvent("collapseRightContent")},onOpen:function(){this._activePanel=i,this.dispatchEvent("expandRightContent",arguments)}}),this._parentView.addChildView(i),this.panelsList.push(i),i},getPanels:function(){return this.panelsList},getDetailsPanel:function(){return this._detailPanel},getExternalDetailsPanel:function(){return this._externalPanel},getMultiDetailsPanel:function(){return this._multiDetailPanel},injectDetailsPanel:function(e,t,i){i?this._externalPanel.inject(e):t?this._multiDetailPanel.inject(e):this._detailPanel.inject(e)},multiDetailsPanelIsOpen:function(){return this.getMultiDetailsPanel().isOpen()},getActivePanel:function(){return this._activePanel},closeDetailPanelsIfTheyExist:function(){this._parentView&&(this._detailPanel&&this._detailPanel.container&&this._detailPanel.close(),this._externalPanel&&this._externalPanel.container&&this._externalPanel.close(),this._multiDetailPanel&&this._multiDetailPanel.container&&this._multiDetailPanel.close())},areModelsOfSameType:function(t){let i,s;for(let o=0;o<t.length;o++){let a=t[o].get("type")?t[o].get("type"):t[o].get("dsxplan:jsType"),n=!!e.is(t[o].isProjectTask,"function")&&t[o].isProjectTask();if(i){if(i!==a)return!1}else i=a;if(0===o)s=n;else if(s!==n)return!1}return!0},isMultiSelectionValid:function(e){let t=this._parentView._selectedModels.concat([]);return e&&t.push(e),o.showMultiEditWarning(t)?(this.closeDetailPanelsIfTheyExist&&this.closeDetailPanelsIfTheyExist(),!1):this.areModelsOfSameType(t)?"function"==typeof t[0].isRouteTask&&t[0].isRouteTask()?(o.displayWarning(d("E6WCommonUI.Label.RouteTaskMultiselectNotSupported")),!1):"function"!=typeof t[0].isIteropTask||!t[0].isIteropTask()||(o.displayWarning(d("E6WCommonUI.Label.IteropTaskMultiselectNotSupported")),!1):(o.displayWarning(d("E6WCommonUI.Label.ChooseSameTypeObjects")),this.closeDetailPanelsIfTheyExist(),!1)},openDetailsPanel:function(e,t){let i=this._activePanel,s=this._parentView._selectedChildView&&this._parentView._selectedChildView.container?this._parentView._selectedChildView.container.clientWidth:this._parentView.container.clientWidth;var c=o.isWidgetNarrow()?s:n.DETAILSPANEL_MAX_WIDTH;let d;this._parentView._cancelManagementViewPropertyPanelChanges&&this._parentView._cancelManagementViewPropertyPanelChanges({onCancel:Function.prototype});let h=this._parentView._selectedModels,u=this._parentView._selectedView;if(h&&h.length>1){if(!this.isMultiSelectionValid(t))return;this._detailPanel.close(),this._multiDetailPanel.close(),this._externalPanel.close(),d=new a(h);const i=h[0];if("function"==typeof i.isProjectTask&&i.isProjectTask()){const t=this._externalPanel,i=r;t.open(c),t.resetModel(d,{force:!0,selectedTab:this._detailPanel._selectedTab}),this._postResetAction(i,t,e),this._activePanel=t}else{const t=this._multiDetailPanel,i=l;t.open(c),t.resetModel(d,{force:!0}),this._postResetAction(i,t,e),this._activePanel=t}}else if(h.length||u){let t,s;d=u?u.model:h[0],this._multiDetailPanel===this._activePanel&&this._multiDetailPanel.close(),d=u&&u.model?u.model:h[0],d&&d.hasExternalPanel&&d.hasExternalPanel()?(t=this._externalPanel,s=r):(t=this._detailPanel,s=n),i!==t&&(i&&i.close(),t.open(c)),this.currentModel!==d&&t.resetModel(d,{force:!0,selectedTab:this._detailPanel._selectedTab}),this._postResetAction(s,t,e)}this.currentModel=d}});return h})),define("DS/CollaborativeTasks/TaskGrid/TasksTableView",["UWA/Core","UWA/Class","UWA/Class/Events","UWA/Class/Listener","UWA/Class/Promise","DS/DataGridView/DataGridView","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/E6WCommonUI/UIHelper","DS/E6WCommonApps/TreeDocument/TreeNodeUtil","DS/E6WCommonApps/CustomAttributeMixin","DS/CollaborativeTasks/Views/TaskMenuMixin","DS/E6WCommonApps/DeleteUtil","DS/E6WCommonApps/TaskUtils","DS/E6WCommonApps/XTaskScope","DS/E6WCommonApps/Collections/FTSTaskPseudoCollection","DS/E6WCommonApps/SmartSchedulerUtils","DS/RDFFoundation/RDFUtils","DS/CollaborativeTasks/TaskGrid/TasksTableConfig","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/RDFFoundation/Collections/CollectionTaggerHelper"],(function(e,t,i,s,o,a,n,l,r,c,d,h,u,p,m,g,C,T,f,v,S,D){"use strict";var b=f.columns,_={},k={};const w={};var E,A=function(e){return v.get(e)},y=t.extend({});y.implement(h),y.implement(i);var M=a.extend({_uwaClassName:"TasksTableView",tagName:"span",createTreeDocument:function(){var e=new n;return k={},e},getSelectedColumnInfo:function(){var e,t=this.layout._getDataFromPreferences("columnsSortModel");return t&&this.columns.forEach((i=>{i.dataIndex===t.dataIndex&&(e=i)})),e||this.columns[0]},addNodeToMap:function(e,t){k[e]=t,t.rdfModel&&(t.rdfModel.get("dsxplan:customExtensionName")||t.rdfModel.get("dsbase:extension"))&&this._addToQueue(e)},updateNodeAttr:function(e,t,i){k[e].setAttribute(t,i)},getTreeNodeModels:function(e){var t=e.rdfTasksCollection;if((E=this.createTreeDocument()).prepareUpdate(),p.useFTS())this.showSubProjectTasks();else{var i=[];this.nonRdfCollections.forEach((e=>i=i.concat(e.toArray()))),t&&(i=i.concat(t.toArray())),i.forEach((e=>{E.addChild(e.getTreeNodeModel()),this.addNodeToMap(e.id,e.getTreeNodeModel())}))}return E.expandAll(),E.pushUpdate(),E},callRegisterReusableCellContent:function(t){t.forEach((t=>{this.registerReusableCellContent({id:t.id,buildContent:t.buildContent||function(){return e.createElement("div",{class:t.className})},getTweakerPadding:function(){return f.lengthOfEachCharacter}})}))},setupResuableComponents:function(){this.callRegisterReusableCellContent([{id:f.reusableComponentIDs.attachment_or_deliverable,className:"fonticon fonticon-attach"},{id:f.reusableComponentIDs.context,className:"grid-object grid-context"},{id:f.reusableComponentIDs.project,className:"grid-object grid-project"},{id:f.reusableComponentIDs.assignee,className:"grid-object grid-member"},{id:f.reusableComponentIDs.owner,className:"grid-object grid-member"},{id:f.reusableComponentIDs.description,className:"grid-description-view"}])},_manageCellSelection:function(e,t,i){this._parent(e,t,i),this.openPropertyPanel(e),"DSpointerhit"!==e.type||this.isTouchDevice()||this.selectCell(this.getActiveCellID())},openOrResetPropertyPanelFromGrid:function(){this.updateSelectedModels(),this.parentTaskView.detailsPanelManager.openDetailsPanel(1)},isTouchDevice:function(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0},setActiveTreeNodeModel:function(e){var t=e?e.nodeModel:this._activeCellStableID.nodeModel;if(t){var i=t.getAttributeValue("correspondingModel");i&&this.tasksCollection&&this.parentTaskView&&this.parentTaskView.handleTagCollect&&this.parentTaskView.handleTagCollect({model:i})}},selectCell:function(e,t,i,s){this._parent(e,t,i,s),this.setActiveTreeNodeModel()},unselectAll:function(){this._parent(),this.tasksCollection&&this.parentTaskView&&this.parentTaskView.handleTagCollect&&this.parentTaskView.handleTagCollect()},openPropertyPanelForNewNode:function(e){var t=this.parentTaskView.detailsPanelManager,i=e&&"function"==typeof e.hasExternalPanel&&e.hasExternalPanel()?t.getExternalDetailsPanel():t.getDetailsPanel();i.open(),i.resetModel(e)},openPropertyPanel:function(e){if(this.isTouchDevice()){if(1===e.detail)if(this.parentTaskView.detailsPanelManager.getActivePanel()&&this.parentTaskView.detailsPanelManager.getActivePanel().isOpen())this.openOrResetPropertyPanelFromGrid();else{if(!this.clickOneDone&&!this.srcElement)return this.clickOneDone=!0,void(this.srcElement=e.srcElement);this.clickOneDone&&(this.srcElement===e.srcElement&&this.openOrResetPropertyPanelFromGrid(),delete this.clickOneDone,delete this.srcElement)}}else(1===e.detail&&this.parentTaskView.detailsPanelManager.getActivePanel()||2===e.detail)&&this.openOrResetPropertyPanelFromGrid()},addNewNode:function(e,t){!e.id||k[e.id]||e.isBlank||(E.addChild(e.getTreeNodeModel()),this.addNodeToMap(e.id,e.getTreeNodeModel()),t&&this.subProjectTasks.push(e))},removeNode:function(e){k[e.id]&&(E.removeRoot(k[e.id]),delete k[e.id],delete _[e.id])},handleTaskAddition:function(e,t){e.id&&k[e.id]?this.showNode(e):e.id?this.addNewNode(e,t):this.listenToOnce(e,"onChange:"+e.idAttribute,(function(){this.addNewNode(e,t)}))},addListenersToCollection:function(e){this.listenTo(e,"onAdd",(function(e){this.handleTaskAddition(e)})),this.listenTo(e,"onReset",(function(e,t){this.onTaskCollectionsReset(e,t)})),this.listenTo(e,"onChange:search",(function(){this.filterVisibleNodes()})),this.listenTo(e,S.ON_FETCH_COUNT_CHANGED,this.updateLoadingMessage)},addCollectionListeners:function(e){this.nonRdfCollections.forEach((e=>this.addListenersToCollection(e))),e.rdfTasksCollection&&this.addListenersToCollection(e.rdfTasksCollection)},hideNode:function(e){var t=k[e.id];t&&t.hide(),delete _[e.id]},showNode:function(e,t){k[e.id]?k[e.id].show():this.addNewNode(e,t)},addNodesInBulk:function(t,i){E.prepareUpdate(),t.forEach((e=>this.showNode(e,i))),e.Utils.Client.Engine.firefox?setTimeout((function(){E.pushUpdate()}),0):E.pushUpdate()},removeNodesInBulk:function(e){E.prepareUpdate(),e.forEach((e=>this.hideNode(e))),E.pushUpdate()},onTaskCollectionsReset:function(t,i){var s=[],o=e.is(i.previousModels,"array")?i.previousModels.slice():[];o.length>0?t.forEach((function(e){var t=o.indexOf(e);-1===t?s.push(e):o.splice(t,1)})):s=t.toArray(),this.removeNodesInBulk(o),this.addNodesInBulk(s)},customizeScroller:function(){var e=this;this._getScroller().onScrollEnd((function(){this.getPosition().y!==this._lastScrollPosition.y&&e.invokeLazyLoading()}))},invokeLazyLoading:function(){var e=this.getModelsAndIDsToFetch();e&&(this.rdfTasksCollection&&this.rdfTasksCollection.complete(e.rdfModelIDsToBeFetched,{onlyIfNeeded:!0}),this.tasksCollection.complete(e.nonRDFModelsToBeFetched,{onlyIfNeeded:!0}))},getModelsAndIDsToFetch:function(){let e,t=[],i=[],s=this.layout.collectionView._rowModel;if(s){let a=this.layout.getMinMaxVisibleRowIDs();if(a.minRowID<=0&&a.maxRowID<=0)return void this.onPostUpdateViewOnce(this.invokeLazyLoading);for(let n=a.minRowID;n<=a.maxRowID;n++){e=s.getVisibleNodeModel(n).getAttributeValue("correspondingModel");var o=e.id;_[o]||(_[o]=!0,e.isRDFTask()?t.push(o):i.push(e))}}return{rdfModelIDsToBeFetched:t,nonRDFModelsToBeFetched:i}},_sortAfterFetching:function(e,t){const i=this.parentTaskView._columnViews.map((e=>e.collection)).find((e=>e.completing));if(this.tasksCollection.fetching)this.listenToOnce(this.tasksCollection,"onSync",(()=>{this._sortAfterFetching(e,t)}));else if(i)this.listenToOnce(i,"onComplete",(()=>{this.sortTimeout&&clearTimeout(this.sortTimeout),this.sortTimeout=setTimeout((()=>{this._sortAfterFetching(e,t)}),0)}));else if(this.rdfTasksCollection&&this.rdfTasksCollection.fetching){const i=()=>{this.stopListening(this.rdfTasksCollection,"onSync"),this.stopListening(this.rdfTasksCollection,"onComplete"),this._sortAfterFetching(e,t)};this.listenToOnce(this.rdfTasksCollection,"onSync",i),this.listenToOnce(this.rdfTasksCollection,"onComplete",i)}else setTimeout((()=>{this._rowModel._applySortModel(e,t)}),0)},customizeSortingForColumns:function(e){var t=this.tasksCollection,i=this.rdfTasksCollection,s=this;this._rowModel._applySortModel=function(a,n){var l=this,r=arguments;if(t.fetching||i&&i.fetching)return void s._sortAfterFetching(a,n);if(!(a&&a.length||n&&n.length))return;const d=(n&&n.length?n[0]:a[0]).dataIndex;var h=Object.keys(c.ER_TO_TREE_NODE).filter((e=>c.ER_TO_TREE_NODE[e]===d)).join(",");if(s._promises=[],i){var u=i.map((e=>e.id));u.length&&s._promises.push(new o((function(e){i.complete(u,{mask:c.getMasksForFetchingRDFTaskDetails(d),onlyIfNeeded:!0,onComplete:function(){e()}})})))}!w[h]&&h&&t.length>0&&s._promises.push(new o((function(e){t.addEventOnce("onComplete",(()=>{w[h]=!0,e()})),t.complete(t.toArray()),t.completing||e()}))),o.allSettled(s._promises).then((function(){e.apply(l,r),s.invokeLazyLoading()}))}},updateLoadingMessage:function(){let e=this.elements&&this.elements.container;if(e){e=e.getParent&&e.getParent();const t=this.rdfTasksCollection&&this.rdfTasksCollection.fetching&&!this.rdfTasksCollection.completing;this.nonRdfCollections.find((e=>e.fetching))||this._ftsCollection&&this._ftsCollection.fetching||t?r.showLoadingMessage(e):r.hideLoadingMessage(e)}},getTaskMenu:function(e){const t=new y;var i=this;t.getParentView=function(){return i.parentTaskView};var s=e.isComplete()?[{actualValue:S.ACTIVE,displayValue:A("E6WCommonApps.Label.InWork")}]:[{actualValue:S.COMPLETE,displayValue:A("E6WCommonApps.Label.Completed")}];return t.options={stateValues:s},t.model=e,t},onEditOnGridView:function(){this.openOrResetPropertyPanelFromGrid()},updateSelectedModels:function(){var e=this.treeDocument.getSelectedNodes();this.parentTaskView._selectedModels.length=0,e.forEach((e=>{this.parentTaskView._selectedModels.push(e.rdfModel||e.getAttributeValue("correspondingModel"))}))},getContextualMenu:function(e,t){var i=[];if(e.cellInfos&&e.cellInfos.rowID>-1){var s=e.cellInfos.nodeModel.getAttributeValue("correspondingModel");s.hasFetchedAccessData()||s.fetchAccess(),this.updateSelectedModels();var o=this.getTaskMenu(s);this.listenTo(o,"onTaskCardClickedForTableView",(function(){s.dispatchEvent("onEditOnGridView")})),this.listenTo(s,"onEditOnGridView",this.onEditOnGridView),o.createMenuButtons().dropdown.items.forEach((e=>{var t=e.disabled?"disabled":"",s="PushItem";"divider"===e.className?s="SeparatorItem":"header"===e.className&&(s="TitleItem"),i.push({type:s,title:e.text,icon:e.fonticon,state:t,action:{callback:e.func||e.handler||function(){}}})}))}else i=e.collectionView.buildDefaultContextualMenu(e,t);return i},updateTreeDocumentWithNewModels:function(e){this.resetTreeDocumentAndMap(),e.forEach((e=>{this.handleTaskAddition(e)}))},filterVisibleNodes:function(){this.tasksCollection.getSearch()||this.rdfTasksCollection&&this.rdfTasksCollection.getSearch()?(E._trueRoot.hideChildNodes(),this.parentTaskView&&this.parentTaskView._columnViews.forEach((e=>{e.collection&&e.collection._subCollections&&e.collection._subCollections.forEach((e=>{e._models.forEach((e=>{k[e.id]&&k[e.id].isHidden()&&k[e.id].show()}))}))}))):this.onLevelChanged()},onLevelChanged:function(){p.useFTS()?this.showSubProjectTasks():this.hideSubProjectTasks()},updateRDFCollection:function(e){this.stopListening(this.rdfTasksCollection),this.rdfTasksCollection=e,this.updateTreeDocumentWithNewModels(e),this.addListenersToCollection(this.rdfTasksCollection)},resetTreeDocumentAndMap:function(){this.treeDocument&&this.treeDocument.empty(),k={}},addListenersToColCollectionsForAdd:function(){var e=this;this.parentTaskView._columnViews.forEach((t=>{e.parentTaskView.listenTo(t.collection,"onAdd",(function(t){e._ftsCollection.add(t)}))}))},_onCompleteSubProjectTasksFetch:function(){this.addListenersToColCollectionsForAdd(),this.addListenersToCollection(this._ftsCollection),this.addNodesInBulk(this._ftsCollection._models,!0),this.reapplySortModel(),this.invokeLazyLoading()},showSubProjectTasks:function(){var t=this;this.subProjectTasks=[],this.resetTreeDocumentAndMap(),this._ftsCollection.reset(),this._ftsCollection.fetch(e.merge(t.parentTaskView.getFTSOptions(),{limit:1e5,onComplete:t._onCompleteSubProjectTasksFetch.bind(t)}))},showFirstLevelTasks:function(){this.rdfTasksCollection&&this.addNodesInBulk(this.rdfTasksCollection.toArray())},hideSubProjectTasks:function(){this.removeNodesInBulk(this.subProjectTasks),this.subProjectTasks=[],this.showFirstLevelTasks()},init:function(e){this.nonRdfCollections=[],this.tasksCollection=e.tasksCollection,this.tasksCollection&&this.nonRdfCollections.push(this.tasksCollection),this.rdfTasksCollection=e.rdfTasksCollection,e.iteropTasksCollection&&this.nonRdfCollections.push(e.iteropTasksCollection),e.srcCollection&&this.nonRdfCollections.push(e.srcCollection),this.parentTaskView=e.parentTaskView,this.subProjectTasks=[],this.rdfTasksCollection&&(this._ftsCollection=new g(void 0,{view:S.TASK_TABLE,parentModel:this.rdfTasksCollection.parentModel}),this.listenTo(this._ftsCollection,S.ON_FETCH_COUNT_CHANGED,this.updateLoadingMessage)),E=this.getTreeNodeModels(e),window.widget&&window.widget.data["wux-collectionView-dataGridView"]&&window.widget.hasPreference&&!window.widget.hasPreference("wux-collectionView-dataGridView")&&window.widget.addPreference({name:"wux-collectionView-dataGridView",type:"hidden"}),this._parent({identifier:"TasksTableView",treeDocument:E,useWidgetPreferencesFlag:!0,columns:[...b],rowSelection:"multiple",cellSelection:"none",showSelectionCheckBoxesFlag:!0,onContextualEvent:this.getContextualMenu,rowGroupingEnabledFlag:!1,cellActivationFeedback:"row",layoutOptions:{layoutDensity:"comfortable"}});var t=this;E.getModelEvents().subscribe({event:"select"},(function(e){t.setActiveTreeNodeModel(e.data),t.parentTaskView.detailsPanelManager.getActivePanel()&&t.parentTaskView._selectedModels.length<=20&&t.openOrResetPropertyPanelFromGrid()})),E.getModelEvents().subscribe({event:"unselect"},(function(){t.parentTaskView.detailsPanelManager.getActivePanel()&&t.openOrResetPropertyPanelFromGrid()})),this.setupResuableComponents(),this.addCollectionListeners(e),this.customizeScroller(),this.customizeSortingForColumns(this._rowModel._applySortModel),this.filterVisibleNodes(),this.onPostUpdateViewOnce(this.updateLoadingMessage)}});return M.implement(s),M.implement(i),M.implement(d),M}));var groupViewerModuleName="DS/i3DXRDFGroupViewer/js/GroupViewer";define("DS/CollaborativeTasks/Views/CollaborativeTasksView",["UWA/Core","UWA/Event","UWA/Controls/Drag","DS/UIKIT/Input/Button","DS/Controls/Toggle","DS/UIKIT/SuperModal","DS/UIKIT/DropdownMenu","DS/UIKIT/Tooltip","DS/WAFData/WAFData","DS/Handlebars/Handlebars4","DS/ENOjquery/ENOjquery","DS/Foundation/WidgetUwaUtils","DS/Foundation/WidgetAPIs","DS/E6WCommonUI/Views/FoundationBaseView","DS/E6WCommonUI/Views/DetailsDisplayView","DS/Foundation2/FoundationV2Data","DS/DocumentManagement/DocumentManagement","DS/CollaborativeTasks/Collections/MergingSplitCollection","DS/E6WCommonUI/Views/E6WHandlebarsHelpers","DS/E6WCommonUI/UIHelper","DS/E6WCommonUI/TagUtils","DS/E6WCommonUI/ToolbarUtil","DS/Foundation2/TaggerAggregator","DS/CollaborativeTasks/Views/ColumnView","DS/CollaborativeTasks/Views/CardView","DS/CollaborativeTasks/Views/DetailsPanel","DS/CollaborativeTasks/Views/CollaborativeTasksUtils","DS/RDFFoundation/RDFUtils","DS/E6WCommonApps/Models/RDFTaskModel","DS/E6WCommonApps/Models/MultiSelectToolbarMixin","DS/E6WCommonApps/XTaskScope","DS/E6WCommonApps/Views/CreateDialogTabMixin","DS/XTaskApp/Models/ScopeModelContainer","DS/RDFFoundation/SecurityContextUtils","DS/RDFFoundation/FederatedSearchUtil","DS/RDFFoundation/Collections/CollectionTaggerHelper","DS/CollaborativeTasks/TaskGrid/TasksTableView","DS/CollabComponents/CreateTask","DS/CollaborativeTasks/MultiEdit/MultiDetailsPanel","DS/CollaborativeTasks/Views/ExternalDetailsPanel","DS/E6WCommonUI/PlatformManager","DS/E6WCommonUI/FeatureFlagUtils","DS/PlatformAPI/PlatformAPI","DS/ENXESignature/Views/Dialogs/ESignatureAuthDialog","DS/E6WCommonApps/LiveUpdateUtils","DS/E6WCommonApps/TaggerChipColorMixin","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/E6WCommonApps/ScheduleConstants","DS/E6WCommonApps/MultiEdit/MultiEditMenuUtil","DS/E6WCommonApps/DisplayPreferencesUtil","DS/CollaborativeTasks/Views/DetailsPanelManager","DS/CollaborativeTasks/Views/TasksViewSelectionMixin",groupViewerModuleName,"i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS","i18n!DS/E6WCommonApps/assets/nls/E6WCommonAppsNLS","text!DS/CollaborativeTasks/assets/templates/main.html.handlebars","text!DS/E6WCommonApps/assets/templates/customAttributes.html.handlebars","css!DS/CollaborativeTasks/CollaborativeTasks"],(function(e,t,i,s,o,a,n,l,r,c,d,h,u,p,m,g,C,T,f,v,S,D,b,_,k,w,E,A,y,M,I,V,F,P,R,N,L,x,O,U,W,j,B,H,G,z,K,Y,q,X,$,J,Q,Z,ee,te){"use strict";v.fixDisplayMessageMethod(),A.typeDictionary.typeMap=A.typeDictionary.typeMap||{},e.merge(A.typeDictionary,A.typeDictionary,{mapping:[{key:"dsplan:Task",type:y}],typeMap:{"dsplan:Task":y}});var ie=K.DUE_DATE_CATEGORY,se=function(e){var t=g.getWidgetConstant.apply(this,arguments);return t===e&&(t=Z.get(e)),t===e&&(t=ee.get(e)),t},oe=0,ae=c.compile(te),ne=I.FILTER_ALL,le=I.FILTER_OWNED,re=I.FILTER_ASSIGNED,ce=I.FILTER_CANDIDATE_ASSIGNEE,de="cards-small",he="cards-large",ue="task-table",pe="selectedTaskView",me="wux-ui-state-prehighlighted",ge=".wux-controls-responsivetileview-checkbox",Ce={kanban:"kanban-view",table:ue,tile:de,largeTile:he,taskTable:ue,smallCards:de,largeCards:he};var Te=p.extend({_uwaClassName:"CollaborativeTasksView",_minColWidth:256,_maxColWidth:800,_durationOfDetailClosure:300,initiateRouteChangeAssignee:null,className:"collaborative-tasks",name:"CollaborativeTasks.CollaborativeTasksView",scopeName:"",ColumnView:_,domEvents:{"click button.scroll-right":"scrollRight","click button.scroll-left":"scrollLeft","click #createTaskIcon":"fireOnClickCreateTask"},init:function(t){const i=e.clone(t||{},!1);this._rdfCollection=i.rdfCollection,this.iteropTasksCollection=t&&t.iteropCollection,this._srcCollection=i.srcCollection,I.setCollection(this._rdfCollection),this._fetchCount=i.fetchCount||0,Object.defineProperty(this,"_detailPanel",{get:function(){return this.detailsPanelManager&&this.detailsPanelManager.getDetailsPanel()}}),Object.defineProperty(this,"_multiDetailPanel",{get:function(){return this.detailsPanelManager&&this.detailsPanelManager.getMultiDetailsPanel()}}),this._parent.apply(this,arguments)},disableCreateTaskIcon:function(){var e=this.getElement("#createTaskIcon");!e&&this._toolbarElement&&(e=this._toolbarElement.getElement("#createTaskIcon")),e&&e.addClassName("disabled")},enableCreateTaskIcon:function(){var e=this.getElement("#createTaskIcon");!e&&this._toolbarElement&&(e=this._toolbarElement.getElement("#createTaskIcon")),e&&e.removeClassName("disabled")},id:function(){var e="no id found";return this.collection&&this.collection.extid?e=this.collection.extid:this.options&&this.options.rdfCollection&&this.options.rdfCollection.extid&&(e=this.options.rdfCollection.extid),e},destroy:function(){this.cancelTaskIdSelectionInSidePanel(),this._fetchNewTagsTimeout&&clearTimeout(this._fetchNewTagsTimeout),this._fetchNewTagsTimeout=void 0,this.scopeIdView&&this.scopeIdView.destroy(),delete this.scopeIdView,this._parent(),this.$dsTaskManagement=null,delete this._columnStyle,delete this._columnsCarrier,this._taskTools&&this._taskTools.destroy(),delete this._taskTools,this._tasksFilterMenuButton&&this._tasksFilterMenuButton.destroy(),delete this._tasksFilterMenuButton,this._smallLargeCardTooltip&&this._smallLargeCardTooltip.destroy(),delete this._smallLargeCardTooltip,this._tasksFilterDropDownMenu&&this._tasksFilterDropDownMenu.destroy(),delete this._tasksFilterDropDownMenu,this._createTaskTooltip&&this._createTaskTooltip.destroy(),delete this._createTaskTooltip,this.displayMenu&&this.displayMenu.destroy(),delete this.displayMenu,this._displayMenuTooltip&&this._displayMenuTooltip.destroy(),delete this._displayMenuTooltip,this._displayMenuButton&&this._displayMenuButton.destroy(),delete this._displayMenuButton,this._cardViewMenuButton&&this._cardViewMenuButton.destroy(),delete this._cardViewMenuButton,this._viewByTooltip&&this._viewByTooltip.destroy(),delete this._viewByTooltip,delete this._displayOptionsDropdown,delete this._scopeIdContainer,this.scopeIdView&&(this.stopListening(this.scopeIdView),this.scopeIdView.destroy(),delete this.scopeIdView),delete this._scopeListenedTo,this.modal&&this.modal.destroy(),delete this.modal,this._createTask&&this._createTask.destroy(),delete this._createTask,this.scopeIdView&&this.scopeIdView.destroy(),delete this.scopeIdView,this.tasksTableView&&this.tasksTableView.destroy(),this.tasksTableView=void 0},cleanUpChildren:function(){var e=this;e._circleContainer&&e._circleContainer.empty(!0),e._parent(),this.detailsPanelManager&&this.detailsPanelManager.stopListening(),this._columnViews=[]},selectById:function(e){var t=this,i=this.getColumnAndCardIdxFromId(e),s=i[0],o=i[1];if(s&&-1!==o){_._cardHeight||s._computeCardHeight();var a=_._cardHeight*o;s._scroller.scrollTo(0,a),setTimeout(function(){var o;s&&s._childrenViews||(i=this.getColumnAndCardIdxFromId(e),s=i[0]);for(var a=0;a<s._childrenViews.length;a++){var n=s._childrenViews[a];if(n.model.id===e){o=n;break}}o&&(t.singleSelectCardFull(o),t._detailPanel.selectTab(widget.getValue("propertyPanelTab"))),widget.deleteValue("propertyPanelTab")}.bind(this),0)}},cancelTaskIdSelectionInSidePanel:function(){this.pendingTaskToSelectId=void 0,this._requestAnimationFrameToken&&(cancelAnimationFrame(this._requestAnimationFrameToken),this._requestAnimationFrameToken=0),this.pendingTaskSelectionColumnChangeListener&&(this.removeEvent("afterColChanged",this.pendingTaskSelectionColumnChangeListener),this.pendingTaskSelectionColumnChangeListener=void 0),this.pendingTaskSelectionLoadingMessageListener&&(this.removeEvent("onHideLoadingMessage",this.pendingTaskSelectionLoadingMessageListener),this.pendingTaskSelectionLoadingMessageListener=void 0),this.pendingTaskSelectionWidgetResizeListener&&(widget.removeEvent("onResize",this.pendingTaskSelectionWidgetResizeListener),this.pendingTaskSelectionWidgetResizeListener=void 0)},selectTaskById:function(e){if(this.cancelTaskIdSelectionInSidePanel(),!e)return;if(this.pendingTaskSelectionId=e,!widget.body.offsetHeight||!widget.body.offsetWidth)return this.pendingTaskSelectionWidgetResizeListener=()=>{widget.body.offsetHeight&&widget.body.offsetWidth&&(widget.removeEvent("onResize",this.pendingTaskSelectionWidgetResizeListener),this.pendingTaskSelectionWidgetResizeListener=void 0,this.selectTaskById(this.pendingTaskSelectionId))},void widget.addEvent("onResize",this.pendingTaskSelectionWidgetResizeListener);if(widget.getValue(pe)===D.TABLE||"taskTable"===widget.getValue(pe)){const t=this.tasksTableView.treeDocument.getRoots().find((t=>t.getAttributeValue("correspondingModel").id===e));return void(t?(this.tasksTableView.selectNodeModel(t),this.tasksTableView&&this.tasksTableView.openPropertyPanelForNewNode(t.getAttributeValue("correspondingModel")),this.tasksTableView.ensureNodeModelVisible(t)):this.isLoadingMessageShown()&&(this.pendingTaskSelectionLoadingMessageListener=()=>{this.selectTaskById(this.pendingTaskSelectionId)},this.addEventOnce("onHideLoadingMessage",this.pendingTaskSelectionLoadingMessageListener)))}let t=this.getColumnAndCardIdxFromId(e),i=t[0],s=t[1];if(!i||-1===s)return void(this.isLoadingMessageShown()?(this.pendingTaskSelectionLoadingMessageListener=()=>{this.selectTaskById(this.pendingTaskSelectionId)},this.addEventOnce("onHideLoadingMessage",this.pendingTaskSelectionLoadingMessageListener)):(this.pendingTaskSelectionColumnChangeListener=()=>{this.selectTaskById(this.pendingTaskSelectionId),this.pendingTaskSelectionId=void 0},this.addEventOnce("afterColChanged",this.pendingTaskSelectionColumnChangeListener)));_._cardHeight||i._computeCardHeight();let o=_._cardHeight*s;i._scroller.elements.content.scrollTo({left:0,top:o,behavior:"instant"});let a=s=>{let o;if(!i?._childrenViews?.length)return t=this.getColumnAndCardIdxFromId(e),i=t?.length?t[0]:null,void(this._requestAnimationFrameToken=requestAnimationFrame(a));if(i){for(let t=0;i._childrenViews&&t<i._childrenViews.length;t++){let s=i._childrenViews[t];if(s.model.id===e){o=s;break}}if(!o)return void(this._requestAnimationFrameToken=requestAnimationFrame(a));let t=this._childrenViews.findIndex((e=>e===i));t>=0&&this.setLeftColumnIndex(t),this.singleSelectCardFull(o),this._detailPanel.selectTab(widget.getValue("propertyPanelTab")),widget.deleteValue("propertyPanelTab")}};this._requestAnimationFrameToken=requestAnimationFrame(a)},getColumnAndCardIdxFromId:function(e){for(var t,i=-1,s=this._childrenViews.length,o=0;o<s;o++){var a=(t=this._childrenViews[o]).collection;if(a){var n=a.get(e);if(n){i=a.indexOf(n);break}}}return[t,i]},onTaskCardClicked:function(e,t){this.cancelTaskIdSelectionInSidePanel(),this._multiSelectMode||(!this._selectedView||t!==this._selectedView&&t.model!==this._selectedView.model?this._selectedView&&t!==this._selectedView?(this.singleSelectCardFull(t),t.model.markDeliverablesOn3DNavigate(),v.trackPageEvent({eventCategory:"taskMenu",eventAction:"edit",eventLabel:"iCardViewModel",eventValue:t.model})):(this.singleSelectCardActual(t),t.model.markDeliverablesOn3DNavigate(),v.trackPageEvent({eventCategory:"taskMenu",eventAction:"edit",eventLabel:"iCardViewModel",eventValue:t.model})):this.singleUnselectCardFull(t))},onTaskCardEdit:function(e,t){this._multiSelectMode?this._selectedModels.includes(t.model)?this.openCloseMultiSelectDetailsPanel():this.multiSelectCardFull([t],!0):this.onTaskCardClicked(e,t)},onTaskCardContextMenu:function(e,t){this._multiSelectMode&&this._selectedModels.length>1?this._selectedModels.includes(e.model)?(e.model.dispatchEvent("selectionChanged",{shouldShow:!0}),t()):this.cancelDetailsPanelAndUnselectAllBeforeAction(t):(this._multiSelectMode&&1===this._selectedModels.length&&e.model.dispatchEvent("selectionChanged",{shouldShow:!0}),t())},onMultiSelection:function(e,t,i){this._multiSelectMode=i.multiselect,this.handleMultiSelection(e,t)},handleMultiSelection:function(e,t){this.isSelected(t.model)?this.onUnclickCheckBox(t):this.onClickCheckBox(t)},selectCardInMultiSelectMode:function(e){e.onSelectCheckbox(),e.onSelect(),-1===this._selectedModels.indexOf(e.model)&&(this._selectedModels.push(e.model),this._selectedCards.push(e))},onClickCheckBox:function(e){this._selectedView&&this._selectedView===e?this.multiSelectCardSimple(e):this.multiSelectCardFull([e])},onUnclickCheckBox:function(e){this.multiUnselectCardFull([e])},cancelDetailsPanel:function(e,t){var i=this;(this.detailsPanelManager.getActivePanel()?this.detailsPanelManager.getActivePanel():this.detailsPanelManager.getMultiDetailsPanel()).cancel({keepPanelOpen:e,onCancel:function(){t&&t.onCancel&&t.onCancel()},onAbortCancel:function(){i.scopeModelContainer.getScope()&&(I.removeScopeData(),i.scopeModelContainer.removeScopeInternal(),i.onReset())}})},handleTagCollect:function(e){this.collection&&(this.collection.handleFocusOnSubjects?this.collection.handleFocusOnSubjects(e&&e.model):N.handleFocusOnSubjects.call(this.collection,e&&e.model))},resetChildViews:function(){var t=this;this.cleanUpChildren();var i=this.collection.allValues();this._circleContainer||(this._circleContainer=e.createElement("ul")),i&&i.forEach(this.createColumnView,this);let s={stateValues:this.collection.allStates(),collection:this.collection,deliverablesTypes:this.collection.deliverablesTypes(),deliverablesTypesForSearch:this.collection.deliverablesTypesForSearch(),taskRequirementValues:this.collection.allSelectFieldValues(K.TASK_REQUIREMENT_ATTR),taskCompletionTypeValues:this.collection.allSelectFieldValues(K.TASK_COMPLETION_TYPE_ATTR),routeTaskActionValues:this.collection.allRouteTaskActions(),routeTaskStateValues:this.collection.allRouteTaskStates(),routeTaskNoReviewStateValues:this.collection.allRouteTaskNoReviewStates(),routeTaskApprovalActionValues:this.collection.allRouteTaskApprovalActions(),alertMessageContainer:this._alertContainer||this.container,context:h.getContext(),callbackForVisibleTasks:function(){return t.filterModelsWithSameParentWorkScopeAsSelectedTask(t.getVisibleRDFModels())},parentView:this,onCloseDetail:this.onCloseDetail.bind(this),postResetAction:this.handleOrderAndScroll.bind(this)};this.detailsPanelManager=new $(s)},getColumnViewCollection:function(e){var t=this.collection.tasksWithAttrValueCollection(e),i=new T;if(i.addSubCollection(t),this._rdfCollection){var s=this._rdfCollection.tasksWithAttrValueCollection(e);i.addSubCollection(s)}if(this.iteropTasksCollection){var o=this.iteropTasksCollection.tasksWithAttrValueCollection(e);i.addSubCollection(o)}if(this._srcCollection){var a=this._srcCollection.tasksWithAttrValueCollection(e);i.addSubCollection(a)}return t=i},unselectTaskForDestruction:function(e){this._selectedView===e&&this.singleUnselectCardActual(e)},createColumnView:function(t,i){var s=new this.ColumnView({parentView:this,collection:this.getColumnViewCollection(t),$dsTaskManagement:this.$dsTaskManagement,stateValues:this.collection.allStates(),attrDisplayValue:t.displayValue,attrValue:t.actualValue});this._columnViews.push(s);var o=i+1+"0";return s.container.setAttributes({style:"order:"+o+"; -webkit-order:"+o+"; -ms-order:"+o+";"}),this.addChildView(s),this.listenTo(s,"onTaskCardClicked",this.onTaskCardClicked.bind(this,s)),this.listenTo(s,"onTaskCardEdit",this.onTaskCardEdit.bind(this,s)),this.listenTo(s,"editMockTaskCard",this.onTaskCardEdit.bind(this,s)),this.listenTo(s,"onTaskCardContextMenu",this.onTaskCardContextMenu.bind(this)),this.listenTo(s,"onTaskDestroyed",this.unselectTaskForDestruction.bind(this)),this.listenTo(s,"onMultiSelection",this.onMultiSelection.bind(this,s)),e.createElement("li").inject(this._circleContainer),s},onCloseDetail:function(){this._selectedView&&!this._selectedView._recycled&&this.singleUnselectCardActual(this._selectedView);var e=this._selectedChildView;if(w.maximize)this._updateScrollButtonsAndDots();else{if(this.onResize(),this._maxLeftIndex()<this.getLeftColumnIndex())this.scrollLeft();else{var t=this.getLeftColumnIndex();--t>=0&&t<this._childrenViews.length&&e===this._childrenViews[t]&&this.scrollLeft()}this._circleContainer.getElements("li").pop().remove(),this._updateScrollButtonsAndDots()}this.handleTagCollect()},handleOrderAndScroll:function(t,i,s){if(!t.maximize){i.isOpen()||e.createElement("li").inject(this._circleContainer);let t=10*s+1;this.onResize(),i.container.setAttributes({style:"order:"+t+"; -webkit-order:"+t+"; -ms-order:"+t+";"}),s-this.getLeftColumnIndex()===this._nbColumnsShown?this.scrollRight():this._updateScrollButtonsAndDots()}},filterTasks:function(e){var t=I.getFilter(),i=e.value;i!==t&&(I.setFilter(i),enoviaServer.preferences.currentTaskFilter=i,this.setTitleDefaultValue(),this._drawTaskTools(),this.onFilter(),v.trackPageEvent({eventCategory:"taskView",eventAction:"filter",eventLabel:"filterValue",eventValue:i}))},onFilter:function(){this.onReset()},switchView:function(e,t){if(e!==this.currentViewName){this.currentViewName&&this.container.toggleClassName("tasks-"+this.currentViewName,!1),this.container.toggleClassName("tasks-"+e,!0),this.currentViewName=e;var i=!1;this.collection.setAttrToSplitBy(this.currentViewName,i),this._rdfCollection&&this._rdfCollection.setAttrToSplitBy(this.currentViewName,i),this.iteropTasksCollection&&this.iteropTasksCollection.setAttrToSplitBy(this.currentViewName,i),this._srcCollection&&this._srcCollection.setAttrToSplitBy(this.currentViewName,i),t||this.colChanged(),widget.setValue("currentView",e),this.onResize()}this._drawTaskTools()},colReset:function(){this._drawTaskTools()},colChanged:function(){this.resetChildViews(),this.onResize(),this.renderColumns(),this.dispatchEvent("afterColChanged"),this.updateTitle()},setScopeNameLabels:function(){if(this.container.isInjected()){var e,t=this.scopeModelContainer.getScope();t&&(e=t.get("name")),this.setTitleDefaultValue(),window.widget&&window.widget.getValue("appId")===K.APP_TSK&&this.setCredentialPreference(),this.modifyCreateTaskText(e),this.setScopePlaceholderText(t),this.collection&&this.listenToOnce(this.collection,"onSync",this.updateTitle),this._rdfCollection&&this.listenToOnce(this._rdfCollection,"onSync",this.updateTitle),this._srcCollection&&this.listenToOnce(this._srcCollection,"onSync",this.updateTitle)}},setCredentialPreference:function(){window.widget&&widget.getValue("collabspace")!==u.TSK_PRIVATE_SPACE?widget.setValue("xPref_CREDENTIAL",h.getContext()):window.widget&&widget.getValue("collabspace")===u.TSK_PRIVATE_SPACE&&widget.getValue("xPref_CREDENTIAL")&&widget.deleteValue("xPref_CREDENTIAL")},_shouldShowCollabSpaceAlert:function(e){var t,i=!1;if(e){var s=e.get("collabSpace")||this.collection.collabSpace;t=e.get("type")||"";var o=this.collection.projectTypes();o&&-1!==o.split(",").indexOf(t)&&(i=s!==this.collection.collabSpace)}return i},setScopePlaceholderText:function(e){var t=this.scopeIdView.getElement("input[type=text]");if(t){var i=se("emxCollaborativeTasks.Label.ShowTasksForObject");i=i.replace("%NAME%",se("emxCollaborativeTasks.WidgetLabel.MyTasks")),e?t.removeAttribute("placeholder"):t.setAttribute("placeholder",i)}},setup:function(t){var i=e.clone(t||{},!1);this.SHOWTASKSFOR=se("emxCollaborativeTasks.Label.ShowTasksForObject"),this._parent.apply(this,arguments),this.$dsTaskManagement=d(this.container);var s=widget.getValue("currentView"),o=s||"stateForDisplay";this._columnStyleInnerHTML="",this._embeddedApp=i.embeddedApp,this._alertContainer=i.alertContainer,this._singleTaskId=i.singleTaskId,this._columnViews=[],this._selectedModels=[],this._selectedCards=[],this.switchView(o,!0),this.resetChildViews(),this._initializeScopeModelContainer(),this._initializeScopeIdView(),this._rdfCollection&&this.listenTo(this._rdfCollection,"onFailToFindScope",this.onFailToFindRDFScope),this.addListeners(),this.modal=new a({renderTo:this.container,className:"eno-common-apps-modal",okButtonText:se("emxCollaborativeTasks.Command.OK"),koButtonText:se("emxCollaborativeTasks.Command.Cancel")}),this.initTagger()},addListeners:function(){this.listenTo(this.collection,"onChange:dictionary",(function(){this.colChanged()})),this.listenTo(this.collection,"onReset",this.colReset),this.listenTo(this.collection,"onChange:lastReadFrom",this._setLastReadClass),this.listenTo(this.collection,"onChange:search",(function(){this.colChanged(),this._updateTnProxyWithSearchFilter()})),widget&&this.listenTo(widget,"onViewChange",this.onViewChange),this.listenTo(this.collection,"onChange:collabSpace",this.render),this.listenTo(this,"onInjected",this.setScopeNameLabels),this.listenTo(this.scopeModelContainer,"onScopeDestroyed",this._onScopeDestroyed),this.eSignatureAuthAndRecordIdUpdate(),this.listenTo(G,"onUpdateNotification",(function(e){e.find((e=>{if(I.isScopeRDF()&&I.getScopeId()===e["@id"])return!(e.data&&!e.data["dsplan:hasTask"])&&I.getScope().get("@etag")!==e.ceStamp}))&&this.resetRDFCollectionForLiveUpdate()}))},eSignatureAuthAndRecordIdUpdate:function(){this.listenTo(this.collection,"onValidationFailure",(function(e,t){if(0!==t.fields.length&&"signature_required"===t.fields[0]){var i,s=B.getUser(),o=t.fields[1];"Reject"===o&&(o="Disapprove"),i={eSignPolicyReference:"ESignConfigRoute",Username:s&&s.login,x3dPlatformId:enoviaServer.tenant,ObjectActionType:o},H.init(i).subscribe("ESign-Authenticated",(function(t){let i=t.ESignRecordId;e._signature=!0,e.eSignRecordId=i,e.save();let s=W.getServiceUrl("3DSpace",!0)+"/resources/v1/modeler/ESignRecord/"+i,o=e.csrf;var a=e.get("needsReview"),n={actionType:[{ObjectRevision:e.get("revision")},{MaturityChange:{before:"To Do",after:""!==a&&"Yes"===a?"Review":"Complete"}}]},l={csrf:o,data:[{dataelements:{ObjectActionTaken:JSON.stringify(n),ObjectReference:e.id,ObjectServiceID:"3DSpace",ObjectURI:"/resources/v1/modeler/tasks/"}}]};r.authenticatedRequest(s,{method:"PUT",type:"json",data:JSON.stringify(l),headers:{"Content-Type":"application/json"},onComplete:()=>{var e=se("emxCollaborativeTasks.Success.UpdatedEsignRecordId");v.displaySuccess(e)},onFailure:()=>{var e=se("emxCollaborativeTasks.Error.FailedToUpdateEsignRecordId");v.displayError(e)}}),delete e._signature}))}}))},resetRDFCollectionForLiveUpdate:function(){this.resetRDFCollection()},tagAddListener:function(e){var t=this._selectedView.model;N.setExplicitTagsData(t,{object:e.object,sixw:e.predicate}),S.getTagInfo(t)},tagRemoveListener:function(e){var t=this._selectedView.model;N.removeExplicitTagsData(t,{object:e.object,sixw:e.predicate}),S.getTagInfo(t)},_onScopeDestroyed:function(e){e||v.displayError(se("emxCollaborativeTasks.Error.FailedToRetrieveScope")),this.setTitleDefaultValue()},_initializeScopeIdView:function(){this.scopeIdView=new m({model:this.scopeModelContainer,id:function(){return"changeContextDiv"},DocumentManagement:C,context:h.getContext(),i18n:se})},resetRDFCollection:function(){if(!this._rdfCollection)return;var e=this;this.showLoadingMessage(!0);let t=this._rdfCollection&&this._rdfCollection.fetch({reset:!0,onComplete:function(){I.setCollection(e._rdfCollection),e.updateTitle.bind(e),e.hideLoadingMessage()},onFailure:function(){e.hideLoadingMessage()}});t&&t.noFetch&&setTimeout(this.hideLoadingMessage.bind(this),0)},resetIteropCollection:function(){try{if(!this.iteropTasksCollection)return;var e=arguments[0];if(I.getObjectData()||e&&e.allfilters&&Object.keys(e.allfilters).length>0)this.iteropTasksCollection.reset();else{var t=this;this.showLoadingMessage(!0),this.iteropTasksCollection.fetch({onComplete:function(){t.hideLoadingMessage()},onFailure:function(){t.hideLoadingMessage()}})}}catch(e){console.log(e),this.hideLoadingMessage()}},resetSRCCollection:function(){try{if(!this._srcCollection)return;var e={previousModels:this._srcCollection.toArray()},t=arguments[0];if(I.getObjectData()||t&&t.allfilters&&Object.keys(t.allfilters).length>0)this._srcCollection.reset();else{var i=this;this.showLoadingMessage(!0),this._srcCollection.fetch({onComplete:function(){i.hideLoadingMessage(),i._srcCollection.dispatchEvent("onReset",[i._srcCollection,e])},onFailure:function(){i.hideLoadingMessage()}})}}catch(e){console.log(e),this.hideLoadingMessage()}},_initializeScopeModelContainer:function(){var e=this;this.scopeModelContainer=new F({collection:this.collection}),this.scopeModelContainer.confirmRemoveScope=function(t){var i=this.get("scope");if(i){var s=i.get("name")||"",o=se("emxCollaborativeTasks.Command.RemoveContext").replace("%NAME%",v.escapeHTML(s));e.modal.confirm(o,se("emxCollaborativeTasks.Command.RemoveContextTitle"),(function(i){i&&(t(),e.setScopePlaceholderText())}))}};var t=function(){this._scopeListenedTo&&this.stopListening(this._scopeListenedTo),this._scopeListenedTo=this.scopeModelContainer.getScope(),this._scopeListenedTo&&this.listenTo(this._scopeListenedTo,{onChange:this.setScopeNameLabels,onReset:this.setScopeNameLabels})};this.listenTo(this.scopeModelContainer,"onChange:scopeId",(function(i){t.apply(this),this.updateCreateTaskIcon(),i&&this.onReset(),setTimeout((function(){e.container&&e.container.getElement("#scopeIdContainer").removeClassName("active"),e.container&&e.container.getElement("ul").removeClassName("active")}),0)})),t.apply(this)},_setLastReadClass:function(e,t){this.container.toggleClassName("readFromLocal","local"===t)},onViewChange:function(){this.container.click()},template:function(t){let i=e.clone(t||{},!1);e.extend(i,this.collection.dataForRendering()),window.widget&&(i.showCreateDialog=!0);var s=f.i18n;f.i18n=se;var o=ae(i);return f.i18n=s,o},updateCreateTaskIcon:function(){this.setScopeNameLabels(),this.shouldDisableCreateTask()?this.disableCreateTaskIcon():this.enableCreateTaskIcon()},updateCredentialsBasedOnServiceData:function(){h.onEdit(widget)},render:function(t){var i=this;return this.removeElementsFromDom(),i.container.empty(!0),i.container.setHTML(this.template()),e.Utils.Client.Platform.ios&&i.container.addClassName("ios"),this._setScopesTypesForSearch(),this._columnStyle=i.getElement("#respColumnWidth"),this._columnStyle.setHTML(this._columnStyleInnerHTML),this.renderColumns(),this.showLoadingMessage(),this._drawTaskTools(),this._addToolTipCreateTaskIcon(),this._setLastReadClass(null,this.collection.lastReadFrom),this._scopeIdContainer=this.getElement("#scopeIdContainer")||widget.getElement("#scopeIdContainer"),this.scopeIdView.render().inject(this._scopeIdContainer),W.hasLoadedRolesData()?this.updateCredentialsBasedOnServiceData():(this.listenToOnce(W,"rolesDataLoaded",this._updateUIBasedOnRoles),this.listenToOnce(W,"serviceDataLoaded",this.updateCredentialsBasedOnServiceData)),this.updateCreateTaskIcon(),this.dispatchEvent("afterRender"),this.container.addClassName(Ce[widget.getValue(pe)||D.TILE]),void 0!==this._fetchCount&&this._fetchCount>0&&this.showLoadingMessage(),t&&t.shouldRearrangeDOMElementsForToolbar&&this.rearrangeDOMElementsForToolbar(),this.checkAndInitializeTaskTableView(),this},_addToolTipCreateTaskIcon:function(){var e=this.getElement("#createTaskIcon");this._createTaskTooltip=new l({target:e,body:se("emxCollaborativeTasks.Label.NewTask"),position:"bottom"})},_updateUIBasedOnRoles:function(){this.updateCreateTaskIcon(),this._detailPanel._detailsView&&this._detailPanel.onFieldValueChange()},injectTaskDetailsPanel:function(){this.detailsPanelManager.injectDetailsPanel(this.container)},injectMultiTaskDetailsPanel:function(){this.detailsPanelManager.injectDetailsPanel(this.container,!0)},injectExternalDetailsPanel:function(){this.detailsPanelManager.injectDetailsPanel(this.container,!1,!0)},showLoadingMessage:function(e){var t=this.getElement(".pagination");e&&this._fetchCount++,this._fetchCount>0&&t&&v.showLoadingMessage(t)},hideLoadingMessage:function(){if(this._fetchCount--,this._fetchCount<=0&&this.container){const e=this.getElement(".pagination");e&&v.hideLoadingMessage(e),this.dispatchEvent("onHideLoadingMessage")}this._fetchCount<0&&(console.error("negative fetch count reset to 0"),this._fetchCount=0)},isLoadingMessageShown:function(){return this._fetchCount>0},isTaskCreationRestricted:function(e){return"function"==typeof e.canModify&&!e.canModify(!1,K.TASK_RELATION_ATTR)&&e.hasFetchedModifyData()},shouldDisableCreateTask:function(){let e=!1;const t=I.isScopeRDF(),i=I.getObjectData();(I.isScopeSwym()||I.isAgileWorkContext()&&i.isSwym)&&(e=!0);if(!e&&t&&!I.isAgileWorkContext()&&(e=!W.isXPPAuthorized()),!e){const e=I.getScope();if(e){if(this.isTaskCreationRestricted(e))return!0;if(e.hasFetchedAccessData())return!e.canModify(!0)}}return e},removeElementsFromDom:function(){this.tasksTableView&&this.tasksTableView.remove(),this._circleContainer.remove(),this.scopeIdView&&this.scopeIdView.remove();for(var e=this._childrenViews.length,t=0;t<e;t++){this._childrenViews[t].container.remove()}},_setScopesTypesForSearch:function(){var e=this,t=function(){var t=e.scopeModelContainer.config();t[0].activationCallback=function(t,i){e._scopeIdContainer.toggleClassName("active",i)},e.scopeIdView.setConfig(t),e.scopeIdView.render(),e.setScopeNameLabels()};this.collection.scopesTypesForSearch()||this.listenToOnce(this.collection,"onSync",(function(){t()})),R.hasLoadedFederatedSearchSources()||this.listenToOnce(R.eventDispatcher,"onFederatedSearchSourcesLoaded",(function(){t()})),t()},renderColumns:function(){var e=this,t=e.getElement(".columns-carrier");if(this._columnsCarrier=t,t){t.empty();for(var i=e._childrenViews.length,s=0;s<i;s++){var o=e._childrenViews[s];o instanceof w&&w.maximize?this.injectTaskDetailsPanel():o instanceof U&&U.maximize?this.injectExternalDetailsPanel():o instanceof O&&O.maximize?this.injectMultiTaskDetailsPanel():o.container.inject(t),o.render()}}return this._circleContainer.inject(e.getElement(".pagination")),this.setLeftColumnIndex(0),this},_drawTaskTools:function(){if(this._taskFilterNLSValues=this._getTaskFilterViewNLSValues(),this._taskTools=this.getElement("#taskTools")||widget.getElement("#taskTools"),this._taskTools){this._taskTools.empty(),this._multiSelectButton&&this._multiSelectButton.destroy();const i=this.getMultiSelectModeToolbarEle();this._viewByTooltip=i.tooltip,this._multiSelectButton=i.button.inject(this._taskTools),this._selectedCardsCount&&this._selectedCardsCount.destroy(),this._selectedCardsCount=this.getSelectedCardsCountToolbarEle().inject(this._taskTools),this._multiSelectDropDownMenu&&this._multiSelectDropDownMenu.destroy();var t="";"allLevelTasks"===widget.getValue(K.LEVEL_PREF)&&(t="disabled"),this._multiSelectDropDownArrow=e.createElement("span",{class:"fonticon fonticon-open-down item-select"}),this._multiSelectDropDownArrow.inject(this._taskTools),this._multiSelectDropDownArrow.addEvent("click",(e=>{this._multiSelectDropDownMenu&&this._multiSelectDropDownMenu.destroy(),this._multiSelectDropDownMenu=this.getMultiSelectDropDownMenu(e,t),this._multiSelectDropDownMenu.show()})),this._tasksFilterMenuButton&&this._tasksFilterMenuButton.destroy(),this._tasksFilterMenuButton=this._drawTaskFilterMenu().inject(this._taskTools),this.addDisplayPreferenceMenu(),this._displayMenuButton&&this._displayMenuButton.destroy(),this._cardViewMenuButton&&this._cardViewMenuButton.destroy(),this._displayMenuButton=D.createViewSwitcher({id:"TASK_VIEW",currentView:this.isTableActive()?D.TABLE:D.KANBAN,viewMenus:[D.KANBAN_MODEL,D.TABLE_MODEL],callback:this.onClickViewMenu.bind(this)}).inject(this._taskTools),this.isTableActive()?(this._multiSelectButton.destroy(),this._selectedCardsCount.destroy(),this._multiSelectDropDownMenu&&this._multiSelectDropDownMenu.destroy(),this._multiSelectDropDownArrow&&this._multiSelectDropDownArrow.destroy()):this._cardViewMenuButton=D.createViewSwitcher({id:"CARD_VIEW",currentView:widget.getValue(pe)||D.TILE,viewMenus:[D.TILE_MODEL,D.LARGE_TILE_MODEL],callback:this.onClickViewMenu.bind(this)}).inject(this._taskTools)}},addDisplayPreferenceMenu:function(){if(this.model&&this.model.isAgile&&this.model.isAgile()){let t=e.createElement("span",{id:"displayPreferences",class:"fonticon fonticon-menu-eye"});this._displayMenuTooltip=new l({target:t,body:se("E6WCommonApps.Label.DisplayPreferences"),position:"bottom"}),t.inject(this._taskTools),this.displayMenu&&this.displayMenu.destroy();let i=[];i.push(X.getResourceWorkloadMenu.call(this)),this.displayMenu=X.createDisplayMenuDropdown(i,this._taskTools)}},getMenuItems:function(e){var t=[{text:v.i18n("E6WCommonUI.Label.MultiSelectMode"),className:"multi-select",id:"multiSelect",fonticon:"fonticon fonticon-select-on"},{text:v.i18n("E6WCommonUI.Label.SelectAll"),className:"select-all "+e,id:"SelectAll",fonticon:"fonticon fonticon-select-all"},{text:v.i18n("E6WCommonUI.Label.UnselectAll"),className:"unselect-all",id:"UnselectAll",fonticon:"fonticon fonticon-select-none"}];return this._multiSelectMode&&this._selectedModels.length>0&&q.isSelectionValid(this._selectedModels,{displayWarning:!0})&&t.push({text:v.i18n("E6WCommonUI.Label.EditSelected"),className:"edit-selected",id:"EditSelected",fonticon:"fonticon fonticon-pencil"}),t},_drawTaskFilterMenu:function(){var t=e.createElement("span",{id:"ViewMenu",class:"fonticon fonticon-list-filter"});this._viewByTooltip=new l({target:t,body:se("E6WCommonApps.Label.FilterBy"),position:"bottom"});var i=this.getDropDownItems();return this.setSelectView(i),this._tasksFilterDropDownMenu=new n({id:"ViewMenu",target:t,items:i,events:{onClick:this.onMenuClick.bind(this)}}),t},onMenuClick:function(e,t){this._multiSelectMode=!1,this.onUnselectAll(),t.className.indexOf("filter-")>-1?this.filterTasks(t):this.switchView(t.value)},setClassNameAndWidgetValue:function(e){if(e===D.KANBAN){if(!this.isTableActive())return;e=D.TILE}[ue,de,he].forEach((e=>{this.container.removeClassName(e)}));let t=Ce[e];!this.isTableActive()||t!==de&&t!==he||(this._selectedModels=[],this._selectedCards=[]),this.container.addClassName(t),widget.setValue(pe,e)},onMultiSelectClick:function(){this.getElements(`.collaborative-tasks-content ${ge}`).forEach((function(e){e.toggleClassName(me)})),this.toggleMultiSelectModeBtn(this._multiSelectButton),this._multiSelectMode&&!0===this._multiSelectMode?(this.removeMultiSelectCardClasses(),this._selectedModels=[],this._selectedCards=[],this._multiSelectMode=!1):this._multiSelectMode=!0,this._selectedModels&&this._selectedModels.length>0?this._selectedCardsCount.innerHTML=this._selectedModels.length:this._selectedCardsCount.innerHTML=""},onUnselectAll:function(){this.clearSelectedCards()},editSelected:function(){this._multiSelectMode&&this.detailsPanelManager.openDetailsPanel(1)},removeMultiSelectCardClasses:function(){this.getElements(`.collaborative-tasks-content ${ge}`).forEach((function(e){e.classList.remove(me),e.classList.remove("wux-ui-state-highlighted")})),this.getElements(".real-card").forEach((function(e){e.classList.remove("active"),e.classList.remove("checkbox-selected")}))},onSelectAll:function(){var e=this;this._columnViews.forEach((function(t){t.collection.toArray().forEach((function(t){e._selectedModels.includes(t)||e._selectedModels.push(t)})),t._childrenViews.forEach((function(t){t.isSelected()||e.multiSelectCardBasic(t)}))})),this._selectedCardsCount.innerHTML=this._selectedModels.length,this.detailsPanelManager&&this.detailsPanelManager._activePanel&&this.detailsPanelManager.isMultiSelectionValid()},onClickViewMenu:function(e){e===D.TABLE&&(this._multiSelectMode=!1),(e===D.TABLE&&!this.isTableActive()||e!==D.TABLE&&this.isTableActive())&&this.onUnselectAll(),this.setClassNameAndWidgetValue(e),this._drawTaskTools(),this.checkAndInitializeTaskTableView(),this.colChanged()},onMultiSelectionDropDownClick:function(e,t){"SelectAll"===t.id?this.onSelectAll():"UnselectAll"===t.id?this.onUnselectAll():"multiSelect"===t.id?this.onMultiSelectClick():"EditSelected"===t.id&&this._multiSelectMode&&this.detailsPanelManager.openDetailsPanel(1)},_drawSmallLargeTaskCardsTableViewMenu:function(){var t=this,i=e.createElement("span",{class:"fonticon "+TASK_VIEW_FONTICON_MAP[widget.getValue(pe)||DEFAULT_VIEW]});this._smallLargeCardTooltip=new l({target:i,body:se("E6WCommonApps.Label.SwitchView"),position:"bottom"});var s=[{text:se("E6WCommonApps.Label.SmallTiles"),selected:"smallCards"===widget.getValue(pe),class:de,fonticon:"fonticon fonticon-view-small-tile "},{text:se("E6WCommonApps.Label.LargeTiles"),selected:"largeCards"===widget.getValue(pe),class:he,fonticon:"fonticon fonticon-view-big-tile "},{text:se("E6WCommonApps.Tasks.Label.TaskTableView"),selected:this.isTableActive(),class:ue,fonticon:"fonticon fonticon-view-list "}];return this._displayOptionsDropdown=new n({target:i,items:s,events:{onClick:function(e,i){t.setClassNameAndWidgetValue(i.class),t._drawTaskTools(),t.checkAndInitializeTaskTableView(),t.colChanged()}}}),i},checkAndInitializeTaskTableView:function(){this.isTableActive()&&this.initializeTaskTableView()},initializeTaskTableView:function(){this.tasksTableView||(this.tasksTableView=new L({tasksCollection:this.collection,rdfTasksCollection:this._rdfCollection,iteropTasksCollection:this.iteropTasksCollection,srcCollection:this._srcCollection,parentTaskView:this}),this.tasksTableView.listenTo(this,"scopeInitializedOnTaskView",(function(e){this.scopeModelContainer=e}))),this.tasksTableView.inject(this.getElement("#taskTableViewDiv")),this.tasksTableView.updateLoadingMessage()},isTableActive:function(){return widget.getValue(pe)===D.TABLE||"taskTable"===widget.getValue(pe)},_getTaskFilterViewNLSValues:function(){return{viewBy:se("E6WCommonApps.Label.FilterBy"),stateForDisplay:se("emxCollaborativeTasks.Command.View.stateForDisplay"),state:se("emxCollaborativeTasks.Command.View.state"),dueDateCategory:se("emxCollaborativeTasks.Command.View.dueDateCategory"),all:se("emxCollaborativeTasks.Command.Filter.all"),owned:se("emxCollaborativeTasks.Command.Filter.owned"),assigned:se("emxCollaborativeTasks.Command.Filter.assigned"),ownedOrAssigned:se("emxCollaborativeTasks.Command.Filter.ownedOrAssigned"),candidateAssignee:se("emxCollaborativeTasks.Command.Filter.candidateAssignee")}},getDropDownItems:function(){var e=this._taskFilterNLSValues,t=[];return this.isTableActive()||(t.push({className:"drop-tool view-by-menu stateForDisplay-view",text:e.stateForDisplay,value:"stateForDisplay"}),this._embeddedApp||t.push({className:"drop-tool view-by-menu state-view",text:e.state,value:"state"}),t.push({className:"drop-tool view-by-menu dueDateCategory-view",text:e.dueDateCategory,value:ie}),t.push({className:"divider"})),t.push({className:"drop-tool task-filter filter-all",text:I.getScopeType()?e.all:e.ownedOrAssigned,value:ne}),t.push({className:"drop-tool task-filter filter-owned",text:e.owned,value:le}),t.push({className:"drop-tool task-filter filter-assigned",text:e.assigned,value:re}),t.push({className:"drop-tool task-filter filter-candidate-assignee",text:e.candidateAssignee,value:ce}),t},setSelectView:function(e){var t=this,i=I.getFilter();return e.forEach((function(e){t.currentViewName===e.value||i===e.value?e.fonticon="fonticon fonticon-check":e.fonticon="fonticon"})),e},scrollRight:function(){var e=this.getLeftColumnIndex();this.setLeftColumnIndex(++e)},scrollLeft:function(){var e=this.getLeftColumnIndex();this.setLeftColumnIndex(--e)},_resetSingleTask:function(){W.hasAccess("3DSpace")&&this.collection.fetchTaskById(this._singleTaskId,{reset:!0}),this._rdfCollection.length&&this._rdfCollection.at(0).fetch()},onReset:function(){this.onViewChange(),this._multiSelectMode&&this.onMultiSelectClick(),this.scopeModelContainer._scope&&this.scopeModelContainer.validateRDFScopeWithServer(this.scopeModelContainer._scope),this._singleTaskId?this._resetSingleTask():this.resetCollections()},resetCollections:function(){var e=this,t=!this._embeddedApp&&W.hasAccess("3DSpace"),i={previousModels:this.collection.toArray()};if(t){this.showLoadingMessage(!0);let t=this.collection.fetch({server:!0,reset:!0,onComplete:function(){e.updateTitle(),e.hideLoadingMessage(),e.collection.dispatchEvent("onReset",[e.collection,i]);var t=se("emxCollaborativeTasks.Label.SuccessfulRefresh");v.displaySuccess(t)},onFailure:function(t,i){e.hideLoadingMessage();var s=E.getErrorMessageForInvalidCredentials(i);if(!s){var o=se("emxCollaborativeTasks.Label.FailedRefresh");s=i&&i.error||o}v.displayError(s)}});t&&t.noFetch&&setTimeout(this.hideLoadingMessage.bind(this),0)}this.resetRDFCollection(),this.resetIteropCollection(),this.resetSRCCollection()},onResize:function(){var e=this;if(!this._childrenViews)return;var t=(this.getElement(".collaborative-tasks-content-wrapper")||this.container).getSize();if(t.width&&t.height){var i=this._nbColumnsShown;!function(){var i=_.nbCardsBuffer,s=_._cardHeight||80;_.nbCardsBuffer=Math.floor(t.height/s)+2*_.nbCardsTopBuffer;for(var o=e._childrenViews.length-1;o>=0;o--){var a=e._childrenViews[o];if(a instanceof _&&a.collection)a.collection.size()>Math.min(i,_.nbCardsBuffer)&&a.resizeBuffer()}}();var s=d(this.container),o=t.width/this._minColWidth,a=Math.floor(o);a=Math.max(1,a);var n,l="min-width:"+this._minColWidth+"px;",r=100/a,c=this._nbColumnsToDisplay(),h=r*c,u=100/c,p="",m="";o>c?(m=".columns-carrier { max-width: calc( "+c+" * "+this._maxColWidth+"px );} ",p=".column { width:"+u+"%;"+l+" max-width:"+this._maxColWidth+"px; } ",s.toggleClass("wide",!0),s.toggleClass("medium",!1),s.toggleClass("narrow",!1),this._nbColumnsShown=c):(s.toggleClass("wide",!1),a>1?(s.toggleClass("medium",!0),s.toggleClass("narrow",!1),l="min-width:0px;"):(s.toggleClass("medium",!1),s.toggleClass("narrow",!0),l="min-width:0px;"),p=".column { width:"+u+"%; max-width:none;"+l+"} ",m=".columns-carrier { width:"+h+"%;} ",this._nbColumnsShown=a||1),n=".collaborative-tasks-content .alert:not(.alert-fullwidth)  { width: calc("+100/this._nbColumnsShown+"% - 4px) }";var g=".column.details-tasks.off { transition: width "+this._durationOfDetailClosure/1e3+"s ease-in-out; }";this._columnStyleInnerHTML=g+p+m+n,this._columnStyle&&this._columnStyle.setHTML(this._columnStyleInnerHTML),i!==this._nbColumnsShown&&this.setLeftColumnIndex(this.getLeftColumnIndex())}},_maxLeftIndex:function(){return this._nbColumnsToDisplay()-this._nbColumnsShown},_stopAutoScrolling:function(){this.autoScrolling=!1},_nbColumnsToDisplay:function(){var e=this._columnViews.length;return this._selectedChildView&&!w.maximize&&e++,e},setLeftColumnIndex:function(e){if(this._childrenViews){var t=e<0?0:e;if(this._selectedChildView&&!w.maximize){var i=this._childrenViews.indexOf(this._selectedChildView)-(this._nbColumnsShown-2);1===this._nbColumnsShown&&(i=this._childrenViews.indexOf(this._selectedChildView)+1),t=t<i?i:t}var s=this._maxLeftIndex();t=t>s?s:t,this._leftColumnIndex!==t&&(this.autoScrolling=!0,setTimeout(this._stopAutoScrolling.bind(this),510)),this._leftColumnIndex=t,this._columnsCarrier&&this._columnsCarrier.setStyle("left",-100*t/this._nbColumnsShown+"%"),this._updateScrollButtonsAndDots()}},_updateScrollButtonsAndDots:function(){var e=this.getLeftColumnIndex(),t=this.getElement(".scroll-left"),i=this.getElement(".scroll-right");t&&t.toggle(0!==e&&!this._selectedChildView),i&&i.toggle(e!==this._maxLeftIndex()&&!this._selectedChildView);var s=this._circleContainer.getElements("li");if(s)for(var o=s.length,a=0;a<o;a++){var n=s[a];a<e||a>=e+this._nbColumnsShown?n.removeClassName("in-view"):n.addClassName("in-view")}for(var l=this._nbColumnsToDisplay(),r=[],c=0;c<l;c++){var d=this._childrenViews[c];r.push(d),d===this._selectedChildView&&(r.push(this.detailsPanelManager.getDetailsPanel()),r.push(this.detailsPanelManager.getExternalDetailsPanel()),r.push(this.detailsPanelManager.getMultiDetailsPanel()))}for(var h=e+this._nbColumnsShown-1,u=0;u<l;u++){r[u].container.toggleClassName("right-most-column-shown",u===h)}},getLeftColumnIndex:function(){return this._leftColumnIndex||(this._leftColumnIndex=0),this._leftColumnIndex},fireOnClickCreateTask:function(){var e;1===++oe?e=setTimeout((()=>{oe=0,this._onClickCreateTaskButton(1)}),400):2===oe&&(clearTimeout(e),oe=0,this._onClickCreateTaskButton(2))},_onClickCreateTaskButton:function(t){if(this._createTask&&this._createTask.dialog)return;var i=this.scopeModelContainer.getScope(),s=!1;i&&(s=this._shouldShowCollabSpaceAlert(i));const o={};if(o.scope=i,o.showAlert=s,o.elementType=Y.TASK,o[Y.REPEAT_CREATE_TASK]=2===t,o.tasksCollection=this.collection,o.rdfTasksCollection=this._rdfCollection,o.onCompleteCallback=this.onCompleteCreateTask.bind(this),o.onFailureCallback=this.onFailureCreateTask.bind(this),o.onExecuteCreateTask=this.onExecuteCreateTask.bind(this),this._createTask=new x(o),this._createTask.renderAsDialog({enableRepeat:!0}),s){var a=e.createElement("span",{class:"fonticon fonticon-attention",title:se("emxCollaborativeTasks.Label.CollaborativeSpaceAttention")}),n=this._createTask._detailsView.getFieldViewByName("taskCollabSpace").getElement(".input-group-wrapper");a.inject(n)}!v.isIpad()&&v.isAndroid()},onCompleteCreateTask:function(e,t,i){i&&i.selectTask&&this.selectNewlyCreatedTask(e)},selectNewlyCreatedTask:function(e){if(this.isTableActive()){const t=this.tasksTableView.treeDocument.getRoots().find((t=>t.getAttributeValue("correspondingModel")===e));this.tasksTableView.selectNodeModel(t),this.tasksTableView&&this.tasksTableView.openPropertyPanelForNewNode(e)}else this.ColumnView.lastCardAdded&&this.ColumnView.lastCardAdded.onClickTaskCard(void 0,{openDetailsPanel:!0})},onFailureCreateTask:function(e){var t=se("emxCollaborativeTasks.Error.CannotCreateObjectTask"),i=se("emxCollaborativeTasks.Error.FailedToCreateTask"),s=e[2],o=s&&s.response;if(o&&400===o.statusCode)i=o.error&&o.error.length?se(o.error):i;else{var a=E.getErrorMessageForInvalidCredentials(o);a&&(i=a)}v.displayError(i,{level:"error",title:t,showWebUX:!0})},onExecuteCreateTask:function(e){var t=this.getNewColumnIndex(0,1,e);return this.setLeftColumnIndex(t),e},getNewColumnIndex:function(e,t,i){var s=0;if("state"===this.currentViewName)s=e;else if(this.currentViewName===ie){var o=i.get(ie);s=t,this.collection.allDueDates().detect((function(e,t){var i=e.actualValue===o;return i&&(s=t),i}))}return s},handleDropCSV:function(e){var i,s,o,a=this;return e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),t.getElement(e).getParent().removeClassName(K.DROP_CLASS_NAME),(i=e.dataTransfer.files)&&i.length&&(s=i[0],"undefined"!=typeof FileReader&&((o=new FileReader).onload=function(e){var t=e.target.result,i={onComplete:a.onCSVSuccess,onFailure:a.onCSVFailure};a.collection.importTasksFromCSV(t,i)},o.readAsText(s))),!1},onCSVSuccess:function(){var e=se("emxCollaborativeTasks.Label.ImportItemsDone");v.displayMessage({msg:e,msgType:"primary"})},onCSVFailure:function(){var e=se("emxCollaborativeTasks.Label.ImportItemsDone");v.displayPrimary(e)},handleDragOver:function(e){return e.preventDefault&&e.preventDefault(),e.dataTransfer.dropEffect="copy",t.getElement(e).getParent().addClassName(K.DROP_CLASS_NAME),!1},handleDragEnter:function(e){t.getElement(e).getParent().addClassName(K.DROP_CLASS_NAME)},handleDragLeave:function(e){t.getElement(e).getParent().removeClassName(K.DROP_CLASS_NAME)},handleDragEnd:function(e){t.getElement(e).getParent().removeClassName(K.DROP_CLASS_NAME)},clearAllDropZoneMasks:function(){for(var e=this.getElements("."+K.DROP_CLASS_NAME),t=e.length,i=0;i<t;i++)e[i].toggleClassName(K.DROP_CLASS_NAME,!1)},modifyCreateTaskText:function(e){var t=this.getElement("#createTaskIcon"),i=se("emxCollaborativeTasks.Label.NewTask");t&&(this._createTaskTooltip&&this._createTaskTooltip.destroy(),delete this._createTaskTooltip,this.shouldDisableCreateTask()?this._createTaskTooltip=v.createTooltip(t,this.getDisabledPlaceholder(),"bottom"):e?(i=se("emxCollaborativeTasks.Label.CreateTaskForContext"),this._createTaskTooltip=v.createTooltip(t,i.replace("%CONTEXT%",v.escapeHTML(e)),"bottom")):this._createTaskTooltip=v.createTooltip(t,i,"bottom"))},getDisabledPlaceholder:function(){var e,t=0===P.getUsersContentRepositories().length,i=I.isScopeRDF(),s=h.getContext()===u.TSK_PRIVATE_SPACE;return i||!t||s?I.isScopeSwym()?e="E6WCommonUI.Label.SwymTaskDisabled":i&&!W.isXPPAuthorized()&&(e="emxCollaborativeTasks.Error.FailedToCreateTaskWithNoXPPLicense"):e="E6WCommonUI.Label.NoAccessToCollabSpace",se(e)},setTitleDefaultValue:function(){var e=se("emxCollaborativeTasks.Command.Filter.assigned"),t=widget.getValue("title"),i=se("emxCollaborativeTasks.Command.Filter."+I.getFilter());I.getScopeType()||"all"!==I.getFilter()||(i=se("emxCollaborativeTasks.Command.Filter.ownedOrAssigned"));var s=i||t,o=s&&s.indexOf(":");-1!==o&&(s=s&&s.substring(o+1,o.length));var a=this.scopeModelContainer.getScope(),n=a&&a.get("name");s=n?n+":"+s:s||e,h&&h.getContextDisplayValue()&&(s=h.getContextDisplayValue()+" - "+s),widget.setValue("title",s)},initScope:function(){var e=I.getScopeId();!this.scopeModelContainer.getScope()&&e?this.scopeModelContainer.add("scope",e,{scopeType:I.getScopeType(),isRDF:I.isScopeRDF(),dontCheckTypes:I.isScopeRDF(),isScopeSwym:I.isScopeSwym(),objectData:I.getObjectData(),initialLoad:!0}):I.isInvalidScope()?(I.setScopeToInvalid(!1),this.scopeModelContainer.removeScopeOnDelete()):this.scopeModelContainer.getScope()&&!e&&this.scopeModelContainer.removeScopeInternal(),this.dispatchEvent("scopeInitializedOnTaskView",[this.scopeModelContainer])},_getSingleTaskTitle:function(){var e;return 1===this.collection.length?e=this.collection.at(0).get("title"):this._rdfCollection&&1===this._rdfCollection.length&&(e=this._rdfCollection.at(0).get("title")),e},getTotalTasksCount:function(){var e=0;return this._columnViews.forEach((t=>{e+=t.collection.length})),e},updateTitle:function(){if(widget){var e;if(this._singleTaskId)e=this._getSingleTaskTitle();else if(e=widget.getValue("title"))if(e=e.trim(),this.collection&&this.collection._search)e+=" ("+this.getTotalTasksCount()+")";else{var t=this.collection.length;this._rdfCollection&&(t+=this._rdfCollection.length),this._srcCollection&&this._srcCollection.length&&(t+=this._srcCollection.length),e+=" ("+t+")"}e=e&&e.stripTags(),widget.getTitle()!==e&&widget.setTitle(e)}},getVisibleModels:function(){for(var e=[],t=this.getLeftColumnIndex(),i=t;i<t+this._nbColumnsShown;i++){var s=this._childrenViews[i];s.getVisibleModels&&(e=e.concat(s.getVisibleModels()))}return e},getVisibleRDFModels:function(){return this.getVisibleModels().filter((function(e){return e instanceof y}))},filterModelsWithSameParentWorkScopeAsSelectedTask:function(e){var t=[],i=this._selectedView.model.getParent&&this._selectedView.model.getParent();return i&&(t=e.filter((function(e){var t=e.getParent&&e.getParent();return t&&t.id===i.id}))),t},onFailToFindRDFScope:function(){v.displayError(se("emxCollaborativeTasks.Error.FailedToRetrieveScope"));var e=widget.getPreference("title");e&&widget.setValue("title",e.defaultValue),this.scopeModelContainer.setScope(null),I.removeUserScopeData(),this._rdfCollection.fetch({reset:!0,onComplete:this.updateTitle.bind(this)})},initTagger:function(){var t=this;try{var i=this.collection.getTNProxy({events:{addTagCreationListener:this.tagAddListener.bind(t),addTagDeletionListener:this.tagRemoveListener.bind(t)}});i instanceof b||(this.listenTo(i,"foundation2TagsFetchComplete",(function(e){t.updateLargeCardsWithTaggerData(e)})),i=new b(i),this.collection.setTNProxy(i)),this._rdfCollection&&N.addTaggerProxyColoringEvents(i.tnProxy,this._rdfCollection),N.addTaggerProxyColoringEvents(i.tnProxy,this.collection),this.setTaggerColorMap(i.tnProxy),this._rdfCollection&&i&&i.tnProxy&&(this.listenTo(i.tnProxy,"onFilterSubjectsChange",(function(){this._rdfCollection.filterCollection.apply(this._rdfCollection,arguments),this.resetIteropCollection(arguments[0])})),this.listenTo(this._rdfCollection,"onReset",(function(){var t=Array.prototype.slice.call(arguments,0),i=e.clone(t[1]||{},!1);this.fetchNewTags(i)})),this.listenTo(this._rdfCollection,"onTaskCollectionFetchComplete",(function(){this.fetchNewTags()})),this.listenTo(N.dispatcher,"refreshTagger",(function(){N.updateTagsData.apply(this,arguments),this._setTagDataOnProxy("rdf")})))}catch(e){}},fetchNewTags:function(t){const i=e.clone(t||{},!1),s=i.rdfCollection||this._rdfCollection;this._fetchNewTagsTimeout||i.dontCallTagger||!s||(this._fetchNewTagsTimeout=setTimeout((()=>{this._fetchNewTagsTimeout=void 0,s.requestFetchNewTags({onComplete:()=>this._setTagDataOnProxy("rdf",i),onFailure:()=>this._setTagDataOnProxy("rdf",i),onlyIfNeeded:!0})}),100))},_updateTnProxyWithSearchFilter:function(){!this.collection.getSearch()&&this.collection.originalCollection&&(this.collection.reset(this.collection.originalCollection._models,{dontRegisterChange:!0}),delete this.collection.originalCollection);var e=this.collection.getTNProxy();e.setSubjectsTags(N.getTaggerDataWithSearchFilter(this.collection),"foundation2"),e.setSubjectsTags(N.getTaggerDataWithSearchFilter(this._rdfCollection),"rdf")},_setTagDataOnProxy:function(e){var t=this._rdfCollection.getTaggerData();this.collection.getTNProxy().setSubjectsTags(t,e)},updateLargeCardsWithTaggerData:function(e){var t=this.collection&&this.collection.toArray();t&&t.forEach((t=>{var i=A.jsonURIToSparqlURI(t.id);if(i=t.getTagPrefix()+i,e[i]){var s=N.getExplicitTagsData(e[i]);t.set(N.EXPLICIT_TAGS_DATA,s)}}))},isBeingTagFiltered:function(){return!!this.collection.tnProxy.tnProxy.getCurrentFilter().allfilters&&Object.keys(this.collection.tnProxy.tnProxy.getCurrentFilter().allfilters).length},getSuperModal:function(){return this.modal},getFTSOptions:function(){return{}}});return Te.AUTO_SCROLL_TIMEOUT=510,Te.VIEW_VALUE_PRIORITY="priority",Te.SELECTED_TASK_VIEW=pe,Te.TABLE=D.TABLE,Te.FETCH_NEW_TAGS_TIMEOUT=100,Te.implement(z),Te.implement(V),Te.implement(J),Te.implement(M),Te})),define("DS/CollaborativeTasks/CollaborativeTasksBootstrap",["UWA/Core","UWA/Utils","DS/Utilities/TouchUtils","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/Foundation2/FoundationV2Data","DS/CollaborativeTasks/Collections/TasksCollection","DS/CollaborativeTasks/Views/CollaborativeTasksUtils","DS/E6WCommonApps/Collections/RDFTasksCollection","DS/E6WCommonApps/Collections/IteropTasksCollection","DS/CollaborativeTasks/Sourcing/SourcingTaskCollection","DS/CollaborativeTasks/Models/RDFTasksWorkscopeModel","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/MemberUtils","DS/CollaborativeTasks/Views/CollaborativeTasksView","DS/Foundation/WidgetAPIs","DS/Foundation/WidgetUwaUtils","DS/E6WCommonApps/SharedWidgetUwaUtils","DS/E6WCommonUI/Views/E6WHandlebarsHelpers","DS/E6WCommonApps/XTaskScope","DS/E6WCommonApps/LiveUpdateUtils","DS/DocumentManagement/DocumentManagement","DS/E6WCommonApps/SmartSchedulerUtils","DS/E6WCommonApps/Utils/BootstrapUtils","DS/E6WCommonUI/UIHelper","DS/RDFFoundation/FederatedSearchUtil","DS/RDFFoundation/SecurityContextUtils","DS/RDFFoundation/Models/ObjectProxyUtil","DS/E6WCommonApps/Models/RDFTaskModel","DS/E6WCommonUI/PlatformManager","DS/PlatformAPI/PlatformAPI","DS/E6WCommonUI/WidgetUtils","DS/E6WCommonApps/Views/ProgressBarPopupView","DS/E6WCommonApps/Models/FileManagementMixin","DS/ENODOMPurify/ENODOMPurify","DS/E6WCommonApps/Models/E6WCommonAppsConstants","DS/E6WCommonApps/CommonAppsHandlebarsHelper","DS/ENOProjectMgmtList/components/DetailsInitializer","i18n!DS/E6WCommonApps/assets/nls/CollaborativeTasksNLS","DS/XTaskApp/Models/XTaskAppTypeDictionary","css!DS/E6WCommonApps/E6WCommonApps"],(function(e,t,i,s,o,a,n,l,r,c,d,h,u,p,m,g,C,T,f,v,S,D,b,_,k,w,E,A,y,M,I,V,F,P,R,N,L,x){"use strict";new e.Class.Listener;var O,U=o.getWidgetConstant;o.getWidgetConstant=function(e){return U.apply(this,arguments)||x.get(e)};var W=function(){return o.getWidgetConstant.apply(this,arguments)},j=function(e){e.options&&e.options.length>1&&e.options.sort(((e,t)=>e.label.localeCompare(t.label)))};return T.i18n=W,N.registerPartials(),window.dataVersion=.3,O={emailNotificationService:"/resources/v1/modeler/tasks/tasksPreference",defaultWindowedHeight:505,lInitiateChangeAssigneeModule:null,checkVisibilityAPI:function(){void 0!==O.document.hidden?(O._hidden="hidden",O._visibilityChange="visibilitychange"):void 0!==O.document.mozHidden?(O._hidden="mozHidden",O._visibilityChange="mozvisibilitychange"):void 0!==O.document.msHidden?(O._hidden="msHidden",O._visibilityChange="msvisibilitychange"):void 0!==O.document.webkitHidden&&(O._hidden="webkitHidden",O._visibilityChange="webkitvisibilitychange")},onPreferencesOpened:function(e){e&&e.fromTSK||(O._prefsWhenOpened=widget.getPreferences().reduce((function(e,t){return e[t.name]=t.value,e}),{}))},onPreferencesClosed:function(){O.updateEmailPreference.apply(this,arguments),widget.dispatchEvent("onUpdateTitle",[widget.getTitle(),void 0]),O._prefsWhenOpened&&(O._prefsWhenOpened.collabspace!==widget.getValue("collabspace")&&(window.enoviaServer.space=widget.getValue("collabspace")),O._prefsWhenOpened.collabstorage!==widget.getValue("collabstorage")&&(y.setTenant(widget.getValue("collabstorage")),window.enoviaServer.storageUrl=y.getTenantServiceData()["3DSpace"],O.onStorageChange()),O._prefsWhenOpened.collabspace!==widget.getValue("collabspace")&&O.onSpaceChange())},_initEmailPreference:function(){if(y.isOnPremise()){var e={url:O.emailNotificationService,type:"GET",dataType:"json",callback:function(e){var t;e||(e={});var i=O.tasks.data();i&&o.__updateCsrf(i,e);try{widget.getValue("emailNotify")!==(t="true"===(t=e.data[0].dataelements.preference_AssignedTaskNotificationOn).toLowerCase())&&widget.setValue("emailNotify",t)}catch(e){}}};o.ajaxRequest(e)}},_doAutoRefresh:function(){!O.PENDINGFETCH&&O.tasks.length<=O.MAXFETCHCOUNT&&!this._getTaskIdToOpen()&&(O.PENDINGFETCH=!0,O.tasks.fetch({server:!0,partialRefresh:!0,noTag:!0,onComplete:function(){O.PENDINGFETCH=!1,O._setAutoRefreshTimeout()},onFailure:function(e,t){O.PENDINGFETCH=!1,O._handleInvalidScope(t,!O.tasks.dictionaryLoaded)||O._setAutoRefreshTimeout.bind(void 0,void 0)}}))},_setAutoRefreshTimeout:function(e){e?O._doAutoRefresh():O.REFRESHTIMEOUT&&(O.refreshTimeoutId=setTimeout((function(){O.document[O._hidden]||O._doAutoRefresh()}),O.REFRESHTIMEOUT))},handleVisibilityChange:function(){O.document[O._hidden]?(clearTimeout(O.refreshTimeoutId),delete O.refreshTimeoutId):O.refreshTimeoutId||O._setAutoRefreshTimeout(!0)},onTenantChangedInPreference:function(e){w.loadSecurityContextsForTenant({tenant:e,callback:function(e){var t=g.securityContextsForSameOrganization(e),i=widget.getPreference("collabspace");i.options=[];var s=e[0].name;for(var o of e){var a=g.getSecurityContextName(t,o.displayName);i.options.push({label:a,value:o.name,displayName:o.displayName}),o.isDefault&&(s=o.name)}j(i),i.defaultValue=s,widget.addPreference(i),widget.dispatchEvent("onEdit",{fromTSK:!0})}})},addNewPreferences:function(){var e=function(){window.enoviaServer.preferences.showProjectTasks=widget.getValue("showProjectTasks")},t={name:"showProjectTasks",type:"boolean",label:"Show project tasks",defaultValue:"true",onChange:e},i=D.getCompletedTasksFilterPref(D.COMPLETED_TASK_FILTER_30_DAYS);widget.addPreference({name:"collabstorage",type:"list",label:"collabstorage"}),widget.addPreference({name:"collabspace",type:"list",label:"collabspace"}),widget.addPreference(i),widget.addPreference(t),widget.addEvent("onStorageChange",(function(e,t){widget.isEdit&&O.onTenantChangedInPreference(t)})),y.isOnPremise()&&(widget.addPreference({name:"emailNotify",type:"boolean",label:"Email notifications",defaultValue:"defaultValue"}),widget.setValue("emailNotify","defaultValue")),e();var s=f.getFilter(),o=s||f.setFilter("all");enoviaServer.preferences.currentTaskFilter=o;var a=D.getCompletedTaskFilter();enoviaServer.preferences[D.COMPLETION_DATE_TASK_FILTER_ATTR]=a,widget.getValue("createSampleData")||(widget.setValue("createSampleData","true"),enoviaServer.preferences.createSampleData="true")},_has3DPlanAccess:function(){return y.hasAccess(R.SERVICE_3DPLAN)},_hasIteropAccess:function(){return y.hasAccess("businessprocess")},_hasSourcingAccess:function(){return y.hasAccess("sourcing")},showLoadingMessage:function(){O._fetchCount++,O.tasksView&&O.tasksView.showLoadingMessage(!0)},hideLoadingMessage:function(){O._fetchCount--,O.tasksView&&O.tasksView.hideLoadingMessage()},_loadRDFTasks:function(){if(O._getTaskIdToOpen()){if(O._taskIdToOpenIsRDF()){var e=new A({"@id":O._getTaskIdToOpen(),"dsxplan:jsType":"dsplan:Task"});O.showLoadingMessage(!0),e.fetch({onComplete:function(){O.hideLoadingMessage(),"dsplan:DeletedTask"===e.get("dsxplan:jsType")?_.displayInfo(W("emxCollaborativeTasks.Label.TaskDeleted")):(e.noFilter=!0,O.rdfTasks.add(e),O._selectTaskByIdOnLoad(e.id))},onFailure:function(){O.hideLoadingMessage(),O._onSingleTaskFetchFail()},mask:"dsplan:MVMask.Task.CollaborativeTask.Basic"})}}else{var t={fromCompletionDate:D.getCompletedTaskFilter()};!1===window.widget.getValue("showProjectTasks")&&(t.standAloneTasks=!0),O.showLoadingMessage(!0);var i=O.rdfTasks.fetch({reset:!0,data:JSON.stringify([f.getFilter(),t]),onComplete:O.hideLoadingMessage,onFailure:O.hideLoadingMessage});(i&&i.noFetch||!i)&&setTimeout(O.hideLoadingMessage,0)}h.subscribeToNotification(this.onNotification.bind(this)),this._notifQueue=[]},onNotification:v.onNotification,_getTaskIdToOpen:function(){return h.removeBracketLongURI(O._selectedTaskId)},_taskIdToOpenIsRDF:function(){return-1!==O._getTaskIdToOpen().indexOf(":")},initMSF:function(){require(["DS/MSFDocumentManagement/WidgetIntegration"],(function(e){S.MSFDocumentClient=e,S.MSFDocumentClient.ConnectWidgetWithMSF()}))},initRouteMgmt:function(){let e="DS/ENORouteMgmt/Views/Dialogs/InitiateChangeAssignee";require([e],(t=>{e=t}))},_initTasksCollection:function(){O.tasks=new a,O.tasks.addEvent("onAdd",O.onTitleChange),O.tasks.addEvent("onRemove",O.onTitleChange),O.tasks.addEvent("onReset",O.onTitleChange)},_initSourcingTasksCollection:function(){O.sourcingTasks=new c,O.sourcingTasks.addEvent("onAdd",O.onTitleChange),O.sourcingTasks.addEvent("onRemove",O.onTitleChange),O.sourcingTasks.addEvent("onReset",O.onTitleChange)},_initRDFTasksCollection:function(){l.RDFWorkscopeModel=d,this.rdfTasks=new l(void 0,{"@href":"/invoke/dsxplan:getTasks","@mask":"dsplan:MVMask.Task.CollaborativeTask.Basic",detailsMask:"dsplan:MVMask.Task.CollaborativeTasks.Complex"}),this.rdfTasks.addEvent("onAdd",this.onTitleChange),this.rdfTasks.addEvent("onRemove",this.onTitleChange),this.rdfTasks.addEvent("onReset",this.onTitleChange)},init:function(){b.commonInit(),O._fetchCount=0,_.setHeaderMetaTag(),i.setTouchMode(!0),e.extend(g,C),I.restoreWidgetViewModeBeforePreview(),window.enoviaServer||g.setupEnoviaServer({getUrl:()=>y.getServiceUrl("3DSpace",!0)}),window.enoviaServer.widgetId=widget.id,window.enoviaServer.widgetName=widget["6wWidgetName"];try{this.initRouteMgmt(),t.Client.Platform.windows&&this.initMSF()}catch(e){console.error(e)}widget.addEvents({onRefresh:O.onRefresh,onEdit:O.onPreferencesOpened,endEdit:O.onPreferencesClosed}),widget.useUIKitSelect=!0,this.addNewPreferences(),u.setContextUserUid(),g.onAfterLoad=Function.prototype,_.initializeAlert(window.document.body),this._initTasksCollection(),O.iteropTasks=new r;var o=widget.getValue("collabstorage");this._processSelectedIds(),this._loadDocumentMangementDictionary();const a=function(e,t){g.processStorages(e,o,{additionalStorage:R.SERVICE_3DPLAN}),y.storePlatformServiceData(e),g.setStoragesPrefs(widget,e,o,t?"true":"false"),t&&(O.processStorageChange(o),f.initialize(),O.document.addEventListener(O._visibilityChange,O.handleVisibilityChange,!1),m.getCollaborativeStorages((e=>a(e))))};s.getPlatformServices({platformId:y.getTenant(),onComplete:e=>a(Array.isArray(e)?e:[e],!0)}),O.scopes=O.tasks.getChildCollection("scopes");var l=top.document.getElementsByName("viewport");l&&l.length&&l[0].setAttribute("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"),S.downloadDocument=function(t,i,s,o){var a=e.clone(o||{},!1),n=Array.prototype.slice.call(arguments,0);n[3]=a;var l=a.serviceId;return enoviaServer&&l&&(a.tenantUrl=enoviaServer[l]),this.constructor.prototype.downloadDocument.apply(this,n)},I.addDragDropListeners(),y.fetchRolesData(),M.subscribe("Collaborative Tasks.refresh",(function(){O.refreshTimeoutId||O._setAutoRefreshTimeout(!0)})),n.initModelEventsBroker(),_.isWidgetInSidePanel()&&(document.body.addClassName("collaborativetasks-view-sidepanel"),this.pendingTaskToSelectId=widget.getValue("taskId"),O._sidePanelUpdateViewToken=M.subscribe("ENOTASK_AP.SelectTask",(e=>{if(e){if(!O.tasksView)return void(this.pendingTaskToSelectId=e.taskId);O.tasksView.selectTaskById(e.taskId)}})))},_loadDocumentMangementDictionary:function(){require(["DS/DocumentCreateNew/Utils/TypesUtils"],(e=>{try{!this.typeUtils&&e.init(),this.typeUtils=!0;let t=F.documentGetTypeInfoOptions();e.getTypeInfos(t)}catch(e){console.log(e)}}))},onLoad:function(){O.init()},onRefresh:C.onRefresh,_updatePrefOnRefresh:function(){var e=widget.getValue("showProjectTasks");window.enoviaServer.preferences.showProjectTasks=e;var t=D.getCompletedTaskFilter();enoviaServer.preferences[D.COMPLETION_DATE_TASK_FILTER_ATTR]=t},onViewChange:function(){var e=widget.getView();e.previous&&e.previous.type!==e.type&&O.setWindowHeight()},setWindowHeight:function(){var e=widget.getViewportDimensions();O.tasksView&&O.tasksView.container.setStyle("height",e.height)},onTitleChange:function(){O.tasksView&&O.tasksView.updateTitle()},onEmailNotifyChange:function(e,t){O.userEnteredEmailValue=t},onCompletedTasksDisplayPrefChange:function(e,t){D.setCompletedTaskFilter(t)},updateEmailPreference:function(){if(y.isOnPremise()){var e=widget.getValue("emailNotify"),t={data:[{dataelements:{}}]},i=O.userEnteredEmailValue;if(void 0!==i&&e===i){var s=O.tasks.data();s&&o.__updateCsrf(t,s),t.data[0].dataelements.preference_AssignedTaskNotificationOn=i.toString();var a={url:O.emailNotificationService,type:"PUT",dataType:"json",data:JSON.stringify(t),headers:{"content-type":"application/json"}};o.ajaxRequest(a),delete O.userEnteredEmailValue}}},spaceNames:{},myAppsStorages:null,onStorageChange:function(){y.setTenant(widget.getValue("collabstorage")),O._has3DPlanAccess()&&O.tasksView&&!O.tasksView._rdfCollection&&(this._initRDFTasksCollection(),O.tasksView&&O.tasksView.destroy(),O.setupTasksView()),f.removeScopeData(),g.onStorageChange.call(O),O.tasksView._detailPanel.updateCommonInitializerLibrary(),this._initDetailsInitializer()},onSpaceChange:function(){g.onSpaceChange.call(O),O.setSpace(),O.tasksView._detailPanel.updateCommonInitializerLibrary()},_loadIndividual3DSpaceTask:function(){var e=O._getTaskIdToOpen();if(!O._taskIdToOpenIsRDF()){O.showLoadingMessage(!0);let t=O.tasks.fetchTaskById(e,{reset:!0,onComplete:function(){var t=O.tasks.get(e);t&&(t.noFilter=!0),O.hideLoadingMessage(),O._afterLoadInvididual3DSpaceTask()},onFailure:function(){O.hideLoadingMessage(),O._onSingleTaskFetchFail()}});(t&&t.noFetch||!t)&&setTimeout(O.hideLoadingMessage,0)}},_afterLoadInvididual3DSpaceTask:function(){if(!O._taskIdToOpenIsRDF()){var e=O._getTaskIdToOpen();O.tasksView?O._selectTaskByIdOnLoad(e):widget.addEventOnce("constantsServiceReturned",(function(){O._selectTaskByIdOnLoad(e)}))}},_load3DSpaceTasks:function(){if(O._getTaskIdToOpen())O._loadIndividual3DSpaceTask();else{var e=!1;if("true"===enoviaServer.preferences.createSampleData&&!enoviaServer.space){var t=Object.keys(g.spaceNames);enoviaServer.space=t.find((e=>e!==m.TSK_PRIVATE_SPACE&&"undefined"!==e&&""!==e)),e=!0}var i=this;O.showLoadingMessage(!0);let s=O.tasks.fetch({server:!0,reset:!0,onComplete:function(){e&&(enoviaServer.space=null,i.tasks.dispatchEvent("onChange:collabSpace",[i.tasks,i.tasks.collabSpace])),O._setAutoRefreshTimeout(),O.hideLoadingMessage()},onFailure:function(t,i){e&&(enoviaServer.space=null);var s=i&&i.error;s&&(O._handleInvalidScope(i),s=!1),O.hideLoadingMessage(),O.tasksView&&O._setAutoRefreshTimeout(),s&&(O._setAutoRefreshTimeout(),O.licenseError=i.error,widget.body.setContent(""),_.initializeAlert(widget.body),_.displayError(i.error))}});s&&s.noFetch&&setTimeout(O.hideLoadingMessage,0)}},_loadIteropTasks:function(){O.showLoadingMessage(!0),O.iteropTasks.fetch({onComplete:function(){O.hideLoadingMessage()},onFailure:function(){O.hideLoadingMessage()}})},_loadSourcingTask:function(){O.showLoadingMessage(!0),O.sourcingTasks.fetch({server:!0,reset:!0,onComplete:function(){O.hideLoadingMessage()},onFailure:function(){O.hideLoadingMessage()}})},_tasksServiceInitCalls:function(){var e=this;0!==O.tasks.collabSpace.length&&this._load3DSpaceTasks(),o.getWidgetConstants("/resources/v2/e6w/service/TSK_WIDGET_CONSTANTS",(function(){var t=W("REFRESH_TIMEOUT");t&&(O.REFRESHTIMEOUT=1e3*parseInt(t,10)),enoviaServer.widgetId=widget.id,O._has3DPlanAccess()&&(e._initRDFTasksCollection(),O._loadRDFTasks()),!O._hasIteropAccess()||O._getTaskIdToOpen()||f.getObjectData()||O._loadIteropTasks(),O._hasSourcingAccess()&&(O._initSourcingTasksCollection(),O._loadSourcingTask()),O.tasksView||(widget.addEvents({onViewChange:O.onViewChange,onUpdateTitle:O.onTitleChange,onUpdateValue:O.onValueChanged}),O.setupTasksView(),O._initEmailPreference.apply(this,arguments)),O.tasksView.setTitleDefaultValue(),O.tasksView.initScope(),O.setWindowHeight(),widget.dispatchEvent("onResize"),O._initPreferencesWithConstants(),widget.dispatchEvent("constantsServiceReturned")}))},onValueChanged:function(e,t){switch(e){case"emailNotify":O.onEmailNotifyChange(e,t);break;case D.COMPLETED_TASK_PREF_NAME:O.onCompletedTasksDisplayPrefChange(e,t)}},setupTasksView:function(){O.tasksView=new p({collection:O.tasks,rdfCollection:O.rdfTasks,iteropCollection:O.iteropTasks,srcCollection:O.sourcingTasks,singleTaskId:O._getTaskIdToOpen(),fetchCount:O._fetchCount}),O.licenseError?delete O.licenseError:(O.tasksView.listenTo(widget,"onResize",(function(){O.setWindowHeight(),O.tasksView.onResize.apply(O.tasksView,arguments)})),O.tasksView.listenTo(widget,"onSearch",(function(e){O.rdfTasks&&O.rdfTasks.setSearch(e),O.tasks.setSearch(e)})),O.tasksView.listenTo(widget,"onResetSearch",(function(){_.isWidgetInSidePanel()||(O.rdfTasks&&O.rdfTasks.resetSearch(),O.tasks.resetSearch())})),widget.body.empty(),O.tasksView.render().inject(widget.body),this._progressBarView=new V,this._progressBarView.render().inject(window.widget.body),_.isWidgetInSidePanel()&&this.pendingTaskToSelectId&&(O.tasksView.selectTaskById(this.pendingTaskToSelectId),this.pendingTaskToSelectId=""))},_initDetailsInitializer:function(){new L({securityContext:window.enoviaServer.space})},_initPreferencesWithConstants:function(){if("0"!==U("hasDPJAccess")){var e=widget.getPreference("showProjectTasks");e.disabled="disabled",widget.addPreference(e)}var t=widget.getPreference("collabspace");t.label=W("emxCollaborativeTasks.Label.Credential"),j(t),widget.addPreference(t);var i=widget.getPreference("collabstorage");i.label=W("emxFoundation.Widget.CollaborativeStorages"),i.disabled=i.options&&1===i.options.length,widget.addPreference(i);var s=widget.getPreference("showProjectTasks");if(s.label=W("emxCollaborativeTasks.Label.ShowProjectTasks"),widget.addPreference(s),y.isOnPremise()){var o=widget.getPreference("emailNotify");o.label=W("emxCollaborativeTasks.Label.EmailNotify"),widget.addPreference(o)}},setSpace:function(){var e=g.getContext().split(".");if(O.tasks.collabSpace=e[e.length-1],O.myAppsStorages&&O.myAppsStorages.find){var t=O.myAppsStorages.find((e=>e.platformId===y.getTenant()));t&&(enoviaServer.storageUrl=t["3DSpace"])}O._tasksServiceInitCalls(),O.tasks.dispatchEvent("onChange:collabSpace",[O.tasks,O.tasks.collabSpace]);var i=this.spaceNames[enoviaServer.storageUrl];i&&w.processSecurityContextData(i),this._initDetailsInitializer()},clearData:function(){g.clearData.call(O)},loadBPS:function(){g.loadBPS.call(O,widget,"false","/resources/v2/e6w/service/TSK_WIDGET_CONSTANTS",{additionalStorage:R.SERVICE_3DPLAN,storageAsTenant:!0})},setTitlePref:Function.prototype,setRowPref:Function.prototype,processStorageChange:function(){g.processStorageChange.apply(O,arguments)},onAfterLoad:Function.prototype,_onSingleTaskFetchFail:function(){_.displayInfo(W("emxCollaborativeTasks.Info.TaskNotFound"))},_selectTaskByIdOnLoad:function(e){-1===O.tasksView.getColumnAndCardIdxFromId(e)[1]?O.tasksView.addEventOnce("afterColChanged",(function(){O.tasksView.selectById(e)})):O.tasksView.selectById(e)},_processSelectedIds:function(){var e;if(widget.getValue("id")||widget.getValue("ids")){var t=(e=widget.getValue("id")||widget.getValue("ids")).indexOf("?");-1!==t&&(e=e.substring(0,t))}else widget.getValue("X3DContentId")&&(e=this._getIdFromCompassSelect());if(e){let t=E.split3dx(e);"3dplan"===t.domain?e=t.id||e:"Project"===t.domain&&(e=t.id.startsWith("b:")?t.id.substring(2):t.id),O._selectedTaskId=e}},_getIdFromCompassSelect:function(){var e=new Set(["Task","Inbox Task","dsplan:Task","Phase","Gate","Milestone"]),t=JSON.parse(widget.getValue("X3DContentId")).data.items[0];let i;if(i=t.objectTaxonomies?new Set(t.objectTaxonomies):new Set([t.objectType]),new Set([...i].filter((function(t){return e.has(t)}))).size)return _.validateObjectTenant(),t.i3dx||t.objectId;_.displayWarning(o.getWidgetConstant("emxCollaborativeTasks.Warning.ObjectNotTask")),widget.deleteValue("X3DContentId")},_handleInvalidScope:function(e,t){var i=!1;return e&&400===e.statusCode&&e.error&&e.error.indexOf("Invalid Business Object")>=0&&(i=!0,f.setScopeToInvalid(!0),t?f.removeUserScopeData():f.removeScopeData(),O.setSpace()),i}},O.onAfterLoad=O.setSpace,O.REFRESHTIMEOUT=0,O.PENDINGFETCH=!1,O.MAXFETCHCOUNT=1e3,O.document=document,O.checkVisibilityAPI(),O}));