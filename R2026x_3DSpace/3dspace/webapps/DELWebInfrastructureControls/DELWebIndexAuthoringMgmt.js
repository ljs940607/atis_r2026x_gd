define("DS/DELWebInfrastructureControls/DELWebIndexAuthoringMgmt",["DS/DELWebInfrastructureControls/UWAUtils","UWA/Class","DS/DELWebInfrastructureControls/DELWebAjaxModel","undefined"!=typeof window?"i18n!DS/DELWebInfrastructureControls/assets/nls/DELWebInfrastructureControls":""],(function(e,t,a,i){"use strict";var n=null,r=null,s=6e5,o=null,l=null,c=!1;i||(i={get:function(e){return e}});var d=t.singleton({init:function(){var e=self.widget?self.widget.getPreference("navigateOnIndex"):null;if(e||(e={name:"navigateOnIndex",label:"Navigate on",type:"list",options:[{value:"Index",label:"Index"},{value:"Database",label:"Database"}],value:"Index"},self.widget&&self.widget.addPreference(e)),n=e.value||"Index",a.publishEvent("DELWebIndexAuthoringMgmt.queryType",{value:n}),"Index"===n){var t=self.widget?self.widget.getPreference("navigateOnDatabaseStart"):null;if(t&&t.value&&!isNaN(t.value))r=t.value;else if(self.widget&&self.widget.standalone&&self.Foe&&self.Foe.Model&&self.Foe.Model.Session){var i=self.Foe.Model.Session.get("navigateOnDatabaseStart");i&&(t={name:"navigateOnDatabaseStart",label:"Navigate on Database Start",type:"hidden",value:r=parseInt(i)},self.widget.addPreference(t),self.widget.setValue("navigateOnDatabaseStart",r),a.publishEvent("DELWebIndexAuthoringMgmt.navigateOnDatabaseStart",{startTime:r}))}}},setDatabase:function(){if(n="Database",!self.widget||"Database"!==self.widget.getValue("navigateOnIndex")){r=(new Date).getTime();var e=self.widget?self.widget.getPreference("navigateOnDatabaseStart"):null;e||(e={name:"navigateOnDatabaseStart",label:"Navigate on Database Start",type:"hidden",value:r},self.widget&&self.widget.addPreference(e)),self.widget&&(self.widget.setValue("navigateOnDatabaseStart",r),self.widget.standalone&&self.Foe&&self.Foe.Model&&self.Foe.Model.Session&&self.Foe.Model.Session.set("navigateOnDatabaseStart",r,!0)),a.publishEvent("DELWebIndexAuthoringMgmt.queryType",{value:n}),a.publishEvent("DELWebIndexAuthoringMgmt.navigateOnDatabaseStart",{startTime:r}),this._updateIndexedTimestamp()}},setIndex:function(){n="Index",a.publishEvent("DELWebIndexAuthoringMgmt.queryType",{value:n})},isDatabase:function(){n||this.init();var e="Database"===n;if(!e&&r&&(e=(new Date).getTime()-r<=s)&&(n="Database",a.publishEvent("DELWebIndexAuthoringMgmt.queryType",{value:n})),e&&self.widget&&"Database"!==self.widget.getValue("navigateOnIndex"))if(r?(l&&!isNaN(l)&&l>r||(new Date).getTime()-r>s)&&(e=!1):r=(new Date).getTime(),e)if(l){var t=l+1e3;o&&(t+=l-o),(new Date).getTime()>t&&this._updateIndexedTimestamp()}else l||this._updateIndexedTimestamp();else this.setIndex(),r=null,self.widget&&(self.widget.deleteValue("navigateOnDatabaseStart"),self.widget.standalone&&self.Foe&&self.Foe.Model&&self.Foe.Model.Session&&self.Foe.Model.Session.set("navigateOnDatabaseStart",null,!0));return e&&self.widget&&self.widget.getUrl().indexOf("TSK7174741=FORCE")>0?e=!1:!e&&self.widget&&self.widget.getUrl().indexOf("TSK7174741=0")>0&&(e=!0),e},isIndex:function(){return!this.isDatabase()},convertToModelObj:function(t,a){var i=this,n={_objAttributesFromIndex:{}};t&&t.length||(t=i.convertNavigateExpandObj(t));var r=[];if(e.each(t,(function(t,a){if(a&&a.value&&a.name){var s=a.name.substr(a.name.lastIndexOf(":")+1);s=s.substr(s.lastIndexOf(".")+1),n[s]&&(n[s]!==a.value||["v_ctdescription","v_startctdate","v_endctdate"].indexOf(s.toLowerCase())>=0)?Array.isArray(n[s])?(n[s].push(a.value),n._objAttributesFromIndex[s].push(a)):["V_discipline","originated","modified"].indexOf(s)>=0?(n[s]=a.value,n._objAttributesFromIndex[s]=a):(n[s]=[n[s],a.value],n._objAttributesFromIndex[s]=[n._objAttributesFromIndex[s],a]):(n[s]=a.value,n._objAttributesFromIndex[s]=a);var o=s;switch(s.toLowerCase()){case"resourceid":o="physicalid";break;case"identifier":o="PLM_ExternalID";break;case"created":o="originated";break;case"label":case"v_name":o="V_Name";break;case"type":o="plmBaseObjectType";break;case"v_discipline":case"kind":case"ds6w:kind":(!n.V_discipline||n.V_discipline.indexOf(",")>0)&&(o="V_discipline");break;case"ro.delrmicycleexceptionrelation.v_priority":o="V_Priority";break;case"bo.delrmicyclereferenceabstract.v_shiftdata":case"v_shiftdata":o="V_CycleData",a.value=JSON.parse(a.value);break;case"ro.delrmicycleexceptionrelation.v_exceptiondata":case"v_exceptiondata":o="cycleData",a.value=JSON.parse(a.value);break;case"taxonomies":Array.isArray(a.value)?r=r.concat(a.value):"string"==typeof a.value&&a.value.indexOf(",")>0?r=r.concat(a.value.split(",")):r.push(a.value);break;case"ds6wg:closetime.v_startctdate":case"ds6wg:closetime.v_endctdate":case"v_startctdate":case"v_endctdate":case"ro.delrmicyclerelationabstract.v_startdate":case"ro.delrmicyclerelationabstract.v_enddate":case"v_startdate":case"v_enddate":new RegExp("(00|[0-9]|1[0-9]|2[0-3]):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9])Z").test(a.value)||(a.value+="Z"),o=i.convertSearchPredicateToAttr(a.name);break;default:o=i.convertSearchPredicateToAttr(a.name)}o!==s&&(n[o]=a.value,n._objAttributesFromIndex[o]=a)}else e.log("DELWebIndexAuthoringMgmt::_convertToModelObj - invalid attribute at idxAttribute = "+t)})),n.physicalid&&n.type){var s="businessobject";(n.from||n.to)&&(s="connection"),n.OXID="["+n.physicalid+","+n.type+","+s+"]"}if(r&&r.length){n.interfaces||(n.interfaces=[]);for(var o=r.length,l=0;l<o;l++){var c=r[l];if(c&&c.indexOf("interfaces/")>=0){var d=c.replace("interfaces/","").split("/");n.interfaces.push(d.reverse())}}}return a&&(n=i._convertToPublicModelObj(n)),n},_convertToPublicModelObj:function(t){t.physicalid&&Array.isArray(t.physicalid)&&t.resourceid&&(t.physicalid=t.resourceid),e.each({PLM_ExternalID:"name",V_Name:"title",V_description:"description",physicalid:"id",plmBaseObjectType:"type",current:"state","to.physicalid":"ReferencePhysicalid","from.physicalid":"ParentPhysicalid",ReferencePhysicalid:"reference",V_SequencingMode:"sequencingMode",V_Delay:"delay",V_DelayMode:"delayMode",V_DependencyType:"dependencyType",V_OptionalTimeConstraint:"isOptional",V_ResourceConstraint:"resourceConstraint",V_MaterialNeed:"isProductFlow",V_CapableRscGroupIndex:"capableRscGroupIndex",V_IsPreferred:"isPreferred",V_IsReservedFromFirstStep:"isReservedFromFirstStep",V_ManuallyScheduled:"manuallyScheduled",V_Priority:"priority",V_ResourcesQuantity:"resourcesQuantity",V_ToolChangeoverTime:"toolChangeoverTime"},(function(e,a){e&&a&&t[e]&&!t[a]&&(t[a]=t[e])})),t.isProductFlow&&"string"==typeof t.isProductFlow&&(t.isProductFlow="TRUE"===t.isProductFlow.toUpperCase());var a=new RegExp("([0-9][0-9][0-9][0-9])-([0-1][0-9])-([0-3][0-9])T(00|[0-9]|1[0-9]|2[0-3]):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9])Z");return e.each(["modified","created"],(function(e,i){if(t[i]&&!a.test(t[i].value)){var n=t[i];n.indexOf("T")>0&&(n=n.replace("T","@")),n.indexOf(".000Z")>0?n=n.replace(".000Z",":GMT"):n.endsWith("Z")&&(n=n.replace("Z",":GMT")),n.indexOf("-")>0&&(n=n.replaceAll("-","/")),t[i]=new Date(n).toUTCString()}})),t},convertNavigateExpandObj:function(e){for(var t=[],a=Object.keys(e),i=a.length,n=0;n<i;n++)t.push({name:a[n],value:e[a[n]]});return t},convertSearchPredicateToAttr:function(t){var a=t,i=t.substr(t.indexOf("/")+1);return e.each(this._knownSearchPredicate,(function(e,n){Array.isArray(n)?n.forEach((function(n){t!==n&&i!==n||(a=e)})):t!==n&&i!==n||(a=e)})),a},convertAttrToSearchPredicate:function(e){return this._knownSearchPredicate[e]||null},_knownSearchPredicate:{label:"ds6w:label",revision:"ds6wg:revision",kind:"ds6w:kind",taxonomies:"taxonomies",apsData:"bo.DELLmiAPSInternalInfo.V_APSData",workingMode:"ds6wg:DELCapacityRscAbstract.V_CapacityRscType",originated:"originated",modified:"modified",policy:"ds6w:policy",current:"current",owner:"owner",organization:"organization",project:"project",vault:"vault",reservedBy:"reserved",ReferencePhysicalid:"to.physicalid",ParentPhysicalid:"from.physicalid",V_Priority:"ro.delrmicyclerelation.V_Priority",StartDateTime:"ds6wg:delrmicyclerelationabstract.v_startdate",EndDateTime:"ds6wg:delrmicyclerelationabstract.v_enddate",RepoPrivilege:"bo.RepoPrivilege",StreamDescriptors:"bo.StreamDescriptors",C_updatestamp:"bo.PLMEntity.C_updatestamp",V_Name:"bo.PLMEntity.V_Name",V_isUptodate:"bo.PLMEntity.V_isUptodate",PLM_ExternalID:"bo.PLMEntity.PLM_ExternalID",code:"bo.PLMEntity.PLM_ExternalID",V_description:"bo.PLMEntity.V_description",description:"bo.PLMEntity.V_description",V_discipline:"bo.PLMEntity.V_discipline",discipline:"bo.PLMEntity.V_discipline",V_usage:"bo.PLMEntity.V_usage",V_nature:"bo.PLMEntity.V_nature",V_CustoDiscipline:"bo.PLMEntity.V_CustoDiscipline",V_sec_level:"bo.PLMEntity.V_sec_level",workspaceid:"bo.PLMEntity.workspaceid",V_hasConfigContext:"bo.PLMReference.V_hasConfigContext",V_ApplicabilityDate:"bo.PLMReference.V_ApplicabilityDate",V_order:"bo.PLMReference.V_order",V_isVPLMControlled:"bo.PLMReference.V_isVPLMControlled",V_EffectivityKind:"bo.PLMReference.V_EffectivityKind",V_VersionID:"bo.PLMReference.V_VersionID",V_AuthorityControl:"bo.PLMReference.V_AuthorityControl",V_DerivedFrom:"bo.PLMReference.V_DerivedFrom",V_fromExternalID:"bo.PLMReference.V_fromExternalID",V_versionComment:"bo.PLMReference.V_versionComment",V_ProjectApplicability:"bo.PLMReference.V_ProjectApplicability",V_isTerminal:"bo.PLMCoreReference.V_isTerminal",V_ChangeHistory:"bo.PLMCoreReference.V_ChangeHistory",V_hasInstanciationDefinition:"bo.LPAbstractReference.V_hasInstanciationDefinition",V_hasPGPRep:"bo.LPAbstractReference.V_hasPGPRep",V_Scale:"bo.LPAbstractReference.V_Scale",V_IsManufacturable:"bo.VPMReference.V_IsManufacturable",V_CalculatedCycleTime:"bo.Resource.V_CalculatedCycleTime",V_Category:"bo.Resource.V_Category",V_ConsumableCost:"bo.Resource.V_ConsumableCost",V_CycleTime:"bo.Resource.V_CycleTime",V_EnergyCost:"bo.Resource.V_EnergyCost",V_MTBF:"bo.Resource.V_MTBF",V_MTTR:"bo.Resource.V_MTTR",V_MaintenanceCost:"bo.Resource.V_MaintenanceCost",V_Manufacturer:"bo.Resource.V_Manufacturer",V_PurchaseCost:"bo.Resource.V_PurchaseCost",V_RepairCost:"bo.Resource.V_RepairCost",V_SetUpTime:"bo.Resource.V_SetUpTime",V_SetUpTimeReduced:"bo.Resource.V_SetUpTimeReduced",V_TargetCost:"bo.Resource.V_TargetCost",V_TargetedCycleTime:"bo.Resource.V_TargetedCycleTime",V_SubType:"bo.Resource.V_SubType",V_DELRmi_ApproachReach:"bo.Robot.V_DELRmi_ApproachReach",V_DELRmi_ControllerVersion:"bo.Robot.V_DELRmi_ControllerVersion",V_DELRmi_IndustrialApplications:"bo.Robot.V_DELRmi_IndustrialApplications",V_DELRmi_KinematicClass:"bo.Robot.V_DELRmi_KinematicClass",V_DELRmi_MaxPayload:"bo.Robot.V_DELRmi_MaxPayload",V_DELRmi_MountingMethod:"bo.Robot.V_DELRmi_MountingMethod",V_DELRmi_NbDOFs:"bo.Robot.V_DELRmi_NbDOFs",V_DELRmi_Repeatability:"bo.Robot.V_DELRmi_Repeatability",V_DELRmi_RobotModelIDAliases:"bo.Robot.V_DELRmi_RobotModelIDAliases",V_IsFiniteCapacity:"ds6wg:WorkCenter.V_IsFiniteCapacity",isFiniteCapacity:"ds6wg:WorkCenter.V_IsFiniteCapacity",V_SequenceBackward:"ds6wg:WorkCenter.V_SequenceBackward",V_FollowupType:"ds6wg:WorkCenter.V_FollowupType",V_PartNumber:"bo.EnterpriseExtension.V_PartNumber",V_SerialNumber:"bo.DELSerialNumber.V_SerialNumber",V_CapacityRscType:"ds6wg:delcapacityrscabstract.v_capacityrsctype",V_MinCapacity:["ds6wg:delcapacityrscweight.v_mincapacity","ds6wg:delcapacityrsceach.v_mincapacity","ds6wg:delcapacityrscarea.v_mincapacity","ds6wg:delcapacityrsclength.v_mincapacity","ds6wg:delcapacityrscvolume.v_mincapacity"],V_MaxCapacity:["ds6wg:delcapacityrscweight.v_maxcapacity","ds6wg:delcapacityrsceach.v_maxcapacity","ds6wg:delcapacityrscarea.v_maxcapacity","ds6wg:delcapacityrsclength.v_maxcapacity","ds6wg:delcapacityrscvolume.v_maxcapacity"],V_SequencingMode:"ds6wg:DELLmiPPRSystemReference.V_SequencingMode",V_SerialNumberRequired:"ds6wg:DELAsmUnitRefRequired.V_SerialNumberRequired",V_Delay:"bo.DELLmiTimeConstraintCnx.V_Delay",V_DelayMode:"bo.DELLmiTimeConstraintCnx.V_DelayMode",V_DependencyType:"bo.DELLmiTimeConstraintCnx.V_DependencyType",V_OptionalTimeConstraint:"bo.DELLmiTimeConstraintCnx.V_OptionalTimeConstraint",V_ResourceConstraint:"bo.DELLmiTimeConstraintCnx.V_ResourceConstraint",V_MaterialNeed:"bo.DELLmiTimeConstraintCnx.V_MaterialNeed"},_updateIndexedTimestamp:function(){c||(c=!0,a.getServiceUrl({serviceName:"3DSpace"}).then((function(t){if(t&&"string"==typeof t){var n={select_service:["FTS","EXPAND"]};n=JSON.stringify(n);var r=self.widget?self.widget.getValue("collabSpace"):null;if(!r){var d=self.widget?self.widget.getPreference("pad_security_ctx"):null;r=d&&d.value?d.value:"preferred"}r&&0===r.indexOf("ctx::")&&(r=r.substring(5));var u=t+"/cvservlet/indexingdate?SecurityContext="+encodeURIComponent(r);a.callAuthenticatedRequest(u,"json","POST",n).then((function(t){var i=s+(new Date).getTime();t&&e.Object.isPlainObject(t)&&!e.Object.isEmptyObject(t)&&(e.each(t,(function(e,t){t&&t.allvaultsacl&&!isNaN(t.allvaultsacl)&&1e3*t.allvaultsacl<i&&(i=1e3*t.allvaultsacl)})),l&&l!==i&&(o=l),l=i,a.publishEvent("DELWebIndexAuthoringMgmt.databaseIndexedTS",{timestamp:l})),c=!1}),(function(t){var a=i.get("Error");t&&t.message?(a=t.message,t.stack&&(e.log(t.message),e.log(t.stack))):"string"==typeof t&&(a=t),e.log(a),c=!1}))}else e.log("invalid 3DSearch URL")})))}});if(a.useFixtures()){self.Configuration&&self.Configuration.fixtureDelay&&(self.can.fixture.delay=self.Configuration.fixtureDelay);var u=self.Configuration&&self.Configuration.webroot?self.Configuration.webroot:".";self.Fam&&self.Fam.Model&&self.Fam.Model.Platform&&self.Fam.Model.Platform.webroot&&(u=self.Fam.Model.Platform.webroot),a.addFixture({type:"POST",url:u+"/cvservlet/indexingdate"},(function(t){var a=self.$.get("../DELWebInfrastructureUI.tst/fixtures/CVServlet_indexingdate.json",(function(i){if(self.widget&&(e.String.contains(self.widget.getUrl(),"TSK7174741=FORCE")||!e.String.contains(self.widget.getUrl(),"TSK7174741=0")&&e.String.contains(self.widget.getUrl(),"ODTRunning=1")))e.each(i,(function(e,t){t&&t.allvaultsacl&&(t.allvaultsacl=parseInt((new Date).getTime()/1e3)-1)}));else{var n=self.widget?self.widget.getPreference("navigateOnIndex"):null;if(n&&"Index"===n.value){var r=self.widget?self.widget.getPreference("navigateOnDatabaseStart"):null;r&&r.value&&!isNaN(r.value)&&parseInt(r.value/1e3)+5<=(new Date).getTime()&&(i={fixture:{allvaultsacl:parseInt(r.value/1e3)+5}})}}a.responseText=JSON.stringify(i),t.complete(a,a.statusText)}))}))}return d}));