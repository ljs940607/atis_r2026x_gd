window.define&&define("DS/DELWebInfrastructureControls/DELWebSearchUtils",["DS/DELWebInfrastructureControls/UWAUtils","UWA/Class","UWA/Promise","DS/DELWebInfrastructureControls/DELWebAjaxModel"],(function(e,r,t,i){"use strict";return r.singleton({getUnifiedSearchUnserializedDataFromDrop:function(r){var t=this,i=r.originalEvent||r,a=[];if(!e.is(i))return e.log("ERROR: No dropped item found"),a;for(var n,s=null,o=e.is(i.dataTransfer.types.indexOf,"function")?"indexOf":"contains",c="",d=["text/searchitems","text/plain","Text"],u=0;u<d.length&&""===c;u++){var l=i.dataTransfer.types[o](d[u]);(e.is(l,"number")&&l>=0||e.is(l,"boolean")&&!0===l)&&(c=d[u])}if(""===c)return e.log("ERROR: No data retrieved"),a;n=i.dataTransfer.getData(c);try{s=e.Json.decode(n)}catch(e){return a}return e.is(s)?e.is(s.data)?(e.String.contains(window.widget.getUrl(),"TSK5358265=0")||("source"in s&&"X3DSEAR_AP"!==s.source&&t.isDataStructureSameAsSearch&&t.isDataStructureSameAsSearch(s)?(window.OpenAjax&&"dataSource"in s&&"index"!==s.dataSource&&window.OpenAjax.hub.publish("UnifiedSearch.Results.setAuthoring",{}),s.source="X3DSEAR_AP"):!("source"in s)&&t.isDataStructureSameAsSearch&&t.isDataStructureSameAsSearch(s)&&(s.source="X3DSEAR_AP")),s):(e.log("ERROR: No data retrieved"),a):(e.log("ERROR: Parsing returned null"),a)},isDataStructureSameAsSearch:function(r){return e.Object.isPlainObject(r)&&"3DXContent"===r.protocol&&"data"in r&&e.Object.isPlainObject(r.data)&&"items"in r.data&&Array.isArray(r.data.items)&&r.data.items.length>0},getUnifiedSearchUnserializedItemsFromDrop:function(r){if(!r||!r.originalEvent&&!(r||r.originalEvent).dataTransfer)return e.log("DELWebSearchUtils::getUnifiedSearchUnserializedItemsFromDrop - invalid input params!"),null;var t=[],i=null;try{i=this.getUnifiedSearchUnserializedDataFromDrop(r)}catch(e){return t}return e.is(i)?"X3DSEAR_AP"!==i.source?(e.log("DELWebSearchUtils::getUnifiedSearchUnserializedItemsFromDrop - not unified search"),null):e.is(i.data)?e.is(i.data.items,"array")?(i.data.items.length>0&&(t=i.data.items),t):(e.log("ERROR: Items is not an array"),t):(e.log("ERROR: No data retrieved"),t):(e.log("ERROR: Parsing returned null"),t)},getUnifiedSearchObjectsFromDrop:function(r){var a=this;return new t((function(t,n){if(!r||!r.ev)return e.log("DELWebSearchUtils::getUnifiedSearchObjects - invalid input params!"),n(new Error("DELWebSearchUtils::getUnifiedSearchObjects - invalid input params!")),!1;var s=r.ev,o=a.getUnifiedSearchUnserializedItemsFromDrop(s);if(o&&o.length){for(var c={Minimum:"false",QueryList:[]},d={},u=["DELLmiWorkPlanSystemReference","DELLmiHeaderOperationReference","DELLmiChangeOverOperationReference","DELLmiProductionPlanReference","DELRmiShiftReference","DELRmiCycleReference"],l=0;l<o.length;l++){var f=o[l];if((!f.serviceId||"3DSpace"===f.serviceId)&&f.objectId&&f.objectType&&u.indexOf(f.objectType)<0&&!f.taxonomies){var S={physicalid:f.objectId,Depth:0};c.QueryList.push(S)}else if(f.objectId){var h=Object.assign({name:f.displayName,type:f.objectType,id:f.objectId},f);d[f.objectId]=h}}if(c.QueryList.length>0)return i.getTree(c).then((function(r){e.each(r,(function(e,r){d[e]=r})),t(d)}),n);t(d)}else n(o?new Error("Invalid Parameters!"):new Error("Unknown source type"))}))}})}));