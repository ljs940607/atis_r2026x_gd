window.define&&define("DS/DELWebInfrastructureControls/DELWebPointCloudAssociation/DELWebPointCloudAssociationModel",["DS/DELWebInfrastructureControls/UWAUtils","UWA/Class","UWA/Promise","DS/DELWebInfrastructureControls/DELWebIndexAuthoringMgmt","DS/DELWebInfrastructureControls/DELWebAjaxModel"],(function(e,t,i,r,s){"use strict";var n={},o=window.Configuration&&window.Configuration.webroot?window.Configuration.webroot:".";window.Fam&&window.Fam.Model&&window.Fam.Model.Platform&&window.Fam.Model.Platform.webroot&&(o=window.Fam.Model.Platform.webroot);var c=t.singleton({init:function(){n=s.getCacheObject()},get3DSearchString:function(){return"flattenedtaxonomies:types/R2V_FeatureOfInterest OR flattenedtaxonomies:types/R2V_FeatureState OR flattenedtaxonomies:types/R2V_State"},getPointCloudAssociationForResource:function(t){var r=this;return new i((function(i,o){if(t&&(t.physicalid||t.QueryList)){var c={};if(t.QueryList){var a=!0;if(n.point_cloud_assoc&&!t.blnForceRefresh?e.each(t.QueryList,(function(e,t){return(a=t&&t.physicalid&&n.point_cloud_assoc[t.physicalid])&&(c[t.physicalid]=n.point_cloud_assoc[t.physicalid]),!!a})):a=!1,a)return void i(e.clone(c))}else if(n.point_cloud_assoc&&!t.blnForceRefresh&&n.point_cloud_assoc[t.physicalid]&&!e.Object.isEmptyObject(n.point_cloud_assoc[t.physicalid]))return c[t.physicalid]=n.point_cloud_assoc[t.physicalid],void i(e.clone(c));s.getServiceUrl({serviceName:"3DSpace"}).then((function(c){if(c&&"string"==typeof c){var a={};if(t.physicalid)a.target_physicalid=t.physicalid;else if(t.QueryList){var d=[];e.each(t.QueryList,(function(e,t){t&&(t.physicalid?d.push({physicalid:t.physicalid}):d.push(t))})),a.target_QueryList=JSON.stringify(d)}var l=c+"/resources/DELWebInfrastructureLite/v0/R2VAssociation";s.callAuthenticatedRequest(l,"json","GET",a).then((function(c){if(c){var a=s.commonAjaxJsonResponseOK(c,o);if(!a)return a;n.point_cloud_assoc||(n.point_cloud_assoc={});var d=c.Data||{};s.useFixtures()&&n.point_cloud_assoc[t.physicalid]&&!t.blnForceRefresh?d[t.physicalid]=n.point_cloud_assoc[t.physicalid]:t.blnForceRefresh&&n.point_cloud_assoc[t.physicalid]&&delete n.point_cloud_assoc[t.physicalid],t.physicalid&&!n.point_cloud_assoc[t.physicalid]&&(n.point_cloud_assoc[t.physicalid]={});var l={};e.each(d,(function(i,o){var c=null,a=null;s.useFixtures()&&!t.QueryList&&(i=t.physicalid),e.each(o,(function(e,t){if("VPMPointCloudRepReference"===t.plmObjectType){var i=t.VPMPointCloudIdentifierExt["ds6w:i3dx"];!i&&t.VPMPointCloudIdentifierExt&&t.VPMPointCloudIdentifierExt.objectId&&t.VPMPointCloudIdentifierExt.objectId.indexOf(":")>0&&(i=t.VPMPointCloudIdentifierExt.objectId),i&&t.VPMPointCloudIdentifierExt&&!t.serviceId?t["V_PointCloudIdentifier.serviceId"]=i.substring(i.indexOf(":")+1,i.indexOf("!")):t.serviceId||(t.serviceId="r2vsurvey"),i&&t.VPMPointCloudIdentifierExt&&t.VPMPointCloudIdentifierExt["ds6w:i3dx"]&&!t.objectId&&(t["V_PointCloudIdentifier.objectId"]=i),c=t}else a=t})),r._cacheR2VAssociation(i,c,a),l[i]=n.point_cloud_assoc[i]})),i(e.clone(l))}else o(new Error("invalid server response"))}),o)}else o(new Error("invalid 3DSpace URL"))}),o)}else o(new Error("invalid parameters"))}))},createPointCloudAssociationForResource:function(t){var r=this;return new i((function(i,o){t&&(t.target_physicalid||t.targetResource)&&t["V_PointCloudIdentifier.serviceId"]&&t["V_PointCloudIdentifier.objectId"]?s.getServiceUrl({serviceName:"3DSpace"}).then((function(c){if(c&&"string"==typeof c){var a=e.clone(t);t.physicalid&&!a.target_physicalid&&(a.target_physicalid=t.physicalid);var d=a.target_physicalid,l=c+"/resources/DELWebInfrastructureLite/v0/R2VAssociation";s.callAuthenticatedRequest(l,"json","POST",a).then((function(t){if(t){var c=s.commonAjaxJsonResponseOK(t,o);if(!c)return c;n.point_cloud_assoc||(n.point_cloud_assoc={});var a=t.Data||{};d&&!n.point_cloud_assoc[d]&&(n.point_cloud_assoc[d]={});var l={},u=null,f=null;e.each(a,(function(e,t){if("VPMPointCloudRepReference"===t.plmObjectType){var i=t.VPMPointCloudIdentifierExt["ds6w:i3dx"];!i&&t.VPMPointCloudIdentifierExt&&t.VPMPointCloudIdentifierExt.objectId&&t.VPMPointCloudIdentifierExt.objectId.indexOf(":")>0&&(i=t.VPMPointCloudIdentifierExt.objectId),i&&t.VPMPointCloudIdentifierExt&&!t.serviceId?t["V_PointCloudIdentifier.serviceId"]=i.substring(i.indexOf(":")+1,i.indexOf("!")):t.serviceId||(t.serviceId="r2vsurvey"),i&&t.VPMPointCloudIdentifierExt&&t.VPMPointCloudIdentifierExt["ds6w:i3dx"]&&!t.objectId&&(t["V_PointCloudIdentifier.objectId"]=i),u=t}else f=t})),r._cacheR2VAssociation(d,u,f),l[d]=n.point_cloud_assoc[d],s.publishEvent("PointCloudAssociation.created",Object.assign({},l)),i(e.clone(l))}else o(new Error("invalid server response"))}),o)}else o(new Error("invalid 3DSpace URL"))}),o):o(new Error("invalid parameters"))}))},getStateOrFOIInfoForR2VObjects:function(t){var r=this;return new i((function(i,o){var c=t.serviceId,a=t.ids;if(c||(t.serviceId="r2vsurvey",c="r2vsurvey"),a){var d={};if(t.ids&&t.ids.length>0){var l=[],u=[];if(t.blnForceRefresh?e.each(t.ids,(function(e,i){i&&(i.indexOf("-")<0||i.indexOf("!")<0||i.indexOf(":")<0)?l=t.ids:u=t.ids})):e.each(t.ids,(function(e,t){n&&n.cslId2PhysicalID&&n.cslId2PhysicalID[t]&&(t=n.cslId2PhysicalID[t]);var i=r._getR2VFOIFromCache(t);if(i)d[t]=i;else{var s=r._getR2VStateFromCache(t);s?d[t]=s:t&&(t.indexOf("-")<0||t.indexOf("!")<0||t.indexOf(":")<0)&&l.push(t)}t&&(t.indexOf("-")>=0||t.indexOf("!")>=0||t.indexOf(":")>=0)&&u.push(t)})),0===l.length&&0===u.length)return void i(e.clone(d));if(u.length>0)return r.getPhysicalIDForCslID(u).then((function(e){return t.cslids=u,t.ids=e,r.getStateOrFOIInfoForR2VObjects(t).then(i,o)}),o);var f={ids:l,serviceId:t.serviceId};r.fetchFOIInfo(f).then((function(s){if(e.each(s,(function(e,t){d[e]=t;var i=l.indexOf(e);l.splice(i,1)})),0!==l.length){var n={ids:l,serviceId:t.serviceId};r.fetchLocationStateInfo(n).then((function(s){if(e.each(s,(function(e,t){d[e]=t;var i=l.indexOf(e);l=l.splice(i,1)})),0!==l.length){var n={ids:l,serviceId:t.serviceId,useOldFetch:!0};r.fetchLocationStateInfo(n).then((function(t){e.each(t,(function(e,t){d[e]=t;var i=l.indexOf(e);l=l.splice(i,1)})),0!==l.length&&(d.ERROR="Could not find "+l.length+" object(s)"),i(e.clone(d))}))}else i(e.clone(d))}))}else i(e.clone(d))}))}else t.ids&&0===t.ids.length&&t.cslids&&t.cslids.length>0&&s.getServiceUrl({serviceName:"r2vsurvey"}).then((function(r){r&&"string"==typeof r?e.each(t.cslids,(function(t,s){d[s]={invalid_permission_r2vObject:!0},d[s].thumbnail=r+"/common/images/foi/thumbnail.png",i(e.clone(d))})):o(new Error("invalid R2VSurvey URL"))}))}else o(new Error("invalid ids"))}))},getPhysicalIDForCslID:function(t){return new i((function(i,r){var o=t;if(0!==o.length){var a=[],d=0;n.cslId2PhysicalID&&e.each(o,(function(e,t){n.cslId2PhysicalID[t]&&(a.push(n.cslId2PhysicalID[t]),d++),d===o.length&&i(a)}));var l={};s.getServiceUrl({serviceName:"r2vsurvey"}).then((function(e){if(e&&"string"==typeof e){var t=e+"/resources/r2v/modeler/v2/i3dx/fetch";if(s.useFixtures())c._fixture_r2vwebroot&&c._fixture_r2vwebroot!==e&&(t=c._fixture_r2vwebroot+"/resources/r2v/modeler/v2/i3dx/fetch"),t+="?getPhysicalIDForCslID",l.id=o[0];else{var d=o[0];d.indexOf("-")>0&&d.indexOf(":")<0&&(d="i3dx:r2vsurvey!uuid:"+d),l.data=[{"ds6w:i3dx":d}]}var u=JSON.stringify(l);s.callAuthenticatedRequest(t,"json","POST",u).then((function(e){if(e&&e.data){var t=e.data[0].resourceid;n.cslId2PhysicalID||(n.cslId2PhysicalID={}),n.cslId2PhysicalID[o[0]]||(n.cslId2PhysicalID[o[0]]=t),n.physicalid2cslId||(n.physicalid2cslId={}),n.physicalid2cslId[t]||(n.physicalid2cslId[t]=o[0]),a.push(t),i(a)}else r(new Error("invalid server response"))}),(function(e){e.message.indexOf(o[0])>=0?i([]):r()}))}else r(new Error("invalid R2VSurvey URL"))}),r)}else r(new Error("invalid cslId"))}))},fetchFOIInfo:function(t){var r=this;return new i((function(i,o){var a=t.serviceId,d=t.ids;if(a&&"r2vsurvey"===a)if(d){var l={};if(t.ids){var u=!0;if(t.blnForceRefresh?u=!1:e.each(t.ids,(function(e,t){n&&n.cslId2PhysicalID&&n.cslId2PhysicalID[t]&&(t=n.cslId2PhysicalID[t]);var i=r._getR2VFOIFromCache(t);i?l[t]=i:u=!1})),u)return void i(e.clone(l));s.getServiceUrl({serviceName:"r2vsurvey"}).then((function(n){if(n&&"string"==typeof n){var a={ids:t.ids},d=JSON.stringify(a),l=n+"/resources/r2v/modeler/v2/featureofinterest/fetch";s.useFixtures()&&c._fixture_r2vwebroot&&c._fixture_r2vwebroot!==n&&(l=c._fixture_r2vwebroot+"/resources/r2v/modeler/v2/featureofinterest/fetch"),s.callAuthenticatedRequest(l,"json","POST",d).then((function(t){if(t&&t.result){var s=t.result||[],n={};e.each(s,(function(t,i){if(e.String.contains(i["ds6w:type"],"Interest")){var s=r._cacheR2VFOI(i);n[s.id]=s}})),i(e.clone(n))}else o(new Error("invalid server response"))}),o)}else o(new Error("invalid R2VSurvey URL"))}),o)}}else o(new Error("invalid ids"));else o(new Error("invalid serviceId"))}))},getLocationStatesForFOI:function(t){var r=this;return new i((function(i,n){var o=t.serviceId,a=t.id;if(o&&"r2vsurvey"===o)if(a){if(t.id){if(!t.blnForceRefresh){var d=r._getStatesForFOIFromCache(t.id)||{};if(!e.Object.isEmptyObject(d))return void i(e.clone(d))}s.getServiceUrl({serviceName:"r2vsurvey"}).then((function(o){if(o&&"string"==typeof o){var a={},d=o+"/resources/r2v/modeler/v2/featureofinterest/"+t.id+"/activities?type=INGEST&type=UPDATE&status=RELEASE";s.useFixtures()&&(d=(c._fixture_r2vwebroot||o)+"/resources/r2v/modeler/v2/featureofinterest/id/activities",a.id=t.id),s.callAuthenticatedRequest(d,"json","GET",a).then((function(s){if(s&&s.result){var o=s.result||[],c={};e.each(o,(function(e,i){var s=r._cacheFOIStates(t.id,i);c[s.id]=s})),i(e.clone(c))}else n(new Error("invalid server response"))}),n)}else n(new Error("invalid R2VSurvey URL"))}),n)}}else n(new Error("invalid id"));else n(new Error("invalid serviceId"))}))},fetchLocationStateInfo:function(t){var r=this;return new i((function(i,n){var o=t.serviceId,a=t.ids;if(o&&"r2vsurvey"===o)if(a){var d={};if(t.ids){var l=!0;if(t.blnForceRefresh?l=!1:e.each(t.ids,(function(e,t){var i=r._getR2VStateFromCache(t);i?d[t]=i:l=!1})),l)return void i(e.clone(d));s.getServiceUrl({serviceName:"r2vsurvey"}).then((function(o){if(o&&"string"==typeof o){var a={ids:t.ids},d=JSON.stringify(a),l=o+"/resources/r2v/modeler/v2/activity/fetch";t.useOldFetch&&(l=o+"/resources/r2v/modeler/v2/activity/fetch"),s.useFixtures()&&c._fixture_r2vwebroot&&c._fixture_r2vwebroot!==o&&(l=c._fixture_r2vwebroot+"/resources/r2v/modeler/v2/activity/fetch"),s.callAuthenticatedRequest(l,"json","POST",d).then((function(t){if(t&&t.result){var s=t.result,o={};e.each(s,(function(e,t){var i=r._cacheR2VState(t);o[i.id]=i})),i(e.clone(o))}else n(new Error("invalid server response"))}),n)}else n(new Error("invalid R2VSurvey URL"))}),n)}}else n(new Error("invalid ids"));else n(new Error("invalid serviceId"))}))},updatePointCloudAssociationForResource:function(t){var r=this;return new i((function(i,o){t&&(t.repReference_physicalid||t.RepReference)&&t["V_PointCloudIdentifier.serviceId"]&&t["V_PointCloudIdentifier.objectId"]?s.getServiceUrl({serviceName:"3DSpace"}).then((function(c){if(c&&"string"==typeof c){var a=e.clone(t);t.physicalid&&!a.repReference_physicalid&&(a.repReference_physicalid=t.physicalid);var d=t.target_physicalid,l=c+"/resources/DELWebInfrastructureLite/v0/R2VAssociation";s.callAuthenticatedRequest(l,"json","PATCH",a).then((function(t){if(t){var c=s.commonAjaxJsonResponseOK(t,o);if(!c)return c;var a=t.Data||{};n.point_cloud_assoc||(n.point_cloud_assoc={});var l={};e.each(a,(function(e,t){!t["V_PointCloudIdentifier.objectId"]&&t.VPMPointCloudIdentifierExt&&(t["V_PointCloudIdentifier.objectId"]=t.VPMPointCloudIdentifierExt["ds6w:i3dx"]||t.VPMPointCloudIdentifierExt.objectId);var i=t["V_PointCloudIdentifier.objectId"];if(t["V_PointCloudIdentifier.serviceId"]||(i.indexOf(":")>0&&i.indexOf("!")>0?t["V_PointCloudIdentifier.serviceId"]=i.substring(i.indexOf(":")+1,i.indexOf("!")):t.VPMPointCloudIdentifierExt&&t.VPMPointCloudIdentifierExt.serviceId?t["V_PointCloudIdentifier.serviceId"]=t.VPMPointCloudIdentifierExt.serviceId:t["V_PointCloudIdentifier.serviceId"]="r2vsurvey"),n.point_cloud_assoc[d]){var s=n.point_cloud_assoc[d],o=s.repReference,c=Object.assign(o,t);d&&r._cacheR2VAssociation(d,c,s.repInstance),l[d]=n.point_cloud_assoc[d]}})),s.publishEvent("PointCloudAssociation.updated",Object.assign({},l)),i(e.clone(l))}else o(new Error("invalid server response"))}),o)}else o(new Error("invalid 3DSpace URL"))}),o):o(new Error("invalid parameters"))}))},deletePointCloudAssociationForResource:function(t){return new i((function(i,r){t&&(t.target_physicalid||t.targetResource)?s.getServiceUrl({serviceName:"3DSpace"}).then((function(o){if(o&&"string"==typeof o){var c=e.clone(t),a=t.target_physicalid||t.targetResource.physicalid,d=o+"/resources/DELWebInfrastructureLite/v0/R2VAssociation";s.callAuthenticatedRequest(d,"json","DELETE",c).then((function(t){if(t){var o=s.commonAjaxJsonResponseOK(t,r);if(!o)return o;var c=t.Data||{},d=[],l=c.SuccessfullyDeleted||{},u=c.FailedDelete||{},f=c.TargetReferenceWithNothingToRemove||{},v=c.RepReferenceAlreadyRemoved||{},p=!1,h={};if(e.Object.isEmptyObject(f)&&e.Object.isEmptyObject(v)||(h={},e.Object.isEmptyObject(f)||h.put("NoAssociationsToDeleteResource",f),e.Object.isEmptyObject(v)||h.put("NoAssociationsToDeleteRepRef",v),d.push({event:"PointCloudAssociation.deleted.error",data:h}),p=!0),e.Object.isEmptyObject(u)||(h={},e.Object.isEmptyObject(u)||h.put("FailedDelete",u),d.push({event:"PointCloudAssociation.deleted.error",data:h}),p=!0),!e.Object.isEmptyObject(l)){n.point_cloud_assoc||(n.point_cloud_assoc={}),a&&n.point_cloud_assoc[a]&&delete n.point_cloud_assoc[a];var I={};I[a]=e.clone(l),d.push({event:"PointCloudAssociation.deleted",data:I})}e.each(d,(function(e,t){s.publishEvent(t.event,t.data)})),p?r(e.clone(c)):i(e.clone(c))}else r(new Error("invalid server response"))}),r)}else r(new Error("invalid 3DSpace URL"))}),r):r(new Error("invalid parameters"))}))},_cacheR2VAssociation:function(t,i,r){n.point_cloud_assoc||(n.point_cloud_assoc={});var s={};i&&(s.repReference=e.clone(i)),r&&(s.repInstance=e.clone(r)),n.point_cloud_assoc[t]=s},_cacheFOIStates:function(t,i){var r=this._cacheR2VState(i);return n.r2v_foi_state_assoc||(n.r2v_foi_state_assoc={}),n.r2v_foi_state_assoc[t]||(n.r2v_foi_state_assoc[t]=[]),n.r2v_foi_state_assoc[t].push(r.id),e.clone(r)},_getStatesForFOIFromCache:function(t){var i=this;if(!n.r2v_foi_state_assoc||!n.r2v_foi_state_assoc[t]||!n.r2v_State)return null;var r=n.r2v_foi_state_assoc[t],s={};return e.each(r,(function(e,t){s[t]=i._getR2VStateFromCache(t)})),s},_cacheR2VFOI:function(t){n.r2v_FOI||(n.r2v_FOI={});var i=e.clone(t);return!i.id&&i.resourceid&&(i.id=i.resourceid),!i.name&&i["ds6w:label"]&&(i.name=i["ds6w:label"]),!i.description&&i["ds6w:description"]&&(i.description=i["ds6w:description"]),!i.type&&i["ds6w:type"]&&(i.type=i["ds6w:type"]),n.r2v_FOI[i.id]=e.clone(i),i&&i.cslId&&!n.r2v_FOI[i.cslId]&&(n.r2v_FOI[i.cslId]=n.r2v_FOI[i.id]),i&&i.cslId&&(i.indexOf("-")>=0||i.indexOf("!")>=0||i.indexOf(":")>=0)&&(n.cslId2PhysicalID||(n.cslId2PhysicalID={}),n.cslId2PhysicalID[i.cslId]||(n.cslId2PhysicalID[i.cslId]=i.id),n.physicalid2cslId||(n.physicalid2cslId={}),n.physicalid2cslId[i.id]||(n.physicalid2cslId[i.id]=i.cslId)),e.clone(i)},_getR2VFOIFromCache:function(t){if(t&&(t.indexOf("-")>=0||t.indexOf("!")>=0||t.indexOf(":")>=0)){if(n.r2v_FOI&&n.r2v_FOI[t])return n.r2v_FOI[t];e.each(n.r2v_FOI,(function(e,i){if(i.cslId===t&&i.resourceid&&i.resourceid===e)return n.r2v_FOI[e]}))}else if(n.r2v_FOI&&n.r2v_FOI[t])return n.r2v_FOI[t];return null},_cacheR2VState:function(t){n.r2v_State||(n.r2v_State={});var i=e.clone(t);return!i.id&&i.resourceid&&(i.id=i.resourceid),!i.name&&i["ds6w:label"]&&(i.name=i["ds6w:label"]),!i.description&&i["ds6w:description"]&&(i.description=i["ds6w:description"]),!i.type&&i["ds6w:type"]&&(i.type=i["ds6w:type"]),n.r2v_State[i.id]=e.clone(i),e.clone(i)},_getR2VStateFromCache:function(t){if(t&&(t.indexOf("-")>=0||t.indexOf("!")>=0||t.indexOf(":")>=0)){if(n.r2v_State&&n.r2v_State[t])return n.r2v_State[t];e.each(n.r2v_State,(function(e,i){if(i.cslId===t&&i.resourceid&&i.resourceid===e)return n.r2v_State[e]}))}else if(n.r2v_State&&n.r2v_State[t])return n.r2v_State[t];return null},searchForPointCloudData:function(t){var n=this;return new i((function(i,o){t?s.getServiceUrl({serviceName:"3DSearch"}).then((function(c){if(c&&"string"==typeof c){var a="("+n.get3DSearchString()+")";(t.search_str||t.name)&&"*"!==(t.search_str||t.name)&&(a+=" AND ("+(t.search_str||t.name)+")"),!t.tenant&&window.widget.data&&(t.tenant=window.widget.data.x3dPlatformId);var d=window.widget.data.appId||window.widget.id;window.Foe&&window.Foe&&window.Foe.Model&&window.Foe.Model.Session&&(d=window.Foe.Model.Session.get("user"));var l={query:a,label:d+"-DELWebPointCloudAssociationModel.searchForPointCloudData-"+(new Date).getTime(),locale:window.widget.lang,tenant:t.platformId||t.tenant,source:["3dspace","r2vsurvey"],select_predicate:["ds6w:label","ds6w:type","ds6w:description","ds6w:identifier","ds6w:modified","ds6w:created","ds6wg:revision","ds6w:status","ds6w:responsible","owner","ds6w:responsibleUid","ds6wg:filesize","ds6w:project","ds6w:dataSource","ds6w:community","ds6w:repository","dcterms:title","dcterms:description","ds6w:containerUid"],with_synthesis:!1,with_synthesis_attribute:!1};t.endindex&&(l.nresults="startindex"in t?t.endindex-t.startindex:t.endindex),l=window.UWA.Json.encode(l);var u=c+"/search";s.useFixtures()&&(u+="?getPointCloudSearch"),s.callAuthenticatedRequest(u,"json","POST",l).then((function(t){var s={},n=[];t&&t.results&&t.results.length&&(e.each(t.results,(function(e,t){var i=r.convertToModelObj(t.attributes);!i.id&&i.resourceid&&(i.id=i.resourceid),!i.name&&i["ds6w:label"]&&(i.name=i["ds6w:label"]),s[i.id]=i})),n=Object.values(s)),i(n)}),o)}else o(new Error("invalid 3DSearch URL"))})):o(new Error("Invalid input parameters!"))}))}});if(s.useFixtures()){window.Configuration.fixtureDelay&&(window.can.fixture.delay=window.Configuration.fixtureDelay);var a=o;window.Fam&&window.Fam.Model&&window.Fam.Model.Platform&&(a=o+"/enovia"),c._fixture_r2vwebroot=a,s.addFixture({type:"GET",url:o+"/resources/DELWebInfrastructureLite/v0/R2VAssociation"},(function(t){var i=s.request("../DELWebInfrastructureUI.tst/fixtures/getPointCloudAssociation.json",{onComplete:function(r){var s={Data:{}};t&&t.data&&t.data.target_QueryList?(e.each(JSON.parse(t.data.target_QueryList),(function(e,t){n.point_cloud_assoc&&n.point_cloud_assoc[t.physicalid]?s.Data[t.physicalid]=n.point_cloud_assoc[t.physicalid]:r.Data[t.physicalid]?s.Data[t.physicalid]=r.Data[t.physicalid]:s.Data[t.physicalid]={}})),r.Data=s.Data):t&&t.data&&t.data.target_physicalid&&e.each(r.Data,(function(e){e!==t.data.target_physicalid&&(r.Data[e]={})})),i.responseText=JSON.stringify(r),t.complete(i,i.statusText||(i.xhr?i.xhr.statusText:"success"))},type:"json"})})),s.addFixture({type:"POST",url:o+"/resources/DELWebInfrastructureLite/v0/R2VAssociation"},(function(e){var t=s.request("../DELWebInfrastructureUI.tst/fixtures/createPointCloudAssociation.json",{onComplete:function(i){var r=JSON.stringify(i);r=(r=r.replaceAll("16902F5EC75943118C8EB49675AC6DED",e.data.target_physicalid)).replaceAll("objectIdToReplace",e.data["V_PointCloudIdentifier.objectId"]),"V_Name"in e.data&&(r=r.replaceAll("VPMPointCloudRepReference00000001",e.data.V_Name)),"V_description"in e.data&&(r=r.replaceAll("testDescription",e.data.V_description)),t.responseText=r,e.complete(t,t.statusText||(t.xhr?t.xhr.statusText:"success"))},type:"json"})})),s.addFixture({type:"PATCH",url:o+"/resources/DELWebInfrastructureLite/v0/R2VAssociation"},(function(e){var t=s.request("../DELWebInfrastructureUI.tst/fixtures/updatePointCloudAssociation.json",{onComplete:function(i){var r=JSON.stringify(i);r=r.replaceAll("95E49656AB863C0063D1BE00001A0EF9",e.data.repReference_physicalid),"V_Name"in e.data&&(r=r.replaceAll("testName2",e.data.V_Name)),"V_description"in e.data&&(r=r.replaceAll("testDescription2",e.data.V_description)),"V_PointCloudIdentifier.objectId"in e.data&&(r=r.replaceAll("objectId2",e.data["V_PointCloudIdentifier.objectId"])),"V_PointCloudIdentifier.serviceId"in e.data&&(r=r.replaceAll("serviceId2",e.data["V_PointCloudIdentifier.serviceId"])),t.responseText=r,e.complete(t,t.statusText||(t.xhr?t.xhr.statusText:"success"))},type:"json"})})),s.addFixture({type:"DELETE",url:o+"/resources/DELWebInfrastructureLite/v0/R2VAssociation"},(function(e){var t=s.request("../DELWebInfrastructureUI.tst/fixtures/deletePointCloudAssociation.json",{onComplete:function(i){var r=JSON.stringify(i);r=r.replaceAll("95E49656AB863C0063D1BE00001A0EF9",e.data.repReference_physicalid),t.responseText=r,e.complete(t,t.statusText||(t.xhr?t.xhr.statusText:"success"))},type:"json"})})),s.addFixture({type:"POST",url:a+"/resources/r2v/modeler/v2/activity/fetch"},(function(e){var t=s.request("../DELWebInfrastructureUI.tst/fixtures/fetchFeatureStates.json",{onComplete:function(i){t.responseText=JSON.stringify(i),e.complete(t,t.statusText||(t.xhr?t.xhr.statusText:"success"))},type:"json"})})),s.addFixture({type:"POST",url:a+"/resources/r2v/modeler/v2/featureofinterest/fetch"},(function(t){var i=s.request("../DELWebInfrastructureUI.tst/fixtures/fetchFeatureOfInterest.json",{onComplete:function(r){var s=[],n=JSON.parse(t.data).ids;e.each(n,(function(t,i){e.each(r.result,(function(e,t){t.resourceid!==i&&t["ds6w:i3dx"]!==i||s.push(t)}))})),r.result=s,i.responseText=JSON.stringify(r),t.complete(i,i.statusText||(i.xhr?i.xhr.statusText:"success"))},type:"json"})})),s.addFixture({type:"GET",url:a+"/resources/r2v/modeler/v2/featureofinterest/id/activities"},(function(t){var i=s.request("../DELWebInfrastructureUI.tst/fixtures/fetchFeatureStates.json",{onComplete:function(r){var s=[];e.each(r.result,(function(e,i){i.featureOfInterestId===t.data.id&&s.push(i)})),r.result=s,i.responseText=JSON.stringify(r),t.complete(i,i.statusText||(i.xhr?i.xhr.statusText:"success"))},type:"json"})})),s.addFixture({type:"POST",url:o.substr(0,o.lastIndexOf("/"))+"/federated/search?getPointCloudSearch"},(function(e){var t=s.request("../DELWebInfrastructureUI.tst/fixtures/getPointCloudSearchData.json",{onComplete:function(i){t.responseText=JSON.stringify(i),e.complete(t,t.statusText||(t.xhr?t.xhr.statusText:"success"))},type:"json"})})),s.addFixture({type:"POST",url:a+"/resources/r2v/modeler/v2/i3dx/fetch?getPhysicalIDForCslID"},(function(t){var i=s.request("../DELWebInfrastructureUI.tst/fixtures/getPhysicalIDForCslID.json",{onComplete:function(r){var s=JSON.parse(t.data).id;n&&n.r2v_FOI&&e.each(n.r2v_FOI,(function(t,i){i.cslId!==s&&s!==i["ds6w:i3dx"]||e.each(r.data,(function(e,t){t&&t.resourceid&&t.resourceid!==i.resourceid&&(t.resourceid=i.resourceid,t["ds6w:i3dx"]=i["ds6w:i3dx"])}))})),i.responseText=JSON.stringify(r),t.complete(i,i.statusText||(i.xhr?i.xhr.statusText:"success"))},type:"json"})}))}return c}));