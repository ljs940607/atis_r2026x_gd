window.define&&define("DS/DELWebInfrastructureControls/action_bar/pointCloudAssociationCommand",["DS/Core/Core","DS/ApplicationFrame/CommandCheckHeader","DS/DELWebInfrastructureControls/DELWebAjaxModel","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","i18n!DS/DELWebInfrastructureControls/assets/nls/DELWebInfrastructureControls","DS/DELWebInfrastructureControls/DELWebPointCloudAssociation/DELWebRealWorldLocationManagerDlg","DS/Selection/CSOManager"],(function(e,t,n,o,i,a,s,r){"use strict";var l=window.$,c=window.UWA;return t.extend({init:function(e){var t=this;this._parent(e,{}),this.onStateChange((function(){this.getState()&&t._isEnabled&&l('[data-command="'+t._id+'"]').is(":visible")&&l(".DELWebRealWorldLocationManagerDlg-dlg").size()<1&&t.launchPointCloudDialog()})),t.disable(),t.r2vSurveyServiceExists=!1,n.getServiceUrl({serviceName:"r2vsurvey"}).then((function(e){e&&(t.r2vSurveyServiceExists=!0)})),t.setXSO()},setXSO:function(e){var t=this;e||t._xso||(e=r),e&&(t._xso=e,t.setXSOonChangeEvent())},setXSOonChangeEvent:function(){var e=this;e._xso&&(e._xsoTokenChangeSubscribe=e._xso.onChange((function(){1===e._xso.get().length&&e.r2vSurveyServiceExists?e.enable():e.disable()})))},launchPointCloudDialog:function(){var e=this;if(!e._createDlg){var t=this.dialogOptions?c.clone(this.dialogOptions):{};if(!t.dsModel){var n=e._xso.get()[0];t.dsModel=n._options.dsModel}t.closeCallback=function(){e.setState(!1,!1),e.enable(),delete e._createDlg},e._createDlg=new s(t)}delete this.dialogOptions}})}));