define("DS/DELWebInfrastructureControls/DELWebAddExtensionsWidget",["UWA/Controls/Abstract","DS/DELWebInfrastructureControls/UWAUtils","DS/CoreEvents/Events","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/EditPropExtensions/UI/AddExtensionsWidget","DS/DELWebInfrastructureControls/DELWebAddExtensionsWebServices","DS/DELWebInfrastructureControls/DELWebAjaxModel","DS/DELWebInfrastructureControls/DELWebNotifications","i18n!DS/EditPropExtensions/assets/nls/AddExtensionsNLS","i18n!DS/DELWebInfrastructureControls/assets/nls/DELWebInfrastructureControls"],(function(e,t,s,i,n,a,o,r,l,c){"use strict";var h=function(e){if(this.interfaces=[],null!==e){var t=e.results;if(1===t.length)this.interfaces=t[0].interfaces;else if(t.length){for(var s=t[0].interfaces,i=1;i<t.length;i++)s=u(s,t[i].interfaces);this.interfaces=s}if(this.allAttachedInterfaces)for(var n=0;n<this.interfaces.length;){for(var a=0;a<this.allAttachedInterfaces.length;a++)if(this.allAttachedInterfaces[a].name===this.interfaces[n].name){this.interfaces.splice(n,1),n--;break}n++}}return this.interfaces},f=function(e){if(this.attachedInterfaces=[],null!==e){var t=e.results;if(1===t.length)this.attachedInterfaces=t[0].interfaces;else{for(var s=t[0].interfaces,i=1;i<t.length;i++)s=u(s,t[i].interfaces);this.attachedInterfaces=s}}return this.attachedInterfaces},d=function(e){if(this.allAttachedInterfaces=[],null!==e){var t=e.results;if(1===t.length)this.allAttachedInterfaces=t[0].interfaces;else for(var s=0;s<t.length;s++)for(var i=t[s].interfaces,n=0;n<i.length;n++)this.allAttachedInterfaces.push(i[n])}return this.allAttachedInterfaces},u=function(e,t){for(var s=[],i=0;i<e.length;i++)for(var n=e[i].name,a=0;a<t.length;a++)n!==t[a].name||s.push(e[i]);return s},p=function(){this._buildUI()},m=n.extend({init:function(e,t,s,i,n,a,o){return this._init(e,t,s,i,n,a,o)},_init:function(s,n,u,m,b,g,v){t.log("init");var I=this,E=new e(u);for(var S in E)E[S]&&(I[S]=E[S]);this.elements.SC=m;var D=[],C=b.getTenant();this.tenant=C,this.elements.myObject=b,window.Configuration&&(this.URL=window.Configuration.webroot);var y="";if(this.metatype=b.get("metatype"),u.addOnReference&&t.Object.isPlainObject(u.addOnReference)&&u.addOnReference.plmBaseObjectType&&u.addOnReference.physicalid)y="plmBaseObjectType",this.metatype="bus";else{if(u.addOnReference&&!t.Object.isPlainObject(u.addOnReference))return void o.getInstance({physicalid:b.get("objectId")}).then((function(e){if(e&&e.PLMData){var i=null;t.each(e.PLMData,(function(e,t){t&&(t.ReferencePhysicalid||t.ReferenceOXID?i||(i={physicalid:t.ReferencePhysicalid,OXID:t.ReferenceOXID}):i=t)})),i?(u.addOnReference=i,I._init(s,n,u,m,b,g,v)):r.displayNotificationMessage(c.get("Error"))}else r.displayNotificationMessage(c.get("Error"))}),(function(e){r.displayNotificationMessage(e)}));"bus"===b.get("metatype")?y="_DS_ATTR_type":"connection"===b.get("metatype")&&(y="_DS_ATTR_label")}this.setInterfaces=h.bind(this),this.setAttachedInterfaces=f.bind(this),this.setAllAttachedInterfaces=d.bind(this),this.buildUI=p.bind(this),this._initEventHandlers();var A=null;if(u.addOnReference&&t.Object.isPlainObject(u.addOnReference)&&u.addOnReference.physicalid)A=u.addOnReference.physicalid,D[0]=u.addOnReference.plmBaseObjectType,this.setObject(A);else if(b._innerModels){var O=b._innerModels;for(var W in O)if(O[W]&&O[W].get){A=O[W].get("objectId");var L=O[W].get(y);L?D.push(L.valueDB):D[0]=b.get(y).valueDB,this.setObject(A)}}else{if(A=b.get("objectId"),y&&b.get(y)&&b.get(y).valueDB){var M=b.get(y).valueDB;M&&(D[0]="string"==typeof M?M:M[0])}this.setObject(A)}i.getServiceUrl({serviceName:"3DSpace",onComplete:function(e){e.forEach(function(e){void 0===e.url?t.log("url is undefined, skipping "+e.platformId):C===e.platformId&&(this.URL=e.url)}.bind(this)),a.getObjectInterfaces(m,this.tenant,this.URL,this.models,this.metatype,function(e){this.attachedInterfaces=this.setAttachedInterfaces(e),this.allAttachedInterfaces=this.setAllAttachedInterfaces(e),a.getClassInterfaces(m,this.tenant,this.URL,D,this.metatype,function(e){this.interfaces=this.setInterfaces(e),this.buildUI(),t.log("init:onComplete"),this.showDialog(s,g,v)}.bind(this),(function(e){var t=l.get("failMessage")+e;v(t)}),u.jsonClassInterfaces)}.bind(this),(function(e,t){var s=l.get("failMessage")+e;t&&"object"==typeof t&&t.error&&"1002"===t.error.code?require({},["DS/UIKIT/SuperModal"],(function(e){new e({closable:!0,className:"Modals",events:{onHide:function(){g()}}}).alert(l.get("roleNotAllowed"))})):v(s)}),u.jsonClassInterfaces)}.bind(this),onFailure:function(e){t.log(e),v(l.get("urlNotFound"))}}),this.context=u.context},_buildUI:function(){var e=this._parent.apply(this,arguments);if(e.addClassName("DELWebAddExtensionsWidget"),this.options&&"multiSelect"in this.options&&this.autoComplete&&this.autoComplete.options&&(this.autoComplete.options.multiSelect=this.options.multiSelect,!this.options.multiSelect)){var s=this.autoComplete.name;this.autoComplete.elements.container.removeClassName(s+"-multiselect"),this.autoComplete.elements.input.addClassName(s+"-single-select"),!this.autoComplete.elements.clear&&this.autoComplete.elements.inputContainer&&(this.autoComplete.elements.clear=t.createElement("span",{class:s+"-reset fonticon fonticon-clear"}).inject(this.autoComplete.elements.inputContainer)),this.autoComplete.getSelection&&!this.autoComplete._getSelection&&(this.autoComplete._getSelection=this.autoComplete.getSelection,this.autoComplete.getSelection=function(){var e=this,t=e._getSelection();return!t&&e.selectedItems&&1===e.selectedItems.length&&(t=e.selectedItems.slice(0)),t}),this.attachedInterfaces&&this.attachedInterfaces.length>0&&(this.autoComplete.disable(),this.elements.tableExtensions&&this.elements.tableExtensions.closest&&this.elements.tableExtensions.closest(".accordion-item")&&this.elements.tableExtensions.closest(".accordion-item").addClassName("active"))}return e},showDialog:function(){if(this._parent.apply(this,arguments),this.options&&this.mySuperModal&&this.mySuperModal.modals&&this.mySuperModal.modals.current&&this.options.dialogTitle){var e=this.mySuperModal.modals.current.elements.header?this.mySuperModal.modals.current.elements.header.getElement("h4"):null;e&&e.setText(this.options.dialogTitle)}},_initEventHandlers:function(){var e=this;this._eventSubscriptionTokens||(this._eventSubscriptionTokens=[]),t.each(this,(function(i,n){if(n&&t.Function.isFunction(n)&&i.endsWith(" subscribe")){var a=i.replace(" subscribe","").trim(),o=null;(o=e.options&&e.options.modelEvents?e.options.modelEvents.subscribe({event:a},(function(t){n.apply(e,[a,t])})):s.subscribe({event:a},(function(t){n.apply(e,[a,t])})))&&e._eventSubscriptionTokens.push(o)}}))},"DELWebAddExtensionsWebServices.addInterfaces subscribe":function(){r.displayNotificationMessage(c.get("{0} Associated",{0:c.get("Extension")}),{level:"success"})},"DELWebAddExtensionsWebServices.addInterfaces.error subscribe":function(e,t){r.displayNotificationMessage(l.get("failMessage")+t.message)},"DELWebAddExtensionsWebServices.removeInterfaces subscribe":function(){r.displayNotificationMessage(c.get("Unassociation Successful"),{level:"success"})},"DELWebAddExtensionsWebServices.removeInterfaces.error subscribe":function(e,t){r.displayNotificationMessage(l.get("failMessage")+t.message)}});return m}));