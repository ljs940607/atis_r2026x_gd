define("DS/DELWebInfrastructureControls/CommonControllers/i3DXCompass/UWAData",["UWA/Core","DS/DELWebInfrastructureControls/CommonControllers/i3DXCompass/Utils","UWA/Ajax","UWA/Internal/StringMap","UWA/Class/Events"],(function(e,t,n,o,r){"use strict";var s,a,i,u,c,l,p,d=new o,h={proxies:(l=e.hosts,p=l.exposition+"/proxy/",e.merge(l.proxies||{},{ajax:p+"ajax",resolve:p+"resolve",xml:p+"xml",spreadsheet:p+"spreadsheet",soap:p+"soap",feed:p+"feed",icon:p+"icon",richIcon:p+"richIcon",rss:p+"feed"})),useJsonpRequest:!0,allowCrossOriginRequest:!1,useOfflineCache:!1,request:(s=/OPTIONS|GET|HEAD|POST|PUT|DELETE|TRACE|CONNECT/i,a=/json|document|blob|arraybuffer|text/,i=/^([A-Za-z0-9+/]{4})*([A-Za-z0-9+/]{4}|[A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)$/,u=function(e,t){return void 0!==e&&t?(self._online=Boolean(e),setTimeout((function(){delete self._online}),t)):void 0===self._online&&(void 0===navigator.onLine?self._online=!0:self._online=!0===navigator.onLine),self._online},c={text:function(e){return"string"!=typeof e&&(e=JSON.stringify(e)),e},json:function(t){if("string"==typeof t&&(t=JSON.parse(t)),!e.is(t,["object","array"]))throw new Error('Invalid JSON Response: "'+String(t)+'"');return t},xml:function(e){return"string"==typeof e&&(e=t.loadXml(e)),e},document:function(e){return"string"==typeof e&&(e=t.loadHtml(e)),e},blob:function(e,n){var o=t.getOwnPropertyMatchValue(n,"Content-Type")||"text/plain";return"string"==typeof e&&(e=i.test(e)?function(e,t){var n,o,r=";base64,",s=e.indexOf(r)+8,a=e.substring(s),i=window.atob(a),u=i.length,c=new Uint8Array(u);for(n=0;n<u;++n)c[n]=i.charCodeAt(n);return(o=new BlobBuilder).append(c.buffer),o.getBlob(t)}(e,o):new Blob([e],{type:o})),e},arraybuffer:function(e){return"string"==typeof e&&(e=new ArrayBuffer(12)),e}},function(o,l){if(!o)throw new Error("Bad or missing url argument.");l=l||{};var p,d,f,m,y,C,g,x,w,q,v,E,O=window.location,T="ajax",b={timeout:25e3,method:"GET",type:"text",proxy:!1,async:!0,headers:{},useMergeRequest:!0,useOfflineCache:h.useOfflineCache,allowCrossOriginRequest:h.allowCrossOriginRequest,useJsonpRequest:h.useJsonpRequest,onComplete:function(){},onCancel:function(){},onFailure:function(e){throw e}};return l.requestHeaders&&(l.headers=l.requestHeaders,delete l.requestHeaders),l.postBody?(l.method="POST",l.data=l.postBody,delete l.postBody):l.parameters&&(l.method="POST",l.data=l.parameters,delete l.parameters),l.auth&&(l.authentication=l.auth,delete l.auth),"html"===l.type?l.type="document":"feed"===l.type&&(l.type="json"),(l=e.merge(l,b)).type=c[l.type]?l.type:b.type,l.timeout=parseInt(l.timeout,10),s.test(l.method)&&(l.method=l.method.toUpperCase()),"json"===l.type&&(t.getOwnPropertyMatchName(l.headers,"Accept")||(l.headers.Accept="application/json,text/javascript,*/*"),t.getOwnPropertyMatchName(l.headers,"X-Request")||(l.headers["X-Request"]="JSON")),x=l.type,w=l.useOfflineCache,q=l.allowCrossOriginRequest,v=l.useJsonpRequest,E=o,l.proxy?(o=h.proxifyUrl(o,l),v=v&&!1===t.matchUrl(o,O)&&!1===q):!1===t.matchUrl(o,O)&&!1===q?(v=v&&!1===t.matchUrl(h.proxies[T],O),o=h.proxifyUrl(o,e.extend(l,{proxy:T}))):v=!1,h.requests=h.requests||{},y=function(e,n){var o={url:e,timeout:n.timeout,method:n.method,type:n.type,proxy:n.proxy,async:n.async,data:n.data,headers:n.headers};return"GET"===n.method&&!1!==n.useMergeRequest||(o.uuid=t.getUUID()),JSON.stringify(o)}(o,l),d={onComplete:l.onComplete,onFailure:l.onFailure,onCancel:l.onCancel,onTimeout:l.onTimeout||l.onFailure},h.requests[y]?(p=h.requests[y]).addEvents(d):((p=h.requests[y]=new r).addEvents(d),C=function(e,n){var o,r=e;delete h.requests[y],o=t.attempt((function(){var o;return v&&(n=e.headers,o=e.body,i.test(o)&&(o=t.base64Decode(o)),e=o),e=c[x](e,n),w&&h.storeInCache(E,r),!0}),(function(){return g("onFailure",arguments),!1})),o&&p.dispatchEvent("onComplete",[e,n])},g=function(t,n){var o,r,s=!0;delete h.requests[y],w&&(o=h.getFromCache(E),e.is(o)&&(s=!1,u()&&u(!1,r||5e3),C(o))),s&&p.dispatchEvent(t,n)},f={method:l.method,data:l.data,headers:l.headers,fromDataRequest:E,timeout:l.timeout,async:l.async,withCredentials:l.withCredentials,onComplete:function(e,t){C(e,t)},onFailure:function(){g("onFailure",arguments)},onCancel:function(){g("onCancel",arguments)},onTimeout:function(){g("onTimeout",arguments)},onProgress:l.onProgress},w&&!1===u()?f.onFailure(new Error("Network is Offline")):v||(x&&a.test(x)&&(f.responseType=x),p.xhr=m=n.request(o,f)),p.url=E,p.options=l,p.cancel=m.cancel),p}),proxifyUrl:function(e,n){if(!e)throw new Error("Bad or missing url argument.");var o,r=[],s=n.proxy,a=t.toQueryString,i=h.proxies;if(!s||!i[s])throw new Error("Invalid proxy");if(o=i[s],0===e.indexOf(o))return e;if(n.data&&n.method&&"GET"===n.method.toUpperCase()&&(e+=(e.indexOf("?")>-1?"&":"?")+a(n.data),delete n.data),"object"==typeof n[s]&&(r.push(a(n[s])),delete n[s]),n.type&&(r.push(a({type:n.type})),delete n.type),"object"==typeof n.authentication&&r.push(a(n.authentication)),n.cache&&(r.push(a({cache:parseInt(n.cache,10)})),n.cache<0&&r.push(Date.now())),n.headers&&(r.push(a(n.headers,"headers")),delete n.headers),n.connect&&r.push(a({connect:n.connect})),n.service&&r.push(a({service:n.service})),n.wid&&r.push(a({wid:n.wid})),n.method&&r.push(a({method:n.method})),r.push(a({url:e})),(e=o+"?"+r.join("&")).length>8192)throw new Error("Proxified url is more than 8192 characters, that is the limit for most of the browsers.");return e},getFeed:function(e,t){return h.request(e,{method:"GET",proxy:"feed",type:"json",onComplete:t})},getXml:function(e,t){return h.request(e,{method:"GET",type:"xml",onComplete:t})},getText:function(e,t){return h.request(e,{method:"GET",type:"text",onComplete:t})},getJson:function(e,t){return h.request(e,{method:"GET",type:"json",onComplete:t})},getCache:function(){return d},storeInCache:function(n,o){o=t.toArray(o).filter((function(t){return e.is(t)&&!t.nodeType})),h.getCache().set(t.getCheckSum(n),o)},getFromCache:function(e){return h.getCache().get(t.getCheckSum(e))}};return e.namespace("Data",h,e)}));