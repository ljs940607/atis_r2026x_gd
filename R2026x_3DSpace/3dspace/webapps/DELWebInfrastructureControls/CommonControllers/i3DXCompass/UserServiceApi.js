define("DS/DELWebInfrastructureControls/CommonControllers/i3DXCompass/UserServiceApi",["UWA/Core","DS/DELWebInfrastructureControls/CommonControllers/i3DXCompass/Utils","DS/DELWebInfrastructureControls/CommonControllers/i3DXCompass/Data","DS/DELWebInfrastructureControls/CommonControllers/i3DXCompass/CacheManager"],(function(e,o,n,r){"use strict";var t,l,s,i=!1,a=!1,u=[],f=function(){return p()?p()+"api/pull/self":null},p=function(){return n.myAppsBaseUrl||s},c=function(e){u.forEach((function(o){o[e]&&setTimeout(o[e],0,t)})),u.length=0},C=function(){a=!0,n.request({url:f(),headers:{"Last-Modified":undefined},onComplete:function(e,o){t=e,i=!0,o["Last-Modified"],c("onComplete"),a=!1},onFailure:function(){c(t?"onComplete":"onFailure"),a=!1}})},m=function(o){var n,p=Date.now();!f()&&(o.config&&o.config.myAppsBaseUrl||"undefined"!=typeof COMPASS_CONFIG&&COMPASS_CONFIG.myAppsBaseUrl)&&(s=(s=(s=o.config&&o.config.myAppsBaseUrl?o.config.myAppsBaseUrl:COMPASS_CONFIG.myAppsBaseUrl).replace("/resources/AppsMngt","")).replace(/\/$/,"")+"/resources/AppsMngt/"),!r._getUser()&&(o.config&&o.config.userId||"undefined"!=typeof COMPASS_CONFIG&&COMPASS_CONFIG.userId)&&(o.config&&o.config.userId?r.setup(o.config.userId,o.config.lang):r.setup(COMPASS_CONFIG.userId,COMPASS_CONFIG.lang)),i&&(!l||p-l<36e5)?o.onComplete(t):(l=p,u.push({onComplete:o.onComplete,onFailure:o.onFailure}),a||(f()?C():n=setInterval((function(){f()?(clearInterval(n),C()):e.log("wait for myapps url")}),200)))};return{getUser:function(o){o&&"function"===e.typeOf(o.onComplete)&&m({config:o.config,onComplete:function(n){var r=o.platformId;if(n=e.clone(n),o.platformId)if(n.platform=e.Array.detect(n.platforms,(function(e){return e.id===r})),delete n.platforms,n.platform)n.admin="admin"===n.platform.role;else if(n.admin=!1,o.onFailure)return o.onFailure();o.onComplete(n)},onFailure:o.onFailure})},_private:{callbacks:u,fireCallbacks:c,reset:function(){t=void 0,i=!1,a=!1}}}}));