window.define&&define("DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterListDlg",["DS/DELWebInfrastructureControls/UWAUtils","DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterModel","DS/DELWebInfrastructureControls/DELWebAjaxModel","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/LineEditor","DS/Controls/Editor","DS/Controls/ComboBox","DS/DELWebInfrastructureControls/DELWebNotifications","DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterListAssocDlg","i18n!DS/DELWebInfrastructureControls/assets/nls/DELWebInfrastructureControls","css!DS/DELWebInfrastructureControls/DELWebInfrastructureControls.css"],(function(e,t,i,a,s,n,o,r,l,c,u){"use strict";var m=a.inherit({name:"DELWebResourceParameterListDlg",publishedProperties:{title:{defaultValue:u.get("Create New Resource Parameter List"),type:"string",category:"Appearance"},modalFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},autoCloseFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},resizableFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},activateButtonsIfActionPerformed:{defaultValue:!1,type:"boolean",category:"Behavior"},width:{defaultValue:Math.max(window.widget.body.clientWidth/2,330),type:"integer",category:"Appearance",advancedSetter:!0,recordFlag:!0},height:{defaultValue:Math.max(window.widget.body.clientHeight/5,200),type:"integer",category:"Appearance",advancedSetter:!0,recordFlag:!0},minWidth:{defaultValue:330,defaultTouchValue:330,advancedSetter:!0,type:"integer",category:"Appearance"},minHeight:{defaultValue:160,defaultTouchValue:160,advancedSetter:!0,type:"integer",category:"Appearance"}},init:function(e){this._parent.apply(this,arguments),e&&(this.options=Object.assign(this.options||{},e)),this.options.resourceParameterList&&(this.elements._inputName&&(this.elements._inputName.value=this.options.resourceParameterList.V_Name),this.elements._inputDescription&&(this.elements._inputDescription.value=this.options.resourceParameterList.V_description||""),this.title=u.get("Update Resource Parameter List"),this.buttons&&(this.buttons.Ok&&this.buttons.Ok.hide(),this.buttons.Save&&(this.buttons.Save.label=u.get("Save"))))},destroy:function(){var e=this._assocDlg||this.options&&this.options._assocDlg;delete this._assocDlg,this.options&&delete this.options._assocDlg,this._parent.apply(this,arguments),e&&e.destroy&&e.destroy()},_postBuildView:function(){this._parent();var t=this;if(!this.immersiveFrame){var i=window.document.getElementsByClassName("wux-windows-immersive-frame");if(i&&i.length)for(var a=0;!this.immersiveFrame&&a<i.length;++a)i[a]&&i[a].dsModel&&(this.immersiveFrame=i[a].dsModel)}this.elements.container.addClassName(this.name+"-dlg"),this.elements.mainDiv=e.createElement("div",{class:this.name+"-maindiv"}).inject(this.elements._contentDiv||this.elements.container),this.elements._modalDiv||(this.elements._modalDiv=this.elements.container.getParent(".wux-windows-modalDialog")),this.elements._modalDiv.addClassName("wux-ui-animation-flipable"),this._assocDlg||this.options._assocDlg?this.elements.container.addClassName("wux-ui-animation-flip-out"):this.elements.container.addClassName("wux-ui-animation-flip-in"),this.buttons={Ok:new s({label:u.get("Associate Existing"),onClick:function(e){e.preventDefault(),t.options.resourceParameterList||t.onAssociate()}}),Save:new s({label:u.get("Create"),onClick:function(e){t.options.resourceParameterList&&t.options.resourceParameterList.physicalid?t.onSave():t.onCreate()}}),Cancel:new s({onClick:function(){t.visibleFlag=!1,t.destroy()}})},this.buttons.Ok.emphasize="secondary",this.buttons.Ok.elements.button.setStyles({position:"absolute",left:"20px"}),this.elements.mainDiv.innerHTML='<table class="'+this.name+'-table"><tr class="'+this.name+'-V_Name"><th>'+u.get("Name")+'</th><td></td></tr><tr class="'+this.name+'-V_description"><th>'+u.get("Description")+"</th><td></td></tr></table>",window.widget.getUrl().contains("TSK13703396=1")&&(this.elements.mainDiv.innerHTML='<table class="'+this.name+'-table"><tr class="'+this.name+'-V_Name"><th>'+u.get("Name")+'</th><td></td></tr><tr class="'+this.name+'-V_description"><th>'+u.get("Description")+'</th><td></td></tr><tr class="'+this.name+'-collabSpace"><th>'+u.get("Collaborative Space")+'</th><td></td></tr><tr class="'+this.name+'-organization"><th>'+u.get("Organization")+"</th><td></td></tr></table>"),this.elements._inputName=new n({placeholder:u.get("required"),value:u.get("Resource Parameter List")+"-"+(new Date).getTime(),requiredFlag:!0,autoCommitFlag:!0}).inject(this.elements.mainDiv.querySelector("tr."+this.name+"-V_Name td")),this.elements._inputDescription=new o({autoCommitFlag:!0}).inject(this.elements.mainDiv.querySelector("tr."+this.name+"-V_description td")),this.options.resourceParameterList?(this.elements._inputName.value=this.options.resourceParameterList.V_Name,this.elements._inputDescription.value=this.options.resourceParameterList.V_description||""):this.elements._inputName.elements.inputField.select(),this.elements._inputName.addEventListener("change",(function(){this.value||this.dsModel&&this.dsModel.value?t.buttons.Save.disabled=!1:t.buttons.Save.disabled||(t.buttons.Save.disabled=!0)})),this.elements._inputDescription.addEventListener("change",(function(){this.value||this.dsModel&&this.dsModel.value?t.buttons.Save.disabled=!1:t.buttons.Save.disabled||(t.buttons.Save.disabled=!0)})),this.addEventListener("keydown",(function(e){"Enter"===e.key&&(e.preventDefault(),t.options.resourceParameterList&&t.options.resourceParameterList.physicalid?t.onSave():t.onCreate())})),window.widget.getUrl().contains("TSK13703396=1")&&this._createCollabSpaceDropdown(this.elements.mainDiv.querySelector(".collabSpace_dropdown"),this.elements.mainDiv.querySelector(".organization_dropdown")),this.addEventListener("close",(function(){t.destroy()}))},onCreate:function(){var i=this;if(this.elements._inputName&&this.elements._inputDescription)if((this.elements._inputName.value||"").trim()){var a={V_Name:this.elements._inputName.value.trim(),V_description:(this.elements._inputDescription.value||"").trim(),target_resource:this.options?this.options.resource:null};i.elements._collabSpaceDropdown&&i.elements._collabSpaceDropdown.value&&(a.currSecurityContext=i.elements._collabSpaceDropdown.value),i.enableDisableButtons(!1),t.createResourceParameterList(a).then((function(t){var a=u.get("Resource Parameter List");t&&1===t.length&&t[0].V_Name&&(a=e.String.escapeHTML(t[0].V_Name)),l.displayNotificationMessage(u.get("{0} Created",{0:a}),{level:"success"}),i.destroy()}),(function(e){i.enableDisableButtons(!0),e||(e=u.get("Error")),l.displayNotificationMessage(e)}))}else l.displayNotificationMessage(u.get("Missing Name"));else l.displayNotificationMessage("incomplete dialog!")},onSave:function(){var i=this;if(this.elements._inputName&&this.elements._inputDescription)if((this.elements._inputName.value||"").trim())if(this.options.resourceParameterList&&this.options.resourceParameterList.physicalid){var a={physicalid:this.options.resourceParameterList.physicalid},s=!1;e.each({V_Name:this.elements._inputName,V_description:this.elements._inputDescription},(function(e,t){t&&e in i.options.resourceParameterList&&t.value!==i.options.resourceParameterList[e]&&(s=e,a[e]=(t.value||"").trim())})),s?(i.enableDisableButtons(!1),t.updateResourceParameterList(a).then((function(){l.displayNotificationMessage(u.get("{0} Updated",{0:u.get("Resource Parameter List")}),{level:"success"}),i.destroy()}),(function(e){i.enableDisableButtons(!0),e||(e=u.get("Error")),l.displayNotificationMessage(e)}))):l.displayNotificationMessage(u.get("No changes have been made."),{level:"info"})}else l.displayNotificationMessage("Missing Resource Parameter List");else l.displayNotificationMessage(u.get("Missing Name"));else l.displayNotificationMessage("incomplete dialog!")},onAssociate:function(){this.hideDialog(),this.showAssocDialog()},enableDisableButtons:function(e){if(this.buttons)for(var t in this.buttons){if("Cancel"!==t)this.buttons[t].disabled=!e}},hideDialog:function(){this.elements.container&&this.elements.container.addClassName("wux-ui-animation-flip-out").removeClassName("wux-ui-animation-flip-in")},showDialog:function(){this.elements.container&&this.elements.container.removeClassName("wux-ui-animation-flip-out").addClassName("wux-ui-animation-flip-in"),this.elements._modalDiv&&this.elements._modalDiv.inert&&(this.elements._modalDiv.inert=!1)},showAssocDialog:function(e){!this._assocDlg&&this.options._assocDlg&&(this._assocDlg=this.options._assocDlg),this._assocDlg||((e=Object.assign(e||{},this.options))._createDlg||(e._createDlg=this),this._assocDlg=new c(e)),this._assocDlg.showDialog(e)},_createCollabSpaceDropdown:function(t,a){var s=this;s._collabSpaceDropdownElementContainer?t.empty().append(s._collabSpaceDropdownElementContainer):s._organizationDropdownElementContainer?a.empty().append(s._organizationDropdownElementContainer):this.elements.mainDiv&&i.getAllCollaborativeSpaces().then((function(i){if(s._collabSpaceObject=i,i&&!$.isEmptyObject(i)){t=s.elements.mainDiv?e.extendElement(s.elements.mainDiv.querySelector(".DELWebResourceParameterListDlg-collabSpace td")):$(window.widget.body).closest(".moduleUwa").find(".create_new_tab_table").find(".collabSpace_dropdown"),a=s.elements.mainDiv?e.extendElement(s.elements.mainDiv.querySelector(".DELWebResourceParameterListDlg-organization td")):$(window.widget.body).closest(".moduleUwa").find(".create_new_tab_table").find(".organization_dropdown");var n=Object.keys(i),o=[];e.each(n,(function(e,t){t.replace(/\s+/g,"");o.push({labelItem:t,valueItem:t})}));var l="";window.widget&&(l=window.widget.getValue("pad_security_ctx")||window.widget.getValue("collabSpace")||window.widget.getValue("Credentials"));var c=s._fetchOrganizationFromContext(l),u=s._fetchCollabSpaceFromContext(l);s.elements._organizationDropdown=new r({elementsList:o,value:c,enableSearchFlag:!1,actionOnClickFlag:!1}),s.elements._organizationDropdown.inject(a),s.elements._organizationDropdown.getContent().addEventListener("change",(function(e){s._onOrganizationDropdownChange()})),s._collabSpaceDropdownListPair=[];var m=i[n[0]],d=s._parseCollabSpaceStrToObj(m),p=Object.keys(d);e.each(p,(function(e,t){s._collabSpaceDropdownListPair.push({labelItem:t,valueItem:d[t]})})),s.elements._collabSpaceDropdown=new r({elementsList:s._collabSpaceDropdownListPair,value:u,enableSearchFlag:!1,actionOnClickFlag:!1}),s.elements._collabSpaceDropdown.inject(t)}}))},_parseCollabSpaceStrToObj:function(e){for(var t={},i=0;i<e.length;i++){var a=e[i].split("/",2),s=a[0],n=a[1];t[s]=n}return t},_onOrganizationDropdownChange:function(t){var i=this;i._collabSpaceDropdownListPair=[];var a=i._collabSpaceObject[i.elements._organizationDropdown.value],s=i._parseCollabSpaceStrToObj(a),n=Object.keys(s);e.each(n,(function(e,t){i._collabSpaceDropdownListPair.push({labelItem:t,valueItem:s[t]})})),i.elements._collabSpaceDropdown.elementsList=[],i.elements._collabSpaceDropdown.elementsList=i._collabSpaceDropdownListPair},_fetchOrganizationFromContext:function(e){var t=e.split(".");return t.length>1?t[1]:null},_fetchCollabSpaceFromContext:function(e){var t=e.split(".");return t.length>2?t.slice(2).join("."):null}});return m}));