window.define&&define("DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterPrefDialog",["DS/DELWebInfrastructureControls/UWAUtils","DS/DELWebInfrastructureControls/DELWebAjaxModel","DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterModel","DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterDlg","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/LineEditor","DS/Controls/Editor","DS/Controls/ComboBox","DS/Controls/Popup","DS/Controls/Toggle","DS/DataGridView/DataGridView","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/CollectionView/CollectionViewStatusBar","DS/DELWebInfrastructureControls/DELWebNotifications","DS/Utilities/TouchUtils","i18n!DS/DELWebInfrastructureControls/assets/nls/DELWebInfrastructureControls","css!DS/DELWebInfrastructureControls/DELWebInfrastructureControls.css"],(function(e,t,n,i,a,s,l,o,r,d,u,c,m,g,p,f,b,h){"use strict";var D=a.inherit({name:"DELWebResourceParameterPrefDialog",_defaultMagnitudes:null,_unitsDropdown:{},_changedAttributesObj:null,_dimensionList:null,publishedProperties:{title:{defaultValue:h.get("Dimension Preferences"),type:"string",category:"Appearance"},modalFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},autoCloseFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},resizableFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},activateButtonsIfActionPerformed:{defaultValue:!1,type:"boolean",category:"Behavior"},width:{defaultValue:Math.max(window.widget.body.clientWidth/2,530),type:"integer",category:"Appearance",advancedSetter:!0,recordFlag:!0},height:{defaultValue:Math.max(window.widget.body.clientHeight/2,900),type:"integer",category:"Appearance",advancedSetter:!0,recordFlag:!0},minWidth:{defaultValue:330,defaultTouchValue:330,advancedSetter:!0,type:"integer",category:"Appearance"},minHeight:{defaultValue:160,defaultTouchValue:160,advancedSetter:!0,type:"integer",category:"Appearance"}},init:function(e){e?this.options=Object.assign(this.options||{},e):this.options||(this.options={}),this._parent.apply(this,arguments)},destroy:function(){var e=this._createDlg||this.options&&this.options._createDlg;delete this._createDlg,this.options&&(delete this.options._createDlg,this.options.onClose&&this.options.onClose.call(this)),this._parent.apply(this,arguments),e&&e.destroy&&e.destroy()},_postBuildView:function(){this._parent();var t=this;if(!this.immersiveFrame)if(this.options.immersiveFrame)this.immersiveFrame=this.options.immersiveFrame;else{var n=window.document.getElementsByClassName("wux-windows-immersive-frame");if(n&&n.length)for(var i=0;!this.immersiveFrame&&i<n.length;++i)n[i]&&n[i].dsModel&&(this.immersiveFrame=n[i].dsModel)}this.elements.container.addClassName(this.name+"-dlg"),this.elements.mainDiv=e.createElement("div",{class:this.name+"-maindiv"}).inject(this.elements._contentDiv||this.elements.container),this.elements._modalDiv||(this.elements._modalDiv=this.elements.container.getParent(".wux-windows-modalDialog")),!this.options.flippable&&"flippable"in this.options||(this.elements._modalDiv.addClassName("wux-ui-animation-flipable"),this._createDlg||this.options._createDlg?this.elements.container.addClassName("wux-ui-animation-flip-out"):this.elements.container.addClassName("wux-ui-animation-flip-in")),this.buttons={Ok:new s({label:h.get("Apply"),onClick:function(e){t.applyClicked(e)}}),Save:new s({label:h.get("Done"),onClick:function(e){t.doneClicked(e)}}),Cancel:new s({onClick:function(){t.hideDialog();t.showCreateDialog({blnForceRefresh:!0})}})},this.buttons.Ok.emphasize="secondary",this.elements.mainDiv.innerHTML='<div class="preferencesDlgDiv"><table><tr class="default_magnitudes mainRow"><td>'+h.get("Default Dimensions")+'</td><td class="inputField"><table><tbody><tr><td><select class="defaultMagnitudesList" name="defaultMagnitudesList" size="5" style="width:100%;"></select></td></tr><tr class="icon_toolbar"><td><div style="white-space:nowrap;"><div class="opt_DefaultMagnitudes"></div><div class="opt_DefaultMagnitudes_icons"><div style="padding-left:10px;" class="add_default_magnitude_icon"></div><div class="delete_default_magnitude_icon" style="padding-left:10px;"></div></div></div></td></tr></tbody></table></td></tr><tr class="mainRow default_unit_title"><td colspan="2" style="position:relative;">'+h.get("Default Units")+'</td></tr><tr class="default_units mainRow"><td class="inputField" colspan="2"><table><tbody class="display_units_body" colspan="2"></tbody></table></td></tr></table></div>',this._addDefaultMagnitudeIcon=new s({type:"button",allowUnsafeHTMLLabel:!0,displayStyle:"lite",disabled:!0,icon:{iconName:"plus",fontIconFamily:window.WUXManagedFontIcons.Font3DS}}).inject(this.elements.mainDiv.querySelector(".add_default_magnitude_icon")),this._deleteDefaultMagnitude=new s({type:"button",allowUnsafeHTMLLabel:!0,displayStyle:"lite",disabled:!0,icon:{iconName:"minus",fontIconFamily:window.WUXManagedFontIcons.Font3DS}}).inject(this.elements.mainDiv.querySelector(".delete_default_magnitude_icon")),this._addDefaultMagnitudeIcon.getContent().addEventListener("buttonclick",(function(e){t.onAddMagnitude(e)})),this._deleteDefaultMagnitude.getContent().addEventListener("buttonclick",(function(e){t.onDeleteMagnitude(e)})),this._addDefaultMagnitudesElements(),this._addDefaultUnitsTable(),this._initEventHandlers()},_addDefaultMagnitudesElements:function(){var t=this,i=e.extendElement(t.elements.mainDiv.querySelector("tr select.defaultMagnitudesList"));i.addClassName("loading"),n.getDefaultMagnitudes({blnForceRefresh:!0}).then((function(n){if(n||(n.INTEGER={Name:"Integer",NLS:h.get("Integer")},n.STRING={Name:"String",NLS:h.get("Text")}),n=Object.keys(n).sort().reduce((function(e,t){return e[t]=n[t],e}),{}),t._defaultMagnitudes=n,e.each(n,(function(e,t){i.options[i.options.length]=new Option(t.NLS,t.Name)})),e.extendElement(i).removeClassName("loading"),b.getTouchMode()){var a=[{labelItem:"-- "+h.get("Current Default Dimensions")+" --",valueItem:""}];e.each(i.options,(function(e,t){a.push({labelItem:t.innerText,valueItem:t.value})}));var s=new r({elementsList:a,popupSizeAdjustPolicy:d.SizeAdjustPolicyEnum.AdjustToVisibleContents,enableSearchFlag:!1,selectedIndex:-1}).inject(i.parentElement);i.hide(),s.elements.container.setStyle("width","100%"),s.addEventListener("change",(function(e){var n=e.dsModel.value;i.value=n,t._deleteDefaultMagnitude.disabled=!n}))}}),(function(e){f.displayNotificationMessage(e)})),t.elements.mainDiv.querySelector("select.defaultMagnitudesList").addEventListener("change",(function(e){var n=e.target.value;t._deleteDefaultMagnitude.disabled=!n}))},onAddMagnitude:function(){var t=this;t._changedAttributesObj||(t._changedAttributesObj={});var n=t.elements._optionalMagnitudesDropdown.currentValue,i=t.elements._optionalMagnitudesDropdown.currentLabel;t._changedAttributesObj.preference_DimensionsList=t._defaultMagnitudes,t._dimensionList=t.elements._optionalMagnitudesDropdown.currentValue.trim().replaceAll("_","")+"Parameter";var a=e.extendElement(t.elements.mainDiv.querySelector(".defaultMagnitudesList"));if(t._changedAttributesObj.preference_DimensionsList&&!t._changedAttributesObj.preference_DimensionsList[n]){t._changedAttributesObj.preference_DimensionsList[n]={};var s=e.createElement("option");if(s.value=n,s.innerHTML=i,a.appendChild(s),b.getTouchMode()){var l=a.parentElement.querySelector(".wux-controls-combobox");if(l&&l.dsModel&&l.dsModel.elementsList){var o=l.dsModel.elementsList;o.push({labelItem:s.innerHTML,valueItem:s.value}),l.dsModel.elementsList=[],l.dsModel.elementsList=o}}}if(t.elements._optionalMagnitudesDropdown){var r=t.elements._optionalMagnitudesDropdown.elementsList,d=t._getSelectedIndex(n,r);r&&r.splice(d,1),r=r.sort((function(e,t){return e&&t?t.valueItem&&t.labelItem?e.valueItem&&e.labelItem&&e.labelItem.toLowerCase()>t.labelItem.toLowerCase()?1:-1:1:0})),t.elements._optionalMagnitudesDropdown&&t.elements._optionalMagnitudesDropdown.elements&&t.elements._optionalMagnitudesDropdown.elements&&(t.blnPreventSelectedIndexUpdate=!0,t.elements._optionalMagnitudesDropdown.elementsList=[],t.elements._optionalMagnitudesDropdown.placeholder=" --- "+h.get("Select")+" --- ",t.elements._optionalMagnitudesDropdown.selectedIndex=-1,t.elements._optionalMagnitudesDropdown.elementsList=r,t.blnPreventSelectedIndexUpdate=!1,t._addDefaultMagnitudeIcon.disabled=!0)}},onDeleteMagnitude:function(){var t=this;t._changedAttributesObj||(t._changedAttributesObj={});var n=e.extendElement(t.elements.mainDiv.querySelector(".defaultMagnitudesList"));if(1!==n.length){var i=null;t._changedAttributesObj.preference_DimensionsList=t._defaultMagnitudes;var a=n.options[n.selectedIndex];if(a){for(var s=0;s<n.length;s++)n.options[s].value===a.value&&t._changedAttributesObj.preference_DimensionsList&&(t._deleteDefaultMagnitude.disabled=!1,delete t._changedAttributesObj.preference_DimensionsList[n.options[s].value],n.options[s].remove());if(b.getTouchMode()){var l=n.parentElement.querySelector(".wux-controls-combobox");if(l&&l.dsModel&&l.dsModel.elementsList&&(i=t._getSelectedIndex(a.value,l.dsModel.elementsList))>0){var o=l.dsModel.elementsList;o.splice(i,1),l.dsModel.elementsList=[],l.dsModel.elementsList=o}}}if(t.elements._optionalMagnitudesDropdown){var r=t.elements._optionalMagnitudesDropdown.elementsList;(i=t._getSelectedIndex(a.value,r))||r.push({labelItem:a.label,valueItem:a.value}),r=r.sort((function(e,t){return e&&t?t.valueItem&&t.labelItem?e.valueItem&&e.labelItem&&e.labelItem.toLowerCase()>t.labelItem.toLowerCase()?1:-1:1:0})),t.elements._optionalMagnitudesDropdown&&t.elements._optionalMagnitudesDropdown.elements&&t.elements._optionalMagnitudesDropdown.elements&&(t.blnPreventSelectedIndexUpdate=!0,t.elements._optionalMagnitudesDropdown.elementsList=[],t.elements._optionalMagnitudesDropdown.placeholder=" --- "+h.get("Select")+" --- ",t.elements._optionalMagnitudesDropdown.selectedIndex=-1,t.elements._optionalMagnitudesDropdown.elementsList=r,t.blnPreventSelectedIndexUpdate=!1,t._deleteDefaultMagnitude.disabled=!0)}}},_addDefaultUnitsTable:function(){var t=this,i=e.extendElement(t.elements.mainDiv.querySelector("tr table .display_units_body"));i.addClassName("loading");var a=e.extendElement(t.elements.mainDiv.querySelector("table tr .opt_DefaultMagnitudes"));n.getMagnitudes({blnForceRefresh:this.options.blnForceRefresh||!1}).then((function(s){n.getDefaultMagnitudes({blnForceRefresh:!0}).then((function(l){var o,c=[];t.elements._unitsDropdown={},(s=Object.keys(s).sort().reduce((function(e,t){return e[t]=s[t],e}),{}))&&!s.INTEGER&&c.push({labelItem:h.get("Integer"),valueItem:"Integer"}),s&&!s.STRING&&c.push({labelItem:h.get("Text"),valueItem:"String"}),e.each(s,(function(a,s){var o={};s&&s.Name&&s.NLS&&!l[s.Name]&&(o={labelItem:s.NLS,valueItem:s.Name},c.push(o));var u=i.insertRow(-1);u.classList.add("magnitudeLabelRow"),u.classList.add(s.Name+"Parameter");var m=e.createElement("td");(m=u.insertCell()).className="unitsLabel",m.innerHTML=s.NLS;var g=e.createElement("td");g=u.insertCell();var p=e.createElement("div");p.className="unitsDropdown",g.appendChild(p);var f=null,b=[];s.Units&&e.each(s.Units,(function(e,t){t&&"label"in t&&(o={labelItem:t.NLSName||t.label||"",valueItem:t.label||t.Name},t&&t.default&&!0===t.default&&(o.default=!0),b.push(o))})),(b=b.sort((function(e,t){return e&&t?t.valueItem&&t.labelItem?e.valueItem&&e.labelItem&&e.labelItem.toLowerCase()>t.labelItem.toLowerCase()?1:-1:1:0})))&&(f=null,e.each(b,(function(e,t){return t.default&&!0===t.default&&(f=e),null===f})));var h={elementsList:b,popupSizeAdjustPolicy:d.SizeAdjustPolicyEnum.AdjustToVisibleContents,enableSearchFlag:!1,selectedIndex:f,actionOnClickFlag:!1};if(t.options.resourceParameter&&t.options.resourceParameter.units&&(h.currentValue=t.options.resourceParameter.units),b.length>1){t.elements._unitsDropdown[s.Name+"Parameter"]=new r(h).inject(p),t.elements._unitsDropdown[s.Name+"Parameter"].disabled=b.length>1,"ARBITRARYUNIT"!==s.Name&&t.elements._unitsDropdown[s.Name+"Parameter"].getContent().addClassName("loading"),t.elements._unitsDropdown[s.Name+"Parameter"].name=s.Name,t.elements._unitsDropdown[s.Name+"Parameter"].getContent().addEventListener("change",(function(e){t.onUnitsDropdownChange(e)}));var D={magnitude:s.Name};n.getMagnitudeUnits(D).then((function(n){n&&e.each(n,(function(e,n){n&&n.default&&!0===n.default?(t.elements._unitsDropdown[s.Name+"Parameter"].value=n.label,t.elements._unitsDropdown[s.Name+"Parameter"].disabled=!1):n&&!n.default&&(t.elements._unitsDropdown[s.Name+"Parameter"].disabled=!1)})),t.elements._unitsDropdown[s.Name+"Parameter"].getContent().removeClassName("loading")}))}else 1===b.length&&p.setText(b[0].labelItem)})),c=c.sort((function(e,t){return e&&t?t.valueItem&&t.labelItem?e.valueItem&&e.labelItem&&e.labelItem.toLowerCase()>t.labelItem.toLowerCase()?1:-1:1:0})),o={popupSizeAdjustPolicy:d.SizeAdjustPolicyEnum.AdjustToVisibleContents,elementsList:c,placeholder:" --- "+h.get("Select")+" --- ",selectedIndex:-1,enableSearchFlag:!0,actionOnClickFlag:!1},t.elements._optionalMagnitudesDropdown=new r(o).inject(a),t.elements._optionalMagnitudesDropdown.getContent().addEventListener("change",(function(){null!==t.elements._optionalMagnitudesDropdown.currentValue?t._addDefaultMagnitudeIcon.disabled=!1:t._addDefaultMagnitudeIcon.disabled=!0})),t.elements._optionalMagnitudesDropdown.addEventListener("show",(function(n){if(n&&n.dsModel&&n.dsModel.elements&&n.dsModel.elements.treeListView&&n.dsModel.elements.treeListView.getRoots){var a=function(){var s=t.elements.mainDiv.querySelector("tr.default_unit_title td .wux-controls-toggle"),l=!1,o=[];if(n.dsModel.elements.popup&&n.dsModel.elements.popup.visibleFlag?o=n.dsModel.elements.treeListView.getRoots():n.dsModel._allDescendants&&(o=n.dsModel._allDescendants),e.each(o,(function(e,t){if(t&&t.options&&t.options.grid&&t.options.grid.valueItem){var n=i.querySelector("tr.magnitudeLabelRow."+t.options.grid.valueItem+"Parameter");n&&(s&&s.dsModel&&s.dsModel.checkFlag?n.hidden=!1:(n.hidden=t.isHidden(),l=l||n.hidden))}})),l)if(s)s.dsModel&&s.dsModel.show();else{var r=new u({label:h.get("Show All")}).inject(t.elements.mainDiv.querySelector("tr.default_unit_title td"));(s=r.elements.container).setStyle("position","absolute").setStyle("right","1em").setStyle("bottom","0"),r.addEventListener("change",(function(){a()}))}else s&&s.dsModel&&s.dsModel.checkFlag&&s.dsModel.show()};a()}})),e.extendElement(i).removeClassName("loading")}))}),(function(e){f.displayNotificationMessage(e)}))},_getSelectedIndex:function(t,n){var i=null,a=n||this.elements._optionalMagnitudesDropdown&&this.elements._optionalMagnitudesDropdown.elementsList;return a&&a.length&&e.each(a,(function(e,n){n.valueItem===t&&(i=e)})),i},hideDialog:function(){this.elements.container&&this.elements.container.addClassName("wux-ui-animation-flip-out").removeClassName("wux-ui-animation-flip-in"),this.options.onClose&&this.options.onClose.call(this)},showCreateDialog:function(e){this.options.blnSuppressCreateDlg||(!this._createDlg&&this.options._createDlg&&(this._createDlg=this.options._createDlg),this._createDlg||((e=Object.assign(e||{},this.options))._prefDialog||(e._prefDialog=this),this._createDlg=new i(e)),this._createDlg.showDialog(e))},showDialog:function(){this.elements.container&&this.elements.container.removeClassName("wux-ui-animation-flip-out").addClassName("wux-ui-animation-flip-in"),this.elements._modalDiv&&this.elements._modalDiv.inert&&(this.elements._modalDiv.inert=!1)},onUnitsDropdownChange:function(e){var t=this;if(t._changedAttributesObj||(t._changedAttributesObj={}),e.target.hasClassName("loading"))e.target.removeClassName("loading");else{var n=e.target.dsModel,i=n.name+"Parameter",a=n.value,s=n.label;i&&a&&(t._changedAttributesObj.preference_DisplayUnits||(t._changedAttributesObj.preference_DisplayUnits={}),t._changedAttributesObj.preference_DisplayUnits[i]={},t._changedAttributesObj.preference_DisplayUnits[i].currentUnitValue=a,t._changedAttributesObj.preference_DisplayUnits[i].currentUnitLabel=s)}},applyClicked:function(){var t=this,i={};if(t._changedAttributesObj&&(!t._changedAttributesObj||t._changedAttributesObj.preference_DimensionsList||t._changedAttributesObj.preference_DisplayUnits)){var a=null;if(t._changedAttributesObj.preference_DimensionsList){a=Object.keys(t._changedAttributesObj.preference_DimensionsList);for(var s="",l=0;l<a.length;l++)s+=a[l]+"Parameter;";i.dimensionList=s}else if(t.preference_DimensionsList){a=Object.keys(t.preference_DimensionsList);for(s="",l=0;l<a.length;l++)s+=a[l]+"Parameter;";i.dimensionList=s}var o="";t._changedAttributesObj.preference_DisplayUnits?(e.each(t._changedAttributesObj.preference_DisplayUnits,(function(e,t){o+=e+":"+t.currentUnitValue+","})),i.defaultUnits=o):t.preference_DimensionsList&&(e.each(t.preference_DisplayUnits,(function(e,t){o+=e+":"+t.currentUnitValue+","})),i.defaultUnits=o),t.enableDisableButtons(!1),i&&i.dimensionList&&n.updateDefaultMagnitudes(i).then((function(){f.displayNotificationMessage(h.get("Updated Default Dimensions"),{level:"success"}),t.enableDisableButtons(!0),t._changedAttributesObj={}}),(function(e){e||(e=h.get("Error")),f.displayNotificationMessage(e)})),i&&i.defaultUnits&&n.updateMagnitudeUnits(i).then((function(){f.displayNotificationMessage(h.get("Updated Magnitude Units"),{level:"success"}),t.enableDisableButtons(!0),t._changedAttributesObj={}}),(function(e){t.enableDisableButtons(!0),e||(e=h.get("Error")),f.displayNotificationMessage(e)}))}},doneClicked:function(t){var i=this;if(!i._changedAttributesObj)return i.hideDialog(),t.blnForceRefresh=!0,void i.showCreateDialog(t);if(i._changedAttributesObj&&!i._changedAttributesObj.preference_DimensionsList&&!i._changedAttributesObj.preference_DisplayUnits)return i.hideDialog(),t.blnForceRefresh=!0,void i.showCreateDialog(t);if(t={},i._changedAttributesObj.preference_DimensionsList){for(var a=Object.keys(i._changedAttributesObj.preference_DimensionsList),s="",l=0;l<a.length;l++)s+=a[l]+"Parameter;";t.dimensionList=s}if(i._changedAttributesObj.preference_DisplayUnits){var o="";e.each(i._changedAttributesObj.preference_DisplayUnits,(function(e,t){o+=e+":"+t.currentUnitValue+","})),t.defaultUnits=o}i.enableDisableButtons(!1),t&&t.dimensionList&&n.updateDefaultMagnitudes(t).then((function(){f.displayNotificationMessage(h.get("Updated Default Dimensions"),{level:"success"}),i.enableDisableButtons(!0),i._changedAttributesObj={},i.hideDialog(),t.blnForceRefresh=!0,i.showCreateDialog(t)}),(function(e){i.enableDisableButtons(!0),e||(e=h.get("Error")),f.displayNotificationMessage(e)})),t&&t.defaultUnits&&n.updateMagnitudeUnits(t).then((function(){f.displayNotificationMessage(h.get("Updated Magnitude Units"),{level:"success"}),i.enableDisableButtons(!0),i._changedAttributesObj={},i.hideDialog(),t.blnForceRefresh=!0,i.showCreateDialog(t)}),(function(e){i.enableDisableButtons(!0),e||(e=h.get("Error")),f.displayNotificationMessage(e)}))},_initEventHandlers:function(){var e=this;this.addEventListener("close",(function(){e.destroy()}))},enableDisableButtons:function(e){if(this.buttons)for(var t in this.buttons){if("Cancel"!==t)this.buttons[t].disabled=!e}}});return D}));