window.define&&define("DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterDlg",["DS/DELWebInfrastructureControls/UWAUtils","DS/DELWebInfrastructureControls/DELWebAjaxModel","DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterModel","DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterListDlg","DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterPrefDialog","DS/DELWebInfrastructureControls/Mask","DS/Windows/Dialog","DS/Controls/Accordeon","DS/Controls/Button","DS/Controls/DatePicker","DS/Controls/LineEditor","DS/Controls/Toggle","DS/Controls/ButtonGroup","DS/Controls/Editor","DS/Controls/ComboBox","DS/Controls/Label","DS/Controls/TimePicker","DS/Controls/SelectionChipsEditor","DS/WUXAutoComplete/AutoComplete","DS/DataGridView/DataGridView","DS/TreeModel/TreeDocument","DS/Controls/Abstract","DS/TreeModel/TreeNodeModel","DS/DELWebInfrastructureControls/DELWebNotifications","i18n!DS/DELWebInfrastructureControls/assets/nls/DELWebInfrastructureControls","css!DS/DELWebInfrastructureControls/DELWebInfrastructureControls.css"],(function(e,t,n,a,r,i,o,s,l,m,u,c,d,p,g,v,b,D,_,h,f,y,P,w,S){"use strict";var x=a.inherit({name:"DELWebResourceParameterDlg",_uwaTree:null,_conflictCnt:0,_prefDialog_Done:!1,_arrList:[],_blnIsUnitsInDropdownListPair:!0,_currentSelectedOntology:null,publishedProperties:{title:{defaultValue:S.get("Create Resource Parameter"),type:"string",category:"Appearance"},modalFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},autoCloseFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},resizableFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},activateButtonsIfActionPerformed:{defaultValue:!1,type:"boolean",category:"Behavior"},width:{defaultValue:Math.max(window.widget.body.clientWidth/2,700),type:"integer",category:"Appearance",advancedSetter:!0,recordFlag:!0},height:{defaultValue:Math.max(window.widget.body.clientHeight/3,200),type:"integer",category:"Appearance",advancedSetter:!0,recordFlag:!0},minWidth:{defaultValue:700,advancedSetter:!0,type:"integer",category:"Appearance"}},init:function(t){var a=this;t&&(a.options=Object.assign(a.options||{},t)),a.options.blnForceRefreshPreferences=!0,a._parent.apply(a,arguments);var r="";a.options.resourceParameter?(a.options.resourceParameter["DELParameterIdentifierExt.V_ParameterIdentifier"]&&a.options.resourceParameter["DELParameterIdentifierExt.V_ParameterIdentifier"].parameterId&&(r=a.options.resourceParameter["DELParameterIdentifierExt.V_ParameterIdentifier"].parameterId),r&&n.getOneParameterOntology({uri:r}).then((function(e){e&&(a.options.resourceParameter.ontologySet=e)})),a.elements._inputName&&(a.elements._inputName.value=a.options.resourceParameter.V_Name,a.elements._inputName.disabled=!0),a.elements._inputDescription&&(a.elements._inputDescription.value=a.options.resourceParameter.V_description||a.options.resourceParameter.descriptionNLS||""),a.title=S.get("Update Resource Parameter"),a.buttons&&(a.buttons.Ok&&a.buttons.Ok.hide(),a.buttons.Save&&(a.buttons.Save.label=S.get("Save")))):a.options&&a.options.resourceParameterPhysicalid?n.getOneResourceParameter({physicalid:a.options.resourceParameterPhysicalid}).then((function(e){a.options.resourceParameter=e,a.options.resourceParameter["DELParameterIdentifierExt.V_ParameterIdentifier"]&&a.options.resourceParameter["DELParameterIdentifierExt.V_ParameterIdentifier"].parameterId&&(r=a.options.resourceParameter["DELParameterIdentifierExt.V_ParameterIdentifier"].parameterId),r&&n.getOneParameterOntology({uri:r}).then((function(e){e&&(a.options.resourceParameter.ontologySet=e)})),a.elements._inputName&&(a.elements._inputName.value=a.options.resourceParameter.V_Name,a.elements._inputName.disabled=!0),a.elements._inputDescription&&(a.elements._inputDescription.value=a.options.resourceParameter.V_description||a.options.resourceParameter.descriptionNLS||""),a.title=S.get("Update Resource Parameter"),a.buttons&&(a.buttons.Ok&&a.buttons.Ok.hide(),a.buttons.Save&&(a.buttons.Save.label=S.get("Save")))})):a.title=S.get("{0} in {1}",{0:e.String.escapeHTML(a.title),1:e.String.escapeHTML(a.options.parentModel.V_Name)})},destroy:function(){var e=this._prefDialog||this.options&&this.options._prefDialog;delete this._prefDialog,this.options&&delete this.options._prefDialog,this._parent.apply(this,arguments),e&&e.destroy&&e.destroy()},_postBuildView:function(){var t=this;if(t._collabSpaceDropdownAdded=!1,t.options.resourceParameter&&!this.options._modelCalled&&(t.options.resourceParameter.physicalid||t.options.resourceParameter.OXID)||t.options.resourceParameterPhysicalid&&!this.options._modelCalled&&t.options.resourceParameterPhysicalid)n.getOneResourceParameter({physicalid:t.options.resourceParameter&&t.options.resourceParameter.physicalid||t.options.resourceParameterPhysicalid,OXID:t.options.resourceParameter&&t.options.resourceParameter.OXID}).then((function(e){t.options.resourceParameter=e,e?(t.options._modelCalled=Object.assign({},t.options.resourceParameter),t.options.resourceParameter=Object.assign(t.options.resourceParameter,e)):t.options._modelCalled=!0,t._postBuildView()}));else{this._parent(),this.elements.container.addClassName(this.name+"-dlg"),this.elements._modalDiv||(this.elements._modalDiv=this.elements.container.getParent(".wux-windows-modalDialog"));for(var a=this.elements._modalDiv.parentElement.children,r=0;r<a.length;r++)a[r].hasAttribute("inert")&&a[r].removeAttribute("inert");this.elements._modalDiv.addClassName("wux-ui-animation-flipable"),this._prefDialog||this.options._prefDialog?this.elements.container.addClassName("wux-ui-animation-flip-out"):this.elements.container.addClassName("wux-ui-animation-flip-in");var i="Create";t.options.resourceParameter&&t.options.resourceParameter.physicalid&&(i="Save"),this.buttons={Ok:new l({disabled:!0,label:S.get(i),onClick:function(){"Save"===i?t.onSave({button:t.buttons.Ok}).then((function(){t.enableDisableButtons(!0)})):t.onCreate({button:t.buttons.Ok}).then((function(){t.enableDisableButtons(!0)}))}}),Save:new l({disabled:!0,label:S.get(i+" and Close"),onClick:function(){"Save"===i?t.onSave({button:t.buttons.Save}).then((function(){t.destroy()})):t.onCreate({button:t.buttons.Save}).then((function(){t.destroy()}))}}),Cancel:new l({onClick:function(){t.visibleFlag=!1,t.destroy()}})},this.buttons.Ok.emphasize="secondary";var o=this.elements.mainDiv.querySelector("table.DELWebResourceParameterDlg-table");if(!(window.Foe&&window.Foe.Model&&window.Foe.Model.Session&&window.Foe.Model.Session.checkApplicationFeature("TSK11682816","0"))){var s=o.insertRow(0);s.className=this.name+"-ParameterOntology",(b=e.createElement("th")).innerText=S.get("Parameter"),s.appendChild(b),s.insertCell();var m=e.extendElement(t.elements.mainDiv.querySelector("tr."+t.name+"-ParameterOntology td"));m.addClassName("loading"),n.getDefinedParameterOntologies().then((function(n){if(n&&0!==n.length){var a=[];n&&e.each(n,(function(e,t){t&&t.labelNLS&&t.uri&&a.push({labelItem:t.labelNLS,valueItem:t.uri})})),(a=a.sort((function(e,t){return e&&t?t.valueItem?e.valueItem&&e.labelItem>t.labelItem?1:-1:1:0}))).unshift({labelItem:S.get("No Parameter"),valueItem:""}),t.elements._parameterOntologyDropdown=new g({elementsList:a,enableSearchFlag:!1,actionOnClickFlag:!1}).inject(m),t.elements._parameterOntologyDropdown.getContent().addClassName("parameter_ontology_dropdown"),t.elements._parameterOntologyDropdown.getContent().addEventListener("change",(function(e){t.onParameterOntologyDropdownChange(e)})),t.options&&t.options.resourceParameter&&t.options.resourceParameter.ontologySet?(t.elements._parameterOntologyDropdown.currentValue=t.options.resourceParameter.ontologySet.uri,t.elements._parameterOntologyDropdown.disabled=!0):t._blnIsUnitsInDropdownListPair?t.elements._parameterOntologyDropdown.disabled=!1:t.elements._parameterOntologyDropdown.disabled=!0,t.enableDisableButtons(!1),m.removeClassName("loading")}else t.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-ParameterOntology").remove()}),(function(e){e||(e=S.get("Error")),w.displayNotificationMessage(e)}))}var u=null,p=o.insertRow(-1);p.className=this.name+"-V_Direction";var v=e.createElement("th");if(v.innerText=S.get("Direction"),p.appendChild(v),p.insertCell(),t.options.resourceParameter)this.elements.mainDiv.querySelector("table.DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-V_Direction td div")&&this.elements.mainDiv.querySelector("table.DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-V_Direction td div").remove(),(u=e.createElement("div")).innerText=this.options.resourceParameter.plmObjectType&&this.options.resourceParameter.plmObjectType.indexOf("OUTPUT")>0?S.get("Output"):S.get("Input"),this.elements.mainDiv.querySelector("table.DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-V_Direction td").appendChild(u);else this.elements._direction=new d({type:"radio"}),this.elements._direction.addChild(new c({type:"radio",label:S.get("Input"),value:"Input",checkFlag:!0})),this.elements._direction.addChild(new c({type:"radio",label:S.get("Output"),value:"Output",checkFlag:!1})),this.elements._direction.inject(this.elements.mainDiv.querySelector("tr."+this.name+"-V_Direction td")),this.elements._direction.getContent().addEventListener("change",(function(){t._populateExtensionSection()}));var b,D=o.insertRow(-1);if(D.className=this.name+"-V_ParameterType",(b=e.createElement("th")).innerText=S.get("Dimension"),D.appendChild(b),D.insertCell(),t.options.resourceParameter)n.getMagnitudes().then((function(n){t.elements.mainDiv.querySelector("table.DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-V_ParameterType td div")&&t.elements.mainDiv.querySelector("table.DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-V_ParameterType td div").remove(),!t.options.resourceParameter.parameter_type&&t.options.resourceParameter.interfaces&&t.options.resourceParameter.interfaces.length&&e.each(t.options.resourceParameter.interfaces,(function(e,n){n.indexOf("DELRscPrmIOValueAbstract")>=0&&(t.options.resourceParameter.parameter_type=n[0].replace("DELRscPrmIORangeValue_","").replace("DELRscPrmIO",""),t.options.resourceParameter.magnitude=t.options.resourceParameter.parameter_type)}));var a="";e.each(n,(function(e,n){n.Name!==t.options.resourceParameter.parameter_type&&n.Name!==t.options.resourceParameter.magnitude||(a=n.NLS)})),"IntegerValue"===t.options.resourceParameter.parameter_type&&""===a||"Integer"===t.options.resourceParameter.parameter_type&&""===a?a=S.get("Integer"):("TextValue"===t.options.resourceParameter.parameter_type&&""===a||"Text"===t.options.resourceParameter.parameter_type&&""===a)&&(a=S.get("Text")),(u=e.createElement("div")).innerHTML=a||"",t.elements.mainDiv.querySelector("table.DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-V_ParameterType td").appendChild(u)})),t.options.resourceParameter.parameter_type.indexOf("Integer")<0&&t.options.resourceParameter.parameter_type.indexOf("Text")<0&&t.options.resourceParameter.parameter_type.indexOf("String")<0?t._populateAllMagnitudesSection(t.options.resourceParameter):(t.options.resourceParameter.parameter_type.indexOf("Integer")>=0||t.options.resourceParameter.parameter_type.indexOf("Text")>=0||t.options.resourceParameter.parameter_type.indexOf("String")>=0)&&t._populateListSection(t.options.resourceParameter.V_Values);else{var _=e.extendElement(t.elements.mainDiv.querySelector("tr."+t.name+"-V_ParameterType td"));_.addClassName("loading"),n.getDefaultMagnitudes({blnForceRefresh:!0}).then((function(n){var a=[];n||(a=[{labelItem:S.get("Integer"),valueItem:"Integer"},{labelItem:S.get("Text"),valueItem:"String"}]),n&&e.each(n,(function(e,t){t&&t.Name&&t.NLS&&a.push({labelItem:t.NLS,valueItem:t.Name})})),(a=a.sort((function(e,t){return e&&t?t.valueItem?e.valueItem&&e.labelItem>t.labelItem?1:-1:1:0}))).unshift({labelItem:S.get("Select"),valueItem:""}),a.push({labelItem:" -- "+S.get("Other")+" -- ",valueItem:"__OTHER__"}),t.elements._parameterTypeDropdown=new g({elementsList:a,enableSearchFlag:!1,actionOnClickFlag:!1}).inject(_),t.elements._parameterTypeDropdown.getContent().addClassName("parameter_type_dropdown"),t.elements._parameterTypeDropdown.getContent().addEventListener("change",(function(e){t.onParameterTypeDropdownChange(e)})),t.enableDisableButtons(!1),t.elements._parameterSettings=new l({displayStyle:"lite",label:S.get("Dimension Settings"),icon:{iconName:"cog",fontIconFamily:window.WUXManagedFontIcons.Font3DS},showLabelFlag:!1}).inject(_),t.elements._parameterSettings.getContent().addClassName("parameter_settings"),t.elements._parameterSettings.getContent().addEventListener("buttonclick",(function(){t.hideDialog(),t.showPreferencesDialog()})),_.removeClassName("loading")}),(function(e){e||(e=S.get("Error")),w.displayNotificationMessage(e)}))}t._populateExtensionSection(t.options.resourceParameter),window.widget.getUrl().contains("TSK13703396=1")&&(t._collabSpaceDropdownAdded=!0,t._createCollabSpaceDropdown(t.elements.mainDiv.querySelector(".collabSpace_dropdown"),t.elements.mainDiv.querySelector(".organization_dropdown"))),this.options.resourceParameter?(this.elements._inputName.value!==this.options.resourceParameter.V_Name&&(this.elements._inputName.value=this.options.resourceParameter.V_Name),this.elements._inputName.disabled=!0,this.elements._inputDescription.value!==this.options.resourceParameter.V_description&&(this.elements._inputDescription.value=this.options.resourceParameter.V_description||"")):(this.elements._inputName.value=S.get("Resource Parameter")+"-"+(new Date).getTime(),this.elements._inputName.elements.inputField.select()),this.elements._inputName.addEventListener("change",(function(){this.value||this.dsModel&&this.dsModel.value?t.buttons.Save.disabled=!1:t.buttons.Save.disabled||(t.buttons.Save.disabled=!0),t.elements._parameterTypeDropdown&&!t.elements._parameterTypeDropdown.currentValue&&t.enableDisableButtons(!1)})),this.elements._inputDescription.addEventListener("change",(function(){this.value||this.dsModel&&this.dsModel.value?t.buttons.Save.disabled=!1:t.buttons.Save.disabled||(t.buttons.Save.disabled=!0),t.elements._parameterTypeDropdown&&!t.elements._parameterTypeDropdown.currentValue&&t.enableDisableButtons(!1)})),this.addEventListener("resize",(function(e){t.resize(e)})),this.resize(),this.addEventListener("close",(function(){t.destroy()}))}},showPreferencesDialog:function(e){!this._prefDialog&&this.options._prefDialog&&(this._prefDialog=this.options._prefDialog),this._prefDialog||((e=Object.assign(e||{},this.options))._createDlg||(e._createDlg=this),this.options.blnForceRefreshPreferences&&(e.blnForceRefresh=!0,this.options.blnForceRefreshPreferences=!1),this._prefDialog=new r(e)),this._prefDialog.showDialog(e)},hideDialog:function(){this.elements.container&&this.elements.container.addClassName("wux-ui-animation-flip-out").removeClassName("wux-ui-animation-flip-in")},showDialog:function(e){e&&e.blnForceRefresh&&(this._prefDialog_Done=!0,this._updateParameterTypeDropdown(e)),this.elements.container&&this.elements.container.removeClassName("wux-ui-animation-flip-out").addClassName("wux-ui-animation-flip-in"),this.elements._modalDiv&&this.elements._modalDiv.inert&&(this.elements._modalDiv.inert=!1)},_createCollabSpaceDropdown:function(n,a){var r=this;r._collabSpaceDropdownAdded||(r.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-collabSpace td")&&(r.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-collabSpace td").innerHTML=""),r.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-organization td")&&(r.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-organization td").innerHTML=""),r.elements.mainDiv&&t.getAllCollaborativeSpaces().then((function(t){if(r._collabSpaceObject=t,t&&!$.isEmptyObject(t)){n=r.elements.mainDiv?e.extendElement(r.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-collabSpace td")):$(window.widget.body).closest(".moduleUwa").find(".create_new_tab_table").find(".collabSpace_dropdown"),a=r.elements.mainDiv?e.extendElement(r.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-organization td")):$(window.widget.body).closest(".moduleUwa").find(".create_new_tab_table").find(".organization_dropdown");var i=Object.keys(t),o=[];e.each(i,(function(e,t){t.replace(/\s+/g,"");o.push({labelItem:t,valueItem:t})}));var s="";window.widget&&(s=window.widget.getValue("pad_security_ctx")||window.widget.getValue("collabSpace")||window.widget.getValue("Credentials"));var l=r._fetchOrganizationFromContext(s),m=r._fetchCollabSpaceFromContext(s);r.elements._organizationDropdown=new g({elementsList:o,value:l,enableSearchFlag:!1,actionOnClickFlag:!1}),r.elements._organizationDropdown.inject(a),r.elements._organizationDropdown.getContent().addEventListener("change",(function(e){r._onOrganizationDropdownChange()})),r._collabSpaceDropdownListPair=[];var u=t[i[0]],c=r._parseCollabSpaceStrToObj(u),d=Object.keys(c);e.each(d,(function(e,t){r._collabSpaceDropdownListPair.push({labelItem:t,valueItem:c[t]})})),r.elements._collabSpaceDropdown=new g({elementsList:r._collabSpaceDropdownListPair,value:m,enableSearchFlag:!1,actionOnClickFlag:!1}),r.elements._collabSpaceDropdown.inject(n)}})))},resize:function(){var e=this.elements.mainDiv.querySelector(".listSectionTable");if(e){if(this.elements._uwaTree&&this.elements._uwaTree._getScroller()&&this.elements._uwaTree._getScroller().elements&&this.elements._uwaTree._getScroller().elements.container){var t=this.elements._uwaTree._getScroller().elements.container.scrollHeight;t>this.elements._uwaTree._getScroller().elements.container.clientHeight?(e.setStyle("height",t),this.elements.mainDiv.scrollHeight>this.elements.mainDiv.clientHeight&&e.setStyle("height",t-(this.elements.mainDiv.scrollHeight-this.elements.mainDiv.clientHeight))):t>100&&this.elements.mainDiv.scrollHeight>this.elements.mainDiv.clientHeight&&e.setStyle("height",Math.max(100,t-(this.elements.mainDiv.scrollHeight-this.elements.mainDiv.clientHeight)))}this.elements.mainDiv.clientHeight<e.offsetTop+120&&(this.height+=e.offsetTop-this.elements.mainDiv.clientHeight+120)}var n=this.getContent().querySelector("."+this.name+"-table");if(n&&this.elements.mainDiv.clientHeight<n.clientHeight&&(this.height+(n.clientHeight-this.elements.mainDiv.clientHeight)>=window.widget.body.clientHeight?this.height=window.widget.body.clientHeight:this.height+=n.clientHeight-this.elements.mainDiv.clientHeight),this.immersiveFrame&&this.elements._footerDiv&&this.elements._footerDiv.getBoundingClientRect){var a=this.elements._footerDiv.getBoundingClientRect(),r=this.immersiveFrame.elements.container.getBoundingClientRect();a&&a.bottom&&a.bottom>r.bottom&&(this.position=this._getDefaultPosition())}},onCreate:function(t){var a=this;return new Promise((function(r,i){if(!a.elements._inputName||!a.elements._inputDescription)return a._displayNotificationMessage("incomplete dialog!"),void i(new Error("incomplete dialog!"));if(!(a.elements._inputName.value||"").trim())return a._displayNotificationMessage(S.get("Missing Name")),void i(new Error("Missing Name"));var o=!1;a.listChanged("update",{});var s=[],l={V_Name:a.elements._inputName.value.trim(),V_description:(a.elements._inputDescription.value||"").trim(),target_param_list:a.options.parentModel,resourceParameterExtension:a.elements._parameterTypeDropdown&&a.elements._parameterTypeDropdown.currentValue||"",inputOutput:a.elements._direction.value[0],units:a.elements._unitsDropdown&&a.elements._unitsDropdown.currentValue||"",minValue:"",maxValue:"",minLimit:"",maxLimit:""};if(t&&o&&(l=t),o||(o=(l.resourceParameterExtension,!0)),o&&o){"String"===l.resourceParameterExtension||"Integer"===l.resourceParameterExtension?(l.V_Values=[],a._arrList&&a._arrList.length>0&&(l.V_Values=a._arrList),delete l.units,delete l.minValue,delete l.minLimit,delete l.maxValue,delete l.maxLimit):a.elements._parameterTypeDropdown&&""!==a.elements._parameterTypeDropdown.currentValue&&(l.minLimit=a.elements._minDropdown.currentValue,"NotSet"!==l.minLimit?l.minValue=a.elements._inputMinimum.value:delete l.minValue,l.maxLimit=a.elements._maxDropdown.currentValue,"NotSet"!==l.maxLimit?l.maxValue=a.elements._inputMaximum.value:delete l.maxValue);var m={},u={},c=a.elements.mainDiv.querySelector("."+a.name+"-table tr."+a.name+"-extensionAutoSection"),d=a.elements.mainDiv.querySelector("."+a.name+"-table tr."+a.name+"-extensionCustoRow");e.each([c,d],(function(t,r){if(r){var i=r.querySelector(".wux-controls-accordeon-container");if(i&&i.dsModel){var o=i.dsModel;o&&o.items&&o.items.length&&e.each(o.items,(function(t,r){if(r&&r.content&&r.objExtension&&r.objExtension.name){var i={};m[r.objExtension.name]=r.objExtension,r.objExtension.properties&&(m[r.objExtension.name].propertiesObj={},e.each(r.objExtension.properties,(function(t,o){m[r.objExtension.name].propertiesObj[o.name]=o;var l=r.content.querySelector('tr[data-extension-attribute="'+o.name+'"] td .wux-controls-abstract');if(l){var u=l.dsModel;u&&(o.dimension&&o.preferred_unit?s.push(new Promise((function(t,a){n.getMagnitudes({filter:"dimensionName+eq+"+o.dimension,magnitude:o.dimension}).then((function(r){if(r&&r[o.dimension]){var s=r[o.dimension].MKSUnit;return!s&&r[o.dimension].Units&&r[o.dimension].Units.length&&e.each(r[o.dimension].Units,(function(e,t){return t&&t.default&&(s=t.Name),!s})),s&&o.preferred_unit!==s?Array.isArray(u.value)?Promise.all(u.value.map((function(e){return n.convertValueToUnit({value:e,dimension:o.dimension,fromUnit:o.preferred_unit,toUnit:s})}))).then((function(e){i[o.name]=e.map(Number),t(i)}),a):n.convertValueToUnit({value:u.value,dimension:o.dimension,fromUnit:o.preferred_unit,toUnit:s}).then((function(e){i[o.name]=+e,t(i)}),a):(i[o.name]=u.value||"",void t())}a(new Error("unable to retrieve details for "+o.dimension))}))}))):"date"===u.range||u.value&&u.value instanceof Date?!u.value&&o.multi_valuated?i[o.name]="[]":(u.value.setMilliseconds(0),i[o.name]=e.Date.toDSDate(u.value)):o&&"ReadOnly"!==o.getUIAccess&&(i[o.name]=a._fetchCorrectExtensionAttributeValueByType(u,o,!1)))}}))),u[r.objExtension.name]=i,a.validate()}}))}}})),e.Object.isEmptyObject(u)||(l.extensions=u),a.enableDisableButtons(!1),a._handleLoadingButtons({dsModel:t&&t.button||a.buttons.Save},!0),Promise.all(s).then((function(){l&&l.extensions&&e.Object.isPlainObject(l.extensions)&&m&&e.each(l.extensions,(function(t,n){m[t]&&m[t].propertiesObj&&e.each(n,(function(e,r){var i=m[t].propertiesObj[e];i&&r&&i.range&&"String"!==i.range&&(n[i.name]=a._convertPropValueType(i,r,"number"))}))})),a._currentSelectedOntology&&a._currentSelectedOntology.uri&&(l.ontologySelected=a._currentSelectedOntology.uri),a.elements._collabSpaceDropdown&&a.elements._collabSpaceDropdown.value&&(l.currSecurityContext=a.elements._collabSpaceDropdown.value),n.createResourceParameter(l).then((function(n){a._handleLoadingButtons({dsModel:t&&t.button||a.buttons.Save},!1);var i=S.get("Resource Parameter");n&&1===n.length&&n[0].V_Name&&(i=e.String.escapeHTML(n[0].V_Name)),w.displayNotificationMessage(S.get("{0} Created",{0:i}),{level:"success"}),r(n)}),(function(e){a.enableDisableButtons(!0),a._handleLoadingButtons({dsModel:t&&t.button||a.buttons.Save},!1),e||(e=S.get("Error")),w.displayNotificationMessage(e),i(e)}))}),i)}}))},_fetchCorrectExtensionAttributeValueByType:function(t,n,a){var r=null;return t.type&&"switch"===t.type?("checkFlag"in t&&(r=""+t.checkFlag),a&&(r=r.toUpperCase())):n&&n.multi_valuated?t.value&&Array.isArray(t.value)?"Date"===n.range?(r=t.value,e.each(r,(function(t,n){r[t]=e.Date.toDSDate(new Date(n))}))):"Double"===n.range?(r=t.value,e.each(r,(function(e,t){r[e]=parseFloat(t)}))):r=t.value:r="Date"===n.range?[]:"":r=t.value||"",r},onParameterTypeDropdownChange:function(){var t=this,a=t.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-magnitudeProperties");t.elements._parameterTypeDropdown.currentValue?"__OTHER__"===t.elements._parameterTypeDropdown.currentValue?n.getMagnitudes({blnForceRefresh:!0}).then((function(n){var a=[{labelItem:S.get("Integer"),valueItem:"Integer"},{labelItem:S.get("Text"),valueItem:"String"}];n&&e.each(n,(function(e,t){t&&t.Name&&t.NLS&&a.push({labelItem:t.NLS,valueItem:t.Name})})),a=a.sort((function(e,t){return e&&t?t.valueItem?e.valueItem&&e.labelItem>t.labelItem?1:-1:1:0})),t.elements._parameterTypeDropdown.elementsList=a,t.elements._parameterTypeDropdown.selectedIndex=-1,t.elements._parameterTypeDropdown.enableSearchFlag=!0,t.resize()}),(function(e){e||(e=S.get("Error")),w.displayNotificationMessage(e)})):"Integer"===t.elements._parameterTypeDropdown.currentValue||"String"===t.elements._parameterTypeDropdown.currentValue?(a&&a.remove&&t.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-magnitudeProperties").remove(),t._currentSelectedOntology&&t._currentSelectedOntology.possibleValues?t._populateListSection(t._currentSelectedOntology.possibleValues):t._populateListSection()):t._currentSelectedOntology?t._populateAllMagnitudesSection(t._currentSelectedOntology):t._populateAllMagnitudesSection():a&&a.remove&&t.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-magnitudeProperties").remove(),t.resize(),""===t.elements._parameterTypeDropdown.currentValue?t.enableDisableButtons(!1):""!==t.elements._parameterTypeDropdown.currentValue&&t.enableDisableButtons(!0),t.validate(),(this.elements._inputName.value||"").trim()||t.enableDisableButtons(!1)},onParameterOntologyDropdownChange:function(){var t=this;if(t.elements._parameterOntologyDropdown.currentValue&&""!==t.elements._parameterOntologyDropdown.currentValue)""!==t.elements._parameterOntologyDropdown.currentValue&&n.getDefinedParameterOntologies().then((function(n){var a=null,r=0;t._currentSelectedOntology=null,n&&e.each(n,(function(e,i){if(r++,i&&i.uri===t.elements._parameterOntologyDropdown.currentValue&&(a=i,t._currentSelectedOntology=a),n.length===r&&a){if(a.labelNLS&&(t.elements._inputName.value=a.labelNLS,t.elements._inputName.disabled=!0),a.descriptionNLS?(t.elements._inputDescription.value=a.descriptionNLS,t.elements._inputDescription.disabled=!0):(t.elements._inputDescription.value="",t.elements._inputDescription.disabled=!1),!t.options.resourceParameter){var o=null;if(a.dimension||"dimension"in a?o="ArbitraryUnit"===a.dimension?a.dimension.toUpperCase():a.dimension:(a.type||"type"in a)&&(o=a.type),o){t.elements._parameterTypeDropdown.value="__OTHER__";var s=function(){t.elements._parameterTypeDropdown.enableSearchFlag?(t.elements._parameterTypeDropdown.value=t.elements._parameterTypeDropdown.elementsList[0].valueItem,t.elements._unitsDropdown&&t.elements._unitsDropdown.elementsList&&t.elements._unitsDropdown.elementsList.length>0&&(t.elements._unitsDropdown.elementsList=[]),t.elements._parameterTypeDropdown.value=o,t.elements._parameterTypeDropdown.disabled=!0):setTimeout(s,250)};s()}}t._currentSelectedOntology&&t._currentSelectedOntology.possibleValues&&t._populateListSection(t._currentSelectedOntology.possibleValues),(t._currentSelectedOntology.extension||"extension"in t._currentSelectedOntology)&&t._populateExtensionSection(t._currentSelectedOntology)}}))}),(function(e){e||(e=S.get("Error")),w.displayNotificationMessage(e)}));else{t._currentSelectedOntology=null,t.elements._inputName.value="",t.elements._inputName.disabled=!1,t.elements._inputDescription.value="",t.elements._inputDescription.disabled=!1,t.elements._parameterTypeDropdown.currentValue="",t.elements._parameterTypeDropdown.disabled=!1;var a=t.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-magnitudeProperties"),r=t.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-listSection"),i=t.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-simpleToolbar");t.elements._parameterTypeDropdown.currentValue||(a&&a.remove&&t.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-magnitudeProperties").remove(),r&&r.remove&&t.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-listSection").remove(),i&&i.remove&&t.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-simpleToolbar").remove()),t._populateExtensionSection(t._currentSelectedOntology),t.resize()}},_fetchUnitFromParameterOntologyId:function(e,t){for(var n=0;n<t.length;n++){var a=t[n];if(a.uri===e){if(a.hasOwnProperty("label"))return a.label;if(a.hasOwnProperty("symbol"))return a.symbol;if(a.hasOwnProperty("labelNLS"))return a.labelNLS;if(a.hasOwnProperty("symbolNLS"))return a.symbolNLS}}},_populateListSection:function(t){var n=this,a=n.elements.mainDiv.querySelector("table.DELWebResourceParameterDlg-table");n.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-magnitudeProperties")&&n.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-magnitudeProperties").remove();var r=n.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-simpleToolbar");r&&(n.elements._uwaTree=null,n.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-simpleToolbar").remove());var i=n.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-listSection");i&&(n.elements._uwaTree=null,n.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-listSection").remove());var o=-1;a.rows&&e.each(a.rows,(function(t,a){return a&&e.extendElement(a).hasClassName(n.name+"-V_ParameterType")&&(o=t+1),o<0})),(r=a.insertRow(o++)).className=this.name+"-simpleToolbar",(n._currentSelectedOntology||n.options&&n.options.resourceParameter&&n.options.resourceParameter["DELParameterIdentifierExt.V_ParameterIdentifier"]&&n.options.resourceParameter["DELParameterIdentifierExt.V_ParameterIdentifier"].parameterId)&&(r.style.display="none");var s=e.createElement("td");(s=r.insertCell()).colSpan="2";var l=e.createElement("div");l.innerHTML='<div class="simple_toolbar_title"></div><div class="simple_toolbar_iconNew"><div class="sectionheader_button_icon wux-ui-3ds wux-ui-3ds-plus" title="'+S.get("New")+'"></div></div><div class="simple_toolbar_iconDelete"><div class="sectionheader_button_icon wux-ui-3ds wux-ui-3ds-trash" title="'+S.get("Delete")+'"></div></div>',l.className="simpleToolbar",s.appendChild(l),(i=a.insertRow(o++)).className=this.name+"-listSection";var m=i.insertCell();m.colSpan="2";var u=e.createElement("div");u.className="listSectionTable",m.appendChild(u),t?n.addRootNodesFromData(t):n.addRootNodesFromData(),n.elements.mainDiv.querySelector(".sectionheader_button_icon.wux-ui-3ds-plus").addEventListener("click",(function(e){n.onNewDefinitionCallback(e)})),n.elements.mainDiv.querySelector(".sectionheader_button_icon.wux-ui-3ds-trash").addEventListener("click",(function(e){n.onDeleteDefinitionCallback(e)}))},_populateExtensionSection:function(n){var a=this,r=null,o=null,l=null;if(a.elements&&a.elements.mainDiv){r=a.elements.mainDiv.querySelector("."+this.name+"-table tr."+this.name+"-extensionAutoSection"),o=a.elements.mainDiv.querySelector("."+this.name+"-table tr."+this.name+"-extensionAddRemoveRow"),l=a.elements.mainDiv.querySelector("."+this.name+"-table tr."+this.name+"-extensionCustoRow");var m=null;r?(r.empty||e.extendElement(r),r.empty()):(m||(m=a.elements.mainDiv.querySelector("table.DELWebResourceParameterDlg-table")),(r=m.insertRow(-1)).className=this.name+"-extensionAutoSection");var u=r.insertCell();u.colSpan="2",i.mask(u,S.get("Loading {0}",{0:S.get("Extensions")}));var c="Input";this.options&&this.options.resourceParameter&&this.options.resourceParameter.plmObjectType?c=this.options.resourceParameter.plmObjectType&&this.options.resourceParameter.plmObjectType.indexOf("OUTPUT")>0?"Output":"Input":this.elements&&this.elements._direction&&this.elements._direction.value&&this.elements._direction.value.length&&(c=this.elements._direction.value[0]||"Input");var d="DELResourcePrm"+c.toUpperCase();t.getServiceUrl({serviceName:"3DSpace"}).then((function(p){a._SpaceURL=p,t.getExtensions({class_name:[d,"DELResourcePrmAbstract"],blnIncludeParent:!0,blnCustoOnly:!0,blnGetProperties:!0}).then((function(t){if(a.elements&&a.options&&a.options.resourceParameter&&a.options.resourceParameter.plmObjectType||a.elements&&a.elements._direction&&!(a.elements._direction.value.indexOf(c)<0)){if(i.unmask(u),!t||!e.Object.isPlainObject(t)||e.Object.isEmptyObject(t))return r.remove(),o&&r.remove(),void(l&&l.remove());var d={},p={},g={},v={};e.each(t,(function(t,n){e.each(n,(function(t,n){n.isAbstract||n.name&&p[n.name]?p[n.name]?p[n.name]=Object.assign(p[n.name],n):p[n.name]=n:n.name&&(d[n.name]?d[n.name]=Object.assign(d[n.name],n):d[n.name]=n,d[n.name].isDeploymentInterface?d[n.name].isAutomaticDeploymentInterface?g[n.name]=d[n.name]:a.options.resourceParameter&&a.options.resourceParameter.interfaces&&e.each(a.options.resourceParameter.interfaces,(function(e,t){return t.indexOf(n.name)>=0&&(g[n.name]=d[n.name]),!(n.name in g)})):v[n.name]=d[n.name])}))})),a.options&&a.options.resourceParameter&&a.options.resourceParameter.interfaces&&a.options.resourceParameter.interfaces.length&&e.each(a.options.resourceParameter.interfaces,(function(t,n){var r=[],i=n.length;e.each(n,(function(t,n){"SymbolicID"===n||n.includes("DELRscPrmIO")||(r[t]=n,i===r.length&&(a.options.resourceParameter.extensions&&e.each(a.options.resourceParameter.extensions,(function(t,n){t&&v[t]&&v[t].properties&&e.each(v[t].properties,(function(e,a){(a&&a.name&&n[a.name]||a&&a.name&&r.indexOf(t)>0)&&(a.default_value=n[a.name])}))})),e.each(r,(function(e,t){e>0&&t&&v[t]&&delete v[t]}))))}))})),p&&!e.Object.isEmptyObject(p)&&e.each(p,(function(e){g[e]&&delete g[e],v[e]&&delete v[e]}));var b=Object.values(g),D=Object.values(v);if(b.length){var h=a._populateExtensionAccordionSection(b),f=new s({items:h,arrowVisibleFlag:!0});f.getContent().addClassName(a.name+"-autoCustoAccordeon"),f.inject(u),a.validate()}if(D.length){o?(o.empty||e.extendElement(o),o.empty()):(m||(m=a.elements.mainDiv.querySelector("table.DELWebResourceParameterDlg-table")),(o=m.insertRow(-1)).className=a.name+"-extensionAddRemoveRow");var y=e.createElement("th");y.innerText=S.get("Extensions"),o.appendChild(y);var P=o.insertCell();l?(l.empty||e.extendElement(l),l.empty()):(m||(m=a.elements.mainDiv.querySelector("table.DELWebResourceParameterDlg-table")),(l=m.insertRow(-1)).className=a.name+"-extensionCustoRow");var w=l.insertCell();w.colSpan="2";var x=a._populateExtensionAccordionSection(D),E=[],N=[],L=[];e.each(x,(function(e,t){var r={label:t.header,value:t.objExtension.name,icon:t.objExtension.IconPath||t.objExtension.LargeIconPath||""};r.icon&&(r.icon.indexOf("http")<0&&r.icon.indexOf("/")>=0?r.icon=a._SpaceURL+"/webapps/"+r.icon:r.icon.indexOf("/")<0&&(r.icon={iconName:r.icon,fontIconFamily:window.WUXManagedFontIcons.Font3DS})),N.push(r),(a.options&&a.options.resourceParameter&&a.options.resourceParameter.extensions&&a.options.resourceParameter.extensions[t.objExtension.name]||n&&n.extension&&n.extension.indexOf(t.objExtension.name)>-1)&&(E.push(t.objExtension.name),L.push(t))})),N=N.sort((function(e,t){return e&&t?t.label?e.label&&e.label.toLowerCase()>t.label.toLowerCase()?1:-1:1:0}));var C=new _({elementsTree:N,allowFreeInputFlag:!1});if(a._blnIsUnitsInDropdownListPair?C.disabled=!1:C.disabled=!0,C.getContent().addClassName(a.name+"-custoAutoComplete"),C.inject(P),E.length>0&&(E=E.sort((function(e,t){return e&&t&&v[e]&&v[t]?(v[e].nlsName||e).toLowerCase()>(v[t].nlsName||t).toLowerCase()?1:-1:0})),C.value=E),a.options&&a.options.resourceParameter&&a.options.resourceParameter.ontologySet||a._currentSelectedOntology)if(a.elements.mainDiv.querySelectorAll(".wux-chip-cell-container .wux-chip-cell-close").length>0)a.elements.mainDiv.querySelectorAll(".wux-chip-cell-container .wux-chip-cell-close").forEach((e=>{e.classList.add("ontologyExtension"),e.style.display="none"}));L=L.sort((function(e,t){return e&&t?t.label?e.label&&e.label.toLowerCase()>t.label.toLowerCase()?1:-1:1:0}));var T=new s({items:L,arrowVisibleFlag:!0});T.getContent().addClassName(a.name+"-custoAccordeon"),T.inject(w),a.validate(),C.addEventListener("change",(function(){e.each(C.value||[],(function(t,n){var r=!1;if(a.validate(),T.items&&T.items.length&&(r=T.items.find((function(e){return e&&e.objExtension&&e.objExtension.name===n}))),r){if(r.content){r.content.getClosest||e.extend(r.content);var o=r.content.getClosest(".wux-controls-expander");if(o){if(o.hasClassName(a.name+"-deletePending")){var s=o.querySelector(".masked");s&&i.unmask(s),o.removeClassName(a.name+"-deletePending")}o.dsModel&&o.dsModel.expand&&o.dsModel.expand()}}}else a._populateExtensionAccordionSection([d[n]],T)}))})),C.addEventListener("onPostRemove",(function(t){var n=!1;T.items&&T.items.length&&(n=T.items.find((function(e){return e&&e.objExtension&&e.objExtension.name===t.options.chips[0].chipOptions.value.options.value}))),e.each(T.items,(function(r,o){if(o&&o.objExtension&&o.objExtension.name&&o.objExtension.name===t.options.chips[0].chipOptions.value.options.value){if(!(a.options.resourceParameter&&a.options.resourceParameter.extensions&&a.options.resourceParameter.extensions[o.objExtension.name]))return void T.deleteItem(T.getIndexFrom(n));if(n.content){n.content.getClosest||e.extend(n.content);var s=n.content.getClosest(".wux-controls-expander");if(s)return s.addClassName(a.name+"-deletePending"),s.dsModel.expand(),void i.mask(s,S.get("Extension removed upon Save"));window.steal.dev.log(a.name+"::_populateExtensionSection - invalid expander found for delete!")}}}))})),a.resize()}}}),(function(e){e||(e=S.get("Error")),w.displayNotificationMessage(e)}))}),(function(e){e||(e=S.get("Error")),w.displayNotificationMessage(e)}))}else setTimeout((function(){a._populateExtensionSection()}),250)},_populateExtensionAccordionSection:function(t,a){var r=this,i=[];return e.each(t,(function(t,a){var o={objExtension:a,header:a.nlsName||a.name};if(a.IconPath||a.LargeIconPath){var s=a.IconPath||a.LargeIconPath;s.indexOf("http")<0&&s.indexOf("/")>=0?o.icon=r._SpaceURL+"/webapps/"+s:s.indexOf("/")>=0?o.icon=s:o.icon={iconName:s,fontIconFamily:window.WUXManagedFontIcons.Font3DS}}a.properties&&a.properties.length?(o.content=e.createElement("table"),e.each(a.properties,(function(t,i){var s=o.content.insertRow(-1);s.setAttribute("data-extension-attribute",i.name);var l=e.createElement("th").appendText(i.nlsName||i.name);if(i.isMandatory){var d=e.createElement("span",{class:"mandIcon wux-ui-3ds wux-ui-3ds-new-create"});l.appendChild(d)}s.appendChild(l);var D=e.createElement("td"),h=null,f=null;if(i.getUIAccess&&"ReadOnly"===i.getUIAccess)f={objProperty:i,value:i.default_value,autoCommitFlag:!0},h=new v(f);else if(!(r.options.resourceParameter&&r.options.resourceParameter.extensions&&r.options.resourceParameter.extensions[a.name]&&i.getUIAccess&&"ReadWrite"!==i.getUIAccess))if(f={objProperty:i,value:i.default_value,autoCommitFlag:!0},"TIME"===(i.dimension||"").toUpperCase())if(i.isMandatory&&(f.requiredFlag=!0),i.preferred_unit&&"SECOND"!==i.preferred_unit&&"MINUTE"!==i.preferred_unit)h=new u(f);else{var y=Object.assign({precision:"sec",mode:"duration",minutesStep:1,secondsStep:10},f);"MINUTE"===i.preferred_unit&&(y.precision="min");var P=new Date(0,0,0,0,0,0);P.setSeconds(f.value),y.value=P,h=new b(y)}else if("Date"===i.range)i.isMandatory&&(f.requiredFlag=!0),delete f.value,f.timePickerFlag=!0,f.timePickerPrecision="sec",i.multi_valuated&&(f.allowMultipleValuesFlag=!0),i&&""===i.default_value?(f.allowUndefinedFlag=!0,f.value=void 0):i&&""!==i.default_value&&(f.allowUndefinedFlag=!1,f.value=i.default_value),h=new m(f);else if("Boolean"!==i.range||i.multi_valuated)if(i.multi_valuated)i.isMandatory&&(f.requiredFlag=!0),f.objProperty.authorized_values&&(f.allowFreeInputFlag=!1,"string"==typeof f.objProperty.authorized_values&&(f.objProperty&&"Boolean"===f.objProperty.range?f.objProperty.authorized_values=JSON.parse(f.objProperty.authorized_values.replace(/TRUE/g,"true").replace(/FALSE/g,"false")):f.objProperty&&"String"===f.objProperty.range?f.objProperty.authorized_values=f.objProperty.authorized_values.slice(1,-1).split(",").map((e=>e.trim())):f.objProperty.authorized_values=JSON.parse(f.objProperty.authorized_values)),Array.isArray(f.objProperty.authorized_values)?f.elementsTree=f.objProperty.authorized_values:f.elementsTree=[f.objProperty.authorized_values]),h=new _(f),r.options.resourceParameter||(0===h.value.length&&i.isMandatory&&h.elements.container.addClassName("invalid-input"),h.value.length>0&&i.isMandatory&&h.elements.container.hasClassName("invalid-input")&&h.elements.container.removeClassName("invalid-input"));else if(i.authorized_values&&"string"==typeof i.authorized_values&&"["===i.authorized_values[0]&&"]"===i.authorized_values[i.authorized_values.length-1]){f=Object.assign(f,{elementsList:[],enableSearchFlag:!1,actionOnClickFlag:!1}),i.isMandatory&&(f.requiredFlag=!0);var x=i.authorized_values.substring(1,i.authorized_values.length-1);e.each(x.split(","),(function(e,t){t=t.trim(),f.elementsList.push({labelItem:t,valueItem:t})})),h=new g(f)}else i.isMultiline?(i.isMandatory&&(f.requiredFlag=!0),f.newLineMode="enter",f.resizableFlag="vertical",h=new p(f)):(i.isMandatory&&(f.requiredFlag=!0),h=new u(f));else i.isMandatory&&(f.requiredFlag=!0),f.type="switch",f.checkFlag="true"===f.value.toLowerCase(),f.value="true",h=new c(f);var E=null;if(h||(E=e.createElement("span").inject(D)),r.options&&r.options.resourceParameter&&r.options.resourceParameter.extensions&&r.options.resourceParameter.extensions[a.name]&&!(i.name in r.options.resourceParameter.extensions[a.name])&&e.each(r.options.resourceParameter.interfaces,(function(t,n){n&&Array.isArray(n)&&n[0]===a.name&&e.each(n,(function(e,t){r.options.resourceParameter.extensions[t]&&r.options.resourceParameter.extensions[t][i.name]&&(r.options.resourceParameter.extensions[a.name][i.name]=r.options.resourceParameter.extensions[t][i.name])}))})),r.options&&r.options.resourceParameter&&r.options.resourceParameter.extensions&&r.options.resourceParameter.extensions[a.name]&&i.name in r.options.resourceParameter.extensions[a.name])if(i.dimension&&i.preferred_unit)h&&(h.disabled=!0),new Promise((function(t,o){if(r.options.resourceParameter.extensions[a.name][i.name+".displayValue"])return h?h.value=r.options.resourceParameter.extensions[a.name][i.name+".displayValue"]:E&&(E.innerText=r.options.resourceParameter.extensions[a.name][i.name+".displayValue"]),void t();n.getMagnitudes({filter:"dimensionName+eq+"+i.dimension,magnitude:i.dimension}).then((function(s){if(s&&s[i.dimension]){var l=s[i.dimension].MKSUnit;if(!l&&s[i.dimension].Units&&s[i.dimension].Units.length&&e.each(s[i.dimension].Units,(function(e,t){return t&&t.default&&(l=t.Name),!l})),!l||i.preferred_unit===l)return h?h.value=r.options.resourceParameter.extensions[a.name][i.name]:E&&(E.innerText=r.options.resourceParameter.extensions[a.name][i.name]),void t();n.convertValueToUnit({value:r.options.resourceParameter.extensions[a.name][i.name],dimension:i.dimension,fromUnit:l,toUnit:i.preferred_unit}).then((function(e){isNaN(e)?o():(e=+e,r.options.resourceParameter.extensions[a.name][i.name+".displayValue"]=e,e=Math.round(1e6*(e+Number.EPSILON))/1e6,h?h.value=e:E&&(E.innerText=e),t(e))}),o)}}),o)})).then((function(){h&&(h.disabled=!1)}),(function(e){h&&(h.disabled=!1),e||(e=S.get("Error")),w.displayNotificationMessage(e)}));else if(h&&Array.isArray(h.value)&&!Array.isArray(r.options.resourceParameter.extensions[a.name][i.name])){var N=r.options.resourceParameter.extensions[a.name][i.name],L=[];N&&"string"==typeof N&&"["===N[0]&&"]"===N[N.length-1]?(N=N.substring(1,N.length-1),e.each(N.split(","),(function(e,t){t=t.trim(),L.push(t)}))):L.push(N),h.value=L}else!h||h instanceof b?E&&(E.innerText=r.options.resourceParameter.extensions[a.name][i.name+".displayValue"]||r.options.resourceParameter.extensions[a.name][i.name]):("switch"===h.type&&("string"==typeof(h.checkFlag=r.options.resourceParameter.extensions[a.name][i.name+".displayValue"]||r.options.resourceParameter.extensions[a.name][i.name])?h.checkFlag="true"===(r.options.resourceParameter.extensions[a.name][i.name+".displayValue"]||r.options.resourceParameter.extensions[a.name][i.name]).toLowerCase():h.checkFlag=!0===(r.options.resourceParameter.extensions[a.name][i.name+".displayValue"]||r.options.resourceParameter.extensions[a.name][i.name])),h.value=r.options.resourceParameter.extensions[a.name][i.name+".displayValue"]||r.options.resourceParameter.extensions[a.name][i.name],(Array.isArray(h.value)||e.Object.isPlainObject(h.value))&&("Boolean"===i.range&&h._applyElementsTree(),h.value=r._convertPropValueType(i,r.options.resourceParameter.extensions[a.name][i.name],"string")),r.options.resourceParameter&&(0===h.value.length&&i.isMandatory&&h.elements.container.addClassName("invalid-input"),h.value.length>0&&i.isMandatory&&h.elements.container.hasClassName("invalid-input")&&h.elements.container.removeClassName("invalid-input")));else"Double"!==i.range||r.options.resourceParameter||i.dimension&&i.preferred_unit&&(h&&(h.disabled=!0),new Promise((function(t,a){n.getMagnitudes({filter:"dimensionName+eq+"+i.dimension,magnitude:i.dimension}).then((function(r){if(r&&r[i.dimension]){var o=r[i.dimension].MKSUnit;if(!o&&r[i.dimension].Units&&r[i.dimension].Units.length&&e.each(r[i.dimension].Units,(function(e,t){return t&&t.default&&(o=t.Name),!o})),!o||i.preferred_unit===o)return h?h.value=i.default_value:E&&(E.innerText=i.value),void t();i.default_value&&""!==i.default_value?n.convertValueToUnit({value:i.default_value,dimension:i.dimension,fromUnit:o,toUnit:i.preferred_unit}).then((function(e){isNaN(e)?a():(e=+e,e=Math.round(1e6*(e+Number.EPSILON))/1e6,h?h.value=e:E&&(E.innerText=e),t(e))}),a):(i.default_value=+i.default_value,h?h.value=i.default_value:E&&(E.innerText=i.default_value),t())}}),a)})).then((function(){h&&(h.disabled=!1)}),(function(e){h&&(h.disabled=!1),e||(e=S.get("Error")),r._displayNotificationMessage(e)})));if(h)h.inject(D),h.getContent().addEventListener("change",(function(){h.value.length>0&&i.isMandatory&&h.elements.container.hasClassName("invalid-input")?h.elements.container.removeClassName("invalid-input"):0===h.value.length&&i.isMandatory&&!h.elements.container.hasClassName("invalid-input")&&h.elements.container.addClassName("invalid-input"),r.validate()})),"ReadOnly"===i.getUIAccess?h.placeholder=S.get("Read Only Attribute After Creation"):"None"===i.getUIAccess&&(h.placeholder=S.get("Attribute Not Visible After Creation")),i.dimension&&!(h instanceof u)||!h.elements.inputField||"Double"!==i.range&&"Integer"!==i.range||(h.elements.inputField.type="number","Double"===i.range?h.elements.inputField.step=1e-6:"Integer"===i.range&&(h.elements.inputField.step=1)),i.max_length&&i.max_length>0&&(h instanceof u||h instanceof p)&&(h.maxLength=i.max_length,h.placeholder=S.get("Maximum Length: {0}",{0:i.max_length}));else if("ReadOnly"===i.getUIAccess)h=E||e.createElement("span").inject(D),r.options.resourceParameter&&r.options.resourceParameter.extensions&&r.options.resourceParameter.extensions[a.name]&&r.options.resourceParameter.extensions[a.name][i.name]&&(h.innerText||(h.innerText=r.options.resourceParameter.extensions[a.name][i.name]));else if("None"===i.getUIAccess)return void s.remove();if(h&&i.dimension){h.elements&&h.elements.container?h.elements.container.addClassName("has-dimension"):h.nodeType&&h.nodeType===window.Node.ELEMENT_NODE&&h.addClassName("has-dimension");var C=[];n.getMagnitudeUnits({magnitude:i.dimension}).then((function(t){if(t&&(C.length=0,e.each(t,(function(e,t){if(t&&t.Name){var n={labelItem:t.NLSName||t.label||"",valueItem:t.Name};(i.preferred_unit&&i.preferred_unit===t.Name||!i.preferred_unit&&t.default&&!0===t.default)&&(n.default=!0),C.push(n)}})),C=C.sort((function(e,t){return e&&t?t.valueItem?e.valueItem&&e.labelItem.toLowerCase()>t.labelItem.toLowerCase()?1:-1:1:0})))){var n=null;e.each(C,(function(e,t){return t.default&&!0===t.default&&(n=e),null===n})),n>=0&&(new v({value:C[n].labelItem}).inject(D).options.unit=C[n])}}))}s.appendChild(D)}))):o.content=e.createElement("div").appendText(S.get("No {0}",{0:S.get("Attributes")})),i.push(o)})),a&&e.each(i,(function(e,t){a.addItem(t),a.expandItem(a.getIndexFrom(t))})),i},_updateParameterTypeDropdown:function(t){var a=this;n.getDefaultMagnitudes().then((function(n){if(a.elements._parameterTypeDropdown){var r=null;t&&t.dimensionList&&(r=t.dimensionList.split(";"));var i=[];n&&e.each(n,(function(e,t){t&&t.Name&&t.NLS&&(r&&r.length>0?r.indexOf(t.Name+"Parameter")>-1&&i.push({labelItem:t.NLS,valueItem:t.Name}):i.push({labelItem:t.NLS,valueItem:t.Name}))})),(i=i.sort((function(e,t){return e&&t?t.valueItem?e.valueItem&&e.labelItem>t.labelItem?1:-1:1:0}))).unshift({labelItem:S.get("Select"),valueItem:""}),i.push({labelItem:" -- "+S.get("Other")+" -- ",valueItem:"__OTHER__"}),a.elements._parameterTypeDropdown&&a.elements._parameterTypeDropdown.elements&&a.elements._parameterTypeDropdown.elements&&(a.blnPreventSelectedIndexUpdate=!0,a.elements._parameterTypeDropdown.elementsList=[],a.elements._parameterTypeDropdown.elementsList=i,a.blnPreventSelectedIndexUpdate=!1)}}),(function(e){e||(e=S.get("Error")),w.displayNotificationMessage(e)}))},addRootNodesFromData:function(t){var n=this,a=[];!t||!Array.isArray(t)||t.length<=0?(a.push({dsModel:null,inEditMode:!0,grid:{tree:null}}),n.elements._parameterTypeDropdown&&("Integer"===n.elements._parameterTypeDropdown.currentValue?a[0].grid.tree=0:"String"===n.elements._parameterTypeDropdown.currentValue&&(a[0].grid.tree=""))):e.each(t,(function(e,r){var i={label:r,dsModel:r,inEditMode:!0,grid:{tree:r}};t.length&&n._currentSelectedOntology&&(i.inEditMode=!1),a.push(i)})),n.addRootNodesToTable(a)},addRootNodesToTable:function(t){var n=this;return new Promise((function(a,r){!t||!Array.isArray(t)||t.length<=0?a([]):n.addTable().then((function(r){var i=r.getTreeDocument(),o=[];r.prepareUpdateView(),e.each(t,(function(e,t){var a=new P(t);a.dsModel=t.dsModel,i.addRoot(a),n.listChanged("add",a),o.push(a)})),r.pushUpdateView({updateCellContent:!0,updateCellLayout:!0},!0),n.resize(),n.validateIntegerStringList(null),a(o)}),r)}))},addTable:function(e){var t=this;return new Promise((function(n){if(t.elements._uwaTree)n(t.elements._uwaTree);else{e||(e={});var a={treeDocument:new f({shouldAcceptDrop:function(e){return"middle"!==e.dropPosition&&e.draggedTreeNodeModel.getParent()===e.dropNode.getParent()}}),cellSelection:"none",rowDragEnabledFlag:!0,enableListSelection:!0,maxVisibleRowCount:4,cellDragEnabledFlag:!1,canMultiSelect:!0,columns:[{editableFlag:!0,sortableFlag:!1,editionPolicy:"EditionInPlace",dataIndex:"tree",typeRepresentation:"string"}]};t._currentSelectedOntology&&t._currentSelectedOntology.possibleValues&&t._currentSelectedOntology.possibleValues.length&&(a.columns[0].editableFlag=!1,a.rowDragEnabledFlag=!1,t.elements.mainDiv.querySelector(".sectionheader_button_icon.wux-ui-3ds-plus").setAttribute("disabled","disabled"),t.elements.mainDiv.querySelector(".sectionheader_button_icon.wux-ui-3ds-trash").setAttribute("disabled","disabled")),t.elements._parameterTypeDropdown&&"Integer"===t.elements._parameterTypeDropdown.currentValue&&(a.columns[0].typeRepresentation="integer",a.columns[0].getCellSemantics=function(){return{stepValue:1}}),a.treeDocument||(a.treeDocument=new f({shouldAcceptDrop:function(e){return"middle"!==e.dropPosition&&e.draggedTreeNodeModel.getParent()===e.dropNode.getParent()}})),e.container||(e.container=t.elements.mainDiv.getElementsByClassName("listSectionTable"),e.container&&1===e.container.length&&(e.container=e.container[0])),t.elements._uwaTree=new h(a).inject(e.container),t.elements._uwaTree.layout.columnsHeader=!1,t.elements._uwaTree.rowSelection="multiple",t.elements._uwaTree.columnSelection="none",t.elements._uwaTree.cellSelection="none",t.elements._uwaTree.addEventListener("postEdit",(function(e,n){t.listChanged("update",n)})),t.elements._uwaTree.addEventListener("dragend",(function(){t.listChanged("update")})),t.elements._uwaTree.getContainingImmersiveFrame&&!t.elements._uwaTree._getContainingImmersiveFrame&&(t.elements._uwaTree._getContainingImmersiveFrame=t.elements._uwaTree.getContainingImmersiveFrame,t.elements._uwaTree.getContainingImmersiveFrame=function(){var e=t._getContainingImmersiveFrame();return e||(e=t.immersiveFrame||t.options.immersiveFrame),e}),n(t.elements._uwaTree)}}))},onNewDefinitionCallback:function(){var t=this;if(t.elements._uwaTree){var n={dsModel:null,inEditMode:!0,icons:[],grid:{tree:null}};t.elements._parameterTypeDropdown&&("Integer"===t.elements._parameterTypeDropdown.currentValue?n.grid.tree=0:"String"===t.elements._parameterTypeDropdown.currentValue&&(n.grid.tree="")),t.addRootNodesToTable([n],(function(t){t&&t.length&&e.each(t,(function(e,t){t.options.inEditMode=!0,t.updateOptions(t.options),t.select()}))})),t.validateIntegerStringList(null),t.validate()}else setTimeout((function(){t._addByTableRow()}),250)},listChanged:function(){var t=this,n=[];if(t.elements._uwaTree){var a=t.elements._uwaTree.getTreeDocument().getRoots();a&&a.length>0?e.each(a,(function(e,a){if("string"==typeof a._options.grid.tree&&a._options.grid.tree&&""!==a._options.grid.tree){if(t.elements._parameterTypeDropdown&&"Integer"===t.elements._parameterTypeDropdown.currentValue||t.options.resourceParameter&&("Integer"===t.options.resourceParameter.parameter_type||"IntegerValue"===t.options.resourceParameter.parameter_type)){if(isNaN(a._options.grid.tree))return t.enableDisableButtons(!1),t.validateIntegerStringList(!0),!1;"string"==typeof a._options.grid.tree&&(a._options.grid.tree=parseInt(a._options.grid.tree))}n[e]=a._options.grid.tree,t._arrList=n}else if("number"==typeof a._options.grid.tree){if((t.elements._parameterTypeDropdown&&"Integer"===t.elements._parameterTypeDropdown.currentValue||t.options.resourceParameter&&("Integer"===t.options.resourceParameter.parameter_type||"IntegerValue"===t.options.resourceParameter.parameter_type))&&isNaN(a._options.grid.tree))return t.enableDisableButtons(!1),t.validateIntegerStringList(!0),!1;n[e]=a._options.grid.tree,t._arrList=n}return t.validateIntegerStringList(null),!0})):t._arrList&&t._arrList.length&&(t._arrList=n)}},_addByTableRow:function(){var t=this;if(t.element)if(t.elements._uwaTree){var n={useAsyncPreExpand:!0,dsModel:null,grid:{tree:null}};t.elements._parameterTypeDropdown&&("Integer"===t.elements._parameterTypeDropdown.currentValue?n.grid.tree=0:"String"===t.elements._parameterTypeDropdown.currentValue&&(n.grid.tree="")),t.addRootNodesToTable([n],(function(t){t&&t.length&&e.each(t,(function(e,t){t.options.inEditMode=!0,t.updateOptions(t.options)}))})),t.validateIntegerStringList(null)}else setTimeout((function(){t._addByTableRow()}),250)},onDeleteDefinitionCallback:function(t){var n=this;if(t){t.stopPropagation&&t.stopPropagation();var a=(n.elements._uwaTree.getDocument?n.elements._uwaTree.getDocument():n.elements._uwaTree.getTreeDocument()).getSelectedNodes();e.each(a,(function(e,t){if(t&&t.isSelected()){var a=t._getRowID();n._remove_a_row(a)}})),n.validate()}else window.steal.dev.log(n.constructor.fullName+"::onDeleteDefinitionCallback - invalid event!")},_remove_a_row:function(e){var t=this;if(t.elements._uwaTree&&!isNaN(e)){var n=t.elements._uwaTree.getTreeDocument().getNthRoot(e);n.remove(),t.listChanged("remove",n)}},_populateAllMagnitudesSection:function(t){var a=this,r=a.elements.mainDiv.querySelector("table.DELWebResourceParameterDlg-table");a.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-magnitudeProperties")&&a.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-magnitudeProperties").remove(),a.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-simpleToolbar")&&(a.elements._uwaTree=null,a.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-simpleToolbar").remove()),a.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-listSection")&&(a.elements._uwaTree=null,a.elements.mainDiv.querySelector(".DELWebResourceParameterDlg-table tr.DELWebResourceParameterDlg-listSection").remove());var i=-1;r.rows&&e.each(r.rows,(function(t,n){return n&&e.extendElement(n).hasClassName(a.name+"-V_ParameterType")&&(i=t+1),i<0}));var o=r.insertRow(i++);o.className=this.name+"-magnitudeProperties";var s=e.createElement("td");(s=o.insertCell()).colSpan="2";var l=e.createElement("table");l.className="DELWebResourceParameterDlg-magnitudesTable",l.style.width="100%",s.appendChild(l);var m=l.insertRow(-1),c=e.createElement("th");c.innerText=S.get("Minimum"),m.appendChild(c);var d=e.createElement("th");d.innerText=S.get("Units"),m.appendChild(d);var p=e.createElement("th");p.innerText=S.get("Maximum"),m.appendChild(p);var v=l.insertRow(-1);v.insertCell().className="minProperties",v.insertCell().className="magnitudeUnits",v.insertCell().className="maxProperties";var b={value:" ",disabled:!0,autoCommitFlag:!0};a.options.resourceParameter&&(a.options.resourceParameter.minValue||0===a.options.resourceParameter.minValue)&&(b.value=a.options.resourceParameter.minValue,b.disabled=!1),this.elements._inputMinimum=new u(b).inject(this.elements.mainDiv.querySelector("td.minProperties")),this.elements._inputMinimum.elements.inputField.type="number",this.elements._inputMinimum.elements.inputField.step="0.000001",a.elements._inputMinimum.getContent().addEventListener("change",(function(){a.validate()}));var D=new f;D.addRoot(new P({label:S.get("Not Set"),icons:[],grid:{valueItem:"NotSet"}})),D.addRoot(new P({label:S.get("Inclusive"),icons:[{iconName:"lessthanorequal"}],grid:{valueItem:"Included"}})),D.addRoot(new P({label:S.get("Exclusive"),icons:[{iconName:"chevron-left"}],grid:{valueItem:"Excluded"}}));var _={elementsTree:D,enableSearchFlag:!1,actionOnClickFlag:!1};a.options.resourceParameter&&a.options.resourceParameter.minLimit&&(_.currentValue=a.options.resourceParameter.minLimit),this.elements._minDropdown=new g(_).inject(this.elements.mainDiv.querySelector("td.minProperties")),a.elements._minDropdown.getContent().addEventListener("change",(function(e){a.onMinPropertiesChange(e)}));var h=new f;h.addRoot(new P({label:S.get("Not Set"),grid:{valueItem:"NotSet"}})),h.addRoot(new P({label:S.get("Inclusive"),icons:[{iconName:"lessthanorequal"}],grid:{valueItem:"Included"}})),h.addRoot(new P({label:S.get("Exclusive"),icons:[{iconName:"chevron-left"}],grid:{valueItem:"Excluded"}}));var y={elementsTree:h,enableSearchFlag:!1,actionOnClickFlag:!1};a.options.resourceParameter&&a.options.resourceParameter.maxLimit&&(y.currentValue=a.options.resourceParameter.maxLimit),this.elements._maxDropdown=new g(y).inject(this.elements.mainDiv.querySelector("td.maxProperties")),a.elements._maxDropdown.getContent().addEventListener("change",(function(e){a.onMaxPropertiesChange(e)}));var w={value:" ",disabled:!0,autoCommitFlag:!0};a.options.resourceParameter&&(a.options.resourceParameter.maxValue||0===a.options.resourceParameter.maxValue)&&(w.value=a.options.resourceParameter.maxValue,w.disabled=!1),this.elements._inputMaximum=new u(w).inject(this.elements.mainDiv.querySelector("td.maxProperties")),this.elements._inputMaximum.elements.inputField.type="number",this.elements._inputMaximum.elements.inputField.step="0.000001",a.elements._inputMaximum.getContent().addEventListener("change",(function(){a.validate()}));var x={};x.magnitude=a.elements._parameterTypeDropdown&&a.elements._parameterTypeDropdown.currentValue||"",a.options.resourceParameter&&(a.options.resourceParameter.magnitude||a.options.resourceParameter.parameter_type)&&(x.magnitude=a.options.resourceParameter.magnitude||a.options.resourceParameter.parameter_type),t&&t.dimension&&t.dimension.toUpperCase()!==x.magnitude||n.getMagnitudeUnits(x).then((function(n){var r=null;a.elements.mainDiv.querySelector("td.magnitudeUnits div")&&a.elements.mainDiv.querySelector("td.magnitudeUnits div").remove();var i=[];n&&e.each(n,(function(e,n){if(n&&n.Name){var r={labelItem:n.NLSName||n.label||"",valueItem:n.Name};(a.options&&a.options.resourceParameter&&a.options.resourceParameter.magnitude&&"ARBITRARYUNIT"===a.options.resourceParameter.magnitude||a.elements&&a.elements._parameterTypeDropdown&&a.elements._parameterTypeDropdown.currentValue&&"ARBITRARYUNIT"===a.elements._parameterTypeDropdown.currentValue)&&n&&n.uri&&(r.valueItem=n.uri),n&&n.default&&!0===n.default&&(r.default=!0),t&&t.unit&&t.unit.length>0?(t.unit.indexOf(n.Name)>-1||t.unit.indexOf(n.uri)>-1)&&i.push(r):t&&t.ontologySet&&t.ontologySet&&t.ontologySet.unit&&t.ontologySet.unit.length>0?(t.ontologySet.unit.indexOf(n.Name)>-1||t.ontologySet.unit.indexOf(n.uri)>-1)&&i.push(r):i.push(r)}})),(i=i.sort((function(e,t){return e&&t?t.valueItem?e.valueItem&&e.labelItem.toLowerCase()>t.labelItem.toLowerCase()?1:-1:1:0})))&&(r=null,e.each(i,(function(e,t){return(t.default&&!0===t.default||a.options&&a.options.resourceParameter&&a.options.resourceParameter.units&&t.labelItem===a.options.resourceParameter.units)&&(r=e),null===r})));var o={elementsList:i,enableSearchFlag:!1,selectedIndex:r||0,actionOnClickFlag:!1},s=!0;if(a.options.resourceParameter&&a.options.resourceParameter.units&&((s=a._isUnitsInDropdownListPair(i,a.options.resourceParameter.units))?(o.currentValue=a.options.resourceParameter.units,o.disabled=!s,a.elements._minDropdown&&(a.elements._minDropdown.disabled=!s),a.elements._maxDropdown&&(a.elements._maxDropdown.disabled=!s),a.elements._inputMaximum&&(a.elements._inputMaximum.disabled=!s),a.elements._inputMinimum&&(a.elements._inputMinimum.disabled=!s),a.elements._inputName&&(a.elements._inputName.disabled=!0),a.elements._inputDescription&&(a.elements._inputDescription.disabled=!s)):(a.buttons.Ok&&(a.buttons.Ok.disabled=!s),a.buttons.Save&&(a.buttons.Save.disabled=!s),a.elements._minDropdown&&(a.elements._minDropdown.disabled=!s),a.elements._maxDropdown&&(a.elements._maxDropdown.disabled=!s),a.elements._inputMaximum&&(a.elements._inputMaximum.disabled=!s),a.elements._inputMinimum&&(a.elements._inputMinimum.disabled=!s),a.elements._inputName&&(a.elements._inputName.disabled=!0),a.elements._inputDescription&&(a.elements._inputDescription.disabled=!s))),a._blnIsUnitsInDropdownListPair=s,s)a.elements.mainDiv.querySelector("td.magnitudeUnits")&&(a.elements._unitsDropdown=new g(o).inject(a.elements.mainDiv.querySelector("td.magnitudeUnits")));else{var l=a.elements.mainDiv.querySelector("td.magnitudeUnits"),m=e.createElement("div");m.style.display="inline-block",m.className="undefinedArbitraryUnit";var u=e.createElement("span");u.className="wux-ui-3ds-attention",l.style.textAlign="center",m.innerHTML=S.get("Undefined Arbitrary Unit"),l.appendChild(u),l.appendChild(m)}t&&t.unit&&t.unit.length>0&&(1===t.unit.length?a.elements._unitsDropdown.disabled=!0:a.elements._unitsDropdown.disabled=!1),a.elements._unitsDropdown&&a.elements._unitsDropdown.getContent().addEventListener("change",(function(e){a.onUnitsDropdownChange(e)}))}))},validate:function(){var t=this,n=0;(t.elements._parameterTypeDropdown&&!t.elements._parameterTypeDropdown.currentValue||!(t.elements._inputName.value||"").trim())&&n++;var a=null,r=null;if(t.elements._inputMinimum&&(a="string"==typeof t.elements._inputMinimum.value&&""!==t.elements._inputMinimum.value.trim()?parseFloat(t.elements._inputMinimum.value.trim()):"number"==typeof t.elements._inputMinimum.value?t.elements._inputMinimum.value:null),t.elements._inputMaximum&&(r="string"==typeof t.elements._inputMaximum.value&&""!==t.elements._inputMaximum.value.trim()?parseFloat(t.elements._inputMaximum.value.trim()):"number"==typeof t.elements._inputMaximum.value?t.elements._inputMaximum.value:null),t.elements._minDropdown&&("NotSet"!==t.elements._minDropdown.currentValue?(t.elements._inputMinimum.disabled=!1,"string"==typeof t.elements._inputMinimum.value?""!==t.elements._inputMinimum.value.trim()?(t.enableDisableButtons(!0),t.elements.mainDiv.querySelector("td.minProperties input").hasClassName("invalid-input")&&t.elements.mainDiv.querySelector("td.minProperties input").removeClassName("invalid-input")):(t.enableDisableButtons(!1),t.elements.mainDiv.querySelector("td.minProperties input").addClassName("invalid-input"),n++):t.elements._inputMinimum.value||0===t.elements._inputMinimum.value?(t.enableDisableButtons(!0),t.elements.mainDiv.querySelector("td.minProperties input").hasClassName("invalid-input")&&t.elements.mainDiv.querySelector("td.minProperties input").removeClassName("invalid-input")):(t.enableDisableButtons(!1),t.elements.mainDiv.querySelector("td.minProperties input").addClassName("invalid-input"),n++)):(t.elements._inputMinimum.disabled=!0,"NotSet"!==t.elements._maxDropdown.currentValue&&(t.elements._inputMaximum.disabled=!1,"string"==typeof t.elements._inputMaximum.value?""!==t.elements._inputMaximum.value.trim()?(t.enableDisableButtons(!0),t.elements.mainDiv.querySelector("td.maxProperties input").hasClassName("invalid-input")&&t.elements.mainDiv.querySelector("td.maxProperties input").removeClassName("invalid-input")):(t.enableDisableButtons(!1),t.elements.mainDiv.querySelector("td.maxProperties input").addClassName("invalid-input"),n++):t.elements._inputMaximum.value||0===t.elements._inputMaximum.value?(t.elements.mainDiv.querySelector("td.maxProperties input").hasClassName("invalid-input")&&t.elements.mainDiv.querySelector("td.maxProperties input").removeClassName("invalid-input"),t.enableDisableButtons(!0)):(t.enableDisableButtons(!1),t.elements.mainDiv.querySelector("td.maxProperties input").addClassName("invalid-input"),n++)))),t.elements._maxDropdown&&("NotSet"!==t.elements._maxDropdown.currentValue?(t.elements._inputMaximum.disabled=!1,"string"==typeof t.elements._inputMaximum.value?""!==t.elements._inputMaximum.value.trim()?(t.enableDisableButtons(!0),t.elements.mainDiv.querySelector("td.maxProperties input").hasClassName("invalid-input")&&t.elements.mainDiv.querySelector("td.maxProperties input").removeClassName("invalid-input")):(t.enableDisableButtons(!1),t.elements.mainDiv.querySelector("td.maxProperties input").addClassName("invalid-input"),n++):t.elements._inputMaximum.value||0===t.elements._inputMaximum.value?(t.enableDisableButtons(!0),t.elements.mainDiv.querySelector("td.maxProperties input").hasClassName("invalid-input")&&t.elements.mainDiv.querySelector("td.maxProperties input").removeClassName("invalid-input")):(t.enableDisableButtons(!1),t.elements.mainDiv.querySelector("td.maxProperties input").addClassName("invalid-input"),n++)):(t.elements._inputMaximum.disabled=!0,"NotSet"!==t.elements._minDropdown.currentValue&&(t.elements._inputMinimum.disabled=!1,"string"==typeof t.elements._inputMinimum.value?""!==t.elements._inputMinimum.value.trim()?(t.elements.mainDiv.querySelector("td.minProperties input").hasClassName("invalid-input")&&t.elements.mainDiv.querySelector("td.minProperties input").removeClassName("invalid-input"),t.enableDisableButtons(!0)):(t.elements.mainDiv.querySelector("td.minProperties input").addClassName("invalid-input"),t.enableDisableButtons(!1),n++):t.elements._inputMinimum.value||0===t.elements._inputMinimum.value?(t.enableDisableButtons(!0),t.elements.mainDiv.querySelector("td.minProperties input").hasClassName("invalid-input")&&t.elements.mainDiv.querySelector("td.minProperties input").removeClassName("invalid-input")):(t.elements.mainDiv.querySelector("td.minProperties input").addClassName("invalid-input"),t.enableDisableButtons(!1),n++)))),t.elements._maxDropdown&&("Excluded"===t.elements._maxDropdown.currentValue||"Excluded"===t.elements._minDropdown.currentValue?null!==a&&""!==a&&null!==r&&""!==r&&a>=r&&(t.elements.mainDiv.querySelector("td.minProperties input").addClassName("invalid-input"),t.elements.mainDiv.querySelector("td.maxProperties input").addClassName("invalid-input"),t.enableDisableButtons(!1),n++):"Included"===t.elements._maxDropdown.currentValue&&"Included"===t.elements._minDropdown.currentValue&&null!==a&&""!==a&&null!==r&&""!==r&&a>r&&(t.elements.mainDiv.querySelector("td.minProperties input").addClassName("invalid-input"),t.elements.mainDiv.querySelector("td.maxProperties input").addClassName("invalid-input"),t.enableDisableButtons(!1),n++)),t.elements.mainDiv.querySelectorAll(".DELWebResourceParameterDlg-maindiv .wux-controls-abstract .wux-controls-lineeditor-validitysign .wux-ui-3ds-attention").length>0){n++;for(var i=t.elements.mainDiv.querySelectorAll(".DELWebResourceParameterDlg-maindiv .wux-controls-abstract .wux-controls-lineeditor-validitysign .wux-ui-3ds-attention"),o=0;o<i.length;o++){var s=i[o].closest(".wux-controls-lineeditor-validitysign").querySelector(".wux-ui-3ds-status-ok");(s&&!s.style||"none"!==s.style.display)&&n--}}t.elements.mainDiv.querySelectorAll(".DELWebResourceParameterDlg-maindiv .wux-controls-autoComplete.invalid-input").length>0&&n++,t.elements.mainDiv.querySelectorAll(".DELWebResourceParameterDlg-maindiv .wux-controls-datepicker.invalid-input").length>0&&n++,t._conflictCnt=n,n>0?t.enableDisableButtons(!1):0===n&&(t.enableDisableButtons(!0),e.each(["td.minProperties input","td.maxProperties input"],(function(e,n){var a=t.elements.mainDiv.querySelector(n);a&&a.hasClassName("invalid-input")&&a.removeClassName("invalid-input")})))},validateIntegerStringList:function(t){var n=this,a=null,r=n.elements._uwaTree.getTreeDocument().getRoots();r&&r.length>0&&e.each(r,(function(e,n){n&&n._options&&n._options.grid&&null!==n._options.grid.tree&&""!==n._options.grid.tree&&!t||(a=n)})),a?n.enableDisableButtons(!1):0===n._conflictCnt?n.enableDisableButtons(!0):n.enableDisableButtons(!1)},onUnitsDropdownChange:function(){this.validate()},onMinPropertiesChange:function(){var e=this;"NotSet"!==e.elements._minDropdown.currentValue?e.elements._inputMinimum.disabled=!1:e.elements._inputMinimum.disabled=!0,e.validate()},onMaxPropertiesChange:function(){var e=this;"NotSet"!==e.elements._maxDropdown.currentValue?e.elements._inputMaximum.disabled=!1:e.elements._inputMaximum.disabled=!0,e.validate()},_isStringInArrayOfArrays:function(e,t){for(var n=0;n<t.length;n++){var a=t[n];if(Array.isArray(a)&&a.includes(e))return!0}return!1},onSave:function(t,a){var r=this;return new Promise((function(i,o){if(!r.elements._inputName||!r.elements._inputDescription)return r._displayNotificationMessage("incomplete dialog!"),void o(new Error("incomplete dialog!"));if(!(r.elements._inputName.value||"").trim())return r._displayNotificationMessage(S.get("Missing Name")),void o(new Error("Missing Name"));if(!r.options.resourceParameter||!r.options.resourceParameter.physicalid)return r._displayNotificationMessage("Missing Resource Parameter"),void o(new Error("Missing Resource Parameter"));var s=a||!1;r.listChanged("update",{});var l={physicalid:r.options.resourceParameter.physicalid};r.options.resourceParameter&&r.options.resourceParameter.interfaces&&r.options.resourceParameter.interfaces.length>0&&r._isStringInArrayOfArrays("DELRscPrmIODoubleValue",r.options.resourceParameter.interfaces)&&(r.options.resourceParameter.parameter_type="ARBITRARYUNIT");var m=!1;l.attributes={},e.each({V_Name:r.elements._inputName,V_description:r.elements._inputDescription},(function(e,t){t&&e in r.options.resourceParameter&&t.value!==r.options.resourceParameter[e]&&(m=e,l.attributes[e]=(t.value||"").trim())})),"Integer"!==r.options.resourceParameter.parameter_type&&"Text"!==r.options.resourceParameter.parameter_type&&"IntegerValue"!==r.options.resourceParameter.parameter_type&&"TextValue"!==r.options.resourceParameter.parameter_type?e.each({units:r.elements._unitsDropdown&&r.elements._unitsDropdown.currentValue||"",minValue:r.elements._inputMinimum&&!isNaN(r.elements._inputMinimum.value)?parseFloat(r.elements._inputMinimum.value):null,maxValue:r.elements._inputMaximum&&!isNaN(r.elements._inputMaximum.value)?parseFloat(r.elements._inputMaximum.value):null,minLimit:r.elements._minDropdown&&r.elements._minDropdown.currentValue||null,maxLimit:r.elements._maxDropdown&&r.elements._maxDropdown.currentValue||null},(function(e,t){t&&e in r.options.resourceParameter&&t!==r.options.resourceParameter[e]?(m=e,l.attributes[e]=t||""):e in r.options.resourceParameter&&t!==r.options.resourceParameter[e]&&(m=e,l.attributes[e]=t)})):e.each({V_Values:r._arrList},(function(e,t){t&&e in r.options.resourceParameter&&t!==r.options.resourceParameter[e]&&(m=e,l.attributes[e]=t||"")}));var u={},c=[],d=[],p=r.elements.mainDiv.querySelector("."+r.name+"-table tr."+r.name+"-extensionAutoSection"),g=r.elements.mainDiv.querySelector("."+r.name+"-table tr."+r.name+"-extensionCustoRow");if(e.each([p,g],(function(t,a){if(a){var i=a.querySelector(".wux-controls-accordeon-container");if(i&&i.dsModel){var o=i.dsModel;o&&o.items&&o.items.length&&e.each(o.items,(function(t,a){if(a&&a.content&&a.objExtension&&a.objExtension.name){if(a.content&&!a.objExtension.isAutomaticDeploymentInterface){a.content.getClosest||e.extend(a.content);var i=a.content.getClosest(".wux-controls-expander");if(i&&i.hasClassName(r.name+"-deletePending"))return void c.push(a.objExtension.name)}var o={};a.objExtension.properties&&e.each(a.objExtension.properties,(function(t,i){var s=a.content.querySelector('tr[data-extension-attribute="'+i.name+'"] td .wux-controls-abstract');if(s){var l=s.dsModel;if(l){var m=null;r.options.resourceParameter.extensions&&r.options.resourceParameter.extensions[a.objExtension.name]&&r.options.resourceParameter.extensions[a.objExtension.name]&&i.name in r.options.resourceParameter.extensions[a.objExtension.name]&&(m=r.options.resourceParameter.extensions[a.objExtension.name][i.name]);var u=r._fetchCorrectExtensionAttributeValueByType(l,i,!0);m!==u&&(isNaN(u)||"TIME"!==(i.dimension||"").toUpperCase()||l instanceof b&&"duration"===l.mode&&((i=e.clone(i)).preferred_unit="MS"),i.dimension&&i.preferred_unit?d.push(new Promise((function(t,a){n.getMagnitudes({filter:"dimensionName+eq+"+i.dimension,magnitude:i.dimension}).then((function(r){if(r&&r[i.dimension]){var s=r[i.dimension].MKSUnit;if(!s&&r[i.dimension].Units&&r[i.dimension].Units.length&&e.each(r[i.dimension].Units,(function(e,t){return t&&t.default&&(s=t.Name),!s})),!s||i.preferred_unit===s)return i.multi_valuated?o[i.name]=u||0:o[i.name]=+(u||0),void t();n.convertValueToUnit({value:u,dimension:i.dimension,fromUnit:i.preferred_unit,toUnit:s}).then((function(e){o[i.name]=+e,t()}),a)}else a(new Error("unable to retrieve details for "+i.dimension))}))}))):u&&u instanceof Date?(u.setMilliseconds(0),o[i.name]=e.Date.toDSDate(u)):o[i.name]=r._convertPropValueType(i,u||"","number"))}}})),u[a.objExtension.name]=o,r.validate()}}))}}})),e.Object.isEmptyObject(u)||(l.extensions=u,m=m||u),c&&c.length>0&&(l.extensionsToRemove=c,m=m||c),t&&s&&(l=t),s||(s=!0),s&&s){if(!m)return w.displayNotificationMessage(S.get("No changes have been made."),{level:"info"}),void i("No changes have been made.");r.enableDisableButtons(!1),r._handleLoadingButtons({dsModel:t&&t.button||r.buttons.Save},!0),Promise.all(d).then((function(){n.updateResourceParameter(l).then((function(){r._handleLoadingButtons({dsModel:t&&t.button||r.buttons.Save},!1),w.displayNotificationMessage(S.get("{0} Updated",{0:S.get("Resource Parameter")}),{level:"success"}),i("success")}),(function(e){r._handleLoadingButtons({dsModel:t&&t.button||r.buttons.Save},!1),r.enableDisableButtons(!0),e||(e=S.get("Error")),w.displayNotificationMessage(e),o(e)}))}),o)}}))},_convertPropValueType:function(t,n,a){var r=n;if(!t||!t.range)return n;if("string"!=typeof n||t.multi_valuated){if(n instanceof Date)n.setMilliseconds(0),r=e.Date.toDSDate(n);else if(t.multi_valuated&&Array.isArray(n)){var i=[];switch(t.range.toLowerCase()){case"boolean":for(var o=0;o<n.length;o++)""!==n[o]?a&&"string"===a?("boolean"==typeof n[o]&&(n[o]=""+n[o]),i.push(""+("true"===n[o].toLowerCase()))):a&&"number"===a&&i.push("true"===n[o].toLowerCase()):i.push("");r=i;break;case"double":for(var s=0;s<n.length;s++)a&&"string"===a?i.push(""+n[s]):a&&"number"===a&&i.push(+n[s]);r=i;break;case"integer":for(var l=0;l<n.length;l++)a&&"string"===a?i.push(""+n[l]):a&&"number"===a&&i.push(Math.floor(+n[l]));r=i}}}else switch(t.range.toLowerCase()){case"boolean":r="true"===n.toLowerCase();break;case"double":r=+n;break;case"integer":r=Math.floor(+n);break;case"date":"string"==typeof n&&n.indexOf("@")<0&&(n=new Date(n)),n instanceof Date&&(n.setMilliseconds(0),r=e.Date.toDSDate(n))}return r},_isUnitsInDropdownListPair:function(e,t){for(var n=!1,a=0;a<e.length;a++)e[a].valueItem===t&&(n=!0);return n},_handleLoadingButtons:function(e,n){var a=this;if(a._SpaceURL){var r=a.buttons.Save;e&&e.dsModel&&(r=e.dsModel),n?(r.iconSize="1em",r.icon=a._SpaceURL+"/webapps/DELWebInfrastructure/DSCommon/graphics/loading-small.gif"):r.icon=""}else t.getServiceUrl({serviceName:"3DSpace"}).then((function(t){a._SpaceURL=t||"/",a._SpaceURL?a._handleLoadingButtons(e,n):w.displayNotificationMessage(S.get("Error"))}),(function(e){e||(e=S.get("Error")),w.displayNotificationMessage(e)}))},_parseCollabSpaceStrToObj:function(e){for(var t={},n=0;n<e.length;n++){var a=e[n].split("/",2),r=a[0],i=a[1];t[r]=i}return t},enableDisableButtons:function(e){if(this.buttons)for(var t in this.buttons){if("Cancel"!==t)this.buttons[t].disabled=!e}},_fetchOrganizationFromContext:function(e){var t=e.split(".");return t.length>1?t[1]:null},_fetchCollabSpaceFromContext:function(e){var t=e.split(".");return t.length>2?t.slice(2).join("."):null}});return x}));