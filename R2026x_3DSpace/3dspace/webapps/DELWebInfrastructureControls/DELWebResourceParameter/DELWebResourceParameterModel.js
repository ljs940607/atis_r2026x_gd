window.define&&define("DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterModel",["DS/DELWebInfrastructureControls/UWAUtils","UWA/Class","UWA/Promise","DS/DELWebInfrastructureControls/DELWebIndexAuthoringMgmt","DS/DELWebInfrastructureControls/DELWebAjaxModel","i18n!DS/DELWebInfrastructureControls/assets/nls/DELWebInfrastructureControls"],(function(e,r,t,a,s,i){"use strict";var n={},c=window.Configuration&&window.Configuration.webroot?window.Configuration.webroot:s.setupWebRoot()||".";window.Fam&&window.Fam.Model&&window.Fam.Model.Platform&&window.Fam.Model.Platform.webroot&&(c=window.Fam.Model.Platform.webroot);var o=r.singleton({init:function(){n=s.getCacheObject()},setCacheObject:function(r){if(r&&e.Object.isPlainObject(r)){var t=s.getCacheObject();e.Object.isEmptyObject(n)||n===t||(r=Object.assign(r,n)),e.Object.isEmptyObject(t)||(r=Object.assign(r,t)),s.setCacheObject(r),n=s.getCacheObject()}},getCacheObject:function(){return n},get3DSearchString:function(){return"flattenedtaxonomies:types/DELResourceParameterListReference"},getResourceParameterLists:function(r){var a=this;return new t((function(t,i){if(r&&(r.physicalid||r.QueryList||r.allCached)){var c={};if(r.allCached)return n.parameter_list&&(c=e.Object.extend(!0,c,n.parameter_list)),void t(c);if(r.QueryList){var o=!0;if(n.parameter_list_assoc&&!r.blnForceRefresh?e.each(r.QueryList,(function(e,r){return(o=r&&r.physicalid&&n.parameter_list_assoc[r.physicalid])&&(c[r.physicalid]=n.parameter_list_assoc[r.physicalid]),!!o})):o=!1,o)return void t(c)}else{if(n.parameter_list_assoc&&r.blnIncludeDescendants&&n.parameter_list_assoc[r.V_discipline||"All"]&&n.parameter_list_assoc[r.V_discipline||"All"][r.physicalid]&&!r.blnForceRefresh)return void t(e.clone(n.parameter_list_assoc[r.V_discipline||"All"][r.physicalid]));if(n.parameter_list_assoc&&n.parameter_list_assoc[r.physicalid]&&!r.blnForceRefresh&&!r.blnIncludeDescendants)return void t(e.clone(n.parameter_list_assoc[r.physicalid]))}s.getServiceUrl({serviceName:"3DSpace"}).then((function(c){if(c&&"string"==typeof c){var o={};if(r.physicalid)o.target_physicalid=r.physicalid;else if(r.QueryList){var u=[];e.each(r.QueryList,(function(e,r){r&&(r.physicalid?u.push({physicalid:r.physicalid}):u.push(r))})),o.target_QueryList=JSON.stringify(u)}r.blnIncludeDescendants&&(o.getAllDescendants=!0,r.V_discipline&&(o.disciplineFilter=r.V_discipline));var l=c+"/resources/DELWebInfrastructureLite/v0/resource/parameterList/resourceAssociation";s.callAuthenticatedRequest(l,"json","GET",o).then((function(c){if(c){var u=s.commonAjaxJsonResponseOK(c,i);if(!u)return u;n.parameter_list_assoc||(n.parameter_list_assoc={});var l=c.Data||{};s.useFixtures()&&n.parameter_list_assoc[r.physicalid]&&!r.blnForceRefresh?l=n.parameter_list_assoc[r.physicalid]:r.blnForceRefresh&&n.parameter_list_assoc[r.physicalid]&&delete n.parameter_list_assoc[r.physicalid],e.each(l,(function(e,t){var s=t.resource;if(s||(s=t.resource={physicalid:r.physicalid}),a._cacheResource(s),t.resourceParameterList){var i=e;t&&t.properties&&t.properties.physicalid?i=t.properties.physicalid:t&&t.resourceParameterList&&t.resourceParameterList.physicalid&&(i=t.resourceParameterList.physicalid),r.blnIncludeDescendants?r.blnIncludeDescendants&&(n.parameter_list_assoc[r.V_discipline||"All"]||(n.parameter_list_assoc[r.V_discipline||"All"]={}),n.parameter_list_assoc[r.V_discipline||"All"][r.physicalid]||(n.parameter_list_assoc[r.V_discipline||"All"][r.physicalid]={}),n.parameter_list_assoc[r.V_discipline||"All"][r.physicalid][i]=t):(n.parameter_list_assoc[s.physicalid]||(n.parameter_list_assoc[s.physicalid]={}),n.parameter_list_assoc[s.physicalid][i]=t),a._cacheResourceParameterList(t.resourceParameterList,"False"===o.Minimum)}})),r.blnIncludeDescendants?(n.parameter_list_assoc||(n.parameter_list_assoc={}),n.parameter_list_assoc[r.V_discipline||"All"]||(n.parameter_list_assoc[r.V_discipline||"All"]={}),r.physicalid&&!n.parameter_list_assoc[r.V_discipline||"All"][r.physicalid]&&(n.parameter_list_assoc[r.V_discipline||"All"][r.physicalid]={})):r.physicalid&&!n.parameter_list_assoc[r.physicalid]&&(n.parameter_list_assoc[r.physicalid]={}),r.blnIncludeDescendants&&r.physicalid?t(e.clone(n.parameter_list_assoc[r.V_discipline||"All"][r.physicalid])):r.physicalid?t(e.clone(n.parameter_list_assoc[r.physicalid])):t(e.clone(l))}else i(new Error("invalid server response"))}),i)}else i(new Error("invalid 3DSpace URL"))}),i)}else i(new Error("invalid parameters"))}))},getDefinedParameterOntologies:function(){return new t((function(r,t){n.ontology&&n.ontology.length>0&&r(n.ontology.slice(0)),s.getServiceUrl({serviceName:"3DSpace"}).then((function(a){if(a&&"string"==typeof a){var c=a+"/resources/uom/configuration/parameters";s.callAuthenticatedRequest(c,"json","GET",null).then((function(a){if(a){var s=[];a&&a.results&&Array.isArray(a.results)&&a.results.length>0?(e.each(a.results,(function(e,r){r.label&&(r.Name=r.label),s[e]=r})),s.length===a.results.length&&(n.ontology||(n.ontology=[]),e.each(s,(function(e,r){n.ontology[r.uri]||(n.ontology[r.uri]=r)})),r(s.slice(0)))):r([])}else t(new Error("invalid server response"))}),(function(e){t(new Error((e.message||e)+" \n"+i.get("Failed to fetch parameter ontologies")))}),t)}else t(new Error("invalid 3DSpace URL"))}),(function(e){t(new Error((e.message||e)+" \n"+i.get("Failed to fetch parameter ontologies")))}),t)}))},getOneParameterOntology:function(r){var a=this;return new t((function(t,s){if(!n.ontology||!n.ontology[r.uri])return a.getDefinedParameterOntologies().then((function(a){var i=null,n=0;a?a&&a.length>0&&e.each(a,(function(e,s){n++,r.uri===s.uri&&(i=s,!0),n===a.length&&t(i)})):s(new Error("No Ontologies Defined"))}));t(n.ontology[r.uri])}))},getDefinedArbitraryUnits:function(){return new t((function(r,t){n.arbitraryUnits&&n.arbitraryUnits.length>0&&r(n.arbitraryUnits.slice(0)),s.getServiceUrl({serviceName:"3DSpace"}).then((function(a){if(a&&"string"==typeof a){var c=a+"/resources/uom/configuration/units";s.callAuthenticatedRequest(c,"json","GET",null).then((function(a){if(a){var s=[];a&&a.results&&Array.isArray(a.results)&&a.results.length>0?(e.each(a.results,(function(e,r){r.label&&(r.Name=r.label),r.symbolNLS&&(r.NLSName=r.symbolNLS),s[e]=r})),s.length===a.results.length&&(n.arbitraryUnits||(n.arbitraryUnits=[]),n.arbitraryUnits=s,r(s.slice(0)))):r(s.slice(0))}else t(new Error("invalid server response"))}),(function(r){e.log("Unable to get arbitrary units : "),e.log(r),t(new Error((r.message||r)+" \n"+i.get("Failed to fetch arbitrary units")))}),t)}else t(new Error("invalid 3DSpace URL"))}),t)}))},getResourceParametersForList:function(r){var a=this;return new t((function(i,c){if(r&&(r.physicalid||r.QueryList||r.allCached)){var o={};if(r.allCached)return n.parameter&&(o=e.Object.extend(!0,o,n.parameter)),void i(o);if(r.QueryList){var u=!0;if(n.parameter_list&&!r.blnForceRefresh?e.each(r.QueryList,(function(r,t){return(u=t&&t.physicalid&&n.parameter_list[t.physicalid]&&n.parameter_list[t.physicalid].associatedResourceParameters)&&e.each(n.parameter_list[t.physicalid].associatedResourceParameters,(function(r,a){return a&&"string"==typeof a?n.parameter&&n.parameter[a]?(o[t.physicalid]||(o[t.physicalid]={}),o[t.physicalid][a]=n.parameter[a]):u=!1:(e.log("invalid physicalidParamId!"),u=!1),!!u})),!!u})):u=!1,u)return void i(e.clone(o))}else if(n.parameter_list&&n.parameter_list[r.physicalid]&&n.parameter_list[r.physicalid].associatedResourceParameters&&!r.blnForceRefresh)return void i(e.clone(n.parameter_list[r.physicalid].associatedResourceParameters));s.getServiceUrl({serviceName:"3DSpace"}).then((function(o){if(o&&"string"==typeof o){var u={};if(r.physicalid)u.resourceParameterListphysicalid=r.physicalid;else if(r.QueryList){var l=[];e.each(r.QueryList,(function(e,r){r&&(r.physicalid?l.push({physicalid:r.physicalid}):l.push(r))})),u.resourceParameterListQueryList=JSON.stringify(l)}var d=o+"/resources/DELWebInfrastructureLite/v0/resource/parameter";s.callAuthenticatedRequest(d,"json","GET",u).then((function(o){if(o){var l=s.commonAjaxJsonResponseOK(o,c);if(!l)return l;n.parameter_list||(n.parameter_list={}),n.parameter||(n.parameter={});var d=o.Data||{},m=[];e.each(d,(function(t,i){r.QueryList?s.useFixtures()&&n.parameter_list[t]&&n.parameter_list[t].associatedResourceParameters&&!r.blnForceRefresh?d=n.parameter_list[t].associatedResourceParameters:r.blnForceRefresh&&n.parameter_list[t]&&n.parameter_list[t].associatedResourceParameters&&delete n.parameter_list[t].associatedResourceParameters:s.useFixtures()&&n.parameter_list[r.physicalid]&&n.parameter_list[r.physicalid].associatedResourceParameters&&!r.blnForceRefresh?d=n.parameter_list[r.physicalid].associatedResourceParameters:r.blnForceRefresh&&n.parameter_list[r.physicalid]&&n.parameter_list[r.physicalid].associatedResourceParameters&&delete n.parameter_list[r.physicalid].associatedResourceParameters;var c={physicalid:t};a._cacheResourceParameterList(c),(c=n.parameter_list[c.physicalid]).associatedResourceParameters||(c.associatedResourceParameters=[]),e.each(i,(function(r,t){var s=r;t&&t.physicalid&&(s=t.physicalid),c.associatedResourceParameters.push(s),t&&t.physicalid&&(t.extensions&&!e.Object.isEmptyObject(t.extensions)?m.push(a.addConvertedDisplayUnitsToExtensions({strClassName:t.plmObjectType||t.plmObjectTypeInternal||t.plmBaseObjectType,arrExtensions:t.extensions}).then((function(){a._cacheResourceParameter(t,"False"===u.Minimum)}))):a._cacheResourceParameter(t,"False"===u.Minimum))})),r.physicalid&&!n.parameter_list[r.physicalid]?n.parameter_list[r.physicalid]={associatedResourceParameters:[]}:r.QueryList&&!n.parameter_list[t]&&(n.parameter_list[t]={associatedResourceParameters:[]})})),t.all(m).then((function(){i(e.clone(d))}))}else c(new Error("invalid server response"))}),c)}else c(new Error("invalid 3DSpace URL"))}),c)}else c(new Error("invalid parameters"))}))},getOneResourceParameterList:function(r){var a=this;return new t((function(t,i){if(r&&e.Object.isPlainObject(r))if(r.physicalid){"Minimum"in r&&!0!==r.Minimum?r.Minimum&&Array.isArray(r.Minimum)||(r.Minimum="False"):r.Minimum="True";var n=r.Minimum,c=["V_Name","physicalid"];r.Minimum&&!Array.isArray(r.Minimum)&&(r.Minimum.match(/true/i)||r.Minimum.match(/yes/i)||r.Minimum.match(/on/i))&&(r.Minimum=c);var o=a._FindPLMObjectInCache(r,r.Minimum);!o&&r.Minimum&&Array.isArray(r.Minimum)&&s.useFixtures()&&(o=a._FindPLMObjectInCache(r,"True"))&&e.each(r.Minimum,(function(e,r){r in o||(o[r]=null)})),o&&!o.ReferenceOXID&&!o.ReferencePhysicalid&&n&&n.match&&(n.match(/true/i)||n.match(/yes/i)||n.match(/on/i))&&(r.Minimum=c,o=a._FindPLMObjectInCache(r,r.Minimum)),o?t(Object.assign({},o)):(r.class_name||(r.class_name="DELRmiParameterModel/DELResourceParameterListReference"),!r.fixtureTag&&s.useFixtures()&&(r.fixtureTag="getOneResourceParameterList"),s.getReference(r).then((function(r){r&&(Array.isArray(r)?e.each(r,(function(e,r){r&&a._cacheResourceParameterList(Object.assign({},r))})):a._cacheResourceParameterList(Object.assign({},r))),t(r)}),i))}else i(new Error("no id provided!"));else i(new Error("invalid parameters"))}))},createResourceParameterList:function(r){var i=this;return new t((function(t,c){r&&e.Object.isPlainObject(r)?r.name||r.V_Name?s.getServiceUrl({serviceName:"3DSpace"}).then((function(o){if(o&&"string"==typeof o){var u={V_Name:r.V_Name||r.name};(r.V_description||r.description)&&(u.V_description=(r.V_description||r.description).trim()),r.target_resource&&e.Object.isPlainObject(r.target_resource)&&(r.target_resource.physicalid&&(u.target_physicalid=r.target_resource.physicalid),r.target_resource.OXID&&(u.target_OXID=r.target_resource.OXID),r.target_resource.QueryList&&(u.target_resource=r.target_resource)),r.target_physicalid&&(u.target_physicalid=r.target_physicalid),r.target_OXID&&(u.target_OXID=r.target_OXID);var l=o+"/resources/DELWebInfrastructureLite/v0/resource/parameterList";s.callAuthenticatedRequest(l,"json","POST",u,null,{SecurityContext:r.currSecurityContext}).then((function(r){if(r){var o=s.commonAjaxJsonResponseOK(r,c);if(!o)return o;a.setDatabase();var l=r.Data||{},d=[],m=[];e.each(l,(function(r,t){"SuccessfullyAssociated"!==r?(t.associatedResources||(t.associatedResources=[]),i._cacheResourceParameterList(t),d.push(t),m.push({event:"ResourceParameterList.created",data:Object.assign({},t)})):t&&(e.Object.isPlainObject(t)||Array.isArray(t))&&e.each(t,(function(r,t){var a=t.resource?t.resource.physicalid||t.resource.OXID:u.target_physicalid||u.target_OXID,s=t.resourceParameterList?t.resourceParameterList.physicalid||t.resourceParameterList.OXID:null;t&&a&&s?(n.parameter_list_assoc&&n.parameter_list_assoc[a]&&i._cacheResourceToResourceParameterListAssoc(a,s,t),m.push({event:"ResourceParameterList.associated",data:Object.assign({},t)})):e.log("DELWebResourceParameterModel::createResourceParameterList - invalid connection!  idxConnection = "+r+", ResourceID = "+a+", ParamListID = "+s+", objConnection = "+t)}))})),e.each(m,(function(e,r){s.publishEvent(r.event,r.data)})),t(d.slice(0))}else c(new Error("invalid server response"))}),c)}else c(new Error("invalid 3DSpace URL"))}),c):c(new Error("No name provided!")):c(new Error("invalid parameters"))}))},updateResourceParameterList:function(r){var a=this;return new t((function(t,n){if(r&&e.Object.isPlainObject(r)&&r.physicalid){var c={physicalid:r.physicalid,attributes:[]};(r.V_Name||r.name)&&c.attributes.push({V_Name:(r.V_Name||r.name).trim()}),(r.V_description||r.description)&&c.attributes.push({V_description:(r.V_description||r.description).trim()}),c.attributes.length?(c.attributes=JSON.stringify(c.attributes),s.getServiceUrl({serviceName:"3DSpace"}).then((function(i){if(i&&"string"==typeof i){var o=i+"/resources/DELWebInfrastructureLite/v0/resource";s.useFixtures()&&(o+="?updateResourceParameterList"),s.callAuthenticatedRequest(o,"json","PATCH",c).then((function(i){var c=s.commonAjaxJsonResponseOK(i,n);if(!c)return c;var o=i.Data||i.data,u=(o?o.ChangedAttributes:null)||{};a._cacheResourceParameterList(Object.assign({physicalid:r.physicalid},u));var l=Object.assign({ChangedAttributes:e.clone(u)},r);s.publishEvent("ResourceParameterList.updated",l),t(e.clone(l))}),n)}else n(new Error("invalid 3DSpace URL"))}),n)):n(new Error(i.get("No changes have been made.")))}else n(new Error("invalid parameters"))}))},associateResourceParameterList:function(r){var c=this;return new t((function(t,o){r&&e.Object.isPlainObject(r)?r.resource&&e.Object.isPlainObject(r.resource)&&(r.resource.physicalid||r.resource.QueryList)?r.resourceParameterList&&e.Object.isPlainObject(r.resourceParameterList)&&(r.resourceParameterList.physicalid||r.resourceParameterList.QueryList)?s.getServiceUrl({serviceName:"3DSpace"}).then((function(u){if(u&&"string"==typeof u){var l={};r.resource&&r.resource.physicalid&&(l.target_physicalid=r.resource.physicalid),r.resourceParameterList&&r.resourceParameterList.physicalid?l.resourceParameterListphysicalid=r.resourceParameterList.physicalid:r.resourceParameterList&&r.resourceParameterList.QueryList&&(l.resourceParameterListQueryList=[],e.each(r.resourceParameterList.QueryList,(function(e,r){r&&(r.physicalid?l.resourceParameterListQueryList.push({physicalid:r.physicalid}):l.resourceParameterListQueryList.push(r))})));var d=new window.FormData;s.useFixtures()?d=l:e.each(l,(function(r,t){r&&t?"string"!=typeof t&&isNaN(t)?d.append(r,JSON.stringify(t)):d.append(r,t):e.log("DELWebResourceParameterModel::associateResourceParameterList - invalid key = "+r+", val = "+t)}));var m=u+"/resources/DELWebInfrastructureLite/v0/resource/parameterList/resourceAssociation";s.callAuthenticatedRequest(m,"json","POST",d).then((function(u){if(u){var l=s.commonAjaxJsonResponseOK(u,o);if(!l)return l;a.setDatabase(),n.parameter_list_assoc||(n.parameter_list_assoc={});var d=[],m=!0,p=[];(u.Data.SuccessfullyAssociated||u.Data.AlreadyAssociated)&&e.each({SuccessfullyAssociated:"ResourceParameterList.associated",AlreadyAssociated:"ResourceParameterList.associated.duplicate"},(function(t,a){u.Data[t]&&e.each(u.Data[t],(function(t,s){var i=s.resource;!i&&r.resource&&(i=s.resource=r.resource),i&&c._cacheResource(i),s.resourceParameterList&&c._cacheResourceParameterList(s.resourceParameterList),i&&i.physicalid&&s.resourceParameterList&&s.resourceParameterList.physicalid?(c._cacheResourceToResourceParameterListAssoc(i.physicalid,s.resourceParameterList.physicalid,s),p.push(s),d.push({event:a,data:s})):e.log("invalid ID in response!")}))})),u.Data.FailedAssociated&&(m=!1,e.each(u.Data.FailedAssociated,(function(e,r){d.push({event:"ResourceParameterList.associated.error",data:r})}))),e.each(d,(function(e,r){s.publishEvent(r.event,r.data)})),m&&p&&p.length?t(e.clone(p)):o(new Error(i.get("Error")))}else o(new Error("invalid server response"))}),o)}else o(new Error("invalid 3DSpace URL"))}),o):o(new Error("invalid resource parameter list")):o(new Error("invalid resource")):o(new Error("invalid parameters"))}))},unassociateResourceParameterList:function(r){var n=this;return new t((function(t,c){if(r&&e.Object.isPlainObject(r)){if(!(r.resourceParameterListAssociation||r.resourceParameterListAssociationphysicalid||r.resourceParameterListAssociationOXID||r.resourceParameterListAssociationQueryList)){if(!(r.resource||r.target_physicalid||r.target_OXID||r.target_QueryList))return void c(new Error("No resource provided!"));if(!(r.resourceParameterList||r.resourceParameterListphysicalid||r.resourceParameterListOXID||r.resourceParameterListQueryList))return void c(new Error("No resource parameter list provided!"))}s.getServiceUrl({serviceName:"3DSpace"}).then((function(o){if(o&&"string"==typeof o){var u={};if(e.each(["resourceParameterListAssociation","resourceParameterListAssociationphysicalid","resourceParameterListAssociationOXID","resourceParameterListAssociationQueryList"],(function(e,t){r[t]&&(u[t]=r[t])})),e.Object.isEmptyObject(u)){if(e.each(["resource","target_resource","target_physicalid","target_OXID","target_QueryList","resourceParameterList","resourceParameterListphysicalid","resourceParameterListOXID","resourceParameterListQueryList"],(function(e,t){r[t]&&(u[t]=r[t])})),e.Object.isEmptyObject(u))return void c(new Error("invalid parameters"));u.resource&&!u.target_resource&&(u.target_resource=u.resource),delete u.resource}var l=new window.FormData;s.useFixtures()?l=u:e.each(u,(function(r,t){"string"!=typeof t&&isNaN(t)?l.append(r,e.Json.encode(t)):l.append(r,t)}));var d=o+"/resources/DELWebInfrastructureLite/v0/resource/parameterList/resourceAssociation";s.callAuthenticatedRequest(d,"json","DELETE",l).then((function(o){if(o){var u=s.commonAjaxJsonResponseOK(o,c);if(!u)return u;a.setDatabase();var l=o.Data||{},m=[],p=!0;e.each(l,(function(t,a){if("SuccessfullyUnassociated"===t||"AlreadyUnassociated"===t)e.each(a,(function(t,a){if(a&&e.Object.isPlainObject(a)&&!e.Object.isEmptyObject(a)){if(p=!0,!a.properties)if(r.resourceParameterListAssociation){var s=e.clone(a);a.properties=Object.assign(s,r.resourceParameterListAssociation)}else r.resourceParameterListAssociationOXID||r.resourceParameterListAssociationphysicalid?a.properties=Object.assign({OXID:r.resourceParameterListAssociationOXID,physicalid:r.resourceParameterListAssociationphysicalid},a):a.physicalid&&(a.properties={physicalid:a.physicalid});a.resourceParameterList||(r.resourceParameterList?a.resourceParameterList=r.resourceParameterList:(r.resourceParameterListphysicalid||r.resourceParameterListOXID)&&(a.resourceParameterList={physicalid:r.resourceParameterListphysicalid,OXID:r.resourceParameterListOXID})),a.resource||(r.resource?a.resource=r.resource:(r.target_physicalid||r.target_OXID)&&(a.resource={OXID:r.target_OXID,physicalid:r.target_physicalid})),n._cacheResourceToResourceParameterListUnassoc(a),m.push({event:"ResourceParameterList.unassociated",data:a})}else e.log("DELWebResourceParameterModel::unassociateResourceParameterList - invalid response from "+d)}));else if("FailedUnassociated"===t){var s=e.clone(l);s=Object.assign(s,r),e.each(a,(function(r,a){0===r.indexOf("[")?s.resourceParameterListOXID=r:s.resourceParameterListphysicalid=r,e.each(a,(function(e,r){0===r.indexOf("[")?s.target_OXID=r:s.target_physicalid=r,m.push({event:"ResourceParameterList.unassociated.error",data:s}),p=!1,c(t,s)}))}))}else e.log("unknown response key: "+t)})),e.each(m,(function(e,r){s.publishEvent(r.event,r.data)})),p&&(l&&!e.Object.isEmptyObject(l)?t(e.clone(l)):c(new Error(i.get("Error"))))}else c(new Error("invalid server response"))}),c)}else c(new Error("invalid 3DSpace URL"))}),c)}else c(new Error("invalid parameters"))}))},_cacheResourceParameter:function(r){n.parameter||(n.parameter={});var t=n.parameter;if(!r.parameter_type&&r.interfaces&&r.interfaces.length&&e.each(r.interfaces,(function(e,t){t.indexOf("DELRscPrmIOValueAbstract")>=0&&(r.parameter_type=t[0].replace("DELRscPrmIORangeValue_","").replace("DELRscPrmIO",""),r.parameter_type.endsWith("Value")&&(r.parameter_type=r.parameter_type.substr(0,r.parameter_type.lastIndexOf("Value"))))})),r.OXID||r.physicalid){if(r.plmBaseObjectType||(r.plmBaseObjectType="DELResourceParameter"),r.physicalid&&r.OXID&&!t[r.physicalid]&&t[r.OXID]&&(t[r.physicalid]=t[r.OXID]),t[r.physicalid||r.OXID]){var a=t[r.physicalid||r.OXID];e.each(r.extensions,(function(e,r){a.extensions&&a.extensions[e]&&(a.extensions[e]=r)})),r.interfaces&&(a.interfaces=r.interfaces,r.extensions||a.extensions&&e.each(a.extensions,(function(t,s){e.each(s,(function(e,s){e in r&&(a.extensions[t][e]=r[e])}))}))),t[r.physicalid||r.OXID]=a,e.Object.extend(!0,r,a)}else t[r.physicalid||r.OXID]=r;r.OXID&&r.physicalid&&(t[r.OXID]=t[r.physicalid])}},getOneResourceParameter:function(r){var a=this;return new t((function(t,i){if(r&&e.Object.isPlainObject(r))if(r.physicalid){"Minimum"in r&&!0!==r.Minimum?r.Minimum&&Array.isArray(r.Minimum)||(r.Minimum="False"):r.Minimum="True";var n=r.Minimum,c=["V_Name","physicalid"];r.Minimum&&!Array.isArray(r.Minimum)&&(r.Minimum.match(/true/i)||r.Minimum.match(/yes/i)||r.Minimum.match(/on/i))&&(r.Minimum=c);var o=a._FindPLMObjectInCache(r,r.Minimum);!o&&r.Minimum&&Array.isArray(r.Minimum)&&s.useFixtures()&&(o=a._FindPLMObjectInCache(r,"True"))&&e.each(r.Minimum,(function(e,r){r in o||(o[r]=null)})),o&&!o.ReferenceOXID&&!o.ReferencePhysicalid&&n&&n.match&&(n.match(/true/i)||n.match(/yes/i)||n.match(/on/i))&&(r.Minimum=c,o=a._FindPLMObjectInCache(r,r.Minimum)),o?t(Object.assign({},o)):(r.class_name||(r.class_name="DELRmiParameterModel/DELResourcePrmAbstract"),!r.fixtureTag&&s.useFixtures()&&(r.fixtureTag="getOneResourceParameterList"),s.getReference(r).then((function(r){r&&(Array.isArray(r)?e.each(r,(function(e,r){r&&a._cacheResourceParameter(Object.assign({},r))})):a._cacheResourceParameter(Object.assign({},r))),t(r)}),i))}else i(new Error("no id provided!"));else i(new Error("invalid parameters"))}))},createResourceParameter:function(r){var i=this;return new t((function(c,o){r&&e.Object.isPlainObject(r)?r.name||r.V_Name?s.getServiceUrl({serviceName:"3DSpace"}).then((function(u){if(u&&"string"==typeof u){var l={V_Name:r.V_Name||r.name};if((r.V_description||r.description)&&(l.V_description=(r.V_description||r.description).trim()),l.inputOutput=r.inputOutput,r.inputOutput||r.V_Direction||("DELResourcePrmOUTPUT"===r.plmObjectType||"DELResourcePrmOUTPUT"===r.plmObjectTypeInternal?l.inputOutput="Output":"DELResourcePrmINPUT"!==r.plmObjectType&&"DELResourcePrmINPUT"!==r.plmObjectTypeInternal||(l.inputOutput="Input")),r.resourceParameterExtension||r.parameter_type){(r.resourceParameterExtension||r.parameter_type)&&(l.resourceParameterExtension=(r.resourceParameterExtension||r.parameter_type).trim()),("minValue"in r||"V_MinValue"in r)&&(l.minValue=(r.minValue||r.V_MinValue||"0").toString().trim()),("maxValue"in r||"V_MaxValue"in r)&&(l.maxValue=(r.maxValue||r.V_MaxValue||"0").toString().trim()),"ontologySelected"in r&&(l.parameterOntologyId=r.ontologySelected),r.minLimit&&(l.minLimit=r.minLimit.trim()),r.maxLimit&&(l.maxLimit=r.maxLimit.trim()),(r.units||r.V_Units)&&(l.units=(r.units||r.V_Units).trim()),r.target_param_list&&e.Object.isPlainObject(r.target_param_list)&&(r.target_param_list.physicalid&&(l.resourceParameterListphysicalid=r.target_param_list.physicalid),r.target_param_list.OXID&&(l.resourceParameterListOXID=r.target_param_list.OXID),r.target_param_list.QueryList&&(l.resourceParameterListQueryList=r.target_param_list.QueryList)),r.target_physicalid&&(l.resourceParameterListphysicalid=r.target_physicalid),r.target_OXID&&(l.resourceParameterListOXID=r.target_OXID),r.V_Values&&(l.V_Values=JSON.stringify(r.V_Values)),r.extensions&&(l.extensions=JSON.stringify(r.extensions));var d=u+"/resources/DELWebInfrastructureLite/v0/resource/parameter?createResourceParameter";s.callAuthenticatedRequest(d,"json","POST",l,null,{SecurityContext:r.currSecurityContext}).then((function(u){if(u){var l=s.commonAjaxJsonResponseOK(u,o);if(!l)return l;a.setDatabase();var d=u.Data||{},m=r.target_param_list;m||(m={physicalid:r.target_physicalid,OXID:r.target_OXID});var p=[],f=[],h=[];e.each(d,(function(r,t){t.extensions&&!e.Object.isEmptyObject(t.extensions)&&h.push(i.addConvertedDisplayUnitsToExtensions({strClassName:t.plmObjectType||t.plmObjectTypeInternal||t.plmBaseObjectType,arrExtensions:t.extensions}))})),t.all(h).then((function(){e.each(d,(function(t,a){a&&a.interfaces.indexOf(["DELParameterIdentifierExt"]>-1)&&a&&a["DELParameterIdentifierExt.V_ParameterIdentifier"]&&a["DELParameterIdentifierExt.V_ParameterIdentifier"].parameterId&&r.ontologySelected===a["DELParameterIdentifierExt.V_ParameterIdentifier"].parameterId&&(a.parameterOntologyId=a["DELParameterIdentifierExt.V_ParameterIdentifier"].parameterId),a&&a.interfaces.indexOf(["DELRscPrmIODoubleValue"]>-1)&&a.units&&r.units===a.units&&(a.isArbitraryUnit=!0),p.push(a),i._cacheResourceParameter(a,!0);var s=m.physicalid||m.OXID,c=a.physicalid||a.OXID||t;if(c&&s){var o={resourceParameterList:m,properties:a};(n.parameter_list||n.parameter_list[s])&&i._cacheResourceParameterToResourceParameterListAssoc(s,o),f.push({event:"ResourceParameter.associated",data:e.clone(o)})}else e.log("DELWebResourceParameterModel::createResourceParameter - invalid connection! ResourceParamID = "+c+", ParamListID = "+s)})),e.each(f,(function(e,r){s.publishEvent(r.event,r.data)})),c(p.slice(0))}))}else o(new Error("invalid server response"))}),o)}}else o(new Error("invalid 3DSpace URL"))}),o):o(new Error("No name provided!")):o(new Error("invalid parameters"))}))},updateResourceParameter:function(r){var c=this;return new t((function(o,u){if(r&&e.Object.isPlainObject(r)&&r.physicalid){var l={resourceParameterPhysicalid:r.physicalid};(r.V_Name||r.name)&&(l.V_Name=(r.V_Name||r.name).trim()),(r.V_description||r.description)&&(l.V_description=(r.V_description||r.description).trim()),"parameterOntologyId"in r&&(l.parameterOntologyId=r.parameterOntologyId),(r.attributes||r.attributes)&&(l.attributes=JSON.stringify(r.attributes)),r.extensions&&(l.extensions=JSON.stringify(r.extensions)),r.extensionsToRemove&&(l.extensionsToRemove=JSON.stringify(r.extensionsToRemove)),l.V_Name||l.V_description||l.attributes||l.extensions?s.getServiceUrl({serviceName:"3DSpace"}).then((function(i){if(i&&"string"==typeof i){var d=i+"/resources/DELWebInfrastructureLite/v0/resource/parameter?updateResourceParameter";s.callAuthenticatedRequest(d,"json","PATCH",l).then((function(i){var l=s.commonAjaxJsonResponseOK(i,u);if(!l)return l;a.setDatabase();var d=(i.Data&&i.Data.ChangedAttributes?i.Data.ChangedAttributes:i.Data)||{};i.Data&&(i.Data.interfaces&&!d.interfaces&&(d.interfaces=i.Data.interfaces),i.Data.extensions&&!d.extensions&&(d.extensions=i.Data.extensions));var m=[];d.extensions&&!e.Object.isEmptyObject(d.extensions)&&r.physicalid&&n.parameter&&n.parameter[r.physicalid]&&m.push(c.addConvertedDisplayUnitsToExtensions({strClassName:n.parameter[r.physicalid].plmObjectType||n.parameter[r.physicalid].plmObjectTypeInternal||n.parameter[r.physicalid].plmBaseObjectType,arrExtensions:d.extensions})),t.all(m).then((function(){c._cacheResourceParameter(Object.assign({physicalid:r.physicalid},d));var t=e.Object.extend(!0,{ChangedAttributes:e.clone(d)},r);t.ChangedAttributes.extensions&&t.extensions&&(t.ChangedAttributes.extensions=t.extensions),s.publishEvent("ResourceParameter.updated",t),o(e.clone(t))}),u)}),u)}else u(new Error("invalid 3DSpace URL"))}),u):u(new Error(i.get("No changes have been made.")))}else u(new Error("invalid parameters"))}))},addConvertedDisplayUnitsToExtensions:function(r){var a=this;return new t((function(i,n){s.getExtensions({class_name:[r.strClassName,"DELResourcePrmAbstract"],Extensions:Object.keys(r.arrExtensions),blnIncludeParent:!0,blnCustoOnly:!0,blnGetProperties:!0}).then((function(s){if(s){var c=[];e.each(r.arrExtensions,(function(r,i){s[r]&&s[r].length&&i&&e.Object.isPlainObject(i)&&!e.Object.isEmptyObject(i)&&e.each(s[r],(function(r,s){s&&s.name&&s.properties&&s.properties.length&&e.each(s.properties,(function(r,s){s&&s.dimension&&s.preferred_unit&&c.push(new t((function(r,n){a.getMagnitudes({filter:"dimensionName+eq+"+s.dimension,magnitude:s.dimension}).then((function(c){if(c&&c[s.dimension]){var o=c[s.dimension].MKSUnit;return!o&&c[s.dimension].Units&&c[s.dimension].Units.length&&e.each(c[s.dimension].Units,(function(e,r){return r&&r.default&&(o=r.Name),!o})),o&&s.preferred_unit!==o?Array.isArray(i[s.name])?t.all(i[s.name].map((function(e){return a.convertValueToUnit({value:e,dimension:s.dimension,fromUnit:s.preferred_unit,toUnit:o})}))).then((function(e){i[s.name+".displayValue"]=e.map(Number),r()}),n):a.convertValueToUnit({value:i[s.name],dimension:s.dimension,fromUnit:s.preferred_unit,toUnit:o}).then((function(e){i[s.name+".displayValue"]=+e,r()}),n):void r()}n()}),n)}),n))}))}))})),t.all(c).then((function(){i(r.arrExtensions)}),n)}else n()}),n)}))},unassociateResourceParameterFromList:function(r){var n=this;return new t((function(t,c){r&&e.Object.isPlainObject(r)?r.resourceParameterQueryList||r.resourceParameterListQueryList?s.getServiceUrl({serviceName:"3DSpace"}).then((function(o){if(o&&"string"==typeof o){var u={};if(e.each(["resourceParameter","resourceParameterphysicalid","resourceParameterOXID","resourceParameterQueryList"],(function(e,t){r[t]&&(u[t]=r[t])})),r.resourceParameterListphysicalid&&(u.resourceParameterListphysicalid=r.resourceParameterListphysicalid),e.Object.isEmptyObject(u)){if(e.each(["resourceParameterList","resourceParameterListphysicalid","resourceParameterListOXID","resourceParameterListQueryList","resourceParameter","resourceParameterphysicalid","resourceParameterOXID","resourceParameterQueryList"],(function(e,t){r[t]&&(u[t]=r[t])})),e.Object.isEmptyObject(u))return void c(new Error("invalid parameters"));u.param_list&&!u.target_param_list&&(u.target_param_list=u.param_list),delete u.param_list}var l=new window.FormData;s.useFixtures()?l=u:e.each(u,(function(r,t){"string"!=typeof t&&isNaN(t)?l.append(r,e.Json.encode(t)):l.append(r,t)}));var d=o+"/resources/DELWebInfrastructureLite/v0/resource/parameter?unassociateResourceParameterFromList";s.callAuthenticatedRequest(d,"json","DELETE",l).then((function(o){if(o){var u=s.commonAjaxJsonResponseOK(o,c);if(!u)return u;a.setDatabase();var l=o.Data||{},m=[],p=!0;e.each(l,(function(t,a){if("SuccessfullyDeleted"===t||"AlreadyDeleted"===t)e.each(a,(function(t,a){if(a&&e.Object.isPlainObject(a)&&!e.Object.isEmptyObject(a)){if(p=!0,!a.resourceParameter)if(r.resourceParameterList){var s=e.clone(a);a.properties=Object.assign(s,r.resourceParameterList)}else r.resourceParameterListAssociationOXID||r.resourceParameterListAssociationphysicalid?a.properties=Object.assign({OXID:r.resourceParameterListAssociationOXID,physicalid:r.resourceParameterListAssociationphysicalid},a):a.physicalid&&(a.properties={physicalid:a.physicalid});a.resourceParameterList||(r.resourceParameterList?a.resourceParameterList=r.resourceParameterList:(r.resourceParameterListphysicalid||r.resourceParameterListOXID)&&(a.resourceParameterList={physicalid:r.resourceParameterListphysicalid,OXID:r.resourceParameterListOXID})),a.resource||(r.resource?a.resource=r.resource:(r.target_physicalid||r.target_OXID)&&(a.resource={OXID:r.target_OXID,physicalid:r.target_physicalid})),n._cacheResourceParameterToResourceParameterListUnassoc(a),m.push({event:"ResourceParameter.unassociated",data:a})}else e.log("DELWebResourceParameterModel::unassociateResourceParameterFromList - invalid response from "+d)}));else if("FailedUnassociated"===t){var s=e.clone(l);s=Object.assign(s,r),e.each(a,(function(r,a){0===r.indexOf("[")?s.resourceParameterListOXID=r:s.resourceParameterListphysicalid=r,e.each(a,(function(e,r){0===r.indexOf("[")?s.target_OXID=r:s.target_physicalid=r,m.push({event:"ResourceParameter.unassociated.error",data:s}),p=!1,c(t,s)}))}))}else e.log("unknown response key: "+t)})),e.each(m,(function(e,r){s.publishEvent(r.event,r.data)})),p&&(l&&!e.Object.isEmptyObject(l)?t(e.clone(l)):c(new Error(i.get("Error"))))}else c(new Error("invalid server response"))}),c)}else c(new Error("invalid 3DSpace URL"))}),c):c(new Error("No resource parameter list provided!")):c(new Error("invalid parameters"))}))},_cacheResource:function(r,t){if(window.Foe&&window.Foe.Model&&window.Foe.Model.Asset&&window.Foe.Model.Asset.cacheResourcePLMObject)return window.Foe.Model.Asset.cacheResourcePLMObject(r,t);var a=r;if(!a||!a.blnDoNotCache){n.resource||(n.resource={});var i=n.resource;if(a&&(a.OXID||a.physicalid)){a.OXID&&!a.physicalid&&(a.physicalid=s.getPhysicalIDForOXID(a.OXID)),t||"False"===a.Minimum?a.AllAttributesRetrieved=!0:a.AllAttributesRetrieved=a.AllAttributesRetrieved||!1;var c=Object.assign({},a);if(i[c.physicalid]){var o=e.Object.extend(!0,i[c.physicalid],c);i[a.physicalid]=o,a.OXID&&(i[a.OXID]=i[a.physicalid])}else i[a.physicalid]=a,a.OXID&&(i[a.OXID]=i[a.physicalid])}}},_cacheResourceParameterList:function(r){n.parameter_list||(n.parameter_list={});var t=n.parameter_list;if(r.OXID||r.physicalid){if(r.plmBaseObjectType||(r.plmBaseObjectType="DELResourceParameterListReference"),t[r.physicalid||r.OXID]){var a=e.Object.extend(!0,t[r.physicalid||r.OXID],r);t[r.physicalid||r.OXID]=a,e.Object.extend(!0,r,a)}else t[r.physicalid||r.OXID]=r;r.OXID&&r.physicalid&&(t[r.OXID]=t[r.physicalid])}},_cacheResourceToResourceParameterListAssoc:function(r,t,a){if(r&&t&&a){if(n.parameter_list_assoc||(n.parameter_list_assoc={}),!n.parameter_list_assoc[r])if(0===r.indexOf("[")){var i=s.getPhysicalIDForOXID(r);n.parameter_list_assoc[i]||(n.parameter_list_assoc[i]={}),n.parameter_list_assoc[r]=n.parameter_list_assoc[i]}else n.parameter_list_assoc[r]={};if(n.parameter_list_assoc[r]&&a&&(a.resourceParameterList||(a.resourceParameterList={physicalid:t},0===t.indexOf("[")&&(a.resourceParameterList.OXID=t,a.resourceParameterList.physicalid=s.getPhysicalIDForOXID(t))),n.parameter_list_assoc[r][a.resourceParameterList.physicalid]=a),delete n.parameter_list_assoc.All,n.resource&&n.resource[r]&&n.resource[r].V_discipline?delete n.parameter_list_assoc[n.resource[r].V_discipline]:a&&a.resource&&a.resource.V_discipline&&delete n.parameter_list_assoc[a.resource.V_discipline],n.parameter_list&&n.parameter_list[t]){var c=n.parameter_list[t];c.associatedResources||(c.associatedResources=[]),c.associatedResources.indexOf(r)<0&&c.associatedResources.push(r)}}else e.log("DELWebResourceParameterModel::_cacheResourceToResourceParameterListAssoc - missing input parameters!")},_cacheResourceToResourceParameterListUnassoc:function(r){if(r){if(n.parameter_list_assoc&&(r.resource&&r.resource.physicalid||!r.resourceParameterList||!r.resourceParameterList.physicalid||e.each(n.parameter_list_assoc,(function(e,t){return t&&t[r.resourceParameterList.physicalid]&&(r.resource={physicalid:e}),!r.resource})),r.resource&&r.resource.physicalid&&n.parameter_list_assoc[r.resource.physicalid]&&(r.resourceParameterList&&r.resourceParameterList.physicalid?(r.resourceParameterList&&r.resourceParameterList.physicalid||!n.parameter_list_assoc[r.resource.physicalid][r.resourceParameterList.physicalid]||(r.resourceParameterList=n.parameter_list_assoc[r.resource.physicalid][r.resourceParameterList.physicalid].resourceParameterList),delete n.parameter_list_assoc[r.resource.physicalid][r.resourceParameterList.physicalid]):r.resourceParameterList&&r.resourceParameterList.physicalid&&e.each(n.parameter_list_assoc[r.resource.physicalid],(function(e,t){t&&t.resourceParameterList&&t.resourceParameterList.physicalid===r.resourceParameterList.physicalid&&delete n.parameter_list_assoc[r.resource.physicalid][e]}))),r.resourceParameterList&&r.resourceParameterList.physicalid&&r.resource&&r.resource.physicalid&&n.parameter_list&&n.parameter_list[r.resourceParameterList.physicalid]))for(var t=n.parameter_list[r.resourceParameterList.physicalid];t.associatedResources&&t.associatedResources.length&&t.associatedResources.indexOf(r.resource.physicalid)>=0;)t.associatedResources.splice(t.associatedResources.indexOf(r.resource.physicalid),1)}else e.log("DELWebResourceParameterModel::_cacheResourceToResourceParameterListUnassoc - missing input parameters!")},_cacheResourceParameterToResourceParameterListUnassoc:function(r){if(r){if(n.parameter_list)if(r.resourceParameterList&&r.resourceParameterList.physicalid||!r.properties||!r.properties.physicalid||e.each(n.parameter_list,(function(e,t){return t&&t[r.properties.physicalid]&&(r.resourceParameterList={physicalid:e}),!r.resourceParameterList})),r.resourceParameterList&&r.resourceParameterList.physicalid&&r.properties&&r.properties.physicalid){if(n.parameter_list&&n.parameter_list[r.resourceParameterList.physicalid])for(var t=n.parameter_list[r.resourceParameterList.physicalid];t.associatedResourceParameters&&t.associatedResourceParameters.length&&t.associatedResourceParameters.indexOf(r.properties.physicalid)>=0;)t.associatedResourceParameters.splice(t.associatedResourceParameters.indexOf(r.properties.physicalid),1)}else r.physicalid&&n.parameter_list&&e.each(n.parameter_list,(function(e,t){for(;t.associatedResourceParameters&&t.associatedResourceParameters.length&&t.associatedResourceParameters.indexOf(r.physicalid)>=0;)t.associatedResourceParameters.splice(t.associatedResourceParameters.indexOf(r.physicalid),1)}))}else e.log("DELWebResourceParameterModel::_cacheResourceParameterToResourceParameterListUnassoc - missing input parameters!")},_cacheResourceParameterToResourceParameterListAssoc:function(r,t){if(r&&t){if(n.parameter_list||(n.parameter_list={}),!n.parameter_list[r])if(0===r.indexOf("[")){var a=s.getPhysicalIDForOXID(r);n.parameter_list[a]||(n.parameter_list[a]={}),n.parameter_list[r]=n.parameter_list[a]}else n.parameter_list[r]={};n.parameter_list[r]&&t&&(t.resourceParameterList||(t.resourceParameterList={physicalid:r},0===r.indexOf("[")&&(t.resourceParameterList.OXID=r,t.resourceParameterList.physicalid=s.getPhysicalIDForOXID(r))),n.parameter_list[r].associatedResourceParameters||(n.parameter_list[r].associatedResourceParameters=[]),t.properties&&t.properties.physicalid&&n.parameter_list[r].associatedResourceParameters.push(t.properties.physicalid))}else e.log("DELWebResourceParameterModel::_cacheResourceParameterToResourceParameterListAssoc - missing input parameters!")},updateDefaultMagnitudes:function(r){var a=this;return new t((function(t,c){r&&e.Object.isPlainObject(r)?s.getServiceUrl({serviceName:"3DSpace"}).then((function(o){if(o&&"string"==typeof o){var u={};r&&r.dimensionList&&(u.key="preference_DimensionsList",u.value=r.dimensionList);var l=o+"/resources/DELWebInfrastructure/v0/preferences/ThreeDSpace";s.useFixtures()&&(l=o+"/resources/DELWebInfrastructure/v0/ThreeDSpacePreferences?updateDefaultMagnitudes"),s.callAuthenticatedRequest(l,"json","PATCH",u).then((function(r){if(r){var o=s.commonAjaxJsonResponseOK(r,c);if(!o)return o;r.Data&&r.Data.preference_DimensionsList||(r.Data.preference_DimensionsList="ANGLEParameter;LENGTHParameter;MASSParameter;");var l=[];e.each(r.Data.preference_DimensionsList.split(";"),(function(e,r){r&&l.push(r.replace("Parameter",""))})),u={filter:"dimensionName+eq+"+l.join(",")},a.getMagnitudes(u).then((function(r){r&&(s.useFixtures()&&l.length&&e.each(r,(function(e){l.indexOf(e)<0&&delete r[e]})),l&&l.indexOf("Integer")>=0&&(r.INTEGER={Name:"Integer",NLS:i.get("Integer")}),l&&l.indexOf("String")>=0&&(r.STRING={Name:"String",NLS:i.get("Text")}),n._dimensionsPreferred=r),t(e.clone(r))}),c)}else c(new Error("invalid server response"))}),c)}else c(new Error("invalid 3DSpace URL"))}),c):c(new Error("invalid parameters"))}))},getDefaultMagnitudes:function(r){var a=this;return r||(r={}),new t((function(t,c){!r.blnForceRefresh&&n&&n._dimensionsPreferred&&e.Object.isPlainObject(n._dimensionsPreferred)&&!e.Object.isEmptyObject(n._dimensionsPreferred)||n&&n._dimensionsPreferred&&e.Object.isPlainObject(n._dimensionsPreferred)&&!e.Object.isEmptyObject(n._dimensionsPreferred)&&s.useFixtures()?t(e.clone(n._dimensionsPreferred)):s.getServiceUrl({serviceName:"3DSpace"}).then((function(r){if(r&&"string"==typeof r){var o={key:"preference_DimensionsList"},u=r+"/resources/DELWebInfrastructure/v0/preferences/ThreeDSpace";s.useFixtures()&&(u=r+"/resources/DELWebInfrastructure/v0/ThreeDSpacePreferences"),s.callAuthenticatedRequest(u,"json","GET",o).then((function(r){if(r){var u=s.commonAjaxJsonResponseOK(r,c);if(!u)return u;r.Data&&r.Data.preference_DimensionsList||(r.Data.preference_DimensionsList="ANGLEParameter;LENGTHParameter;MASSParameter;IntegerParameter;StringParameter");var l=[];e.each(r.Data.preference_DimensionsList.split(";"),(function(e,r){r&&l.push(r.replace("Parameter",""))})),o={filter:"dimensionName+eq+"+l.join(",")},a.getMagnitudes(o).then((function(r){r&&(s.useFixtures()&&l.length&&e.each(r,(function(e){l.indexOf(e)<0&&delete r[e]})),n._dimensionsPreferred=r),l.indexOf("Integer")>-1&&!r.Integer&&(r.Integer={Name:"Integer",NLS:i.get("Integer")}),l.indexOf("String")>-1&&!r.String&&(r.String={Name:"String",NLS:i.get("Text")}),!window||window.Foe&&!window.Foe.Model&&!window.Foe.Model.Session&&window.Foe.Model.Session.checkApplicationFeature&&window.Foe.Model.Session.checkApplicationFeature("TSK11502684","0")?t(e.clone(r)):a.getDefinedArbitraryUnits().then((function(a){a?a&&a.length>0&&l&&l.length>0&&l.indexOf("ARBITRARYUNIT")>-1?(r.ARBITRARYUNIT||(r.ARBITRARYUNIT={Name:"ARBITRARYUNIT",NLS:i.get("Arbitrary Unit")}),r.ARBITRARYUNIT.Units=a,t(e.clone(r))):t(e.clone(r)):c(new Error("No Units Defined"))}),(function(a){a&&t(e.clone(r))}))}),c)}else c(new Error("invalid server response"))}),c)}else c(new Error("invalid 3DSpace URL"))}),c)}))},getMagnitudes:function(r){var a=this;return r||(r={}),new t((function(t,c){if(n&&n._dimensions&&e.Object.isPlainObject(n._dimensions)&&!e.Object.isEmptyObject(n._dimensions)&&!r.blnForceRefresh){if(!r.filter)return void t(e.clone(n._dimensions));if(r.magnitude&&n._dimensions[r.magnitude]){var o={};return o[r.magnitude]=e.clone(n._dimensions[r.magnitude]),void t(o)}}s.getServiceUrl({serviceName:"3DSpace"}).then((function(o){if(o&&"string"==typeof o){var u=o+"/resources/dictionary/dimensions";r.filter&&(u+="?$filter="+r.filter),s.callAuthenticatedRequest(u,"json","GET",{}).then((function(s){try{var o={};s.results.forEach((function(e){o[e.Name]=e})),!window||window.Foe&&window.Foe.Model&&window.Foe.Model.Session&&window.Foe.Model.Session.checkApplicationFeature&&window.Foe.Model.Session.checkApplicationFeature("TSK11502684","0")?(r.filter?n._dimensions&&!e.Object.isEmptyObject(n._dimensions)&&(n._dimensions=Object.assign(n._dimensions||{},o)):n._dimensions=o,t(e.clone(o)),e.log("Dimensions loaded")):a.getDefinedArbitraryUnits().then((function(a){a?(a&&a.length>0&&(r&&r.filter?r.filter.indexOf("ARBITRARYUNIT")>-1&&(o.ARBITRARYUNIT={},o.ARBITRARYUNIT.NLS=i.get("Arbitrary Unit"),o.ARBITRARYUNIT.Name="ARBITRARYUNIT",o.ARBITRARYUNIT.Units=a):(o.ARBITRARYUNIT={},o.ARBITRARYUNIT.NLS=i.get("Arbitrary Unit"),o.ARBITRARYUNIT.Name="ARBITRARYUNIT",o.ARBITRARYUNIT.Units=a)),r.filter?n._dimensions&&!e.Object.isEmptyObject(n._dimensions)&&(n._dimensions=Object.assign(n._dimensions||{},o)):n._dimensions=o,t(e.clone(o)),e.log("Dimensions loaded")):c(new Error("No Units Defined"))}),(function(r){r&&t(e.clone(o))}))}catch(r){e.log("Unexpected error when fetching dimensions"),e.log(r),c(new Error((r.message||r)+" \n"+i.get("DIMENSIONAL_ATTRIBUTES_ARE_INVALID")))}}),(function(r){e.log("Unable to get dimensions : "),e.log(r),c(new Error((r.message||r)+" \n"+i.get("FAILED_TO_FETCH_DIMENSIONAL_ATTRIBUTES")))}),c)}else c(new Error("invalid 3DSpace URL"))}),c)}))},getMagnitudeUnits:function(r){var a=this;return new t((function(t,i){if(r&&e.Object.isPlainObject(r))if(r.magnitude){var c=!1;n&&n._dimensions&&n._dimensions[r.magnitude]&&n._dimensions[r.magnitude].Units&&!r.blnForceRefresh&&(c=!1,e.each(n._dimensions[r.magnitude].Units,(function(e,r){return!(c=r&&r.default)})),c)?t(n._dimensions[r.magnitude].Units.slice(0)):a.getMagnitudes({filter:"dimensionName+eq+"+r.magnitude,magnitude:r.magnitude,blnForceRefresh:r.blnForceRefresh||!1}).then((function(o){o&&o[r.magnitude]?o[r.magnitude].Units&&(c=!1,e.each(o[r.magnitude].Units,(function(e,r){return!(c=r&&r.default)})),c)?t(o[r.magnitude].Units.slice(0)):s.getServiceUrl({serviceName:"3DSpace"}).then((function(c){if(c&&"string"==typeof c){var u={key:"preference_DisplayUnits"},l=JSON.stringify(u);if(n||(n={}),n.getMagnitudeUnits_jqXHR){if(n.getMagnitudeUnits_jqXHR[l]&&(!n.getMagnitudeUnits_jqXHR[l].readyState||4!==n.getMagnitudeUnits_jqXHR[l].readyState))return void setTimeout((function(){a.getMagnitudeUnits(r).then(t,i)}),500)}else n.getMagnitudeUnits_jqXHR={};n.getMagnitudeUnits_jqXHR[l]=r;var d=c+"/resources/DELWebInfrastructure/v0/preferences/ThreeDSpace";s.useFixtures()&&(d=c+"/resources/DELWebInfrastructure/v0/ThreeDSpacePreferences"),s.callAuthenticatedRequest(d,"json","GET",u).then((function(a){if(n.getMagnitudeUnits_jqXHR[l]&&delete n.getMagnitudeUnits_jqXHR[l],a){var c=s.commonAjaxJsonResponseOK(a,i);if(!c)return c;a.Data&&a.Data.preference_DisplayUnits||(a.Data||(a.Data={}),n&&n._dimensions&&!e.Object.isEmptyObject(n._dimensions)?(a.Data.preference_DisplayUnits="",e.each(n._dimensions,(function(e,r){r&&r.MKSUnit&&(a.Data.preference_DisplayUnits&&(a.Data.preference_DisplayUnits+=","),a.Data.preference_DisplayUnits+=(r.Name||e)+"Parameter:"+r.MKSUnit)}))):a.Data.preference_DisplayUnits=r.magnitude+":"+o[r.magnitude].MKSUnit),e.each(a.Data.preference_DisplayUnits.split(","),(function(t,a){if(a){var s=a.split(":"),i=r.magnitude,c=a;2===s.length&&(i=s[0].replace("Parameter",""),c=s[1]),n&&n._dimensions&&n._dimensions[i]&&n._dimensions[i].Units&&e.each(n._dimensions[i].Units,(function(e,r){return!r||r.label!==c&&r.Name!==c||(r.default=!0),!(r&&r.default)})),o[i]&&o[i].Units&&e.each(o[i].Units,(function(e,r){return r&&(r.label===c||r.Name&&r.Name===c)&&(r.default=!0),!(r&&r.default)}))}})),t(o[r.magnitude].Units.slice(0))}else i(new Error("invalid server response"))}),i)}else i(new Error("invalid 3DSpace URL"))}),i):i(new Error("No Units Defined"))}),i)}else i(new Error("no magnitude provided!"));else i(new Error("invalid parameters"))}))},updateMagnitudeUnits:function(r){var a=this,i=[],c=r.defaultUnits;return","===c.slice(-1)&&(c=c.slice(0,-1)),e.each(c.split(","),(function(e,r){if(r){var t=r.split(":"),a="";2===t.length&&(a=t[0].replace("Parameter",""),i.push(a))}})),new t((function(t,c){r&&e.Object.isPlainObject(r)?s.getServiceUrl({serviceName:"3DSpace"}).then((function(o){if(o&&"string"==typeof o){var u={};r&&r.defaultUnits&&(u.key="preference_DisplayUnits",u.value=r.defaultUnits);var l=o+"/resources/DELWebInfrastructure/v0/preferences/ThreeDSpace";s.useFixtures()&&(l=o+"/resources/DELWebInfrastructure/v0/ThreeDSpacePreferences?updateMagnitudeUnits"),s.callAuthenticatedRequest(l,"json","PATCH",u).then((function(r){if(r){var o=s.commonAjaxJsonResponseOK(r,c);if(!o)return o;var u={};e.each(r.Data.preference_DisplayUnits.split(","),(function(r,s){if(s){var o=s.split(":"),l="",d="";2===o.length&&(l=o[0].replace("Parameter",""),d=o[1]),u[o[0]]=o[1],n&&n._dimensions&&n._dimensions[l]&&n._dimensions[l].Units&&e.each(n._dimensions[l].Units,(function(e,r){return r&&(r.label===d||!r.label&&r.Name===d)?r.default=!0:r&&r.default&&delete r.default,!(r&&r.default)})),i.indexOf(l)>-1&&a.getMagnitudeUnits({magnitude:l}).then((function(r){if(r){var a=!1;r&&(e.each(r,(function(e,r){return!(a=r&&r.default)})),a)?t(r.slice(0)):r&&e.each(r,(function(e,r){return r&&(r.label===d||r.Name&&r.Name===d)?r.default=!0:r&&r.default&&delete r.default,!(r&&r.default)}))}else c(new Error("No Units Defined"))}))}})),t(u)}else c(new Error("invalid server response"))}),c)}else c(new Error("invalid 3DSpace URL"))}),c):c(new Error("invalid parameters"))}))},convertValueToUnit:function(r){return new t((function(t,a){r&&e.Object.isPlainObject(r)&&"value"in r&&!isNaN(r.value)&&r.dimension&&r.fromUnit&&r.toUnit?s.getServiceUrl({serviceName:"3DSpace"}).then((function(e){var i={UnitFrom:r.fromUnit,UnitTo:r.toUnit,Dimension:r.dimension,Value:""+r.value},n=e+"/resources/dictionary/dimensions/convertValue";s.callAuthenticatedRequest(n,"json","POST",JSON.stringify(i)).then((function(e){e&&"ConvertValue"in e?t(e.ConvertValue):a(new Error("invalid server response"))}),a)}),a):a(new Error("invalid parameters"))}))},getOneResource:function(r){var a=this;return new t((function(t,i){if(r&&e.Object.isPlainObject(r))if(r.physicalid){"Minimum"in r&&!0!==r.Minimum?r.Minimum&&Array.isArray(r.Minimum)||(r.Minimum="False"):r.Minimum="True";var n=r.Minimum,c=["V_Name","physicalid"];r.Minimum&&!Array.isArray(r.Minimum)&&(r.Minimum.match(/true/i)||r.Minimum.match(/yes/i)||r.Minimum.match(/on/i))&&(r.Minimum=c);var o=a._FindPLMObjectInCache(r,r.Minimum);o&&!o.ReferenceOXID&&!o.ReferencePhysicalid&&n&&n.match&&(n.match(/true/i)||n.match(/yes/i)||n.match(/on/i))&&(r.Minimum=c,o=a._FindPLMObjectInCache(r,r.Minimum)),o?t(Object.assign({},o)):(r.class_name||(r.class_name="PRODUCTCFG/VPMReference"),r.Extensions||(r.Extensions="DELRmiResourceModel/Resource"),!r.fixtureTag&&s.useFixtures()&&(r.fixtureTag="getResourceForPhysicalId"),s.getReference(r).then((function(e){e&&a._cacheResource(Object.assign({},e)),t(e)}),i))}else i(new Error("no id provided!"));else i(new Error("invalid parameters"))}))},_FindPLMObjectInCache:function(r,t){var a=Object.assign({},r);if(e.each(a,(function(r,t){(e.Object.isPlainObject(t)||Array.isArray(t))&&delete a[r]})),!a.OXID&&!a.physicalid&&!a.PLM_ExternalID){if(!a.id)return null;a.PLM_ExternalID=a.id}a.OXID&&!a.physicalid&&(a.physicalid=s.getPhysicalIDForOXID(a.OXID));var i=null;return e.each(["parameter_list","parameter","resource"],(function(r,s){var c=n[s];if(c){if(i||!a.OXID&&!a.physicalid||!(i=c[a.physicalid||a.OXID])&&a.OXID&&(i=c[a.OXID])&&a.physicalid&&(c[a.physicalid]=c[a.OXID]),i)if(a.ForceCache?i.ForceCache=a.ForceCache:a.bForceCache&&(i.ForceCache=a.bForceCache),t&&t instanceof Array){o=i,u=t,l=!0,e.each(u,(function(r,t){return t&&"string"!=typeof t&&t.dataIndex&&(t=t.dataIndex),!(l=o.hasOwnProperty(t))&&0===t.indexOf("V_")&&Object.keys&&e.each(Object.keys(o),(function(e,r){return(l=r.indexOf(")."+t)>0&&0===r.indexOf("Ext("))&&(t=r),!l})),!l&&t.indexOf("__Ref_")<0&&"VPMInstance"===o.plmObjectType&&(l=o.hasOwnProperty("__Ref_"+t))&&(t="__Ref_"+t),l})),l||(i=null)}else t&&"false"!==t.toLowerCase()||i.AllAttributesRetrieved||i.ForceCache||(i=null);var o,u,l;return!i}})),i},searchForResourceParameterListData:function(r){var i=this;return new t((function(t,n){r?s.getServiceUrl({serviceName:"3DSearch"}).then((function(c){if(window.Foe&&window.Foe.Model&&window.Foe.Model.Session&&window.Foe.Model.Session.checkApplicationFeature&&!window.Foe.Model.Session.checkApplicationFeature("TSK7174741","0")||!c||"string"!=typeof c)i._searchForResourceParameterListDataWS(r,(function(e){t(e)}),(function(e){n(new Error("invalid 3DSearch URL - "+e))}));else{var o="("+i.get3DSearchString()+")";(r.search_str||r.name)&&"*"!==(r.search_str||r.name)&&(o+=" AND ("+(r.search_str||r.name)+")"),!r.tenant&&window.widget.data&&(r.tenant=window.widget.data.x3dPlatformId);var u=window.widget.data.appId||window.widget.id;window.Foe&&window.Foe&&window.Foe.Model&&window.Foe.Model.Session&&(u=window.Foe.Model.Session.get("user"));var l={query:o,label:u+"-DELWebResourceParameterModel.searchForResourceParameterListData-"+(new Date).getTime(),locale:window.widget.lang,tenant:r.platformId||r.tenant,source:["3dspace"],select_predicate:["ds6w:label","ds6w:type","ds6w:description","bo.PLMEntity.V_description","ds6w:identifier","ds6w:modified","ds6w:created","ds6wg:revision","ds6w:status","ds6w:responsible","owner","ds6w:responsibleUid","ds6wg:filesize","ds6w:project","ds6w:dataSource","ds6w:community","ds6w:repository","dcterms:title","dcterms:description","ds6w:containerUid"],with_synthesis:!1,with_synthesis_attribute:!1};r.Minimum&&Array.isArray(r.Minimum)&&r.Minimum.length&&e.each(r.Minimum,(function(e,r){var t=r;a&&(t=a.convertAttrToSearchPredicate(r)),t&&Array.isArray(t)?t.forEach((function(e){l.select_predicate.indexOf(e)<0&&l.select_predicate.push(e)})):t&&l.select_predicate.indexOf(t)<0&&l.select_predicate.push(t)})),r.endindex&&(l.nresults="startindex"in r?r.endindex-r.startindex:r.endindex),l=window.UWA.Json.encode(l);var d=c+"/search";s.useFixtures()&&(d+="?searchForResourceParameterListData"),s.callAuthenticatedRequest(d,"json","POST",l,(function(){i._searchForResourceParameterListDataWS(r,(function(e){t(e)}),(function(e){n(new Error("invalid 3DSearch URL - "+e))}))})).then((function(n){var c={},o=[];n&&n.results&&n.results.length&&(e.each(n.results,(function(e,t){var n=a.convertToModelObj(t.attributes);!n.id&&n.resourceid&&(n.id=n.resourceid),!n.name&&n["ds6w:label"]&&(n.name=n["ds6w:label"]),c[n.id]=n,s.useFixtures()&&i._cacheResourceParameterList(n,"False"===r.Minimum)})),o=Object.values(c)),t(o)}),(function(e){n(e)}),(function(e){n(e)}))}}),n):n(new Error("Invalid input parameters!"))}))},_searchForResourceParameterListDataWS:function(r,t,a){var n=this;if(a||(a=window.alert),r){var c=r.id||r.search_str;if(c||"id"in r){if(c instanceof Array){var o=c.join(";");c=o}var u={R:Math.random(),search_str:c,class_name:r.class_name?r.class_name:"DELRmiParameterModel/DELResourceParameterListReference",Extensions:"Extensions"in r?r.Extensions:"",Depth:0,Minimum:r.Minimum?r.Minimum:"False"};r.searchByAttribute&&(u.searchByAttribute=r.searchByAttribute),u.Minimum&&"string"==typeof u.Minimum&&"false"!==u.Minimum.toLowerCase()&&"true"!==u.Minimum.toLowerCase()&&(u.Minimum=[u.Minimum]),u.Minimum instanceof Array&&(u.Minimum=JSON.stringify(u.Minimum)),r&&r.startindex>=0&&r.endindex>=0&&(u.startindex=r.startindex,u.endindex=r.endindex),s.getServiceUrl({serviceName:"3DSpace"}).then((function(r){var c=r+"/resources/DELWebInfrastructureLite/v0/referenceFinder?searchForResourceParameterListDataWS";s.callAuthenticatedRequest(c,"json","GET",u).then((function(r){if(r){var c=s.commonAjaxJsonResponseOK(r,a);if(!c)return c;var o=u.class_name.split("/")[1];if(r&&e.Object.isPlainObject(r)&&r[o]&&Array.isArray(r[o])){var l=[],d=!1;e.each(r[o],(function(){var e=this;if(e.name=e.name||e.V_Name||e.PLM_ExternalID||e.id,(n._FindPLMObjectInCache(e,u.Minimum||"True")||s.useFixtures()&&window.Foe&&window.Foe.Model&&window.Foe.Model.Asset)&&n._cacheResourceParameterList(e,e.AllAttributesRetrieved||!1),!d&&s.useFixtures()&&u.search_str&&u.search_str.length){var r=u.search_str.replace("*","");e.V_Name===r&&(d=e)}l.push(e)})),t&&t(l)}else a&&a(i.get("Error getting {0} list",{0:i.get("Resource Parameter List")}))}else a(i.get("Error"))}),a)}),a)}else a("No system id provided!")}else a("Invalid input parameters!")}});if(s.useFixtures()){var u=function(){var e=Math.random().toString();return e.substr(e.indexOf(".")+1)};window.Configuration&&window.Configuration.fixtureDelay&&(window.can.fixture.delay=window.Configuration.fixtureDelay),s.addFixture({type:"GET",url:c+"/resources/DELWebInfrastructureLite/v0/resource/parameterList/resourceAssociation"},(function(r){var t=s.request("../DELWebInfrastructureUI.tst/fixtures/getResourceParameterList.json",{onComplete:function(a){"string"==typeof a&&(a=JSON.parse(a));var s=r.data;if("string"==typeof s&&(s=JSON.parse(s)),s&&s.disciplineFilter&&(a.Data=[],n&&n.parameter_list_assoc)){var i={};e.each(n.parameter_list_assoc,(function(r,t){n.resource&&n.resource[r]&&n.resource[r].V_discipline===s.disciplineFilter&&t&&e.Object.isPlainObject(t)&&!e.Object.isEmptyObject(t)&&(i=Object.assign(i,t))})),e.Object.isEmptyObject(i)||(a.Data=Object.values(i))}t.responseText=JSON.stringify(a),r.complete(t,t.statusText||(t.xhr?t.xhr.statusText:"success"))}})})),s.addFixture({type:"DELETE",url:c+"/resources/DELWebInfrastructureLite/v0/resource/parameterList/resourceAssociation"},(function(r){var t=s.request("../DELWebInfrastructureUI.tst/fixtures/unassociateResourceParameterList.json",{onComplete:function(a){"string"==typeof a&&(a=JSON.parse(a)),a.Data={};var i=r.data;if("string"==typeof i&&(i=JSON.parse(i)),i.target_physicalid||i.target_OXID||i.target_resource){var c=i.target_resource?i.target_resource.physicalid:i.target_physicalid||s.getPhysicalIDForOXID(i.target_OXID);if(n.parameter_list_assoc&&c&&n.parameter_list_assoc[c]){var o=null;if(i.resourceParameterListAssociationphysicalid||i.resourceParameterListAssociationQueryList)a.Data.SuccessfullyUnassociated={},delete a.Data.AlreadyUnassociated,e.each(i.resourceParameterListAssociationQueryList||[i.resourceParameterListAssociationphysicalid],(function(e,r){r&&n.parameter_list_assoc[c][r]?(o=n.parameter_list_assoc[c][r],a.Data.SuccessfullyUnassociated[o.properties.physicalid]=o):(a.Data.AlreadyUnassociated||(a.Data.AlreadyUnassociated=[]),a.Data.AlreadyUnassociated.push({physicalid:r}))}));else if(i.resourceParameterList||i.resourceParameterListphysicalid||i.resourceParameterListOXID||i.resourceParameterListQueryList){a.Data.SuccessfullyUnassociated={},delete a.Data.AlreadyUnassociated;var u=i.resourceParameterListQueryList||[i.resourceParameterList];u&&u.length||(u=[{physicalid:i.resourceParameterListphysicalid||s.getPhysicalIDForOXID(i.resourceParameterListOXID)}]),e.each(u,(function(r,t){t&&t.physicalid&&(o=null,e.each(n.parameter_list_assoc[c],(function(e,r){r.resourceParameterList&&r.resourceParameterList.physicalid===t.physicalid&&(o=n.parameter_list_assoc[c][e],a.Data.SuccessfullyUnassociated[e]=o)})),o||(a.Data.AlreadyUnassociated||(a.Data.AlreadyUnassociated=[]),a.Data.AlreadyUnassociated.push({resource:i.target_resource||{physicalid:c},resourceParameterList:i.resourceParameterList||{physicalid:t.physicalid||r}})))}))}}}t.responseText=JSON.stringify(a),r.complete(t,t.statusText||(t.xhr?t.xhr.statusText:"success"))}})})),s.addFixture({type:"POST",url:c+"/resources/DELWebInfrastructureLite/v0/resource/parameterList/resourceAssociation"},(function(r){var t=s.request("../DELWebInfrastructureUI.tst/fixtures/associateResourceParameterList.json",{onComplete:function(a){"string"==typeof a&&(a=JSON.parse(a)),a.Data={};var i=r.data;if("string"==typeof i&&(i=JSON.parse(i)),i.target_physicalid||i.target_OXID||i.target_resource){var c=i.target_resource?i.target_resource.physicalid:i.target_physicalid||s.getPhysicalIDForOXID(i.target_OXID);if(n.parameter_list_assoc&&c&&n.parameter_list_assoc[c]){var o=null;if(i.resourceParameterList||i.resourceParameterListphysicalid||i.resourceParameterListOXID||i.resourceParameterListQueryList){a.Data.SuccessfullyAssociated={},delete a.Data.AlreadyAssociated;var u=i.resourceParameterListQueryList||[i.resourceParameterList];u&&u.length||(u=[{physicalid:i.resourceParameterListphysicalid||s.getPhysicalIDForOXID(i.resourceParameterListOXID)}]),e.each(u,(function(r,t){if(t&&t.physicalid&&(o=null,e.each(n.parameter_list_assoc[c],(function(e,r){return r.resourceParameterList&&r.resourceParameterList.physicalid===t.physicalid&&(a.Data.AlreadyAssociated||(a.Data.AlreadyAssociated=[]),a.Data.AlreadyAssociated.push(r),o=r),!o})),!o)){var s={physicalid:c};n.resource&&n.resource[c]&&(s=n.resource[c]),n.parameter_list&&n.parameter_list[t.physicalid]&&(t=Object.assign(t,n.parameter_list[t.physicalid])),o={resource:s,resourceParameterList:t,properties:{resourcePhysicalid:s.physicalid,V_Name:s.physicalid+"-"+t.physicalid,V_description:"",physicalid:s.physicalid+"-"+t.physicalid,rplPhysicalid:t.physicalid}},a.Data.SuccessfullyAssociated[o.properties.physicalid]=o}}))}}}t.responseText=JSON.stringify(a),r.complete(t,t.statusText||(t.xhr?t.xhr.statusText:"success"))}})})),s.addFixture({type:"POST",url:c+"/resources/DELWebInfrastructureLite/v0/resource/parameterList"},(function(r){var t=s.request("../DELWebInfrastructureUI.tst/fixtures/createResourceParameterList.json",{onComplete:function(a){"string"==typeof a&&(a=JSON.parse(a));var s=a.Data;a.Data={};var i=r.data;if("string"==typeof i&&(i=JSON.parse(i)),i.target_physicalid||i.target_OXID||i.target_resource){a.Data.SuccessfullyAssociated=[],i.target_resource||(i.target_resource={},i.target_physicalid&&(i.target_resource.physicalid=i.target_physicalid),i.target_OXID&&(i.target_resource.OXID=i.target_OXID));var c=null;e.each(s.SuccessfullyAssociated,(function(r,t){return t&&t.resource&&t.resourceParameterList&&(c=e.clone(t)),!c})),c&&(c.resource=i.target_resource,n&&n.resource&&n.resource[i.target_resource.physicalid||i.target_resource.OXID]&&(c.resource=n.resource[i.target_resource.physicalid||i.target_resource.OXID]),delete c.resourceParameterList.physicalid,delete c.resourceParameterList.OXID,delete c.resourceParameterList.PLM_ExternalID,delete c.resourceParameterList.name,delete c.resourceParameterList.V_Name,delete c.resourceParameterList.V_description,c.resourceParameterList=Object.assign(c.resourceParameterList,{physicalid:u(),V_Name:null,V_description:""}),e.each(c.resourceParameterList,(function(e){i[e]&&(c.resourceParameterList[e]=i[e])})),a.Data[c.resourceParameterList.physicalid]=c.resourceParameterList,a.Data.SuccessfullyAssociated.push(c))}t.responseText=JSON.stringify(a),r.complete(t,t.statusText||(t.xhr?t.xhr.statusText:"success"))}})})),s.addFixture({type:"PATCH",url:c+"/resources/DELWebInfrastructureLite/v0/resource?updateResourceParameterList"},(function(r){var t=s.request("../DELWebInfrastructureUI.tst/fixtures/updateResourceParameterList.json",{onComplete:function(a){"string"==typeof a&&(a=JSON.parse(a)),a.Data={ChangedAttributes:{}};var s=r.data;"string"==typeof s&&(s=JSON.parse(s)),s.attributes&&"string"==typeof s.attributes&&(s.attributes=JSON.parse(s.attributes)),e.each(s.attributes,(function(e,r){(r.V_Name||"V_description"in r)&&(r.V_Name&&(a.Data.ChangedAttributes.V_Name=r.V_Name),"V_description"in r&&(a.Data.ChangedAttributes.V_description=r.V_description))})),t.responseText=JSON.stringify(a),r.complete(t,t.statusText||(t.xhr?t.xhr.statusText:"success"))}})})),s.addFixture({type:"GET",url:c+"/resources/DELWebInfrastructureLite/v0/referenceFinder?getOneResourceParameterList"},"../DELWebInfrastructureUI.tst/fixtures/getResourceParameterListOne.json"),s.addFixture({type:"GET",url:c+"/resources/DELWebInfrastructureLite/v0/resource/parameter"},"../DELWebInfrastructureUI.tst/fixtures/getResourceParametersForList.json"),s.addFixture({type:"POST",url:c+"/resources/DELWebInfrastructureLite/v0/resource/parameter?createResourceParameter"},(function(r){var t=s.request("../DELWebInfrastructureUI.tst/fixtures/createResourceParameter.json",{onComplete:function(a){"string"==typeof a&&(a=JSON.parse(a));var s=r.data;"string"==typeof s&&(s=JSON.parse(s));var i="DELRscPrmIORangeValue_";"Integer"===s.resourceParameterExtension?i="Integer":"String"===s.resourceParameterExtension&&(i="Text");var n=null,c=null;e.each(a.Data,(function(e,r){return r&&(c||(c=r),!n&&r.interfaces&&r.interfaces.length&&r.interfaces[0].length&&r.interfaces[0][0].indexOf(i)>=0&&(n=r)),!n})),!n&&c&&(n=c),a.Data={},n&&(n.physicalid=u(),delete n.OXID,n.PLM_ExternalID="rpl-fixture_"+n.physicalid,delete n.name,e.each(n,(function(r){if("Integer"!==s.resourceParameterExtension&&"String"!==s.resourceParameterExtension)s[r]&&(n[r]=s[r]);else if(delete n.maxLimit,delete n.minLimit,delete n.maxValue,delete n.minValue,delete n.units,s[r]&&(n[r]=s[r]),s.V_Values){var t=JSON.parse(s.V_Values);n.V_Values=[],e.each(t,(function(e,r){n.V_Values[e]=r}))}})),s.resourceParameterExtension&&"Integer"!==s.resourceParameterExtension&&"String"!==s.resourceParameterExtension&&(n.interfaces=[["DELRscPrmIORangeValue_"+s.resourceParameterExtension,"DELRscPrmIOValueAbstract"]]),s.extensions&&("string"==typeof s.extensions&&(s.extensions=JSON.parse(s.extensions)),n.extensions=e.Object.extend(!0,{},s.extensions),e.each(s.extensions,(function(e,r){n.interfaces.push([e])}))),s.inputOutput&&(n.plmObjectTypeInternal=n.V_discipline="DELResourcePrm"+s.inputOutput.toUpperCase(),n.OXID="["+n.physicalid+","+n.plmObjectTypeInternal+",businessobject]"),a.Data[n.physicalid]=n),t.responseText=JSON.stringify(a),r.complete(t,t.statusText||(t.xhr?t.xhr.statusText:"success"))}})})),s.addFixture({type:"PATCH",url:c+"/resources/DELWebInfrastructureLite/v0/resource/parameter?updateResourceParameter"},(function(r){var t=s.request("../DELWebInfrastructureUI.tst/fixtures/updateResourceParameter.json",{onComplete:function(a){"string"==typeof a&&(a=JSON.parse(a)),a.Data={ChangedAttributes:{}};var s=r.data;if("string"==typeof s&&(s=JSON.parse(s)),(s.V_Name||"V_description"in s)&&(s.V_Name&&(a.Data.ChangedAttributes.V_Name=s.V_Name),"V_description"in s&&(a.Data.ChangedAttributes.V_description=s.V_description)),s.attributes&&"string"==typeof s.attributes){var i=JSON.parse(s.attributes);$.each(i,(function(e,r){a.Data.ChangedAttributes[e]=r}))}s.extensions&&(a.Data.extensions=s.extensions,"string"==typeof a.Data.extensions&&(a.Data.extensions=JSON.parse(a.Data.extensions)),a.Data.interfaces?"string"==typeof a.Data.interfaces&&(a.Data.interfaces=JSON.parse(a.Data.interfaces)):n.parameter&&s.resourceParameterPhysicalid&&n.parameter[s.resourceParameterPhysicalid]&&n.parameter[s.resourceParameterPhysicalid].interfaces?a.Data.interfaces=n.parameter[s.resourceParameterPhysicalid].interfaces.slice(0):a.Data.interfaces=[],e.each(Object.keys(a.Data.extensions),(function(r,t){var s=!1;e.each(a.Data.interfaces,(function(e,r){return r&&Array.isArray(r)&&(s=r.indexOf(t)>=0),!s})),s||a.Data.interfaces.push([[t]])}))),s.extensionsToRemove&&(a.Data.removedExtensions=s.extensionsToRemove,"string"==typeof a.Data.removedExtensions&&(a.Data.removedExtensions=JSON.parse(a.Data.removedExtensions)),e.each(a.Data.removedExtensions,(function(e,r){if(a.Data.extensions&&a.Data.extensions[r]&&delete a.Data.extensions[r],a.Data.interfaces){"string"==typeof a.Data.interfaces&&(a.Data.interfaces=JSON.parse(a.Data.interfaces));for(var t=a.Data.interfaces.length-1;t>=0;--t){var s=a.Data.interfaces[t];s&&Array.isArray(s)&&s.indexOf(r)>=0&&a.Data.interfaces.splice(t,1)}}}))),t.responseText=JSON.stringify(a),r.complete(t,t.statusText||(t.xhr?t.xhr.statusText:"success"))}})})),s.addFixture({type:"DELETE",url:c+"/resources/DELWebInfrastructureLite/v0/resource/parameter?unassociateResourceParameterFromList"},(function(r){var t=s.request("../DELWebInfrastructureUI.tst/fixtures/unassociateResourceParameterFromList.json",{onComplete:function(a){"string"==typeof a&&(a=JSON.parse(a)),a.Data={};var i=r.data;"string"==typeof i&&(i=JSON.parse(i));var c=i.resourceParameterListphysicalid,o=null;if(i.resourceParameterPhysicalid||i.resourceParameterQueryList)a.Data.SuccessfullyDeleted={},delete a.Data.AlreadyUnassociated,e.each(i.resourceParameterQueryList||[{physicalid:i.resourceParameterPhysicalid}],(function(e,r){var t=r.physicalid;!i.resourceParameterListphysicalid&&t&&n.parameter&&n.parameter[t]&&n.parameter[t].rplPhysicalid&&(c=n.parameter[t].rplPhysicalid),t&&n.parameter[t]&&n.parameter_list[c]&&n.parameter_list[c].associatedResourceParameters&&n.parameter_list[c].associatedResourceParameters.indexOf(t)>=0?(o=n.parameter[t],a.Data.SuccessfullyDeleted[t]=o):(a.Data.AlreadyUnassociated||(a.Data.AlreadyUnassociated=[]),a.Data.AlreadyUnassociated.push({physicalid:t}))}));else if(i.resourceParameterList||i.resourceParameterListphysicalid||i.resourceParameterListOXID||i.resourceParameterListQueryList){a.Data.SuccessfullyDeleted={},delete a.Data.AlreadyUnassociated;var u=i.resourceParameterListQueryList||(i.resourceParameterList?[i.resourceParameterList]:null);u&&u.length||(u=[{physicalid:i.resourceParameterListphysicalid||s.getPhysicalIDForOXID(i.resourceParameterListOXID)}]),e.each(u,(function(r,t){t&&t.physicalid&&(o=null,e.each(n.parameter_assoc[c],(function(e,r){r.resourceParameterList&&r.resourceParameterList.physicalid===t.physicalid&&(o=n.parameter_assoc[c][e],a.Data.SuccessfullyDeleted[e]=o)})),o||(a.Data.AlreadyUnassociated||(a.Data.AlreadyUnassociated=[]),a.Data.AlreadyUnassociated.push({resource:i.target_resource||{physicalid:c},resourceParameterList:i.resourceParameterList||{physicalid:c}})))}))}t.responseText=JSON.stringify(a),r.complete(t,t.statusText||(t.xhr?t.xhr.statusText:"success"))}})})),s.addFixture({type:"PATCH",url:c+"/resources/DELWebInfrastructure/v0/ThreeDSpacePreferences?updateDefaultMagnitudes"},(function(e){var r=s.request("../DELWebInfrastructureUI.tst/fixtures/updateDefaultMagnitudes.json",{onComplete:function(t){"string"==typeof t&&(t=JSON.parse(t)),t.Data={};var a=e.data;"string"==typeof a&&(a=JSON.parse(a)),"preference_DimensionsList"===a.key&&(t.Data.preference_DimensionsList=a.value),r.responseText=JSON.stringify(t),e.complete(r,r.statusText||(r.xhr?r.xhr.statusText:"success"))}})})),s.addFixture({type:"PATCH",url:c+"/resources/DELWebInfrastructure/v0/ThreeDSpacePreferences?updateMagnitudeUnits"},(function(r){var t=s.request("../DELWebInfrastructureUI.tst/fixtures/updateMagnitudeUnits.json",{onComplete:function(a){"string"==typeof a&&(a=JSON.parse(a));var s=a.Data.preference_DisplayUnits.split(","),i=[];e.each(s,(function(e,r){if(e%2==0){var t=r.split(":");i.push(t[0])}})),a.Data={};var n=r.data;"string"==typeof n&&(n=JSON.parse(n)),"preference_DisplayUnits"===n.key&&(a.Data.preference_DisplayUnits=n.value),t.responseText=JSON.stringify(a),r.complete(t,t.statusText||(t.xhr?t.xhr.statusText:"success"))}})})),s.addFixture({type:"POST",url:c+"/resources/dictionary/dimensions/convertValue"},(function(e){var r=s.request("../DELWebInfrastructureUI.tst/fixtures/dimensions_convertValue.json",{onComplete:function(t){"string"==typeof t&&(t=JSON.parse(t));var a=e.data;"string"==typeof a&&(a=JSON.parse(a)),t.UnitFrom=a.UnitFrom,t.UnitTo=a.UnitTo,t.ValueToConvert=a.Value||0,t.ConvertValue=-t.ValueToConvert,r.responseText=JSON.stringify(t),e.complete(r,r.statusText||(r.xhr?r.xhr.statusText:"success"))}})})),s.addFixture({type:"GET",url:c+"/resources/dictionary/dimensions"},"../DELWebInfrastructureUI.tst/fixtures/getMagnitudes.json"),s.addFixture({type:"GET",url:c+"/resources/uom/configuration/units"},"../DELWebInfrastructureUI.tst/fixtures/getDefinedArbitraryUnits.json"),s.addFixture({type:"GET",url:c+"/resources/uom/configuration/parameters"},"../DELWebInfrastructureUI.tst/fixtures/getDefinedParameterOntologies.json"),s.addFixture({type:"GET",url:c+"/resources/DELWebInfrastructure/v0/preferences/ThreeDSpace"},"../DELWebInfrastructureUI.tst/fixtures/getThreeDSpacePreferences.json"),s.addFixture({type:"GET",url:c+"/resources/DELWebInfrastructure/v0/ThreeDSpacePreferences"},"../DELWebInfrastructureUI.tst/fixtures/getThreeDSpacePreferences.json"),s.addFixture({type:"POST",url:c.substr(0,c.lastIndexOf("/"))+"/federated/search?searchForResourceParameterListData"},(function(r){var t=s.request("../DELWebInfrastructureUI.tst/fixtures/getResourceParameterListSearchData.json",{onComplete:function(s){if("string"==typeof s&&(s=JSON.parse(s)),n&&n.parameter_list&&!e.Object.isEmptyObject(n.parameter_list)){var i=[];e.each(s.results,(function(r,t){e.each(t.attributes,(function(e,r){return"resourceid"!==r.name||(i.push(r.value),!1)}))}));var c=s.results[0].attributes;e.each(n.parameter_list,(function(r,t){if(r===t.physicalid&&!(i.indexOf(t.physicalid)>=0)){i.push(t.physicalid);var n=[];e.each(c,(function(r,s){var i=e.Object.extend(!0,{},s),c=a.convertSearchPredicateToAttr(i.name.replace(":snippet",""));if(c){switch(c){case"resourceid":i.value=t.physicalid||null;break;case"ds6w:identifier":i.value=t.PLM_ExternalID||null;break;case"label":i.value=t.V_Name||null;break;default:i.value=t[c]||i.value||null}n.push(i)}else e.log("DELWebResourceParameterModel::getResourceParameterListSearchData fixture- unknown attribute = "+i.name)})),s.results.push({attributes:n})}}))}t.responseText=JSON.stringify(s),r.complete(t,t.statusText||(t.xhr?t.xhr.statusText:"success"))}})})),s.addFixture({type:"GET",url:c+"/resources/DELWebInfrastructureLite/v0/referenceFinder?searchForResourceParameterListDataWS"},(function(r){var t=s.request("../DELWebInfrastructureUI.tst/fixtures/getResourceParameterListSearchDataWS.json",{onComplete:function(a){if("string"==typeof a&&(a=JSON.parse(a)),n&&n.parameter_list&&!e.Object.isEmptyObject(n.parameter_list)){var s=[];e.each(a.DELResourceParameterListReference,(function(e,r){r.physicalid&&s.push(r.physicalid)})),e.each(n.parameter_list,(function(e,r){e===r.physicalid&&(s.indexOf(r.physicalid)>=0||(s.push(r.physicalid),a.DELResourceParameterListReference.push(r)))}))}t.responseText=JSON.stringify(a),r.complete(t,t.statusText||(t.xhr?t.xhr.statusText:"success"))}})})),s.addFixture({type:"GET",url:c+"/resources/DELWebInfrastructure/v0/interface/getImmediateDerivative?getExtensions&DELResourcePrmINPUT"},"../DELWebInfrastructureUI.tst/fixtures/getExtensions_DELResourcePrmINPUT.json"),s.addFixture({type:"GET",url:c+"/resources/DELWebInfrastructure/v0/interface/getImmediateDerivative?getExtensions&DELResourcePrmOUTPUT"},"../DELWebInfrastructureUI.tst/fixtures/getExtensions_DELResourcePrmOUTPUT.json"),s.addFixture({type:"GET",url:c+"/resources/DELWebInfrastructure/v0/attributesDictionary?getExtensionProperties&DELResourcePrmINPUT"},"../DELWebInfrastructureUI.tst/fixtures/attributesDictionary_DELResourcePrmINPUT.json"),s.addFixture({type:"GET",url:c+"/resources/DELWebInfrastructure/v0/attributesDictionary?getExtensionProperties&DELResourcePrmOUTPUT"},"../DELWebInfrastructureUI.tst/fixtures/attributesDictionary_DELResourcePrmOUTPUT.json")}return o}));