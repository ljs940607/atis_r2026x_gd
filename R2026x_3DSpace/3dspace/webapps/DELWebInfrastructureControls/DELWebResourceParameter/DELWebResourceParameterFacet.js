window.define&&define("DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterFacet",["DS/DELWebInfrastructureControls/UWAUtils","UWA/Promise","DS/EditPropWidget/facets/Common/FacetsBase","DS/EditPropWidget/buttonsBar/ButtonsBar","DS/EditPropWidget/constants/EditPropConstants","DS/DELWebInfrastructureControls/Mask","DS/DELWebInfrastructureControls/DELWebAjaxModel","DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterModel","DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterListDlg","DS/DELWebInfrastructureControls/DELWebResourceParameter/DELWebResourceParameterDlg","DS/DELWebInfrastructureControls/DELWebNotifications","DS/DataGridView/DataGridView","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/Windows/Dialog","DS/Controls/Button","DS/CoreEvents/Events","DS/VENMomentJS-2.23.0/moment-timezone","i18n!DS/DELWebInfrastructureControls/assets/nls/DELWebInfrastructureControls","css!DS/DELWebInfrastructureControls/DELWebInfrastructureControls.css"],(function(e,t,n,i,o,a,s,r,l,d,u,c,p,m,g,h,f,w,b){"use strict";var _=n.extend({_eventSubscriptionTokens:[],_listOfMagnitudes:{},_listofMagnitudeUnits:{},_blnIsUnitsInDropdownListPair:!1,init:function(t){this._parent.apply(this,arguments),t&&e.Object.isPlainObject(t)&&!e.Object.isEmptyObject(t)?(this.options&&this.options.modelCache&&e.Function.isFunction(this.options.modelCache)&&(r.setCacheObject(this.options.modelCache()),delete this.options.modelCache),this.options=Object.assign(this.options,t)):this.options||(this.options={}),this.elements.container||(this.elements.container=e.createElement("div",{class:"content_section "+this.getClassNames(),styles:{height:"100%"}})),this.elements.content||(this.elements.content=e.createElement("div",{class:this.getClassNames("-content")}).inject(this.elements.container)),this._type=t.type||"resource",this._initTopBar(),this._initEventHandlers()},destroyComponent:function(){this.elements&&this.elements.TopBar&&this.elements.TopBar.container&&this.elements.TopBar.container.remove&&this.elements.TopBar.container.remove(),this.elements&&this.elements.container&&this.elements.container.remove&&this.elements.container.remove(),this._parent.apply(this,arguments),e.each(this._eventSubscriptionTokens||[],(function(e,t){this.options&&this.options.modelEvents?this.options.modelEvents.unsubscribe(t):f.unsubscribe(t)})),this._eventSubscriptionTokens=[]},updateFacet:function(t){var n=this;this.addLoader();var i=n.getModel();if(!i)return!1;this.elements.TopBar.container.inject(this.elements.container.closest(".IDCardInnerBottomArea").getElementsByClassName("actionArea")[0]);var o={physicalid:i.get("objectId")};t&&t.blnForceRefresh&&(o.blnForceRefresh=!0),r.getResourceParameterLists(o).then((function(t){if(t&&!e.Object.isEmptyObject(t)){var i=n.elements._uwaTree;i&&(n.elements._uwaTree.prepareUpdateView(),n.elements._uwaTree.getTreeDocument().removeRoots());var a=[];e.each(t,(function(e,t){var n=t.resourceParameterList,i={label:n.V_Name||n.name,dsModel:n,dsModelConnection:t||null,grid:{V_description:n.V_description||"",current:b.get(n.current)},children:[]};a.push(i)})),n.addRootNodesToTable(a).then((function(t){var a=[];e.each(t,(function(e,t){t.setState({state:"expanding"}),t.options&&t.options.dsModel&&t.options.dsModel.physicalid&&a.push({physicalid:t.options.dsModel.physicalid})}));o.blnForceRefresh,n._getVisibleCols("DELWebResourceParameterFacet",getChangeoverParametersParams);r.getResourceParametersForList(getChangeoverParametersParams).then((function(i){n.elements._uwaTree&&n.elements._uwaTree.prepareUpdateView(),e.each(t,(function(t,o){if(!o.options||!o.options.dsModel||!o.options.dsModel.physicalid)return delete o.options.children,void o.setState({state:"noChildren"});e.each(i,(function(t,a){t&&t===o.options.dsModel.physicalid&&(e.each(a,(function(t,i){i&&i.physicalid&&i.V_Name?n._addResourceParameterToResourceParameterList(o,i):e.log("invalid objResParam!")})),delete i[t])})),o.setState({state:o.hasChildren()?"expanded":"noChildren"})})),n.elements._uwaTree&&(n.hideShowColumn(),n.elements._uwaTree.reapplySortModel(),n.elements._uwaTree.pushUpdateView({updateCellContent:!0,updateCellLayout:!0},!0))}),(function(e){u.displayNotificationMessage(e)})),i&&n.elements._uwaTree&&(n.elements._uwaTree.reapplySortModel(),n.elements._uwaTree.pushUpdateView({updateCellContent:!0,updateCellLayout:!0},!0))}),(function(e){u.displayNotificationMessage(e)}))}else n.elements._uwaTree&&(n.elements._uwaTree.destroy(),delete n.elements._uwaTree),n.elements.content.innerHTML="",n.elements.content.appendText(b.get("No Associated {0}",{0:b.get("Resource Parameter Lists")})).addContent('<div class="create_helper" draggable="false"><i class="create_helper_img wux-ui-3ds wux-ui-3ds-4x wux-ui-3ds-plus"></i><h5 class="create_helper_txt">'+b.get("Click New to Create a {0}",{0:b.get("Resource Parameter List")})+"</h5></div>");n.removeLoader()}))},getTree:function(e,t,n){n||(n=window.alert),require({baseUrl:window.Configuration.webappsDir},["DS/DELWebInfrastructureControls/DELWebAjaxModel"],(function(i){i.getTree(e).then(t,n)}))},getClassNames:function(e){return"content_section-resource_parameter"+(e||"")},show:function(){return this.elements.TopBar.actionbar.show(),this._parent.apply(this,arguments)},hide:function(){return this.elements.TopBar.actionbar.hide(),this._parent.apply(this,arguments)},addLoader:function(){a.mask(this.elements.container)},removeLoader:function(){a.unmask(this.elements.container)},onAction:function(t){e.log("onAction = "+t);var n=[];switch(this.elements._uwaTree&&this.elements._uwaTree.getNodesXSO&&(n=this.elements._uwaTree.getNodesXSO().get()),t){case"add":this.onCreateParameterList(n);break;case"remove":this.onRemove(n);break;case"edit":this.onEdit(n);break;case"refresh":this.updateFacet({blnForceRefresh:!0});break;case"openWith":this.onOpenWithClick(n);break;default:u.displayNotificationMessage("unknown actionId = "+t)}},onCreateParameterList:function(t){if(this._dlg&&this._dlg.destroy)try{this._dlg.destroy()}catch(t){e.log("DELWebResourceParameterFacet::onCreateParameterList - _dlg.destroy = "+t.stack)}if(!t||t.length<=0){var n=this.getModel();this._dlg=new l(Object.assign({resource:{physicalid:n.get("objectId")}},this.options))}else if(1===t.length&&t[0].isRoot()){var i=t[0].options.dsModel;this._dlg=new d(Object.assign({parentModel:i},this.options))}else{var o=!1,a=null;e.each(t,(function(e,t){if(o=!t.isRoot()){var n=t.getParent();a?o=a===n:a=n}return o}))}},onOpenWithClick:function(e){var t=this;if(e&&1===e.length){var n=e[0].options.dsModel;n&&require(["DS/Menu/Menu","DS/i3DXCompassPlatformServices/OpenWith","DS/TransientWidget/TransientWidget"],(function(e,i,o){var a={protocol:"3DXContent",version:"2.0",source:window.widget.data&&window.widget.data.appId?window.widget.data.appId:"DELFAMC_AP",widgetId:window.widget.id,data:{items:[{envId:window.widget.data&&window.widget.data.x3dPlatformId?window.widget.data.x3dPlatformId:"OnPremise",serviceId:"3DSpace",contextId:window.widget.data.pad_security_ctx,objectId:n.physicalid,objectType:n.plmObjectTypeInternal,displayName:n.V_Name,displayType:"Loading Resource Parameter"}]}},r=[];t.openWith=new i,t.openWith.set3DXContent(a),t.openWith.retrieveCompatibleApps((function(){!window||window.Foe&&window.Foe.Model&&window.Foe.Model.Session&&window.Foe.Model.Session.checkApplicationFeature&&window.Foe.Model.Session.checkApplicationFeature("IR-1308617","0")||s.getServiceUrl({serviceName:"3DSpace"}).then((function(i){var a={type:"PushItem",title:"Collaborative Lifecycle",name:"ENOLCMI_AP",action:{callback:function(){return e={mode:"panel",height:window.top.document.body.clientHeight||800,width:window.top.document.body.clientWidth||650},void o.showWidget("ENOLCMI_AP","Collaborative Lifecycle",{X3DContentId:JSON.stringify({protocol:"3DXContent",version:"2.0",source:window.widget.data&&window.widget.data.appId?window.widget.data.appId:"DELFAMC_AP",widgetId:window.widget.id,data:{items:[{serviceId:"3DSpace",objectId:n.physicalid,objectType:n.type,displayName:n.name||n.V_Name,envId:window.widget.data&&window.widget.data.x3dPlatformId?window.widget.data.x3dPlatformId:"OnPremise"}]}})},e);var e}},icon:{iconPath:i+"/widget/images/MyApps/ENOLCMI_AP_AppIcon.svg"}};r.push(a);var s=t.elements.container.closest(".IDCardInnerBottomArea").querySelector(".wux-ui-3ds-open-in-a-new-window").getBoundingClientRect(),l={position:{x:s.left+20,y:s.top+35}};e.show(r,l)}))}))}))}},onEdit:function(t){if(this._dlg&&this._dlg.destroy)try{this._dlg.destroy()}catch(t){e.log("DELWebResourceParameterFacet::onEdit - _dlg.destroy = "+t.stack)}if(t&&1===t.length)if(t[0].isRoot()){var n=this.getModel();this._dlg=new l(Object.assign({resource:{physicalid:n.get("objectId")},resourceParameterList:t[0].options.dsModel},this.options))}else this._dlg=new d(Object.assign({resourceParameterPhysicalid:t[0].options.dsModel.physicalid},this.options))},onRemove:function(n){var i=this;if(this._dlg&&this._dlg.destroy)try{this._dlg.destroy()}catch(t){e.log("DELWebResourceParameterFacet::onRemove - _dlg.destroy = "+t.stack)}var o=this.getModel(),a=b.get("Do you want to unassociate the {0} {1} from {2} {3}?"),s=[],l=[],d=null;if(1===n.length?n[0].isRoot()?(s=n,a=a.replace("{0}",b.get("Resource Parameter List")).replace("{1}",e.String.escapeHTML(n[0].options.dsModel.V_Name))):(l=n,d=n[0].getParent(),a=b.get("Do you want to delete the {0} {1} from {2} {3}?").replace("{0}",b.get("Resource Parameter")).replace("{1}",e.String.escapeHTML(n[0].options.dsModel.V_Name))):e.each(n,(function(e,t){t.isRoot()?s.push(t):(null===d?d=t.getParent():d&&d!==t.getParent()&&(d=!1),l.push(t))})),s.length&&!l.length){if(!this.options||!this.options.resource||!this.options.resource.V_Name){this.options||(this.options={});var c={physicalid:o.get("objectId"),Minimum:["V_Name"]};return void r.getOneResource(c).then((function(t){t&&Array.isArray(t)&&t.length&&(t=t[0]),t&&t.V_Name?(i.options.resource=Object.assign(i.options.resource||{physicalid:o.get("objectId")},t),i.onRemove(n)):e.log("DELWebResourceParameterFacet::onRemove - invalid resource reference!")}),(function(e){u.displayNotificationMessage(e)}))}a=a.replace("{0}",s.length).replace("{1}",b.get("Resource Parameter Lists")).replace("{2}",b.get("Resource")).replace("{3}",e.String.escapeHTML(this.options.resource.V_Name))}else a=!s.length&&l.length?d?n.length>1?b.get("Do you want to delete the selected {0} from their parent {1} {2}?",{0:b.get("Resource Parameters"),1:b.get("Resource Parameter List"),2:e.String.escapeHTML(d.getLabel())}):a.replace("{2}",b.get("Resource Parameter List")).replace("{3}",d.getLabel()):b.get("Do you want to delete the selected {0} from their parent {1}?",{0:b.get("Resource Parameters"),1:b.get("Resource Parameter Lists")}):b.get("Do you want to unassociate the selected objects?");var p={resizableFlag:!0,modalFlag:!0,title:b.get("Unassociate {0}",{0:b.get("Resource Parameter List")}),immersiveFrame:this.getImmersiveFrame(),content:'<img class="icon-main"></img>'+a,buttons:{Cancel:new h({onClick:function(){i._dlg.destroy(),i._dlg=null}}),Save:new h({label:b.get("Unassociate"),disabled:!1,onClick:function(){var n=this;n.disabled=!0;var a=[],d=null,c={};s.length&&(c={resource:{physicalid:o.get("objectId")},resourceParameterListQueryList:[]},e.each(s,(function(t,n){if(n&&n.options&&n.options.dsModel){var i={};n.options.dsModel.physicalid?i.physicalid=n.options.dsModel.physicalid:n.options.dsModel.OXID&&(i.OXID=n.options.dsModel.OXID),e.Object.isEmptyObject(i)||c.resourceParameterListQueryList.push(i)}})),d=r.unassociateResourceParameterList(c),a.push(d)),l.length&&(c={resourceParameterListphysicalid:null,resourceParameterQueryList:[]},e.each(l,(function(t,n){var i=n.getParent();if(c&&(c.resourceParameterListphysicalid=i.dsModel.physicalid),n&&n.options&&n.options.dsModel){var o={};n.options.dsModel.physicalid?o.physicalid=n.options.dsModel.physicalid:n.options.dsModel.OXID&&(o.OXID=n.options.dsModel.OXID),e.Object.isEmptyObject(o)||c.resourceParameterQueryList.push(o)}})),d=r.unassociateResourceParameterFromList(c),a.push(d)),t.all(a).then((function(){u.displayNotificationMessage(b.get("Unassociation Successful"),{level:"success"}),i._dlg.destroy(),i._dlg=null}),(function(e){u.displayNotificationMessage(e),n.disabled=!1}))}})}};!s.length&&l.length&&(p.title=b.get("Delete {0}",{0:b.get("Resource Parameter")}),p.buttons.Save.label=b.get("Delete")),i._dlg=new g(p);var m=window.Configuration.webappsDir+"/DELWebAssetMgmt/assets/I_StandardWarning.png";i._dlg.elements.container.querySelector(".icon-main").setAttribute("src",m),i._dlg.elements.container.querySelector(".icon-main").style.height="32px",i._dlg.elements.container.querySelector(".icon-main").style.width="auto"},onNodeSelectChange:function(){var t=this,n=[];this.elements._uwaTree&&this.elements._uwaTree.getNodesXSO&&(n=this.elements._uwaTree.getNodesXSO().get());var i=t.elements.TopBar.actionbar._buttons.add;i&&i.element&&(i.element.disabled=!this.isAddHeaderEnabled(n)),n.length<=1?(e.each(["remove","edit","openWith"],(function(e,o){(i=t.elements.TopBar.actionbar._buttons[o])&&i.element&&(i.element.disabled=n.length<=0)})),n&&n.length>0&&!n[0].isRoot()&&e.each(["add"],(function(e,n){(i=t.elements.TopBar.actionbar._buttons[n]).element.disabled=!0}))):e.each(["edit","add"],(function(e,n){(i=t.elements.TopBar.actionbar._buttons[n]).element.disabled=!0}))},isAddHeaderEnabled:function(t){!t&&this.elements._uwaTree&&this.elements._uwaTree.getNodesXSO&&(t=this.elements._uwaTree.getNodesXSO().get());var n=!t||t.length<=0||1===t.length&&t[0].isRoot();if(!n&&t.length>0){var i=!1,o=null;e.each(t,(function(e,t){if(i=!t.isRoot()){var n=t.getParent();o?i=o===n:o=n}return i})),n=i&&o}return n},_initTopBar:function(){var t=this,n=[{name:"edit",icon:o.ACTION_SWITCH,disabled:!0,text:b.get("Edit"),handler:function(){t.onAction(this.name)}},{name:"remove",icon:"trash",disabled:!0,text:b.get("Remove"),handler:function(){t.onAction(this.name)}},{name:"add",icon:"plus",text:b.get("Add"),handler:function(){t.onAction(this.name)}},{name:"refresh",icon:"refresh",text:b.get("Refresh"),handler:function(){t.onAction(this.name)}}];!window||window.widget.standalone||window.Foe&&window.Foe.Model&&window.Foe.Model.Session&&window.Foe.Model.Session.checkApplicationFeature&&window.Foe.Model.Session.checkApplicationFeature("IR-1308617","0")||n.unshift({name:"openWith",icon:"open-in-a-new-window",disabled:!0,text:b.get("Open With"),handler:function(){t.onAction(this.name)}}),this.elements.TopBar={},this.elements.TopBar.container=e.createElement("div",{class:this.getClassNames("-topbar"),styles:{height:"100%"}}).inject(this.elements.content),this.elements.TopBar.actionbar=new i({}).inject(this.elements.TopBar.container),this.elements.TopBar.actionbar.setButtons(n),this.elements.TopBar.container.dsModel=this.elements.TopBar.actionbar,this.onNodeSelectChange()},addTable:function(){var e=this;return new t((function(t,n){if(e.elements&&e.elements.container&&e.elements.content){if(!e.elements._uwaTree){var i={identifier:"DELWebResourceParameterFacet",cellSelection:"none",enableListSelection:!0,canMultiSelect:!0,isEditable:!1,cellDragEnabledFlag:!0,onDragStartCell:function(t,n){return e.onDragStartCell(t,n)},onDragOverCell:function(t,n){return e.onDragOverCell(t,n)},onDragEndCell:function(e){s.publishEvent("Dragging.stop",{ev:e})},onDropCell:function(t,n){return e.onDropCell(t,n)},columns:[{text:b.get("Title"),dataIndex:"tree",modelAttribute:"V_Name",getCellTooltip:function(t){if(t.rowID<0||!t.nodeModel||!t.nodeModel.options||!t.nodeModel.options.dsModel||!t.nodeModel.options.dsModel.plmObjectType)return e.elements._uwaTree?e.elements._uwaTree.getCellDefaultTooltip(t):{shortHelp:"",updateModel:!1};var n="",i=t.nodeModel.options.dsModel.plmObjectType||t.nodeModel.options.dsModel.plmObjectTypeInternal||t.nodeModel.options.dsModel.V_discipline;if("DELResourcePrmINPUT"===i)n="("+b.get("Input")+") ";else if("DELResourcePrmOUTPUT"===i)n="("+b.get("Output")+") ";else if(e.elements._uwaTree)return e.elements._uwaTree.getCellDefaultTooltip(t);return{shortHelp:n+=t.nodeModel.getLabel(),updateModel:!1}}},{text:b.get("Description"),dataIndex:"V_description",typeRepresentation:"textBlock",autoRowHeightFlag:!0,visibleFlag:!1},{allowUnsafeHTMLContent:!0,text:b.get("Dimension"),dataIndex:"parameter_type",visibleFlag:!1},{text:b.get("Values"),dataIndex:"V_Values",visibleFlag:!1},{text:b.get("Maturity"),dataIndex:"current",visibleFlag:!0},{text:b.get("Minimum"),dataIndex:"V_MinValue",allowUnsafeHTMLContent:!0,visibleFlag:!1,getCellTooltip:function(t){if(t.rowID<0||!t.nodeModel||!t.nodeModel.options||!t.nodeModel.options.dsModel||!t.nodeModel.options.dsModel.minLimit||"NotSet"===t.nodeModel.options.dsModel.minLimit)return e.elements._uwaTree?e.elements._uwaTree.getCellDefaultTooltip(t):{shortHelp:b.get("Minimum"),updateModel:!1};var n=t.nodeModel.options.dsModel.minValue||t.nodeModel.options.dsModel.V_MinValue||0;return{shortHelp:"Excluded"===t.nodeModel.options.dsModel.minLimit?b.get("Greater than (Exclusive) {0}",{0:n}):b.get("Greater than or equal to (Inclusive) {0}",{0:n}),updateModel:!1}}},{text:b.get("Maximum"),dataIndex:"V_MaxValue",allowUnsafeHTMLContent:!0,visibleFlag:!1,getCellTooltip:function(t){if(t.rowID<0||!t.nodeModel||!t.nodeModel.options||!t.nodeModel.options.dsModel||!t.nodeModel.options.dsModel.maxLimit||"NotSet"===t.nodeModel.options.dsModel.maxLimit)return e.elements._uwaTree?e.elements._uwaTree.getCellDefaultTooltip(t):{shortHelp:b.get("Maximum"),updateModel:!1};var n=t.nodeModel.options.dsModel.maxValue||t.nodeModel.options.dsModel.V_MaxValue||0;return{shortHelp:"Excluded"===t.nodeModel.options.dsModel.maxLimit?b.get("Less than (Exclusive) {0}",{0:n}):b.get("Less than or equal to (Inclusive) {0}",{0:n}),updateModel:!1}}}],roots:[]};i.treeDocument=new p,e.elements.content.innerHTML="",e.elements._uwaTree=new c(i).inject(e.elements.content),e.elements._uwaTree.getNodesXSO().onChange((function(){e.onNodeSelectChange.apply(e,arguments)})),e.elements._uwaTree.getContainingImmersiveFrame&&!e.elements._uwaTree._getContainingImmersiveFrame&&(e.elements._uwaTree._getContainingImmersiveFrame=e.elements._uwaTree.getContainingImmersiveFrame,e.elements._uwaTree.getContainingImmersiveFrame=function(){var e=this._getContainingImmersiveFrame();if(!e){var t=null,n=window.document.getElementsByClassName("wux-windows-immersive-frame");if(n&&n.length)for(var i=0;!t&&i<n.length;++i)n[i]&&n[i].dsModel&&(t=n[i].dsModel);t&&t.getImmersiveFrame&&(e=t.getImmersiveFrame())}return e}),e._onContextualEvent&&(require({baseUrl:window.Configuration.webappsDir},["DS/DELWebAssetMgmt/controllers/resource/DataGridViewResourceContextualMenuBuilder"],(function(t){e.elements._uwaTree._contextualMenuBuilder=new t(e.elements._uwaTree)})),e.elements._uwaTree.onContextualEvent=e._onContextualEvent),e.onResize()}t(e.elements._uwaTree)}else n(new Error("invalid container"))}))},addRootNodesToTable:function(n,i){var o=this;return new t((function(t,a){if(!n||!Array.isArray(n)||n.length<=0)return a(new Error("invalid rootNodeOptionsArr")),!1;o.addTable().then((function(s){if(!s)return a(new Error("invalid table")),!1;i&&s.getTreeDocument()&&(s.placeholder="",s.getTreeDocument().removeRoots());var r=s.getTreeDocument(),l=r.getRoots(),d=[],u=window.widget.getUrl()||"";u&&(u=(u=u.substr(0,u.lastIndexOf("/"))).substr(0,u.lastIndexOf("/"))),o.elements._uwaTree.prepareUpdateView(),e.each(n,(function(t,n){if(l){var i=!0;if(e.each(l,(function(e,t){return t&&t.options&&t.options.dsModel&&n.dsModel&&(i=t.options.dsModel.physicalid!==n.dsModel.physicalid),i})),!i)return}n.icons||(n.icons=[u+"/DELWebInfrastructureControls/assets/icons/I_PPRRscPrmList.png"]);var o=new m(n);o.dsModel=n.dsModel,r.addRoot(o),d.push(o)})),o.hideShowColumn(),o.elements._uwaTree.pushUpdateView({updateCellContent:!0,updateCellLayout:!0},!0),t(d)}),a)}))},getTreeNodeFromDsModel:function(t,n,i){if(!t)return e.log("DELWebResourceParameterFacet::getTreeNodeFromDsModel - invalid dsModel!"),null;if(n||(n=this.elements._uwaTree),!n)return e.log("DELWebResourceParameterFacet::getTreeNodeFromDsModel - invalid uwaTree!"),null;i&&e.Function.isFunction(i)||(i=function(e,t){return!(!e||!t)&&(!(!e.physicalid||!t.physicalid||e.physicalid!==t.physicalid)||!(!e.OXID||!t.OXID||e.OXID!==t.OXID))});var o=n.getTreeDocument();if(!o||!o.getAllDescendants)return e.log("DELWebResourceParameterFacet::getTreeNodeFromDsModel - invalid dataGridDocument!"),null;var a=null,s=o.getAllDescendants();return e.each(s,(function(e,n){if(n&&n.options&&n.options.dsModel){var o=i(n.options.dsModel,t);!o&&n.options.dsModelConnection&&n.options.dsModelConnection.properties&&(o=i(n.options.dsModelConnection.properties,t)),o&&(a=n)}return!a})),a},getImmersiveFrame:function(){if(!this.immersiveFrame){var e=window.document.getElementsByClassName("wux-windows-immersive-frame");if(e&&e.length)for(var t=0;!this.immersiveFrame&&t<e.length;++t)e[t]&&e[t].dsModel&&(this.immersiveFrame=e[t].dsModel)}return this.immersiveFrame},onDragStartCell:function(t,n){var i=!1;if(n&&n.nodeModel&&n.nodeModel.options&&n.nodeModel.options.dsModel){t.dndInfos||(t.dndInfos=n);var o={protocol:"3DXContent",source:window.widget.data&&window.widget.data.appId?window.widget.data.appId:"DELFAMC_AP",version:"2.0",widgetId:window.widget.id,data:{items:[]}},a=window.widget.getValue("pad_security_ctx")||window.widget.getValue("collabSpace");if(a&&0!==a.indexOf("ctx::"))a="ctx::"+a;else for(;a&&e.String.contains(a,"ctx::ctx::");)a=a.replace("ctx::ctx::","ctx::");var r=this.elements._uwaTree.getNodesXSO().get();if(r.length>0){var l=n.nodeModel.options.dsModel.plmBaseObjectType;l||(l=n.nodeModel.isRoot()?"DELResourceParameterListReference":"DELResourcePrm");var d="Resource Parameter";"DELResourceParameterListReference"===l&&(d="Resource Parameter List"),o.data.items.push({envId:window.widget.data.x3dPlatformId||"OnPremise",serviceId:"3DSpace",contextId:a,objectId:n.nodeModel.options.dsModel.physicalid,objectType:l,displayName:n.nodeModel.options.dsModel.V_Name,displayType:d}),e.each(r,(function(e,t){t&&t.options&&t.options.dsModel&&n.nodeModel.options.dsModel.physicalid!==t.options.dsModel.physicalid&&((l=t.options.dsModel.plmBaseObjectType)||(l=t.isRoot()?"DELResourceParameterListReference":"DELResourcePrm"),d="Resource Parameter","DELResourceParameterListReference"===l&&(d="Resource Parameter List"),o.data.items.push({envId:window.widget.data.x3dPlatformId||"OnPremise",serviceId:"3DSpace",contextId:a,objectId:t.options.dsModel.physicalid,objectType:l,displayName:t.options.dsModel.V_Name,displayType:d}))}))}t.dataTransfer.setData("Text",window.UWA.Json.encode(o)),t.dataTransfer.setData("text/searchitems",window.UWA.Json.encode(o)),i=o.data.items.length>0}return i&&n.nodeModel.isRoot()&&s.publishEvent("Dragging.start",{ev:t}),i},_onColumnVisibleStateChange:function(t){var n=this;if(t&&t.options&&t.options.columnID&&t.options.visibleState){var i=t.dsModel||n.elements._uwaTree;if(i){var o=i.getColumnOrGroup(t.options.columnID),a=[];if(o&&o.dataIndex&&a.push(o.modelAttribute||o.dataIndex),a&&a.length){var s=i.getTreeDocument().getAllDescendants()||[],r=[],l={};i.prepareUpdateView(),e.each(s,(function(t,n){if(n&&n.options&&n.options.dsModel){var o=!1;e.each(a,(function(e,t){if(!(t in n.options.grid)){if(o=!0,!l[t]){var a=i.getColumnOrGroup(t);a&&!a.allowUnsafeHTMLContent&&(l[t]=a,l[t].allowUnsafeHTMLContent=!0)}n.options.grid[t]='<img src="'+window.Configuration.webappsDir+'/DELWebAssetMgmt/assets/loading-small.gif" class="loading" title="'+b.get("Loading...")+'" />'}})),o&&r.push(n.options.dsModel)}})),i.pushUpdateView({updateCellContent:!0},!0);n.getModel()}}else window.steal.dev.log(n.constructor.fullName+"::_onColumnVisibleStateChange - invalid uwaTree")}},onDragOverCell:function(t,n){var i=!1,o=null;n&&n.nodeModel&&n.nodeModel.options&&n.nodeModel.options.dsModel&&(o=n.nodeModel.isRoot()?n.nodeModel.options.dsModel.physicalid:n.nodeModel.getParent().options.dsModel.physicalid);var a=n&&(n.draggedNodes||n.droppedNodes);return a&&Array.isArray(a)&&n.nodeModel&&a.indexOf(n.nodeModel)<0&&e.each(a,(function(e,t){return t&&t.options&&t.options.dsModel&&t.options.dsModel.plmBaseObjectType?(i=["DELResourcePrm","DELResourceParameter","DELResourcePrmAbstract","DELResourcePrmINPUT","DELResourcePrmOUTPUT"].indexOf(t.options.dsModel.plmBaseObjectType)>=0)&&(i=t.isRoot()?o!==t.options.dsModel.physicalid:o!==t.getParent().options.dsModel.physicalid):i=!1,i})),i&&t.preventDefault(),i},onDropCell:function(e,t){var n=this.onDragOverCell(e,t);if(n){var i=null;t&&t.nodeModel&&t.nodeModel.options&&t.nodeModel.options.dsModel&&(i=t.nodeModel.isRoot()?t.nodeModel.options.dsModel.physicalid:t.nodeModel.getParent().options.dsModel.physicalid),i&&this.displayCopyMoveResourceParameterDialog(e,t)}return n},hideShowColumn:function(t){var n=this;if(n.elements._uwaTree&&n.elements._uwaTree.columns){if(!t)return n._hideShowColumnAnimationFrame&&window.cancelAnimationFrame(n._hideShowColumnAnimationFrame),void(n._hideShowColumnAnimationFrame=window.requestAnimationFrame((function(){delete n._hideShowColumnAnimationFrame,n.elements._uwaTree.prepareUpdateView(),e.each(n.elements._uwaTree.columns,(function(e,t){!t||!t.dataIndex||["tree","V_description","current"].indexOf(t.dataIndex)>=0||n.hideShowColumn(t.dataIndex)})),n.elements._uwaTree.pushUpdateView({updateCellLayout:!0},!0)})));var i=n.elements._uwaTree.getTreeDocument().getAllDescendants();if(i&&!(i.length<=0)){var o=!0;e.each(i,(function(e,n){return n&&n.isVisible()&&n.options&&n.options.grid&&n.options.grid[t]&&["tree","V_description","parameter_type","V_Values","V_MinValue","V_MaxValue","current"].indexOf(t)>=0&&(o=!1),o}));var a=n._getVisibleCols("DELWebResourceParameterFacet",null),s=n.elements._uwaTree.getColumnOrGroup(t);if(s&&(!("visibleFlag"in s)||s.visibleFlag===o&&["tree","V_description","parameter_type","V_Values","V_MinValue","V_MaxValue","current"].indexOf(t)>=0))n.elements._uwaTree.prepareUpdateView(),s.visibleFlag=Array.isArray(a)&&a.length>0?!!a.includes(t):!o,n.elements._uwaTree.invalidateLayout(),n.elements._uwaTree.pushUpdateView({updateCellLayout:!0},!0);else if(["tree","V_description","parameter_type","V_Values","V_MinValue","V_MaxValue","current"].indexOf(t)<0&&"visibleFlag"in s){if(n.elements._uwaTree.prepareUpdateView(),a&&a.includes(t))s.visibleFlag=Array.isArray(a)&&a.length>0?!!a.includes(t):!o;else{var r=window.localStorage.getItem("wux-collectionView-dataGridView");r&&((r=JSON.parse(r))&&r.DELWebResourceParameterFacet&&r.DELWebResourceParameterFacet.columnsVisibleFlag?s.visibleFlag=t in r.DELWebResourceParameterFacet.columnsVisibleFlag?r.DELWebResourceParameterFacet.columnsVisibleFlag[t]:!o:s.visibleFlag=!o)}n.elements._uwaTree.invalidateLayout(),n.elements._uwaTree.pushUpdateView({updateCellLayout:!0},!0)}s.visibleFlag&&n.elements._uwaTree.sizeColumnToFit(t,{computeColumnHeader:!0})}}},displayCopyMoveResourceParameterDialog:function(n,i){var o=this;if(this._dlg&&this._dlg.destroy)try{this._dlg.destroy()}catch(t){e.log("DELWebResourceParameterFacet::displayCopyMoveResourceParameterDialog - _dlg.destroy = "+t.stack)}var a=i&&(i.draggedNodes||i.droppedNodes);if(!a||!Array.isArray(a)||!a.length)return e.log("displayCopyMoveResourceParameterDialog - invalid draggedNodes!"),!1;var s=null;if(i&&i.nodeModel&&i.nodeModel.options&&i.nodeModel.options.dsModel&&(s=i.nodeModel.isRoot()?i.nodeModel.options.dsModel.physicalid:i.nodeModel.getParent().options.dsModel.physicalid),!s)return e.log("displayCopyMoveResourceParameterDialog - invalid drop target!"),!1;var l='<span class="icon-main"><img></img></span>'+b.get("Would you like to Copy or Move these items?")+'\n<table style="margin:1em auto;text-align:left;line-height:1.2em;"><tr><td style="padding-right:.5em;font-weight:bold;">'+b.get("Copy")+":</td><td>"+b.get("Create a new {0} under the target and leave the old one unmodified.",{0:b.get("Resource Parameter")})+'</td></tr><tr><td style="padding-right:.5em;font-weight:bold;">'+b.get("Move")+":</td><td>"+b.get("Create a new {0} under the target and delete the old one.",{0:b.get("Resource Parameter")})+"</td></tr></table>",d={resizableFlag:!0,modalFlag:!0,title:b.get("Copy or Move Confirmation"),immersiveFrame:this.getImmersiveFrame(),content:l,buttons:{Cancel:new h({onClick:function(){o._dlg.destroy(),o._dlg=null}}),Save:new h({label:b.get("Move"),onClick:function(t){o._dlg.buttons.Save.disabled=!0,o._dlg.buttons.Ok.disabled=!0,this&&this.tagName&&(o._dlg.buttons.Save.icon=window.widget.getUrl().substr(0,window.widget.getUrl().lastIndexOf("/"))+"/../DELWebInfrastructure/DSCommon/graphics/loading-small.gif"),o._dlg.buttons.Ok.onClick(t,(function(){var t=[];e.each(a,(function(e,n){n.options.dsModel.rplPhysicalid!==s&&t.push({physicalid:n.options.dsModel.physicalid})}));var n=function(){u.displayNotificationMessage(b.get("Move Successful"),{level:"success"}),o._dlg.destroy(),o._dlg=null};if(t.length>0){var i={resourceParameterQueryList:t};r.unassociateResourceParameterFromList(i).then(n,(function(e){u.displayNotificationMessage(e),o._dlg.buttons.Save.disabled=!1,o._dlg.buttons.Ok.disabled=!1,o._dlg.buttons.Save.icon=""}))}else n()}))}}),Ok:new h({label:b.get("Copy"),onClick:function(n,i,l){o._dlg.buttons.Ok.disabled=!0,o._dlg.buttons.Save.disabled=!0,this&&this.tagName&&(o._dlg.buttons.Ok.icon=window.widget.getUrl().substr(0,window.widget.getUrl().lastIndexOf("/"))+"/../DELWebInfrastructure/DSCommon/graphics/loading-small.gif");var d=[];e.each(a,(function(t,n){var i=e.clone(n.options.dsModel);delete i.physicalid,delete i.rplPhysicalid,i.target_physicalid=s,d.push(r.createResourceParameter(i))})),i||(i=function(){u.displayNotificationMessage(b.get("Copy Successful"),{level:"success"}),o._dlg.destroy(),o._dlg=null}),l||(l=function(e){u.displayNotificationMessage(e),o._dlg.buttons.Ok.disabled=!1,o._dlg.buttons.Save.disabled=!1,o._dlg.buttons.Ok.icon=""}),t.all(d).then(i,l)}})}};o._dlg=new g(d);var c=window.Configuration.webappsDir+"/DELWebAssetMgmt/assets/I_StandardWarning.png";o._dlg.elements.container.querySelector(".icon-main>img").setAttribute("src",c),o._dlg.elements.container.querySelector(".icon-main>img").style.height="32px",o._dlg.elements.container.querySelector(".icon-main>img").style.width="auto",o._dlg.buttons.Save.emphasize="secondary"},_initEventHandlers:function(){var t=this;this._eventSubscriptionTokens||(this._eventSubscriptionTokens=[]),e.each(this,(function(n,i){if(i&&e.Function.isFunction(i)&&n.endsWith(" subscribe")){var o=n.replace(" subscribe","").trim(),a=null;(a=t.options&&t.options.modelEvents?t.options.modelEvents.subscribe({event:o},(function(e){i.apply(t,[o,e])})):f.subscribe({event:o},(function(e){i.apply(t,[o,e])})))&&t._eventSubscriptionTokens.push(a)}}))},_addResourceParameterToResourceParameterList:function(t,n){var i=this;if(t){if(t.options.dsModel){t.options.dsModel.children?t.options.dsModel.children&&e.Object.isPlainObject(t.options.dsModel.children)&&(t.options.dsModel.children=Object.values(t.options.dsModel.children)):t.options.dsModel.children=[];var o=t.getChildren(),a=null;if(o&&o.length)for(var l=0;l<o.length;++l){var d=o[l];d&&d.options&&d.options.dsModel}if(!a){var u="";if(n&&n.V_Values&&"string"==typeof n.V_Values){n.V_Values=JSON.parse(n.V_Values);var c;c=Object.keys(n.V_Values).length,e.each(n.V_Values,(function(e,t){t&&t.tree&&""!==t.tree?(u+=t.tree,e+1<c&&(u+=", ")):"number"==typeof t?(t=t.toString())&&""!==t&&(u+=t,e+1<c&&(u+=", ")):"string"==typeof t&&t&&""!==t&&(u+=t,e+1<c&&(u+=", "))})),n.V_Values=u}t.options.dsModel.children.push(e.clone(n)),i.elements._uwaTree.prepareUpdateView(),r.getMagnitudes().then((function(l){if(o=t.getChildren(),i._listOfMagnitudes=l,!n.parameter_type&&n.interfaces&&n.interfaces.length&&e.each(n.interfaces,(function(e,t){t.indexOf("DELRscPrmIOValueAbstract")>=0&&(n.parameter_type=t[0].replace("DELRscPrmIORangeValue_","").replace("DELRscPrmIO",""),n.magnitude=n.parameter_type)})),n.parameter_type){n.parameter_type;var d="DELResourcePrmINPUT"===n.plmBaseObjectType||"DELResourcePrmINPUT"===n.plmObjectTypeInternal?"move-to":"move-from";a={label:n.V_Name||n.name,dsModel:n,icons:[d],grid:{V_description:n.V_description||"",physicalid:n.physicalid,parameter_type:i._getParamTypeLabel(n),V_MinValue:i._getMinMaxLabelFromValue(n,!1),V_MaxValue:i._getMinMaxLabelFromValue(n,!0),V_Values:n.V_Values,current:b.get(n.current)}};var u={iconName:"attention",fontIconFamily:window.WUXManagedFontIcons.Font3DS};if(i._blnIsUnitsInDropdownListPair||"ARBITRARYUNIT"!==n.parameter_type||a.icons.unshift(u),(!o||o.length<=0)&&(t.setState({state:"expanded"}),t.options.children=[]),n){if(a&&a.dsModel&&a.grid&&(a.grid=Object.assign(a.grid,a.dsModel),a.grid.parameter_type=i._getParamTypeLabel(n),a.grid.V_MinValue=i._getMinMaxLabelFromValue(n,!1),a.grid.V_MaxValue=i._getMinMaxLabelFromValue(n,!0),n.extensions)){var c=n.plmObjectType||n.plmBaseObjectType||n.V_discipline,p=null;s.getExtensions({class_name:[c,"DELResourcePrmAbstract"],blnIncludeParent:!0,blnCustoOnly:!0,blnGetProperties:!0}).then((function(t){p=t,e.each(n.extensions,(function(t,n){e.each(n,(function(o,s){p[t]&&e.each(p[t],(function(t,l){l&&l.properties&&e.each(l.properties,(function(t,l){if(l.name===o){var d=[];if(e.each(i.elements._uwaTree.columns,(function(e,t){t&&t.dataIndex&&d&&d.indexOf(t.dataIndex)<0&&d.push(t.dataIndex)})),l&&"dimension"in l&&""!==l.dimension)r.getMagnitudes({filter:"dimensionName+eq+"+l.dimension,magnitude:l.dimension}).then((function(e){if("None"!==l.getUIAccess){i.elements._uwaTree.prepareUpdateView();var t=n[o+".displayValue"]||s;if(e&&e[l.dimension]&&e[l.dimension].Units&&(t=t+" "+(i._getAttributeValue(e[l.dimension].Units,"Name",l.preferred_unit||e[l.dimension].MKSUnit)||l.preferred_unit||e[l.dimension].MKSUnit)),d.indexOf(o)<0){var r={};r.dataIndex=o,r.text=l.nlsName||l.name,r.visibleFlag=i._getVisibleAttributeValue(i.elements._uwaTree.columns,"dataIndex",o)||!1,r.getCellTooltip=function(e){if(e.nodeModel){return{shortHelp:e.nodeModel.getAttributeValue(o),updateModel:!1}}},i.elements._uwaTree.addColumnOrGroup(r)}a.grid[l.name]=t,i.elements._uwaTree.pushUpdateView({updateCellContent:!0,updateCellLayout:!0},!0)}}));else if("None"!==l.getUIAccess){if(i.elements._uwaTree.prepareUpdateView(),d.indexOf(o)<0){var u={};u.dataIndex=o,u.text=l.nlsName||l.name,u.getCellTooltip=function(e){if(e.nodeModel){return{shortHelp:e.nodeModel.getAttributeValue(o),updateModel:!1}}};var c=!1,p=window.localStorage.getItem("wux-collectionView-dataGridView");p&&(p=JSON.parse(p))&&p.DELWebResourceParameterFacet&&p.DELWebResourceParameterFacet.columnsVisibleFlag&&(c=o in p.DELWebResourceParameterFacet.columnsVisibleFlag&&p.DELWebResourceParameterFacet.columnsVisibleFlag[o]),window.widget.getUrl().contains("IR-142085=1")&&l.isMultiline&&(u.autoRowHeightFlag=!0,u.typeRepresentation="textBlock"),u.visibleFlag=c||i._getVisibleAttributeValue(i.elements._uwaTree.columns,"dataIndex",o)||!1,i.elements._uwaTree.addColumnOrGroup(u)}l.range&&"Date"===l.range&&(l.multi_valuated?e.each(s,(function(e,t){s[e]=""!==t?w((new Date).setDSDate(t)).format("LLL"):""})):s=w((new Date).setDSDate(s)).format("LLL")),a.grid[l.name]=s,i.elements._uwaTree.pushUpdateView({updateCellContent:!0,updateCellLayout:!0},!0)}}}))}))}))}))}))}t.addChild(a),"expanded"===t.getState()&&i.hideShowColumn()}}i.elements._uwaTree.pushUpdateView({updateCellContent:!0},!0)}))}}}else window.steal.dev.log(i.constructor.fullName+":: - unable to locate the group in the tree!")},_getParamTypeLabel:function(t){var n=this;t&&t.interfaces&&t.interfaces.length>0&&n._isStringInArrayOfArrays("DELRscPrmIODoubleValue",t.interfaces)&&(t.parameter_type="ARBITRARYUNIT");var i=t.magnitude||t.parameter_type,o=i;if("Text"===i||"Integer"===i||"TextValue"===i||"IntegerValue"===i)o=i.replace("Value",""),o=b.get(o);else if(n._listOfMagnitudes&&n._listOfMagnitudes[i]){t.magnitude||(t.magnitude=i),o=n._listOfMagnitudes[i].NLS||i;var a=t.units;n._isUnitsInDropdownListPair(n._listOfMagnitudes[i].Units,a)?a&&n._listOfMagnitudes[i].Units&&e.each(n._listOfMagnitudes[i].Units,(function(e,i){return!i||i.Name!==a&&i.label!==a&&i.uri!==a||(a=i.symbol||i.NLSName||a,"ARBITRARYUNIT"===t.parameter_type&&(n._blnIsUnitsInDropdownListPair=!0),!1)})):"ARBITRARYUNIT"===t.parameter_type&&(n._blnIsUnitsInDropdownListPair=!1,a=b.get("Undefined Arbitrary Unit")),o+=" ("+a+")"}return o},_getAttributeValue:function(e,t,n){for(let i=0;i<e.length;i++)if(e[i][t]===n)return e[i].NLSName;return null},_getVisibleAttributeValue:function(e,t,n){for(let i=0;i<e.length;i++)if(e[i][t]===n)return e[i].visibleFlag;return null},_isStringInArrayOfArrays:function(e,t){for(var n=0;n<t.length;n++){var i=t[n];if(Array.isArray(i)&&i.includes(e))return!0}return!1},_isUnitsInDropdownListPair:function(e,t){for(var n=0,i=0;i<e.length;i++)e[i].uri!==t&&e[i].Name!==t||n++;return n>0},_getMinMaxLabelFromValue:function(t,n){var i="";if(!t)return i;var o=0,a="NOTSET";if(n?(o=t.maxValue||t.V_MaxValue||0,a=(t.maxLimit||"NotSet").toUpperCase()):(o=t.minValue||t.V_MinValue||0,a=(t.minLimit||"NotSet").toUpperCase()),"NOTSET"===a)return i;var s=t.magnitude||t.parameter_type,r=t.units,l=null;return this._listOfMagnitudes&&this._listOfMagnitudes[s]&&this._listOfMagnitudes[s].Units&&(l=this._isUnitsInDropdownListPair(this._listOfMagnitudes[s].Units,r)),l?r&&this._listOfMagnitudes&&this._listOfMagnitudes[s]&&this._listOfMagnitudes[s].Units&&(t.magnitude||(t.magnitude=s),e.each(this._listOfMagnitudes[s].Units,(function(e,t){return!t||t.Name!==r&&t.label!==r&&t.uri!==r||(r=t.NLSName||r,!1)}))):"ARBITRARYUNIT"===t.parameter_type&&(this._blnIsUnitsInDropdownListPair=!1,r=""),n?(i="EXCLUDED"===a?"<":"&le;",i+=" "+o,i+=" "+r):(i=o+" "+r+" ",i+="EXCLUDED"===a?"<":"&le;"),i},_getMaxLabelFromValue:function(t,n){var i="";if(!t)return i;if(!n)return i;var o,a;o=n.maxValue||t.maxValue||0,a=(n.maxLimit||t.maxLimit).toUpperCase();var s=t.magnitude||t.parameter_type,r=n.units||t.units,l=null;return this._listOfMagnitudes&&this._listOfMagnitudes[s]&&this._listOfMagnitudes[s].Units&&(l=this._isUnitsInDropdownListPair(this._listOfMagnitudes[s].Units,r)),l?r&&this._listOfMagnitudes&&this._listOfMagnitudes[s]&&this._listOfMagnitudes[s].Units&&(t.magnitude||(t.magnitude=s),e.each(this._listOfMagnitudes[s].Units,(function(e,t){return!t||t.Name!==r&&t.label!==r&&t.uri!==r||(r=t.NLSName||r,!1)}))):"ARBITRARYUNIT"===t.parameter_type&&(this._blnIsUnitsInDropdownListPair=!1,r=""),"NOTSET"===a?i:(i="EXCLUDED"===a?"<":"&le;",i+=" "+o,i+=" "+r)},_getVisibleCols:function(t){var n=[];if(!n||n.length<=0){n=[];var i=JSON.parse(window.localStorage.getItem("wux-collectionView-dataGridView"));i&&e.each(i,(function(e,i){e===t&&i.columnsVisibleFlag&&Object.keys(i.columnsVisibleFlag).length>0&&(n=Object.keys(i.columnsVisibleFlag))}))}return n},_getMinLabelFromValue:function(t,n){var i="";if(!t)return i;var o,a;o=n.minValue||t.minValue||0,a=(n.minLimit||t.minLimit).toUpperCase();var s=t.magnitude||t.parameter_type,r=n.units||t.units,l=null;return this._listOfMagnitudes&&this._listOfMagnitudes[s]&&this._listOfMagnitudes[s].Units&&(l=this._isUnitsInDropdownListPair(this._listOfMagnitudes[s].Units,r)),l?r&&this._listOfMagnitudes[s].Units&&e.each(this._listOfMagnitudes[s].Units,(function(e,t){return!t||t.Name!==r&&t.label!==r&&t.uri!==r||(r=t.NLSName||r,!1)})):"ARBITRARYUNIT"===t.parameter_type&&(this._blnIsUnitsInDropdownListPair=!1,r=""),"NOTSET"===a?i:(i=o+" "+r+" ",i+="EXCLUDED"===a?"<":"&le;")},_getUpdatedParamTypeLabel:function(t,n){var i=this,o=t.magnitude||t.parameter_type,a=o;if("Text"===o||"Integer"===o||"TextValue"===o||"IntegerValue"===o)a=o.replace("Value","");else if(i._listOfMagnitudes&&i._listOfMagnitudes[o]){t.magnitude||(t.magnitude=o),a=i._listOfMagnitudes[o].NLS||o;var s=n.units;s&&i._listOfMagnitudes[o].Units&&e.each(i._listOfMagnitudes[o].Units,(function(e,t){return!t||t.Name!==s&&t.label!==s&&t.uri!==s||(s=t.NLSName||s,!1)})),a+=" ("+s+")"}return a},"ResourceParameterList.updated subscribe":function(t,n){if(!n&&t&&"string"!=typeof t&&(n=t,t="ResourceParameterList.updated"),n&&n.physicalid&&n.ChangedAttributes&&e.Object.isPlainObject(n.ChangedAttributes)&&!e.Object.isEmptyObject(n.ChangedAttributes)){var i=this.getTreeNodeFromDsModel(n);i&&(this.elements._uwaTree.prepareUpdateView(),i.options.grid=Object.assign(i.options.grid,n.ChangedAttributes),i.options.dsModel=Object.assign(i.options.dsModel,n.ChangedAttributes),n.ChangedAttributes.V_Name&&i.setLabel(n.ChangedAttributes.V_Name),this.elements._uwaTree.pushUpdateView({updateCellContent:!0,updateCellLayout:!0},!0))}else e.log("DELWebResourceParameterFacet::ResourceParameterList.updated - invalid objData")},"ResourceParameterList.associated subscribe":function(t,n){var i=this;if(!n&&t&&"string"!=typeof t&&(n=t,t="ResourceParameterList.associated"),n&&n.resourceParameterList&&n.resource&&n.resource.physicalid){var o=i.getModel();if(!o||o.get("objectId")!==n.resource.physicalid)return!1;r.getOneResourceParameterList(Object.assign({Minimum:["V_Name","V_description","physicalid"]},n.resourceParameterList)).then((function(t){var o={label:t.V_Name||t.name,dsModel:t,dsModelConnection:n||null,grid:{V_description:t.V_description||"",current:b.get(t.current)}};i.addRootNodesToTable([o]).then((function(t){var n=[];e.each(t,(function(e,t){t.setState({state:"expanding"}),t.options&&t.options.dsModel&&t.options.dsModel.physicalid&&n.push({physicalid:t.options.dsModel.physicalid})}));var o={QueryList:n,blnForceRefresh:!1,Minimum:["current"]};r.getResourceParametersForList(o).then((function(n){i.elements._uwaTree&&i.elements._uwaTree.prepareUpdateView(),e.each(t,(function(t,o){if(!o.options||!o.options.dsModel||!o.options.dsModel.physicalid)return delete o.options.children,void o.setState({state:"noChildren"});e.each(n,(function(t,a){t&&t===o.options.dsModel.physicalid&&(e.each(a,(function(t,n){n&&n.physicalid&&n.V_Name?i._addResourceParameterToResourceParameterList(o,n):e.log("invalid objResParam!")})),delete n[t])})),o.setState({state:o.hasChildren()?"expanded":"noChildren"})})),i.elements._uwaTree&&(i.hideShowColumn(),i.elements._uwaTree.reapplySortModel(),i.elements._uwaTree.pushUpdateView({updateCellContent:!0,updateCellLayout:!0},!0))}),(function(e){u.displayNotificationMessage(e)}))}),(function(e){u.displayNotificationMessage(e)}))}),(function(e){u.displayNotificationMessage(e)}))}else e.log("DELWebResourceParameterFacet::ResourceParameterList.associated - invalid objConnection")},"ResourceParameterList.unassociated subscribe":function(t,n){var i=this;if(!n&&t&&"string"!=typeof t&&(n=t,t="ResourceParameterList.unassociated"),n&&(n.resourceParameterList||n.properties)&&n.resource&&n.resource.physicalid){var o=i.getModel();if(!o||o.get("objectId")!==n.resource.physicalid)return!1;var a=this.getTreeNodeFromDsModel(n.properties||n.resourceParameterList);a&&(i.elements._uwaTree.prepareUpdateView(),a.remove(),i.hideShowColumn(),i.elements._uwaTree.pushUpdateView({updateCellContent:!0,updateCellLayout:!0},!0)),i.onNodeSelectChange()}else e.log("DELWebResourceParameterFacet::ResourceParameterList.unassociated - invalid objConnection")},"ResourceParameter.updated subscribe":function(t,n){var i=this;if(!n&&t&&"string"!=typeof t&&(n=t,t="ResourceParameter.updated"),!n||!n.physicalid||!n.attributes&&!n.extensions||e.Object.isEmptyObject(n.attributes)&&e.Object.isEmptyObject(n.extensions)||!e.Object.isPlainObject(n.attributes))e.log("DELWebResourceParameterFacet::ResourceParameter.updated - invalid objData");else{var o=this.getTreeNodeFromDsModel(n);if(o){if(i.elements._uwaTree.prepareUpdateView(),n.attributes&&("minLimit"in n.attributes||"minValue"in n.attributes||n.attributes.units)&&(n.attributes.V_MinValue=i._getMinLabelFromValue(o.options.dsModel,n.attributes)),n.attributes&&("maxLimit"in n.attributes||"maxValue"in n.attributes||n.attributes.units)&&(n.attributes.V_MaxValue=i._getMaxLabelFromValue(o.options.dsModel,n.attributes)),n.attributes&&n.attributes.units&&(n.attributes.parameter_type=i._getUpdatedParamTypeLabel(o.options.dsModel,n.attributes)),o.options.grid=Object.assign(o.options.grid,n.attributes),o.options.dsModel=Object.assign(o.options.dsModel,n.attributes),n.extensions&&!e.Object.isEmptyObject(n.extensions)&&e.each(n.extensions,(function(e,t){o.options.dsModel.extensions&&o.options.dsModel.extensions[e]&&(o.options.dsModel.extensions[e]=t)})),n.extensionsToRemove&&Array.isArray(n.extensionsToRemove)&&n.extensionsToRemove.length&&e.each(n.extensionsToRemove,(function(t,n){o.options.dsModel.extensions&&o.options.dsModel.extensions[n]&&delete o.options.dsModel.extensions[n],o.options.dsModel.interfaces&&e.each(o.options.dsModel.interfaces,(function(e,t){return!(t&&Array.isArray(t)&&t.indexOf(n)>=0)||(o.options.dsModel.interfaces.splice(e,1),!1)}))})),n.attributes.V_Name&&o.setLabel(n.attributes.V_Name),i.hideShowColumn(),o.options.dsModel.extensions){var a=o.options.dsModel.plmObjectType||o.options.dsModel.plmBaseObjectType||o.options.dsModel.V_discipline,l=null;s.getExtensions({class_name:[a,"DELResourcePrmAbstract"],blnIncludeParent:!0,blnCustoOnly:!0,blnGetProperties:!0}).then((function(t){l=t,e.each(o.options.dsModel.extensions,(function(t,a){e.each(a,(function(a,s){l[t]&&e.each(l[t],(function(l,d){d&&d.properties&&e.each(d.properties,(function(l,d){if(d.name===a){var u=[];if(e.each(i.elements._uwaTree.columns,(function(e,t){t&&t.dataIndex&&u&&u.indexOf(t.dataIndex)<0&&u.push(t.dataIndex)})),d&&"dimension"in d&&""!==d.dimension)r.getMagnitudes({filter:"dimensionName+eq+"+d.dimension,magnitude:d.dimension}).then((function(e){if("None"!==d.getUIAccess){var s="";if(n.ChangedAttributes.extensions[t][a+".displayValue"]?s=n.ChangedAttributes.extensions[t][a+".displayValue"]:n.ChangedAttributes.extensions[t][a]&&(s=n.ChangedAttributes.extensions[t][a]),e&&e[d.dimension]&&e[d.dimension].Units&&(s=s+" "+(i._getAttributeValue(e[d.dimension].Units,"Name",d.preferred_unit||e[d.dimension].MKSUnit)||d.preferred_unit||e[d.dimension].MKSUnit)),i.elements._uwaTree.prepareUpdateView(),u.indexOf(a)<0){var r={};r.dataIndex=a,r.text=d.nlsName||d.name,window.widget.getUrl().contains("IR-142085=1")&&d.isMultiline&&(r.autoRowHeightFlag=!0,r.typeRepresentation="textBlock");var l=!1,c=window.localStorage.getItem("wux-collectionView-dataGridView");c&&(c=JSON.parse(c))&&c.DELWebResourceParameterFacet&&c.DELWebResourceParameterFacet.columnsVisibleFlag&&(l=a in c.DELWebResourceParameterFacet.columnsVisibleFlag&&c.DELWebResourceParameterFacet.columnsVisibleFlag[a]),r.visibleFlag=l||i._getVisibleAttributeValue(i.elements._uwaTree.columns,"dataIndex",a)||!1,i.elements._uwaTree.addColumnOrGroup(r)}o.options.grid[d.name]=d&&"Boolean"===d.range?(""+s).toUpperCase():s,i.elements._uwaTree.pushUpdateView({updateCellContent:!0,updateCellLayout:!0},!0)}}));else if("None"!==d.getUIAccess){if(i.elements._uwaTree.prepareUpdateView(),u.indexOf(a)<0){var c={};c.dataIndex=a,c.text=d.nlsName||d.name,c.visibleFlag=i._getVisibleAttributeValue(i.elements._uwaTree.columns,"dataIndex",a)||!1,c.getCellTooltip=function(e){if(e.nodeModel){return{shortHelp:e.nodeModel.getAttributeValue(a),updateModel:!1}}},i.elements._uwaTree.addColumnOrGroup(c)}d.range&&"Date"===d.range&&(d.multi_valuated?e.each(s,(function(e,t){s[e]=""!==t?w((new Date).setDSDate(t)).format("LLL"):""})):s=w((new Date).setDSDate(s)).format("LLL")),o.options.grid[d.name]=d&&"Boolean"===d.range?(""+s).toUpperCase():s,i.elements._uwaTree.pushUpdateView({updateCellContent:!0,updateCellLayout:!0},!0)}}}))}))}))}))}))}i.elements._uwaTree.pushUpdateView({updateCellContent:!0,updateCellLayout:!0},!0)}}},"ResourceParameter.associated subscribe":function(t,n){var i=this;if(!n&&t&&"string"!=typeof t&&(n=t,t="ResourceParameter.associated"),n&&n.properties&&n.resourceParameterList&&n.resourceParameterList.physicalid){if(i.elements._uwaTree&&n.properties&&n.resourceParameterList){var o=i.elements._uwaTree.getTreeDocument();if(!o)return;var a=o.getRoots(),s=null,r=null,l=[];l.push(n.properties);var d=[];d.push(n.resourceParameterList),e.each(l,(function(t,n){e.each(d,(function(e,t){if(a&&a.length)for(var o=0;!s&&o<a.length;++o)if((r=a[o])&&r.options&&r.options.dsModel&&t.physicalid===r.options.dsModel.physicalid){s=r,i._addResourceParameterToResourceParameterList(s,n);break}}))}))}}else e.log("DELWebResourceParameterFacet::ResourceParameter.associated - invalid objConnection")},"ResourceParameter.unassociated subscribe":function(t,n){var i=this;if(!n&&t&&"string"!=typeof t&&(n=t,t="ResourceParameter.unassociated"),n&&(n.resourceParameterList||n.properties)){var o=this.getTreeNodeFromDsModel(n.properties);o&&(i.elements._uwaTree.prepareUpdateView(),o.remove(),i.hideShowColumn(),i.elements._uwaTree.pushUpdateView({updateCellContent:!0,updateCellLayout:!0},!0)),i.onNodeSelectChange()}else e.log("DELWebResourceParameterFacet::ResourceParameter.unassociated - invalid objConnection")}});return _}));