window.define&&define("DS/DELWebInfrastructureControls/DELWebTweakerCombobox",["DS/DELWebInfrastructureControls/UWAUtils","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/Tweakers/TweakerEnum"],(function(e,s,t,o){"use strict";var i=o.inherit({}),n=o.prototype.VIEW_MODULES.combo.classObject;function r(){if(this&&this._view){var t=this._tweaker.possibleValues();e.Array.isArray(t)?this._view.elementsList=t.slice(0):t instanceof s?this._view.elementsTree=t:t instanceof Promise?t.then((function(t){this&&this._view&&(e.Array.isArray(t)?this._view.elementsList=t.slice(0):t instanceof s?this._view.elementsTree=t:e.log("DELWebTweakerCombobox::_loadEntries - unknown type of possibleValues response!","error"))})):e.log("DELWebTweakerCombobox::_loadEntries - unknown type of possibleValues response!","error")}}function l(){var t=this._tweaker;if(void 0!==t.possibleValues){if("DELWebTweakerCombobox"!==t.valueType){if("enumString"===t.valueType){if("object"===e.typeOf(t.possibleValues)){var o=[];for(var i in t.possibleValues)t.possibleValues.hasOwnProperty(i)&&o.push({value:t.possibleValues[i],label:i});return o}return"array"===e.typeOf(t.possibleValues)?t.possibleValues.map((function(e){return"string"==typeof e?e:{label:void 0===e.label?e.value:e.label,value:e.value,icon:e.icon,description:e.description}})):t.possibleValues}if("enumDyn"===t.valueType&&"function"==typeof t.possibleValues)return[];var n=[];if(t.possibleValues.constructor===Array)for(var r=0;r<t.possibleValues.length;r++);else for(var l in t.possibleValues)"enumValueToProperty"===t.valueType&&n.push({label:t.possibleValues[l],value:l});return n}if(t.possibleValues instanceof s)return t.possibleValues;if("function"==typeof t.possibleValues)return new s}return[]}return n&&!n._setPossibleValues_DEFAULT&&(n.prototype._setValue_DEFAULT=n.prototype.setValue,n.prototype.setValue=function(o){if(!(this._tweaker instanceof i))return this._setValue_DEFAULT(o);var n=this._tweaker,r=this._view;function l(){if(null!=o){var e=r.elementsList;if(e&&e.length||!r.elementsTree||!r.elementsTree.getAllDescendants||(e=r.elementsTree.getAllDescendants()),e&&0!==e.length&&""!==o&&void 0!==o){for(var s=o.toString(),i=0;i<e.length;i++)if(e[i].constructor&&("TreeNodeModel"===e[i].constructor.name||e[i]instanceof t)&&e[i].options&&e[i].getLabel){if("section"!==e[i].options.comboBoxSemantics){if(o===e[i].getLabel()){r.selectedIndex=i;break}if(e[i].options&&e[i].options.grid&&(o===e[i].options.grid.valueItem||s===e[i].options.grid.valueItem)){r.selectedIndex=i;break}}}else if(o===e[i]||o===e[i].value||s===e[i]||s===e[i].value){r.selectedIndex=i;break}}else r.selectedIndex=-1}}var a=!0;if("function"==typeof n.possibleValues&&!r._isPopupOpened()){this._lockValueUpdate=!0;var u=n.possibleValues();e.Array.isArray(u)?r.elementsList=u.slice(0):u instanceof s?r.elementsTree=u:u instanceof Promise?(a=!1,u.then((function(t){r&&(e.Array.isArray(t)?r.elementsList=t.slice(0):t instanceof s?r.elementsTree=t:e.log("DELWebTweakerCombobox::_loadEntries - unknown type of retElementsList response!","error"),l())}))):e.log("DELWebTweakerCombobox::_loadEntries - unknown type of possibleValues response!","error")}a&&l()},n.prototype._setPossibleValues_DEFAULT=n.prototype.setPossibleValues,n.prototype.setPossibleValues=function(t){if(!(this._tweaker instanceof i))return this._setPossibleValues_DEFAULT(t);if(this._view)if(this._view.removeEventListener("preDropdown",this._loadEntriesBinded),"function"==typeof t)this.__loadEntriesBinded||(this.__loadEntriesBinded=this._loadEntriesBinded,this._loadEntriesBinded=r.bind(this)),this._view.addEventListener("preDropdown",this._loadEntriesBinded);else{var o=l.call(this);e.Array.isArray(o)?this._view.elementsList=o.slice(0):o instanceof s?this._view.elementsTree=o:o instanceof Promise?o.then((function(t){this&&this._view&&(e.Array.isArray(t)?this._view.returnData=t.slice(0):t instanceof s?this._view.elementsTree=t:e.log("DELWebTweakerCombobox::_loadEntries - unknown type of possibleValues response!","error"))})):e.log("DELWebTweakerCombobox::_loadEntries - unknown type of possibleValues response!","error")}}),i}));