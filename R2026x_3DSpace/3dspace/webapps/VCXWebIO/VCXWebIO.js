define("DS/VCXWebIO/VCXUUIDServices",["require","exports"],(function(e,t){"use strict";return class{static generateUUID(){let e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){let a=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?a:3&a|8).toString(16)}))}}})),define("DS/VCXWebIO/VCXMimeTypeServices",["require","exports"],(function(e,t){"use strict";class a{static GetMimeType(e){var t="";t=e.lastIndexOf(".")>0?e.substr(e.lastIndexOf(".")).toLowerCase():e;var i=a._mapTypes[t];return i||(i="application/octet-stream"),i}static GetExtension(e){var t=this._mapTypesInv[e];return t||console.log("Extension not found!"),t}}return a._mapTypes={".txt":"text/plain",".text":"text/plain",".html":"text/html",".htm":"text/html",".gif":"image/gif",".png":"image/png",".jpeg":"image/jpeg",".jpg":"image/jpeg",".svg":"image/svg+xml",".bmp":"image/bitmap",".tiff":"image/tiff",".tif":"image/tiff",".tga":"image/x-tga",".hdr":"image/vnd.radiance",".doc":"application/msword",".pdf":"application/pdf",".zip":"application/zip",".xml":"application/xml",".xsl":"application/xml",".json":"application/json",".xls":"application/vnd.ms-excel",".ppt":"application/vnd.ms-powerpoint",".mpp":"application/vnd.ms-project",".mpt":"application/vnd.ms-project",".docx":"application/vnd.openxmlformats-officedocument.wordprocessingml.document",".pptx":"application/vnd.openxmlformats-officedocument.presentationml.presentation",".xlsx":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",".mp4a":"audio/mp4",".mp3":"audio/mpeg",".mpga":"audio/mpeg",".ogg":"audio/ogg",".wav":"audio/x-wav",".mp4":"video/mp4",".mpeg":"video/mpeg",".webm":"video/webm",".ogv":"video/ogg",".avi":"video/x-msvideo"},a._mapTypesInv={"text/plain":".txt","text/html":".html","image/gif":".gif","image/png":".png","image/jpeg":".jpeg","image/svg+xml":".svg","image/bitmap":".bmp","image/tiff":".tiff","image/x-tga":".tga","image/vnd.radiance":".hdr","application/msword":".doc","application/pdf":".pdf","application/zip":".zip","application/xml":".xml","application/json":".json","application/vnd.ms-excel":".xls","application/vnd.ms-powerpoint":".ppt","application/vnd.ms-project":".mpp","application/vnd.openxmlformats-officedocument.wordprocessingml.document":".docx","application/vnd.openxmlformats-officedocument.presentationml.presentation":".pptx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":".xlsx","audio/mp4":".mp4a","audio/mpeg":".mp3","audio/ogg":".ogg","audio/x-wav":".wav","video/mp4":".mp4","video/mpeg":".mpeg","video/webm":".webm","video/ogg":".ogv","video/x-msvideo":".avi"},a})),define("DS/VCXWebIO/VCXCanvasServices",["require","exports"],(function(e,t){"use strict";class a{static async loadImage(e){return new Promise(((t,a)=>{const i=new Image;i.onload=function(){t(i)},i.onerror=function(t){return console.error("Failed to load image "+e),a(t)},i.crossOrigin="use-credentials",i.src=e}))}static async getOptimizedDataUrlFromUrl(e,t,i,r){const n=await a.loadImage(e);return a.getOptimizedDataUrlFromImg(n,t,i,r)}static getOptimizedDataUrlFromImg(e,t,i,r){var n=t||2e3,o=i||1500,s=a._getNewDimensions(e,n,o);const h=document.createElement("canvas");h.width=s.width,h.height=s.height;const l=h.getContext("2d");if(l){l.fillStyle="rgba(255, 255, 255, 0)",l.fillRect(0,0,s.width,s.height),l.drawImage(e,0,0,s.width,s.height);var d=h.toDataURL(r||"image/jpeg"),g=d.split(",")[0].split(":")[1].split(";")[0];return{dataUrl:d,type:g}}}static getDataUrlFromImg(e,t){const a=document.createElement("canvas");a.height=e.height,a.width=e.width;const i=a.getContext("2d");if(i)return i.drawImage(e,0,0,e.width,e.height),a.toDataURL(t||"image/jpeg")}static getDataUrlFromImgArray(e,t,a,i){let r="";const n=document.createElement("canvas");n.height=a,n.width=t;const o=n.getContext("2d");if(!o)return;const s=o.createImageData(t,a);if(e.length==t*a*4)for(var h=0;h<e.length;h++)s.data[h]=e[h];else if(e.length==t*a*3){var l=t*a*4,d=0;for(h=0;h<l;h+=4)s.data[h]=e[d],s.data[h+1]=e[d+1],s.data[h+2]=e[d+2],s.data[h+3]=255,d+=3}return o.putImageData(s,0,0),r=n.toDataURL(i||"image/jpeg"),r}static async getImgDataFromUrl(e){if(!e)return;const t=await a.loadImage(e),i=document.createElement("canvas");if(!i)return;i.height=t.height,i.width=t.width;const r=i.getContext("2d");return r?(r.drawImage(t,0,0,t.width,t.height),r.getImageData(0,0,t.width,t.height)):void 0}static getImgDataFromImg(e){const t=document.createElement("canvas");t.height=e.height,t.width=e.width;const a=t.getContext("2d");if(a)return a.drawImage(e,0,0,e.width,e.height),a.getImageData(0,0,e.width,e.height)}static async getBlobUrlFromImg(e,t){const i=await a.getDataUrlFromImgSrc(e,t);if(i)return a.getBlobUrlFromDataUrl(i.dataUrl,t)}static getBlobUrlFromCanvas(e,t){if(e){var i=t||"image/jpg",r=e.toDataURL(i);return a.getBlobUrlFromDataUrl(r,i)}}static getBlobUrlFromDataUrl(e,t){if(!e)return"";var i=a._fromBase64ToBlob(e,t);return a._fromBlobToImage(i)}static getBlobFromDataUrl(e,t){if(e)return a._fromBase64ToBlob(e,t)}static async getDataUrlFromImgSrc(e,t){const i=await a.loadImage(e);var r=a.getDataUrlFromImg(i,t);if(r)return{dataUrl:r,type:t,dimensions:{width:i.width,height:i.height}}}static async loadLocalImage(e,t){const i=await a.loadImage(e);let r=this.optimizeImage(i,void 0,t&&t.type);if(!r)return;let n=t&&t.name||"";if(t&&n&&t.type!==r.type){let e=r.type.split("/").pop();r.fileName+="."+e}return r}static optimizeImage(e,t,i){var r=e.width,n=e.height;"1"===t?(r=a.maxCanvasWidth,n=a.maxCanvasHeight):"0"===t&&(r=4e3,n=4e3);var o=a.getOptimizedDataUrlFromImg(e,r,n,i);return o&&(o.blobUrl=a.getBlobUrlFromDataUrl(o.dataUrl,o.type)),o}static _fromBase64ToBlob(e,t){return a._b64toBlob(e.split(",")[1],t)}static _fromBlobToImage(e){return URL.createObjectURL(e)}static _b64toBlob(e,t){for(var a=t||"image/jpeg",i=atob(e),r=i.length,n=new Uint8Array(r),o=0;o<r;o++)n[o]=i.charCodeAt(o);return new Blob([n],{type:a})}static _getNewDimensions(e,t,a){var i=e.width,r=e.height;return i>r?i>t&&(r*=t/i,i=t):r>a&&(i*=a/r,r=a),{width:i,height:r}}static drawShapePath(e,t,a){var i=t.shape;if(i===a.Circle||i===a.Ellipse)e.beginPath(),e.save(),e.translate(t.x+.5*t.width,t.y+.5*t.height),e.translate(.5*-t.width,.5*-t.height),e.scale(.5*t.width,.5*t.height),e.arc(1,1,1,0,2*Math.PI,!1),e.restore(),e.closePath();else if(i===a.Rhombus)e.beginPath(),e.moveTo(t.x+.5*t.width,t.y),e.lineTo(t.x+t.width,t.y+.5*t.height),e.lineTo(t.x+.5*t.width,t.y+t.height),e.lineTo(t.x,t.y+.5*t.height),e.closePath();else if(i===a.Rectangle||i===a.Square)e.beginPath(),e.rect(t.x,t.y,t.width,t.height),e.closePath();else{e.beginPath();const a=Math.min(t.cornerRadius,.5*t.width);e.moveTo(t.x+a,t.y),e.lineTo(t.x+t.width-a,t.y),e.quadraticCurveTo(t.x+t.width,t.y,t.x+t.width,t.y+a),e.lineTo(t.x+t.width,t.y+t.height-a),e.quadraticCurveTo(t.x+t.width,t.y+t.height,t.x+t.width-a,t.y+t.height),e.lineTo(t.x+a,t.y+t.height),e.quadraticCurveTo(t.x,t.y+t.height,t.x,t.y+t.height-a),e.lineTo(t.x,t.y+a),e.quadraticCurveTo(t.x,t.y,t.x+a,t.y),e.closePath()}}}return a.maxCanvasWidth=2e3,a.maxCanvasHeight=1500,a})),define("DS/VCXWebIO/VCXDateUtils",["require","exports"],(function(e,t){"use strict";return class{static isValidISODate(e){if(!/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}Z$/.test(e))return!1;const t=new Date(e);return!isNaN(t.getTime())}static getformattedDate(e){return`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")}T${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}Z`}static convertISODateToLocalTimezone(e,t){let a=t??"en-EN";const i=Intl.DateTimeFormat().resolvedOptions().timeZone;return new Date(e.toLocaleString(a,{timeZone:i}))}}})),define("DS/VCXWebIO/VCXImageUtils",["require","exports"],(function(e,t){"use strict";class a{static convertScreenshotToInt8Array(e){const t=e.match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/);if(t){let e=atob(t[3]),a=new ArrayBuffer(e.length),i=new Int8Array(a);for(let t=0;t<i.length;t++)i[t]=e.charCodeAt(t);return i}}static int8ArrayToBase64(e,t){let a=new Uint8Array(e),i="";for(let e=0;e<a.byteLength;e++)i+=String.fromCharCode(a[e]);return"data:image/"+t+";base64,"+window.btoa(i)}static rawDataToFormat(e,t,a=!1,i=0,r=0){const n=document.createElement("canvas"),o=n.getContext("2d");a&&(e=new ImageData(e,i,r)),n.width=e.width,n.height=e.height,o.putImageData(e,0,0);let s=n.toDataURL("image/"+t);return n.remove(),s}static decompressImage(e,t=!0,i=""){return new Promise(((r,n)=>{const o=new Image;o.onload=()=>{try{const e=document.createElement("canvas"),t=e.getContext("2d");e.width=o.width,e.height=o.height,t.drawImage(o,0,0);let a=t.getImageData(0,0,e.width,e.height);e.remove(),r(a)}catch(e){n(e)}},o.onerror=e=>{n(e)},o.src=t?a.int8ArrayToBase64(e,i):e}))}static async resizeImageBase64(e,t,a,i){return new Promise(((r,n)=>{const o=new Image,s=document.createElement("canvas"),h=s.getContext("2d");s.width=a,s.height=i,o.onload=()=>{s.width=a,s.height=i,h.drawImage(o,0,0,s.width,s.height),r(s.toDataURL("image/"+t))},o.onerror=()=>n(new Error("Failed to load image")),o.src=e}))}static async resizeImageImageData(e,t,a){const i=t>>0,r=a>>0,n=await window.createImageBitmap(e,0,0,e.width,e.height),o=document.createElement("canvas");o.width=i,o.height=r;const s=o.getContext("2d");return s.drawImage(n,0,0,i,r),s.getImageData(0,0,i,r)}}return a})),define("DS/VCXWebIO/VCXRenderedEventHelper",["require","exports"],(function(e,t){"use strict";class a{constructor(e){this._events=[],this._startCaptureDate=Date.now(),this._endCaptureDate=null,this._projectName=e}get events(){return this._events}set events(e){this._events=e}unInitialize(){this._events=[]}processListEvents(){let e={};for(let t of this._events)e.hasOwnProperty(t.id)||(e[t.id]={start:null,end:null}),t.type===a.EEventType.START&&(e[t.id].start=t),t.type===a.EEventType.END&&(e[t.id].end=t);for(let t in e)null===e[t].start&&null!==e[t].end&&(e[t].start={name:e[t].end.name,id:e[t].end.id,type:a.EEventType.START,ts:this._endCaptureDate??Date.now()}),null===e[t].end&&null!==e[t].start&&(e[t].end={name:e[t].start.name,id:e[t].start.id,type:a.EEventType.END,ts:this._startCaptureDate??Date.now()});return e}addNewEvent(e,t,i){let r={name:e,id:t,type:"b"===i?a.EEventType.START:a.EEventType.END,ts:Date.now()};this._events.push(r)}removeEvent(e){this._events=this._events.filter((t=>t.name!==e))}generateRenderedObject(){return this.processListEvents()}mergeEvents(e){return this._events.concat(e.events)}}return function(e){let t;!function(e){e[e.START=0]="START",e[e.END=1]="END"}(t=e.EEventType||(e.EEventType={}))}(a||(a={})),a})),define("DS/VCXWebIO/VCXLogServices",["require","exports","DS/VCXWebIO/VCXUUIDServices"],(function(e,t,a){"use strict";class i{static log(e,t){let a;switch(t){case i.EMessageType.Error:a="[31m";break;case i.EMessageType.Warning:a="[33m";break;case i.EMessageType.Info:a="[34m";break;case i.EMessageType.Success:a="[32m";break;default:a="[30m"}console.log(`[1m${a}${e}[0m`)}static generateUUID(){return a.generateUUID()}static memoryLog(e,t,a,r=void 0){try{if(this._startDate=Date.now(),i._firstTime){if(i._firstTime=!1,"true"===localStorage.getItem("VCX_Perfo")){const e=console.info;console.info=async function(...t){try{const a=JSON.parse(t[0]);if(a.hasOwnProperty("tags")&&(a.tags.hasOwnProperty("N")||a.tags.hasOwnProperty("name"))&&(a.experienceBase=i.experienceBase_id,a.webApplicationBase=i.webApplicationBase_id,localStorage.getItem("ServerURL"))){const e=localStorage.getItem("ServerURL");await fetch(e+"/api/v1/log",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})}e.apply(console,t)}catch(a){e.apply(console,t)}}}performance.memory&&console.warn("[HEAP] WARNING : set this arg to chrome to see good values : --enable-precise-memory-info")}const h={memory:0,time:0,deltaMemory:0,deltaTime:0};var n="";let l={};if(performance.memory&&(window.gc&&window.gc(),h.memory=performance.memory.usedJSHeapSize/1048576),t){i._logs[e]=h;const t=performance.mark(e+"_Start");h.time=.001*t?.startTime}else if(i._logs[e]){const t=performance.mark(e+"_End"),a=performance.measure(e,e+"_Start",e+"_End");h.time=.001*t?.startTime,h.deltaTime=.001*a?.duration,performance.clearMarks(e+"_Start"),performance.clearMarks(e+"_End"),performance.clearMeasures(e),performance.memory&&(h.deltaMemory=h.memory-i._logs[e].memory)}else console.warn("VCXLogServices can't find corresponding start"),h.deltaMemory=h.memory;var o=Math.floor(h.memory);performance.memory&&(n+="[HEAP] =\t"+o+"\tMo, ",l.heap=o),e.includes("RNWEB")&&t&&(this.webApplicationBase_id=a),e.includes("RNEB")&&t&&(this.experienceBase_id=a),e.includes("RCEB")&&t&&(this.experienceBase_id="");var s=h.time.toLocaleString(void 0,{maximumSignificantDigits:6,minimumSignificantDigits:2});return n+="[TIME] =\t"+s+"\ts",l.ts=this._startDate+1e3*h.time,l.startdate=this._startDate,l["event.name"]=e,l["event.provider"]="log_services",l["event.severity"]="info",l["event.type"]="trace",r&&(l.tags=r),l.experienceBase=this.experienceBase_id,l.webApplicationBase=this.webApplicationBase_id,t?(n+=", ["+e+" START]",l["trace.action"]="trace_start"):(n+=", ["+e+" END]",n+=", [DELTA HEAP] =\t"+Math.floor(h.deltaMemory)+"\tMo",n+=", [DELTA TIME] =\t"+h.deltaTime.toLocaleString(void 0,{maximumSignificantDigits:6,minimumSignificantDigits:2})+"\ts",l["trace.action"]="trace_end"),a&&(n+=", [UUID] =\t"+a,l["trace.id"]=a),localStorage.getItem("VCX_Perfo")?console.info(JSON.stringify(l)):console.log(n),{logName:e,time:s,heap:o}}catch(e){console.warn(e)}}}return i._logs={},i._firstTime=!0,i._startDate=0,i.webApplicationBase_id="",i.experienceBase_id="",function(e){let t;!function(e){e[e.Error=2]="Error",e[e.Warning=4]="Warning",e[e.Info=8]="Info",e[e.Success=16]="Success",e[e.Regular=32]="Regular"}(t=e.EMessageType||(e.EMessageType={}))}(i||(i={})),i}));var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebIO/VCXFileServices",["require","exports","DS/ZipJS/zip-fs","DS/WebappsUtils/WebappsUtils","DS/VCXWebIO/VCXMimeTypeServices"],(function(e,t,a,i,r){"use strict";i=__importDefault(i),r=__importDefault(r);class n{static getFileMimeType(e){var t=e.substr(e.lastIndexOf("."));if(t)return r.default.GetMimeType(t)}static async saveBlobsToZip(e){let t=new a.BlobWriter,i=await new Promise((function(e){let i=[];a.createWriter(t,(function(t){t._add=t.add,t._close=t.close,t.add=function(e,a,r,n){return new Promise((function(o,s){i.push(s),t._add(e,a,o,r,n)}))},t.close=function(){return new Promise((function(e,a){i.push(a),t._close(e)}))},e(t)}),(()=>{i.forEach((e=>e())),i=[]}))}));for(let t of e)await i.add(t.name,new a.BlobReader(t));return i.close()}static async PFileReadAs(e,t){return new Promise(((a,i)=>{var r=new FileReader;r.onerror=()=>{r.abort(),i(new Error("Problem parsing input file. "+e))},r.onload=()=>{a(r.result)},r["readAs"+t](e)}))}static async PExtractFromArchiveData(e,t){return new Promise((async(r,o)=>{var s,h=e.slice(0,3),l=new Uint8Array(h);if(83===l[0]&&77===l[1]&&71===l[2]){var d=e.byteLength;s=new DataView(e.slice(3,d))}else s=new DataView(e);for(var g=new Uint8Array(s.byteLength),f=0;f<g.length;f++)g[f]=s.getUint8(f);var c=new Blob([g],{type:"application/x-gzip"}),m=new a.fs.FS;a.workerScriptsPath=i.default.getWebappsBaseUrl()+"ZipJS/",m.importBlob(c,(()=>{var e=new Map,a=[];if(t)for(var i=0;i<t.length;i++){var o=m.find(t[i]);if(UWA.is(o.name))o.name.toLowerCase(),a.push(o)}else for(i=0;i<m.entries.length;i++){o=m.entries[i];if(UWA.is(o.name))o.name.toLowerCase(),a.push(o)}var s=0,h=()=>{var t=t=>i=>{t=t.toLowerCase(),e.set(t,i),s>10&&console.warn("Warning : nbWorkersRunning > nbWorkersMax"),s--,a.length>0?h():0===s?r(e):s<0&&(console.warn("Warning : nbWorkersRunning < 0"),r(e))},i=[];if(s<2)for(var o=0;o<a.length&&s<10;o++){var l=a[o].name;if(!e.get(l.toLowerCase())){var d;"octet-binary"===(d=n.getFileMimeType(l))&&console.warn("Warning : unknown resource file type"),s++,a[o].getBlob(d,t(l)),i.push(a[o])}}if(i.length>0)for(var g=0;g<i.length;g++)a.splice(a.indexOf(i[g]),1)};h()}),(e=>{o(new Error(e))}))}))}static async PExtractFromArchive(e,t){return new Promise(((a,i)=>{var r=new FileReader;r.onload=async e=>{try{a(await n.PExtractFromArchiveData(e.target?.result,t))}catch(e){i(e)}},r.readAsArrayBuffer(e)}))}static async GetBase64FromBlobObject(e){return new Promise((t=>{const a=new FileReader;a.onloadend=function(){t(a.result)},a.readAsDataURL(e)}))}static async GetBase64FromBlobUrl(e){return fetch(e).then((e=>e.blob())).then((e=>new Promise(((t,a)=>{const i=new FileReader;i.onloadend=()=>t(i.result),i.onerror=a,i.readAsDataURL(e)}))))}static BlobURLToBase64(e,t,a,i,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="blob",n.addEventListener("error",(()=>{a(null,i)})),n.onload=()=>{if(200===n.status){var e=new FileReader;e.onload=()=>{a(e.result,i)},e.readAsDataURL(n.response)}else 404===n.status&&r&&a(null,i)},n.send()}static BlobURLToJSONText(e,t,a){var i=a,r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="blob",r.onload=()=>{if(200===r.status){var e=r.response,a=new FileReader;a.onload=()=>{var e=a.result,r=JSON.parse(e);i?t.call(i,r):t(r)},a.readAsText(e)}},r.send()}static async PBlobURLToJSONText(e){return new Promise((t=>{var a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType="blob",a.onload=()=>{if(200===a.status){var e=a.response,i=new FileReader;i.onload=()=>{var e=i.result,a=JSON.parse(e);t(a)},i.readAsText(e)}},a.send()}))}static async BlobURLToText(e){var t=new XMLHttpRequest;return t.open("GET",e,!0),t.responseType="blob",new Promise(((e,a)=>{t.onload=async()=>{if(200===t.status){var i=t.response,r=new FileReader;r.onload=async()=>{var t=r.result;e(t)},r.readAsText(i)}else 404===t.status&&a()},t.send()}))}static dataURLToBlob(e){if(e){var t=";base64,";if(-1===e.indexOf(t)){var a=(r=e.split(","))[0].split(":")[1],i=decodeURIComponent(r[1]);return new Blob([i],{type:a})}a=(r=e.split(t))[0].split(":")[1];for(var r,n=(i=window.atob(r[1])).length,o=new Uint8Array(n),s=0;s<n;++s)o[s]=i.charCodeAt(s);return new Blob([o],{type:a})}console.warn("VCXFileServices: dataURL is empty.")}static dataURLToFile(e,t){if(e){var a=";base64,";if(-1===e.indexOf(a)){var i=(n=e.split(","))[0].split(":")[1],r=decodeURIComponent(n[1]);return new File([r],t,{type:i})}i=(n=e.split(a))[0].split(":")[1];for(var n,o=(r=window.atob(n[1])).length,s=new Uint8Array(o),h=0;h<o;++h)s[h]=r.charCodeAt(h);return new File([s],t,{type:i})}console.warn("VCXFileServices: dataURL is empty.")}static async PBlobURLToBlob(e,t){return new Promise(((a,i)=>{try{var r=new XMLHttpRequest;r.addEventListener("error",(()=>{var i=500+500*Math.random();console.warn("PBlobURLToBlob Error: "+e+" (retry in "+i+" ms)"),window.setTimeout((()=>{console.warn("PBlobURLToBlob retrying "+e),a(this.PBlobURLToBlob(e,t))}),i)})),r.open("GET",e,!0),r.responseType="blob",r.onload=()=>{if(200===r.status){var t=r.response;a(t)}else i(new Error("PBlobURLToBlob FAILED "+e))},r.send()}catch(e){i(new Error("PBlobURLToBlob catch "+e))}}))}static async PBlobToFileVar(e){return new Promise(((t,a)=>{var i=new FileReader;i.onload=()=>{var e=i.result,a=JSON.parse(e);t(a)},i.readAsText(e)}))}}return n}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebIO/VCXPixelImageSvg",["require","exports","DS/VENWebCanvg/CanvgTools","DS/VCXWebIO/VCXFileServices","UWA/Core"],(function(e,t,a,i,r){"use strict";i=__importDefault(i);return class{constructor(e,t,a){this.src=e,this._preferredWidthPx=void 0!==t?t:0,this._preferredHeightPx=void 0!==a?a:0}utf8ArrayToStr(e){var t,a,i,r,n,o;for(t="",i=e.length,a=0;a<i;)switch((r=e[a++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t+=String.fromCharCode(r);break;case 12:case 13:n=e[a++],t+=String.fromCharCode((31&r)<<6|63&n);break;case 14:n=e[a++],o=e[a++],t+=String.fromCharCode((15&r)<<12|(63&n)<<6|(63&o)<<0)}return t}setAreaToDraw(e,t,a,i){for(var r=e.search(/<svg/i),n=r,o=r;o<e.length;++o)if(">"===e[o]){n=o;break}var s=e.substring(0,n),h=' viewBox= "';h+=parseInt(i.x+1).toString(),h+=" ",h+=parseInt(i.y+1).toString(),h+=" ",h+=parseInt(i.width).toString(),h+=" ",h+=parseInt(i.height).toString(),h+='" ';var l=s.match(/(viewBox*)([\s=]*)([/"]*)([0-9.\s]*)([/"]*)/gi);l&&l.length?s=s.replace(l[0],h):s+=h;var d=' width= "';d+=t.toString(),d+='px" ';var g=s.match(/(width*)([\s=]*)([/"]*)([0-9a-z.\s]*)([/"]*)/gi);g&&g.length?s=s.replace(g[0],d):s+=d;var f=' height= "';f+=a.toString(),f+='px" ';var c=s.match(/(height*)([\s=]*)([/"]*)([0-9a-z.\s]*)([/"]*)/gi);return c&&c.length?s=s.replace(c[0],f):s+=f,s+=">",s+=e.substring(n+1,e.length)}renderFromDataUrl(e,t){var n=this,o=new FileReader;o.onload=function(e){var i=e.target?.result,o=new Uint8Array(i),s=n.utf8ArrayToStr(o);let h=r.createElement("div");h.setHTML(s),h.inject(document.body);var l=h.children[0].getBBox(),d="";d=n._preferredWidthPx&&n._preferredHeightPx?n.setAreaToDraw(s,Math.floor(n._preferredWidthPx),Math.floor(n._preferredHeightPx),l):n.setAreaToDraw(s,Math.floor(5*l.width),Math.floor(5*l.height),l),document.body.removeChild(h);var g=new Image,f="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(d)));g.onload=function(){var e=document.createElement("canvas");e.width=g.width,e.height=g.height;var a=e.getContext("2d");a&&(a.drawImage(g,0,0),void 0!==t&&t(e))},g.onerror=function(){var e=new a,i=document.createElement("canvas");e.svgToCanvas(d,i,{ignoreMouse:!0,ignoreAnimation:!0}),void 0!==t&&t(i)},g.src=f};let s=i.default.dataURLToBlob(e);s&&o.readAsArrayBuffer(s)}render(e){if("string"==typeof this.src&&"blob"===this.src.substring(0,4)){var t=this;i.default.BlobURLToBase64(this.src,null,(function(a){t.renderFromDataUrl(a,(function(t){void 0!==e&&e(t)}))}))}else"string"==typeof this.src&&"data"===this.src.substring(0,4)&&this.renderFromDataUrl(this.src,(function(t){void 0!==e&&e(t)}))}}}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebIO/VCXFileWriter",["require","exports","DS/VCXWebIO/VCXFileServices"],(function(e,t,a){"use strict";a=__importDefault(a);var i=window.document,r=window;return class{static getURL(){return r.URL||r.webkitURL||r}static saveBlobAs(e,t){var a;if(void 0!==window.navigator.msSaveBlob)window.navigator.msSaveBlob(e,t);else{var n=i.createElementNS("http://www.w3.org/1999/xhtml","a");a=this.getURL().createObjectURL(e),n.href=a,n.download=t;var o=i.createEvent("MouseEvents");o.initMouseEvent("click",!0,!1,r,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(o)}}static saveTextToFile(e,t,a){var i=new Blob([e],{type:a||"text/plain;charset=utf-8"});this.saveBlobAs(i,t)}static saveAs(e,t){var i=a.default.dataURLToBlob(e);this.saveBlobAs(i,t)}}}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebIO/VCXPixelImage",["require","exports","DS/VCXWebIO/VCXFileServices","DS/VCXWebIO/VCXFileWriter","DS/VCXWebIO/VCXPixelImageSvg","DS/Visualization/ThreeJS_DS"],(function(e,t,a,i,r,n){"use strict";a=__importDefault(a),i=__importDefault(i),r=__importDefault(r);class o{static async createFrom(e){const t=new o;return await t.loadFrom(e),t}constructor(e,t,a){this._width=0,this._height=0,this._preferredWidth=0,this._preferredHeight=0,this._quality=.8,e instanceof Uint8Array||e instanceof Uint8ClampedArray?(this._width=t,this._height=a,this._bufferRGBA=new Uint8ClampedArray(e)):e instanceof ImageData?(this._width=e.width,this._height=e.height,this._bufferRGBA=new Uint8ClampedArray(e.data)):(this._width=0,this._height=0,this._bufferRGBA=null)}setPreferredSize(e,t){this._preferredWidth=Math.floor(e),this._preferredHeight=Math.floor(t)}setQuality(e){e>=0&&e<=1&&(this._quality=e)}getBytes(){return this._bufferRGBA}getPixelWidth(){return this._width}getPixelHeight(){return this._height}getPixelRGBA(e,t){var a=4*(t*this._width+e),i=this._bufferRGBA;return i||console.log("Warning : Empty image!"),i?[i[a],i[a+1],i[a+2],i[a+3]]:[0,0,0,0]}isPowerOf2(e){return e&&!(e&e-1)}getNearestPow2(e){return Math.pow(2,Math.round(Math.log(e)/Math.log(2)))}hasDimensionsPowerOf2(){return this.isPowerOf2(this._width)&&this.isPowerOf2(this._height)}clear(e,t,a,i){for(var r=4*this._width*this._height,n=0;n<r;n+=4)this._bufferRGBA[n]=e,this._bufferRGBA[n+1]=t,this._bufferRGBA[n+2]=a,this._bufferRGBA[n+3]=i}loadFromImageUsingCanvas(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var a=t.getContext("2d");if(a){a.drawImage(e,0,0);var i=a.getImageData(0,0,t.width,t.height);this._width=i.width,this._height=i.height,this._bufferRGBA=new Uint8ClampedArray(i.data)}}loadFromImageDataUrl(e,t){var a=e.src,i=a.split(",")[0].split(":")[1].split(";")[0],n=this;switch(i){case"image/bitmap":case"image/bmp":n.loadBmpFromDataUrl(a,(function(a){!0!==a&&n.loadFromImageUsingCanvas(e),void 0!==t&&t()}));break;case"image/svg+xml":new r.default(a,n._preferredWidth,n._preferredHeight).render((function(e){n._width=e.width,n._height=e.height;var a=e.getContext("2d").getImageData(0,0,e.width,e.height);n._bufferRGBA=new Uint8ClampedArray(a.data),n.removeAreaWithAlphaZero(),void 0!==t&&t()}));break;default:n.loadFromImageUsingCanvas(e),void 0!==t&&t()}}loadFromImageBlobUrl(e,t){var i=this;a.default.BlobURLToBase64(e.src,null,(function(e){var a=new Image;a.onload=function(){i.loadFromImageDataUrl(a,(function(){void 0!==t&&t()}))},a.src=e}))}async loadFrom(e,t){return new Promise(((i,n)=>{var o=new Image,s=this,h="";o.onload=function(){"string"==typeof e&&"blob"===e.substring(0,4)?s.loadFromImageBlobUrl(o,(function(){void 0!==t&&t(),i()})):"string"==typeof e&&"data"===e.substring(0,4)?s.loadFromImageDataUrl(o,(function(){void 0!==t&&t(),i()})):s.loadFromImageBlobUrl(o,(function(){void 0!==t&&t(),i()}))},o.onerror=function(){"image/svg+xml"===h?new r.default(e,s._preferredWidth,s._preferredHeight).render((function(e){s._width=e.width,s._height=e.height;var a=e.getContext("2d").getImageData(0,0,e.width,e.height);s._bufferRGBA=new Uint8ClampedArray(a.data),s.removeAreaWithAlphaZero(),void 0!==t&&t(),i()})):(console.error("Image could not be loaded from url: '"+e+"'"),void 0!==t&&t(),n())},"blob:"===e.substring(0,5)?a.default.BlobURLToBase64(e,null,(function(a){"image/x-tga"===(h=a.split(",")[0].split(":")[1].split(";")[0])?s.loadTgaFromDataUrl(a,(function(){void 0!==t&&t(),i()})):o.src=e})):0===e.indexOf("data:image")?(e.indexOf("image/jpeg")>=0?h="image/jpeg":e.indexOf("image/png")>=0?h="image/png":e.indexOf("image/bitmap")>=0?h="image/bitmap":e.indexOf("image/bmp")>=0?h="image/bmp":e.indexOf("image/svg+xml")>=0?h="image/svg+xml":e.indexOf("image/x-tga")>=0&&(h="image/x-tga"),"image/x-tga"===h?a.default.BlobURLToBase64(e,null,(function(e){s.loadTgaFromDataUrl(e,(function(){void 0!==t&&t(),i()}))})):o.src=e):o.src=e}))}decodeRLEforTGA(e,t,a,i,r){var n,o,s,h,l,d,g,f=r*a;for(g=new Uint8ClampedArray(i),d=new Uint8ClampedArray(a),n=i-f;n>=0;){for(var c=0;c<f;){if(s=1+(127&(o=e.getUint8(t++))),128&o){for(h=0;h<a-1;++h)d[a-2-h]=e.getUint8(t++);for(d[a-1]=e.getUint8(t++),h=0;h<s;++h)g.set(d,n),n+=a}else for(h=0;h<s;++h,n+=a){for(l=0;l<a-1;++l)g[n+(a-2)-l]=e.getUint8(t++);g[n+a-1]=e.getUint8(t++)}c+=s*a}n-=2*f}return g}checkHeaderTGA(e){if(0===e.imageType)throw new Error("No data within current TGA file");if(e.bHasColorMap){if(e.colorMapLength>256||24!==e.colorMapSize||1!==e.colorMapType)throw new Error("Invalid colormap for indexed type")}else if(e.colorMapType)throw new Error("The image contains a color map but the imageType field tells it isn't needed.");if(e.width<=0||e.height<=0)throw new Error("Invalid image size: "+e.width+" per "+e.height+".");if(e.pixelDepth%8!=0||e.pixelDepth>32||e.pixelDepth<8)throw new Error('Invalid pixel size of "'+e.pixelDepth+' bits per pixel"')}loadTgaFromDataUrl(e,t){var i=new FileReader,r=this;i.onload=function(e){var a=new DataView(e.target?.result);let i={fileheader:{}};i.fileheader.idLength=a.getUint8(0),i.fileheader.colorMapType=a.getUint8(1),i.fileheader.imageType=a.getUint8(2),i.fileheader.colorMapIndex=a.getUint16(3,!0),i.fileheader.colorMapLength=a.getUint16(5,!0),i.fileheader.colorMapDepth=a.getUint8(7),i.fileheader.offsetX=a.getUint16(8,!0),i.fileheader.offsetY=a.getUint16(10,!0),i.fileheader.width=a.getUint16(12,!0),i.fileheader.height=a.getUint16(14,!0),i.fileheader.pixelDepth=a.getUint8(16),i.fileheader.flags=a.getUint8(17),r.checkHeaderTGA(i.fileheader),r._width=i.fileheader.width,r._height=i.fileheader.height;var n=18+i.fileheader.idLength,o=r._width*r._height,s=i.fileheader.pixelDepth>>3,h=o*s;if(r._bufferRGBA=new Uint8ClampedArray(h),i.fileheader.bHasEncoding=9===i.fileheader.imageType||10===i.fileheader.imageType||11===i.fileheader.imageType,i.fileheader.bHasColorMap=1===i.fileheader.imageType||9===i.fileheader.imageType,i.fileheader.bHasEncoding)r._bufferRGBA=r.decodeRLEforTGA(a,n,s,h,r._width);else{var l=r._width*r._height,d=l*i.fileheader.pixelDepth/8,g=new Uint8Array(e.target?.result,n,d);switch(r._bufferRGBA=new Uint8ClampedArray(d),i.fileheader.pixelDepth){case 8:for(var f=0,c=0;c<l;++c)r._bufferRGBA[f++]=g[c],r._bufferRGBA[f++]=g[c],r._bufferRGBA[f++]=g[c],r._bufferRGBA[f++]=255;break;case 16:for(f=0,c=0;c<l;++c){var m=2*c;r._bufferRGBA[f++]=g[m],r._bufferRGBA[f++]=g[m],r._bufferRGBA[f++]=g[m],r._bufferRGBA[f++]=g[m+1]}break;case 24:for(f=0,c=0;c<l;++c){m=3*c;r._bufferRGBA[f++]=g[m+2],r._bufferRGBA[f++]=g[m+1],r._bufferRGBA[f++]=g[m],r._bufferRGBA[f++]=255}break;case 32:for(c=0;c<l;++c){m=4*c;r._bufferRGBA[m]=g[m+2],r._bufferRGBA[m+1]=g[m+1],r._bufferRGBA[m+2]=g[m],r._bufferRGBA[m+3]=g[m+3]}}r.flipVertical()}t&&"function"==typeof t&&t()};let n=a.default.dataURLToBlob(e);i.readAsArrayBuffer(n)}loadBmpFromDataUrl(e,t){var i=this,r=new FileReader;r.onload=function(e){var a=new DataView(e.target?.result);let r={fileheader:{}};r.fileheader.bfType=a.getUint16(0,!0),r.fileheader.bfSize=a.getUint32(2,!0),r.fileheader.bfReserved1=a.getUint16(6,!0),r.fileheader.bfReserved2=a.getUint16(8,!0),r.fileheader.bfOffBits=a.getUint32(10,!0),r.infoheader={},r.infoheader.biSize=a.getUint32(14,!0),r.infoheader.biWidth=a.getUint32(18,!0),r.infoheader.biHeight=a.getUint32(22,!0),r.infoheader.biPlanes=a.getUint16(26,!0),r.infoheader.biBitCount=a.getUint16(28,!0),r.infoheader.biCompression=a.getUint32(30,!0),r.infoheader.biSizeImage=a.getUint32(34,!0),r.infoheader.biXPelsPerMeter=a.getUint32(38,!0),r.infoheader.biYPelsPerMeter=a.getUint32(42,!0),r.infoheader.biClrUsed=a.getUint32(46,!0),r.infoheader.biClrImportant=a.getUint32(50,!0),i._width=r.infoheader.biWidth,i._height=r.infoheader.biHeight,i._bufferRGBA=new Uint8ClampedArray(4*i._width*i._height);var n=r.fileheader.bfOffBits,o=new Uint8ClampedArray(e.target?.result,n),s=4*Math.floor((r.infoheader.biBitCount*r.infoheader.biWidth+31)/32),h=i._width,l=i._height,d=!1;if(0===r.infoheader.biCompression)switch(r.infoheader.biBitCount){case 24:for(var g=0;g<l;++g)for(var f=0;f<h;++f){var c=3*f+s*g,m=4*(f+h*(l-g-1));i._bufferRGBA[m]=o[c+2],i._bufferRGBA[m+1]=o[c+1],i._bufferRGBA[m+2]=o[c],i._bufferRGBA[m+3]=255}d=!0;break;case 32:for(g=0;g<l;++g)for(f=0;f<h;++f){c=4*f+s*g,m=4*(f+h*(l-g-1));i._bufferRGBA[m]=o[c+2],i._bufferRGBA[m+1]=o[c+1],i._bufferRGBA[m+2]=o[c],i._bufferRGBA[m+3]=o[c+3]}d=!0}void 0!==t&&t(d)};let n=a.default.dataURLToBlob(e);n&&r.readAsArrayBuffer(n)}toBmpDataUrl(){var e=document.createElement("canvas");e.width=this._width,e.height=this._height;var t=e.getContext("2d");if(t){var a=t.getImageData(0,0,this._width,this._height);a.data.set(this._bufferRGBA),t.putImageData(a,0,0,0,0,e.width,e.height);var i,r,n,o,s=e.width,h=e.height,l=4*s,d=e.getContext("2d").getImageData(0,0,s,h),g=new Uint32Array(d.data.buffer),f=4*Math.floor((32*s+31)/32),c=f*h,m=122+c,p=new ArrayBuffer(m),u=new DataView(p),w=0,v=0,b=0;for(A(19778),R(m),w+=4,R(122),R(108),R(s),R(-h>>>0),A(1),A(32),R(3),R(c),R(2835),R(2835),w+=8,R(16711680),R(65280),R(255),R(4278190080),R(1466527264);v<h;){for(r=122+v*f,i=0;i<l;)n=(o=g[b++])>>>24,u.setUint32(r+i,o<<8|n),i+=4;v++}for(var _=new Uint8Array(p),x="",y=0,B=_.length;y<B;)x+=String.fromCharCode(_[y++]);return"data:image/bmp;base64,"+btoa(x)}function A(e){u.setUint16(w,e,!0),w+=2}function R(e){u.setUint32(w,e,!0),w+=4}}toCanvas(){var e=document.createElement("canvas");e.width=this._width,e.height=this._height;var t=e.getContext("2d",{willReadFrequently:!0});if(t){var a=t.getImageData(0,0,e.width,e.height);return a.data.set(this._bufferRGBA),t.putImageData(a,0,0,0,0,e.width,e.height),e}}fillCanvas(e){e.width=this._width,e.height=this._height;var t=e.getContext("2d"),a=t.getImageData(0,0,e.width,e.height);a.data.set(this._bufferRGBA),t.putImageData(a,0,0,0,0,e.width,e.height)}replaceKeyColorByOther(e,t,a){for(var i=new Uint8ClampedArray(this._width*this._height*4),r=255*e.r,n=255*e.g,o=255*e.b,s=255*e.a,h=255*t.r,l=255*t.g,d=255*t.b,g=255*t.a,f=a?255*a.r:255,c=a?255*a.g:255,m=a?255*a.b:255,p=a?255*a.a:255,u=0;u<this._width;u++)for(var w=0;w<this._height;w++){var v=4*(w*this._width+u);Math.abs(this._bufferRGBA[v+0]-r)<3&&Math.abs(this._bufferRGBA[v+1]-n)<3&&Math.abs(this._bufferRGBA[v+2]-o)<3&&Math.abs(this._bufferRGBA[v+3]-s)<3?(i[v+0]=h,i[v+1]=l,i[v+2]=d,i[v+3]=g):a?(i[v+0]=f,i[v+1]=c,i[v+2]=m,i[v+3]=p):(i[v+0]=this._bufferRGBA[v+0],i[v+1]=this._bufferRGBA[v+1],i[v+2]=this._bufferRGBA[v+2],i[v+3]=this._bufferRGBA[v+3])}this._bufferRGBA=i}buildBorderHist(e){for(var t=0,a=!1,i=0;i<this._width;i++){t=4*(0*this._width+i),this._bufferRGBA[t+3]<255&&(a=!0);var r=new n.Color(this._bufferRGBA[t+0]/255,this._bufferRGBA[t+1]/255,this._bufferRGBA[t+2]/255).getHex();e.hasOwnProperty(r)?e[r]++:e[r]=0,t=4*((this._height-1)*this._width+i),this._bufferRGBA[t+3]<255&&(a=!0);r=new n.Color(this._bufferRGBA[t+0]/255,this._bufferRGBA[t+1]/255,this._bufferRGBA[t+2]/255).getHex();e.hasOwnProperty(r)?e[r]++:e[r]=0}for(var o=1;o<this._height-1;o++){t=4*(o*this._width+0);this._bufferRGBA[t+3]<255&&(a=!0);r=new n.Color(this._bufferRGBA[t+0]/255,this._bufferRGBA[t+1]/255,this._bufferRGBA[t+2]/255).getHex();e.hasOwnProperty(r)?e[r]++:e[r]=0;t=4*(o*this._width+(this._width-1));this._bufferRGBA[t+3]<255&&(a=!0);r=new n.Color(this._bufferRGBA[t+0]/255,this._bufferRGBA[t+1]/255,this._bufferRGBA[t+2]/255).getHex();e.hasOwnProperty(r)?e[r]++:e[r]=1}return a}extractSubImageInternal(e,t,a,i){for(var r=e+a<this._width?a:this._width-e,n=t+i<this._height?i:this._height-t,o=new Uint8ClampedArray(r*n*4),s=0,h=0;h<n;h++)for(var l=4*(e+(h+t)*this._width),d=0;d<r;d++)o[s++]=this._bufferRGBA[l++],o[s++]=this._bufferRGBA[l++],o[s++]=this._bufferRGBA[l++],o[s++]=this._bufferRGBA[l++];return{newBuffer:o,newW:r,newH:n}}toSubImage(e,t,a,i){const{newBuffer:r,newW:n,newH:o}=this.extractSubImageInternal(e,t,a,i);this._width=n,this._height=o,this._bufferRGBA=r}getSubImage(e,t,a,i){const{newBuffer:r,newW:n,newH:s}=this.extractSubImageInternal(e,t,a,i);var h=new o;return h._width=n,h._height=s,h._bufferRGBA=r,h}reDimension(e,t){for(var a=new Uint8ClampedArray(e*t*4),i=this._width/e,r=this._height/t,n=0;n<t;n++)for(var o=r*n,s=0;s<e;s++){var h=4*(e*Math.floor(n)+Math.floor(s)),l=4*(this._width*Math.floor(o)+Math.floor(i*s));a[h]=this._bufferRGBA[l],a[h+1]=this._bufferRGBA[l+1],a[h+2]=this._bufferRGBA[l+2],a[h+3]=this._bufferRGBA[l+3]}this._width=e,this._height=t,this._bufferRGBA=a}scale(e,t,a){var i=Math.floor(this._width*e),r=Math.floor(this._height*t);this.reDimension(i,r)}flipVertical(){if(null!==this._bufferRGBA)for(var e,t=4*this._width,a=.5*this._height,i=0;i<a;i++)for(var r=t*i,n=t*(this._height-i-1),o=0;o<t;o++)e=this._bufferRGBA[r],this._bufferRGBA[r++]=this._bufferRGBA[n],this._bufferRGBA[n++]=e}setPixelsOpacity(e){for(var t=4*this._width*this._height,a=3;a<t;a+=4)this._bufferRGBA[a]=e}removeAreaWithAlphaZero(){for(var e=0,t=0;t<this._width;++t){for(var a=!0,i=0;i<this._height;++i){if(this.getPixelRGBA(t,i)[3]){e=t,a=!1;break}}if(!a)break}var r=this._width-1;for(t=this._width-1;t>=0;--t){for(a=!0,i=0;i<this._height;++i){if(this.getPixelRGBA(t,i)[3]){r=t,a=!1;break}}if(!a)break}var n=0;for(i=0;i<this._height;++i){var o=!0;for(t=0;t<this._width;++t){if(this.getPixelRGBA(t,i)[3]){n=i,o=!1;break}}if(!o)break}var s=this._height-1;for(i=this._height-1;i>=0;--i){for(o=!0,t=0;t<this._width;++t){if(this.getPixelRGBA(t,i)[3]){s=i,o=!1;break}}if(!o)break}e>r&&(e=0,r=this._width-1),n>s&&(n=0,s=this._height-1),this.toSubImage(e,n,r,s)}buildFromDataUrl(e,t){"string"==typeof e&&"blob"===e.substring(0,4)||t();var a=this,i=new Image;i.onload=function(){var i=document.createElement("canvas");i.width=e.width,i.height=e.height;var r=i.getContext("2d");if(r){r.drawImage(e,0,0),a._width=i.width,a._height=i.height;var n=r.getImageData(0,0,i.width,i.height);a._bufferRGBA=new Uint8ClampedArray(n.data),void 0!==t&&t()}},i.src=e}toDataUrl(e,t,a){if("image/bmp"===e)return this.toBmpDataUrl();var i=document.createElement("canvas");i.width=this._width,i.height=this._height;var r=i.getContext("2d");if(r){var n=r.getImageData(0,0,this._width,this._height);n.data.set(this._bufferRGBA),r.putImageData(n,0,0,0,0,i.width,i.height);var o=i.toDataURL(e||"image/png",t||85);if(a&&"image/jpeg"===e){var s=o.replace("data:image/jpeg;base64,",""),h=atob(s);let e=[];for(let t=0;t<h.length;t++)e.push(h.charCodeAt(t));var l=new Uint8Array(e),d=(65535&a)>>8,g=255&a,f=0,c=0;for(f=0;f<20;f++)if(74==l[f]&&70==l[f+1]&&73==l[f+2]&&70==l[f+3]&&0==l[f+4]){c=f+7;break}if(20===c)return console.log("can't set the DPI settings in jpgeg file"),o;l[c]=1,l[c+1]=d,l[c+2]=g,l[c+3]=d,l[c+4]=g;var m="";for(f=0;f<l.length;)m+=String.fromCharCode(l[f++]);return"data:image/jpeg;base64,"+btoa(m)}return o}}toBlob(){return a.default.dataURLToBlob(this.toDataUrl())}imgB64ToBuffer(e){const t=e.split(";base64,").pop();return t?Uint8Array.from(window.atob(t),(e=>e.charCodeAt(0))):null}saveAs(e){if(e){var t=document.createElement("canvas");t.width=this._width,t.height=this._height;var a=t.getContext("2d");if(a){var r=a.getImageData(0,0,t.width,this._height);r.data.set(this._bufferRGBA),a.putImageData(r,0,0,0,0,t.width,t.height);var n="image/jpeg";switch(e.split(".")[1]){case"png":n="image/png";break;case"bmp":n="image/bitmap";break;case"tif":case"tiff":n="image/tiff";break;case"tga":n="image/x-tga";break;case"gif":n="image/gif";break;case"svg":n="image/svg+xml";break;case"hdr":n="image/vnd.radiance"}i.default.saveAs(t.toDataURL(n,this._quality),e)}}}getCanvas(){var e=document.createElement("canvas");e.width=this._width,e.height=this._height;var t=e.getContext("2d");if(t){var a=t.getImageData(0,0,e.width,this._height);return a.data.set(this._bufferRGBA),t.putImageData(a,0,0,0,0,e.width,e.height),e}}}return o}));