if(define("DS/DocumentTableMePreferences/views/TopBar",["UWA/Core","DS/Utilities/Dom","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/Tweakers/GeneratedToolbar","DS/Controls/ComboBox","DS/Controls/LineEditor","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Button","i18n!DS/DocumentTableMePreferences/assets/nls/DocumentTableMePreferences","css!DS/DocumentTableMePreferences/css/TopBar.css"],(function(e,t,i,n,o,r,a,s,l,d,c,m){const u="docm-table-mePreference-topbar",p="functionIcon",h=(e,t,i=null,o=null,r=[])=>new n({label:e,comboBoxSemantics:t,value:i,uuid:o,icons:r,children:[]}),g={ENXWDOC_TABLE_DEFAULT:"default",ENXWDOC_TABLE_CUSTO_ADMIN:"admin",ENXWDOC_TABLE_CUSTO:"user"};function f(e,t={}){this.controller=e,this.options=t,this.elements={},this.editInProgress=!1,this.permissionRights=this.controller.store.getPermissionRights(),this.adminSection=h(c.commandMenu.admin,"section",null,"admin-section",[{iconName:"role-cog wux-ui-3ds"}]),this.userSection=h(c.commandMenu.user,"section",null,"user-section",[{iconName:"role wux-ui-3ds"}]),this.initializeEvents()}return f.prototype.searchViews=function(e){return this.options.viewModel.search({match:t=>t.nodeModel.options.uuid===e})},f.prototype.initializeEvents=function(){var e=this;this.controller.options.events.subscribe({event:"docm-mepreference-view-collection"},(function(t){switch(t.name){case"views-added":t.newViews.forEach((t=>{switch(t.viewType){case"default":if(!e.searchViews(t.id).length>0){var i="Docm_Default_View"==t.id?c.get("Default"):t.viewName;e.defaultSection.addChild(h(i,"subsection",t.viewName,t.id))}break;case"admin":!e.searchViews(t.id).length>0&&e.adminSection&&e.adminSection.addChild(h(t.viewName,"subsection",t.viewName,t.id));break;case"user":!e.searchViews(t.id).length>0&&e.userSection&&e.userSection.addChild(h(t.viewName,"subsection",t.viewName,t.id))}}));break;case"views-removed":t.removedViews.forEach((t=>{switch(t.viewType){case"admin":if(e.adminSection)e.adminSection.search({match:e=>e.nodeModel.options.uuid===t.id}).forEach((t=>{e.adminSection.removeChild(t)}));break;case"user":if(e.userSection)e.userSection.search({match:e=>e.nodeModel.options.uuid===t.id}).forEach((t=>{e.userSection.removeChild(t)}))}}));break;case"view-selected":var i=t.selectedView;if(!i)return;var n=e.options.viewModel.getSelectedNodes()[0];if(n&&i.id==n.options.uuid)return;var o=e.searchViews(i.id)[0];o&&(e.elements.hdrCombo.selectedIndex=-1,o.select()),e._updateToolbar()}}))},f.prototype.__buildUX=function(e){var n=this;let s=t.createElement("div",{class:u+"-hdr-label"});s.innerText=c.views.viewLabel,e.appendChild(s),this.options.viewModel=new i({shouldBeSelected:e=>"section"!==e.options.comboBoxSemantics}),n.defaultSection=h(c.commandMenu.default,"section",null,"_defaultView"),"ENXWDOC_TABLE_DEFAULT"==this.permissionRights.prefName&&this.options.viewModel.addRoot(n.defaultSection),this.options.viewModel.addRoot(n.adminSection),"ENXWDOC_TABLE_CUSTO"==this.permissionRights.prefName&&this.options.viewModel.addRoot(n.userSection),this.options.viewModel.expandAll(),this.toolbarDef={entries:[{id:"addView",dataElements:{typeRepresentation:p,icon:{iconName:"plus",fontIconFamily:1},tooltip:{title:c.commands.addview.title,shortHelp:this.controller.options.isAdminOnDocmWidget?c.commands.addview.message2:c.commands.addview.message1},value:()=>{this.__manageView("addView")},position:"near",category:"hdrcmd",disabled:!0,visibleFlag:!1}},{id:"removeView",dataElements:{typeRepresentation:p,icon:{iconName:"trash",fontIconFamily:1},tooltip:{title:c.commands.removeview.title,shortHelp:c.commands.removeview.message},value:()=>{this.__manageView("removeView")},position:"near",category:"hdrcmd",disabled:!0,visibleFlag:!1}}]};let l=o.prototype.createTreeDocument(this.toolbarDef),d=t.createElement("div",{class:u+"-hdr-view"});e.appendChild(d);let m=this.elements.hdrCombo=new r({enableSearchFlag:!1,elementsTree:this.options.viewModel});m.getContent().addEventListener("change",(e=>{if(e.dsModel.elementsTree.getSelectedNodes().length){let t=e.dsModel.elementsTree.getSelectedNodes()[0].options.uuid;t&&n.controller.store.viewCollection.updateSelectedView(t),n._updateToolbar()}})),m.getContent().addClassName(u+"-hdr-combo"),d.appendChild(m.getContent()),this.elements.toolbar=new o({overflowManagement:"dropdown",direction:"horizontal",items:l}),this.elements.toolbar.getContent().addClassName(u+"-toolbar");let g=this.elements.hdrEditor=new a({requiredFlag:!0,displayClearFieldButtonFlag:!0});g.addEventListener("validFlagChange",(function(e){e&&e.dsModel&&n._validateViewName()})),g.getContent().addClassName(u+"-hdr-editor hidden"),d.appendChild(g.getContent());let f=t.createElement("div",{class:u+"-hdr-toolbar"});e.appendChild(f),f.appendChild(this.elements.toolbar.getContent())},f.prototype._updateToolbar=function(){var e=this,t=this.controller.store.getPermissionRights();this.elements.toolbar.updateNodeModel("removeView",{visibleFlag:!!e.editInProgress||t.viewedition,disabled:!e.editInProgress&&!t.viewedition,tooltip:{title:e.editInProgress?c.commands.cancel:c.commands.removeview.title,shortHelp:e.editInProgress?void 0:c.commands.removeview.message},icon:{iconName:e.editInProgress?"close":"trash",fontIconFamily:1}}),this.elements.toolbar.updateNodeModel("addView",{disabled:!1,tooltip:{title:e.editInProgress?c.commands.confirm:c.commands.addview.title,shortHelp:e.editInProgress?void 0:e.controller.options.isAdminOnDocmWidget?c.commands.addview.message2:c.commands.addview.message1},visibleFlag:t.viewcreation,icon:{iconName:e.editInProgress?"check":"plus",fontIconFamily:1}})},f.prototype._validateViewName=function(){var e=this.elements.hdrEditor.validFlag;this.elements.toolbar.getNodeModelByID("addView").updateOptions({disabled:!e})},f.prototype.__manageView=function(e){var t=this;const i=(e,t)=>{e.getContent().toggleClassName("hidden",!t)};switch(e){case"addView":var n=t.controller.store.getSelectedView();if(!t.editInProgress){t.editInProgress=!0,t.controller.disableManagerUI(),t.elements.hdrEditor.setProperties({value:""==n.viewName?"":`${c.get("COPY_OF")}-${n.viewName}`}),i(t.elements.hdrEditor,!0),i(t.elements.hdrCombo,!1),t._updateToolbar();break}var o=t.elements.hdrEditor.value.trim();if(t.controller.store.viewCollection.viewExists(o)){t.editInProgress=!1,t.controller.enableManagerUI(),i(t.elements.hdrEditor,!1),i(t.elements.hdrCombo,!0),t._updateToolbar(),t.controller.showNotification("warning",void 0,void 0,`View "${o}" already exists.`);break}var r=n.getClone({viewName:o,viewType:g[t.controller.store.getPermissionRights().prefName]});const e=()=>{var e=r.viewType;4==t.controller.store.viewCollection.getViews().filter((t=>t.viewType===e)).length?t.controller.showNotification("warning",c.get("MaxViewLimitReachedTitle"),void 0,c.get("MaxViewLimitReachedMsg",{viewType:e})):(t.controller.store.viewCollection.loadViews([r]),t.controller.store.viewCollection.updateSelectedView(r.id)),t.editInProgress=!1,t.controller.enableManagerUI(),i(t.elements.hdrEditor,!1),i(t.elements.hdrCombo,!0),t._updateToolbar()},a=async()=>{r.viewType="admin",t.controller.disableUI(),e(),t.controller.enableUI()},s=()=>{t.editInProgress=!1,t.controller.enableManagerUI(),i(t.elements.hdrEditor,!1),i(t.elements.hdrCombo,!0),t._updateToolbar()};this.controller.options.isAdminOnDocmWidget&&this.controller.options.inDocumentManagementWidget?(t.controller.enableManagerUI(),t.controller.UIComponents.viewManager.populateData(),this.createDialog(a,e,s)):e();break;case"removeView":if(t.editInProgress){t.editInProgress=!1,t.controller.enableManagerUI(),i(t.elements.hdrEditor,!1),i(t.elements.hdrCombo,!0),t._updateToolbar(),t.controller.store.viewCollection.updateSelectedViewConditionally();break}(n=t.controller.store.getSelectedView())&&"default"!=n.viewType&&(t.controller.store.viewCollection.removeViews([n.id]),t.controller.store.viewCollection.updateSelectedViewConditionally())}},f.prototype.createDialog=function(t,i,n){var o=this;this.immersiveFrame=new s({identifier:"docm_me_preference_dialog"});var r=e.createElement("div",{styles:{display:"flex","flex-direction":"column",gap:"5px",color:"#3d3d3d","font-size":"12px","margin-left":"10px"}});e.createElement("div",{text:c.get("AdminViewSaveMessage1"),styles:{"white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}}).inject(r),e.createElement("div",{text:c.get("AdminViewSaveMessage2"),styles:{"white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}}).inject(r);o.modalDialog=new l({immersiveFrame:o.immersiveFrame,title:c.createNewView,content:r,identifier:"Docm-Me-Preference-Admin-View-Confirmation-Dialog",autoCloseFlag:!1,modalFlag:!0,buttons:{No:new d({onClick:function(e){e.dsModel.dialog.destroy(),o.immersiveFrame.destroy(),e.dsModel=null,i()}}),Yes:new d({onClick:function(e){e.dsModel.dialog.destroy(),o.immersiveFrame.destroy(),e.dsModel=null,t()}})}}),o.modalDialog.addEventListener("close",(function(e){n(),e.dsModel.destroy(),o.immersiveFrame.destroy(),e.dsModel=null})),o.immersiveFrame.inject(o.controller.parentCtrl.elements.container)},f})),define("DS/DocumentTableMePreferences/views/AttributeManager",["DS/Utilities/Dom","UWA/Promise","DS/Controls/Loader","DS/Controls/ModalContainer","DS/TreeModel/TreeNodeModel","DS/DataGridView/DataGridView","DS/Tweakers/GeneratedToolbar","DS/FindEx/FindDialog","text!DS/DocumentTableMePreferences/assets/config/DOCM_AttributeManager_Config.json","text!DS/DocumentTableMePreferences/assets/config/ENXWDOC_AP_Table_MePreference_Config.json","i18n!DS/DocumentTableMePreferences/assets/nls/DocumentTableMePreferences","css!DS/DocumentTableMePreferences/css/AttributeManager.css"],(function(e,t,i,n,o,r,a,s,l,d,c,m){const u="docm-table-mePreference-attribute-manager",p=JSON.parse(l),h=JSON.parse(d);function g(e){this.controller=e,this.attributeManagerStore=e.store.getAttributeManagerStore(),this.options=e.options||{},this.loader=new i,this.options=Object.assign({toolbarDef:{entries:[{id:"findInAtt",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"search",fontIconFamily:1},value:()=>{this.elements.findDialog.visibleFlag=!this.elements.findDialog.visibleFlag},position:"far",category:"find",visibleFlag:!0}}]},columns:[{dataIndex:"tree",text:c.columns.column_name,width:"auto",visibleFlag:!0}],attributeCategoriesNodes:[{name:"commonColumns",nlsKey:"COMMON_COLUMNS",iconName:"attributes"},{name:"typeColumns",nlsKey:"TYPE_COLUMNS",iconName:"attributes"},{name:"extensionColumns",nlsKey:"EXTENSION_COLUMNS",iconName:"attributes"}],attModel:this.attributeManagerStore.treeDocument},this.options)}return g.prototype.buildUX=function(t){this.container=t,this.elements={},this.elements={},this.elements.header=e.createElement("div",{class:u+"-header"}),this.elements.content=e.createElement("div",{class:u+"-content"}),t.appendChild(this.elements.header),t.appendChild(this.elements.content);let i=e.createElement("div",{class:u+"-title"});i.innerText=c.AttributeManager.title,this.elements.header.appendChild(i);let n=a.prototype.createTreeDocument(this.options.toolbarDef);this.elements.toolbar=new a({overflowManagement:"dropdown",direction:"horizontal",items:n}),this.elements.toolbar.getContent().addClassName(u+"-toolbar"),this.elements.header.appendChild(this.elements.toolbar.getContent()),this.buildGridView(),this.initializeEvents(),this.populateAttributeManager()},g.prototype.initializeEvents=function(){var e=this;this.controller.options.events.subscribe({event:"docm-mepreference-ensure-node-visibility"},(function(t){"AttributeManager"==t.target&&e.elements.dgv.ensureNodeModelVisible(t.node,!1,!0,.2)}))},g.prototype.buildGridView=function(){var e=p.defaultDGVOpts;e.columns=this.options.columns,e.treeDocument=this.options.attModel,e.placeholder="Fetching Attributes ...",e.treeNodeCellOptions={expanderStyle:"triangle",buildLinks:!1},this.elements.dgv=new r(e),this.elements.dgv.onContextualEvent=function(e){var t=[];if(e&&e.collectionView&&-1===e.cellInfos.rowID){t=e.collectionView.buildDefaultContextualMenu(e,{pin:!1,firstColumnsVisibility:!1,columnsManagement:!1,sizeColumnToFit:!0,insertRow:!1})}return t},this.elements.dgv.getContent().addClassName(u+"-dgv"),this.elements.content.appendChild(this.elements.dgv.getContent()),this.elements.findDialog=new s({domId:u+"-find-dialog",visibleFlag:!1,findWidgetOptions:{relatedWidget:this.elements.dgv,showAdditionnalOptions:!1,inputValidationThreshold:2}})},g.prototype.populateAttributeManager=function(){var e=this;this.ready=!1,this.readyPromise=t.deferred(),this.startLoading(),e.attributeManagerStore.refresh(),e.attributeManagerStore.treeDocument.withTransactionUpdate((function(){e.addAttributeCategoriesNodes(this.options.attModel,this.options.attributeCategoriesNodes),e.populateCommonAttributes()})),e.controller.serviceManager.loadDocumentDictionary().then((t=>{e.attributeManagerStore.treeDocument.withTransactionUpdate((function(){e.populateTypeAttributes(t),e.populateExtensionAttributes(t)})),e.readyPromise.resolve(),e.ready=!0,e.finishLoading()}))},g.prototype.addAttributeCategoriesNodes=function(){var e=this;this.options.attModel.removeRoots(),this.options.attributeCategoriesNodes.forEach((t=>{const i=new o({icons:[{iconName:t.iconName,fontIconFamily:1}],label:c.get("attributeCategoriesNodes")[t.nlsKey],type:"AttributeCategoryNode",grid:{id:t.name,label:c.get("attributeCategoriesNodes")[t.nlsKey],shouldBeSelected:!1}});e.attributeManagerStore.categoryNodes.has(t.name)||(e.attributeManagerStore.categoryNodes.set(t.name,i),e.options.attModel.addRoot(i))}))},g.prototype.populateCommonAttributes=function(){var e=this,t=e.attributeManagerStore.categoryNodes.get("commonColumns");t&&(t.removeChildren(),[...h.defaultColumns,...h.externalColumns].forEach((i=>{const n=new o({icons:[{iconName:"object-instance",fontIconFamily:1}],label:c.get("columnsNls")[i.nlsKey],type:"CommonAttribute",grid:{id:i.name,label:c.get("columnsNls")[i.nlsKey],type:"CommonAttribute",name:i.name,curi:i.curi,visibleFlag:i.visibleFlag,width:i.width,nlsKey:i.nlsKey}});e.attributeManagerStore.uniqueAttributeNodes.has(i.name)||(e.attributeManagerStore.uniqueAttributeNodes.set(i.name,n),t.addChild(n))})))},g.prototype.populateTypeAttributes=function(e){var t=this,i=t.attributeManagerStore.categoryNodes.get("typeColumns");i&&(i.removeChildren(),e.typeDetails.forEach(((e,n)=>{const r=new o({icons:[t.controller.serviceManager.platformUrlsManager.getPlatformURL("3DSpace")+"/snresources/images/icons/small/I_CDM_Document.png"],label:e.preferredType.typeNLS,type:"TypeNode",grid:{id:n,name:e.preferredType.type,label:e.preferredType.typeNLS,type:"TypeNode",shouldBeSelected:!1}});t.attributeManagerStore.typeNodes[n]={node:r,childNodes:new Map},i.addChild(r),e.attributes.publicAttributes.forEach((e=>{const i=new o({icons:[{iconName:"object-instance",fontIconFamily:1}],label:e.attributeNls,type:"TypeAttributeNode",data:e,grid:{id:e.attribute,label:e.attributeNls,type:"TypeAttributeNode",name:e.attribute,width:void 0}});t.attributeManagerStore.typeNodes[n].childNodes.has(e.attribute)||(t.attributeManagerStore.typeNodes[n].childNodes.set(e.attribute,i),t.attributeManagerStore.typeNodes[n].node.addChild(i)),t.attributeManagerStore.uniqueAttributeNodes.has(e.attribute)||t.attributeManagerStore.uniqueAttributeNodes.set(e.attribute,i),t.attributeManagerStore.typeNodes[n].node.sortChildren()}))})))},g.prototype.populateExtensionAttributes=function(e){var t=this,i=t.attributeManagerStore.categoryNodes.get("extensionColumns");i&&(i.removeChildren(),e.interfaces.forEach((e=>{const n=new o({label:e,type:"ExtensionNode",grid:{id:e,label:e,type:"ExtensionNode",shouldBeSelected:!1}});t.attributeManagerStore.intefaceNodes.has(e)||(t.attributeManagerStore.intefaceNodes.set(e,n),i.addChild(n))})),i.sortChildren(),e.interfaceAttributes.forEach(((e,i)=>{var n=t.attributeManagerStore.intefaceNodes.get(e.source);if(n){const r=new o({icons:[{iconName:"object-instance",fontIconFamily:1}],label:e.attributeNls,type:"ExtensionAttributeNode",data:e,grid:{id:i,label:e.attributeNls,type:"ExtensionAttributeNode",name:e.attribute,nameNls:e.attributeNls,width:void 0}});t.attributeManagerStore.uniqueAttributeNodes.has(i)||(t.attributeManagerStore.uniqueAttributeNodes.set(i,r),n.addChild(r),n.sortChildren())}})))},g.prototype.ensureReady=function(){return!!this.readyPromise&&this.readyPromise.promise},g.prototype.startLoading=function(){this.isLoadingInProgress=!0,this.loader.on(),n.createModal(this.container,this.loader.elements.container)},g.prototype.finishLoading=function(){this.isLoadingInProgress=!1,this.loader.off(),n.removeModal(this.container)},g})),define("DS/DocumentTableMePreferences/services/PlatformURL",["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/WAFData/WAFData"],(function(e,t){"use strict";var i=null,n=null;function o(e){this.options=e}return o.prototype.initialize=async function(t){return n=t.lang,new Promise((function(n,o){null===i?e.getPlatformServices({config:t,onComplete:function(e){n(i=e)},onFailure:o}):n(i)}))},o.prototype.getPlatformId=function(){return null!=widget&&widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise"},o.prototype.getTenantInfo=function(e){for(var t={},n=0;n<i.length;n++)if(i[n].platformId===e){t=i[n];break}return t},o.prototype.getPlatformURL=function(e){if(!1===Array.isArray(i))throw new Error("Platform services not initialize yet");var t=this.getPlatformId(),n=this.getTenantInfo(t);return void 0===n[e]?(console.error("No "+e+" URL available for the tenant ["+t+"]"),null):n[e]},o.prototype.initCredentials=function(){var e=this;return new Promise(((i,o)=>{var r=e.getPlatformURL("3DSpace")+"/resources/modeler/pno/person?current=true";r+="&select=preferredcredentials&select=collabspaces",r+="&tenant="+e.getPlatformId(),t.authenticatedRequest(r,{method:"GET",type:"json",headers:{Accept:"application/json","Accept-Language":widget.lang||n},onComplete:function(t){e.username=t.name,e.serverPreferredSecurityContext=void 0,e.security_context_list=[];var n=t.preferredcredentials;if(n.collabspace&&n.role&&n.organization&&(e.serverPreferredSecurityContext=n.role.name+"."+n.organization.name+"."+n.collabspace.name),e.multiOrg=!1,t.collabspaces&&t.collabspaces.length>0){for(var o=void 0,r=0;r<t.collabspaces.length;r++)for(var a=0;a<t.collabspaces[r].couples.length;a++){var s=t.collabspaces[r].couples[a];null==o&&(o=s.organization.name),o!=s.organization.name&&(e.multiOrg=!0);var l=s.role.name+"."+s.organization.name+"."+t.collabspaces[r].name;t.collabspaces[r].title||(t.collabspaces[r].title=t.collabspaces[r].name),s.organization.title||(s.organization.title=s.organization.name),s.role.nls||(s.role.nls=s.role.name);var d=t.collabspaces[r].title+" ● "+s.organization.title+" ● "+s.role.nls,c=t.collabspaces[r].title+" ● "+s.role.nls;e.security_context_list.push({value:l,withorg_nls:d,withoutorg_nls:c,collabspaceTitle:t.collabspaces[r].title})}e.serverPreferredSecurityContext||(console.log("No preferred credential on server, use the first one available"),e.serverPreferredSecurityContext=e.security_context_list[0].value)}if(!e.security_context_list.some((t=>t.value==e.preferredSecurityContext))){console.log("widget preferred credential no longer available, use server preferred credential"),e.serverPreferredSecurityContext&&(e.preferredSecurityContext=e.serverPreferredSecurityContext);e.security_context_list.find((t=>t.value==e.preferredSecurityContext))}i(e.preferredSecurityContext)},onFailure:e=>{o(e)}})}))},o.prototype.isAdmin=async function(){const e=`${this.getPlatformURL("3DSpace")}/resources/vplmte/getadmctx`;return this.executeRequest(e,{method:"GET",headers:{"Content-Type":"application/json"}}).then((e=>(e=JSON.parse(e)).credentials.some((e=>"VPLMAdmin"==e.rolename))))},o.prototype.__executeRequest=function(e,i){return t.authenticatedRequest(e,i)},o.prototype.executeRequest=async function(e,t){return new Promise(((i,n)=>{t.onComplete=function(e){i(e)},t.onFailure=function(e){n(e)},t.onTimeout=function(e){n(e)},"POST"===t.method&&"string"!=typeof t.data&&(t.data=JSON.stringify(t.data)),this.__executeRequest(e,t)}))},o})),define("DS/DocumentTableMePreferences/services/DocmDictionaryHandler",["DS/WAFData/WAFData"],(function(e){"use strict";function t(e){this.controller=e.controller,this.serviceManager=e,this.platformUrlsManager=e.platformUrlsManager}return t.prototype.getTypeInfos=function(t={preferredType:"Document",subtypes:"true",subtypesdata:"true"}){var i=this,n=this.platformUrlsManager.getPlatformURL("3DSpace");return new Promise(((o,r)=>{e.authenticatedRequest(n+"/resources/v1/modeler/documents/typeInfo/?xrequestedwith=xmlhttprequest",{method:"POST",headers:{Accept:"application/json","content-type":"application/json","Accept-Language":i.controller.options.compassConfig.lang||"en",SecurityContext:i.serviceManager.securityContext},timeout:18e4,type:"json",data:JSON.stringify(t),onComplete:function(e){o(i.formatDictionary(e))},onFailure:function(e){r(e)}})}))},t.prototype.formatDictionary=function(e){const t=e.data;if(!t)throw new Error("Invalid Data Recieved!");const i=new Map,n=new Set;let o=[];const r=new Map;if(t.Document){var a=t.Document;i.set("Document",t.Document),a.interfaces.length>0&&n.add(...a.interfaces),o=[...o,...a.attributes.interfaceAttributes]}for(let e in t)if(t.hasOwnProperty(e)){a=t[e];i.set(e,a),a.interfaces.length>0&&n.add(...a.interfaces),o=[...o,...a.attributes.interfaceAttributes]}return o.forEach((e=>{r.set(e.source+"."+e.attribute,e)})),{typeDetails:i,interfaces:Array.from(n),interfaceAttributes:r}},t})),define("DS/DocumentTableMePreferences/views/CreateViewPane",["UWA/Core","DS/Utilities/Dom","DS/Controls/Button","DS/Controls/Loader","DS/Controls/ModalContainer","i18n!DS/DocumentTableMePreferences/assets/nls/DocumentTableMePreferences","css!DS/DocumentTableMePreferences/css/CreateViewPane.css"],(function(e,t,i,n,o,r,a){const s="docm-table-mePreference-create-view-pane";function l(e,t={}){this.controller=e,this.options=t,this.elements={},this.loader=new n,this.initializeEvents(),this.isVisible=!0}return l.prototype.initializeEvents=function(){var e=this;this.controller.options.events.subscribe({event:"docm-mepreference-createViewPane"},(function(t){if("change-visibility"==t.name){var i=t.visibility;e.isVisible=i,i?e.show():e.hide(),e.finishLoading()}})),this.controller.options.events.subscribe({event:"docm-mepreference-general-events"},(function(t){"in-document-widget"==t.name&&e.elements.infocontainer&&(e.elements.infocontainer.style.display="none")}))},l.prototype.show=function(){var e=this.controller.parentCtrl.elements.container;e.hasAttribute("noview")||e.setAttribute("noview","true")},l.prototype.hide=function(){var e=this.controller.parentCtrl.elements.container;e.hasAttribute("noview")&&e.removeAttribute("noview")},l.prototype.__buildUX=function(e){var n=this;this.container=e,this.elements.content=t.createElement("div",{class:s+"-content"}),this.elements.actioncontainer=t.createElement("div",{class:s+"-action-container"}),this.elements.infocontainer=t.createElement("div",{class:s+"-information-container"}),this.elements.content.appendChild(this.elements.infocontainer),this.elements.createviewbutton=new i({label:r.CreateViewPane.createview,showLabelFlag:!0,emphasize:"primary",icon:{iconName:"plus"}}).inject(this.elements.actioncontainer),this.elements.createviewbutton.addEventListener("buttonclick",(()=>{n._onCreateNewButtonClicked()})),this.elements.noviewmessage=t.createElement("div",{class:s+"-noview-message"}),this.elements.noviewmessage.innerText=r.CreateViewPane.message1,this.elements.actioncontainer.appendChild(this.elements.noviewmessage),this.elements.infoContent=t.createElement("div",{class:s+"-information-content"}),this.elements.infoicon=t.generateIcon({iconName:"info",fontIconSize:"1x"}),this.elements.infoContent.appendChild(this.elements.infoicon),this.elements.infocontainer.appendChild(this.elements.infoContent),this.elements.infoMessageContainer=t.createElement("div",{class:s+"-information-messageContainer"}),this.elements.infocontainer.appendChild(this.elements.infoMessageContainer),this.elements.infotitle=t.createElement("div",{class:s+"-information-title"}),this.elements.infotitle.innerText=r.CreateViewPane.message2,this.elements.infoMessageContainer.appendChild(this.elements.infotitle),this.elements.infomessageitems=t.createElement("div",{class:s+"-information-messageItems"}),this.elements.infoMessageContainer.appendChild(this.elements.infomessageitems),this.elements.infomessageitem1=t.createElement("div",{class:s+"-information-messageItem"}),this.elements.infomessageitem1.innerText=r.CreateViewPane.message3,this.elements.infomessageitems.appendChild(this.elements.infomessageitem1),this.elements.infomessageitem2=t.createElement("div",{class:s+"-information-messageItem"}),this.elements.infomessageitem2.innerText=r.CreateViewPane.message4,this.elements.infomessageitems.appendChild(this.elements.infomessageitem2),this.elements.content.appendChild(this.elements.actioncontainer),this.controller.options.inDocumentManagementWidget||this.elements.content.appendChild(this.elements.infocontainer),e.appendChild(this.elements.content),this.startLoading()},l.prototype._onCreateNewButtonClicked=function(){var e=this;e.hide(),e.controller.UIComponents.topBar.__manageView("addView"),e.controller.UIComponents.topBar._validateViewName()},l.prototype.startLoading=function(){this.isLoadingInProgress||(this.isLoadingInProgress=!0,this.elements.content.style.display="none",this.loader.on(),o.createModal(this.container,this.loader.elements.container))},l.prototype.finishLoading=function(){this.isLoadingInProgress&&(this.isLoadingInProgress=!1,this.elements.content.style.display="flex",this.loader.off(),o.removeModal(this.container))},l})),define("DS/DocumentTableMePreferences/views/ViewManager",["UWA/Core","DS/Utilities/Dom","UWA/Promise","DS/Controls/Loader","DS/Controls/ModalContainer","DS/TreeModel/TreeNodeModel","DS/DataGridView/DataGridView","DS/Tweakers/GeneratedToolbar","text!DS/DocumentTableMePreferences/assets/config/DOCM_ViewManager_Config.json","text!DS/DocumentTableMePreferences/assets/config/ENXWDOC_AP_Table_MePreference_Config.json","i18n!DS/DocumentTableMePreferences/assets/nls/DocumentTableMePreferences","css!DS/DocumentTableMePreferences/css/ViewManager.css"],(function(e,t,i,n,o,r,a,s,l,d,c,m){const u="docm-table-mePreference-view-manager",p=JSON.parse(l),h=(JSON.parse(d),"functionIcon");function g(e){this.controller=e,this.viewManagerStore=e.store.getViewManagerStore(),this.options=e.options||{},this.loader=new n,this.options=Object.assign({toolbarDef:{entries:[{id:"moveUp",dataElements:{typeRepresentation:h,icon:{iconName:"up",fontIconFamily:1},value:()=>{},position:"far",category:"move",disabled:!1,visibleFlag:!0}},{id:"moveDown",dataElements:{typeRepresentation:h,icon:{iconName:"down",fontIconFamily:1},value:()=>{},position:"far",category:"move",disabled:!1,visibleFlag:!0}},{id:"moveTop",dataElements:{typeRepresentation:h,icon:{iconName:"move-to-top",fontIconFamily:1},value:()=>{},position:"far",category:"move",disabled:!1,visibleFlag:!0}},{id:"moveBottom",dataElements:{typeRepresentation:h,icon:{iconName:"move-to-bottom",fontIconFamily:1},value:()=>{},position:"far",category:"move",disabled:!1,visibleFlag:!0}}]},columns:[{dataIndex:"tree",text:c.columns.colName,sortableFlag:!1,visibleFlag:!0},{dataIndex:"pinCol",icon:{iconName:"pin",fontIconFamily:1},typeRepresentation:"customEnumMember",text:c.columns.pin,visibleFlag:!0,alignmentValue:"center",editionPolicy:"EditionOnOver",sortableFlag:!1,getCellEditableState:function(){return this.controller.store.getPermissionRights().viewedition}.bind(this),getCellSemantics:function(e){return{possibleValues:[{value:"left",label:c.ViewManager.pinLeft},{value:"right",label:c.ViewManager.pinRight},{value:"unpinned",label:""}]}}},{dataIndex:"visibleFlag",typeRepresentation:"boolean",text:c.columns.visibility,alignment:"center",icon:{iconName:"eye",fontIconFamily:1},editionPolicy:"EditionInPlace",sortableFlag:!1,getCellEditableState:function(e){return this.controller.store.getPermissionRights().viewedition}.bind(this),getCellTypeRepresentation:function(e){return e.nodeModel&&!0===e.nodeModel.options.pinColumn?"string":"boolean"}}]},this.options),this.options.attModel=this.viewManagerStore.treeDocument}return g.prototype.buildUX=function(e){var i=this;this.container=e,this.elements={},this.elements.header=t.createElement("div",{class:u+"-header"}),this.elements.content=t.createElement("div",{class:u+"-content"}),e.appendChild(this.elements.header),e.appendChild(this.elements.content);let n=t.createElement("div",{class:u+"-title"});n.innerText=c.ViewManager.title,this.elements.header.appendChild(n);let o=JSON.parse(JSON.stringify(p.defaultDGVOpts));o.columns=this.options.columns,o.treeDocument=this.options.attModel,o.onDropCell=(e,t={})=>{if(e.preventDefault(),Array.isArray(t.droppedNodes)&&t.droppedNodes[0]){var n=t.droppedNodes[0].getReferenceValue("id");i.controller.store.getSelectedView()._changeColumnPosition(n,t.rowID)}return setTimeout((()=>{i.controller.store.updateSelectedViewColumns()}),500),!0},this.elements.dgv=new a(o),this.elements.dgv.onContextualEvent=function(e){var t=[];if(e&&e.collectionView&&-1===e.cellInfos.rowID){t=e.collectionView.buildDefaultContextualMenu(e,{pin:!1,firstColumnsVisibility:!1,columnsManagement:!1,sizeColumnToFit:!0,insertRow:!1})}return t},this.__manageDragingAndReording(),this.elements.content.appendChild(this.elements.dgv.getContent()),this.initializeEvents(),this.startLoading()},g.prototype.__manageDragingAndReording=function(){this.controller.store.getPermissionRights().viewedition?(this.elements.dgv.cellDragEnabledFlag=!0,this.elements.dgv.rowDragEnabledFlag=!0,this.elements.dgv.rowReorderEnabledFlag=!0,this.elements.dgv.layoutOptions.rowsHeader=!0):(this.elements.dgv.cellDragEnabledFlag=!1,this.elements.dgv.rowDragEnabledFlag=!1,this.elements.dgv.rowReorderEnabledFlag=!1,this.elements.dgv.layoutOptions.rowsHeader=!1)},g.prototype.initializeEvents=function(){var e=this;this.controller.options.events.subscribe({event:"docm-mepreference-ensure-node-visibility"},(function(t){"ViewManager"==t.target&&e.elements.dgv.ensureNodeModelVisible(t.node,!1,!0,.2)})),this.controller.options.events.subscribe({event:"docm-mepreference-view-collection"},(function(t){"view-selected"==t.name&&(e.populateData(),e.__manageDragingAndReording())})),this.controller.options.events.subscribe({event:"docm-mepreference-selection-changed"},(function(t){"ViewManager"==t.source&&e.updateToolbarVisiblity()}))},g.prototype.populateData=function(){var e=this;this.ready=!1,this.readyPromise=i.deferred(),this.startLoading(),Promise.all([e.controller.serviceManager.loadDocumentDictionary(),e.controller.serviceManager.loadPreferences()]).then((t=>{t[0];var i=t[1];e.syncViewManagerWithSelectedView(i)}))},g.prototype.syncViewManagerWithSelectedView=function(e){var t=this;t.startLoading();var i=t.controller.store.getSelectedView();i&&t.controller.UIComponents.attributeManager.ensureReady().then((()=>{t.viewManagerStore.treeDocument.withTransactionUpdate((function(){t.viewManagerStore.refresh(),i.getValue().columns.forEach((e=>{if("CommonAttribute"!=e.type&&!t.controller.store.attributeManagerStore.uniqueAttributeNodes.has(e.id))return;const i=new r({icons:[{iconName:"object-instance",fontIconFamily:1}],label:"CommonAttribute"==e.type?c.get("columnsNls")[e.nlsKey]:t.controller.store.attributeManagerStore.uniqueAttributeNodes.get(e.id).getReferenceLabel(),type:e.type,grid:{id:e.id,label:"CommonAttribute"==e.type?c.get("columnsNls")[e.nlsKey]:t.controller.store.attributeManagerStore.uniqueAttributeNodes.get(e.id).getReferenceLabel(),name:e.name,nlsKey:e.nlsKey,pinCol:e.pinCol,type:e.type,curi:e.curi,visibleFlag:0!=e.visibleFlag,width:e.width}});t.viewManagerStore.attributeNodes.has(e.id)?console.error("Doc Widget: Something is wrong ! "):(t.viewManagerStore.attributeNodes.set(e.id,i),t.viewManagerStore.treeDocument.addRoot(i))}))})),t.controller.store.syncAttributeManagerWithViewManager(),t.finishLoading(),t.readyPromise.resolve(),t.ready=!0}))},g.prototype.updateToolbarVisiblity=function(){this.viewManagerStore.treeDocument.getSelectedNodes().length},g.prototype.startLoading=function(){this.isLoadingInProgress||(this.isLoadingInProgress=!0,this.loader.on(),o.createModal(this.container,this.loader.elements.container))},g.prototype.finishLoading=function(){this.isLoadingInProgress&&(this.isLoadingInProgress=!1,this.loader.off(),o.removeModal(this.container))},g})),define("DS/DocumentTableMePreferences/utils/CommonUtilities",["UWA/Utils","DS/ZipJS/deflate","DS/ZipJS/inflate"],(function(e){return{jsonZip:function(t){if(t.length>0&&"{"!==t[0]&&"["!==t[0])return t;for(var i=new ArrayBuffer(t.length),n=new Uint8Array(i),o=0;o<t.length;o++)n[o]=t.charCodeAt(o);var r=new Deflater;r.append(n);var a=r.flush(),s=String.fromCharCode.apply(null,a);return e.base64Encode(s)},jsonUnzip:function(t){if(t.length>0&&("{"===t[0]||"["===t[0]))return t;if(t.length>0&&0===t.indexOf("root,"))return"{}";var i=t;try{i=e.base64Decode(t)}catch(e){}for(var n=new ArrayBuffer(i.length),o=new Uint8Array(n),r=0;r<i.length;r++)o[r]=i.charCodeAt(r);var a=new Inflater,s=a.append(o);return a.flush(),String.fromCharCode.apply(null,s)}}})),define("DS/DocumentTableMePreferences/models/View",["UWA/Utils","DS/CoreEvents/ModelEvents","DS/DocumentTableMePreferences/utils/CommonUtilities"],(function(e,t,i){function n({id:i=e.getUUID(),value:n={},viewName:o="",viewType:r="unknown",modelEvents:a=new t}){this.id=i,this.value=n,this.modelEvents=a,this.viewType=r,this.viewName=o,this.hasUncommittedChanges=!1,this.unCommittedViewValue=void 0}return n.prototype.updateView=function(e){this.value=e},n.prototype._changeColumnPosition=function(e,t){const i=this.value.columns.findIndex((t=>t.id===e));if(-1===i||i===t||t<0||t>=this.value.columns.length)return;const[n]=this.value.columns.splice(i,1);this.value.columns.splice(t,0,n)},n.prototype.getZippedView=function(e=this.value){return i.jsonZip(JSON.stringify(e))},n.prototype.getUnZippedView=function(e){return JSON.parse(i.jsonUnzip(e))},n.prototype.getValue=function(){return this.hasUncommittedChanges&&this.unCommittedViewValue?this.unCommittedViewValue:this.value},n.prototype.getStorableFormat=function(){var e={id:this.id,value:this.value,viewName:this.viewName,viewType:this.viewType};return{id:this.id,storrableFormat:this.getZippedView(e)}},n.prototype.getClone=function(e={}){return new n({id:e.id?e.id:void 0,value:this.value,modelEvents:this.modelEvents,viewType:e.viewType?e.viewType:this.viewType,viewName:e.viewName?e.viewName:"Copyof-"+this.viewName})},n})),define("DS/DocumentTableMePreferences/services/ServiceManager",["UWA/Core","UWA/Promise","DS/DocumentTableMePreferences/services/PlatformURL","DS/DocumentTableMePreferences/services/DocmDictionaryHandler","DS/MePreferencesClientAPI/MePreferencesClientAPI"],(function(e,t,i,n,o){"use strict";function r(e){var o=this;this.controller=e,this.docmDictionaryReady=t.deferred(),this.platformUrlsReady=t.deferred(),this.preferencesReady=t.deferred(),this.platformUrlsManager=new i(this.controller.options),this.docmDictionaryHandler=new n(this),this.platformUrlsManager.initialize(this.controller.options.compassConfig).then((e=>o.platformUrlsManager.initCredentials())).then((e=>{var t=o.platformUrlsManager.getPlatformId();o.securityContext=e,o.platformUrls=o.platformUrlsManager.getTenantInfo(t),o.platformUrlsReady.resolve({securityContext:e,platformUrls:o.platformUrls})})).then((()=>Promise.all([o.docmDictionaryHandler.getTypeInfos(),o.getPreferences(),o.platformUrlsManager.isAdmin()]))).then((e=>{o.controller.options.isAdmin=e[2],o.docmDictionaryReady.resolve(e[0]),o.preferencesReady.resolve(e[1])}))}return r.prototype.initialize=async function(){await this.platformUrlsReady.promise},r.prototype.loadDocumentDictionary=async function(){return this.docmDictionaryReady.promise},r.prototype.loadPlatformUrls=async function(){return this.platformUrlsReady.promise},r.prototype.loadPreferences=async function(){return this.preferencesReady.promise},r.prototype.getPreferences=async function(e="ENXWDOC"){var t=this;return new Promise((async(e,i)=>{Promise.all([t.getAdminViews()]).then((i=>{const n=JSON.parse(i[0]);e({defaultView:"ENXWDOC_TABLE_DEFAULT"==t.controller.options.prefName&&t.controller.options.defaultJSON.view||"unset",adminViews:{...n},userViews:"ENXWDOC_TABLE_CUSTO"==t.controller.options.prefName&&t.controller.options.defaultJSON.views||{}})})).catch((e=>{i("Failed to fetch the preferences.")}))}))},r.prototype.getAdminViews=function(){const e=`${this.platformUrlsManager.getPlatformURL("3DSpace")}/resources/v1/modeler/documents/fetchDocmAdminViews`;return this.platformUrlsManager.executeRequest(e,{method:"GET",headers:{"Content-Type":"application/json"}})},r.prototype.manageAdminView=function(e,t={}){const i=`${this.platformUrlsManager.getPlatformURL("3DSpace")}/resources/v1/modeler/documents/manageDocmAdminViews`,n={method:"POST",headers:{"Content-Type":"application/json"},data:{action:e,views:t}};return this.platformUrlsManager.executeRequest(i,n)},r})),define("DS/DocumentTableMePreferences/collections/ViewCollection",["UWA/Utils","DS/CoreEvents/ModelEvents","DS/DocumentTableMePreferences/models/View","DS/DocumentTableMePreferences/utils/CommonUtilities","text!DS/DocumentTableMePreferences/assets/config/ENXWDOC_AP_Table_MePreference_Config.json"],(function(e,t,i,n,o){const r=JSON.parse(o);let a={ENXWDOC_TABLE_DEFAULT:{defaultView:!0,adminViews:!0,userViews:!1},ENXWDOC_TABLE_CUSTO:{defaultView:!1,adminViews:!0,userViews:!0}};function s({ctrl:e,modelEvents:i=new t,views:n}){this.store=e,this.modelEvents=i,this.selectedView=void 0,this.views=new Map,n&&this.loadViews(n)}return s.prototype.getView=function(e){if(this.views.has(e))return this.views.get(e);var t=[...r.defaultColumns,...r.externalColumns].map((e=>({id:e.name,type:"CommonAttribute",nlsKey:e.nlsKey,name:e.name,pinCol:e.pinned||"unpinned",curi:e.curi,visibleFlag:0!=e.visibleFlag,width:e.width})));return new i({value:{columns:t},viewName:"",viewType:"user",modelEvents:this.modelEvents})},s.prototype.updateSelectedView=function(e){if(!e)return this.selectedView=e,void this.modelEvents.publish({event:"docm-mepreference-createViewPane",data:{name:"change-visibility",visibility:!0}});this.selectedView!=e&&(this.views.has(e)?(this.selectedView=e,this.modelEvents.publish({event:"docm-mepreference-view-collection",data:{name:"view-selected",selectedView:this.views.get(e)}}),this.modelEvents.publish({event:"docm-mepreference-createViewPane",data:{name:"change-visibility",visibility:!1}})):this.updateSelectedViewConditionally())},s.prototype.getViews=function(){return Array.from(this.views.values())},s.prototype.loadCollection=function(e){var t=this,o=[],s=e.defaultView||{};if(a[t.store.controller.options.prefName].defaultView)if("unset"==s){var l=[...r.defaultColumns,...r.externalColumns].map((e=>({id:e.name,type:"CommonAttribute",nlsKey:e.nlsKey,name:e.name,pinCol:e.pinned||"unpinned",curi:e.curi,visibleFlag:0!=e.visibleFlag,width:e.width})));o.push(new i({id:"Docm_Default_View",value:{columns:l},viewName:"Default",viewType:"default",modelEvents:t.modelEvents}))}else{var d=JSON.parse(n.jsonUnzip(s.Docm_Default_View));o.push(new i({id:d.id,value:d.value,viewName:d.viewName,viewType:d.viewType,modelEvents:t.modelEvents}))}var c={...a[t.store.controller.options.prefName].adminViews&&e.adminViews||{},...a[t.store.controller.options.prefName].userViews&&e.userViews||{}};for(let e in c)if(c.hasOwnProperty(e)){var m=c[e];d=JSON.parse(n.jsonUnzip(m));o.push(new i({id:d.id,value:d.value,viewName:d.viewName,viewType:d.viewType,modelEvents:t.modelEvents}))}if(o.length>0&&t.loadViews(o),o.length>0)if(a[t.store.controller.options.prefName].defaultView)t.updateSelectedView("Docm_Default_View");else{var u=o.length>0?o[0].id:void 0;t.updateSelectedView(u)}else t.updateSelectedView(void 0)},s.prototype.updateSelectedViewConditionally=function(){this.views.has(this.selectedView)||(this.views.has("Docm_Default_View")?this.updateSelectedView("Docm_Default_View"):this.views.size>0?this.updateSelectedView(this.views.entries().next().value[0]):this.updateSelectedView(void 0))},s.prototype.loadViews=function(e=[]){var t=this,n=[];for(let d=0;d<e.length;d++){var o=e[d];if(o instanceof i)o.modelEvents=t.modelEvents,n.push(o);else if("object"==typeof o){var{id:r,viewType:a,value:s}=o,l=new i({id:r,value:s,viewType:a,modelEvents:t.modelEvents});n.push(l)}}t.addViews(n)},s.prototype.addViews=function(e=[]){for(let n=0;n<e.length;n++){var t=e[n];!t instanceof i?console.error("Failed to add View into Collection : unsupported View format!"):this.views.set(t.id,t)}e.length>0&&this.modelEvents.publish({event:"docm-mepreference-view-collection",data:{name:"views-added",newViews:e}})},s.prototype.removeViews=function(e=[]){var t=this,i=[];e.forEach((e=>{var n=t.views.get(e);n&&(t.views.delete(e),i.push(n))})),e.length>0&&this.modelEvents.publish({event:"docm-mepreference-view-collection",data:{name:"views-removed",removedViews:i}})},s.prototype.viewExists=function(e){return this.getViews().filter((t=>t.id==e||t.viewName==e)).length>0},s})),define("DS/DocumentTableMePreferences/store/Store",["UWA/Core","DS/Utilities/Utils","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/TreeModel/ModelUtils","DS/DocumentTableMePreferences/collections/ViewCollection","i18n!DS/DocumentTableMePreferences/assets/nls/DocumentTableMePreferences"],(function(e,t,i,n,o,r,a){var s={default:{ENXWDOC_TABLE_DEFAULT:{viewedition:!1,viewcreation:!1},ENXWDOC_TABLE_CUSTO_ADMIN:{viewedition:!1,viewcreation:!0},ENXWDOC_TABLE_CUSTO:{viewedition:!1,viewcreation:!0}},admin:{ENXWDOC_TABLE_DEFAULT:{viewedition:!1,viewcreation:!1},ENXWDOC_TABLE_CUSTO_ADMIN:{viewedition:!0,viewcreation:!0},ENXWDOC_TABLE_CUSTO:{viewedition:!1,viewcreation:!0}},user:{ENXWDOC_TABLE_DEFAULT:{viewedition:!1,viewcreation:!1},ENXWDOC_TABLE_CUSTO_ADMIN:{viewedition:!1,viewcreation:!0},ENXWDOC_TABLE_CUSTO:{viewedition:!0,viewcreation:!0}}};function l(e){var n=this;this.controller=e,this.serviceManager=e.serviceManager,this.viewCollection=new r({ctrl:this,modelEvents:this.controller.options.events}),this.currentView="Default",this.attributeManagerStore={treeDocument:new i({shouldBeSelected:function(e){return void 0===e.getReferenceValue("shouldBeSelected")||e.getReferenceValue("shouldBeSelected")}}),categoryNodes:new Map,uniqueAttributeNodes:new Map,typeNodes:{},intefaceNodes:new Map,refresh(){var e=this;this.treeDocument.withTransactionUpdate((function(){e.treeDocument.unselectAll(),e.treeDocument.removeRoots()})),this.categoryNodes=new Map,this.uniqueAttributeNodes=new Map,this.typeNodes={},this.intefaceNodes=new Map}},this.viewManagerStore={treeDocument:new i({shouldAcceptDrag:function(e){return n.getPermissionRights().viewedition},shouldAcceptDrop:function(e){var t=e.dropNode?.getReferenceValue("pinCol")||"unpinned",i=e.draggedTreeNodeModel?.getReferenceValue("pinCol")||"unpinned";return"middle"!==e.dropPosition&&t===i}}),attributeNodes:new Map,refresh(){var e=this;this.treeDocument.withTransactionUpdate((function(){e.treeDocument.unselectAll(),e.treeDocument.removeRoots()})),this.attributeNodes=new Map}},this.debouncedSelectionChangeCallbackForAttributeManager=t.debounce(this.__selectionChange.bind(this,"AttributeManager",this.attributeManagerStore.treeDocument),100),this.debouncedSelectionChangeCallbackForViewManager=t.debounce(this.__selectionChange.bind(this,"ViewManager",this.viewManagerStore.treeDocument),100),this.initializeEvents(),this.serviceManager.loadPreferences().then((e=>{n.viewCollection.loadCollection(e)}))}return l.prototype.initializeEvents=function(){this.attributeManagerStore.treeDocument.getXSO().onChange(this.debouncedSelectionChangeCallbackForAttributeManager),this.viewManagerStore.treeDocument.getXSO().onChange(this.debouncedSelectionChangeCallbackForViewManager),this.viewManagerStore.treeDocument.onNodeModelUpdate(this.__modelChange.bind(this,"ViewManager"))},l.prototype.getSelectedView=function(){return this.viewCollection.getView(this.viewCollection.selectedView)},l.prototype.__selectionChange=function(e,t,i){this.controller.options.events.publish({event:"docm-mepreference-selection-changed",data:{source:e,treeDocument:t,selectedNodes:t.getSelectedNodes()}})},l.prototype.__manageAttributeSwap=function(e){var t=this;if("shiftToLeft"==e){if(1===(r=this.viewManagerStore.treeDocument.getSelectedNodes()).length){var i=(a=r[0]).options.type,o=a.getAttributeValue("id");this.viewManagerStore.attributeNodes.has(o)&&(this.viewManagerStore.attributeNodes.delete(o),this.viewManagerStore.treeDocument.removeRoot(a)),(l=this.__fetchRealNodes(o,i)).forEach((e=>{e.show()})),l.length>0&&(this.attributeManagerStore.treeDocument.unselectAll(),l[0].select(),this.controller.options.events.publish({event:"docm-mepreference-ensure-node-visibility",data:{target:"AttributeManager",node:l[0]}}))}}else if("shiftToRight"==e){var r;if(1===(r=this.attributeManagerStore.treeDocument.getSelectedNodes()).length){var a;i=(a=r[0]).options.type,o=a.getAttributeValue("id");if(!this.viewManagerStore.attributeNodes.has(o)){const e=new n({icons:[{iconName:"object-instance",fontIconFamily:1}],label:a.getAttributeValue("label"),type:i,grid:{id:a.getAttributeValue("id"),label:a.getAttributeValue("label"),type:i,name:a.getAttributeValue("name"),pinCol:a.getAttributeValue("pinCol"),curi:a.getAttributeValue("curi"),visibleFlag:!0,nlsKey:a.getAttributeValue("nlsKey")}});t.viewManagerStore.attributeNodes.set(o,e);var s,l,d=t.viewManagerStore.treeDocument.getChildren();for(let e=0;e<d.length;e++)if("right"===d[e].getReferenceValue("pinCol")){s=d[e];break}s?t.viewManagerStore.treeDocument.insertBefore(e,s):t.viewManagerStore.treeDocument.addRoot(e),t.viewManagerStore.treeDocument.unselectAll(),e.select(),this.controller.options.events.publish({event:"docm-mepreference-ensure-node-visibility",data:{target:"ViewManager",node:e}}),(l=this.__fetchRealNodes(o,i)).forEach((e=>{e.unselect(),e.hide()}))}}}t.updateSelectedViewColumns()},l.prototype.__fetchRealNodes=function(e,t){var i=this,n=[];switch(t){case"CommonAttribute":case"ExtensionAttributeNode":i.attributeManagerStore.uniqueAttributeNodes.has(e)&&n.push(i.attributeManagerStore.uniqueAttributeNodes.get(e));break;case"TypeAttributeNode":for(let t in i.attributeManagerStore.typeNodes)i.attributeManagerStore.typeNodes.hasOwnProperty(t)&&i.attributeManagerStore.typeNodes[t].childNodes instanceof Map&&i.attributeManagerStore.typeNodes[t].childNodes.forEach(((t,i)=>{e===i&&n.push(t)}))}return n},l.prototype.__modelChange=function(e,t){var i=this;if("ViewManager"==e){if(t&&t.data&&t.data.nodeModel&&t.data.attributes.pinCol){var n=t.data.attributes.pinCol,r=t.data.nodeModel,a=i.__getBoundary(r),s=i.viewManagerStore.treeDocument.getChildren();if(0==s.length)return;var l=s[0],d=s[s.length-1];switch(a.lastLeft>0&&(l=s[a.lastLeft]),a.firstRight>0&&(d=s[a.firstRight]),n){case"left":o.moveNodes([r],l,{direction:-1==a.lastLeft?-1:1});break;case"right":o.moveNodes([r],d,{direction:1});break;default:"left"==t.data.previousAttributes.pinCol?o.moveNodes([r],l,{direction:1}):o.moveNodes([r],d,{direction:1})}console.log(a)}i.updateSelectedViewColumns()}},l.prototype.updateSelectedViewColumns=function(){var e=this.viewManagerStore.treeDocument.getAllDescendants().map((e=>({id:e.getReferenceValue("id"),type:e.getReferenceValue("type"),nlsKey:e.getReferenceValue("nlsKey"),name:e.getReferenceValue("name"),pinCol:e.getReferenceValue("pinCol"),curi:e.getReferenceValue("curi"),visibleFlag:e.getReferenceValue("visibleFlag")}))),t=this.getSelectedView();t.updateView({...t.getValue(),columns:e})},l.prototype.__getBoundary=function(e){var t,i={lastLeft:-1,firstRight:-1},n=this.viewManagerStore.treeDocument.getChildren();for(let r=0;r<n.length;r++){if((t=n[r]).getReferenceValue("name")!=e.getReferenceValue("name"))if("unpinned"==(o=t.getReferenceValue("pinCol"))||null==o||"right"==o){i.lastLeft=r-1,"right"==o&&(i.firstRight=r);break}}if(-1==i.firstRight)for(let r=n.length-1;r>=0;r--){var o;if((t=n[r]).getReferenceValue("name")!=e.getReferenceValue("name"))if("unpinned"==(o=t.getReferenceValue("pinCol"))||null==o||"left"==o){i.firstRight=r;break}}return i},l.prototype.syncViewManagerWithMePreference=function(){},l.prototype.syncAttributeManagerWithViewManager=function(){var e=this;e.attributeManagerStore.treeDocument.getAllDescendants().forEach((e=>{e.isHidden()&&e.show()})),e.attributeManagerStore.treeDocument.collapseAll(),e.viewManagerStore.treeDocument.getChildren().forEach((t=>{const i=t.getReferenceValue("id"),n=t.options.type;e.__fetchRealNodes(i,n).forEach((e=>{e.hide()}))}))},l.prototype.getAttributeManagerStore=function(){return this.attributeManagerStore},l.prototype.getViewManagerStore=function(){return this.viewManagerStore},l.prototype.getPermissionRights=function(){var e={viewedition:!1,viewcreation:!1},t=this.controller.options.prefName;e.prefName=t;var i=this.getSelectedView();return i?(e.viewedition=s[i.viewType][t].viewedition&&"true"!=this.controller.options.lockState,"admin"==i.viewType&&this.controller.options.isAdminOnDocmWidget&&(e.viewedition="true"!=this.controller.options.lockState),e.viewcreation="true"!=this.controller.options.lockState&&s[i.viewType][t].viewcreation,e):e},l})),define("DS/DocumentTableMePreferences/Controller",["DS/Controls/Loader","DS/Controls/ModalContainer","DS/DocumentTableMePreferences/views/CreateViewPane","DS/DocumentTableMePreferences/views/TopBar","DS/DocumentTableMePreferences/views/AttributeManager","DS/DocumentTableMePreferences/views/ViewManager","DS/DocumentTableMePreferences/services/ServiceManager","DS/DocumentTableMePreferences/store/Store","DS/Tweakers/GeneratedToolbar","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","i18n!DS/DocumentTableMePreferences/assets/nls/DocumentTableMePreferences"],(function(e,t,i,n,o,r,a,s,l,d,c,m){"use strict";function u(t,i){this.parentCtrl=t,this.options=i,this.UIComponents={},this.loader=new e,this.notificationManager=d,c.setNotificationManager(this.notificationManager),c.setStackingPolicy(5)}return u.prototype.initialize=function(){this.serviceManager=new a(this),this.store=new s(this),this.serviceManager.initialize(),this.__buildCreateViewPane(),this.__buildTopBar(),this.__buildMiddleWare(),this.__buildAttributeManagerUX(),this.__buildViewManagerUX(),this.store.getPermissionRights().viewedition?this.disableReadMode():this.enableReadMode(),this.initializeEvents()},u.prototype.initializeEvents=function(){var e=this;this.options.events.subscribe({event:"docm-mepreference-view-collection"},(function(t){"view-selected"==t.name&&(e.store.getPermissionRights().viewedition?e.disableReadMode():e.enableReadMode())}))},u.prototype.enableReadMode=function(){this.parentCtrl.elements.manager.hasAttribute("readonly")||this.parentCtrl.elements.manager.setAttribute("readonly","true")},u.prototype.disableReadMode=function(){this.parentCtrl.elements.manager.hasAttribute("readonly")&&this.parentCtrl.elements.manager.removeAttribute("readonly")},u.prototype.__ensureManagerReady=function(){return this.UIComponents.attributeManager.ready&&this.UIComponents.viewManager.ready},u.prototype.__buildTopBar=function(){this.UIComponents.topBar=new n(this),this.UIComponents.topBar.__buildUX(this.parentCtrl.elements.header)},u.prototype.__buildCreateViewPane=function(){this.UIComponents.createViewPane=new i(this),this.UIComponents.createViewPane.__buildUX(this.parentCtrl.elements.createViewPane)},u.prototype.__buildMiddleWare=function(){var e=this;let t={entries:[{id:"arrowRight",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"right",fontIconFamily:1},tooltip:{title:m.commands.addColumn.title,shortHelp:m.commands.addColumn.message},value:()=>{e.__ensureManagerReady()?e.store.__manageAttributeSwap("shiftToRight"):console.log("managers not ready")},position:"center",category:"middleware",disabled:!0,visibleFlag:!0}},{id:"arrowLeft",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"left",fontIconFamily:1},tooltip:{title:m.commands.removeColumn.title,shortHelp:m.commands.removeColumn.message},value:()=>{e.__ensureManagerReady()?e.store.__manageAttributeSwap("shiftToLeft"):console.log("managers not ready")},position:"center",category:"middleware",disabled:!0,visibleFlag:!0}}]},i=l.prototype.createTreeDocument(t);this.UIComponents.middlewareToolbar=new l({overflowManagement:"dropdown",direction:"vertical",items:i}),this.UIComponents.middlewareToolbar.getContent().addClassName("docm-table-mePreferencemiddleware-toolbar"),this.parentCtrl.elements.middlewareBar.appendChild(this.UIComponents.middlewareToolbar.getContent()),this.options.events.subscribe({event:"docm-mepreference-selection-changed"},(function(t){var i={AttributeManager:"arrowRight",ViewManager:"arrowLeft"}[t.source];i&&1===t.selectedNodes.length?e.UIComponents.middlewareToolbar.updateNodeModel(i,{disabled:!1,grid:{disabled:!1}}):e.UIComponents.middlewareToolbar.updateNodeModel(i,{disabled:!0,grid:{disabled:!0}})})),this.options.events.subscribe({event:"docm-mepreference-view-collection"},(function(t){"view-selected"==t.name&&e._updateMiddleWare()}))},u.prototype._updateMiddleWare=function(){var e=this.store.getPermissionRights();this.UIComponents.middlewareToolbar.setProperties({disabled:!e.viewedition})},u.prototype.__buildAttributeManagerUX=function(){this.UIComponents.attributeManager=new o(this),this.UIComponents.attributeManager.buildUX(this.parentCtrl.elements.attributeManager)},u.prototype.__buildViewManagerUX=function(){this.UIComponents.viewManager=new r(this),this.UIComponents.viewManager.buildUX(this.parentCtrl.elements.viewManager)},u.prototype.enableManagerUI=function(){t.removeModal(this.parentCtrl.elements.manager)},u.prototype.disableManagerUI=function(){t.createModal(this.parentCtrl.elements.manager)},u.prototype.enableUI=function(){t.removeModal(this.parentCtrl.elements.container)},u.prototype.disableUI=function(){this.loader.on(),t.createModal(this.parentCtrl.elements.container,this.loader.elements.container)},u.prototype.showNotification=function(e,t,i,n){var o={level:e,title:t,subtitle:i,message:n};this.notificationManager.addNotif(o)},u})),!widget)var widget;define("DS/DocumentTableMePreferences/DocumentTableMePreferences",["UWA/Widget","DS/CoreEvents/ModelEvents","DS/Utilities/Dom","DS/DocumentTableMePreferences/Controller","css!DS/DocumentTableMePreferences/css/DocumentTableMePreferences.css"],(function(e,t,i,n,o){"use strict";const r="docm-table-mePreference";function a(i){return this.elements={},this.options=i||{},this.options=Object.assign({events:this.options.events||new t},this.options),i.frameCntWindow.postMessage({message:"com.ds.mep:InDocmWidget"},i.mepOrigin),widget||((widget=new e).setValue("x3dAppId",i.appId),widget.setValue("x3dPlatformId",i.tenantID),widget.lang=this.options.compassConfig.lang),widget.lang=this.options.compassConfig.lang,widget.docmMePreference=this,this.options.localWindow.addEventListener("message",(async e=>{let t=e.data,i="";if(t.message&&(i=t.message),"com.ds.mep:OnOKBtnClicked_msg"===i){let e={message:"com.ds.mep:OnPrefUpdated_msg"};var n={};if(this.options.prefName===`${this.options.appId}_TABLE_DEFAULT`){var o=this.controller.store.getSelectedView().getClone({id:"Docm_Default_View",viewName:"Default",viewType:"default"}),{storrableFormat:r}=o.getStorableFormat();n.view={Docm_Default_View:r}}var a={isAdminViewsEditable:"true"!=this.controller.options.lockState&&this.controller.options.isAdminOnDocmWidget};if("true"!=this.controller.options.lockState&&this.controller.options.isAdminOnDocmWidget){var s={};this.controller.store.viewCollection.getViews().forEach((e=>{if("admin"==e.viewType){var{id:t,storrableFormat:i}=e.getStorableFormat();s[t]=i}})),a.adminViews=s}this.options.prefName===`${this.options.appId}_TABLE_CUSTO`&&(n.views={},this.controller.store.viewCollection.getViews().forEach((e=>{if("user"==e.viewType){var{id:t,storrableFormat:i}=e.getStorableFormat();n.views[t]=i}})),a.userViews=n.views),this.controller.options.inDocumentManagementWidget&&"true"!=this.controller.options.lockState&&this.options.frameCntWindow.postMessage({message:"com.ds.mep:UpdateWidgetViewManager",mePreferenceViewContent:a},this.options.mepOrigin),e.jsonData=JSON.stringify(n),this.options.frameCntWindow.postMessage(e,this.options.mepOrigin)}"com.ds.mep:addLocalViewChanges"==i&&(this.controller.options.localView=t.view),"com.ds.mep:confirmInDocmWidget"==i&&(this.controller.options.inDocumentManagementWidget=!0,this.controller.options.isAdminOnDocmWidget=t.isAdminOnDocmWidget,this.controller.options.events.publish({event:"docm-mepreference-general-events",data:{name:"in-document-widget"}}))})),this}return a.prototype.initialize=async function(){this.__buildUXSkeleton(),this.controller=new n(this,this.options),this.controller.initialize()},a.prototype.__buildUXSkeleton=function(){this.elements.container=i.createElement("div",{class:r+"-frame "}),"ENXWDOC_TABLE_CUSTO"==this.options.prefName&&this.elements.container.setAttribute("noview","true"),this.elements.createViewPane=i.createElement("div",{class:r+"-create-view-pane"}),this.elements.container.appendChild(this.elements.createViewPane),this.elements.header=i.createElement("div",{class:r+"-header"}),this.elements.container.appendChild(this.elements.header),this.elements.manager=i.createElement("div",{class:r+"-manager"}),this.elements.container.appendChild(this.elements.manager),this.elements.attributeManager=i.createElement("div",{class:r+"-attribute-manager"}),this.elements.manager.appendChild(this.elements.attributeManager),this.elements.middlewareBar=i.createElement("div",{class:r+"-middleware-bar"}),this.elements.manager.appendChild(this.elements.middlewareBar),this.elements.viewManager=i.createElement("div",{class:r+"-view-manager"}),this.elements.manager.appendChild(this.elements.viewManager),document.getElementById(this.options.targetId)?this.elements.targetDiv=document.getElementById(this.options.targetId):this.elements.targetDiv=document.getElementsByClassName(this.options.targetId)[0],this.options.creationModal?(this.options.creationModal.innerHTML="",this.options.creationModal.appendChild(this.elements.container)):(this.elements.targetDiv.innerHTML="",this.elements.targetDiv.appendChild(this.elements.container))},a}));