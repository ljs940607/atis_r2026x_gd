/*!  Copyright 2021 Dassault Systemes. All rights reserved. */
define("DS/DMUwebR3Mctrl/DMUwebR3MDropManager",["UWA/Core","UWA/Class","DS/Utilities/Dom","css!DS/DMUwebR3Mctrl/assets/css/DMUwebR3Mctrl"],(function(e,t,n){"use strict";return t.extend({init:function(t){this._parent(t);var i={},a={count:0},o=t.onDrop,r=t.openLbl;function s(e){return a.count=0,i.droparea.hide(),e.stopPropagation(),!1}function l(e){return a.count--,0===a.count&&i.droparea.hide(),e.stopPropagation(),!1}function d(e){return n.firstParentWithClass(e.target,"-dropZoneGlobal")&&e.preventDefault(),e.stopPropagation(),!1}function c(e){return a.count<=0&&i.droparea.show(),a.count++,e.stopPropagation(),!1}function u(e){if(a.count=0,i.droparea.hide(),e.stopPropagation(),!e.defaultPrevented){e.preventDefault();let t={mode:"drop",unserializedData:p(e)}.unserializedData.data.items;if(t.length>=1){const e=["Change Action","DMUValidationValidation","DMUMarkupRepReference","SIMItfSimulation","DesignSight","Requirement Specification","Requirement","Document","DIFLayout","DIFSheet","Drawing","VPMReference","VPMRepReference","R2V_Activity","R2V_FeatureOfInterest","FailureModesEffectsAnalysis"];t=t.filter((t=>e.includes(t.objectType)))}t.length>=1&&o(t)}return!1}function p(t){for(var n={data:{items:[]}},i=e.is(t.dataTransfer.types.indexOf,"function")?"indexOf":"contains",a="",o=["text/searchitems","text/plain","Text"],r=0;r<o.length&&""===a;r++){var s=t.dataTransfer.types[i](o[r]);(e.is(s,"number")&&s>=0||e.is(s,"boolean")&&!0===s)&&(a=o[r])}if(""!==a){var l=t.dataTransfer.getData(a);try{n=JSON.parse(l)}catch(e){n={data:{items:[]}}}}return n}this.manageDragAndDrop=function(t){i.container=t,i.container.addEventListener("dragenter",c),i.container.addEventListener("dragover",d),i.container.addEventListener("dragleave",l),i.container.addEventListener("dragend",s),i.container.addEventListener("drop",u);var n=i.droparea=e.createElement("div",{class:"r3mMainView-dropArea"}).inject(i.container);n.hide();for(var a=[{icon:"drag-drop",title:r}],o=0;o<a.length;o++){var p=e.createElement("div",{class:"-dropZoneGlobal ",draggable:!1}),f=e.createElement("div",{class:"-dropZone ",draggable:!1}).inject(p),m=e.createElement("div",{class:"-dropIconAndText "}).inject(f);e.createElement("i",{class:"wux-ui-3ds wux-ui-3ds-4x wux-ui-3ds-"+a[o].icon}).inject(m),e.createElement("h5",{text:a[o].title}).inject(m),p.inject(n)}}}})})),define("DS/DMUwebR3Mux/DMUwebR3Mlist",["UWA/Core","UWA/Class","DS/Utilities/Dom","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/DataGridView/DataGridView","DS/Controls/TooltipModel","DS/Controls/ProgressBar","DS/CollectionView/CollectionViewStatusBar","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/ComboBox","i18n!DS/DMUwebR3Mux/assets/nls/DMUwebR3Mux.json","css!DS/DMUwebR3Mux/assets/css/DMUwebR3Mux"],(function(e,t,n,i,a,o,r,s,l,d,c,u,p){"use strict";let f=window.WUXManagedFontIcons.Font3DS;var m,g,h,v,y=function(e,t,n,i){return m=n.options.grid.analysisStateNbKO,g=i.options.grid.analysisStateNbKO,h=n.options.grid.analysisStateDisp,v=i.options.grid.analysisStateDisp,h===v?m===g?0:m<g?-1:1:h<v?-1:1};return t.extend({init:function(t){let m,g,h,v={},b={},w=t.onSelect,S=t.onUnselect,C=t.onFiltersModified,I=t.onInfo,D=t.cbDnD,M=t.columns,x=t.parent,_=t.getFilterValues,P=t.onPublishTo3DSwym,E=t.getIsrTypes,R=t.onRelations,j=t.allowRelations,O=t.allowCopyLink,k=t.onCopyLink,T=t.allowUpdateSimulation,F=t.getCSIcomputeToken,A=t.onIssueCells,V=t.onTaskCells,U=t.onIssueAssigneesCells,L=t.onTaskAssigneesCells,N=t.onMaturityState,W=t.onAnalysisState,B=t.onMetricIssue,q=t.getR2VActivityInfo,J=t.allowMaturityState,z=t.onValidationState,X=t.allowValidationState,G=t.onUpdateSimulation,K=t.getPreviousConfig,Q={show:!1,total:[],completed:[],failed:[]},H=t.onMassCreate,Z=t.onPref,$=["private","inwork","frozen","released","obsolete","default","exists","inprogress","failed","passed","prepare","donenoko","startedwithko","startednoko","donewithko","notcomputed","create","assign","active","review","closed","notstarted","ongoing","completed","complete"],Y=[{type:l.STATUS.NB_ITEMS},{position:"far",type:l.STATUS.NB_SELECTED_ROWS}];function ee(e){return{id:e.options.grid.id,parents:e.getParents().map((function(e){return e.options.grid.id}))}}function te(t,n){let i=e.createElement("div",{class:"r3mtweaker "+n});return i.value=t,i.getStringFromValue=function(e){return e||""},i.computeContentSize=function(){let e=15;for(let t=i.childNodes.length-1;t>=0;--t)e+=i.childNodes[t].getDimensions().width;return e},i}function ne(e){if(g)return e&&e.nodeModel&&e.cellView?g.getCellDefaultTooltip(e,-1!==(e.nodeModel.options.grid.description||"").search("\n")):g.getCellDefaultTooltip(e)}function ie(e){if(!g)return;if(!e||!e.nodeModel||!e.cellView)return g.getCellDefaultTooltip(e);let t=g.getCellDefaultTooltip(e);return{getAllInformationCB:function(){return e.nodeModel.options.grid.validStateWarning?{model:{shortHelp:e.nodeModel.options.grid.validStateWarning},updateModel:!1}:t.getAllInformationCB()}}}function ae(e,t,n,i,a,o,l,d){let c;if(n){let a,o=$.indexOf(t)>-1,r=0;if("r3mCellAnalysisState_itfQueryRunning"===t?(a="r3mCellAnalysisState_itfQueryRunning",r=e&&e.nodeModel&&e.nodeModel.options.grid?e.nodeModel.options.grid.analysisStateProgress:0):a="r3mR2VCellState_itfQueryRunning"===t?"r3mR2VCellState_itfQueryRunning":"r3mCellState_"+t+i+(o?"":"_NoColor"),g._reusableCellContentManager.isRegistered(a)||g.registerReusableCellContent({id:a,buildContent:l.bind(null,n,i,o,t,d)}),r>0&&"r3mCellAnalysisState_itfQueryRunning"===t){let e=te("","r3mstatus");new s({value:r}).inject(e),c=e}else c=g.reuseCellContent(a)}e.cellView._setReusableContent(c),e.cellView.tooltipInfos=new r(o?ie(e):g.getCellDefaultTooltip(e))}function oe(t,n,i,a,o){let r=te(t,"r3mstatus");return e.createElement("span",{html:t,class:i?"r3mstatuscolored r3m"+a:""}).inject(r),o&&(r.style.textAlign="start",r.style.paddingLeft="5px"),r}function re(t){var n=e.createElement("div",{class:"spinner spinning",styles:{display:"flex","justify-content":"center",transform:"translate3d(0,0,0)"}}).inject(t);e.createElement("span",{class:"spinner-bar"}).inject(n),e.createElement("span",{class:"spinner-bar spinner-bar1"}).inject(n),e.createElement("span",{class:"spinner-bar spinner-bar2"}).inject(n),e.createElement("span",{class:"spinner-bar spinner-bar3"}).inject(n)}function se(t,n,i,a){let o=te(t,"r3mstatus");if("startedwithko"===a||"donewithko"===a){let r=e.createElement("span",{class:i?"r3mstatuscolored r3m"+a:""}).inject(o);e.createElement("span",{html:t+" "}).inject(r),e.createElement("span",{class:"wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-attention"}).inject(r),e.createElement("span",{html:" "+n}).inject(r)}else if("startedButNotIndexed"===a){let n=e.createElement("span",{class:"r3mstatuscolored r3m"+a}).inject(o);e.createElement("span",{html:t+" "}).inject(n),e.createElement("span",{class:"wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-clock"}).inject(n)}else if("computed"===a){let i=e.createElement("span",{class:"r3mstatuscolored r3m"+a}).inject(o);e.createElement("span",{html:t+" "}).inject(i),e.createElement("span",{class:"wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-interference-metric"}).inject(i),e.createElement("span",{html:" "+n}).inject(i)}else if("computedButNotIndexed"===a){let n=e.createElement("span",{class:"r3mstatuscolored r3m"+a}).inject(o);e.createElement("span",{html:t+" "}).inject(n),e.createElement("span",{class:"wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-clock"}).inject(n)}else if(a.contains("r3mCellAnalysisState_itfQueryRunning"))re(o);else if("Running"===a){let n=e.createElement("span",{class:"r3mstatuscolored r3m"+a}).inject(o);e.createElement("span",{html:t+" "}).inject(n)}else if("Queued"===a){let n=e.createElement("span",{class:"r3mstatuscolored r3mRunning"}).inject(o);e.createElement("span",{html:t+" "}).inject(n)}else e.createElement("span",{html:t,class:i?"r3mstatuscolored r3m"+a:""}).inject(o);return o}function le(e){if(!(g&&e&&e.nodeModel&&e.cellView))return;if("person"===e.nodeModel.getAttributeValue("type"))return g.defaultOnCellRequest(e);let t=e.nodeModel.options.grid;t&&void 0===t.title&&"r2vsurvey"===t.serviceId?(g._reusableCellContentManager.isRegistered("r3mR2VCellState_itfQueryRunning")||g.registerReusableCellContent({id:"r3mR2VCellState_itfQueryRunning",buildContent:function(e){let t=te(e,"r3mR2V_Running");return re(t),t}.bind(null,"r3mR2VCellState_itfQueryRunning")}),ae(e,"r3mR2VCellState_itfQueryRunning","r3mR2VCellState_itfQueryRunning",0,t.id,!1,oe,!0),q({serviceId:t.serviceId,objectId:t.id,validatedObjId:e.nodeModel._parentNode._parentNode.options.grid.id,text:e.nodeModel._parentNode._options.grid.id,i3dx:t.i3dx})):ae(e,t.title,t.title,0,t.id,!1,oe,!0)}function de(e,t){if(void 0===e||void 0===t)return-1;var n=e.replace(/[{(0-9) }]/g,""),i=t.replace(/[{(0-9) }]/g,"");if(n===p.owner||n===p.assignees||n===p.coordinators||n===p.contributors||n===p.informeduser||i===p.owner||i===p.assignees||i===p.coordinators||i===p.contributors||i===p.informeduser)return 0;const a=e.toLowerCase(),o=t.toLowerCase();return a<o?-1:a>o?1:0}function ce(e){if(!(g&&e&&e.nodeModel&&e.cellView))return;let t=e.nodeModel.options.grid,n=(t.maturity||"").split(".");n=n[n.length-1].toLowerCase().replace("_","").replace(" ",""),ae(e,n,t.maturityDisp,0,t.id,!1,oe,!1)}function ue(e){if(!(g&&e&&e.nodeModel&&e.cellView))return;let t=e.nodeModel.options.grid;ae(e,(t.validState||"").toLowerCase(),t.validStateDisp,0,t.id,!0,oe,!1)}function pe(e){if(!(g&&e&&e.nodeModel&&e.cellView))return;let t=e.nodeModel.options.grid,n=E();t.analysisState=t.analysisState?t.analysisState:"";let i="running"===t.analysisState||"unknown"===t.analysisState?"r3mCellAnalysisState_itfQueryRunning":t.analysisState;i=i||"",ae(e,-1===n.indexOf(t.type)?"":i,t.analysisStateDisp,t.analysisStateNbKO,t.id,!0,se,!1),"unknown"===t.analysisState&&n.indexOf(t.type)>-1&&W([t.id])}function fe(t){if(!(g&&t&&t.nodeModel&&t.cellView))return;let n,i=t.nodeModel.options.grid,a=i.id,o=i.validStateWarning,s=(a&&b[a]&&i.validState||"").toLowerCase(),l=E(),d="r3mCellState_validstatewarning";if(!(l.indexOf(i.type)>-1)||g.layout.getColumnVisibleFlag("analysisStateDisp")){if(l.indexOf(i.type)>-1?(s="inprogress"===s||"failed"===s&&("computed"===i.analysisState||"notcomputed"===i.analysisState||"startednoko"===i.analysisState)?"minorWarning":"majorWarning",d=d+s+i.analysisState):(s="inprogress"===s?"minorWarning":s,d+=s),o)g._reusableCellContentManager.isRegistered(d)||g.registerReusableCellContent({id:d,buildContent:function(t,n){let i=te(t,"r3mwarning");var a,o;return(a="attention",o="minorWarning"===n?"r3miconcolor":"r3mwarningcolor",e.createElement("span",{class:"wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-lg wux-ui-3ds-"+a+" "+o})).inject(i),e.createElement("span",{html:t,class:"r3mwarningtext"}).inject(i),i}.bind(null,o,s)}),n=g.reuseCellContent(d);else if(!o&&l.indexOf(i.type)>-1&&"running"===i.analysisState){if(i.analysisStateProgress>0&&("running"===i.analysisState||"unknown"===i.analysisState))return;g._reusableCellContentManager.isRegistered("r3mCellState_itfQueryRunning")||g.registerReusableCellContent({id:"r3mCellState_itfQueryRunning",buildContent:function(e){let t=te(e,"r3mwarning");return re(t),t}.bind(null,"r3mCellState_itfQueryRunning")}),n=g.reuseCellContent("r3mCellState_itfQueryRunning")}t.cellView._setReusableContent(n),t.cellView.tooltipInfos=new r(ie(t))}}function me(e){if(!g||!e||!e.nodeModel)return;let t=g.layout.getDataIndexFromColumnIndex(e.columnID);return Boolean(e.nodeModel.options.grid[t])}function ge(e){let t=e.nodeModel.options.grid;if("Issue"===t.type||"Task"===t.type)return t.r3massignees=void 0!==t.r3massignees?t.r3massignees:"running","Issue"===t.type?""===t.r3massignees||"running"===t.r3massignees||0===t.r3massignees.length?t.r3massignees:t.r3massignees.map((function(e){return{label:e.label.trim(),url:""===e.url?void 0:e.url}})):"Task"===t.type?""===t.r3massignees||"running"===t.r3massignees||0===t.r3massignees.length?t.r3massignees:t.r3massignees.map((function(e){return{label:e.label.trim(),url:""}})):void 0}function he(e){let t=e.nodeModel.options.grid;if("Task"===t.type&&(t.r3mTaskCandiAssignment=void 0!==t.r3mTaskCandiAssignment?t.r3mTaskCandiAssignment:"running","running"!==t.r3mTaskCandiAssignment))return""===t.r3mTaskCandiAssignment?t.r3mTaskCandiAssignment:t.r3mTaskCandiAssignment.map((function(e){return{label:e.label.trim(),url:""}}))}function ve(e){if(!g||!e||!e.nodeModel)return;let t=g.layout.getDataIndexFromColumnIndex(e.columnID),n=e.nodeModel.options.grid[t];return n?{url:e.nodeModel.options.grid[t+"Img"]?"":void 0,label:n}:void 0}function ye(e){w(e.map(ee))}function be(e){S(e.map(ee))}function we(){setTimeout((function(){g.reapplySortModel();var t=JSON.parse(localStorage.getItem("r3mGridFilters"));t&&t.filterModel&&!e.equals(t.filterModel,{})&&(m.setFilterModel({}),m.setFilterModel(t.filterModel))}),10)}function Se(){var e=g.getNodesXSO().get();e&&0!==e.length&&g.ensureNodeModelVisible(e[0],!1)}function Ce(t,n,i){let a=te(n,"");if(i.contains("r3mIssueState_Blank"))return a;if(i.contains("r3mCellIssue_QueryRunning"))re(a);else if("r3mIssuePriority"===g.layout.getDataIndexFromColumnIndex(t.columnID)){let t="";"High"===n?t="high wux-ui-3ds wux-ui-3ds-level-high":"Low"===n?t="low wux-ui-3ds wux-ui-3ds-level-low":"Medium"===n?t="medium wux-ui-3ds wux-ui-3ds-level-medium":"Urgent"===n&&(t="urgent wux-ui-3ds wux-ui-3ds-alert"),e.createElement("span",{class:"wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-lg wux-ui-3ds-"+t+" r3mIssuePriority"+n}).inject(a),e.createElement("span",{html:"  "+n}).inject(a)}return a}function Ie(e,t,n,i){let a,o;"r3mCellIssue_QueryRunning"===t?(o="r3mCellIssue_QueryRunning",e.cellView&&e.cellView.elements&&e.cellView.elements.KPIColorDiv&&e.cellView.elements.KPIColorDiv.hide()):o="r3mCellState_"+t+n,g._reusableCellContentManager.isRegistered(o)||g.registerReusableCellContent({id:o,buildContent:i.bind(null,e,n,t)}),a=g.reuseCellContent(o),e.cellView._setReusableContent(a),e.cellView.getContent().removeAttribute("no-tweaker")}function De(e){var t=g.columns[e.columnID].dataIndex,n=[];(n=g.getTreeDocument().getSelectedNodes().filter((function(e){return!e.options.grid.isNonEditable}))).length||n.push(e.nodeModel),m.withTransactionUpdate((function(){n.forEach((function(e){if(e.options.grid.hasOwnProperty(t)){var n={};n[t]=e.options.grid.r3mIssueApprovals,e.updateOptions({grid:n})}}))}))}function Me(e){if(!e||-1===e.rowID||!e.nodeModel)return;let t=e.nodeModel.options.grid.r3mIssueApprovals;return void 0!==t&&"running"!==t&&""!==t?"independantBoolean":void 0}function xe(e){if(!e||-1===e.rowID||!e.nodeModel)return;let t=e.nodeModel.options.grid.r3massignees;return void 0!==t&&"running"!==t&&""!==t?"user":void 0}function _e(e){if(!e||-1===e.rowID||!e.nodeModel)return;let t=e.nodeModel.options.grid.r3mTaskCandiAssignment;return void 0!==t&&"running"!==t&&""!==t?"user":void 0}function Pe(e,t){let n=void 0!==t?t:"running";if("running"!==n)return g.defaultOnCellRequest(e);Ie(e,"running"===n?"r3mCellIssue_QueryRunning":n,n,Ce)}function Ee(e){if(!(g&&e&&e.nodeModel&&e.cellView))return;let t=e.nodeModel.options.grid;"Issue"!==t.type&&"Task"!==t.type&&(t.r3massignees=""),Pe(e,t.r3massignees),"running"===t.r3massignees&&("Issue"===t.type&&U([t.id]),"Task"===t.type&&L([t.id]))}function Re(e){if(!(g&&e&&e.nodeModel&&e.cellView))return;let t=e.nodeModel.options.grid;"Issue"!==t.type&&(t.r3mIssueApprovals=t.r3mIssuePriority=t.r3mIssueResolvedBy="");var n=g.layout.getDataIndexFromColumnIndex(e.columnID);if("r3mIssueApprovals"===n)Pe(e,t.r3mIssueApprovals);else if("r3mIssueResolvedBy"===n)Pe(e,t.r3mIssueResolvedBy);else if("r3mIssuePriority"===n){t.r3mIssuePriority=void 0!==t.r3mIssuePriority?t.r3mIssuePriority:"running",Ie(e,"running"===t.r3mIssuePriority?"r3mCellIssue_QueryRunning":t.r3mIssuePriority,t.r3mIssuePriority,Ce)}"running"===t.r3mIssueResolvedBy&&A([t.id])}function je(e){if(!(g&&e&&e.nodeModel&&e.cellView))return;let t=e.nodeModel.options.grid;"Task"!==t.type&&(t.r3mTaskCandiAssignment=t.r3mTaskEstiFinDate=t.r3mTaskEstiDuration="");var n=g.layout.getDataIndexFromColumnIndex(e.columnID);"r3mTaskCandiAssignment"===n?Pe(e,t.r3mTaskCandiAssignment):"r3mTaskEstiDuration"===n?Pe(e,t.r3mTaskEstiDuration):"r3mTaskEstiFinDate"===n&&Pe(e,t.r3mTaskEstiFinDate),"running"===t.r3mTaskCandiAssignment&&V([t.id])}function Oe(e){if(e.nodeModel&&"person"===e.nodeModel.getAttributeValue("type"))return{label:e.nodeModel.getAttributeValue("fullName")}}function ke(e){if(!(g&&e&&e.nodeModel&&e.cellView))return;let t=e.nodeModel.options.grid;var n="";"NotStarted"===t.reviewContriDisplay?n=p.rvwNotStarted:"OnGoing"===t.reviewContriDisplay?n=p.rvwOnGoing:"Completed"===t.reviewContriDisplay&&(n=p.rvwCompleted),ae(e,(t.reviewContriDisplay||"").toLowerCase(),n,0,t.id,!0,oe,!1)}function Te(e,t){let n,i=this[t],a={label:i.title,grid:i},o=v[t];return i.icon&&(a.icons=[{iconPath:i.icon}]),e.search({match:function(e){e.nodeModel.options.grid.id===i.id&&(n=e.nodeModel)}}),o.forEach((e=>{e.updateOptions(a),Object.keys(i.children||{}).forEach(Te.bind(i.children,e))})),n}function Fe(e,t){let n,i=this[t],o={label:i.title,grid:i,icons:i.icons},r=v[t];i.icon&&(o.icons=[{iconPath:i.icon}]);let s=E();return-1===Q.total.indexOf(i.id)&&s.indexOf(i.type)>-1&&Q.total.push(i.id),(e.getChildren()||[]).some((e=>{if(e.options.grid.id===i.id)return n=e})),n||(n=new a(o),e.addChild(n),r?r.push(n):r=v[t]=[n]),i.noSort&&(n.sortChildren=function(e){e.isRecursive&&this.getChildren().forEach((function(t){t.sortChildren(e)}))}),r&&r.forEach((e=>{e.updateOptions(o),Object.keys(i.children||{}).forEach(Fe.bind(i.children,e))})),n}function Ae(){if(!g.getToolbar())return;g.getToolbar().updateNodeModel("filterClose",{visibleFlag:!1});let e=_();e.myselection=0,C(e)}function Ve(){let e=_(),t=p.pnlMyVal;return 1===e.myselection?t=p.pnlMySelection:1===e.owner&&(t=p.pnlOrga),t}this.updateFilterSelectionLabel=function(t,n,i){let a=i||Ve(),o=_();g.getToolbar().updateNodeModel("filterLabel",{grid:{visibleFlag:!0,data:a}}),g.getToolbar().updateNodeModel("caIcon",{visibleFlag:!!i}),(i||"removeStatusDiv"===t)&&function(t,n){if(g.getToolbar().elements.nearContainer.querySelectorAll(".r3mCAStatus").forEach((function(e){g.getToolbar().elements.nearContainer.children[1].removeChild(e)})),"removeStatusDiv"!==t)if("running"===t){let t=e.createElement("div",{class:"r3mCAStatus"});new s({shape:"spinner",height:15}).inject(t),g.getToolbar().elements.nearContainer.children[1].appendChild(t)}else{let i="rvwStatusNotStarted",a=p.rvwStatusNotStarted;"partial"===t?(i="rvwStatusNotStarted",a=p.rvwStatusPartial):"inProgress"===t?(i="rvwStatusInProgress",a=p.rvwStatusInProgress):"failed"===t?(i="rvwStatusFailed",a=p.rvwStatusFailed):"passed"===t&&(i="rvwStatusPassed",a=p.rvwStatusPassed);let o=e.createElement("div",{class:"r3mCAStatus"});o.value="";let r=e.createElement("span",{class:"r3mReviewStatusColored "+i}).inject(o);e.createElement("span",{html:a+" "}).inject(r),n&&n>0&&(e.createElement("span",{class:"wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-attention"}).inject(r),e.createElement("span",{html:" "+n.toString()}).inject(r)),g.getToolbar().elements.nearContainer.children[1].appendChild(o)}}(t,n),g.getToolbar().updateNodeModel("filterClose",{visibleFlag:!!o.myselection})},this.deleteNodes=function(e,t){let n=v[e],i=v[t];n&&i&&(1===i.length?v[t]=void 0:v[t]=v[t].filter((function(e){return e.getParent()!==n[0]})),n[0].removeChildren())},this.updateValidations=function(e,t,n,i){m.withTransactionUpdate((function(){Object.keys(e).forEach((function(e){var t=n?Te.call(this,m,e):Fe.call(this,m,e);b[e]||(b[e]=t),i&&t.expand()}),e)})),t||we()},this.updateStatusBar=function(e,t){"success"===t&&-1!==Q.completed.indexOf(e)||"failure"===t&&-1!==Q.failed.indexOf(e)||("success"===t&&-1===Q.completed.indexOf(e)?Q.completed.push(e):"failure"===t&&-1===Q.failed.indexOf(e)&&Q.failed.push(e),function(){let e=Q.total.length;if(e>0){var t=e>0?(Q.completed.length+Q.failed.length)/e*100:100;if(e-(Q.completed.length+Q.failed.length)<=0&&(Q.completed.length=Q.failed.length=0,t=100),Q.show){const e=Y.findIndex((e=>"progressId"===e.id));-1===e&&100!==t?(Y.push({type:l.STATUS.CUSTOM,id:"progressId",position:"center",dataElements:{typeRepresentation:"progress",value:t,tooltip:p.gridAnalysisFilterStatus}}),g.buildStatusBar(Y)):-1!==e&&100===t?(Y=Y.filter((e=>"progressId"!==e.id)),Q.show=!1,g.buildStatusBar(Y)):g.elements.statusBar.getNodeModelByID("progressId").updateOptions({grid:{data:t}})}}}())},this.checkFilterAndFetchValue=function(){if(!g||!m)return;let e=JSON.parse(localStorage.getItem("r3mGridFilters"));if(-1!==g.sortModel.findIndex((e=>"analysisStateDisp"===e.dataIndex||"validStateWarning"===e.dataIndex))||e&&e.filterModel&&(e.filterModel.hasOwnProperty("analysisStateDisp")||e.filterModel.hasOwnProperty("validStateWarning"))){let e=E();m.getAllDescendants().forEach((function(t){let n=t.options.grid;e.indexOf(n.type)>-1&&"unknown"===n.analysisState&&(Q.show=!0,W([n.id],!1))}))}},this.setInfoState=function(e){let t=g.getToolbar().array3[0].tweaker.elements.container,n=t.hasClassName("r3mInfoColor");n&&!e?t.removeClassName("r3mInfoColor"):!n&&e&&t.addClassName("r3mInfoColor")},this.expanReviewNode=function(e,t){setTimeout((function(){g.subscribeOnceToAllCellsRendered((function(){Object.keys(e).forEach((function(e){b[e]&&b[e].expandAll()}),e);var n=[];t&&t.objects&&t.objects.forEach((function(e){g&&g.model&&g.model.forEach((function(t){t&&t.options&&t.options.grid&&t.options.grid.id&&t.options.grid.id===e.highlightId&&n.push(t)}))})),m.withTransactionUpdate((function(){g.unselectAll(),g.setActiveCell(-1,!1,!1),n.forEach((function(e){g.selectNodeModel(e,!0,!1)})),g.ensureNodeModelVisible(n[0],!1,!0)}))}))}),30)},this.getSelectedRows=function(){return g.getNodesXSO().get().map(ee)},this.onTenantModified=function(e){let t={tree:"title",name:"name",typeDisp:"type",maturityDisp:"maturity",validStateDisp:"validState",description:"description",owner:"owner",originator:"originator",organization:"organization",dateModif:"dateModif",dateCreat:"dateCreat",collabSpace:"collabSpace"};h.forEach((n=>{n.text=e[t[n.dataIndex]?t[n.dataIndex]:n.dataIndex]}))},this.removeValidation=function(e){m.withTransactionUpdate((function(){e.forEach((function(e){b[e]&&m.removeRoot(b[e]);let t=v[e]&&v[e].indexOf(b[e]);t>-1&&v[e].splice(t,1),!v[e].length&&delete v[e],delete b[e]})),we()}))},this.removeAll=function(){g.getNodesXSO().empty(),m.empty(),v={},b={}},function(){function t(e,t){var n=e.getSize(),i=t.getSize(),a=(i.width-n.width)/2,o=(i.height-n.height)/2;e.setStyles({left:a<0?0:a,top:o<0?0:o})}function a(){let e=this.showCustomViewsDialog();function i(){Object.keys(e.buttons).forEach((function(t){e.buttons[t].removeEventListener("click",a)})),e.removeEventListener("close",i),n.removeResizeListener(x)}t(e.elements.container,x),Object.keys(e.buttons).forEach((function(t){e.buttons[t].addEventListener("click",i)})),e.addEventListener("close",i),n.addResizeListener(x,(function(){t(e.elements.container,x)}))}h=[{dataIndex:"tree",text:M.title,typeRepresentation:"user",onCellRequest:le,compareFunction:de,groupableFlag:!1,getCellValue:Oe},{dataIndex:"name",text:M.name,width:150,visibleFlag:!1,groupableFlag:!1},{dataIndex:"reviewContriDisplay",text:M.r3mReviewMemberContribution,onCellRequest:ke,width:100,groupableFlag:!1},{dataIndex:"typeDisp",text:M.type,width:150,visibleFlag:!1,groupableFlag:!1,alignment:"center"},{dataIndex:"maturityDisp",text:M.maturity,onCellRequest:ce,width:90,groupableFlag:!1},{dataIndex:"validStateDisp",text:M.validState,onCellRequest:ue,width:100,groupableFlag:!1},{dataIndex:"validStateWarning",icon:{iconName:"attention",fontIconFamily:f},onCellRequest:fe,width:60,minWidth:30,groupableFlag:!1},{dataIndex:"analysisStateDisp",text:M.analysisState,onCellRequest:pe,width:150,compareFunction:y,visibleFlag:!1,groupableFlag:!1},{dataIndex:"description",text:M.description,getCellTooltip:ne,width:300,groupableFlag:!1},{dataIndex:"owner",text:M.owner,typeRepresentation:"user",hasCellValue:me,getCellValue:ve,width:150,groupableFlag:!1},{dataIndex:"originator",text:M.originator,typeRepresentation:"user",hasCellValue:me,getCellValue:ve,width:150,visibleFlag:!1,groupableFlag:!1},{dataIndex:"organizationDisp",text:M.organization,width:100,visibleFlag:!1,groupableFlag:!1},{dataIndex:"dateModif",text:M.dateModif,typeRepresentation:"datetime",width:150,groupableFlag:!1},{dataIndex:"dateCreat",text:M.dateCreat,typeRepresentation:"datetime",width:150,visibleFlag:!1,groupableFlag:!1},{dataIndex:"r3massignees",text:M.r3mAssignees,getCellTypeRepresentation:xe,onCellRequest:Ee,getCellValue:ge,editableFlag:!1,visibleFlag:!1},{dataIndex:"collabSpace",text:M.collabSpace,visibleFlag:!1,groupableFlag:!1},{dataIndex:"r3mIssueName",text:M.r3mIssueName,editableFlag:!1,visibleFlag:!1,width:"auto"},{dataIndex:"r3mIssuePriority",text:M.r3mIssuePriority,onCellRequest:Re,typeRepresentation:"url",editableFlag:!1,visibleFlag:!0,width:"auto"},{dataIndex:"r3mIssueApprovals",text:M.r3mIssueApprovals,editionPolicy:"EditionInPlace",setCellValue:De,getCellTypeRepresentation:Me,onCellRequest:Re,editableFlag:!0,visibleFlag:!1},{dataIndex:"r3mIssueResolvedBy",text:M.r3mIssueResolvedBy,onCellRequest:Re,editableFlag:!1,visibleFlag:!1},{dataIndex:"r3mTaskCandiAssignment",text:M.r3mTaskCandiAssignment,getCellTypeRepresentation:_e,onCellRequest:je,getCellValue:he,editableFlag:!1,visibleFlag:!1},{dataIndex:"r3mTaskEstiFinDate",typeRepresentation:"datetime",text:M.r3mTaskFinDate,onCellRequest:je,editableFlag:!1,visibleFlag:!1},{dataIndex:"r3mTaskEstiDuration",text:M.r3mTaskDuration,onCellRequest:je,editableFlag:!1,visibleFlag:!1,width:"auto"}],m=new i({shouldAcceptDrag:function(){return!0},shouldAcceptDrop:function(){return!1}});var r=e.createElement("div",{class:"r3mListPlaceHolder"});e.createElement("p",{html:p.placeHolderFst,styles:{"text-align":"center"}}).inject(r);var s=e.createElement("div",{styles:{"font-weight":"normal","text-align":"center"}}).inject(r);e.createElement("span",{html:p.placeHolderSnd+" "}).inject(s),e.createElement("span",{class:"fonticon fonticon-list-filter"}).inject(s);var l={identifier:"r3mDataGridView",treeDocument:m,defaultColumnDef:{width:"auto",height:"auto",editableFlag:!1},columns:h,rowSelection:"multiple",cellSelection:{defaultValue:"none"},rowGroupingEnabledFlag:!1,sortModel:[{dataIndex:"tree",sort:"asc"}],rowDragEnabledFlag:!0,allowUnsafeHTMLContent:!1,cellDragEnabledFlag:!0,activateAllCellsRenderedEventFlag:!0,placeholder:r,recId:"r3mValidationList",onContextualEvent:async function(t){if(t){var n=[],i=t.cellInfos;if(t.collectionView&&i)if(-1===i.rowID&&-1!==i.columnID){let e=g.layout.getDataIndexFromColumnIndex(t.cellInfos.columnID);"tree"===e&&(e="label");var o=["typeDisp","maturityDisp","validStateDisp","analysisStateDisp","validStateWarning","owner"].indexOf(e)>-1?"set":"string";if(m.getFilterManager().getFilters().hasOwnProperty(e)){var r=m.getFilterManager().getFilters()[e];r&&r.defaultFilterModel&&(r.defaultFilterModel=[])}else m.getFilterManager().setPropertyFilterModel(e,{filterId:o});(n=t.collectionView.buildDefaultContextualMenu(t,{pin:!0,firstColumnsVisibility:!1,sizeColumnToFit:!0,columnsManagement:!1})).push({type:"PushItem",title:p.mnuExpandAllRows,icon:{iconName:"flow-tree-expand-down",fontIconFamily:f},action:{callback:function(){m.withTransactionUpdate((function(){Object.values(b).forEach((function(e){e.expandAll()}))}))}}}),n.push({type:"PushItem",title:p.mnuCollapseAllRows,icon:{iconName:"flow-tree-expand-up",fontIconFamily:f},action:{callback:function(){m.withTransactionUpdate((function(){Object.values(b).forEach((function(e){e.collapseAll()}))}))}}}),n.push({type:"SeparatorItem",title:""}),"label"!==e&&n.push({type:"PushItem",title:p.mnuHideCol,action:{callback:function(){g.layout.setColumnVisibleFlag(g.layout.getDataIndexFromColumnIndex(t.cellInfos.columnID),!1,{isUserInteraction:!0})}}}),n.push({type:"SeparatorItem",title:""}),n.push({type:"PushItem",title:p.mnuCustomView,action:{callback:a.bind(t.collectionView)}})}else if(-1!==i.columnID&&-1!==i.rowID){var s=g.getNodesXSO().get();s.some((function(e){return e.canBeExpanded()&&(!e.isExpanded()||e.getAllDescendants().some((function(e){return e.canBeExpanded()&&!e.isExpanded()})))}))&&n.push({type:"PushItem",title:p.mnuExpandAll,icon:{iconName:"flow-tree-expand-down",fontIconFamily:f},action:{callback:function(){m.withTransactionUpdate((function(){g.getNodesXSO().get().forEach((function(e){e.expandAll()}))}))}}}),s.some((function(e){return e.canBeExpanded()&&(e.isExpanded()||e.getAllDescendants().some((function(e){return e.canBeExpanded()&&e.isExpanded()})))}))&&n.push({type:"PushItem",title:p.mnuCollapseAll,icon:{iconName:"flow-tree-expand-up",fontIconFamily:f},action:{callback:function(){m.withTransactionUpdate((function(){g.getNodesXSO().get().forEach((function(e){e.collapseAll()}))}))}}}),n.length&&n.push({type:"SeparatorItem"});let t=j(),i=await T(),a=J(),o=X(),r=O();(t&&t.length||a&&a.length||o&&o.length)&&n.push({type:"PushItem",title:p.mnuRelations,icon:{iconName:"object-related",family:f},action:{callback:R}}),r&&r.length&&n.push({title:p.mnuShare,type:"PushItem",submenu:[{title:p.mnuPubToSwym,type:"PushItem",icon:{iconName:"logo-3dswym",family:f},action:{callback:P}},{title:p.mnuCopyLink,type:"PushItem",icon:{iconName:"link",family:f},action:{callback:k}}]}),a&&a.length&&n.push({type:"PushItem",title:p.mnuMaturity,icon:{iconName:"collaborative-lifecycle-management",family:f},action:{callback:N}}),o&&o.length&&o[0].display&&n.push({type:"PushItem",title:p.mnuValidation,icon:{iconName:"check",family:f},action:{callback:z}}),i>0&&n.push({type:"PushItem",title:p.mnuUpdateSimulation,state:2===i?"disabled":"enabled",icon:{iconName:"update",family:f},action:{callback:function(){F().then((function(t){if(0===t.countAll)G({isrJobConfig:"8"});else{let s=[];var n=8*((t.countAll>15?15:t.countAll)+1),i=0;for(n=n>=128?128:n;n>=8<<i;)s.push((8<<i).toString().concat(p.csiIsrConfigGB)),i++;let l=e.createElement("div",{class:"r3mCsiCompute"}),f=p.csiIsrUpdateIsrlbl;e.createElement("label",{text:f,styles:{"margin-bottom":"0px","font-size":"14px","font-weight":"normal"}}).inject(l);var a=K(),o=new u({elementsList:s,enableSearchFlag:!1,value:a,displayStyle:"normal"});o.inject(l),o.elements.container.setStyles({width:"5%","margin-left":"5px"});var r=new d({immersiveFrame:void 0,title:p.csiIsrUpdateIsr,content:l,modalFlag:!0,activeFlag:!1,buttons:{Ok:new c({onClick:function(){r.destroy(),G({isrJobConfig:s[o.selectedIndex].toString().replace(p.csiIsrConfigGB,"")})}}),Cancel:new c({onClick:function(){r.destroy()}})}})}}))}}})}return n}}};Object.keys(D).forEach((function(e){l[e]=D[e]})),D=null,g=new o(l),g.getContent().addClassName(l.identifier),window.__karma__&&(g.layout.addCellCoordinates=!0);var v=g.getNodesXSO();v.options.getElementID=void 0,v.onPostAdd(ye),v.onPostRemove(be),g.addEventListener("DSpointerhit",(function(e,t){e&&e.multipleHitCount>1&&t&&t.columnID>=0&&t&&t.rowID>=0&&I()})),m.onPostCollapse((function(){setTimeout((function(){g.invalidateLayout({updateCellAttributes:!1,updateCellLayout:!0,freePool:!0})}),0)})),m.onPostExpand((function(){setTimeout((function(){g.invalidateLayout({updateCellAttributes:!1,updateCellLayout:!0,freePool:!0})}),0),function(){let e=E();m.getAllDescendants().forEach((function(t){let n=t.options.grid;e.indexOf(n.type)>-1&&t.isExpanded()&&B([n.id],!1)}))}()})),m.getFilterManager().subscribe("filterModelChange",(function(){setTimeout((function(){let t=e.clone(m.getFilterManager().filterModel,!0);t=Object.keys(t).reduce(((e,n)=>(t[n].filterModel&&Object.keys(t[n].filterModel).length>0&&(e[n]=t[n]),e)),{}),localStorage.setItem("r3mGridFilters",JSON.stringify({filterModel:t})),Se()}),10)})),m.getModelEvents().subscribe({event:"sortChildren"},(function(){setTimeout((function(){Se()}),10)}));var w=e.createElement("div",{class:"r3mPanel wux-windows-window-maincontent"}).inject(x),S=e.createElement("div",{class:"wux-windows-window-header"}).inject(w);let A=Ve();g.setToolbar({entries:[{id:"caIcon",dataElements:{visibleFlag:!1,typeRepresentation:"functionIcon",icon:{iconName:"change-action wux-ui-3ds",fontIconFamily:f},position:"near"}},{id:"filterLabel",dataElements:{typeRepresentation:"string",readOnly:!0,position:"near",value:A}},{id:"filterClose",dataElements:{visibleFlag:!0,typeRepresentation:"functionIcon",icon:{iconName:"close wux-ui-3ds",fontIconFamily:f},position:"near",value:Ae}},{id:"massCreate",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"fonticon fonticon-wux-ui-3ds-review wux-ui-3ds-review DMUReviewPanelIcon",fontIconFamily:f},position:"far",value:H}},{id:"listFilter",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"list-filter",fontIconFamily:f},position:"far",value:function(){require(["DS/Controls/Button","DS/Windows/Dialog","DS/Controls/Toggle","DS/Controls/ButtonGroup"],(function(i,a,o,r){let s,l,d=e.createElement("div"),c=_(),u=e.createElement("div").inject(d);var f;let m=localStorage.getItem("R3MwebPrefs")&&JSON.parse(localStorage.getItem("R3MwebPrefs")).myselection;("1"===localStorage.getItem("R3MFromCopylink")||m)&&(f=new o({label:p.pnlMySelection,value:"idMySelection",type:"checkbox",checkFlag:1===c.myselection}).inject(u),u=e.createElement("div",{styles:{"margin-top":"10px"}}).inject(d));var g=new e.createElement("span",{class:"fonticon fonticon-3ds-who",styles:{color:c.myselection?"#BCBCBC":"#000000"}}).inject(u),h=e.createElement("label",{text:p.pnlOwner,class:c.myselection?"r3mFilterPanelDisable":"r3mFilterOwner",styles:{"margin-left":"2px"}}).inject(u);u=e.createElement("div",{styles:{"margin-left":"20px"}}).inject(d);var v=new r({disabled:c.myselection}).inject(u),y=new o({label:p.pnlMe,value:0,type:"radio",checkFlag:0===c.owner,disabled:c.myselection});v.addChild(y);var b=new o({label:p.pnlOwnByMe,value:"pnlOwnByMe",type:"checkbox",checkFlag:1===c.ownbyme,disabled:0===c.owner?1:0}),w=new o({label:p.pnlAssignToMe,value:"pnlAssignToMe",type:"checkbox",checkFlag:1===c.assigntome,disabled:0===c.owner?1:0}),S=new o({label:p.pnlWhereContribute,value:"pnlWhereContribute",type:"checkbox",checkFlag:1===c.wherecontribute,disabled:0===c.owner?1:0});b.elements.container.setStyles({marginLeft:"20px"}),w.elements.container.setStyles({marginLeft:"20px"}),S.elements.container.setStyles({marginLeft:"20px"}),v.addChild(b),v.addChild(w),v.addChild(S);var I=new o({label:p.pnlOrga,value:1,type:"radio",checkFlag:1===c.owner,disabled:c.myselection});function D(){b.getContent().dsModel.disabled=!y.checkFlag||y.disabled?1:0,w.getContent().dsModel.disabled=!y.checkFlag||y.disabled?1:0,S.getContent().dsModel.disabled=!y.checkFlag||y.disabled?1:0}v.addChild(I),b.getContent().dsModel.checkFlag=1===c.ownbyme,w.getContent().dsModel.checkFlag=1===c.assigntome,S.getContent().dsModel.checkFlag=1===c.wherecontribute,y.getContent().dsModel.checkFlag=0===c.owner,I.getContent().dsModel.checkFlag=1===c.owner,D(),u=e.createElement("div").inject(d);var M=e.createElement("span",{class:"fonticon fonticon-3ds-what",styles:{color:c.myselection?"#BCBCBC":"#000000"}}).inject(u),P=e.createElement("label",{text:p.pnlMaturity,class:c.myselection?"r3mFilterPanelDisable":"r3mFilterMaturity",styles:{"margin-left":"2px","margin-top":"10px"}}).inject(u);u=e.createElement("div",{styles:{"margin-left":"20px"}}).inject(d);var E=new o({label:p.pnlReleased,value:"idReleased",type:"checkbox",checkFlag:1===c.released,disabled:c.myselection}).inject(u),R=new o({label:p.pnlObsolete,value:"idObsolete",type:"checkbox",checkFlag:1===c.obsolete,disabled:c.myselection}).inject(u);u=e.createElement("div").inject(d);var j=e.createElement("span",{class:"fonticon fonticon-3ds-what",styles:{color:c.myselection?"#BCBCBC":"#000000"}}).inject(u),O=e.createElement("label",{text:p.pnlType,class:c.myselection?"r3mFilterPanelDisable":"r3mFilterType",styles:{"margin-left":"2px","margin-top":"10px"}}).inject(u);u=e.createElement("div",{styles:{"margin-left":"20px"}}).inject(d);var k=new o({label:p.pnlRvw,value:"idRvw",type:"checkbox",checkFlag:1===c.rvw,disabled:c.myselection}).inject(u),T=new o({label:p.pnlIsr,value:"idIsr",type:"checkbox",checkFlag:1===c.isr,disabled:c.myselection}).inject(u),F=new o({label:p.pnlMsr,value:"idMsr",type:"checkbox",checkFlag:1===c.msr,disabled:c.myselection}).inject(u),A=new o({label:p.pnlMkp,value:"idMkp",type:"checkbox",checkFlag:1===c.mkp,disabled:c.myselection}).inject(u);function V(e){return Array.isArray(e.value)?e.value[0]:e.checkFlag?1:0}function U(){n.removeResizeListener(x),s.destroy()}y&&y.addEventListener("buttonclick",(function(){D()})),I&&I.addEventListener("buttonclick",(function(){D()})),f&&f.addEventListener("buttonclick",(function(){g&&(g.style.color=f.checkFlag?"#BCBCBC":"#000000"),h&&h.setAttributes({class:f.checkFlag?"r3mFilterPanelDisable":"r3mFilterOwner"}),v&&(y.disabled=f.checkFlag?1:0,I.disabled=f.checkFlag?1:0,D()),M&&(M.style.color=f.checkFlag?"#BCBCBC":"#000000"),P&&P.setAttributes({class:f.checkFlag?"r3mFilterPanelDisable":"r3mFilterMaturity"}),j&&(j.style.color=f.checkFlag?"#BCBCBC":"#000000"),O&&O.setAttributes({class:f.checkFlag?"r3mFilterPanelDisable":"r3mFilterMaturity"}),E&&(E.disabled=f.checkFlag?1:0),R&&(R.disabled=f.checkFlag?1:0),k&&(k.disabled=f.checkFlag?1:0),T&&(T.disabled=f.checkFlag?1:0),F&&(F.disabled=f.checkFlag?1:0),A&&(A.disabled=f.checkFlag?1:0)}));var L=new i({emphasize:"primary",label:p.pnlOK,onClick:function(){U(),Q.total.length=Q.completed.length=Q.failed.length=0,C({rvw:V(k),isr:V(T),mkp:V(A),msr:V(F),ownbyme:V(b)||!V(w)&&!V(S)?1:0,assigntome:V(w),wherecontribute:V(S),owner:V(I),released:V(E),obsolete:V(R),myselection:f?V(f):0,mycreation:0})}}),N=new i({label:p.pnlCancel,onClick:U});s=e.createElement("div",{class:"wux-windows-modalDialog",styles:{}}).inject(x),l=new a({title:p.pnlTitle,ensureHeightDefinitionOnHierarchy:!0,content:d,resizableFlag:!0,height:345,position:{of:x,constraint:x},buttons:{Cancel:N,Ok:L}}),l.elements.container.inject(s),l.addEventListener("close",U),t(l.elements.container,x),n.addResizeListener(x,(function(){t(l.elements.container,x)}))}))}}},{id:"mePref",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"cog",fontIconFamily:f},position:"far",value:Z}},{id:"sidePanel",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"info",fontIconFamily:f},position:"far",value:I}}]}).inject(S);var V=e.createElement("div",{class:"wux-windows-window-content"}).inject(w);g.inject(V),n.addEventOnElement(w,w,"dimensionsChanged",(function(){var e=window.getComputedStyle(V),t=e?e.getPropertyValue("padding-top"):"";t=""===t?0:parseInt(t,10);var n=e?e.getPropertyValue("padding-bottom"):"";n=""===n?0:parseInt(n,10);var i=S.offsetHeight+t+n;V.setStyle("height",i?"calc(100% - "+i+"px)":"100%")})),g.buildStatusBar(Y)}()}})})),define("DS/DMUwebR3Mapp/DMUwebR3MappMain",[],(function(){"use strict";var e;return Object.freeze({getApp:function(t){if(e)return e;var n,i=t.widget,a=document.createElement("div");a.classList.add("appMain"),a.style.width="auto",a.style.height="100%",require(["UWA/Core","i18n!DS/DMUwebR3Mctrl/assets/nls/DMUwebR3Mctrl.json","css!DS/DMUwebR3Mux/assets/css/DMUwebR3Mux"],(function(e,t){var n=e.createElement("div",{class:"r3mWelcome"}),a=e.createElement("div",{class:"spinner spinner-lg spinning fade in",styles:{display:"flex","justify-content":"center"}}).inject(n);e.createElement("span",{class:"spinner-bar"}).inject(a),e.createElement("span",{class:"spinner-bar spinner-bar1"}).inject(a),e.createElement("span",{class:"spinner-bar spinner-bar2"}).inject(a),e.createElement("span",{class:"spinner-bar spinner-bar3"}).inject(a),e.createElement("div",{class:"r3mWelcomeText",html:t.validationLoad}).inject(n),i.setBody(n)}));var o,r=function(e){return o||(o=new Promise((function(t){e.perfoMark("requireCtrl"),require(["DS/DMUwebR3Mctrl/DMUwebR3Mctrl"],(function(o){e.perfoMeasure("requireCtrl"),e.perfoMark("buildUX");var r=o.getCtrl({id:1,parent:a});r.buildUX().then((function(){e.perfoMeasure("buildUX"),n=r,i.dispatchEvent("onWidgetAndAppReady"),t()}))}))})))};return i.addEvent("onLoad",(function(){window.top.performance.measure(i.id+"_R3M_onWidgetLoad",i.id+"_R3M_onWidgetLoad"),window.top.performance.mark(i.id+"_R3M_requireWidgetUtils"),require(["DS/DMUwebR3Mutils/DMUwebR3MwidgetUtils"],(function(e){window.top.performance.measure(i.id+"_R3M_requireWidgetUtils",i.id+"_R3M_requireWidgetUtils"),window.top.performance.mark(i.id+"_R3M_initServicesSecurityContext"),e.init({widget:i,onCompletedPlatformServices:function(t){e.perfoMeasure("initServicesSecurityContext","initServices"),t&&!0===t.success||window.console.error("TODO!!!"),r(e).then((()=>i.setBody(a)))},onCompletedSecurityContext:function(){e.perfoMeasure("initServicesSecurityContext"),n?n.refresh():r(e).then((function(){n.refresh()}))}})}))})),i.addEvent("onDestroy",(function(){n&&n.destroy(),n=null})),i.setMetas({helpPath:"DMUwebR3Mapp/assets/help"}),e=Object.freeze({})}})})),define("DS/DMUwebR3Mutils/DMUwebR3MwidgetUtils",["DS/WAFData/WAFData","DS/PlatformAPI/PlatformAPI","DS/Usage/TrackerAPI","i18n!DS/DMUwebR3Mutils/assets/nls/DMUwebR3Mutils.json"].concat([]),(function(e,t,n,i){"use strict";var a,o,r,s,l,d,c,u=[];function p(){return a&&a.lang||"en"}function f(){if(!a)throw new Error("App init not done");return r||(r=a.getValue("x3dPlatformId")),r}function m(){if(!a)throw new Error("App init not done");return s||(s=a.getValue("xPref_CREDENTIAL")),"ctx::"+s}function g(e){var t,n=f();if(!Array.isArray(o))throw new Error("Platform services not initialize yet");return o.some((function(i){if(i&&i.platformId===n)return t=i[e]})),t}function h(){return g("3DSpace")}function v(t){let n=h();if(!n)return void t.onCompleted(!1);let i=new Promise((function(e){require(["DS/ENOXWidgetPreferences/js/ENOXWidgetPreferences"].concat([]),(function(t){t.addCredentialPreferenceToWidget({usePreferredCredentials:!0},2).then((function(){m();let t=a.getPreferences(),n=[];t.length>1&&"xPref_CREDENTIAL"===t[0].name&&(n.push(t[1]),n.push(t[0]),a.setPreferences(n)),e(!0)}))}),e.bind(null,!1))})),o=new Promise((function(t){n+="/resources/modeler/pno/person?current=true&select=preferredcredentials",e.authenticatedRequest(n,{method:"GET",type:"json",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":p()},onComplete:function(e){e&&e.preferredcredentials?(l=e.preferredcredentials.organization,t(Boolean(l))):t(!1)},onFailure:function(){t(!1)}})}));Promise.all([i,o]).then((function(e){t.onCompleted(e[0]&&e[1])}))}return Object.freeze({init:function(e){return a?Promise.resolve():new Promise((function(t){a=e.widget,c=e.widget.data,d=a.id+"_R3M_",f(),m(),a.setPreferences([]),require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],(function(n){n.getPlatformServices({onComplete:function(s){n.getAppInfo({appId:a.getValue("x3dAppId"),onComplete:function(n){if(o=s,n.tenantAware){o=[];for(var l=0;l<n.platforms.length;++l)for(var d=0;d<s.length;++d)if(s[d].platformId===n.platforms[l].id){o.push(s[d]);break}}if(o&&o.length){var c=f();o.some((function(e){return e.platformId===c}))||(r=c="",o.length&&(a.setValue("x3dPlatformId",o[0].platformId),c=f())),c&&o.length>1&&a.addPreference({name:"x3dPlatformId",type:"list",label:i.x3dPlatformId,options:o.map((function(e){return{label:e.displayName,value:e.platformId}})),defaultValue:c}),e.onCompletedPlatformServices({success:Boolean(c)||"tenant"}),v({onCompleted:()=>{e.onCompletedSecurityContext(),t()}})}else e.onCompletedPlatformServices({success:"platformServices"})},onFailure:function(){e.onCompletedPlatformServices({success:"getAppInfo"}),t()}})},onFailure:function(){e.onCompletedPlatformServices({success:"getPlatformServices"}),t()}})})),a.addEvent("endEdit",(()=>{let e=a.getValue("x3dPlatformId"),t=e!==r;if(r=e,s=a.getValue("xPref_CREDENTIAL"),t){let e=new Promise((e=>{setTimeout((()=>v({onCompleted:e})),0)}));u.forEach((t=>t(e)))}}))}))},getWidget:function(){return a},getWidgetId:function(){return a.id},getWidgetAppId:function(){return a.getValue("x3dAppId")},getLang:p,getUserLogin:function(){var e=t.getUser();return e?e.login:""},getUserOrganizationName:function(){return l?l.name:""},getPlatformId:f,getPlatformIdServices:function(){return JSON.parse(JSON.stringify(o.filter((e=>e.platformId===r))))},get3DSpaceUrl:h,get3DSearchUrl:function(){return g("3DSearch")},getDOSUrl:function(){return g("dfsobjectstorage")},get3DSwymUrl:function(){return g("3DSwym")},getR2VPlatformUrl:function(){return g("r2vsurvey")},getSecurityContext:m,getDatafromContent:function(){if(!a)throw new Error("App init not done");var e={},t=[];if(void 0===a.data.X3DContentId)return e;var n=JSON.parse(a.data.X3DContentId);return n.data&&n.data.items&&n.data.items.forEach((function(e){t.push({objectId:e.objectId,objectType:e.objectType,serviceId:e.serviceId,displayName:e.displayName})})),e.obj=t,e},getWidgetData:function(){return c},onTenantModified:function(e){u.push(e)},perfoMark:function(e){window.top.performance.mark(d+e)},perfoMeasure:function(e,t){window.top.performance.measure(d+(t||e),d+e)},sendUsageProbe:function(e){var t=e.eventValue&&Number.isInteger(e.eventValue)?e.eventValue:void 0,i=e.eventValue&&!Number.isInteger(e.eventValue)?e.eventValue:void 0,o={eventCategory:"usage",eventAction:e.eventAction?e.eventAction:void 0,eventLabel:e.eventLabel?e.eventLabel:void 0,appID:a.data.appId,tenant:f()};if(o.eventCategory&&o.eventAction){void 0!==t&&(o.eventValue=t),void 0!==i&&(o.persDim={pd1:i});try{n.trackPageEvent(o)}catch(e){UWA.log("Analytics request failed : "+e)}}}})})),define("DS/DMUwebR3Mutils/DMUwebR3McancelablePromise",[],(function(){"use strict";return function(e){let t=!1,n=()=>{t=!0};const i=new Promise(((i,a)=>{n=()=>{t||i("Promise cancelled")},t?n():e(i,a)}));return i.then((e=>(t=!0,e))),i.catch((e=>(t=!0,e))),{promise:i,cancel:n}}})),define("DS/DMUwebR3Mutils/DMUwebR3MserverRequests",["DS/WAFData/WAFData","DS/DMUwebR3Mutils/DMUwebR3MwidgetUtils","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/DMUwebR3Mutils/DMUwebR3McancelablePromise","UWA/Core","i18n!DS/DMUwebR3Mutils/assets/nls/DMUwebR3Mutils.json"].concat([]),(function(e,t,n,i,a,o){"use strict";let r,s,l,d,c,u=["ds6w:label","ds6w:identifier","ds6w:type","ds6w:status","ds6wg:dmuvalidationvalidation.v_validationstate","ds6wg:dmuvalidationvalidation.V_Validation_RestrictedEdition","bo.SIMItfSimulation.V_ValidationState","ds6wg:simitfsimulation.v_itf_executionstatus","ds6w:description","ds6w:responsible","ds6w:responsibleuid","ds6w:originator","originator","ds6w:organizationResponsible","ds6w:modified","ds6w:created","ds6w:project"],p=["ds6w:label","ds6w:identifier","ds6w:type","ds6w:status","ds6wg:dmuvalidationcheck.v_validation_checkstate","bo.SIMItfSimulation.V_ValidationState","ds6w:description","ds6w:responsible","ds6w:responsibleuid","ds6w:originator","originator","ds6w:organizationResponsible","ds6w:modified","ds6w:created","ds6w:project","ds6w:priority","ds6wg:DMUValidationUser.V_ValidationUser_Contribution"],f=["icon","thumbnail_2d","preview_url"],m=200,g={"ds6w:label":"title","ds6w:identifier":"name","ds6w:type":"type","ds6w:status":"maturity","ds6wg:dmuvalidationvalidation.v_validationstate":"validState","ds6wg:dmuvalidationvalidation.V_Validation_RestrictedEdition":"validState","ds6wg:dmuvalidationcheck.v_validation_checkstate":"validState","bo.SIMItfSimulation.V_ValidationState":"validState","ds6wg:simitfsimulation.v_itf_executionstatus":"executionstate","ds6w:description":"description","ds6w:responsible":"owner","ds6w:responsibleuid":"ownerid","ds6w:originator":"originator",originator:"originatorid","ds6w:organizationResponsible":"organization","ds6w:modified":"dateModif","ds6w:created":"dateCreat","ds6w:project":"collabSpace",type_icon_url:"icon",preview_url:"thumbnail_image",resourceid:"id",physicalid:"id","ds6w:priority":"r3mIssuePriority","ds6wg:DMUValidationUser.V_ValidationUser_Contribution":"contribution"},h=1,v=0,y=[];function b(e){return e+"-"+t.getUserLogin()+"-"+Date.now()}function w(e){return new Promise((function(i){n.getNlsOfPropertiesValues(JSON.stringify(e),{tenantId:t.getPlatformId(),lang:t.getLang(),apiVersion:"R2019x",onComplete:function(t){Object.keys(t).forEach((function(e){s[e]=Object.assign(s[e]||{},t[e])})),Object.keys(e).forEach((function(t){e[t].forEach((e=>{s[t][e]||(s[t][e]=e)}))})),e["ds6w:status"]&&Object.keys(s["ds6w:status"]).forEach((e=>{e.search(".DEFAULT")>-1&&(s["ds6w:status"][e]="")})),i()},onFailure:function(){i()}})}))}function S(e){if(e){if(d.hasOwnProperty(e))return d[e];var n=t.get3DSwymUrl();return d[e]=n?n+"/api/user/getpicture/login/"+e+"/format/mini":""}}function C(e,t,n){var i={};return Object.keys(e).forEach((function(a){var o=g[a];i[o]=e[a],"ds6w:identifier"===a&&"issue"===n&&(i.r3mIssueName=e[a]),s[a]&&(s[a].hasOwnProperty([e[a]])?i[o+"Disp"]=s[a][e[a]]:(t[a]||(t[a]={values:[],objects:[]}),-1===t[a].values.indexOf(e[a])&&t[a].values.push(e[a]),t[a].objects.push(i)))})),"issue"===n&&(i.r3mIssueResolvedBy=i.r3mIssueApprovals="running"),"task"===n&&(i.r3mTaskCandiAssignment=i.r3mTaskEstiFinDate=i.r3mTaskEstiDuration="running"),i.ownerImg=S(i.ownerid),i.originatorImg=S(i.originatorid),i}function I(e,t,n){return e.map((function(e){return C(e,t,n)}))}function D(e,t){if(t)return t.validState="2"===e?"Passed":"3"===e?"Failed":"InProgress",t.validStateDisp=o["validState"+t.validState],t}function M(n){var i={Accept:"application/json","Content-Type":"application/json"};return n.securityContext&&(i.SecurityContext=n.securityContext),e.authenticatedRequest(n.url+"?tenant="+t.getPlatformId()+(n.securityContext?"&SecurityContext="+n.securityContext:"")+(n.outputFormat?"&output_format="+n.outputFormat:""),{method:n.method,type:"json",headers:n.headers?n.headers:i,data:JSON.stringify(n.data),timeout:n.timeout,onComplete:n.onComplete,onFailure:n.onFailure,onTimeout:n.onTimeout||n.onFailure})}function x(n){if(!n)return;var i=a.clone(n.config,!1);i.onComplete=n.onSuccess,i.onFailure=n.onFailure,i.method=i.verb,i.headers={Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()},n.doNotSetSecurityContextInUrl||(i.headers.SecurityContext=t.getSecurityContext()),"object"==typeof i.data&&(i.data=JSON.stringify(i.data));let o=t.get3DSpaceUrl();"r2vsurvey"===n.serviceId&&(o=t.getR2VPlatformUrl());var r=[];r.push("securityContext"),r.push(t.getSecurityContext()),r.push("tenant"),r.push(t.getPlatformId()),e.authenticatedRequest(o+"/"+n.url,i)}function _(e){var n="(";return n+='flattenedtaxonomies:"types/DMUValidationValidation"',n+=")",e.released||(n=n.concat(" AND NOT ([ds6w:status]:VPLM_SMB_Evaluation.RELEASED OR [ds6w:status]:VPLM_SMB_Evaluation_MajorRev.RELEASED)")),e.obsolete||(n=n.concat(" AND NOT ([ds6w:status]:VPLM_SMB_Evaluation.OBSOLETE OR [ds6w:status]:VPLM_SMB_Evaluation_MajorRev.OBSOLETE)")),n+=' AND [ds6w:organizationResponsible]:"'+t.getUserOrganizationName()+'"'}function P(e){var n="(";return n+=e.mkp?'flattenedtaxonomies:"types/Markup"':"",e.mkp&&n.length>1&&(n+=" OR "),n+=e.mkp?'flattenedtaxonomies:"types/DMUMarkupRepReference"':"",e.isr&&n.length>1&&(n+=" OR "),n+=e.isr?'flattenedtaxonomies:"types/SIMItfSimulation"':"",e.rvw&&n.length>1&&(n+=" OR "),n+=e.rvw?'flattenedtaxonomies:"types/DMUValidationValidation"':"",e.msr&&n.length>1&&(n+=" OR "),n+=e.msr?'flattenedtaxonomies:"types/DesignSight"':"",n+=")",e.released||(n=n.concat(" AND NOT ([ds6w:status]:VPLM_SMB_Evaluation.RELEASED OR [ds6w:status]:VPLM_SMB_Evaluation_MajorRev.RELEASED)")),e.obsolete||(n=n.concat(" AND NOT ([ds6w:status]:VPLM_SMB_Evaluation.OBSOLETE OR [ds6w:status]:VPLM_SMB_Evaluation_MajorRev.OBSOLETE)")),0===e.owner?n+=' AND [ds6w:responsibleuid]:"'+t.getUserLogin()+'"':1===e.owner&&(n+=' AND [ds6w:organizationResponsible]:"'+t.getUserOrganizationName()+'"'),n}function E(e){return{input_physical_ids:e,label:b("R3MwebIsr"),primitives:[{navigate_to_rel:{id:1,filter:{bo_type:["dsc_Model_Category_Ref"]}}},{navigate_to_rel:{id:2}},{navigate_to_sr:{id:3,filter:{semantics:["5"],role:["79"]},mode:"last"}},{navigate_to_sr:{id:4,filter:{semantics:["4"],role:["170"]},mode:"last"}},{navigate_from_rel:{id:5,filter:{rel_type:["Reference Document"],bo_type:["Issue"]}}},{navigate_from_rel:{id:7,filter:{rel_type:["Reference Document"],bo_type:["Task"]}}}],patterns:{prd:[{id:1},{id:2},{id:3}],context:[{id:1},{id:2},{id:4}],issue:[{id:5}],task:[{id:7}]},fileAttributes:f,attributes:p,version:3}}function R(e){return{input_physical_ids:e,label:b("R3MwebMsr"),primitives:[{navigate_to_rel:{id:1,filter:{bo_type:["dsc_Model_Category_Ref"]}}},{navigate_to_rel:{id:2}},{navigate_to_sr:{id:3,filter:{semantics:["5"],role:["79"]},mode:"last"}},{navigate_to_sr:{id:4,filter:{semantics:["4"],role:["170"]},mode:"last"}},{navigate_from_rel:{id:5,filter:{rel_type:["Reference Document"],bo_type:["Issue"]}}},{navigate_from_rel:{id:6,filter:{rel_type:["Reference Document"],bo_type:["Task"]}}}],patterns:{prd:[{id:1},{id:2},{id:3}],context:[{id:1},{id:2},{id:4}],issue:[{id:5}],task:[{id:6}]},fileAttributes:f,attributes:p,version:3}}function j(e){return{input_physical_ids:e,label:b("R3MwebMkp"),primitives:[{navigate_from_rel:{id:1,filter:{rel_type:["Markup"]}}},{navigate_from_rel:{id:2,filter:{rel_type:["Reference Document"],bo_type:["Issue"]}}},{navigate_from_rel:{id:3,filter:{rel_type:["Reference Document"],bo_type:["Task"]}}}],patterns:{context:[{id:1}],issue:[{id:2}],task:[{id:3}]},fileAttributes:f,attributes:p,version:3}}function O(e){return{input_physical_ids:e,label:b("R3MwebValidTo"),primitives:[{navigate_to_rel:{id:1}}],patterns:{ref:[{id:1}]},fileAttributes:f,attributes:p,version:3}}function k(e){return{input_physical_ids:e,label:b("R3MwebTic"),primitives:[{navigate_from_rel:{id:1,filter:{rel_type:["Reference Document"],bo_type:["Issue"]}}},{navigate_from_rel:{id:2,filter:{rel_type:["Reference Document"],bo_type:["Task"]}}}],patterns:{issue:[{id:1}],task:[{id:2}]},fileAttributes:f,attributes:p,version:3}}function T(e){return new Promise((function(n){M({url:t.get3DSpaceUrl()+"/cvservlet/navigate",securityContext:t.getSecurityContext(),method:"POST",data:e,onComplete:function(e){n(e)},onFailure:function(){n({})}})}))}function F(e){let n=Object.keys(e);return n.length?new Promise((e=>{M({url:t.get3DSpaceUrl()+"/cvservlet/navigate",securityContext:t.getSecurityContext(),method:"POST",data:k(n),onComplete:e,onFailure:function(){e()}})})):Promise.resolve()}const A=e=>new Promise((t=>{"DMUValidationValidation"===e.input_object["ds6w:type"]||"Markup"===e.input_object["ds6w:type"]?x({url:"resources/validation/service/getAll",config:{verb:"POST",data:{sValidationId:e.input_object.physicalid}},onSuccess:function(e){var n=JSON.parse(e);let i;n&&n.children&&n.children.forEach((e=>{"DMUValidationContext"===e.type&&e.contextURI&&(i=e.contextURI)})),function(e,t){return t?(n={contextURI:t},new Promise(((e,t)=>{x({url:"enovia/resources/r2v/modeler/v2/i3dx/fetch",serviceId:"r2vsurvey",doNotSetSecurityContextInUrl:!0,config:{verb:"POST",data:{data:[{"ds6w:i3dx":n.contextURI}]}},onSuccess:function(n){try{const i=JSON.parse(n);if(i?.error?.[0]?.error?.message)return void t(i.error[0].error.message);e(i)}catch(e){t(e)}},onFailure:t,onTimeout:t})}))).then((t=>(e.children.forEach((e=>{"DMUValidationContext"===e.type&&(e.serviceID=t.data[0]["ds6w:dataSource"],e.contextId=t.data[0].resourceid)})),e))):Promise.resolve(e);var n}(n,i).then((e=>{t(e)}))},onFailure:function(){t()}}):"DMUMarkupRepReference"===e.input_object["ds6w:type"]?x({url:"resources/markup/service/getMarkup",config:{verb:"POST",data:{sMarkupId:e.input_object.physicalid}},onSuccess:function(n){var i=JSON.parse(n);x({url:"/cvservlet/fetch/v2",config:{verb:"POST",data:{physicalid:i.MarkupContext.contextId?i.MarkupContext.contextId:i.MarkupContext.contextIds,label:"M3DFetchForWelcomePanel"+Date.now(),select_predicate:u,select_file:f}},onSuccess:function(n){var a=JSON.parse(n),o=[],r={physicalid:i.MarkupContext.contextId};a.results[0].attributes.forEach((function(e){r[e.name]=e.value})),o.push(r),e.outputs.context=o,t(e)},onFailure:function(){t()}})},onFailure:function(){t()}}):t()}));function V(e){return new Promise((function(n){M({url:t.get3DSpaceUrl()+"/cvservlet/navigate",securityContext:t.getSecurityContext(),method:"POST",data:e,onComplete:function(e){var t={},i={},a=[],o=[],r=[],l={};e.result.forEach((function(e){var n=e.input_object.physicalid;t[n]={},["context","highlight","check","issue","ca","task","coordinators","assignees","contributors","informeduser","contribution"].forEach((function(a){e.outputs[a]&&(t[n][a]=I(e.outputs[a],i,a))})),(t[n].highlight||[]).forEach((e=>{l[e.id]=e})),(t[n].check||[]).forEach((e=>D(e.validState,e))),(e.outputs.checked||[]).forEach((function(e){let a=e.owner.physicalid;(t[n].check||[]).some((t=>{if(!t.children)return t.id===a?(t.children=I(e.elements,i),!0):void 0}))})),t[n].assignees&&t[n].assignees.length>0||t[n].coordinators&&t[n].coordinators.length>0||t[n].contributors&&t[n].contributors.length>0||t[n].informeduser&&t[n].informeduser.length>0?(t[n].members=[],function(e,t){var n={};["owner","coordinators","assignees","contributors","informeduser"].forEach((function(i){var a=[];if("owner"===i){if(e&&e.input_object){var o={},r=e.input_object;r["ds6w:responsibleuid"]&&(o.user=r["ds6w:responsibleuid"]),r["ds6w:responsible"]&&(o.fullName=r["ds6w:responsible"]),a.push(o)}}else(t[i]||[]).forEach((function(e){var n={};Object.keys(e).forEach((function(i){"name"===i&&(n.contribution=function(e,t){for(var n="",i=0;i<e.length;i++)if(e[i].title===t&&e[i].contribution){n="Undefined"===e[i].contribution?"":e[i].contribution;break}return n}(t.contribution,e[i]),n.user=e[i]),"title"===i&&(n.fullName=e[i]),"type"===i&&(n.type=e[i]),"id"===i&&(n.id=e[i])})),a.push(n)}));n[i]=a,"owner"!==i&&delete t[i]})),t.members.push(n)}(e,t[n]),delete t[n].contribution):(delete t[n].assignees,delete t[n].coordinators,delete t[n].contributors,delete t[n].informeduser,delete t[n].contribution),e.outputs.validatedPath&&(t[n].validatedPath=[],e.outputs.validatedPath.forEach((function(e){if(!e.elements.length)return;let i=e.elements[0]["ds6w:type"],r="VPMInstance"===i||"VPMRepInstance"===i;t[n].validatedPath[e.app_index||e.sr_id]=e.elements.map((function(e,t){return r&&(0===t&&-1===a.indexOf(e.physicalid)&&a.push(e.physicalid),-1===o.indexOf(e.physicalid)&&o.push(e.physicalid)),e.pid=e.physicalid,e.type=e["ds6w:type"],e})),t[n].validatedPath[e.app_index||e.sr_id].instancePath=r})),t[n].validatedPath=t[n].validatedPath.filter((function(e){return e&&e.length})),t[n].validatedPath.length&&r.push(t[n])),e.outputs.prd&&(t[n].context=(t[n].context||[]).concat(I(e.outputs.prd,i)))}));const d=[];e.result.map((e=>{void 0===e.outputs.context&&d.push(A(e))}));const c=[];e.result.map((e=>{void 0===e.outputs.context&&"DMUMarkupRepReference"===e.input_object["ds6w:type"]&&c.push(A(e))})),Promise.all([0===c.length?Promise.resolve():Promise.all(c)]).then((function(e){var c;e[0]&&e[0].forEach((function(e){t[e.input_object.physicalid].context=I(e.outputs.context,i)})),Promise.all([a.length?T((c=a,{input_physical_ids:c,label:b("R3MwebValidFrom"),primitives:[{navigate_from_rel:{id:1}}],patterns:{root:[{id:1}]},fileAttributes:f,attributes:p,version:3})):Promise.resolve(),o.length?T(O(o)):Promise.resolve(),F(l),0===d.length?Promise.resolve():Promise.all(d)]).then((function(e){var n={},a={},o={};(e[0]&&e[0].result||[]).forEach((function(e){n[e.input_object.physicalid]={pid:e.outputs.root[0].physicalid,type:e.outputs.root[0]["ds6w:type"]},o[e.outputs.root[0].physicalid]||(o[e.outputs.root[0].physicalid]=e.outputs.root[0])})),(e[1]&&e[1].result||[]).forEach((function(e){a[e.input_object.physicalid]={pid:e.outputs.ref[0].physicalid,type:e.outputs.ref[0]["ds6w:type"]},o[e.outputs.ref[0].physicalid]||(o[e.outputs.ref[0].physicalid]=e.outputs.ref[0])})),r.forEach((function(e){e.validated=[],e.validatedPath.forEach((function(t,r){let s;if(t.instancePath){s=C(o[a[t[t.length-1].pid].pid],i);var l=[n[t[0].pid]];t.forEach((function(e){l.push(e),l.push(a[e.pid])})),s.validatedPath=l}else s=C(t[t.length-1],i),s.validatedPath=t;e.validated[r]=s,s.pid=s.id,s.id=String(h++)})),delete e.validatedPath})),(e[2]&&e[2].result||[]).forEach((e=>{let t=e.input_object.physicalid;["issue","ca","task"].forEach((n=>{e.outputs[n]&&(l[t][n]=I(e.outputs[n],i))}))})),(e[3]||[]).forEach((e=>{void 0!==e&&void 0!==e.children&&e.children.forEach((n=>{n&&"DMUValidationContext"===n.type&&void 0===t[e.id].context&&(t[e.id].context=[{id:n.contextId,serviceId:n.serviceID}],t[e.id].validated=[{id:n.contextId,serviceId:n.serviceID}],"r2vsurvey"===n.serviceID&&(t[e.id].context[0].i3dx=t[e.id].validated[0].i3dx=n.contextURI,t[e.id].validated[0].type=t[e.id].context[0].type="R2V_Activity"))}))}))})).then((function(){Object.keys(i).length?new Promise((function(){var e={};Object.keys(i).forEach((function(t){e[t]=i[t].values})),w(e).then((function(){Object.keys(i).forEach((function(e){i[e].objects.forEach((function(t){var n=g[e];t[n+"Disp"]=s[e][t[n]]}))})),n(t)}))})):n(t)}))}))},onFailure:function(){n({})}})}))}var U,L,N,W,B=(U=[],L=0,N=function(e,t){L--,B(),t(e)},W=function(e){var n,i,o=a.clone(e,!1);o.onComplete=function(t){N(t,e.onComplete)},o.onFailure=function(t){N(t,e.onFailure)},o.onTimeout=function(t){N(t,e.onTimeout||e.onFailure)},n=o,M({url:t.get3DSpaceUrl()+"/cvservlet/navigate",securityContext:t.getSecurityContext(),method:"POST",timeout:6e4,data:(i=n.ctxIDs,{input_physical_ids:i,label:b("R3MPIMwebItfCtx"),primitives:[{navigate_to_sr:{id:1,filter:{semantics:["6"],role:["198"]},mode:"last"}},{navigate_to_rel:{id:2}}],patterns:{ms:[{id:1}]},attributes:["ds6w:type","bo.PLMPIMMetricReference.V_Itf_Type","bo.PLMPIMMetricReference.V_Itf_Analysis","bo.SIMItfContextOfInterference.V_Context_Validity_Status"],fileAttributes:[],version:3}),onProgress:n.onProgress,onComplete:n.onComplete,onFailure:n.onFailure})},function(e){e&&U.push(e),U.length&&L<5&&(L++,W(U.shift()))});function q(e){return{input_physical_ids:e,label:b("R3MPIMwebIsr"),primitives:[{navigate_to_rel:{id:1,filter:{bo_type:["dsc_Result_Category_Ref"]}}},{navigate_to_rel:{id:2}}],patterns:{itfCtxt:[{id:1},{id:2}]},fileAttributes:[],attributes:["ds6wg:simitfsimulation.v_itf_executionstatus"],version:3}}function J(e,n){var i={simPid:e,nbOK:0,nbKO:0};M({url:t.get3DSpaceUrl()+"/cvservlet/navigate",securityContext:t.getSecurityContext(),method:"POST",timeout:6e4,data:q(e),onComplete:function(e){let t=e.result[0];if(!t||0===Object.keys(t.outputs).length)return void n({status:"KO",issues:{},tasks:{}});let a=(t.outputs.itfCtxt||[]).map((function(e){return e.physicalid})),o=[];if(0!==a.length){i.nbTotalItf=a.length;for(var r=Math.floor((a.length-1)/500)+1,s=0,l=[];s<r;)B({ctxIDs:a.slice(500*s,500*(s+1)),type:"MetricIssue",onComplete:function(e){var t=[];e.result.forEach((function(e){if(e.outputs&&e.outputs.ms&&1===e.outputs.ms.length){if(o.indexOf(e.outputs.ms[0].physicalid)>-1)return;o.push(e.outputs.ms[0].physicalid)}t.push(e.input_object.physicalid)})),d({itfIDs:t})},onFailure:function(){}}),s++}else n({status:"KO",issues:{},tasks:{}});function d(e){var t,i,r;l.push.apply(l,e.itfIDs),t=o,i=n,r=l.length/a.length,V(E(t)).then((function(e){let t={},n={};Object.keys(e).forEach((function(i){-1!==Object.keys(e[i]).indexOf("issue")&&e[i].issue.forEach((function(e){t[e.id]=e})),-1!==Object.keys(e[i]).indexOf("task")&&e[i].task.forEach((function(e){n[e.id]=e}))})),i({status:"OK",issues:t,tasks:n,completed:parseInt(100*r)})}))}},onFailure:function(){}})}function z(e){return new Promise((function(n){M({url:t.get3DSpaceUrl()+"/resources/dictionary/getTypeInfo",method:"POST",data:[e],onComplete:function(t){Object.keys(t).forEach((function(t){-1===l[e].indexOf(t)&&l[e].push(t)})),n()},onFailure:n})}))}function X(){return c?Promise.resolve():(d={},r={},s={"ds6w:type":{},"ds6w:status":{},"ds6wg:dmuvalidationvalidation.v_validationstate":{},"ds6w:priority":{}},l={DMUValidationValidation:["DMUValidationValidation"],SIMItfSimulation:["SIMItfSimulation"],Markup:["Markup"],DMUMarkupRepReference:["DMUMarkupRepReference"],DesignSight:["DesignSight"]},Promise.all([z("DMUValidationValidation"),z("SIMItfSimulation"),new Promise((function(e){n.getResourcesInfo(u.join(","),{tenantId:t.getPlatformId(),lang:t.getLang(),apiVersion:"R2019x",onComplete:function(t){(t||[]).forEach((function(e){r[g[e.curi]]=e.label})),r.validState=o.validState,r.analysisState=o.analysisState,r.r3mIssueName=o.r3mIssueName,r.r3mIssueApprovals=o.r3mIssueApprovals,r.r3mIssuePriority=o.r3mIssuePriority,r.r3mIssueResolvedBy=o.r3mIssueResolvedBy,r.r3mReviewMemberContribution=o.r3mReviewMemberContribution,r.r3mTaskCandiAssignment=o.r3mTaskCandiAssignment,r.r3mTaskFinDate=o.r3mTaskFinDate,r.r3mTaskDuration=o.r3mTaskDuration,r.r3mAssignees=o.r3mAssignees,e(r)},onFailure:function(){u.forEach((function(e){r[g[e]]=e})),e(r)}})})),w({"ds6w:type":["SIMItfSimulation","DMUValidationValidation","Markup","DMUMarkupRepReference","VPMReference","Requirement","DMUValidationExposedPresentation","Member List","Drawing","ENOStrRefinementSpecification","DMUValidationCheck"],"ds6w:organizationResponsible":["MyCompany","My Company","Company Name"],"ds6w:status":["VPLM_SMB_Evaluation.PRIVATE","VPLM_SMB_Evaluation.IN_WORK","VPLM_SMB_Evaluation.FROZEN","VPLM_SMB_Evaluation.RELEASED","VPLM_SMB_Evaluation.OBSOLETE","VPLM_SMB_Definition.PRIVATE","VPLM_SMB_Definition.IN_WORK","VPLM_SMB_Definition.FROZEN","VPLM_SMB_Definition.RELEASED","VPLM_SMB_Definition.OBSOLETE","VPLM_SMB_Evaluation_MajorRev.PRIVATE","VPLM_SMB_Evaluation_MajorRev.IN_WORK","VPLM_SMB_Evaluation_MajorRev.FROZEN","VPLM_SMB_Evaluation_MajorRev.RELEASED","VPLM_SMB_Evaluation_MajorRev.OBSOLETE","VPLM_SMB_Definition_MajorRev.PRIVATE","VPLM_SMB_Definition_MajorRev.IN_WORK","VPLM_SMB_Definition_MajorRev.FROZEN","VPLM_SMB_Definition_MajorRev.RELEASED","VPLM_SMB_Definition_MajorRev.OBSOLETE"],"ds6w:priority":["Low","Medium","High","Urgent"]})]).then((function(){c=!0})))}t.onTenantModified((()=>{c=!1,X().then((()=>y.forEach((e=>e()))))}));var G=Object.create({}),K=Object.getPrototypeOf(G);return Object.defineProperty(K,"_NB_SEARCH_RESULTS",{get:()=>m,set:e=>{m=e}}),K.getColumnsNls=function(){return X().then((function(){return r}))},K.getRvwTypes=function(){return[].concat(l.DMUValidationValidation)},K.getIsrTypes=function(){return[].concat(l.SIMItfSimulation)},K.getMkpTypes=function(){return[].concat(l.Markup)},K.getNewMkpTypes=function(){return[].concat(l.DMUMarkupRepReference)},K.getMsrTypes=function(){return[].concat(l.DesignSight)},K.getMaturityNlsValue=e=>s["ds6w:status"][e]||"",K.getValidStateNlsValue=e=>o["validState"+e],K.getAnalysisStateNlsValue=e=>o["analysisState"+e],K.updateCheckStateValue=D,K.search=function(e,n,a){let r=[],l=new i((function(i){if(v++,!(e.rvw||e.isr||e.mkp||e.msr||e.isOnlyRvw))return n({},0),void i();!function l(d,c,p){var h={query:e.isOnlyRvw?_(d):P(d),locale:t.getLang(),tenant:t.getPlatformId(),nresults:m,label:b("R3MwebSearch_"+v),select_predicate:u,select_file:f,with_synthesis:!1,with_synthesis_attribute:!1,with_nls:!0,login:{"3dspace":{SecurityContext:t.getSecurityContext()}},source:["3dspace"]};h[0===c?"start":"next_start"]=c,r.push(M({url:t.get3DSearchUrl()+"/search",method:"POST",data:h,onComplete:function(t){var a={};(t.results||[]).forEach((function(e){if(e&&e.attributes){var t={};e.attributes.forEach((function(e){var n=(e.name||"bug").split("/"),i=n[n.length-1];if(g[i])if("ds6w:type"===i)t.type=e.value,t.typeDisp=e.dispValue;else if("ds6w:status"===i){t.maturity=e.value;var a=s["ds6w:status"][e.dispValue||e.value];t.maturityDisp=a||(e.dispValue||e.value)}else"ds6wg:dmuvalidationvalidation.v_validationstate"===i?(t.validState=e.value,t.validStateDisp=o["validState"+e.value]):"ds6wg:dmuvalidationvalidation.V_Validation_RestrictedEdition"===i?(t.restrictedEdition=e.value,t.restrictedEditionDisp=e.dispValue||e.value):"bo.SIMItfSimulation.V_ValidationState"===i?(t.validState=e.value,t.validStateDisp=o["validState"+e.value]):"ds6wg:simitfsimulation.v_itf_executionstatus"===i?t.executionState=e.value:"ds6w:organizationResponsible"===i?(t.organization=e.value,t.organizationDisp=s["ds6w:organizationResponsible"][e.dispValue||e.value],t.organizationDisp=t.organizationDisp?t.organizationDisp:e.dispValue||e.value):t[g[i]]=e.dispValue||e.value})),t.analysisState="unknown",t.analysisStateDisp="",t.analysisStateNbKO=0,t.analysisStateProgress=0,t.r3massignees="",t.ownerImg=S(t.ownerid),t.originatorImg=S(t.originatorid),t.id&&(a[t.id]=t)}})),n(a,p),t.infos.nresults?l(e,t.infos.next_start,++p):i()},onFailure:function(){a(),i()}}))}(e,0,0)}));return l.promise.then((e=>(e&&r.forEach((e=>e.cancel())),e))),l},K.getDOSDownloadUrl=function(e,n){var i={method:"POST",headers:{Accept:"*/*","Content-Type":"application/json"}};i.data=JSON.stringify([e]),i.onComplete=function(e){n(JSON.parse(e)[0].url)},i.onFailure=function(){n(null)},require("DS/WAFData/WAFData").authenticatedRequest(t.getDOSUrl()+"/webservices/batch/fileurls",i)},K.getUserInfo=function(e){return new Promise((function(n){M({url:t.get3DSpaceUrl()+"/resources/modeler/pno/person/"+e,method:"GET",securityContext:t.getSecurityContext(),onComplete:function(e){n(e)},onFailure:function(){n(null)}})}))},K.fetchContext=function(e,t,n){return new Promise((i=>{if(0===e.ids.length&&0===e.uris.length)return t(),i();function a(){if(0===e.uris.length)return i();x({url:"enovia/resources/r2v/modeler/v2/i3dx/fetch",serviceId:"r2vsurvey",doNotSetSecurityContextInUrl:!0,config:{verb:"POST",data:{data:[{"ds6w:i3dx":e.uris[0]}]}},onSuccess:function(e){t(JSON.stringify({...JSON.parse(e),serviceId:"r2vsurvey"})),i()},onFailure:function(){n(),i()}})}e.ids.length>=1?x({url:"cvservlet/fetch/v2",config:{verb:"POST",data:{physicalid:e.ids,label:"M3DFetchForCreated"+Date.now(),select_predicate:u,select_file:f}},onSuccess:function(e){t(e),a()},onFailure:function(){n(),i()}}):a()}))},K.getReviewInfo=A,K.getValuesNls=function(e,t){return s[e]?s[e][t]:""},K.getUserImage=S,K.getReviewAttributes=function(e){return new Promise((function(n){M({url:t.get3DSpaceUrl()+"/resources/v1/collabServices/attributes/op/read",method:"POST",securityContext:t.getSecurityContext(),data:{lIds:e,relIDs:[],busIDs:[],plmparameters:"false",attributes:"true",navigateToMain:"false",readonly:"true"},onComplete:function(e){n(e)},onFailure:function(){n(null)}})}))},K.evalAnalysisStatus=function(e,n,i){!function(e,n,i){var a={simPid:e,nbTotalItf:0,nbOK:0,nbKO:0,nbPrev:0};M({url:t.get3DSpaceUrl()+"/cvservlet/navigate",securityContext:t.getSecurityContext(),method:"POST",timeout:6e4,data:q(e),onComplete:function(t){let o=t.result[0];if(!o||0===Object.keys(o.outputs).length)return o.input_object["ds6wg:simitfsimulation.v_itf_executionstatus"]&&(a.ExecStatus=o.input_object["ds6wg:simitfsimulation.v_itf_executionstatus"]),void n({status:"success",output:[a]});let r=(o.outputs.itfCtxt||[]).map((function(e){return e.physicalid})),s=[];a.ExecStatus=o.input_object["ds6wg:simitfsimulation.v_itf_executionstatus"],0===r.length&&n({status:"success",output:[a]}),a.nbTotalItf=r.length;for(var l=Math.floor((r.length-1)/500)+1,d=0,c=[],u=!1;d<l&&!u;)B({ctxIDs:r.slice(500*d,500*(d+1)),onComplete:function(t){var o,l=[];t.result.forEach((function(e){if(l.push(e.input_object.physicalid),e.input_object&&"1"!==e.input_object["bo.SIMItfContextOfInterference.V_Context_Validity_Status"])a.nbTotalItf--;else if(e.outputs&&e.outputs.ms&&1===e.outputs.ms.length){if(s.indexOf(e.outputs.ms[0].physicalid)>-1)return void a.nbTotalItf--;s.push(e.outputs.ms[0].physicalid);let t=e.outputs.ms[0];"5"===t["bo.PLMPIMMetricReference.V_Itf_Type"]||"6"===t["bo.PLMPIMMetricReference.V_Itf_Type"]?a.nbTotalItf--:"1"===t["bo.PLMPIMMetricReference.V_Itf_Analysis"]?a.nbOK++:"2"===t["bo.PLMPIMMetricReference.V_Itf_Analysis"]?a.nbKO++:"5"===t["bo.PLMPIMMetricReference.V_Itf_Analysis"]&&a.nbPrev++}})),o={itfIDs:l},u&&n({status:"failure",simIds:[e]}),c.push.apply(c,o.itfIDs),c.length===r.length?n({status:"success",output:[a]}):i(e,r.length,c.length)},onFailure:function(){n({status:"failure",simIds:[e]}),u=!0}}),d++},onFailure:function(){n({status:"failure",simIds:[e]})}})}(e.id,n,i)},K.getRvwFromValidatedObject=function(e){return new Promise((function(n){var i;(i=function(e){return{input_physical_ids:e,label:b("R3MwebRvwFromVal"),primitives:[{navigate_from_sr:{id:1,filter:{semantics:["5"],role:["110"]},mode:"ends"}},{navigate_from_rel:{id:2,filter:{rel_type:["VPLMrel/PLMConnection/V_Owner"],bo_type:["DMUValidationValidation"]}}}],patterns:{review:[{id:1},{id:2}]},fileAttributes:f,attributes:p,version:3}}(e),new Promise((function(e){M({url:t.get3DSpaceUrl()+"/cvservlet/navigate",securityContext:t.getSecurityContext(),method:"POST",data:i,onComplete:function(t){e(t)},onFailure:function(){e({})}})}))).then((e=>{n(e)}))}))},K.evalMetricIssueCells=function(e,t){J(e,t)},K.evalIssueCells=function(e,n){for(var i=[],a=0;a<e.length;a++)i.push({id:a,method:"GET",url:"resources/issues/"+e[a]});M({url:t.get3DSpaceUrl()+"/resources/issues/batch",securityContext:t.getSecurityContext(),method:"POST",data:{requests:i},onComplete:function(t){t.results.forEach((function(e){e.body.assignees.forEach((function(e){S(e.user)}))})),n(t,d,e)},onFailure:function(){n({results:[]},e)}})},K.evalTaskCells=function(e,n){M({url:t.get3DSpaceUrl()+"/resources/v1/modeler/tasks/",securityContext:t.getSecurityContext(),method:"GET",onComplete:function(t){var i={};t&&void 0!==t.data&&t.data.length>0&&t.data.some((function(t){t.id===e[0]&&(i=t)})),n(i,d,e)},onFailure:function(){n({results:[]},e)}})},K.getIndexingTimestamp=function(){return new Promise((function(e){M({url:t.get3DSpaceUrl()+"/cvservlet/indexingdate",securityContext:t.getSecurityContext(),method:"POST",data:{select_service:["FTS","EXPAND"]},onComplete:function(t){e(t)},onFailure:function(){e({})}})}))},K.getR2VActivityInfo=function(n){return new Promise((function(i){(function(n){return new Promise(((i,a)=>{e.authenticatedRequest(t.getR2VPlatformUrl(n.serviceId)+"/enovia/resources/r2v/modeler/v2/activity/"+n.objectId,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()},timeout:6e4,onComplete:function(e){let t=JSON.parse(e);i(t)},onFailure:a,onTimeout:a})}))})(n).then((e=>{i(e)}))}))},K.getR3MRootStats=function(e){return new Promise((function(n){var i,a,o,r,s;(a=e,o=[{physical_id_path:[a.rootPhID]}],r={descending_condition:{uql:"availability:2"},descending_condition_object:{uql:'[ds6w:globaltype]:"ds6w:Document" OR [ds6w:globaltype]:"ds6w:Part"'},descending_condition_relation:{uql:"NOT (flattenedtaxonomies:'reltypes/XCADBaseDependency')"}},s=[{truncate:{max_distance_from_prefix:0,prefix_filter:{prefix_path:o}}}],i={batch:{expands:[{label:b("R3MwebGetRootStats_ProgressiveExpand_Synthesis"),root:{physical_id:a.rootPhID},filter:{all:1},graph:r,aggregation_processors:[{synthesis:{name:"ProgressiveExpand_LeafSynthesis",mode:"tree_leaf",synthesis_only:1}}]},{label:b("R3MwebGetRootStats_ProgressiveExpand_Expand0"),root:{physical_id:a.rootPhID},filter:{prefix_filter:{prefix_path:o}},graph:r,aggregation_processors:s}]},outputs:{select_object:["physicalid","ds6w:type","ds6w:globalType","ds6w:label"],synthesis:["ProgressiveExpand_LeafSynthesis"]}},new Promise((function(e){M({url:t.get3DSpaceUrl()+"/cvservlet/progressiveexpand/v2",securityContext:t.getSecurityContext(),outputFormat:"cvjson",method:"POST",data:i,onComplete:function(t){e(t)},onFailure:function(){e({})}})}))).then((e=>{n(e)}))}))},K.navigateFromIsrToContext=function(e){return new Promise((function(n){var i;(i=e,new Promise((function(e){M({url:t.get3DSpaceUrl()+"/resources/pimauthoring/service/readItfSimulationContent",securityContext:t.getSecurityContext(),method:"POST",data:Array.isArray(i.isrID)?i.isrID:[i.isrID],onComplete:function(t){e(t)},onFailure:function(){e({})}})}))).then((e=>{n(e)}))}))},K.onTenantModified=function(e){y.push(e)},K.navigate=function(e){var t,n=[e.rvwIds.length?V((t=e.rvwIds,{input_physical_ids:t,label:b("R3MwebRvw"),primitives:[{navigate_to_rel:{id:1,filter:{rel_type:["VPLMrel/PLMConnection/V_Owner"]}}},{navigate_to_sr:{id:2,filter:{semantics:["1"],role:["78"]}}},{navigate_to_sr:{id:3,filter:{semantics:["5"],role:["110"]},mode:"path"}},{navigate_to_sr:{id:4,filter:{semantics:["5"],role:["151"]},mode:"path"}},{navigate_to_rel:{id:5,filter:{rel_type:["VPLMrel/PLMConnection/V_Owner"],bo_type:["DMUValidationCheck"]}}},{navigate_to_rel:{id:6,filter:{rel_type:["VPLMrel/PLMPort/V_Owner"],bo_type:["DMUValidationExposedPresentation"]}}},{navigate_from_rel:{id:7,filter:{rel_type:["Reference Document"],bo_type:["Issue"]}}},{navigate_to_rel:{id:8,filter:{rel_type:["VPLMrel/PLMConnection/V_Owner"],bo_type:["DMUValidationUser"]}}},{navigate_to_sr:{id:9,filter:{semantics:["1"],role:["621"]}}},{navigate_to_sr:{id:10,filter:{semantics:["1"],role:["622"]}}},{navigate_to_sr:{id:11,filter:{semantics:["1"],role:["623"]}}},{navigate_to_sr:{id:12,filter:{semantics:["1"],role:["624"]}}},{navigate_from_rel:{id:13,filter:{rel_type:["Reference Document"],bo_type:["Task"]}}}],patterns:{context:[{id:1},{id:2}],validatedPath:[{id:1},{id:3}],check:[{id:5}],checked:[{id:1},{id:4}],highlight:[{id:6}],issue:[{id:7}],contribution:[{id:8}],coordinators:[{id:8},{id:9}],assignees:[{id:8},{id:10}],contributors:[{id:8},{id:11}],informeduser:[{id:8},{id:12}],task:[{id:13}]},fileAttributes:f,attributes:p,version:3})):Promise.resolve({}),e.isrIds.length?V(E(e.isrIds)):Promise.resolve({}),e.mkpIds.length?V(j(e.mkpIds)):Promise.resolve({}),e.newMkpIds.length?V(j(e.newMkpIds)):Promise.resolve({}),e.msrIds.length?V(R(e.msrIds)):Promise.resolve({})];return Promise.all(n)},G})),define("DS/DMUwebR3Mutils/DMUwebR3MCsiServices",["UWA/Core","DS/WAFData/WAFData","DS/DMUwebR3Mutils/DMUwebR3MwidgetUtils"].concat([]),(function(e,t,n){"use strict";let i=()=>n.get3DSpaceUrl(),a=()=>n.getPlatformId(),o=()=>n.getSecurityContext();function r(e){return t.authenticatedRequest(e.url,{method:e.method,headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:e.securityContext},data:JSON.stringify(e.data),timeout:e.timeout,onComplete:e.onComplete,onFailure:e.onFailure,onTimeout:e.onTimeout||e.onFailure})}function s(t){var n=e.Promise.deferred();return require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"].concat([]),(function(i){new Promise((function(e){i.getGrantedRoles((function(t){e(t.some((function(e){return"ICS"===e.id||1===window.top.__PIM_ICSRoleBypass})))}))})).then((function(i){i?function(t,n){var i=e.Promise.deferred();return require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"].concat([]),(function(e){e.getServiceUrl({serviceName:t,platformId:n,onComplete:function(e){i.resolve(e)},onFailure:function(e){i.reject(new Error(e))}})})),i.promise}("djc",t).then((function(e){var t=e+"/api";n.resolve(t)})):n.resolve("undefined")}))})),n.promise}function l(t,n,i,o){var r=e.Promise.deferred();let l=a(),d=Object.assign({},t);return d.method=n,s(l).then((function(e){d.url=e+i,o&&(d.data=o),r.resolve(d)})),r.promise}return{_computeIsr:function(e){l({onFailure:e.onFailure,onComplete:function(t){var n=JSON.parse("string"==typeof t?t:null);if(!n||!n.jobID||0!==n.status||"OK"!==n.message)return e.onFailure();e.onComplete(n)}},"POST","/v1/job/submit/interference",e.data).then((function(e){return r(e)}))},_getComputeIsrJobStatus:function(e){l({onFailure:e.onFailure,onComplete:function(t){var n=JSON.parse("string"==typeof t?t:null);if(!n||!n.jobID||0!==n.status||"OK"!==n.message)return e.onFailure();e.onComplete(n)}},"GET","/v1/job/status/"+e.data.jobID,null).then((function(e){return r(e)}))},_isUpdateSimulationAllowed:function(){var t=e.Promise.deferred();return s(a()).then((function(e){var n,i="";window&&window.widget&&(n=window.widget,e.contains("undefined")?t.resolve(!1):(n.data&&n.data.appId&&(i=n.data.appId),"ENOR3M_AP"!==i&&"ENOI3S_AP"!==i||t.resolve(!0))),t.resolve(!1)})),t.promise},_getIsrJobsList:function(e){l({onFailure:e.onFailure,onComplete:function(t){var n=JSON.parse("string"==typeof t?t:null);if(!n||0!==n.status)return e.onFailure();e.onComplete(n)}},"GET","/v1/job/list",null).then((function(e){return r(e)}))},_getIsrJobsListByPage:function(e){l({onFailure:e.onFailure,onComplete:function(t){var n=JSON.parse("string"==typeof t?t:null);if(!n||0!==n.status)return e.onFailure();e.onComplete(n)}},"POST","/v1/job/list",e.data).then((function(e){return r(e)}))},_getMaxTokensForIsrCompute:function(e){l({onFailure:e.onFailure,onComplete:function(t){var n=JSON.parse("string"==typeof t?t:null);if(!n||0!==n.status||"OK"!==n.message)return e.onFailure();e.onComplete(n)}},"GET","/v1/job/tokenscount/interference",null).then((function(e){return r(e)}))},_get3DSpaceUrlAndLoginTicket:function(n){var r=e.Promise.deferred(),s=n&&n.platformId?n.platformId:a();let l=i(s),d=o();return function(n,i,a){var o=e.Promise.deferred(),r=n+"/ticket/get?runasctx="+encodeURIComponent(i).trim();return a&&(r+="&tenant="+a),t.authenticatedRequest(r,{headers:{Accept:"application/json"},method:"GET",type:"json",onComplete:function(e){o.resolve(e.ticket)},onFailure:function(e){o.reject(new Error(e))}}),o.promise}(l,d,s).then((function(e){r.resolve({url:l,loginTicket:e})})),r.promise},_readComputeIsrPrefs:function(){return new Promise((function(e){let t=[{Repository:"PIMwebPref",PreferenceNames:["IDLinksAutomaticReroot","IDTrackPreviousAnalysisStatus"]}];require(["DS/CATWebUXPreferences/CATWebUXPreferencesUtils"].concat([]),(function(n){try{n.readPreferences(t).then((function(t){e(t)}))}catch(t){window.console.warn("Error Preferences ",t),e()}}))}))}}})),define("DS/DMUwebR3Mctrl/DMUwebR3Mctrl",["UWA/Class","UWA/Core","DS/Controls/ProgressBar","UWA/Utils/InterCom","DS/DMUwebR3Mux/DMUwebR3Mlist","DS/DMUwebR3Mctrl/DMUwebR3MDropManager","DS/ENOXTriptych/js/ENOXTriptych","DS/EditPropWidget/EditPropWidget","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/utils/EditPropUtils","DS/DMUwebR3Mutils/DMUwebR3MserverRequests","DS/DMUwebR3Mutils/DMUwebR3MwidgetUtils","DS/CoreEvents/ModelEvents","DS/PlatformAPI/PlatformAPI","DS/DMUwebR3Mutils/DMUwebR3MCsiServices","UWA/Utils/Client","DS/ApplicationFrame/ActionBar","DS/WebappsUtils/WebappsUtils","i18n!DS/DMUwebR3Mutils/assets/nls/DMUwebR3Mutils.json","i18n!DS/DMUwebR3Mctrl/assets/nls/DMUwebR3Mctrl.json","css!DS/DMUwebR3Mux/assets/css/DMUwebR3Mux"],(function(e,t,n,i,a,o,r,s,l,d,c,u,p,f,m,g,h,v,y,b){"use strict";function w(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function S(e){return new Promise((function(e,t){require("DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices").getPlatformServices({onComplete:function(t){e(t[0]["3DDashboard"])},onFailure:t})})).then((function(t){if(e){e.content.source=u.getWidget().data.appId,e.content.data.items.forEach((function(e){e.contextId=u.getSecurityContext().replace("ctx::","")}));var n=u.getWidget().data.appId;return function(e){var t,n=document.createElement("textarea");if(n.classList.add("bookmark-txt-link"),n.value=e,document.body.appendChild(n),g.Platform&&g.Platform.hasOwnProperty("ios")&&!0===g.Platform.ios){n.contentEditable=!0,n.readOnly=!0;var i=document.createRange();i.selectNodeContents(n);var a=window.getSelection();a.removeAllRanges(),a.addRange(i),n.setSelectionRange(0,n.value.length)}else n.select();try{t=document.execCommand("copy")}catch(e){window.console.log(e)}return document.body.removeChild(n),t?1:0}(t+("#app:"+n+"/content:X3DContentId=")+encodeURIComponent(JSON.stringify(e.content)))}}))}var C=e.extend({init:function(e){let g,C,I,D,M,x,_,P,E=new p,R=e.parent,j={},O={},k=w(),T=0,F=[],A=[],V={all:[],pending:[],completed:[],timeout:[],running:[]},U=[],L=[],N=[],W=[],B=[],q=!1,J=!1,z=[],X=Object.freeze({rvw:1,isr:1,msr:1,mkp:0,owner:0,released:0,obsolete:0,myselection:0,mycreation:0,ownbyme:1,assigntome:1,wherecontribute:1});function G(){return t.extend(t.clone(X,!0),JSON.parse(localStorage.getItem("R3MwebPrefs")||"{}"))}function K(){return localStorage.setItem("R3MwebPrefs",JSON.stringify(P))}P=G();var Q={CALabel:"",CATot:0,CAFound:0,nonCATot:0,nonCAFound:0,allDropValObjs:[],openCAs:[],caPropId:-1},H=0,Z=100;function $(e,t){return e.some((e=>JSON.stringify(e)===JSON.stringify(t)))}function Y(){return new Promise((function(e){var t={onComplete:function(n){for(var i=n.list.length,a=0,o=!1,r=Date.now()-864e5;a<i&&!o;){var s=n.list[a++];let t=""!==s.jobConfiguration?s.jobConfiguration:"8";if(!(1e3*s.startingTime>=r)){o=!0,e(n);break}var l={internalID:s.internalID,status:s.status,startingTime:s.startingTime,completionTime:s.completionTime,isrPrevComputeConfig:t};$(A,l)||A.push({internalID:s.internalID,status:s.status,startingTime:s.startingTime,completionTime:s.completionTime,isrPrevComputeConfig:t})}o||i<100?e(n):(H+=100,m._getIsrJobsListByPage({onComplete:t.onComplete,onFailure:t.onFailure,data:{offset:H,limit:Z}}))},onFailure:function(){e(null)},data:{offset:H,limit:Z}};m._isUpdateSimulationAllowed().then((function(n){q=n,q?(H=0,m._getIsrJobsListByPage(t)):e(null)}))}))}function ee(e){function t(e,n){if(n){if(n[e])return 1;if(n.children)return n.children&&n.children[e]?1:Object.keys(n.children).some((i=>t(e,n.children[i])))}}if(j[e])return[e];let n=[];return Object.keys(j).forEach((i=>{t(e,j[i])&&n.push(i)})),n}function te(e){var t=Object.keys(j).length;u.getWidget().setTitle(e?"":0===t?b.noValidObj:b["validObj"+(1===t?"":"s")]+t)}function ne(e){e&&e.id&&(O[e.id]||(O[e.id]=e),Object.keys(e.children||{}).forEach((t=>ne(e.children[t]))))}function ie(e){if(void 0===e.validState)return;if(e.validStateWarning="",c.getIsrTypes().indexOf(e.type)>-1)"InProgress"===e.validState?"donenoko"!==e.analysisState&&"donewithko"!==e.analysisState||(e.validStateWarning=b.itfwarningAnalyzed):"Failed"===e.validState?"notcomputed"===e.analysisState?e.validStateWarning=b.itfwarningNotComputed:"startednoko"===e.analysisState?e.validStateWarning=b.itfwarningNotAnalyzed:"donenoko"===e.analysisState?e.validStateWarning=b.itfwarningNotReported:"computed"===e.analysisState&&(e.validStateWarning=b.itfwarningComputed):"Passed"===e.validState&&("notcomputed"===e.analysisState?e.validStateWarning=b.itfwarningNotComputed:"startednoko"===e.analysisState||"startedwithko"===e.analysisState?e.validStateWarning=b.itfwarningNotAnalyzed:"donewithko"===e.analysisState?e.validStateWarning=b.itfwarningReported:"computed"===e.analysisState&&(e.validStateWarning=b.itfwarningComputed));else{let t=e.children&&e.children[e.id+"_check"];if(t=t&&t.children?Object.keys(t.children).map((e=>O[e])).filter((e=>e)):null,!t||!t.length)return;"InProgress"!==e.validState||t.some((t=>t.validState===e.validState))?"Failed"!==e.validState||t.some((t=>t.validState===e.validState))?"Passed"!==e.validState||t.every((e=>"Passed"===e.validState))||(e.validStateWarning=b.warningpassed):e.validStateWarning=b.warningfailed:e.validStateWarning=b.warninginprogress}}function ae(e,t,n){if(!e||!t)return;let i,a=n||t.issue&&t.issue.length&&t.task&&t.task.length;return["issue","ca","task"].forEach((n=>{if(!t[n]||!t[n].length)return;i=!0;let o=e.children||(e.children={});if(a){let i=e.id+"_"+n;o[i]={id:i,title:b[n+(t[n].length>1?"s":"")],children:{}},o=o[i].children}t[n].forEach((e=>{e.owner&&Array.isArray(e.owner)&&e.owner.length>1&&function(e){return new Promise((function(t){var n=u.get3DSpaceUrl()+"/resources/modeler/pno/person/"+e,i={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:u.getSecurityContext()},onComplete:function(e){var n,i=JSON.parse(e);n=i.firstname+" "+i.lastname,t(n)},onFailure:function(){t()}};require("DS/WAFData/WAFData").authenticatedRequest(n,i)}))}(e.ownerid).then((function(t){e.owner=t})),o[e.id]=e})),delete t[n]})),!n&&a&&(e.noSort=!0),i}function oe(e,t){return new Promise((function(n){e&&e.length>0?require("DS/WAFData/WAFData").authenticatedRequest(u.get3DSpaceUrl()+"/resources/validation/service/getValidationsFromObjectsIds?tenant="+u.getPlatformId(),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:u.getSecurityContext()},data:JSON.stringify({listHighlights:t?e:[],listValidations:t?[]:e}),timeout:6e4,onComplete:function(e){let t=JSON.parse(e);n(t)},onFailure:function(){n()},onTimeout:function(){n()}}):n()}))}function re(e){const t=e.match(/(\d{4})\/(\d{2})\/(\d{2})@(\d{2}):(\d{2}):(\d{2}):GMT/);if(t){const e=t[1],n=t[2],i=t[3],a=t[4],o=t[5],r=t[6];return new Date(`${e}-${n}-${i}T${a}:${o}:${r}Z`)}return e}function se(e){var t,n=[],i=[],a=[],o=[],r=[],s=c.getRvwTypes(),l=c.getIsrTypes(),d=c.getMkpTypes(),u=c.getMsrTypes(),p=c.getNewMkpTypes();Object.keys(e).forEach((function(e){t=this[e].type,s.indexOf(t)>-1?n.push(e):l.indexOf(t)>-1?i.push(e):d.indexOf(t)>-1?a.push(e):p.indexOf(t)>-1?o.push(e):u.indexOf(t)>-1&&r.push(e)}),e);var f={rvwIds:n,isrIds:i,mkpIds:a,newMkpIds:o,msrIds:r};c.navigate(f).then((function(e){var t={};[0,1,2,3,4].forEach((function(e){Object.keys(this[e]).forEach((function(e){let n=j[e];if(!n)return void window.console.log("id: "+e+" not in validated objects list");let i=["validated","check","members","highlight","issue","ca","task"].some((t=>this[e][t]&&this[e][t].length));["context","validated","check","members","highlight"].forEach((function(t){if(!this[t]||!this[t].length)return;"context"===t&&(this[t]=this[t].filter((e=>"Specification Report"!==e.type)));let a=n.children||(n.children={});if(i){let i=e+"_"+t;if(a[i]={id:i,title:b[t+(this[t].length>1?"s":"")],children:{}},"validated"===t&&(a[i].validatedPath=this.validatedPath),"members"===t){n.reviewContriDisplay=function(e){var t=[];e.forEach((e=>{Object.keys(e).forEach((function(n){"contributors"!==n&&"assignees"!==n||(t=0===t.length?Array.from(e[n]):t.concat(e[n]))}))}));var n=t.map((function(e){return e.contribution})).reduce(((e,t)=>(e[t]=e[t]+1||1,e)),{});return n.OnGoing||n.NotStarted&&n.Completed?"OnGoing":n.NotStarted?"NotStarted":n.Completed?"Completed":void 0}(this[t]);var o=[];this[t].forEach((function(t){Object.keys(t).forEach((n=>{var i={};let a=e+"_"+n;t[n].forEach((function(e){var t="";"assignees"!==n&&"contributors"!==n||(t=e.contribution),i[a+"_"+e.user]={id:a+"_"+e.user,title:e.fullName,fullName:e.fullName,type:"person",name:e.user,reviewContriDisplay:t}})),o.push({id:a,title:b[n]+" ("+t[n].length+")",children:i,icons:[{iconName:"user"}]}),delete t[n]}))})),this[t]=o}"highlight"===t&&this[t].forEach((e=>ae(e,e,!1))),"check"===t&&this[t].forEach((function(e){e.children&&e.children.length>=1&&(e.children=e.children.reduce(((e,t)=>(e[t.id]=t,e)),{}))})),a=a[i].children}this[t].forEach((function(e){a[e.id]=j[e.id]||e})),delete this[t]}),this[e]),ae(n,this[e],!0),ne(n),ie(n),i&&(n.noSort=!0),t[e]=n}),this[e])}),e),C.updateValidations(t)}))}function le(e){var n;if(e||(e="showLoadingLoop"),x&&x.dialog&&x.dialog.destroy(),x=null,_&&_.clean(),_=null,F&&F.forEach((e=>e.cancel())),F=[],u.perfoMark("refreshGrid_"+ ++T),"showLoadingLoop"===e){n=t.createElement("div",{class:"r3mLoadingValidations mask wux-datagridview-emptycontentmessage"}).inject(R);const e=t.createElement("div",{class:"spinner spinner-lg spinning fade in",styles:{display:"flex","justify-content":"center"}}).inject(n);t.createElement("span",{class:"spinner-bar"}).inject(e),t.createElement("span",{class:"spinner-bar spinner-bar1"}).inject(e),t.createElement("span",{class:"spinner-bar spinner-bar2"}).inject(e),t.createElement("span",{class:"spinner-bar spinner-bar3"}).inject(e),t.createElement("div",{class:"r3mWelcomeText",html:b.validationLoad,styles:{}}).inject(n)}te(!0),j={},O={},N=[],W=[],B=[],V={all:[],pending:[],completed:[],timeout:[],running:[]},U=[],L=[],A=[];var i=u.getWidget();let a={isCaToRvwFound:!1,caLbl:void 0,status:"",caLen:0,valFndLen:0},o=JSON.parse(localStorage.getItem("r3mDataLoadFromDrop")||"{}");if(o&&o.isCaToRvwFound&&(a.isCaToRvwFound=o.isCaToRvwFound),o&&o.caLen&&(a.caLen=o.caLen),o&&o.valFndLen&&(a.valFndLen=o.valFndLen),a&&(a.caLbl=o&&o.caLbl?o.caLbl:void 0),o&&o.valFndLen&&0===o.valFndLen.length)return a.status&&C.updateFilterSelectionLabel("notstarted",0,a.caLbl),void("showLoadingLoop"===e&&n.destroy());var r=o&&o.data?o.data:u.getDatafromContent(),s={};1===P.mycreation?s=Object.freeze({rvw:0,isr:0,msr:0,mkp:0,obsolete:0,released:0}):(0!==Object.keys(r).length&&i.data&&!i.data.loadDataFromCopiedLink||0!==Object.keys(r).length&&1===P.myselection)&&(s=Object.freeze({rvw:1,isr:1,msr:1,mkp:1,obsolete:1,released:1}));var l,d={},p=[];if(1===P.mycreation&&r&&r.obj){var f={};r.obj.forEach((function(e){f[e.objectId]={id:e.objectId,type:"DMUValidationValidation"}})),p.push((l=f,new Promise((e=>{var t={};const n=[];Object.keys(l).map((e=>{let t={};t.input_object={"ds6w:type":"DMUValidationValidation",physicalid:e},n.push(c.getReviewInfo(t))})),Promise.all(n).then((function(n){var i={},a={},o={},r={ids:[],uris:[]},s=[];function l(e,t,n){return{id:e,title:a[e]?a[e]["ds6w:label"]:t,type:a[e]?a[e]["ds6w:type"]:n,typeDisp:c.getValuesNls("ds6w:type",a[e]?a[e]["ds6w:type"]:n),name:a[e]?a[e]["ds6w:identifier"]:"",owner:a[e]?a[e]["ds6w:responsible"]:"",icon:a[e]&&(a[e].type_icon_url||a[e]["ds6w:icon"])||"",organization:a[e]?a[e]["ds6w:organizationResponsible"]:"",organizationDisp:c.getValuesNls("ds6w:organizationResponsible",a[e]?a[e]["ds6w:organizationResponsible"]:""),dateModif:a[e]?a[e]["ds6w:modified"]:"",dateCreat:a[e]?a[e]["ds6w:created"]:"",collabSpace:a[e]?a[e]["ds6w:project"]:"",ownerid:a[e]?a[e]["ds6w:responsibleuid"]:"",maturity:a[e]?a[e]["ds6w:status"]:"",maturityDisp:c.getValuesNls("ds6w:status",a[e]?a[e]["ds6w:status"]:"")}}n.forEach((function(e){e&&(s.push(e.id),e.owner&&!i[e.owner]&&(i[e.owner]={name:""}),e.members&&(Object.keys(e.members)||[]).forEach((e=>{i[e]||(i[e]={name:""})})),e.children&&e.children.forEach((e=>{e&&e.contexts?e.contexts.forEach((e=>{a[e.id]||(a[e.id]={}),r.ids.push(e.id)})):e&&e.contextURI?(a[e.contextURI]||(a[e.contextURI]={}),r.uris.push(e.contextURI)):e&&e.validatedObjects&&e.validatedObjects.forEach((e=>{if(e.PathElements&&e.PathElements.length>0){let t=e.PathElements[e.PathElements.length-1];a[t]||(a[t]={}),r.ids.push(t)}})),"DMUValidationCheck"!==e.type&&"DMUValidationExposedPresentation"!==e.type||(a[e.id]||(a[e.id]={}),r.ids.push(e.id),(e.children||[]).forEach((e=>{a[e.id]||(a[e.id]={}),r.ids.push(e.id)})))})))}));const d=c.getReviewAttributes(s),u=c.fetchContext(r,(function(e){if(e){var t=JSON.parse(e);"r2vsurvey"===t.serviceId?(t.data||[]).forEach((e=>{var t=e["ds6w:i3dx"];a[t]||(a[t]={}),Object.entries(e).forEach((([e,n])=>{a[t][e]=n}))})):(t.results||[]).forEach((e=>{if(e.attributes&&e.attributes.length>0&&"resourceid"===e.attributes[0].name){var t=e.attributes[0].value;e.attributes.forEach((function(e){a[t][e.name]=e.value}))}}))}}));Promise.all([d,u]).then((function(a){a[0]&&a[0].results&&a[0].results.forEach((function(e){var t=["","","","",""];e.basicData.forEach((function(e){["organization","originated","modified","project"].forEach((function(n,i){n===e.name&&e.value&&1===e.value.length&&(t[i]=e.value[0])}))})),e.data.forEach((function(n){"V_description"===n.name&&n.value&&1===n.value.length&&(t[4]=e.data[1].value[0])})),o[e.physicalID]={organization:t[0],dateCreat:t[1],dateModif:t[2],collabSpace:t[3],description:t[4]}}));var r=0;const s=[];(Object.keys(i)||[]).forEach((e=>{s.push(new Promise((function(t){c.getUserInfo(e).then((function(n){n&&(i[e].name=n.firstname+" "+n.lastname),t()}))})))})),Promise.all(s).then((function(){n.forEach((function(e){if(e){var n={};n.id=e.id,n.title=e.name,n.name=e.name,n.type=e.type,n.maturity="VPLM_SMB_Evaluation_MajorRev."+e.currentState;var a=c.getValuesNls("ds6w:status",n.maturity);n.maturityDisp=a||n.maturity,n.validState=e.status,n.validStateDisp=y["validState"+e.status],n.restrictedEdition=e.restrictedEdition,n.restrictedEditionDisp=e.restrictedEdition,n.ownerid=e.owner,n.owner=i[e.owner]&&i[e.owner].name?i[e.owner].name:e.owner,o[e.id]&&(n.organization=o[e.id].organization,n.organizationDisp=o[e.id].organization,n.dateCreat=o[e.id].dateCreat,n.dateCreat=re(n.dateCreat),n.dateModif=o[e.id].dateModif,n.dateModif=re(n.dateModif),n.collabSpace=o[e.id].collabSpace,n.description=o[e.id].description),n.icon=v.getWebappsAssetUrl("TagNavigator","icons/type_icon/")+"I_VALValidation.png",n.analysisState="unknown",n.analysisStateDisp="",n.analysisStateNbKO=0,n.analysisStateProgress=0,n.r3massignees="",n.ownerImg=c.getUserImage(n.ownerid),n.children={};var s={},d={},u={},p={},f=!1,m=0,g=0;if((e.children||[]).forEach((e=>{"DMUValidationContext"===e.type&&(e.contexts?(e.contexts||[]).forEach((e=>{f=!0,s[e.id]=l(e.id,e.name,e.type)})):e.contextURI&&(f=!0,s[e.contextURI]=l(e.contextURI))),"DMUValidationValidated"===e.type&&e.validatedObjects&&(e.validatedObjects||[]).forEach((e=>{if(e.PathElements&&e.PathElements.length>0){r++;let t=e.PathElements[e.PathElements.length-1];d[r]=l(t,e.referenceName,e.referenceType),d[r].pid=d[r].id,d[r].id=r}else if(e.uri){r++;let t=e.uri;d[r]=l(t)}})),"DMUValidationCheck"===e.type&&e.id&&(m++,u[e.id]=l(e.id,e.name,"DMUValidationCheck"),u[e.id].children=[],(e.children||[]).forEach((t=>{u[e.id].children.push(l(t.id,"",""))}))),"DMUValidationExposedPresentation"===e.type&&e.id&&(g++,p[e.id]=l(e.id,e.name,"DMUValidationExposedPresentation"),p[e.id].children=[])})),f){let t=e.id+"_context";n.children[t]={id:t,title:"Context",children:s}}if(r>0){let t=e.id+"_validated";n.children[t]={id:t,title:"Validated Object",children:d}}if(m>0){let t=e.id+"_check";n.children[t]={id:t,title:"Check",children:u}}if(e.members){let t={owner:"owner",coordinator:"coordinators",assignee:"assignees",contributor:"contributors",informeduser:"informeduser"};var h={},w=0,S=0,C=0;["owner","coordinators","assignees","contributors","informeduser"].forEach((function(e){h[e]={}})),Object.keys(e.members?e.members:{}).forEach((n=>{var a=e.members[n],o=i[n]&&i[n].name?i[n].name:n;a.roles.forEach((i=>{let r=t[i],s=e.id+"_"+r,l="";"assignees"!==r&&"contributors"!==r||(l=a.contribution,w++,"NotStarted"===l?S++:"Completed"===l&&C++),h[r][s+"_"+n]={id:s+"_"+n,title:o,fullName:o,type:"person",name:n,reviewContriDisplay:l}}))}));let a=e.id+"_owner_"+n.ownerid;h.owner[a]={id:a,title:n.owner,fullName:n.owner,type:"person",name:n.ownerid};let o=[];if(["owner","coordinators","assignees","contributors","informeduser"].forEach((function(t){let n=Object.keys(h[t]).length;a=e.id+"_"+t,o.push({id:a,title:b[t]+" ("+n+")",children:h[t],icons:[{iconName:"user"}]})})),o.length>0){let t={};o.forEach((function(e){t[e.id]=e}));let i=e.id+"_members";n.children[i]={id:i,title:b["member"+(o.length>1?"s":"")],children:t}}0===w||(n.reviewContriDisplay=w===S?"NotStarted":w===C?"Completed":"OnGoing")}if(g>0){let t=e.id+"_highlight";n.children[t]={id:t,title:"Highlight",children:p}}n.noSort=!0,n.id&&(t[n.id]=n)}})),e(t)}))}))}))}))))}Promise.all(p).then((function(t){var l,p;t&&1===t.length&&(Object.keys(t[0])||[]).forEach((e=>{d[e]=t[0][e],ne(t[0][e])})),(l=0!==Object.keys(s).length?s:P,p={},l.myselection||l.owner||!l.assigntome&&!l.wherecontribute?Promise.resolve(p):new Promise((function(e){const t={...l,isOnlyRvw:!0};c.search(t,(function(t){0===Object.keys(t).length&&(Object.keys(p).length>0?oe(Object.keys(p),!1).then((t=>{if(t&&t.validations&&t.validations.length>0){var n=u.getUserLogin();const i=t.validations.filter((e=>e.members&&e.members[n]&&e.members[n].roles&&(e.members[n].roles.includes("contributor")&&l.wherecontribute||e.members[n].roles.includes("assignee")&&l.assigntome))),a=Object.keys(p).filter((e=>i.some((t=>t.id===e)))).reduce(((e,t)=>(e[t]=p[t],e)),{});e(a)}})):e(p)),p=Object.assign(p,t)}))}))).then((function(t){const l=c.search(0!==Object.keys(s).length?s:P,(function(s,c){O=Object.assign(O,s);var p={},f=[],m=[];0===c&&(C.removeAll(),p=d,t&&(O=Object.assign(O,t),j=Object.assign(j,t),s=Object.assign(s,t))),r&&0===Object.keys(r).length?localStorage.removeItem("R3MFromCopylink"):r.obj&&Array.isArray(r.obj)&&r.obj.forEach((function(e){e.objectType&&"DMUValidationExposedPresentation"===e.objectType&&f.push(e.objectId)})),Y().then((function(){oe(f).then((t=>{var c=[];(0!==Object.keys(r).length&&i.data&&!i.data.loadDataFromCopiedLink||1===P.myselection)&&(P=G(),i.data.loadDataFromCopiedLink=!0,P.myselection=1,K(),t&&t.validations&&t.validations.length>0&&t.validations.forEach((function(e){s.hasOwnProperty(e.id)&&(m[e.id]=p[e.id]=s[e.id],c.push(e.id))})),r.obj&&r.obj.length>0&&r.obj.forEach((function(e){(!d||d&&!d[e.objectId])&&s.hasOwnProperty(e.objectId)&&(p[e.objectId]=s[e.objectId],c.push(e.objectId))})),localStorage.setItem("R3MFromCopylink",1)),j=p&&0===Object.keys(p).length?Object.assign(j,s):p,localStorage.setItem("r3mValidationObjects",JSON.stringify(j)),C.updateValidations(p&&0===Object.keys(p).length?s:p),C.checkFilterAndFetchValue(),0===P.mycreation&&se(p&&0===Object.keys(p).length?s:p),te(),C.expanReviewNode(m,t);let f=Object.keys(j),g=0,h=0,v=0,y=0;a.isCaToRvwFound&&f.forEach((function(e){let t=j[e];"DMUValidationValidation"===t.type&&(g+=1,"InProgress"===t.validState?h+=1:"Failed"===t.validState?v+=1:"Passed"===t.validState&&(y+=1))})),o&&o.caLen&&(a.caLen=o.caLen),o&&o.valFndLen&&(a.valFndLen=o.valFndLen),a.isCaToRvwFound&&o.caLen>=1&&0===a.valFndLen?C.updateFilterSelectionLabel("notstarted",0,a.caLbl):a.isCaToRvwFound&&(a.valFndLen!==o.caLen?C.updateFilterSelectionLabel("partial",v>0?v:0,a.caLbl):y===g?C.updateFilterSelectionLabel("passed",0,a.caLbl):h>0?C.updateFilterSelectionLabel("inProgress",v>0?v:0,a.caLbl):v>0&&C.updateFilterSelectionLabel("failed",v>0?v:0,a.caLbl)),l.promise.finally(function(){if("showLoadingLoop"===e)n.destroy();else if("deleteCreationLoop"===e){let e=document.getElementsByClassName("r3mLoadingValidations mask wux-datagridview-emptycontentmessage");e&&e.length>0&&e[0].destroy()}u.perfoMeasure("refreshGrid_"+this)}.bind(T)),F.push(l)}))}))}),(function(){if("showLoadingLoop"===e)n.destroy();else if("deleteCreationLoop"===e){let e=document.getElementsByClassName("r3mLoadingValidations mask wux-datagridview-emptycontentmessage");e&&e.length>0&&e[0].destroy()}}))}))}))}function de(e,t){function n(e,t){return e.some((function(e){return t.length===e.length&&e.every((function(e,n){return e===t[n]}))}))}C.getSelectedRows().forEach((function(i){if(!i||!i.id||!O[i.id])return void window.console.error("Unidentified object");let a;a=i.id.search("_")>-1?Object.values(O[i.id].children):[O[i.id]],a.forEach((function(i){var a;if(i.validatedPath&&i.validatedPath.length>2)a=i.validatedPath.map((function(e){return t[e.pid]||(t[e.pid]={type:e.type}),e.pid})),n(e,a)||e.push(a);else{const o=i.i3dx||i.pid||i.id;t[o]||(t[o]={type:i.type}),n(e,a=[o])||e.push(a)}}))}))}function ce(e,t,n){t.forEach((function(t){e.push({envId:u.getPlatformId(),serviceId:"3DSpace",contextId:u.getSecurityContext(),objectId:t[t.length-1],objectType:n[t[t.length-1]].type,path:t.length>2?t.map((function(e){return{resourceid:e,type:n[e]?n[e].type:void 0}})):void 0})}))}function ue(e,t){var n={protocol:"3DXContent",version:"1.0",source:u.getWidgetAppId(),data:{items:[]}};return ce(n.data.items,e,t),n}function pe(e){var t,n=[],a={};if(de(n,a),0===n.length&&0===Q.openCAs.length){let e=JSON.parse(localStorage.getItem("r3mDataLoadFromDrop")||"{}");e&&e.openCAs&&(Q.openCAs=e.openCAs)}let o=!1;if(0===n.length&&Q.openCAs.length>0?(1===Q.openCAs.length&&I.options.actions.length>1?ze(!0):Q.openCAs.length>1&&1===I.options.actions.length&&ze(!1),Q.openCAs.forEach((function(e){n.push([e.id]),a[e.id]={type:e.type}})),o=!0):(Q.caPropId=-1,I.options.actions.length>1&&ze(!0)),o&&Q.caPropId>=0){let e=n[Q.openCAs.length>1?Q.caPropId:0];n=n.filter((t=>JSON.stringify(t)===JSON.stringify(e)))}if(t=n.map((function(e){var t=e[e.length-1],n=a[t].type,i={getID:function(){return t},tenant:u.getPlatformId(),type:n};return"R2V_Activity"===n&&(i.getI3DX=function(){return t}),e.length>2&&(i.getRelationID=function(){return e[e.length-2]}),d.getModelFromSelectedNode(i)})),g.getRightOpen()&&I.initDatas(t),!e){var r={version:"1.1",paths:n,attributes:a,tenant:u.getPlatformId()},s={uid:w(),originUid:k,timestamp:Date.now(),appid:u.getWidgetAppId(),originWidgetId:u.getWidgetId()};f.publish("DS/PADUtils/PADCommandProxy/select",{data:r,metadata:s}),D||(M=u.getWidgetAppId()+"_CompassSocket_"+u.getWidgetId(),D=new i.Socket(M),D.subscribeServer("com.ds.compass",window.parent)),n.length?D.dispatchEvent("onSetX3DContent",ue(n,a),M):D.dispatchEvent("onResetX3DContent",{},M)}}function fe(){pe()}function me(){pe()}function ge(e){var t;["rvw","isr","mkp","msr","owner","released","obsolete","myselection","mycreation","ownbyme","assigntome","wherecontribute"].forEach((function(n){e[n]!==P[n]&&(t=!0,P[n]=e[n])})),t&&(Xe(),le(),K())}function he(){return new Promise((function(e){if(J)return e();new h({file:"ENOR3MHeaders.xml",module:"DMUwebR3Mutils",context:"Default"}).onActionBarReady((function(){J=!0,e()}))}))}function ve(){let e=[];z.forEach((t=>{e.push(...t.paths)}));let n=e.map((function(e){return e.objectId})),i=e.filter(((e,t)=>n.indexOf(e.objectId)===t));he().then((function(){require(["DS/ApplicationFrame/CommandsManager"],(function(e){if(e){let n=e.getCommand("DMUReviewHdr","Default");n.initCommandParamters({objects:i,platformUtils:u,onCommandEnded:function(e){if(e&&e.validations){var t=[];let i=[];if((e.validations||[]).forEach((e=>{i.push({objectId:e.pId,serviceId:"3DSpace",objectType:"DMUValidationValidation",displayName:e.validationName})})),e.CA){var n={ids:[e.CA],uris:[]};t.push(c.fetchContext(n,(function(t){if(t){var n=JSON.parse(t);if(n.results&&1===n.results.length&&n.results[0].attributes){let t=n.results[0].attributes.find((e=>"ds6w:label"===e.name)),a=n.results[0].attributes.find((e=>"ds6w:type"===e.name));i.push({objectId:e.CA,serviceId:"3DSpace",objectType:a?a.value:"Change Action",displayName:t?t.value:"Change Action"})}}})))}Promise.all(t).then((function(){Ge(i,!0),P.myselection=1,P.mycreation=1,K()}))}},startLoadingUI:function(){const e=t.createElement("div",{class:"r3mLoadingValidations mask wux-datagridview-emptycontentmessage"}).inject(R),n=t.createElement("div",{class:"spinner spinner-lg spinning fade in",styles:{display:"flex","justify-content":"center"}}).inject(e);t.createElement("span",{class:"spinner-bar"}).inject(n),t.createElement("span",{class:"spinner-bar spinner-bar1"}).inject(n),t.createElement("span",{class:"spinner-bar spinner-bar2"}).inject(n),t.createElement("span",{class:"spinner-bar spinner-bar3"}).inject(n),t.createElement("div",{class:"r3mWelcomeText",html:b.validationCreation,styles:{}}).inject(e)},startCheckingSelUI:function(){const e=t.createElement("div",{class:"r3mLoadingValidations mask wux-datagridview-emptycontentmessage"}).inject(R),n=t.createElement("div",{class:"spinner spinner-lg spinning fade in",styles:{display:"flex","justify-content":"center"}}).inject(e);t.createElement("span",{class:"spinner-bar"}).inject(n),t.createElement("span",{class:"spinner-bar spinner-bar1"}).inject(n),t.createElement("span",{class:"spinner-bar spinner-bar2"}).inject(n),t.createElement("span",{class:"spinner-bar spinner-bar3"}).inject(n),t.createElement("div",{class:"r3mWelcomeText",html:b.checkingSelections,styles:{}}).inject(e)},endCheckingSelUI:function(){let e=document.getElementsByClassName("r3mLoadingValidations mask wux-datagridview-emptycontentmessage");e&&e.length>0&&e[0].destroy()}}),n.begin()}}))}))}function ye(){he().then((function(){window.widget.setValue("appId","ENOR3M_AP"),require(["DS/ApplicationFrame/CommandsManager"],(function(e){e&&e.getCommand("CATWebUXPreferencesHdr","Default").begin()}))}))}function be(){var e=g.getRightOpen();E.publish({event:e?"triptych-hide-panel":"triptych-show-panel",data:"right"}),C.setInfoState(!e),e||pe(!0)}function we(){var e=[],t={};return de(e,t),e.filter((e=>!(e&&1===e.length&&t[e[0]]&&"DMUValidationCheck"===t[e[0]].type)))}function Se(){let e=C.getSelectedRows(),t=[];return e.length&&1===e.length&&e.forEach((e=>{var n;if(e.parents&&e.parents.length>0&&e.parents[0].contains("_highlight"))n=e.parents[1]?e.parents[1]:"";else{let t=j[e.id];n=t&&-1!==c.getRvwTypes().concat(c.getIsrTypes().concat(c.getMkpTypes()).concat(c.getNewMkpTypes()).concat(c.getMsrTypes())).indexOf(t.type)&&t.id}n&&t.push({physicalid:n,tenant:u.getPlatformId()})})),t}function Ce(){let e,t,n,i,a,o=C.getSelectedRows(),r=[],s=[];o.length&&o.forEach((o=>{let l=j[o.id];var d;e=t=l.title,i=l.pid||l.id,a=l.type,n=l.description?l.description:"",l.thumbnail_image&&l.thumbnail_image.indexOf("dos/webservices")>=0&&window&&"OnPremise"!==window.widget.getValue("x3dPlatformId")?r.push((d=l.thumbnail_image,new Promise((function(e){c.getDOSDownloadUrl(d,(function(t){e({downloadedUrl:t,imageurl:d})}))})))):s.push({downloadedUrl:l.icon,imageurl:l.icon})})),he().then((function(){require(["DS/ApplicationFrame/CommandsManager"],(function(o){if(o){let l=o.getCommand("DMUPublishToSwymCmdHdr","Default");Promise.all(r).then((function(o){var r;s.push(o[0]),Promise.all([(r=s[0],new Promise((function(e){let t=r.imageurl.indexOf("dos/webservices")>=0;require("DS/WAFData/WAFData").authenticatedRequest(r.downloadedUrl,{proxy:"none",type:"blob",timeout:6e4,onComplete:function(n){var i=new FileReader;i.onload=function(){const n=new Image;n.src=i.result,n.onload=function(){const i=document.createElement("canvas");let a=t?1:8,o=n.width,r=n.height;i.width=o*a*2,i.height=r;const s=i.getContext("2d");a=1;const l=(i.width-o*a)/2,d=(i.height-r*a)/2;s.imageSmoothingEnabled=!1,s.drawImage(n,l,d,o*a,r*a);const c=i.toDataURL("image/png");e(c)}},i.readAsDataURL(n)},onFailure:function(){e(null)},onTimeout:function(){e(null)}})})))]).then((function(o){l.initCommandParamters({titleName:e,contentTitle:t,contentDescription:n,mode:"automatic",objectId:i,envId:u.getPlatformId(),contextId:u.getSecurityContext().replace("ctx::",""),objectType:a,base64image:o[0]}),l.begin()}))}))}}))}))}function Ie(){var e={protocol:"3DXContent",version:"1.1",data:{items:[]},source:u.getWidgetAppId(),widgetId:u.getWidgetId()},t=[],n={};de(t,n),ce(e.data.items,t,n);var i=S({content:e});require(["DS/PADUtils/views/PADAlert"].concat([]),(function(e){i?e.displayNotification({msg:b.replace(b.copyLinkSuccess,{label:O[t[0]].title}).replace(/"/g,"'"),eventID:"success"}):e.displayNotification({msg:b.copyLinkError,eventID:"error"})}))}function De(){var e=t.Promise.deferred();return m._getMaxTokensForIsrCompute({onComplete:function(t){e.resolve(t)},onFailure:function(){e.resolve()}}),e.promise}function Me(){var e=t.Promise.deferred();if(!q)return 0;let n=0,i=C.getSelectedRows();if(i.length){let t=[];i.forEach((e=>{var n;let i=j[e.id];(n=i&&-1!==c.getIsrTypes().indexOf(i.type)&&i.id)&&t.push(n)})),t.length>=1&&t.length===i.length?(n=1,Y().then((function(){(function(e){var t=[];return e.forEach((e=>{let n=A.filter((t=>t.internalID===e));if(n.length>=1){let i=n.reduce(((e,t)=>e&&e.startingTime>t.startingTime?e:t));t.push({id:e,status:i.status})}else t.push({id:e,status:"succeeded"})})),t})(t).filter((e=>"running"===e.status||"pending"===e.status)).length>=1&&(n=2),e.resolve(n)}))):e.resolve(n)}return e.promise}function xe(e,t,n,i){e.analysisState=t,e.analysisStateDisp=c.getAnalysisStateNlsValue(t),e.analysisStateNbKO=n;let a={};ie(e),a[e.id]=e,C.updateValidations(a,i)}function _e(e){var n=[];if(de(n,{}),n.length){var i=b.computeIsrNotifPrefix?b.computeIsrNotifPrefix:"Compute Interference Simulation: ",a="",o="R3M",r=0;n.forEach((s=>{n.length>1&&(o="R3M "+r.toString(),r++);var l=j[s[0]]&&j[s[0]].title?j[s[0]].title:"";a=i+l,function(e){var n=t.Promise.deferred();return m._isUpdateSimulationAllowed().then((function(t){if(t){var i=new Promise((function(t){var n=null;c.navigateFromIsrToContext({isrID:e.isrID}).then((function(e){e.result.length>0&&e.result[0].output&&e.result[0].output.prd&&e.result[0].output.prd.physicalid&&(n=e.result[0].output.prd.physicalid,c.getR3MRootStats({rootPhID:n}).then((function(e){e&&e.results&&e.results.length>=2&&e.results[1].synthesis&&e.results[1].synthesis.value&&t(e.results[1].synthesis.value)})))}))}));m._get3DSpaceUrlAndLoginTicket().then((function(){var t=!1,a=!1;m._readComputeIsrPrefs().then((function(o){o.repositories.forEach((function(e){"PIMwebPref"===e.name&&e.preferences.forEach((function(e){"IDLinksAutomaticReroot"===e.name?t="true"===e.value:"IDTrackPreviousAnalysisStatus"===e.name&&(a="true"===e.value)}))}));var r=localStorage.getItem("PIMCSIInputI3S")?localStorage.getItem("PIMCSIInputI3S"):"",s=e.app,l=e.isrID+"_"+Date.now().toString()+".txt",d=new Date,c=("0"+d.getUTCDate()).substr(-2)+"/"+("0"+(d.getUTCMonth()+1)).substr(-2)+"/"+("0"+d.getUTCFullYear()).substr(-4)+" "+("0"+d.getUTCHours()).substr(-2)+":"+("0"+d.getUTCMinutes()).substr(-2)+":"+("0"+d.getUTCSeconds()).substr(-2),p={version:1,type:"Parameters",content:{sSecurityCtxt:{type:"string",value:u.getSecurityContext()},sIsrObjId:{type:"string",value:e.isrID},sWApp:{type:"string",value:s},sDbgVal:{type:"string",value:r},bReroot:{type:"bool",value:t},bTrackStat:{type:"bool",value:a},jobConfiguration:{type:"int32",value:parseInt(e.isrJobConfig)},sReportName:{type:"string",value:l},sSubmitDate:{type:"string",value:c}}},f={data:{items:[{objectId:e.isrID,objectType:"SIMItfSimulation"}]}};f.source=window.widget&&window.widget.getValue("x3dAppId")?window.widget.getValue("x3dAppId"):"ENOI3S_AP",f.widgetId=window.widget?window.widget.id:void 0,f.data.items[0].envId=u.getPlatformId(),f.data.items[0].serviceId="3DSpace",f.data.items[0].contextId=u.getSecurityContext().replace("ctx::",""),f="content:X3DContentId="+encodeURIComponent(JSON.stringify(f));var g={data:{title:e.title,internalID:e.isrID,inputs:JSON.stringify(p),jobConfiguration:e.isrJobConfig,reportName:l,app:{appContent:f}},onComplete:function(e){var t={data:{jobID:e.jobID},onComplete:function(e){n.resolve({jobStatus:e.jobStatus})},onFailure:function(){n.reject({jobStatus:"failed"})}};m._getComputeIsrJobStatus(t)},onFailure:function(e){n.reject(e)}};m._computeIsr(g),u.sendUsageProbe({eventAction:"ComputeIsr",eventLabel:"sWApp",eventValue:s}),u.sendUsageProbe({eventAction:"ComputeIsr",eventLabel:"jobConfiguration",eventValue:e.isrJobConfig}),u.sendUsageProbe({eventAction:"ComputeIsr",eventLabel:"LinksAutomaticReroot",eventValue:!0===t?"true":"false"}),u.sendUsageProbe({eventAction:"ComputeIsr",eventLabel:"TrackPreviousAnalysisStatus",eventValue:!0===a?"true":"false"}),i.then((function(e){u.sendUsageProbe({eventAction:"ComputeIsr",eventLabel:"nbParts",eventValue:e})}))}))}))}else n.reject("KO")})),n.promise}({isrID:s[0],title:a,app:o,platformId:u.getPlatformId(),isrJobConfig:e.isrJobConfig}).then((function(e){let t=j[s[0]];t&&(A.push({internalID:s[0],status:e.jobStatus,startingTime:Math.floor(Date.now()/1e3)}),xe(t,"running"===e.jobStatus?"Running":"pending"===e.jobStatus?"Queued":e.jobStatus,0))}))}))}}function Pe(){var e="8";let t=C.getSelectedRows();if(!t.length)return e;var n=[];return t.length&&t.forEach((e=>{let t=j[e.id],i=A.filter((e=>e.internalID===t.id&&"succeeded"===e.status));if(i.length>=1){var a=i.reduce(((e,t)=>e&&e.startingTime>t.startingTime?e:t));n.push({id:a.internalID,prevConfig:a.isrPrevComputeConfig})}})),n.forEach((t=>{e<t.prevConfig&&(e=t.prevConfig)})),e}function Ee(){require(["DS/TransientWidget/TransientWidget"].concat([]),(function(e){var t=[],n={};de(t,n),e.showWidget("ENORIPE_AP","",{X3DContentId:JSON.stringify(ue(t,n))},{mode:"panel",width:700,height:800})}))}function Re(){let e=C.getSelectedRows();if(!e.length)return;let t=[];return e.forEach((e=>{let n=j[e.id],i=n&&-1!==c.getRvwTypes().concat(c.getIsrTypes()).indexOf(n.type)&&n.id;i&&t.push({physicalid:i,tenant:u.getPlatformId()})})),t}function je(){require(["DS/MaturityWidget/MaturityWidget"].concat([]),(function(e){x&&x.dialog&&x.dialog.destroy(),x=new e({externalSettings:u.getPlatformIdServices()}),x.addEvent("onMaturityCanceled",(()=>{x=null})),x.addEvent("onMaturityTransitionEnd",(e=>{if(!e||!e.data)return;let t={},n=[];e.data.forEach((e=>{let i=j[e.physicalid];if(!i)return;i.maturityDisp=c.getMaturityNlsValue(i.maturity="VPLM_SMB_Evaluation."+e.tostate);let a=e.tostate.toLowerCase();"released"===a&&!P.released||"obsolete"===a&&!P.obsolete?n.push(e.physicalid):t[e.physicalid]=i})),f.publish("DS/DMUwebR3Mctrl/R3MObjectModified",{modified:"maturity",data:j}),localStorage.setItem("r3mValidationObjects",JSON.stringify(j)),C.updateValidations(t),C.removeValidation(n)})),x.executeCmd(Re(),{context:{getSecurityContext:()=>({SecurityContext:u.getSecurityContext()})}},(()=>{}))}))}function Oe(e){c.getR2VActivityInfo(e).then((t=>{let n=j[e.validatedObjId];if(n.children[e.text]&&n.children[e.text].children){let i=n.children[e.text].children[e.objectId];if(i){i.dateCreat=t.result["ds6w:created"],i.dateModif=t.result["ds6w:modified"],i.icon=t.result["ds6w:icon"],i.ownerid=t.result.owner,i.owner=t.result["ds6w:responsible"],i.title=t.result["ds6w:label"],i.type=t.result["ds6w:type"];let e={};e[i.id]=i,C.updateValidations(e,!1,!0)}}}))}function ke(e){-1===W.indexOf(e[0])&&(c.evalTaskCells(e,(function(t){if(0===Object.keys(t).length&&t.constructor===Object){let t={r3mTaskCandiAssignment:"",r3mTaskEstiFinDate:"",r3mTaskEstiDuration:""},n={};n[e[0]]=t,C.updateValidations(n,!1,!0)}let n={},i={};var a=[];t.relateddata.candidateAssignees.forEach((function(e){a.push({label:e.dataelements.firstname+" "+e.dataelements.lastname,url:e.dataelements.image})})),n.r3mTaskCandiAssignment=a.length>=1?a:"",n.r3mTaskEstiFinDate=t.dataelements&&t.dataelements.dueDate?t.dataelements.dueDate:"",n.r3mTaskEstiDuration=function(e,t){var n="";if(void 0!==e&&void 0!==t&&""!==e&&""!==t){var i=e.trim().split(" ")[0];n=i+" "+b[("1"===i?"Single":"Multiple")+t]}return n}(t.dataelements.estimatedDurationInputValue,t.dataelements.estimatedDurationInputUnit),i[t.id]=n,C.updateValidations(i,!1,!0);let o=W.indexOf(e[0]);o>-1&&W.splice(o,1)})),W.push(e[0]))}function Te(e){-1===B.indexOf(e[0])&&(c.evalTaskCells(e,(function(t){if(0===Object.keys(t).length&&t.constructor===Object){let t={r3massignees:""},n={};n[e[0]]=t,C.updateValidations(n,!1,!0)}let n={},i={};var a=[];t.relateddata.assignees.forEach((function(e){a.push({label:e.dataelements.firstname+" "+e.dataelements.lastname,url:e.dataelements.image})})),n.r3massignees=a.length>=1?a:"",i[t.id]=n,C.updateValidations(i,!1,!0);let o=B.indexOf(e[0]);o>-1&&B.splice(o,1)})),B.push(e[0]))}function Fe(e){-1===L.indexOf(e[0])&&(c.evalIssueCells(e,(function(t,n){if(0===t.results.length){let t={r3massignees:""},n={};n[e[0]]=t,C.updateValidations(n,!1,!0)}t.results.forEach((function(e){let t=e.body,i={},a={};var o=[];t.assignees.forEach((function(e){o.push({label:e.fullName,url:n[e.user]})})),i.r3massignees=o.length>=1?o:"",a[t.physicalId]=i,C.updateValidations(a,!1,!0)}));let i=L.indexOf(e[0]);i>-1&&L.splice(i,1)})),L.push(e[0]))}function Ae(e){-1===U.indexOf(e[0])&&(c.evalIssueCells(e,(function(t){if(0===t.results.length){let t={r3mIssueApprovals:"",r3mIssueResolvedBy:""},n={};n[e[0]]=t,C.updateValidations(n,!1,!0)}t.results.forEach((function(e){let t=e.body,n={},i={};n.r3mIssueApprovals=!("Unassigned"===t.waitingOn||""===t.waitingOn),n.r3mIssueResolvedBy=0===t.resolvedBy.length?"No":"Yes("+t.resolvedBy.length.toString()+")",n.r3mIssuePriority=t.priority,i[t.physicalId]=n,C.updateValidations(i,!1,!0)}));let n=U.indexOf(e[0]);n>-1&&U.splice(n,1)})),U.push(e[0]))}function Ve(e){let t;function n(){let n=j[e[0]].children;j[e[0]].children={},t=n,j[e[0]].children[e[0]+"_context"]={id:e[0]+"_context",title:"Context",children:n}}-1===N.indexOf(e[0])&&(c.evalMetricIssueCells(e,(function(i){let a=Object.keys(i.issues).length>0,o=Object.keys(i.tasks).length>0;if(a||o){j[e[0]].children||(j[e[0]].children={}),a&&o?(j[e[0]].children[e[0]+"_issue"]||j[e[0]].children[e[0]+"_task"]||(n(),j[e[0]].children[e[0]+"_issue"]={id:e[0]+"_issue",title:"Issues",children:{}},j[e[0]].children[e[0]+"_task"]={id:e[0]+"_task",title:"Tasks",children:{}}),Object.assign(j[e[0]].children[e[0]+"_issue"].children,i.issues),O=Object.assign(O,i.issues),1===Object.keys(j[e[0]].children[e[0]+"_issue"].children).length&&(j[e[0]].children[e[0]+"_issue"].title="Issue"),Object.assign(j[e[0]].children[e[0]+"_task"].children,i.tasks),O=Object.assign(O,i.tasks),1===Object.keys(j[e[0]].children[e[0]+"_task"].children).length&&(j[e[0]].children[e[0]+"_task"].title="Task")):a?(j[e[0]].children[e[0]+"_issue"]||(n(),j[e[0]].children[e[0]+"_issue"]={id:e[0]+"_issue",title:"Issues",children:{}}),Object.assign(j[e[0]].children[e[0]+"_issue"].children,i.issues),O=Object.assign(O,i.issues),1===Object.keys(j[e[0]].children[e[0]+"_issue"].children).length&&(j[e[0]].children[e[0]+"_issue"].title="Issue")):(j[e[0]].children[e[0]+"_task"]||(n(),j[e[0]].children[e[0]+"_task"]={id:e[0]+"_task",title:"Tasks",children:{}}),Object.assign(j[e[0]].children[e[0]+"_task"].children,i.tasks),O=Object.assign(O,i.tasks),1===Object.keys(j[e[0]].children[e[0]+"_task"].children).length&&(j[e[0]].children[e[0]+"_task"].title="Task"));var r={};r[e[0]]=j[e[0]],void 0!==t&&Object.keys(t).length&&Object.keys(t).forEach((function(t){C.deleteNodes(e[0],t)})),C.updateValidations(r,!1,!1,!0)}})),N.push(e[0]))}function Ue(e){let t=j[e[0]];function n(e){let t=V.pending.indexOf(e);if(t>-1&&V.pending.splice(t,1),t=V.completed.indexOf(e),-1===t&&V.completed.push(e),t=V.running.indexOf(e),t>-1&&V.running.splice(t,1),V.pending.length>0){let e=V.running.length;V.pending.forEach((function(t){(0===V.running.length||V.running.length>0&&V.running.indexOf(t))&&(Ue([t]),e+=1)}))}}function i(e,t,n){let i=j[e];if(i){i.analysisStateProgress=Math.ceil(n/t*100);let e={};e[i.id]=i,C.updateValidations(e,!1)}}function a(e){let t="error",i=0,a=e.output[0].simPid;if("timeout"===e.status)n(e.simIds[0]);else if("failure"!==e.status&&Array.isArray(e.output))e.output.forEach((function(o){let r=o.nbTotalItf,s=o.nbOK,l=o.nbKO,d=o.nbPrev,u=o.nbTotalItf-(o.nbKO+o.nbOK),p=o.simPid,f=A.filter((e=>e.internalID===a)),m={};f.length>=1&&(m=f.reduce(((e,t)=>e&&e.startingTime>t.startingTime?e:t))),(q?new Promise((e=>{c.getIndexingTimestamp().then((t=>{e(t)}))})):Promise.resolve(null)).then((e=>{let n=null;e&&e.FTS&&e.FTS.allvaultsacl&&(n=e.FTS.allvaultsacl),"0"===o.ExecStatus?(t=n&&m.completionTime>n?"computedButNotIndexed":"notcomputed",i=0):"1"===o.ExecStatus?(t="Running",i=0):n&&m.completionTime>n?d>0||l>0||s>0?(t="startedButNotIndexed",i=0):0===d&&0===l&&0===s&&(t="computedButNotIndexed",i=0):s===r?t="donenoko":u&&l?(t="startedwithko",i=l):u&&0===l&&s?t="startednoko":u&&0===l&&0===s?(t="computed",i=r):r===l+s?(t="donewithko",i=l):t="startednoko",j[p]&&j[p].analysisState!==t&&(xe(j[p],t,i),C.updateStatusBar(j[p].id,"success"))})),n(e.output[0].simPid)}));else{let a=e.simIds?e.simIds[0]:"";j[a]&&j[a].analysisState!==t&&(xe(j[a],t,i),C.updateStatusBar(j[a].id,"failure")),n(e.simIds[0])}}let o=e[0];for(-1===V.all.indexOf(o)&&V.all.push(o),-1===V.pending.indexOf(o)&&V.pending.push(o);V.running.length<4&&-1===V.running.indexOf(o);){let e=j[o];if(!e)return;let n=c.getIsrTypes(),r=e.type;if(n.indexOf(r)>-1&&("unknown"===e.analysisState&&xe(e,"running",0,!0),-1===V.running.indexOf(o)))if(V.running.push(o),q){let n=A.filter((e=>e.internalID===t.id));if(n.length>=1){let t=n.reduce(((e,t)=>e&&e.startingTime>t.startingTime?e:t));"running"!==t.status&&"pending"!==t.status?c.evalAnalysisStatus(e,a,i):xe(e,"running"===t.status?"Running":"Queued",0)}else c.evalAnalysisStatus(e,a,i)}else c.evalAnalysisStatus(e,a,i)}}function Le(){const e=e=>!e.restrictedEditionDisp||"Activated"!==e.restrictedEditionDisp||!(!(e=>{let t=window.widget.getValue("xPref_CREDENTIAL"),n=t.split(".");return t=n[0]?n[0]:"",u.getUserLogin()===e.ownerid||["VPLMProjectLeader","VPLMAdmin"].includes(t)})(e)||"In Work"!==e.maturityDisp);let t=C.getSelectedRows();if(1!==t.length)return;let n=[];return t.forEach((t=>{let i=j[t.id],a=i&&(-1!==c.getRvwTypes().indexOf(i.type)||-1!==c.getIsrTypes().indexOf(i.type))&&i.id;if(!a)return;let o=i.validState;o="Failed"===o?"failed":"Passed"===o?"passed":"inProgress";let r=-1!==c.getIsrTypes().indexOf(i.type);const s=e(i);n.push({title:i.title,physicalid:a,status:o,isrType:r,display:s})})),n}function Ne(e,t){let n=j[e];return n.validState="passed"===t?"Passed":"failed"===t?"Failed":"InProgress",n.validStateDisp=c.getValidStateNlsValue(n.validState),ie(n),n}function We(){require(["DS/CATWebUXCVS/CATWebUXCVSComponent"].concat([]),(function(e){_&&_.clean(),_=null;let t=Le();t&&1===t.length&&(t=t[0],_=new e({title:t.title,physicalId:t.physicalid,current:t.status,isrType:t.isrType,parent:R,platformSettings:u.getPlatformIdServices(),tenant:u.getPlatformId(),securityContext:{getSecurityContext:()=>({SecurityContext:u.getSecurityContext()})},onChangeValidationStateCompleted:function(e){if(j[t.physicalid].validState=e.sValidationState,f.publish("DS/DMUwebR3Mctrl/R3MObjectModified",{modified:"validationState",data:j}),localStorage.setItem("r3mValidationObjects",JSON.stringify(j)),_&&_.clean(),_=null,!e)return;let n=Ne(t.physicalid,e.sValidationState);n&&C.updateValidations({[t.physicalid]:n})},onChangeValidationStateClose:function(){_&&_.clean(),_=null},onChangeValidationStateFailure:function(){_&&_.clean(),_=null}}))}))}let Be;function qe(e,t,n){return new Promise((function(t){c.getRvwFromValidatedObject(e).then((e=>{let i=[];e.result.forEach((function(e){e.outputs.review&&(i=i.concat(e.outputs.review.filter((e=>"DMUValidationValidation"===e["ds6w:type"])).map((e=>({id:e.physicalid,"ds6w:type":e["ds6w:type"]})))))})),i=Array.from(new Map(i.map((e=>[e.id,e]))).values()),t({objects:i,isCADroppedData:n})}))}))}function Je(e,t){if(0===e.length)return;let n=[];e.forEach((function(i){const a=i.objects.filter((function(e){return"DMUValidationValidation"===e["ds6w:type"]})).map((function(e){return e.id}));t?(e[0].isCADroppedData&&-1===n.indexOf(e[0].isCADroppedData[0].id)&&Q.openCAs.push(e[0].isCADroppedData[0]),Q.CAFound=Q.CAFound+(a.length>=1?1:0),a.forEach((function(e){Q.allDropValObjs.push({objectId:e})}))):(Q.nonCAFound=Q.nonCAFound+(a.length>=1?1:0),a.forEach((function(e){Q.allDropValObjs.push({objectId:e})})))}))}function ze(e,n){if(g){g.getRightPanelContent().querySelectorAll(".r3mRightView").forEach((function(e){g.getRightPanelContent().removeChild(e)}))}var i=t.createElement("div",{class:"r3mRightView"});i.style.height="100%";let a={name:"closeSidePanel",text:b.closeSidePanel,icon:"close",handler:function(){Q.caPropId=0,E.publish({event:"triptych-hide-panel"}),C.setInfoState(!1)}};I=new s({className:"r3mProperties",setEditButton:!0,readOnly:!1,setCloseButton:!0,typeOfDisplay:l.ALL,displayType:l.STANDARD,selectionType:l.NO_SELECTION,multiselection:l.MULTISEL_STD,collapseTabs:!1,appId:"ENOR3M_AP",actions:e?[a]:[{name:"prevCa",text:b.prevCa,icon:"chevron-left wux-ui-3ds",handler:function(){Q.caPropId>=0&&(Q.caPropId=Q.caPropId-1,pe())}},{name:"nextCa",text:b.nextCa,icon:"chevron-right wux-ui-3ds",handler:function(){Q.caPropId<Q.openCAs.length-1&&(Q.caPropId=Q.caPropId+1,pe())}},a]}).inject(i),n&&I.initDatas([]);let o=require("DS/DMUwebR3Mutils/DMUwebR3MwidgetUtils"),r={requestUtils:{get3DSwymUrl:o.get3DSwymUrl,get3DSearchUrl:o.get3DSearchUrl,get3DSpaceUrl:o.get3DSpaceUrl,getPlatformId:o.getPlatformId,getSecurityContext:o.getSecurityContext,getLang:o.getLang},onFacetModification:function(e){let t=[];Object.keys(e||{}).forEach((function(e){let n=O[e];n&&Object.keys(this[e]||{}).forEach((function(i){let a;"sValidationState"===i?(a=!0,Ne(e,this[i])):"iCheckState"===i?(a=!0,c.updateCheckStateValue(this[i],n)):"title"!==i&&"description"!==i||(a=!0,n[i]=this[i]),a&&-1===t.indexOf(e)&&t.push(e)}),this[e])}),e);let n={};t.forEach((e=>{ee(e).forEach((e=>{n[e]||(n[e]=j[e])}))})),C.updateValidations(n)}};return I.addFacets([{position:1,require:"DS/PIMwebPropertiesTabs/PIMwebIsrPropContextTab",supportMerge:!0,options:r,facet:{name:"interference_context",text:b.context,icon:"6w-what"}},{position:2,require:"DS/PIMwebPropertiesTabs/PIMwebIsrPropSpecTab",supportMerge:!0,options:r,facet:{name:"interference_specification",text:b.specifications,icon:"6w-how"}},{position:1,require:"DS/DMUReviewFacets/DMUwebR3MinfoRvwCheckTab",supportMerge:!0,options:r,facet:{name:"review_check",text:b.checks,icon:"check-review"}},{position:2,require:"DS/DMUReviewFacets/DMUwebR3MinfoRvwHighlightTab",supportMerge:!0,options:r,facet:{name:"review_highlight",text:b.highlights,icon:"highlight-review"}},{position:1,require:"DS/DMUReviewFacets/DMUwebR3MinfoRvwMembersTab",supportMerge:!0,options:r,facet:{name:"review_members",text:b.memberTabFacetTitle,icon:"users"}}]),g&&i.inject(g.getRightPanelContent()),i}function Xe(){C.updateFilterSelectionLabel("removeStatusDiv"),require("DS/Notifications/NotificationsManagerViewOnScreen").removeNotifications(),localStorage.removeItem("r3mDataLoadFromDrop"),C.updateFilterSelectionLabel("removeStatusDiv"),Q={CALabel:"",CATot:0,CAFound:0,nonCATot:0,nonCAFound:0,allDropValObjs:[],openCAs:[],caPropId:-1},I.initDatas([])}function Ge(e,i){Xe();let a=[],o=[],r=[];e.forEach((function(e){"Change Action"===e.objectType?a.push({id:e.objectId,serviceId:e.serviceId,type:e.objectType,displayName:e.displayName}):"SIMItfSimulation"===e.objectType||"DMUValidationValidation"===e.objectType||"DMUMarkupRepReference"===e.objectType||"DesignSight"===e.objectType?(Q.allDropValObjs.push({objectId:e.objectId}),r.push({id:e.objectId,serviceId:e.serviceId,type:e.objectType,displayName:e.displayName})):o.push({id:e.objectId,serviceId:e.serviceId,type:e.objectType})})),Q.nonCATot=o.length;var s,l=[],d=[];if(o.forEach((function(e){l.push(qe([e.id]))})),a.forEach((function(e){d.push(function(e,t,n){return new Promise((function(i){var a=u.get3DSpaceUrl()+"/resources/enorelnav/v2/navigate/getEcosystem?tenant="+u.getPlatformId(),o={items:e,trueREST:!1,direction:t?"out":"in",restrictedMode:!1,relations:t?["carealizedwhere_to"]:["rvw_validated_from"],lang:"en",responseMode:"ObjectsAndLinks",label:"ENOR3M_AP_"+u.getWidgetId(),widgetId:u.getWidgetId()},r={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:u.getSecurityContext()},type:"json",data:JSON.stringify(o),onComplete:function(a){if(t){let t=e;if(e.some((e=>void 0===e.displayName))){let n=a.objects.filter((e=>"Change Action"===e["ds6w:type"]));t=e.map((e=>{const t=n.find((t=>t.id===e.id));return t?{...e,displayName:t.name}:e}))}let n=a.objects.filter((e=>"Change Action"!==e["ds6w:type"])).map((e=>({id:e.physicalid,serviceId:e.serviceId,type:e["ds6w:type"]})));i({dropedData:t,data:n})}else i({objects:a.objects,isCADroppedData:n})},onFailure:function(){i([])}};require("DS/WAFData/WAFData").authenticatedRequest(a,r)}))}([e],!0))})),Q.CATot=a.length,P.mycreation=0,P.myselection=1,K(),C.updateFilterSelectionLabel(),C&&C.removeAll(),a.length>0&&0===o.length&&(0===r.length||i)){let e=1===a.length?a[0].displayName:a.length.toString()+" "+b.cas;Q.CALabel=e,C.updateFilterSelectionLabel("running",0,e)}if(!i){s=t.createElement("div",{class:"r3mLoadingValidations mask wux-datagridview-emptycontentmessage"}).inject(R);const e=t.createElement("div",{styles:{display:"flex","justify-content":"center"}}).inject(s);new n({shape:"circular",infiniteFlag:!0}).inject(e),t.createElement("div",{class:"r3mWelcomeText",html:b.openValidation,styles:{}}).inject(s)}Promise.all([Promise.all(d),Promise.all(l)]).then((function(e){var t=[];e[0].forEach((function(e){0!==e.data.length&&t.push(qe(e.data.map((e=>e.id)),0,e.dropedData))})),Promise.all(t).then((function(t){t.forEach((function(e){Je([e],!0)})),Je(e[1],!1);let n,l=!1;if(a.length>0&&0===o.length&&(0===r.length||i)){if(i&&1===a.length&&e[0]&&e[0][0]){let t=e[0][0].dropedData.find((e=>e.id===a[0].id));t&&(a[0].displayName=t.displayName)}n=1===a.length?a[0].displayName:a.length.toString()+" "+b.cas,Q.CALabel=n,0===Q.CAFound&&C.updateFilterSelectionLabel("notstarted",0,n),l=!0}a.length>0&&pe();let d={data:{obj:Q.allDropValObjs},openCAs:Q.openCAs,caLen:a.length,valFndLen:Q.CAFound,caLbl:n,isCaToRvwFound:l};localStorage.setItem("r3mDataLoadFromDrop",JSON.stringify(d)),Q.allDropValObjs.length>0&&le(i?"deleteCreationLoop":"dontShowLoader"),require(["DS/PADUtils/views/PADAlert"].concat([]),(function(e){if(Q.CATot>0){let t="";0===Q.CAFound?t=Q.CATot>1?b.novalidationallca:b.novalidationca:Q.CAFound!==Q.CATot&&(t=b.novalidationsomeca),""!==t&&e.displayNotification({msg:t,eventID:"warning"})}if(Q.nonCATot>0){let t="";0===Q.nonCAFound?t=Q.nonCATot>1?b.novalidationall:b.novalidation:Q.nonCAFound!==Q.nonCATot&&(t=b.novalidationsome),""!==t&&e.displayNotification({msg:t,eventID:"warning"})}})),s&&setTimeout((function(){s.destroy()}),10)}))}))}te(),u.onTenantModified((e=>{Be||(Be=!0,C.removeAll(),e.then((()=>{Be=!1,le()})))})),c.onTenantModified((()=>{c.getColumnsNls().then(C.onTenantModified)})),u.getWidget().addEvent("onRefresh",(function(){var e=u.getWidgetData();Object.keys(e).length>0&&(window.widget.data=e,window.widget.data.loadDataFromCopiedLink=!1),Be||le()})),this._fillSelectionFrom=function(e,t){e="UnusedToRemove";let n=z.find((t=>t.WidgetId===e));if(n)n.paths=t;else{let n={WidgetId:e,paths:t};z.push(n)}},this._setSelectionFromEvent=function(e){let t=[];ce(t,e.data.paths,e.data.attributes),e.metadata&&e.metadata.originWidgetId&&this._fillSelectionFrom(e.metadata.originWidgetId,t)},this._setSelectionFromListener=function(e){let t=[];e&&e.data&&e.data.items&&e.data.items.forEach((function(e){t.push({envId:u.getPlatformId(),serviceId:e.serviceId?e.serviceId:"3DSpace",contextId:u.getSecurityContext(),objectId:e.objectId,objectType:e.objectType,path:void 0})})),this._fillSelectionFrom("preview",t)},f.subscribe("DS/PADUtils/PADCommandProxy/select",this._setSelectionFromEvent.bind(this)),f.subscribe("DS/ENO/select",this._setSelectionFromEvent.bind(this)),D||(M=u.getWidgetAppId()+"_CompassSocket_"+u.getWidgetId(),D=new i.Socket(M),D.subscribeServer("com.ds.compass",window.parent)),D.subscribeServer("com.ds.compass",window),D.addListener("onSetX3DContent",this._setSelectionFromListener.bind(this)),D.addListener("onResetX3DContent",this._setSelectionFromListener.bind(this)),f.subscribe("DS/PADUtils/PADCommandProxy/validationState",(e=>{const{validationId:t,checkId:n,checkStatus:i}=e,a=j[t];let o=a.children&&a.children[`${a.id}_check`];o&&o.children[n]&&(o.children[n].validState=i,o.children[n].validStateDisp=i),Ne(t,a.validState.toLowerCase())})),this.buildUX=function(){return g?Promise.resolve():new Promise(function(e){var n=t.createElement("div",{class:"r3mMainView",styles:{width:"100%",height:"100%"}}),i=ze(!1,!0);function s(){}function l(e,t){if(!C||!t)return!1;var n={protocol:"3DXContent",version:"1.1",data:{items:[]},source:u.getWidgetAppId(),widgetId:u.getWidgetId()},i=[],a={};return de(i,a),ce(n.data.items,i,a),e.dataTransfer.setData("Text",JSON.stringify(n)),!1}g=new r,g.init({withtransition:!0,container:this,right:{withClose:!1},modelEvents:E},null,n,i),c.getColumnsNls().then((t=>{C=new a({parent:n,onSelect:fe,onUnselect:me,getFilterValues:function(){return Object.assign({},P)},getIsrTypes:function(){return c.getIsrTypes()},getR2VActivityInfo:Oe,onFiltersModified:ge,onMassCreate:ve,onPref:ye,onInfo:be,allowRelations:we,allowCopyLink:Se,onCopyLink:Ie,onPublishTo3DSwym:Ce,onRelations:Ee,allowMaturityState:Re,onMaturityState:je,onAnalysisState:Ue,onMetricIssue:Ve,onIssueCells:Ae,onTaskCells:ke,onIssueAssigneesCells:Fe,onTaskAssigneesCells:Te,allowValidationState:Le,allowUpdateSimulation:Me,getCSIcomputeToken:De,onValidationState:We,onUpdateSimulation:_e,getPreviousConfig:Pe,columns:t,cbDnD:{onDragStartCell:l,onDragOverCell:s,onDragEnterBlank:s,onDragOverBlank:s,onDragStartRowHeader:l,onDragOverRowHeader:s}}),C&&(C.updateFilterSelectionLabel(),C.checkFilterAndFetchValue()),new o({onDrop:Ge,openLbl:"  "+b.openValidation}).manageDragAndDrop(n),e()}))}.bind(this))}.bind(R),this.refresh=function(){let e=u.getDatafromContent();e&&Object.keys(e).length>=1?Ge(e.obj):le()},this.destroy=function(){window.console.error("TODO!!")}}}),I=[],D=function(e){return e&&e.id?(I.some((function(n){return n.id===e.id&&(t=n.enveloppe)})),t):null;var t};return Object.freeze({giveCtrl:function(e){return D(e)},getCtrl:function(e){if(!e||!e.id)return null;var t=D(e);if(!t){var n=new C({parent:e.parent}),i={buildUX:function(){return n?n.buildUX.apply(null,arguments):null},refresh:function(){return n?n.refresh.apply(null,arguments):null},destroy:function(){n&&(n.destroy.apply(null,arguments),n=null,I.some((function(e,t){if(e.enveloppe===i)return I.splice(t,1),i=null,!0})))}};Object.freeze(i),I.push({id:e.id,enveloppe:i}),t=i}return t}})}));