define("DS/DMUBaseCommands/DMUCutCmd",["DS/CATWebUXComponents/DMUCommand","DS/DMUBaseExperience/EXPManagerSet"],(function(e,t){"use strict";return e.extend({init:function(e){e.mode="shared",this._parent(e);var n=this,i=t.getManager({name:"DMUUserExperienceManager",context:n.getFrameWindow()});i&&i.refreshCCPCommandsAvailability(),this.beginExecute=function(){(i=t.getManager({name:"DMUUserExperienceManager",context:n.getFrameWindow()}))&&i.copySelectedDMUElements(!0),n.cancel()}}})})),define("DS/DMUBaseCommands/DMURightSidePanelCmd",[].concat(["DS/ENOPAD3DViewer/commands/PAD3DViewerRightSidePanel","DS/PADUtils/PADContext","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/Selection/CSOManager","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/EXPToolsContext"]),(function(e,t,n,i,o,a){"use strict";return e.extend({init:function(e){var r,s,l,c=[],d=[],g=t.get(),u={get:function(){let e=o.getReviewContext({context:g}),t=e&&e.getValidation()&&e.getValidation().getContext()?e.getValidation().getContext().getJsonContextTypes()[0]:null,r=a.getParentType(t)?a.getParentType(t):t;var s,l,d,u=i.get();if((u.length&&u.some((function(e){return n.isAModelPath(e.pathElement)}))||"DesignSight"===r||"Requirement Specification"===r||"Requirement"===r||"Document"===r)&&u.length)for(var m=u[0].pathElement.externalPath.length-1;m>=0;--m){if(!(d=u[0].pathElement.externalPath[m])||n.isPLMNode(d))return u;if(d.getDibInfo){let e=m>0?u[0].pathElement.externalPath[m-1]:null;return[{dibInfo:d.getDibInfo(),parentDibInfo:e&&e.getDibInfo?e.getDibInfo():null}]}if(d.getDocInfo)return[{docInfo:d.getDocInfo(),parentDocInfo:null}];if(d.getReqInfo)return[{reqInfo:d.getReqInfo(),parentDocInfo:null}]}if(!c.length)return[];var p=o.getReviewContext({context:g}),f=p?p.getReviewCtxInformation():{};return f&&f.reviewId?s=[{mkpID:f.reviewId}]:g&&g.getApplicativeData().getLoadedItfData&&(l=(l=g.getApplicativeData().getLoadedItfData())&&l.data),s||(l||[])},onPostAdd:function(e){return r=e,1},onPostRemove:function(e){return s=e,2},onEmpty:function(e){return l=e,3},unsubscribe:function(e){1===e?r=null:2===e?s=null:3===e&&(l=null)}},m=o.getEventsController({viewer:g.getViewer()});function p(e){1===e&&r?r():2===e&&s?s():3===e&&l&&l()}c.push(i.onPostAdd(p.bind(this,1))),c.push(i.onPostRemove(p.bind(this,2))),c.push(i.onEmpty(p.bind(this,3))),d.push(m.addEvent("onDMUMarkupCreationSucceeded",p.bind(this,1))),d.push(m.addEvent("onDMUMarkupLoaded",p.bind(this,1))),d.push(m.addEvent("onReviewRemoved",p.bind(this,1))),this.getXSO=function(){return u},this.getID=function(e){return e&&e.mkpID?e.mkpID:e&&e.isrID?e.isrID:e&&e.dibInfo?e.dibInfo.id:e&&e.reqInfo?e.reqInfo.id:e&&e.docInfo?e.docInfo.validatedPaths[0]:Object.getPrototypeOf(this).getID.apply(this,arguments)},this.getRelationID=function(e){return e&&e.mkpID||e&&e.isrID?void 0:e&&e.parentDibInfo?e.parentDibInfo.id:e&&e.reqInfo||e&&e.docInfo?null:Object.getPrototypeOf(this).getRelationID.apply(this,arguments)},this.getType=function(e){return e&&e.mkpID?"Markup":e&&e.type?e.type:e&&e.dibInfo?e.dibInfo.type:e&&e.reqInfo?e.reqInfo.type:e&&e.docInfo?e.docInfo.type:Object.getPrototypeOf(this).getType.apply(this,arguments)},this.destroy=function(){p(3),c.forEach(i.unsubscribe,i),c=[],d.forEach(m.removeEvent,m),d=[],r=s=l=null,Object.getPrototypeOf(this).destroy.apply(this,arguments)},this._parent(e),p(1)},isNodeValid:function(e){var t=this._parent(e);return!t&&e&&(e.mkpID||e.isrID||e.dibInfo||e.docInfo||e.reqInfo)&&(t=!0),t},getServiceId:function(e){var t="";return!e||e.mkpID||e.isrID||e.dibInfo||e.docInfo||e.reqInfo||(t=this._parent(e)),t}})})),define("DS/DMUBaseCommands/DMUCopyCmd",["DS/CATWebUXComponents/DMUCommand","DS/DMUBaseExperience/EXPManagerSet"],(function(e,t){"use strict";return e.extend({init:function(e){e.mode="shared",this._parent(e);var n=this,i=t.getManager({name:"DMUUserExperienceManager",context:n.getFrameWindow()});i&&i.refreshCCPCommandsAvailability(),this.beginExecute=function(){(i=t.getManager({name:"DMUUserExperienceManager",context:n.getFrameWindow()}))&&i.copySelectedDMUElements(),n.cancel()}}})})),define("DS/DMUBaseCommands/EXPToolsWUX",["DS/Selection/CSOManager","DS/Selection/HSOManager","DS/Selection/PSOManager","DS/DMUMeasurable/DMUToolsSceneGraph"],(function(e,t,n,i){"use strict";return{addInCSO:function(t,n){if(t){var o=t.path?t.path:t.getNode&&t.getNode()?i.buildPathElement(t.getNode()):t.getDMUType?i.buildPathElement(t):null;n||e.empty(),o&&e.add({pathElement:o})}},emptyCSO:function(){e.empty()},getCSO:function(){for(var t=e.get(),n=[],i=0;i<t.length;i++)n.push(t[i].pathElement);return n},addInHSO:function(e,n){if(e){var o=e.path?e.path:e.getNode&&e.getNode()?i.buildPathElement(e.getNode()):null;n||t.empty(),t.add({pathElement:o})}},emptyHSO:function(){t.empty()},addInPSO:function(e,t){if(e){var o=e.path?e.path:e.getNode&&e.getNode()?i.buildPathElement(e.getNode()):null;t||n.empty(),n.add({pathElement:o})}},emptyPSO:function(){n.empty()}}})),define("DS/DMUBaseCommands/DMUSetAsPreviewCmd",["require","exports","DS/CATWebUXComponents/DMUCommand","DS/Selection/CSOManager","DS/DMUBaseExperience/EXPManagerSet","DS/DMUBaseUIControllers/DMUCommentsController","DS/DMUBaseExperience/DMUContextManager"],(function(e,t,n,i,o,a,r){"use strict";return class extends n{beginExecute(){const e=e=>{const t=i.get();for(let n=t.length-1;n>=0;n--){const i=t[n];if(i&&i.pathElement){const t=i.pathElement.getLastElement(!0);if(t&&t.getDMUType&&t.getDMUType()===e)return i.pathElement}}};let t=r.getReviewContext({viewer:this.getFrameWindow().getViewer()});const n=null==t?void 0:t.getUIManager();if(t&&n){let i=o.getManager({name:"DMU2DSheetManager",context:this.getFrameWindow()});if(i&&i.isADocumentDisplayed()&&("Document"===i.getDocumentType()||"Requirement"===i.getDocumentType())){const i=e("DMUComment");let o=a.giveDMUCommentsController({context:this.getFrameWindow()});if(o){const e=o.getDMUObjectFromPathElement(i)||t.getDMUObjectFromPathElement(i);e&&n.registerElementIdAsPreview(e.getAttribute("sUuid"),e.getParent(),e.getAttribute("sParentCommentId"))}}else{const i=e("DMUSlide");if(i){const e=t.getDMUObjectFromPathElement(i);e&&n.registerElementIdAsPreview(e.getAttribute("sUuid"),e.getParent())}}}this.done()}}})),define("DS/DMUBaseCommands/DMUPasteCmd",["DS/CATWebUXComponents/DMUCommand","DS/DMUBaseExperience/EXPManagerSet"],(function(e,t){"use strict";return e.extend({init:function(e){e.mode="shared",this._parent(e);var n=this,i=t.getManager({name:"DMUUserExperienceManager",context:n.getFrameWindow()});i&&i.refreshCCPCommandsAvailability(),this.beginExecute=async function(){(i=t.getManager({name:"DMUUserExperienceManager",context:n.getFrameWindow()}))&&await i.pasteDMUElements(),n.cancel()}}})})),define("DS/DMUBaseCommands/DMURightSidePanelCmdV2",["DS/InformationWebAfrCmd/cmd/InformationCmd","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/utils/EditPropUtils","DS/PADUtils/PADSettingsMgt","DS/DMUBaseExperience/DMUContextManager","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/Selection/CSOManager","DS/Utilities/Utils","DS/PADServices/utils/R2VProperties","i18n!DS/PADUtils/assets/nls/PADUtils.json"].concat([]),(function(e,t,n,i,o,a,r,s,l,c){"use strict";let d,g,u,m,p,f,h=[],D=[],v=!1;function C(e){let t=!1,n=e.pathElement;for(;n&&!a.isPLMNode(n.getLastElement(!0));)n=n.getParentPath();if(n){const e=n.getLastElement(!0);t=a.isInternalJSONObject(e)}return t}function S(e,t){let n,i=t.pathElement;for(;i&&!a.isPLMNode(i.getLastElement(!0))&&!a.isTileSetNode(i.getLastElement(!0));)i=i.getParentPath();if(!i&&e.isSelectiveLoadingActivated())n=e.getController().getOOCSelectedReferenceID();else{let e=i.getLastElement(!0);n=a.getNodeID(e)}return n}function E(e){let t,n=e.pathElement;for(;n&&!a.isPLMNode(n.getLastElement(!0))&&!a.isTileSetNode(n.getLastElement(!0));)n=n.getParentPath();if(n){let e=n.getLastElement(!0);if(a.isInstance(e))t=a.getNodeID(e);else{let e=n.getParentPath().getLastElement(!0);t=a.getNodeID(e)}}return t}function I(e){let t,n=e.pathElement;for(;n&&!a.isPLMNode(n.getLastElement(!0))&&!a.isTileSetNode(n.getLastElement(!0));)n=n.getParentPath();if(n){let e=n.getLastElement(!0);t=a.getNodeType(e)}return t}function P(){let e,t,n,i,s=[],l=[],c=o.getReviewContext({context:g}),d=c?c.getReviewCtxInformation():{};d&&d.reviewId?e=[{mkpID:d.reviewId}]:g&&g.getApplicativeData().getLoadedItfData&&(t=g.getApplicativeData().getLoadedItfData(),t=t&&t.data),f&&f.getCurrentSelection&&(s=f.getCurrentSelection());let u=s.filter((e=>e.pointedObjectPhysicalID));if(l=u&&u.length>0?u.map((e=>{const t=e.pointedObjectPhysicalID;return e.pointedObjectPhysicalID[t.length-1]})):s.map((e=>e.idPath[0].split("|")[0].split(":")[0])).filter(((e,t,n)=>n.indexOf(e)===t)),i=e?e[0]:t?t[0]:void 0,l&&l.length>0){let e=[];for(let t=l.length-1;t>=0;--t)e.push({getID:()=>l[t]});if(e&&e.length>0)return e}else{let e=r.get();if(e.length)for(let t=e[0].pathElement.externalPath.length-1;t>=0;--t){if(n=e[0].pathElement.externalPath[t],!n||a.isPLMNode(n))return[{getID:()=>a.getNodeID(n),pathElement:e[0].pathElement,getRelationID:()=>E({pathElement:e[0].pathElement})}];if(!n||a.isTileSetNode(n))return[{getID:()=>a.getNodeID(n),getI3DX:()=>a.getNodeI3DX(n),pathElement:e[0].pathElement,getRelationID:()=>E({pathElement:e[0].pathElement})}];if(n.getDibInfo){let o=t>0?e[0].pathElement.externalPath[t-1]:null;i={dibInfo:n.getDibInfo(),parentDibInfo:o&&o.getDibInfo?o.getDibInfo():null}}if(n.getDocInfo&&(i={docInfo:n.getDocInfo(),parentDocInfo:null}),n.getReqInfo&&(i={reqInfo:n.getReqInfo(),parentDocInfo:null}),i)break}}return i?[{getID:function(){return i&&i.mkpID?i.mkpID:i&&i.isrID?i.isrID:i&&i.dibInfo?i.dibInfo.id:i&&i.reqInfo?i.reqInfo.id:i&&i.docInfo?i.docInfo.validatedPaths[0]:""},getType:function(){return i&&i.mkpID?"Markup":i&&i.type?i.type:i&&i.dibInfo?i.dibInfo.type:i&&i.reqInfo?i.reqInfo.type:i&&i.docInfo?i.docInfo.type:""},getRelationID:function(){return i&&i.mkpID||i&&i.isrID?void 0:i&&i.parentDibInfo?i.parentDibInfo.id:i&&i.reqInfo||i&&i.docInfo?null:""}}]:[]}function M(e,t){const n=t.pathElement?a.getNodeID(t.pathElement.externalPath[1]):t.getID();return i.getSetting("enopad3dviewer_lightNodeModel")&&e.getController().getRootStats(n)?e.getController().getRootStats(n).serviceId:"3DSpace"}function w(){return{SecurityContext:i.getSetting("pad_security_ctx"),tenant:i.getSetting("x3dPlatformId")}}function y(e,n){let i=P();if(i=i.filter((e=>!("function"==typeof e.getNodeSource&&1===e.getNodeSource()))),i.length)for(let o=0;o<i.length;++o){const a=i[o];if("r2vsurvey"===M(e,a)||!0===C(a)){const t=e.getPropertiesFacet();for(let e=0;e<t.length;++e){const i=t[e];if(i.facet){if(i.facet.text||(i.facet.text=c[`${i.facet.name}_cmd_title`]),i.actions&&i.actions.length>0)for(let e=0;e<i.actions.length;++e)i.actions[e].text=c[i.facet.name+i.actions[e].text];n.removeFacets([i.facet.name])}}}else if(!0!==C(a)){n.removeFacets([t.FACET_VIEWS]),n.removeFacets([t.FACET_DERIVEDOUTPUT]);const i=e.getPropertiesFacet();for(let e=0;e<i.length;++e){const t=i[e];if(t.facet){if(t.facet.text||(t.facet.text=c[`${t.facet.name}_cmd_title`]),t.actions&&t.actions.length>0)for(let e=0;e<t.actions.length;++e)t.actions[e].text=c[t.facet.name+t.actions[e].text];n.addFacets([t])}}}}}function b(){return s.debounce((()=>{let e=P();if(0!==e.length){y(g,d);let t=[];e.forEach((e=>{let i=new Promise((t=>{let i={ID:"",relation:"",type:"",i3dx:"",getID:function(){return this.ID},getRelationID:function(){return this.relation},getType:function(){return this.type},getI3DX:function(){return e.options&&e.options.grid?e.getI3DX():function(e){let t,n=e.pathElement;for(;n&&!a.isPLMNode(n.getLastElement(!0))&&!a.isTileSetNode(n.getLastElement(!0));)n=n.getParentPath();if(n){const e=n.getLastElement(!0);t=a.getNodeI3DX(e)}return t}(e)}};"function"!=typeof e.getID&&(e.getID=function(){return S(g,e)}),"function"!=typeof e.getRelationID&&(e.getRelationID=function(){return E(e)}),void 0===e.type&&(e.options&&e.options.type?e.type=e.options.type:e.type=I(e)),"r2vsurvey"===M(g,e)&&l.getPropModel({objectId:S(g,e),type:I(e),serviceId:M(g,e)}).then(t).catch((e=>new Error(e))),i.ID=e.getID(),!0===C(e)?i.relation=void 0:i.relation=e.getRelationID(),i.type=e.type,t(n.getModelFromSelectedNode(i))}));t.push(i)})),Promise.all(t).then((e=>{d.initDatas(e)})).catch((e=>new Error(e)))}else d.initDatas([])}),100)}let x={};return x.showPanel=function(n,i){u=i.executionContext,g=u.getComponent("Viewer"),m=u.getComponent("AFR_ModelEvents"),p=m.subscribe({event:"onWillLoadApp"},(()=>{x.hidePanel(n,i)})),v=!1,d=new e({executionContext:i.executionContext,args:{appId:"undefined"!=typeof widget&&null!==widget?widget.getValue("appId"):"",className:"enxpropertiestab",multiselection:t.MULTISEL_NO,setEditButton:!1,readOnly:!0,typeOfDisplay:t.ALL,selectionType:t.NO_SELECTION,actions:[{name:"action_close_panel",text:"SUPER TEST",icon:"close",handler:()=>{v||(v=!0,x.hidePanel())}}],events:{onCancel:()=>{i.executionContext.getComponent(WAfrStandardComponentKey.HandlerComponent).setCheckState({id:"DMURightSidePanel",state:!1})}},context:{getSelectedNodes:P,getSecurityContext:w}}}),d.done=n,f=u.getComponent("DMUApplicativeManagerComponent"),d.beginExecute(),function(e,n){n.removeFacets([t.FACET_VIEWS]),n.removeFacets([t.FACET_DERIVEDOUTPUT]);let i=e.getPropertiesFacet(),o=[];for(let e=0;e<i.length;++e){let t=new Promise((t=>{const o=i[e];if(o.facet){if(o.facet.text||(o.facet.text=c[`${o.facet.name}_cmd_title`]),o.actions&&o.actions.length>0)for(let e=0;e<o.actions.length;++e)o.actions[e].text=c[o.facet.name+o.actions[e].text];n.addFacets([o])}t()}));o.push(t)}}(g,d),y(g,d),function(){let e=b();h.push(r.onPostAdd(e)),h.push(r.onPostRemove(e)),h.push(r.onEmpty(e))}();let a=o.getEventsController({viewer:g.getViewer()}),s=b();D.push(a.addEvent("onApplicativeSelectionChanged",(function(){s()}))),D.push(a.addEvent("onDMUMarkupCreationSucceeded",P)),D.push(a.addEvent("onDMUMarkupLoaded",P)),D.push(a.addEvent("onReviewRemoved",P))},x.hidePanel=function(e,t){u=t.executionContext,g=u.getComponent("Viewer"),m=u.getComponent("AFR_ModelEvents"),d.done=e,v=!0,h.forEach(r.unsubscribe,r),h=[];let n=o.getEventsController({viewer:g.getViewer()});n&&D.forEach(n.removeEvent,n),D=[],p&&m.unsubscribe(p),p=void 0,d&&d.closePanel()},x})),define("DS/DMUBaseCommands/DMUPasteSpecialCmd",["DS/CATWebUXComponents/DMUCommand","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/EXPManagerSet","DS/DMUControls/DMUPasteWithOptionsPanel"],(function(e,t,n,i){"use strict";return e.extend({init:function(e){e.mode="shared",this._parent(e);var o=this,a=n.getManager({name:"DMUUserExperienceManager",context:o.getFrameWindow()});a&&a.refreshCCPCommandsAvailability(),this.beginExecute=function(){if(a=n.getManager({name:"DMUUserExperienceManager",context:o.getFrameWindow()})){var e=a.getCCPTarget();if(!e){var r=t.getReviewContext({viewer:o.getFrameWindow().getViewer()});r&&r.getCurrentSessionMarkup()&&r.getCurrentSessionMarkup().getCurrentSlide&&(e=r.getCurrentSessionMarkup().getCurrentSlide())}if(e){var s=a.areOccurenceOverloadsCopied();new i({frmWindow:o.getFrameWindow(),prefs:{overloadPasteSpecial:s,displayAssociateFormatPref:!s&&"DMUSlide"===e.getType(),displayCreateNewSlidePref:!s&&"DMUSlide"===e.getType(),displayCameraPref:!s},cb:function(e){a&&a.pasteDMUElements(e),null}})}}o.cancel()}}})})),define("DS/DMUBaseCommands/DMUSwitch3DMarkersResponsiveDisplayCmd",["DS/CATWebUXComponents/DMUCommandCheckHeader","DS/DMUBaseUIControllers/DMUMarkupsController"],(function(e,t){"use strict";let n,i,o=e.extend({init:function(e){this._parent(e,{}),i=this;var t=this.onStateChange((function(){i.getState()?o.Enable3DMarkerResponsiveDisplay():o.Disable3DMarkerResponsiveDisplay()})),n=this._destroy;this._destroy=function(){i._modelEvents.unsubscribe(t),n.call(i)},this.setState("true"===localStorage.getItem("DMU3DMarkersResponsiveDisplay"))},_destroy:function(){this._parent()}});return o.Enable3DMarkerResponsiveDisplay=function(e,o){!n&&o?n=o.executionContext.getComponent("Viewer"):n||o||(n=i.getFrameWindow().getViewer());let a=t.giveDMUMarkupsController({context:o&&o.executionContext?n.getViewer():n});a&&a.setResponsiveDisplayFlag(!0),localStorage.setItem("DMU3DMarkersResponsiveDisplay","true"),e&&e()},o.Disable3DMarkerResponsiveDisplay=function(e,o){!n&&o?n=o.executionContext.getComponent("Viewer"):n||o||(n=i.getFrameWindow().getViewer());let a=t.giveDMUMarkupsController({context:o&&o.executionContext?n.getViewer():n});a&&a.setResponsiveDisplayFlag(!1),localStorage.setItem("DMU3DMarkersResponsiveDisplay","false"),e&&e()},o})),define("DS/DMUBaseCommands/CATRightSidePanelCmd",["DS/InformationWebAfrCmd/cmd/InformationCmd","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/utils/EditPropUtils","DS/PADUtils/PADSettingsMgt","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/Selection/CSOManager","DS/Utilities/Utils","DS/PADServices/utils/R2VProperties","i18n!DS/PADUtils/assets/nls/PADUtils.json"].concat([]),(function(e,t,n,i,o,a,r,s,l){"use strict";let c,d,g,u,m,p=[],f=!1;function h(e){let t=!1,n=e.pathElement;for(;n&&!o.isPLMNode(n.getLastElement(!0));)n=n.getParentPath();if(n){const e=n.getLastElement(!0);t=o.isInternalJSONObject(e)}return t}function D(e,t){let n,i=t.pathElement;for(;i&&!o.isPLMNode(i.getLastElement(!0))&&!o.isTileSetNode(i.getLastElement(!0));)i=i.getParentPath();if(!i&&e.isSelectiveLoadingActivated())n=e.getController().getOOCSelectedReferenceID();else{let e=i.getLastElement(!0);n=o.getNodeID(e)}return n}function v(e){let t,n=e.pathElement;for(;n&&!o.isPLMNode(n.getLastElement(!0))&&!o.isTileSetNode(n.getLastElement(!0));)n=n.getParentPath();if(n){let e=n.getLastElement(!0);t=o.getNodeType(e)}return t}function C(){let e,t,n=a.get(),i=n.length&&n.some((function(e){return o.isAModelPath(e.pathElement)}));if(n.length)for(let i=n[0].pathElement.externalPath.length-1;i>=0;--i){if(e=n[0].pathElement.externalPath[i],!e||o.isPLMNode(e))return n.map((({pathElement:e})=>({getID:()=>e?o.getNodeID(e.getLastElement(!0)):""})));if(e.getDibInfo){let o=i>0?n[0].pathElement.externalPath[i-1]:null;t=[{dibInfo:e.getDibInfo(),parentDibInfo:o&&o.getDibInfo?o.getDibInfo():null}]}e.getDocInfo&&(t=[{docInfo:e.getDocInfo(),parentDocInfo:null}]),e.getReqInfo&&(t=[{reqInfo:e.getReqInfo(),parentDocInfo:null}])}return i?n:t?[{getID:function(){return t&&t&&t.dibInfo?t.dibInfo.id:t&&t.reqInfo?t.reqInfo.id:t&&t.docInfo?t.docInfo.validatedPaths[0]:""},getType:function(){return t&&t&&t.type?t.type:t&&t.dibInfo?t.dibInfo.type:t&&t.reqInfo?t.reqInfo.type:t&&t.docInfo?t.docInfo.type:""},getRelationID:function(){return t&&t.parentDibInfo?t.parentDibInfo.id:t&&t.reqInfo||t&&t.docInfo?null:""}}]:[]}function S(e,t){const n=t.pathElement?o.getNodeID(t.pathElement.externalPath[1]):t.getID();return i.getSetting("enopad3dviewer_lightNodeModel")&&e.getController().getRootStats(n)?e.getController().getRootStats(n).serviceId:"3DSpace"}function E(){return{SecurityContext:i.getSetting("pad_security_ctx"),tenant:i.getSetting("x3dPlatformId")}}function I(e,n){let i=C();if(i=i.filter((e=>!("function"==typeof e.getNodeSource&&1===e.getNodeSource()))),i.length)for(let o=0;o<i.length;++o){const a=i[o];if("r2vsurvey"===S(e,a)||!0===h(a)){const t=e.getPropertiesFacet();for(let e=0;e<t.length;++e){const i=t[e];if(i.facet){if(i.facet.text||(i.facet.text=l[`${i.facet.name}_cmd_title`]),i.actions&&i.actions.length>0)for(let e=0;e<i.actions.length;++e)i.actions[e].text=l[i.facet.name+i.actions[e].text];n.removeFacets([i.facet.name])}}}else if(!0!==h(a)){n.removeFacets([t.FACET_VIEWS]),n.removeFacets([t.FACET_DERIVEDOUTPUT]);const i=e.getPropertiesFacet();for(let e=0;e<i.length;++e){const t=i[e];if(t.facet){if(t.facet.text||(t.facet.text=l[`${t.facet.name}_cmd_title`]),t.actions&&t.actions.length>0)for(let e=0;e<t.actions.length;++e)t.actions[e].text=l[t.facet.name+t.actions[e].text];n.addFacets([t])}}}}}function P(){let e=r.debounce((()=>{let e=C();if(0!==e.length){I(d,c);let t=[];e.forEach((e=>{let i=new Promise((t=>{let i={ID:"",relation:"",type:"",i3dx:"",getID:function(){return this.ID},getRelationID:function(){return this.relation},getType:function(){return this.type},getI3DX:function(){return e.options&&e.options.grid?e.getI3DX():function(e){let t,n=e.pathElement;for(;n&&!o.isPLMNode(n.getLastElement(!0))&&!o.isTileSetNode(n.getLastElement(!0));)n=n.getParentPath();if(n){const e=n.getLastElement(!0);t=o.getNodeI3DX(e)}return t}(e)}};"function"!=typeof e.getID&&(e.getID=function(){return D(d,e)}),"function"!=typeof e.getRelationID&&(e.getRelationID=function(){return function(e){let t,n=e.pathElement;for(;n&&!o.isPLMNode(n.getLastElement(!0))&&!o.isTileSetNode(n.getLastElement(!0));)n=n.getParentPath();if(n){let e=n.getLastElement(!0);if(o.isInstance(e))t=o.getNodeID(e);else{let e=n.getParentPath().getLastElement(!0);t=o.getNodeID(e)}}return t}(e)}),void 0===e.type&&(e.options&&e.options.type?e.type=e.options.type:e.type=v(e)),"r2vsurvey"===S(d,e)&&s.getPropModel({objectId:D(d,e),type:v(e),serviceId:S(d,e)}).then(t).catch((e=>new Error(e))),i.ID=e.getID(),!0===h(e)?i.relation=void 0:i.relation=e.getRelationID(),i.type=e.type,t(n.getModelFromSelectedNode(i))}));t.push(i)})),Promise.all(t).then((e=>{c.initDatas(e)})).catch((e=>new Error(e)))}else c.initDatas([])}),100);p.push(a.onPostAdd(e)),p.push(a.onPostRemove(e)),p.push(a.onEmpty(e))}let M={};return M.showPanel=function(n,i){g=i.executionContext,d=g.getComponent("Viewer"),u=g.getComponent("AFR_ModelEvents"),m=u.subscribe({event:"onWillLoadApp"},(()=>{M.hidePanel(n,i)})),f=!1,c=new e({executionContext:i.executionContext,args:{appId:"undefined"!=typeof widget&&null!==widget?widget.getValue("appId"):"",className:"enxpropertiestab",multiselection:t.MULTISEL_NO,setEditButton:!1,readOnly:!0,typeOfDisplay:t.ALL,selectionType:t.NO_SELECTION,actions:[{name:"action_close_panel",text:"SUPER TEST",icon:"close",handler:()=>{f||(f=!0,M.hidePanel())}}],events:{onCancel:()=>{i.executionContext.getComponent(WAfrStandardComponentKey.HandlerComponent).setCheckState({id:"CATRightSidePanel",state:!1})}},context:{getSelectedNodes:C,getSecurityContext:E}}}),c.done=n,function(e,n){n.removeFacets([t.FACET_VIEWS]),n.removeFacets([t.FACET_DERIVEDOUTPUT]);let i=e.getPropertiesFacet(),o=[];for(let e=0;e<i.length;++e){let t=new Promise((t=>{const o=i[e];if(o.facet){if(o.facet.text||(o.facet.text=l[`${o.facet.name}_cmd_title`]),o.actions&&o.actions.length>0)for(let e=0;e<o.actions.length;++e)o.actions[e].text=l[o.facet.name+o.actions[e].text];n.addFacets([o])}t()}));o.push(t)}}(d,c),I(d,c),P(),c.beginExecute()},M.hidePanel=function(e,t){g=t.executionContext,d=g.getComponent("Viewer"),u=g.getComponent("AFR_ModelEvents"),c.done=e,f=!0,p.forEach(a.unsubscribe,a),p=[],m&&u.unsubscribe(m),m=void 0,c&&c.closePanel()},M})),define("DS/DMUBaseCommands/DMUFocusOnRepresentationCmd",["require","exports","DS/CATWebUXComponents/DMUCommand","DS/Visualization/ThreeJS_DS","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/PADUtils/PADContext","DS/PADUtils/views/PADPager","DS/DMUBaseExperience/EXPManagerSet"],(function(e,t,n,i,o,a,r,s,l){"use strict";return class extends n{constructor(e){super(e,{mode:"shared",isAsynchronous:!0});let t,n=this,c=null,d=[],g=0,u=!1,m=[],p=!1,f=r.get(this.options.context),h=e=>{27===e.keyCode&&n.end()},D=e=>{let t;if(e&&e.length)if(e.some((e=>e&&e.getLastElement(!0)&&e.getLastElement(!0).getReqInfo))){let t=e.map((e=>e.getLastElement(!0).getReqInfo().pathId)).filter(Boolean);t.length&&window.require(["DS/WebDocumentVisualization/WebDocumentVisualizationController"],(e=>{let n=e.giveWebDocumentVisualizationController({context:f});n&&n.reframeOnElements(t)}))}else e.forEach((e=>{let n=e.getBoundingSphere(f.getViewer(),"visibleSpace");n&&n.radius&&(t?t.mergeWithSphere(n,t):t=(new i.Sphere).copy(n))})),t&&t.radius&&f.getViewer().currentViewpoint.reframe(void 0,void 0,t)},v=()=>{-1===g&&(g=d.length-1);let e=g%d.length;c&&c.setLabel(e+1+"/"+d.length),u=!0,f.lockSelectionBroadcast(!0),o.empty(),a.empty(),o.add(d[e]),a.add(d[e]),u=!1,f.lockSelectionBroadcast(!1),D([d[e].pathElement])},C=e=>{d&&("previous"===e.operation&&(g--,v()),"next"===e.operation&&(g++,v()))},S=()=>{let e=m.length?m.map((e=>({pathElement:e}))):d.slice();f.lockSelectionBroadcast(!0),u=!0,a.empty(),o.empty(),a.add(e),o.add(e),u=!1,f.lockSelectionBroadcast(!1)};function E(){p||(p=!0,d.length=0,g=0,u=!1,m.length=0,c&&(c.hide(),c.destroy(),document.removeEventListener("keyup",h)),c=null,t&&o.unsubscribe(t),t="",p=!1,n.cancel())}this.beginExecute=function(){const e=l.getManager({name:"DMU2DSheetManager",context:f.getFrameWindow()});(e=>{if(!e||!e.length)return;f.lockSelectionBroadcast(!0),m=e.slice(),o.empty(),a.empty();let t=e.map((e=>({pathElement:e})));o.add(t),a.add(t)})(e&&e.getPathElementsToFocusOn()),g=0;let i=[];i=o.get().slice(),u=!1;for(let e=0;e<i.length;e++)null!==i[e].pathElement&&d.push(i[e]);d.length?(t=o.onRemove((()=>{u||f.getController()._updateClustersInProgress||E()})),d.length>1&&(c||(c=new s({renderTo:f.elements.view_container,context:f,callbacks:{onPrevious:()=>{C({operation:"previous"})},onNext:()=>{C({operation:"next"})},onSelectAll:S,onReframeAll:()=>{D(d.map((e=>e.pathElement)))},onClose:function(){E()}}})),document.addEventListener("keyup",h),c.show()),v(),1===d.length&&E()):E(),n.done()};let I=n.destroy;this.destroy=function(){I.call(n),n.done()}}}})),define("DS/DMUBaseCommands/DMUCopyLinkCmd",["DS/CATWebUXCopyLink/CATWebUXCopyLinkCmdAdapt","DS/DMUBaseExperience/DMUContextManager","DS/Selection/CSOManager","DS/PADUtils/PADContext"],(function(e,t,n,i){"use strict";var o;function a(){var e=[];return n.get().forEach((function(t){for(var n=0;t.pathElement,n<t.pathElement.getLength();n++){var i=t.pathElement.getElement(n);i&&"function"==typeof i.getDMUType&&"DMUValidationExposedPresentation"===i.getDMUType()&&e.push(i)}})),e}function r(e){var t={data:{items:[]}},n={};if(e&&e.selectedNode){var i=a();1===i.length?(o=i[0].getOwner().getName()?i[0].getOwner().getName():"",n.objectId=i[0].getOwner().getPlmID()?i[0].getOwner().getPlmID():void 0,n.objectType=i[0].getDMUType()?i[0].getDMUType():void 0):(o=e.selectedNode.reviewName?e.selectedNode.reviewName:"",n.objectId=e.selectedNode.reviewId?e.selectedNode.reviewId:void 0,n.objectType=e.selectedNode.reviewType?e.selectedNode.reviewType:void 0)}return t.data.items.push(n),t}return e.extend({init:function(e){var n=i.get();e.pad3DViewer=n,this._parent(e),this.getParameters=function(e){var i=t.getReviewContext({context:n}).getReviewCtxInformation();i&&!i.reviewId&&e.onFailure(),a().length>1?e.onFailure():e.onComplete({content:r({selectedNode:i,param:e}),label:o})}}})})),define("DS/DMUBaseCommands/DMUNavOnImplementationLinksCmd",["require","exports","DS/CATWebUXComponents/DMUCommand","DS/DMUMeasurable/DMUToolsSceneGraph","DS/Selection/CSOManager","DS/PADUtils/PADUtilsServices","DS/WAFData/WAFData","DS/PADUtils/PADSettingsMgt","DS/DMUControls/EXPNotify","DS/DMUBaseExperience/DMUContextManager","i18n!DS/DMUBaseCommands/assets/nls/DMUBaseCommands"],(function(e,t,n,i,o,a,r,s,l,c,d){"use strict";return class extends n{constructor(e){super(e,"shared");let t=this,n=null;function g(e,i){t&&(n&&(n.destroy(),n=null),n=new l({body:t.getFrameWindow().getUIFrame(),type:e,message:i}))}function u(){g("warning",d.issueImplLinks)}this.beginExecute=function(){parent.require(["DS/WidgetLink/WidgetLink"],(e=>{let n=e.get(window.widget);if(!n||!n.getLinked().length)return g("info",d.noWidgetLinked),void(t.cancel?t.cancel():t.done());let l=o.get(),m=[];if(1===l.length&&l.some((function(e){return i.isAModelPath(e.pathElement)}))){let e=l[0].pathElement.clone();if(e.internalPath.length=0,e.getLastElement(!0).getReqInfo)m.push(e.getLastElement(!0).getReqInfo().id);else{for(;e&&!i.isPLMNode(e.getLastElement(!0))&&!e.getLastElement(!0).getDibInfo;)e=e.getParentPath();if(!e)return;let t=e.getLastElement();if(i.isPLMNode(e.getLastElement())){for(m.push(i.getNodeID(t));e&&!i.isReference(t)&&!i.isRepReference(t);)e=e.getParentPath(),e&&(t=e.getLastElement(!0));if(t&&i.isRepReference(t)){for(;e&&!i.isReference(t);)e=e.getParentPath(),e&&(t=e.getLastElement(!0));t&&m.push(i.getNodeID(t))}}else e.getLastElement().getDibInfo&&(e.getParentPath()&&e.getParentPath().getLastElement(!0).getDibInfo&&e.getParentPath().getLastElement(!0).getDibInfo()&&e.getParentPath().getLastElement(!0).getDibInfo().id?m.push(e.getParentPath().getLastElement(!0).getDibInfo().id):e.getLastElement(!0).getDibInfo&&e.getLastElement(!0).getDibInfo()&&e.getLastElement(!0).getDibInfo().id&&m.push(e.getLastElement(!0).getDibInfo().id))}}if(m&&m.length){let e=[],n=[],i=s.getSetting("pad_security_ctx"),o=o=>{let l=o?JSON.parse(o):null;if(l&&l.infos&&"OK"===l.infos.status&&l.result&&l.result.length&&l.result.forEach((t=>{t&&t.outputs&&t.outputs.contextRelationResults&&t.outputs.contextRelationResults.length&&t.outputs.contextRelationResults.forEach((t=>{if(t.elements&&t.elements.length){let n=[];t.elements.forEach((e=>{e.physicalid&&n.push(e.physicalid)})),n.length&&e.push(n)}})),t&&t.outputs&&t.outputs.refRefRelationResults&&t.outputs.refRefRelationResults.length&&t.outputs.refRefRelationResults.forEach((e=>{if(e.elements&&e.elements.length){let t=[];e.elements.forEach((e=>{e.physicalid&&!m.includes(e.physicalid)&&t.push(e.physicalid)})),t.length&&n.push(t)}}))})),e.length){let o=[];e.forEach((e=>{e.forEach((e=>{-1===o.indexOf(e)&&o.push(e)}))})),function(e){let t={input_physical_ids:e.physicalIDs,label:"DMUNavigateOnImplementationLinks_Ids",primitives:[{navigate_to_rel:{id:1}}],patterns:{ref:[{id:1}]},patternTypeFilters:{ref:{typesToNotReturn:["RFLPLMImplementConnection"]}},attributes:["ds6w:label","ds6w:type"],fileAttributes:[],version:3};r.authenticatedRequest(a.get3DSpaceUrl()+"/cvservlet/navigate?SecurityContext="+e.securityContext,{data:JSON.stringify(t),method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:e.securityContext},timeout:parseInt(s.getSetting("webapi_timeout"),10),onComplete:e.onComplete,onFailure:e.onFailure,onTimeout:e.onTimeout})}({securityContext:i,physicalIDs:o,onComplete:function(i){let o,a={},r=JSON.parse(i);if(!r||!r.infos||"OK"!==r.infos.status||!r.result)return void u();r.result.forEach((e=>{o=e.input_object,e.outputs&&e.outputs.ref&&e.outputs.ref.length&&(a[o.physicalid]=e.outputs.ref.map((e=>e.physicalid)))}));let s=[];if(e.forEach((e=>{let t=[];e.forEach((e=>{a[e]&&a[e].forEach((n=>{t.length&&t.push(e),t.push(n)}))})),s.push(t)})),s&&s.length){let e=c.giveEventsController({viewer:t.getFrameWindow().getViewer()});e&&e.fireEvent("onFireCrossWidgetFind",{paths:[...s,...n]})}},onFailure:u,onTimeout:u})}else if(n.length){let e=c.giveEventsController({viewer:t.getFrameWindow().getViewer()});e&&e.fireEvent("onFireCrossWidgetFind",{paths:n})}};const l=a.get3DSpaceUrl()+"/cvservlet/navigate?SecurityContext="+i;let d={data:JSON.stringify({input_physical_ids:m,primitives:[{navigate_from_rel:{id:1,mode:"stop_at_rel"}},{navigate_from_sr:{id:2,filter:{role:["51","52"],semantics:["5","7"]},mode:"ends"},navigate_to_sr:{id:3,filter:{role:["51","52"],semantics:["5","7"]},mode:"path"}}],patterns:{contextRelationResults:[{id:1},{id:2},{id:3}],refRefRelationResults:[{id:2},{id:3}]},version:3,label:"DMUNavigateOnImplementationLinks_to"}),timeout:parseInt(s.getSetting("webapi_timeout"),10),method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:i},onComplete:o,onFailure:u,onTimeout:u};r.authenticatedRequest(l,d)}t.done()}))}}}})),define("DS/DMUBaseCommands/DMUGoToPageCmd",["DS/CATWebUXComponents/DMUCommand","DS/DMUBaseExperience/EXPManagerSet"],(function(e,t){"use strict";return e.extend({init:function(e){e.mode="shared",this._parent(e);var n=this;this._parentBeginExecute=this.beginExecute,this.beginExecute=function(){this._parentBeginExecute();var e=t.getManager({name:"DMU2DSheetManager",context:n.getFrameWindow()});e&&e.enableCurrentPageEdition(),n.cancel()}}})})),define("DS/DMUBaseCommands/DMUCleanViewCmd",[].concat(["DS/CATWebUXComponents/DMUCommand","DS/DMUBaseExperience/DMUContextManager","DS/DMUReadPersistence/DMULoadingContextController"]),(function(e,t,n){"use strict";return e.extend({init:function(e){this._parent(e);var i=this,o=i.options.executionContext.getSourceApp().pad3DViewer;this.beginExecute=function(){var e=i.options.executionContext.getComponent("DelOERDMULoader");let a=i.options.executionContext.getComponent("FMEALoaderForDesignValidation"),r=n.getLoadingContextController({context:o}),s=t.giveEventsController({viewer:i.getFrameWindow().getViewer()});if(e){e.remove({onComplete:function(){o._dropZoneContainer.show()}});var l=r.getLoadedWorkplanInformations();s.fireEvent("onRootDataRemoved",l),t.removeReviewContext({viewer:i.getFrameWindow().getViewer()})}else a&&a.remove&&a.remove().then((()=>{o._dropZoneContainer.show();var e=r.getLoadedFMEAInformations();s.fireEvent("onRootDataRemoved",e),t.removeReviewContext({viewer:i.getFrameWindow().getViewer()})}));this.done()}}})})),define("DS/DMUBaseCommands/DMUReframeOnRepresentationCmd",["require","exports","DS/CATWebUXComponents/DMUCommand","DS/Visualization/ThreeJS_DS","DS/Selection/CSOManager","DS/PADUtils/PADContext"],(function(e,t,n,i,o,a){"use strict";return class extends n{constructor(e){super(e,{mode:"shared",isAsynchronous:!0});let t=this;this.beginExecute=function(){let e=a.get(this.options.context),n=o.get();if(e&&n&&n.length){let t;n.forEach((n=>{if(n.pathElement){let o=n.pathElement.getBoundingSphere(e.getViewer(),"visibleSpace");o&&o.radius&&(t?t.mergeWithSphere(o,t):t=(new i.Sphere).copy(o))}})),e&&t&&t.radius&&e.getViewer().currentViewpoint.reframe(void 0,void 0,t)}t.cancel()}}}})),define("DS/DMUBaseCommands/DMUPublishToSwymCmd",["require","exports","DS/DMUBaseUIControllers/DMUSlidesController","DS/PADUtils/PADContext","DS/DMUMeasurable/DMUToolsSceneGraph","DS/CATWebUXComponents/DMUCommand","DS/DMUBaseExperience/DMUContextManager","UWA/Core","DS/DMUBaseExperience/DMUCopyLinkServices"],(function(e,t,n,i,o,a,r,s,l){"use strict";let c=function(e){window.require(["DS/UIKIT/Modal","DS/SwymPublishForm/script/publish-form-view"],(function(t,n){let i,o,a=function(){o&&o.destroy(),i&&i.destroy()};e.onCancel=a,e.onContentCreated=a,o=new n(e),i=new t({closable:!0,header:"Publish to 3DSwym",body:o.render("publish_to_sywm_wrapper_id"),className:"publishSwymPanel_3DPlay"}),i.inject(document.body),i.show()}))};return class extends a{constructor(e){let t;e.mode="shared",super(e);let a=i.get();const d=a?a.getViewer():null;this.beginExecute=async()=>{if(super.beginExecute(),d){let e,t,i,g="",u=[],m="",p="",f=o.getRoots(a),h=function(){let e;return new Promise((t=>{var n;a.getController().getAttributes({ids:[null===(n=f[0])||void 0===n?void 0:n.getIdentificationObject()],attributes:["ds6w:label"],callbacks:{onComplete:function(n){e=n[f[0].getIdentificationObject()]["ds6w:label"],t(e)},onFailure:function(){e="",t(e)}}})}))},D=function(){return new Promise(((o,s)=>{var l,c,d;let g=r.getReviewContext({context:a});if(g){if(g.getUIManager().getMarkupVisualizationActiveState()){e=g.getReviewCtxInformation();const t=null==g?void 0:g.getCurrentSessionMarkup();m=(null==e?void 0:e.reviewName)?e.reviewName:null!==(l=null==t?void 0:t.getAttribute("sName"))&&void 0!==l?l:"";let o=n.giveDMUSlidesController({context:a.getFrameWindow()});i=o.getActiveSlide(),i&&(p=null!==(c=i.getAttribute("sID"))&&void 0!==c?c:""),u=[null!==(d=null==i?void 0:i.getAttribute("sName"))&&void 0!==d?d:""],u=""!==u[0]?[u+"- "]:[m+"- "]}o({titleName:m,descriptionTitle:u,currentSlideId:p})}else try{window.require(["DS/PIMwebViewController/PIMwebItfCtrl"],(function(e){let n=e.getItfCtrl({pad3DViewer:a}),i=n.getLoadedIsr();0!==i.length&&(t=n.getSelectedMetric(),i&&(m=i[0].isr.getAttributes("sName").label),0!==(null==t?void 0:t.length)&&0!==i[0].isr.getInterferences().length?null==t||t.forEach((e=>{u.push(`${e.itfMetricName}- `)})):(u.push(`${m}-`),t=i)),o({titleName:m,descriptionTitle:u,currentSlideId:""})}))}catch(e){window.console.error("Error loading the PIMwebItfController",e),s(e)}}))};const v=await h();v&&(m=v,D().then((async function(n){var i;let o=async function(e){var t,i;let o={data:{items:[]}},a={objectId:"",objectType:"",displayName:"",currentSlideId:""};return e&&(g=e.reviewName?e.reviewName:(null===(t=null==e?void 0:e.isr)||void 0===t?void 0:t.getAttributes().label)?e.isr.getAttributes().label:e.itfCtxName?e.itfCtxName:"",a.objectId=e.reviewId?e.reviewId:e.isrID?e.isrID:e.mID?e.mID:"",a.objectType=e.reviewType?e.reviewType:(null===(i=null==e?void 0:e.isr)||void 0===i?void 0:i.getAttributes().type)?e.isr.getAttributes().type:e.mType?e.mType:void 0,a.displayName=m,a.currentSlideId=n.currentSlideId),o.data.items.push(a),await l.getLink({content:o,label:g,envId:null,contextId:null,appId:"X3DPLAW_AP"})},a="";a=null!==(i=await function(){let e=d.SCREEN_WIDTH,t=d.SCREEN_HEIGHT,n=s.createElement("canvas");n.set({height:t,width:e});let i=new ImageData(n.width,n.height);d.renderToTarget(i,d.currentViewpoint,!0);let o=n.getContext("2d");if(o){o.putImageData(i,0,0),o.scale(1,-1),o.drawImage(n,0,0,n.width,-n.height);let e=new Image;return e.src=n.toDataURL("image/png"),e.src}}())&&void 0!==i?i:"";let r=e?[e]:t||[],u="",p=0;for(const e of r){let t=await o(e);u=u+n.descriptionTitle[p]+"\n"+t+"\n",p++}let f=`${u}`,h={title:n.titleName,contentTitle:n.titleName,contentDescription:f,mode:"automatic",base64image:a,platformId:"",onCancel:close,onContentCreated:close},D=window.require("DS/PADUtils/PADSettingsMgt").getSetting("x3dPlatformId");D&&(h.platformId=D),c(h)}))),this.done()}else{let e="",n={data:{items:[]}};n.data.items.push({objectId:t.objectId,objectType:t.objectType}),l.getLink({content:n,envId:t.envId,contextId:t.contextId,label:t.titleName,appId:"X3DPLAW_AP"}).then((n=>{e=n+"\n";let i=`${t.contentDescription} ${e}`,o={title:t.titleName,contentTitle:t.titleName,contentDescription:i,mode:"automatic",base64image:t.base64image,platformId:t.envId,onCancel:close,onContentCreated:close},a=window.require("DS/PADUtils/PADSettingsMgt").getSetting("x3dPlatformId");a&&(o.platformId=a),c(o)})),this.done()}},this.initCommandParamters=function(e){t=e}}}})),define("DS/DMUBaseCommands/EXPCommand",["DS/CATWebUXComponents/DMUCommand","DS/DMUBaseCommands/EXPToolsWUX"],(function(e,t){"use strict";return e.extend({init:function(e,t,n){var i=t||"exclusive",o=n||!0;this._parent(e,{mode:i,isAsynchronous:o}),this.getFrameWindow&&this.getFrameWindow()&&(this._frmWindow=this.getFrameWindow(),this._viewer=this.getFrameWindow().getViewer())},_performCallback:function(){},beginExecute:function(){this._performCallback(),this.cancel(),this.done()},addInCSO:function(e,n){t.addInCSO(e,n)}})})),define("DS/DMUBaseCommands/EXPStateCommand",["DS/CATWebUXComponents/DMUStateCommand","DS/DMUBaseCommands/EXPToolsWUX","DS/DMUControls/EXPNotify","DS/DMUBaseExperience/EXPToolsVisualization","DS/VisuEvents/EventsManager","DS/Gestures/ClickGesture","DS/DMUMeasurable/DMUToolsSceneGraph","DS/VisuEvents/ScreenEvent"],(function(e,t,n,i,o,a,r,s){"use strict";return e.extend({init:function(e,t,n){this._parent(e,{mode:t,isAsynchronous:n});var i=this;if(this._frmWindow=this.getFrameWindow(),this._viewer=this._frmWindow.getViewer(),this._tokenRemove=null,i._frmWindow&&void 0===i._frmWindow._bDMUClickEvent){var r=new a(s.MouseButton.LEFT);o.addGestureRecognizer(r),i._frmWindow._bDMUClickEvent=!0}},changeDefaultController:function(){if(this._parent(),!this._keepDefaultController&&(this._defaultController=this.getFrameWindow().getViewer().currentViewpoint.getDefaultController(),this.getFrameWindow().getViewer().currentViewpoint.setDefaultController(!0,"CATIA"),this.getFrameWindow().getViewer()._viewer360Manager)){const e=this.getFrameWindow().getViewer().getNavigationParams();this._defaultClickToNavigateIn360=e&&e.clickToNavigateIn360,this.getFrameWindow().getViewer().setNavigationParams({clickToNavigateIn360:!1}),this._manipulatorManager=this.getFrameWindow().getViewer().manipulatorManager.getActivate(),this.getFrameWindow().getViewer().manipulatorManager.setActivate(!1)}},restoreDefaultController:function(){this._defaultController&&this.getFrameWindow().getViewer().currentViewpoint.setDefaultController(!0,this._defaultController),this._defaultClickToNavigateIn360&&setTimeout((()=>this.getFrameWindow().getViewer().setNavigationParams({clickToNavigateIn360:this._defaultClickToNavigateIn360}))),this._manipulatorManager&&setTimeout((()=>this.getFrameWindow().getViewer().manipulatorManager.setActivate(this._manipulatorManager))),this.cleanNotify(),this.done()},addEmptySelectionTransition:function(e,t,n,o){this._checkEmptySelection=function(e){var t=!0,n=e.from[0].event;if(e.from[0]&&e.from[0].getCurrentPosition&&(this._object=i.getSelectedPathElement(this._viewer,e.from[0].getCurrentPosition(this._viewer.canvas))),this._object){if(!this._id.includes("measure")&&!this._id.includes("thickness")&&r.isAPOIPath(this._object))return!0;t=!1}else if(!function(e){if(!e)return!1;for(var t=e;t;){if(t.id&&t.id.includes("WebDocPageLayerPage"))return!0;t=t.parentElement}return!1}(n.target)&&!function(e){if(!e)return!1;for(var t=e;t;){if(t.id&&t.id.includes("WebDocReqElem"))return!0;t=t.parentElement}return!1}(n.target))if("CANVAS"!==n.target.tagName)t=!1;else if(void 0!==n.target)if(void 0!==n.target.className&&"levelSelector-canvas levelSelector-canvas-animation"===n.target.className)t=!1;else for(var o=n.target;o;){if("LevelSelector"===o.id){t=!1;break}o=o.parentElement}return t},this.addTransition({iEvent:"/VISU/onPrimaryPointerClick",iInitialState:e,iFinalState:t,iCondition:function(e){return o?this._checkEmptySelection(e)&&o():this._checkEmptySelection(e)},iAction:n})},computeEmptySelectionInformation:function(e){var t=[];if(e.from[0]&&e.from[0].getCurrentPosition){var n=i.getPickingInfo(this._viewer,e.from[0].getCurrentPosition(this._viewer.canvas));n.position=n.point,t.push(n)}return t},addInCSO:function(e,n){t.addInCSO(e,n)},emptyCSO:function(){t.emptyCSO()},addInHSO:function(e,n){t.addInHSO(e,n)},emptyHSO:function(){t.emptyHSO()},addInPSO:function(e,n){t.addInPSO(e,n)},emptyPSO:function(){t.emptyPSO()},sendNotify:function(e,t,i){return this._notification&&this._notification.destroy(),this._notification=new n({body:this._frmWindow.getUIFrame(),type:e,notificationType:"HelpNotification",message:t,duration:i,autoHide:"number"==typeof i&&i>0}),this._notification},cleanNotify:function(){this._notification&&this._notification.destroy()}})})),define("DS/DMUBaseCommands/EXPGenericCmdOneSelThenOperation",["DS/DMUBaseCommands/EXPStateCommand","DS/DMUBaseExperience/EXPToolsVisualization","DS/StateCommandEngine/PathElementAgent","DS/DMUBaseUIManipulators/DMUCursorsController","DS/VisuEvents/EventsManager","DS/DMUMeasurable/DMUMathsInfiniteGeometry","DS/Visualization/ThreeJS_DS","DS/DMUBaseExperience/EXPManagerSet","i18n!DS/DMUBaseCommands/assets/nls/DMUBaseCommands"],(function(e,t,n,i,o,a,r,s,l){"use strict";var c,d,g,u,m;return e.extend({init:function(e,t,n,i,o){this._parent(e,"exclusive",!0),this._performOperation=t,this._sKeyHelpMessage=void 0!==n?n:l.defaultSelectLabel,this._agentOptions=void 0!==i?i:{},this._bAllowEmptySel=void 0!==o&&o,this._dragEventCallback=this.options.dragEventCallback,this._selectedPathElement=null},initiateCmd:function(){this.emptyHSO(),this.emptyCSO();var e=this;this._viewer.currentViewpoint.setDefaultController(!1,"FLY_WALK");var l=s.getManager({name:"DMU2DSheetManager",context:this.getFrameWindow()});if(c=l?l.getPointedElem():e._viewer.canvas,l&&(l.setTextSelectionFlag(!1),l.setTouchPanActive(!1)),this.getPageNumber=function(){return l?l.getPageNumber(d):null},this.getElementId=function(e){return l&&"Requirement"===l.getDocumentType()?l.getPointedElemIDAtPosition(e):null},this.getAbsolutePosition=function(t,n){if(d===e._viewer.canvas||!l)return t;var i=l.getElementMatrix(e.getPageNumber()||n);return i?t.clone().applyMatrix4(i):t},this.getRelativePosition=function(t,n){if(d===e._viewer.canvas||!l)return t;var i=l.getElementMatrix(n||e.getPageNumber()||e.getElementId(t));return i?t.clone().applyMatrix4((new r.Matrix4).getInverse(i)):t},this.tapCallback=function(n){if(!e.isPaused()){e._selectedPathElement=null,(d=l?l.getElementToDraw(n.from[0].getView()):e._viewer.canvas)||e.publish({event:"dragEnd"}),e._clickEventData=n;var i,o=e._viewer.getMousePosition(n.from[0].getCurrentPosition(e._viewer.canvas)),a=e._viewer.pick(o,"mesh",!0);if(void 0!==a&&void 0!==a.position&&null!==a.position)if(i=a.position.clone(),e._startpos=i,0===a.path.length)e._startpos=e._computePositionOnEmptySpace(n);else{var s=a.path[0];void 0!==s&&s.getLastElement().measurable&&void 0!==(a=e._viewer.pick(o,"prim",!0))&&(e._startpos=a.position.clone())}if(e._startpos){const n=t.getViewerPositionFromPoint(e._viewer,e._startpos);n&&(e._selectedPathElement=e._viewer.pick(e._viewer.getMousePosition(new r.Vector2(n.left,n.top)),"mesh",!1).path[0])}}},this._cancelCmd=function(){e._dragEventCallback({iEventData:"",vStartPosition:u,vCurrentPosition:m,bLastUpdate:"end",_isCanvasToDraw:g}),e.publish({event:"dragEnd"}),this.cancel()},this._dragEventCallback){var p=null;this.dragCallback=function(n){if(!e.isPaused()){var i="end"===n.state,o=function(e){if(e&&e===d)return!0;for(var t=e.parentNode;t&&"___view___1"!==t.id;){if(t===d)return!0;t=t.parentElement}return!1}(n.from[0].getView());if(o){"touchmove"!==n.from[0].event.type||n.from[0].event.pageX||n.from[0].event.pageY||(n.from[0].event.pageX=n.from[0].event.touches&&n.from[0].event.touches.length?n.from[0].event.touches[0].pageX:0,n.from[0].event.pageY=n.from[0].event.touches&&n.from[0].event.touches.length?n.from[0].event.touches[0].pageY:0),"begin"===n.state&&(e.dragEnabled=!0,p=void 0!==e._startpos?e._startpos:t.getPickingInfo(e._viewer,n.from[0].getCurrentPosition(e._viewer.canvas)).point);var s=n.from[0].getCurrentPosition(e._viewer.canvas),l=t.getLineFromWindowPosition(e._viewer,s.x,s.y),c=t.getViewpointInfo(e._viewer.currentViewpoint),f=a.computeLinePlaneDistance(l.position.toArray(),l.direction.toArray(),p.toArray(),c.sight.toArray());m=new r.Vector3(f.aPosition[0],f.aPosition[1],f.aPosition[2])}e._dragEventCallback({iEventData:n,vStartPosition:p,vCurrentPosition:m,bLastUpdate:i,isCanvasToDraw:o}),g=o,u=p,!i&&m||(m=null,e.publish({event:"dragEnd"}))}},this._viewer.get2DMode()||this._viewer.currentViewpoint.control.setTouchRotationActive(!1),o.addEvent(c,"onDrag",this.dragCallback),o.addEvent(c,"onPrimaryPointerDownUnique",this.tapCallback),document.addEventListener("contextmenu",this._cancelCmd),c!==this._viewer.canvas&&(o.addEvent(this._viewer.canvas,"onDrag",this.dragCallback),o.addEvent(this._viewer.canvas,"onPrimaryPointerDownUnique",this.tapCallback))}this._agentOptions.agentId="_pathElementAgent",this._agentOptions.viewer=this._viewer,this._pathElementAgent=new n(this._agentOptions),this.changeDefaultController();var f=i.giveDMUCursorsController({context:e.getFrameWindow()});f&&f.setCursors({pages:c!==this._viewer.canvas?"crosshair":null,canvas:c===this._viewer.canvas?"crosshair":null,preHLMarkers:"crosshair"}),this.sendNotify("info",this._sKeyHelpMessage)},pauseExecute:function(){this._parent(),this.cmdOnPause=!0},resumeExecute:function(){this._parent(),this.cmdOnPause=!1;let e=i.giveDMUCursorsController({context:this.getFrameWindow()});e&&e.resetCursors()},cancelExecute:function(){this.__endExecute(),this.publish({event:"cancelCurrentCmd"}),this.done()},__endExecute:function(){this.restoreDefaultController(),this._dragEventCallback&&(this._viewer.get2DMode()||this._viewer.currentViewpoint.control.setTouchRotationActive(!0),o.removeEvent(c,"onDrag",this.dragCallback),o.removeEvent(c,"onPrimaryPointerDownUnique",this.tapCallback),document.removeEventListener("contextmenu",this._cancelCmd),c!==this._viewer.canvas&&(o.removeEvent(this._viewer.canvas,"onDrag",this.dragCallback),o.removeEvent(this._viewer.canvas,"onPrimaryPointerDownUnique",this.tapCallback))),this._pathElementAgent=null,this.dragEnabled=null;var e=s.getManager({name:"DMU2DSheetManager",context:this.getFrameWindow()});e&&(e.setTextSelectionFlag(!0),e.setTouchPanActive(!0));var t=i.giveDMUCursorsController({context:this.getFrameWindow()});t&&t.restoreCursors(),this.cleanNotify(),this._viewer.currentViewpoint.setDefaultController(!0,"FLY_WALK"),this.cmdOnPause=!1,this.cancel()},buildGraph:function(){this.initiateCmd();var e=this.createInitialState("initialState"),t=this.getFinalState(),n={iEvent:this._pathElementAgent,iInitialState:e,iFinalState:t,iCondition:function(){return!this.dragEnabled},iAction:function(e,t){this._performSelectionCallback(t),this.__endExecute(),e()}};this.addTransition(n),this._bAllowEmptySel&&this.addEmptySelectionTransition(e,t,this._performEmptySelectionCallback);var i={iSender:this,iEvent:"dragEnd",iInitialState:e,iFinalState:t,iCondition:null,iAction:function(e){this.__endExecute(),e()}};this.addTransition(i);var o={iSender:this,iEvent:"cancelCurrentCmd",iInitialState:e,iFinalState:t,iCondition:null,iAction:function(e){this.__endExecute(),e()}};this.addTransition(o)},_performSelectionCallback:function(e){this.isPaused()||(void 0!==this._startpos&&(e[0].position=this._startpos),this._performOperation(e))},_performEmptySelectionCallback:function(e,t){if(!this.isPaused()){var n=this.computeEmptySelectionInformation(t);n[0].pathElement=n[0].paths?n[0].paths[0]:void 0,n[0].position=this._computePositionOnEmptySpace(t),this._performOperation(n),this.__endExecute(),e()}},_computePositionOnEmptySpace:function(e){let n,i=e.from[0].getCurrentPosition(this._viewer.canvas),o=s.getManager({name:"DMU2DSheetManager",context:this.getFrameWindow()}),a=!1;return o&&(a="Document"===o.getDocumentType()||"Requirement"===o.getDocumentType(),a&&(n=new r.Vector3(0,0,0))),t.getNearPositionFrom2DCoordinates(i,this._viewer,n,a)}})}));