define("DS/ENO3DView/mixins/ENO3DViewCommandStateManager",["DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADSession","DS/Selection/CSOManager","DS/PADServices/utils/SGIUtils"],(function(e,t,i,n,o,s){"use strict";function a(){}return a.prototype._buildCommandsState=function(){return new Promise((e=>{0===this.getRoots().length&&this._removeRootUpdateCommands(),this._geometryQualityavailableForRole=!1,this._setGeometryQualityAvailabilityForRoles(),0===o.get().length&&this.disableCmd("ActionBar_Attributes"),!0===s.supplementalModeActivated&&(this.disableCmd("ENO3DInformationPanelCmd"),this.disableCmd("ENO3DRevealDocumentsCmd")),o.onPostAdd(function(){this.getController()._isLargeDataSelected()?(this.disableCmd("ENO3DOpenAppCmd"),this.disableCmd("OpenWithCatiaAction"),this.disableCmd("OpenWithFinderAction"),this.disableCmd("OpenWithMarkupAction")):(this.enableCmd("ENO3DOpenAppCmd"),this.enableCmd("OpenWithCatiaAction"),this.enableCmd("OpenWithFinderAction"),this.enableCmd("OpenWithMarkupAction"))}.bind(this)),o.onEmpty(function(){this.disableCmd("ENO3DOpenAppCmd"),this.disableCmd("OpenWithCatiaAction"),this.disableCmd("OpenWithFinderAction"),this.disableCmd("OpenWithMarkupAction")}.bind(this)),o.onRemove(function(){this.getController()._isLargeDataSelected()?(this.disableCmd("ENO3DOpenAppCmd"),this.disableCmd("OpenWithCatiaAction"),this.disableCmd("OpenWithFinderAction"),this.disableCmd("OpenWithMarkupAction")):(this.enableCmd("ENO3DOpenAppCmd"),this.enableCmd("OpenWithCatiaAction"),this.enableCmd("OpenWithFinderAction"),this.enableCmd("OpenWithMarkupAction"))}.bind(this)),this.getViewer().onStart360Mode((()=>{!0===this.getCommandHandler().getCheckState({id:"ENO3DTogglePointVisualizationChk"})&&(this.getCommandHandler().setCheckState({id:"ENO3DTogglePointVisualizationChk",state:!1}),require(["DS/PADServices/utils/PADTrackerManager"],(e=>{const t=e.getPADTracker({eventCategory:"usage",eventAction:"command-3D"});t.setEventData({eventLabel:"ENO3DPointVisualizationAutoChk",eventValue:"disableOn360Mode"}),t.trackPageEvent()}))),this.disableCheck("ENO3DTogglePointVisualizationChk"),this.getController()._elevationLayer&&this.getController().deleteElevationLayer(),this.disableCmd("ENO3DPointCloudElevationCmd"),this.getController()._classificationLayer&&this.getController().deleteClassificationLayer(),this.disableCmd("ENO3DPointCloudClassificationCmd")})),this.getViewer().onEnd360Mode((()=>{this.enableCheck("ENO3DTogglePointVisualizationChk"),this.enableCmd("ENO3DPointCloudElevationCmd"),this.getController().checkClassificationAvailability()})),this.getController()._isLargeDataSelected()?(this.disableCmd("ENO3DOpenAppCmd"),this.disableCmd("OpenWithCatiaAction"),this.disableCmd("OpenWithFinderAction"),this.disableCmd("OpenWithMarkupAction")):(this.enableCmd("ENO3DOpenAppCmd"),this.enableCmd("OpenWithCatiaAction"),this.enableCmd("OpenWithFinderAction"),this.enableCmd("OpenWithMarkupAction")),n.subscribe({event:"authoringStateModified"},(e=>{this._updateCommandsForAuthoring(e.authored)})),this.subscribe({event:"onHideShowInheritStatusChange"},function(e){e.active?e.fromLink&&0===this.getViewer().getVisibleSpace()?this._executeCommand({handlerId:"VisuVisibleSpaceCmd"}).then((()=>{this.disableCmd("VisuVisibleSpaceCmd")})):this.disableCmd("VisuVisibleSpaceCmd"):this.enableCmd("VisuVisibleSpaceCmd")}.bind(this)),e()}))},a.prototype._addRootUpdateCommands=function(){let t=this.getRoots(),i=!1;for(let n=0;n<t.length;++n){let o=this.getController().getRootStats(e.getNodeID(t[n]));if(o&&o.isVDRP){i=!0;break}}this.enableCmd("ENO3DCleanViewCmd"),i?this.disableCmd("ENO3DVolumeQueryCmd"):this.enableCmd("ENO3DVolumeQueryCmd"),this.enableCmd("ENO3DDefineFilterCmd"),this._updateCommandsForSupportedRoot()},a.prototype._removeRootUpdateCommands=function(){this.getController().getNbRoots()||this.getController().getHiddenRootIds().length||(this.disableCmd("ENO3DCleanViewCmd"),this.disableCmd("ENO3DVolumeQueryCmd"),this.disableCmd("ENO3DDefineFilterCmd")),this._updateCommandsForSupportedRoot()},a.prototype._updateCommandsForSupportedRoot=function(){const t=this.getRoots();let i=!1,n=!1,o=this.getController().getNb360Data(),a=this.getController().getNbR2VData(),r=this.getController().getNbPCData();for(let o=0;o<t.length;++o){this.getController().isRootSupported(e.getNodeID(t[o]))&&(i=!0);let s=this.getController().getRootStats(e.getNodeID(t[o]));s&&s.isVDRP&&(n=!0)}if(i?(!0===s.supplementalModeActivated?(this.disableCmd("ENO3DInformationPanelCmd"),this.disableCmd("ENO3DRevealDocumentsCmd")):(this.enableCmd("ENO3DInformationPanelCmd"),this.enableCmd("ENO3DRevealDocumentsCmd")),this.enableCmd("ENO3DRelationalNavigatorCmd"),n?this.disableCmd("ENO3DVolumeQueryCmd"):this.enableCmd("ENO3DVolumeQueryCmd"),this.enableCmd("ENO3DDefineFilterCmd")):(!0===s.supplementalModeActivated?(this.disableCmd("ENO3DInformationPanelCmd"),this.disableCmd("ENO3DRevealDocumentsCmd")):(this.enableCmd("ENO3DInformationPanelCmd"),this.disableCmd("ENO3DRevealDocumentsCmd")),this.disableCmd("ENO3DRelationalNavigatorCmd"),this.disableCmd("ENO3DVolumeQueryCmd"),this.disableCmd("ENO3DDefineFilterCmd")),a>=0)if(1===a&&1===o){var l=null===window.localStorage.getItem("SoITimeline360ModeState")||JSON.parse(window.localStorage.getItem("SoITimeline360ModeState"));this.getViewer().get360Mode()||!l&&0!==r||(this._applyPhoto360FromCmd({action:!0}),require(["DS/PADServices/utils/PADTrackerManager"],(e=>{const t=e.getPADTracker({eventCategory:"usage",eventAction:"command-3D"});t.setEventData({eventLabel:"ENO3DPhoto360ModeAuto",eventValue:"ON"}),t.trackPageEvent()}))),this.enableCheck("ENO3DTogglePhoto360ModeChk")}else this.getViewer().get360Mode()&&(this._applyPhoto360FromCmd({action:!1}),require(["DS/PADServices/utils/PADTrackerManager"],(e=>{const t=e.getPADTracker({eventCategory:"usage",eventAction:"command-3D"});t.setEventData({eventLabel:"ENO3DPhoto360ModeAuto",eventValue:"OFF"}),t.trackPageEvent()}))),a>0&&this.disableCheck("ENO3DTogglePhoto360ModeChk");0===r&&1===a&&(this.disableCheck("ENO3DTogglePointCloudMinimapChk"),this.disableCheck("ENO3DTogglePhoto360ModeChk"),t.length>1?(this.enableCheck("CATRelatedData3DGridHdr"),this.enableCheck("LockUnlockSectionHdr"),this.enableCmd("measureCmdHdr")):(this.disableCheck("CATRelatedData3DGridHdr"),this.disableCheck("LockUnlockSectionHdr"),this.disableCmd("measureCmdHdr")))},a.prototype._updateCommandsForAuthoring=function(e){!0===e?this.disableCmd("ENO3DDefineFilterCmd"):this.enableCmd("ENO3DDefineFilterCmd")},a.prototype._setGeometryQualityAvailabilityForRoles=function(){t.isCloud()?(t.getVISnVIOStatus((e=>{e.hasLicense?this._geometryQualityavailableForRole=!0:t.getGrantedRoles((e=>{this._geometryQualityavailableForRole=!1;for(var i=0;i<e.length;i++)if("InternalDS"===e[i].id&&(!e[i].platforms||e[i].platforms&&e[i].platforms.indexOf(t.getPlatformId())>-1)){this._geometryQualityavailableForRole=!0;break}}))})),this._VISnVIORetrievedToken=this.subscribe({event:"VISnVIOStatusRetrieved"},this._checkGeometryQualityAvailabilityForRoles.bind(this))):this._geometryQualityavailableForRole=!0},a.prototype._checkGeometryQualityAvailabilityForRoles=function(){if(i.getSetting("enopad3dviewer_VISnVIOStatus"))this._geometryQualityavailableForRole=!0;else{const e=i.getSetting("enopad3dviewer_roles");this._geometryQualityavailableForRole=!1;for(let i=0;i<e.length;++i)if("InternalDS"===e[i].id&&(!e[i].platforms||e[i].platforms&&e[i].platforms.indexOf(t.getPlatformId())>-1)){this._geometryQualityavailableForRole=!0;break}}},a.prototype._isGeometryQualityAvailable=function(e){return("optimized"!==e||!n.determineAuthoredFlag())&&this._geometryQualityavailableForRole},a.prototype._getAllLeavesForGeometryQuality=function(t,i){var n={};function o(t){if(e.is3DLeaf(t)){var i=e.getNodeID(t);n[i]||(n[i]=!0)}}for(var s=0;s<t.length;s++){var a=t[s].pathElement;if(e.isAModelPath(a)){var r=a.getLastElement(!0);if(e.is3DLeaf(r)){var l=e.getNodeID(r);n[l]||(n[l]=!0)}else if(e.isPLMNode(r))r.traverse(o);else{for(;!e.is3DLeaf(r)&&"RootBag"!==r.name;)r=(a=a.getParentPath()).getLastElement(!0);l=e.getNodeID(r);n[l]||null===l||(n[l]=!0)}}if(void 0!==i&&Object.keys(n).length>=i)break}return Object.keys(n)},a})),define("DS/ENO3DView/mixins/ENO3DViewPreferencesManager",["i18n!DS/ENO3DUtils/assets/nls/ENO3DUtils.json","DS/PADUtils/PADSettingsMgt","DS/MePreferencesClientAPI/MePreferencesClientAPI","DS/PlatformAPI/PlatformAPI","DS/ENOXInterWdgCom/LinkManager"],(function(e,t,i,n,o){"use strict";return{_initPreferencesManager:function(e){return this._DEBUG&&console.log("ENO3DViewPreferencesManager._handleMePreferences called with",e),new Promise((async(e,s)=>{"object"==typeof o.getLinkability()&&o.getLinkability().implements.includes("ENXContentExt")&&o.getLinkability().uses.includes("ENXContentExt")?(i.readPreferences([{Repository:"StructureExploreRepository",PreferenceNames:["HIDESHOW_INHERIT"]}]).then(function(i){if(i&&i.repositories&&i.repositories.length){if(i.repositories[0].preferences&&1===i.repositories[0].preferences.length){const e="true"===i.repositories[0].preferences[0].value;t.setSetting("eno3dview_hideShowInherit",e)}e()}else console.warn("MePreference service returned value",i),this._setDefaultPreferenceValues(),e()}.bind(this)).catch((t=>{console.warn("MePreference service error message",t),this._setDefaultPreferenceValues(),e()})),n.subscribe("com.ds.mep:onPrefUpdate",function(e){if(3===e.length&&e[1].preferences){const t=JSON.parse(e[1].preferences);for(let e=0;e<t.repositories.length;++e)"StructureExploreRepository"===t.repositories[e].name&&this._updatePADSettings(t.repositories[e].preferences)}}.bind(this))):(t.setSetting("eno3dview_hideShowInherit",!1),e())}))},_updatePADSettings:function(e){for(let i=0;i<e.length;++i)if("HIDESHOW_INHERIT"===e[i].name){const n="true"===e[i].value;t.setSetting("eno3dview_hideShowInherit",n);const o=this.getHideShowInheritStatus();this._previousHideShowInheritStatus!==o&&(this._previousHideShowInheritStatus=o,this.publish({event:"onHideShowInheritStatusChange",data:{active:n}}))}},_setDefaultPreferenceValues:function(){t.setSetting("eno3dview_hideShowInherit",!1)}}})),define("DS/ENO3DView/mixins/ENO3DViewStatusBar",["DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","DS/Selection/CSOManager"],(function(e,t,i,n){"use strict";function o(){}return o.prototype.createStatusBar=async function(e,i){this._DEBUG&&console.log("ENO3DViewStatusBar.createStatusBar called");const n=await this.loadSource("DS/PADUtils/views/PADStatusBar");await this.loadSource("DS/PADServices/settings/AppSettings");this.elements.padstatusbar=new n({renderTo:this.getWafrUIFrame()._privateGetStatusBarWrapper(),withLoader:!0,perfoDebug:!0===t.getSetting("enopad3dviewer_debugvisucommand"),onPlay:this._onStatusBarPlay.bind(this),onPause:this._onStatusBarPause.bind(this),onPerfoClicked:this._onStatusBarPerfoClicked.bind(this),onDragEvent:this._onStatusBarDragEvent.bind(this),onSetStartupViewClicked:this._onSetStartupViewClicked.bind(this),onWidgetLinkOptionsClicked:this._openWLOptionsPanel.bind(this)}),this._initStatusBarState(),e()},o.prototype._onStatusBarPlay=function(){this.getController().resumeProgressiveLoading(),this.getStatusBar()&&this.getStatusBar().restorePreviousLabel()},o.prototype._onStatusBarPause=function(){this.getController().pauseProgressiveLoading(),this.getStatusBar()&&this.getStatusBar().pauseProgresslabel()},o.prototype._onStatusBarPerfoClicked=async function(){(new(await this.loadSource("DS/ENOPAD3DViewer/commands/PAD3DViewerDebugVisuCmd"))).execute()},o.prototype._onStatusBarDragEvent=function(e){const t=this._buildDragDataFromCSO(n.get());e.dataTransfer.setData("Text",JSON.stringify(t))},o.prototype._buildDragDataFromCSO=function(n){this._DEBUG&&console.log("ENO3DViewStatusBar._buildDragDataFromCSO called with",n);const o={protocol:"3DXContent",version:"2.1",source:i.getAppId(),widgetId:i.getWidgetId(),data:{items:[]}};var s="3DSpace";for(let a=0;a<n.length;++a)if(e.isAModelPath(n[a].pathElement)){const r=this.streamPath(n[a].pathElement),l=this.getController().getRootStats(r[0]);let h=!1;l&&l.serviceId&&(s=l.serviceId,h=l.isVDRP);const d=this.getController().getNode({id:r[r.length-1]}),c=[];for(let t=0;t<r.length;++t)if(h){const e=this.getController()._model._OOCManager.getUserData(r[t]);c.push({resourceid:r[t],type:e?e.type:null,i3dx:e&&e.i3dx?e.i3dx:""})}else{const i=this.getController().getNode({id:r[t]});c.push({resourceid:r[t],type:e.getNodeType(i),i3dx:e.getNodeI3DX(i)?e.getNodeI3DX(i):""})}o.data.items.push({envId:i.getPlatformId(),serviceId:s,contextId:t.getSetting("pad_security_ctx")?t.getSetting("pad_security_ctx"):void 0,objectId:e.getNodeID(d),objectType:e.getNodeType(d),path:c,i3dx:e.getNodeI3DX(d)?e.getNodeI3DX(d):""})}const a=this.getController().getShareFilterSpec(o.data);return a.roots&&a.roots.length>0&&(o.biProxyCtx=a),o},o.prototype._initStatusBarState=function(){this._DEBUG&&console.log("ENO3DViewStatusBar._initStatusBarState called");let e=!0;null===window.localStorage.getItem("ENO3DViewStatusBarExpandState")?t.getSetting("enopad3dviewer_defaultStatusBarVisibility")?e=t.getSetting("enopad3dviewer_defaultStatusBarVisibility"):window.localStorage.setItem("ENO3DViewStatusBarExpandState",!0):(e="true"===window.localStorage.getItem("ENO3DViewStatusBarExpandState"),e||this.displayStatusBar(!1)),this._setCheckState({checkId:"ENO3DToggleStatusBarCmd",state:e})},o.prototype._displayStatusBar=function(e){this._DEBUG&&console.log("ENO3DViewStatusBar._displayStatusBar called"),!0===e?this.getStatusBar()&&(this.getStatusBar().open(),this.getWafrUIFrame()._privateSetStatusBarWrapperVisibility(!0),window.localStorage.setItem("ENO3DViewStatusBarExpandState",!0)):this.getStatusBar()&&(this.getStatusBar().close(),this.getWafrUIFrame()._privateSetStatusBarWrapperVisibility(!1),window.localStorage.setItem("ENO3DViewStatusBarExpandState",!1))},o.prototype.displayStatusBar=function(e){this._DEBUG&&console.log("ENO3DViewStatusBar.displayStatusBar called"),this._displayStatusBar(e)},o})),define("DS/ENO3DView/views/PADLayerPointCloudElevationView",["DS/TreeModel/TreeDocument","i18n!DS/ENO3DView/assets/nls/ENO3DView","DS/CoreEvents/ModelEvents","DS/WebappsUtils/WebappsUtils","DS/PADServices/utils/GlobalModelEvents","DS/Controls/ColorPicker","DS/Controls/Slider","DS/Controls/ComboBox","DS/CATWebUXPreferences/CATWebUXPreferencesUtils","DS/Controls/TooltipModel"],(function(e,t,i,n,o,s,a,r,l,h){"use strict";const d="00f1ff",c="ff0000";function p(e){this.options=e||{},this.elements={},this._nbChildren=1,this._elementSize=150,this._tokensXSO=[],this._minBbox=null,this._maxBbox=null,this._mdlEvts=new i,this._axis="z",this._currentUnit={nls:"mm",unit:"Millimeter"},this._buildContent()}function u(e,t){for(var i="",n=0;n<3;n++){var o=e.substring(2*n,2+2*n),s=t.substring(2*n,2+2*n),a=parseInt(o,16),r=parseInt(s,16);i+=("0"+Math.floor(a+.5*(r-a)).toString(16).toUpperCase()).slice(-2)}return i}return p.prototype.getHeader=function(){return t.pointCloudElevationLayer.title},p.prototype.getIcon=function(){return{iconPath:n.getWebappsAssetUrl("ENO3DCommands","icons/32/I_ENO3DPointCloudElevationCmd.png")}},p.prototype.render=function(){return this.elements.container},p.prototype.getItemIdx=function(e){var t=this.options.model.getChildren(),i=null;if(t&&t.length>0){for(var n=0;n<t.length;++n){var o=t[n];o.options.layerId&&o.options.layerId===e.options.layerId&&null===i&&(i=n)}if(i>=0)return i}},p.prototype._onSelectLayer=function(e){this.elements.container.classList.remove("pointCloudStyling-unfocused"),this.elements.container.classList.add("pointCloudStyling-focused"),this.options.model.getXSO().isEmpty()&&(this._mdlEvts.publish({event:"PAD3DLayer/xsoPreAdd",data:{selected:this.options.model.getChildren()[0],xso:this.options.model.getXSO()}}),this.options.model.getXSO().add(this.options.model.getChildren()[0]),o.publish({event:"ENXDISC_AP/PointCloudStyling/SelectLayer",data:{kind:"elevation",fromLayerPanel:!0===e}}))},p.prototype._buildContent=function(){this._minColor=d,this._maxColor=c,this.middleColor=u(this._minColor,this._maxColor),this.elements.container=document.createElement("div"),this.elements.container.classList.add("PAD3DLayerDefaultView-container"),this.elements.container.classList.add("pointCloudElevation-layers-view"),this.elements.container.classList.add("pointCloudStyling-unfocused"),this.elements.container.addEventListener("click",this._onSelectLayer.bind(this)),this.options.model=new e,this._tokensXSO.push(this.options.model.getXSO().onPostRemove(function(e){this.options.model.getXSO().empty(),this.elements.container.classList.contains("pointCloudStyling-focused")&&(this.elements.container.classList.remove("pointCloudStyling-focused"),this.elements.container.classList.add("pointCloudStyling-unfocused")),this._mdlEvts.publish({event:"PAD3DLayer/xsoRemove",data:{selected:e,xso:this.options.model.getXSO()}})}.bind(this))),this._tokensXSO.push(this.options.model.getXSO().onEmpty(function(e){this.options.model.getXSO().empty(),this._mdlEvts.publish({event:"PAD3DLayer/xsoEmpty",data:{selected:e,xso:this.options.model.getXSO()}})}.bind(this))),this.elements.comboContainer=document.createElement("div"),this.elements.comboContainer.classList.add("pointCloudElevation-comboContainer"),this.elements.container.appendChild(this.elements.comboContainer),this.elements.comboLabel=document.createElement("p"),this.elements.comboLabel.innerHTML=t.pointCloudElevationLayer.comboLabel,this.elements.comboContainer.appendChild(this.elements.comboLabel),this.elements.axisCombo=new r({elementsList:[{label:"X",value:"x"},{label:"Y",value:"y"},{label:"Z",value:"z"}],selectedIndex:2,domId:"pointCloudElevation-comboContainer"}),this.elements.axisCombo.inject(this.elements.comboContainer),this.elements.axisCombo.addEventListener("change",function(){o.publish({event:"ENXDISC_AP/PointCloudStyling/ChangeElevationParameters",data:{axis:this.elements.axisCombo.value}}),this._axis=this.elements.axisCombo.value,this.resetSlider()}.bind(this)),this.elements.axisHelp=UWA.createElement("div",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-i-question elevation-axis-tooltip"}),this.elements.axisHelp.tooltipInfos=new h({shortHelp:t.pointCloudElevationLayer.tooltip}),this.elements.comboContainer.appendChild(this.elements.axisHelp),this.elements.minMaxGraduationContainer=document.createElement("div"),this.elements.minMaxGraduationContainer.classList.add("pointCloudElevation-minMaxGraduationContainer"),this.elements.container.appendChild(this.elements.minMaxGraduationContainer),this.elements.minMaxGraduation=document.createElement("div"),this.elements.minMaxGraduation.classList.add("pointCloudElevation-minMaxGraduation"),this.elements.minMaxGraduationContainer.appendChild(this.elements.minMaxGraduation),this.elements.minGraduationText=document.createElement("p"),this.elements.minGraduationText.classList.add("pointCloudElevation-graduationText"),this.elements.minMaxGraduation.appendChild(this.elements.minGraduationText),this.elements.maxGraduationText=document.createElement("p"),this.elements.maxGraduationText.classList.add("pointCloudElevation-graduationText"),this.elements.minMaxGraduation.appendChild(this.elements.maxGraduationText),this.elements.graduation=document.createElement("table"),this.elements.graduation.classList.add("pointCloudElevation-table");for(let e=0;e<10;e++){let e=document.createElement("td");e.classList.add("pointCloudElevation-gradientGraduation"),this.elements.graduation.appendChild(e)}this.elements.container.appendChild(this.elements.graduation),this.elements.gradient=document.createElement("div"),this.elements.gradient.classList.add("pointCloudElevation-gradient"),this.elements.container.appendChild(this.elements.gradient),this.elements.colorChooserContainer=document.createElement("div"),this.elements.colorChooserContainer.classList.add("pointCloudElevation-colorChooserContainer"),this.elements.container.appendChild(this.elements.colorChooserContainer),this.elements.minColorPicker=new s({value:d}),this.elements.minColorPicker.getContent().addClassName("pointCloudElevation-minColorPicker"),this.elements.colorChooserContainer.appendChild(this.elements.minColorPicker.getContent()),this.elements.maxColorPicker=new s({value:c}),this.elements.maxColorPicker.getContent().addClassName("pointCloudElevation-maxColorPicker"),this.elements.colorChooserContainer.appendChild(this.elements.maxColorPicker.getContent()),this.elements.minColorPicker.addEventListener("change",function(e){this._minColor=e.dsModel.value,this._onColorPickerChange("min")}.bind(this)),this.elements.maxColorPicker.addEventListener("change",function(e){this._maxColor=e.dsModel.value,this._onColorPickerChange("max")}.bind(this)),o.subscribe({event:"ENXDISC_AP/PointCloudStyling/GetBoundingBox"},this._updateBoundingBox.bind(this)),this._loadMePreferences().then(function(){o.publish({event:"ENXDISC_AP/PointCloudStyling/GetBoundingBox",data:{get:!0}})}.bind(this))},p.prototype._updateBoundingBox=function(e){if(e.min&&e.max){this._minBbox=e.min,this._maxBbox=e.max,this._minCursorValue=this._minBbox[this._axis],this._middleCursorValue=(this._minBbox[this._axis]+this._maxBbox[this._axis])/2,this._maxCursorValue=this._maxBbox[this._axis],this._percentageMin=0,this._localPercentageMiddle=50,this._globalPercentageMiddle=50,this._percentageMax=100,this.elements.gradient.style.background="linear-gradient(90deg, #"+this._minColor+" "+this._percentageMin+"%, #"+this._middleColor+" "+this._globalPercentageMiddle+"%, #"+this._maxColor+" "+this._percentageMax+"%)",this.elements.minGraduationText.innerHTML=""+Math.round(l.convert(this._minCursorValue,"length","mm",this._currentUnit.unit))+this._currentUnit.nls,this.elements.maxGraduationText.innerHTML=""+Math.round(l.convert(this._maxCursorValue,"length","mm",this._currentUnit.unit))+this._currentUnit.nls;let t=this.elements.minMaxGraduation.clientWidth,i=t*(this._percentageMin/100),n=t*(this._percentageMax/100),o=i-this.elements.minGraduationText.clientWidth/2,s=n+this.elements.maxGraduationText.clientWidth/2;this.elements.minGraduationText.style["margin-left"]=o>=0?"-"+this.elements.minGraduationText.clientWidth/2+"px":"-"+i+"px",this.elements.maxGraduationText.style["margin-right"]=s<t?"-"+this.elements.maxGraduationText.clientWidth/2+"px":"-"+(t-n)+"px",this.elements.minColorPicker.getContent().style.left=this._percentageMin+"%",this.elements.maxColorPicker.getContent().style.right="100"-this._percentageMax+"%",this.elements.minMaxGraduation.style["margin-left"]=this._percentageMin+"%",this.elements.minMaxGraduation.style["margin-right"]="100"-this._percentageMax+"%",this.elements.boundarySlider&&(this.elements.container.removeChild(this.elements.boundarySlider.getContent()),delete this.elements.boundarySlider),this.elements.boundarySlider=new a({value:[this._minCursorValue,this._middleCursorValue,this._maxCursorValue],minValue:this._minCursorValue,maxValue:this._maxCursorValue,valuePopupFlag:!1,stepValue:1,sliderButtonStyle:"accurate",domId:"pointCloudElevation-slider"}),this.elements.container.insertBefore(this.elements.boundarySlider.getContent(),this.elements.colorChooserContainer),this.elements.boundarySlider.getContent().addEventListener("endEdit",this._onSliderEndEdit.bind(this)),this.elements.boundarySlider.getContent().addEventListener("change",this._onSliderChange.bind(this))}},p.prototype._onSliderEndEdit=function(e){let t=this._maxBbox[this._axis]-this._minBbox[this._axis],i=e.dsModel.value;i=i.map((e=>(e-this._minBbox[this._axis])/t)),o.publish({event:"ENXDISC_AP/PointCloudStyling/ChangeElevationParameters",data:{boundaries:i}})},p.prototype._onSliderChange=function(e){let t=e.dsModel.value[0]!==this._minCursorValue,i=e.dsModel.value[1]!==this._middleCursorValue,n=e.dsModel.value[2]!==this._maxCursorValue;this._minCursorValue=e.dsModel.value[0],this._middleCursorValue=(e.dsModel.value[0]+e.dsModel.value[2])/2,this._maxCursorValue=e.dsModel.value[2],t||n?e.dsModel.value[1]=e.dsModel.value[0]+(e.dsModel.value[2]-e.dsModel.value[0])*(this._localPercentageMiddle/100):i&&(this._localPercentageMiddle=(e.dsModel.value[1]-this._minBbox[this._axis])/(this._maxBbox[this._axis]-this._minBbox[this._axis])*100);let o=this._maxBbox[this._axis]-this._minBbox[this._axis];this._percentageMin=100*(e.dsModel.value[0]-this._minBbox[this._axis])/o,this._percentageMax=100*(e.dsModel.value[2]-this._minBbox[this._axis])/o,this._globalPercentageMiddle=100*(e.dsModel.value[1]-this._minBbox[this._axis])/o,this._middleColor=u(this._minColor,this._maxColor),this.elements.gradient.style.background="linear-gradient(90deg, #"+this._minColor+" "+this._percentageMin+"%, #"+this._middleColor+" "+this._globalPercentageMiddle+"%, #"+this._maxColor+" "+this._percentageMax+"%)",this.elements.minColorPicker.getContent().style.left=this._percentageMin+"%",this.elements.maxColorPicker.getContent().style.right="100"-this._percentageMax+"%",this.elements.minMaxGraduation.style["margin-left"]=this._percentageMin+"%",this.elements.minMaxGraduation.style["margin-right"]="100"-this._percentageMax+"%",this.elements.minGraduationText.innerHTML=""+Math.round(l.convert(this._minCursorValue,"length","mm",this._currentUnit.unit))+this._currentUnit.nls,this.elements.maxGraduationText.innerHTML=""+Math.round(l.convert(this._maxCursorValue,"length","mm",this._currentUnit.unit))+this._currentUnit.nls;let s=this.elements.minMaxGraduation.clientWidth,a=s*(this._percentageMin/100),r=s*(this._percentageMax/100),h=a-this.elements.minGraduationText.clientWidth/2,d=r+this.elements.maxGraduationText.clientWidth/2;this.elements.minGraduationText.style["margin-left"]=h>=0?"-"+this.elements.minGraduationText.clientWidth/2+"px":"-"+a+"px",this.elements.maxGraduationText.style["margin-right"]=d<s?"-"+this.elements.maxGraduationText.clientWidth/2+"px":"-"+(s-r)+"px"},p.prototype._onColorPickerChange=function(e){let t;this._middleColor=u(this._minColor,this._maxColor),this.elements.gradient.style.background="linear-gradient(90deg, #"+this._minColor+" "+this._percentageMin+"%, #"+this._middleColor+" "+this._globalPercentageMiddle+"%, #"+this._maxColor+" "+this._percentageMax+"%)",t="min"===e?{min:this._minColor,middle:this._middleColor}:{middle:this._middleColor,max:this._maxColor},o.publish({event:"ENXDISC_AP/PointCloudStyling/ChangeElevationParameters",data:{colors:t}})},p.prototype.selectItemIdx=function(e){this._onSelectLayer(!0)},p.prototype.addChild=function(e){this._nbChildren=1,e.options.onlyKind=!0,this.options.model.addChild(e)},p.prototype.removeChildren=function(){this._nbChildren=0,this.options.model.empty(),this.options.model.getXSO().empty(),this.elements.container.classList.remove("pointCloudStyling-focused"),this.elements.container.classList.add("pointCloudStyling-unfocused"),this._minColor=d,this._middleColor=u(d,c),this._maxColor=c,this.elements.axisCombo.value="z",this.elements.gradient.style.background="linear-gradient(90deg, #"+d+" 0%, #"+c+" 100%)",this.elements.minColorPicker.value=d,this.elements.maxColorPicker.value=c,this.resetSlider(),this._mdlEvts.publish({event:"PAD3DLayer/removeLayer",data:{layerName:p.layerName}}),o.publish({event:"ENXDISC_AP/PointCloudStyling/RemoveStyling",data:{kind:"elevation"}})},p.prototype.getModelEvents=function(){return this._mdlEvts},p.prototype._loadMePreferences=function(){return new Promise(function(e,t){l.readPreferences([{Repository:"cke",PreferenceNames:["Length","LengthCalcDisplay"]}]).then(function(t){var i;t.repositories.length&&t.repositories[0].preferences&&t.repositories[0].preferences.length&&(this._currentUnit={nls:(i=t.repositories[0].preferences[0].value,l.Length&&l.Length[i]&&l.Length[i].symbol?l.Length[i].symbol:"mm"),unit:t.repositories[0].preferences[0].value},this._decimalRO=t.repositories[0].preferences[1].value),e()}.bind(this)).catch(t)}.bind(this))},p.prototype.resetSlider=function(){this._minCursorValue=this._minBbox[this._axis],this._middleCursorValue=(this._minBbox[this._axis]+this._maxBbox[this._axis])/2,this._maxCursorValue=this._maxBbox[this._axis],this.elements.minGraduationText.innerHTML=""+Math.round(l.convert(this._minCursorValue,"length","mm",this._currentUnit.unit))+this._currentUnit.nls,this.elements.maxGraduationText.innerHTML=""+Math.round(l.convert(this._maxCursorValue,"length","mm",this._currentUnit.unit))+this._currentUnit.nls,this.elements.boundarySlider.minValue=this._minCursorValue,this.elements.boundarySlider.maxValue=this._maxCursorValue,this.elements.boundarySlider.value=[this._minCursorValue,this._middleCursorValue,this._maxCursorValue],this._percentageMin=0,this._localPercentageMiddle=50,this._globalPercentageMiddle=50,this._percentageMax=100},p.layerName="pointCloudElevation",p})),define("DS/ENO3DView/views/PADLayerPointCloudClassificationView",["DS/Utilities/UUID","DS/TreeModel/TreeDocument","DS/DataGridView/DataGridView","i18n!DS/ENO3DView/assets/nls/ENO3DView","DS/CoreEvents/ModelEvents","DS/WebappsUtils/WebappsUtils","DS/TreeModel/TreeNodeModel","DS/PADServices/utils/GlobalModelEvents","DS/Controls/TooltipModel"],(function(e,t,i,n,o,s,a,r,l){"use strict";const h=[{label:n.pointCloudClassificationLayer.class0,children:null,grid:{"pointCloud:classif":"0","pointCloud:color":"b6b6b6","pointCloud:filter":!0}},{label:n.pointCloudClassificationLayer.class1,children:null,grid:{"pointCloud:classif":"1","pointCloud:color":"aaaaaa","pointCloud:filter":!0}},{label:n.pointCloudClassificationLayer.class2,children:null,grid:{"pointCloud:classif":"2","pointCloud:color":"aa5500","pointCloud:filter":!0},selected:!0},{label:n.pointCloudClassificationLayer.class3,children:null,grid:{"pointCloud:classif":"3","pointCloud:color":"00aaaa","pointCloud:filter":!0}},{label:n.pointCloudClassificationLayer.class4,children:null,grid:{"pointCloud:classif":"4","pointCloud:color":"55ff55","pointCloud:filter":!0},selected:!0},{label:n.pointCloudClassificationLayer.class5,children:null,grid:{"pointCloud:classif":"5","pointCloud:color":"00aa00","pointCloud:filter":!0}},{label:n.pointCloudClassificationLayer.class6,children:null,grid:{"pointCloud:classif":"6","pointCloud:color":"ff5555","pointCloud:filter":!0}},{label:n.pointCloudClassificationLayer.class7,children:null,grid:{"pointCloud:classif":"7","pointCloud:color":"aa0000","pointCloud:filter":!0}},{label:n.pointCloudClassificationLayer.class8,children:null,grid:{"pointCloud:classif":"8","pointCloud:color":"555555","pointCloud:filter":!0}},{label:n.pointCloudClassificationLayer.class9,children:null,grid:{"pointCloud:classif":"9","pointCloud:color":"55ffff","pointCloud:filter":!0}},{label:n.pointCloudClassificationLayer.class10,children:null,grid:{"pointCloud:classif":"10","pointCloud:color":"aa00aa","pointCloud:filter":!0}},{label:n.pointCloudClassificationLayer.class11,children:null,grid:{"pointCloud:classif":"11","pointCloud:color":"000000","pointCloud:filter":!0}},{label:n.pointCloudClassificationLayer.class12,children:null,grid:{"pointCloud:classif":"12","pointCloud:color":"555555","pointCloud:filter":!0}},{label:n.pointCloudClassificationLayer.class13,children:null,grid:{"pointCloud:classif":"13","pointCloud:color":"ffff55","pointCloud:filter":!0}},{label:n.pointCloudClassificationLayer.class14,children:null,grid:{"pointCloud:classif":"14","pointCloud:color":"ffff55","pointCloud:filter":!0}},{label:n.pointCloudClassificationLayer.class15,children:null,grid:{"pointCloud:classif":"15","pointCloud:color":"ff55ff","pointCloud:filter":!0}},{label:n.pointCloudClassificationLayer.class16,children:null,grid:{"pointCloud:classif":"16","pointCloud:color":"ffff55","pointCloud:filter":!0}},{label:n.pointCloudClassificationLayer.class17,children:null,grid:{"pointCloud:classif":"17","pointCloud:color":"5555ff","pointCloud:filter":!0}},{label:n.pointCloudClassificationLayer.class18,children:null,grid:{"pointCloud:classif":"18","pointCloud:color":"646464","pointCloud:filter":!0}}];function d(e){this.options=e||{},this.elements={},this._nbChildren=21,this._elementSize=24,this._toolbarOffset=45,this._updatingRows=!1,this._updatingToolbar=!1,this._tokensXSO=[],this.options.columns=[{alignment:"center",dataIndex:"pointCloud:filter",width:"10px",typeRepresentation:"boolean",editableFlag:!0,sortableFlag:!1,resizableFlag:!1,visibleFlag:!0,editionPolicy:"EditionInPlace"},{dataIndex:"tree",text:"Label",visibleFlag:!0,selectableFlag:!1},{text:"Value",alignment:"center",dataIndex:"pointCloud:classif",typeRepresentation:"string",width:"60px",editableFlag:!1,sortableFlag:!1,resizableFlag:!1,visibleFlag:!1},{alignment:"center",dataIndex:"pointCloud:color",width:"10px",typeRepresentation:"color",editableFlag:!0,sortableFlag:!1,resizableFlag:!1,visibleFlag:!0,selectableFlag:!1,editionPolicy:"EditionInPlace"}],this.options.dgvOptions={columns:this.options.columns,defaultcolumndef:{typerepresentation:"string"},rowSelection:"single",columnSelection:"none",cellSelection:"none",cellActivationFeedback:"row",showRowBorderFlag:!1,showAlternateBackgroundFlag:!1,cellPreselectionFeedback:"none",layoutOptions:{cellHeight:this._elementSize,rowsHeader:!1,columnsHeader:!1},showBackgroundFlag:!1},this._mdlEvts=new o,this.elements.customHeader=UWA.createElement("div",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-i-question eno-classification-colorization-tooltip"}),this.elements.customHeader.tooltipInfos=new l({shortHelp:n.pointCloudClassificationLayer.headerTooltip,moreHelpCB:function(){window.open("https://www.asprs.org/wp-content/uploads/2010/12/LAS_Specification.pdf","_blank")}}),this._buildContent()}return d.prototype.getHeader=function(){return n.pointCloudClassificationLayer.title},d.prototype.getIcon=function(){return{iconPath:s.getWebappsAssetUrl("ENO3DCommands","icons/32/I_ENO3DPointCloudClassificationCmd.png")}},d.prototype.getItemIdx=function(e){var t=this.options.model.getChildren(),i=null;if(t&&t.length>0){for(var n=0;n<t.length;++n){var o=t[n];o.options.layerId&&o.options.layerId===e.options.layerId&&null===i&&(i=n)}if(i>=0)return i}},d.prototype.render=function(){return this.elements.container},d.prototype._onSelectLayer=function(e){this.elements.container.classList.remove("pointCloudStyling-unfocused"),this.elements.container.classList.add("pointCloudStyling-focused"),this.options.model.getXSO().isEmpty()&&(this._mdlEvts.publish({event:"PAD3DLayer/xsoPreAdd",data:{selected:this.options.model.getChildren()[0],xso:this.options.model.getXSO()}}),this.options.model.getXSO().add(this.options.model.getChildren()[0]),r.publish({event:"ENXDISC_AP/PointCloudStyling/SelectLayer",data:{kind:"classification",fromLayerPanel:!0===e}}))},d.prototype._buildContent=function(){this.elements.container=document.createElement("div"),this.elements.container.classList.add("PAD3DLayerDefaultView-container"),this.elements.container.classList.add("pointCloudClassification-layers-view"),this.elements.container.classList.add("pointCloudStyling-unfocused"),this.elements.comboContainer=document.createElement("div"),this.elements.comboContainer.classList.add("PAD3DPointCloudClassificationComboContainer"),this.elements.container.appendChild(this.elements.comboContainer);let n=UWA.extend({identifier:"DataGridView-3DLayerDefault-"+e.v4()},this.options.dgvOptions),o=this.options.dgv=new i(n);this.options.classesModel=new t,this.options.model=new t,o.treeDocument=this.options.classesModel,this.elements.container.addEventListener("click",this._onSelectLayer.bind(this)),this._tokensXSO.push(this.options.model.getXSO().onPostRemove(function(e){this.options.model.getXSO().empty(),this.elements.container.classList.contains("pointCloudStyling-focused")&&(this.elements.container.classList.remove("pointCloudStyling-focused"),this.elements.container.classList.add("pointCloudStyling-unfocused")),this._mdlEvts.publish({event:"PAD3DLayer/xsoRemove",data:{selected:e,xso:this.options.model.getXSO()}})}.bind(this))),this._tokensXSO.push(this.options.model.getXSO().onEmpty(function(e){this.options.model.getXSO().empty(),this._mdlEvts.publish({event:"PAD3DLayer/xsoEmpty",data:{selected:e,xso:this.options.model.getXSO()}}),this.options.dgv.setActiveCell(-1)}.bind(this))),o.getContent().addClassName("PAD3DLayerDefaultView-dgv"),o.getContent().style.top="49px",this.elements.container.appendChild(o.getContent());let s={entries:[{id:"filterSelect",dataElements:{typeRepresentation:"boolean",value:!0,displayLabel:!1,position:"near",label:"Select/Unselect All"},onNodeUpdate:e=>{if(!this._updatingRows&&!this._updatingToolbar){let t=e.getAttributeValue("data"),i=this.options.classesModel.getChildren();this._updatingRows=!0;for(let e=0;e<i.length;e++){i[e].setAttribute("pointCloud:filter",t)}t?r.publish({event:"ENXDISC_AP/PointCloudStyling/ShowClasses",data:{all:!0}}):r.publish({event:"ENXDISC_AP/PointCloudStyling/HideClasses",data:{all:!0}}),this._updatingRows=!1}}},{id:"Label",dataElements:{typeRepresentation:"string",label:"All",displayLabel:!0,readOnly:!0}}],typeRepresentations:{}};this._toolbar=o.setToolbar(s),this.elements.comboContainer.appendChild(this._toolbar.getContent()),this.options.classesModel.onNodeModelUpdate((e=>{if(!this._updatingRows){let t=0,i=this.options.classesModel.getChildren();for(let e=0;e<i.length;e++)i[e].getAttributeValue("pointCloud:filter")&&t++;let n=o.getToolbar().getNodeModelByID("filterSelect").getAttributeValue("data");if(t===i.length?!0!==n&&(this._updatingToolbar=!0,o.getToolbar().updateNodeModel("filterSelect",{grid:{data:!0}}),this._updatingToolbar=!1):0===t?!1!==n&&(this._updatingToolbar=!0,o.getToolbar().updateNodeModel("filterSelect",{grid:{data:!1}}),this._updatingToolbar=!1):void 0!==n&&(this._updatingToolbar=!0,o.getToolbar().updateNodeModel("filterSelect",{grid:{data:void 0}}),this._updatingToolbar=!1),e.data.attributes.hasOwnProperty("pointCloud:color")){let t=e.data.attributes["pointCloud:color"],i=e.data.nodeModel.getAttributeValue("pointCloud:classif");r.publish({event:"ENXDISC_AP/PointCloudStyling/ChangeClassColor",data:{updatedClass:i,color:t}})}else if(e.data.attributes.hasOwnProperty("pointCloud:filter")){let t=e.data.attributes["pointCloud:filter"],i=parseInt(e.data.nodeModel.getAttributeValue("pointCloud:classif"));t?r.publish({event:"ENXDISC_AP/PointCloudStyling/ShowClasses",data:{addedClasses:[i]}}):r.publish({event:"ENXDISC_AP/PointCloudStyling/HideClasses",data:{removedClasses:[i]}})}}}))},d.prototype.selectItemIdx=function(e){this._onSelectLayer(!0)},d.prototype.addChild=function(e){this._nbChildren=21,e.options.onlyKind=!0,this.options.model.addChild(e),this.options.classesModel.prepareUpdate(),this._classifNodes=JSON.parse(JSON.stringify(h)),this._classifNodes.forEach((e=>{let t=new a(e);this.options.classesModel.addChild(t)})),this.options.classesModel.pushUpdate()},d.prototype.removeChildren=function(){this._nbChildren=0,this.options.model.empty(),this.options.model.getXSO().empty(),this.options.classesModel.empty(),this.elements.container.classList.remove("pointCloudStyling-focused"),this.elements.container.classList.add("pointCloudStyling-unfocused"),this._mdlEvts.publish({event:"PAD3DLayer/removeLayer",data:{layerName:d.layerName}}),r.publish({event:"ENXDISC_AP/PointCloudStyling/RemoveStyling",data:{kind:"classification"}})},d.prototype.getModelEvents=function(){return this._mdlEvts},d.prototype.getCustomHeader=function(){return this.elements.customHeader},d.layerName="pointCloudClassification",d})),define("DS/ENO3DView/mixins/ENO3DViewManipulations",["DS/UIKIT/Modal"],(function(e){"use strict";function t(){}return t.prototype.displayNotification=async function(e){this._DEBUG&&console.log("ENO3DViewManipulations.displayNotification called");(await this.loadSource("DS/PADUtils/views/PADAlert")).displayNotification(e),this.getStatusBar()&&this.getStatusBar().setLatestNotification({notification:e})},t.prototype.toggleSidePanel=function(e){return this._DEBUG&&console.log("ENO3DViewManipulations.toggleSidePanel called"),new Promise(((t,i)=>{"right"===e.side?"open"===e.action?(this.getTriptych()._modelEvents.publish({event:"triptych-show-panel",data:e.side}),t()):"close"===e.action?(this.getTriptych()._modelEvents.publish({event:"triptych-hide-panel",data:e.side}),t()):i("ENO3DViewManipulations.toggleSidePanel, invalid action value, must be open or close"):i("ENO3DViewManipulations.toggleSidePanel, invalid side value, must be left or right")}))},t.prototype.toggleTimelineView=function(e){return this._DEBUG&&console.log("ENO3DViewManipulations.toggleTimelineView called"),new Promise(((t,i)=>{this.toggleSOITimelinesVisibility(e.action),t()}))},t.prototype.togglePhoto360Mode=function(e){return this._DEBUG&&console.log("ENO3DViewManipulations.togglePhoto360Mode called"),new Promise(((t,i)=>{e.autoSwitch||window.localStorage.setItem("SoITimeline360ModeState",e.action),this._applyPhoto360FromCmd(e),!0===e.action?require(["DS/PADServices/utils/PADTrackerManager"],(e=>{const t=e.getPADTracker({eventCategory:"usage",eventAction:"command-3D"});t.setEventData({eventLabel:"ENO3DPhoto360ModeON"}),t.trackPageEvent()})):require(["DS/PADServices/utils/PADTrackerManager"],(e=>{const t=e.getPADTracker({eventCategory:"usage",eventAction:"command-3D"});t.setEventData({eventLabel:"ENO3DPhoto360ModeOFF"}),t.trackPageEvent()})),t()}))},t.prototype.togglePointVisualization=function(e){return this._DEBUG&&console.log("ENO3DViewManipulations.togglePointVisualization called"),new Promise(((t,i)=>{this.getController().togglePointVisualizationVisibility(e.action),!0===e.action?require(["DS/PADServices/utils/PADTrackerManager"],(e=>{const t=e.getPADTracker({eventCategory:"usage",eventAction:"command-3D"});t.setEventData({eventLabel:"ENO3DShowPointVisualizationView"}),t.trackPageEvent()})):require(["DS/PADServices/utils/PADTrackerManager"],(e=>{const t=e.getPADTracker({eventCategory:"usage",eventAction:"command-3D"});t.setEventData({eventLabel:"ENO3DHidePointVisualizationView"}),t.trackPageEvent()})),t()}))},t.prototype.togglePointCloudMinimap=function(e){return this._DEBUG&&console.log("ENO3DViewManipulations.togglePointCloudMinimap called"),new Promise(((t,i)=>{this._toggleMinimap(e.action),t()}))},t.prototype.toggleDisplayRobot=function(e){this._DEBUG&&console.log("ENO3DViewManipulations.toggleDisplayRobot called"),this._viewer.setRobot(e.active,{snapOnFace:!0}),e.active&&this._viewer.getRobot().setCornerLock(!0)},t.prototype.reframe=function(e){this._DEBUG&&console.log("ENO3DViewManipulations.reframe called"),this.getViewer().get360Mode()||(e?this.getViewpoint().reframe(null,void 0,e):this.getViewpoint().reframe())},t.prototype.reframeSelection=function(){this._DEBUG&&console.log("ENO3DViewManipulations.reframeSelection called"),this.getCommandProxy().reframeSelection()},t.prototype.addWidgetBorder=function(){this._DEBUG&&console.log("ENO3DViewManipulations.addWidgetBorder called"),!0===this.getOption("enableSidePanel")?this.elements.borderedLayout.addClassName("bordered"):this.elements.container.addClassName("bordered")},t.prototype.clearWidgetBorder=function(){this._DEBUG&&console.log("ENO3DViewManipulations.clearWidgetBorder called"),!0===this.getOption("enableSidePanel")?this.elements.borderedLayout.removeClassName("bordered"):this.elements.container.removeClassName("bordered")},t.prototype._enableUX=function(){this._DEBUG&&console.log("ENO3DViewManipulations._enableUX called"),this._blockUXCounter&&(this._blockUXCounter--,0===this._blockUXCounter&&this.getDOMElement("blockUX")&&(this.getDOMElement("blockUX").destroy&&this.getDOMElement("blockUX").destroy(),this.elements.blockUX={},this.publish({event:"ENO3DStopLockView"})))},t.prototype._disableUX=function(){this._DEBUG&&console.log("ENO3DViewManipulations._disableUX called"),this._blockUXCounter||(this._blockUXCounter=0),0===this._blockUXCounter&&(this.elements.blockUX=new e({className:"disableMainUX",closable:!1,body:"",visible:!0}),this.getDOMElement("blockUX").inject(document.body),this.publish({event:"ENO3DStartLockView"})),this._blockUXCounter++},t.prototype._showRootListPanel=function(){this._DEBUG&&console.log("ENO3DViewManipulations._showRootListPanel called"),this._rootListPanel.show(),this._rootListPanel.ensureVisible(),this._setCheckState({checkId:"ToggleLeftSidePanel",state:!0})},t.prototype._hideRootListPanel=function(){this._DEBUG&&console.log("ENO3DViewManipulations._hideRootListPanel called"),this._rootListPanel.hide(),this._setCheckState({checkId:"ToggleLeftSidePanel",state:!1})},t.prototype.displayTree=function(){this._DEBUG&&console.log("ENO3DViewManipulations.displayTree called"),console.warn("DEPRECATED : This method relies on the frame window, which does not exists in Wafr v2 widget.")},t})),define("DS/ENO3DView/views/ENO3DMinimapCanvas",["css!DS/ENO3DView/ENO3DView.css","DS/Utilities/Dom","DS/PADServices/utils/GlobalModelEvents"],(function(e,t,i){"use strict";function n(e){this.options=e||{},this.elements={},this.options=Object.assign({positionUser:null,startAngle:0},this.options),this._dragTO=null,this._clickTO=null,this._mouseLeaveTO=null,this._hoveredPoint=-1,this._compassMode=!1,this._localModelEvents=e.modelEvents,this.json={},this.images={},this._mode=null!=localStorage.getItem("MINIMAP_NAV_MODE")?Number(localStorage.getItem("MINIMAP_NAV_MODE")):this.options.navModes.PAN,this.add=!1,this.drag=!1,this.check=!1,this.onPoint=!1,this.zoomX=0,this.zoomY=0,this._backgroundColor="rgba(0, 0, 0, 0.6)",this.ratiox=0,this.ratioy=0,this.user={id:"user",coord:{x:-1,y:-1,tempx:-1,tempy:-1,newx:-1,newy:-1},sight:{x:0,y:0},color:"#ffff00"},this.angle=this.options.startAngle,this.canvas=t.createElement("canvas",{class:"canvas-minimap"}),this.image=new Image,this.point_img=new Image;const i=this.canvas.getContext("2d");this.__trackTransforms(i),this.__canvaFunctions()}return n.prototype.getCurrentMode=function(){return this._mode},n.prototype.setNavigationMode=function(e){if(Object.values(this.options.navModes).includes(e)){if(e===this.options.navModes.COMPASS)this.angle=0,this.__centerOnUser();else this._mode===this.options.navModes.COMPASS&&(this.angle=-this.sightangle);this._mode=e,this.__draw()}},n.prototype.imageFullVisible=async function(){const e=this.canvas.getContext("2d"),t=this.xOffset,i=this.yOffset,n=this.newWidth,o=this.newHeight;e.save(),e.translate(t+n/2,i+o/2),e.rotate(-this.angle*Math.PI/180),e.translate(-(t+n/2),-(i+o/2));const s=Math.round(((this.xOffset+e.getTransform().e/e.getTransform().a)*e.getTransform().a-(t+n/2+e.getTransform().e/e.getTransform().a)*e.getTransform().a)*Math.cos((360-this.angle)*Math.PI/180)+((this.yOffset+e.getTransform().f/e.getTransform().a)*e.getTransform().a-(i+o/2+e.getTransform().f/e.getTransform().a)*e.getTransform().a)*Math.sin((360-this.angle)*Math.PI/180)+(t+n/2+e.getTransform().e/e.getTransform().a)*e.getTransform().a),a=Math.round(((this.newWidth+this.xOffset+e.getTransform().e/e.getTransform().a)*e.getTransform().a-(t+n/2+e.getTransform().e/e.getTransform().a)*e.getTransform().a)*Math.cos((360-this.angle)*Math.PI/180)+((this.yOffset+e.getTransform().f/e.getTransform().a)*e.getTransform().a-(i+o/2+e.getTransform().f/e.getTransform().a)*e.getTransform().a)*Math.sin((360-this.angle)*Math.PI/180)+(t+n/2+e.getTransform().e/e.getTransform().a)*e.getTransform().a),r=Math.round(((this.xOffset+e.getTransform().e/e.getTransform().a)*e.getTransform().a-(t+n/2+e.getTransform().e/e.getTransform().a)*e.getTransform().a)*Math.cos((360-this.angle)*Math.PI/180)+((this.newHeight+this.yOffset+e.getTransform().f/e.getTransform().a)*e.getTransform().a-(i+o/2+e.getTransform().f/e.getTransform().a)*e.getTransform().a)*Math.sin((360-this.angle)*Math.PI/180)+(t+n/2+e.getTransform().e/e.getTransform().a)*e.getTransform().a),l=Math.round(((this.newWidth+this.xOffset+e.getTransform().e/e.getTransform().a)*e.getTransform().a-(t+n/2+e.getTransform().e/e.getTransform().a)*e.getTransform().a)*Math.cos((360-this.angle)*Math.PI/180)+((this.newHeight+this.yOffset+e.getTransform().f/e.getTransform().a)*e.getTransform().a-(i+o/2+e.getTransform().f/e.getTransform().a)*e.getTransform().a)*Math.sin((360-this.angle)*Math.PI/180)+(t+n/2+e.getTransform().e/e.getTransform().a)*e.getTransform().a),h=Math.round(-((this.xOffset+e.getTransform().e/e.getTransform().a)*e.getTransform().a-(t+n/2+e.getTransform().e/e.getTransform().a)*e.getTransform().a)*Math.sin((360-this.angle)*Math.PI/180)+((this.yOffset+e.getTransform().f/e.getTransform().a)*e.getTransform().a-(i+o/2+e.getTransform().f/e.getTransform().a)*e.getTransform().a)*Math.cos((360-this.angle)*Math.PI/180)+(i+o/2+e.getTransform().f/e.getTransform().a)*e.getTransform().a),d=Math.round(-((this.newWidth+this.xOffset+e.getTransform().e/e.getTransform().a)*e.getTransform().a-(t+n/2+e.getTransform().e/e.getTransform().a)*e.getTransform().a)*Math.sin((360-this.angle)*Math.PI/180)+((this.yOffset+e.getTransform().f/e.getTransform().a)*e.getTransform().a-(i+o/2+e.getTransform().f/e.getTransform().a)*e.getTransform().a)*Math.cos((360-this.angle)*Math.PI/180)+(i+o/2+e.getTransform().f/e.getTransform().a)*e.getTransform().a),c=Math.round(-((this.xOffset+e.getTransform().e/e.getTransform().a)*e.getTransform().a-(t+n/2+e.getTransform().e/e.getTransform().a)*e.getTransform().a)*Math.sin((360-this.angle)*Math.PI/180)+((this.newHeight+this.yOffset+e.getTransform().f/e.getTransform().a)*e.getTransform().a-(i+o/2+e.getTransform().f/e.getTransform().a)*e.getTransform().a)*Math.cos((360-this.angle)*Math.PI/180)+(i+o/2+e.getTransform().f/e.getTransform().a)*e.getTransform().a),p=Math.round(-((this.newWidth+this.xOffset+e.getTransform().e/e.getTransform().a)*e.getTransform().a-(t+n/2+e.getTransform().e/e.getTransform().a)*e.getTransform().a)*Math.sin((360-this.angle)*Math.PI/180)+((this.newHeight+this.yOffset+e.getTransform().f/e.getTransform().a)*e.getTransform().a-(i+o/2+e.getTransform().f/e.getTransform().a)*e.getTransform().a)*Math.cos((360-this.angle)*Math.PI/180)+(i+o/2+e.getTransform().f/e.getTransform().a)*e.getTransform().a);return e.restore(),s>=0&&s<=this.canvas.width&&a>=0&&a<=this.canvas.width&&r>=0&&r<=this.canvas.width&&l>=0&&l<=this.canvas.width&&h>=0&&h<=this.canvas.height&&d>=0&&d<=this.canvas.height&&c>=0&&c<=this.canvas.height&&p>=0&&p<=this.canvas.height},n.prototype.__checkPosition=async function(){const e=this.canvas.getContext("2d");if(0!=this.ratiox&&0!=this.ratioy&&!await this.imageFullVisible()){const t=this.canvas.width/4,i=this.canvas.height/4,n=this.xOffset,o=this.yOffset,s=this.newWidth,a=this.newHeight;e.translate(n+s/2,o+a/2),e.rotate(-this.angle*Math.PI/180),e.translate(-(n+s/2),-(o+a/2));const r=((this.user.coord.x/this.ratiox+this.xOffset+e.getTransform().e/e.getTransform().a)*e.getTransform().a-(n+s/2+e.getTransform().e/e.getTransform().a)*e.getTransform().a)*Math.cos((360-this.angle)*Math.PI/180)+((this.user.coord.y/this.ratioy+this.yOffset+e.getTransform().f/e.getTransform().a)*e.getTransform().a-(o+a/2+e.getTransform().f/e.getTransform().a)*e.getTransform().a)*Math.sin((360-this.angle)*Math.PI/180)+(n+s/2+e.getTransform().e/e.getTransform().a)*e.getTransform().a,l=-((this.user.coord.x/this.ratiox+this.xOffset+e.getTransform().e/e.getTransform().a)*e.getTransform().a-(n+s/2+e.getTransform().e/e.getTransform().a)*e.getTransform().a)*Math.sin((360-this.angle)*Math.PI/180)+((this.user.coord.y/this.ratioy+this.yOffset+e.getTransform().f/e.getTransform().a)*e.getTransform().a-(o+a/2+e.getTransform().f/e.getTransform().a)*e.getTransform().a)*Math.cos((360-this.angle)*Math.PI/180)+(o+a/2+e.getTransform().f/e.getTransform().a)*e.getTransform().a;r<t&&e.translate((t-r)/e.getTransform().a,0),r>this.canvas.width-t&&e.translate((this.canvas.width-t-r)/e.getTransform().a,0),l<i&&e.translate(0,(i-l)/e.getTransform().a),l>this.canvas.height-i&&e.translate(0,(this.canvas.height-i-l)/e.getTransform().a),e.translate(n+s/2,o+a/2),e.rotate(this.angle*Math.PI/180),e.translate(-(n+s/2),-(o+a/2))}},n.prototype.__draw=async function(){this.__drawImage(),this.newWidth&&(this.__drawUser(),this.__drawPoints())},n.prototype.__drawSight=async function(){const e=this.canvas.getContext("2d"),t=this.__getNormTrans();var i=Math.sqrt(t.a*t.a+t.c*t.c);const n=this.newWidth/100/(i/3),o=this.user.coord.x/this.ratiox+this.xOffset,s=this.user.coord.y/this.ratioy+this.yOffset;e.save(),e.translate(o,s),e.rotate(this.sightangle*Math.PI/180),e.translate(-o,-s),this.sight=new Path2D;const a=6*n;e.globalAlpha=.6,e.beginPath(),this.sight.moveTo(o-a/6,s),this.sight.lineTo(o-a/6-Math.sin(Math.PI/6)*n*2,s-a+Math.cos(Math.PI/6)*n),this.sight.lineTo(o+a/6,s),this.sight.moveTo(o+a/6+Math.sin(Math.PI/6)*n*2,s-a+Math.cos(Math.PI/6)*n),this.sight.lineTo(o+a/6,s),this.sight.lineTo(o-a/6-Math.sin(Math.PI/6)*n*2,s-a+Math.cos(Math.PI/6)*n);const r=e.createLinearGradient(o,s-3*n,o,s-5*n);r.addColorStop(0,"#42A2DA"),r.addColorStop(1,"transparent"),e.fillStyle=r,e.fill(this.sight),e.restore()},n.prototype.__drawImage=async function(){const e=this.canvas,t=this.canvas.getContext("2d");if(t.save(),t.setTransform(1,0,0,1,0,0),t.globalAlpha=.5,t.fillStyle=this._backgroundColor,t.clearRect(0,0,e.width,e.height),t.fillStyle="transparent",t.fillRect(0,0,e.width,e.height),t.restore(),0!=this.image.height){const i=this.image.width/this.image.height;this.newWidth=e.width,this.newHeight=this.newWidth/i,this.newHeight>e.height&&(this.newHeight=e.height,this.newWidth=this.newHeight*i),this.xOffset=this.newWidth<e.width?(e.width-this.newWidth)/2:0,this.yOffset=this.newHeight<e.height?(e.height-this.newHeight)/2:0,this.ratiox=this.image.width/this.newWidth,this.ratioy=this.image.height/this.newHeight,t.drawImage(this.image,this.xOffset,this.yOffset,this.newWidth,this.newHeight)}},n.prototype.__drawUser=function(){const e=this.user.coord.x,t=this.user.coord.y,i=this.__getNormTrans();var n=Math.sqrt(i.a*i.a+i.c*i.c);let o=Math.atan(this.user.sight.y/this.user.sight.x)*(180/Math.PI);if(o=this.user.sight.x>0?90+o:270+o,this.sightangle=o,this.user.coord.x==this.user.coord.newx&&this.user.coord.y==this.user.coord.newy||-1==this.user.coord.newx)this.__drawSight(),this.__drawPointUser(e/this.ratiox+this.xOffset,t/this.ratioy+this.yOffset,Math.abs(this.newWidth/100/(n/3))),this.check=!0;else{const e=30;this.user.coord.x=this.user.coord.x+(this.user.coord.newx-this.user.coord.tempx)/e,this.user.coord.y=this.user.coord.y+(this.user.coord.newy-this.user.coord.tempy)/e,this.__drawSight(),this.__drawPointUser(this.user.coord.x/this.ratiox+this.xOffset,this.user.coord.y/this.ratioy+this.yOffset,Math.abs(this.newWidth/100/(n/3))),Math.abs(this.user.coord.x-this.user.coord.newx)<.01&&Math.abs(this.user.coord.y-this.user.coord.newy)<.01&&(this.user.coord.x=this.user.coord.newx,this.user.coord.y=this.user.coord.newy),this.check&&this.__checkPosition(),this.myTimeout=setTimeout((()=>{this.__draw()}),500/e)}},n.prototype.__drawPointUser=async function(e,t,i){const n=this.canvas.getContext("2d");this.pointUser=new Path2D,n.fillStyle=this.user.color,n.beginPath(),this.pointUser.arc(e,t,i,0,2*Math.PI,!0),n.fillStyle="#368EC4",n.fill(this.pointUser),n.strokeStyle="white",n.lineWidth=i/5,n.stroke(this.pointUser)},n.prototype.__drawPoints=async function(){const e=this.canvas.getContext("2d"),t=this.__getNormTrans();var i=Math.sqrt(t.a*t.a+t.c*t.c);for(let t=0,n=this.json.length;t<n;t++){const n=this.json[t].coord;this.json[t].id,this._hoveredPoint.id;const o=n.x/this.ratiox+this.xOffset,s=n.y/this.ratioy+this.yOffset;e.fillStyle=this.json[t].color,e.save(),e.translate(o,s),this._mode!==this.options.navModes.COMPASS?e.rotate(-this.angle*Math.PI/180):e.rotate(-(this.angle-this.sightangle)*Math.PI/180),e.translate(-o,-s),this.__drawPinPhotoInverted(o,s,this.newWidth/100/(i/3)),e.restore()}},n.prototype.__drawPinPhotoInverted=async function(e,t,i){const n=this.canvas.getContext("2d"),o=i/1.5,s=1.333*i,a=n.fillStyle;n.beginPath(),n.arc(e,t-s,o,0,2*Math.PI,!0),n.fill(),n.beginPath(),n.fillStyle="white";const r=i/7.5,l=i/18.75,h=o,d=i/2.25;n.rect(e-h/2,t-s-d/2,h,d),n.moveTo(e,t),n.arc(e,t-s,r,0,2*Math.PI,!1),n.moveTo(e+h/3,t-s-d/4),n.arc(e+h/3,t-s-d/4,l,0,2*Math.PI,!1),n.rect(e-h/4,t-s-(d/2+d/8),h/2,d/8),n.fill("evenodd"),n.fillStyle=a,n.beginPath(),n.moveTo(e,t),n.lineTo(e-Math.sin(Math.PI/6)*o,t-s+Math.cos(Math.PI/6)*o),n.lineTo(e+Math.sin(Math.PI/6)*o,t-s+Math.cos(Math.PI/6)*o),n.fill()},n.prototype.__draw360=async function(e,t,i,n){const o=this.canvas.getContext("2d");o.strokeStyle=!0===n?"#0173c7":"#CCCCCC",o.lineWidth=.4*i,o.beginPath(),o.arc(e,t,i,0,2*Math.PI,!1),o.stroke(),o.lineWidth=.1*i,o.strokeStyle="#000000",o.beginPath(),o.arc(e,t,i,0,2*Math.PI,!1),o.stroke()},n.prototype.__checkScale=async function(e){const t=await this.__getNormTrans();let i=0;var n=Math.sqrt(t.a*t.a+t.c*t.c);return i=this.canvas.height>this.canvas.width?this.canvas.width:this.canvas.height,i/=Math.sqrt(Math.pow(this.newWidth,2)+Math.pow(this.newHeight,2)),n*e<i?e=i/n:n*e>100&&(e=100/n),e},n.prototype.__zoom=async function(e){const t=this.canvas.getContext("2d");e=await this.__checkScale(e);const i=t.transformedPoint(this.zoomX,this.zoomY);t.translate(i.x,i.y),t.scale(e,e),t.translate(-i.x,-i.y),this.__draw()},n.prototype.zoomIn=async function(e){this._mode===this.options.navModes.COMPASS?(this.__setZoomPos(this.canvas.width/2,this.canvas.height/2),this.__zoom(e)):this.__zoomUser(e)},n.prototype.__zoomUser=async function(e){const t=this.canvas.getContext("2d");e=await this.__checkScale(e),t.translate(this.user.coord.x/this.ratiox+this.xOffset,this.user.coord.y/this.ratioy+this.yOffset),t.scale(e,e),t.translate(-(this.user.coord.x/this.ratiox+this.xOffset),-(this.user.coord.y/this.ratioy+this.yOffset)),await this.__checkPosition(),this.__draw()},n.prototype.__redrawWithZoom=async function(){const e=this.canvas.getContext("2d"),t=e.getTransform();var i=Math.sqrt(t.a*t.a+t.c*t.c);i=await this.__checkScale(i),e.setTransform(1,0,0,1,0,0),this.zoomX=0,this.zoomY=0,e.translate(this.xOffset+this.newWidth/2,this.yOffset+this.newHeight/2),e.scale(i,i),e.rotate(this.angle*Math.PI/180),e.translate(-(this.xOffset+this.newWidth/2),-(this.yOffset+this.newHeight/2)),this.__draw()},n.prototype.__zoomFit=async function(){const e=this.canvas.getContext("2d");e.setTransform(1,0,0,1,0,0),this.zoomX=0,this.zoomY=0,e.translate(this.xOffset+this.newWidth/2,this.yOffset+this.newHeight/2),e.rotate(this.angle*Math.PI/180),e.translate(-(this.xOffset+this.newWidth/2),-(this.yOffset+this.newHeight/2)),this.__draw(),this._mode===this.options.navModes.COMPASS&&this.__centerOnUser()},n.prototype.resize=function(e,t){let i=this.canvas.getContext("2d"),n=this.canvas.width,o=this.canvas.height;this.__setWidth(e),this.__setHeight(t);this.canvas.width,this.canvas.height;i.setTransform(i.getTransform().a,i.getTransform().b,i.getTransform().c,i.getTransform().d,i.getTransform().e,i.getTransform().f),this.__draw(),this._mode===this.options.navModes.COMPASS?this.__centerOnUser():this.__redrawWithZoom()},n.prototype.__centerOnUser=async function(){if(this.newWidth>0&&this.newHeight>0){const i=this.newWidth,n=this.newHeight,o=this.canvas.getContext("2d"),s=o.getTransform(),a=Math.sqrt(s.a*s.a+s.c*s.c);var e=this.user.coord.x/this.ratiox,t=this.user.coord.y/this.ratioy;o.setTransform(1,0,0,1,0,0),o.translate(this.xOffset+this.newWidth/2,this.yOffset+this.newHeight/2),o.scale(a,a),o.rotate(-this.sightangle*Math.PI/180),o.translate(-(this.xOffset+this.newWidth/2),-(this.yOffset+this.newHeight/2)),o.translate(i/2-e,n/2-t),this.__draw()}},n.prototype.__rotate=async function(e){const t=this.canvas.getContext("2d");this.angle=this.angle+e,this.angle>360&&(this.angle=this.angle-360),t.save(),t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,this.canvas.width,this.canvas.height),t.restore(),t.translate(this.xOffset+this.newWidth/2,this.yOffset+this.newHeight/2),t.rotate(e*Math.PI/180),t.translate(-(this.xOffset+this.newWidth/2),-(this.yOffset+this.newHeight/2)),this.__draw()},n.prototype.__setWidth=async function(e){this.canvas.width=e},n.prototype.__setHeight=async function(e){this.canvas.height=e},n.prototype.__setPosUser=async function(e,t,i){-1==this.user.coord.x&&-1==this.user.coord.y||1==i?(this.user.coord.x=e,this.user.coord.y=t):[e,t]=this._setInsideImage([e,t]),this.user.coord.tempx=this.user.coord.x,this.user.coord.tempy=this.user.coord.y,this.user.coord.newx=e,this.user.coord.newy=t},n.prototype.updateUser=async function(e,t){if(this._mode===this.options.navModes.COMPASS){var[i,n]=this._setInsideImage([e,t]);this.__setPosUser(i,n,!0),this.__draw(),this.__centerOnUser()}else this.__setPosUser(e,t,!1)},n.prototype.__setZoomPos=async function(e,t){this._mode===this.options.navModes.COMPASS?(this.zoomX=this.canvas.width/2,this.zoomY=this.canvas.height/2):(this.zoomX=e,this.zoomY=t)},n.prototype.__setImage=function(e){return new Promise((t=>{const i=new Image;i.src=e,this.images[e]?(this.image=this.images[e],t()):i.decode().then((()=>{this.images[e]=i,this.image=i,t()}))}))},n.prototype.__setSight=async function(e,t){this.user.sight.x=e,this.user.sight.y=t},n.prototype.__changeIdLevel=async function(e){return new Promise((t=>{this.options.positionUser.idLevel=e.id,this.__setImage(e.url).then((()=>{if(this.json=[],e.acquisitionPoints)for(let t=0;t<e.acquisitionPoints.length;t++){const i={};i.id=e.acquisitionPoints[t].id,i.coord={},i.coord.x=e.acquisitionPoints[t].coord.x.valueOf(),i.coord.y=this.image.height-e.acquisitionPoints[t].coord.y.valueOf(),i.color=e.acquisitionPoints[t].color,this.json.push(i)}t()}))}))},n.prototype.__getNormTrans=function(){let e={};const t=this.canvas.getContext("2d");return t.save(),t.translate(this.xOffset+this.newWidth/2,this.yOffset+this.newHeight/2),t.rotate(-this.angle*Math.PI/180),t.translate(-(this.xOffset+this.newWidth/2),-(this.yOffset+this.newHeight/2)),e=t.getTransform(),t.restore(),e},n.prototype.__handlemove=async function(e,t,i,n){let o=0,s=0,a=0;null!=e.offsetX&&null!=e.offsetY?(o=e.offsetX,s=e.offsetY):(a=this.canvas.getBoundingClientRect(),o=e.touches[0].clientX-a.left,s=e.touches[0].clientY-a.top);const r=this.canvas.getContext("2d");let l=r.transformedPoint(o,s);if(n)if(t){var h=l.x-t.x,d=l.y-t.y;this._mode===this.options.navModes.COMPASS&&(this._isInsideImage([this.user.coord.x-h*this.ratiox,this.user.coord.y-d*this.ratioy])?this.__setPosUser(this.user.coord.x-h*this.ratiox,this.user.coord.y-d*this.ratioy,!0):(h=0,d=0)),r.translate(h,d),this.__draw()}else if(i){const e=this.canvas.width/2,t=this.canvas.height/2;let n=Math.atan2(l.y-t,l.x-e)*(180/Math.PI);n=l.x-e>0?(l.y,90+n):l.y-t>0?90+n:450+n;const o=n-i;this.__rotate(o),this.__draw()}await this.__hover(o,s),this.__changecursor()},n.prototype.__hover=async function(e,t){if(null!=this.newWidth){const o=this.canvas.getContext("2d");let s=o.transformedPoint(e,t);s.x=s.x-this.xOffset,s.y=s.y-this.yOffset;const a=await this.__getNormTrans();this.onPoint=!1;var i=Math.sqrt(a.a*a.a+a.c*a.c),n=this._hoveredPoint?this._hoveredPoint.id:-1;if(this._hoveredPoint=await this.__findPoint(s.x*this.ratiox,s.y*this.ratioy,this.canvas.width/100/(i/3)*this.ratiox,this.canvas.width/100/(i/3)*this.ratioy),-1!=this._hoveredPoint&&(this.onPoint=!0),n!==this._hoveredPoint.id&&this.__drawPoints(),o.isPointInPath(this.pointUser,e,t));else{const e=this.user.coord.x/this.ratiox+this.xOffset,t=this.user.coord.y/this.ratioy+this.yOffset;o.save(),o.translate(e,t),o.rotate(this.sightangle*Math.PI/180),o.translate(-e,-t),o.restore()}}},n.prototype.__changecursor=async function(){this.add?this.canvas.style.cursor="pointer":this._mode===this.options.navModes.COMPASS?this.canvas.style.cursor="move":this.drag?this.canvas.style.cursor="grabbing":(this.onPoint,this.canvas.style.cursor="pointer")},n.prototype.__findPoint=async function(e,t,i,n){let o=[];const s=1.5;let a={};for(let a=0,r=this.json.length;a<r;a++){let r=this.json[a];r.coord.x<e+i*s&&r.coord.x>e-i*s&&r.coord.y<t+2*n*s&&r.coord.y>t-.5*n*s&&o.push(r)}if(o.length>0){let i=9999999;if(o.length>1)for(let n=0;n<o.length;n++){let s=o[n],r=Math.sqrt(Math.pow(e-s.coord.x,2)+Math.pow(t-s.coord.y,2));r<i&&(i=r,a=s)}else a=o[0];return a}return-1},n.prototype.__canvaFunctions=async function(){const e=this.canvas.getContext("2d"),t=this.canvas;let n,o,s,a,r=!1;t.onmousewheel=function(e){e.preventDefault();const t=e.wheelDelta?e.wheelDelta/40:e.detail?-e.detail:0,i=Math.pow(1.1,t);this.__setZoomPos(e.offsetX,e.offsetY),this.__zoom(i),s=e.offsetX,a=e.offsetY,this.__hover(s,a),this.__changecursor()}.bind(this),t.onmousedown=async function(t){null!=t.offsetX&&null!=t.offsetY&&(s=t.offsetX,a=t.offsetY),r=!0,this._clickTO=setTimeout((()=>{this._clickTO=null}),500);const i=e.transformedPoint(s,a);if(this._mode===this.options.navModes.ROTATE){const e=this.canvas.width/2,t=this.canvas.height/2;o=Math.atan2(i.y-t,i.x-e)/Math.PI*180,o=i.x-e>0?(i.y,90+o):i.y-t>0?90+o:450+o}else n=e.transformedPoint(s,a);this._dragTO=setTimeout((()=>{this.drag=!0,this._dragTO=null}),150),this.__changecursor()}.bind(this),t.onmouseup=function(){r=!1,n&&this._mode===this.options.navModes.COMPASS&&(this.check=!1,require(["DS/PADServices/utils/PADTrackerManager"],(e=>{const t=e.getPADTracker({eventCategory:"usage",eventAction:"ENO3DMinimap-usage"});t.setEventData({eventLabel:"ENO3DMinimap-setViewpoint"}),t.trackPageEvent()})),this._localModelEvents.publish({event:"ENO3DView/ENO3DMinimap/GetViewPoint",data:{idLevel:this.options.positionUser.idLevel,x:this.user.coord.x,y:this.image.height-this.user.coord.y,draggingUser:!1}}),i.publish({event:"ENO3DView/ENO3DMinimap/ChangeUpdate",data:!0})),setTimeout((()=>{this.drag=!1,this._dragTO=null}),100),n=null,o=null}.bind(this),t.onmousemove=function(e){this._mouseLeaveTO&&(clearTimeout(this._mouseLeaveTO),this._mouseLeaveTO=null),this.__handlemove(e,n,o,r)}.bind(this),t.onmouseleave=function(){this._mouseLeaveTO=setTimeout((()=>{t.onmouseup(),this.drag=!1,n=null,this._mouseLeaveTO=null}),50)}.bind(this),t.onclick=async function(i){if(this._mode!==this.options.navModes.COMPASS&&(require(["DS/PADServices/utils/PADTrackerManager"],(e=>{const t=e.getPADTracker({eventCategory:"usage",eventAction:"ENO3DMinimap-usage"});t.setEventData({eventLabel:"ENO3DMinimap-setViewpoint"}),t.trackPageEvent()})),this.newWidth&&!this.drag&&this._clickTO)){this._clickTO=null,s=i.offsetX,a=i.offsetY;let o,r,l=e.transformedPoint(s,a);if(l.x=l.x-this.xOffset,l.y=l.y-this.yOffset,this.onPoint){const e=await this.__getNormTrans();var n=Math.sqrt(e.a*e.a+e.c*e.c);let i=await this.__findPoint(l.x*this.ratiox,l.y*this.ratioy,t.width/100/(n/3)*this.ratiox,t.width/100/(n/3)*this.ratioy);o=i.coord.x,r=i.coord.y}else o=l.x*this.ratiox,r=l.y*this.ratioy;this.check=!1,this.__draw(),this._localModelEvents.publish({event:"ENO3DView/ENO3DMinimap/GetViewPoint",data:{idLevel:this.options.positionUser.idLevel,x:o,y:this.image.height-r,updateOnlyEnd:!0,draggingUser:!1}})}this.drag&&(this.drag=!1)}.bind(this);let l=0;t.ontouchstart=async function(t){const i=this.canvas.getBoundingClientRect();s=t.touches[0].clientX-i.left,a=t.touches[0].clientY-i.top,r=!0,this._clickTO=setTimeout((()=>{this._clickTO=null}),500);const h=e.transformedPoint(s,a);if(await this.__hover(s,a),l=(new Date).getTime(),this._mode===this.options.navModes.ROTATE){const e=this.canvas.width/2,t=this.canvas.height/2;o=Math.atan2(h.y-t,h.x-e)/Math.PI*180,o=h.x-e>0?(h.y,90+o):h.y-t>0?90+o:450+o}else n=e.transformedPoint(s,a);this._dragTO=setTimeout((()=>{this.drag=!0,this._dragTO=null}),150)}.bind(this),t.ontouchmove=function(e){this._mouseLeaveTO&&(clearTimeout(this._mouseLeaveTO),this._mouseLeaveTO=null),this.__handlemove(e,n,o,r)}.bind(this),t.ontouchend=function(e){if(r=!1,n&&this._mode===this.options.navModes.COMPASS&&(this.check=!1,require(["DS/PADServices/utils/PADTrackerManager"],(e=>{const t=e.getPADTracker({eventCategory:"usage",eventAction:"ENO3DMinimap-usage"});t.setEventData({eventLabel:"ENO3DMinimap-setViewpoint"}),t.trackPageEvent()})),this._localModelEvents.publish({event:"ENO3DView/ENO3DMinimap/GetViewPoint",data:{idLevel:this.options.positionUser.idLevel,x:this.user.coord.x,y:this.image.height-this.user.coord.y,draggingUser:!1}}),i.publish({event:"ENO3DView/ENO3DMinimap/ChangeUpdate",data:!0})),setTimeout((()=>{this.drag=!1,this._dragTO=null}),100),(new Date).getTime()-l<400){const i=e.target.getBoundingClientRect();let n,o;e.targetTouches&&e.targetTouches[0]&&(n=e.targetTouches[0].pageX-i.left,o=e.targetTouches[0].pageY-i.top),e.offsetX=n,e.offsetY=o,t.onclick(e)}n=null,o=null}.bind(this)},n.prototype._backgroundChange=function(e){this._backgroundColor="#"+e.color,this.__draw()},n.prototype._setInsideImage=function(e){var t=e[0],i=e[1];return t<0&&(t=0),i<0&&(i=0),t>this.image.width&&0!=this.image.width&&(t=this.image.width),i>this.image.height&&0!=this.image.height&&(i=this.image.height),[t,i]},n.prototype._isInsideImage=function(e){var t=e[0],i=e[1];return!(t<0)&&(!(i<0)&&(!(t>this.image.width&&0!=this.image.width)&&!(i>this.image.height&&0!=this.image.height)))},n.prototype.__trackTransforms=function(e){var t=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=t.createSVGMatrix();e.getTransform=function(){return i};var n=[],o=e.save;e.save=function(){return n.push(i.translate(0,0)),o.call(e)};var s=e.restore;e.restore=function(){return i=n.pop(),s.call(e)};var a=e.scale;e.scale=function(t,n){return i=i.scaleNonUniform(t,n),a.call(e,t,n)};var r=e.rotate;e.rotate=function(t){if(!isNaN(t))return i=i.rotate(180*t/Math.PI),r.call(e,t)};var l=e.translate;e.translate=function(t,n){if(!isNaN(t)&&!isNaN(n))return i=i.translate(t,n),l.call(e,t,n)};var h=e.transform;e.transform=function(n,o,s,a,r,l){const d=t.createSVGMatrix();return d.a=n,d.b=o,d.c=s,d.d=a,d.e=r,d.f=l,i=i.multiply(d),h.call(e,n,o,s,a,r,l)};var d=e.setTransform;e.setTransform=function(t,n,o,s,a,r){return i.a=t,i.b=n,i.c=o,i.d=s,i.e=a,i.f=r,d.call(e,t,n,o,s,a,r)};var c=t.createSVGPoint();e.transformedPoint=function(e,t){return c.x=e,c.y=t,c.matrixTransform(i.inverse())},e.reset=function(i,n){var o=t.createSVGMatrix();e.setTransform(o.a,o.b,o.c,o.d,o.e,o.f)}},n.prototype.getHTML=function(){return this.canvas},n})),define("DS/ENO3DView/views/ENO3DMinimapToolbar",["css!DS/ENO3DView/ENO3DView.css","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/Utilities/Dom","DS/Controls/Button","DS/Controls/ComboBox","DS/Controls/ButtonGroup","DS/Controls/TooltipModel","DS/PADServices/utils/GlobalUtils"],(function(e,t,i,n,o,s,a,r){"use strict";const l="minimap";function h(e){this.elements={},this.options=e||{},this.options=Object.assign({nbfloor:null,toolbarMap:null,level:0},this.options),this._zoomButtons={zoomIn:null,zoomOut:null,zoomFit:null};var h=localStorage.getItem("MINIMAP_NAV_MODE")?Number(localStorage.getItem("MINIMAP_NAV_MODE")):this.options.navModes.PAN;this.options.backgroundColor||(this.options.backgroundColor="232323"),this._localModelEvents=e.modelEvents;this.elements.toolbarMap=i.createElement("div",{class:l+"-toolbar-container minimap-toolbar-out"});let d=i.createElement("div",{class:l+"-toolbar-button-horizontal"});var c=[];for(let e=0;e<this.options.nbfloor;e++)c.push({icon:"floors wux-ui-3ds",label:""+e,value:e});let p=i.createElement("div",{class:l+"-toolbar-button-multi-vert"});this.elements.floors=new o({enableSearchFlag:!1,elementsList:c,displayStyle:"normal"}).inject(d),this.elements.floors.addEventListener("change",function(){this._localModelEvents.publish({event:"ENO3DView/ENO3DMinimap/GetLevel",data:{idLevel:this.elements.floors.value}})}.bind(this)),this.elements.floors.getContent().addClassName("minimap-toolbar-combobox");let u=i.createElement("div",{class:l+"-toolbar-button-multi-hor"});var m=new a({shortHelp:t.minimap.selectionMenu.pan.title});let g=new n({label:t.minimap.selectionMenu.pan.title,showLabelFlag:!1,icon:{iconName:"view-pan",fontIconFamily:WUXManagedFontIcons.Font3DS},type:"radio",tooltipInfos:m});g.getContent().addClassName("minimap-toolbar-button"),g.addEventListener("buttonclick",function(){this.canvas.setNavigationMode(this.options.navModes.PAN),g.getContent().addClassName("minimap-toolbar-button-selected"),v.getContent().removeClassName("minimap-toolbar-button-selected"),f.getContent().removeClassName("minimap-toolbar-button-selected"),localStorage.setItem("MINIMAP_NAV_MODE",this.options.navModes.PAN),this._setZoomButtonAvailable(!0)}.bind(this));var _=new a({shortHelp:t.minimap.selectionMenu.rotate.title});let f=new n({label:t.minimap.selectionMenu.rotate.title,showLabelFlag:!1,icon:{iconName:"rotate-cw",fontIconFamily:WUXManagedFontIcons.Font3DS},type:"radio",tooltipInfos:_});f.getContent().addClassName("minimap-toolbar-button"),f.addEventListener("buttonclick",function(){this.canvas.setNavigationMode(this.options.navModes.ROTATE),f.getContent().addClassName("minimap-toolbar-button-selected"),v.getContent().removeClassName("minimap-toolbar-button-selected"),g.getContent().removeClassName("minimap-toolbar-button-selected"),localStorage.setItem("MINIMAP_NAV_MODE",this.options.navModes.ROTATE),this._setZoomButtonAvailable(!0)}.bind(this));var C=new a({shortHelp:t.minimap.selectionMenu.compass.title});let v=new n({label:t.minimap.selectionMenu.compass.title,showLabelFlag:!1,icon:{iconName:"compass",fontIconFamily:WUXManagedFontIcons.Font3DS},type:"radio",tooltipInfos:C});v.getContent().addClassName("minimap-toolbar-button"),v.addEventListener("buttonclick",function(){this.canvas.setNavigationMode(this.options.navModes.COMPASS),v.getContent().addClassName("minimap-toolbar-button-selected"),f.getContent().removeClassName("minimap-toolbar-button-selected"),g.getContent().removeClassName("minimap-toolbar-button-selected"),localStorage.setItem("MINIMAP_NAV_MODE",this.options.navModes.COMPASS),this._setZoomButtonAvailable(!1)}.bind(this));let D=new s({});D.getContent().addClassName("minimap-toolbar-button-multi-hor"),D.addChild(g),D.addChild(f),D.addChild(v),D.inject(u);let b=i.createElement("div",{class:l+"-toolbar-button-multi-vert"});var w=new a({shortHelp:t.minimap.selectionMenu.zoomfit.title});let y=new n({label:t.minimap.selectionMenu.zoomfit.title,showLabelFlag:!1,icon:{iconName:"zoom-fit",fontIconFamily:WUXManagedFontIcons.Font3DS},tooltipInfos:w}).inject(p);y.getContent().addClassName("minimap-toolbar-button-vert minimap-toolbar-button"),y.addEventListener("buttonclick",function(){this.canvas.__zoomFit()}.bind(this)),this._zoomButtons.zoomFit=y;var S=new a({shortHelp:t.minimap.selectionMenu.zoomin.title});let E=new n({label:t.minimap.selectionMenu.zoomin.title,showLabelFlag:!1,icon:{iconName:"plus",fontIconFamily:WUXManagedFontIcons.Font3DS},tooltipInfos:S}).inject(b);E.getContent().addClassName("minimap-toolbar-button-vert minimap-toolbar-button"),E.addEventListener("buttonclick",function(){this.canvas.zoomIn(Math.pow(1+Math.abs(.24)/2,1))}.bind(this)),this._zoomButtons.zoomIn=E;var P=new a({shortHelp:t.minimap.selectionMenu.zoomout.title});let O=new n({label:t.minimap.selectionMenu.zoomout.title,showLabelFlag:!1,icon:{iconName:"minus",fontIconFamily:WUXManagedFontIcons.Font3DS},tooltipInfos:P}).inject(b);switch(O.getContent().addClassName("minimap-toolbar-button-vert minimap-toolbar-button"),O.addEventListener("buttonclick",function(){this.canvas.__setZoomPos(this.canvas.canvas.width/2,this.canvas.canvas.height/2),this.canvas.__zoom(Math.pow(1+Math.abs(-.24)/2,-1))}.bind(this)),this._zoomButtons.zoomOut=O,p.appendChild(b),this.elements.toolbarMap.appendChild(d),this.elements.toolbarMap.appendChild(p),this.elements.toolbarMap.appendChild(u),h){case this.options.navModes.COMPASS:v.getContent().addClassName("minimap-toolbar-button-selected"),f.getContent().removeClassName("minimap-toolbar-button-selected"),g.getContent().removeClassName("minimap-toolbar-button-selected"),this._setZoomButtonAvailable(!1),v.checkFlag=!0;break;case this.options.navModes.ROTATE:f.getContent().addClassName("minimap-toolbar-button-selected"),v.getContent().removeClassName("minimap-toolbar-button-selected"),g.getContent().removeClassName("minimap-toolbar-button-selected"),f.checkFlag=!0,this._setZoomButtonAvailable(!0);break;case this.options.navModes.PAN:g.getContent().addClassName("minimap-toolbar-button-selected"),v.getContent().removeClassName("minimap-toolbar-button-selected"),f.getContent().removeClassName("minimap-toolbar-button-selected"),g.checkFlag=!0,this._setZoomButtonAvailable(!0)}r.isMobileDevice()?this.minimap&&this.minimap.elements&&this.minimap.elements.toolbar&&this.hover():this.minimap&&this.minimap.elements&&this.minimap.elements.toolbar&&this.exit()}return h.prototype.__setCanva=async function(e){this.canvas=e},h.prototype.__setFooter=async function(e){this.footer=e},h.prototype.__updateFloorId=async function(e){this.elements.floors.value=e},h.prototype._setZoomButtonAvailable=function(e){this._zoomButtons&&null!=this._zoomButtons.zoomFit&&(this._zoomButtons.zoomFit.disabled=!e)},h.prototype.setFullscreen=function(e){var t=5;!0===e&&(t=94,r.isMobileDevice()&&(t=125)),this.elements.toolbarMap.style.paddingBottom=t+"px"},h.prototype.hover=function(){this.elements.toolbarMap&&this.elements.toolbarMap.classList&&(this.elements.toolbarMap.classList.add("minimap-toolbar-over"),this.elements.toolbarMap.classList.remove("minimap-toolbar-out"))},h.prototype.exit=function(){r.isMobileDevice()?this.hover():this.elements.toolbarMap&&this.elements.toolbarMap.classList&&(this.elements.toolbarMap.classList.remove("minimap-toolbar-over"),this.elements.toolbarMap.classList.add("minimap-toolbar-out"))},h.prototype.getHTML=function(){return this.elements.toolbarMap},h})),define("DS/ENO3DView/views/ENO3DPointVisualizationPanel",["css!DS/ENO3DView/ENO3DView.css","UWA/Controls/Abstract","DS/Controls/Toggle","DS/Utilities/Dom","DS/Windows/Panel","i18n!DS/PADServices/assets/nls/PADServices","DS/Controls/ComboBox","DS/Controls/Slider","DS/PADServices/utils/PADTrackerManager"],(function(e,t,i,n,o,s,a,r,l){"use strict";const h="eno3dview-point-visualization";return t.extend({name:h,init:function(e){this._parent(e),this.options=e,this._buildContent()},_buildContent:function(){this.elements.content=n.createElement("div",{class:h+"-container"}),this.elements.panel=new o({identifier:"ENO3DPointVisualization",immersiveFrame:this.options.immersiveFrame,title:s.pointVisualizationPanel.title,position:{my:"center center",at:"center center",of:this.options.immersiveFrame,offsetY:-this.options.immersiveFrame.getContent().offsetHeight/4,colision:"fit"},minWidth:250,autoCloseFlag:!1,content:this.elements.content,allowedDockAreas:WUXDockAreaEnum.TopDockArea|WUXDockAreaEnum.LeftDockArea|WUXDockAreaEnum.RightDockArea,resizableFlag:!1,collapsibleFlag:!1,closeButtonFlag:!0,horizontallyStretchable:!1,verticallyStretchable:!1}),this.elements.panel.addEventListener("close",function(e){this.options.events.onClosePanel()}.bind(this)),this.elements.pointShapeContainer=n.createElement("div",{class:h+"-row"}),this.elements.content.appendChild(this.elements.pointShapeContainer),this.elements.pointShapeLabel=n.createElement("div",{class:h+"-pointShape-label"}),this.elements.pointShapeLabel.innerText=s.pointVisualizationPanel.pointShape,this.elements.pointShapeContainer.appendChild(this.elements.pointShapeLabel),this.elements.pointShapeComboBox=new a({domId:h+"-pointShape-combobox",elementsList:[{label:s.pointVisualizationPanel.shape.square,icon:"stop",value:"square"},{label:s.pointVisualizationPanel.shape.circle,icon:"record",value:"circle"}],enableSearchFlag:!1,actionOnClickFlag:!1,value:window.localStorage.getItem("ENO3DRealDataPointShape")?window.localStorage.getItem("ENO3DRealDataPointShape"):"square"}),this.elements.pointShapeComboBox.getContent().addEventListener("change",function(e){this._onPointShapeChangedCB(e.dsModel.value,!0)}.bind(this)),this.elements.pointShapeContainer.appendChild(this.elements.pointShapeComboBox.getContent()),this.elements.pointSizeContainer=n.createElement("div",{class:h+"-row"}),this.elements.content.appendChild(this.elements.pointSizeContainer),this.elements.pointSizeLabel=n.createElement("div",{class:h+"-pointShape-label"}),this.elements.pointSizeLabel.innerText=s.pointVisualizationPanel.pointSize,this.elements.pointSizeContainer.appendChild(this.elements.pointSizeLabel),this.elements.splattingSlider=new r({domId:h+"-pointSize-slider",value:window.localStorage.getItem("ENO3DRealDataSplattingValue")?parseFloat(window.localStorage.getItem("ENO3DRealDataSplattingValue")):1,minValue:0,maxValue:2,stepValue:.1}),this.elements.splattingSlider.getTextFromValue=function(){},this.elements.splattingSlider.getContent().addEventListener("change",this._onPointSizeChangedCB.bind(this)),this.elements.splattingSlider.getContent().addEventListener("endEdit",this._onPointSizeEndEditCB.bind(this)),this.elements.pointSizeContainer.appendChild(this.elements.splattingSlider.getContent()),this.elements.edlContainer=n.createElement("div",{class:h+"-row"}),this.elements.content.appendChild(this.elements.edlContainer),this.elements.edlLabel=n.createElement("div",{class:h+"-edl-label"}),this.elements.edlLabel.innerText=s.pointVisualizationPanel.edl,this.elements.edlContainer.appendChild(this.elements.edlLabel),this.elements.edlToggle=new i({type:"switch",domId:h+"-edl-toggle",checkFlag:"true"===window.localStorage.getItem("ENO3DRealDataEDL")}),this.elements.edlToggle.addEventListener("change",this._onEDLChangedCB.bind(this)),this.elements.edlContainer.appendChild(this.elements.edlToggle.getContent()),this.elements.edlParamsContainer=n.createElement("div",{class:h+"-container-margin"}),this.elements.edlRadiusContainer=n.createElement("div",{class:h+"-row"}),this.elements.edlParamsContainer.appendChild(this.elements.edlRadiusContainer),this.elements.edlRadiusLabel=n.createElement("div",{class:h+"-EDLRadius-label"}),this.elements.edlRadiusLabel.innerText=s.pointVisualizationPanel.edlRadius,this.elements.edlRadiusContainer.appendChild(this.elements.edlRadiusLabel),this.elements.edlRadiusSlider=new r({domId:h+"-edlRadius-slider",value:window.localStorage.getItem("ENO3DRealDataEDLRadiusValue")?parseFloat(window.localStorage.getItem("ENO3DRealDataEDLRadiusValue")):2,minValue:.1,maxValue:3,stepValue:.1}),this.elements.edlRadiusSlider.getContent().addEventListener("change",this._onEdlRadiusChangedCB.bind(this)),this.elements.edlRadiusSlider.getContent().addEventListener("endEdit",this._onEdlRadiusEndEditCB.bind(this)),this.elements.edlRadiusContainer.appendChild(this.elements.edlRadiusSlider.getContent()),this.elements.edlStrengthContainer=n.createElement("div",{class:h+"-row"}),this.elements.edlParamsContainer.appendChild(this.elements.edlStrengthContainer),this.elements.edlStrengthLabel=n.createElement("div",{class:h+"-EDLStrength-label"}),this.elements.edlStrengthLabel.innerText=s.pointVisualizationPanel.edlStrength,this.elements.edlStrengthContainer.appendChild(this.elements.edlStrengthLabel),this.elements.edlStrengthSlider=new r({domId:h+"-edlStrength-slider",value:window.localStorage.getItem("ENO3DRealDataEDLStrengthValue")?parseFloat(window.localStorage.getItem("ENO3DRealDataEDLStrengthValue")):1.2,minValue:.1,maxValue:3,stepValue:.1}),this.elements.edlStrengthSlider.getContent().addEventListener("change",this._onEdlStrengthChangedCB.bind(this)),this.elements.edlStrengthSlider.getContent().addEventListener("endEdit",this._onEdlStrengthEndEditCB.bind(this)),this.elements.edlStrengthContainer.appendChild(this.elements.edlStrengthSlider.getContent()),this._setEDLParamsVisibility(this.elements.edlToggle.checkFlag)},destroy:function(){this.elements.panel.destroy(),delete this.elements,delete this.options},_onPointSizeChangedCB:function(e){this.options.events.onPointSizeChanged(e.dsModel.value)},_onPointSizeEndEditCB:function(e){window.localStorage.setItem("ENO3DRealDataSplattingValue",e.dsModel.value),this.options.events.onPointSizeEndEdit(e.dsModel.value)},_onEdlStrengthChangedCB:function(e){this.options.events.onEdlStrengthChanged(e.dsModel.value)},_onEdlStrengthEndEditCB:function(e){window.localStorage.setItem("ENO3DRealDataEDLStrengthValue",e.dsModel.value),this.options.events.onEdlStrengthEndEdit(e.dsModel.value)},_onEdlRadiusChangedCB:function(e){this.options.events.onEdlRadiusChanged(e.dsModel.value)},_onEdlRadiusEndEditCB:function(e){window.localStorage.setItem("ENO3DRealDataEDLRadiusValue",e.dsModel.value),this.options.events.onEdlRadiusEndEdit(e.dsModel.value)},_onPointShapeChangedCB:function(e,t){window.localStorage.setItem("ENO3DRealDataPointShape",e),this.options.events.onPointShapeChanged(e,t)},_onEDLChangedCB:function(e){window.localStorage.setItem("ENO3DRealDataEDL",e.dsModel.checkFlag),this.options.events.onEDLChanged(e.dsModel.checkFlag),this._setEDLParamsVisibility(e.dsModel.checkFlag)},_setEDLParamsVisibility:function(e){!0===e?this.elements.content.appendChild(this.elements.edlParamsContainer):this.elements.edlParamsContainer.parentNode&&this.elements.content.removeChild(this.elements.edlParamsContainer)}})})),define("DS/ENO3DView/mixins/ENO3DViewAccessors",["DS/PADUtils/PADSettingsMgt","DS/ENOPAD3DViewer/utils/PAD3DViewerVisuServices","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices"],(function(e,t,i){"use strict";function n(){}return n.prototype.getWidgetComponent=function(){return this.getComponentFromIdentifier(this._identifiers.widget)},n.prototype.getWidget=function(){return this.getWidgetComponent().getSessionWidget()},n.prototype.getLandingPageComponent=function(){return this.getComponentFromIdentifier(this._identifiers.landingPage)},n.prototype.get3DViewer=function(){return this._viewer},n.prototype.getTriptych=function(){return this._triptych},n.prototype.getCommandContext=function(){return this._context},n.prototype.getDefaultProgressBarVisibility=function(){return this._defaultProgressBarVisibility},n.prototype.getAutomaticReframePolicy=function(){return!window.ENOPADNoReframe&&this._automaticReframePolicy},n.prototype.getApplicativeData=function(){return this._applicativeData},n.prototype.getPropertiesFacet=function(){return e.getSetting("propertiesFacet")?e.getSetting("propertiesFacet"):[]},n.prototype.getContentName=function(e){return new Promise(((t,i)=>{this._controller.getContentName().then((i=>{e&&e.callbacks&&e.callbacks.onComplete&&e.callbacks.onComplete(i),t(i)})).catch((t=>{e&&e.callbacks&&e.callbacks.onFailure&&e.callbacks.onFailure(t),i(t)}))}))},n.prototype.getRootBagPath=function(){return this._controller.getRootBagPath()},n.prototype.getRoots=function(){return this._controller.getRootBag().children},n.prototype.getViewer=function(){return this._viewer},n.prototype.getController=function(){return this._controller},n.prototype.getBIController=function(){return this._controller},n.prototype.getHideShowController=function(){return this._hideShowController},n.prototype.getModelEvents=function(){return this._modelEvents},n.prototype.getCommandProxy=function(){return this._commandProxy},n.prototype.getDecorationBag=function(){return this._controller.getDecorationBag()},n.prototype.getViewpoint=function(){return this._viewpoint},n.prototype.getViewpointParameters=function(e){if(this.getViewpoint())return"2.0"===e?t.buildViewPoint2(this.getViewpoint()):t.buildViewPoint(this.getViewpoint())},n.prototype.getStatusBar=function(e){return this.elements.padstatusbar},n.prototype.getCurrentLayout=function(){return this._layout},n.prototype.getFrameWindow=function(e){console.warn("FrameWindow does not exist in WAFR anymore, this is an incomplete polyfill, please migrate your code to stop relying on the FrameWindow accessors");const t={};return t.getImmersiveFrame=()=>this.getWafrUIFrame().getImmersiveFrame(),t.getTree=function(){return{show:function(){},hide:function(){}}},t.getViewer=function(){return this._viewer}.bind(this),t.getViewpoint=function(){return this.getViewpoint()}.bind(this),t.getContextualUIManager=function(){return this.getComponentFromIdentifier(WAfrStandardComponentKey.UIComponent).getContextualUIComponentManager()}.bind(this),t.getUIFrame=function(){return this.getComponentFromIdentifier(WAfrStandardComponentKey.UIFrame).getUIFrame()}.bind(this),t.getActionBar=function(){return null},t},n.prototype.getDOMElement=function(e){return void 0!==this.elements[e]?this.elements[e]:"widgetWrapper"===e?void 0!==widget.elements&&void 0!==widget.elements.wrapper?widget.elements.wrapper:this.elements.container:null},n.prototype._getFrustumDefinition=function(e){if(this.getViewer()&&this.getViewpoint())return t._getFrustumDefinition(this.getViewer(),this.getViewpoint(),e)},n.prototype.setDefaultContextualBarVisibility=function(e){this._defaultContextualBarVisibility=e},n.prototype.setDefaultProgressBarVisibility=function(e){this._defaultProgressBarVisibility=e},n.prototype.setAutomaticReframePolicy=function(e){this._automaticReframePolicy=e,this._applicativeAutomaticReframePolicy=e},n.prototype._setInternalAutomaticReframePolicy=function(e){this._automaticReframePolicy=e},n.prototype.setDefaultContextualMenuVisibility=function(e){this._defaultContextualMenuVisibility=e},n.prototype.setOpenWithMenuAvailability=function(e){this._openWithMenuAvailability=e},n.prototype.lockSelectionBroadcast=function(e){this._lockCSONotification=e},n.prototype.setLoadingDelegations=function(e){if("object"!=typeof e)throw new Error("Wrong parameter for setLoadingDelegations");this._loadingDelegations=e},n.prototype.setAuthorizedRootTypes=function(t){const i=[],n=e.getSetting("supported_root_types");for(let e=0;e<t.length;++e)n.indexOf(t[e])>-1&&i.push(t[e]);e.setSetting("authorized_root_types",i)},n.prototype.setDefaultStreamToLoad=function(t){e.setSetting("enopad3dviewer_CGRorTHB",t),this.getController()._setDefaultStreamToLoad(t)},n.prototype.setRobotVisibility=function(e){this._robotVisibility=e,this._viewer.getRobot&&this._viewer.getRobot()&&this._viewer.getRobot().setVisibility(e)},n.prototype.isRobotVisible=function(){return this._robotVisibility},n.prototype.isInterwidgetComAvailable=function(){return this._interwidgetComAvailability},n.prototype.isDefaultContextualBarVisible=function(){return this._defaultContextualBarVisibility},n.prototype.isOpenWithMenuAvailable=function(){return this._openWithMenuAvailability},n.prototype.isDefaultContextualMenuVisible=function(){return this._defaultContextualMenuVisibility},n.prototype.isSelectiveLoadingActivated=function(){return e.getSetting("enopad3dviewer_dynamicRepLoading")||e.getSetting("enopad3dviewer_lightNodeModel")},n.prototype.checkIfEmpty=function(){return this.getController().checkIfEmpty()},n.prototype._areValidPaths=function(e){if(e)for(let t=0;t<e.length;++t)if(!i.isAModelPath(e[t].pathElement))return!1;return!0},n})),define("DS/ENO3DView/mixins/ENO3DViewEventManager",["i18n!DS/ENOPAD3DViewer/assets/nls/PAD3DViewer.json","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/ENOPAD3DViewer/utils/PAD3DViewerVisuServices","DS/PADServices/utils/PADTrackerManager","DS/PADUtils/PADPromise","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADCommandProxy","DS/PADUtils/PADSettingsMgt","DS/PADUtils/views/PADProgressBar","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/Selection/PSOManager","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/Utilities/Utils","DS/Visualization/WorldOrientation","DS/Visualization/SceneGraphUtils","DS/ENOXInterWdgCom/LinkManager","DS/CoreEvents/Events","DS/i3DXCompassServices/i3DXCompassPubSub","DS/PADServices/utils/GlobalUtils","i18n!DS/PADServices/assets/nls/PADServices"],(function(e,t,i,n,o,s,a,r,l,h,d,c,p,u,m,g,_,f,C,v,D,b){"use strict";function w(){}return w.prototype._registerControllerEvents=function(){this._controllerTokens.push(this._controller.subscribe({event:"onRootAdded"},this._onRootAddedCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onRootRemoved"},this._onRootRemovedCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onRootAttached"},this._onRootAttachedCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onRootDetached"},this._onRootDetachedCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onRootUpdateStart"},this._onRootUpdateStartCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onRootUpdateEnd"},this._onRootUpdateEndCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onContentNameModified"},this._onContentNameModifiedCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onFilterApplied"},this._onFilterAppliedCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onFilterWithAuthoring"},this._onFilterWithAuthoringCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onRetrieveFilterFailure"},this._onRetrieveFilterFailureCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onTaggerSelectWithAuthoring"},this._onTaggerSelectWithAuthoringCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onStaticMappingApplied"},this._onStaticMappingAppliedCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onFlexibleAssemblyApplied"},this._onFlexibleAssemblyAppliedCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onSearchCompleted"},this._onSearchCompletedCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onSearchFailure"},this._onSearchFailureCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onSearchTooManyPath"},this._onSearchTooManyPathCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onBeginRootRemoved"},this._onBeginRootRemovedCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onBeginReplaceInstance"},this._onBeginReplaceInstanceCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onEndReplaceInstance"},this._onEndReplaceInstanceCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onEndMatriceUpdate"},this._onEndMatriceUpdateCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onUnsupportedType"},this._onUnsupportedTypeCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onBeginRootLoading"},this._onBeginRootLoadingCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onProgress"},this._onProgressCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onBeginFilterApplied"},this._onBeginFilterAppliedCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onReframe"},this._onReframeCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"rootStatsRetrieved"},this._onRootStatsRetrievedCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onRootAlreadyExisting"},this._onRootAlreadyExistingCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onRootAdditionTransactionComplete"},this._onRootAdditionTransactionComplete.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onComplete"},this._onCompleteCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onLoadingFailure"},this._onLoadingFailureCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onLoadingCanceled"},this._onLoadingCanceledCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"startAsync"},this._startAsyncCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"stopAsync"},this._stopAsyncCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onMove"},this._onMoveCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onEndReparent"},this._onEndReparentCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onInstanceUpdated"},this._onInstanceUpdatedCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onAuthoringIgnored"},this._onAuthoringIgnoredCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onBeginReparent"},this._onBeginReparentCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onReparentFailure"},this._onReparentFailureCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onInsertExistingFailure"},this._onInsertExistingFailureCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onInsertExisting"},this._onInsertExistingCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onStreamSwitched"},this._onStreamSwitchedCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onStreamSwitchFailure"},this._onStreamSwitchFailureCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onGeometryRefreshed"},this._onGeometryRefreshedCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onRefreshGeometryFailure"},this._onRefreshGeometryFailureCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onEndDelete"},this._onEndDeleteCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onCompletionCompleted"},this._onCompletionCompletedCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onBeginDelete"},this._onBeginDeleteCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onDefaultStreamChanged"},this._onDefaultStreamChangedCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onIndexAvalabilityChange"},this._onIndexAvalabilityChangeCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onEndRootRemoved"},this._onEndRootRemovedCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onRefreshCompleted"},this._onRefreshCompletedCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onRefreshBegin"},this._onRefreshBeginCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onSetReadOnlyRootSelection"},this._onSetReadOnlyRootSelectionCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onGetReadOnlyRoots"},this._onGetReadOnlyRootsCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onAuthoringSwitch"},this._onAuthoringSwitchCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onColorizeInAuthoring"},this._onColorizeInAuthoring.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onAuthoringTransactionBegin"},this._onAuthoringTransactionBeginCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onAuthoringTransactionEnd"},this._onAuthoringTransactionEndCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onExpandCompleted"},this._onExpandCompletedCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onDisableUX"},this._onDisableUXCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onEnableUX"},this._onEnableUXCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onDisableActionBar"},this._onDisableActionBarCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"PGPPostProcess"},this._PGPPostProcessCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onParsingInterruptedMemoryFull"},this._onParsingInterruptedMemoryFullCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onRepresentationLoaded"},this._onRepresentationLoadedCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onStartProgressiveLoad"},this._onStartProgressiveLoadCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onEndProgressiveLoad"},this._onEndProgressiveLoadCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onBeginFilterRemoved"},this._onBeginFilterRemovedCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onFilterRemoved"},this._onFilterRemovedCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onBIColorize"},this._onBIColorizeCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onBIUnColorize"},this._onBIUnColorizeCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"on3DLeafColorize"},this._on3DLeafColorizeCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"on3DLeafUnColorize"},this._on3DLeafUnColorizeCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onTreeColorize"},this._onTreeColorizeCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onTreeUnColorize"},this._onTreeUnColorizeCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onUrlLoaded"},this._onUrlLoadedCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onVQDisabled"},this._onVQDisabledCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onLeafReferenceLoaded"},this._onLeafReferenceLoadedCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onLeafReferenceUnloaded"},this._onLeafReferenceUnloadedCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onR2VLoaded"},this._onR2VLoadedCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onRealAssetLoaded"},this._onRealAssetLoadedCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onSOIDropped"},this._onSOIDroppedCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onIFCDropped"},this._onIFCDroppedCB.bind(this))),this._controllerTokens.push(this._controller.subscribe({event:"onCycleDetected"},this._onCycleDetected.bind(this)))},w.prototype.displayGenericWSFailureNotif=function(){D.getLastDataIndexTime().then((e=>{this.displayNotification({msg:t.replace(t.genericWSFailure.msg,{lastIndexed:e}),subtitle:t.genericWSFailure.subtitle,eventID:"error"})})).catch((e=>{this.displayNotification({msg:t.replace(t.genericWSFailure.msg,{lastIndexed:e}),subtitle:t.genericWSFailure.subtitle,eventID:"error"})}))},w.prototype._onRootAddedCB=function(i){this._DEBUG&&console.log("ENO3DViewEventManager._onRootAddedCB called",i),this._viewer.render({updateInfinitePlane:!0}),this.getRoots().length+this.getController().getHiddenRootIds().length===1&&(1===i.orientation?this._viewer.setWorldOrientation(g.YUpXRight):this._viewer.setWorldOrientation(g.ZUpYRight)),this._dropZoneContainer&&this._dropZoneContainer.hide(),i.reframe&&this.reframe(i.BS),i.displayNotif&&(i.hidden?this.displayNotification({eventID:"info",msg:e.addonDetachedRootSuccessNotif}):this.displayNotification({eventID:"success",msg:i.inContext?e.addRootInContextSuccessNotif:e.addRootSuccessNotif})),this._controller._isAuthored()&&this._controller.dropBehavior&&"FILTER"===this._controller.dropBehavior&&this.options.dndLA&&(this._enableUX(),this.displayNotification({msg:t.filterInAuthoring,eventID:"warning"}),delete this._controller.dropBehavior),!0===this._controller._wait4Filter&&(this._filterRootIds=[i.id],this._filterPanelOpen=!0),this._addRootUpdateCommands(),this.publish({event:"onRootAdded",data:i}),this.getRoots().length&&this._setInternalAutomaticReframePolicy(!1)},w.prototype._onRootRemovedCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onRootRemovedCB called",e),this.getController().getNbRoots()||this.getController().getHiddenRootIds().length||!this._dropZoneContainer||(this._dropZoneContainer.show("drop"),this.getStatusBar()&&(this.getStatusBar().resetPreviousLabel(),this.getStatusBar().setLoader({status:"off"}))),this._viewer.render({updateInfinitePlane:!0}),e.reframe,this._removeRootUpdateCommands(),this.publish({event:"onRootRemoved",data:e}),!1===e.dispatch&&this.lockSelectionBroadcast(!1)},w.prototype._onRootAttachedCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onRootAttachedCB called",e),this._dropZoneContainer&&this._dropZoneContainer.hide(),this._viewer.render({updateInfinitePlane:!0}),this.publish({event:"onRootAttached",data:e})},w.prototype._onRootDetachedCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onRootDetachedCB called",e),this._viewer.render({updateInfinitePlane:!0}),this.publish({event:"onRootDetached",data:e})},w.prototype._onRootUpdateStartCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onRootUpdateStartCB called",e),this.publish({event:"onRootUpdateStart",data:e})},w.prototype._onRootUpdateEndCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onRootUpdateEndCB called",e),this.publish({event:"onRootUpdateEnd",data:e})},w.prototype._onContentNameModifiedCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onContentNameModifiedCB called",e),this.publish({event:"onContentNameModified",data:e.TitleInfo})},w.prototype._onFilterAppliedCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onFilterAppliedCB called",e),this.getController().getAttributes({ids:e.filter.objects[0].path,attributes:["ds6w:label"],callbacks:{onComplete:t=>{this.getStatusBar()&&this.getStatusBar().setFilter({id:e.filter.objects[0].path[0],message:t[e.filter.objects[0].path[0]]["ds6w:label"]})},onFailure:e=>{console.warn(`Failed to apply filter : ${e}`)}}}),this.publish({event:"onFilterApplied",data:e})},w.prototype._onFilterWithAuthoringCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onFilterWithAuthoringCB called",e),this.displayNotification({msg:t.dropFilteredRootAuth,eventID:"warning"})},w.prototype._onRetrieveFilterFailureCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onRetrieveFilterFailureCB called",e);for(let t=0;t<e.failure.length;++t)this.displayNotification({msg:e.failure[t].msg,eventID:e.failure[t].eventID});this.checkIfEmpty()?(this._dropZoneContainer&&this._dropZoneContainer.show("drop"),this.publish({event:"onEmptyView",data:e})):this._dropZoneContainer&&this._dropZoneContainer.hide()},w.prototype._onTaggerSelectWithAuthoringCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onTaggerSelectWithAuthoringCB called",e),this.displayNotification({msg:t.taggerSelectAuth,eventID:"warning"})},w.prototype._onStaticMappingAppliedCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onStaticMappingAppliedCB called",e),this.publish({event:"onStaticMappingApplied",data:e})},w.prototype._onFlexibleAssemblyAppliedCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onFlexibleAssemblyAppliedCB called",e),this.publish({event:"onFlexibleAssemblyApplied",data:e})},w.prototype._onSearchCompletedCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onSearchCompletedCB called",e),e.searchQuery?this._findInContext(e):e.findPaths?this._findPaths(e):e.taggerSelect&&this._taggerSelect(e),this.publish({event:"onSearchCompleted",data:e})},w.prototype._onSearchFailureCB=function(t){this._DEBUG&&console.log("ENO3DViewEventManager._onSearchFailureCB called",t),this.displayNotification({eventID:"error",msg:e.searchInContextFailed}),this.publish({event:"onSearchFailure",data:t})},w.prototype._onSearchTooManyPathCB=function(t){this._DEBUG&&console.log("ENO3DViewEventManager._onSearchTooManyPathCB called",t),this.displayNotification({eventID:"warning",msg:e.tooManyResultFoundV2.replace("{maxResult}",l.getSetting("enopad3dviewer_max_count_in_search"))})},w.prototype._onBeginRootRemovedCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onBeginRootRemovedCB called",e),!1===e.dispatch&&this.lockSelectionBroadcast(!0)},w.prototype._onBeginReplaceInstanceCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onBeginReplaceInstanceCB called",e),this.publish({event:"onBeginReplaceInstance",data:e})},w.prototype._onEndReplaceInstanceCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onEndReplaceInstanceCB called",e),this.publish({event:"onEndReplaceInstance",data:e}),this.publish({event:"onModelUpdated",data:e})},w.prototype._onEndMatriceUpdateCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onEndMatriceUpdateCB called",e),this._viewer.render({updateInfinitePlane:!0}),this.publish({event:"onEndMatriceUpdate",data:e}),this.publish({event:"onModelUpdated",data:{rootNodes:this.getRoots()}})},w.prototype._onUnsupportedTypeCB=function(e){if(this._DEBUG&&console.log("ENO3DViewEventManager._onUnsupportedTypeCB called",e),this.displayNotification({msg:t.replace(t.get("unsupported_type"),{type:data.displayType,name:data.displayName}),eventID:"warning"}),0===this.getRoots().length&&!this._checkHiddenRoots()){GlobalModelEvents.getModelEvents().publish({event:"ENXViews/WelcomePanel/activate"})}},w.prototype._onBeginRootLoadingCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onBeginRootLoadingCB called",e),this._lastReframeRequiered=0,this._dropZoneContainer&&this._dropZoneContainer.hide(),this.publish({event:"onBeginRootLoading",data:e})},w.prototype._onProgressCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onProgressCB called",e),this.getDefaultProgressBarVisibility()?(h.setText(e.message),e.progress%20==0&&e.progress!==this._lastReframeRequiered&&(this._lastReframeRequiered=e.progress,e.reframe||this._viewer.render({updateInfinitePlane:!0}))):this.publish({event:"onProgress",data:e})},w.prototype._onBeginFilterAppliedCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onBeginFilterAppliedCB called",e),this.publish({event:"onBeginFilterApplied",data:e})},w.prototype._onReframeCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onReframeCB called",e),window.ENOPADNoReframe||(e.BS&&this.getViewpoint().reframe(void 0,0,e.BS),e.rootBS||setTimeout((()=>{this.reframe()}),3e3))},w.prototype._onRootStatsRetrievedCB=function(t){this._DEBUG&&console.log("ENO3DViewEventManager._onRootStatsRetrievedCB called",t),!t||0!==t.size.flat&&0!==t.size.occ&&0!==t.size.leaf||this.displayNotification({eventID:"info",msg:e.statsRetrieved_emptyStructure}),this.publish({event:"rootStatsRetrieved",data:t})},w.prototype._onRootAlreadyExistingCB=function(i){this._DEBUG&&console.log("ENO3DViewEventManager._onRootAlreadyExistingCB called",i),this.displayNotification({eventID:"info",msg:e.rootAlreadyLoadedNotif}),this._controller._isAuthored()&&this._controller.dropBehavior&&"FILTER"===this._controller.dropBehavior&&this.options.dndLA&&(this._enableUX(),this.displayNotification({msg:t.filterInAuthoring,eventID:"warning"}),delete this._controller.dropBehavior),this._dropZoneContainer&&this._dropZoneContainer.hide(),this.publish({event:"onRootAlreadyExisting",data:i})},w.prototype._onRootAdditionTransactionComplete=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onRootAdditionTransactionComplete called",e),this.publish({event:"onRootAdditionTransactionComplete",data:e})},w.prototype._onCompleteCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onCompleteCB called",e),e.reframe&&this.reframe(e.BS),"addRoot"===e.intend&&this.publish({event:"onComplete",data:{intend:"addRoot"}}),this.publish({event:"onLoadingComplete",data:e}),!0===this.updatePager&&(this.updatePager=!1,this.publish({event:"onUpdatePager",data:this.pagerData}))},w.prototype._onLoadingFailureCB=function(i){if(this._DEBUG&&console.log("ENO3DViewEventManager._onLoadingFailureCB called",i),this._controller.getNbRoots()||this._checkHiddenRoots()||!this._dropZoneContainer||this._controller.isRunning()||this._dropZoneContainer.show("drop"),i.displayNotif){let n=e.addRootFailureNotif;const o="error";i&&i.message&&(n=i.message),i&&i.eventID&&(o=i.eventID),n===t.genericWSFailure.subtitle||n===t.generic_service_failure?this.displayGenericWSFailureNotif():this.displayNotification({eventID:o,msg:n})}this.publish({event:"onLoadingFailure",data:i})},w.prototype._onLoadingCanceledCB=function(t){this._DEBUG&&console.log("ENO3DViewEventManager._onLoadingCanceledCB called",t),this._controller.getNbRoots()||this._checkHiddenRoots()||!this._dropZoneContainer||this._dropZoneContainer.show("drop");let i=e.addRootFailureNotif;t&&t.message&&(i=t.message),this.displayNotification({eventID:"info",msg:i}),this.publish({event:"onLoadingCanceled",data:t})},w.prototype._startAsyncCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._startAsyncCB called",e);(void 0===e||void 0===e.userFeedback||e.userFeedback)&&this.getDefaultProgressBarVisibility()?(h.on(void 0,e.onCancel,t.PADProgressBar_cancelAll),this.getStatusBar()&&this.getStatusBar().setLoader({status:"hide"})):this.publish({event:"onStartAsync",data:e})},w.prototype._stopAsyncCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._stopAsyncCB called",e);(void 0===e||void 0===e.userFeedback||e.userFeedback)&&this.getDefaultProgressBarVisibility()?(h.off(),this.getStatusBar()&&this.getStatusBar().setLoader({status:"show"})):this.publish({event:"onStopAsync",data:e})},w.prototype._onMoveCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onMoveCB called",e),this.publish({event:"onMove",data:e})},w.prototype._onEndReparentCB=function(t){if(this._DEBUG&&console.log("ENO3DViewEventManager._onEndReparentCB called",t),t.createdNode){const e=this.getController().getRootBag(),i=_.buildPathesLeadingToNode(t.createdNode,e),n=[];for(let e=0;e<i.length;++e)n.push({pathElement:i[e]});this.lockSelectionBroadcast(!0),l.getSetting("selectOnInsertDisabled")||(d.add(n),c.add(n)),this.lockSelectionBroadcast(!1)}this._viewer.render({updateInfinitePlane:!0}),this.displayNotification({eventID:"success",msg:e.reparentSuccessful}),this.publish({event:"onEndReparent",data:t}),this.publish({event:"onModelUpdated",data:t})},w.prototype._onInstanceUpdatedCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onInstanceUpdatedCB called",e),this.publish({event:"onInstanceUpdated",data:e}),this.publish({event:"onModelUpdated",data:e})},w.prototype._onAuthoringIgnoredCB=function(t){this._DEBUG&&console.log("ENO3DViewEventManager._onAuthoringIgnoredCB called",t),this.displayNotification({eventID:"info",msg:e[t.reason]})},w.prototype._onBeginReparentCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onBeginReparentCB called",e),this.publish({event:"onBeginReparent",data:e})},w.prototype._onReparentFailureCB=function(i){this._DEBUG&&console.log("ENO3DViewEventManager._onReparentFailureCB called",i);let n=e.reparentFailure;i&&i.message&&(n=i.message),n===t.genericWSFailure.subtitle||n===t.generic_service_failure?this.displayGenericWSFailureNotif():this.displayNotification({eventID:"error",msg:n}),this.publish({event:"onReparentFailure",data:i})},w.prototype._onInsertExistingFailureCB=function(i){this._DEBUG&&console.log("ENO3DViewEventManager._onInsertExistingFailureCB called",i);let n=e.insertFailure;i&&i.message&&(n=i.message),n===t.genericWSFailure.subtitle||n===t.generic_service_failure?this.displayGenericWSFailureNotif():this.displayNotification({eventID:"error",msg:n}),this.publish({event:"onInsertExistingFailure",data:i})},w.prototype._onInsertExistingCB=function(t){if(this._DEBUG&&console.log("ENO3DViewEventManager._onInsertExistingCB called",t),t.createdNode&&t.insertedNode){const e=this.getController().getRootBag(),i=_.buildPathesLeadingToNode(t.createdNode,e),n=[];for(let e=0;e<i.length;++e)i[e].addElement(t.insertedNode),n.push({pathElement:i[e]});l.getSetting("selectOnInsertDisabled")||(d.add(n),c.add(n))}this._viewer.render({updateInfinitePlane:!0}),this.displayNotification({eventID:"success",msg:e.insertSuccessful}),this.publish({event:"onInsertExisting",data:t}),this.publish({event:"onModelUpdated",data:t})},w.prototype._onStreamSwitchedCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onStreamSwitchedCB called",e),this.publish({event:"onStreamSwitched",data:e}),this.publish({event:"onModelUpdated",data:{rootNodes:this.getRoots()}})},w.prototype._onStreamSwitchFailureCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onStreamSwitchFailureCB called",e),this.publish({event:"onStreamSwitchFailure",data:e})},w.prototype._onGeometryRefreshedCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onGeometryRefreshedCB called",e),this.publish({event:"onGeometryRefreshed",data:e}),this.publish({event:"onModelUpdated",data:{rootNodes:this.getRoots()}})},w.prototype._onRefreshGeometryFailureCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onRefreshGeometryFailureCB called",e),this.publish({event:"onRefreshGeometryFailure",data:e})},w.prototype._onEndDeleteCB=function(t){this._DEBUG&&console.log("ENO3DViewEventManager._onEndDeleteCB called",t),this._viewer.render({updateInfinitePlane:!0}),this.displayNotification({eventID:"success",msg:e.deleteSuccessful}),this.publish({event:"onEndDelete",data:t}),this.publish({event:"onModelUpdated",data:t}),this.lockSelectionBroadcast(!1)},w.prototype._onCompletionCompletedCB=function(t){this._DEBUG&&console.log("ENO3DViewEventManager._onCompletionCompletedCB called",t),this._viewer.render({updateInfinitePlane:!0}),this.displayNotification({eventID:"info",msg:t.nbPathLoaded+e.completionCompleted}),this.publish({event:"onCompletionCompleted",data:t}),this.publish({event:"onModelUpdated",data:t})},w.prototype._onBeginDeleteCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onBeginDeleteCB called",e),this.lockSelectionBroadcast(!0),this.publish({event:"onBeginDelete",data:e})},w.prototype._onDefaultStreamChangedCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onDefaultStreamChangedCB called",e),this.publish({event:"onDefaultStreamChanged",data:e})},w.prototype._onIndexAvalabilityChangeCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onIndexAvalabilityChangeCB called",e),this.publish({event:"onIndexAvalabilityChange",data:e})},w.prototype._onEndRootRemovedCB=function(e){if(this._DEBUG&&console.log("ENO3DViewEventManager._onEndRootRemovedCB called",e),this.publish({event:"onEndRootRemoved",data:e}),0===this.getRoots().length&&this._applicativeAutomaticReframePolicy&&this._setInternalAutomaticReframePolicy(!0),this.getStatusBar()){const e=this.getController().getRoots();let t=!1;for(let i=0;i<e.length;++i)if(this.getController().getBIProxy().HasFilter(e[i].getModelIdentification())){t=!0;break}!1===t&&this.getStatusBar().clearFilter()}},w.prototype._onRefreshCompletedCB=function(t){this._DEBUG&&console.log("ENO3DViewEventManager._onRefreshCompletedCB called",t),this._controller.getNbRoots()||this._checkHiddenRoots()||!this._dropZoneContainer||this._dropZoneContainer.show("drop"),this.displayNotification({eventID:"info",msg:e.refreshCompleted}),this.publish({event:"onRefreshCompleted",data:t})},w.prototype._onRefreshBeginCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onRefreshBeginCB called",e),this.publish({event:"onRefreshBegin",data:e})},w.prototype._onSetReadOnlyRootSelectionCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onSetReadOnlyRootSelection called",e),this.publish({event:"onSetReadOnlyRootSelection",data:e.state})},w.prototype._onGetReadOnlyRootsCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onGetReadOnlyRootsCB called",e),this.publish({event:"onGetReadOnlyRoots",data:e.readOnlyRootIds})},w.prototype._onAuthoringSwitchCB=function(t){if(this._DEBUG&&console.log("ENO3DViewEventManager._onAuthoringSwitchCB called",t),t.message&&""!==t.message&&this.displayNotification({eventID:"info",msg:t.message}),this.getController().refreshAppliedFilters(),!0===t.state){const t=this.getController().getRoots();let o=!1;for(let e=0;e<t.length;++e){var n=i.getNodeID(t[e]);this.getController().isLargeDataStructure(n)&&(o=!0,this.getController().freezeRoot(n))}o&&this.displayNotification({eventID:"warning",msg:e.sessionFrozenFollowingAuthoringOperation})}this.publish({event:"onAuthoringSwitch",data:t})},w.prototype._onColorizeInAuthoring=function(t){this._DEBUG&&console.log("ENO3DViewEventManager._onColorizeInAuthoring called",t),this.displayNotification({msg:e.colorizeInAuthoring,eventID:"warning"})},w.prototype._onAuthoringTransactionBeginCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onAuthoringTransactionBeginCB called",e),d.empty(),c.empty(),this.publish({event:"onAuthoringTransactionBegin",data:e})},w.prototype._onAuthoringTransactionEndCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onAuthoringTransactionEndCB called",e),this.publish({event:"onAuthoringTransactionEnd",data:e})},w.prototype._onExpandCompletedCB=function(t){this._DEBUG&&console.log("ENO3DViewEventManager._onExpandCompletedCB called",t),t.displayNotif&&this.displayNotification({eventID:"info",msg:e.expandCompleted}),this.publish({event:"onExpandCompleted",data:t}),this.publish({event:"onModelUpdated",data:t})},w.prototype._onDisableUXCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onDisableUXCB called",e),this._disableUX()},w.prototype._onEnableUXCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onEnableUXCB called",e),this._enableUX()},w.prototype._onDisableActionBarCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onDisableActionBarCB called",e)},w.prototype._PGPPostProcessCB=function(e){if(this._DEBUG&&console.log("ENO3DViewEventManager._PGPPostProcessCB called",e),e.hiddenPaths&&e.hiddenPaths.length){const i=[];for(let n=0;n<e.hiddenPaths.length;++n){var t=this.unstreamPath(e.hiddenPaths[n]);t&&(Array.isArray(t)?i.concat(t):i.push(t))}this.getHideShowController().hide({paths:i,dispatch:!1})}(e.references&&e.references.length||e.instances&&e.instances.length||e.occurrences&&e.occurrences.length)&&this.getHideShowController().applyPGP(e)},w.prototype._onParsingInterruptedMemoryFullCB=function(t){this._DEBUG&&console.log("ENO3DViewEventManager._onParsingInterruptedMemoryFullCB called",t),this.displayNotification({eventID:"warning",title:e.parsingInterruptedMemoryFull.title,subtitle:e.parsingInterruptedMemoryFull.subtitle,msg:e.parsingInterruptedMemoryFull.message}),this.publish({event:"onParsingInterruptedMemoryFull",data:t})},w.prototype._onRepresentationLoadedCB=function(e){this.publish({event:"onRepresentationLoaded",data:e})},w.prototype._onStartProgressiveLoadCB=function(t){this._DEBUG&&console.log("ENO3DViewEventManager._onStartProgressiveLoadCB called",t),this.getStatusBar()&&(this.getStatusBar().setLoader({status:"on"}),this.getStatusBar().setProgressTooltip(e.PADStatus_loadingData),this.getStatusBar().clearWarning()),this.publish({event:"onStartProgressiveLoad",data:t})},w.prototype._onEndProgressiveLoadCB=function(t){this._DEBUG&&console.log("ENO3DViewEventManager._onEndProgressiveLoadCB called",t),this.getStatusBar()&&(this.getStatusBar().setLoader({status:"off"}),!0===t.memoryFull&&this.getStatusBar().setCustomProgressLabel({label:e.PADStatus_loadingStopped,tooltip:e.progressiveExpandFullMemory,severity:"warning"})),this.publish({event:"onEndProgressiveLoad",data:t})},w.prototype._onBeginFilterRemovedCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onBeginFilterRemovedCB called",e),this.publish({event:"onBeginFilterRemoved",data:e})},w.prototype._onFilterRemovedCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onFilterRemovedCB called",e),this._filteredIdToReload.push(e.id),this.getStatusBar()&&this.getStatusBar().clearFilter({id:e.id}),this.publish({event:"onFilterRemoved",data:e})},w.prototype._onBIColorizeCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onBIColorizeCB called",e),this.publish({event:"onBIColorize",data:e})},w.prototype._onBIUnColorizeCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onBIUnColorizeCB called",e),this.publish({event:"onBIUnColorize",data:e})},w.prototype._on3DLeafColorizeCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._on3DLeafColorizeCB called",e),this.publish({event:"on3DLeafColorize",data:e})},w.prototype._on3DLeafUnColorizeCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._on3DLeafUnColorizeCB called",e),this.publish({event:"on3DLeafUnColorize",data:e})},w.prototype._onTreeColorizeCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onTreeColorizeCB called",e),this.publish({event:"onTreeColorize",data:e})},w.prototype._onTreeUnColorizeCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onTreeUnColorizeCB called",e),this.publish({event:"onTreeUnColorize",data:e})},w.prototype._onUrlLoadedCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onUrlLoadedCB called",e),this.publish({event:"onUrlLoaded",data:{nbCgrLoaded:e.nbCgrLoaded,nbThbLoaded:e.nbThbLoaded}})},w.prototype._onVQDisabledCB=function(t){this._DEBUG&&console.log("ENO3DViewEventManager._onVQDisabledCB called",t),this.displayNotification({eventID:"warning",msg:e.queryFailed_VQDisabled})},w.prototype._onLeafReferenceLoadedCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onLeafReferenceLoadedCB called",e),this.publish({event:"onLeafReferenceLoaded",data:e})},w.prototype._onLeafReferenceUnloadedCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onLeafReferenceUnloadedCB called",e),this.publish({event:"onLeafReferenceUnloaded",data:e})},w.prototype._registerViewEvents=function(){this.subscribe({event:"onFilterDropped"},this._onFilterDroppedCB.bind(this))},w.prototype._onFilterDroppedCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onFilterDroppedCB called",e),this.clearWidgetBorder()},w.prototype._registerHideShowEvents=function(){this._hideShowControllerTokens.push(this._hideShowController.subscribe({event:"onHide"},this._onHideCB.bind(this))),this._hideShowControllerTokens.push(this._hideShowController.subscribe({event:"onShow"},this._onShowCB.bind(this))),this._hideShowControllerTokens.push(this._hideShowController.subscribe({event:"onExclusiveShow"},this._onExclusiveShowCB.bind(this)))},w.prototype._onHideCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onHideCB called",e),this.publish({event:"onHide",data:e})},w.prototype._onShowCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onShowCB called",e),this.publish({event:"onShow",data:e})},w.prototype._onExclusiveShowCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onExclusiveShowCB called",e),this.publish({event:"onExclusiveShow",data:e})},w.prototype._registerDnDEvents=function(){this._dndTokens[0]=this._DnDDragOverCB.bind(this),this._dndTokens[1]=this._DnDDragEndCB.bind(this),this._dndTokens[2]=this._DnDDropCB.bind(this),this._dndTokens[3]=this._DnDDragEnterCB.bind(this),this._dndTokens[4]=this._DnDDragLeaveCB.bind(this),this.elements.container.addEventListener("dragenter",this._DnDDragEnterCB.bind(this)),this.elements.container.addEventListener("dragover",this._DnDDragOverCB.bind(this)),this.elements.container.addEventListener("dragleave",this._DnDDragLeaveCB.bind(this)),this.elements.container.addEventListener("dragend",this._DnDDragEndCB.bind(this)),this.elements.container.addEventListener("drop",this._DnDDropCB.bind(this)),this._isMouseOver=!1,this.elements.container.addEventListener("mouseenter",(()=>{this._isMouseOver=!0})),this.elements.container.addEventListener("mouseleave",(()=>{this._isMouseOver=!1})),this.elements.container.addEventListener("mouseover",(()=>{this._isMouseOver=!0}))},w.prototype._unregisterDnDEvents=function(){if(d)for(let e=0;e<this._csoTokens.length;++e)d.unsubscribe(this._csoTokens[e]);if(p)for(let e=0;e<this._psoTokens.length;++e)p.unsubscribe(this._psoTokens[e]);if(c)for(let e=0;e<this._hsoTokens.length;++e)c.unsubscribe(this._hsoTokens[e])},w.prototype._DnDDragOverCB=function(e){if(e.preventDefault(),this.addWidgetBorder(),this.options.dndLA){let t=this._dropZoneContainer.processIfInside("empty",e,null);if(t.isInside)return t.returnValue}else e.shiftKey?this._dropZoneContainer.show("add_as_object"):this._dropZoneContainer.show("add_in_context")},w.prototype._DnDDragEndCB=function(e){this.clearWidgetBorder(),0!==this.getRoots().length||this._checkHiddenRoots()?this._dropZoneContainer.hide():this._dropZoneContainer.show("drop")},w.prototype._DnDDropCB=function(e){if(e.preventDefault(),e.stopPropagation(),this.getDOMElement("container").contains(e.target)){this._dropZoneContainer.hide();let t=!0;this.options.dndLA?(e.shiftKeyOverride&&(t=!1),this._dropZoneContainer.isEventInside(e)||e.shiftKey&&(t=!1)):e.shiftKey&&(t=!1),this.addRootNodesFromContent({dndEvent:e,dispatch:!0,inContext:t}),this.clearWidgetBorder()}},w.prototype._DnDDragEnterCB=function(e){e.preventDefault(),this.clearWidgetBorder(),e.shiftKey?this._dropZoneContainer.show("add_as_object"):this._dropZoneContainer.show("add_in_context")},w.prototype._DnDDragLeaveCB=function(e){if(null==e.relatedTarget||!e.relatedTarget.classList.contains("paddnd_invite_container")){if(this._dropZoneContainer.hide(),0===this.getRoots().length){let e;this.options.dndLA&&(e="drop"),this._dropZoneContainer.show(e)}this.clearWidgetBorder()}},w.prototype._getProxyEvents=function(){return{onSetCurrentViewpoint:this._onSetCurrentViewpointCB.bind(this),onSharedAlert:this._onSharedAlertCB.bind(this),onFilterWarn:this._onFilterWarnCB.bind(this),onFocusChange:this._onFocusChangeCB.bind(this),onChangeControlDlgOpen:this._onChangeControlDlgOpenCB.bind(this),onSelect:this._onSelectCB.bind(this),onReframeSelection:this._onReframeSelectionCB.bind(this),onFocus:this._onFocusCB.bind(this),onPadDestroy:this._onPadDestroyCB.bind(this),onRequestViewPoint:this._onRequestViewPointCB.bind(this)}},w.prototype._onSetCurrentViewpointCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onSetCurrentViewpointCB called",e),this._onSetCurrentViewpoint(e)},w.prototype._onSharedAlertCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onSharedAlertCB called",e);let t=s.getPromises().slice();s.createPromise(((i,n)=>{Promise.all(t).then((n=>{t=null,0!==this.getRoots().length||this._checkHiddenRoots()?this._dropZoneContainer.hide():this._dropZoneContainer.show("drop"),this.displayNotification(e),i()}))}),"SharedAlert")},w.prototype._onFilterWarnCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onFilterWarnCB called",e);let i=s.getPromises().slice();s.createPromise(((n,o)=>{Promise.all(i).then((o=>{i=null,0!==this.getRoots().length||this._checkHiddenRoots()?this._dropZoneContainer.hide():this._dropZoneContainer.show("drop");let s="";switch(e){case"inauthoring":s=t.filterInAuthoring;break;case"notactivated":s=t.filterNotActivated}this.displayNotification({eventID:"warning",msg:s}),n()}))}),"FilterWarn")},w.prototype._onFocusChangeCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onFocusChangeCB called",e),e.sharedID==a.getSharedId()&&this.publish({event:"onFocusChange",data:e})},w.prototype._onChangeControlDlgOpenCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onChangeControlDlgOpenCB called",e),"2D"===e.widget&&l.setSetting("changeControlDlgOpen",e.isOpen)},w.prototype._onSelectCB=function(e,t){this._DEBUG&&console.log("ENO3DViewEventManager._onSelectCB called");let i=s.getPromises().slice();s.createPromise(((n,o)=>{Promise.all(i).then((o=>{if(i=null,!0===e.focusOn&&e.sharedID&&e.sharedID!==a.getSharedId())return console.log("Call from another instance hence not selecting"),void n();this.lockSelectionBroadcast(!0);try{let i=[],n=!1;if(e.vdrpPaths&&e.vdrpPaths.length){for(let t=0;t<e.vdrpPaths.length;++t)if(e.vdrpPaths[t].BOMIdPath.length){const n=this.unstreamVDRPPath(e.vdrpPaths[t]);if(n)if(Array.isArray(n))for(let e=0;e<n.length;e++)n[e]&&i.push({pathElement:n[e]});else i.push({pathElement:n})}n=i.length!==e.vdrpPaths.length}else if(e.paths){let t=[];if("2"===e.version)for(let i=0;i<e.paths.length;++i){const n=[];for(let t=0;t<e.paths[i].length;++t)n.push(e.paths[i][t].resourceid);t.push(n)}else t=e.paths;for(let e=0;e<t.length;++e)if(t[e].length){const n=this.unstreamPath(t[e]);if(n)if(Array.isArray(n))for(let e=0;e<n.length;e++)n[e]&&i.push({pathElement:n[e]});else i.push({pathElement:n})}n=i.length!==e.paths.length}if(e.POIGroups&&e.POIGroups.length>0&&!e.fromPanel){const t=this.getController().unstreamPOIGroup(e.POIGroups[0]);if(t.length>0)for(let e=0;e<t.length;++e)i.push({pathElement:t[e]})}else if(e.POIs&&!e.fromPanel)for(let t=0;t<e.POIs.length;++t){const n=this.getController().unstreamPOI4Select(e.POIs[t]);if(n.length>0)for(let e=0;e<n.length;++e)i.push({pathElement:n[e]})}else e.ZOIs&&(i=this.getController().unstreamZOIs(e.ZOIs));if(e.referenceIds){const t=this.getController().getRootBag();let n=[];for(let o=0;o<e.referenceIds.length;++o){const s=this.getController().getNode({id:e.referenceIds[o]});s&&(n=_.buildPathesLeadingToNode(s,t));for(let e=0;e<n.length;++e)i.push({pathElement:n[e]})}}if(!0===e.exclusiveShow){const e=i.map((e=>e.pathElement));this._hideShowController.exclusiveShow({paths:e})}let o=f.getLinked()&&!0===l.getSetting("activateWidgetLink"),s=!!o&&f.getLinked().filter((e=>e.id===t.originWidgetId)).length>0;i.length&&!e.noClear?(d.empty(),c.empty(),d.add(i),c.add(i)):!(o&&s||!o&&t.appid===r.appId())||!0===e.focusOn||n||e.noClear||e.noClear||(d.empty(),c.empty())}finally{this.lockSelectionBroadcast(!1),n()}}))}),"select")},w.prototype._onReframeSelectionCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onReframeSelectionCB called",e),this.reframe()},w.prototype._onFocusCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onFocusCB called");let t=!1,i=!1,s=!1,a=!1,r=!1,l=0;e&&e.POIs&&(l=e.POIs.length,e.POIs.length&&(t=!0));let h=0;e&&e.ZOIs&&(h=e.ZOIs.length,e.ZOIs.length&&(i=!0));let p=0;e&&e.paths&&(p=e.paths.length,e.paths.length&&(s=!0));let u=0;e.POIGroups&&e.POIGroups.length&&(e.POIGroups.forEach((e=>{e&&(u+=e.POIs.length)})),a=!0);let m=0;var g;(e&&e.referenceIds&&(m=e.referenceIds.length,e.referenceIds.length&&(r=!0,m=e.referenceIds.length)),e&&"reframe"===e.intent)&&((g=o.getPADTracker({eventCategory:"usage",eventAction:"3d_reframeEvent_stats"})).persDim.pd2=t&&i||a&&i||r&&i||s&&i?"POI and ZOI":t?"POI":i?"ZOI":a?"POI Group":s?"Path":r?"ReferenceId":"error",g.persVal.pv2=l,g.persVal.pv3=h,g.persVal.pv4=u,g.persVal.pv5=p,g.persVal.pv6=m,g.trackPageEvent());e&&"focus"===e.intent&&((g=o.getPADTracker({eventCategory:"usage",eventAction:"3d_focusEvent_stats"})).persDim.pd2=t&&i||a&&i||r&&i||s&&i?"POI and ZOI":t?"POI":i?"ZOI":a?"POI Group":s?"Path":r?"ReferenceId":"error",g.persVal.pv2=l,g.persVal.pv3=h,g.persVal.pv4=u,g.persVal.pv5=p,g.persVal.pv6=m,g.trackPageEvent());let v=C.subscribe({event:"/VISU/"},(e=>{"@onViewpointBeginMove"===e.eventType&&(C.unsubscribe(v),f.unsubscribe("DS/ExternalWdgtCom/ViewPointSync"))})),D=C.subscribe({event:"/VISU/"},(e=>{"@onViewpointEndMove"===e.eventType&&(C.unsubscribe(D),f.subscribe("DS/ExternalWdgtCom/ViewPointSync",this._onViewPointSync.bind(this)))}));const b=e=>{for(var t=[],i=[],o=[],s=0;s<e.length;s++)if((t=this.getController().unstreamPOI(e[s])).length>0)for(var a=0;a<t.length;a++)i.push(t[a]);n.reframeOn({paths:i,viewpoint:this.getViewpoint(),context:this});for(s=0;s<e.length;s++)if((t=this.getController().unstreamPOI4Select(e[s])).length>0)for(a=0;a<t.length;a++)o.push({pathElement:t[a]});o.length&&(d.empty(),c.empty(),d.add(o),c.add(o))};if(e.paths||e.referenceIds||e.POIs||e.ZOIs)if("reframe"===e.intent){var w=[];if(e.paths)return e.paths.forEach((e=>{if(e.length){var t=this.unstreamPath(e);t&&(Array.isArray(t)?w.concat(t):w.push(t))}})),void n.reframeOn({paths:w,viewpoint:this.getViewpoint()});if(e.POIs&&e.POIs.length&&b(e.POIs),e.ZOIs&&e.ZOIs.length){var y=this.getController().unstreamZOIs(e.ZOIs);if(y.length){d.empty(),c.empty(),d.add(y),c.add(y);w=[];for(var S=0;S<y.length;S++)w.push(y[S].pathElement);n.reframeOn({paths:w,viewpoint:this.getViewpoint()})}}}else if(e.paths)this._executeCommand({handlerId:"ENO3DNavigateOnSelectionCmd",args:{paths:e.paths}});else if(e.referenceIds){for(var E=[],P=[],O=[],M=0;M<e.referenceIds.length;M++)this.getController().getNode({id:e.referenceIds[M]})?P=P.concat(_.buildPathesLeadingToNode(this.getController().getNode({id:e.referenceIds[M]}),this.getController().getRootBag())):O.push(e.referenceIds[M]);if(O.length)Promise.all(this.getController()._loadPOI(O)).then((e=>{for(var t=0;t<e.length;t++)e[t]&&(E=E.concat(e[t]));for(var i=0;i<P.length;i++)E.push(this.streamPath(P[i]));this._executeCommand({handlerId:"ENO3DNavigateOnSelectionCmd",args:{paths:E}})}));else{for(var V=0;V<P.length;V++)E.push(this.streamPath(P[V]));this._executeCommand({handlerId:"ENO3DNavigateOnSelectionCmd",args:{paths:E}})}}else if(e.POIs&&e.POIs.length){var B=!1;e&&!0===e.displayPOITooltip&&(B=!0),this._executeCommand({handlerId:"ENO3DNavigateOnSelectionCmd",args:{paths:e.POIs,kind:"POIs",focusTooltip:B}})}else e.ZOIs&&e.ZOIs.length&&this._executeCommand({handlerId:"ENO3DNavigateOnSelectionCmd",args:{paths:e.ZOIs,kind:"ZOIs"}});else console.error("No path to focus on or call from another 3D widget reference")},w.prototype._onPadDestroyCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onPadDestroyCB called",e),this.publish({event:"onWidgetDestroyed",data:e})},w.prototype._onRequestViewPointCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onRequestViewPointCB called",e);const t=this.getViewpoint(),i=n.buildViewPoint(t);this._commandProxy.updateViewPoint(i)},w.prototype._registerCSOEvents=function(){this._CSOAddCB=this._CSOAddCB.bind(this),this._CSOChangeCB=this._CSOChangeCB.bind(this),this._CSOPreEmptyCB=this._CSOPreEmptyCB.bind(this),this._CSOEmptyCB=this._CSOEmptyCB.bind(this),this._CSOCheckPathCB=this._CSOCheckPathCB.bind(this),d.onPostAdd&&this._csoTokens.push(d.onPostAdd(this._CSOAddCB)),this.isSelectiveLoadingActivated()&&d.onChange&&this._csoTokens.push(d.onChange(m.debounce(this._CSOChangeCB))),d.onPostRemove?this._csoTokens.push(d.onPostRemove(this._CSOAddCB)):this._csoTokens.push(d.onRemove(m.debounce(this._CSOAddCB,100))),this._csoTokens.push(d.onPreEmpty(this._CSOPreEmptyCB)),this._csoTokens.push(d.onEmpty(this._CSOEmptyCB)),this._viewer.onPreAddRemoveXSO?this._viewer.onPreAddRemoveXSO(this._CSOCheckPathCB.bind(this)):(this._psoTokens.push(p.onPreAdd(this._CSOCheckPathCB)),this._csoTokens.push(d.onPreAdd(this._CSOCheckPathCB)),this._hsoTokens.push(c.onPreAdd(this._CSOCheckPathCB)))},w.prototype._CSOAddCB=function(){if(!this._lockCSONotification&&!this._lockCSONotificationEmpty){var e=[],t=[],n=[],s=[],r=[],h=[],c={},p=[],u=d.get(),m=null,g={version:"1.1",paths:e,vdrpPaths:t,i3dxIds:n,POIs:s,POIGroups:r,ZOIs:h,attributes:c,sharedID:a.getSharedId(),focusOn:this._reframeFocus};u.forEach(function(o){i.isAModelPath(o.pathElement)&&this.streamPathWithType(o.pathElement,e,c,n,t),i.isAPOIPath(o.pathElement)&&(m=i.getPOILayerId(o.pathElement),this.streamPOI(o.pathElement,m,s)),i.isAPOIGroupPath(o.pathElement)&&this.streamPOIGroup(o.pathElement,r),i.isAZOIPath(o.pathElement)&&this.streamZOI(o.pathElement,h)}.bind(this));let P=!1,O=!1,M=!1;var _=0;d.get()&&(_=d.get().length);var f=0;s&&s.length&&(f=s.length,P=!0);var C=0;r&&r.length&&(r.forEach(function(e){e&&(C+=e.POIs.length)}.bind(this)),M=!0);var D=0;if(h&&h.length&&(D=h.length,O=!0),f>0||D>0||C>0){var b=o.getPADTracker({eventCategory:"usage",eventAction:"3d_selectEvent_stats"});b.setEventData({eventLabel:"outgoing_selection",eventValue:f+C+D}),b.persDim.pd2="Outgoing Selection",b.persDim.pd3=P&&O||M&&O?"POI and ZOI":P?"POI":O?"ZOI":M?"POI Group":"error",b.persVal.pv2=f+C,b.persVal.pv3=D,b.persVal.pv4=_,b.trackPageEvent()}if(l.getSetting("authorizeChangeControl")){var w=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext");g.changeControl=w.get()}var y=!!this._searchRecent&&this._searchRecent;if(!0===y&&(g.searchDone=y),this._commandProxy.select(g),!0===this._authorizeSet3DStructure)if(e&&e.forEach((function(e){p.push(e[e.length-1])})),this.set3DXContentData({nodes2Open:p,selectedPaths:g}),!0!==l.getSetting("settypes")){var S=this.set3DStructure4OpenInCV5({nodes2Open:p,selectedPaths:g}),E=JSON.stringify(S);v.publish("setStructure",{structure:E})}else this.setTypesFor3D(g)}},w.prototype._CSOChangeCB=function(){if(this.getStatusBar()){const e=d.get();let t=0;for(let i=0;i<e.length;++i)null!==e[i].pathElement&&++t;t?(this.getStatusBar().setSelection({length:t}),this.enableCmd("ActionBar_Attributes")):(this.getStatusBar().clearSelection(),this.disableCmd("ActionBar_Attributes"))}},w.prototype._CSOPreEmptyCB=function(){this._lockCSONotificationEmpty=!0},w.prototype._CSOEmptyCB=function(){this._lockCSONotificationEmpty=!1,this._lockCSONotification||this._commandProxy.select({paths:[],sharedID:a.getSharedId(),focusOn:this._reframeFocus})},w.prototype._CSOCheckPathCB=function(e){function t(e){if(e&&e.pathElement&&e.pathElement.externalPath.length&&i.isAModelPath(e.pathElement)){let t=e.pathElement,n=t.getLastElement(!0);for(;t&&!i.isReference(n)&&t.externalPath.length>2;)t=t.getParentPath(),t&&(n=t.getLastElement(!0));return e.pathElement=t,e}return e}if(!this._lockCSONotification&&"PRODUCT"===l.getSetting("enopad3dviewer_selectionFilter"))if(e instanceof Array){var n=0,o=e.length;for(n=0;n<o;n++)(e[n].event||this._viewer.onPreAddRemoveXSO)&&t.call(this,e[n])}else(e.event||this._viewer.onPreAddRemoveXSO)&&t.call(this,e)},w.prototype._onR2VLoadedCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onR2VLoadedCB called",e),this.publish({event:"onR2VLoaded",data:e})},w.prototype._onRealAssetLoadedCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onRealAssetLoadedCB called",e),this.publish({event:"onRealAssetLoaded",data:e})},w.prototype._onSOIDroppedCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onSOIDroppedCB called",e),this.publish({event:"onSOIDropped",data:e})},w.prototype._onIFCDroppedCB=function(e){this._DEBUG&&console.log("ENO3DViewEventManager._onIFCDroppedCB called",e),this.publish({event:"onIFCDropped",data:e});const t=b.replace(b.warnings.unsupported_type_v2,{type:"Internal IFC Object"});this.displayNotification({msg:t,eventID:"error"})},w.prototype._onCycleDetected=function(t){this._DEBUG&&console.log("ENO3DViewEventManager._onCycleDetected called",t),this.displayNotification({eventID:"error",title:e.cycleDetected.title,subtitle:e.cycleDetected.subtitle,msg:e.cycleDetected.message})},w})),define("DS/ENO3DView/views/ENO3DRoundPanel",["css!DS/ENO3DView/ENO3DView.css","css!DS/ENO3DView/assets/css/ENO3DMinimapGradientAnimation.css"],(function(e,t){"use strict";function i(e){this._width=e.width,this._height=e.height,this.elements={},this.elements.content=e.content,this._parent=e.immersiveFrame,this.elements.container=document.createElement("div"),this.elements.container.id=e.id,this.elements.container.classList.add("ENO3DRoundPanel"),this.elements.container.classList.add("ENO3DRoundPanel-visible"),this.elements.content&&this.elements.container.appendChild(this.elements.content),this._onMoveCB=e.onMove?e.onMove:()=>{},this._onResizeCB=e.onResize?e.onResize:()=>{},this._onVisibleStateChangeCB=e.onVisibleStateChange?e.onVisibleStateChange:()=>{}}return i.prototype.hide=function(){this._parent.contains(this.elements.container)&&this._parent.removeChild(this.elements.container)},i.prototype.show=function(){this._parent.contains(this.elements.container)||this._parent.appendChild(this.elements.container)},i.prototype.hide=function(){this._parent.contains(this.elements.container)&&this._parent.removeChild(this.elements.container)},i.prototype.onMove=function(){this._onMoveCB({})},i.prototype.onVisibleStateChange=function(){this._onVisibleStateChangeCB({})},i.prototype.hover=function(){this.elements.container&&this.elements.container.classList&&this.elements.container.classList.add("hover")},i.prototype.exit=function(){this.elements.container&&this.elements.container.classList&&this.elements.container.classList.remove("hover")},i})),define("DS/ENO3DView/controller/ENO3DPagerNavigationController",["UWA/Promise","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/PADUtils/PADSettingsMgt","DS/PADUtils/views/PADPager","DS/ENOPAD3DViewer/utils/PAD3DViewerVisuServices","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/Visualization/ThreeJS_DS","i18n!DS/ENOPAD3DViewer/assets/nls/PAD3DViewer.json","DS/ENOPAD3DViewer/utils/PAD3DPOIGroupingOptions"],(function(e,t,i,n,o,s,a,r,l,h){"use strict";function d(e){if(d.instance)return d.instance._idsPath=e.args.paths,d.instance._kind=e.args.kind,d.instance._focusTooltip=e.args.focusTooltip,this._viewer&&(this._viewer._focusTooltip=e.args.focusTooltip),d.instance.beginExecute(),d.instance;d.instance=this,this._CBTokens=[],this._view=null,this._selection=[],this._selectedIdx=null,this._previousCB=null,this._nextCB=null,this._closeCB=null,this._csoChangeCB=null,this._escapeCB=null,this._lockedNodes=[],this.useModelBoundingSphere=!1,this._idsPath=e.args.paths,this._kind=e.args.kind,this._focusTooltip=e.args.focusTooltip,this.ec=e.executionContext,this._viewer=this.ec.getComponent("Viewer"),this._viewer&&(this._viewer._focusTooltip=e.args.focusTooltip),this.beginExecute()}return d.prototype.destroy=function(){this._viewer._focusTooltip=!1,this._focusTooltip=!1},d.prototype.beginExecute=function(){this._viewer&&(this._viewer._focusTooltip=this._focusTooltip),this._CBTokens.push(this._viewer.subscribe({event:"onUpdatePager"},(e=>{this.updatePager(e)}))),this._CBTokens.push(this._viewer.subscribe({event:"onFocusChange"},(e=>{this.focusChange(e)}))),this._escapeCB=e=>{27===e.keyCode&&this.endExecute()},this.prepareCSOData(this._idsPath).then((e=>{document.addEventListener("keyup",this._escapeCB),this.useModelBoundingSphere=e,this._selectedIdx=0;var i;i=t.get().slice(),this._internalCSOChange=!1,"POIs"!==this._kind&&"ZOIs"!==this._kind||(this._selection=[]);for(var n=0;n<i.length;n++)null!==i[n].pathElement&&this._selection.push(i[n]);this._selection.length>1?(null===this._view&&(this._previousCB=function(){this.focusChange({operation:"previous"})}.bind(this),this._nextCB=function(){this.focusChange({operation:"next"})}.bind(this),this._reframeAllCB=function(){if(this._selection.length){const e=[];for(let t=0;t<this._selection.length;++t)this._selection[t].pathElement&&e.push(this._selection[t].pathElement);if("POIs"===this._kind||"ZOIs"===this._kind?s.reframeOn({paths:e,viewpoint:this._viewer.getViewpoint(),context:this._viewer}):s.reframeOnCandidates({paths:e,viewpoint:this._viewer.getViewpoint(),context:this._viewer}),"POIs"===this._kind&&!0===this._viewer._focusTooltip){this._viewer.getController()._createNode_and_Tooltip_and_pinTooltip_forFocRef(e,this._viewer.getController(),!0,!1,!0)}}}.bind(this),this._selectAllCB=function(){this.restoreSelection()}.bind(this),this._closeCB=function(){this.endExecute()}.bind(this),this._view=new o({renderTo:this._viewer.getDOMElement("container"),context:this._viewer,callbacks:{onPrevious:this._previousCB,onNext:this._nextCB,onSelectAll:this._selectAllCB,onReframeAll:this._reframeAllCB,onClose:this._closeCB}})),"POIs"===this._kind?this.reframeOnPOI():"ZOIs"===this._kind?this.reframeOnZOI():this.reframeOn(e),this._view.show(),this._csoChangeCB=t.onRemove(function(){this._internalCSOChange||this._viewer.getController()._updateClustersInProgress||this.endExecute()}.bind(this))):1===this._selection.length?("POIs"===this._kind?this.reframeOnPOI():"ZOIs"===this._kind?this.reframeOnZOI():this.reframeOn(e),this._csoChangeCB=t.onRemove(function(){this._internalCSOChange||this._viewer.getController()._updateClustersInProgress||this.endExecute()}.bind(this))):(console.log("CSO selection is empty"),this.endExecute()),require(["DS/PADServices/utils/PADTrackerManager","DS/PADUtils/PADUtilsServices"],function(e,t,i){var n=t.getPADTracker({eventCategory:"usage",eventAction:"command-3D"});n.setEventData({eventLabel:"PAD3DViewerNavigateOnSelectionCmd",eventValue:e?e.length:0}),n.trackPageEvent()}.bind(this,this._selection))}))},d.prototype.endExecute=function(e){this._viewer.getController().unlockNodes({ids:this._lockedNodes}),this._viewer.getController()&&this._viewer.getController()._clean_allTooltip_from_isFromFocusRefCmd(this._viewer.getController()),this._viewer._reframeFocus=!1,this._viewer._focusTooltip=!1,this._focusTooltip=!1,this._selection=[],this._selectedIdx=null,this._previousCB=null,this._nextCB=null,this._selectAllCB=null,this._reframeAllCB=null,this._closeCB=null,this._lockedNodes=[];for(let e=0;e<this._CBTokens.length;++e)this._viewer.unsubscribe(this._CBTokens[e]);this._csoChangeCB&&t.unsubscribe(this._csoChangeCB),this._escapeCB&&document.removeEventListener("keyup",this._escapeCB),e&&e.performingAgain||this._view&&this._view.visible&&this._view.hide()},d.prototype.prepareCSOData=function(n){return new e((e=>{const o=e=>{this._viewer.lockSelectionBroadcast(!0),this.originalSelection=e;let n=[];t.empty(),i.empty();const o=this._viewer.getController().getHiddenRootIds();if("POIs"===this._kind)for(let t=0;t<e.length;++t){const i=this._viewer.getController().unstreamPOI(e[t]);if(i&&i.length)for(let e=0;e<i.length;++e)n.push({pathElement:i[e]})}else if("ZOIs"===this._kind)n=this._viewer.getController().unstreamZOIs(e);else for(let t=0;t<e.length;++t)if(-1===o.indexOf(e[t][0])){const i=this._viewer.unstreamPath(e[t]);if(i)if(Array.isArray(i))for(let e=0;e<i.length;e++)i[e]&&n.push({pathElement:i[e]});else n.push({pathElement:i})}n.length&&(t.add(n),i.add(n)),this._viewer.lockSelectionBroadcast(!1)},s=[];if("POIs"!==this._kind&&"ZOIs"!==this._kind)for(let e=0;e<n.length;++e)null===this._viewer.unstreamPath(n[e])&&s.push(n[e]);0===s.length?(o(n),e(!0)):this._viewer.getController().expand({paths:s,withFrustumFilter:!1,expand_iter:"0",singleAdd:!1,onComplete:t=>{if("object"==typeof t){for(let e=0;e<n.length;++e)this._lockedNodes.push(n[e][n[e].length-1]);this._viewer.getController().lockNodes({ids:this._lockedNodes}),o(n),e(!0)}else console.error("Incorrect data type in expand onComplete()")}})}))},d.prototype.updatePager=function(e){const t=[];e.forEach((e=>{const i=this._viewer.unstreamPath(e);if(i)if(Array.isArray(i))for(let e=0;e<i.length;e++)i[e]&&t.push({pathElement:i[e]});else t.push({pathElement:i})})),this._selection=t,this._selectedIdx=0,"POIs"===this._kind?this.reframeOnPOI():"ZOIs"===this._kind?this.reframeOnZOI():this.reframeOn(this.useModelBoundingSphere)},d.prototype.focusChange=function(e){"POIs"===this._kind&&!0===this._viewer._focusTooltip&&(this._viewer.getViewer().render(),this._viewer.getController()._clean_allTooltip_from_isFromFocusRefCmd(this._viewer.getController())),this._selection&&this._selection.length>0&&("previous"==e.operation&&("POIs"===this._kind?(this._selectedIdx--,this.reframeOnPOI()):"ZOIs"===this._kind?(this._selectedIdx--,this.reframeOnZOI()):(this._selectedIdx--,this.reframeOn(this.useModelBoundingSphere))),"next"==e.operation&&("POIs"===this._kind?(this._selectedIdx++,this.reframeOnPOI()):"ZOIs"===this._kind?(this._selectedIdx++,this.reframeOnZOI()):(this._selectedIdx++,this.reframeOn(this.useModelBoundingSphere))))},d.prototype.restoreSelection=function(){let e=[];if(this._viewer.lockSelectionBroadcast(!0),this.originalSelection.length)for(let t=0;t<this.originalSelection.length;++t)if("POIs"===this._kind){const i=this._viewer.getController().unstreamPOI4Select(this.originalSelection[t]);for(let t=0;t<i.length;++t)null!==i[t]&&e.push({pathElement:i[t]})}else if("ZOIs"===this._kind)e=this._viewer.getController().unstreamZOIs(this.originalSelection);else{const i=this._viewer.unstreamPath(this.originalSelection[t]);if(null!==i)if(Array.isArray(i))for(let t=0;t<i.length;t++)null!==i[t]&&e.push({pathElement:i[t]});else e.push({pathElement:i})}this._internalCSOChange=!0,i.empty(),t.empty(),i.add(e),t.add(e),this._internalCSOChange=!1,this._viewer.lockSelectionBroadcast(!1),"POIs"===this._kind&&setTimeout((()=>{this._viewer.getController()._tooltipFrame&&!this._viewer.getController()._tooltipFrame.isClosed()&&this._viewer.getController()._tooltipFrame.hide()}),200)},d.prototype.reframeOn=function(e){-1===this._selectedIdx&&(this._selectedIdx=this._selection.length-1);const n=this._selectedIdx%this._selection.length;if(this._view){const e=n+1+"/"+this._selection.length;this._view.setLabel(e)}this._internalCSOChange=!0,this._viewer._reframeFocus=!0,this._viewer.lockSelectionBroadcast(!0),t.empty(),i.empty(),t.add(this._selection[n]),i.add(this._selection[n]),this._internalCSOChange=!1,this._viewer.lockSelectionBroadcast(!1),(this._viewer.getHideShowController()&&!this._viewer.getHideShowController().isVisible(this._selection[n].pathElement)&&1===this._viewer.getViewer().getVisibleSpace()||this._viewer.getHideShowController()&&this._viewer.getHideShowController().isVisible(this._selection[n].pathElement)&&0===this._viewer.getViewer().getVisibleSpace())&&this._viewer.displayNotification({eventID:"info",msg:this._viewer.getHideShowInheritStatus()?l.swapToSeeSelectionNotAvailable:l.swapToSeeSelection});let o=null;function h(e,t){if(t&&!t.isNaN()){const i=t.clone();e?e.mergeWithSphere(i,e):e=i}return e}if(a.isVDRPModelPath(this._selection[n].pathElement,this._viewer.getController())){var d=this._viewer.getController().buildVDRPIdPathFromPathElement(this._selection[n].pathElement);if(d&&d.productIdPath.length>0&&this._viewer.getController()._model.getVDRPIdPathWorldMatrix){const e=this._viewer.getController().getReferenceBoundingSphere(d.productIdPath[d.productIdPath.length-1]);if(e){var c=this._viewer.getController()._model.getVDRPIdPathWorldMatrix(d);e.applyMatrix4(c);const t=this._selection[n].pathElement.getBoundingSphere();let i=new r.Sphere;!t||t.isNaN()||t.empty()?i=e:e.mergeWithSphere(t,i),o=h(o,i),s.reframeOn({BS:o,viewpoint:this._viewer.getViewpoint()})}}}else{const e=this._viewer.getController().buildArrayFromPath(this._selection[n].pathElement);if(e&&e.length>0&&this._viewer.getController()._model.getWorldMatrix){const t=this._viewer.getController().getReferenceBoundingSphere(e[e.length-1]);if(t){c=this._viewer.getController()._model.getWorldMatrix(e);t.applyMatrix4(c);const i=this._selection[n].pathElement.getBoundingSphere();let a=new r.Sphere;!i||i.isNaN()||i.empty()?a=t:t.mergeWithSphere(i,a),o=h(o,a),s.reframeOn({BS:o,viewpoint:this._viewer.getViewpoint()})}else s.reframeOn({paths:[this._selection[n].pathElement],viewpoint:this._viewer.getViewpoint()})}else s.reframeOn({paths:[this._selection[n].pathElement],viewpoint:this._viewer.getViewpoint()})}},d.prototype.reframeOnPOI=function(){-1===this._selectedIdx&&(this._selectedIdx=this._selection.length-1);const e=this._selectedIdx%this._selection.length;if(this._view){var n=e+1+"/"+this._selection.length;this._view.setLabel(n)}this._internalCSOChange=!0,this._viewer._reframeFocus=!0,this._viewer.lockSelectionBroadcast(!0),t.empty(),i.empty(),t.add(this._selection[e]),i.add(this._selection[e]),this._viewer.lockSelectionBroadcast(!1);const o=this._selection[e].pathElement.getLastElement(!0);let s,a,r,l,d,c,p;if(o.name.indexOf("PAD3DPOINode")>-1){let e;if(o.getLayerID&&(s=o.getLayerID()),o._layerId&&(s=o._layerId),o.name&&(e=o.name.split("_")),a=e[e.length-1],a&&(a=parseInt(a)),s&&(r=this._viewer.getController()._layerPOIsIdInstancingNodeMap.get(s)),!0===h.isMemPCS()&&this._viewer.getController()._layerPOIsIdInstancingNodeMapMaster&&this._viewer.getController()._layerPOIsIdInstancingNodeMapMaster.size){const e=this._viewer.getController()._layerPOIsIdInstancingNodeMapMaster.get(s);if(e){const t=e.get(a),i=this._viewer.getController()._layers.get("POIs").get(s);this._viewer.getController()._seedNewNode(t,i,this._viewer.getController()._layerPOIsIdInstancingNodeMap.get(s),this._viewer.getController()._layerPOIsIdInstancingIndexMap.get(s),100,1);r=this._viewer.getController()._layerPOIsIdInstancingNodeMap.get(s)}}r&&(p=r.get(a),p&&(l=p.getLabelPOI(),c=p.getId(),d=p.getColorPOI()))}else a=this._selection[e].pathElement.instanceId,s=o.name,s&&(r=this._viewer.getController()._layerPOIsIdInstancingNodeMap.get(s)),r&&(p=r.get(a)),l=p.label,c=p.id,d=p.color;if(p){const e={resourceid:c,instanceid:a},t={layerID:s,layer:s,openPanel:!0,pois:[{layer:s,data:{instanceId:a,label:l,id:c,color:d}}]};this._viewer.getController()._reframeOnPOI(e,t),this._internalCSOChange=!1}},d.prototype.reframeOnZOI=function(){-1===this._selectedIdx&&(this._selectedIdx=this._selection.length-1);const e=this._selectedIdx%this._selection.length;if(this._view){const t=e+1+"/"+this._selection.length;this._view.setLabel(t)}this._internalCSOChange=!0,this._viewer._reframeFocus=!0,this._viewer.lockSelectionBroadcast(!0),t.empty(),i.empty(),t.add(this._selection[e]),i.add(this._selection[e]),this._viewer.lockSelectionBroadcast(!1),s.reframeOn({paths:[this._selection[e].pathElement],viewpoint:this._viewer.getViewpoint()}),this._internalCSOChange=!1},d})),define("DS/ENO3DView/mixins/_ENO3DViewPointVisualizationController",["UWA/Class","DS/ENO3DView/views/ENO3DPointVisualizationPanel","DS/PADServices/utils/PADTrackerManager"],(function(e,t,i){"use strict";return e.extend({name:"ENO3DViewPointVisualizationController",initPointVisualizationController:function(){this._applyPointVisualizationOnLoad(),this.subscribe({event:"onEndRootRemoved"},(e=>{if(!e.fromRefresh){let e=this.getNbR2VData();this._pointVisualizationPanel&&0===e&&this._destroyPanel()}})),this.subscribe({event:"onR2VLoaded"},this._onR2VLoadedInitVisualizationPanel.bind(this))},_createPanel:function(){this._pointVisualizationPanel=new t({immersiveFrame:this._context.getWafrUIFrame().getImmersiveFrame(),events:{onPointSizeChanged:this._onPointSizeChanged.bind(this),onPointSizeEndEdit:this._onPointSizeChanged.bind(this),onClosePanel:this._onClosePanel.bind(this),onPointShapeChanged:this._onPointShapeChanged.bind(this),onFillHolesChanged:this._onFillHolesChanged.bind(this),onEDLChanged:this._onEDLChanged.bind(this),onEdlStrengthChanged:this._onEdlStrengthChanged.bind(this),onEdlStrengthEndEdit:this._onEdlStrengthChanged.bind(this),onEdlRadiusChanged:this._onEdlRadiusChanged.bind(this),onEdlRadiusEndEdit:this._onEdlRadiusChanged.bind(this)}})},_destroyPanel:function(){this._pointVisualizationPanel.destroy(),delete this._pointVisualizationPanel},_onR2VLoadedInitVisualizationPanel:function(){const e=window.localStorage.getItem("ENO3DRealDataSplattingValue"),t=window.localStorage.getItem("ENO3DRealDataPointShape"),i=window.localStorage.getItem("ENO3DRealDataFillHoles"),n="true"===window.localStorage.getItem("ENO3DRealDataEDL"),o=window.localStorage.getItem("ENO3DRealDataEDLStrengthValue")?parseFloat(window.localStorage.getItem("ENO3DRealDataEDLStrengthValue")):1.2,s=window.localStorage.getItem("ENO3DRealDataEDLRadiusValue")?parseFloat(window.localStorage.getItem("ENO3DRealDataEDLRadiusValue")):2;if(e&&this._model._OOCManager.setSplattingParameters({splattingFactor:.8*e,minSize:2*e}),this._context.getViewer().renderer.PointCloudEffect){if(i&&"true"===i)this._context.getViewer().renderer.PointCloudEffect.setQuality("static","BlendedCircleAndFillHoles"),this._context.getViewer().renderer.PointCloudEffect.setQuality("dynamic","BlendedCircleAndFillHoles"),this._context.getViewer().renderer.PointCloudEffect.setQuality("viewpointStatic","BlendedCircleAndFillHoles");else{const e="circle"===t?"BlendedCircle":"SimpleSquare";this._context.getViewer().renderer.PointCloudEffect.setQuality("static",e),this._context.getViewer().renderer.PointCloudEffect.setQuality("dynamic","circle"===t?"SimpleCircle":"SimpleSquare"),this._context.getViewer().renderer.PointCloudEffect.setQuality("viewpointStatic",e)}!0===n?this._context.getViewer().renderer.PointCloudEffect.setEyeDomeLighting(!0,s,o):this._context.getViewer().renderer.PointCloudEffect.setEyeDomeLighting(!1,s,o)}this._context.getViewer().render()},togglePointVisualizationVisibility:function(e){"show"===e?this._createPanel():this._destroyPanel();const t=i.getPADTracker({eventCategory:"usage",eventAction:"command-3D"});t.setEventData({eventLabel:"show"===e?"ENO3DShowPointVisualizationView":"ENO3DHidePointVisualizationView"}),t.trackPageEvent()},_onClosePanel:function(){this._context.getCommandHandler().setCheckState({id:"ENO3DTogglePointVisualizationChk",state:!1})},_applyPointVisualizationOnLoad:function(){const e=window.localStorage.getItem("ENO3DRealDataSplattingValue"),t=window.localStorage.getItem("ENO3DRealDataPointShape"),i=window.localStorage.getItem("ENO3DRealDataFillHoles"),n="true"===window.localStorage.getItem("ENO3DRealDataEDL");window.localStorage.getItem("ENO3DRealDataEDLStrengthValue")||window.localStorage.setItem("ENO3DRealDataEDLStrengthValue",1.2),window.localStorage.getItem("ENO3DRealDataEDLRadiusValue")||window.localStorage.setItem("ENO3DRealDataEDLRadiusValue",2);const o=window.localStorage.getItem("ENO3DRealDataEDLStrengthValue")?parseFloat(window.localStorage.getItem("ENO3DRealDataEDLStrengthValue")):1.2,s=window.localStorage.getItem("ENO3DRealDataEDLRadiusValue")?parseFloat(window.localStorage.getItem("ENO3DRealDataEDLRadiusValue")):2;if(e&&this._model._OOCManager.setSplattingParameters({splattingFactor:.8*e,minSize:2*e}),this._context.getViewer().renderer.PointCloudEffect){if(i&&"true"===i)this._context.getViewer().renderer.PointCloudEffect.setQuality("static","BlendedCircleAndFillHoles"),this._context.getViewer().renderer.PointCloudEffect.setQuality("dynamic","BlendedCircleAndFillHoles"),this._context.getViewer().renderer.PointCloudEffect.setQuality("viewpointStatic","BlendedCircleAndFillHoles");else if(t){const e="circle"===t?"BlendedCircle":"SimpleSquare";this._context.getViewer().renderer.PointCloudEffect.setQuality("static",e),this._context.getViewer().renderer.PointCloudEffect.setQuality("dynamic","circle"===t?"SimpleCircle":"SimpleSquare"),this._context.getViewer().renderer.PointCloudEffect.setQuality("viewpointStatic",e)}n&&this._context.getViewer().renderer.PointCloudEffect.setEyeDomeLighting(!0,s,o)}this._context.getViewer().render()},_onPointShapeChanged:function(e,t){if(this._context.getViewer().renderer.PointCloudEffect&&("circle"===e?(this._context.getViewer().renderer.PointCloudEffect.setQuality("static","BlendedCircle"),this._context.getViewer().renderer.PointCloudEffect.setQuality("dynamic","SimpleCircle"),this._context.getViewer().renderer.PointCloudEffect.setQuality("viewpointStatic","BlendedCircle")):"square"===e&&(this._context.getViewer().renderer.PointCloudEffect.setQuality("static","SimpleSquare"),this._context.getViewer().renderer.PointCloudEffect.setQuality("dynamic","SimpleSquare"),this._context.getViewer().renderer.PointCloudEffect.setQuality("viewpointStatic","SimpleSquare")),this._context.getViewer().render(),t)){const t=i.getPADTracker({eventCategory:"usage",eventAction:"ENO3DPointVisualizationView-usage"});t.setEventData({eventLabel:"ENO3DPointVisualizationView-shape",eventValue:e}),t.trackPageEvent()}},_onPointSizeChanged:function(e){this._model._OOCManager.setSplattingParameters&&(this._model._OOCManager.setSplattingParameters({splattingFactor:.8*e,minSize:2*e}),this._context.getViewer().render())},_onPointSizeEndEdit:function(e){this._onPointSizeChanged(e);const t=i.getPADTracker({eventCategory:"usage",eventAction:"ENO3DPointVisualizationView-usage"});t.setEventData({eventLabel:"ENO3DPointVisualizationView-size",eventValue:e}),t.trackPageEvent()},_onFillHolesChanged:function(e){if(this._context.getViewer().renderer.PointCloudEffect){e&&(this._context.getViewer().renderer.PointCloudEffect.setQuality("static","BlendedCircleAndFillHoles"),this._context.getViewer().renderer.PointCloudEffect.setQuality("dynamic","BlendedCircleAndFillHoles"),this._context.getViewer().renderer.PointCloudEffect.setQuality("viewpointStatic","BlendedCircleAndFillHoles"),this._context.getViewer().render());const t=i.getPADTracker({eventCategory:"usage",eventAction:"ENO3DPointVisualizationView-usage"});t.setEventData({eventLabel:"ENO3DPointVisualizationView-fillHoles",eventValue:e}),t.trackPageEvent()}},_onEDLChanged:function(e){this._context.getViewer().renderer.PointCloudEffect&&(this._context.getViewer().renderer.PointCloudEffect.setEyeDomeLighting(e,1.2,2),this._context.getViewer().render())},_onEdlStrengthChanged:function(e){const t="true"===window.localStorage.getItem("ENO3DRealDataEDL");if(this._context.getViewer().renderer.PointCloudEffect&&t){const t=window.localStorage.getItem("ENO3DRealDataEDLRadiusValue")?parseFloat(window.localStorage.getItem("ENO3DRealDataEDLRadiusValue")):2;this._context.getViewer().renderer.PointCloudEffect.setEyeDomeLighting(!0,t,e),this._context.getViewer().render()}},_onEdlRadiusChanged:function(e){const t="true"===window.localStorage.getItem("ENO3DRealDataEDL");if(this._context.getViewer().renderer.PointCloudEffect&&t){const t=window.localStorage.getItem("ENO3DRealDataEDLStrengthValue")?parseFloat(window.localStorage.getItem("ENO3DRealDataEDLStrengthValue")):1.2;this._context.getViewer().renderer.PointCloudEffect.setEyeDomeLighting(!0,e,t),this._context.getViewer().render()}}})})),define("DS/ENO3DView/views/ENO3DMinimap",["css!DS/ENO3DView/ENO3DView.css","DS/Utilities/Dom","DS/ENO3DView/views/ENO3DMinimapCanvas","DS/ENO3DView/views/ENO3DMinimapToolbar"],(function(e,t,i,n){"use strict";const o="minimap",s={PAN:1,COMPASS:2,ROTATE:3};function a(e){this.elements={},this.options=e||{},this._width=300,this._height=300,this.options=Object.assign({nbfloor:1,nbbasement:0,positionUser:null,info:null,startAngle:0},this.options),this._localModelEvents=e.modelEvents,this.__create()}return a.prototype.__create=async function(){this.elements.proposalUX=t.createElement("div",{class:o+"-proposalUX"}),this.elements.canvas=new i({positionUser:this.options.positionUser,startAngle:this.options.startAngle,navModes:s,modelEvents:this._localModelEvents}),this.elements.proposalUX.appendChild(this.elements.canvas.getHTML()),this.elements.footer=t.createElement("div",{class:o+"-footer"}),this.elements.proposalUX.appendChild(this.elements.footer),this.elements.toolbar=new n({nbfloor:this.options.nbfloor,level:this.options.positionUser.idLevel,navModes:s,modelEvents:this._localModelEvents}),this.elements.toolbar.__setCanva(this.elements.canvas),this.elements.toolbar.__setFooter(this.elements.footer),this.elements.footer.appendChild(this.elements.toolbar.getHTML())},a.prototype.__setSizeCanvas=async function(){this.elements.canvas.__setWidth(parseInt(document.defaultView.getComputedStyle(this.elements.proposalUX).width)),this.elements.canvas.__setHeight(parseInt(document.defaultView.getComputedStyle(this.elements.proposalUX).height))},a.prototype.__updateLevel=function(e){return require(["DS/PADServices/utils/PADTrackerManager"],(e=>{const t=e.getPADTracker({eventCategory:"usage",eventAction:"ENO3DMinimap-usage"});t.setEventData({eventLabel:"ENO3DMinimap-setLevel"}),t.trackPageEvent()})),new Promise((t=>{this.elements.canvas.__changeIdLevel(e).then((()=>{t()}))}))},a.prototype.__updateUser=function(e){e.y=this.elements.canvas.image.height-e.y,this.elements.canvas.updateUser(e.x,e.y)},a.prototype.__UpdateState=async function(e,t){this.elements.toolbar.__updateFloorId(e.id),this.init?(this.__updateUser(t),this.elements.canvas.__draw()):(await this.elements.canvas.__changeIdLevel(e),this.__updateUser(t),this.init=!0,this.elements.canvas.__draw(),this.elements.canvas.__zoomFit())},a.prototype.__setSight=async function(e,t){this.elements.canvas.__setSight(e,t)},a.prototype.setSight=async function(e,t){this.elements.canvas.__setSight(e,t)},a.prototype.__resizeCanvas=function(e,t){this._width=e,this._width=t,this.elements.canvas.resize(e,t)},a.prototype.refreshCanvas=function(){this.__resizeCanvas(this._width,this._height),this.elements.canvas.__zoomFit()},a.prototype.getHTML=function(){return this.elements.proposalUX},a.prototype.delete=function(){delete this.elements.proposalUX,delete this.elements.canvas,delete this.elements.footer,delete this.elements.toolbar},a})),define("DS/ENO3DView/controller/ENO3DViewerController",["DS/ENOPAD3DViewer/controller/PAD3DViewerController","DS/ENO3DView/mixins/_ENO3DViewPointVisualizationController","DS/VDRPWebModelFactory/VDRPWebModelFactory","DS/PADServices/settings/AppSettings"],(function(e,t,i,n){"use strict";function o(t){const o=t.readyCB.bind(this);t.readyCB=()=>{this.initPointVisualizationController(),this._model.subscribe({event:"VDRPPostProcess"},(e=>{i.prototype.buildModel(n.getSetting("eno3dview_VDRP_activate_POS"),e,this._model._OOCManager,this)})),o()},e.call(this,t)}return o.prototype=Object.create(e.prototype),o.prototype=Object.assign(o.prototype,t.prototype),o.prototype.constructor=o,o.prototype.destroy=function(){e.prototype.destroy.call(this)},o})),define("DS/ENO3DView/views/ENO3DMinimapPanel",["css!DS/ENO3DView/ENO3DView.css","DS/PADServices/utils/PlatformURL","DS/Windows/Panel","DS/ENO3DView/views/ENO3DRoundPanel","DS/ENO3DView/views/ENO3DMinimap","DS/CoreEvents/ModelEvents","DS/R2VMinimap/R2VMinimapServices","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/GlobalUtils"],(function(e,t,i,n,o,s,a,r,l){"use strict";function h(e){this._parentContainer=e.renderTo,this.model=null,this._group=null,this._localModelEvents=new s,this._id=e.id,this.elements={},this._subs=[],this.initialized=!1,this.view={eye:{x:null,y:null,z:null},sight:{x:null,y:null,z:null},up:{x:null,y:null,z:null}},this._data=e.data,this._events=e.events,this._icon=e.icon}return h.prototype._buildPanel=function(){this.deletePanel(),this.elements.container=document.createElement("div"),this.elements.container.classList.add("ENO3DMinimapPanel-container"),this.elements.minimap=document.createElement("div"),this.elements.minimap.classList.add("ENO3DMinimapPanel-minimap"),this.elements.container.appendChild(this.elements.minimap),this.elements.panel||(this.elements.panel=new n({title:this._data["ds6w:label"]?this._data["ds6w:label"]:"Minimap",icon:this._icon,id:this._id,immersiveFrame:this._parentContainer,identifier:"ENO3DMinimapPanel",position:{offsetX:this._parentContainer.offsetWidth-250,offsetY:0},width:300,height:300,minWidth:250,minHeight:250,content:this.elements.container,allowedDockAreas:12,titleBarVisibleFlag:!0,maximizeButtonFlag:!0,closeButtonFlag:!1,resizableFlag:!0}),l.isMobileDevice()?this.minimap&&this.minimap.elements&&this.minimap.elements.toolbar&&(this.minimap.elements.toolbar.hover(),this.elements.panel.hover()):this.minimap&&this.minimap.elements&&this.minimap.elements.toolbar&&(this.minimap.elements.toolbar.exit(),this.elements.panel.exit()),this.elements.panel.hide()),this.__addListeners()},h.prototype.__supListeners=function(){for(let e=0;e<this._subs.length;e++)this._localModelEvents.unsubscribe(this._subs[e])},h.prototype.__addListeners=function(){l.isMobileDevice()?this.minimap&&this.minimap.elements&&this.minimap.elements.toolbar&&(this.minimap.elements.toolbar.hover(),this.elements.panel.hover()):(this.elements.panel.elements.container.addEventListener("mouseenter",function(e){this._fadeToToken&&(clearTimeout(this._fadeToToken),this._fadeToToken=null),this.minimap&&this.minimap.elements&&this.minimap.elements.toolbar&&(this.minimap.elements.toolbar.hover(),this.elements.panel.hover())}.bind(this)),this.elements.panel.elements.container.addEventListener("mouseover",function(e){this._fadeToToken&&(clearTimeout(this._fadeToToken),this._fadeToToken=null),this.minimap&&this.minimap.elements&&this.minimap.elements.toolbar&&(this.minimap.elements.toolbar.hover(),this.elements.panel.hover())}.bind(this)),this.elements.panel.elements.container.addEventListener("mouseleave",function(e){this._fadeToToken&&(clearTimeout(this._fadeToToken),this._fadeToToken=null),this._fadeToToken=setTimeout((()=>{this.minimap&&this.minimap.elements&&this.minimap.elements.toolbar&&(this.minimap.elements.toolbar.exit(),this.elements.panel.exit())}),1e3)}.bind(this))),this._localModelEvents.subscribe({event:"ENO3DView/ENO3DMinimap/View"},this.__updView.bind(this)),this._subs.push(this._localModelEvents.subscribe({event:"ENO3DView/ENO3DMinimap/GetLevel"},async function(e){let t=await this.minimapServices.getInformationForLevel(e.idLevel);await this.minimap.__updateLevel(t),require(["DS/PADServices/utils/PADTrackerManager"],(i=>{if(this.minimap&&this.minimap.options){var n=i.getPADTracker({eventCategory:"usage",eventAction:"3d_minimap_stats"});n.setEventData({eventLabel:"minimap_level_change",eventValue:this.minimapServices.hasMinimap()?1:0}),n.persVal.pv2=this.minimap.options.nbfloor,n.persVal.pv3=e.idLevel,n.persVal.pv4=t&&t.acquisitionPoints?t.acquisitionPoints.length:0,n.trackPageEvent()}})),this.minimap.elements.canvas.__draw()}.bind(this))),this._subs.push(this._localModelEvents.subscribe({event:"ENO3DView/ENO3DMinimap/GetViewPoint"},function(e){let t=this.minimapServices.getViewpointFromPosition(e.idLevel,e.x,e.y);e.duration||(e.duration=500),this.view.eye.x=t.x,this.view.eye.y=t.y,this.view.eye.z=t.z,!0!==e.draggingUser&&r.publish({event:"ENO3DView/ENO3DMinimap/set",data:{focus:this.view.focus,fov:this.view.fov,projection:this.view.projection,near:this.view.near,far:this.view.far,up:this.view.up,eye:{x:t.x,y:t.y,z:t.z},sight:this.view.sight,duration:e.duration,sightchange:!1,updateOnlyEnd:e.updateOnlyEnd}})}.bind(this))),this._subs.push(this._localModelEvents.subscribe({event:"ENO3DView/ENO3DMinimap/SetView"},async function(e){this.view.sight.x=e.x,this.view.sight.y=e.y,this.view.up.x=1e-7,this.view.up.y=1e-7,this.view.up.z=.9999999,r.publish({event:"ENO3DView/ENO3DMinimap/set",data:{focus:this.view.focus,fov:this.view.fov,projection:this.view.projection,near:this.view.near,far:this.view.far,up:this.view.up,eye:{x:this.view.eye.x,y:this.view.eye.y,z:this.view.eye.z},sight:this.view.sight,duration:0,sightchange:!0,updateOnlyEnd:!1}})}.bind(this))),this._subs.push(this._localModelEvents.subscribe({event:"ENO3DView/ENO3DMinimap/UpdateView"},async function(e){this.view=e,this._updateFromView(e)}.bind(this))),this._subs.push(this._localModelEvents.subscribe({event:"ENO3DView/ENO3DMinimap/ResizeCanvas"},async function(e){this.minimap&&this.minimap.elements&&this.minimap.elements.toolbar&&this.minimap.elements.toolbar.setFullscreen(e.fullscreen),this.__resizeCanvas(e.width,e.height)}.bind(this)))},h.prototype.init=function(e){return new Promise(((i,n)=>{if(this.elements.minimap&&this.elements.minimap.hasChildNodes()&&this.elements.minimap.removeChild(this.elements.minimap.firstChild),this._data&&this._data.resourceid&&e){this.minimapServices=new a,this.setView(e);var s={psId:this._data.resourceid,getURL:async function(e){return await t.getPlatformURL(e)}};this.minimapServices.initialize(s).then((async()=>{try{if(this.initialized=!0,!0===this.minimapServices.hasMinimap()){let e=await this.minimapServices.getNumberOfLevel(),t=await this.minimapServices.getPositionOnMinimap(this.view.eye),i=await this.minimapServices.getInformationForLevel(t.idLevel);this._buildPanel(),this.minimap=await new o({nbfloor:e,positionUser:t,info:i,startAngle:0,modelEvents:this._localModelEvents}),this.minimap.setSight(this.view.sight.x,-this.view.sight.y),this.minimap.__UpdateState(i,t.pointInMap),require(["DS/PADServices/utils/PADTrackerManager"],(e=>{var n=e.getPADTracker({eventCategory:"usage",eventAction:"3d_minimap_stats"});n.setEventData({eventLabel:"minimap_init",eventValue:this.minimapServices.hasMinimap()?1:0}),n.persVal.pv2=this.minimap.options.nbfloor,n.persVal.pv3=t.idLevel,n.persVal.pv4=i&&i.acquisitionPoints?i.acquisitionPoints:0,n.trackPageEvent()})),this.__updView("map"),this.minimap.refreshCanvas(),this.publish({event:"ENO3DView/ENO3DMinimap/MinimapInitialized",data:{hasMinimap:!0,id:this._data.resourceid}})}else this.publish({event:"ENO3DView/ENO3DMinimap/MinimapInitialized",data:{hasMinimap:!1,id:this._data.resourceid}});i()}catch(e){console.warn("Error on minimap initialize : "+e),this.publish({event:"ENO3DView/ENO3DMinimap/MinimapInitialized",data:{hasMinimap:!1,id:this._data.resourceid}}),n()}})).catch(n)}}))},h.prototype.publish=function(e){this._localModelEvents.publish({event:e.event,data:e.data})},h.prototype.subscribe=function(e){return this._localModelEvents.subscribe({event:e.event},e.callback)},h.prototype.unsubscribe=function(e){return this._localModelEvents.unsubscribe(e)},h.prototype.__draw=function(){this.minimap.elements.canvas.__draw()},h.prototype.__resizeCanvas=function(e,t){this.minimap.__resizeCanvas(e,t)},h.prototype._updateFromView=async function(e){if(this.minimapServices){let t=await this.minimapServices.getPositionOnMinimap(e.eye),i=await this.minimapServices.getInformationForLevel(t.idLevel);this.minimap&&(this.minimap.setSight(e.sight.x,-e.sight.y),this.minimap.__UpdateState(i,t.pointInMap))}},h.prototype.setView=function(e){this.view.eye.x=e.eye[0].x,this.view.eye.y=e.eye[0].y,this.view.eye.z=e.eye[0].z,this.view.far=e.far,this.view.focus=e.focus,this.view.fov=e.fov,this.view.near=e.near,this.view.projection=e.projection,this.view.sight.x=e.sight[0].x,this.view.sight.y=e.sight[0].y,this.view.sight.z=e.sight[0].z,this.view.up.x=e.up[0].x,this.view.up.y=e.up[0].y,this.view.up.z=e.up[0].z},h.prototype.getView=function(){return this.view},h.prototype.getResourceId=function(){return this._data.resourceid},h.prototype.updateView=function(e){this.minimap&&this.minimap.updateView(e)},h.prototype.__updView=function(e){if("map"===e)this.__updMap()},h.prototype.__updMap=function(){return!1===this.minimapServices.hasMinimap()?void this.setVisibility(!1):(this.elements.minimap.appendChild(this.minimap.getHTML()),void(l.isMobileDevice()&&this.minimap&&this.minimap.elements&&this.minimap.elements.toolbar&&(this.minimap.elements.toolbar.hover(),this.elements.panel.hover())))},h.prototype.isInitialized=function(){return!!this.minimapServices&&this.minimapServices.options.isInitialize},h.prototype.hasMinimap=function(){return!(!this.minimapServices||!0!==this.minimapServices.options.isInitialize||"function"!=typeof this.minimapServices.hasMinimap)&&this.minimapServices.hasMinimap()},h.prototype.close=function(){this.setVisibility(!1),"function"==typeof this._events.closeMinimap&&this._events.closeMinimap(this._data.resourceid),this.deletePanel()},h.prototype.setVisibility=function(e){!0===e?(this.elements.panel&&this.elements.panel.show(),this.minimap&&this.minimap.refreshCanvas()):!1===e&&this.elements.panel&&this.elements.panel.hide()},h.prototype.deletePanel=function(){this.__supListeners(),this.elements&&this.elements.container&&(this.elements.container.innerHTML=""),this.elements.panel&&this.elements.panel.hide(),this.minimap&&(this.minimap.delete(),delete this.minimap),delete this.elements.panel,delete this.elements.container},h})),define("DS/ENO3DView/mixins/ENO3DViewR2VMinimapManager",["css!DS/ENO3DView/ENO3DView.css","DS/CoreEvents/Events","DS/Visualization/ThreeJS_DS","DS/PADServices/utils/GlobalModelEvents","DS/ENO3DView/views/ENO3DMinimapPanel","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/WebappsUtils/WebappsUtils","DS/Utilities/Utils","DS/ENOXInterWdgCom/LinkManager","DS/Controls/ComboBox","DS/Controls/Button","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/Controls/Popup","DS/PADServices/utils/GlobalUtils"],(function(e,t,n,o,s,a,r,l,h,d,c,p,u,m,g){"use strict";return{_sessionStart:null,_createminimap:null,_visuEventOnEndMoveMinimap:null,_rootRemovedMinimap:null,_loadingFailureMinimap:null,_onlyUpdateEnd:!0,_UpdateMinimap:!0,_hasMinimap:!1,_loadedMinimaps:[],_soiData:[],_minimapsVisibility:!1,_minimapData:{},_minimapList:[],_minimapTreeDocument:null,_comboBoxContainer:null,_comboBoxFS:null,_minimapTreeNodeMap:null,_minimapFullscreen:!1,_ambianceChangedViewerCB:null,_initR2VMinimapManager:function(){this.subscribe({event:"onR2VLoaded"},this._onR2VLoadedMinimap.bind(this)),this.subscribe({event:"onSOIDropped"},this._onSOIDroppedMinimap.bind(this)),this._ambianceChangedViewerCB=this.getViewer().onVisuEnvChange((()=>{this._setMinimapAmbience()}));var e=document.createElement("div");e.classList.add("ENO3DMinimapContainer"),this._minimapTreeDocument=new p,this._comboBoxContainer=document.createElement("div"),this._comboBoxContainer.classList.add("ENO3DMinimapContainer-MinimapUIs"),this._comboBoxFS=new d({enableSearchFlag:!1,elementsTree:this._minimapTreeDocument,popupSizeAdjustPolicy:m.SizeAdjustPolicyEnum.NoAdjust}),this._minimapTreeNodeMap=new Map,this._comboBoxFS.addEventListener("change",function(){this._changeCurrentMinimap(this._comboBoxFS.value),this._onMinimapResize()}.bind(this)),e.appendChild(this._comboBoxContainer),this._comboBoxFS.getContent().addClassName("ENO3DMinimapContainer-ComboBoxFS"),this.elements.closeButton=new c({displayStyle:"normal",icon:{iconName:"wrong",fontIconFamily:WUXManagedFontIcons.Font3DS}}).inject(e),this.elements.closeButton.getContent().classList.add("ENO3DRoundPanel-closeButton"),this.elements.closeButton.getContent().classList.add("minimap-toolbar-button"),this.elements.closeButton.addEventListener("buttonclick",function(){this._closeMinimapCommand()}.bind(this)),this._setMinimapCloseVisibility(!1),this.elements.resizer=new c({displayStyle:"normal",icon:{iconName:"resize-full",fontIconFamily:WUXManagedFontIcons.Font3DS}}).inject(e),this.elements.resizer.getContent().classList.add("ENO3DRoundPanel-Resizer"),this.elements.resizer.getContent().classList.add("minimap-toolbar-button"),this.elements.resizer.addEventListener("buttonclick",function(){this._minimapFullscreen=!this._minimapFullscreen,!0===this._minimapFullscreen?this.elements.resizer.icon={iconName:"resize-small",fontIconFamily:WUXManagedFontIcons.Font3DS}:this.elements.resizer.icon={iconName:"resize-full",fontIconFamily:WUXManagedFontIcons.Font3DS},this._onMinimapResize()}.bind(this)),this._setMinimapResizeVisibility(!1),this._minimapContainer=document.createElement("div"),this._minimapContainer.classList.add("ENO3DMinimapContainer-minimap"),e.appendChild(this._minimapContainer),this.getWafrUIFrame().getImmersiveFrame().getContent().appendChild(e),this._setMinimapAmbience()},_onSOIDroppedMinimap:function(e){let t=e.states;for(var i=0;i<t.length;i++)this._soiData[t[i].resourceid]={data:t[i],soiId:e.resourceid}},_onR2VLoadedMinimap:function(e){if(e.contentTypes&&e.contentTypes.includes("pointCloud")){let l=e.rootPhID;Object.keys(this._loadedMinimaps).length;this._loadedMinimaps[l]||(this._loadedMinimaps[l]=new s({renderTo:this._minimapContainer,id:l,data:this._soiData[l]&&this._soiData[l].data?this._soiData[l].data:{},icon:r.getWebappsAssetUrl("ENO3DCommands","icons/32/I_ENO3DShowPointCloudMinimap.png"),events:{closeMinimap:e=>{const t=this._minimapList.indexOf(e);-1!==t&&this._minimapList.splice(t,1);var i=this._minimapTreeNodeMap.get(l);i&&i.remove(),this._minimapList&&this._minimapList.length<=1&&this._setMinimapComboBoxVisibility(!1)}}}));var a=this.getViewpointParameters();if(this._loadedMinimaps[l]){this._loadedMinimaps[l].init(a).then((()=>{if(this._loadedMinimaps[l].initialized=!0,!0===this._hasMinimap||this._loadedMinimaps[l].hasMinimap()){var e=null!==window.localStorage.getItem("SoIMinimapState")&&JSON.parse(window.localStorage.getItem("SoIMinimapState"));if(e&&!0===e&&this.getCommandHandler().setCheckState({id:"ENO3DTogglePointCloudMinimapChk",state:e}),this._loadedMinimaps[l].hasMinimap()){this._hasMinimap=!0;var t=this._minimapList.indexOf(l);-1===t&&(this._minimapList.push(l),t=this._minimapList.indexOf(l))}if(this._minimapList.length>1?this.getCommandHandler().getCheckState({id:"ENO3DTogglePointCloudMinimapChk"})&&!0===this.getCommandHandler().getCheckState({id:"ENO3DTogglePointCloudMinimapChk"})&&(this._setMinimapComboBoxVisibility(!0),this._setMinimapResizeVisibility(!0)):this._loadedMinimaps[l]&&this._loadedMinimaps[l].hasMinimap()&&(this._setMinimapComboBoxVisibility(!1),this.getCommandHandler().getCheckState({id:"ENO3DTogglePointCloudMinimapChk"})&&!0===this.getCommandHandler().getCheckState({id:"ENO3DTogglePointCloudMinimapChk"})&&(this._setMinimapResizeVisibility(!0),this._setMinimapSOIVisibility(this._loadedMinimaps[l],!0))),require(["DS/PADServices/utils/PADTrackerManager"],(e=>{const t=e.getPADTracker({eventCategory:"usage",eventAction:"command-3D"});t.setEventData({eventLabel:"ENO3DMinimapAutoChk",eventValue:"Enable"}),t.trackPageEvent()})),this.getController().getNbR2VData()>0&&this.enableCheck("ENO3DTogglePointCloudMinimapChk"),this._loadedMinimaps[l].hasMinimap()){var i=new u({label:this._soiData[l].data["ds6w:label"],grid:{valueItem:l},value:l,description:this._soiData[l].data["ds6w:label"]});this._minimapTreeNodeMap.set(l,i),this._minimapTreeDocument.addChild(i),this._changeCurrentMinimap(l)}}else if(!1===this._hasMinimap){!0===this.getCommandHandler().getCheckState({id:"ENO3DTogglePointCloudMinimapChk"})&&(this.getCommandHandler().setCheckState({id:"ENO3DTogglePointCloudMinimapChk",state:!1}),this._setMinimapResizeVisibility(!1)),require(["DS/PADServices/utils/PADTrackerManager"],(e=>{const t=e.getPADTracker({eventCategory:"usage",eventAction:"command-3D"});t.setEventData({eventLabel:"ENO3DMinimapAutoChk",eventValue:"NoMinimap"}),t.trackPageEvent()})),this.getController().getNbR2VData()>0&&this.disableCheck("ENO3DTogglePointCloudMinimapChk"),this._minimapList&&this._minimapList.length<=1&&this._setMinimapComboBoxVisibility(!1),this._toggleMinimap("hide");const e=this._minimapList.indexOf(l);-1!==e&&this._minimapList.splice(e,1)}})).catch((()=>{}));let e=o;e.subscribe({event:"ENO3DView/ENO3DMinimap/ChangeUpdate"},async function(e){this._UpdateMinimap=e}.bind(this)),this.subscribe({event:"onWidgetResize"},function(){this._onMinimapResize()}.bind(this)),e.subscribe({event:"ENO3DView/ENO3DMinimap/set"},async function(e){var t=this.getViewpoint();this._lockViewpointSync=!1,h.publish("DS/ExternalWdgtCom/SetViewpointSyncMaster"),this.getViewer().get360Mode()&&!e.sightchange?t.contextAwareMoveTo({eyePosition:new n.Vector3(e.eye.x,e.eye.y,e.eye.z),upDirection:new n.Vector3(e.up.x,e.up.y,e.up.z),sightDirection:new n.Vector3(e.sight.x,e.sight.y,e.sight.z),distanceToTarget:e.focus,duration:0},{allow360:!0}):t.moveTo({eyePosition:new n.Vector3(e.eye.x,e.eye.y,e.eye.z),upDirection:new n.Vector3(e.up.x,e.up.y,e.up.z),sightDirection:new n.Vector3(e.sight.x,e.sight.y,e.sight.z),distanceToTarget:e.focus,duration:e.duration})}.bind(this));this._visuEventOnEndMoveMinimap||(this._visuEventOnEndMoveMinimap=t.subscribe({event:"/VISU/"},function(e){if(this._UpdateMinimap)switch(e.eventType){case"@onViewpointChange":this._realMoveMinimap=!0;var t=this.getViewpointParameters(),i=Object.keys(this._loadedMinimaps),n=i.length;for(let e=0;e<n;e++)this._loadedMinimaps[i[e]].setView(t),this._loadedMinimaps[i[e]].publish({event:"ENO3DView/ENO3DMinimap/UpdateView",data:this._loadedMinimaps[i[e]].getView()});break;case"@onViewpointEndMove":if(this._realMoveMinimap){const e=function(){this._realMoveMinimap=!1;var e=this.getViewpointParameters(),t=Object.keys(this._loadedMinimaps),i=t.length;for(let n=0;n<i;n++)this._loadedMinimaps[t[n]].setView(e),this._loadedMinimaps[t[n]].publish({event:"ENO3DView/ENO3DMinimap/UpdateView",data:this._loadedMinimaps[t[n]].getView()})}.bind(this);e()}}}.bind(this))),this._rootRemovedMinimap||(this._rootRemovedMinimap=this.subscribe({event:"onRootRemoved"},(e=>{let t=Object.keys(this._loadedMinimaps);var i=!1;if(e.id){const t=this._minimapList.indexOf(e.id);this._minimapList.splice(t,1)}e.id&&this._loadedMinimaps[e.id]&&(this._loadedMinimaps[e.id].close(),delete this._loadedMinimaps[e.id]);for(let o=0;o<t.length;o++)if(this._loadedMinimaps[t[o]]&&t[o]!==e.id)if(!0===this._loadedMinimaps[t[o]].isInitialized())!0===this._loadedMinimaps[t[o]].hasMinimap()&&(i=!0,this._updateMinimapState(),this.getCommandHandler().getCheckState({id:"ENO3DTogglePointCloudMinimapChk"})&&!0===this.getCommandHandler().getCheckState({id:"ENO3DTogglePointCloudMinimapChk"})&&(this._minimapList.length>1?t[o]===this._comboBoxFS.value&&this._setMinimapSOIVisibility(this._loadedMinimaps[t[o]],!0):this._setMinimapSOIVisibility(this._loadedMinimaps[t[o]],!0)));else if(!1===this._loadedMinimaps[t[o]].isInitialized()&&!i){i=null;var n=this._loadedMinimaps[t[o]].subscribe({event:"ENO3DView/ENO3DMinimap/MinimapInitialized",callback:e=>{this._loadedMinimaps[t[o]].unsubscribe(n),!0!==i&&(!1===e.hasMinimap?(this._hasMinimap=!1,this._updateMinimapState()):(this._hasMinimap=!0,this._updateMinimapState(),this.getCommandHandler().getCheckState({id:"ENO3DTogglePointCloudMinimapChk"})&&!0===this.getCommandHandler().getCheckState({id:"ENO3DTogglePointCloudMinimapChk"})&&this._setMinimapSOIVisibility(this._loadedMinimaps[t[o]],!0)))}})}!1===i&&(this._hasMinimap=!1,this._updateMinimapState()),t=Object.keys(this._loadedMinimaps),0===t.length?(this._setMinimapComboBoxVisibility(!1),this._setMinimapResizeVisibility(!1),this._setMinimapCloseVisibility(!1),this.unsubscribe(this._rootRemovedMinimap),delete this._rootRemovedMinimap):this._onMinimapResize()}))),this._loadingFailureMinimap||(this._loadingFailureMinimap=this.subscribe({event:"onLoadingFailure"},(e=>{let t=Object.keys(this._loadedMinimaps);if(t.length>0){for(let e=0;e<t.length;e++)this._loadedMinimaps[t[e]].close();const e=this._loadedMinimaps.indexOf(t[i]);this._loadedMinimaps.splice(e,1)}t=Object.keys(this._loadedMinimaps),0===t.length&&(this._setMinimapComboBoxVisibility(!1),this._setMinimapResizeVisibility(!1),this._setMinimapCloseVisibility(!1),this.unsubscribe(this._loadingFailureMinimap),delete this._loadingFailureMinimap)})))}}},_setMinimapComboBoxVisibility:function(e){!0!==e||this._comboBoxContainer.contains(this._comboBoxFS.getContent())?!1===e&&this._comboBoxContainer.contains(this._comboBoxFS.getContent())&&this._comboBoxContainer.removeChild(this._comboBoxFS.getContent()):this._comboBoxContainer.appendChild(this._comboBoxFS.getContent())},_setMinimapResizeVisibility:function(e){var t=this.getWafrUIFrame().getImmersiveFrame().getContent().clientWidth;!0===e&&!g.isMobileDevice()&&t>600&&!0===this._minimapsVisibility?this.elements.resizer.getContent().style.display="":(!1===e||g.isMobileDevice()||t<=600)&&(this.elements.resizer.getContent().style.display="none")},_setMinimapCloseVisibility:function(e){!0===e?this.elements.closeButton.getContent().style.display="":!1===e&&(this.elements.closeButton.getContent().style.display="none")},_changeCurrentMinimap:function(e){let t=Object.keys(this._loadedMinimaps);for(var i=0;i<t.length;i++){var n=t[i];n===e&&this._loadedMinimaps[n]&&this._loadedMinimaps[n].hasMinimap()?(this.getCommandHandler().getCheckState({id:"ENO3DTogglePointCloudMinimapChk"})&&!0===this.getCommandHandler().getCheckState({id:"ENO3DTogglePointCloudMinimapChk"})&&this._setMinimapSOIVisibility(this._loadedMinimaps[n],!0),this._minimapTreeNodeMap&&this._minimapTreeNodeMap.size>0&&this._minimapTreeNodeMap.has(n)&&this._minimapTreeNodeMap.get(n).select()):this._setMinimapSOIVisibility(this._loadedMinimaps[n],!1)}},_onMinimapResize:function(){var e=24;g.isMobileDevice()&&(e=37);var t=g.isMobileDevice()?250:300,i=t,n=!1,o=this.getWafrUIFrame().getImmersiveFrame().getContent().clientHeight,s=this.getWafrUIFrame().getImmersiveFrame().getContent().clientWidth;!this._minimapFullscreen&&(s<600||g.isMobileDevice())?(this._minimapContainer.classList.add("small-viewport"),this._minimapContainer.classList.remove("normal-viewport"),this._minimapFullscreen=!0,this._fullscreenAuto=!0,this._setMinimapResizeVisibility(!1)):this._minimapFullscreen&&s>=600&&!g.isMobileDevice()?(this._minimapContainer.classList.add("small-viewport"),this._minimapContainer.classList.remove("normal-viewport"),this._setMinimapResizeVisibility(!0),!0===this._fullscreenAuto&&(this._fullscreenAuto=!1,this._minimapFullscreen=!1,this._minimapContainer.classList.remove("small-viewport"),this._minimapContainer.classList.add("normal-viewport"),this._setMinimapResizeVisibility(!0))):this._minimapFullscreen&&s<600?(this._minimapContainer.classList.add("small-viewport"),this._minimapContainer.classList.remove("normal-viewport"),this._setMinimapResizeVisibility(!1)):this._minimapFullscreen||(this._minimapContainer.classList.remove("small-viewport"),this._minimapContainer.classList.add("normal-viewport"),!0===this._minimapsVisibility&&this._setMinimapResizeVisibility(!0)),!0===this._minimapFullscreen||g.isMobileDevice()?o-e>s?(i=s>t?s:t,this._height=i,this._width=i,n=!1):(i=o-e>t?o-e:t,this._height=i,this._width=i,n=!0):(i=t,this._height=i,this._width=i),this._minimapContainer.style.width=this._width+"px",this._minimapContainer.style.height=this._height+"px";var a=Object.keys(this._loadedMinimaps),r=a.length;for(let e=0;e<r;e++)this._loadedMinimaps[a[e]].publish({event:"ENO3DView/ENO3DMinimap/ResizeCanvas",data:{width:this._width,height:this._height,fullscreen:(!0===this._minimapFullscreen||g.isMobileDevice())&&n}})},_toggleMinimap:function(e){if(this._loadedMinimaps){var t,i=Object.keys(this._loadedMinimaps),n=i.length;for("show"===e?n>0?(window.localStorage.setItem("SoIMinimapState",!0),this._minimapList&&this._minimapList.length>1&&this._setMinimapComboBoxVisibility(!0),this._setMinimapResizeVisibility(!0),this._setMinimapCloseVisibility(!0)):(this.getCommandHandler().setCheckState({id:"ENO3DTogglePointCloudMinimapChk",state:!1}),this.displayNotification({eventID:"warning",msg:a.minimap.errorInit})):(this._setMinimapComboBoxVisibility(!1),this._setMinimapResizeVisibility(!1),this._setMinimapCloseVisibility(!1),window.localStorage.setItem("SoIMinimapState",!1)),t=0;t<n;t++){var o=this._loadedMinimaps[i[t]];o&&"show"===e?!0===o.initialized&&!0===o.hasMinimap()&&(this._minimapsVisibility=!0,this._minimapList&&this._minimapList.length>1?i[t]===this._comboBoxFS.value?this._setMinimapSOIVisibility(o,!0):this._setMinimapSOIVisibility(o,!1):this._setMinimapSOIVisibility(o,!0),require(["DS/PADServices/utils/PADTrackerManager"],(e=>{const t=e.getPADTracker({eventCategory:"usage",eventAction:"command-3D"});t.setEventData({eventLabel:"ENO3DShowPointCloudMinimap"}),t.trackPageEvent()}))):o&&"hide"===e&&(this._setMinimapSOIVisibility(o,!1),this._setMinimapResizeVisibility(!1),this._setMinimapCloseVisibility(!1),this._minimapsVisibility=!1,require(["DS/PADServices/utils/PADTrackerManager"],(e=>{const t=e.getPADTracker({eventCategory:"usage",eventAction:"command-3D"});t.setEventData({eventLabel:"ENO3DHidePointCloudMinimap"}),t.trackPageEvent()})))}}},_setMinimapSOIVisibility:function(e,t){!0===t?(e.setVisibility(!0),this._onMinimapResize()):!1===t&&(e.setVisibility(!1),this._onMinimapResize())},_setMinimapAmbience:function(){var e=this.getViewer().getVisuEnv(),t=this.getWafrUIFrame().getImmersiveFrame().elements.container;e.toLowerCase().contains("white")||e.toLowerCase().contains("basic")||e.toLowerCase().contains("studio")?(t.addClassName("minimap-white"),t.removeClassName("minimap-blue"),t.removeClassName("minimap-dark"),t.removeClassName("minimap-brown")):e.toLowerCase().contains("dark")?(t.removeClassName("minimap-white"),t.removeClassName("minimap-blue"),t.removeClassName("minimap-brown"),t.addClassName("minimap-dark")):e.toLowerCase().contains("blue")?(t.addClassName("minimap-blue"),t.removeClassName("minimap-white"),t.removeClassName("minimap-dark"),t.removeClassName("minimap-brown")):e.toLowerCase().contains("outdoor")?(t.addClassName("minimap-brown"),t.removeClassName("minimap-white"),t.removeClassName("minimap-dark"),t.removeClassName("minimap-blue")):(t.removeClassName("minimap-white"),t.removeClassName("minimap-blue"),t.removeClassName("minimap-dark"),t.removeClassName("minimap-brown"))},_updateMinimapState:function(){this.getController().getNbR2VData()>0&&(!0===this._hasMinimap&&this.getController().getNbR2VData()>0?this.enableCheck("ENO3DTogglePointCloudMinimapChk"):this.getCommandHandler().setCheckState({id:"ENO3DTogglePointCloudMinimapChk",state:!1}).then((()=>{this.getController().getNbR2VData()>0&&this.disableCheck("ENO3DTogglePointCloudMinimapChk"),t.unsubscribe(this._visuEventOnEndMoveMinimap),this._visuEventOnEndMoveMinimap=null})).catch((()=>{t.unsubscribe(this._visuEventOnEndMoveMinimap),this._visuEventOnEndMoveMinimap=null})))},_closeMinimapCommand:function(){this.getCommandHandler().setCheckState({id:"ENO3DTogglePointCloudMinimapChk",state:!1}),this._setMinimapResizeVisibility(!1)}}})),define("DS/ENO3DView/ENO3DView",["css!DS/ENO3DView/ENO3DView","i18n!DS/ENOPAD3DViewer/assets/nls/PAD3DViewer.json","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/ENO3DUtils/ENO3DBaseComponent","UWA/Controls/Abstract","UWA/Core","DS/ENO3DView/mixins/ENO3DViewManipulations","DS/ENO3DView/mixins/ENO3DViewStatusBar","DS/ENO3DView/mixins/ENO3DViewAccessors","DS/ENO3DView/mixins/ENO3DViewEventManager","DS/ENO3DView/mixins/ENO3DViewCommandStateManager","DS/PADUtils/PADWebInWinServices","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADSession","DS/PADUtils/PADProbes","DS/Visualization/ThreeJS_DS","DS/ENOPAD3DViewer/utils/PAD3DViewerChangeAction","DS/PADUtils/PADUtilsServices","DS/Utilities/UUID","DS/PADServices/utils/AttributesMgtV2","DS/PADUtils/views/PADProgressBar","DS/PADUtils/PADContext","DS/ENOPAD3DViewer/mixins/PAD3DViewerLoadingBoxesEngine","DS/ENOPAD3DViewer/mixins/_PAD3DViewerStartupViewAutoloader","DS/ENOPAD3DViewer/views/PAD3DRootListMgt","DS/ENOPAD3DViewer/views/PAD3DFindInContextColorized","DS/ENOPAD3DViewer/mixins/_PAD3DViewerViewpointController","DS/ENOPAD3DViewer/mixins/PAD3DViewerWidgetLink","DS/ENOPAD3DViewer/mixins/_PAD3DViewerSearchResultsView","DS/ENOPAD3DViewer/views/PAD3DSOITimelineView","DS/ENO3DView/mixins/ENO3DViewR2VMinimapManager","DS/ENO3DView/mixins/ENO3DViewPreferencesManager","DS/ENOXTriptych/js/ENOXTriptych","DS/Visualization/WebGLV6Viewer","DS/Visualization/Viewpoint","DS/ENO3DView/controller/ENO3DViewerController","DS/Selection/CSOManager","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/ENOPAD3DViewer/utils/PAD3DViewerVisuServices","DS/PADUtils/PADTypesMgt","UWA/Utils/InterCom","DS/i3DXCompassServices/i3DXCompassPubSub","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/settings/AppSettings","DS/PADUtils/PADPromise","DS/ENOPAD3DViewer/commands/PAD3DViewerDebugVisuCmd","DS/Visualization/SceneGraphUtils","DS/ENOXInterWdgCom/LinkManager","DS/Windows/Panel","DS/PADServices/utils/SGIUtils"],(function(e,t,i,n,o,s,a,r,l,h,d,c,p,u,m,g,_,f,C,v,D,b,w,y,S,E,P,O,M,V,B,I,N,x,T,A,R,k,L,U,F,z,G,W,H,X,j,Z,q,Q){"use strict";var K=!1;function Y(e={}){n.call(this,e),this._appConfigPath=e.appConfigPath,this._options=e,this._identifiers={widget:e.widgetIdentifier||"Widget",landingPage:e.landingPageIdentifier},this.name="ENO3DView",this._padintercom=null,this._frmWindow=null,this._viewer=null,this._layout=null,this._UILoader=null,this._dropZoneContainer=null,this.elements={},this._controller=null,this._hideShowController=null,this._BIController=null,this._modelEvents=null,this._changeAction=null,this._controllerTokens=[],this._csoTokens=[],this._psoTokens=[],this._hsoTokens=[],this._hideShowControllerTokens=[],this._dndTokens=[],this._actionBarTokens=[],this._layoutActivatedTokenBegin=null,this._layoutActivatedTokenEnd=null,this._actionBarCloseEvt=-1,this._actionBarOpenEvt=-1,this._lockCSONotification=!1,this._lockCSONotificationEmpty=!1,this._authorizeSet3DStructure=!1,this._isVolumeFilter=!1,this._isFilterOpen=!1,this._robotVisibility=!0,this._defaultContextualBarVisibility=!0,this._openWithMenuAvailability=!1,this._defaultContextualMenuVisibility=!0,this._propertiesCommandAvailability=!0,this._firstInit=!0,this._interwidgetComAvailability=!0,this._defaultProgressBarVisibility=null,this._automaticReframePolicy=null,this._applicativeAutomaticReframePolicy=null,this._filteredIdToReload=[],this._readyCheckPromises=[],this._physicalId=[],this.initProbe=null,this._applicativeData={},this._platformServicesInitPromise=null,this._loadingDelegations=null,this._volumePanel=0,this._triptych=null,this._rootListPanel={},this._rightSidePanelCmd=null}return Y.prototype=Object.create(n.prototype),Y.prototype=Object.assign(Y.prototype,o.prototype),Y.prototype=Object.assign(Y.prototype,a.prototype),Y.prototype=Object.assign(Y.prototype,r.prototype),Y.prototype=Object.assign(Y.prototype,l.prototype),Y.prototype=Object.assign(Y.prototype,h.prototype),Y.prototype=Object.assign(Y.prototype,d.prototype),Y.prototype=Object.assign(Y.prototype,w.prototype),Y.prototype=Object.assign(Y.prototype,y.prototype),Y.prototype=Object.assign(Y.prototype,S.prototype),Y.prototype=Object.assign(Y.prototype,E.prototype),Y.prototype=Object.assign(Y.prototype,P.prototype),Y.prototype=Object.assign(Y.prototype,M.prototype),Y.prototype=Object.assign(Y.prototype,V),Y.prototype=Object.assign(Y.prototype,B),Y.prototype=Object.assign(Y.prototype,I),Y.prototype=Object.assign(Y.prototype,O.prototype),Y.prototype.constructor=Y,Y.prototype.initialize=function(){return this._DEBUG&&console.log("ENO3DView.initialize called"),new Promise(((e,t)=>{if(!0===this._isComponentInitialized)e();else{p.setSetting("eno3dviewer_infrastructure_version","wafr");const i=()=>{this._initSettings().then((e=>this._waitForAppReady(e))).then((e=>this._connectToPlatform(e))).then((e=>this._widgetLinkConfiguration(e))).then((e=>this._finalizeInit(e))).then(this._viewReady.bind(this)).then(e).catch(t)},n=window.localStorage.getItem("ENO3DRealDataPointShape");window.OOCR2VRoundPoints="circle"===n,null===p.app_context?this._appConfigPath?this._assignAppConfig().then(i.bind(this)).catch(t):(p.set_app_context("eno3dviewerinfra",!0),p.setSetting("lang",this._lang),i()):i()}}))},Y.prototype.clean=function(){return this._DEBUG&&console.log("ENO3DView.clean called"),new Promise(((e,t)=>{e()}))},Y.prototype.destroy=function(){return this._DEBUG&&console.log("ENO3DView.destroy called"),new Promise(((e,t)=>{if(delete this._identifiers,delete this._components,this._commandProxy&&(this._commandProxy.padDestroy(),this._commandProxy.destroy()),this._unregisterDnDEvents(),this._hideShowController){for(let e=0;e<this._hideShowControllerTokens.length;++e)this._hideShowController.unsubscribe(this._hideShowControllerTokens[e]);this._hideShowController.destroy()}if(this._BIController&&this._BIController.destroy(),this._controller){for(let e=0;e<this._controllerTokens.length;++e)this._controller.unsubscribe(this._controllerTokens[e]);this._controller.destroy()}this.getStatusBar()&&this.getStatusBar().destroy(),this._dndTokens&&this._dndTokens.length&&(this.elements.container.removeEventListener("dragenter",this._dndTokens[0]),this.elements.container.removeEventListener("dragover",this._dndTokens[1]),this.elements.container.removeEventListener("dragleave",this._dndTokens[2]),this.elements.container.removeEventListener("dragend",this._dndTokens[3]),this.elements.container.removeEventListener("drop",this._dndTokens[4])),this.disposeLoadingBoxesEngine(),this.disposeRootListMgt(),b.reset(),p.destroy(),v.deleteMapping({uuid:this._appUUID}),this._rightSidePanelCmd&&this._rightSidePanelCmd.destroy(),this._ambianceChangedViewerCB&&(this._viewer.unsubscribe(this._ambianceChangedViewerCB),this._ambianceChangedViewerCB=null),this._viewer&&this._viewer.destroy(),this.destroyParent().then(e)}))},Y.prototype._viewReady=function(){return this._DEBUG&&console.log("ENO3DView._viewReady called"),new Promise((e=>{this.getExecutionContext().setContext("ViewerReady",!0),this._isComponentInitialized=!0,e()}))},Y.prototype._assignAppConfig=function(){return this._DEBUG&&console.log("ENO3DView._assignAppConfig called"),new Promise(((e,t)=>{this.loadSource(`text!${this._appConfigPath}`).then((i=>{try{p.setApp("object"==typeof i?i:JSON.parse(i),"eno3dviewerinfra",!1),p.setSetting("enopad3dviewer_staticMappingSupportActivated",!0),e()}catch(e){console.error("ENO3DView._assignAppConfig : Could not JSON.parse the provided AppConfig"),t()}})).catch(t)}))},Y.prototype._initSettings=function(){return this._DEBUG&&console.log("ENO3DView._initSettings called"),new Promise(((e,t)=>{window.nearFarBigScale=!0;const i={windowOptions:p.getLayout_options("view_options"),enableSidePanel:!0,propertiesFacet:s.is(p.getSetting("propertiesFacet"),"array")?p.getSetting("propertiesFacet"):[]};o.call(this,i),c.initialize({widget:this.getWidget()}),this.setAutomaticReframePolicy(!0),this.setDefaultProgressBarVisibility(!0),p.setSetting("enopad3dviewer_roles",[]),p.setSetting("enopad3dviewer_lightNodeModel",!0),p.setSetting("enopad3dviewer_useNewProgressiveExpandAPI",!0),p.setSetting("enopad3dviewer_useStaticURL",!0),p.setSetting("readOnlyDashboard",!(!this.getWidget()||!this.getWidget().readOnly)&&this.getWidget().readOnly),this._authorizeSet3DStructure=!0,this._isVolumeFilter=p.getSetting("enopad3dviewer_volumeFilterAvailability"),this._propertiesCommandAvailability=p.getSetting("enopad3dviewer_propertiesCommandAvailability"),this.initProbe=m.createProbe("PAD3DViewer_init"),this._interwidgetComAvailability=p.getSetting("enopad3dviewer_interwidgetComAvailability"),p.setSetting("enopad3dviewer_occlusionTest",!0),require(["DS/PADServices/utils/PADTrackerManager"],(e=>{const t=e.getPADTracker({eventCategory:"usage",eventAction:"ENO3DView-usage"});t.setEventData({eventLabel:"ENO3DViewPickingFilter"}),t.persDim.pd2=p.getSetting("enopad3dviewer_selectionFilter"),t.trackPageEvent()})),this._modelEvents=this.getModelEvent();try{b.set(this),e(i)}catch(e){t(e)}}))},Y.prototype._waitForAppReady=function(e){return new Promise(((t,i)=>{let n=this._modelEvents.subscribe({event:"onDidLoadApp"},function(){this._initAppLoaded(),this._modelEvents.unsubscribe(n)}.bind(this));t(e)}))},Y.prototype._connectToPlatform=function(e){return this._DEBUG&&console.log("ENO3DView._connectToPlatform called with",e),new Promise(((t,i)=>{!0===p.getSetting("enopad3dviewer_offlineMode")?(this._platformServicesInitPromise=new Promise((e=>e())),t(e)):(this._platformServicesInitPromise=new Promise(((t,i)=>{f.app_initialization((()=>{this._retrieveSessionRoles().then(this._retrieveVISnVIOStatus.bind(this)).then(this._retrieveVDRPStatus.bind(this)).then((()=>{p.addEvent("onX3dPlatformId",(()=>{this._retrieveVISnVIOStatus(),this.getViewer()&&this.getViewer().updatePlatformPreferences()}),this),this._retrieveSecurityContext(e).then((()=>{e.readyCB||(e.readyCB=()=>{}),e.readyCB(),t(e)})).catch(i)})).catch(i)}),e.plateformServices)})),this._platformServicesInitPromise.then((()=>t(e))).catch(i),this._appUUID=C.v4(),this._readyCheckPromises.push(v.initialize({defaultAttributesJSON:"DS/ENOPAD3DViewer/assets/json/AttributesMgt.json",appAttributesJSON:e.appAttributesJSON,uuid:this._appUUID}))),p.getSetting("enopad3dviewer_getPlatformServicesInBackground")||p.getSetting("enopad3dviewer_offlineMode")||this._readyCheckPromises.push(this._platformServicesInitPromise)}))},Y.prototype._retrieveSessionRoles=function(){return this._DEBUG&&console.log("ENO3DView._retrieveSessionRoles called"),new Promise((e=>{f.getGrantedRoles((t=>{p.setSetting("enopad3dviewer_roles",t),this.publish({event:"grantedRoleRetrieved",data:p.getSetting("enopad3dviewer_roles")}),e()}))}))},Y.prototype._retrieveVISnVIOStatus=function(){return this._DEBUG&&console.log("ENO3DView._retrieveVISnVIOStatus called"),new Promise((e=>{f.getVISnVIOStatus((t=>{p.setSetting("enopad3dviewer_VISnVIOStatus",t.hasLicense),this.publish({event:"VISnVIOStatusRetrieved",data:p.getSetting("enopad3dviewer_VISnVIOStatus")}),e()}))}))},Y.prototype._retrieveVDRPStatus=function(){return this._DEBUG&&console.log("ENO3DView._retrieveVDRPStatus called"),new Promise((e=>{if(W.getSetting("eno3dview_VDRP_activate_POS")){let e=p.getSetting("enopad3dviewer_roles"),i=!1;if(e)for(var t=0;t<e.length;t++)if("POE"===e[t].id&&(!e[t].platforms||e[t].platforms&&e[t].platforms.indexOf(f.getPlatformId())>-1)){i=!0;break}i||W.setSetting("eno3dview_VDRP_activate_POS",!1)}e()}))},Y.prototype._retrieveSecurityContext=function(e){return this._DEBUG&&console.log("ENO3DView._retrieveSecurityContext called"),new Promise((e=>{let t=null!==this.getWidget()?this.getWidget().getValue("pad_security_ctx"):void 0;f.getSecurityContext((i=>{i&&i.securityContext&&i.securityContextList&&(p.setSetting("pad_security_ctx",t&&t.length>0?t:i.securityContext),p.setSetting("pad_security_ctx_list",i.securityContextList)),e()}))}))},Y.prototype._widgetLinkConfiguration=function(e){return this._DEBUG&&console.log("ENO3DView._widgetLinkConfiguration called"),new Promise(((t,i)=>{"undefined"!=typeof widget?(this.setupWidgetLink(),null!==this.getLandingPageComponent()?this.getLandingPageComponent().createLandingPage().then(t.bind(this,e)).catch(i):t(e)):t(e)}))},Y.prototype._finalizeInit=function(e){return this._DEBUG&&console.log("ENO3DView._finalizeInit called"),new Promise((t=>{this._buildSkeleton(e).then((()=>this._buildComponent(e))).then((()=>this._initPreferencesManager())).then((()=>{this._changeAction=new _({ctrl:this.getController()}),this._readyCheckPromises=[],p.getSetting("enopad3dviewer_rotateFocusMode")&&this.getViewpoint()._setFocusMode(T._FOCUS_MODE.ROTATION),this.setupLoadingBoxesEngine(),p.addEvent("onEnopad3dviewer_displayCandidateQueue",(()=>{this.setupLoadingBoxesEngine()})),p.addEvent("onEnopad3dviewer_displayCandidateQueue_color",(e=>{this.setLoadingBoxesColor(e),this.setupLoadingBoxesEngine()})),this._initSOITimelineView(),this.getController().initPointCloudStyling(),this._initR2VMinimapManager(),p.getSetting("probes_activated")&&this._trackPCS(),this._isComponentInitialized=!0,t()}))}))},Y.prototype._appReady=function(){console.warn("Deprecated : call to this API is now useless since the component now relies on onDidLoadApp to finalize the initialization of the component by itself. You can remove it.")},Y.prototype._initAppLoaded=function(e){this._DEBUG&&console.log("ENO3DView._initAppLoaded called"),e||(null!==this.getLandingPageComponent()&&null!==this.getLandingPageComponent().getLandingPage()&&(this.getLandingPageComponent().getLandingPage().setViewer(this,!0),this.getLandingPageComponent().getLandingPage().appReady()),this._buildCommandsState().then((()=>{this.publish({event:"onReady",data:this})})))},Y.prototype._buildSkeleton=function(e){return this._DEBUG&&console.log("ENO3DView._buildSkeleton called with",e),new Promise(((t,i)=>{if(this.elements.container=s.createElement("DIV"),this.getDOMElement("container").classList.add("eno3dview"),!0===f.isTouchDevice()&&this.getDOMElement("container").classList.add("touch-mode"),this.getWafrUIFrame().getViewerLayout().appendChild(this.getDOMElement("container")),p.getSetting("enopad3DViewer_enableStatusInfo")){var n=new Promise(((e,t)=>{this._platformServicesInitPromise.then((()=>{this.createStatusBar((()=>{this._setupStartupViewAutoloader({activateStartupViewAutoloader:p.getSetting("enopad3dviewer_activateStartupViewAutoloader")}),e()}),t)}))}));e.getPlatformServicesInBackground||this._readyCheckPromises.push(n)}else{if(!0===p.getSetting("enopad3dviewer_debugvisucommand"))s.createElement("span",{class:"fonticon fonticon-chart-gauge-angular enopad3dviewer_3dcontainer_debugvisuicon",id:"pad3dviewer_debugVisuCommandID"}).inject(this.elements.container).addEventListener("click",(()=>{(new X).execute()}))}this.elements.borderedLayout=s.createElement("div",{class:"eno3dview_borderedLayout"}).inject(document.body);try{if(!0===p.getSetting("eno3dview_deprecated_triptych")){console.warn("[3DEXPERIENCER2025X_FD01] ENOXTriptych is deprecated because it goes against UX guidelines, using it might expose you to conflicts between triptych and WebUXPanels, use at your own risks."),this.elements.right=s.createElement("div",{class:"enopad3Dviewer_rightTriptych rightSidePanel"});const e={left:{},container:this.getDOMElement("container"),withtransition:!0,withoverflowhidden:!0,right:{resizable:!0,originalState:"close",overMobile:!0,minWidth:250,withClose:!1}};this._triptych=new N,this._triptych.init(e,null,null,this.elements.right),this.elements.triptych=this._triptych,this._triptych.togglePanel=e=>{"left"===e?this._triptych._modelEvents.publish({event:"triptych-toggle-panel",data:"left"}):(this._triptych._modelEvents.publish({event:"triptych-toggle-panel",data:"right"}),!1===this._triptych.getRightOpen()&&this.getComponentFromIdentifier(WAfrStandardComponentKey.HandlerComponent).setCheckState({id:"ToggleRightSidePanel",state:!1}))},this._triptych._modelEvents.subscribe({event:"triptych-hide-panel"},(e=>{"left"===e&&!0===this._triptych.getLeftOpen()&&this.getComponentFromIdentifier(WAfrStandardComponentKey.HandlerComponent).setCheckState({id:"ToggleLeftSidePanel",state:!1})})),this._triptych._modelEvents.subscribe({event:"triptych-clicked-overlay"},(e=>{G.publish({event:"ENXViews/Triptych/onOverlayClick",data:e})})),this.subscribe({event:"toggleSidePanel"},this.toggleSidePanel.bind(this)),this.publish({event:"on3DTriptychReady"})}this.subscribe({event:"toggleTimelineView"},this.toggleTimelineView.bind(this)),this.subscribe({event:"togglePhoto360Mode"},this.togglePhoto360Mode.bind(this)),this.subscribe({event:"togglePointVisualization"},this.togglePointVisualization.bind(this)),this.subscribe({event:"togglePointCloudMinimap"},this.togglePointCloudMinimap.bind(this)),this.subscribe({event:"toggleDisplayRobot"},this.toggleDisplayRobot.bind(this)),this.loadSource("DS/PADServices/utils/PlatformURL").then((e=>{e.retrievePlatformUrl({addDefaults:!0,initWSAcess:!0})})),D.render({renderTo:this.getDOMElement("container")}),t()}catch(e){this._DEBUG&&console.error("ENO3DView._buildSkeleton : Something wrong happened with ENOXTriptych construction"),i(e)}}))},Y.prototype._buildComponent=function(e){return this._DEBUG&&console.log("ENO3DView._buildComponent called with",e),new Promise(((e,i)=>{const n=p.getLayout_options("frmWindow_opts")||{};this._lang&&(n.language=this._lang),this._initWebGLViewer(n).then((()=>{this._rootListPanel=new q({title:t.rootList,icon:{iconName:"list",fontIconFamily:WUXManagedFontIcons.Font3DS},immersiveFrame:this.getWafrUIFrame().getImmersiveFrame(),content:this.createRootListSlidder({noTitle:!0}),width:300,minWidth:300,height:"auto",minHeight:112,floatableFlag:!0,snappableFlag:!0,allowedDockAreas:13,verticallyStretchableFlag:!0,collapsibleFlag:!0,closeButtonFlag:!0,autoCloseFlag:!1}),this._rootListPanel.hide(),this._rootListPanel.addEventListener("close",this._hideRootListPanel.bind(this)),this._rootListPanel.immersiveFrame.dockWindow(this._rootListPanel,WUXDockAreaEnum.LeftDockArea,{attachToOtherDockedWindow:!0}),e()})).catch(i)}))},Y.prototype._initWebGLViewer=function(e){return this._DEBUG&&console.log("ENO3DView._initWebGLViewer called with",e),new Promise(((t,i)=>{const n=new Promise(((t,i)=>{this.fWInitProbe=m.createProbe("FrameWindow3D_init"),this.viewerInitProbe=m.createProbe("3DViewer_init"),p.getSetting("probes_activated")&&window.top.performance.mark(`${this._pcsPrefix}frameWindowInitBegin`);var n=p.getLayout_options("frmWindow_opts").viewerOptions;!0===p.getSetting("eno3dview_deprecated_triptych")?n.div=this._triptych.getMainPanelContainer():n.div=this.getDOMElement("container"),g._BinaryPrimitives=!0,n.executionContext=this.getExecutionContext(),this._viewer=new x(n),this._viewpoint=new T({viewer:this._viewer}),this._viewer.addViewpoint(this._viewpoint),this._viewer.setRenderMode("@Edge",!0),this._viewer.setV6Ambience(),this._viewer.setPointCloudAdvanced(!0),this._viewpoint.onMove(this._viewer.render),this._robotVisibility=e.robotVisibility,e.viewerOptions.showReferenceAxisSystem&&(this._viewer.setRobot(this._robotVisibility,{snapOnFace:!0}),this._robotVisibility&&this._viewer.getRobot().setCornerLock(!0)),this._viewer.setPicking(e.viewerOptions.highlight),this._viewer.setPrePicking(e.viewerOptions.pHighlight),this._viewer.displayPoints(!0),this.viewerInitProbe.end(),delete this.viewerInitProbe,p.getSetting("probes_activated")&&(window.top.performance.mark(`${this._pcsPrefix}frameWindowInitDone`),window.top.performance.measure(`${this._pcsPrefix}frameWindowInit`,`${this._pcsPrefix}frameWindowInitBegin`,`${this._pcsPrefix}frameWindowInitDone`)),this._initModelController(e).then((()=>{this._initHideShowController(),this._initDnD(),this._initInterwidgetCom(),this._initCSO(),this.initFindInContextColorizedSubscription(),void 0!==e.BIMode&&this.getController().toggleBetweenStandaloneAndSlaveMode(e.BIMode),setTimeout((()=>{this.publish({event:"onViewerReady",data:this}),t()}))})).catch(i)}));this._readyCheckPromises.push(n),n.then(t).catch(i)}))},Y.prototype._initModelController=function(e){this._DEBUG&&console.log("ENO3DView._initModelController called with",e),e=void 0!==e?e:{};const t=new Promise((t=>{this._controller=new A({viewer:this._viewer,context:this,selectiveLoading:!0,initializeWithWrap:!1,appOOCManagerOptions:e.OOCManagerOptions,rolePromise:this._platformServicesInitPromise,executionContext:this.getExecutionContext(),readyCB:()=>{this._registerControllerEvents(),this._registerViewEvents(),t()}})}));return this._readyCheckPromises.push(t),t},Y.prototype._initHideShowController=function(){this._DEBUG&&console.log("ENO3DView._initHideShowController called"),this.loadSource("DS/ENOPAD3DViewer/controller/PAD3DViewerHideShowController").then((e=>{this._hideShowController=new e({context:this,viewer:this._viewer}),this._registerHideShowEvents()}))},Y.prototype._initDnD=function(){this._DEBUG&&console.log("ENO3DView._initDnD called");var e=p.getSetting("dndLA")?"DS/PADUtils/views/PADDnDInviteLA":"DS/PADUtils/views/PADDnDInvite";!0!==p.getSetting("enopad3dviewer_allowDnD")||p.getSetting("activate_newDropInvite")||this.loadSource(e).then((e=>{this._dropZoneContainer=new e({renderTo:this.getDOMElement("container"),mode:"inviteWithFilter",filterActive:p.getSetting("enopad3dviewer_FilterAvailable"),dropOnInvite:this._DnDDropCB.bind(this)}),this.options.dndLA=!0===this._dropZoneContainer.options.dndLA,this._registerDnDEvents()}))},Y.prototype._initInterwidgetCom=function(){this._DEBUG&&console.log("ENO3DView._initInterwidgetCom called"),this.isInterwidgetComAvailable()&&this.loadSource("DS/PADUtils/PADCommandProxy").then((e=>{this._commandProxy=e.create({events:this._getProxyEvents()})}))},Y.prototype._initCSO=function(){this._DEBUG&&console.log("ENO3DView._initCSO called"),this.isInterwidgetComAvailable()&&this._registerCSOEvents()},Y.prototype.addRootNodesFromContent=function(e){this._DEBUG&&console.log("ENO3DView.addRootNodesFromContent called with",e),e.dispatch=void 0===e.dispatch||e.dispatch,e.inContext=void 0===e.inContext||e.inContext;let t=null;e.json3DXContent&&(t="string"==typeof e.json3DXContent?JSON.parse(e.json3DXContent):e.json3DXContent);const n=e.dndEvent?{dataTransfer:e.dndEvent.dataTransfer}:void 0;let o=!1;var s=e.dndEvent&&e.dndEvent.dataTransfer?JSON.parse(e.dndEvent.dataTransfer.getData("Text")):null;let a;e.dndEvent&&(s=f.deserializeDroppedData(e.dndEvent)),t&&t.data&&t.data.items?a=t.data.items:s.data&&s.data.items&&(a=s.data.items),!0===Q.isOpenAuthorized(a)?U.retrieveAuthorizedObjects({displayNotif:!1,behavior:e.inContext?"WITH_CONTEXT":"WITHOUT_CONTEXT",X3DContentId:t||void 0,dnd_event:n||void 0,version:"2.0",callback:t=>{if(t.unauthorized_objects.length)for(let e=0;e<t.unauthorized_objects.length;++e)if(this._loadingDelegations&&this._loadingDelegations["_"+t.unauthorized_objects[e].objectType]){(0,this._loadingDelegations["_"+t.unauthorized_objects[e].objectType])(t.unauthorized_objects[e]),o=!0}else if(this.displayNotification({msg:i.replace(i.get("unsupported_type"),{type:t.unauthorized_objects[e].displayType,name:t.unauthorized_objects[e].displayName}),eventID:"warning"}),0===this.getRoots().length&&!this._checkHiddenRoots()){G.getModelEvents().publish({event:"ENXViews/WelcomePanel/activate"})}if(0===t.authorized_objects.length)0===this.getRoots().length&&!this._checkHiddenRoots()&&this._dropZoneContainer&&this._dropZoneContainer.show("drop");else{const n=this.getRoots(),o=t.authorized_objects;f.multiTenantMgt(o,n,(n=>{if(n.isMultiTenant)t.isMultiTenant&&t.invalidTenant&&0===this.getRoots().length&&!this._checkHiddenRoots()&&this._dropZoneContainer&&this._dropZoneContainer.show("drop");else if(t.authorizedWithKind){if(t.authorizedWithKind.VDRP&&t.authorizedWithKind.VDRP.length>0){var o=!1,a=p.getSetting("enopad3dviewer_roles");if(a)for(var r=0;r<a.length;r++)if("POE"===a[r].id&&(!a[r].platforms||a[r].platforms&&a[r].platforms.indexOf(f.getPlatformId())>-1)){o=!0;break}if(o)t.authorizedWithKind.Product&&t.authorizedWithKind.Product.length>0?t.authorizedWithKind.Product=t.authorizedWithKind.Product.concat(t.authorizedWithKind.VDRP):t.authorizedWithKind.Product=t.authorizedWithKind.VDRP;else{for(let e=0;e<t.authorizedWithKind.VDRP.length;++e)this.displayNotification({msg:i.replace(i.get("unsupported_type_VDRP_no_license"),{name:t.authorizedWithKind.VDRP[e].displayName}),eventID:"warning"});0===this.getRoots().length&&!this._checkHiddenRoots()&&this._dropZoneContainer&&this._dropZoneContainer.show("drop")}}if(t.authorizedWithKind.Product&&t.authorizedWithKind.Product.length>0){const i=[];for(let n=0;n<t.authorizedWithKind.Product.length;++n){const o=t.authorizedWithKind.Product[n];Q.addToi3DXMap(o);const s=o.path&&e.inContext?o.path.map((e=>e.resourceid)):[o.objectId];i.push({path:s,serviceId:o.serviceId})}let n={};if(e.dndEvent&&e.dndEvent.dataTransfer?n=s:e.json3DXContent&&e.json3DXContent.biProxyCtx&&(n=e.json3DXContent),n.fromFilter=e.fromFilter||!1,n.biProxyCtx)return void this.getController().dropShareFilterSpec(n,e.dispatch,this.getAutomaticReframePolicy());this.addRoots({objects:i},e.dispatch)}if(t.authorizedWithKind.Filter&&t.authorizedWithKind.Filter.length>0&&(u.determineAuthoredFlag()?(this.displayNotification({eventID:"warning",msg:i.filterInAuthoring}),0===this.getRoots().length&&!this._checkHiddenRoots()&&this._dropZoneContainer&&this._dropZoneContainer.show("drop")):!0===this.getController().isStandaloneFilterAvailable()&&(this._commandProxy&&!0===e.dispatch&&this._commandProxy.dropFilter3D({droppedFilters:t.authorizedWithKind.Filter,broadcast:!1}),this.getController().retrieveFilters(t))),t.authorizedWithKind.Change&&t.authorizedWithKind.Change.length>0&&this.loadChange({objects:t.authorizedWithKind.Change}),t.authorizedWithKind.R2V&&t.authorizedWithKind.R2V.length>0){const e=[];t.authorizedWithKind.R2V.forEach((t=>{e.push(t)})),this.addR2Vs({objects:e,reframe:!0,displayNotif:!0,dispatch:!0})}}else{const i=[];for(let n=0;n<t.authorized_objects.length;++n){const o=t.authorized_objects[n],s=o.path&&e.inContext?o.path.map((e=>e.resourceid)):[o.objectId];i.push({path:s})}this.addRoots({objects:i},e.dispatch)}}))}}}):(Q.displayNotSupportedMultiSource(),0===this.getRoots().length&&!this._checkHiddenRoots()&&this._dropZoneContainer&&this._dropZoneContainer.show("drop"))},Y.prototype.addRoots=function(e,t,i){this._DEBUG&&console.log("ENO3DView.addRoot called with",e,t,i),void 0!==e.pids||void 0!==e.paths||void 0!==e.objects?(void 0===e.pids&&void 0===e.paths||console.warn("The usage of pids or paths is deprecated, please use objects"),t=void 0===t||t,i=void 0===i||i,this._controller.addRoots(e,t,i,this.getAutomaticReframePolicy())):console.error("No PIDs or paths or objects array defined")},Y.prototype.addFilter=function(e){this._DEBUG&&console.log("ENO3DView.addFilter called with",e),this._controller.addFilter(e)},Y.prototype.loadJSON=function(e,t){if(this._DEBUG&&console.log("ENO3DView.loadJSON called",e,t),!Array.isArray(e.data)||Array.isArray(e.data)&&0===e.data.length)throw new Error("No data defined");for(let t=0;t<e.data.length;++t){if("string"!=typeof e.data[t].rootID)throw new Error("No rootID defined for the data n"+(t+1));if("object"!=typeof e.data[t].structure)throw new Error("No structure defined for the data n"+(t+1))}this._controller.addRoots({structures:e.data},!1,t,this.getAutomaticReframePolicy())},Y.prototype.removeRoots=function(e,t){this._DEBUG&&console.log("ENO3DView.removeRoots called with",e),void 0!==e.pids?(this.getStatusBar()&&this.getStatusBar().clearFilter({ids:e.pids}),this._controller.removeRoots(e,t)):console.error("No PID array defined")},Y.prototype.fadeRootOut=function(e){return this._DEBUG&&console.log("ENO3DView.fadeRootOut called wtih",e),new Promise((t=>{if(void 0===e.pids)return void console.error("No PID array defined");let i=this.getHideShowController()._sceneGraphOverrideSet.getUniqueOverrideFromNodeId(e.pids[0]);i||(i=this.getHideShowController()._sceneGraphOverrideSet.createNodeIdOverride(e.pids[0]));let n=1;const o=setInterval((()=>{i.setOpacity(n,!0),n<=0&&(clearInterval(o),this.getHideShowController()._sceneGraphOverrideSet.deleteOverride(i),e.reframe=!1,this.removeRoots(e,!1),t()),n-=.05;const s=Math.pow(10,2);n=Math.round(n*s)/s,this._viewer.render({updateInfinitePlane:!0})}),50)}))},Y.prototype.empty=function(e,t){this._DEBUG&&console.log("ENO3DView.empty called with",e,t),this.getStatusBar()&&this.getStatusBar().clearFilter(),e=void 0===e||e,this._controller.flushModel(e,!1,!1,t)},Y.prototype.openStoredObjects=function(e){if(this._DEBUG&&console.log("ENO3DView.openSotredObject called with",e),e.unserializedData&&e.unserializedData.data.items.length>0){const t=f.getPlatformId();if(t)for(let i=0;i<e.unserializedData.data.items.length;++i)e.unserializedData.data.items[i].envId=t;return this.openDroppedObjects(e)}const t=(e,i,n,o)=>{void 0===n&&(n=[]);const s=Object.keys(i);for(let a=0;a<s.length;++a){const r=Object.keys(i[s[a]]);if(0===r.length){let t=[];void 0!==o&&(t=o.slice()),t.push(s[a]);const i=t.join(",");-1===n.indexOf(i)&&(n.push(i),e.push({path:t}))}else for(let l=0;l<r.length;++l){let r=[];void 0!==o&&(r=o.slice()),r.push(s[a]),t(e,i[s[a]],n,r)}}};return new Promise((n=>{const o=[];if(e.products){if(Object.getOwnPropertyNames(e.products).length){const n=new Promise((n=>{const o=H.getPromises();Promise.all(o).then((()=>{const o=[];if(t(o,e.products),o.length){if(!0===e.withFilter){const t=this.subscribe({event:"onRootAdded"},(o=>{this.unsubscribe(t),n(),u.isAuthoring()?(this.getController()._disableFilterWaiting({rootIds:[o.id]}),this.displayNotification({msg:i.filterInAuthoring,eventID:"warning"})):!0!==e.fromProxy?this._executeCommand({handlerId:"ENO3DDefineFilterCmd"}):!0===e.fromProxy&&(this._filterPanelOpen=!0,this._filterRootIds=[o.id])}))}this.addRoots({objects:o,loadWithFilter:e.withFilter},!1)}else n()}))}));n.name="AddRoots",o.push(n)}}if(e.filters){var s=Object.getOwnPropertyNames(e.filters);if(s.length){var a=new Promise((t=>{var i=H.getPromises();Promise.all(i).then((()=>{for(var i=[],n=f.getPlatformId(),o=0;o<s.length;o++)i.push({envId:n,serviceId:"3DSpace",objectId:s[o],objectType:"ENOStrRefinementSpecification"});var a={protocol:"3DXContent",version:"1.1",source:f.getAppId(),widgetId:f.getWidgetId(),data:{items:i}},r=("boolean"!=typeof e.fromAutoReload||!0!==e.fromAutoReload)&&e.broadcast;this.addRootNodesFromContent({json3DXContent:a,inContext:!1,dispatch:r}),t()}))}));a.name="AddFilters",o.push(a)}}e.pointClouds&&e.pointClouds.length&&this.addR2Vs({objects:e.pointClouds,reframe:!0,displayNotif:!0,dispatch:!0}),Promise.all(o).then((()=>{n()}))}))},Y.prototype.openDroppedObjects=function(e){return this._DEBUG&&console.log("ENO3DView.openDroppedObjects called with",e),new Promise((t=>{if("FILTER"===e.behavior||!0===e.withFilter){if(u.isAuthoring()){this.displayNotification({msg:i.filterInAuthoring,eventID:"warning"});const n=!!s.is(e.broadcast,"boolean")&&e.broadcast;return this.addRootNodesFromContent({json3DXContent:e.unserializedData,inContext:!e.behavior||"WITH_CONTEXT"===e.behavior,dispatch:n}),void t()}if(e.unserializedData.biProxyCtx){if(e.unserializedData.data.items.length>1){const t=!!s.is(e.broadcast,"boolean")&&e.broadcast;this.addRootNodesFromContent({json3DXContent:e.unserializedData,inContext:!e.behavior||"WITH_CONTEXT"===e.behavior,dispatch:t,fromFilter:!0})}else this.loadSource("DS/ENOPAD3DViewer/commands/PAD3DViewerFilterDropObjectsCmd").then((i=>{const n=new i;n.execute(e.unserializedData,!0,!0),t(n&&e.unserializedData?void 0:{error:"noCommandAvailable"})})).catch((e=>{console.error(e)}));return void t()}this.loadSource("DS/ENOPAD3DViewer/commands/PAD3DViewerFilterDropObjectsCmd").then((i=>{const n=new i;n.execute(e.unserializedData,e.fromProxy,!0),t(n&&e.unserializedData?void 0:{error:"noCommandAvailable"})})).catch((e=>{console.error(e)}))}else{const i="boolean"==typeof e.broadcast&&e.broadcast;this.addRootNodesFromContent({json3DXContent:e.unserializedData,inContext:!e.behavior||"WITH_CONTEXT"===e.behavior,dispatch:i}),t()}}))},Y.prototype._openObjectsFromWL=function(e){if(this._DEBUG&&console.log("ENO3DView._openObjectsFromWL called with",e),!e.filter)return this.openDroppedObjects(e);{let i=0,n=[];const o=t=>{for(let e=0;e<n.length;++e)this.getController().getBIProxy().removeEvent(n[e]);if(0===t.status&&null!==t.error)this.displayNotification({eventID:t.error.level,title:t.error.title,msg:t.error.message});else{if("APPLY"===e.filter.intent){const e=this.subscribe({event:"onRootAdded"},(()=>{this.unsubscribe(e),G.getModelEvents().publish({event:"ENXViews/WelcomePanel/closeLandingPage"})}));return}e.withFilter=!0,this.openDroppedObjects(e)}},s=e.unserializedData.data.items;for(let a=0;a<s.length;++a){var t=`DroppedFilterSpec-${a}`;n.push(t),this.getController().getBIProxy().addEvent(t,(e=>{++i,i===s.length&&o(e)})),this.getController().getBIProxy().setPublicFilterSpecification({rootId:s[a].objectId,rootAlias:s[a].displayName,specification:e.filter.specification,applyFilter:"APPLY"===e.filter.intent?1:0,displayFilter:"WAIT"===e.filter.intent?1:0,eventName:t})}}},Y.prototype.buildStructure=function(e,t,i,n){this._DEBUG&&console.log("ENO3DView.buildStructure called with",e,t,i,n);let o=0;for(let s in e){let a=[];!0===t[s].selected&&(0===n.length||n.length>0&&-1!==n.indexOf(t[s].nodeId))?i.push({id:t[s].idx,show:t[s].show,select:t[s].selected,children:[]}):i.push({id:t[s].idx,show:t[s].show,children:[]}),a=this.buildStructure(e[s],t,i[o].children,n),a&&i.push({children:a}),++o}},Y.prototype.refresh=function(e,t){this._DEBUG&&console.log("ENO3DView.refresg called with",e),e=void 0===e||e,this._controller.refresh(e,t||null)},Y.prototype.search=function(e){this._DEBUG&&console.log("ENO3DView.search called with",e),"string"==typeof e.searchQuery&&this.loadSource("DS/PADServices/utils/PredefinedQueryUtils").then((t=>{t.isPredefinedQry(e.searchQuery).then((t=>{e.searchQuery=t,this._controller.search(e)}))}))},Y.prototype.onViewChanged=function(e){this._DEBUG&&console.log("ENO3DView.onViewChanged called"),"minimized"===e?this.freezeProgressiveLoading():this.unfreezeProgressiveLoading()},Y.prototype.freezeProgressiveLoading=function(){this._DEBUG&&console.log("ENO3DView.freezeProgressiveLoading called"),this.getController().pauseProgressiveLoading(),this.getStatusBar()&&this.getStatusBar().disableProgress()},Y.prototype.unfreezeProgressiveLoading=function(){this._DEBUG&&console.log("ENO3DView.unfreezeProgressiveLoading called"),this.getController().resumeProgressiveLoading(),this.getStatusBar()&&this.getStatusBar().enableProgress()},Y.prototype.loadChange=function(e){this._DEBUG&&console.log("ENO3DView.loadChange called with",e),this._changeAction&&this._changeAction.loadChange({app:this,changes:e.objects})},Y.prototype.author=function(e){this._DEBUG&&console.log("ENO3DView.author called with",e);let t=!0;"boolean"==typeof e&&(t=e),this._controller.switchAuthoringMode(e)},Y.prototype.addR2Vs=function(e){return this._DEBUG&&console.log("ENO3DView.addR2Vs called with",e),new Promise((t=>{this._controller.addR2Vs(e).then(t)}))},Y.prototype._checkHiddenRoots=function(){this._DEBUG&&console.log("ENO3DView._checkHiddenRoots called");return 0!==(this._controller.getHiddenRootIds()?this._controller.getHiddenRootIds().length:0)},Y.prototype.activateCurrentLayout=function(){},Y.prototype.deactivateCurrentLayout=function(e){},Y.prototype.changeVisuModeCmdAvailability=function(e){console.error("ENO3DView.changeVisuModeCmdAvailability : This method is not anymore exposed and won't perform anything.")},Y.prototype.streamPath=function(e){return this._DEBUG&&console.log("ENO3DView.streamPath called with",e),this._controller.buildArrayFromPath(e)},Y.prototype.streamPathWithType=function(e,t,i,n,o){return this._DEBUG&&console.log("ENO3DView.streamWithType called with",e,t,i,n,o),this._controller.buildArrayFromPathWithType(e,t,i,n,o)},Y.prototype.streamPOI=function(e,t,i){return this._DEBUG&&console.log("ENO3DView.streamPOI called with",e,t,i),this.getController().streamPOI(e,t,i)},Y.prototype.streamPOIGroup=function(e,t){return this._DEBUG&&console.log("ENO3DView.streamPOIGroup called with",e,t),this.getController().streamPOIGroup(e,t)},Y.prototype.streamZOI=function(e,t){return this._DEBUG&&console.log("ENO3DView.streamZOI called with",e,t),this.getController().streamZOI(e,t)},Y.prototype.unstreamPath=function(e,t){return this._DEBUG&&console.log("ENO3DView.unstreamPath called with",e,t),this._controller.buildPathFromArray(e,t)},Y.prototype.unstreamVDRPPath=function(e,t){return this._DEBUG&&console.log("ENO3DView.unstreamVDRPPath called with",e,t),this._controller.buildVDRPPathFromVDRPArray(e,t)},Y.prototype.enableHybridDatasetLoading=function(){if(!0===this._hasASPRole()){const e=p.getWebAPI_Options("navigate3D");-1===e.select_bo.indexOf("bo.vpmpointcloudidentifierext.v_pointcloudidentifier")&&(e.select_bo.push("bo.vpmpointcloudidentifierext.v_pointcloudidentifier"),p.setWebAPI_Options("navigate3D",e),p.setWebAPI_Options("volumeQuery",e))}},Y.prototype.disableHybridDatasetLoading=function(){if(!0===this._hasASPRole()){const e=p.getWebAPI_Options("navigate3D");if(-1!==e.select_bo.indexOf("bo.vpmpointcloudidentifierext.v_pointcloudidentifier")){const t=e.select_bo.indexOf("bo.vpmpointcloudidentifierext.v_pointcloudidentifier");e.select_bo.splice(t,1),p.setWebAPI_Options("navigate3D",e),p.setWebAPI_Options("volumeQuery",e)}}},Y.prototype._hasASPRole=function(){const e=p.getSetting("enopad3dviewer_roles");if(e)for(let t=0;t<e.length;++t)if("ASP"===e[t].id&&(!e[t].platforms||e[t].platforms&&e[t].platforms.indexOf(f.getPlatformId())>-1))return!0;return!1},Y.prototype.set3DXContentData=function(e){if(this._DEBUG&&console.log("ENO3DView.set3DXContentData called with",e),!Array.isArray(e.nodes2Open))throw new Error("set3DXContentData: Invalid init parameter nodes2Open");const t=s.is(widget)&&widget.id?`padcompassSocket_${widget.id}`:"padcompassSocket";if(null===this._padintercom&&(this._padintercom=new F.Socket(t),this._padintercom.subscribeServer("com.ds.compass",window.parent)),0===e.nodes2Open.length)this._padintercom.dispatchEvent("onResetX3DContent",{},t);else{const n={protocol:"3DXContent",version:"2.1",source:widget&&widget.getValue("x3dAppId")?widget.getValue("x3dAppId"):"ENOSTDE_AP",data:{items:[]}},o=t=>{const i=[];for(let n=0;n<t.length;++n)i.push({resourceid:t[n],type:e.selectedPaths.attributes[t[n]].type,i3dx:null!==e.selectedPaths.attributes[t[n]].i3dx?e.selectedPaths.attributes[t[n]].i3dx:""});return i};for(let t=0;t<e.selectedPaths.paths.length;++t){const s=e.selectedPaths.paths[t];let a=null;this.getController().getRootStats&&this.getController().getRootStats(s[0])&&(a=this.getController().getRootStats(s[0]).serviceId);const r=s[s.length-1];var i={envId:f.getPlatformId(),serviceId:a||"3DSpace",contextId:p.getSetting("pad_security_ctx")?p.getSetting("pad_security_ctx"):void 0,objectId:r,objectType:e.selectedPaths.attributes[r].type,path:o(s),i3dx:e.selectedPaths.attributes[r].i3dx};n.data.items.push(i)}this._padintercom.dispatchEvent("onSetX3DContent",n,t)}},Y.prototype.setTypesFor3D=function(e){this._DEBUG&&console.log("ENO3DView.setTypesFor3D called with",e),K||(z.subscribe("setTypesCallback",(t=>{if(t.widgetId===f.getWidgetId()){const i=[],n={},o=[],s=[],a=[],r=R.get(),l=this.getController()._model.getRootBag(),h=[],d={version:"1.1",paths:i,attributes:n},c=this.getRoots();for(let e=0;e<c.length;++e)h.push(k.getNodeID(c[e]));for(let e=0;e<r.length;++e)if(k.isAModelPath(r[e].pathElement)){let t=r[e].pathElement,s=t.getLastElement(!0);const d=k.getNodeID(s);if(-1!==h.indexOf(d)&&i.push([d]),k.is3DLeaf(s))this.streamPathWithType(r[e].pathElement,i,n);else{if(k.isPLMNode(s)){const e={};s.traverse((i=>{if(k.is3DLeaf(i)){const s=k.getNodeID(i);if(s&&!e[s]){e[s]=!0;const a=j.buildPathesLeadingToNode(i,l);for(let e=0;e<a.length;++e){var n=a[e];t.isAParentOf(n)&&o.push(n)}}}}))}else{for(;!k.is3DLeaf(s);)t=t.getParentPath(),s=t.getLastElement(!0);o.push(t)}for(let e=0;e<o.length;++e)this._hideShowController.isVisible(o[e])||a.push(k.getNodeID(o[e].getLastElement(!0))),this.streamPathWithType(o[e],i,n)}}if(i)for(let e=0;e<i.length;++e){const t=i[e];s.push(t[t.length-1])}this.setTypesForOFW({nodes2Open:s,hiddenNodes:a,selectedPaths:d},(i=>{const n=this.getViewpoint(),o=L.buildViewPoint(n);null!==o&&i.viewpoint.push(o),e.changeControl&&(i.workUnder=e.changeControl),z.publish("launchApp",{appId:t.appId,widgetId:t.widgetId,fileName:"-file",fileContent:JSON.stringify(i)})}))}})),K=!0);const t={widgetId:widget.id};R.get().length>0?z.publish("setTypes",t):z.publish("resetType")},Y.prototype.setTypesForOFW=function(e,t){if(this._DEBUG&&console.log("ENO3DView.setTypesForOFW called with",e,t),!Array.isArray(e.nodes2Open))throw new Error("settypes_open_in_web: Invalid init parameter nodes2Open");const i=s.clone({version:"2.0",results:[],structures:[],viewpoint:[]}),n=[],o=[];let a,r="",l=1,h=0;const d={},c={},p=[],u=t=>-1!==e.nodes2Open.indexOf(t),m=t=>-1===e.hiddenNodes.indexOf(t),g=e=>{const t=d[e];t&&(s.is(a[t.localid])||(a[t.localid]={}),a=a[t.localid])};for(let t=0;t<e.selectedPaths.paths.length;++t){const s=e.selectedPaths.paths[t];1===s.length&&p.push(s[0]);for(let e=0;e<s.length;++e)r=s[e],-1===n.indexOf(r)&&(i.results.push({id:l.toString(),phid:r}),d[r]={idx:l,localid:h},c[h]={idx:l.toString(),nodeId:r,show:m(r),selected:u(r)},++l,++h,n.push(r));a=o,s.forEach(g)}for(var _ in o){const e=[];let t=[];!0===c[_].selected&&(0===p.length||p.length>0&&-1!==p.indexOf(c[_].nodeId))?e.push({id:c[_].idx,show:c[_].show,select:c[_].selected,children:[]}):e.push({id:c[_].idx,show:c[_].show,children:[]}),t=this.buildStructure(o[_],c,e[0].children,p),t&&e.push({children:t}),i.structures.push({structure:e})}t(i)},Y.prototype.set3DStructure4OpenInCV5=function(e){console.warn("3DEXPERIENCE R2024X FD01 - Deprecated, setTypes must be used instead")},Y.prototype.getNGFUXID=function(e){this._DEBUG&&console.log("ENO3DView.getNGFUXID called with",e);const t="undefined"!=typeof widget&&widget.id?widget.id:"fakeWidgetIDFallback";let i;return i=p.getSetting("activateWidgetLink")?Z.getSourceWidgetId()&&Z.getSyncFeature("Content")&&e?Z.getSourceWidgetId():t:f.getSharedId(),i},Y.prototype.setCurrentLayout=function(e){},Y.prototype.getLevelSelectorCommand=function(e){return this._DEBUG&&console.log("ENO3DView.getLevelSelectorCommand called with",e),console.error("ENO3DView.getLevelSelectorCommand : This method is not anymore exposed and won't perform anything."),new Error("ENO3DView.getLevelSelectorCommand : This method is not anymore exposed and won't perform anything.")},Y.prototype.render=function(){return this._DEBUG&&console.log("ENO3DView.render called"),!0===p.getSetting("eno3dview_deprecated_triptych")?this._triptych:this.getDOMElement("container")},Y.prototype._trackPCS=function(){this._DEBUG&&console.log("ENO3DView._trackPCS called")},Y.prototype.canBeParallelized=function(){return this._DEBUG&&console.log("ENO3DView.canBeParallelized called"),!1},Y}));