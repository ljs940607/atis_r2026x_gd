define("DS/SocialGlobeServices/i3DDashboard/i3DDriveServices",["UWA/Core","UWA/Promise","DS/WAFData/WAFData","DS/i3DXCompassServices/i3DXCompassServices"],(function(e,t,n,r){"use strict";const o="/resources/3ddrive/v1/bos/",i="/fileurl",a="/ticket",s="/contents";function u(e,r,o){var i=new FormData;i.append("__fcs__jobTicket",e.ticket),i.append("file-name",r.name),i.append("file-title",r.name),i.append("file-description",""),i.append("file",r),i.append("__fcs__nohtml",!0);var a=e.actionurl;return a=c(a,o),new t((function(e,t){var r={method:"POST",type:"form-data",data:i,onComplete:e,onFailure:t};n.authenticatedRequest(a,r)}))}function c(e,t){return-1===e.indexOf("?")?e+"?tenant="+t:e+"&tenant="+t}function l(r,i){var s=function(e,r){var i=e+o+a.replace("/","");return i=c(i,r),new t((function(e,t){var r={method:"GET",type:"json",onComplete:function(t,n){e({data:t,csrf:n["x-ds-csrftoken"]})},onFailure:t};n.authenticatedRequest(i,r)}))}(r,i).then((function(n){var r=n.data;return e.is(r,"object")?e.is(r.ticket,"string")&&""!==r.ticket?e.is(r.jobticket,"string")&&""!==r.jobticket?e.is(r.actionurl,"string")&&""!==r.actionurl?t.resolve(n):t.reject(new Error("Invalid value for attribute 'actionurl' found in response")):t.reject(new Error("Invalid value for attribute 'jobticket' found in response")):t.reject(new Error("Invalid value for attribute 'ticket' found in response")):t.reject(new Error("Invalid response type (should be an object)"))}));return s}function d(n,r,o,i){return u(n,new File([r],o),i).then((function(n){return e.is(n,"string")?t.resolve(n):t.reject(new Error("Invalid response type (should be an string)"))}))}function v(r,i,a,u,l,d){var v=function(e,r,i,a,u,l){var d=e+o+a+s;d=c(d,u);var v={type:"DriveFile",title:i,receipt:r.trim()};return new t((function(e,t){var r={method:"POST",type:"json",headers:{"Content-Type":"application/json;charset=UTF-8",Accept:"application/json,text/javascript","X-DS-CSRFTOKEN":l},data:JSON.stringify(v),onComplete:function(t){e({data:t,csrf:l})},onFailure:function(e,n,r){t({error:e,data:n,headers:r})}};n.authenticatedRequest(d,r)}))}(r,i,a,u,l,d).then((function(n){return e.is(n,"object")?t.resolve(n):t.reject(new Error("Invalid response type (should be an object)"))}));return v}var p={url3DDrive:"",i3DXplatformServices:{},addTenantId:c,retrieve3DDriveUrl:function(n){return function(e){return new t((function(t,n){r.getServiceUrl({serviceName:"3DDrive",platformId:e,onComplete:t,onFailure:n})}))}(n).then((function(n){return e.is(n,"string")&&""!==n?(p.url3DDrive=n,p.i3DXplatformServices["3DDrive"]=n,t.resolve(p.url3DDrive)):t.reject(new Error("Unable to retrieve 3DDrive service URL."))}))},retrieveDocumentTypes:function(r,i,a){return function(e,r,i){var a=e+o+r;return a=c(a,i),new t((function(e,t){var r={method:"GET",type:"json",onComplete:e,onFailure:t};n.authenticatedRequest(a,r)}))}(r,i,a).then((function(n){return e.is(n,"object")?e.is(n.id,"string")&&""!==n.id?e.is(n.extension,"string")&&""!==n.extension?t.resolve({extension:n.extension,driveUrl:r}):t.reject(new Error("Invalid value for attribute 'extension' found in response")):t.reject(new Error("Invalid value for attribute 'id' found in response")):t.reject(new Error("Invalid response type (should be an object)"))}))},retrieveDocumentURL:function(r,a,s){return function(e,r,a){var s=e+o+r+i;return s=c(s,a),new t((function(e,t){var r={method:"GET",type:"json",onComplete:e,onFailure:t};n.authenticatedRequest(s,r)}))}(r,a,s).then((function(n){return e.is(n,"object")?e.is(n.url,"string")&&""!==n.url?e.is(n.extension,"string")&&""!==n.extension?t.resolve(n.url):t.reject(new Error("Invalid value for attribute 'extension' found in response")):t.reject(new Error("Invalid value for attribute 'url' found in response")):t.reject(new Error("Invalid response type (should be an object)"))}))},retrieveDocumentContent:function(e,r){var o=e;return o=c(o,r),new t((function(e,t){var r={method:"GET",type:"text",onComplete:e,onFailure:t};n.authenticatedRequest(o,r)}))},retrieveDriveTicket:l,uploadFileInFCS:function(n,r,o){return u(n,r,o).then((function(n){return e.is(n,"string")?t.resolve(n):t.reject(new Error("Invalid response type (should be an string)"))}))},uploadContentInFCS:d,createFileIn3DDrive:v,getItemsListIn3DDriveFolder:function(r,i,a){return function(e,r,i){var a=e+o+r+s;return a=c(a,i),new t((function(e,t){var r={method:"GET",type:"json",onComplete:e,onFailure:t};n.authenticatedRequest(a,r)}))}(r,i,a).then((function(n){return e.is(n,"object")?t.resolve(n):t.reject(new Error("Invalid response type (should be an object)"))}))},deleteFileFromDrive:function(r,i,a,s){return function(e,r,i,a){var s=e+o+r;return s=c(s,i),new t((function(e,t){var r={method:"DELETE",type:"json",headers:{"X-DS-CSRFTOKEN":a},onComplete:e,onFailure:t};n.authenticatedRequest(s,r)}))}(r,i,a,s).then((function(n){return e.is(n,"object")?t.resolve(n):t.reject(new Error("Invalid response type (should be an object)"))}))},uploadFileInDriveCompleteProcess:function(e,t,n,r,o){var i;return l(e,o).then((function(e){var r=e.data;return i=e.csrf,d(r,t,n,o)})).then((function(t){return v(e,t,n,r,o,i)}))}};return p})),define("DS/SocialGlobeServices/Passport/iPassportServices",["UWA/Core","UWA/Promise","DS/WAFData/WAFData"],(function(e,t,n){"use strict";function r(e){return new t((function(t,r){var o=e+"/3DPassport/login?action=get_auth_params";n.authenticatedRequest(o,{method:"GET",type:"json",onComplete:t,onFailure:r})}))}function o(e,r,o,i,a){return new t((function(t,s){var u=e+"/3DPassport/login";a&&(u+="?service="+encodeURIComponent(a));var c={lt:encodeURIComponent(i),username:encodeURIComponent(r),password:encodeURIComponent(o)};n.authenticatedRequest(u,{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},data:c,onComplete:t,onFailure:s})}))}return{getAuthentificationParameters:r,postLoginForm:o,authenticateToPassport:function(n,i,a){return r(n).then((function(n){var r=n.lt;return e.is(r,"string")&&""!==r?t.resolve(r):t.reject(new Error("Invalid lt"))})).then((function(e){return o(n,i,a,e)}))},authenticateToService:function(n,i,a,s){var u=this;return r(n).then((function(n){var r=n.lt;return e.is(r,"string")&&""!==r?t.resolve(r):t.reject(new Error("Invalid lt"))})).then((function(e){return u.lt=e,o(n,i,a,e)})).then((function(){return o(n,i,a,u.lt,s)}))}}})),define("DS/SocialGlobeServices/Geocoding/GeocodingServices",["UWA/Core","UWA/Promise","DS/WAFData/WAFData","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/SocialGlobeServices/Passport/iPassportServices"],(function(e,t,n,r,o){"use strict";function i(e,t,r,o,a,u,c){var l,d=r,v="q="+e;if(void 0!==o){o=s(o);let e=Object.keys(o);for(let t=0;t<e.length;t++)v+="&"+e[t]+"="+o[e[t]]}else v+="&polygon_geojson=1&format=jsonv2";var p={method:"GET",type:"json",data:v=(v+="&tenant="+t).replace(/\s/g,"%20"),headers:{"Content-Type":"application/json"},onComplete:function(e){a(e)},onFailure:function(n){429==l.xhr.status&&c<5?setTimeout(i.bind(this,e,t,r,a,u,++c),1e3):u(n)}};l=n.authenticatedRequest(d,p)}function a(e,t,r,o,i,u,c,l,d){var v,p=u,f="lat="+e+"&lon="+t+"&zoom="+r;if(void 0!==o){o=s(o);let e=Object.keys(o);for(let t=0;t<e.length;t++)f+="&"+e[t]+"="+o[e[t]]}else f+="&format=jsonv2";var m={method:"GET",type:"json",data:f=(f+="&tenant="+i).replace(/\s/g,"%20"),headers:{"Content-Type":"application/json"},onComplete:function(e){c(e)},onFailure:function(n){429==v.xhr.status&&d<5?setTimeout(a.bind(this,e,t,r,i,u,c,l,++d),1e3):l(n)}};v=n.authenticatedRequest(p,m)}function s(e){var t=["format","limit","addressdetails","accept-language"],n={};let r=Object.keys(e);for(let o=0;o<r.length;o++)t.includes(r[o])&&(n[r[o]]=e[r[o]]);return n}var u={retrieveGeocodingUrl:function(n){var o={};return function(e){return new t((function(t,n){r.getServiceUrl({serviceName:"geocoding",platformId:e,onComplete:t,onFailure:n})}))}(n).then((function(n){return e.is(n,"string")&&""!==n?(u.urlGeocoding=n,o.urlGeocoding=n,t.resolve(u.urlGeocoding)):t.reject(new Error("Unable to retrieve Geocoding service URL."))}))},addTenantId:function(e,t){return-1===e.indexOf("?")?e+"?tenant="+t:e+"&tenant="+t},geocoding:function(e,n,r,o){return new t((function(t,a){i(e,n,r,o,t,a,0)}))},stucturedGeocoding:function(e,r,o){return new t((function(t,a){!function(e,t,r,o,a,s){var u,c=r,l="";l+="&street="+(e.street?e.street:""),l+="&city="+(e.city?e.city:""),l+="&county="+(e.county?e.county:""),l+="&state="+(e.state?e.state:""),l+="&country="+(e.country?e.country:""),l+="&postalcode="+(e.postalcode?e.postalcode:""),l+="&polygon_geojson=1&format=jsonv2",l+="&tenant="+t;var d={method:"GET",type:"json",data:l=l.replace(/\s/g,"%20"),headers:{"Content-Type":"application/json"},onComplete:function(e){o(e)},onFailure:function(n){429==u.xhr.status&&s<5?setTimeout(i.bind(this,e,t,r,o,a,++s),1e3):a(n)}};u=n.authenticatedRequest(c,d)}(e,r,o,t,a,0)}))},reverseGeocoding:function(e,n,r,o,i,s){return new t((function(t,u){a(e,n,r,o,i,s,t,u,0)}))}};return u})),define("DS/SocialGlobeServices/MapNavigator/MapNavigatorServices",["UWA/Core","UWA/Promise","DS/WAFData/WAFData","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/SocialGlobeServices/Passport/iPassportServices"],(function(e,t,n,r,o){"use strict";function i(e,t){return-1===e.indexOf("?")?e+"?tenant="+t:e+"&tenant="+t}return{urlMap:"",i3DXplatformServices:{},retrieveMapUrl:async function(o,a){try{const s=await function(e,n=3e3){const r=new t(((e,t)=>{setTimeout((()=>t(new Error("Timeout"))),n)}));return t.race([e,r])}(function(e){return new t((function(t,n){r.getServiceUrl({serviceName:"map",platformId:e,onComplete:t,onFailure:n})}))}(o));if(!e.is(s,"string")||""===s)throw new Error("Unable to retrieve Map service URL.");return await function(e,r,o){return new t(((t,a)=>{let s=e+`/resources/map/login?appid=${o}`;const u={method:"GET",type:"application/xml",onComplete:t,onFailure:a};s=i(s,r),n.authenticatedRequest(s,u)}))}(s,o,a),s}catch(e){throw new Error("Error retrieving map service URL: "+e)}},addTenantId:i,get2dTmsUrl:function(e,t){return e+"/resources/map/tms/1.0.0/globe_2d/"},get3dTmsUrl:function(e,t){return e+"/resources/map/tms/1.0.0/globe_3d/"}}}));