var EnoPanelLayout={Vertical:0,Horizontal:1};Object.freeze(EnoPanelLayout),define("DS/AdvancedView/views/ToolsPanel",["UWA/Controls/Abstract","DS/Windows/Panel","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls","css!DS/AdvancedView/AdvancedView"],(function(e,t,n){"use strict";return e.extend({defaultOptions:{initialDockArea:WUXDockAreaEnum.RightDockArea},init:function(e){var n=this;window.c145ae486a7011e9a9231681be663d3e&&(e.identifier=void 0),this._parent(e),this._initializedUI=!1,this.model=this.options.model,this.immersiveFrame=this.options.immersiveFrame,this.panel=new t({identifier:e.identifier,title:this.getTitle(),content:this.getContent(),currentDockArea:this.options.initialDockArea,immersiveFrame:this.immersiveFrame,resizableFlag:!1,allowedDockAreas:this.options.dockAreas||WUXDockAreaEnum.LeftDockArea|WUXDockAreaEnum.RightDockArea|WUXDockAreaEnum.TopDockArea,closeButtonFlag:!1}),this.panel.addEventListener("prePlaceChange",(function(e){n._onPrePlaceChange(e),n.onPrePlaceChange(e)})),this.panel.addEventListener("startWindowDrag",(function(e){n.onStartWindowDrag(e)})),this._initialUpdate(this._currentLayout())},getContent:function(){return new UWA.Element("div",{html:"<p>TODO:Panel content</p>"})},getTitle:function(){return"panel title"},haveStoredPlacement:function(){return null!=this.panel._getPositionFromPreferences()},dock:function(e){this.immersiveFrame.dockWindow(this.panel,e)},onStartWindowDrag:function(e){},onPrePlaceChange:function(e){},_onPrePlaceChange:function(e){var t=this._isVerticalLayout(e.dsModel.currentDockArea)?EnoPanelLayout.Vertical:EnoPanelLayout.Horizontal;this._initializedUI?this._isVerticalLayout(e.dsModel.currentDockArea)!=this._isVerticalLayout(e.options.previousPlace.currentDockArea)&&this._setLayout(t):(this._initialUpdate(t),this._initializedUI=!0)},_currentLayout:function(){return this._isVerticalLayout(this.panel.currentDockArea)?EnoPanelLayout.Vertical:EnoPanelLayout.Horizontal},_isHorzLayout:function(e){return e==WUXDockAreaEnum.TopDockArea||e==WUXDockAreaEnum.BottomDockArea},_isVerticalLayout:function(e){return!this._isHorzLayout(e)},_setLayout:function(e){},_initialUpdate:function(e){}})})),define("DS/AdvancedView/utils/RegExReplace",[],(function(){"use strict";return{replace:function(e,t,n){return e.replace(new RegExp(function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}(t),"gi"),n)}}}));var EnoTitleSelectionCriteria={Undefined:0,Contains:1,NotContains:2};define("DS/AdvancedView/models/SelectionModel",["UWA/Controls/Abstract"],(function(e){"use strict";return e.extend({TitleCriteria:EnoTitleSelectionCriteria.Contains,TitleString:"",TypeMatch:[],StateMatch:[],_TypeSelected:[],_StateSelected:[],addSelection:function(){this.dispatchEvent("OnAddSelection",this)},removeSelection:function(){this.dispatchEvent("OnRemoveSelection",this)},clearSelection:function(){this.dispatchEvent("OnClearSelection")}})})),define("DS/AdvancedView/utils/UpdateSelectionModelVStrategy",["UWA/Controls/Abstract"],(function(e){"use strict";return e.extend({init:function(e){this._parent(e),this.controls={},this.controls.titleEdit=e.idns.getElById("titleEdit"),this.controls.containsRadio=e.idns.getElById("containsRadio"),this.controls.notContainsRadio=e.idns.getElById("notContainsRadio")},getGroupMatch:function(e){return this.options.groupList.getIsGroupUnused(e)?this.options.groupList.getGroupAll(e):this.options.groupList.getGroupSelected(e)},_getGroupSelected:function(e){return this.options.groupList.getGroupSelected(e)},updateUIFromModel:function(e){var t=e.TitleCriteria;this.options.groupList.setGroupSelected("type",e._TypeSelected),this.options.groupList.setGroupSelected("state",e._StateSelected),this.controls.titleEdit.wuxControl.value=e.TitleString,this.controls.containsRadio.wuxControl.checkFlag=t===EnoTitleSelectionCriteria.Contains,this.controls.notContainsRadio.wuxControl.checkFlag=t===EnoTitleSelectionCriteria.NotContains}})})),define("DS/AdvancedView/controls/PopupControl",["UWA/Controls/Abstract","DS/WidgetServices/WidgetServices"],(function(e,t){"use strict";return e.extend({name:"PopupControl",defaultOptions:{createContent:function(){return UWA.createElement("div")}},init:function(e){this._parent(e),this.createPopupContent=this.options.createContent;var n=t.getWidgetBody(),i=n.getParent("body");this.parentBody=i||n},showPopup:function(e){this.container=this.container||this._createUI();var t=this;this._positionPopup(e.parentEl),setTimeout((function(){t._showPopup()}),50)},_createUI:function(){var e=UWA.merge({position:"absolute",display:"none",top:0,left:0,"z-index":99999,background:"green",borderWidth:"1px",borderColor:"#d0c0c0",borderStyle:"solid"},this.options.styles),t=UWA.createElement("div",{class:this.getClassNames("_container"),styles:e});this.createPopupContent().inject(t),t.inject(this.parentBody);var n=this;return this.parentBody.addEvent("click",(function(e){n.currentPopup&&!n.currentPopup.contains(e.target)&&n._hidePopup()})),t},hidePopup:function(){this._hidePopup()},_positionPopup:function(e){var t=e.getBoundingClientRect();this.container.setStyle("left",t.left+"px"),this.container.setStyle("top",t.top+t.height+"px")},_showPopup:function(){this.currentPopup=this.container,this.container.setStyle("display","block");var e=this;setTimeout((function(){e.dispatchEvent("onShow",e.currentPopup)}),10)},_hidePopup:function(){this.currentPopup&&(this.dispatchEvent("onHide",this.currentPopup),this.currentPopup.setStyle("display","none"),this.currentPopup=null)}})})),define("DS/AdvancedView/utils/UpdateSelectionModelHStrategy",["UWA/Controls/Abstract"],(function(e){"use strict";return e.extend({init:function(e){this._parent(e),this.controls={},this.controls.titleEdit=e.idns.getElById("titleEditH"),this.controls.containsRadio=e.idns.getElById("containsRadioH"),this.controls.notContainsRadio=e.idns.getElById("notContainsRadioH")},getGroupMatch:function(e){return this.options.groupList.getIsGroupUnused(e)?this.options.groupList.getGroupAll(e):this.options.groupList.getGroupSelected(e)},_getGroupSelected:function(e){return this.options.groupList.getGroupSelected(e)},updateUIFromModel:function(e){var t=e.TitleCriteria;this.options.groupList.setGroupSelected("type",e._TypeSelected),this.options.groupList.setGroupSelected("state",e._StateSelected),this.controls.titleEdit.wuxControl.value=e.TitleString,this.controls.containsRadio.wuxControl.checkFlag=t===EnoTitleSelectionCriteria.Contains,this.controls.notContainsRadio.wuxControl.checkFlag=t===EnoTitleSelectionCriteria.NotContains}})}));var AdvancedViewEvents={includeAllDrwOptionSet:"duplicate.incdrw.option.set",includeAllDrwOptionOnChange:"duplicate.incdrw.option.change",includeAllDesignTablesOptionOnChange:"duplicate.incdt.option.change",displayDuplicateAlert:"Lifecycle.Duplicate.Alert"};define("DS/AdvancedView/WidgetEvents",[],(function(){return{}})),define("DS/AdvancedView/UIUpdate",["UWA/Controls/Abstract"],(function(e){"use strict";return e.extend({init:function(){this.elements=[]},addElement:function(e,t){var n=null;"function"==typeof t.enable?n=t.enable:"function"==typeof t&&(n=t),this.elements.push({element:UWA.is(UWA.Element,e)?e:UWA.extend(e),enable:n})},update:function(e){this.elements.forEach((function(t){t.enable&&(t.element.wuxControl?t.element.wuxControl.disabled=!t.enable(e):t.element.disabled=!t.enable(e))}))}})}));var GrpSelListNodeType={GroupRoot:1,GroupEntry:2},GrpNodeChecked={Checked:1,Unchecked:2,Mixed:3};define("DS/AdvancedView/controls/GroupSelectionList",["UWA/Controls/Abstract","DS/Controls/Toggle"],(function(e,t){"use strict";var n=e.extend({name:"groupSelectionListNode",defaultOptions:{label:"",id:"you must set id",checked:!0},init:function(e){this.children=[],this._parent(e),this.type=this.options.type,this.label=this.options.label,this.id=this.options.id,this.checked=this.options.checked?GrpNodeChecked.Checked:GrpNodeChecked.Unchecked,this._isSyncing=!1,this._buildLayout()},addChild:function(e){var t=this;this.children.push(e),e.addEvent("onChecked",(function(e){t._syncCheck()}))},getSelected:function(){return this.children.filter((function(e){return e.checked===GrpNodeChecked.Checked})).map((function(e){return e.id}))},getAll:function(){return this.children.map((function(e){return e.id}))},getIsUnused:function(){return this.type===GrpSelListNodeType.GroupRoot&&this.checked===GrpNodeChecked.Unchecked},setSelected:function(e){this.children.forEach((function(t){t.setChecked(!!e.find((function(e){return e===t.id})))}))},_buildLayout:function(){this.elements.container=new UWA.Element("div",{class:this.type===GrpSelListNodeType.GroupRoot?this.getClassNames("-root"):this.getClassNames("-child")}),this.elements.container.addClassName(this.name)},_render:function(e){for(var n=this;this.elements.container.hasChildNodes();)this.elements.container.removeChild(this.elements.container.lastChild);this.elements.container.inject(e);var i=new UWA.Element("div",{class:this.getClassNames("-content")});i.addClassName(this.type===GrpSelListNodeType.GroupRoot?this.getClassNames("-content-root"):this.getClassNames("-content-child")),i.inject(this.elements.container),this.elements.check=new t({class:this.getClassNames("-check"),type:"checkbox",label:this.label}),this.elements.check.addEventListener("change",(function(e){n._isSyncing||n._setCheckedInternal(n.elements.check.checkFlag)})),this.elements.check.checkFlag=this.checked===GrpNodeChecked.Checked,this.elements.check.inject(i),this.children.forEach((function(t){t._render(e)}))},_syncCheck:function(){this._isSyncing=!0;var e=this.children.reduce((function(e,t){return t.checked===GrpNodeChecked.Checked?e+1:e}),0),t=!1;this.elements.check.mixedState=!1,0===e?(t=this.checked!==GrpNodeChecked.Unchecked,this.checked=GrpNodeChecked.Unchecked,this.elements.check.checkFlag=!1):e===this.children.length?(t=this.checked===GrpNodeChecked.Unchecked,this.checked=GrpNodeChecked.Checked,this.elements.check.checkFlag=!0):(t=this.checked===GrpNodeChecked.Unchecked,this.checked=GrpNodeChecked.Mixed,this.elements.check.checkFlag=!0,this.elements.check.mixedState=!0),t&&this._updateChildrenLabelState(this.checked===GrpNodeChecked.Unchecked),this._isSyncing=!1},_updateChildChecks:function(e){this.children.forEach((function(t){t.setChecked(e)}))},_setCheckedInternal:function(e,t){var n=e?GrpNodeChecked.Checked:GrpNodeChecked.Unchecked;return this.checked!==n&&(this.checked=n,this.dispatchEvent("onChecked",this.checked===GrpNodeChecked.Checked),null==t&&!0!==t&&this.type===GrpSelListNodeType.GroupRoot&&(this._updateChildChecks(e),this._updateChildrenLabelState(this.checked===GrpNodeChecked.Unchecked)),!0)},_updateChildrenLabelState:function(e){this.children.forEach((function(t){t._updateLabelState(e)}))},_updateLabelState:function(e){var t=this.elements.check.getContent().querySelector(".wux-label");if(t){var n=UWA.extendElement(t);e?n.addClassName("groupSelectionListNode-unused"):n.removeClassName("groupSelectionListNode-unused")}},setChecked:function(e,t){this._setCheckedInternal(e,t)&&(this.elements.check.checkFlag=e)}});return e.extend({name:"groupSelectionList",init:function(e){this.groups=[],this._parent(e),this._buildLayout()},addGroup:function(e,t){var i=new n({type:GrpSelListNodeType.GroupRoot,label:e.label?e.label:e.id,id:e.id});t&&t.forEach&&t.forEach((function(e){i.addChild(new n({type:GrpSelListNodeType.GroupEntry,label:e.label?e.label:e.id,id:e.id}))})),this.groups.push(i),this._render()},getGroupSelected:function(e){var t=this._getGroupById(e);return t?t.getSelected():[]},getGroupAll:function(e){var t=this._getGroupById(e);return t?t.getAll():[]},getIsGroupUnused:function(e){var t=this._getGroupById(e);return t?t.getIsUnused():[]},setGroupSelected:function(e,t){var n=this._getGroupById(e);n&&n.setSelected(t)},_getGroupById:function(e){return this.groups.find((function(t){return t.id===e}))},_buildLayout:function(){var e={class:this.getClassNames("-root")};this.elements.container=new UWA.Element("div",UWA.merge(this.options,e)),this._render()},_render:function(){for(;this.elements.container.hasChildNodes();)this.elements.container.removeChild(this.elements.container.lastChild);var e=this.elements.container;this.groups.forEach((function(t){t._render(e)}))}})})),define("DS/AdvancedView/converters/Converters",[],(function(){"use strict";return{groupActionToNodeAction:function(e){return[EnoTreeNodeAction.Undefined,EnoTreeNodeAction.Duplicate,EnoTreeNodeAction.Duplicate,EnoTreeNodeAction.DuplicateWDrw,EnoTreeNodeAction.Reuse,EnoTreeNodeAction.Exclude,EnoTreeNodeAction.Branch,EnoTreeNodeAction.Branch][e]},groupActionToRecursive:function(e){return e===EnoDupGroupAction.DuplicateTree||e===EnoDupGroupAction.BranchTree},groupStringToAction:function(e){switch(e){case"Duplicate":return EnoDupGroupAction.Duplicate;case"Reuse":return EnoDupGroupAction.Reuse;case"Exclude":return EnoDupGroupAction.Exclude;case"DuplicateDrw":return EnoDupGroupAction.DuplicateWDrw;case"DuplicateTree":return EnoDupGroupAction.DuplicateTree;case"Branch":return EnoDupGroupAction.Branch;case"BranchTree":return EnoDupGroupAction.BranchTree}return EnoDupGroupAction.Invalid},groupActionToString:function(e){switch(e){case EnoDupGroupAction.Duplicate:return"Duplicate";case EnoDupGroupAction.Reuse:return"Reuse";case EnoDupGroupAction.Exclude:return"Exclude";case EnoDupGroupAction.DuplicateWDrw:return"DuplicateDrw";case EnoDupGroupAction.DuplicateTree:return"DuplicateTree";case EnoDupGroupAction.Branch:return"Branch";case EnoDupGroupAction.BranchTree:return"BranchTree"}return""}}}));var EnoApplyTextPos={Before:0,After:1},EnoDupGroupAction={Duplicate:1,DuplicateTree:2,DuplicateWDrw:3,Reuse:4,Exclude:5,Branch:6,BranchTree:7};define("DS/AdvancedView/models/TreeActionsModel",["UWA/Controls/Abstract"],(function(e){"use strict";return e.extend({GroupAction:EnoDupGroupAction.Duplicate,Text:"",ApplyTextToChildren:!1,FindText:"",ReplaceText:"",ApplyToAll:!1,ApplyTextPos:EnoApplyTextPos.Before,init:function(){this.actions=[]},getActions:function(){return this.actions},setActions:function(e){this.actions=[...e.values()]},applyAction:function(){this.dispatchEvent("OnApplyAction",this)},applySelectionAction:function(e){this.dispatchEvent("OnApplySelectionAction",e)},applyText:function(){this.ApplyTextPos===EnoApplyTextPos.Before?this.applyAddPrefixText():this.applyAddPostfixText()},applyAddPrefixText:function(){this.dispatchEvent("OnAddPrefixText",this)},applyAddPostfixText:function(){this.dispatchEvent("OnAddPostfixText",this)},applyReplace:function(){this.dispatchEvent("OnReplace",this)},reset:function(){this.dispatchEvent("OnReset",this)}})})),define("DS/AdvancedView/utils/EventRelay",["UWA/Controls/Abstract","DS/LifecycleCmd/Dictionary"],(function(e,t){"use strict";return e.extend({defaultOptions:{source:null,eventMap:[],batchMode:!1,dispatcher:function(e,t){console.log("Supply dispatcher to EventRelay!")}},init:function(e){this._parent(e),this.options.source&&this.addSource(this.options.source),this._cache=new t},addSource:function(e){var t=this;this.options.eventMap.forEach((function(n){e.addEvent(n.from,(function(e){t.options.batchMode?t._cacheEvent(n.to||n.from,n.batchTransform,e):t.options.dispatcher(n.to||n.from,n.transform?n.transform(e):e)}))}))},setBatchMode:function(e){this.options.batchMode=e,this.options.batchMode||this._dispatchCache()},_cacheEvent:function(e,t,n){var i=this._cache.find(e);i||(i={data:[],transform:t},this._cache.add(e,i)),i.data.push(n)},_dispatchCache:function(){var e=this;this._cache.each((function(t,n){e.options.dispatcher(t,n.transform?n.transform(n.data):n.data)})),this._cache.clear()}})})),define("DS/AdvancedView/utils/TreeNodeCache",["UWA/Controls/Abstract","DS/LifecycleCmd/Dictionary"],(function(e,t){"use strict";return e.extend({defaultOptions:{nodeModelFactory:function(){return console.error("You must supply factory to TreeNodeCache"),null}},init:function(e){this._parent(e),this._cache=new t},resolve:function(e){var t=this._createKey(e.nodeId,e.occId),n=this._getFromCache(t);return n||this._createAndCache(e,t)},_createKey:function(e,t){return e+"o"+t},_getFromCache:function(e){return this._cache.find(e)},_createAndCache:function(e,t){var n=this.options.nodeModelFactory(e);return this._cache.add(t,n),n}})})),define("DS/AdvancedView/ExtensibilityConstants",[],(function(){return{ExpandNodeCapabilites:{Undefined:0,Duplicate:1,Reuse:2,Exclude:3,ChangeTitle:4,FollowParent:5,Branch:6,Max:1e5},OperationCapabilites:{AddPrefix:"045f08a0-5628-48e6-9f81-3822e3505378",Expand:"84a058e4-4e05-4fc3-8c2f-ed137631d5ae",IncludeStructrualObjects:"23216a08-c15f-4955-853d-79a5d194d04b",RelatedObjects:"d4b35923-c853-4522-81ae-cac5e67ac260",ClearConfigurations:"d5db4946-a604-4471-97d0-cd4664154a61",LegacyRelatedObjects:"216bc0d1-0cc9-412d-a9a3-6e7c2a323f8c",Include3DAndStructrualObjects:"2b317ee7-5693-4935-8d06-a2486a887a10"}}})),define("DS/AdvancedView/DataFilterer",["UWA/Class"],(function(e){"use strict";return e.extend({init:function(){this.filters=[]},addFilter:function(e){this.filters.push(e)},filter:function(e){return e.filter((function(e){return this.filters.every((function(t){return t(e)}))}),this)}})})),define("DS/AdvancedView/utils/TreeNodeFiltering",["UWA/Controls/Abstract","DS/AdvancedView/DataFilterer"],(function(e,t){"use strict";return e.extend({init:function(e){this.treeModel=e},filterNodes:function(e){var n=function(e,t){return-1!==t.getGridAttribute("label").search(new RegExp(e,"i"))},i=function(e,t){return new RegExp("^"+e.split("*").join(".*")+"$","i").test(t.getGridAttribute("label"))},o=new t,s=e.TitleString.replace(/[\-\[\]\/\{\}\(\)\+\?\.\\\^\$\|]/g,"\\$&"),r=-1!==s.indexOf("*");return s.length>0&&(e.TitleCriteria===EnoTitleSelectionCriteria.Contains?r?o.addFilter(i.bind(null,s)):o.addFilter(n.bind(null,s)):r?o.addFilter(function(e,t){return!i(e,t)}.bind(null,s)):o.addFilter(function(e,t){return!n(e,t)}.bind(null,s))),o.addFilter(function(e,t){return e.some((function(e){return function(e,t){return e===t.getNodeOption("type")}(e,t)}))}.bind(null,e.TypeMatch)),o.addFilter(function(e,t){return e.some((function(e){return function(e,t){return e===t.getGridAttribute("maturityNls")}(e,t)}))}.bind(null,e.StateMatch)),o.filter(this.treeModel.getAllNodes())}})})),define("DS/AdvancedView/AssemblyDGVList",["UWA/Controls/Abstract","UWA/Core","DS/DataGridView/DataGridView","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/Core/PointerEvents","DS/Controls/Toggle","DS/LifecycleServices/AssemblyJson","DS/LifecycleServices/LifecycleServices","DS/AdvancedView/ExtensibilityConstants","i18n!DS/AdvancedView/assets/nls/AdvancedViewNls"],(function(e,t,n,i,o,s,r,a,c,l,d){"use strict";return e.extend({init:function(e){e=e||{},this._parent({}),this.buildUI(),this.options=e,this.colIndexes=["revision","owner","description","modified","originated"],this.defaultWidth=[],this.defaultWidth.revision=72,this.defaultWidth.newTitle=180,this.defaultWidth.maturityNls=110,this.postUpdateViewCalled=!1,this.treeColumnSortable=!0,this.identifier=e.identifier,this.convertToNlsAction=function(e){let t;switch(e){case EnoTreeNodeAction.Duplicate:t=d.duplicate;break;case EnoTreeNodeAction.Reuse:t=d.reuse;break;case EnoTreeNodeAction.Exclude:t=d.exclude;break;case EnoTreeNodeAction.Branch:t=d.branch;break;case EnoTreeNodeAction.DuplicateWDrw:t=d.duplicatewithdrw;break;default:t=""}return t},this.convertToActionCode=function(e){let t;switch(e){case d.duplicate:t=EnoTreeNodeAction.Duplicate;break;case d.reuse:t=EnoTreeNodeAction.Reuse;break;case d.exclude:t=EnoTreeNodeAction.Exclude;break;case d.branch:t=EnoTreeNodeAction.Branch;break;case d.duplicatewithdrw:t=EnoTreeNodeAction.DuplicateWDrw;break;default:t=-1}return t},void 0!==e&&(void 0!==e.allCols&&(this.colIndexes=e.allCols),void 0!==e.getTypeIcon&&(this.getTypeIconFunc=e.getTypeIcon),void 0!==e.getChildrenInTreeOrder&&(this.getChildrenInTreeOrder=e.getChildrenInTreeOrder),void 0!==e.treeColumnSortable&&(this.treeColumnSortable=e.treeColumnSortable),void 0!==e.colsSortable&&(this.colsSortable=e.colsSortable),void 0!==e.onContextualEvent&&(this.onContextualEvent=e.onContextualEvent)),this.options.useKeyboard&&this.installKeyboardHandlers(),this.columns=this.initColumns(),this.treeDocument=null},installKeyboardHandlers:function(){this.elements.container.addEventListener("keydown",(e=>{65===e.keyCode&&e.ctrlKey&&(this.getAllNodes().forEach((e=>e._treeNode.select())),e.preventDefault())}))},getNodes:function(e,t){t=[];for(var n=this.tree.getTreeDocument().getAllDescendants().filter((e=>!e.isFiltered())),i=n.length,o=0;o<i;o++){var s=n[o];if(e(s)){var r=this.buildAssemblyNode(s);t.push(r)}}return t},getAllNodes:function(){return this.getNodes((function(e){return!0}))},getSelectedNodes:function(){var e=this;return this.tree.getTreeDocument().getSelectedNodes().map((function(t){return e.buildAssemblyNode(t)}))},clearSelection:function(){this.getSelectedNodes().forEach((e=>{e._treeNode.unselect()}))},getSameNodes2:function(e){return this.getNodes((function(t){return e==t.options.nodeId}))},onSelect:function(e){this.onSelCallback=e},onUnselect:function(e){this.onUnselCallback=e},onCheck:function(e){this.onCheckCallback=e},onUncheck:function(e){this.onUncheckCallback=e},insertCol:function(e,t){this.columns.splice(e,0,t)},load:function(e,t,i,o){var s=this;let r=Array.isArray(e)?e:[e];this.filterDuplicates=!1,void 0!==i&&void 0!==i.filterDuplicates&&(this.filterDuplicates=i.filterDuplicates);var a,c=i?i.loadFilter:null,l=i?i.sortFn:null;let d="undefined"!==this.options?this.colIndexes:t,u=this.createNodeUIAttributes(d);this.treeDocument=this.createTreeModel(r,u.attributeNames,c,l),this.treeDocument.setFilterModel(o),a=this.getOptions(this.treeDocument,u.customCols),this.tree=new n(a),this.tree.onPostUpdateView((function(){s.postUpdateViewCalled=!0,s.dispatchEvent("onPostUpdateView")})),this.tree.inject(this.elements.container),void 0!==this.options&&this.customizeColumns(t);for(var h=this.tree.getTreeDocument().getAllDescendants(),p=h.length,f=0;f<p;f++){var g=h[f];g.onSelect((function(e){e.target;if(null!=s.onSelCallback){var t=s.buildAssemblyNode(e.target);s.onSelCallback(t)}})),g.onUnselect((function(e){e.target;if(null!=s.onUnselCallback){var t=s.buildAssemblyNode(e.target);s.onUnselCallback(t)}})),g.toggle=function(){this.toggled=!0,null!=this.checkbox&&!0!==this.checkbox.checkFlag&&this.checkbox.toggle()},g.untoggle=function(){this.toggled=!1,null!=this.checkbox&&!0===this.checkbox.checkFlag&&this.checkbox.toggle()}}i&&i.noExpandAll||this.tree.getTreeDocument().getNthRoot(0).expandAll()},setupDropdownListCol:function(e,t,n,i,o,s,r){t=void 0!==t?t:130,e.width=void 0!==t?t:130;var a=void 0===n||n;e.sortableFlag=void 0===a||n,e.editionPolicy="EditionInPlace",e.typeRepresentation="enumString",e.editableFlag=!0,e.getCellSemantics=i,e.getCellValue=o,e.getCellClassName=s,e.setCellValue=r},setupLineEditorCol:function(e,t,n,i,o,s){e.editionPolicy="EditionInPlace",e.typeRepresentation="string",e.editableFlag=!0,e.getCellEditableState=t,e.getCellValue=n,e.getCellClassName=i,e.getCellSemantics=o,e.setCellValue=s},_createActionOptsFromArray:function(e){var t={options:[],translated:[],name2idx:[]},n=0;return e.forEach((function(e){switch(e){case EnoTreeNodeAction.Duplicate:t.options.push("duplicate"),t.translated.push(d.duplicate),t.name2idx.duplicate=n++;break;case EnoTreeNodeAction.Reuse:t.options.push("reuse"),t.translated.push(d.reuse),t.name2idx.reuse=n++;break;case EnoTreeNodeAction.Exclude:t.options.push("exclude"),t.translated.push(d.exclude),t.name2idx.exclude=n++;break;case EnoTreeNodeAction.DuplicateWDrw:t.options.push("duplicate2"),t.translated.push(d.duplicatewithdrw),t.name2idx.duplicate2=n++;break;case EnoTreeNodeAction.Branch:t.options.push("branch"),t.translated.push(d.branch),t.name2idx.branch=n++}})),t},getRelatives:function(e){return{children:e.getAllDescendants(),parents:e.getParents(),instances:this.getSameNodes(e.options.nodeId)}},buildAssemblyNode:function(e){var t=this,n=e.options,i={occId:n.occId,nodeId:n.nodeId,physicalId:n.physicalId,_treeNode:e,getParent:function(){var e=i._treeNode.getParent(),n=null;return null!=e&&null!=e.options.occId&&(n=t.buildAssemblyNode(e)),n},getChildren:function(){var e=[],n=i._treeNode.getChildren();if(null==n)return[];for(var o=n.length,s=0;s<o;s++){var r=n[s],a=t.buildAssemblyNode(r);e.push(a)}return e}};return i},customizeColumns:function(e){for(var t=this.getColumnsOptions(e),n=this.tree.columns.length,i=0;i<n;i++){"toggle"==(o=this.columns[i]).dataIndex||"tree"==o.dataIndex||e&&-1!=e.indexOf(o.dataIndex)||(o.isHidden=!0,t.push(o))}this.tree.columns=t;for(i=0;i<n;i++){var o;(o=this.tree.columns[i]).isHidden?this.tree.layout.setColumnVisibleFlag(o.columnID,!1):this.tree.layout.setColumnVisibleFlag(o.columnID,!0)}},getColumnsOptions:function(e){var t=[],n=this.getCol("tree");if(n.isHidden=!1,t.push(n),void 0!==e)for(var i=e.length,o=0;o<i;o++){var s=e[o],r=this.getCol(s);r.isHidden=!1,t.push(r)}return t},createNodeUIAttributes:function(e){var t=[],n=this.getCol("tree");t.push(n);var i=["physicalid","Title","type"];if(void 0!==e)for(var o=e.length,s=0;s<o;s++){var r=e[s],a=this.getCol(r);t.push(a);var c=r;"modified"==c&&(c="mod"),"advancedAction"===r?(i.push("defaultAction"),i.push("expand::defaultAction"),i.push("advancedAction")):i.push(c)}return i.push("type_icon_url"),{attributeNames:i,customCols:t}},createTreeModel:function(e,t,n,s){var r=new i;return r.prepareUpdate(),e.forEach((e=>{var i=a.getRootOccurenceId(e),c=a.AssemblyHelper(e),l=new o;this.fillTreeNodeModel(e,c,i,t,l,n,s),r.addRoot(l)})),r.pushUpdate(),r},getOptions:function(e,t){var n={identifier:this.identifier,treeDocument:e,columns:t,cellSelection:"none",cellDragEnabledFlag:!1,rowDragEnabledFlag:!1,layoutOptions:{rowsHeader:!1},allowUnsafeHTMLContent:!1};return this.onContextualEvent&&(n.onContextualEvent=this.onContextualEvent),n},fillTreeNodeModel:function(e,t,n,i,s,r,a){let d=t.getNodeIdFromOccurenceId(n),u=t.getNodeAttributeValues(d,i),h=u[0],p=u[1],f=u[2],g=u[i.indexOf("type_icon_url")];null==g&&null!=this.getTypeIconFunc&&(g=this.getTypeIconFunc(f));let A,v={},m=u.length;for(let e=3;e<m;e++){let t=i[e],n=u[e],o=t;"mod"==t&&(o="modified",n=c.formatDate(n,!0)),"originated"==t&&(n=c.formatDate(n,!0)),"advancedAction"==t&&(n=u[i.indexOf("defaultAction")],n||(n=u[i.indexOf("expand::defaultAction")],n===l.ExpandNodeCapabilites.Duplicate?n=EnoTreeNodeAction.Duplicate:n===l.ExpandNodeCapabilites.Branch&&(n=EnoTreeNodeAction.Branch)),v.defaultAction=n,n=this.convertToNlsAction(n)),v[o]=n}v.instanceTitle=t.getInstanceTitle(n),s.updateOptions({label:p,grid:v,type:f,icons:[g],occId:n,nodeId:d,physicalId:h,assembly:e}),A=this.getChildrenInTreeOrder?t.getChildOccurenceIdsTreeOrder(n,this.filterDuplicates):t.getChildOccurenceIds(n,this.filterDuplicates);let y=A.length;if(y>0)for(let n=0;n<y;n++){let c=A[n],l=new o;s.addChild(l),this.fillTreeNodeModel(e,t,c,i,l,r,a)}},addColumn:function(e,t,n,i,o){var s={text:t,dataIndex:n,sortableFlag:o,width:i,getCellClassName:function(){return"adv-"+n}};e.push(s)},initColumns:function(){var e=[],t=c.getAttributeDisplayName("title");this.addColumn(e,t,"tree","auto",this.treeColumnSortable);for(var n=this.colIndexes.length,i=0;i<n;i++){var o=this.colIndexes[i],s=c.getAttributeDisplayName(o),r="auto";null!=this.defaultWidth[o]&&(r=this.defaultWidth[o]);var a=!0;null!=this.colsSortable&&null!=this.colsSortable[o]&&(a=this.colsSortable[o]),this.addColumn(e,s,this.colIndexes[i],r,a)}return e},buildUI:function(){this.elements.container=t.createElement("div",{class:"assemblyTreeListContainer",styles:{class:"tree_list",top:"0px",left:"0px",width:"100%",height:"100%","background-color":"white"}})},getAllNodesCount:function(){return 10},getSameNodes:function(e){for(var t=[],n=this.tree.getTreeDocument().getAllDescendants(),i=n.length,o=0;o<i;o++){var s=n[o];e==s.options.nodeId&&t.push(s)}return t},getCol:function(e){for(var t=this.columns.length,n=0;n<t;n++){var i=this.columns[n];if(i.dataIndex==e)return i}return null},selectOccurrences:function(e){for(var t=this.tree.getTreeDocument().getAllDescendants(),n=0;n<t.length;n++){var i=t[n],o=i.options.occId;-1!=e.indexOf(o)?i.select():i.isSelected()&&i.unselect()}},onInitialUpdateView:function(){var e=this;return this._onInitialUpdateViewPromise=this._onInitialUpdateViewPromise||new t.Class.Promise((function(t,n){e.postUpdateViewCalled?t():e.addEvent("onPostUpdateView",(function(){setTimeout((function(){t()}),100)}))})),this._onInitialUpdateViewPromise}})})),define("DS/AdvancedView/views/ExpandOptionsPanel",["DS/AdvancedView/views/ToolsPanel","DS/LifecycleServices/IdNs","DS/LifecycleCmd/MessageMediator","DS/LifecycleServices/Utils","DS/Controls/Toggle","text!DS/AdvancedView/assets/html/expandoptionspanel.html","i18n!DS/AdvancedView/assets/nls/AdvancedViewNls","DS/AdvancedView/WidgetEvents","css!DS/AdvancedView/AdvancedView"],(function(e,t,n,i,o,s,r){"use strict";return e.extend({init:function(e,t,n){this.expandOptions=n,r=i.createDbgNlsProxy(r),this._parent({identifier:"0f372f30-fee0-4236-84c3-cc45057c7ba7",immersiveFrame:e,model:t})},getContent:function(){return this.content||this.createContent()},getTitle:function(){return"expand options"},createContent:function(){this.content=UWA.createElement("div",{class:"adv-option-panel"});var e=new t(this.content,"enolcm-adv-expandoptionpanel-");return this.viewModel={},e.elementFromTemplate(s,null,r,this.viewModel).inject(this.content),this.expandOptions.forEach((e=>{new o({type:"switch",label:e.nameNLS,value:e.defaultValue}).inject(this.content)})),this.content}})})),define("DS/AdvancedView/views/SelectionPanel",["DS/AdvancedView/views/ToolsPanel","DS/AdvancedView/UIUpdate","DS/AdvancedView/controls/GroupSelectionList","DS/AdvancedView/controls/PopupControl","DS/LifecycleServices/Utils","DS/LifecycleServices/IdNs","DS/AdvancedView/utils/UpdateSelectionModelVStrategy","DS/AdvancedView/utils/UpdateSelectionModelHStrategy","text!DS/AdvancedView/assets/html/selpanelv.html","text!DS/AdvancedView/assets/html/selpanelh.html","i18n!DS/AdvancedView/assets/nls/AdvancedViewNls","css!DS/AdvancedView/AdvancedView"],(function(e,t,n,i,o,s,r,a,c,l,d){"use strict";return e.extend({content:null,init:function(e,n,i,s){d=o.createDbgNlsProxy(d),this.treeModel=i,this.UIUpdate=new t;let r=s||{};this._parent({identifier:"d94c796c-6828-11e9-a923-1681be663d3e"+(r.identifier?r.identifier:""),immersiveFrame:e,model:n}),this.updateUI=o.debounce(this._updateUI.bind(this),100),i.addEvent("OnTreeInitialized",(function(){var e=[];this.treeModel.Types.each((function(t,n){e.push({label:n,id:n})})),e.sort(((e,t)=>e.label==t.label?0:e.label<t.label?-1:1)),this.groupList.addGroup({label:d.grpType,id:"type"},e);var t=[];this.treeModel.States.each((function(e,n){t.push({label:n,id:n})})),t.sort(((e,t)=>e.label==t.label?0:e.label<t.label?-1:1)),this.groupList.addGroup({label:d.grpState,id:"state"},t)}),this)},getContent:function(){return this.content||this.createContent()},getTitle:function(){return d.selection},createContent:function(){var e=this;this.content=UWA.createElement("div",{class:"adv-selection-panels"});var t=new s(this.content,"enolcm-adv-selpanel-");this.verticalLayout=UWA.createElement("div").inject(this.content),this.horzLayout=UWA.createElement("div").inject(this.content);var n={addSelection:function(){e._updateModel().addSelection()},removeSelection:function(){e._updateModel().removeSelection()},clearSelection:function(){e._updateModel().clearSelection()},onChangeContains:function(t){e.model.TitleCriteria=EnoTitleSelectionCriteria.Contains},onChangeNotContains:function(t){e.model.TitleCriteria=EnoTitleSelectionCriteria.NotContains},setProperty:function(t,n){"title"===t&&(e.model.TitleString=n)}};t.elementFromTemplate(c,null,d,n).inject(this.verticalLayout),t.elementFromTemplate(l,null,d,n).inject(this.horzLayout),this._setupUIUpdate(t);var i=this._createGroupLists(t);return this.updateSelectionModelVStrategy=new r({idns:t,groupList:i.v}),this.updateSelectionModelHStrategy=new a({idns:t,groupList:i.h}),this.content},_setupUIUpdate:function(e){var t=this;[{ids:["removeSelBtn","clearSelBtn","removeSelBtnH","clearSelBtnH"],enableLogic:function(e){return e.haveTreeSelection}}].forEach((function(n){n.ids.forEach((function(i){var o=e.getElById(i);t.UIUpdate.addElement(o,(function(e){return n.enableLogic(e)}))}))}))},_connectButtons:function(e){},onStartWindowDrag:function(){this.attlistPopup&&this.attlistPopup.hidePopup()},onPrePlaceChange:function(e){this.attlistPopup&&this.attlistPopup.hidePopup()},_createGroupLists:function(e){var t=this,o=new n,s=e.getElById("dropdownGrouplistPlaceholder");s.addEventListener("show",(function(e){e.currentTarget.dsModel.elements.popup&&(e.currentTarget.dsModel.elements.popup.visibleFlag=!1),t.attlistPopup=t.attlistPopup||new i({createContent:function(){var e=new UWA.createElement("div",{class:"groupListDropdown-container",styles:{width:"200px",height:"auto",maxHeight:"0px",transition:"max-height 0.3s ease-in"}});return o.inject(e),e},styles:{borderRadius:"4px",height:"auto",maxHeight:"400px",overflowY:"auto"},events:{onShow:function(e){var t=e.querySelector(".groupListDropdown-container");t&&t.setStyle("max-height","800px");var n=e.querySelector(".groupSelectionList-root");n&&n.setStyle("overflow-y","hidden")},onHide:function(e){var t=e.querySelector(".groupListDropdown-container");t&&t.setStyle("max-height","0px");var n=e.querySelector(".groupSelectionList-root");n&&n.setStyle("overflow-y","auto")}}}),t.attlistPopup.showPopup({parentEl:s})}));var r=e.getElById("groupListPlaceholder"),a=new n;return a.inject(r),this.groupList={lists:[],add:function(e){this.lists.push(e)},getGroupSelected:function(e){return this.lists[0].getGroupSelected(e)},addGroup:function(e,t){this.lists.forEach((function(n){n.addGroup(e,t)}))}},this.groupList.add(a),this.groupList.add(o),{h:o,v:a}},_updateModel:function(){return this.model.TypeMatch=this.updateModelStrategy.getGroupMatch("type"),this.model.StateMatch=this.updateModelStrategy.getGroupMatch("state"),this.model._TypeSelected=this.updateModelStrategy._getGroupSelected("type"),this.model._StateSelected=this.updateModelStrategy._getGroupSelected("state"),this.model},_updateUI:function(){this.UIUpdate.update({haveTreeSelection:this.treeModel.getSelectedNodes().length>0})},_setLayout:function(e){var t=null;this.updateModelStrategy&&(t=this._updateModel()),e===EnoPanelLayout.Vertical?(this.verticalLayout.setStyle("display","block"),this.horzLayout.setStyle("display","none"),this.updateModelStrategy=this.updateSelectionModelVStrategy):(this.verticalLayout.setStyle("display","none"),this.horzLayout.setStyle("display","block"),this.updateModelStrategy=this.updateSelectionModelHStrategy),t&&this.updateModelStrategy.updateUIFromModel(t)},_initialUpdate:function(e){this._setLayout(e),this._updateModel()}})}));let EnoTreeNodeAction={Undefined:0,Duplicate:1,DuplicateWDrw:2,Exclude:3,Reuse:4,Branch:5};define("DS/AdvancedView/models/TreeNodeModel",["UWA/Controls/Abstract","DS/LifecycleServices/AssemblyJson","DS/AdvancedView/ExtensibilityConstants","i18n!DS/AdvancedView/assets/nls/AdvancedViewNls"],(function(e,t,n,i){"use strict";return e.extend({init:function(e,i,o,s,r){if(this.treeNode=e,this.assembly=o,this.treeList=s,this.isRoot=i,this.assyNode=null,this._isV5=null,this.nodeFactory=r,this.defaultAction=EnoTreeNodeAction.Duplicate,this.supportedActions=this.getTreeNodeDefaultSupportedActions(this.isRoot,!1),this.nodeCaps=[n.ExpandNodeCapabilites.ChangeTitle],this.assembly){this.assyNode=t.getNode(this.assembly,this.getId()),this._isV5="CATIAV5"===this.assyNode.cadMaster||"SOLIDWORKS"===this.assyNode.cadMaster,this.supportedActions=this.getTreeNodeDefaultSupportedActions(this.isRoot,this._isV5);let e=this.getInitialSupportedActions();e&&this.setSupportedActions(e),this.nodeCaps=this.assyNode.capabilites||this.nodeCaps;let n=this.assyNode.defaultAction;n||(n=this.assyNode.attributes["expand::defaultAction"]),null!=n&&(this.defaultAction=n),this.supportedActions.includes(this.defaultAction)||(this.defaultAction=this.supportedActions[0]),this.treeNode._treeNode.setAttribute("defaultAction",this.defaultAction);let i=this.treeList.convertToNlsAction(this.defaultAction);this.treeNode._treeNode.setAttribute("advancedAction",i)}this._canEditTitle=!!this.nodeCaps.find((e=>e==n.ExpandNodeCapabilites.ChangeTitle)),this.orgValues={title:this.getNodeOption("label"),action:this.defaultAction},this.assyNode&&this.assyNode.attributes?this.titleMaxLength=parseInt(this.assyNode.attributes["expand::titleMaxLength"]||-1):this.titleMaxLength=-1},getGridAttribute:function(e){return this.treeNode._treeNode.getAttributeValue(e)},getNodeOption:function(e){return this.treeNode._treeNode.options[e]},getId:function(){return this.treeNode.nodeId},getOccId:function(){return this.treeNode.occId},getNewTitle:function(){return this.treeNode._treeNode.getAttributeValue("newTitle")},getAction:function(){let e=this.treeNode._treeNode.getAttributeValue("advancedAction");return this.treeList.convertToActionCode(e)},getDefaultAction:function(){return this.defaultAction},getValueFromAction:function(e){return this.supportedActions?.includes(e)?this.treeList.convertToNlsAction(e):""},getActionFromValue:function(e){let t=this.treeList.convertToActionCode(e);return this.supportedActions?.includes(t)?t:-1},getSupportedActions:function(){return this.supportedActions},getInitialSupportedActions:function(){let e;return e=this._isV5?this._getAssyNode()?.supportedActionsV5:this._getAssyNode()?.supportedActions,e},getTreeNodeDefaultSupportedActions(e,t){var n=[EnoTreeNodeAction.Duplicate],i=[EnoTreeNodeAction.Duplicate,EnoTreeNodeAction.DuplicateWDrw],o=[EnoTreeNodeAction.Duplicate,EnoTreeNodeAction.Reuse,EnoTreeNodeAction.Exclude,EnoTreeNodeAction.DuplicateWDrw],s=[EnoTreeNodeAction.Duplicate,EnoTreeNodeAction.Reuse,EnoTreeNodeAction.Exclude];return t?e?i:o:e?n:s},getChildren:function(){let e=this.treeNode.getChildren().map((function(e){return this.nodeFactory(e)}),this);return e||[]},getType:function(){return this._getAssyNode().typeRaw},getDepth:function(){return this.treeNode._treeNode._nodeDepth},getCanEditTitle:function(){return this._canEditTitle},getTitleMaxLength:function(){return this.titleMaxLength},_getAssyNode:function(){return this.assyNode||(this.assyNode=t.getNode(this.assembly,this.getId())),this.assyNode},setNewTitle:function(e){this.getNewTitle()!=e&&this.treeNode._treeNode.setAttribute("newTitle",e.trim())},setTitleMaxLength:function(e){this.titleMaxLength=e},setAction:function(e){if(/*!forceUpdate && */this.isConnectedToParent())return;if(!e)return;var t=this.getValueFromAction(e);if(!t)return;let n=this.getAction();e!==n&&(this.treeNode._treeNode.setAttribute("advancedAction",t),this.dispatchEvent("onActionChange",{node:this,oldAction:n,newAction:e}))},setSupportedActions:function(e){let t=[EnoTreeNodeAction.Duplicate,EnoTreeNodeAction.Branch,EnoTreeNodeAction.Reuse,EnoTreeNodeAction.Exclude,EnoTreeNodeAction.DuplicateWDrw].filter((t=>e.includes(t)));if(this.isRoot){let e=[EnoTreeNodeAction.Duplicate,EnoTreeNodeAction.Branch,EnoTreeNodeAction.DuplicateWDrw];t=t.filter((t=>e.includes(t)))}this.supportedActions=t},computeInputPattern:function(e){let t;return-1===this.getTitleMaxLength()&&this.setTitleMaxLength("100"),t=this.getTitleMaxLength(),this.titlePattern="(^.{0,"+t+"}$)",this._isV5&&e&&(this.titlePattern=this.titlePattern.replace(".","[^"+e+"]")),this.titlePattern},isTitleValid:function(e){let t=e||this.getNewTitle();return new RegExp(this.titlePattern).test(t)},select:function(){this.treeNode._treeNode.select()},unselect:function(){this.treeNode._treeNode.unselect()},expandAll:function(){this.treeNode._treeNode.expandAll()},expandn:function(e){this.treeNode._treeNode.expandNLevels({numberOfLevelsToExpand:e})},collapseAll:function(){this.treeNode._treeNode.collapseAll()},remove:function(){this.treeNode._treeNode.remove()},disable:function(){this.treeNode._treeNode.updateOptions({disabled:!0})},enable:function(){this.treeNode._treeNode.updateOptions({disabled:!1})},lock:function(){this.treeNode._treeNode.updateOptions({locked:!0})},unlock:function(){this.treeNode._treeNode.updateOptions({locked:!0})},isVisible:function(){return this.treeNode._treeNode.isVisible()},isSelected:function(){let e=this.treeList.tree.getTreeDocument();return this.treeNode._treeNode.isSelected(e)},isDisabled:function(){return this.treeNode._treeNode.options.disabled},isLocked:function(){return this.treeNode._treeNode.options.locked},isConnectedToParent:function(){return this._getAssyNode().connectToParent},reset:function(){this.setNewTitle(this.orgValues.title),this.setAction(this.orgValues.action)}})})),define("DS/AdvancedView/models/OptionsModel",["UWA/Controls/Abstract","DS/LifecycleCmd/MessageMediator","DS/AdvancedView/WidgetEvents"],(function(e,t){"use strict";return e.extend({IncludeDrawings:!1,KeepConfig:!1,excludeComposeeTypes:[],setIncludeDrawings:function(e){this.IncludeDrawings=e,t.dispatchEvent(AdvancedViewEvents.includeAllDrwOptionOnChange,this.IncludeDrawings)},setKeepConfig:function(e){this.KeepConfig=e}})})),define("DS/AdvancedView/models/TreeModel",["UWA/Controls/Abstract","DS/AdvancedView/models/TreeNodeModel","DS/AdvancedView/utils/TreeNodeCache","DS/AdvancedView/utils/EventRelay","DS/LifecycleCmd/Dictionary"],(function(e,t,n,i,o){"use strict";return e.extend({Types:null,States:null,init:function(e){this._parent();var s=this;this.Types=new o,this.States=new o,this.inputValidation=e.inputValidator,e.addEvent("onTreeListCreated",(function(t){s.treeList=e.treeList,s.treeList.onInitialUpdateView().then((function(){s.dispatchEvent("OnTreeInitialized",s)})),s.treeList.tree.getNodesXSO().onPostAdd((function(){s.dispatchEvent("OnSelChangeTree",s)})),s.treeList.tree.getNodesXSO().onPostRemove((function(){s.dispatchEvent("OnSelChangeTree",s)})),s.treeList.tree.getNodesXSO().onEmpty((function(){s.dispatchEvent("OnSelChangeTree",s)}))})),this._eventRelay=new i({dispatcher:function(e,t){s.dispatchEvent(e,t)},eventMap:[{from:"onActionChange",to:"onActionChangeTree",transform:function(e){return{nodes:[e]}},batchTransform:function(e){return{nodes:e}}}]}),this._initNodeModel=function(e){s._eventRelay.addSource(e)};var r=function(e){var n=new t(e,0===e._treeNode._nodeDepth,e._treeNode.options.assembly,s.treeList,(function(e){var t=s._treeNodeCache.resolve(e);return t||r(e)}),s.inputValidation);return s._initNodeModel(n),n};this._treeNodeCache=new n({nodeModelFactory:r})},getSelectedNodes:function(){return this.treeList.getSelectedNodes().map((function(e){return this._treeNodeCache.resolve(e)}),this)},getAllNodes:function(){return this.treeList.getAllNodes().map((function(e){return this._treeNodeCache.resolve(e)}),this)},getSelectedCount:function(){return this.treeList?this.treeList.getSelectedNodes().length:0},getModelFromTreeNode:function(e){return this._treeNodeCache.resolve(this.treeList.buildAssemblyNode(e))},appendInstances:function(e){if("function"==typeof e.forEach){var t={},n=[];return e.forEach((function(e){n=n.concat(this._appendInstances(e,t))}),this),n}return this._appendInstances(e)},disableNode:function(e){this.treeList.disableNode(e.treeNode._treeNode)},enableNode:function(e){this.treeList.enableNode(e.treeNode._treeNode)},updateCell:function(e,t){this.treeList.tree.updateCellView(e.treeNode._treeNode._getRowID(),t)},setBatchMode:function(e){this._eventRelay.setBatchMode(e)},_appendInstances:function(e,t){var n=function(e){return e.getNodeOption("nodeId")+"o"+e.getNodeOption("occId")},i=function(e){t&&(t[e]=!0)},o=function(e){return null==t||null==t[e]},s=this.treeList.getSameNodes(e.getNodeOption("nodeId")).filter((function(t){return t.options.occId!=e.getNodeOption("occId")})).map((function(e){return{node:e,key:n({getNodeOption:function(t){return"nodeId"===t?e.options.nodeId:"occId"===t?e.options.occId:void 0}})}})).filter((function(e){return o(e.key)})).map((function(e){return i(e.key),this.getModelFromTreeNode(e.node)}),this),r=n(e);return o(r)&&(s.unshift(e),i(r)),s},clearSelection:function(){this.getSelectedNodes().forEach((function(e){e.unselect()}))},_addType:function(e,t){this.Types.contains(e)||this.Types.add(e,t)},_addState:function(e,t){this.States.contains(e)||this.States.add(e,t)}})})),define("DS/AdvancedView/views/OptionsPanel",["DS/AdvancedView/views/ToolsPanel","DS/LifecycleServices/IdNs","DS/LifecycleCmd/MessageMediator","DS/LifecycleServices/Utils","DS/LifecycleServices/ArrayFunctions","DS/Controls/Toggle","text!DS/AdvancedView/assets/html/optionspanel.html","i18n!DS/AdvancedView/assets/nls/AdvancedViewNls","DS/AdvancedView/WidgetEvents","css!DS/AdvancedView/AdvancedView"],(function(e,t,n,i,o,s,r,a){"use strict";return e.extend({composeeTypeOptions:[],init:function(e,t,n){this.opts=n||{},a=i.createDbgNlsProxy(a),this._parent({identifier:"d94c7818-6828-11e9-a923-1681be663d3e"+(this.opts.identifier?this.opts.identifier:""),immersiveFrame:e,model:t,composeeOptions:n.composeeOptions})},getContent:function(){return this.content||this.createContent()},getTitle:function(){return a.options},createContent:function(){var e=this;this.content=UWA.createElement("div",{class:"adv-option-panel"});var i=new t(this.content,"enolcm-adv-optionpanel-");this.viewModel={onIncDrwChange:function(t){e.model.setIncludeDrawings(t)},onKeepCfgChange:function(t){e.model.setKeepConfig(t)}},i.elementFromTemplate(r,null,a,this.viewModel).inject(this.content);let o=i.getElById("coomposeeOpts");for(const e of this.options.composeeOptions.composeeIncludeOptions){var c=new s({type:"checkbox",checkFlag:e.curState=e.defaultState,label:e.label});c.inject(o),c.addEventListener("change",(t=>{e.curState=t.dsModel.checkFlag,this.updateComposeeIncludeOptions()})),this.composeeTypeOptions.push({wux:c,types:e.types})}this.updateComposeeIncludeOptions();var l=i.getElById("incDrwCheck"),d=i.getElById("keepCfgCheck");return this.opts.haveCatiaV5Data&&l.setStyle("display","block"),this.opts.clearConfigurations&&d.setStyle("display","block"),n.addEvent(AdvancedViewEvents.includeAllDrwOptionSet,(function(t){e.model.IncludeDrawings!==t&&(e.model.setIncludeDrawings(t),l.wuxControl.checkFlag=t,n.dispatchEvent(AdvancedViewEvents.displayDuplicateAlert,a.autoDisableDrw))})),this.model.haveCatiaV5Data||(l.style.display="none"),this.content},updateComposeeIncludeOptions:function(){let e=this.options.composeeOptions.composeeIncludeOptions.filter((e=>e.curState)).map((e=>e.types)).flatMap((e=>e));this.model.excludeComposeeTypes=this.options.composeeOptions.allExcludeComposeeTypes.filter((t=>!e.includes(t)))}})})),define("DS/AdvancedView/utils/UpdateActionModelVStrategy",["UWA/Controls/Abstract","DS/AdvancedView/converters/Converters"],(function(e,t){"use strict";return e.extend({init:function(e){this._parent(e),this.controls={},this.controls.applyAllRadio=e.idns.getElById("applyAllRadio"),this.controls.applySelRadio=e.idns.getElById("applySelRadio"),this.controls.applyToChildren=e.idns.getElById("applyChildrenCheck"),this.controls.addText=e.idns.getElById("addTextEdit"),this.controls.findText=e.idns.getElById("findTextEdit"),this.controls.replaceText=e.idns.getElById("replaceTextEdit"),this.controls.groupActionCombo=e.idns.getElById("groupAction"),this.controls.dropDownBtn=e.idns.getElById("addtextBtn")},getApplyChildrenCheck:function(){return this.controls.applyToChildren.wuxControl.checkFlag},updateUIFromModel:function(e){this.controls.applyToChildren.wuxControl.checkFlag=e.ApplyTextToChildren,this.controls.dropDownBtn.wuxControl.value=e.ApplyTextPos===EnoApplyTextPos.Before?"before":"after",this.controls.groupActionCombo.wuxControl.currentValue=t.groupActionToString(e.GroupAction),this.controls.addText.wuxControl.value=e.Text,this.controls.findText.wuxControl.value=e.FindText,this.controls.replaceText.wuxControl.value=e.ReplaceText}})})),define("DS/AdvancedView/AdvModelFactory",["UWA/Controls/Abstract","DS/AdvancedView/models/SelectionModel","DS/AdvancedView/models/OptionsModel","DS/AdvancedView/models/TreeActionsModel","DS/AdvancedView/models/TreeModel"],(function(e,t,n,i,o){"use strict";return e.extend({init:function(e){this.advTree=e},createTreeModel:function(){return new o(this.advTree)},createOptionsModel:function(){return new n},createSelectionModel:function(){return new t},createTreeActionsModel:function(e){return new i(e)}})})),define("DS/AdvancedView/utils/UpdateActionModelHStrategy",["UWA/Controls/Abstract","DS/AdvancedView/converters/Converters"],(function(e,t){"use strict";return e.extend({init:function(e){this._parent(e),this.controls={},this.controls.applyAllRadio=e.idns.getElById("applyAllRadioH"),this.controls.applySelRadio=e.idns.getElById("applySelRadioH"),this.controls.applyToChildren=e.idns.getElById("applyChildrenCheckH"),this.controls.addText=e.idns.getElById("addTextEditH"),this.controls.findText=e.idns.getElById("findTextEditH"),this.controls.replaceText=e.idns.getElById("replaceTextEditH"),this.controls.groupActionCombo=e.idns.getElById("groupActionH"),this.controls.dropDownBtn=e.idns.getElById("addtextBtnH")},getApplyChildrenCheck:function(){return this.controls.applyToChildren.wuxControl.checkFlag},updateUIFromModel:function(e){this.controls.applyToChildren.wuxControl.checkFlag=e.ApplyTextToChildren,this.controls.dropDownBtn.wuxControl.value=e.ApplyTextPos===EnoApplyTextPos.Before?"before":"after",this.controls.groupActionCombo.wuxControl.currentValue=t.groupActionToString(e.GroupAction),this.controls.addText.wuxControl.value=e.Text,this.controls.findText.wuxControl.value=e.FindText,this.controls.replaceText.wuxControl.value=e.ReplaceText}})})),define("DS/AdvancedView/views/ActionsPanel",["DS/AdvancedView/views/ToolsPanel","DS/AdvancedView/UIUpdate","DS/AdvancedView/converters/Converters","DS/LifecycleServices/Utils","DS/LifecycleServices/IdNs","DS/AdvancedView/utils/UpdateActionModelVStrategy","DS/AdvancedView/utils/UpdateActionModelHStrategy","DS/LifecycleServices/HTMLTemplating","text!DS/AdvancedView/assets/html/actionpanelv.html","text!DS/AdvancedView/assets/html/actionpanelh.html","i18n!DS/AdvancedView/assets/nls/AdvancedViewNls","css!DS/AdvancedView/AdvancedView"],(function(e,t,n,i,o,s,r,a,c,l,d){"use strict";return e.extend({defaultOptions:{identifier:""},init:function(e,n,o,s){d=i.createDbgNlsProxy(d);var r=this,a=s||{};this.options=UWA.merge(a,this.defaultOptions),this.treeModel=o,this.UIUpdate=new t,this._parent({identifier:"d94c75a2-6828-11e9-a923-1681be663d3e"+this.options.identifier,immersiveFrame:e,model:n}),this.options=UWA.merge(UWA.merge(a,this.defaultOptions),this.options),this.updateUI=i.debounce(this._updateUI.bind(this),100),this._delayedUpdateModel=i.debounce(this._updateModel.bind(this),100);var c=!1;o.addEvent("OnSelChangeTree",(function(e){var t=0!==e.getSelectedCount();t!==c&&(c=t,r._delayedUpdateModel())}))},getContent:function(){return this.content||this.createContent()},getTitle:function(){return d.tools},createContent:function(){var e=this;this.content=UWA.createElement("div",{class:"adv-action-panels"});var t=new o(this.content,"enolcm-adv-actionpanel-");this.verticalLayout=UWA.createElement("div").inject(this.content),this.horzLayout=UWA.createElement("div").inject(this.content);var i={applyAction:function(){e.model.applyAction()},onChangeActionCombo:function(t){e.model.GroupAction=n.groupStringToAction(t),e.model.applyAction()},addText:function(){e.model.applyText()},onApplyChildrenChange:function(t){e._updateModel()},onChangeAddCombo:function(t){e.model.ApplyTextPos="before"===t?EnoApplyTextPos.Before:EnoApplyTextPos.After},replace:function(){var t=e._updateModel();t.FindText.length>0&&t.applyReplace()},reset:function(){e._updateModel().reset()},setProperty:function(t,n){"addText"===t?e.model.Text=n:"findText"===t?e.model.FindText=n:"replaceText"===t&&(e.model.ReplaceText=n),e.updateUI(e.treeModel)}},u={actions:function(){var e="";return this.actionsArray.forEach((t=>{e+=a.Expand("<option value={{value}}>{{name}}</option>",t)})),e},actionsArray:[]};return this.model.getActions().forEach((e=>{e==EnoTreeNodeAction.Duplicate?(u.actionsArray.push({name:d.duplicate,value:"Duplicate",sortPri:1}),u.actionsArray.push({name:d.duplicateTree,value:"DuplicateTree",sortPri:2})):e==EnoTreeNodeAction.DuplicateWDrw?u.actionsArray.push({name:d.duplicateWDrw,value:"DuplicateDrw",sortPri:3}):e==EnoTreeNodeAction.Reuse?u.actionsArray.push({name:d.reuse,value:"Reuse",sortPri:4}):e==EnoTreeNodeAction.Exclude?u.actionsArray.push({name:d.exclude,value:"Exclude",sortPri:5}):e==EnoTreeNodeAction.Branch&&(u.actionsArray.push({name:d.branch,value:"Branch",sortPri:1}),u.actionsArray.push({name:d.branchTree,value:"BranchTree",sortPri:2}))})),u.actionsArray.sort(((e,t)=>e.sortPri<t.sortPri?-1:e.sortPri>t.sortPri?1:0)),t.elementFromTemplate(c,u,d,i).inject(this.verticalLayout),t.elementFromTemplate(l,u,d,i).inject(this.horzLayout),this._connectButtons(t),this.updateActionModelVStrategy=new s({idns:t}),this.updateActionModelHStrategy=new r({idns:t}),this.content},_connectButtons:function(e){var t=this,n=function(n){var i=e.getElById(n);t.UIUpdate.addElement(i,(function(e){return!e.applyToAll}))};n("applyChildrenCheck"),n("applyChildrenCheckH");var i=function(n){var i=e.getElById(n);t.UIUpdate.addElement(i,(function(e){return e.haveTreeSelection&&e.haveFindText}))};i("replaceBtn"),i("replaceBtnH");var o=function(n){var i=e.getElById(n);t.UIUpdate.addElement(i,(function(e){return e.haveTreeSelection&&e.haveAddText}))};o("addtextBtn"),o("addtextBtnH"),this.addEvent("applyModeChanged",(function(e){t.updateUI(e)}))},_updateModel:function(){return this.model.ApplyToAll=0===this.treeModel.getSelectedCount(),this.model.ApplyTextToChildren=this.updateModelStrategy.getApplyChildrenCheck(),this.model},_updateUI:function(){this.UIUpdate.update({haveTreeSelection:this.treeModel.getSelectedNodes().length>0||this.model.ApplyToAll,haveAddText:this.model.Text.length>0,haveFindText:this.model.FindText.length>0,haveReplaceText:this.model.ReplaceText.length>0,applyToAll:this.model.ApplyToAll})},_setLayout:function(e){var t=null;this.updateModelStrategy&&(t=this._updateModel()),e===EnoPanelLayout.Vertical?(this.verticalLayout.setStyle("display","block"),this.horzLayout.setStyle("display","none"),this.updateModelStrategy=this.updateActionModelVStrategy):(this.verticalLayout.setStyle("display","none"),this.horzLayout.setStyle("display","block"),this.updateModelStrategy=this.updateActionModelHStrategy),t&&this.updateModelStrategy.updateUIFromModel(t)},_initialUpdate:function(e){this._setLayout(e),this._updateModel()}})})),define("DS/AdvancedView/AdvancedTree",["UWA/Controls/Abstract","DS/ENOjquery/ENOjquery","DS/AdvancedView/views/SelectionPanel","DS/AdvancedView/views/ActionsPanel","DS/AdvancedView/views/OptionsPanel","DS/AdvancedView/views/ExpandOptionsPanel","DS/AdvancedView/AdvModelFactory","DS/AdvancedView/utils/TreeNodeFiltering","DS/AdvancedView/converters/Converters","DS/AdvancedView/utils/RegExReplace","DS/Controls/LineEditor","DS/Windows/ImmersiveFrame","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleServicesSettings","DS/LifecycleCmd/Dictionary","DS/LifecycleCmd/MessageMediator","DS/AdvancedView/AssemblyDGVList","DS/LifecycleServices/AssemblyJson","DS/LifecycleServices/TranslationService","DS/LifecycleControls/NumberModal","DS/LifecycleServices/Utils","DS/LifecycleServices/WebReq","DS/LifecycleServices/ChunkedwebReq","DS/AdvancedView/ExtensibilityConstants","DS/LifecycleControls/CommandDialogWUX","DS/Controls/TooltipModel","i18n!DS/AdvancedView/assets/nls/AdvancedViewNls"],(function(e,t,i,o,s,r,a,c,l,d,u,h,p,f,g,A,v,m,y,T,C,E,S,N,D,b,w){"use strict";return e.extend({haveCatiaV5Data:!1,propagateTitleEditToInstances:!0,cadMaster:null,defaultOptions:{roots:[],tenant:"OnPremise",inputValidator:null,expandOneLevel:!0,modelFactory:null},stylesForCrossHighlight:{label:w.advancedDuplicate,styles:[{color:"#33F308",opacity:.9,forceInherit:!1,pickability:"NOT_PICKABLE",label:w.duplicate},{color:"#0362fc",opacity:.9,forceInherit:!1,pickability:"NOT_PICKABLE",label:w.reuse},{color:"#fcfafa",opacity:.2,forceInherit:!1,pickability:"NOT_PICKABLE",label:w.exclude}]},init:function(e){this._parent(e),w=C.createDbgNlsProxy(w),this.rootIds=[],this.assemblies=[],this.tenant=this.options.tenant,this.inputValidator=this.options.inputValidator,this.illegalChars=this.options.illegalChars||"",this.expandOneLevel=this.options.expandOneLevel,this.identifier=(e?e.identifier:null)||"",this.submitElement=this.options.submitElement,this.invalidElements=new Set,this.options.showError=this.options.showError?this.options.showError:()=>{},this.inputValidator&&(this.inputValidator.titleInputValidators=new g),this.translationService=new y({handleError:!0});for(var t=0;t<this.options.roots.length;++t)this.rootIds.push(this.options.roots[t]);this.modelFactory=this.options.modelFactory?this.options.modelFactory:new a(this),this.model=this.modelFactory.createTreeModel(),this.optionsModel=this.modelFactory.createOptionsModel(),this.selectionModel=this.modelFactory.createSelectionModel(),this.treeActionsModel=this.modelFactory.createTreeActionsModel(this.model),this.composeeOptions=e&&e.composeeOptions||{allExcludeComposeeTypes:[],composeeIncludeOptions:[]},this.updateTree=C.debounce(this._updateTree.bind(this),200),this.objsInPrivateCS=[],this.metadata=e?e.metadata:null,"branch"==this.identifier?(this.stylesForCrossHighlight.styles[0].label=w.newBranch,this.stylesForCrossHighlight.label=w.advancedNewBranch):(this.stylesForCrossHighlight.styles[0].label=w.duplicate,this.stylesForCrossHighlight.label=w.advancedDuplicate)},loadUI:function(e){return this.securityContext=e.securityContext,this.clearConfigurations=e.clearConfigurations,this.treeLoader=e.treeLoader,this.legacyExpand=e.legacyExpand||null,new UWA.Promise((async(t,n)=>{this.container=e.parentElement,this.immersiveFrame=e.immersiveFrame||this._createImmersiveFrame(this.container),this.dispatchEvent("expandingStructure");try{let n=await e.treeLoader.expand(e.securityContext),i=n.assemblies;this.assemblies=i,this.createTreeUI({idCounters:n.idCounters}),this.addEvent("onTreeListCreated",(async()=>{await this.treeList.onInitialUpdateView(),this.excludeObjsInPrivateCS(),C.crossHighlightWithColor(this.model,this.treeList,this.stylesForCrossHighlight,this.metadata),t()}))}catch(e){console.error(e),this.options.showError(e)}}))},setObjsInPrivateCS:function(e){this.objsInPrivateCS=e,this.haveSetPrivateToExclude=!1,this.treeList&&this.excludeObjsInPrivateCS()},excludeObjsInPrivateCS:function(){if(!this.objsInPrivateCS||!this.treeList||this.haveSetPrivateToExclude)return;this.haveSetPrivateToExclude=!0,this.treeList.getAllNodes().filter((e=>this.objsInPrivateCS.includes(e.physicalId))).map((e=>this.model.getModelFromTreeNode(e._treeNode))).forEach((e=>e.setAction(EnoTreeNodeAction.Exclude)))},getTreeData:function(){return this.getTreeNodesData()},_createImmersiveFrame:function(e){var t="4046f1f2-6823-11e9-a923-1681be663d3e"+this.identifier;window.c145ae486a7011e9a9231681be663d3e&&(t=void 0);var n=new h({identifier:t});n.dockingElements.forEach((function(e){e._properties.side.value===WUXDockAreaEnum.TopDockArea||e._properties.side.value==WUXDockAreaEnum.BottomDockArea?e._properties.dockingZoneSize.value=120:e._properties.side.value!==WUXDockAreaEnum.LeftDockArea&&e._properties.side.value!=WUXDockAreaEnum.RightDockArea||(e._properties.dockingZoneSize.value=230)}));var i=UWA.createElement("div",{class:"immersive-frame-parent"});return i.inject(e),n.inject(i),n},openAdvancedTreeODT:function(e,t,n){require(["DS/LifecycleServices/expandServices/duplicateExpand","DS/LifecycleServices/expandServices/ExpandReqBuilder"],((i,o)=>{e||(e=UWA.createElement("div",{styles:{width:"400px",height:"200px",border:"solid 1px black"}})).inject(document.body);let s=n.loader||new i({roots:n.roots,securityContext:t,tenant:this.tenant,expandReqBuilder:n.expandReqBuilder||new o(this.context),getAuthoringMode:n.getAuthoringMode?n.getAuthoringMode:()=>!0});s.addEvent("onExpandDone",(e=>{this.dispatchEvent("onLoaderExpandDone",e)})),this.loadUI({immersiveFrame:n.immersiveFrame,parentElement:e,securityContext:t,treeLoader:s,legacyExpand:n.legacyExpand?n.legacyExpand.bind(this):null})}))},getTreeNodesData:function(){return this._getData()},_createActionOptsFromArray:function(e){var t={options:[],translated:[],code:[]},n=0;return e.forEach((function(e){switch(e){case EnoTreeNodeAction.Duplicate:t.options.push("duplicate"),t.translated.push(w.duplicate),t.code.duplicate=EnoTreeNodeAction.Duplicate;break;case EnoTreeNodeAction.Reuse:t.options.push("reuse"),t.translated.push(w.reuse),t.code.reuse=n++;break;case EnoTreeNodeAction.Exclude:t.options.push("exclude"),t.translated.push(w.exclude),t.code.exclude=n++;break;case EnoTreeNodeAction.DuplicateWDrw:t.options.push("duplicate2"),t.translated.push(w.duplicatewithdrw),t.code.duplicate2=n++;break;case EnoTreeNodeAction.Branch:t.options.push("branch"),t.translated.push(w.branch),t.code.branch=n++}})),t},getOptions:function(e){var t=[];return e&&(t=e.getSupportedActions()),this._createActionOptsFromArray(t)},_TreeNodeAction2WebserviceAction:function(e){return e===EnoTreeNodeAction.Duplicate?"duplicate":e===EnoTreeNodeAction.DuplicateWDrw?"duplicate2":e===EnoTreeNodeAction.Reuse?"reuse":e===EnoTreeNodeAction.Exclude?"exclude":e===EnoTreeNodeAction.Branch?"branch":void 0},_getDataR:function(e,t,n,i,o,s){let r,a=m.getNode(e.options.assembly,e.options.nodeId),c=this.model.getModelFromTreeNode(e);if(r=a.connectToParent?s:c.getAction(),t&&(r===EnoTreeNodeAction.Duplicate||r===EnoTreeNodeAction.DuplicateWDrw||r===EnoTreeNodeAction.Reuse||r===EnoTreeNodeAction.Branch||r===EnoTreeNodeAction.Exclude)){let i=m.getRelationshipData(e.options.assembly,t.options.occId,e.options.occId),o=n.find(t.options.physicalId),s=this._TreeNodeAction2WebserviceAction(r);"duplicate2"===s&&(s="duplicate"),o.relations.push({physicalid:i.pid,type:i.type,subType:i.subType,enoviaSubType:i.enoviaSubType,operation:s})}if(n.contains(e.options.physicalId))return;let l,d={physicalid:c.getNodeOption("physicalId"),isRootNode:i,operation:this._TreeNodeAction2WebserviceAction(r),title:c.getNewTitle(),revision:c.getGridAttribute("revision"),relations:[]};if(a?.attributes["expand::titleAttribute"]&&(l=a.attributes["expand::titleAttribute"]),l&&(d.titleAttribute=l),o.push(d),n.add(e.options.physicalId,d),r===EnoTreeNodeAction.Reuse||r===EnoTreeNodeAction.Exclude)return;let u=e.getChildren();if(u)for(let t=0;t<u.length;++t)this._getDataR(u[t],e,n,!1,o,r)},_getData:function(){var e=[],t=new g;return this.treeList.tree.getTreeDocument().getRoots().forEach((n=>{this._getDataR(n,null,t,!0,e,-1)})),e},_parseExpandState:function(e){var t=e?e.split("."):[];return t.length>1?{state:t[1],policy:t[0]}:{state:e}},_addChildToAssembly:function(e,t,n,i){var o=UWA.merge({nodeid:i.nextNodeId},n);e.nodes.push(o);let s=i.nextNodeId++,r=i.nextOccId++;var a={nodeid:s,occurrenceid:r};e.occurrences.push(a),e.occurrences.forEach((function(i){if(i.nodeid===t){var o={child:r,parent:i.occurrenceid,physicalid:n.relid,type:n.reltype};e.occurrencerelationships.push(o)}}),this)},initTreeNode:function(e){e.newTitle=e.Title,e.connectToParent=!1,e.isEmbeddedComponent=!1},createTreeUI:function(e){e=e||{};var t=[],n=new Map;this.assemblies.forEach((e=>{e.nodes.forEach((function(e){var t=this._parseExpandState(e.state);t.hasOwnProperty("policy")?this.translationService.addStateAndPolicy(t.state,t.policy):this.translationService.addStateAndType(e.state,e.type),this.translationService.addType(e.type),e.cadMaster&&(("3DEXPERIENCE"===e.cadMaster||this.cadMaster&&"3DEXPERIENCE"!==this.cadMaster)&&this.cadMaster||(this.cadMaster=e.cadMaster))}),this)}),this),"CATIAV5"!=this.cadMaster&&"SOLIDWORKS"!=this.cadMaster||(this.haveCatiaV5Data=!0);let i=new Map([[N.ExpandNodeCapabilites.Duplicate,EnoTreeNodeAction.Duplicate],[N.ExpandNodeCapabilites.Reuse,EnoTreeNodeAction.Reuse],[N.ExpandNodeCapabilites.Exclude,EnoTreeNodeAction.Exclude],[N.ExpandNodeCapabilites.Branch,EnoTreeNodeAction.Branch],[N.ExpandNodeCapabilites.Max,EnoTreeNodeAction.DuplicateWDrw]]);var o=this,s=new Set;UWA.Promise.all([this.translationService.initAsync(this.tenant)]).then((function(){o.assemblies.forEach((e=>{e.nodes.forEach((function(r){o.initTreeNode(r);var a=o._parseExpandState(r.state);if(r.maturityNls=this.translationService.translateState(a.state),r.typeRaw=r.type,r.type=this.translationService.translateType(r.typeRaw),this.model._addType(r.typeRaw,r.type),this.model._addState(a.state,r.maturityNls),e.legacyExpand)"CATIA Embedded Component"===r.typeRaw&&(r.isEmbeddedComponent=!0),this.haveCatiaV5Data?[EnoTreeNodeAction.Duplicate,EnoTreeNodeAction.Reuse,EnoTreeNodeAction.Exclude,EnoTreeNodeAction.DuplicateWDrw].forEach((e=>s.add(e))):[EnoTreeNodeAction.Duplicate,EnoTreeNodeAction.Reuse,EnoTreeNodeAction.Exclude].forEach((e=>s.add(e)));else{let e=r.attributes["expand::capabilities"]||[N.ExpandNodeCapabilites.Duplicate,N.ExpandNodeCapabilites.Reuse,N.ExpandNodeCapabilites.Exclude,N.ExpandNodeCapabilites.ChangeTitle];(e.includes(N.ExpandNodeCapabilites.Duplicate)&&"CATIAV5"==r.cadMaster||"SOLIDWORKS"==r.cadMaster)&&e.push(N.ExpandNodeCapabilites.Max),r.supportedActions=r.supportedActionsV5=e.map((e=>i.has(e)?i.get(e):-1)).filter((e=>-1!==e)),e=e.sort(),r.supportedActions.forEach((e=>s.add(e))),r.supportedActions.includes(EnoTreeNodeAction.Duplicate)&&this.haveCatiaV5Data&&s.add(EnoTreeNodeAction.DuplicateWDrw),r.capabilites=e.filter((e=>e>=N.ExpandNodeCapabilites.ChangeTitle&&e!==N.ExpandNodeCapabilites.Branch)),e.includes(N.ExpandNodeCapabilites.FollowParent)&&(r.connectToParent=!0);let t=r.attributes["expand::defaultAction"]||-1;null==r.defaultAction&&-1!=t&&e.includes(t)&&(r.defaultAction=i.get(t))}r.attributes.type_icon_url||(r.attributes.type_icon_url=f.get3DSpaceWSUrl("","/snresources/images/icons/small/I_VPMNavProduct.png",null)),e.legacyExpand&&(t.push(r.physicalid),n.has(r.physicalid)||n.set(r.physicalid,[]),n.get(r.physicalid).push({assembly:e,node:r}))}),o)}),this),o.treeActionsModel.setActions(s),0==t.length?o.createAdvancedTree():o.legacyExpand&&null!==o.legacyExpand&&o.legacyExpand(t,n,e.idCounters)})).catch((e=>{console.error("Error: "+e)}))},isConnectedToParent:function(e){return e.assyNode.isEmbeddedComponent||e.assyNode.connectToParent},getActions:function(e){return this.getOptions(e).translated},_updateChildTreeR:function(e,t){t?e.disable():e.enable();let n=e.getChildren()||[];if(n.length>0){let t=!!e.isDisabled()&&e.isDisabled();if(!t){let n=e.getAction();t=n!=EnoTreeNodeAction.Duplicate&&n!=EnoTreeNodeAction.DuplicateWDrw&&n!=EnoTreeNodeAction.Branch}for(var i=0;i<n.length;++i)this._updateChildTreeR(n[i],t)}},_updateChildTree:function(e,t){let n=t!=EnoTreeNodeAction.Duplicate&&t!=EnoTreeNodeAction.DuplicateWDrw&&t!=EnoTreeNodeAction.Branch;for(var i=e.getChildren()||[],o=0;o<i.length;++o)this._updateChildTreeR(i[o],n)},_appendInstances:function(e){return this.treeList.getAllNodes().filter((t=>t.physicalId===e.treeNode.physicalId)).map((e=>this.model.getModelFromTreeNode(e._treeNode)))},_createActionColumn:function(){var e=this,t=C;let n=this.treeList.getCol("advancedAction");return n.text=w.action,this.treeList.setupDropdownListCol(n,185,!1,(function(t){let n=t.nodeModel;if(!n)return;let i=e.model.getModelFromTreeNode(n),o=e.getActions(i);if(e.isConnectedToParent(i)){o=[i.treeNode.getParent()._treeNode.getAttributeValue("advancedAction")]}let s=!!n.options.disabled&&n.options.disabled;return(o.length<=1||e.isConnectedToParent(i))&&(n.options.locked=!0),{disabled:n.options.disabled||n.options.locked,possibleValues:s?[]:o}}),(function(t){let n=t.nodeModel;if(!n)return;let i=e.model.getModelFromTreeNode(n).getAction();return e._createActionOptsFromArray([i]).translated[0]}),(function(t){return"adv-actionCombo"+(e.objsInPrivateCS.includes(t.nodeModel?.options?.physicalId)?" highlight-in-private-cs":"")}),(function(n,i){let o=n.nodeModel;if(!o)return;let s=e.model.getModelFromTreeNode(o),r=s.getActionFromValue(i);r===EnoTreeNodeAction.DuplicateWDrw&&A.dispatchEvent(AdvancedViewEvents.includeAllDrwOptionSet,!1),e._appendInstances(s).forEach((function(t){t.setAction(r),e._updateChildTree(t,r)})),e.model.getSelectedCount()>1&&e.treeActionsModel.applySelectionAction(r),setTimeout((function(){t.crossHighlightWithColor(e.model,e.treeList,e.stylesForCrossHighlight,e.metadata)}),200)})),n},_fixupSelIndexOnRoot:function(e,t){return t.isRoot&&this.haveCatiaV5Data&&1===e?this.getOptions().code.duplicate2:e},_installCellInputValidator:function(e){if(this.inputValidator){var t=e.nodeModel.options.occId,n=null;if(this.inputValidator.titleInputValidators.contains(t))n=this.inputValidator.titleInputValidators.find(t);else{let i=this.model.getModelFromTreeNode(e.nodeModel).getTitleMaxLength();const o=this.inputValidator.validators.map((e=>{if(-1!=i&&"function"==typeof e.setTitleMaxLength){let t={...e};return t.setTitleMaxLength(i),t}return e}));(n=this.inputValidator.inputValidator.addValidateElementNoUI(o)).createInfo={label:e.nodeModel.options.label,id:t},n.setCustomId(t),this.inputValidator.titleInputValidators.add(t,n)}return n}},_createTitleColumn:function(){let e=this,t=e.treeList.tree,n=e.treeList.getCol("newTitle");t.addEventListener("liveChange",(function(n,i){if(i.columnID!==t.layout.getColumnIndex("newTitle"))return;let o=i.nodeModel;if(!o)return;let s=e.model.getModelFromTreeNode(o),r=n.options.value;e.updateInvalidElements(s.isTitleValid(r.trim()),s.getOccId()),e.updateSubmitBtnState()})),t.getTreeDocument().onNodeModelUpdate((function(t){let n=t.data.nodeModel;if(!n)return;let i=t.data.attributes,o=i.newTitle,s=i.advancedAction,r=e.model.getModelFromTreeNode(n);o?(e.updateInvalidElements(r.isTitleValid(o.trim()),r.getOccId()),e.updateSubmitBtnState()):s&&(r.isDisabled()||s!=EnoTreeNodeAction.Duplicate&&s!=EnoTreeNodeAction.DuplicateWDrw&&s!=EnoTreeNodeAction.Branch?e.updateInvalidElements(!0,r.getOccId()):e.updateInvalidElements(r.isTitleValid(o.trim()),r.getOccId()),e.updateSubmitBtnState())})),e.treeList.setupLineEditorCol(n,(function(t){let n=t.nodeModel;if(!n)return;let i=e.model.getModelFromTreeNode(n),o=i.getAction(),s=i.getCanEditTitle(),r=i.isDisabled(),a=o!=EnoTreeNodeAction.Duplicate&&o!=EnoTreeNodeAction.DuplicateWDrw&&o!=EnoTreeNodeAction.Branch;return!(!0===r||a||!s)}),(function(t){let n=t.nodeModel;if(!n)return;let i=e.model.getModelFromTreeNode(n),o=i.getAction(),s=i.getNewTitle(),r=i.isDisabled(),a=o!=EnoTreeNodeAction.Duplicate&&o!=EnoTreeNodeAction.DuplicateWDrw&&o!=EnoTreeNodeAction.Branch;return!0===r||a?"":s}),(function(e){if(e.nodeModel)return"adv-titleLineEdit"}),(function(t){let n=t.nodeModel;if(n)return{pattern:e.model.getModelFromTreeNode(n).computeInputPattern(e.illegalChars)}}),(function(t,n){let i=t.nodeModel;if(!i)return;let o=e.model.getModelFromTreeNode(i);e.setNewTitle(o,n)}))},setNewTitle:function(e,t){(this.propagateTitleEditToInstances?this._appendInstances(e):[e]).forEach((function(e){e.setNewTitle(t)}))},setAdvancedActionR:function(e,t,i){let o=this;e.forEach((function(e){var s=!!e.isDisabled()&&e.isDisabled()&&!e.isSelected(),r=e.getAction();if(!s&&(r!=t||i)){if(!m.getNode(e.assembly,e.getId()).connectToParent)t===EnoTreeNodeAction.DuplicateWDrw&&A.dispatchEvent(AdvancedViewEvents.includeAllDrwOptionSet,!1),this._appendInstances(e).forEach((function(e){e.setAction(t),o._updateChildTree(e,t)}));if(i){var a=n.getChildren()||[];this.setAdvancedActionR(a,t,i)}}}),this)},setAdvancedAction:function(e,t,n){this.setAdvancedActionR(e,t,n)},createAdvancedTree:function(){var e=this,t=["maturityNls","revision","advancedAction","newTitle"];"branch"===this.identifier&&"AxisSystemReference"in this.model.Types.data&&t.unshift("instanceTitle"),this.treeList=new v({getChildrenInTreeOrder:!0,allCols:t,useKeyboard:!0,identifier:this.identifier,submitElement:this.okBtn,onContextualEvent:function(t){let n=[];if(t?.collectionView){let o={filter:!0,pin:!0,sizeColumnToFit:!0,columnsManagement:!1,firstColumnsVisibility:!1};if(n=t.collectionView.buildDefaultContextualMenu(t,o),0===t.cellInfos?.columnID&&t.cellInfos?.rowID>-1){let o=t.cellInfos.nodeModel,s=e.treeList.getSelectedNodes().map((t=>e.model.getModelFromTreeNode(t._treeNode)));if(n.push({type:"PushItem",title:w.expandAll,action:{callback:function(e){s.forEach((e=>e.expandAll()))}}}),n.push({type:"PushItem",title:w.expandNLevels,action:{callback:function(n){s.length>0&&new T({parentContainer:e.treeList.getContent(),windowPos:t.data.windowPosition,events:{onApply:function(e){s.forEach((t=>t.expandn(e)))}}})}}}),n.push({type:"PushItem",title:w.collapseAll,action:{callback:function(e){s.forEach((e=>e.collapseAll()))}}}),"branch"===e.identifier&&s.every((e=>e.isRoot))&&s.length<e.rootIds.length&&n.push({type:"PushItem",title:w.remove,action:{callback:function(t){e._displayRemoveDialog(s)}}}),e.debugMenuItems){var i={advancedTree:e,selNode:o,selNodes:s};e.debugMenuItems.forEach((function(e){e.action&&e.action.callback&&(null==e.action.orgFn&&(e.action.orgFn=e.action.callback),e.action.callback=function(){e.action.orgFn(i)})})),n=n.concat(e.debugMenuItems)}}}return n}});var n=["maturityNls","revision","advancedAction","newTitle"];let r={},a={filterId:"stringRegexp"},c={filterId:"set"};if(r.label=a,r.maturityNls=c,r.revision=a,r.advancedAction=c,r.newTitle=a,"branch"===this.identifier&&"AxisSystemReference"in this.model.Types.data&&(n.unshift("instanceTitle"),r.instanceTitle=a),this.treeList.load(this.assemblies,n,{filterDuplicates:!1,noExpandAll:!0},r),this._createActionColumn(),this._createTitleColumn(),this.treeList.insertCol(1,{text:"txt",dataIndex:"Revision",isSortable:!1,type:"string",width:120}),this.UpdateView=function(){e.updateTree()},this.container.style.padding="0px",this.expandOneLevel)this.treeList.tree.getTreeDocument().collapseAll(),this.treeList.tree.getTreeDocument().expandNLevels(1);else{var l=this.treeList.tree.getTreeDocument().getNthRoot(0);setTimeout((()=>{l.expandAll()}),100)}A.addEvent(AdvancedViewEvents.includeAllDrwOptionOnChange,(function(t){if(0!=t){var n=e.treeList.getNodes((function(t){return e.model.getModelFromTreeNode(t).getAction()===EnoTreeNodeAction.DuplicateWDrw}));e.setAdvancedAction(n.map((function(t){return e.model.getModelFromTreeNode(t._treeNode)})),EnoTreeNodeAction.Duplicate,!1)}})),this.treeList.inject(this.immersiveFrame.getFreeZone()),this._setupLogic();var d=new i(this.immersiveFrame,this.selectionModel,this.model,{identifier:this.identifier}),u=new o(this.immersiveFrame,this.treeActionsModel,this.model,{identifier:this.identifier});if(this.optionsModel.haveCatiaV5Data=this.haveCatiaV5Data,(this.haveCatiaV5Data||this.clearConfigurations||this.composeeOptions.composeeIncludeOptions.length>0)&&this.treeActionsModel.actions&&this.treeActionsModel.actions.includes(EnoTreeNodeAction.Duplicate))new s(this.immersiveFrame,this.optionsModel,{identifier:this.identifier,haveCatiaV5Data:this.haveCatiaV5Data,clearConfigurations:this.clearConfigurations,composeeOptions:this.composeeOptions});u.haveStoredPlacement()||u.panel.attachToWindow(d.panel,WUXSnapAreaEnum.InsideArea,"after"),this.model.addEvent("OnTreeInitialized",(async function(){let t=!1;if(e.options.getAuthoringMode&&(t=await e.options.getAuthoringMode()),!t&&(this.treeList.tree.getTreeDocument().getRoots().forEach((function(e){m.getNode(e.options.assembly,e.options.nodeId).isFilteredRoot&&e.setBadges({bottomRight:"filter"})})),"branch"===this.identifier))try{this.treeLoader.getFilterSpecifications().then((function(t){if(0===t.length&&0===e.treeLoader.filteredRoots.size)return;e.treeList.tree.getColumnOrGroup("tree").getCellSemantics=function(t){let n=m.getNode(t.nodeModel.options.assembly,t.nodeModel.options.nodeId);if(!n.isFilteredRoot)return;let i=e.treeLoader.filteredRoots.get(n.physicalid).title;t.cellView.elements.container.querySelector(".wux-layouts-treeview-icons").tooltipInfos=new b({shortHelp:i}),e.dispatchEvent("onFilterDataLoaded")},e.treeList.tree.updateColumnView("tree",{updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!1})}))}catch(e){console.error(e),reject(e)}}),this);var h=function(){d.updateUI(),u.updateUI()};this.model.addEvent("OnSelChangeTree",(function(e){h()})),h(),this.dispatchEvent("onTreeListCreated")},_setupLogic:function(){var e=this,t=this.model,n=(this.optionsModel,this.selectionModel),i=this.treeActionsModel,o=new c(t);n.addEvent("OnClearSelection",(function(){t.clearSelection()})),n.addEvent("OnAddSelection",(function(e){o.filterNodes(e).forEach((function(e){e.select()}))})),n.addEvent("OnRemoveSelection",(function(e){o.filterNodes(e).forEach((function(e){e.unselect()}))})),this.model.addEvent("onActionChangeTree",(function(t){let n=!1;t.nodes.forEach((function(t){let i=t.node.getAction();i===EnoTreeNodeAction.DuplicateWDrw&&(n=!0),e._updateChildTree(t.node,i)})),n&&A.dispatchEvent(AdvancedViewEvents.includeAllDrwOptionSet,!1)}));var s=function(e){var t;"function"==typeof e.forEach?t=e:(t=[]).push(e);var n=[];return t.forEach((function(e){n=n.concat(e.getChildren())})),n.forEach((function(e){n=n.concat(s(e))})),n},r=function(e,n,o){var r=(null==o?i.ApplyToAll:o)?t.getAllNodes():t.getSelectedNodes();if(e&&!i.ApplyToAll){var a=s(r);r=r.concat(a)}return n&&!i.ApplyToAll&&(r=t.appendInstances(r)),r},a=function(){return!1===i.ApplyToAll&&!0===i.ApplyTextToChildren},u=this,h=C,p=function(e,n,i){try{t.setBatchMode(!0),r(!1,!0,i).forEach((function(t){if(n){var i=function(e,t){e.getChildren().forEach((function(e){i(e,t)})),e.setAction(t)};i(t,e)}else t.setAction(e)}))}finally{t.setBatchMode(!1)}h.crossHighlightWithColor(u.model,u.treeList,u.stylesForCrossHighlight,u.metadata)};i.addEvent("OnApplyAction",(function(){var e=l.groupActionToNodeAction(i.GroupAction),t=l.groupActionToRecursive(i.GroupAction);p(e,t,i.ApplyToAll)})),i.addEvent("OnApplySelectionAction",(function(e){p(e,!1,!1)}));var f=function(t,n){e.propagateTitleEditToInstances=!1,e.setNewTitle(t,n),e.propagateTitleEditToInstances=!0};i.addEvent("OnAddPrefixText",(function(){r(a(),!0).forEach((function(e){f(e,i.Text+e.getNewTitle())}))})),i.addEvent("OnAddPostfixText",(function(){r(a(),!0).forEach((function(e){var t,n;f(e,(t=e.getNewTitle(),n=i.Text,t+n))}))})),i.addEvent("OnReplace",(function(){r(!1,!0).forEach((function(e){f(e,d.replace(e.getNewTitle(),i.FindText,i.ReplaceText))}))})),i.addEvent("OnReset",(function(){r(!1,!0).forEach((function(t){e.propagateTitleEditToInstances=!1,t.reset(),e.propagateTitleEditToInstances=!0}))}))},_updateTree:function(){this.treeList&&this.treeList.tree&&this.treeList.tree.updateView()},updateInvalidElements:function(e,t){null!=t&&(e?this.invalidElements.delete(t):this.invalidElements.add(t))},initInvalidElements:function(){let e=this;this.treeList.tree.getTreeDocument().getAllDescendants().forEach((function(t){let n=e.model.getModelFromTreeNode(t),i=n.getAction();n.isDisabled()||i!=EnoTreeNodeAction.Duplicate&&i!=EnoTreeNodeAction.DuplicateWDrw&&i!=EnoTreeNodeAction.Branch||(n.computeInputPattern(e.illegalChars),e.updateInvalidElements(n.isTitleValid(n.getNewTitle().trim()),n.getOccId()))})),this.updateSubmitBtnState()},updateSubmitBtnState:function(){this.submitElement&&(this.submitElement.disabled=this.invalidElements.size>0)},launchCrossHighlightWithColor:function(){C.crossHighlightWithColor(this.model,this.treeList,this.stylesForCrossHighlight,this.metadata)},_displayRemoveDialog:function(e){var t=this,n=new D,i=UWA.createElement("div",{html:[e.length>1?w.doYouWantToRemoveMulti+" ?":w.doYouWantToRemove+" "+e[0].assyNode.Title+" ?","<br>",w.removeRestriction],class:"prompt_content"});n.createDialog(i,{title:w.remove+" - "+(e.length>1?e.length+" "+w.multipleSelectionObjects:e[0].assyNode.Title),identifier:"RemoveContextualCommand",container:t.container,modalFlag:!0,OKBtnText:w.remove,closeButtonFlag:!0,onOk:function(){e.forEach((function(e){var n=t.rootIds.indexOf(e.assyNode.physicalid);t.rootIds.splice(n,1),e.remove()})),n.destroy()},onClose:function(){n.destroy()}})}})}));