define("DS/DMUPlayMeasure/DMUMeasureImport",["UWA/Class","DS/DMUMeasurable/DMUMeasurable","DS/DMUBaseExperience/EXPUtils"],(function(e,t,i){"use strict";return e.extend({init:function(e){this.importData=function(n,r,o){if(n&&r&&e){r.fillObjectAttributes(e,n,o);for(var a=n.measurables.length,s=0;s<a;s++){var l=new t({},!0).importData(n.measurables[s],i.strToType);e.setMeasurable(s+1,l)}if(n.cumulativeMeasurables){a=n.cumulativeMeasurables.length;for(var u=0;u<a;u++){var c=new t({},!0).importData(n.cumulativeMeasurables[u],i.strToType);e.setCumulativeMeasurables(c)}}r.registerForPostImport(e)}},this.afterImport=function(){e&&e.fireEvent("onDMUObjectInitialized",{dmuObject:e})}}})})),define("DS/DMUPlayMeasure/DMUMeasureNode3D",["UWA/Core","DS/DMUMeasurable/DMUMeasureEnums","DS/DMUBaseUI/DMUManipulableNode3D","DS/DMUBaseUI/DMUToolsLeader","DS/DMUBaseUIManipulators/DMUManipulatorsHelper","DS/DMUMeasurable/DMUToolsMaths","DS/DMUMeasurable/DMUMathsBoundingGeometry","DS/DMUMeasurable/DMUMathsFiniteGeometry","DS/DMUMeasurable/DMUMathsVector3D","DS/DMUMeasurable/DMUGeometryEnums","DS/DMUMeasurable/DMUToolsAvatars","DS/DMUBaseUIControllers/DMUWebPreferencesController","DS/DMUBaseExperience/EXPUtils","DS/Visualization/ThreeJS_DS","DS/Visualization/SceneGraphFactory","DS/Visualization/Node3D","DS/Manipulators/PlaneTranslationManipulator","DS/Manipulators/RotationManipulator","DS/SceneGraphNodes/ArrowNode","DS/SceneGraphNodes/BillBoardNode3D","DS/SceneGraphNodes/FixedSizeNode3D","DS/DMUMarkerVisu/DMUMarkerVisuMeasureShapeNode","DS/DMUBaseExperience/EXPToolsVisualization","DS/Selection/CSOManager","DS/Selection/PSOManager","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/EXPToolsMaterial","DS/DMUBaseExperience/DMUToolsClipping","DS/DMUMeasurable/DMUToolsMeasure","DS/Mesh/Mesh","DS/DMUMeasurable/DMUMeshMeasure","DS/DMUMeasurable/DMUMathsInfiniteGeometry","DS/DMUBaseUIServices/DMUObjectsServices","i18n!DS/CATWebUXPreferences/assets/nls/CATWebUXPreferences"],(function(e,t,i,n,r,o,a,s,l,u,c,p,d,g,h,b,y,m,v,P,A,f,w,M,S,T,D,C,_,E,L,R,N,x,V){"use strict";return i.extend({init:function(i){this._parent(i);var m=this.getViewer();let I=!1;function k(e){"Shift"===e.key&&(I=!1)}function F(e){"Shift"===e.key&&(I=!0)}function O(){return I}document.addEventListener("keyup",k),document.addEventListener("keydown",F),this.clearEvents=function(){document.removeEventListener("keyup",k),document.removeEventListener("keydown",F)};var B=i.owner.getAttribute("cLineStyleColor"),U=i.owner.getAttribute("cFillStyleColor"),G=new g.Color(16753920),z=10*window.devicePixelRatio,H=!1,J=!1,q=!1,Z=!1,X=i.owner.getAttribute("iExtensionLinesManipulable");let W=new r(m);var j;function Y(e,t,i,n,r,o){return p.convertUnitValueToString(e,t,i,n,r,o,"Length"===e)}(j=W?W.getPointedElem():m.canvas)||(j=i.frmWindow.getViewerFrame?i.frmWindow.getViewerFrame():void 0);var Q,K,$,ee,te,ie,ne,re,oe,ae,se,le,ue,ce,pe,de,ge,he,be,ye,me,ve,Pe,Ae,fe,we,Me,Se,Te,De,Ce,_e,Ee,Le,Re,Ne,xe,Ve,Ie,ke,Fe=function(){q=!(!i.owner.getAttribute("bShortDisplay")||i.owner.getAttribute("bDisplayUnit"))};Fe();var Oe={};Oe.regularSolidLine=C.retrieveMaterialFromGAS({color:B,lineWidth:window.devicePixelRatio,pattern:L.LinePatternEnum.SOLID}),Oe.regularDashedLine=C.retrieveMaterialFromGAS({color:B,lineWidth:window.devicePixelRatio,pattern:L.LinePatternEnum.DASHED}),Oe.bBoxSolidLine=C.retrieveMaterialFromGAS({color:B,lineWidth:window.devicePixelRatio,pattern:L.LinePatternEnum.SOLID}),Oe.avatarSolidLine=C.retrieveMaterialFromGAS({color:U,lineWidth:window.devicePixelRatio,pattern:L.LinePatternEnum.SOLID}),Oe.avatarDashedLine=C.retrieveMaterialFromGAS({color:B,lineWidth:window.devicePixelRatio,pattern:L.LinePatternEnum.DASHED}),Oe.avatarDottedLine=C.retrieveMaterialFromGAS({color:B,lineWidth:window.devicePixelRatio,pattern:L.LinePatternEnum.SMALLDOTTED}),Oe.dotDashedLine=C.retrieveMaterialFromGAS({color:B,lineWidth:window.devicePixelRatio+1,pattern:L.LinePatternEnum.DOTDASHED}),Oe.dotLine=C.retrieveMaterialFromGAS({color:B,lineWidth:window.devicePixelRatio+1,pattern:L.LinePatternEnum.DOTTED}),Oe.crossPoint=C.retrieveMaterialFromGAS({symbol:1,size:z,withoutDPR:!0,color:new g.Color(0)});var Be,Ue,Ge,ze,He,Je,qe,Ze,Xe,We,je,Ye,Qe,Ke,$e=!1,et=D.getReviewContext({viewer:m}),tt=!1,it=!1,nt=null,rt=null,ot=null,at=null,st=!0,lt=this,ut={},ct=.001,pt=1,dt=String.fromCharCode(216);function gt(e,t,i,n,r,o){return void 0===e&&void 0===t&&void 0===i&&void 0===n&&void 0===r&&void 0===o?0:Math.abs(i*t-e*n+(r*n-i*o)+(e*o-r*t))/2}function ht(){var e,t=S.get()[0];if(!t)return!1;if(t.event){var n=lt.getLabelDimensions(),r={offsetWidth:w.convertModelToPixels({sizeInMM:n.offsetWidth}),offsetHeight:w.convertModelToPixels({sizeInMM:n.offsetHeight})},o=w.getViewerPositionFromPoint(m,n.position),a=new g.Vector2(Math.round(o.left-r.offsetWidth/2),Math.round(o.top-r.offsetHeight/2)),s=w.get2DSnappedPosition(t.event.getCurrentPosition(m.canvas)),l=a.clone();l.y=l.y+n.height/(Ue+1)*Be;var u=a.clone();u.y=u.y+n.height/(Ue+1)*Ue;var c=a.clone();c.x=c.x+n.width,c.y=c.y+n.height/(Ue+1)*Be;var p=a.clone();p.x=p.x+n.width,p.y=p.y+n.height/(Ue+1)*Ue;var d=i.owner.getAttribute("fBoxRotationAngle");d=-d;var h=i.owner.getAttribute("vLeaderBreakPoint3D");if(d){var b=w.getWindowPositionFromPoint(m,h,i.frmWindow);b=new g.Vector2(b.left,b.top);var y=function(e){var t=e.clone();t.x=e.x-b.x,t.y=e.y-b.y;var i,n=(i=t,new g.Vector2(i.x*Math.cos(d)-i.y*Math.sin(d),i.x*Math.sin(d)+i.y*Math.cos(d)));return t.x=n.x+b.x,t.y=n.y+b.y,t};l=y(l),u=y(u),c=y(c),p=y(p)}var v={x1:u.x,y1:u.y,x2:l.x,y2:l.y,x3:c.x,y3:c.y,x4:p.x,y4:p.y,x:s.x,y:s.y};if(!$e||i.owner.getAttribute("bShortDisplay")||gt((e=v).x1,e.y1,e.x,e.y,e.x2,e.y2)+gt(e.x2,e.y2,e.x,e.y,e.x3,e.y3)+gt(e.x3,e.y3,e.x,e.y,e.x4,e.y4)+gt(e.x4,e.y4,e.x,e.y,e.x1,e.y1)-(gt(e.x1,e.y1,e.x3,e.y3,e.x2,e.y2)+gt(e.x1,e.y1,e.x3,e.y3,e.x4,e.y4))>ct)return!1}return!0}function bt(e,t){t.setPickParent(!0),t.setVisibilityInTree(!1),e.addChild(t)}var yt,mt,vt,Pt,At,ft,wt=p.readPreferences({name:"MeasureRepository",PreferenceNames:["DMUMeasureCenterValue"]});function Mt(){st=i.owner.isReadOnly()||!i.owner.isEditable()||function(){var e=_.isManipulationAllowed({viewer:m});if("boolean"==typeof e)return!e;var t=d.checkIfCommandIsRunning(m);if(t){var i=d.getCurrentCommand(m);("measureCmdHdr"===i||"measure3CmdHdr"===i||"measure2CmdHdr"===i||"measure2DCmdHdr"===i||i.contains&&i.contains("DMUMeasure")||i.contains&&i.contains("DMUMeasureSpecialized"))&&(t=!1)}return t}()}function St(e){if(!st){var t={pathElement:T.buildPathElement(lt)};e&&e.event.from[0].event.ctrlKey?M.remove(t):M.empty(),M.add(t)}}function Tt(){var e={fontStyle:{height:lt.getPixelFontSize("fFontSize"),familyStyle:i.owner.getAttribute("sFontStyle"),familyName:i.owner.getAttribute("sFontName"),color:i.owner.getAttribute("cFontColor"),fontSize:i.owner.getAttribute("fFontSize")},fontStyleComment:{height:lt.getPixelFontSize("fCommentFontSize"),familyStyle:i.owner.getAttribute("sCommentFontStyle"),familyName:i.owner.getAttribute("sCommentFontName"),color:i.owner.getAttribute("cFontColor"),fontSize:i.owner.getAttribute("fCommentFontSize")},fillStyle:{color:i.owner.getAttribute("cFillStyleColor"),opacity:i.owner.getAttribute("fOpacity")},lineStyle:{thickness:(x.getLineThickness(i.owner.getAttribute("fLineStyleThicknessIndex"))||i.owner.getAttribute("fLineStyleThickness"))*window.devicePixelRatio,pattern:i.owner.getAttribute("sLineStylePattern"),color:i.owner.getAttribute("cLineStyleColor")}},t=x.getLineThickness(i.owner.getAttribute("fLeaderStyleThicknessIndex"))||i.owner.getAttribute("fLeaderStyleThickness"),n=i.owner.getAttribute("cLeaderStyleColor"),r=i.owner.getAttribute("sLeaderStylePattern");return(void 0!==t||n||r)&&(e.leaderStyle={thickness:void 0!==t?t*window.devicePixelRatio:void 0,pattern:r,color:n}),e}function Dt(e){return" "+V.sx+": "+Y("Length",e.x,et,!0,q,Z)+" "+V.sy+": "+Y("Length",e.y,et,!0,q,Z)+" "+V.sz+": "+Y("Length",e.z,et,!0,q,Z)}function Ct(e){return" "+V.dx+": "+Y("Length",e.x,et,!0,q,Z)+" "+V.dy+": "+Y("Length",e.y,et,!0,q,Z)+" "+V.dz+": "+Y("Length",e.z,et,!0,q,Z)}function _t(e,t,i,n){var r=Y("Length",o.isZero(e)?0:e,et,!0,q,Z);return J&&(r=V.aproximateSymbol+r),t?r:i?(n?V.cumulativeLength:V.curveLength)+" "+r:(n?V.cumulativeLength:V.length)+" "+r}function Et(e,t,i){var n,r=Y("Angle",o.isZero(e)?0:180*e/Math.PI,et,!0,q,Z);return t||(n=V.angle,i&&(n=V.halfAngle)),J&&(r=V.aproximateSymbol+r),t?r:n+" "+r}function Lt(e,t,i){var n=Y("Area",o.isZero(e)?0:e,et,!0,q,Z);return J&&(n=V.aproximateSymbol+n),t?n:(i?V.cumulativeArea:V.area)+" "+n}function Rt(e,t,i){var n=Y("Volume",o.isZero(e)?0:e,et,!0,q,Z);return J&&(n=V.aproximateSymbol+n),t?n:(i?V.cumulativeVolume:V.volume)+" "+n}function Nt(e,t,i){var n,r=Y("Length",o.isZero(e)?0:e,et,!0,q,Z);return n=void 0===i?V.radius:i?V.maxRadius:V.minRadius,J&&(r=V.aproximateSymbol+r),t?V.symbolRadius+" "+r:n+" "+r}function xt(e,t,i){var n,r=Y("Length",o.isZero(e)?0:e,et,!0,q,Z);return n=void 0===i?V.diameter:i?V.maxDiameter:V.minDiameter,J&&(r=V.aproximateSymbol+r),t?dt+" "+r:n+" "+r}function Vt(e,t,i){var n=Y("Length",o.isZero(e)?0:e,et,!0,q,Z);return J&&(n=V.aproximateSymbol+n),i?n:t+" "+n}function It(e,t){var i="",n=!1;o.isZero(t.x)||(n=!0,i+=Y("Length",t.x,et,!0,!0,Z),i+=V.sx),o.isZero(t.y)||(t.y>0&&!0===n&&(i+="+"),n=!0,i+=Y("Length",t.y,et,!0,!0,Z),i+=V.sy),o.isZero(t.z)||(t.z>0&&!0===n&&(i+="+"),n=!0,i+=Y("Length",t.z,et,!0,!0,Z),i+=V.sz);var r=-(e.x*t.x+e.y*t.y+e.z*t.z);return r>0&&!0===n&&(i+="+"),i+=Y("Length",r,et,!0,!0,Z),i+="=0"}function kt(e,i,n){var r,o=!1;switch(null==i&&(o=!0),e){case t.ResultType.POINT:case t.ResultType.CENTER:r=n?i?V.labelPOI+" "+V.inLabel+" "+i:V.labelPOI:o?V.point:V.point+" "+V.inLabel+" "+i;break;case t.ResultType.LINE:r=o?V.line:V.line+" "+V.inLabel+" "+i;break;case t.ResultType.AXIS:r=V.infiniteline+" "+V.inLabel+" "+i;break;case t.ResultType.CIRCLE:r=o?V.circle:V.circle+" "+V.inLabel+" "+i;break;case t.ResultType.CURVE:r=o?V.curve:V.curve+" "+V.inLabel+" "+i;break;case t.ResultType.PLANE:r=V.plane+" "+V.inLabel+" "+i;break;case t.ResultType.CYLINDER:r=V.cylinder+" "+V.inLabel+" "+i;break;case t.ResultType.CONE:r=V.cone+" "+V.inLabel+" "+i;break;case t.ResultType.SPHERE:r=V.sphere+" "+V.inLabel+" "+i;break;case t.ResultType.SURFACE:r=V.surface+" "+V.inLabel+" "+i;break;case t.ResultType.PRODUCT:r=V.product+" "+i}return r}function Ft(e,t,n,r,o,a){if(e)H||r.push(V.coordinates),r[r.length]=V.sx+": "+(J?V.aproximateSymbol+Y("Length",t.x,et,!0,q,Z):Y("Length",t.x,et,!0,q,Z)),r[r.length]=V.sy+": "+(J?V.aproximateSymbol+Y("Length",t.y,et,!0,q,Z):Y("Length",t.y,et,!0,q,Z)),r[r.length]=V.sz+": "+(J?V.aproximateSymbol+Y("Length",t.z,et,!0,q,Z):Y("Length",t.z,et,!0,q,Z));else{Ge=a?n?V.labelPOI+" "+V.inLabel+" "+n:V.labelPOI:n?V.point+" "+V.inLabel+" "+n:V.point,ze=void 0,r[0]=V.coordinates+" "+Dt(t);var s=i.owner.getAttribute("lCustomization");s&&s.length>0?(s[0].custoValue&&r.push(Ge.length>50?Ge.substring(0,50)+"...":Ge),s[1].custoValue&&r.push(o.mode)):(r[0]=V.coordinates+" "+Dt(t),r[1]=Ge.length>50?Ge.substring(0,50)+"...":Ge,r[2]=o.mode),Be=1,Ue=2}}function Ot(e,t,n,r,o,a){var s=i.owner.getAttribute("fVolume"),l=i.owner.getAttribute("fArea"),u=i.owner.getAttribute("fLength"),c=i.owner.getAttribute("vCog"),p=t.getOriginPoint(),d=i.owner.getAttribute("sProductDisplayType");if(e)!function(e,t,i,n,r,o,a){if("Volume"===e&&void 0!==t&&t>=0||"Area"!==e&&void 0!==t&&t>0)o[0]=Rt(t,H);else if("Area"===e&&void 0!==i&&i>0||void 0!==i&&i>0)o[0]=Lt(i,H);else if(void 0===t&&void 0===i&&void 0!==a&&a>0)o[0]=_t(a,H);else if(void 0!==t||void 0!==i||void 0!==a||void 0===n&&void 0===r)void 0!==t&&(o[0]=Rt(t,H));else{var s=void 0!==n;H||o.push(V.coordinates),o[o.length]=V.sx+": "+Y("Length",s?n.x:r.x,et,!0,q,Z),o[o.length]=V.sy+": "+Y("Length",s?n.y:r.y,et,!0,q,Z),o[o.length]=V.sz+": "+Y("Length",s?n.z:r.z,et,!0,q,Z)}}(d,s,l,c,p,o,u);else{Ge=r,ze=void 0;var g=0,h=V.product,b=i.owner.getAttribute("lCustomization"),y=b.length;b&&b.length>0?("Area"===i.owner.getAttribute("sProductDisplayType")?void 0===l&&void 0===s||(o.push(Lt(l)),b[0].custoValue&&s&&o.push(Rt(s))):void 0===l&&void 0===s||(o.push(Rt(s)),b[0].custoValue&&l&&o.push(Lt(l))),void 0===s&&g++,void 0===l&&g++,!c||void 0===s&&void 0===l?void 0!==u&&u>0?void 0!==s?(b[0].custoValue&&o.push(_t(u)),void 0!==n.beginPoint&&void 0!==n.endPoint&&(h=V.curve+" "+V.inLabel,g--,b[2].custoValue&&o.push(V.firstpoint+" "+Dt(n.beginPoint)),g--,b[3].custoValue&&o.push(V.secondpoint+" "+Dt(n.endPoint)))):(o.push(_t(u)),void 0!==n.beginPoint&&void 0!==n.endPoint&&(h=V.curve+" "+V.inLabel,g--,b[0].custoValue&&o.push(V.firstpoint+" "+Dt(n.beginPoint)),g--,b[1].custoValue&&o.push(V.secondpoint+" "+Dt(n.endPoint)))):void 0!==c?(o.push(Dt(c)),h=V.point+" "+V.inLabel):void 0!==p?(o.push(Dt(p)),h=V.point+" "+V.ofLabel):g++:b[1].custoValue&&o.push(V.cog+" "+Dt(c)),Ge=h+" "+Ge,b[y-2].custoValue&&o.push(Ge.length>50?Ge.substring(0,50)+"...":Ge),b[y-1].custoValue&&o.push(a.mode)):(void 0===s?g++:o[0]=Rt(s),void 0===l?g++:o[1-g]=Lt(l),void 0!==s||void 0!==l?o[2-g]=V.cog+" "+Dt(c):void 0!==u&&u>0?(o[2-g]=_t(u),void 0!==n.beginPoint&&void 0!==n.endPoint&&(h=V.curve+" "+V.inLabel,o[2- --g]=V.startpoint+" "+Dt(n.beginPoint),o[2- --g]=V.endpoint+" "+Dt(n.endPoint))):void 0!==c?(o[2-g]=Dt(c),h=V.point+" "+V.inLabel):void 0!==p?(o[2-g]=Dt(p),h=V.point+" "+V.ofLabel):g++,Ge=h+" "+Ge,o[3-g]=Ge.length>50?Ge.substring(0,50)+"...":Ge,o[4-g]=a.mode),Be=3-g,Ue=4-g}}function Bt(e,t,n,r){var o,a,s,l,u,c,p,d,h=[],b=i.owner.getAttribute("sSurfaceDisplayType");if(e)switch(b){case"MinimumRadius":s=i.owner.getAttribute("fRadius"),h[0]=Nt(s,H,!1);break;case"MinimumDiameter":l=2*i.owner.getAttribute("fRadius"),h[0]=xt(l,H,!1);break;case"MaximumRadius":u=i.owner.getAttribute("fMaxRadius"),h[0]=Nt(u,H,!0);break;case"MaximumDiameter":c=2*i.owner.getAttribute("fMaxRadius"),h[0]=xt(c,H,!0);break;case"Length":p=i.owner.getAttribute("fHeight"),h[0]=_t(p,H);break;case"Area":d=i.owner.getAttribute("fArea"),h[0]=Lt(d,H);break;case"Angle":0!==t&&(h[0]=Et(2*t,H,!1));break;default:0!==t&&(h[0]=Et(t,H,!0))}else{Ge=V.cone+" "+V.inLabel+" "+i.owner.getAttribute("oProduct1Name"),ze=void 0,o=n.getPoints(),(a=new g.Vector3).subVectors(o.endPoint,o.beginPoint).normalize();var y=i.owner.getAttribute("lCustomization");if(y&&y.length>0){s=i.owner.getAttribute("fRadius"),u=i.owner.getAttribute("fMaxRadius"),l=2*i.owner.getAttribute("fRadius"),c=2*i.owner.getAttribute("fMaxRadius"),p=i.owner.getAttribute("fHeight"),d=i.owner.getAttribute("fArea");var m=n.getApex(),v=V.firstpoint+" "+Dt(o.beginPoint),P=V.secondpoint+" "+Dt(o.endPoint),A=_t(p,!1),f=Nt(s,!1,!1),w=Nt(u,!1,!0),M=xt(l,!1,!1),S=xt(c,!1,!0),T=V.direction+" "+Dt(a),D=Et(2*t,!1,!1),C=Et(t,!1,!0),_=V.apex+" "+Dt(m),E=Lt(i.owner.getAttribute("fArea")),L=V.cog+" "+Dt(i.owner.getAttribute("vCog")),R=Ge.length>50?Ge.substring(0,50)+"...":Ge,N=r.mode,x=void 0;switch(b){case"MinimumRadius":h[0]=f,x=w;break;case"MinimumDiameter":h[0]=M,x=S;break;case"MaximumRadius":h[0]=w,s>0&&(x=f);break;case"MaximumDiameter":h[0]=S,l>0&&(x=M);break;case"Length":h[0]=A;break;case"Area":h[0]=E;break;case"Angle":0!==t&&(h[0]=D);break;default:0!==t&&(h[0]=C)}"Length"===b?(y[0].custoValue&&h.push(v),y[1].custoValue&&h.push(P),y[2].custoValue&&h.push(T),y[3].custoValue&&h.push(D),y[4].custoValue&&h.push(C),y[5].custoValue&&h.push(_),s>0&&y[6].custoValue&&h.push(f),y[7].custoValue&&h.push(w),l>0&&y[8].custoValue&&h.push(M),y[9].custoValue&&h.push(S),y[10].custoValue&&h.push(E),y[11].custoValue&&h.push(L),y[12].custoValue&&h.push(R),y[13].custoValue&&h.push(N)):"Area"===b?(y[0].custoValue&&h.push(L),y[1].custoValue&&h.push(R),y[2].custoValue&&h.push(N)):"MinimumRadius"===b||"MaximumRadius"===b||"MinimumDiameter"===b||"MaximumDiameter"===b?(y[0].custoValue&&h.push(v),y[1].custoValue&&h.push(P),y[2].custoValue&&h.push(A),y[3].custoValue&&h.push(T),y[4].custoValue&&h.push(D),y[5].custoValue&&h.push(C),y[6].custoValue&&h.push(_),void 0!==x&&y[7].custoValue&&h.push(x),y[8].custoValue&&h.push(E),y[9].custoValue&&h.push(L),y[10].custoValue&&h.push(R),y[11].custoValue&&h.push(N)):(y[0].custoValue&&h.push(v),y[1].custoValue&&h.push(P),y[2].custoValue&&h.push(A),y[3].custoValue&&h.push(T),y[4].custoValue&&h.push(_),s>0&&y[5].custoValue&&h.push(f),y[6].custoValue&&h.push(w),l>0&&y[7].custoValue&&h.push(M),y[8].custoValue&&h.push(S),y[9].custoValue&&h.push(E),y[10].custoValue&&h.push(L),y[11].custoValue&&h.push(R),y[12].custoValue&&h.push(N))}else h[0]=Et(t,!1,!0),h[1]=V.startpoint+" "+Dt(o.beginPoint),h[2]=V.endpoint+" "+Dt(o.endPoint),h[3]=V.direction+" "+Dt(a),h[4]=Lt(i.owner.getAttribute("fArea")),h[5]=V.cog+" "+Dt(i.owner.getAttribute("vCog")),h[6]=Ge.length>50?Ge.substring(0,50)+"...":Ge,h[7]=r.mode;Be=6,Ue=7}return h}function Ut(e,n,r,o){var a=[];o.exact=n.getMode()===u.Mode.EXACT,o.mode=o.exact?V.exactMode:V.approximateMode;var s=i.owner.getAttribute("oProduct1Name"),l=i.owner.getAttribute("sResultingType1"),c=n._bIsPOISelection;if(J&&o.exact&&(J=!1),i.owner.getAttribute("bCumulativeMeasure"))switch(l){case t.ResultType.CURVE:!function(e,t,n,r){if(e)0!==i.owner.getAttribute("fLength")&&(n[0]=_t(i.owner.getAttribute("fLength"),H,!1,!0));else{Ge=H&&void 0===t?V.multiSelection:V.multiSelection+" "+V.inLabel+" "+t,ze=void 0;var o=i.owner.getAttribute("lCustomization");if(o&&o.length>0){for(var a=!1,s=!1,l=0;l<o.length;l++)"selection"===o[l].custoName&&(a=o[l].custoValue),"computationMode"===o[l].custoName&&(s=o[l].custoValue);n[0]=_t(i.owner.getAttribute("fLength"),!1,!1,!0),a&&n.push(Ge.length>50?Ge.substring(0,50)+"...":Ge),s&&n.push(r.mode)}}}(e,s,a,o);break;case t.ResultType.SURFACE:!function(e,t,n,r){if(e)0!==i.owner.getAttribute("fArea")&&(n[0]=Lt(i.owner.getAttribute("fArea"),H,!0));else{Ge=H&&void 0===t?V.multiSelection:V.multiSelection+" "+V.inLabel+" "+t,ze=void 0;var o=i.owner.getAttribute("lCustomization");if(o&&o.length>0){for(var a=!1,s=!1,l=0;l<o.length;l++)"selection"===o[l].custoName&&(a=o[l].custoValue),"computationMode"===o[l].custoName&&(s=o[l].custoValue);n[0]=Lt(i.owner.getAttribute("fArea"),!1,!0),a&&n.push(Ge.length>50?Ge.substring(0,50)+"...":Ge),s&&n.push(r.mode)}}}(e,s,a,o);break;case t.ResultType.PRODUCT:!function(e,t,n,r){var o=!0,a=i.owner.getAttribute("fVolume"),s=i.owner.getAttribute("fArea"),l=i.owner.getAttribute("sProductDisplayType");if(e)"Area"===l?0!==s&&(n[0]=Lt(s,H,o)):"Volume"===l&&0!==a&&(n[0]=Rt(a,H,o));else{Ge=H&&void 0===t?V.multiSelection:V.multiSelection+" "+V.inLabel+" "+t,ze=void 0;var u=i.owner.getAttribute("lCustomization");if(u&&u.length>0){for(var c=!1,p=!1,d=!1,g=!1,h=0;h<u.length;h++)"selection"===u[h].custoName&&(c=u[h].custoValue),"computationMode"===u[h].custoName&&(p=u[h].custoValue),"area"===u[h].custoName&&(d=u[h].custoValue),"volume"===u[h].custoName&&(g=u[h].custoValue);"Area"===l?(n.push(Lt(i.owner.getAttribute("fArea"),!1,o)),g&&n.push(Rt(i.owner.getAttribute("fVolume"),!1,o)),c&&n.push(Ge.length>50?Ge.substring(0,50)+"...":Ge),p&&n.push(r.mode)):(n.push(Rt(i.owner.getAttribute("fVolume"),!1,o)),d&&n.push(Lt(i.owner.getAttribute("fArea"),!1,o)),c&&n.push(Ge.length>50?Ge.substring(0,50)+"...":Ge),p&&n.push(r.mode))}}}(e,s,a,o);break;default:a[0]="Unknow"}else switch(l){case t.ResultType.POINT:Ft(e,i.owner.getAttribute("vPosition"),s,a,o,c);break;case t.ResultType.CENTER:Ft(e,n.getCenter(),s,a,o);break;case t.ResultType.LINE:!function(e,t,n,r,o){if(e)0!==i.owner.getAttribute("fLength")&&(r[0]=_t(i.owner.getAttribute("fLength"),H));else{Ge=H&&void 0===n?V.line:V.line+" "+V.inLabel+" "+n,ze=void 0;var a=new g.Vector3;a.subVectors(t.endPoint,t.beginPoint).normalize();var s=i.owner.getAttribute("lCustomization");s&&s.length>0?(r[0]=_t(i.owner.getAttribute("fLength")),s[0].custoValue&&r.push(V.firstpoint+" "+Dt(t.beginPoint)),s[1].custoValue&&r.push(V.secondpoint+" "+Dt(t.endPoint)),s[2].custoValue&&r.push(V.direction+" "+Dt(a)),s[3].custoValue&&r.push(Ge.length>50?Ge.substring(0,50)+"...":Ge),s[4].custoValue&&r.push(o.mode)):(r[0]=_t(i.owner.getAttribute("fLength")),r[1]=V.startpoint+" "+Dt(t.beginPoint),r[2]=V.endpoint+" "+Dt(t.endPoint),r[3]=V.direction+" "+Dt(a),r[4]=Ge.length>50?Ge.substring(0,50)+"...":Ge,r[5]=o.mode),Be=4,Ue=5}}(e,r,s,a,o);break;case t.ResultType.AXIS:!function(e,t,n,r,o){var a=new g.Vector3;if(a.subVectors(t.endPoint,t.beginPoint).normalize(),e)r[0]=H?Dt(a):V.direction+" "+Dt(a);else{Ge=V.infiniteline+" "+V.inLabel+" "+n,ze=void 0,r[0]=V.direction+" "+Dt(a);var s=i.owner.getAttribute("lCustomization");s&&s.length>0?(s[0].custoValue&&r.push(Ge.length>50?Ge.substring(0,50)+"...":Ge),s[1].custoValue&&r.push(o.mode)):(r[1]=Ge.length>50?Ge.substring(0,50)+"...":Ge,r[2]=o.mode),Be=1,Ue=2}}(e,r,s,a,o);break;case t.ResultType.CIRCLE:!function(e,t,n,r,o,a){var s,l=i.owner.getAttribute("fRadius"),u=t.getArcAngle();e||(s=i.owner.getAttribute("lCustomization")),i.owner.getAttribute("bArcLengthDisplay")?e?o[0]=Vt(u*l,V.arcLength,H):(o[0]=Vt(u*l,V.arcLength),s&&s.length>0?(Ge=V.arc+" "+V.inLabel+" "+r,ze=void 0,s[0].custoValue&&o.push(V.firstpoint+" "+Dt(n.beginPoint)),s[1].custoValue&&o.push(V.secondpoint+" "+Dt(n.endPoint)),s[2].custoValue&&o.push(Nt(l)),s[3].custoValue&&o.push(xt(2*l)),s[4].custoValue&&o.push(Ge),s[5].custoValue&&o.push(a.mode)):(Ge=V.arc,ze=void 0,o[1]=V.startpoint+" "+Dt(n.beginPoint),o[2]=V.endpoint+" "+Dt(n.endPoint),o[3]=Ge,o[4]=a.mode),Be=3,Ue=4):e?i.owner.getAttribute("bRadiusDisplay")?o[0]=Nt(l,H):o[0]=xt(2*l,H):(i.owner.getAttribute("bRadiusDisplay")?o[0]=Nt(l):o[0]=xt(2*l),Ge=H&&void 0===r?u&&Math.abs(2*Math.PI-u)>ct?V.arc:V.circle:V.circle+" "+V.inLabel+" "+r,ze=void 0,s&&s.length>0?(s[0].custoValue&&o.push(V.center+" "+Dt(i.owner.getAttribute("vCenter"))),s[1].custoValue&&o.push(Vt(u*l,V.arcLength)),s[2].custoValue&&o.push(Vt(2*Math.PI*l,V.circlePerimeter)),s[3].custoValue&&o.push(Ge.length>50?Ge.substring(0,50)+"...":Ge),s[4].custoValue&&o.push(a.mode)):(o[1]=V.center+" "+Dt(i.owner.getAttribute("vCenter")),o[2]=Vt(u*l,V.arcLength),o[3]=Vt(2*Math.PI*l,V.circlePerimeter),o[4]=Ge.length>50?Ge.substring(0,50)+"...":Ge,o[5]=a.mode),Be=4,Ue=5)}(e,n,r,s,a,o);break;case t.ResultType.CURVE:!function(e,t,n,r,o){if(e)0!==i.owner.getAttribute("fLength")&&(r[0]=_t(i.owner.getAttribute("fLength"),H,!0));else{Ge=void 0===n?V.curve:V.curve+" "+V.inLabel+" "+n,ze=void 0,r[0]=_t(i.owner.getAttribute("fLength"),!1,!0);var a=i.owner.getAttribute("lCustomization");null!==t?(a&&a.length>0?(a[0].custoValue&&r.push(V.firstpoint+" "+Dt(t.beginPoint)),a[1].custoValue&&r.push(V.secondpoint+" "+Dt(t.endPoint)),a[2].custoValue&&r.push(Ge.length>50?Ge.substring(0,50)+"...":Ge),a[3].custoValue&&r.push(o.mode)):(r[1]=V.startpoint+" "+Dt(t.beginPoint),r[2]=V.endpoint+" "+Dt(t.endPoint),r[3]=Ge.length>50?Ge.substring(0,50)+"...":Ge,r[4]=o.mode),Be=3,Ue=4):a&&a.length>0?(a[2].custoValue&&r.push(Ge.length>50?Ge.substring(0,50)+"...":Ge),a[3].custoValue&&r.push(o.mode)):(r[1]=Ge.length>50?Ge.substring(0,50)+"...":Ge,r[2]=o.mode)}}(e,r,s,a,o);break;case t.ResultType.PLANE:!function(e,t,n,r,o){var a=i.owner.getAttribute("fArea");if(e)0!==a&&(r[0]=Lt(a,H));else{Ge=V.plane+" "+V.inLabel+" "+n,ze=void 0;var s=t.getPlane(),l=i.owner.getAttribute("lCustomization");l&&l.length>0?(r.push(Lt(a)),l[0].custoValue&&r.push(V.cog+" "+Dt(i.owner.getAttribute("vCog"))),l[1].custoValue&&r.push(V.equation+" "+It(s.origin,s.normal)),l[2].custoValue&&r.push(Ge.length>50?Ge.substring(0,50)+"...":Ge),l[3].custoValue&&r.push(o.mode)):(r[0]=Lt(a),r[1]=V.cog+" "+Dt(i.owner.getAttribute("vCog")),r[2]=V.equation+" "+It(s.origin,s.normal),r[3]=Ge.length>50?Ge.substring(0,50)+"...":Ge,r[4]=o.mode),Be=3,Ue=4}}(e,n,s,a,o);break;case t.ResultType.CYLINDER:!function(e,t,n,r,o){var a,s,l=i.owner.getAttribute("fRadius"),u=i.owner.getAttribute("sSurfaceDisplayType");if(e)"Length"===u?(s=i.owner.getAttribute("fHeight"),r[0]=_t(s,H)):"Area"===u?(a=i.owner.getAttribute("fArea"),r[0]=Lt(a,H)):0!==l&&(i.owner.getAttribute("bRadiusDisplay")?r[0]=Nt(l,H):r[0]=xt(2*l,H));else{Ge=V.cylinder+" "+V.inLabel+" "+n,ze=void 0,a=i.owner.getAttribute("fArea");var c=new g.Vector3;c.subVectors(t.endPoint,t.beginPoint).normalize();var p=i.owner.getAttribute("lCustomization");p&&p.length>0?"Length"===u?(s=i.owner.getAttribute("fHeight"),r[0]=_t(s),p[0].custoValue&&r.push(V.firstpoint+" "+Dt(t.beginPoint)),p[1].custoValue&&r.push(V.secondpoint+" "+Dt(t.endPoint)),p[2].custoValue&&r.push(V.direction+" "+Dt(c)),p[3].custoValue&&r.push(Nt(l)),p[4].custoValue&&r.push(xt(2*l)),p[5].custoValue&&r.push(Lt(a)),p[6].custoValue&&r.push(V.cog+" "+Dt(i.owner.getAttribute("vCog"))),p[7].custoValue&&r.push(Ge.length>50?Ge.substring(0,50)+"...":Ge),p[8].custoValue&&r.push(o.mode)):"Area"===u?(a=i.owner.getAttribute("fArea"),r[0]=Lt(a),p[0].custoValue&&r.push(V.cog+" "+Dt(i.owner.getAttribute("vCog"))),p[1].custoValue&&r.push(Ge.length>50?Ge.substring(0,50)+"...":Ge),p[2].custoValue&&r.push(o.mode)):0!==l&&(s=i.owner.getAttribute("fHeight"),i.owner.getAttribute("bRadiusDisplay")?r[0]=Nt(l):r[0]=xt(2*l),p[0].custoValue&&r.push(V.firstpoint+" "+Dt(t.beginPoint)),p[1].custoValue&&r.push(V.secondpoint+" "+Dt(t.endPoint)),p[2].custoValue&&r.push(_t(s)),p[3].custoValue&&r.push(V.direction+" "+Dt(c)),p[4].custoValue&&r.push(Lt(a)),p[5].custoValue&&r.push(V.cog+" "+Dt(i.owner.getAttribute("vCog"))),p[6].custoValue&&r.push(Ge.length>50?Ge.substring(0,50)+"...":Ge),p[7].custoValue&&r.push(o.mode)):(i.owner.getAttribute("bRadiusDisplay")?r[0]=Nt(l):r[0]=xt(2*l),r[1]=V.startpoint+" "+Dt(t.beginPoint),r[2]=V.endpoint+" "+Dt(t.endPoint),r[3]=V.direction+" "+Dt(c),r[4]=Lt(a),r[5]=V.cog+" "+Dt(i.owner.getAttribute("vCog")),r[6]=Ge.length>50?Ge.substring(0,50)+"...":Ge,r[7]=o.mode),Be=6,Ue=7}}(e,r,s,a,o);break;case t.ResultType.SPHERE:!function(e,t,n,r){n[0]=V.sphere;var o=i.owner.getAttribute("fRadius"),a=i.owner.getAttribute("sSurfaceDisplayType"),s=i.owner.getAttribute("fArea");if(e)"Area"===a?n[0]=Lt(s,H):i.owner.getAttribute("bRadiusDisplay")?n[0]=Nt(o,H):n[0]=xt(2*o,H);else{Ge=V.sphere+" "+V.inLabel+" "+t,ze=void 0;var l=i.owner.getAttribute("lCustomization");l&&l.length>0?"Area"===a?(n[0]=Lt(s),l[0].custoValue&&n.push(V.cog+" "+Dt(i.owner.getAttribute("vCog"))),l[1].custoValue&&n.push(Ge.length>50?Ge.substring(0,50)+"...":Ge),l[2].custoValue&&n.push(r.mode)):(i.owner.getAttribute("bRadiusDisplay")?n[0]=Nt(o):n[0]=xt(2*o),l[0].custoValue&&n.push(V.center+" "+Dt(i.owner.getAttribute("vCenter"))),l[1].custoValue&&n.push(Lt(s)),l[2].custoValue&&n.push(Ge.length>50?Ge.substring(0,50)+"...":Ge),l[3].custoValue&&n.push(r.mode)):(i.owner.getAttribute("bRadiusDisplay")?n[0]=Nt(o):n[0]=xt(2*o),n[1]=V.center+" "+Dt(i.owner.getAttribute("vCenter")),n[2]=Lt(s),n[3]=Ge.length>50?Ge.substring(0,50)+"...":Ge,n[4]=r.mode),Be=3,Ue=4}}(e,s,a,o);break;case t.ResultType.SURFACE:!function(e,t,n,r){if(e)0!==i.owner.getAttribute("fArea")&&(n[0]=Lt(i.owner.getAttribute("fArea"),H));else{Ge=V.surface+" "+V.inLabel+" "+t,ze=void 0;var o=i.owner.getAttribute("lCustomization");o&&o.length>0?(n.push(Lt(i.owner.getAttribute("fArea"))),o[0].custoValue&&n.push(V.cog+" "+Dt(i.owner.getAttribute("vCog"))),o[1].custoValue&&n.push(Ge.length>50?Ge.substring(0,50)+"...":Ge),o[2].custoValue&&n.push(r.mode)):(n[0]=Lt(i.owner.getAttribute("fArea")),n[1]=V.cog+" "+Dt(i.owner.getAttribute("vCog")),n[2]=Ge.length>50?Ge.substring(0,50)+"...":Ge,n[3]=r.mode),Be=2,Ue=3}}(e,s,a,o);break;case t.ResultType.PRODUCT:Ot(e,n,r,s,a,o);break;case t.ResultType.CONE:a=Bt(e,i.owner.getAttribute("fSemiAngle"),n,o);break;default:a[0]="Unknow"}return a}function Gt(e,t,n,r,o){var a,s,l=[],c={},p=i.owner.getMeasurable(1),d=p.getPoints();if(H=!1,!1===i.owner.getAttribute("bDisplayMeasureType")&&(H=!0),J=!1,e&&!0===i.owner.getAttribute("bDisplayApproximateSymbol")&&(J=!0),"MeasureBetween"===t||"MeasureThickness"===t)l=function(e,t,n,r,o,a,s,l){var c=[];l.exact="MeasureThickness"!==nt&&a.getMode()===u.Mode.EXACT&&s.getMode()===u.Mode.EXACT,l.mode=l.exact?V.exactMode:V.approximateMode;var p=V.minDistance;if(J&&l.exact&&(J=!1),"MeasureBetween"===e)switch(t){case"Distance":p=V.distance;break;case"MaximumDistance":p=V.maxDistance;break;case"LocalMinimumDistance":p=V.LocalMinimumDistance;break;case"LocalMaximumDistance":p=V.LocalMaximumDistance}var d=_t(o,!0);if(r)c[0]=H?d:"MeasureBetween"===e?p+" "+d:V.thickness+" "+d;else{var h=new g.Vector3,b=i.owner.getAttribute("vFirstExtensionPoint3D"),y=i.owner.getAttribute("vSecondExtensionPoint3D");h.subVectors(y,b);var m=h.clone().normalize(),v=i.owner.getAttribute("lCustomization");"MeasureBetween"===e?(Ge=kt(i.owner.getAttribute("sResultingType1"),i.owner.getAttribute("oProduct1Name"),a._bIsPOISelection),ze=kt(i.owner.getAttribute("sResultingType2"),i.owner.getAttribute("oProduct2Name"),s._bIsPOISelection),"2D"===n&&(Ge===V.circle&&a._arcAngle&&Math.abs(2*Math.PI-a._arcAngle)>ct&&(Ge=V.arc),ze===V.circle&&s._arcAngle&&Math.abs(2*Math.PI-s._arcAngle)>ct&&(ze=V.arc)),v&&v.length>0?(c[0]=p+" "+d,7===v.length&&(v[0].custoValue&&c.push(V.firstpoint+" "+Dt(b)),v[1].custoValue&&c.push(V.secondpoint+" "+Dt(y)),v[2].custoValue&&c.push(V.components+" "+Ct(h)),v[3].custoValue&&c.push(V.direction+" "+Dt(m)),v[4].custoValue&&c.push("2D"!==n&&Ge.length>50?Ge.substring(0,50)+"...":Ge),v[5].custoValue&&c.push("2D"!==n&&ze.length>50?ze.substring(0,50)+"...":ze),v[6].custoValue&&c.push(l.mode)),"2D"!==n&&(Be=5,Ue=7)):(c[0]=p+" "+d,c[1]=V.firstpoint+" "+Dt(b),c[2]=V.secondpoint+" "+Dt(y),c[3]=V.components+" "+Ct(h),c[4]=V.direction+" "+Dt(m),"2D"===n?(c[5]=Ge+" - "+ze,c[6]=l.mode):(Be=5,Ue=7,c[5]=Ge.length>50?Ge.substring(0,50)+"...":Ge,c[6]=ze.length>50?ze.substring(0,50)+"...":ze,c[7]=l.mode))):(Ge=V.thickness+" "+V.ofLabel,a._bIsPOISelection&&(Ge=V.labelPOI+" "+V.inLabel),Ge=Ge+" "+i.owner.getAttribute("oProduct1Name"),ze=void 0,v&&v.length>0?(c[0]=V.thickness+" "+d,v[0].custoValue&&c.push(V.firstpoint+" "+Dt(b)),v[1].custoValue&&c.push(V.secondpoint+" "+Dt(y)),v[2].custoValue&&c.push(V.direction+" "+Dt(m)),v[3].custoValue&&c.push(Ge.length>50?Ge.substring(0,50)+"...":Ge),v[4].custoValue&&c.push(l.mode)):(c[0]=V.thickness+" "+d,c[1]=V.startpoint+" "+Dt(b),c[2]=V.endpoint+" "+Dt(y),c[3]=V.direction+" "+Dt(m),c[4]=Ge.length>50?Ge.substring(0,50)+"...":Ge,c[5]=l.mode),Be=4,Ue=5)}return c}(t,o,r,e,n,p,a=i.owner.getMeasurable(2),c);else if("MeasureItem"===t)l=Ut(e,p,d,c);else if("Measure3PointsCircle"===t){a=i.owner.getMeasurable(2);var h=i.owner.getMeasurable(3);if(c.exact=p.getMode()===u.Mode.EXACT&&a.getMode()===u.Mode.EXACT&&h.getMode()===u.Mode.EXACT,c.mode=c.exact?V.exactMode:V.approximateMode,s=i.owner.getAttribute("fRadius"),e)J&&c.exact&&(J=!1),i.owner.getAttribute("bRadiusDisplay")?l[0]=Nt(s,H):l[0]=xt(2*s,H);else{var b=i.owner.getAttribute("lCustomization");b&&b.length>0?(i.owner.getAttribute("bRadiusDisplay")?l[0]=Nt(s):l[0]=xt(2*s),void 0!==p&&void 0!==a&&void 0!==h&&void 0!==p.getSelPoint()&&void 0!==a.getSelPoint()&&void 0!==h.getSelPoint()&&(b[0].custoValue&&l.push(V.firstpoint+" "+Dt(p.getSelPoint())),b[1].custoValue&&l.push(V.secondpoint+" "+Dt(a.getSelPoint())),b[2].custoValue&&l.push(V.thirdpoint+" "+Dt(h.getSelPoint()))),b[3].custoValue&&l.push(V.center+" "+Dt(i.owner.getAttribute("vCenter"))),b[4].custoValue&&l.push(c.mode)):(l[0]=Nt(s)+"  "+xt(2*s),l[1]=V.center+" "+Dt(i.owner.getAttribute("vCenter")),l[2]=V.normal+" "+Dt(i.owner.getAttribute("vNormal")),l[3]=V.circle,l[4]=c.mode)}}return l}function zt(e,n,r,o,a){var s=[],l={},c=i.owner.getMeasurable(1),p=i.owner.getMeasurable(2),d=i.owner.getMeasurable(3);return l.exact=c.getMode()===u.Mode.EXACT,l.mode=l.exact?V.exactMode:V.approximateMode,J=!1,e&&!0===i.owner.getAttribute("bDisplayApproximateSymbol")&&(J=!0),H=!1,i.owner.getAttribute("bDisplayMeasureType")||(H=!0),"MeasureBetween"===n||"Measure3PointsAngle"===n||"MeasureThickness"===n?s=function(e,t,n,r,o,a,s,l,c){var p=[];c.exact=o.getMode()===u.Mode.EXACT&&a.getMode()===u.Mode.EXACT,c.mode=c.exact?V.exactMode:V.approximateMode;var d=Et(n,!0);if(e)p[0]=H?d:V.angle+" "+d;else{var g=i.owner.getAttribute("lCustomization");if(p[0]=V.angle+" "+d,r&&"MeasureBetween"===t||"MeasureThickness"===t)Ge=kt(i.owner.getAttribute("sResultingType1"),i.owner.getAttribute("oProduct1Name")),ze=kt(i.owner.getAttribute("sResultingType2"),i.owner.getAttribute("oProduct2Name")),g&&g.length>0?(g[0].custoValue&&p.push(V.center+" "+Dt(i.owner.getAttribute("vAngleArcCenter").clone())),g[1].custoValue&&p.push("2D"!==l&&Ge.length>50?Ge.substring(0,50)+"...":Ge),g[2].custoValue&&p.push("2D"!==l&&ze.length>50?ze.substring(0,50)+"...":ze),g[3].custoValue&&p.push(c.mode),"2D"!==l&&Ge&&(Be=1,Ue=2,ze&&(Ue=3))):("2D"===l?p[1]=Ge+" - "+ze:Ge&&(Be=1,Ue=2,p[1]=Ge.length>50?Ge.substring(0,50)+"...":Ge,ze&&(p[2]=ze.length>50?ze.substring(0,50)+"...":ze,Ue=3)),p.push(c.mode));else if("Measure3PointsAngle"===t)if(g&&g.length>0)void 0!==o&&void 0!==a&&void 0!==s&&void 0!==o.getSelPoint()&&void 0!==a.getSelPoint()&&void 0!==s.getSelPoint()&&(g[0].custoValue&&p.push(V.firstpoint+" "+Dt(o.getSelPoint())),g[1].custoValue&&p.push(V.secondpoint+" "+Dt(s.getSelPoint())),g[2].custoValue&&p.push(V.center+" "+Dt(a.getSelPoint()))),g[3].custoValue&&p.push(c.mode);else{void 0!==o&&void 0!==a&&void 0!==s&&(c.exact=o.getMode()===u.Mode.EXACT&&a.getMode()===u.Mode.EXACT&&s.getMode()===u.Mode.EXACT);var h=i.owner.getAttribute("fProjectedAngleXY"),b=i.owner.getAttribute("fProjectedAngleYZ"),y=i.owner.getAttribute("fProjectedAngleZX");if(void 0!==h&&void 0!==b&&void 0!==y){var m=Et(h,!0),v=Et(b,!0),P=Et(y,!0);p.push(V.projectedAngle+" "+V.xy+": "+m+" "+V.yz+": "+v+" "+V.zx+": "+P),void 0!==o&&void 0!==a&&void 0!==s&&void 0!==o.getSelPoint()&&void 0!==a.getSelPoint()&&void 0!==s.getSelPoint()&&(p.push(V.firstpoint+" "+Dt(o.getSelPoint())),p.push(V.secondpoint+" "+Dt(a.getSelPoint())),p.push(V.thirdpoint+" "+Dt(s.getSelPoint())))}p.push(c.mode)}}return p}(e,n,r,o,c,p,d,a,l):"MeasureItem"===n&&i.owner.getAttribute("sResultingType1")===t.ResultType.CONE?s=Bt(e,r,c,l):i.owner.isReadOnly()&&"MeasureItem"===n&&i.owner.getAttribute("sResultingType1")===t.ResultType.CIRCLE&&(e?s[0]=Et(r):(s[0]=Et(r),s[1]=V.circle+" "+V.inLabel+" "+i.owner.getAttribute("oProduct1Name"),s[2]=l.mode)),s}function Ht(e,t,i,n,r,a){if(t&&i){var s=i.clone(),l=a.leaderStyle&&void 0!==a.leaderStyle.thickness?a.leaderStyle.thickness:a.lineStyle.thickness,u={arrowWidth:l,headLength:Math.max(2*l+4,10),viewpoint:m.currentViewpoint,initialPoint:s.clone(),finalPoint:t.clone(),color:a.leaderStyle&&a.leaderStyle.color?a.leaderStyle.color:a.lineStyle.color,arrowScale:2,head:1},c=w.getDistanceFromPixel(m,t,5),p=n.clone().normalize().multiplyScalar(c);if(s=t.clone().add(p),u.initialPoint=s.clone(),!o.areEqual(u.initialPoint,u.finalPoint,"Vector3")){var d=e.getChildByName("arrow1Node");d?(d.updateInitialPosition(u.initialPoint),d.updateFinalPosition(u.finalPoint),d.updateColor(u.color),d.setArrowWidth(u.arrowWidth),d.setHeadSize(u.headLength),d.setHeadType(u.head)):((d=new v(u)).name="arrow1Node",e.add(d))}var g=r.clone().normalize().multiplyScalar(c);if(s=i.clone().sub(g),u.initialPoint=s,u.finalPoint=i,!o.areEqual(u.initialPoint,u.finalPoint,"Vector3")){var h=e.getChildByName("arrow2Node");h?(h.updateInitialPosition(u.initialPoint),h.updateFinalPosition(u.finalPoint),h.updateColor(u.color),h.setArrowWidth(u.arrowWidth),h.setHeadSize(u.headLength),h.setHeadType(u.head)):((h=new v(u)).name="arrow2Node",e.add(h))}}}function Jt(e,t,i,n,r,a,s,l,u,c,p){if(t&&i){var d=4,g=!1,h="MeasureThickness"===nt,b=t.clone().add(i).multiplyScalar(.5),y=a?b.clone():i.clone(),P=s.leaderStyle&&void 0!==s.leaderStyle.thickness?s.leaderStyle.thickness:s.lineStyle.thickness;void 0===l||!0!==l&&!h||(d=Math.max(2*P+4,10),g=!0);var A={arrowWidth:P,headLength:d,viewpoint:m.currentViewpoint,initialPoint:y.clone(),finalPoint:t.clone(),color:s.leaderStyle&&s.leaderStyle.color?s.leaderStyle.color:s.lineStyle.color,head:0};if(!o.areEqual(A.initialPoint,A.finalPoint,"Vector3")){var f=e.getChildByName("lineNode");f?(f.updateInitialPosition(A.initialPoint),f.updateFinalPosition(A.finalPoint),f.updateColor(A.color),f.setArrowWidth(A.arrowWidth),f.setHeadSize(A.headLength),f.setHeadType(A.head)):((f=new v(A)).name="lineNode",e.add(f))}var M,S=t.clone().sub(i),T=S.length(),D=T<d,C=D?1:d/T;if(h)C=-C;else if(!0!==g){if(void 0!==n){var _=n.clone().sub(t),E=i.clone().sub(t),L=n.clone().sub(i),R=t.clone().sub(i);M=!r||_.clone().dot(E.clone())>0&&L.clone().dot(R.clone())>0}!1===u||M&&!D||(C=-C)}if(void 0===c||!0===c){if(A.head=1,S.multiplyScalar(C),h){var N=25*P;N=w.getDistanceFromPixel(m,t.clone(),N),S.normalize().multiplyScalar(N)}if(A.initialPoint=t.clone().sub(S),!o.areEqual(A.initialPoint,A.finalPoint,"Vector3")){var x=e.getChildByName("dimArrow1Node");x?(x.updateInitialPosition(A.initialPoint),x.updateFinalPosition(A.finalPoint),x.updateColor(A.color),x.setArrowWidth(A.arrowWidth),x.setHeadSize(A.headLength),x.setHeadType(A.head)):((x=new v(A)).name="dimArrow1Node",e.add(x))}if(!p&&(A.initialPoint=y.clone().add(S),A.finalPoint=y,!o.areEqual(A.initialPoint,A.finalPoint,"Vector3"))){var V=e.getChildByName("dimArrow2Node");V?(V.updateInitialPosition(A.initialPoint),V.updateFinalPosition(A.finalPoint),V.updateColor(A.color),V.setArrowWidth(A.arrowWidth),V.setHeadSize(A.headLength),V.setHeadType(A.head)):((V=new v(A)).name="dimArrow2Node",e.add(V))}}}}function qt(e,t,i,n,r,a){var s=new b;if(e&&t&&i&&n){var l=t.clone(),u=n.clone();r&&(l.add(e).multiplyScalar(.5),u.add(i).multiplyScalar(.5));var c={arrowWidth:a.leaderStyle&&void 0!==a.leaderStyle.thickness?a.leaderStyle.thickness:a.lineStyle.thickness,viewpoint:m.currentViewpoint,initialPoint:i.clone(),finalPoint:e.clone(),color:a.leaderStyle&&a.leaderStyle.color?a.leaderStyle.color:a.lineStyle.color,head:0};o.areEqual(c.initialPoint,c.finalPoint,"Vector3")||bt(s,new v(c)),c.initialPoint=u,c.finalPoint=l,o.areEqual(c.initialPoint,c.finalPoint,"Vector3")||bt(s,new v(c))}return s}function Zt(e,t,i){var n=new P({position:e.clone(),name:"anchor1",type:"Spherical"});n.setMatrix((new g.Matrix4).setPosition(e.clone()));var r=h.createCircleNode({radius:4,segments:8,fill:!1,color:t});r.setShadow(!1);var o=new A({name:"myFixedSizeNode",ratio:1});bt(o,r),bt(n,o);var a=h.createCircleNode({radius:4,segments:8,fill:!0,color:i});a.setShadow(!1);var s=new A({name:"myFixedSizeNode",ratio:1});return bt(s,a),bt(n,s),n}function Xt(e,t,i){var n,r=t.getPoints(),o=s.computePointSegmentDistance(i.toArray(),r.beginPoint.toArray(),r.endPoint.toArray());0===o.returnCode&&o.relationship!==u.Relationship.COINCIDENT&&(n=new g.Vector3(o.aPosition[0],o.aPosition[1],o.aPosition[2])),n&&(l.areEqual(n.toArray(),i.toArray())?n=void 0:bt(e,c.createLineNode(n,i,Oe.regularDashedLine)))}function Wt(e,n,r,o,a){if(null!==n&&e.remove(n),r){var s,l,u,p,d,g,y,v,P;switch(o){case t.ResultType.LINE:break;case t.ResultType.AXIS:l=(s=r.getPoints()).beginPoint.clone().sub(s.endPoint),u=30,p=w.getDistanceFromPixel(m,s.beginPoint,u),l.normalize().multiplyScalar(p),v=s.beginPoint.clone().add(l),P=s.endPoint.clone().sub(l),n=c.createLineNode(v,P,a);break;case t.ResultType.CIRCLE:n=new b;var A=r.getRadius();"2D"===i.owner.getAttribute("sMeasureOnGeometryType")&&r.get2DScale&&(A=r.get2DScale()*A),y=r.getCenter();var f=!1;if(!0===i.owner.getAttribute("bArcLengthDisplay"))f=!1;else if(0===i.owner.getAttribute("iRadiusResultDisplayType"))bt(n,c.createCircleNode(A,y,r.getAxis(),a));else{!1===i.owner.getAttribute("bRadiusDisplay")?bt(n,c.createCircleNode(A,y,r.getAxis(),a)):f=!0,Oe.crossPoint.force=!0,bt(n,h.createPointsNode({positions:y.clone().toArray(),material:Oe.crossPoint}))}if(f){s=r.getPoints();var M=r.getArcMidPoint();d=M.clone().sub(s.beginPoint),g=M.clone().sub(s.endPoint);var S=s.beginPoint,T=s.endPoint;g.length()<d.length()&&(S=s.endPoint,T=s.beginPoint);var D=y.clone().sub(S),C=y.clone().sub(T),_=y.clone().sub(M);_.normalize().negate().multiplyScalar(A);var E=c.createArcNode(A,y,D,_,Oe.regularSolidLine),L=c.createArcNode(A,y,_,C,Oe.regularSolidLine);bt(n,E),bt(n,L)}break;case t.ResultType.CYLINDER:n=new b,s=r.getPoints();var R=i.owner.getAttribute("vFirstExtensionPoint3D");void 0===X&&(R=r.getSelPoint().clone()),d=R.clone().sub(s.beginPoint),g=R.clone().sub(s.endPoint),y=s.beginPoint,g.length()<d.length()&&(y=s.endPoint);var N=s.endPoint.clone().sub(s.beginPoint);bt(n,c.createCircleNode(r.getRadius(),y,N,a)),l=s.beginPoint.clone().sub(s.endPoint),u=30,p=w.getDistanceFromPixel(m,y,u),l.normalize().multiplyScalar(p),v=s.beginPoint.clone().add(l),P=s.endPoint.clone().sub(l),bt(n,c.createLineNode(v,P,Oe.dotDashedLine));break;case t.ResultType.CONE:n=new b;var x,V=(s=r.getPoints()).endPoint,I=r.getApex(),k=r.getSemiAngle(),F=r.getAxis(),O=I.clone(),B=i.owner.getAttribute("sSurfaceDisplayType"),U=r.vSlat.clone(),G=I.clone().sub(V).length()*Math.tan(k),z=c.createCircleNode(G,V,F,a);if(bt(n,z),v=r.vExtensionPoint1,P=r.vExtensionPoint2,v&&P||(l=s.beginPoint.clone().sub(s.endPoint),u=30,p=w.getDistanceFromPixel(m,s.beginPoint,u),l.normalize().multiplyScalar(p),r.vExtensionPoint1=s.beginPoint.clone().add(l),r.vExtensionPoint2=s.endPoint.clone().sub(l),v=r.vExtensionPoint1.clone(),P=r.vExtensionPoint2.clone()),bt(n,c.createLineNode(v,P,Oe.dotDashedLine)),"Angle"===B)bt(n,c.createLineNode(i.owner.getAttribute("vSecondExtensionPoint3D"),O,Oe.regularSolidLine));else if("MinimumRadius"===B||"MinimumDiameter"===B){var H=I.clone().sub(s.beginPoint),J=I.clone().sub(s.endPoint),q=s.beginPoint.clone();H.length()>J.length()&&(q=s.endPoint.clone()),G=I.clone().sub(q).length()*Math.tan(k),bt(n,z=c.createCircleNode(G,q,F,a)),x=r.getMaxRadius()/Math.sin(k),U=U.normalize().multiplyScalar(x),O=I.clone().add(U)}else"MaximumRadius"!==B&&"MaximumDiameter"!==B||(x=r.getMinRadius()/Math.sin(k),U=U.normalize().multiplyScalar(x),O=I.clone().add(U));bt(n,c.createLineNode(i.owner.getAttribute("vFirstExtensionPoint3D"),O,Oe.regularSolidLine));break;case t.ResultType.SPHERE:n=new b,void 0===r.normal&&i.owner._buildConstructionPointsForConeCylSphere(),bt(n,c.createCircleNode(r.getRadius(),r.getCenter(),r.normal,a))}n&&bt(e,n)}}function jt(e,i,n,r,o){var a;if(Wt(e,i,n,r,r===t.ResultType.AXIS||r===t.ResultType.CIRCLE?Oe.avatarDashedLine:Oe.avatarSolidLine),r===t.ResultType.AXIS||r===t.ResultType.LINE){var p=n.getPoints(),d=s.computePointSegmentDistance(o.toArray(),p.beginPoint.toArray(),p.endPoint.toArray());0===d.returnCode&&d.relationship!==u.Relationship.COINCIDENT&&(a=new g.Vector3(d.aPosition[0],d.aPosition[1],d.aPosition[2]))}else a=n.getSelPoint();a&&(l.areEqual(a.toArray(),o.toArray())?a=void 0:bt(e,c.createLineNode(a,o,Oe.regularDashedLine)))}function Yt(){var e=!1;if("MeasureBetween"===nt&&"Angle"!==i.owner.getAttribute("sDistanceType")||"MeasureThickness"===nt){var n=i.owner.getAttribute("fDistance");e=void 0!==n&&!o.isZero(n)}else if("MeasureItem"===nt){var r=i.owner.getAttribute("sResultingType1");e="Length"===i.owner.getAttribute("sSurfaceDisplayType")&&(r===t.ResultType.CONE||r===t.ResultType.CYLINDER)||(r===t.ResultType.LINE&&!i.owner.getAttribute("bCumulativeMeasure")||r===t.ResultType.CIRCLE)}else"Measure3PointsCircle"===nt&&(e=!0);return e}function Qt(e){return e===t.ResultType.CIRCLE&&i.owner.getAttribute("iRadiusResultDisplayType")===t.RadiusResultDisplayType.TANGENT}function Kt(){var e=!1;if("MeasureBetween"===nt&&"Angle"!==i.owner.getAttribute("sDistanceType")||"MeasureThickness"===nt){var n=i.owner.getAttribute("fDistance");e=void 0!==n&&!o.isZero(n)}else if("MeasureItem"===nt){var r=i.owner.getAttribute("sResultingType1");e="Length"===i.owner.getAttribute("sSurfaceDisplayType")&&(r===t.ResultType.CONE||r===t.ResultType.CYLINDER)||(!!Qt(r)||r===t.ResultType.LINE&&!i.owner.getAttribute("bCumulativeMeasure"))}else"Measure3PointsCircle"===nt&&Qt(t.ResultType.CIRCLE)&&(e=!0);return e}function $t(){if((Yt()||"Angle"===i.owner.getAttribute("sDistanceType"))&&(Ye.manipulator&&Ye.manipulator.activate(Ye.token),Ke.manipulator&&Ke.manipulator.activate(Ke.token),Qe.manipulator&&Qe.manipulator.activate(Qe.token)),qe){var e=lt.getRepManipulator();e&&(Kt()&&e.avoidShiftKeyEvent&&e.avoidShiftKeyEvent(!0),e.activate())}Ze.manipulator&&Ze.manipulator.activate(Ze.token),Xe.manipulator&&Xe.manipulator.activate(Xe.token),Qe.manipulator&&Qe.manipulator.activate(Qe.token)}function ei(){if(Yt()&&(Ye.manipulator&&Ye.manipulator.deactivate(Ye.token),Ke.manipulator&&Ke.manipulator.deactivate(Ke.token),Qe.manipulator&&Qe.manipulator.deactivate(Qe.token)),qe){var e=lt.getRepManipulator();e&&e.deactivate()}Ze.manipulator&&Ze.manipulator.deactivate(Ze.token),Xe.manipulator&&Xe.manipulator.deactivate(Xe.token)}function ti(){if(Yt()){if(Ye.manipulator){let e=i.owner.getAttribute("vExtensionDirection3D").clone().cross(i.owner.getAttribute("vFirstExtensionPoint3D").clone().sub(i.owner.getAttribute("vSecondExtensionPoint3D")));Ye.manipulator.axis=e}if(Ke.manipulator){let e=i.owner.getAttribute("vExtensionDirection3D").clone().cross(i.owner.getAttribute("vFirstExtensionPoint3D").clone().sub(i.owner.getAttribute("vSecondExtensionPoint3D")));Ke.manipulator.axis=e}qe.manipulator&&(qe.manipulator.axis=i.owner.getAttribute("vSecondPoint3D").clone().sub(i.owner.getAttribute("vFirstPoint3D"))),Ze.manipulator&&it&&(Ze.manipulator.axis=i.owner.getAttribute("vAngleVector1").clone().cross(i.owner.getAttribute("vAngleVector2"))),Xe.manipulator&&it&&(Xe.manipulator.axis=i.owner.getAttribute("vAngleVector1").clone().cross(i.owner.getAttribute("vAngleVector2")))}}function ii(e,t){if(Mt(),!st){let i;!0===t?(yt=e.intersection.position.clone(),i=e.intersection.position.clone()):i=yt.clone().add(e.translationVector),lt.updateRepresentation({position:i,_bisCenterPrefRequired:!0}),i=void 0}}function ni(e){Mt(),st||(j&&(Pt=j.style.cursor,j.setStyle("cursor","move")),yt=e.intersection.position.clone(),mt=e.vInitAngleBreakPoint?e.vInitAngleBreakPoint:e.intersection.position.clone())}function ri(e,n){if(!st){var r=mt.clone().add(e.translationVector),o=r.clone().sub(i.owner.getAttribute("vAngleArcCenter")),a=r.distanceTo(i.owner.getAttribute("vAngleArcCenter")),s=i.owner.getAttribute("vAngleVector1"),l=i.owner.getAttribute("vAngleVector2"),u=s.clone().cross(l),c=u.clone().cross(s).dot(o),p=u.clone().cross(l).dot(o),d=i.owner.getAttribute("fQuadrant"),g=i.owner.getAttribute("bComplementaryAngle"),h=0,b=0;0>c&&(h+=2),0<p&&(h+=1);let S="true"===wt.preferences[0].value;var y,m,v;if(O()&&(S=!S),null==g)(!(y="MeasureItem"===nt&&i.owner.getAttribute("sResultingType1")===t.ResultType.CONE)||y&&0===h)&&(i.owner.setAttribute("fQuadrant",h),i.owner.setAttribute("vAngleBreakPoint",r),i.owner.setAttribute("vAnglePointingPoint",r),m=s.clone(),1!==h&&3!==h||m.negate(),v=l.clone(),2!==h&&3!==h||v.negate(),y||i.owner.setAttribute("fAngle",m.angleTo(v)));else{var P=!1;if(lt.bExtendAngleArc=!1,d===h||g)d===h&&g&&(lt.bExtendAngleArc=!0);else switch(d){case 0:3===h?P=!0:(lt.bExtendAngleArc=!0,b=3);break;case 1:2===h?P=!0:(lt.bExtendAngleArc=!0,b=2);break;case 2:1===h?P=!0:(lt.bExtendAngleArc=!0,b=1);break;case 3:0===h?P=!0:(lt.bExtendAngleArc=!0,b=0)}if((!(y="MeasureItem"===nt&&i.owner.getAttribute("sResultingType1")===t.ResultType.CONE)||y&&0===h)&&(P&&i.owner.setAttribute("fQuadrant",h),i.owner.setAttribute("vAngleBreakPoint",r),i.owner.setAttribute("vAnglePointingPoint",r),m=s.clone(),1!==d&&3!==d||m.negate(),v=l.clone(),2!==d&&3!==d||v.negate(),lt.bExtendAngleArc&&d!==b&&!g)){var A=o.angleTo(m),f=o.angleTo(v),w=m.angleTo(v),M=Math.abs(Math.PI-w)/2;A>M&&f>M&&i.owner.setAttribute("fQuadrant",b)}}S?lt.bExtendAngleArc?oi(r):function(e,t,n,r,o){var a=e.clone().add(t);o&&a.negate(),i.owner.setAttribute("vAnglePointingPoint",a.normalize().multiplyScalar(n)),i.owner.setAttribute("vAngleBreakPoint",a.normalize().multiplyScalar(n).add(r))}(m,v,a,i.owner.getAttribute("vAngleArcCenter"),g):oi(r),n&&n(r),ti(),i.owner.fireEvent("onDMUObjectVisuRefreshRequired",{dmuObject:i.owner})}}function oi(e){i.owner.setAttribute("vAngleBreakPoint",e),i.owner.setAttribute("vAnglePointingPoint",e)}function ai(e){if(Mt(),!st){j&&(Pt=j.style.cursor,j.setStyle("cursor","move")),ft=lt.bExtendAngleArc,yt=e.intersection.position.clone(),mt=yt;var t=(vt=i.owner.getAttribute("vAngleBreakPoint").clone()).clone();At=i.owner.getAttribute("fQuadrant");var n=yt.distanceTo(i.owner.getAttribute("vAngleArcCenter")),r=t.clone().sub(i.owner.getAttribute("vAngleArcCenter"));r.normalize().multiplyScalar(n),t=i.owner.getAttribute("vAngleArcCenter").clone().add(r),i.owner.setAttribute("vAngleBreakPoint",t),i.owner.setAttribute("vAnglePointingPoint",t),ti(),i.owner.fireEvent("onDMUObjectVisuRefreshRequired",{dmuObject:i.owner})}}function si(e){ri(e,(e=>{var t=e.distanceTo(i.owner.getAttribute("vAngleArcCenter")),n=vt.clone().sub(i.owner.getAttribute("vAngleArcCenter"));n.normalize().multiplyScalar(t),At!==i.owner.getAttribute("fQuadrant")&&n.negate();let r=i.owner.getAttribute("vAngleArcCenter").clone().add(n);i.owner.setAttribute("vAngleBreakPoint",r),i.owner.setAttribute("vAnglePointingPoint",r),lt.bExtendAngleArc=ft}))}function li(e){if(!i.owner.isReadOnly()&&i.owner.isEditable()){var t,n=Yt();(e||void 0!==ot&&n!==ot)&&(Ye.manipulator&&(Ye.manipulator.unlink(Ye.token),Ye.manipulator=null,Ye.token=null),Ke.manipulator&&(Ke.manipulator.unlink(Ke.token),Ke.manipulator=null,Ke.token=null),Qe.manipulator&&(Qe.manipulator.unlink(Qe.token),Qe.manipulator=null,Qe.token=null),Ze.manipulator&&(Ze.manipulator.unlink(Ze.token),Ze.manipulator=null,Ze.token=null),Xe.manipulator&&(Xe.manipulator.unlink(Xe.token),Xe.manipulator=null,Xe.token=null),Yt()&&(!function(){let e=i.owner.getAttribute("vExtensionDirection3D").clone().cross(i.owner.getAttribute("vFirstExtensionPoint3D").clone().sub(i.owner.getAttribute("vSecondExtensionPoint3D")));Ye.manipulator=new y({axis:e}),Ye.manipulator.setExclusive(!0),Ye.token=Ye.manipulator.linkToNode(Ye),Ke.manipulator=new y({axis:e}),Ke.manipulator.setExclusive(!0),Ke.token=Ke.manipulator.linkToNode(Ke),Ye.manipulator.subscribe("BeginManipulate",(function(e){Mt(),st||(yt=e.intersection.position.clone())})),Ke.manipulator.subscribe("BeginManipulate",(function(e){Mt(),st||(yt=e.intersection.position.clone())})),Ye.manipulator.subscribe("Manipulate",(function(e){if(!st){var t=yt.clone().add(e.translationVector);lt.updateRepresentation({position:t,_bisCenterPrefRequired:!1})}})),Ke.manipulator.subscribe("Manipulate",(function(e){if(!st){var t=yt.clone().add(e.translationVector);lt.updateRepresentation({position:t,_bisCenterPrefRequired:!1})}})),Ye.manipulator.subscribe("EndManipulate",St),Ke.manipulator.subscribe("EndManipulate",St)}(),"2D"===i.owner.getAttribute("sMeasureOnGeometryType")&&"Angle"===i.owner.getAttribute("sDistanceType")||(0===(t=i.owner.getAttribute("vFirstExtensionPoint3D").clone().sub(i.owner.getAttribute("vSecondPoint3D")).cross(i.owner.getAttribute("vFirstExtensionPoint3D").clone().sub(i.owner.getAttribute("vSecondExtensionPoint3D")))).length&&(t=i.owner.getAttribute("vExtensionDirection3D").cross(i.owner.getAttribute("vFirstExtensionPoint3D").clone().sub(i.owner.getAttribute("vSecondExtensionPoint3D")))),Qe.manipulator=new y({axis:t}),Qe.manipulator.setExclusive(!0),Qe.token=Qe.manipulator.linkToNode(Qe),Qe.manipulator.subscribe("BeginManipulate",(e=>{ii(e,!0)})),Qe.manipulator.subscribe("Manipulate",ii),Qe.manipulator.subscribe("EndManipulate",St))),"Angle"===i.owner.getAttribute("sDistanceType")&&function(){var e=it?i.owner.getAttribute("vAngleVector1").clone().cross(i.owner.getAttribute("vAngleVector2")):new g.Vector3;Qe.manipulator=new y({axis:e}),Qe.manipulator.setExclusive(!0),Qe.token=Qe.manipulator.linkToNode(Qe);var t=Qe.manipulator;t.subscribe("BeginManipulate",ai),t.subscribe("Manipulate",si),t.subscribe("EndManipulate",(function(e){st||j&&j.setStyle("cursor",Pt),St(e),ft=void 0,yt=void 0,mt=void 0,vt=void 0}))}(),function(){var e=it?i.owner.getAttribute("vAngleVector1").clone().cross(i.owner.getAttribute("vAngleVector2")):new g.Vector3;Ze.manipulator=new y({axis:e}),Ze.manipulator.setExclusive(!0),Ze.token=Ze.manipulator.linkToNode(Ze.getBackNode());var t=Ze.manipulator;t.subscribe("BeginManipulate",(function(e){e.vInitAngleBreakPoint=i.owner.getAttribute("vAngleBreakPoint").clone(),ni(e)})),t.subscribe("Manipulate",(function(e){ri(e)})),t.subscribe("EndManipulate",(function(e){st||j&&j.setStyle("cursor",Pt),St(e)}))}(),function(){var e=it?i.owner.getAttribute("vAngleVector1").clone().cross(i.owner.getAttribute("vAngleVector2")):new g.Vector3;Xe.manipulator=new y({axis:e}),Xe.manipulator.setExclusive(!0),Xe.token=Xe.manipulator.linkToNode(Xe);var t=Xe.manipulator;t.subscribe("BeginManipulate",ni),t.subscribe("Manipulate",(function(e){ri(e)})),t.subscribe("EndManipulate",(function(e){st||j&&j.setStyle("cursor",Pt),St(e)}))}(),ot=n)}}function ui(e,t){var n,r=!1,o=!0;switch(t){case"bool":r=void 0===(n=i.owner.getAttribute("b"+e))||void 0!==ut[e]&&n===ut[e];break;case"int":r=void 0===(n=i.owner.getAttribute("i"+e))||void 0!==ut[e]&&n===ut[e];break;case"float":r=void 0===(n=i.owner.getAttribute("f"+e))||void 0!==ut[e]&&n===ut[e];break;case"string":void 0===(n=i.owner.getAttribute("s"+e))&&ut[e]&&(n=ut[e]),r=void 0===n||void 0!==ut[e]&&n===ut[e];break;case"Color":r=void 0===(n=i.owner.getAttribute("c"+e))||void 0!==ut[e]&&n.equals(ut[e]);break;case"Vector3":null!=(n=i.owner.getAttribute("v"+e))&&(n=n.clone()),r=null==n||void 0!==ut[e]&&n.equals(ut[e]);break;case"AABB":r=void 0===(n=i.owner.getAttribute(e))||void 0!==ut[e]&&a.areEqualAABB(n,ut[e]);break;default:r=!1,o=!1}return!r&o&&(ut[e]=n),r}function ci(e){var t={value:0,scale:1};switch(e){case"None":t.value=0;break;case"Cross":t.value=1;break;case"Plus":t.value=2;break;case"Concentric":t.value=3;break;case"Coincident":t.value=4;break;case"FullCircle":t.value=5;break;case"FullSquare":t.value=6;break;case"Star":t.value=7;break;case"Dot":t.value=8,t.scale=.6;break;case"SmallDot":t.value=9,t.scale=.4}return t}function pi(){if(Ke&&i.owner)if(tt||!it){Ke.setVisibility(!0);var e=Tt(),r=1;let u=i.owner.getMeasurable(1);var o=i.owner.getAttribute("vLeaderPointingPoint3D"),a=i.owner.getAttribute("vLeaderBreakPoint3D"),s=!Yt();if("MeasureBetween"===nt||"MeasureThickness"===nt)r=0;else if("Measure3PointsCircle"===nt)r=0,i.owner.getAttribute("iRadiusResultDisplayType")===t.RadiusResultDisplayType.CENTER&&(o=i.owner.getAttribute("vFirstExtensionPoint3D").clone());else if("MeasureItem"===nt){var l=function(e,n,r){var o={vLeaderPointingPoint:n,headType:r};if(void 0!==o.headType&&void 0!==o.vLeaderPointingPoint){var a=i.owner.getAttribute("sSurfaceDisplayType"),s=!0;switch(i.owner.getAttribute("sResultingType1")){case t.ResultType.CYLINDER:case t.ResultType.SPHERE:if(void 0===X){var l=i.owner._buildConstructionPointsForConeCylSphere();o.vLeaderPointingPoint=l.oPos1}"Area"===a?o.headType=1:(o.headType=0,s=!1);break;case t.ResultType.CURVE:i.owner.getAttribute("bCumulativeMeasure")&&(o.headType=2,s=!0);break;case t.ResultType.LINE:o.headType=0,i.owner.getAttribute("bCumulativeMeasure")&&(o.headType=2,s=!0);break;case t.ResultType.CIRCLE:o.headType=0,i.owner.getAttribute("iRadiusResultDisplayType")===t.RadiusResultDisplayType.CENTER&&void 0!==e.getSelPoint()&&(o.vLeaderPointingPoint=e.getSelPoint());break;case t.ResultType.PLANE:case t.ResultType.SURFACE:o.headType=2;break;case t.ResultType.POINT:case t.ResultType.CENTER:o.headType=4;break;case t.ResultType.PRODUCT:o.headType=3;break;case t.ResultType.CONE:s=!1,"Length"===a||"MinimumRadius"===a||"MinimumDiameter"===a||"MaximumRadius"===a||"MaximumDiameter"===a?o.headType=0:"Area"===a&&(o.headType=1,s=!0)}if(s){var u=i.owner.getAttribute("sLeaderEndType");if(void 0!==u){switch(u){case"No end":u=0;break;case"Arrow":u=1;break;case"Bubble":u=2;break;case"Square":u=3;break;case"Cross":u=4}o.headType=u}}return o}}(u,o,r);void 0!==l&&void 0!==l.headType&&void 0!==l.vLeaderPointingPoint&&(r=l.headType,o=l.vLeaderPointingPoint)}i.owner.getAttribute("sResultingType1")===t.ResultType.CONE&&Ke.removeChildren(),(i.owner.getAttribute("sTextGraphicRepresentationID")?i.owner.getTesselatedRep(i.owner.getAttribute("sTextGraphicRepresentationID")):i.owner.getAttribute("sTextGraphicRepresentation"))&&("MeasureItem"===nt&&i.owner.getAttribute("sResultingType1")===t.ResultType.POINT&&(r=1),s=!1),n.modifyLeaderNode(m,Ke,s,a,o,void 0,e.leaderStyle&&void 0!==e.leaderStyle.thickness?e.leaderStyle.thickness:e.lineStyle.thickness,e.leaderStyle&&e.leaderStyle.color?e.leaderStyle.color:e.lineStyle.color,null,r,Object.assign(qe.getDimensions(),{rotationAngle:i.owner.getAttribute("fBoxRotationAngle")}),i.frmWindow)}else Ke.removeChildren()}function di(e,n,r,a){var l,p,d=i.owner.getAttribute("vAngleArcCenter"),h=i.owner.getAttribute("vAnglePointingPoint"),b=i.owner.getAttribute("vAngleBreakPoint"),y=i.owner.getAttribute("vAngleVector1"),v=i.owner.getAttribute("vAngleVector2");if("MeasureItem"===nt&&n===t.ResultType.CONE&&null==h&&(i.owner._buildConstructionPointsForConeCylSphere(),d=e.getApex().clone(),h=e.arcCenter.clone(),y=e.vAxis.clone(),v=e.vSlat.clone()),d&&h&&y&&v){var P=y.clone(),A=i.owner.getAttribute("fAngle"),f=!1;if(A)(o.isZero(A)?0:180*A/Math.PI)>180&&(f=!0);var M=i.owner.getAttribute("fQuadrant");"MeasureItem"===nt&&n===t.ResultType.CONE&&null==M&&(M=0),1!==M&&3!==M||P.negate();var S=v.clone();2!==M&&3!==M||S.negate(),l=h.clone().sub(d).length();var T=d.clone().add(P.clone().normalize().multiplyScalar(l)),D=d.clone().add(S.clone().normalize().multiplyScalar(l)),C=(new g.Vector3).crossVectors(P.clone(),S.clone()),_=(new g.Vector3).crossVectors(C.clone().normalize(),P.clone()),E=(new g.Vector3).crossVectors(C.clone().normalize(),S.clone());if(f&&(_.negate(),E.negate()),function(e,t,n,r,o,a,s,l,u,p,d,g){if(it){var h=a.clone(),b=o.clone();if(lt.bExtendAngleArc&&((h=e.clone().sub(r)).normalize().multiplyScalar(n),l.distanceTo(e)<u.distanceTo(e)&&(b=a.clone())),Xe.removeChildren(),bt(Xe,c.createArcNode(n,r,b,h,Oe.regularSolidLine,s)),Ht(Ye,l,u,p,d,g),void 0!==e&&void 0!==t&&!t.equals(e)){var y=c.createLineNode(t,e,Oe.regularSolidLine);bt(Qe,y)}null==i.owner.getAttribute("bComplementaryAngle")&&"2D"===i.owner.getAttribute("sMeasureOnGeometryType")&&"MeasureBetween"===nt&&(Xt(Qe,i.owner.getMeasurable(1),r),Xt(Qe,i.owner.getMeasurable(2),r))}}(b,h,l,d,P,S,f,T,D,_,E,a),"MeasureItem"===nt&&n===t.ResultType.CONE)!function(e,t,n,r,o){var a,s,l,u,p,d=e.vExtensionPoint1,h=e.vExtensionPoint2;d&&h||(s=(a=e.getPoints()).beginPoint.clone().sub(a.endPoint),l=w.getDistanceFromPixel(m,a.beginPoint,30),s.normalize().multiplyScalar(l),e.vExtensionPoint1=a.beginPoint.clone().add(s),e.vExtensionPoint2=a.endPoint.clone().sub(s),d=e.vExtensionPoint1.clone(),h=e.vExtensionPoint2.clone());var b=[];b.push(d.clone().toArray()),b.push(h.clone().toArray());var y=R._computePointCurveSquaredDistance(n.clone().toArray(),1,b),v=Math.sqrt(y.squaredDistance);u=new g.Vector3(y.aPosition1[0],y.aPosition1[1],y.aPosition1[2]),p=new g.Vector3(y.aPosition2[0],y.aPosition2[1],y.aPosition2[2]),t=v>ct?p:u;var P=i.owner.getAttribute("sSurfaceDisplayType");if(bt(Qe,"Angle"===P?c.createLineNode(r,n,Oe.regularSolidLine):c.createLineNode(t,n,Oe.regularSolidLine)),"MinimumRadius"!==P&&"MinimumDiameter"!==P&&"MaximumRadius"!==P&&"MaximumDiameter"!==P){bt(Qe,c.createLineNode(r,o,Oe.regularSolidLine));var A=e.getApex();y=R._computePointCurveSquaredDistance(A.clone().toArray(),1,b),(v=Math.sqrt(y.squaredDistance))>ct&&(p=new g.Vector3(y.aPosition2[0],y.aPosition2[1],y.aPosition2[2]),bt(Qe,c.createLineNode(A,p,Oe.regularSolidLine)))}}(e,p,T,d,D);else if(n===t.ResultType.AXIS||r===t.ResultType.AXIS)!function(e,n,r,o,a,s,l){var u,p,d,h,b=[];if(n===t.ResultType.AXIS){void 0!==e.vExtensionPoint1&&void 0!==e.vExtensionPoint2||(p=(u=e.getPoints()).beginPoint.clone().sub(u.endPoint),d=30,h=w.getDistanceFromPixel(m,u.beginPoint,d),p.normalize().multiplyScalar(h),e.vExtensionPoint1=u.beginPoint.clone().add(p),e.vExtensionPoint2=u.endPoint.clone().sub(p)),b.push(e.vExtensionPoint1.clone().toArray()),b.push(e.vExtensionPoint2.clone().toArray());var y=R._computePointCurveSquaredDistance(s.clone().toArray(),1,b);Math.sqrt(y.squaredDistance)>ct?bt(Qe,c.createLineNode(s,a,Oe.regularSolidLine)):(0===X&&(y=R._computePointCurveSquaredDistance(a.clone().toArray(),1,b),o=Math.sqrt(y.squaredDistance)>ct?new g.Vector3(y.aPosition2[0],y.aPosition2[1],y.aPosition2[2]):a),bt(Qe,c.createLineNode(o,a,Oe.regularSolidLine)))}else bt(Qe,c.createLineNode(s,a,Oe.regularSolidLine));if(r===t.ResultType.AXIS){var v=i.owner.getMeasurable(2);void 0!==v.vExtensionPoint1&&void 0!==v.vExtensionPoint2||(p=(u=v.getPoints()).beginPoint.clone().sub(u.endPoint),d=30,h=w.getDistanceFromPixel(m,u.beginPoint,d),p.normalize().multiplyScalar(h),v.vExtensionPoint1=u.beginPoint.clone().add(p),v.vExtensionPoint2=u.endPoint.clone().sub(p));var P=[];P.push(v.vExtensionPoint1.clone().toArray()),P.push(v.vExtensionPoint2.clone().toArray());var A,f=R._computePointCurveSquaredDistance(s.clone().toArray(),1,P);Math.sqrt(f.squaredDistance)>ct?bt(Qe,c.createLineNode(s,l,Oe.regularSolidLine)):(0===X&&(f=R._computePointCurveSquaredDistance(l.clone().toArray(),1,P),A=Math.sqrt(f.squaredDistance)>ct?new g.Vector3(f.aPosition2[0],f.aPosition2[1],f.aPosition2[2]):l),bt(Qe,c.createLineNode(A,l,Oe.regularSolidLine)))}else bt(Qe,c.createLineNode(s,l,Oe.regularSolidLine))}(e,n,r,p,T,d,D);else if(it){var L,x=i.owner.getMeasurable(2),V=d,I=d,k=i.owner.getAttribute("lFirstExtensionPoints");k&&0===(L=s.computePointSegmentDistance(T.toArray(),k[0].toArray(),k[1].toArray())).returnCode&&(V=new g.Vector3(L.aPosition[0],L.aPosition[1],L.aPosition[2])),i.owner.isReadOnly()&&l<P.length()&&(T=d.clone().add(P.clone().normalize().multiplyScalar(P.length()))),bt(Qe,c.createLineNode(V,T,Oe.regularSolidLine));var F=i.owner.getAttribute("lbExtensionRequired");if(F&&2===F.length&&F[0])if(e.getType()===u.GeometryType.PLANE)bt(Qe,c.createLineNode(V,e.getSelPoint(),Oe.regularDashedLine));else{var O=e.getPoints().beginPoint;0===(L=N.computePointLineDistance(V.toArray(),O.toArray(),y.toArray())).returnCode&&(O=new g.Vector3(L.aPosition[0],L.aPosition[1],L.aPosition[2])),bt(Qe,c.createLineNode(V,O,Oe.regularDashedLine))}(k=i.owner.getAttribute("lSecondExtensionPoints"))&&0===(L=s.computePointSegmentDistance(D.toArray(),k[0].toArray(),k[1].toArray())).returnCode&&(I=new g.Vector3(L.aPosition[0],L.aPosition[1],L.aPosition[2])),i.owner.isReadOnly()&&l<S.length()&&(D=d.clone().add(S.clone().normalize().multiplyScalar(S.length()))),bt(Qe,c.createLineNode(I,D,Oe.regularSolidLine)),F&&2===F.length&&F[1]&&x.getType()===u.GeometryType.PLANE&&bt(Qe,c.createLineNode(I,x.getSelPoint(),Oe.regularDashedLine))}}}function gi(e,t){return e&&t&&(t===u.GeometryType.LINE||t===u.GeometryType.CYLINDER||t===u.GeometryType.CONE)}function hi(e,n,r,o,a){var s=a;if(n===t.ResultType.AXIS&&r===t.ResultType.AXIS&&void 0!==o&&o<ct&&i.owner.getAttribute("fDistance")){var l=i.owner.getAttribute("vExtensionDirection3D"),u=e.getPoints(),c=l.angleTo(u.beginPoint.clone().sub(u.endPoint));(c<ct||Math.abs(c-Math.PI)<ct)&&(s=!0)}return s}function bi(e,n,r){var a,s,l,p=i.owner.getMeasurable(2),d=r.getType(),h=p.getType(),y="Distance"===i.owner.getAttribute("sDistanceType"),v=gi(y,d),P=gi(y,h),A=i.owner.getAttribute("vFirstPoint3D"),f=i.owner.getAttribute("vSecondPoint3D"),M=i.owner.getAttribute("vFirstExtensionPoint3D"),S=i.owner.getAttribute("vSecondExtensionPoint3D"),T=i.owner.getAttribute("sSelectedType1"),D=i.owner.getAttribute("sSelectedType2"),C=!1;(i.owner.isReadOnly()||T===t.ViewedType.INFPLANE&&D===t.ViewedType.INFPLANE||T===t.ViewedType.POINT&&D===t.ViewedType.INFPLANE||T===t.ViewedType.INFPLANE&&D===t.ViewedType.POINT||T===t.ViewedType.INFPLANE&&D===t.ViewedType.CURVE&&h===u.GeometryType.LINE||T===t.ViewedType.CURVE&&d===u.GeometryType.LINE&&D===t.ViewedType.INFPLANE)&&(C=!0),C&&(s=i.owner.getAttribute("lFirstExtensionPoints"),l=i.owner.getAttribute("lSecondExtensionPoints"));var _,E,L,N,x,V,I,k=!1;if(k=hi(r,e,n,i.owner.getAttribute("fAngle"),k),hi(k),e===t.ResultType.AXIS||v){void 0!==r.vExtensionPoint1&&void 0!==r.vExtensionPoint2||(_=r.getPoints(),r.vExtensionPoint1=_.beginPoint.clone(),r.vExtensionPoint2=_.endPoint.clone(),e===t.ResultType.AXIS&&(E=_.beginPoint.clone().sub(_.endPoint),L=30,N=w.getDistanceFromPixel(m,_.beginPoint,L),E.normalize().multiplyScalar(N),r.vExtensionPoint1=_.beginPoint.clone().add(E),r.vExtensionPoint2=_.endPoint.clone().sub(E)));var F=[];F.push(r.vExtensionPoint1.clone().toArray()),F.push(r.vExtensionPoint2.clone().toArray());var O=R._computePointCurveSquaredDistance(M.clone().toArray(),1,F),B=Math.sqrt(O.squaredDistance);x=new g.Vector3(O.aPosition1[0],O.aPosition1[1],O.aPosition1[2]),V=new g.Vector3(O.aPosition2[0],O.aPosition2[1],O.aPosition2[2]),B>ct?e!==t.ResultType.AXIS?(a=c.createLineNode(x.clone(),V.clone(),Oe.regularDashedLine),bt(Qe,a)):(k||(a=c.createLineNode(x.clone(),V.clone(),Oe.dotLine),bt(Qe,a)),(I=[]).push(M.clone().toArray()),k?I=F:o.areEqual(V,r.vExtensionPoint1,"Vector3")?I.push(r.vExtensionPoint2.clone().toArray()):I.push(r.vExtensionPoint1.clone().toArray()),O=R._computePointCurveSquaredDistance(A.clone().toArray(),1,I),M=Math.sqrt(O.squaredDistance)>ct?new g.Vector3(O.aPosition2[0],O.aPosition2[1],O.aPosition2[2]):A):e===t.ResultType.AXIS&&0===X&&(O=R._computePointCurveSquaredDistance(A.clone().toArray(),1,F),M=Math.sqrt(O.squaredDistance)>ct?new g.Vector3(O.aPosition2[0],O.aPosition2[1],O.aPosition2[2]):A)}if(n===t.ResultType.AXIS||P){void 0!==p.vExtensionPoint1&&void 0!==p.vExtensionPoint2||(_=p.getPoints(),p.vExtensionPoint1=_.beginPoint.clone(),p.vExtensionPoint2=_.endPoint.clone(),n===t.ResultType.AXIS&&(E=_.beginPoint.clone().sub(_.endPoint),L=30,N=w.getDistanceFromPixel(m,_.beginPoint,L),E.normalize().multiplyScalar(N),p.vExtensionPoint1=_.beginPoint.clone().add(E),p.vExtensionPoint2=_.endPoint.clone().sub(E)));var U=[];U.push(p.vExtensionPoint1.clone().toArray()),U.push(p.vExtensionPoint2.clone().toArray());var G=R._computePointCurveSquaredDistance(S.clone().toArray(),1,U),z=Math.sqrt(G.squaredDistance);x=new g.Vector3(G.aPosition1[0],G.aPosition1[1],G.aPosition1[2]),V=new g.Vector3(G.aPosition2[0],G.aPosition2[1],G.aPosition2[2]),z>ct?n!==t.ResultType.AXIS?(a=c.createLineNode(x.clone(),V.clone(),Oe.regularDashedLine),bt(Qe,a)):(k||(a=c.createLineNode(x.clone(),V.clone(),Oe.dotLine),bt(Qe,a)),(I=[]).push(S.clone().toArray()),k?I=U:o.areEqual(V,p.vExtensionPoint1,"Vector3")?I.push(p.vExtensionPoint2.clone().toArray()):I.push(p.vExtensionPoint1.clone().toArray()),G=R._computePointCurveSquaredDistance(f.clone().toArray(),1,I),S=Math.sqrt(G.squaredDistance)>ct?new g.Vector3(G.aPosition2[0],G.aPosition2[1],G.aPosition2[2]):f):n===t.ResultType.AXIS&&0===X&&(G=R._computePointCurveSquaredDistance(f.clone().toArray(),1,U),S=Math.sqrt(G.squaredDistance)>ct?new g.Vector3(G.aPosition2[0],G.aPosition2[1],G.aPosition2[2]):f)}bt(Qe,function(e,n,r,a,s,l,p,d){var h=new b;if(e&&n&&r&&a){var y=i.owner.getMeasurable(1),m=i.owner.getMeasurable(2),v=y.getType(),P=m.getType(),A=i.owner.getAttribute("sSelectedType1"),f=i.owner.getAttribute("sSelectedType2"),w=!1;(A===t.ViewedType.INFPLANE&&f===t.ViewedType.INFPLANE||A===t.ViewedType.POINT&&f===t.ViewedType.INFPLANE||A===t.ViewedType.INFPLANE&&f===t.ViewedType.POINT||A===t.ViewedType.INFPLANE&&f===t.ViewedType.CURVE&&P===u.GeometryType.LINE||A===t.ViewedType.CURVE&&v===u.GeometryType.LINE&&f===t.ViewedType.INFPLANE)&&(w=!0);var M=n.clone(),S=a.clone();s&&(M.add(e).multiplyScalar(.5),S.add(r).multiplyScalar(.5));var T=!0,D=!0,C=!1;if(w&&p&&p.length>0&&d&&d.length>0&&(C=!0),i.owner.isReadOnly()||C){var _=M.clone().sub(e.clone()).normalize(),E=e.clone().sub(r.clone()).normalize(),L=_.cross(E),R=(new g.Plane).setFromNormalAndCoplanarPoint(L.normalize().clone(),e.clone());if(p&&p.length>0){var N=p[0];r=R.projectPoint(p[0]);for(var x=e.distanceTo(r),V=1;V<p.length;V++){var I=R.projectPoint(p[V]);e.distanceTo(I)<x&&(N=p[V],r=I.clone())}if(2===p.length){var k=p[0].distanceTo(p[1]),F=e.distanceTo(p[0])+e.distanceTo(p[1])-k;o.isZero(F)&&(T=!1)}if(T){var O=c.createLineNode(r.clone(),N.clone(),l);o.areEqual(N,r,"Vector3")||bt(h,O)}}if(d&&d.length>0){var B=d[0];S=R.projectPoint(d[0]);for(var U=n.distanceTo(S),G=1;G<d.length;G++){var z=R.projectPoint(d[G]);n.distanceTo(z)<U&&(B=d[G],S=z.clone())}if(2===d.length){var H=d[0].distanceTo(d[1]),J=n.distanceTo(d[0])+n.distanceTo(d[1])-H;o.isZero(J)&&(D=!1)}if(D){var q=c.createLineNode(S.clone(),B.clone(),l);o.areEqual(B,S,"Vector3")||bt(h,q)}}}if(T){var Z=c.createLineNode(r.clone(),e.clone(),l);o.areEqual(r,e,"Vector3")||bt(h,Z)}if(D){var X=c.createLineNode(S.clone(),M.clone(),l);o.areEqual(S,M,"Vector3")||bt(h,X)}}return h}(A,f,M,S,!1,Oe.regularSolidLine,s,l))}function yi(e){var t=e.leaderStyle&&void 0!==e.leaderStyle.thickness?e.leaderStyle.thickness:e.lineStyle.thickness;return Math.max(2*t+4,z)}function mi(e,n,r,o){var a,s=i.owner.getAttribute("vFirstExtensionPoint3D"),l=i.owner.getAttribute("vSecondExtensionPoint3D");n===t.ResultType.CURVE&&(s=(a=e.getPoints()).beginPoint.clone(),l=a.endPoint.clone());var u={value:5,scale:1};o=yi(r);var c=i.owner.getAttribute("sExtremityType");void 0!==c&&(u=ci(c));var p=r.lineStyle.color,d=u.value;8!==d&&9!==d||(d=5);var b=C.retrieveMaterialFromGAS({size:o,withoutDPR:!0,scale:u.scale,symbol:d,color:new g.Color(p)});b.force=!0,bt(je,h.createPointsNode({positions:s.toArray(),material:b})),bt(je,h.createPointsNode({positions:l.toArray(),material:b}))}function vi(e,n,r,a){var l,p="MeasureItem"===nt,d="MeasureBetween"===nt,b="MeasureThickness"===nt;p&&n!==t.ResultType.LINE&&n!==t.ResultType.CIRCLE&&n!==t.ResultType.CONE&&n!==t.ResultType.CYLINDER||(ie&&he&&Te&&be||Ye.removeChildren(),Qe.removeChildren(),Xe.removeChildren(),ei(),d&&(Oe.regularSolidLine.lineWidth=a.leaderStyle&&void 0!==a.leaderStyle.thickness?a.leaderStyle.thickness:a.lineStyle.thickness),l=i.owner.isReadOnly()&&it&&n===t.ResultType.CIRCLE,d||b||p&&(n===t.ResultType.CONE||l)?((d||p&&(n===t.ResultType.CONE&&"Length"!==i.owner.getAttribute("sSurfaceDisplayType")&&"Area"!==i.owner.getAttribute("sSurfaceDisplayType")||l))&&di(e,n,r,a),Yt()&&!l&&function(e,n,r,o){var a="MeasureBetween"===nt||"MeasureItem"===nt&&(e===t.ResultType.CONE||e===t.ResultType.CYLINDER)&&"Length"===i.owner.getAttribute("sSurfaceDisplayType");Jt(Ye,i.owner.getAttribute("vFirstPoint3D"),i.owner.getAttribute("vSecondPoint3D"),i.owner.getAttribute("vLeaderBreakPoint3D"),!0,!1,o,a),"MeasureBetween"===nt?bi(e,n,r):bt(Qe,qt(i.owner.getAttribute("vFirstPoint3D"),i.owner.getAttribute("vSecondPoint3D"),i.owner.getAttribute("vFirstExtensionPoint3D"),i.owner.getAttribute("vSecondExtensionPoint3D"),!1,o))}(n,r,e,a)):p?function(e,n){switch(e){case t.ResultType.LINE:i.owner.getAttribute("bCumulativeMeasure")?(Ye.removeChildren(),Qe.removeChildren()):(Jt(Ye,i.owner.getAttribute("vFirstPoint3D"),i.owner.getAttribute("vSecondPoint3D"),i.owner.getAttribute("vLeaderBreakPoint3D"),!0,!1,n,!0),bt(Qe,qt(i.owner.getAttribute("vFirstPoint3D"),i.owner.getAttribute("vSecondPoint3D"),i.owner.getAttribute("vFirstExtensionPoint3D"),i.owner.getAttribute("vSecondExtensionPoint3D"),!1,n)));break;case t.ResultType.CIRCLE:if(0!==i.owner.getAttribute("iRadiusResultDisplayType")){var r=i.owner.getAttribute("vArcMidPoint"),a=i.owner.getAttribute("vFirstExtensionPoint3D");o.areEqual(r,a,"Vector3")||i.owner._buildConstructionData(),Jt(Ye,i.owner.getAttribute("vFirstPoint3D"),i.owner.getAttribute("vSecondPoint3D"),i.owner.getAttribute("vLeaderBreakPoint3D"),!0,i.owner.getAttribute("bRadiusDisplay"),n,!0,!1,!0,i.owner.getAttribute("bRadiusDisplay")),bt(Qe,qt(i.owner.getAttribute("vFirstPoint3D"),i.owner.getAttribute("vSecondPoint3D"),i.owner.getAttribute("vFirstExtensionPoint3D"),i.owner.getAttribute("bRadiusDisplay")?i.owner.getAttribute("vSecondPoint3D"):i.owner.getAttribute("vSecondExtensionPoint3D"),!1,n))}break;case t.ResultType.CYLINDER:"Length"===i.owner.getAttribute("sSurfaceDisplayType")&&(Jt(Ye,i.owner.getAttribute("vFirstPoint3D"),i.owner.getAttribute("vSecondPoint3D"),i.owner.getAttribute("vLeaderBreakPoint3D"),!0,!1,n,!0),bt(Qe,qt(i.owner.getAttribute("vFirstPoint3D"),i.owner.getAttribute("vSecondPoint3D"),i.owner.getAttribute("vFirstExtensionPoint3D"),i.owner.getAttribute("vSecondExtensionPoint3D"),!1,n)))}}(n,a):"Measure3PointsCircle"===nt?i.owner.getAttribute("iRadiusResultDisplayType")!==t.RadiusResultDisplayType.CENTER&&(Jt(Ye,i.owner.getAttribute("vFirstPoint3D"),i.owner.getAttribute("vSecondPoint3D"),i.owner.getAttribute("vLeaderBreakPoint3D"),!0,i.owner.getAttribute("bRadiusDisplay"),a,!0,!1,!0,i.owner.getAttribute("bRadiusDisplay")),bt(Qe,qt(i.owner.getAttribute("vFirstPoint3D"),i.owner.getAttribute("vSecondPoint3D"),i.owner.getAttribute("vFirstExtensionPoint3D"),i.owner.getAttribute("vSecondExtensionPoint3D"),i.owner.getAttribute("bRadiusDisplay"),a))):"Measure3PointsAngle"===nt&&function(e,t){var n=i.owner.getAttribute("vAngleVector1").clone(),r=i.owner.getAttribute("vAngleVector2").clone(),a=i.owner.getAttribute("fQuadrant"),l=!1,p=i.owner.getAttribute("fAngle");p&&(o.isZero(p)?0:180*p/Math.PI)>180&&(l=!0),void 0!==a&&(1!==a&&3!==a||n.negate(),2!==a&&3!==a||r.negate());var d=i.owner.getAttribute("vAnglePointingPoint"),b=i.owner.getAttribute("bHasALeader"),y=i.owner.getAttribute("vAngleBreakPoint"),m=Oe.regularSolidLine;if(void 0!==b&&void 0!==d&&void 0!==y&&!0===b){m=Oe.regularSolidLine;var v=c.createLineNode(i.owner.getAttribute("vAnglePointingPoint"),i.owner.getAttribute("vAngleBreakPoint"),m);bt(Qe,v),Oe.crossPoint.force=!0;var P=h.createPointsNode({positions:d.clone().toArray(),material:Oe.crossPoint}),A=h.createPointsNode({positions:y.clone().toArray(),material:Oe.crossPoint});bt(Qe,P),bt(Qe,A)}var f=i.owner.getAttribute("vAngleArcCenter"),w=i.owner.getAttribute("vAnglePointingPoint").clone().sub(f).length(),M=f.clone().add(n.clone().normalize().multiplyScalar(w)),S=f.clone().add(r.clone().normalize().multiplyScalar(w)),T=r.clone(),D=n.clone();if(lt.bExtendAngleArc){var C=i.owner.getAttribute("vAngleBreakPoint");(T=C.clone().sub(f)).normalize().multiplyScalar(w),M.distanceTo(C)<S.distanceTo(C)&&(D=r.clone())}Xe.removeChildren(),bt(Xe,c.createArcNode(w,f,D,T,m,l));var _=i.owner.getMeasurable(2);if(_){var E,L=s.computePointSegmentDistance(M.toArray(),e.getSelPoint().toArray(),_.getSelPoint().toArray());0===L.returnCode&&L.relationship!==u.Relationship.COINCIDENT&&(E=new g.Vector3(L.aPosition[0],L.aPosition[1],L.aPosition[2]),bt(Qe,c.createLineNode(E,M,Oe.regularSolidLine)));var R=(new g.Vector3).crossVectors(n.clone(),r.clone()),N=(new g.Vector3).crossVectors(R.clone().normalize(),n.clone()),x=(new g.Vector3).crossVectors(R.clone().normalize(),r.clone());l&&(N.negate(),x.negate()),Ht(Ye,M,S,N,x,t),0===(L=s.computePointSegmentDistance(S.toArray(),i.owner.getMeasurable(3).getSelPoint().toArray(),_.getSelPoint().toArray())).returnCode&&L.relationship!==u.Relationship.COINCIDENT&&(E=new g.Vector3(L.aPosition[0],L.aPosition[1],L.aPosition[2]),bt(Qe,c.createLineNode(E,S,Oe.regularSolidLine)))}}(e,a),$t())}function Pi(e,n,r,a,s){var l,p=i.owner.getMeasurable(2);if(p){if("MeasureBetween"===nt&&function(e,n,r,a){var s,l,u,p,d,g=i.owner.getAttribute("vFirstExtensionPoint3D"),b=i.owner.getAttribute("vSecondExtensionPoint3D");if(!o.areEqual(g,b,"Vector3")){var y,v,P=n,A=r,f=void 0!==i.owner.getAttribute("fAngle")&&o.isZero(i.owner.getAttribute("fAngle"));P===t.ResultType.PLANE&&A===t.ResultType.PLANE&&f?a&&(a.force=!0,y=h.createPointsNode({positions:g.clone().toArray(),material:a}),bt(je,y),v=h.createPointsNode({positions:b.clone().toArray(),material:a}),bt(je,v)):P===t.ResultType.AXIS&&A===t.ResultType.AXIS&&f||!i.owner.getAttribute("fDistance")||a&&(a.force=!0,y=h.createPointsNode({positions:g.clone().toArray(),material:a}),bt(je,y),v=h.createPointsNode({positions:b.clone().toArray(),material:a}),bt(je,v))}n===t.ResultType.AXIS&&(u=(l=e.getPoints()).beginPoint.clone().sub(l.endPoint),p=30,d=w.getDistanceFromPixel(m,l.beginPoint,p),u.normalize().multiplyScalar(d),e.vExtensionPoint1=l.beginPoint.clone().add(u),e.vExtensionPoint2=l.endPoint.clone().sub(u),bt(We,c.createLineNode(e.vExtensionPoint1,e.vExtensionPoint2,Oe.dotDashedLine))),r===t.ResultType.AXIS&&(u=(l=(s=i.owner.getMeasurable(2)).getPoints()).beginPoint.clone().sub(l.endPoint),p=30,d=w.getDistanceFromPixel(m,l.beginPoint,p),u.normalize().multiplyScalar(d),s.vExtensionPoint1=l.beginPoint.clone().add(u),s.vExtensionPoint2=l.endPoint.clone().sub(u),bt(We,c.createLineNode(s.vExtensionPoint1,s.vExtensionPoint2,Oe.dotDashedLine)))}(e,n,r,s),n===t.ResultType.AXIS||n===t.ResultType.PLANE?it||"MeasureBetween"===nt||jt(We,He,e,n,i.owner.getAttribute("vFirstExtensionPoint3D")):n===t.ResultType.CURVE&&e.getType()===u.GeometryType.LINE?"MeasureBetween"!==nt&&jt(We,He,e,t.ResultType.LINE,i.owner.getAttribute("vFirstExtensionPoint3D")):n===t.ResultType.LINE&&r===t.ResultType.LINE&&"Distance"===i.owner.getAttribute("sDistanceType")&&jt(We,Je,p,r,i.owner.getAttribute("vSecondExtensionPoint3D")),r===t.ResultType.AXIS||r===t.ResultType.PLANE?it||"MeasureBetween"===nt||jt(We,Je,p,r,i.owner.getAttribute("vSecondExtensionPoint3D")):r===t.ResultType.CURVE&&p.getType()===u.GeometryType.LINE&&"MeasureBetween"!==nt&&jt(We,Je,p,t.ResultType.LINE,i.owner.getAttribute("vSecondExtensionPoint3D")),tt&&"MeasureBetween"!==nt){var d="MeasureThickness"===nt?Oe.avatarDottedLine:Oe.regularDashedLine,y=(v=i.owner.getAttribute("vFirstExtensionPoint3D"),P=i.owner.getAttribute("vSecondExtensionPoint3D"),f=a.leaderStyle&&a.leaderStyle.color?a.leaderStyle.color:a.lineStyle.color,M=a.fillStyle.color,S=d,D=new b,C=!0,0===i.owner._bCreateMeasureInShowSpace&&(C=!1),v&&(null!==D._nAnchor1SpriteNode&&D.remove(D._nAnchor1SpriteNode),D._nAnchor1SpriteNode=Zt(v,f,M),D._nAnchor1SpriteNode.setVisibility(C),bt(D,D._nAnchor1SpriteNode)),P&&(null!==D._nAnchor2SpriteNode&&D.remove(D._nAnchor2SpriteNode),D._nAnchor2SpriteNode=Zt(P,f,M),D._nAnchor2SpriteNode.setVisibility(C),bt(D,D._nAnchor2SpriteNode)),v&&P&&(void 0===T||!0===T)&&bt(D,c.createLineNode(v,P,S)),D);bt(je,y)}else it||"MeasureBetween"===nt||((l=Zt(i.owner.getAttribute("vFirstExtensionPoint3D"),a.leaderStyle&&a.leaderStyle.color?a.leaderStyle.color:a.lineStyle.color,a.fillStyle.color)).setVisibility(0!==i.owner._bCreateMeasureInShowSpace),bt(je,l));var v,P,f,M,S,T,D,C;if("MeasureThickness"===nt){var _=a.lineStyle.thickness;_=Math.max(2*_+4,10),_/=8;var E=new b,L=new A({ratio:7}),R=c.createCircleNode(_,new g.Vector3(0,0,0),new g.Vector3(0,0,1),Oe.regularSolidLine),N=new A({ratio:7}),x=c.createCircleNode(_,new g.Vector3(0,0,0),new g.Vector3(0,0,1),Oe.regularSolidLine),V=o.computeTransformationBetweenTwoLines(new g.Vector3,new g.Vector3(0,0,1),e.getSelPoint(),e.getSelNormal());L.setMatrix(V.transformation),L.addChild(R),V=o.computeTransformationBetweenTwoLines(new g.Vector3,new g.Vector3(0,0,1),i.owner.getAttribute("vSecondExtensionPoint3D"),e.getSelNormal()),N.setMatrix(V.transformation),N.addChild(x),E.addChild(L),E.addChild(N),bt(We,E)}}}function Ai(e,n,r,o,a){var s,l,u,c,p,d,y;function m(){l&&o&&(o.force=!0,u=h.createPointsNode({positions:l,material:o}),bt(je,u))}switch(n){case t.ResultType.POINT:l=e.getSelPoint().toArray(),m();break;case t.ResultType.CENTER:l=e.getCenter().toArray(),m();break;case t.ResultType.AXIS:Wt(We,He,e,n,Oe.dotDashedLine);break;case t.ResultType.CIRCLE:!function(e,t,n,r){var o,a,s,l,u,c,p,d,b,y=i.owner.getAttribute("iRadiusResultDisplayType");if(Wt(We,He,e,t,Oe.regularSolidLine),i.owner.getAttribute("bArcLengthDisplay"))c=(b=e.getPoints()).beginPoint.clone(),p=b.endPoint.clone(),o={value:5,scale:1},r=yi(n),void 0!==(a=i.owner.getAttribute("sExtremityType"))&&(o=ci(a)),s=n.lineStyle.color,8!==(l=o.value)&&9!==l||(l=5),(u=C.retrieveMaterialFromGAS({size:r,withoutDPR:!0,scale:o.scale,symbol:l,color:new g.Color(s)})).force=!0,bt(je,h.createPointsNode({positions:c.toArray(),material:u})),bt(je,h.createPointsNode({positions:p.toArray(),material:u}));else if(0===y){var m=e.getSelPoint(),v=i.owner.getAttribute("vCenter").clone();d=v.clone();var P=!0;if(!1===i.owner.getAttribute("bRadiusDisplay")){var A=v.clone().sub(m);d=v.clone().add(A),P=!1}m||(m=i.owner.getAttribute("vLeaderPointingPoint3D")),Jt(je,m.clone(),d.clone(),void 0,!1,!1,n,!0,!1,!0,P)}}(e,n,r,a);break;case t.ResultType.CURVE:case t.ResultType.LINE:i.owner.getAttribute("bCumulativeMeasure")?Wt(We,He,e,n,Oe.regularSolidLine):mi(e,n,r,a);break;case t.ResultType.PLANE:Wt(We,He,e,n,Oe.regularSolidLine);break;case t.ResultType.CYLINDER:"Length"===(y=i.owner.getAttribute("sSurfaceDisplayType"))?mi(e,n,r,a):"Area"!==y&&(Wt(We,He,e,n,Oe.regularSolidLine),c=i.owner.getAttribute("vFirstPoint3D"),p=i.owner.getAttribute("vSecondPoint3D"),d=i.owner.getAttribute("vLeaderBreakPoint3D"),void 0===X&&(c=(s=i.owner._buildConstructionPointsForConeCylSphere()).oPos1,p=s.oPos2,d=c.clone()),y&&"Radius"!==y&&"Diameter"!==y&&"MinimumRadius"!==y&&"MinimumDiameter"!==y&&"MaximumRadius"!==y&&"MaximumDiameter"!==y||Jt(je,c,p,d,!1,i.owner.getAttribute("bRadiusDisplay"),r,!0,!1,!0,i.owner.getAttribute("bRadiusDisplay")));break;case t.ResultType.CONE:"Length"===(y=i.owner.getAttribute("sSurfaceDisplayType"))?mi(e,n,r,a):"Area"!==y&&(Wt(We,He,e,n,Oe.regularSolidLine),"MinimumRadius"!==y&&"MinimumDiameter"!==y&&"MaximumRadius"!==y&&"MaximumDiameter"!==y||Jt(je,i.owner.getAttribute("vFirstPoint3D"),i.owner.getAttribute("vSecondPoint3D"),i.owner.getAttribute("vLeaderBreakPoint3D"),!1,i.owner.getAttribute("bRadiusDisplay"),r,!0,!1,!0,i.owner.getAttribute("bRadiusDisplay")));break;case t.ResultType.SPHERE:Wt(We,He,e,n,Oe.regularSolidLine),c=i.owner.getAttribute("vFirstPoint3D"),p=i.owner.getAttribute("vSecondPoint3D"),d=i.owner.getAttribute("vLeaderBreakPoint3D"),void 0===X&&(c=(s=i.owner._buildConstructionPointsForConeCylSphere()).oPos1,p=s.oPos2,d=c.clone()),Jt(We,c,p,d,!1,i.owner.getAttribute("bRadiusDisplay"),r,!0,!1,!0,i.owner.getAttribute("bRadiusDisplay"));break;case t.ResultType.SURFACE:Wt(We,He,e,n,Oe.regularSolidLine);break;case t.ResultType.PRODUCT:var v=i.owner.getPointedReferences();v&&v.length||(He=function(e,t,i){for(var n=new b,r=[],o=Number.MAX_VALUE,a=0;a<3;a++)r[a]=e[a+3]-e[a],o=Math.min(o,r[a]);o/=10;var s=[];s[0]=new g.Vector3(o,0,0),s[1]=new g.Vector3(0,o,0),s[2]=new g.Vector3(0,0,o);var l=[],u=[],c=new g.Vector3(e[0],e[1],e[2]);for(l[0]=0;l[0]<2;l[0]++)for(l[1]=0;l[1]<2;l[1]++)for(l[2]=0;l[2]<2;l[2]++){var p=4*l[0]+2*l[1]+l[2];u[p]=[],u[p][0]=new g.Vector3(l[0]*r[0],l[1]*r[1],l[2]*r[2]).add(c);for(var d=0;d<3;d++)u[p][d+1]=s[d].clone().multiplyScalar(1-2*l[d]).add(u[p][0]);var y=[u[p][1],u[p][0],u[p][2],u[p][0],u[p][3]],m=h.createLineNode({points:y,material:t});m.setShadow(!1),bt(n,m)}var v=[u[0][0],u[4][0],u[6][0],u[2][0],u[0][0],u[1][0],u[5][0],u[4][0],u[5][0],u[7][0],u[6][0],u[7][0],u[3][0],u[2][0],u[3][0],u[1][0]],P=h.createLineNode({points:v,material:i});return P.setShadow(!1),bt(n,P),n}(i.owner.getAttribute("aabb"),Oe.bBoxSolidLine,Oe.regularDashedLine),bt(We,He))}}function fi(e,n,r,o){We.removeChildren(),je.removeChildren();var a,s={value:0,scale:1},l=o.lineStyle.color,u=yi(o),p=i.owner.getAttribute("sPointType");if(void 0!==p&&(s=ci(p)),0===s.value)a=null;else{var d=s.value;8!==d&&9!==d||(d=5),a=C.retrieveMaterialFromGAS({size:u,scale:s.scale,withoutDPR:!0,symbol:d,color:new g.Color(l)})}"MeasureBetween"===nt||"MeasureThickness"===nt?Pi(e,n,r,o,a):"MeasureItem"===nt?Ai(e,n,o,a,u):"Measure3PointsCircle"===nt?function(e,n,r){var o=i.owner.getMeasurable(2),a=i.owner.getMeasurable(3),s=c.createCircleNode(i.owner.getAttribute("fRadius"),i.owner.getAttribute("vCenter"),i.owner.getAttribute("vNormal"),Oe.regularSolidLine);if(bt(We,s),n&&(n.force=!0,bt(je,h.createPointsNode({positions:e.getSelPoint().clone().toArray(),material:n})),bt(je,h.createPointsNode({positions:o.getSelPoint().clone().toArray(),material:n})),bt(je,h.createPointsNode({positions:a.getSelPoint().clone().toArray(),material:n}))),i.owner.getAttribute("iRadiusResultDisplayType")===t.RadiusResultDisplayType.CENTER){var l=i.owner.getAttribute("vCenter").clone();!1===i.owner.getAttribute("bRadiusDisplay")&&(l=i.owner.getAttribute("vSecondExtensionPoint3D").clone()),Jt(je,i.owner.getAttribute("vFirstExtensionPoint3D").clone(),l.clone(),void 0,!1,!1,r,!0,!1,!0,i.owner.getAttribute("bRadiusDisplay"))}}(e,a,o):"Measure3PointsAngle"===nt&&function(e,t){var n=i.owner.getMeasurable(2),r=i.owner.getMeasurable(3);bt(We,c.createLineNode(e.getSelPoint(),n.getSelPoint(),Oe.regularSolidLine)),bt(We,c.createLineNode(r.getSelPoint(),n.getSelPoint(),Oe.regularSolidLine)),t&&(t.force=!0,bt(je,h.createPointsNode({positions:e.getSelPoint().clone().toArray(),material:t})),bt(je,h.createPointsNode({positions:n.getSelPoint().clone().toArray(),material:t})),bt(je,h.createPointsNode({positions:r.getSelPoint().clone().toArray(),material:t})))}(e,a)}function wi(e){var t=!1;switch(e){case"AnchorAndAvatar":t=!(ie&&ne&&re&&he&&De&&se&&ce&&Te&&Me&&Se&&be);break;case"DimensionGroup":t=!(ie&&ne&&ae&&re&&se&&le&&ue&&ce&&be&&pe&&de&&ge&&he&&ye&&me&&ve&&Pe&&Ae&&fe&&we&&Te);break;case"LableContent":t=!(ie&&te&&Ce&&se&&ye&&ne&&re&&oe&&_e&&Ee&&Le&&Re&&Ne&&Ve&&Ie&&he&&ke);break;case"Leader":t=!(ie&&oe&&de&&ge&&ne&&he&&Te)}return t}this.getPixelFontSize=function(e){var t;return i.owner.getAttribute("iFontSize")&&(t=w.convertPixelToModel({sizeInPixels:i.owner.getAttribute("iFontSize")*(4/3),viewer:m})),t||(t=i.owner.getAttribute(e)),w.convertModelToPixels({sizeInMM:t,viewer:m})},this.getTooltip=function(){var t=[];if(!i.owner.getAttribute("sTextGraphicRepresentationID")&&!i.owner.getAttribute("sTextGraphicRepresentation")&&Ge)return Ge.length&&Ge.length>50&&($e=!0),t.push(Ge),ze&&(t.push("\n"+ze),!$e&&ze.length&&ze.length>50&&($e=!0)),function(t){var i;if(ht()){if(t&&t.length){i=e.createElement("div");for(var n=0;n<t.length;n++)e.createElement("p",{styles:{margin:"2px",padding:0}}).inject(i).setText(t[n])}return i}}(t)},this.processPathForTrimedText=function(e){var t=e;if(i.owner.getAttribute("bShortDisplay")||!Ge||i.owner.getAttribute("sTextGraphicRepresentationID")||i.owner.getAttribute("sTextGraphicRepresentation")||i.owner.getAttribute("stextGraphicRepresentationAngle"))return t;if(Ge.length&&Ge.length>50||ze&&ze.length&&ze.length>50){var n=t.pathElement.hash();n+="000/",t.pathElement._hash=n}return t},this.getBoxPosition=function(){var e=qe.getDimensions();return{top:-e.offsetHeight/2,left:-e.offsetWidth/2}},this.update=function(e,n){if(null!==ut&&-1!==i.owner.getAttribute("sSelectedType1")){X=i.owner.getAttribute("iExtensionLinesManipulable"),Fe(),Kt()&&(i.owner.avoidShiftKeyEvent=!0);var r=p.readPreferences({name:"cke",PreferenceNames:["TrailingZeros"]});Z="true"===r.preferences[0].value,nt=i.owner.getAttribute("sType"),n&&(rt=void 0);var a=i.owner.getMeasurable(1);if(a){var s=i.owner.getMeasurable(2),l=Tt(),c=i.owner.getAttribute("sResultingType1"),d=i.owner.getAttribute("sResultingType2"),g=i.owner.getAttribute("bCumulativeMeasure");at||(at=!1),Q=ui("UnitLength","string"),K=ui("UnitAngle","string"),$=ui("UnitArea","string"),ee=ui("UnitVolume","string"),te=Q&&K&&$&&ee,(ie=void 0!==rt&&rt===nt)||(rt=nt),ne=ui("LineStyleColor","Color")&&ui("LeaderStyleColor","Color"),re=ui("FillStyleColor","Color"),oe=ui("LineStyleThicknessIndex","float")&&ui("LineStyleThickness","float"),ae=ui("LeaderStyleThicknessIndex","float")&&ui("LeaderStyleThickness","float"),se=ui("Distance","float"),le=ui("FirstPoint3D","Vector3"),ue=ui("SecondPoint3D","Vector3"),ce=ui("FirstExtensionPoint3D","Vector3"),pe=ui("SecondExtensionPoint3D","Vector3"),de=ui("LeaderBreakPoint3D","Vector3"),ge=ui("LeaderPointingPoint3D","Vector3"),he=ui("RadiusDisplay","bool"),be=ui("ArcLengthDisplay","bool"),ye=ui("Angle","float"),me=ui("AngleBreakPoint","Vector3"),ve=ui("Quadrant","float"),Pe=ui("AngleArcCenter","Vector3"),Ae=ui("AnglePointingPoint","Vector3"),fe=ui("AngleVector1","Vector3"),we=ui("AngleVector2","Vector3"),Me=ui("PointType","string"),Se=ui("ExtremityType","string"),Te=!0,("MeasureItem"===nt&&i.owner.getAttribute("sResultingType1")===t.ResultType.CIRCLE||"Measure3PointsCircle"===nt)&&(Te=ui("RadiusResultDisplayType","int")),oe&&ae||(Me=!1,Se=!1),De=ui("aabb","AABB"),Ce=ui("ShortDisplay","bool"),_e=ui("IsFilled","bool"),Ee=ui("HasBorder","bool"),Le=ui("HasALeader","bool"),Re=ui("FontColor","Color"),Ne=ui("FontName","string"),(void 0!==(xe=lt.getPixelFontSize("fFontSize"))||void 0!==ut.FontSize&&xe===ut.FontSize)&&(ut.FontSize=xe),Ve=ui("FontSize","float"),Ie=ui("Opacity","float"),ke=at===i.owner.isInEdition(),at||(re=!1,ne=!1),at=i.owner.isInEdition(),function(e){if(!ie){var n,r=i.owner.getAttribute("sSurfaceDisplayType");"MeasureItem"===nt?e!==t.ResultType.CONE||"Angle"!==r&&"HalfAngle"!==r||(n=i.owner.getAttribute("fSemiAngle")):n=i.owner.getAttribute("fAngle"),it=void 0!==n&&!o.isZero(n);var a=i.owner.getAttribute("fDistance");tt="MeasureItem"===nt&&e!==t.ResultType.CONE||"MeasureItem"===nt&&!it&&e===t.ResultType.CONE||"Measure3PointsCircle"===nt||"MeasureThickness"===nt||void 0!==a&&!(o.isZero(a)&&it),"MeasureBetween"===nt&&void 0!==i.owner.getAttribute("sDistanceType")&&("Angle"===i.owner.getAttribute("sDistanceType")&&it?tt=!1:(it=!1,tt=!0))}}(c),li(!!e||!ie),function(e){if(!ne||!re){var t=e.lineStyle.color;Oe.regularSolidLine.color=!0===i.owner._bPrevisualized&&"MeasureThickness"===nt?G:e.leaderStyle&&e.leaderStyle.color?e.leaderStyle.color:t,Oe.regularDashedLine.color=e.leaderStyle&&e.leaderStyle.color?e.leaderStyle.color:t,Oe.bBoxSolidLine.color=Oe.regularDashedLine.color,Oe.avatarSolidLine.color=e.fillStyle.color,Oe.avatarDashedLine.color=e.fillStyle.color,Oe.avatarDottedLine.color=!0===i.owner._bPrevisualized&&"MeasureThickness"===nt?G:t,Oe.dotDashedLine.color=t,Oe.dotLine.color=t,Oe.crossPoint.color=t}if(!oe||!ae){var n=e.leaderStyle&&e.leaderStyle.thickness?e.leaderStyle.thickness:e.lineStyle.thickness;Oe.regularSolidLine.setLineWidth(n)}}(l),wi("DimensionGroup")&&vi(a,c,d,l);var h,b,y=!0,m=i.owner.getAttribute("sDistanceType"),v=a?a.getType():void 0,P=s?s.getType():void 0,A=i.owner.getAttribute("sSelectedType1"),f=i.owner.getAttribute("sSelectedType2"),w=!1;(A===t.ViewedType.INFPLANE&&f===t.ViewedType.INFPLANE||A===t.ViewedType.POINT&&f===t.ViewedType.INFPLANE||A===t.ViewedType.INFPLANE&&f===t.ViewedType.POINT||A===t.ViewedType.INFPLANE&&f===t.ViewedType.CURVE&&P===u.GeometryType.LINE||A===t.ViewedType.CURVE&&v===u.GeometryType.LINE&&f===t.ViewedType.INFPLANE)&&(w=!0),"MeasureBetween"!==nt||!w||"Distance"!==m&&"MinimumDistance"!==m&&"MaximumDistance"!==m||(y=!1),y&&wi("AnchorAndAvatar")&&fi(a,c,d,l),y||(We.removeChildren(),je.removeChildren(),Ke.removeChildren()),g&&(Ye.removeChildren(),Qe.removeChildren(),Xe.removeChildren(),We.removeChildren(),je.removeChildren()),wi("LableContent")&&(de=!1,function(e,n){qe.setVisibility(tt),0===i.owner._bCreateMeasureInShowSpace?tt?qe.setVisibility(!tt):(qe.setVisibility(tt),qe.setVisibilityFree(!tt)):1===i.owner._bCreateMeasureInShowSpace&&(qe.setVisibility(tt),qe.setVisibilityFree(!tt)),!tt&&it&&ke||(ei(),qe.modify({content:Gt(i.owner.getAttribute("bShortDisplay"),nt,i.owner.getAttribute("fDistance"),i.owner.getAttribute("sMeasureOnGeometryType"),i.owner.getAttribute("sDistanceType")),commentContent:i.owner.getAttribute("sCommentOnMeasure"),position:i.owner.getAttribute("vLeaderBreakPoint3D"),isFilled:i.owner.getAttribute("bIsFilled"),hasBorder:i.owner.getAttribute("bHasBorder"),graphicProperties:n,inEdition:i.owner.isInEdition(),boxRotationAngle:i.owner.getAttribute("fBoxRotationAngle"),tessRep:i.owner.getAttribute("sTextGraphicRepresentationID")?i.owner.getTesselatedRep(i.owner.getAttribute("sTextGraphicRepresentationID")):i.owner.getAttribute("sTextGraphicRepresentation")}),$t()),Ze.setVisibility(it),0===i.owner._bCreateMeasureInShowSpace?(it?Ze.setVisibility(!it):Ze.setVisibility(it),Ze.setVisibilityFree(!it)):1===i.owner._bCreateMeasureInShowSpace&&(Ze.setVisibility(it),Ze.setVisibilityFree(!it)),it&&(ei(),Ze.modify({content:zt(i.owner.getAttribute("bShortDisplay"),nt,"MeasureItem"===nt&&e===t.ResultType.CONE?i.owner.getAttribute("fSemiAngle"):i.owner.getAttribute("fAngle"),!tt,i.owner.getAttribute("sMeasureOnGeometryType")),position:i.owner.getAttribute("vAngleBreakPoint"),isFilled:i.owner.getAttribute("bIsFilled"),hasBorder:i.owner.getAttribute("bHasBorder"),graphicProperties:n,boxRotationAngle:i.owner.getAttribute("fBoxRotationAngle"),tessRep:i.owner.getAttribute("stextGraphicRepresentationAngle")}),$t())}(c,l)),ie&&de||!tt&&it||(ei(),qe.modify({position:i.owner.getAttribute("vLeaderBreakPoint3D")}),$t()),ie&&me||it&&(ei(),Ze.modify({position:i.owner.getAttribute("vAngleBreakPoint")}),$t()),wi("Leader")&&pi(),h=!i.owner.getAttribute("bCollapsedDisplay"),b=1===i.owner._bCreateMeasureInShowSpace?h:!h,We.setVisibility(b),Ye.setVisibility(b),Qe.setVisibility(b),Ke.setVisibility(b),qe&&qe.isVisible()&&!h&&qe.setVisibility(h),Ze&&Ze.isVisible()&&!h&&Ze.setVisibility(h),qe&&1===i.owner._bCreateMeasureInShowSpace&&qe.setVisibilityFree(!qe.isVisible()),Ze&&1===i.owner._bCreateMeasureInShowSpace&&Ze.setVisibilityFree(!Ze.isVisible()),lt.setName(i.owner.getAttribute("sName")),lt._updateVisibility()}}},this.updateRepresentation=function(e){if(Kt()){var t=e.position.clone(),n=i.owner.getAttribute("vSecondExtensionPoint3D").clone().sub(i.owner.getAttribute("vFirstExtensionPoint3D")),r=n.lengthSq();if(r>1e-6){var o=t;if(0===X||!0===e._bisCenterPrefRequired){var a=(new g.Plane).setFromCoplanarPoints(i.owner.getAttribute("vFirstExtensionPoint3D").clone(),i.owner.getAttribute("vFirstPoint3D").clone(),i.owner.getAttribute("vSecondPoint3D").clone());o=void 0;if(e.snappedPosition2D){o=(e.ray?e.ray:m.currentViewpoint.create3DRayFrom2DPoint(e.snappedPosition2D)).intersectPlane(a)||void 0}if(!o){let e;e=E.getSightDirfor3DPoint(m,t.clone());var s=N.computeLinePlaneDistance(t.clone().toArray(),e.toArray(),i.owner.getAttribute("vFirstPoint3D").clone().toArray(),a.normal.toArray());o=s&&0===s.returnCode&&s.relationship===u.Relationship.INTERSECTING?new g.Vector3(s.aPosition[0],s.aPosition[1],s.aPosition[2]):a.projectPoint(t)}}var l=n.dot(i.owner.getAttribute("vFirstExtensionPoint3D").clone().sub(o))/r,c=n.multiplyScalar(-l).add(i.owner.getAttribute("vFirstExtensionPoint3D")),p=o.clone().sub(c);let P="true"===wt.preferences[0].value;O()&&(P=!P),i.owner.setAttribute("vFirstPoint3D",i.owner.getAttribute("vFirstExtensionPoint3D").clone().add(p)),i.owner.setAttribute("vSecondPoint3D",i.owner.getAttribute("vSecondExtensionPoint3D").clone().add(p));var d=i.owner.getAttribute("vLeaderPointingPoint3D").clone().sub(i.owner.getAttribute("vLeaderBreakPoint3D")),h=i.owner.getAttribute("vFirstPoint3D").clone().add(i.owner.getAttribute("vSecondPoint3D")).multiplyScalar(.5);i.owner.setAttribute("vLeaderPointingPoint3D",h);var b=i.owner.getAttribute("vSecondPoint3D").clone().sub(i.owner.getAttribute("vFirstPoint3D")).length(),y=o.clone().sub(i.owner.getAttribute("vFirstPoint3D")).length(),v=o.clone().sub(i.owner.getAttribute("vSecondPoint3D")).length();e._bisCenterPrefRequired?i.owner.setAttribute("vLeaderBreakPoint3D",i.owner.getAttribute("vLeaderPointingPoint3D").clone().sub(d)):P?v>b||y>b?i.owner.setAttribute("vLeaderBreakPoint3D",o):i.owner.setAttribute("vLeaderBreakPoint3D",h):i.owner.setAttribute("vLeaderBreakPoint3D",o)}}else!function(e){if(Yt()){var t=e.position.clone(),n=i.owner.getAttribute("vSecondExtensionPoint3D").clone().sub(i.owner.getAttribute("vFirstExtensionPoint3D")),r=n.lengthSq();if(r>1e-6){var o=t;if(0===X){var a=(new g.Plane).setFromCoplanarPoints(i.owner.getAttribute("vFirstExtensionPoint3D").clone(),i.owner.getAttribute("vFirstPoint3D").clone(),i.owner.getAttribute("vSecondPoint3D").clone()),s=w.getViewpointInfo(m.currentViewpoint),l=N.computeLinePlaneDistance(o.clone().toArray(),s.sight.toArray(),i.owner.getAttribute("vFirstPoint3D").clone().toArray(),a.normal.toArray());o=l&&0===l.returnCode&&l.relationship===u.Relationship.INTERSECTING?new g.Vector3(l.aPosition[0],l.aPosition[1],l.aPosition[2]):a.projectPoint(t)}var c=n.dot(i.owner.getAttribute("vFirstExtensionPoint3D").clone().sub(o))/r,p=n.multiplyScalar(-c).add(i.owner.getAttribute("vFirstExtensionPoint3D")),d=o.clone().sub(p);i.owner.setAttribute("vFirstPoint3D",i.owner.getAttribute("vFirstExtensionPoint3D").clone().add(d)),i.owner.setAttribute("vSecondPoint3D",i.owner.getAttribute("vSecondExtensionPoint3D").clone().add(d)),i.owner.setAttribute("vLeaderBreakPoint3D",o);var h=i.owner.getAttribute("vFirstPoint3D").clone().add(i.owner.getAttribute("vSecondPoint3D")).multiplyScalar(.5);i.owner.setAttribute("vLeaderPointingPoint3D",h)}}else if(i.owner.setAttribute("vLeaderBreakPoint3D",e.position),"MeasureItem"===nt&&i.owner._isInCreationState&&e.leaderPoints&&e.leaderPoints.length>0&&e.pathElements&&e.pathElements.length>0){var b=e.pathElements[0],y=!1,v=i.owner._cumulativeMeasurables&&i.owner._cumulativeMeasurables.length>0?i.owner._cumulativeMeasurables:[];0===v.length&&v.push(i.owner.getMeasurable(1));for(var P=0;P<v.length;P++){var A=v[P]._pathElement;if(A.isEqual(b))y=!0;else if(0===A.internalPath.length&&A.externalPath.length<b.externalPath.length){y=!0;for(var f=0;f<A.externalPath.length;f++)if(A.externalPath[f]!==b.externalPath[f]){y=!1;break}}if(y)break}y&&i.owner.setAttribute("vLeaderPointingPoint3D",e.leaderPoints[0])}}(e);i.owner.setAttribute("fBoxRotationAngle",e.rotationAngle),ti(),i.owner.fireEvent("onDMUObjectVisuRefreshRequired",{dmuObject:i.owner})},this.getLabelParams=function(){var e={},t=it&&!tt?Ze.getDimensions():qe.getDimensions();if(e.position=it&&!tt?i.owner.getAttribute("vAngleBreakPoint"):i.owner.getAttribute("vLeaderBreakPoint3D"),e.rotationAngle=i.owner.getAttribute("fBoxRotationAngle")?i.owner.getAttribute("fBoxRotationAngle"):0,e.width=t.width,e.height=t.height,void 0!==i.owner.getAttribute("sLeaderEndType")){var n=[];n[0]=i.owner.getAttribute("vLeaderPointingPoint3D"),e.leaderPoints=n}return e},this.hasTessellatedRepresentation=function(){return i.owner.getAttribute("stextGraphicRepresentationAngle")&&i.owner.getAttribute("stextGraphicRepresentationAngle").length||i.owner.getAttribute("sTextGraphicRepresentationID")||i.owner.getAttribute("sTextGraphicRepresentation")&&i.owner.getAttribute("sTextGraphicRepresentation").length},this.getRepNode=function(){return{avatar:We,anchor:je,dimensionArrow:Ye,dimensionExtension:Qe,leader:Ke,box:it&&!tt?Ze.getLabelNode():qe.getLabelNode()}},this.getLabelDimensions=function(){var e=it&&!tt?Ze.getDimensions():qe.getDimensions();return e.position=it&&!tt?i.owner.getAttribute("vAngleBreakPoint"):i.owner.getAttribute("vLeaderBreakPoint3D"),e},this.onViewerEventCB=function(e){"beginExplodeCmd"!==e.eventType&&"endExplodeCmd"!==e.eventType&&"onPreferenceModified"!==e.eventType||lt.update(null,!0),"MeasureThickness"===nt&&"@onViewpointChange"===e.eventType&&ut.LeaderStyleThickness?(ut.bSameFirstPoint3D=-1,lt.update()):(Yt()||it||"Arrow"===i.owner.getAttribute("sLeaderEndType"))&&"@onWindowResized"===e.eventType&&i.owner.getParent()&&i.owner.getParent().getType&&"DMUTemporaryBag"===i.owner.getParent().getType()&&(it||(ut.LeaderBreakPoint3D=-1),lt.update(!1,it))};var Mi=this.removeDMUNode3DOverload;this.removeDMUNode3DOverload=function(){Mi(),lt=Oe=ut=He=Je=qe=Ze=We=null,je=Ye=Qe=Xe=Ke=m=null},this._updateVisibility=function(e,t){var n=i.owner.isMeasureDisplayed();if(0===i.owner.getAttribute("bCreateMeasureInShowSpace"))n=!!i.owner.getAttribute("bCollapsedDisplay")||!n;else if(n){n=!i.owner.getAttribute("bCollapsedDisplay")}void 0!==e&&(pt=e),n=n&&pt>0,lt.setVisibility(n);let r=t&&pt<1;We&&We.setVisibility(!r&&n),je&&je.setVisibility(!r&&n),Ye&&Ye.setVisibility(!r&&n),Qe&&Qe.setVisibility(!r&&n),Ke&&Ke.setVisibility(!r&&n),tt&&qe&&qe.setVisibility(n),it&&Ze&&Ze.setVisibility(n),(0===m.getVisibleSpace()&&!n||1===m.getVisibleSpace()&&n)&&pt>0&&pi(),n&&pt>0&&(qe&&qe.setOpacity(pt),Ze&&Ze.setOpacity(pt)),m.render()},qe=new f({window:i.frmWindow,content:[""],position:i.owner.getAttribute("vLeaderBreakPoint3D"),isFilled:i.owner.getAttribute("bIsFilled"),hasBorder:i.owner.getAttribute("bHasBorder"),graphicProperties:Tt()}),lt.linkManipulatorToNode(qe.getBackNode()),bt(this,qe),bt(this,Ze=new f({window:i.frmWindow,content:[""],position:i.owner.getAttribute("vLeaderBreakPoint3D"),isFilled:i.owner.getAttribute("bIsFilled"),hasBorder:i.owner.getAttribute("bHasBorder"),graphicProperties:Tt()})),bt(this,We=new b),bt(this,je=new b),bt(this,Ye=new b),bt(this,Qe=new b),bt(this,Xe=new b),bt(this,Ke=new b),this.updateNonManipulableNodePickability=function(e){let t=e?L.PICKABLE:L.PICKTHROUGH;var n=t;i.owner.getAttribute("bCumulativeMeasure")&&(n=L.PICKABLE),Ke.setPickable(n),je.setPickable(t),We.setPickable(t),Qe.setPickable(t)},this.update(!0),this.cleanAngleCache=function(){lt.bExtendAngleArc=!1}}})})),define("DS/DMUPlayMeasure/DMUMeasure",["DS/DMUBaseExperience/DMUOverloadableObject","DS/DMUMeasurable/DMUMeasureEnums","DS/DMUMeasurable/DMUMeasurable","DS/DMUMeasurable/DMUToolsMeasure","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUMeasurable/DMUToolsMaths","DS/DMUMeasurable/DMUGeometryEnums","DS/DMUBaseExperience/EXPToolsVisualization","DS/CoreEvents/ModelEvents","DS/Visualization/ThreeJS_DS","DS/DMUBaseExperience/DMUContextManager","DS/DMUMeasurable/DMUToolsInterference","DS/DMUBaseUIControllers/DMUMarkupsController","DS/DMUPlayMeasure/DMUMeasureNode3D","DS/DMUPlayMeasure/DMUMeasureImport","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/PADUtils/PADSettingsMgt","DS/DMUBaseExperience/EXPUtils","DS/DMUMeasurable/DMUMathsInfiniteGeometry","DS/DMUBaseUIServices/DMUObjectsServices"],(function(e,t,i,n,r,o,a,s,l,u,c,p,d,g,h,b,y,m,v,P,A){"use strict";var f=[{name:"sType",type:"string",JSONname:"Specifications.Type"},{name:"sSelectedType1",type:"int",JSONname:"Specifications.SelectedType1",defaultValue:-1},{name:"sSelectedType2",type:"int",JSONname:"Specifications.SelectedType2"},{name:"sResultingType1",type:"int",JSONname:"Results.ResultingType1",defaultValue:-1},{name:"sResultingType2",type:"int",JSONname:"Results.ResultingType2"},{name:"oProduct1Name",type:"string",JSONname:"Results.Product1Name"},{name:"oProduct2Name",type:"string",JSONname:"Results.Product2Name"},{name:"fDistance",type:"float",JSONname:"Results.Distance"},{name:"fAngle",type:"float",JSONname:"Results.Angle"},{name:"bComplementaryAngle",type:"bool",JSONname:"Results.ComplementaryAngle"},{name:"lbExtensionRequired",type:"listObject",JSONname:"Results.ExtensionRequired"},{name:"lFirstExtensionPoints",type:"ListVector3",JSONname:"Results.FirstExtensionPoints"},{name:"lSecondExtensionPoints",type:"ListVector3",JSONname:"Results.SecondExtensionPoints"},{name:"fProjectedAngleXY",type:"float",JSONname:"Results.ProjectedAngleXY"},{name:"fProjectedAngleYZ",type:"float",JSONname:"Results.ProjectedAngleYZ"},{name:"fProjectedAngleZX",type:"float",JSONname:"Results.ProjectedAngleZX"},{name:"vPosition",type:"Vector3",JSONname:"Results.Position"},{name:"vCenter",type:"Vector3",JSONname:"Results.Center"},{name:"vNormal",type:"Vector3",JSONname:"Results.Normal"},{name:"vCog",type:"Vector3",JSONname:"Results.Cog"},{name:"fLength",type:"float",JSONname:"Results.Length"},{name:"fRadius",type:"float",JSONname:"Results.Radius"},{name:"fArea",type:"float",JSONname:"Results.Area"},{name:"vApex",type:"Vector3",JSONname:"Results.Apex"},{name:"fSemiAngle",type:"float",JSONname:"Results.SemiAngle"},{name:"fVolume",type:"float",JSONname:"Results.Volume"},{name:"bHasALeader",type:"bool",JSONname:"Properties3DText.HasALeader",defaultValue:!0},{name:"vLeaderBreakPoint3D",type:"Vector3",JSONname:"Properties3DText.LeaderBreakPoint3D",defaultValue:new u.Vector3},{name:"vLeaderPointingPoint3D",type:"Vector3",JSONname:"Properties3DText.LeaderPointingPoint3D",defaultValue:new u.Vector3},{name:"fBoxRotationAngle",type:"float",JSONname:"Properties3DText.BoxRotationAngle"},{name:"bShortDisplay",type:"bool",JSONname:"PropertiesMeasure.Shortdisplay",defaultValue:!0},{name:"vFirstPoint3D",type:"Vector3",JSONname:"PropertiesMeasure.FirstPoint3D"},{name:"vSecondPoint3D",type:"Vector3",JSONname:"PropertiesMeasure.SecondPoint3D"},{name:"vFirstExtensionPoint3D",type:"Vector3",JSONname:"PropertiesMeasure.FirstExtensionPoint3D"},{name:"vSecondExtensionPoint3D",type:"Vector3",JSONname:"PropertiesMeasure.SecondExtensionPoint3D"},{name:"vExtensionDirection3D",type:"Vector3",JSONname:"PropertiesMeasure.ExtensionDirection3D"},{name:"bRadiusDisplay",type:"bool",JSONname:"PropertiesMeasure.Radiusdisplay",defaultValue:!1},{name:"bCollapsedDisplay",type:"bool",JSONname:"PropertiesMeasure.Collapseddisplay",defaultValue:!1},{name:"vAngleBreakPoint",type:"Vector3",JSONname:"PropertiesMeasure.AngleBreakPoint"},{name:"fQuadrant",type:"float",JSONname:"PropertiesMeasure.Quadrant"},{name:"vAngleArcCenter",type:"Vector3",JSONname:"PropertiesMeasure.AngleArcCenter"},{name:"vAnglePointingPoint",type:"Vector3",JSONname:"PropertiesMeasure.AnglePointingPoint"},{name:"vAngleVector1",type:"Vector3",JSONname:"PropertiesMeasure.AngleVector1"},{name:"vAngleVector2",type:"Vector3",JSONname:"PropertiesMeasure.AngleVector2"},{name:"aabb",type:"AABB",JSONname:"PropertiesMeasure.aabb"},{name:"bVisible",type:"bool",JSONname:"PropertiesMarkerBase.Visible",defaultValue:!0},{name:"bIsFilled",type:"bool",JSONname:"PropertiesMarkerBase.IsFilled",defaultValue:!0},{name:"bHasBorder",type:"bool",JSONname:"PropertiesMarkerBase.HasBorder",defaultValue:!1},{name:"fFontSize",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.fontSize",defaultValue:3.5},{name:"sFontName",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.familyName",defaultValue:"sans-serif"},{name:"sFontStyle",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.familyStyle",defaultValue:"normal"},{name:"cFontColor",type:"Color",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.color",defaultValue:new u.Color("#ffffff")},{name:"cFillStyleColor",type:"Color",JSONname:"PropertiesMarkerBase.GraphicProperties.FillStyle.color",defaultValue:new u.Color("#368ec4")},{name:"fOpacity",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.FillStyle.opacity",defaultValue:1},{name:"fLineStyleThickness",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.LineStyle.thickness",defaultValue:1},{name:"fLineStyleThicknessIndex",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.LineStyle.thicknessIndex"},{name:"sLineStylePattern",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.LineStyle.pattern",defaultValue:"1"},{name:"cLineStyleColor",type:"Color",JSONname:"PropertiesMarkerBase.GraphicProperties.LineStyle.color",defaultValue:new u.Color("#3d3d3d")},{name:"sLeaderStylePattern",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.pattern"},{name:"fLeaderStyleThicknessIndex",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.thicknessIndex"},{name:"cLeaderStyleColor",type:"Color",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.color"},{name:"cAvatarStyleColor",type:"Color",JSONname:"PropertiesMarkerBase.GraphicProperties.AvatarStylecolor"},{name:"sCommentOnMeasure",type:"string",JSONname:"Comment.TextContents"},{name:"sCommentFontStyle",type:"string",JSONname:"Comment.GraphicProperties.FontStyle.familyStyle"},{name:"sCommentFontName",type:"string",JSONname:"Comment.GraphicProperties.FontStyle.familyName"},{name:"fCommentFontSize",type:"float",JSONname:"Comment.GraphicProperties.FontStyle.fontSize"},{name:"iRadiusResultDisplayType",type:"int",JSONname:"PropertiesMeasure.iRadiusResultDisplayType",defaultValue:0},{name:"vArcMidPoint",type:"Vector3",JSONname:"PropertiesMeasure.vArcMidPoint"},{name:"iExtensionLinesManipulable",type:"int",JSONname:"PropertiesMeasure.iExtensionLinesManipulable"},{name:"sLeaderEndType",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.sLeaderEndType"},{name:"sPointType",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.sPointType"},{name:"sExtremityType",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.sExtremityType"},{name:"sTextGraphicRepresentation",type:"string",JSONname:"Properties3DText.textGraphicRepresentation"},{name:"sTextGraphicRepresentationID",type:"string",JSONname:"Properties3DText.textGraphicRepresentationID"},{name:"stextGraphicRepresentationAngle",type:"string",JSONname:"Properties3DText.textGraphicRepresentationAngle"},{name:"sMeasureOnGeometryType",type:"string",JSONname:"Specifications.MeasureOnGeometryType"},{name:"sDistanceType",type:"string",JSONname:"Results.DistanceType"},{name:"bArcLengthDisplay",type:"bool",JSONname:"PropertiesMeasure.ArcLengthDisplay",defaultValue:!1},{name:"bDisplayMeasureType",type:"bool",JSONname:"PropertiesMeasure.DisplayMeasureType",defaultValue:!0},{name:"bDisplayUnit",type:"bool",JSONname:"PropertiesMeasure.DisplayUnit",defaultValue:!0},{name:"sSurfaceDisplayType",type:"string",JSONname:"Results.SurfaceDisplayType"},{name:"sProductDisplayType",type:"string",JSONname:"Results.ProductDisplayType"},{name:"fHeight",type:"float",JSONname:"Results.Height"},{name:"fMaxRadius",type:"float",JSONname:"Results.MaxRadius"},{name:"lCustomization",type:"listObject",JSONname:"Results.Customization",defaultValue:[]},{name:"sComputationMode",type:"string",JSONname:"Results.ComputationMode"},{name:"bDisplayApproximateSymbol",type:"bool",JSONname:"PropertiesMeasure.DisplayApproximateSymbol",defaultValue:!1},{name:"lSelectedProducts",type:"listStrings",JSONname:"PropertiesMeasure.selectedProducts"},{name:"bCumulativeMeasure",type:"bool",JSONname:"Specifications.CumulativeMeasure"},{name:"fLeaderStyleThickness",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.thickness"},{name:"iFontSize",type:"int",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.height"},{name:"LeaderEndType",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.LeaderEndType"}];return e.extend({init:function(e,i,n){this._parent(e,i),this._frmWindow&&(this._executionContext=this._frmWindow.getExecutionContext?this._frmWindow.getExecutionContext():this._frmWindow.getContextualUIManager&&this._frmWindow.getContextualUIManager()?this._frmWindow.getContextualUIManager()._executionContext:void 0),this.addParameters(f),this._type="DMUMeasure",this._typeApps=n;var s="DS/DMUMeasure/DMUMeasureContextualBar",l=this;let u=i;this._bCreateMeasureInShowSpace=this._viewer.getVisibleSpace(),this._isInCreationState=!1,this._cumulativeMeasurables=[],this.initAuthoringData=function(){if(-1!==c.getAuthoringFeatureTypes().indexOf("Measure")&&(-1===c.getAuthoringFeatureTypes().indexOf("Measure")||l.getContextualCommandList||require([s],(function(e){var t=new e;l.getContextualCommandList=t.getContextualCommandList,l.getSharedContextualCommandList=t.getSharedContextualCommandList,l.getSharedHeaderTypes=t.getSharedHeaderTypes,l.getCmdHdrsFor2DGeometries=t.getCmdHdrsFor2DGeometries,l.getSharedContextualMenuCommandList=t.getSharedContextualMenuCommandList,t.applyStateToContextHdr&&(l.applyStateToContextHdr=t.applyStateToContextHdr),t.getPointTypeHdr&&(l.getPointTypeHdr=t.getPointTypeHdr),t.getExtremityTypeHdr&&(l.getExtremityTypeHdr=t.getExtremityTypeHdr),t.setCheckCmdHdrState&&(l.setCheckCmdHdrState=t.setCheckCmdHdrState),t.register({frmWindow:l._frmWindow});var i=1===b.get().length?b.get()[0].pathElement.clone():null;i&&i.getLastElement(!0).getDMUType&&i.getLastElement(!0)===l.getNode()&&(b.empty(),b.add({pathElement:i}),l.manageSelectionHighlight&&l._isInCreationState&&l.manageSelectionHighlight())})),!l.getPropertiesObject&&"ProgressiveVisuLoading"!==n)){require(["DS/DMUMeasure/DMUMeasureProperties"],(function(e){var t=new e(l);l.getPropertiesObject=function(){return t}}))}},this.removeAuthoringData=function(){-1!==c.getAuthoringFeatureTypes().indexOf("Measure")&&-1!==c.getAuthoringFeatureTypes().indexOf("Measure")&&require([s],(function(e){var t=new e;l.getContextualCommandList=null,l.getSharedContextualCommandList=null,l.getSharedHeaderTypes=null,l.getSharedContextualMenuCommandList=null,l.applyStateToContextHdr=null,l.getPointTypeHdr=null,l.getExtremityTypeHdr=null,l.setCheckCmdHdrState=null,t.unregister({frmWindow:l._frmWindow})}))};var p=new h(l);this.importData=p.importData,this.afterImport=p.afterImport,this.initAuthoringData();var m=d.getDMUMarkupsController({context:this._viewer,frmWindow:this._frmWindow});m&&m.registerMarker(this),this.getType=function(){return"DMUMeasure"},this.getMeasureType=function(){return this._sType},this.setNode(new g({owner:this,frmWindow:this._frmWindow,getType:this.getType})),this.getPixelFontSize=function(){if(l.getNode())return l.getNode().getPixelFontSize()};var v=this.refreshNode;this.refreshNode=function(e){l._doNotRefresh||!l.getNode()||i.isImporting&&(!i.isImporting||i.isImporting())||(l.getNode().update(!1,e),v())},this.getManipulationData=function(){return this.getNode().getLabelParams()},this.isMeasureDisplayed=function(){return l.isVisible()&&l.getActiveFlag()&&l.isDisplayed()&&l.getAttribute("bVisible")},this.getTesselatedRep=function(e){let t=u?u.getAttribute("oLinksManager"):void 0;return t?t.getTesselatedRepByID(e):void 0},this.getPrefNameForDistanceType=function(){var e="";if(this._sMeasurable1&&this._sMeasurable2){for(var i="DMUMeasureDistanceType",n=[],r=0;r<2;r++){var s=this.getAttribute("sSelectedType"+(r+1));if(this._objAction||s!==t.ViewedType.POINT&&s!==t.ViewedType.CENTER){var u="_sMeasurable"+(r+1);switch(this[u].getType()){case 0:case 1:n[r]="Point";break;case 2:n[r]="Curve";break;case 3:n[r]="Line";break;case 4:n[r]="Circle",Math.abs(2*Math.PI-this[u].getArcAngle())>.001&&(n[r]="Arc");break;case 5:n[r]="Surface";break;case 6:n[r]="Plane";break;case 7:n[r]="Cylinder";break;case 8:n[r]="Cone";break;case 9:n[r]="Sphere";break;case 10:n[r]="Product"}}else n[r]="Point"}var c="";if(this.getAttribute("sSelectedType1")!==t.ViewedType.POINT&&this.getAttribute("sSelectedType1")!==t.ViewedType.CENTER&&this.getAttribute("sSelectedType2")!==t.ViewedType.POINT&&this.getAttribute("sSelectedType2")!==t.ViewedType.CENTER){var p,d,g=0;if(l._sMeasurable1._type===a.GeometryType.LINE&&l._sMeasurable2._type===a.GeometryType.LINE)p=l._sMeasurable1.getAxis(),d=l._sMeasurable2.getAxis(),g=p.angleTo(d),(o.isZero(0-g)||o.isZero(Math.PI-g))&&(c="Parallel");else if(l._sMeasurable1._type===a.GeometryType.LINE&&l._sMeasurable2._type===a.GeometryType.PLANE||l._sMeasurable1._type===a.GeometryType.PLANE&&l._sMeasurable2._type===a.GeometryType.LINE)l._sMeasurable1._type===a.GeometryType.LINE?(p=l._sMeasurable1.getAxis(),d=l._sMeasurable2.getPlane().normal):(p=l._sMeasurable1.getPlane().normal,d=l._sMeasurable2.getAxis()),g=p.angleTo(d),(o.isZero(.5*Math.PI-g)||o.isZero(1.5*Math.PI-g))&&(c="NormalPerpendicular");else if(l._sMeasurable1._type===a.GeometryType.LINE&&(l._sMeasurable2._type===a.GeometryType.CYLINDER||l._sMeasurable2._type===a.GeometryType.CONE)||(l._sMeasurable1._type===a.GeometryType.CYLINDER||l._sMeasurable1._type===a.GeometryType.CONE)&&l._sMeasurable2._type===a.GeometryType.LINE)p=l._sMeasurable1.getAxis(),d=l._sMeasurable2.getAxis(),g=p.angleTo(d),(o.isZero(0-g)||o.isZero(Math.PI-g))&&(c="Parallel");else if(l._sMeasurable1._type===a.GeometryType.PLANE&&l._sMeasurable2._type===a.GeometryType.PLANE||l._sMeasurable1._type===a.GeometryType.CYLINDER&&l._sMeasurable2._type===a.GeometryType.CYLINDER||l._sMeasurable1._type===a.GeometryType.CYLINDER&&l._sMeasurable2._type===a.GeometryType.CONE||l._sMeasurable1._type===a.GeometryType.CONE&&l._sMeasurable2._type===a.GeometryType.CONE||l._sMeasurable1._type===a.GeometryType.CONE&&l._sMeasurable2._type===a.GeometryType.CYLINDER){let e=l._sMeasurable1.getPlane();e&&e.normal?p=e.normal:l._sMeasurable1.getAxis&&(p=l._sMeasurable1.getAxis()),e=l._sMeasurable2.getPlane(),e&&e.normal?d=e.normal:l._sMeasurable2.getAxis&&(d=l._sMeasurable2.getAxis()),g=p.angleTo(d),(o.isZero(0-g)||o.isZero(Math.PI-g))&&(c="Parallel")}else if(l._sMeasurable1._type===a.GeometryType.CYLINDER&&l._sMeasurable2._type===a.GeometryType.PLANE||l._sMeasurable1._type===a.GeometryType.CONE&&l._sMeasurable2._type===a.GeometryType.PLANE||l._sMeasurable1._type===a.GeometryType.PLANE&&l._sMeasurable2._type===a.GeometryType.CYLINDER||l._sMeasurable1._type===a.GeometryType.PLANE&&l._sMeasurable2._type===a.GeometryType.CONE){let e=l._sMeasurable1.getPlane();e&&e.normal?p=e.normal:l._sMeasurable1.getAxis&&(p=l._sMeasurable1.getAxis()),e=l._sMeasurable2.getPlane(),e&&e.normal?d=e.normal:l._sMeasurable2.getAxis&&(d=l._sMeasurable2.getAxis()),g=p.angleTo(d),(o.isZero(.5*Math.PI-g)||o.isZero(1.5*Math.PI-g))&&(c="Parallel")}}e=i+n[0]+n[1]+c+"Preferences",localStorage.getItem(i+n[0]+n[1]+c+"Preferences")||(e=i+n[1]+n[0]+c+"Preferences")}return e},this.setDistanceType=function(e){var t=this.getPrefNameForDistanceType();if(""!==t){var i=localStorage.getItem(t);e&&("distance"===e.toLocaleLowerCase()&&i&&"angle"===i.toLocaleLowerCase()?i="MinimumDistance":"angle"===e.toLocaleLowerCase()&&i&&"angle"!==i.toLocaleLowerCase()&&(i="Angle")),this.setAttribute("sDistanceType",i)}};var P=this.updateRepresentation;this.updateRepresentation=function(e,t){if(this._isInCreationState){this.managePathElementAgent&&this.managePathElementAgent(e.bManipulation);var i=this.getAttribute("bCumulativeMeasure");if((!e.bManipulation||i)&&this.manageSelectionHighlight){var n=null;i&&(n=e.pathElements),this.manageSelectionHighlight(n)}}P(e,t)},this._parentsetAttributes=this.setAttributes,this.setAttributes=function(e){var t=[];if(e&&e.length)for(var i=0;i<e.length;i++)if("lCustomization"===e[i].name){var n=e[i].value,r=n.length,o=[],a=this.getAttribute("lCustomization"),s=0,l=0;for(s=0;s<a.length;s++)o.push(a[s]);var u=o&&o.length?o.length:0;if(0===u){var c=this.getCustoListAsPerMainValue(this.getMainValueType()),p=c&&c.length?c.length:0;for(s=0;s<p;s++)o.push({custoName:c[s],custoValue:1})}if(u=o&&o.length?o.length:0)for(s=0;s<r;s++)for(l=0;l<u;l++)n[s].custoName===o[l].custoName&&(o[l].custoValue=n[s].custoValue);o.length>0&&t.push({name:"lCustomization",value:o})}else t.push({name:e[i].name,value:e[i].value});t.length>0&&this._parentsetAttributes(t)},l.measureCmdCBToken=[],l._eventController=c.giveEventsController({viewer:e}),l._eventController&&(l.measureCmdCBToken.push(l._eventController.addEvent("onSetPickThroughtRequest",(()=>{r.setPickability(l,!1)}))),l.measureCmdCBToken.push(l._eventController.addEvent("onUnsetPickThroughRequest",(()=>{r.setPickability(l,!0)})))),this.getPointedReferences=()=>l.getAttribute("lSelectedProducts"),this.getListPointedReferencesPath=()=>{let e=[];var t=this.getPointedReferences();if(t&&t.length){var i=this.getParent().getAttribute("oLinksManager");if(i)for(var n=0;n<t.length;n++)if("null"!==t[n]){var r=i.getOccurrencePathElement(t[n]);r&&e.push({pathElement:r})}}return e},this.selectPointedReferencesPath=()=>{var e=this.getListPointedReferencesPath();e&&e.length&&(b.add(e),y.add(e))}},setAttribute:function(e,t){"fFontSize"===e?this.setAttribute("iFontSize",null):"fLineStyleThicknessIndex"===e?this._parent("fLineStyleThickness",null):"fLeaderStyleThicknessIndex"===e&&this._parent("fLeaderStyleThickness",null),"LeaderEndType"===e&&(e="sLeaderEndType"),this._parent(e,t)},update2DArcDisplay:function(){if(this.getAttribute("sResultingType1")===t.ResultType.CIRCLE){var e=this._sMeasurable1.getArcAngle();this.getAttribute("bArcLengthDisplay")&&e&&Math.abs(2*Math.PI-e)>.001?(this.setAttribute("sLeaderEndType","Arrow"),this.setAttribute("sExtremityType","FullCircle")):(this._sLeaderEndType&&(this._sLeaderEndType=void 0),this._sExtremityType&&(this._sExtremityType=void 0))}},updateGlobalRadiusPreference:function(e){var i;switch(i=!0===e?"DisplayRadius":"DisplayDiameter",this.getAttribute("sResultingType1")){case t.ResultType.CIRCLE:"2D"===this.getAttribute("sMeasureOnGeometryType")&&Math.abs(2*Math.PI-this._sMeasurable1._arcAngle)>.001?localStorage.setItem("DMUMeasureArcRadiusPreferences",i):localStorage.setItem("DMUMeasureCircleRadiusPreferences",i);break;case t.ResultType.CYLINDER:localStorage.setItem("DMUMeasureCylinderRadiusPreferences",i);break;case t.ResultType.SPHERE:localStorage.setItem("DMUMeasureSphereRadiusPreferences",i)}},updateFeatureAndDistanceTypePreference:function(e){if(e){this.setAttribute("sDistanceType",e);var t=this.getPrefNameForDistanceType();""!==t&&localStorage.setItem(t,e)}switch(this._local2DDistancePref){case"DMUMeasBetween2CirclesDistancePref":localStorage.setItem("DMUMeasBetween2CirclesDistancePref",e);break;case"DMUMeasBetweenCircleArcDistancePref":localStorage.setItem("DMUMeasBetweenCircleArcDistancePref",e);break;case"DMUMeasBetweenCircleAnygeomDistancePref":localStorage.setItem("DMUMeasBetweenCircleAnygeomDistancePref",e);break;case"DMUMeasBetween2ArcsDistancePref":localStorage.setItem("DMUMeasBetween2ArcsDistancePref",e);break;case"DMUMeasBetweenArcAnygeomDistancePref":localStorage.setItem("DMUMeasBetweenArcAnygeomDistancePref",e);break;case"DMUMeasBetween2ParallelLinesDistancePref":localStorage.setItem("DMUMeasBetween2ParallelLinesDistancePref",e);break;case"DMUMeasBetween2LinesDistancePref":localStorage.setItem("DMUMeasBetween2LinesDistancePref",e);break;case"DMUMeasBetween2AnyGeomsDistancePref":localStorage.setItem("DMUMeasBetween2AnyGeomsDistancePref",e)}},updateFeatureAndSurfaceDisplayTypePreference:function(e){if(e){switch(this.setAttribute("sSurfaceDisplayType",e),this._sResultingType1){case t.ResultType.CYLINDER:localStorage.setItem("DMUMeasSurfaceDisplayCylinderPref",e);break;case t.ResultType.CONE:localStorage.setItem("DMUMeasSurfaceDisplayConePref",e);break;case t.ResultType.SPHERE:localStorage.setItem("DMUMeasSurfaceDisplaySpherePref",e)}"Diameter"!==e&&"Radius"!==e||this.updateGlobalRadiusPreference("Radius"===e)}this.updateMainValueDisplayAsPerPref()},updateFeatureAndProductDisplayTypePreference:function(e){e&&(this.setAttribute("sProductDisplayType",e),localStorage.setItem("DMUMeasProductDisplayPref",e)),this.updateMainValueDisplayAsPerPref()},updateGlobalRadiusResultDisplayPreference:function(e){var i,n;"MeasureItem"===this.getAttribute("sType")&&this.getAttribute("sResultingType1")===t.ResultType.CIRCLE?(n="DMUMeasureRadiusResultDisplayPreferences",i="TANGENT",0===e&&(i="CENTER")):"Measure3PointsCircle"===this.getAttribute("sType")&&(n="DMUMeasure3PointsCircleRadiusResultDisplayPreferences",i="TANGENT",0===e&&(i="CENTER")),void 0!==i&&void 0!==n&&localStorage.setItem(n,i)},updateAngleValues:function(){var e=this.getAttribute("vAngleArcCenter"),t=this.getAttribute("vAnglePointingPoint"),i=this.getAttribute("vAngleVector1"),n=this.getAttribute("vAngleVector2"),r=this.getAttribute("fQuadrant"),o=this.getAttribute("bComplementaryAngle"),a=i.clone();1!==r&&3!==r||a.negate();var s=n.clone();2!==r&&3!==r||s.negate();var l=t.clone().sub(e).length(),u=a.clone().add(s);o&&u.negate(),t=u.normalize().multiplyScalar(l).add(e),this.setAttribute("vAnglePointingPoint",t),this.setAttribute("vAngleBreakPoint",t),this.getNode().cleanAngleCache()},updateGrpahicPropertyAsPerPref:function(){if(void 0===this._partialMeasure){var e=["Solid","Dotted","Dashed","Dot Dashed","Phantom","Small Dots","JIS Axis"].indexOf(this._preferences.find((e=>"Measure_GraphicProperties_LineType"===e.name)).value)+1,t=["1","2","3","4","5","6","7","8","16","32","64"].indexOf(this._preferences.find((e=>"Measure_GraphicProperties_LineThickness"===e.name)).value);0!==t&&this.setAttribute("fLineStyleThicknessIndex",t),this.setAttribute("fLeaderStyleThicknessIndex",t),this.setAttribute("sLineStylePattern",e.toString()),this.setAttribute("sLeaderStylePattern",e.toString());var i=this._preferences.find((e=>"Measure_GraphicProperties_TextBold"===e.name)).value,n=this._preferences.find((e=>"Measure_GraphicProperties_TextItalic"===e.name)).value;i&&n?this.setAttribute("sFontStyle","bold italic"):i?this.setAttribute("sFontStyle","bold"):n?this.setAttribute("sFontStyle","italic"):this.setAttribute("sFontStyle","normal"),this.setAttribute("bIsFilled",this._preferences.find((e=>"Measure_GraphicProperties_Fill"===e.name)).value),this.setAttribute("cFillStyleColor",new u.Color(this._preferences.find((e=>"Measure_GraphicProperties_FillColor"===e.name)).value)),this.setAttribute("fOpacity",1-this._preferences.find((e=>"Measure_GraphicProperties_FillTransparency"===e.name)).value/100),this.setAttribute("bHasBorder",this._preferences.find((e=>"Measure_GraphicProperties_LineBorder"===e.name)).value),this.setAttribute("cLineStyleColor",new u.Color(this._preferences.find((e=>"Measure_GraphicProperties_LineColor"===e.name)).value)),this.setAttribute("cLeaderStyleColor",new u.Color(this._preferences.find((e=>"Measure_GraphicProperties_LineColor"===e.name)).value)),this.setAttribute("cFontColor",new u.Color(this._preferences.find((e=>"Measure_GraphicProperties_TextColor"===e.name)).value))}this.setAttribute("fFontSize",1e3*this._preferences.find((e=>"Measure_GraphicProperties_TextSize"===e.name)).value)},updateMainValueDisplayAsPerPref:function(){var e,t;(t=this.getMainValueType())&&("MainValue"===(e=this.getMeasureFilterPref(t)).displayType?this.setAttribute("bShortDisplay",!0):this.setAttribute("bShortDisplay",!1),this.setAttribute("bDisplayMeasureType",e.measType),this.setAttribute("bDisplayUnit",e.unit),this.setAttribute("bDisplayApproximateSymbol",e.approx),this._sMainValueType=t,this.setCustomizationToMeasure(e.custo))},getMeasureFilterPref:function(e){var t,i,n,r,o,a=[],s=[],l=0,u=this.getCustoListAsPerMainValue(e);switch(e){case"Axis":case"Coordinates":this._preferences.forEach((e=>{e.name.includes("Coordinates_")&&(s[l++]=e)})),"Axis"===e&&(e="Coordinates");break;case"Line_Length":this._preferences.forEach((e=>{e.name.includes("Line_Length_")&&(s[l++]=e)}));break;case"Curve_Length":this._preferences.forEach((e=>{e.name.includes("Curve_Length_")&&(s[l++]=e)}));break;case"Arc_Length":this._preferences.forEach((e=>{e.name.includes("Arc_Length_")&&(s[l++]=e)}));break;case"Cylinder_Length":this._preferences.forEach((e=>{e.name.includes("Cylinder_Length_")&&(s[l++]=e)}));break;case"Cone_Length":this._preferences.forEach((e=>{e.name.includes("Cone_Length_")&&(s[l++]=e)}));break;case"Distance":this._preferences.forEach((e=>{e.name.includes("Distance_")&&(s[l++]=e)}));break;case"Min_Distance":"LocalMinimumDistance"===this.getAttribute("sDistanceType")?(this._preferences.forEach((e=>{e.name.includes("Local_Min_Distance_")&&(s[l++]=e)})),e="Local_Min_Distance"):this._preferences.forEach((e=>{e.name.includes("Min_Distance_")&&(s[l++]=e)}));break;case"Max_Distance":"LocalMaximumDistance"===this.getAttribute("sDistanceType")?(this._preferences.forEach((e=>{e.name.includes("Local_Max_Distance_")&&(s[l++]=e)})),e="Local_Max_Distance"):this._preferences.forEach((e=>{e.name.includes("Max_Distance_")&&(s[l++]=e)}));break;case"Angle_Btw2Selections":this._preferences.forEach((e=>{e.name.includes("Angle_Btw2Selections_")&&(s[l++]=e)}));break;case"Angle_By3Pts":this._preferences.forEach((e=>{e.name.includes("Angle_By3Pts_")&&(s[l++]=e)}));break;case"Cone_Angle":this._preferences.forEach((e=>{e.name.includes("Cone_Angle_")&&(s[l++]=e)}));break;case"Half_Angle":this._preferences.forEach((e=>{e.name.includes("Half_Angle_")&&(s[l++]=e)}));break;case"Radius":this._preferences.forEach((e=>{e.name.includes("Radius_")&&(s[l++]=e)}));break;case"Cylinder_Radius":this._preferences.forEach((e=>{e.name.includes("Cylinder_Radius_")&&(s[l++]=e)}));break;case"Sphere_Radius":this._preferences.forEach((e=>{e.name.includes("Sphere_Radius_")&&(s[l++]=e)}));break;case"Min_Radius":this._preferences.forEach((e=>{e.name.includes("Min_Radius_")&&(s[l++]=e)}));break;case"Max_Radius":this._preferences.forEach((e=>{e.name.includes("Max_Radius_")&&(s[l++]=e)}));break;case"Radius_By3Pts":this._preferences.forEach((e=>{e.name.includes("Radius_By3Pts_")&&(s[l++]=e)}));break;case"Diameter":this._preferences.forEach((e=>{e.name.includes("Diameter_")&&(s[l++]=e)}));break;case"Cylinder_Diameter":this._preferences.forEach((e=>{e.name.includes("Cylinder_Diameter_")&&(s[l++]=e)}));break;case"Sphere_Diameter":this._preferences.forEach((e=>{e.name.includes("Sphere_Diameter_")&&(s[l++]=e)}));break;case"Min_Diameter":this._preferences.forEach((e=>{e.name.includes("Min_Diameter_")&&(s[l++]=e)}));break;case"Max_Diameter":this._preferences.forEach((e=>{e.name.includes("Max_Diameter_")&&(s[l++]=e)}));break;case"Diameter_By3Pts":this._preferences.forEach((e=>{e.name.includes("Diameter_By3Pts_")&&(s[l++]=e)}));break;case"Surface_Area":this._preferences.forEach((e=>{e.name.includes("Surface_Area_")&&(s[l++]=e)}));break;case"PlanarSurface_Area":this._preferences.forEach((e=>{e.name.includes("PlanarSurface_Area_")&&(s[l++]=e)}));break;case"Product_Area":this._preferences.forEach((e=>{e.name.includes("Product_Area_")&&(s[l++]=e)}));break;case"Volume":this._preferences.forEach((e=>{e.name.includes("Volume_")&&(s[l++]=e)}));break;case"Thickness":this._preferences.forEach((e=>{e.name.includes("Thickness_")&&(s[l++]=e)}))}for(t=0;t<s.length;t++)if(s[t].name===e+"_DisplayType")i=s[t].value;else if(s[t].name===e+"_MeasureType")n=s[t].value;else if(s[t].name===e+"_Unit")o=s[t].value;else if(s[t].name===e+"_ApproximatedValueSymbol")r=s[t].value;else for(l=0;l<u.length;l++)s[t].name.toLowerCase()===(e+"_"+u[l]).toLowerCase()&&(a[l]=s[t].value);return{displayType:i,measType:n,unit:o,approx:r,custo:a}},getMainValueType:function(){var e;if("MeasureItem"===this._sType){var i=this.getAttribute("sResultingType1");switch(i){case t.ResultType.AXIS:e="Axis";break;case t.ResultType.POINT:case t.ResultType.PICKINGPT:case t.ResultType.CENTER:e="Coordinates";break;case t.ResultType.CURVE:e="Curve_Length";break;case t.ResultType.LINE:e="Line_Length";break;case t.ResultType.CIRCLE:e=this.getAttribute("bArcLengthDisplay")?"Arc_Length":this.getAttribute("bRadiusDisplay")?"Radius":"Diameter";break;case t.ResultType.CYLINDER:case t.ResultType.SPHERE:var n=this.getAttribute("sSurfaceDisplayType");e="Cylinder_",i===t.ResultType.SPHERE&&(e="Sphere_"),i===t.ResultType.CYLINDER&&"Length"===n?e+="Length":"Area"===n?e="Surface_Area":this.getAttribute("bRadiusDisplay")?e+="Radius":e+="Diameter";break;case t.ResultType.PLANE:e="PlanarSurface_Area";break;case t.ResultType.SURFACE:e="Surface_Area";break;case t.ResultType.CONE:e="Half_Angle";var r=this.getAttribute("sSurfaceDisplayType");"HalfAngle"===r?e="Half_Angle":"Angle"===r?e="Cone_Angle":"Length"===r?e="Cone_Length":"MaximumRadius"===r?e="Max_Radius":"MaximumDiameter"===r?e="Max_Diameter":"MinimumRadius"===r?e="Min_Radius":"MinimumDiameter"===r?e="Min_Diameter":"Area"===r&&(e="Surface_Area");break;case t.ResultType.PRODUCT:if(e="Volume","volume"!==this._resType){var o=this.getAttribute("fVolume");"Area"!==this.getAttribute("sProductDisplayType")&&0!==o&&void 0!==o||(e="Product_Area")}}}else if("MeasureBetween"===this._sType){switch(this.getAttribute("sDistanceType")){case"Angle":e="Angle_Btw2Selections";break;case"Distance":e="Distance";break;case"MinimumDistance":case"LocalMinimumDistance":e="Min_Distance";break;case"MaximumDistance":case"LocalMaximumDistance":e="Max_Distance";break;default:"Min_Distance"}}else if("MeasureThickness"===this._sType)e="Thickness";else if("Measure3PointsCircle"===this._sType)e=this.getAttribute("bRadiusDisplay")?"Radius_By3Pts":"Diameter_By3Pts";else if("Measure3PointsAngle"===this._sType){e="Angle_By3Pts","Angle"===this.getAttribute("sDistanceType")||(e=this.getAttribute("bRadiusDisplay")?"Radius_By3Pts":"Diameter_By3Pts")}return e},getMeasurable:function(e){return this["_sMeasurable"+e]},getCumulativeMeasurables:function(){return this._cumulativeMeasurables},setCumulativeMeasurables:function(e){this._cumulativeMeasurables&&this._cumulativeMeasurables.push(e)},setMeasurable:function(e,t){var i=this;if(this["_sMeasurable"+e])for(var n=this["_sMeasurableNode"+e],o=this["_sMeasurableToken"+e],a=0;a<n.length;a++)n[a].modelEvents.unsubscribe(o[a]);if(this["_sMeasurable"+e]=t,t){var s=[],u=[],c=t.getPathElement(),p=t.getLevel(),d=p?r.truncatePathElement(c,p).externalPath:c.externalPath,g={event:"move"};this.updateAfterEvent=function(){i.update()};for(var h=0;h<d.length;h++){var b=d[h];r.isInstance(b)&&(void 0===b.modelEvents&&(b.modelEvents=new l),s.push(b),u.push(b.modelEvents.subscribe(g,this.updateAfterEvent)))}this["_sMeasurableNode"+e]=s,this["_sMeasurableToken"+e]=u}},remove:function(){let e=this;var t=d.giveDMUMarkupsController({context:this._viewer});t&&t.unregisterMarker(this),d.unreferenceDMUMarkupsController({context:this._viewer}),e._eventController&&e.measureCmdCBToken&&e.measureCmdCBToken.forEach((t=>{e._eventController.removeEvent(t)})),this._parent(),this._paneltop&&this._paneltop.destroy(),this.setMeasurable(1,void 0),this.setMeasurable(2,void 0),this.setMeasurable(3,void 0);let i=this.getNode();if(i&&i.clearEvents&&i.clearEvents(),this._lockedNodes){var n=c.getContextViewer({viewer:this._viewer});n.getController&&n.getController().unlockNodes({ids:this._lockedNodes}),this.clearLockedNodes()}if(e._isInCreationState&&!e._bPrevisualized&&(this._eventController||(this._eventController=c.giveEventsController({viewer:this._viewer})),this._eventController&&!this._bCumulativeMeasure)){var r=this._eventController;setTimeout((function(){r.fireEvent("onMeasureDeleteWhileActiveCmd")}),100)}},update:function(e){this._doNotRefresh=!0;var s,l,d=[],g=[],h=[],b={},y="NA",P="NA",f="NA",w=!1,M=this._sMeasurable1?this._sMeasurable1.getType():void 0,S=this._sMeasurable2?this._sMeasurable2.getType():void 0,T=this.getAttribute("sSelectedType1"),D=this.getAttribute("sSelectedType2"),C=!1;(T===t.ViewedType.INFPLANE&&D===t.ViewedType.INFPLANE||T===t.ViewedType.POINT&&D===t.ViewedType.INFPLANE||T===t.ViewedType.INFPLANE&&D===t.ViewedType.POINT||T===t.ViewedType.INFPLANE&&D===t.ViewedType.CURVE&&S===a.GeometryType.LINE||T===t.ViewedType.CURVE&&M===a.GeometryType.LINE&&D===t.ViewedType.INFPLANE)&&(C=!0),this._bNewExtLineDisplay=!1;var _=this.getAttribute("sDistanceType");!C||"MeasureBetween"!==this._sType||"Distance"!==_&&"MinimumDistance"!==_&&"MaximumDistance"!==_||(this._bNewExtLineDisplay=!0);var E=this;function L(e){return e&&!e.isNaN()&&e.min&&e.max&&!e.min.equals(e.max)}if("2D"===this.getAttribute("sMeasureOnGeometryType")&&(w=!0),"MeasureItem"===this._sType){var R=(b=n.measureItem(this._sMeasurable1,this.getAttribute("sSelectedType1"),!1,(function(e){if(!e||!e.getBoundingBox||!e.getBoundingBox)return;var t,i=e.getBoundingBox(t,E._viewer,"visibleSpace"),n=e.getBoundingBox(t,E._viewer,"invisibleSpace");let r=e.getWorldMatrix();return L(i)&&L(n)?i.mergeWithBox(n):L(n)&&(i=n),r&&i.applyMatrix4(r),i}))).position;this._sResultingType1===t.ResultType.CIRCLE&&0===this.getAttribute("iRadiusResultDisplayType")&&(R=b.arcMidPoint.clone()),h.push({attribute:"vLeaderPointingPoint3D",value:R}),h.push({attribute:"vLeaderBreakPoint3D",value:R}),this._oProduct1=b.product,d.push(this._oProduct1);let e=this._sMeasurable1._pathElement;if(this._sResultingType1===t.ResultType.PRODUCT){let t=this._sMeasurable1.getLevel();g.push(t?r.truncatePathElement(e,t):e)}else g.push(e);var N=this.getAttribute("sSurfaceDisplayType");l="Approximate";var x=this.getMeasurable(1);switch(x&&x.getMode()===a.Mode.EXACT&&(l="Exact"),h.push({attribute:"sComputationMode",value:l}),this._sResultingType1){case t.ResultType.POINT:case t.ResultType.PICKINGPT:case t.ResultType.CENTER:y="Cross",P="None",h.push({attribute:"vPosition",value:b.position});break;case t.ResultType.LINE:case t.ResultType.AXIS:case t.ResultType.CURVE:this._sMeasurable1._type===a.GeometryType.CIRCLE?h.push({attribute:"fLength",value:b.arcLength}):h.push({attribute:"fLength",value:b.length}),this._sResultingType1!==t.ResultType.LINE&&this._sResultingType1!==t.ResultType.CURVE||(f="FullCircle"),this._sResultingType1!==t.ResultType.AXIS&&this._sResultingType1!==t.ResultType.CURVE||(y="Arrow");break;case t.ResultType.CIRCLE:h.push({attribute:"fRadius",value:b.radius}),h.push({attribute:"vCenter",value:b.center}),h.push({attribute:"vNormal",value:b.normal}),h.push({attribute:"vArcMidPoint",value:b.arcMidPoint});var V=this._sMeasurable1.getArcAngle();w&&this.getAttribute("bArcLengthDisplay")&&V&&Math.abs(2*Math.PI-V)>.001&&(y="Arrow",f="FullCircle");break;case t.ResultType.PLANE:y="Bubble",h.push({attribute:"vOrigin",value:b.origin}),h.push({attribute:"vNormal",value:b.normal}),h.push({attribute:"fArea",value:b.area}),h.push({attribute:"vCog",value:b.cog});break;case t.ResultType.CYLINDER:h.push({attribute:"fRadius",value:b.radius}),h.push({attribute:"fArea",value:b.area}),h.push({attribute:"vCog",value:b.cog}),h.push({attribute:"fHeight",value:b.height}),this._vPoint1=b.point1,this._vPoint2=b.point2,this._vAxis=b.point2.clone().sub(b.point1);var I=this._vPoint1.clone().add(this._vPoint2).multiplyScalar(.5);h.push({attribute:"vCenter",value:I}),this._sMeasurable1.center=I.clone(),this._sMeasurable1.normal=this._vAxis.clone(),s=["sLeaderEndType","sExtremityType","sPointType"],this._removeAttribute(s),"Length"===N?f="FullCircle":"Area"===N&&(y="Bubble");break;case t.ResultType.CONE:h.push({attribute:"vApex",value:b.apex}),h.push({attribute:"fSemiAngle",value:b.semiAngle}),h.push({attribute:"fArea",value:b.area}),h.push({attribute:"vCog",value:b.cog}),h.push({attribute:"fRadius",value:b.minRadius}),h.push({attribute:"fMaxRadius",value:b.maxRadius}),h.push({attribute:"fHeight",value:b.height}),this._vPoint1=b.point1,this._vPoint2=b.point2,this._vAxis=b.axis,h.push({attribute:"vCenter",value:this._vPoint2.clone()}),s=["sLeaderEndType","sExtremityType","sPointType"],this._removeAttribute(s),"Length"===N?f="FullCircle":"Area"===N&&(y="Bubble");break;case t.ResultType.SPHERE:h.push({attribute:"fRadius",value:b.radius}),h.push({attribute:"vCenter",value:b.center}),h.push({attribute:"fArea",value:b.area}),h.push({attribute:"vCog",value:b.cog});break;case t.ResultType.SURFACE:y="Bubble",h.push({attribute:"fArea",value:b.area}),h.push({attribute:"vCog",value:b.cog});break;case t.ResultType.PRODUCT:y="Square";this._removeAttribute(["fVolume","fArea","vCog","aabb","fLength"]);let e=b.volume&&b.volume>0;"volume"===this._resType||e?h.push({attribute:"fVolume",value:e?b.volume:0}):h.push({attribute:"sProductDisplayType",value:"Area"}),b.area&&b.area>0&&h.push({attribute:"fArea",value:b.area}),b.cog&&h.push({attribute:"vCog",value:b.cog}),b.aabb&&h.push({attribute:"aabb",value:b.aabb}),b.length&&b.length>0&&h.push({attribute:"fLength",value:b.length})}"NA"!==y&&h.push({attribute:"sLeaderEndType",value:y}),"NA"!==P&&h.push({attribute:"sPointType",value:P}),"NA"!==f&&h.push({attribute:"sExtremityType",value:f}),this.set(h),this._buildConstructionData(b)}else if("MeasureBetween"===this._sType){if(s=["lFirstExtensionPoints","lSecondExtensionPoints"],this._removeAttribute(s),w?("Distance"!==_&&(T===t.ViewedType.POINT&&D===t.ViewedType.POINT||this.getAttribute("sResultingType1")===t.ResultType.POINT&&this.getAttribute("sResultingType2")===t.ResultType.POINT)&&(_="Distance",this.setAttribute("sDistanceType",_)),b=n.measureBetween2DGeometries(_,this._sMeasurable1,T,this._sMeasurable2,D)):b=n.measureBetween(this._sMeasurable1,this.getAttribute("sSelectedType1"),this._sMeasurable2,this.getAttribute("sSelectedType2"),!1,this.getAttribute("sDistanceType"),v.isEnvActivated("measurebetweenCylConeOldAlgo",!0)),void 0!==b.aPosition1&&void 0!==b.aPosition2){b.product1&&(this._oProduct1=b.product1,this._oProduct1.externalPath&&this._oProduct1.getLength()>0?d.push(this._oProduct1.getLastElement()):d.push(this._oProduct1));let e=this._sMeasurable1._pathElement;if(this._sResultingType1===t.ResultType.PRODUCT){let t=this._sMeasurable1.getLevel();g.push(t?r.truncatePathElement(e,t):e)}else g.push(e);if(b.product2&&(this._oProduct2=b.product2,this._oProduct2.externalPath&&this._oProduct2.getLength()>0?d.push(this._oProduct2.getLastElement()):d.push(this._oProduct2)),e=this._sMeasurable2._pathElement,this._sResultingType2===t.ResultType.PRODUCT){let t=this._sMeasurable2.getLevel();g.push(t?r.truncatePathElement(e,t):e)}else g.push(e);this._duration=b.duration,h.push({attribute:"fDistance",value:void 0!==b.distance?b.distance:0});var k=void 0!==b.angle?b.angle:0;h.push({attribute:"fAngle",value:k}),void 0===k||o.isZero(k)||(h.push({attribute:"fQuadrant",value:0}),h.push({attribute:"bComplementaryAngle",value:!1})),h.push({attribute:"sSelectedType1",value:b.type1}),h.push({attribute:"sSelectedType2",value:b.type2}),o.isZero(k)?this.getAttribute("sResultingType1")===t.ResultType.PLANE&&this.getAttribute("sResultingType2")===t.ResultType.PLANE?P="FullCircle":this.getAttribute("sResultingType1")===t.ResultType.AXIS&&this.getAttribute("sResultingType2")===t.ResultType.AXIS||(P="Cross"):w&&"Angle"!==this.getAttribute("sDistanceType")&&(P="Cross"),s=["sLeaderEndType","sExtremityType","sPointType"],this._removeAttribute(s),this._bNewExtLineDisplay&&(P="NA"),"NA"!==P&&h.push({attribute:"sPointType",value:P}),l="Approximate",this._sMeasurable1.getMode()===a.Mode.EXACT&&this._sMeasurable2.getMode()===a.Mode.EXACT&&(l="Exact"),h.push({attribute:"sComputationMode",value:l}),this.set(h),this._buildConstructionData(b)}}else if("MeasureThickness"===this._sType){var F,O,B=this._sMeasurable1.getSelPoint(),U=this._sMeasurable1.getSelNormal(),G=[];if(null!=U&&null!=B){F=U.clone().negate(),O=U.clone().normalize().multiplyScalar(.1).add(B);var z=p.computeRayProductInterferences(O.toArray(),F.toArray(),[this._sMeasurable1.getPathElement()]);0===z.returnCode&&(G=z.aIntersections)}var H,J=G&&G.length>0&&G[0].primitive?THREEDS.SubElement.getFromSGNode(G[0].primitive):void 0;H=!!J&&3===J.getBodyDimension()&&G[1]?function(e,t){var n=new u.Matrix4;t&&t.getWorldMatrix?n.getInverse(t.getWorldMatrix()):(n.makeBasis(new u.Vector3(1,0,0),new u.Vector3(0,1,0),new u.Vector3(0,0,1)),n.setPosition(new u.Vector3(0,0,0)));var r=e.point.clone();r.applyMatrix4(n);var o={type:a.GeometryType.POINT,primitive:e.primitive,position:r};return new i({canonic:o,pathElement:t})}(G[1],this._sMeasurable1.getPathElement()):this._sMeasurable1.clone(),this.setMeasurable(2,H),h.push({attribute:"sSelectedType1",value:t.ViewedType.POINT}),h.push({attribute:"sSelectedType2",value:t.ViewedType.POINT}),h.push({attribute:"sResultingType1",value:t.ResultType.POINT}),h.push({attribute:"sResultingType2",value:t.ResultType.POINT}),b=n.measureBetween(this._sMeasurable1,t.ViewedType.POINT,this._sMeasurable2,t.ViewedType.POINT),this._oProduct1=b.product1,d.push(this._oProduct1),g.push(this._sMeasurable1._pathElement),this._oProduct2=b.product2,d.push(this._oProduct2),g.push(this._sMeasurable2._pathElement),h.push({attribute:"fDistance",value:void 0!==b.distance?b.distance:0}),h.push({attribute:"fAngle",value:0}),l="Approximate",h.push({attribute:"sComputationMode",value:l}),this.set(h),this._buildConstructionData(b)}else"Measure3PointsCircle"===this._sType?(s=["sLeaderEndType","sExtremityType"],this._removeAttribute(s),P="Cross",h.push({attribute:"sPointType",value:P}),b=n.measureThreepoints(this._sMeasurable1,this._sMeasurable2,this._sMeasurable3),h.push({attribute:"fRadius",value:b.radius}),h.push({attribute:"fAngle",value:b.angle}),h.push({attribute:"vCenter",value:b.center.clone()}),h.push({attribute:"vNormal",value:b.normal.clone()}),l="Approximate",this._sMeasurable1.getMode()===a.Mode.EXACT&&this._sMeasurable2.getMode()===a.Mode.EXACT&&this._sMeasurable3.getMode()===a.Mode.EXACT&&(l="Exact"),h.push({attribute:"sComputationMode",value:l}),this.set(h),b.position=b.center.clone(),this._buildConstructionData(b)):"Measure3PointsAngle"===this._sType&&(s=["sLeaderEndType","sExtremityType"],this._removeAttribute(s),P="Cross",h.push({attribute:"sPointType",value:P}),b=n.measureThreepoints(this._sMeasurable1,this._sMeasurable2,this._sMeasurable3),h.push({attribute:"fQuadrant",value:0}),h.push({attribute:"bComplementaryAngle",value:!1}),h.push({attribute:"fRadius",value:b.radius}),h.push({attribute:"fAngle",value:b.angle}),h.push({attribute:"vCenter",value:b.center.clone()}),h.push({attribute:"vNormal",value:b.normal.clone()}),l="Approximate",this._sMeasurable1.getMode()===a.Mode.EXACT&&this._sMeasurable2.getMode()===a.Mode.EXACT&&this._sMeasurable3.getMode()===a.Mode.EXACT&&(l="Exact"),h.push({attribute:"sComputationMode",value:l}),this.set(h),b.position=this._sMeasurable2.getSelPoint(),this._buildConstructionData(b));if(this._doNotRefresh=!1,!w&&d.length>0){var q=[0,1];if(d.length>0&&"3dPlay"!==E._typeApps){var Z=g.length,X=!1,W=c.getContextViewer({viewer:this._viewer});if(W&&W.getRoots&&W.getRoots().length>0){var j=W.getController();j&&j.getRootStats(r.getNodeID(W.getRoots()[0]))&&(m.getSetting("enopad3dviewer_lightNodeModel")||m.getSetting("enopad3dviewer_dynamicRepLoading"))&&(X=!0)}for(var Y=0;Y<Z;Y++)if(r.isAPOIPath(g[Y])){var Q=A.getPOIInformationFromPathElement(g[Y]);Q&&void 0!==Q.relatedPath&&r.getRefInstNames({path:Q.relatedPath,callback:function(e){void 0!==e.name&&(E["_oProduct"+(q[e.forPathNum]+1)+"Name"]=e.name,E.refreshNode(!(E._bPrevisualized&&"MeasureThickness"===E._sType)))},context:W,pathNum:Y,fromNode:!X})}else r.getRefInstNames({path:g[Y],callback:function(e){void 0!==e.name&&(E["_oProduct"+(q[e.forPathNum]+1)+"Name"]=e.name,E.refreshNode(!(E._bPrevisualized&&"MeasureThickness"===E._sType)))},context:W,pathNum:Y,fromNode:!X})}}e&&e.iDoNotUpdateDisplayProp||(this.updateMainValueDisplayAsPerPref(),this.updateGrpahicPropertyAsPerPref()),this.refreshNode(!(this._bPrevisualized&&"MeasureThickness"===this._sType))},addLockedNode:function(e){void 0===this._lockedNodes&&(this._lockedNodes=[]),this._lockedNodes.push(e)},getLockedNodes:function(){return this._lockedNodes},isNodeLocked:function(e){var t=!1;return this._lockedNodes&&-1!==this._lockedNodes.indexOf(e)&&(t=!0),t},clearLockedNodes:function(){this._lockedNodes=[]},updatePrdIDAsPerSelectedLevel:function(){var e,t,i,n=[],o=this.getParent().getAttribute("oLinksManager");if("MeasureItem"===this._sType&&this.getAttribute("bCumulativeMeasure")){for(var a=this._cumulativeMeasurables.length,s=0;s<a;s++)if(e=this._cumulativeMeasurables[s].getPathElement(),i=(t=this._cumulativeMeasurables[s].getLevel())?r.truncatePathElement(e,t):e){var l=o.getOccurrence({pathElement:i},!0);l&&l.id&&n.push(l.id)}}else if(e=this._sMeasurable1.getPathElement(),i=(t=this._sMeasurable1.getLevel())?r.truncatePathElement(e,t):e){var u=o.getOccurrence({pathElement:i},!0);u&&u.id&&n.push(u.id)}n.length>0&&this.setAttribute("lSelectedProducts",n)},_buildConstructionData:function(e){var i,n,r,l,c,p,d,g,h,b,y,m,v,A,f,w,M,S,T,D=30,C=[];if(this.setAttribute("lSelectedProducts",void 0),"MeasureItem"===this._sType){var _=this.getAttribute("sSurfaceDisplayType");switch(this._sResultingType1){case t.ResultType.POINT:case t.ResultType.PICKINGPT:this._buildConstructionPointsForLeader(1.4*D,e.position);break;case t.ResultType.CENTER:this._buildConstructionPointsForLeader(1.4*D,e.center);break;case t.ResultType.LINE:this._buildConstructionPointsForDimension(D,e.point1,e.point2);break;case t.ResultType.AXIS:this._buildConstructionPointsForLeader(D,e.point1.clone().add(e.point2).multiplyScalar(.5));break;case t.ResultType.CIRCLE:var E=[];if(n=this.getAttribute("fRadius"),r=this.getAttribute("vNormal"),D=.2*n,c=s.getViewpointInfo(this._viewer.currentViewpoint),l=(new u.Vector3).crossVectors(r,c.sight),i=this.getAttribute("vCenter"),0!==this.getAttribute("iRadiusResultDisplayType"))l=this.getAttribute("vArcMidPoint").clone().sub(i);if(l.length()>.001?l.normalize().multiplyScalar(n):l=c.right.clone().normalize().multiplyScalar(n),b=(new u.Vector3).crossVectors(r,l).normalize(),Math.abs(r.angleTo(c.sight)-Math.PI/2)<Math.PI/10?((b=r.clone().normalize()).dot(c.up)<0&&b.negate(),y=b.clone().multiplyScalar(D)):y=b.clone().multiplyScalar(D+n),0!==this.getAttribute("iRadiusResultDisplayType")&&(y=b.clone().multiplyScalar(D+n)),E.push({attribute:"iExtensionLinesManipulable",value:0}),m=i.clone().add(l),v=i.clone().sub(l),g=m.clone().add(y),h=v.clone().add(y),0===this.getAttribute("iRadiusResultDisplayType")){var L=this._sMeasurable1.getSelPoint().clone().sub(i.clone());L=L.normalize();var R=n+s.getDistanceFromPixel(this._viewer,this._sMeasurable1.getSelPoint().clone(),70);L=L.multiplyScalar(R),A=i.clone().add(L)}else A=g.clone().add(h).multiplyScalar(.5);E.push({attribute:"vLeaderBreakPoint3D",value:A}),E.push({attribute:"vLeaderPointingPoint3D",value:A}),E.push({attribute:"vFirstPoint3D",value:g}),E.push({attribute:"vSecondPoint3D",value:h}),E.push({attribute:"vFirstExtensionPoint3D",value:m}),E.push({attribute:"vSecondExtensionPoint3D",value:v}),E.push({attribute:"vExtensionDirection3D",value:b}),this.set(E);break;case t.ResultType.CURVE:this._buildConstructionPointsForLeader(D,e.position);break;case t.ResultType.PLANE:case t.ResultType.SURFACE:void 0!==this._sMeasurable1.getSelPoint()?this._buildConstructionPointsForLeader(D,e.position):this._buildConstructionPointsForLeader(D,this.getAttribute("vCog"));break;case t.ResultType.CYLINDER:n=this.getAttribute("fRadius"),i=this.getAttribute("vCenter"),c=s.getViewpointInfo(this._viewer.currentViewpoint),(l=(new u.Vector3).crossVectors(this._vAxis,c.sight)).length()>.001?l.normalize().multiplyScalar(n):l=c.right.clone().normalize().multiplyScalar(n),p=i.clone().add(l),d=i.clone().sub(l),"Length"===_?this._buildConstructionPointsForDimension(D,this.getAttribute("vPoint1"),this.getAttribute("vPoint2")):"Area"===_?void 0!==this._sMeasurable1.getSelPoint()?this._buildConstructionPointsForLeader(D,e.position):this._buildConstructionPointsForLeader(D,this.getAttribute("vCog")):this._buildConstructionPointsForLeader(D,p,d);break;case t.ResultType.CONE:var N=this.getAttribute("vApex"),x=this.getAttribute("fSemiAngle");i=this.getAttribute("vCenter"),n=N.clone().sub(this._vPoint2).length()*Math.tan(x),c=s.getViewpointInfo(this._viewer.currentViewpoint),(l=(new u.Vector3).crossVectors(this._vAxis,c.sight)).length()>.001?l.normalize().multiplyScalar(n):l=c.right.clone().normalize().multiplyScalar(n),p=i.clone().add(l),d=i.clone().sub(l),"Length"===_?this._buildConstructionPointsForDimension(D,this.getAttribute("vPoint1"),this.getAttribute("vPoint2")):"Area"===_?void 0!==this._sMeasurable1.getSelPoint()?this._buildConstructionPointsForLeader(D,e.position):this._buildConstructionPointsForLeader(D,this.getAttribute("vCog")):this._buildConstructionPointsForLeader(D,p,d);break;case t.ResultType.SPHERE:n=this.getAttribute("fRadius"),i=this.getAttribute("vCenter"),l=(c=s.getViewpointInfo(this._viewer.currentViewpoint)).right.clone().normalize().multiplyScalar(n),p=i.clone().add(l),d=i.clone().sub(l),this._buildConstructionPointsForLeader(D,p,d);break;case t.ResultType.PRODUCT:this._buildConstructionPointsForLeader(D,this.getAttribute("vLeaderPointingPoint3D")),this.updatePrdIDAsPerSelectedLevel()}}else if("MeasureBetween"===this._sType||"MeasureThickness"===this._sType){if(this._sResultingType1===t.ResultType.PLANE&&this._sResultingType2===t.ResultType.PLANE)if(0===this.getAttribute("fDistance")&&0!==this.getAttribute("fAngle"))g=e.position2.clone(),h=e.position1.clone();else{var V=e.position2.clone().sub(e.position1);h=(g=e.position1.clone()).clone().add(V)}else g=e.position1.clone(),h=e.position2.clone();var I,k,F=this.getAttribute("sDistanceType"),O=this._sMeasurable1?this._sMeasurable1.getType():void 0,B=this._sMeasurable2?this._sMeasurable2.getType():void 0,U=!1;if("Distance"!==F||(O!==a.GeometryType.LINE||B!==a.GeometryType.PICKINGPT&&B!==a.GeometryType.POINT)&&(B!==a.GeometryType.LINE||O!==a.GeometryType.PICKINGPT&&O!==a.GeometryType.POINT)||(U=!0),this._bNewExtLineDisplay||U?this.setAttribute("iExtensionLinesManipulable",0):"Distance"!==F&&"MinimumDistance"!==F&&"MaximumDistance"!==F||!e.extensionDirection?"Angle"!==F&&C.push({attribute:"iExtensionLinesManipulable",value:1}):C.push({attribute:"iExtensionLinesManipulable",value:0}),"Distance"===F){let t=this._sMeasurable1.getAxis(),i=this._sMeasurable2.getAxis();if(this._sMeasurable1.getType()!==a.GeometryType.CIRCLE&&t&&this._sMeasurable2.getType()!==a.GeometryType.CIRCLE&&i){let n=e.angle;if((void 0===n||isNaN(n))&&(n=t.angleTo(i)),!isNaN(n)&&(o.isZero(n)||o.isZero(Math.PI-n)))if(k=this._sMeasurable2.getSelPoint(),this._sMeasurable2._type===a.GeometryType.CYLINDER||this._sMeasurable2._type===a.GeometryType.CONE){let e=this._sMeasurable2.getPoints(),t=this._sMeasurable2.getAxis();c=s.getViewpointInfo(this._viewer.currentViewpoint);var G=P.computeTwoLinesDistance(k.toArray(),c.sight.toArray(),this._sMeasurable2.getPoints().beginPoint.toArray(),t.toArray()).aPosition2;(G||(G=P.computePointLineDistance(k.toArray(),e.endPoint.toArray(),t.toArray()).aPosition))&&(I=new u.Vector3(G[0],G[1],G[2]))}else I=this._sMeasurable2.getSelPoint()}}if(this._buildConstructionPointsForDimension(D,g,h,e.extensionDirection,{dimensionPosition:I,secondSelPoint:k}),"MeasureBetween"===this._sType){var z=!0;if("Angle"!==F&&this._bNewExtLineDisplay&&(z=!1),z){var H,J;if(void 0!==(T=this.getAttribute("fAngle"))&&!o.isZero(T)){var q;m=this.getAttribute("vFirstExtensionPoint3D"),H=(v=this.getAttribute("vSecondExtensionPoint3D")).clone();var Z,X,W=this._sMeasurable1.getSelPoint(),j=this._sMeasurable2.getSelPoint();if(this._sSelectedType1===t.ViewedType.INFPLANE&&this._sSelectedType2!==t.ViewedType.INFPLANE||this._sSelectedType2===t.ViewedType.INFPLANE&&this._sSelectedType1!==t.ViewedType.INFPLANE){var Y=this._sMeasurable1,Q=this._sMeasurable2;this._sSelectedType2===t.ViewedType.INFPLANE&&(Y=this._sMeasurable2,Q=this._sMeasurable1);var K=Y.getPlane(),$=(new u.Plane).setFromNormalAndCoplanarPoint(K.normal,K.origin),ee=$.projectPoint(Q.getPoints().beginPoint),te=$.projectPoint(Q.getPoints().endPoint).sub(ee);if(te.length()>0){var ie=P.computePointLineDistance(Y.getSelPoint().toArray(),H.toArray(),te.toArray());0===ie.returnCode&&(Z=new u.Vector3(ie.aPosition[0],ie.aPosition[1],ie.aPosition[2]),this._sSelectedType2===t.ViewedType.INFPLANE?j=Z:W=Z)}}c=s.getViewpointInfo(this._viewer.currentViewpoint),this.computeAngleVector=function(e,i,n,r){var a,s,l,p,d=i.getPoints();if(e===t.ViewedType.CYCOSP||e===t.ViewedType.AXIS){var g=i.getAxis(),h=P.computeTwoLinesDistance(r.toArray(),c.sight.toArray(),i.getPoints().beginPoint.toArray(),g.toArray());0===h.returnCode&&(r=new u.Vector3(h.aPosition2[0],h.aPosition2[1],h.aPosition2[2]))}return a=r.clone().sub(n),o.isZero(a.length())&&d&&(s=(a=d.beginPoint.clone().sub(n)).length(),p=(l=d.endPoint.clone().sub(n)).length(),(o.isZero(s)||p<s&&!o.isZero(p))&&(a=l)),a},f=this.computeAngleVector(this._sSelectedType1,this._sMeasurable1,m,W),w=this.computeAngleVector(this._sSelectedType2,this._sMeasurable2,v,j),T=f.angleTo(w),S=w.length();var ne=(new u.Vector3).crossVectors(f.clone(),w.clone());if(this._sMeasurable2.getType()!==a.GeometryType.LINE&&(q=P.computeLinePlaneDistance(this._sMeasurable2.getSelPoint().toArray(),c.sight.toArray(),H.toArray(),ne.toArray()))&&0===q.returnCode&&q.relationship===a.Relationship.INTERSECTING&&(S=new u.Vector3(q.aPosition[0],q.aPosition[1],q.aPosition[2]).distanceTo(H),w.normalize().multiplyScalar(S)),f.normalize().multiplyScalar(S),J=(M=f.clone().add(w)).normalize().multiplyScalar(S).add(H),"Angle"===F){var re,oe=[],ae=[],se=!1,le=!1;e.relationship!==a.Relationship.NONE||this._sSelectedType1!==t.ViewedType.CYCOSP&&this._sMeasurable1.getType()!==a.GeometryType.LINE?0===(q=this._sMeasurable1.getLimitPoints(ne,H)).returnCode?(oe=[q.firstLimit,q.secondLimit],C.push({attribute:"lFirstExtensionPoints",value:oe})):(re=this._sMeasurable1.getSelPoint(),this._sMeasurable1.getType()===a.GeometryType.PLANE&&0===(q=P.computePointLineDistance(re.toArray(),H.clone().toArray(),f.toArray())).returnCode&&(oe=[re=new u.Vector3(q.aPosition[0],q.aPosition[1],q.aPosition[2]),re],C.push({attribute:"lFirstExtensionPoints",value:oe}),se=!0)):(Z=this._sMeasurable1.getPoints().beginPoint,X=this._sMeasurable1.getPoints().endPoint,0===(q=P.computePointLineDistance(Z.toArray(),H.clone().toArray(),f.toArray())).returnCode&&(Z=new u.Vector3(q.aPosition[0],q.aPosition[1],q.aPosition[2])),0===(q=P.computePointLineDistance(X.toArray(),H.clone().toArray(),f.toArray())).returnCode&&(X=new u.Vector3(q.aPosition[0],q.aPosition[1],q.aPosition[2])),oe=[Z,X,void 0],C.push({attribute:"lFirstExtensionPoints",value:oe}),se=!0),0===(q=this._sMeasurable2.getLimitPoints(ne,H)).returnCode?(ae=[q.firstLimit,q.secondLimit],C.push({attribute:"lSecondExtensionPoints",value:ae})):(re=this._sMeasurable2.getSelPoint(),this._sMeasurable2.getType()===a.GeometryType.PLANE&&0===(q=P.computePointLineDistance(re.toArray(),H.clone().toArray(),w.toArray())).returnCode&&(oe=[re=new u.Vector3(q.aPosition[0],q.aPosition[1],q.aPosition[2]),re],C.push({attribute:"lSecondExtensionPoints",value:oe}),le=!0)),C.push({attribute:"lbExtensionRequired",value:[se,le]})}}C.push({attribute:"fAngle",value:T}),C.push({attribute:"vAngleArcCenter",value:H}),C.push({attribute:"vAnglePointingPoint",value:J}),C.push({attribute:"vAngleBreakPoint",value:J}),C.push({attribute:"vAngleVector1",value:f}),C.push({attribute:"vAngleVector2",value:w}),this.set(C)}else{this._removeAttribute(["vAngleArcCenter","vAnglePointingPoint","vAngleBreakPoint","vAngleVector1","vAngleVector2"])}}}else if("Measure3PointsCircle"===this._sType)n=this.getAttribute("fRadius"),r=this.getAttribute("vNormal"),i=this.getAttribute("vCenter"),C.push({attribute:"fAngle",value:0}),D=.2*n,c=s.getViewpointInfo(this._viewer.currentViewpoint),(l=(new u.Vector3).crossVectors(r,c.sight)).length()>.001?l.normalize().multiplyScalar(n):l=c.right.clone().normalize().multiplyScalar(n),y=(b=(new u.Vector3).crossVectors(r,l).normalize()).clone().multiplyScalar(D+n),m=i.clone().add(l),v=i.clone().sub(l),g=m.clone().add(y),h=v.clone().add(y),A=0===this.getAttribute("iRadiusResultDisplayType")?m.clone():this.getAttribute("bRadiusDisplay")?h.clone().sub(g).multiplyScalar(.25).add(g):g.clone().add(h).multiplyScalar(.5),C.push({attribute:"vExtensionDirection3D",value:b}),C.push({attribute:"vFirstExtensionPoint3D",value:m}),C.push({attribute:"vSecondExtensionPoint3D",value:v}),C.push({attribute:"vFirstPoint3D",value:g}),C.push({attribute:"vSecondPoint3D",value:h}),C.push({attribute:"vLeaderBreakPoint3D",value:A}),C.push({attribute:"vLeaderPointingPoint3D",value:A.clone()}),this.set(C);else if("Measure3PointsAngle"===this._sType){C.push({attribute:"fDistance",value:0}),f=this._sMeasurable1.getSelPoint().sub(this._sMeasurable2.getSelPoint()),w=this._sMeasurable3.getSelPoint().sub(this._sMeasurable2.getSelPoint()),M=f.clone().add(w),S=w.length();var ue=M.normalize().multiplyScalar(S).add(this._sMeasurable2.getSelPoint());T=f.angleTo(w),C.push({attribute:"fAngle",value:T}),C.push({attribute:"vAngleVector1",value:f}),C.push({attribute:"vAngleVector2",value:w}),C.push({attribute:"vAngleArcCenter",value:this._sMeasurable2.getSelPoint()}),C.push({attribute:"vAnglePointingPoint",value:ue.clone()}),C.push({attribute:"vAngleBreakPoint",value:ue.clone()}),C.push({attribute:"vLeaderBreakPoint3D",value:ue.clone()}),C.push({attribute:"vLeaderPointingPoint3D",value:ue.clone()}),C.push({attribute:"vFirstExtensionPoint3D",value:ue.clone()}),C.push({attribute:"vSecondExtensionPoint3D",value:ue.clone()}),C.push({attribute:"vFirstPoint3D",value:ue.clone()}),C.push({attribute:"vSecondPoint3D",value:ue.clone()}),this.set(C)}},_buildConstructionPointsForConeCylSphere:function(){var e,i,n,r,o,a,l,c={oPos1:void 0,oPos2:void 0};if(this._sResultingType1===t.ResultType.CONE){var p=this._sMeasurable1.getApex(),d=this._sMeasurable1.getSemiAngle(),g=this.getAttribute("sSurfaceDisplayType");n=this._sMeasurable1.getPoints(),e="MinimumRadius"===g||"MinimumDiameter"===g?n.beginPoint:n.endPoint;var h=p.clone().sub(e).length()*Math.tan(d)/Math.sin(d);void 0===(l=this._sMeasurable1.getSelPoint())&&(e=this.getAttribute("vCenter"),a=p.clone().sub(e).length()*Math.tan(d),o=s.getViewpointInfo(this._viewer.currentViewpoint),(r=(new u.Vector3).crossVectors(this._vAxis,o.sight)).length()>.001?r.normalize().multiplyScalar(a):r=o.right.clone().normalize().multiplyScalar(a),l=e.clone().add(r));var b=l.clone().sub(p);b=b.normalize().multiplyScalar(h),c.oPos1=p.clone().add(b),this._sMeasurable1.vSlat=b,this._sMeasurable1.vAxis=e.clone().sub(p);var y=p.clone().sub(n.beginPoint).length()*Math.tan(d);if(y>.001){var m=y/Math.sin(d);this._sMeasurable1.arcRadius=m+Math.abs(h-m)/2}else this._sMeasurable1.arcRadius=h/2;i=c.oPos1.clone().sub(e),c.oPos2=e.clone().sub(i);var v,P=c.oPos2.clone().sub(p);this._sMeasurable1.vSlat1=P,v="Angle"===g?this._sMeasurable1.vAxis.clone():b.clone().add(this._sMeasurable1.vAxis),this._sMeasurable1.arcCenter=v.normalize().multiplyScalar(this._sMeasurable1.arcRadius).add(p.clone())}else if(this._sResultingType1===t.ResultType.CYLINDER){void 0===(l=this._sMeasurable1.getSelPoint())&&(a=this.getAttribute("fRadius"),o=s.getViewpointInfo(this._viewer.currentViewpoint),(r=(new u.Vector3).crossVectors(this._vAxis,o.sight)).length()>.001?r.normalize().multiplyScalar(a):r=o.right.clone().normalize().multiplyScalar(a),l=r),n=this._sMeasurable1.getPoints();var A=l.clone().sub(n.beginPoint),f=l.clone().sub(n.endPoint);e=n.beginPoint,f.length()<A.length()&&(e=n.endPoint);var w=n.beginPoint.clone().sub(n.endPoint);i=(i=(new u.Plane).setFromNormalAndCoplanarPoint(w.normalize(),e).projectPoint(l).clone().sub(e)).clone().normalize().multiplyScalar(this._sMeasurable1.getRadius()),c.oPos1=e.clone().add(i),c.oPos2=e.clone().sub(i)}else if(this._sResultingType1===t.ResultType.SPHERE){var M=(o=s.getViewpointInfo(this._viewer.currentViewpoint)).up.clone();M=M.negate(),e=this._sMeasurable1.getCenter();var S=this._sMeasurable1.getRadius(),T=this._sMeasurable1.getSelPoint();void 0===T&&(T=e.clone().add(o.right.clone().normalize().multiplyScalar(S))),i=(i=T.clone().sub(e)).normalize().multiplyScalar(S);var D=(new u.Vector3).crossVectors(M,i.clone().normalize());this._sMeasurable1.normal=D,c.oPos1=e.clone().add(i),c.oPos2=e.clone().sub(i)}return c},_buildConstructionPointsForLeader:function(e,i,n){var r=[],a=s.getDistanceFromPixel(this._viewer,i,e,this._frmWindow),l=s.getViewpointInfo(this._viewer.currentViewpoint).up.clone().multiplyScalar(a);if(this._sResultingType1===t.ResultType.CONE||this._sResultingType1===t.ResultType.CYLINDER||this._sResultingType1===t.ResultType.SPHERE){if(this._sResultingType1===t.ResultType.SPHERE||"Area"!==this.getAttribute("sSurfaceDisplayType")){var u=this._buildConstructionPointsForConeCylSphere();i=u.oPos1,n=u.oPos2}if(this._sResultingType1===t.ResultType.CONE&&"Area"!==this.getAttribute("sSurfaceDisplayType")){var c=this.getAttribute("fSemiAngle");if(void 0!==c&&!o.isZero(c)){var p=this._sMeasurable1.vAxis.clone();"Angle"===this.getAttribute("sSurfaceDisplayType")&&(p=this._sMeasurable1.vSlat1.clone()),r.push({attribute:"fQuadrant",value:0}),r.push({attribute:"vAngleArcCenter",value:this._sMeasurable1.getApex().clone()}),r.push({attribute:"vAnglePointingPoint",value:this._sMeasurable1.arcCenter.clone()}),r.push({attribute:"vAngleBreakPoint",value:this._sMeasurable1.arcCenter.clone()}),r.push({attribute:"vAngleVector1",value:p}),r.push({attribute:"vAngleVector2",value:this._sMeasurable1.vSlat.clone()})}}}r.push({attribute:"vFirstExtensionPoint3D",value:i.clone()}),r.push({attribute:"vFirstPoint3D",value:i.clone()});var d=i.clone();void 0!==n?(r.push({attribute:"vSecondExtensionPoint3D",value:n.clone()}),r.push({attribute:"vSecondPoint3D",value:n.clone()})):d=i.clone(),!this._sMeasurable1.arcCenter||this._sResultingType1!==t.ResultType.CONE||"Angle"!==this.getAttribute("sSurfaceDisplayType")&&"HalfAngle"!==this.getAttribute("sSurfaceDisplayType")||(d=this._sMeasurable1.arcCenter.clone()),r.push({attribute:"vLeaderPointingPoint3D",value:d}),r.push({attribute:"vLeaderBreakPoint3D",value:this._sResultingType1===t.ResultType.CONE?d:d.clone().add(l)}),this.set(r)},_buildConstructionPointsForDimension:function(e,i,r,l,c){var p,d,g,h,b,y,m,v,A=[],f=!1,w=!1,M=!1,S=!1;let T=i.clone(),D=r.clone();var C,_,E,L,R,N,x=this._sMeasurable1?this._sMeasurable1.getType():void 0,V=this._sMeasurable2?this._sMeasurable2.getType():void 0,I=this.getAttribute("sSelectedType1"),k=this.getAttribute("sSelectedType2"),F=!1,O=!1,B=!1;if(this._bNewExtLineDisplay)if(y=r.clone().sub(i.clone()),I===t.ViewedType.INFPLANE&&k===t.ViewedType.INFPLANE){w=!0,m=this._sMeasurable1.getPlane(),v=this._sMeasurable2.getPlane();var U=m.normal.angleTo(y),G=v.normal.angleTo(y);(o.isZero(0-U)||o.isZero(Math.PI-U))&&(o.isZero(0-G)||o.isZero(Math.PI-G))&&(f=!0)}else if(I===t.ViewedType.INFPLANE&&k===t.ViewedType.POINT||I===t.ViewedType.POINT&&k===t.ViewedType.INFPLANE){S=!0;var z=(E=I===t.ViewedType.INFPLANE?this._sMeasurable1.getPlane():this._sMeasurable2.getPlane()).normal.angleTo(y);(o.isZero(0-z)||o.isZero(Math.PI-z))&&(O=!0)}else{M=!0,x===a.GeometryType.LINE?(C=this._sMeasurable1.getPoints(),E=this._sMeasurable2.getPlane()):(E=this._sMeasurable1.getPlane(),C=this._sMeasurable2.getPoints());var H=(_=C.endPoint.clone().sub(C.beginPoint)).clone().angleTo(E.normal);if(o.isZero(.5*Math.PI-H)||o.isZero(1.5*Math.PI-H)){var J=(new u.Plane).setFromNormalAndCoplanarPoint(E.normal,E.origin),q=J.projectPoint(C.endPoint),Z=J.projectPoint(C.beginPoint),X=C.endPoint.clone().sub(q);C.beginPoint.clone().sub(Z).length()<=.001&&X.length()<=.001&&(B=!0)}}if(this._bNewExtLineDisplay){var W=s.getViewpointInfo(this._viewer.currentViewpoint);if(this.getAttribute("fDistance")>0){var j=[],Y=[],Q=void 0;if(M){var K=_.angleTo(y);if((o.isZero(.5*Math.PI-K)||o.isZero(1.5*Math.PI-K))&&(F=!0),B&&F){var $=s.getViewpointInfo(this._viewer.currentViewpoint),ee=E.normal.clone().angleTo($.up),te=E.normal.clone().angleTo($.sight);ee>.5*Math.PI&&(ee=Math.PI-ee),te>.5*Math.PI&&(te=Math.PI-te),ee<te?Q=E.normal.clone():ee>te&&(Q=_)}else{F&&(Q=_);var ie=E.normal.angleTo(y);(o.isZero(0-ie)||o.isZero(Math.PI-ie))&&(O=!0)}}if(w||S||M&&!F)if(f||O){var ne=new u.Vector3(1,0,0),re=new u.Vector3(0,1,0),oe=new u.Vector3(0,0,1),ae=y.angleTo(ne),se=y.angleTo(re),le=y.angleTo(oe),ue=W.sight.clone().normalize();if(ue.negate(),o.isZero(0-ae)||o.isZero(Math.PI-ae))Q=re,ue.angleTo(oe)>ue.angleTo(re)&&(Q=oe);else if(o.isZero(0-se)||o.isZero(Math.PI-se))Q=oe,ue.angleTo(ne)>ue.angleTo(oe)&&(Q=ne);else if(o.isZero(0-le)||o.isZero(Math.PI-le))Q=ne,ue.angleTo(re)>ue.angleTo(ne)&&(Q=re);else{E=S&&k===t.ViewedType.POINT||M&&V===a.GeometryType.LINE?this._sMeasurable1.getPlane():this._sMeasurable2.getPlane();var ce=(new u.Vector3).crossVectors(E.normal.clone(),ne.clone()),pe=(new u.Vector3).crossVectors(E.normal.clone(),ce.clone());ce=(new u.Vector3).crossVectors(E.normal.clone(),re.clone());var de=(new u.Vector3).crossVectors(E.normal.clone(),ce.clone());ce=(new u.Vector3).crossVectors(E.normal.clone(),oe.clone());var ge=(new u.Vector3).crossVectors(E.normal.clone(),ce.clone()),he=ue.angleTo((new u.Vector3).crossVectors(y.clone(),pe.clone())),be=ue.angleTo((new u.Vector3).crossVectors(y.clone(),de.clone())),ye=ue.angleTo((new u.Vector3).crossVectors(y.clone(),ge.clone())),me=Math.min(he,be,ye);Q=he===me?pe:be===me?de:ge}}else{E=S&&k===t.ViewedType.POINT||M&&V===a.GeometryType.LINE?this._sMeasurable1.getPlane():this._sMeasurable2.getPlane();var ve=(new u.Vector3).crossVectors(y.clone(),E.normal.clone()).normalize();!S&&ve.equals(new u.Vector3(0,0,0))&&w&&(ve=(new u.Vector3).crossVectors(y.clone(),m.normal.clone()).normalize());var Pe=(new u.Vector3).crossVectors(y.clone(),ve.clone()).normalize(),Ae=W.sight.angleTo(ve),fe=W.sight.angleTo(Pe);Ae>.5*Math.PI&&(Ae=Math.PI-Ae),fe>.5*Math.PI&&(fe=Math.PI-fe),Q=Ae<fe?Pe.clone():ve.clone()}if(void 0!==Q){var we=this._sMeasurable2.getSelPoint(),Me=(new u.Plane).setFromNormalAndCoplanarPoint((new u.Vector3).crossVectors(Q,y).normalize(),r.clone()),Se=we.clone();if(!f){var Te=Me.projectPoint(we);if(!we.equals(Te.clone())){var De=Te.clone().sub(we.clone()),Ce=W.sight.angleTo(De),_e=!1;Ce>.5*Math.PI&&(Ce=Math.PI-Ce,_e=!0);var Ee=De.length()/Math.cos(Ce),Le=W.sight.clone().normalize();_e&&Le.negate(),Le.multiplyScalar(Ee),Se=(new u.Vector3).addVectors(we.clone(),Le)}var Re,Ne=(new u.Vector3).addVectors(r.clone(),Q.clone().normalize().multiplyScalar(10)),xe=r.clone().sub(Ne),Ve=Se.clone().sub(Ne),Ie=xe.clone().angleTo(Ve.clone());Ie>Math.PI?(Re=Ve.length()*Math.cos(Math.abs(Ie-Math.PI)),xe.normalize().negate()):Re=Ve.length()*Math.cos(Ie),xe.normalize().multiplyScalar(Re),Se=(new u.Vector3).addVectors(Ne.clone(),xe.clone())}var ke=Se.clone().sub(y.clone());if(h=b=Se.clone().add(ke.clone()).multiplyScalar(.5),d=ke.clone(),g=Se.clone(),f){var Fe=(new u.Plane).setFromNormalAndCoplanarPoint(Me.normal.clone().normalize(),g.clone());Me=Fe.clone(),T=Fe.projectPoint(T.clone()),D=Fe.projectPoint(D.clone()),i=T.clone(),r=D.clone()}p=r.equals(Se.clone())?Q.clone():r.clone().sub(Se.clone());var Oe={firstLimit:void 0,secondLimit:void 0},Be=this,Ue=function(e,t){Oe={firstLimit:void 0,secondLimit:void 0};var i,n,r=(new u.Vector3).crossVectors(e.normal.clone(),p.clone().normalize()),a=(new u.Vector3).crossVectors(r.clone(),p.clone().normalize()).clone().angleTo(e.normal.clone());(o.isZero(0-a)||o.isZero(Math.PI-a))&&(1===t?(i=Be._sMeasurable1,n=d):2===t&&(i=Be._sMeasurable2,n=g),0!==(Oe=i.getLimitPoints(Me.normal.clone(),n.clone())).returnCode&&(Oe=f||O?i.getExtremityProjPointsOnPlane(Me):i.getLimitGeometryPointsLocatedOnLine(Q.clone(),n.clone())))};if(w)Ue(m,1),j=void 0===Oe.firstLimit||void 0===Oe.secondLimit||Oe.firstLimit.equals(Oe.secondLimit)?[T.clone(),T.clone()]:[Oe.firstLimit,Oe.secondLimit],A.push({attribute:"lFirstExtensionPoints",value:j}),Ue(v,2),Y=void 0===Oe.firstLimit||void 0===Oe.secondLimit||Oe.firstLimit.equals(Oe.secondLimit)?[D.clone(),D.clone()]:[Oe.firstLimit,Oe.secondLimit],A.push({attribute:"lSecondExtensionPoints",value:Y});else if(M||S){if(I===t.ViewedType.INFPLANE)Ue(E,1),j=void 0===Oe.firstLimit||void 0===Oe.secondLimit||Oe.firstLimit.equals(Oe.secondLimit)?[T.clone(),T.clone()]:[Oe.firstLimit,Oe.secondLimit],A.push({attribute:"lFirstExtensionPoints",value:j});else if(I===t.ViewedType.CURVE&&x===a.GeometryType.LINE){var Ge=Q.clone().angleTo(_.clone());j=o.isZero(0-Ge)||o.isZero(Math.PI-Ge)?[C.beginPoint.clone(),C.endPoint.clone()]:[T.clone(),T.clone()],A.push({attribute:"lFirstExtensionPoints",value:j})}else I===t.ViewedType.POINT&&(j=[this._sMeasurable1.getSelPoint().clone(),this._sMeasurable1.getSelPoint().clone()],A.push({attribute:"lFirstExtensionPoints",value:j}));if(k===t.ViewedType.INFPLANE)Ue(E,2),Y=void 0===Oe.firstLimit||void 0===Oe.secondLimit||Oe.firstLimit.equals(Oe.secondLimit)?[D.clone(),D.clone()]:[Oe.firstLimit,Oe.secondLimit],A.push({attribute:"lSecondExtensionPoints",value:Y});else if(k===t.ViewedType.CURVE&&V===a.GeometryType.LINE){var ze=Q.clone().angleTo(_.clone());Y=o.isZero(0-ze)||o.isZero(Math.PI-ze)?[C.beginPoint.clone(),C.endPoint.clone()]:[D.clone(),D.clone()],A.push({attribute:"lSecondExtensionPoints",value:Y})}else k===t.ViewedType.POINT&&(Y=[this._sMeasurable2.getSelPoint().clone(),this._sMeasurable2.getSelPoint().clone()],A.push({attribute:"lSecondExtensionPoints",value:Y}))}}}else{var He=this._sMeasurable2.getSelPoint();b=He.clone(),h=He.clone(),T=He.clone(),D=He.clone(),d=He.clone(),g=He.clone(),p=W.up.clone().normalize()}}else{let t,i=c?c.dimensionPosition:void 0,r=c?c.secondSelPoint:void 0;var Je=s.getDistanceFromPixel(this._viewer,T,e,this._frmWindow),qe=o.areEqual(T,D,"Vector3"),Ze=s.getViewpointInfo(this._viewer.currentViewpoint);let y=!1,m=!1;if(l){var Xe=(p=l.clone().normalize()).angleTo(Ze.sight.clone().negate());Xe>Math.PI/2&&(Xe=Math.abs(Xe-Math.PI));var We=(L=D,R=p,N=T.clone().sub(L).normalize(),(new u.Vector3).crossVectors(N,R)),je=We.angleTo(Ze.sight.clone().negate());je>Math.PI/2&&(je=Math.abs(je-Math.PI)),je>Xe&&(p=We,m=!0),i&&(y=!0),A.push({attribute:"iExtensionLinesManipulable",value:0})}else{var Ye;if(qe)p=Ze.up.clone();else if("Distance"!==this.getAttribute("sDistanceType")||(x!==a.GeometryType.LINE||V!==a.GeometryType.PICKINGPT&&V!==a.GeometryType.POINT)&&(V!==a.GeometryType.LINE||x!==a.GeometryType.PICKINGPT&&x!==a.GeometryType.POINT))p=function(e,t,i){var n=e.clone().sub(t).normalize(),r=(new u.Vector3).crossVectors(n,i);return o.isZero(r.length())&&(r=Ze.up.clone()),r}(T,D,Ze.sight);else Ye=x===a.GeometryType.LINE?this._sMeasurable1.getPoints():this._sMeasurable2.getPoints(),p=Ye.endPoint.clone().sub(Ye.beginPoint)}let v;if(p.normalize(),y)if(this._sMeasurable2&&(v=this._sMeasurable2.getSightRay()),v||(v=n.getSightDirfor3DPoint(this._viewer,r.clone()),v||(v=Ze.sight.clone())),m&&!qe){let e=D.clone().sub(T.clone()),i=(new u.Vector3).crossVectors(e.normalize(),p),n=P.computeLinePlaneDistance(r.toArray(),v.toArray(),D.toArray(),i.toArray());if(n&&0===n.returnCode&&(t=new u.Vector3(n.aPosition[0],n.aPosition[1],n.aPosition[2]),n=P.computePointLineDistance(t.toArray(),D.toArray(),e.toArray()),0===n.returnCode&&n&&0===n.returnCode&&n.distance)){let e=new u.Vector3(n.aPosition[0],n.aPosition[1],n.aPosition[2]),i=(p=t.clone().sub(e)).length();p.normalize(),isNaN(i)||(Je=i)}}else{let e=(p=i.clone().sub(D.clone())).length();p.normalize(),isNaN(e)||(Je=e)}var Qe=p.clone().multiplyScalar(Je);if(!y&&Qe.dot(Ze.up)<0&&Qe.negate(),qe?(d=T.clone(),g=D.clone(),b=(h=d.clone().add(g).multiplyScalar(.5)).clone().add(Qe)):(d=T.clone().add(Qe),g=D.clone().add(Qe),b=(h=d.clone().add(g).multiplyScalar(.5)).clone()),y&&r){let e=g.clone().sub(d);if(m&&t){let i=t.clone().sub(h).length();i>e.length()/2&&(b=h.clone().add(e.clone().normalize().multiplyScalar(i)))}else{v||(v=n.getSightDirfor3DPoint(this._viewer,r.clone()),v||(v=Ze.sight.clone()));var Ke=P.computeTwoLinesDistance(g.toArray(),v.toArray(),r.toArray(),v.toArray());if(Ke&&0===Ke.returnCode&&(Ke.relationship===a.Relationship.PARRALLEL||Ke.relationship===a.Relationship.COINCIDENT)){let t=new u.Vector3(Ke.aPosition2[0],Ke.aPosition2[1],Ke.aPosition2[2]).clone().sub(h).length();t>e.length()/2&&(b=h.clone().add(e.clone().normalize().multiplyScalar(t)))}}}}A.push({attribute:"vExtensionDirection3D",value:p}),A.push({attribute:"vFirstExtensionPoint3D",value:T.clone()}),A.push({attribute:"vSecondExtensionPoint3D",value:D.clone()});var $e=s.getDistanceFromPixel(this._viewer,T.clone(),.1,this._frmWindow);T.equals(d)&&(d=d.clone().add(p.clone().normalize().multiplyScalar($e))),D.equals(g)&&(g=g.clone().add(p.clone().normalize().multiplyScalar($e))),A.push({attribute:"vFirstPoint3D",value:d}),A.push({attribute:"vSecondPoint3D",value:g}),A.push({attribute:"vLeaderBreakPoint3D",value:b}),A.push({attribute:"vLeaderPointingPoint3D",value:h}),this.set(A)},onViewerEventCB:function(e){if(this.getNode()&&this.getNode().onViewerEventCB){if("beginExplodeCmd"===e.eventType||"endExplodeCmd"===e.eventType){var t=this._viewer.getVisibleSpace();this._bCreateMeasureInShowSpace===t&&this.setVisibleFlag("endExplodeCmd"===e.eventType)}this.getNode().onViewerEventCB(e)}},isPartialMeasure:function(){return this._partialMeasure},setPartialMeasure:function(e){if(this._partialMeasure!==e){this._partialMeasure=e;var t=[];if(t.push({name:"sFontStyle",value:"normal"}),t.push({name:"bIsFilled",value:!0}),t.push({name:"bHasBorder",value:!1}),t.push({name:"fLineStyleThicknessIndex",value:0}),t.push({name:"sLineStylePattern",value:"1"}),t.push({name:"fLeaderStyleThicknessIndex",value:0}),t.push({name:"sLeaderStylePattern",value:"1"}),this._partialMeasure){var i=1;t.push({name:"cFillStyleColor",value:new u.Color("#ff8a2e")}),t.push({name:"cLineStyleColor",value:new u.Color("#8f4c00")}),t.push({name:"cLeaderStyleColor",value:new u.Color("#8f4c00")}),"partialCmd"===this._partialMeasure?(i=.4,t.push({name:"cFontColor",value:new u.Color("#e5e5e5")})):t.push({name:"cFontColor",value:new u.Color("#ffffff")}),t.push({name:"fOpacity",value:i})}else t.push({name:"cFontColor",value:new u.Color("#ffffff")}),t.push({name:"cFillStyleColor",value:new u.Color("#368ec4")}),t.push({name:"cLineStyleColor",value:new u.Color("#3d3d3d")}),t.push({name:"cLeaderStyleColor",value:new u.Color("#3d3d3d")}),t.push({name:"fOpacity",value:1});this.setAttributes(t),this.refreshNode()}},_removeAttribute:function(e){if(e&&e.length>0)for(var t=0;t<e.length;t++)this.getAttribute(e[t])&&(delete this["_"+e[t]],null)},movePosDownByPixels:function(e){if(e&&e.position&&e.pixels){var t=s.getDistanceFromPixel(this._viewer,e.position.clone(),e.pixels),i=this._viewer.currentViewpoint.getUpDirection();return i=(i=i.normalize()).multiplyScalar(-t),(new u.Vector3).addVectors(e.position.clone(),i)}},getCustoListAsPerMainValue:function(e){var t=[],i=this._sMeasurable1.getPoints();switch(e){case"Coordinates":case"Axis":t.push("selection","computationMode");break;case"Curve_Length":t.push("point1","point2","selection","computationMode");break;case"Line_Length":case"Thickness":t.push("point1","point2","direction","selection","computationMode");break;case"Arc_Length":t.push("point1","point2","radius","diameter","selection","computationMode");break;case"Cylinder_Length":t.push("point1","point2","direction","radius","diameter","area","centerOfGravity","selection","computationMode");break;case"Cone_Length":t.push("point1","point2","direction","angle","halfAngle","apex","minRadius","maxRadius","minDiameter","maxDiameter","area","centerOfGravity","selection","computationMode");break;case"Distance":case"Min_Distance":case"Max_Distance":t.push("point1","point2","components","direction","selection1","selection2","computationMode");break;case"Angle_Btw2Selections":t.push("center","selection1","selection2","computationMode");break;case"Angle_By3Pts":t.push("point1","point2","center","computationMode");break;case"Cone_Angle":case"Half_Angle":t.push("point1","point2","length","direction","apex","MinimumRadius","MaximumRadius","MinimumDiameter","MaximumDiameter","area","centerOfGravity","selection","computationMode");break;case"Radius":case"Diameter":t.push("center","arcLength","circlePerimeter","selection","computationMode");break;case"Cylinder_Radius":case"Cylinder_Diameter":t.push("point1","point2","length","direction","area","centerOfGravity","selection","computationMode");break;case"Sphere_Radius":case"Sphere_Diameter":t.push("center","area","selection","computationMode");break;case"Radius_By3Pts":case"Diameter_By3Pts":t.push("point1","point2","point3","center","computationMode");break;case"Min_Radius":case"Max_Radius":case"Min_Diameter":case"Max_Diameter":var n;t.push("point1","point2","length","direction","angle","halfAngle","apex"),"Min_Radius"===e?n="MaximumRadius":"Max_Radius"===e?n="MinimumRadius":"Min_Diameter"===e?n="MaximumDiameter":"Max_Diameter"===e&&(n="MinimumDiameter"),t.push(n),t.push("area","centerOfGravity","selection","computationMode");break;case"Surface_Area":t.push("centerOfGravity","selection","computationMode");break;case"PlanarSurface_Area":t.push("centerOfGravity","equation","selection","computationMode");break;case"Product_Area":void 0===this.getAttribute("fArea")&&void 0!==this.getAttribute("fLength")?(void 0!==i.beginPoint&&void 0!==i.endPoint&&t.push("point1","point2"),t.push("selection","computationMode")):void 0!==this.getAttribute("fArea")?t.push("volume","centerOfGravity","selection","computationMode"):t.push("selection","computationMode");break;case"Volume":void 0===this.getAttribute("fArea")&&void 0!==this.getAttribute("fLength")?(t.push("length"),void 0!==i.beginPoint&&void 0!==i.endPoint&&t.push("point1","point2"),t.push("selection","computationMode")):t.push("area","centerOfGravity","selection","computationMode")}return t},setCustomizationToMeasure:function(e){var t,i=this.getCustoListAsPerMainValue(this._sMainValueType),n=[],r=i.length;if(e&&e.length>0)for(t=0;t<r;t++)n[t]={custoName:i[t],custoValue:e[t]};else for(t=0;t<r;t++)n[t]={custoName:i[t],custoValue:!0};this.setAttribute("lCustomization",n)}})}));