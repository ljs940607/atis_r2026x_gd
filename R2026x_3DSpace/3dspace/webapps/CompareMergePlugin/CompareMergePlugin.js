define("DS/CompareMergePlugin/NodeUtils",["DS/CompareWidget2/support/cw2Utils"],(function(e){"use strict";return{nodeHas3DPartUsage:function(e){var t=!1,o=e.getAttr("attribute[PLMEntity.V_usage]");return o&&"3DPart"===o&&(t=!0),t},nodeIs3DShapeWith3DPartUsage:function(e){var t=!1;"3DShape"===e.getAttr("type")&&(this.nodeHas3DPartUsage(e)&&(t=!0));return t},nodeIsOnceInstantiable:function(e){return"TRUE"===e.getAttr("attribute[PLMCoreRepReference.V_isOnceInstantiable]")},nodeIsConsideredAggregated:function(e){var t=!1,o=this.nodeIsOnceInstantiable(e),n="TRUE"===e.getAttr("attribute[XCADEmbeddedCmp.V_IsEmbeddedComponent]"),i="TRUE"===e.getAttr("type.kindof[BundleFastenerAbstract]"),r=this.nodeIs3DShapeWith3DPartUsage(e);return(o||r||n||i)&&(t=!0),t},nodeFollowsParent:function(e){var t=e.getAttr("followsParent");if(void 0!==t)return t;t=!1;var o=!1,n=e.getParent();return n&&(o=this.nodeFollowsParent(n)),(o||this.nodeIsConsideredAggregated(e))&&(t=!0),e.addAttr("followsParent",t),t},nodeIsRevisionable:function(e){var t=e.getAttr("last.current.majorrevisionable");return void 0===t&&(t=e.getAttr("last.current.revisionable")),"TRUE"===t},nodeHasReviseAccess:function(t){var o=t.getAttr("majorid.lastmajorid.bestsofar.current.access[majorrevise]");if(o&&"FALSE"===o&&"TRUE"===t.getAttr("last.current.revisionable")&&(o=t.getAttr("majorid.lastmajorid.bestsofar.current.access[revise]")),!o){var n=t.getAttr("title");n||(n="-No Title-"),e.warnout("No revise access info available when requested for '"+n+"'")}return"TRUE"===o},nodeIsMergeable:function(t){var o=t.getAttr("isMergeSupported");if(null==o){var n=t.getAttr("title");n||(n="-No Title-"),e.warnout("No isMergeSupported info available when requested for '"+n+"'"),o=!0}return o},nodeCanBeRevised:function(e){return this.nodeHasReviseAccess(e)&&this.nodeIsRevisionable(e)},nodeCanBeOverwritten:function(e){return!this.nodeIsDocument(e)&&(this.nodeIsMergeable(e)||this.nodeIsComposee(e))},nodeIsModified:function(e){return this.nodeHasModifiedRef(e)||this.nodeHasModifiedInst(e)},nodeHasModifiedRef:function(e){return this._nodeHasAdjFlag(e,"REF_MODIFIED")||this._nodeHasAdjFlag(e,"PUB_MODIFIED")||this._nodeHasAdjFlag(e,"MAT_MODIFIED")},nodeHasModifiedInst:function(e){return this._nodeHasAdjFlag(e,"INST_MODIFIED")},nodeHasModifiedChild:function(e){var t=this,o=!1,n=e.getChildArray();for(const e of n){if(t.nodeHasModifiedRef(e)){o=!0;break}if(t.nodeIsCollectorType(e)&&t.nodeHasModifiedChild(e)){o=!0;break}}return o},nodeIsDocument:function(e){var t="TRUE"===e.getAttr("type.kindof[PLMDMTDocument]"),o="TRUE"===e.getAttr("type.kindof[DOCUMENTS]");return!(!t&&!o)},nodeIsPLMPort:function(e){var t="TRUE"===e.getAttr("type.kindof[PLMPort]"),o="Port"===e.getAttr("INST.expand::subType");return!(!t&&!o)},nodeIsConnectionInstance:function(e){return"Connection"===e.getAttr("INST.expand::subType")},nodeIsPLMConnection:function(e){var t="TRUE"===e.getAttr("type.kindof[PLMConnection]"),o=this.nodeIsConnectionInstance(e);return!(!t&&!o)},nodeIsPortOrConnection:function(e){return this.nodeIsPLMPort(e)||this.nodeIsPLMConnection(e)},nodeIsComposee:function(e){var t=this.nodeIsPLMPort(e),o=this.nodeIsPLMConnection(e);return!(!t&&!o)},nodeIsCollectorType:function(e){let t=!1;if(e){let o=e.getAttr("type");o&&"relations"==o&&(t=!0)}return t},_nodeHasAdjFlag:function(e,t){var o=!1,n=e.getMatchInfo();if(n){var i=n.getAdjFlagArray();null!=i&&i.findIndex((e=>e==t))>-1&&(o=!0)}return o},_nodeHasStatus:function(e,t){var o=!1,n=e.getMatchInfo();if(n){var i=n.getAllStatusArray(!1);null!=i&&i.findIndex((e=>e==t))>-1&&(o=!0)}return o},nodeIsUnrelated:function(e){return this._nodeHasStatus(e,"UNRELATED")},nodeIsDuplicate:function(e){return this._nodeHasStatus(e,"DUPE")},nodeIsReplaced:function(e){return this._nodeHasStatus(e,"REPLACED")},nodeIsOnReplacedBranch:function(e){for(var t=!1;e&&!t;)t=this.nodeIsReplaced(e),e=e.getParent();return t},nodeIsLeftOnly:function(e){return this._nodeHasStatus(e,"LEFT_ONLY")},nodeIsRightOnly:function(e){return this._nodeHasStatus(e,"RIGHT_ONLY")},nodeIsLeftOnlyOrRightOnly:function(e){return this.nodeIsLeftOnly(e)||this.nodeIsRightOnly(e)},nodeHasLeftOnlyOrRightOnlyChild:function(e){var t=!1,o=e.getChildArray();for(const e of o)if(this.nodeIsLeftOnlyOrRightOnly(e)){t=!0;break}return t},nodeHasLeftOnlyChild:function(e){var t=!1,o=e.getChildArray();for(const e of o)if(this.nodeIsLeftOnly(e)){t=!0;break}return t},getNodeDefaultBranchIntent:function(e){var t="S",o=e.getAttr("intents");return o&&Array.isArray(o)&&o.length>0&&(t=o[0],o.length>1&&o.includes("D")&&(t="D")),t}}})),define("DS/CompareMergePlugin/MERGE_STRUCT_NAVIGATE_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/STRUCTURE/expanders/lifecycleServicesNavigate","DS/LifecycleServices/Utils"],(function(e,t,o){"use strict";const n=Object.freeze({Publish:4,CATMaterialToReferenceLink:10,CATMaterialMadeOfLink:11});return e.extend({init:function(e,t,o,n){this._parent(e,t,o,n),this._useIndex=!0},onEnabled:function(){return this.syncSetting("mergeSettings.dataSource.useIndex","_useIndex",null),this._parent()},execute:function(e,i){let r=this;r._parent(e,i);let a=i.NAVIGATE_ENABLED,s=o.urlHasParam("mergeSettings")||o.urlHasParam("mergeSettingsEX");if(!a&&!s)return void r.reportOK(e);let c=e,l=Array.from(function(e){let t=new Set;return e.forEach((function(e){e.visit_riTreeAndFN((function(e){let o=e.getAttr("INST.ds6w:type");if(o&&("VPLMrel/PLMPort/V_Owner"===o||"VPLMrel/PLMConnection/V_Owner"===o)){let o=e.getAttr("REF.physicalid");o&&t.add(o)}return!0}))})),t}(c));if(0==l.length)return void r.reportOK(e);let d=c[0].getObjIDSpec(),g=d.getTenant(),u=d.getServiceName(),p=d.getSecurityContext(),_=r._useIndex?"LC_IDX_SERVICE":"LC_AUTH_SERVICE";t.doNavigate(l,_,g,p,u,r._plugSvcs,i).then((function(e){if(null!=e){let t=c;!function(e,t){if(!e)return;const o=new Map;for(const t of e){let e=null,n=t.owner.physicalid;o.has(n)?e=o.get(n):(e=new Array,o.set(n,e)),e.push(t)}0!=o.size&&t.forEach((function(e){e.visit_riTreeAndFN((function(e){let t=e.getAttr("REF.physicalid");if(t){let i=o.get(t);i&&i.forEach((function(t){t.role===n.CATMaterialToReferenceLink?(e.setAttr("REF.Title",t.owner.elements[0]["ds6w:label"]),e.setAttr("REF.ds6w:label",t.owner.elements[0]["ds6w:label"])):t.role!==n.Publish&&t.role!==n.CATMaterialMadeOfLink||e.setAttr("REF.linkedElements",t.owner.elements),t.owner?.slave_of&&e.setAttr("REF.slave_of",t.owner.slave_of)}))}return!0}))}))}(e,t);let o=t;r.reportOK(o)}else r.reportKO("FAILURE performing struct navigate: 'null navigated returned'")}),(function(e){r.reportKO("FAILURE performing struct navigate: "+e)}))}})})),define("DS/CompareMergePlugin/MERGE_STRUCT_FETCH_plugin",["DS/CompareWidget2/plugins/STRUCTURE/STRUCT_FETCH_plugin","DS/CompareWidget2/userSettings/UserSettingsManager"],(function(e,t){function o(e,t){}return e.extend({init:function(e,t,o,n){this._parent(e,t,o,n)},onEnabled:function(){return this.syncSetting("mergeSettings.dataSource.useIndex","_useIndex",o.bind(this)),o.bind(this)(this._useIndex,!0),!0}})})),define("DS/CompareMergePlugin/Action",[],(function(){"use strict";return class{constructor(e,t,o){this.actionOption=e,this.isSelected=t,this.isEnabled=o,this.postAdded=!1}}})),define("DS/CompareMergePlugin/COLLECT_NODES_plugin",["DS/CompareWidget2/plugins/plugin","i18n!DS/CompareMergePlugin/assets/nls/MergePlugin","WebappsUtils/WebappsUtils"],(function(e,t,o){return e.extend({init:function(e,t,n,i){this._parent(e,t,n,i),this._webappsBaseUrl=o.getWebappsBaseUrl(),this._publicationsIconsUrl=this._webappsBaseUrl+"CompareMergePlugin/assets/icons/I_PLMPortsFolder.png"},onEnabled:function(){return this._parent()},execute:function(e,t){let o=this;o._parent(e,t);let n=e;t.COLLECTOR_ENABLED&&o._augmentTree(n,t),o.reportOK(n)},_augmentTree:function(e,o){let n=this,i=o.COLLECTION_NODES,r=new Array,a=new Map;i.forEach((function(e){let t=Object.assign({},e);t.pubFoldersByParentNode=new Map,t.parent2collector=new Map,t.collector2collected=new Map,t.parent2removedInstances=new Map,r.push(t),e.COLLECTTYPES.forEach((function(e){a.set(e,t)}))})),e.forEach((function(e){e.visit_riTreeAndFN((function(e){let o=e.getAttr("INST.physicalid"),i=e.getAttr("REF.ds6w:type");if(i&&a.has(i)){let r=a.get(i);if(riParent=e.getParent(),riParent){let i=riParent.getAttr("REF.physicalid"),a=riParent.getAttr("REF.versionid"),s=riParent.isRoot()?"9999":riParent.getAttr("INST.physicalid"),c=r.PIDPREFIX,l=c+i,d=c+a,g=c+s,u=null;if(r.pubFoldersByParentNode.has(riParent))u=r.pubFoldersByParentNode.get(riParent);else{console.log("###COLLECT:Making a collector node under "+riParent.getAttr("REF.ds6w:label")),u=e.makeDupe(),u.setAttr("REF.physicalid",l),u.setAttr("REF.versionid",d),u.setAttr("INST.physicalid",g),u.setAttr("REF.ds6w:label",t.get(r.LABELNLS)),u.setAttr("REF.ds6w:type","relations");let o=n._webappsBaseUrl+r.ICONPATH;u.setAttr("REF.typeIcons",{smallURL:o}),r.ATTRIBUTES.forEach((function(e){u.setAttr(e.NAME,e.VALUE)})),r.parent2collector.set(riParent,u),r.pubFoldersByParentNode.set(riParent,u)}let p=null;r.parent2removedInstances.has(riParent)?p=r.parent2removedInstances.get(riParent):(p=new Set,r.parent2removedInstances.set(riParent,p)),p.add(o);let _=null;r.collector2collected.has(u)?_=r.collector2collected.get(u):(_=new Set,r.collector2collected.set(u,_)),Array.from(_).find((e=>e.getAttr("INST.physicalid")===o))?console.log("###COLLECT:Found node to collect, but "+e.getAttr("REF.Title")+" has already been collected"):_.add(e)}}return!0}))})),r.forEach((function(e){e.parent2collector.forEach((function(e,t){t.addChild(e)})),e.parent2removedInstances.forEach((function(e,t){e.forEach((function(e){t.rmChild(e)}))})),e.collector2collected.forEach((function(e,t){e.forEach((function(e){t.addChild(e),e.setParent(t,!0)}))}))}))}})})),define("DS/CompareMergePlugin/userSettings/Merge",["UWA/Core","DS/CompareWidget2/userSettings/SettingsBase","i18n!DS/CompareWidget2/assets/nls/CompareV2"],(function(e,t,o){"use strict";var n=e.extend(t,{namespace:"",mergeSettings:{dataSource:{useIndex:{value:!1,widgetSetting:{type:"boolean",label:o.useIndex,defaultValue:!1}}}},viewSettings:{INSTANCE_VIEW:e.extend(e.clone(t.viewSettings.PROP_VIEW,!0),{attributes_display_option:{value:"",V1Preference:"compare_attributes_display_option_INST"},attributes_not_shown:{value:"",V1Preference:"compare_attributes_not_shown_INST"}}),STRUCT_VIEW:{display_mode:{value:"tree"},statuses_to_hide:{value:[]},statuses_unchecked:{value:[]}},MERGE_STRUCT_VIEW:{hideAggregated3DShapes:{value:!0},copyTitleFromSource:{value:!1},warningNoRevise:{value:!1},createARevision:{value:!1},maturityColumnVisible:{value:!0},instanceTitleColumnVisible:{value:!1},useMergeCombine:{value:!1},showPorts:{value:!1},showConnections:{value:!1}},PAD3D_VIEW:{view3D:{isolate:{value:!0,V1Preference:{viewer_display_mode:[{oldValue:"isolate",newValue:!0},{oldValue:"select",newValue:!1}]},widgetSetting:{type:"boolean",label:o.viewerIsolate,defaultValue:!1}}}}}},!0);return n.exportSettings={},n})),define("DS/CompareMergePlugin/MaturityUtils",[],(function(){"use strict";return{createCSSClass:function(e,t,o){if(null===document.getElementById(e)){var n=document.createElement("style");n.type="text/css",n.id=e;let i=o||"."+e;n.innerHTML=i+t,document.getElementsByTagName("head")[0].appendChild(n)}},cleanStatusForCSS:function(e){return e.replace(/(\.| )/g,"-")},getMaturityClass:function(e,t){return"lc-status-"+this.cleanStatusForCSS(e)+(t?"-withClass":"")},addCSSMaturityClasses:function(e,t){var o=this;void 0!==e&&e.forEach((function(e){let n=e.policyName;e.states.forEach((function(e){let i=e.activeColor,r="{color:"+("#FFFFFF"===i?"#000000":"#FFFFFF")+" ; background-color:"+i+";}",a=o.cleanStatusForCSS(e.stateSysName),s="lc-status-"+o.cleanStatusForCSS(n)+"-"+a+(t?"-withClass":""),c="."+s+(t?" ."+t:"");o.createCSSClass(s,r,c)}))}))}}})),define("DS/CompareMergePlugin/ViewDefModules/MergeViewDefs",["DS/CompareWidget2/ViewDefModules/DefaultViewDefs_V2","DS/CompareWidget2/ViewDefModules/DSColors"],(function(e,t){const o=e.STRUCT_DISPLAY_OPTIONS.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR,n=e.STRUCT_DISPLAY_OPTIONS.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR;var i=UWA.clone(e,!0);i.CV_PROPS.REF_UPDATESTAMP="REF.updatestamp",i.CV_PROPS.REF_FUNCNAME="REF.bo.LPAbstractPort.V_FunctionalName",i.CV_PROPS.INST_UPDATESTAMP="INST.updatestamp",i.CV_PROPS.INST_TYPE="INST.ds6w:type",i.DB_PROPS.INST_TYPE="INST.type",i.STRUCT_DISPLAY_OPTIONS.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR=o,i.STRUCT_DISPLAY_OPTIONS.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR=n;var r={colorLeft:o,colorRight:n},a=i.INST_ATTR_DISPLAY_OPTIONS;a.colorLeft=r.colorLeft,a.colorRight=r.colorRight;var s=i.STRUCT_DISPLAY_OPTIONS;s.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR=o,s.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR=n,s.COLOR_ACTION=t.colorDef.GREY1,s.COLOR_RESULT=t.colorDef.GREY1,s.COMPARE_CONTEXT_MENU_PLUGIN=s.CONTEXT_MENU_PLUGIN,s.CONTEXT_MENU_PLUGIN="DS/CompareMergePlugin/ViewPanel/mergeDefaultContextMenu",s.COLLAPSE_3DPARTS=!1,s.COMMAND_NAME="merge",s.CUSTOM_RULE_ID_FLAGS.FUNCNAME_MATCH={COLOR:t.colorDef.GREY2,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"FUNCNAMEMATCH"},s.CUSTOM_RULE_ID_FLAGS.KEY_MATCH={COLOR:t.colorDef.GREY2,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"KEYMATCH"},s.CUSTOM_MATCH_ADJ_FLAGS={REF_MODIFIED:{COLOR:t.colorDef.PURPLE,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"REFMODIFIED"},INST_MODIFIED:{COLOR:t.colorDef.BLUE6,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"INSTMODIFIED"},PUB_RENAMED:{COLOR:t.colorDef.GREY3,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"PUBRENAMED"},PUB_MODIFIED:{COLOR:t.colorDef.RED2,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"PUBMODIFIED"},MAT_MODIFIED:{COLOR:t.colorDef.RED2,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"MATMODIFIED"}},s.BUBBLE_FLAGS={CHILD_MODIFIED:{COLOR:t.colorDef.BLUE2,TOOLTIP_MODULE_PATH:"CompareWidget2/Tooltips",NLS:"CHILDMODIFIED"}},s.SHOW_HIDE_NODE_PARAMS=[{NAME:"SHOW_HIDE_PORT",CHILD:{TYPE:["PLMPort"]},SHOW:"viewSettings.MERGE_STRUCT_VIEW.showPorts"},{NAME:"SHOW_HIDE_PUBS_FOLDER",CHILD:{TYPE:["relations"],ATTRIBUTES:{"REF.CollectorNodeType":"Publications"}},SHOW:"viewSettings.MERGE_STRUCT_VIEW.showPorts"},{NAME:"SHOW_HIDE_CONNECTION",CHILD:{TYPE:["PLMConnection","CATMatReference"]},SHOW:"viewSettings.MERGE_STRUCT_VIEW.showConnections"},{NAME:"SHOW_HIDE_MATS_FOLDER",CHILD:{TYPE:["relations"],ATTRIBUTES:{"REF.CollectorNodeType":"Materials"}},SHOW:"viewSettings.MERGE_STRUCT_VIEW.showConnections"},{NAME:"SHOW_HIDE_3DSHAPE_OF_3DPART",CHILD:{TYPE:["3DShape"]},PARENT:{TYPE:["VPMReference"],ATTRIBUTES:{[`${i.CV_PROPS.USAGE}`]:"3DPart"}},SHOW:"viewSettings.STRUCT_VIEW.show_3dshape_of_3dpart"}];var c=UWA.clone(e.STRUCT_FETCH_OPTIONS,!0);c.CV_PROPS=i.CV_PROPS,c.DATA_SOURCE="LC_IDX_SERVICE",c.COMMAND_CONTEXT="merge";var l=UWA.clone(e.STRUCT_COMPARE_OPTIONS,!0);l.PROPS=UWA.clone(i.CV_PROPS,!0),l.PROPS.REF_COLLECTORNODETYPE="REF.CollectorNodeType",l.COMPUTE_DIFFERENT=!1,l.CUSTOM_RELATIONSHIP_NAMES=["IDENTICAL","FUNCNAME_MATCH","REVISION","BRANCH","DUPE","REPLACED"],l.CUSTOM_COMPARISONS={COMP_PHYSID:[["PHYSICALID","PHYSICALID"],["EQ","N/A","NEQ","NEQ","NEQ","NEQ"]],COMP_VERID:[["VERSIONID","VERSIONID"],["EQ","N/A","EQ","NEQ","NEQ","NEQ"]],COMP_REF_LOGID:[["REF_LOGID","REF_LOGID"],["EQ","N/A","EQ","EQ","NEQ","NEQ"]],COMP_DFR:[["DFR","DFR"],["N/A","N/A","N/A","N/A","EQ","NEQ"]],COMP_FUNCNAME:[["REF_FUNCNAME","REF_FUNCNAME"],["N/A","EQ","N/A","N/A","N/A","N/A"]],COMP_INST_LOGID:[["INST_LOGID","INST_LOGID"],["N/A","N/A","N/A","N/A","N/A","EQ"]]},l.CUSTOM_MATCH_ADJUSTMENTS=[{NAME:"NON_MATCHING_INSTANCE",PROPS:["INST_LOGID","INST_LOGID"],FLAG_ON:"NEQ",IS_VISIBLE:!1,MATCH_ADJ:-1},{NAME:"REF_MODIFIED",PROPS:["REF_UPDATESTAMP","REF_UPDATESTAMP"],CONDITIONS:{TYPE:["PLMReference"]},FLAG_ON:"NEQ",MATCH_ADJ:0},{NAME:"INST_MODIFIED",PROPS:["INST_UPDATESTAMP","INST_UPDATESTAMP"],CONDITIONS:{TYPE:["VPMReference","VPMRepReference"]},FLAG_ON:"NEQ",MATCH_ADJ:0},{NAME:"PUB_RENAMED",PROPS:["REF_FUNCNAME","REF_FUNCNAME"],CONDITIONS:{TYPE:["VPMPort"]},FLAG_ON:"NEQ",MATCH_ADJ:0},{NAME:"PUB_MODIFIED",PROPS:["REF_UPDATESTAMP","REF_UPDATESTAMP"],CONDITIONS:{TYPE:["VPMPort"]},FLAG_ON:"NEQ",MATCH_ADJ:0},{NAME:"MAT_MODIFIED",PROPS:["REF_UPDATESTAMP","REF_UPDATESTAMP"],CONDITIONS:{TYPE:["CATMatConnection"]},FLAG_ON:"NEQ",MATCH_ADJ:0}];var d={BUBBLE_UP_ENABLED:!0,BUBBLE_STATUS_CONFIG:[{BUBBLE_STATUS:"CHILD_MODIFIED",BUBBLE_TO:"FVP",CONDITIONS:{CHILD:{TYPE:["PLMPort","PLMConnection"],ON_STATUS:["REF_MODIFIED","PUB_MODIFIED","MAT_MODIFIED"]},PARENT:{TYPE:["VPMReference","VPMRepReference","relations"]}}},{BUBBLE_STATUS:"CHILD_MODIFIED",BUBBLE_TO:"FVP",CONDITIONS:{CHILD:{TYPE:["PLMReference"],ON_STATUS:["REF_MODIFIED","INST_MODIFIED"]},PARENT:{TYPE:["PLMReference"]}}},{BUBBLE_STATUS:"CHILD_MODIFIED",BUBBLE_TO:"FVP",CONDITIONS:{CHILD:{ON_STATUS:["LEFT_ONLY","RIGHT_ONLY"]},PARENT:{ON_STATUS:["BRANCH","DUPE","REVISION","FUNCNAME_MATCH","KEY_MATCH"]}}}]},g={COLLECTOR_ENABLED:!0,COLLECTION_NODES:[{COLLECTORTYPE:"Publications",LABELNLS:"Publications",ICONPATH:"CompareMergePlugin/assets/icons/I_PLMPortsFolder.png",NODETYPE:"relations",COLLECTTYPES:["VPMPort"],PIDPREFIX:"PubFolder_",ATTRIBUTES:[{NAME:"REF.CollectorNodeType",VALUE:"Publications"},{NAME:"REF.bo.LPAbstractPort.V_FunctionalName",VALUE:"Publications"}]},{COLLECTORTYPE:"Materials",LABELNLS:"Materials",ICONPATH:"CompareMergePlugin/assets/icons/I_MaterialContainer.png",NODETYPE:"relations",COLLECTTYPES:["dsc_mat_cnx_Core_Design","dsc_mat_cnx_Covering_Design"],PIDPREFIX:"MatFolder_",ATTRIBUTES:[{NAME:"REF.CollectorNodeType",VALUE:"Materials"},{NAME:"REF.bo.LPAbstractPort.V_FunctionalName",VALUE:"Materials"}]}]},u={MODE:"synchronize",PLUGIN_ENABLED:!0},p={MODE:"synchronize",PLUGIN_ENABLED:!0},_={MODE:"synchronize"};UWA.merge(i,{MERGE_DISPLAY_OPTIONS:s}),UWA.merge(i,{MERGE_STRUCT_FETCH_OPTIONS:c}),UWA.merge(i,{MERGE_STRUCT_COMPARE_OPTIONS:l}),UWA.merge(i,{MERGE_BUBBLE_OPTIONS:d}),UWA.merge(i,{MERGE_COLLECTOR_OPTIONS:g}),UWA.merge(i,{MERGE_COMPUTE_ACTIONS_OPTIONS:_});var E={View3DDisplay:{Path:"DS/CompareWidget2/plugins/VIEW3D/VIEW3D_DISPLAY_plugin",Options:s},AttrDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",Options:r},InstAttrDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",Options:a},MergeStructFetch:{Path:"DS/CompareMergePlugin/MERGE_STRUCT_FETCH_plugin",Options:c},MergeStructNavigate:{Path:"DS/CompareMergePlugin/MERGE_STRUCT_NAVIGATE_plugin",Options:{NAVIGATE_ENABLED:!1,COMMAND_CONTEXT:"merge"}},MergeStructCompare:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_COMPARE_plugin",Options:l},MergeStructComputeKeys:{Path:"DS/CompareMergePlugin/MERGE_COMPUTE_KEYS_plugin",Options:u},MergeStructCompare_Step2:{Path:"DS/CompareMergePlugin/MERGE_COMPARE_COMPOSEE_plugin",Options:p},MergeComputeActions:{Path:"DS/CompareMergePlugin/MERGE_COMPUTE_ACTIONS_plugin",Options:_},MergeBubbler:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_BUBBLER_plugin",Options:d},MergeStructDisplay:{Path:"DS/CompareMergePlugin/MERGE_STRUCT_DISPLAY_plugin",Options:s},MergeNewRevisionFrom:{Path:"DS/CompareMergePlugin/MERGE_NRF_plugin"},MergeMerge:{Path:"DS/CompareMergePlugin/MERGE_MERGE_plugin"},CollectNodes:{Path:"DS/CompareMergePlugin/COLLECT_NODES_plugin",Options:g}};UWA.extend(i.PLUGDEFS,E);UWA.extend(i.VIEWDEFS,{MERGE_STRUCT_VIEW:["MergeStructFetch","MergeStructNavigate","CollectNodes","MergeStructCompare","MergeStructComputeKeys","MergeStructCompare_Step2","StructListViewPrep","MergeBubbler","MergeComputeActions","MergeStructDisplay","MergeMerge"]});return UWA.extend(i.VIEWSETS,{MERGE_STANDARD:{ROW:["MERGE_STRUCT_VIEW",{COL:[["PROP_VIEW","INSTANCE_VIEW"],"PAD3D_VIEW"]}]},MERGE_AND_PROPS_HORIZ:{COL:["MERGE_STRUCT_VIEW","PROP_VIEW"]},MERGE_AND_PROPS_VERT:{ROW:["MERGE_STRUCT_VIEW","PROP_VIEW"]},MERGE_ONLY:{ROW:["MERGE_STRUCT_VIEW"]},MERGE_COMPARE_PROPS_INST:{ROW:[["MERGE_STRUCT_VIEW","STRUCT_VIEW"],["PROP_VIEW","INSTANCE_VIEW"]]},MERGE_PROPS_INST:{ROW:[["MERGE_STRUCT_VIEW"],["PROP_VIEW","INSTANCE_VIEW"]]}}),i})),define("DS/CompareMergePlugin/MergeConstants",[],(function(){"use strict";return{MergeAction:{Revise:"revise",Reuse:"reuse",Exclude:"exclude",InsertNew:"insertnew",ReuseReference:"reuse_reference",ReviseTarget:"revise_target",ReviseTargetTakeSource:"revise_target_take_source",OverwriteTarget:"overwrite_target",OverwriteTargetInstance:"overwrite_target_instance",DeleteTarget:"delete_target",IgnoreSource:"ignore_source",KeepTarget:"keep_target",KeepSource:"keep_source",AddToTarget:"add_to_target",ForMapping:"mapping"}}})),define("DS/CompareMergePlugin/ViewDefModules/MergeRFLViewDefs",["DS/CompareMergePlugin/ViewDefModules/MergeViewDefs"],(function(e){var t=UWA.clone(e,!0);return t.MERGE_STRUCT_FETCH_OPTIONS.DATA_SOURCE="LC_IDX_SERVICE",t.MERGE_DISPLAY_OPTIONS.COMMAND_NAME="nrf",t.MERGE_DISPLAY_OPTIONS.CUSTOM_MATCH_ADJ_FLAGS={},t.MERGE_DISPLAY_OPTIONS.BUBBLE_FLAGS={},t.MERGE_STRUCT_COMPARE_OPTIONS.CUSTOM_MATCH_ADJUSTMENTS=[],t.MERGE_COMPUTE_ACTIONS_OPTIONS.MODE="nrf",t.VIEWDEFS.MERGE_STRUCT_VIEW=["MergeStructFetch","MergeStructCompare","StructListViewPrep","MergeComputeActions","MergeStructDisplay","MergeNewRevisionFrom"],t.PLUGDEFS.MergeStructFetch.Options=t.MERGE_STRUCT_FETCH_OPTIONS,t.PLUGDEFS.MergeStructDisplay.Options=t.MERGE_DISPLAY_OPTIONS,t.PLUGDEFS.MergeStructCompare.Options=t.MERGE_STRUCT_COMPARE_OPTIONS,t.PLUGDEFS.MergeComputeActions.Options=t.MERGE_COMPUTE_ACTIONS_OPTIONS,t})),define("DS/CompareMergePlugin/CRNodeUtils",["DS/CompareMergePlugin/NodeUtils"],(function(e){"use strict";return{getBaseRefPidFromCRNode:function(e){return e?e.getMatchInfo().getBaseNode().getAttr("physicalID_REF"):null},getCompRefPidFromCRNode:function(e){return e?e.getMatchInfo().getCompNode().getAttr("physicalID_REF"):null},getRefPidFromCRNode:function(e){if(e){var t=this.getBaseRefPidFromCRNode(e),o=this.getCompRefPidFromCRNode(e);return t||o}return null},getBaseInstPidFromCRNode:function(e){return e?e.getMatchInfo().getBaseNode().getAttr("physicalID_INST"):null},getCompInstPidFromCRNode:function(e){return e?e.getMatchInfo().getCompNode().getAttr("physicalID_INST"):null},getInstPidFromCRNode:function(e){if(e){var t=this.getBaseInstPidFromCRNode(e),o=this.getCompInstPidFromCRNode(e);return t||o}return null},getTypeFromCRNode:function(e){var t="none";if(e)if(e.getAttr("type"))t=e.getAttr("type");else{var o=e.getMatchInfo();if(o){var n=o.getBaseNode();if(n.getAttr("type"))t=n.getAttr("type");else{var i=o.getCompNode();i.getAttr("type")&&(t=i.getAttr("type"))}}}return t},CRNodeIs3DShapeWith3DPartUsage:function(t){var o=t.getMatchInfo();if(o){var n=o.getBaseNode(),i=o.getCompNode();return!!(n&&e.nodeIs3DShapeWith3DPartUsage(n)||i&&e.nodeIs3DShapeWith3DPartUsage(i))}return e.nodeIs3DShapeWith3DPartUsage(t)},CRNodeIsPLMConnection:function(t){var o=t.getMatchInfo();if(o){var n=o.getBaseNode(),i=o.getCompNode();return!!(n&&e.nodeIsPLMConnection(n)||i&&e.nodeIsPLMConnection(i))}return e.nodeIsPLMConnection(t)},CRNodeIsPLMPort:function(t){var o=t.getMatchInfo();if(o){var n=o.getBaseNode(),i=o.getCompNode();return!!(n&&e.nodeIsPLMPort(n)||i&&e.nodeIsPLMPort(i))}return e.nodeIsPLMPort(t)},CRNodeIsConnectionInstance:function(t){var o=t.getMatchInfo();if(o){var n=o.getBaseNode(),i=o.getCompNode();return!!(n&&e.nodeIsConnectionInstance(n)||i&&e.nodeIsConnectionInstance(i))}return e.nodeIsConnectionInstance(t)},CRNodeWithoutInstance:function(e){return!(!this.CRNodeIsPLMConnection(e)&&!this.CRNodeIsPLMPort(e))},CRNodeSharedStatusHasDifference:function(t){var o=!1,n=t.getMatchInfo();if(n){var i=n.getBaseNode(),r=n.getCompNode();if(i&&r&&!i.isDummy()&&!r.isDummy()){var a=e.nodeIsOnceInstantiable(i),s=e.nodeIsOnceInstantiable(r);o=!s&&a||s&&!a}}return o},CRNodeHas3DPartUsageDifference:function(t){var o=!1,n=t.getMatchInfo();if(n){var i=n.getBaseNode(),r=n.getCompNode();if(i&&r&&!i.isDummy()&&!r.isDummy()){var a=e.nodeHas3DPartUsage(i),s=e.nodeHas3DPartUsage(r);(a&&!s||!a&&s)&&(o=!0)}}return o},CRNodeIsCollectorType:function(t){var o=t.getMatchInfo();if(o){var n=o.getBaseNode(),i=o.getCompNode();return!!(n&&e.nodeIsCollectorType(n)||i&&e.nodeIsCollectorType(i))}return e.nodeIsCollectorType(t)},CRNodeIsConsideredAggregated:function(t){var o=t.getMatchInfo();if(o){var n=o.getBaseNode(),i=o.getCompNode();return!!(n&&e.nodeIsConsideredAggregated(n)||i&&e.nodeIsConsideredAggregated(i))}return e.nodeIsConsideredAggregated(t)},getStructuralParent:function(e){if(!e)return null;var t=e.getParent();return this.CRNodeIsCollectorType(t)&&(t=t.getParent()),t}}})),define("DS/CompareMergePlugin/MERGE_COMPUTE_KEYS_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareMergePlugin/CRNodeUtils","DS/LifecycleServices/UUIDGenerator"],(function(e,t,o){return e.extend({init:function(e,t,o,n){this._parent(e,t,o,n)},onEnabled:function(){return this._parent()},execute:function(e,t){var o=this;if(o._parent(e,t),t.PLUGIN_ENABLED){var n=e.crTreeArray[0];UWA.Promise.all([]).then((()=>{o._computeFinalKeys(n),o.reportOK(e)})).fail((e=>{o._plugSvcs.showAlertBox("Error while calculating actions: "+e,null,"error"),o.reportKO(e)}))}else o.reportOK(e)},_computeFinalKeyFromPartialKey:function(e,t,o){if(!e)return"";var n=[];t&&(n=t.split(","));var i=e,r=!0;return n.forEach((e=>{o.has(e)||(r=!1,console.log("error in _computeFinalKeyFromPartialKey, not ound key for "+e)),i+=o.get(e)})),r?i:""},_computeFinalKeys:function(e){var n=this;const i=new Map,r=new Map;for(let t=0;t<2;t++)e.visitAll_treeAndFN(t,(function(e){try{var t="",n="",a="",s="";if(e._matchInfo){t=e._matchInfo.getBaseNode().getAttr("physicalID_REF"),n=e._matchInfo.getBaseNode().getAttr("physicalID_INST");const r=e._matchInfo.getCompNode().getAttr("physicalID_REF"),c=e._matchInfo.getCompNode().getAttr("physicalID_INST"),l=e._matchInfo.getBaseNode()._riNode._dbObj_REF._attrList.matchkey||"",d=e._matchInfo.getCompNode()._riNode._dbObj_REF._attrList.matchkey||"",g=e._matchInfo.getBaseNode()._riNode._dbObj_INST?._attrList.matchkey||"",u=e._matchInfo.getCompNode()._riNode._dbObj_INST?._attrList.matchkey||"",p=e._matchInfo.getBaseNode()._riNode._dbObj_REF._attrList.matchkey_partial||"",_=e._matchInfo.getCompNode()._riNode._dbObj_REF._attrList.matchkey_partial||"",E=e._matchInfo.getBaseNode()._riNode._dbObj_REF._attrList.groupkey_partial||"",A=e._matchInfo.getCompNode()._riNode._dbObj_REF._attrList.groupkey_partial||"",f=e._matchInfo.getBaseNode()._riNode._dbObj_INST?._attrList.matchkey_partial||"",h=e._matchInfo.getCompNode()._riNode._dbObj_INST?._attrList.matchkey_partial||"",R=e._matchInfo.getBaseNode()._riNode._dbObj_INST?._attrList.groupkey_partial||"",T=e._matchInfo.getCompNode()._riNode._dbObj_INST?._attrList.groupkey_partial||"",S=l&&l==d?l:"";(!!S||""==p&&""==_&&""==E&&""==A)&&(a=S||o.create()+"",t&&i.set(t,a),r&&i.set(r,a));const m=g&&g==u?g:"";(!!m||""==f&&""==h&&""==R&&""==T)&&(s=m||o.create()+"",n&&i.set(n,s),c&&i.set(c,s))}else if(!e._matchInfo){t=e.getAttr("physicalID_REF"),n=e.getAttr("physicalID_INST");const r=e._riNode._dbObj_REF._attrList.matchkey||"",c=e._riNode._dbObj_INST?._attrList.matchkey||"",l=e._riNode._dbObj_REF._attrList.matchkey_partial||"",d=e._riNode._dbObj_REF._attrList.groupkey_partial||"",g=e._riNode._dbObj_INST?._attrList.matchkey_partial||"",u=e._riNode._dbObj_INST?._attrList.groupkey_partial||"",p=r||"";(!!p||""==l&&""==d)&&(a=p||o.create()+"",t&&!i.has(t)&&i.set(t,a));const _=c||"";(!!_||""==g&&""==u)&&(s=_||o.create()+"",n&&!i.has(n)&&i.set(n,s))}if(e._matchInfo){const i=e._matchInfo.getCompNode().getAttr("physicalID_REF"),c=e._matchInfo.getCompNode().getAttr("physicalID_INST"),l=e._matchInfo.getBaseNode()._riNode._dbObj_REF._attrList.groupkey||"",d=e._matchInfo.getCompNode()._riNode._dbObj_REF._attrList.groupkey||"",g=e._matchInfo.getBaseNode()._riNode._dbObj_INST?._attrList.groupkey||"",u=e._matchInfo.getCompNode()._riNode._dbObj_INST?._attrList.groupkey||"",p=e._matchInfo.getBaseNode()._riNode._dbObj_REF._attrList.groupkey_partial||"",_=e._matchInfo.getCompNode()._riNode._dbObj_REF._attrList.groupkey_partial||"",E=e._matchInfo.getBaseNode()._riNode._dbObj_INST?._attrList.groupkey_partial||"",A=e._matchInfo.getCompNode()._riNode._dbObj_INST?._attrList.groupkey_partial||"",f=l&&l==d?l:"";if(!!f||""==p&&""==_){const e=f||a||o.create()+"";t&&r.set(t,e),i&&r.set(i,e)}const h=g&&g==u?g:"";if(!!h||""==E&&""==A){const e=h||s||o.create()+"";n&&r.set(n,e),c&&r.set(c,e)}}else if(!e._matchInfo){const i=e._riNode._dbObj_REF._attrList.groupkey||"",c=e._riNode._dbObj_REF._attrList.groupkey_partial||"",l=e._riNode._dbObj_INST?._attrList.groupkey||"",d=e._riNode._dbObj_INST?._attrList.groupkey_partial||"",g=i||"";if(!!g||""==c){const e=g||a||o.create()+"";t&&!r.has(t)&&r.set(t,e)}const u=l||"";if(!!u||""==d){const e=u||s||o.create()+"";n&&!r.has(n)&&r.set(n,e)}}}catch(e){throw console.error("Erreur in COMPUTE_KEYS_PLUGIN internal loop:",e.message),e}}));for(let o=0;o<2;o++)e.visitAll_treeAndFN(o,(function(e){try{if(t.CRNodeIsCollectorType(e))return;var o=e.getAttr("physicalID_REF"),a=e.getAttr("physicalID_INST");if(e._riNode._dbObj_REF._attrList.matchkey_partial&&!e._riNode._dbObj_REF._attrList.matchkey){var s=e._riNode._dbObj_REF._attrList.matchkey_partial,c=e._riNode._dbObj_REF._attrList.matchkey_ids,l=n._computeFinalKeyFromPartialKey(s,c,i);console.log("computed matchkey for REF "+o+" using partialkey:"+s+" and ids: "+c),console.log("computed matchkey for REF "+o+" => "+l),e._riNode._dbObj_REF._attrList.matchkey=l}if(e._riNode._dbObj_INST?._attrList.matchkey_partial&&!e._riNode._dbObj_INST?._attrList.matchkey){s=e._riNode._dbObj_INST._attrList.matchkey_partial,c=e._riNode._dbObj_INST._attrList.matchkey_ids,l=n._computeFinalKeyFromPartialKey(s,c,i);console.log("computed matchkey for INST "+a+" using partialkey:"+s+" and ids: "+c),console.log("computed matchkey for INST "+a+" => "+l),e._riNode._dbObj_INST._attrList.matchkey=l}if(e._riNode._dbObj_REF._attrList.groupkey_partial&&!e._riNode._dbObj_REF._attrList.groupkey){var d=e._riNode._dbObj_REF._attrList.groupkey_partial,g=e._riNode._dbObj_REF._attrList.groupkey_ids,u=n._computeFinalKeyFromPartialKey(d,g,r);console.log("computed groupkey for REF "+o+" using partialkey:"+d+" and ids: "+g),console.log("computed groupkey for REF "+o+" => "+u),e._riNode._dbObj_REF._attrList.groupkey=u}if(e._riNode._dbObj_INST?._attrList.groupkey_partial&&!e._riNode._dbObj_INST?._attrList.groupkey){d=e._riNode._dbObj_INST._attrList.groupkey_partial,g=e._riNode._dbObj_INST._attrList.groupkey_ids,u=n._computeFinalKeyFromPartialKey(d,g,r);console.log("computed groupkey for INST "+a+" using partialkey:"+d+" and ids: "+g),console.log("computed groupkey for INST "+a+" => "+u),e._riNode._dbObj_INST._attrList.groupkey=u}}catch(e){throw console.error("Erreur in COMPUTE_KEYS_PLUGIN internal loop:",e.message),e}}))}})})),define("DS/CompareMergePlugin/ViewPanel/mergeDefaultContextMenu",["UWA/Class","UWA/Utils/InterCom","DS/CompareMergePlugin/CRNodeUtils","DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structRelationsMenu"],(function(e,t,o,n){return e.extend({init:function(e){var t=this;this._structComparePanel=e.structComparePanel;var o=this._structComparePanel.options.COMPARE_CONTEXT_MENU_PLUGIN;o&&require([o],(function(e){t._compareContextMenuPlugin=new e({structComparePanel:t._structComparePanel})}),(function(e){console.error("FAILED TO LOAD "+o+": msg:"+e)})),this._relationsMenu=new n(e)},createContextMenu:function(e){var t=this,o=e&&e.data&&e.data.event&&e.data.event.ctrlKey;return new Promise((function(n){var i=t._structComparePanel._getAvailableActionsMenuFromCRNode(e.cellInfos.nodeModel.options.data,!0,!1),r=e&&e.collectionView&&e.collectionView.identifier&&e.collectionView.identifier.startsWith("Compare");if(r&&(t._appendHighlightMenuItem(e,i),t._appendReferencedByMenuItem(e,i)),t._compareContextMenuPlugin&&r){e&&e.collectionView&&e.collectionView.identifier&&e.collectionView.identifier;t._compareContextMenuPlugin.createContextMenu(e).then((function(r){if(r&&Array.isArray(r)&&r.length){var a=Array.from(i);if(a.push({type:"SeparatorItem"}),a=a.concat(r),o){var s=t._relationsMenu.getRelationsMenuItem(e);s&&a.push(s)}n(a)}else n(i)}),(function(){n(i)}))}else n(i)}))},onComparePanelUpdated:function(){this._compareContextMenuPlugin&&this._compareContextMenuPlugin.onComparePanelUpdated()},_appendHighlightMenuItem:function(e,t){let n=this,i=e&&e.cellInfos&&e.cellInfos.nodeModel&&e.cellInfos.nodeModel.options&&e.cellInfos.nodeModel.options.data;if(!i||o.CRNodeIsCollectorType(i)||!i._pointedNodes||!Array.isArray(i._pointedNodes)||i._pointedNodes.length<=0)return;let r=new Array;r.push(i),t.push({type:"SeparatorItem"}),t.push({type:"PushItem",title:"Highlight pointed objects",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-path-related",family:WUXManagedFontIcons.Font3DS},action:{callback:()=>n._structComparePanel._highlightLinkedNodesOfCRNodes(r,"pointed")}})},_appendReferencedByMenuItem:function(e,t){let n=this,i=e&&e.cellInfos&&e.cellInfos.nodeModel&&e.cellInfos.nodeModel.options&&e.cellInfos.nodeModel.options.data;if(!i||o.CRNodeIsCollectorType(i)||!i._referencedByNodes||!Array.isArray(i._referencedByNodes)||i._referencedByNodes.length<=0)return;let r=new Array;r.push(i),t.push({type:"SeparatorItem"}),t.push({type:"PushItem",title:"Referenced by objects",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-path-related",family:WUXManagedFontIcons.Font3DS},action:{callback:()=>n._structComparePanel._highlightLinkedNodesOfCRNodes(r,"referencedBy")}})}})})),define("DS/CompareMergePlugin/MERGE_COMPARE_COMPOSEE_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareMergePlugin/CRNodeUtils","DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/matchPair","DS/CompareWidget2/support/typeHierMgr"],(function(e,t,o,n){return e.extend({init:function(e,t,o,n){this._parent(e,t,o,n)},onEnabled:function(){return this._parent()},execute:function(e,t){var o=this;if(o._parent(e,t),t.PLUGIN_ENABLED){var n=e.crTreeArray[0];UWA.Promise.all([]).then((()=>{var t=o._prepareComposeeToMatch(n);o._matchComposee(t),o.reportOK(e)})).fail((e=>{o._plugSvcs.showAlertBox("Error while calculating actions: "+e,null,"error"),o.reportKO(e)}))}else o.reportOK(e)},_matchComposee:function(e){var t=this;e.forEach((e=>{try{if(!e._matchInfo)return;var o=e._matchInfo.getBaseNode(),i=e._matchInfo.getCompNode(),r=[];o._childArray.forEach((e=>{n.isKindOf(e.getAttr("type"),"CATMatConnection")&&r.push(e)}));var a=[];i._childArray.forEach((e=>{n.isKindOf(e.getAttr("type"),"CATMatConnection")&&a.push(e)})),r.forEach((e=>{if(!e._matchInfo){var o=e._riNode._dbObj_REF._attrList.matchkey,n=null,i=0;a.forEach((e=>{if(!e._matchInfo){var t=e._riNode._dbObj_REF._attrList.matchkey;o&&o==t&&(0==i&&(n=e),i++)}})),1==i&&n&&t._addMatchInfoToCRNodes("KEY_MATCH",e,n)}})),r.forEach((e=>{if(!e._matchInfo){var o=e._riNode._dbObj_REF._attrList.logicalid,n=null,i=0;a.forEach((e=>{if(!e._matchInfo){var t=e._riNode._dbObj_REF._attrList.logicalid;o&&o==t&&(0==i&&(n=e),i++)}})),i&&n&&t._addMatchInfoToCRNodes("BRANCH",e,n)}}))}catch(e){throw console.error("Erreur in MERGE_COMPARE_COMPOSEE_plugin internal loop:",e.message),e}}))},_addMatchInfoToCRNodes:function(e,t,n){var i=new o(e,[],t,n,[]);return t.setMatchInfo(i),n.setMatchInfo(i),i},_prepareComposeeToMatch:function(e){const o=new Set;for(let i=0;i<2;i++)e.visitAll_treeAndFN(i,(function(e){try{if(t.CRNodeIsCollectorType(e))return;if(n.isKindOf(e.getAttr("type"),"CATMatConnection")){var i=e._parent;o.add(i),delete e._matchInfo}}catch(e){throw console.error("Erreur in MERGE_COMPARE_COMPOSEE_plugin:",e.message),e}}));return o}})})),define("DS/CompareMergePlugin/ActionOption",["DS/CompareMergePlugin/MergeConstants","i18n!DS/CompareMergePlugin/assets/nls/MergePlugin"],(function(e,t){"use strict";const o=Object.freeze({REVISE:{id:1,name:e.MergeAction.Revise,nls:t.Revise},REUSEREFERENCE:{id:2,name:e.MergeAction.ReuseReference,nls:t.ReuseRef},REUSE:{id:3,name:e.MergeAction.Reuse,nls:t.Reuse},EXCLUDE:{id:4,name:e.MergeAction.Exclude,nls:t.Exclude},INSERTNEW:{id:5,name:e.MergeAction.InsertNew,nls:t.InsertNew}}),n=Object.freeze({REVISE_TARGET:{id:6,name:e.MergeAction.ReviseTarget,nls:t.ReviseTarget},REVISE_TARGET_TAKE_SOURCE:{id:7,name:e.MergeAction.ReviseTargetTakeSource,nls:t.ReviseTargetTakeSource},OVERWRITE_TARGET:{id:8,name:e.MergeAction.OverwriteTarget,nls:t.OverwriteTarget},OVERWRITE_TARGET_INSTANCE:{id:9,name:e.MergeAction.OverwriteTargetInstance,nls:t.OverwriteTargetInstance},DELETE_TARGET:{id:10,name:e.MergeAction.DeleteTarget,nls:t.DeleteTarget},KEEP_TARGET:{id:11,name:e.MergeAction.KeepTarget,nls:t.KeepTarget},KEEP_SOURCE:{id:12,name:e.MergeAction.KeepSource,nls:t.KeepSource},IGNORE_SOURCE:{id:13,name:e.MergeAction.IgnoreSource,nls:t.IgnoreSource},ADD_TO_TARGET:{id:14,name:e.MergeAction.AddToTarget,nls:t.AddInstToTarget}});return Object.freeze(Object.assign({},o,n))})),define("DS/CompareMergePlugin/mergeManager",["DS/CompareCommon/Utils","DS/CompareMergePlugin/MergeConstants","DS/CompareMergePlugin/CRNodeUtils","DS/CompareMergePlugin/NodeUtils","i18n!DS/CompareMergePlugin/assets/nls/MergePlugin","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/Utils","DS/CompareWidget2/support/DataCenter"],(function(e,t,o,n,i,r,a,s){var c=function(e,t){this._options=e,this._plugSvcs=t,this._copyTitleFromSource=!1,this._useMergeCombine=!1,this._showPorts=!1,this._showConnections=!1,this._crTree=null,this._actionInfos=null};return c.prototype.update=function(e,t){this._crTree=e,this._actionInfos=t},c.prototype.doMerge=function(){var e=this;e._plugSvcs.postEvent("MERGE_STARTED_EVENT");var t={useCombine:!1,sendPorts:!1,sendConnections:!1};(a.urlHasParam("mergeSettings")||a.urlHasParam("mergeSettingsEX"))&&(e._useMergeCombine&&(t.useCombine=!0),e._showPorts&&(t.sendPorts=!0),e._showConnections&&(t.sendConnections=!0));var o=this._getMergeData(t),n={data:o},c=this._crTree.getRoot(1).getObjIDSpec_REF(),l=c.getTenant(),d=c.getServiceName(),g=(c.getSecurityContext(),e._plugSvcs.nowMS());r.getSecurityContextPromise(l).then((function(t){e._getCfgAuthoringContext().then((function(r){s.makeAuthHttpsCall("/resources/lifecycle/revise/merge/","POST",n,"json",l,d,t,!1,!1,null,r).then((function(t){if(e._plugSvcs.reportTime(g,"Merge request done OK."),null!=t&&t.hasOwnProperty("status")&&t.hasOwnProperty("report")&&"failure"===t.status){for(var n=i.MergeFailureMsg,r=0;r<t.report.length;r++){var a=t.report[r];if(a.error&&a.error!==n){n=a.error;break}}return e._plugSvcs.postEvent("MERGE_ENDED_KO_EVENT"),void e.showErrorMsg(n)}e.doPostMergeRefresh(o,t.results);var s=i.MergeSuccessMsg;e._plugSvcs.showAlertBox(s,null,"success"),e._plugSvcs.postEvent("MERGE_ENDED_OK_EVENT")}),(function(t){e._plugSvcs.reportTime(g,"Merge request failed."),e._plugSvcs.postEvent("MERGE_ENDED_KO_EVENT"),e._handleRequestFailure(!0,t),e._plugSvcs.errout("Failure to merge: "+t)}))}))}))},c.prototype._handleRequestFailure=function(e,t,o){var n=this;r.showWebServiceError(t,o,(function(e,t,o,i,r){t?n.showNotifMsg(e,{sticky:!0}):n.showErrorMsg(e,{title:o,subtitle:i,submessage:r})}),e)},c.prototype._getMergeData=function(e){var t=this._copyTitleFromSource,n=this._crTree.getRoot(1),i=o.getBaseRefPidFromCRNode(n),r=[];this._addMergeNodeData(r,n,null,[],0,e);var a={physicalid_trgt_root:i,treeData:r,useSourceTitle:t},s=[];return s.push(a),s},c.prototype._addMergeNodeData=function(e,i,r,a,s,c){var l=o.getBaseRefPidFromCRNode(i),d=o.getCompRefPidFromCRNode(i),g=o.getBaseInstPidFromCRNode(i),u=o.getCompInstPidFromCRNode(i),p=r?o.getBaseRefPidFromCRNode(r):null,_=r?o.getCompRefPidFromCRNode(r):null,E=g||u;if(!this._CRNodeIsExcludedFromPayload(i,c)&&-1===a.indexOf(E)){if(a.push(E),(!l||!d)&&p&&_&&o.CRNodeIs3DShapeWith3DPartUsage(i)){var A=r.getChildArray();for(const e of A){var f=l?o.getCompRefPidFromCRNode(e):o.getBaseRefPidFromCRNode(e);if(f&&o.CRNodeIs3DShapeWith3DPartUsage(e)){var h=null;l?(d=f,h=u=o.getCompInstPidFromCRNode(e)):(l=f,h=g=o.getBaseInstPidFromCRNode(e)),a.push(h);break}}}var R=this._getActionInfoFromCRNode(i).getActionOptionSelected().name,T=R===t.MergeAction.AddToTarget,S=R===t.MergeAction.DeleteTarget,m=(t.MergeAction.ReviseTarget,R===t.MergeAction.ReviseTargetTakeSource),C=R===t.MergeAction.OverwriteTarget,I=R===t.MergeAction.KeepSource,N=R===t.MergeAction.IgnoreSource,O=null,M=null;if(r)(O=this._getActionInfoFromCRNode(r).getActionOptionSelected().name)===t.MergeAction.AddToTarget&&(M=n.getNodeDefaultBranchIntent(r));var v=O&&O===t.MergeAction.KeepSource,y=(O&&t.MergeAction.AddToTarget,O&&O===t.MergeAction.IgnoreSource);if(!N||!y){var P=null;r&&g&&u&&(m||C||I&&!v)&&(P=t.MergeAction.OverwriteTargetInstance);var b=null;T&&(b=n.getNodeDefaultBranchIntent(i));this._CRNodeForMapping(i,c)&&(R=t.MergeAction.ForMapping),o.CRNodeIsConnectionInstance(i)&&(l=g,d=u),o.CRNodeWithoutInstance(i)&&(P="",g="",u="");var D={physicalid_trgt:T?"":l||d,operation:R,physicalid_src:d,level:s};g&&(D.inst_physicalid_trgt=g),u&&(D.inst_physicalid_src=u),P&&(D.inst_operation=P),p&&(D.parent_physicalid_trgt=p),_&&(D.parent_physicalid_src=_),O&&(D.parent_operation=O),b&&(D.intent=b),M&&(D.parent_intent=M),c.useCombine&&(D.operation!=t.MergeAction.OverwriteTarget&&D.operation!=t.MergeAction.ReviseTargetTakeSource||(D.combine=!0),D.parent_operation!=t.MergeAction.OverwriteTarget&&D.parent_operation!=t.MergeAction.ReviseTargetTakeSource||(D.parent_combine=!0));var F=i.getChildArray();if(!S&&!N&&F.length>0){var w=[];for(const e of F)o.CRNodeIsCollectorType(e)&&w.push(...e.getChildArray());F.push(...w);for(const t of F)o.CRNodeIsCollectorType(t)||this._addMergeNodeData(e,t,i,a,s+1,c)}e.push(D)}}},c.prototype._getActionInfoFromCRNode=function(e){return this._actionInfos.getCRNodeActionInfo(e)},c.prototype._CRNodeIsExcludedFromPayload=function(e,t){if(o.CRNodeIsPLMConnection(e)){if(t&&t.sendConnections){var n=!0,i=e.getParent(),r=this._getActionInfoFromCRNode(i).getActionOptionSelected(),a=i.getChildArray();for(const e of a)if(o.CRNodeIsPLMConnection(e)){var s=this._getActionInfoFromCRNode(e).getActionOptionSelected();if(s.id!==r.id){console.log("Found connection with action "+s.name+", parent has action "+r.name),n=!1;break}}return n}return!0}return!1},c.prototype._CRNodeForMapping=function(e,t){return!1},c.prototype._getCfgAuthoringContext=function(){return new Promise(((e,t)=>{try{require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext"],(function(t){e(t)}),(function(){console.log("LifecycleServicesSettings: CfgAuthoringContext not available."),e(null)}))}catch(t){console.log("LifecycleServicesSettings: exception loading CfgAuthoringContext."),e(null)}}))},c.prototype.doPostMergeRefresh=function(t,o){var n={created:[],deleted:[],modified:[],context:null},i=e.fetchContentFromCompass();if(i&&i.source){var r=i.source,a="ENOPRSU_AP"===r||"ENOPSTR_AP"===r;n.context={widget:{data:{x3dAppId:r}}}}var s=t[0].physicalid_trgt_root,c=o.find((e=>e.derivedfromphysicalid===s)),l={physicalid:c.physicalid,sourceObjectId:c.derivedfromphysicalid,operation:"Revise",refreshPSD:a};if(n.created.push(l),o.forEach((function(e){var t={physicalid:e.derivedfromphysicalid,operation:"Revise"};n.modified.push(t)})),!widget._isODTMode()){require(["DS/LifecycleServices/Refresh"],(function(e){e._refreshCb(n)}))}},c.prototype.showNotifMsg=function(e,t){this._plugSvcs.showAlertBox(e,null,"warning")},c.prototype.showErrorMsg=function(e,t){this._plugSvcs.showAlertBox(e,null,"error")},c})),define("DS/CompareMergePlugin/MERGE_MERGE_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareMergePlugin/mergeManager"],(function(e,t){return e.extend({init:function(e,o,n,i){this._parent(e,o,n,i),this.mergeManager=new t(n,i)},onEnabled:function(){var e=this;return e.subscribeEvent("EXECUTE_MERGE_EVENT",e.handle_EXECUTE_MERGE_EVENT.bind(e)),e.syncSetting("viewSettings.MERGE_STRUCT_VIEW.copyTitleFromSource","_copyTitleFromSource",null,e.mergeManager),e.syncSetting("viewSettings.MERGE_STRUCT_VIEW.useMergeCombine","_useMergeCombine",null,e.mergeManager),e.syncSetting("viewSettings.MERGE_STRUCT_VIEW.showPorts","_showPorts",null,e.mergeManager),e.syncSetting("viewSettings.MERGE_STRUCT_VIEW.showConnections","_showConnections",null,e.mergeManager),e._parent()},handle_EXECUTE_MERGE_EVENT:function(e){this._plugSvcs.dbgout("MERGE MERGE","executing... "),this.mergeManager.doMerge()},execute:function(e,t){try{var o=this;o._parent(e,t),e.crTreeArray&&e.actionInfos&&o.mergeManager.update(e.crTreeArray[0],e.actionInfos),o.reportOK(null)}catch(t){o._plugSvcs.dbgout("MERGE MERGE","reports exception:: "+t),o.reportKO(e)}}})})),define("DS/CompareMergePlugin/ActionHandlerNRF",["DS/CompareMergePlugin/NodeUtils","DS/CompareMergePlugin/ActionOption","DS/CompareMergePlugin/Action"],(function(e,t,o){"use strict";return{addRootActions:function(e,n,i){e.addAction(new o(t.REVISE,!0,!0))},addActions:function(n,i,r,a){var s={infoPid:i.infoPid,infoPidInst:i.infoPidInst};return i.parentActionInfo.hasOnlyReuseAction()?n.addAction(new o(t.REUSE,!0,!0)):i.childBaseNodePid===i.childCompNodePid||i.parentActionInfo.hasReuseActionSelected()?(n.addAction(new o(t.REUSE,!0,!0)),n.addAction(new o(t.REVISE,!1,!i.parentActionInfo.hasReuseActionSelected())),a.reuseReferenceEnabled&&n.addAction(new o(t.REUSEREFERENCE,!1,!0))):i.childBaseNodePid&&i.childCompNodePid?e.nodeCanBeRevised(i.childNode)?(n.addAction(new o(t.REVISE,!0,!0)),n.addAction(new o(t.REUSE,!1,!0)),a.reuseReferenceEnabled&&n.addAction(new o(t.REUSEREFERENCE,!1,!0))):n.addAction(new o(t.REUSE,!0,!0)):i.childBaseNodePid&&!i.childCompNodePid&&"LEFT_ONLY"==i.childRelName?n.addAction(new o(t.EXCLUDE,!0,!0)):!i.childBaseNodePid&&i.childCompNodePid&&"RIGHT_ONLY"==i.childRelName&&(r.addCrNode(i.childCompNodePid,i.childCompNode),s.infoPid=i.childCompNodePid,s.infoPidInst=i.childCompNodePidInst,n.addAction(new o(t.REUSE,!1,!0)),n.addAction(new o(t.INSERTNEW,!0,!0)),a.reuseReferenceEnabled&&n.addAction(new o(t.REUSEREFERENCE,!1,!1))),s.childActionInfo=n,s},handleChildActionSelected:function(e,o,n,i,r){var a={propagateFurther:!1,affectsChildren:!1,setActionOption:o},s=n.getActionSelected().actionOption;if(o===t.REUSE)n.setEnableActionByOption(t.REVISE,!1),n.setEnableActionByOption(t.REUSEREFERENCE,!1),n.setEnableActionByOption(t.INSERTNEW,!1),n.setEnableActionByOption(t.REUSE,!0),n.setSelectedActionByOption(t.REUSE),i.enableActionOptionForOtherParents(e,t.REUSEREFERENCE,!1,r),i.enableActionOptionForOtherParents(e,t.REUSE,!0,r);else if(o===t.REUSEREFERENCE)n.setEnableActionByOption(t.REVISE,!1),n.setEnableActionByOption(t.REUSE,!1),n.setEnableActionByOption(t.INSERTNEW,!1),n.setEnableActionByOption(t.REUSEREFERENCE,!0),n.setSelectedActionByOption(t.REUSEREFERENCE),i.enableActionOptionForOtherParents(e,t.REUSE,!1,r),i.enableActionOptionForOtherParents(e,t.REUSEREFERENCE,!0,r);else if(o===t.REVISE){if(i.allOtherParentsSetToRevise(e)){n.setEnableActionByOption(t.REVISE,!0),n.setEnableActionByOption(t.REUSE,!0),n.setEnableActionByOption(t.INSERTNEW,!0);var c=n.hasActionOption(t.INSERTNEW);n.setEnableActionByOption(t.REUSEREFERENCE,!c),c&&s==t.REUSEREFERENCE&&(o=t.INSERTNEW,s=t.INSERTNEW),n.setSelectedActionByOption(s),i.enableActionOptionForOtherParents(e,t.REUSE,!0,r),i.enableActionOptionForOtherParents(e,t.REUSEREFERENCE,!0,r)}}else if(o===t.INSERTNEW){n.setEnableActionByOption(t.INSERTNEW,!0),n.setEnableActionByOption(t.REUSE,!0),n.setEnableActionByOption(t.REUSEREFERENCE,!1);var l=s===t.REUSEREFERENCE?t.INSERTNEW:t.REUSE;n.setSelectedActionByOption(l)}return a.setActionOption=o,a.propagateFurther=a.setActionOption===t.REUSE||a.setActionOption===t.REUSEREFERENCE||a.setActionOption===t.INSERTNEW,a},isReferenceAction:function(e){return!0},handleActionAvailabilityOfAllVersions:function(e,t,o){},handlePostAddedActions:function(e){},handleUnavailableReferenceAction:function(e,t,o,n,i){return null},nodeFollowsParentAction:function(t){return e.nodeFollowsParent(t)}}})),define("DS/CompareMergePlugin/MergeAccess",["DS/CompareMergePlugin/NodeUtils","DS/CompareMergePlugin/CRNodeUtils"],(function(e,t){"use strict";return{verifyEverythingIsMergeable:function(o){var n=!0,i=o.getRoot(0);if(i&&(e.nodeIsUnrelated(i)||e.nodeIsDuplicate(i)||e.nodeIsConsideredAggregated(i)))return!1;for(let e=0;e<2;e++){var r=new Map;!0===n&&o.visitAll_treeAndFN(e,(function(e){if(t.CRNodeIsCollectorType(e))return!0;if(e.isDummy())return!0;var o=e.getAttr("attribute[XCADExtension.V_CADOrigin]"),i=e.getAttr("attribute[XCADRepExtension.V_CADFileOrigin]"),a=e.getAttr("isConfigured"),s=e.getAttr("physicalID_REF"),c=e.getAttr("versionid");if((!o||""===o&&"3DEXPERIENCE"===o)&&(!i||""===i&&"3DEXPERIENCE"===i)?a&&(n=!1):n=!1,r.has(c)){var l=r.get(c);l.includes(s)||(l.push(s),n=!1)}else r.set(c,new Array(s));return n}))}return n},verifyEverythingIsRevisionable:function(t,o){var n=new Set;return t.visitAll_treeAndFN(0,(function(t){var o=!0,i=t.getMatchInfo();if(i){var r=i.getRelName();!r||"LEFT_ONLY"!=r&&"RIGHT_ONLY"!=r||(o=!1)}return!o||e.nodeCanBeRevised(t)||e.nodeFollowsParent(t)||n.add(t),!0})),0==n.size||(o&&this.launchReportingPanel(n),!1)},launchReportingPanel:function(t){require(["i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls","DS/ReportingPanel/ReportingPanel"],(function(o,n){var i=[];t.forEach((function(t){var n=[];n.push(t.getAttr("majorid.lastmajorid.bestsofar.physicalid")),n.push(o.deleteFailedShort),n.push("Failed");var r=t.getAttr("majorid.lastmajorid.bestsofar.attribute[Title]");r||(r=t.getAttr("majorid.lastmajorid.bestsofar.attribute[PLMEntity.V_Name]")),n.push(r);var a,s=t.getAttr("displayType");s||(s=t.getAttr("type")),n.push(s),n.push(t.getAttr("majorid.lastmajorid.bestsofar.revision")),a=e.nodeIsRevisionable(t)?"noReviseAccess":"cannotBeRevised";var c=o.replace(o.get(a),{dispName:t.getAttr("title")});n.push(c),i.push(n)}));var r=[{text:"ID",dataIndex:"ID",isHidden:!0},{text:"StatusToolTipColumn",dataIndex:"statusTooltip",isHidden:!0,tooltipColumn:"Status"},{text:o.status,dataIndex:"Status",typeRepresentation:"icon"},{text:o.title,dataIndex:"Title"},{text:o.type,dataIndex:"Type"},{text:o.revision,dataIndex:"Revision"},{text:o.message,dataIndex:"Message"}];n.launchReportingPanel(i,r,null)}))}}})),define("DS/CompareMergePlugin/ActionHandlerSynchronize",["DS/CompareMergePlugin/NodeUtils","DS/CompareMergePlugin/CRNodeUtils","DS/CompareMergePlugin/ActionOption","DS/CompareMergePlugin/Action"],(function(e,t,o,n){"use strict";return{addRootActions:function(t,i,r){var a=e.nodeIsModified(i)||e.nodeHasModifiedChild(i)||e.nodeHasLeftOnlyOrRightOnlyChild(i),s=this._nodeCanBeOverwritten(i),c=s,l=s;t.addAction(new n(o.REVISE_TARGET,r.createARevision&&(!a||!s),!0)),t.addAction(new n(o.REVISE_TARGET_TAKE_SOURCE,r.createARevision&&a&&s,l)),t.addAction(new n(o.OVERWRITE_TARGET,!r.createARevision&&a&&s,c)),t.addAction(new n(o.KEEP_TARGET,!(r.createARevision||a&&s),!0))},_nodeCanBeOverwritten:function(o){return e.nodeCanBeOverwritten(o)&&!t.CRNodeSharedStatusHasDifference(o)&&!t.CRNodeHas3DPartUsageDifference(o)},addActions:function(i,r,a,s){var c={infoPid:r.infoPid,infoPidInst:r.infoPidInst},l=r.parentActionInfo.hasActionOptionSelected(o.DELETE_TARGET),d=r.parentActionInfo.hasActionOptionSelected(o.IGNORE_SOURCE),g=r.parentActionInfo.hasActionOptionSelected(o.KEEP_TARGET),u=r.parentActionInfo.hasActionOptionSelected(o.KEEP_SOURCE),p=r.parentActionInfo.hasActionOptionSelected(o.OVERWRITE_TARGET),_=r.parentActionInfo.hasActionOptionSelected(o.REVISE_TARGET),E=r.parentActionInfo.hasActionOptionSelected(o.REVISE_TARGET_TAKE_SOURCE),A=r.parentActionInfo.hasActionOptionSelected(o.ADD_TO_TARGET),f=a.allParentsHaveActionInfo(r.childNode),h=a.getCRNodesByRefPid().get(r.infoPid),R=a.getCRNodesByVersionId(r.childNode),T=h.length>1,S=h.some((t=>e.nodeIsModified(t)||e.nodeHasModifiedChild(t)||!e.nodeIsLeftOnlyOrRightOnly(t)&&e.nodeHasLeftOnlyOrRightOnlyChild(t))),m=e.nodeCanBeRevised(r.childNode),C=this._nodeCanBeOverwritten(r.childNode),I=(e.nodeIsReplaced(r.childNode),t.CRNodeIsConsideredAggregated(r.childNode)),N=e.nodeIsPortOrConnection(r.childNode),O=h.some((t=>e.nodeIsReplaced(t))),M=(e.nodeIsOnReplacedBranch(r.childNode),h.some((t=>e.nodeIsOnReplacedBranch(t)))),v=h.some((t=>!e.nodeIsRightOnly(t))),y=R.some((t=>!e.nodeIsRightOnly(t))),P=!0,b=!u,D=!u,F=C&&!u,w=!u&&!v&&!y,L=!u,U=_||E,B=C&&!u;if(N?(P=u,w=!u&&!l&&!d,D=!u&&!A,L=!u&&!l&&!A,b=g||p,F=C&&(g||p),U=_||E,B=C&&(_||E)):I&&(P=u,w=!u&&!l&&!d,D=l,L=!u&&!l&&!A,b=g||p,F=C&&(g||p),U=_||E,B=C&&(_||E)),r.childBaseNodePid===r.childCompNodePid)i.addAction(new n(o.KEEP_TARGET,!O&&!M,b)),i.addAction(new n(o.KEEP_SOURCE,O||M,P)),i.addAction(new n(o.DELETE_TARGET,!1,D)),!m||O||M||i.addAction(new n(o.REVISE_TARGET,!1,U));else if(r.childBaseNodePid&&r.childCompNodePid){i.addAction(new n(o.KEEP_TARGET,!1,b)),i.addAction(new n(o.KEEP_SOURCE,!1,P)),i.addAction(new n(o.DELETE_TARGET,!1,D)),!m||O||M||(i.addAction(new n(o.REVISE_TARGET,!1,U)),i.addAction(new n(o.REVISE_TARGET_TAKE_SOURCE,!1,B))),O||M||i.addAction(new n(o.OVERWRITE_TARGET,!1,F));var V=o.KEEP_TARGET;N?V=r.parentActionInfo.getActionOptionSelected():(O||M)&&P?V=o.KEEP_SOURCE:S?m&&s.createARevision&&B?V=o.REVISE_TARGET_TAKE_SOURCE:F&&(V=o.OVERWRITE_TARGET):V=m&&s.createARevision&&U?o.REVISE_TARGET:o.KEEP_TARGET,i.setSelectedActionByOption(V)}else if(r.childBaseNodePid&&!r.childCompNodePid&&"LEFT_ONLY"==r.childRelName)i.addAction(new n(o.KEEP_TARGET,!(M||!b),!M&&b)),i.addAction(new n(o.DELETE_TARGET,!!M,D)),m&&!M&&i.addAction(new n(o.REVISE_TARGET,!b,U));else if(!r.childBaseNodePid&&r.childCompNodePid&&"RIGHT_ONLY"==r.childRelName){if(c.infoPid=r.childCompNodePid,c.infoPidInst=r.childCompNodePidInst,i.addAction(new n(o.KEEP_SOURCE,!(!M&&w),P)),v||y){if(m&&!M){var G=new n(o.REVISE_TARGET,!1,U);G.postAdded=!0,i.addAction(G)}}else i.addAction(new n(o.ADD_TO_TARGET,!(M||!w),w));i.addAction(new n(o.IGNORE_SOURCE,!1,L))}if(T&&f&&((x=a.getRefActionInfo(r.infoPid))&&x.size==h.length-1)){U=a.allParentsSetToActionOption(r.childNode,[o.REVISE_TARGET,o.REVISE_TARGET_TAKE_SOURCE,o.ADD_TO_TARGET]);var x,H=i.hasActionOptionSelected(o.REVISE_TARGET),k=!(!(x=a.getRefActionInfo(r.infoPid))||!Array.from(x.values()).some((e=>e.hasActionOptionSelected(o.REVISE_TARGET)))),W=H||k;for(const e of h){var K=t.getInstPidFromCRNode(e),j=null,Y=(j=K===r.infoPidInst?i:a.getInstActionInfo(K)).hasActionOption(o.REVISE_TARGET),q=j.hasActionOptionEnabled(o.REVISE_TARGET),X=j.hasActionOptionSelected(o.REVISE_TARGET);if((U&&!q||!U&&q)&&j.setEnableActionByOption(o.REVISE_TARGET,U),X&&!U){var Q=j.hasActionOptionEnabled(o.KEEP_TARGET)?o.KEEP_TARGET:o.KEEP_SOURCE;j.setSelectedActionByOption(Q)}else Y&&!X&&U&&W&&j.setSelectedActionByOption(o.REVISE_TARGET)}}return c.childActionInfo=i,c},handleChildActionSelected:function(n,i,r,a,s){var c={propagateFurther:!1,affectsChildren:!1,setActionOption:i},l=null,d=r.getActionSelected().actionOption,g=t.CRNodeIsConsideredAggregated(n),u=e.nodeIsPortOrConnection(n),p=this._nodeCanBeOverwritten(n),_=n.getParent(),E=e.nodeIsCollectorType(_);if(i===o.ADD_TO_TARGET){if(r.setEnableActionByOption(o.ADD_TO_TARGET,!0),r.setEnableActionByOption(o.KEEP_SOURCE,!g&&!u),r.setEnableActionByOption(o.IGNORE_SOURCE,!g&&!u),r.hasActionOption(o.REVISE_TARGET)){var A=a.allParentsSetToActionOption(n,[o.REVISE_TARGET,o.REVISE_TARGET_TAKE_SOURCE,o.ADD_TO_TARGET]),f=!(!(T=r.getActionByActionOption(o.REVISE_TARGET))||!T.postAdded);r.setEnableActionByOption(o.REVISE_TARGET,A&&!f)}l=r.hasActionOptionEnabled(o.ADD_TO_TARGET)?o.ADD_TO_TARGET:d,r.setSelectedActionByOption(l)}else if(i===o.OVERWRITE_TARGET)r.setEnableActionByOption(o.REVISE_TARGET,!1/*!nodeIsAggregated*/),r.setEnableActionByOption(o.REVISE_TARGET_TAKE_SOURCE,p&&!g&&!u),r.setEnableActionByOption(o.OVERWRITE_TARGET,p),r.setEnableActionByOption(o.KEEP_TARGET,!0),r.setEnableActionByOption(o.ADD_TO_TARGET,!0),r.setEnableActionByOption(o.KEEP_SOURCE,!g&&!u),r.setEnableActionByOption(o.IGNORE_SOURCE,!0),r.setEnableActionByOption(o.DELETE_TARGET,!g),l=r.hasActionOptionEnabled(d)&&!E?d:d===o.REVISE_TARGET&&r.hasActionOptionEnabled(o.REVISE_TARGET_TAKE_SOURCE)&&!E?o.REVISE_TARGET_TAKE_SOURCE:r.hasActionOptionEnabled(o.OVERWRITE_TARGET)?o.OVERWRITE_TARGET:r.hasActionOptionEnabled(o.KEEP_TARGET)?o.KEEP_TARGET:o.KEEP_SOURCE,r.setSelectedActionByOption(l);else if(i===o.KEEP_TARGET){if(e.nodeIsRightOnly(n))if(a.getParentActionInfo(n).hasActionOptionSelected(o.KEEP_TARGET))r.setEnableActionByOption(o.KEEP_SOURCE,!g&&!u),r.setEnableActionByOption(o.ADD_TO_TARGET,!0),r.setEnableActionByOption(o.IGNORE_SOURCE,!0),l=o.IGNORE_SOURCE,r.setSelectedActionByOption(l);else{console.log("########### - Propagating Keep Target to Right Only child, but not from it's parent!");var h=t.getCompRefPidFromCRNode(n),R=t.getInstPidFromCRNode(n);l=this.handleUnavailableReferenceAction(R,h,r,o.KEEP_TARGET,a)}else r.setEnableActionByOption(o.REVISE_TARGET,!1/*!nodeIsAggregated*/),r.setEnableActionByOption(o.REVISE_TARGET_TAKE_SOURCE,p&&!g&&!u),r.setEnableActionByOption(o.OVERWRITE_TARGET,p),r.setEnableActionByOption(o.KEEP_TARGET,!0),r.setEnableActionByOption(o.KEEP_SOURCE,!g&&!u),r.setEnableActionByOption(o.DELETE_TARGET,!g),l=o.KEEP_TARGET,r.setSelectedActionByOption(l)}else if(i===o.KEEP_SOURCE){if(e.nodeIsLeftOnly(n))if(a.getParentActionInfo(n).hasActionOptionSelected(o.KEEP_SOURCE))r.setEnableActionByOption(o.KEEP_TARGET,!1),r.setEnableActionByOption(o.REVISE_TARGET,!1),r.setEnableActionByOption(o.DELETE_TARGET,!0),l=o.DELETE_TARGET,r.setSelectedActionByOption(l);else{console.log("########### - Propagating Keep Source to Left Only child, but not from it's parent!");h=t.getCompRefPidFromCRNode(n),R=t.getInstPidFromCRNode(n);l=this.handleUnavailableReferenceAction(R,h,r,o.KEEP_SOURCE,a)}else r.setEnableActionByOption(o.OVERWRITE_TARGET,!1),r.setEnableActionByOption(o.KEEP_TARGET,!1),r.setEnableActionByOption(o.REVISE_TARGET,!1),r.setEnableActionByOption(o.REVISE_TARGET_TAKE_SOURCE,!1),r.setEnableActionByOption(o.KEEP_SOURCE,!0),r.setEnableActionByOption(o.IGNORE_SOURCE,!1),r.setEnableActionByOption(o.DELETE_TARGET,!1),r.setEnableActionByOption(o.ADD_TO_TARGET,!1),l=o.KEEP_SOURCE,r.setSelectedActionByOption(l)}else if(i===o.DELETE_TARGET)l=(e.nodeIsRightOnly(n),d);else if(i===o.IGNORE_SOURCE)l=d;else if(i===o.REVISE_TARGET){A=a.allParentsSetToActionOption(n,[o.REVISE_TARGET,o.REVISE_TARGET_TAKE_SOURCE,o.ADD_TO_TARGET]),f=!(!(T=r.getActionByActionOption(o.REVISE_TARGET))||!T.postAdded);r.setEnableActionByOption(o.REVISE_TARGET,A&&!f),r.setEnableActionByOption(o.REVISE_TARGET_TAKE_SOURCE,p),r.setEnableActionByOption(o.OVERWRITE_TARGET,p&&!g&&!u),r.setEnableActionByOption(o.KEEP_TARGET,!g&&!u),r.setEnableActionByOption(o.KEEP_SOURCE,!g&&!u),r.setEnableActionByOption(o.IGNORE_SOURCE,!0),r.setEnableActionByOption(o.ADD_TO_TARGET,!0),r.setEnableActionByOption(o.DELETE_TARGET,!g),l=r.hasActionOptionEnabled(d)&&!E?d:o.REVISE_TARGET,r.setSelectedActionByOption(l)}else if(i===o.REVISE_TARGET_TAKE_SOURCE){var T;A=a.allParentsSetToActionOption(n,[o.REVISE_TARGET,o.REVISE_TARGET_TAKE_SOURCE,o.ADD_TO_TARGET]),f=!(!(T=r.getActionByActionOption(o.REVISE_TARGET))||!T.postAdded);r.setEnableActionByOption(o.REVISE_TARGET,A&&!f),r.setEnableActionByOption(o.REVISE_TARGET_TAKE_SOURCE,p),r.setEnableActionByOption(o.OVERWRITE_TARGET,p&&!g&&!u),r.setEnableActionByOption(o.KEEP_TARGET,!g&&!u),r.setEnableActionByOption(o.KEEP_SOURCE,!g&&!u),r.setEnableActionByOption(o.IGNORE_SOURCE,!0),r.setEnableActionByOption(o.ADD_TO_TARGET,!0),r.setEnableActionByOption(o.DELETE_TARGET,!g),l=r.hasActionOptionEnabled(d)&&!E?d:r.hasActionOptionEnabled(o.REVISE_TARGET_TAKE_SOURCE)?o.REVISE_TARGET_TAKE_SOURCE:r.hasActionOptionEnabled(o.REVISE_TARGET)?o.REVISE_TARGET:o.KEEP_TARGET,r.setSelectedActionByOption(l)}return c.setActionOption=l||i,c.propagateFurther=c.setActionOption===o.DELETE_TARGET||c.setActionOption===o.IGNORE_SOURCE||c.setActionOption===o.ADD_TO_TARGET||c.setActionOption===o.KEEP_TARGET||c.setActionOption===o.KEEP_SOURCE,c.affectsChildren=!0,c},isReferenceAction:function(e,t,n){if(e===o.DELETE_TARGET||e===o.IGNORE_SOURCE)return!1;if(e===o.KEEP_SOURCE&&n){var i=!1,r=t.getCRNodesByRefPid().get(n);for(const e of r){var a=e.getMatchInfo().getCompNode().getAttr("versionid"),s=t.getCRNodesByVersionId().get(a);if(s&&s.length>0){i=!0;break}}return i}return!0},handleActionAvailabilityOfAllVersions:function(e,n,i){t.getInstPidFromCRNode(e);var r=t.getRefPidFromCRNode(e),a=n.getCRNodesByVersionId(e);for(const e of a){var s=t.getInstPidFromCRNode(e),c=t.getRefPidFromCRNode(e);if(c===r);else{console.log("##### Found another ref among versions, NOT updated. Instance:"+s);var l=n.getRefActionInfo(c);for(let[t,r]of l.entries())if(r.hasActionOption(o.REVISE_TARGET)){var d=n.allParentsSetToActionOption(e,[o.REVISE_TARGET,o.REVISE_TARGET_TAKE_SOURCE,o.ADD_TO_TARGET]),g=r.getActionByActionOption(o.REVISE_TARGET),u=!(!g||!g.postAdded);r.setEnableActionByOption(o.REVISE_TARGET,d&&!u),i.set(c,r.getActionOptionSelected())}}}},handlePostAddedActions:function(e){e.getEnabledActionsNotSelected().forEach((function(t){t.postAdded&&(console.log("##### Disabling post added action:"+t.actionOption.name),e.setEnableActionByOption(t.actionOption,!1))}))},handleUnavailableReferenceAction:function(e,t,i,r,a){var s,c=this;if(i.hasActionOptionEnabled(r))return null;var l=r;if(i.hasActionOption(r))i.setEnableActionByOption(r,!0);else{var d=!1;if(r===o.KEEP_TARGET?i.hasActionOption(o.KEEP_SOURCE)&&(l=o.KEEP_SOURCE,d=!0):r===o.KEEP_SOURCE&&i.hasActionOption(o.KEEP_TARGET)&&(l=o.KEEP_TARGET,d=!0),!d){var g=new n(r,!1,!0);g.postAdded=!0,i.addAction(g)}}return i.setSelectedActionByOption(l),s=l,i.getEnabledActionsNotSelected().forEach((function(n){if(c.isReferenceAction(n.actionOption,a,t)){var r=n.postAdded;if(!r&&n.actionOption===o.REVISE_TARGET){var s=a.getCRNodesByInstPid().get(e)[0];r=!a.allParentsSetToActionOption(s,[o.REVISE_TARGET,o.REVISE_TARGET_TAKE_SOURCE,o.ADD_TO_TARGET])}r&&i.setEnableActionByOption(n.actionOption,!1)}})),s},nodeFollowsParentAction:function(t){return e.nodeIs3DShapeWith3DPartUsage(t)}}})),define("DS/CompareMergePlugin/actionInfos",["DS/CompareWidget2/support/cw2Utils","DS/CompareMergePlugin/MergeConstants","DS/CompareMergePlugin/ActionOption","DS/CompareMergePlugin/Action","DS/CompareMergePlugin/ActionHandlerNRF","DS/CompareMergePlugin/ActionHandlerSynchronize","i18n!DS/CompareMergePlugin/assets/nls/MergePlugin","DS/CompareMergePlugin/NodeUtils","DS/CompareMergePlugin/CRNodeUtils"],(function(e,t,o,n,i,r,a,s,c){var l="[actionInfos]";class d{constructor(){this._actions=[],this._selectedActionOptionHistory=[],this._firstSetAmongInstances=!0}addAction(e){this.hasActionOption(e.actionOption)||this._actions.push(e)}removeActionByOption(e){this._actions=this._actions.filter((t=>t.actionOption!==e))}clearActions(){this._actions=[]}getActions(){return this._actions.sort(((e,t)=>e.actionOption.id-t.actionOption.id))}getEnabledActions(){return this._actions.filter((e=>!0===e.isEnabled)).sort(((e,t)=>e.actionOption.id-t.actionOption.id))}getEnabledActionsNotSelected(){return this.getEnabledActions().filter((e=>!1===e.isSelected))}getActionSelected(){for(const e of this._actions)if(e.isSelected)return e}getActionOptionSelected(){return this.getActionSelected().actionOption}getPreviouslySelectedActionOption(){return this._selectedActionOptionHistory.length>0?this._selectedActionOptionHistory[this._selectedActionOptionHistory.length-1]:null}getDefaultSelectedActionOption(){return this._selectedActionOptionHistory.length>0?this._selectedActionOptionHistory[0]:this.getActionOptionSelected()}getActionByActionOption(e){for(const t of this._actions)if(t.actionOption.id===e.id)return t;return null}getActionByOptionId(e){for(const t of this._actions)if(t.actionOption.id===e)return t;return null}getActionByOptionName(e){for(const t of this._actions)if(t.actionOption.name===e)return t;return null}setEnableActionByOption(e,t){for(const o of this._actions)if(o.actionOption===e){o.isEnabled=t;break}}setSelectedActionByOption(e){if(this.hasActionOptionEnabled(e))for(const t of this._actions)t.isSelected&&this._selectedActionOptionHistory.push(t.actionOption),t.isSelected=t.actionOption===e;else u("Tried setting action "+e.nls+" as selected, but not available or enabled.")}getEnabledActionCount(){var e=0;for(const t of this._actions)t.isEnabled&&e++;return e}hasActionOptionSelected(e){for(const t of this._actions)if(t.actionOption===e&&t.isSelected)return!0;return!1}hasReuseActionSelected(){return this.hasActionOptionSelected(o.REUSE)}hasOnlyActionOption(e){return 1===this._actions.length&&this._actions[0].actionOption===e}hasOnlyReuseAction(){return this.hasOnlyActionOption(o.REUSE)}hasActionOption(e){for(const t of this._actions)if(t.actionOption===e)return!0;return!1}hasActionOptionEnabled(e){for(const t of this._actions)if(t.actionOption===e&&t.isEnabled)return!0;return!1}}function g(t){e.dbgout(l+" "+t)}function u(t){e.warnout(l+" "+t)}function p(e,t){var i=s.nodeIsCollectorType(e),r=i?e.getParent():e,a=r.getAttr("physicalID_INST"),c=r.getMatchInfo();c&&((a=c.getBaseNode().getAttr("physicalID_INST"))||(a=c.getCompNode().getAttr("physicalID_INST")));var l=t.getInstActionInfo(a),_={parentActionInfo:l},E=new d,f=e.getChildArray();for(const e of f){var h=A(e),R=(s.nodeIsCollectorType(e),h.getAttr("physicalID_REF")),T=h.getAttr("physicalID_INST");if(_.infoPid=R,_.infoPidInst=T,t.hasInstActionInfo(T)){if(g("Hmmm, found occurrence for instance:"+h.getAttr("title")),i){var S=t.getInstActionInfo(T).getEnabledActions();for(const e of S){var m=Object.create(e);E.addAction(m)}}}else{t.hasRefActionInfo(R);var C=t.getActionHandler(),I=new d;if(C.nodeFollowsParentAction(h)){g("This child follows parent:"+h.getAttr("title"));var N=Object.assign({},l.getActionSelected());I.addAction(N),t.addActionInfo(R,T,I),p(h,t)}else{var O=h.getMatchInfo();if(O){var M=O.getRelName(),v=O.getBaseNode(),y=v.getAttr("physicalID_REF"),P=v.getAttr("physicalID_INST"),b=O.getCompNode(),D=b.getAttr("physicalID_REF"),F=b.getAttr("physicalID_INST");_.childNode=h,_.childRelName=M,_.childBaseNode=v,_.childBaseNodePid=y,_.childBaseNodePidInst=P,_.childCompNode=b,_.childCompNodePid=D,_.childCompNodePidInst=F;var w=t.getOptions(),L=C.addActions(I,_,t,w);if(R=L.infoPid,T=L.infoPidInst,i){S=I.getEnabledActions();for(const e of S){m=Object.create(e);E.addAction(m)}}}else u("No matchinfo found in addActionInfoForChildren!"),I.addAction(new n(o.EXCLUDE,!0,!0));t.addActionInfo(R,T,I),p(h,t)}}}i&&t.updateCollectorNodeActionsByActionInfo(e,E)}function _(e){var t=e.getMatchInfo(),o=t.getBaseNode().getAttr("physicalID_INST"),n=t.getCompNode().getAttr("physicalID_INST");return o||n}function E(e){var t=e.getMatchInfo(),o=t.getBaseNode().getAttr("physicalID_REF"),n=t.getCompNode().getAttr("physicalID_REF");return o||n}function A(e){var t=e.getMatchInfo();return t?"RIGHT_ONLY"==t.getRelName()?t.getCompNode():t.getBaseNode():e}function f(e,t){var i=e.getChildArray();for(const e of i){var r=e.getAttr("physicalID_REF"),a=e.getAttr("physicalID_INST");if(!t.hasInstActionInfo(a)){if(t.hasRefActionInfo(r),!e.getMatchInfo()){u("No matchinfo found in addActionInfoForChildrenInsertedNew!");var s=new d;s.addAction(new n(o.REUSE,!1,!0)),s.addAction(new n(o.INSERTNEW,!0,!0)),t.addActionInfo(r,a,s)}f(e,t)}}}return function(e,t){this._actionInfosByRefPid=new Map,this._actionInfosByInstPid=new Map,this._options=t||{reuseReferenceEnabled:!1},this._actionHandler=t&&t.mode&&"nrf"==t.mode?i:r,this._crNodesByRefPid=new Map,this._crNodesByVersionId=new Map,this._crNodesByInstPid=new Map,this.getOptions=function(){return this._options},this.getActionHandler=function(){return this._actionHandler},this.getCRNodesByRefPid=function(){return this._crNodesByRefPid},this.getCRNodesByVersionId=function(e){if(e){var t=e.getAttr("versionid");return t?this._crNodesByVersionId.get(t):new Array}return this._crNodesByVersionId},this.getCRNodesByInstPid=function(){return this._crNodesByInstPid},this.addActionInfo=function(e,t,o){this._actionInfosByInstPid.set(t,o),this._actionInfosByRefPid.has(e)?(console.log("##### Adding actionInfo on other instance for same reference:"+e+" -> "+t),o._firstSetAmongInstances=!1,this._actionInfosByRefPid.get(e).set(t,o)):this._actionInfosByRefPid.set(e,new Map([[t,o]]))},this.addCrNode=function(e,t){if(this._crNodesByRefPid.has(e))this._crNodesByRefPid.get(e).push(t);else{var o=new Array;o.push(t),this._crNodesByRefPid.set(e,o)}var n=t.getAttr("versionid");if(n)if(this._crNodesByVersionId.has(n))this._crNodesByVersionId.get(n).push(t);else{var i=new Array;i.push(t),this._crNodesByVersionId.set(n,i)}var r=_(t);if(r)if(this._crNodesByInstPid.has(r))this._crNodesByInstPid.get(r).push(t);else{var a=new Array;a.push(t),this._crNodesByInstPid.set(r,a)}},this.getParentActionInfo=function(e){var t=_(e.getParent());return this.getInstActionInfo(t)},this.allParentsHaveActionInfo=function(e){var t=this,o=E(e);return this._crNodesByRefPid.get(o).every((function(e){var o=_(e.getParent());return null!=t.getInstActionInfo(o)}))},this.allParentsSetToActionOption=function(e,t){var o=this,n=Array.isArray(t)?t:[t];return this.getCRNodesByVersionId(e).every((function(e){var t=_(c.getStructuralParent(e)),i=o.getInstActionInfo(t);return n.includes(i.getActionOptionSelected())}))},this.allOtherParentsSetToRevise=function(e){var t=this,n=(_(e),E(e)),i=_(e.getParent());return this._crNodesByRefPid.get(n).every((function(e){var n=_(e.getParent());return n===i||t.getInstActionInfo(n).getActionOptionSelected()===o.REVISE}))},this.enableActionOptionForOtherParents=function(e,t,o,n){_(e);var i=E(e),r=_(e.getParent()),a=this._crNodesByRefPid.get(i);for(const e of a){var s=e.getParent(),c=E(s),l=_(s);if(l!==r){var d=this.getInstActionInfo(l);d.setEnableActionByOption(t,o),n.set(c,d.getActionOptionSelected())}}},this._getActionOptionFromActionName=function(e){var t=null;return Object.entries(o).every((([n,i])=>i.name!==e||(t=o[n],!1))),t},this.updateActionSelected=function(e,t){var o=this,n=new Map,i=_(e),r=E(e),a=A(e),s=this._getActionOptionFromActionName(t),c=this._actionHandler.isReferenceAction(s,this,r),l=this.getRefActionInfo(r);for(let[e,n]of l.entries()){var d=n.getActionOptionSelected(),g=o._actionHandler.isReferenceAction(d,o,r);(e===i||c&&g)&&(n._firstSetAmongInstances=e===i,n.hasActionOptionEnabled(s)?(n.setSelectedActionByOption(s),o._actionHandler.handlePostAddedActions(n)):(console.log("Calling handler to propagate reference action "+t+" to instance "+e+" because it doesn't have it!"),o._actionHandler.handleUnavailableReferenceAction(e,r,n,s,this)))}return n.set(r,s),c&&this.propagateActionToOtherVersions(a,s,n),this.updateChildrenActionSelected(e,s,n),n},this.propagateActionToOtherVersions=function(e,t,o){var n=this,i=E(e),r=n.getCRNodesByVersionId(e);for(const e of r){var a=_(e),s=E(e);A(e);if(s===i);else{console.log("##### Found another ref  among versions, NOT acted upon. Instance:"+a);var c=n.getRefActionInfo(s);for(let[e,o]of c.entries()){var l=o.getActionOptionSelected();n._actionHandler.isReferenceAction(l,n,s)&&(o.hasActionOptionEnabled(t.name)?(console.log("Setting reference action "+selActionName+" to REVISIONED instance "+e+" , it has the action."),o.setSelectedActionByOption(t)):(console.log("Calling handler to propagate reference action "+t.name+" to REVISIONED instance "+e+" because it doesn't have it!"),n._actionHandler.handleUnavailableReferenceAction(e,s,o,t,this)))}o.set(s,t)}}},this.updateCollectorNodeActions=function(e){let t=new d,o=e.getChildArray();for(const e of o){let o=_(e),n=this.getInstActionInfo(o).getEnabledActions();for(const e of n){let o=Object.create(e);t.addAction(o)}}this.updateCollectorNodeActionsByActionInfo(e,t)},this.updateCollectorNodeActionsByActionInfo=function(e,t){let o=e.getAttr("physicalID_INST"),n=this.getInstActionInfo(o);n.clearActions();let i=null,r=t.getActions();for(const e of r)n.addAction(e),!i&&e.isSelected&&(i=e.actionOption);i||(i=r[0].actionOption),n.setSelectedActionByOption(i)},this.updateChildrenActionSelected=function(e,t,o){var n=this._actionHandler.isReferenceAction(t),i=e.getChildArray();for(const I of i){var r=A(I),a=_(r),c=E(r),l=this.getRefActionInfo(c),d=!1,g=null;for(let[i,E]of l.entries())if(s.nodeIsCollectorType(r)){this.updateChildrenActionSelected(r,t,o),this.updateCollectorNodeActions(r);let e=E.getActionSelected().actionOption;o.set(c,e)}else if(this._actionHandler.nodeFollowsParentAction(r)){var u=_(e),p=this.getInstActionInfo(u),f=Object.assign({},p.getActionSelected());E.clearActions(),E.addAction(f),o.set(c,t)}else{var h=r,R=null,T=E.getActionSelected().actionOption,S=this._actionHandler.isReferenceAction(T);if(i!==a){if(!n||!S)continue;var m=this.getCRNodesByInstPid().get(i);m&&m.length>0&&(h=m[0])}E.hasActionOption(t),R||(R=this._actionHandler.handleChildActionSelected(h,t,E,this,o));var C=T!==R.setActionOption;C&&!d&&(d=!0,g=R.setActionOption),C&&R.propagateFurther?this.updateChildrenActionSelected(h,R.setActionOption,o):R.affectsChildren&&h.visitAll_nodesAndFN((function(e){var t=A(e).getAttr("physicalID_REF");t&&o.set(t,R.setActionOption)})),o.set(c,R.setActionOption)}if(d)this._actionHandler.isReferenceAction(g,this,c)&&this.propagateActionToOtherVersions(r,g,o);else this._actionHandler.handleActionAvailabilityOfAllVersions(r,this,o)}},this.getCRNodeActionInfo=function(e){for(var t=e.getParent(),n=null,i=!1;t&&!i;){var r=_(t);(n=this.getInstActionInfo(r).getActionSelected()).actionOption===o.DELETE_TARGET||n.actionOption===o.IGNORE_SOURCE?i=!0:t=t.getParent()}var a=null;if(i){a=new d;var c=Object.create(n);c.actionOption===o.DELETE_TARGET&&s.nodeIsRightOnly(e)&&(c.actionOption=o.IGNORE_SOURCE),a.addAction(c)}else{var l=_(e);a=this.getInstActionInfo(l)}return a},this.getInstActionInfo=function(e){return this._actionInfosByInstPid.get(e)},this.getRefActionInfo=function(e){return this._actionInfosByRefPid.get(e)},this.hasInstActionInfo=function(e){return this._actionInfosByInstPid.has(e)},this.hasRefActionInfo=function(e){return this._actionInfosByRefPid.has(e)};var n=e.getRoot(0),a=n.getAttr("physicalID_REF"),l=n.getAttr("physicalID_INST"),g=new d;this._actionHandler.addRootActions(g,n,t),this.addActionInfo(a,l,g);var u=this;n.visitAll_nodesAndFN((function(e){var t=A(e),o=t.getAttr("physicalID_REF");o&&u.addCrNode(o,t)})),p(n,this),f(e.getRoot(1),this)}})),define("DS/CompareMergePlugin/MERGE_COMPUTE_ACTIONS_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareMergePlugin/actionInfos","DS/CompareMergePlugin/CRNodeUtils","DS/CompareMergePlugin/NodeUtils","DS/LifecycleServices/LifecycleServices","DS/CompareWidget2/support/typeHierMgr"],(function(e,t,o,n,i,r){return e.extend({init:function(e,t,o,n){this._parent(e,t,o,n),this._createARevision=!0,this._branchIntents=["S","F","D"]},onEnabled:function(){return this.syncSetting("viewSettings.MERGE_STRUCT_VIEW.createARevision","_createARevision",null),this._parent()},execute:function(e,o){var n=this;n._parent(e,o);var i=e.crTreeArray[0],r=this._getTreeNodesReviseAccessInfo(i),a=this._getTreeNodesAttributeInfo(i),s=this._getReuseReferenceEnabled(i),c=this._getAllowedSemantics(i),l=Promise.resolve(null);o&&o.MODE&&"nrf"!==o.MODE&&(l=this._getMergeSupportedScope(i)),UWA.Promise.all([r,a,s,c,l]).then((r=>{var a=r[0],s=r[1],c=r[2],l=r[3],d=r[4];n._populateReviseAccessInfo(a,i),n._populateAttributeInfo(s,i),l&&l.allowedSemantics&&n._populateAllowedBranchIntents(l.allowedSemantics,i),o&&o.MODE&&"nrf"!==o.MODE&&n._populateMergeSupported(d,i),n._populatePointedNodes(i);var g={reuseReferenceEnabled:c,createARevision:n._createARevision,mode:o.MODE},u=new t(i,g);if(null!=e.crTreeArray){var p={crTreeArray:e.crTreeArray,ruleNames:e.ruleNames,actionInfos:u,intents:l?l.intents:null,destroy:function(){}};n.reportOK(p)}else n.reportKO()})).fail((e=>{n._plugSvcs.showAlertBox("Error while calculating actions: "+e,null,"error"),n.reportKO(e)}))},_getAttributes:function(){return["attribute[PLMEntity.V_usage]","attribute[PLMCoreRepReference.V_isOnceInstantiable]","attribute[XCADEmbeddedCmp.V_IsEmbeddedComponent]","type.kindof[BundleFastenerAbstract]","type.kindof[PLMPort]","type.kindof[PLMConnection]","type.kindof[DOCUMENTS]","type.kindof[PLMDMTDocument]","firstRevision","majorid.lastmajorid.bestsofar.physicalid","majorid.lastmajorid.bestsofar.revision","majorid.lastmajorid.bestsofar.attribute[PLMEntity.V_Name]","majorid.lastmajorid.bestsofar.attribute[Title]","displayType","locker","policy","last.current","attribute[XCADExtension.V_CADOrigin]","attribute[XCADRepExtension.V_CADFileOrigin]","isConfigured","versionid","interface","minororder","attribute[PLMEntity.V_discipline]"]},_getReviseAccessAttributes:function(){return["majorid.lastmajorid.bestsofar.current.access[majorrevise]","majorid.lastmajorid.bestsofar.current.access[revise]","last.current.majorrevisionable","last.current.revisionable"]},_getTreeNodesAttributeInfo:function(e){var t=this._getAttributes(),n=new Set;for(let t=0;t<2;t++)e.visitAll_treeAndFN(t,(function(e){if(!o.CRNodeIsCollectorType(e)){var t=e.getAttr("physicalID_REF");t&&n.add(t)}}));return this._getAttributeInfo(e,n,t)},_getTreeNodesReviseAccessInfo:function(e){var t=this._getReviseAccessAttributes(),n=new Set;for(let t=0;t<1;t++)e.visitAll_treeAndFN(t,(function(e){if(!o.CRNodeIsCollectorType(e)){var t=o.getRefPidFromCRNode(e);t&&n.add(t)}}));return this._getAttributeInfo(e,n,t)},_getAttributeInfo:function(e,t,o){var n=this;return new UWA.Class.Promise((function(i,r){var a={data:[],attributes:o};t.forEach((function(e){if(-1===a.data.findIndex((t=>t.physicalid===e))){var t={physicalid:e};a.data.push(t)}}));var s=e.getRoot(0).getObjIDSpec_REF(),c=s.getTenant(),l=s.getServiceName(),d=s.getSecurityContext(),g=n._plugSvcs.nowMS();n._plugSvcs.makeAuthHttpsCall("/resources/lifecycle/product/attributeList","POST",a,"json",c,l,d).then((function(e){n._plugSvcs.reportTime(g,"attributeList request OK.");var t="string"==typeof e?JSON.parse(e):e;i(t)}),(function(e){n._plugSvcs.reportTime(g,"attributeList request failed."),n._plugSvcs.showAlertBox("attributeList request unsuccessful.",null,"error"),n._plugSvcs.errout("Failure of attributeList request: "+e),r("attributeList request failed.")}))}))},_getAllowedSemantics:function(e){var t=new Set;if(e.visitAll_treeAndFN(0,(function(e){if(!o.CRNodeIsCollectorType(e)){var n=e.getMatchInfo();if(n){var i=n.getBaseNode();if(i&&!i.isDummy());else{var r=n.getCompNode().getAttr("physicalID_REF");r&&t.add(r)}}}})),0===t.size)return new UWA.Promise((function(e,t){e(null)}));var n=e.getRoot(0).getObjIDSpec_REF();return i.getAllowedSemanticsPromise(Array.from(t),n,{nlsintents:!0})},_getMergeSupportedScope:function(e){var t=e.getRoot(0).getObjIDSpec_REF();return i.getMergeSupportedScope(t)},_populatePointedNodes:function(e){var t=this;let o=new Map;for(let t=0;t<2;t++)e.visitAll_treeAndFN(t,(function(e){if(!e.isDummy()){let t=e.getAttr("physicalID_REF");if(o.has(t))o.get(t).push(e);else{let n=new Array;n.push(e),o.set(t,n)}}return!0}));for(let n=0;n<2;n++)e.visitAll_treeAndFN(n,(function(e){let n=e,i=null,r=new Array;do{i=!0;let a=n.getAttr("REF.linkedElements");if(a&&Array.isArray(a)&&a.length>0){let s=a.length-1,c=(a.at(s),null),l=null;if(a.forEach((function(e,a){let d=e["ds6w:type"],g=e.physicalid;if(a<s)c=g;else if("VPMPort"===d){let e=o.get(g);if(e&&Array.isArray(e)&&e.length>0)for(const t of e){n=t,r.push(t),i=!1;break}else t._plugSvcs.warnout("VPMPort lookup failed, seems not to be part of structures...")}else l=g})),i&&l){let t=o.get(l);for(const o of t){let t=o.getAttr("physicalID_INST");if(!c||t&&t==c){e._pointedNodes||(e._pointedNodes=new Array),e._pointedNodes.push(o);for(const t of r)e._pointedNodes.push(t);o._referencedByNodes||(o._referencedByNodes=new Array),o._referencedByNodes.push(e)}}}}}while(!i)}))},_populateAttributeInfo:function(e,t){e.getAttInfo=function(e){return this.results.find((t=>t.physicalid===e))};var o=this._getAttributes();for(let n=0;n<2;n++)t.visitAll_treeAndFN(n,(function(t){var n=t.getAttr("physicalID_REF");if(n){var i=e.getAttInfo(n);i&&o.forEach((function(e){t.addAttr(e,i[e])}))}}))},_populateReviseAccessInfo:function(e,t){e.getAttInfo=function(e){return this.results.find((t=>t.physicalid===e))};var o=this._getReviseAccessAttributes();for(let n=0;n<2;n++)t.visitAll_treeAndFN(n,(function(t){var n=t.getAttr("physicalID_REF");if(n){var i=e.getAttInfo(n);i&&o.forEach((function(e){t.addAttr(e,i[e])}))}}))},_populateMergeSupported:function(e,t){var i=e&&Array.isArray(e.BO_BASE_TYPES)&&Array.isArray(e.BO_CUSTOM_TYPES),a=e&&Array.isArray(e.REL_BASE_TYPES)&&Array.isArray(e.REL_CUSTOM_TYPES),s=e&&Array.isArray(e.INTERFACE_TYPES)&&Array.isArray(e.ITF_CUSTOM_TYPES),c=e&&e.isDisabled;const l=new Map,d=new Map,g=new Map;for(let u=0;u<2;u++)t.visitAll_treeAndFN(u,(function(t){if(!o.CRNodeIsCollectorType(t)&&!t.isDummy()){var u=!0,p=t.getAttr("type"),_=t.getAttr("INST.ds6w:type")||t.getAttr("INST.type"),E=t.getAttr("minororder"),A=t.getAttr("attribute[PLMEntity.V_discipline]");E&&"0"!==E&&(console.log("Merge: Found minor revision object and disabled Merge for it!"),u=!1);var f=n.nodeIsPortOrConnection(t);if(u&&A&&""!==A&&!f&&(r.isKindOf(p,"3DShape")&&"Design"!==A?(console.log("Merge: Found 3DShape with discipline not being Design and disabled Merge for it!"),u=!1):r.isKindOf(p,"VPMReference")&&(console.log("Merge: Found VPMReference with non-empty discipline and disabled Merge for it!"),u=!1)),u&&!c&&(l.has(p)?u=l.get(p):(!i||e.BO_BASE_TYPES.includes(p)||e.BO_CUSTOM_TYPES.includes(p)||(u=!1),l.set(p,u)),u&&_&&a&&(d.has(_)?u=d.get(_):(e.REL_BASE_TYPES.includes(_)||e.REL_CUSTOM_TYPES.includes(_)||(u=!1),d.set(_,u))),u&&s)){var h=t.getAttr("interface"),R=h&&""!=h?h.split(""):[];for(const t of R)if(g.has(t)?u=g.get(t):(e.INTERFACE_TYPES.includes(t)||e.ITF_CUSTOM_TYPES.includes(t)||(u=!1),g.set(t,u)),!u)break}//!scopeCheckIsDisabled
t.addAttr("isMergeSupported",u)}}))},_populateAllowedBranchIntents:function(e,t){var o=this;e.getSemanticInfo=function(e){return this.find((t=>t.id===e))},t.visitAll_treeAndFN(0,(function(t){var n=t.getMatchInfo();if(n){var i=n.getBaseNode();if(i&&!i.isDummy());else{var r=n.getCompNode(),a=r.getAttr("physicalID_REF");if(a){var s=e.getSemanticInfo(a);if(s){var c=s.semantic.filter((e=>o._branchIntents.includes(e)));r.addAttr("intents",c),t.addAttr("intents",c)}}}}}))},_getReuseReferenceEnabled:function(e){var t=this;return new UWA.Class.Promise((function(o,n){var i=e.getRoot(0).getObjIDSpec_REF(),r=i.getTenant(),a=i.getServiceName(),s=i.getSecurityContext(),c=t._plugSvcs.nowMS();t._plugSvcs.makeAuthHttpsCall("/resources/lifecycle/util/getExpression","GET","expression=ReuseReferenceEnabled","json",r,a,s).then((function(e){t._plugSvcs.reportTime(c,"getExpression request OK.");var n=!1;e&&e.result&&(n="true"===e.result),o(n)}),(function(e){t._plugSvcs.reportTime(c,"getExpression request failed."),t._plugSvcs.showAlertBox("getExpression request unsuccessful.",null,"error"),t._plugSvcs.errout("Failure of getExpression request: "+e),n("getExpression request failed.")}))}))}})})),define("DS/CompareMergePlugin/ViewPanel/mergeStructComparePanel",["DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structComparePanel","DS/CompareWidget2/ViewDefModules/DSColors","DS/CompareCommon/Utils","i18n!DS/CompareMergePlugin/assets/nls/MergePlugin","DS/CompareMergePlugin/CRNodeUtils","DS/CompareMergePlugin/MaturityUtils","DS/CompareMergePlugin/MergeConstants","DS/CompareMergePlugin/MergeAccess","DS/CompareMergePlugin/NodeUtils","DS/LifecycleControls/CommandDialogWUX","DS/LifecycleServices/LifecycleAlert","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/Utils","DS/Controls/Toggle","DS/Controls/Button","DS/Controls/ButtonGroup","DS/Controls/ComboBox","DS/Controls/Label","DS/Controls/TooltipModel","i18n!DS/Windows/assets/nls/translation","css!DS/CompareMergePlugin/CompareMergePlugin.css"],(function(e,t,o,n,i,r,a,s,c,l,d,g,u,p,_,E,A,f,h,R){const T=-99,S="DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext";return e.extend({init:function(e,t,o,n){this._plugSvcs=t,this._parent(e,t,o,n),this._contentFromLeftColor=o.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR,this._contentFromRightColor=o.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR,this._actionInfos=null,this._displayMode="tree",this._treesAreReady=!1,this._setupActionDefs(),this.url3DSpace=this.get3DSpaceUrl(),this._statusFilterHideChildIfParentIsHidden=!1,this._copyTitleFromSource=!1,this._warningNoRevise=!1,this._createARevision=!1,this._show_3dshape_of_3dpart=!1,this._maturityColumnVisible=!0,this._instanceTitleColumnVisible=!1,this._useMergeCombine=!1,this._showPorts=!1,this._showConnections=!1,this._showPubsSetting=!1,this._columnHeaderVisible=!1,this._appendCompareCtxMenu=!1,this._showCABubble=!1,this._highlightResultRowOnUpdate=!1,this._filterModelActions={},this._filterModelAggVisibility={},this._allowedDisplayModes=[{id:"tree",icon:"tree-view-all",title:this.getLabel(),expandCollapseEnabled:!0}],this._visibleActions=[];for(const e of this._actionDefs)this._visibleActions.push(e.id);this._newSelectionToken=this._plugSvcs.subscribe("NEW_CURRENT_SELECTION_EVENT",this.handle_NEW_CURRENT_SELECTION_EVENT.bind(this))},destroy:function(){null!=this._newSelectionToken&&(this._plugSvcs.unsubscribe(this._newSelectionToken),delete this._newSelectionToken),this._parent()},getHeaderbarItems:function(e){return this._headerbar=e,this._addedSettingsHeaderbarItem=!1,this._showPubsSetting||u.urlHasParam("mergeSettings")||u.urlHasParam("mergeSettingsEX")?(this._addedSettingsHeaderbarItem=!0,[{label:n.ViewSettings,icon:"cog",onclick:function(){this.onSettings(!0)}.bind(this)}]):[]},_displayCABubble:function(){var e=this;require([S],(function(t){var o=e.elements.container,n=e.elements.container.querySelector("#BubbleContainer");if(null!=n)t.show();else{t.initialize2(o,null,"show","bottom-right",(function(t){e.dispatchEvent("onAuthoringCtxAvailable",t);var o={eventID:"info",title:"Work Under",subtitle:"License is valid.",hasHtml:!0};t.isLicenseValid||(o.eventID="warning",o.subtitle=t.Message),d.displayNotification(o)}))}void 0===e.CAJson?(e.CAJson={},t.get2((function(t){e.CAJson=t}))):void 0!==e.CAJson&&e.CAJson.version&&t.set(e.CAJson,(function(e){console.log(e);var t={eventID:"info",title:"Work Under",subtitle:"Active Change Action: "+e.change.title,hasHtml:!0};d.displayNotification(t)}))}))},_hideCABubble:function(){var e=this;require([S],(function(t){t.get2((function(t){e.CAJson=t})),t.cleanAuthDetails(),t.hide()}))},onSettings:function(){var e=this,t=this._showPubsSetting,o=u.urlHasParam("mergeSettings"),i=u.urlHasParam("mergeSettingsEX");const r=Object.freeze({ValCopyTitle:1,ValDisplayWarning:2,ValMaturityColumn:3,ValInstanceTitleColumn:4,ValShow3DShape:5,ValShowColumnHeaders:6,ValAppendCmpCtxMenu:7,ValUseModStatus:8,ValUseMergeCombine:9,ValShowPorts:10,ValShowConnections:11,ValShowCABubble:12,ValHighlightResultRowOnUpdate:13});var a=new l,s=UWA.createElement("div"),c=new E({type:"checkbox"});if(o||i){var g=new p({type:"checkbox",label:"Use Merge overwrite with combine",value:r.ValUseMergeCombine,checkFlag:e._useMergeCombine});g.tooltipInfos=new h({title:"Overwrite with Combine",shortHelp:"Regarding LOT content:<br>- Content found and matched in both Target and Source is overwritten.<br>- Content only found in Target is kept.<br>- Content found only in Source is added.",updateModel:!1,allowUnsafeHTMLShortHelp:!0}),c.addChild(g)}if((t||o||i)&&c.addChild(new p({type:"checkbox",label:n.ShowPublications,value:r.ValShowPorts,checkFlag:e._showPorts})),(o||i)&&c.addChild(new p({type:"checkbox",label:n.ShowMaterials,value:r.ValShowConnections,checkFlag:e._showConnections})),i){var _=new f({value:"Developer settings",emphasize:"warning"});c.addChild(_),c.addChild(new p({type:"checkbox",label:"Copy title from source (client impl only)",value:r.ValCopyTitle,checkFlag:e._copyTitleFromSource})),c.addChild(new p({type:"checkbox",label:"Display warning if access rights do not allow revising",value:r.ValDisplayWarning,checkFlag:e._warningNoRevise})),c.addChild(new p({type:"checkbox",label:"Show Maturity information column",value:r.ValMaturityColumn,checkFlag:e._maturityColumnVisible})),c.addChild(new p({type:"checkbox",label:"Show Instance Title column",value:r.ValInstanceTitleColumn,checkFlag:e._instanceTitleColumnVisible})),c.addChild(new p({type:"checkbox",label:"Show the 3DShape of 3DParts",value:r.ValShow3DShape,checkFlag:e._show_3dshape_of_3dpart})),c.addChild(new p({type:"checkbox",label:"Show column headers",value:r.ValShowColumnHeaders,checkFlag:e._columnHeaderVisible})),c.addChild(new p({type:"checkbox",label:"Show CA bubble",value:r.ValShowCABubble,checkFlag:e._showCABubble})),c.addChild(new p({type:"checkbox",label:"Highlight Result row on update",value:r.ValHighlightResultRowOnUpdate,checkFlag:e._highlightResultRowOnUpdate}))}c.inject(s),c.addEventListener("change",(function(e){a.disableButton("Ok",!1)}));var A=n.ViewSettings+" - "+e.getLabel(),T=a.createDialog(s,{title:A,identifier:"LifecycleMergeStructureViewSettings",container:widget.body,minWidth:250,modalFlag:!0,OKBtnText:R.apply,onOk:function(){var t=c.getButtonFromValue(r.ValCopyTitle);t&&(t.checkFlag!=e._copyTitleFromSource&&e.toggleCopyTitleFromSource());var o=c.getButtonFromValue(r.ValUseMergeCombine);if(o){var n=o.checkFlag;if(n!=e._useMergeCombine&&(e.toggleUseMergeCombine(),n)){d.displayNotification({eventID:"info",title:"Overwrite with combine",subtitle:"Regarding LOT content:<br>- Content found and matched in both Target and Source is overwritten.<br>- Content only found in Target is kept.<br>- Content found only in Source is added.",hasHtml:!0})}}var i=c.getButtonFromValue(r.ValShowPorts);if(i){var s=i.checkFlag;s!=e._showPorts&&(e._showPorts=s)}var l=c.getButtonFromValue(r.ValShowConnections);if(l){var g=l.checkFlag;g!=e._showConnections&&(e._showConnections=g)}(_=c.getButtonFromValue(r.ValShow3DShape))&&((E=_.checkFlag)!=e._show_3dshape_of_3dpart&&(e._show_3dshape_of_3dpart=E));var u=c.getButtonFromValue(r.ValDisplayWarning);u&&(u.checkFlag!=e._warningNoRevise&&e.toggleWarningNoRevise());var p=c.getButtonFromValue(r.ValMaturityColumn);p&&(p.checkFlag!=e._maturityColumnVisible&&e.toggleMaturityColumnVisibility());var _,E,A=c.getButtonFromValue(r.ValInstanceTitleColumn);A&&(A.checkFlag!=e._instanceTitleColumnVisible&&e.toggleInstanceTitleColumnVisibility());(_=c.getButtonFromValue(r.ValShow3DShape))&&((E=_.checkFlag)!=e._show_3dshape_of_3dpart&&(e._show_3dshape_of_3dpart=E));var f=c.getButtonFromValue(r.ValAppendCmpCtxMenu);f&&(f.checkFlag!=e._appendCompareCtxMenu&&e.toggleAppendCompareCtxMenu());var h=c.getButtonFromValue(r.ValShowColumnHeaders);h&&(h.checkFlag!=e._columnHeaderVisible&&e.toggleColumnHeaderVisibility());var R=c.getButtonFromValue(r.ValShowCABubble);R&&(R.checkFlag!=e._showCABubble&&e.toggleCABubbleVisibility());var T=c.getButtonFromValue(r.ValHighlightResultRowOnUpdate);if(T){var S=T.checkFlag;S!=e._highlightResultRowOnUpdate&&(e._highlightResultRowOnUpdate=S)}a.destroy()},onClose:function(){a.destroy()}});a.disableButton("Ok",!0),T.minWidth&&T.elements._mainContentDiv&&T.elements._mainContentDiv.setStyle("min-width",T.minWidth+"px")},toggleCABubbleVisibility:function(){this._showCABubble=!this._showCABubble,this._showCABubble?this._displayCABubble():this._hideCABubble()},toggleColumnHeaderVisibility:function(){var e=this;this._columnHeaderVisible=!this._columnHeaderVisible,this._activeTrees.dataGridViews.forEach((function(t){t.layout.columnsHeader=e._columnHeaderVisible}))},toggleMaturityColumnVisibility:function(){var e=this;this._maturityColumnVisible=!this._maturityColumnVisible,this._activeTrees.dataGridViews.forEach((function(t){t.layout.setColumnOrGroupProperties("maturityState",{visibleFlag:e._maturityColumnVisible})}))},toggleInstanceTitleColumnVisibility:function(){var e=this;this._instanceTitleColumnVisible=!this._instanceTitleColumnVisible,this._activeTrees.dataGridViews.forEach((function(t){t.layout.setColumnOrGroupProperties("instanceTitle",{visibleFlag:e._instanceTitleColumnVisible})}))},setActionInfos:function(e){this._actionInfos=e},_setupActionDefs:function(){this._actionDefsNRF=[{aid:0,id:a.MergeAction.Revise,fontIconName:"flow-branch-add",imagePath:"webapps/LifecycleWidget/assets/icons/32/I_MajorVersion.png",nls:n.Revise},{aid:1,id:a.MergeAction.ReuseReference,fontIconName:"recycle-left",imagePath:"webapps/CompareWidget/assets/icons/32/I_Reuse2L.png",nls:n.ReuseRef},{aid:2,id:a.MergeAction.Reuse,fontIconName:"recycle-right",imagePath:"webapps/CompareWidget/assets/icons/32/I_Reuse2R.png",nls:n.Reuse},{aid:3,id:a.MergeAction.Exclude,fontIconName:"remove",imagePath:"webapps/CompareWidget/assets/icons/32/I_Exclude.png",nls:n.Exclude},{aid:4,id:a.MergeAction.InsertNew,fontIconName:"flow-branch-add",imagePath:"webapps/LifecycleWidget/assets/icons/32/I_NewBranch.png",nls:n.InsertNew}],this._actionDefsMerge=[{aid:5,id:a.MergeAction.ReviseTarget,fontIconName:"flow-line-add",imagePath:"webapps/LifecycleWidget/assets/icons/32/I_MajorVersion.png",nls:n.ReviseTarget},{aid:6,id:a.MergeAction.ReviseTargetTakeSource,fontIconName:"flow-branch-add",imagePath:"webapps/CompareWidget/assets/icons/32/I_Reuse2L.png",nls:n.ReviseTargetTakeSource},{aid:7,id:a.MergeAction.OverwriteTarget,fontIconName:"flow-branch",imagePath:"webapps/CompareWidget/assets/icons/32/I_Reuse2R.png",nls:n.OverwriteTarget},{aid:9,id:a.MergeAction.KeepTarget,fontIconName:"recycle-left",imagePath:"webapps/CompareWidget/assets/icons/32/I_Reuse2L.png",nls:n.KeepTarget},{aid:10,id:a.MergeAction.KeepSource,fontIconName:"recycle-right",imagePath:"webapps/CompareWidget/assets/icons/32/I_Reuse2R.png",nls:n.KeepSource},{aid:11,id:a.MergeAction.DeleteTarget,fontIconName:"remove",imagePath:"webapps/CompareWidget/assets/icons/32/I_Exclude.png",nls:n.DeleteTarget},{aid:12,id:a.MergeAction.AddToTarget,fontIconName:"flow-branch-add",imagePath:"webapps/LifecycleWidget/assets/icons/32/I_NewBranch.png",nls:n.AddInstToTarget},{aid:13,id:a.MergeAction.IgnoreSource,fontIconName:"ignore",imagePath:"webapps/CompareWidget/assets/icons/32/I_Exclude.png",nls:n.IgnoreSource}],this._actionDefs=this._actionDefsNRF.concat(this._actionDefsMerge)},_getActionDefs:function(){return this._actionDefs},get3DSpaceUrl:function(){var e=widget.getUrl();return e.substr(0,e.length-40)},generateDataGridConfig:function(e){var t=this,o=this._parent(e),i=(e.baselineColor,e.compareColor,"4px solid "+t.options.COLOR_RESULT),r="4px solid "+t.options.COLOR_ACTION;for(let e=0;e<2;e++)o[e].cols.forEach((function(e){e.sortableFlag=!1,"tree"===e.dataIndex?e.text=n.ColumnHeaderTitle:"rev"===e.dataIndex&&(e.text=n.ColumnHeaderRevision)})),o[e].cols.splice(1,0,{text:n.ColumnHeaderMaturity,dataIndex:"maturityState",typeRepresentation:"tag",visibleFlag:t._maturityColumnVisible,sortableFlag:!1,width:"80",hasCellValue:function(e){return!!(e.nodeModel&&e.nodeModel.getLabel()&&e.nodeModel.getLabel().length>0)},getCellClassName:function(e){if(e.nodeModel&&e.nodeModel.options.data)return t._getMaturityStateCSSClassFromCRNode(e.nodeModel.options.data)}}),o[e].cols.splice(1,0,{text:n.ColumnHeaderInstanceTitle,icon:{iconName:"flow-cascade",fontIconFamily:1},dataIndex:"instanceTitle",typeRepresentation:"string",visibleFlag:t._instanceTitleColumnVisible,sortableFlag:!1,width:"80"});var a=n.TreePanelCaptionTarget;return"nrf"===t.options.COMMAND_NAME&&(a=n.TreePanelCaptionReference),o[0].gridViewContainerParams.styles.width="33%",o[0].gridViewContainerParams.panelCaption=a,o[0].gridViewContainerParams.panelAddClass="treePanel-ref",o[0].gridViewContainerParams.panelCollapseable=!0,o[0].gridViewContainerParams.initSize50pct=!1,o[1].gridViewContainerParams.styles.width="33%",o[1].gridViewContainerParams.panelCaption=n.TreePanelCaptionSource,o[1].gridViewContainerParams.panelAddClass="treePanel-src",o[1].gridViewContainerParams.panelCollapseable=!0,o[1].gridViewContainerParams.initSize50pct=!1,o.splice(1,0,{identifier:"MergeAction",cols:t.getActionTreeCols(),gridViewContainerParams:{id:"merge-tree-action",panelCaption:"",panelAddClass:"treePanel-act",panelCollapseable:!1,styles:{display:"flex",width:"45px","flex-direction":"column","border-top":r}},createTreeNodeConfig:t.getActionTreeNodeConfig.bind(t)}),o.push({identifier:"MergeResult",cols:t.getResultTreeCols(),gridViewContainerParams:{id:"merge-tree-result",panelCaption:n.Result,panelAddClass:"treePanel-res",panelCollapseable:!1,styles:{display:"flex","flex-direction":"column",width:"33%","border-top":i}},createTreeNodeConfig:t.getResultTreeNodeConfig.bind(t)}),o},getActionTreeNodeConfig:function(e){var t=this._getResultLabelFromCRNode(e),o=i.getTypeFromCRNode(e),n=this._getSelActionNameFromCRNode(e),r=this._getSelActionIdFromCRNode(e),a={menu:this._getAvailableActionsMenuFromCRNode(e)},s=null===e.getParent(),c={data:e,label:t,icons:[e.getAttr("typeIconSmallURL")],grid:{type:o,actionSelectedName:n,actionSelectedId:s?T:r,actionMenu:a,showHideNodeOnTypeAndAttribute:e.getMatchInfo().getShowHideNodeByTypeAndAttrParamIndex(),showByStatusFilter:1}};return i.CRNodeIsCollectorType(e)&&(c.expandedState="collapsed"),c},getResultTreeNodeConfig:function(e){var t=this._getContentColorFromCRNode(e),o=this._getResultLabelFromCRNode(e),n=this._getResultIconsFromCRNode(e),r=this._getRevisionFromCRNode(e),a=i.getTypeFromCRNode(e),s=this._getSelActionNameFromCRNode(e),c=this._getSelActionIdFromCRNode(e),l=null===e.getParent(),d={data:e,label:o,icons:n,grid:{rev:r,Color:t,type:a,actionSelectedName:s,actionSelectedId:l?T:c,showHideNodeOnTypeAndAttribute:e.getMatchInfo().getShowHideNodeByTypeAndAttrParamIndex(),showByStatusFilter:1}};return i.CRNodeIsCollectorType(e)&&(d.expandedState="collapsed"),d},createTreeNodeConfig:function(e){var t=this._parent(e);t.grid.type=i.getTypeFromCRNode(e),t.grid.instanceTitle=this._getInstanceTitleFromCRNode(e),t.grid.maturityState=this._getMaturityStateUserNameFromCRNode(e),t.grid.actionSelectedName=this._getSelActionNameFromCRNode(e),t.grid.actionSelectedId=this._getSelActionIdFromCRNode(e);var o=null===e.getParent();return t.grid.isRoot=o?"TRUE":"FALSE",o&&(t.grid.actionSelectedId=T),i.CRNodeIsCollectorType(e)&&(t.expandedState="collapsed"),t},getActionTreeCols:function(){var e=this;return[{text:n.Action,dataIndex:"actionMenu",width:45,typeRepresentation:"functionMenuIcon",className:"merge-action-menu-column",sortableFlag:!1,resizableFlag:!1,getCellSemantics:function(t){if(t.nodeModel){var o=!1;if(t.nodeModel.options.data){var n=e._getActionInfoFromCRNode(t.nodeModel.options.data);n&&(n.getActions().length<2||n.getEnabledActionCount()<2)&&(o=!0)}return{disabled:o,icon:e._getSelActionIconFromCRNode(t.nodeModel.options.data),label:e._getSelActionNlsNameFromCRNode(t.nodeModel.options.data)}}},getCellTooltip:function(t){if(!t.nodeModel)return t.cellView.collectionView.getCellDefaultTooltip(t);var o=e._getSelActionTooltipFromCRNode(t.nodeModel.options.data);return o.updateModel=!1,o}},{text:n.ColumnHeaderTitle,dataIndex:"tree",visibleFlag:!1,sortableFlag:!1,typeRepresentation:"string",getCellValue:function(t){return e._getResultLabelFromCRNode(t.nodeModel.options.data)},width:"auto"}]},getResultTreeCols:function(){var e=this;return[{text:"",dataIndex:"Color",typeRepresentation:"color",editableFlag:!1,sortableFlag:!1,width:"8.5",minWidth:"8.5",getCellTooltip:function(t){if(!t.nodeModel)return t.cellView.collectionView.getCellDefaultTooltip(t);var o=t.nodeModel.getAttributeValue("Color"),i=n.ContentColorIndicator,r=null,a=n.ContentFromMergeTargetTooltipShort,s=n.ContentFromMergeSourceTooltipShort;return"nrf"===e.options.COMMAND_NAME&&(a=n.ContentFromNRFReferenceTooltipShort,s=n.ContentFromNRFSourceTooltipShort),o===e._contentFromLeftColor?(i=n.ContentFromTarget,"nrf"===e.options.COMMAND_NAME&&(i=n.ContentFromReference),r=a):o===e._contentFromRightColor&&(i=n.ContentFromSource,r=s),{title:i,shortHelp:r,updateModel:!1}},hasCellValue:function(t){return!!e._getContentColorFromCRNode(t.nodeModel.options.data)}},{text:n.ColumnHeaderTitle,dataIndex:"tree",typeRepresentation:"string",sortableFlag:!1,getCellValue:function(t){return e._getResultLabelFromCRNode(t.nodeModel.options.data)},width:"auto"},{text:n.ColumnHeaderRevision,dataIndex:"rev",width:85,typeRepresentation:"string",sortableFlag:!1,getCellValue:function(t){return e._getRevisionFromCRNode(t.nodeModel.options.data)}}]},getEachGridColorColumns:function(){var e=this._parent();e.forEach((function(e){e.forEach((function(e){e.sortableFlag=!1}))}));var t=[];return e.push(t),e.splice(1,0,t),e},_getActionInfoFromCRNode(e){return this._actionInfos.getCRNodeActionInfo(e)},_getContentColorFromCRNode:function(e){var t=null,o=this._getActionInfoFromCRNode(e);if(o){var n=null,i=e.getMatchInfo();if(i&&(n=i.getRelName()),"nrf"===this.options.COMMAND_NAME&&n&&"LEFT_ONLY"===n)return null;var r=o.getActionOptionSelected()?o.getActionOptionSelected().name:"?";r===a.MergeAction.Revise||r===a.MergeAction.InsertNew||r===a.MergeAction.ReviseTargetTakeSource||r===a.MergeAction.OverwriteTarget||r===a.MergeAction.OverwriteTargetInstance||r===a.MergeAction.KeepSource||r===a.MergeAction.AddToTarget||r===a.MergeAction.Reuse?t=this._contentFromRightColor:r!==a.MergeAction.ReuseReference&&r!==a.MergeAction.ReviseTarget&&r!==a.MergeAction.KeepTarget||(t=this._contentFromLeftColor)}return t},_getResultIconsFromCRNode:function(e){var t=[e.getAttr("typeIconSmallURL")],o=this._getActionInfoFromCRNode(e),n=e.getMatchInfo();if(o&&o.getActionOptionSelected()&&n){var i=o.getActionOptionSelected().name,r=n.getRelName(),s=n.getBaseNode()?n.getBaseNode().getAttr("typeIconSmallURL"):null,c=n.getCompNode()?n.getCompNode().getAttr("typeIconSmallURL"):null;i===a.MergeAction.ReuseReference&&"RIGHT_ONLY"===r||i===a.MergeAction.KeepTarget&&"RIGHT_ONLY"===r||i===a.MergeAction.DeleteTarget||i===a.MergeAction.IgnoreSource?t=[]:i===a.MergeAction.KeepTarget||i===a.MergeAction.ReviseTarget||(i===a.MergeAction.ReviseTargetTakeSource||i===a.MergeAction.OverwriteTarget)&&"LEFT_ONLY"===r?t=[s]:i!==a.MergeAction.AddToTarget&&i!==a.MergeAction.KeepSource||(t=[c])}return t},_getResultLabelFromCRNode:function(e){var t=null,o=this._getActionInfoFromCRNode(e);if(o){var n=null,i="",r="",s=e.getMatchInfo();if(s&&(n=s.getRelName(),s.getBaseNode()&&(i=s.getBaseNode().getAttr("title")),s.getCompNode()&&(r=s.getCompNode().getAttr("title"))),"nrf"===this.options.COMMAND_NAME&&n&&"LEFT_ONLY"===n)return null;if(0===o.getActions().length)return this._plugSvcs.warnout("no actions, left title: "+i+", right title: "+r),"No actions!";if(!o.getActionSelected())return this._plugSvcs.warnout("no action selected, left title: "+i+", right title: "+r),"No action selected!";var c=o.getActionOptionSelected().name;c===a.MergeAction.Revise?t=this._copyTitleFromSource?r:i:c===a.MergeAction.ReviseTarget||c===a.MergeAction.ReviseTargetTakeSource||c===a.MergeAction.OverwriteTarget||c===a.MergeAction.OverwriteTargetInstance?t=this._copyTitleFromSource&&r||!i?r:i:c===a.MergeAction.KeepSource||c===a.MergeAction.AddToTarget?t=r:c===a.MergeAction.ReuseReference||c===a.MergeAction.KeepTarget?t=i:c===a.MergeAction.DeleteTarget||c===a.MergeAction.IgnoreSource?t=null:c===a.MergeAction.Reuse?t=o.getActionByOptionName(a.MergeAction.InsertNew)||n&&"IDENTICAL"!==n?r:i:c===a.MergeAction.InsertNew&&(t=r)}return t},_getRevisionFromCRNode:function(e){var t=null,o=this._getActionInfoFromCRNode(e);if(o){var n=null,i="",r="",s=e.getMatchInfo();if(s&&(n=s.getRelName(),s.getBaseNode()&&(i=s.getBaseNode().getAttr("revision")),s.getCompNode()&&(r=s.getCompNode().getAttr("revision"))),"nrf"===this.options.COMMAND_NAME&&n&&"LEFT_ONLY"===n)return null;if(0===o.getActions().length)return"No actions!";if(!o.getActionSelected())return"No action selected!";var c=o.getActionOptionSelected().name;c===a.MergeAction.Revise||c===a.MergeAction.ReviseTarget||c===a.MergeAction.ReviseTargetTakeSource?t=e.getAttr("nextrevision"):c===a.MergeAction.Reuse||c===a.MergeAction.KeepSource?t=r:c===a.MergeAction.ReuseReference||c===a.MergeAction.KeepTarget||c===a.MergeAction.OverwriteTarget||c===a.MergeAction.OverwriteTargetInstance?t=i:c===a.MergeAction.Exclude||c===a.MergeAction.DeleteTarget||c===a.MergeAction.IgnoreSource?t="":c===a.MergeAction.InsertNew||c===a.MergeAction.AddToTarget?(t=e.getAttr("branchrevision"))||(t=e.getAttr("firstRevision")):t=e.getAttr("revision")}return t},_getSelActionNameFromCRNode:function(e){var t="",o=this._getActionInfoFromCRNode(e);if(o){var n=null,i=e.getMatchInfo();i&&(n=i.getRelName()),t="nrf"===this.options.COMMAND_NAME&&n&&"LEFT_ONLY"===n?a.MergeAction.Exclude:o.getActionOptionSelected().name}return t},_getSelActionIdFromCRNode:function(e){var t=0,o=this._getSelActionNameFromCRNode(e);return o&&o.length>0&&(t=this._getActionDefs().find((e=>e.id===o)).aid),t},_getSelActionNlsNameFromCRNode:function(e){var t="",o=this._getSelActionNameFromCRNode(e);return o&&o.length>0&&(t=this._getActionDefs().find((e=>e.id===o)).nls),t},_getSelActionIconFromCRNode:function(e){var t={},o=this._getSelActionNameFromCRNode(e);return o&&o.length>0&&(t=this._getActionIconFromActionName(o)),t},_getSelActionTooltipFromCRNode:function(e){var t=this._getSelActionNameFromCRNode(e);return this._getSelActionTooltipFromActionName(t)},_getSelActionTooltipFromActionName:function(e){var t={};if(e&&e.length>0){var o=this._getActionDefs().find((t=>t.id===e)).nls,i=null;switch(e){case a.MergeAction.Revise:i=n.TooltipShortSelActionRevise;break;case a.MergeAction.Reuse:i=n.TooltipShortSelActionReuse;break;case a.MergeAction.ReuseReference:i=n.TooltipShortSelActionReuseRef;break;case a.MergeAction.Exclude:i=n.TooltipShortSelActionExclude;break;case a.MergeAction.InsertNew:i=n.TooltipShortSelActionInsertNew;break;case a.MergeAction.ReviseTarget:i=n.TooltipShortSelActionReviseTarget;break;case a.MergeAction.ReviseTargetTakeSource:i=n.TooltipShortSelActionReviseTargetTakeSource;break;case a.MergeAction.OverwriteTarget:i=n.TooltipShortSelActionOverwriteTarget;break;case a.MergeAction.DeleteTarget:i=n.TooltipShortSelActionDeleteTarget;break;case a.MergeAction.IgnoreSource:i=n.TooltipShortSelActionIgnoreSource;break;case a.MergeAction.KeepTarget:i=n.TooltipShortSelActionKeepTarget;break;case a.MergeAction.KeepSource:i=n.TooltipShortSelActionKeepSource;break;case a.MergeAction.AddToTarget:i=n.TooltipShortSelActionAddInstToTarget}t.title=o,t.shortHelp=i}return t},_getActionTooltipFromActionName:function(e,t){var o=this._getSelActionTooltipFromActionName(e);return t&&(o.longHelp=o.shortHelp,o.shortHelp=n.replace(n.TooltipShortActionMulti,{actionName:o.title})),o},_getActionIconFromActionName:function(e){var t={iconName:this._getActionDefs().find((t=>t.id===e)).fontIconName,fontIconFamily:1};return e===a.MergeAction.ReuseReference||e===a.MergeAction.Reuse||e!==a.MergeAction.Revise&&e!==a.MergeAction.ReviseTargetTakeSource&&e!==a.MergeAction.OverwriteTarget&&e!==a.MergeAction.OverwriteTargetInstance||(t.className="merge-image-flipandup"),t},_getAvailableActionsMenuFromCRNode:function(e,t,o){var r=this,s=[],l=r._getActionInfoFromCRNode(e);if(l){var d=l.getEnabledActions(),g=!1;for(const t of d)t.actionOption.name===a.MergeAction.Revise&&(g=!0),s.push({type:"CheckItem",state:t.isSelected?"selected":"unselected",title:t.actionOption.nls,tooltip:r._getActionTooltipFromActionName(t.actionOption.name,!1),icon:r._getActionIconFromActionName(t.actionOption.name),action:{callback:function(){r._handleActionSelectionChange(t,e),e.__TREENODE__.setAttribute("actionSelectedName",r._getSelActionNameFromCRNode(e)),e.__TREENODE__.setAttribute("actionSelectedId",r._getSelActionIdFromCRNode(e)),r.updateToolbarForSelection()}}});o&&g&&s.splice(1,0,{type:"PushItem",title:n.ReviseTree,icon:{iconName:"tree-revision-update",fontIconFamily:1},action:{callback:function(){r._handleNodeAction(e.__TREENODE__,a.MergeAction.Revise),e.__TREENODE__.getAllDescendants().forEach((function(e){r._handleNodeAction(e,a.MergeAction.Revise)})),r.updateToolbarForSelection()}}})}return t&&i.CRNodeIsCollectorType(e)&&(u.urlHasParam("mergeSettings")||u.urlHasParam("mergeSettingsEX"))&&c.nodeHasLeftOnlyChild(e)&&(s.push({type:"SeparatorItem"}),s.push({type:"PushItem",title:"Combine",icon:{iconName:"left-add",fontIconFamily:1},action:{callback:function(){var t=e.__TREENODE__.getAllDescendants(),o=!1;t.forEach((function(e){var t=e.options.data;if(t&&c.nodeIsLeftOnly(t)){var n=r._handleNodeAction(e,a.MergeAction.KeepTarget);o=o||n}})),o&&r.updateToolbarForSelection()}}})),1===s.length&&(s=[]),s},_getMaturityStateUserNameFromCRNode(e){var t="",o=this._getMaturityStateInfoFromCRNode(e);return o&&(t=o.stateUserName),t},_getMaturityStateCSSClassFromCRNode(e){var t="",o=e.getAttr("policy"),n=this._getMaturityStateInfoFromCRNode(e);if(n){var i=o+"."+n.stateSysName;t=r.getMaturityClass(i,"wux-controls-label")}return t},_getInstanceTitleFromCRNode(e){var t="INST.ro.plminstance.plm_externalid",o="";return e&&e.getAttr(t)&&(o=e.getAttr(t)),o},_getMaturityStateInfoFromCRNode(e){var t=null,o="last.current",n="policy",i="",r="";if(e)if(e.getAttr(o))r=e.getAttr(n),i=e.getAttr(o);else{var a=e.getMatchInfo();if(a){var s=a.getBaseNode();if(s.getAttr(o))r=s.getAttr(n),i=s.getAttr(o);else{var c=a.getCompNode();c.getAttr(o)&&(r=c.getAttr(n),i=c.getAttr(o))}}}var l=this._maturityStatesInfo.policies.find((e=>e.policyName===r));return l&&(t=l.states.find((e=>e.stateSysName===i))),t},_handleActionSelectionChange(e,t){var o=this,n=this._getActionInfoFromCRNode(t);if(n){var i=n.getActionOptionSelected(),r=o._actionInfos.updateActionSelected(t,e.actionOption.name);o._plugSvcs.dbgout("Changed from action "+i.nls+" to action "+e.actionOption.nls+".");var a={match:function(e){var t=e.nodeModel.options.data;if(t){var o=t.getAttr("physicalID_REF");if(r.has(o))return!0;var n=t.getMatchInfo();if(n){var i=n.getBaseNode().getAttr("physicalID_REF");if(i&&r.has(i))return!0;var a=n.getCompNode().getAttr("physicalID_REF");if(a&&r.has(a))return!0}}return!1}},s=o._activeTrees.dataGridViews[0];let g=s.getTreeDocument().search(a);s.getTreeDocument().prepareUpdate(),g.forEach((function(e){var t={grid:{actionSelectedName:o._getSelActionNameFromCRNode(e.options.data),actionSelectedId:o._getSelActionIdFromCRNode(e.options.data)}};e.updateOptions(t)})),s.getTreeDocument().pushUpdate();var c=o._activeTrees.dataGridViews[1];let u=c.getTreeDocument().search(a);c.getTreeDocument().prepareUpdate(),u.forEach((function(e){var t={grid:{actionMenu:{menu:o._getAvailableActionsMenuFromCRNode(e.options.data)},actionSelectedName:o._getSelActionNameFromCRNode(e.options.data),actionSelectedId:o._getSelActionIdFromCRNode(e.options.data)}};e.updateOptions(t)})),c.getTreeDocument().pushUpdate();var l=o._activeTrees.dataGridViews[2];let p=l.getTreeDocument().search(a);l.getTreeDocument().prepareUpdate(),p.forEach((function(e){var t={grid:{actionSelectedName:o._getSelActionNameFromCRNode(e.options.data),actionSelectedId:o._getSelActionIdFromCRNode(e.options.data)}};e.updateOptions(t)})),l.getTreeDocument().pushUpdate();var d=o._activeTrees.dataGridViews[3];let _=d.getTreeDocument().search(a);d.getTreeDocument().prepareUpdate(),_.forEach((function(e){var t={label:o._getResultLabelFromCRNode(e.options.data),icons:o._getResultIconsFromCRNode(e.options.data),grid:{Color:o._getContentColorFromCRNode(e.options.data),actionSelectedName:o._getSelActionNameFromCRNode(e.options.data),actionSelectedId:o._getSelActionIdFromCRNode(e.options.data)}};e.updateOptions(t),o._highlightResultRowOnUpdate&&d.flashEffectOnNodeModel("ui-modified-push-notif",e)})),d.getTreeDocument().pushUpdate()}},getMergeActionsButtonsForToolbar:function(){var e=this,t=[];return t.push({id:"cmdReviseTarget",dataElements:{domId:"merge-struct-revise-target-button",typeRepresentation:"functionIcon",category:"mergeActions",position:"far",priority:150,tooltip:e._getActionTooltipFromActionName(a.MergeAction.ReviseTarget,!0),icon:e._getActionIconFromActionName(a.MergeAction.ReviseTarget),value:t=>e.onAction(a.MergeAction.ReviseTarget)}}),t.push({id:"cmdReviseTargetTakeSource",dataElements:{domId:"merge-struct-revise-target-take-source-button",typeRepresentation:"functionIcon",category:"mergeActions",position:"far",priority:151,tooltip:e._getActionTooltipFromActionName(a.MergeAction.ReviseTargetTakeSource,!0),icon:e._getActionIconFromActionName(a.MergeAction.ReviseTargetTakeSource),value:t=>e.onAction(a.MergeAction.ReviseTargetTakeSource)}}),t.push({id:"cmdOverwriteTarget",dataElements:{domId:"merge-struct-overwrite-target-button",typeRepresentation:"functionIcon",category:"mergeActions",position:"far",priority:152,tooltip:e._getActionTooltipFromActionName(a.MergeAction.OverwriteTarget,!0),icon:e._getActionIconFromActionName(a.MergeAction.OverwriteTarget),value:t=>e.onAction(a.MergeAction.OverwriteTarget)}}),t.push({id:"cmdKeepTarget",dataElements:{domId:"merge-struct-keep-target-button",typeRepresentation:"functionIcon",category:"mergeActions",position:"far",priority:153,tooltip:e._getActionTooltipFromActionName(a.MergeAction.KeepTarget,!0),icon:e._getActionIconFromActionName(a.MergeAction.KeepTarget),value:t=>e.onAction(a.MergeAction.KeepTarget)}}),t.push({id:"cmdKeepSource",dataElements:{domId:"merge-struct-keep-source-button",typeRepresentation:"functionIcon",category:"mergeActions",position:"far",priority:154,tooltip:e._getActionTooltipFromActionName(a.MergeAction.KeepSource,!0),icon:e._getActionIconFromActionName(a.MergeAction.KeepSource),value:t=>e.onAction(a.MergeAction.KeepSource)}}),t.push({id:"cmdDeleteTarget",dataElements:{domId:"merge-struct-delete-target-button",typeRepresentation:"functionIcon",category:"mergeActions",position:"far",priority:155,tooltip:e._getActionTooltipFromActionName(a.MergeAction.DeleteTarget,!0),icon:e._getActionIconFromActionName(a.MergeAction.DeleteTarget),value:t=>e.onAction(a.MergeAction.DeleteTarget)}}),t.push({id:"cmdAddToTarget",dataElements:{domId:"merge-struct-add-to-target-button",typeRepresentation:"functionIcon",category:"mergeActions",position:"far",priority:156,tooltip:e._getActionTooltipFromActionName(a.MergeAction.AddToTarget,!0),icon:e._getActionIconFromActionName(a.MergeAction.AddToTarget),value:t=>e.onAction(a.MergeAction.AddToTarget)}}),t.push({id:"cmdIgnoreSource",dataElements:{domId:"merge-struct-ignore-source-button",typeRepresentation:"functionIcon",category:"mergeActions",position:"far",priority:155,tooltip:e._getActionTooltipFromActionName(a.MergeAction.IgnoreSource,!0),icon:e._getActionIconFromActionName(a.MergeAction.IgnoreSource),value:t=>e.onAction(a.MergeAction.IgnoreSource)}}),t},getNRFActionsButtonsForToolbar:function(){var e=this,t=[];return t.push({id:"cmdRevise",dataElements:{domId:"merge-struct-revise-button",typeRepresentation:"functionIcon",category:"mergeActions",position:"far",priority:150,tooltip:e._getActionTooltipFromActionName(a.MergeAction.Revise,!0),icon:e._getActionIconFromActionName(a.MergeAction.Revise),value:t=>e.onAction(a.MergeAction.Revise)}}),t.push({id:"cmdReuseRef",dataElements:{domId:"merge-struct-reuse-left-button",typeRepresentation:"functionIcon",visibleFlag:!1,category:"mergeActions",position:"far",priority:151,tooltip:e._getActionTooltipFromActionName(a.MergeAction.ReuseReference,!0),icon:e._getActionIconFromActionName(a.MergeAction.ReuseReference),value:t=>e.onAction(a.MergeAction.ReuseReference)}}),t.push({id:"cmdReuse",dataElements:{domId:"merge-struct-reuse-right-button",typeRepresentation:"functionIcon",category:"mergeActions",position:"far",priority:152,tooltip:e._getActionTooltipFromActionName(a.MergeAction.Reuse,!0),icon:e._getActionIconFromActionName(a.MergeAction.Reuse),value:t=>e.onAction(a.MergeAction.Reuse)}}),t.push({id:"cmdInsertNew",dataElements:{domId:"merge-struct-insert-new-button",typeRepresentation:"functionIcon",category:"mergeActions",position:"far",priority:153,tooltip:e._getActionTooltipFromActionName(a.MergeAction.InsertNew,!0),icon:e._getActionIconFromActionName(a.MergeAction.InsertNew),value:t=>e.onAction(a.MergeAction.InsertNew)}}),t},applyOtherMenuCommands:function(){var e=this,t=this._parent(),o=[];toolbarActionButtons=[],"nrf"===this.options.COMMAND_NAME?toolbarActionButtons=this.getNRFActionsButtonsForToolbar():toolbarActionButtons=this.getMergeActionsButtonsForToolbar(),o.push(...toolbarActionButtons);var i=[],r=[];r="nrf"===this.options.COMMAND_NAME?this._actionDefsNRF:this._actionDefsMerge;for(const t of r)i.push({id:t.id,domId:"merge-struct-action-filter-menuitem-"+t.id,type:"CheckItem",title:t.nls,tooltip:{title:t.nls,shortHelp:n.replace(n.ActionFilterItemActionNameTooltip,{actionName:t.nls})},icon:e._getActionIconFromActionName(t.id),state:e._visibleActions.includes(t.id)?"selected":"unselected",action:{callback:function(){e.applyActionFilter(t.id)}}});i.push({type:"SeparatorItem"}),i.push({id:"refresh",type:"PushItem",title:n.ReapplyCurrentFilter,tooltip:{title:n.ReapplyCurrentFilter,shortHelp:n.ReapplyCurrentFilterTooltip},icon:{iconName:"refresh",fontIconFamily:1},action:{callback:function(){e.reapplyFilter()}}}),o.push({id:"actionFilter",dataElements:{domId:"merge-struct-action-filter-button",typeRepresentation:"functionMenuIcon",category:"actionFilter",position:"far",priority:154,tooltip:{title:n.ActionFilter,shortHelp:n.ActionFilterTooltip},icon:{iconName:"filter-select-on",fontIconFamily:1},value:{menu:i}}}),o.push(...t);var a=n.Merge,s=n.MergeCommandTooltip;return"nrf"===e.options.COMMAND_NAME&&(a=n.NewRevisionFrom,s=n.ReviseCommandTooltip),o.push({id:"cmdMerge",dataElements:{domId:"merge-struct-merge-button",typeRepresentation:"function",emphasize:"primary",category:"mergeAction",position:"far",priority:999,label:a,tooltip:{title:a,shortHelp:s},value:t=>e.onMerge()}}),o},_getMaturityStatesAttributes:function(e){var t=this;return new UWA.Class.Promise((function(o,n){var i=new Set;e.visitAll_treeAndFN(0,(function(e){var t=e.getAttr("policy");t&&i.add(t)})),e.visitAll_treeAndFN(1,(function(e){var t=e.getAttr("policy");t&&i.add(t)}));var r={policies:Array.from(i)},a=e.getRoot(0).getObjIDSpec_REF(),s=a.getTenant(),c=a.getServiceName(),l=a.getSecurityContext(),d=t._plugSvcs.nowMS();t._plugSvcs.makeAuthHttpsCall("/resources/lifecycle/maturity/getStatesAttributes","POST",r,"json",s,c,l).then((function(e){t._plugSvcs.reportTime(d,"getStatesAttributes request OK.");var n="string"==typeof e?JSON.parse(e):e;o(n)}),(function(e){t._plugSvcs.reportTime(d,"getStatesAttributes request failed."),t._plugSvcs.showAlertBox("getStatesAttributes request unsuccessful.",null,"error"),t._plugSvcs.errout("Failure of getStatesAttributes request: "+e)}))}))},_getLifecycleMergeEnabled:function(e){var t=this;return new UWA.Class.Promise((function(o,n){var i=e.getRoot(0).getObjIDSpec_REF(),r=i.getTenant(),a=i.getServiceName(),s=i.getSecurityContext(),c=t._plugSvcs.nowMS();t._plugSvcs.makeAuthHttpsCall("/resources/lifecycle/util/getExpression","GET","expression=LifecycleMergeEnabled","json",r,a,s).then((function(e){t._plugSvcs.reportTime(c,"getExpression request OK.");var n=null;e&&e.result&&(n=e.result),o(n)}),(function(e){t._plugSvcs.reportTime(c,"getExpression request failed."),t._plugSvcs.showAlertBox("getExpression request unsuccessful.",null,"error"),t._plugSvcs.errout("Failure of getExpression request: "+e),n("getExpression request failed.")}))}))},_getVersionNumberProposal:function(e,t){var o=this;return new UWA.Class.Promise((function(n,i){var r=e.getRoot(0).getObjIDSpec_REF(),a=r.getTenant(),s=r.getServiceName(),c=r.getSecurityContext(),l=o._plugSvcs.nowMS();o._plugSvcs.makeAuthHttpsCall("/resources/v1/dslc/getversionnumberproposal","POST",t,"json",a,s,c).then((function(e){o._plugSvcs.reportTime(l,"getversionnumberproposal request OK.");var t="string"==typeof e?JSON.parse(e):e;n(t)}),(function(e){o._plugSvcs.reportTime(l,"getversionnumberproposal request failed."),o._plugSvcs.showAlertBox("getversionnumberproposal request unsuccessful.",null,"error"),o._plugSvcs.errout("Failure of getversionnumberproposal request: "+e)}))}))},_getNextRevisionInfo:function(e){var t=new Set;e.visitAll_treeAndFN(0,(function(e){var o=e.getMatchInfo();if(o){var n=o.getBaseNode();if(!n||n.isDummy()||c.nodeIsComposee(n)||c.nodeIsCollectorType(n)){var i=o.getCompNode();if(i&&!i.isDummy()&&!c.nodeIsComposee(i)&&!c.nodeIsCollectorType(i))(r=i.getAttr("physicalID_REF"))&&t.add(r)}else{var r;(r=n.getAttr("physicalID_REF"))&&t.add(r)}}}));var o=[],n=[];t.forEach((function(e){(n=[]).push({semantic:"LAST",id:e}),o.push({copyId:e,ancestors:n})}));var i={addRequests:o};return this._getVersionNumberProposal(e,i)},_getBranchInfo:function(e){var t=new Set;if(e.visitAll_treeAndFN(0,(function(e){var o=e.getMatchInfo();if(o){var n=o.getBaseNode();if(n&&!n.isDummy());else{var i=o.getCompNode();if(i&&!i.isDummy()&&!c.nodeIsComposee(i)){var r=i.getAttr("physicalID_REF");if(r){var a=c.getNodeDefaultBranchIntent(i);t.add({pid:r,intent:a})}}}}})),0===t.size)return new UWA.Class.Promise((function(e,t){e({addRequests:[]})}));var o=[],n=[];t.forEach((function(e){(n=[]).push({semantic:e.intent,id:e.pid}),o.push({copyId:e.pid,ancestors:n})}));var i={addRequests:o};return this._getVersionNumberProposal(e,i)},_populateNextRevisionInfo:function(e,t){e.getNextRev=function(e){var t=this.addRequests.find((t=>t.copyId===e));return t?t.code:null},t.visitAll_treeAndFN(1,(function(t){var o=t.getMatchInfo();if(o){var n=o.getBaseNode();if(n&&!n.isDummy()){if(i=n.getAttr("physicalID_REF"))(r=e.getNextRev(i))&&t.addAttr("nextrevision",r)}else{var i,r,a=o.getCompNode();if(i=a.getAttr("physicalID_REF"))(r=e.getNextRev(i))&&a.addAttr("nextrevision",r)}}}))},_populateBranchRevisionInfo:function(e,t){e&&e.addRequests&&0!==e.addRequests.length&&(e.getBranchRev=function(e){var t=this.addRequests.find((t=>t.copyId===e));return t?t.code:null},t.visitAll_treeAndFN(1,(function(t){var o=t.getMatchInfo();if(o){var n=o.getBaseNode();if(n&&!n.isDummy()){if(i=n.getAttr("physicalID_REF"))(r=e.getBranchRev(i))&&t.addAttr("branchrevision",r)}else{var i,r,a=o.getCompNode();if(i=a.getAttr("physicalID_REF"))(r=e.getBranchRev(i))&&a.addAttr("branchrevision",r)}}})))},_addCSSMaturityClasses:function(){r.addCSSMaturityClasses(this._maturityStatesInfo.policies,"wux-controls-label")},_addViewSettingsToHeaderbar:function(){var e=this._headerbar.createClickButton(n.ViewSettings,"cog",function(){this.onSettings(!0)}.bind(this)),t=[];t.push(e),t.push("|");var o=t.concat(this._headerbar.groups[0].items);this._headerbar.groups[0].items=o,this._headerbar.rebuild(this._headerbar.groups)},updateResults:function(t,o){var n=this,i=this._getNextRevisionInfo(o),r=this._getBranchInfo(o),a=this._getMaturityStatesAttributes(o),s=Promise.resolve("FALSE");return this.options.COMMAND_NAME&&"nrf"!==this.options.COMMAND_NAME&&(s=this._getLifecycleMergeEnabled(o)),UWA.Promise.all([i,r,a,s]).then((function(i){var r=i[0],a=i[1];n._maturityStatesInfo=i[2];var s=i[3];return n._showPubsSetting="WITHPUBSOPTION"===s,n._showPubsSetting&&!n._addedSettingsHeaderbarItem&&n._headerbar&&(n._addViewSettingsToHeaderbar(),n._addedSettingsHeaderbarItem=!0),n._addCSSMaturityClasses(),n._populateNextRevisionInfo(r,o),n._populateBranchRevisionInfo(a,o),e.prototype.updateResults.call(n,t,o)}))},setup_tree:function(){var e=this;e._listTrees&&e._listTrees.hide(),e._structTrees&&e._structTrees.show(),e._structMatchPairArray=e._crTree.getMatchPairArray(),e._setup_allMatchPair_hiddenByTypeAttr(e._structMatchPairArray,e._aggVisibilityFilterModels.showHideNodeOnTypeAndAttribute),e._flagInfo.createFlagDisplayData("tree",e._structMatchPairArray,e._forceRootsTogether),e._activeColData=[e._crTree.getRoot(0),e._crTree.getRoot(1),e._crTree.getRoot(1),e._crTree.getRoot(1)],e._activeMatchPairArray=e._structMatchPairArray,e._flagInfo.setActive("tree"),e._activeTrees=e._structTrees},getTreePanelCaptions:function(){function e(e,t,o,i){var r={label:[]},a=n.TreePanelCaptionTarget;return"left"===i&&"nrf"===e.options.COMMAND_NAME?a=n.TreePanelCaptionReference:"right"===i?a=n.TreePanelCaptionSource:"result"===i&&(a=n.Result),r.label.push({text:a,id:"treePanel-caption-title-"+i}),r.label.push({text:"",id:"treePanel-caption-revision-"+i}),t&&t.hasExternalFilter()&&r.label.push({text:t.getExternalFilterName(),id:"treePanel-caption-filter-"+i}),r}var t=this._parent(),o=this._crTree.getRoot(1).getMatchInfo();if(o){this._crTree.getRootObjIDSpec(0),this._crTree.getRootObjIDSpec(1);let n=e(this,o.getBaseNode(),0,"left"),i=e(this,o.getCompNode(),0,"right"),r=e(this,null,0,"result");n&&i&&t.forEach((function(e){"compare-tree-left"===e.panelContentId?e.panelCaption=n:"compare-tree-right"===e.panelContentId&&(e.panelCaption=i)})),r&&t.push({panelContentId:"merge-tree-result",panelCaption:r})}return t},_highlightLinkedNodesOfCRNodes:function(e,t){if(!e||!Array.isArray(e)||e.length<=0)return;let o=new Set,n=new Set;for(const i of e){let e=null;switch(t){case"pointed":e=i._pointedNodes;break;case"referencedBy":e=i._referencedByNodes;break;default:console.log("highlight of links of type "+t+" is unknown.")}if(e&&Array.isArray(e)&&e.length>0)for(const t of e){let e=t.getAttr("physicalID_REF"),i=t.getAttr("physicalID_INST");i&&o.add(i),e&&n.add(e)}}if(0==n.size)return;var r={match:function(e){var t=e.nodeModel.options.data;if(t&&!i.CRNodeIsCollectorType(t)){var r=t.getAttr("physicalID_REF"),a=t.getAttr("physicalID_INST");if(n.has(r)&&o.has(a))return!0}return!1}};let a=this._activeTrees.dataGridViews[0],s=a.getTreeDocument().search(r),c=this._activeTrees.dataGridViews[2],l=c.getTreeDocument().search(r),d="ui-modified";switch(t){case"pointed":d="ui-modified";break;case"referencedBy":d="ui-pointed-node"}s.forEach((function(e){a.flashEffectOnNodeModel(d,e)})),l.forEach((function(e){c.flashEffectOnNodeModel(d,e)}))},onTreesReady:function(e){this._parent(e),this._treesAreReady=!0},toggleCreateARevision:function(){this._createARevision=!this._createARevision;var e=this.standardToolbar.toolbarOtherItems.getNodeModelByID("mergePanelSettings");if(e){var t=e.options.grid.data.menu.find((e=>"createARevision"===e.id));t&&(t.state=this._createARevision?"selected":"unselected")}},toggleAppendCompareCtxMenu:function(){this._appendCompareCtxMenu=!this._appendCompareCtxMenu;var e=this.standardToolbar.toolbarOtherItems.getNodeModelByID("mergePanelSettings");if(e){var t=e.options.grid.data.menu.find((e=>"appendCompareCtxMenu"===e.id));t&&(t.state=this._appendCompareCtxMenu?"selected":"unselected")}},toggleCopyTitleFromSource:function(){this._copyTitleFromSource=!this._copyTitleFromSource;var e=this.standardToolbar.toolbarOtherItems.getNodeModelByID("mergePanelSettings");if(e){var t=e.options.grid.data.menu.find((e=>"copyTitleFromSource"===e.id));t&&(t.state=this._copyTitleFromSource?"selected":"unselected")}this.updateResult_CopyTitleFromSource()},toggleUseMergeCombine:function(){this._useMergeCombine=!this._useMergeCombine;var e=this.standardToolbar.toolbarOtherItems.getNodeModelByID("mergePanelSettings");if(e){e.options.grid.data.menu.find((e=>"useMergeCombine"===e.id));useMergeCombine&&(useMergeCombine.state=this._useMergeCombine?"selected":"unselected")}},toggleWarningNoRevise:function(){this._warningNoRevise=!this._warningNoRevise;var e=this.standardToolbar.toolbarOtherItems.getNodeModelByID("mergePanelSettings");if(e){var t=e.options.grid.data.menu.find((e=>"warningNoRevise"===e.id));t&&(t.state=this._warningNoRevise?"selected":"unselected")}this.handleUpdateToShowWarningWhenNoAccessRight()},handleUpdateToShowWarningWhenNoAccessRight:function(){var e=!1;this._warningNoRevise&&(s.verifyEverythingIsRevisionable(this._crTree,!0)||(e=!0));this.standardToolbar.toolbarOtherItems.updateNodeModel("cmdMerge",{disabled:e})},updateResult_CopyTitleFromSource:function(){var e=this,t={match:function(e){var t=e.nodeModel.options.grid.actionSelectedName;return!!(t&&t===a.MergeAction.Revise||t===a.MergeAction.ReviseTarget||t===a.MergeAction.ReviseTargetTakeSource||t===a.MergeAction.OverwriteTarget||t===a.MergeAction.OverwriteTargetInstance)}},o=e._activeTrees.dataGridViews[3];let n=o.getTreeDocument().search(t);o.getTreeDocument().prepareUpdate(),n.forEach((function(t){var n={label:e._getResultLabelFromCRNode(t.options.data)};t.updateOptions(n),e._highlightResultRowOnUpdate&&o.flashEffectOnNodeModel("ui-modified-push-notif",t)})),o.getTreeDocument().pushUpdate()},updateActionFilter:function(e){var t=this.standardToolbar.toolbarOtherItems.getNodeModelByID("actionFilter").options.grid.data.menu.find((t=>t.id===e)),o=this._visibleActions;o.includes(e)?(o.splice(o.indexOf(e),1),t.state="unselected"):(o.push(e),t.state="selected"),this._visibleActions=o;var n=[];for(const e of o){var i=this._getActionDefs().find((t=>t.id===e)).aid;n.push(i)}n.push(T),this._aggVisibilityFilterModels.actionSelectedId={filterId:"set",filterModel:n}},applyActionFilter:function(e){this.updateActionFilter(e),this.applyCurrentFilterToTrees()},reapplyFilter:function(){this.applyCurrentFilterToTrees()},handle_NEW_CURRENT_SELECTION_EVENT:function(e){this.updateToolbarForSelection()},updateToolbarForSelection:function(){var e=this,t=e._plugSvcs.nowMS(),o=new Set;this._activeTrees.dataGridViews[0].getTreeDocument().getSelectedNodes().forEach((function(t){var n=t.options.data;if(n){var i=e._getActionInfoFromCRNode(n);if(i)i.getEnabledActionsNotSelected().forEach((function(e){o.add(e.actionOption.name)}))}}));var n=!o.has(a.MergeAction.Revise),i=!o.has(a.MergeAction.Reuse),r=!o.has(a.MergeAction.ReuseReference),s=!o.has(a.MergeAction.InsertNew);e.standardToolbar.toolbarOtherItems.updateNodeModel("cmdRevise",{disabled:n}),e.standardToolbar.toolbarOtherItems.updateNodeModel("cmdReuse",{disabled:i}),e.standardToolbar.toolbarOtherItems.updateNodeModel("cmdReuseRef",{disabled:r}),e.standardToolbar.toolbarOtherItems.updateNodeModel("cmdInsertNew",{disabled:s});var c=!o.has(a.MergeAction.ReviseTarget),l=!o.has(a.MergeAction.ReviseTargetTakeSource),d=!o.has(a.MergeAction.OverwriteTarget),g=!o.has(a.MergeAction.KeepTarget),u=!o.has(a.MergeAction.KeepSource),p=!o.has(a.MergeAction.DeleteTarget),_=!o.has(a.MergeAction.AddToTarget),E=!o.has(a.MergeAction.IgnoreSource);e.standardToolbar.toolbarOtherItems.updateNodeModel("cmdReviseTarget",{disabled:c}),e.standardToolbar.toolbarOtherItems.updateNodeModel("cmdReviseTargetTakeSource",{disabled:l}),e.standardToolbar.toolbarOtherItems.updateNodeModel("cmdOverwriteTarget",{disabled:d}),e.standardToolbar.toolbarOtherItems.updateNodeModel("cmdKeepTarget",{disabled:g}),e.standardToolbar.toolbarOtherItems.updateNodeModel("cmdKeepSource",{disabled:u}),e.standardToolbar.toolbarOtherItems.updateNodeModel("cmdDeleteTarget",{disabled:p}),e.standardToolbar.toolbarOtherItems.updateNodeModel("cmdAddToTarget",{disabled:_}),e.standardToolbar.toolbarOtherItems.updateNodeModel("cmdIgnoreSource",{disabled:E}),e._plugSvcs.reportTime(t,"Merge view panel handled new selection.")},onTreesLoaded:function(){var e=this._actionInfos.getOptions().reuseReferenceEnabled;if(this.standardToolbar.toolbarOtherItems.updateNodeModel("cmdReuseRef",{visibleFlag:e}),!e){var t=this.standardToolbar.toolbarOtherItems.getNodeModelByID("actionFilter"),o=t.options.grid.data.menu.findIndex((e=>e.id===a.MergeAction.ReuseReference));o>-1&&t.options.grid.data.menu.splice(o,1)}this.handleUpdateToShowWarningWhenNoAccessRight(),this.checkDataInStructuresAreMergeable()},checkDataInStructuresAreMergeable:function(){if("merge"===this.options.COMMAND_NAME){var e=!1;if(!s.verifyEverythingIsMergeable(this._crTree)){e=!0,this.standardToolbar.toolbarOtherItems.updateNodeModel("cmdMerge",{disabled:e}),this.showNotifMsg(n.MergeAlertUnsupportedDataNotifMsg);var t=this.getWidgetCloseButton();if(t){var o=n.MergeAlertUnsupportedDataDlgMsg,i=n.Merge,r=new l,a=r.createDialog(o,{title:i,identifier:"LifecycleConfirmCloseMerge",container:widget.body,modalFlag:!0,buttonStyle:r.buttonStyle.ok,closeButtonFlag:!1,onOk:function(){r.destroy(),t.click()},onClose:function(){r.destroy()}}),c=r.getButton("Ok");c&&(c.label=a.getDefaultButtonLabel("Close"))}}}},_handleNodeAction:function(e,t){var o=this,n=!1,i=e.options.data;if(i){var r=o._getActionInfoFromCRNode(i);if(r){var a=r.getActionByOptionName(t);a&&a.isEnabled&&!a.isSelected&&(o._handleActionSelectionChange(a,i),e.setAttribute("actionSelectedName",o._getSelActionNameFromCRNode(i)),e.setAttribute("actionSelectedId",o._getSelActionIdFromCRNode(i)),n=!0)}}return n},onAction:function(e,t){var o=this;this._activeTrees.dataGridViews[0].getTreeDocument().getSelectedNodes().forEach((function(n){(o._handleNodeAction(n,e),t)&&n.getAllDescendants().forEach((function(t){o._handleNodeAction(t,e)}))})),this.updateToolbarForSelection()},onMerge:function(){var e=this,t=n.MergeConfirmMsg,o=n.MergeConfirmTitle,i=n.MergeConfirmOKLabel;"nrf"===e.options.COMMAND_NAME&&(t=n.NRFConfirmMsg,o=n.NRFConfirmTitle,i=n.NRFConfirmOKLabel);var r=new l;r.createDialog(t,{title:o,identifier:"LifecycleConfirmMerge",container:widget._isODTMode()?document.body:widget.body,modalFlag:!0,OKBtnText:i,onOk:function(){r.destroy(),e.doMerge()},onClose:function(){r.destroy()}})},doMerge:function(){this._plugSvcs.postEvent("EXECUTE_MERGE_EVENT")},doPostMergeOK:function(){var e=this;e.standardToolbar.toolbarOtherItems.updateNodeModel("cmdMerge",{disabled:!0});var t=e.getWidgetCloseButton();if(t){var o=n.MergeConfirmCloseDialogMsg,i=n.Merge;"nrf"===e.options.COMMAND_NAME&&(o=n.NRFConfirmCloseDialogMsg,i=n.NewRevisionFrom);var r=new l,a=r.createDialog(o,{title:i,identifier:"LifecycleConfirmCloseMergeWidget",container:widget.body,modalFlag:!0,onOk:function(){r.destroy(),t.click()},onClose:function(){r.destroy()}}),s=r.getButton("Ok");s&&(s.label=a.getDefaultButtonLabel("Close"))}},getWidgetCloseButton:function(){var e=null;if(!window||!window.frameElement||!window.frameElement.id)return null;var t=window.frameElement.id.replace("frame","wi");if(!window.parent||!window.parent.document)return null;var o=window.parent.document.querySelector("."+t);if(o){var n=o.querySelector(".moduleHeader");n&&(e=n.querySelector(".close-icon"))}return e},showNotifMsg:function(e,t){this._plugSvcs.showAlertBox(e,null,"warning")},showErrorMsg:function(e,t){this._plugSvcs.showAlertBox(e,null,"error")},getLabel:function(){return"nrf"===this.options.COMMAND_NAME?n.NRFStructure:n.MergeStructure},getName:function(){return"merge-struct"}})})),define("DS/CompareMergePlugin/MERGE_STRUCT_DISPLAY_plugin",["DS/CompareWidget2/plugins/displayPlugin","DS/CompareWidget2/plugins/STRUCTURE/STRUCT_DISPLAY_plugin","DS/CompareMergePlugin/ViewPanel/mergeStructComparePanel","DS/CompareMergePlugin/actionInfos","i18n!DS/CompareMergePlugin/assets/nls/MergePlugin"],(function(e,t,o,n,i){function r(e,t){this._outputPanel.handleUpdateToShowWarningWhenNoAccessRight()}return t.extend({onEnabled:function(){var e=this;return e.subscribeEvent("MERGE_STARTED_EVENT",function(){var t=i.Merging;"nrf"===e._pluginOptions.COMMAND_NAME&&(t=i.CreatingNewRevision),e.showMessage(t)}.bind(e)),e.subscribeEvent("MERGE_ENDED_OK_EVENT",function(){e.removeMessage(),e.panel.doPostMergeOK()}.bind(e)),e.subscribeEvent("MERGE_ENDED_KO_EVENT",function(){e.removeMessage()}.bind(e)),e.syncSetting("viewSettings.MERGE_STRUCT_VIEW.copyTitleFromSource","_copyTitleFromSource",null,e._outputPanel),e.syncSetting("viewSettings.MERGE_STRUCT_VIEW.warningNoRevise","_warningNoRevise",null,e._outputPanel),e.syncSetting("viewSettings.MERGE_STRUCT_VIEW.createARevision","_createARevision",null,e._outputPanel),e.syncSetting("viewSettings.STRUCT_VIEW.show_3dshape_of_3dpart","_show_3dshape_of_3dpart",null,e._outputPanel),e.syncSetting("viewSettings.MERGE_STRUCT_VIEW.maturityColumnVisible","_maturityColumnVisible",null,e._outputPanel),e.syncSetting("viewSettings.MERGE_STRUCT_VIEW.instanceTitleColumnVisible","_instanceTitleColumnVisible",null,e._outputPanel),e.syncSetting("viewSettings.MERGE_STRUCT_VIEW.useMergeCombine","_useMergeCombine",null,e._outputPanel),e.syncSetting("viewSettings.MERGE_STRUCT_VIEW.showPorts","_showPorts",null,e._outputPanel),e.syncSetting("viewSettings.MERGE_STRUCT_VIEW.showConnections","_showConnections",null,e._outputPanel),e.syncSetting("mergeSettings.warningNoRevise","_warningNoRevise",r.bind(this),e._outputPanel),e._parent()},createViewPanelObject:function(e,t){var n={};return t.CUSTOM_PROFILE_IN_USE&&(n=t.PROPS),this.panel=new o(e,this._plugSvcs,t,n),this.panel},execute:function(t,o){var n=this;if(this.panel.setActionInfos(t.actionInfos),e.prototype.execute.call(n,t,o),null!=t.crTreeArray){var i={crTreeArray:t.crTreeArray,ruleNames:t.ruleNames,actionInfos:t.actionInfos,destroy:function(){}};n._outputPanel.updateResults(o,t.crTreeArray[0]).then((function(e){n.showNotBusy(),n.reportOK(i)}),(function(e){n.reportKO(e)}))}else n.reportKO()}})})),define("DS/CompareMergePlugin/nrfManager",["DS/CompareCommon/Utils","DS/CompareMergePlugin/MergeConstants","DS/CompareMergePlugin/CRNodeUtils","i18n!DS/CompareMergePlugin/assets/nls/MergePlugin","DS/LifecycleServices/LifecycleServices"],(function(e,t,o,n,i){var r=function(e,t){this._options=e,this._plugSvcs=t,this._copyTitleFromSource=!1,this._crTree=null,this._actionInfos=null};return r.prototype.update=function(e,t){this._crTree=e,this._actionInfos=t},r.prototype.doNewRevisionFrom=function(){var e=this;e._plugSvcs.postEvent("MERGE_STARTED_EVENT");var t=this._getMergeData(),o={data:t},r=this._crTree.getRoot(1).getObjIDSpec_REF(),a=r.getTenant(),s=r.getServiceName(),c=(r.getSecurityContext(),e._plugSvcs.nowMS());i.getSecurityContextPromise(a).then((function(i){e._plugSvcs.makeAuthHttpsCall("/resources/lifecycle/revise/from/","POST",o,"json",a,s,i).then((function(o){if(e._plugSvcs.reportTime(c,"New Revision From request done OK."),null!=o&&o.hasOwnProperty("status")&&o.hasOwnProperty("report")&&"failure"===o.status){for(var i=n.NRFFailureMsg,r=0;r<o.report.length;r++){var a=o.report[r];if(a.error&&a.error!==i){i=a.error;break}}return e._plugSvcs.postEvent("MERGE_ENDED_KO_EVENT"),void e.showErrorMsg(i)}e.doPostMergeRefresh(t,o.results);var s=n.NRFSuccessMsg;e._plugSvcs.showAlertBox(s,null,"success"),e._plugSvcs.postEvent("MERGE_ENDED_OK_EVENT")}),(function(t){e._plugSvcs.reportTime(c,"New Revision From request failed."),e._plugSvcs.postEvent("MERGE_ENDED_KO_EVENT"),e._handleRequestFailure(!0,t),e._plugSvcs.errout("Failure to merge: "+t)}))}))},r.prototype._handleRequestFailure=function(e,t,o){var n=this;i.showWebServiceError(t,o,(function(e,t,o,i,r){t?n.showNotifMsg(e,{sticky:!0}):n.showErrorMsg(e,{title:o,subtitle:i,submessage:r})}),e)},r.prototype._getMergeData=function(){var e=this._copyTitleFromSource,t=this._crTree.getRoot(1),n=o.getBaseRefPidFromCRNode(t),i=[];this._addMergeNodeData(i,t,[],0);var r={physicalid:n,treeData:i,useSourceTitle:e},a=[];return a.push(r),a},r.prototype._addMergeNodeData=function(e,n,i,r){var a=o.getBaseRefPidFromCRNode(n),s=o.getCompRefPidFromCRNode(n),c=a||s;if(-1===i.indexOf(c)){i.push(c);var l=this._getActionInfoFromCRNode(n).getActionOptionSelected().name;if(l!==t.MergeAction.Exclude){l!==t.MergeAction.ReuseReference||s&&s!==a||(l=t.MergeAction.Reuse);var d=l===t.MergeAction.InsertNew,g=l===t.MergeAction.Reuse,u=l===t.MergeAction.ReuseReference,p={physicalid:d?"":a||s,operation:l,physicalid_dup:s,level:r},_=n.getChildArray();if(!g&&!u&&_.length>0){p.children=[];for(const n of _){var E=o.getBaseRefPidFromCRNode(n),A=o.getCompRefPidFromCRNode(n),f=this._getActionInfoFromCRNode(n).getActionOptionSelected().name;if(f!==t.MergeAction.Exclude){f!==t.MergeAction.ReuseReference||A&&A!==E||(f=t.MergeAction.Reuse);var h=f===t.MergeAction.InsertNew,R=f===t.MergeAction.Reuse,T=f===t.MergeAction.ReuseReference,S={physicalid:h?"":E||A,operation:f,physicalid_dup:A};p.children.push(S),R&&T||h||!(n.getChildArray().length>0)||this._addMergeNodeData(e,n,i,r+1)}}}e.push(p)}}},r.prototype._getActionInfoFromCRNode=function(e){var t=o.getInstPidFromCRNode(e);return this._actionInfos.getInstActionInfo(t)},r.prototype.doPostMergeRefresh=function(t,o){var n={created:[],deleted:[],modified:[],context:null},i=e.fetchContentFromCompass();if(i&&i.source){var r=i.source,a="ENOPRSU_AP"===r||"ENOPSTR_AP"===r;n.context={widget:{data:{x3dAppId:r}}}}var s=t[0].treeData.findIndex((e=>0==e.level)),c=t[0].treeData[s],l=o.find((e=>e.derivedfromphysicalid===c.physicalid)),d={physicalid:l.physicalid,sourceObjectId:l.derivedfromphysicalid,operation:"Revise",refreshPSD:a};if(n.created.push(d),o.forEach((function(e){var t={physicalid:e.derivedfromphysicalid,operation:"Revise"};n.modified.push(t)})),!widget._isODTMode()){require(["DS/LifecycleServices/Refresh"],(function(e){e._refreshCb(n)}))}},r.prototype.showNotifMsg=function(e,t){this._plugSvcs.showAlertBox(e,null,"warning")},r.prototype.showErrorMsg=function(e,t){this._plugSvcs.showAlertBox(e,null,"error")},r})),define("DS/CompareMergePlugin/MERGE_NRF_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareMergePlugin/nrfManager"],(function(e,t){return e.extend({init:function(e,o,n,i){this._parent(e,o,n,i),this.nrfManager=new t(n,i)},onEnabled:function(){var e=this;return e.subscribeEvent("EXECUTE_MERGE_EVENT",e.handle_EXECUTE_MERGE_EVENT.bind(e)),e.syncSetting("viewSettings.MERGE_STRUCT_VIEW.copyTitleFromSource","_copyTitleFromSource",null,e.nrfManager),e._parent()},handle_EXECUTE_MERGE_EVENT:function(e){this._plugSvcs.dbgout("MERGE NRF","executing... "),this.nrfManager.doNewRevisionFrom()},execute:function(e,t){try{var o=this;o._parent(e,t),e.crTreeArray&&e.actionInfos&&o.nrfManager.update(e.crTreeArray[0],e.actionInfos),o.reportOK(null)}catch(t){o._plugSvcs.dbgout("MERGE NRF","reports exception:: "+t),o.reportKO(e)}}})}));