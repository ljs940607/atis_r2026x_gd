/*!  COPYRIGHT DASSAULT SYSTEMES 2015   */
define("DS/ENOXGridCusto/views/Mask",["DS/Controls/ModalContainer","DS/Controls/Loader"],(function(e,t){"use strict";function i(){return"object"==typeof i.instance?i.instance:(i.instance=this,this.elements={},this.currentTarget=null,this)}return i.prototype.mask=function(i,o){null!==this.currentTarget&&this.currentTarget!==i&&this.unmask(this.currentTarget),this.currentTarget=i,void 0===this.elements.loader&&(this.elements.loader=new t({})),this.elements.loader.on(o),e.createModal(i,this.elements.loader.getContent())},i.prototype.unmask=function(t){this.currentTarget===t&&(this.currentTarget=null,this.elements.loader.off(),e.removeModal(t))},new i})),define("DS/ENOXGridCusto/utils/GridUtils",["DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen"],(function(e,t){"use strict";var i="en",o=null;function n(){return"object"==typeof n.instance?n.instance:(n.instance=this,this.mdlEvts=null,this)}return n.prototype.setLang=function(e){i=e},n.prototype.getLang=function(){return i},n.prototype.wait=async function(e){return new Promise((t=>{setTimeout(t,e)}))},n.prototype.displayNotif=function(i){null===o&&(o=e,t.setNotificationManager(o),t.setStackingPolicy(5));i=UWA.extend({level:"info",sticky:!1},i),o.addNotif(i)},n.prototype.loadAMD=async function(e){return new Promise((t=>{require([e],(e=>{t(e)}))}))},n.prototype.getURLParameter=function(e){if(location.search.length){let t=(new RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)").exec(location.search)||[null,""])[1].replace(/\+/g,"%20");return decodeURIComponent(t)}return null},new n})),define("DS/ENOXGridCusto/services/PlatformURL",["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],(function(e){"use strict";var t=null;function i(e){return"object"==typeof i.instance?i.instance:(i.instance=this,this)}return i.prototype.initialize=async function(i){return new Promise((function(o,n){null===t?e.getPlatformServices({config:i,onComplete:function(e){t=e,o()},onFailure:n}):o()}))},i.prototype.getPlatformId=function(){return null!=widget&&widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise"},i.prototype.getTenantInfo=function(e){for(var i={},o=0;o<t.length;o++)if(t[o].platformId===e){i=t[o];break}return i},i.prototype.getPlatformURL=function(e){if(!1===Array.isArray(t))throw new Error("Platform services not initialize yet");var i=this.getPlatformId(),o=this.getTenantInfo(i);return void 0===o[e]?(console.error("No "+e+" URL available for the tenant ["+i+"]"),null):o[e]},new i})),define("DS/ENOXGridCusto/services/WSAdmin",["DS/ENOXGridCusto/services/PlatformURL","DS/ENOXGridCusto/utils/GridUtils"],(function(e,t){"use strict";function i(){}return i.prototype.getTypeInfo=async function(i){var o=e.getPlatformURL("3DSpace")+"/resources/dictionary/getTypeInfo?tenant="+e.getPlatformId(),n={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()}};if(i.url_parameters){for(var s=Object.getOwnPropertyNames(i.url_parameters),l=0;l<s.length;l++)o=o+"&"+s[l]+"="+i.url_parameters[s[l]];delete i.url_parameters}return n.data=JSON.stringify(i.body),delete n.body,this.executeRequest(o,n,"gridcusto/gettype")},i.prototype.interfaces=async function(i){var o=e.getPlatformURL("3DSpace")+"/resources/dictionary/class/interfaces?tenant="+e.getPlatformId(),n={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()}};return n.data=JSON.stringify(i.data),this.executeRequest(o,n,"gridcusto/getexts")},i})),define("DS/ENOXGridCusto/services/WSAccess",["i18n!DS/ENOXGridCusto/assets/nls/ENOXGridCusto","DS/WAFData/WAFData","DS/ENOXGridCusto/utils/GridUtils","DS/ENOXGridCusto/services/WSAdmin"],(function(e,t,i,o){"use strict";function n(){return"object"==typeof n.instance?n.instance:(n.instance=this,this)}function s(e){return"string"==typeof e&&"{"===e.charAt(0)?JSON.parse(e):e}return n.prototype=Object.assign(n.prototype,o.prototype),n.prototype.__executeRequest=function(e,i,o,n,s,l){return t.authenticatedRequest(e,i)},n.prototype.executeRequest=async function(e,t,i,o){return new Promise(((n,l)=>{t.onComplete=function(e){var t={success:!0};e&&(t=s(e)),n(t)},t.onFailure=function(e,t){t&&(t=s(t)),l(t)},t.onTimeout=function(e,t){t&&(t=s(t)),l(t)},"POST"!==t.method||"string"==typeof t.data||t.data instanceof Blob||t.data instanceof FormData||(t.data=JSON.stringify(t.data)),this.__executeRequest(e,t,i,o)}))},new n})),define("DS/ENOXGridCusto/services/DictionaryAccessAPI",["i18n!DS/ENOXGridCusto/assets/nls/ENOXGridCusto","DS/SearchDictionaryAccess/SearchDictionaryAccessAPI","DS/ENOXGridCusto/services/PlatformURL","DS/ENOXGridCusto/services/WSAccess","DS/ENOXGridCusto/utils/GridUtils"],(function(e,t,i,o,n){"use strict";const s="R2019x";var l={},a=null;function d(e){return"object"==typeof d.instance?d.instance:(d.instance=this,this)}return d.prototype.getPropertiesForClass=async function(e){const t=e.classURIs.split("\n");var i=[];for(let e=0;e<t.length;e+=100){const o=t.slice(e,e+100);try{let e=await this.__splittedPropertiesForClass(o.join("\n"));e&&(i=i.concat(e))}catch(e){console.warn("Cannot retrieve information from "+o)}}return i},d.prototype.getClassificationAttributes=async function(){return new Promise((function(e){require(["DS/ClassificationUtil/ClassificationUtil"],(function(t){t.fetchClassificationAttributes({apiVersion:s,lang:n.getLang(),onFailure:t=>{e()},onComplete:t=>{e(t)}})}))}))},d.prototype.__splittedPropertiesForClass=async function(e){return new Promise((async function(t,o){(await n.loadAMD("DS/FedDictionaryAccess/FedDictionaryAccessAPI")).getPropertiesForClass(e,{tenantId:i.getPlatformId(),lang:n.getLang(),apiVersion:s,onComplete:function(e){var i="string"==typeof e?JSON.parse(e):e;t(i)},onFailure:function(e){console.warn("FedDictionaryAccessAPI.getPropertiesForClass failed"),o()}})}))},d.prototype.updateColumnNodes=async function(t){return new Promise((async i=>{let o=t.getRoots().filter((e=>!0!==e.getReferenceValue("localnls")&&(e.getReferenceValue("attType")===ATT_TYPE.REFERENCE||e.getReferenceValue("attType")===ATT_TYPE.INSTANCE||e.getReferenceValue("attType")===ATT_TYPE.CLASSIFICATION))).map((e=>e.getLabel().replace("-Instance","")));var s={};let l=await this.getResourcesInfo(o);if(!0===Array.isArray(l))for(var a=0;a<l.length;a++){var d=l[a].label;if(l[a].curi)if(d===l[a].curi.replace("ds6wg:","")){console.warn("No real label for attribute "+l[a].curi);var r=d.indexOf(".");r>0&&(d=d.substring(r+1))}s[l[a].curi]={nlsName:d,lang:n.getLang(),kind:l[a].dataType}}t.prepareUpdate();for(let i=0;i<t.getRoots().length;i++){let o=t.getRoots()[i];!0===o.getReferenceValue("localnls")&&e.columns[o.getLabel()]?o.setLabel(e.columns[o.getLabel()]):s[o.getLabel()]?o.setLabel(s[o.getLabel()].nlsName):s[o.getLabel().replace("-Instance","")]&&o.setLabel(s[o.getLabel().replace("-Instance","")].nlsName)}t.pushUpdate(),i()}))},d.prototype.getResourcesInfo=async function(e){return new Promise((async function(t,o){var l={tenantId:i.getPlatformId(),lang:n.getLang(),apiVersion:s,onComplete:function(e){t(e)},onFailure:function(e){e&&e.length?t(e):t()}};(await n.loadAMD("DS/FedDictionaryAccess/FedDictionaryAccessAPI")).getResourcesInfo(e.join(","),l)}))},d.prototype.getTypesInfo=async function(e){return new Promise((async t=>{let n=await o.getTypeInfo({url_parameters:{parentInfo:!0,$select:"IconName"},body:e.baseTypes});n="string"==typeof n?JSON.parse(n):n;for(var s=Object.getOwnPropertyNames(n),d=0;d<s.length;d++)n[s[d]]&&0===Object.keys(n[s[d]]).length&&delete n[s[d]];var r=Object.getOwnPropertyNames(n),c={"ds6w:type":r.map((e=>({value:e,source:["3DSpace"]})))};let p;!0!==e.noNls&&(p=await this.retrieveNLS({nlsData:c}));for(var h=0;h<r.length;h++)p&&(p["ds6w:type"][r[h]]?n[r[h]].displayName=p["ds6w:type"][r[h]]:n[r[h]].displayName=r[h]),n[r[h]].iconUrl=(u=n[r[h]].IconName,null===a&&(a=i.getPlatformURL("3DSpace")+"/snresources/images/icons/small/"),u?a+u+".png":"");var u;t(n),l.typesInfo=n}))},d.prototype.getExtensions=async function(e){return new Promise((async t=>{let i=await o.interfaces({data:{classes:e.selectedTypes}});i="string"==typeof response?JSON.parse(i):i;for(var n={},s={},a=i.results,d=0;d<a.length;d++)for(var r=a[d].name,c=0;c<a[d].interfaces.length;c++)a[d].interfaces[c].automatic&&"yes"===a[d].interfaces[c].automatic.toLowerCase()||a[d].interfaces[c].name.startsWith("XP_")&&a[d].interfaces[c].name.endsWith("_Ext")?(void 0===s[a[d].interfaces[c].name]&&(s[a[d].interfaces[c].name]=a[d].interfaces[c],s[a[d].interfaces[c].name].declareIn=[]),s[a[d].interfaces[c].name].declareIn.push(r)):(void 0===n[a[d].interfaces[c].name]&&(n[a[d].interfaces[c].name]=a[d].interfaces[c],n[a[d].interfaces[c].name].declareIn=[]),n[a[d].interfaces[c].name].declareIn.push(r));t({extensions:n,automaticExtensions:s}),l.extensions=n,l.automaticExtensions=s}))},d.prototype.retrieveNLS=async function(e){return new Promise((function(o,l){t.getNlsOfSearchValuesBySource(e.nlsData,{tenantId:i.getPlatformId(),lang:n.getLang(),apiVersion:s,onFailure:function(e){o({})},onComplete:function(e){var t=UWA.is(e,"string")?JSON.parse(e):e;o(t)}})}))},new d})),define("DS/ENOXGridCusto/views/TypeNExtChooser",["css!DS/ENOXGridCusto/ENOXGridCusto.css","i18n!DS/ENOXGridCusto/assets/nls/ENOXGridCusto","text!DS/ENOXGridCusto/assets/conf/GridCusto.json","DS/ENOXGridCusto/services/DictionaryAccessAPI","DS/Utilities/Dom","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/Tab","DS/TreeModel/TreeDocument","DS/DataGridView/DataGridView"],(function(e,t,i,o,n,s,l,a,d,r){"use strict";const c="type-n-ext-chooser",p=JSON.parse(i);function h(e){return this.elements={},this.options=e||{},this.options=Object.assign({allExtForTypes:[]},this.options),this}return h.prototype.choose=async function(){return new Promise((async e=>{this.elements.container=n.createElement("div",{class:c}),this.__buildView();var i={resizableFlag:!0,title:t.typeNext.title,content:this.elements.container,modalFlag:!0,usePaddingFlag:!0,position:{my:"center",at:"center"},width:350,minWidth:250,height:320,buttons:{Ok:new l({domId:c+"-ok-btn",label:t.typeNext.okBtn,onClick:t=>{if(this.elements.creationModal.close(),this.options.selectedTypes=this.options.typesModel.getRoots().filter((e=>e.getReferenceValue("selectedIdx"))).map((e=>e.getReferenceValue("type"))),!0===this.options.extensionsSet){this.options.selectedExtensions=this.options.extsModel.getRoots().filter((e=>e.getReferenceValue("selectedIdx"))).map((e=>e.getReferenceValue("extension")));let e=Object.keys(this.options.automaticExt);e.length>0&&(this.options.selectedExtensions=this.options.selectedExtensions.concat(e))}e({selectedTypes:this.options.selectedTypes,selectedExtensions:this.options.selectedExtensions})}}),Cancel:new l({domId:c+"-cancel-btn",label:t.typeNext.cancelBtn,onClick:t=>{this.elements.creationModal.close(),e()}})}};this.elements.creationModal=new s(i),await this.__fillTypes()}))},h.prototype.__buildView=async function(){this.elements.tab=new a({displayStyle:"strip"}),this.elements.tab.addEventListener("change",(async e=>{let t=e.dsModel;t.value&&t.value.length&&1===t.value[0]&&await this.__fillExts()})),this.elements.tab.getContent().addClassName(c+"-tab"),this.elements.typesDiv=n.createElement("div",{class:c+"-types"});let e=JSON.parse(JSON.stringify(p.defaultDGVOpts));this.options.typesModel=new d,e.layoutOptions.useLastColumnWidthAutoFlag=!1,e.columns=[{dataIndex:"selectedIdx",typeRepresentation:"boolean",visibleFlag:!0,width:40,resizableFlag:!1,sortableFlag:!0,editableFlag:!0,editionPolicy:"EditionInPlace",getCellEditableState:e=>-1===this.options.appBaseTypes.indexOf(e.nodeModel.getReferenceValue("type"))},{dataIndex:"tree",width:"auto",text:t.columns.typeName,visibleFlag:!0}],e.treeDocument=this.options.typesModel,e.onContextualEvent=this._onCtxMenuEvent.bind(this),e.sortModel=[{dataIndex:"selectedIdx",sort:"desc"}],this.elements.typesDgv=new r(e),this.elements.typesDgv.treeDocument.setFilterModel({label:{filterId:"stringRegexp",filterModel:{}}});var i=this.elements.typesDgv.setToolbar({entries:[{id:"findDialogIdTypes",position:"far",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"filter",fontIconFamily:1},value:()=>{this.elements.typesDgv.getFilterViewManager().getFilterPopups().label.showPopup()}}}]});this.elements.typesDiv.appendChild(i.getContent());let o=n.createElement("div",{class:c+"-dgv"});o.appendChild(this.elements.typesDgv.getContent()),this.elements.typesDiv.appendChild(o),this.elements.extsDiv=n.createElement("div",{class:c+"-exts"});let s=JSON.parse(JSON.stringify(p.defaultDGVOpts));this.options.extsModel=new d,s.layoutOptions.useLastColumnWidthAutoFlag=!1,s.columns=[{dataIndex:"selectedIdx",typeRepresentation:"boolean",visibleFlag:!0,width:40,resizableFlag:!1,sortableFlag:!0,editableFlag:!0,editionPolicy:"EditionInPlace",getCellEditableState:e=>-1===this.options.selectedExtensions.indexOf(e.nodeModel.getReferenceValue("extension"))},{dataIndex:"tree",width:"auto",text:t.columns.extName,visibleFlag:!0}],s.treeDocument=this.options.extsModel,s.onContextualEvent=this._onCtxMenuEvent.bind(this),s.sortModel=[{dataIndex:"selectedIdx",sort:"desc"}],this.elements.extsDgv=new r(s),this.elements.extsDgv.treeDocument.setFilterModel({label:{filterId:"stringRegexp",filterModel:{}}});var l=this.elements.extsDgv.setToolbar({entries:[{id:"findDialogIdExts",position:"far",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"filter",fontIconFamily:1},value:()=>{this.elements.extsDgv.getFilterViewManager().getFilterPopups().label.showPopup()}}}]});this.elements.extsDiv.appendChild(l.getContent());let h=n.createElement("div",{class:c+"-dgv"});h.appendChild(this.elements.extsDgv.getContent()),this.elements.extsDiv.appendChild(h),this.elements.tab.add({label:t.typeNext.selectionTypeTitle,icon:{iconName:"3d-object",fontIconFamily:WUXManagedFontIcons.Font3DS},content:this.elements.typesDiv,isSelected:!0}),this.elements.tab.add({label:t.typeNext.selectionExtTitle,icon:{iconName:"3dproduct-add",fontIconFamily:WUXManagedFontIcons.Font3DS},content:this.elements.extsDiv}),this.elements.container.appendChild(this.elements.tab.getContent())},h.prototype.__fillTypes=async function(){this.options.typesModel.removeRoots();let e=this.options.appBaseTypes,t=await o.getTypesInfo({baseTypes:e});this.options.typesModel.prepareUpdate();let i=Object.keys(t);for(let e=0;e<i.length;e++){let o=i[e],n=t[o],s=-1!==this.options.selectedTypes.indexOf(o),l={label:n.displayName,icons:[n.iconUrl],grid:{type:o,iconName:n.iconName,selectedIdx:s},children:null};this.options.typesModel.addRoot(l)}this.options.typesModel.pushUpdate(),this.elements.typesDgv.reapplySortModel()},h.prototype._onCtxMenuEvent=async function(e){return new Promise((function(e){e([])}))},h.prototype.__fillExts=async function(){this.options.selectedTypes=this.options.typesModel.getRoots().filter((e=>e.getReferenceValue("selectedIdx"))).map((e=>e.getReferenceValue("type")));let e=!0;for(let t=0;t<this.options.selectedTypes.length&&!0===e;t++)-1===this.options.allExtForTypes.indexOf(this.options.selectedTypes[t])&&(e=!1);if(!1===e){this.options.extensionsSet=!0,this.options.allExtForTypes=this.options.selectedTypes,this.options.extsModel.removeRoots();let e=await o.getExtensions({selectedTypes:this.options.allExtForTypes});this.options.extsModel.prepareUpdate();let t=e.extensions,i=Object.keys(t);for(let e=0;e<i.length;e++){let o=i[e],n=t[o],s=-1!==this.options.selectedExtensions.indexOf(o),l={label:n.nlsName,grid:{extension:o,iconName:n.iconName,selectedIdx:s},children:null};this.options.extsModel.addRoot(l)}this.options.extsModel.pushUpdate(),this.options.automaticExt=e.automaticExtensions,this.elements.extsDgv.reapplySortModel()}},h})),define("DS/ENOXGridCusto/views/SelectedAttributes",["css!DS/ENOXGridCusto/ENOXGridCusto","i18n!DS/ENOXGridCusto/assets/nls/ENOXGridCusto","text!DS/ENOXGridCusto/assets/conf/GridCusto.json","DS/ENOXGridCusto/services/DictionaryAccessAPI","DS/ENOXGridCusto/utils/GridUtils","DS/Utilities/Dom","DS/Tweakers/GeneratedToolbar","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/TreeModel/ModelUtils","DS/DataGridView/DataGridView"],(function(e,t,i,o,n,s,l,a,d,r,c){"use strict";const p="att-selected";var h=JSON.parse(i);function u(e){this.options=e||{},this.options=Object.assign({colUpdates:[],toolbarDef:{entries:[{id:"moveUp",dataElements:{typeRepresentation:TOOLBAR_RENDERING,icon:{iconName:"up",fontIconFamily:1},value:()=>{this.__move("moveUp")},position:"far",category:"move",disabled:!0,tooltip:t.selectedAtt.moveUp}},{id:"moveDown",dataElements:{typeRepresentation:TOOLBAR_RENDERING,icon:{iconName:"down",fontIconFamily:1},value:()=>{this.__move("moveDown")},position:"far",category:"move",disabled:!0,tooltip:t.selectedAtt.moveDown}},{id:"moveTop",dataElements:{typeRepresentation:TOOLBAR_RENDERING,icon:{iconName:"move-to-top",fontIconFamily:1},value:()=>{this.__move("moveTop")},position:"far",category:"move",disabled:!0,tooltip:t.selectedAtt.moveFirst}},{id:"moveBottom",dataElements:{typeRepresentation:TOOLBAR_RENDERING,icon:{iconName:"move-to-bottom",fontIconFamily:1},value:()=>{this.__move("moveBottom")},position:"far",category:"move",disabled:!0,tooltip:t.selectedAtt.moveLast}}]},columns:[{dataIndex:"attVisible",typeRepresentation:"boolean",icon:{iconName:"eye",fontIconFamily:1},width:40,visibleFlag:!0,editableFlag:!this.options.locked,editionPolicy:"EditionInPlace",getCellEditableState:e=>{let t=!this.options.locked;return!0===e.nodeModel.getReferenceValue("mandatory")&&(t=!1),t}},{dataIndex:"tree",text:t.columns.colName,width:"auto",visibleFlag:!0},{dataIndex:"pinCol",icon:{iconName:"pin",fontIconFamily:1},typeRepresentation:"customEnumMember",text:t.columns.pin,visibleFlag:!0,alignmentValue:"center",width:75,minWidth:75,maxWidth:75,editableFlag:!this.options.locked,editionPolicy:"EditionOnOver",sortableFlag:!1,resizableFlag:!1,getCellSemantics:function(e){return{possibleValues:[{value:"left",label:t.attSelection.pinLeft},{value:"right",label:t.attSelection.pinRight},{value:"unpinned",label:""}]}}}]},this.options),this.elements={},this.elements.container=s.createElement("div",{class:p});var i=this;let o=null,n=null;var l={shouldAcceptDrag:function(e){return!0},shouldAcceptDrop:function(e){n=e,o&&(clearTimeout(o),o=null),o=setTimeout((()=>{["top","bottom","middle"].includes(n.dropPosition)&&i.__move(n,!0)}),150);let t=e.dropNode.getReferenceValue("pinCol")===e.draggedTreeNodeModel.getReferenceValue("pinCol");return"middle"!==e.dropPosition&&t}};return this.options.attModel=new a(l),this.options.attModel.getXSO().onPostAdd(this.__selectionChange.bind(this)),this.options.attModel.getXSO().onPostRemove(this.__selectionChange.bind(this)),this.options.attModel.getXSO().onEmpty(this.__selectionChange.bind(this)),this.options.attModel.onNodeModelUpdate(this.__modelChange.bind(this)),this.__buildView(),this}return u.prototype.getContent=function(){return this.elements.container},u.prototype.updateAttList=async function(e){this.options.attModel.removeRoots(),this.options.attModel.prepareUpdate();let t=e.selectedColumns;for(let e=0;e<t.length;e++){let i=t[e],o=ATT_TYPE.REFERENCE,n=ICON_TYPE.REFERENCE,s="boolean"!=typeof i.exportableFlag||i.exportableFlag,l="boolean"==typeof i.blockExportedFlag&&i.blockExportedFlag;switch(i.attType){case ATT_TYPE.INSTANCE:o=ATT_TYPE.INSTANCE,n=ICON_TYPE.INSTANCE;break;case ATT_TYPE.CLASSIFICATION:o=ATT_TYPE.CLASSIFICATION,n=ICON_TYPE.CLASSIFICATION,s="boolean"==typeof i.exportableFlag&&i.exportableFlag}let a={id:i.dataIndex?i.dataIndex:i.ds6w,ds6w:i.ds6w,label:i.ds6w?i.ds6w:i.dataIndex,icons:[i.icon?i.icon:n],grid:{mandatory:i.mandatory,attVisible:"boolean"!=typeof i.attVisible||i.attVisible,attType:o,exportCol:s,blockExportedFlag:l,dataType:"number"==typeof i.dataType?i.width:void 0,pinCol:"string"==typeof i.pinned?i.pinned:"unpinned",localnls:i.localnls,width:"number"==typeof i.width?i.width:void 0,maxWidth:"number"==typeof i.maxWidth?i.maxWidth:void 0,minWidth:"number"==typeof i.minWidth?i.minWidth:void 0,alignment:"string"==typeof i.alignment?i.alignment:void 0}},r=new d(a);this.options.attModel.addRoot(r)}await o.updateColumnNodes(this.options.attModel),this.options.attModel.pushUpdate(),this.selectAttUpdated=!0,this.options.colUpdates.length>0&&this.updateAttributeDef(this.options.colUpdates)},u.prototype.updateAttributeDef=function(e){if(this.options.colUpdates=e,!0===this.selectAttUpdated){this.options.attModel.prepareUpdate();let t={};e.forEach((e=>{t[e.id]={grid:{dataType:e.dataType,dimension:e.dimension}}}));let i=this.options.attModel.getRoots();for(let e=0;e<i.length;e++)"object"==typeof t[i[e].options.id]&&i[e].updateOptions(t[i[e].options.id]);this.options.attModel.pushUpdate()}},u.prototype.removeSelectedNodes=function(){let e=this.options.attModel.getSelectedNodes();for(let t=0;t<e.length;t++)e[t].remove();return this.options.onSelectedAttributeChange(this.getSelectedColumns()),e},u.prototype.addSelectedNodes=function(e){for(let i=0;i<e.length;i++){let o={id:e[i].options.id,ds6w:e[i].options.id.replaceAll("-Instance",""),label:e[i].getLabel(),icons:e[i].getIcons(),grid:{mandatory:!1,attVisible:!0,attType:e[i].getReferenceValue("attType"),dataType:e[i].getReferenceValue("dataType"),exportCol:e[i].getReferenceValue("exportableFlag"),blockExportedFlag:!0===e[i].getReferenceValue("blockExportedFlag"),pinCol:e[i].getReferenceValue("pinCol")?e[i].getReferenceValue("pinCol"):"unpinned",localnls:!0===e[i].getReferenceValue("localnls"),width:"number"==typeof e[i].getReferenceValue("width")?e[i].getReferenceValue("width"):void 0,maxWidth:"number"==typeof e[i].getReferenceValue("maxWidth")?e[i].getReferenceValue("maxWidth"):void 0,minWidth:"number"==typeof e[i].getReferenceValue("minWidth")?e[i].getReferenceValue("minWidth"):void 0,alignment:"string"==typeof e[i].getReferenceValue("alignment")?e[i].getReferenceValue("alignment"):void 0,groupableFlag:"boolean"==typeof e[i].getReferenceValue("groupableFlag")?e[i].getReferenceValue("groupableFlag"):void 0,dimension:e[i].getReferenceValue("dimension")}},s=new d(o);if(1===this.options.attModel.getSelectedNodes().length){let e,t=this.options.attModel.getSelectedNodes()[0].options.id,i=this.options.attModel.getChildren();for(let o=0;o<i.length;o++)if(i[o].options.id===t){e=o+1;break}s.updateOptions({grid:{pinCol:this.options.attModel.getSelectedNodes()[0].getReferenceValue("pinCol")}}),this.options.attModel.addRoot(s,e)}else{s.getReferenceValue("pinCol");let e,t=this.options.attModel.getChildren();for(let i=0;i<t.length;i++)if("right"===t[i].getReferenceValue("pinCol")){e=t[i];break}e?this.options.attModel.insertBefore(s,e):this.options.attModel.addRoot(s)}this.options.attModel.unselectAll(),s.select(),this.elements.dgv.ensureNodeModelVisible(s,!1,!0,.2),this.options.attModel.getRoots().length>=MAX_SELECTED_PER_VIEW&&n.displayNotif({level:"warning",title:t.warning.tooManySelected.title,message:t.replace(t.warning.tooManySelected.msg,{maxNumber:MAX_SELECTED_PER_VIEW}),sticky:!0,key:"tooManySelectedAttributes"}),this.options.onSelectedAttributeChange(this.getSelectedColumns())}},u.prototype.getSelectedColumns=function(){let e={properties:[function(){return{property:"dataIndex",value:this.options.id}},function(){return{property:"ds6w",value:this.options.ds6w}},function(){return{property:"mandatory",value:!0===this.getReferenceValue("mandatory")||void 0}},function(){return{property:"attVisible",value:!1!==this.getReferenceValue("attVisible")&&void 0}},function(){return{property:"attType",value:this.getReferenceValue("attType")}},function(){return{property:"exportableFlag",value:!1!==this.getReferenceValue("attVisible")&&void 0}},function(){return{property:"blockExportedFlag",value:!0===this.getReferenceValue("blockExportedFlag")||void 0}},function(){return{property:"pinned",value:"unpinned"===this.getReferenceValue("pinCol")?void 0:this.getReferenceValue("pinCol")}},function(){return{property:"localnls",value:!0===this.getReferenceValue("localnls")||void 0}},function(){return{property:"width",value:this.getReferenceValue("width")}},function(){return{property:"maxWidth",value:this.getReferenceValue("maxWidth")}},function(){return{property:"minWidth",value:this.getReferenceValue("minWidth")}},function(){return{property:"alignment",value:this.getReferenceValue("alignment")}},function(){return{property:"groupableFlag",value:this.getReferenceValue("groupableFlag")}},function(){return{property:"dimension",value:this.getReferenceValue("dimension")}},function(){return{property:"dataType",value:this.getReferenceValue("dataType")}}]};return this.options.attModel.dump(e).children},u.prototype.__buildView=function(){this.elements.hdr=s.createElement("div",{class:p+"-hdr"}),this.elements.content=s.createElement("div",{class:p+"-content"}),this.elements.container.appendChild(this.elements.hdr),this.elements.container.appendChild(this.elements.content);let e=s.createElement("div",{class:p+"-title"});if(e.innerText=t.selectedAtt.title,this.elements.hdr.appendChild(e),!0!==this.options.locked){let e=l.prototype.createTreeDocument(this.options.toolbarDef);this.elements.toolbar=new l({overflowManagement:"dropdown",direction:"horizontal",items:e}),this.elements.toolbar.getContent().addClassName(p+"-toolbar"),this.elements.hdr.appendChild(this.elements.toolbar.getContent())}let i=JSON.parse(JSON.stringify(h.defaultDGVOpts));this.options.locked?(i.cellDragEnabledFlag=!1,i.rowDragEnabledFlag=!1,i.rowReorderEnabledFlag=!1,i.layoutOptions.rowsHeader=!1):(i.cellDragEnabledFlag=!0,i.rowDragEnabledFlag=!0,i.rowReorderEnabledFlag=!0,i.layoutOptions.rowsHeader=!0),i.columns=this.options.columns,i.treeDocument=this.options.attModel,i.onContextualEvent=this._onCtxMenuEvent.bind(this),this.elements.dgv=new c(i),this.elements.dgv.getContent().addClassName(p+"-dgv"),this.elements.content.appendChild(this.elements.dgv.getContent())},u.prototype._onCtxMenuEvent=async function(e){return Promise.resolve([])},u.prototype.__selectionChange=function(){let e=this.options.attModel.getSelectedNodes();if(this.options.onSelectionChange(e),1===e.length){let t=this.options.attModel.getRoots().length,i=-1,o=-1;this.options.attModel.search({match:t=>{o++,t.nodeModel.options.id===e[0].options.id&&(i=o)},shouldStop:()=>{if(-1!==i)return!0}}),0===i?(this.elements.toolbar.updateNodeModel("moveUp",{disabled:!0,grid:{disabled:!0}}),this.elements.toolbar.updateNodeModel("moveTop",{disabled:!0,grid:{disabled:!0}})):(this.elements.toolbar.updateNodeModel("moveUp",{disabled:!1,grid:{disabled:!1}}),this.elements.toolbar.updateNodeModel("moveTop",{disabled:!1,grid:{disabled:!1}})),i+1===t?(this.elements.toolbar.updateNodeModel("moveDown",{disabled:!0,grid:{disabled:!0}}),this.elements.toolbar.updateNodeModel("moveBottom",{disabled:!0,grid:{disabled:!0}})):(this.elements.toolbar.updateNodeModel("moveDown",{disabled:!1,grid:{disabled:!1}}),this.elements.toolbar.updateNodeModel("moveBottom",{disabled:!1,grid:{disabled:!1}}))}else this.elements.toolbar.updateNodeModel("moveUp",{disabled:!0,grid:{disabled:!0}}),this.elements.toolbar.updateNodeModel("moveDown",{disabled:!0,grid:{disabled:!0}}),this.elements.toolbar.updateNodeModel("moveTop",{disabled:!0,grid:{disabled:!0}}),this.elements.toolbar.updateNodeModel("moveBottom",{disabled:!0,grid:{disabled:!0}})},u.prototype.__move=function(e,t=!1){let i=this.options.attModel.getSelectedNodes()[0],o=i.getReferenceValue("pinCol"),n=i._getLocalID(),s=this.__locateFirstAndLastPin(o);var l,a=s.first._getLocalID(),d=s.last?s.last._getLocalID():this.options.attModel.getRoots().length-1;if(t){const{dropPosition:t,draggedTreeNodeModel:i}=e,o=i?i._rowID:n;switch(t){case"middle":l=o;break;case"top":l=a;break;case"bottom":l=d}}else switch(e){case"moveTop":l=a;break;case"moveUp":l=a<=n-1?n-1:n;break;case"moveDown":l=d>=n+1?n+1:n;break;case"moveBottom":l=d}this.options.attModel.addChild(i,l),i.select(),this.options.onSelectedAttributeChange(this.getSelectedColumns())},u.prototype.__locateFirstAndLastPin=function(e){var t,i;var o=this.options.attModel.getRoots().filter((function(t){return t.getReferenceValue("pinCol")===e}));if(t=o[0],o.length>1&&"left"===e)i=o[n=o.length-1];else if("left"!==e&&1===o.length){var n=this.options.attModel.getRoots().length-1;i=this.options.attModel.getRoots()[n]}else{i=o[n=o.length-1]}return{first:t,last:i}},u.prototype.__modelChange=async function(e){if(await n.wait(50),e&&e.data.nodeModel&&e.data.attributes.pinCol){let t=e.data.nodeModel;if(t){let e,i,o=t.getReferenceValue("pinCol"),n=this.options.attModel.getRoots();for(let o=0;o<n.length&&(!e||!i);o++)n[o].options.id!==t.options.id&&("left"===n[o].getReferenceValue("pinCol")&&o+1<n.length&&"left"!==n[o+1].getReferenceValue("pinCol")&&(e=n[o]),"unpinned"===n[o].getReferenceValue("pinCol")&&o+1<n.length&&"right"===n[o+1].getReferenceValue("pinCol")&&n[o+1].options.id!==t.options.id&&(i=n[o+1]));switch(e||(e=n[0]),i||(i=n[n.length-1]),o){case"left":e.options.id!==t.options.id&&r.moveNodes([t],e,{direction:1});break;case"right":i.options.id!==t.options.id&&r.moveNodes([t],i,{direction:1});break;default:i.options.id!==t.options.id&&r.moveNodes([t],i,{direction:-1})}t.unselect(),t.select()}}this.options.onSelectedAttributeChange(this.getSelectedColumns())},u})),define("DS/ENOXGridCusto/views/AttributesSelection",["css!DS/ENOXGridCusto/ENOXGridCusto","i18n!DS/ENOXGridCusto/assets/nls/ENOXGridCusto","text!DS/ENOXGridCusto/assets/conf/GridCusto.json","DS/ENOXGridCusto/services/DictionaryAccessAPI","DS/ENOXGridCusto/utils/GridUtils","DS/ENOXGridCusto/views/TypeNExtChooser","DS/Utilities/Dom","DS/Tweakers/GeneratedToolbar","DS/Controls/Loader","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/DataGridView/DataGridView","DS/FindEx/FindDialog"],(function(e,t,i,o,n,s,l,a,d,r,c,p,h){"use strict";const u="att-selection",g="-Instance",m=["VPMReference","VPMRepReference","3DShape"],f=["VPMInstance","VPMRepInstance"];var y=(e,t)=>{if(!1===e.hasChildren())e.addRoot(t);else{let i,o=e.getChildren(),n=t.getLabel();for(let e=0;e<o.length;e++)if(o[e].getLabel()>n){i=o[e];break}void 0===i?e.addRoot(t):e.insertBefore(t,i)}},v=JSON.parse(i);function E(e){this.options=e||{},this.options=Object.assign({toolbarDef:{entries:[{id:"addTypesAndExt",dataElements:{typeRepresentation:TOOLBAR_RENDERING,icon:{iconName:"attributes-add",fontIconFamily:1},value:this.__launchTypeAndExtChooser.bind(this),position:"far",category:"addAtt",tooltip:t.attSelection.addTypesAndExt}},{id:"findInAtt",dataElements:{typeRepresentation:TOOLBAR_RENDERING,icon:{iconName:"search",fontIconFamily:1},value:()=>{this.elements.findDialog.visibleFlag=!this.elements.findDialog.visibleFlag},position:"far",category:"find",tooltip:t.attSelection.findAttributes}}]},columns:[{dataIndex:"tree",text:t.columns.attName,width:"auto",visibleFlag:!0}]},this.options),this.elements={},this.elements.container=l.createElement("div",{class:u});return this.options.attModel=new r({shouldAcceptDrag:function(){return!1},shouldBeSelected:function(e){return void 0===e.getReferenceValue("shouldBeSelected")||e.getReferenceValue("shouldBeSelected")}}),this.options.attModel.getXSO().onPostAdd(this.__selectionChange.bind(this)),this.options.attModel.getXSO().onPostRemove(this.__selectionChange.bind(this)),this.options.attModel.getXSO().onEmpty(this.__selectionChange.bind(this)),this.__buildView(),this.attrMap=new Map,this}return E.prototype.getContent=function(){return this.elements.container},E.prototype.updateAttList=async function(e){return new Promise((async i=>{this.options=Object.assign(this.options,e);let n=this.options.selectedColumns.map((e=>e.dataIndex&&"tree"!==e.dataIndex?e.dataIndex:e.ds6w));this.options.attModel.removeRoots(),this.options.attModel.prepareUpdate(),this.attrMap.clear();let s=this.options.selectedTypes.map((e=>"XP_"+e+"_Ext")),l=[].concat(this.options.selectedTypes).concat(s).concat(this.options.selectedExtensions),a=await o.getPropertiesForClass({classURIs:l.join("\n")}),d=await o.getTypesInfo({baseTypes:[].concat(this.options.selectedTypes).concat(this.options.selectedExtensions)}),r=await o.getExtensions({selectedTypes:this.options.selectedTypes}),p={};for(let e=0;e<this.options.selectedExtensions.length;e++)if(r.extensions[this.options.selectedExtensions[e]]){p[this.options.selectedExtensions[e]]=r.extensions[this.options.selectedExtensions[e]];let t,i,o=p[this.options.selectedExtensions[e]];for(let e=0;e<o.declareIn.length;e++)-1!==m.indexOf(o.declareIn[e])?t=!0:-1!==f.indexOf(o.declareIn[e])&&(i=!0);p[this.options.selectedExtensions[e]].declaredInRef=t,p[this.options.selectedExtensions[e]].declaredInInst=i}const h=this.options.attModel.getRoots();for(let e=h.length-1;e>=0;e--)h[e].remove();let u=new c({icons:[{iconName:"attributes",fontIconFamily:1}],label:t.attSelection.commonAttributes,grid:{shouldBeSelected:!1}});this.options.attModel.addRoot(u);let v=new c({icons:[{iconName:"attributes",fontIconFamily:1}],label:t.attSelection.typesAttributes,grid:{shouldBeSelected:!1}});this.options.attModel.addRoot(v);let E=new c({icons:[{iconName:"attributes-add",fontIconFamily:1}],label:t.attSelection.extsAttributes,grid:{shouldBeSelected:!1}});this.options.attModel.addRoot(E);for(let e=0;e<a.length;e++){let i=a[e],o=!1,s=!1,l=i.classInfo.curi.replace("ds6wg:","");"ds6wg:VPMInstance"!==i.classInfo.curi&&"ds6wg:VPMRepInstance"!==i.classInfo.curi||(o=!0),p&&p[l]&&(!0===p[l].declaredInRef&&!0===p[l].declaredInInst?(s=!0,o=!1):!0===p[l].declaredInInst&&(o=!0));let d=-1!==this.options.selectedTypes.indexOf(l)?"FromType":"FromExt",r=i.properties;for(let e=0;e<r.length;e++){let i=r[e];if(!i.label||""===i.label.trim())continue;if(i.label===t.notDisplayedAtt)continue;if("ds6wg:PLMReference.V_isLastVersion"===i.curi)continue;let a=i.curi+(o?g:""),c=!1;-1!==n.indexOf(a)&&(c=!0);let p=this.attrMap.get(a);if(p)p.grid.declaredIn.push(l),this.attrMap.set(p.id,p);else{let e=o?ATT_TYPE.INSTANCE:ATT_TYPE.REFERENCE,t=o?ICON_TYPE.INSTANCE:ICON_TYPE.REFERENCE,n={id:a,label:i.label,icons:[t],grid:{dataType:i.dataType,dimension:i.dimension,attType:e,kind:d,exportableFlag:!0,declaredIn:[l],selectedAtt:c,width:i.width,alignment:i.alignment},children:null};this.attrMap.set(n.id,n)}if(!0===s){let e=JSON.parse(JSON.stringify(i)),t=i.curi+g,o=!1;-1!==n.indexOf(t)&&(o=!0);let s=this.attrMap.get(t);if(s)s.grid.declaredIn.push(l),this.attrMap.set(s.id,s);else{let i=ATT_TYPE.INSTANCE,n=ICON_TYPE.INSTANCE,s={id:t,label:e.label,icons:[n],grid:{dataType:e.dataType,dimension:e.dimension,attType:i,kind:d,exportableFlag:!0,declaredIn:[l],selectedAtt:o,width:e.width,alignment:e.alignment},children:null};this.attrMap.set(s.id,s)}}}}let b={id:"positionMatrix-Instance",ds6w:"matrixtxt",label:t.columns["positionMatrix-Instance"],icons:[ICON_TYPE.INSTANCE],grid:{dataType:"Instance",attType:"Instance",kind:"FromType",exportableFlag:!1,declaredIn:["VPMInstance","VPMRepInstance"],selectedAtt:!0,localnls:!0,groupableFlag:!1},children:null};this.attrMap.set(b.id,b);let w={id:"thumbnail",icons:[ICON_TYPE.REFERENCE],label:t.columns.thumbnail,grid:{kind:"FromType",exportableFlag:!1,declaredIn:["VPMReference","VPMRepReference","3DShape"],groupableFlag:!1,localnls:!0},children:null};this.attrMap.set(w.id,w);let N=[],C={};this.attrMap.forEach(((e,t,i)=>{let o=new c(e);if(0!==e.id.indexOf("ds6wg:")||"positionMatrix-Instance"===e.dw6w||"thumbnail"===e.dw6w)y(u,o);else if("FromType"===e.grid.kind){let t=0;if(-1!==e.id.indexOf(".")&&e.grid.declaredIn.length>1){let i=e.id.substring(6,e.id.indexOf("."));i.contains("XP_")&&i.contains("_Ext")&&(i=i.substring(3,i.indexOf("_Ext")));let o=e.grid.declaredIn.indexOf(i);-1!==o&&(t=o)}let i=C[e.grid.declaredIn[t]];void 0===i&&(i=new c({id:e.grid.declaredIn[t],label:d[e.grid.declaredIn[t]]&&d[e.grid.declaredIn[t]].displayName?d[e.grid.declaredIn[t]].displayName:e.grid.declaredIn[t],icons:d[e.grid.declaredIn[t]]?[d[e.grid.declaredIn[t]].iconUrl]:[],grid:{shouldBeSelected:!1}}),C[e.grid.declaredIn[t]]=i,y(v,i)),y(i,o)}else{let t=C[e.grid.declaredIn[0]];void 0===t&&(t=new c({id:e.grid.declaredIn[0],label:d[e.grid.declaredIn[0]]&&d[e.grid.declaredIn[0]].displayName?d[e.grid.declaredIn[0]].displayName:e.grid.declaredIn[0],icons:d[e.grid.declaredIn[0]]?[d[e.grid.declaredIn[0]].iconUrl]:[],grid:{shouldBeSelected:!1}}),C[e.grid.declaredIn[0]]=t,y(E,t)),y(t,o)}if(!0===o.getReferenceValue("selectedAtt")){o.hide();let e=o.getReferenceValue("dimension"),t={id:o.options.id,dataType:o.getReferenceValue("dataType")};"string"==typeof e&&e.length>0&&(t.dimension=e),N.push(t)}}));let S=await o.getClassificationAttributes();if(S&&S.length){let e;for(let i=0;i<S.length;i++){let o=S[i];for(let i=0;i<o.properties.length;i++){void 0===e&&(e=new c({icons:[ICON_TYPE.CLASSIFICATION],label:t.attSelection.classifAttributes,grid:{shouldBeSelected:!1}}),this.options.attModel.addRoot(e));let s=o.properties[i],l=!1;if(-1!==n.indexOf(s.curi)&&(l=!0),!this.attrMap.get(s.curi)){let t={id:s.curi,label:s.label,icons:[ICON_TYPE.CLASSIFICATION],grid:{dataType:s.dataType,dimension:s.dimension,attType:ATT_TYPE.CLASSIFICATION,kind:ATT_TYPE.CLASSIFICATION,exportableFlag:!1,selectedAtt:l},children:null},i=new c(t);y(e,i),!0===i.getReferenceValue("selectedAtt")&&i.hide(),this.attrMap.set(t.id,t)}}}}this.options.attModel.pushUpdate(),i(N)}))},E.prototype.removeSelectedNodes=function(){let e=this.options.attModel.getSelectedNodes();for(let t=0;t<e.length;t++)e[t].hide();return e},E.prototype.addSelectedNodes=function(e){for(let i=0;i<e.length;i++){var t=e[i].options.id;console.log("Show node ["+t+"]");let o=this.options.attModel.search({match:function(e){return e.nodeModel.options.id===t}});1===o.length&&(o[0].show(),o[0].select(!0),this.elements.dgv.ensureNodeModelVisible(o[0],!1,!0,.2))}},E.prototype.__buildView=function(){this.elements.hdr=l.createElement("div",{class:u+"-hdr"}),this.elements.content=l.createElement("div",{class:u+"-content"}),this.elements.container.appendChild(this.elements.hdr),this.elements.container.appendChild(this.elements.content);let e=l.createElement("div",{class:u+"-title"});e.innerText=t.attSelection.title,this.elements.hdr.appendChild(e);let i=a.prototype.createTreeDocument(this.options.toolbarDef);this.elements.toolbar=new a({overflowManagement:"dropdown",direction:"horizontal",items:i}),this.elements.toolbar.getContent().addClassName(u+"-toolbar"),this.elements.hdr.appendChild(this.elements.toolbar.getContent());let o=JSON.parse(JSON.stringify(v.defaultDGVOpts));o.columns=this.options.columns,o.treeDocument=this.options.attModel,o.onContextualEvent=this._onCtxMenuEvent.bind(this);let n=new d({});n.on(),o.placeholder=n.getContent(),o.treeNodeCellOptions={expanderStyle:"triangle",buildLinks:!1},this.elements.dgv=new p(o),this.elements.dgv.getContent().addClassName(u+"-dgv"),this.elements.content.appendChild(this.elements.dgv.getContent()),this.elements.findDialog=new h({domId:u+"-find-dialog",visibleFlag:!1,findWidgetOptions:{relatedWidget:this.elements.dgv,showAdditionnalOptions:!1,inputValidationThreshold:2},position:{my:"top",at:"top",of:this.elements.container}})},E.prototype.__launchTypeAndExtChooser=async function(){let e=new s({appBaseTypes:this.options.appBaseTypes,defaultTypes:this.options.defaultTypes,defaultExts:this.options.defaultExts,selectedTypes:this.options.selectedTypes,selectedExtensions:this.options.selectedExtensions}),t=await e.choose();this.options.onTypesAndExtsChange(t),await this.updateAttList(t)},E.prototype._onCtxMenuEvent=async function(e){return Promise.resolve([])},E.prototype.__selectionChange=function(){this.options.onSelectionChange(this.options.attModel.getSelectedNodes())},E}));const ATT_TYPE={REFERENCE:"Ref",INSTANCE:"Inst",CLASSIFICATION:"Classif",COMPUTED:"Computed",COMMAND:"Cmd"},ICON_TYPE={REFERENCE:{iconName:"object-reference",fontIconFamily:1},INSTANCE:{iconName:"object-instance",fontIconFamily:1},CLASSIFICATION:{iconName:"library-class",fontIconFamily:1},COMPUTED:{iconName:"compute",fontIconFamily:1},COMMAND:{iconName:"run",fontIconFamily:1}},TOOLBAR_RENDERING="functionIcon",MAX_SELECTED_PER_VIEW=50;let widget;define("DS/ENOXGridCusto/ENOXGridCusto",["css!DS/ENOXGridCusto/ENOXGridCusto.css","i18n!DS/ENOXGridCusto/assets/nls/ENOXGridCusto","DS/ENOXGridCusto/views/AttributesSelection","DS/ENOXGridCusto/views/SelectedAttributes","DS/ENOXGridCusto/views/Mask","DS/ENOXGridCusto/services/PlatformURL","DS/ENOXGridCusto/utils/GridUtils","DS/Utilities/Dom","DS/Controls/ComboBox","DS/Controls/Button","DS/Controls/LineEditor","DS/Tweakers/GeneratedToolbar","DS/TreeModel/TreeDocument","UWA/Widget"],(function(e,t,i,o,n,s,l,a,d,r,c,p,h,u){"use strict";const g="gridcusto";function m(e){return this.elements={},widget=new u,widget.setValue("x3dAppId",e.appId),widget.setValue("x3dPlatformId",e.tenantID),this.options=e||{},this.options.preferenceName=l.getURLParameter("prefName"),this.options.lockState="true"===this.options.lockState,this.options.defaultJSON=this.options.defaultJSON,this.options.jsonPref={viewIdx:[]},this.options.jsonPref.views=this.options.defaultJSON.ENO2D_VIEWS.map((e=>(this.options.jsonPref.viewIdx.push(e.ENO2D_VIEW_NAME),e.ENO2D_DEFAULT_TYPES.forEach((t=>{-1===e.ENO2D_BASED_TYPES.indexOf(t)&&e.ENO2D_BASED_TYPES.push(t)})),{viewName:e.ENO2D_VIEW_NAME,defaultTypes:e.ENO2D_DEFAULT_TYPES,defaultExts:e.ENO2D_DEFAULT_EXTS,defaultColumns:e.ENO2D_DEFAULT_COLS,appBaseTypes:e.ENO2D_BASED_TYPES,selectedTypes:e.ENO2D_SELECTED_TYPES.length?e.ENO2D_SELECTED_TYPES:e.ENO2D_DEFAULT_TYPES,selectedExtensions:e.ENO2D_SELECTED_EXTS.length?e.ENO2D_SELECTED_EXTS:e.ENO2D_DEFAULT_EXTS,selectedColumns:e.ENO2D_SELECTED_COLS.length?e.ENO2D_SELECTED_COLS:e.ENO2D_DEFAULT_COLS}))),this.options.activeView=this.options.jsonPref.viewIdx[0],delete this.options.defaultJSON,this.options=Object.assign({},this.options),this.elements.container=a.createElement("div",{class:g+"-frame "+(this.options.lockState?g+"-locked":"")}),this.isUpdateViewComplete=!1,this.options.localWindow.addEventListener("message",(e=>{let t=e.data,i="";if(t.message&&(i=t.message),"com.ds.mep:OnOKBtnClicked_msg"===i){let e={message:"com.ds.mep:OnPrefUpdated_msg"},t={ENO2D_VIEWS:[]};for(let e=0;e<this.options.jsonPref.views.length;e++){let i=this.options.jsonPref.views[e],o={ENO2D_VIEW_NAME:i.viewName,ENO2D_DEFAULT_TYPES:i.defaultTypes,ENO2D_DEFAULT_EXTS:i.defaultExts,ENO2D_DEFAULT_COLS:i.defaultColumns,ENO2D_BASED_TYPES:i.appBaseTypes,ENO2D_SELECTED_TYPES:i.selectedTypes,ENO2D_SELECTED_EXTS:i.selectedExtensions,ENO2D_SELECTED_COLS:i.selectedColumns};t.ENO2D_VIEWS.push(o)}e.jsonData=JSON.stringify(t),this.options.frameCntWindow.postMessage(e,this.options.mepOrigin)}})),this}return m.prototype.initialize=async function(){l.setLang(this.options.compassConfig.lang),await s.initialize(this.options.compassConfig),await this.__buildUX(),await this.__updateView()},m.prototype.__buildUX=async function(){this.elements.hdr=a.createElement("div",{class:g+"-hdr"}),this.elements.container.appendChild(this.elements.hdr);let e=a.createElement("div",{class:g+"-hdr-label"});e.innerText=t.views.viewLabel,this.elements.hdr.appendChild(e);let n=this.options.jsonPref.views.map((e=>t.views[e.viewName]?t.views[e.viewName]:e.viewName)),s=this.options.jsonPref.views.map((e=>e.viewName)),l=a.createElement("div",{class:g+"-hdr-view"});this.elements.hdr.appendChild(l),this.options.viewModel=new h;for(let e=0;e<n.length;e++)this.options.viewModel.addRoot({label:n[e],value:s[e]});let r=this.elements.hdrCombo=new d({disabled:"TABLE_DEFAULT"===this.options.preferenceName,enableSearchFlag:!1,elementsTree:this.options.viewModel,selectedIndex:0});if(r.getContent().addEventListener("change",(e=>{let t=e.dsModel.elementsTree.getSelectedNodes()[0].options.value;console.log("== Change view to "+t),this.options.activeView=t,this.options.activePref=this.options.jsonPref.views[this.options.jsonPref.viewIdx.indexOf(this.options.activeView)],this.__updateView()})),r.getContent().addClassName(g+"-hdr-combo"),l.appendChild(r.getContent()),"TABLE_CUSTO"===this.options.preferenceName&&!1===this.options.lockState){let e=this.elements.hdrEditor=new c({requiredFlag:!0,displayClearFieldButtonFlag:!0});e.addEventListener("change",(e=>{e.dsModel.value.length>2&&(this.__addInProgress?this.__manageView("addView"):this.__editInProgress&&this.__manageView("editView"))})),e.getContent().addClassName(g+"-hdr-editor hidden"),l.appendChild(e.getContent());let i=a.createElement("div",{class:g+"-hdr-toolbar"});this.elements.hdr.appendChild(i);let o={entries:[{id:"addView",dataElements:{typeRepresentation:TOOLBAR_RENDERING,icon:{iconName:"plus",fontIconFamily:1},value:()=>{this.__manageView("addView")},position:"near",category:"hdrcmd",disabled:n.length>=4,tooltip:t.views.addView}},{id:"validateViewAdd",dataElements:{typeRepresentation:TOOLBAR_RENDERING,icon:{iconName:"check",fontIconFamily:1},value:()=>{this.__manageView("addView")},position:"near",category:"hdrcmd",tooltip:t.views.addView,visibleFlag:!1}},{id:"editView",dataElements:{typeRepresentation:TOOLBAR_RENDERING,icon:{iconName:"pencil",fontIconFamily:1},value:()=>{this.__manageView("editView")},position:"near",category:"hdrcmd",tooltip:t.views.editView}},{id:"validateView",dataElements:{typeRepresentation:TOOLBAR_RENDERING,icon:{iconName:"check",fontIconFamily:1},value:()=>{this.__manageView("editView")},position:"near",category:"hdrcmd",tooltip:t.views.editView,visibleFlag:!1}},{id:"removeView",dataElements:{typeRepresentation:TOOLBAR_RENDERING,icon:{iconName:"trash",fontIconFamily:1},value:e=>{this.__manageView("removeView")},position:"near",category:"hdrcmd",disabled:n.length<2,tooltip:t.views.removeView}}]},s=p.prototype.createTreeDocument(o);this.elements.toolbar=new p({overflowManagement:"dropdown",direction:"horizontal",items:s}),this.elements.toolbar.getContent().addClassName(g+"-toolbar"),i.appendChild(this.elements.toolbar.getContent())}if(this.elements.content=a.createElement("div",{class:g+"-content "+(this.options.lockState?g+"content-locked":"")}),this.elements.container.appendChild(this.elements.content),!1===this.options.lockState){this.elements.attSelection=new i({onSelectionChange:this.__selectAttChange.bind(this),onTypesAndExtsChange:this.__typesAndExtsChange.bind(this)}),this.elements.content.appendChild(this.elements.attSelection.getContent());let e=a.createElement("div",{class:g+"-arrows"});this.elements.content.appendChild(e);let o={entries:[{id:"arrowRight",dataElements:{typeRepresentation:TOOLBAR_RENDERING,icon:{iconName:"right",fontIconFamily:1},value:()=>{this.__addToSelectedAtt()},position:"center",category:"hdrArrow",disabled:!0,tooltip:t.views.arrowRight}},{id:"arrowLeft",dataElements:{typeRepresentation:TOOLBAR_RENDERING,icon:{iconName:"left",fontIconFamily:1},value:this.__removeFromSelectedAtt.bind(this),position:"center",category:"hdrArrow",tooltip:t.views.arrowLeft}}]},n=p.prototype.createTreeDocument(o);this.elements.toolbarArrow=new p({overflowManagement:"dropdown",direction:"vertical",items:n}),this.elements.toolbarArrow.getContent().addClassName(g+"-toolbar-arrow"),e.appendChild(this.elements.toolbarArrow.getContent())}this.elements.selectedAttributes=new o({locked:this.options.lockState,onSelectionChange:this.__addSelectedAttChange.bind(this),onSelectedAttributeChange:this.__selectedAttChange.bind(this)}),this.elements.content.appendChild(this.elements.selectedAttributes.getContent()),this.elements.targetDiv=document.getElementById(this.options.targetId),this.elements.targetDiv.innerHTML="",this.elements.targetDiv.appendChild(this.elements.container)},m.prototype.__selectAttChange=function(e){let t=!(e.length>0&&this.elements.selectedAttributes.getSelectedColumns().length<MAX_SELECTED_PER_VIEW);this.elements.toolbarArrow.updateNodeModel("arrowRight",{disabled:t,grid:{disabled:t}})},m.prototype.__addSelectedAttChange=function(e){1===e.length?e[0].getReferenceValue("mandatory")?this.elements.toolbarArrow.updateNodeModel("arrowLeft",{icon:{iconName:"block",fontIconFamily:WUXManagedFontIcons.Font3DS},disabled:!0,grid:{disabled:!0}}):this.isUpdateViewComplete&&this.elements.toolbarArrow.updateNodeModel("arrowLeft",{disabled:!1,grid:{disabled:!1}}):this.elements.toolbarArrow.updateNodeModel("arrowLeft",{icon:{iconName:"left",fontIconFamily:WUXManagedFontIcons.Font3DS},disabled:!0,grid:{disabled:!0}})},m.prototype.__addToSelectedAtt=function(){let e=this.elements.attSelection.removeSelectedNodes();this.elements.selectedAttributes.addSelectedNodes(e)},m.prototype.__removeFromSelectedAtt=function(){let e=this.elements.selectedAttributes.removeSelectedNodes();this.elements.attSelection.addSelectedNodes(e)},m.prototype.__typesAndExtsChange=function(e){this.options.activePref=Object.assign(this.options.activePref,e)},m.prototype.__selectedAttChange=function(e){this.options.activePref.selectedColumns=e},m.prototype.__manageView=async function(e){switch(e){case"addView":if(!0===this.__addInProgress){delete this.__addInProgress,0===this.options.viewModel.search({match:e=>e.nodeModel.getLabel()===this.elements.hdrEditor.value}).length?(this.options.viewModel.addRoot({label:this.elements.hdrEditor.value,value:this.elements.hdrEditor.value}),this.options.jsonPref.viewIdx.push(this.elements.hdrEditor.value),this.options.jsonPref.views.push(JSON.parse(JSON.stringify(this.options.activePref))),this.options.activeView=this.elements.hdrEditor.value,this.options.activePref=this.options.jsonPref.views[this.options.jsonPref.viewIdx.indexOf(this.options.activeView)],this.options.activePref.viewName=this.options.activeView,this.options.viewModel.getRoots()[this.options.viewModel.getRoots().length-1].select(!0)):l.displayNotif({level:"warning",title:t.warning.viewAlreadyExistsAdd.title,message:t.replace(t.warning.viewAlreadyExistsAdd.msg,{viewName:this.elements.hdrEditor.value}),sticky:!1,key:"viewAlreadyExistsAdd"}),this.elements.hdrCombo.getContent().toggleClassName("hidden"),this.elements.hdrEditor.getContent().toggleClassName("hidden"),this.elements.toolbar.updateNodeModel("validateViewAdd",{visibleFlag:!1}),this.elements.toolbar.updateNodeModel("addView",{visibleFlag:!0,disabled:this.options.viewModel.getRoots().length>=4,grid:{disabled:this.options.viewModel.getRoots().length>=4}}),this.elements.toolbar.updateNodeModel("removeView",{disabled:this.options.viewModel.getRoots().length<2,grid:{disabled:this.options.viewModel.getRoots().length<2}}),this.elements.content.removeAttribute("disabled")}else{this.elements.hdrCombo.getContent().toggleClassName("hidden");let e=this.options.viewModel.getSelectedNodes()[0].getLabel();this.elements.hdrEditor.value=t.replace(t.views.copyOf,{viewName:e}),this.elements.hdrEditor.getContent().toggleClassName("hidden"),this.elements.toolbar.updateNodeModel("addView",{visibleFlag:!1}),this.elements.toolbar.updateNodeModel("validateViewAdd",{visibleFlag:!0}),this.__addInProgress=!0,this.elements.content.setAttribute("disabled","")}break;case"editView":if(!0===this.__editInProgress){if(delete this.__editInProgress,0===this.options.viewModel.search({match:e=>e.nodeModel.getLabel()===this.elements.hdrEditor.value}).length){let e=this.options.viewModel.getSelectedNodes()[0];this.options.viewModel.prepareUpdate(),e.updateOptions({label:this.elements.hdrEditor.value,value:this.elements.hdrEditor.value}),this.options.viewModel.pushUpdate(),this.options.jsonPref.viewIdx[this.options.jsonPref.viewIdx.indexOf(this.options.activeView)]=this.elements.hdrEditor.value,this.options.activeView=this.elements.hdrEditor.value,this.options.activePref=this.options.jsonPref.views[this.options.jsonPref.viewIdx.indexOf(this.options.activeView)],this.options.activePref.viewName=this.options.activeView,this.elements.hdrCombo.selectedIndex=this.options.jsonPref.viewIdx.indexOf(this.options.activeView)}else l.displayNotif({level:"warning",title:t.warning.viewAlreadyExistsMod.title,message:t.replace(t.warning.viewAlreadyExistsMod.msg,{viewName:this.elements.hdrEditor.value}),sticky:!1,key:"viewAlreadyExistsMod"});this.elements.hdrEditor.getContent().toggleClassName("hidden"),this.elements.hdrCombo.getContent().toggleClassName("hidden"),this.elements.hdrCombo._selectedIndexModified(),this.__updToolbarIcon=!0,this.elements.toolbar.updateNodeModel("validateView",{visibleFlag:!1}),this.elements.toolbar.updateNodeModel("editView",{visibleFlag:!0}),this.elements.content.removeAttribute("disabled")}else{this.elements.hdrCombo.getContent().toggleClassName("hidden");let e=this.options.viewModel.getSelectedNodes()[0];this.elements.hdrEditor.value=e.getLabel(),this.elements.hdrEditor.getContent().toggleClassName("hidden"),this.elements.toolbar.updateNodeModel("editView",{visibleFlag:!1}),this.elements.toolbar.updateNodeModel("validateView",{visibleFlag:!0}),this.__editInProgress=!0,this.elements.content.setAttribute("disabled","")}break;case"removeView":let e=this.options.viewModel.getSelectedNodes()[0],i=this.options.jsonPref.viewIdx.indexOf(e.getLabel());this.options.jsonPref.viewIdx.splice(i,1),this.options.jsonPref.views.splice(i,1),this.options.viewModel.prepareUpdate(),this.options.viewModel.removeRoot(e),this.options.viewModel.pushUpdate(),this.options.activeView=this.options.viewModel.getRoots()[this.options.viewModel.getRoots().length-1].getLabel(),this.options.activePref=this.options.jsonPref.views[this.options.jsonPref.viewIdx.indexOf(this.options.activeView)],this.elements.hdrCombo.selectedIndex=0,this.options.viewModel.getRoots()[0].select(!0),this.elements.hdrCombo._selectedIndexModified(),this.elements.toolbar.updateNodeModel("addView",{icon:{iconName:"plus"},disabled:this.options.viewModel.getRoots().length>=4,grid:{disabled:this.options.viewModel.getRoots().length>=4}}),this.elements.toolbar.updateNodeModel("removeView",{disabled:this.options.viewModel.getRoots().length<2,grid:{disabled:this.options.viewModel.getRoots().length<2}})}},m.prototype.__updateView=async function(){n.mask(this.elements.container,t.loading.gridCusto);let e=this.options.activePref=this.options.jsonPref.views[this.options.jsonPref.viewIdx.indexOf(this.options.activeView)];!1===this.options.lockState&&(this.elements.toolbarArrow.updateNodeModel("arrowLeft",{disabled:!0}),this.elements.attSelection.updateAttList(e).then((e=>{this.elements.toolbarArrow.updateNodeModel("arrowLeft",{disabled:!1}),this.isUpdateViewComplete=!0,e.length>0&&this.elements.selectedAttributes.updateAttributeDef(e)}))),await this.elements.selectedAttributes.updateAttList(e),n.unmask(this.elements.container)},m}));