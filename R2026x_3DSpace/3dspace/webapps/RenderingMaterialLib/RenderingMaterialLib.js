define("DS/RenderingMaterialLib/MaterialMappingCoreServices",["DS/Visualization/ThreeJS_DS"],(function(e){var a=function(e,a){let t=new Array(4);return t[0]=e[0]*a[0]+e[1]*a[2],t[1]=e[0]*a[1]+e[1]*a[3],t[2]=e[2]*a[0]+e[3]*a[2],t[3]=e[2]*a[1]+e[3]*a[3],t},t=function(t){let n=[1,0,0,1];n[0]=t.scale_u>0?1/t.scale_u:1,n[3]=t.scale_v>0?1/t.scale_v:1;let o=[1,0,0,1];o[0]=t.flip_u?-1:1,o[3]=t.flip_v?-1:1;let i=[1,0,0,1];if(0!=t.angle){let e=Math.sin(t.angle),a=Math.cos(t.angle);i=[a,e,-e,a]}const l=a(a(o,i),n),s=[-t.offset_u,-t.offset_v];return new e.Matrix3(l[0],l[2],s[0],l[1],l[3],s[1],0,0,1)},n=function(e,a){if(!a)return e;let t={};return t.angle=a.angle??e.angle,t.flip_u=a.flip_u??e.flip_u,t.flip_v=a.flip_v??e.flip_v,t.mapFocus=a.mapFocus??e.mapFocus,t.offset_u=a.offset_u??e.offset_u,t.offset_v=a.offset_v??e.offset_v,t.repeat_u=a.repeat_u??e.repeat_u,t.repeat_v=a.repeat_v??e.repeat_v,t.scale_u=a.scale_u??e.scale_u,t.scale_v=a.scale_v??e.scale_v,t.type=a.type??e.type,t},o=a=>{let t=new e.Matrix4;if(16==a.length)t.setFromArray(a);else if(12==a.length){const e=a;t.set(e[0],e[3],e[6],e[9],e[1],e[4],e[7],e[10],e[2],e[5],e[8],e[11],0,0,0,1)}return t},i={CATMappingSemantic:{LegacyMapping:0,DecoupledMapping:1},CATMappingBehavior:{TextureFocused:0,SurfaceFocused:1},CATMappingType:{Planar:0,Spherical:1,Cylindrical:2,Box:3,Auto:4,Adaptive:5,UV:6,HemiSpherical:7,InfCylindrical:8,Conical:9},UnifyMappingScaleParams:function(e){e&&(!("scale_u"in e)&&"global_scale"in e&&(e.scale_u=e.global_scale?e.global_scale:1,delete e.global_scale),!("scale_v"in e)&&"scale_ratio"in e&&(e.scale_v=e.scale_ratio?e.scale_ratio:1,e.scale_v=e.scale_u/e.scale_v,delete e.scale_ratio))},CreateDefaultMapping:function(){return{scale_u:1,scale_v:1,offset_u:0,offset_v:0,angle:0,repeat_u:!0,repeat_v:!0,flip_u:!1,flip_v:!1,mapFocus:this.CATMappingBehavior.SurfaceFocused,type:this.CATMappingType.UV}},SanitizeMappingInfo:function(e){e.scale_u=Math.abs(e.scale_u)<1e-8?1:e.scale_u,e.scale_v=Math.abs(e.scale_v)<1e-8?1:e.scale_v},ResolveReferenceMappingInfo:function(e){let a=this.CreateDefaultMapping();return a.mapFocus=this.CATMappingBehavior.TextureFocused,a=n(a,e),this.SanitizeMappingInfo(a),a},ResolveChannelMappingInfo:function(e,a){let t=this.ResolveReferenceMappingInfo(e),o=Object.assign({},t);return o=n(o,a),o.mapFocus=t.mapFocus,o.type=t.type,this.SanitizeMappingInfo(o),o},ResolveApplicationMappingInfo:function(e,a){let t=this.CreateDefaultMapping();return t.mapFocus=a.mapFocus,t.type=a.type,t.repeat_u=a.repeat_u,t.repeat_v=a.repeat_v,t=n(t,e),this.SanitizeMappingInfo(t),t},Decoupled:{ApplyMapping:function(e,a){let t=Object.assign({},e);return a&&t.mapFocus==i.CATMappingBehavior.TextureFocused&&(t.scale_u*=parseFloat(a.Width),t.scale_v*=parseFloat(a.Height),t.offset_u*=t.scale_u,t.offset_v*=t.scale_v),t.type==i.CATMappingType.UV&&t.mapFocus!=i.CATMappingBehavior.TextureFocused||(t.offset_u-=.5,t.offset_v-=.5),t},ComputeObjectTransform:function(a,t){let n=null;if(t.type!=i.CATMappingType.UV&&a){n=new e.Matrix4;const l=o(a);if(t.mapFocus==i.CATMappingBehavior.TextureFocused){let a=(new e.Vector3).getPositionFromMatrix(l);a.negate();let t=(new e.Matrix4).extractRotation(l);t.transpose();let o=(new e.Vector3).copy(a);o.applyMatrix4(t),n=(new e.Matrix4).copy(t),n.setPosition(o)}else{const a=!1;n=(new e.Matrix4).getInverse(l,a)}}return n},ComputeApplicationUvTransform:function(e){let a=Object.assign({},e);return t(a)},ComputeChannelUvTransform:function(e,a){let n=this.ApplyMapping(e,a);return t(n)},CombineMapping:function(a,t){let n=a,o=t,i=n.elements[6],l=n.elements[7],s=o.elements[6],r=o.elements[7],p=new e.Matrix3(1,0,i+s-.5,0,1,l+r-.5,0,0,1),c=new e.Matrix3(n.elements[0],n.elements[3],0,n.elements[1],n.elements[4],0,0,0,1),u=new e.Matrix3(o.elements[0],o.elements[3],.5,o.elements[1],o.elements[4],.5,0,0,1),f=new e.Matrix3;return f.multiplyMatrices(u,c),f.multiplyMatrices(f,p),f}},Legacy:{ApplyMapping:function(e,a){let t=Object.assign({},e);return a&&t.mapFocus==i.CATMappingBehavior.TextureFocused&&(t.scale_u*=parseFloat(a.Width),t.scale_v*=parseFloat(a.Height),t.offset_u/=t.scale_u,t.offset_v/=t.scale_v,t.offset_u-=.5,t.offset_v-=.5),t},ComputeObjectTransform:function(a){let t=null;if(a){const n=o(a),i=!1;t=(new e.Matrix4).getInverse(n,i)}return t},ComputeUvTransform:function(a,n,o){let l=new e.Matrix3;if(a.type===i.CATMappingType.UV){const e=this.ApplyMapping(n,o),i=t(e),s=t(a);l.multiplyMatrices(i,s)}else{let e=Object.assign({},n);a&&(null!=a.scale_u&&(e.scale_u*=a.scale_u),null!=a.scale_v&&(e.scale_v*=a.scale_v),null!=a.offset_u&&(e.offset_u+=a.offset_u),null!=a.offset_v&&(e.offset_v+=a.offset_v),null!=a.flip_u&&(e.flip_u^=a.flip_u),null!=a.flip_v&&(e.flip_v^=a.flip_v),null!=a.angle&&(e.angle+=a.angle)),e=this.ApplyMapping(e,o),l=t(e)}return l}},Decal:{ComputeIsometryMatrix:function(a){let t=new e.Matrix4;if(a){const n=o(a),i=(new e.Vector3).getPositionFromMatrix(n),l=(new e.Matrix4).extractRotation(n);t=(new e.Matrix4).copy(l),t.setPosition(i)}return t},ComputeBoundingBox:function(a){let t=new e.Vector3(0,0,0);if(a){const e=o(a);t.x=e.getScaleOnAxisX(),t.y=e.getScaleOnAxisY(),t.z=e.getScaleOnAxisZ()}return t},ComputeApplicationUvTransform:function(t,n){if(t.type!==i.CATMappingType.UV)return null;let o=Object.assign({},t);i.SanitizeMappingInfo(o),o.mapFocus=i.CATMappingBehavior.TextureFocused;const l=n[0]*t.scale_u,s=n[1]*t.scale_v;return o.scale_u=1e3*l,o.scale_v=1e3*s,o.offset_u/=1e3,o.offset_v/=1e3,function(t){let n=[1,0,0,1];n[0]=t.scale_u>0?1/t.scale_u:1,n[3]=t.scale_v>0?1/t.scale_v:1;let o=[1,0,0,1];o[0]=t.flip_u?-1:1,o[3]=t.flip_v?-1:1;let i=[1,0,0,1];if(0!=t.angle){let e=Math.sin(t.angle),a=Math.cos(t.angle);i=[a,-e,e,a]}const l=a(i,a(o,n)),s=[-t.offset_u,-t.offset_v],r=[s[0]*l[0]+s[1]*l[2],s[0]*l[1]+s[1]*l[3]];return new e.Matrix3(l[0],l[2],r[0],l[1],l[3],r[1],0,0,1)}(o)},ComputeImplicitScale:function(e,a,t){let n=1,o=1;const l=e.type;if(l!==i.CATMappingType.UV){const s=e.scale_u,r=e.scale_v,p=a[0]*s,c=a[1]*r;l===i.CATMappingType.InfCylindrical||l===i.CATMappingType.Conical?(n=.5/s,o=t.z/c):(n=t.x/p,o=t.y/c),e.flip_u&&(n*=-1),e.flip_v&&(o*=-1)}return[n,o]}},computeApplicationMapping:function(a,t,n){let o=this.ResolveReferenceMappingInfo(a),i=this.ResolveApplicationMappingInfo(t,o),l={};if(l.type=i.type,n===this.CATMappingSemantic.DecoupledMapping){l.uv_transform=this.Decoupled.ComputeApplicationUvTransform(i);const e=this.Decoupled.ComputeObjectTransform(t.object_transform,i);e&&(l.object_transform=e)}else{l.uv_transform=new e.Matrix3;const a=this.Legacy.ComputeObjectTransform(t.object_transform);a&&(l.object_transform=a)}return l},computeChannelMapping:function(e,a,t,n,o){let i=this.ResolveChannelMappingInfo(e,t);const l=this.ResolveApplicationMappingInfo(a,i);null!=l.mapFocus&&(i.mapFocus=l.mapFocus),null!=l.type&&(i.type=l.type),null!=l.repeat_u&&(i.repeat_u=l.repeat_u),null!=l.repeat_v&&(i.repeat_v=l.repeat_v);let s={};return s.repeat_u=i.repeat_u,s.repeat_v=i.repeat_v,o===this.CATMappingSemantic.DecoupledMapping?s.uv_transform=this.Decoupled.ComputeChannelUvTransform(i,n):s.uv_transform=this.Legacy.ComputeUvTransform(l,i,n),s},combineMappingResults:function(e,a,t){let n={};return n.repeat_u=a.repeat_u,n.repeat_v=a.repeat_v,n.type=e.type,t===this.CATMappingSemantic.DecoupledMapping?n.uv_transform=this.Decoupled.CombineMapping(e.uv_transform,a.uv_transform):n.uv_transform=a.uv_transform,e.object_transform&&(n.object_transform=e.object_transform),n},computeDecalProjectorMatrix:function(e){const a=e.object_transform;let t=this.Decal.ComputeBoundingBox(a);t.multiplyScalar(1e3);let n=this.Decal.ComputeIsometryMatrix(a);return n.scale(t),n},computeDecalMappingTransform:function(e,a){const t=this.Decal.ComputeBoundingBox(e.object_transform),n=a??[.3,.3],o=this.ResolveApplicationMappingInfo(e,this.CreateDefaultMapping()),i=this.Decal.ComputeImplicitScale(o,n,t);return{implicitScale:{x:i[0],y:i[1]},uvTransform:this.Decal.ComputeApplicationUvTransform(o,n)}}};return i})),define("DS/RenderingMaterialLib/VisuConversionHelpers",["DS/Visualization/ThreeJS_DS","DS/RenderingMaterialLib/MaterialMappingCoreServices"],(function(e,a){"use strict";const t="true"===localStorage.getItem("XCT_AC_LOG_ENABLE"),n={abbeNumber:"Abbe_Number",anisotropy:"Anisotropy",anisotropyRotation:"AnisotropyRotation",attenuationColor:"Attenuation_Color",attenuationDistance:"Attenuation_Distance",clearcoat:"Clearcoat",clearcoatRoughness:"Clearcoat_Roughness",clearcoatNormal:"Clearcoat_Normal",albedo:"Albedo",emissionColor:"Emission_Color",emissionEnergyNormalization:"Emission_Energy_Normalization",emissionMode:"Emission_Mode",emissionValue:"Emission_Value",flakeColor:"Flake_Color",flakeCoverage:"Flake_Density",flakeDensity:"Flake_Density",flakeRoughness:"Flake_Roughness",flakeSize:"Flake_Size",flipFlop:"Flake_Flipflop",flipFlopColor:"Flake_Flipflop_Color",ior:"IOR",metallic:"Metallic",roughness:"Roughness",sheenColor:"SheenColor",sheenRoughness:"SheenRoughness",specular:"Specular",specularTint:"Specular_Tint",subsurfaceAnisotropy:"Subsurface_Anisotropy",subsurfaceColor:"Subsurface_Color",thinFilm:"ThinFilm",thinFilmThickness:"ThinFilmThickness",thinFilmIOR:"ThinFilmIOR",thinWalled:"Thin_Walled",translucency:"Translucency",translucencyColor:"Translucency_Color",translucencyColorFromAlbedo:"Translucency_Color_From_Albedo",transparency:"Transparency",displacement:"Displacement",normal:"Normal",cutoutOpacity:"Opacity",offset_u:"Offset_U",offset_v:"Offset_V",scale_u:"ScaleU",scale_v:"ScaleV",angle:"Angle",repeat_u:"RepeatU",repeat_v:"RepeatV",flip_u:"Flip_U",flip_v:"Flip_V",type:"Mapping",behavior:"Mapping_Behavior"};class o{constructor(e,a,t){this._id=e,this._type=a,this._flags=t}get id(){return this._id}get type(){return this._type}get flags(){return this._flags}get uvTransformId(){return this.hasUvTransform()?this.id+"UvTransform":null}isSupported(){return 0!=this.flags}hasValue(){return 0!=(1&this.flags)}hasUvTransform(){return 0!=(8&this.flags)}}const i=function(e,a){return new o(e,1,a=null!=a?a:15)},l=function(e){return new o(e,2,1)},s=function(e){return e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055},r={Albedo:i("diffuse"),Diffuse_Color:i("diffuse"),Anisotropy:i("anisotropy"),AnisotropyRotation:i("anisotropyAngle"),Attenuation_Color:i("attenuationColor",1),Attenuation_Distance:i("attenuationDistance",1),Clearcoat:i("clearCoat"),Clearcoat_Roughness:i("clearCoatRoughness"),Clearcoat_Normal:i("clearCoatNormal",14),Opacity:i("opacity"),Displacement:i("displacement",14),Emission_Color:i("emissionColor"),Emission_Texture:i("emissionColor"),Emissive_Color:i("emissionColor"),Emission_Energy_Normalization:i("emissionNormalized",1),Emission_Value:i("emissionValue",1),Flake_Color:i("flakesColor"),Flake_Density:i("flakesCoverage"),Flake_Flipflop:i("flipFlop"),Flake_Flipflop_Color:i("flipFlopColor"),Flake_Roughness:i("flakesRoughness"),Flake_Size:i("flakesSize"),IOR:i("ior",1),Metallic:i("metalness"),Normal:i("normal",14),Roughness:i("roughness"),SheenColor:i("sheenColor"),SheenRoughness:i("sheenRoughness"),Specular:i("specularContribution"),Specular_Tint:i("specular"),Subsurface_Anisotropy:i("subsurfaceAnisotropy",1),Subsurface_Color:i("subsurfaceColor",1),Thin_Walled:i("thinWalled",1),ThinFilm:i("iridescence "),ThinFilmThickness:i("iridescenceThickness "),ThinFilmIOR:i("iridescenceIoR",1),Translucency:i("translucency"),Translucency_Color:i("translucencyColor"),translucencyColorFromAlbedo:i("useTranslucencyColorFromAlbedo",1),Transparency:i("transparency"),Abbe_Number:i(null,0),Emission_Mode:i(null,0),Angle:l("angle"),Flip_U:l("flip_u"),Flip_V:l("flip_v"),Mapping:l("type"),Mapping_Behavior:l("mapFocus"),Offset_U:l("offset_u"),Offset_V:l("offset_v"),RepeatU:l("repeat_u"),RepeatV:l("repeat_v"),Scale:l("global_scale"),ScaleU:l("scale_u"),ScaleV:l("scale_v"),Scale_Ratio:l("scale_ratio")},p={CATRmaScalar:e=>parseFloat(e),CATRmaBoolean:e=>e,CATRmaInteger:e=>parseInt(e),CATRmaVector:a=>new e.Vector3(a[0],a[1],a[2]),CATRmaColor:a=>new e.Color(a.map(s))};return{ParamType:{Material:1,Mapping:2},ParamFlag:{Unsupported:0,HasValue:1,HasTexture:2,HasMAD:4,HasUVTrf:8},ConvertValue:function(e,a){const n=p[e];return null!=n?n(a):(t&&console.warn(`[AC] No suitable conversion for type ${e} found.`),a)},GetVisMappingType:function(n){switch(n){case a.CATMappingType.Planar:return e.MappingType.PLANAR;case a.CATMappingType.Spherical:return e.MappingType.SPHERICAL;case a.CATMappingType.Cylindrical:return e.MappingType.FINITE_CYLINDRICAL;case a.CATMappingType.InfCylindrical:return e.MappingType.INFINITE_CYLINDRICAL;case a.CATMappingType.Conical:return e.MappingType.INFINITE_CYLINDRICAL_NORM_ANGLE_PRES;case a.CATMappingType.Box:return e.MappingType.CUBIC;case a.CATMappingType.UV:return e.MappingType.NONE;default:return t&&console.warn("[AC] Unsupported Mapping Type:",n),e.MappingType.NONE}},GetVisParamDesc:function(e){let a=r[e];return a||(a=r[e=n[e]]),a}}}));