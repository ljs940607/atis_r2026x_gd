/*!  Copyright 2016 Dassault Systemes. All rights reserved. */
define("DS/GEOMSCommands/GEOMSRestoreParamCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/Core/Core"],(function(e,t,n){"use strict";return t.extend({init:function(e){this._parent(e,{mode:"shared",isAsynchronous:!1})},beginExecute:function(){this._frmWindow=this.getFrameWindow()},execute:function(){console.log("restore");var e=function(e){e.msaResult3d.restore(),e.msaResult3d.applyPeriod(),console.log(e.msaResult3d.initCanvassetting)};if("undefined"!=typeof xCity&&xCity){var t=xCity.get3DRootNode(),n=function(e){return e.parents.length?n(e.parents[0]):e};n(t).getChildrenByName("Result3dNode").forEach((function(t){e(t)}))}else{var i=this.getFrameWindow().getRootNode().getChildByName("scene").getChildByName("Result3dNode");e(i)}("undefined"!=typeof xCity&&xCity?xCity.renderScene:this.getFrameWindow().getViewer().render)()}})})),define("DS/GEOMSCommands/GEOMSAnimateCmd",["UWA/Core","UWA/Element","DS/ApplicationFrame/Command","DS/Core/Core","DS/GEOMineSchedExperience/GEOMineSchedPlayerHelper","DS/ApplicationFrame/PlayerStyle","DS/ApplicationFrame/AfrPlayerService","DS/Controls/Popup","DS/Controls/SpinBox","DS/PlatformAPI/PlatformAPI"],(function(e,t,n,i,o,r,a,s,l,d){"use strict";var u;return n.extend({init:function(e){this._parent(e,{isAsynchronous:!1,mode:"exclusive"})},beginExecute:function(){u=0!=document.getElementsByClassName("wux-controls-playerview").length},execute:function(){function e(){let e={data:{source:a._playerView}},t=a._playerView._callbacks;t.stop(e),t.exit(e)}if(u)e();else{d.unsubscribe("GEOMS_HideAnimate",(function(){e()}));var t,n,i=this.getFrameWindow(),s={},m=i.getUIFrame();this.immersiveFrame=i.getImmersiveFrame(),(n=o.createPlayerContainer(m)).setStyles({position:"absolute",left:"0px",right:"0px",bottom:"50px",background:"rgba(241, 241, 241, 0)"}),n.addClassName("GEOMS_HideAnimate"),s.style=r.SIMPLE,s.excludedElements=[13],(t={}).FrameWindow=i,s.callbacks=o.getCallbacks(t),a.createPlayer(s),a.showPlayer();var c={data:{source:a._playerView}},p=a._playerView._callbacks,g=new l({domId:"btnRatio",value:1,units:"x",minValue:.1,maxValue:99.99,stepValue:.01,pageStepValue:1});g.elements.container.setStyles({"min-width":"35px","max-width":"35px",padding:"0",margin:"0"}),g.elements.inputField.setStyles({width:"35px","padding right":"0","padding left":"0"}),g.elements.buttonsDiv.setStyles({visibility:"hidden",width:"0"}),g.inject(a._playerView.elements.rightFixedContainer,"top"),g.addEventListener("change",(function(e){/^([0-9]{1,2}){1}(\.[0-9]{1,2})?$/.test(g.value)&&0!=g.value&&(a._playerView.geoCurrentSpeed=g.value,"play"===a._state.state&&p.play(c))}))}},endExecute:function(){if(!u){var n={data:{source:a._playerView}},i=a._playerView._callbacks,o=a._playerView.elements.slider,r=this.getFrameWindow().getRootNode();if(r){var l=r.getChildByName("scene");if(l){var d=l.getChildByName("Result3dNode");if(d){for(var m=new t("div",{id:"periodDiv",styles:{height:"10px",display:"flex","margin-right":a._playerView.elements.rightFixedContainer.offsetWidth+15,"margin-left":a._playerView.elements.leftOrBottom.offsetWidth+15,"flex-direction":"row","justify-content":"space-around"}}),c=d.msaResult3d.periods.length,p=1;p<c;p++){var g=d.msaResult3d.periods[p],f=new t("div",{id:"MSperiod"+p,class:"wux-afr-cmdstarter",value:p,styles:{margin:"1px",width:"100%",height:"8px","background-color":"#A2CADF"}}),h=new s({target:f,trigger:"hover",position:"top",arrowBoxFlag:!0,overlap:!1,offset:{x:-f.getBoundingClientRect().width/2,y:-10},constraint:"screen",mouseRelativePosition:!1});h.getContent().addClassName("wux-slider-tooltip");var v=e.Element("span");v.textContent=y(g),h.setBody(v),f.addEventListener("mouseenter",(function(e){h.offset.x=-e.target.getBoundingClientRect().width/2,console.log(e.target.getBoundingClientRect().width/2)})),f.addEventListener("click",(function(e){var t=e.target.value/(c-1);n.data.value=t,o.value=100*t,i.slider(n)})),f.inject(m)}function y(e){return e&&e.start&&e.end?e.number+": "+e.start.toLocaleDateString("en-US")+" - "+e.end.toLocaleDateString("en-US"):0===a._playerView.elements.slider.value?"Start of schedule":100===a._playerView.elements.slider.value?"End of schedule":""}m.inject(a._playerView.elements.container,"before"),window.addEventListener("resize",(function(){if(document.contains(document.querySelector(".GEOMS_HideAnimate"))){var e=a._playerView.elements.extensibleContainer.getSize();m.style.width=e.width}})),a._playerView.elements.slider.getTextFromValue=function(){return y(d.msaResult3d.periods[a._playerView.geoCurrentPeriod])}}}}i.play(n)}},destroy:function(){a.hidePlayer()}})})),define("DS/GEOMSCommands/GEOMSDisplayTooltipsCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/Core/Core","DS/Selection/PSOManager","DS/CoreEvents/Events","DS/Controls/TooltipModel","DS/Controls/Tooltip"],(function(e,t,n,i,o,r,a){"use strict";return t.extend({init:function(e){this._parent(e,{isAsynchronous:!0,mode:"exclusive"})},beginExecute:function(){var e=this,t=e.getFrameWindow().elements.viewerFrame;e.tooltip||(e.tooltip=new a({target:t})),e.tooltip&&(e.tooltip.hide(),e.tooltip.tooltipInfos=void 0,t.tooltipInfos=void 0),e.tokenMouse=[],e.tokenAddToPSO=i.onAdd((function(n){var i=n.pathElement.getLastElement(),a="";i.tags&&i.tags.length&&(a="<div>"+i.tags.toString().replace(/\,/g,"<br>")+"</div>"),t.tooltipInfos||(t.tooltipInfos=new r({title:"Tags",shortHelp:a})),i.tags&&i.tags.length&&(e.tokenMouse[i.id]=o.subscribe({event:"/VISU/onMouseMove"},(function(n){var i=n.from[0].currentPosition;e.tooltip&&(e.tooltip.mousePosition=i,e.tooltip.target=t,setTimeout((function(){e.tooltip.show()}),800))})))})),e.tokenRemoveFromPSO=i.onRemove((function(n){var i=n.pathElement.getLastElement();e.tokenMouse[i.id]&&o.unsubscribe(e.tokenMouse[i.id]),e.tooltip&&(e.tooltip.hide(),e.tooltip.tooltipInfos=void 0,t.tooltipInfos=void 0)}))},endExecute:function(){var e=this;e.tokenAddToPSO&&i._modelEvents.unsubscribe(e.tokenAddToPSO),e.tokenRemoveFromPSO&&i._modelEvents.unsubscribe(e.tokenRemoveFromPSO),e.tokenMouse&&e.tokenMouse.forEach((function(e){o.unsubscribe(e)})),e.tooltip&&(e.tooltip.hide(),e.tooltip.tooltipInfos=void 0)}})})),define("DS/GEOMSCommands/GEOMSMineSchedViewCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/Core/Core"],(function(e,t,n){"use strict";var i=void 0,o=void 0;return t.extend({init:function(e){this._parent(e,{mode:"shared",isAsynchronous:!1})},beginExecute:function(){this._frmWindow=this.getFrameWindow(),void 0!==this.getArguments().find((function(e){return"CommandArg"===e.ID}))&&void 0!==this.getArguments().find((function(e){return"CommandArg"===e.ID})).Value&&(i=this.getArguments().find((function(e){return"CommandArg"===e.ID})).Value),void 0!==this.getArguments().find((function(e){return"ValueArg"===e.ID}))&&void 0!==this.getArguments().find((function(e){return"ValueArg"===e.ID})).Value&&(o=this.getArguments().find((function(e){return"ValueArg"===e.ID})).Value)},execute:function(){var e=function(e){e.msaResult3d.setting(o,i),e.msaResult3d.applyPeriod()};if("undefined"!=typeof xCity&&xCity){var t=xCity.get3DRootNode(),n=function(e){return e.parents.length?n(e.parents[0]):e};n(t).getChildrenByName("Result3dNode").forEach((function(t){e(t)}))}else{var r=this.getFrameWindow().getRootNode().getChildByName("scene").getChildByName("Result3dNode");e(r)}("undefined"!=typeof xCity&&xCity?xCity.renderScene:this.getFrameWindow().getViewer().render)()}})}));