define("DS/ChangeMaturityWidget/ChangeMaturityWidget",["DS/UIKIT/Input/Text","UWA/Controls/Abstract","UWA/Json","DS/UIKIT/Dropdown","DS/UIKIT/Tooltip","DS/WidgetServices/WidgetServices","DS/DataDragAndDrop/DataDragAndDrop","UWA/Class/Promise","DS/LifecycleServices/LifecycleServicesSettings","DS/WAFData/WAFData","DS/LifecycleServices/LifecycleServices","DS/UIKIT/Iconbar","DS/UIKIT/Spinner","DS/UIKIT/Mask","DS/LifecycleCmd/MaturityCmd","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls","DS/LifecycleServices/LifecycleAlert","DS/LifecycleCmd/MessageMediator","DS/ENOCollabToolsUI/tracker/ENOCollabTracker","DS/ENOCollabToolsUI/tracker/ENOCollabTrackerBackEnd","DS/ChangeMaturityWidget/ChangeMaturityWidgetSingleton","UWA/Utils/InterCom"],(function(t,e,s,i,o,r,n,a,c,h,l,u,p,d,m,y,v,g,b,f,x,C){"use strict";const S=36e5;return e.extend({context:null,init:function(t,e,s,i,o){this.widget=t,this.widget.ChangeMaturityWidget=this,this.parentWidget=e;var r=this;void 0!==s.serviceurl&&s.serviceurl?this.serviceurl=s.serviceurl:this.serviceurl=null,void 0!==s.SecurityContext&&s.SecurityContext?this.securityContext=s.SecurityContext:this.securityContext=null,void 0!==s.EnableApproval&&s.EnableApproval?this.EnableApproval=s.EnableApproval:this.EnableApproval=!1,this.pid=i,this.onDone=o,this._parent(s),this.addEvent("onError",(function(t){this.displayError(t)}),this),this.addEvent("onStateChanged",(function(t){var e={created:[],deleted:[],modified:[]};e.context=r,t.data.forEach((function(t){var s={physicalid:t.physicalid,operation:"Promote",state:t.tostate,policy:r.policy};e.modified.push(s)})),g.dispatchEvent("onModification",e)})),this.container=UWA.createElement("div",{class:"container"}),this.elements={},this.elements.container=this.container,this.wrapper=UWA.createElement("div",{class:"wrapper"}),this.wrapper.inject(this.container),this.spinner=(new p).inject(this.wrapper).show(),c.app_initialization((function(){r.tenant=c.getTenant(),console.log(r.tenant);var t=c.getOption("platform_services",null);null!=t&&t.length>0&&l.getSecurityContextPromise(r.tenant).then((function(t){null==r.securityContext&&(r.securityContext=t),r.executeCmd(r.onDone)}))}))},executeCmd:function(t){var e={data:[{physicalid:this.pid}]};this.addEvent("onComplete",(function(){t()})),this._getMaturityState(e,null,null,this.securityContext,!1)},setStateUI:function(t){this.objects={};var e=this;if(0==t.data.policies.length){console.log("ERROR: No policies in json");var s={errorMsg:"Error: No policies in json",type:"error"};e.dispatchEvent("onError",s)}else{this.policies=t.data.policies;for(var i=!1,r=0;r<t.data.objects.length;r++){var n=t.data.objects[r].physicalid;this.phyid=t.data.objects[r].physicalid;var a=t.data.objects[r];if(this.policy=a.policy,this.objects[n]=a,this.objects[n].signatures={},this.objects[n].manuallyCreatedRoutes={},this.objects[n].applyTransition=!0,this.currentState=this.objects[n].currentStateUserName,this.current=this.objects[n].current,void 0!==this.objects[n].isSingleIRPCAssembly&&null!==this.objects[n].isSingleIRPCAssembly&&this.objects[n].hasOwnProperty("isSingleIRPCAssembly")&&(i=i||this.objects[n].isSingleIRPCAssembly),this.objects[n].hasOwnProperty("imageUrl")&&void 0!==this.objects[n].imageUrl&&null!==this.objects[n].imageUrl){var h=this.objects[n].imageUrl;h.startsWith("/")&&(this.objects[n].imageUrl=c.get3DSpaceBaseUrl(window.widget.getValue("x3dPlatformId"))+h)}if(this.objects[n].excludeFromPromote=null!=a.isAggregateRep&&a.isAggregateRep,this.objects[n].excludeFromPromote||null!=a.usage&&"3DPart"==a.usage&&null!=a.isOnceInstantiable&&a.isOnceInstantiable&&(this.objects[n].excludeFromPromote=!0),!0!==this.objects[n].excludeFromPromote){var l=0;for(l=0;l<this.policies.length&&this.policies[l].name!==a.policy;l++);var v=this.policies[l].maturityGraph.transitions,g=this.policies[l].maturityGraph.states;this.correctstates={},this.pos={},this.items=[],this.previousstates=[],this.targetstates=[],this.actions={},this.currentsysstatename="",this.activecolor={},this.inactivecolor={},this.tooltipstate={};for(var b=0;b<g.length;b++)!0===g[b].isCurrent&&(this.setAttribute(n,"current",g[b].stateSysName),this.currentsysstatename=g[b].stateSysName),this.activecolor[g[b].stateSysName]={},this.activecolor[g[b].stateSysName]=g[b].activeColor,this.inactivecolor[g[b].stateSysName]={},this.inactivecolor[g[b].stateSysName]=g[b].inactiveColor,this.tooltipstate[g[b].stateSysName]={},this.tooltipstate[g[b].stateSysName]=g[b].tooltip,this.correctstates[g[b].stateSysName]=g[b].stateUserName,this.pos[g[b].stateSysName]=g[b].visuorder,this.pos[g[b].visuorder]=g[b].stateSysName,this.objects[n].signatures[g[b].stateSysName]={},this.objects[n].manuallyCreatedRoutes[g[b].stateSysName]={},this.actions[g[b].stateSysName]={};for(var f=0;f<v.length;f++){var S=v[f].sourceState,j=v[f].targetState,w=v[f].signatures;this.objects[n].manuallyCreatedRoutes[S][j]=v[f].hasRoute;var E={};if(0===w.length||w[0].username.includes("emxFramework")&&void 0===w[0].name){var A=y.setTo+' "'+this.correctstates[j]+'"';this.actions[S][j]=A,this.actions[S][A]=j;var D=y.setTo+' "'+this.correctstates[S]+'"';this.actions[j][S]=D,this.actions[j][D]=S}else for(var I=0;I<w.length;I++)E[w[I].name]=w[I],w[I].username.includes("emxFramework")||void 0===w[I].username?(this.actions[S][j]=w[I].name,this.actions[S][w[I].name]=j):(this.actions[S][j]=w[I].username,this.actions[S][w[I].username]=j);this.objects[n].signatures[S][j]=E,S===this.current&&(this.pos[this.current]<this.pos[j]?this.targetstates.push(j):this.previousstates.push(j))}if(0===this.previousstates.length&0!=this.pos[this.current]){var U=this.pos[this.current]-1;this.previousstates.push(this.pos[U])}this.nextaction=void 0;for(I=0;I<this.targetstates.length;I++){if(void 0!==(R=this.actions[this.current][this.targetstates[I]])){this.setFontIconColor(this.targetstates[I]),this.fonticon="double-chevron-right"+this.fonticon;var k="";if(this.objects[n].hasOwnProperty("routes")&&this.objects[n].routes&&Array.isArray(this.objects[n].routes)&&this.objects[n].routes.length>0&&this.objects[n].routes[0]){var M="",N=!1;"Block"===(M=this.objects[n].routes[0].hasOwnProperty("routestatuses")&&Array.isArray(this.objects[n].routes[0].routestatuses)&&this.objects[n].routes[0].routestatuses.length>0?this.objects[n].routes[0].routestatuses[0].status:this.objects[n].routes[0].status)?(this.fonticon="route-start wux-ui-3ds-route  &#xE510; ",k=y.routeBlockingSingleLine,N=!0):"BlockedByRequiredRouteRule"===M?N=!0:"RouteCreated"===M?(N=!1,this.fonticon="route-start  wux-ui-3ds-route-start &#xE511; "):N=!1}this.items.push({id:this.targetstates[I],fonticon:this.fonticon,text:R,selectable:!0,title:k,isBlockedByRoute:N}),(void 0===this.nextaction||this.pos[this.actions[this.current][R]]<this.pos[this.actions[this.current][this.nextaction]])&&(this.target=this.targetstates[I],this.nextaction=R)}}for(I=0;I<this.previousstates.length;I++){var R;if(void 0!==(R=this.actions[this.current][this.previousstates[I]])){this.setFontIconColor(this.previousstates[I]),this.fonticon="double-chevron-left"+this.fonticon;var W=!0;for(f=0;f<v.length;f++){S=v[f].sourceState,j=v[f].targetState;if(S===this.current&&j===this.previousstates[I]){W=!1;break}}this.items.push({id:this.previousstates[I],fonticon:this.fonticon,text:R,selectable:!0,demote:W})}}this.items.push({fonticon:"collaborative-lifecycle-management",text:y.maturity,selectable:!0}),e.setColor(),this.activecolor[this.current].includes("emxFramework")?this.color="#757575":this.color=this.activecolor[this.current],this.content=UWA.createElement("div",{class:"lcm-change-maturity-content"}),this.content.inject(this.wrapper),this.s=UWA.createElement("div",{class:"lcm-state-base1 lcm-state-current1 lcm-state-m1",styles:{backgroundColor:this.color}}),this.text=UWA.createElement("span",{class:"lcm-state-text",html:this.currentState}),"#FFFFFF"==this.color&&(this.s.style.border="1px solid #B4B6BA",this.text.style.color="black"),this.text.inject(this.s),this.s.inject(this.content),this.tooltipstate[this.current].includes("emxFramework")?this.tooltiptext=this.currentState:this.tooltiptext=this.tooltipstate[this.current],this.tooltip=new o({position:"bottom right",target:this.s,body:this.tooltiptext}),void 0!==this.nextaction&&(this.next=UWA.createElement("div",{class:"button next-state-button"}),this.text2=UWA.createElement("span",{class:"lcm-state-text",html:this.nextaction}),this.text2.inject(this.next),this.next.inject(this.content),this.tooltip=new o({position:"bottom right",target:this.next,body:this.nextaction}),this.next.hidden=!0),this.iconDropDown=new u({items:[{fonticon:"down-open",text:y.moreOptions,content:{type:"dropdownmenu",options:{items:this.items,events:{onClick:function(t,s){console.log(s),console.log(s.text);document.getElementsByClassName("lcm-state-text");if(s.isBlockedByRoute){var i="",o="",r="";if(e.objects[n].hasOwnProperty("routes")&&Array.isArray(e.objects[n].routes)&&e.objects[n].routes.length>0&&e.objects[n].routes[0].hasOwnProperty("routestatuses")&&Array.isArray(e.objects[n].routes[0].routestatuses)&&e.objects[n].routes[0].routestatuses.length>0?(i=e.objects[n].routes[0].routestatuses[0].status,o=e.objects[n].routes[0].routestatuses[0].message,r=e.objects[n].routes[0].routestatuses[0].routeId):e.objects[n].hasOwnProperty("routes")&&Array.isArray(e.objects[n].routes)&&e.objects[n].routes.length>0&&(i=e.objects[n].routes[0].status,o=e.objects[n].routes[0].message,r=e.objects[n].routes[0].routeId),"Block"===i){var a=[];a.push({envId:e.tenant,serviceId:"3DSpace",contextId:e.securityContext,objectId:r,objectType:"Route",path:[{resourceid:r,type:"Route"}]});var c={items:a},h={protocol:"3DXContent",version:"2.0",source:"ENOLCMI_AP",widgetId:widget.id,data:c},l=new C.Socket("compassPageSocket");l.subscribeServer("com.ds.compass",window.parent),l.dispatchEvent("onSetX3DContent",h,"compassPageSocket");l.dispatchEvent("onLaunchApp",{appId:"ENXROUT_AP"},"compassPageSocket")}else if("BlockedByRequiredRouteRule"===i){var u=o;e.displayError(u,"error")}}else if(s.text===y.maturity){d.mask(e.wrapper);var v={};v.context={context:e.securityContext,securityContext:{SecurityContext:e.securityContext,tenant:e.tenant},getSecurityContext:function(){return this.securityContext}};var g=new m(v),b=[{physicalid:e.pid,serviceurl:e.serviceurl}];g.executeAsync(b).then((function(){var t=(new p).inject(e.wrapper).show();e.wrapper.getElement(" > .lcm-change-maturity-content").destroy(),e.executeCmd(),t.destroy(),console.log("Maturity  updated"),d.unmask(e.wrapper)}))}else{var f=e.actions[e.current][s.text];if(s.demote&&e.pos[f]<e.pos[e.current])var x="demote";else x="promote";d.mask(e.wrapper),console.log(f);var S=e.current;b={data:[{physicalid:e.pid,tostate:f,fromstate:S}]};e._changeMaturity(x,b,e.securityContext)}}}}}}]}),this.iconbarContainer=UWA.createElement("div",{class:"button next-state-button1"}),this.iconDropDown.inject(this.iconbarContainer),this.iconbarContainer.inject(this.content),this.iconbarContainer.hidden=!0,null!=this.spinner.elements&&this.spinner.destroy(),this.next.addEventListener("click",(function(){d.mask(e.wrapper);var t={data:[{physicalid:e.pid,tostate:e.target,fromstate:e.current}]};e._changeMaturity("promote",t,e.securityContext)}));a.policy}}if(x.trackInit(t.data.objects),this.isSingleIRPCAssembly=i,e.EnableApproval){require(["DS/RouteWebAppUX/RouteApprovalsIDCardUX"],(function(t){let s={};s.id=e.pid;t.init(e.content,s,(function(){void 0!==e.nextaction&&(e.next.hidden=!1,e.iconbarContainer.hidden=!1)}))}),(function(){e.next.hidden=!1,e.iconbarContainer.hidden=!1}))}else e.next.hidden=!1,e.iconbarContainer.hidden=!1}},_changeMaturity:function(t,e,s){var i,o=this,r="null";if(void 0!==this.serviceurl&&this.serviceurl){var n=this.serviceurl+t;i=n+(n.indexOf("?")<0?"?":"&")+"tenant="+o.tenant}else i=c.get3DSpaceWSUrl(o.tenant,"/resources/lifecycle/maturity/"+t,null);var a=c.getHeaders(encodeURIComponent(s));return a["X-Requested-With"]="XMLHttpRequest",f.enrichRequestWithMetrics(e,{UXName:"Maturity",UXSub:"Compact"}),console.log(t+":"),console.log(e),h.authenticatedRequest(i,{method:"POST",type:"json",headers:a,timeout:S,data:JSON.stringify(e),onComplete:function(e){console.log(t+": COMPLETED"),console.log(e),r=e;for(var s=e.results,i={data:[]},n=0;n<s.length;n++){var a=o.getAttribute(s[n].physicalid,"current");void 0===a&&(a=s[n].current);var c=s[n].current;o.current=s[n].current,o.updateUI(c),o.setAttribute(s[n].physicalid,"current",s[n].current);var h={physicalid:s[n].physicalid,tostate:c,fromstate:a};i.data.push(h),o._showNotification("success",y.maturitySuccess)}var l={};if("failure"===e.status){var u=e.report,p=u.length,d=[];console.log(u);for(n=0;n<p&&n<10;n++)o.objects[u[n].physicalids]&&o.objects[u[n].physicalids].displayName&&!u[n].error.contains(o.objects[u[n].physicalids].displayName)?d.push(o.objects[u[n].physicalids].displayName+": "+u[n].error):d.push(u[n].error);p>10&&d.push(y.replace(y.maturityAdditionalErrorMessage,{maxErrors:10..toString(),lineBreak:"\n",numErrors:(p-10).toString()})),l.title=y.maturityFailure,l.errorMsg=d,l.type="error",o.dispatchEvent("onError",l),i.data.length>0&&o.dispatchEvent("onStateChanged",i)}else i.data.length>0&&o.dispatchEvent("onStateChanged",i);o.dispatchEvent("onComplete")},onFailure:function(e,s){console.log(t+":Failure..."+e);var i={};i.errorMsg=l.parseWebServiceError(e,s),i.type="error",o.dispatchEvent("onError",i),o.dispatchEvent("onComplete")},onTimeout:function(){console.log(t+": A connection timeout occured.");var e={errorMsg:"connection timeout",type:"warning"};o.dispatchEvent("onError",e),o.dispatchEvent("onComplete")}}),r},getAttribute:function(t,e){return void 0!==this.objects[t]?this.objects[t][e]:void 0},setColor:function(){this.color={},this.color=this.activecolor[this.currentState],this.tooltiptext=this.tooltipstate[this.currentState]},setFontIconColor:function(t){this.fonticon={};var e=this.activecolor[t].replace("#","ZZ");this.fonticon=" "+e},displayError:function(t,e){var s=t;t.hasOwnProperty("errorMsg")&&(s=null!==t.errorMsg?t.errorMsg:t);var i="",o="";t.hasOwnProperty("title")&&(i=t.title),t.hasOwnProperty("subtitle")&&(o=t.subtitle),void 0===e&&t.hasOwnProperty("type")?e=t.type:void 0===e&&(e="warning"),this._showNotification(e,s,i,o),d.unmask(this.wrapper)},updateUI:function(t){var e=this;this.targetstates=[],this.previousstates=[];e.getAttributes(e.phyid);var s=0;for(s=0;s<e.policies.length&&e.policies[s].name!==e.objects[e.phyid].policy;s++);var i=e.policies[s].maturityGraph.transitions;this.policies[s].maturityGraph.states;e.currentState=e.correctstates[t];for(var r=0;r<i.length;r++){var n=i[r].sourceState,a=i[r].targetState;n===t&&(this.pos[t]<this.pos[a]?this.targetstates.push(a):this.previousstates.push(a))}if(0===this.previousstates.length&0!=this.pos[t]){var c=this.pos[t]-1;this.previousstates.push(this.pos[c])}this.nextaction=void 0,this.items=[];for(var h=0;h<this.targetstates.length;h++){void 0!==(l=this.actions[this.current][this.targetstates[h]])&&(this.setFontIconColor(this.targetstates[h]),this.fonticon="double-chevron-right"+this.fonticon,this.items.push({fonticon:this.fonticon,text:l,selectable:!0}),(void 0===this.nextaction||this.pos[this.actions[this.current][l]]<this.pos[this.actions[this.current][this.nextaction]])&&(this.target=this.targetstates[h],this.nextaction=l))}for(h=0;h<this.previousstates.length;h++){var l;void 0!==(l=this.actions[this.current][this.previousstates[h]])&&(this.setFontIconColor(this.previousstates[h]),this.fonticon="double-chevron-left"+this.fonticon,this.items.push({fonticon:this.fonticon,text:l,selectable:!0}))}this.items.push({fonticon:"collaborative-lifecycle-management",text:y.maturity,selectable:!0}),e.setColor(),this.activecolor[t].includes("emxFramework")?this.color="#757575":this.color=this.activecolor[t];var p=document.getElementsByClassName("lcm-state-text");if(this.s.setStyle("backgroundColor",this.color),"#FFFFFF"==this.color?(this.s.style.border="1px solid #B4B6BA",this.text.style.color="black"):(this.s.style.border="",this.text.style.color="white"),p[0].innerHTML=e.currentState,void 0!==this.nextaction?(p[1].hidden=!1,p[1].innerHTML=e.nextaction):p[1].hidden=!0,this.iconDropDown.destroy(),this.iconbarContainer.destroy(),this.tooltip.destroy(),this.tooltipstate[t].includes("emxFramework")?this.tooltiptext=t:this.tooltiptext=this.tooltipstate[t],this.tooltip=new o({position:"bottom right",target:this.s,body:this.tooltiptext}),this.iconDropDown=new u({items:[{fonticon:"down-open",text:"more options",content:{type:"dropdownmenu",options:{items:this.items,events:{onClick:function(t,s){console.log(s),console.log(s.text);document.getElementsByClassName("lcm-state-text");if(s.text===y.maturity){d.mask(e.wrapper);var i={};i.context={context:e.securityContext,securityContext:{SecurityContext:e.securityContext,tenant:e.tenant},getSecurityContext:function(){return this.securityContext}};var o=new m(i),r=[{physicalid:e.pid,serviceurl:e.serviceurl}];o.executeAsync(r).then((function(){e.wrapper.getElement(" > .lcm-change-maturity-content").destroy(),e.executeCmd(),console.log("Maturity  updated"),d.unmask(e.wrapper)}))}else{var n=e.actions[e.current][s.text];if(e.pos[n]<e.pos[e.current])var a="demote";else a="promote";d.mask(e.wrapper),console.log(n);var c=e.current;r={data:[{physicalid:e.pid,tostate:n,fromstate:c}]};e._changeMaturity(a,r,e.securityContext)}}}}}}]}),this.iconbarContainer=UWA.createElement("div",{class:"button next-state-button1"}),this.iconDropDown.inject(this.iconbarContainer),this.iconbarContainer.inject(this.content),this.next.hidden=!0,this.iconbarContainer.hidden=!0,d.unmask(this.wrapper),e.EnableApproval){require(["DS/RouteWebAppUX/RouteApprovalsIDCardUX"],(function(t){let s={};s.id=e.pid;t.init(e.content,s,(function(){void 0!==e.nextaction&&(e.next.hidden=!1,e.iconbarContainer.hidden=!1)}))}),(function(){e.next.hidden=!1,e.iconbarContainer.hidden=!1}))}else e.next.hidden=!1,e.iconbarContainer.hidden=!1},getAttributes:function(t){return this.objects[t]},_showNotification:function(t,e,s="",i=""){var o=this;Array.isArray(e)||"string"!=typeof e||(e=[e]),Array.isArray(e)&&e.length&&e.forEach((function(e){var r={eventID:t,msg:e.split?e.split("\n").join("<br>"):e,title:s,subtitle:i,hasHtml:!0};null!=o.context&&"function"==typeof o.context.displayNotification?o.context.displayNotification(r):v.displayNotification(r)}))},setAttributes:function(t,e){this.objects[t]=e},setAttribute:function(t,e,s){void 0!==this.objects[t]&&(this.objects[t][e]=s)},_getMaturityState:function(t,e,s,i,o){var r,n=this,a=c.getHeaders(encodeURIComponent(i));if(a["X-Requested-With"]="XMLHttpRequest",void 0!==this.serviceurl&&this.serviceurl){var l=this.serviceurl+"getStateGraph";r=l+(l.indexOf("?")<0?"?":"&")+"tenant="+n.tenant}else r=c.get3DSpaceWSUrl(n.tenant,"/resources/lifecycle/maturity/getStateGraph",null);f.enrichRequestWithMetrics(t,{UXName:"Maturity",UXSub:"Compact"}),h.authenticatedRequest(r,{method:"POST",type:"json",headers:a,timeout:S,data:JSON.stringify(t),onComplete:function(t){console.log("MaturityInfos: COMPLETED"),console.log(t);var e=t.status,s=e.code;e.hasOwnProperty("errorMsg")&&(null!==e.errorMsg?errCb(e.errorMsg):0===s&&(console.log(t),n.setStateUI(t)))},onFailure:function(t,e){console.log("attributes:Failure..."+t)},onTimeout:function(){var t={errorMsg:"timeout",type:"warning"};console.log(t)}})}})})),define("DS/ChangeMaturityWidget/ChangeMaturityWidgetSingleton",["UWA/Class","DS/ENOCollabToolsUI/tracker/ENOCollabTracker"],(function(t,e){return t.singleton({trackInit:function(t){var s={UXName:"Maturity",UXSub:"Compact",models:t};this.trackerEvent=e.createInitActionEvent(s,this.trackerEvent),e.checkAndTrackPageEvent(this.trackerEvent)}})}));