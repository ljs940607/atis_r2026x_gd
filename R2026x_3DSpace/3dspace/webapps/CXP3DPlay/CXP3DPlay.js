define("DS/CXP3DPlay/expCoreLink/MediaDSXMStreamSolver",["UWA/Core","DS/ZipJS2/ZipJS2","DS/CAT3DExpModel/XCTExpUint8ArrayAsset"],(function(e,t,r){"use strict";return{mediaZipEntriesMap:[],getStreamFromMedia:async function(e,t){const i=this._getOrCreateMediaZipEntriesObject(t);i.useCount++,await this._importBlob(i);const n=i.zipEntries.find(e);let a=this._getMimeType(e);const o=await n.getUint8Array(a),s=new r(e,o,a);return this._decreaseMediaZipEntriesUseCount(i),s},_importBlob:async function(e){if(!e.isBlobImported){if(e.importBlobPromise)return e.importBlobPromise;e.importBlobPromise=e.zipEntries.importBlob(e.media),await e.importBlobPromise,delete e.importBlobPromise,e.isBlobImported=!0}},_getOrCreateMediaZipEntriesObject:function(e){const r=this.mediaZipEntriesMap.map((e=>e.media)).indexOf(e);if(r>=0)return this.mediaZipEntriesMap[r];const i={media:e,zipEntries:new t.fs.FS,useCount:0};return this.mediaZipEntriesMap[r]=i,i},_decreaseMediaZipEntriesUseCount:function(e){if(e.useCount--,0===e.useCount){const t=this.mediaZipEntriesMap.map((e=>e.media)).indexOf(e.media);this.mediaZipEntriesMap.splice(t,1)}},_getMimeType:function(e){for(let t in this._extensionMimeTypeMap)if(e.contains(t))return this._extensionMimeTypeMap[t]},_extensionMimeTypeMap:{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",bmp:"image/bmp",tif:"image/tiff",tiff:"image/tiff",svg:"image/svg+xml",cgm:"image/cgm",gif:"image/gif",rgb:"image/x-rgb",wav:"audio/x-wav",ogg:"audio/ogg"}}})),define("DS/CXP3DPlay/XCTEWS3DPlayProbesTraces",["require","exports","DS/WebUtils/ProbesManager"],(function(e,t,r){"use strict";return function(){function e(){}return e.prototype.begin=function(e,t){this._trace=r.begin(e)},e.prototype.end=function(e,t){this._trace.end()},e}()})),define("DS/CXP3DPlay/expCoreLink/ExpCoreLinkContextMediaStream",["UWA/Core","DS/CAT3DExpModel/expCoreLink/ExpCoreLinkContextStream"],(function(e,t){"use strict";return t.extend({_getParentLinkContext:function(){return null},_getParentService:function(){return this._createExpCoreLinkService("ExpCoreLinkServiceMediaStream")}})})),define("DS/CXP3DPlay/interfaces/XCTEWSIPlayerOptionsMgr",["UWA/Class","DS/WebComponentModeler/CATWebInterface"],(function(e,t){"use strict";return t.singleton({interfaceName:"XCTEWSIPlayerOptionsMgr",required:{setPlayerOptions:function(){}},optional:{}})})),define("DS/CXP3DPlay/expCoreLink/ExpCoreLinkContextMedia",["UWA/Core","DS/CAT3DExpModel/expCoreLink/ExpCoreLinkContext"],(function(e,t){"use strict";return t.extend({init:function(e,t){this._media=e,this._parent(e,t)},_getContent:function(){return this._media},_getService:function(e){if("Streams"===e)return this._createExpCoreLinkService("ExpCoreLinkServiceMediaStream")},_getParentLinkContext:function(){return null},_getParentService:function(){return null}})})),define("DS/CXP3DPlay/expCoreLink/MediaPlatformStreamSolver",["UWA/Core","DS/WAFData/WAFData","DS/CAT3DExpModel/XCTExpUint8ArrayAsset"],(function(e,t,r){"use strict";return{getStreamFromMedia:async function(e,t){const i=await this._retrieveStreamInfo(e,t),n=await this._retrieveStream(i);let a=this._getMimeType(e);const o=new Uint8Array(n);return new r(e,o,a)},_retrieveStreamInfo:async function(r,i){const n=e.Promise.deferred(),a=i.serverurl+"/resources/experience/medias/"+i.physicalid+"/streams/"+r;return t.authenticatedRequest(a,{cache:-1,method:"GET",type:"json",headers:{"Content-Type":"application/json",SecurityContext:i.contextid},onComplete:e=>{e&&e.results&&e.results[0]&&n.resolve(e.results[0]),n.reject("Cant retrieve stream "+r)},onFailure:e=>{n.reject(new Error(e))}}),n.promise},_retrieveStream:async function(r){const i=e.Promise.deferred();return t.authenticatedRequest(r.fcsurl,{timeout:1e5,method:"POST",data:"__fcs__jobTicket="+encodeURIComponent(r.ticket),type:"arraybuffer",proxy:"passport",headers:{Accept:"text/plain"},onComplete:e=>{i.resolve(e)},onFailure:e=>{i.reject(new Error(e))}}),i.promise},_getMimeType:function(e){for(let t in this._extensionMimeTypeMap)if(e.contains(t))return this._extensionMimeTypeMap[t]},_extensionMimeTypeMap:{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",bmp:"image/bmp",tif:"image/tiff",tiff:"image/tiff",svg:"image/svg+xml",cgm:"image/cgm",gif:"image/gif",rgb:"image/x-rgb",wav:"audio/x-wav",ogg:"audio/ogg"}}})),define("DS/CXP3DPlay/CXP3DPlayApp",["UWA/Core","UWA/Class","DS/CAT3DExpModel/XCTEWSTracesHelper","DS/CXP3DPlay/XCTEWS3DPlayProbesTraces"],(function(e,t,r,i){"use strict";return t.extend({init:function(e,t){r.addSpecialTraces("3DPlayProbes",i),e.onModelLoadingProgression&&e.onModelLoadingProgression({loaded:70,total:100});var n=this;return this._readMedia(e,t).then((function(e){n._xctEWSPlayMedia=e})).catch((function(e){console.error(e)}))},_readMedia:function(){return e.Promise.reject(new Error("CXP3DPlayApp._initializeXCTEWSPlayMedia: Must be implemented by derived class"))},disposeExperienceBase:function(){if(this._xctEWSPlayMedia){var t=this;return this._xctEWSPlayMedia.dispose().then((function(){delete t._xctEWSPlayMedia}))}return e.Promise.resolve()}})})),define("DS/CXP3DPlay/XCTEWSPlayMedia",["UWA/Core","UWA/Class","DS/CAT3DExpModel/XCTEWSObjectModeler","DS/XCTWebExperienceAppPlay/CAT3DXModelFactoryPlay","DS/CAT3DExpModel/CAT3DXModel","DS/CXP3DPlay/expCoreLink/ExpCoreLinkContextMedia","DS/CXP3DPlay/expCoreLink/ExpCoreLinkContextMediaStream","DS/CAT3DExpModel/XCTEWSTracesHelper"],(function(e,t,r,i,n,a,o,s){"use strict";let p;const c=e.Class.extend({readMedia:async function(t,a,o){this._experienceBase=a;const c=s.createTrace("EWS_LoadDSXM"),d=s.createTrace("EWS_InitializeEWS"),C=(await this._retrieveContentJSON(t)).getText(),l=JSON.parse(C),u=l.Runtime,x=l.Experience,S=l.PlayerOptions?l.PlayerOptions:{};o=e.extend(S,o);const m=await this._require(["text!"+u.Prototypes,"text!"+u.Interfaces,"text!"+u.Components,"text!"+u.Managers]),f=JSON.parse(m[0]),M=JSON.parse(m[1]),P=JSON.parse(m[2]),E=JSON.parse(m[3]);p=Object.keys(E);const g=new i({expObjectsFilter:["CXPNaturalLanguageInfo_Spec"],prototypes:f});this._ews=new r,await this._ews.initialize({experienceBase:a,factory:g,interfacesTable:M,componentsTable:P,managersTable:E}),d.end(!0),this._addExpCoreLinkMedia(t);for(let e=0;e<p.length;e++){let t=a.getManager(p[e]).QueryInterface("XCTEWSIPlayerOptionsMgr");t&&t.setPlayerOptions(o)}const D=s.createTrace("EWS_LoadExperience");this._experience=await n.LoadExperience(x);const y=[];for(let e=0;e<p.length;e++){let t=a.getManager(p[e]).QueryInterface("XCTEWSIExperienceMgr");t&&y.push(t.onExperienceReady(this._experience))}const _=await e.Promise.allSettled(y);for(let e=0;e<_.length;e++)"rejected"===_[e].state&&console.error(_[e].reason);return D.end(!0),c.end(!0),this._experience},_addExpCoreLinkMedia:function(e){var t=n._getExpCoreLinkManager();t._addExpCoreLinkContext("ExpCoreLinkContextMedia",a),t._addExpCoreLinkContext("ExpCoreLinkContextMediaStream",o),t._addExpCoreLinkContextShortcut("localMedia","ExpCoreLinkContextMedia",e)},_require:async function(t){var r=e.Promise.deferred();return require(t,(function(){r.resolve(arguments)}),(function(e){r.reject(e)})),r.promise},dispose:function(){var t=n._getExpCoreLinkManager();t._removeExpCoreLinkContext("ExpCoreLinkContextMedia"),t._removeExpCoreLinkContext("ExpCoreLinkContextMediaStream"),t._removeExpCoreLinkContextShortcut("localMedia");let r=[];for(let e=0;e<p.length;e++){let t=this._experienceBase.getManager(p[e]).QueryInterface("XCTEWSIExperienceMgr");t&&r.push(t.onPreDisposeExperience(this._experience))}return e.Promise.allSettled(r).then((e=>{for(let t=0;t<e.length;t++)"rejected"===e[t].state&&console.error(e[t].reason);return n.CloseExperience()})).then((()=>this._ews.dispose())).then((()=>{p=[],delete this._experienceBase,delete this._experience})).catch((t=>(console.error(t),e.Promise.reject(t))))}});return c})),define("DS/CXP3DPlay/expCoreLink/ExpCoreLinkServiceMediaPlatformStream",["UWA/Core","UWA/Class","DS/CAT3DExpModel/expCoreLink/ExpCoreLinkService","DS/CXP3DPlay/expCoreLink/MediaPlatformStreamSolver"],(function(e,t,r,i){"use strict";return r.extend({_getChildLinkContextFromIdentifier:function(e,t){var r=this;return i.getStreamFromMedia(t,e._getContent()).then((function(e){return r._createExpCoreLinkContext("ExpCoreLinkContextMediaStream",e)}))}})})),define("DS/CXP3DPlay/expCoreLink/ExpCoreLinkServiceMediaDSXMStream",["UWA/Core","UWA/Class","DS/CAT3DExpModel/expCoreLink/ExpCoreLinkService","DS/CXP3DPlay/expCoreLink/MediaDSXMStreamSolver"],(function(e,t,r,i){"use strict";return r.extend({_getChildLinkContextFromIdentifier:function(e,t){var r=this;return i.getStreamFromMedia(t,e._getContent()).then((function(e){return r._createExpCoreLinkContext("ExpCoreLinkContextMediaStream",e)}))}})})),define("DS/CXP3DPlay/XCTEWSPlayMediaPlatform",["UWA/Core","DS/CXP3DPlay/XCTEWSPlayMedia","DS/CAT3DExpModel/CAT3DXModel","DS/CXP3DPlay/expCoreLink/MediaPlatformStreamSolver","DS/CXP3DPlay/expCoreLink/ExpCoreLinkServiceMediaPlatformStream"],(function(e,t,r,i,n){"use strict";return t.extend({_retrieveContentJSON:function(e){return i.getStreamFromMedia("content.json",e)},_addExpCoreLinkMedia:function(e){this._parent(e),r._getExpCoreLinkManager()._addExpCoreLinkService("ExpCoreLinkServiceMediaStream",n)},dispose:function(){return r._getExpCoreLinkManager()._removeExpCoreLinkService("ExpCoreLinkServiceMediaStream"),this._parent()}})})),define("DS/CXP3DPlay/CXP3DPlayAppStream",["UWA/Core","DS/CXP3DPlay/CXP3DPlayApp","DS/CXP3DPlay/XCTEWSPlayMediaPlatform"],(function(e,t,r){"use strict";return t.extend({_readMedia:function(e,t){var i=new r;return i.readMedia(t.asset,e._experienceBase,{playExperience:e,input:t}).then((function(){return i}))}})})),define("DS/CXP3DPlay/XCTEWSPlayMediaDSXM",["UWA/Core","DS/CXP3DPlay/XCTEWSPlayMedia","DS/CAT3DExpModel/CAT3DXModel","DS/CXP3DPlay/expCoreLink/MediaDSXMStreamSolver","DS/CXP3DPlay/expCoreLink/ExpCoreLinkServiceMediaDSXMStream"],(function(e,t,r,i,n){"use strict";return t.extend({_retrieveContentJSON:function(e){return i.getStreamFromMedia("content.json",e)},_addExpCoreLinkMedia:function(e){this._parent(e),r._getExpCoreLinkManager()._addExpCoreLinkService("ExpCoreLinkServiceMediaStream",n)},dispose:function(){return r._getExpCoreLinkManager()._removeExpCoreLinkService("ExpCoreLinkServiceMediaStream"),this._parent()}})})),define("DS/CXP3DPlay/CXP3DPlayAppFile",["UWA/Core","DS/CXP3DPlay/CXP3DPlayApp","DS/CXP3DPlay/XCTEWSPlayMediaDSXM"],(function(e,t,r){"use strict";return t.extend({_readMedia:function(e,t){var i=new r;return i.readMedia(t.blob,e._experienceBase,{playExperience:e,input:t}).then((function(e){var t=window.document.createEvent("CustomEvent");return t.initCustomEvent("ExperienceReady",!0,!1,{experienceLoaded:e,type:"3D"}),window.document.dispatchEvent(t),i}))}})}));