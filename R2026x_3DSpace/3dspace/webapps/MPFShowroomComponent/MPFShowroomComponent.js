define("DS/MPFShowroomComponent/GalleryDeleteModal",["UWA/Class/View","DS/UIKIT/Alert","DS/MPFServices/ObjectService","DS/MPFShowcaseItemModel/ShowcaseItemModel","DS/MPFView/ConfirmationModal","i18n!DS/MPFShowroomComponent/assets/nls/ShowroomComponent"],(function(e,t,s,i,o,n){"use strict";const r=Object.freeze({ON_DELETE:"onDelete"}),a=e.extend({className:"mpf-gallery-delete-modal",setup:function(){this.alert=this._createAlert(),this.modal=this._createModal(this.alert)},render:function(){return this.container.setContent(this.modal.render()),this},show:function(e){return s.requiredOfPrototype(e,i,"argument must be a ShowcaseItemModel"),this.showcaseItem=e,this.modal.show(),this},hide:function(){return this.modal.hide(),this},destroy:function(){this.stopListening(),this.modal.destroy(),this.showcaseItem=null,this._parent(),this.container=null},_delete:function(){var e=this;this.modal.setLoading(!0),this.showcaseItem.destroy({onComplete:function(){e.modal.setLoading(!1),e.hide(),e.dispatchEvent(r.ON_DELETE,{status:"successful"})},onFailure:function(t){e.modal.setLoading(!1),console.log(t),e.alert.add({className:"error",message:n.get("deletionFailed")}).show()}})},_createAlert:function(){return new t({autoHide:!0,visible:!1})},_createModal:function(e){var t=new o({header:n.get("removeContent"),body:[e,n.get("deleteConfirmationMessage")],confirmButtonLabel:n.get("delete")});return this.listenTo(t,o.Events.CONFIRM,this._delete.bind(this)),t}});return a.Events=r,a})),define("DS/MPFShowroomComponent/GalleryItem",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFShowcaseItemModel/ShowcaseItemModel"],(function(e,t,s,i){"use strict";const o=Object.freeze({SHOW_EDIT_MODAL:"showEditModal",SHOW_DELETE_MODAL:"showDeleteModal"}),n=t.extend({className:"col-xs-12 col-sm-4 col-md-3 mpf-gallery-item",setup:function(e){s.requiredOfPrototype(e.showcaseItem,i,"options.showcaseItem must be a ShowcaseItemModel"),this.showcaseItem=e.showcaseItem,this.editable=!0===e.editable},render:function(){var e=[];return e.push(this._createImageContainer()),this.editable&&e.push(this._createButtons()),this.container.setContent(e),this},destroy:function(){this.showcaseItem=null,this._parent(),this.container=null},_createButtons:function(){return e.createElement("div",{class:"mpf-item-edit-buttons",html:[{tag:"span",class:"fonticon fonticon-2x fonticon-pencil",events:{click:this.dispatchEvent.bind(this,o.SHOW_EDIT_MODAL,this.showcaseItem)}},{tag:"span",class:"fonticon fonticon-2x fonticon-trash",events:{click:this.dispatchEvent.bind(this,o.SHOW_DELETE_MODAL,this.showcaseItem)}}]})},_createImageContainer:function(){return e.createElement("div",{class:"mpf-item-image",styles:{"background-image":"url("+this.showcaseItem.getImage()+")"}})}});return n.Events=o,n})),define("DS/MPFShowroomComponent/ShowroomGalleryDescriptionModal",["UWA/Core","UWA/Class/View","DS/UIKIT/Modal","DS/UIKIT/Scroller","DS/MPFShowcaseItemModel/ShowcaseItemModel","DS/MPFServices/ObjectService"],(function(e,t,s,i,o,n){"use strict";return t.extend({className:"mpf-showroom-description-modal",setup:function(){this.modal=this._createModal(this.descriptionContainer)},render:function(){return this.container.setContent(this.modal),this},show:function(e){return n.requiredOfPrototype(e,o,"Function expects ShowcaseItemModel as argument"),this.setModalHeaderText(e.getTitle()),this.setModalBodyText(e.getDescription()),this.modal.show(),this},hide:function(){return this.modal.hide(),this},destroy:function(){this.modal.destroy(),this.modal=null,this._parent(),this.container=null},setModalHeaderText:function(t){this.modal.setHeader(e.createElement("h4",{text:t}))},setModalBodyText:function(t){this.modal.setBody(""),new i({element:e.createElement("div",{text:t})}).inject(this.modal.getBody())},_createModal:function(e){return new s({closable:!0})}})})),define("DS/MPFShowroomComponent/ShowroomShopDescription",["UWA/Core","UWA/String","UWA/Class/View","DS/UIKIT/Input/Button","DS/MPFTooltip/Tooltip","DS/MPFServices/ObjectService","DS/MPFShopModel/ShopServiceModel","i18n!DS/MPFShowroomComponent/assets/nls/ShowroomComponent"],(function(e,t,s,i,o,n,r,a){"use strict";return s.extend({className:"mpf-shop-description",setup(e){n.requiredOfPrototype(e.shopService,r,"options.shopService must be a ShopServiceModel"),this.shopService=e.shopService,this.serviceTerm=e.serviceTerm||a.get("lab"),this.isContextEditable=!0===e.isContextEditable,this.hasSelectButton=!0===e.hasSelectButton,this.selectButtonLabel=e.selectButtonLabel||a.get("getAQuote"),this.onSelectButtonClicked=e.onSelectButtonClicked,this.isSmallView=!0===e.isSmallView,this.listenTo(this.shopService,"onChange:"+r.Fields.BACKGROUND_IMAGE,this.render.bind(this)),this.listenTo(this.shopService,"onChange:"+r.Fields.DESCRIPTION,this.render.bind(this))},render(){return this.image=this.shopService.getBackgroundImage(),this.container.setContent(this.isSmallView?this._createSmallViewContent():this._createUsualViewContent()),this.isSmallView&&(setTimeout((()=>{this._updateOverflowLimit()}),0),window.addEventListener("resize",this._updateOverflowLimit.bind(this))),this},destroy(){this.stopListening(),window.removeEventListener("resize",this._updateOverflowLimit.bind(this)),this.shopService=null,this.image=null,this.isSmallView=null,this._parent(),this.container=null},_createUsualViewContent(){this.image?this.container.setStyle("background-image","url("+this.image+")"):this.container.addClassName("mpf-background-placeholder");const e=[this._createTitle(),this._createDescription()];return!0===this.hasSelectButton&&e.push(this._createSelectButton()),[{tag:"div",class:"mpf-shop-text-container",html:e}]},_createSmallViewContent(){const t=e.createElement("div",{class:"mpf-background-image",html:!0===this.hasSelectButton?this._createSelectButton():""});this.image?t.setStyle("background-image","url("+this.image+")"):t.addClassName("mpf-background-placeholder"),this.description=this._createDescription();return[e.createElement("div",{class:"mpf-overlay",html:{tag:"div",class:"mpf-shop-text-container",html:this.description}}),t]},_createTitle(){const s=e.createElement("div",{class:"mpf-title",html:a.get("aboutUs")});return this.isContextEditable&&(e.createElement("span",{class:"mpf-required",text:"*"}).inject(s),new o({body:t.format(a.get("aboutUsTooltip"),this.serviceTerm)}).inject(s)),s},_createDescription(){const s=e.createElement("div",{class:"mpf-description-container"}),i=this.shopService.getDescription();return e.is(i,"string")&&i.length>0?s.setText(i):s.setContent(e.createElement("span",{text:t.format(a.get("descPlaceHolder"),this.serviceTerm),class:"mpf-description-placeholder"})),s},_createSelectButton(){const s=new i({value:t.ucfirst(this.selectButtonLabel),className:"primary"});return s.addEvent("onClick",(()=>{this.onSelectButtonClicked()})),e.createElement("div",{class:"mpf-button-container",html:s})},_updateOverflowLimit(){this.description.offsetHeight>100&&!this.container.hasClassName("mpf-has-overflow")?this.container.addClassName("mpf-has-overflow"):this.description.offsetHeight<=100&&this.container.hasClassName("mpf-has-overflow")&&this.container.removeClassName("mpf-has-overflow")}})})),define("DS/MPFShowroomComponent/ImageUploadHelper",["UWA/Promise","DS/MPFShopModel/MediaFactory"],(function(e,t){"use strict";return class{static uploadImage(e,s,i){const o=e.createModel(t.Types.MEDIA,null,{parentResourceId:i}),n=new FormData;n.append("file",s);const r={method:"POST"};return r.data=n,o.savePromise(null,r)}static saveFileAndShowcaseItem(t,s,i){return(s.isNew()?s.savePromise():s.hasPendingChanges()?s.savePromise(s.getPendingChanges(),{patch:!0}):e.resolve()).then((function(){if(t.getFile())return i.setParentResourceId(s.get("id")),t.save().then((function(){s.setImage(i.getImage())}))}))}static readImageFile(e){if(e.file){const t=new window.FileReader;t.onload=function(){e.onLoaded(t.result)},t.onerror=e.onError,t.readAsDataURL(e.file)}}}})),define("DS/MPFShowroomComponent/ShowroomShopModal",["UWA/Core","UWA/Class/View","UWA/Promise","UWA/String","DS/UIKIT/Modal","DS/UIKIT/Input/Button","DS/UIKIT/Alert","DS/MPFShopModel/ShopModel","DS/MPFShopModel/ShopServiceModel","DS/MPFShopModel/LogoModel","DS/MPFShopModel/BackgroundModel","DS/MPFServices/ObjectService","DS/MPFView/FieldTextInputV2","DS/MPFView/FieldReplaceImage","i18n!DS/MPFShowroomComponent/assets/nls/ShowroomComponent"],(function(e,t,s,i,o,n,r,a,h,l,c,d,m,p,u){"use strict";return t.extend({className:"mpf-showroom-shop-modal",setup:function(e){d.requiredOfPrototype(e.shop,a,"options.shop must be a ShopModel"),d.requiredOfPrototype(e.shopService,h,"options.shopService must be a ShopServiceModel"),d.requiredOfPrototype(e.logo,l,"options.logo must be a LogoModel"),d.requiredOfPrototype(e.background,c,"options.background must be a BackgroundModel"),this.shop=e.shop,this.shopService=e.shopService,this.logo=e.logo,this.background=e.background,this.serviceTerm=e.serviceTerm||u.get("lab"),this.maxFileSize=e.maxFileSize,this.shopNameEntry=this._createShopNameEntry(),this.shopNameRemainingCharactersContainer=this._createRemainingCharactersContainer(this.shopNameEntry),this.shopLogoEntry=this._createShopLogoEntry(),this.shopBackgroundEntry=this._createShopBackgroundEntry(),this.shopDescriptionEntry=this._createShopDescriptionEntry(),this.shopDescriptionRemainingCharactersContainer=this._createRemainingCharactersContainer(this.shopDescriptionEntry),this.modal=this._createModal(),this.alert=new r({autoHide:!0,visible:!1}),this.listenTo(this.shopNameEntry,m.Events.UPDATE,this._onChange.bind(this)),this.listenTo(this.shopDescriptionEntry,m.Events.UPDATE,this._onChange.bind(this)),this.listenTo(this.shopLogoEntry,m.Events.UPDATE,this._onChange.bind(this)),this.listenTo(this.shopBackgroundEntry,m.Events.UPDATE,this._onChange.bind(this)),this.listenTo(this.shopLogoEntry,"error",this._onFileSelectError.bind(this)),this.listenTo(this.shopBackgroundEntry,"error",this._onFileSelectError.bind(this)),this.listenTo(this.shopNameEntry.input.elements.input,"keyup",this._updateRemainingCharacters.bind(this,this.shopNameRemainingCharactersContainer,this.shopNameEntry)),this.listenTo(this.shopDescriptionEntry.input.elements.input,"keyup",this._updateRemainingCharacters.bind(this,this.shopDescriptionRemainingCharactersContainer,this.shopDescriptionEntry))},render:function(){const t=e.createElement("div",{class:"mpf-image-replace-container",html:[this.shopLogoEntry.render(),this.shopBackgroundEntry.render()]});return this.modal.setBody([this.alert,this.shopNameEntry.render(),t,this.shopDescriptionEntry.render()]),this.shopNameRemainingCharactersContainer.inject(this.shopNameEntry.container.getElement(".mpf-label"),"after"),this.shopDescriptionRemainingCharactersContainer.inject(this.shopDescriptionEntry.container.getElement(".mpf-label"),"after"),this.container.setContent([this.modal]),this},show:function(){return this._storeOldValues(),this.saveButton.disable(),this.modal.show(),this},hide:function(){return this.saveButton.load(!1),this.modal.hide(),this.shopLogoEntry.reset(),this.shopBackgroundEntry.reset(),this},destroy:function(){this.stopListening(),this.shop=null,this.shopService=null,this.logo=null,this.background=null,this._parent(),this.container=null},_onChange:function(){this.hasPendingChanges()&&this._validateValues()?this.saveButton.enable():this.saveButton.disable()},_onCancel:function(){this._restoreOldValues(),this.hide()},_onSave:function(){const e=this.shopNameEntry.validate(),t=this.shopDescriptionEntry.validate();if(e.isValid&&t.isValid){this.saveButton.load();var s=[];this._hasNameChanged()&&s.push(this.shopNameEntry.save()),this._hasDescriptionChanged()&&s.push(this.shopDescriptionEntry.save()),s.push(this.shopLogoEntry.save()),s.push(this.shopBackgroundEntry.save()),Promise.all(s).then((()=>{this._storeOldValues(),this.saveButton.load(!1),this.hide()})).catch((e=>{this.saveButton.load(!1),this.alert.add({className:"error alert-error",message:u.get("modificationSaveFailure")}).show(),console.error(e.response||e.message)}))}},_createRemainingCharactersContainer:function(t){return e.createElement("span",{class:"nb-remaining-characters",text:" ("+i.format(u.get("nbRemainingCharacters"),this._getNumberRemainingCharacters(t).toString())+")"})},_updateRemainingCharacters:function(e,t){e.setText(" ("+i.format(u.get("nbRemainingCharacters"),this._getNumberRemainingCharacters(t).toString())+")")},_getNumberRemainingCharacters:function(e){return e.maxlength-e.getValue().length},_onFileSelectError:function(e){this.alert.add({className:"error",message:e.message}).show()},_validateValues:function(){return this.shopNameEntry.getValue()&&this.shopDescriptionEntry.getValue()},hasPendingChanges:function(){return this._hasNameChanged()||this._hasDescriptionChanged()||this._hasLogoChanged()||this._hasBackgroundChanged()},_hasNameChanged:function(){return this.shop.get(a.Fields.NAME)!==this.oldValues[a.Fields.NAME]},_hasDescriptionChanged:function(){return this.shopService.get(h.Fields.DESCRIPTION)!==this.oldValues[h.Fields.DESCRIPTION]},_hasLogoChanged:function(){return e.is(this.shopLogoEntry.file)},_hasBackgroundChanged:function(){return e.is(this.shopBackgroundEntry.file)},_createModal:function(){const e=this._createModalTitle();this.saveButton=this._createSaveButton();const t=this._createCancelButton();var s=new o({closable:!0,header:e,footer:[this.saveButton,t]});return s.getContent().getElement(".fonticon-cancel").addEvent("click",(e=>{e.preventDefault(),this._onCancel()})),s},_createModalTitle:function(){return e.createElement("h4",{text:i.format(u.get("editServiceModalHeader"),this.serviceTerm)})},_createSaveButton:function(){return new n({value:u.get("save"),className:"primary",disabled:!0,events:{onClick:this._onSave.bind(this)}})},_createCancelButton:function(){return new n({value:u.get("cancel"),events:{onClick:this._onCancel.bind(this)}})},_createShopNameEntry:function(){return new m({className:"mpf-entry-v2 mpf-showroom-service-name",model:this.shop,fieldLabel:i.ucfirst(i.format(u.get("serviceName"),this.serviceTerm)),fieldName:a.Fields.NAME,dynamicValidation:!0,keyUpValidation:!0,required:!0,silent:!1,readOnly:this.shop.get(a.Fields.STATE)===a.States.SUBMITTED,maxlength:60})},_createShopLogoEntry:function(){return new p({model:this.shop,imageModel:this.logo,fieldLabel:i.ucfirst(i.format(u.get("serviceImage"),this.serviceTerm)),fieldName:a.Fields.LOGO,imageShape:"round",maxFileSize:this.maxFileSize})},_createShopBackgroundEntry:function(){return new p({model:this.shopService,imageModel:this.background,fieldLabel:u.get("backgroundImage"),fieldName:h.Fields.BACKGROUND_IMAGE,maxFileSize:this.maxFileSize})},_createShopDescriptionEntry:function(){return new m({className:"mpf-entry-v2 mpf-showroom-description",model:this.shopService,fieldLabel:i.ucfirst(i.format(u.get("serviceDescription"),this.serviceTerm)),fieldName:h.Fields.DESCRIPTION,dynamicValidation:!0,keyUpValidation:!0,silent:!1,required:!0,multiline:!0,multilineRows:5,maxlength:500})},_storeOldValues:function(){this.oldValues={},this.oldValues[a.Fields.NAME]=this.shop.get(a.Fields.NAME),this.oldValues[a.Fields.LOGO]=this.shop.get(a.Fields.LOGO),this.oldValues[h.Fields.BACKGROUND_IMAGE]=this.shopService.get(h.Fields.BACKGROUND_IMAGE),this.oldValues[h.Fields.DESCRIPTION]=this.shopService.get(h.Fields.DESCRIPTION)},_restoreOldValues:function(){this._hasNameChanged()&&this.shop.set(a.Fields.NAME,this.oldValues[a.Fields.NAME]),this._hasDescriptionChanged()&&this.shopService.set(h.Fields.DESCRIPTION,this.oldValues[h.Fields.DESCRIPTION]),this.shop.get(a.Fields.LOGO)!==this.oldValues[a.Fields.LOGO]&&this.shop.set(a.Fields.LOGO,this.oldValues[a.Fields.LOGO]),this.shopService.get(h.Fields.BACKGROUND_IMAGE)!==this.oldValues[h.Fields.BACKGROUND_IMAGE]&&this.shopService.set(h.Fields.BACKGROUND_IMAGE),this.shopNameEntry.resetValue({silent:!0}),this.shopDescriptionEntry.resetValue({silent:!0}),this.shopNameEntry.setValue(this.shop.get(a.Fields.NAME),{silent:!0}),this.shopDescriptionEntry.setValue(this.shopService.get(h.Fields.DESCRIPTION),{silent:!0}),this._updateRemainingCharacters(this.shopNameRemainingCharactersContainer,this.shopNameEntry),this._updateRemainingCharacters(this.shopDescriptionRemainingCharactersContainer,this.shopDescriptionEntry)}})})),define("DS/MPFShowroomComponent/ShowroomShopAddressTile",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFShopModel/ShopModel","DS/MPFAddressModel/AddressModel","DS/MPFCountryModel/CountryModel"],(function(e,t,s,i,o,n){"use strict";return t.extend({className:"mpf-tile mpf-address-tile",setup:function(e){s.requiredOfPrototype(e.shop,i,"options.shop must be a ShopModel"),this.shop=e.shop,e.address&&(s.requiredOfPrototype(e.address,o,"options.address must be an AddressModel"),this.address=e.address,this.listenTo(this.address,"onChange",this.render.bind(this))),e.country&&(s.requiredOfPrototype(e.country,n,"options.country must be a CountryModel"),this.country=e.country)},render:function(){var t=this._getCountry(),s=this._getCity()||"";return e.is(t,"string")&&t.length>0&&(s?s+=", "+t:s=t),s&&this.container.setContent([{tag:"span",class:"fonticon fonticon-3ds-where"},{tag:"div",text:s}]),this},destroy:function(){this.stopListening(),this.shop=null,this.address=null,this.country=null,this._parent(),this.container=null},_getCountry:function(){if(this.country&&this.country.getName())return this.country.getName();if(this.shop.getCountry()){var t=this.shop.getCountry();return t=e.is(t,"object")&&t.name?t.name:t}return this.address&&this.address.getCountry()?this.address.getCountry():void 0},_getCity:function(){return this.address&&this.address.getCity()?this.address.getCity():this.shop.getCity()?this.shop.getCity():""}})})),define("DS/MPFShowroomComponent/ShowroomShopSizeTile",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFShopModel/ShopServiceModel","i18n!DS/MPFShowroomComponent/assets/nls/ShowroomComponent"],(function(e,t,s,i,o){"use strict";return t.extend({className:"mpf-tile mpf-employees-tile",setup:function(e){s.requiredOfPrototype(e.shopService,i,"options.shopService nust be a ShopServiceModel"),this.shopService=e.shopService,this.employeesTerm=o.get(e.employeesTerm)||o.get("employees"),this.listenTo(this.shopService,"onChange",this.render.bind(this))},render:function(){var t=this._renderEmployeeNumber();return e.is(t,"string")&&t.length>0&&this.container.setContent([{tag:"span",class:"fonticon fonticon-users"},{tag:"div",text:t}]),this},destroy:function(){this.stopListening(),this.shopService=null,this._parent(),this.container=null},_renderEmployeeNumber:function(){const e=this.shopService.getNumberEmployees();if(Array.isArray(e)){if(e.length>0)var t=parseInt(e[0]);if(e.length>1)var s=parseInt(e[1]);if(s&&(null===t||0===t||isNaN(t)))return o.get("lessThanXItems",{number:s,itemTerm:this.employeesTerm});if(t&&!s)return o.get("moreThanXItems",{number:t,itemTerm:this.employeesTerm});if(t&&s)return t===s?1===t?o.get("freelance"):o.get("xItems",{number:t,itemTerm:this.employeesTerm}):o.get("betweenXandYItems",{infNumber:t,supNumber:s,itemTerm:this.employeesTerm})}}})})),define("DS/MPFShowroomComponent/ShowroomShopTopBar",["UWA/Core","UWA/Class/View","DS/MPFView/InitialsDot","DS/MPFShowroomComponent/ShowroomShopAddressTile","DS/MPFShowroomComponent/ShowroomShopSizeTile","DS/MPFServices/ObjectService","DS/MPFShopModel/ShopModel","DS/MPFAddressModel/AddressModel","i18n!DS/MPFShowroomComponent/assets/nls/ShowroomComponent"],(function(e,t,s,i,o,n,r,a,h){"use strict";return t.extend({className:"mpf-showroom-shop-top-bar",setup:function(e){if(n.requiredOfPrototype(e.shop,r,"options.shop must be a ShopModel"),this.shop=e.shop,this.address=e.address,this.shopService=e.shopService,this.country=e.country,this.employeesTerm=e.employeesTerm,this.hasGenericShopName=e.hasGenericShopName,this.isSmallView=!0===e.isSmallView,this.logoElement=this._createLogo(),(this.country||this.address||this.shop.getCountry()||this.shop.getCity())&&(this.addressElement=this._createAddressTile()),this.shopService){const e=this.shopService.getNumberEmployees();Array.isArray(e)&&e.length>0&&(this.shopSizeElement=this._createShopSizeTile())}this.listenTo(this.shop,"onChange:"+r.Fields.NAME,this.render.bind(this)),this.listenTo(this.shop,"onChange:"+r.Fields.LOGO,this._updateLogo.bind(this))},render:function(){return this.container.setContent([this.logoElement,{tag:"div",class:"mpf-right-column",html:this._createTitle()}]),this},destroy:function(){this.stopListening(),this.addressElement&&this.addressElement.destroy(),this.shopSizeElement&&this.shopSizeElement.destroy(),this.shop=null,this.address=null,this._parent(),this.container=null},_createTitle:function(){return this.isSmallView?{tag:"div",class:"mpf-showroom-shop-title",text:h.get("AboutUsUpperCase")}:[{tag:"div",class:"mpf-showroom-shop-title",text:this.hasGenericShopName?h.get("DassaultSyst√®mes"):this.shop.getName()},this.addressElement?this.addressElement.render():"",this.shopSizeElement?this.shopSizeElement.render():""]},_createLogo:function(){return new s({title:this.shop.getName(),image:this.shop.getLogo()})},_createAddressTile:function(){return new i({shop:this.shop,address:this.address,country:this.country})},_createShopSizeTile:function(){return new o({shopService:this.shopService,employeesTerm:this.employeesTerm})},_updateLogo:function(){this.logoElement=this._createLogo(),this.render()}})})),define("DS/MPFShowroomComponent/ShowroomGalleryItem",["UWA/Core","DS/MPFServices/MPFInputsServices","DS/MPFShowroomComponent/GalleryItem"],(function(e,t,s){"use strict";const i=Object.freeze({SHOW_DESCRIPTION_MODAL:"showDescriptionModal"}),o=s.extend({setup:function(e){this._parent(e),this.longDescriptionMask=this._createLongDescriptionMask(),this.upDownArrow=this._createUpDownArray(),this.container.addClassName("mpf-showroom-gallery-item")},render:function(){const e=[];return this.imageElement=this._createImageElement(),this.imageContainer=this._createImageContainer(this.imageElement),this.textContainer=this._createTextContainer(this.longDescriptionMask),e.push({tag:"div",class:"mpf-gallery-item-content",html:[this.imageContainer,this.textContainer,this.upDownArrow]}),this.editable&&e.push(this._createButtons()),this.container.setContent(e),this._onResize(),this},destroy:function(){this.stopListening(),this.textContainer&&this.textContainer.removeEvents(),this.imageElement&&this.imageElement.removeEvents(),this._parent(),this.container=null},_createImageContainer:function(t){return e.createElement("div",{class:"mpf-gallery-item-image-container",html:t})},_createImageElement:function(){const t=e.createElement("div",{class:"mpf-gallery-item-image",styles:{"background-image":"url("+this.showcaseItem.get("image")+")"},events:{click:this._openImage.bind(this)}});return t.addEvent("resize",this._onResize.bind(this)),t},_createTextContainer:function(t){const s=e.createElement("div",{class:"mpf-gallery-item-text",html:[{tag:"h4",class:"mpf-gallery-item-title",text:this.showcaseItem.getTitle()},{tag:"div",class:"mpf-gallery-item-description",html:this._getDescription()},t]});return s.addEvent("mouseenter",this._shiftTextUpwards.bind(this)),s.addEvent("mouseleave",this._putTextBackInPlace.bind(this)),s.addEvent("click",this._onTextContainerClick.bind(this)),s},_getDescription(){return t.cleanHtml(this.showcaseItem.getDescription()).replace(/\n\r?/g,"<br />")},_createUpDownArray:function(){return e.createElement("span",{class:"fonticon fonticon-expand-up",events:{click:this._shiftTextUpwards.bind(this)}})},_createLongDescriptionMask:function(){return e.createElement("div",{class:"mpf-description-mask",html:[{tag:"span",text:" ... ",class:"mpf-show-description-icon"}],events:{click:this.dispatchEvent.bind(this,i.SHOW_DESCRIPTION_MODAL,this.showcaseItem)}})},_shiftTextUpwards:function(){if(this.isDescriptionOverflowing){this.upDownArrow.setOpacity(0);let e=this.container.getSize().height-this.textContainer.getScrolls().height;e=e<0?0:e,this.textContainer.setStyle("top",e.toString()),this.longDescriptionMask.setStyle("display",0===e?"flex":"none")}},_putTextBackInPlace:function(){this.isDescriptionOverflowing&&(this.textContainer.setStyle("top",this.imageContainer.getSize().height+"px"),this.upDownArrow.setOpacity(1),this.container.getSize().height-this.textContainer.getScrolls().height<0&&this.longDescriptionMask.hide())},_onTextContainerClick:function(){parseInt(this.textContainer.getStyle("top"),10)<this.imageContainer.getSize().height?this._putTextBackInPlace():this._shiftTextUpwards()},_openImage:function(){const e=encodeURI(this.showcaseItem.get("image")||this.imageElement.getStyle("background-image").slice(4,-1).replace(/"/g,""));window.open(e,"_blank")},_onResize:function(e){e&&e.target!==this.imageElement||(this._insertArrowForLongDescriptions(),this._cutTooLongDescriptions())},_insertArrowForLongDescriptions:function(e){this.imageContainer.getScrolls().height+this.textContainer.getScrolls().height-this.container.getSize().height>0?(this.isDescriptionOverflowing=!0,this.upDownArrow.show(),this.upDownArrow.setOpacity(1)):(this.isDescriptionOverflowing=!1,this.upDownArrow.hide(),this.upDownArrow.setOpacity(0))},_cutTooLongDescriptions:function(){this.container.getSize().height-this.textContainer.getScrolls().height<0&&this.textContainer.setStyles({height:this.container.getSize().height,"overflow-y":"hidden"})}});return o.Events=i,o})),define("DS/MPFShowroomComponent/ShowroomGalleryForm",["UWA/Core","UWA/String","UWA/Promise","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFShowroomComponent/ImageUploadHelper","DS/MPFShowcaseItemModel/ShowcaseItemModel","DS/MPFShopModel/MediaModel","DS/MPFView/FieldFileInput","DS/MPFView/FieldTextInputV2","i18n!DS/MPFShowroomComponent/assets/nls/ShowroomComponent"],(function(e,t,s,i,o,n,r,a,h,l,c){"use strict";const d=Object.freeze({NEW_FILE_SELECTED:"newFileSelected",INVALID_FILE_SELECTED:"invalidFileSelected",ON_CHANGE:"onChange"}),m=i.extend({className:"mpf-showroom-gallery-form mpf-form mpf-horizontal",setup:function(e){o.requiredOfPrototype(e.showcaseItem,r,"options.showcaseItem must be a ShowcaseItemModel"),o.requiredOfPrototype(e.mediaModel,a,"options.mediaModel must be a MediaModel"),o.requiredOfType(e.acceptedFileTypes,"array","options.acceptedFileTypes must be an array"),this.showcaseItem=e.showcaseItem,this.mediaModel=e.mediaModel,this.acceptedFileTypes=e.acceptedFileTypes,this.maxFileSize=e.maxFileSize,this.showcaseItemsTitles=e.showcaseItemsTitles,this.imageInput=this._createImageInput(),this.titleInput=this._createTitleInput(),this.descriptionInput=this._createDescriptionInput(),this.storeOldValues(),this.listenTo(this.imageInput,h.Events.NEW_FILE_SELECTED,this.dispatchEvent.bind(this,d.NEW_FILE_SELECTED)),this.listenTo(this.imageInput,h.Events.INVALID_FILE_SELECTED,this.dispatchEvent.bind(this,d.INVALID_FILE_SELECTED)),this.listenTo(this.titleInput,l.Events.UPDATE,this.dispatchEvent.bind(this,d.ON_CHANGE)),this.listenTo(this.descriptionInput,l.Events.UPDATE,this.dispatchEvent.bind(this,d.ON_CHANGE))},render:function(){return this.container.setContent([this.imageInput.render(),this.titleInput.render(),this.descriptionInput.render()]),this},validateInputs:function(){const e=[];return e.push(this.titleInput.validate().isValid&&!this.titleAlreadyExists()),e.push(this.descriptionInput.validate().isValid),!this._validateImage()&&e.push(!1),e.indexOf(!1)<0},validateValues:function(){return!this.showcaseItem.validate()&&this._validateImage()&&!!this.titleInput.getValue()&&this.titleInput.getValue()===this.showcaseItem.getTitle()&&!!this.descriptionInput.getValue()&&this.descriptionInput.getValue()===this.showcaseItem.getDescription()},titleAlreadyExists(){return this.showcaseItemsTitles.includes(this.titleInput.getValue())},save:function(){return this.validateInputs()?n.saveFileAndShowcaseItem(this.imageInput,this.showcaseItem,this.mediaModel):this.titleAlreadyExists()?s.reject("The title already exists"):s.reject("Validation failure")},destroy:function(){this.stopListening(),this.imageInput.destroy(),this.titleInput.destroy(),this.descriptionInput.destroy(),this.showcaseItem=null,this._parent(),this.container=null},storeOldValues:function(){this.oldValues=this.showcaseItem.omit()},restoreOldValues:function(){this.showcaseItem.set(this.oldValues),this.oldValues=null},hasPendingImageChange:function(){return e.is(this.imageInput.getFile())},_validateImage:function(){return!this.imageInput.isShowingError()&&e.is(this.showcaseItem.get(r.Fields.IMAGE))&&this.showcaseItem.get(r.Fields.IMAGE).length>0||e.is(this.imageInput.getFile())},_createImageInput:function(){let e=this.acceptedFileTypes[0];for(let t=1;t<this.acceptedFileTypes.length;t++)e+=", "+this.acceptedFileTypes[t];const s=t.format(c.get("uploadImageWithFormat"),e),i=this.showcaseItem.get(r.Fields.IMAGE);return new h({fileModel:this.mediaModel,fieldName:r.Fields.IMAGE,fieldLabel:c.get(r.Fields.IMAGE),showTextInput:!0,silent:!1,acceptedFileTypes:this.acceptedFileTypes,wrongFileTypeMessage:c.get("wrongFileTypeMessage"),maxFileSize:this.maxFileSize,placeholder:""!==i?c.get("noNewImageSelected"):c.get("noImageSelected"),buttonText:""!==i?c.get("replaceImage"):c.get("chooseImage"),required:!0,tooltip:s})},_createTitleInput:function(){return new l({className:"mpf-entry-v2 mpf-image-title",model:this.showcaseItem,fieldName:r.Fields.TITLE,fieldLabel:c.get("title"),placeholder:c.get("addTitle"),required:!0,dynamicValidation:!0,keyUpValidation:!0,silent:!1})},_createDescriptionInput:function(){return new l({className:"mpf-entry-v2 mpf-image-description",model:this.showcaseItem,fieldName:r.Fields.DESCRIPTION,fieldLabel:c.get("description"),placeholder:c.get("addDescription"),required:!0,dynamicValidation:!0,keyUpValidation:!0,silent:!1,multiline:!0,multilineRows:3})}});return m.Events=d,m})),define("DS/MPFShowroomComponent/ShowroomShop",["UWA/Core","UWA/Promise","UWA/Class/View","DS/UIKIT/Input/Button","DS/MPFShopModel/ShopModel","DS/MPFShopModel/ShopServiceModel","DS/MPFShopModel/LogoModel","DS/MPFShopModel/BackgroundModel","DS/MPFServices/ObjectService","DS/MPFServices/MarketplaceServices","DS/MPFShowroomComponent/ShowroomShopTopBar","DS/MPFShowroomComponent/ShowroomShopDescription","DS/MPFShowroomComponent/ShowroomShopModal","DS/MPFDataProxy/MarketplaceConnector","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFShopModel/ShopFactory","DS/MPFCountryModel/CountryFactory","DS/MPFShopModel/ShopServiceFactory","DS/MPFAddressModel/AddressFactory","DS/MPFAddressModel/AddressModel","css!DS/MPFShowroomComponent/MPFShowroomComponent"],(function(e,t,s,i,o,n,r,a,h,l,c,d,m,p,u,S,g,f,w,I){"use strict";const y=Object.freeze({SELECT_CLICKED:"onSelectButtonClicked"}),E=s.extend({className:"mpf-showroom-shop",setup:function(e){h.requiredOfPrototype(e.shop,o,"options.shop must be a ShopModel"),h.requiredOfPrototype(e.shopService,n,"options.shopService must be a ShopServiceModel"),h.requiredOfPrototype(e.logo,r,"options.logo must be a LogoModel"),h.requiredOfPrototype(e.background,a,"options.background must be a BackgroundModel"),this.shop=e.shop,this.address=e.address,this.shopService=e.shopService,this.logo=e.logo,this.background=e.background,this.country=e.country,this.editable=!0===e.editable,this.serviceTerm=e.serviceTerm,this.employeesTerm=e.employeesTerm,this.maxFileSize=e.maxFileSize||2097152,this.hasSelectButton=e.hasSelectButton,this.selectButtonLabel=e.selectButtonLabel,this.hasGenericShopName=!0===e.hasGenericShopName,this.isSmallView=!0===e.isSmallView,this.logo.setParentResourceId(this.shop.get("id")),this.background.setParentResourceId(this.shopService.get("id")),this.topBar=this._createTopBar(),this.shopDescription=this._createShopDescription(),this.editable&&(this.shopEditModal=this._createShopEditModal(),this.editDescriptionCommand=this._createEditDescriptionCommand())},render:function(){this.isSmallView&&!this.container.hasClassName("mpf-small-view")&&this.container.addClassName("mpf-small-view");const e=[this.topBar.render(),this.shopDescription.render()];return this.editable&&(e.push(this.editDescriptionCommand),e.push(this.shopEditModal.render())),this.container.setContent(e),this},destroy:function(){this.editDescriptionCommand&&this.editDescriptionCommand.destroy(),this.topBar.destroy(),this.shopDescription.destroy(),this.shop=null,this.shopService=null,this.logo=null,this.background=null,this._parent(),this.container=null},_onEdit:function(){this.shopEditModal.show()},_createShopDescription:function(){return new d({isContextEditable:this.editable,shopService:this.shopService,serviceTerm:this.serviceTerm,hasSelectButton:this.hasSelectButton,selectButtonLabel:this.selectButtonLabel,onSelectButtonClicked:this._onSelectButtonClicked.bind(this),isSmallView:this.isSmallView})},_createTopBar:function(){return new c({shop:this.shop,shopService:this.shopService,address:this.address,country:this.country,employeesTerm:this.employeesTerm,hasGenericShopName:this.hasGenericShopName,isSmallView:this.isSmallView})},_createEditDescriptionCommand:function(){return new i({className:"mpf-shop-edit",icon:"pencil",events:{onClick:this._onEdit.bind(this)}})},_createShopEditModal:function(){return new m({shop:this.shop,shopService:this.shopService,logo:this.logo,background:this.background,serviceTerm:this.serviceTerm,maxFileSize:this.maxFileSize})},_onSelectButtonClicked:function(){this.dispatchEvent(y.SELECT_CLICKED,{shop:this.shop,shopService:this.shopService})}});return E.fromShopId=function(s,i){let o,n,r,a,h,c,d,m;return console.warn("Deprecated factory function since 4.6. Please use ShowroomShopFactory.fromShopId instead."),i=i||{},e.is(i,"object")?o=i:e.is(i,"boolean")&&(o={editable:i}),function(e){const s=e.service||l.MAKE;return p.fetchPromise({service:s}).then((function(e){const s=u.getInstance(e);return t.all([s.getFactory(u.Types.SHOP),s.getFactory(u.Types.SHOP_SERVICE),s.getFactory(u.Types.LOGO),s.getFactory(u.Types.BACKGROUND),s.getFactory(u.Types.ADDRESS),s.getFactory(u.Types.COUNTRY)])}))}(i).then((function(e){const i=e[0],o=e[1],l=e[2],c=e[3];d=e[4];const p=e[5];return n=i.createModel(S.Types.SHOP),r=o.createModel(f.Types.SHOP_SHOP_SERVICE),a=l.createModel(),h=c.createModel(),n.set("id",s),r.setParentResourceId(s),m=p.createCollection(g.Types.SELLER),t.all([n.fetchPromise(),r.fetchPromise(),m.fetchPromise()])})).then((function(){return c=d.createModel(w.Types.ADDRESS,{id:n.get("address")},{parentResourceId:s}),c.fetchPromise()})).then((function(){let t;const s=c.getCountry();return s.test(/^[A-Z]{3}$/)&&(t=m.getCountryWithIso3(s)),o=e.extend(o,{shop:n,shopService:r,logo:a,background:h,address:c,country:t}),new E(o)}))},E.fromPublicShopId=function(s,i){console.warn("Deprecated factory function since 4.6. Please use ShowroomShopFactory.fromPublicShopId instead."),(i=i||{}).editable=!1;const n=i.service||l.MAKE;let r,a,h,c,d,m;return p.fetchPromise({service:n}).then((function(e){const s=u.getInstance(e);return t.all([s.getFactory(u.Types.SHOP),s.getFactory(u.Types.SHOP_SERVICE),s.getFactory(u.Types.LOGO),s.getFactory(u.Types.BACKGROUND),s.getFactory(u.Types.COUNTRY)])})).then((function(e){const i=e[0];r=e[1];const n=e[2],h=e[3],l=e[4];return a=i.createModel(S.Types.PUBLIC_V1),a.set("id",s),c=n.createModel(),d=h.createModel(),m=l.createCollection(g.Types.SELLER),t.all([a.fetchPromise({expand:[o.Expands.SHOP_SERVICES]}),m.fetchPromise()])})).then((function(t){const s=t[0].getService(n);let o;h=r.createModel(f.Types.SHOP_SHOP_SERVICE,s);const l=a.getCountry();return l&&l.test(/^[A-Z]{3}$/)&&(o=m.getCountryWithIso3(l)),i=e.extend(i,{shop:a,shopService:h,logo:c,background:d,country:o}),new E(i)}))},E.Events=y,E})),define("DS/MPFShowroomComponent/ShowroomShopFactory",["UWA/Core","UWA/Promise","DS/MPFUrl/UrlUtils","DS/MPFConnector/MarketplaceConnector","DS/MPFServices/MarketplaceServices","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFShopModel/ShopFactory","DS/MPFShopModel/ShopServiceFactory","DS/MPFCountryModel/CountryFactory","DS/MPFAddressModel/AddressFactory","DS/MPFShopModel/ShopModel","DS/MPFShowroomComponent/ShowroomShop"],(function(e,t,s,i,o,n,r,a,h,l,c,d){"use strict";class m{static fromShopId(i,n={}){const c=n.service||o.MAKE;let m,p,u,S,g,f,w,I,y;return e.is(n,"object")?y=n:e.is(n,"boolean")&&(y={editable:n}),this._fetchConnectorGetFactories(n).then((function(e){return m=e[0].createModel(r.Types.SHOP,{id:i}),u=e[1],S=e[2].createModel(),g=e[3].createModel(),w=e[4],I=e[5].createCollection(h.Types.SELLER),t.all([m.fetchPromise(),I.fetchPromise()])})).then((function(){const e=new s(m.getAddress()),t=m.getService(c);return p=u.createModel(a.Types.SHOP_SHOP_SERVICE,t),p.setParentResourceId(i),f=w.createModel(l.Types.ADDRESS,{id:e.extractId()},{parentResourceId:i}),f.fetchPromise()})).then((function(){let t;const s=f.getCountry();return s.test(/^[A-Z]{3}$/)&&(t=I.getCountryWithIso3(s)),y=e.extend(y,{shop:m,shopService:p,logo:S,background:g,address:f,country:t}),new d(y)}))}static fromPublicShopId(i,n={}){n.editable=!1;const m=n.service||o.MAKE;let p,u,S,g,f,w,I;return this._fetchConnectorGetFactories(n).then((function(e){return p=e[1],u=e[0].createModel(r.Types.PUBLIC_V1,{id:i}),g=e[2].createModel(),f=e[3].createModel(),I=e[4].createModel(l.Types.PUBLIC),w=e[5].createCollection(h.Types.SELLER),t.all([u.fetchPromise({expand:[c.Expands.SHOP_SERVICES]}),w.fetchPromise()])})).then((function(){const e=new s(u.getAddress());return I.set("id",e.extractId()),I.fetchPromise()})).then((function(){const t=u.getService(m);let s;S=p.createModel(a.Types.SHOP_SHOP_SERVICE,t);const i=u.getCountry();return i&&i.test(/^[A-Z]{3}$/)&&(s=w.getCountryWithIso3(i)),n=e.extend(n,{shop:u,shopService:S,logo:g,background:f,country:s,address:I}),new d(n)}))}static _fetchConnectorGetFactories(e){const s=e.service||o.MAKE;return i.fetchPromise({service:s}).then((function(e){const s=n.getInstance(e);return t.all([s.getFactory(n.Types.SHOP),s.getFactory(n.Types.SHOP_SERVICE),s.getFactory(n.Types.LOGO),s.getFactory(n.Types.BACKGROUND),s.getFactory(n.Types.ADDRESS),s.getFactory(n.Types.COUNTRY)])}))}}return m.Events=d.Events,m})),define("DS/MPFShowroomComponent/ShowroomCollaborationForm",["UWA/Core","UWA/String","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFShowroomComponent/ImageUploadHelper","DS/MPFShowcaseItemModel/ShowcaseItemModel","DS/MPFShopModel/MediaModel","DS/MPFView/FieldFileInput","i18n!DS/MPFShowroomComponent/assets/nls/ShowroomComponent"],(function(e,t,s,i,o,n,r,a,h){"use strict";var l={};return l.NEW_FILE_SELECTED="newFileSelected",l.INVALID_FILE_SELECTED="invalidFileSelected",s.extend({className:"mpf-showroom-collaboration-form mpf-form mpf-horizontal",setup:function(e){i.requiredOfPrototype(e.showcaseItem,n,"options.showcaseItem must be a ShowcaseItemModel"),i.requiredOfPrototype(e.mediaModel,r,"options.mediaModel must be a MediaModel"),i.requiredOfType(e.acceptedFileTypes,"array","options.acceptedFileTypes must be an array"),this.showcaseItem=e.showcaseItem,this.mediaModel=e.mediaModel,this.acceptedFileTypes=e.acceptedFileTypes,this.maxFileSize=e.maxFileSize,this.fileInput=this._createFileInput(),this.storeOldValues()},render:function(){return this.container.setContent(this.fileInput.render()),this},validateInputs:function(){return this._validateImage()},validateValues:function(){return!this.showcaseItem.validate()&&this._validateImage()},save:function(){if(this.validateInputs())return o.saveFileAndShowcaseItem(this.fileInput,this.showcaseItem,this.mediaModel)},destroy:function(){this.stopListening(),this.fileInput.destroy(),this.showcaseItem=null,this.mediaModel=null,this._parent(),this.container=null},storeOldValues:function(){this.oldValues=this.showcaseItem.omit()},restoreOldValues:function(){this.showcaseItem.set(this.oldValues),this.oldValues=null},hasPendingImageChange:function(){return e.is(this.fileInput.getFile())},_validateImage:function(){return!this.fileInput.isShowingError()&&e.is(this.fileInput.getFile())},_createFileInput:function(){for(var e=this.showcaseItem.get(n.Fields.IMAGE),s=this.acceptedFileTypes[0],i=1;i<this.acceptedFileTypes.length;i++)s+=", "+this.acceptedFileTypes[i];var o=t.format(h.get("uploadImageWithFormat"),s),r=new a({fileModel:this.mediaModel,fieldName:n.Fields.IMAGE,fieldLabel:h.get(n.Fields.IMAGE),showTextInput:!0,silent:!1,acceptedFileTypes:this.acceptedFileTypes,wrongFileTypeMessage:h.get("wrongFileTypeMessage"),maxFileSize:this.maxFileSize,placeholder:""!==e?h.get("noNewImageSelected"):h.get("noImageSelected"),buttonText:""!==e?h.get("replaceImage"):h.get("chooseImage"),required:!0,tooltip:o});return this.listenTo(r,a.Events.NEW_FILE_SELECTED,this.dispatchEvent.bind(this,l.NEW_FILE_SELECTED)),this.listenTo(r,a.Events.INVALID_FILE_SELECTED,this.dispatchEvent.bind(this,l.INVALID_FILE_SELECTED)),r}})})),define("DS/MPFShowroomComponent/GalleryEditModal",["UWA/Core","UWA/Class/View","DS/WebappsUtils/WebappsUtils","DS/UIKIT/Input/Button","DS/UIKIT/Modal","DS/UIKIT/Alert","DS/MPFShowroomComponent/ImageUploadHelper","i18n!DS/MPFShowroomComponent/assets/nls/ShowroomComponent"],(function(e,t,s,i,o,n,r,a){"use strict";const h=Object.freeze({ADD_NEW_ITEM:"addNewItem",UPDATE_ITEM:"updateItem",CANCEL:"cancel",SHOW_DELETE_MODAL:"showDeleteModal",NEW_FILE_SELECTED:"newFileSelected",INVALID_FILE_SELECTED:"invalidFileSelected",ON_CHANGE:"onChange"}),l=t.extend({className:"mpf-gallery-edit-modal",setup:function(){this.alert=this._createAlert(),this.imagePreview=this._createImagePreview(),this.formContainer=this._createFormContainer(),this.saveButton=this._createSaveButton(),this.cancelButton=this._createCancelButton(),this.deleteButton=this._createDeleteButton(),this.modal=this._createModal()},render:function(){return this.container.setContent(this.modal),this},destroy:function(){this.stopListening(),this.showcaseItem=null,this._parent(),this.container=null},enableSaveButton:function(e){e=!1!==e,this.saveButton.setDisabled(!e)},updateImagePreview:function(e){(e=e||this.showcaseItem.getImage())?(this.imagePreview.removeClassName("mpf-background-placeholder"),this.imagePreview.setStyle("background-image","url("+e+")")):(this.imagePreview.addClassName("mpf-background-placeholder"),this.imagePreview.setStyle("background-image","url("+s.getWebappsAssetUrl("MPFShowroomComponent","images/shop_background_placeholder.jpg")+")"))},onChange:function(){this.enableSaveButton(this.form.validateValues()&&(this.showcaseItem.hasPendingChanges()||this.form.hasPendingImageChange()))},onFileChange:function(e){const t=this;r.readImageFile({file:e,onLoaded:this.updateImagePreview.bind(this),onError:function(e){console.error(e),t.alert.add({className:"error",message:a.get("fileCouldNotBeLoaded")}).show()}}),this.onChange()},show:function(e){return this.form=e,this.listenTo(this.form,h.NEW_FILE_SELECTED,this.onFileChange.bind(this)),this.listenTo(this.form,h.INVALID_FILE_SELECTED,this.onChange.bind(this)),this.listenTo(this.form,h.ON_CHANGE,this.onChange.bind(this)),this.showcaseItem=e.showcaseItem,this.showcaseItem.isNew()?this.deleteButton.hide():this.deleteButton.show(),this.showcaseItem.isNew()?this.setTitle(a.get("addNewImage")):this.setTitle(a.get("editImage")),this.enableSaveButton(!1),this.updateImagePreview(),this.formContainer.setContent(this.form.render()),this.modal.show(),this},hide:function(){return this.stopListening(),this.form&&this.form.destroy(),this.form=null,this.showcaseItem=null,this.modal.hide(),this},setTitle:function(t){this.modal.setHeader(e.createElement("h4",{text:t}))},_onSave:function(){const e=this;this.saveButton.load(!0);const t=this.showcaseItem,s=t.isNew();this.form.save().then(this.saveButton.load.bind(this.saveButton,!1)).then(this.hide.bind(this)).then(this._dispatchUpdateEvent.bind(this,s,t)).catch((function(t){e.saveButton.load(!1),console.log(t),e.alert.add({className:"error",message:t.contains("title")?a.get("titleAlreadyExists"):a.get("modificationSaveFailure")}).show()}))},_dispatchUpdateEvent:function(e,t){e?this.dispatchEvent(h.ADD_NEW_ITEM,t):this.dispatchEvent(h.UPDATE_ITEM,t)},_onCancel:function(){this.form.restoreOldValues(),this.hide(),this.dispatchEvent(h.CANCEL,this)},_createAlert:function(){return new n({autoHide:!0,visible:!1})},_createImagePreview:function(){return e.createElement("div",{class:"mpf-image-preview"})},_createFormContainer:function(){return e.createElement("div",{class:"mpf-form-container"})},_createSaveButton:function(){return new i({className:"primary",value:a.get("save"),disabled:!0,events:{onClick:this._onSave.bind(this)}})},_createCancelButton:function(){return new i({value:a.get("cancel"),events:{onClick:this._onCancel.bind(this)}})},_createDeleteButton:function(){const e=this;return new i({className:"error",value:a.get("delete"),events:{onClick:function(){const t=e.showcaseItem;e.dispatchEvent(h.SHOW_DELETE_MODAL,t)}}})},_createModal:function(){const e=[this.saveButton,this.cancelButton,this.deleteButton];return new o({header:this.title,body:[this.alert,this.imagePreview,this.formContainer],footer:e})}});return l.Events=h,l})),define("DS/MPFShowroomComponent/ImageGallery",["UWA/Core","UWA/Class/View","UWA/Promise","DS/MPFServices/ObjectService","DS/MPFModel/MPFCollection","DS/MPFShopModel/MediaFactory","DS/MPFShowcaseItemModel/ShowcaseItemFactory","DS/MPFView/DropZone","DS/MPFShowroomComponent/ImageUploadHelper","DS/MPFShowroomComponent/GalleryItem","DS/MPFShowroomComponent/GalleryEditModal","DS/MPFShowroomComponent/GalleryDeleteModal","i18n!DS/MPFShowroomComponent/assets/nls/ShowroomComponent","css!DS/MPFShowroomComponent/MPFShowroomComponent"],(function(e,t,s,i,o,n,r,a,h,l,c,d,m){"use strict";return t.extend({className:"mpf-image-gallery",setup:function(e){i.requiredOfPrototype(e.showcaseItems,o,"options.showcaseItems must be a MPFCollection"),i.requiredOfType(e.itemType,"string","options.itemType must be a string"),this.showcaseItems=e.showcaseItems,this.itemType=e.itemType,this.editable=!0===e.editable,this.editable&&(i.requiredOfPrototype(e.mediaFactory,n,"options.mediaFactory must be a MediaFactory"),i.requiredOfPrototype(e.showcaseItemFactory,r,"options.showcaseItemFactory must be a ShowcaseItemFactory"),this.showcaseItemFactory=e.showcaseItemFactory,this.mediaFactory=e.mediaFactory),this.title=e.title||m.get("gallery"),this.subtitle=e.subtitle,this.acceptedFileTypes=e.acceptedFileTypes||["image/jpeg","image/png","image/bmp","image/gif"],this.maxFileSize=e.maxFileSize||2097152,this.galleryItems=this._createItems(this._filterItems(this.showcaseItems)),this.editable&&(this.dropZone=this._createDropZone(),this.deleteModal=this._createDeleteModal(),this.editModal=this._createEditModal())},render:function(){const t=[];this.galleryItems.forEach((function(e){t.push(e.render())})),this.editable&&t.push(this._createDropZoneContainer(this.dropZone.render()));const s=e.createElement("div",{class:"no-items-yet",html:m.get("noItemsYet")}),i=[{tag:"h3",class:"mpf-title",html:this.title},{tag:"h4",class:"mpf-subtitle",text:this.subtitle||""},{tag:"div",class:"mpf-item-container row",html:t.length>0?t:s}];return this.editable&&(i.push(this.editModal.render()),i.push(this.deleteModal.render())),this.container.setContent(i),this},update:function(){this.editable&&this.editModal.hide();for(let e=0;e<this.galleryItems.length;e++)this.stopListening(this.galleryItems[e]),this.galleryItems[e].destroy();this.galleryItems=this._createItems(this._filterItems(this.showcaseItems)),this.render()},addNewItem:function(e){this.showcaseItems.push(e),this.update()},updateItem:function(e){for(let t=0;t<this.galleryItems.length;t++){const s=this.galleryItems[t];if(s.showcaseItem===e)return void s.render()}},createEditForm:function(){return null},destroy:function(){this.stopListening();for(let e=0;e<this.galleryItems.length;e++)this.galleryItems[e].destroy();this.editable&&(this.editModal.destroy(),this.deleteModal.destroy()),this.showcaseItems=null,this._parent(),this.container=null},_filterItems:function(e){const t=this;return e.filter((function(e){return e.get("type")===t.itemType||e.get("itemType")===t.itemType}))},_getNumberShowcaseItems:function(){return this._filterItems(this.showcaseItems).length},_createItems:function(e){const t=this,s=[];return(e=e||[]).forEach((function(e){const i=t._createItem(e);t.listenTo(i,l.Events.SHOW_DELETE_MODAL,t._showDeleteModal.bind(t,e)),t.listenTo(i,l.Events.SHOW_EDIT_MODAL,t._showEditModal.bind(t,e)),s.push(i)})),s},_createItem:function(e){return new l({showcaseItem:e,editable:this.editable})},_createDropZone:function(){const e=new a({acceptedFileTypes:this.acceptedFileTypes,maxFileSize:this.maxFileSize});return this.listenTo(e,a.Events.ON_DROP,this._onDrop.bind(this)),this.listenTo(e,a.Events.ON_CLICK,this._showEditModal.bind(this)),e},_createDropZoneContainer:function(t){return e.createElement("div",{class:"mpf-drop-zone-container "+(this._getNumberShowcaseItems()>0?"col-xs-12 col-sm-4 col-md-3":"col-xs-12"),html:t})},_createEditModal:function(){const e=new c;return this.listenTo(e,c.Events.ADD_NEW_ITEM,this.addNewItem.bind(this)),this.listenTo(e,c.Events.UPDATE_ITEM,this.updateItem.bind(this)),this.listenTo(e,c.Events.SHOW_DELETE_MODAL,this._showDeleteModal.bind(this)),e},_createDeleteModal:function(){const e=new d;return this.listenTo(e,d.Events.ON_DELETE,this.update.bind(this)),e},_showEditModal:function(e){(e=e||this.showcaseItemFactory.createModel(r.Types.SHOP_SERVICE_SHOWCASE_ITEM,{itemType:this.itemType})).setParentResourceId(this.showcaseItems.parentResourceId);const t=this.mediaFactory.createModel(n.Types.MEDIA),s=this.createEditForm({showcaseItem:e,mediaModel:t,acceptedFileTypes:this.acceptedFileTypes,maxFileSize:this.maxFileSize,showcaseItemsTitles:this.showcaseItems.filter((t=>""!==t.getTitle()&&t!==e)).map((e=>e.getTitle()))});this.editModal.show(s)},_showDeleteModal:function(e){this.deleteModal.show(e)},_onDrop:function(e){const t=this,i=e.files,o=[];i.forEach((function(e){o.push(t._uploadImageOnDrop(e))})),this.dropZone.showLoading(),s.all(o).then((function(){t.update()})).finally((function(){t.dropZone.hideLoading()}))},_uploadImageOnDrop:function(e){const t=this,s=this.showcaseItemFactory.createModel(r.Types.SHOP_SERVICE_SHOWCASE_ITEM,{itemType:this.itemType},{parentResourceId:this.showcaseItems.parentResourceId}),i=e.name.substr(0,e.name.lastIndexOf(".")).replace(/[<>:"/|\\?*]/g,"");return s.setTitle(i),s.setDescription(i),s.savePromise().then((function(s){return h.uploadImage(t.mediaFactory,e,s.get("id"))})).then((function(e){s.setImage(e.getImage()),t.dropZone.hideLoading(),t.showcaseItems.push(s)}))}})})),define("DS/MPFShowroomComponent/ShowroomCollaborationGallery",["UWA/Core","DS/MPFTooltip/Tooltip","DS/MPFShowroomComponent/ImageGallery","DS/MPFShowroomComponent/ShowroomCollaborationForm","i18n!DS/MPFShowroomComponent/assets/nls/ShowroomComponent","css!DS/MPFShowroomComponent/MPFShowroomComponent"],(function(e,t,s,i,o){"use strict";return s.extend({setup:function(e){e.acceptedFileTypes=e.acceptedFileTypes||["image/jpeg","image/png","image/bmp","image/gif"],e.maxFileSize=e.maxFileSize||2097152,e.editable=!0===e.editable,e.title=this._createTitle(e.editable),e.itemType="customerRef",this._parent(e),this.container.addClassName("mpf-showroom-collaboration-gallery")},createEditForm:function(e){return new i(e)},_createTitle:function(s){var i=e.createElement("div",{class:"mpf-collaboration-title",text:o.get("partners")});return s&&(this.tooltip=new t({body:o.get("collaborationTooltip")}).inject(i)),i}})})),define("DS/MPFShowroomComponent/ShowroomGallery",["DS/MPFShowcaseItemModel/ShowcaseItemCollection","DS/MPFShowcaseItemModel/ShowcaseItemFactory","DS/MPFShopModel/MediaFactory","DS/MPFShowroomComponent/ImageGallery","DS/MPFShowroomComponent/ShowroomGalleryForm","DS/MPFShowroomComponent/ShowroomGalleryItem","DS/MPFShowroomComponent/ShowroomGalleryDescriptionModal","i18n!DS/MPFShowroomComponent/assets/nls/ShowroomComponent","css!DS/MPFShowroomComponent/MPFShowroomComponent"],(function(e,t,s,i,o,n,r,a){"use strict";return i.extend({setup:function(e){e.acceptedFileTypes=e.acceptedFileTypes||["image/jpeg","image/png","image/bmp","image/gif"],e.maxFileSize=e.maxFileSize||2097152,e.editable=!0===e.editable,e.title=e.title||a.get("gallery"),e.itemType="image",e.subtitle=e.subtitle||(e.editable?a.get("showYourWork"):null),this._parent(e),this.descriptionModal=this._createDescriptionModal(),this.container.addClassName("mpf-showroom-gallery")},render:function(){return this._parent(),this.container.addContent(this.descriptionModal.render()),this},showDescriptionModal:function(e){this.descriptionModal.show(e)},createEditForm:function(e){return new o(e)},_createItem:function(e){const t=new n({showcaseItem:e,editable:this.editable});return this.listenTo(t,n.Events.SHOW_DESCRIPTION_MODAL,this.showDescriptionModal.bind(this)),t},_createDescriptionModal:function(){return new r}})}));