define("DS/SocialToolbarVueTest/SocialToolbarVueTest",["UWA/Core","DS/PlatformAPI/PlatformAPI","DS/SocialToolbarVue/SocialToolbarVueUWAView","css!DS/SocialToolbarVueTest/Reset","css!DS/SocialToolbarVueTest/Styles"],((e,t,a)=>{const l="x-ds-swym-csrftoken",o={widget:void 0,view:void 0,init({widget:e}){o.widget=e,o.initPrefs(),e.addEvents({onLoad:o.onLoad,onRefresh:o.onLoad})},initPrefs(){o.widget.setPreferences([{name:"subjectUri",type:"text",label:"Subject URI*",defaultValue:"CmTPxYSubject:content1"},{name:"serviceUrl",type:"text",label:"Service URL*",defaultValue:""},{name:"platformId",type:"text",label:"Platform ID*",defaultValue:""},{name:"serviceCSRFName",type:"text",label:"Service CSRF Name",defaultValue:""},{name:"registryUrl",type:"text",label:"Registry URL",defaultValue:""},{name:"nbCommentsToLoadAtInit",type:"text",label:"Number of comments to display at init",defaultValue:"3"},{name:"hideCommentInputAtInit",type:"boolean",label:"Hide comment input at init",defaultValue:!1},{name:"hideCommentsListAtInit",type:"boolean",label:"Hide comments list at init",defaultValue:!1},{name:"focusCommentInputAtInit",type:"boolean",label:"Focus comment input at init",defaultValue:!1},{name:"appForcedLinkUri",type:"text",label:"App Forced Link URI",defaultValue:""},{name:"disableAddMedia",type:"boolean",label:"Disable Add Media",defaultValue:!1},{name:"disableComment",type:"boolean",label:"Disable Comment",defaultValue:!1},{name:"disableCommentLike",type:"boolean",label:"Disable Comment Like",defaultValue:!1},{name:"disableDisplayMedia",type:"boolean",label:"Disable Display Media",defaultValue:!1},{name:"disableLike",type:"boolean",label:"Disable Like",defaultValue:!1},{name:"disableReply",type:"boolean",label:"Disable Reply",defaultValue:!1},{name:"disableRichUserTooltip",type:"boolean",label:"Disable Rich User Tooltip",defaultValue:!1},{name:"disableSeeMore",type:"boolean",label:"Disable See More",defaultValue:!1},{name:"disableShare",type:"boolean",label:"Disable Share",defaultValue:!1},{name:"disableShowMediaOnClick",type:"boolean",label:"Disable Show Media On Click",defaultValue:!1},{name:"disableShowUserProfile",type:"boolean",label:"Disable Show User Profile",defaultValue:!1},{name:"disableShowUsersGroupProfile",type:"boolean",label:"Disable Show Users-Group Profile",defaultValue:!1},{name:"disableUserMention",type:"boolean",label:"Disable User Mention",defaultValue:!1},{name:"disableUserMentionAnonymisation",type:"boolean",label:"Disable User Mention Anonymisation",defaultValue:!1},{name:"alignCenterActionsToolbar",type:"boolean",label:"Align center toolbar' actions",defaultValue:!1},{name:"hasGuestAccess",type:"boolean",label:"Does GUEST users should have access to the Social Toolbar",defaultValue:!1},{name:"hideActionsToolbar",type:"boolean",label:"Hide the toolbar actions buttons (like/comment/share buttons)",defaultValue:!1},{name:"hideActionsToolbarLabels",type:"boolean",label:"Hide toolbar actions buttons' labels (like/comment/share labels)",defaultValue:!1},{name:"hideSeparator",type:"boolean",label:"Hide separator between actions toolbar and comments list",defaultValue:!1}])},instanciateSocialToolbar(){const e=o.widget,i=document.createElement("div");e.body.setContent(i);const n=(e.getValue("subjectUri")||"").trim();let s,r=e.getValue("serviceCSRFName");n.startsWith("CmTPxYSubject:")&&(r||(e.setValue("serviceCSRFName",l),r=l));try{const e=t.getUser();e&&(s={login:e.login,firstName:e.firstName,lastName:e.lastName})}catch(e){console.error("### Fail to get current user information from Widget Platform.")}const d={alignCenterActionsToolbar:!!e.getValue("alignCenterActionsToolbar"),atInit:{hideCommentInput:!!e.getValue("hideCommentInputAtInit"),hideCommentsList:!!e.getValue("hideCommentsListAtInit"),focusCommentInput:!!e.getValue("focusCommentInputAtInit"),nbCommentsToLoad:Number.parseInt(e.getValue("nbCommentsToLoadAtInit")??0,10)??3},appId:"STC_APP_TEST",appForcedLinkUri:e.getValue("appForcedLinkUri"),currentUser:s,disableFeatures:{disableAddMedia:!!e.getValue("disableAddMedia"),disableComment:!!e.getValue("disableComment"),disableCommentLike:!!e.getValue("disableCommentLike"),disableDisplayMedia:!!e.getValue("disableDisplayMedia"),disableLike:!!e.getValue("disableLike"),disableReply:!!e.getValue("disableReply"),disableRichUserTooltip:!!e.getValue("disableRichUserTooltip"),disableSeeMore:!!e.getValue("disableSeeMore"),disableShare:!!e.getValue("disableShare"),disableShowMediaOnClick:!!e.getValue("disableShowMediaOnClick"),disableShowUserProfile:!!e.getValue("disableShowUserProfile"),disableShowUsersGroupProfile:!!e.getValue("disableShowUsersGroupProfile"),disableUserMention:!!e.getValue("disableUserMention"),disableUserMentionAnonymisation:!!e.getValue("disableUserMentionAnonymisation")},hasGuestAccess:!!e.getValue("hasGuestAccess"),hideActionsToolbar:!!e.getValue("hideActionsToolbar"),hideActionsToolbarLabels:!!e.getValue("hideActionsToolbarLabels"),hideSeparator:!!e.getValue("hideSeparator"),platformId:o.getPlatformId(),subjectUri:n,urls:{service:e.getValue("serviceUrl"),serviceCSRF:{name:r},registry:o.getRegistryUrl()}},m=new a;function u(e,t){console.log(`### [STC-widget-test] event: ${e}`,t)}m.render({props:d}).inject(i),o.view=m,m.listenTo(m,{onClickOnLikeBtn(e){u("onClickOnLikeBtn",e)},onClickOnCommentBtn(e){u("onClickOnCommentBtn",e)},onClickOnShareBtn(e){u("onClickOnShareBtn",e)},onClickOnExtraActionBtn(e){u("onClickOnExtraActionBtn",e)},onClickOnMedia(e){u("onClickOnMedia",e)},onToggleLikeSubject(e){u("onToggleLikeSubject",e)},onClickOnUser(e){u("onClickOnUser",e),o.onClickOnUser(e)},onAddComment(e){u("onAddComment",e)},onEditComment(e){u("onEditComment",e)},onRemoveComment(e){u("onRemoveComment",e)},onToggleLikeComment(e){u("onToggleLikeComment",e)},onLoadInitialComments(e){u("onLoadInitialComments",e)}})},getRegistryUrl(){const e=o.widget;if(e.getValue("registryUrl"))return e.getValue("registryUrl");const a=o.getPlatformId();let l=t.getApplicationConfiguration("app.urls.registry");return"OnPremise"===a&&(l=t.getApplicationConfiguration("app.urls.myapps"),l&&!l.includes("resources/AppsMngtRegistry")&&(l=`${l}/resources/AppsMngtRegistry`.replace(/([^:]\/)\/+/g,"$1"))),l&&e.setValue("registryUrl",l),l},getPlatformId(){const e=o.widget;if(e.getValue("platformId"))return e.getValue("platformId");const a=t.getTenant();return a&&e.setValue("platformId",a),a},initServicesURLs(){const e=o.widget,t=o.getRegistryUrl(),a=o.getPlatformId();if(t&&a)return new Promise(((l,o)=>{require(["DS/i3DXCompassPlatformServices/i3DXCompassRegistryClient"],(i=>{const n="3DComment";return i.getServicesByPlatform({platforms:[a],services:[n],config:{url:t}}).then((t=>{const i=t.find((e=>e.id.toUpperCase()===a.toUpperCase()));if(!i)return o(new Error(`### Platform "${a}" not found from Registry response.`));i.services.forEach((t=>{t.id.toUpperCase()!==n.toUpperCase()||e.getValue("serviceUrl")||e.setValue("serviceUrl",t.url)})),l()}))}),o)}))},destroyView(){o.view&&(o.view.destroy(),o.view=void 0)},onError({errorMsg:t}){o.widget.body.empty().append(e.createElement("div",{class:"error-msg msg",text:t}))},async onLoad(){o.destroyView();const t=o.widget;try{if(!t.getValue("serviceUrl"))try{o.widget.body.empty().append(e.createElement("div",{class:"msg",html:[{tag:"div",class:"fetching-service-url-msg",text:"Fetching services URLs..."},{tag:"div",class:"loader"}]})),await o.initServicesURLs()}catch(e){o.onError({errorMsg:"Fail to fetch services URLs from Compass, please provide it in preferences."})}if(!t.getValue("serviceUrl"))throw new Error("Empty service URL, please provide it in preferences.")}catch(e){return void o.onError({errorMsg:e})}o.instanciateSocialToolbar()},onClickOnUserDataTimeout:void 0,onClickOnUser(e){document.body.setData("onClickOnUser",e),clearTimeout(o.onClickOnUserDataTimeout),o.onClickOnUserDataTimeout=setTimeout((()=>{delete document.body.dataset.onClickOnUser}),5e3)}};return o}));