define("DS/XCT3DPlayIntegratability/CRC_32",["UWA/Class"],(function(e){"use strict";return e.extend({init:function(){},crc32_generate:function(e){var t,i,a,s=[];for(t=0;t<256;t++){for(a=t,i=8;i>0;i--)1==(1&a)?a=a>>>1^e:a>>>=1;s[t]=a}return s},crc32_initial:function(){return 4294967295},crc32_add_byte:function(e,t,i){return t=t>>>8^e[i^255&t]},crc32_final:function(e){return e=(e=~e)<0?4294967295+e+1:e},crc32_compute_string:function(e,t){var i,a=this.crc32_generate(e),s=0;for(s=this.crc32_initial(),i=0;i<t.length;i++)s=this.crc32_add_byte(a,s,t.charCodeAt(i));return s=this.crc32_final(s)},crc32_compute_buffer:function(e,t){var i,a=new DataView(t),s=this.crc32_generate(e),r=0;for(r=this.crc32_initial(),i=0;i<a.byteLength;i++);return r=this.crc32_add_byte(s,r,a.getUint8(i)),r=this.crc32_final(r)},crc32_reverse:function(e){var t,i=0;for(t=0;t<32;t++)i<<=1,i|=e>>>t&1;return i},calcCRC:function(e){return this.crc32_compute_string(3988292384,e)}})})),define("DS/XCT3DPlayIntegratability/XCTStandalonePlayerAPI",["UWA/Core","UWA/Class","DS/Selection/HSOManager","DS/Selection/PSOManager","DS/WebUtils/ContextedSingleton","DS/WebappsUtils/Utils","DS/WebSystem/BrowserInfos","DS/WebSystem/MemoryInfo","DS/XCTInfNotifications/XCTInfNotifications","i18n!DS/XCT3DPlayIntegratability/assets/nls/XCT3DPlayIntegratability","DS/Visualization/SceneGraphUtils"],(function(e,t,i,a,s,r,n,o,l,g,c){"use strict";return t.extend({init:function(e,t,i){this._integratability=e,this._player3DPlay=e.args.options.helper||s.get(e.args.ctx,"helper"),this._player=e.player,this._ID=e.args.input.ID,this._playOptions=e.args.options.playOptions,this._multiViewer=!e.args.visu||e.args.visu.multiViewer,this._experienceName=t,this._type="",this._ready=!1,this._mediaInspector=i,this._downSampling=void 0,this._actorsAssetsList=null,this._materialsAssetsList=null,this._environmentsAssetsList=null,this._resourcesAssetsList=null,this._onExperienceReadyListener=this._onExperienceReady.bind(this),window.document.addEventListener("ExperienceReady",this._onExperienceReadyListener,!1),this._onMessageListener=this._onMessage.bind(this),window.addEventListener("message",this._onMessageListener,!1),this.registerConfigurationSwitchHandle=null,this._mapVariantModelEvents={},this._variantCostToBeSend=0},_getExperienceBase:function(){return this._experienceBase},_onExperienceReady:function(e){var t;if(e.detail.experienceLoaded&&(e.detail.experienceLoaded.args?t=e.detail.experienceLoaded.args.input.ID:(t=e.detail.experienceLoaded._experienceBase.webApplication.options.input.ID,this._experienceBase=e.detail.experienceLoaded._experienceBase),t===this._ID)){this._type=e.detail.type,this._ready=!0,"3D"===this._type&&this._setVisuDefaultOptions(),"2.5D"===this._type&&(this._mediaInspector.authoringApplication={name:"3DEXCITE xStudio"},this._set25DDefaultUI());var i={type:this._type,authoringApplication:this._mediaInspector.authoringApplication,canvasId:this._getCanvasID()};if(this._trigger("ExperienceReady",i),""!==this._integratability._serverUrl&&(this.registerConfigurationSwitchHandle=setInterval(this.registerConfigurationSwitch.bind(this),1e4)),this._getExperienceBase()){var a=this._getExperienceBase().getManager("APIPlayerManager");a&&a.addVariantListener&&a.addVariantListener(this)}}},_trigger(e,t){var i={protocol:"ExperienceCommunication",playerID:this._ID,action:e,params:t};window.parent.postMessage(i,"*")},_onMessage(e){if(this._ready&&e&&e.data&&"ExperienceCommunication"===e.data.protocol){if(this._ID!==e.data.playerID)return;if(e.data){var t=e.data.action,i=e.data.params;"load"===t?this._load(i.path,i.options):"play"===t?this._play():"pause"===t?this._pause():"stop"===t?this._stop():"mute"===t?this._mute():"unMute"===t?this._unMute():"play25DVariant"===t?this._play25DVariant(i.index):"get25DVariants"===t?this._get25DVariants():"get25DVariantsNumber"===t?this._get25DVariantsNumber():"showImmersiveHelp"===t?this._showImmersiveHelp(i.show):"showVariantGUI"===t?this._showVariantGUI(i.show):"playAct"===t?this._playActByName(i.name):"getActs"===t?this._getActs():"getTwinVariants"===t?this._getTwinVariants(i.twinName):"getTwinInstances"===t?this._getTwinInstances():"getTwinVariantValue"===t?this._getTwinVariantValue(i.twinName,i.variantName):"getActsNumber"===t?this._getActsNumber():"setTwinVariantValue"===t?this._setTwinVariantValue(i.twinName,i.variantName,i.variantValue):"playScene"===t?this._playSceneByName(i.name):"getScenes"===t?this._getScenes():"getScenesNumber"===t?this._getScenesNumber():"getActsFromScene"===t?this._getActsFromScene(i.name):"playActOfScene"===t?this._playActOfScene(i.sceneName,i.actName):"playPermanentAct"===t?this._playPermanentActByName(i.name):"getPermanentActs"===t?this._getPermanentActs():"getPermanentActsNumber"===t?this._getPermanentActsNumber():"highlight"===t?this._highlight(i.id,i.mode,i.reset):"show"===t?this._show(i.id,i.mode):"getActorInfos"===t?this._getActorInfos(i.id,i.type):"showFPS"===t?this._showFPS(i.show):"showVisuDebugInfos"===t?this._showVisuDebugInfos(i.show):"setTransparentBackground"===t?this._setTransparentBackground(i.transparentBackground):"setVisuOptionsPreset"===t?this._setVisuOptionsPreset(i.preset):"setVisuOptionsAdvanced"===t?this._setVisuOptionsAdvanced(i.options):"setAntiAliasing"===t?this._setAntiAliasing(i.aa,i.mode):"setFlakesQuality"===t?this._setFlakesQuality(i.quality,i.mode):"setOIT"===t?this._setOIT(i.oit,i.mode):"setSSAO"===t?this._setSSAO(i.ssao,i.mode):"setShadow"===t?this._setShadow(i.shadow,i.mode):"setShadowQuality"===t?this._setShadowQuality(i.quality,i.mode):"setMirror"===t?this._setMirror(i.mirror,i.mode):"setGroundShadow"===t?this._setGroundShadow(i.groundShadow,i.mode):"setBloom"===t?this._setBloom(i.bloom,i.mode):"setTriLights"===t?this._setTriLights(i.triLights,i.mode):"setLightParameters"===t?this._setLightParameters(i.intensity,i.lightIndex,i.color):"setDirectionalLight"===t?this._setDirectionalLight(i.latitude,i.longitude,i.color,i.intensity):"setAmbientLight"===t?this._setAmbientLight(i.color):"setPixelCulling"===t?this._setPixelCulling(i.pixelCulling,i.mode):"setRoughnessMap"===t?this._setRoughnessMap(i.path):"xHvisibilityImmersiveGUI"===t?this._xHvisibilityImmersiveGUI(i.bool):"xHplayPause"===t?this._xHplayPause(i.bool):"xHplayFromStart"===t?this._xHplayFromStart():"xHgetScenes"===t?this._xHgetScenes():"xHplayScene"===t?this._xHplayScene(i):"getInfos"===t?this._getInfos(i.infos):"getConsoleMessages"===t?this._getConsoleMessages():"setNotification"===t&&this._setNotification(i.message,i.mode)}}},_getCanvasID:function(){if(this._player&&this._getExperienceBase()){var e=this._getExperienceBase().getManager("CAT3DXVisuManager");if(e&&e.getViewer()&&e.getViewer().canvas)return e.getViewer().canvas.id}return"canvasNotFound"},_showFPS:function(e){if(this._player&&this._getExperienceBase()){var t=this._getExperienceBase().getManager("CAT3DXVisuManager");t&&t.getViewer().setDebugFPS(e,60)}},_showVisuDebugInfos:function(e){if(this._player&&this._getExperienceBase()){var t=this._getExperienceBase().getManager("CAT3DXVisuManager");t&&(t.getViewer().showInfos(e,986895),t.getViewer().showNodeCounter(e,986895),t.getViewer().showPerfo(e,!0,0,null,!1))}},_setVisuDefaultOptions:function(){if(this._player&&this._getExperienceBase()){var e=this._getExperienceBase().getManager("CAT3DXVisuManager");if(e){e.getViewer().setMaterialMode(!0),e.getViewer().setRenderMode("@Edge",!1),e.getViewer().setRenderMode("@Point",!1),e.getViewer().setRenderMode("@InternalEdge",!1),e.getViewer().setFlakesQuality("Medium"),e.getViewer().setGrid(!1),e.getViewer().displayInfinitePlane(!1),e.getViewer().setAntiAliasing("MSAA","static");let t=e.getViewer().currentViewpoint;t&&t.setPixelCulling(3),e.getViewer().setManipulators({preActivate:!1}),e.getViewer().setSmallRenderTargetPicking(!0),this._playOptions&&!1===this._playOptions.smallRenderTargetPicking&&e.getViewer().setSmallRenderTargetPicking(this._playOptions.smallRenderTargetPicking);let i=Math.min(1,1/window.devicePixelRatio);this._downSampling=i<=.5?1.4*i:i+.4*(1-Math.sqrt(2*(i-.5)))*i,this._downSampling=Math.round(100*this._downSampling)/100,e.getViewer().setDownsamplingFactor(this._downSampling),this._playOptions&&this._playOptions.visuOptionsPreset&&("Low"!==this._playOptions.visuOptionsPreset&&"Medium"!==this._playOptions.visuOptionsPreset&&"High"!==this._playOptions.visuOptionsPreset||this._setVisuOptionsPreset(this._playOptions.visuOptionsPreset))}}},_set25DDefaultUI:function(){this._playOptions&&!1===this._playOptions.showImmersiveHelp&&this._showImmersiveHelp(!1),this._playOptions&&!1===this._playOptions.showVariantGUI&&this._showVariantGUI(!1)},_setVisuDefaultLights:function(){if(this._player&&this._getExperienceBase()){var e=this._getExperienceBase().getManager("CAT3DXVisuManager");e&&(e.getViewer().setAmbientLight(12632256),e.getViewer().setTriLights(!0),e.getViewer().setDirectionalLight(.3,.6,16777215,2))}},_load:function(e,t){var i="";if(e.asset&&e.asset.format)i=e.asset.format;else{i=/(?:\.([^.]+))?$/.exec(e)[1]}i&&(i=i.toLowerCase()),"dsxm"===i||"dsxmb"===i?this._player&&this._player3DPlay&&this._player3DPlay.loadAsset(e,t):l.showError(g.error_format_not_supported)},_play:function(){if(this._player&&this._getExperienceBase()){var e=this._getExperienceBase().getManager("XCTCreativeExperiencePlayerAPIManager");if(e){var t=this;e.play().done((function(){t._trigger("onPlay")}))}else this._trigger("onPlay")}},_pause:function(){if(this._player&&this._getExperienceBase()){var e=this._getExperienceBase().getManager("XCTCreativeExperiencePlayerAPIManager");if(e){var t=this;e.pause().done((function(){t._trigger("onPause")}))}else this._trigger("onPause")}},_stop:function(){if(this._player&&this._getExperienceBase()){var e=this._getExperienceBase().getManager("XCTCreativeExperiencePlayerAPIManager");if(e){var t=this;e.stop().done((function(){t._trigger("onStop")}))}else this._trigger("onStop")}},_mute:function(){if(this._player&&this._getExperienceBase()){var e=this._getExperienceBase().getManager("XCTCreativeExperiencePlayerAPIManager");if(e){e.muteAll(),this._trigger("onMute")}}},_unMute:function(){if(this._player&&this._getExperienceBase()){var e=this._getExperienceBase().getManager("XCTCreativeExperiencePlayerAPIManager");if(e){e.unmuteAll(),this._trigger("onUnMute")}}},_get25DVariants:function(){if(this._player&&this._player.api){for(var e=this._player.api.getVariants(),t=[],i=0;i<e.length;i++)t.push(e[i].name);var a={variants:t};this._trigger("onGet25DVariants",a)}},_get25DVariantsNumber:function(){if(this._player&&this._player.api){var e={number:this._player.api.getVariants().length};this._trigger("onGet25DVariantsNumber",e)}},_play25DVariant:function(e){this._player&&this._player.api&&this._player.api.setVariant(e)},_showImmersiveHelp:function(e){this._player&&this._player.api&&this._player.api.setImmersiveHelpVisibility(e)},_showVariantGUI:function(e){this._player&&this._player.api&&this._player.api.setVariantGUIVisibility(e)},_getActs:function(){if(this._player&&this._getExperienceBase()){var e=this._getExperienceBase().getManager("XCTCreativeExperiencePlayerAPIManager");if(e){var t={acts:e.getPermanentActs()};this._trigger("onGetActs",t)}}},_getTwinVariants:function(e){var t=[];if(this._player&&this._getExperienceBase()){var i=this._getExperienceBase().getManager("APIPlayerManager");i&&(t=i.getTwinVariants(e),this._trigger("onGetTwinVariants",t))}},_getTwinInstances:function(){var e=[];if(this._player&&this._getExperienceBase()){var t=this._getExperienceBase().getManager("APIPlayerManager");t&&(e=t.getTwinInstances(),this._trigger("onGetTwinInstances",e))}},_getTwinVariantValue:function(e,t){var i;if(this._player&&this._getExperienceBase()){var a=this._getExperienceBase().getManager("APIPlayerManager");a&&(i=a.getTwinVariantValue(e,t),this._trigger("onGetTwinVariantValue",i))}},_setTwinVariantValue:function(e,t,i){if(this._player&&this._getExperienceBase()){var a=this._getExperienceBase().getManager("APIPlayerManager");a&&a.setTwinVariantValue(e,t,i)}},_getActsNumber:function(){if(this._player&&this._getExperienceBase()){var e=this._getExperienceBase().getManager("XCTCreativeExperiencePlayerAPIManager");if(e){var t=e.getPermanentActs();if(t){var i={number:t.length};this._trigger("onGetActsNumber",i)}}}},_playActByName:function(e){if(this._player&&this._getExperienceBase()){var t=this._getExperienceBase().getManager("XCTCreativeExperiencePlayerAPIManager");t&&t.playPermanentAct(e)}},_getScenes:function(){if(this._player&&this._getExperienceBase()){var e=this._getExperienceBase().getManager("XCTCreativeExperiencePlayerAPIManager");if(e){var t={scenes:e.getScenes()};this._trigger("onGetScenes",t)}}},_getScenesNumber:function(){if(this._player&&this._getExperienceBase()){var e=this._getExperienceBase().getManager("XCTCreativeExperiencePlayerAPIManager");if(e){var t=e.getScenes();if(t){var i={number:t.length};this._trigger("onGetScenesNumber",i)}}}},_playSceneByName:function(e){if(this._player&&this._getExperienceBase()){var t=this._getExperienceBase().getManager("XCTCreativeExperiencePlayerAPIManager");t&&t.playScene(e)}},_getActsFromScene:function(e){if(this._player&&this._getExperienceBase()){var t=this._getExperienceBase().getManager("XCTCreativeExperiencePlayerAPIManager");if(t){var i={acts:t.getActsFromScene(e)};this._trigger("onGetActsFromScene"+e,i)}}},_playActOfScene:function(e,t){if(this._player&&this._getExperienceBase()){var i=this._getExperienceBase().getManager("XCTCreativeExperiencePlayerAPIManager");if(i){if(i.getCurrentScene()!==e&&(i.playScene(e),i.getCurrentActFromCurrentScene()===t))return;i.playActFromCurrentScene(t)}}},_getPermanentActs:function(){if(this._player&&this._getExperienceBase()){var e=this._getExperienceBase().getManager("XCTCreativeExperiencePlayerAPIManager");if(e){var t={acts:e.getPermanentActs()};this._trigger("onGetPermanentActs",t)}}},_getPermanentActsNumber:function(){if(this._player&&this._getExperienceBase()){var e=this._getExperienceBase().getManager("XCTCreativeExperiencePlayerAPIManager");if(e){var t=e.getPermanentActs();if(t){var i={number:t.length};this._trigger("onGetPermanentActsNumber",i)}}}},_playPermanentActByName:function(e){if(this._player&&this._getExperienceBase()){var t=this._getExperienceBase().getManager("XCTCreativeExperiencePlayerAPIManager");t&&t.playPermanentAct(e)}},_xHvisibilityImmersiveGUI:function(e){this._getExperienceBase().getManager("VCXAPIManager").setVisibilityImmersiveNav(e)},_xHplayPause:function(e){this._getExperienceBase().getManager("VCXAPIManager").setPlayPauseStatus(e)},_xHplayFromStart:function(){let e=this._getExperienceBase().getManager("VCXAPIManager");e.GoToFirstScenario(),e.setPlayPauseStatus(!0)},_xHgetScenes:function(){let e=this._getExperienceBase().getManager("VCXAPIManager").GetScenarios(),t=[];for(const i of e)t.push({id:i.id,name:i.name});this._trigger("on_xHgetScenes",t)},_xHplayScene:function(e){this._getExperienceBase().getManager("VCXAPIManager").GoToScenario(e)},_setTransparentBackground:function(e){if(this._player&&this._getExperienceBase()){var t=this._getExperienceBase().getManager("CAT3DXVisuManager");t&&(e?(this.previousVisu=this.previousVisu||{},this.previousVisu.transparentBk={},this.previousVisu.transparentBk.ambienceActivated=t.getViewer().ambience.getBackground().isActivated(),this.previousVisu.transparentBk.grid=t.getViewer().getGrid(),this.previousVisu.transparentBk.color=t.getViewer().bgColor,this.previousVisu.transparentBk.alpha=t.getViewer().bgAlpha,t.getViewer().ambience.getBackground().setActivated(!1),t.getViewer().setGrid(!1),t.getViewer().setBackgroundColor("rgb(0,0,0)","0")):this.previousVisu&&this.previousVisu.transparentBk&&(t.getViewer().ambience.getBackground().setActivated(this.previousVisu.transparentBk.ambienceActivated),t.getViewer().setGrid(this.previousVisu.transparentBk.grid),t.getViewer().setBackgroundColor(this.previousVisu.transparentBk.color,this.previousVisu.transparentBk.alpha)))}},_setVisuOptionsPreset:function(e){if(this._player&&this._getExperienceBase()){var t=this._getExperienceBase().getManager("CAT3DXVisuManager");if(t){let i=t.getViewer().currentViewpoint;"Low"===e?(i&&i.setPixelCulling(4.5),t.getViewer().setAntiAliasing("FXAA","dynamic"),t.getViewer().setSSAO(!1),t.getViewer().setFlakesQuality("Low"),t.getViewer().setShadowQuality("Low"),t.getViewer().setShadow(!1)):"Medium"===e?(i&&i.setPixelCulling(3),t.getViewer().setAntiAliasing("SSAA","dynamic"),t.getViewer().setSSAO(!0),t.getViewer().setFlakesQuality("Medium"),t.getViewer().setShadow(!0),t.getViewer().setShadowQuality("Medium")):"High"===e&&(i&&i.setPixelCulling(3),t.getViewer().setAntiAliasing("SSAA","dynamic"),t.getViewer().setSSAO(!0),t.getViewer().setFlakesQuality("High"),t.getViewer().setShadow(!0),t.getViewer().setShadowQuality("High")),t.getViewer().render()}}},_setVisuOptionsAdvanced:function(t){if(this._player&&this._getExperienceBase()){var s,r;if(!0===t.lights&&this._setVisuDefaultLights(),void 0!==t.useShadowMap&&(s=this._getExperienceBase().getManager("CAT3DXVisuManager"))&&(s.getViewer().useShadowMap=t.useShadowMap),void 0!==t.grid&&(s=this._getExperienceBase().getManager("CAT3DXVisuManager"))&&s.getViewer().setGrid(t.grid),void 0!==t.ground&&(s=this._getExperienceBase().getManager("CAT3DXVisuManager"))&&s.getViewer().displayInfinitePlane(t.ground,!0),void 0!==t.downsamplingFactor&&(s=this._getExperienceBase().getManager("CAT3DXVisuManager"))&&(this._downSampling=t.downsamplingFactor,s.getViewer().setDownsamplingFactor(this._downSampling)),void 0!==t.ambiance&&(s=this._getExperienceBase().getManager("CAT3DXVisuManager"))&&(!1===t.ambiance?s.getViewer().removeAmbience():s.getViewer().restoreAmbiance()),void 0!==t.renderMode&&(s=this._getExperienceBase().getManager("CAT3DXVisuManager"))&&(s.getViewer().setVisuShadingMode(t.renderMode),s.getViewer().render()),void 0!==t.backFaceCulling&&(s=this._getExperienceBase().getManager("CAT3DXVisuManager"))&&(s.getViewer().setDisableBackFaceCulling(!t.backFaceCulling),s.getViewer().render()),void 0!==t.ssr&&(s=this._getExperienceBase().getManager("CAT3DXVisuManager"))&&(s.getViewer().setSSLR(t.ssr),s.getViewer().render()),void 0!==t.displayBBox&&(s=this._getExperienceBase().getManager("CAT3DXVisuManager"))&&(a.empty(!0),i.empty(!0),s.getViewer().render(),s.getViewer().debugLocalBBox=t.displayBBox,s.getViewer().render()),t.rotatePerfos&&(s=this._getExperienceBase().getManager("CAT3DXVisuManager"))&&(r=s.getViewer().currentViewpoint)){let e=3;t.nbLoop&&(e=t.nbLoop);let i=1e4;t.duration&&(i=t.duration),r.rotateCameraForPerfos(e,i,!1)}if(t.zoomPerfos&&(s=this._getExperienceBase().getManager("CAT3DXVisuManager"))&&(r=s.getViewer().currentViewpoint)){let e=1e4;t.duration&&(e=t.duration),r.zoomCameraInAndOutForPerfos(e,!1)}if(t.screenCapture&&(s=this._getExperienceBase().getManager("CAT3DXVisuManager"))){let t=s.getViewer(),i=t.SCREEN_WIDTH,a=t.SCREEN_HEIGHT,r={data:null,width:i,height:a};t.renderToTarget(r,t.currentViewpoint,!1,{AntiAliasing:"MSAA",IterativeSSAO:!0,NbIterations:32});let d=e.createElement("canvas");d.width=i,d.height=a;var n=d.getContext("2d");let u=n.createImageData(i,a);for(var o=u.data,l=4*i,g=0;g<a;g++)for(var c=g*i*4,h=(a-1-g)*i*4,p=l;p--;)o[c+p]=r.data[h+p];n.putImageData(u,0,0),d.toBlob((function(e){let t=window.URL.createObjectURL(e),i=document.createElement("a");document.body.appendChild(i),i.style="display: none",i.href=t,i.download="myCapture",i.click(),setTimeout((()=>{document.body.removeChild(i),window.URL.revokeObjectURL(t)}),100)}),"image/webp")}}},_setAntiAliasing:function(e,t){if(this._player&&this._getExperienceBase()){var i=this._getExperienceBase().getManager("CAT3DXVisuManager");i&&(i.getViewer().setAntiAliasing(e,t),i.getViewer().render())}},_setFlakesQuality:function(e,t){if(this._player&&this._getExperienceBase()){var i=this._getExperienceBase().getManager("CAT3DXVisuManager");i&&(i.getViewer().setFlakesQuality(e,t),i.getViewer().render())}},_setOIT:function(e,t){if(this._player&&this._getExperienceBase()){var i=this._getExperienceBase().getManager("CAT3DXVisuManager");i&&(i.getViewer().setOIT(e,t),i.getViewer().render())}},_setSSAO:function(e,t){if(this._player&&this._getExperienceBase()){var i=this._getExperienceBase().getManager("CAT3DXVisuManager");i&&(i.getViewer().setSSAO(e,t),i.getViewer().render())}},_setShadow:function(e,t){if(this._player&&this._getExperienceBase()){var i=this._getExperienceBase().getManager("CAT3DXVisuManager");i&&(i.getViewer().setShadow(e,t),i.getViewer().render())}},_setShadowQuality:function(e,t){if(this._player&&this._getExperienceBase()){var i=this._getExperienceBase().getManager("CAT3DXVisuManager");i&&(i.getViewer().setShadowQuality(e,t),i.getViewer().render())}},_setMirror:function(e,t){if(this._player&&this._getExperienceBase()){var i=this._getExperienceBase().getManager("CAT3DXVisuManager");i&&(i.getViewer().setMirror(e,t),i.getViewer().render())}},_setGroundShadow:function(e,t){if(this._player&&this._getExperienceBase()){var i=this._getExperienceBase().getManager("CAT3DXVisuManager");i&&(i.getViewer().setShadowPlane(e),i.getViewer().setGroundShadow(e,t),i.getViewer().render())}},_setBloom:function(e,t){if(this._player&&this._getExperienceBase()){var i=this._getExperienceBase().getManager("CAT3DXVisuManager");i&&(i.getViewer().setBloom(e,t),i.getViewer().render())}},_setTriLights(e){if(this._player&&this._getExperienceBase()){var t=this._getExperienceBase().getManager("CAT3DXVisuManager");t&&(t.getViewer().setTriLights(e),t.getViewer().render())}},_setLightParameters(e,t,i){if(this._player&&this._getExperienceBase()){var a=this._getExperienceBase().getManager("CAT3DXVisuManager");if(a){var s={intensity:e,lightIndex:t,color:i};a.getViewer().setLightParameters(s),a.getViewer().render()}}},_setDirectionalLight(e,t,i,a){if(this._player&&this._getExperienceBase()){var s=this._getExperienceBase().getManager("CAT3DXVisuManager");s&&(s.getViewer().setDirectionalLight(e,t,i,a),s.getViewer().render())}},_setAmbientLight(e){if(this._player&&this._getExperienceBase()){var t=this._getExperienceBase().getManager("CAT3DXVisuManager");t&&(t.getViewer().setAmbientLight(e),t.getViewer().render())}},_setPixelCulling(e,t){if(this._player&&this._getExperienceBase()){var i=this._getExperienceBase().getManager("CAT3DXVisuManager");if(i){let a=i.getViewer().currentViewpoint;a&&(a.setPixelCulling(e,t),i.getViewer().render())}}},_setRoughnessMap(e){if(this._player&&this._getExperienceBase()){var t=this._getExperienceBase().getManager("CAT3DXVisuManager");if(t){var i=t.getViewer().ambience;i&&i.setRoughnessMap({url:e,hdr:!0})}}},_getExperienceObjectFromId:function(e,t,i){for(var a=0;a<i.length;a++){var s=i[a];if(s.experienceObject.GetID()===t)return s.experienceObject}},_highlight:function(e,t,s){if(this._player&&this._getExperienceBase()&&this._actorsAssetsList){if(e&&!s||(1===t?a.empty(!0):i.empty(!0)),!e)return;var r=this._getExperienceObjectFromId(this,e,this._actorsAssetsList);if(r){var n=[],o=r.QueryInterface("CATI3DGeoVisu");if(o&&o.Is3DNodeAttachedToSceneGraph()){var l=o.GetPathElement(),g=o.GetLocalNodes();g&&(l=l.clone()).externalPath.push(g),n.push({pathElement:l})}1===t?a.add(n):i.add(n);let e=this._getExperienceBase().getManager("CAT3DXVisuManager");e&&e.getViewer().render()}}},_showVisibilityOverride:function(e,t,i){if(!t)return;let a=t.QueryInterface("CATI3DGeoVisu");if(!a||!a.Is3DNodeAttachedToSceneGraph())return;var s=a.GetPathElement(),r=a.GetLocalNodes();r&&(s=s.clone()).externalPath.push(r);let n=e.getUniqueOverrideFromPathElement(s);if(!n){let t=e.getOverridesFromPathElement(s);n=t?t[0]:e.createOverride(s)}n&&("show"===i?(n.setVisibility(!0),n.getOpacity()&&n.resetOpacity()):"ghost"===i?n.setOpacity(.07,!0):"hide"===i&&n.setVisibility(!1))},_show:function(e,t){if(this._player&&this._getExperienceBase()&&this._actorsAssetsList){if(!e)return;let s=!1;t.startsWith("gp")&&(s=!0,t=t.slice(2));let r=this._getExperienceBase().getManager("CAT3DXVisuManager");if(r){var i=this._getExperienceObjectFromId(this,e,this._actorsAssetsList);if(i){var a=r.getOverrideSet();if(this._showVisibilityOverride(a,i,t),s){let e=i.QueryInterface("CATI3DExperienceObject");e.SetValueByName("visible",t);let s=e.GetParent();for(;s;)this._showVisibilityOverride(a,s,t),e=s.QueryInterface("CATI3DExperienceObject"),e.SetValueByName("visible",t),s=e.GetParent()}}r.getViewer().render()}}},_getActorInfos:function(e,t){var i=function(e,t){e&&e.image&&(t.width<e.image.width&&(t.width=e.image.width),t.height<e.image.height&&(t.height=e.image.height))};let a=!1;if("material"===t)if("materials.3dx"===e||"materials.3dxc"===e){let t=!1,i={},a=this._getExperienceBase().getManager("CAT3DXVisuManager");if(a){let e=a.getViewer();if(e&&e.materialManager&&e.materialManager.CGRSharedMaterials){if(t=!0,e.materialManager.CGRSharedMaterials.size>0){var s={};for(const t of e.materialManager.CGRSharedMaterials.values())void 0!==s[t.getType()]?s[t.getType()]=s[t.getType()]+1:s[t.getType()]=1;i.types=s}}}i.loaded=t,this._trigger("onGetActorInfos"+e,i)}else{var r=this._getExperienceObjectFromId(this,e,this._materialsAssetsList);if(r){a=!0;let t=!1,s={},n=r.QueryInterface("CATI3DXMaterialAsset");if(n&&n._material){t=!0,s.type=n._material.getType();let e={width:0,height:0};i(n._material.map,e),i(n._material.bumpMap,e),i(n._material.clearCoatMap,e),i(n._material.envMap,e),i(n._material.normalMap,e),i(n._material.roughnessMap,e),i(n._material.sheenMap,e),i(n._material.specularMap,e),i(n._material.translucencyMap,e),i(n._material.transparencyMap,e),s.maxWidth=e.width,s.maxHeight=e.height}s.loaded=t,this._trigger("onGetActorInfos"+e,s)}}else if("environment"===t){var n=this._getExperienceObjectFromId(this,e,this._environmentsAssetsList);if(n){a=!0;let t=!1,i={},s=n.QueryInterface("CATI3DXAmbienceAsset");if(s&&s._ambience){t=!0;let e=s._ambience.getIblMap();e&&e.image&&(i.iblWidth=e.image.width,i.iblHeight=e.image.height);let a=s._ambience.getBackground();if(a&&a.getImage){let e=a.getImage();if(e&&e.getTexture){let t=e.getTexture();t&&t.image&&(i.backgroundWidth=t.image.width,i.backgroundHeight=t.image.height)}}}i.loaded=t,this._trigger("onGetActorInfos"+e,i)}}else if("resource"===t){var o=this._getExperienceObjectFromId(this,e,this._resourcesAssetsList);if(o){a=!0;let t=!1,i={},s=o.QueryInterface("CATI3DXAssetHolder");if(s&&s._asset&&s._asset._name){let e=/[.]/.exec(s._asset._name)?/[^.]+$/.exec(s._asset._name):"";""!==e&&(i.extension=e)}let r=o.QueryInterface("CATI3DXSoundResourceAsset");r&&(r._sound?(t=!0,i.extension=r._fileSoundExtension):i.extension="sound not loaded");let n=o.QueryInterface("CATI3DXPictureResourceAsset");n&&n._picture&&(t=!0,i.width=n._picture.width,i.height=n._picture.height),i.loaded=t,this._trigger("onGetActorInfos"+e,i)}}if(!a){let t={Actor:"Not found"};this._trigger("onGetActorInfos"+e,t)}},async _getInfos(e){let t,i=[],a=function(t){return"object"==typeof e?e.includes(t):e===t},s=function(t,a){"object"==typeof e?i[t]=a:i=a},l="visu.render";if(a(l)&&this._player&&this._getExperienceBase()&&(t=this._getExperienceBase().getManager("CAT3DXVisuManager"),t)){let e=t.getViewer(),i=e.getInfos().render,a=Object.assign({},i);a.lights=e.getLightInfos().totalCount,a.triangles=c.getTrianglesCount(e.getRootNode(),!0),s(l,a)}if(l="visu.hardwarePCS",a(l)&&this._player&&this._getExperienceBase()&&(t=this._getExperienceBase().getManager("CAT3DXVisuManager"),t)){let e=t.getViewer();s("visu.hardwarePCS",await e.getQMDefaultProfileEquivalent())}if(l="visu.lights",a(l)&&this._player&&this._getExperienceBase()&&(t=this._getExperienceBase().getManager("CAT3DXVisuManager"),t&&s(l,t.getViewer().getLightInfos())),l="visu.memory",a(l)&&this._player&&this._getExperienceBase()&&(t=this._getExperienceBase().getManager("CAT3DXVisuManager"),t&&s(l,t.getViewer().getInfos().memory)),l="visu.downsampling",a(l)&&s(l,this._downSampling),l="media.inspector",a(l)&&s(l,JSON.stringify(this._mediaInspector)),l="media.size",a(l)&&s(l,this._mediaInspector.mediaSize),l="media.authoringApplication",a(l)&&s(l,this._mediaInspector.authoringApplication),l="media.formatVersion",a(l)&&s(l,this._mediaInspector.formatVersion),l="media.playerVersion",a(l)&&s(l,this._mediaInspector.playerVersion),l="media.creationDate",a(l)&&s(l,this._mediaInspector.creationDate),l="media.downloadTimes",a(l)){s(l,{startDownloadTime:this._mediaInspector.startDownloadTime,downloadTime:this._mediaInspector.downloadTime})}if(l="experience.assets",a(l)&&this._player&&this._getExperienceBase()){var g=this._getExperienceBase().getManager("APIPlayerManager");if(g){var h=function(e){var t=0;if(e.mesh3js&&e.mesh3js.geometry&&"Mesh3D"===e.getNodeType())for(var i=0;i<e.mesh3js.geometry.length;i++)for(var a=e.mesh3js.geometry[i]?e.mesh3js.geometry[i].drawingGroups:null,s=a?a.length:0,r=0;r<s;r++){var n=a[r];if(n._primitives&&4===n.glType)for(var o=0;o<n.getPrimitivesCount();o++)t+=n.getPrimitiveCount(o)}else if(e.children)for(var l=0;l<e.children.length;l++)t+=h(e.children[l]);return t},p=function(e,t,i){var a=[];if(t)for(var s=0;s<t.length;s++){var r=t[s];if(r.assetLink&&""!==r.assetLink){var n={};if(n.name=r.name,n.objectId=r.experienceObject.GetID(),n.id=e._getIdFromAssetLink(r.assetLink),a.push(n),"actors"===i){var o=0,l=r.experienceObject.QueryInterface("CATI3DGeoVisu");if(l&&l._node3D&&l._node3D.children)for(var g=0;g<l._node3D.children.length;g++)""===l._node3D.children[g].name&&(o+=h(l._node3D.children[g]));n.nbTriangles=o}}}return a},d={};this._actorsAssetsList=g._listActorsAssets();var u=p(this,this._actorsAssetsList,"actors");d.actors=u,this._materialsAssetsList=g._listMaterialsAssets();var _=p(this,this._materialsAssetsList,"materials");d.materials=_,this._environmentsAssetsList=g._listEnvironmentsAssets();var m=p(this,this._environmentsAssetsList,"environments");d.environments=m,this._resourcesAssetsList=g._listResourcesAssets();var f=p(this,this._resourcesAssetsList,"resources");if(d.resources=f,t=this._getExperienceBase().getManager("CAT3DXVisuManager"),t){let e=t.getViewer();e&&e.materialManager&&e.materialManager.CGRSharedMaterials&&(d.nbSharedMaterials=e.materialManager.CGRSharedMaterials.size)}s(l,d)}}l="system.info";let y="system.info.memory";if((a(l)||a(y))&&this._player&&this._getExperienceBase()){let e={};if(a(l)){let t=n.browser.os;if(t){let i=t.name;"win"===t.name&&(i="Windows"),e.OS=i+" "+t.version}}if(a(l)||a(y)){let t=o();e["Used JS heap size (MB)"]=t}if(a(l)&&window.navigator){let t=r.clientEngine;e.Browser=t.name,e["Browser version"]=t.version;let i=r.clientPlatform;e.Mobile=n.isMobile(),e.Platform=i.name,e.Locale=navigator.language||"en-US"}a(y)&&(l=y),s(l,e)}l="webgl.info";let w="webgl.info.min";if((a(l)||a(w))&&this._player&&this._getExperienceBase()){let e={};if(t=this._getExperienceBase().getManager("CAT3DXVisuManager"),t&&t.getViewer()&&t.getViewer().canvas){let i=t.getViewer().canvas;if(e.Resolution=i.width+"x"+i.height,e.Downsampling=this._downSampling,a(l)){let a=null,s=1,r=t.getViewer().materialManager;if(r&&(a=r.getContext()),a||a||(a=i.getContext("experimental-webgl",{stencil:!0}),s=1),a){let t=a.getExtension("WEBGL_debug_renderer_info");if(e["Dbg vendor"]=a.getParameter(t.UNMASKED_VENDOR_WEBGL),e["Dbg renderer"]=a.getParameter(t.UNMASKED_RENDERER_WEBGL),e.Version=a.getParameter(a.VERSION),e.Renderer=a.getParameter(a.RENDERER),e["Shading language version"]=a.getParameter(a.SHADING_LANGUAGE_VERSION),e["Depth bits"]=a.getParameter(a.DEPTH_BITS),e["Stencil bits"]=a.getParameter(a.STENCIL_BITS),e["Max texture image units"]=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),e["Max texture size"]=a.getParameter(a.MAX_TEXTURE_SIZE),s>1)e["Draw buffers"]=!0,e["Depth texture"]=!0;else{var v=a.getExtension("WEBGL_draw_buffers");e["Draw buffers"]=null!==v;var x=a.getExtension("WEBGL_depth_texture");e["Depth texture"]=null!==x}e["Multi viewer"]=this._multiViewer}}else l=w}s(l,e)}var A={infos:i};this._trigger("onGetInfos_"+e,A)},_getConsoleMessages:function(){"undefined"!=typeof console&&(void 0!==console.log?void 0===console.olog&&(console.olog=console.log):console.olog=function(){});let e=this;console.log=function(t){console.olog(t);var i={message:t};e._trigger("onGetConsoleMessages",i)},console.error=console.warn=console.debug=console.info=console.log},_setNotification:function(e,t){"Error"===t?l.showError(e):"Warning"===t?l.showWarning(e):"Info"===t?l.showInfo(e):"Success"===t&&l.showSuccess(e)},_getIdFromAssetLink:function(e){var t=void 0;if(e){let i=e.lastIndexOf("/");-1!==i&&(t=e.substring(i+1,e.length))}return t},registerConfigurationSwitch:function(){if(0===this._variantCostToBeSend)return;let e=encodeURIComponent("NO_NAME"),t=this._variantCostToBeSend;if(""!==this._integratability._serverUrl){let i=this._integratability._serverUrl+"changeVariant?sessionID="+this._integratability._sessionID+"&variantID="+e+"&cost="+t+"&vartype=MODEL";fetch(i).then((e=>{this._variantCostToBeSend-=t})).catch((e=>{}))}},onVariantValuedEvent:function(e){if("MODEL"===e.initiator){let t=e.value.CATI3DExperienceObject.getModelObject().GetID(),i=e.variant.type;if(4===i||8===i||9===i)return;void 0===this._mapVariantModelEvents[t]?(this._mapVariantModelEvents[t]=1,this._variantCostToBeSend++):this._mapVariantModelEvents[t]++}else if("USER"===e.initiator){const t=e.variant.parent.name,i=e.variant["Alternative Name"],a=e.variant.type,s=e.value["Alternative Name"];if(""!==this._integratability._serverUrl){let e=encodeURIComponent(s),t=0,i="USER";if(""!==this._integratability._serverUrl){let a=this._integratability._serverUrl+"changeVariant?sessionID="+this._integratability._sessionID+"&variantID="+e+"&cost="+t+"&vartype="+i;fetch(a).then((e=>{})).catch((e=>{console.error("ERROR setUserVariant")}))}}if(this._player){(e=>{let t={protocol:"ExperienceMessage",playerID:this._ID,sender:"onVariantValuedEvent"};t.message=e,window.parent.postMessage(t,"*")})({twinName:t,variantAlternativeName:i,variantType:a,variantValue:s})}}},onVariantUnvaluedEvent:function(e){},clean:function(){if(this._variantCostToBeSend=0,this._mapVariantModelEvents={},this._getExperienceBase()){var e=this._getExperienceBase().getManager("APIPlayerManager");e&&e.removeVariantListener&&e.removeVariantListener(this)}this.registerConfigurationSwitchHandle&&(clearInterval(this.registerConfigurationSwitchHandle),this.registerConfigurationSwitchHandle=null),this._onExperienceReadyListener&&(window.document.removeEventListener("ExperienceReady",this._onExperienceReadyListener,!1),this._onExperienceReadyListener=null),this._onMessageListener&&(window.removeEventListener("message",this._onMessageListener,!1),this._onMessageListener=null),this._player=null,this._ID="",this._experienceName="",this._type="",this._ready=!1}})})),define("DS/XCT3DPlayIntegratability/XCTExtPlatformMediaHelpers",["UWA/Core","DS/WAFData/WAFData"],(function(e,t){"use strict";return{listStreams:function(e,i,a,s){var r=i.physicalid,n=i.serverurl,o=i.tenant,l=n+"/resources/experience/medias/"+r+"/streams"+(o?"/?tenant="+o:"");e=i.contextid?i.contextid:e,i.Play3DXContent&&i.Play3DXContent.source&&i.Play3DXContent.source.includes("X3DSEAR")&&(e=""),t.authenticatedRequest(l,{method:"GET",type:"json",headers:{"Content-Type":"application/json",SecurityContext:e},onComplete:function(e){null!=a&&a(e.results)},onFailure:function(e){null!=s&&s(e)}})},fetchStream:function(i,a,s){return new Promise((async r=>{const n=await(async(i,s)=>{const r=e.Promise.deferred(),n=a.serverurl+"/resources/experience/medias/"+i+"/streams/"+s;return t.authenticatedRequest(n,{cache:-1,method:"GET",type:"json",headers:{"Content-Type":"application/json",SecurityContext:a.contextid},onComplete:e=>{e&&e.results&&e.results[0]&&r.resolve(e.results[0]),r.reject("Cant retrieve stream "+s)},onFailure:e=>{r.reject(new Error(e))}}),r.promise})(i,s);r({url:n.fcsurl,token:"__fcs__jobTicket="+encodeURIComponent(n.ticket)})}))}}})),define("DS/XCT3DPlayIntegratability/XCT3DPlayApplication",["UWA/Class"],(function(e){"use strict";return e.extend({init:function(e){this.args=e},onPostCreate:function(e){this.args.onAppInitialize(e)},dispose:function(){},getOptions:function(){return{context:this.args.ctx,height:"100%",minHeight:void 0!==this.args.minHeight?this.args.minHeight:0,viewerOptions:this.args.visu||{},uiOptions:this.args.ui||{displayTree:!1},onModelLoaded:this.args.experience&&this.args.experience.onModelLoadingCompleted,language:this.args.lang}}})})),define("DS/XCT3DPlayIntegratability/ConfigMapping",[],(function(){"use strict";return Object.freeze({default:"DS/CXP3DPlay/CXP3DPlayAppStream",defaultStandalone:"DS/CXP3DPlay/CXP3DPlayAppFile",sequence:"DS/XCT25DExperience/XCT25DPlayApp","25D_asset":"DS/XCT25DExperience/XCT25DPlayApp"})})),define("DS/XCT3DPlayIntegratability/XCT3DPlayIntegratability",["UWA/Core","DS/XCT3DPlayIntegratability/ConfigMapping","DS/XCT3DPlayIntegratability/XCTExtPlatformMediaHelpers","DS/XCT3DPlayIntegratability/CRC_32","DS/XCT3DPlayIntegratability/XCTStandalonePlayerAPI","UWA/Class","DS/Controls/ProgressBar","DS/WebUtils/ContextedSingleton","DS/WebUtils/PhaseProgress","DS/XCTInfNotifications/XCTInfNotifications","DS/CoreEvents/Events","DS/WebSystem/Environment","DS/ZipJS/zip-fs","DS/WAFData/WAFData","DS/WebappsUtils/WebappsUtils","DS/WebApplication/WebApplication","DS/ApplicationFrame/FrameWindow3D","DS/Visualization/Node3D","DS/Utilities/Dom","i18n!DS/XCT3DPlayIntegratability/assets/nls/XCT3DPlayIntegratability","css!DS/XCT3DPlayIntegratability/assets/css/XCT3DPlayIntegratability.css","css!DS/UIKIT/UIKIT.css"],(function(e,t,i,a,s,r,n,o,l,g,c,h,p,d,u,_,m,f,y,w){"use strict";return r.extend({init:function(t){this._serverUrl="",this._sessionID=null,this.loadingBarcontainer={},this.initialized=!1,this.ctx=t.ctx,(t=t||{}).commandApplication=!1,t.experience=this,t.workbenchs=t.workbenchs||[],t.asset=t.input.asset,t.physicalId=t.input.asset.physicalid,this.args=t,this.loadAssetInfo={originalAsset:t.asset},this.callbacks={LoadingStarted:[],LoadingProgress:[],loadingFinished:[],LoadingError:[]},t.visu=t.visu?t.visu:{},!1!==t.visu.useQualityManager&&(t.visu.useQualityManager=!0),t.visu&&t.visu.clearQM&&localStorage.removeItem("QualityPresets"),t.visu&&(t.visu.visuFaceMaterialsAsPBR=!0);let i="auto";if(t.visu&&!1===t.visu.multiViewerAuto&&(i=!1),"auto"===i){var a={visu:{multiViewer:!1,multiViewerAuto:!0}};e.extend(t,a,!0)}t.options&&t.options.playOptions&&!1===t.options.playOptions.decals?localStorage.setItem("setUDLMode","false"):localStorage.setItem("setUDLMode","true"),t.options&&t.options.playOptions&&void 0!==t.options.playOptions.enableViewerForAmbience&&(!0===t.options.playOptions.enableViewerForAmbience?localStorage.setItem("CXPWeb_enableViewerForAmbience","true"):localStorage.setItem("CXPWeb_enableViewerForAmbience","false")),this._initInstance(),this._APIManager=null,this.byMeCheckDistribution="%ByMeCheckDistribution%"},_initInstance:function(){const t=Date.now();this.container=e.createElement("div",{class:"XCT3DPlayIntegratabilityContainer"}).inject(this.args.container);let i=100;this.args.options&&this.args.options.playOptions&&this.args.options.playOptions.fadeTimeOnReady&&(i=this.args.options.playOptions.fadeTimeOnReady),this.widgetContainer=e.createElement("div",{class:"testparent XCT3DPlayIntegratabilitWidget"}).inject(this.container),this.widgetContainer.setAttributes({style:`transition : filter ${i}ms; `}),this.promiseWebApplication=new Promise((e=>{this.webApplication=new _({...this.args,container:this.widgetContainer,application:"DS/XCT3DPlayIntegratability/XCT3DPlayApplication",onAppInitialize:t=>{this._experienceBase=t,this.frmWindow=t.webApplication.frmWindow,this.frmWindow.experience=this;let i=this.frmWindow.getViewer(),a=new f("rootBag");i.addNode(a),this.modelLoader={targetNode:a},e()},Async:!0,FrameWindow:m}),this.webApplication.callbackActionBar="callback"})),this.onModelLoadingProgression=e=>{this.callbacks.LoadingProgress&&this.callbacks.LoadingProgress.forEach((t=>t({ctx:this.ctx,model:void 0,progress:e})))},this.onModelLoadingCompleted=()=>{if(this.publish("ASSET/LOADINGFINISHED",{loadAssetInfo:this.args.asset}),this.args.options.splashscreen&&this.args.options.splashscreen.waitloading){o.get(this.ctx,"helper").playerSplashScreen.hide()}this.onModelLoadingProgression({loaded:100}),this.callbacks.loadingFinished&&this.callbacks.loadingFinished.forEach((e=>e({ctx:this.ctx,model:void 0,progress:{loaded:100,total:100},duration:Date.now()-t})))},this.progress={updateProgression:e=>this.onModelLoadingProgression(e),hide:()=>this.onModelLoadingCompleted()}},publish:function(e,t){c.publish({event:"/"+this.ctx+"/"+e+"/",data:t})},load:async function(e){e.asset&&(this.args.asset=e.asset,await this.dispose(),this._initInstance(),this.initExperience())},initExperience:function(){this.startLoading()},start:function(){if(this.startLoading(),!this.args.options.splashscreen||!this.args.options.splashscreen.waitloading){o.get(this.ctx,"helper").playerSplashScreen.hide()}},informActiveState:function(){},onLightboxReady:function(){},getScenarioManager:function(){return{}},subscribe:function(){},addOnScenarioChangeCB:function(){},addCallbacks:function(){},startLoading:function(){if(!this.initialized){if(this.initialized=!0,!1!==this.args.input.showProgressBar)if("3DPLAY"===this.args.input.progressBarType)this.create3DPlayLoadingBar();else this.createLoadingBar();this.loadAsset({asset:this.args.asset},this.args.options),this.publish("EXPERIENCE/EXPERIENCEREADY",this)}},dispose:async function(){this.clearView(),this.player&&await this.player.disposeExperienceBase(),this.webApplication&&this.webApplication.dispose({disposeFrameWindow:!0}),this.container&&(this.container.destroy(),this.container=null),this.initialized=!1},onPostCreate:function(){this.autoReframe=!1,this._parent(),c.publish({event:"3DPlay:Ready"})},createLoadingBar:function(){let t=100,i=.9;this.args.options&&this.args.options.playOptions&&this.args.options.playOptions.fadeTimeOnReady&&(t=this.args.options.playOptions.fadeTimeOnReady),this.args.options&&this.args.options.playOptions&&this.args.options.playOptions.loaderBackgroundOpacity&&(i=this.args.options.playOptions.loaderBackgroundOpacity),this.widgetContainer.addClassName("XCT3DPlayIntegratabilitWidgetLoading"),this.loadingBarcontainer.container=e.createElement("div",{class:"XCT3DPlayIntegratabilityLoadingBarContainer"}).inject(this.container),this.loadingBarcontainer.container.setAttributes({style:`transition : opacity ${t}ms;`}),this.loadingBarcontainer.background=e.createElement("div",{class:"XCT3DPlayIntegratabilityLoadingBarBackground"}).inject(this.loadingBarcontainer.container),this.loadingBarcontainer.background.setAttributes({style:`transition : opacity ${t}ms; background: rgba(155, 155, 155, ${i});`}),this.loadingBarcontainer.loadingBarDiv=e.createElement("div",{class:"XCT3DPlayIntegratabilityLoadingBarDiv"}).inject(this.loadingBarcontainer.container),this.loadingBarcontainer.progressBar=new n({statusFlag:!1,value:0}).inject(this.loadingBarcontainer.loadingBarDiv),this.loadingBarcontainer.statusDiv=e.createElement("div",{class:"XCT3DPlayIntegratabilityLoadingBarStatus"}).inject(this.loadingBarcontainer.loadingBarDiv),y.generateIcon({iconName:"media-collection",fontIconSize:"2x"}).inject(this.loadingBarcontainer.statusDiv),this.loadingBarcontainer.statusText=e.createElement("p",{text:"Loading..."}).inject(this.loadingBarcontainer.statusDiv),this.callbacks.LoadingProgress.push((e=>{this.loadingBarcontainer.progressBar.value=e.progress.loaded})),this.callbacks.loadingFinished.push((()=>{this.loadingBarcontainer.progressBar.emphasize="success",setTimeout((()=>{this.widgetContainer.removeClassName("XCT3DPlayIntegratabilitWidgetLoading"),this.loadingBarcontainer.container.addClassName("XCT3DPlayIntegratabilityLoadingBarContainerHidden")}),400)})),this.callbacks.LoadingStarted.push(((e,t)=>{this.loadingBarcontainer.statusText.textContent=w["media_title_"+t]}))},create3DPlayLoadingBar:function(){this.phaseProgress=new l({mode:this.args.input.mode}),this.phaseProgress.addProgressBarIntoUI(this.args.container),this.phaseProgress.showProgressBar();let e=this.phaseProgress.registerSubProgress();this.callbacks.LoadingProgress.push((t=>{this.phaseProgress.setAbsoluteProgress(e,t.progress.loaded)})),this.callbacks.loadingFinished.push((()=>{this.phaseProgress.hideProgressBar()}))},loadAssets:function(e,t){g.showInfo(w.error_loadingMultipleFiles_title),this.loadAsset({asset:e.asset[0]},t)},loadAsset:function(t,i){if(t){if(this.asset=t.asset,e.is(i.env)&&e.is(i.IBL)&&this.frmWindow._3dViewer.setEnvMap({envMap:i.env,IBLMap:i.IBL}),"FILE"===t.asset.provider&&(t.asset.format&&"dsxm"===t.asset.format.toLowerCase()||t.asset.format&&"dsxmb"===t.asset.format.toLowerCase()))return t.playOptions=i.playOptions?i.playOptions:{},void("1"===this.byMeCheckDistribution||i&&i.playOptions&&i.playOptions.checkAppDistributionURL?this.CheckDistributionAndLaunchRightPlayerFromDSXM(t,i):this.LaunchRightPlayerFromDSXM(t,i));this.LaunchRightPlayerFromStreams(t,i)}},clearView:function(){this._APIManager&&this._APIManager.clean&&this._APIManager.clean(),this._APIManager=null,this.player&&this.player.clean&&this.player.clean()},LaunchRightPlayerFromStreams:function(e,a){this.onModelLoadingProgression&&this.onModelLoadingProgression({loaded:20,total:100}),i.listStreams(e.asset.contextid,e.asset,(async s=>{this.onModelLoadingProgression&&this.onModelLoadingProgression({loaded:50,total:100});var r={index:0},n=this._getFileType(s,r),o=!1;if("dsxm"===n){o=!0;let t=await i.fetchStream(e.asset.physicalid,e.asset,s[r.index].persistencyname);return e.asset.url=t.url,e.asset.callPlatform=!0,e.asset.token=t.token,void this.LaunchRightPlayerFromDSXM(e,a)}void 0===t[n]&&(n="default"),this.LaunchDelegateClass(n,e,o)}))},_getFileType:function(e,t){if(!e)return"";for(var i="",a="",s=0;s<e.length;s++)if(-1!==(a=e[s]).persistencyname.indexOf(".json")&&(i=a.persistencyname.match(/[^.]*/i)[0],t.index=s),-1!==a.persistencyname.indexOf(".dsxm")){i="dsxm",t.index=s;break}return i},useStandalonePlayerBundles:function(){return!1},LaunchDelegateClass:async function(e,i,a,r,n,o){if(this.callbacks.LoadingStarted&&this.callbacks.LoadingStarted.forEach((t=>t(i,e))),this.useStandalonePlayerBundles()&&!o){let e="DS/3DPlayHelper/3DPlayHelper__Creative";await new Promise((t=>{require([e],(e=>t(e)))}))}let l=await new Promise((i=>{require([t[e]],(e=>i(e)))}));if(this.useStandalonePlayerBundles()&&o){let e;e=o.authoringApplication.name.toLowerCase().contains("creative")||o.authoringApplication.name.toLowerCase().contains("realistic")?"DS/3DPlayHelper/3DPlayHelper__Creative":"DS/3DPlayHelper/3DPlayHelper__xHighlight",await new Promise((t=>{require([e],(e=>t(e)))}))}await this.promiseWebApplication,this.player=new l(this,i,a),r&&(this._APIManager=new s(this,i.asset.filename,n))},CheckDistributionAndLaunchRightPlayerFromDSXM:function(e,t){let i=t.playOptions.applicationId,a=t.playOptions.distributionId;this._serverUrl="","1"===this.byMeCheckDistribution?this._serverUrl="%ByMeInfraWebServices%":t.playOptions.checkAppDistributionUR&&(this._serverUrl=t.playOptions.checkAppDistributionURL);const s=e.asset.filename;let r=encodeURIComponent(s),n=this._serverUrl+"api/3/applications/"+i+"/distributions/"+a+"?file="+r;const o=new Request(n,{method:"GET",headers:{"Content-Type":"application/json"}});let l=document.referrer;l&&""!==l||(l=window.location.href),l=l.split("/").slice(0,3).join("/").split("?").slice(0,1).join("?"),(t.playOptions&&!0===t.playOptions.expLogging||"true"===h.get("3DPlay.ExpLogging"))&&g.showInfo("BM-Origin: "+l),console.log("BM-Origin: "+l),o.headers.set("BM-Origin",l),o.headers.set("timestamp",[(new Date).toISOString().replace(/-/g,"").replace(/:/g,"").slice(0,15),"Z"].join("")),fetch(o).then((i=>{console.log("checkAppDistribution status: "+i.ok),!0===i.ok?(this._sessionID=i.headers.get("player-session"),this.LaunchRightPlayerFromDSXM(e,t)):i.json().then((e=>{g.showError(w.error_distributionCheck_title+"\n value: "+i.ok+"   status text: "+e.error.message)}))})).catch((()=>{g.showError(w.error_distributionCheck_title)}))},LaunchRightPlayerFromDSXM:function(i,a){if(!0===a.addProgressBarCallbacks){var s=(e,t)=>{var i={protocol:"ExperienceCommunication",playerID:this.args.input.ID,action:e,params:t};window.parent.postMessage(i,"*")};this.callbacks.LoadingStarted.push((e=>{var t={step:"LoadingStarted",path:e.data,progress:0};s("onLoad",t)})),this.callbacks.LoadingProgress.push((e=>{var t={step:"LoadingProgress",path:e.model,progress:e.progress};s("onLoad",t)})),this.callbacks.loadingFinished.push((e=>{var t={step:"loadingFinished",path:e.model,progress:100,duration:e.time};s("onLoad",t)})),this.callbacks.LoadingError.push((e=>{var t={step:"LoadingError",path:name,error:e};s("onLoad",t)}))}this.onModelLoadingProgression&&this.onModelLoadingProgression({loaded:20,total:100});let r=Date.now();performance.mark("EXP_Player_MediaDownload_start");let n=i.asset.url||i.asset.filename,o=!!i.asset.callPlatform;"MOBILE"===window.ds?.env&&(d.setForceProxification(!0),n=d.proxifyUrl(n,{proxy:"passport"})),d.authenticatedRequest(n,{method:o?"POST":"GET",responseType:"blob",timeout:0,headers:{Accept:"application/octet-stream"},proxy:o?"platform":void 0,data:o?i.asset.token:void 0,onProgress:t=>{if(t.lengthComputable){var i=t.loaded/t.total*50+20;this.onModelLoadingProgression&&this.onModelLoadingProgression({loaded:i,total:100})}else e.log(w.error_progress_calculation)},onComplete:s=>{performance.mark("EXP_Player_MediaDownload_end");var n="defaultStandalone",o=new p.fs.FS;p.workerScriptsPath=u.getWebappsBaseUrl()+"ZipJS/",o.importBlob(s,(()=>{i.blob=s,i.onModelLoadingProgression=this.onModelLoadingProgression,i.onModelLoadingCompleted=this.onModelLoadingCompleted;var l={geometries:{array:[]},materials:{array:[]},environments:{array:[]},resources:{array:[]}};l.mediaSize=(s.size/1048576).toFixed(2);for(var g=0,c=0,h=!1,p=0;p<o.entries.length;p++){var d=o.entries[p];if(e.is(d.name)&&d.data){var u=d.name,_=d.data.compressedSize/1024,m=parseFloat(_.toFixed(2));h||-1===u.indexOf(".json")||(n=u.match(/[^.]*/i)[0],void 0===t[n]&&(n="defaultStandalone"),h=!0,d.data.lastModDate&&(l.creationDate=d.data.lastModDate.toLocaleString()));var f={filename:u,size:m};"materials.3dx"===u||"materials.3dxc"===u?l.materials.array.push(f):-1!==u.indexOf(".xcgr")||-1!==u.indexOf(".glb")?(g+=_,l.geometries.array.push(f)):-1!==u.indexOf(".3dx")||-1!==u.indexOf(".3dxc")?l.environments.array.push(f):-1!==u.indexOf(".json")||(c+=_,l.resources.array.push(f))}}l.geometries.size=parseFloat(g.toFixed(2)),l.resources.size=parseFloat(c.toFixed(2)),performance.measure("EXP_Player_MediaDownload","EXP_Player_MediaDownload_start","EXP_Player_MediaDownload_end");let y=performance.getEntriesByName("EXP_Player_MediaDownload");l.startDownloadTime=r,l.downloadTime=(y[0].duration/1e3).toFixed(2),performance.clearMarks("EXP_Player_MediaDownload_start"),performance.clearMarks("EXP_Player_MediaDownload_end"),performance.clearMeasures("EXP_Player_MediaDownload"),this._DoIntegrityCheckAndLaunch(n,i,a,o,l)})),o.closeZipReader()},onFailure:t=>{e.log(t),g.showError(w.error_media_notfound_title)}})},_DoIntegrityCheckAndLaunch:function(t,i,s,r,n){if(i.ID||(i.ID=this.args.input.ID),"defaultStandalone"===t){for(var o=[],l=0,c=0;c<r.entries.length;c++){var p=r.entries[c];if(e.is(p.name))"manifest.json"===p.name?l=c:p.data&&o.push(p.data.uncompressedSize)}o.sort((function(e,t){return e-t}));for(var d="",u=0;u<o.length;u++)d+=o[u];r.entries[l].getText((e=>{var r="",o=void 0;if(e&&e.currentTarget&&e.currentTarget.result&&(r=e.currentTarget.result,(s.playOptions&&!0===s.playOptions.expLogging||"true"===h.get("3DPlay.ExpLogging"))&&g.showInfo(r)),""!==r&&(o=JSON.parse(r),n.authoringApplication=o.authoringApplication,n.formatVersion=o.manifestVersion,o.mediaInformation)){let e=!1;s&&s.playOptions&&s.playOptions.playerType&&(e="XR"===s.playOptions.playerType);let t=o.mediaInformation.version,i=o.mediaInformation.requiredCapabilities;if(e||("2.1.1"===t||i&&i.includes("xr"))&&g.showWarning(w.warning_geometry_format),e){if(!i&&"2.1.1"!==t)return void g.showError(w.error_geometry_format_not_supported);if(i&&!i.includes("xr"))return void g.showError(w.error_geometry_format_not_supported)}}if(window.SHARE&&window.SHARE.Core&&window.SHARE.Core.getVersion){let e="6.425.4.0";n.playerVersion=e}if("true"===h.get("3DPlay.ExpLoadNoIntegrityCheck")||s&&s.playOptions&&!0===s.playOptions.ExpLoadNoIntegrityCheck)this.LaunchDelegateClass(t,i,null,s&&!0===s.addExperienceCommunication,n,o);else{var l="0",c=!1;if(o){var p=o.mediaInformation;p&&(l=p.hash,!0!==p.bundle&&"yes"!==p.bundle||(c=!0))}if(c){var u="";window.SHARE&&window.SHARE.Core&&window.SHARE.Core.getVersion&&(u="6.425.3.0"),d=d+"experience-3ds-player"+u}l===(new a).calcCRC(d)?this.LaunchDelegateClass(t,i,null,s&&!0===s.addExperienceCommunication,n,o):(g.showError(w.error_integrityCheck_title),this.onModelLoadingCompleted&&this.onModelLoadingCompleted())}}))}else this.LaunchDelegateClass(t,i,null,s&&!0===s.addExperienceCommunication,n)}})}));