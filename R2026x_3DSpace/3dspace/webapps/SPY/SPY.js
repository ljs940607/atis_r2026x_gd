/*!  Copyright 2014 Dassault Systemes. All rights reserved. */
define("DS/SPY/CATSimNavDataDisplayAbstract",["UWA/Core","UWA/Class","DS/CoreEvents/Events"],(function(t,e,i){"use strict";var s=function(t){return t.filter((function(t){return t}))},a=function(t,e){var i=t[e],n=i.getChildren?i.getChildren():void 0;if(Array.isArray(n))if(n.length>0){var r=n[0].isExtractable,o=void 0===n[0].getChildren;if(1===n.length&&o&&r){var l=n[0],u=i.getName(),h=l.getTitle?l.getTitle():l.getName();t[e]=l,t[e].children=[],h&&0!==h.length||(t[e].name=u)}else n.forEach((function(t,e){a(n,e)})),n=s(n),i.children=n;if(n.length>1){var c=1;n.forEach((function(t){t.isExtractable&&t.getName()&&t.getName()===i.getName()&&(t.name+=" - "+t.getSuffix()+" #"+String(c),c++)}))}}else t[e]=void 0},n=e.extend({_getSortedDuplicates:function(t){for(var e=[],i=t.sort(),s=0;s<i.length-1;s++)i[s+1]===i[s]&&i[s]&&e.push(i[s]);return e},_computeScopeMinMax:function(t){var e=this.getLegend();e&&e.localMin&&e.localMax&&(t.min=Math.min.apply(null,e.localMin.slice(t.globalStart,t.globalEnd+1)),t.max=Math.max.apply(null,e.localMax.slice(t.globalStart,t.globalEnd+1)))},init:function(t,e,i){this.spm=e,this.seq=i,this.id="",this.name="Data Display",this.category="Model",this.thumbnail="",this.defaultMode="ENG",this.activated=!1,this.defaultLockStatus=!0,this.list2DViews=[],this.list3DViews=[],this.listFrameViews=[],this._listInfoImages=[],this.analytics={},this._analyticsTimeStarts={},this.impl={CATISimNavDataDisplayUI:{module:"SPYUI",ext:"CATSimNavDataDisplayUI",type:"data",obj:null},CATISimNavDataAnimation:{module:"SPYUI",ext:"CATSimNavDataDisplayAnimation",type:"data",obj:null},CATISimNavDataAnimationAVP:{module:"SMAXCTSimBridge",ext:"AVPDataDisplayAnimation",type:"data",obj:null},CATISimNavDataColorShadingManager:{module:"SPYUI",ext:"CATSimNavDataDisplayColorShadingManager",type:"data",obj:null}}},clean:function(){delete this.spm,delete this.seq,delete this.list2DViews,delete this.list3DViews,delete this.listFrameViews,delete this.impl},QI:function(t,e){this.impl&&(this.impl[t]?this.impl[t].obj?e(this.impl[t].obj):require(["DS/"+(this.impl[t].module?this.impl[t].module:"SPY")+"/"+this.impl[t].ext],function(i){if(this.impl){for(var s in this.impl[t].obj=new i,this.impl[t].obj.implementation=this,this.impl)this.impl[s].ext===this.impl[t].ext&&(this.impl[s].obj=this.impl[t].obj);e(this.impl[t].obj)}else e()}.bind(this)):e())},getSPM:function(){return this.spm},getSequence:function(){return this.seq},getNavData2DViewList:function(t){var e=[];if(this.spm&&this.list2DViews){var i=[];if(!this.isShared&&void 0===t){var s=this.spm.getSharedDataDisplayList(this.seq);if(s)for(var a=0;a<s.length;a++)i=i.concat(s[a].getNavData2DViewList())}e=this.list2DViews.concat(i)}return e},getNavData3DViewList:function(t){var e=[];if(this.spm&&this.list3DViews){var i=[];if(!this.isShared&&void 0===t){var s=this.spm.getSharedDataDisplayList(this.seq);if(s)for(var a=0;a<s.length;a++)i=i.concat(s[a].getNavData3DViewList())}e=this.list3DViews.concat(i)}return e},getNavDataFrameViewList:function(t){var e=void 0===t||!0===t?this.category:void 0,i=[];if(this.spm&&this.listFrameViews){var s=[];if(!this.isShared){var a=this.spm.getSharedDataDisplayList(this.seq,e);if(a)for(var n=0;n<a.length;n++)s=s.concat(a[n].getNavDataFrameViewList())}i=this.listFrameViews.concat(s)}return i},simplifyFrameViewList:function(){this.spm&&this.listFrameViews&&(this.listFrameViews.forEach(function(t,e){a(this.listFrameViews,e)}.bind(this)),this.listFrameViews=s(this.listFrameViews))},isEmpty:function(){var t=this.getNavData3DViewList(),e=this.getNavData2DViewList(),i=this.getLegend();return 0===t.length&&e.length===(i?1:0)&&0===this.listFrameViews.length},getStreamlines:function(){return this.getNavData3DViewList().filter((function(t){return"streamLines"===t.subType&&(t.isAStreamLine=!0,!0)}))},hasExtremaAvailable:function(t){for(var e,i=!1,s=this.getNavData3DViewList(),a=0;a<s.length&&!e;a++)"CATSimNavData3DExtremasRoot"===s[a].getType()&&(e=s[a]);if(e)for(var n=e.getListExtremasSet(),r=0;r<n.length&&!i;r++){var o=n[r];if(o){var l=o.getExtremas(t);i=l&&l.getListExtrema().length>0}}return i},getLegend:function(){for(var t,e=this.getNavData2DViewList(),i=0;i<e.length;i++)if("CATSimNavData2DLegend"===e[i].type){t=e[i];break}return t},hasMinMax:function(){var t=this.getLegend();return t&&t.hasMinMax()&&!t.NoResults},getGroupInfo:function(t){var e={},i=this.getLegend();if(i){var s=this.getGroupForFrame(t);if(s){if(s.group){var a=function(t){var e={},s=t.globalStart,a=t.globalEnd;e.min=i.localMin[s],e.max=i.localMax[a];for(var n=s+1;n<=a;n++)i.localMin[n]<e.min&&(e.min=i.localMin[n]),i.localMax[n]>e.max&&(e.max=i.localMax[n]);return e}(s.group);e.groupMin=a.min,e.groupMax=a.max}}e.localMin=i.localMin[t],e.localMax=i.localMax[t],e.frameIndex=t,e.userMin=i.userMin,e.userMax=i.userMax}return e},updateLegend:function(t){var e=this.getLegend();if(e&&t&&t.globalStart>=0&&t.globalStart<e.localMin.length&&t.globalEnd<e.localMin.length){e.min=e.localMin[t.globalStart],e.max=e.localMax[t.globalStart];for(var i=t.globalStart+1;i<=t.globalEnd;i++)e.localMin[i]<e.min&&(e.min=e.localMin[i]),e.localMax[i]>e.max&&(e.max=e.localMax[i])}},hasNoGlobalData:function(){if(void 0===this._noGlobalData){var t=this.getLegend();t&&(this._noGlobalData=t.hasNoGlobalFlag())}return this._noGlobalData},isAnimated:function(){var t=!1,e=this.getAnimationStructure();return e&&(t=e.totalFrameNumber>1),t},isAnimationInitialized:function(){return this.animationInitialized},setAnimationAsInitialized:function(){this.animationInitialized=!0},getTotalNumberOfFrames:function(){var t,e=this.getAnimationStructure();return e&&(t=e.totalFrameNumber),t},getAnimationStructure:function(){if(!this.animationStructure){var t=this.getLegend();t&&(this.animationStructure=t.animationStructure)}return this.animationStructure},getIsolatedFrames:function(){var t=[],e=this.getAnimationStructure();if(e&&e.groupList)for(var i=0;i<e.groupList.length;i++){var s=e.groupList[i];s&&s.frameList&&1===s.frameList.length&&void 0!==s.frameList[0].globalIndex&&t.push(s.frameList[0].globalIndex)}return t},getGroupForFrame:function(t){var e={},i=this.getAnimationStructure();if(!isNaN(t)&&i&&i.groupList)for(var s=0;s<i.groupList.length;s++){var a=i.groupList[s];if(a&&a.frameList)for(var n=0;n<a.frameList.length;n++){var r=a.frameList[n];if(r&&r.globalIndex===t+1)return e.group=a,e.frame=r,e}}return e},setPartialAnimationMode:function(t){"boolean"==typeof t&&(this._partialAnimMode=t,i.publish({event:this.spm.ctx+"/SPY/ANIMSCOPECHANGE"}))},isPartialAnimationMode:function(){return this._partialAnimMode},getDefaultAnimationScope:function(t){var e={groupIDs:[],groupIDsNoMode:[],frames:[],hasModes:!1},i=this.getAnimationStructure(),s=this.getGroupForFrame(t);if(i){var a;for(e.globalStart=0,e.globalEnd=i.totalFrameNumber-1,e.localPosition=s.frame?s.frame.globalIndex:void 0,a=0;a<i.groupList.length;a++)e.groupIDs.push(i.groupList[a].id),e.groupIDsNoMode.push(i.groupList[a].idNoMode),e.frames=e.frames.concat(i.groupList[a].frameList),e.hasModes=e.hasModes?e.hasModes:i.groupList[a].isMode;if(e.length=e.frames.length,i.computedFramesOnlyForDefault){for(e.frames=[],a=0;a<i.groupList.length;a++)e.frames=e.frames.concat(i.groupList[a].computedFrameList);e.globalStart=e.frames[0].globalIndex-1,e.globalEnd=e.frames[e.frames.length-1].globalIndex-1,e.length=e.frames.length,e.localPosition=e.frames.length;for(var n=0;n<e.frames.length;n++){var r=e.frames[n];r&&r.globalIndex===t&&(e.localPosition=n)}}this._computeScopeMinMax(e)}return e},getAnimationScope:function(t){var e={groupIDs:[],groupIDsNoMode:[],frames:[],hasModes:!1},i=this.getAnimationStructure(),s=this.getGroupForFrame(t);if(i&&s&&s.group){if(i.groupList.length>1)e.canBePartial=!0,e.globalStart=s.group.globalStart,e.globalEnd=s.group.globalEnd,e.localPosition=s.frame.localIndex,e.groupIDs.push(s.group.id),e.groupIDsNoMode.push(s.group.idNoMode),e.frames=e.frames.concat(s.group.frameList),e.hasModes=s.group.isMode;else{e.globalStart=0,e.globalEnd=i.totalFrameNumber-1,e.localPosition=s.frame.globalIndex;for(var a=0;a<i.groupList.length;a++)e.groupIDs.push(i.groupList[a].id),e.groupIDsNoMode.push(i.groupList[a].idNoMode),e.frames=e.frames.concat(i.groupList[a].frameList),e.hasModes=e.hasModes?e.hasModes:i.groupList[a].isMode}e.length=e.frames.length,this._computeScopeMinMax(e)}return e.length<=1&&(e.canBePartial=!1),e},getClosestComputedFrameInGroup:function(t){var e,i=this.getGroupForFrame(t);if(i&&i.group&&i.frame){for(var s=i.group,a=i.frame,n=!1;!n&&a.localIndex>=1&&a.localIndex<=s.frameList.length;)if(!(n=!a.isScaledPosition)){var r=a.localIndex;a=r>=0?s.frameList[r]:s.frameList[s.frameList.length-1]}n&&(e=a.globalIndex)}return e},getComputedFramesByGroup:function(){var t,e=this.getAnimationStructure();if(e&&e.groupList.length>0){t=new Map;var i=e.groupList[0],s=i.idNoMode,a=i.computedFrameList;t.set(i.idNoMode,a);for(var n=1;n<e.groupList.length;n++)a=(i=e.groupList[n]).idNoMode===s?a.concat(i.computedFrameList):i.computedFrameList,t.set(i.idNoMode,a),s=i.idNoMode}return t},getFrameGlobalIdxFromPosition:function(t,e){var i,s=this.getLegend();return s&&(i=s.getFrameGlobalIdxFromPosition(t,e)),i},getRetexturingMode:function(t,e){var i="NEUTRAL",s=this.getIsolatedFrames();if((s=void 0===s?[]:s).indexOf(t+1)>-1||this.hasNoGlobalData()&&!this.animationStructure.computedFramesOnlyForDefault)i=e?"REDUCE":"NEUTRAL";else if(this.noFramePosition)i=e?"NEUTRAL":"EXTEND";else{var a=this.getGroupForFrame(t);a&&a.group&&(i=a.group.scaledAnimation&&a.frame.isScaledPosition?e||2===a.group.scalingType?"NEUTRAL":"EXTEND":e?"REDUCE":"NEUTRAL")}return i},isLarge:function(){return this.list3DViews.length>100},resetLoadingStatus:function(){let t=t=>{t&&t.resetLoadingStatus&&t.resetLoadingStatus()};this.list2DViews.forEach(t),this.list3DViews.forEach(t)},getCameraRoot:function(){},getMultiInstanciatedFiles:function(){},getRenderingMaterials:function(){var t=[];this.getNavData3DViewList(!0).forEach((function(e){e&&e.getRenderingMaterial&&t.push(e.getRenderingMaterial())}));var e=this._getSortedDuplicates(t);return new Set(e)},removeCharts:function(){Array.isArray(this.listFrameViews)&&this.listFrameViews.forEach((function(t){t.removeCharts()})),this._nbCharts=0},registerImage:function(t){t&&this._listInfoImages.push(t)},getNumberOfCharts:function(){if(isNaN(this._nbCharts)){this._nbCharts=0;var t=this.getNavDataFrameViewList();Array.isArray(t)&&t.forEach(function(t){this._nbCharts+=t.getNbCharts()}.bind(this))}return this._nbCharts},getNumberOfImages:function(){return this._listInfoImages.length},containsImages:function(){return this._listInfoImages.length>0},getInfoImages:function(){return this._listInfoImages},startAnalyticsTimeUpdate:function(t){var e=Date.now();isNaN(this.analytics[t])&&(this.analytics[t]=0),this._analyticsTimeStarts[t]=e},stopAnalyticsTimeUpdate:function(t,e){if(this._analyticsTimeStarts[t]){var i=Date.now()-this._analyticsTimeStarts[t];e?this.analytics[t]+=i:this.analytics[t]=i}},integrateRSCExtractionTime:function(t){this.analytics&&!isNaN(t)&&(isNaN(this.analytics.visuCreationTime)||(this.analytics.visuCreationTime-=t),isNaN(this.analytics.extractionTime)||(this.analytics.extractionTime+=t))}});return t.namespace("DS/SPY/CATSimNavDataDisplayAbstract",n)})),define("DS/SPY/LWResourceLoader",["UWA/Core","UWA/Class"],(function(t,e){"use strict";return e.extend({_getFramePostFix:function(t){return isNaN(t)?"":"_frame"+String(t)},_getFrameIdx:function(t){var e=t.split("_frame");return e.length>1?parseInt(e[1]):void 0},init:function(t){this.spm=t.spm,this.useProbe=t.useProbe,this.probesManager=t.probesManager,this.filesToLoad=[],this.framesIndices=[],this.managers=[],this.loadingMap=new Map,this.transactionMap=new Map,this.managerTransactionMap=new Map,this.emptyRscTransactionCounter=0},clearLoadingMap:function(){this.loadingMap.clear()},clean:function(){this.clearLoadingQueue(),this.spm=void 0,this.probesManager=void 0},clearLoadingQueue:function(t){this.filesToLoad=[],this.framesIndices=[],this.managers=[],this.emptyRscTransactionCounter=0,this.managerTransactionMap.clear(),this.transactionMap.clear()},_updateTransactionForManager:function(t,e){if(t){var i=this.managerTransactionMap.get(String(t.id)+this._getFramePostFix(e)),s=this.transactionMap.get(i);s?"loading"===s.loadStatus&&(s.count--,0===s.count&&this._closeTransaction(i)):this._cleaningInterruptedTransaction(t,e)}},_cleaningInterruptedTransaction:function(t,e){},_closeTransaction:function(t){let e=this.transactionMap.get(t);if(e){e.loadStatus="done",e.probe&&e.probe.started&&(e.probe.end(),e.probe.started=!1);let i=Object.assign({},e.analytics),s=e.callbacks;this.transactionMap.delete(t),this.managerTransactionMap.forEach(((e,i,s)=>{e===t&&s.delete(i)})),s.forEach((t=>{t&&t(i)}))}},onLoaderDoneCallback:function(){var t=0;this.transactionMap.forEach((function(e){t+=e.count}));var e=this;t-this.emptyRscTransactionCounter<=0&&(this.transactionMap.forEach((function(t,i){e._closeTransaction(i)})),this.transactionMap.clear(),this.managerTransactionMap.clear(),this.emptyRscTransactionCounter=0,this.window.experience&&(setTimeout((function(){e.filesToLoad.length<=0&&e.eventsManager.publish({event:e.eventContext+"/SPY/PROGRESS/END"})}),500),this.window.experience.modelLoadComplete=!0,this.window.experience.modelLoadCount=0,this.window.experience.modelPrevLoadCount=0),this.eventsManager.publish({event:this.eventContext+"/SPY/VISULOADING/FINISHED"}))}})})),define("DS/SPY/CATSimNavDataHelper",["i18n!DS/SPY/assets/nls/CATSimNavDataHelper","UWA/Core","UWA/Class"],(function(t,e,i){"use strict";var s=t.get("mode");s=s||"Mode[NONLS]";var a=i.singleton({init:function(){},parseGroupIds:function(t){var e=[];return t&&(e=t.split("?|?")),e},isModeSeparator:function(t){return"_Mode"===t},buildGroupIdNoMode:function(t,e){return e&&!this.isModeSeparator(e)?t+"?|?"+e:t},buildGroupName:function(t){var e="";if(t&&t.length>0){e=t[0];for(var i=1;i<t.length;i++)if(t[i]){var a=t[i];this.isModeSeparator(a)&&(a=s),e+=" - "+a}}return e},buildGroupNameFromIds:function(t){return this.buildGroupName(this.parseGroupIds(t))}});return e.namespace("DS/SPY/CATSimNavDataHelper",a)})),define("DS/SPY/CATSimNavDataChartAxis",["UWA/Core","UWA/Class"],(function(t,e){"use strict";var i="_axis_",s=e.extend({init:function(t,e){this._dimension=1,this._position="bottom",this._scale="linear",this._fixedBounds=!1,this.readFromXML(t,e)},setId:function(t){isNaN(t)||(this._identifier=i+t.toString())},getId:function(){return this._identifier},getIdNoPrefix:function(){return parseInt(this._identifier.slice(6))},setName:function(t){this._name=t},getName:function(){return this._name},setDimension:function(t){this._dimension=t,2===this._dimension&&"bottom"===this._position&&(this._position="left")},getDimension:function(){return this._dimension},getPosition:function(){return this._position},getScale:function(){return this._scale},setUnit:function(t){this._unit=t},getUnit:function(){return this._unit},hasFixedBounds:function(){return this._fixedBounds},getFixedBounds:function(){return{min:this._fixedMin,max:this._fixedMax}},getColor:function(){return this._color},getTickNb:function(){return this._tickNb},getValueOfInterest:function(){return this._voi},getPrecision:function(){return this._precision},getExponent:function(){return this._exp},readFromXML:function(t,e){if(t){this._name=t.getAttribute("name");var s=parseInt(t.getAttribute("id"));isNaN(s)||(this._identifier=i+s.toString()),"2"===t.getAttribute("dimension")&&(this._dimension=2,this._position="left");var a=t.getAttribute("position");a&&(1===this._dimension?this._position="top"===a?a:this._position:this._position="right"===a?a:this._position);var n=t.getAttribute("scale");"log"!==n&&"percentage"!==n||(this._scale=n);var r=t.getAttribute("unit");this._unit=r||"";var o=parseFloat(t.getAttribute("fixedMin")),l=parseFloat(t.getAttribute("fixedMax"));isNaN(o)||(this._fixedBounds=!0,this._fixedMin=o),isNaN(l)||(this._fixedBounds=!0,this._fixedMax=l);var u=t.getAttribute("color");u&&(this._color=u);var h=parseInt(t.getAttribute("tickNb"));isNaN(h)||(this._tickNb=h);var c=parseInt(t.getAttribute("precision"));isNaN(c)||(this._precision=c);var d=parseInt(t.getAttribute("exp"));isNaN(d)||(this._exp=d);var m=parseFloat(t.getAttribute("interest"));isNaN(m)||(this._voi=m)}e&&e()}});return t.namespace("DS/SPY/CATSimNavDataChartAxis",s)})),define("DS/SPY/CATSimNavDataSpec",["UWA/Core","UWA/Class","i18n!DS/SPY/assets/nls/CATSimNavTypes"],(function(t,e,i){"use strict";var s={},a=e.extend({init:function(t,e){this.dd=e,this.name=t?t.getAttribute("name"):void 0,this.id=t?t.getAttribute("id"):void 0,this.type=this.type?this.type:t?t.getAttribute("type"):void 0,this.subType=t?t.getAttribute("subType"):void 0,this.supportedModes=t?t.getAttribute("supportedModes"):void 0,this.unit=t?t.getAttribute("unit"):void 0,this.defaultMode="ENG",this.visibility=!t||"0"!==t.getAttribute("DefVis"),this.isExtractable=!1,this.suffix=i.get(this.type),this.active=!this.supportedModes||-1!==this.supportedModes.indexOf(this.defaultMode),this.sibling=void 0,this.siblingSearched=!1,this.listLinks=[]},_createExtension:function(t,e,i){if(this.impl){if(!this.impl[t].obj)for(var s in this.impl[t].obj=new e(this),this.impl[t].obj.implementation=this,this.impl)this.impl[s]&&this.impl[s].ext===this.impl[t].ext&&(this.impl[s].obj=this.impl[t].obj);i&&i(this.impl[t].obj)}else i()},QI:function(t,e){if(this.impl[t])if(this.impl[t].obj)this.impl[t].obj.implementation=this,e(this.impl[t].obj);else{var i="DS/"+(this.impl[t].module?this.impl[t].module:"SPY")+"/"+this.impl[t].ext,a=s[i];a?"loaded"===a.status?this._createExtension(t,a.typeClass,e):"requested"===a.status&&a.queue.push(function(i){this._createExtension(t,i,e)}.bind(this)):(s[i]={status:"requested",queue:[]},require([i],function(a){s[i].status="loaded",s[i].typeClass=a,this._createExtension(t,a,e);for(var n=s[i];n.queue&&n.queue.length>0;)n.queue[0]&&(n.queue[0](a),n.queue.shift())}.bind(this)))}else e()},getDataDisplay:function(){return this.dd},getName:function(){return this.name},getId:function(){return this.id?this.id:this.name},getSuffix:function(){return this.suffix},getType:function(){return this.type},getSupportedMode:function(){return this.mode},getSibling:function(){var t=this.supportedModes;if(("ENG"===t||"REA"===t)&&void 0===this.sibling&&!this.siblingSearched&&this.dd&&this.name.length>0){this.siblingSearched=!0;var e,i,s=!1;if("CATSimNavData2DView"===this.type||"CATSimNav2DAnimationView"===this.type)for(i=0;this.dd.list2DViews&&i<this.dd.list2DViews.length&&!s;i++)(e=this.dd.list2DViews[i])&&e.name===this.name&&e!==this&&e.supportedModes!==t&&(this.sibling=e,s=!0);else if("CATSimNavData3DView"===this.type||"CATSimNavData3DAnimationView"===this.type)for(i=0;this.dd.list3DViews&&i<this.dd.list3DViews.length&&!s;i++)(e=this.dd.list3DViews[i])&&e.name===this.name&&e!==this&&e.supportedModes!==t&&(this.sibling=e,s=!0)}return this.sibling},isActive:function(){return this.active},setActive:function(t){this.active=t},getVisibility:function(){return this.visibility},getUnit:function(){return this.unit},getLinks:function(t){return this.listLinks[t]},addLink:function(t,e){var i=this.listLinks[t];void 0===i?this.listLinks[t]=e:i.appendSpec(e)},readFromXML:function(){}});return t.namespace("DS/SPY/CATSimNavDataSpec",a)})),define("DS/SPY/CATSimNavDataLink",[],(function(){"use strict";return function(t,e,i){this.dd=e,this._resourcePath="",this.nextSpec=null,this.getNext=function(){return this.nextSpec},this.appendSpec=function(t){null===this.nextSpec?this.nextSpec=t:this.nextSpec.appendSpec(t)},this.getPointedResource=function(){return this._resourcePath},this.setPointedResource=function(t){this._resourcePath=t},this.getPointedData=function(){if(this._pointedDataId&&!this._pointedData)for(var t=0;this.dd.list3DViews&&t<this.dd.list3DViews.length;t++)this.dd.list3DViews[t].getId()===this._pointedDataId&&(this._pointedData=this.dd.list3DViews[t]);return this._pointedData},this.setPointedData=function(t){this._pointedDataId=t,this._pointedData=null},this.getMatrix=function(){return this._matrix},this.readFromXML=function(t,e){if(t){var i,s=t.getAttribute("id"),a=t.getAttribute("name");this.setPointedData(s||a);var n=parseInt(t.getAttribute("srcId"));if(isNaN(n))i=t.getAttribute("src");else i=this.dd.spm.getDataList("src",this.dd.seq).getEntry(n-1).val;this.setPointedResource(i),e&&e(this)}},this.readFromXML(t,i)}})),define("DS/SPY/CATSimNavDataAbstractFactory",["UWA/Core","UWA/Class"],(function(t,e){"use strict";var i=e.extend({init:function(){},createSequence:function(){console.error("CATSimNavDataAbstractFactory - abstract createSequence should not be called")},isExtendedMode:function(){return void 0!==this._extensionFilter}});return t.namespace("DS/SPY/CATSimNavDataAbstractFactory",i)})),define("DS/SPY/CATSimNavDataXYValue",(function(){"use strict";var t=function(t,e,i){this.index=-1,t&&this.readFromXML(t,e,i)};return t.prototype.getX=function(){return this.X},t.prototype.setX=function(t){this.X=t},t.prototype.getY=function(){return this.Y},t.prototype.setY=function(t){this.Y=t},t.prototype.setIndex=function(t){this.index=t},t.prototype.getIndex=function(){return this.index},t.prototype.getGroupId=function(){return this.groupId},t.prototype.setGroupId=function(t){this.groupId=t},t.prototype.getGroupIdNLS=function(){return this.groupIdNLS},t.prototype.setGroupIdNLS=function(t){this.groupIdNLS=t},t.prototype.getPosition=function(){return this.position},t.prototype.setPosition=function(t){this.position=t},t.prototype.readFromXML=function(t,e,i){var s,a=t.getAttribute("X");a&&a.length>0&&(s=Number(a)),this.setX(s),this.setY(Number(t.getAttribute("Y")));var n=i&&i.group?i.group:t.getAttribute("group");this.setGroupId(n);var r,o=i&&i.groupNLS?i.groupNLS:n;if(this.setGroupIdNLS(o),i&&!isNaN(i.position))r=i.position;else{var l=t.getAttribute("position");l&&l.length>0&&(r=Number(l))}this.setPosition(r),e(this)},t})),define("DS/SPY/CATSimNavData3DAnimationExtremaProvider",["UWA/Core"],(function(t){"use strict";var e=t.Class.extend({init:function(){this._parent()},getImpl:function(){return this.implementation},getExtrema:function(t){var e={listMin:[],listMax:[]};if(this.implementation){for(var i,s=this.implementation.dd.getNavData3DViewList("plotContentOnly"),a=0;a<s.length&&!i;a++)"CATSimNavData3DExtremasRoot"===s[a].getType()&&(i=s[a]);if(i){for(var n,r=i.getListExtremasSet(),o=0;o<r.length&&!n;o++){var l=r[o];if(l){var u=l.getLinks("ExtremasToPart");if(u){var h=u.getPointedData();h&&h.getId()===this.implementation.getId()&&(n=l)}}}if(n){var c=n.getExtremas(t);if(c){var d=c.getListExtrema();if(d)for(var m=0;m<d.length;m++){var f=d[m];f&&(f.setComponent(this.implementation),"Min"===f.getExtremaType()?e.listMin.push(f):e.listMax.push(f))}}}}}return e}});return t.namespace("DS/SPY/CATSimNavData3DAnimationExtremaProvider",e)})),define("DS/SPY/SpaceURL",["UWA/Core","UWA/Class"],(function(t,e){"use strict";var i=e.extend({init:function(t){this._platformServices=t},getUrl:function(t){t&&t.asset&&t.onComplete&&this._platformServices&&this._platformServices.getPlatformServices({onComplete:function(e){var i,s=e.find((function(e){return e.platformId===t.asset.tenant}));s&&(i=s["3DDashboard"]+"/#app:X3DPLAW_AP/content:X3DContentId=",i+=encodeURIComponent(JSON.stringify(t.asset.Play3DXContent)),t.onComplete(i))}})}});return t.namespace("DS/SPY/SpaceURL",i)})),define("DS/SPY/CATSimNavDataList",["UWA/Core","UWA/Class"],(function(t,e){"use strict";var i=e.extend({init:function(t){if(t&&"List"===t.nodeName){this._name=t.getAttribute("name"),this._entries=[];for(var e=t.children,i=0;i<e.length;i++){for(var s={},a=e[i].getAttributeNames(),n=0;n<a.length;n++)s[a[n]]=e[i].getAttribute(a[n]);this._entries.push(s)}}},getName:function(){return this._name},getEntry:function(t){return this._entries[t]}});return t.namespace("DS/SPY/CATSimNavDataList",i)})),define("DS/SPY/CATSimNavData2DLegend",["UWA/Core","DS/SPY/CATSimNavDataSpec","DS/CoreEvents/Events","DS/SPY/CATSimNavDataHelper"],(function(t,e,i,s){"use strict";const a="/SPY/LEGEND/EDIT/USERMIN",n="/SPY/LEGEND/EDIT/USERMAX";let r=e.extend({_parseDataFrame:function(t){this.title=t.getAttribute("title"),this.scaleFactor=parseFloat(t.getAttribute("scaleFactor")),this.inverseState=t.getAttribute("inverseState"),this.min=parseFloat(t.getAttribute("max")),this.max=parseFloat(t.getAttribute("min")),0===this.min&&0===this.max&&(this.noGlobalFlag=!0);var e=parseFloat(t.getAttribute("userMin"));isNaN(e)||(this.userMin=e);var i=parseFloat(t.getAttribute("userMax"));isNaN(i)||(this.userMax=i),this.rangeReadOnly=t.getAttribute("rangeReadOnly"),this.unit=t.getAttribute("unit")},_parseFrameSet:function(t){for(var e=0,i=t.firstChild;null!=i;){if(1===i.nodeType){var s=parseFloat(i.getAttribute("localMin"));isNaN(s)||(this.localMin.push(s),s<=this.min&&(this.min=s));var a=parseFloat(i.getAttribute("localMax"));isNaN(a)||(this.localMax.push(a),a>=this.max&&(this.max=a));var n=-1,r=parseFloat(i.getAttribute("scaleFactor"));isNaN(r)?isNaN(this.scaleFactor)||(n=this.scaleFactor):n=r,this.deformationScales.push(n);var o,l,u,h,c=void 0;if("Frame"===i.nodeName){var d=i.getAttribute("frmId");if(null!==d){var m=this.dd.spm.getFrameDetails(this.dd.seq,d,e);c=m.position,l=m.scaled,u=m.group,h=m.unit}}else u=i.getAttribute("group"),(o=i.getAttribute("position"))&&o.length>0&&(c=Number(o)),l=i.getAttribute("scaled"),h=i.getAttribute("unit"),this.dd.spm.setFrameDetails(this.dd.seq,e,null!==l||void 0!==l,u,c,h);!isNaN(c)&&this.animationStructure.noFramePosition&&(this.animationStructure.noFramePosition=!1);var f,g=null!=l&&""!==l&&"0"!==l;g&&2===(f=parseInt(l))&&(this.hasScanAnimation=!0),this.animRawData.push({id:u,position:c,positionUnit:h,isScaledPosition:g,scalingType:f}),e++}i=i.nextSibling}},init:function(t,e,i,s){this._parent(t,e),this.localMin=[],this.localMax=[],this.deformationScales=[],this.animRawData=[],this.NoResults=e&&"NoResults"===e.plotType,this.impl={CATISimNavDataSpecUI:{module:"SPYUI",ext:"CATSimNavData2DLegendUI",type:"data",obj:null},CATISimNavDataAnimation:{module:"SPYUI",ext:"CATSimNavData2DLegendUI",type:"data",obj:null}},this._posDetailsMaps=[],this.readFromXML(t,s),this._eventCtxId=e.getSPM().getContext()},hasMinMax:function(){var t=Array.isArray(this.localMax)&&this.localMax.length>0;return Array.isArray(this.localMin)&&this.localMin.length>0&&t&&!this.NoResults},getPNGList:function(){return this.palette?[this.palette]:[]},readFromXML:function(t,e){this.animationStructure={noFramePosition:!0};for(var i=0;i<t.children.length;i++){var a=t.children[i];switch(a.nodeName){case"DataFrame":this._parseDataFrame(a);break;case"PaletteFrame":this.palette=a.getAttribute("src");break;case"DiscreteValues":this.labels=s.parseGroupIds(a.getAttribute("labels")),this.colors=s.parseGroupIds(a.getAttribute("colors"));break;case"FrameSet":this._parseFrameSet(a)}}!function(t){if(t)for(var e=0;e<t.length;e++){var i=t[e],a=e+1<t.length?t[e+1]:void 0;i.displayName="";var n=s.parseGroupIds(i.id);n.length>0&&(i.rootName=n[0],i.displayName+=i.rootName,n.length>1&&(i.isComplex=!0));for(var r=1;r<n.length;r++){if(s.isModeSeparator(n[r])){var o=r+1<n.length?parseInt(n[r+1]):void 0;i.modeIndex=o,i.isMode=!isNaN(o)&&o>=0;for(var l="Mode "+(void 0!==o?o.toString():"index missing"),u=i.isScaledPosition?a:i,h=1;u&&u.isScaledPosition;)u=e+h<t.length?t[e+h]:void 0,h++;u&&(l=u.position+(u.positionUnit?" "+u.positionUnit:"")),i.displayName+=" - "+l;break}isNaN(parseInt(n[r]))&&(i.loadName=n[r],i.displayName+=" - "+n[r])}}}(this.animRawData),this.animationStructure.groupList=[];var n,r,o,l,u,h,c,d=0,m=0,f=0,g=!1,p=!1,S=0,v=0,D=0,N=0,b=0;let C,x,A;for(var y=0;y<this.animRawData.length;y++){var L=this.animRawData[y];if(L.id!==n&&(d=0,n=L.id,r=L.displayName,o=L.rootName,l=L.positionUnit,g=L.isComplex,u=L.loadName,h=(p=L.isMode)?L.modeIndex:void 0,S=0,v=0,D=0,C=void 0,x=void 0,c={index:f,id:n,idNoMode:s.buildGroupIdNoMode(o,u),name:r,rootName:o,frameList:[],computedFrameList:[],scaledAnimation:!1,scalingFactor:S,globalStart:m,globalEnd:m,unit:l,isComplex:g,loadCaseName:u,isMode:p,modeIndex:h,startTime:C,endTime:x,duration:A,active:!0},this.animationStructure.groupList.push(c),f++),c){d++,m++;var T="",_=L.position,P=L.positionUnit;isNaN(_)?L.isScaledPosition&&(T="scaled",c.scaledAnimation=!0,c.scalingType=L.scalingType,D++,isNaN(c.startTime)&&(c.startTime=0)):(c.unit=P,T=_.toString()+(P?" "+P:""),v++,b++,isNaN(c.startTime)&&(c.startTime=_),c.endTime=_,c.duration=_-c.startTime),this.animationStructure.noFramePosition&&(T="frame "+d);var M={name:T,globalIndex:m,localIndex:d,isScaledPosition:L.isScaledPosition,position:_};if(c.frameList.push(M),L.isScaledPosition||c.computedFrameList.push(M),c.globalEnd=m-1,c.scalingFactor=v>0?(v+D)/v:0,c.numberComputedFrames=v,c.scaledAnimation&&c.isMode&&N++,!isNaN(_)){var I=this._posDetailsMaps[c.idNoMode];I||(this._posDetailsMaps[c.idNoMode]=new Map,I=this._posDetailsMaps[c.idNoMode]),I.set(_,y)}}}this.animationStructure.totalFrameNumber=m,N>1&&(this.animationStructure.computedFramesOnlyForDefault=!0,this.animationStructure.totalComputedFramesNumber=b),e()},setActiveGroups:function(t){let e=this.animationStructure;e&&Array.isArray(t)&&t.length>0&&e.groupList.forEach((e=>{e.active=t.includes(e.id)}))},updateActiveGroupsTimeProjection:function(t){let e=this.animationStructure;if(e){let i=0;e.groupList.forEach((t=>{if(t.active&&!t.preparedForTimeProjection){let e=t.frameList;if(t.scaledAnimation){let i=0,s=0,a=this._posDetailsMaps[t.idNoMode];a&&t.computedFrameList.forEach((t=>{let n=t.localIndex;if(n>1){let r=(t.position-s)/(n-i);for(let t=i;t<n;++t){let n=e[t];n&&n.isScaledPosition&&(n.position=s+(n.localIndex-i)*r,a.set(n.position,n.globalIndex))}}i=n}))}t.unit&&0!==t.unit.length||(e.forEach((t=>{t.position=.01*t.position})),t.duration=.01*t.duration),t.preparedForTimeProjection=!0}i+=t.duration})),e.activeGroupsTimeProjection=[];const s=t/i;let a=this.animationStructure.groupList;if(1===a.length)e.activeGroupsTimeProjection=a[0].frameList.map((t=>({globalIndex:t.globalIndex,localIndex:t.localIndex,position:t.position*s})));else{let t=0;a.forEach((i=>{i.active&&(i.frameList.forEach((i=>{e.activeGroupsTimeProjection.push({globalIndex:i.globalIndex,localIndex:i.localIndex,position:s*i.position+t})})),t+=s*i.duration)}))}}},getFrameIndexFromPosition:function(t){let e;if(this.animationStructure&&this.animationStructure.activeGroupsTimeProjection){let i=this.animationStructure.activeGroupsTimeProjection.find((e=>e.position===t));i&&(e=i.globalIndex-1)}return e},hasNoGlobalFlag:function(){return this.noGlobalFlag},rangeIsReadOnly:function(){return null!==this.rangeReadOnly&&void 0!==this.rangeReadOnly},setAsReadOnly:function(){this.rangeReadOnly=!0,i.publish({event:this._eventCtxId+"/SPY/LEGEND/EDITABILITY"})},setUserMin:function(t,e,s){if(s=void 0===s||s,void 0!==t&&isNaN(t))return"E_INVALIDARG";if(t!==this.userMin&&!this._inEdition){var n=!isNaN(e)&&e>=0&&e<this.localMax.length;this._inEdition=!0,void 0===t?this.userMin=void 0:isNaN(this.userMax)?this.userMin=n?t<=this.localMax[e]?t:this.localMax[e]:t<=this.max?t:this.max:t>this.userMax?this.userMin=this.userMax:this.userMin=t,i.publish({event:this._eventCtxId+a,data:{value:this.userMin,computed:n?this.localMin[e]:void 0,unit:this.unit,syncFlag:s}}),this._inEdition=!1}return this.userMin},getUserMin:function(){return this.userMin},setUserMax:function(t,e,s){if(s=void 0===s||s,void 0!==t&&isNaN(t))return"E_INVALIDARG";if(t!==this.userMax&&!this._inEdition){var a=!isNaN(e)&&e>=0&&e<this.localMin.length;this._inEdition=!0,void 0===t?this.userMax=void 0:isNaN(this.userMin)?this.userMax=a?t>=this.localMin[e]?t:this.localMin[e]:t>=this.min?t:this.min:t<this.userMin?this.userMax=this.userMin:this.userMax=t,i.publish({event:this._eventCtxId+n,data:{value:this.userMax,computed:a?this.localMax[e]:void 0,unit:this.unit,syncFlag:s}}),this._inEdition=!1}return this.userMax},getUserMax:function(){return this.userMax},getComputedMin:function(t){var e=this.min;return isNaN(t)||(e=t>=0&&t<this.localMin.length?this.localMin[t]:void 0),e},getComputedMax:function(t){var e=this.max;return isNaN(t)||(e=t>=0&&t<this.localMax.length?this.localMax[t]:void 0),e},getMinMaxData:function(t){return{unit:this.unit,userMin:this.getUserMin(),userMax:this.getUserMax(),computedMin:this.getComputedMin(t),computedMax:this.getComputedMax(t)}},integrateMinMaxData:function(t,e){var s,r,o=!isNaN(e)&&e>=0&&e<this.localMin.length?this.localMin[e]:this.min,l=!isNaN(e)&&e>=0&&e<this.localMax.length?this.localMax[e]:this.max,u=isNaN(this.userMin)?o:this.userMin,h=isNaN(this.userMax)?l:this.userMax;t&&t.length>0&&t.forEach(function(t){if(t.unit===this.unit){var e=null===t.userMin||isNaN(t.userMin)?t.computedMin:t.userMin,i=null===t.usermax||isNaN(t.userMax)?t.computedMax:t.userMax;e<u&&(u=s=e),i>h&&(h=r=i)}}.bind(this)),(s=isNaN(s)?u:s)===this.userMin?i.publish({event:this._eventCtxId+a,data:{value:s,unit:this.unit,syncFlag:!0}}):this.setUserMin(s,e,!0),(r=isNaN(r)?h:r)===this.userMax?i.publish({event:this._eventCtxId+n,data:{value:r,unit:this.unit,syncFlag:!0}}):this.setUserMax(r,e,!0)},getFrameGlobalIdxFromPosition:function(t,e){if(null!=t){var i,s=t,a=t.indexOf("?|?_Mode?|?");-1!==a&&(s=t.slice(0,a));var n=this._posDetailsMaps[s];return n&&(i=n.get(e)),i}},isInverted:function(){return"1"===this.inverseState}});return t.namespace("DS/SPY/CATSimNavData2DLegend",r)})),define("DS/SPY/CATSimNavData2DAnimationView",["DS/SPY/CATSimNavDataSpec","DS/SPY/CATSimNavDataLink"],(function(t,e){"use strict";var i=t.extend({init:function(t,e,i,s){this._parent(t,e),this.impl={CATISimNavDataSpecUI:{module:"SPYUI",ext:"CATSimNavData2DAnimationViewUI",type:"data",obj:null},CATISimNavDataAnimation:{module:"SPYUI",ext:"CATSimNavData2DAnimationViewUI",type:"data",obj:null}},this.readFromXML(t,s)},getPNGList:function(){return this.getLinks("SP_StaticList")},readFromXML:function(t,i){for(var s=0,a=!1,n=function(t){t&&(this.addLink("SP_StaticList",t),0===--s&&a&&i&&i())}.bind(this),r=0;r<t.children.length;r++){var o=t.children[r];if("1"===o.getAttribute("level"))for(var l=0;l<o.children.length;l++){var u=o.children[l];if(u)for(var h=0;h<u.children.length;h++){var c=u.children[h];s++;new e(c,this.dd,n)}}}a=!0,0===s&&i()}});return UWA.namespace("DS/SPY/CATSimNavData2DAnimationView",i)})),define("DS/SPY/CATSimNavData2DRepStaticView",["DS/SPY/CATSimNavDataSpec","DS/SPY/CATSimNavDataLink"],(function(t,e){"use strict";var i=t.extend({init:function(t,e,i,s){this._parent(t,e),this.impl={CATISimNavDataSpecUI:{module:"SPYUI",ext:"CATSimNavData2DRepStaticViewUI",type:"data",obj:null}},this.readFromXML(t,s)},getPNGList:function(){return this.getLinks("SP_StaticList")},readFromXML:function(t,i){for(var s=0,a=!1,n=function(t){t&&(this.addLink("SP_StaticList",t),0===--s&&a&&i&&i())}.bind(this),r=0;r<t.children.length;r++){var o=t.children[r];if("1"===o.getAttribute("level"))for(var l=0;l<o.children.length;l++){var u=o.children[l];if(u)for(var h=0;h<u.children.length;h++){var c=u.children[h];s++;new e(c,this.dd,n)}}}a=!0,0===s&&i()}});return UWA.namespace("DS/SPY/CATSimNavData2DRepStaticView",i)})),define("DS/SPY/CATSimNavDataFrameViewComp",["DS/SPY/CATSimNavDataSpec"],(function(t){"use strict";var e=t.extend({init:function(t,e){this._parent(t,e),this._layoutPrefs={}},getValues:function(){alert("error: call to getValues on CATSimNavDataFrameViewComp")},readFromXML:function(t,e){alert("error: call to readFromXML on CATSimNavDataFrameViewComp")},isComplex:function(){return!1},getLayoutPreferences:function(){return this._layoutPrefs},setExpandPreference:function(t){this._layoutPrefs.expanded=t},setExtractPreference:function(t){this._layoutPrefs.extracted=t},getNbCharts:function(){return isNaN(this._nbCharts)&&this.computeNbCharts(),this._nbCharts},computeNbCharts:function(){this._nbCharts=0}});return UWA.namespace("DS/SPY/CATSimNavDataFrameViewComp",e)})),define("DS/SPY/CATSimNavDataFrameView",["DS/SPY/CATSimNavDataFrameViewComp","DS/SPY/CATSimNavDataLink"],(function(t,e){"use strict";var i=Node.ELEMENT_NODE,s=t.extend({init:function(t,e,i,s){this._parent(t,e),this.tempChildren=[],this.children=[],this.impl={CATISimNavDataSpecUI:{module:"SPYUI",ext:"CATSimNavDataFrameViewUI",type:"data",obj:null},CATISimNavDataAnimation:{module:"SPYUI",ext:"CATSimNavDataFrameViewUI",type:"data",obj:null},CATISimNavDataColorShading:{module:"SPYUI",ext:"CATSimNavDataFrameViewColorShading",type:"data",obj:null}},this.readFromXML(t,i,function(){this.computeNbCharts(),s&&s(this)}.bind(this))},getChildren:function(){return this.children},computeNbCharts:function(){for(var t in this._nbCharts=0,this.children)this._nbCharts+=this.children[t].getNbCharts()},readFromXML:function(t,s,a){if(t){for(var n=null,r=function(){for(var e=0,i=!1,n=function(t){return function(n){new n(t,this.dd,s,function(s){this.tempChildren[t._spyRank]=s,0===--e&&i&&a&&(this.tempChildren.forEach(function(t){t&&this.children.push(t)}.bind(this)),this.tempChildren=[],a(this))}.bind(this))}.bind(this)}.bind(this),r=!0,o=0,l=0;o<t.children.length;o++){var u=t.children[o],h=null,c=null;switch(u.nodeName){case"DDXYPlot":case"DDXYChart":c="CATSimNavDataFrameViewXYChart",r=!1;break;case"DDScalar":c="CATSimNavDataFrameViewCompValue";break;case"DDText":c="CATSimNavDataFrameViewText";break;case"DDImage":c="CATSimNavDataFrameViewImage";break;case"DDElementFrame":c="CATSimNavDataFrameView",r=!1}c&&(void 0===s||void 0===s.excludedTypes||s.excludedTypes.indexOf(c)<0)&&(h="DS/SPY/"+c,u._spyRank=l++,this._isComplex=!r,e++,require([h],n(u)))}i=!0,0===e&&a(this)}.bind(this),o=0;o<t.childNodes.length;o++){var l=t.childNodes[o];if(l.nodeType===i&&"LinkSet"===l.nodeName&&"Frameto3D"===l.getAttribute("role"))for(var u=0;u<l.childNodes.length&&null===n;u++){var h=l.childNodes[u];h&&h.nodeType===i&&"InternalRef"===h.nodeName&&(n=h)}}if(n)new e(n,this.dd,function(t){this.addLink("Frameto3D",t),r()}.bind(this));else r()}},isComplex:function(){return this._isComplex},removeCharts:function(){Array.isArray(this.children)&&(this.children=this.children.filter((function(t){return"CATSimNavDataFrameViewXYChart"!==t.type})),this.children.forEach((function(t){t.removeCharts&&t.removeCharts()}))),this._nbCharts=0}});return UWA.namespace("DS/SPY/CATSimNavDataFrameView",s)})),define("DS/SPY/CATSimNavDataFrameViewImage",["DS/SPY/CATSimNavDataFrameViewComp"],(function(t){"use strict";var e=t.extend({init:function(t,e,i,s){e&&e.registerImage(t.getAttribute("src")),this.type="CATSimNavDataFrameViewImage",this._parent(t,e),this.impl={CATISimNavDataSpecUI:{module:"SPYUI",ext:"CATSimNavDataFrameViewImageUI",type:"data",obj:null}},this.isExtractable=!0,this.readFromXML(t,s)},getTitle:function(){return this.name},getTooltip:function(){return this._tooltip},getPNGList:function(){return[this._src]},readFromXML:function(t,e){t&&(this._tooltip=t.getAttribute("tooltip"),this._src=t.getAttribute("src"),e&&e(this))}});return UWA.namespace("DS/SPY/CATSimNavDataFrameViewImage",e)})),define("DS/SPY/CATSimNavData3DView",["UWA/Core","DS/SPY/CATSimNavDataSpec","DS/CoreEvents/Events"],(function(t,e,i){"use strict";let s=e.extend({init:function(t,e,i){this._parent(t,e),this.transparency=t?t.getAttribute("transparency"):void 0,this.transparent=0<this.transparency,this.matRendering=t?t.getAttribute("matRendering"):void 0,i&&i.noRenderingMaterial&&(this.matRendering=void 0)},getRenderingMaterial:function(){return this.matRendering},switchVisibility:function(t,e){this.visibility=!this.visibility;let s=this.impl.CATISimNavDataSpecUI.obj.node;s&&s.setVisibility(!s.isVisible()),t&&e&&i.publish({event:e+"/SPY/VISIBILITY/CHANGE",data:this});var a=this.getSibling();a&&(a.visibility=this.visibility)}});return t.namespace("DS/SPY/CATSimNavData3DView",s)})),define("DS/SPY/CATSimNavData3DRepStaticView",["UWA/Core","DS/SPY/CATSimNavData3DView","DS/SPY/CATSimNavDataLink"],(function(t,e,i){"use strict";var s=e.extend({init:function(t,e,i,s){this._parent(t,e,i),this.impl={CATISimNavDataSpecUI:{module:"SPYUI",ext:"CATSimNavData3DRepStaticViewUI",type:"data",obj:null},CATISimNavDataColorShading:{module:"SPYUI",ext:"CATSimNavData3DStaticColorShading",type:"data",obj:null},CATISimNavDataExtremaProvider:{module:"SPY",ext:"CATSimNavData3DAnimationExtremaProvider",type:"data",obj:null}},this.readFromXML(t,s)},getGeometryFrameSet:function(){return this.getLinks("SP_StaticList")},getGeometryFiles:function(){let t=this.getGeometryFrameSet(),e=[];for(;t;)e.push(t.getPointedResource()),t=t.getNext();return e},readFromXML:function(t,e){for(var s=0,a=!1,n=function(t){t&&(this.addLink("SP_StaticList",t),0===--s&&a&&e&&e())}.bind(this),r=0;r<t.children.length;r++){var o=t.children[r];if("1"===o.getAttribute("level"))for(var l=0;l<o.children.length;l++){var u=o.children[l];if(u)for(var h=0;h<u.children.length;h++){var c=u.children[h];s++;new i(c,this.dd,n)}}}a=!0,0===s&&e()}});return t.namespace("DS/SPY/CATSimNavData3DRepStaticView",s)})),define("DS/SPY/CATSimNavData3DAnimationView",["UWA/Core","DS/SPY/CATSimNavData3DView","DS/Visualization/ThreeJS_DS"],(function(t,e,i){"use strict";const s=/[^;\[\]]+;[^;\[\]]+;[^;\[\]]+/g;let a=function(t){let e,s=t.split(";");if(3===s.length){let t=parseFloat(s[0]),a=parseFloat(s[1]),n=parseFloat(s[2]);isNaN(t)||isNaN(a)||isNaN(n)||(e=new i.Vector3(t,a,n))}return e},n=function(t){let e,n,r=[];for(;null!==(n=s.exec(t));)r.push(n[0]);if(4===r.length){let t=a(r[0]),s=a(r[1]),n=a(r[2]),o=a(r[3]);e=new i.Matrix4,e.set(t.x,s.x,n.x,o.x,t.y,s.y,n.y,o.y,t.z,s.z,n.z,o.z,0,0,0,1)}return e};const r="Geometry",o="Texture";class l{constructor(...t){this.files=[],this.status=[]}getPointedResource(t){let e;return t>=0&&t<this.files.length&&(e=this.files[t]),e}getSize(){return this.files.length}}class u extends l{constructor(...t){super(...t),this.matrices=[]}getMatrix(t){let e=null;return t>=0&&t<this.matrices.length&&(e=this.matrices[t]),e}}let h=e.extend({init:function(t,e,i,s){this._parent(t,e,i),this.impl={CATISimNavDataSpecUI:{module:"SPYUI",ext:"CATSimNavData3DAnimationViewUI",type:"data",obj:null},CATISimNavDataAnimation:{module:"SPYUI",ext:"CATSimNavData3DAnimationViewUI",type:"data",obj:null},CATISimNavDataExtremaProvider:{module:"SPY",ext:"CATSimNavData3DAnimationExtremaProvider",type:"data",obj:null}},this._frameSetConstructionMap={[r]:{fsConstructor:u,fsProperty:"_geometryFrameSet",fsFlag:"hasAGeometryFrameSet"},[o]:{fsConstructor:l,fsProperty:"_texturesFrameSet",fsFlag:"hasATextureFrameSet"},Instancing:{fsConstructor:l,fsProperty:"_instancingFrameSet",fsFlag:"hasAnInstancingFrameSet"}},this._frameSetConstructionMap.animation=this._frameSetConstructionMap[r],this.readFromXML(t,function(){s&&s(this)}.bind(this))},_frameSetFactory:function(t,e,i){let s=this._frameSetConstructionMap[t];if(s&&e&&!this[s.fsProperty]){this[s.fsProperty]=new s.fsConstructor;let t=this[s.fsProperty];this[s.fsFlag]=!0;for(let s=0;s<e.children.length;s++){let a,r=e.children[s],o=parseInt(r.getAttribute("srcId"));if(!isNaN(o)&&i){a=i.getEntry(o-1).val}else a=r.getAttribute("src");t.files.push(a),t.status.push(a?"notLoaded":"loaded");let l=r.getAttribute("matrix");if(l){if(l===this._lastMxStr&&this._lastMx)t.matrices.push(this._lastMx);else{let e=n(l);t.matrices.push(e),this._lastMx=e}this._lastMxStr=l}}}},readFromXML:function(t,e){let i=this.dd.spm.getDataList("src",this.dd.seq);for(let e=0;e<t.children.length;e++){let s=t.children[e];if("1"===s.getAttribute("level"))for(let t=0;t<s.children.length;t++){let e=s.children[t],a=e?e.getAttribute("type"):void 0;this._frameSetFactory(a,e,i)}}e(this)},getLoadingDescription:function(t,e){let i={};for(let s in this._frameSetConstructionMap)if(!e||e===s){let e=this[this._frameSetConstructionMap[s].fsProperty];e&&(i[s]={status:e.status[t],file:e.files[t],matrix:e.matrices?e.matrices[t]:void 0})}return e?i[e]:i},getAllLoadingDescription:function(t){let e={};for(let i in this._frameSetConstructionMap)t&&t!==i||(e[i]=this[this._frameSetConstructionMap[i].fsProperty]);return t?e[t]:e},setLoadingStatus:function(t,e,i){let s=i=>{let s=i&&i.fsProperty&&this[i.fsProperty]?this[i.fsProperty].status:void 0;Array.isArray(s)&&(s.length>1?t>=0&&t<s.length&&(s[t]=e):s[0]=e)};if(i){s(this._frameSetConstructionMap[i])}else for(let t in this._frameSetConstructionMap){s(this._frameSetConstructionMap[t])}},resetLoadingStatus:function(t){for(let e in this._frameSetConstructionMap)if(!t||t===e){let t=this._frameSetConstructionMap[e],i=t&&t.fsProperty&&this[t.fsProperty]?this[t.fsProperty].status:void 0;Array.isArray(i)&&i.forEach(((t,e)=>{i[e]="notLoaded"}))}},getGeometryFrameSet:function(){return this[this._frameSetConstructionMap[r].fsProperty]},getGeometryFiles:function(){let t=this.getGeometryFrameSet();return t?t.files:[]},getTextureFrameSet:function(){return this[this._frameSetConstructionMap[o].fsProperty]},getTextureFiles:function(){let t=this.getTextureFrameSet();return t?t.files:[]}});return t.namespace("DS/SPY/CATSimNavData3DAnimationView",h)})),define("DS/SPY/CATSimNavData3DVirtualComponent",["DS/SPY/CATSimNavData3DAnimationView"],(function(t){"use strict";var e=t.extend({init:function(t,e,i,s){this._isVirtual=!0,this._parent(t,e,i,(function(t){t.impl={CATISimNavDataSpecUI:{module:"SPYUI",ext:"CATSimNavData3DVirtualComponentUI",type:"data",obj:null},CATISimNavDataAnimation:{module:"SPYUI",ext:"CATSimNavData3DVirtualComponentUI",type:"data",obj:null}},s&&s(t)}))}});return UWA.namespace("DS/SPY/CATSimNavData3DVirtualComponent",e)})),define("DS/SPY/CATSimNavData3DElementView",["DS/SPY/CATSimNavData3DAnimationView"],(function(t){"use strict";return t.extend({init:function(t,e,i,s){this._parent(t,e,i,s),this.type="CATSimNavData3DAnimationView",this.suffix="CATSimNavData3DAnimationView"}})})),define("DS/SPY/LWTextureLoader",["DS/SPY/LWResourceLoader","DS/Visualization/ThreeJS_DS","DS/i3DxMdSimulationWeb/i3DxMSRFileTree"],(function(t,e,i){"use strict";let s=new e.Color;return t.extend({init:function(t){this._parent(t),this.window=t.window,this.eventsManager=t.eventsManager,this.eventContext=t.eventContext,this.progress={loaded:0,total:0},this.previousProgressPosition=0,this._canvas=document.createElement("canvas"),this._context2d=this._canvas.getContext("2d",{willReadFrequently:!0}),this._textureDataMap=new Map},clearLoadingQueue:function(t){this.progress.loaded=0,this.progress.total=0,this.window&&this.window.experience&&(t||this.window.experience.progress.updateProgression(0)),this._parent(t)},loadFiles:function(t){if(t&&t.filesList&&(t.manager||t.managers&&!isNaN(t.frameIndex))&&!isNaN(t.sequence)&&t.callback){if(0===t.filesList.length)return void t.callback();let i=this.filesToLoad.length>0;var e;if(this.filesToLoad=this.filesToLoad.concat(t.filesList),!t.framesIndices)for(t.framesIndices=[],e=0;e<t.filesList.length;e++)t.framesIndices.push(t.frameIndex);if(t.framesIndices&&t.framesIndices.length!==t.filesList.length&&console.error("SimulationPlayerModel - inconsistencies between files and frames indices to load"),this.framesIndices=this.framesIndices.concat(t.framesIndices),!t.managers)for(t.managers=[],e=0;e<t.filesList.length;e++)t.managers.push(t.manager);this.managers=this.managers.concat(t.managers),t.managers&&t.managers.length!==t.filesList.length&&console.error("SimulationPlayerModel - inconsistencies between files and managers list");let s=t.managers[0].id,a=this._getFramePostFix(t.framesIndices[0]),n=String(s)+a;if(!this.transactionMap.get(n)){let s={count:0,loadStatus:"loading",callbacks:[],analytics:{maxRscExtractionTime:0}};if(this.useProbe){let e=t.filesList.length>1?t.filesList.length.toString()+"_textures":t.filesList[0];s.probe=this.probesManager.createProbe("MsrEcSPMLoadFiles"+n+"_"+e)}s.sequence=t.sequence,s.count+=t.filesList.length,s.callbacks.push(t.callback),this.transactionMap.set(n,s),t.managers&&(e=0,t.managers.forEach(function(t){this.managerTransactionMap.set(String(t.id)+a,n)}.bind(this))),i?this.progress.total+=t.filesList.length:(this.progress.loaded=0,this.progress.total=t.filesList.length,this.window.experience&&(this.eventsManager.publish({event:this.eventContext+"/SPY/PROGRESS/INIT",data:{fromPreviousValue:!t.resetProgress}}),this.window.experience.modelLoadComplete=!1,this.window.experience.modelLoadCount=0,this.window.experience.modelPrevLoadCount=0))}}},onTextureLoadedCallback:function(t,e,i){t&&e&&i?e.setTexture(i,t):this.emptyRscTransactionCounter++,this._updateTransactionForManager(e,i),this.window.experience,this.processLoadFiles()},_loadRequest:function(t,s,a){var n=this.managerTransactionMap.get(String(t.id)+this._getFramePostFix(s));if(n){var r=this.transactionMap.get(n),o=r.sequence;if(a){if(!isNaN(o)){r.probe&&(r.probe.begin(),r.probe.started=!0);let n=a;if(a=this.spm.buildResourcePath(a,o),this.spm.sequences[o].zip){var l=this.spm.sequences[o].zip.find(a);if(l){let i=Date.now();l.getData64URI("image/png").then((a=>{let n=Date.now()-i;n>r.analytics.maxRscExtractionTime&&(r.analytics.maxRscExtractionTime=n);let o=a,l=new e.Texture,u=new Image;u.onload=()=>{l.image=u,l.needsUpdate=!0,this._canvas.width=l.image.width,this._canvas.height=l.image.height,this._context2d.drawImage(l.image,0,0);const e=this._context2d.getImageData(0,0,this._canvas.width,this._canvas.height),i=`${t.getId()}_${s}`;this._textureDataMap.set(i,e),this.onTextureLoadedCallback(l,t,s)},u.src=o}))}}else if(this.spm.sequences[o].key){let a=[n],l=this.spm.sequences[o],u=Date.now();i.getFileTreeDownloadURL(l.url,l.contextid,l.simId,l.resultRepId,l.key,a).then((i=>{let a=function(t,e){let i="";for(let e=0;e<t.length;e++)i+=String.fromCharCode(t[e]);return`data:${e};base64,${btoa(i)}`}(i[0].buffer,"image/png"),n=Date.now()-u;n>r.analytics.maxRscExtractionTime&&(r.analytics.maxRscExtractionTime=n);let o=a,l=new e.Texture,h=new Image;h.onload=()=>{l.image=h,l.needsUpdate=!0,this._canvas.width=l.image.width,this._canvas.height=l.image.height,this._context2d.drawImage(l.image,0,0);const e=this._context2d.getImageData(0,0,this._canvas.width,this._canvas.height),i=`${t.getId()}_${s}`;this._textureDataMap.set(i,e),this.onTextureLoadedCallback(l,t,s)},h.src=o}))}}}else"loading"===r.loadStatus&&(r.count--,0===r.count&&this._closeTransaction(n)),this.processLoadFiles(),0===this.filesToLoad.length&&this.onLoaderDoneCallback()}},processLoadFiles:function(){for(;this.filesToLoad.length>0;)this._loadRequest(this.managers.shift(),this.framesIndices.shift(),this.filesToLoad.shift())},initLoadingMap:function(){this.clearLoadingMap()},addToLoadingMap:function(){},clearLoadingMap:function(){this._parent(),this._textureDataMap.clear()},_getTextureData:function(t,e){if(t===this._lastElemId&&e===this._lastFrameIdx&&this._lastTexData)return this._lastTexData;let i=this._textureDataMap.get(`${t}_${e}`);return i&&(this._lastTexData=i,this._lastFrameIdx=e,this._lastElemId=t),i},_getColorFromTextureAt:function(t){let e=null,i=this._getTextureData(t.elemId,t.frameIdx);return i&&(e=((t,e,i,s,a)=>{const n=Math.round(s*(e-1)),r=4*((i-Math.round(a*(i-1)))*e+n),o=t.data;return{r:o[r],g:o[r+1],b:o[r+2],a:o[r+3]}})(i,this._canvas.width,this._canvas.height,t.u,t.v)),e},_getHueFromColor:function(t){return s.setRGB(t.r/255,t.g/255,t.b/255),s.getHSL().h},getValueFromPickingInfo:function(t){let e,i=this._getColorFromTextureAt({elemId:t.element.SPObj.getId(),frameIdx:t.frameIdx,u:t.u,v:t.v});if(i)if(0===i.r&&0===i.g&&0===i.b)console.warn(` rgb at 0 - incorrect uv? u:${t.u} v:${t.v}`);else{let t=this._getHueFromColor(i);e=this._hueScale*(t-this._minHue)+this._valShift}return e},setRangeColors:function(t){this._minHue=t.minHue,this._minValue=t.minValue,this._maxHue=t.maxHue,this._maxValue=t.maxValue;let e=this._maxValue-this._minValue,i=this._maxHue-this._minHue;this._hueScale=e/i,this._valShift=this._minValue}})})),define("DS/SPY/LWInstancingLoader",["DS/SPY/LWResourceLoader","DS/Visualization/ThreeJS_DS","DS/i3DxMdSimulationWeb/i3DxMSRFileTree"],(function(t,e,i){"use strict";return t.extend({init:function(t){this._parent(t),this.window=t.window,this.eventsManager=t.eventsManager,this.eventContext=t.eventContext,this.progress={loaded:0,total:0},this.previousProgressPosition=0},clearLoadingQueue:function(t){this.progress.loaded=0,this.progress.total=0,this.window&&this.window.experience&&(t||this.window.experience.progress.updateProgression(0)),this._parent(t)},loadFiles:function(t){if(t&&t.filesList&&(t.manager||t.managers&&!isNaN(t.frameIndex))&&!isNaN(t.sequence)&&t.callback){if(0===t.filesList.length)return void t.callback();var e,i=this.filesToLoad.length>0;if(this.filesToLoad=this.filesToLoad.concat(t.filesList),!t.framesIndices)for(t.framesIndices=[],e=0;e<t.filesList.length;e++)t.framesIndices.push(t.frameIndex);if(t.framesIndices&&t.framesIndices.length!==t.filesList.length&&console.error("SimulationPlayerModel - inconsistencies between files and frames indices to load"),this.framesIndices=this.framesIndices.concat(t.framesIndices),!t.managers)for(t.managers=[],e=0;e<t.filesList.length;e++)t.managers.push(t.manager);this.managers=this.managers.concat(t.managers),t.managers&&t.managers.length!==t.filesList.length&&console.error("SimulationPlayerModel - inconsistencies between files and managers list");var s=t.managers[0].id,a=this._getFramePostFix(t.framesIndices[0]),n=String(s)+a;if(!this.transactionMap.get(n)){var r={count:0,loadStatus:"loading",callbacks:[]};if(this.useProbe){var o=t.filesList.length>1?t.filesList.length.toString()+"_cgrs":t.filesList[0];r.probe=this.probesManager.createProbe("MsrEcSPMLoadFiles"+n+"_"+o)}r.sequence=t.sequence,r.count+=t.filesList.length,r.callbacks.push(t.callback),this.transactionMap.set(n,r),t.managers&&(e=0,t.managers.forEach(function(t){this.managerTransactionMap.set(String(t.id)+a,n)}.bind(this))),i?this.progress.total+=t.filesList.length:(this.progress.loaded=0,this.progress.total=t.filesList.length,this.window.experience&&(this.eventsManager.publish({event:this.eventContext+"/SPY/PROGRESS/INIT",data:{fromPreviousValue:!t.resetProgress}}),this.window.experience.modelLoadComplete=!1,this.window.experience.modelLoadCount=0,this.window.experience.modelPrevLoadCount=0))}}},_loadRequest:function(t,e,s){var a=this.managerTransactionMap.get(String(t.id)+this._getFramePostFix(e));if(a){var n=this.transactionMap.get(a),r=n.sequence;if(s){if(!isNaN(r)){n.probe&&(n.probe.begin(),n.probe.started=!0);let a=s;if(s=this.spm.buildResourcePath(s,r),this.spm.sequences[r].zip){var o=this.spm.sequences[r].zip.find(s);if(o){o.getBlob("text/plain",function(i){var s={positions:[],directions:[],scales:[],values:[],rotations:[],bidirectional:[],is3d:[],nInstances:0},a=new FileReader;a.addEventListener("loadend",function(){const i=new DataView(a.result);var n=0,r=i.getUint8(n);n+=2;var o=0!==r;i.getUint16(n,o);n+=2;i.getUint32(n,o);n+=4;var l=i.getUint32(n,o);for(s.nInstances=l,n+=4;n<i.byteLength;){var u=i.getUint32(n,o);n+=4;var h=i.getUint32(n,o);n+=4;var c=new Float32Array(i.buffer.slice(n,n+h));switch(n+=h,u){case 1:s.positions=c;break;case 2:s.directions=c;break;case 4:s.scales=c;break;case 8:s.values=c;break;case 16:s.rotations=c;break;case 32:s.bidirectional=c;break;case 64:s.is3d=c;break;default:continue}}this.onBufferLoadedCallback(s,t,e)}.bind(this)),a.readAsArrayBuffer(i)}.bind(this))}}else if(this.spm.sequences[r].key){let s=[a],n=this.spm.sequences[r];i.getFileTreeDownloadURL(n.url,n.contextid,n.simId,n.resultRepId,n.key,s).then((i=>{const s=new Blob([i[0].buffer],{type:"text/plain"});if(s){var a={positions:[],directions:[],scales:[],values:[],rotations:[],bidirectional:[],is3d:[],nInstances:0},n=new FileReader;n.addEventListener("loadend",function(){const i=new DataView(n.result);var s=0,r=i.getUint8(s);s+=2;var o=0!==r;i.getUint16(s,o);s+=2;i.getUint32(s,o);s+=4;var l=i.getUint32(s,o);for(a.nInstances=l,s+=4;s<i.byteLength;){var u=i.getUint32(s,o);s+=4;var h=i.getUint32(s,o);s+=4;var c=new Float32Array(i.buffer.slice(s,s+h));switch(s+=h,u){case 1:a.positions=c;break;case 2:a.directions=c;break;case 4:a.scales=c;break;case 8:a.values=c;break;case 16:a.rotations=c;break;case 32:a.bidirectional=c;break;case 64:a.is3d=c;break;default:continue}}this.onBufferLoadedCallback(a,t,e)}.bind(this)),n.readAsArrayBuffer(s)}}))}}}else"loading"===n.loadStatus&&(n.count--,0===n.count&&this._closeTransaction(a)),this.processLoadFiles(),0===this.filesToLoad.length&&this.onLoaderDoneCallback()}},processLoadFiles:function(){for(;this.filesToLoad.length>0;)this._loadRequest(this.managers.shift(),this.framesIndices.shift(),this.filesToLoad.shift())},initLoadingMap:function(){this.clearLoadingMap()},addToLoadingMap:function(){},onBufferLoadedCallback:function(t,i,s){if(t&&i&&null!=s){for(var a=[],n=[],r=[],o=[],l=[],u=[],h=[],c=0;c<t.positions.length;c+=3)a.push(new e.Vector3(t.positions[c],t.positions[c+1],t.positions[c+2])),n.push(new e.Vector3(t.directions[c],t.directions[c+1],t.directions[c+2]));for(c=0;c<t.scales.length;c++)r.push(t.scales[c]),o.push(t.values[c]),u.push(t.bidirectional[c]),h.push(t.is3d[c]);for(c=0;c<t.rotations.length;c+=2)l.push(new e.Vector2(t.rotations[c],t.rotations[c+1]));i.setBuffers(s,t.nInstances,a,n,r,o,l,u,h)}else this.emptyRscTransactionCounter++;this._updateTransactionForManager(i,s),this.window.experience,this.processLoadFiles()}})})),define("DS/SPY/CATSimNavDataPrimaryDico",["UWA/Core","UWA/Class","DS/SPY/CATSimNavDataHelper","DS/WebSystem/Environment"],(function(t,e,i,s){"use strict";var a=e.extend({init:function(t,e,i,s,a,n,r,o){this.category=t,this.id=e,this.isActive=!0===i,this.isAnimated=!0===s,this.name=a,this.numberOfCharts=isNaN(n)?0:n,this.thumbnail=r,this.subName=o||""},getCategory:function(){return this.category},getId:function(){return this.id},getIsActive:function(){return this.isActive},getIsAnimated:function(){return this.isAnimated},getName:function(){return this.name},getSubName:function(){return this.subName?this.subName:""},getNumberOfCharts:function(){return this.numberOfCharts},getThumbnail:function(){return this.thumbnail}}),n=e.extend({init:function(t,e,s,n){this.id=t,this.name=e,this.packetName=s,this.contents=n.map((function(t){var e=i.parseGroupIds(t.name);return e.length>1?(t.name=e[0],t.subName=e[1]):t.subName="",new a(t.category,t.id,t.isActive,t.isAnimated,t.name,t.numberOfCharts,t.thumbnail,t.subName)}))},getContents:function(){return this.contents}}),r=e.extend({init:function(t,e,i){const s=i&&i.categories?i.categories:[],r=!(!i||!i.excludedTypes)&&i.excludedTypes.includes("CATSimNavDataFrameViewXYChart");this.analysisCases=t.map((t=>{const e=t.contents.filter((t=>0===s.length||s.includes(t.category))).map((t=>new a(t.category,t.id,t.isActive,t.isAnimated,t.name,r?0:t.numberOfCharts,t.thumbnail,t.subName)));return new n(t.id,t.name,t.packetName,e)})),this.version=e},getNbAnalysisCases:function(){return this.analysisCases.length},getAllThumbnails:function(){return this.analysisCases.reduce((function(t,e,i){return t[i]=e.contents.map((function(t){return t.thumbnail})),t}),{})},getContents:function(t){return this.analysisCases[t].getContents()},getNbContents:function(t){const e=this.analysisCases.find((e=>t.contains(e.id)));return e?e.contents.length:0},getVersion:function(){return this.version},getDefaultSequence(){if(s.isSet("3DPlay.ActiveContentInPSR")){const t=this.analysisCases.findIndex((function(t){return t.getContents().some((function(t){return t.getIsActive()}))}));return-1!==t?t:0}return-1},getActiveSequence(){const t=s.isSet("3DPlay.ActiveContentInPSR")?this.analysisCases.findIndex((function(t){return t.getContents().some((function(t){return t.getIsActive()}))})):0;return-1!==t?t:0},getSequenceName(t){return t>=0&&t<this.analysisCases.length?this.analysisCases[t].name:null},getActiveContentName:function(t){if(t>=0&&t<this.analysisCases.length){const e=this.analysisCases[t].contents;if(s.isSet("3DPlay.ActiveContentInPSR")){const t=e.find((function(t){return t.getIsActive()}));if(t)return t.name}const i=e.find((function(t){return"Result"===t.category}));if(i)return i.name;const a=e.find((function(t){return"Scenario"===t.category}));if(a)return a.name;const n=e.find((function(t){return"Model"===t.category}));if(n)return n.name}return null}});return t.namespace("DS/SPY/CATSimNavDataPrimaryDico",r)})),define("DS/SPY/CATSimNavDataDisplay",["UWA/Core","DS/SPY/CATSimNavDataDisplayAbstract","DS/SPY/CATSimNavDataHelper"],(function(t,e,i){"use strict";const s="loaded",a="requested";var n={},r=e.extend({init:function(t,e,i,s,a){this._parent(t,e,i),this._constructionMap={DDElement2D:{itemList:this.list2DViews},DDElement3D:{itemList:this.list3DViews},DDElementFrame:{itemList:this.listFrameViews}},this.readFromXML(t,s,a)},_internalRead:function(t,e,i){var r=function(t){i&&i.noFrameViewSimplification||t.simplifyFrameViewList(),e&&e(t)},o=function(t){var e=!1;return i&&i.excludedTypes&&(e=i.excludedTypes.indexOf(t)>=0),e},l=function(t,e){var s=!1;if(i&&i.types){var a=i.types[t];s=a&&!isNaN(a.maxNb)&&e.nbInst>a.maxNb}return s},u={counter:0,loopCompleted:!1},h=this,c=function(){u.counter--,0===u.counter&&u.loopCompleted&&r(h)},d=function(t,e,s){return function(a){var n=new a(t,e,i,c);s.push(n)}};let m=this._constructionMap,f=function(){for(let r=0;r<t.children.length;r++){let S=t.children[r],v=m[S.nodeName];if(v){let t="DDElementFrame"===S.nodeName?"CATSimNavDataFrameView":S.getAttribute("type"),r=n[t];r&&(r.excluded||l(t,r)||(u.counter++,r.nbInst++,r.status===s?(e=S,o=r.typeClass,f=h,g=v.itemList,p=void 0,p=new o(e,f,i,c),g.push(p)):r.status===a&&r.queue&&r.queue.push(d(S,h,v.itemList))))}}var e,o,f,g,p;u.loopCompleted=!0,0===u.counter&&r(h)};for(var g={counter:0,loopCompleted:!1},p=function(t){return function(e){var i=n[t];if(i)for(i.status=s,i.typeClass=e;i.queue.length>0;)i.queue[0]&&(i.queue[0](e),i.queue.shift());g.counter--,0===g.counter&&g.loopCompleted&&f()}},S=0;S<t.children.length;S++){let e=t.children[S];if(m[e.nodeName]){let t="DDElementFrame"===e.nodeName?"CATSimNavDataFrameView":e.getAttribute("type"),i=n[t],s=o(t);i?s&&(n[t].excluded=!0):s||(g.counter++,n[t]={status:a,queue:[],nbInst:0},require(["DS/SPY/"+t],p(t)))}}g.loopCompleted=!0,0===g.counter&&f()},readFromXML:function(t,e,s){if("DataDisplay"===t.nodeName){this.id=t.getAttribute("id"),this.name=t.getAttribute("name");var a=i.parseGroupIds(this.name);a.length>1&&(this.name=a[0],this.subName=a[1]),this.type=t.getAttribute("type"),this.plotType=t.getAttribute("plotType"),this.category=t.getAttribute("category"),this.thumbnail=t.getAttribute("thumbnail"),this.isShared="Shared"===this.type,this._internalRead(t,e,s)}},extendFromXML:function(t,e,i){"DataDisplay"===t.nodeName&&this.id===t.getAttribute("id")&&this.name===t.getAttribute("name")&&(this.listFrameViews=[],this._constructionMap={DDElementFrame:{itemList:this.listFrameViews}},this._internalRead(t,e,i))},getMultiInstanciatedFiles:function(){var t=[];this.getNavData3DViewList(!0).forEach((function(e){e&&e.getGeometryFiles&&(t=t.concat(e.getGeometryFiles()))}));var e=this._getSortedDuplicates(t);return new Set(e)},getCameraRoot:function(){var t,e=this.getNavData3DViewList();if(e&&e.length)for(var i=0;i<e.length&&!t;i++){var s=e[i];"CATSimNavData3DCamerasRoot"===s.type&&(t=s)}return t},isEmpty:function(){let t=this._parent();return t&&Object.values(n).forEach((e=>{t&&e&&(t=e.status===s,t&&Array.isArray(e.queue)&&(t=0===e.queue.length))})),t}});return t.namespace("DS/SPY/CATSimNavDataDisplay",r)})),define("DS/SPY/CATSimNavDataLWFactory",["UWA/Core","DS/SPY/CATSimNavDataAbstractFactory","DS/WebSystem/Environment","DS/WebUtils/ProbesManager","DS/CoreEvents/Events","DS/ZipJS2/ZipJS2","DS/SPY/CATSimNavDataList","DS/SPY/CATSimNavDataDisplay"],(function(t,e,i,s,a,n,r,o){"use strict";const l=i.isSet("3DPlay.MockDownloadDelay")?3e3:NaN;n.configure({maxWorkers:4,terminateWorkerTimeout:NaN});var u=function(t,e){var i;if(t&&e){var s=e.getAttribute("id"),a=function(t){return s&&s===t.id};Array.isArray(t.listDD)&&(i=t.listDD.find(a)),!i&&Array.isArray(t.listDDShared)&&(i=t.listDDShared.find(a))}return i},h=e.extend({init:function(){this._parent()},_handleSequenceData:function(t,e,i,s,r){if("string"==typeof t&&t.length>0&&t.search("<")>=0){var o,l=(new DOMParser).parseFromString(t,"text/xml").firstChild;if(this.isExtendedMode()&&(d=e.spm,m=function(t){var e;if("SimDDTree"===t.nodeName)for(var i=0;i<t.childNodes.length;i++){var s=t.childNodes[i];"Scenario"===s.nodeName&&(e=s.getAttribute("name"))}return e}(l),d&&Array.isArray(d.sequences)&&m&&(f=d.sequences.find((function(t){return t&&t.name&&t.name.length>0&&t.name===m}))),o=f),!o){var u=e.spm.sequences.length;o={persistentId:e.src&&e.src.persistentId?e.src.persistentId:"",idx:e.src?isNaN(e.src.index)?u:e.src.index:u,name:"sequence",listDD:[],listDDShared:[],zip:e.zipEntries?e.shareZipEntries?s:new n.fs.FS:s,...e.src&&e.src.url&&{url:e.src.url},...e.src&&e.src.simId&&{simId:e.src.simId},...e.src&&e.src.resultRepId&&{resultRepId:e.src.resultRepId},...e.src&&e.src.contextid&&{contextid:e.src.contextid},...e.src&&e.src.key&&{key:e.src.key}},e.src&&e.src.analytics&&(o.analytics={dataSize:e.src.analytics.dataSize,streamingTime:e.src.analytics.streamingTime,extractionTime:Date.now()-r}),e.spm.sequences[o.idx]=o}var h=Date.now();this.parseXML(l,o,e.spm,(function(t,s){var n={spm:e.spm,seqIdx:o.idx,seqName:o.name,seqId:o.persistentId,filteredDDNb:s,annotations:e.annotations,state:e.state};o.analytics&&(o.analytics.dataModelCreationTime=Date.now()-h),i&&i.onComplete?i.onComplete(n):a.publish({event:e.spm.getContext()+"/SPY/SEQUENCE/CREATED",data:n})}),(function(t){e.spm._dataLists[o.idx]=void 0,e.spm.sequences[o.idx]=void 0;var s={spm:e.spm,seqIdx:o.idx,errorCode:t,analytics:e.src?e.src.analytics:void 0};i&&i.onError?i.onError(s):a.publish({event:e.spm.getContext()+"/SPY/SEQUENCE/ERROR",data:s})}))}else{var c={spm:e.spm};i&&i.onError?i.onError(c):a.publish({event:e.spm.getContext()+"/SPY/SEQUENCE/ERROR",data:c})}var d,m,f},createSequence:function(t,e){var i,a,r=Date.now();t.src?.uncompressed||((i=s.createProbe("MsrEcAccessToSequenceFiles")).begin(),t.shareZipEntries=void 0!==t.shareZipEntries&&t.shareZipEntries);var o=function(){if(t.src?.uncompressed||i.end(),a||t.src&&t.src.uncompressed){var n=s.createProbe("MsrEcAccessToSecondaryDictionary");if(n.begin(),t.src&&t.src.uncompressed){const i=t.src.buffer;if(i){const s=new TextDecoder("utf-8").decode(i);n.end(),this._handleSequenceData(s,t,e,a,r)}}else{const i=t.spm.buildResourcePath("SimNavData.xml",t.src?.index),s=a.find(i);s&&s.getText().then((i=>{n.end(),this._handleSequenceData(i,t,e,a,r)}))}}}.bind(this),u=function(){i.end(),alert("failed to open zip")};if(t)if(t.src&&t.src.uncompressed)try{o()}catch(t){u()}else if(t.zipEntries&&t.spm)a=t.zipEntries,o();else if(t.src&&t.spm){var h;switch(a=new n.fs.FS,t.src.provider){case"BLOB":a.importBlob(t.src.blob,{directAccess:!0}).then(o,u);break;case"BUFFER":var c=new Blob([new DataView(t.src.buffer)],{type:"application/zip"});a.importBlob(c).then(o,u);break;default:h=isNaN(l)||isNaN(t.src.filesize)?o:()=>{setTimeout(o,t.src.filesize/l)},a.importHttpContent(t.src,{useXHR:!1,preventHeadRequest:!0}).then(h,u)}}},parseXML:function(t,e,i,a,n,l,h){if("SimDDTree"===t.nodeName){var c=s.createProbe("MsrEcSecondaryDicParsing");c.begin(),this._extensionFilter&&(l=this._extensionFilter);let F=(t,e,i)=>{let s;return h&&h.targetDocument&&(s=h.targetDocument.importNode(t,e),s&&(e&&Array.isArray(h.excludedTags)&&h.excludedTags.forEach((t=>{let e=s.getElementsByTagName(t);for(;e.length>0;)e[0].remove()})),i?i.appendChild(s):h.targetDocument.getRootNode().appendChild(s))),s};var d=F(t,!1),m=0,f=!1,g=!1,p=t.getAttribute("name");i.simulationName=p&&p.length>0?p:i.simulationName,i.disclaimer=t.getAttribute("disclaimer"),i.logo=t.getAttribute("logo"),i._isYaxisUp="true"===t.getAttribute("yAxisUp");var S,v=[],D=0,N=function(){for(var t=e.listDD.length-1;t>=0;)e.listDD[t].isEmpty()&&(e.listDD.splice(t,1),D++),t--},b=0;const E=function(t,e,i){let s=0;for(const r of t.childNodes)if("Scenario"===r.nodeName&&(e.dataLevel=parseInt(r.getAttribute("level")),!(e.level<e.dataLevel)))for(const t of r.children)if("DataDisplay"===t.nodeName){var a=!1,n="Shared"===t.getAttribute("type");i&&(i.specificContent?a=i.specificContent!==t.getAttribute("id"):Array.isArray(i.categories)&&(a=i.categories.indexOf(t.getAttribute("category"))<0)),!n&&a||s++}return s}(t,i,l);0==E&&i.updateStreamProgess(e.persistentId,100);for(var C=function(t){if(t&&t.analytics){var s=t.analytics;s.dataModelCreationTime=Date.now()-S,s.numberOfFrames=t.getTotalNumberOfFrames(),s.extractionTime=0}i.updateContentProgess(t.id,100);let r=66+ ++b/E*34;i.updateStreamProgess(e.persistentId,r),0===--m&&f&&(e.listDD=v.concat(e.listDD),N(),c.end(),e.listDD.length>0?a(i,D):n("FILTEREDCONTENT"))},x=0;x<t.childNodes.length;x++){var A=t.childNodes[x];if("Scenario"===A.nodeName&&(i.dataLevel=parseInt(A.getAttribute("level")),!(i.level<i.dataLevel))){var y=F(A,!1,d);e.name=A.getAttribute("name");for(var L=0;L<A.children.length;L++){var T=A.children[L];if("List"===T.nodeName){if(!i.getDataList(T.getAttribute("name"),e.idx)){var _=new r(T);i.addDataList(_,e.idx)}F(T,!0,y)}else if("DataDisplay"===T.nodeName){var P=!1,M="Shared"===T.getAttribute("type");if(l&&(l.specificContent?P=l.specificContent!==T.getAttribute("id"):Array.isArray(l.categories)&&(P=l.categories.indexOf(T.getAttribute("category"))<0)),M||!P){m++,g=!0;var I=u(e,T);I?I.extendFromXML(T,C,l):(i.updateContentProgess(T.getAttribute("id"),0),S=Date.now(),I=new o(T,i,e.idx,C,l),M?e.listDDShared.push(I):v.push(I));var w=F(T,!0,y);w&&l.specificContent&&!P&&(i.importedSpecificContent=w)}}}}}f=!0,g?0===m&&(e.listDD=v.concat(e.listDD),N(),c.end(),e.listDD.length>0?a(i,D):n("FILTEREDCONTENT")):(c.end(),n("INVALIDDATA"))}else n()},setExtendedMode:function(t){this._extensionFilter=t?{types:{CATSimNavData3DCamerasRoot:{maxChildrenNb:1,disableTracking:!0}}}:void 0}});return t.namespace("DS/SPY/CATSimNavDataLWFactory",h)})),define("DS/SPY/CATSimNavDataMediaFactory",["UWA/Core","DS/SPY/CATSimNavDataLWFactory"],(function(t,e){"use strict";let i=e.extend({init:function(t){this._selectedDDId=t?t.ddId:void 0,this._parent(),this.filteringOptions={specificContent:this._selectedDDId,excludedTypes:["CATSimNavDataFrameViewXYChart","CATSimNavData3DVirtualComponent"],types:{CATSimNavData3DCamerasRoot:{maxChildrenNb:1,disableTracking:!0}}}},parseXML:function(t,e,i,s,a){i.importedDom=document.implementation.createDocument("","",null);let n={targetDocument:i.importedDom,excludedTags:["DDXYPlot","DDXYChart"]};this._parent(t,e,i,s,a,this.filteringOptions,n)}});return t.namespace("DS/SPY/CATSimNavDataMediaFactory",i)})),define("DS/SPY/CATSimNavData3DSimFactory",["UWA/Core","DS/SPY/CATSimNavDataLWFactory","DS/ZipJS2/ZipJS2"],(function(t,e,i){"use strict";var s=e.extend({init:function(){this._parent()},createSequence:function(t){var e,s=this._parent.bind(this),a=function(){if(e){var i=e.find("SimulationExperienceContent.simxml");if(i){i.getBlob("application/zip").then((function(i){t.src.provider="BLOB",t.src.blob=i,t.src.filename=void 0;var a=function(){var i=e.find("SimulationExperienceState.json");i?i.getText().then((function(e){"string"==typeof e&&e.length>0&&(t.state=e),s(t)})):s(t)},n=e.find("annotations.json");n?n.getText().then((function(e){"string"==typeof e&&e.length>0&&(t.annotations=e),a()})):a()}))}}},n=function(){alert("failed to open 3dsim zip")};t&&t.src&&t.spm&&(e=new i.fs.FS,"BLOB"===t.src.provider?e.importBlob(t.src.blob,{directAccess:!0}).then(a,n):e.importHttpContent(t.src,{useXHR:!1,preventHeadRequest:!0}).then(a,n))},parseXML:function(t,e,i,s,a,n){"SimDDTree"===t.nodeName&&(i.originURL=t.getAttribute("originURL")),this._parent(t,e,i,s,a,n)}});return t.namespace("DS/SPY/CATSimNavData3DSimFactory",s)})),define("DS/SPY/CATSimNavDataLWSensorsFactory",["UWA/Core","DS/SPY/CATSimNavDataLWFactory"],(function(t,e){"use strict";var i=e.extend({init:function(){this._parent(),this.filteringOptions={categories:["Result"],info:!0,noFrameViewSimplification:!0,types:["CATSimNavData3DAnimationView","CATSimNavData3DCamerasRoot","CATSimNavData2DLegend"]}},parseXML:function(t,e,i,s,a){this._parent(t,e,i,s,a,this.filteringOptions)}});return t.namespace("DS/SPY/CATSimNavDataLWSensorsFactory",i)})),define("DS/SPY/CATSimNavDataLWPreviewFactory",["UWA/Core","DS/SPY/CATSimNavDataLWFactory"],(function(t,e){"use strict";var i=e.extend({init:function(){this._parent(),this.filteringOptions={categories:["Result"],excludedTypes:["CATSimNavDataFrameView"],types:{CATSimNavData3DCamerasRoot:{maxChildrenNb:1,disableTracking:!0}}}},parseXML:function(t,e,i,s,a){this._parent(t,e,i,s,a,this.filteringOptions)}});return t.namespace("DS/SPY/CATSimNavDataLWPreviewFactory",i)})),define("DS/SPY/CATSimNavDataLWBasicFactory",["UWA/Core","DS/SPY/CATSimNavDataLWFactory"],(function(t,e){"use strict";var i=e.extend({init:function(){this._parent(),this.filteringOptions={categories:["Result"],excludedTypes:["CATSimNavDataFrameViewXYChart"],types:{CATSimNavData3DCamerasRoot:{maxChildrenNb:1,disableTracking:!0}}}},parseXML:function(t,e,i,s,a){this._parent(t,e,i,s,a,this.filteringOptions)}});return t.namespace("DS/SPY/CATSimNavDataLWBasicFactory",i)})),define("DS/SPY/CATSimNavData3DCamera",["UWA/Core","DS/SPY/CATSimNavDataSpec","DS/SPY/CATSimNavDataLink","DS/Visualization/ThreeJS_DS"],(function(t,e,i,s){"use strict";var a=e.extend({init:function(t,e,i,s){this._parent(t,e),this.impl={CATISimNavDataAnimation:{module:"SPYUI",ext:"CATSimNavData3DAnimationCameraUI",type:"data",obj:null}},this._isTracking=!1,this._lockedDOF={},this.readFromXML(t,i,s)},setFromViewpoint:function(t){t&&(this._sightDirection=t.getSightDirection(),this._upDirection=t.getUpDirection(),this._eyePosition=t.getEyePosition(),this._focus=t.getTargetDistance(),this._angle=t.getAngle())},getThumbnail:function(){return this._thumbnail},getEyePosition:function(){return this._eyePosition},getSightDirection:function(){return this._sightDirection},getUpDirection:function(){return this._upDirection},getTargetDistance:function(){return this._focus},getAngle:function(){return this._angle},getLockedDOF:function(){return this._lockedDOF},getDescription:function(){return this._description?this._description:""},isTracking:function(){return this._isTracking},readFromXML:function(t,e,a){if(t){this._thumbnail=t.getAttribute("thumbnail");for(var n=t.getAttribute("camera").split("]"),r=0;r<n.length;++r)n[r]=n[r].replace("[","");var o=n[0].split(";");this._eyePosition=new s.Vector3(Number(o[0]),Number(o[1]),Number(o[2]));var l=n[1].split(";");this._sightDirection=new s.Vector3(Number(l[0]),Number(l[1]),Number(l[2]));var u=n[2].split(";");this._upDirection=new s.Vector3(Number(u[0]),Number(u[1]),Number(u[2])),this._focus=Number(t.getAttribute("focus"));var h=t.getAttribute("angle");this._angle=h?Number(h):45;var c=!1,d=t.getAttribute("lock");if(d){var m=d.split(";");if(m.length>0){c=!0;for(var f=0;f<m.length;++f)Object.defineProperty(this._lockedDOF,m[f],{value:!0,writable:!1})}}c||(this._lockedDOF=void 0),this._description=t.getAttribute("description");for(var g=null,p=0;p<t.childNodes.length;p++){var S=t.childNodes[p];if("LinkSet"===S.nodeName&&"CamerasToPart"===S.getAttribute("role")){for(var v=0;v<S.childNodes.length;v++){var D=S.childNodes[v];if("InternalRef"===D.nodeName){g=D;break}}break}}if(g)new i(g,this.dd,function(t){this.addLink("CamerasToPart",t),this._isTracking=!0!==e}.bind(this));a(this)}},writeToXML:function(t){if(t){var e=t.ownerDocument.createElement("Camera");e.setAttribute("type","CATSimNavData3DCamera"),this.name&&e.setAttribute("name",this.name),this.id&&e.setAttribute("id",this.id);var i=[];i.push("[",this._eyePosition.x.toString(),";",this._eyePosition.y.toString(),";",this._eyePosition.z.toString(),"]"),i.push("[",this._sightDirection.x.toString(),";",this._sightDirection.y.toString(),";",this._sightDirection.z.toString(),"]"),i.push("[",this._upDirection.x.toString(),";",this._upDirection.y.toString(),";",this._upDirection.z.toString(),"]"),e.setAttribute("camera",i.join("")),e.setAttribute("focus",this._focus),e.setAttribute("angle",this._angle),t.appendChild(e)}}});return t.namespace("DS/SPY/CATSimNavData3DCamera",a)})),define("DS/SPY/CATSimNavData3DCamerasRoot",["UWA/Core","DS/SPY/CATSimNavDataSpec","DS/SPY/CATSimNavData3DCamera"],(function(t,e,i){"use strict";var s=e.extend({init:function(t,e,i,s){this._parent(t,e),this.impl={CATISimNavDataAnimation:{module:"SPYUI",ext:"CATSimNavData3DCamerasRootAnimationUI",type:"data",obj:null}},this._cameraList=[],this._currentCameraIdx=0,this.readFromXML(t,i,s)},addCamera:function(t){t&&this._cameraList.push(t)},getCamera:function(t){return this._cameraList[t]},getListCamera:function(){return this._cameraList},getCurrentCamera:function(){return this._cameraList[this._currentCameraIdx]},getCurrentCameraIdx:function(){return this._currentCameraIdx},setCurrentCamera:function(t){return t!==this._currentCameraIdx&&t>=0&&t<this._cameraList.length&&(this._currentCameraIdx=t),this._currentCameraIdx},setCurrentCameraFromId:function(t){var e=this._cameraList.findIndex((function(e){return e.getId()===t}));return this.setCurrentCamera(e)},readFromXML:function(t,e,s){if(t){var a={counter:0,loopCompleted:!1},n=parseInt(t.getAttribute("currentCamera"));n=isNaN(n)?1:n,this._currentCameraIdx=n-1;for(var r=function(t){t&&(this.addCamera(t),a.counter--,0===a.counter&&a.loopCompleted&&s&&s())}.bind(this),o=e&&e.types?e.types[this.type]:void 0,l=o&&o.disableTracking,u=o&&!isNaN(o.maxChildrenNb)?o.maxChildrenNb:t.children.length,h=0;h<u;h++){var c=t.children[h];if(!(c.nodeName.indexOf("Camera")<0)){a.counter++;new i(c,this.dd,l,r)}}a.loopCompleted=!0,0===a.counter&&s()}},getLoadingDescription:function(){return{status:"loaded"}},writeToXML:function(t){if(t){var e=t.ownerDocument.createElement("DDElement3D");e.setAttribute("type","CATSimNavData3DCamerasRoot"),this.name&&e.setAttribute("name",this.name),this.id&&e.setAttribute("id",this._id),isNaN(this._currentCameraIdx)||e.setAttribute("currentCamera",this._currentCameraIdx+1),t.appendChild(e);var i=this.getListCamera();i&&i.forEach((function(t){t.writeToXML(e)}))}}});return t.namespace("DS/SPY/CATSimNavData3DCamerasRoot",s)})),define("DS/SPY/LW3DModelLoader",["DS/SPY/LWResourceLoader","DS/Visualization/Node3D","DS/Visualization/ModelLoader","DS/i3DxMdSimulationWeb/i3DxMSRFileTree"],(function(t,e,i,s){"use strict";return t.extend({init:function(t){this._parent(t),this.eventsManager=t.eventsManager,this.eventContext=t.eventContext,this.emptyRscTransactionCounter=0,this.progress={loaded:0,total:0},this.previousProgressPosition=0,this.window=t.window;t.viewer;this._modelLoader=new i,this._modelLoader.setOnLoadedCallback(this.onLoaderDoneCallback.bind(this)),this._modelLoader.setOnLoadedProductStructureCallback(this.onModelLoadedCallback.bind(this))},clearLoadingQueue:function(t){this._notYetLoadingProbe=null;let e=[];this.transactionMap.forEach((function(t,i){"loading"===t.loadStatus&&e.push(i)}));let i=[];if(e.forEach((t=>{var e=this._getFrameIdx(t);isNaN(e)||i.push(e)})),this.viewerRoot){let t=this.viewerRoot;i.forEach((e=>{t.traverse((t=>{t.children.forEach((i=>{i._SPYFrameIndex===e&&t.remove(i)}))}))}))}if(this.progress.loaded=0,this.progress.total=0,this.window&&this.window.experience){this.window.experience.modelLoadComplete=!0,this.window.experience.modelLoadCount=0,this.window.experience.modelPrevLoadCount=0;let e=this._modelLoader;if(e){e.abort();let t=e.cgrLoader;t&&t.cleanLoader(),e.setOnLoadedCallback(this.onLoaderDoneCallback.bind(this)),e.setOnLoadedProductStructureCallback(this.onModelLoadedCallback.bind(this))}t||this.window.experience.progress.updateProgression(0)}this._parent(t)},loadFiles:function(t){if(t&&t.filesList&&(t.fatherNode||t.fatherNodes&&!isNaN(t.frameIndex))&&!isNaN(t.sequence)&&t.callback){if(0===t.filesList.length)return void t.callback();let e,i=this.filesToLoad.length>0;if(this.filesToLoad=this.filesToLoad.concat(t.filesList),!this._notYetLoadingProbe&&this.filesToLoad.length>=4&&(this._notYetLoadingProbe=this.probesManager.createProbe("MsrEc3DNotYetLoading"),this._notYetLoadingProbe.begin(),this._notYetLoadingProbe.started=!0),!t.framesIndices)for(t.framesIndices=[],e=0;e<t.filesList.length;e++)t.framesIndices.push(t.frameIndex);if(t.framesIndices&&t.framesIndices.length!==t.filesList.length&&console.error("SimulationPlayerModel - inconsistencies between files and frames indices to load"),this.framesIndices=this.framesIndices.concat(t.framesIndices),!t.fatherNodes)for(t.fatherNodes=[],e=0;e<t.filesList.length;e++)t.fatherNodes.push(t.fatherNode);this.managers=this.managers.concat(t.fatherNodes),t.fatherNodes&&t.fatherNodes.length!==t.filesList.length&&console.error("SimulationPlayerModel - inconsistencies between files and father node list");let s=t.fatherNodes[0].id,a=this._getFramePostFix(t.framesIndices[0]),n=String(s)+a;if(!this.transactionMap.get(n)){let s={count:0,loadStatus:"loading",callbacks:[],analytics:{maxRscExtractionTime:0}};if(this.useProbe){let e=t.filesList.length>1?t.filesList.length.toString()+"_cgrs":t.filesList[0];s.probe=this.probesManager.createProbe("MsrEcSPMLoadFiles"+n+"_"+e)}s.sequence=t.sequence,s.count+=t.filesList.length,s.callbacks.push(t.callback),this.transactionMap.set(n,s),t.fatherNodes&&(e=0,t.fatherNodes.forEach((t=>{this.managerTransactionMap.set(String(t.id)+a,n)}))),i?this.progress.total+=t.filesList.length:(this.progress.loaded=0,this.progress.total=t.filesList.length,this.window.experience&&(this.eventsManager.publish({event:this.eventContext+"/SPY/PROGRESS/INIT",data:{fromPreviousValue:!t.resetProgress}}),this.window.experience.modelLoadComplete=!1,this.window.experience.modelLoadCount=0,this.window.experience.modelPrevLoadCount=0))}}},_cleaningInterruptedTransaction:function(t,e){t.parents[0]&&t.parents[0].traverse((function(t){t.children.forEach((function(i){i._SPYFrameIndex===e&&t.remove(i)}))}))},_getNodeToReuse:function(t){var e;return t&&"loaded"===t.status&&t.usages&&t.usages.length>0&&(e=t.usages[0].children[0]),e},_reuseNode:function(t,i,s){var a=new e;isNaN(i)||(a._SPYFrameIndex=i),a.addChild(s),a.setVisibility(!1),t.addChild(a),this._updateTransactionForManager(t,i),this.processLoadFiles(),0===this.filesToLoad.length&&this.onLoaderDoneCallback()},_loadRequest:function(t,i,a){let n,r,o=a;if(a&&(r=this.loadingMap.get(a)),n=this._getNodeToReuse(r),n)this._reuseNode(t,i,n);else{let n=this.managerTransactionMap.get(String(t.id)+this._getFramePostFix(i));if(n){let h=this.transactionMap.get(n),c=h.sequence;if(a){if(!isNaN(c)){var l=new e;if(isNaN(i)||(l._SPYFrameIndex=i),t.addChild(l),l.setVisibility(!1),r&&"loading"===r.status)r.usages.push(l);else{r&&(t._SPYMultipleUsages=!0,r.status="loading",r.usages.push(l)),h.probe&&(h.probe.begin(),h.probe.started=!0);let i,n=(a=this.spm.buildResourcePath(a,c)).split(".").pop(),u="glb"==n;u?i=this.spm.getGltfLoader():(i=this._modelLoader,i.setKeepLoaderMode(!0),i.fileType=n);let d=this.spm.sequences[c].ecStreamsAccess;if(d)d.load({streamName:a}).then((t=>{if(u)if(t.getUint8Array().length>1e3)i.load(t.getUint8Array()).then((t=>{l.addChild(t);let e={nodes:[t]};this.onModelLoadedCallback(e)}));else{let t=new e;l.addChild(t);let i={nodes:[t]};this.onModelLoadedCallback(i)}else i.loadModelFromBuffer(t.getUint8Array(),l)}));else if(this.spm.sequences[c].zip){let t=this.spm.sequences[c].zip.find(a);if(t){let e=Date.now();this._notYetLoadingProbe&&this._notYetLoadingProbe.started&&(this._notYetLoadingProbe.end(),this._notYetLoadingProbe.started=!1),t.getUint8Array().then((t=>{let s=Date.now()-e;s>h.analytics.maxRscExtractionTime&&(h.analytics.maxRscExtractionTime=s),i.loadModelFromBuffer(t,l)}))}}else if(this.spm.sequences[c].key){let t=[o],e=this.spm.sequences[c];s.getFileTreeDownloadURL(e.url,e.contextid,e.simId,e.resultRepId,e.key,t).then((t=>{if(t){let e=Date.now();this._notYetLoadingProbe&&this._notYetLoadingProbe.started&&(this._notYetLoadingProbe.end(),this._notYetLoadingProbe.started=!1);let s=t[0].buffer,a=Date.now()-e;a>h.analytics.maxRscExtractionTime&&(h.analytics.maxRscExtractionTime=a),i.loadModelFromBuffer(s,l)}})).catch((t=>{console.error("Error while loading CGR file:",t)}))}}}}else{var u=new e;isNaN(i)||(u._SPYFrameIndex=i),t.addChild(u),u.setVisibility(!1),"loading"===h.loadStatus&&(h.count--,0===h.count&&this._closeTransaction(n)),this.processLoadFiles(),0===this.filesToLoad.length&&this.onLoaderDoneCallback()}}}},processLoadFiles:function(){if(this.filesToLoad.length>0){let t=[],e=function(){t.push({fatherNode:this.managers.shift(),frameIndex:this.framesIndices.shift(),cgrFileToLoad:this.filesToLoad.shift()})}.bind(this),i=this._modelLoader.cgrLoader;if(i)for(;i.currentDownload+t.length<i.maxParrallelDownload&&this.managers.length>0;)e();else e();for(;t.length>0;){let e=t.shift();this._loadRequest(e.fatherNode,e.frameIndex,e.cgrFileToLoad)}}},_addToLoadingMap:function(t){let e=this.loadingMap;e&&t&&t.forEach((t=>{e.set(t,{status:"notLoaded",usages:[]})}))},initLoadingMap:function(t){this.clearLoadingMap(),this._addToLoadingMap(t)},addToLoadingMap:function(t){this._addToLoadingMap(t)},onModelLoadedCallback:function(t){let e,i;if(t.nodes&&t.nodes.length>0){let s=t.nodes[0].parents[0];if(e=s.parents[0],i=s._SPYFrameIndex,e&&e._SPYMultipleUsages){let t=[];this.loadingMap.forEach((e=>{if(0===t.length){let i=e;if("loading"===i.status){i.usages.indexOf(s)>=0&&(t=i.usages,i.status="loaded")}}})),t.forEach((t=>{if(t!==s&&t.id!==s.id){t.addChild(s.children[0]);let e=t.parents[0];this._updateTransactionForManager(e,i)}}))}}else this.emptyRscTransactionCounter++;this._updateTransactionForManager(e,i),this.window.experience&&(this.progress.loaded++,this.eventsManager.publish({event:this.eventContext+"/SPY/PROGRESS/UPDATE",data:{value:this.progress.loaded,total:this.progress.total}}),this.window.experience.modelLoadCount=this.progress.loaded),this.processLoadFiles()}})})),define("DS/SPY/CATSimNavDataXYCurve",["DS/SPY/CATSimNavDataXYValue","DS/SPY/CATSimNavDataHelper"],(function(t,e){"use strict";var i=function(t,e,i,s){this.listValues=[],this.listGroups=[],this.isCrossGroup=!1,this.isCrossGroupNoMode=!1,this.hasPositions=!0,this.curveStyle={},this.readFromXML(t,e,i,s)};return i.prototype.getMetadata=function(){return{name:this.name,rootName:this.rootName,loadCaseName:this.loadCaseName,nameX:this.nameX,nameY:this.nameY,isBarChart:this.isBarChart,isCrossGroup:this.isCrossGroup,isCrossGroupNoMode:this.isCrossGroupNoMode,hasPositions:this.hasPositions,isBijective:this.isBijective,isFilled:this.isFilled,isStacked:this.isStacked}},i.prototype.getCurveStyle=function(){return this.curveStyle},i.prototype.getAssignedAxisX=function(){return this.assignedAxisX},i.prototype.setAssignedAxisX=function(t){this.assignedAxisX=t},i.prototype.getAssignedAxisY=function(){return this.assignedAxisY},i.prototype.setAssignedAxisY=function(t){this.assignedAxisY=t},i.prototype.getGroups=function(){return this.listGroups},i.prototype.getValues=function(){return this.listValues},i.prototype.addValue=function(t){t&&this.listValues&&(this.listValues.push(t),this.hasPositions=this.hasPositions&&!isNaN(t.getPosition()))},i.prototype.stack=function(t){if(this.isStacked&&t.isStacked)for(var e=0;e<this.listValues.length;e++)this.listValues[e].setY(this.listValues[e].getY()+t.listValues[e].getY())},i.prototype.ratio=function(t){if(this.isStacked&&t.isStacked)for(var e=0;e<this.listValues.length;e++){var i=t.listValues[e].getY();0!==i?this.listValues[e].setY(100*this.listValues[e].getY()/i):this.listValues[e].setY(0)}},i.prototype.setTo100=function(){if(this.isStacked)for(var t=0;t<this.listValues.length;t++){0!==this.listValues[t].getY()&&this.listValues[t].setY(100)}},i.prototype.readFromXML=function(i,s,a,n){if(n&&(this.rootName=n.rootName,this.loadCaseName=n.loadName),i&&("Curve"===i.nodeName||"DDXYPlot"===i.nodeName)){this.name=i.getAttribute("name"),this.nameX=i.getAttribute("nameX"),this.nameY=i.getAttribute("nameY"),this.assignedAxisX=parseInt(i.getAttribute("axisX")),this.assignedAxisY=parseInt(i.getAttribute("axisY")),this.curveStyle.color=i.getAttribute("color"),this.curveStyle.lineStyle=i.getAttribute("lineStyle"),this.curveStyle.lineWidth=i.getAttribute("lineWidth"),this.curveStyle.markerSize=parseInt(i.getAttribute("markerSize")),this.curveStyle.markerSize=!isNaN(this.curveStyle.markerSize)&&this.curveStyle.markerSize>3?3:this.curveStyle.markerSize,this.curveStyle.markerColor=i.getAttribute("markerColor"),this.curveStyle.markerPeriod=parseInt(i.getAttribute("markerPeriod")),this.curveStyle.markerPeriod=!isNaN(this.curveStyle.markerPeriod)&&this.curveStyle.markerPeriod>=1?this.curveStyle.markerPeriod:1,this.curveStyle.lineWidth,this.isFilled="true"===i.getAttribute("filled"),this.isStacked="true"===i.getAttribute("stacked"),this.isBarChart=!1;var r=i.getAttribute("valuesX"),o=i.getAttribute("valuesY");if(r&&o){var l=r.split(" "),u=o.split(" ");if(l&&""===l[l.length-1]&&l.pop(),u&&""===u[u.length-1]&&u.pop(),l.length===u.length)for(var h={x:0,y:0},c=function(t){t.setX(h.x),t.setY(h.y),this.addValue(t)}.bind(this),d=0;d<l.length;d++){h.x=Number(l[d]),h.y=Number(u[d]),new t(i,c).setIndex(d)}}if(!r&&!o&&i.hasChildNodes()){this.isBarChart=!0;var m,f,g,p,S,v=function(t){this.addValue(t)}.bind(this),D=0;this.isBijective=!0;for(var N=s&&s.modelMgr.getDataList?s.modelMgr.getDataList("grp",s.sequence):void 0,b=i.firstChild,C=0;null!=b;){if(1===b.nodeType){var x=b,A=!0;D++;var y,L,T=void 0,_=x.getAttribute("frmId");if(_&&s&&s.modelMgr.getFrameDetails)y=(T=s.modelMgr.getFrameDetails(s.sequence,_)).group;else{var P=x.getAttribute("grpId");P&&N?T={group:y=N.getEntry(parseInt(P)-1).val}:y=x.getAttribute("group")}var M=y?e.parseGroupIds(y):[];if(L=e.buildGroupIdNoMode(M[0],M[1]),g=M[0],n&&(A=g===n.rootName&&M[1]===n.loadName),A){y?(m&&m===y?this.isBarChart&&(this.isBarChart=!1):(this.listGroups.push(y),this.isCrossGroupNoMode||(this.isCrossGroupNoMode=f&&f!==L),this.isCrossGroup=this.listGroups.length>1),m=y,f=L):this.isBarChart=!1,_&&(this.isBarChart=!1);var I=new t(x,v,T);if(isNaN(I.getX())&&I.setX(D),I.setIndex(C),this.isBijective){var w=I.getX();if(!isNaN(p)){var F=w-p;isNaN(S)||(this.isBijective=F*S>0),S=F}p=w}}C++}b=b.nextSibling}}}1===this.listGroups.length&&void 0===this.rootName&&(this.rootName=e.parseGroupIds(this.listGroups[0])[0]),a&&a(this)},i})),define("DS/SPY/CATSimNavDataFrameViewXYChart",["UWA/Core","DS/WebUtils/ProbesManager","DS/SPY/CATSimNavDataFrameViewComp","DS/SPY/CATSimNavDataXYCurve","DS/SPY/CATSimNavDataChartAxis","DS/SPY/CATSimNavDataHelper"],(function(t,e,i,s,a,n){"use strict";let r=i.extend({init:function(t,e,i,s){this.type="CATSimNavDataFrameViewXYChart",this._parent(t,e),this.impl={CATISimNavDataSpecUI:{module:"SPYExtUI",ext:"CATSimNavDataFrameViewXYChartUI",type:"data",obj:null},CATISimNavDataAnimation:{module:"SPYExtUI",ext:"CATSimNavDataFrameViewXYChartUI",type:"data",obj:null}},this.isExtractable=!0,this.listCurves=[],this.axis={x:[],y:[]},this._idForAxis=1,this.listCurvesGroupNames=[],this.analytics={},this.readFromXML(t,s,e)},computeNbCharts:function(){this._nbCharts=1},getMetadata:function(){return{name:this.name,distribution:this.distribution,animation:this.animation,isBarChart:this.isBarChart,isCrossGroup:this.isCrossGroup,isCrossGroupNoMode:this.isCrossGroupNoMode,oneCurvePerGroup:this.oneCurvePerGroup,hasPositions:this.hasPositions,linkAllCurvesAsOneSerie:this.linkAllCurvesAsOneSerie,alignTicks:this.alignTicks,secondaryGridLines:this.secondaryGridLines}},getCurves:function(){return this.computePositions(),this.listCurves},addCurve:function(t){if(t&&this.listCurves&&t.getValues().length>0){this.listCurves.push(t);let e=t.getMetadata();this.isCrossGroup=e.isCrossGroup,this.isCrossGroupNoMode=e.isCrossGroupNoMode;let i=(t,e)=>(t.indexOf(e)<0&&t.push(e),t);if(e.rootName){this.listCurvesGroupNames.push(e.rootName+" "+e.loadCaseName);let t=this.listCurvesGroupNames.reduce(i,[]);this.oneCurvePerGroup=t.length===this.listCurves.length}if(this.listCurves.length>1){let i=e.name===this.previousCurveName,s=t.curveStyle.color===this.previousCurveColor,a=t.curveStyle.lineStyle===this.previousCurveLineStyle,n=2===this.listCurves.length||this.linkAllCurvesAsOneSerie;this.linkAllCurvesAsOneSerie=n&&i&&s&&a&&!this.oneCurvePerGroup}this.previousCurveName=e.name,this.previousCurveColor=t.curveStyle.color,this.previousCurveLineStyle=t.curveStyle.lineStyle;let s=t.getAssignedAxisX(),a=t.getAssignedAxisY();isNaN(s)&&(this._defaultXaxisNeeded=!0,t.setAssignedAxisX(-1)),isNaN(a)&&(this._defaultYaxisNeeded=!0,t.setAssignedAxisY(-2))}},getAxisList:function(t){return this.axis[t]},getAxis:function(t){let e=e=>e.getIdNoPrefix()===t,i=this.axis.x.find(e);return i||(i=this.axis.y.find(e)),i},addAxis:function(t){t&&(2===t.getDimension()?this.axis.y.push(t):this.axis.x.push(t),void 0===t.getId()&&(t.setId(this._idForAxis),this._idForAxis++))},readFromXML:function(t,i,r){if(t){let o=Date.now();this.name=t.getAttribute("name");let l=e.createProbe("MsrEcChartRead"+this.name);l.begin(),this.distribution=t.getAttribute("Distribution");let u=t.getAttribute("Animation");this.animation="true"===u||"TRUE"===u,this.nameX=t.getAttribute("nameX"),this.nameY=t.getAttribute("nameY"),this.unitX=t.getAttribute("unitX"),this.unitY=t.getAttribute("unitY");let h=t.getAttribute("alignTicks");this.alignTicks="true"===h||"TRUE"===h;let c=t.getAttribute("secondaryAxisGridLines");this.secondaryGridLines="true"===c||"TRUE"===c,this.isBarChart=!0;let d=()=>{this.hasPositions=!0;for(let t=0;t<this.listCurves.length&&this.hasPositions;t++){let e=this.listCurves[t];if(e){let t=e.getMetadata();this.hasPositions=t&&t.hasPositions}}if(r&&(r.hasLockableCurves=this.isCrossGroup),this._defaultXaxisNeeded){let t=new a;t.setId(-1),this.addAxis(t);let e=this.listCurves.filter((t=>-1===t.getAssignedAxisX()&&t.nameX)),i=e.length>0?e[0].nameX:void 0,s=e.filter((t=>t.nameX===i)).length===e.length&&i?i:this.nameX;t.setName(s),t.setUnit(this.unitX?this.unitX:"")}if(this._defaultYaxisNeeded){let t=new a;t.setId(-2),t.setDimension(2),this.addAxis(t);let e=this.listCurves.filter((t=>-2===t.getAssignedAxisY()&&t.nameY)),i=e.length>0?e[0].nameY:void 0,s=e.filter((t=>t.nameY===i)).length===e.length&&i?i:this.nameY;t.setName(s),t.setUnit(this.unitY?this.unitY:"")}let t=this.listCurves.filter((t=>t.isStacked)),e=t[t.length-1];for(let i=t.length-2;i>=0;i--)t[i].stack(e),e=t[i];let s=this.getAxisList("y").filter((t=>"percentage"===t.getScale()));if(s&&s.length>0){let e=s[0].getIdNoPrefix(),i=t.filter((t=>t.getAssignedAxisY()===e));if(i.length>0){let t=i[0];for(let e=1;e<i.length;e++)i[e].ratio(t);t.setTo100()}}if(l.end(),this.analytics.dataModelCreationTime=Date.now()-o,this.listCurves.length>0){this.analytics.numberOfCurves=this.listCurves.length;let t=this.listCurves.reduce(((t,e)=>t+e.getValues().length),0);this.analytics.numberOfPointsPerCurve=t/this.analytics.numberOfCurves}if(i){let t=this.listCurves&&this.listCurves.length>0?this:void 0;i(t)}},m=!0,f={counter:0,loopCompleted:!1},g=()=>{f.counter--,0===f.counter&&f.loopCompleted&&d()},p=t.children.length;if(1===p&&"ChartAxis"===t.children[0].nodeName)d();else{for(let e=0;e<t.children.length;e++){let i=t.children[e];if("Curve"===i.nodeName){m=!1,f.counter++;new s(i,{modelMgr:r.spm,sequence:r.seq},(t=>{t.isBarChart||(this.isBarChart=!1),this.addCurve(t),g()}))}else if("ChartAxis"===i.nodeName){f.counter++;let t=new a(i,g);this.addAxis(t)}}if(f.loopCompleted=!0,m){this._defaultXaxisNeeded=!0,this._defaultYaxisNeeded=!0,this.isBarChart=!1;let e=[],i="",a="",o=r.spm.getDataList("grp",r.seq);for(let s=0;s<p;s++){let l=t.children[s];if("Value"===l.nodeName){let t,s=l.getAttribute("frmId");if(s){t=r.spm.getFrameDetails(r.seq,s).group}else{let e=l.getAttribute("grpId");t=e&&o?o.getEntry(parseInt(e)-1).val:l.getAttribute("group")}if(!t){e=[];break}{let s=n.parseGroupIds(t),r=s[0],o=s[1];r===i&&o===a||(e.push({rootName:r,loadName:o}),i=r,a=o)}}}if(0===e.length){new s(t,{modelMgr:r.spm,sequence:r.seq},(t=>{this.addCurve(t),d()}))}else f.counter=0,f.loopCompleted=!1,e.forEach((e=>{f.counter++;new s(t,{modelMgr:r.spm,sequence:r.seq},(t=>{this.addCurve(t),g()}),e)})),f.loopCompleted=!0,0===f.counter&&d()}else this._positionsComputed=!0,0===f.counter&&d()}}},computePositions:function(){!this._positionsComputed&&this.dd&&this.dd.animationStructure&&this.dd.animationStructure.groupList.length>0&&(this.listCurves.forEach((t=>{if(t){let e=[];if(this.dd.animationStructure.groupList.forEach((i=>{if(i&&i.rootName===t.rootName&&i.loadCaseName===t.loadCaseName){let t=i.frameList;t&&t.forEach((t=>{!t||t.isScaledPosition||isNaN(t.position)||e.push(t.position)}))}})),e.length>0){let i=t.getValues();e.length===i.length&&i.forEach(((t,i)=>{t&&(t.position=e[i])}))}}})),this._positionsComputed=!0)}});return t.namespace("DS/SPY/CATSimNavDataFrameViewXYChart",r)})),define("SPY/SimulationPlayerModel",["DS/SPY/SimulationPlayerModel"],(function(t){"use strict";return console.warn("This module is deprecated. use DS/SPY/SimulationPlayer instead of SPY/SimulationPlayer"),t})),define("DS/SPY/SimulationPlayerModel",["UWA/Core","DS/CoreEvents/Events","DS/WebSystem/Environment","DS/WebUtils/ProbesManager","DS/Visualization/Node3D","DS/Visualization/ModelLoader","DS/SPY/CATSimNavDataHelper","DS/SPY/LW3DModelLoader","DS/SPY/LWTextureLoader","DS/SPY/LWInstancingLoader","DS/SPY/CATSimNavDataPrimaryDico","DS/i3DxMdSimulationWeb/i3DxMSRFileTree"],(function(t,e,i,s,a,n,r,o,l,u,h,c){"use strict";const d=i.isSet("MSREC.EnableRscLoadingProbe");let m=t.Class.extend({init:function(t){this.msrID=t&&t.msrID?t.msrID:void 0,this.simulationName=t&&t.simulationName?t.simulationName:"Simulation",this.scenarioName="Simulation case",this.window=t?t.window?t.window:t:void 0,this.ctx=t&&t.context?t.context:"ctxUndefined",this.thumbnailBlobs=new Map,this.streamLoadingProgress=new Map,this.sequences=[],this.level=2,this._dataLists=[],this._frmDetailsMaps=[],this.isTargetXR=!1,this._gltfLoader=null,this._URLsToRevoke=[];let i,a=this.window;a&&a.getViewer&&(i=a.getViewer()),this._loaders={Geometry:{construct:o,initParameters:{spm:this,window:this.window,viewer:i,viewerRoot:i?i.getRootNode():void 0,useProbe:d,probesManager:s,eventsManager:e}},Texture:{construct:l,initParameters:{spm:this,window:this.window,useProbe:d,probesManager:s,eventsManager:e}},Instancing:{construct:u,initParameters:{spm:this,window:this.window,useProbe:d,probesManager:s,eventsManager:e}}},this._analytics={}},clean:function(){this.clearLoadingQueue(),this._applyToLoaders("clean"),this.sequences.forEach((function(t){if(t){t.zip&&delete t.zip;let e=t.listDD;e&&e.forEach((function(t){t.clean()})),delete t.listDD}})),delete this.sequences,this._URLsToRevoke.forEach((function(t){URL.revokeObjectURL(t)})),this.logoUrl=void 0},getContext:function(){return this.ctx},addDataList:function(t,e){void 0===this._dataLists[e]&&(this._dataLists[e]={}),this._dataLists[e][t.getName()]=t},getDataList:function(t,e){let i;return e<this._dataLists.length&&e>=0&&this._dataLists[e]&&(i=this._dataLists[e][t]),i},getFrameDetails:function(t,e,i){let s,a=this._frmDetailsMaps[t];if(a?s=a.get(e):(this._frmDetailsMaps[t]=new Map,a=this._frmDetailsMaps[t]),!s){s={};let i=this.getDataList("frm",t),n=parseInt(e)-1,o=i.getEntry(n);o.pos&&o.pos.length>0&&(s.position=Number(o.pos)),s.scaled=o.scaled;let l=this.getDataList("grp",t).getEntry(parseInt(o.grpId)-1);s.group=l.val,s.groupNLS=r.buildGroupNameFromIds(l.val),s.unit=l.unit,a.set(e,s)}return s},setFrameDetails:function(t,e,i,s,a,n){let o=this._frmDetailsMaps[t];o||(this._frmDetailsMaps[t]=new Map,o=this._frmDetailsMaps[t]),o.set(e,{position:a,scaled:i,group:s,groupNLS:r.buildGroupNameFromIds(s),unit:n})},addSequence:function(t,e,i,s){require(["DS/SPY/CATSimNavDataLWFactory"],function(a){let n=new a,r={idx:0,name:"sequence",listDD:[],listDDShared:[],zip:e};r.idx=this.sequences.push(r)-1,n.parseXML(t,r,this,i,(()=>{this.sequences[r.idx]=void 0,s()}))}.bind(this))},getNbSequences:function(){if(this._primaryDico)return this._primaryDico.getNbAnalysisCases();{const t=0;return this.sequences.reduce(((t,e)=>t+(e?1:0)),t)}},getFirstValidSequenceIdx:function(){return this.sequences.findIndex((t=>t))},getMSRID:function(){return this.msrID},getSimulationAlias:function(){return this.simulationName},getSimulationTitle:function(){return this.window.experience._myAsset.displayname?this.window.experience._myAsset.displayname:this.getSimulationAlias()},getCurrentContentDescription:function(t){if(t&&t.onComplete){let e="",i=this.window.experience.mySPMUI;if(i){let s=i.getActiveSequence(),a=i.getActiveDD();if(a){let i=this.getSimulationAlias(),n=this.getSimulationTitle(),r=this.getSequenceName(s),o=a.name,l=this.getDisclaimer();require(["DS/WebSystem/Nls"],(function(s){s.nls("SPY/Description",["CurrentTitle","AliasAtGeneration","CaseName","ContentName"],(function(s){e+=s[0]+i+"\n",e+=s[1]+n+"\n",e+=s[2]+r+"\n",e+=s[3]+o+"\n",l&&(e+=l),t.onComplete(e)}))}))}}}},getDisclaimer:function(){return this.disclaimer},_getLogoZipEntry:function(){let t;if(this.logo&&this.logo.length>0&&!this.logoUrl){let e=this.getFirstValidSequenceIdx();if(e>=0){let i=this.getZipEntries(e),s=this.buildResourcePath(this.logo,e);t=i.find(s)}}return t},getLogoUrl:function(t){let e=this.getFirstValidSequenceIdx(),i=this.logo;let s;if(e>=0&&(s=this.getZipEntries(e)),s){let e=this._getLogoZipEntry();e&&e.getBlob("image/png").then((e=>{this.logoUrl=URL.createObjectURL(e),this._URLsToRevoke.push(this.logoUrl),t&&t(this.logoUrl)}))}else if(this.sequences[e].key&&i){let s=[i],a=this.sequences[e];c.getFileTreeDownloadURL(a.url,a.contextid,a.simId,a.resultRepId,a.key,s).then((e=>{const i=new Blob([e[0].buffer],{type:"image/png"});this.logoUrl=URL.createObjectURL(i),this._URLsToRevoke.push(this.logoUrl),t&&t(this.logoUrl)}))}return this.logoUrl},loadImage:function(t,e,i){if(!isNaN(t)&&e&&i){let s,a=this.getZipEntries(t),n="",r=e;if(a&&e&&(s="image/png",e=this.buildResourcePath(e,t),n=a.find(e)),n)n.getBlob(s).then((t=>{let e=URL.createObjectURL(t);this._URLsToRevoke.push(e),i(e)}));else if(this.sequences[t].key&&r){let e=[r],s=this.sequences[t];c.getFileTreeDownloadURL(s.url,s.contextid,s.simId,s.resultRepId,s.key,e).then((t=>{const e=new Blob([t[0].buffer],{type:"image/png"});let s=URL.createObjectURL(e);this._URLsToRevoke.push(s),i(s)}))}}},isYaxisUp:function(){return this._isYaxisUp},_findDataDisplay:function(t,e){let i=-1;if(t>=0&&this.sequences[t]&&(e.id&&(i=this.sequences[t].listDD.findIndex((t=>t.id===e.id))),i<0&&e.name&&e.allowNameComparison)){this.sequences[t]&&(i=this.sequences[t].listDD.findIndex((t=>t.name===e.name)))}return i},findSequenceByPersistentId:function(t){return this.sequences.findIndex((e=>e&&t&&e.persistentId===t))},findSequenceByName:function(t){return this.sequences.findIndex((e=>e&&t&&e.name===t))},findSimilarContent:function(t){let e={found:!1},i=t.sequenceName,s=t.persistentId,a=t.dataDisplayId,n=t.dataDisplayName,r=t.allowNameComparison,o=-1,l=-1;s&&(l=this.findSequenceByPersistentId(s)),l<0&&r&&(l=this.findSequenceByName(i));let u=this.getNbSequences();return l<0&&1===u&&r&&(l=this.getFirstValidSequenceIdx()),l>=0?o=this._findDataDisplay(l,{id:a,name:n,allowNameComparison:r}):this.sequences.forEach(((t,e)=>{o<0&&(l=e,o=this._findDataDisplay(e,{id:a,name:n,allowNameComparison:r}))})),e.sequenceIndex=l,e.dataDisplayIndex=o,e.found=l>=0&&o>=0,e},getSequencePersistentId:function(t){return this.sequences[t]?this.sequences[t].persistentId:"undefined"},getSequenceName:function(t){return Array.isArray(this.sequences)&&this.sequences[t]?this.sequences[t].name:"undefined"},setPreferredStreamId:function(t){this._preferredStreamId=t},getPreferredStreamId:function(){return this._preferredStreamId},updateSequenceAnalyticsFromContent:function(t){if(this.sequences[t]){let e=this.sequences[t].analytics;if(e){isNaN(e.extractionTime)&&(e.extractionTime=0);let i=function(t){t.forEach((t=>{t&&t.analytics&&t.analytics.extractionTime>e.extractionTime&&(e.extractionTime=t.analytics.extractionTime)}))};i(this.getDataDisplayList(t)),i(this.getSharedDataDisplayList(t))}}},getStreamAnalytics:function(t){let e={};if(Array.isArray(this.sequences)&&this.sequences[t]){let i=this.sequences[t].analytics;i&&(e.dataSize=i.dataSize,e.streamingTime=i.streamingTime)}return e},addAnalytics:function(t){this._analytics&&t&&(this._analytics=Object.assign(this._analytics,t))},getAnalytics:function(){return this._analytics},setTypingInfo:function(t){this._typingInfo=Object.assign({},t)},getTypingInfo:function(){return this._typingInfo&&(this._typingInfo.ecVersion=this._primaryDico?.getVersion(),void 0!==this._isProgressiveLoading&&(this._typingInfo.isProgressiveLoading=this._isProgressiveLoading?"WithProgressiveLoading":"WithoutProgressiveLoading")),this._typingInfo},extractTypingInfoForSequence:function(t,e){let i=this._typingInfo,s={assetType:this._analytics.assetType,providerType:this._analytics.providerType,ecVersion:this._typingInfo?.ecVersion};if(i){let a=function(t){s.origin=t.origin,s.sequenceType=t.sequenceType,s.sequenceSubTypes=t.sequenceSubTypes},n=!1;if(t){let e=t.replace("SimNavData_","").replace("_","").replace("0","");for(let t in i){let s=i[t];if("object"==typeof s&&s.resultSequenceId&&s.resultSequenceId.replace("0","")===e){a(s),n=!0;break}}}if(!n&&e)for(let t in i){let s=i[t];if("object"==typeof s&&s.name&&s.name===e){a(s),n=!0;break}}n||(s.origin=i.simulationOrigin)}return s},extractTypingInfoForDataDisplay:function(t){let e={},i=this.sequences[t.seq];return i&&(e=this.extractTypingInfoForSequence(i.persistentId,i.name),e.contentType=this.getDataDisplayType(t)),e},getDataDisplayType:function(t){let e;return t&&(e=t.plotType&&t.plotType.length>0?t.plotType:t.type),e},getDataDisplayList:function(t){return this.sequences[t]?this.sequences[t].listDD:void 0},getSharedDataDisplayList:function(t,e){if(this.sequences[t]){let i=this.sequences[t].listDDShared;return e&&(i=this.sequences[t].listDDShared.filter((t=>t.category===e))),i}},getZipEntries:function(t){return this.sequences[t].zip},copyZipEntriesForTarget:function(t,e,i){if(e&&!isNaN(t)&&this.sequences&&this.sequences.length>t){let s=this.getZipEntries(t),a=0,n=e.getZipEntries(a);if(s&&n){const r=this.physicalId&&this.separator;let o=e.getDataDisplayList(a);o=o.concat(e.getSharedDataDisplayList(a));let l=[],u=this.logo?[this.logo]:[];o.forEach((t=>{l=l.concat(t.getNavData3DViewList(!0));let e=t.getLegend();e&&(u=u.concat(e.getPNGList())),t.containsImages()&&(u=u.concat(t.getInfoImages()))}));let h=[];l.forEach((t=>{t&&(t.getGeometryFiles&&(h=h.concat(t.getGeometryFiles())),t.matRendering&&h.push(t.matRendering),t.getTextureFiles&&(h=h.concat(t.getTextureFiles())))})),h=Array.from(new Set(h));let c={count:0,noMoreRequest:!1},d=function(t){return function(e){n.root.addUint8Array(t,e),c.count--,0===c.count&&c.noMoreRequest&&i()}},m=e=>{e=this.buildResourcePath(e,t);let i=s.find(e);i&&(c.count++,e=r?e.split(this.separator)[1]:e,i.getUint8Array().then(d(e)))};h.forEach(m),u.forEach(m),c.noMoreRequest=!0,0===c.count&&i()}}},_getLoader:function(t){let e;if(this._loaders[t]){e=this._loaders[t].instance;let i=this._loaders[t].construct;!e&&i&&(e=new i(this._loaders[t].initParameters),this._loaders[t].instance=e)}return e},_applyToLoaders:function(t){if(t&&t.method)if(t.type){let e=this._loaders[t.type].instance;e&&e[t.method]&&e[t.method].apply(e,t.args)}else for(const e in this._loaders){let i=this._loaders[e].instance;i&&i[t.method]&&i[t.method].apply(i,t.args)}},loadFiles:function(t){let e=this._getLoader(t.type);if(e)return e.loadFiles(t)},processLoadFiles:function(t){this._applyToLoaders({method:"processLoadFiles",type:t})},clearLoadingQueue:function(t,e){this._applyToLoaders({method:"clearLoadingQueue",type:e,args:arguments})},clearLoadingMap:function(t){this._applyToLoaders({method:"clearLoadingMap",type:t})},initLoadingMap:function(t){let e=this._getLoader(t.type);if(e)return e.initLoadingMap(t.entries)},addToLoadingMap:function(t){let e=this._getLoader(t.type);if(e)return e.addToLoadingMap(t.entries)},getTextureLoader:function(){let t="Texture";return this._loaders[t]?this._loaders[t].instance:null},addThumbnailBlob:function(t,e,i){t=+t,this.thumbnailBlobs.has(t)||this.thumbnailBlobs.set(t,new Map);this.thumbnailBlobs.get(t).set(e,i)},getThumbnailBlobs:function(){return this.thumbnailBlobs},getThumbnailBlob:function(t,e){if(this.thumbnailBlobs.has(t)){const i=this.thumbnailBlobs.get(t);if(i.has(e))return i.get(e)}return null},setPrimaryDicoAndGetThumabnails:function(t,e){var i=new h(t.analysisCases,t.version,e);return this._primaryDico=i,i.getAllThumbnails()},getPrimaryDico:function(){return this._primaryDico},initStreamLoadingProgress:function(t){this.streamLoadingProgress=new Map(t.map((t=>[t,0]))),this.nbStreams=this.streamLoadingProgress.size},updateStreamProgess:function(t,i){if(this.streamLoadingProgress){if(100===this.streamLoadingProgress.get(t))return;this.streamLoadingProgress.set(t,i);var s=Array.from(this.streamLoadingProgress.values()).reduce(((t,e)=>t+e),0)/this.nbStreams;e.publish({event:this.ctx+"/SPY/STREAMLOADING/PROGRESS",data:{streamId:t,progress:i,globalProgress:s}})}},getStreamProgress:function(t){return this.streamLoadingProgress.has(t)?this.streamLoadingProgress.get(t):null},updateContentProgess:function(t,i){e.publish({event:this.ctx+"/SPY/DDLOADING/PROGRESS",data:{streamId:t,progress:i}})},setStreamIds:function(t){this.streamIds=t},getStreamIds:function(){return this.streamIds},getStreamId:function(t){return this.streamIds&&t>=0&&t<this.streamIds.length?this.streamIds[t]:null},setStreamSizes:function(t){this.streamSizes=t},getStreamSize:function(t){return Array.isArray(this.streamSizes)&&t>=0&&t<this.streamSizes.length?this.streamSizes[t]:null},setPhysicalId:function(t){this.physicalId=t},getPhysicalId:function(){return this.physicalId},setSeparator:function(t){this.separator=t},getSeparator:function(){return this.separator},setIsXREnabled:function(t){this.isTargetXR=t},setIsProgressiveLoading:function(t){this._isProgressiveLoading=t},buildResourcePath:function(t,e){if(this.isTargetXR&&t.endsWith(".cgr")&&(t=t.slice(0,-4)+".glb"),null==e||"number"!=typeof e)return t;const i=this.getStreamId(e);if(null==i)return t;return(this._primaryDico?`${this.physicalId?this.physicalId:""}SimNavFile${i}${this.separator}`:"")+t},setGltfLoader:function(t){this._gltfLoader||(this._gltfLoader=t)},getGltfLoader:function(){return this._gltfLoader}});return m})),define("DS/SPY/CATSimNavDataFrameViewCompValue",["DS/SPY/CATSimNavDataFrameViewComp","DS/SPY/CATSimNavDataLink"],(function(t,e){"use strict";var i=t.extend({init:function(t,e,i,s){this._parent(t,e),this.impl={CATISimNavDataSpecUI:{module:"SPYUI",ext:"CATSimNavDataFrameViewCompValueUI",type:"data",obj:null}},this.readFromXML(t,s)},getValues:function(){return{name:this.name,type:this.type,value:this.value,unit:this.unit}},readFromXML:function(t,i){if(t)if(this.value=t.getAttribute("value"),this.unit=t.getAttribute("unit"),t.children.length>0){for(var s=this,a=null,n=0;n<t.children.length&&null===a;n++){var r=t.children[n];if("LinkSet"===r.nodeName&&"Frameto3D"===r.getAttribute("role"))for(var o=0;o<r.children.length&&null===a;o++){var l=r.children[o];"InternalRef"===l.nodeName&&(a=l)}}if(a)new e(a,this.dd,(function(t){s.addLink("Frameto3D",t),i(s)}))}else i(this)}});return UWA.namespace("DS/SPY/CATSimNavDataFrameViewCompValue",i)})),define("DS/SPY/CATSimNavDataFrameViewText",["DS/SPY/CATSimNavDataFrameViewCompValue"],(function(t){"use strict";var e=t.extend({init:function(t,e,i,s){this._parent(t,e,i,s),this.impl.CATISimNavDataSpecUI={module:"SPYUI",ext:"CATSimNavDataFrameViewTextUI",type:"data",obj:null}},getValues:function(){return{name:this.name,value:this.value}}});return UWA.namespace("DS/SPY/CATSimNavDataFrameViewText",e)})),define("DS/SPY/CATSimNavData3DExtrema",["DS/SPY/CATSimNavDataSpec","DS/Visualization/ThreeJS_DS"],(function(t,e){"use strict";var i=t.extend({init:function(t,e,i){this._parent(t,e),this.impl={},this.readFromXML(t,i)},getExtremaType:function(){return this._extremaType},getExtremaValue:function(){return this._extremaValue},getPosition:function(){return this._position},getNormalVector:function(){return this._normalVector},getComponent:function(){return this._component},setComponent:function(t){this._component=t},readFromXML:function(t,i){this._extremaType=t.getAttribute("label"),this._position=new e.Vector3(parseFloat(t.getAttribute("PosX")),parseFloat(t.getAttribute("PosY")),parseFloat(t.getAttribute("PosZ"))),this._normalVector=new e.Vector3(0,0,0),this._extremaValue=t.getAttribute("value"),i(this)}});return UWA.namespace("DS/SPY/CATSimNavData3DExtrema",i)})),define("DS/SPY/CATSimNavData3DExtremas",["DS/SPY/CATSimNavDataSpec","DS/SPY/CATSimNavData3DExtrema"],(function(t,e){"use strict";var i=t.extend({init:function(t,e,i){this._parent(t,e),this.impl={},this._extremaList=[],this._extremaFrameIndex=t._extremaFrameIndex,this.readFromXML(t,i)},getFrameIndex:function(){return this._extremaFrameIndex},addExtrema:function(t){t&&this._extremaList.push(t)},getListExtrema:function(){return this._extremaList},readFromXML:function(t,i){for(var s=0,a=!1,n=function(t){t&&(this.addExtrema(t),0===--s&&a&&i&&i(this))}.bind(this),r=0;r<t.children.length;r++){var o=t.children[r];if("Extrema"===o.nodeName){s++;new e(o,this.dd,n)}}a=!0,0===s&&i(this)}});return UWA.namespace("DS/SPY/CATSimNavData3DExtremas",i)})),define("DS/SPY/CATSimNavData3DExtremasSet",["DS/SPY/CATSimNavDataSpec","DS/SPY/CATSimNavData3DExtremas","DS/SPY/CATSimNavDataLink"],(function(t,e,i){"use strict";var s=t.extend({init:function(t,e,i){this._parent(t,e),this.impl={},this._extremasList=[],this.readFromXML(t,i)},addExtremas:function(t){t&&this._extremasList.push(t)},getExtremas:function(t){for(var e,i=0;i<this._extremasList.length&&!e;i++)this._extremasList[i].getFrameIndex()===t&&(e=this._extremasList[i]);return e},readFromXML:function(t,s){for(var a=function(){for(var i=0,a=0,n=!1,r=function(t){this.addExtremas(t),0===--i&&n&&s(this)}.bind(this),o=0;o<t.children.length;o++){var l=t.children[o];if("Extremas"===l.nodeName){l._extremaFrameIndex=a,a++,i++;new e(l,this.dd,r)}}n=!0,0===i&&s(this)}.bind(this),n=null,r=0;r<t.children.length;r++){var o=t.children[r];if("LinkSet"===o.nodeName&&"ExtremasToPart"===o.getAttribute("role"))for(var l=0;l<o.children.length&&null===n;l++){var u=o.children[l];"InternalRef"===u.nodeName&&(n=u)}}if(n)new i(n,this.dd,function(t){this.addLink("ExtremasToPart",t),a()}.bind(this));else a()}});return UWA.namespace("DS/SPY/CATSimNavData3DExtremasSet",s)})),define("DS/SPY/CATSimNavData3DExtremasRoot",["DS/SPY/CATSimNavDataSpec","DS/SPY/CATSimNavData3DExtremasSet"],(function(t,e){"use strict";var i=t.extend({init:function(t,e,i,s){this._parent(t,e),this.impl={},this._extremasSetList=[],this.readFromXML(t,s)},addExtremasSet:function(t){t&&this._extremasSetList.push(t)},getListExtremasSet:function(){return this._extremasSetList},readFromXML:function(t,i){for(var s=0,a=!1,n=function(t){t&&(this.addExtremasSet(t),0===--s&&a&&i&&i())}.bind(this),r=0;r<t.children.length;r++){var o=t.children[r];if("ExtremasSet"===o.nodeName){s++;new e(o,this.dd,n)}}a=!0,0===s&&i()}});return UWA.namespace("DS/SPY/CATSimNavData3DExtremasRoot",i)}));