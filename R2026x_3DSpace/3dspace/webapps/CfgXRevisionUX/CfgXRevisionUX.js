define("DS/CfgXRevisionUX/scripts/CfgXRevisionCreateView",["DS/Controls/Button","UWA/Class/View","DS/CfgBaseUX/scripts/CfgSearchConfiguration","DS/CfgBaseUX/scripts/CfgUtility","i18n!DS/CfgXRevisionUX/assets/nls/CfgXRevisionUX","DS/CfgBaseUX/scripts/CfgData","DS/CoreEvents/ModelEvents","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","css!DS/CfgXRevisionUX/styles/CfgXRevisionUX.css"],(function(e,t,i,o,s,n,a,r){"use strict";return t.extend({render:function(){n.ModelEvents=new a;let t=UWA.createElement("div",{class:"xRevision"}),l=[this.options.referenceId],c=new e({label:s.Create_xRevision,domId:"xRevision-button",emphasize:"default"}).inject(t),d=new e({label:s.Reuse_xRevision,domId:"xRevision-button",emphasize:"default"}).inject(t);var h=this;let u,f=r.get();if(f&&f.AuthoringContextHeader){let e=Object.keys(f.AuthoringContextHeader)[0];u={operationheader:{key:e,value:f.AuthoringContextHeader[e]}}}c.addEventListener("click",(async function(e){try{let e=await o.createxRevision(l[0],u);e&&e.xRevisionGraphPID&&o.showwarning(s.xRevision_Creation_Success,"success"),h.publishPostProcessingEvent()}catch(e){e&&e.errorMessage?o.showwarning(e.errorMessage,"error"):o.showwarning(s.xRevision_Creation_Error,"error")}n.ModelEvents.publish({event:"XRevCreatecloseDialog"})}));let v=async e=>{let t=e[0].id;try{let e={selectedObjectId:t,inputObjectIdList:l,wsHeaderOptions:u},i=await o.setConfiguredObjectInfo(e);i&&"SUCCEED"===i.result&&o.showwarning(s.xRevision_Creation_Success,"success"),h.publishPostProcessingEvent()}catch(e){e&&e.errorMessage?o.showwarning(e.errorMessage,"error"):o.showwarning(s.xRevision_Creation_Error,"error")}n.ModelEvents.publish({event:"XRevCreatecloseDialog"})};return d.addEventListener("click",(function(e){let t=new i(!1,"Open Products"),o=enoviaServerFilterWidget?enoviaServerFilterWidget.myRole:"",n=l;t.activate(s.Select_Physical_product,"",o,v,"",n,"",'(revisionmode:"EffectivityBased") AND ( NOT current:"Inactive")')})),t},publishPostProcessingEvent:function(){let e={commandName:"cfgEditConfigurationContext",widgetId:widget.id,response:{},data:{pids:[this.options.referenceId]}};o.publishPostProcessingEventForApplications(e)}})})),define("DS/CfgXRevisionUX/scripts/PLMNewRevisionFacetView",["UWA/Class/View","DS/Controls/ComboBox","DS/CfgBaseUX/scripts/CfgAutoComplete","DS/Handlebars/Handlebars4","text!DS/CfgXRevisionUX/scripts/CfgPLMNewRevisionFacetTemplate.html","DS/CfgBaseUX/scripts/CfgSearchConfiguration","DS/CfgBaseUX/scripts/CfgUtility","i18n!DS/CfgXRevisionUX/assets/nls/CfgXRevisionUX","css!DS/CfgXRevisionUX/styles/CfgXRevisionUX.css"],(function(e,t,i,o,s,n,a,r){"use strict";var l=o.compile(s);return e.extend({className:"cfg-X-revision-PLMNewRevisionFacetView",init:function(e){this._parent(e),a.rolesAvailable((e=>{e.isCFGRoleAvail?this.initUI(this.options):this.container.addContent(`<font-size="17px"> ${r.RevisionFacet_NoCFGRole} </font>`)}))},initUI:async function(e){await a.populate3DSpaceURL(),enoviaServerFilterWidget.mySecurityContext||await a.populateSecurityContext(),e.revisionControlLabel=r.labelRevisionControl,e.controlledByLabel=r.labelControlledBy,e.modelCriteriaLabel=r.labelModelCriteria,e.revControlInfo=r.revisionInfo,this.container.setHTML(l(e)),this.container.getElement(".modelCriteriaLabel").hide();let i=this.container.getElement(".CfgClassical"),o=this.container.getElement(".CfgEffectivityBased"),s=this.container.getElement(".CfgReuse"),n=this.container.getElement(".CfgModel");i.show(),o.hide(),s.hide(),n.hide();const c=[{labelItem:r.revisionControlClassical,valueItem:"Classical"},{labelItem:r.revisionControlEffectivityBased,valueItem:"Effectivity based"},{labelItem:r.revisionControlEffectivityBasedUseExisting,valueItem:"Effectivity based - Use existing graph"},{labelItem:r.revisionControlEffectivityBasedModel,valueItem:"Effectivity based - Model"}];this.revisionControlSelector=new t({elementsList:c,selectedIndex:0,enableSearchFlag:!1}).inject(this.container.getElement(".revisionControlDropDown")),this.revisionControlSelector.addEventListener("change",(e=>{"Classical"===e.dsModel.value?(i.show(),o.hide(),s.hide(),n.hide(),this.currentRevControl=e.dsModel.value,this.buildClassicUX(i)):"Effectivity based"===e.dsModel.value?(i.hide(),o.show(),s.hide(),n.hide(),this.currentRevControl=e.dsModel.value,this.buildEffectivityBasedUX(o)):"Effectivity based - Use existing graph"===e.dsModel.value?(i.hide(),o.hide(),s.show(),n.hide(),this.currentRevControl=e.dsModel.value,this.reuseUXReady||this.buildReuseUX(this.container.getElement(".reuseAutoComplete"))):"Effectivity based - Model"===e.dsModel.value&&(i.hide(),o.hide(),s.hide(),n.show(),this.currentRevControl=e.dsModel.value,this.modelUXReady||this.buildModelUX(this.container.getElement(".modelAutoComplete")))}))},buildModelUX:function(e){let t=[];this.selectedModelID&&t.push(this.selectedModelID),({autoComplete:this.modelRearchAutocomplete,searchBtn:this.modelSearchBtn}=this.createAutocompleteWithSearch("Model",e,'( NOT current:"Inactive")',t,r.SelectConfigurationContext)),this.modelUXReady=!0},renderCriteria:function(){const e={version:"1.0",modelIds:[{id:`pid:${this.selectedModelID}`}]};a.makeWSCall("/resources/modeler/browsing/model/getcriteria","POST","enovia","application/json",JSON.stringify(e),(e=>{let i=Object.entries(e.criteria[0]).filter((e=>{if("products"==e[0]&&"TRUE"==e[1]||"manufacturingPlans"==e[0]&&"TRUE"==e[1])return e[0]})).map((e=>"products"==e[0]?{labelItem:r.ProductState,valueItem:"products"}:"manufacturingPlans"==e[0]?{labelItem:r.ManufacturingPlan,valueItem:"manufacturingPlans"}:void 0));i.length>0&&(this.container.getElement(".modelCriteriaLabel").show(),this.criteriaDropDown?(this.criteriaDropDown.elementsList=i,this.criteriaDropDown.selectedIndex=0):this.criteriaDropDown=new t({elementsList:i,selectedIndex:0,enableSearchFlag:!1}).inject(this.container.getElement(".modelCriteriaDropDown")))}),(function(e){console.log("getCriteria failed")}),!0)},buildClassicUX:function(e){},buildEffectivityBasedUX:function(e){},createAutocompleteWithSearch:function(e,t,o,s,n){let a={query:[{type:e,condition:o,excludedArray:s}],searchTitle:n,multiSelection:!1,minLengthBeforeSearch:0,showValue:!0,parentElement:t,showRevision:!1,callBackFunction:e=>this.onSearchComplete(e,this.revisionControlSelector.value),clearInfo:()=>this.clearInfo(this.revisionControlSelector.value)};const{autoComplete:r,searchBtn:l}=new i(a).render();return{autoComplete:r,searchBtn:l}},onSearchComplete:function(e,t){if(1!=e.length)return;let i=e.first();i&&("Effectivity based - Use existing graph"===t?this.selectedRefIDForReuse=i.get("ID"):"Effectivity based - Model"===t&&(this.selectedModelID=i.get("ID"),this.renderCriteria()))},clearInfo:function(e){"Effectivity based - Use existing graph"===e?this.selectedRefIDForReuse="":"Effectivity based - Model"===e&&(this.selectedModelID="",this.criteriaDropDown&&(this.criteriaDropDown.elementsList={}))},buildReuseUX:function(e){let t=[];this.selectedRefIDForReuse&&t.push(this.selectedRefIDForReuse),({autoComplete:this.refRearchAutocomplete,searchBtn:this.refSearchBtn}=this.createAutocompleteWithSearch("",e,'(revisionmode:"EffectivityBased") AND ( NOT current:"Inactive")',t,r.Select_Physical_product)),this.reuseUXReady=!0}})})),define("DS/CfgXRevisionUX/scripts/CfgXRevisionVariabilityView",["UWA/Class/View","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgBaseUX/scripts/CfgXRevisionUtility","DS/CfgBaseUX/scripts/CfgData","DS/CfgBaseUX/scripts/CfgController","DS/CfgEvolutionUX/CfgModelSelection","DS/CoreEvents/ModelEvents","DS/CfgBaseUX/scripts/CfgAutoComplete","DS/Tweakers/GeneratedToolbar","DS/CfgBaseUX/scripts/CfgUXEnvVariables","i18n!DS/CfgXRevisionUX/assets/nls/CfgXRevisionUX","DS/EffectivityWebExternalJS/scripts/CfgVersionExplorerLoader","css!DS/CfgXRevisionUX/styles/CfgXRevisionUX.css"],(function(e,t,i,o,s,n,a,r,l,c,d){"use strict";return e.extend({className:"cfg-X-revision-versionexplorerview",vEObject:{},getVEObject(){return this.vEObject.value},handleResize:function(e){new ResizeObserver((t=>{t[0].target.getDimensions().width<330?(e.addClassName("VariabilityResize"),this.divVersionGraph.addClassName("CfgVersionGraphInVariabilityResize")):(e.removeClassName("VariabilityResize"),this.divVersionGraph.removeClassName("CfgVersionGraphInVariabilityResize"))})).observe(this.container)},init:async function(e){try{o.ModelEvents=new a,s.init(),widget.getValue("x3dPlatformId")?enoviaServerFilterWidget.tenant=widget.getValue("x3dPlatformId"):enoviaServerFilterWidget.tenant="OnPremise",this._parent(e),this.referenceId=null,await t.populate3DSpaceURL(),enoviaServerFilterWidget.mySecurityContext||await t.populateSecurityContext();const n=await i.getScopesFromXRevision(this.options.objectID);if(this.xRevToxRevAllocationEnabled=c.getCfgUXEnvVariables().xRevToxRevAllocationEnabled,!n||!n.scopes||!Array.isArray(n.scopes))throw new Error("No scopes data received from getScopesFromXRevision WS call");if(0==n.scopes.length)return void(!0===this.xRevToxRevAllocationEnabled?this.loadAutocomplete():this.noContextDisply());await this.getAllocation(),this.createModelSelectorComp(n.scopes),this.objID=n.scopes[0],this.objType="Products",this.renderVersionGraphComponent()}catch(e){console.error(e)}},loadAutocomplete:async function(){this.xRevisionAutocompleteContainer=UWA.createElement("div",{class:"xRevAutocompleteContainer"}).inject(this.container),this.EffectivityBasedMessageContainer=UWA.createElement("div",{class:"effectivityBasedMessageContainer"}).inject(this.container),this.referenceId||await this.getReferenceId(),this.createAutocompleteWithSearch(this.xRevisionAutocompleteContainer,"Search Effectivity based ",this.referenceId),this.noContextDisply("xRevision")},loadVersionGraph:async function(){this.divVersionGraph.innerHTML="",console.log(`CFGUX: ID to be selected on graph Variability view: ${this.allocatedID}`),await VersionExplorerLoaderFactory(this.objID,this.options.callBackFunction,enoviaServerFilterWidget.tenant,enoviaServerFilterWidget.baseURL,enoviaServerFilterWidget.getSecurityContext(),this.divVersionGraph,{id:this.allocatedID||""},this.objType,this.vEObject)},getAllocation:async function(){try{this.allocatedID="";const e=await i.getAllocation(this.options.objectID);if(!e||!e.result||!Array.isArray(e.result))throw new Error("No allocation data received in getAllocation WS call");const[{allocationPIDs:t}]=e.result;[this.allocatedID]=t}catch(e){console.log("error in getAllocation",e)}},render:function(){return this.container},pubSubEvents:function(){this.getVEObject().subscribeEvent("select",(e=>{const t=e.data.nodeModel.getAttribute("id");this.allocatedID!==t&&o.ModelEvents.publish({event:"changeInAllocation",data:{xRevisionElementPID:this.options.objectID,allocationPID:[t],task:"allocation"}})})),this.getVEObject().subscribeEvent("unselect",(e=>{o.ModelEvents.publish({event:"changeInAllocation",data:{xRevisionElementPID:this.options.objectID,allocationPID:[e.data.nodeModel.getAttribute("id")],task:"deallocation"}})}))},createModelSelectorComp:async function(e){try{const o=await i.getDataFromSearch(e);if(!o||!o.results||!Array.isArray(o.results)||o.results.length<=0)throw new Error("CFGUX: No response from search WS call");const s={Data:o.results.map((e=>({valueItem:t.getAttributeValue(e.attributes,"resourceid"),labelItem:[t.getAttributeValue(e.attributes,"ds6w:label")],name:[t.getAttributeValue(e.attributes,"ds6w:identifier")],type:[t.getAttributeValue(e.attributes,"ds6w:what/ds6w:type")],icon:[t.getAttributeValue(e.attributes,"preview_url")]}))),currentindex:0,parentElement:this.contextDiv};this.ModelSelectionComponent=new n(s),this.ModelSelectionComponent.render(),this.xRevToxRevAllocationEnabled&&this.ModelSelectionComponent.options&&this.ModelSelectionComponent.options.Data.length>0&&this.ModelSelectionComponent.options.Data[0].type.length>0&&"Model"!==this.ModelSelectionComponent.options.Data[0].type[0]&&this.loadDeleteIcon()}catch(e){console.error(e)}o.ModelEvents.subscribe({event:"modelUpdated"},(e=>{this.objID=e.model.valueItem,this.loadVersionGraph()}))},noContextDisply:function(e){const t=enoviaServerFilterWidget.baseURL+"/common/images/I_Model_Thumbnail.png";"xRevision"===e?(this.EffectivityBasedMessageContainer.setContent('<span class="fonticon fonticon-evolution-effectivity" style="font-size: 100px; color: darkgrey; margin-bottom: 15px;"></span><br>'),this.EffectivityBasedMessageContainer.addContent(`<font-size="17px"> ${d.EffectivityBasedAllocationMessage} </font>`),this.EffectivityBasedMessageContainer.addClassName("cfg-X-revision-versionExplorerEmptyView")):(this.container.setContent(`<span><img src=${t} style="width:25%;"></img></span><br>`),this.container.addContent(`<font-size="17px"> ${d.noScopeDefined} </font>`),this.container.addClassName("cfg-X-revision-versionExplorerEmptyView"))},createAutocompleteWithSearch:function(e,t,i){let o={query:[{type:"",condition:'(revisionmode:"EffectivityBased")',excludedArray:[i]}],searchTitle:t,showValue:!1,multiSelection:!0,minLengthBeforeSearch:0,parentElement:e,showRevision:!1,mode:this.options.mode,callBackFunction:e=>this.allocationAutocompleteCallback(e),clearInfo:()=>{}};this.cfgAutocompleteObj=new r(o);const{autoComplete:s,searchBtn:n}=this.cfgAutocompleteObj.render();return{autoComplete:s,searchBtn:n}},allocationAutocompleteCallback:async function(e){const o=e.at(0).get("ID"),s=(e.at(0).get("label"),e.at(0).get("type"));this.objID=o,this.objType=s,this.EffectivityBasedMessageContainer.remove();try{"SUCCEED"===(await i.setConfiguredObjectInfo("AddContext",[this.referenceId],[o])).result?(t.showNotifs("success","",d.AttachSuccess),document.getElementById("searchAutocompleteContainer").setAttribute("style","display:none"),this.createModelSelectorComp([this.objID]),this.renderVersionGraphComponent(this.objType)):(t.showNotifs("error","",d.AttachFailed),this.container.setContent(""),this.loadAutocomplete())}catch(e){console.log(e),t.showNotifs("error","",d.AttachFailed),this.container.setContent(""),this.loadAutocomplete()}},renderVersionGraphComponent:async function(e){this.divModelSelector=UWA.createElement("div",{id:"CfgContainerInVariability"}).inject(this.container),UWA.createElement("div",{class:"contextLabel",html:d.Scope}).inject(this.divModelSelector),this.contextDiv=UWA.createElement("div",{class:"cfgContextDiv",html:""}).inject(this.divModelSelector),this.divVersionGraph=UWA.createElement("div",{class:"CfgVersionGraphInVariability"}).inject(this.container),this.displayCompactMode=!this.options.displayCompactMode||0!=this.options.displayCompactMode,this.options.callBackFunction=()=>this.pubSubEvents(),await this.loadVersionGraph(),o.ModelEvents.subscribe({event:"AllocationSuccess"},(e=>{this.allocatedID=e.allocationID})),o.ModelEvents.subscribe({event:"DeallocationSuccess"},(e=>{this.allocatedID=""})),this.options.callBackFunction=()=>this.pubSubEvents()},trashIconCB:async function(){try{this.referenceId||await this.getReferenceId();const e=await i.setConfiguredObjectInfo("RemoveContext",[this.referenceId],[this.objID]);e&&"SUCCEED"===e.result&&e.details&&e.details.length>0&&e.details[0].contexts&&e.details[0].contexts.xRevisionContent&&e.details[0].contexts.xRevisionContent.scopes&&e.details[0].contexts.xRevisionContent.scopes[0]?"ERROR"===e.details[0].contexts.xRevisionContent.scopes[0].status?t.showNotifs("error","",e.details[0].contexts.xRevisionContent.scopes[0].errorMessage):"detached"===e.details[0].contexts.xRevisionContent.scopes[0].status&&(t.showNotifs("success","",d.DetachSuccess),this.container.setContent(""),this.loadAutocomplete()):e&&"FAILED"===e.result&&(e.details&&e.details[0]&&e.details[0].errorMessage?t.showNotifs("error","",d.DetachFailed+","+e.details[0].errorMessage):t.showNotifs("error","",d.DetachFailed))}catch(e){console.error("An error occurred in trashIconCB:",e),t.showNotifs("error","",d.DetachFailed)}},loadDeleteIcon:function(){const e={entries:[{id:"CfgAllocationTrashIcon",icon:{iconName:"trash wux-ui-3ds",fontIconFamily:1,className:"cfgDeleteIcon"},dataElements:{typeRepresentation:"functionIcon",tooltip:d.Detach,value:e=>this.trashIconCB(e),visibleFlag:!0,alwaysInOverflow:!0},position:"far",domId:"CfgAllocationTrashIcon"}]};var t=l.prototype.createTreeDocument(e);this.toolBar=new l({overflowManagement:"dropdown",direction:"horizontal",items:t}),this.toolBar.inject(this.divModelSelector)},getReferenceId:async function(){if(!this.referenceId){const e=await t.getAllowedSemantics(this.options.objectID);e&&e.allowedSemantics&&e.allowedSemantics[0]&&e.allowedSemantics[0].graphProprietary&&(this.referenceId=e.allowedSemantics[0].graphProprietary.id)}}})}));