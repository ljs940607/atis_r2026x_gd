define("DS/SNResultUX/views/utils/3DSpacePreview",["UWA/Core","DS/SNInfraUX/SearchPreviewContainer","DS/SNResultUX/views/utils/Play3DServices"],(function(e,t,i){"use strict";return t.extend({_OpenWith:null,init:function(e){this._OpenWith=null,this._parent(e)},getPrimaryContent:function(t){if(e.is(t)&&e.is(t.searchmodel)&&(e.is(t.onFailure,"function")&&i.is3DPlayAvailable(t.searchmodel,t.skeleton).then((function(){t.onFailure.call()}),(function(){if(e.is(t.onCusto,"function")){t.onCusto.call(null,{nopreview:"visible"})}})),e.is(t.onCusto,"function"))){t.onCusto.call(null,{layout:"horizontal"})}}})})),define("DS/SNResultUX/views/3DSpacePreviewWrapper",["DS/SNResultUX/views/utils/3DSpacePreview"],(function(e){return e})),
/*!  COPYRIGHT DASSAULT SYSTEMES 2014   */
define("DS/SNResultUX/utils/datagridPreferences/Abstract",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Options","UWA/Class/Events","UWA/Element","DS/Spreadsheet/DataGrid","DS/UIKIT/SuperModal","DS/UIKIT/Input/Button","DS/UIKIT/Input/Toggle","DS/UIKIT/Input/Text","DS/UIKIT/Tooltip","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/SearchUtils","DS/SNResultUX/utils/ExternalComponentHelpers","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/MessageBus/MessageBus","DS/Windows/Dialog","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","i18n!DS/DataGridView/assets/nls/translation"],(function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_,f,m,S,v,w,b,C){"use strict";return t.extend(s,i,n,{_dialog:null,name:"SearchDataGridPreferences",_divCombo:null,_divGrid:null,_divFooter:null,_divMain:null,_divArrow:null,_arrow:null,_divAvailable:null,defaultOptions:{spreadsheet:null,preferences_grid:null,move_to_do:null},gridInitValues:null,gridFinalValues:null,_columnCustoPreferenceDefinition:null,_custoCombo:null,_unmodifiedCusto:!1,_predicateIntersection:null,_typeToHandle:null,_bFav:null,_bFavTooltip:null,_bDel:null,_bDelTooltip:null,_custoNameEdt:null,_zIndexToUse:0,oSearchCustoServices:null,qForceClose:null,init:function(t){this._dialog&&(this._dialog.destroy(),this._dialog=null),e.is(t.zIndexToUse)&&(this._zIndexToUse=t.zIndexToUse),this._parent(t),this.setOptions(t),this.postInit()},postInit:function(){let e=this;this.qForceClose=v.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"datagrid_preference_force_close",callback:function(){e._dialog&&e._dialog.close()}})},setoDatagridTarget:function(e){this.options.searchDatagridView=e},_isEndUserMode:function(){return void 0===this.options.typeToHandle},_buildView:function(){var t=this;h.log("_buildView");var i=o.create("div",{class:"global-column-custo-div"});this._divCombo=o.create("div",{class:"column-custo-combo-div"+(this._isEndUserMode()?"":" custo-flex")}),this._divCombo.inject(i),this._divMain=o.create("div",{class:"column-custo-grid-div"}),this._isEndUserMode()&&(this._divAvailable=o.create("div",{class:"column-custo-grid-div-content available"}),this._divAvailable.inject(this._divMain),this._divArrow=o.create("div",{class:"column-custo-grid-div-content arrow"}),this._arrow=new l({className:"primary arrow-rights wux-ui-3ds wux-ui-3ds-right",id:"aEndUserCustoAdPredicate",disabled:!0,events:{onClick:function(){t._onAddPredicate()}}}),this._arrow.inject(this._divArrow),this._divArrow.inject(this._divMain)),this._divGrid=o.create("div",{class:"column-custo-grid-div-content grid"+(this._isEndUserMode()?" extend":"")}),this._divGrid.inject(this._divMain),this._divMain.inject(i),this._divFooter=o.create("div",{class:"column-custo-footer-div"}),this._divFooter.inject(i);let n=b.replace(b.get("SearchDataGridPreferences_modal_title"),{typeName:"End User"});e.is(this._typeToHandle)&&(n=!1===this._typeToHandle.isPQ?b.replace(b.get("SearchDataGridPreferences_modal_title"),{typeName:this._typeToHandle.typeName}):b.replace(b.get("SearchDataGridPreferences_modal_title_PQ"),{typeName:this._typeToHandle.typeName.pqNLS})),this._dialog=new w({identifier:"ColumnCustoPanel",title:n,content:i,resizableFlag:!0,position:{at:"100 50",of:this.options.searchDatagridView.container,collision:"fit"},minHeight:440,minWidth:550,autoCloseFlag:!this._isEndUserMode()}),this._dialog.elements.container.setStyle("z-index",4e3),this._dialog.elements.container.addClassName("search-column-custo-dialog"),this._dialog.addEventListener("close",(function(){m.hideOverlayLoader(),t._isEndUserMode()?t._dialog.hide():(t._dialog=null,t.dispatchEvent("onCloseColumnCustomizationPanel"))})),this._dialog.inject(document.body),e.is(this._dialog.elements)&&e.is(this._dialog.elements._closeButton)&&(this._bCloseTooltip=new u({target:this._dialog.elements._closeButton,body:b.get("custo_close.tooltip")}),this._bCloseTooltip.getContent().style.zIndex=this._zIndexToUse+2),this._createFooter()},_onAddPredicate:function(){return null},_createFooter:function(){return null},enableFooterButtonsVisiblity:function(){return this},_fillView:function(){return null},_getPrefGridData:function(){var t=[],i=this.options.spreadsheet,n=this;return this.options.availableColumns.forEach((function(s){if(s&&!1!==s.isInPreference){var o={colName:""===s.text?b["SearchDataGridPreferences_modal_"+s.dataIndex]?b["SearchDataGridPreferences_modal_"+s.dataIndex]:s.dataIndex:s.text,colClass:s.relatedObjectTypeDispValue,colWidth:s.width,origin_dataIndex:s.dataIndex,colSort:s.defaultSort,colWrap:s.wrap,colPinned:s.pinned,colRemove:s.isRemovable};if(!0!==n.options.isNewDataGrid){var a=i.getManager().getColumnIDFromDataIndex(s.dataIndex);e.is(a)?(o.colVisibility={isHidden:i.getManager().isColumnHidden(a),isRemovable:!(e.is(s.isRemovable)&&!1===s.isRemovable)},o.colWidth=i.getManager().getColumnWidth(s.dataIndex)):o.colVisibility={isHidden:!0,isRemovable:!0}}else!0===n.options.isNewDataGrid&&(void 0!==i.layout.getColumnIndex(s.dataIndex)?(o.colVisibility={isHidden:!s.visibility,isRemovable:!(e.is(s.visibilityEditable)&&!1===s.visibilityEditable)},o.colWidth=s.width):o.colVisibility={isHidden:!e.is(s.visibility,"boolean")||!s.visibility,isRemovable:!e.is(s.isRemovable,"boolean")||s.isRemovable});t.push(o)}})),t},_getcolumnsDefinitions:function(){let e=[];return this._isEndUserMode()&&e.push({text:b.get("SearchDataGridPreferences_modal_header_classpredicate"),dataIndex:"colClass",width:"auto",minWidth:40}),e=e.concat([{dataIndex:"origin_dataIndex",width:0,idHidden:!0},{text:b.get("SearchDataGridPreferences_modal_header_name"),dataIndex:"colName",width:"auto",minWidth:40,isDraggable:!0},{text:b.get("SearchDataGridPreferences_modal_visible_column"),dataIndex:"colVisibility",width:80,minWidth:40},{text:b.get("SearchDataGridPreferences_modal_width"),dataIndex:"colWidth",width:60,minWidth:40}]),p.getOption("enableDataGridView")&&e.push({text:b.get("SearchDataGridPreferences_modal_wrap_column"),dataIndex:"colWrap",width:80,minWidth:40})&&e.push({text:C.ContextualMenuBuilder.PinMenu,dataIndex:"colPinned",width:80,minWidth:40}),p.getOption("enableMultiSort-FUN096610")&&e.push({text:b.get("SearchDataGridPreferences_modal_sort_column"),dataIndex:"colSort",width:80,minWidth:40}),this._isEndUserMode()&&e.push({text:b.get("SearchDataGridPreferences_modal_header_remove"),dataIndex:"colRemove",width:30}),e},_addGridColumnsManager:function(){var t=this;null!==this.options.preferences_grid&&this.options.preferences_grid.destroy(),this.options.preferences_grid=new a({enableScrollOnDrag:!0,columns:this._getcolumnsDefinitions(),data:this._getPrefGridData(),defaultCellHeight:40,headersDimensions:{height:40},selection:{cells:!1},show:{rowHeaders:!0,columnHeaders:!0},height:"auto",apiVersion:2,resize:{columns:!0},isEditable:{switchToWriteView:{event:"dblclick",callback:function(){this.switchToWriteView()},view:function(i){if(e.is(t.gridFinalValues,"array")&&e.is(i.virtualRowID)&&t.gridFinalValues.length>i.virtualRowID&&void 0!==t.gridFinalValues[i.virtualRowID])switch(i.dataIndex){case"colClass":return o.create("div",{html:t.gridFinalValues[i.virtualRowID].dataTypeText||""});case"colName":return o.create("div",{html:t.gridFinalValues[i.virtualRowID].text});case"colWidth":var n=t.gridFinalValues[i.virtualRowID].width;return"auto"===t.gridFinalValues[i.virtualRowID].width&&(n=b.get("SearchColumnCusto.AutoSize")),o.create("input",{type:"text",placeholder:n,events:{change:function(e){e.stopPropagation();var n=this.value;!1===isNaN(n)?(n=parseInt(n,10),t.gridFinalValues[i.virtualRowID].width=n):(t.gridFinalValues[i.virtualRowID].width="auto",this.value=b.get("SearchColumnCusto.AutoSize")),t._unmodifiedCusto=!1}}})}}},switchToReadView:{event:"blur",callback:function(){this.switchToReadView()},view:function(i){if((!e.is(t.beingDestroyed)||!0!==t.beingDestroyed)&&e.is(t.gridFinalValues,"array")&&e.is(i.virtualRowID)&&t.gridFinalValues.length>i.virtualRowID&&void 0!==t.gridFinalValues[i.virtualRowID])switch(i.dataIndex){case"colClass":return o.create("div",{html:e.is(t.gridFinalValues,"array")&&e.is(i.virtualRowID)&&t.gridFinalValues[i.virtualRowID].dataTypeText?t.gridFinalValues[i.virtualRowID].dataTypeText:"",attributes:{"data-type":t.gridFinalValues[i.virtualRowID].dataType},class:"cell-grid"});case"colName":var n="";return e.is(t.gridFinalValues,"array")&&e.is(i.virtualRowID)&&(n=t.gridFinalValues[i.virtualRowID].text),o.create("div",{html:n,attributes:{"data-index":t.gridFinalValues[i.virtualRowID].dataIndex},class:"cell-grid"});case"colVisibility":var s=!(e.is(t.gridFinalValues[i.virtualRowID])&&!0===t.gridFinalValues[i.virtualRowID].visibilityEditable);"ds6w:what/ds6w:type"!==t.gridFinalValues[i.virtualRowID].dataIndex&&"ds6w:what/ds6w:identifier"!==t.gridFinalValues[i.virtualRowID].dataIndex||(s=!0);var a=new c({type:"switch",label:"",value:"",disabled:s,events:{onChange:function(e){e.stopPropagation();var n=this.isChecked();i.cellModel.setCellContent({isHidden:!n,isRemovable:!0}),t.gridFinalValues[i.virtualRowID].visibility=n,t._unmodifiedCusto=!1}}});return!1===i.cellModel.getCellContent().isHidden&&a.check(),a;case"colWidth":var l=t.gridFinalValues[i.virtualRowID].width;return!0===isNaN(t.gridFinalValues[i.virtualRowID].width)&&(l=b.get("SearchColumnCusto.AutoSize")),o.create("div",{text:l});case"colSort":{var d="alpha",u="none";e.is(t.gridFinalValues,"array")&&e.is(i.virtualRowID)&&(h.log(t.gridFinalValues[i.virtualRowID]),e.is(t.options.oSearchCustoServices.DEFAULT_FIELDS[t.gridFinalValues[i.virtualRowID].dataIndex])&&(d=t.options.oSearchCustoServices.DEFAULT_FIELDS[t.gridFinalValues[i.virtualRowID].dataIndex]),e.is(t.gridFinalValues[i.virtualRowID].defaultSort,"string")&&(u=t.gridFinalValues[i.virtualRowID].defaultSort));let n=o.create("div",{class:"item-text item-icon-group"}),s=null,a=null,l=null;"group"===d?(s=o.create("Group",{title:"Grouping",order:"asc",class:"fonticon fonticon-tag-sorting"+("asc"===u?" "+t.options.oSearchCustoServices.SORT_ACTIVATED_CSS:"")}),s.inject(n),l=o.create("span",{title:"None",class:"fonticon fonticon-cancel"+("none"===u?" "+t.options.oSearchCustoServices.SORT_ACTIVATED_CSS:"")}),l.inject(n)):(s=o.create("span",{title:"Ascending",order:"asc",class:"fonticon fonticon-sort-"+d+"-asc"+("asc"===u?" "+t.options.oSearchCustoServices.SORT_ACTIVATED_CSS:"")}),s.inject(n),a=o.create("span",{title:"Descending",order:"desc",class:"fonticon fonticon-sort-"+d+"-desc"+("desc"===u?" "+t.options.oSearchCustoServices.SORT_ACTIVATED_CSS:"")}),a.inject(n),l=o.create("span",{title:"None",class:"fonticon fonticon-cancel"+("none"===u?" "+t.options.oSearchCustoServices.SORT_ACTIVATED_CSS:"")}),l.inject(n));var g=function(e){for(var i=0,n=0;n<t.gridFinalValues.length;n++)n!==e&&t.gridFinalValues[n].defaultSort&&"none"!==t.gridFinalValues[n].defaultSort&&i++;return!(i>=p.getOption("search_datagrid").multisort_standard_fields)||(new r({closable:!0,animate:!0,overlay:!0}).dialog({body:b.replace(b.get("dataGrid.columnCustoPanel.maxDefaultSortSize"),{number:p.getOption("search_datagrid").multisort_standard_fields}),title:b.get("SearchDataGridPreferences_modal_information"),buttons:[{className:"primary",value:b.get("SearchDataGridPreferences_modal_apply"),action:function(e){e.hide()}}]}),!1)};return s.onclick=function(){g(i.virtualRowID)&&(t.gridFinalValues[i.virtualRowID].defaultSort="asc",s.classList.add(t.options.oSearchCustoServices.SORT_ACTIVATED_CSS),a&&a.classList.remove(t.options.oSearchCustoServices.SORT_ACTIVATED_CSS),l.classList.remove(t.options.oSearchCustoServices.SORT_ACTIVATED_CSS),t._unmodifiedCusto=!1)},a&&(a.onclick=function(){g(i.virtualRowID)&&(t.gridFinalValues[i.virtualRowID].defaultSort="desc",s.classList.remove(t.options.oSearchCustoServices.SORT_ACTIVATED_CSS),a.classList.add(t.options.oSearchCustoServices.SORT_ACTIVATED_CSS),l.classList.remove(t.options.oSearchCustoServices.SORT_ACTIVATED_CSS),t._unmodifiedCusto=!1)}),l.onclick=function(){t.gridFinalValues[i.virtualRowID].defaultSort="none",s.classList.remove(t.options.oSearchCustoServices.SORT_ACTIVATED_CSS),a&&a.classList.remove(t.options.oSearchCustoServices.SORT_ACTIVATED_CSS),l.classList.add(t.options.oSearchCustoServices.SORT_ACTIVATED_CSS),t._unmodifiedCusto=!1},o.create("div",{html:n})}case"colWrap":var _=new c({type:"switch",label:"",value:"",disabled:!1,events:{onChange:function(n){n.stopPropagation();var s=this.isChecked();if(s&&e.is(p.getOption("search_datagrid").wrap_standard_fields)){for(var o=0,a=0;a<t.gridFinalValues.length;a++)!0===t.gridFinalValues[a].wrap&&o++;if(o>=p.getOption("search_datagrid").wrap_standard_fields)return new r({closable:!0,animate:!0,overlay:!0,className:"searchModal"}).dialog({body:b.replace(b.get("dataGrid.columnCustoPanel.maxWrapSize"),{number:p.getOption("search_datagrid").wrap_standard_fields}),title:b.get("SearchDataGridPreferences_modal_information"),buttons:[{className:"primary",value:b.get("SearchDataGridPreferences_modal_apply"),action:function(e){e.hide()}}]}),void this.setCheck(!1)}i.cellModel.setCellContent(s),t.gridFinalValues[i.virtualRowID].wrap=s,t._unmodifiedCusto=!1}}});return!0===i.cellModel.getCellContent()&&_.check(),_;case"colPinned":{var f=null;let n=null,s=null,a=null,r=null;return e.is(t.gridFinalValues,"array")&&e.is(i.virtualRowID)&&(h.log(t.gridFinalValues[i.virtualRowID]),e.is(t.gridFinalValues[i.virtualRowID].pinned,"string")&&(f=t.gridFinalValues[i.virtualRowID].pinned)),n=o.create("div",{class:"item-text item-icon-group"}),s=o.create("span",{title:C.ContextualMenuBuilder.PinLeft,order:"asc",class:"fonticon fonticon-picture-wrapping-left"+("left"===f?" "+t.options.oSearchCustoServices.PINNED_ACTIVATED_CSS:"")}),a=o.create("span",{title:C.ContextualMenuBuilder.PinRight,order:"asc",class:"fonticon fonticon-picture-wrapping-right"+("right"===f?" "+t.options.oSearchCustoServices.PINNED_ACTIVATED_CSS:"")}),r=o.create("span",{title:C.ContextualMenuBuilder.NoPin,order:"asc",class:"fonticon fonticon-cancel"+(null===f||"center"===f?" "+t.options.oSearchCustoServices.PINNED_ACTIVATED_CSS:"")}),s.inject(n),a.inject(n),r.inject(n),s.onclick=function(){t.gridFinalValues[i.virtualRowID].pinned="left",s.classList.add(t.options.oSearchCustoServices.PINNED_ACTIVATED_CSS),r.classList.remove(t.options.oSearchCustoServices.PINNED_ACTIVATED_CSS),a.classList.remove(t.options.oSearchCustoServices.PINNED_ACTIVATED_CSS),t._unmodifiedCusto=!1},a.onclick=function(){t.gridFinalValues[i.virtualRowID].pinned="right",s.classList.remove(t.options.oSearchCustoServices.PINNED_ACTIVATED_CSS),r.classList.remove(t.options.oSearchCustoServices.PINNED_ACTIVATED_CSS),a.classList.add(t.options.oSearchCustoServices.PINNED_ACTIVATED_CSS),t._unmodifiedCusto=!1},r.onclick=function(){t.gridFinalValues[i.virtualRowID].pinned="center",s.classList.remove(t.options.oSearchCustoServices.PINNED_ACTIVATED_CSS),r.classList.add(t.options.oSearchCustoServices.PINNED_ACTIVATED_CSS),a.classList.remove(t.options.oSearchCustoServices.PINNED_ACTIVATED_CSS),t._unmodifiedCusto=!1},o.create("div",{html:n})}case"colRemove":if(e.is(t.gridFinalValues,"array")&&e.is(i.virtualRowID)&&e.is(t.gridFinalValues[i.virtualRowID].isRemovable)&&!0===t.gridFinalValues[i.virtualRowID].isRemovable){var m=o.create("span",{title:b.get("SearchDataGridPreferences_modal_remove"),class:"fonticon fonticon-bin"});return m.onclick=function(){t.gridFinalValues.splice(i.virtualRowID,1),t.options.preferences_grid.getManager().removeRow(i.virtualRowID)},m}return""}}}},shouldAcceptDrag:function(e){return-1!==e.virtualRowID&&-1===e.virtualColumnID},onDragStart:function(){h.log("DRAG STARTED !")},onDrop:function(){return!0},isSortable:!1}),this.options.preferences_grid.getContent().addClassName(this.name),this.options.preferences_grid.inject(this._divGrid),this.options.preferences_grid.getManager().onRowHeaderRequest((function(e){var t=e.cellView.getContent();t.setStyles({paddingLeft:5,paddingRight:5,opacity:.5,fontSize:"1.5em"}),t.addClassName("wux-ui-hamburger")})),this.options.preferences_grid.getManager().onMoveRow((function(i){if(e.is(i.fromRowID)&&e.is(i.toRowID)){var n=t.gridFinalValues.splice(i.fromRowID,1);t.gridFinalValues.splice(i.toRowID,0,n[0]),t._unmodifiedCusto=!1}}))},_computeColToDisplayInCustoPanel:function(t,i,n){if(!e.is(t,"array")||!e.is(i,"array"))return h.error("Bad args in _computeColToDisplayInCustoPanel !"),s;var s=[],o=0,a=0,r={},l=0,c=0,d={"ds6w:what":!0,"ds6w:when":!0,"ds6w:where":!0,"ds6w:who":!0,"ds6w:why":!0,"ds6w:how":!0};for(o=0,a=t.length;o<a;o++)if(!e.is(r[t[o].dataIndex])){if("ds6wg:_displayName_"===(S=t[o].dataIndex))continue;r[S]=!0,r[S.slice(S.lastIndexOf("/")+1,S.length)]=!0;var u=t[o];if(!e.is(u.visibility)){u.visibility=!0,u.visibilityEditable=!0;for(var g=!1,p=0,f=i.length;p<f&&!g;p++)u.text!==i[p].dispValue&&u.uri!==i[p].sixw||(g=!0,u.dataType=i[p].relatedObjectType,u.name=i[p].name,u.text=i[p].dispValue,u.type=i[p].type)}s.push(u)}var m=[];for(o=0,a=i.length;o<a;o++)e.is(i[o].sixw)&&!e.is(r[i[o].sixw])&&(r[i[o].sixw]=!0,m.push({dataIndex:i[o].sixw,dataType:i[o].relatedObjectType,dataTypeText:i[o].relatedObjectTypeDispValue,name:i[o].name,text:e.is(i[o].dispValue,"string")&&i[o].dispValue.length>0?i[o].dispValue:_.getNLSValueForPredicate(i[o].sixw),isSortable:!1,minWidth:40,width:"auto",type:i[o].type,visibility:i[o].visibility||!1,visibilityEditable:!0,isRemovable:i[o].isRemovable||!1}));if(e.is(n))for(o=0,a=n.length;o<a;o++)if("real"!==n[o].type&&"double"!==n[o].type){var S=n[o].sixw.slice(n[o].sixw.lastIndexOf("/")+1,n[o].sixw.length);!e.is(S)||e.is(r[S])||e.is(d[S])||(r[S]=!0,m.push({dataIndex:S,dataType:n[o].relatedObjectType,name:n[o].name,text:e.is(n[o].dispValue,"string")&&n[o].dispValue.length>0?"* "+n[o].dispValue:"* "+_.getNLSValueForPredicate(S),isSortable:!1,minWidth:40,width:"auto",type:n[o].type,visibility:!1,visibilityEditable:!0}))}var v=["ds6w:identifier","ds6w:type"];for(l=0,c=s.length;l<c;l++)for(o=v.length-1;o>=0;o--)s[l].dataIndex!==v[o]&&s[l].dataIndex!=="ds6w:what/"+v[o]||(v.splice(o,1),s[l].visibility=!0,s[l].visibilityEditable=!1);for(l=0,c=m.length;l<c;l++)for(o=v.length;o>=0;o--)m[l].dataIndex===v[o]&&(v.splice(o,1),m[l].visibility=!0,m[l].visibilityEditable=!1);for(o=0;o<v.length;o++)m.push({dataIndex:v[o],dataType:null,name:v[o],text:_.getNLSValueForPredicate(v[o]),isSortable:!1,minWidth:40,width:"auto",visibility:!0,visibilityEditable:!1});if(m.sort((function(e,t){var i=0;return e.text.toUpperCase()>t.text.toUpperCase()?i=1:e.text.toUpperCase()<t.text.toUpperCase()&&(i=-1),i})),s=s.concat(m),e.is(s,"array"))for(p=0;p<s.length;p++)if(e.is(s[p].text,"string")&&s[p].text.includes("* "))for(var w=s[p].text.split("* ")[1],b=0;b<s.length;b++)s[b].text===w&&s.splice(p,1);return s},_applySetting:function(t,i){let n=[],s=[];if(f.isFUN096612Active()&&e.is(this._typeToHandle)&&e.is(this._typeToHandle.typeName)&&e.is(this._typeToHandle.typeName.pqName)){var o=this.options.oSearchCustoServices.getDisplayNameColumn(this._typeToHandle.typeName.pqName);e.is(o)&&n.push(o)}for(let t=0,i=this.gridFinalValues.length;t<i;t++){let i=this.gridFinalValues[t],o={dataIndex:i.dataIndex,name:e.is(i.name,"string")&&i.name.length>0?i.name:null,dataType:i.dataType,dataTypeText:i.dataTypeText||"",text:i.text,width:i.width,type:i.type,isSortable:!1,minWidth:40,defaultSort:e.is(i.defaultSort,"string")?i.defaultSort:"none",wrap:void 0!==i.wrap&&i.wrap,pinned:e.is(i.pinned,"string")?i.pinned:"center",isRemovable:!!e.is(i.isRemovable,"boolean")&&i.isRemovable};!0===i.visibility?n.push(o):this._isEndUserMode()&&(o.visibility=i.visibility,o.visibilityEditable=i.visibilityEditable,s.push(o))}this.options.searchDatagridView.updateCustoColumnAttribute(t,n),this.options.searchDatagridView._updateColumns(n,t,i,s)},_applyReset:function(t){t=t||this._typeToHandle;e.is(t)&&(t.forcedCusto="The_Default_Columns"),g.setItem("listColumnsWidth",""),g.commit();var i=this.options.oSearchCustoServices.getColumnCustomizationIdToUse(t);this.options.searchDatagridView._updateColumns(this.options.oSearchCustoServices.getColumnCustomizationDefinitionFromCustoId(i),i,!1)},_requestClosePanel:function(){e.is(this._dialog)&&(!this._isEndUserMode()&&e.is(this._dialog.close,"function")?(this._dialog.close(),this._dialog=null):this._isEndUserMode()&&e.is(this._dialog.hide,"function")&&this._dialog.hide())},showDialog:function(){e.is(this._dialog)&&e.is(this._dialog.show,"function")&&this._dialog.show()},_displayCusto:function(t,i){if(h.log("displayCusto"),!e.is(this.options.preferences_grid))return;this.options.preferences_grid.getManager().empty(),t===b.get("SearchDataGridPreferences_modal_unsavedCusto")&&(t="TEMP_CUSTO");let n=[];n=!0!==i?e.is(t)&&t.length>0?this.options.oSearchCustoServices.getColumnCustomizationDefinitionFromCustoId(t):this.options.searchDatagridView._columnsAttributes:this.gridInitValues;let s=this._computeColToDisplayInCustoPanel(n,this._predicateIntersection,this.options.currentTags),o=[],a=!1;for(var r=0;r<s.length;r++)if(e.is(s[r].text)&&-1!=s[r].text.indexOf("ds6w")){1==(s[r].text.match(/ds6w/g)||[]).length&&(o.push(s[r].dataIndex),a=!0)}else e.is(s[r].text)&&-1==s[r].dataIndex.indexOf("ds6w")&&(o.push(s[r].dataIndex),a=!0);let l=this,c=t=>{let i=[];l.gridFinalValues=t;for(var n=0,s=l.gridFinalValues.length;n<s;n++)i.push({colClass:l.gridFinalValues[n].dataTypeText||"",colName:l.gridFinalValues[n].text,colWidth:l.gridFinalValues[n].width,origin_dataIndex:l.gridFinalValues[n].dataIndex,colVisibility:{isHidden:!l.gridFinalValues[n].visibility,sisRemovable:!0},colSort:l.gridFinalValues[n].defaultSort,colWrap:l.gridFinalValues[n].wrap,colPinned:l.gridFinalValues[n].pinned,colRemove:!!e.is(l.gridFinalValues[n].isRemovable,"boolean")&&l.gridFinalValues[n].isRemovable});l.options.preferences_grid.getManager().empty(),l.options.preferences_grid.getManager().addRows(i),l.options.preferences_grid.getManager()._setColumnsWidth()};if(a){let t=this,i="";if(e.is(this.options.searchDatagridView.collection)&&e.is(this.options.searchDatagridView.collection.search_ressources)&&e.is(this.options.searchDatagridView.collection.search_ressources.getActiveTenant,"function")&&(i=this.options.searchDatagridView.collection.search_ressources.getActiveTenant()),o.length>0){var d=o.join("\r\n");S.getResourcesInfo(d,{tenantId:i,lang:f.getLanguage(),apiVersion:"R2019x",onComplete:function(i){if(h.log(i),!e.is(i))return h.error("Unexpected response from getResourcesInfo !"),null;for(var n=0,o=s.length;n<o;n++)for(var a=0,r=i.length;a<r;a++){if(!e.is(i[a].curi)||!e.is(i[a].label))return h.error("Unexpected response from getResourcesInfo !"),null;i[a].curi!==s[n].dataIndex||s[n].text===i[a].label||(s[n].text="* "+i[a].label)}c&&c.call(t,s)},onFailure:function(){h.warn("not able to load predicates"),c&&c.call(this,s)}})}}else c.call(this,s)},destroy:function(){this.beingDestroyed=!0,this.defaultOptions=null,this._divCombo=null,this._divGrid=null,this._divGrid=null,this._divFooter=null,this._divMain=null,this._divArrow=null,this._divAvailable=null,e.is(this._arrow)&&this._arrow.destroy()&&(this._arrow=null),e.is(this._dialog)&&this._dialog.destroy()&&(this._dialog=null),e.is(this._bCloseTooltip)&&this._bCloseTooltip.destroy()&&(this._bCloseTooltip=null),e.is(this.options.preferences_grid)&&this.options.preferences_grid.destroy()&&(this.options.preferences_grid=null),this._custoNameEdt=null,null!=this.qForceClose&&v.unsubscribe(this.qForceClose),this._parent()}})})),define("DS/SNResultUX/views/helpers/utils/AbstractMultiView",["DS/SNResultUX/views/helpers/Abstract","UWA/Core","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchUtils","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/SNResultUX/utils/ResultCategoryUXHelper","DS/SNResultUX/utils/SearchViewOptions","DS/SNResultUX/views/helpers/utils/SearchMultiViewUtils","DS/Utilities/Dom","DS/Utilities/Utils","DS/UIKIT/IconDropdown","DS/MessageBus/MessageBus","UWA/Utils/Client","i18n!DS/SNInfraUX/assets/nls/SNInfraUX.json","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],(function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_,f,m){"use strict";return e.extend({className:"MultiView",attributes:{styles:{width:"100%"},"data-rec-id":"SearchMultiView"},sixw:"ds6w:type",bShowTooltip:!1,views:[],multiViewContainer:null,collectionUX:null,collections:[],allowedviews:[],poolMultiViewContainerHeight:null,setPoolMultiViewContainerHeight:function(e){this.poolMultiViewContainerHeight=e},getPoolMultiViewContainerHeight:function(){return this.poolMultiViewContainerHeight},currentPoolMultiViewContainer:0,setCurrentPoolMultiViewContainer:function(e){this.currentPoolMultiViewContainer=e},getCurrentPoolMultiViewContainer:function(){return this.currentPoolMultiViewContainer},_reachBottomEventFire:!1,_infiniteScrollTagRunning:!1,_hasToBeRefreshed:!0,_lastselectedSearchId:null,_lastNbSection:0,_WHATmappedViews:[],_totalCount:0,_totalCountSection:0,_onGroupingCompute:!1,_ComputeGroup:!1,_RefineFromDropMenu:!1,_memorylastunselectedNodeId:null,_viewAllProvide:!1,_heightInjected:20,_lastlocalFilters:null,events:[],indexCopiedCACHED:null,init:function(e){this._parent(e),this.view=void 0,this._unloadViews(),this.multiViewContainer=null,this.collections=[],this.events=[],this.indexCopiedCACHED=null,this.setPoolMultiViewContainerHeight(0),this.setCurrentPoolMultiViewContainer(0),this._attachEvents(),this._reachBottomEventFire=!1,this.collectionUX=null,this._infiniteScrollTagRunning=!1,this.allowedviews=[],this._hasToBeRefreshed=!0,this._lastselectedSearchId=null,this._lastNbSection=0,this._WHATmappedViews=[],this._memorylastunselectedNodeId=null,this.bShowTooltip=!!t.is(i.getOption("webUXTooltip"))&&i.getOption("showTooltip"),this.neverCheckbox=!!t.is(i.getOption("neverCheckbox"))&&i.getOption("neverCheckbox"),this.neverAction=!!t.is(i.getOption("neverAction"))&&i.getOption("neverAction"),this._totalCount=e&&e.collection.totalCount,this._totalCountSection=0,this._onGroupingCompute=!1,this._ComputeGroup=!1,this._RefineFromDropMenu=!1,this._viewAllProvide=!1,this._heightInjected=20,this._lastlocalFilters=null},initModel:function(e){let t=this;this._model=e||this.collection.getTreeDocument(),this._lastXscreen=0,this.modelEventTokenForOnAdd=this._model.getXSO().onAdd((function(e){t.onItemSelected(e,t.indexCopiedCACHED)})),this.modelEventTokenForOnRemove=this._model.getXSO().onRemove((function(e){t.onItemUnselected(e,t.indexCopiedCACHED)})),this.view&&(this.view.model=this._model)},onSearch:function(e){this._parent(e)},setup:function(e){this._parent(e),!1!==e.bInitListeners&&this._initCollectionListener(e)},_initCollectionListener:function(e){let i=this;this.listenTo(this.collection,{onAdd:function(){},onRemove:function(){},onSort:function(){},onAnyEvent:function(){},onReset:function(){i._resetViews()},onSync:function(){},onSetTags:function(e){},onInitTreeDocumentAsyncCB:function(e){n.log("AbstractMultiView onInitTreeDocumentAsyncCB Event",e),i._lastlocalFilters=i._getLocalFilters(),i._computeDisplay()},OnGroupingChange:function(e){n.log("AbstractMultiView OnGroupingChange Event",e),i._viewAllProvide=!1,i._refreshViewFromOnGrouping(e)},onInitTreeDocument_SelectFirstElt:function(){n.log("AbstractMultiView onInitTreeDocument_SelectFirstElt Event",e);let o=i.getCurrentViewId();if(o===i.getViewId()){let n=i.collection.getTaggerProxy(),a=n.getCurrentFilter();!0===d.IfLastRefineisInTheGoodW(o,n,i._lastlocalFilters)?t.is(a)&&t.is(a.localFilters)&&t.is(a.localfilters.condition,"array")&&a.localfilters.condition.length>0&&(n.clearLocalGrouping(),i.collection.getSNSkeleton().switchOnView(s.getItem("LastSearchViewMode"))):i._refreshViewFromOnGrouping(e)}p.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"unmask6wComponents"})}})},_attachEvents:function(){var e=this;this.events.push(p.subscribe({channel:"3dSearch-global-view",topic:"emptyViews",callback:this._resetViews.bind(this)})),this.events.push(p.subscribe({channel:"3dSearch-global-view",topic:"reloadViews",callback:()=>{e._unselectAllButMe(),e._resetViews(),e._loadViews(0)}}))},_onInitTreeDocumentAsyncCB:function(e){let s=this;if(!0===s._onGroupingCompute)return;s._emptyViews(),s._resetViews(),s._onGroupingCompute=!0,null!==this.collectionUX&&delete this.collectionUX,i.getOption("debug")&&n.log("MultiView tags retrieved",s.getSNResultMgt().getEmbeddedTaggerTags());let a=s._getEmbeddedTaggerTags(e);void 0!==a&&(t.is(e)&&(s._ComputeGroup=a.computeGroup),this.mask(),l.getResultCategoryUXHelper().then((function(){let e=s.collection.service_parameters.originalSearchCriteria;"Favorite Searches"===e?e="(owner:"+o.getUserId()+" AND flattenedtaxonomies:types/PLMWspFavoriteSearch) OR flattenedtaxonomies:types/SavedSearch":t.is(s.collection.service_parameters.isAPQSearch)&&!0===s.collection.service_parameters.isAPQSearch&&!t.is(s.collection.service_parameters.search_criteria_to_display)&&(e=s.collection.service_parameters.query),s.collectionUX=l.getResultsCollections({search_text:e,categories:a.Tags,refine:s.collection.getTaggerProxy().getCurrentFilter(),facets:s.collection.parsed_response.getTags().summaryData,feature:i.getOption("fedsearch_query_label.feature_id.6WSearch")}),s.collectionUX.getFirstPage({onComplete:function(){let e=s.collectionUX.getCategoryCollectionsList();i.getOption("debug")&&n.log("run",e),s.collections=e,s._loadViews(0,s.collections.length),s._onGroupingCompute=!1,s._totalCount=s.collection.totalCount,s.collection&&s.collection.getSNSkeleton().updateCounterView(s._totalCount),s.collection.getSNSkeleton().switchOnView(s.getViewId()),s.refreshViewAfterComputeList()},onFailure:function(e){console.log("FAIL",e)}})})))},isMultiSelMode:function(){return!1},onItemTitleClick:function(e,i){p.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"clickOnItemTitle",persDim:{pd1:o.trackerData.search.indexItem+" index"}}});let n=e.nodeModel?e.nodeModel:e,s=this.collection.getSNSkeleton();t.is(s)&&s.onItemTitleClick(n,null,i)},onItemSelected:function(e,i){if(!t.is(e)||this.getCurrentViewId()!==this.getViewId())return;let n=e._options.id;if(this._memorylastunselectedNodeId===n)return this._unselectAllButMe(),this._memorylastunselectedNodeId=null,void p.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"unmask6wComponents"});p.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"onItemSelected",persDim:{pd1:o.trackerData.search.indexItem+" index"}}}),this._unselectAllButMe(i),this._lastselectedSearchId=n,this.onItemSelectedTracker(e);let s=this.collection.getSNSkeleton(),a=e.getTreeDocument();t.is(a)&&(this.indexCopiedCACHED=i,t.is(s)&&s.onItemSelected(n,null,this.collections[i],a),p.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"mask6wComponents"}))},onItemUnselected:function(e,i){if(!t.is(e))return;this.getCurrentViewId()===this.getViewId()&&(this._lastselectedSearchId=null);let s=this.collection.getSNSkeleton(),o=e.getTreeDocument(),a=this.collections[i];if(t.is(o)){e&&e._options&&e._options.id&&(this._memorylastunselectedNodeId=e._options.id),this.indexCopiedCACHED=null,p.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"unmask6wComponents"});try{t.is(s)&&s.onItemSelected(null,null,a,o)}catch(e){n.error(e)}}},_unloadViews:function(){for(let e=0;e<this.views.length;e++)t.is(this.views[e])&&(t.is(this.views[e].view)&&this.views[e].view.destroy(),t.is(this.views[e].model)&&this.views[e].model.destroy());this.views=[]},_emptyViews:function(){if(this.views.length>0){for(let e=0;e<this.views.length;e++)null!==this.views[e]&&t.is(this.views[e])&&t.is(this.views[e].model)&&(this.views[e].model.prepareUpdate(),this.views[e].model.removeRoots(),this.views[e].model.pushUpdate());this.views=[]}},_instantiateResponsiveCollection:function(e,i,n){let s=new e(i),o=this;s.selectionBehavior.toggle=!1,s.selectionBehavior.canMultiSelect=!1,s.selectionBehavior.canInteractiveMultiselectWithCheckboxClick=!1,s.selectionBehavior.enableShiftSelection=!1,s.selectionBehavior.enableFeedbackForActiveCell=!1,s.onCellDoubleClick((e=>{o.onItemDblClick(e.cellModel)}));let a=t.clone(n);return s.onSelectionAdd((e=>{o.onItemSelected(e,a)})),s.onSelectionRemove((e=>{o.onItemUnselected(e,a)})),t.is(this._simpleSearch)&&!0===this._simpleSearch&&t.is(s.onCellTitleClick,"function")&&s.onCellTitleClick((e=>{o.onItemTitleClick(e.cellModel,o.collections[a])})),s.onContextualEvent=i.onContextualEvent,s.displayTitleTooltip=this.bShowTooltip,!0===this.neverCheckbox&&(s.visibilityFlag=!1),s},_instantiateDataGrid:function(e,i,n,s){let o=this,a=t.clone(n),r=new e({identifier:i.identifier?i.identifier:"",treeDocument:i.model,defaultColumnDef:{width:"auto",typeRepresentation:"string",allowUnsafeHTMLContent:!0},columns:this._retrieveDataGridOptions(i.collection,a).columns,collection:this.collection,rowSelection:"single",cellSelection:"none",onDragStartCell:i.onDragStartCell,onDragEndCell:i.onDragEndCellDefault,cellDragEnabledFlag:!0,isLoading:!0,bDisableMenuCustoView:!0,bDisableMenuWrap:!0,enable3dSearchSortMulti:!1,enable3dSearchSort:!1,onContextualEvent:function(e){return e&&e.cellInfos&&-1!==e.cellInfos.rowID?o.getOptionCommon().onContextualEvent.callback(e):e&&e.collectionView?e.collectionView.build3DSearchHeaderColumnContextualMenu(e,o):[]},sortOptions:{maxSortedColumnsCount:1}});return r.onReady((()=>{r.postInit(),r.getNodesXSO().onAdd((e=>{o.onItemSelected(e,a)})),r.getNodesXSO().onRemove((e=>{o.onItemUnselected(e,a)}))})),r},_retrieveDataGridOptions:function(e,t){return c.initColumnsDataGrid({columns:[{dataIndex:"ds6w:label",editableFlag:!1,isCustom:!0,sortableFlag:!0,text:m.get("view.multi.datagrid.label"),width:"auto",canBeInvisible:!1},{dataIndex:"ds6w:type",editableFlag:!1,isCustom:!0,sortableFlag:!0,text:m.get("view.multi.datagrid.type"),width:"auto"},{dataIndex:"ds6w:description",editableFlag:!1,isCustom:!0,sortableFlag:!0,text:m.get("view.multi.datagrid.description"),width:"auto"},{dataIndex:"ds6w:identifier",editableFlag:!1,isCustom:!0,sortableFlag:!0,text:m.get("view.multi.datagrid.identifier"),width:"auto"},{dataIndex:"ds6w:modified",editableFlag:!1,isCustom:!0,sortableFlag:!0,text:m.get("view.multi.datagrid.modified"),width:"auto"},{dataIndex:"ds6w:created",editableFlag:!1,isCustom:!0,sortableFlag:!0,text:m.get("view.multi.datagrid.created"),width:"auto"},{dataIndex:"ds6w:responsible",editableFlag:!1,isCustom:!0,sortableFlag:!0,text:m.get("view.multi.datagrid.responsible"),width:"auto"}]},{onClickEvent:this._callBackActionMenu,onContextualEvent:this.getOptionCommon().onContextualEvent.callback,onItemTitleClickCallback:this.onItemTitleClick,onDblClickEvent:this._callBackDblClickActionMenu,onItemTitleDblClickCallback:this.onItemDblClick,referer:this,actionsMenuAccessRights:this._getMenuAndLocalActionsStatus(),tabId:this.collection.getSNSkeleton().getOption("observable").getTabID(),tooltipCB:this._tooltipCB,collection:e,datagridID:t})},_reachBottom:function(e){if(this._reachBottomEventFire)return;i.getOption("debug")&&n.log("reachBottom_event");let t=this;this._reachBottomEventFire=!0,this._onInfiniteScrollMulti(e,(()=>{t._reachBottomEventFire=!1}))},_unselectAllButMe:function(e){for(let t=0;t<this.views.length;t++)e!=t&&null!=this.views[t]&&void 0!==this.views[t].view&&("list"===this.views[t].type||"table"===this.views[t].type||"datagrid"===this.views[t].type?this.views[t].view.unselectAll(!0):this.views[t].view.unselectAll())},_resetViews:function(){this._infiniteScrollTagRunning=!1,this._reachBottomEventFire=!1,this._unloadViews(),t.is(this.multiViewContainer)&&(this.multiViewContainer.innerHTML=""),this._heightInjected=20},_loadViews:function(e,r,l){let c=this;require(["DS/SNResultUX/views/WebUX/CollectionView/ResponsiveLargeTextualTilesCollectionView","DS/SNResultUX/views/WebUX/CollectionView/ResponsiveLargeTilesCollectionView","DS/SNResultUX/views/WebUX/CollectionView/ResponsiveThumbnailsCollectionView","DS/SNResultUX/views/WebUX/CollectionView/ResponsiveTilesCollectionView","DS/SNResultUX/views/WebUX/DataGrid/DataGridView"],(function(l,u,g,_,m){let S=c.getOptionCommon();S.height="inherit",S.displayedOptionalCellProperties=["contextualMenu","description"];let v=c.collection.getSNSkeleton()&&c.collection.getSNSkeleton().getSearchWidget(),w=t.is(v)?v.body:t.extendElement(document.body).getElement(".onesearch_results"),b=c.multiViewContainer&&c.multiViewContainer.getDimensions(),C=b&&b.height,y=0,D=r||c.collections.length;for(let r=e;r<D;r++){let e=c.collections[r];try{if(!t.is(e,"object")||0===e.totalCount){c.views[r]=null,y++;continue}let v={...S},I=new a({useAsyncPreExpand:!0,shouldAcceptDrag:function(){return!0},shouldAcceptDrop:function(){return!1}});c.collection.grouping6W=!0,c.collection.generateTreeModelAsync(e._models,I,8),v.model=I,v.collection=e,v.identifier="wux-3dsearch-6w-"+r,e.setTaggerProxy(c.collection.getTaggerProxy()),e._treeDocument=I,d.createSearchMultiViewLabel(e,c.id,{onclick:()=>{p.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"clickOnViewSection",persDim:{pd1:"0"}}}),c._onTitleClick(e,!0)}}).inject(c.multiViewContainer);let T="tile";try{"what"===c.getCurrentViewId()&&t.is(e.view&&c._WHATmappedViews&&c._WHATmappedViews[e.view.id]&&c._WHATmappedViews[e.view.id][e.view.object])&&(T=c._WHATmappedViews[e.view.id][e.view.object].view)}catch(e){i.getOption("debug")&&n.log("[3dSearch - WHAT] : ",e),T="tile"}"where"===c.getCurrentViewId()&&(T="tile"),"when"!==c.getCurrentViewId()&&"who"!==c.getCurrentViewId()||(T="tile"),void 0!==s.getItem("LastSearchViewMode")&&(T=s.getItem("LastSearchViewMode"));let A=t.is(T)?T:"tile",x={model:v.model,type:A,tag:r};if(-1===e.totalCount)continue;switch(T){case"thumbnail":v.displayedOptionalCellProperties=["contextualMenu"],x.view=c._instantiateResponsiveCollection(g,v,r),x.view.onPostCellRequest&&x.view.onPostCellRequest((e=>{let i=e.cellView;t.is(i)&&t.is(i.contentView)&&t.is(i.contentView.setPictureBackgroundSize,"function")&&i.contentView.setPictureBackgroundSize("auto")}));break;case"largeTile":case"tilebig":x.view=c._instantiateResponsiveCollection(u,v,r);break;case"textual":case"largeTextual":x.view=c._instantiateResponsiveCollection(l,v,r);break;case"tile":x.view=c._instantiateResponsiveCollection(_,v,r);break;case"list":case"table":case"datagrid":x.view=c._instantiateDataGrid(m,v,r,e);break;default:throw new Error("[MultiView] - incorrect view model given.")}x.view&&x.view.onReady((()=>{c.setPoolMultiViewContainerHeight(c.container.scrollHeight);let n=h.debounce((function(e){x.view.requestDelayedModelData(e);let t=x.view._dimensions;c._heightInjected+=48,c._heightInjected+=t&&t.height,c._heightInjected<=C&&r===D-1&&(c._reachBottomEventFire=!0,c._onInfiniteScrollMulti(null,(()=>{c._reachBottomEventFire=!1})))}),1);x.view._updateDimensions(),x.view.invalidateLayout({updateCellContent:!1,updateCellLayout:!0,updateCellAttributes:!1}),x.view._onEndResizeOrOnReadyModelCompletionRequest("OnEndResize"),n("OnResize"),x.view._modelEvents.publish({event:"ENDRESIZE",context:x.view}),!0===i.getOption("search_compact_mode")&&x.view.onPostCellRequest&&x.view.onPostCellRequest((function(e){var i=null;i=e.cellView.elements.container.querySelector(".wux-controls-responsivethumbnailview-menu"),t.is(i)||(i=e.cellView.elements.container.querySelector(".wux-controls-responsivetileview-menu")),t.is(i)||(i=e.cellView.elements.container.querySelector(".wux-controls-responsivetextualtileview-menu")),t.is(i)||(i=e.cellView.elements.container.querySelector(".wux-ui-3ds-open-down"))&&(i.style.display="none",i=void 0),t.is(i)&&i.setAttribute("has-menu","true")})),c.updateListContentAfterCreation(e,T,b)})),c.views[r]=x,t.is(T)&&"list"!==T?c.views[r].view.getContent().inject(c.multiViewContainer):c.views[r].view.inject(c.multiViewContainer);let N=f.get("search.result.view.more");o.isMobile()&&"ipad"!==o.getDeviceCategory()&&"android"!==o.getDeviceCategory()||(N=v.collection.service_parameters.query.contains("ds6w:responsible")&&0===r&&"ME"===v.collection.headTitle&&void 0===v.collection.icon.classes?f.get("search.result.view.more.myContent"):f.replace(f.get("search.result.view.more.content"),{type:e.headTitle}));let E=t.createElement("div",{class:"search-multi-view-more",content:N,"data-rec-viewmore-uid":""});E.inject(c.multiViewContainer),E.onclick=t=>{p.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"clickOnViewMore",persDim:{pd1:"0"}}}),o.isFUN127551Active()?c._onViewMoreClick(r,t):c._onTitleClick(e,!0)},e.moreView={label:E,viewType:T},w&&!1===d.ifDisplayViewMore(T,e,w.getDimensions(),c.getViewId())&&(o.isMobile()?E.setStyle("display","none"):E.setStyle("visibility","hidden")),y>0&&(c._reachBottomEventFire=!0,c._onInfiniteScrollMulti(null,(()=>{c._reachBottomEventFire=!1})))}catch(e){i.getOption("debug")&&n.log(e)}}c.unmask(),c.dispatchEvent("onMultiView",{collections:c.collections})}))},_onInfiniteScrollMulti:function(e,t){if(i.getOption("debug")&&n.log(e,this._infiniteScrollTagRunning),!0===this._infiniteScrollTagRunning)return;let s=this;this._infiniteScrollTagRunning=!0,s.collectionUX&&s.collectionUX.hasNextPage()&&(s.collection.getSNSkeleton()&&s.collection.getSNSkeleton()._toggleLoader(),s.collectionUX.getNextPage({onComplete:function(){let e=s.collectionUX.getCategoryCollectionsList(),o=s.collections.length;i.getOption("debug")&&n.log("fetch all done..."+s.collectionUX.hasNextPage(),e),s.collections=s.collections.concat(e),s._loadViews(o),t&&t(),s._infiniteScrollTagRunning=!1,s.collection.getSNSkeleton()&&s.collection.getSNSkeleton()._toggleLoader(),s.unmask()},onFailure:function(){s.collection.getSNSkeleton()&&s.collection.getSNSkeleton()._toggleLoader(),s.unmask()}}))},_onTitleClick:function(e,o=!1){p.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"clickOnTitleCategory",persDim:{pd1:e.headTitle}}});let a,r=this,l=this.collection.getTaggerProxy();if(!t.is(l))throw new Exception("No tagger proxy given");try{a=this.getSNResultMgt().getEmbeddedTaggerTags().groups[0].object}catch(e){i.getOption("debug")&&n.log("MultiView title click",e)}this._viewAllProvide=!1,t.is(o)&&!0===o&&(l.clearLocalGrouping(),this._viewAllProvide=!0);let c=i=>{for(let o=0;o<i.length;o++){n.log("[3dSearch - findOutElementInTags]",e,"|",i[o]);let a=t.is(i[o].dispText,"Array")?i[o].dispText.join(" "):i[o].dispText,u=e.headTitle;if(n.log("[3dSearch - findOutElementInTags formatted]",u,"|",a),a===u&&t.is(i[o].object,"object")&&("date"===i[o].type||t.is(i[o].object.predicates,"array")&&t.is(i[o].object.value,"array")&&i[o].object.predicates.length==i[o].object.value.length)){if(!0===r._viewAllProvide){return!0===d.IfMustAddRefineOnTitleClick(l,u)&&r._setLocalFilter(l,i[o],r.id),!0===r._viewAllProvide&&(r._totalCountSection=r.collection.totalCount,r.collection.getSNSkeleton().updateCounterView(r._totalCountSection),r.collection.getSNSkeleton().switchOnView(s.getItem("LastSearchViewMode"))),!0}return r._setLocalFilter(l,i[o],r.id),!0}if(i[o].subGroups&&i[o].subGroups.length>0&&!0===c(i[o].subGroups))return!0}};c(a),this.collection.getSNSkeleton().getOption("observable").getRefineHelpers().hideGlobeView(),this.collection.getSNSkeleton().getOption("observable").getRefineHelpers().hideTimelineView(),this.collection.getSNSkeleton().getOption("observable").getRefineHelpers().hidePhonebookView(),this.collection.getSNSkeleton().getOption("observable").getRefineHelpers().hideTagcloudView()},_onViewMoreClick:function(e,t){let s=this;require(["DS/CollectionView/CollectionViewPaginationManager","DS/DataGridView/DataGridViewPaginationManager","DS/CollectionView/CollectionViewStatusBar"],(function(o,r,l){let c=8;"thumbnail"===s.views[e].type&&(c=5);let d=new o({pageSize:c,currentPage:1});s.views[e].view.paginationManager=d,s.views[e].view.buildStatusBar([{type:l.STATUS.PAGINATION,position:"center"}]);s.views[e].view.getWholeModelLengthForAsyncPagination=()=>s.collections[e].hits,s.views[e].view.onPaginationChangeAsyncLoadModel((t=>{s.views[e].view.displayModalLoader(m.get("loading")),setTimeout((function(){(t=>{if(i.getOption("debug")&&console.log("load init",e,t),void 0===t||void 0===t.pageSize||void 0===t.currentPage)throw new Exception("Options should be fulfilled.");if(s.collections[e]._models.length<=t.pageSize*t.currentPage&&s.collections[e])s.collections[e].getLastPage({remove:!1,onComplete:function(){let o=new a({useAsyncPreExpand:!0,shouldAcceptDrag:function(){return!0},shouldAcceptDrop:function(){return!1}});s.collection.generateTreeModelAsync(s.collections[e]._models,o),s.views[e].model=o,i.getOption("debug")&&n.log("FREAK",s.views[e].view.model,o.getRoots());let r=o.getRoots(),l=parseInt((t.currentPage-1)*t.pageSize),c=parseInt(l+t.pageSize);s.views[e].view.model=r.slice(l,c),i.getOption("debug")&&n.log("ADAPT",s.views[e].view.model),s.views[e].view.paginationChangeAsyncProcessDone(),s.views[e].view.removeModalLoader(m.get("loading"))},onFailure:function(){console.error("Fail")}});else{let i=s.views[e].model.getRoots(),n=parseInt((t.currentPage-1)*t.pageSize),o=parseInt(n+t.pageSize);s.views[e].view.model=i.slice(n,o),s.views[e].view.paginationChangeAsyncProcessDone(),s.views[e].view.removeModalLoader(m.get("loading"))}})(t)}),50)})),s.views[e].view.paginationManager.updatePagination(),t&&t.target&&(t.target.style.display="none")}))},_setLocalFilter:function(e,i,n=!0){let s,o=this,a=e=>{if(t.is(e,"array")){let t=[];for(let i=0;i<e.length;i++)t.push({display:e[i].dispText,object:e[i].identifier,type:e[i].type,predicates:e[i].object.predicates,value:e[i].object.value,operator:"OR"});return t}return[{display:e.dispText,object:e.identifier,type:e.type,predicates:e.object.predicates,value:e.object.value,operator:"OR"}]},r={};var l;"what"===o.id||"who"===o.id?s="ds6w:"+o.id+"/":"when"===o.id?s="sixw:ds6w:when/":"where"===o.id&&(s="ds6w:where/ds6w:location/"),s+=o.getSNResultMgt().getEmbeddedTaggerTags().groups[0].predicate,"what"===o.id||"who"===o.id||"where"===o.id?r[s]={condition:a(i),isComplex:!0,operator:"OR"}:"when"===o.id&&(r[s]=[{displayValue:(l=i).dispText,object:l.object,isSimplifiedCriteria:!0,type:l.type}]);let c={condition:[r],operator:"AND",isSimplified:{version:2}};e.setLocalFilter(c,n)},_renderMulti:function(){let e=this;this.multiViewContainer=t.createElement("div",{class:"search-multi-view","data-rec-id":"search-multi-view"}).inject(this.container);let i=t=>{e.setCurrentPoolMultiViewContainer(parseInt(e.container.scrollTop+e.container.offsetHeight+188)),e.getCurrentPoolMultiViewContainer()>=2*e.getPoolMultiViewContainerHeight()/3&&e._reachBottom(t)};u.addEventOnElement(this,this.container,"wheel",(e=>{i(e)})),u.addEventOnElement(this,this.container,"mouseup",(e=>{i(e)})),u.addEventOnElement(this,this.container,"touchend",(e=>{i(e)}))},render:function(){return this._unloadViews(),null===this.multiViewContainer&&this._renderMulti(),this},launchContextMenu:function(e,i){if(!t.is(e))return;let n=this,s=null,a=null,r=e.getTreeDocument();if(t.is(r))if(o.isWebInWin())this._parent.apply(this,arguments);else{let o=r.getXSO().get();if(-1===o.indexOf(e)){for(s=0;s<o.length;s++){let e=r.getRoots().indexOf(o[s]);r.getNthRoot(e).unselect()}a=r.getRoots().indexOf(e),-1!==a&&r.getRoots()[a].select()}o=r.getXSO().get();let l=[],c=n.collections.length;for(let e=0;e<c;e++){let a=n.collections[e];for(s=0;s<o.length;s++){let n=a.get(o[s]._options.id);t.is(n)&&(l.push(n),i.collection=a,e=c)}}let d=n.collection.getSNSkeleton();t.is(d)&&t.is(l,"array")&&l.length>=0&&d.computeCtxActions2(l,i)}},showEmptyView:function(){let e=t.extendElement(this.container.querySelector(".search-multi-view"));t.is(e)&&e.setStyle("display","none"),this._parent.apply(this,arguments)},hideEmptyView:function(){this._parent.apply(this,arguments);let e=t.extendElement(this.container.querySelector(".search-multi-view"));t.is(e)&&e.setStyle("display","block")},_getEmbeddedTaggerTags:function(e){let s,o=this.collection.getTaggerProxy();if(!t.is(o))throw new Exception("No tagger proxy given");try{s=t.is(e,"object")&&t.is(e.groups,"array")?e:this.getSNResultMgt().getEmbeddedTaggerTags()}catch(e){i.getOption("debug")&&n.log("Embedded tags error",e)}if(s=d.getEmbeddedTaggerTags(this.getViewId(),o,s,this.getSNResultMgt(),!1),t.is(s)&&p.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"clickOnTag",persDim:{pd1:s.W}}}),s&&"what"===s.W){let e=[];for(let t=0;t<s.Tags.groups[0].object.length;t++)s.Tags.groups[0].object[t].identifier&&e.push({nls:s.Tags.groups[0].object[t].dispText,category:s.Tags.groups[0].object[t].identifier});this._WHATmappedViews=l.getViewMapping(e)}return s},_manageSearchBackArrow:function(e){return d.manageSearchBackArrow(this,e)},manageDisplayChannelView:function(e){let s=this,o=s.collections.length;for(let a=0;a<o;a++){let o=s.collections[a],r="tile";try{"what"===s.getCurrentViewId()&&t.is(o.view)&&(r=s._WHATmappedViews[o.headTitle].view)}catch(e){i.getOption("debug")&&n.log("[WHAT] : ",e),r="tile"}"where"===s.getCurrentViewId()&&(r="tile"),"when"!==s.getCurrentViewId()&&"who"!==s.getCurrentViewId()||(r="tile"),d.manageDisplayChannelView(o,r,e);let l=o.moreView;if(t.is(l)){let t=l.viewType,i=l.label;i.setStyle("visibility","visible"),!1===d.ifDisplayViewMore(t,o,e)&&i.setStyle("visibility","hidden")}}},_refreshViewFromOnGrouping:function(e){let t=this,i=t.getCurrentViewId(),n=t.getViewId();n===i&&(t._hasToBeRefreshed=!0,i===n&&(t._onInitTreeDocumentAsyncCB(e),t._hasToBeRefreshed=!1,t._lastNbSection=0))},_refreshViewGrouping:function(){let e=this;e._hasToBeRefreshed=!0;let i=e.getCurrentViewId(),n=e.getViewId(),s=e.getSNResultMgt().getEmbeddedTaggerTags();if(i===n)!0===e._ComputeGroup&&(e._onInitTreeDocumentAsyncCB(s),e._hasToBeRefreshed=!1,e._ComputeGroup=!1),e._lastNbSection=0,e._RefineFromDropMenu=!1;else if(!0===e._RefineFromDropMenu){if("what"!==i&&"who"!==i&&"when"!==i){let i=e._getEmbeddedTaggerTags(s);(i&&i.W)===n&&t.is(i.Tags)&&(e._lastNbSection=0,e.collection.getSNSkeleton().resetMultisel(),!0===e._ComputeGroup&&(e._onInitTreeDocumentAsyncCB(s),e._hasToBeRefreshed=!1,e._ComputeGroup=!1))}e._RefineFromDropMenu=!1}else e._refreshViewFromRefine(e._getEmbeddedTaggerTags(e.getSNResultMgt().getEmbeddedTaggerTags())),e._totalCountSection=this.collection.totalCount},_refreshViewFromRefine:function(e){let i=this;i._hasToBeRefreshed=!0;let n=i.getCurrentViewId(),o=i.getViewId(),a=!1,r=t.is(e)?e:i._getEmbeddedTaggerTags();if(t.is(r)){if(o===r.W)if("where"===o)i._hasToBeRefreshed=!1,i.collection.getSNSkeleton().switchOnView(s.getItem("LastSearchViewMode")),a=!0,i._lastselectedSearchId&&d.selectElementInGlobalView(i._lastselectedSearchId,i.collection);else{if("what"===n&&"who"===n&&"when"===n)return;a=!0,i._lastselectedSearchId&&d.selectElementInGlobalView(i._lastselectedSearchId,i.collection)}if(!0===a){let e=r.Tags;if(t.is(e)&&t.is(e.groups,"array")){if(e.groups[0].object.length){let n=e.groups[0].object[0];if(t.is(n)){let e=n.dispText,t=n.iconInfo,s=(t&&t.image,{headTitle:e,hits:i.collection.hits,icon:t});d.createSearchMultiViewLabel(s,i.id);i._lastNbSection=1}}}}}},_computeDisplay:function(){let e=this,i=e.getViewId(),a=e.getCurrentViewId();if(!0===d.checkIfRefine(e.collection.getTaggerProxy(),e._getEmbeddedTaggerTags(),a,i))n.log("->MultiView Compute Display do from Refine"),e._totalCountSection=this.collection.totalCount,e._RefineFromDropMenu=!0,!0===this._viewAllProvide&&!1===e._onGroupingCompute?e._viewAllProvide=!1:(e._ComputeGroup=!0,e._refreshViewGrouping());else{n.log("->MultiView Compute Display all categories view: ",i);let a=e.getSNResultMgt()._getSearchType(),r=this._getLocalFilters();if("what"!==i&&"who"!==i&&"when"!==i&&"where"!==i||o.SearchTypeEnum.MY_CONTENT===a||o.SearchTypeEnum.FAVORITE_SEARCH===a||!(!t.is(r)||t.is(r)&&t.is(r.condition)&&0==r.condition.length))if(o.SearchTypeEnum.MY_CONTENT===a||o.SearchTypeEnum.FAVORITE_SEARCH===a)e._refreshViewGrouping();else{let i=e.collection.getTaggerProxy(),n=i&&i.getCurrentFilter();t.is(n)||e.collection&&e.collection.getSNSkeleton()&&e.collection.getSNSkeleton().switchOnView(s.getItem("LastSearchViewMode"))}else e._ComputeGroup=!0,e._refreshViewGrouping()}},updateListContentAfterCreation:function(e,t,i){d.manageDisplayChannelView(e,t,i)},_getLocalFilters:function(){if(!t.is(this.collection))return;let e=this.collection.getTaggerProxy().getCurrentFilter();return t.is(e)?e.localfilters:{}},refreshViewAfterComputeList:function(){},destroy:function(){this._unloadViews();for(let e=0;e<this.events.length;e++)p.unsubscribe(this.events[e]);this._parent()}})})),define("DS/SNResultUX/views/WebUX/DataGrid/DataGridView",["UWA/Core","DS/DataGridView/DataGridView","DS/MessageBus/MessageBus","DS/Utilities/Dom","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/Menu/ContextualMenu","DS/SNInfraUX/SearchSettings","DS/SNResultUX/utils/SearchCustoServices","DS/SNResultUX/utils/SearchServices","DS/Core/PointerEvents","i18n!DS/DataGridView/assets/nls/translation","DS/SNInfraUX/SearchUtils","DS/SNSearchResultsCusto/utils/SearchResultsCustomizationPreferences","DS/SNInfraUX/Logger","DS/SNInfraUX/PredicatesNLS"],(function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p){"use strict";var _=["ds6w:created","ds6w:modified","ds6w:type"],f=!0;return t.inherit({name:"3dSearchDataGridView",publishedProperties:{collection:{defaultValue:null,type:"object"},rowGroupingOptions:{defaultValue:{depth:0,hideGroupedColumns:!1},type:"object"}},storedXSOInitialized:[],treeDocumentStored:null,wrapEventCB:null,dblClickEventCB:null,visibleEventCB:null,pinEventCB:null,onColumnWidthUpdate:null,onUnselectAllCB:null,onSelectAllCB:null,columnsPROPS:null,enable3dSearchSort:!0,enable3dSearchSortMulti:!0,bDisableMenuCustoView:!1,bDisableMenuWrap:!1,pointerUPCB:null,resetScrollPosition:function(){this.scrollerPosition={x:0,y:0}},setSortMode3dSearch:function(e){this.enable3dSearchSort=e},init:function(t){f=!0,t.treeDocument.getXSO()&&(this.storedXSOInitialized=t.treeDocument.getXSO().get()),t.wrapEventCB&&(this.wrapEventCB=t.wrapEventCB),t.dblClickEventCB&&(this.dblClickEventCB=t.dblClickEventCB),t.visibleEventCB&&(this.visibleEventCB=t.visibleEventCB),t.pinEventCB&&(this.pinEventCB=t.pinEventCB),t.onColumnWidthUpdate&&(this.onColumnWidthUpdate=t.onColumnWidthUpdate),t.onUnselectAllCB&&(this.onUnselectAllCB=t.onUnselectAllCB),t.onSelectAllCB&&(this.onSelectAllCB=t.onSelectAllCB),t.columns&&(this.columnsPROPS=t.columns),t.pointerUPCB&&(this.pointerUPCB=t.pointerUPCB),e.is(t.bDisableMenuCustoView,"boolean")&&(this.bDisableMenuCustoView=t.bDisableMenuCustoView),e.is(t.bDisableMenuWrap,"boolean")&&(this.bDisableMenuWrap=t.bDisableMenuWrap),e.is(t.enable3dSearchSort,"boolean")&&(this.enable3dSearchSort=t.enable3dSearchSort),e.is(t.enable3dSearchSortMulti,"boolean")&&(this.enable3dSearchSortMulti=t.enable3dSearchSortMulti),this._parent(t),this._useTreeDocumentRestoration=!1},postInit:function(){f=!1},getColumns:function(){return this.columnsPROPS},setColumns:function(e){this.columnsPROPS=e},_emitWrapEventCB:function(t){e.is(this.wrapEventCB,"function")&&this.wrapEventCB(t)},_emitDblClickEventCB:function(t){e.is(this.dblClickEventCB,"function")&&this.dblClickEventCB(t)},_emitVisibilityEventCB:function(t){e.is(this.visibleEventCB,"function")&&this.visibleEventCB(t)},_emitPinEventCB:function(t,i){e.is(this.pinEventCB,"function")&&this.pinEventCB(t,i)},_applySortModel:function(t){if(!1===f&&!0===this.enable3dSearchSortMulti&&!1!==t){if(!e.is(this.sortModel)||this.sortModel.length<1)return;var n=this,s=a.getOption("NLSMapping_3DSearch_Sorting_TACTICALOnly"),o=e.is(s)&&s.hasOwnProperty(n.sortModel[0].dataIndex)?s[n.sortModel[0].dataIndex]:n.sortModel[0].dataIndex;setTimeout((function(){i.publish({channel:n.collection.getSNSkeleton().getOption("messagingChannel"),topic:"setOrderInGridView",data:{order_by:n.sortModel[0].sort,order_field:o,bForceNotReload:!1}});var t=n.collection.getSNSkeleton();e.is(t)&&e.is(t.getPreviewPanel())&&!0===t.getPreviewPanel().getvisibleFlag()&&t.getPreviewPanel().setActiveObject(null)}),500)}!this.enable3dSearchSort&&this._parent(t)},sizeColumnToFit:function(t,i){var n=this.layout;i=e.extend({isUserInteraction:!1,computeAllRows:!1},i);var s,o=n.getColumnIndex(t);s=i.computeAllRows?{minRowID:0,maxRowID:this.model.length-1}:n.getMinMaxVisibleRowIDs();for(var a=n.getColumnMinWidth(o),r=n.getColumnAutoSizePadding(t),l=!1,c=s.minRowID;c<=s.maxRowID;c++){var d=this.layout.getCellIDFromCoordinates({rowID:c,columnID:o}),u=!1,h=this._getRenderedCellAt(d);if(h||(h=this._renderCell(d,{updateCellContent:!1,updateCellLayout:"ignore",updateCellAttributes:!1}),u=!0),h&&h.component){l=!0;var g=h.component.computeContentSize()+2+r;g>a&&(a=0===t?g+40:g),u&&this._freeUpCell(d,1)}}return void 0!==a&&l&&n.setColumnWidth(t,a,{isUserInteraction:i.isUserInteraction}),a},sizeColumnsToFit:function(e,t){this._isPrivateRendering(!0);var i={},n={};e.forEach((e=>n[e.dataIndex]=e.width));for(var s=this._getMaxContentSizeInfo(e,t),o=Object.keys(s),a=0;a<o.length;a++){var r=o[a];void 0!==s[r].maxContentSize&&s[r].isWidthComputed&&(i[r]=0===a?s[r].maxContentSize+40:s[r].maxContentSize)}return this._isPrivateRendering(!1),this.layout.setColumnsWidth(i,{isUserInteraction:!(!t||!t.isUserInteraction)}),i},afterRender:function(t){var i=this;this.onInfiniteScroll((function(e){t.onInfiniteScrollAsync(e,(function(){i.infiniteScrollProcessDone()}))})),this.onEndResizeOrOnReadyModelRequest&&this.onEndResizeOrOnReadyModelRequest((function(n){!e.is(n.ColumnsMaxNumber)&&(n.ColumnsMaxNumber=13),!e.is(n.RowMaxNumber)&&(n.RowMaxNumber=24),t.onResizeOrFirstLoaded(n,(function(){i.EndResizeOrOnReadyModelRequestDone()}))})),this.layout.setColumnWidth=function(n,s,o){if(isNaN(s)&&"auto"!==s)g.log("The width given for column "+n+" is not a Number");else{var a=this.getColumnIndex(n),r=this.getLeafColumns(),l=this.getColumnMinWidth(a);if(l&&"number"==typeof s&&(s=Math.max(s,l)),r[a].width!==s){r[a].width=s,"number"==typeof s?this._setColumnComputedWidth(a,s):this._computeColumnsWidth();var c=this.getColumnPinned(a);"left"!==c&&"right"!==c||this.collectionView._updateViewportDimensions(),o&&!o.isUserInteraction&&this.getColumnAutoRowHeightFlag(a)?this.resetRowHeights():this.invalidate({updateCellContent:!1,updateCellLayout:!0,updateCellAttributes:!1})}o&&o.isUserInteraction&&(this._saveColumnWidthInPreferences(a),t.toUpdateColWidth=!0,i.pointerUPCB&&i.pointerUPCB()),e.is(i.onColumnWidthUpdate,"function")&&i.onColumnWidthUpdate(n,s)}},n.addEventOnElement(this,this,c.POINTERHIT,(function(e,t){1===e.multipleHitCount&&i.collection.state.totalRecords>a.getOption("max_results_to_enable_sort")&&t&&-1===t.rowID&&-1!==t.columnID&&t.cellView.collectionView._preselectedCellStableID&&!r.isColumnSortableFor1000(t.cellView.collectionView._preselectedCellStableID.columnDataIndex)&&l._displayAlert({message:s.get("sortLimitByLessThen1000Results"),className:"warning"}),2===e.multipleHitCount&&t&&i._emitDblClickEventCB(t)})),n.addEventOnElement(this,this,c.POINTERUP,(function(e,t){i.pointerUPCB&&i.pointerUPCB()}))},reselectXSOElements:function(){this.storedXSOInitialized.length>0&&this.getTreeDocument()&&this.getTreeDocument().getXSO()&&this.getTreeDocument().getXSO().add(this.storedXSOInitialized),this.storedXSOInitialized=[],f=!1},_shouldAcceptDrag:function(){return!1},selectAllVisibleNodes:function(){f||(this.getTreeDocument().getXSO().isEmpty()?this.onSelectAllCB():this.unselectAll())},unselectAll:function(e){f||(!0===e?this._parent():this.onUnselectAllCB&&this.onUnselectAllCB())},getCellAttributesAt:function(t){var i=this._parent(t);return-1===t.rowID&&e.is(t.cellView.collectionView.columns[t.columnID])&&-1!==_.indexOf(t.cellView.collectionView.columns[t.columnID].dataIndex)&&(i["type-representation"]="date"),i},build3DSearchHeaderColumnContextualMenu:function(e,t){var i=[];(i=i.concat(this._build3DSearchHeaderColumnContextualMenuPin(e))).push({type:"SeparatorItem",title:""}),(i=i.concat(this._contextualMenuBuilder._createSizeColumnToFitContextualMenu(e))).push({type:"SeparatorItem",title:""}),(i=i.concat(this._build3DSearchHeaderColumnContextualMenuVisibilityWrap(e))).push({type:"SeparatorItem",title:""});let n=h.isBETAEnabled();return this.bDisableMenuCustoView||n||(i=i.concat(this._build3DSearchHeaderColumnContextualMenuLinkManage(e,t))),i},_build3DSearchHeaderColumnContextualMenuLinkManage:function(e,t){var i=[],o=e.cellInfos&&-1===e.cellInfos.rowID;return!o&&e.infos&&e.infos.target&&(o=n.firstParentWithClass(e.infos.target,"wux-layouts-header")),o&&i.push({type:"PushItem",fonticon:{family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-cog"},title:s.get("custo_chooser_manage_custos"),action:{callback:function(){t._openColumnsCustoPanel()}}}),i},_getCurrentColumn:function(t,i){for(let n=0;n<i.length;++n)if(e.equals(i[n].dataIndex,t.collectionView._activeCellStableID.columnDataIndex))return i[n]},_isAtLeastOneColumnInvisible:function(e){for(let t of e._leafColumns)if(!1===e.getColumnVisibleFlag(t.dataIndex))return!0;return!1},_build3DSearchHeaderColumnContextualMenuVisibilityWrap:function(e){var t=[],i=e.cellInfos&&-1===e.cellInfos.rowID;if(!i&&e.infos&&e.infos.target&&(i=n.firstParentWithClass(e.infos.target,"wux-layouts-header")),i){var o,a=this,r=this.layout,l=r.getLeafColumns();if(!1!==(o=this._getCurrentColumn(r,l)).canBeInvisible){let e={type:"PushItem",title:s.get("SearchDataGridPreferences_modal_visible_column"),fonticon:r.getColumnVisibleFlag(o.dataIndex)?{family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-eye"}:{family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-eye-off"},action:{callback:function(e){if(e&&e.context&&e.context.id){var t=r.getColumnVisibleFlag(e.context.id);r.setColumnVisibleFlag(e.context.id,!t,{isUserInteraction:!0}),a._emitVisibilityEventCB(e.context.id)}},context:{id:o.dataIndex}}};t.push(e)}if(!this.bDisableMenuWrap){let e={type:"PushItem",title:s.get("SearchDataGridPreferences_modal_wrap_column"),fonticon:!0===o.wrap?{family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-text-formatted"}:{family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-text-formatted-off"},action:{callback:function(e){e&&e.context&&e.context.id&&a._emitWrapEventCB(e.context.id)},context:{id:o.dataIndex}}};t.push(e)}if(this._isAtLeastOneColumnInvisible(r)){let e={type:"PushItem",title:s.get("SearchDataGridPreferences_modal_reset_visibility"),fonticon:{family:"DSFontIcon",content:"wux-ui-3ds-reset"},action:{callback:function(){for(let t of r._leafColumns)if(!1===r.getColumnVisibleFlag(t.dataIndex)){var e=r.getColumnVisibleFlag(t.dataIndex);r.setColumnVisibleFlag(t.dataIndex,!e,{isUserInteraction:!0}),a._emitVisibilityEventCB(t.dataIndex)}}}};t.push(e)}}return t},_build3DSearchHeaderColumnContextualMenuPin:function(e){var t=this,i=[];if(e.cellInfos&&e.cellInfos.rowID<=-1){var n,s;-1===e.cellInfos.rowID?n=this.layout.getColumnPinned(e.cellInfos.columnID):(s=this.layout.getColumnOrGroupFromCoordinates({rowID:e.cellInfos.rowID,columnID:e.cellInfos.columnID}),n=this._collectionView.layout.getColumnOrGroupPinned(s));var o=[];o.push({type:"RadioItem",title:d.ContextualMenuBuilder.PinLeft,state:"left"===n?"selected":"unselected",action:{callback:function(){s?t.layout.setColumnOrGroupPinned(s,"left",{isUserInteraction:!0}):(t.layout.setColumnPinned(e.cellInfos.columnID,"left",{isUserInteraction:!0}),t._emitPinEventCB(e.cellInfos.columnID,"left"))}}}),o.push({type:"RadioItem",title:d.ContextualMenuBuilder.PinRight,state:"right"===n?"selected":"unselected",action:{callback:function(){s?t.layout.setColumnOrGroupPinned(s,"right",{isUserInteraction:!0}):(t.layout.setColumnPinned(e.cellInfos.columnID,"right",{isUserInteraction:!0}),t._emitPinEventCB(e.cellInfos.columnID,"right"))}}}),o.push({type:"RadioItem",title:d.ContextualMenuBuilder.NoPin,state:"left"!==n&&"right"!==n?"selected":"unselected",action:{callback:function(){s?t.layout.setColumnOrGroupPinned(s,"unpinned",{isUserInteraction:!0}):(t.layout.setColumnPinned(e.cellInfos.columnID,"unpinned",{isUserInteraction:!0}),t._emitPinEventCB(e.cellInfos.columnID))}}}),i.push({type:"PushItem",title:d.ContextualMenuBuilder.PinMenu,fonticon:{family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-pin"},submenu:o})}return i},initComponentState:function(e){this.sortModel=[{dataIndex:e.dataIndex,sort:e.sort}],this._updateRenderedCellAttributes(this.layout.getCellIDFromCoordinates({rowID:-1,columnID:this.layout.getColumnIndex(e.dataIndex)}))},addEventListener:function(e,t,i){var s=this,o=function(e){if(!s._isRequestingCell){e.dsModel=s;var i=n.firstParentWithClass(e.target,"wux-layouts-collectionview-cell");if(e.target.className.includes("search_item_hyperlink")||e.target.parentElement.className.includes("search_item_hyperlink"))return;if(i){var o=parseInt(i.getAttribute("cell-id"),10);if(!isNaN(o)){var a=s.getCellInfosAt(o);a.cellView=s._getViewAt(o),t(e,a)}}else t(e)}};return s.getContent().addEventListener(e,o,i),o}})})),define("DS/SNResultUX/views/utils/EmptyView",["DS/W3DXComponents/Views/Temp/TempItemView","UWA/Core","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","css!DS/SNResultUX/SNResultUX.css","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchDebug","DS/WebappsUtils/WebappsUtils"],(function(e,t,i,n,s,o,a){"use strict";return e.extend(o,{uwaClassName:"DS/SNResultUX/views/EmptyView",name:"empty-view",tagName:"div",defaultOptions:{icon:void 0,title:"",request_criteria:null},setup:function(){this.container.addClassName(this.getClassNames())},template:function(){var e='<div class="'+this.getClassNames("-infos")+' search-empty-view">',n=this.options.icon,o=i.get("loading"),r=this.options.request_criteria_without_precond?this.options.request_criteria_without_precond.call():null,l=null;t.is(this.options.getCollection,"function")&&(l=this.options.getCollection());var c=!1;if(t.is(l,"object")&&t.is(l.getFailureView,"function")&&!0===l.getFailureView()&&(c=!0),!0===c&&(e='<div style="padding-bottom: 15%" class="'+this.getClassNames("-infos")+' search-empty-view">'),t.is(l,"object")&&t.is(l.getSNSkeleton,"function")&&t.is(l.getSNSkeleton()._searchActions,"object")&&t.is(l.getSNSkeleton()._searchActions.getEmptyViewMessage,"function")&&(o=l.getSNSkeleton()._searchActions.getEmptyViewMessage()),n&&(e+='<span class="'+this.getClassNames("-icon")+" center-block fonticon fonticon-5x fonticon-"+n+'" ></span>'),!0===c){e+="<img src="+(n=[a.getWebappsAssetUrl("SNResultUX","images/Search_Error_Icon.png")])+"></img>",o=i.get("error.msg.display"),e+='<span class="'+this.getClassNames("-title")+' center-block">'+o+"</span>";var d=i.get("error.msg.display.cmd");t.is(l,"object")&&t.is(l._parse_alert,"array")&&1===l._parse_alert.length&&t.is(l._parse_alert[0])&&t.is(l._parse_alert[0].messageObj,"object")&&t.is(l._parse_alert[0].messageObj.message,"string")&&(d=l._parse_alert[0].messageObj.message),e+='<span style="color: #77797c;font-weight: unset" class="'+this.getClassNames("-subtitle")+' center-block">'+d+"</span>"}else{var u="";if(r&&r.service_params&&(u=r.service_params.query),u&&u.length&&u!==s.SearchTypeEnum.ADVANCED_SEARCH||u===s.SearchTypeEnum.MY_RECENT_CONTENT){o&&o!==i.get("loading")&&(e+='<span class="'+this.getClassNames("-title")+' center-block">'+o+"</span>"),r.without_precond&&(u=r.without_precond);var h="";"*"===o&&(h=i.get("warning_star")),""!==h&&(e+='<span class="'+this.getClassNames("-subtitle")+' center-block">'+i.replace(i.get("qryStr_warning"),{warning:h})+"</span>")}else{var g;if(o=i.get("no_criteria"),t.is(s.identifyClientInfo())&&"3DDashboard"===s.identifyClientInfo().identifier)t.is(l)&&t.is(l._snSkeleton)&&t.is(l._snSkeleton.options)&&t.is(l._snSkeleton.options.widgetId)&&(g=s.getSearchWidget(l._snSkeleton.options.widgetId)),t.is(g)&&t.is(g.getView)&&t.is(g.getView().type)&&"maximized"!==g.getView().type&&t.is(g.data)&&t.is(g.data.launch_mode)&&"from_compass_pinned"===g.data.launch_mode&&(o=i.get("maximize_search"));o&&(e+='<span class="'+this.getClassNames("-title")+' center-block">'+o+"</span>")}}return e+="</div>"}})})),define("DS/SNResultUX/utils/FederatedSearch_parse",["UWA/Core","UWA/Class","UWA/Class/Debug","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchLogin","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchUtils","DS/PubSub/PubSub","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],(function(e,t,i,n,s,o,a,r,l,c){"use strict";var d={};return t.extend(i,{name:"DS_SNResultUX_utils_FederatedSearch_parse",response_infos:{},results:[],summaryData:[],tagsData:{},ids:[],isReady:!1,_isRecentSearch:!1,_sourceErrorCodeToFilter:["FS_SOURCE_UNREACHABLE__DNS_UNKNOWN_HOST","FS_SOURCE_UNREACHABLE__TIMEOUT","FS_SOURCE_UNREACHABLE__HTTP_NOT_FOUND","FS_AUTHENTICATION_ERROR__FORBIDDEN","FS_AUTHENTICATION_ERROR__LOGOUT"],init:function(t){n.groupCollapsed("FederatedSearch_parse.init"),n.log("options:",t),this.setDebugMode(o.getDebugMode()),this._tenant=t.tenant,this._sourceErrorCodeToFilter.push("FS_AUTHENTICATION_ERROR"),this._isRecentSearch=t.isRecentSearch,this.results=[],this.response_infos=t.federated_response.infos,this.optionMode=t.optionMode,this.summaryData=t.federated_response.facets,e.is(t.federated_response.results)&&this._parse(t.federated_response.results),this.isReady=!0,n.groupEnd()},getUserLevelAlerts:function(t){n.groupCollapsed("FederatedSearch_parse.getUserLevelAlerts"),n.log("options:",t),e.is(t)&&(t._collabSpaceError=!1);var i=[],s={};if(e.is(this.response_infos)&&e.is(this.response_infos.sources)){for(var a=[],r="",d=0;d<this.response_infos.sources.length;d++){var u=this.response_infos.sources[d],h=c.get(u.name+".displayName");(!e.is(h)||0>=h.length)&&(h=u.name);var g={};if(r="",e.is(u.error)&&(a.push(u),e.is(u.error.errorCode)&&(!0===this.debugMode||"3dspace"===u.name||"drive"===u.name||"scientificreferential"===u.name||"dashboard"===u.name)))if("FS_AUTHENTICATION_ERROR"===u.error.errorCode&&u.error.errorMessage.indexOf("User has no preferred Security Context")>-1)g.message=c.get("FS_AUTHENTICATION_ERROR_UserHasNoPreferredSecurityContext"),r+=c.get("FS_AUTHENTICATION_ERROR_UserHasNoPreferredSecurityContext");else{g.errorCode=u.error.errorCode,g.nlsErrorCode=c.get(u.error.errorCode+".code"),g.message=c.get(u.error.errorCode+".message");var p=c.get(u.error.errorCode+".code"),_=c.get(u.error.errorCode+".message");p!==u.error.errorCode+".code"?(r+=c.replace(c.get("error_code"),{errorCode:p}),g.nlsErrorCode=c.replace(c.get("error_code"),{errorCode:p})):(r+=c.replace(c.get("error_code"),{errorCode:u.error.errorCode}),g.nlsErrorCode=c.replace(c.get("error_code"),{errorCode:u.error.errorCode})),_!==u.error.errorCode+".message"?(r+="<br>"+c.replace(c.get("error_msg"),{errorMessage:_}),g.message=c.replace(c.get("error_msg"),{errorMessage:_})):e.is(u.error.errorMessage)&&(r+="<br>"+c.replace(c.get("error_msg"),{errorMessage:u.error.errorMessage}),g.message=c.replace(c.get("error_msg"),{errorMessage:u.error.errorMessage}))}!1===u.status?e.is(u.error)&&(e.is(t)&&e.is(t._securityContext3DSpace)&&t._securityContext3DSpace.length>0&&"FS_AUTHENTICATION_ERROR"===u.error.errorCode&&(t._collabSpaceError=!0),e.is(u.error.errorCode)&&-1!==this._sourceErrorCodeToFilter.indexOf(u.error.errorCode)||(e.is(s[u.error.errorCode])||(s[u.error.errorCode]={},!0===this.debugMode?s[u.error.errorCode].message=r:s[u.error.errorCode].message=g.message,s[u.error.errorCode].messageObj=g),e.is(s[u.error.errorCode].listDataSourcesHavingThisError,"array")||(s[u.error.errorCode].listDataSourcesHavingThisError=[]),s[u.error.errorCode].listDataSourcesHavingThisError.push(h))):!0===o.getOption("alert_on_sucess")&&(r=c.replace(c.get("fetch_succeed"),{displayName:h,message:r}),i.push({className:"info",message:r}))}if(e.is(a)&&this.response_infos.sources.length>a.length&&l.dispatch("errorManager:tooltip",[a]),e.is(s)){var f=Object.getOwnPropertyNames(s);if(e.is(f,"array")&&f.length>0)for(var m=0,S=f.length;m<S;m++){var v=s[f[m]];if(e.is(v,"object")&&e.is(v.listDataSourcesHavingThisError,"array")&&e.is(v.message,"string")){var w=v.listDataSourcesHavingThisError.join(",");r=c.replace(c.get("fetchFailure_partial_answer"),{displayName:w,message:v.message}),i.push({className:"warning",message:r,messageObj:v.messageObj,dataSources:w})}}}}else{var b={message:c.get("No_Source_Found"),className:"error"};i.push(b)}return n.log("Alerts:",i),n.groupEnd(),i},getMatches:function(){return e.is(this.response_infos)&&e.is(this.response_infos.nmatches)?e.is(this.response_infos.estimated)&&!0===this.response_infos.estimated&&e.is(this.response_infos.nhits)?parseInt(this.response_infos.nhits):parseInt(this.response_infos.nmatches):e.is(this.response_infos)&&e.is(this.response_infos.nhits)?parseInt(this.response_infos.nhits):0},getHits:function(){return e.is(this.response_infos)&&e.is(this.response_infos.nhits)?parseInt(this.response_infos.nhits):0},getTags:function(){return{tagsData:this.tagsData,summaryData:this.summaryData}},getResults:function(){return this.results},getAttributesDefinition:function(){return d},getIds:function(){return this.ids},_parse:function(t){var i,s;n.groupCollapsed("FederatedSearch_parse._parse"),n.log("results:"),n.log(t),e.is(o)&&e.is(o._tenantSettings)&&e.is(o._tenantSettings[this._tenant])&&e.is(o._tenantSettings[this._tenant].search_settings)&&(i=o._tenantSettings[this._tenant].search_settings),s=e.is(i,"object")&&e.is(i.defaultDateMode,"object")&&e.is(i.defaultDateMode.id,"string")?i.defaultDateMode:{id:"basedOnLanguagePreference"};var a=[],l=[],c={},u=this,h=r.getRegion(),g=e.is(this.optionMode,"object")&&e.is(this.optionMode.dateDisplayMode,"object")&&e.is(this.optionMode.dateDisplayMode.id,"string")?this.optionMode.dateDisplayMode:s,p=r.getLanguage(),_=o.getOption("dateFormatOption");"basedOnAdminPreference"!==g.id&&"basedOnLanguagePreference"!==g.id?(p=g.value,_=g.options):"basedOnAdminPreference"===g.id&&e.is(s,"object")&&e.is(s.id)&&"basedOnLanguagePreference"!==s.id&&(p=s.value,_=s.options),e.is(h)&&h.length>0&&(h.indexOf("-")>-1?p=h:p+="-"+h);var f=0;o.getOption("timeZoneOffset")&&(f=parseInt(o.getOption("timeZoneOffset")),Number.isInteger(f)?f*=6e4:f=0),t.forEach((function(t){var i={isRecentSearchResult:u._isRecentSearch},s=[],o="",h="",g="",m="",S="",v="";if(u._updateSnippetWithMarker(t),t.attributes.forEach((function(t){if("Warning:Flattening"!==t.value&&"Warning:JPO"!==t.value){var a=t.value,l=e.is(t.dispValue)?t.dispValue:t.value;e.is(t.format)&&"snippet"===t.format&&e.is(t.type)&&"text"===t.type&&e.is(t.text)&&e.is(t.text,"array")&&(a=JSON.stringify(t));var c=e.is(t.type,"string")?t.type.toLowerCase():"unknown_type";if(e.is(t.format)&&"internal"===t.format&&"string"!==t.type||!e.is(t.value,"string")||(l="ds6w:description"===t.name&&l.indexOf("<br />")>-1?r.stripHtml(l):r.escapeHtml(l)),"date"===c||"ds6w:created"===t.name||"ds6w:modified"===t.name){var u=Date.parse(a);if(isNaN(u))l=a;else{var w=new Date(u+f);try{l=r.dateToDisplay(w,p,_)}catch(e){n.warn("Error parsing date !",u,p,_);try{l=w.toLocaleString(r.getLanguage())}catch(e){n.warn("Error parsing date with current language!",u,r.getLanguage()),l=w.toLocaleString()}}l=l.replace(",","")}}"resourceid"===t.name?i.id=a:"ds6w:when/ds6w:modified"===t.name?o=a:"ds6w:modified"===t.name?h=a:"ds6w:when/ds6w:created"===t.name?g=a:"ds6w:created"===t.name?m=a:"ds6w:type"===t.name?S=a:"ds6w:what/ds6w:type"===t.name?v=a:"ds6w:where/ds6w:source/ds6w:dataSource"===t.name&&(t.type="string");var b=t.name.match(/\/([^/]*)$/);if(b=e.is(b,"array")&&b.length>1?b[1]:t.name,d[b]={type:e.is(t.type,"string")?t.type.toLowerCase():null,URI:t.name,format:t.format},"ds6w_facet"===t.format){var C={object:e.clone(a),sixw:t.name,field:t.field,type:t.type};C.dispValue=void 0===l||""===l?e.clone(a):e.clone(l),s.push(C)}if(void 0!==i[t.name]){if(!(i[t.name]instanceof Array)){var y=i[t.name];i[t.name]=[],i[t.name].push(y);var D=i[t.name+"_value"];i[t.name+"_value"]=[],i[t.name+"_value"].push(D)}void 0===l||""===l?i[t.name].push(a):i[t.name].push(l),i[t.name+"_value"].push(a)}else e.is(l,"array")?(i[t.name]=[e.clone(a)],i[t.name+"_value"]=[e.clone(a)]):(i[t.name]=void 0===l||""===l?e.clone(a):e.clone(l),i[t.name+"_value"]=e.clone(a));var I=null;if("ds6w"===t.format?I=t.name.replace("ds6w:",""):"ds6w_facet"===t.format&&void 0!==t.field&&(I=t.field.toLowerCase()),t.name.lastIndexOf("/")>=0&&(b=t.name.slice(t.name.lastIndexOf("/")+1,t.name.length),e.is(b)&&b.length&&(i[b]=i[t.name],i[b+"_value"]=i[t.name+"_value"])),null!==I)if(void 0!==i[I]){if(!(i[I]instanceof Array)){var T=i[I];i[I]=[],i[I].push(T);var A=i[I+"_value"];i[I+"_value"]=[],i[I+"_value"].push(A)}void 0===l||""===l?i[I].push(a):i[I].push(l),i[I+"_value"].push(a)}else i[I]=void 0===l||""===l?a:l,i[I+"_value"]=a}})),o.length>0&&0===h.length&&(i["ds6w:modified"]=i["ds6w:when/ds6w:modified"],i["ds6w:modified_value"]=i["ds6w:when/ds6w:modified_value"]),g.length>0&&0===m.length&&(i["ds6w:created"]=i["ds6w:when/ds6w:created"],i["ds6w:created_value"]=i["ds6w:when/ds6w:created_value"]),S.length>0&&0===v.length&&(i["ds6w:what/ds6w:type"]=i["ds6w:type"],i["ds6w:what/ds6w:type_value"]=i["ds6w:type_value"]),e.is(i.id,"string")&&i.id.length>0){var w=i.sourceid_value;w||(w="3dspace"),c[w]||(c[w]={}),c[w][i.id]=s,a.push(i),l.push(i.id)}else n.log("Invalid result object "+JSON.stringify(t))})),this.tagsData=c,this.results=a,this.ids=l,n.groupEnd()},_encryptSnippetForUX:function(t){var i="";return t.forEach((function(t){e.is(t.highlighted)&&"true"===t.highlighted&&(i+=""),e.is(t.content)&&(i+=t.content),e.is(t.highlighted)&&"true"===t.highlighted&&(i+=""),i+=" "})),i},_updateSnippetWithMarker:function(t){var i,n=this,s=t.attributes;if(s.forEach((function(t){e.is(t.format)&&"snippet"===t.format&&e.is(t.name)&&"snippet"===t.name&&e.is(t.text,"array")&&(i=n._encryptSnippetForUX(t.text))})),e.is(i,"string")&&i.length>0){i=i.split("*").join("");var o=!1;s.forEach((function(t){!1===o&&(e.is(t.name)&&"snippet"===t.name||"snippet_value"===t.name)&&(t.value=i,o=!0)})),o||(t.attributes=t.attributes.concat({format:"attribute",name:"snippet",type:"string",value:i},{format:"attribute",name:"snippet_value",type:"string",value:i}))}return t}})})),define("DS/SNResultUX/views/utils/InformationsView",["UWA/Class/Debug","UWA/Core","UWA/Controls/Abstract","UWA/Element","DS/MessageBus/MessageBus","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchVersioning","DS/SNInfraUX/ServiceDelegationLoader","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],(function(e,t,i,n,s,o,a,r,l,c,d,u){"use strict";const h=.75;return i.extend(e,{_informationPanel:null,_rightDockingElement:null,_rootView:null,_lastSelectedItem:null,_width:420,_widgetId:null,_InformationContainer:null,_infoHeaderContainer:null,_skeleton:null,_lastwidth:420,_max:!1,_informationViewdiv:null,_bIsOnIphone:!1,_infoContainer:null,_expandcollapseElement:null,_previouselement:null,_nextelement:null,_screenType:"desktop",_oneSearchPreviewAction:null,_informationNoSelection:null,_informationPreviewContainer:null,resizeId:null,init:function(e){this._parent(e);if(this._infoContainer=null,this._informationNoSelection=null,this._informationPreviewContainer=null,this._rootView=e.parentContainer,this._lastSelectedItem=e.lastSelectedItem,this._skeleton=e.parent,this.resizeId=null,this.securityContext=e.securityContext,this._updateSelectionSubscription=s.subscribe({channel:this._skeleton.getMessagingChannel(),topic:"onItemSelection",callback:this.updateSelection.bind(this)}),t.is(e.width)){var i=screen.availWidth;this._width=340;var n=a.getDeviceCategory();"iphone"===n||"android"===n||!0===o.getOption("search_compact_mode")&&0===n.length&&i<1279?(this._screenType="mobile",this._width=e.width,this._bIsOnIphone=!0,this._oneSearchPreviewAction=e.oneSearchPreviewAction):e.width<639&&(this._width=e.width,this._bIsOnIphone=!0),"ipad"!==n&&"android"!==n||t.is(i)&&(i>1023?this._screenType="desktop":(this._screenType="mobile",this._width=e.width,this._bIsOnIphone=!0,this._oneSearchPreviewAction=e.oneSearchPreviewAction))}t.is(e.widgetId)&&(this._widgetId=e.widgetId)},_isInPinnedWidget:function(){let e=this._skeleton.getSearchWidget();return"3DDashboard"===a.identifyClientInfo().identifier&&null!=e&&!/^preview/.test(e.id)},_calculateDockingMeasures:function(){let e,i,n=this._width,s=this._managePreferences(),o=this.options.parentContainer.container.clientWidth,a=0;t.is(this._skeleton,"object")&&t.is(this._skeleton._skeleton,"object")&&t.is(this._skeleton._skeleton.container,"element")&&t.is(this._skeleton._skeleton.container.getSize,"function")&&t.is(this._skeleton._skeleton.container.getSize())&&t.is(this._skeleton._skeleton.container.getSize().width)&&(a=this._skeleton._skeleton.container.getSize().width),e=o<a?o*h:a*h;let r=this._isInPinnedWidget()?200:380;return i=o<a?o*h<r?o*h:r:a*h<r?a*h:r,e<i&&(e=i),n=t.is(s)?s.zoneSize:"where"===this._rootView.currentViewId&&o<1e3?o:i,n>e&&"where"!==this._rootView.currentViewId&&(n=e),{minSize:i||380,maxSize:e||380,zoneSize:n||380}},_resizeCallback:function(e,i){var n=this,s=this._skeleton.getSearchWidget();s&&i&&s.id!==i||(t.is(e)&&t.is(e.type)&&"dockResize"===e.type&&n._savePreferences(),t.is(e)&&t.is(e.type)&&("resize"===e.type||"onWidgetResize"===e.type)&&this._rightDockingElement&&(clearTimeout(this.resizeId),this.resizeId=setTimeout((()=>{let e=n._calculateDockingMeasures();console.log(e),n._rightDockingElement.minSize=e.minSize,n._rightDockingElement.maxSize=e.maxSize,n._rightDockingElement.dockingZoneSize=e.zoneSize,n._rightDockingElement._updateDockingZoneSize()}),1e3)))},initInformationsPanel:function(){if(null!==this._rootView&&(null===this._rightDockingElement||null===this._informationPanel)&&null===this._informationPanel){var e=this;require(["DS/Windows/DockingElement"],(function(i){let n="mobile"!==e._screenType,s=e._calculateDockingMeasures();var a=null,r=e._rootView.container,c=e._rootView.getElement(".search-content-set-contents");if(a=e._rootView.container.getParent(),t.is(o.getOption("search_compact_mode"))&&t.is(e._skeleton)&&(a=c,r=e._skeleton.getCurrentView().container),t.is(c)||(c.setStyle("width","calc(100% - 8px)"),c.addClassName("informationPanel_opened")),e._rightDockingElement=new i({side:WUXDockAreaEnum.RightDockArea,dockingZoneSize:s.zoneSize,minSize:s.minSize,maxSize:s.maxSize,useBordersFlag:n,visibleCollapserFlag:!1,collapsibleFlag:!1,freeZoneContent:r,resizableFlag:e._isInPinnedWidget()}),e._rightDockingElement.inject(a),e._infoContainer=e.createContainers(),e._rightDockingElement.dockingZoneContent=e._infoContainer,e._isInPinnedWidget()){let t=e._skeleton.getSearchWidget();try{e._rightDockingElement.removeEventListener("dockResize",e._resizeCallback),window.removeEventListener("resize",e._resizeCallback),t&&t.removeEvent&&t.removeEvent("onResize",e._resizeCallback,e)}catch(e){l.log("Resize remove event",e)}window.addEventListener("resize",(i=>e._resizeCallback(i,t.id))),e._rightDockingElement.addEventListener("dockResize",(i=>e._resizeCallback(i,t.id))),t&&t.addEvent&&t.addEvent("onResize",(i=>{(!i||!i.type)&&(i={type:"onWidgetResize"}),e._resizeCallback(i,t.id)}))}e._updateInformationsPanel()}))}},_updateInformationsPanel:function(){l.groupCollapsed("InformationsView._updateInformationsPanel");var e=this;this._informationPanel&&(this._informationPanel.destroy(),e._informationPanel=null);var i,s=function(i,n){l.log("InformationsView defaultTreatment");require(["DS/EditPropWidget/EditPropWidget","DS/EditPropWidget/models/EditPropModel","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/models/EditPropAttributeModel","DS/EditPropWidget/constants/ConstantsMapping","DS/SNResultUX/views/utils/PropertiesServices"],(function(s,r,c,d,u,h){h.getOptions({model:e._lastSelectedItem,EditPropConstants:c,useDelegationProtocol:!0,informationContext:"3DSearchContext",securityContext:e.securityContext,onComplete:function(g){if(l.log("InformationsView.getOptions->onComplete",g),g.className="searchInformationProperties",t.is(n)||(g.typeOfDisplay=c.ALL,g.selectionType=c.RESTRICTED_SELECTION,g.warningOnUnsaved=!1,g.multiselection=c.MULTISEL_NO,g.collapseTabs=!1,t.is(g.facets)&&delete g.facets),t.is(g)&&t.is(g.facets,"array"))for(let e=0,i=g.facets.length;e<i;e++)t.is(g.facets[e],"object")&&(g.facets[e].alwaysVisible=!0);e._informationPanel=new s(g);let p=[c.FACET_VIEWS],_=a.identifyClientInfo(),f="";t.is(_)&&(f=_.identifier),t.is(o.getOption("showDerivedOutput"))&&!o.getOption("showDerivedOutput")&&(p.push(c.FACET_CHANGE),p.push(c.FACET_DERIVEDOUTPUT)),t.is(o.getOption("showChangeTab"))&&!o.getOption("showChangeTab")&&p.push(c.FACET_CHANGE),e._informationPanel.removeFacets(p);h.getPropModelFromSearchItem(e._lastSelectedItem,r,d,u,(function(n){e._informationPanel.initDatas(n),t.is(i)?(i.empty(),e._informationPanel.getContent().getContent().inject(i)):e._rightDockingElement.dockingZoneContent=e._informationPanel.getContent().getContent()}),n)},onAddFacets:function(i){l.log("InformationsView.getOptions->onAddFacets"),t.is(e._informationPanel)&&t.is(i);for(let e=0,t=i.length;e<t;e++)i[e].alwaysVisible=!0;e._informationPanel.addFacets(i)}})}))};if(t.is(e._informationViewdiv)&&(i=t.extendElement(e._informationViewdiv),t.is(i)&&(i.removeClassName("information-view-vertical"),i.removeClassName("information-view-vertical-nopreview"))),t.is(e._lastSelectedItem)){this._informationNoSelection.hide(),t.is(this._InformationContainer)&&t.is(this._InformationContainer.show,"function")&&this._InformationContainer.show();var r=e._lastSelectedItem.getServiceID();t.is(r)&&(l.log("Calling ServiceDelegationLoader"),l.log("->serviceID:",r),l.log("->platformID:",e._lastSelectedItem.getPlatformID()),d.load({serviceID:r,platformID:e._lastSelectedItem.getPlatformID()}).then((function(i){if(!t.is(i))throw l.error("ServiceDelegation.load returns an invalid serviceDelegation!"),new Error("ServiceDelegation.load returns an invalid serviceDelegation!");t.is(i.getRenderPreview,"function")?(l.log("Calling serviceDelegation.getRenderPreview"),l.log("->searchmodel:",e._lastSelectedItem),l.log("->widget_id:",e._skeleton.getOption("widgetId")),i.getRenderPreview({searchmodel:e._lastSelectedItem,widget_id:e._skeleton.getOption("widgetId"),onComplete:function(i){if(l.log("onComplete serviceDelegation.getRenderPreview"),!t.is(i))throw l.error("ServiceDelegation.getRenderPreview returns an invalid previewRenderer!"),new Error("ServiceDelegation.getRenderPreview returns an invalid previewRenderer!");t.is(i.getSecondaryContent,"function")&&t.is(e._InformationContainer)&&(e._InformationContainer.empty(),i.getSecondaryContent({searchmodel:e._lastSelectedItem,parentContainer:e._InformationContainer,widget_id:e._skeleton.getOption("widgetId"),onComplete:function(i){if(l.log("onComplete preview.getSecondaryContent"),t.is(i)){let s=n.extend(i);t.is(s,"element")&&t.is(s.inject,"function")?s.inject(e._InformationContainer):l.error("Invalid content returned by getSecondaryContent")}else null===i&&(l.log("No secondary area to display, using default to not leave empty space"),e._InformationContainer.empty(),e._InformationContainer.setStyle("display","inline-block"),s(e._InformationContainer))},onFailure:function(t){l.log("onFailure preview.getSecondaryContent"),l.log("listValues",t),s(e._InformationContainer,t)}}))}})):(l.log("ServiceDelegation no getRenderPreview found"),e._InformationContainer.empty(),e._InformationContainer.setStyle("display","inline-block"),s(e._InformationContainer))}),(function(){l.log("ServiceDelegation not found"),e._InformationContainer.empty(),e._InformationContainer.setStyle("display","inline-block"),s(e._InformationContainer)})))}else e._InformationContainer&&e._InformationContainer.empty(),t.is(this._informationNoSelection)&&t.is(this._informationNoSelection.show,"function")&&this._informationNoSelection.show();l.groupEnd()},setActiveObject:function(e){e!==this._lastSelectedItem&&(this._lastSelectedItem=e,this._updateInformationsPanel())},switchVisibleFlag:function(){if(null!==this._rightDockingElement){var e=null,i=null;if(!0===this._rightDockingElement.visibleDockingZoneFlag){(e=this._rootView.getElement(".search-content-set-contents")).setStyle("width","100%"),this._rightDockingElement.collapsibleFlag=!0,this._rightDockingElement.collapseDockingZoneFlag=!0,this._rightDockingElement.visibleDockingZoneFlag=!1,t.is(this._oneSearchPreviewAction)&&(this._oneSearchPreviewAction.setStyle("visibility","hidden"),this._oneSearchPreviewAction.back.setStyle("display","none"),i=this._oneSearchPreviewAction.count,t.is(i)&&t.extendElement(i).setStyle("cursor","unset"));var n=this._rightDockingElement.freeZoneContent.getElement(".search-content-set-detail");t.is(n)&&n.removeClassName("informationPanelSearchContent")}else this._rightDockingElement.collapseDockingZoneFlag=!1,this._rightDockingElement.visibleDockingZoneFlag=!0,this._rightDockingElement.collapsibleFlag=!1,(e=this._rootView.getElement(".search-content-set-contents")).addClassName("informationPanel_opened"),e.setStyle("width","calc(100% - 8px)"),this.setActiveObject(this._lastSelectedItem),t.is(this._oneSearchPreviewAction)&&(this._oneSearchPreviewAction.setStyle("visibility","visible"),this._oneSearchPreviewAction.back.setStyle("display","flex"),i=this._oneSearchPreviewAction.count,t.is(i)&&t.extendElement(i).setStyle("cursor","pointer"))}},switchViewMode:function(e){l.groupCollapsed("InformationView.switchViewMode"),l.log("option:",e),t.is(this._rootView)?(t.is(this._rightDockingElement)&&(this._rightDockingElement.freeZoneContent=null,r.getItem("integratedSearch")?t.is(o.getOption("search_compact_mode"))&&t.is(e)?this._rightDockingElement.freeZoneContent=e.container:this._rightDockingElement.freeZoneContent=this._rootView:t.is(o.getOption("search_compact_mode"))&&t.is(e)?this._rightDockingElement.freeZoneContent=e.container:this._rightDockingElement.freeZoneContent=this._rootView.container,this._rightDockingElement._applyFreeZoneContent()),l.groupEnd()):l.warn("InformationView.switchViewMode, no _rootView!")},getVisibleFlag:function(){var e=!1;return t.is(this._rightDockingElement)&&(e=this._rightDockingElement.visibleDockingZoneFlag),e},hideAndclean:function(){this.switchVisibleFlag(),this.setActiveObject(null)},createContainers:function(){var e=!1;t.is(this._oneSearchPreviewAction)&&(e=!0);var i,n=a.identifyClientInfo(),s=document.createElement("div");if(s.innerHTML=['<div class="information-zone">','<div class="information-noselection">','<span class="spannopreview">Select a result to preview</span>',"</div>",'<div class="information-container">',"</div>","</div>"].join(""),this._informationPreviewContainer=t.extendElement(s.querySelector(".information-zone")),i=t.extendElement(s.querySelector(".information-zone")),this._InformationContainer=t.extendElement(s.querySelector(".information-container")),this._infoHeaderContainer=s.querySelector(".information-header"),this._informationViewdiv=s.querySelector(".information-view"),this._informationNoSelection=t.extendElement(s.querySelector(".information-noselection")),!0===e&&"3DDashboard"===n.identifier){var o=t.extendElement(s.querySelector(".information-main"));t.is(o)&&o.addClassName("mobile3dd")}if(!0===e)this._oneSearchPreviewAction.setStyle("visibility","visible");else{var r=s.querySelector(".spannopreview");t.is(r)&&(r.innerText=u.get("InfoPanel.noSelection"))}return i},_exitPreview:function(){this.hideAndclean()},_expandcollapse:function(e){if(!t.is(this._rightDockingElement)||!t.is(this._skeleton)||!t.is(e))return;let i,n,s=!1,o=this._skeleton.getSearchWidget();if(this._isInPinnedWidget()&&t.is(o))n=o.body.getDimensions(),t.is(n)&&(i=n.width);else{let e=t.extendElement(document.body).getElement(".onesearch_results");t.is(e)&&(n=e.getDimensions(),t.is(n)&&(i=n.width,s=!0))}if(t.is(i)&&i>639&&"mobile"!==this._screenType)if(!0===this._max){e.removeClassName("informationPanel_expand"),e.addClassName("informationPanel_collapse");let t=i-320;this._rightDockingElement.maxSize=t,this._rightDockingElement.dockingZoneSize=this._lastwidth,this._max=!1,this._expandcollapseElement.setAttribute("title",u.get("InfoPanel.Expand"))}else{e.removeClassName("informationPanel_collapse"),e.addClassName("informationPanel_expand"),this._lastwidth=this._rightDockingElement.dockingZoneSize;let t=i-22;"mobile"===this._screenType&&(t=i),!0===s&&(t=i),this._rightDockingElement.maxSize=t,this._rightDockingElement.dockingZoneSize=t,this._max=!0,this._expandcollapseElement.setAttribute("title",u.get("InfoPanel.Collapsed"))}},activate_deactivateNoPreview:function(e){"mobile"===this._screenType&&t.is(e)&&!0===e&&this.hideAndclean(),t.is(e)&&null!==this._informationNoSelection&&null!==this._informationPreviewContainer&&(!0===e?(this._informationNoSelection.setStyle("display","inline-block"),this._InformationContainer.setStyle("display","none")):(this._informationNoSelection.setStyle("display","none"),this._InformationContainer.setStyle("display","flex")))},_savePreferences:function(){if(!t.is(this._rightDockingElement))return;var e=this._rightDockingElement.dockingZoneSize;let i=this._skeleton.getSearchWidget();this._isInPinnedWidget()&&t.is(i)?i.setValue("informationZoneSize",e):(r.setItem("informationZoneSize",e),r.commit())},_managePreferences:function(){let e,i=null,n=this._skeleton.getSearchWidget();return this._isInPinnedWidget()&&t.is(n)&&(e=n.getValue("informationZoneSize")),t.is(e)||(e=r.getItem("informationZoneSize")),t.is(e)&&(i={zoneSize:e}),i},updateSelection:function(e){l.log("InformationView->updateSelection!");let i=null;t.is(e)&&t.is(e.lastItemSelected)&&(i=e.lastItemSelected.id);let n=null,s=this._skeleton;if(t.is(s)){let e=s.getCollection();t.is(e)&&(n=this._skeleton.getCollection().get(i))}this.setActiveObject(n)},destroy:function(){this._savePreferences(),s.unsubscribe(this._updateSelectionSubscription),window.removeEventListener("resize",this._resizeCallback),this._rightDockingElement.removeEventListener("dockResize",this.resizeCallback);let e=this._skeleton.getSearchWidget();e&&e.removeEvent&&e.removeEvent("onResize",this._resizeCallback),t.is(this._informationPanel)&&t.is(this._informationPanel.destroy,"function")&&this._informationPanel.destroy(),t.is(this._rightDockingElement)&&t.is(this._rightDockingElement.destroy,"function")&&this._rightDockingElement.destroy(),this._rightDockingElement=null,this._informationPanel=null,this._skeleton=null,this._lastSelectedItem=null,this._rootView=null,this._infoContainer=null,this._informationPreviewContainer=null,this.resizeId=null,this._parent()}})})),define("DS/SNResultUX/views/utils/LightBoxView",["UWA/Class/Debug","UWA/Core","UWA/Controls/Abstract","UWA/Element","DS/UIKIT/Spinner","DS/Utilities/Utils","DS/Tree/LightBoxView","DS/Controls/TooltipModel","DS/SNResultUX/views/utils/Play3DServices","DS/SNResultUX/views/utils/PropertiesServices","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchUtils","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],(function(e,t,i,n,s,o,a,r,l,c,d,u,h,g){"use strict";return i.extend(e,{_player3D:null,_LightBoxPanel:null,_model:null,_parentContainer:null,_treeDocument:null,_informationPanel:null,_channelView:null,_treeListView:null,_collection:null,_mySpinner:null,_viewerElement:null,_firstInit:!0,_is3DPlay:!1,_debounced3DPlayerLoad:null,_bottomdocking:!0,_treemodel:null,_okNewModel:!0,_skeleton:null,_modelEventTokenForOnAdd:null,init:function(e){this._parent(e);let i=this;this._skeleton=e.skeleton,this._modelEventTokenForOnAdd=null,t.is(e.parentContainer)&&(this._parentContainer=e.parentContainer),t.is(e.model)&&(this._model=e.model),t.is(e.treeDocument)&&(this._treeDocument=e.treeDocument),t.is(e.treeListView)&&(this._treeListView=e.treeListView),t.is(e.collection)&&(this._collection=e.collection,null===this._treeDocument&&(this._treeDocument=this._collection.getTreeDocument())),t.is(e.bottomdocking)&&(this._bottomdocking=e.bottomdocking),t.is(e.widget_id)&&(this._widget_id=e.widget_id),this._debounced3DPlayerLoad=o.debounce((function(e){t.is(e)&&e._is3DPlay&&e.load3DPlayer(e._model,i._skeleton)}),300);let n=this._collection.indexOf(this._model);if(-1===n&&(n=0),n>=0){let e=null,s=this._treeDocument.getRoots();t.is(s,"array")&&n<s.length&&(e=s[n],t.is(e)&&(e.select(),l.is3DPlayAvailable(i._model,i._skeleton).then((function(){u.log("Selected object is 3DPlay available")}),(function(){u.warn("Selected object is NOT 3DPlay available")}))))}},onDestroy:function(){t.is(this._modelEventTokenForOnAdd)&&t.is(this._treeDocument)&&t.is(this._treeDocument.getXSO,"function")&&t.is(this._treeDocument.getXSO())&&t.is(this._treeDocument.getXSO().unsubscribe,"function")&&(this._treeDocument.getXSO().unsubscribe(this._modelEventTokenForOnAdd),delete this._modelEventTokenForOnAdd),t.is(this._informationPanel)&&t.is(this._informationPanel.destroy,"function")&&this._informationPanel.destroy(),t.is(this._player3D)&&t.is(this._player3D.dispose,"function")&&this._player3D.dispose(),this._player3D=null,this._LightBoxPanel=null,this._model=null,this._treemodel=null,this._informationPanel=null,this._parent()},destroy:function(){this.onDestroy()},_initPlayer:function(){let e=this;if(null!==this._player3D&&null!==this._LightBoxPanel)return;let i=[];i.push({type:"check",icon:{iconName:"info",fontIconFamily:WUXManagedFontIcons.font3DS,fontIconSize:"2x"},tooltipInfos:new r({shortHelp:g.get("actions.InfoPanel.toolTip"),mouseRelativePosition:!1}),callback:this.onInfoclick.bind(this)}),this._LightBoxPanel=new a({target:this._parentContainer,treeDocument:this._treeDocument,height:"auto",toolbar:i,bigPicturePath:this.CustoOnbigPicturePath.bind(this),onRightViewRequest:this.onCustoOnRightViewRequest.bind(this),onTitleRequest:this.onCustoTitleRequest.bind(this),onMainViewRequest:this.onCustoMainViewRequest.bind(this)});let n=this._LightBoxPanel.getRightDockingElement();if(t.is(n)&&(n.collapsibleFlag=!1,n.dockingZoneSize=420,n.minSize=250,n.visibleDockingZoneFlag=!1),!1===this._bottomdocking){let e=this._LightBoxPanel.elements.dockingZoneContentForBottom;t.is(e)&&e.setStyle("display","none"),e=this._LightBoxPanel.getBottomDockingElement(),t.is(e)&&(e.visibleDockingZoneFlag=!1)}t.is(this._modelEventTokenForOnAdd)&&t.is(this._treeDocument)&&t.is(this._treeDocument.getXSO,"function")&&t.is(this._treeDocument.getXSO())&&t.is(this._treeDocument.getXSO().unsubscribe,"function")&&(this._treeDocument.getXSO().unsubscribe(this._modelEventTokenForOnAdd),delete this._modelEventTokenForOnAdd),this._modelEventTokenForOnAdd=this._treeDocument.getXSO().onAdd((function(t){e.onSelected(t)})),this._LightBoxPanel.addEventListener("close",(function(){e.dispatchEvent("onLightBoxPanelClose")})),this._channelView=this._LightBoxPanel.getGridView(),null!==this._channelView&&(this._channelView.options.selection.canMultiSelect=!1,this._channelView.onCellRequest((function(e){let t=e.nodeModel;e.cellView.elements.container.setAttribute("draggable","false"),e.cellView.setTitle(t.options._attributes["ds6w:label"]),e.cellView.setSubtitle(t.options._attributes["ds6w:responsible"]),e.cellView.setPicture(t.options._attributes.preview_url),e.cellView.setIcon(t.options._attributes.type_icon_url),t.isSelected()&&e.cellView.highlight()})),this._channelView.onInfiniteScrollAsync((function(){null!==e._collection&&!1===e._collection._search_in_progress&&(e._collection.hasNextPage()?e._collection.getNextPage({remove:!1,onComplete:function(){e._channelView.infiniteScrollAsyncProcessDone(),e._collection.generateTreeModel(),e._toggleLoader()},onFailure:function(){e._channelView.infiniteScrollAsyncProcessDone()}}):e._channelView.infiniteScrollAsyncProcessDone())})));let s=this._LightBoxPanel.getBottomDockingElement();null!==s&&(s.addEventListener("collapse",(function(){t.is(e._informationPanel)&&e._informationPanel.onResize()})),s.addEventListener("expand",(function(){t.is(e._informationPanel)&&e._informationPanel.onResize()})))},onInfoclick:function(){if(null!==this._LightBoxPanel){let e=this._LightBoxPanel.getRightDockingElement();if(null!==e){null===this._informationPanel&&this.onCustoOnRightViewRequest();let i=e.visibleDockingZoneFlag;e.visibleDockingZoneFlag=!i,!0===e.visibleDockingZoneFlag&&t.is(this._informationPanel)&&this._informationPanel.onResize();let n=this._widget_id;t.is(n)&&t.is(UWA.Widgets)&&t.is(UWA.Widgets.instances)?UWA.Widgets.instances.forEach((function(e){e.id===n&&(!0==!i?e.setValue("previewPanelState_Info",!0):e.setValue("previewPanelState_Info",!1))})):!0==!i?widget.setValue("previewPanelState_Info",!0):widget.setValue("previewPanelState_Info",!1)}}},onCustoMainViewRequest:function(e){if(!1!==this._okNewModel){if(null!==e&&null!==e.nodeModel){let i=e.nodeModel;if(this._model=i.options,this._treemodel=i.options,null!==this._model){let e={id:this._model.id},i=this._model.collection.where(e);t.is(i)&&i.length>0&&(this._model=i[0])}}null===this._viewerElement&&(this._viewerElement=n.create("div").inject(e.nodeView),this._viewerElement.setStyle("display","none")),null!==this._LightBoxPanel&&!1===this._LightBoxPanel.visibleFlag||this.onMainViewDisplay(e)}},onMainViewDisplay:function(e){let i=this;l.is3DPlayAvailable(i._model,i._skeleton).then((function(){i._is3DPlay=!0,t.is(i._viewerElement)&&i._viewerElement.setStyle("display","inline"),t.is(i._player3D)?i._debounced3DPlayerLoad(i):l.get3DPlayOptions(i._model,(function(e){require(["DS/3DPlayHelper/3DPlayHelper"],(function(n){e.container=i._viewerElement,!t.is(e.options)&&(e.options={}),e.options.callbacks={experience:{ExperienceReady:function(e){u.log("ExperienceReady:",e)}},model:{LoadingError:function(e){u.error("LoadingError:",e)}},asset:{LoadingFinished:function(e){u.log("LoadingFinished:",e),!0===d.getOption("search_web_in_win")&&window.hasOwnProperty("sendNotificationWebInWin")&&t.is(sendNotificationWebInWin,"function")&&sendNotificationWebInWin("LoadingFinished3DPlay")}}},i._player3D=new n(e),!0===i._firstInit&&i.setChannelPosition(),i._firstInit=!1}))}),i._skeleton)}),(function(){i._is3DPlay=!1,null!==i._viewerElement&&i._viewerElement.setStyle("display","none");let t=e.view.bigPicturePath(e);e.nodeView.setStyles({backgroundImage:"url("+t+")",backgroundSize:"auto",backgroundRepeat:"no-repeat",backgroundPosition:"50% 50%"}),!0===i._firstInit&&i.setChannelPosition(),i._firstInit=!1}))},load3DPlayer:function(e,i){if(!t.is(e))return;let n=this;l.get3DPlayOptions(e,(function(e){n._player3D.load(e),!0===d.getOption("search_web_in_win")&&window.hasOwnProperty("sendNotificationWebInWin")&&t.is(sendNotificationWebInWin,"function")&&sendNotificationWebInWin("Load3DPlay")}),i)},onCustoTitleRequest:function(e){let t=e.nodeModel;e.nodeView.setContent(t.options._attributes["ds6w:label"])},onSelected:function(e){if(this._okNewModel=!0,this._model&&t.is(e)&&t.is(e.options)&&this._model.id===e.options.id)this._okNewModel=!1;else if(this._model=e.options,this._treemodel=e.options,null!==this._model){let e={id:this._model.id},i=this._model.collection.where(e);t.is(i)&&i.length>0&&(this._model=i[0],l.is3DPlayAvailable(this._model,this._skeleton).then((function(){u.log("Selected object is 3DPlay available")}),(function(){u.log("Selected object is NOT 3DPlay available")})))}},activate_deactivate:function(e){if(null===this._LightBoxPanel)return;if(!0===this._LightBoxPanel.visibleFlag)this._LightBoxPanel.visibleFlag=!1;else{let i=this._collection.indexOf(this._model);if(this._model=null,this._treemodel=null,t.is(e)&&null!==e&&(this._model=e),i=this._collection.indexOf(this._model),-1===i&&(i=0),i>=0){let e=null;this.onMainViewDisplay({nodeModel:e,nodeView:this._LightBoxPanel.elements.mainViewContent,view:this._LightBoxPanel}),this._LightBoxPanel.visibleFlag=!0,this.setChannelPosition(e)}}},setChannelPosition:function(e){let i=e;if(!t.is(i)){let e=this._collection.indexOf(this._model);if(-1===e&&(e=0),e>=0){let n=this._treeDocument.getRoots();t.is(n,"array")&&e<n.length&&(i=n[e])}}if(!t.is(this._channelView))return;let n=this._channelView.getScroller();if(t.is(n)){let e=this._channelView.options.defaultCellWidth*this._channelView.options.model.indexOf(i);n.getContent().scrollLeft=e}},CustoOnbigPicturePath:function(e){let i=e.nodeModel;return t.is(i)?i.options._attributes.preview_url:model._attributes.preview_url},onCustoOnRightViewRequest:function(e){},_toggleLoader:function(){let e=this,i=e._channelView.getContent();if(t.is(e._mySpinner))e._mySpinner.toggle();else{let t=n.create("div",{class:"datagrid-loader"});t.setStyle("text-align","center"),t.setStyle("position","relative"),t.setStyle("top","-12px"),t.inject(i),e._mySpinner=(new s).inject(t).show()}},changeModel:function(e){let i=this;t.is(e)&&this._LightBoxPanel&&!1!==e&&(t.is(this._modelEventTokenForOnAdd)&&t.is(this._treeDocument)&&t.is(this._treeDocument.getXSO,"function")&&t.is(this._treeDocument.getXSO())&&t.is(this._treeDocument.getXSO().unsubscribe,"function")&&(this._treeDocument.getXSO().unsubscribe(this._modelEventTokenForOnAdd),delete this._modelEventTokenForOnAdd),this._treeDocument=e,this._LightBoxPanel.setProperties({treeDocument:this._treeDocument}),this._modelEventTokenForOnAdd=this._treeDocument.getXSO().onAdd((function(e){i.onSelected(e)})))}})})),define("DS/SNResultUX/utils/notifications/Notification",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Debug","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","DS/SNInfraUX/SearchPreferences"],(function(e,t,i,n,s,o){"use strict";return t.singleton(i,{notifications:[],init:function(){self.notifications=[],window.notifs=n,s.setNotificationManager(window.notifs)},_checkNotificationStatus:function(t){return!e.is(o.getLocalStorageItem(t),"boolean")||o.getLocalStorageItem(t)},setNotificationStatus:function(e,t){t?o.removeLocalStorageItem(e):o.setLocalStorageItem(e,!1)},exec:function(t,i,n){!e.is(this.notifications[t])&&(this.notifications[t]={options:i}),!0===n&&(this.notifications[t].options=i),!0===this._checkNotificationStatus(t)&&window.notifs.addNotif(this.notifications[t].options)}})})),define("DS/SNResultUX/views/utils/PCSView",["UWA/Drivers/Alone","UWA/Core","UWA/Class/Model","UWA/Class/View","UWA/Class/Collection","UWA/Element","DS/3DXHighcharts/3DXHighcharts","DS/HighChartsModules/HighCharts_drilldown","DS/WebappsUtils/Performance","DS/SNInfraUX/Logger","text!DS/SNResultUX/assets/PCSView.json","i18n!DS/SNResultUX/assets/nls/SNResultUX_PCS.json"],(function(e,t,i,n,s,o,a,r,l,c,d,u){"use strict";return n.extend({name:"search_pcs_view",highcharts_options:{},setup:function(e){var n=this;n._parent(e);var r=o.create("div",{class:"pcs_result_action"}).inject(n.container),c=o.create("div",{class:"pcs_result_charts"}).inject(n.container);o.create("span",{class:"pcs_close_btn fonticon-2x fonticon fonticon-back",events:{click:function(){n.dispatchEvent("onClose"),n.destroy()}}}).inject(r),n.highcharts_options=t.extend(function(e){var n=i.extend({setup:function(){try{var e=JSON.parse(this._attributes.name);this._attributes=t.extend(this._attributes,e,!0)}catch(e){}}}),o=JSON.parse(d),a={};if("columnrange"!==e)throw new Error("Invalid chart type");var r=l.getEntriesByType("mark"),c=new s(r,{model:n,from_getEntries:!0});(a=t.extend(o[e],a,!0)).title.text=u.get("PCSView.columnrange.chart.title"),a.subtitle.text=u.get("PCSView.columnrange.chart.subtitle"),a.xAxis.title.text=u.get("PCSView.xAxis.title"),a.yAxis.title.text=u.get("PCSView.yAxis.title"),a.xAxis.labels.formatter=function(){return u.get("PCSView.labels."+this.value)},a.tooltip.formatter=function(){return u.replace(u.get("PCSView.tooltip."+this.key),{duration:this.point.high-this.point.low})};var h=[];return c.forEach((function(e){var i=c.where({name:e.get("name"),uuid:e.get("uuid")}),n=i[0].clone();if(2===i.length&&"start"===e.get("status")?n.set({endTime:i[1].get("startTime")}):1===i.length&&n.set({endTime:"NaN"}),t.is(n.get("drilldown"))&&n.set({drilldown:n.get("drilldown")+"_"+n.get("uuid")}),t.is(n.get("drilldown_serie_id"))){var s=n.get("endTime"),o=n.get("drilldown_serie_id"),a=c.filter((function(e){return!(e.get("startTime")>s)&&e.get("drilldown")===o}));a.length>0&&n.set({drilldown_serie_id:a[0].get("drilldown")+"_"+a[0].get("uuid")})}"end"!==e.get("status")&&h.push(n)})),c.reset(h),c.pluck("drilldown").forEach((function(e){if(void 0!==e){a.drilldown.series.push({id:e,data:[]});var t=a.drilldown.series.length-1;c.where({drilldown_serie_id:e}).forEach((function(i){a.drilldown.series[t].data.push({id:e,name:i.get("name"),low:i.get("startTime"),high:i.get("endTime"),drilldown:i.get("drilldown")})}))}})),c.reject((function(e){return t.is(e.get("drilldown_serie_id"))})).forEach((function(e){var t=e.get("drilldown"),i=c.max((function(e){return e.get("drilldown_serie_id")===t?e.get("endTime"):0})).get("endTime"),n={name:e.get("name"),low:e.get("startTime"),high:i,drilldown:e.get("drilldown")};a.series[0].data.push(n)})),a}("columnrange"),n.highcharts_options,!0),e.width&&e.height?(n.highcharts_options.chart.width=e.width,n.highcharts_options.chart.height=e.height):e.renderTo&&(n.highcharts_options.chart.width=e.renderTo.getSize().width,n.highcharts_options.chart.height=e.renderTo.getSize().height),n.highcharts_options.chart.renderTo=c;new a.Chart(n.highcharts_options);e.renderTo&&this.render().inject(e.renderTo)},render:function(){return this}})})),define("DS/SNResultUX/views/helpers/utils/PhoneBook",["UWA/Core","UWA/Class/View","DS/SNInfraUX/SearchDebug","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/keywords/SNKeywordManager","DS/Controls/Slider","DS/Controls/ProgressBar","DS/Controls/Popup","DS/Controls/Button","DS/MessageBus/MessageBus","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/Controls/LineEditor"],(function(e,t,i,n,s,o,a,r,l,c,d,u){"use strict";return t.extend(i,{tagName:"div",className:"search-phonebook",data:[],phoneBookApplyIcon:null,data:null,rerenderMultiView:null,collection:null,container:null,PhoneBookScroller:null,phoneBookContainer:null,phoneBookContent:null,PhonebookSearchBar:null,getLocalFilters:null,_setLocalFilter:()=>{},init:function(e){return this.data=e.data?e.data:null,this._setLocalFilter=e.setLocalFilter?e.setLocalFilter:()=>{},this.rerenderMultiView=null,this.container=e.container?e.container:null,this.getLocalFilters=e.getLocalFilters?e.getLocalFilters:()=>{},this.phoneBookContainer=null,this.phoneBookContent=null,this.collection=e.collection?e.collection:null,this._parent(e)},existAlready:function(){return null!==this.container.querySelector(".search-phonebook-content")},_getStatistic:function(e,t){let i=e.map((e=>e.count)).reduce(((e,t)=>e+t),0);return e.find((e=>e.object===t)).count/i*100},_renderPhoneBook:function(t,i){let n=this,s=this._retrieveCurrentUsrFilters();null!==document.querySelector(".search-phonebook-content")&&document.querySelector(".search-phonebook-content").destroy();let o=e.createElement("div",{class:"search-phonebook-content"});return Object.entries(t).forEach((([i,a])=>{let r=e.createElement("div",{class:"search-phonebook-header"});e.createElement("p",{class:"search-phonebook-header-letter",content:a.header}).inject(r),r.inject(o),a.data.forEach((i=>{let a=s.filter((e=>e.display===i.object)),r=e.createElement("div",{class:"search-phonebook-label"+(a.length>0?" filtered":"")}),l=e.createElement("div",{class:"search-phonebook-img"});e.createElement("img",{src:i.imageUrl}).inject(l),l.inject(r);let c=e.createElement("div",{class:"search-phonebook-item-encart"});e.createElement("p",{text:i.object}).inject(c),n.collection.isSearchRespEstimated()||(e.createElement("p",{text:"-"}).inject(c),e.createElement("p",{text:Math.max(...i.count)}).inject(c)),c.inject(r),r.addEventListener("click",(e=>{const i=e.currentTarget.innerText.trim();for(const e in t){const s=t[e].data.find((e=>i.includes(e.object)));if(s){n._clickOnTitle(s);break}}})),r.inject(o)}))})),""===o.innerHTML&&(o.innerHTML="<p>"+d.get("NoResult")+"</p>"),o},_retrieveCurrentUsrFilters:function(){let t=[],i=this.getLocalFilters();if(i&&i.allfilters&&e.is(i.allfilters.condition,"array"))for(let n=0;n<i.allfilters.condition.length;n++)i.allfilters.condition[n]["ds6w:who/person"]&&e.is(i.allfilters.condition[n]["ds6w:who/person"].condition,"array")&&(t=t.concat(i.allfilters.condition[n]["ds6w:who/person"].condition));return t},_findElementByLabel:function(e){for(const t in data){if(data[t].find((t=>t.object===e)))return!0}return!1},_clickOnTitle:function(e){let t=[];t.push({dispText:e.object,iconInfo:{image:e.imageUrl},identifier:e.object,isComplex:!0,object:{operator:"OR",predicates:[{predicate:"ds6w:who/ds6w:lastModifiedBy",type:"string"},{predicate:"ds6w:who/ds6w:responsible",type:"string"}],value:[e.object,e.object]},type:e.type}),this._setLocalFilter(t),c.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"clickOnTitle",persDim:{pd1:"phonebook",pd2:e.object}}})},_getPhoneBookTitle:function(){},_getDataForPhoneBook:function(e=""){let t=s.getCurrentUserInfo(),i=[],n=this.resultSet.find((e=>e.myContent));n&&this.resultSet.splice(this.resultSet.findIndex((e=>e===n)),1),i=e?this._filterPhoneBookArray(this.resultSet,e):this.resultSet;let o=null,a=[];return i.forEach((e=>{if(t.USER_FULLNAME===e.object)return void(o={header:d.get("ME"),data:[e]});let i=e.object.charAt(0).toUpperCase(),n=-1;for(let e=0;e<a.length;e++)if(i===a[e].header){n=e;break}if(-1===n){a.push({header:i,data:[]}),n=a.length-1,a[n].data.push(e);for(let e=0;e<a.length;e++)for(let t=0;t<a.length;t++)if(a[e].header<a[t].header){let i=a[e];a[e]=a[t],a[t]=i}}else a[n].data.push(e)})),null!==o&&a.unshift(o),a},setVisibility:function(e){const t=this.container.querySelector(".search-phonebook-container");e?t.classList.remove("hidden"):t.classList.add("hidden")},_filterPhoneBookArray:function(e,t){return e.filter((e=>e.object.toLowerCase().includes(t.toLowerCase())))},_filterPhoneBook:function(e,t,i){""!=i.target.value?(e.addClassName("hide"),t.removeClassName("hide")):(e.removeClassName("hide"),t.addClassName("hide")),this._renderPhoneBookContent(i.target.value)},_clearSearchField:function(e,t,i,n){e.value="",t.removeClassName("hide"),i.addClassName("hide"),this._renderPhoneBookContent("")},render:function(){this.resultSet=this.getOption("data"),this.existAlready()||(this._renderSearchBar(),this._renderPhoneBookContent(""))},_renderSearchBar:function(){let t=e.createElement("div",{class:"search-phonebook-search-content"});t.innerHTML='<div class="embedded-type-categories-search"><div class="tn-search-field"><div class="tn-input-group search-ctn"><input type="text" class="search-text-field form-control" placeholder="'+d.get("SearchPeople")+'"><span class="tn-input-group-addon fonticon fonticon-search"></span><span class="tn-input-group-addon fonticon fonticon-clear clear-btn hide" title=""></span></div></div></div>',t.getChildren()[0].getChildren()[0].getChildren()[0].getChildren()[0].addEventListener("input",this._filterPhoneBook.bind(this,t.getChildren()[0].getChildren()[0].getChildren()[0].getChildren()[1],t.getChildren()[0].getChildren()[0].getChildren()[0].getChildren()[2])),t.getChildren()[0].getChildren()[0].getChildren()[0].getChildren()[2].addEventListener("click",this._clearSearchField.bind(this,t.getChildren()[0].getChildren()[0].getChildren()[0].getChildren()[0],t.getChildren()[0].getChildren()[0].getChildren()[0].getChildren()[1],t.getChildren()[0].getChildren()[0].getChildren()[0].getChildren()[2])),t.inject(this.container)},_renderPhoneBookContent:function(t=""){null===this.phoneBookContainer?(this.phoneBookContainer=e.createElement("div",{class:"search-phonebook-content-object"}),this.phoneBookContainer.inject(this.container),this.phoneBookContent=e.createElement("div",{class:"search-phonebook-content-object-list"}).inject(this.phoneBookContainer)):this.phoneBookContent.empty(!0);const i=Array.from(Array(26)).map(((e,t)=>t+65));this.alphabet=i.map((e=>String.fromCharCode(e))),this.data=this._getDataForPhoneBook(t),this.phoneBookContent.append(this._renderPhoneBook(this.data))},reset:function(){this.phoneBookContainer&&this.phoneBookContainer.destroy(),this.phoneBookApplyIcon&&this.phoneBookApplyIcon.destroy(),this.PhoneBookScroller&&this.PhoneBookScroller.destroy(),this.phoneBookContainer=null,this.phoneBookApplyIcon=null,this.PhoneBookScroller=null,this.container.empty(!0)},destroy:function(){this.reset(),this._parent()}})})),define("DS/SNResultUX/views/utils/Play3DServices",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Events","UWA/Promise","DS/SNInfraUX/SearchUtils","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/SNInfraUX/ServiceDelegationLoader","DS/SNInfraUX/Logger"],(function(e,t,i,n,s,o,a,r,l){"use strict";return t.singleton(n,i,{_skeleton:null,is3DPlayAvailable:function(t,i){return this._skeleton=i,new s((function(n,s){e.is(t)&&e.is(t.get,"function")||e.is(s,"function")&&s();var o=t.getServiceID(),l=t.get("ds6w:type_value");e.is(l)||e.is(s,"function")&&s();var c=t.get("play3d");if(e.is(c))e.is(n,"function")&&e.is(s,"function")&&(c?n():s());else{var d=t.getPlatformID(),u=function(i){require(["DS/3DPlaySupport/AssetSupport"],(function(s){if(e.is(s)){const o={provider:"EV6",tenant:d,serverurl:i.serviceURL,physicalid:t.id,dtype:t.get("ds6w:type_value"),requiredAuth:"passport",requestsOptions:{authentication:"passport"}};s.checkSupport(o,{},(function(i){!0===i&&(t.set("play3d",!0),e.is(n,"function")&&n())}))}}))};a.getServiceUrl({serviceName:o,platformId:d,onComplete:function(a){e.is(a,"string")&&r.load({serviceID:o,platformID:d,serviceURL:a}).then((function(o){e.is(o.is3DPlayAvailable,"function")?o.is3DPlayAvailable.call(void 0,{model:t,serviceURL:a,skeleton:i,onComplete:function(i){e.is(i,"object")&&!0===i.availability?(t.set("play3d",!0),n()):(t.set("play3d",!1),s())}}):u({serviceURL:a})}),(function(){u({serviceURL:a})}))}})}}))},get3DPlayOptions:function(t,i,n){if(e.is(t)&&e.is(i,"function")){var s=t.getServiceID(),c=t.getPlatformID();if(e.is(s,"string")&&e.is(c,"string")){var d={input:{asset:{snippet:t.get("snippetAsStringArray"),contextId:e.is(n)?n.getSecurityContext():null},usage:"preview"},options:{loading:"autoplay",tenant:c},lang:o.getLanguage()},u=function(i,n,s){i.input.asset.serverurl=n,i.input.asset.provider="EV6",i.input.asset.physicalid=t.id,i.input.asset.contextId=e.is(s)?s.getSecurityContext():null,i.input.asset.dtype=t.get("ds6w:type_value"),i.input.asset.requiredAuth="passport",i.input.asset.requestsOptions={authentication:"passport"},i.input.asset.filename=null,i.input.asset.format=null,i.input.asset.snippet=t.get("snippetAsStringArray")};a.getServiceUrl({serviceName:s,platformId:c,onComplete:function(n){e.is(n,"string")&&r.load({serviceID:s,platformID:c,serviceURL:n}).then((function(o){e.is(o.get3DPlayOptions,"function")?o.get3DPlayOptions({defaultPlayOptions:d,model:t,serviceURL:n,onComplete:function(e){i(e)},onFailure:function(){l.warn("Play3DServices get3DPlayOptions FAILED for ",s,c,n),i(d)}}):e.is(o.get3DPlayProvider,"function")?(u(d,n),d.input.asset.provider=o.get3DPlayProvider(),i(d)):(u(d,n),i(d))}),(function(){u(d,n),i(d)}))}})}}else l.error("Invalid args when calling Play3DServices.get3DPlayOptions",t)}})})),define("DS/SNResultUX/views/utils/PropertiesServices",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Events","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/ServiceDelegationLoader","DS/SNInfraUX/SecurityContextManager","DS/FedDictionaryAccess/FedDictionaryAccessAPI","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],(function(e,t,i,n,s,o,a,r,l,c,d){"use strict";return t.singleton(n,i,{name:"DS_SNResultUX_utils_PropertiesServices",_internal_attr:["type_icon_url","id","resourceid","resourceid_tagger","preview_url","image","icon","actions","subtitle","icon_source"],init:function(){this.setDebugMode(o.getDebugMode())},displaySearchItemProperties:function(t,i,n,s,o,r,l){e.is(t)&&e.is(i)&&e.is(o)||r(i);let d=!1,u=o.getSupportedServicesArray();if(e.is(u)&&e.is(u.services)&&-1===u.services.indexOf(s)&&(d=!0),e.is(t.isAShowOnlyObject,"function")){!0===t.isAShowOnlyObject()&&(d=!0)}let h=!1;if(e.is(l)){h=!0,i.set("isTransient",!0);let g={},p=l.length;for(let _=0;_<p;_++){let f=new n,m=l[_];f.set("name",m.id),f.set("path",m.id),f.set("label",m.title),f.set("value",a.decodeHtml(m.value)),g[m.id]=f}i.set(g)}if(!1===d)e.is(r,"function")&&r(i);else{i.set("isTransient",!0),e.is(i.get("type_icon_url"))&&""!==i.get("type_icon_url")||!e.is(t.get("type_icon_url"))||i.set("type_icon_url",t.get("type_icon_url")),e.is(t.get("preview_url"))&&(e.is(i.get("previewUrl"))&&""!==i.get("previewUrl")||i.set("previewUrl",t.get("preview_url")),e.is(i.get("preview_url"))&&""!==i.get("preview_url")||i.set("preview_url",t.get("preview_url")));let S=this,v=t.pairs();v.sort((function(e,t){return e[0]>t[0]?1:e[0]<t[0]?-1:0}));let w=[],b=[],C=!1;for(let I=0;I<v.length;I++){let T=v[I][0],A=v[I][1];if(A){let x=T.match(/\/([^/]*)$/);x=null===x?T.replace(/_value/,""):x[1].replace(/_value/,""),(-1===S._internal_attr.indexOf(T)&&-1===T.indexOf(":snippet")&&-1===T.indexOf("_value")&&T.indexOf("ds6w:business")<0&&(-1!==T.indexOf("ds6w:")||-1!==T.indexOf("ds6wg:"))&&-1===w.indexOf(x)||T.indexOf("ds6w:business")>=0&&T.indexOf("_value")>=0)&&(w.push(x),b.push(A))}}let y=function(){let s={},o=w.length;for(let r=0;r<o;r++){let o=w[r],l=null;if(e.is(i.get(o))||h?e.is(i.get(o))&&h&&(l=i.get(o)):l=new n,e.is(l)){e.is(l.get("name"))&&""!==l.get("name")||l.set("name",o),e.is(l.get("path"))&&""!==l.get("path")||l.set("path",o);let n=o;e.is(S.nlsPredicate)&&e.is(S.nlsPredicate[o])&&(n=S.nlsPredicate[o]),e.is(n)&&""!==n||(n=o),e.is(l.get("label"))&&""!==l.get("label")||l.set("label",n);let c=b[r],d="";if(c instanceof Array){if(c.length>0)if(o.indexOf("ds6w:businessRole")>=0)d=a.decodeHtml(c.slice(-1)[0].slice(-1)[0]);else for(let e=0;e<c.length;e++){let t=c[e];c[e]instanceof Array&&(t=c[e][c[e].length-1],d+=a.decodeHtml(t)+(e===t.length-1?"":" | "))}e.is(l.get("value"))&&""!==l.get("value")||l.set("value",d)}else c.length>0&&(e.is(l.get("value"))&&""!==l.get("value")||l.set("value",c),"ds6w:type"===o?e.is(l.get("urlIcon"))&&""!==l.get("urlIcon")||l.set("urlIcon",t.get("type_icon_url")):"ds6w:label"===o?e.is(l.get("sectionIdentityCard"))&&""!==l.get("sectionIdentityCard")||l.set("sectionIdentityCard","title"):"ds6w:created"===o?e.is(l.get("sectionIdentityCard"))&&""!==l.get("sectionIdentityCard")||l.set("sectionIdentityCard","date"):"ds6w:responsible"===o&&(e.is(l.get("sectionIdentityCard"))&&""!==l.get("sectionIdentityCard")||l.set("sectionIdentityCard","ownerName")));e.is(i.get(o))||(s[o]=l)}}let r=t.get("ds6w:what/ds6w:type_value");e.is(r,"array")&&(r=r.join("|")),s["ds6w:what/ds6w:type_value"]=r,i.set(s),C=!0};function D(t){let i={};if(e.is(t,"object")&&e.is(t.vocabularyElementNLSInfo,"array"))for(let e=0,n=t.vocabularyElementNLSInfo.length;e<n;e++)i[t.vocabularyElementNLSInfo[e].uri]=t.vocabularyElementNLSInfo[e].nlsName;return i}c.getResourcesInfo(w.join(","),{tenantId:i.get("tenant"),lang:a.getLanguage(),onComplete:function(t){S.nlsPredicate=D(t),!1===C&&y.call(),e.is(r,"function")&&r(i)},onFailure:function(){!1===C&&y.call(),e.is(r,"function")&&r(i)}})}},getPropModelFromSearchItem:function(t,i,n,s,o,a){var r=[];if(!(e.is(t)&&e.is(i)&&e.is(n)&&e.is(s)))return o(r),r;var l,c="businessobject";e.is(t.IsAnInstance,"function")&&!0===t.IsAnInstance()&&(c="relationship");var d=t.getServiceID();l=new i({metatype:c,objectId:t.id,source:d,tenant:t.getPlatformID()}),this.displaySearchItemProperties(t,l,n,d,s,(()=>{r.push(l);var i=t.getPlatformID();widget.setValue("x3dPlatformId",i),e.is(o)&&o(r)}),a)},getOptions:function(t){let i=t?t.securityContext:"";s.log("PropertiesServices.getOptions",t);var n={typeOfDisplay:t.EditPropConstants.ALL,selectionType:t.EditPropConstants.NO_SELECTION,readOnly:!0,extraNotif:!0,editMode:!1,context:{getSecurityContext:function(){return{SecurityContext:i}}}},o=function(){var e=[{text:d.get("section.properties.title"),name:t.EditPropConstants.FACET_PROPERTIES,icon:"attributes",expandedFlag:!0}];n.facets=[t.EditPropConstants.FACET_PROPERTIES,t.EditPropConstants.FACET_SWYM_CONTENT,t.EditPropConstants.FACET_SWYM_USER_PROPERTIES,t.EditPropConstants.FACET_SWYM_COMMUNITY_PROPERTIES,t.EditPropConstants.FACET_SWYMCOMMENTS],t.onComplete.call(void 0,n,e)};e.is(t)&&e.is(t.model)&&!1!==t.useDelegationProtocol?r.load({serviceID:t.model.getServiceID(),platformID:t.model.getPlatformID()}).then((function(i){e.is(i.getFacets,"function")?i.getFacets({model:t.model,constants:t.EditPropConstants,setContext:function(e){n.context=e},setReadOnly:function(e){n.readOnly=e},setEditMode:function(e){n.editMode=e},setFacets:function(i,s){e.is(i,"array")&&(n.facets=i,t.onComplete.call(void 0,n,s))},addFacets:function(i,n){e.is(i,"array")&&t.onAddFacets.call(void 0,i)}}):o()}),(function(){o()})):o()}})})),define("DS/SNResultUX/views/WebUX/CollectionView/ResponsiveLargeTextualTilesCollectionView",["DS/CollectionView/ResponsiveLargeTextualTilesCollectionView","DS/CollectionView/layouts/CollectionViewGridLayout","DS/Utilities/Dom","UWA/Core"],(function(e,t,i,n){"use strict";return e.inherit({publishedProperties:{clickCB:{defaultValue:function(e){console.log(e)},type:"function"},clickSignatureItemCB:{defaultValue:function(e){console.log(e)},type:"function"},sideGutter:{defaultValue:{small:10,big:10},type:"object"}},_postBuildView:function(){this._parent(),this.addEventListener("click",this._onCellClickCB.bind(this),!1)},_onCellClickCB:function(e,t){n.is(this.clickCB)&&this.clickCB.call(this,t)},addEventListener:function(e,t,n){var s=this,o=function(e){if(!s._isRequestingCell){e.dsModel=s;var n=i.firstParentWithClass(e.target,"wux-layouts-collectionview-cell");if(e.target.className.includes("search_item_hyperlink")||e.target.parentElement.className.includes("search_item_hyperlink"))return;if(e.target.className.includes("searchItemSpan_hyperlink")||e.target.parentElement.className.includes("searchItemSpan_hyperlink")){if("click"===e.type||"touchstart"===e.type){e.stopImmediatePropagation();let t="highlightedSearchCriteria"===e.target.className?e.target.parentElement:e.target,i={name:t.getAttribute("search-item-predicate"),source:"ds6w:dataSource"===t.getAttribute("search-item-predicate")?t.getAttribute("search-item-predicate-value"):null},o=parseInt(n.getAttribute("cell-id"),10),a=s.getCellInfosAt(o);s.clickSignatureItemCB(a,null,i)}return}if(n){var o=parseInt(n.getAttribute("cell-id"),10);if(!isNaN(o)){var a=s.getCellInfosAt(o);a.cellView=s._getViewAt(o),t(e,a)}}else t(e)}};return s.getContent().addEventListener(e,o,n),o}})})),define("DS/SNResultUX/views/WebUX/CollectionView/ResponsiveLargeTilesCollectionView",["DS/CollectionView/ResponsiveLargeTilesCollectionView","DS/Utilities/Dom","UWA/Core"],(function(e,t,i){"use strict";return e.inherit({publishedProperties:{clickCB:{defaultValue:function(e){console.log(e)},type:"function"}},_postBuildView:function(){this._parent(),this.addEventListener("click",this._onCellClickCB.bind(this),!1)},_onCellClickCB:function(e,t){i.is(this.clickCB)&&this.clickCB.call(this,t)},addEventListener:function(e,i,n){var s=this,o=function(e){if(!s._isRequestingCell){e.dsModel=s;var n=t.firstParentWithClass(e.target,"wux-layouts-collectionview-cell");if(e.target.className.includes("search_item_hyperlink")||e.target.parentElement.className.includes("search_item_hyperlink"))return;if(n){var o=parseInt(n.getAttribute("cell-id"),10);if(!isNaN(o)){var a=s.getCellInfosAt(o);a.cellView=s._getViewAt(o),i(e,a)}}else i(e)}};return s.getContent().addEventListener(e,o,n),o}})})),define("DS/SNResultUX/views/WebUX/CollectionView/ResponsiveThumbnailsCollectionView",["DS/CollectionView/ResponsiveThumbnailsCollectionView","DS/Utilities/Dom","UWA/Core"],(function(e,t,i){"use strict";return e.inherit({publishedProperties:{clickCB:{defaultValue:function(e){console.log(e)},type:"function"}},_postBuildView:function(){this._parent(),this.addEventListener("click",this._onCellClickCB.bind(this),!1)},_onCellClickCB:function(e,t){i.is(this.clickCB)&&this.clickCB.call(this,t)},addEventListener:function(e,i,n){var s=this,o=function(e){if(!s._isRequestingCell){e.dsModel=s;var n=t.firstParentWithClass(e.target,"wux-layouts-collectionview-cell");if(e.target.className.includes("search_item_hyperlink")||e.target.parentElement.className.includes("search_item_hyperlink"))return;if(n){var o=parseInt(n.getAttribute("cell-id"),10);if(!isNaN(o)){var a=s.getCellInfosAt(o);a.cellView=s._getViewAt(o),i(e,a)}}else i(e)}};return s.getContent().addEventListener(e,o,n),o}})})),define("DS/SNResultUX/views/WebUX/CollectionView/ResponsiveTilesCollectionView",["DS/CollectionView/ResponsiveTilesCollectionView","DS/Utilities/Dom","UWA/Core"],(function(e,t,i){"use strict";return e.inherit({publishedProperties:{clickCB:{defaultValue:function(e){console.log(e)},type:"function"},clickSignatureItemCB:{defaultValue:function(e){console.log(e)},type:"function"}},_postBuildView:function(){this._parent(),this.addEventListener("click",this._onCellClickCB.bind(this),!1)},_onCellClickCB:function(e,t){i.is(this.clickCB)&&this.clickCB.call(this,t)},addEventListener:function(e,i,n){var s=this,o=function(e){if(!s._isRequestingCell){e.dsModel=s;var n=t.firstParentWithClass(e.target,"wux-layouts-collectionview-cell");if(e.target.className.includes("search_item_hyperlink")||e.target.parentElement.className.includes("search_item_hyperlink"))return;if(e.target.className.includes("searchItemSpan_hyperlink")||e.target.parentElement.className.includes("searchItemSpan_hyperlink")){if("click"===e.type||"touchstart"===e.type){e.stopImmediatePropagation();let t="highlightedSearchCriteria"===e.target.className?e.target.parentElement:e.target,i={name:t.getAttribute("search-item-predicate"),source:"ds6w:dataSource"===t.getAttribute("search-item-predicate")?t.getAttribute("search-item-predicate-value"):null},o=parseInt(n.getAttribute("cell-id"),10),a=s.getCellInfosAt(o);s.clickSignatureItemCB(a,null,i)}return}if(n){var o=parseInt(n.getAttribute("cell-id"),10);if(!isNaN(o)){var a=s.getCellInfosAt(o);a.cellView=s._getViewAt(o),i(e,a)}}else i(e)}};return s.getContent().addEventListener(e,o,n),o}})})),define("DS/SNResultUX/views/utils/SearchContentSet",["UWA/Core","DS/W3DXComponents/ContentSet","DS/SNInfraUX/SearchPreferences","DS/SNResultUX/views/W3DXComponents/Views/Item/SwitcherView"],(function(e,t,i,n){"use strict";return t.extend({name:"search-content-set",test:!1,defaultOptions:{switcher:{view:n}},setup:function(){this.addEvent("onItemRendered",this._onItemRendered,this);var e,t=this.getOption("contents"),n="nullToMany"===this.getOption("contents").selectionMode,s=this.getOption("defaultView");if(this.container.addClassName(this.getClassNames("-container")),!(s=this.getOption("isInApps")?i.getItem("LastInAppsSearchViewMode"):i.getItem("LastSearchViewMode"))){for(var o=0;o<t.views.length;o++)if(t.views[o].default){e=t.views[o];break}e&&(s=e.id)}!s&&(s=t.views[0].id),this.currentViewId=s,this._initDetailView(),n&&this._initMultiselHeaderView(),this._initActionsView(),this._initSwitcherView(),this._initContentsViews(t.views)},buildMultiselOnCheck:function(t){if(this.multiselHeaderView){var i=this.contentsViews[this.currentViewId].nestedView,n=i.getSelectionState();if(n.isActive)if(e.is(t,"array"))for(var s=0;s<t.length;s++)i.isSelected(t[s])||i.addSelection(t[s]);else i.isSelected(t)?i.removeSelection(t):i.addSelection(t);else if(e.is(t,"array"))for(var o=0;o<t.length;o++)e.is(t[o])&&!i.isSelected(t[o])&&i.addSelection(t[o]);else e.is(t)&&!i.isSelected(t)?(i.addSelection(t),i.activateMultisel(!1)):(i.deactivateMultisel(),this.multiselHeaderView.dispatchEvent("onMultiselOff"));this.multiselHeaderView.buildMultisel(n),i.selectionIsEmpty()&&!n.wasExplicitlyActivated&&i.deactivateMultisel()}},_initMultiselHeaderView:function(){if(this.getOption("actions").collection){var t,i,n,s,o,a=this,r=(s="multiselHeader",(n=this)&&(o=n[s],e.is(o,"function")&&(o=o.call(n))),o);return i=this._multiselHeaderViewEvents={onMultiselOn:function(){var t=this.contentsViews[this.currentViewId];"table"!==this.currentViewId&&e.is(this.contentsViews.table)&&this.contentsViews.table.nestedView.activateMultisel();t.nestedView.activateMultisel(!0),this.dispatchEvent("onMultiselOn",arguments)},onMultiselOff:function(){var t=this.contentsViews[this.currentViewId];"table"!==this.currentViewId&&e.is(this.contentsViews.table)&&this.contentsViews.table.nestedView.deactivateMultisel();t.nestedView.deactivateMultisel(),this.dispatchEvent("onMultiselOff",arguments)},onActionClick:function(){Array.prototype.unshift.call(arguments,this.actionsView),this.dispatchEvent("onActionClick",arguments)}},i.onActionClickDotted=function(){var t=a.getSelection();if(e.is(t,"array")&&e.is(a.collection)){var i=a.collection.getSNSkeleton();e.is(i)&&i.buildMultiselActions(t)}},t=this.multiselHeaderView=new r(this.getMultiselHeaderViewOptions()),this.listenTo(t,i),t}},getMultiselHeaderViewOptions:function(){var t=this._parent.apply(this,arguments);return e.is(t)||(t={}),t["data-rec-id"]=!0,t},getActionsViewOptions:function(){var t=this,i=this._parent();return i.filterer=function(i){var n=t.collection._snSkeleton._searchActions.displayMode;if(!e.is(n))return!0;var s=i.get("displayMode");return!e.is(s,"string")||("AllView"===s||s.search(n)>=0)},i},_onItemRendered:function(){var t=this.collection._snSkeleton._searchActions;if(e.is(t)){t.setSearchContentSetDivContainer(this.container);var i=t.displayMode;e.is(i,"string")&&t.setDisplayMode(i)}var n=e.extendElement(this.container).getElement(".search-content-set-header");this.collection._snSkeleton.options.observable.setSearchContentSetHeader(n)},destroy:function(){this.multiselHeaderView&&this.stopListening(this.multiselHeaderView,this._multiselHeaderViewEvents),this.removeEvent("onItemRendered",this._onItemRendered,this),this._parent()}})})),define("DS/SNResultUX/views/utils/SearchCounterView",["UWA/Core","DS/W3DXComponents/Views/Temp/TempItemView","DS/SNInfraUX/SearchUtils","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],(function(e,t,i,n){"use strict";return t.extend({name:"set-detail-view",tagName:"div",_totalRecords:0,title:"",template:function(){return'{{#if title}}<span class="'+this.getClassNames("-title")+'">{{title}}</span><span class="'+this.getClassNames("-count")+'" id="search-nb-result">{{itemsLength}}</span>{{/if}}'},init:function(t){t=e.clone(t||{},!1),["container","template","tagName"].forEach((function(e){delete t[e]})),this.title="",this._parent(t),e.is(t)&&e.is(t.collection)&&e.is(t.collection.totalCount)&&t.collection.totalCount>=0||this.hide()},setup:function(){this.container.addClassName(this.getClassNames("-container"))},mixinTemplateHelpers:function(){var e=this._parent.apply(this,arguments),t=this.collection,i=t.totalCount;return!i&&(i=t.size()),i=t.totalCount<t.length?t.length:t.totalCount,e.itemsLength=i,e.title=this._determineCounterTitleFromQuery(t.service_parameters),e},_determineCounterTitleFromQuery:function(t){if(!i.isFUN109031Active())return this.title;if("#advancedSearch"===t.originalSearchCriteria||"#advancedSearch"===t.query)return n.get("adv_search_launchWithResults");if("#favoriteSearches"===t.originalSearchCriteria||"#favoriteSearches"===t.query)return n.get("myContent_searchFavWithResults");if(e.is(t.refine)&&e.is(t.refine.localfilters)&&e.is(t.refine.localfilters.condition,"array")&&1===t.refine.localfilters.condition.length){let i=Object.keys(t.refine.localfilters.condition[0]);if(e.is(t.refine.localfilters.condition,"array")&&1===i.length){if("ds6w:what/type_categorization"===i[0]&&e.is(t.refine.localfilters.condition[0][i[0]].condition)&&1===t.refine.localfilters.condition[0][i[0]].condition.length&&!0!==t.refine.localfilters.condition[0][i[0]].condition[0].excluded)return n.replace(n.get("ResultsOfType"),{type:t.refine.localfilters.condition[0][i[0]].condition[0].display});if("ds6w:who/person"===i[0]&&e.is(t.refine.localfilters.condition[0][i[0]].condition)&&1===t.refine.localfilters.condition[0][i[0]].condition.length&&!0!==t.refine.localfilters.condition[0][i[0]].condition[0].excluded)return n.replace(n.get("ResultsOwnedBy"),{name:t.refine.localfilters.condition[0][i[0]].condition[0].display});if("sixw:ds6w:when/ds6w:modified"===i[0]&&e.is(t.refine.localfilters.condition[0][i[0]][0])&&e.is(t.refine.localfilters.condition[0][i[0]][0].displayValue)&&!0!==t.refine.localfilters.condition[0][i[0]][0].excluded)return n.replace(n.get("ResultsFor"),{type:t.refine.localfilters.condition[0][i[0]][0].displayValue});if(("ds6w:where/ds6w:location/computedCountryInfo"===i[0]||"ds6w:where/ds6w:source/ds6w:dataSource"===i[0])&&e.is(t.refine.localfilters.condition[0][i[0]].condition)&&1===t.refine.localfilters.condition[0][i[0]].condition.length&&!0!==t.refine.localfilters.condition[0][i[0]].condition[0].excluded)return n.replace(n.get("ResultsFor"),{type:t.refine.localfilters.condition[0][i[0]].condition[0].display})}}return this.title},setOptions:function(t){var i=this,n=this.collection;if(this._parent.apply(this,arguments),t.title){var s=this.templateHelpers||(this.templateHelpers={});s.title=t.title||s.title,this.title=s.title,n&&this.listenTo(n,{onAdd:function(){i._totalRecords!==i.collection.totalCount&&(this.render.apply(this,arguments),i.show(),i.container.setStyle("visibility","visible"))},onRemove:function(){i._totalRecords!==i.collection.totalCount&&(this.render.apply(this,arguments),i.show(),i.container.setStyle("visibility","visible"))},onReset:function(){i._totalRecords=0,this.render.apply(this,arguments),e.is(i.collection.totalCount)&&i.collection.totalCount>=0?(i._totalRecords=i.collection.totalCount,i.show(),i.container.setStyle("visibility","visible")):(i.hide(),i.container.setStyle("visibility","hidden"))},onSync:function(){i._totalRecords=0,this.render.apply(this,arguments),e.is(i.collection.totalCount)&&i.collection.totalCount>=0?(i.show(),i.container.setStyle("visibility","visible")):i.container.setStyle("visibility","hidden")}})}else n&&this.stopListening(n);return this}})})),define("DS/SNResultUX/utils/datagridPreferences/SearchDataGridPreferences",["DS/SNResultUX/utils/datagridPreferences/Abstract","UWA/Core","UWA/Class","UWA/Element","DS/UIKIT/SuperModal","DS/UIKIT/Input/Button","DS/UIKIT/Input/Select","DS/UIKIT/Input/Text","DS/UIKIT/Tooltip","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/SWFiltering","DS/SNInfraUX/SearchUtils","DS/SNResultUX/utils/SearchServices","DS/FedDictionaryAccess/FedDictionaryAccessAPI","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],(function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_,f){"use strict";return i.extend(e,{init:function(e){c.log(e.availableColumns);var i=this;this._parent(e);let n=e.searchDatagridView&&e.searchDatagridView.collection&&e.searchDatagridView.collection.getSNSkeleton();t.is(n)&&n.maskContainer(),this._launchTypeOrSubtypeCusto(e.searchDatagridView,e.typeToHandle,e.arrayTypeDS6WG,e.currentFilter,(()=>{c.log("init"),i._thingsToApply={},i._buildView(),i._fillView(),t.is(n)&&n.unmaskContainer()}))},_buildView:function(){return!t.is(this._typeToHandle.typeName)&&c.error("!UWACore.is(me._typeToHandle.typeName)"),this._parent()},_createFooter:function(){c.log("_createFooter"),this._divFooter.innerHTML="";var e=this;new o({value:f.get("SearchDataGridPreferences_modal_apply"),className:"primary apply-button",id:"apply_customization_btn",events:{onClick:function(){c.log("Click on apply Customization"),null!==e.options.move_to_do&&e.options.preferences_grid.getManager().getRows().forEach((function(t){e.options.move_to_do.push(t[0].options.value)})),e._custoCombo&&!0===e._unmodifiedCusto?e._applySetting(e._custoCombo.getValue()[0],!1):e._applySetting("TEMP_CUSTO",!0),e._requestClosePanel()}}}).inject(this._divFooter),new o({value:f.get("SearchDataGridPreferences_modal_reset"),className:"secondary reset-button",id:"reset_customization_btn",events:{onClick:function(){c.log("Click on reset Customization"),e._applyReset(),e._requestClosePanel()}}}).inject(this._divFooter);var t=new o({value:f.get("SearchDataGridPreferences_modal_save"),className:"secondary save-button",id:"save_customization_btn",events:{onClick:function(){c.log("Click on save Customization"),null!==e.options.move_to_do&&e.options.preferences_grid.getManager().getRows().forEach((function(t){e.options.move_to_do.push(t[0].options.value)})),e._saveSetting(t),e._custoNameEdt.setFocus(!0)}}}).inject(this._divFooter);return this._divFooter},_launchTypeOrSubtypeCusto:function(e,i,n,s,o){var a=this;t.is(s)&&t.is(s.allfilters)&&(t.is(s.allfilters["ds6w:what/ds6w:kind"])&&1===s.allfilters["ds6w:what/ds6w:kind"].length&&t.is(s.allfilters["ds6w:what/ds6w:kind"][0].object)&&t.is(s.allfilters["ds6w:what/ds6w:kind"][0].disptext)?(i={typeName:s.allfilters["ds6w:what/ds6w:kind"][0].disptext,isPQ:!1},n.push(["ds6wg:"+s.allfilters["ds6w:what/ds6w:kind"][0].object])):t.is(s.allfilters["ds6w:what/ds6w:type"])&&1===s.allfilters["ds6w:what/ds6w:type"].length&&t.is(s.allfilters["ds6w:what/ds6w:type"][0].object)&&t.is(s.allfilters["ds6w:what/ds6w:type"][0].disptext)?(i={typeName:s.allfilters["ds6w:what/ds6w:type"][0].disptext,isPQ:!1,className:"ds6wg:"+s.allfilters["ds6w:what/ds6w:type"][0].object},n.push(s.allfilters["ds6w:what/ds6w:type"][0].object)):t.is(s.allfilters["sixw:vpmextension"])&&1===s.allfilters["sixw:vpmextension"].length&&t.is(s.allfilters["sixw:vpmextension"][0].object)&&t.is(s.allfilters["sixw:vpmextension"][0].displayValue)?(i={typeName:s.allfilters["sixw:vpmextension"][0].displayValue,isPQ:!1},n.push([s.allfilters["sixw:vpmextension"][0].object])):t.is(s.allfilters["sixw:ds6w:what/ds6w:type"])&&1===s.allfilters["sixw:ds6w:what/ds6w:type"].length&&t.is(s.allfilters["sixw:ds6w:what/ds6w:type"][0].object)&&t.is(s.allfilters["sixw:ds6w:what/ds6w:type"][0].displayValue)&&(i={typeName:s.allfilters["sixw:ds6w:what/ds6w:type"][0].displayValue,isPQ:!1,className:s.allfilters["sixw:ds6w:what/ds6w:type"][0].object},n.push(s.allfilters["sixw:ds6w:what/ds6w:type"][0].object))),n.filter((function(e,t,i){return t===i.indexOf(e)})),u._asyncCallToPredicatesWS(n).then((function(t){a.renderColumnsWithSuccess(e,t,i,o)}),(function(t){a.renderColumnsWithFailure(e,i,t,o)}))},renderColumnsWithSuccess:function(e,i,n,s){for(var o=[],a={},r={},l=0,d=i.classPredicates.length;l<d;l++){if(!t.is(i.classPredicates[l].className)||!t.is(i.classPredicates[l].vocabularyPredicateInfo))return c.warn("Unexpected response from GetRelevantPredicates !"),this.options.oSearchCustoServices._removeColumnCustoMask(e),null;if(t.is(n.className)&&n.className.length>0)for(let e=0,s=i.classPredicates[l].vocabularyPredicateInfo.length;e<s;e++)t.is(i.classPredicates[l].vocabularyPredicateInfo[e],"object")&&t.is(i.classPredicates[l].vocabularyPredicateInfo[e].nlsName,"string")&&t.is(i.classPredicates[l].vocabularyPredicateInfo[e].uri,"string")&&t.is(i.classPredicates[l].vocabularyPredicateInfo[e].name,"string")&&i.classPredicates[l].className===n.className?(t.is(r[i.classPredicates[l].vocabularyPredicateInfo[e].nlsName])||(r[i.classPredicates[l].vocabularyPredicateInfo[e].nlsName]=[]),t.is(a[i.classPredicates[l].vocabularyPredicateInfo[e].uri])||(r[i.classPredicates[l].vocabularyPredicateInfo[e].nlsName].push(i.classPredicates[l].vocabularyPredicateInfo[e].uri),o.push({dispValue:i.classPredicates[l].vocabularyPredicateInfo[e].nlsName,sixw:i.classPredicates[l].vocabularyPredicateInfo[e].uri,type:g._getPredicateTypeFromDataType(i.classPredicates[l].vocabularyPredicateInfo[e])||"string",relatedObjectType:i.classPredicates[l].className,name:i.classPredicates[l].vocabularyPredicateInfo[e].name}),a[i.classPredicates[l].vocabularyPredicateInfo[e].uri]=!0)):(c.warn("Invalid data returned by Predicates WS for class "+i.classPredicates[l].className+" for index "+e+" !"),c.warn(i.classPredicates[l].vocabularyPredicateInfo));else if(t.is(n.typeName))for(let e=0,n=i.classPredicates[l].vocabularyPredicateInfo.length;e<n;e++)t.is(i.classPredicates[l].vocabularyPredicateInfo[e],"object")&&t.is(i.classPredicates[l].vocabularyPredicateInfo[e].nlsName,"string")&&t.is(i.classPredicates[l].vocabularyPredicateInfo[e].uri,"string")&&t.is(i.classPredicates[l].vocabularyPredicateInfo[e].name,"string")?(t.is(r[i.classPredicates[l].vocabularyPredicateInfo[e].nlsName])||(r[i.classPredicates[l].vocabularyPredicateInfo[e].nlsName]=[]),t.is(a[i.classPredicates[l].vocabularyPredicateInfo[e].uri])||(r[i.classPredicates[l].vocabularyPredicateInfo[e].nlsName].push(i.classPredicates[l].vocabularyPredicateInfo[e].uri),o.push({dispValue:i.classPredicates[l].vocabularyPredicateInfo[e].nlsName,sixw:i.classPredicates[l].vocabularyPredicateInfo[e].uri,relatedObjectType:i.classPredicates[l].className,name:i.classPredicates[l].vocabularyPredicateInfo[e].name}),a[i.classPredicates[l].vocabularyPredicateInfo[e].uri]=!0)):(c.warn("Invalid data returned by Predicates WS for class "+i.classPredicates[l].className+" for index "+e+" !"),c.warn(i.classPredicates[l].vocabularyPredicateInfo))}let u=h.getSelectPredicates();if(t.is(u,"array"))for(var p=o.length-1;p>=0;p--)-1===u.indexOf(o[p].sixw)&&o.splice(p,1);for(var _=0,f=o.length;_<f;_++)t.is(r[o[_].dispValue],"array")&&r[o[_].dispValue].length>1&&(o[_].dispValue+=" ("+o[_].relatedObjectType+":"+o[_].sixw+")");this._launchColumnCustoPanel(e,n,o,s)},renderColumnsWithFailure:function(e,i,n,s){c.error("promisePredicate fail !",arguments);var o=f.get("SearchDataGridPreferences_error_UnableToRetrievePredicates");t.is(n)&&(n.message&&(o+="<br>"+n.message),n.url&&(o+="<br>"+n.url)),p._displayAlert({message:o,className:"warning",widgetId:e.getOption("widgetId")}),this._launchColumnCustoPanel(e,i,[],s)},_launchColumnCustoPanel:function(e,i,n,s){let o=t.clone(e._columnsAttributes);if("The_Default_Columns"===e._currentCustoViewId)for(var a in o)o[a].wrap&&delete o[a].wrap,o[a].pinned&&delete o[a].pinned;var r=e.collection.options.tagger_proxy.latest_tagValues,l=[];let d=!1;var u=this._computeColToDisplayInCustoPanel(o,n,r);for(a=0;a<u.length;a++)if(t.is(u[a].text)&&-1!=u[a].text.indexOf("ds6w")){1==(u[a].text.match(/ds6w/g)||[]).length&&(l.push(u[a].dataIndex),d=!0)}if(d){let o=this,a="";if(t.is(e.collection)&&t.is(e.collection.search_ressources)&&t.is(e.collection.search_ressources.getActiveTenant,"function")&&(a=e.collection.search_ressources.getActiveTenant()),l.length>0){var h=l.join("\r\n");_.getResourcesInfo(h,{tenantId:a,lang:g.getLanguage(),apiVersion:"R2019x",onComplete:function(e){c.log(e),t.is(e)||(c.error("Unexpected response from getResourcesInfo !"),e=[]);for(var a=0,l=u.length;a<l;a++)for(var d=0,h=e.length;d<h;d++){if(!t.is(e[d].curi)||!t.is(e[d].label))return c.error("Unexpected response from getResourcesInfo !"),null;e[d].curi!==u[a].dataIndex||u[a].text===e[d].label||(u[a].text="* "+e[d].label)}o.options.typeToHandle=i,o._typeToHandle=t.clone(i),o.options.predicateIntersection=n,o._predicateIntersection=t.clone(n),o.options.availableColumns=u,o.gridInitValues=t.clone(u),o.gridFinalValues=t.clone(u),o.options.currentTags=r,s&&s.call(o)},onFailure:function(){c.warn("not able to load predicates"),o.options.typeToHandle=i,o._typeToHandle=t.clone(i),o.options.predicateIntersection=n,o._predicateIntersection=t.clone(n),o.options.availableColumns=u,o.gridInitValues=t.clone(u),o.gridFinalValues=t.clone(u),o.options.currentTags=r,s&&s.call(o)}})}}else this.options.typeToHandle=i,this._typeToHandle=t.clone(i),this.options.predicateIntersection=n,this._predicateIntersection=t.clone(n),this.options.availableColumns=u,this.gridInitValues=t.clone(u),this.gridFinalValues=t.clone(u),this.options.currentTags=r,s&&s.call(this)},_saveSetting:function(){var e,i,a=this;function l(e){var i=!1,n="",o=!1,r=!1,l=!1,c="";(e.endsWith("-ADMIN")||e.endsWith("-HIDDEN"))&&(i=!0,n=".InvalidCustoName",e.endsWith("-ADMIN")?c="-ADMIN":e.endsWith("-HIDDEN")&&(c="-HIDDEN"),l=!0);var d=a.options.oSearchCustoServices.getAvailableColumnCustomization(a._typeToHandle);if(t.is(d,"array")&&d.length>0)for(var u=0,h=d.length;u<h&!i;u++)d[u].value===e&&(i=!0,n=".AlreadyExistingCusto",o=!0,r=!0);if(!0===i){var g=new s({renderTo:document.body,className:"WarningSaveCustoDlg"}),p=[];o&&p.push({classname:"primary",id:"YesReplaceBtn",value:f.get("SearchColumnCusto.Warning.YES"),action:function(t){a._applySetting(e,!0),t.destroy(),a._requestClosePanel()}}),r&&p.push({classname:"primary",id:"NoReplaceBtn",value:f.get("SearchColumnCusto.Warning.NO"),action:function(e){a._custoNameEdt.setFocus(!0),e.destroy()}}),l&&p.push({classname:"primary",id:"OKReplaceBtn",value:f.get("SearchColumnCusto.Warning.OK"),action:function(e){a._custoNameEdt.setFocus(!0),e.destroy()}}),g.dialog({body:f.replace(f.get("SearchColumnCusto"+n+".Msg"),{columnCustoName:e,INVALID_EXT:c}),title:f.get("SearchColumnCusto"+n+".Title"),buttons:p})}else a._applySetting(e,!0),a._requestClosePanel()}var c=n.create("div",{class:"saveDiv"});a._custoNameEdt=new r({className:"SearchDataGridPreferences_txt",id:"CustomizationNameEdt",placeholder:f.get("SearchDataGridPreferences_modal_saveEditor"),attributes:{events:{keydown:function(){e.setDisabled(!1)}}},events:{onKeyDown:function(t){13===t.keyCode&&this.getValue().length>0&&(e.setDisabled(!1),a._custoCombo.getValue()!==this.getValue()&&l(this.getValue()))}}});var d=this._custoCombo.getValue()[0];d&&d.length>0&&(d.endsWith("-ADMIN")||d.startsWith("###")?(a._custoNameEdt.setValue(f.get("SearchColumnCustoDefaultNameForSave")),a._custoNameEdt.setFocus(!0)):a._custoNameEdt.setValue(d));var u=n.create("div",{class:"btnDiv"});e=new o({value:f.get("SearchDataGridPreferences_save_ok"),className:"primary ok-button",id:"ok_save_custo",events:{onClick:function(){var e=a._custoNameEdt.getValue();a._custoCombo.getValue()[0]!==e?l(e):(a._applySetting(e,!0),a._requestClosePanel())}}}),i=new o({value:f.get("SearchDataGridPreferences_save_cancel"),className:"primary cancel-button",id:"cancel_save_custo",events:{onClick:function(){a._createFooter()}}}),a._custoNameEdt.inject(c),u.inject(c),e.inject(u),i.inject(u),this._divFooter.innerHTML="",c.inject(this._divFooter),0===d.length&&e.setDisabled(!0)},_fillView:function(){c.log("SearchDataGridPreferences._fillView"),this._addGridColumnsManager(),this._displayCusto(void 0,!0),this._addCustoCombo(),this._addFavoriteButton(),this._addDelButton(),t.is(this.options.searchDatagridView._forcedCustoView,"string")&&(this._typeToHandle.forcedCusto=this.options.searchDatagridView._forcedCustoView),this._addTooltip()},_addFavoriteButton:function(){var e=this;t.is(this._typeToHandle.isPQ)&&!0===this._typeToHandle.isPQ&&(this._bFav=new o({icon:"star",id:"associate_to_pq"}),this._bFavTooltip=new l({target:this._bFav.getContent(),body:f.get("custo_favorite.tooltip")}),this._bFavTooltip.getContent().style.zIndex=this._zIndexToUse>3999?this._zIndexToUse+2:4001,this._bFav.inject(this._divCombo),this._bFav.addEvent("onClick",(function(){e._applySetting({custoName:e._typeToHandle.typeName.pqName,custoId:"###"+e._typeToHandle.typeName.pqName,custoNLS:e._typeToHandle.typeName.pqNLS,favPQ:!0},!0),e._requestClosePanel()})))},_addDelButton:function(){var e=this;this._bDel=new o({icon:"trash",id:"delete_custo_btn"}).inject(this._divCombo),this._columnCustoPreferenceDefinition=d.getItem("DataGridColumnCusto"),this._bDel.inject(this._divCombo),this._bDel.addEvent("onClick",(function(){var i=e._custoCombo.getValue()[0];if(t.is(i,"string")&&i.length>0&&t.is(e._columnCustoPreferenceDefinition,"object")){var n=!1;if(e.options.searchDatagridView._currentCustoViewId===i&&(n=!0),t.is(e._columnCustoPreferenceDefinition.views,"array"))for(var s=e._columnCustoPreferenceDefinition.views.length-1;s>=0;s--)t.is(e._columnCustoPreferenceDefinition.views[s],"object")&&t.is(e._columnCustoPreferenceDefinition.views[s].viewId,"string")&&e._columnCustoPreferenceDefinition.views[s].viewId===i&&e._columnCustoPreferenceDefinition.views.splice(s,1);t.is(e._columnCustoPreferenceDefinition.activeView,"string")&&e._columnCustoPreferenceDefinition.activeView===i&&delete e._columnCustoPreferenceDefinition.activeView,d.commit(),e._custoCombo.remove(i),!0===n&&(e._applyReset(),e._requestClosePanel())}}));var i=this._custoCombo.getValue(),n="";t.is(i,"array")&&i.length>0&&(n=i[0]),n.length>0&&!n.endsWith("-ADMIN")?this._bDel.show():this._bDel.hide()},_addCustoCombo:function(){var e=this;this._custoCombo=new a({nativeSelect:!0,id:"custo_selection",placeholder:f.get("dataGrid.columnCustoPanel.existingCustoComboPlaceHolder"),events:{onChange:function(){var i=this.getValue(),n="";t.is(i,"array")&&i.length>0&&(n=i[0]),t.is(e._bDel)&&(n.length>0&&!n.endsWith("-ADMIN")?e._bDel.show():e._bDel.hide()),0!==n.length&&(e._displayCusto(n),e._unmodifiedCusto=!0,t.is(e.options.preferences_grid)&&e.options.preferences_grid.getManager().updateView(!0))}},options:this.options.oSearchCustoServices.getAvailableColumnCustomization(this._typeToHandle)}).inject(this._divCombo)},_addTooltip:function(){this._bDelTooltip=new l({target:this._bDel.getContent(),body:f.get("custo_delete.tooltip")}),this._bDelTooltip.getContent().style.zIndex=this._zIndexToUse>3999?this._zIndexToUse+2:4001},destroy:function(){this._bFavTooltip&&this._bFavTooltip.destroy(),this._bFavTooltip=null,this._bDelTooltip&&this._bDelTooltip.destroy(),this._bDelTooltip=null,this._columnCustoPreferenceDefinition=null,this.gridInitValues=null,this.gridFinalValues=null,this._custoCombo=null,this._predicateIntersection=null,this._typeToHandle=null,this._bFav=null,this._bDel=null,this._parent()}})})),define("DS/SNResultUX/utils/datagridPreferences/SearchDataGridPreferencesEndUser",["DS/SNResultUX/utils/datagridPreferences/Abstract","UWA/Core","UWA/Class","DS/Spreadsheet/DataGrid","DS/UIKIT/Input/Button","DS/UIKIT/Autocomplete","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SNVocabAccess","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/SearchLogin","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SNAdvSearchCusto","DS/SNResultUX/views/WebUX/Spreadsheet/Manager_EndUserCusto","DS/SNResultUX/utils/SearchServices","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],(function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_){"use strict";var f="ENDUSER_CUSTO";return i.extend(e,{name:"SearchDataGridPreferencesEndUser",oSourceAutocomplete:null,oTypeAutocomplete:null,oSubtypeAutocomplete:null,availablePredicates:null,othersDataSources:null,currentObjectLoaded:{source:null,types:[]},buttonOk:null,buttonRestore:null,buttonDelete:null,init:function(e){l.setResources({resources:e.resources}),this._loadOtherSources(e.resources),this.currentObjectLoaded={source:null,types:[]},this._parent(e),this.options.availableColumns=this._computeColToDisplayInCustoPanel(t.clone(this.options.searchDatagridView._columnsAttributes),[],[]).concat(this.options.hiddenData),this.gridInitValues=t.clone(this.options.availableColumns),this.gridFinalValues=t.clone(this.options.availableColumns);let i=e.resources.getActiveTenant();h.getDefaultSelectedSource(i);this._buildView(),this._fillView(),this._loadCusto(!0),1===this.options.sources.length&&(this.oSourceAutocomplete.dispatchEvent("onSelect",[this.options.sources[0]]),this.oSourceAutocomplete.disable()),this.enableFooterButtonsVisiblity()},_loadCusto:function(e){let i=r.getItem("DataGridColumnCusto");if(t.is(i)&&t.is(i.views,"array"))for(let t in i.views)if(f===i.views[t].viewId){this._predicateIntersection=[],this._displayCusto(f,e);break}return this},reloadRightGridWithCurrentColumns:function(){return this.options.availableColumns=this._computeColToDisplayInCustoPanel(t.clone(this.options.searchDatagridView._columnsAttributes),[],[]).concat(this.options.hiddenData),this.gridFinalValues=this.options.availableColumns,this.options.preferences_grid.getManager().empty(),this.options.preferences_grid.getManager().addRows(this._getPrefGridData(this.gridFinalValues)),this.unselectAllLeftPredicates(),this},unselectAllLeftPredicates:function(){return this.availablePredicates&&this.availablePredicates.getManager().unselectAll(),this},_loadOtherSources:function(e){this.othersDataSources=[],d.login({resources:e,onComplete:e=>{let i=u.getValidDatasources({dataSources:e});t.is(i.otherDataSourceServices,"array")&&(this.othersDataSources=i.otherDataSourceServices)},onFailure:e=>{a.log("[3dSearch-DGPrefEndUser] - "+e)}})},_fillView:function(){this._addSourcesAutocomplete(),this._addTypesAutocomplete(),this._addSubtypesAutocomplete(),this._constructAndDislayAvailablePredicatesSpreadsheet([]),this._addGridColumnsManager()},_addSourcesAutocomplete:function(){var e=this;null!==this.oSourceAutocomplete&&this.oSourceAutocomplete.destroy(),this.oSourceAutocomplete=new o({showSuggestsOnFocus:!0,placeholder:_.get("adv_search.dataSource"),events:{onSelect:function(t){e._reinit(),e.currentObjectLoaded.source=t;let i={vocabId:l.getVocabularyName(t.value)};"other"===i.vocabId&&(i.rdfSources=e.othersDataSources),l.loadVocabularyClasses(i,(i=>{if(e.oTypeAutocomplete.setDisabled(!0)&&e.oTypeAutocomplete.onHideSuggests(),i.classInfos.length>0){for(let e in i.classInfos)i.classInfos[e].label=i.classInfos[e].nlsName,i.classInfos[e].value=i.classInfos[e].uri;e.oTypeAutocomplete.addDataset({name:t.value,items:i.classInfos}),e.currentObjectLoaded.types=i.classInfos,e.oTypeAutocomplete.setDisabled(!1)}}))},onUnselect:function(t){for(let i in e.oTypeAutocomplete.datasets)if(t.value===e.oTypeAutocomplete.datasets[i].name){e.oTypeAutocomplete.removeDataset(e.oTypeAutocomplete.datasets[i].id);break}e.currentObjectLoaded.types=[],e.oTypeAutocomplete.datasets.length<=0&&e.oTypeAutocomplete.setDisabled(!0)&&e.oTypeAutocomplete.onHideSuggests();for(let t in e.oSubtypeAutocomplete.datasets)e.oSubtypeAutocomplete.removeDataset(e.oSubtypeAutocomplete.datasets[t].id);e.oSubtypeAutocomplete.datasets.length<=0&&e.oSubtypeAutocomplete.setDisabled(!0)&&e.oSubtypeAutocomplete.onHideSuggests(),e._constructAndDislayAvailablePredicatesSpreadsheet([])}}}),this.oSourceAutocomplete.addDataset({items:this.options.sources}),this.oSourceAutocomplete.getContent().addClassName("sourcesInput"),this.oSourceAutocomplete.inject(this._divCombo)},_addTypesAutocomplete:function(){var e=this;null!==this.oTypeAutocomplete&&this.oTypeAutocomplete.destroy(),this.oTypeAutocomplete=new o({showSuggestsOnFocus:!0,placeholder:_.get("adv_search.type"),multiSelect:!0,disabled:!0,events:{onSelect:function(t){l.loadRelevantInterfaces({className:t.value,currentDataSource:t.service},(i=>{for(let e in i.interfaces)i.interfaces[e].label=i.interfaces[e].nlsName,i.interfaces[e].value=i.interfaces[e].name;for(let n in e.currentObjectLoaded.types)t.value===e.currentObjectLoaded.types[n].value&&(e.currentObjectLoaded.types[n].subTypes=i.interfaces);e.oSubtypeAutocomplete.addDataset({name:t.value,items:i.interfaces}),e._reloadAvailablePredicates(),e.oSubtypeAutocomplete.datasets.length<=0?e.oSubtypeAutocomplete.setDisabled(!0)&&e.oSubtypeAutocomplete.onHideSuggests():e.oSubtypeAutocomplete.setDisabled(!1)}))},onUnselect:function(t){for(let i in e.currentObjectLoaded.types)if(t.value===e.currentObjectLoaded.types[i].value){delete e.currentObjectLoaded.types[i].subTypes;for(let i in e.oSubtypeAutocomplete.datasets)if(t.value===e.oSubtypeAutocomplete.datasets[i].name){e.oSubtypeAutocomplete.selectedItems.filter((t=>t.datasetId===e.oSubtypeAutocomplete.datasets[i].id)).forEach((t=>e.oSubtypeAutocomplete.onUnselect(t))),e.oSubtypeAutocomplete.removeDataset(e.oSubtypeAutocomplete.datasets[i].id);break}break}e._reloadAvailablePredicates(),e.oSubtypeAutocomplete.datasets.length<=0&&e.oSubtypeAutocomplete.setDisabled(!0),e.oSubtypeAutocomplete.onHideSuggests()}}}),this.oTypeAutocomplete.getContent().addClassName("typesInput"),this.oTypeAutocomplete.inject(this._divCombo)},_addSubtypesAutocomplete:function(){var e=this;null!==this.oSubtypeAutocomplete&&this.oSubtypeAutocomplete.destroy(),this.oSubtypeAutocomplete=new o({showSuggestsOnFocus:!0,placeholder:_.get("adv_search.subtype"),multiSelect:!0,disabled:!0,events:{onSelect:function(){e._reloadAvailablePredicates()},onUnselect:function(){e._reloadAvailablePredicates()}}}),this.oSubtypeAutocomplete.getContent().addClassName("extensionsInput"),this.oSubtypeAutocomplete.inject(this._divCombo)},_reinit:function(){this.currentObjectLoaded={source:null,types:[]},this.oTypeAutocomplete.unselectAll()&&delete this.oTypeAutocomplete.datasets&&this.oTypeAutocomplete.getSuggestions(),this.oSubtypeAutocomplete.unselectAll()&&delete this.oSubtypeAutocomplete.datasets&&this.oSubtypeAutocomplete.getSuggestions()},_createFooter:function(){this._divFooter.innerHTML="";var e=this;return this.buttonOk=new s({value:_.get("SearchDataGridPreferences_modal_apply"),className:"primary apply-button",id:"apply_customization_btn",events:{onClick:function(){null!==e.options.move_to_do&&e.options.preferences_grid.getManager().getRows().forEach((function(t){e.options.move_to_do.push(t[0].options.value)})),e._custoCombo&&!0===e._unmodifiedCusto?e._applySetting(e._custoCombo.getValue()[0],!1):e._applySetting(f,!0),e._requestClosePanel()}}}).inject(this._divFooter),this.buttonRestore=new s({value:_.get("SearchDataGridPreferences_modal_reset"),className:"secondary reset-button",id:"reset_customization_btn",disabled:!0,events:{onClick:function(){e._applyReset(new Object),e._requestClosePanel()}}}).inject(this._divFooter),this.buttonDelete=new s({value:_.get("SearchDataGridPreferences_modal_delete"),className:"secondary delete-button",id:"delete_customization_btn",disabled:!0,events:{onClick:function(){e._remove()}}}).inject(this._divFooter),this._divFooter},enableFooterButtonsVisiblity:function(){let e=r.getItem("DataGridColumnCusto");if(!t.is(e)||t.is(e.activeView)&&"The_Default_Columns"===e.activeView?this.buttonRestore.setDisabled(!0):this.buttonRestore.setDisabled(!1),this.buttonDelete.setDisabled(!0),t.is(e)&&t.is(e.views,"array"))for(let t in e.views)if(f===e.views[t].viewId){this.buttonDelete.setDisabled(!1);break}return this._parent()},_reloadAvailablePredicates:function(){let e=[],t=[];var i=this;let n=this.oTypeAutocomplete.getSelection();n.length>0&&(t=t.concat(n));for(let t=0;t<n.length;t++)e.push(n[t].value);let s=this.oSubtypeAutocomplete.getSelection();s.length>0&&(t=t.concat(s));for(let t=0;t<s.length;t++)e.push(s[t].value);0!==e.length?c._asyncCallToPredicatesWS(e).then((function(e){i._constructAndDislayAvailablePredicatesSpreadsheet(i._formatAvailableDataResponse(e.classPredicates,t))}),(function(e){console.log(e)})):this._constructAndDislayAvailablePredicatesSpreadsheet([])},_formatAvailableDataResponse:function(e,t){let i=[];for(let n=0;n<e.length;n++)for(let s=0;s<e[n].vocabularyPredicateInfo.length;s++){let o=e[n].className;for(let e=0;e<t.length;e++)if(o===t[e].value){o=t[e].nlsName;break}i.push({class:o,name:e[n].vocabularyPredicateInfo[s].nlsName,value:e[n].vocabularyPredicateInfo[s].uri,classValue:e[n].className})}return i},_constructAndDislayAvailablePredicatesSpreadsheet:function(e){if(e=this._filterPredicates(e),null!==this.availablePredicates)this.availablePredicates.getManager().empty(),this.availablePredicates.getManager().addRows(e);else{let t=this;this.availablePredicates=new n({enableScrollOnDrag:!1,columns:[{text:_.get("SearchDataGridPreferences_modal_header_class"),dataIndex:"class",width:"auto",minWidth:40},{text:_.get("SearchDataGridPreferences_modal_header_name"),dataIndex:"name",width:"auto",minWidth:40},{dataIndex:"value",isHidden:!0},{dataIndex:"classValue",isHidden:!0}],data:e,defaultCellHeight:40,headersDimensions:{height:40},show:{rowHeaders:!0,columnHeaders:!0},height:"auto",apiVersion:2,resize:{columns:!0},isSortable:!0,selection:{cells:!1,rowHeaders:!0,columnHeaders:!1,unselectAllOnEmptyArea:!0,canMultiSelect:!0},enableDragAndDrop:!1,managerClass:g}),this.availablePredicates.inject(this._divAvailable),this.availablePredicates.getManager().onRowHeaderRequest((function(e){e.cellView.getContent().setStyles({"text-align":"center",opacity:.5,fontSize:"1.5em",cursor:"pointer"}),t.availablePredicates.getManager().isRowSelected(e.cellView.getVirtualCoordinates().virtualRowID)?e.cellView.getContent().innerHTML="[x]":e.cellView.getContent().innerHTML="[  ]",t.availablePredicates.getManager().getSelectedRows().length<=0?t._arrow.setDisabled(!0):t._arrow.setDisabled(!1)}))}},_filterPredicates:function(e){let t=[];for(let i=0;i<e.length;i++){let n=!1;for(let t=0;t<this.gridFinalValues.length;t++)if(e[i].value===this.gridFinalValues[t].dataIndex){n=!0;break}!n&&t.push(e[i])}return t},_onAddPredicate:function(){let e=this.availablePredicates.getManager().options.model,i=this.availablePredicates.getManager().getSelectedRows(),n=[];for(let t in i)void 0!==e[i[t]]&&n.push({dispValue:e[i[t]][1].options.value,relatedObjectType:e[i[t]][3].options.value,relatedObjectTypeDispValue:e[i[t]][0].options.value,sixw:e[i[t]][2].options.value,isRemovable:!0,visibility:!0});this.options.availableColumns=this._computeColToDisplayInCustoPanel(t.clone(this.gridFinalValues),n,[]),this.gridFinalValues=this.options.availableColumns,this.options.preferences_grid.getManager().empty(),this.options.preferences_grid.getManager().addRows(this._getPrefGridData(this.gridFinalValues))},_remove:function(){let e=r.getItem("DataGridColumnCusto");if(t.is(e,"object")){let n=f===this.options.searchDatagridView._currentCustoViewId;if(t.is(e.views,"array"))for(var i=e.views.length-1;i>=0;i--)t.is(e.views[i],"object")&&t.is(e.views[i].viewId,"string")&&f===e.views[i].viewId&&e.views.splice(i,1);t.is(e.activeView,"string")&&f===e.activeView&&delete e.activeView,r.commit(),!0===n&&this._applyReset(new Object),p._displayAlert({message:_.replace(_.get("SearchDataGridPreferences_modal_deleteSuccessful"),{custo_name:f}),className:"success"}),this._requestClosePanel()}},destroy:function(){return null!==this.oSourceAutocomplete&&this.oSourceAutocomplete.destroy(),null!==this.oTypeAutocomplete&&this.oTypeAutocomplete.destroy(),null!==this.oSourcoSubtypeAutocompleteeAutocomplete&&this.oSubtypeAutocomplete.destroy(),null!==this.availablePredicates&&this.availablePredicates.destroy(),null!==this.buttonOk&&this.buttonOk.destroy(),null!==this.buttonRestore&&this.buttonRestore.destroy(),null!==this.buttonDelete&&this.buttonDelete.destroy(),this._parent()}})})),define("DS/SNResultUX/views/helpers/SearchDataGridView",["UWA/Core","DS/MessageBus/MessageBus","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/RefineHelper/RefineHelper","DS/SNSearchResultsCusto/utils/SearchResultsCustomizationPreferences","DS/SNResultUX/utils/SearchCustoServices","DS/SNResultUX/utils/SearchServices","DS/SNResultUX/utils/SearchViewOptions","DS/SNResultUX/views/helpers/Abstract","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/SNResultUX/utils/ExternalComponentHelpers","DS/Controls/TooltipModel","DS/FedDictionaryAccess/FedDictionaryAccessAPI"],(function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_){"use strict";return u.extend({tagName:"div",className:"DataGridView",attributes:{styles:{width:"100%"},"data-rec-id":"DataGridView"},IDENTIFIER:"3dSearch-datagrid-identifier",_fixTh:["ds6w:label","ds6w:who/ds6w:responsible","ds6w:when/ds6w:created","ds6w:when/ds6w:modified","ds6w:responsible","ds6w:created","ds6w:modified"],_defaultColumnDef:{width:"auto",typeRepresentation:"string"},_columns:[],_columnsForDataGrid:[],_currentCustoViewId:null,_currentCustoViewType:null,_currentTenant:null,_columnsAttributes:[],_subscriptions:[],_forcedCustoView:null,collection:null,nestedView:null,specific_socket:null,_aCustoColumnAttributes:[],init:function(i){var o=this;this._parent(i),this._columns=e.clone(this._columnsAttributes),this._aCustoColumnAttributes=[],e.is(this.collection&&this.collection.getSNSkeleton())&&(this._subscriptions.sortForAllView=t.subscribe({channel:this.collection.getSNSkeleton().getOption("messagingChannel"),topic:"sortForAllView",callback:function(t){if(!e.is(o.view)||!o.collection.service_parameters){if(s.isODTMode())return;throw new Error("[SarchDataGridView] : callback sort - datagrid object is undefined.")}if(e.is(t.bForceNotReload,"boolean")&&!1===t.bForceNotReload)return;let i,a,r;o.collection.service_parameters.order_by&&o.collection.service_parameters.order_field?(i=o.collection.service_parameters.order_by,a=o.collection.service_parameters.order_field,r=o.collection.service_parameters.order_type?o.collection.service_parameters.order_type:""):(i=t.order_by,a=t.order_field,r=t.order_type?t.order_type:"");var l=n.getOption("NLSMapping_3DSearch_Sorting_TACTICALOnly");if(e.is(l))for(let e in l)if(e===a){a=l[e];break}o.view.initComponentState({dataIndex:a,sort:i,type:r})}}))},setup:function(t){this._parent(t);var i=this;this.listenTo(this.collection,{onSync:function(){i.view&&i._updateAfterCollectionSync()},onInitTreeDocument_SelectFirstElt:function(){e.is(i.view)&&e.is(i.collection)&&e.is(i.collection.service_parameters)&&e.is(i.collection.service_parameters.query)&&s.SearchTypeEnum.MY_RECENT_CONTENT===i.collection.service_parameters.query&&i.view._applySortModel(!1),i.view&&i._updateAfterCollectionSync()}}),o.removeItem("listColumnsWidth"),d.resetDefaultHeaders()},_updateAfterCollectionSync:function(){for(var e=0;e<this.view.columns.length;e++)this.view.columns[e].sortableFlag=this.collection.state.totalRecords<=n.getOption("max_results_to_enable_sort")?r.isColumnSortable(this.view.columns[e].dataIndex):r.isColumnSortableFor1000(this.view.columns[e].dataIndex);this.view._applyColumns();let t=this.collection._snSkeleton.getWidgetResultViewCusto();if(!t||!1===t.isDynamicCustomedByUser){let e=this;setTimeout((function(){e.view.sizeColumnsToFit(e._columns,{computeColumnHeader:!0,isUserInteraction:!0,minMax:{maxRowID:40,minRowID:0}})}),50)}},_resizeColumn:function(t,i){e.is(this.view)&&this.view.layout.setColumnWidth(t,i,{isUserInteraction:!1})},_reinitColums:function(t){var i=this;this._forcedCustoView=null,this._currentCustoViewId=this._lastSelectedCustoViewId,this._currentTenant=this.collection.search_ressources.getActiveTenant(),this._currentCustoViewType=null,this._reinitColumnsWidth();var n,o=e.is(this.collection.service_parameters)&&e.is(this.collection.service_parameters.isAPQSearch)&&!0===this.collection.service_parameters.isAPQSearch&&e.is(this.collection)&&e.is(this.collection.getPQ())&&e.is(this.collection.getPQ().pqName,"string")&&this.collection.getPQ().pqName.length>0,c={isPQ:o,typeName:this.collection.getPQ()},u=this.collection._snSkeleton.getWidgetResultViewCusto();if(r.isBETAEnabled()?(n=u?u.customizationId:r.getCustomizationIdToUse(c),u&&!0===c.isPQ&&(r._pqName=c.typeName.pqName)):n=l.getColumnCustomizationIdToUse(c),e.is(n,"string")&&n.length>0&&(this._currentCustoViewId=n,r.isBETAEnabled()?!u||"Datagrid"!==u.customizedViews&&"all views"!==u.customizedViews?u&&!0===u.isDynamicCustomedByUser?this._setColumnAttributes(u.views.Datagrid.general?u.views.Datagrid.general:u.views.Datagrid):this._setColumnAttributes(r.getCustomizationDefinitionFromCustoId(r.getCustomizationIdToUse(c),this._currentTenant,c,u)):this._setColumnAttributes(r.getCustomizationDefinitionFromCustoId(n,this._currentTenant,c,u)):this._setColumnAttributes(l.getColumnCustomizationDefinitionFromCustoId(n,this._currentTenant))),e.is(i.collection.service_parameters)&&e.is(i.collection.options.tagger_proxy)&&e.is(i.collection.service_parameters.refine)&&e.is(i.collection.options.tagger_proxy.getCurrentFilter())&&e.is(i.collection.service_parameters.refine.allfilters)&&e.is(i.collection.options.tagger_proxy.getCurrentFilter().allfilters)){let n={},s={};n=e.clone(i.collection.options.tagger_proxy.getCurrentFilter(),!0),s=e.clone(i.collection.service_parameters.refine,!0),e.is(n.allfilters)&&a.isSimplifiedTaggerFilters(n.allfilters)&&(r.isBETAEnabled()?n.allfilters=r.getAllFilters(n.allfilters):n.allfilters=l.getAllFilters(n.allfilters)),i._reinitColumsGetFilters(t,n,s,o,c,u)}(!e.is(i._columnsAttributes)||e.is(i._columnsAttributes)&&i._columnsAttributes.length<1)&&i._setColumnAttributes(d.getDataGridViewHeaders()),e.is(i.collection)&&e.is(i.collection.service_parameters)&&e.is(i.collection.service_parameters.query)&&s.SearchTypeEnum.MY_RECENT_CONTENT===i.collection.service_parameters.query&&i._columnsAttributes.forEach((function(e){-1!==e.dataIndex.indexOf("/")&&(e.dataIndex=e.dataIndex.slice(e.dataIndex.indexOf("/")+1,e.dataIndex.length))})),i._reloadColumn(i._columnsAttributes),i.collection.getAttributesToRetrieve(i._columns),i._comptuteNewColumnsNLS()},_reinitColumnsWidth:function(){if(o.getItem("listColumnsWidth")&&this.view)try{let t=JSON.parse(o.getItem("listColumnsWidth")),i=Object.keys(t);for(var e=0;e<this.view.columns.length;e++)-1!==i.indexOf(this.view.columns[e].dataIndex)&&(this.view.columns[e].width=t[this.view.columns[e].dataIndex])}catch(e){i.log(e)}if("The_Default_Columns"===this._currentCustoViewId)if(o.getItem("listColumnsWidth"))try{let e=JSON.parse(o.getItem("listColumnsWidth")),t=Object.keys(e);this._columnsAttributes.forEach((function(i){i.width=-1===t.indexOf(i.dataIndex)?"auto":e[i.dataIndex]}))}catch(e){i.log(e)}else this._columnsAttributes.forEach((function(e){e.width="auto"}))},_reinitColumsGetFilters:function(t,i,n,o,a,d){if(this.collection.service_parameters.query===s.SearchTypeEnum.ADVANCED_SEARCH&&e.is(n)&&""===n)this._applyColumnAttributes("The_Default_Columns",this._currentTenant,a,d);else if(e.is(i)&&e.is(i.allfilters)&&e.is(n)&&e.is(n.allfilters))if(this.collection.service_parameters.query!==s.SearchTypeEnum.ADVANCED_SEARCH&&Object.keys(i.allfilters).length>0&&(e.is(i.allfilters["ds6w:what/ds6w:type"])&&i.allfilters["ds6w:what/ds6w:type"].length>0||e.is(i.allfilters["ds6w:what/ds6w:kind"])&&i.allfilters["ds6w:what/ds6w:kind"].length>0)){let i=[];e.is(n.allfilters)&&e.is(n.allfilters.condition,"array")&&e.is(n.allfilters.condition[0]["ds6w:what/type_categorization"])&&e.is(n.allfilters.condition[0]["ds6w:what/type_categorization"].condition,"array")&&(i=n.allfilters.condition[0]["ds6w:what/type_categorization"].condition),e.is(n.allfilters)&&e.is(n.allfilters,"object")&&e.is(n.allfilters["ds6w:what/ds6w:type"],"array")&&(i=n.allfilters["ds6w:what/ds6w:type"]);let s=[];for(let e=0;e<i.length;e++){let t=null;if(r.isBETAEnabled()){let n=this.collection._snSkeleton.getWidgetResultViewCusto();t={id:u=n?n.customizationId:r.getCustomizationIdToUse(a),viewDefinition:r.getCustomizationDefinitionFromCustoIdAndType(u,"Datagrid",i[e].object),type:i[e].object}}else t=l.getColumnCustomizationAliasIdToUse(i[e].object,this._currentTenant);(!t||null!==t.viewDefinition)&&s.push(t)}let o=s.filter((function(e,t,i){return i.indexOf(e)===t}));1===o.length&&e.is(o[0])&&(r.isBETAEnabled()?(this._currentCustoViewId=o[0].id,this._currentCustoViewType=o[0].type,this._setColumnAttributes(o[0].viewDefinition)):(this._currentCustoViewId=o[0],this._setColumnAttributes(l.getColumnCustomizationDefinitionFromAliasCustoId(this._currentCustoViewId))),this._isCurrentView&&(!e.is(t)||!e.is(t.refresh))&&c._displayAlert({message:h.get("SearchDataGridPreferences_modal_typeCusto"),className:"success",widgetId:this.getOption("widgetId")}))}else if(e.is(i.allfilters)&&(e.is(i.allfilters["sixw:ds6w:what/ds6w:type"])||e.is(i.allfilters["sixw:vpmextension"]))){let n=[];e.is(i.allfilters["sixw:ds6w:what/ds6w:type"])&&!e.is(i.allfilters["sixw:vpmextension"])?n=i.allfilters["sixw:ds6w:what/ds6w:type"]:e.is(i.allfilters["sixw:vpmextension"])&&!e.is(i.allfilters["sixw:ds6w:what/ds6w:type"])?n=i["sixw:vpmextension"]:e.is(i.allfilters["sixw:vpmextension"])&&e.is(i.allfilters["sixw:ds6w:what/ds6w:type"])&&(n=i.allfilters["sixw:ds6w:what/ds6w:type"].concat(i.allfilters["sixw:vpmextension"]));let s=[];for(let e=0;e<n.length;e++){let t=null;if(r.isBETAEnabled()){let i=this.collection._snSkeleton.getWidgetResultViewCusto();var u=i?i.customizationId:r.getCustomizationIdToUse(a);let s=r.getCustomizationDefinitionFromCustoIdAndType(u,"Datagrid",n[e].object.slice(6));null===s&&(s=r.getCustomizationDefinitionFromCustoId(u,this._currentTenant,a,i)),t={id:u,viewDefinition:s}}else t=l.getColumnCustomizationAliasIdToUse(n[e].object.slice(6),this._currentTenant);s.push(t)}let o=s.filter((function(e,t,i){return i.indexOf(e)===t}));1===o.length&&e.is(o[0])&&(r.isBETAEnabled()?(this._currentCustoViewId=o[0].id,this._currentCustoViewType=o[0].type,this._setColumnAttributes(o[0].viewDefinition)):(this._currentCustoViewId=o[0],this._setColumnAttributes(l.getColumnCustomizationDefinitionFromAliasCustoId(this._currentCustoViewId))),!this._isCurrentView||e.is(t)&&e.is(t.refresh)||c._displayAlert({message:h.get("SearchDataGridPreferences_modal_typeCusto"),className:"success",widgetId:this.getOption("widgetId")}))}else if(o){var g;if(r.isBETAEnabled()){let e=this.collection._snSkeleton.getWidgetResultViewCusto();g=e?e.customizationId:r.getCustomizationIdToUse(a)}else g=l.getColumnCustomizationIdToUse(a);e.is(g,"string")&&g.length>0&&(this._currentCustoViewId=g,this._applyColumnAttributes(g,this._currentTenant,a,d))}else this._applyColumnAttributes(this._currentCustoViewId,this._currentTenant,a,d);else this._applyColumnAttributes(this._currentCustoViewId,this._currentTenant,a,d)},_applyColumnAttributes:function(e,t,i,n){if(r.isBETAEnabled())if(!n||"Datagrid"!==n.customizedViews&&"all views"!==n.customizedViews)if(n&&!0===n.isDynamicCustomedByUser)this._setColumnAttributes(n.views.Datagrid.general?n.views.Datagrid.general:n.views.Datagrid);else{let e=r.getCustomizationIdToUse(i);this._setColumnAttributes(r.getCustomizationDefinitionFromCustoId(e,t,i,n))}else this._setColumnAttributes(r.getCustomizationDefinitionFromCustoId(e,t,i,n));else this._setColumnAttributes(l.getColumnCustomizationDefinitionFromCustoId(e,t))},_comptuteNewColumnsNLS:function(){for(var t=this,n=[],o=0,a=this._columnsAttributes.length;o<a;o++)n.push(this._columnsAttributes[o].dataIndex);var r="";if(e.is(t.collection)&&e.is(t.collection.search_ressources)&&e.is(t.collection.search_ressources.getActiveTenant,"function")&&(r=t.collection.search_ressources.getActiveTenant()),n.length>0){var l=n.join(",");_.getResourcesInfo(l,{tenantId:r,lang:s.getLanguage(),apiVersion:"R2019x",onComplete:function(n){if(i.log("New Col NLS",n),!e.is(n))return i.error("Unexpected response from getResourcesInfo !"),null;for(var s=!1,o=0,a=t._columnsAttributes.length;o<a;o++)for(var r=0,l=n.length;r<l;r++){if(!e.is(n[r].curi)||!e.is(n[r].label))return i.error("Unexpected response from getResourcesInfo !"),null;n[r].curi===t._columnsAttributes[o].dataIndex&&t._columnsAttributes[o].text!==n[r].label&&("ds6wg:_displayName_"===t._columnsAttributes[o].dataIndex?t._columnsAttributes[o].text=h.get("Display_Name_Column_Title"):t._columnsAttributes[o].text=n[r].label,s=!0)}s&&t._updateColumnsNLS()},onFailure:function(){i.warn("not able to load predicates")}})}},_retrieveNewNLSSuccess:function(t){if(!e.is(t.classPredicates))return i.error("Unexpected response from GetRelevantPredicates !"),null;for(var n=!1,s=0,a=this._columnsAttributes.length;s<a;s++)if(this._columnsAttributes[s].dataIndex.startsWith("ds6wg:"))for(var r=0,l=t.classPredicates.length;r<l;r++){if(!e.is(t.classPredicates[r].className)||!e.is(t.classPredicates[r].vocabularyPredicateInfo))return i.error("Unexpected response from GetRelevantPredicates !"),null;for(var c=0,d=t.classPredicates[r].vocabularyPredicateInfo.length;c<d;c++)t.classPredicates[r].vocabularyPredicateInfo[c].uri===this._columnsAttributes[s].dataIndex&&(this._columnsAttributes[s].text!==t.classPredicates[r].vocabularyPredicateInfo[c].nlsName&&(this._columnsAttributes[s].text=t.classPredicates[r].vocabularyPredicateInfo[c].nlsName,n=!0),c=d,r=l)}var u={};for(let t=0,i=this._columnsAttributes.length;t<i;t++)e.is(u[this._columnsAttributes[t].text])||(u[this._columnsAttributes[t].text]=0),u[this._columnsAttributes[t].text]+=1;for(let t=0,i=this._columnsAttributes.length;t<i;t++)e.is(u[this._columnsAttributes[t].text])&&u[this._columnsAttributes[t].text]>1&&(this._columnsAttributes[t].text+=" ("+(e.is(this._columnsAttributes[t].dataType)?this._columnsAttributes[t].dataType:e.is(this._columnsAttributes[t].dataIndex)?this._columnsAttributes[t].dataIndex:t)+")",n=!0);!0===n&&(o.commit(),this._updateColumnsNLS())},_updateColumnsNLS:function(){if(e.is(this.view)){for(var t=0;t<this._columnsAttributes.length;t++)for(var i=0;i<this.view.columns.length;i++)this._columnsAttributes[t].dataIndex===this.view.columns[i].dataIndex&&(this.view.columns[i].text=this._columnsAttributes[t].text);this.view._applyColumns(),this.view.layout.applyColumns()}},getMinNumberModel:function(e){return e=e||this._rowMaxNumber},onSearch:function(t){e.is(this.view)&&(e.is(this.collection)&&e.is(this.collection.service_parameters)&&e.is(this.collection.service_parameters.query)&&s.SearchTypeEnum.MY_RECENT_CONTENT===this.collection.service_parameters.query?this.view.setSortMode3dSearch(!1):this.view.setSortMode3dSearch(!0)),this._parent(t),this.view&&this.view.resetScrollPosition(),e.is(this.colCustoPanel)&&e.is(this.colCustoPanel._requestClosePanel,"function")&&this.colCustoPanel._requestClosePanel(),this.colCustoPanel=null,this._reinitColums(t)},_updateColumns:function(t,i,s,a){if(Array.isArray(t)&&this._searchcom_socket&&(this._searchcom_socket.dispatchEvent("checkNewColomnForSort",t),!e.is(this.view.sortModel)||e.is(this.view.sortModel[0])&&"relevance"===this.view.sortModel[0].dataIndex))if(e.is(o.getItem("searchSort"))){let e=o.getItem("searchSort");this.collection.setGlobalOrder(e.order_field,e.order_by,e.order_type,e.order_index)}else if(n.getOption("default_sort")){var l=n.getOption("default_sort");e.is(l,"object")&&e.is(l.order_by,"string")&&e.is(l.order_field,"string")&&this.collection.setGlobalOrder(l.order_field,l.order_by,l.order_type)}else n.getOption("apply_sort_on_modified_by_default")?this.collection.setGlobalOrder("ds6w:modified","desc","num",""):this.collection.setGlobalOrder("","");var u,g="",p="",_=!1;e.is(i,"string")?(g=i,p=i):e.is(i,"object")&&(g=i.custoName,u=i.custoNLS,p=i.custoId,e.is(i.favPQ)&&!0===i.favPQ&&(_=!0)),this._currentCustoViewId=p;for(var f=[],m=0,S=(t=d.getCustoCellRequest(t)).length;m<S;m++)if(e.is(t[m],"object")){var v=t[m].dataIndex;f.push(v.slice(v.lastIndexOf("/")+1,v.length))}this.collection.setAttributesToRetrieve(f);var w=o.getItem("DataGridColumnCusto"),b=[];e.is(w)&&(e.is(w.activeView)&&!1===_&&(this._lastSelectedCustoViewId=w.activeView),e.is(w.views)&&(b=w.views));var C=this.getOption("widgetId");if("The_Default_Columns"!==p){if(!0===s){for(var y=b.length-1;y>=0;y--)b[y].viewId===p&&b.splice(y,1);let e={viewId:p,viewDefinition:t,version:2};void 0!==a&&(e.viewDefinitionHidden=a),b.push(e)}var D={views:b};if(!1===_?D.activeView=p:e.is(w)&&e.is(w.activeView)&&(D.activeView=w.activeView),o.setItem("DataGridColumnCusto",D),o.commit(),r.isBETAEnabled()&&r.setActiveCustomizationInLocalStorage(D),!0===s&&"TEMP_CUSTO"!==p)c._displayAlert({message:h.replace(h.get("SearchDataGridPreferences_modal_saveSuccessful"),{custo_name:e.is(u,"string")?u:g}),className:"success",widgetId:C});else if("TEMP_CUSTO"!==p){var I=g;I.endsWith("-ADMIN")&&(I=I.slice(0,-6)),I.startsWith("###")&&(I=h.replace(h.get("custo_PQ"),{PQ:I.substring(3,I.length)})),I.endsWith("-HIDDEN")?c._displayAlert({message:h.get("SearchDataGridPreferences_modal_resetDone"),className:"success",widgetId:C}):c._displayAlert({message:h.replace(h.get("SearchDataGridPreferences_modal_applySuccessful"),{custo_name:I}),className:"success",widgetId:C})}else c._displayAlert({message:h.get("SearchDataGridPreferences_modal_applyTempCustoSuccessful"),className:"success",widgetId:C})}else w=o.getItem("DataGridColumnCusto"),e.is(w)&&(w.activeView="The_Default_Columns"),this._lastSelectedCustoViewId="The_Default_Columns",o.setItem("DataGridColumnCusto",w),o.commit(),r.isBETAEnabled()&&r.setActiveCustomizationInLocalStorage(w),c._displayAlert({message:h.get("SearchDataGridPreferences_modal_resetDone"),className:"success",widgetId:C});this._forcedCustoView=p,this._reloadColumn(t),this._comptuteNewColumnsNLS(),this.collection._snSkeleton._loadFirstPage()},_setColumnAttributes:function(t){!e.is(this._aCustoColumnAttributes[this._currentCustoViewId])&&(this._aCustoColumnAttributes[this._currentCustoViewId]=this._columnsAttributes),this._aCustoColumnAttributes[this._currentCustoViewId]=e.clone(t),this._columnsAttributes=e.clone(t)},updateCustoColumnAttribute:function(e,t){this._aCustoColumnAttributes[e]=t},_reloadColumn:function(t){this._setColumnAttributes(t),this._columns=e.clone(this._columnsAttributes),e.is(this.view)?(this.view.columns=this._retrieveOptions().columns,this.view.setColumns(this.view.columns),this.view._applyColumns()):i.error("[DataGridView] - component grid is not present.")},_openColumnsCustoPanel:function(){if(e.is(this.collection._snSkeleton.getSearchActions,"function")){var t=this.collection._snSkeleton.getSearchActions();e.is(t)&&e.is(t.columnCustomizationDefinitionUI,"function")&&t.columnCustomizationDefinitionUI()}},_setSpecificOptionsToCustoColumns:function(t){for(var i=0;i<t.length;i++)!0===t[i].wrap?(t[i].autoRowHeightFlag=!0,t[i].typeRepresentation="textBlock"):(e.is(t[i].autoRowHeightFlag)&&delete t[i].autoRowHeightFlag,e.is(t[i].typeRepresentation)&&delete t[i].typeRepresentation),t[i].sortableFlag=t[i].isSortable,e.is(t[i].isSortable)&&delete t[i].isSortable,t[i].editableFlag=!1;return t},_retrieveOptions:function(){return d.initColumnsDataGrid({columns:this._setSpecificOptionsToCustoColumns(e.clone(this._columnsAttributes))},{onClickEvent:this._callBackActionMenu,onContextualEvent:this.getOptionCommon().onContextualEvent.callback,onItemTitleClickCallback:this.onItemTitleClick,onDblClickEvent:this._callBackDblClickActionMenu,onItemTitleDblClickCallback:this.onItemDblClick,referer:this,actionsMenuAccessRights:this._getMenuAndLocalActionsStatus(),tabId:this.collection.getSNSkeleton().getOption("observable").getTabID(),tooltipCB:this._tooltipCB,widgetId:this.getOption("widgetId")})},_updateSearchWidgetCurrentCustomization:function(t,i){if(this._currentCustoViewType){const n=new RegExp(this._currentCustoViewType,"i");if(e.is(t.views.Datagrid.type,"array")){for(let e=0;e<t.views.Datagrid.type.length;e++)if(n.test(t.views.Datagrid.type[e].id))return t.views.Datagrid.type[e].viewDefinition=i,t.isDynamicCustomedByUser=!0,void this.collection._snSkeleton.setWidgetResultViewCusto(t)}else e.is(t.views.Datagrid,"array")&&(t.views.Datagrid.general=i,t.isDynamicCustomedByUser=!0,this.collection._snSkeleton.setWidgetResultViewCusto(t))}else e.is(t.views.Datagrid.general,"array")&&(t.views.Datagrid.general=i),t.isDynamicCustomedByUser=!0,this.collection._snSkeleton.setWidgetResultViewCusto(t);this._aCustoColumnAttributes[this._currentCustoViewId]?this._aCustoColumnAttributes[this._currentCustoViewId]=i:this._columnsAttributes=i},render:function(t){this._parent();var a=this,r=()=>a.collection._snSkeleton.getWidgetResultViewCusto()?e.clone(a.collection._snSkeleton.getWidgetResultViewCusto()):{customizationId:"The_Default_Columns",customizedViews:"Datagrid",isDynamicCustomedByUser:!1,views:{Datagrid:{general:[],predefinedQuery:[],type:[]}}};return require(["DS/SNResultUX/views/WebUX/DataGrid/DataGridView"],(function(l){let c="";e.is(a.collection)&&e.is(a.collection.search_ressources)&&e.is(a.collection.search_ressources.getActiveTenant,"function")&&(c=a.collection.search_ressources.getActiveTenant());let d=s.getDictionnaryEntry("useDnDForAllSearchViews");s.isRoleAvailable(["CSV","InternalDS"],c,(function(c){a._reinitColums(a.options),a._defaultColumnDef.allowUnsafeHTMLContent=a.getOptionCommon().allowUnsafeHTMLContent;let u=[];if(e.is(o.getItem("searchSort"))){u=[{dataIndex:o.getItem("searchSort").order_field,sort:o.getItem("searchSort").order_by}];let t=n.getOption("NLSMapping_3DSearch_Sorting_TACTICALOnly");if(e.is(t))for(var p in t)if(t[p]==u[0].dataIndex){u[0].dataIndex=p;break}}a.view=new l({layoutOptions:{addCellCoordinates:s.isODTMode()},treeDocument:a._model,columns:a._retrieveOptions().columns,defaultColumnDef:a._defaultColumnDef,rowSelection:a._canMultiSelect?"multiple":"single",cellSelection:"none",collection:a.collection,pageScrollValueTriggeringInfiniteScroll:a.getOptionCommon().pageScrollValueTriggeringInfiniteScroll,onDragStartCell:a.getOptionCommon().onDragStartCell,onDragEndCell:a.getOptionCommon().onDragEndCellDefault,cellDragEnabledFlag:void 0===d||d,isLoading:!0,onContextualEvent:function(e){return a.view.scrollerPosition=a.view.getScrollerPosition(),e&&e.cellInfos&&-1!==e.cellInfos.rowID?a.getOptionCommon().onContextualEvent.callback(e):e&&e.collectionView?e.collectionView.build3DSearchHeaderColumnContextualMenu(e,a):[]},wrapEventCB:function(t){var i=e.clone(a._aCustoColumnAttributes[a._currentCustoViewId]||a._columnsAttributes),s=-1;for(let e=0;e<i.length;e++)t===i[e].dataIndex&&(s=e);if(e.is(n.getOption("search_datagrid").wrap_standard_fields)){var o=0;for(let e=0;e<i.length;e++)e!==s&&!0===i[e].wrap&&o++;if(o>=n.getOption("search_datagrid").wrap_standard_fields)return void g.modal({title:h.get("SearchDataGridPreferences_modal_information"),content:h.replace(h.get("dataGrid.columnCustoPanel.maxWrapSize"),{number:n.getOption("search_datagrid").wrap_standard_fields}),CB:[{buttonKind:"ok",label:h.get("SearchDataGridPreferences_modal_apply")}]})}i[s].wrap=!e.is(i[s].wrap,"boolean")||!i[s].wrap,a._updateSearchWidgetCurrentCustomization(r(),e.clone(i)),a._reloadColumn(e.clone(i)),a.collection._snSkeleton._loadFirstPage()},visibleEventCB:function(t){for(var i=e.clone(a._aCustoColumnAttributes[a._currentCustoViewId]||a._columnsAttributes),n=-1,s=0;s<i.length;s++)t===i[s].dataIndex&&(n=s);i[n].visibleFlag=!(-1===n||!e.is(i[n].visibleFlag,"boolean"))&&!i[n].visibleFlag,a._updateSearchWidgetCurrentCustomization(r(),i)},pinEventCB:function(t,i){var n=e.clone(a._aCustoColumnAttributes[a._currentCustoViewId]||a._columnsAttributes);-1!==t&&(n[t].pinned=void 0===i?"center":i),a._updateSearchWidgetCurrentCustomization(r(),n)},onColumnWidthUpdate:function(t,n){let s=a._aCustoColumnAttributes[a._currentCustoViewId]||a._columnsAttributes,r=a.view.columns[t].dataIndex;if(e.is(r)&&e.is(localStorage)){let t={},l=o.getItem("listColumnsWidth");if(e.is(l,"string")&&l.length>0)try{let e=JSON.parse(l);for(let i=0;i<Object.keys(e).length;i++)t[Object.keys(e)[i]]=e[Object.keys(e)[i]]}catch(e){i.log(e)}let c=0,d=!1;for(i.log(s,r,n);!d&&c<s.length;)s[c].dataIndex===r&&(d=!0,s[c].width=n),c++;t[r]=n,o.setItem("listColumnsWidth",JSON.stringify(t)),o.commit(),a.toUpdateColWidth=!0}},dblClickEventCB:function(e){a.onItemDblClick(e)},onSelectAllCB:function(){a.selectAll()},onUnselectAllCB:function(){a.unSelectAll()},getCellTooltip:function(e){return a._tooltipCB(e,a)},sortModel:u,bDisableMenuCustoView:!c,sortOptions:{maxSortedColumnsCount:1},pointerUPCB:function(){if(!e.is(a.toUpdateColWidth)||!1===a.toUpdateColWidth)return;let t=a._aCustoColumnAttributes[a._currentCustoViewId]||a._columnsAttributes;a._updateSearchWidgetCurrentCustomization(r(),t),a.toUpdateColWidth=!1,i.log("pointerUPCB",t)},onDropColumnHeader:function(t,i){console.log(i,this.layout._balancedColumnTree);let n=e.clone(a._aCustoColumnAttributes[a._currentCustoViewId]||a._columnsAttributes),s=[];for(let e=0;e<this.layout._balancedColumnTree.length;e++)for(let t=0;t<n.length;t++)if(this.layout._balancedColumnTree[e].dataIndex===n[t].dataIndex){s.push(n[t]);break}a._updateSearchWidgetCurrentCustomization(r(),s)}}),a.view.onReady((()=>{a._afterRender(t),a.view.reselectXSOElements()})),a.view.inject(a.container)}))})),this},_initializeIdentifier:function(){return e.is(o.getLocalStorageItem(this.IDENTIFIER))||o.setLocalStorageItem(this.IDENTIFIER,(Date.now()/1e3|0)+Math.floor(1e6*Math.random()+1)),o.getLocalStorageItem(this.IDENTIFIER)},_tooltipCB:function(t,i){return t&&t.nodeModel&&t.nodeModel.options&&t.nodeModel.options.customTooltip?t.nodeModel.options.customTooltip:{getAllInformationCB:function(){var s="";if(t.isHeader&&e.is(t.manager.options.columns[t.virtualColumnID]))s=t.manager.options.columns[t.virtualColumnID].text;else if(!0===n.getOption("webUXTooltip")){if(e.is(t.nodeModel)&&e.is(t.nodeModel._options)&&e.is(t.nodeModel._options.customTooltip))return t.nodeModel._options.customTooltip}else e.is(t.cellModel)&&(s=0===t.columnID&&e.is(i.view)&&e.is(t.nodeModel)&&i.view.getColumns()[0]?t.nodeModel._options._attributes[i.view.getColumns()[t.columnID].dataIndex]:t.cellModel);return s||(s=""),{model:{shortHelp:s=(s=s.replace('<span class="highlightedSearchCriteria">',"")).replace("</span>","")},updateModel:!1}}}},_afterRender:function(){if(this.view.showNodeKPIColorFlag=!0,this.view.afterRender&&this.view.afterRender(this),this._model.search_multiselMode?this.toggleMultiSelMode(!0):this.toggleMultiSelMode(!1),this.collection.getRequestCriteria().service_params&&this.collection.getRequestCriteria().service_params.adv_search){var t=e.is(this.getOption("advSearchMgr"),"function")?this.getOption("advSearchMgr").call():null;if(e.is(t)){t.getAndDisplayAdvancedSearch(!1)}}this._updateAfterCollectionSync(),this._parent();var i=[],n=[];for(var s in this._columnsAttributes)e.is(this._columnsAttributes[s].defaultSort)&&"none"!==this._columnsAttributes[s].defaultSort&&(i.push(this._columnsAttributes[s].dataIndex),n.push(this._columnsAttributes[s].defaultSort));if(i.length>0){var o=this.collection._snSkeleton.getOption("observable");e.is(o)&&(this.collection.setGlobalOrder(i,n),o.sortPanelView.setOrderByExtExplicit({order_field:i,order_by:n,order_type:[],id:"multisort-group",className:"fonticon fonticon-list"}))}},_destroyView:function(){return e.is(this.view)&&e.is(this.view.destroy,"function")&&this.view.destroy(),this},destroy:function(){this._destroyView()._parent()}})})),define("DS/SNResultUX/views/utils/SearchGridScrollView",["UWA/Core","UWA/Class/Options","UWA/Class/Listener","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchCom","DS/SNResultUX/utils/SearchServices","DS/W3DXComponents/Views/Layout/GridScrollView","DS/WebappsUtils/Performance"],(function(e,t,i,n,s,o,a,r){"use strict";return a.extend(t,i,{name:"search-grid_view",_searchcom_socket:null,init:function(t){this._parent(t),e.is(this._searchcom_socket)||(this._searchcom_socket=s.createSocket({socket_id:"search_skeleton_"+r.now()})),this._searchcom_socket.addListener("onSelectShift",this.onSelectShiftCallback.bind(this))},onSelectShiftCallback:function(e){n.log("DS/SNResultUX/views/utils/SearchGridScrollView onSelectShiftCallback");var t=-1,i=-1,s=this.collection.find((function(t){return t.get("id")===e[0].id}));t=this.collection.indexOf(s);var a=this.collection.find((function(t){return t.get("id")===e[1].id})),r=null;(i=this.collection.indexOf(a))<t&&(r=i,i=t,t=r),-1===t||-1===i||o.isEqualPreviousSlice(t,i)||(o.setPreviousSlice(t,i),this.dispatchEvent("onItemViewCheck",[null,this.collection.slice(t+1,i)]),this.collection._snSkeleton&&(this.collection._snSkeleton._shiftTransaction=!1))}})})),define("DS/SNResultUX/views/helpers/SearchMapView",["DS/SNResultUX/views/helpers/Abstract","UWA/Core","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/SNResultUX/views/utils/EmptyView","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],(function(e,t,i,n,s,o){"use strict";return e.extend({className:"SearchMapView",attributes:{styles:{width:"100%"},"data-rec-id":"SearchMapView",id:"SearchMapView"},bShowTooltip:!1,_searchGlobe:null,_divGlobe:null,_divLargeTile:null,_DockingElement:null,_collapser:null,_icon:null,init:function(e){this._searchGlobe=null,this._DockingElement=null,this._divGlobe=null,this._divLargeTile=null,this._collapser=null,this._icon=null,this._parent(e),this.bShowTooltip=!!t.is(i.getOption("webUXTooltip"))&&i.getOption("showTooltip"),this.neverCheckbox=!!t.is(i.getOption("neverCheckbox"))&&i.getOption("neverCheckbox"),this.neverAction=!!t.is(i.getOption("neverAction"))&&i.getOption("neverAction")},onSearch:function(e){this._parent(e)},getMinNumberModel:function(e){return e||this._rowMaxNumber},setup:function(e){this._parent(e),this.listenTo(this.collection,{onAdd:function(){},onRemove:function(){},onSort:function(){},onAnyEvent:function(){},onReset:function(){},onSync:function(){}})},destroy:function(){t.is(this.view)&&t.is(this.view.destroy,"function")&&this.view.destroy(),t.is(this._DockingElement)&&t.is(this._DockingElement.destroy,"function")&&(this._DockingElement.removeEventListener("collapse",this._collapse.bind(this)),this._DockingElement.removeEventListener("expand",this._expand.bind(this)),this._DockingElement.destroy()),t.is(this.getSNResultMgt().getRefineHelpers().globeViewContainerContent)&&(this.getSNResultMgt().getRefineHelpers().globeViewContainerContent.destroy(),this.getSNResultMgt().getRefineHelpers().globeViewContainerContent=null),this._parent()},_onPostCellRequest:function(e){var i=e.cellView;null!==(t.is(e.virtualCellID)?e.virtualCellID:t.is(e.cellID)?e.cellID:null)&&t.is(i.contentView)&&t.is(i.contentView.setPictureBackgroundSize,"function")&&i.contentView.setPictureBackgroundSize("contain")},render:function(){this.log("SearchMapView render");var e=this;let s="SearchMapView-Globe",o="SearchMapView-LargeTile";if(0===["iphone"].indexOf(n.getDeviceCategory())){s="SearchMapView-Globe-mobile",o="SearchMapView-LargeTile-mobile",e._divLargeTile=t.createElement("div",{class:o,id:o});let i=document.body.getDimensions();if(t.is(i)){let t=i.width;e._createDockingElement(t)}}else e._divLargeTile=t.createElement("div",{class:o,id:o}).inject(e.container);return require(["DS/SNResultUX/views/WebUX/CollectionView/ResponsiveLargeTextualTilesCollectionView","DS/SNResultUX/views/helpers/utils/GlobeView"],(function(n,s){var o=e.getOptionCommon();o.height="inherit",o.displayedOptionalCellProperties=["contextualMenu","description"],e.view=new n(o),e.view.layout.gutter=10;var a=e._canMultiSelect;e.view.selectionBehavior.toggle=a,e.view.selectionBehavior.canMultiSelect=a,e.view.selectionBehavior.canInteractiveMultiselectWithCheckboxClick=a,e.view.selectionBehavior.enableShiftSelection=a,e.view.selectionBehavior.enableFeedbackForActiveCell=a,!0===e.neverCheckbox&&(e.view.visibilityFlag=!1),e.view.onCellDoubleClick((function(t){e.onItemDblClick(t.cellModel)})),t.is(e._simpleSearch)&&!0===e._simpleSearch&&t.is(e.view.onCellTitleClick,"function")&&e.view.onCellTitleClick((function(t){e.onItemTitleClick(t.cellModel)})),e.view.onContextualEvent=o.onContextualEvent,e.view.displayTitleTooltip=e.bShowTooltip,e.view.getContent().inject(e.container),e._model.search_multiselMode&&e.toggleMultiSelMode(!0),e.view.onInfiniteScroll((function(t){e.onInfiniteScrollAsync(t,(function(){e.view.infiniteScrollProcessDone()}))})),e.view.onEndResizeOrOnReadyModelRequest&&e.view.onEndResizeOrOnReadyModelRequest((function(t){e.onResizeOrFirstLoaded(t,(function(){e.view.EndResizeOrOnReadyModelRequestDone()}))})),e.view.getContent().inject(e._divLargeTile);var r={parentContainer:e.getSNResultMgt().getRefineHelpers().globeViewContainer,use2D:!1,collection:e.collection,globe:!i.getOption("SearchLeaflet")};e.getSNResultMgt().getRefineHelpers().getRefineHelpers().globeViewContainerContent=new s(r),e.getSNResultMgt().getRefineHelpers().getRefineHelpers().globeViewContainerContent.render(r),e._afterRender(),e.onSearch(),e.getSNResultMgt().getRefineHelpers().showGlobeView()})),this},showEmptyView:function(){if(!t.is(this._emptyView)){var e=this.getOption("itemViewOptions");this._emptyView=new s(e)}var i=t.extendElement(this.container.querySelector(".SearchMapView-LargeTile")),a=this._emptyView.render();if(t.is(a)&&t.is(i)){a.inject(i);let e=t.extendElement(this.container.querySelector(".wux-layout-largetilecollectionView"));if(t.is(e)&&e.setStyle("display","none"),this._emptyView.show(),t.is(a.container)&&t.is(a.container.getText,"function")){var r=a.container.getText();if(t.is(r)&&0===r.indexOf(n.constructEmptyViewMsg(o.get("no_result")))){t.is(this.collection)&&t.is(this.collection._snSkeleton)&&t.is(this.collection._snSkeleton._skeleton)&&t.is(this.collection._snSkeleton._skeleton.container)&&t.is(this.collection._snSkeleton._skeleton.container.getElement,"function")&&this.collection._snSkeleton._skeleton.container.getElement(".search-content-set-header")}}}},hideEmptyView:function(){this._parent.apply(this,arguments);let e=t.extendElement(this.container.querySelector(".wux-layout-largetilecollectionView"));t.is(e)&&e.setStyle("display","inline-block")},onItemSelected:function(e){let i=this;if(i._parent.apply(this,arguments),t.is(i.getSNResultMgt().getRefineHelpers().globeViewContainerContent)&&t.is(i._divGlobe)&&"none"!==i._divGlobe.getStyle("display")){let n=e._options;if(t.is(n)){let e=n._attributes["ds6w:responsible"];t.is(e)&&i.getSNResultMgt().getRefineHelpers().globeViewContainerContent.displayCountryByUser(e)}}},_createDockingElement:function(e){var i=this;null===i._DockingElement?require(["DS/Windows/DockingElement"],(function(e){let n=WUXDockAreaEnum.BottomDockArea,s=i._getHeightWidth(i.container,"height")-100,o=s;i._DockingElement=new e({side:n,dockingZoneSize:s,minSize:o,useBordersFlag:!0,collapsibleFlag:!0,visibleDockingZoneFlag:!0,resizableFlag:!1,dockingZoneContent:i._divLargeTile,freeZoneContent:i._divGlobe,collapseDockingZoneFlag:!0}),i._DockingElement.inject(i.container),i._DockingElement.addEventListener("collapse",i._collapse.bind(i)),i._DockingElement.addEventListener("expand",i._expand.bind(i)),i._collapser=i._DockingElement.elements.collapser,i._collapser.setAttribute("bottom","true");let a=t.createElement("div",{class:"globe-collapser-icon"});i._icon=t.createElement("span",{class:"fonticon fonticon-chevron-up"}),i._icon.inject(a),a.inject(i._collapser)})):(i._collapser&&i._collapser.setStyle("display","flex"),i._DockingElement.visibleDockingZoneFlag=!0)},_getHeightWidth:function(e,t){return e.getDimensions()[t]},_expand:function(e){var i=this;t.is(i.getSNResultMgt().getRefineHelpers().globeViewContainerContent)&&i.getSNResultMgt().getRefineHelpers().globeViewContainerContent._updateUI(),i._icon&&(i._icon.removeClassName("fonticon fonticon-chevron-up"),i._icon.addClassName("fonticon fonticon-chevron-down "))},_collapse:function(e){var i=this;t.is(i.getSNResultMgt().getRefineHelpers().globeViewContainerContent)&&i.getSNResultMgt().getRefineHelpers().globeViewContainerContent._updateUI(),i._icon&&(i._icon.removeClassName("fonticon fonticon-chevron-down"),i._icon.addClassName("fonticon fonticon-chevron-up "))}})})),define("DS/SNResultUX/utils/SearchMultiSort",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Options","UWA/Class/Events","UWA/Element","DS/UIKIT/Input/Button","DS/UIKIT/Input/Select","DS/UIKIT/Tooltip","DS/SNInfraUX/Logger","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchSettings","DS/SNResultUX/utils/SearchCustoServices","DS/Windows/Dialog","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],(function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_){"use strict";var f=t.extend(s,i,n,{_select:null,_divCombo:null,_selection:null,_sort:null,_data:[],_props:null,init:function(e){this._props=e,this._data=e.data,this._selection=e.value;for(var t=0;t<this._data.length;t++)this._data[t].selected=this._data[t].value===this._selection;return this._sort=e.order,this._parent(e)},getValue:function(){return this._selection},getOrder:function(){return this._sort},render:function(){this._divCombo=o.create("div",{class:"multisort-div sort"+this._props.index}),this._divCombo.inject(this._props.domReferer),this._renderSelect(this._divCombo)},_renderSelect:function(e){var t=this;this._select=new r({nativeSelect:!0,id:"search-multi-sort-combo-"+this._props.index,placeholder:_.get("searchMultiSel.comboPlaceHolder."+(0===this._props.index?"first":"next")),events:{onChange:function(){""===this.getValue()[0]?(t._selection=null,t._sort=null):t._selection=this.getValue()[0],t._renderSortButtons(t._selection,e),c.log("combo : "+t._selection)}}}),this._select.inject(e),this._select.add(this._props.data)},_renderSortButtons:function(e,t){var i=document.getElementById("SearchMultiSort-buttons"+this._props.index);i&&i.parentNode.removeChild(i);var n=o.create("div",{id:"SearchMultiSort-buttons"+this._props.index,class:"item-text item-icon-group sort"+this._props.index});n.inject(t),g.DEFAULT_FIELDS[e]?this["_renderSpan"+g.DEFAULT_FIELDS[e].toUpperCase()](n):this._renderSpanALPHA(n)},_renderSpanNUM:function(e){this._renderSpanCOMMON("num",e)},_renderSpanALPHA:function(e){this._renderSpanCOMMON("alpha",e)},_renderSpanCOMMON:function(e,t){var i=this;null===this._sort&&(this._sort="asc");var n=o.create("span",{title:"Ascending",order:"asc",class:"fonticon fonticon-sort-"+e+"-asc"+("asc"===this._sort?" "+g.SORT_ACTIVATED_CSS:"")}),s=o.create("span",{title:"Descending",order:"desc",class:"fonticon fonticon-sort-"+e+"-desc"+("desc"===this._sort?" "+g.SORT_ACTIVATED_CSS:"")});n.inject(t),s.inject(t),n.onclick=function(){i._sort="asc",n.classList.add(g.SORT_ACTIVATED_CSS),s.classList.remove(g.SORT_ACTIVATED_CSS)},s.onclick=function(){i._sort="desc",s.classList.add(g.SORT_ACTIVATED_CSS),n.classList.remove(g.SORT_ACTIVATED_CSS)}},_renderSpanGROUP:function(e){this._sort="asc",o.create("span",{title:"Grouping",order:"asc",class:"fonticon fonticon-tag-sorting "+g.SORT_ACTIVATED_CSS}).inject(e)},destroy:function(){e.is(this._select)&&this._select.destroy(),e.is(this._divCombo)&&e.is(this._divCombo.parentNode)&&this._divCombo.parentNode.removeChild(this._divCombo),this._parent()}});return t.extend(s,i,n,{_options:null,_dialog:null,_availableFields:{},_zIndexToUse:0,_divCombo:null,_divComboSelect:[],_divButton:[],_dataIndex:[],_order:[],getMaxMultiSortNb:function(){var t=h.getOption("search_datagrid");return e.is(t.multisort_standard_fields)?t.multisort_standard_fields:3},init:function(e){return c.groupCollapsed("SearchMultiSort"),c.log("options:",e),this._options=e,c.log(e._availableFields),this._availableFields=this._parseAvailableFields(e._availableFields),e._dataIndex&&(this._dataIndex=e._dataIndex),e._order&&(this._order=e._order),this._reinitDialog(),c.groupEnd(),this._parent(e)},_parseAvailableFields:function(e){for(var t=[],i=0;i<e.length;i++)t.push({label:d.getNLSValueForPredicate(e[i].dataIndex),selected:!1,value:e[i].dataIndex});return t},_reinitDialog:function(){this._destroyEmbeddedObjects(),this._buildDialog()},_buildDialog:function(){for(var t=this,i=o.create("div",{class:"global-multisort-div"}),n=this.getMaxMultiSortNb(),s=0;s<n;s++)this._divComboSelect.push(new f({index:s,data:this._availableFields,domReferer:i,value:this._dataIndex[s],order:this._order[s]})),this._divComboSelect[this._divComboSelect.length-1].render();this._dialog=new p({identifier:"search-multi-sort",title:_.get("searchMultiSel.dialog.title"),content:i,resizableFlag:!0,position:{at:"bottom",of:e.is(this._options._parentContainer)?this._options._parentContainer:null,collision:"fit",offsetX:-900,offsetY:200},minHeight:100,minWidth:550});var a=parseInt(e.is(this._options._parentContainer)?u.getZIndex(this._options._parentContainer):0)+1;(this._dialog.elements.container.setStyle("z-index",a),this._dialog.elements.container.addClassName("search-column-custo-dialog"),this._dialog.inject(document.body),e.is(this._dialog.elements)&&e.is(this._dialog.elements._closeButton))&&(new l({target:t._dialog.elements._closeButton,body:_.get("custo_close.tooltip")}).getContent().style.zIndex=this._zIndexToUse+2);this._buildDialogFooter(i),this._dialog.addEventListener("close",(function(){t._dialog=null,t.dispatchEvent("onCloseMultisortPanel")}))},_buildDialogFooter:function(t){var i=this,n=o.create("div",{class:"multisort-div footer"});n.inject(t),this._divButton[0]=new a({value:_.get("searchMultiSel.dialog.valid"),className:"primary save-button",id:"search_multisort_btn_valid",events:{onClick:function(){c.log("Click on OK multisort");for(var t=[],n=[],s=0;s<i._divComboSelect.length;s++)null!==i._divComboSelect[s].getValue()&&t.push(i._divComboSelect[s].getValue())&&n.push(i._divComboSelect[s].getOrder());c.log("Multisort params",t,n),e.is(i._options.sortCallback,"function")&&i._options.sortCallback(t,n),i.destroy()}}}).inject(n),this._divButton[1]=new a({value:_.get("searchMultiSel.dialog.cancel"),className:"primary apply-button",id:"search_multisort_btn_cancel",events:{onClick:function(){c.log("Click on cancel multisort"),i.destroy()}}}).inject(n)},_destroyEmbeddedObjects:function(){var t=0;for(t=0;t<this._divComboSelect.length;t++)this._divComboSelect[t].destroy();for(this._divComboSelect=[],t=0;t<this._divButton.length;t++)this._divButton[t].destroy();this._divButton=[],e.is(this._dialog)&&e.is(this._dialog.close,"function")&&(this._dialog.close(),this._dialog=null)},destroy:function(){this._destroyEmbeddedObjects(),this._sort=[],this._dataIndex=[],this._order=[],this._parent()}})})),define("DS/SNResultUX/views/helpers/SearchMyContentView",["DS/SNResultUX/views/helpers/utils/AbstractMultiView","UWA/Core","DS/SNInfraUX/Logger","DS/TreeModel/TreeDocument","DS/Utilities/Utils","DS/SNInfraUX/SearchUtils","DS/SNResultUX/views/helpers/utils/SearchMultiViewUtils","DS/MessageBus/MessageBus","DS/PubSub/PubSub","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchPreferences","DS/SNResultUX/utils/ResultCategoryUXHelper","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","i18n!DS/SNInfraUX/assets/nls/SNInfraUX.json"],(function(e,t,i,n,s,o,a,r,l,c,d,u,h,g){"use strict";return e.extend({setup:function(e){e.bInitListeners=!1,this._parent(e),this._initCollectionListener(e)},_initCollectionListener:function(e){let n=this;this.listenTo(this.collection,{onAdd:function(){},onRemove:function(){},onSort:function(){},onAnyEvent:function(){},onReset:function(){},onSync:function(){},onSetTags:function(e){},onInitTreeDocumentAsyncCB:function(e){i.log("AbstractMultiView onInitTreeDocumentAsyncCB Event",e),n._lastlocalFilters=n._getLocalFilters(),n._computeDisplay()},OnGroupingChange:function(e){i.log("AbstractMultiView OnGroupingChange Event",e),n._viewAllProvide=!1,n._refreshViewFromOnGrouping(e),n.hideEmptyView()},onInitTreeDocument_SelectFirstElt:function(){i.log("AbstractMultiView onInitTreeDocument_SelectFirstElt Event",e);let s=n.getCurrentViewId();if(s===n.getViewId()){let i=n.collection.getTaggerProxy(),o=i.getCurrentFilter();!0===a.IfLastRefineisInTheGoodW(s,i,n._lastlocalFilters)&&t.is(o)&&t.is(o.localFilters)&&t.is(o.localfilters.condition,"array")&&o.localfilters.condition.length>0?(i.clearLocalGrouping(),n.collection.getSNSkeleton()&&n.collection.getSNSkeleton().switchOnView(d.getItem("LastSearchViewMode"))):n._refreshViewFromOnGrouping(e)}}})},_loadViews:function(e){let u=this;require(["DS/SNResultUX/views/WebUX/CollectionView/ResponsiveLargeTextualTilesCollectionView","DS/SNResultUX/views/WebUX/CollectionView/ResponsiveLargeTilesCollectionView","DS/SNResultUX/views/WebUX/CollectionView/ResponsiveThumbnailsCollectionView","DS/SNResultUX/views/WebUX/CollectionView/ResponsiveTilesCollectionView","DS/SNResultUX/views/WebUX/DataGrid/DataGridView"],(function(p,_,f,m,S){let v=u.getOptionCommon();v.height="inherit",v.displayedOptionalCellProperties=["contextualMenu","description"],v.clickSignatureItemCB=(e,t,i)=>{u.onItemSignatureClick(e,t,i)};let w=u.collection.getSNSkeleton()&&u.collection.getSNSkeleton().getSearchWidget(),b=t.is(w)?w.body:t.extendElement(document.body).getElement(".onesearch_results");for(let w=e;w<u.collections.length;w++){let e=u.collections[w];try{let i={...v},y=new n({useAsyncPreExpand:!0,shouldAcceptDrag:function(){return!0},shouldAcceptDrop:function(){return!1}});u.collection.generateTreeModelAsync(e._models,y),i.model=y,i.collection=e,e.setTaggerProxy(u.collection.getTaggerProxy()),e._treeDocument=y;var C={};e.headTitle===h.get("myRecentContentTitle")&&"myContent"===u.id&&(C.isRecentContent=!0,C.accessRecentContent=function(e){u._unselectAllButMe(),l.dispatch("search:onSearch",{adv_search:!1,recent_filter:"*",refresh:!0,search_criteria:"#myRecentContent",search_mode:"index",tag_filter:"",tabID:u.collection.getSNSkeleton()?u.collection.getSNSkeleton().getOption("observable").getTabID():void 0,widgetID:u.getOption("widgetId")})}),C.onclick=()=>{e.headTitle===h.get("myContentTitle")&&"myContent"===u.id&&(r.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"clickOnViewMore",persDim:{pd1:"0"}}}),u._unselectAllButMe(),l.dispatch("search:onSearch",{adv_search:!1,recent_filter:"*",refresh:!0,search_criteria:"#myContent",search_mode:"index",tag_filter:"",allMyContent:!0,tabID:u.collection.getSNSkeleton()?u.collection.getSNSkeleton().getOption("observable").getTabID():void 0,widgetID:u.getOption("widgetId")}))},a.createSearchMultiViewLabel(e,u.id,C).inject(u.multiViewContainer);let D="tile";void 0!==d.getItem("LastSearchViewMode")&&(D=d.getItem("LastSearchViewMode"));let I=t.is(D)?D:"tile",T={model:i.model,type:I,tag:w};if(-1!==e.totalCount){if(!t.is(C.isRecentContent)||!0!==C.isRecentContent)switch(D){case"thumbnail":i.displayedOptionalCellProperties=["contextualMenu"],T.view=u._instantiateResponsiveCollection(f,i,w),T.view.onPostCellRequest&&T.view.onPostCellRequest((e=>{let i=e.cellView;t.is(i)&&t.is(i.contentView)&&t.is(i.contentView.setPictureBackgroundSize,"function")&&i.contentView.setPictureBackgroundSize("auto")}));break;case"largeTile":case"tilebig":T.view=u._instantiateResponsiveCollection(_,i,w);break;case"textual":case"largeTextual":T.view=u._instantiateResponsiveCollection(p,i,w);break;case"tile":T.view=u._instantiateResponsiveCollection(m,i,w);break;case"list":case"table":case"datagrid":T.view=u._instantiateDataGrid(S,i,w,e);break;default:throw new Error("[MultiView] - incorrect view model given.")}T.view&&T.view.onReady((()=>{u.setPoolMultiViewContainerHeight(u.container.scrollHeight);let i=s.debounce((function(e){T.view.requestDelayedModelData(e)}),1);T.view._updateDimensions(),T.view.invalidateLayout({updateCellContent:!1,updateCellLayout:!0,updateCellAttributes:!1}),T.view._onEndResizeOrOnReadyModelCompletionRequest("OnEndResize"),i("OnResize"),T.view._modelEvents.publish({event:"ENDRESIZE",context:T.view}),!0===c.getOption("search_compact_mode")&&T.view.onPostCellRequest&&T.view.onPostCellRequest((function(e){var i=null;i=e.cellView.elements.container.querySelector(".wux-controls-responsivethumbnailview-menu"),t.is(i)||(i=e.cellView.elements.container.querySelector(".wux-controls-responsivetileview-menu")),t.is(i)||(i=e.cellView.elements.container.querySelector(".wux-controls-responsivetextualtileview-menu")),t.is(i)||(i=e.cellView.elements.container.querySelector(".wux-ui-3ds-open-down"))&&(i.style.display="none",i=void 0),t.is(i)&&i.setAttribute("has-menu","true")})),b&&a.manageDisplayChannelView(e,D,b.getDimensions())})),u.views[w]=T,t.is(D)&&"list"!==D?u.views[w]&&u.views[w].view&&u.views[w].view.getContent()&&u.views[w].view.getContent().inject(u.multiViewContainer):u.views[w]&&u.views[w].view&&u.views[w].view.inject(u.multiViewContainer)}let A=g.get("search.result.view.more");if(A+=o.isMobile()?"":" "+e.headTitle,0===w)continue;let x=t.createElement("div",{class:"search-multi-view-more",content:A});x.inject(u.multiViewContainer),x.onclick=()=>{r.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"clickOnViewMore",persDim:{pd1:"0"}}}),u._unselectAllButMe(),l.dispatch("search:onSearch",{adv_search:!1,recent_filter:"*",refresh:!0,search_criteria:"#myContent",search_mode:"index",tag_filter:"",allMyContent:!0,tabID:u.collection.getSNSkeleton()?u.collection.getSNSkeleton().getOption("observable").getTabID():void 0,widgetID:u.getOption("widgetId")})},e.moreView={label:x,viewType:D},b&&!1===a.ifDisplayViewMore(D,e,b.getDimensions())&&x.setStyle("visibility","hidden")}catch(e){c.getOption("debug")&&i.log(e)}}u.unmask(),u.dispatchEvent("onMultiView",{collections:u.collections})}))},_onInitTreeDocumentAsyncCB:function(e){let n=this;if(!0===this._onGroupingCompute)return;this._emptyViews(),this._resetViews(),this._onGroupingCompute=!0,null!==this.collectionUX&&delete this.collectionUX,c.getOption("debug")&&i.log("MultiView tags retrieved",this.getSNResultMgt()&&this.getSNResultMgt().getEmbeddedTaggerTags());let s=this._getEmbeddedTaggerTags(e);if(void 0!==s){if(t.is(e)&&(this._ComputeGroup=s.computeGroup,s.SearchBack&&1===s.SearchBack))return this.collection.getSNSkeleton()&&this.collection.getSNSkeleton().switchOnView(d.getItem("LastSearchViewMode")),this._refreshViewFromRefine(s),void(this._onGroupingCompute=!1);this.mask(),u.getResultCategoryUXHelper().then((function(){let e=n.collection.service_parameters.originalSearchCriteria;"Favorite Searches"===e&&(e="(owner:"+o.getUserId()+" AND flattenedtaxonomies:types/PLMWspFavoriteSearch) OR flattenedtaxonomies:types/SavedSearch");let a,r={"My Recent Content":"#myRecentContent","My Content":"#myContent"};"myRecentContentTitle"!=h.get("myRecentContentTitle")&&(r[h.get("myRecentContentTitle")]="#myRecentContent"),"myRealContentTitle"!=h.get("myRealContentTitle")&&(r[h.get("myRealContentTitle")]="#myContent"),"myContentTitle"!=h.get("myContentTitle")&&(r[h.get("myContentTitle")]="#myContent"),t.is(n.collection)&&t.is(n.collection.parsed_response)&&t.is(n.collection.parsed_response.getTags())&&(a=n.collection.parsed_response.getTags().summaryData),n.collectionUX=u.getResultsCollections({search_text:r,categories:t.is(s)&&s.Tags,refine:t.is(n.collection.getTaggerProxy())&&n.collection.getTaggerProxy().getCurrentFilter(),facets:a,noFetchWHENCountZero:"when"===n.getCurrentViewId()}),n.collectionUX.getFirstPage({onComplete:function(){let e=n.collectionUX.getCategoryCollectionsList();c.getOption("debug")&&i.log("run",e),n.collections=e,n._loadViews(0),n._onGroupingCompute=!1,n._totalCount=n.collection.totalCount,n.collection&&n.collection.getSNSkeleton().updateCounterView(n._totalCount),t.is(n.collection)&&t.is(n.collection.service_parameters)&&t.is(n.collection.service_parameters.query)&&"#myRecentContent"===n.collection.service_parameters.query&&n._clearTags()},onFailure:function(e){console.log("FAIL",e)}})}))}},_clearTags:function(){this.collection.getTaggerProxy().clearLocalFilter(!1),this.collection.getTaggerProxy().unsetTags()},_computeDisplay:function(){let e=this,n=e.getViewId(),s=e.getCurrentViewId();if("myContent"===s&&t.is(this.getSNResultMgt())&&t.is(this.getSNResultMgt()._search_criteria)&&"#myContent"!==this.getSNResultMgt()._search_criteria&&this.getSNResultMgt().skeleton.switchOnView(d.getItem("LastSearchViewMode")),t.is(e.collection)&&t.is(e.collection.service_parameters)&&t.is(e.collection.service_parameters.query)&&"#myRecentContent"===e.collection.service_parameters.query&&e._clearTags(),!0===a.checkIfRefine(e.collection.getTaggerProxy(),e._getEmbeddedTaggerTags(),s,n))i.log("->MultiView Compute Display do from Refine"),e.collection.getSNSkeleton().switchOnView(d.getItem("LastSearchViewMode")),e._refreshViewFromRefine(e._getEmbeddedTaggerTags(e.getSNResultMgt().getEmbeddedTaggerTags())),e._totalCountSection=this.collection.totalCount,e._RefineFromDropMenu=!0;else{i.groupCollapsed("->MultiView Compute Display clear Refine"),i.log("->MultiView Compute Display all categories view: ",n);let t=e.getSNResultMgt()._getSearchType();("what"!==n&&"who"!==n&&"when"!==n&&"where"!==n||o.SearchTypeEnum.MY_CONTENT===t||o.SearchTypeEnum.FAVORITE_SEARCH===t)&&o.SearchTypeEnum.MY_CONTENT!==t&&o.SearchTypeEnum.FAVORITE_SEARCH!==t||e._refreshViewGrouping()}}})})),define("DS/SNResultUX/views/utils/SearchOptionsUI",["UWA/Class/Debug","UWA/Core","UWA/Controls/Abstract","UWA/Element","UWA/Promise","DS/MessageBus/MessageBus","DS/PubSub/PubSub","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SecurityContextManager","DS/SNInfraUX/SearchPreferences","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Tab","DS/Controls/Button","DS/Controls/Toggle","DS/Controls/ComboBox","DS/Controls/TooltipModel","DS/SNInfraUX/SearchDataSources","DS/UIKIT/Accordion","DS/SNResultUX/utils/SearchServices","DS/SNResultUX/utils/ExternalComponentHelpers","i18n!DS/SNInfraUX/assets/nls/SNInfraUX.json","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","css!DS/SNResultUX/SNResultUX.css","DS/UIKIT/SuperModal"],(function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_,f,m,S,v,w,b,C,y,D,I,T){"use strict";function A(e,i){let n=i;const s=function(i){var o;t.is(e.contains,"function")&&!e.contains(i.target)&&i.target.className.indexOf("wux-layouts-treeview")<0&&i.target.className.indexOf("wux-windows-immersive-frame-no-pointerevents")<0&&i.target.className.indexOf("modal-wrap")<0&&i.target.className.indexOf("modal-content")<0&&i.target.className.indexOf("modal-header")<0&&i.target.className.indexOf("modal-body")<0&&i.target.className.indexOf("modal-footer")<0&&i.target.className.indexOf("WarningReloadPage modal modal-root")<0&&i.target.className.indexOf("btn-default btn btn-root")<0&&null!==i.target.parentNode&&i.target.parentNode.className.indexOf("modal-header")<0&&null!==i.target.parentNode&&i.target.parentNode.className.indexOf("modal-body")<0&&(o=e)&&(o.offsetWidth||o.offsetHeight||o.getClientRects().length)&&(e.style.display="none",document.removeEventListener("click",s),t.is(n)&&t.is(n.destroy,"function")&&(n.destroy(),n=null))};document.addEventListener("click",s)}const x=new Set(["search_tabbed_ui","search_keepColumnSorting","integratedSearch","BETA-FUN109031"]);return i.extend(e,{name:"DS_SNResultUX_SearchOptionsUI",_informationPanel:null,CSVpromise:s.deferred(),_credentialComboBox:null,_revisionObject:null,_revisionTypeComboBox:null,_csvComboBox:null,_listofCSVModeItemsArray:[],_dateModeComboBox:null,_dateModeObject:null,_toggles:[],_textInputs:[],_optionPanel:null,_cChangeDone:!1,_mustReloaded:!1,_applySettings:null,init:function(e){r.groupCollapsed("SearchOptionsUI.init"),r.log("options:",e),this._parent(e),this.snSkeletonMgt=t.is(e)?e.skeletonMgt:null,t.is(this.snSkeletonMgt)&&t.is(this.snSkeletonMgt.getCollection,"function")&&(this.current_collection=this.snSkeletonMgt.getCollection()),this.tenant=t.is(e)?e.tenant:"OnPremise";let i=this._listUISettingsToDisplay();this._initPanel({settingsToDisplay:i}),r.groupEnd()},destroy:function(){r.groupCollapsed("SearchOptionsUI.destroy"),a.dispatch("SearchPopover:destroy"),this._deletePanel(),this._informationPanel=null,this._credentialComboBox=null,this._revisionTypeComboBox=null,this._csvComboBox=null,this._dateModeComboBox=null,this._toggles=null,this._textInputs=null,this._parent(),r.groupEnd()},_initPanel:function(e){let i=e.settingsToDisplay,s=this.tenant,o=this;if(!t.is(this.immersiveFrame)){this.immersiveFrame=new h({reactToPointerEventsFlag:!1});let e=document.body;this.immersiveFrame.inject(e)}let a=n.create("div",{class:"search-options-popover-container"});o._applySettings=new _({domId:"applySettings",label:D.get("APPLYButton"),onClick:function(){let e=new T({renderTo:document.body,className:"WarningReloadPage"});o._optionPanel.disabled=!0,e.confirm(D.get("actions.Options.warning"),D.get("actions.Options.warningTitle"),(function(e){!0===e?o._validateSettings():o._optionPanel.disabled=!1}))}}),this._createPanel(a,o._applySettings),this._tabContainer=new p({reorderFlag:!1,newTabButtonFlag:!1,pinFlag:!1,editableFlag:!1,multiSelFlag:!1,displayStyle:"strip"}),this._tabContainer.inject(a);let g=n.create("div",{class:"search-options-tab search-options-settings"}),m=!1;t.is(this.snSkeletonMgt)&&t.is(this.snSkeletonMgt._onesearch_collection._ctx_options)&&t.is(o.snSkeletonMgt._onesearch_collection._ctx_options.widget_id)&&"widget_id_#saved_search_edit#"===o.snSkeletonMgt._onesearch_collection._ctx_options.widget_id&&(m=!0),t.is(this.snSkeletonMgt)&&t.is(this.snSkeletonMgt.getOption("in_apps_search"),"object")&&(m=!0),m||this._tabContainer.add({label:D.get("actions.Options.generalTab"),content:g,isSelected:!0});let S={},b=c.getAdminSetting(s),C=",";t.is(b)&&t.is(b.defaultCsvSeparator)&&t.is(b.defaultCsvSeparator.id,"string")&&(C=c.getCSVSeparatorValueFromId(s,b.defaultCsvSeparator.id));let y=function(e){let i=e.dsModel,n=!1,s=0,a=o._toggles.length;for(s=0;s<a&&!1===n;s++)S[o._toggles[s].value]!==o._toggles[s].checkFlag&&(n=!0);if(!0===n||!0===o._cChangeDone?o._applySettings.disabled=!1:o._applySettings.disabled=!0,"search_tabbed_ui"===i.value){let e=o._toggles.filter((function(e){return e&&"nav_history"===e.value})).pop();if(e)return void(!0===i.checkFlag?e.disabled=!1:(e.disabled=!0,e.checkFlag=!1))}if("search_double_click_open"===i.value){let e=i.checkFlag;if(!0===l.getOption("search_web_in_win"))return u.setItem("search_double_click_open",e),u.commit(),void(window.hasOwnProperty("sendNotificationWebInWin")&&t.is(sendNotificationWebInWin,"function")&&sendNotificationWebInWin("doubleclickopen",e))}!1===o._applySettings.disabled&&(o._mustReloaded=x.has(i.value))},I=l.getOption("deactivate_FUN108944"),N=t.is(l.getOption("addinmode"),"string")&&l.getOption("addinmode").length>0||!0===l.getOption("addinmode"),E=l.getOption("search_web_in_win");if(!0!==I&&!0!==N&&!0!==E){let e=function(e){let i=e.dsModel,n=!1,s=0,a=o._toggles.length;for(s=0;s<a&&!1===n;s++)S[o._toggles[s].value]!==o._toggles[s].checkFlag&&(n=!0);!0===n||!0===o._cChangeDone?o._applySettings.disabled=!1:o._applySettings.disabled=!0;let r=u.getItem("InstantSearch");r=!t.is(r)||r,i.checkFlag!==r&&(o._applySettings.disabled=!1),!1===o._applySettings.disabled&&(o._mustReloaded=x.has(i.value))},i=u.getItem("InstantSearch");i=!t.is(i)||i;let a=new f({type:"checkbox",value:"InstantSearch",domId:"betaMode",label:D.get("instantSearch.button"),checkFlag:!1});a.disabled=!0;let r="";t.is(s,"string")?r=s:t.is(s)&&t.is(s.tenantId)&&(r=s.tenantId),l.getTenantSettings(r).then((function(){!0===l.getOption("activate_instant_search",{tenant:r})&&(a.disabled=!1,a.checkFlag=i)}));let c=n.create("div",{class:"search_center_general_tab_div search_center_margin",id:"general-tab-betaMode","search-setting-id":"betaMode"}),d=n.create("div",{class:"search_center_div search-setting-title beta_toggle_setting",id:"betaMode"});a.inject(d),a.options={},d.inject(c),c.inject(g),this._toggles.push(a),a.addEventListener("buttonclick",e)}for(let e=0;e<=i.length;e++)if(t.is(i[e])&&t.is(i[e].optionID)&&t.is(i[e].optionLabel))if(S[i[e].optionID]=u.getItem(i[e].optionID),"boolean"!==i[e].optionType||t.is(i[e].father)){if("string"===i[e].optionType){let t=new Text({placeholder:i[e].optionLabel,class:i[e].optionID,id:i[e].optionID,events:{onKeyDown:function(){o._applySettings.disabled=!1}}}).inject(g);o._textInputs.push(t),t.setValue(S[i[e].optionID])}}else{let s=!0;if("integratedSearch"===i[e].optionID&&(s=!1),"BETA-FUN109031"!==i[e].optionID||!0!==E&&!0!==N&&!0!==this._isPinnedWidget()||(s=!1),"supportSynonyms"===i[e].optionID&&(s=!1),!0===s){let s=new f({type:"checkbox",value:i[e].optionID,domId:i[e].optionID,label:i[e].optionLabel,checkFlag:S[i[e].optionID]});t.is(i[e].disable)&&(s.disabled=i[e].disable);let a=n.create("div",{class:"search_center_general_tab_div search_center_margin",id:"general-tab-"+i[e].optionID,"search-setting-id":i[e].optionID}),r=n.create("div",{class:"search_center_div search-setting-title",id:i[e].optionID});s.inject(r),r.inject(a),a.inject(g),o._toggles.push(s),s.addEventListener("buttonclick",y)}}let O=l.getOption("csvSeparatorArray");if(t.is(O)&&O.length>0){o._listofCSVModeItemsArray=[];for(let e=0;e<O.length;e++){let i=O[e];if(t.is(i,"object")&&t.is(i.id,"string")){let t={valueItem:O[e].value,labelItem:D.get("csvSeparatorUI.values."+i.id)};o._listofCSVModeItemsArray.push(t)}else r.error("Bad definition of csvSeparatorArray !!!",O)}o._listofCSVModeItemsArray.length>0&&(this._csvComboBox=o._buildComboOption(g,"csvSeparatorUI",o._listofCSVModeItemsArray,null))}o._dateModeObject=l.getOption("date_display_mode_array");let k=null;if(t.is(o._dateModeObject)&&o._dateModeObject.length>0){let e=[];for(let i=0;i<o._dateModeObject.length;i++){let n=o._dateModeObject[i];t.is(n,"object")&&t.is(n.id,"string")?e.push(D.get(n.id+".title")):r.error("Bad definition of date_display_mode_array !!!",o._dateModeObject)}e.length>0&&(this._dateModeComboBox=o._buildComboOption(g,"Default_Date_Mode",e,null),k=e[0])}let P,M=t.is(s,"string")?s:t.is(s)&&t.is(s.tenantId)?s.tenantId:null;c.isRoleAvailable(["CSV"],M,(function(e){if(!0===e&&(o._revisionObject=l.getOption("show_search_results_revision_array"),t.is(o._revisionObject)&&o._revisionObject.length>0)){let e=[];for(let i=0;i<o._revisionObject.length;i++){let n=o._revisionObject[i];t.is(n,"object")&&t.is(n.id,"string")?e.push(D.get(n.id+".title")):r.error("Bad definition of show_search_results_revision_array !!!",o._revisionObject)}if(e.length>0){let i=u.getItem("revisionDisplayType"),n=l.getOption("defaultRevision",{tenant:M});t.is(i)||(i=n||e[0]),o._revisionTypeComboBox=o._buildComboOption(g,"Show_Search_Results",e,D.get(i.id+".title"))}}})),t.is(this.snSkeletonMgt)&&(P=this.snSkeletonMgt.getOption("addinMode"));let R=c.identifyClientInfo(P);t.is(this.snSkeletonMgt)&&(R=c.identifyClientInfo(o.snSkeletonMgt.getOption("addinMode")));let V,U,L,F=!1;if(t.is(R)&&t.is(R.identifier)&&("3DDashboard"===R.identifier||"3DSwym"===R.identifier)&&(F=!0),t.is(R)&&t.is(R.addinmode)&&"catiav5"===R.addinmode&&(F=!0),l.getOption("global_action_credentials")&&!0===F&&(this.divOptions=g,d.getSecurityContextPromise(c.getActiveTenant()).then((function(e){o._SecurityContextMngt(e)}))),t.is(this.current_collection)&&t.is(this.current_collection.getSearchRessources())&&t.is(this.current_collection.getSearchRessources().getActiveTenant())?(L=this.current_collection.getSearchRessources().getActiveTenant(),V=l.getOption("dataSourcesForRoles",{tenant:L}),U=l.getOption("dataSourcesFile",{tenant:L})):(V=l.getOption("dataSourcesForRoles",{tenant:this.tenant}),U=l.getOption("dataSourcesFile",{tenant:this.tenant})),!0===V||!0===U){let e=n.create("div",{class:"search_center_general_tab_div search_center_margin",id:"general-tab-dataSourcesToSearch","search-setting-id":"dataSourcesToSearch"}).inject(g),i=n.create("div",{class:"search_center_div_left search_center_general_display_flex search-setting-title",id:"dataSourcesToSearch"}).inject(e);n.create("div",{class:"search_center_div_right search-setting-value",id:"general-tab-dataSourcesToSearch-combo"}).inject(e);n.create("p",{class:"search_center_text",text:D.get(D.get("dataSourcesToSearch"))}).inject(i);let s=n.create("div",{class:"search_center_div_left search_center_general_display_data_source_toggle search_center_source_toggle",id:"general-tab-resultsdisplay-text-data-source-toggle"}).inject(g),a=n.create("div",{class:"search_center_div_left search_center_general_display_data_source_toggle_others search_center_source_toggle_others",id:"general-tab-resultsdisplay-text-data-source-toggle-others"}).inject(g);document.getElementById("general-tab-resultsdisplay-text-data-source-toggle-others").style.display="none";let r=new w({className:"divided",items:[],exclusive:!1});r.inject(a);let d=n.create("div",{class:"search_center_div_left search_center_general_display_data_source_toggle_plus search_center_source_toggle_plus",id:"general-tab-resultsdisplay-text-data-source-toggle-plus"}).inject(g);document.getElementById("general-tab-resultsdisplay-text-data-source-toggle-plus").style.display="none";let h=[];c.getGrantedRoles((function(e){for(let t=0;t<e.length;t++){let i=v.getOption(e[t].id);i&&(h=h.concat(i))}})),h=h.filter(((e,t,i)=>i.indexOf(e)===t));let p=c.getActiveDataSource();h=h.filter((function(e){return-1===p.indexOf(e)}));let _=!1,m=c.getActiveDataSource(),b=function(){if(!1===_){_=!0,m=c.getActiveDataSource();let i=[];for(let e=0;e<=m.length-1;e++){let t={optionDefaultValue:!0,optionID:"dataSource-"+m[e],optionLabel:"adv_search.source."+m[e]!==D.get("adv_search.source."+m[e])?D.get("adv_search.source."+m[e]):m[e],optionTooltip:"adv_search.source."+m[e]!==D.get("adv_search.source."+m[e])?D.get("adv_search.source."+m[e]):m[e],optionType:"boolean"};i[e]=t}for(let e=0;e<=h.length-1;e++){let t={optionDefaultValue:!1,optionID:"dataSource-"+h[e],optionLabel:"adv_search.source."+h[e]!==D.get("adv_search.source."+h[e])?D.get("adv_search.source."+h[e]):h[e],optionTooltip:"adv_search.source."+h[e]!==D.get("adv_search.source."+h[e])?D.get("adv_search.source."+h[e]):h[e],optionType:"boolean"};i[e+m.length]=t}let a=[],g=!1,p=!1;for(let e=0;e<=i.length;e++)t.is(i[e])&&t.is(i[e].optionID)&&t.is(i[e].optionLabel)&&(S[i[e].optionID]=u.getItem(i[e].optionID),!0===S[i[e].optionID]&&(g=!0),void 0===S[i[e].optionID]&&(p=!0));r.addItem({title:D.get("otherSources")}),r.addEvent("onOpen",o._OnAccordionOpen.bind(o)),r.addEvent("onClose",o._OnAccordionClose.bind(o));for(let r=0;r<=i.length;r++)if(t.is(i[r])&&t.is(i[r].optionID)&&t.is(i[r].optionLabel))if(S[i[r].optionID]=u.getItem(i[r].optionID),"boolean"!==i[r].optionType||t.is(i[r].father)){if("string"===i[r].optionType){let t=new Text({placeholder:i[r].optionLabel,class:i[r].optionID,id:i[r].optionID,events:{onKeyDown:function(){o._applySettings.disabled=!1}}}).inject(e);o._textInputs.push(t),t.setValue(S[i[r].optionID])}}else{let e=i[r].optionLabel;!0===S[i[r].optionID]?a=a.concat(i[r].optionID.substring(11)):void 0===S[i[r].optionID]&&!0===g&&!0===p&&(e=e.concat(D.get("newSource")));let c=new f({type:"checkbox",value:i[r].optionID,domId:i[r].optionID,label:e,checkFlag:t.is(S[i[r].optionID])?S[i[r].optionID]:i[r].optionDefaultValue});t.is(i[r].disable)&&(c.disabled=i[r].disable),"integratedSearch"===i[r].optionID&&c.hide(),null!==l.getOption("addinmode")&&"search_tabbed_ui"===i[r].optionID&&c.hide();let u=n.create("div",{class:"search_center_div_left"});c.inject(u);["swym","3dspace","drive"].includes(i[r].optionID.substring(11))?u.inject(s):(u.inject(d),document.getElementById("general-tab-resultsdisplay-text-data-source-toggle-others").style.display="block"),o._toggles.push(c),c.addEventListener("buttonclick",y)}c.setChosenDataSource(a)}};m.length>0&&!1===_&&b.call(),c.getActiveDataSourcePromise().then((function(){m=c.getActiveDataSource(),0!==m.length&&b.call()}))}let j=c.getActiveTenant();u.getItemPromise("optionMode",j).then((function(e){t.is(e)&&(t.is(o._dateModeComboBox)&&(o._dateModeComboBox.currentValue=t.is(e.dateDisplayMode)?D.get(e.dateDisplayMode.id+".title"):k),t.is(o._csvComboBox)&&(o._csvComboBox.currentValue=t.is(e.csvMode)?e.csvMode.valueItem:l.getOption("csvSeparator")))})),A(o._optionPanel.elements.container,this)},_SecurityContextMngt:function(e){let i=this,n=[];if(t.is(e,"array")&&e.forEach((function(e){let i=e.displayName;t.is(e.isDefault)&&!0===e.isDefault?n.unshift(i):n.push(i)})),!0===i._isSecurityContextChosenAfterError&&n.splice(0,0,D.get("select_security_context")),n.length>0){let e,s=u.getItem("revisionDisplayType"),o=l.getOption("defaultRevision",{tenant:i.tenant});t.is(s)||(s=o||n[0]);let a;c.getActiveTenant();e=t.is(i.snSkeletonMgt)&&t.is(i.snSkeletonMgt.getSearchWidget,"function")&&t.is(i.snSkeletonMgt.getSearchWidget())&&t.is(i.snSkeletonMgt.getSearchWidget().setValue,"function")&&!0===i._isPinnedWidget()?i.snSkeletonMgt.getSearchWidget().getValue("securityContext"):u.getItem("securityContext"+(t.is(i.tenant,"object")&&i.tenant.tenantId?i.tenant.tenantId:i.tenant)+c.getUserId()),t.is(e)&&(a=JSON.parse(e));let r=t.is(a)&&t.is(a.displayName)?a.displayName:"";i._credentialComboBox=i._buildComboOption(i.divOptions,"Show_3DSpace_Credentials",n,r),i._credentialComboBox.tooltipInfos=new S({shortHelp:r})}},_OnAccordionOpen:function(){document.getElementById("general-tab-resultsdisplay-text-data-source-toggle-plus").style.display="block"},_OnAccordionClose:function(){document.getElementById("general-tab-resultsdisplay-text-data-source-toggle-plus").style.display="none"},_listUISettingsToDisplay:function(){r.groupCollapsed("SearchOptionsUI._listUISettingsToDisplay");let e,i=this,n=[],s=l.getSettingsToDisplayInUI(),o=!1,a=this._isPinnedWidget(),d={};t.is(i.snSkeletonMgt)&&(o=t.is(i.snSkeletonMgt.getOption("in_apps_search"),"object"),t.is(i.snSkeletonMgt.getSearchWidget,"function")&&t.is(i.snSkeletonMgt.getSearchWidget())&&(e=i.snSkeletonMgt.getSearchWidget().getValue("launch_mode")),d={addinMode:i.snSkeletonMgt.getOption("addinMode"),inContextSearch:t.is(i.snSkeletonMgt.getOption("in_apps_search"),"object"),isPinnedWidget:a});let u=l.getOption("integratedSearch"),h=null,g=c.identifyClientInfo(d.addinMode);t.is(g,"object")&&(h=g.identifier);let p=function(i){var n=l.getOption("search_web_in_win");let s=!0;switch(i){case"search_tabbed_ui":switch(h){case"3DSpace":s=!1;break;case"3DDashboard":a&&e!==c.widgetLaunchMode.COMPASS_TRANSIENT&&e!==c.widgetLaunchMode.COMPASS_PINNED&&(s=!1);break;case"3DEXPERIENCE":o&&(s=!1)}"catiav5"===l.getOption("addinmode")&&!0===l.getOption("lockedapp")&&(s=!1);break;case"integratedSearch":switch(t.is(u)&&!1===u?s=!1:e!==c.widgetLaunchMode.COMPASS_TRANSIENT&&e!==c.widgetLaunchMode.COMPASS_PINNED||(s=!1),h){case"3DSpace":case"3DSwym":case"3DEXPERIENCE":s=!1;break;case"3DDashboard":a&&(s=!1)}break;case"search_date_region":s=!1,!0===l.getOption("activate_search_date_region")&&(s=!0);break;case"csvSeparatorUI":s=!0;break;case"search_double_click_open":s=!!n}return s};for(let e=0;e<=s.length;e++)t.is(s[e])&&t.is(s[e].optionID)&&t.is(s[e].optionLabel)&&p(s[e].optionID)&&n.push(s[e]);return r.groupEnd(),n},addTab:function(e){if(r.groupCollapsed("SearchOptionsUI.addTab"),r.log("iOptions:",e),!t.is(this._tabContainer))throw new Error("SearchOptionsUI.addTab called but no tab container!");if(!t.is(e))throw new Error("SearchOptionsUI.addTab called but no argument provided!");this._tabContainer.add(e),r.groupEnd()},value:function(e){if(r.groupCollapsed("SearchOptionsUI.value"),r.log("iValue:",e),!t.is(this._tabContainer))throw new Error("SearchOptionsUI.value called but no tab container!");if(!t.is(e))throw new Error("SearchOptionsUI.value called but no argument provided!");this._tabContainer.value=[e],r.groupEnd()},_refreshResults:function(){if(t.is(this.snSkeletonMgt)&&t.is(this.snSkeletonMgt.getSearchActions,"function")){let e=this.snSkeletonMgt.getSearchActions();t.is(e)&&t.is(e.dispatchEvent,"function")&&e.dispatchEvent("onRefreshResultRequest")}else this._reloadPage()},_reloadPage:function(){let e=0;!0===l.getOption("search_web_in_win")&&window.hasOwnProperty("sendNotificationWebInWin")&&t.is(sendNotificationWebInWin,"function")&&(sendNotificationWebInWin("reloadPage",!0),e=500),setTimeout((function(){location.reload(!0)}),e)},_createPanel:function(e,t){let i=this,n={my:"top right",at:"top right",of:this.immersiveFrame,offsetX:-300,offsetY:150};t.disabled=!0,this._optionPanel=new g({immersiveFrame:this.immersiveFrame,title:D.get("custo_chooser_panel_title"),identifier:"search-options-popover",position:n,content:e,minWidth:260,minHeight:250,resizableFlag:!0,buttons:{Apply:t},autoCloseFlag:!0}),this._optionPanel.elements.container.addClassName("search-options-popover"),"3DDashboard"===c.identifyClientInfo().identifier?this.immersiveFrame.elements.container.setStyle("z-index",100):"3DSpace"===c.identifyClientInfo().identifier&&this.immersiveFrame.elements.container.setStyle("z-index",4e3),this._optionPanel.elements.container.setStyle("z-index",4e3),this._optionPanel.addEventListener("close",(function(e){e.stopPropagation(),i.destroy()}))},_deletePanel:function(){t.is(this._optionPanel)&&t.is(this._optionPanel.destroy,"function")&&(t.is(this._optionPanel.immersiveFrame)&&t.is(this._optionPanel.immersiveFrame.destroy,"function")&&this._optionPanel.immersiveFrame.destroy(),this._optionPanel.destroy(),this._optionPanel=null)},_isPinnedWidget:function(){let e,i=!1;t.is(this.snSkeletonMgt)&&(e=this.snSkeletonMgt.getOption("addinMode"));let n=c.identifyClientInfo(e);return t.is(this.snSkeletonMgt)&&(n=c.identifyClientInfo(this.snSkeletonMgt.getOption("addinMode"))),t.is(this.snSkeletonMgt)&&t.is(this.snSkeletonMgt.getOption,"function")&&"3DSwym"!==n.identifier&&(i="true"!==this.snSkeletonMgt.getOption("transient_context")&&!0!==this.snSkeletonMgt.getOption("transient_context")),i},_buildComboOption:function(e,t,i,s){let o=this,a=null;if(i.length>0){let r=n.create("div",{class:"search_center_general_tab_div search_center_margin",id:"general-tab-"+t,"search-setting-id":t}).inject(e),l=n.create("div",{class:"search_center_div_left search_center_general_display_flex search-setting-title",id:t}).inject(r),c=n.create("div",{class:"search_center_div_right search-setting-value",id:"general-tab-"+t+"-combo"}).inject(r);n.create("p",{class:"search_center_text",text:D.get(t)}).inject(l),a=new m({elementsList:i,nbDisplayedElements:i.length,currentValue:s,enableSearchFlag:!1}).inject(c),c.setStyle("display","grid"),a.addEventListener("change",(function(){o._cChangeDone=!0,o._applySettings.disabled=!1}))}return a},_validateSettings:function(){let e=this,i=s.deferred(),n=!0,a=s.deferred();c.resetDataSourceHasChanged();for(let i=0;i<=e._toggles.length;i++){let s=e._toggles[i];t.is(s)&&t.is(s.options)&&u.setItem(s.value,s.checkFlag),t.is(s)&&t.is(s.options)&&t.equals(s.value,"InstantSearch")&&o.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:"searchBetaUnique",persDim:{pd1:s.checkFlag?"enabled":"disabled"}}}),t.is(s)&&t.is(s.value)&&s.value.startsWith("dataSource-")&&(r.log("aToggle.value: "+s.value),!0===s.checkFlag?(c.addChosenDataSource(s.value.substr(11)),n=!0):(c.suppressChosenDataSource(s.value.substr(11)),n=!1))}!1===n&&b._displayAlert({message:D.get("No_data_source"),className:"success"}),c.dataSourceChangeCompleted();for(let i=0;i<e._textInputs.length;i++){let n=e._textInputs[i];t.is(n)&&t.is(n.options)&&u.setItem(n.getId(),n.getValue())}if(t.is(e._revisionTypeComboBox)){let i=e._revisionTypeComboBox.currentValue;if(t.is(i))for(let t=0;t<e._revisionObject.length;t++){let n=e._revisionObject[t];if(i===D.get(n.id+".title")){i=n,u.setItem("revisionDisplayType",i);break}}}u.commit();let h,g={},p=null,_=t.is(e._csvComboBox)?e._csvComboBox.currentValue:D.get("COMMA.title");if(t.is(_))for(let t=0;t<e._listofCSVModeItemsArray.length;t++)p=e._listofCSVModeItemsArray[t],_===p.valueItem&&(g.csvMode=p);if(l.getOption("search_web_in_win")&&t.is(e.snSkeletonMgt)&&t.is(e.snSkeletonMgt.getCollection())&&t.is(e.snSkeletonMgt.getCollection().getTaggerProxy())&&(e.snSkeletonMgt.getCollection().getTaggerProxy().clearLocalFilter(),e.snSkeletonMgt.getCollection().getTaggerProxy().clearLocalGrouping&&e.snSkeletonMgt.getCollection().getTaggerProxy().clearLocalGrouping()),t.is(e._dateModeComboBox)){let i=e._dateModeComboBox.currentValue;if(t.is(i)){let t=null;for(let n=0;n<e._dateModeObject.length;n++)t=e._dateModeObject[n],i===D.get(t.id+".title")&&(g.dateDisplayMode=t)}}if(t.is(e._credentialComboBox)){let i=e._credentialComboBox.currentValue;if(t.is(i)){let n=[],s=[];s=d.getSecurityContexts(),t.is(s,"array")&&s.forEach((function(e){let i=e.displayName;t.is(e.isDefault)&&!0===e.isDefault?n.unshift(i):n.push(i)})),n.sort(),!0===e._isSecurityContextChosenAfterError&&n.splice(0,0,D.get("select_security_context"));let o=null;c.getActiveTenant();for(let n=0;n<s.length;n++)if(o=s[n],i===o.displayName){if(e._isSecurityContextChosenAfterError=!1,t.is(e.current_collection)&&t.is(e.current_collection.getSearchRessources,"function")){t.is(e.snSkeletonMgt)&&t.is(e.snSkeletonMgt.getSearchWidget,"function")&&t.is(e.snSkeletonMgt.getSearchWidget())&&t.is(e.snSkeletonMgt.getSearchWidget().setValue,"function")&&e.snSkeletonMgt.getSearchWidget().setValue("securityContext",JSON.stringify(o)),!0==!e._isPinnedWidget()&&u.setItem("securityContext"+(t.is(this.tenant,"object")&&this.tenant.tenantId?this.tenant.tenantId:this.tenant)+c.getUserId(),JSON.stringify(o));break}u.setItem("securityContext"+(t.is(this.tenant,"object")&&this.tenant.tenantId?this.tenant.tenantId:this.tenant)+c.getUserId(),JSON.stringify(o));break}}}h=t.is(this.current_collection)?l.getOption("dataSourcesForRoles",{tenant:this.current_collection.getSearchRessources().getActiveTenant()}):l.getOption("dataSourcesForRoles"),!0===h&&u.setItem("dataSource",c.getChosenDataSource()),u.commit(),a.resolve(!0);try{u.setPreference({name:"optionMode",value:JSON.stringify(g),tenantId:c.getActiveTenant(),onComplete:function(){if(r.log("data is saved successfully"),i.resolve(!0),!0===l.getOption("search_web_in_win")){let i=e.snSkeletonMgt&&e.snSkeletonMgt.options.observable;if(t.is(i)){let e={type:"applySettings",value:JSON.stringify({name:"optionMode",value:JSON.stringify(g),tenantId:c.getActiveTenant(),search_tabbed_ui:u.getItem("search_tabbed_ui"),search_double_click_open:u.getItem("search_double_click_open"),revisionDisplayType:u.getItem("revisionDisplayType")})};i._BroadcastsearchDropDownManager&&i._BroadcastsearchDropDownManager.postMessage(e)}}},onFailure:function(e){r.error("Failure, Unable to save preferences :",e),i.resolve(!1)}})}catch(e){r.error("Error calling SearchPreferences:",e),i.resolve(!1)}Promise.all([i.promise,a.promise]).then((()=>{!0===e._mustReloaded?e._reloadPage():(e._refreshResults(),e.destroy())}))}})})),define("DS/SNResultUX/views/helpers/SearchRespLargeTileGridView",["DS/SNResultUX/views/helpers/Abstract","UWA/Core","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils"],(function(e,t,i,n){"use strict";return e.extend({className:"RespLargeTileGridView",attributes:{styles:{width:"100%"},"data-rec-id":"RespLargeTileGridView"},bShowTooltip:!1,init:function(e){this._parent(e),this.bShowTooltip=!!t.is(i.getOption("webUXTooltip"))&&i.getOption("showTooltip"),this.neverCheckbox=!!t.is(i.getOption("neverCheckbox"))&&i.getOption("neverCheckbox"),this.neverAction=!!t.is(i.getOption("neverAction"))&&i.getOption("neverAction")},onSearch:function(e){this._parent(e)},getMinNumberModel:function(e){return e||this._rowMaxNumber},setup:function(e){this._parent(e),this.listenTo(this.collection,{onAdd:function(){},onRemove:function(){},onSort:function(){},onAnyEvent:function(){},onReset:function(){},onSync:function(){}})},destroy:function(){t.is(this.view)&&t.is(this.view.destroy,"function")&&this.view.destroy(),this._parent()},render:function(){this.log("RespLargeTileGridView render");var e=this;return require(["DS/SNResultUX/views/WebUX/CollectionView/ResponsiveLargeTilesCollectionView"],(function(i){var n=e.getOptionCommon();n.height="inherit",n.displayedOptionalCellProperties=["contextualMenu","description"],n.clickSignatureItemCB=(t,i,n)=>{e.onItemSignatureClick(t,i,n)},e.view=new i(n);var s=e._canMultiSelect;e.view.selectionBehavior.canMultiSelect=s,e.view.selectionBehavior.canInteractiveMultiselectWithCheckboxClick=s,e.view.selectionBehavior.enableShiftSelection=s,e.view.selectionBehavior.enableFeedbackForActiveCell=s,!0===e.neverCheckbox&&(e.view.visibilityFlag=!1),e.view.onCellDoubleClick((function(t){e.onItemDblClick(t.cellModel)})),t.is(e._simpleSearch)&&!0===e._simpleSearch&&t.is(e.view.onCellTitleClick,"function")&&e.view.onCellTitleClick((function(t){e.onItemTitleClick(t.cellModel)})),e.view.onContextualEvent=n.onContextualEvent,e.view.displayTitleTooltip=e.bShowTooltip,e.view.getContent().inject(e.container),e._model.search_multiselMode&&e.toggleMultiSelMode(!0),e.view.onInfiniteScroll((function(t){e.onInfiniteScrollAsync(t,(function(){e.view.infiniteScrollProcessDone()}))})),e.view.onEndResizeOrOnReadyModelRequest&&e.view.onEndResizeOrOnReadyModelRequest((function(t){e.onResizeOrFirstLoaded(t,(function(){e.setViewMargins(),e.view.EndResizeOrOnReadyModelRequestDone()}))})),e._afterRender(),e.onSearch()})),this}})})),define("DS/SNResultUX/views/helpers/SearchRespTextualTileGridView",["DS/SNResultUX/views/helpers/Abstract","UWA/Core","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils"],(function(e,t,i,n){"use strict";return e.extend({className:"RespTextualTileGridView",attributes:{styles:{width:"100%"},"data-rec-id":"RespTextualTileGridView"},bShowTooltip:!1,init:function(e){this._parent(e),this.bShowTooltip=!!t.is(i.getOption("webUXTooltip"))&&i.getOption("showTooltip"),this.neverCheckbox=!!t.is(i.getOption("neverCheckbox"))&&i.getOption("neverCheckbox"),this.neverAction=!!t.is(i.getOption("neverAction"))&&i.getOption("neverAction")},onSearch:function(e){this._parent(e)},getMinNumberModel:function(e){return e||this._rowMaxNumber},setup:function(e){this._parent(e),this.listenTo(this.collection,{onAdd:function(){},onRemove:function(){},onSort:function(){},onAnyEvent:function(){},onReset:function(){},onSync:function(){}})},destroy:function(){t.is(this.view)&&t.is(this.view.destroy,"function")&&this.view.destroy(),this._parent()},_onPostCellRequest:function(e){var i=e.cellView;null!==(t.is(e.virtualCellID)?e.virtualCellID:t.is(e.cellID)?e.cellID:null)&&t.is(i.contentView)&&t.is(i.contentView.setPictureBackgroundSize,"function")&&i.contentView.setPictureBackgroundSize("contain")},render:function(){this.log("RespTextualTileGridView render");var e=this;return require(["DS/SNResultUX/views/WebUX/CollectionView/ResponsiveLargeTextualTilesCollectionView"],(function(i){var s=e.getOptionCommon();s.height="inherit",s.displayedOptionalCellProperties=["contextualMenu","description"],s.clickSignatureItemCB=(t,i,n)=>{e.onItemSignatureClick(t,i,n)},e.view=new i(s),e.view.layout.gutter=n.isFUN109031Active()?10:0;var o=e._canMultiSelect;e.view.selectionBehavior.toggle=o,e.view.selectionBehavior.canMultiSelect=o,e.view.selectionBehavior.canInteractiveMultiselectWithCheckboxClick=o,e.view.selectionBehavior.enableShiftSelection=o,e.view.selectionBehavior.enableFeedbackForActiveCell=o,!0===e.neverCheckbox&&(e.view.visibilityFlag=!1),e.view.onCellDoubleClick((function(t){e.onItemDblClick(t.cellModel)})),t.is(e._simpleSearch)&&!0===e._simpleSearch&&t.is(e.view.onCellTitleClick,"function")&&e.view.onCellTitleClick((function(t){e.onItemTitleClick(t.cellModel)})),e.view.onContextualEvent=s.onContextualEvent,e.view.displayTitleTooltip=e.bShowTooltip,e.view.getContent().inject(e.container),e._model.search_multiselMode&&e.toggleMultiSelMode(!0),e.view.onInfiniteScroll((function(t){e.onInfiniteScrollAsync(t,(function(){e.view.infiniteScrollProcessDone()}))})),e.view.onEndResizeOrOnReadyModelRequest&&e.view.onEndResizeOrOnReadyModelRequest((function(t){e.onResizeOrFirstLoaded(t,(function(){e.setViewMargins(),e.view.EndResizeOrOnReadyModelRequestDone()}))})),e._afterRender(),e.onSearch()})),this}})})),define("DS/SNResultUX/views/helpers/SearchRespThumbnailGridView",["DS/SNResultUX/views/helpers/Abstract","UWA/Core","DS/SNInfraUX/SearchSettings","DS/SNResultUX/utils/ImageHelper","DS/SNInfraUX/SearchUtils"],(function(e,t,i,n,s){"use strict";return e.extend({className:"RespThumbnailGridView",attributes:{styles:{width:"100%"},"data-rec-id":"RespThumbnailGridView"},bShowTooltip:!1,_bigPicList:[],_picCheckedList:[],_imageHelpers:null,init:function(e){this._imageHelpers=[],this._bigPicList=[],this._picCheckedList=[],this._parent(e),this.bShowTooltip=!!t.is(i.getOption("showTooltip"))&&i.getOption("showTooltip"),this.neverCheckbox=!!t.is(i.getOption("neverCheckbox"))&&i.getOption("neverCheckbox"),this.neverAction=!!t.is(i.getOption("neverAction"))&&i.getOption("neverAction")},onSearch:function(e){this._parent(e)},getMinNumberModel:function(e,t){return(e=e||this._rowMaxNumber)*(t=t||this._columnsMaxNumber)},setup:function(e){this._parent(e);var t=this;this.listenTo(this.collection,{onAdd:function(){},onRemove:function(){},onSort:function(){},onAnyEvent:function(){},onReset:function(){t._imageHelpers&&t._imageHelpers.forEach((function(e){e.destroy()})),t._imageHelpers=[],t._bigPicList=[],t._picCheckedList=[]},onSync:function(){}})},destroy:function(){this._imageHelpers.forEach((function(e){e.destroy()})),this._imageHelpers=null,t.is(this.view)&&t.is(this.view.destroy,"function")&&this.view.destroy(),this._parent()},_updatePictureBackgroundSizeOnCell:function(e,i){t.is(e)&&t.is(e.contentView)&&t.is(e.contentView.setPictureBackgroundSize,"function")&&e.contentView.setPictureBackgroundSize(i)},setAsBigPicture:function(e){this._bigPicList.push(e)},_onPostCellRequest:function(e){var i=e.cellView,s=t.is(e.virtualCellID)?e.virtualCellID:t.is(e.cellID)?e.cellID:null;if(null!==s)if(-1!==this._bigPicList.indexOf(s)?this._updatePictureBackgroundSizeOnCell(i,"contain"):this._updatePictureBackgroundSizeOnCell(i,"auto"),-1===this._picCheckedList.indexOf(s))this._imageHelpers.push(new n(e,this)),this._picCheckedList.push(s);else{var o=this._imageHelpers[s];t.is(o)&&(o._cellInfos=e)}},render:function(){this.log("RespThumbnailGridView render");var e=this;return require(["DS/SNResultUX/views/WebUX/CollectionView/ResponsiveThumbnailsCollectionView"],(function(i){var n=e.getOptionCommon();n.height="inherit",n.displayedOptionalCellProperties=["contextualMenu"],e.view=new i(n);var s=e._canMultiSelect;e.view.selectionBehavior.toggle=s,e.view.selectionBehavior.canMultiSelect=s,e.view.selectionBehavior.canInteractiveMultiselectWithCheckboxClick=s,e.view.selectionBehavior.enableShiftSelection=s,e.view.selectionBehavior.enableFeedbackForActiveCell=s,e.view.onCellDoubleClick((function(t){e.onItemDblClick(t.cellModel)})),t.is(e._simpleSearch)&&!0===e._simpleSearch&&t.is(e.view.onCellTitleClick,"function")&&e.view.onCellTitleClick((function(t){e.onItemTitleClick(t.cellModel)})),e.view.onContextualEvent=n.onContextualEvent,e.view.displayTitleTooltip=e.bShowTooltip,!0===e.neverCheckbox&&(e.view.visibilityFlag=!1),e.view.getContent().inject(e.container),e._model.search_multiselMode&&e.toggleMultiSelMode(!0),e.view.onInfiniteScroll((function(t){e.onInfiniteScrollAsync(t,(function(){e.view.infiniteScrollProcessDone()}))})),e.view.onEndResizeOrOnReadyModelRequest&&e.view.onEndResizeOrOnReadyModelRequest((function(t){e.onResizeOrFirstLoaded(t,(function(){e.setViewMargins(),e.view.EndResizeOrOnReadyModelRequestDone()}))})),e._afterRender(),e.onSearch()})),this}})})),define("DS/SNResultUX/views/helpers/SearchRespTileGridView",["DS/SNResultUX/views/helpers/Abstract","UWA/Core","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchUtils"],(function(e,t,i,n,s){"use strict";return e.extend({className:"RespTileGridView",attributes:{styles:{width:"100%"},"data-rec-id":"RespTileGridView"},bShowTooltip:!1,init:function(e){this._parent(e),this.bShowTooltip=!!t.is(i.getOption("webUXTooltip"))&&i.getOption("showTooltip"),this.neverCheckbox=!!t.is(i.getOption("neverCheckbox"))&&i.getOption("neverCheckbox"),this.neverAction=!!t.is(i.getOption("neverAction"))&&i.getOption("neverAction")},onSearch:function(e){this._parent(e)},getMinNumberModel:function(e,t){return(e=e||this._rowMaxNumber)*(t=t||this._columnsMaxNumber)},setup:function(e){this._parent(e),this.listenTo(this.collection,{onAdd:function(){},onRemove:function(){},onSort:function(){},onAnyEvent:function(){},onReset:function(){},onSync:function(){}})},destroy:function(){t.is(this.view)&&t.is(this.view.destroy,"function")&&this.view.destroy(),this._parent()},_onPostCellRequest:function(e){var i=e.cellView;null!==(t.is(e.virtualCellID)?e.virtualCellID:t.is(e.cellID)?e.cellID:null)&&t.is(i.contentView)&&t.is(i.contentView.setPictureBackgroundSize,"function")&&i.contentView.setPictureBackgroundSize("79px")},render:function(){this.log("RespTileGridView render");var e=this;return require(["DS/SNResultUX/views/WebUX/CollectionView/ResponsiveTilesCollectionView"],(function(n){var o=e.getOptionCommon();o.height="inherit",o.displayedOptionalCellProperties=["contextualMenu","description"],o.clickSignatureItemCB=(t,i,n)=>{e.onItemSignatureClick(t,i,n)},e.view=new n(o);let a=!0===s.isFUN109031Active()||e.getSNResultMgt()._isInAppsSearch()?800:670;e.view.layout.columnMaxWidth=i.getOption("maxTileWidth")?i.getOption("maxTileWidth"):a,e.view.allowLargeItems=!0;var r=e._canMultiSelect;e.view.selectionBehavior.canMultiSelect=r,e.view.selectionBehavior.canInteractiveMultiselectWithCheckboxClick=r,e.view.selectionBehavior.enableShiftSelection=r,e.view.selectionBehavior.enableFeedbackForActiveCell=r,!0===e.neverCheckbox&&(e.view.visibilityFlag=!1),e.view.onCellDoubleClick((function(t){e.onItemDblClick(t.cellModel)})),t.is(e._simpleSearch)&&!0===e._simpleSearch&&t.is(e.view.onCellTitleClick,"function")&&e.view.onCellTitleClick((function(t){e.onItemTitleClick(t.cellModel)})),e.view.onContextualEvent=o.onContextualEvent,e.view.displayTitleTooltip=e.bShowTooltip,e.view.getContent().inject(e.container),e._model.search_multiselMode&&e.toggleMultiSelMode(!0),e.view.onInfiniteScroll((function(t){e.onInfiniteScrollAsync(t,(function(){e.view.infiniteScrollProcessDone()}))})),e.view.onEndResizeOrOnReadyModelRequest&&e.view.onEndResizeOrOnReadyModelRequest((function(t){e.onResizeOrFirstLoaded(t,(function(){e.setViewMargins(),e.view.EndResizeOrOnReadyModelRequestDone()}))})),e._afterRender(),e.onSearch()})),this}})})),define("DS/SNResultUX/views/helpers/SearchWhatView",["UWA/Core","DS/SNResultUX/views/helpers/utils/AbstractMultiView","DS/SNInfraUX/SearchUtils"],(function(e,t,i){"use strict";return t.extend({_loadViews:function(t,n){if(this._parent(t,n),!0!==i.isFUN127551Active()||this.getCurrentViewId()!==this.getViewId())return;this.mask();let s=this,o=[];this.getSNResultMgt().getEmbeddedTaggerTags()&&this.getSNResultMgt().getEmbeddedTaggerTags().groups&&this.getSNResultMgt().getEmbeddedTaggerTags().groups[0]&&e.is(this.getSNResultMgt().getEmbeddedTaggerTags().groups[0].object,"array")&&(o=this.getSNResultMgt().getEmbeddedTaggerTags().groups[0].object),this.collection.getSNSkeleton().getOption("observable").getRefineHelpers().showTagcloudView(o,(e=>s._onTitleClick(e,void 0,!0))),this.unmask()}})})),define("DS/SNResultUX/views/helpers/SearchWhenView",["DS/SNResultUX/views/helpers/utils/AbstractMultiView","DS/SNInfraUX/SearchUtils"],(function(e,t){"use strict";return e.extend({_computeDisplay:function(){let e=this;e.getCurrentViewId()===e.getViewId()&&(e._ComputeGroup=!0),e._parent()},_loadViews:function(e,i){if(this._parent(e,i),!0!==t.isFUN127551Active()||this.getCurrentViewId()!==this.getViewId())return;this.mask();let n,s=this,o=[],a=/[0-9]{4}-[0-9]{1,2}-[0-9]{1,2}T[0-9]{1,2}:[0-9]{1,2}:[0-9]{1,2}\.[0-9]{3}Z/g;if(this.collection.getHelperTagValues()?n=this.collection.getHelperTagValues().filter((e=>{if(["ds6w:when/ds6w:modified"].includes(e.sixw))return e})):this.collection.facetsTags.summaryData&&(n=this.collection.facetsTags.summaryData.filter((e=>{if(["ds6w:when/ds6w:modified"].includes(e.sixw))return e}))),i)this.collections.slice(e,i).forEach(((e,t)=>{let i=e.service_parameters.query.match(a);o.push({label:e.headTitle,count:e.totalCount,index:t,startDate:i[0],endDate:i[1]})}));else{for(let t=e;t<this.collections.length;++t){let e=this.collections[t].service_parameters.query.match(a);o.push({label:this.collections[t].headTitle,count:this.collections[t].totalCount,index:t,startDate:e[0],endDate:e[1]})}let t=0===e?[]:this.collection.getSNSkeleton().getOption("observable").getRefineHelpers().getTimelineComponentData();o=t.concat(o)}let r=this.collection.getTaggerProxy();this.collection.getSNSkeleton().getOption("observable").getRefineHelpers().showTimelineView(o,this._retrieveAllDatesFromCollection(),(e=>s._setLocalFilter(r,e)),(()=>{})),this.unmask()}})})),define("DS/SNResultUX/views/helpers/SearchWhereView",["DS/SNResultUX/views/helpers/utils/AbstractMultiView","UWA/Core","UWA/Promise","DS/MessageBus/MessageBus","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/Logger","DS/SNResultUX/views/helpers/utils/SearchGlobeViewUtils","DS/SNResultUX/views/helpers/utils/SearchMultiViewUtils","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],(function(e,t,i,n,s,o,a,r,l,c){"use strict";return e.extend({_lastGroup:null,_lastRefineCountry:"continent",_lastDataSourceGroup:null,_lastRefineSource:"global",_3DEXPERIENCEActivate:!1,_WhereIsActivate:!1,_MustRebuildTheGroup:!1,_lastSourceTag:null,_MaxDisplay:!1,_updateTitle:!1,_mustUpdateGroup:!1,init:function(e){this._parent(e),this._lastGroup=null,this._lastRefineCountry="continent",this._lastDataSourceGroup=null,this._lastRefineSource="global",this._3DEXPERIENCEActivate=!1,this._WhereIsActivate=!1,this._MustRebuildTheGroup=!1,this._lastSourceTag=null,this._MaxDisplay=!1,this._updateTitle=!1,this._mustUpdateGroup=!1,this.addEvent("onMultiView",this.onMultiView.bind(this))},_initCollectionListener:function(e){let i=this;i.listenTo(i.collection,{onSetTags:function(e){if("where"===i.getCurrentViewId()){t.is(e)&&t.is(e.service_parameters)&&t.is(e.service_parameters.fromTopbar)&&!0===e.service_parameters.fromTopbar&&(i._lastRefineCountry="continent",i._lastRefineSource="global",i._mustUpdateGroup=!0,i._onGroupingCompute=!1)}},onInitTreeDocumentAsyncCB:function(e){a.log("SearchWhereView onInitTreeDocumentAsyncCB Event",e),!0!==i._mustUpdateGroup?i._computeDisplay():a.log("SearchWhereView onInitTreeDocumentAsyncCB _mustUpdateGroup",i._mustUpdateGroup)},OnGroupingChange:function(e){a.log("SearchWhereView OnGroupingChange Event",e),i._refreshViewFromOnGrouping(e)},onInitTreeDocument_SelectFirstElt:function(){},onFilterChange:function(e){if(t.is(e)){i.getCurrentViewId(),i.getViewId()}},onReset:function(){i.checkToDisplayEmptyView(),i.toggleMultiSelMode(!1),i._resetViews()}})},switchSearchBackView:function(e,i,n){let s=this,o=s.getCurrentViewId();if(o===s.getViewId()&&!t.is(n))return;let a=s.getSNResultMgt(),r=e||a._searchBackViewContainerContent;r&&r.switchOnView(s.getViewId(),i),s._lastNbSection?"what"!==o&&"who"!==o&&"when"!==o&&"where"!==o||a&&a.hideSearchContentSetHeader():"what"!==o&&"who"!==o&&"when"!==o&&"where"!==o&&a&&a.showSearchContentSetHeader()},_refreshViewFromOnGrouping:function(e,i,n=!0){let s=this,o=!1;if(t.is(e)||(o=!0),t.is(e,"object")&&t.is(e.groups,"array")&&0==e.groups.length&&(o=!0),1==o)return s._WhereIsActivate=!1,!0===s._updateTitle&&s.collection&&s.collection.getSNSkeleton().updateCounterView(s.collection.totalCount),void(s._updateTitle=!1);if(!t.is(e,"object")||!t.is(e.groups,"array"))return;let l=s.getViewId(),c=s.getCurrentViewId(),d=r.getPredicateType(s.collection,e),u=!1;if(s._WhereIsActivate=!1,s._updateTitle=!1,t.is(d)&&("computedCountryInfo"!==d&&"ds6w:dataSource"!==d||(u=!0,s._WhereIsActivate=!0,"computedCountryInfo"===d?(t.is(i)||t.is(e)&&t.is(e.forcedUpdate,"boolean")&&!0===e.forcedUpdate)&&!0!==s._mustUpdateGroup||(s._lastGroup=e,!0===s._mustUpdateGroup&&(s._lastGroup.forcedUpdate=!1),s._mustUpdateGroup=!1):"ds6w:dataSource"===d&&((t.is(i)||t.is(e)&&t.is(e.forcedUpdate,"boolean")&&!0===e.forcedUpdate)&&!0!==s._mustUpdateGroup||(s._lastDataSourceGroup=e,!0===s._mustUpdateGroup&&(s._lastDataSourceGroup.forcedUpdate=!1),s._lastRefineSource="global",s._lastSourceTag=void 0,s._mustUpdateGroup=!1)))),!1===u)return s._mustUpdateGroup=!1,s._lastRefineSource="global",s._lastSourceTag=void 0,void(s._onGroupingCompute=!1);let h=s.computeGrouping(e,n);if(t.is(e)&&t.is(e.forcedUpdate,"boolean")&&!0===e.forcedUpdate){t.is(h)&&t.is(h.country)&&t.is(h.back)&&!0===h.back&&h.country.length>0&&"continent"!==s._lastRefineCountry?s._refineCountryDisplay(h.country):(s._onInitTreeDocumentAsyncCB(e),s._lastRefineCountry="continent",s.collection.getSNSkeleton().switchOnView(l));let i=r.findCountryByLocalFilters(s.collection);return t.is(i)&&t.is(h.country)&&0!==h.country.length&&s._clearLocalGrouping(!0),void(s._MustRebuildTheGroup=!1)}if(a.log("->SNResultUX/views/helpers/SearchWhereView _refreshViewFromOnGrouping last Grouping: ",s._lastRefineCountry),s._3DEXPERIENCEActivate=!1,"ds6w:dataSource"===d&&(s._3DEXPERIENCEActivate=!0),t.is(h)&&!t.is(h.data))a.log("->SNResultUX/views/helpers/SearchWhereView _refreshViewFromOnGrouping Refine default View country: ",h.country),s._refreshViewFromRefine(h.country),s._clearLocalGrouping(!0);else if(a.log("->SNResultUX/views/helpers/SearchWhereView _refreshViewFromOnGrouping Grouping",h.data),t.is(h.back)&&!0===h.back){let e=r.findCountryByLocalFilters(s.collection);if(t.is(e)&&t.is(h.country)&&0!==h.country.length)s._refineCountryDisplay(h.country);else if(t.is(e)&&t.is(e.display)){let i=e.display;if(s._lastRefineCountry!==i)s._onInitTreeDocumentAsyncCB(h.data,h.back),s.collection.getSNSkeleton().switchOnView(l);else if(!0===s._3DEXPERIENCEActivate){let e=s.getSNResultMgt(),i=e&&e.getRefineHelpers().globeViewContainerContent,n=r.refineCountry(i),o=n&&n.object,a=n&&n.condition;if(t.is(o,"array")&&t.is(n.source)&&!0===n.source){let e=o.length,t=a&&a.length;(e&&e>1||t&&t>1)&&s._clearLocalGrouping()}else s._onInitTreeDocumentAsyncCB(s._lastDataSourceGroup),s._lastRefineSource="global",s.collection.getSNSkeleton().switchOnView(l)}s._lastRefineCountry=i}else!0===s._3DEXPERIENCEActivate?(s._onInitTreeDocumentAsyncCB(s._lastDataSourceGroup),s._lastRefineSource="global"):s._onInitTreeDocumentAsyncCB(h.data,h.back),s.collection.getSNSkeleton().switchOnView(l)}else a.log("->SNResultUX/views/helpers/SearchWhereView _refreshViewFromOnGrouping Grouping Continent"),s._onInitTreeDocumentAsyncCB(h.data),s._lastRefineCountry="continent",s._lastNbSection=0,"where"===c&&s.collection.getSNSkeleton().switchOnView(l)},_onInitTreeDocumentAsyncCB:function(e){this._parent(e)},_refreshViewFromRefine:function(e){a.log("->SNResultUX/views/helpers/SearchWhereView _refreshViewFromRefine")},_refineCountryDisplay:function(e){let t=this;a.log("->SNResultUX/views/helpers/SearchWhereView _refineCountryDisplay"),t._clearLocalGrouping(!0),t._lastselectedSearchId&&(a.log("->SNResultUX/views/helpers/SearchWhereView _refineCountryDisplay found selected element: ",t._lastselectedSearchId),l.selectElementInGlobalView(t._lastselectedSearchId,t.collection)),t._lastRefineCountry=e},_computeDisplay:function(){let e=this;e._MustRebuildTheGroup=!1;e.getViewId(),e.getCurrentViewId();let i=r.getPredicateType(e.collection);if(!1===e._WhereIsActivate)return;a.log("->SNResultUX/views/helpers/SearchWhereView _computeDisplay");let n=e.getSNResultMgt();if(t.is(n)){a.log("->SNResultUX/views/helpers/SearchWhereView _computeDisplay found snResult");let s=n.getRefineHelpers().globeViewContainerContent,o=r.refineCountry(s);if(t.is(o)){if(!0===o.country&&e._lastRefineCountry!==o.countryId)a.log("->SNResultUX/views/helpers/SearchWhereView _computeDisplay found country: ",o.countryId),e._3DEXPERIENCEActivate=!1,e._refineCountryDisplay(o.countryId);else if(t.is(o.continent)){e._3DEXPERIENCEActivate=!1;let i=o.continent;if(t.is(i)&&i.length&&t.is(e._lastGroup)){a.log("->SNResultUX/views/helpers/SearchWhereView _computeDisplay refine continent: ",i);let n=t.clone(e._lastGroup),s=n.groups[0].object,o=s.length;for(let e=0;e<o;e++){let a=s[e];t.is(a)&&a.dispText===i&&(n.groups[0].object=[],n.groups[0].object.push(a),e=o)}a.log("->SNResultUX/views/helpers/SearchWhereView _computeDisplay refine continent group: ",n),e._refreshViewFromOnGrouping(n,!0)}}else if(t.is(o.source)&&!0===o.source){a.log("->SNResultUX/views/helpers/SearchWhereView _computeDisplay refine Source group: ",o.display),e._3DEXPERIENCEActivate=!0;let i=o.condition,n=o.object;if(t.is(n,"array")){let s=n.length,a=i&&i.length;if(1===s&&1===a){let i,n=o.display,s=t.clone(e._lastDataSourceGroup),a=s&&s.groups[0].object,r=a&&a.length,l=0;for(;l<r;l++)i=a[l],t.is(i)&&i.dispText===n&&(t.is(i.subGroups)?s.groups[0].object=i.subGroups:s.groups[0].object=[i],l=r);e._onInitTreeDocumentAsyncCB(s,!0),e._lastRefineSource=n,e.collection.getSNSkeleton().switchOnView(e.getViewId())}else e._clearLocalGrouping()}}}else if("ds6w:where/ds6w:location/ds6w:dataSource"===i){r.findCountryByLocalFilters(e.collection);e._clearLocalGrouping()}else if("ds6w:who/person"===i&&!1===e._3DEXPERIENCEActivate){let t=r.getGroupForPredicateWho(e,e._lastGroup,e._lastRefineCountry),i=t.refine;"continent"===e._lastRefineCountry||i!==e._lastRefineCountry?(e._onInitTreeDocumentAsyncCB(t.group),e._lastRefineCountry=i):e._clearLocalGrouping(!0),a.log("->SNResultUX/views/helpers/SearchWhereView _computeDisplay refine ds6w:who/person")}else{if(t.is(i))if(e._MustRebuildTheGroup=!0,e._onGroupingCompute=!1,!0===e._3DEXPERIENCEActivate)e._refreshViewFromOnGrouping(e._lastDataSourceGroup,!1),e._lastRefineSource="global",e._lastSourceTag=void 0;else{let i=t.is(o)&&t.is(o.continent)&&o.continent;if(t.is(i)&&i.length&&t.is(e._lastGroup)){a.log("->SNResultUX/views/helpers/SearchWhereView _computeDisplay refine continent: ",i);let n=t.clone(e._lastGroup),s=n.groups[0].object,o=s.length;for(let e=0;e<o;e++){let a=s[e];t.is(a)&&a.dispText===i&&(n.groups[0].object=[],n.groups[0].object.push(a),e=o)}}e._refreshViewFromOnGrouping(e._lastGroup,!1)}else e._clearLocalGrouping();a.log("->SNResultUX/views/helpers/SearchWhereView _computeDisplay refine Global")}}},manageDisplayChannelView:function(e){let i=this,n=i.collections.length;for(let s=0;s<n;s++){let n=i.collections[s],o="tile";l.manageDisplayChannelView(n,o,e,i.getCurrentViewId(),i);let a=n.moreView;if(t.is(a)){let t=a.viewType,i=a.label;i.setStyle("visibility","visible"),!1===l.ifDisplayViewMore(t,n,e)&&i.setStyle("visibility","hidden")}}},updateListContentAfterCreation:function(e,t,i){l.manageDisplayChannelView(e,t,i,this.getCurrentViewId())},computeGrouping:function(e,i){if(!t.is(e))return;let n=this,s={data:e,back:!1};if(a.log("->SNResultUX/views/helpers/SearchWhereView computeGrouping"),a.log("->SNResultUX/views/helpers/SearchWhereView computeGrouping input group: ",e),t.is(e.groups)&&t.is(e.groups[0])){let i=r.getPredicateType(n.collection,e);if("computedCountryInfo"===i)a.log("->SNResultUX/views/helpers/SearchWhereView computeGrouping group from predicate: ",i);else if("ds6w:dataSource"===i)return a.log("->SNResultUX/views/helpers/SearchWhereView computeGrouping group from predicate: ",i),s;let o=e.groups[0].object;if(1===o.length){let e=o[0];if(t.is(e)&&t.is(e.subGroups)){let i=e.subGroups,o=i.length;if(o>1)s.data.groups[0].object=i,s.back=!0,a.log("->SNResultUX/views/helpers/SearchWhereView computeGrouping group by countries group: ",i);else if(1===o){let e=r.findCountryByLocalFilters(n.collection);t.is(e)&&t.is(e.predicate)&&t.is(e.object,"array")&&"ds6w:where/ds6w:location/computedCountryInfo"===e.predicate?a.log("->SNResultUX/views/helpers/SearchWhereView computeGrouping refine country",i):e=t.is(e)&&e.computedCountryInfo,t.is(e)&&t.is(e.object,"array")&&e.object.length>1?(a.log("->SNResultUX/views/helpers/SearchWhereView computeGrouping refine country",i),s.data.groups[0].object=i,s.back=!0,s.country=i[0].dispText):(s.data.groups[0].object=i,s.back=!0,a.log("->SNResultUX/views/helpers/SearchWhereView computeGrouping group by countries group: ",i))}a.log("->SNResultUX/views/helpers/SearchWhereView computeGrouping group: ",i)}}}return s},retrieveIconandTitle:function(e,i){if(!t.is(e))return;let n,s=this;if(a.log("->SNResultUX/views/helpers/SearchWhereView retrieveIconandTitle"),t.is(e.groups)&&t.is(e.groups[0])){a.log("->SNResultUX/views/helpers/SearchWhereView retrieveIconandTitle group: ",e.groups[0]);let s=e.groups[0].object,o=s.length;if(1===o){let e=s[0];if(t.is(e)&&t.is(e.subGroups)){if(e.subGroups.length){let t=e.dispText,i=e.iconInfo;i&&i.image;n={headTitle:t,icon:i}}}}else{let e=0;for(;e<o;e++){let a=s[e];if(t.is(a)&&a.dispText===i){let t=a.dispText,i=a.iconInfo;i&&i.image;n={headTitle:t,icon:i},e=o}}}}if(t.is(i)&&t.is(s._lastGroup)&&!t.is(n)){a.log("->SNResultUX/views/helpers/SearchWhereView retrieveIconandTitle input Country: ",i);let e=s._lastGroup.groups[0].object;if(t.is(e)){let s=e.length,o=0;for(;o<s;o++){let a=e[o];if(t.is(a)&&a.dispText===i){let e=a.dispText,t=a.iconInfo;t&&t.image;n={headTitle:e,icon:t},o=s}}if(!t.is(n))for(o=0;o<s;o++){let a=e[o];if(t.is(a)&&t.is(a.subGroups)){let e=a.subGroups;if(t.is(e)){let a=e.length,r=0;for(;r<a;r++){let l=e[r];if(t.is(l)&&l.dispText===i){let e=l.dispText,t=l.iconInfo;t&&t.image;n={headTitle:e,icon:t},o=s,r=a}}}}}}}return n},onMultiView:function(e){},On3DExperienceChange:function(e){let i=this;if(a.log("->SNResultUX/views/helpers/SearchWhereView On3DExperienceChange"),!t.is(i._lastDataSourceGroup))return;if(i._lastRefineSource===e)return;let n,s=e,o=t.clone(i._lastDataSourceGroup),r=o&&o.groups[0].object,l=r&&r.length,c=0;for(;c<l;c++)n=r[c],t.is(n)&&n.dispText===s&&(t.is(n.subGroups)?o.groups[0].object=n.subGroups:o.groups[0].object=[n],a.log("->SNResultUX/views/helpers/SearchWhereView On3DExperienceChange source"),c=l);let d=i.retrieveIconandTitle(i._lastDataSourceGroup,s);if(t.is(d)){let e=d.headTitle;if(a.log("->SNResultUX/views/helpers/SearchWhereView On3DExperienceChange Grouping Label: ",e),t.is(e)&&t.is(n)){o={dispText:s,identifier:n.object,type:"string",object:{}},o.object.predicates=[],o.object.predicates.push({type:"string",predicate:"ds6w:where/ds6w:source/ds6w:dataSource"}),o.object.value=[],o.object.value.push(n.object),i._lastRefineSource=s;let e=i.collection.getTaggerProxy();i._setLocalFilter(e,o,!0)}}},back3DExperience:function(e){let i=this;if(a.log("->SNResultUX/views/helpers/SearchWhereView back3DExperience source: ",e),!t.is(i._lastDataSourceGroup))return;let n=e;"global"===n&&(a.log("->SNResultUX/views/helpers/SearchWhereView back3DExperience back to global Group"),i._onInitTreeDocumentAsyncCB(i._lastDataSourceGroup,!1),i._lastRefineSource=n)},_onTitleClick:function(e,i){a.log("->SNResultUX/views/helpers/SearchWhereView _onTitleClick: ",e);let s,o=t.is(e)&&e.headTitle,l=this;r.getPredicateType(l.collection);if(t.is(s)||(s=t.is(l._lastGroup)&&!1===l._3DEXPERIENCEActivate?l._lastGroup:t.is(l._lastDataSourceGroup)&&!0===l._3DEXPERIENCEActivate?l._lastDataSourceGroup:l.getSNResultMgt().getEmbeddedTaggerTags()),t.is(s)){let e=s.groups[0].object,i=this.collection.getTaggerProxy(),a=e.length,r=!1,c=0;for(c=0;c<a;c++){let s=e[c];if(s.dispText===o&&(t.is(s.object,"object")&&t.is(s.object.predicates,"array")&&t.is(s.object.value,"array")&&s.object.predicates.length==s.object.value.length?(r=!0,n.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"clickOnContinentCategory",persDim:{pd1:o,pd2:"Where View"}}})):r=l._manageFilterForDataSources(s),!0===r)){!1===l._3DEXPERIENCEActivate?l._setLocalFilter(i,s):l.On3DExperienceChange(o);break}}if(!1===r)for(c=0;c<a;c++){let s=e[c];if(t.is(s)&&t.is(s.subGroups)){let e=s.subGroups,r=0,d=e.length;for(;r<d;r++){let s=e[r];if(s.dispText===o){let e=!1;if(t.is(s.object,"object")&&t.is(s.object.predicates,"array")&&t.is(s.object.value,"array")&&s.object.predicates.length==s.object.value.length?(e=!0,n.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"clickOnCountryCategory",persDim:{pd1:o,pd2:"Where View"}}})):e=l._manageFilterForDataSources(s),!0===e){l._setLocalFilter(i,s),c=a;break}}}}}}},_manageFilterForDataSources:function(e){let i=!1;if(!t.is(e))return i;let n=e.object;if(t.is(n,"array")){let s=n[0];!t.is(s)||"3DSpace"!==s&&-1===s.indexOf("Swym")||(e.identifier=n,e.object.predicates=[],e.object.predicates.push({type:"string",predicate:"ds6w:where/ds6w:source/ds6w:dataSource"}),e.object.value=[],e.object.value.push(n)),i=!0}return i},_setLocalFilter:function(e,i,n){if(!t.is(i)||!t.is(e))return;let s=this,o=i.object.predicates,a=o&&t.is(o,"array")&&t.is(o[0])&&o[0].predicate,r=[{display:i.dispText,object:i.identifier,type:i.type,predicates:o,value:i.object.value,operator:"OR"}],l={},c=a,d=c.indexOf("ds6w:dataSource");-1===d&&(c="ds6w:where/ds6w:location/",c+=s.getSNResultMgt().getEmbeddedTaggerTags().groups[0].predicate),l[c]=-1===d?{condition:r,isComplex:!0,operator:"OR"}:{condition:r,operator:"OR"};let u={condition:[l],operator:"AND",isSimplified:{version:2}};t.is(n)&&(s._lastSourceTag=t.clone(l)),e.setLocalFilter(u,!0)},refreshViewAfterComputeList:function(){let e=this,i=e.getSNResultMgt().getRefineHelpers().globeViewContainerContent;if(i&&i._showMarkersinfo(!0),r.refresh3DExperienceMarkers(i),!1===e._3DEXPERIENCEActivate){let t=0,i=e.collections.length;for(let n=0;n<i;n++){t+=e.collections[n].hits}if(e._totalCount!==t){e._updateTitle=!0;let i=t.toString()+"/"+e._totalCount.toString();e.collection&&e.collection.getSNSkeleton().updateCounterView(i,c.get("SearchGlobe_Location"))}}else t.is(e._lastRefineSource)&&("global"===e._lastRefineSource?e.collection&&e.collection.getSNSkeleton().updateCounterView(c.get("SearchGlobe_Content")):e.collection&&e.collection.getSNSkeleton().updateCounterView(""))},getMaxDisplay:function(){return this._MaxDisplay},_clearLocalGrouping:function(e){this.unmask(),(!0!==this._WhereIsActivate||t.is(e))&&this.collection&&(this.unmask(),this._totalCountSection=this.collection.totalCount,this.collection.getSNSkeleton().updateCounterView(this._totalCountSection),this.collection.getSNSkeleton().switchOnView(o.getItem("LastSearchViewMode")),this.collection.getTaggerProxy().clearLocalGrouping(),this._WhereIsActivate=!1)},CloseSidePanel:function(){this._lastRefineCountry="continent",this._lastRefineSource="global",this._mustUpdateGroup=!0,this._onGroupingCompute=!1,this._WhereIsActivate=!1,this._lastGroup=null,this._lastDataSourceGroup=null,this._3DEXPERIENCEActivate=!1,this._MustRebuildTheGroup=!1,this._lastSourceTag=null,this._MaxDisplay=!1,this._updateTitle=!1}})})),define("DS/SNResultUX/views/helpers/SearchWhoView",["DS/SNResultUX/views/helpers/utils/AbstractMultiView","DS/SNInfraUX/SearchUtils","DS/WebappsUtils/WebappsUtils"],(function(e,t,i){"use strict";return e.extend({_loadViews:function(e,n){if(this._parent(e,n),!0!==t.isFUN127551Active()||this.getCurrentViewId()!==this.getViewId())return;this.mask();let s=this,o=[],a=[],r=require("DS/TagNavigator/simplified/utils/PersonUtils"),l=t.getActiveTenant();this.collection.getHelperTagValues()?a=this.collection.getHelperTagValues().filter((e=>{if(["ds6w:who/ds6w:responsible","ds6w:who/ds6w:lastModifiedBy","ds6w:who/ds6w:responsible/ds6w:originator"].includes(e.sixw))return e})):this.collection.facetsTags.summaryData&&(a=this.collection.facetsTags.summaryData.filter((e=>{if(["ds6w:who/ds6w:responsible","ds6w:who/ds6w:lastModifiedBy","ds6w:who/ds6w:responsible/ds6w:originator"].includes(e.sixw))return e})));for(let e=0;e<a.length;e++){let t=-1;for(let i=0;i<o.length;i++)if(a[e].object===o[i].object){t=i;break}if(-1===t){o.push({sixw:[a[e].sixw],type:a[e].type,field:a[e].field,object:a[e].object,count:[a[e].count]});let t=r.getUserInfoFromCache(l,o[o.length-1].object),n=i.getWebappsBaseUrl()+"TagNavigator/assets/icons/generic_user.png";t&&t._attributes&&t._attributes.imageURL&&t._attributes.imageURL.length>0&&(n=t._attributes.imageURL[0]),o[o.length-1].imageUrl=n}else o[t].sixw.push(a[e].sixw),o[t].count.push(a[e].count)}this.collection.getSNSkeleton().getOption("observable").getRefineHelpers().showPhonebookView(o,(e=>s._setLocalFilter(this.collection.getTaggerProxy(),e))),this.unmask()},_getEmbeddedTaggerTags:function(e){let t=this._parent(e),i=this._getLocalFilters(),n=[];if(i&&i.condition&&i.condition.length>0)for(let e=0;e<i.condition.length;e++)if(i.condition[e]["ds6w:who/person"]&&i.condition[e]["ds6w:who/person"].condition&&i.condition[e]["ds6w:who/person"].condition.length>0)for(let t=0;t<i.condition[e]["ds6w:who/person"].condition.length;t++)Array.isArray(i.condition[e]["ds6w:who/person"].condition[t].value)&&i.condition[e]["ds6w:who/person"].condition[t].value[0]?n.push(i.condition[e]["ds6w:who/person"].condition[t].value[0]):i.condition[e]["ds6w:who/person"].condition[t].value?n.push(i.condition[e]["ds6w:who/person"].condition[t].value):n.push(i.condition[e]["ds6w:who/person"].condition[t].display);if(n.length>0&&t.Tags.groups&&t.Tags.groups[0]&&t.Tags.groups[0].object)for(let e=0;e<t.Tags.groups[0].object.length;e++){let i=t.Tags.groups[0].object[e].object&&t.Tags.groups[0].object[e].object.value&&t.Tags.groups[0].object[e].object.value[0]?t.Tags.groups[0].object[e].object.value[0]:t.Tags.groups[0].object[e].dispText;!n.includes(i)&&delete t.Tags.groups[0].object[e]}return t}})})),define("DS/SNResultUX/views/helpers/utils/TimeLines/TimeLineDate",["DS/SNResultUX/views/helpers/utils/TimeLines/Abstract","UWA/Core","DS/SNInfraUX/SearchDebug","DS/Controls/ProgressBar","DS/Controls/Slider","DS/Controls/Popup","DS/SNInfraUX/SearchUtils","DS/MessageBus/MessageBus"],(function(e,t,i,n,s,o,a,r){"use strict";return e.extend(i,{tagName:"div",className:"search-timeLine",dateScale:void 0,dateRange:[],type:null,setLocalFilter:()=>{},backAction:()=>{},dateRangeScaled:null,minDate:null,maxDate:null,title:null,list:[],init:function(e){this._parent(e),this.dateRange=e.data,this.type=e.type,this.setLocalFilter=e.setLocalFilter,this.backAction=e.backActionCB,this.container=e.container},setContainer:function(e){this.container=e},_dateFormat:function(e){return"YEARS"===this.dateScale?new Intl.DateTimeFormat(a.getLanguage(),{year:"numeric"}).format(e):"MONTHS"===this.dateScale?new Intl.DateTimeFormat(a.getLanguage(),{year:"numeric",month:"short"}).format(e):"HOURS"===this.dateScale?new Intl.DateTimeFormat(a.getLanguage(),{year:"numeric",month:"numeric",day:"numeric",hour:"numeric"}).format(e):new Intl.DateTimeFormat(a.getLanguage(),{year:"numeric",month:"short",day:"numeric"}).format(e)},_getTimeLineTitle:function(){if(!t.is(this.dateScale)||0===this.dateRangeScaled.length)return;let e,i=this.dateRangeScaled[0].value;switch(this.dateScale){case"HOURS":e=new Intl.DateTimeFormat(a.getLanguage(),{month:"long",day:"numeric"}).format(i);break;case"DAYS":e=new Intl.DateTimeFormat(a.getLanguage(),{month:"long"}).format(i);break;case"MONTHS":e=new Intl.DateTimeFormat(a.getLanguage(),{year:"numeric"}).format(i)}return e},_renderTimeLine:function(e){let i=this;null!==this.container.querySelector(".search-timeLine-content")&&this.container.querySelector(".search-timeLine-content").destroy();let s=t.createElement("div",{class:"search-timeLine-content"}),a=t.createElement("div",{class:"search-timeline-content-header"});t.createElement("span",{class:"fonticon fonticon-chevron-left"}).inject(a),a.addEventListener("click",(e=>{i._backAction()})),t.createElement("p",{class:"search-timeline-content-header-title"}).inject(a),a.inject(s);for(let a=e&&e[0]?e[0]:0,r=e&&e[1]?e[1]+1:this.list.length;a<r;a++){let e=this.list[a],r=t.createElement("div",{class:"search-timeLine-content-index"}),l=(t.createElement("p",{class:"search-timeLine-content-index-title",content:e.label}).inject(r),i._getStatistic(this.list,e.label));new o({target:r,trigger:"hover click"}).setBody(e.label+" "+Math.round(l)+"%"),r.addEventListener("click",(e=>{let t=i.list.find((t=>t.label===e.currentTarget.innerText));i._clickOnTitle(t)})),new n({shape:"linear",value:l,gradientAnimationFlag:!1,displayStyle:"lite"}).inject(r).elements.container.classList.add(l),r.inject(s)}s.inject(this.timeLineContent)},_changeValueSlider:function(){this._renderTimeLine(this.timeLineScroller.value)},_clickOnTitle:function(e){this._defineTag(e),r.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"clickOnTitle",persDim:{pd1:"TimelineDate",pd2:e.label}}})},_defineTag:function(e){this.setLocalFilter({dispText:e.label,object:{from:a.formatDate(e.from,"yyyy/MM/dd"),to:a.formatDate(e.to,"yyyy/MM/dd")},type:"date"})},_filterByDateScale:function(e){let t=[],i=this,n=new Date,s=new Date;a.setDateDay(s,1),n.setHours(0,0,0,0),s.setHours(0,0,0,0);for(let o=0;o<e.length;o++)void 0===t.find((t=>t.value.getTime()===e[o].getTime()))&&("YEARS"!==this.dateScale?"MONTHS"!==this.dateScale?"DAYS"!==this.dateScale||("week"===this.type&&n>=e[o]&&s<=e[o]&&t.push({label:i._dateFormat(e[o]),value:e[o]}),"month"===this.type&&n.getFullYear()===e[o].getFullYear()&&n.getMonth()===e[o].getMonth()&&t.push({label:i._dateFormat(e[o]),value:e[o]})):("year"===this.type&&n.getFullYear()===e[o].getFullYear()&&t.push({label:i._dateFormat(e[o]),value:e[o]}),"lastYear"===this.type&&n.getFullYear()-1===e[o].getFullYear()&&t.push({label:i._dateFormat(e[o]),value:e[o]})):"older"===this.type&&n.getFullYear()-2>=e[o].getFullYear()&&t.push({label:i._dateFormat(e[o]),value:e[o]}));return t},_getDataForTimeLine:function(){let e=[];return this.dateRange.filter((e=>this.dateRangeScaled[0].value<=e&&e<=this.dateRangeScaled[this.dateRangeScaled.length-1].value)).forEach((t=>{let i=this._dateFormat(t),n=e.find((e=>e.label===i));if(void 0===n){let n,s;if("week"===this.type||"month"===this.type)n=s=t;else if("year"===this.type||"lastYear"===this.type)n=new Date(t.getFullYear(),t.getMonth(),1),s=new Date(t.getFullYear(),t.getMonth()+1,0);else{if("older"!==this.type)throw Error("[3dSearch - Timelinedate] - given type exception");n=new Date(t.getFullYear(),0,1),s=new Date(t.getFullYear()+1,0,0)}e.push({label:i,count:1,from:n,to:s})}else++n.count;"DAYS"!==this.dateScale||e.length})),e},_backAction:function(){this.backAction&&this.backAction.call(this)},_hoverSlider:function(){if(this.list[this.timeLineScroller.value[0]]&&this.list[this.timeLineScroller.value[1]])return this.list[this.timeLineScroller.value[0]].label+" ; "+this.list[this.timeLineScroller.value[1]].label},_renderScroller:function(){let e=this;this.timeLineScroller&&this.timeLineScroller.destroy(),this.timeLineScroller=new s({minValue:0,maxValue:this.list.length-1,value:[0,this.list.length-1],displayStyle:"vertical"}),this.timeLineScroller.getTextFromValue=()=>e._hoverSlider(),this.timeLineScroller.getContent().addEventListener("change",(()=>{e._changeValueSlider()})),this.timeLineScroller.inject(this.timeLineContent)},render:function(){("week"===this.type||"month"===this.type)&&(this.dateScale="DAYS"),("year"===this.type||"lastYear"===this.type)&&(this.dateScale="MONTHS"),"older"===this.type&&(this.dateScale="YEARS"),this.dateRangeScaled=this._filterByDateScale(this.dateRange),this.minDate=new Date(this.dateRangeScaled[0].value),this.maxDate=new Date(this.dateRangeScaled[this.dateRangeScaled.length-1].value),this.timeLineContent=t.createElement("div",{class:"search-timeLineDate-content-object-list"}).inject(this.container),this.title=this._getTimeLineTitle(),this.list=this._getDataForTimeLine(),this._renderScroller(),this._renderTimeLine()},reset:function(){this.minDate=null,this.maxDate=null,this.fromDateInput&&this.fromDateInput.destroy(),this.toDateInput&&this.toDateInput.destroy(),this.inputDiv&&this.inputDiv.destroy(),this.timeLineApplyIcon&&this.timeLineApplyIcon.destroy(),this.timeLineContent&&this.timeLineContent.destroy()},destroy:function(){this.reset()&&this._parent()}})})),define("DS/SNResultUX/utils/ExternalComponentHelpers",["UWA/Core","UWA/Class","UWA/Class/Debug","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/Loader","DS/Controls/ModalContainer","DS/Controls/Popup","DS/Controls/TooltipModel","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/Logger","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],(function(e,t,i,n,s,o,a,r,l,c,d,u,h){"use strict";return t.singleton(i,{_immersiveFrame:void 0,_dialogs:[],_loader:void 0,_popins:[],init:function(){this._reinitComponents()},initImmersiveFrame:function(e){this._immersiveFrame=new n({}),this._immersiveFrame,this._immersiveFrame.inject(e||document.body)},getImmersiveFrame:function(){return void 0===this._immersiveFrame&&this.initImmersiveFrame(container),this._immersiveFrame},_toPascalCase:function(e){return e.replace(/\w+/g,(function(e){return e[0].toUpperCase()+e.slice(1).toLowerCase()}))},modal:function(t){let i=this,n={},a=t.id?t.id:"no_key";if(this.destroyModal(a),t&&e.is(t.CB,"array"))for(let e in t.CB){let s=t.CB[e];if(void 0===s.buttonKind)continue;void 0===s.function&&(s.function=()=>{i.destroyModal(a)});let r=this._toPascalCase(s.buttonKind);["Ok","Open","Save","SaveAll","Yes","YesToAll","Retry","Ignore","Cancel","Apply","Reset","RestoreDefaults","Help","No","NoToAll","Abort","Discard","Close"].includes(r)&&(n[r]=new o({label:s.label?s.label:r,icon:s.icon?s.icon:"",touchMode:!s.touchMode||s.touchMode,onClick:()=>{s.function.call(this)}}))}return this._dialogs[a]=new s({immersiveFrame:this._immersiveFrame,identifier:a,title:t&&e.is(t.title)?t.title:"",content:t&&e.is(t.content)?t.content:'<span style="color:red;">No Given Content...</span>',activeFlag:!(!t||!e.is(t.activeFlag,"boolean"))&&t.activeFlag,close:()=>!t||!e.is(t.close,"boolean")||t.close,autoCloseFlag:!t||!e.is(t.autoCloseFlag,"boolean")||t.autoCloseFlag,buttons:n,visibleFlag:!t||!e.is(t.visibleFlag,"boolean")||t.visibleFlag}),t&&e.is(t.autoCloseFlag,"boolean")&&!1===t.autoCloseFlag&&(this._dialogs[a].close=()=>{i._dialogs[a]._isBeingClosed=!0,i._dialogs[a].fire("close"),i._dialogs[a].hide(),i._dialogs[a]._isBeingClosed=!1}),this._dialogs[a]},getModal:function(e="no_key"){return this._dialogs[e]},destroyModal:function(e="no_key"){if(void 0!==this._dialogs[e]){try{this._dialogs[e].close()&&this._dialogs[e].destroy()}catch(e){d.getOption("debug")&&u.log("Destroy Modal Error",e)}delete this._dialogs[e]}},showOverlayLoader:function(e,t){try{void 0===this._loader&&(this._loader=new a),this._loader.on(void 0!==e?e:h.get("loading")),r.createModal(void 0===t?document.body:t,this._loader.elements.container)}catch(e){d.getOption("debug")&&u.log("showOverlayLoader Error",e)}},hideOverlayLoader:function(e){try{void 0!==this._loader&&this._loader.off(),r.removeModal(void 0===e?document.body:e)}catch(e){d.getOption("debug")&&u.log("hideOverlayLoader Error",e)}},mask:function(e,t){if(void 0!==t){var i=new a({text:t});i.on(t),r.createModal(e,i.elements.container)}else r.createModal(e)},unmask:function(e){r.removeModal(e)},tooltip:function(e,t){if(void 0!==e)return e.tooltipInfos=new c({title:t.title?t.title:"",shortHelp:t.shortHelp?t.shortHelp:void 0,longHelp:t.longHelp?t.longHelp:void 0,shortHelpImage:t.shortHelpImage?t.shortHelpImage:void 0,longHelpImage:t.longHelpImage?t.longHelpImage:void 0,mouseRelativePosition:!!t.mouseRelativePosition&&t.mouseRelativePosition,position:t.position?t.position:"bottom",reshowDelay:t.reshowDelay?t.reshowDelay:1,allowUnsafeHTMLLongHelp:!!t.allowUnsafeHTMLLongHelp&&t.allowUnsafeHTMLLongHelp})},popin:function(e,t){let i={target:e};for(let e in t)["trigger","visibleFlag","autoHide","position","alignment","offset","mouseRelativePosition","constraint","overlap","arrowBoxFlag","className"].includes(e)&&(i[e]=t[e]);let n=new l(i);t.body&&n.setBody(t.body),"function"==typeof t.onShow&&n.addEventListener("show",t.onShow),"function"==typeof t.onHide&&n.addEventListener("hide",t.onHide),this._popins[t.id?t.id:this._popins.length]=n},destroyPopin:function(e){this._popins[e]&&this._popins[e].destroy()&&delete this._popins[e]},_reinitComponents:function(){for(let e=0;e<this._dialogs.length;e++)this.destroyModal(e);for(let e=0;e<this._popins.length;e++)this.destroyPopin(e);this._dialogs=[],this._popins=[],void 0!==this._loader&&thiks._loader.destroy(),void 0!==this._immersiveFrame&&this._immersiveFrame.destroy()}})})),define("DS/SNResultUX/utils/DosThumbnailBatchHelper",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Promise","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/WAFData/WAFData"],(function(e,t,i,n,s,o,a){"use strict";return t.extend(i,{name:"DS_SNResultUX_utils_ThumbnailHelper",_ViewSyncStatus:{SYNC_STARTED:"SYNC_STARTED",SYNC_ENDED:"SYNC_ENDED"},_dosURLPromise:n.deferred(),_dosURL:null,_dosUrlRe:null,_collection:null,_dosThumbnailBatchFUN126428Enabled:!1,init:function(e){var t=this;this._collection=e,this._dosThumbnailBatchFUN126428Enabled=s.getOption("dosThumbnailBatchFUN126428Enabled"),this._dosThumbnailBatchFUN126428Enabled?o.getSericeURLPromise(e.getActiveTenant(),"dfsobjectstorage").then((function(e){console.log("DOS URL:",e),t._dosURL=e,t._dosUrlRe=new RegExp(t._dosURL+"/webservices/file/[^/]*/([^/]*)","i"),t._dosURLPromise.resolve()}),(function(){t._dosThumbnailBatchFUN126428Enabled=!1,t._dosURLPromise.resolve()})):t._dosURLPromise.resolve()},_getDosURLPromise:function(){return this._dosURLPromise.promise},isReady:function(){return this._getDosURLPromise()},batchUpdateDosThumbnailURLs:function(t){var i=this;if(this._dosThumbnailBatchFUN126428Enabled){var n=i._dosURL+"/webservices/file/",o=[],r={},l={};t.forEach((function(t){if(e.is(t.preview_url,"string"))try{var s=new URL(t.preview_url);if(r[t.id]=t.preview_url_value,s.href.startsWith(n)){let e=i._getThumbnailObjectIdFromDosThumbnailUrl(s.href);l[t.id]=e,o.indexOf(t.preview_url_value)<0?o.push(t.preview_url_value):console.log("DUPLICATE DOS PREVIEW URL: ",t.preview_url_value),t.preview_url_value=""}}catch(e){console.log(e.message)}}));for(var c=s.getOption("dosThumbnailBatchMax");o.length>0;){var d=o.splice(0,c),u={method:"POST",headers:{Accept:"*/*","Content-Type":"application/json"}};u.data=JSON.stringify(d),u.onComplete=function(e){var t=JSON.parse(e),n={};t.forEach((function(e){n[e.id]=e.url})),Object.keys(l).forEach((function(e){let t=l[e];if(t){let i=n[t];i&&(r[e]=i)}})),i.updateThumbnails(r)},u.onFailure=function(e){console.log("Failure: "+e),i.updateThumbnails(r)},a.authenticatedRequest(i._dosURL+"/webservices/batch/fileurls",u)}}},_getThumbnailObjectIdFromDosThumbnailUrl:function(t){let i=null,n=t.match(this._dosUrlRe);return e.is(n,"array")&&n.length>1&&(i=n[1]),i},copyFromHelper:function(e){this._dosThumbnailBatchFUN126428Enabled&&(this._collection._dosThumbnailBatchHelper=e._dosThumbnailBatchHelper,this._collection._dosThumbnailBatchHelper._collection=this._collection,this.startFetch(),this.updateThumbnails(e._dosThumbnailBatchHelper._helperId2dosThumburl||{}))},updateThumbnails:function(t){if(this._dosThumbnailBatchFUN126428Enabled)if(this._collection._isAHelper)this._helperId2dosThumburl=this._helperId2dosThumburl||{},e.merge(this._helperId2dosThumburl,t);else{t||(t=this._collection._pendingThumbnails),t&&(this._collection.forEach((function(e){var i=e._attributes.id;t[i]&&(e._attributes.preview_url_value=t[i])})),e.merge(this._collection._pendingThumbnails,t),Object.keys(this._collection._pendingThumbnails).length>0&&this._updateViewThumbnails())}},_updateViewThumbnails:function(){var t=this._collection._pendingThumbnails;if(t){var i=this._collection.getTreeDocument(),n=i.getRoots();i.prepareUpdate(),n.forEach((function(i){if(e.is(i)){var n=i.options.grid.id,s=i.options.grid.preview_url_value,o=t[n];if(o&&s!=o){var a={thumbnail:o};i.updateOptions(a)}o&&delete t[n]}})),i.pushUpdate()}},startFetch:function(){this._dosThumbnailBatchFUN126428Enabled&&(this._collection._pendingThumbnails=this._collection._pendingThumbnails||{})},startViewSync:function(){this._dosThumbnailBatchFUN126428Enabled&&(this._collection._view_sync_status=this._ViewSyncStatus.SYNC_STARTED)},endViewSync:function(){this._dosThumbnailBatchFUN126428Enabled&&(this._collection._view_sync_status=this._ViewSyncStatus.SYNC_ENDED,this._updateViewThumbnails())},destroy:function(){}})})),define("DS/SNResultUX/utils/SNResultTypeCustoHelper",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Options","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SNSearchTypeCusto","DS/SNInfraUX/PredefinedQueries"],(function(e,t,i,n,s,o,a){"use strict";return t.singleton(i,n,{init:function(){},getAdvancedSearchCustoTypeList:function(t,i,n){var s=o.getTypeCusto();return e.is(s)?e.is(i)?i.filter((function(e){if(s[e.uri])return!0})):this.buildFromCustoTypeList(s,n):(e.is(n)&&e.is(n.onFailure)&&e.is(n.onFailure,"function")&&n.onFailure.call(this),i)},getAdvancedSearchCustoInterfaceList:function(t,i){var n=o.getTypeCusto();if(e.is(n)){var s=n[t].interfaceURIs;if(s&&s.length>0)return i.filter((function(e){if(s.indexOf(e.name)>=0)return!0}))}return i},getGlobalSearchTypeCustoQuery:function(t){if(e.is(t)&&0!==t.trim().length&&t!==s.SearchTypeEnum.ADVANCED_SEARCH&&t!==s.SearchTypeEnum.MY_CONTENT&&t!==s.SearchTypeEnum.MY_RECENT_CONTENT&&t!==s.SearchTypeEnum.FAVORITE_SEARCH&&0!==t.indexOf(s.SearchTypeEnum.SIMILAR_SEARCH)&&!(a.isAPrefixedPQSearch(t)||a.isAPQSearch(t)||t.indexOf("flattenedtaxonomies:")>=0||t.indexOf("type:")>=0)){var i=o.getSearchTypeCustoQuery();if(i.length>0)return" AND ("+i+")"}return null},buildFromCustoTypeList:function(t,i){var n=[];if(!e.is(t))return n;var s={onComplete:function(s){for(var o in t){var a=o.split(":");if(a[0]===i.vocabId){var r=s[a[1]],l={abstract:!1,description:"",name:a[1],nlsName:r.nlsName,type:t[o].typeRef,uri:o};n.push(l)}}e.is(i)&&e.is(i.onComplete)&&e.is(i.onComplete,"function")&&i.onComplete.call(this,n)},onFailure:function(){e.is(i)&&e.is(i.onFailure)&&e.is(i.onFailure,"function")&&i.onFailure.call(this)}};o.getSearchTypeCustoListNLSNames(s)}})})),define("DS/SNResultUX/views/helpers/utils/TagCloud",["UWA/Class/View","UWA/Core","DS/SNInfraUX/SearchDebug","DS/SNInfraUX/SearchUtils","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/Controls/Button","DS/MessageBus/MessageBus","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],(function(e,t,i,n,s,o,a,r){return e.extend(i,{_tags:[],_container:null,_tagCloudContainer:null,_tagCloudContent:null,_tagCloudScrollable:null,_tmp:[],_setLocalFilter:()=>{},init:function(e){return this.setTags(e.tags?e.tags:[]),this._container=e.container?e.container:null,this._setLocalFilter=e.setLocalFilter?e.setLocalFilter:()=>{},this._tmp=[],this._tagCloudContainer=t.createElement("div",{class:"search-tagCloud-content-object"}),this._tagCloudContainer.inject(this._container),this._tagCloudContent=t.createElement("div",{class:"search-tagCloud-content-object-list"}).inject(this._tagCloudContainer),this._tagCloudScrollable=t.createElement("div",{class:"search-timeLine-content"}).inject(this._tagCloudContent),this._parent(e)},setTags:function(e){this._tags=e},reset:function(){this._tags=[],this._tagCloudScrollable.empty();for(let e=0;e<this._tmp.length;e++)this._tmp[e]&&this._tmp[e].destroy();this._tmp=[]},_flatTags:function(e,t){},_buildLayout:function(e){let i=this,s=[];for(e=e.reverse();s.length<e.length;){let o=n.getRandomInteger(0,e.length);if(s.includes(o))continue;s.push(o);let a=Math.round(30*(o+1)/e.length);a<10&&(a=10);let r=t.createElement("div",{class:"search-TagCloud-content-object-list-elt",styles:{"font-size":a+"px"}});r.inject(this._tagCloudScrollable),t.createElement("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-6w-what"}).inject(r),t.createElement("p",{class:"search-TagCloud-content-object-list-elt-label",content:e[o].dispText}).inject(r),r.addEventListener("click",(t=>{i._setLocalFilter.call(i,{headTitle:e[o].dispText})})),this._tmp.push(r)}},render:function(){this._buildLayout(t.clone(this._tags))},destroy:function(){this.reset(),this._tagCloudContainer&&this._tagCloudContainer.destroy(),this._tagCloudContent&&this._tagCloudContent.destroy(),this._tagCloudScrollable&&this._tagCloudScrollable.destroy(),this._parent()}})})),define("DS/SNResultUX/utils/ResultUX_customization",["DS/SNInfraUX/Logger","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Options","UWA/Class/Collection","DS/WebappsUtils/Performance","require"],(function(e,t,i,n,s,o,a,r,l,c){"use strict";var d=s.singleton(a,o,{_type_customization:{},_skeleton_facets:[],_actions_customization:null,_addin_mode:null,_other_ux_options:{},init:function(){this.setDebugMode(t.getDebugMode()),this._actions_customization=new r,this._actions_customization_modules=new r,this._check_type_inheritance=!0===t.getOption("add_taxonomies_in_select_clause")},addCustomization:function(t,i){var s=this,o=t.SearchCustomization,a=0,r=l.now().toString();function d(e,t){var i=!1,c=!1,d=!1;function u(){!0===d&&!0===i&&!0===c&&(a++,!1!==n.is(o)&&a!==o.length||(l.mark('{"module":"DS/SNResultUX/utils/ResultUX_customization","name":"ResultUX_customization::addCustomization","uuid":"'+r+'","status":"end","drilldown_serie_id":"ResultUX_customization::addCustomization"}'),t()))}l.mark('{"module":"DS/SNResultUX/utils/ResultUX_customization","name":"ResultUX_customization::addCustomization _loadTypeCustomization","uuid":"'+r+'","status":"start","drilldown_serie_id":"ResultUX_customization::addCustomization-Detail"}'),s._loadTypeCustomization(e.type_customization,(function(){l.mark('{"module":"DS/SNResultUX/utils/ResultUX_customization","name":"ResultUX_customization::addCustomization _loadTypeCustomization","uuid":"'+r+'","status":"end","drilldown_serie_id":"ResultUX_customization::addCustomization-Detail"}'),d=!0,u()})),l.mark('{"module":"DS/SNResultUX/utils/ResultUX_customization","name":"ResultUX_customization::addCustomization _loadActionsCustomization","uuid":"'+r+'","status":"start","drilldown_serie_id":"ResultUX_customization::addCustomization-Detail"}'),s._loadActionsCustomization(e.actions,(function(){l.mark('{"module":"DS/SNResultUX/utils/ResultUX_customization","name":"ResultUX_customization::addCustomization _loadActionsCustomization","uuid":"'+r+'","status":"end","drilldown_serie_id":"ResultUX_customization::addCustomization-Detail"}'),i=!0,u()})),l.mark('{"module":"DS/SNResultUX/utils/ResultUX_customization","name":"ResultUX_customization::addCustomization _loadViewsCustomization","uuid":"'+r+'","status":"start","drilldown_serie_id":"ResultUX_customization::addCustomization-Detail"}'),s._loadViewsCustomization(e.views,(function(){l.mark('{"module":"DS/SNResultUX/utils/ResultUX_customization","name":"ResultUX_customization::addCustomization _loadViewsCustomization","uuid":"'+r+'","status":"end","drilldown_serie_id":"ResultUX_customization::addCustomization-Detail"}'),c=!0,u()}))}if(l.mark('{"module":"DS/SNResultUX/utils/ResultUX_customization","name":"ResultUX_customization::addCustomization","uuid":"'+r+'","status":"start","drilldown_serie_id":"ResultUX_customization::addCustomization","drilldown":"ResultUX_customization::addCustomization-Detail"}'),s.updateOtherUXOptions(t),n.is(o)){l.mark('{"module":"DS/SNResultUX/utils/ResultUX_customization","name":"ResultUX_customization::addCustomization loop on custo","uuid":"'+r+'","status":"start","drilldown_serie_id":"ResultUX_customization::addCustomization-Detail"}');for(var u=0;u<o.length;u++)c([o[u]],(function(e){d(JSON.parse(e),i)}),(function(t){"timeout"!==t.requireType&&(e.warn("Cannot load view "+t.requireModules),++a===o.length&&(l.mark('{"module":"DS/SNResultUX/utils/ResultUX_customization","name":"ResultUX_customization::addCustomization loop on custo","uuid":"'+r+'","status":"end","drilldown_serie_id":"ResultUX_customization::addCustomization-Detail"}'),l.mark('{"module":"DS/SNResultUX/utils/ResultUX_customization","name":"ResultUX_customization::addCustomization","uuid":"'+r+'","status":"end","drilldown_serie_id":"ResultUX_customization::addCustomization"}'),i()))}))}else d(t,i)},setAddinMode:function(e){n.is(e,"string")&&(this._addin_mode=e)},updateOtherUXOptions:function(e){n.is(e.datagridview_columns)&&(this._other_ux_options.datagridview_columns=e.datagridview_columns)},getUXOption:function(e){return this._other_ux_options[e]},getDataGridViewColumns:function(){return this.getUXOption("datagridview_columns")},getAvailableActions:function(e,t,i){if(!n.is(e)||!n.is(e.attributes))throw new Error("Invalid Arg in ResultUX_customization.getAvailableActions!");if(n.is(i)&&n.is(i.inCtxOptions))t([]);else{var s=e.attributes["ds6w:what/ds6w:type_value"];n.is(s)||(s=e.attributes["ds6w:type_value"]);var o=this._actions_customization.get({id:d._getModelTypeValue(s)});if(!n.is(o)&&n.is(s,"array"))for(var a=0;a<s.length&&!n.is(o);a++)o=this._actions_customization.get({id:s[a]});if(this._check_type_inheritance&&!n.is(o)){var r=e.attributes.taxonomies_value,l=null;if(n.is(r,"string"))l=r;else if(n.is(r,"array"))for(var c=0;c<r.length;c++)if(n.is(r[c],"string")&&0===r[c].indexOf("types/")){l=r[c];break}if(n.is(l)){var u=l.split("/");if(n.is(u,"array"))for(var h=u.length-2;h>0&&!n.is(o);h--)o=this._actions_customization.get({id:u[h]})}}var g=function(e){t(e)},p=[];if(n.is(o))for(var _=o.get("available_impl"),f=0;f<_.length;f++){let t=_[f].getActionForObject(e.attributes,g,i);n.is(t,"array")&&(p=p.concat(t))}var m=this._actions_customization.get({id:"all"});if(n.is(m))for(var S=m.get("available_impl"),v=0;v<S.length;v++){let t=S[v].getActionForObject(e.attributes,g,i);n.is(t,"array")&&(p=p.concat(t))}t(p)}},availablefacets:function(){var e=[],t=null;t=n.is(this.model)?this.model:this;var s=d._getModelTypeValue(t.get("ds6w:what/ds6w:type_value"));if(!0===n.is(d._type_customization[s]))e.push.apply(e,d._type_customization[s].getAvailableFacetsIdAndOrder());else for(var o in d._skeleton_facets)d._skeleton_facets.hasOwnProperty(o)&&n.is(d._skeleton_facets[o])&&!0===d._skeleton_facets[o].is_facet_avalailable(this)&&e.push(i.result(d._skeleton_facets[o],"facet_idcard"));return e},availableviews:function(){var e={};for(var t in d._skeleton_facets)d._skeleton_facets.hasOwnProperty(t)&&(e[i.result(d._skeleton_facets[t],"facet_name")]=i.result(d._skeleton_facets[t],"facet_options"));return e},getMapping:function(){return{image:function(){var e=this.model||this,t=d._getModelTypeValue(e.get("ds6w:what/ds6w:type_value"));return n.is(d._type_customization[t])&&n.is(d._type_customization[t].image)?d._type_customization[t].image.call(e):e.get("preview_url")},icon:function(){var e=this.model||this,t=d._getModelTypeValue(e.get("ds6w:what/ds6w:type_value"));return n.is(d._type_customization[t])&&n.is(d._type_customization[t].icon)?d._type_customization[t].icon.call(e):e.get("type_icon_url")}}},idcardOptions:function(e,t,i){var s,o={};return n.is(e)&&(s=d._getModelTypeValue(e.get("ds6w:what/ds6w:type_value")||e.get("ds6w:what/ds6w:type"))),n.is(s)&&n.is(d._type_customization[s])&&n.is(d._type_customization[s].getIdCardOpts)?(d.log("ResultUX_customization specific IDCard options set"),o=d._type_customization[s].getIdCardOpts(e)):n.is(t)?(o=d._getResultContentsIdCard(t),n.is(i)&&(o.events=i)):o=d._getResultContentsIdCard(),o},_loadTypeCustomization:function(t,i){if(n.is(t,"array")&&t.length>0)for(var s=0,o=0;o<t.length;o++)require([t[o]],(function(e){var o=new e;if(n.is(o.name,"string"))d._type_customization[o.name]=o;else{if(!n.is(o.names,"array"))throw new Error("Invalid type defined");for(var a=0;a<o.names.length;a++)d._type_customization[o.names[a]]=o}++s===t.length&&i()}),(function(n){"timeout"!==n.requireType&&(e.warn("Cannot load type customization "+n.requireModules),++s===t.length&&i())}));else this.log("No type customization loaded"),i()},_loadActionsCustomization:function(t,i){if(n.is(t))for(var s=this,o=0,a=0;a<t.length;a++){var r=t[a];n.is(this._actions_customization_modules.get(r))?++o===t.length&&i():(s._actions_customization_modules.add({id:t[a]}),require([r],(function(e){for(var a=new e({addinmode:s._addin_mode}),r=a.availableForTypes(),l=0;l<r.length;l++){var c=s._actions_customization.get({id:r[l]});n.is(c)?(s.log("Update action model"),c.get("available_impl").push(a)):s._actions_customization.add({id:r[l],available_impl:[a]})}++o===t.length&&i()}),(function(n){"timeout"!==n.requireType&&(e.warn("Cannot load view "+n.requireModules),++o===t.length&&i())})))}else this.log("No actions loaded"),i()},_loadViewsCustomization:function(t,i){if(n.is(t))for(var s=this,o=t.skeleton.facets,a=0,r=0;r<o.length;r++)n.is(s._skeleton_facets[o[r].id])?(this.log("View already added with the same id "+o[r].id),this.log("Do not load "+o[r].implementation),++a===o.length&&i()):(s._skeleton_facets[o[r].id]=null,require([o[r].implementation],(function(e){s._skeleton_facets[e.facet_name]=e,++a===o.length&&i()}),(function(t){"timeout"!==t.requireType&&(e.warn("Cannot load view "+t.requireModules),++a===o.length&&i())})));else this.log("No actions loaded"),i()},_getResultContentsIdCard:function(e){var i,s=n.is(e)?n.extend(e.mapping,d.getMapping(),!0):d.getMapping();return i={thumbnailUrl:function(){return d._getValueWithMapping("image",this,s)},bannerUrl:"",attributesMapping:s,facets:d.availablefacets,nativeActionMenu:!0,actions:function(){var e=[],i=this;return this.actions.forEach((function(s,o){if(o<7){var a={text:s.get("title"),icon:s.get("icon"),handler:s.get("callback")};n.is(s.get("callback"))?a.handler=function(e){var t={model:e.model,action_id:s.get("id"),object_id:e.model.get("id"),collection:e.model.collection};s.get("callback")(t,arguments)}:t.getOption("search_web_in_win")&&n.is(s.get("sourcejs"))&&(a.handler=function(){require([s.get("sourcejs")],(function(e){var t={action_id:s.get("id"),object_id:i.get("id")};e.executeAction(t)}))}),e.push(a)}})),e}},i},_getValueWithMapping:function(e,t,i){var s;if(e in i&&n.is(i[e],"function")){var o={model:t};s=i[e].call(o)}else void 0===(s=t.get(e))&&(s="");return s},_getModelTypeValue:function(e){return n.is(e,"array")?Array.prototype.join.call(e,"/"):e}});return d})),define("DS/SNResultUX/utils/WildcardMgr",["UWA/Core","UWA/Class","UWA/Class/Debug","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/PredefinedQueries","DS/SNInfraUX/SearchUtils"],(function(e,t,i,n,s,o){"use strict";return t.singleton(i,{_specialSearchCriteria:["*","#all",o.SearchTypeEnum.MY_CONTENT,o.SearchTypeEnum.MY_RECENT_CONTENT,o.SearchTypeEnum.ADVANCED_SEARCH,o.SearchTypeEnum.FAVORITE_SEARCH],_operators:[":","(",")"," AND "," OR ","=","==","!=","<",">","<=",">="," NOT "," BUTNOT "," XOR "," OPT "," NEAR "," NEXT "," AFTER "," BEFORE "," INNERJOIN "," SPLIT "],init:function(){this.setDebugMode(!0)},isASpecialCriteria:function(e){for(var t=!1,i=0;i<this._specialSearchCriteria.length;i++)if(this._specialSearchCriteria[i]===e){t=!0;break}return t},isAnAdvancedCriteria:function(t){if(!e.is(t,"string"))throw new Error("Invalid arg in isAnAdvancedCriteria");for(var i=!1,n=0;n<this._operators.length;n++)if(t.indexOf(this._operators[n])>0){i=!0;break}return i},isAnExactCriteria:function(t){var i=!1;return e.is(t)&&'"'===t[0]&&'"'===t[t.length-1]&&(i=!0),i},containsNonLatinChars:function(t){if(!e.is(e.is(t,"string")))throw new Error("Invalid arg in WildcardMgr.containsNonLatinChars");var i=!1,n=0;for(n=0;n<t.length&&!1===i;n++)t.charCodeAt(n)>255&&(i=!0);return i},getInfo:function(t){var i={searchCriteria:t};if(e.is(t)){i.searchCriteria.trim().length>0&&(i.searchCriteria=i.searchCriteria.trim()),i.isAnExactCriteria=this.isAnExactCriteria(i.searchCriteria),i.isASpecialCriteria=this.isASpecialCriteria(i.searchCriteria),i.isAdvancedCriteria=this.isAnAdvancedCriteria(i.searchCriteria),i.indexOfTwoDots=i.searchCriteria.indexOf(":"),i.pqAbbrevation=s.isAPQSearch(i.searchCriteria),i.indexOfwildChar=i.searchCriteria.indexOf("*"),i.containsNonLatinChars=this.containsNonLatinChars(i.searchCriteria);var o=i.searchCriteria.split(" ");if(e.is(o))for(var a=0,r=o.length;a<r;a++)if(e.is(o[a])&&s.isAPQSearch(o[a])){var l=o[a].split(":"),c="";if(e.is(l)&&2===l.length){if(0===(c=l[1]).length&&(c="*"),n.getOption("wildcard_addition")){var d=this.isASpecialCriteria(c),u=this.isAnAdvancedCriteria(c),h=this.isAnExactCriteria(c),g=c.indexOf("*"),p=this.containsNonLatinChars(c);h||d||u||p||-1!==g||(c="*"+c+"*")}l[1]=c,o[a]=l.join(":")}}i.searchCriteria=o.join(" "),e.is(i.pqAbbrevation)&&!1===i.isAdvancedCriteria&&(i.searchCriteria=i.searchCriteria.substring(i.indexOfTwoDots+1,i.searchCriteria.length),i.searchCriteria.trim().length>0&&(i.searchCriteria=i.searchCriteria.trim()),i.isASpecialCriteria=this.isASpecialCriteria(i.searchCriteria),i.isAdvancedCriteria=this.isAnAdvancedCriteria(i.searchCriteria),i.isAnExactCriteria=this.isAnExactCriteria(i.searchCriteria),i.indexOfwildChar=i.searchCriteria.indexOf("*"))}return i},manageWildcardAddtion:function(t,i){var s=function(e,t){for(var i=t,n=1;n>0&&i<e.length;){i++;var s=e.charAt(i);"("===s?n++:")"===s&&n--}return i>=e.length&&(i=-1),i};if(t===o.SearchTypeEnum.ADVANCED_SEARCH||t===o.SearchTypeEnum.MY_CONTENT||t===o.SearchTypeEnum.MY_RECENT_CONTENT||t===o.SearchTypeEnum.FAVORITE_SEARCH)return t;null!=t&&t.trim().length>0&&(t=t.trim());var a=!1,r=t.match(/\(([^()]+)\)/g);for(e.is(r,"array")&&1===r.length&&r[0]===t&&(a=!0,t=t.substring(1,t.length-1));t.startsWith("(")&&s(t,0)===t.length-1;)a=!0,t=t.substring(1,t.length-1);var l=this.getInfo(t),c=l.searchCriteria,d=!1,u=e.is(i)?i.addWildCard_inCtx:void 0;return n.getOption("wildcard_addition")||!0===u?e.is(l.pqAbbrevation)?l.isAnExactCriteria||l.isASpecialCriteria||l.isAdvancedCriteria||l.containsNonLatinChars||(l.indexOfwildChar>-1?l.searchCriteria=l.pqAbbrevation+":"+l.searchCriteria:(c=l.pqAbbrevation+":*"+l.searchCriteria+"*",d=!0)):l.isAnExactCriteria||l.isASpecialCriteria||l.isAdvancedCriteria||l.containsNonLatinChars||l.indexOfwildChar>-1||c.length&&(c="*"+l.searchCriteria+"*",d=!0):!e.is(l.pqAbbrevation)||l.isAnExactCriteria||l.isASpecialCriteria||l.isAdvancedCriteria||l.containsNonLatinChars||-1!==l.indexOfwildChar||0!==l.searchCriteria.length||(c=l.pqAbbrevation+":*",d=!0),!d&&e.is(l.pqAbbrevation)&&!1===l.isAdvancedCriteria&&(c=l.pqAbbrevation+":"+c),(a||l.isAdvancedCriteria)&&(c="("+c+")"),c}})})),define("DS/SNResultUX/unitconversion/SNUnitConversionHelper",["UWA/Core","UWA/Class","UWA/Class/Debug","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SNUnitConversion","DS/SNSearchResultsCusto/model/SNResultsCustomizationModel","DS/SNSearchResultsCusto/utils/SearchResultsCustomizationPreferences","DS/SNInfraUX/SearchSettings"],(function(e,t,i,n,s,o,a,r,l){"use strict";var c=t.extend(i,{_resources:null,init:function(){},_getActiveColumnCustomization:function(){let t=new Map,i=r.getActiveCustomization();if(e.is(i)&&e.is(i.views,"object"))for(let s in i.views){var n=[];e.is(i.getAllAttributesByView)?n=i.getAllAttributesByView(s):e.is(i.views[s].general,"array")&&(n=i.views[s].general),n.forEach((i=>{e.is(i.dataIndex)&&e.is(i.dataType)&&i.dataType.length>0&&!t.has(i.dataIndex)&&t.set(i.dataIndex,i.dataType)}))}return{columnCusto:t,isAdminCusto:!(!i||"admin"!==i.role)}},convertValuesToPreferredUnits:function(t){var i=new RegExp(/^[-+]?\d*\.?\d+$/),n=!l.getOption("convertOnlyDs6wgPredicates"),s=this._getActiveColumnCustomization(),a=s.columnCusto;return function(r){var l,c,d,u,h,g=this,p=arguments,_=(l=r._models,c={},d={},u={},h=new Set,l.forEach((function(e){var t=e.getSourceID();if(t&&"3dspace"===t){var o=e.getType();o&&(o.indexOf(":")<1&&(o="ds6wg:"+o),e.keys().forEach((function(t){if((/ds6wg:\w+\.\w+/.test(t)||n)&&i.test(e.get(t))&&e.get(t+"_value")&&(a.has(t)||s.isAdminCusto)){var r=d[t];r||(d[t]=[],r=d[t]),r.push(e.get(t)),u[t]=a.get(t)||o}})))}})),s.isAdminCusto&&(l.forEach((function(t){t.keys().forEach((function(i){"ds6w:kind"===i&&(e.is(t.get(i+"_value"),"array")?t.get(i+"_value").forEach(h.add,h):h.add(t.get(i+"_value")))}))})),h=[...h]),c.extsToLoad=h,c.data=d,c.predicate2Type=u,c);o.setResources(r.search_ressources),o.convertValues({toPreferredUnit:!0,data:_.data,predicate2Type:_.predicate2Type,callback:function(e){if(function(e,t){e.forEach((function(e){e.keys().forEach((function(i){if((i.startsWith("ds6wg:")||n)&&e.get(i+"_value")){var s=t[i];if(s){var o=s[e.get(i)];o&&e.set(i,o)}}}))}))}(r._models,e),t)return t.apply(g,p)}})}},prepareRequestDataF:function(e,t){let i=t.data,n=t.predicate2Type;if(e){var s=this._getTypeAndExtensionList(e,t);Object.keys(e).forEach((function(t){var o=t.substring(5),a=e[t];i[o]||(i[o]=[]),a.forEach((function(e){var t=e.object;t&&("string"===e.type?i[o].push(t):"double"!==e.type&&"integer"!==e.type||(t.from&&i[o].push(t.from),t.to&&i[o].push(t.to)),n[o]=s)}))}))}},_getTypeAndExtensionList:function(e){return this.getTypeListFromFilters(e).concat(this.getExtensionListFormFilters(e))},getExtensionListFormFilters:function(t){var i=[],n=t["sixw:vpmextension"];return e.is(n,"array")&&n.forEach((e=>{i.push(e.object)})),i},getTypeListFromFilters:function(e){var t=[];if(e)for(var i in e){if("ds6w:type"===i.split("/").pop()){var n=e[i];n&&n.length>0&&t.push(n[0].object)}}return t},modifyFilterData:function(e,t){e&&Object.keys(e).forEach((function(i){var n=i.substring(5);e[i].forEach((function(e){var i=e.object;t[n]&&("string"===e.type?(i=t[n][i])&&(e.object=i):"double"!==e.type&&"integer"!==e.type||i&&(i.from&&(i.from=t[n][i.from]),i.to&&(i.to=t[n][i.to])))}))}))},copyConvertedValuesToOriginalFilter:function(e,t){Object.keys(e).forEach((function(i){e[i].forEach((function(e){e.object.from&&t[i][0].object.from&&(e.object.from=t[i][0].object.from),e.object.to&&t[i][0].object.to&&(e.object.to=t[i][0].object.to)}))}))}});return c})),define("DS/SNResultUX/utils/ConfigActions",["UWA/Core","UWA/Controls/Abstract","UWA/Utils/InterCom","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchPreferences"],(function(e,t,i,n,s){"use strict";return t.extend({name:"Config_Explore_Action",_compass_socket:null,_action_info:null,_role_check_promise:null,init:function(){this._action_info=[{title:"Tree View",icon:"network",id:"config_explore",multisel:!1,callback:this.launchCustoAction.bind(this)}]},availableForTypes:function(){var e=[];return s.getItem("nav_history")&&(e=["Product Configuration","Configuration Feature","Configuration Option","VPMCfgConfiguration","VPMReference"]),e},getActionForObject:function(){return this._action_info},launchCustoAction:function(t){if(!e.is(t))throw new Error("INVALID data received while trying to execute the whereUsed action");var s=t.actionsHelper,o=t.object_ids[0],a={protocol:"3DXContent",version:"1.1",source:n.getSearchAppId(),widgetId:t.widget_id,data:{items:[{envId:s.getPlatformID({id:o}),serviceId:s.getServiceID({id:o}),contextId:"",objectId:o,objectType:s.getValue({id:o,attribute:"ds6w:type"}),displayName:s.getValue({id:o,attribute:"ds6w:label"}),displayType:s.getValue({id:o,attribute:"ds6w:type"})}]}},r="ConfigActions";null===this._compass_socket&&(this._compass_socket=new i.Socket(r),this._compass_socket.subscribeServer("com.ds.compass",window.parent)),this._compass_socket.dispatchEvent("onSetX3DContent",a,r),n.setContentVisibility("Explore"),n.instantiateAppInSearch("ExploreList","ENOSC2D_AP",a,t),n.instantiateAppInSearch("Explore3D","ENOSC3D_AP",a,t)}})})),define("DS/SNResultUX/utils/PowerBySearchLocalActions",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Promise","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchUtils","DS/MessageBus/MessageBus"],(function(e,t,i,n,s,o,a){"use strict";return t.singleton(i,{init:function(){this._subscribePowerByIntegration()},getPowerByActions:function(e){var t=this;this.powerByActionsPromise||(this.powerByActionsPromise=new n((function(t,i){e.options.isAddinMode?o.getPowerByInitPromise().then((function(){a.subscribe({channel:"SearchUXPowerByIntegration",topic:"HasPowerByActionsRes",callback:function(e){t(e)}}),a.publish({channel:"SearchUXPowerByIntegration",topic:"HasPowerByActionsReq",data:{}})})):t("server")}))),this.powerByActionsPromise.then((function(i){"server"===i?e.server_actions.call():"local"===i&&(t._queue.push(e.options),a.publish({channel:"SearchUXPowerByIntegration",topic:"PowerByActionsReq",data:e.options.data}))}))},_subscribePowerByIntegration:function(){this._queue=[],a.subscribe({channel:"SearchUXPowerByIntegration",topic:"PowerByActionsRes",callback:this._onPowerByActions.bind(this)})},_onPowerByActions:function(e){this._queue.length>0&&this._queue.shift().onComplete(e)}})})),define("DS/SNResultUX/webinwin/WebInWinTaggerProxy",["UWA/Core","UWA/Class/Debug","UWA/Class/Events","DS/TagNavigatorProxy/TaggerWebInWinProxy","DS/SNInfraUX/Logger"],(function(e,t,i,n,s){"use strict";return n.extend(i,t,{init:function(t){s.log("WebInWinTaggerProxy init:",t),this._parent.call(this,t),this.tenant=t.tenant,this.is6WInWebInWinActive=!!(t&&t.embeddedTagger&&t.embeddedTagger.is6WInWebInWinActive)&&t.embeddedTagger.is6WInWebInWinActive,this._socket&&this._socket.removeListener("onGroupingChange"),this._socket&&this._socket.addListener("onGroupingChange",(function(i){e.is(i)&&e.is(i.groups,"array")||s.warn("Error, expect to have parameters.groups as an array !!!"),t.events.addGroupingChangeListener.call(null,i)}))},clearLocalGrouping:function(){if(!this.is6WInWebInWinActive||!1!==this.is6WInWebInWinActive){s.log("TaggerWebInWinProxy.clearLocalGrouping sent");var e={notif_name:"event4taggerWebInWin",notif_parameters:{event_id:"clearLocalGrouping",proxyId:this._proxyId,contextId:this._contextId}};this._dispatchEvent(e)}},_requestGroupingChange:function(e){s.log("TaggerWebInWinProxy._requestGroupingChange sent");var t={notif_name:"event4taggerWebInWin",notif_parameters:{event_id:"_requestGroupingChange",proxyId:this._proxyId,options:e,contextId:this._contextId}};this._dispatchEvent(t)},setEmbeddedViewProperties:function(e){if(this.is6WInWebInWinActive&&!1===this.is6WInWebInWinActive)return;s.log("Received setEmbeddedViewProperties event: "+e);let t={notif_name:"event4taggerWebInWin",notif_parameters:{event_id:"setEmbeddedViewProperties",proxyId:this._proxyId,options:e,contextId:this._contextId}};this._dispatchEvent(t)}})})),define("DS/SNResultUX/utils/SearchServices",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Events","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SecurityContextManager","DS/UIKIT/Alert","DS/SNInfraUX/ServiceDelegationLoader","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],(function(e,t,i,n,s,o,a,r,l,c,d){"use strict";return t.singleton(n,i,{name:"DS_SNResultUX_utils_SearchServices",attributeToFilterForExport:["id","type_icon_url","preview_url","actions","resourceid","resourceid_tagger","actions"],globalActions:["exportToCmd","print","save_search","refresh_search","kpi_pcs_action","Grid_Custo"],current_collection:null,odtMode:!1,informationPanel:void 0,previewPanel:void 0,no_result:!1,_previousSlice:{start:-1,end:-1},_skeletonAlert:null,init:function(){this.setDebugMode(o.getDebugMode())},setPreviousSlice:function(e,t){this._previousSlice.start=e,this._previousSlice.end=t},resetPreviousSlice:function(){this._previousSlice.start=-1,this._previousSlice.end=-1},isEqualPreviousSlice:function(e,t){return this._previousSlice.start===e&&this._previousSlice.end===t},getinformationPanel:function(){void 0===this.informationPanel&&(this.informationPanel=o.getOption("informationsPanel"),!1===this.informationPanel&&"3DSwym"===a.identifyClientInfo().identifier&&(this.informationPanel=!0));return this.informationPanel},getpreviewPanel:function(t){var i=this;return void 0===i.previewPanel&&(i.previewPanel=o.getOption("previewPanel")),e.is(t)&&e.is(t.widgetId)&&e.is(e.Widgets)&&e.is(e.Widgets.instances)&&(i.previewPanel=!0,e.Widgets.instances.forEach((function(n){if(n.id===t.widgetId){var s=n.getValue("addinmode");e.is(s)&&"catiav5"===s&&(i.previewPanel=!0)}}))),i.previewPanel},setODTMode:function(e){this.odtMode=e},_displayAlert:function(t){let i=this;if(!e.is(t)||!e.is(t.message))throw new Error("E_INVALIDARG: bad options given to _displayAlert method !");let n=t.container;e.is(n)||(n=e.extendElement(document.body).getElement(".onesearch_results"),e.is(t.widgetId)&&e.is(e.Widgets)&&e.is(e.Widgets.instances)?e.Widgets.instances.forEach((function(i){i.id===t.widgetId&&(n=e.extendElement(i.elements.body).getElement(".onesearch_results"))})):e.is(n)||(n=e.extendElement(document.body).getElement(".main")));var s=t.message,o="primary";e.is(t.className,"string")&&(o=t.className),e.is(n)||(n=e.extendElement(document.body).getElement(".onesearch_results"));var a={visible:!0,autoHide:!0,hideDelay:t.delay?t.delay:8e3,closable:!0,messages:[{message:s,className:o}],attributes:{id:"search-alert"},events:{onRemoveMessage:()=>{i.skeleton?i.skeleton._alert&&i.skeleton._alert.elements&&i.skeleton._alert.elements.container&&i.skeleton._alert.elements.container.destroy()&&(i.skeleton._alert=null):i.oAlert&&i.oAlert.elements&&i.oAlert.elements.container&&i.oAlert.elements.container.destroy()&&(i.oAlert=null)}}};e.is(t.events)&&(a.events=t.events),e.is(this.skeleton)?(this.skeleton._alert&&(this.skeleton._alert.destroy(),this.skeleton._alert=null),this.skeleton._alert=new l(a).inject(n,"top")):(this.oAlert&&(this.oAlert.destroy(),this.oAlert=null),sessionStorage.getItem("isODTMode-IR-993129")?new l(a).inject(n,"top"):this.oAlert=new l(a).inject(n,"top"))},setDragData:function(t,i){if(e.is(t)&&e.is(i)){var n=i.draggedModels;if(e.is(n,"array")){var l,c=!!e.is(o.getOption("search_web_in_win"))&&o.getOption("search_web_in_win"),d={protocol:"3DXContent",version:"2.1",source:a.getSearchAppId(),widgetId:i.widgetId,data:{items:[]}},u=[],h=[];if(l=e.is(i.securityContext)?i.securityContext:r.getSecurityContextObject(),n.forEach((function(e){var t={envId:e.getPlatformID(),serviceId:e.getServiceID(),contextId:l,objectId:e.id,objectType:e.get("ds6w:type_value")?e.get("ds6w:type_value"):e.get("ds6w:what/ds6w:type_value"),displayName:e.get("ds6w:label"),i3dx:e.getI3dx()||"",displayType:e.get("ds6w:type")?e.get("ds6w:type"):e.get("ds6w:what/ds6w:type")};c&&(t.session_object=e.hasOwnProperty("session_object")),h.push('"'+t.displayName+'"'),u.push(t)})),s.log("number of dragged objects "+u.length),d.data.items=u,t.dataTransfer&&t.dataTransfer.setData){t.dataTransfer.setData("text",JSON.stringify(d));var g=!!document.documentMode,p=!g&&!!window.StyleMedia;g||p||t.dataTransfer.setData("shortData",JSON.stringify(h));try{t.dataTransfer.setData("text/searchitems",JSON.stringify(d))}catch(e){s.log("event.dataTransfer.setData DOES NOT accept text/searchitems")}c&&t.dataTransfer.setData("text/plain",JSON.stringify(d)),t.dataTransfer.effectAllowed="all"}}}},buildCompassSelectionData:function(t){let i={};if(e.is(t)&&e.is(t.selectedModels,"array")&&t.selectedModels.length>0){let n=t.selectedModels,o=[];n.forEach((function(t){if(e.is(t,"object")&&e.is(t.getPlatformID,"function")&&e.is(t.getServiceID,"function")&&e.is(t.get,"function")){let i={envId:t.getPlatformID(),objectId:t.id,serviceId:t.getServiceID(),objectType:t.get("ds6w:type_value"),displayName:t.get("ds6w:label_value"),contextId:"",displayPreview:t.get("preview_url"),displayIcon:t.get("type_icon_url"),i3dx:t.getI3dx()||"",displayType:t.get("ds6w:type")},n=t.pairs();for(let t=0;t<n.length;t++){let s=n[t][0],o=n[t][1];if(e.is(s)&&-1!==s.indexOf("_value")&&(-1!==s.indexOf("ds6w:")||-1!==s.indexOf("ds6wg:"))&&(-1!==s.indexOf("status_value")||-1!==s.indexOf("policy_value")||-1!==s.indexOf("revision_value")||-1!==s.indexOf("reserved_value")||-1!==s.indexOf("cadMaster_value")||-1!==s.indexOf("kind_value"))){i[s.replace("_value","")]=o}}i.snippets=t.get("snippetAsStringArray"),o.push(i)}})),s.log("[SearchServices] - number of selected objects :"+o.length),i={protocol:"3DXContent",version:"2.1",source:a.getSearchAppId(),widgetId:t.widgetId,data:{items:o}}}return i},handleMyContentTags:function(e){for(var t=0,i=0,n=0,s=0;s<e.length;s++)if("ds6w:what/ds6w:type"===e[s].sixw){t+=e[s].count;var o=e[s].object;"PLMWspFavoriteSearch"===o||"SavedSearch"===o?i+=e[s].count:"PLMWspFavoriteAuthoring"!==o&&"PLMWspFavoriteNavigation"!==o||(n+=e[s].count)}var a=t-i-n;if(a>0){var r={count:a,dispValue:d.get("myContent_otherThanFav"),field:"implicit",object:"#myOtherContent",sixw:"ds6w:what/ds6w:category",type:"string"};e.push(r)}if(i>0){var l={count:i,dispValue:d.get("myContent_searchFav"),field:"implicit",object:"#myFavoriteSearches",sixw:"ds6w:what/ds6w:category",type:"string"};e.push(l)}if(n>0){var c={count:n,dispValue:d.get("myContent_otherFav"),field:"implicit",object:"#myFavoriteContent",sixw:"ds6w:what/ds6w:category",type:"string"};e.push(c)}return e},getRelations:function(t){if(e.is(t,"object")){var i=t.model;e.is(i,"object")&&e.is(t.onComplete,"function")&&e.is(t.onFailure,"function")&&c.load({serviceID:i.getServiceID(),platformID:i.getPlatformID()}).then((function(n){e.is(n.getRelations,"function")?n.getRelations({model:i,onComplete:t.onComplete,onFailure:t.onFailure}):t.onFailure.call(void 0,"service delegation not implemented")}),(function(){t.onFailure.call(void 0,"service delegation not found")}))}},addGetTaggerVisibilityFlagCB:function(t){s.log("SearchServices.addGetTaggerVisibilityFlagCB");let i=!0;e.is(this.listCBForTaggerVisibility)||(this.listCBForTaggerVisibility=[],i=!1),this.listCBForTaggerVisibility.push(t),!i&&window.hasOwnProperty("sendNotificationWebInWin")&&e.is(sendNotificationWebInWin,"function")&&sendNotificationWebInWin("isTaggerVisible",JSON.stringify({}))},isTaggerVisibleFlag:function(t){if(s.log("SearchServices.isTaggerVisibleFlag",t),e.is(this.listCBForTaggerVisibility)){for(let e=0,i=this.listCBForTaggerVisibility;e<i;e++)this.listCBForTaggerVisibility[e](t);this.listCBForTaggerVisibility=null}},filterSourceList:function(e){return e=e.filter((function(e){return d.get("adv_search.source."+e)!=="adv_search.source."+e||(s.warn("Data source : "+e+" has no NLS defined, so filtering it as not validated !!!"),!1)}))},_highlightTerms:function(t,i){if(!e.is(t)||!e.is(t.getSnippetInformation,"function"))throw s.warn("Invalid input for SearchServices._highlightTerms:",t),new Error("Invalid input for SearchServices._highlightTerms!");if(!e.is(i))throw s.warn("Invalid input for SearchServices._highlightTerms:",i),new Error("Invalid input for SearchServices._highlightTerms!");let n=t.get("snippetAsStringArray");for(let e=0,t=n.length;e<t;e++)this._applyHTMLHighlight(i,n[e],"highlightedSearchCriteria")},_getStringsToHighlight:function(t){let i=[];if(!e.is(t)||!e.is(t.getSnippetInformation,"function"))throw s.warn("Invalid input for SearchServices._getStringsToHighlight:",t),new Error("Invalid input for SearchServices._getStringsToHighlight!");let n=t.getSnippetInformation();return e.is(n,"object")&&(e.is(n["ds6w:description"])&&(i=i.concat(n["ds6w:description"].text)),e.is(n.ds6w)&&(i=i.concat(n.ds6w.text))),i},_applyHTMLHighlight:function(t,i,n){let o=e.is(n,"string")?n:"highlightedSearchCriteria";if(!e.is(t)||!e.is(t.querySelectorAll,"function"))throw s.warn("Invalid input in SearchServices.highlight, ",t),new Error("Invalid input in SearchServices.highlight !");let a=Array.prototype.slice.call(t.querySelectorAll("*"));a=a.map((function(e){return Array.prototype.slice.call(e.childNodes)})),a=a.reduce((function(e,t){return e.concat(t)})),a=a.filter((function(e){return e.nodeType===document.TEXT_NODE&&e.textContent.indexOf(i)>-1})),a=a.forEach((function(e){var t=e.nextSibling,n=e.parentNode,s=e.textContent,a=[];e.parentNode.removeChild(e),s.split(i).forEach((function(e,t,n){a.push(document.createTextNode(e)),t<n.length-1&&(a.push(document.createElement("mark")),a[a.length-1].innerHTML=i,a[a.length-1].setAttribute("class",o))})),a.forEach((function(e){t?n.insertBefore(e,t):n.appendChild(e)}))}))},setTaggerDisplayStatus:function(e){this._TaggerdisplayStatus=e},getTaggerDisplayStatus:function(){return!!this._TaggerdisplayStatus}})})),define("DS/SNResultUX/views/WebUX/Tree/TreeNodeView",["DS/Tree/TreeNodeView","DS/Core/PointerEvents","DS/Utilities/Dom"],(function(e,t,i){"use strict";return e.extend({_observeEvents:function(){var e,n=this,s=0,o=!1;this.elements.container.addEvent(t.POINTERDOWN,(function(e){i.increaseCurrentPositionInStack(n.elements.container),o=!1,e.touchFlag||(o=n._uiNodeUpForTouchOrDownForMouse(e,"down")),i.decreaseCurrentPositionInStack()})),this.elements.container.addEvent("click",(function(t){i.pushUserInteractionContext();var a=n.getCellInfos();o||!1!==a.isHeader||"selection"===a.dataIndex||"actions"===a.dataIndex||n._uiNodeUpForTouchOrDownForMouse(t,"up"),o=!1,void 0!==e&&clearTimeout(e),e=setTimeout((function(){s=0}),300),s++,1===t.which&&((1===s||t.touchFlag&&0===t.detail)&&(a=n.getCellInfos(),n.getGridEngine()._modelEvents.publish({event:"nodeclick",data:a})),2===s&&n.getGridEngine()._modelEvents.publish({event:"nodeDblClick",data:n.getCellInfos()})),i.popUserInteractionContext()})),this._eventDetailDown=0,this._eventDetailDownTO;var a=function(e){i.pushUserInteractionContext(),"touchend"===e.type&&e.preventDefault(),1!==e.which&&"touchend"!==e.type||n._uiExpandCollapse(),i.popUserInteractionContext()};this.elements.expanderContainer.addEvent("mouseup",a),this.elements.expanderContainer.addEvent("touchend",a);var r=function(e){e.stopPropagation(),e.preventDefault()};this.elements.expanderContainer.addEventListener("contextmenu",r),this.elements.expanderContainer.addEventListener(t.LONGHOLD,r)}})})),define("DS/SNResultUX/utils/SNResultPreferences",["UWA/Core","UWA/Class","UWA/Class/Debug","DS/SNInfraUX/Logger","DS/SNInfraUX/utils/SNPreferenceUtil"],(function(e,t,i,n,s){"use strict";return t.singleton(i,{setUserUnitPreference:function(e){s.setUserUnitPreference(e)},getPreferenceUnitForDimension:function(e){return s.getPreferenceUnitForDimension(e)}})})),define("DS/SNResultUX/views/utils/PropertiesView",["UWA/Element","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/SearchUtils","DS/UIKIT/Alert","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","UWA/Core","UWA/Class/Debug","UWA/Class/Collection","DS/W3DXComponents/Views/Temp/TempItemView","DS/W3DXComponents/Skeleton","UWA/Utils/Client","UWA/Controls/Scroller","css!DS/SNResultUX/SNResultUX.css"],(function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p){"use strict";var _="properties",f=["type_icon_url","id","resourceid","resourceid_tagger","preview_url","image","icon","actions","subtitle","icon_source"],m=d.extend(l,{name:_,tagName:"div",template:function(){var e=this;return 0!==e.model.id.indexOf("swym:")&&!0!==i.getOption("search_web_in_win")&&r.is(e._newEdit)&&!0===e._newEdit?'<div class="'+e.getClassNames("-sub-container")+' propertiesDiv"><div class="properties-body"></div></div>':'<div class="'+e.getClassNames("-sub-container")+' propertiesDiv"><table class="table properties-body"></table></div>'},setup:function(){this.setDebugMode(i.getDebugMode()),this.container.addClassName(this.getClassNames("-container")),this.useNewEditProp((function(e){t.log("Use new Property tab="+e)}))},_HTMLDecode:function(e){return e?e=(e=(e=(e=(e=e.replace(/&amp;/g,"&")).replace(/&gt;/g,">")).replace(/&lt;/g,"<")).replace(/&quot;/g,'"')).replace(/&#039;/g,"'"):e},hasPARRole:function(e){var t=this,n=i.getOption("PARRole");if(r.is(n))return t._hasPARRole=!0===n,void e(t._hasPARRole);if(r.is(t._hasPARRole))e(t._hasPARRole);else{t._hasPARRole=!1;try{s.getGrantedRoles((function(i){for(var n=0;n<i.length;n++)i[n]&&"PAR"===i[n].id&&(t._hasPARRole=!0,t._newPropertyReadOnly=!1);e(t._hasPARRole)}))}catch(i){t._hasPARRole=!1,e(t._hasPARRole)}}},useNewEditProp:function(e){var t=this;if(r.is(t._newEdit))e(t._newEdit);else{t._newEdit=!1;var n=i.getOption("NewPropertiesTabUIMode");if(r.is(n))return t._newEdit=!0,t._newPropertyReadOnly=!0,"Edit"===n&&(t._newPropertyReadOnly=!1),void e(t._newEdit);t.hasPARRole((function(i){!0===i&&(t._newEdit=!0),e(t._newEdit)}))}},onRender:function(){this.log("onRender the PropertiesView");var s=this;s.useNewEditProp((function(l){var c=null,d=null;if(0!==s.model.id.indexOf("swym:")&&!0!==i.getOption("search_web_in_win")&&!0===l){if(c=s.container.getElement(".properties-sub-container"),d=s.container.getElement(".properties-body"),!0!==i.getOption("search_web_in_win")&&require(["DS/PlatformAPI/PlatformAPI"],(function(e){var t={paths:[],attributes:{},version:"1.1"},i=[];i[0]=s.model.id,t.paths[0]=i;e.publish("DS/PADUtils/PADCommandProxy/select",t)})),!r.is(c))throw new Error("Unable to find scrollListContainer");if(!r.is(d))throw new Error("Cannot find element editproperties-tbody in the DOM");s._container=d,require(["DS/EditPropWidget/EditPropWidget","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/models/EditPropModel"],(function(e,t,i){var n=new e({typeOfDisplay:t.ONLY_EDIT_PROPERTIES,selectionType:t.NO_SELECTION,readOnly:s._newPropertyReadOnly,extraNotif:!0,editMode:!0,events:{onNotification:function(e){var t=null;"error"===e.eventID&&(t="You are not allowed to do that modification",e.msg.length>0&&(t=e.msg),t.length>0&&(s._alert=new o({className:"search-alert",visible:!0,autoHide:!1,closable:!0,messages:t}).inject(s._container,"top"))),"success"===e.eventID&&(t="You are allowed to do that modification",e.msg.length>0&&(t=e.msg),t.length>0&&(s._alert=new o({className:"search-alert",visible:!0,autoHide:!1,closable:!0,messages:t}).inject(s._container,"top")))}}});n.inject(s._container),s._container.addEvents({resize:function(){n.onResize()}});var a=[],r=new i({metatype:"businessobject",objectId:s.model.id});a.push(r),n.initDatas(a)}))}else{t.log("swym data"),c=s.container.getElement(".properties-sub-container"),d=s.container.getElement(".properties-body"),e.create("thead",{html:{tag:"tr",html:[{tag:"th",text:a.get("skeleton.facets.properties.propertyKey")},{tag:"th",text:a.get("skeleton.facets.properties.valueKey")}]}}).inject(d);let i=e.create("tbody").inject(d);if(!r.is(c))throw new Error("Unable to find scrollListContainer");if(c.addClassName("properties-sub-container-std"),!r.is(d))throw new Error("Cannot find element properties-tbody in the DOM");var u=s.model.pairs();u.sort((function(e,t){return e[0]>t[0]?1:e[0]<t[0]?-1:0}));for(var p=[],_=[],m=[],S=!1,v=0;v<u.length;v++){var w=u[v][0],b=u[v][1];if(b){var C=w.match(/\/([^/]*)$/);if(C=null===C?w:C[1],-1===f.indexOf(w)&&-1===w.indexOf("_value")&&(-1!==w.indexOf("ds6w:")||-1!==w.indexOf("ds6wg:"))&&-1===p.indexOf(C)){p.push(C),_.push(b);var y=n.getVocabId(C);r.is(y)&&(-1!==y.indexOf("ds6wg")?S=!0:-1===m.indexOf(y)&&(n.isLoaded(y)||m.push(y)))}}}var D=function(){for(var t=0;t<p.length;t++){var o=n.getNLSValueForPredicate(p[t]);r.is(o)&&""!==o||(o=p[t]);var a=e.create("tr",{html:{tag:"td",text:o}}).inject(i),l=_[t],c="";if(l instanceof Array){if(l.length>0){for(var d=0;d<l.length;d++)c+=s._HTMLDecode(l[d])+(d===l.length-1?"":" | ");e.create("td",{title:c,text:c}).inject(a)}}else if(l.length>0){e.create("td",{title:s._HTMLDecode(l),text:s._HTMLDecode(l)}).inject(a)}}};if(S||m.length>0){var I=function(){if(m.length>0)for(var e=0,t=0;t<m.length;t++)n.loadVocabulary(m[t],(function(){++e===m.length&&D.call()}));else D.call()};if(S){var T=s.model.get("ds6w:what/ds6w:type_value");r.is(T)||(T=s.model.get("ds6w:type_value")),n._asyncCallToPredicatesWS(["ds6wg:"+T]).then((function(){I.call()}),(function(){I.call()}))}else I.call()}else D.call();new g(c,{bounce:!0,momentum:!0,scrollableX:!1,scrollbarH:!1,scrollDrag:!((h.Platform.windows||h.Platform.win32||h.Platform.win64)&&h.Engine.chrome&&!h.Features.touchEvents||h.Engine.ie&&h.Platform.tablet),useNative:h.Engine.ie&&h.Platform.tablet,useTransform:!(h.Platform.macintel||h.Platform.mac||h.Engine.ie)&&g.prototype.defaultOptions.useTransform,scrollbar:{autoHide:!1,opacity:1,padding:5,bgColor:"transparent",barColor:"#E2E4E3"}})}}))},_getValueWithMapping:function(e,t,i){var n;if(e in i&&r.is(i[e],"function")){var s={model:t};n=i[e].call(s)}else void 0===(n=t.get(e))&&(n="");return n}});return m.facet_name=_,m.is_facet_avalailable=function(){return!0},m.facet_idcard=function(){return{text:a.get("skeleton.facets.properties"),icon:"doc-text",handler:u.getRendererHandler(_)}},m.facet_options=function(){return{view:m,collection:c,fetchMode:"never"}},m})),define("DS/SNResultUX/utils/ResultsUtils",["UWA/Core","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SNVocabAccess"],(function(e,t,i){"use strict";return{from_filters_to_uql:function(n,s,o,a){var r,l,c,d,u="",h=0,g=t.getOption("NLSMapping_3DSearch_Suggest_TACTICALOnly"),p=null,_=null,f=null,m=null,S=this;if(n.isSimplified&&n.condition){var v={};n.condition.forEach((function(e){Object.keys(e).forEach((function(t){0===t.indexOf("sixw:")&&(v[t]=e[t])}))})),n=v}var w={},b=null;for(var C in n)b={sixw:!1},0===C.indexOf("sixw:")&&(p=C.replace("sixw:",""),b.sixw=!0),e.is(w[C],"array")||(w[C]=[]),w[C].push(n[C]);for(var y in n)if(0===y.indexOf("sixw:")){if("ds6w:dataSource"===(p=(p=y.replace("sixw:","")).split("/").pop()))continue;e.is(g)&&g.hasOwnProperty(p)&&e.is(g[p])&&e.is(g[p],"string")&&0===g[p].indexOf("ds6wg:")&&(p=g[p]),p="["+p+"]",r=n[y],_="",0<h&&(_=" AND "),h++;var D=!1;for(c=0;c<r.length;c++)if(l=r[c],e.is(l.type)){if(0===c&&1<r.length&&(_+="( ",D=!0),0<c&&D&&(_=" OR "),"string"===l.type){if(!e.is(l.object))continue;var I=l.object,T=p;if("[ds6w:type]"===p&&(0<=I.indexOf(":")&&!0,0===I.indexOf("ds6wg:"))){if(a){var A,x=I.split(":");x.length>2?(A=x.pop(),I=x.join(":"),"Instance"===A?I=I.replace("ds6wg:","reltypes/"):"Class"===A&&(I=I.replace("ds6wg:","types/"))):(I=x.join(":"),I=!0===i.IsClassAnInstance(I)?I.replace("ds6wg:","reltypes/"):I.replace("ds6wg:","types/"))}else I=I.replace("ds6wg:","types/");T="flattenedtaxonomies"}"[vpmextension]"===p&&(e.is(o)&&!0===o?(0<=I.indexOf(":")&&!0,T="[ds6w:typeExtension]"):(0<=I.indexOf(":")&&!0,0===I.indexOf("ds6wg:")&&(I=I.replace("ds6wg:","interfaces/"),T="flattenedtaxonomies"))),0===I.indexOf("enum|")?(!0,I=I.replace("enum|","")):(0<=I.indexOf(":")||0<=I.indexOf("(")||0<=I.indexOf(")"))&&!0,e.is(s,"object")&&s.hasOwnProperty("usePreciseQueryTerms")&&!0===s.usePreciseQueryTerms&&!0,d=T+':"'+I+'"',u+=_+(d=S._checkExclude(l,d))}else if("date"===l.type){if(!e.is(l.object))continue;e.is(l.object.from)&&(f=new Date(l.object.from+" 00:00:00"),d=p+'>="'+new Date(f).toISOString()+'"',d=S._checkExclude(l,d),u=S._checkExcludeRangeStart(l,u),u+=_+d,e.is(l.object.to)&&(_=" AND ")),e.is(l.object.to)&&(m=new Date(l.object.to+" 23:59:59"),d=p+'<="'+new Date(m).toISOString()+'"',d=S._checkExclude(l,d),u=S._checkExcludeRangeEnd(l,u),u+=_+d)}else if("double"===l.type||"integer"===l.type){if(!e.is(l.object))continue;e.is(l.object.from)&&(d=p+">="+l.object.from,d=S._checkExclude(l,d),u=S._checkExcludeRangeStart(l,u),u+=_+d,e.is(l.object.to)&&(_=" AND ")),e.is(l.object.to)&&(d=p+"<="+l.object.to,d=S._checkExclude(l,d),u=S._checkExcludeRangeEnd(l,u),u+=_+d)}else if("boolean"===l.type){if(!e.is(l.object))continue;d=p+":"+l.object,u+=_+(d=S._checkExclude(l,d))}D&&r.length===c+1&&(u+=" )")}}else if(e.is(n[y],"array")&&n[y].length>0&&e.is(n[y][0])&&e.is(n[y][0].type,"string")&&"date"===n[y][0].type){var N=n[y][0].object;if(!e.is(N,"string"))continue;_="",0<h&&(_=" AND "),h++,p="["+(p=y.split("/").pop())+"]";var E=N.split("/"),O=E.length;f=null,m=null,null;var k=null,P=0,M=1;1===O?(k=parseInt(N),isNaN(k)||(f=new Date(k,0),m=new Date(k+1,0))):2===O?(k=parseInt(E[0]),P=parseInt(E[1]),isNaN(k)||isNaN(P)||(f=new Date(k,P-1),m=new Date(k,P))):3===O&&(k=parseInt(E[0]),P=parseInt(E[1]),M=parseInt(E[2]),isNaN(k)||isNaN(P)||isNaN(M)||(f=new Date(k,P-1,M),m=new Date(k,P-1,M+1))),u+=_+(d=p+'>="'+new Date(f).toISOString()+'"'),u+=(_=" AND ")+(d=p+'<="'+(m=new Date(m.getTime()-1)).toISOString()+'"')}return u},openResourceInApplicationWidget:function(e){var t=e.baseUrl+"#app:"+e.appId+"/content:",i="_top";"3DDashboard"!==e.clientId&&(i="_blank");var n={protocol:"3DXContent",data:{items:[{envId:e.platformId,objectId:e.objectId,openLink:!0}]}},s="X3DContentId="+encodeURIComponent(JSON.stringify(n));window.open(t+s,i)},isAdvSearchRun:function(t){return e.is(t)&&"socket_id_#saved_search_edit#"===t.app_socket_id&&"furtive"!=t.mode},_checkExclude:function(t,i){return!0!==t.excluded||e.is(t.object.to)&&e.is(t.object.from)||(i=" NOT ("+i+")"),i},_checkExcludeRangeStart:function(t,i){return!0===t.excluded&&e.is(t.object.to)&&e.is(t.object.from)&&(i+=" NOT ("+i),i},_checkExcludeRangeEnd:function(t,i){return!0===t.excluded&&e.is(t.object.to)&&e.is(t.object.from)&&(i+=")"),i}}})),define("DS/SNResultUX/views/W3DXComponents/Views/Item/SwitcherView",["DS/W3DXComponents/Views/Item/SwitcherView","DS/SNSearchResultsCusto/utils/SearchResultsCustomizationPreferences","UWA/Core","UWA/Utils","UWA/Event","DS/W3DXComponents/Views/Temp/TempItemView","DS/UIKIT/Tooltip","DS/UIKIT/IconDropdown","DS/UIKIT/DropdownMenu","DS/MessageBus/MessageBus","DS/PubSub/PubSub"],(function(e,t,i,n,s,o,a,r,l,c,d){"use strict";return e.extend({menuUIKIT:null,lastViewMode:null,init:function(e){this.menuUIKIT=null,this.lastViewMode=null,this._parent.call(this,e)},switchView:function(e){this.menuUIKIT.toggleSelection(this.menuUIKIT.getItem(e));let t=this.menuUIKIT.getItem(e);t&&(this.lastViewMode=e,this.menuUIKIT.dispatchEvent("onClick",[null,t],this.menuUIKIT),c.publish({channel:"3dSearch-switcher-view",topic:"forceRefresh"}))},onRender:function(){var e=this;if(this.getOption("tempSingleIconOnMobile")){var t=i.extendElement(e.container).getElement("#switch-view-button"),n=e.options.buttons.filter((function(e){return e.default}))[0];n=n||{};var s=function(e){switch(e){case"thumbnail":return"view-small-thb";case"tilebig":return"view-big-tile";case"tile":return"view-small-tile";case"table":return"view-list";case"what":case"who":case"when":case"where":case"myContent":return"view-tag-cloud";default:return""}},o=[];e.options.buttons.forEach((function(e){o.push({name:e.id,fonticon:s(e.id),text:e.title,selectable:!0,selected:n.id===e.id})}));var r=new a({position:"bottom",target:t});e.menuUIKIT=new l({target:t,items:o,closeOnClick:!0,className:"search",events:{onClick:function(i,n){c.publish({channel:"3dSearch-switcher-view",topic:"displayContentSetHeader",data:{displayed:"where"!==n.name&&"what"!==n.name&&"who"!==n.name&&"when"!==n.name&&"myContent"!==n.name,view:n.name}}),n.actived||(e.dispatchEvent("onSwitch",[e,n.name]),this.items.forEach((function(e){e.actived=!1})),n.actived=!0,t.children[0].className=n.elements.icon.className,r.setBody(n.text))}}}),e.menuUIKIT.items.forEach((function(e){e.name===n.id&&(t.children[0].className=e.elements.icon.className,r.setBody(e.text))}))}else this.options.buttons.forEach((function(t){if(i.is(t.title)&&t.title.trim().length>0){var n=i.extendElement(e.container).getElement("#"+e.cid+"-"+t.id+"-button");new a({position:"bottom",target:n.getParent(),body:t.title})}}))}})})),define("DS/SNResultUX/utils/Select_ActionHandler",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Events"],(function(e,t,i,n){"use strict";return t.singleton(n,i,{executeAction:function(t){if(!(e.is(t,"object")&&e.is(t.object_ids,"array")&&e.is(t.action_id,"string")&&t.actionsHelper))throw new Error("Invalid input to action handler");var i=t?t.actionsHelper:null;switch(t.action_id){case"select_all":i.selectAll(t);break;case"unselect_all":i.unselectAll(t);break;case"new_preview":i.preview(t);break;case"new_information":i.getInformation(t)}}})})),define("DS/SNResultUX/utils/ImageHelper",["UWA/Core","UWA/Class","UWA/Class/Debug"],(function(e,t,i){"use strict";return t.extend(i,{name:"DS_SNResultUX_utils_ImageHelper",_gridView:null,_cellInfos:null,_image:null,_onImageLoad:function(){var t,i=this._cellInfos.cellView,n=this._image.height;this._image.width>198||n>148?(e.is(i.setPictureBackgroundSize,"function")?i.setPictureBackgroundSize("contain"):e.is(i.contentView)&&e.is(i.contentView.setPictureBackgroundSize,"function")&&i.contentView.setPictureBackgroundSize("contain"),e.is(this._cellInfos.virtualCellID)?t=this._cellInfos.virtualCellID:e.is(this._cellInfos.cellID)&&(t=this._cellInfos.cellID),this._gridView.setAsBigPicture(t)):e.is(i.setPictureBackgroundSize,"function")?i.setPictureBackgroundSize("auto"):e.is(i.contentView)&&e.is(i.contentView.setPictureBackgroundSize,"function")&&i.contentView.setPictureBackgroundSize("auto")},init:function(e,t){this._cellInfos=e,this._gridView=t,this._image=new Image,this._image.addEventListener("load",this._onImageLoad.bind(this),!0),this._image.src=e.nodeModel.options.thumbnail},destroy:function(){this._image&&this._image.removeEventListener("onload",this._onImageLoad.bind(this),!0),this._gridView=null,this._image=null,this._cellInfos=null}})})),define("DS/SNResultUX/views/utils/SearchHistoryTree",["UWA/Core","UWA/Class/View","UWA/Element","UWA/Utils/InterCom","DS/WebappsUtils/WebappsUtils","DS/UIKIT/Tooltip","DS/etree/syncwidget","DS/egraph/core","DS/egraph/utils","DS/egraph/views","DS/etree/iact","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchSettings","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","css!egraph/views","css!etree/syncviews","css!etree/basicviews","css!egraph/views_default","css!DS/etree/overviewui.css"],(function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_){"use strict";var f=t.extend({_treeDocument:null,_graph:null,_lastNode:null,_searchNode:null,_currentSelectNode:null,_lastSelectNode:null,_listOfTreeGraph:null,_stopCreated:!1,_ifHaveExploreOrRelatedNode:!1,_fullsize:!0,_container:null,_compass_socket:null,_AlReadyRender:!1,customNodeView:function(){var t=function(t){var i,n=t.nodeView,s=t.nodeModel;i=n.querySelector(".etree-sync-node-icon"),e.is(i)&&i.classList.remove("hidden"),s.options.icons&&s.options.icons.length>0?i.style.backgroundImage='url("'+s.options.icons[0]+'")':i&&i.classList.add("hidden"),n.querySelector(".etree-sync-node-label").textContent=s.options.label,(r.inPathSet(t.changes,"data","data","_isHighlighted")||r.inPathSet(t.changes,"data","data","_isSelected"))&&(s._isHighlighted||s._isSelected?n.classList.add("highlighted"):n.classList.remove("highlighted")),i=n.querySelector(".fonticon.fonticon-filter"),e.is(i)&&e.is(s.options.filter)&&!0===s.options.filter?i.style.visibility="visible":e.is(i)&&(i.style.visibility="hidden")},i={},n=function(){c.HTMLNodeView.call(this)};l.inherit(n,c.HTMLNodeView),n.prototype.buildNodeElement=function(){var e=document.createElement("div");return e.innerHTML=['<div class="etree-sync-node" draggable="true">','  <div class="etree-sync-node-widget template1">','    <div class="etree-sync-node-header">','      <div class="etree-sync-node-icon"></div>','      <div class="etree-sync-node-label">noname</div>','      <div class="fonticon fonticon-filter"></div>',"    </div>",'    <div class="etree-sync-node-content">','       <div class="etree-sync-node-description">desc</div>',"    </div>","  </div>","</div>"].join("\n"),e.querySelector(".etree-sync-node").cloneNode(!0)},n.prototype.onmodifyDisplay=function(i,n){var s,o=i.data.data;c.HTMLNodeView.prototype.onmodifyDisplay.apply(this,arguments),s=e.extendElement(this.display.elt),t({nodeModel:o,nodeView:s,changes:n}),s.querySelector(".etree-sync-node-description").textContent=o.options.description};var s=function(){c.HTMLNodeView.call(this)};l.inherit(s,c.HTMLNodeView),s.prototype.buildNodeElement=function(){var e=document.createElement("div");return e.innerHTML=['<div class="etree-sync-node" draggable="true">','  <div class="etree-sync-node-widget template2">','      <div class="fonticon fonticon-filter"></div>','      <div class="etree-sync-node-icon"></div>','      <div class="etree-sync-node-label">noname</div>','      <div class="etree-sync-node-content"></div>',"  </div>","</div>"].join("\n"),e.querySelector(".etree-sync-node").cloneNode(!0)},s.prototype.onmodifyDisplay=function(i,n){var s,o=i.data.data;c.HTMLNodeView.prototype.onmodifyDisplay.apply(this,arguments),s=e.extendElement(this.display.elt),t({nodeModel:o,nodeView:s,changes:n}),s.querySelector(".etree-sync-node-content").textContent=o.options.description};var o=function(){c.HTMLNodeView.call(this)};l.inherit(o,c.HTMLNodeView),o.prototype.buildNodeElement=function(t){if(e.is(t)&&e.is(t.data)){var i=document.createElement("div");return i.innerHTML=['<div class="etree-sync-node" draggable="true">','  <div class="etree-sync-node-widget template3">','      <div class="etree-sync-node-icon"></div>','      <div class="etree-sync-node-label">noname</div>','      <div class="etree-sync-node-firstcontent">','        <div class="etree-sync-node-firstcontent-label1">No Children</div>','        <div class="etree-sync-node-firstcontent-label2">No results</div>',"      </div>",'      <div class="etree-sync-node-secondcontent">','       <div class="etree-sync-node-secondcontent-label1">No Parents</div>','       <div class="etree-sync-node-secondcontent-label2">No results</div>',"      </div>","  </div>","</div>"].join("\n"),i.querySelector(".etree-sync-node").cloneNode(!0)}},o.prototype.onmodifyDisplay=function(i,n){var s,o=i.data.data;c.HTMLNodeView.prototype.onmodifyDisplay.apply(this,arguments),s=e.extendElement(this.display.elt),t({nodeModel:o,nodeView:s,changes:n}),o.options.childrenlabel&&o.options.childrenlabel.length>0&&(s.getElement(".etree-sync-node-firstcontent-label1").textContent=o.options.childrenlabel,s.getElement(".etree-sync-node-firstcontent-label2").textContent=o.options.childrenresults),o.options.parentslabel&&o.options.parentslabel.length>0&&(s.getElement(".etree-sync-node-secondcontent-label1").textContent=o.options.parentslabel,s.getElement(".etree-sync-node-secondcontent-label2").textContent=o.options.parentsresults),o.options.rootslabel&&o.options.rootslabel.length>0&&(s.getElement(".etree-sync-node-thirdcontent-label1").textContent=o.options.rootslabel,s.getElement(".etree-sync-node-thirdcontent-label2").textContent=o.options.rootsresults)};var a=function(){c.HTMLNodeView.call(this)};return l.inherit(a,c.HTMLNodeView),a.prototype.buildNodeElement=function(t){if(e.is(t)&&e.is(t.data)){var i=document.createElement("div");return i.innerHTML=['<div class="etree-sync-node" draggable="true">','  <div class="etree-sync-node-widget template4">','      <div class="etree-sync-node-label">noname</div>','      <div class="etree-sync-node-firstcontent">','        <span class="fonticon fonticon-network"></span>','        <span class="item-text-first" style="text-align: center;">Structure</span>',"      </div>",'      <div class="etree-sync-node-secondcontent">','        <span class="fonticon fonticon-component"></span>','        <span class="item-text-second" style="text-align: center;">Related</span>',"      </div>","  </div>","</div>"].join("\n"),i.querySelector(".etree-sync-node").cloneNode(!0)}},a.prototype.onmodifyDisplay=function(i,n){var s,o=i.data.data;c.HTMLNodeView.prototype.onmodifyDisplay.apply(this,arguments),s=e.extendElement(this.display.elt),t({nodeModel:o,nodeView:s,changes:n}),o.options.childrenlabel&&o.options.childrenlabel.length>0&&(s.getElement(".item-text-first").textContent=o.options.childrenlabel),o.options.parentslabel&&o.options.parentslabel.length>0&&(s.getElement(".item-text-second").textContent=o.options.parentslabel)},i.newNodeView=function(e){var t=e.data;return"type1"===t.options.type?new n:"type2"===t.options.type?new s:"type3"===t.options.type?new o:new a},i},render:function(t){var n=this;if(!e.is(t)||null!==n._container||!0===n._AlReadyRender)return;n._listOfTreeGraph=[],n._AlReadyRender=!0,n._container=t,n._graph=new a.SyncEGraphTree(n._container,{orientation:a.OrientationMode.ROOT_ON_LEFT,nodeView:n.customNodeView(),fittingArea:{paddingLeft:-25,paddingRight:0,paddingTop:-25,paddingBottom:0}}),n._graph.widget.document.nodeHeight=90,n._graph.widget.document.nodeWidth=130,n._graph.setModel(n.getTreeDocument()),n._graph.expandAll(),n._graph.widget.sm.rootState.movePredicate=function(){return!1},n._graph.widget.sm.rootState.onmousedown=function(t,i){if(i.dom.className.contains("item-text-first")||i.dom.className.contains("fonticon fonticon-network")||i.dom.className.contains("item-text-second")||i.dom.className.contains("fonticon fonticon-component")){if(i.inside&&1===i.button&&e.is(i.grElt)&&e.is(i.grElt.data)&&e.is(i.grElt.data.data)){var s=i.grElt.data.data;s&&(i.dom.className.contains("item-text-first")||i.dom.className.contains("fonticon fonticon-network")?e.is(s.options)&&e.is(s.options.onClickchildren,"function")&&s.options.onClickchildren.call(n,s):(i.dom.className.contains("item-text-second")||i.dom.className.contains("fonticon fonticon-component"))&&e.is(s.options)&&e.is(s.options.onClickparents,"function")&&s.options.onClickparents.call(n,s))}return{}}return d.RootState.prototype.onmousedown.apply(this,arguments)};var s=i.create("div",{class:"fonticon fonticon-resize-full"});s.inject(n._container);new o({position:"bottom",target:s,body:_.get("relation.maxminTooltip")});s.onclick=function(){!0===n._fullsize?(n._container.style.height="100%",n._fullsize=!1,this.removeClassName("fonticon fonticon-resize-full"),this.addClassName("fonticon fonticon-resize-small")):(n._container.style.height="100px",n._fullsize=!0,this.removeClassName("fonticon fonticon-resize-small"),this.addClassName("fonticon fonticon-resize-full"))}},getTreeDocument:function(){var e=this;return null===e._treeDocument&&(this._treeDocument=new u({useAsyncPreExpand:!0,shouldAcceptDrag:function(){return!1},shouldAcceptDrop:function(){return!1}}),e._treeDocument.getXSO().onAdd((function(t){e.onSelected(t)}))),e._treeDocument},addSearchModel:function(t){var i=this;if(e.is(t)){var n=i._treeDocument;e.is(n)||(n=i.getTreeDocument());var o=!1;if(e.is(t.refine)&&!0===t.refine?(o=!0,e.is(t.searchParam)&&e.is(t.searchParam.adv_search)&&!0===t.searchParam.adv_search&&(null===i._lastNode||i._lastNode&&"Search"!==i._lastNode._options.SNtype)&&(o=!1)):i._lastNode&&"Search"===i._lastNode._options.SNtype&&(o=!0),!1===o){n.prepareUpdate(),t.type="type1",t.icons=[s.getWebappsAssetUrl("SNResultUX","images/Box_Search.png")],t.useAsyncPreExpand=!1,t.label=_.get("search.box"),t.SNtype="Search";var a=new h(t);n.addRoot(a),n.pushUpdate(),i._lastNode=a,i._searchNode=a;var r={SNtype:"Search",contextid:t.contextid,widgetAppId:t.widgetAppId};g.setContentVisibility(r),i._currentSelectNode=null,i._lastSelectNode=null,i._graph&&i._graph.expandAll()}else if(i._currentSelectNode&&"Children"===i._currentSelectNode._options.SNtype){var l=i._currentSelectNode._options.description;e.is(t.count)&&(l=l.replace(/[0-9]/,t.count)),i._currentSelectNode.updateOptions({searchParam:t.searchParam,description:l,filter:t.filter})}else i._searchNode&&(i._searchNode.updateOptions({description:t.description,searchParam:t.searchParam,filter:t.filter}),i._lastNode=i._searchNode);return i._lastNode}},addSearchSelectModel:function(t){var i=this,n=i._treeDocument;e.is(n)||(n=i.getTreeDocument());var o=i._searchNodebyIdInSameBranch(t.id);if(!e.is(o)||null===o){var a=!1,r=!0,l=!1;if(e.is(t)&&!e.is(t,"object")?(a=!0,l=!0,i._lastSelectNode&&(i._lastSelectNode.removeChildren(),i._lastNode=i._lastSelectNode)):i._lastNode&&"Select"===i._lastNode._options.SNtype?null===i._lastNode.getChildren()&&(a=!0):!i._currentSelectNode||"Search"!==i._currentSelectNode._options.SNtype&&"Children"!==i._currentSelectNode._options.SNtype?i._lastNode&&"Children"===i._lastNode._options.SNtype?null!==i._lastNode.getChildren()||e.is(i._lastNode._isSelected)||(a=!0,i._lastSelectNode&&(i._lastSelectNode.removeChildren(),i._lastNode=i._lastSelectNode)):i._lastNode&&""===i._lastNode._options.SNtype&&(a=!0,i._lastSelectNode&&(i._lastSelectNode.removeChildren(),i._lastNode=i._lastSelectNode)):i._lastNode=i._currentSelectNode,!0===a)!0===l?i._lastSelectNode.updateOptions({description:t+_.get("relation.selected"),id:null,model:null}):i._lastSelectNode.updateOptions({description:t.description,id:t.id,model:t.model}),i._lastNode=i._lastSelectNode,r=!1;else{if(!1===p.getOption("nav_history_parallel")&&(r=!0,i._currentSelectNode&&"Search"===i._currentSelectNode._options.SNtype&&i._currentSelectNode.hasChildren())){var c=i._currentSelectNode.getChildren()[0];i._removeAllNodeWithWidget(c),c.updateOptions({description:t.description,id:t.id,model:t.model}),i._lastNode=c,r=!1}if(!0===r){t.SNtype="Select",t.type="type1",t.icons=[s.getWebappsAssetUrl("SNResultUX","images/Box_Select.png")],t.useAsyncPreExpand=!1,t.label=_.get("select.box"),n.prepareUpdate();var d=new h(t);i._lastNode.addChild(d),i._lastNode=d,i._lastSelectNode=i._lastNode,i._currentSelectNode=null,n.pushUpdate(),i._graph&&i._graph.expandAll()}}return i._lastNode}},removeLastSelectNode:function(){var t=this;if(t._lastNode){var i=!0;if("Select"===t._lastNode._options.SNtype){var n=t._lastNode.getChildren();if(n){for(var s=n.length,o=null,a=0;a<s;a++)o=n[a];o&&(i=!1)}!0===i&&(t._lastNode=t._lastNode.getParent(),t._lastNode.removeChildren())}else"Children"===t._lastNode._options.SNtype&&(t._currentSelectNode&&"Children"===t._currentSelectNode._options.SNtype||t._currentSelectNode&&"Select"===t._currentSelectNode._options.SNtype?i=!1:e.is(t._lastNode._isSelected)||(i=!0),!0===i&&t._lastSelectNode&&(t._lastNode=t._lastSelectNode.getParent(),t._lastNode.removeChildren()))}},addRelationsModel:function(t){var i=this,o=function(t){if(e.is(t)){var n=t.getParent();n&&(n.removeChild(t),i._lastNode=n)}},a=null,r=p.getOption("nav_history_related"),l=null,c=null,d=null,u=null,f=null,m=null,S=null,v=0;if(!1===r){if(e.is(t)&&e.is(t.model)&&e.is(t.model.fromApp)&&!0===t.model.fromApp){var w=t.model;l=null,(c={type:"type4",SNtype:"Children",useAsyncPreExpand:!1,contextid:t.contextid,widgetAppId:t.widgetAppId}).label=w.displayName,c.childrenlabel=_.get("tree.box"),c.parentslabel=_.get("graph.box"),c.model=w,c.id=w.id;var b=function(e){var s=e.id,o={protocol:"3DXContent",version:"1.1",source:"X3DSEAR_AP",widgetId:t.widgetAppId,data:{items:[{envId:e.getPlatformID(),serviceId:e.getServiceID,contextId:"",objectId:s,objectType:e.get("ds6w:type_value"),displayName:e.displayName,displayType:e.get("ds6w:type")}]}},a="HistoryActions";return null===i._compass_socket&&(i._compass_socket=new n.Socket(a),i._compass_socket.subscribeServer("com.ds.compass",window.parent)),i._compass_socket.dispatchEvent("onSetX3DContent",o,a),o},C={description:w.displayName,widgetAppId:t.widgetAppId,contextid:t.contextid};if(c.onClickparents=function(t){if(e.is(t)){o(t);var n=i.addRelationalModel(C),s=b(t.options.model),a={historyNode:n,nav_history:!0};g.setContentVisibility("Relational"),g.instantiateAppInSearch("Relational","ENORIPE_AP",s,a)}},c.onClickchildren=function(t){if(e.is(t)){o(t);var n=i.addExploreModel(C),s=b(t.options.model),a={historyNode:n,nav_history:!0};g.setContentVisibility("Explore"),g.instantiateAppInSearch("ExploreList","ENOSC2D_AP",s,a),g.instantiateAppInSearch("Explore3D","ENOSC3D_AP",s,a)}},u=null,d=i._lastNode,e.is(i._lastNode._options.id)&&(u=i._lastNode._options.id),null!==i._currentSelectNode&&e.is(i._currentSelectNode._options.id)&&(u=i._currentSelectNode._options.id,d=i._currentSelectNode),!e.is(d))return;if(!e.is(u))return;if(u===t.model.id&&!0===i._lastNode.hasChildren()&&(f=i._lastNode.getChildren()))for(m=f.length,S=null,v=0;v<m;v++)if((S=f[v])&&e.is(S._options)&&("Relational"!==S._options.SNtype||"Explore"!==S._options.SNtype))return;if(a=i.getTreeDocument(),!e.is(a))return;return a.prepareUpdate(),i._removeAllNodeWithWidget(d),l=new h(c),d.addChild(l),null!==l&&(i._lastNode=l),a.pushUpdate(),i._currentSelectNode=null,i._graph&&i._graph.expandAll(),l}}else if(!0===r){var y=!1;if(i._currentSelectNode&&"Select"===i._currentSelectNode._options.SNtype?y=!1:i._lastNode&&"Select"!==i._lastNode._options.SNtype&&(y=!0),!0===y)return;if(!e.is(t)&&!e.is(t.model))return;if(u=null,d=i._lastNode,e.is(i._lastNode._options.id)&&(u=i._lastNode._options.id),null===u&&null!==i._currentSelectNode&&e.is(i._currentSelectNode._options.id)&&(u=i._currentSelectNode._options.id,d=i._currentSelectNode),!e.is(d))return;if(!e.is(u))return;if(u!==t.model.id)return;if(a=i.getTreeDocument(),!e.is(a))return;if(!e.is(t,"object"))return;var D=function(){var t=[];if(f=d.getChildren())for(m=f.length,S=null,v=0;v<m;v++)(S=f[v])&&e.is(S._options)&&e.is(S._options.relation)&&t.push(S._options.relation);return t}();if(e.is(D)){if(2===D.length)return;if(1===D.length&&""===D[0])return}var I=function(t,n){var a=_.get("relation.result");switch(t.info.length>1&&(a=_.get("relation.results")),t.id){case"parents":n.parentslabel=_.get("relation.parents.label"),n.parentsresults=t.info.length+a,n.parentsdescription=_.get("relation.parents.description"),n.onClickparents=function(t){e.is(t)&&(o(t),t.options.relation="parents",t.options.ids=t.options.relations[t.options.relation],i.onSelected(i.addRelationModel(t)))};break;case"children":n.childrenlabel=_.get("relation.children.label"),n.childrenresults=t.info.length+a,n.childrendescription=_.get("relation.children.description"),n.onClickchildren=function(t){e.is(t)&&(o(t),t.options.relation="children",t.options.ids=t.options.relations[t.options.relation],i.onSelected(i.addRelationModel(t)))};break;case"simulations":n.label=_.get("relation.simulations.label"),n.icons=[s.getWebappsAssetUrl("SNResultUX","images/Box_Simulations.png")],n.description=_.get("relation.simulations.description");break;case"configurations":n.label=_.get("relation.configurations.label"),n.icons=[s.getWebappsAssetUrl("SNResultUX","images/Box_Configurations.png")],n.description=_.get("relation.configurations.description")}};l=null;var T=null;(c={type:"type2",SNtype:"",ids:null,relation:"",relations:t,useAsyncPreExpand:!1,contextid:t.contextid,widgetAppId:t.widgetAppId,description:_.get("relation.norelated")}).label=t.model.get("ds6w:type"),c.icons=[t.model.get("preview_url")];var A=!1;for(var x in t)if(-1===D.indexOf(x)){var N=t[x];if(e.is(N,"array")&&N.length>0){var E=N.length;"drawings"===x?(T={SNtype:"Children",ids:N,type:"type2",relation:"drawings",useAsyncPreExpand:!1,contextid:t.contextid,widgetAppId:t.widgetAppId,label:_.get("relation.drawings.label"),icons:[s.getWebappsAssetUrl("SNResultUX","images/Box_Drawings.png")],description:E+(E>1?_.get("relation.results"):_.get("relation.result"))},A=!0):(A=!0,c.type="type3",c.SNtype="Children",I({id:x,info:N},c))}}if(!1===A&&D.length>0)return i._lastNode;a.prepareUpdate(),l=new h(c),d.addChild(l),null!==l&&(i._lastNode=l),null!==T&&(l=new h(T),d.addChild(l),i._lastNode=l),a.pushUpdate(),i._currentSelectNode=null,i._graph&&i._graph.expandAll()}return l},addRelationModel:function(t){var i=this;if(e.is(t)&&e.is(t.options)&&e.is(t.options.relations)){var n=i.getTreeDocument();if(e.is(n)){n.prepareUpdate();var o=i._lastNode,a=null,r=t.options.relations,l=t.options.relation,c=r[l];if(e.is(c,"array")&&c.length>0){var d={SNtype:"Children",ids:c,type:"type2",relation:l,useAsyncPreExpand:!1,contextid:r.contextid,widgetAppId:r.widgetAppId};!function(e,t){var i=_.get("relation.result");switch(e.info.length>1&&(i=_.get("relation.results")),e.id){case"parents":t.label=_.get("relation.parents.label"),t.icons=[s.getWebappsAssetUrl("SNResultUX","images/Box_Parents.png")],t.description=e.info.length+i;break;case"children":t.label=_.get("relation.children.label"),t.icons=[s.getWebappsAssetUrl("SNResultUX","images/Box_Children.png")],t.description=e.info.length+i;break;case"drawings":t.label=_.get("relation.drawings.label"),t.icons=[s.getWebappsAssetUrl("SNResultUX","images/Box_Drawings.png")],t.description=e.info.length+i;break;case"simulations":t.label=_.get("relation.simulations.label"),t.icons=[s.getWebappsAssetUrl("SNResultUX","images/Box_Simulations.png")],t.description=e.info.length+i;break;case"configurations":t.label=_.get("relation.configurations.label"),t.icons=[s.getWebappsAssetUrl("SNResultUX","images/Box_Configurations.png")],t.description=e.info.length+i}}({id:l,info:c},d),a=new h(d),o.addChild(a)}return null!==a&&(i._lastNode=a),n.pushUpdate(),i._currentSelectNode=null,i._graph&&i._graph.expandAll(),a}}},addExploreModel:function(t){var i=this,n=i._treeDocument;i.HideContainers(),e.is(n)||(n=i.getTreeDocument()),t.SNtype="Explore",t.type="type1",t.label=_.get("tree.box"),t.icons=[s.getWebappsAssetUrl("SNResultUX","images/I_TreeListView.png")],t.useAsyncPreExpand=!1;var o=new h(t);return e.is(i._lastNode)&&(i._removeChildrenNode(),n.prepareUpdate(),i._lastNode.addChild(o),n.pushUpdate(),i._lastNode=o,null===i._listOfTreeGraph&&(i._listOfTreeGraph=[]),i._listOfTreeGraph.push(o),i._ifHaveExploreOrRelatedNode=!0,i._currentSelectNode=null,i._graph&&i._graph.expandAll()),o},addRelationalModel:function(t){var i=this,n=i._treeDocument;e.is(n)||(n=i.getTreeDocument()),i.HideContainers(),t.SNtype="Relational",t.type="type1",t.label=_.get("graph.box"),t.icons=[s.getWebappsAssetUrl("SNResultUX","images/I_GraphView.png")],t.useAsyncPreExpand=!1;var o=new h(t);return e.is(i._lastNode)&&(n.prepareUpdate(),i._removeChildrenNode(),i._lastNode.addChild(o),n.pushUpdate(),i._lastNode=o,null===i._listOfTreeGraph&&(i._listOfTreeGraph=[]),i._listOfTreeGraph.push(o),i._ifHaveExploreOrRelatedNode=!0,i._currentSelectNode=null,i._graph&&i._graph.expandAll()),o},onSelected:function(t){if(e.is(t)){var i=this,n=t.options;if(e.is(n)){i._currentSelectNode=t;for(var s=t;s&&s._options&&"Search"!==s._options.SNtype;)"Explore"!==(s=s.getParent())._options.SNtype&&"Relational"!==s._options.SNtype||(i._ifHaveExploreOrRelatedNode=!0);for(s&&(i._searchNode=s),s=t;s&&s.getChildren();)"Explore"!==(s=s.getChildren()[0])._options.SNtype&&"Relational"!==s._options.SNtype||(i._ifHaveExploreOrRelatedNode=!0);s&&(i._lastNode=s),i.dispatchEvent("onSelected",n)}}},HideContainers:function(){e.is(this._listOfTreeGraph)&&this._listOfTreeGraph.forEach((function(t){e.is(t._options)&&e.is(t._options.containers)&&t._options.containers.forEach((function(e){e.setStyle("display","none")}))}))},ShowContainers:function(t){e.is(t)&&(this.HideContainers(),e.is(t.containers)&&t.containers.forEach((function(e){e.setStyle("display","block")})))},stopCreation:function(e){this._stopCreated=e},ifcanCreated:function(){return!this._stopCreated},_removeChildrenNode:function(){var t=this;if(e.is(t._lastNode)&&("Children"===t._lastNode._options.SNtype||""===t._lastNode._options.SNtype)&&t._lastSelectNode){for(var i=t._lastSelectNode;i&&i.getChildren();)"Children"===(i=i.getChildren()[0])._options.SNtype&&e.is(i._isSelected)&&(i=null);i&&(t._lastSelectNode.removeChildren(),t._lastNode=t._lastSelectNode)}},_searchNodebyIdInSameBranch:function(t){if(e.is(t)){if(e.is(this._lastNode))for(var i=t,n=this._lastNode;n;){if(i&&e.is(n._options.id)&&-1!==n._options.id.indexOf(i))return n;n=n.getParent()}}},_removeAllNodeWithWidget:function(t){var i=0,n=0,s=t.getChildren();if(s){var o=s.length,a=null,r=null;for(i=0;i<o;i++)if((a=s[i])&&e.is(a._options)){if(this._removeAllNodeWithWidget(a),e.is(a._options.widgets,"array"))for(n=a._options.widgets.length-1;n>=0;n--)r=a._options.widgets[n],e.is(r)&&r.destroy();if(e.is(a._options.containers,"array"))for(n=a._options.containers.length-1;n>=0;n--)r=a._options.containers[n],e.is(r)&&r.remove();t.removeChild(a)}}},cleanAll:function(){var t=this,i=t._treeDocument;if(i){var n=i.getRoots();if(n){var s=n[0];if(e.is(s)){var o={SNtype:"Search",contextid:s.options.contextid,widgetAppId:s.options.widgetAppId};g.setContentVisibility(o),t._removeAllNodeWithWidget(s)}}i.removeRoots(),i.empty()}t._lastNode=null,t._searchNode=null,t._currentSelectNode=null,t._lastSelectNode=null,t._lastSelectNode=null,t._listOfTreeGraph=[]},navhistorycontextifcreateaNewTab:function(){var t=!1;return e.is(this._listOfTreeGraph)&&this._listOfTreeGraph.length>0&&(t=!0),t}});return f})),define("DS/SNResultUX/utils/PowerByActionsHandler",["UWA/Core","UWA/Class","UWA/Class/Debug","DS/SNInfraUX/Logger","DS/PlatformAPI/PlatformAPI"],(function(e,t,i,n,s){"use strict";return t.singleton(i,{executeAction:function(t,i){if(!e.is(t,"object")||!e.is(t.object_ids,"array")||!e.is(t.action_id,"string"))throw new Error("invalid input to action handler");console.log(t),s.publish("webinwin:web:notification",JSON.stringify({event:"search_contextualaction_launch",content:{action_id:t.action_id,object_ids:t.object_ids}}))}})})),define("DS/SNResultUX/utils/BroadcastsearchDropDownManager",["UWA/Class","UWA/Core","UWA/Event","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchPreferences"],(function(e,t,i,n,s){"use strict";return e.extend(i,{init:function(){this.resultMgt=null,this._BroadcastsearchDropDown=null,this._parent()},setup:function(e){this.resultMgt=e&&e.resultMgt,this._BroadcastsearchDropDown&&this._BroadcastsearchDropDown.close(),this._BroadcastsearchDropDown&&delete this._BroadcastsearchDropDown,this._BroadcastsearchDropDown=new BroadcastChannel("searchDropDownWebInWin"),this._parent(e)},destroy:function(){this._BroadcastsearchDropDown.close(),this._BroadcastsearchDropDown&&delete this._BroadcastsearchDropDown,this.resultMgt=null,this._parent()},getBroadcastsearchDropDown:function(){return this._BroadcastsearchDropDown},postMessage:function(e){let i;t.is(this._BroadcastsearchDropDown)&&(t.is(e)&&(i=e),this._BroadcastsearchDropDown.postMessage(i),n.log("DS/SNResultUX/utils/BroadcastsearchDropDownManager postMessage from: ",i))},listenBroadcast:function(){let e=this;t.is(e._BroadcastsearchDropDown)&&t.is(e.resultMgt)&&(e._BroadcastsearchDropDown.onmessage=i=>{if(t.is(i)&&t.is(i.data)){n.log("DS/SNResultUX/utils/BroadcastsearchDropDownManager onmessage",i.data);const{type:t="",message:o="",value:a=""}=i.data;if("applySettings"===t){let e=JSON.parse(a);s.setItem("search_tabbed_ui",e.search_tabbed_ui),s.setItem("search_double_click_open",e.search_double_click_open),s.setItem("revisionDisplayType",e.revisionDisplayType),s.commit(),s.setPreference({name:"optionMode",value:e.value,tenantId:e.tenantId,onComplete:function(){location.reload(!0)},onFailure:function(e){n.error("DS/SNResultUX/utils/BroadcastsearchDropDownManager: Failure, Unable to save preferences :",e)}})}else if("onSearch"===t){let t=JSON.parse(a);e.resultMgt.onSearch(t)}else"clearLocalGrouping"===t?(e.resultMgt._taggerProxy.clearLocalFilter(),e.resultMgt._taggerProxy.clearLocalGrouping&&e.resultMgt._taggerProxy.clearLocalGrouping(),e.resultMgt.getCollection()._resetState(),e.resultMgt.getCollection().reset(),e.resultMgt.getSNSkeleton().getCurrentView().updateView()):"set_title_only_search"==t&&(e.resultMgt._search_in_title=a)}})}})})),define("DS/SNResultUX/views/WebUX/Spreadsheet/Manager_EndUserCusto",["DS/Spreadsheet/Manager","DS/Utilities/Dom"],(function(e,t){"use strict";return e.extend({_listenEvents:function(){var e=this;this.onMoveRow((function(t){e.processCellsOfRow(t.toRowID,(function(e){e.options.rowID===t.fromRowID&&(e.options.rowID=t.toRowID)}))})),this._selectedCells.onPostAdd((function(e){e.forEach((function(e){e.highlight(),e._view&&parseInt(e._view.elements.container.getAttribute("virtual-row-id"),10)===e.options.rowID&&parseInt(e._view.elements.container.getAttribute("virtual-column-id"),10)===e.options.columnID&&e._view.highlight()}))})),this._selectedCells.onPostRemove((function(e){e.forEach((function(e){e.unhighlight(),e._view&&parseInt(e._view.elements.container.getAttribute("virtual-row-id"),10)===e.options.rowID&&parseInt(e._view.elements.container.getAttribute("virtual-column-id"),10)===e.options.columnID&&e._view.unhighlight()}))})),t.addEventOnElement(this,document,"keydown",(function(t){var i=UWA.Event.whichKey(t);"ctrl"!==i||e._modeIsMultiSel||!e._allowSettingMultiSelMode||e._multiSelModeHasBeenForced||(e._modeIsMultiSel=!0),"shift"!==i||e._modeIsRange||(e._modeIsRange=!0)})),t.addEventOnElement(this,document,"keyup",(function(t){var i=UWA.Event.whichKey(t);"ctrl"!==i||e._multiSelModeHasBeenForced||(e._modeIsMultiSel=!1),"shift"===i&&e._modeIsRange&&(e._modeIsRange=!1)})),this.onCellPointerDown((function(t){var i=t.cellView.getVirtualCoordinates().virtualRowID,n=t.cellView.getVirtualCoordinates().virtualColumnID;e.__disableInteractiveSort||(e.prepareUpdateView(),e.isRowSelected(i)?e.unselectRow(i):e.selectRow(i,-1!==n),e.pushUpdateView())})),t.addEventOnElement(e,e.getContent(),"click",(function(){e._hasBeenClicked=!0,setTimeout((function(){e._hasBeenClicked=!1}),200)})),this.onCellClick((function(t){var i=t.cellModel,n=t.cellView.getVirtualCoordinates(),s=n.virtualRowID,o=n.virtualColumnID;if(!e.__disableInteractiveSort){if(-1===s){var a=e._getColumnOptionValue(o,"isSortable"),r=["sort:asc","sort:desc"],l=e._getColumnState(o),c=function(e,t){void 0===t&&(t=0);var i=e.slice(0);return{getCurrent:function(){return i[t]},getNext:function(){return t=++t%i.length,this.getCurrent()},getPrevious:function(){return--t<0&&(t+=i.length),this.getCurrent()}}}(r,r.indexOf(l)).getNext();switch(e.unselectAll(),c){case"sort:desc":a&&(e.prepareUpdateView(),e.sortColumnContent(o,{typeOfCell:"number",sortOrder:"desc"}),e.pushUpdateView());break;case"sort:asc":a&&(e.prepareUpdateView(),e.sortColumnContent(o,{typeOfCell:"number",sortOrder:"asc"}),e.pushUpdateView())}}if(-1!==s&&-1!==o&&e.options.selection.cells){if(e.prepareUpdateView(),e._preventNextUpdateView(),e.unselectAll({cells:!0,updateView:!1}),e._modeIsRange){var d,u,h,g,p,_,f=i,m=e._selectedCells.get()[0];e._selectedCells.empty(),e._selectedCells.add(m);var S=m.getView().getVirtualCoordinates(),v=f.getView().getVirtualCoordinates();for(S.virtualRowID<v.virtualRowID?(h=S.virtualRowID,g=v.virtualRowID):(g=S.virtualRowID,h=v.virtualRowID),d=h;d<=g;d++)for(S.virtualColumnID<v.virtualColumnID?(p=S.virtualColumnID,_=v.virtualColumnID):(_=S.virtualColumnID,p=v.virtualColumnID),u=p;u<=_;u++)if(d!==S.virtualRowID||u!==S.virtualColumnID){var w=e.getCell(d,u);e._selectedCells.add(w)}}else e._modeIsMultiSel?e._selectedCells.add(i):e._selectedCells.unique(i);e.pushUpdateView()}}}))}})})),define("DS/SNResultUX/views/helpers/utils/TimeLine",["UWA/Core","UWA/Class/View","DS/SNInfraUX/SearchDebug","DS/Controls/Slider","DS/Controls/ProgressBar","DS/Controls/Popup","DS/Controls/Button","DS/MessageBus/MessageBus","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],(function(e,t,i,n,s,o,a,r,l){"use strict";return t.extend(i,{tagName:"div",className:"search-timeLine",data:[],timeLineApplyIcon:null,data:null,setLocalFilter:null,rerenderMultiView:null,container:null,timeLineScroller:null,init:function(e){return this.timeLineApplyIcon=null,this.data=null,this.setLocalFilter=null,this.rerenderMultiView=null,this.container=null,this.timeLineScroller=null,this._parent(e)},existAlready:function(){return null!==this.container.querySelector(".search-timeLine-content")},_getStatistic:function(e,t){let i=e.map((e=>e.count)).reduce(((e,t)=>e+t),0);return e.find((e=>e.label===t)).count/i*100},_renderTimeLine:function(t,i){let n=this;null!==document.querySelector(".search-timeLine-content")&&document.querySelector(".search-timeLine-content").destroy();let a=e.createElement("div",{class:"search-timeLine-content"});if(e.is(i)){let t=e.createElement("div",{class:"search-timeline-content-header"});if(i.backArrow){e.createElement("span",{class:"fonticon fonticon-chevron-left"}).inject(t).addEventListener("click",(e=>{n._backAction()}))}i.title&&e.createElement("p",{class:"search-timeline-content-header-title",content:i.title}).inject(t),t.inject(a)}return t.forEach((i=>{let r=e.createElement("div",{class:"search-timeLine-content-index"}),l=e.createElement("p",{class:"search-timeLine-content-index-title",content:i.label}).inject(r),c=n._getStatistic(t,i.label);new o({target:r,trigger:"hover click"}).setBody(i.label+" "+c.toPrecision(2)+"%"),l.addEventListener("click",(e=>{let i=t.find((t=>t.label===e.currentTarget.innerText));n._clickOnTitle(i)})),new s({shape:"linear",value:c,gradientAnimationFlag:!1,displayStyle:"lite"}).inject(r).elements.container.classList.add(c),r.inject(a)})),a},_clickOnTitle:function(e){this.setLocalFilter(e.label),r.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"clickOnTitle",persDim:{pd1:"Timeline",pd2:e.label}}})},_renderScroller:function(e){this.timeLineScroller=new n({minValue:0,maxValue:e.length-1,value:[0,e.length-1],displayStyle:"vertical"}),this.timeLineScroller.getTextFromValue=()=>this._hoverSlider(e),this.timeLineScroller.getContent().addEventListener("change",(()=>{this._changeValueSlider()}))},_hoverSlider:function(e){if(e[this.timeLineScroller.value[0]]&&e[this.timeLineScroller.value[1]])return e[this.timeLineScroller.value[0]].label+" ; "+e[this.timeLineScroller.value[1]].label},_changeValueSlider:function(){let e=this._getTimeLineTitle();if(this.fromDateInput&&this.toDateInput){let t=new Date(this.dateRange[this.timeLineScroller.value[0]]),i=new Date(this.dateRange[this.timeLineScroller.value[1]]);this.fromDateInput.setMinDate(t),this.toDateInput.setMinDate(t),this.fromDateInput.setDate(t),this.toDateInput.setDate(i),document.querySelector(".search-timeLine-container-content").append(this._renderTimeLine(this._getDataForTimeLine(),e?{title:e}:void 0))}else document.querySelector(".search-timeLine-container-content").append(this._renderTimeLine(this.data.slice(this.timeLineScroller.value[0],this.timeLineScroller.value[1]+1),e?{title:e,backArrow:!0}:void 0));this.timeLineApplyIcon.disabled=!1},_getTimeLineTitle:function(){},_backAction:function(){},updateScrollerRange:function(e){0!==e.length&&(this.timeLineScroller.maxValue=e.length-1,this.timeLineScroller.value=[0,e.length-1],r.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"refinementWithTimeLineScroller"}}))},setVisibility:function(e){const t=this.container.querySelector(".search-timeLine-container");e?t.classList.remove("hidden"):t.classList.add("hidden")},render:function(){if(this.data=this.getOption("data"),this.setLocalFilter=this.getOption("setLocalFilter"),this.rerenderMultiView=this.getOption("rerenderMultiView"),this.existAlready())return;let t=e.createElement("div",{class:"search-timeLine-container"+(this.getOption("dispayState")?"":" hidden")}),i=e.createElement("div",{class:"search-timeLine-container-content"}).inject(t);this._renderScroller(this.data),this.timeLineScroller.inject(i),this._renderTimeLine(this.data).inject(i),this.timeLineApplyIcon=new a({emphasize:"primary",label:l.get("APPLYButton"),disabled:!0}).inject(t),this.timeLineApplyIcon.getContent().addEventListener("buttonclick",(()=>{r.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"applyRange"}}),this.container.removeChild(this.container.querySelector(".search-timeLine-container")),this.rerenderMultiView(this.timeLineScroller.value)})),t.inject(this.container)},reset:function(){this.timeLineApplyIcon&&this.timeLineApplyIcon.destroy(),this.timeLineScroller&&this.timeLineScroller.destroy(),this.container.empty(!0)},destroy:function(){this.reset(),this._parent()}})})),define("DS/SNResultUX/views/utils/SearchHeaderCmd",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Events","UWA/Element","DS/UIKIT/Tooltip","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],(function(e,t,i,n,s,o,a){"use strict";return t.extend(n,i,{render:function(t){if(!e.is(t))return;var i=this;i.headerscontent=s.create("div",{class:"searchHeaderCmd_content"}),i.headerscontent.inject(t,"before"),i.headerhistory=s.create("div",{class:"searchHeaderCmd_content_Header"}),i.headerhistory.inject(i.headerscontent);var n=s.create("span",{id:"History",class:"fonticon fonticon-navigation-history"}).inject(i.headerhistory);let r=new o({position:"bottom",target:n,body:a.get("actions.History.toolTip")});n.addEvent("click",(function(e){i.dispatchEvent("onHistoryAction"),e.stopPropagation()})),i.headerinformationpanel=s.create("div",{class:"searchHeaderCmd_content_Header"}),i.headerinformationpanel.inject(i.headerscontent);var l=s.create("span",{id:"InfoPanel",class:"fonticon fonticon-info"}).inject(i.headerinformationpanel);r=new o({position:"bottom",target:l,body:a.get("actions.InfoPanel.toolTip")}),l.addEvent("click",(function(e){i.dispatchEvent("onInformationPanelAction"),e.stopPropagation()}))}})})),define("DS/SNResultUX/utils/ResultColorizationHelper",["UWA/Core","UWA/Class","UWA/Class/Debug","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchSettings"],(function(e,t,i,n,s){"use strict";return t.extend(i,{_currentPredicate:null,_colorMap:null,_hierarchyMap:null,_maxHierarchy:0,init:function(){let e=s.getOption("default_deep_hierarchy_tag_depth");this._colorMap=new Map,this._hierarchyMap=new Map;for(let t=0;t<e;t++)this._hierarchyMap.set(t,new Set)},getColor:function(t){let i=t.get(this._currentPredicate);return e.is(i,"array")&&(i=this._getEffectiveTag(i)),e.is(this._colorMap)&&this._colorMap.has(i)?this._colorMap.get(i):null},setColorMap:function(t){e.is(t,"array")&&(t.length>0&&(this._currentPredicate=t[0].predicate.split("/").pop().concat("_value")),this._colorMap.clear(),t.forEach(((e,t)=>{this._colorMap.set(e.object.toString(),e.color)})))},unsetColorMap:function(){this._currentPredicate=null,this._colorMap.clear()},_getEffectiveTag:function(t){for(let i=0;i<t.length;i++)e.is(t[i],"string")?(this._hierarchyMap.get(0).add(t[i].toString()),this._maxHierarchy++):(this._hierarchyMap.get(t[i].length-1).add(t[i].toString()),this._maxHierarchy<=t[i].length&&this._maxHierarchy++);let i,n=!1;for(let t=this._maxHierarchy-1;t>=0;t--){const s=this._hierarchyMap.get(t);if(s.size>0&&this._colorMap.has(s.values().next().value)){if(s.size>1){n=!0;break}e.is(i)||(i=s.values().next().value)}}if(this._cleanUp(),!1===n)return i},_cleanUp:function(){for(const e of this._hierarchyMap.values())e.clear();this._maxHierarchy=0}})})),define("DS/SNResultUX/views/WebUX/ComboBox/ComboBox",["DS/Controls/ComboBox","DS/Utilities/Dom"],(function(e,t){"use strict";function i(e){if(this.elements.text.textContent=e.trueLabel||e.label,this._properties.label.value=e.trueLabel||e.label,this.elements.iconPlaceholder){void 0!==this._generatedIcon&&(this.elements.iconPlaceholder.contains(this._generatedIcon)&&this.elements.iconPlaceholder.removeChild(this._generatedIcon),this.elements.text.style.display="icon"===this.mainElementContent?"none":"",this.elements.mainElement.style.textAlign="initial",this.elements.iconPlaceholder.style.marginRight="0px",this.elements.iconPlaceholder.style.paddingLeft="0px",delete this._generatedIcon);var i=!1;e&&e.icon&&(this._generatedIcon=t.generateIcon(e.icon),this._generatedIcon.inject(this.elements.iconPlaceholder),""!==e.label&&void 0!==e.label&&null!==e.label&&("icon"!==this.mainElementContent||"icon"===this.mainElementContent&&this._isIconModeAutomaticalySet)?this.elements.iconPlaceholder.style.marginRight="11px":i=!0),i&&"icon"!==this.mainElementContent&&!this._isIconModeAutomaticalySet?(this.mainElementContent="icon",this._isIconModeAutomaticalySet=!0):!i&&"icon"===this.mainElementContent&&this._isIconModeAutomaticalySet&&(this.mainElementContent="all",this._isIconModeAutomaticalySet=!1),"icon"===this.mainElementContent&&(this.elements.text.style.displayStyle="none",this.elements.mainElement.style.textAlign="center",!this.actionOnClickFlag&&this.expanderVisibleFlag&&"icon"!==this.mainElementContent&&(this.touchMode?this.elements.iconPlaceholder.style.paddingLeft="19px":this.elements.iconPlaceholder.style.paddingLeft="11px"))}}function n(){var e=void 0,t="",i="";if(!this.multiSelFlag){var n=this._getAllDescendants()[this.selectedIndex],s=this.elementsList[this.selectedIndex];n&&(n.options.icons&&n.options.icons.length>0&&n.options.icons[0]&&(e=n.options.icons[0]),s&&(i=s.trueLabel?s.trueLabel:n.options.label))}if("icon"!==this.mainElementContent)if(this.multiSelFlag&&this.selectedIndexes.length>0)for(var o=0;o<this.selectedIndexes.length;o++){(n=this._getAllDescendants()[this.selectedIndexes[o]])&&(t+=n.options.label,o!==this.selectedIndexes.length-1&&(t+=", "))}else if(this.selectedIndex>=0&&this.selectedIndex<this._getAllDescendants().length){(n=this._getAllDescendants()[this.selectedIndex])&&(t=n.options.label)}else this.placeholder&&(t=this.placeholder);return{icon:e,label:t,trueLabel:i}}return e.inherit({trueLabel:"",_selectedIndexModified:function(){if(this.mainElementVisibleFlag)if(this.enableSearchFlag)this._emptySearched=!1,-1===this.selectedIndex?this.elements.mainElement.value=this._lastCustomEntry:(this._lastCustomEntry="",this.elements.mainElement.value=this._getAllDescendants()[this.selectedIndex].options.label),this.fire("dimensionsChanged");else{!this.multiSelFlag&&-1===this.selectedIndex||this.multiSelFlag&&0===this.selectedIndexes.length?(this.elements.mainElement.value=this._lastCustomEntry,this.elements.mainElement.addClassName("wux-combobox-placeholderstyle")):this.elements.mainElement.removeClassName("wux-combobox-placeholderstyle");var e=void 0;if(void 0!==this.getMainElementCustomization){(e=this.getMainElementCustomization())||(e={});var t=e.hasOwnProperty("label"),s=e.hasOwnProperty("icon");if(!t||!s){var o=n.call(this);t||(e.label=o.label),s||(e.icon=o.icon)}}else e=n.call(this);i.call(this,e)}}})})),define("DS/SNResultUX/views/helpers/utils/SearchMultiViewUtils",["UWA/Core","UWA/Element","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/Logger"],(function(e,t,i,n){"use strict";function s(t){if(!e.is(t))return;let i;switch(t){case"what":i="ds6w:what/type_categorization";break;case"where":i="ds6w:where/ds6w:location/computedCountryInfo";break;case"who":i="ds6w:who/person";break;case"when":i="sixw:ds6w:when/ds6w:modified"}return i}function o(t,i,n,o,a){if(!e.is(i)||!e.is(n))return;if("where"===t)return function(t,i,n,o,a){if(!e.is(i)||!e.is(n)||!e.is(o))return;let r,l=0,c=s(t),d=[];if(!1===a){let t=i.getCurrentFilter();if(e.is(t)){let i=t.localfilters;e.is(i)&&e.is(i.condition)&&i.condition.forEach((function(t){let i=Object.keys(t);if(i[0]===c){let n=t[i];if(e.is(n)&&e.is(n.condition))n.condition.forEach((function(e){d.push(e.display)}));else{let t=n[0];e.is(t)&&d.push(t.displayValue)}}}))}}if(d.length){let t=e.is(o.getRefineHelpers().globeViewContainerContent)&&o.getRefineHelpers().globeViewContainerContent._continents,i=e.is(t)&&Object.keys(t),s=e.is(i)&&i.length;for(let n=0;n<s;n++){let a=t[i[n]];if(e.is(a)&&a===d[0]){let t=o.getRefineHelpers().globeViewContainerContent._continentsList[i[n]],a=e.is(t)&&t.countries,r=e.is(a)&&Object.keys(a);d=[];let l=r.length,c=0;for(c=0;c<l;c++)d.push(r[c]);n=s}}r=e.clone(n);let a=[],c=r.groups[0].object;d.forEach((function(t){let i=c.findIndex((function(e){if(e.dispText===t)return!0}));-1!==i&&a.push(e.clone(c[i]))})),a.length&&(r.groups[0].object=a,l=a.length+1)}else r=n;let u,h=r.groups[0];switch(h?h.predicate:""){case"type_categorization":u="what";break;case"computedCountryInfo":u="where";break;case"person":u="who";break;case"ds6w:modified":u="when"}return{Tags:r,SearchBack:l,W:u}}(t,i,n,o,a);let r,l=0,c=!1,d=s(t),u=[];if(!1===a){let t=i.getCurrentFilter();if(e.is(t)){let i=t.allfilters;e.is(i)&&e.is(i.condition)&&i.condition.forEach((function(t){let i=Object.keys(t);if(i[0]===d){let n=t[i];if(e.is(n)&&e.is(n.condition))n.condition.forEach((function(e){(void 0===e.excluded||!0!==e.excluded)&&u.push(e.object)}));else{let t=n[0];e.is(t)&&(void 0===t.excluded||!0!==t.excluded)&&u.push(t.object)}}}))}}if(u.length){r=e.clone(n);let t=[];if(e.is(r)&&e.is(r.groups)&&e.is(r.groups[0])){let i=r.groups[0].object,n=i=>{u.forEach((function(n){let s=i.findIndex((function(t){return t.type&&"date"===t.type?t.object.from===n.from&&t.object.to===n.to:!!(t.identifier===n||t.object&&e.is(t.object.value,"array")&&t.object.value.length>0&&t.object.value[0]===n)}));-1!==s&&t.push(e.clone(i[s]))}))},s=e=>{for(let t=0;t<e.length;t++)e[t].subGroups&&e[t].subGroups.length>0&&s(e[t].subGroups);n(e)};s(i),t.length&&(r.groups[0].object=t,l=t.length,c=!0)}}else r=n;let h,g=r.groups[0];switch(g?g.predicate:""){case"type_categorization":h="what";break;case"computedCountryInfo":h="where";break;case"person":h="who";break;case"ds6w:modified":h="when"}return{Tags:r,SearchBack:l,W:h,computeGroup:c}}return{getEmbeddedTaggerTags:function(e,t,i,n,s){return o(e,t,i,n,s)},selectElementInGlobalView:function(t,i){return function(t,i){if(!e.is(t)||!e.is(i))return;let n=i.getTreeDocument(),s=e.is(n)&&n.getRoots();if(e.is(s,"array")){let i=s.length,n=0;for(;n<i;n++){let o=s[n];e.is(o)&&e.is(o._options)&&o._options.id===t&&(o.select(),n=i)}}}(t,i)},manageSearchBackArrow:function(t,i){return function(t,i){if(!e.is(t)||!e.is(i))return;let n=t.getSNResultMgt(),s=t.getViewId();i?n&&n.hideSearchContentSetHeader():"what"!==s&&"who"!==s&&"when"!==s&&"where"!==s&&n&&n.showSearchContentSetHeader()}(t,i)},manageDisplayChannelView:function(t,n,s,o,a){return function(t,n,s,o,a){if(!e.is(t)||!e.is(n))return;let r=t.getTreeDocument();if(!e.is(r._trueRoot))return;let l=r&&r.getRoots(),c=l&&l.length,d=!1,u=0;for(r.prepareUpdate();u<c;u++){let t=l[u];e.is(t)&&t.show()}if(e.is(s,"object")){let e=s.width;e<=620?("textual"===n||"largeTextual"===n||"thumbnail"===n)&&(u=1,d=!0):e>=621&&e<=1145?"textual"===n||"largeTextual"===n?(u=3,d=!0):"thumbnail"===n&&(u=2,d=!0):"textual"===n||"largeTextual"===n?(u=3,d=!0):"thumbnail"===n&&(u=5,d=!0)}else-1!==["iphone","android"].indexOf(i.getDeviceCategory())?"textual"!==n&&"largeTextual"!==n&&"thumbnail"!==n||(u=1,d=!0):"textual"===n||"largeTextual"===n?(u="normal"===s?1:3,d=!0):"thumbnail"===n&&(u="normal"===s?1:5,d=!0);if(e.is(o)&&"where"===o&&(u=4,d=!0,e.is(a)&&!0===a.getMaxDisplay()&&(u=8)),!0===d)for(;u<c;u++){let t=l[u];e.is(t)&&t.hide(!1)}r.pushUpdate()}(t,n,s,o,a)},checkIfRefine:function(t,i,n,o){return function(t,i,n,o){let a=!1;if(!e.is(t)||!e.is(i))return a;let r=n;if("where"===o&&"where"===r)return a;if(r===o){i.W;let n=t.getCurrentFilter();if(e.is(n)){let t=n.localfilters;if(e.is(t)&&e.is(t.condition,"array")){let e=s(r);t.condition.forEach((function(t){Object.keys(t)[0]===e&&(a=!0)}))}}}return a}(t,i,n,o)},createSearchMultiViewLabel:function(i,n,s,o,a){let r,l=a&&a.inContextBuilderMode,c=a&&a.guided;if(r=e.is(s)&&e.is(s.isRecentContent)&&!0===s.isRecentContent&&e.is(s.accessRecentContent)?t.create("div",{class:"search-multi-view-label",events:{click:s.accessRecentContent}}):t.create("div",{class:"search-multi-view-label"}),!c&&e.is(i.icon)){let n;if(e.is(o))n=t.create("div",{class:"search-multi-view-icon fonticon "+i.icon.classes});else{let s=e.is(i.icon.classes)&&e.is(i.icon.classes.split("fonticon-"))&&e.is(i.icon.classes.split("fonticon-")[1])?"tn-"+i.icon.classes.split("fonticon-")[1].split(" ")[0]:void 0;n=t.create("div",{class:"search-multi-view-icon fonticon "+i.icon.classes+" "+s})}e.is(i.icon)&&e.is(i.icon.image)&&t.create("img",{src:i.icon.image}).inject(n),n.inject(r)}var d=t.create("div",{class:"search-multi-view-encart"});return!l&&c?(t.create("p",{text:-1===i.totalCount?i.getComputedResultCount():i.hits}).inject(d),t.create("p",{text:c}).inject(d)):e.is(i.headTitle)&&(l&&(i.headTitle+=" preview"),t.create("p",{text:i.headTitle}).inject(d)),e.is(s)&&e.is(s.isRecentContent)&&!0===s.isRecentContent&&e.is(s.accessRecentContent)?t.create("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-chevron-right search-multi-view-recent-content"}).inject(d):i&&i.isSearchRespEstimated&&!i.isSearchRespEstimated()&&!c&&(t.create("p",{text:"who"===n?"-":"|"}).inject(d),t.create("p",{text:-1===i.totalCount?i.getComputedResultCount():i.hits}).inject(d)),d.inject(r),e.is(s)&&e.is(s.onclick,"function")&&(r.onclick=s.onclick),r},removeFilter:function(t,i){return function(t,i){if(!e.is(t)||!e.is(i))return;s(i);let n=t.getCurrentFilter(),o=n&&n.localfilters;if(e.is(o)&&e.is(o.condition,"array")){let t=s(i),n=o.condition.length-1;for(;n>=0;n--){let i=o.condition[n];e.is(i)&&Object.keys(i)[0]!==t&&o.condition.splice(n,1)}}return o}(t,i)},ifDisplayViewMore:function(t,n,s,o){if(!e.is(t)||!e.is(n)||!e.is(s))return;let a=!1,r=-1===n.totalCount?n.getComputedResultCount():n.hits,l=8;if(e.is(o)&&"where"===o&&(l=4),-1!==["iphone","android"].indexOf(i.getDeviceCategory()))a="textual"===t||"largeTextual"===t||"thumbnail"===t?r>1:r>l;else if("textual"===t||"largeTextual"===t||"thumbnail"===t){let e=s.width;e<=620?a=r>1:e>=621&&e<=1145?"textual"===t||"largeTextual"===t?a=r>3:"thumbnail"===t&&(a=r>2):e>=1150&&e<=1450?a=r>3:e>=1455&&e<=1850?"textual"===t||"largeTextual"===t?a=r>3:"thumbnail"===t&&(a=r>4):"textual"===t||"largeTextual"===t?a=r>3:"thumbnail"===t&&(a=r>5)}else a=r>l;return a},compareObjects:function t(i,s,o){if(i===s)return n.info("compareObjects x === y:"+i===s),!0;if(!(i instanceof Object&&s instanceof Object))return n.info("compareObjects !(x instanceof Object) || !(y instanceof Object)"),!1;if(i.constructor!==s.constructor)return n.info("compareObjects x.constructor !== y.constructor"),!1;for(var a in i)if(i.hasOwnProperty(a)){if(!s.hasOwnProperty(a))return n.info("compareObjects !y.hasOwnProperty(p)"),!1;if(i[a]===s[a])continue;if("object"!=typeof i[a])return n.info("compareObjects typeof (x[p]) !== object"),!1;if(!t(i[a],s[a],o))return n.info("compareObjects !equals(x[p], y[p]) y[p]:"+JSON.stringify(s[a])),e.is(o,"array")&&o.push(s[a]),!1}for(a in s)if(s.hasOwnProperty(a)&&!i.hasOwnProperty(a))return n.info("compareObjects y.hasOwnProperty(p) && !x.hasOwnProperty(p):"+JSON.stringify(s)),e.is(o,"array")&&o.push(s),!1;return!0},IfLastRefineisInTheGoodW:function(t,i,n){if(!e.is(i)||!e.is(i))return!0;let o=!0,a=s(t),r=i.getCurrentFilter();if(e.is(r)){let t=r.localfilters;if(null===n||!e.is(n)||e.is(n.condition)&&0===n.condition.length)e.is(t)&&e.is(t.condition)&&t.condition.forEach((function(e){Object.keys(e)[0]!==a&&(o=!1)}));else{let i=[];if(e.is(n.condition)&&e.is(t)&&e.is(t.condition)){this.compareObjects(n.condition,t.condition,i);if(e.is(i,"array")&&i.length>0){let t=i[i.length-1];if(e.is(t)){let e=Object.keys(t);e&&e.length&&e[0]!==a&&(o=!1)}}}}}return o},IfMustAddRefineOnTitleClick:function(t,i){if(!e.is(t)||!e.is(i))return!0;let n=!0,s=!1,o=t.getCurrentFilter();if(e.is(o)){let a=o.localfilters;if(e.is(a)&&e.is(a.condition)){let o=a.condition;for(let t=o.length-1;t>=0;t--){let a=!0,r=o[t];if(e.is(r)){let l=Object.keys(r),c=l&&l.length;for(let t=0;t<c;t++){let o=r[l[t]];if(e.is(o)&&e.is(o.condition)){let t,r=o.condition,l=r.length;for(let s=0;s<l;s++){let o=r[s];if(e.is(o)){o.display===i&&(n=!1,t=s,s=l)}}l>1&&e.is(t)&&(r.splice(t,1),s=!0,a=!1)}else if(e.is(o,"array"))for(let e=0;e<o.length;e++)"date"===o[e].type&&o[e].displayValue.replace(/ /g,"")===i&&(n=!1)}!0===a&&o.splice(t,1)}}!0===s&&t.setLocalFilter(a,!0)}}return n}}})),define("DS/SNResultUX/savedSearch/SavedSearch_ActionHandler",["UWA/Core","UWA/Class","DS/WAFData/WAFData","UWA/Class/Debug","UWA/Class/Events","UWA/Element","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchCom","DS/SNInfraUX/SearchVersioning","DS/SNResultUX/utils/SearchServices","DS/UIKIT/Alert","DS/UIKIT/Popover","DS/UIKIT/Input/Text","DS/UIKIT/Input/Button","DS/MessageBus/MessageBus","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/SNInfraUX/RefineHelper/RefineHelper","DS/SNResultUX/utils/ExternalComponentHelpers"],(function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_,f,m,S,v){"use strict";var w="socket_id_#saved_search_edit#",b="widget_id_#saved_search_edit#";return t.singleton(s,n,{_run_saved_search:!0,executeAction:function(t,i){if(!(e.is(t,"object")&&e.is(t.object_ids,"array")&&e.is(t.action_id,"string")&&t.actionsHelper))throw new Error("invalid input to action handler");switch(t.action_id){case"run_saved_search":if(1!==t.object_ids.length||!0!==this._run_saved_search)throw new Error("run_saved_search is called with invalid object_ids information");this._runSearch2(t);break;case"rename_saved_search":if(1!==t.object_ids.length)throw new Error("rename_saved_search is called with invalid object_ids information");this.renameSearchUI2(t);break;case"delete_saved_search":this._deleteSearch2(t);break;case"share_saved_search":this._shareSearch(t);break;case"unshare_saved_search":this._unshareSearch(t);break;case"edit_saved_search":this._editSearch(t)}},_displayAlert:function(t,i){if(e.is(i)){var n=i.getSNSkeleton().getOption("widgetId");t.widgetId=n,u._displayAlert(t)}else a.error("Bad collection arg !")},renameSearchUI2:function(e){var t=this;e.actionsHelper.hidePopover();var i=new g({target:e.actionsHelper.getTarget(),className:"fav-search-popover",position:"bottom",title:m.get("rename_fav_search"),events:{onHide:function(){this.destroy()}}});e.actionsHelper.setPopover(i),o.create("span",{id:"close-popover-icon",title:m.get("closeButton"),class:"fonticon fonticon-cancel",events:{click:function(t){t.stopPropagation(),e.actionsHelper.hidePopover()}}}).inject(i.getTitle());var n=o.create("form",{class:"formSaveSearch form-inline"}),s=o.create("div",{class:"divNewSearch form-group"});s.inject(n);var a=o.create("span",{id:"fav-search-clear-icon",class:"fonticon fonticon-cancel-circled",events:{click:function(e){e.stopPropagation(),l.setValue(""),this.hide()}}}).inject(s),r=e.actionsHelper.getValue({id:e.object_ids[0],attribute:"ds6w:label"}),l=new p({placeholder:m.get("save_search_default_text"),value:r,class:"newSaveSearchName",id:"newSaveSearchName",maxlength:256,events:{onKeyDown:function(i){this.getValue()?a.show():a.hide(),13===i.keyCode&&(i.preventDefault(),i.stopPropagation(),t._renameSearch2(e,this.getValue()),e.actionsHelper.hidePopover())},onChange:function(){this.getValue()?a.show():a.hide()}}}).inject(s),c=o.create("div",{class:"divBtn"});c.inject(n),new _({value:m.get("OKButton"),className:"primary xsmall okSaveSearch",id:"okSaveSearch",events:{onClick:function(){t.log("Search name="+l.getValue()),t._renameSearch2(e,l.getValue()),e.actionsHelper.hidePopover()}}}).inject(c),new _({value:m.get("CancelButton"),className:"default xsmall cancelSaveSearch",id:"cancelSaveSearch",events:{onClick:function(){t.log("Save canceled"),e.actionsHelper.hidePopover()}}}).inject(c),i.setBody(n),i.show(),l.focus()},_renameSearch2:function(t,n){var s=t.actionsHelper.getValue({id:t.object_ids[0],attribute:"ds6w:label"});if(!function(e){if(e.indexOf("<")>=0||e.indexOf(">")>=0){e=(e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;")).replace(/&lt;/g,'<em style="color:red">&lt;</em>').replace(/&gt;/g,'<em style="color:red">&gt;</em>');var i=m.replace(m.get("rename_search_failure"),{old_name:s,new_name:e});return i+="<br>"+m.get("save_search_invalid_character"),t.actionsHelper.displayAlert({message:i,className:"error saveSearchAlert"}),!1}return!0}(n))return!1;var o={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify({id:t.object_ids[0],name:n})};t.actionsHelper.getServiceURL({id:t.object_ids[0],onComplete:function(r){if(e.is(r,"string")){var l=t.actionsHelper.get3DSpaceSecurityContext();l&&l.trim().length>0&&(o.headers.SecurityContext=l),o.url=r+"/resources/SNAPI/search_services/updateSearch",o.onComplete=function(){t.actionsHelper.setLabel({id:t.object_ids[0],newLabel:n}),t.actionsHelper.displayAlert({message:m.replace(m.get("rename_search_successful"),{old_name:s,new_name:n}),className:"success saveSearchAlert"})},o.onFailure=function(i,o){var r=m.replace(m.get("rename_search_failure"),{old_name:s,new_name:n});if(e.is(o,"string"))try{var l=JSON.parse(o);e.is(l)&&e.is(l.errorCode)&&(r+="<br>"+m.replace(m.get("save_search_error_"+l.errorCode),{name:n,invalidCharString:l.invalidChar}))}catch(e){a.log("Error parsing errorObject",e)}t.actionsHelper.displayAlert({message:r,className:"error"})},i.authenticatedRequest(o.url,o)}}})},_runSearch2:function(t){var n=this;n._run_saved_search=!1;var s={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},data:"id="+t.object_ids[0]};t.actionsHelper.getServiceURL({id:t.object_ids[0],onComplete:function(o){if(e.is(o,"string")){var r=t.actionsHelper.get3DSpaceSecurityContext();r&&r.trim().length>0&&(s.headers.SecurityContext=r),s.url=o+"/resources/SNAPI/search_services/savedSearch";var l=t.actionsHelper.getValue({id:t.object_ids[0],attribute:"ds6w:label"});s.onComplete=function(i){var s=e.Json.decode(i);if(e.is(s)){var o={},r={};try{r=e.Json.decode(s.searchstring),o.search_criteria=r.originalSearchCriteria,o.originalSearchCriteria=r.originalSearchCriteria,o.search_criteria_to_display=r.search_criteria_to_display}catch(e){o.search_criteria=s.searchstring}if("#advancedSearch"===r.originalSearchCriteria)return n._startIncontextForFavorite(s,t,l),void(n._run_saved_search=!0);e.is(s.name)&&(o.search_name=s.name);try{o.tag_filter=e.Json.decode(s.taggerstring)}catch(e){a.log(e)}e.is(s.searchOptions)&&(e.is(s.searchOptions.source)&&(o.source=s.searchOptions.source),e.is(s.searchOptions.order_by)&&e.is(s.searchOptions.order_field)&&(o.order_by=s.searchOptions.order_by,o.order_field=s.searchOptions.order_field)),o.savedSearch=!0;var c=f.getSubscriptions({channel:"3DSearch-TabManager-"+t.widget_id,topic:"addTab"});e.is(c,"array")&&c.length>0&&!0!==t.actionsHelper.isInContextMode()&&t.actionsHelper.canOpenATab()?t.actionsHelper.dispatchEvent({event:"onRunSavedSearchOnNewTab",params:o}):t.actionsHelper.dispatchEvent({event:"onRunSavedSearch",params:o}),t.actionsHelper.displayAlert({message:m.replace(m.get("run_search_successful"),{search_name:l}),className:"success"}),n._run_saved_search=!0}},s.onFailure=function(){t.actionsHelper.displayAlert({message:m.replace(m.get("run_search_failure"),{search_name:l}),className:"error"}),n._run_saved_search=!0},i.authenticatedRequest(s.url,s)}}})},_editSearch:function(t){var n=this;"3DDashboard"===l.identifyClientInfo().identifier&&f.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"search-maximiseEditingFavoriteSearch"}),"3DSpace"===l.identifyClientInfo().identifier&&f.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"openTagger"});var s={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},data:"id="+t.object_ids[0]};t.actionsHelper.getServiceURL({id:t.object_ids[0],onComplete:function(o){if(e.is(o,"string")){var a=t.actionsHelper.get3DSpaceSecurityContext();a&&a.trim().length>0&&(s.headers.SecurityContext=a),s.url=o+"/resources/SNAPI/search_services/savedSearch";var r=t.actionsHelper.getValue({id:t.object_ids[0],attribute:"ds6w:label"});s.onComplete=function(i){var s=e.Json.decode(i);n._startIncontextForFavorite(s,t,r,!0)},s.onFailure=function(){t.actionsHelper.displayAlert({message:m.replace(m.get("fetch_search_failure"),{search_name:r}),className:"error"})},i.authenticatedRequest(s.url,s)}}})},_startIncontextForFavorite:function(t,i,n,s){var o=this;if(e.is(t)){var l={},u={};e.is(i)&&e.is(i.collection)&&(l.tenant=i.collection.getActiveTenant());try{u=e.Json.decode(t.searchstring),l.search_criteria=u.query,l.originalSearchCriteria=u.originalSearchCriteria}catch(e){l.search_criteria=t.searchstring}var h=d.isActiveWithCurrentVersion([{R2018x:"FD05"},{R2019x:"FD01"},{R2020x:"GA"}]);if(s&&!1===h&&"#advancedSearch"===u.originalSearchCriteria)return void i.actionsHelper.displayAlert({message:m.get("modify_search_not_supported"),className:"error"});e.is(t.name)&&(l.search_name=t.name);try{l.tag_filter=e.Json.decode(t.taggerstring)}catch(e){a.log(e)}e.is(t.searchOptions)&&(e.is(t.searchOptions.source)&&(l.source=t.searchOptions.source),e.is(t.searchOptions.order_by)&&e.is(t.searchOptions.order_field)&&(l.order_by=t.searchOptions.order_by,l.order_field=t.searchOptions.order_field));var g=f.getSubscriptions({channel:"3DSearch-TabManager-"+i.widget_id,topic:"activateInContextSearch"}),p=!1===i.actionsHelper.isAPinnedWidget()&&e.is(g,"array")&&g.length>0,_={widget_id:b,default_with_precond:!0,default_search_criteria:l.search_criteria,precond:void 0,source:l.source,tenant:l.tenant,tag_filter:l.tag_filter,ORDER_BY:l.order_by,ORDER_FIELD:l.order_field,app_socket_id:w,title:s?m.replace(m.get("title_modify_savedsearch"),{search_name:n}):void 0,search_name:n,mode:s?"furtive":void 0,show_banned_types:!1,searchable_types:!0,furtive_options:{min_select:0},UXOptions:{menuMyFavorites:!s,menuMyContent:!s,dnD:!s,dblClk:!s,localActions:!s,searchRecentContent:!s,globalToolbarActions:{saveAsFavorite:!s,export:!s,print:!s}},forceWidgetUXRecreation:!1,closeTransient:!p,modifysavedsearch:s,savedSearch:!0};if("#advancedSearch"===u.originalSearchCriteria){_.advanced_search={showByDefault:!0,searchOnInit:!0,exclusive:!0,selection:{}};var v=t.taggerstring,C=JSON.parse(v).localfilters;for(var y in S.isSimplifiedTaggerFilters(C)&&(C=S.getAllAdvanceFilters(C)),C){var D=y.split("/"),I=D[D.length-1];1===D.length&&(I=I.substring(5)),_.advanced_search.selection[I]||(_.advanced_search.selection[I]=[]),e.is(C[y],"array")&&C[y].forEach((function(e){_.advanced_search.selection[I].push(e.object)}))}_.displayValue=""}if(i.manageTabContainerHideShow=p,e.is(o.socket)||(o.socket=c.createSocket({socket_id:w,widgetId:i.actionsHelper.widget_id}),i.service_id=i.actionsHelper.getServiceID({id:i.object_ids[0]}),i.platform_id=i.actionsHelper.getPlatformID({id:i.object_ids[0]}),i.search_name=i.actionsHelper.getValue({id:i.object_ids[0],attribute:"ds6w:label"}),o.socket.addListener("InContextSearch_Response",o._modifySearch.bind(o,i,u)),o.socket.addListener("onCloseTransient",(function(e){e&&e.in_apps_search&&e.in_apps_search.widget_id===b&&(o.socket.dispatchEvent("UnregisterContext",{widget_id:b}),c.deleteSocket(w),o.socket.disconnect(),delete o.socket,o.socket=null)}))),!0===r.getOption("search_web_in_win"))_.inContextProtocol_FUN073378=!0,o.socket.addListener("InContextInit",(function(){InContextSearch({searchString:l.search_criteria,originalSearchCriteria:l.originalSearchCriteria,tag_filter:l.tag_filter,search_name:n}),o.socket.removeListener("InContextInit")})),i.actionsHelper.isInContextMode()&&deactivateInContextSearch({donotshowlastsearch:void 0,notify_to_cpp:!1}),activateInContextSearch(_),window.hasOwnProperty("sendNotificationWebInWin")&&e.is(sendNotificationWebInWin,"function")&&sendNotificationWebInWin("UpdateSearchField",JSON.stringify({search_criteria:"#advancedSearch"===u.originalSearchCriteria?"":l.search_criteria}));else{if(e.is(i)&&e.is(i.collection)&&e.is(i.actionsHelper)&&e.is(i.actionsHelper.getClientInfo())&&"3DSpace"===i.actionsHelper.getClientInfo().identifier){var T=i.collection.getTaggerProxy();e.is(T)&&T.unfocus()}o.socket.dispatchEvent("RegisterContext",_),o.socket.dispatchEvent("InContextSearch",_)}}},_modifySearch:function(t,n,s){var o=this;if(this.log("_modifySearch"),"in_app_ok"===s.selected_command){var l=t.object_ids[0];if(!e.is(l,"string"))return;var d=t.search_name;this.log("searchName="+d);var u=s.search_params,g=u.originalSearchCriteria;"#advancedSearch"===n.originalSearchCriteria&&(g="#advancedSearch");var p={query:u.query,originalSearchCriteria:g};this.log("searchParam.search_criteria="+u.query),this.log("searchParam.tagger_criteria="+u.refine);var _={method:"POST",headers:{Accept:"application/json, application/xml","Content-Type":"application/json"},data:{name:d,id:l,searchSpec:p,taggerSpec:u.refine,searchOptions:{},originalSearchCriteria:g}};_.data.taggerSpec||(_.data.taggerSpec=""),u.source&&(_.data.searchOptions.source=u.source),u.order_by&&u.order_field&&(_.data.searchOptions.order_by=u.order_by,_.data.searchOptions.order_field=u.order_field),_.data=JSON.stringify(_.data),t.actionsHelper.getServiceURL({id:l,service_id:t.service_id,platform_id:t.platform_id,onComplete:function(n){if(e.is(n,"string")){var s=t.actionsHelper.get3DSpaceSecurityContext();s&&s.trim().length>0&&(_.headers.SecurityContext=s),_.url=n+"/resources/SNAPI/search_services/updateSearch";var o=_.url,r={onComplete:function(t){var i=e.Json.decode(t);if(e.is(i)){var n={visible:!0,autoHide:!0,closable:!0,messages:[{message:m.replace(m.get("modify_search_successful"),{search_name:i.name}),className:"success saveSearchAlert"}]};new h(n).inject(e.extendElement(document.body),"top")}},onFailure:function(t,i){var n=m.replace(m.get("save_search_failure"),{search_name:d});if(e.is(i,"string"))try{var s=JSON.parse(i);e.is(s)&&e.is(s.Error)&&(n+="<br>"+s.Error)}catch(e){a.error("Error parsing errorObject:",e)}new h({visible:!0,autoHide:!1,closable:!0,messages:[{message:n,className:"error saveSearchAlert"}]}).inject(e.extendElement(document.body),"top")}};r=e.extend(_,r,!0),i.authenticatedRequest(o,r)}}})}!0===r.getOption("search_web_in_win")?deactivateInContextSearch({donotshowlastsearch:void 0,notify_to_cpp:!1,action_id:t.action_id}):o.socket.dispatchEvent("UnregisterContext",{widget_id:b}),c.deleteSocket(w),o.socket.disconnect(),delete o.socket,o.socket=null},_deleteSearch2:function(t){var n={method:"POST",headers:{Accept:"application/json, application/xml","Content-Type":"application/json"},data:JSON.stringify({id:t.object_ids.join()})};t.actionsHelper.getServiceURL({id:t.object_ids[0],onComplete:function(s){if(e.is(s,"string")){var o=t.actionsHelper.get3DSpaceSecurityContext();o&&o.trim().length>0&&(n.headers.SecurityContext=o),n.url=s+"/resources/SNAPI/search_services/deleteSearch";var a=t.object_ids.length>1,r=t.actionsHelper.getValue({id:t.object_ids[0],attribute:"ds6w:label"});n.onComplete=function(){t.actionsHelper.deleteResults({ids:t.object_ids}),t.actionsHelper.displayAlert({message:a?m.get("delete_search_successful_multi"):m.replace(m.get("delete_search_successful"),{search_name:r}),className:"success"})},n.onFailure=function(){t.actionsHelper.displayAlert({message:a?m.get("delete_search_failure_multi"):m.replace(m.get("delete_search_failure"),{search_name:r}),className:"error"})},i.authenticatedRequest(n.url,n)}}})},_shareSearch:function(t){var n=t.object_ids[0],s=t.actionsHelper.getValue({id:n,attribute:"ds6w:label"}),o={method:"POST",headers:{Accept:"application/json, application/xml","Content-Type":"application/json"}};o.data=JSON.stringify({id:n}),t.actionsHelper.getServiceURL({id:n,onComplete:function(n){if(e.is(n,"string")){var a=t.actionsHelper.get3DSpaceSecurityContext();a&&a.trim().length>0&&(o.headers.SecurityContext=a),o.url=n+"/resources/SNAPI/search_services/savedSearch/lifecycle/share";var r={onComplete:function(){t.actionsHelper.displayAlert({message:m.replace(m.get("share_search_successful"),{search_name:s}),className:"success"})},onFailure:function(){t.actionsHelper.displayAlert({message:m.replace(m.get("share_search_failure"),{search_name:s}),className:"error"})}};r=e.extend(o,r,!0),i.authenticatedRequest(o.url,r)}}})},_unshareSearch:function(t){var n=t.object_ids[0],s=t.actionsHelper.getValue({id:n,attribute:"ds6w:label"}),o={method:"POST",headers:{Accept:"application/json, application/xml","Content-Type":"application/json"}};o.data=JSON.stringify({id:n}),t.actionsHelper.getServiceURL({id:n,onComplete:function(n){if(e.is(n,"string")){var a=t.actionsHelper.get3DSpaceSecurityContext();a&&a.trim().length>0&&(o.headers.SecurityContext=a),o.url=n+"/resources/SNAPI/search_services/savedSearch/lifecycle/unshare";var r={onComplete:function(){t.actionsHelper.displayAlert({message:m.replace(m.get("unshare_search_successful"),{search_name:s}),className:"success"})},onFailure:function(){t.actionsHelper.displayAlert({message:m.replace(m.get("unshare_search_failure"),{search_name:s}),className:"error"})}};r=e.extend(o,r,!0),i.authenticatedRequest(o.url,r)}}})}})})),define("DS/SNResultUX/views/helpers/utils/SearchBackArrowView",["UWA/Core","UWA/Class/View","DS/SNInfraUX/SearchDebug","DS/SNInfraUX/SearchUtils","DS/SNResultUX/views/helpers/utils/SearchMultiViewUtils","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/MessageBus/MessageBus"],(function(e,t,i,n,s,o,a){"use strict";return t.extend(i,{uwaClassName:"SearchBackArrowView",name:"search_back_arrow",_centerdiv:null,_info:null,_skeleton:null,_resultMgt:null,_lastViewMode:null,domEvents:{"click .back-header-button":"_onClickBack","click .back-information .title":"_onClickBack","click .information-header-button":"_onClickInfo"},init:function(e){let t=this;return t._centerdiv=null,t._info=null,t._skeleton=null,t._resultMgt=null,t._lastViewMode=null,a.subscribe({channel:"3dSearch-back-arrow-view",topic:"update",callback:e=>{e.number&&t.updateCenterDivElementNumber(e.number)}}),this._parent(e)},destroy:function(){this._parent()},render:function(t){if(!e.is(t)||!e.is(t.parentContainer))return;let i=this,n=t.parentContainer;return i._resultMgt=t.resultMgt,i._skeleton=t.skeleton,i.container.setContent(i._createContent(t)),this.container.addClassName(i.uwaClassName),i.inject(n),this},_createContent:function(t){let i=this;i._skeleton;i._manageInfo();let n=e.createElement("div",{class:"fonticon fonticon-2x fonticon-left-open back-header-button"});if(i._centerdiv=e.createElement("div",{class:"search-back-center-wrapper"}),e.is(t)&&e.is(t.element)){let n=e.extendElement(e.clone(t.element));e.is(n)&&n.inject(i._centerdiv)}return[{class:"search-back-header-wrapper",html:[n,{class:"back-information",html:[{class:"title",html:o.SearchResultClassified_Back}]}]},i._centerdiv,i._info]},_onClickBack:function(t){let i=this,n=i._skeleton;if(e.is(n)&&i._resultMgt){n.switchOnView(i._lastViewMode),i._resultMgt.hideSearchBackView();let t=i._resultMgt.backToMultiView(i._lastViewMode);if(!e.is(t)){let t=i._resultMgt._taggerProxy,n=s.removeFilter(t,i._lastViewMode);e.is(n)&&t.setLocalFilter(n,!1)}}t.stopPropagation(),t.preventDefault()},_onClickInfo:function(e){this._skeleton;e.stopPropagation(),e.preventDefault()},switchOnView:function(t,i){let n=this;for(n._lastViewMode=t||"",n._manageInfo();n._centerdiv.firstChild;)n._centerdiv.removeChild(n._centerdiv.firstChild);if(e.is(i)&&e.is(i.domElement)){let t=e.extendElement(e.clone(i.domElement));e.is(t)&&t.inject(n._centerdiv),n._resultMgt.clickOnTitleMultiView(n._lastViewMode,i)}},_manageInfo:function(){let t=this;if(!e.is(t._skeleton)||!e.is(t._resultMgt))return;let i=t._skeleton;if("where"===i.getCurrentView().id){let s=i&&i.getPreference("informationPanelState");e.is(s,"boolean")&&!0===s&&(i.ActivateDeactivateInformationsPanel(),t._resultMgt.manageInformationPanel(!1)),-1!==["iphone","ipad","android"].indexOf(n.getDeviceCategory())&&t._resultMgt._contentSetHeader.getElement(".search-content-set-actions.content-set-actions.set-actions.with-actions")&&t._resultMgt._contentSetHeader.getElement(".search-content-set-actions.content-set-actions.set-actions.with-actions").setStyle("display","none")}else-1!==["iphone","ipad","android"].indexOf(n.getDeviceCategory())&&t._resultMgt._contentSetHeader.getElement(".search-content-set-actions.content-set-actions.set-actions.with-actions")&&t._resultMgt._contentSetHeader.getElement(".search-content-set-actions.content-set-actions.set-actions.with-actions").setStyle("display","block")},updateCenterDivElementNumber:function(e){this._centerdiv&&this._centerdiv.firstChild&&this._centerdiv.firstChild.childNodes[3]&&(this._centerdiv.firstChild.childNodes[3].innerHTML=e)}})})),define("DS/SNResultUX/utils/AddTag_ActionHandler",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Events","UWA/Element","DS/UIKIT/Input/Button","DS/UIKIT/Modal","DS/TagNavigator/userTags/UserTagsModel","DS/TagNavigator/userTags/UserTagsView","DS/TagNavigator/userTags/utils/UserTagsUtils","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/SNInfraUX/SearchUtils","DS/SNResultUX/utils/SearchServices","DS/SNInfraUX/SearchSettings","DS/Controls/Tab","DS/Controls/Editor"],(function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_){"use strict";return t.singleton(n,i,{modal:null,okBtn:null,isCollectiveTagging:!1,_userTagsView:null,_currentTab:"add",executeAction:function(t){if(!0===g.getOption("companyTags")){if(this.isCollectiveTagging=!0,!(e.is(t,"object")&&e.is(t.object_ids,"array")&&e.is(t.action_id,"string")&&t.actionsHelper))throw new Error("Invalid input to action handler");t&&t.actionsHelper;this._buildModalTag(t)}else{if(!(e.is(t,"object")&&e.is(t.object_ids,"array")&&e.is(t.action_id,"string")&&t.actionsHelper))throw new Error("Invalid input to action handler");t&&t.actionsHelper;this.addTag(t)}},addTag:function(t){if(!e.is(t))return;let i=this;i.okBtn=new o({className:"primary addTagBtn",value:d.get("add_tag.addButton"),disabled:!0,events:{onClick:function(){i._userTagsView.commit({hasPlatformData:!0}),i.modal.destroy()}}}),this.modal=new a({header:d.get("add_tag.add_tag_title"),className:"add_tag",closable:!0,body:"",events:{onHide:function(){i.modal.destroy()}},footer:[this.okBtn,new o({value:d.get("CancelButton"),className:"cancelTagBtn default",events:{onClick:function(){i.modal.destroy()}}})]}).inject(document.body),this.modal.setBody(this._buildaddTagForm(t)),this.modal.show()},actionOnCommit:function(){h._displayAlert({message:d.get("add_tag.add_tag_successful"),className:"success addTagAlert"})},actionOnFailure:function(){h._displayAlert({message:d.get("add_tag.add_tag_failure"),className:"failure addTagAlert"})},onSelectionChangeInView:function(e){this.okBtn&&(e>0?this.okBtn.enable():this.okBtn.disable())},getContainerId:function(t){let i;for(let n of t)if(i=n.get("ds6w:containerUid"),e.is(i))break;return i},getSubjectUriCount:function(e){return e.filter((e=>e.uri)).length},_buildaddTagForm:function(e){var t=s.create("form",{class:"formAddTag"}),i=s.create("div",{class:"divAddTag"});i.inject(t);let n=e.actionsHelper.getPlatformID({id:e.object_ids[0]}),o=[],a=e.object_ids,h=[];for(let t of a)h.push(e.collection.get(t));o=u.getTaggerSubjectURIForMultipleSources(h,n);var g=new r({subjects:o,applicativeSuggestions:[],platformId:n,readOnly:!1});let p=e.collection.search_ressources.getActiveTenant(),_=this.getContainerId(h);if(1==this.getSubjectUriCount(o)&&_){let e={appName:"3DSearch",currentUser:u.getUserId(),platformId:p,vocabSuggestions:!1,communityTags:!0,communityId:_};c.getSuggestionsFor3DSwymContent(e).then((function(e){UWA.is(e,"object")&&UWA.is(e.suggestions,"array")&&g.set("applicativeSuggestions",e.suggestions)}))}return this._userTagsView=new l({model:g,suggestsInfo:{placeHolder:d.get("add_tag.add_tag_default_text"),filterMessage:"customFilterMessage...",allowFreeText:!0,vocabSuggestions:!0},manageDirtyState:!0,onCommit:this.actionOnCommit.bind(this),onFailure:this.actionOnFailure.bind(this),onSuggestDisplayed:function(){},touchMode:!1,onSelectionChange:this.onSelectionChangeInView.bind(this)}).render().inject(i),t},_buildModalTag:function(t){if(!e.is(t))return;let i=this;i.okBtn=new o({className:"primary addTagBtn",value:d.get("add_tag.addButton"),disabled:!0,events:{onClick:function(){if("remove"===i._currentTab){require(["DS/CollectiveTagging/CollectiveTaggingHelpers"],(function(e){t._userTagsView=i._userTagsView,t._description=i._description,e.requestRemoveTag(t)}))}else i._userTagsView.commit({hasPlatformData:!0});i.modal.destroy()}}}),i.modal=new a({header:d.get("add_tag.add_tag_title"),className:"add_tag",closable:!0,body:"",events:{onHide:function(){i.modal.destroy()}},footer:[i.okBtn,new o({value:d.get("CancelButton"),className:"cancelTagBtn default",events:{onClick:function(){i.modal.destroy()}}})]}).inject(document.body),this._tabContainer=new p({displayStyle:["strip"],centeredFlag:!1,newTabButtonFlag:!1,editableFlag:!1,multiSelFlag:!1,reorderFlag:!1,touchMode:!0,closeButtonFlag:!1,showComboBoxFlag:!0,allowUnsafeHTMLOnTabButton:!1}),this._tabContainer.addEventListener("change",(function(t){if(e.is(t)&&e.is(t.dsModel)){t.stopPropagation();let n=t.dsModel;if(n&&n===i._tabContainer){let t=n.value;e.is(t,"array")&&(i._currentTab=t[0],"remove"===i._currentTab?i.okBtn.setValue(d.get("collectiveTagging.sendButton")):i.okBtn.setValue(d.get("add_tag.addButton")))}}})),this._tabContainer.add({label:d.get("collectiveTagging.addTags"),isSelected:!0,value:"add",content:this._buildaddTagTab(t)}),this._tabContainer.add({label:d.get("collectiveTagging.removeTag"),value:"remove",content:this._buildremoveTagTab(t)}),i.modal.setBody(this._tabContainer),i.modal.show()},_buildaddTagTab:function(t){if(!e.is(t))return;let i=this,n=s.create("div",{class:"collectiveAddTag"});this._buildaddTagForm(t).inject(n);let o=s.create("div",{class:"collectiveAddTagRequest"});o.inject(n);let a=s.create("span",{class:"collectiveAddTagRequest-text"});return a.setText(d.get("collectiveTagging.addrequestPanel")),a.inject(o),s.create("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-tag-add ",events:{touchstart:function(){this.isTouchable=!0},click:function(){i.modal.destroy();require(["DS/CollectiveTagging/CollectiveTaggingHelpers"],(function(e){e.displayModalAddTag(t)}))}}}).inject(o),n},_buildremoveTagTab:function(t){if(!e.is(t))return;let i=s.create("div",{class:"collectiveAddTag"}),n=s.create("div",{class:"collectiveAddTagText"});n.inject(i),this._buildaddTagForm(t).inject(n);let o=s.create("div",{class:"collectiveAddTagDescription"});o.inject(i);let a=s.create("span",{class:"collectiveAddTagText-text"});return a.setText(d.get("collectiveTagging.removeTagsDesc")),a.inject(o),this._description=new _({placeholder:d.get("collectiveTagging.removePlace"),requiredFlag:!1,nbRows:4,newLineMode:"enter"}),this._description.inject(o),i}})})),define("DS/SNResultUX/utils/GenerateLink_ActionHandler",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Events","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/SNInfraUX/SearchUtils","DS/SNResultUX/utils/SearchServices","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],(function(e,t,i,n,s,o,a,r){"use strict";return t.singleton(n,i,{executeAction:function(t){if(!(e.is(t,"object")&&e.is(t.object_ids,"array")&&e.is(t.action_id,"string")&&t.actionsHelper))throw new Error("Invalid input to action handler");if(void 0===t.model._attributes)throw new Error("No attribute found for gieven object");let i={protocol:"3DXContent",data:{items:[{identifier:t.model._attributes["ds6w:identifier_value"],source:t.model._attributes["ds6w:sourceid_value"]}]}};e.is(t.model.getPlatformID,"function")&&s.getServiceUrl({serviceName:"3DDashboard",platformId:t.model.getPlatformID(),onComplete:function(e){o.copyToClipboard(e+"#app:"+o.getSearchAppId()+"/content:X3DContentId="+encodeURIComponent(JSON.stringify(i)),(()=>{a._displayAlert({message:r.get("search.widget.share.link.to.item.ok"),className:"success",delay:4e3})}))}})}})})),define("DS/SNResultUX/utils/BroadcastchannelManager",["UWA/Class","UWA/Core","UWA/Event","DS/UIKIT/DropdownMenu","DS/UIKIT/Tooltip","DS/SNInfraUX/Logger","DS/SNResultUX/utils/SearchServices","DS/TagNavigator/TaggerNLS","css!DS/TagNavigator/TagNavigator","DS/MessageBus/MessageBus"],(function(e,t,i,n,s,o,a,r,l,c){"use strict";return e.extend(i,{init:function(){this._dropDownMenu6W=[],this._dropDownCont6W=null,this._listOfTooltip=[],this.embeddedTaggerContent=null,this.embeddedTaggerContainer=null,this.resultMgt=null,this._BroadcastChannel=null,this._dropDownCrit=null,this._parent()},setup:function(e){this._dropDownMenu6W=[],this._dropDownCont6W=null,this._listOfTooltip=[],this._dropDownCrit=null,this.embeddedTaggerContent=e&&e.embeddedTaggerContent,this.embeddedTaggerContainer=e&&e.embeddedTaggerContainer,this.embeddedTaggerContainer&&this.embeddedTaggerContainer.setStyle("display","none"),this.resultMgt=e&&e.resultMgt,this._BroadcastChannel&&this._BroadcastChannel.close(),this._BroadcastChannel&&delete this._BroadcastChannel,this._BroadcastChannel=new BroadcastChannel(e.broadcastId),this._parent(e)},destroy:function(){this._cleanUpEmbedded(),this._BroadcastChannel.close(),this._BroadcastChannel&&delete this._BroadcastChannel,this._BroadcastChannel=null,this.embeddedTaggerContent=null,this.embeddedTaggerContainer=null,this.resultMgt=null,this._dropDownCrit&&this._dropDownCrit.destroy(),this._parent()},getBroadcastchannel:function(){return this._BroadcastChannel},listenBroadcast:function(){let e=this;t.is(e._BroadcastChannel)&&(e._BroadcastChannel.onmessage=i=>{if(t.is(i)&&t.is(i.data)){o.log("DS/SNResultUX/utils/BroadcastchannelManager onmessage",i.data);const{type:n="",message:l="",viewid:c="",value:d=""}=i.data;if("refresh_view"===n){e._cleanUpEmbedded(),e.embeddedTaggerContent.insertAdjacentHTML("afterbegin",l);for(const t of e.embeddedTaggerContent.querySelectorAll(".tab-btn-cont")){let i=new s({position:"bottom",target:t,body:t.textContent+" "+r.getText("embMenu"),className:"embedded-subLabel-tooltip"});e._listOfTooltip.push(i)}let i=e.embeddedTaggerContent.querySelector(".active-predicate-list");if(t.is(i)){const n=i.getElementsByTagName("li");let s=n.length,o=0;for(;o<s;o++){let i=n[o];t.is(i)&&(i.onclick=function(t){e._clickOnTagActions(t,this)})}}let n=e.embeddedTaggerContent.querySelector("#embedded-group-tag");t.is(n)&&(n.onclick=function(t){e._BroadcastChannel.postMessage({type:"clearGrouping"})});for(const t of e.embeddedTaggerContent.querySelectorAll(".clear-active-tags"))t.onclick=function(t){let i={type:"clearRefine",message:"clearRefine"};o.log("DS/SNResultUX/utils/BroadcastchannelManager postMessage clearRefine ",i),e._BroadcastChannel.postMessage(i)};for(const i of e.embeddedTaggerContent.querySelectorAll(".embedded-root-container"))i.onclick=function(n){let s=n;if(t.is(s)&&t.is(s.currentTarget)){let t={type:"dropDownMenu",viewid:s.currentTarget.getAttribute("id")};e._dropDownCont6W=i,o.log("DS/SNResultUX/utils/BroadcastchannelManager postMessage dropDownMenu ",t),e._BroadcastChannel.postMessage(t)}}}else if("dropDownMenu"===n){let i=e._dropDownMenu6W[c];if(!t.is(i)){let n={view:c,menus:JSON.parse(l),target:e._dropDownCont6W};i=e.createDropdown(n),t.is(i)&&(e._dropDownMenu6W[c]=i,i.show())}}else if("onsearchInputkeyupFilter"===n){let i=JSON.parse(l),n=t.is(e._dropDownMenu6W[c])&&e._dropDownMenu6W[c];t.is(n)&&n.addItem(i),t.is(n)&&t.is(n.updateView,"function")&&n.updateView(),setTimeout((()=>{n.searchInput&&n.searchInput.focus()}),100),t.is(n)&&t.is(n.updatePosition,"function")&&n.updatePosition(null)}else if("showEmbeddedTaggerView"===n&&!1===a.getTaggerDisplayStatus()&&t.is(e.embeddedTaggerContainer)){e.embeddedTaggerContainer.setStyle("display","block");let i=t.extendElement(e.embeddedTaggerContainer.querySelector(".embedded-tagger-view"));t.is(i)&&i.setStyle("display","block")}else"hideEmbeddedTaggerView"===n&&e.embeddedTaggerContainer&&e.embeddedTaggerContainer.setStyle("display","none")}})},_cleanUpEmbedded:function(){let e=this,i=e._listOfTooltip.length-1;for(let t=i;t>=0;t--){let i=e._listOfTooltip[t];i&&i.destroy()}e._listOfTooltip=[];let n=Object.keys(e._dropDownMenu6W);i=n.length-1;for(let s=i;s>=0;s--){let i=e._dropDownMenu6W[n[s]];t.is(i)&&(t.is(i.hide,"function")&&i.hide(),t.is(i.removeEvents,"function")&&i.removeEvents(),t.is(i.destroy,"function")&&i.destroy())}if(e._dropDownMenu6W=[],e._dropDownCont6W=null,e.embeddedTaggerContent)for(;e.embeddedTaggerContent.firstChild;)e.embeddedTaggerContent.removeChild(e.embeddedTaggerContent.firstChild)},createDropdown:function(e){let i,s=this;if(!t.is(e))return i;let a=e.target,r=e.menus,l=e.view;var c=n.extend({init:function(e){this._parent(e)},_onKeyDown:function(e){[13,27,37,38,39,40].includes(e.which)&&this._parent(e)},resize:function(){let e=document.activeElement;var t=navigator.userAgent.toLowerCase().indexOf("android")>-1;e&&"search-input"==e.id&&t||this._parent()},_onMouseover:function(e){var i,n,s,o=t.is(Event.getElement,"function")?Event.getElement(e):t.extendElement(e.target),a=o.id;if(!o.hasClassName("item")){let e=o.getClosest("li.item");e&&(a=(o=e).id)}if(a=a||o.parentElement.id||o.parentElement.parentElement.id,n=this._getMenuFromParentItem(a),!(o.hasClassName("item-back")||n&&n._position&&n._position.contains("dropdown-menu-responsive-wrap")||(this.timeoutId&&clearTimeout(this.timeoutId),this.usingKeyboard))){if(!(s=this.template.getItem(o)))return;(s=this.getItem(s.id?s.id:s))&&this._handleItemSelection(s.elements.container)}this.options.responsiveMode&&(s=o.parentElement.classList.contains("next-icon")?o.parentElement.parentElement:o.parentElement,s=(n=this._getMenuFromItem(s.id))&&n.getItem(s.id),i=n&&n.getContent().hasClassName("responsive-menu"),s&&i&&(o.classList.contains("next-icon")||o.parentElement.classList.contains("next-icon"))&&!s.elements.container.classList.contains("selected")&&(s.elements.container.addClassName("js-not-selectable"),s.elements.container.removeClassName("js-selected")))}});i=new c({target:a,className:"tn-embedded-menu tn-"+l.replace("ds6w:","")+"-menu",multiSelect:!0,closeOnClick:!1,items:r,position:"bottom right",removeOnHide:!0,viewId:l,zindex:200,events:{onShow:function(){this.options.target.parentElement&&t.extendElement(this.options.target.parentElement).addClassName("shown");let e=this.items;for(let t=0;t<e.length;t++)e[t].elements.container.getElement(".tag-label")&&(e[t].elements.container.getElement(".tag-label").style.width="calc(100% - "+(38+e[t].elements.container.getElement(".tag-count").getDimensions().width)+"px)",e[t].elements.container.getElement(".tag-label").addClassName("add-ellipsis"));this.menus.forEach((function(e){e.elements.container.addClassName("tn-embedded-menu tn-"+l.replace("ds6w:","")+"-menu")}))},onHide:function(){this.options.target.parentElement&&t.extendElement(this.options.target.parentElement).removeClassName("shown")},onClick:function(e,i,n){let a=e.target.className;if(a.contains("fonticon-right-open")||a.contains("input-field"))return;let r={type:"onClickdropDownMenu",viewid:this.options.viewId,item:JSON.stringify(i)};o.log("DS/SNResultUX/utils/BroadcastchannelManager postMessage onClickdropDownMenu ",r),s._BroadcastChannel.postMessage(r),this.options.target.parentElement&&t.extendElement(this.options.target.parentElement).removeClassName("shown"),this.hide()}}}),i.getItem("search-field")&&this._getSearchField(i,l);return i.updateView=function(){let e=this.items;for(let t=0;t<e.length;t++)e[t].elements.container.getElement(".tag-label")&&(e[t].elements.container.getElement(".tag-label").style.width="calc(100% - "+(38+e[t].elements.container.getElement(".tag-count").getDimensions().width)+"px)",e[t].elements.container.getElement(".tag-label").addClassName("add-ellipsis"));this.menus.forEach((function(e){e.elements.container.addClassName("tn-embedded-menu tn-"+l.replace("ds6w:","")+"-menu")}))},i},_getSearchField:function(e,i){let n=this,a=t.createElement("div",{id:"search-div"}).inject(e.getItem("search-field").elements.container),l=t.createElement("div",{class:"search-input-cont"}).inject(a),c=t.createElement("input",{id:"search-input",type:"text",placeholder:r.getText("search"),class:"input-field",viewId:i}).inject(l);e.searchInput=c;let d=t.createElement("i",{class:"emb-clear-input-field fonticon fonticon-cancel-circled",viewId:i}).inject(l),u=new s({position:"bottom",target:d,body:r.getText("embClearSearch"),className:"embeddedW-embClearSearch-tooltip"});n._listOfTooltip.push(u);let h=t.createElement("div",{class:"icon-cont",html:{tag:"span",class:"fonticon fonticon-search"}}).inject(l),g=new s({position:"bottom",target:h,body:r.getText("embSearchTags"),className:"embeddedW-embSearchTags-tooltip"});n._listOfTooltip.push(g);let p=function(e){e.items.forEach(((t,i)=>{let n=t.className,s=t.id;("divider"==n||"search-field"!==s)&&e.removeItem(t.id)}));let t=e.items.length-1;for(;t>=0;t--){let i=e.items[t],n=i.className,s=i.id;("divider"==n||"search-field"!==s)&&e.removeItem(i.id)}};c.addEvent("keyup",(function(i){let s=c.value.toUpperCase(),a=l.getElement(".emb-clear-input-field"),r=l.getElement(".icon-cont");p(e),s?(a.addClassName("add-clear"),r.addClassName("hide-lens")):""==s&&(a.removeClassName("add-clear"),r.removeClassName("hide-lens")),e&&e.getItem("no-result-item")&&e.removeItem("no-result-item");let d={type:"onsearchInputkeyup",value:s,viewid:t.extendElement(this).getAttribute("viewId")};o.log("DS/SNResultUX/utils/BroadcastchannelManager postMessage onsearchInputkeyup ",d),n._BroadcastChannel.postMessage(d),c.focus()})),d.addEventListener("click",(function(i){let s=l.getElement(".emb-clear-input-field");c.value="",s&&s.removeClassName("add-clear"),h.removeClassName("hide-lens"),p(e);let a={type:"onsearchInputkeyup",value:"",viewid:t.extendElement(this).getAttribute("viewId")};o.log("DS/SNResultUX/utils/BroadcastchannelManager postMessage onsearchInputkeyup ",a),n._BroadcastChannel.postMessage(a),c.focus()}))},_clickOnTagActions:function(e,i){let s=this;if(!t.is(i))return;s._dropDownCrit&&s._dropDownCrit.destroy();let a=i,l=-1!==i.className.indexOf("isExcluded"),c=-1!==i.className.indexOf("canBeExcluded"),d=[{text:r.getText("removeTag"),name:"remove",fonticon:"trash"}];l?d.unshift({text:r.getText("unexludeTag"),name:"unexclude",fonticon:"block"}):c&&d.unshift({text:r.getText("excludeTag"),name:"exclude",fonticon:"block"});let u=n.extend({getDisplayContext:function(){let e={},t=document.documentElement;return e.viewportWidth=t.clientWidth||window.innerWidth,e.viewportHeight=t.clientHeight||window.innerHeight,e.scrollTop=window.pageYOffset||document.body.scrollTop||t.scrollTop,e}});s._dropDownCrit=new u({target:a,items:d,renderTo:document.querySelector(".onesearch_results"),events:{onClick:function(e,t){let i=a.id.split("::")[0],n=a.id.split("::")[1],r={type:"clickOnActivecriteria",message:{id:a.getAttribute("id")}},l={};"remove"===t.name?(l={tagName:i,predicate:n,condition:s.condition},r.message.name="remove"):"exclude"===t.name?(l={tagName:i,predicate:n,toExclude:!0},r.message.name="exclude"):"unexclude"===t.name&&(l={tagName:i,predicate:n,toExclude:!1},r.message.name="unexclude"),r.message.option=l,o.log("DS/SNResultUX/utils/BroadcastchannelManager postMessage clickOnActivecriteria ",r),s._BroadcastChannel.postMessage(r)}}}),this._dropDownCrit.show(),e.preventDefault(),e.stopPropagation()}})})),define("DS/SNResultUX/SearchWidget",["UWA/Class","UWA/Class/Debug","UWA/Core","DS/PubSub/PubSub","DS/SNInfraUX/SearchVersioning","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchCom","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/RefineHelper/RefineHelper","DS/SNResultUX/utils/ExternalComponentHelpers","DS/SNInfraUX/ServiceDelegationLoader","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","css!DS/SNResultUX/assets/css/_specific.css","DS/MessageBus/MessageBus","DS/SNSearchResultsCusto/utils/SearchResultsCustomizationPreferences"],(function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_,f){"use strict";var m="DS/TopFrame/TopFrame",S=e.extend(t,{widget:null,resources:null,searchcom_socket:null,pcs_uuid:null,_searchCom:null,events:{},css_view_class:"windowed",optionsInitDone:null,eventsRegistered:null,snTabManager:void 0,_widget_launch_mode:null,bAddinmode:!1,bWasFurtiveAtLoad:!1,X3DContentId:null,init:function(e){if(o.group("SearchWidget::init",e),o.log("Widget id:",e&&e.widget?e.widget.id:"undefined"),o.log("JS code level for 3dSearch:",s.getCurrentVersion()),this._widget_launch_mode="",this.eventsRegistered=!1,this.optionsInitDone=!1,this.pcs_uuid=Math.floor(1e5*Math.random()+1).toString(),this.widget=e&&e.widget?e.widget:null,this.bWasFurtiveAtLoad=!1,null===this.widget)return;let t;this._addBETACSSState(),this._updateMobileCss(),_.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"bodyWidthUpdate",callback:this._updateMobileCss.bind(this)}),this.bAddinmode=i.is(this.widget.data.addinmode,"string")&&-1!==["solidworks","catiav5"].indexOf(this.widget.data.addinmode),this.widget.data.reSearch&&this.widget.setValue("tag_filter",this.widget.data.reSearch),this.widget.setValue("tenantAware",!0);let r=a.getActiveTenant();i.is(this.widget.getValue("search_wdg_id"))&&0==this.widget.getValue("search_wdg_id").indexOf("preview")&&(t=c.getItem("securityContext"+r+a.getUserId()),t&&this.widget.setValue("securityContext",t));let l=this,d=a.identifyClientInfo()&&a.identifyClientInfo().identifier;a.isRoleAvailable(["CSV"],r,(function(e){if(e&&c.getItem("activateMSFIntegration")&&"3DDashboard"==d&&!l.bAddinmode){h.loadModuleFromService("DS/MSFDocumentManagement/WidgetIntegration",{serviceID:"3DSpace",platformID:r}).then((function(e){let t=e;t.ConnectWidgetWithMSF(l.widget),t&&t.IsConnectedToMSFClient()?console.log("Connected to MSF"):console.log(" Not Connected to MSF")}),(function(e){o.warn("Cannot load MSF "+e.requireModules)}))}})),e.events&&e.events.onSNResultWdg_Ready&&(this.events.onSNResultWdg_Ready=e.events.onSNResultWdg_Ready),e.events&&e.events.onClose&&n.add("search:closeRequested",(()=>{e.events.onClose()})),this.widget.addEvent("onLoad",this.onLoad,this),this.widget.addEvent("onResize",this.onResize,this),this.widget.addEvent("onDestroy",this.onDestroy,this),this.widget.addEvent("onViewChange",this.onViewChange,this),this.widget.addEvent("onHide",this.onHide,this),this.widget.body&&this.widget.body.setStyle("transform","translateZ(0)"),this.widget.setMetas({helpPath:"SNResultUX/assets/help"}),a.setDictionnaryEntry("useDnDForAllSearchViews",!this.widget.getValue("DnD")||0!=this.widget.getValue("DnD")&&"false"!=this.widget.getValue("DnD")),this.X3DContentId=null,e.widget&&e.widget.data&&e.widget.data.X3DContentId&&(this.X3DContentId=JSON.parse(e.widget.data.X3DContentId)),!0===this.widget.getValue("resurrectSearch")&&this.widget.setValue("transient_context","true"),this.snTabManager=null,o.groupEnd()},onDestroy:function(){o.log("onDestroy, widget id="+(this.widget?this.widget.id:"undefined"));var e=this;e.widget.removeEvent("onLoad",e.onLoad,e),e.widget.removeEvent("onResize",e.onResize,e),e.widget.removeEvent("onDestroy",e.onDestroy,e),e.widget.removeEvent("onViewChange",e.onViewChange,e),e.widget.removeEvent("onRefresh",e.onRefresh,e),e.widget.removeEvent("onSearch",e.onSearchIn,e),e.widget.removeEvent("on3DSearch",e.onSearch,e),e.widget.removeEvent("onResetSearch",e.onResetSearch,e),i.is(e.snTabManager)&&(e.widget.removeEvent("onSearchWithOpts",e.snTabManager.onSearch,e.snTabManager),e.widget.removeEvent("onViewChangeResults",e.snTabManager._onViewChange,e.snTabManager)),e.widget.removeEvent("endEdit",e.onEndEdit,e),null!==this.searchcom_socket&&(this.searchcom_socket.removeListener("onSearchFromCompassInit"),this.searchcom_socket.removeListener("setSelectedSource"),this.searchcom_socket.removeListener("onSearchWdgUpd"),this.searchcom_socket.removeListener("showAdvancedSearch"),this.searchcom_socket.removeListener("hideAdvancedSearch"),this.searchcom_socket.dispatchEvent("onResetMyRecent"),this.searchcom_socket.dispatchEvent("onDestroyWidget",{widget_id:this.widget.id},["searchtopbar_socket_id"]),"from_compass_transient"===this._widget_launch_mode&&i.is(this.searchcom_socket)&&this.searchcom_socket.dispatchEvent("closeTagger"),this.searchcom_socket.disconnect(),i.is(this._searchCom)&&(this._searchCom.deleteSocket(this.searchcom_socket.id),this._searchCom.unsubscribeServer(this.widget.id),this._searchCom.deleteServer(this.widget.id)),this.searchcom_socket=null),this.snTabManager&&(this.snTabManager.destroy(),this.snTabManager=null),this.resources=null,this.widget.setValue("tag_filter",""),this.widget=null,this.deleted=!0},_addBETACSSState:function(){a.isFUN109031Active()&&(this.widget.body&&this.widget.body.addClassName("BETA-FUN109031"),this.widget.elements&&this.widget.elements.header&&this.widget.elements.header.addClassName("BETA-FUN109031"))},_removeBETACSSState:function(){a.isFUN109031Active()&&(this.widget.body&&this.widget.body.removeClassName("BETA-FUN109031"),this.widget.elements&&this.widget.elements.header&&this.widget.elements.header.removeClassName("BETA-FUN109031"))},_updateMobileCss:function(){let e=a.getDeviceType(),t=a.getViewportOrientation();this.widget.body&&(this.widget.body.removeClassName("mobile"),this.widget.body.removeClassName("tablet"),this.widget.body.removeClassName("desktop"),this.widget.body.removeClassName("landscape"),this.widget.body.removeClassName("portrait"),this.widget.body.addClassName(e),this.widget.body.addClassName(t))},onResize:function(){var e=this;clearTimeout(e.resizeEventId),e.resizeEventId=setTimeout((function(){e.searchcom_socket&&e.searchcom_socket.dispatchEvent("widgetResize")}),100)},onHide:function(){n.dispatch("search:closeTransient",{})},endEdit:function(e){console.log("SNResultUX endEdit called");var t=this.widget.getValue("search_criteria"),n=this.widget.getValue("search_criteria_to_display");n=n||t;var s=this.widget.getValue("customization_options"),o=this.widget.getPreference("title");i.is(o)&&i.is(o.value)&&this.widget.setTitle(o.value),i.is(e,"object")&&i.is(e.submitted)&&(e=e.submitted),this.searchcom_socket.dispatchEvent("onWdgEndEdit",{}),e&&this._onSearch({searchInCurrentTab:!0,newActiveTenant:this.widget.getValue("activeTenant"),customization_options:s,searchStringToDisplayInSearchField:n,addNewTab:!0})},onLoad:function(){o.log("SNResultUX onLoad called"),o.log("Tenant options : ",c.getItem("tenantInfo"));let e,t=this;t.widget.addPreference({name:"title",type:"text",label:"Title",defaultValue:""});var n=a.getPlatformServices();i.is(n)&&n.getPlatformServices({onComplete:function(n){if(i.is(n)){var s=[];n.forEach((e=>{s.push({label:e.displayName,value:e.platformId})})),i.is(t.widget)&&i.is(t.widget.data)&&!0!==t.bAddinmode&&(e="",i.is(t.widget.data.activeTenant)&&(e=t.widget.data.activeTenant),t.widget.addPreference({name:"activeTenant",type:"list",disabled:!(s.length>1),options:s,label:"Selected Tenant",defaultValue:e}))}}}),t.widget.addPreference({name:"x3dTitleShowAppName",type:"boolean",label:g.get("search.widget.display.name"),defaultValue:!0}),this.resources=this.widget.getValue("search_ressources");let s=!1;i.is(this.resources,"object")&&i.is(this.resources.active_tenant,"string")?(e=this.resources.active_tenant,this.widget.setValue("x3dPlatformId",e)):i.is(this.resources,"string")&&this.resources.length<1&&!i.is(this.widget.getValue("search_wdg_id"))&&(s=!0),this.widget.setValue("search_ressources",null),this.resources=null,t.widget.setValue("search_wdg_id",t.widget.id),t.widget.setValue("tenantAware",!0),!i.is(e,"string")&&i.is(this.widget.getValue("activeTenant"),"string")&&(e=this.widget.getValue("activeTenant")),e&&t.widget.setValue("x3dPlatformId",e),t.widget.addEvent("onUpdateValue",(function(e,i){"activeTenant"===e&&t.widget.getValue("x3dPlatformId")!==i?t.widget.setValue("x3dPlatformId",i):"x3dPlatformId"===e&&t.widget.getValue("activeTenant")!==i&&t.widget.setValue("activeTenant",i)}));var d=null;i.is(t.widget)&&i.is(t.widget.getView,"function")&&(d=t.widget.getView());let u=this.widget.getValue("search_criteria"),h=d&&"fullscreen"===d.type&&i.is(this.widget.getValue("search_wdg_id"))&&i.is(u)&&""===u,p=!i.is(u),_=i.is(u,"string")&&!0!==this.widget.getValue("isODT")&&!0===s||i.is(t.widget.data)&&i.is(t.widget.data.launch_mode)&&"from_compass_transient"===t.widget.data.launch_mode&&i.is(t.widget.data.transient_context)&&"false"===t.widget.data.transient_context;if(h||p||_){var f;if(!0===p||!0===h?(t.widget.setValue("transient_context","true"),t._widget_launch_mode=a.widgetLaunchMode.COMPASS_TRANSIENT):!0===_&&(t._widget_launch_mode=a.widgetLaunchMode.COMPASS_PINNED),t._searchCom=l,t.searchcom_socket=l.createSocket({socket_id:"widget_socket_"+t.widget.id,widgetId:t.widget.id}),console.log("SNResultUX adding onSearchFromCompassInit event listner"),t.searchcom_socket.addListener("onSearchFromCompassInit",(function(e){console.log("SNResultUX onSearchFromCompassInit event received"),!1===t.optionsInitDone?(o.log("init to do for 3DSearch from compass..."),t.widget.setValue("activeTenant",e.ressources.active_tenant),t.widget.setValue("x3dPlatformId",e.ressources.active_tenant),t.optionsInitDone=!0,t.afterResourcesInit()):o.log("init DONE for 3DSearch from compass...")})),i.is(t.widget)&&i.is(t.widget.getValue("source"))){var m=t.widget.getValue("source");i.is(m)&&m.length&&"swym"===m[0]&&t.widget.context&&(f=t.widget.context)}Promise.all([a.autocompleteRendered(),a.searchUXTopbarSocketInitialized()]).then((function(){console.log("searchUXTopbarSocketInitialized and autocompleteRendered"),t.searchcom_socket.dispatchEvent("onWdgCreation",{widget_id:t.widget.id,tabid:f,transient_widget:!1},["searchtopbar_socket_id"]),t.searchcom_socket.dispatchEvent("onSearchFromCompass",{widget_id:t.widget.id,x3dPlatformId:t.widget.data.x3dPlatformId,mode:p?"maximized":"windowed"},["searchtopbar_socket_id"])}))}else{if(t._widget_launch_mode=a.widgetLaunchMode.TOPBAR_SEARCH,i.is(t.widget)){var S=t.widget.getValue("customization_options");"3DSwym"===a.identifyClientInfo().identifier?t._widget_launch_mode=a.widgetLaunchMode.TOPBAR_SEARCH:i.is(S,"object")&&(i.is(S.app_socket_id,"string")||i.is(S.precond,"string"))?t._widget_launch_mode=a.widgetLaunchMode.INCONTEXT_TRANSIENT:i.is(t.widget.context)&&"transient"!==t.widget.context&&(t._widget_launch_mode=a.widgetLaunchMode.PINNED)}t.optionsInitDone=!0,t.afterResourcesInit()}r.getOption("isx2a")&&require(["DS/PlatformAPI/PlatformAPI"],(function(e){t.log("XApp running in Native Client,Start subscribing to A2X3DSearchEvent"),e.subscribe("A2X3DSearchEvent",(e=>{t.log("Handling A2X Event:-",e),"3DSearch"===e.category&&t.onSearch({value:e.queryString,internalSearchCriteria:t.widget.getValue("search_criteria"),searchStringToDisplayInSearchField:e.queryString,searchType:"#search"})}))}))},afterResourcesInit:function(){var e=this,t=this.widget.getValue("settings_topbar"),s=!1;if("string"==typeof t&&t.length)try{t=JSON.parse(t)}catch(e){o.log("Cannot parse Topbar Settings from the preferences: "+e.toString())}else s=!0;require(["DS/SNInfraUX/SearchRessources","DS/SNResultUX/SNTabbedResultMgt"],(function(c,d){if(i.is(t)&&i.is(t.search_settings)&&(i.is(t.search_settings.topframe_search_delegation)&&delete t.search_settings.topframe_search_delegation,e._widget_launch_mode===a.widgetLaunchMode.PINNED&&(i.is(t.search_settings)&&delete t.search_settings,i.is(t.url_search_settings)&&delete t.url_search_settings,i.is(t["3dSearch_datagrid"])&&delete t["3dSearch_datagrid"],i.is(t.NLSMapping_3DSearch_Sorting_TACTICALOnly)&&delete t.NLSMapping_3DSearch_Sorting_TACTICALOnly,i.is(t.NLSMapping_3DSearch_Suggest_TACTICALOnly)&&delete t.NLSMapping_3DSearch_Suggest_TACTICALOnly,i.is(t.date_display_mode_array)&&delete t.date_display_mode_array,i.is(t.relevant_tags)&&delete t.relevant_tags,i.is(t.show_search_results_revision_array)&&delete t.show_search_results_revision_array,i.is(t.snippet_unsupported_sources)&&delete t.snippet_unsupported_sources,i.is(t.type_custo)&&delete t.type_custo,i.is(t.vocabToExtend_swym)&&delete t.vocabToExtend_swym)),r.initialize(t),e._widget_launch_mode===a.widgetLaunchMode.PINNED&&(!0===a.isInTheSimpleSearch()?r.changeSettingForBETA():r.changeSettingForFD01(),e._isAmMaximized())){var h=e.widget.getValue("originalSearchCriteria");n.dispatch("search:refreshSearchField",{searchStringToDisplayInSearchField:e.widget.getValue("search_criteria_to_display"),internalSearchCriteria:e.widget.getValue("search_criteria"),originalSearchCriteria:h}),h===a.SearchTypeEnum.ADVANCED_SEARCH&&n.dispatch("search:advancedSearchEdit",{tag_filter:e.widget.getValue("tag_filter")})}var p=!0;if(i.is(e.widget)&&i.is(e.widget.getValue,"function")?p=e.widget.getValue("transient_context"):o.warn("Unable to get widget and so using transient_context = true by default..."),!0!==e.deleted){var _;if(e._searchCom=l,i.is(e.searchcom_socket)||(e.searchcom_socket=l.createSocket({socket_id:"widget_socket_"+e.widget.id,widgetId:e.widget.id})),e.searchcom_socket.addListener("setSelectedSource",(function(t){(!0===p||i.is(e.widget._view)&&i.is(e.widget._view)&&i.is(e.widget._view.type)&&("maximized"===e.widget._view.type||"sidepanel"===e.widget._view.type))&&i.is(t)&&i.is(t.value)&&"3DDashboard"!==t.value&&(e.widget.setValue("activeTenant",t.value),e.widget.setValue("x3dPlatformId",t.value),t.update_tab=!1,i.is(e.snTabManager)&&e.snTabManager.setActiveTenant(t))})),e.searchcom_socket.addListener("onSearchWdgUpd",(function(t){if(i.is(t,"object")&&i.is(t.refine)&&(t.tag_filter=t.refine,t.refresh=!1),"true"===p||e._isAmMaximized(t.active_tab)||"fullscreen"===e._getWidgetState()){t.value===a.SearchTypeEnum.FAVORITE_SEARCH&&(t.savedSearch=!0,t.searchStringToDisplayInSearchField=g.get("my_fav_searches"),t.resetLocalFilter=!0,t.queryType=a.SearchTypeEnum.FAVORITE_SEARCH);var n=!0;if(i.is(e.snTabManager)&&i.is(t.searchType)&&"#advancedSearch"===t.searchType&&i.is(t.adv_search_field)&&0!==t.adv_search_field.length){var s=e.snTabManager.getActiveAdvSearchMgr();i.is(s)&&!1===r.options.search_settings.taggerClosed&&(n=!1)}if(!0===n){var l="SearchComServer_"+e.widget.id;if(i.is(arguments))if(arguments.length>0&&i.is(arguments[1])&&i.is(arguments[1].origin)&&i.is(arguments[1].origin.server))-1===e.widget.id.indexOf("preview")&&-1===e.widget.id.indexOf("odt")||(l="SearchComServer"),"3DSwym"===a.identifyClientInfo().identifier&&(l="SearchComServer"),n=!1,l===arguments[1].origin.server&&(n=!0)}if(!0===n)if(i.is(e.snTabManager)&&!0===e.snTabManager.navhistorycontextifcreateaNewTab())t.removeHistory=!0,i.is(t.searchType)&&"#advancedSearch"===t.searchType?(e.widget.dispatchEvent("on3DSearch",t),e.bAddinmode&&require(["DS/TransientWidget/TransientWidget"],(function(e){e.showWidget(a.getSearchAppId(),"",{},{mode:"transient"})}))):u.modal({title:g.get("relation.NewSearch.warningTitle"),content:g.get("relation.NewSearch.warning"),CB:[{buttonKind:"ok",function:()=>{e.widget.dispatchEvent("on3DSearch",t),e.bAddinmode&&require(["DS/TransientWidget/TransientWidget"],(function(e){e.showWidget(a.getSearchAppId(),"",{},{mode:"transient"})})),u.destroyModal()}},{buttonKind:"cancel"}]});else{var c=function(){o.log("SNResultUX fireSearch"),e.widget.dispatchEvent("on3DSearch",t),e.bAddinmode&&require(["DS/TransientWidget/TransientWidget"],(function(e){e.showWidget(a.getSearchAppId(),"",{},{mode:"transient"})}))};e.snTabManager.getActiveTab()&&t.active_tenant===e.snTabManager.getActiveTab().getActiveTenant()?c():(!e.snTabManager.isTabBarVisible()&&e.snTabManager.getActiveTab()&&e.snTabManager.removeTab(e.snTabManager.getActiveTab().getTabID()),o.log("Adding new Tab with onReady event"),e.snTabManager.addTab({search_ux_options:{events:{onReady:c}}}))}}})),e.searchcom_socket.addListener("showAdvancedSearch",(function(t){if(i.is(e.snTabManager)){var n=e.snTabManager.getActiveTab();i.is(n)&&n.showAdvancedSearch(t)}})),e.searchcom_socket.addListener("hideAdvancedSearch",(function(){if(i.is(e.snTabManager)){var t=e.snTabManager.getActiveTab();i.is(t)&&t.hideAdvancedSearch()}})),i.is(e.widget)&&i.is(e.widget.getValue("source"))){var f=e.widget.getValue("source");i.is(f,"array")&&f.length&&"swym"===f[0]&&e.widget.context&&(_=e.widget.context)}if(e.searchcom_socket.dispatchEvent("onWdgCreation",{widget_id:e.widget.id,tabid:_,transient_widget:p},["searchtopbar_socket_id"]),!s&&e.widget){var m=e.widget.getValue("customization_options");i.is(m,"object")&&!1===m.default_with_precond&&e.searchcom_socket.dispatchEvent("onSetFocusInSearchField",{},["searchtopbar_socket_id"])}if(i.is(e.widget)&&i.is(e.widget.setValue,"function")){e.widget.setValue("appId",a.getSearchAppId()),e.widget.setValue("stayOnSearch","true"),e.widget.setValue("transient_context","false"),e.widget.setValue("search_wdg_id",e.widget.id),("true"===p||!0===p)&&(e.css_view_class="maximized");try{let t=e.resources;i.is(t,"object")||(t={active_tenant:e.widget.getValue("x3dPlatformId")}),!i.is(e.searchResources)&&(e.searchResources=new c(t))}catch(e){o.log("SearchRessources not initialized!")}var S=e.widget.getValue("customization_options");if(i.is(S)&&i.is(S.mode)){var v=i.clone(S);"furtive"===v.mode&&e._updateWidgetPreferences("bDisableResurrect",!0),delete v.mode,e.widget.setValue("customization_options",v)}var w=e._getOriginalSearchOpts(),b="false"===p||!1===p,C={};if(e._widget_launch_mode===a.widgetLaunchMode.PINNED)b&&(C=e._getSearchOpts());else{var y=i.is(w);C=b&&y?w:e._getSearchOpts()}e.widget.setValue("launch_mode",e._widget_launch_mode),C.fromTopbar=!0;var D={search_options:C,result_ux_customization:e.widget.getValue("result_ux_customization"),viewData:e.widget.getValue("viewData"),powerByOptions:e.widget.getValue("powerByOptions"),in_apps_search:S,searchWidget:e,events:{onReady:function(){e._tabOnReady()},onPreviewModeRequest:function(){e._tabOnPreviewModeRequest()},onExitPreviewMode:function(){e._tabOnExitPreviewMode()}},isResurrectSearch:!0===e.widget.getValue("resurrectSearch"),default6WGroupingView:e.widget.getValue("searchViewMode_6W")};if(!i.is(e.snTabManager)){let t=e.resources;i.is(t,"object")||(t={active_tenant:e.widget.getValue("x3dPlatformId")});var I={widget_id:e.widget.id,launch_mode:e._widget_launch_mode,resources:t,itemViewClickHandler:e.widget.getValue("itemViewClickHandler"),source:e.widget.getValue("source"),addinMode:e.widget.data.addinmode,updateTitle:function(t){i.is(e.widget)&&e.widget.setTitle(t)},transient_context:p,use_preexisting_call:e.widget.getValue("use_preexisting_call"),update_preference:function(t,i){e._updateWidgetPreferences(t,i)},get_preference:function(t){return e.getWidgetPreferences(t)},resetOriginalOptions:function(t){e._resetOriginalSearchOpts(t)},css_view_class:e.css_view_class,search_widget:this};i.is(e.widget)&&i.is(e.widget.metas)&&i.is(e.widget.metas.description,"string")&&e.widget.metas.description.contains("3DSwym")&&(I.swymContext=!0),i.is(e.widget.getValue("tagger_context_id"))&&(I.tagger_context_id=e.widget.getValue("tagger_context_id")),i.is(e.widget.getValue("pinToDashboard"))&&(I.pinToDashboard=e.widget.getValue("pinToDashboard")),e.snTabManager=new d(I),e.widget.setBody(e.snTabManager)}o.log("Adding new Tab"),e.snTabManager.addTab({search_ux_options:D}),null!==e.X3DContentId&&setTimeout((function(){e.searchcom_socket.dispatchEvent("search",{value:'[ds6w:identifier]:"'+(e.X3DContentId.data&&e.X3DContentId.data.items.length>0&&e.X3DContentId.data.items[0].identifier||"")+'"'})}),1e3)}else o.warn("No widget, exiting from method")}else o.log("deleted widget -> exit")}))},initWidgetVisiblePreferences:function(e,t){if(i.is(e)){var n=[];e.forEach((e=>{n.push({name:e.displayName,id:e.platformId})})),i.is(this.widget)&&i.is(this.widget.data)&&(activeTenant="",i.is(this.widget.data.activeTenant)&&(activeTenant=this.widget.data.activeTenant),this.widget.addPreference({name:"activeTenant",type:"list",options:n,label:"Selected Tenant",defaultValue:activeTenant}))}},_tabOnReady:function(){var e=this;if(i.is(e.widget)&&i.is(e.widget._view)&&"maximized"===e.widget._view.type&&!1===r.options.search_settings.taggerClosed){var t=r.getOption("search_compact_mode");i.is(t)||(t=!1),i.is(window)&&i.is(window.innerWidth)&&!(window.innerWidth>958)||!0===e.bAddinmode||-1!==["iphone","ipad","android"].indexOf(a.getDeviceCategory())||!1!==t||!0===r.options.search_settings.taggerClosed||!0!==r.getOption("no_TopFrame_ODT")&&require([m],(function(t){var n=!1;if(i.is(t))try{i.is(t.isTaggerVisible,"function")&&!0===t.isTaggerVisible()&&(n=!0)}catch(e){i.is(t._isTaggerVisible)&&!0===t._isTaggerVisible&&(n=!0),o.log(e)}!1===n&&(e.searchcom_socket.dispatchEvent("openTagger"),a.setTaggerOpenedByCode(!0))}))}!1===e.eventsRegistered&&(e.eventsRegistered=!0,e.widget.addEvent("onRefresh",e.onRefresh,e),e.widget.addEvent("onSearch",e.onSearchIn,e),e.widget.addEvent("on3DSearch",e.onSearch,e),e.widget.addEvent("onResetSearch",e.onResetSearch,e),e.widget.addEvent("onSearchWithOpts",e.snTabManager.onSearch,e.snTabManager),e.widget.addEvent("onViewChangeResults",e.snTabManager._onViewChange,e.snTabManager),e.widget.addEvent("endEdit",e.endEdit,e),i.is(e.events.onSNResultWdg_Ready,"function")&&e.events.onSNResultWdg_Ready.call(null))},_tabOnPreviewModeRequest:function(){var e=this;e.widget.setValue("previewMode",!0),e._previewMode=!0,e._bWidgetMaximizedForPreview=!1;var t=0===e.widget.id.indexOf("preview");e._previousWidgetViewType=i.is(e.widget.getView,"function")&&i.is(e.widget.getView(),"object")?e.widget.getView().type:"none",t||"3DSwym"===a.identifyClientInfo().identifier?"sidepanel"===e._previousWidgetViewType&&require([m],(function(t){if(!t._frame.isPanelFitted("right")){e._bWidgetMaximizedForPreview=!0;var i={fit:!0,appId:a.getSearchAppId()};t.openPanel("right",i).then((function(){t._onRightPanelStateChange("fitted")}))}})):"fullscreen"!==e._previousWidgetViewType&&e.widget.dispatchEvent("onViewRequest",{type:"fullscreen"})},_tabOnExitPreviewMode:function(){let e=this;e.widget.setValue("previewMode",!1),e._previewMode=!1,e.widget.requestView({type:e._previousWidgetViewType}),"sidepanel"===e._previousWidgetViewType&&e._bWidgetMaximizedForPreview&&require([m],(function(e){i.is(e)&&i.is(e._frame)&&i.is(e._frame.openPanel,"function")&&e._frame.openPanel("right").then((function(){}))}))},onSearchIn:function(e){this.onSearch({value:e,searchInCriteria:e,search_criteria_to_display:e,searchInCurrentTab:!0,searchType:"#searchIn"})},onSearch:function(e){if(!i.is(e))throw new Error("Invalid arg in SNResultUX.onSearch!)");if(!i.is(this.snTabManager)||!i.is(this.snTabManager.getOption,"function")||"false"!==this.snTabManager.getOption("transient_context")&&!1!==this.snTabManager.getOption("transient_context")||this._getOriginalSearchOpts()||this._setOriginalSearchOpts(this._getSearchOpts()),i.is(e,"object"))this._onSearch(e);else{var t=this;require(["DS/SNInfraUX/PredefinedQueries","DS/SNInfraUX/utils/WildcardMgr"],(function(i,n){a.getsearchType()!==a.SearchTypeEnum.SEARCH_IN&&a.getsearchType()!==a.SearchTypeEnum.SEARCH||a.executeWithPQ({wait:function(){if(e&&e.indexOf(":")>0)return i.fetchPQsFromServer(t.searchResources),!0},run:function(){var i=n.manageWildcardAddtion(e);i=a.replacePQsWithCVPrefixes(i),t._onSearch({value:i,searchStringToDisplayInSearchField:e,searchInCriteria:i,searchInCurrentTab:!0})}})}))}},_updateWidgetPreferences:function(e,t){let n=null,s=i.clone(this.widget.data),o=["what","where","who","when","why","how"];const r=(this._widget_launch_mode===a.widgetLaunchMode.PINNED||this._widget_launch_mode===a.widgetLaunchMode.COMPASS_PINNED)&&this._isAmMaximized();if(r&&(n=this._getOriginalSearchOpts()),i.is(e,"object"))for(var l in e)"searchViewMode"===l&&o.includes(e[l])&&(l="searchViewMode_6W"),this.widget.setValue(l,e[l]),n&&i.is(n[l])&&(n[l]=e[l]),s[l]=e[l];else i.is(e,"string")&&("searchViewMode"===e&&o.includes(t)&&(e="searchViewMode_6W"),this.widget.setValue(e,t),n&&i.is(n[e])&&(n[e]=t),s[e]=t);(i.is(e,"object")||i.is(e,"string"))&&_.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"onSearchWidgetUpdatePreferences",data:{data:s}}),r&&!i.is(e.searchInCurrentTab)&&this._setOriginalSearchOpts(n)},getWidgetPreferences:function(e){let t;if(i.is(e,"object"))for(var n in t={},e)t[n]=this.widget.getValue(n);else i.is(e,"string")&&(t=this.widget.getValue(e));return t},_resetOriginalSearchOpts:function(e){let t=this._getOriginalSearchOpts(),n=this;e.map((e=>i.is(t[e])&&n.widget.setValue(e,t[e])))},_onSearch:function(e){if(!i.is(e,"object"))throw new Error("Invalid arg, expects an object!");let t;i.is(e.searchInCurrentTab,"boolean")&&!0===e.searchInCurrentTab?t={searchInCurrentTab:!0,search_criteria_to_display:e.searchStringToDisplayInSearchField}:(t={search_criteria:e.value,search_criteria_to_display:e.searchStringToDisplayInSearchField,adv_search:e.adv_search,searchInCurrentTab:e.searchInCurrentTab,advanced_criteria:e.advanced_criteria,adv_search_field:e.adv_search_field,tag_filter:e.tag_filter?e.tag_filter:null,search_myContent:e.search_myContent?e.search_myContent:"",recent_filter:i.is(e.sFilter)?e.sFilter:"*",queryType:i.is(e.queryType)?e.queryType:null,originalSearchCriteria:null},i.is(e.inCtx_widget_id,"string")&&(t.bDisableResurrect=!0)),i.is(e.source)&&(t.source=e.source),this._updateWidgetPreferences(t);var n=!1;if(i.is(this.snTabManager)){var s=this.snTabManager.getActiveTaggerProxy(),o=null;i.is(s)&&(o=s.getCurrentFilter());var a=null;i.is(o)&&(a=o.allfilters),i.is(o)&&i.is(a)&&(d.isSimplifiedTaggerFilters(a)?n=!d.isEmpty(a):0!==Object.keys(a).length&&(n=!0))}if(!e.adv_search||!n){var r={};i.is(e)&&(r=i.clone(e)),r.refresh=!i.is(e.refresh)||e.refresh;var l=this._getSearchOpts(r);i.is(e.newActiveTenant)&&(l.newActiveTenant=e.newActiveTenant),e.customization_options&&(l.in_apps_search=e.customization_options),e.savedSearch&&(l.savedSearch=e.savedSearch),e.isTitleOnly&&(l.isTitleOnly=e.isTitleOnly),this.widget.dispatchEvent("onSearchWithOpts",l)}this.widget.setValue("viewData",e.viewData)},onResetSearch:function(){let e=this._getOriginalSearchOpts();i.is(e)&&this.widget.dispatchEvent("onSearchWithOpts",e)},onRefresh:function(){this.snTabManager&&this.snTabManager.onRefresh()},onEndEdit:function(){console.log("SNResultUX onEndEdit called"),i.is(this.snTabManager)&&this.snTabManager.hideTabBar(),this.onLoad()},onViewChange:function(e){if("fullscreen"===e.type||"maximized"===e.type){var t=this.widget.getValue("originalSearchCriteria");if("maximized"===e.type&&this._widget_launch_mode===a.widgetLaunchMode.PINNED&&n.dispatch("search:refreshSearchField",{searchStringToDisplayInSearchField:this.widget.getValue("search_criteria_to_display"),internalSearchCriteria:this.widget.getValue("search_criteria"),originalSearchCriteria:t}),e.height&&!0!==this._previewMode&&this._setBodyHeight(e.height),i.is(this.snTabManager)){var s=this.snTabManager.getActiveTaggerProxy();i.is(s)&&i.is(s.getDisplayStatus,"function")&&!1===s.getDisplayStatus()&&!0!==this._previewMode&&(i.is(a)&&a.setTaggerOpenedByCode(!0),!0!==this._previewMode&&!0!==r.getOption("search_compact_mode")&&this.searchcom_socket.dispatchEvent("openTagger"))}}else this._setBodyHeight("100%"),i.is(a)&&i.is(a.isTaggerOpenedByCode,"function")&&!0===a.isTaggerOpenedByCode()&&(this.searchcom_socket.dispatchEvent("closeTagger"),a.setTaggerOpenedByCode(!1)),n.dispatch("search:refreshSearchField",{searchStringToDisplayInSearchField:"",internalSearchCriteria:"",originalSearchCriteria:""});null!==this.searchcom_socket&&this.searchcom_socket.dispatchEvent("onViewChange",{widget_id:this.widget.id},["searchtopbar_socket_id"]),this.css_view_class=e.type,this.widget.dispatchEvent("onViewChangeResults",e)},_getSearchOpts:function(e){var t=!1,n=!1;i.is(this.widget.getValue("advanced_criteria"))&&this.widget.getValue("advanced_criteria").length>0&&(t=!0),i.is(this.widget.getValue("search_criteria"))&&"#advancedSearch"===this.widget.getValue("search_criteria")&&(n=!0);var s=this.widget.getValue("tag_filter");"string"==typeof s&&s.length>0&&(s=JSON.parse(s));var o=this._getOriginalSearchOpts();i.is(e)&&"#search"===e.searchType&&i.is(o)&&(o.search_criteria=null);var r=null;return(!n||n&&!t)&&(r={search_criteria:this.widget.getValue("search_criteria"),adv_search:this.widget.getValue("adv_search"),search_criteria_to_display:i.is(e)&&i.is(e.search_criteria_to_display)?e.search_criteria_to_display:this.widget.getValue("search_criteria_to_display"),advanced_criteria:n?void 0:this.widget.getValue("advanced_criteria"),recent_filter:this.widget.getValue("recent_filter"),source:n?this.widget.getValue("source"):i.is(e)&&i.is(e.source,"array")?e.source:[],search_mode:"index",tag_filter:s,refresh:!!i.is(e)&&e.refresh,reSearch:i.is(e)?e.reSearch:null,widget_search_criteria:o&&!n?o.search_criteria:void 0,order_by:this.widget.getValue("order_by"),order_field:this.widget.getValue("order_field"),searchInCriteria:i.is(e)?e.searchInCriteria:null,resetLocalFilter:i.is(e)?e.resetLocalFilter:null,queryType:i.is(e)?e.queryType:null,removeHistory:!!i.is(e)&&e.removeHistory,addNewTab:!!i.is(e)&&e.addNewTab,viewData:i.is(e)?e.viewData:null,search_criteria_input_string:i.is(e)?e.inputSearchString:this.widget.getValue("inputSearchString")}),!0===this.widget.getValue("adv_search")&&i.is(r)&&(r.originalSearchCriteria=a.SearchTypeEnum.ADVANCED_SEARCH,r.search_criteria_to_display=r.search_criteria_to_display?r.search_criteria_to_display:g.get("search.advancedSearch")),i.is(e)&&e.searchType===a.SearchTypeEnum.MY_CONTENT&&(r.search_criteria_to_display=r.search_criteria_to_display?r.search_criteria_to_display:g.get("search.myContent")),r&&""===r.search_criteria&&""!==r.recent_filter&&!1===r.adv_search&&"index"===r.search_mode&&(r.search_criteria="("+r.recent_filter+")"),e&&e.searchInCurrentTab&&!0===e.searchInCurrentTab&&(r.searchInCurrentTab=!0,r.search_criteria_to_display=null),r},_getOriginalSearchOpts:function(){let e=this.widget.getValue("original_search_options"),t=null;return i.is(e)&&(t={search_criteria:e.search_criteria,adv_search:e.adv_search,search_criteria_to_display:e.search_criteria_to_display,advanced_criteria:e.advanced_criteria,search_mode:e.search_mode,tag_filter:e.tag_filter}),t},_setOriginalSearchOpts:function(e){this.widget.setValue("original_search_options",e)},_setBodyHeight:function(e){i.is(e)&&(isNaN(e)||(e+="px"),this.widget.body.setStyle("height",e))},_isAmMaximized:function(e){if(i.is(this.widget)){var t=!1;return"maximized"===this.widget.getView().type&&(t=!0),i.is(e)&&i.is(this.widget.context)&&"transient"!==this.widget.context&&(t=!1,e===this.widget.context&&(t=!0)),t}},_getWidgetState:function(){if(!i.is(this.widget))return;let e=this.widget.getView();return i.is(e.type)?e.type:void 0}});return S})),define("DS/SNResultUX/views/WebUX/Tree/TreeListView",["DS/Tree/TreeListView","DS/SNResultUX/views/WebUX/Tree/TreeNodeView"],(function(e,t){"use strict";return e.extend({defaultOptions:{cellClass:t}})})),define("DS/SNResultUX/utils/SearchViewOptions",["UWA/Core","UWA/Class/Debug","UWA/Class","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/SNResultUX/utils/ResultUX_customization","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/SearchPreferences","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/SNResultUX/utils/ResultsUtils"],(function(e,t,i,n,s,o,a,r,l,c,d){"use strict";var u=null,h=null;return i.singleton(t,{tmp_idx:0,_viewData:null,_domAttachedEvent:[],init:function(){this._adminCusto=o.getAdminCustoDefinition(),this._domAttachedEvent=[],this.setDebugMode(s.options.search_settings.debug_mode),this.resetDefaultHeaders()},resetDefaultHeaders:function(){u=[{dataIndex:"ds6w:label",isSortable:!0,text:r.getNLSValueForPredicate("ds6w:what/ds6w:label"),type:"alpha",minWidth:40},{dataIndex:"ds6w:type",isSortable:!0,text:r.getNLSValueForPredicate("ds6w:type"),type:"type",minWidth:40},{dataIndex:"ds6w:description",isSortable:!0,type:"alpha",text:r.getNLSValueForPredicate("ds6w:what/ds6w:description"),minWidth:40},{dataIndex:"ds6w:identifier",isSortable:!0,text:r.getNLSValueForPredicate("ds6w:what/ds6w:identifier"),minWidth:40},{dataIndex:"ds6w:modified",isSortable:!0,text:r.getNLSValueForPredicate("ds6w:modified"),type:"num",minWidth:40},{dataIndex:"ds6w:created",isSortable:!0,text:r.getNLSValueForPredicate("ds6w:created"),type:"num",minWidth:40}],o.isRoleAvailable(["CSV"],this._activeTenant,(function(e){!0===e&&(u.push({dataIndex:"ds6wg:revision",isSortable:!0,text:r.getNLSValueForPredicate("ds6wg:revision"),minWidth:40}),u.push({dataIndex:"ds6w:status",isSortable:!0,text:r.getNLSValueForPredicate("ds6w:status"),minWidth:40}))})),u.push({dataIndex:"ds6w:responsible",isSortable:!0,text:r.getNLSValueForPredicate("ds6w:responsible"),minWidth:40});let t=s.getOption("search_datagrid");if(null!==t)for(let i in u)e.is(u[i])&&e.is(u[i].dataIndex)&&(e.is(t.default_columns_size[u[i].dataIndex])?u[i].width=t.default_columns_size[u[i].dataIndex]:u[i].width=t.default_columns_size.default)},setContextOptions:function(t){h=e.clone(t)},getContextOptions:function(){return h},getItemViewOptions:function(e){return{mapping:this._getMapping(),resources:e}},getDataGridViewHeaders:function(t,i){if(this._specificLoadPredicateNLS(i),this.resetDefaultHeaders(),!(e.is(this._adminCusto)&&e.is(this._adminCusto.SearchColumnCustoAdminDefinition,"array")&&this._adminCusto.SearchColumnCustoAdminDefinition.length>0)){let i=s.getOption("column_custo",{tenant:t});e.is(i)&&e.is(i.searchColumnCustoInputs,"object")&&(this._adminCusto=i.searchColumnCustoInputs)}var l=[],c=null,d=null,g=null,p=null,_=null;if(e.is(h)){if(d=h.columns,!e.is(d))return u;if(d.length<=0||1===d.length&&""===d[0])return u;for(g=0;g<d.length;g++)p=d[g],l.push({dataIndex:p,isSortable:!0,minWidth:40,text:r.getNLSValueForPredicate(p)})}else if(!a.getDataGridViewColumns()||e.is(this._adminCusto,"object")&&e.is(this._adminCusto.CustoAliasDefinitions,"array"))if(e.is(this._adminCusto,"object")&&e.is(this._adminCusto.CustoAliasDefinitions,"array")){d=[];var f=this._adminCusto.CustoAliasDefinitions;for(g=0;g<f.length;g++)if(e.is(f[g].aliasId,"string")&&"The_Default_Columns"===f[g].aliasId){d=f[g].viewDefinition;break}if(d.length>0){for(g=0;g<d.length;g++)p=d[g],_=r.getNLSValueForPredicate(p.uri),l.push({dataIndex:p.uri,isSortable:!0,minWidth:40,text:_,width:p.width});var m=[];if(e.is(this._adminCusto,"object")&&e.is(this._adminCusto.CustoAliasDefinitions,"array"))for(g=0;g<f.length;g++)if(e.is(f[g].aliasId,"string")){let t=f[g].viewDefinition;for(let i=0;i<t.length;i++)e.is(t[i].dataType)&&-1===m.indexOf(t[i].dataType)&&m.push(t[i].dataType)}m.length>0&&r._asyncCallToPredicatesWS(m).then((function(t){for(let i=0;i<d.length;i++){if(p=d[i],_=r.getNLSValueForPredicate(p.uri),e.is(p.dataType)&&(_.startsWith("ds6wg")||_.startsWith("ds6w"))&&e.is(t.classPredicates))for(let e=0;e<t.classPredicates.length;e++)for(let i=0;i<t.classPredicates[e].vocabularyPredicateInfo.length;i++)if(t.classPredicates[e].vocabularyPredicateInfo[i].uri===p.uri){_=t.classPredicates[e].vocabularyPredicateInfo[i].nlsName;break}l.push({dataIndex:p.uri,isSortable:!0,minWidth:40,text:_,width:p.width})}}),(function(){n.log("promisePredicate fail !")}))}else c=u}else c=u;else for(d=a.getDataGridViewColumns(),g=0;g<d.length;g++)p=d[g],_=r.getNLSValueForPredicate(p),l.push({dataIndex:o.getURIToUse(p),isSortable:!0,minWidth:40,text:_});return e.is(c)||(c=s.getOption("enableDataGridView")?this.initColumnsDataGrid({columns:l},{}).columns:this.getCustoCellRequest(l),!e.is(c)&&c.length<1&&(c=u)),e.is(i,"function")&&i(c),c},getDataGridViewHeadersForInApps:function(t){this._specificLoadPredicateNLS(t);var i="ds6w";r.isLoaded(i)||e.is(t,"function")&&r.loadVocabulary(i,t);var n=[],s=null;if(e.is(h)){var o=h.columns;if(!e.is(o))return u;if(o.length<=0||1===o.length&&""===o[0])return u;for(var a=0;a<o.length;a++){var l=o[a];n.push({dataIndex:l,isSortable:!0,minWidth:40,text:r.getNLSValueForPredicate(l)})}}else s=null;return e.is(s)||(s=this.getCustoCellRequest(n)),e.is(t,"function")&&t(s),s},_specificLoadPredicateNLS:function(t){!r.isLoaded("ds6w")&&e.is(t,"function")&&r.loadVocabulary("ds6w",t)},getCustoCellRequest:function(t){if(s.getOption("enableDataGridView"))return t;if(!e.is(t,"array"))throw new Error("E_INVALIDARG: bad columns given to getCustoCellRequest method !");for(var i=-1,n=0;n<t.length&&-1===i;n++)"ds6w:label"===t[n].dataIndex&&(i=n);return-1!==i&&(t[i].onCellRequest=function(e){if(e.nodeModel instanceof Object){var t=void 0!==e.nodeModel.options.grid.type_icon_url?e.nodeModel.options.grid.type_icon_url:void 0!==e.nodeModel.options.grid.type_icon_url_value?e.nodeModel.options.grid.type_icon_url_value:null,i=void 0!==e.nodeModel.options.grid["ds6w:label"]?e.nodeModel.options.grid["ds6w:label"]:void 0!==e.nodeModel.options.grid["ds6w:label_value"]?e.nodeModel.options.grid["ds6w:label_value"]:void 0!==e.nodeModel.options.grid["ds6w:identifier"]?e.nodeModel.options.grid["ds6w:identifier"]:void 0!==e.nodeModel.options.grid["ds6w:identifier_value"]?e.nodeModel.options.grid["ds6w:identifier_value"]:null;e.cellView.getContent().innerHTML=(null!==t?'<img class="type-icon-datagrid" src="'+t+'" draggable="false"/>':"")+(null!==i?i:"...")}}),t},initColumnsTreeList:function(t,i){if(!e.is(t,"object"))throw new Error("E_INVALIDARG: bad gridOptions given to initColumnsTreeList method !");if(!e.is(t.columns,"array"))throw new Error("E_INVALIDARG: bad gridOptions.columns given to initColumnsTreeList method !");if(!e.is(i,"object"))throw new Error("E_INVALIDARG: bad options given to initColumnsTreeList method !");return t.columns.splice(0,0,{text:"",dataIndex:"tree",isHidden:!0}),o.isFUNActive("FUN075064")?t.columns.splice(0,0,{dataIndex:"selection_search",width:24,isResizable:!1,isSortable:!1,isHidden:"oneToOne"===i.selectionMode_techno,setValue:function(e){e.nodeModel.selectionChangeIsFromUI(),e.value?e.manager.getNodesXSO().add(e.nodeModel):e.manager.getNodesXSO().remove(e.nodeModel),e.manager.updateRowViewWithException(e.nodeModel,e.dataIndex)},getValue:function(e){return e.nodeModel.isSelected()},onCellChange:function(e){return e.event.target.dsModel.checkFlag},onCellRequest:function(e){var t=e.cellView.reuseCellContent("checkbox_search");e.isHeader?(t.currentNodeModel=null,t.ignoreUpdate=!0,t.visibleFlag=!1,t.visibleFlag=!0,t.mixedState=e.manager.getNodesXSO().get().length>0&&!e.manager.isEveryVisibleNodeSelected(),t.checkFlag=e.manager.isEveryVisibleNodeSelected()||e.manager.getNodesXSO().get().length>0&&!e.manager.isEveryVisibleNodeSelected(),t.ignoreUpdate=!1):(t.currentNodeModel=e.nodeModel,t.checkFlag=e.manager.getNodesXSO().isIn(e.nodeModel),t.mixedState=!1)}}):t.columns.splice(0,0,{text:"",dataIndex:"selection",type:"selection",width:24,isHidden:"oneToOne"===i.selectionMode_techno}),t.columns.splice(2,0,{dataIndex:"actions",isSortable:!1,isDraggable:!1,text:c.get("actions.title"),actions:!0,width:60}),t},initColumnsDataGrid:function(t,i){if(!e.is(t,"object"))throw new Error("E_INVALIDARG: bad gridOptions given to initColumnsDataGrid method !");if(!e.is(t.columns,"array"))throw new Error("E_INVALIDARG: bad gridOptions.columns given to initColumnsDataGrid method !");if(e.is(i.referer)&&"myContent"===i.referer.id&&e.is(s.getOption("results_attributes_display_customization",{tenant:o.getActiveTenant()}))&&!0===s.getOption("results_attributes_display_customization",{tenant:o.getActiveTenant()}).BETAcustomizationEnabled){var n=l.getItem("3dSearchResultsActiveCustomization");!e.is(n)||"all views"!==n.customizedViews&&"Datagrid"!==n.customizedViews||(t.columns=n.views.Datagrid.general)}var a=l.getItem("DataGridColumnCusto"),r=null;l.getItem("listColumnsWidth")&&(r=JSON.parse(l.getItem("listColumnsWidth")));for(var c=0;c<t.columns.length;c++)if(null!==r&&e.is(r[t.columns[c].dataIndex])&&(t.columns[c].width=r[t.columns[c].dataIndex]),0!==c&&o.isODTMode()){let i=e.clone(t.columns[c].dataIndex);t.columns[c].onCellRequest=function(t){t.cellModel='<span odtmodereferer="datagrid" row-id='+t.rowID+" column-id="+t.columnID+' data-index="'+i+'">'+(e.is(t.cellModel)?t.cellModel:"")+"</span>",t.cellView.getContent().removeAttribute("no-tweaker"),!0!==s.getOption("detach_webUX")&&this._setTweakerForCell(t)}}if(0===t.length)return t;var u=this,h=t.columns[0];e.is(h.pinned,"string")||e.is(s.getOption("addinmode"),"string")||void 0!==a&&"The_Default_Columns"!==a.activeView?e.is(a,"array")&&(h.pinned="center"):h.pinned="left",h.canBeInvisible=!1;let g=e.clone(h.dataIndex);return h.onCellRequest=function(t){var n=t.nodeModel instanceof Object&&e.is(t.nodeModel._options)&&e.is(t.nodeModel._options.icons)&&e.is(t.nodeModel._options.icons[0])?t.nodeModel._options.icons[0]:null,a=i.widgetId+"-"+i.tabId+"-3dsearch-datagrid-"+t.cellID;i.datagridID&&(a+="-dg-index-"+i.datagridID);var r=!0!==i.actionsMenuAccessRights.disableLocalActions&&!0!==i.actionsMenuAccessRights.addmenu?'<span style="font-size:18px;color:gray;cursor:pointer;" class="fonticon fonticon-2x fonticon-down-open" data-rec-id="'+a+'-dropdown-icon"></span>':"";let l=" search_item_hyperlink",c=this.collection._ctx_options,h=e.is(c),p=d.isAdvSearchRun(c);var _=this.collection._snSkeleton.getOption("addinMode"),f=e.is(_,"string")&&_.length>0;!h||p||f||(l=" search_item_in_apps"),t.cellModel=r+(t.nodeModel instanceof Object&&e.is(t.nodeModel._options)&&e.is(t.nodeModel._options.icons)&&e.is(t.nodeModel._options.icons[0])?'<img class="type-icon-datagrid" src="'+n+'" draggable="false"/>':"")+"<span"+(o.isODTMode()?' odtmodereferer="datagrid" row-id='+t.rowID+" column-id="+t.columnID+' data-index="'+g+'"':"")+' data-rec-id="'+a+'-label"class ="'+l+'">'+t.cellModel+"</span>",!0!==s.getOption("detach_webUX")&&this._setTweakerForCell(t),void 0!==t.cellView.getContent().getChildren()[0]&&(t.cellView.getContent().getChildren()[0].removeEvent("click",i.onClickEvent,!1),t.cellView.getContent().getChildren()[0].addEvent("click",i.onClickEvent,!1),t.cellView.getContent().getChildren()[0].removeEvent("dblclick",i.onDblClickEvent,!1),t.cellView.getContent().getChildren()[0].addEvent("dblclick",i.onDblClickEvent,!1),t.cellView.getContent().getChildren()[0].setAttribute("data-rec-id",a+"-cell"),!0!==i.actionsMenuAccessRights.disableLocalActions&&!0!==i.actionsMenuAccessRights.addmenu&&(u._domAttachedEvent[a+"-dropdown-icon"]={target:t,callback:i.onContextualEvent,referer:i.referer,collection:i.collection}),u._domAttachedEvent[a+"-label"]={target:t,callback:i.onItemTitleClickCallback,referer:i.referer,collection:i.collection},u._domAttachedEvent[a+"-cell"]={target:t,callback:i.onItemTitleDblClickCallback,referer:i.referer,collection:i.collection}),t.cellView.getContent().removeAttribute("no-tweaker"),t.cellView.tooltipInfos=i.tooltipCB.call(this,t,i.referer)},h.isCustom=!0,t},getTableViewHeaders:function(){return this.getDataGridViewHeaders()},getXMLViewOptions:function(){return{default_mapping:function(e){var t=e;return-1!==e.indexOf("/")&&(t=e.substring(e.lastIndexOf("/")+1)),t}}},_getMapping:function(){var t=this,i=a.getMapping();return i.title=function(){return(this.model||this).get("ds6w:label")},i.subtitle=function(){var i=this.model||this,n="",s=i.get("ds6w:who/ds6w:responsible");e.is(s,"string")&&s.length>0&&(n+=s);var o=i.get("ds6w:modified");e.is(o,"string")&&o.length>0&&(n.length>0&&(n+=" - "),n+=o);var a=t._retrieveSource(i);return e.is(a,"string")&&a.length>0&&(n.length>0&&(n+=" - "),n+=a),n},i.content=function(){var t=this.model||this,i="",n=t.get("ds6w:identifier"),s=t.get("ds6w:description");return e.is(n,"string")&&n.length>0&&(i+=n),e.is(s,"string")&&s.length>0&&(i.length>0&&(i+="<br/>"),i+=s),i},i.date=function(){return(this.model||this).get("ds6w:modified")},i.source=function(){var e=this.model||this;return t._retrieveSource(e)},i.ownerName=function(){return(this.model||this).get("owner")},i.icon_source=function(){var t=this.model||this,i=e.is(t)?t.get("source_icon_url"):"";return e.is(i,"string")||(i=""),i},i},_retrieveSource:function(t){if(!e.is(t,"object"))throw new Error("E_INVALIDARG: bad model given to _retrieveSource method !");var i=t.get("ds6w:where/ds6w:context/ds6w:project");return void 0!==i&&e.is(i,"string")&&0!==i.length||(i=t.get("ds6w:where/ds6w:context/ds6w:community"),e.is(i,"string")&&0!==i.length||(i="")),i},setViewData:function(e){this._viewData=e},getViewData:function(){return this._viewData},getNlsOfDataSources:function(t){if(!e.is(t))return null;var i=[];if(e.is(t.dataSourceLists,"array"))for(var n=t.dataSourceLists,s=0;s<n.length;s++)i.push(c.get("adv_search.source."+n[s]));return i},getAvailableViews:function(t){if(!e.is(t))return null;var i=[];if(!0===(e.is(t.simple_search_experience)?t.simple_search_experience:!!e.is(t.activeTenant)&&o.isInTheSimpleSearch({tenant:t.activeTenant}))){var n=s.getOption("search_compact_mode");e.is(n)||(n=!1),i=!1===n?[{id:"thumbnail",title:c.get("view.thumbnail.title"),icon:"view-small-thb",nlsKeys:"view.thumbnail.title"},{id:"tilebig",title:c.get("view.Textual.title"),icon:"view-big-tile",nlsKeys:"view.Textual.title",default:!0},{id:"tile",title:c.get("view.tile.title"),icon:"view-small-tile",nlsKeys:"view.tile.title"},{id:"table",title:c.get("view.table.title"),icon:"view-list",nlsKeys:"view.table.title"}]:[{id:"thumbnail",nlsKeys:"view.thumbnail.title",icon:"view-small-thb",title:c.get("view.thumbnail.title")},{id:"tilebig",nlsKeys:"view.Textual.title",icon:"view-big-tile",title:c.get("view.Textual.title"),default:!0},{id:"tile",nlsKeys:"view.tile.title",icon:"view-small-tile",title:c.get("view.tile.title")}]}else i=!0!==s.getOption("enableNewSearchViews")?[{id:"thumbnail",title:c.get("view.thumbnail.title"),icon:"view-small-thb",nlsKeys:"view.thumbnail.title",default:!0},{id:"tile",title:c.get("view.tile.title"),icon:"view-small-tile",nlsKeys:"view.tile.title"},{id:"table",title:c.get("view.table.title"),icon:"view-list",nlsKeys:"view.table.title"}]:[{id:"thumbnail",title:c.get("view.thumbnail.title"),icon:"view-small-thb",nlsKeys:"view.thumbnail.title"},{id:"tilebig",title:c.get("view.Textual.title"),icon:"view-big-tile",nlsKeys:"view.Textual.title",default:!0},{id:"tile",title:c.get("view.tile.title"),icon:"view-small-tile",nlsKeys:"view.tile.title"},{id:"table",title:c.get("view.table.title"),icon:"view-list",nlsKeys:"view.table.title"}];return i}})})),define("DS/SNResultUX/views/helpers/Abstract",["UWA/Core","UWA/Class/Options","UWA/Class/Listener","UWA/Class/View","DS/MessageBus/MessageBus","UWA/Class/Debug","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchCom","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchPreferences","DS/SNResultUX/utils/SearchServices","DS/SNResultUX/views/utils/EmptyView","DS/SNResultUX/utils/SearchViewOptions","DS/WebappsUtils/Performance","DS/W3DXComponents/Views/Plugins/Multisel","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/SNResultUX/views/helpers/utils/TimeLines/TimeLineDate","DS/SNInfraUX/SecurityContextManager","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],(function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_,f,m,S,v){"use strict";return n.extend(t,o,_,{_viewId:null,setViewId:function(e){this._viewId=e},getViewId:function(){return this._viewId},tagName:"div",className:"GridView",attributes:{styles:{width:"100%"},"data-rec-id":"GridView"},nestedView:null,_model:null,_viewRoot:null,_emptyView:null,_canMultiSelect:!0,_columnsMaxNumber:0,_rowMaxNumber:0,_checkingMoreDate:!1,_inAppsOptions:null,_lastselectedSearchId:null,_simpleSearch:!1,_timelineDisplay:!1,_bOnDragStartState:!1,_queueSkeletonMultiSel:null,_refreshMargins:null,_lastXscreen:0,margins:{left:0,right:0},extendDisplayMargin:function(e,t){return 251/780*e-3209/13-t},init:function(t){this.setDebugMode(l.getDebugMode());var i=this;this.nestedView=this,this._lastXscreen=0,this.collection=t.collection,this.initModel(),i._canMultiSelect="oneToOne"!==t.selectionMode_techno,i._neverAction=t.neverAction,this.margins={left:0,right:0},t.id&&this.setViewId(t.id);var n="";e.is(i.collection)&&e.is(i.collection.search_ressources)&&e.is(i.collection.search_ressources.getActiveTenant,"function")&&(n=i.collection.search_ressources.getActiveTenant()),!0===c.isInTheSimpleSearch({tenant:n})&&(i._simpleSearch=!0),this._parent(t),this._searchcom_socket=r.createSocket({socket_id:"search_grid_view_"+p.now(),widgetId:this.getOption("widgetId")}),this._searchcom_socket.addListener("toggleMultiSelMode",this.toggleMultiSelMode.bind(this)),this._queueSkeletonMultiSel=s.subscribe({channel:"Qchannel-searchgriview-"+this.className,topic:"Qtopic-searchgriview-disableMultiSelMode",callback:this._disableMultiSelMode.bind(this)}),this._refreshMargins=s.subscribe({channel:"Qchannel-searchgriview-all",topic:"Qtopic-searchgriview-refreshMargins",callback:()=>{i.setViewMargins(),i.updateView()}})},initModel:function(e){var t=this;if(this._model=e||this.collection.getTreeDocument(),this._lastXscreen=0,this.modelEventTokenForOnAdd=this._model.getXSO().onAdd((function(e){t.onItemSelected(e)})),this.modelEventTokenForOnRemove=this._model.getXSO().onRemove((function(e){t.onItemUnselected(e)})),this.view&&"GRIDENGINE"===this.view._name?this.view.loadGridViewModel&&this.view.loadGridViewModel(this._model):this.view&&(this.view.model=this._model),this.view&&this.view.getManager){if(this.view.getManager().loadDocument(this._model),0===this._model._numberOfNodesInDocument){var i={x:0,y:0};this.view.getManager().__cachedScrollPos=i,this.view.getManager().__cachedScrollDistance=0,this.view.getManager().setScrollerPosition(i),this.view.getManager().getScroller()&&(this.view.getManager().getScroller()._scrollPosition=i),this.view.getManager()._syncScrollPositionToHeaders()}c.isFUNActive("FUN075064")&&this.initMultiCheckbox()}this.view&&"DataGridView"===this.className&&(this.view.treeDocument=this._model),this.view&&this.view.getManager&&c.isFUNActive("FUN075064")&&this.initMultiCheckbox()},getSNResultMgt:function(){if(this.collection.getSNSkeleton())return this.collection.getSNSkeleton().getOption("observable")},setGlobeObject:function(e){this.collection.getSNSkeleton().getOption("observable").getRefineHelpers().globeViewContainerContent=e},getGlobeObject:function(){return this.collection.getSNSkeleton().getOption("observable").getRefineHelpers().globeViewContainerContent},onSearch:function(){this._viewRoot=this.collection.getSNSkeleton()&&this.collection.getSNSkeleton()._skeleton.getViewAt(0)?this.collection.getSNSkeleton()._skeleton.getViewAt(0):{currentViewId:""}},onSwitch:function(){this.checkToLoadMoreData()},onItemDblClick:function(t,i){if(!e.is(t.rowID)||-1!==t.rowID){var n=t.nodeModel?t.nodeModel._options.id:t._options.id,s=this.collection.getSNSkeleton();e.is(s)&&s.onItemDblClick(n,t.nodeModel,i)}},onItemSelected:function(t){let i=this;i.onItemSelectedTracker(t);var n=t._options.id;if(e.is(this.collection.getSNSkeleton())&&(!0===this._simpleSearch&&e.is(this._lastselectedSearchId)&&this._lastselectedSearchId===t._options.id?this._searchcom_socket.dispatchEvent("onItemUnselected",n,this.collection.getSNSkeleton().getSocketID()):this._searchcom_socket.dispatchEvent("onItemSelected",n,this.collection.getSNSkeleton().getSocketID()),l.getOption("search_web_in_win"))){let e=i,n=parseInt(t._rowID,10);if(!isNaN(n)){let t=e.view._getViewAt(n);t&&(i.collection.getSNSkeleton()._selectedcellView=t)}}this._lastselectedSearchId=n},onItemSelectedTracker:function(e){c.trackerData.search.selectItem=!0,c.trackerData.search.indexItem=e._rowID+1,c.trackerData.search.scenario="Selection",s.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:c.trackerData.search.scenario,persVal:{pv13:c.trackerData.search.indexItem}}}),c.trackerData.search.previewItem&&(c.trackerData.search.scenario="Preview",s.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:c.trackerData.search.scenario,persVal:{pv13:c.trackerData.search.indexItem}}}))},onItemUnselected:function(t){var i=t._options.id;this._lastselectedSearchId=null,e.is(this.collection.getSNSkeleton())&&this._searchcom_socket.dispatchEvent("onItemUnselected",i,this.collection.getSNSkeleton().getSocketID())},onInfiniteScrollAsync:function(e,t){e.reachBottom&&this.collection.length<this.collection.totalCount?this.collection._snSkeleton.loadMoreData(t,t):t&&t()},onResizeOrFirstLoaded:function(e,t){e?(this._columnsMaxNumber=e.ColumnsMaxNumber,this._rowMaxNumber=e.RowMaxNumber,this.checkToLoadMoreData(t)):t&&t()},onItemTitleClick:function(t,i){let n=t.nodeModel?t.nodeModel:t,s=this.collection.getSNSkeleton();e.is(s)&&s.onItemTitleClick(n,{realTitleClick:!0},i)},onItemSignatureClick:function(t,i,n){let s=t.nodeModel?t.nodeModel:t,o=this.collection.getSNSkeleton();e.is(o)&&o.onItemSignatureClick(s,this.collection,n)},_onPostCellRequest:function(t,i,n){e.is(t)&&e.is(i)&&e.is(n)},checkToLoadMoreData:function(t){e.is(this.collection)||t&&t();var i=this,n=this.getMinNumberModel(),s=this.collection.length,o=this.collection.state.pageSize,r=this.collection.state.totalRecords,l=null,c=null,d=null;if(this.isCurrentView()&&!0===this._checkingMoreDate&&(i._model&&e.is(i._model.getRoots())&&i._model.getRoots().length&&(s=i._model.getRoots().length),l=r-s,c=Math.min(l,n-s),d=Math.ceil(c/o),l>=1&&(this._checkingMoreDate=!1)),this.isCurrentView()&&!this._checkingMoreDate)if(l=r-s,c=Math.min(l,n-s),d=Math.ceil(c/o),l>=1){i._checkingMoreDate=!0;var u=function(){--d>=0&&!i.collection.interruptRequested()?setTimeout((function(){i.collection._snSkeleton.loadMoreData(u,(()=>{a.warn("Failure load more Data!!")}))}),0):(i._checkingMoreDate=!1,t&&t())};u()}else t&&t();else t&&t()},setShadings:function(t){var i=this;this.collection&&this.collection.length&&this.view&&(this.collection.forEach((function(n,s){if(t){for(var o=0;o<t.length;o++)if(t[o].criteria(n)&&e.is(i._model.getNthRoot,"function")){var a=i._model.getNthRoot(s);e.is(a)&&(a.options.color=t[o].color)}}else i._model.getNthRoot(s).options.color=""})),i.updateView())},updateView:function(){this.view&&(this.view.updateView&&this.view.updateView(),this.view.invalidateLayout&&this.view.invalidateLayout({updateCellContent:!0}))},isCurrentView:function(){return this._viewRoot&&this._viewRoot.contentsViews?this._viewRoot.contentsViews[this._viewRoot.currentViewId]===this:(this._viewRoot=this.collection.getSNSkeleton()&&this.collection.getSNSkeleton()._skeleton.getViewAt(0)?this.collection.getSNSkeleton()._skeleton.getViewAt(0):{currentViewId:""},!0)},getCurrentViewId:function(){return this.collection.getSNSkeleton()&&this.collection.getSNSkeleton()._skeleton.getViewAt(0)?this.collection.getSNSkeleton()._skeleton.getViewAt(0).currentViewId:null},isMultiSelMode:function(){if(void 0!==this.view._modeIsMultiSel){var t;return t=e.is(this.view._isInMultiSelection,"function")?this.view._isInMultiSelection():this.view.isInMultiSelection(),this.view.isInMultiSelection?t:this.view._interactiveCumulativeSelection}if(this.view.getManager)return this.view.getManager().isInMultiSelection()},toggleMultiSelMode:function(t){var i=null!=t?t:!this.isMultiSelMode();if(this._model.search_multiselMode=i,this.view&&void 0!==this.view._modeIsMultiSel&&(this.view.activateInteractiveCumulativeSelection?(i&&this.view.activateInteractiveCumulativeSelection(),!i&&this.view.deactivateInteractiveCumulativeSelection()):this.view._modeIsMultiSel=i),this.view&&this.view.getManager&&(this.view.getManager().forceMultiSelection(i),this.view.getManager()._multiSelModeHasBeenForced=!1),this.isCurrentView()){!i&&this._model.getXSO()&&this._model.getXSO().empty();var n=this._model.getXSO()&&this._model.getXSO().get();e.is(n)&&e.is(this.collection.getSNSkeleton())&&s.publish({channel:this.collection.getSNSkeleton().getOption("messagingChannel"),topic:"updateSelectionNumber",data:{number:n.length,isMultiSelMode:i}})}},unSelectAll:function(t){if(void 0===t||!0!==t.silent)if(e.is(this.collection._snSkeleton)){this.collection._snSkeleton._handleAction(0,void 0,[{id:"unselect_all",sourcejs:"DS/SNResultUX/utils/Select_ActionHandler"}])}else a.error("[unSelectAll] skeleton not found")},selectAll:function(){if(e.is(this.collection._snSkeleton)){this.collection._snSkeleton._handleAction(0,void 0,[{id:"select_all",sourcejs:"DS/SNResultUX/utils/Select_ActionHandler"}])}else a.error("[selectAll] skeleton not found")},_getDropdownSecurityContext:function(){var t=[],i=0;return new Promise((n=>{S.getSecurityContextPromise(c.active_tenant).then((function(s){var o=d.getItem("securityContext"+c.active_tenant+c.getUserId());e.is(o,"string")&&(o=JSON.parse(o)),s.forEach((function(e){t.push({label:v.get(e.displayName),value:e.name})})),t.forEach((function(t,n){e.is(o)&&e.is(o.name)&&o.name===t.value&&(i=n)})),n(t[i].value)}))}))},getOptionCommon:function(){var t=this;let i=c.getDictionnaryEntry("useDnDForAllSearchViews");return{model:this._model,pageScrollValueTriggeringInfiniteScroll:l.getOption("pageScrollValueTriggeringInfiniteScroll"),selection:{canMultiSelect:this._canMultiSelect,enableListSelection:this._canMultiSelect},enableActiveUI:!0,enableKeyboardNavigation:!0,infiniteScrolling:!0,useSwipableMenu:!1,useDragAndDrop:void 0===i||i,onContextualEvent:{this:t,callback:function(i){let n=l.getOption("search_compact_mode");if(!(!0!==t.options.neverAction||i.fromPreview||e.is(n)&&!1===n))return;let s=null;if(i&&(s=i.cellInfos||i.treeview),e.is(t._inAppsOptions)){if(t._inAppsOptions.UXOptions&&!t._inAppsOptions.UXOptions.localActions)return}if(i&&s&&s.cellView){t.collection._snSkeleton&&s.cellView&&(t.collection._snSkeleton._ctxMenuTarget=s.cellView.getContent());let n=[];if(t.collection._snSkeleton){let e=document.body.getElement(".inlineSuggestionDropdown");e&&e.hide();var o=t.collection._snSkeleton.ctxMenu;o&&o.isVisible&&(c.isWebInWin()?t.collection._snSkeleton.ctxMenu.destroy():t.collection._snSkeleton.ctxMenu.hide(),t.collection._snSkeleton.ctxMenu=null)}let l={},d="event"in window?event:window.event;if(d)d.clientX?l.altPosition={x:d.clientX,y:d.clientY}:d.pageX&&d.pageY?l.altPosition=window.innerWidth<450?{x:window.innerWidth-160,y:d.pageY}:{x:d.pageX,y:d.pageY}:d.target?l.target=d.target:i.data&&i.data.windowPosition&&i.data.windowPosition.x&&i.data.windowPosition.y?l.altPosition={x:i.data.windowPosition.x,y:i.data.windowPosition.y}:i.data&&i.data.target&&(l.target=i.data.target);else if(i&&i.data&&i.data.windowPosition&&i.data.windowPosition.x&&i.data.windowPosition.y){var r=i.data.windowPosition;l.altPosition={x:r.x,y:r.y}}else i&&i.data&&i.data.target?l.altPosition={x:d.pageX,y:d.pageY}:l.target=s.cellView.elements.container;e.is(i)&&e.is(i.fromPreview)&&!0===i.fromPreview&&(l.fromPreview=!0,e.is(l)&&e.is(l.altPosition)&&(l.altPosition.y=l.altPosition.y+20));let u=s.nodeModel||s.cellModel;if(c.isWebInWin()&&e.is(d)){let i=!0,n=0;e.is(d.x)&&(i=!1,t._lastXscreen!==d.x&&(i=!0,t._lastXscreen=d.x,n=1e3)),!0===i&&(a.log("************ getOptionCommon callback event_mouse X: ******* ",t._lastXscreen),t.launchContextMenu(u,l,n))}else t.launchContextMenu(u,l);return n}}},shouldAcceptDrag:function(){return(!l.getOption("targetLocation")||"popup"!==l.getOption("targetLocation"))&&(!e.is(t._inAppsOptions)||!(t._inAppsOptions.UXOptions&&!t._inAppsOptions.UXOptions.dnD))},onDragStartCell:function(i,n){if(!e.is(n)||!0===n.isHeader||e.is(t._inAppsOptions)&&t._inAppsOptions.UXOptions&&!t._inAppsOptions.UXOptions.dnD||l.getOption("targetLocation")&&"popup"===l.getOption("targetLocation"))return i.preventDefault(),void i.stopPropagation();let o=[],a=t._model.getXSO().get();if(e.is(a,"array")&&a.forEach((function(e){if(t._model.getRoots().indexOf(e)>=0){let i=t.collection.get(e._options.id);i&&o.push(i)}})),0===o.length)if(e.is(n.cellModel)&&e.is(n.cellModel._options)&&e.is(n.cellModel._options.id)){let e=t.collection.get(n.cellModel._options.id),i=0;for(;void 0===e&&i<t.collections.length;)e=t.collections[i].get(n.cellModel._options.id),i++;e&&o.push(e)}else if(e.is(n.nodeModel)&&e.is(n.nodeModel._options)&&e.is(n.nodeModel._options.id)){let e=t.collection.get(n.nodeModel._options.id),i=0;for(;void 0===e&&i<t.collections.length;)e=t.collections[i].get(n.nodeModel._options.id),i++;e&&o.push(e)}const r=t.collection.getSNSkeleton()?{widgetId:t.getOption("widgetId"),draggedModels:o,securityContext:t.collection.getSNSkeleton().getSecurityContext()}:null,d=e=>{const n=r||{draggedModels:o,securityContext:e};u.setDragData(i,n),c.isWebInWin()||(t._searchcom_socket.dispatchEvent("onDragStart"),s.publish({channel:"SearchDropDown",topic:"onDragStart",data:o}))};t.collection.getSNSkeleton()?d():t._getDropdownSecurityContext().then(d)},onDragEndCellDefault:function(){!c.isWebInWin()&&t._searchcom_socket.dispatchEvent("onReshow")},onDragEndCell:function(){!c.isWebInWin()&&t._searchcom_socket.dispatchEvent("onReshow")},clickCB:function(i){l.getOption("debug")&&a.log("[DEVONLY - clickCB]",i);let n=l.getOption("search_compact_mode");if(e.is(n)&&!0===n&&e.is(i)&&e.is(t.collection)&&e.is(t.collection.getSNSkeleton,"function")){let n=i.nodeModel?i.nodeModel:i,s=t.collection.getSNSkeleton();e.is(s)&&e.is(s.onItemTitleClick,"function")&&s.onItemTitleClick(n,null,t.collection)}},clickSignatureItemCB:function(i,n){l.getOption("debug")&&a.log("[DEVONLY - clickCB]",i);let s=l.getOption("search_compact_mode");if(e.is(s)&&!0===s&&e.is(i)&&e.is(t.collection)&&e.is(t.collection.getSNSkeleton,"function")){let s=i.nodeModel?i.nodeModel:i,o=t.collection.getSNSkeleton();e.is(o)&&e.is(o.onItemSignatureClick,"function")&&o.onItemSignatureClick(s,t.collection,n)}},height:"auto",allowUnsafeHTMLContent:!0}},checkToDisplayEmptyView:function(){var t=!1;if(this.collection&&this.collection._ctx_options&&this.collection._ctx_options.advanced_search&&this.collection._ctx_options.advanced_search.searchOnInit&&(t=!0),!t&&this.collection&&this.collection.service_parameters&&this.collection.service_parameters.adv_search&&!this.collection.service_parameters.advanced_criteria)this.showEmptyView();else{var i=this.collection.totalCount;i<=0&&e.is(this.collection)&&(i=this.collection.length),i<=0?this.showEmptyView():e.is(this._emptyView)&&this.hideEmptyView()}},hideEmptyView:function(){this._emptyView&&this._emptyView.hide();var t=null;e.is(this.collection)&&e.is(this.collection._snSkeleton)&&(e.is(this.collection._snSkeleton.options)&&e.is(this.collection._snSkeleton.options.observable)&&e.is(this.collection._snSkeleton.options.observable.getSearchContentSetHeader,"function")&&(t=this.collection._snSkeleton.options.observable.getSearchContentSetHeader()),!e.is(t)&&e.is(this.collection._snSkeleton._skeleton)&&e.is(this.collection._snSkeleton._skeleton.container)&&e.is(this.collection._snSkeleton._skeleton.container.getElement,"function")&&(t=this.collection._snSkeleton._skeleton.container.getElement(".search-content-set-header")))},showEmptyView:function(){if(!e.is(this._emptyView)){var t=this.getOption("itemViewOptions");this._emptyView=new h(t)}var i=this.container,n=this._emptyView.render();if(e.is(n)&&e.is(i)&&(n.inject(i),this._emptyView.show(),e.is(n.container)&&e.is(n.container.getText,"function"))){var s=n.container.getText();if(e.is(s)&&0===s.indexOf(c.constructEmptyViewMsg(f.get("no_result")))){e.is(this.collection)&&e.is(this.collection._snSkeleton)&&e.is(this.collection._snSkeleton._skeleton)&&e.is(this.collection._snSkeleton._skeleton.container)&&e.is(this.collection._snSkeleton._skeleton.container.getElement,"function")&&this.collection._snSkeleton._skeleton.container.getElement(".search-content-set-header")}}},_forcetoDisplayPreview:function(){e.is(this.collection._snSkeleton)&&e.is(this.collection._snSkeleton.getPreviewStatus())&&e.is(this.collection._snSkeleton.getPreviewPanel())&&!1===this.collection._snSkeleton.getPreviewPanel().getVisibleFlag()&&!0===this.collection._snSkeleton.getPreviewStatus()&&(e.is(this.collection._snSkeleton.getPreviewPanel().activate_deactivateNoPreview,"function")&&this.collection._snSkeleton.getPreviewPanel().activate_deactivateNoPreview(!0),this.collection._snSkeleton.getPreviewPanel().switchVisibleFlag())},launchContextMenu:function(t,i,n){var s=this,o=null,r=null,l=s._model.getXSO().get();if(c.isWebInWin()){var d={};let i=t.getTreeDocument();if(!e.is(i))return;l=i.getXSO().get();let c=s.collection;if(e.is(s.collections)){let t=s.collections.length;for(let i=0;i<t;i++){let n=s.collections[i];for(o=0;o<l.length;o++){let s=n.get(l[o]._options.id);e.is(s)&&(c=n,i=t)}}}if(-1===l.indexOf(t))if(s.log('there might be an existing selection, but the "context" object is not there in it, clear the selection and use only the "context" object'),s.collection._snSkeleton.resetMultisel(),e.is(t)&&e.is(t._options)&&e.is(t._options.id)){var u=t._options.id;d.objets_name=[{id:u,session_object:c&&c.get(u).hasOwnProperty("session_object")}],i.getRoots()[t._localID]&&s._model.getRoots()[t._localID].select()}else d.objets_name=[{id:"V_LocationWithoutSelectedObject",session_object:!1}];else{s.log('there is a selection, and "context" object is one of them, use all the selected objects'),c.custoAction&&c.custoAction.popover&&c.custoAction.popover.hide();var h=[];for(o=0;o<l.length;o++)r=l[o]._options.id,h.push({id:r,session_object:c&&c.get(r).hasOwnProperty("session_object")});d.objets_name=h}setTimeout((function(){let t=s.collection.getSNSkeleton();e.is(t)&&(a.log("************ launchContextMenu on: ",d),d.tabID=t.getOption("observable").getTabID(),t.onDispatchToWin(d,"onActionClickDotted"))}),e.is(n)?n:0)}else{if(-1===l.indexOf(t)){for(o=0;o<l.length;o++){var g=s._model.getRoots().indexOf(l[o]);s._model.getNthRoot(g).unselect()}-1!==(r=s._model.getRoots().indexOf(t))&&s._model.getRoots()[r].select()}l=s._model.getXSO().get();var p=[];for(o=0;o<l.length;o++)p.push(s.collection.get(l[o]._options.id));var _=s.collection.getSNSkeleton();e.is(_)&&e.is(p,"array")&&p.length>=0&&_.computeCtxActions2(p,i)}},_disableMultiSelMode:function(){e.is(this.view)&&e.is(this.view.deactivateInteractiveCumulativeSelection,"function")&&this.view.deactivateInteractiveCumulativeSelection()},setup:function(){var t=this;this.listenTo(this.collection,{onAdd:function(){},onRemove:function(){},onSort:function(){},onAnyEvent:function(){},onReset:function(){t.checkToDisplayEmptyView(),t.toggleMultiSelMode(!1)},onSync:function(){t.checkToDisplayEmptyView(),t._viewRoot=t.collection._snSkeleton&&t.collection.getSNSkeleton()._skeleton.getViewAt(0)?t.collection.getSNSkeleton()._skeleton.getViewAt(0):{currentViewId:""},t.checkToLoadMoreData()},onInitTreeDocument:function(i,n){!0===n&&e.is(t.view)&&e.is(t.view.options)&&e.is(t.view.options.TreedocModel)&&(t.view.options.TreedocModel=null),t.initModel(i)},onInitTreeDocument_SelectFirstElt:function(){e.is(t.view)&&e.is(t.view.model)&&(e.is(t.view.getManager)||"DataGridView"===t.className||t.view.model.length>0&&(t.view.lastSelectedNode=t.view.model[0])),s.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"onInitTreeDocumentAbstractViewCB"}),t.collection._snSkeleton&&t.collection._snSkeleton.options.observable&&t.collection._snSkeleton.options.observable.getOptions().default6WGroupingView&&setTimeout((function(){let e={rootW:"ds6w:"+t.collection._snSkeleton.options.observable.getOptions().default6WGroupingView,predicate:"ds6w:dataSource"};t.collection.getTaggerProxy()._requestGroupingChange(e),setTimeout((function(){t.collection._snSkeleton.options.observable.getOptions().default6WGroupingView=null}),500)}),500)},onError:function(){a.log("onError event received"),t.checkToDisplayEmptyView()}}),t.checkToDisplayEmptyView()},render:function(){return this._viewRoot=this.collection.getSNSkeleton()&&this.collection.getSNSkeleton()._skeleton.getViewAt(0)||{currentViewId:""},this.collection&&this.collection.getSNSkeleton()&&this.collection.getSNSkeleton()._modeIsMultiSel&&this.toggleMultiSelMode(!0),this},_getMenuAndLocalActionsStatus:function(){var t=!1,i=!1,n=!1;l.getOption("search_compact_mode");return!0===this._simpleSearch&&(n=!1),this._inAppsOptions=this.collection.getSNSkeleton()&&this.collection.getSNSkeleton().getOption("in_apps_search"),e.is(this._inAppsOptions)&&(i=this._inAppsOptions.UXOptions&&!this._inAppsOptions.UXOptions.dnD,t=this._inAppsOptions.UXOptions&&!this._inAppsOptions.UXOptions.localActions),{addmenu:n,disableDnD:i,disableLocalActions:t}},_afterRender:function(){var t=this,i=this._getMenuAndLocalActionsStatus();if(this.view.onPostCellRequest&&this.view.onPostCellRequest(this._onPostCellRequest.bind(this)),this.view.onPostCellRequest&&this.view.onPostCellRequest((function(n){var s=null;!0!==i.disableLocalActions&&!0!==i.addmenu||(s=n.cellView.elements.container.querySelector(".wux-controls-responsivethumbnailview-menu"),e.is(s)||(s=n.cellView.elements.container.querySelector(".wux-controls-responsivetileview-menu")),e.is(s)||(s=n.cellView.elements.container.querySelector(".wux-controls-responsivetextualtileview-menu")),e.is(s)||(s=n.cellView.elements.container.querySelector(".wux-ui-3ds-open-down"))&&(s.style.display="none",s=void 0),e.is(s)&&s.setAttribute("has-menu","true")),t._onPostCellRequest(n),i.disableDnD&&n.cellView.elements.container.setAttribute("draggable","false")})),!0===i.disableLocalActions){var n=this.view.displayedOptionalCellProperties;e.is(n,"array")&&0===n.length&&n.push("None"),this.view.displayedOptionalCellProperties=n,this.view.getManager&&(this.view.options.columns[2].isHidden=!0)}var s=this.collection.getSNSkeleton();s&&s.refreshUIAfterRender(),this.checkToDisplayEmptyView()},getMinNumberModel:function(){return 0},setLocalFilter:function(e,t){void 0===t&&(t="when");let i=this.collection.getTaggerProxy();i.clearLocalFilter(!1),this._setLocalFilter(i,e,t)},_setLocalFilter:function(e,t,i,n=!0){let s,o=[{display:t.dispText,object:t.identifier,type:t.type,predicates:t.object.predicates,value:t.object.value,operator:"OR"}],a={};"what"===i||"who"===i?s="ds6w:"+i+"/":"when"===i?s="sixw:ds6w:when/ds6w:modified":"where"===i&&(s="ds6w:where/ds6w:location/"),"what"===i||"who"===i||"where"===i?a[s]={condition:o,isComplex:!0,operator:"OR"}:"when"===i&&(a[s]=[{displayValue:t.dispText,object:t.object,isSimplifiedCriteria:!0,type:t.type}]);let r={condition:[a],operator:"AND",isSimplified:{version:2}};e.setLocalFilter(r,n)},_retrieveAllDatesFromCollection:function(){if(!this.collection.parsed_response)return[];let e=[],t=[];return this.collection&&this.collection.parsed_response&&this.collection.parsed_response.summaryData&&(t=this.collection.parsed_response.summaryData.filter((e=>{if(e.sixw.contains("ds6w:when/ds6w:modified"))return e})),t=t.map((e=>e.object)),t.forEach((t=>{t.match(/^[0-9]+\/[0-9]+\/[0-9]+$/)&&e.push(new Date(t))}))),e.sort(((e,t)=>t-e)),e.reverse(),e},destroy:function(){this.stopListening(this.collection),e.is(this.modelEventTokenForOnAdd)&&e.is(this._model)&&e.is(this._model.getXSO,"function")&&e.is(this._model.getXSO())&&e.is(this._model.getXSO().unsubscribe,"function")&&(this._model.getXSO().unsubscribe(this.modelEventTokenForOnAdd),delete this.modelEventTokenForOnAdd),e.is(this.modelEventTokenForOnRemove)&&e.is(this._model)&&e.is(this._model.getXSO,"function")&&e.is(this._model.getXSO())&&e.is(this._model.getXSO().unsubscribe,"function")&&(this._model.getXSO().unsubscribe(this.modelEventTokenForOnRemove),delete this.modelEventTokenForOnRemove),this._model=null,this._searchcom_socket.removeListener("toggleMultiSelMode"),this._searchcom_socket.disconnect(),r.deleteSocket(this._searchcom_socket.id),this._searchcom_socket=null,this.collection=null,this._viewRoot=null,this._emptyView&&(this._emptyView.destroy(),this._emptyView=null),s.unsubscribe(this._queueSkeletonMultiSel),s.unsubscribe(this._refreshMargins),this._parent()},mask:function(){let t=this.collection.getSNSkeleton();e.is(t)&&t.maskContainer()},unmask:function(){let t=this.collection.getSNSkeleton();e.is(t)&&t.unmaskContainer()},setViewMargins:function(){if(!e.is(this.view))return;let t=!1;e.is(this.collection._snSkeleton)&&(t=this.collection._snSkeleton.options.observable.getOption("pinToDashboard"));let i=10,n=10,s=!(!this.collection||!this.collection.getSNSkeleton())&&(this.collection&&e.is(this.collection.getSNSkeleton().getPreference("informationPanelState"),"boolean")&&this.collection.getSNSkeleton().getPreference("informationPanelState"));if(c.isFUN109031Active()&&this.getSNResultMgt()&&!this.getSNResultMgt()._isInAppsSearch()&&!1!==t&&(void 0===d.getItem("search_resizeFullMode")||!1===d.getItem("search_resizeFullMode"))&&!1===s){let t=this.container.parentElement.offsetWidth;l.getOption("debug")&&a.log("[DEVONLY - 6w margin vp]",t);let s=d.getLocalStorageItem("3dSearch-sidePanelPositionBack");(l.options.search_settings.taggerClosed&&(!e.is(s)||"maximized"===s)||l.options.search_settings.taggerClosed&&e.is(s)&&"fitted"===s||l.options.search_settings.taggerClosed&&e.is(s)&&"normal"===s||l.options.search_settings.taggerClosed&&e.is(s)&&"minimized"===s)&&(t>=800&&t<=1139&&(i=10,n=14),t>1140&&(i=this.extendDisplayMargin(t,90),n=this.extendDisplayMargin(t,50)))}this.margins.left!==i&&this.margins.right!==n&&(this.view.layout.layoutMargins={marginTop:0,marginBottom:0,marginLeft:i,marginRight:n},this.margins={left:i,right:n},l.getOption("debug")&&a.log("[DEVONLY - 6w margin left/right]",i,n))},_callBackActionMenu:function(t){t&&(t.cancelBubble=!0),t&&t.stopPropagation&&t.stopPropagation(),t&&t.preventDefault&&t.preventDefault();var i=t.target;if(e.is(i.attributes.class)&&"highlightedSearchCriteria"===i.attributes.class.value&&(i=i.getParent()),e.is(i.attributes["data-rec-id"])&&e.is(i.attributes["data-rec-id"].nodeValue)&&e.is(g._domAttachedEvent[i.attributes["data-rec-id"].nodeValue])){var n=i.attributes["data-rec-id"].nodeValue;a.log(n);var s=g._domAttachedEvent[n];n.endsWith("-label")?s.collection?s.callback.call(s.referer,s.target,s.collection):s.callback.call(s.referer,s.target):n.endsWith("-dropdown-icon")&&s.callback.call(s.target.cellView.collectionView.onContextualEvent,{treeview:s.target,data:{target:i}})}},_callBackDblClickActionMenu:function(t){if(t&&(t.cancelBubble=!0),t&&t.stopPropagation&&t.stopPropagation(),t&&t.preventDefault&&t.preventDefault(),e.is(t.target.attributes["data-rec-id"])&&e.is(t.target.attributes["data-rec-id"].nodeValue)&&e.is(g._domAttachedEvent[t.target.attributes["data-rec-id"].nodeValue])){var i=t.target.attributes["data-rec-id"].nodeValue;a.log(i);var n=g._domAttachedEvent[i];i.endsWith("-cell")&&(n.collection?n.callback.call(n.referer,n.target,n.collection):n.callback.call(n.referer,n.target))}},_tooltipCB:function(t,i){return{getAllInformationCB:function(){var n="";if(t.isHeader&&e.is(t.manager.options.columns[t.virtualColumnID]))n=t.manager.options.columns[t.virtualColumnID].text;else if(!0===l.getOption("webUXTooltip")){if(e.is(t.nodeModel)&&e.is(t.nodeModel._options)&&e.is(t.nodeModel._options.customTooltip))return t.nodeModel._options.customTooltip}else e.is(t.cellModel)&&(n=t.cellModel),e.is(i.view)&&e.is(t.nodeModel)&&i.view.getColumns()[t.columnID]&&(n=t.nodeModel._options._attributes[i.view.getColumns()[t.columnID].dataIndex]);return{model:{shortHelp:c.htmlDecode(n)},updateModel:!1}}}}})})),define("DS/SNResultUX/utils/SearchCustoServices",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Events","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/PredefinedQueries","DS/SNInfraUX/RefineHelper/RefineHelper","DS/SNInfraUX/SWFiltering","DS/SNInfraUX/SearchLogin","DS/SNResultUX/utils/SearchServices","DS/SNResultUX/utils/SearchViewOptions","DS/SNResultUX/utils/datagridPreferences/SearchDataGridPreferences","DS/SNResultUX/utils/datagridPreferences/SearchDataGridPreferencesEndUser","DS/FedDictionaryAccess/FedDictionaryAccessAPI","text!DS/SNInfraUX/assets/SearchColumnCustoDS.json","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],(function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_,f,m,S,v){"use strict";var w=function(e,t){var i=0;return e.label>t.label?i=1:e.label<t.label&&(i=-1),i};return t.singleton(n,i,{name:"DS_SNResultUX_utils_SearchCustoServices",_adminCusto:null,_dsCusto:null,_displayNameCusto:null,_displayNameCustoObject:null,fixColumnUnsortable:["ds6wg:_displayName_"],fixColumnSortableFor1000:["ds6w:modified","ds6w:label","ds6w:created","ds6w:responsible"],DEFAULT_FIELDS:{"ds6w:modified":"num","ds6w:label":"alpha","ds6w:created":"num","ds6w:responsible":"alpha","ds6w:type":"group"},SORT_ACTIVATED_CSS:"sortActived",PINNED_ACTIVATED_CSS:"sortActived",colCustoPanel:null,colCustoPanelEndUser:null,init:function(){this._dictionnary=[],this.colCustoPanel=null,this.colCustoPanelEndUser=null,this.f=null,this.setDebugMode(o.getDebugMode());try{this._dsCusto=JSON.parse(S),this._addMissingPredicates(this._dsCusto),s.log("DS custo:",this._dsCusto),this._adminCusto=r.getAdminCustoDefinition(),this._addMissingPredicates(this._adminCusto)}catch(e){s.error("Error parsing SearchColumnCustoAdmin.json:",e)}},_addMissingPredicates:function(t){if(e.is(t.SearchColumnCustoDSDefinition,"array"))for(var i=0;i<t.SearchColumnCustoDSDefinition.length;i++){var n=t.SearchColumnCustoDSDefinition[i].viewDefinition;this.addMandatoryPredicates(n)}},addMandatoryPredicates:function(t){if(e.is(t,"array")&&!(0>=t.length)){var i,n=["ds6w:identifier","ds6w:type"];for(i=n.length-1;i>=0;i--)for(var s=0,o=t.length;s<o;s++)if(t[s].uri.endsWith(n[i])){n.splice(i,1);break}for(i=n.length-1;i>=0;i--)t.push({uri:n[i],width:"auto"})}},getAvailableColumnCustomization:function(t,i){if(!e.is(t,"object")||!e.is(t.isPQ))throw new Error("E_INVALIDARG: bad iContext given to getAvailableColumnCustomization method !");var n=[],s=a.getItem("DataGridColumnCusto"),r=0,l=0,d=null,u=0,h=0,g=null,_=[];if(e.is(s,"object")&&e.is(s.views,"array")){var f=s.views;for(r=0,l=f.length;r<l;r++){if(d={label:f[r].viewId,value:f[r].viewId},0===f[r].viewId.indexOf("###")){var m;if(g=f[r].viewId.substring(3,f[r].viewId.length),e.is(g,"string")&&g.length>0){m=g;var S=c.getPQObjFromPQPrefix(g),b=c.getPQNLS();e.is(b,"object")&&e.is(S,"object")&&e.is(S.pqid,"string")&&S.pqid.length>0&&e.is(b[S.pqid+".Title"],"string")&&b[S.pqid+".Title"].length>0&&(m=b[S.pqid+".Title"])}d.label=v.replace(v.get("custo_PQ"),{PQ:m})}n.push(d)}n.sort(w)}var C=[];if(e.is(this._adminCusto,"object")&&e.is(this._adminCusto.SearchColumnCustoAdminDefinition,"array")){if(this._adminCusto.SearchColumnCustoAdminDefinition.length>0)_=this._adminCusto.SearchColumnCustoAdminDefinition;else{let t=o.getOption("column_custo",{tenant:i});e.is(t)&&e.is(t.searchColumnCustoInputs,"object")&&e.is(t.searchColumnCustoInputs.SearchColumnCustoAdminDefinition,"array")&&t.searchColumnCustoInputs.SearchColumnCustoAdminDefinition.length>0&&(_=t.searchColumnCustoInputs.SearchColumnCustoAdminDefinition,this._adminCusto=t.searchColumnCustoInputs),e.is(t)&&e.is(t.searchDisplayCustoInputs,"object")&&(this._displayNameCusto=t.searchDisplayCustoInputs)}for(r=0;r<_.length;r++)if(e.is(_[r].viewId,"string")&&"The_Default_Columns"!==_[r].viewId){if(d={label:_[r].viewId,value:_[r].viewId+"-ADMIN"},0===_[r].viewId.indexOf("###"))if(e.is(_[r].viewDefinition,"array"))g=_[r].viewId.substring(3,_[r].viewId.length),d.label=v.replace(v.get("custo_PQ"),{PQ:g});else if(e.is(_[r].custoAliasToUse,"string")){var y=_[r].viewId.substring(3,_[r].viewId.length);d.label=v.replace(v.get("custo_type"),{type:y})}C.push(d)}C.sort(w)}if(n.length>0&&C.length>0){var D=v.get("SearchColumnCustoUserGroup"),I=v.get("SearchColumnCustoAdminGroup");for(u=0,h=n.length;u<h;u++)n[u].group=D;for(u=0,h=C.length;u<h;u++)C[u].group=I}var T=n.concat(C),A=!1,x=!1,N=null;if(e.is(t.forcedCusto,"string")&&t.forcedCusto.length>0&&(N=t.forcedCusto),!0===t.isPQ){if(e.is(t.typeName)&&e.is(t.typeName.pqName,"string")&&t.typeName.pqName.length>0){var E="###"+t.typeName.pqName;if(e.is(this._dsCusto,"object")&&e.is(this._dsCusto.SearchColumnCustoDSDefinition,"array"))for(_=this._dsCusto.SearchColumnCustoDSDefinition,r=0;r<_.length&&!x;r++)e.is(_[r].viewId,"string")&&_[r].viewId===E&&N===E&&(x=!0,N=E);for(r=0,l=T.length;r<l&&!A;r++)E!==T[r].value&&E+"-ADMIN"!==T[r].value||(T[r].selected=!0,A=!0,N=E)}if(e.is(t.typeName)&&e.is(t.typeName.pqName,"string")&&t.typeName.pqName.length>0){var O="###"+t.typeName.pqName;if((!e.is(N)||!N.startsWith(O))&&e.is(this._dsCusto,"object")&&e.is(this._dsCusto.SearchColumnCustoDSDefinition,"array"))for(_=this._dsCusto.SearchColumnCustoDSDefinition,r=0;r<_.length;r++)if(e.is(_[r].viewId,"string")&&_[r].viewId===O){N=O+"-HIDDEN",d={label:"Customized PQ: "+t.typeName.pqName,value:N},T.push(d);break}if(!e.is(N)||!N.startsWith(O)){var k=p.getViewData();if(e.is(k)&&e.is(k.SearchColumnCustoDefinition)){var P=k.SearchColumnCustoDefinition;e.is(P)&&e.is(P.viewId,"string")&&P.viewId===O&&(N=O+"-HIDDEN",d={label:"Customized PQ: "+t.typeName.pqName,value:N},T.push(d))}}}}if(!A&&!x&&e.is(s,"object")&&e.is(s.activeView,"string"))for(t.isPQ&&(!e.is(t.forcedCusto,"string")||t.forcedCusto.length<=0)?e.is(N)||(N=s.activeView):N=t.isPQ&&e.is(t.forcedCusto,"string")&&t.forcedCusto.length>0?t.forcedCusto:s.activeView,r=0,l=T.length;r<l&&!A;r++)N===T[r].value&&(T[r].selected=!0,A=!0);return T},getColumnCustomizationAliasIdToUse:function(t,i){var n=null,s="###"+t;if(e.is(this._adminCusto,"object")&&e.is(this._adminCusto.SearchColumnCustoAdminDefinition,"array")){var a=[];if(this._adminCusto.SearchColumnCustoAdminDefinition.length>0)a=this._adminCusto.SearchColumnCustoAdminDefinition;else{let t=o.getOption("column_custo",{tenant:i});e.is(t)&&e.is(t.searchColumnCustoInputs,"object")&&e.is(t.searchColumnCustoInputs.SearchColumnCustoAdminDefinition,"array")&&t.searchColumnCustoInputs.SearchColumnCustoAdminDefinition.length>0&&(a=t.searchColumnCustoInputs.SearchColumnCustoAdminDefinition,this._adminCusto=t.searchColumnCustoInputs)}for(var r=0;r<a.length&&(!e.is(a[r].viewId,"string")||a[r].viewId!==s||(n=a[r].custoAliasToUse,!e.is(n)));r++);}return n},getColumnCustomizationIdToUse:function(t,i){if(this._activeTenant=i,e.is(t.forcedCusto))return t.forcedCusto;var n=this.getAvailableColumnCustomization(t,i),s="The_Default_Columns";if(e.is(n,"array")&&n.length)for(var o=0,a=n.length;o<a;o++)if(e.is(n[o].selected)&&!0===n[o].selected){s=n[o].value;break}if(!0===t.isPQ){if(e.is(t.typeName)&&e.is(t.typeName.pqName,"string")&&t.typeName.pqName.length>0){this._pqName=t.typeName.pqName;var r="###"+this._pqName;if(!s.startsWith(r)&&e.is(this._dsCusto,"object")&&e.is(this._dsCusto.SearchColumnCustoDSDefinition,"array"))for(var l=this._dsCusto.SearchColumnCustoDSDefinition,c=0;c<l.length;c++)if(e.is(l[c].viewId,"string")&&l[c].viewId===r){s=r+"-HIDDEN";break}if(!s.startsWith(r)){var d=p.getViewData();if(e.is(d)&&e.is(d.SearchColumnCustoDefinition)){var u=d.SearchColumnCustoDefinition;e.is(u)&&e.is(u.viewId,"string")&&u.viewId===r&&(s=r+"-HIDDEN")}}}}else this._pqName=null;return s},getColumnCustomizationDefinitionFromCustoId:function(t,i){var n=[],s=this._getDefaultColumnsForInApps(i),o=[],c=0,d=0,u=null,h=0,g=-1,_=-1,f=null,m=0;for(c=0,d=s.length;c<d;c++)o.push(s[c].dataIndex);if("The_Default_Columns"===t)s=this._getDefaultColumns(i);else{var S=e.clone(a.getItem("DataGridColumnCusto"));if(e.is(S,"object")&&e.is(S.views,"array"))for(c=0,d=(u=S.views).length;c<d;c++)if(t===u[c].viewId&&e.is(u[c].viewDefinition,"array")&&0<u[c].viewDefinition.length){s=u[c].viewDefinition;break}if(!e.is(n,"array")||0===n.length){u=this._adminCusto.SearchColumnCustoAdminDefinition;var v=this._adminCusto.CustoAliasDefinitions;for(c=0,d=u.length;c<d;c++)if(t===u[c].viewId+"-ADMIN"){if(e.is(u[c].viewDefinition,"array"))n=e.clone(u[c].viewDefinition);else if(e.is(v,"array")&&0<v.length)for(var w=0,b=v.length;w<b;w++)v[w].aliasId===u[c].custoAliasToUse&&(n=e.clone(this._adminCusto.CustoAliasDefinitions[w].viewDefinition));if(e.is(n,"array")){for(h=0;h<n.length;h++)n[h].dataIndex=n[h].uri,g=n[h].uri.indexOf(":"),_=n[h].uri.indexOf("."),f=null,g>0&&_>0&&_>g&&(f=n[h].uri.substring(0,_)),n[h].dataType=f,n[h].isSortable=!0,n[h].minWidth=40,n[h].text=l.getNLSValueForPredicate(n[h].uri),n[h].visibility=!0,n[h].visibilityEditable=!1,n[h].defaultSort="none",n[h].wrap=!1,n[h].pinned="center",m=parseInt(n[h].width,10),n[h].width=isNaN(m)?"auto":m;s=n}break}}if(!e.is(n,"array")||0===n.length)for(c=0,d=(u=this._dsCusto.SearchColumnCustoDSDefinition).length;c<d;c++)if(t===u[c].viewId+"-HIDDEN"){if(n=e.clone(u[c].viewDefinition),e.is(n,"array"))for(h=0;h<n.length;h++)n[h].dataIndex=n[h].uri,g=n[h].uri.indexOf(":"),_=n[h].uri.indexOf("."),f=null,g>0&&_>0&&_>g&&(f=n[h].uri.substring(0,_)),n[h].dataType=f,n[h].isSortable=!0,n[h].minWidth=40,n[h].text=l.getNLSValueForPredicate(n[h].uri),n[h].visibility=!0,n[h].visibilityEditable=!1,n[h].defaultSort="none",n[h].wrap=!1,n[h].pinned="center",m=parseInt(n[h].width,10),n[h].width=isNaN(m)?"auto":m,-1===o.indexOf(n[h].dataIndex)&&s.push(n[h]);break}if(!e.is(n,"array")||0===n.length){var C=null,y=p.getViewData();if(e.is(y)&&e.is(y.SearchColumnCustoDefinition)&&(C=p.getViewData().SearchColumnCustoDefinition),C&&t===C.viewId+"-HIDDEN"&&(n=e.clone(C.viewDefinition),e.is(n,"array")))for(h=0;h<n.length;h++)n[h].dataIndex=n[h].uri,g=n[h].uri.indexOf(":"),_=n[h].uri.indexOf("."),f=null,g>0&&_>0&&_>g&&(f=n[h].uri.substring(0,_)),n[h].dataType=f,n[h].isSortable=!0,n[h].minWidth=40,n[h].text=l.getNLSValueForPredicate(n[h].uri),n[h].visibility=!0,n[h].visibilityEditable=!1,n[h].defaultSort="none",n[h].wrap=!1,n[h].pinned="center",m=parseInt(n[h].width,10),n[h].width=isNaN(m)?"auto":m,-1===o.indexOf(n[h].dataIndex)&&s.push(n[h])}}if(r.isFUN096612Active()){var D=[],I=s.length;if(I>0)for(var T=0;T<I;T++)if(e.is(s[T])&&e.is(s[T].dataIndex,"string")&&"ds6wg:_displayName_"===s[T].dataIndex){s.splice(T,1);break}var A=this.getDisplayNameColumn(this._pqName);e.is(A)&&(D.push(A),s=D.concat(s))}if(e.is(s))for(c=0,d=s.length;c<d;c++)e.is(s[c])&&e.is(s[c].dataIndex,"string")&&(s[c].dataIndex=r.getURIToUse(s[c].dataIndex));return s},getColumnCustomizationDefinitionFromAliasCustoId:function(t){var i=[],n=[],s=0,o=0;if(!e.is(t,"string")||0===t.length)throw new Error("Invalid Arg in SearchCustoServices.getColumnCustomizationDefinitionFromAliasCustoId!");var a=[];for(s=0,o=(i=this._getDefaultColumnsForInApps()).length;s<o;s++)a.push(i[s].dataIndex);if(e.is(this._adminCusto)){var r=this._adminCusto.CustoAliasDefinitions;if(e.is(r))for(s=0,o=r.length;s<o;s++)if(t===r[s].aliasId){var c=e.clone(r[s]);if(e.is(c.viewDefinition,"array")){n=c.viewDefinition;for(var d=0;d<n.length;d++){n[d].dataIndex=n[d].uri;var u=n[d].uri.indexOf(":"),h=n[d].uri.indexOf("."),g=null;u>0&&h>0&&h>u&&(g=n[d].uri.substring(0,h)),n[d].dataType=g,n[d].isSortable=!0,n[d].minWidth=40,n[d].text=l.getNLSValueForPredicate(n[d].uri),n[d].visibility=!0,n[d].visibilityEditable=!1,n[d].defaultSort="none",n[d].wrap=!1,n[d].pinned="center";var p=parseInt(n[d].width,10);n[d].width=isNaN(p)?"auto":p,-1===a.indexOf(n[d].dataIndex)&&i.push(n[d])}}break}}return i},getColumnCustomizationDefinitionFromCustoIdWithNLSUpdated:function(t,i){var n=this.getColumnCustomizationDefinitionFromCustoId(t),o=null,a=null;if(e.is(i,"function")){for(var r={},c=["ds6wg:PLMEntity"],d={vocabIds:[]},u=0,h=n.length;u<h;u++)if(n[u].dataIndex.startsWith("ds6wg"))if(e.is(n[u].dataType)&&!e.is(r[n[u].dataType]))r[n[u].dataType]=!0,c.push(n[u].dataType);else{var g=n[u].dataIndex,p=g.indexOf(".");p>0&&(g=n[u].dataIndex.slice(0,p),e.is(r[n[u].dataType])||(r[g]=!0,c.push(g)))}else{var _=n[u].dataIndex;o=l.getVocabId(_),e.is(o)&&(l.isLoaded(o)||(-1===d.vocabIds.indexOf(o)&&(d.vocabIds.push(o),d[o]=[]),d[o].push(_))),n[u].text=l.getNLSValueForPredicate(n[u].dataIndex)}var f=d.vocabIds.length;if(f>0)for(var m=0;m<f;m++)o=d.vocabIds[m],l.loadVocabulary(o,(function(t){if(e.is(t)&&"success"===t.status){var i=d[t.id];if(e.is(i)){for(var o=0;o<i.length;o++)a=i[o];for(var r=n.length,c=0;c<r;c++)a=n[c].dataIndex,-1!==i.indexOf(a)&&(n[c].text=l.getNLSValueForPredicate(a))}}else s.warn("Error in PredicatesNLS.loadVocabulary !")}));c.length>0?l._asyncCallToPredicatesWS(c).then((function(t){if(!e.is(t.classPredicates))return s.error("Unexpected response from GetRelevantPredicates !"),null;for(var o=0,a=n.length;o<a;o++)if(n[o].dataIndex.startsWith("ds6wg:"))for(var r=0,l=t.classPredicates.length;r<l;r++){if(!e.is(t.classPredicates[r].className)||!e.is(t.classPredicates[r].vocabularyPredicateInfo))return s.error("Unexpected response from GetRelevantPredicates !"),null;for(var c=0,d=t.classPredicates[r].vocabularyPredicateInfo.length;c<d;c++)t.classPredicates[r].vocabularyPredicateInfo[c].uri===n[o].dataIndex&&(n[o].text!==t.classPredicates[r].vocabularyPredicateInfo[c].nlsName&&(n[o].text=t.classPredicates[r].vocabularyPredicateInfo[c].nlsName),c=d,r=l)}var u={},h=0,g=0;for(h=0,g=n.length;h<g;h++)e.is(u[n[h].text])||(u[n[h].text]=0),u[n[h].text]+=1;for(h=0,g=n.length;h<g;h++)e.is(u[n[h].text])&&u[n[h].text]>1&&(n[h].text+=" ("+n[h].dataType+")");i(n)}),(function(){s.log("promisePredicate fail !"),i(n)})):i(n)}},_getDefaultColumns:function(e){var t=p.getDataGridViewHeaders(e);return this._completeColumnDefinition(t),t},_getDefaultColumnsForInApps:function(){var e=p.getDataGridViewHeadersForInApps();return this._completeColumnDefinition(e),e},getDisplayNameColumn:function(t){var i=null;if(e.is(this._displayNameCusto,"object")&&e.is(this._displayNameCusto.CustoDisplayName,"array")){var n=this._displayNameCusto.CustoDisplayName.length;if(n>0)for(var s=0;s<n;s++)this._displayNameCusto.CustoDisplayName[s].viewId+"-ADMIN"!==t&&this._displayNameCusto.CustoDisplayName[s].viewId!=="###"+t||(i={uri:"ds6wg:_displayName_",width:"auto",dataIndex:"ds6wg:_displayName_",dataType:null,isSortable:!1,minWidth:40,text:"ds6wg:_displayName_",visibility:!0,visibilityEditable:!1,defaultSort:"none",wrap:!1,pinned:"left"})}return i},getDisplayNameObject:function(t){var i={},n=[];if(e.is(this._displayNameCusto,"object")&&e.is(this._displayNameCusto.CustoDisplayName,"array")){var s=this._displayNameCusto.CustoDisplayName.length;if(s>0)for(var o=0;o<s;o++)if(this._displayNameCusto.CustoDisplayName[o].viewId+"-ADMIN"===t||this._displayNameCusto.CustoDisplayName[o].viewId==="###"+t){if(e.is(this._displayNameCusto.DisplayNameAliasDefinitions,"array"))for(var a=this._displayNameCusto.DisplayNameAliasDefinitions.length,r=0;r<a;r++)if(this._displayNameCusto.CustoDisplayName[o].aliasIdToUse===this._displayNameCusto.DisplayNameAliasDefinitions[r].aliasId){if(e.is(this._displayNameCusto.DisplayNameAliasDefinitions[r].separator)&&(i.separator=this._displayNameCusto.DisplayNameAliasDefinitions[r].separator),e.is(this._displayNameCusto.DisplayNameAliasDefinitions[r].aliasDefinition,"array")){var l,c=this._displayNameCusto.DisplayNameAliasDefinitions[r].aliasDefinition,d=0;for(d=0,l=c.length;d<l;d++)n.push(c[d].uri)}break}break}}return i.displayNamePredicates=n,this._displayNameCustoObject=i,i},getDisplayNameCustoObject:function(){return this._displayNameCustoObject},_completeColumnDefinition:function(e){var t=this,i=a.getItem("listColumnsWidth");if(i)try{var n=JSON.parse(i),o=Object.keys(n);e.forEach((function(e){e.width=-1===o.indexOf(e.dataIndex)?"auto":n[e.dataIndex],e.isSortable=t.isColumnSortable(e.dataIndex)}))}catch(e){s.log(e)}else e.forEach((function(e){e.isSortable=t.isColumnSortable(e.dataIndex)}))},isColumnSortable:function(e){return!(-1!==this.fixColumnUnsortable.indexOf(e))},isColumnSortableFor1000:function(e){return-1!==this.fixColumnSortableFor1000.indexOf(e)},closeColCustoPanelObj:function(){e.is(this.colCustoPanel)&&e.is(this.colCustoPanel._requestClosePanel,"function")&&(this.colCustoPanel._requestClosePanel(),this.colCustoPanel.destroy()),this.colCustoPanel=null},getAllFilters:function(e){var t={};return((e=e||{}).condition||[]).forEach((function(e){Object.keys(e).forEach((function(i){0==i.indexOf("sixw:")?(t[i]=t[i]||[],(e[i]||[]).forEach((function(e){t[i].push(e)}))):(e[i].condition||[]).forEach((function(e){var i=e.predicates||[],n=e.value||[],s=e.field;i.forEach((function(i,o){t[i.predicate]||(t[i.predicate]=[]);var a={disptext:e.display,object:n[o],type:i.type,field:s?[s[o]]:["implicit"]};t[i.predicate].push(a)}))}))}))})),t},_removeColumnCustoMask:function(t){if(e.is(t.collection)&&e.is(t.collection._snSkeleton)&&e.is(t.collection._snSkeleton.getSearchActions,"function")){var i=t.collection._snSkeleton.getSearchActions();e.is(i)&&e.is(i.removeMask,"function")&&i.removeMask()}},defineColumnCusto:function(t){var i=null,n=t.getOption("widgetId");if(e.is(t.zIndexToUse)||(t.zIndexToUse=r.getZIndex(t.container)),t.collection.isEmpty())return g._displayAlert({message:v.get("ColumnCustomization_error_noResult"),className:"warning",widgetId:n}),this._removeColumnCustoMask(t),null;if(e.is(t.collection)&&e.is(t.collection.service_parameters)&&e.is(t.collection.service_parameters.query)&&r.SearchTypeEnum.MY_RECENT_CONTENT===t.collection.service_parameters.query)return g._displayAlert({message:v.get("SearchDataGridPreferences_error_RecentModeNotSupported"),className:"warning",widgetId:n}),this._removeColumnCustoMask(t),null;var s=!1,o=["ds6wg:PLMEntity"],a=null;if(e.is(t.collection.options.tagger_proxy)&&(a=t.collection.options.tagger_proxy.latest_tagValues),e.is(t.collection.service_parameters.isAPQSearch)&&!0===t.collection.service_parameters.isAPQSearch){var l=t.collection.getPQ();if(e.is(l)&&e.is(l.pqName,"string")&&l.pqName.length>0&&(s=!0,i={typeName:l,isPQ:!0},e.is(a,"array")&&a.length>0))for(var c=0;c<a.length;c++){var u=a[c];"ds6w:what/ds6w:type"===u.sixw&&o.push("ds6wg:"+u.object)}}var h={};if(e.is(t.collection.options.tagger_proxy)&&e.is(t.collection.options.tagger_proxy.getCurrentFilter())){h=t.collection.options.tagger_proxy.getCurrentFilter(),e.is(h.allfilters)&&d.isSimplifiedTaggerFilters(h.allfilters)&&(h.allfilters=this.getAllFilters(t.collection.options.tagger_proxy.getCurrentFilter().allfilters))}!e.is(t.collection.options.tagger_proxy)||e.is(i)||e.is(h)&&e.is(h.allfilters)&&(e.is(h.allfilters["ds6w:what/ds6w:type"])&&1===h.allfilters["ds6w:what/ds6w:type"].length||e.is(h.allfilters["ds6w:what/ds6w:kind"])&&1===h.allfilters["ds6w:what/ds6w:kind"].length||e.is(h.allfilters["sixw:ds6w:what/ds6w:type"])&&1===h.allfilters["sixw:ds6w:what/ds6w:type"].length||e.is(h.allfilters["sixw:ds6w:what/ds6w:kind"])&&1===h.allfilters["sixw:ds6w:what/ds6w:kind"].length)||s?this._launchColumnCustoPanelCB(t,i,o,h):this._launchFreeTypeCusto(t,o)},updateDatagridTargetObj:function(e){this.colCustoPanelEndUser&&this.colCustoPanelEndUser.setoDatagridTarget(e)},_launchColumnCustoPanelCB:function(t,i,n,s){var o=this;this.colCustoPanel=new _({spreadsheet:t.nestedView.view,searchDatagridView:t,typeToHandle:i,zIndexToUse:t.zIndexToUse,isNewDataGrid:!0,arrayTypeDS6WG:n,currentFilter:s,oSearchCustoServices:this}),this.colCustoPanel.addEvent("onCloseColumnCustomizationPanel",(function(){e.is(o.colCustoPanel)&&e.is(o.colCustoPanel.destroy,"function")&&o.colCustoPanel.destroy(),o.colCustoPanel=null})),this._removeColumnCustoMask(t)},_launchFreeTypeCusto:function(e){if(this.colCustoPanelEndUser)this.colCustoPanelEndUser.reloadRightGridWithCurrentColumns().enableFooterButtonsVisiblity().unselectAllLeftPredicates().showDialog(),this._removeColumnCustoMask(e);else{let t=e.collection._snSkeleton.getOption("resources");h.login({resources:t,onComplete:t=>{this._loadDataAndLaunchPanel(e,t)},onFailure:t=>{this._loadDataAndLaunchPanel(e,t)}})}},_loadDataAndLaunchPanel:function(t,i){let n=this._freeTypeCustoComputeSources(i),s=e.clone(a.getItem("DataGridColumnCusto")),o=[];if(s&&e.is(s.views,"array"))for(let e=0;e<s.views.length;e++)if("ENDUSER_CUSTO"===s.views[e].viewId){o=s.views[e].viewDefinitionHidden;break}this.colCustoPanelEndUser=new f({spreadsheet:t.nestedView.view,searchDatagridView:t,isNewDataGrid:!0,oSearchCustoServices:this,sources:n,hiddenData:o,resources:t.collection._snSkeleton.getOption("resources")}),this._removeColumnCustoMask(t)},_freeTypeCustoComputeSources:function(e){let t=r.getValidDatasources({dataSources:e});var i=[];for(let e=0;e<t.dataSourceNames.length;e++)i.push({value:t.dataSourceNames[e],label:v.get("adv_search.source."+t.dataSourceNames[e])});return i}})})),define("DS/SNResultUX/utils/ContentLocationServices",["UWA/Core","UWA/Class","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchVersioning","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchLogin","DS/SNInfraUX/Logger","DS/SNResultUX/utils/ResultsUtils","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],(function(e,t,i,n,s,o,a,r,l){"use strict";var c,d={R2019x:"BETA3"},u="ds6w:where/ds6w:source/ds6w:dataSource",h=[],g=[];return t.singleton({init:function(){a.log("Initilization Content Location Services"),c=this.getInternalSourceToPredicateMapping()},transformToDataSourceFacets:function(t,i){var n=t[i];if(t.length>i){var s,o=n.object;n.sixw===u&&(n.dispValue=[],e.is(o,"array")?n.object=o:n.object=[o]),c.forEach((function(e){e.uri===n.sixw&&(s=e)})),e.is(s)&&((e.is(n.object,"array"),n.object.indexOf("_drv"))>0?t.splice(i,1):(n.object=[s.service,n.object],n.sixw=u,n.dispValue=[]))}},transformTagsValuesToDataSourceFacets:function(e,t,i,n){this._tagTransform(e[t[i]],n)},_tagTransform:function(t,i){var n,s=t[i],o=s.object;s.sixw===u&&"GoogleDrive"!==o&&"DropBox"!==o&&(s.dispValue=[]),c.forEach((function(e){e.uri===s.sixw&&(n=e)})),e.is(n)&&((e.is(s.object,"array"),s.object.indexOf("_drv"))>0?t.splice(i,1):(s.object=[n.service,s.object],s.sixw=u,s.dispValue=[]))},transformAddSubjectsToDataSourceFacets:function(e){for(var t in e)for(var i=e[t].length,n=0;n<i;n++)this._tagTransform(e[t],n)},transformFilterSourceToProject:function(t){if(!0===t.allfilters.hasOwnProperty(u)){var i=0,n="";if(e.is(t.allfilters[u],"array")&&t.allfilters[u].length>0){for(var s=0,o=0,a=t.allfilters[u].length,r=0;r<a;r++){var l;if(e.is(t.allfilters[u][r].object,"array")?(n=[t.allfilters[u][r].object[0]],o=t.allfilters[u][r].object.length):(n=[t.allfilters[u][r].object],o=1),2===o)n=[t.allfilters[u][r].object[0]],c.forEach((function(e){e.service===n[0]&&(l=e)})),e.is(l)&&!1===t.allfilters.hasOwnProperty(l.uri)&&(t.allfilters[l.uri]=[]),"3DSpace"===n[0]&&(t.allfilters[l.uri].push(t.allfilters[u][r]),s=t.allfilters[l.uri][i].object.length,t.allfilters[l.uri][i].object=t.allfilters[l.uri][i].object[s-1],i+=1,t.localfilters[u].splice(r,1),t.allfilters[u].splice(r,1),a-=1,r-=1)}!0===t.allfilters.hasOwnProperty(u)&&0===t.allfilters[u].length&&(delete t.localfilters[u],delete t.allfilters[u])}return!0}return!1},updateFilter:function(){},caseInsensitiveMatch:function(t){var i;if("3DDrive"===t.toString())return t=["drive"];t=Array.isArray(t)?t.map((e=>e.replaceAll("\\",""))):t.replaceAll("\\","");for(var n=new RegExp(t,"gi"),s=0;s<h.length;s++){if(i=g[s].match(n),e.is(i))return i=h[s];if(i=h[s].match(n),e.is(i))return i=h[s]}return""},getAvblSource:function(t){var i=o.getAvailableSources(t);e.is(i)&&i.forEach((function(t){e.is(t.name)&&e.is(t.service)&&(h.push(t.name),g.push(t.service))}))},getInternalSourceToPredicateMapping:function(){return[{source:"3dspace",predicate:"ds6w:project",uri:"ds6w:where/ds6w:context/ds6w:project",position:"I",service:"3DSpace"}]},getListOfExternalDataSources:function(){},isContentLocationActive:function(){return!!(s.isInTheSimpleSearch()&&i.getOption("contentsLocation_FUN072059")&&n.isActiveWithCurrentVersion(d))},addSourceSpecificParameterToFilterDataCreationUri:function(t){var i=Object.keys(t.refine.allfilters);e.is(t.source)||(t.source=[]);let n=!1;return i.forEach((function(i){var o;if(c.forEach((function(e){e.uri===i&&(o=e)})),e.is(o)){n=!0;var a={};a["sixw:"+i]=t.refine.allfilters[i];var l=r.from_filters_to_uql(a,{usePreciseQueryTerms:!0});s.addSourceSpecificParameter(t,{sourceIds:[o.source],param:{id:"additional_query",value:"AND  ("+l+")"}}),t.source.push(o.source),delete t.refine.allfilters[i]}})),n},addSourceSpecificParameterToFilterDataDriverForDataSrcUri:function(t){var i="",n=[],s=!1,o=0;if(!0===t.refine.allfilters.hasOwnProperty(u)){if(e.is(t.source)||(t.source=[]),1===t.refine.allfilters[u].length)i=t.refine.allfilters[u][0].object;else for(o=0;o<t.refine.allfilters[u].length;o++)n.push(t.refine.allfilters[u][o].object);if(e.is(n,"array")&&t.refine.allfilters[u].length>1){for(o=0;o<n.length;o++){var a=this.caseInsensitiveMatch(n[o]).toString();n[o]=a}s=!0}else i=this.caseInsensitiveMatch(i).toString(),s=!1;!0===s?n.forEach((function(e){e.length>0&&t.source.push(e)})):t.source.length>0?i.length>0&&t.source.push(i):0===i.length?t.source=[]:t.source=[i],t.source.filter((function(e,t,i){return t===i.indexOf(e)})),t.source.length>0&&t.source.indexOf("3dspace")>-1&&(delete t.refine.allfilters[u],delete t.refine.localfilters[u])}},addSourceSpecificParameterToFilterData:function(t){let i=!1;return e.is(t.refine)&&e.is(t.refine.allfilters)&&(i=this.addSourceSpecificParameterToFilterDataCreationUri(t),this.addSourceSpecificParameterToFilterDataDriverForDataSrcUri(t)),i},displaySourceInSearchView:function(t,i){var n="",s=u.split("/"),a=0;for(a=0;a<s.length&&"ds6w:dataSource"!==s[a];a++);if(e.is(i.grid)&&e.is(i.grid.sourceid_value)){if(i.grid.sourceid_value.indexOf(":")>0)n=i.grid.sourceid_value.split(":")[0];else e.is(i.collection)&&e.is(i.collection.search_ressources)&&"OnPremise"===i.collection.search_ressources.active_tenant&&(n=i.grid.sourceid_value);var r=o.getServiceFromSource(n),c="";!e.is(this.NLSNAMEDETAILS)||!0!==this.NLSNAMEDETAILS.hasOwnProperty(s[a])||"3dspace"!==n&&"swym"!==n?(e.is(i.grid[s[a]])||(i.grid[s[a]]=l.get(n+".displayName")),e.is(i.withoutHtmlTag[s[a]])||(i.withoutHtmlTag[s[a]]=l.get(n+".displayName")),e.is(i.grid[s[a]+"_value"])||(i.grid[s[a]+"_value"]=r),e.is(i.withoutHtmlTag[s[a]+"_value"])||(i.withoutHtmlTag[s[a]+"_value"]=r)):(c=this.NLSNAMEDETAILS[s[a]][r],e.is(i.grid[s[a]])||(i.grid[s[a]]=c),e.is(i.withoutHtmlTag[s[a]])||(i.withoutHtmlTag[s[a]]=c),e.is(i.grid[s[a]+"_value"])||(i.grid[s[a]+"_value"]=c),e.is(i.withoutHtmlTag[s[a]+"_value"])||(i.withoutHtmlTag[s[a]+"_value"]=c))}},setNlsNameDetails:function(e){this.NLSNAMEDETAILS=e},addSource:function(e,t){var i=o.getAvailableSources(t),n=u.split("/"),s=0;for(s=0;s<n.length&&"ds6w:dataSource"!==n[s];s++);if(!0===e.hasOwnProperty(n[s]))for(var a=e[n[s]].length,r=0;r<i.length;r++)!0===i[r].status&&e[n[s]].indexOf(i[r].service)<0&&(e[n[s]][a]={value:i[r].service,source:[i[r].service]},a+=1)}})})),define("DS/SNResultUX/utils/SearchTagsTransformation",["UWA/Core","DS/SNResultUX/utils/ContentLocationServices","DS/SNInfraUX/SearchSettings","i18n!DS/SNInfraUX/assets/nls/SN6WOntology.json"],(function(e,t,i,n){"use strict";function s(i){return this.prepareNlsPropertiesValueForServer=function(e,n){return!0===t.isContentLocationActive()&&i.isTransientWidget,s.prepareTransformedFacetValuesToTranslate(e,n),n},this.displaySourceInSearchView=function(e,n,s){!0===t.isContentLocationActive()&&i.isTransientWidget&&t.displaySourceInSearchView(e,n,s)},this.addSource=function(e,n){!0===t.isContentLocationActive()&&i.isTransientWidget&&t.addSource(e,n)},this.isTransientWidget=function(){return i.isTransientWidget},this.setNlsNameDetails=function(e){!0===t.isContentLocationActive()&&i.isTransientWidget&&t.setNlsNameDetails(e)},this.transformFacets=function(n,o){!0===t.isContentLocationActive()&&i.isTransientWidget&&t.transformToDataSourceFacets(n,o);var a=s.getPredicateMappingObject(),r=null;e.is(n,"array")&&e.is(n[o])&&e.is(n[o].sixw,"string")&&(r=n[o].sixw.split("/").pop()),a&&a.hasOwnProperty(r)&&(e.is(n[o].object,"array")||(n[o].dispValue=[],n[o].object=[n[o].object]))},this.transformTagsValuesToDataSourceFacets=function(e,n,s,o){!0===t.isContentLocationActive()&&i.isTransientWidget&&t.transformTagsValuesToDataSourceFacets(e,n,s,o)},this.transformAddSubjectsToDataSourceFacets=function(e){!0===t.isContentLocationActive()&&i.isTransientWidget&&t.transformAddSubjectsToDataSourceFacets(e)},this.transformFilterSourceToProject=function(e){if(!0===t.isContentLocationActive()&&i.isTransientWidget&&t.transformFilterSourceToProject(e),"1"===s.getMappingVersion()){var n=e.localfilters,o=e.allfilters;s.transformFilterOnMappedPredicates(o),s.transformFilterOnMappedPredicates(n)}},this.getAvblSource=function(e,n){!0===t.isContentLocationActive()&&(i.isTransientWidget||n)&&t.getAvblSource(e)},this.updateFilter=function(e,n){if(!0===t.isContentLocationActive()&&i.isTransientWidget)return t.updateFilter(e,n)},this}return s.getMappingVersion=function(){return i.getOption("searchTypeOntology")},s.getPredicateMappingObject=function(){var t=null;if("1"===s.getMappingVersion()){var n=i.getOption("predicate_Mapping");e.is(n)&&!0===n.isActive&&(t=n)}return t},s.transformPredicateValuesWithMapping=function(t){var i=s.getPredicateMappingObject();"1"===s.getMappingVersion()&&e.is(i)&&e.is(t)&&t.forEach((function(t){var n=t.sixw.split("/").pop();if(e.is(n)&&(n=n.split("/").pop()),e.is(n)&&!0===i.hasOwnProperty(n)&&e.is(i[n],"object")){var s=t.object;if(i[n].hasOwnProperty(s)){var o=i[n][s];if(e.is(o,"array"))for(var a=0;a<o.length;a++)"$"===o[a]&&(o[a]=s);t.object=o}}}))},s.prepareTransformedFacetValuesToTranslate=function(t,i){var n=s.getPredicateMappingObject();return"1"===s.getMappingVersion()&&e.is(n)&&n.hasOwnProperty(t)&&(i=e.is(i,"array")?i[0]:i.split("/").pop()),i},s.transformNlsForMappedPredicates=function(t){var i=s.getPredicateMappingObject();if("1"===s.getMappingVersion()&&e.is(i))for(var o in t)if(i.hasOwnProperty(o)){var a=null;for(var r in t[o])if(0<r.indexOf("/"))a=r.split("/").pop(),e.is(t[o][a])&&(t[o][r]=t[o][a]);else if(0<r.indexOf(":"))a=r.split(":").pop(),e.is(t[o][a])&&(t[o][r]=t[o][a]);else{var l=n.get(r);e.is(l)&&n.hasOwnProperty(r)&&(t[o][r]=l)}}},s._getAggregatedFacets=function(t,i){var n=[],o=s.getPredicateMappingObject();if("1"===s.getMappingVersion()&&e.is(o)&&o.hasOwnProperty(t)){var a=o[t];for(var r in a){var l=a[r],c=!1;e.is(l,"array")&&l.forEach((function(e){e===i&&(c=!0)})),!0===c&&n.push(r)}}return n},s._buildAdditionalFacetsFromCategory=function(t,i){var n=t.split("/").pop(),o=[];return i.forEach((function(t){var i=[];i.push(t);var a=t.object,r=[];e.is(a)&&s._getAggregatedFacets(n,a).forEach((function(i){var n=e.clone(t);n.object=i,n.disptext=i,r.push(n)}));r.length&&(i=r),o=o.concat(i)})),o},s.transformFilterOnMappedPredicates=function(t){if(e.is(t,"object"))for(var i in t)t[i].forEach((function(t){e.is(t.object,"array")&&(t.object=t.object[t.object.length-1])})),t[i]=s._buildAdditionalFacetsFromCategory(i,t[i])},s})),define("DS/SNResultUX/utils/AdvSearchMgr",["UWA/Core","UWA/Class","UWA/Class/Options","UWA/Class/Debug","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SNVocabAccess","DS/SNInfraUX/SWFiltering","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/SNInfraUX/SNPLMDictionary","DS/SNResultUX/utils/SNResultTypeCustoHelper","DS/SNInfraUX/SearchLogin","DS/SNInfraUX/Api/SearchApi","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/utils/WildcardMgr","DS/SNResultUX/utils/SearchServices","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/SNAdvSearchCusto","DS/SNInfraUX/Logger","DS/SNInfraUX/utils/SNPreferenceUtil","DS/SNInfraUX/utils/SearchNlsUtils"],(function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_,f,m,S,v,w){"use strict";return t.extend(n,i,{name:"DS_SNResultUX_utils_AdvSearchMgr",_status:!1,_dynamicPredicateSetType:[],_dynamicPredicateSetKind:[],_dynamicExtPredicateSetType:[],_otherDataSources:[],_dataSetsForSource:{},_dataSetsForType:null,_dataSetsForExtension:null,_adv_search_field:null,_criteriaData:null,sugBasedQuery:"",_currentDataSource:null,CORE_BASIC_SOURCE:"ds6w:where/ds6w:source/ds6w:dataSource",CORE_BASIC_TYPE:"ds6w:what/ds6w:type",CORE_BASIC_SUBTYPE:"vpmextension",CORE_BASIC_LABEL:"ds6w:what/ds6w:label",CORE_BASIC_IDENTIFIER:"ds6w:what/ds6w:identifier",CORE_BASIC_MODIFIED:"ds6w:when/ds6w:modified",EXT_BASIC_DESCRIPTION:"ds6w:what/ds6w:description",EXT_BASIC_RESPONSIBLE:"ds6w:who/ds6w:responsible",EXT_BASIC_CREATED:"ds6w:when/ds6w:created",BASIC_PREDICATES:null,BASIC_PREDICATES_leaf:null,_resources:null,_service:null,_uniqueDataSource:null,_fieldsToSet:null,_TypesListToSet:null,_incontextFixedPredicates:[],_suggestDisabledPredicates:[],init:function(t){e.is(s.options.search_settings.service,"string")&&(this._service=s.options.search_settings.service),this.setDebugMode(s.getDebugMode()),this.setOptions(t),this._resources=t.resources,o.setResources({resources:this._resources}),l.setResources({resources:t.resources}),this.BASIC_PREDICATES=[this.CORE_BASIC_SOURCE,this.CORE_BASIC_TYPE,this.CORE_BASIC_SUBTYPE,this.CORE_BASIC_LABEL,this.CORE_BASIC_IDENTIFIER,this.CORE_BASIC_MODIFIED,this.EXT_BASIC_DESCRIPTION,this.EXT_BASIC_RESPONSIBLE,this.EXT_BASIC_CREATED],this.BASIC_PREDICATES_leaf=["ds6w:dataSource","ds6w:type","vpmextension","ds6w:label","ds6w:identifier","ds6w:modified","ds6w:description","ds6w:responsible","ds6w:created"],e.is(s.options.search_settings.adv_search_field,"string")&&s.options.search_settings.adv_search_field.length>0&&(this._adv_search_field=s.options.search_settings.adv_search_field),this._getSuggestDisabledPredicates()},destroy:function(){this._dynamicPredicateSetType=null,this._dynamicPredicateSetKind=null,this._dynamicExtPredicateSetType=null,this._otherDataSources=null,this._dataSetsForSource=null,this._dataSetsForType=null,this._dataSetsForExtension=null,this._adv_search_field=null,this._criteriaData=null,this._currentDataSource=null,this.BASIC_PREDICATES=null,this.BASIC_PREDICATES_leaf=null,this._resources=null,this._service=null,this._uniqueDataSource=null,this._fieldsToSet=null,this._TypesListToSet=null,this._incontextFixedPredicates=null,this._suggestDisabledPredicates=null},setStatus:function(e){this._status=e},getStatus:function(){return this._status},addFilter:function(){},clearFilters:function(t){e.is(t)||(t="type+kind",this._dynamicPredicateSetType=[],this._dynamicPredicateSetKind=[],this._dynamicExtPredicateSetType=[]),-1<=t.indexOf("kind")&&(this._dynamicPredicateSetKind=[])},showSourceField:function(){var e=!0,t=this._InContextAdvancedSearch();return t&&!1===t.showSource&&(e=!1),e},getAndDisplayAdvancedSearch:function(){var e=arguments;if(this._isInContextSearch())this.getAndDisplayAdvancedSearchCusto.apply(this,arguments);else{var t=this;m.getCusto(t._resources.getActiveTenant()).then((function(){t._adv_search_field=s.options.search_settings.adv_search_field,t.getAndDisplayAdvancedSearchCusto.apply(t,e)}))}},getAndDisplayAdvancedSearchCusto:function(t,i){var n=this,s=null,o=null,a=this.getOption("tagger_proxy"),r=[];this._incontextFixedPredicates=[];var c,u,h=this._resources.getActiveTenant(),p=function(i){var r;if(e.is(i,"array")){var l,c=[],d={dataSources:i},u=g.getValidDatasourcesWithConfiguration(d);e.is(u)&&(e.is(u.dataSourceNames,"array")&&(c=u.dataSourceNames),e.is(u.otherDataSourceServices,"array")&&(n._otherDataSources=u.otherDataSourceServices));for(var p=0;p<i.length;p++){var _=i[p];if(!0===_.status){var f=_.name;f!==m.getDefaultSelectedSource(h)||e.is(n._adv_search_field,"string")&&n._adv_search_field.length>0?e.is(n._adv_search_field,"string")&&n._adv_search_field.length>0&&(r="3dspace"):r=f}}c=n._filterIncontextSources(c),n._isInContextSearch()||(c=n._filterCustoExcludedSources(c,h)),e.is(n._adv_search_field,"string")&&n._adv_search_field.length>0&&m.getSelectedTypeSource(n._adv_search_field)&&(r=m.getSelectedTypeSource(n._adv_search_field),l=[n._adv_search_field]),o=n._prepareSourcePredicate(c,void 0,{selectedByDefault:r}),n._dataSetsForSource[h]=o,e.is(n)&&e.is(n._service)&&e.is(n._service,"string")&&(n._service=o),n.showSourceField()&&a.updateCriteria([o]),t&&n.displayCriteria(),1===o.options.datasets.items.length&&(r=o.options.datasets.items[0].value),r&&((s={internal:!0,value:[],typeSelectedByDefault:l}).sixw=n.CORE_BASIC_SOURCE,s.value[0]=r,setTimeout((function(){n.handleCriteriaChange(s),t&&n.displayCriteria()}),500))}};(o=n._dataSetsForSource[h],e.is(o))?(n.showSourceField()&&r.push(o),this._adv_search_field?m.getSelectedTypeSource(this._adv_search_field)&&(c=m.getSelectedTypeSource(this._adv_search_field),u=[this._adv_search_field]):(c=m.getDefaultSelectedSource(h),u=m.getTypesSelectedByDefault(c)),c||e.is(this._dataSetsForSource)&&e.is(this._dataSetsForSource.options)&&e.is(this._dataSetsForSource.options.datasets)&&e.is(this._dataSetsForSource.options.datasets.items,"array")&&1===o.options.datasets.items.length&&(c=o.options.datasets.items[0].value),c&&(this._currentDataSource!==c&&(e.is(this._dataSetsForSource)&&e.is(this._dataSetsForSource.options)&&e.is(this._dataSetsForSource.options.datasets)&&e.is(this._dataSetsForSource.options.datasets.items)&&this._dataSetsForSource.options.datasets.items.length>1&&this._dataSetsForSource.options.datasets.items.forEach((function(e){e.value===c?e.predefined=!0:e.predefined=!1})),this.showSourceField()&&a.updateCriteria([this._dataSetsForSource])),(s={internal:!0,value:[],typeSelectedByDefault:u}).sixw=n.CORE_BASIC_SOURCE,s.value[0]=c,setTimeout((function(){n.handleCriteriaChange(s),t&&n.displayCriteria()}),500))):(o=this._prepareSourcePredicate([]),this._dataSetsForSource[h]=o,n.showSourceField()&&r.push(o),d.login({resources:n._resources,onComplete:p,onFailure:p}));r.push(t?this._prepareTypePredicates({typesList:[],options:i}):n._dataSetsForType),this._isExtensionAvailable()&&r.push(t?this._prepareSubTypePredicates({subTypesList:[]}):n._dataSetsForExtension),r=(r=(r=(r=(r=r.concat(this._getCoreBasicPredicates())).concat(this._getExtendedBasics())).concat(this._dynamicPredicateSetType)).concat(this._dynamicPredicateSetKind)).concat(this._dynamicExtPredicateSetType),this._fieldsToSet=r,a.setCriteria(r);var _=this;if(t&&n._isInContextSearch()&&((s={internal:!0,value:["3dspace"]}).sixw=this.CORE_BASIC_SOURCE,e.is(_._dataSetsForSource)&&e.is(_._dataSetsForSource.options)&&e.is(_._dataSetsForSource.options.datasets)&&e.is(_._dataSetsForSource.options.datasets.items)&&1==_._dataSetsForSource.options.datasets.items.length)){let t=_._dataSetsForSource.options.datasets.items;e.is(t[0])&&e.is(t[0].value)&&t[0].value.length>0&&(s.value=[t[0].value]),setTimeout((function(){_.handleCriteriaChange(s),n.displayCriteria()}),1e3)}t&&n.displayCriteria(),l.loadDictionary(),this._InContextAdvancedSearch()&&this._getIncontextCommonPredicates((function(e){_._incontextFixedPredicates=[],e.forEach((function(e){_._incontextFixedPredicates.push(e.sixw)})),a.updateCriteria(e)}))},displayCriteria:function(t){let i=this.getOption("tagger_proxy"),n=this.getOption("collection"),s=e.is(n)&&n._isPinnedWidget(),o=g.getCurrentSearchWidget(this.getOption("widget_id"));var a;o&&(a=o.getValue("launch_mode")),"from_compass_transient"!==a&&!s&&g.getSidePanelTaggerContextPromise()?g.getSidePanelTaggerContextPromise().then((function(){i.displayCriteria(t)})):i.displayCriteria(t)},_isExtensionAvailable:function(){return a.isAVisiblePredicate("ds6w:kind")&&this.showInContextExtension()},getAndDisplayAdvancedSearchWithProxyFilterSettings:function(){var e=this;setTimeout((function(){e.displayCriteria()}),100)},hideAdvancedSearchTab:function(){var e=this.getOption("tagger_proxy");e.setCriteria([]),!0===e.getDisplayStatus()&&this.displayCriteria(!1)},_internalTypeSelection:function(t){var i=null,n=this._getAdvancedSearchSelection();if(n){var s=n.selection;if(s){var o=s["ds6w:type"];if(i={internal:!0,sixw:"ds6w:what/ds6w:type",value:[]},e.is(o,"array")&&o.length>0){i.value.push(o[0]),s.vpmextension&&(i.subTypesListSelected=s.vpmextension),this.handleCriteriaChange(i);for(let e=1;e<o.length;e++)i.value.push(o[e])}i.value.length>1&&this.handleCriteriaChange(i);var a=this.getOption("tagger_proxy");a.toggleDisplayAllCriteria&&!0===n.inContext&&a.toggleDisplayAllCriteria(!0)}}else if(!this._isInContextSearch()){var r=m.getTypesSelectedByDefault(t?t.source:null);if(t&&t.typeSelectedByDefault&&(r=t.typeSelectedByDefault),i={internal:!0,sixw:"ds6w:what/ds6w:type",value:[]},e.is(r,"array")&&r.length>0){i.value.push(r[0]);var l=m.getInterfacesSelectedByDefault(r[0]);i.subTypesListSelected=l,this.handleCriteriaChange(i);for(let e=1;e<r.length;e++)i.value.push(r[e])}i.value.length>1&&this.handleCriteriaChange(i)}},_internalSubtypeSelection:function(t){if(e.is(t,"array")&&1===t.length){var i={internal:!0,sixw:"void/vpmextension",value:t};this.handleCriteriaChange(i)}},handleCriteriaChange:function(t){this._criteriaData=t;var i=this,n=this.getOption("tagger_proxy"),s=i._resources.getActiveTenant();if(e.is(t)){var a=t.sixw.split("/").pop();if("ds6w:dataSource"===a){var r=t.value;if(UWA.is(r)&&UWA.is(r.length)&&r.length>0){var l;"other"!==r[0]&&(l=o.getVocabularyName(r[0])),this._currentDataSource=r[0];var c,u,p=[],_=this,v=i._InContextAdvancedSearch(),w=i._getAdvancedSearchSelection();if(!w||w.inContext&&!0===w.inContext||(v=w),v&&(c=v["ds6w:type"]),v&&v.selection&&t.internal&&(u=v.selection["ds6w:type"]),e.is(c,"array")){var b=o.getVocabularyClasses(l);if(b){var C=i.getIncontextTypeList(b);p=p.concat(i._prepareTypePredicates({typesList:C,typesListSelected:u})),n.updateCriteria(p)}else{var y=[];c.forEach((function(e){var t={value:e.uri.split(":")[1],source:[d.getServiceFromSource(r[0])]};y.push(t)})),h.getNlsOfPropertiesValuesBySource({"ds6w:type":y},{tenantId:s,lang:g.getLanguage(),TagURL6WId:h._6WTagURL,onComplete:function(e){var t=e["ds6w:type"],s=[];c.forEach((function(e){var i=e.uri.split(":")[1];s.push({uri:e.uri,nlsName:t[i]})})),s=i._sortByKey(s,"nlsName"),p=p.concat(i._prepareTypePredicates({typesList:s,typesListSelected:u})),n.updateCriteria(p)}})}}else if("other"===r[0])o.loadVocabularyClasses({vocabId:"other",rdfSources:i._otherDataSources},(function(e){p=p.concat(i._prepareTypePredicates({typesList:e.classInfos,vocabId:l,typesListSelected:u})),i._TypesListToSet=p,n.updateCriteria(p)}));else{var D={vocabId:l,source:r[0],tenantId:s};t.typeSelectedByDefault?D.typeSelectedByDefault=t.typeSelectedByDefault:t.internal||(D.typeSelectedByDefault=[]),D.onComplete=function(e){p=p.concat(e),i._TypesListToSet=p,n.updateCriteria(p),_._internalTypeSelection(D)},D.onFailure=function(){1==r.length&&o.loadVocabularyClasses({vocabId:l},(function(e){p=p.concat(i._prepareTypePredicates({typesList:e.classInfos,vocabId:l,typesListSelected:u})),i._TypesListToSet=p,n.updateCriteria(p),u&&_._internalTypeSelection(D)}))},_._prepareTypePredicatesFromCusto(D)}}else{var I=[];if(e.is(i)&&e.is(i._service)&&null!==i._service){if(I=i._service,n.updateCriteria([I]),e.is(i._service.options)&&e.is(i._service.options.datasets)&&e.is(i._service.options.datasets.items)&&1===i._service.options.datasets.items.length){let e={value:[]};e.sixw=i.CORE_BASIC_SOURCE,e.value[0]=i._service.options.datasets.items[0].value,setTimeout((function(){i.handleCriteriaChange(e)}),500)}}else I.push(this._prepareTypePredicates({typesList:[]})),n.updateCriteria(I);if(i._isExtensionAvailable()){var T=[];T.push(i._prepareSubTypePredicates({subTypesList:[]})),n.updateCriteria(T)}}var A=i._dynamicPredicateSetType;A=A.concat(i._dynamicPredicateSetKind).concat(i._dynamicExtPredicateSetType),n.removeCriteria(A),i.clearFilters("type+kind")}else if("ds6w:type"===a){let a=t.value;if(1===a.length){i._dynamicExtPredicateSetType=[];let r=i._getServiceName(i._currentDataSource);if(o.loadRelevantPredicates({className:a[0],serviceName:r},(function(o){i._loadPLMDictionaryAndRun((function(){var r,l,c=i.getOption("collection");if(l=e.is(c)&&e.is(c._ctx_options)&&e.is(c._ctx_options.app_socket_id)&&"socket_id_#saved_search_edit#"===c._ctx_options.app_socket_id&&e.is(c._ctx_options.advanced_search),i._isInContextSearch()&&!l||(r=m.getPredicatePreferredPosition(a[0],s)),!i._isInContextSearch()||l)var d=m.getExcludedPredicatesForType(a[0],s);let u=i._prepareRelevantPredicates({dataPredicates:o.vocabularyPredicateInfo,excludedPredicates:d,pswitch:!1,type:a[0],internal:t.internal,preferredPosition:r,exclusiveTaxonomies:m.isExclusiveTaxonomies(s)});if(e.is(u,"array"))i._dynamicPredicateSetType=u,u=i._sortByKey(u,"dispValue");else{var h=u.preferredPredicates;u=u.relevantPredicates,u=i._sortByKey(u,"dispValue"),n.removeCriteria(i._getExtendedBasics()),i._dynamicPredicateSetType=h.concat(u),u=(h=h.concat(i._getExtendedBasics())).concat(u)}n.updateCriteria(u)}))})),i._isExtensionAvailable()){a=t.value;var x={};x.tenantId=s,r=i._getServiceName(i._currentDataSource),x.currentDataSource=r,x.className=a[0],o.loadRelevantInterfaces(x,(function(o){for(var a=[],r="",l=[],c=0;c<o.interfaces.length;c++)e.is(o.interfaces[c].automatic)&&"Yes"===o.interfaces[c].automatic||e.is(o.interfaces[c].Automatic)&&"Yes"===o.interfaces[c].Automatic?r=r.concat("ds6wg:",o.interfaces[c].name,","):l.push(o.interfaces[c]);var d,u=t.subTypesListSelected,h=l;i._InContextAdvancedSearch()&&(h=i.getIncontextSubtypeList(x.className,h)),i._isInContextSearch()||(t.internal&&(u=m.getInterfacesSelectedByDefault(x.className,s)),d=m.getInterfacePreferredPosition(x.className,s)),a.push(i._prepareSubTypePredicates({subTypesList:h,subTypesListSelected:u,preferredPosition:d,exclusiveTaxonomies:m.isExclusiveTaxonomies(s)})),n.updateCriteria(a),t.subTypesListSelected&&i._internalSubtypeSelection(t.subTypesListSelected)}))}}else if(a.length>1)f._asyncCallToPredicatesWS(a).then((function(e){n.removeCriteria(i._dynamicPredicatesPreferred),n.removeCriteria(i._dynamicExtPredicateSetType),n.removeCriteria(i._dynamicPredicateSetType),i._clearExtensionList(),i._dynamicPredicateSetKind=[],i._dynamicPredicateSetType=[],i._loadPLMDictionaryAndRun((function(){e.classPredicates.forEach((function(e){var t;i._isInContextSearch()||(t=m.getExcludedPredicatesForType(e.className,s));let n=i._prepareRelevantPredicates({dataPredicates:e.vocabularyPredicateInfo,pswitch:!1,excludedPredicates:t,type:e.className});-1===e.className.indexOf("ds6wg:XP_")&&(i._dynamicPredicateSetType.length>0?i._dynamicPredicateSetType=i.intersect_safe(i._dynamicPredicateSetType,n):i._dynamicPredicateSetType=n)})),i._dynamicPredicateSetType=i._sortByKey(i._dynamicPredicateSetType,"dispValue"),n.updateCriteria(i._dynamicPredicateSetType)}))}),(function(){S.log("promisePredicate fail !")}));else if(0===a.length){var N=[];if(N=N.concat(i._dynamicPredicateSetType),i._isExtensionAvailable()){var E=[];E.push(this._prepareSubTypePredicates({subTypesList:[]})),n.updateCriteria(E),N=N.concat(i._dynamicPredicateSetKind)}n.removeCriteria(N.concat(i._dynamicExtPredicateSetType)),i._dynamicPredicateSetType=[],i._dynamicExtPredicateSetType=[],i.clearFilters("type+kind"),i._adv_search_field=null}}else if(a===i.CORE_BASIC_SUBTYPE){var O=t.value;let e=i._getServiceName(i._currentDataSource);1===O.length?o.loadRelevantPredicates({className:O[0],serviceName:e},(function(e){i._loadPLMDictionaryAndRun((function(){for(var s=i._prepareRelevantPredicates({dataPredicates:e.vocabularyPredicateInfo,pswitch:!1,internal:t.internal}),o=s,a=0;a<o.length;a++)for(var r=0;r<i._dynamicPredicateSetType.length;r++)i._dynamicPredicateSetType[r].dispValue===o[a].dispValue&&o.splice(a>0?a--:0,1);i._dynamicPredicateSetKind=o,n.updateCriteria(s)}))})):(n.removeCriteria(i._dynamicPredicateSetKind),i.clearFilters("kind"))}}},handleCriteriaModified:function(t,i,n){let o=this;this.sugBasedQuery=i;let a=this.getOption("tagger_proxy");if(t&&t.length>0){let i="sixw:ds6w:where/ds6w:source/ds6w:dataSource",c=e.is(n)&&n.allfilters&&n.allfilters[i]&&n.allfilters[i][0]&&n.allfilters[i][0].object;c="other"===c?this._getOtherRDFDataSources():e.is(c)?[c]:o._getAvailableDataSources();var l=new Date;let d={query:t,source:c,select_predicate:[],label:"3DSearch-"+g.getUserId()+"-"+s.getOption("fedsearch_query_label.feature_id.AdvancedSearchEstimation")+"-"+l.getTime(),specific_source_parameter:{},service_name:"fed_search",original_options:{},state:{}};d.service_data=d;let h=o._resources.getFetchOptions(d),p=u.getSearchInfo(h.data);p&&p.then((e=>{1==(e&&e.estimated)?a.setInfoMessage({type:"info",message:r.get("adv_search_broadQueryWarningMessage")}):a.clearInfoMessage()})).catch((e=>{a.clearInfoMessage()}))}else a.clearInfoMessage()},_clearExtensionList:function(){var e=this.getOption("tagger_proxy");if(this._isExtensionAvailable()){var t=[];t.push(this._prepareSubTypePredicates({subTypesList:[]})),e.updateCriteria(t),e.removeCriteria(this._dynamicPredicateSetKind)}},_sortByKey:function(e,t){return e.sort((function(e,i){var n=e[t],s=i[t];return n<s?-1:n>s?1:0}))},_sortByKeyDesc:function(e,t){return e.sort((function(e,i){var n=e[t],s=i[t];return n>s?-1:n<s?1:0}))},intersect_safe:function(t,i){for(var n=[],s=0,o=t.length;s<o;s++)for(var a=0,r=i.length;a<r;a++)if(e.is(t[s].sixw)&&t[s].sixw===i[a].sixw){n.push(t[s]);break}return n},handlePLMCriteriaChange:function(t){if(!e.is(t)||!e.is(t.PLMTitle))throw new Error("Invalid Arg in AdvSearchMgr.handlePLMCriteriaChange!");var i=this,n=this.getOption("tagger_proxy");o.loadPLMSuggestList(t.PLMTitle,(function(e){var t=i._preparePLMParamData(e);n.updatePLMSuggestions(t)}))},handleTypeSuggestListChange:function(t){var i=this.getOption("tagger_proxy");if(i){var n=this,a=s.getOption("SUGGEST_ON_ADVANCEDSEARCH"),r=s.getOption("NLSInputAdvSearchFields"),l=s.getOption("NLSMapping_3DSearch_Suggest_TACTICALOnly"),c=t.suggestField,d=r.includes(t.suggestField)||s.getOption("FUN142446"),u=!1;if(s.getOption("AdvSearchSugMBCSSupport")){var h=s.getOption("MBCSRanges")||{};h=Object.values(h);let i="";for(var _=0;_<h.length;_++)0!==_&&(i+="|"),e.is(h[_],"object")?i+="[\\"+h[_].from+"-\\"+h[_].to+"]":i+="\\"+h[_];(h=new RegExp(i)).test(t.suggestTitle)&&(u=!0)}var f=s.getOption("AdvSearchSugMinChar");if((!e.is(l)||e.is(l)&&"None"!==l[c])&&a&&e.is(t)&&e.is(t.suggestField)&&e.is(t.suggestTitle)&&(t.suggestTitle.length>=f||u)){var m="";m=this.sugBasedQuery,e.is(l)&&l.hasOwnProperty(c)?e.is(l[c],"string")&&0===l[c].indexOf("ds6wg:")?(c=l[c],m=m.length>0?m.concat(" AND [",c,"]:(*",t.suggestTitle,"*)"):m.concat("[",c,"]:(*",t.suggestTitle,"*)"),n._InContextAdvancedSearch()&&e.is(n._InContextPrecondition())&&n._InContextPrecondition().trim().length>0&&(m=m.concat(" AND ").concat(n._InContextPrecondition().trim()))):e.is(l[c])&&e.is(l[c].PQToUse,"string")&&e.is(l[c].attributeToRead,"string")&&(m="3dexp"+l[c].PQToUse+":(*"+t.suggestTitle+"*)",c=l[c].attributeToRead):(d||(m=(n._currentDataSource,m.length>0?m.concat(" AND [",c,"]:(*",t.suggestTitle,"*)"):m.concat("[",c,"]:(*",t.suggestTitle,"*)"))),n._InContextAdvancedSearch()&&e.is(n._InContextPrecondition())&&n._InContextPrecondition().trim().length>0&&(m=m.concat(" AND ").concat(n._InContextPrecondition().trim()))),m="("+m+")",m=p.manageWildcardAddtion(m);var S,v=new Date;S="3DSearch-"+g.getUserId()+"-"+s.getOption("fedsearch_query_label.feature_id.AdvancedSearchSuggestion")+"-"+v.getTime();var w=s.getOption("topbar_search_banned_list"),b=e.is(w)?w.types:[],C={additional_query:e.is(n._createBannedTypeQuery(b))?n._createBannedTypeQuery(b):""},y={},D=e.is(n._currentDataSource)?n._currentDataSource:"3dspace";let a=[];a="other"===n._currentDataSource?this._getOtherRDFDataSources():e.is(n._currentDataSource)?[n._currentDataSource]:n._getAvailableDataSources(),y[D]=C;var I={with_indexing_date:!0,with_nls:!1,query:m,refine:{},order_field:"relevance",order_by:"desc",specific_source_parameter:y,select_predicate:[c],label:S,source:a};"ds6w:status"==c&&I.select_predicate.push("ds6w:policy"),"3dspace"!==n._currentDataSource?(I.with_indexing_date=!0,I.with_nls=!1):I.select_synthesis=I.select_predicate,o.loadSearchSuggestList(I,(function(e){n._prepareSearchSuggestData(t,e,d).then((function(e){i.updateSuggestions(e)}))}),(function(){i.updateSuggestions({datasets:{items:[]},suggestField:t.suggestField})}))}else i.updateSuggestions({datasets:{items:[]},suggestField:t.suggestField})}},_createBannedTypeQuery:function(t){var i="";if(e.is(t,"array")&&t.length>0){i+=" AND NOT (flattenedtaxonomies:(";for(var n=0;n<t.length;n++)i+='"types/'+t[n]+'"',n<t.length-1&&(i+=" OR ");i+="))"}return i},_getAvailableDataSources:function(){var t=this._resources.getActiveTenant(),i=[];if(e.is(this._dataSetsForSource)){var n=this._dataSetsForSource[t];e.is(n)&&e.is(n.options)&&e.is(n.options.datasets)&&e.is(n.options.datasets.items)&&n.options.datasets.items.length>1&&n.options.datasets.items.forEach((function(t){e.is(t.value)&&i.push(t.value)}))}return 0===i.length?["3dspace"]:i},_getOtherRDFDataSources:function(){var t=[],i=d.getAvailableSources(this._resources.getActiveTenant());if(e.is(s.getOption("RDFDataSources"))){var n=Object.keys(s.getOption("RDFDataSources"));e.is(n,"array")&&n.length>0&&(i=i.filter((function(e){return-1<n.indexOf(e.name)&&!0===e.status}))).forEach((function(e){t.push(e.name)}))}return t},_prepareSearchSuggestData:function(t,i,n){var o=[],a=this,r=t.suggestField;let l=[];var c={suggestField:r,datasets:{name:r,items:o}},d=s.getOption("NLSMapping_3DSearch_Suggest_TACTICALOnly");return e.is(d)&&d.hasOwnProperty(r)&&(e.is(d[r],"string")&&0===d[r].indexOf("ds6wg:")?r=d[r]:e.is(d[r])&&e.is(d[r].PQToUse,"string")&&e.is(d[r].attributeToRead,"string")&&(r=d[r].attributeToRead)),new Promise((function(s,d){if(e.is(i)&&e.is(i.results)&&i.results.length>0){let t=i.results.length>9?10:i.results.length,n=[];for(let e=0;e<t;e++){let t=i.results[e];for(var u=0;u<t.attributes.length;u++){var h=t.attributes[u];"internal"!==h.format&&("attribute"===h.format&&r===h.name&&l.push(h))}}let s="",a="";for(let t of l)if(a=t.value,s=t.dispValue,-1===n.indexOf(a)&&-1===n.indexOf(s)){e.is(a)?n.push(a):n.push(s);let i={value:a||s,label:s||a,type:t.type};o.push(i)}}if(e.is(i)&&e.is(i.facets)&&i.facets.length>0){for(var g=i.facets,p=[],_=0;_<g.length;_++){var f=g[_];if(e.is(f.sixw)){let e=f.sixw.split("/").pop();(e==t.suggestField||"ds6w:policy"==e&&"ds6w:status"==r)&&(f.sixw_leaf=e,p.push(f))}}var m=function(){var e=a._sortByKeyDesc(p,"count");let i=[];for(let s=0;s<e.length;s++){let a=e[s],l=a.dispValue||a.object;if(-1===i.indexOf(l)&&a.sixw_leaf==r&&(!n||l.toUpperCase().includes(t.suggestTitle.toUpperCase()))){i.push(l);let e={value:a.object||a.dispValue,label:l,type:a.type};o.push(e)}}s(c)};if(n){let e={facets:p,tenantId:a._resources.getActiveTenant(),onComplete:m,onFailure:m};w.translateFacets(e)}else m()}else s(c)}))},_preparePLMParamData:function(t){var i=[],n=!1,o={name:t.plmtitle,items:i,hasMore:n},a=g.getLanguage(),r=s.getOption("PLMParamNLS");if(e.is(t)&&e.is(t.info)&&t.info.length>0){var l=t.info.length;l>100&&(n=!0);for(var c=0;c<l;c++){for(var d,u,h,p,_=t.info[c],f=null,m=0;m<_.attributes.length;m++){var S=_.attributes[m];if("internal"!==S.format)if("attribute"===S.format&&"plmparam.title"===S.name)f=S.value;else if(e.is(r,"object")&&e.is(r[a],"string")&&"attribute"===S.format&&S.name===r[a])d=S.value;else if("attribute"===S.format&&"plmparam.itf"===S.name){var v=S.value.substring(0,S.value.length-9);h=S.value,e.is(v)&&(u="String"===v?"string":"Real"===v?"double":"Integer"===v?"integer":"Boolean"===v?"boolean":"double")}else"attribute"===S.format&&"plmparam.displayunit"===S.name&&(p=S.value)}var w={};w=null==p?{value:d||f,subLabel:h,type:u,title:f}:{value:d||f,subLabel:h,type:u,unit:p,title:f},i.push(w)}}return o},_getSuggestDisabledPredicates:function(){var t=s.getOption("NLSMapping_3DSearch_Suggest_TACTICALOnly");for(var i in t)e.is(t[i],"string")&&"none"===t[i].toLowerCase()&&this._suggestDisabledPredicates.push(i)},convertPLMParamUnits:function(t,i){if(e.is(t)&&e.is(t.plmparam)&&e.is(t.plmparam.double)){var n=t.plmparam.double,s={Data:[]},o=[];for(var a in n){var r=a,c=n[a].interface,d=c.substring(0,c.length-9),u=n[a].unit,h=l.getMKSNLSNameForDimension(d),g=n[a];if(delete g.unit,e.is(u)&&u!==l.getMKSNLSLableNameForDimension(d))for(var p in g)if("interface"!==p){var _=g[p],f=r.concat(".").concat(p);for(var m in _){var S={address:null,value:null},v={UnitFrom:u,UnitTo:h,Dimension:d,Values:_[m]};s.Data.push(v),S.address=f.concat(".").concat(m),S.value=_[m],o.push(S)}}}l.loadConvertedMKSValues(s,(function(e){for(var n=t.plmparam.double,s=0;s<e.length;s++){var a=o[s].address,r=a.split("."),l=r[r.length-2],c=r[r.length-1];n[a.substring(0,a.length-c.length-l.length-2)][l][c]=parseFloat(e[s].ConvertedValues)}i&&i(t)}))}},_prepareFTSFieldPredicate:function(){return{dispValue:r.get("adv_search.ftsfield"),sixw:"fts_value",type:"string",options:{showByDefault:!0}}},_prepareSourcePredicate:function(t,i,n){var s=[];if(e.is(t)){t=_.filterSourceList(t);for(var o=0;o<t.length;o++){var a={value:t[o],label:r.get("adv_search.source."+t[o])};(1===t.length||n&&n.selectedByDefault===a.value)&&(a.predefined=!0),s.push(a)}}var l={dispValue:r.get("adv_search.dataSource"),sixw:this.CORE_BASIC_SOURCE,type:i?"string":"enum",options:{multiSelect:!1,disabled:!(s.length>1)&&!i,placeholder:s.length?r.get("adv_search.dataSource.message"):r.get("adv_search.dataSource.noSourceMessage"),noResultsMessage:r.get("adv_search.dataSource.noSourceMessage"),onCriterionSelectEvent:!0,allowFreeInput:!1,showSuggestsOnFocus:!0,datasets:{name:"Sources",items:s},showByDefault:!0,informOnCriteriaModification:!0}};return this._dataSetsForSource=l,l},_prepareTypePredicates:function(t){var i=t.typesList,n=t.toAllowEdit,s=t.typesListSelected||[],o=t.preferredPosition||{},a=t.excludedTypes||[],l=0,c=[],d=Object.keys(o).length,u=new Array(d);if(e.is(i)){var h={},g=!1;for(l=0;l<i.length;l++){var p=i[l].nlsName,_=i[l].name,f=i[l].uri;if(!(a.indexOf(f)>=0)){e.is(p)||(p=r.get("adv_search.rdfclass."+i[l].uri));var m={value:i[l].uri,label:p};(e.is(t)&&e.is(t.options)&&e.is(t.options.adv_search_field)&&e.is(t.options.adv_search_field,"string")||e.is(this._adv_search_field)&&e.is(this._adv_search_field,"string"))&&(!e.is(_)||this._adv_search_field!==_&&t.adv_search_field!==_||(m.predefined=!0)),s.indexOf(f)>=0&&(m.predefined=!0),e.is(o[f])?u.splice(o[f],1,m):t.exclusiveTaxonomies||c.push(m),e.is(h[p])?(h[p]=!0,g=!0):h[p]=!1}}if(!0===g)for(l=0;l<c.length;l++)!0===h[c[l].label]&&(S.warn("Duplicate NLS value (="+c[l].label+") for type "+c[l].value),c[l].label+=" ("+c[l].value+")")}c=u.concat(c);var v={dispValue:r.get("adv_search.type"),sixw:this.CORE_BASIC_TYPE,type:n?"string":"enum",multiSelect:!0,options:{multiSelect:!0,disabled:!c.length&&!n,placeholder:c.length?r.get("adv_search.type.message"):r.get("adv_search.type.noTypeMessage"),noResultsMessage:r.get("adv_search.type.noTypeMessage"),onCriterionSelectEvent:!0,allowFreeInput:!1,showSuggestsOnFocus:!0,datasets:{name:"Types",items:c},showByDefault:!0,informOnCriteriaModification:!0}};return this._dataSetsForType=v,v},_prepareSubTypePredicates:function(t){var i=t.subTypesList,n=t.toAllowEdit,s=t.subTypesListSelected||[],o=t.preferredPosition||{},a=[],l=Object.keys(o).length,c=new Array(l);if(e.is(i))for(var d=0;d<i.length;d++){var u={value:i[d].name,label:i[d].nlsName};(s.indexOf(u.value)>=0||s.indexOf(i[d].name)>=0)&&(u.predefined=!0),e.is(o[i[d].name])?c.splice(o[i[d].name],1,u):t.exclusiveTaxonomies||a.push(u)}a=c.concat(a);var h={dispValue:r.get("adv_search.subtype"),sixw:this.CORE_BASIC_SUBTYPE,type:n?"string":"enum",multiSelect:!0,options:{multiSelect:!0,disabled:!a.length&&!n,placeholder:a.length?r.get("adv_search.subtype.message"):r.get("adv_search.subtype.noSubTypeMessage"),noResultsMessage:r.get("adv_search.subtype.noSubTypeMessage"),onCriterionSelectEvent:!0,allowFreeInput:!1,showSuggestsOnFocus:!0,datasets:{name:"SubTypes",items:a},showByDefault:!0,informOnCriteriaModification:!0}};return this._dataSetsForExtension=h,h},_prepareRelevantPredicates:function(t){var i=t.dataPredicates,n=t.pswitch,s=t.type,o=t.internal,r=t.skip_basics,c=t.preferredPosition?t.preferredPosition:{},d=t.excludedPredicates,u=g.isFUN072117Active(),h=function(t){var i="";if(t.dimension&&0!==t.dimension.trim().length){var n=v.getPreferenceUnitForDimension(t.dimension.trim());i=u&&e.is(n)?n.unitSymbol:u&&t.manipulationUnit&&t.manipulationUnit.trim().length>0?l.getUnitNLSForDimension(t.dimension,t.manipulationUnit.trim()):l.getMKSNLSForDimension(t.dimension)}return i},p=[],_=Object.keys(c).length,f=new Array(_);if(e.is(i)){i=this.getIncontextPredicateList(s,i);for(var m=0;m<i.length;m++)if(e.is(i[m].uri)&&(!e.is(d,"array")||!d.includes(i[m].uri))&&a.isAVisiblePredicate(i[m].uri)){var w=e.is(i[m].uri)?i[m].uri:i[m].lineage;if(!1===r||-1===this._incontextFixedPredicates.indexOf(w)&&-1===this.BASIC_PREDICATES.indexOf(w)&&-1===this.BASIC_PREDICATES_leaf.indexOf(w)){var b;if(i[m].rangeValues&&(e.is(i[m].range)&&e.is(i[m].range.dataTypes)||e.is(i[m].type))&&("string"===g._getPredicateTypeFromDataType(i[m])||"boolean"===g._getPredicateTypeFromDataType(i[m])))b=this._prepareRangePredicate(i[m],!1!==i[m].showByDefault&&n,o);else{i[m].nlsName&&i[m].uri&&g._getPredicateTypeFromDataType(i[m])||S.debug("nlsName/uri/type - one of these are undefined"),b={dispValue:i[m].nlsName,sixw:e.is(i[m].uri)?i[m].uri:i[m].lineage,type:g._getPredicateTypeFromDataType(i[m]),options:{showByDefault:!1!==i[m].showByDefault&&n,informOnCriteriaModification:!0},allowSuggestions:-1===this._suggestDisabledPredicates.indexOf(i[m].uri)};let t=h(i[m]);if(e.is(t,"string")&&t.length>0&&(b.unit=t),o){var C=this._getIncontextSelectedPredicateValue(b.sixw);C&&("string"===b.type?b.options.defaultValue=C:b.options.defaultValue=C[0])}}e.is(c[b.sixw])?(b.options.showByDefault=!0,f.splice(c[b.sixw],1,b)):p.push(b)}}}for(var y=f.length-1;y>=0;y--)f[y]||f.splice(y,1);return f.length>0&&(p={preferredPredicates:f,relevantPredicates:p}),p},_prepareRangePredicate:function(t,i,n){var s=[],o=this._getIncontextSelectedPredicateValue(t.uri);return t&&t.rangeValues&&t.rangeValues.literalInfo&&t.rangeValues.literalInfo.forEach((function(t){if("0"===t.value&&"0"===t.nlsValue||e.is(t.value)&&t.value.trim().length<1);else{var i={value:"enum|"+t.value,label:t.nlsValue};n&&o&&o.indexOf(i.value)>=0&&(i.predefined=!0),s.push(i)}})),{dispValue:t.nlsName,sixw:e.is(t.uri)?t.uri:t.lineage,type:"string",options:{disabled:!1,multiSelect:!0,datasets:{name:"ranges",items:s},onCriterionSelectEvent:!0,allowFreeInput:!1,showSuggestsOnFocus:!0,informOnCriteriaModification:!0,showByDefault:i}}},_getCoreBasicPredicates:function(){var t,i,n=[];if(a.isAVisiblePredicate("ds6w:label")&&(i=this._isIncontextBasicAvailable({uri:"ds6w:label",showByDefault:!0})).available){var s={dispValue:r.get("adv_search.label"),sixw:this.CORE_BASIC_LABEL,type:"string",options:{showByDefault:i.showByDefault,informOnCriteriaModification:!0},allowSuggestions:-1===this._suggestDisabledPredicates.indexOf("ds6w:label")};t=this._getIncontextSelectedPredicateValue("ds6w:label"),e.is(t,"array")&&t.length>0&&(s.options.defaultValue=t),n.push(s)}if(a.isAVisiblePredicate("ds6w:identifier")&&(i=this._isIncontextBasicAvailable({uri:"ds6w:identifier",showByDefault:!0})).available){var o={dispValue:r.get("adv_search.identifier"),sixw:this.CORE_BASIC_IDENTIFIER,type:"string",options:{showByDefault:i.showByDefault,informOnCriteriaModification:!0},allowSuggestions:-1===this._suggestDisabledPredicates.indexOf("ds6w:identifier")};t=this._getIncontextSelectedPredicateValue("ds6w:identifier"),e.is(t,"array")&&t.length>0&&(o.options.defaultValue=t),n.push(o)}if(a.isAVisiblePredicate("ds6w:modified")&&(i=this._isIncontextBasicAvailable({uri:"ds6w:modified",showByDefault:!0})).available){var l={dispValue:r.get("adv_search.modified"),sixw:this.CORE_BASIC_MODIFIED,type:"date",options:{showByDefault:i.showByDefault,informOnCriteriaModification:!0}};t=this._getIncontextSelectedPredicateValue("ds6w:modified"),e.is(t,"array")&&t.length>0&&(l.options.defaultValue=t[0]),n.push(l)}return n},_getExtendedBasics:function(){var t,i,n=[];if(a.isAVisiblePredicate("ds6w:description")&&(i=this._isIncontextBasicAvailable({uri:"ds6w:description",showByDefault:!1})).available){var s={dispValue:r.get("adv_search.description"),sixw:this.EXT_BASIC_DESCRIPTION,type:"string",options:{showByDefault:i.showByDefault,informOnCriteriaModification:!0},allowSuggestions:-1===this._suggestDisabledPredicates.indexOf("ds6w:description")};t=this._getIncontextSelectedPredicateValue("ds6w:description"),e.is(t,"array")&&t.length>0&&(s.options.defaultValue=t),n.push(s)}if(a.isAVisiblePredicate("ds6w:responsible")&&(i=this._isIncontextBasicAvailable({uri:"ds6w:responsible",showByDefault:!1})).available){var o={dispValue:r.get("adv_search.responsible"),sixw:this.EXT_BASIC_RESPONSIBLE,type:"string",options:{showByDefault:i.showByDefault,informOnCriteriaModification:!0},allowSuggestions:-1===this._suggestDisabledPredicates.indexOf("ds6w:responsible")};t=this._getIncontextSelectedPredicateValue("ds6w:responsible"),e.is(t,"array")&&t.length>0&&(o.options.defaultValue=t),n.push(o)}if(a.isAVisiblePredicate("ds6w:created")&&(i=this._isIncontextBasicAvailable({uri:"ds6w:created",showByDefault:!1})).available){var l={dispValue:r.get("adv_search.created"),sixw:this.EXT_BASIC_CREATED,type:"date",options:{showByDefault:i.showByDefault,informOnCriteriaModification:!0}};t=this._getIncontextSelectedPredicateValue("ds6w:created"),e.is(t,"array")&&t.length>0&&(l.options.defaultValue=t[0]),n.push(l)}return n},_getIncontextCommonPredicates:function(t){var i,n,s=this,a=this._InContextAdvancedSearch();if(a&&(i=a.common_predicates,n=a["ds6w:type"]),e.is(i,"array")&&i.length>0)if(e.is(n,"array")&&n.length>0){var r={};i.forEach((function(e){r[e.uri]=e}));var l=n[0].uri;o.loadRelevantPredicates({className:l},(function(e){s._loadPLMDictionaryAndRun((function(){var n={};e.vocabularyPredicateInfo.forEach((function(e){r[e.uri]&&(n[e.uri]=e,n[e.uri].showByDefault=r[e.uri].showByDefault,r[e.uri].nlsName&&(n[e.uri].nlsName=r[e.uri].nlsName))}));var o=[];i.forEach((function(e){n[e.uri]&&o.push(n[e.uri])}));let a=s._prepareRelevantPredicates({dataPredicates:o,pswitch:!0,skip_basics:!1});t(a)}))}))}else{let e=s._prepareRelevantPredicates({dataPredicates:i,pswitch:!0,skip_basics:!1});t(e)}},_loadPLMDictionaryAndRun:function(t){l.loadDictionary().then((function(){e.is(t,"function")&&t.call()}))},_filterIncontextSources:function(e){var t=this.getOption("collection");if(t){var i=t._ctx_options;if(i){var n=i.source;n&&n.length&&(e=e.filter((function(e){return n.indexOf(e)>=0})))}}return e},_isInContextSearch:function(){var e=this.getOption("collection");if(e&&e._ctx_options)return!0},_isInContextSearchEdit:function(){var t=this.getOption("collection");if(e.is(t)&&e.is(t._ctx_options)&&e.is(t._ctx_options.title))return!0},_InContextAdvancedSearch:function(){var e=this.getOption("collection");if(e&&e._ctx_options)return e._ctx_options.advanced_search},_InContextPrecondition:function(){var e=this.getOption("collection");if(e&&e._ctx_options)return e._ctx_options.precond},showInContextExtension:function(){var e=this._InContextAdvancedSearch();return!e||!1!==e.showExtension},getIncontextTypeList:function(e){var t=this._InContextAdvancedSearch();if(t){var i=t["ds6w:type"];if(i)return e.filter((function(e){for(var t=0;t<i.length;t++)if(i[t].uri===e.uri)return!0}))}return e},getIncontextSubtypeList:function(e,t){var i=this._InContextAdvancedSearch();if(i){var n,s=i["ds6w:type"];if(s&&e){for(var o=0;o<s.length;o++)if(s[o].uri===e){n=s[o].interfaces;break}if(n){var a={};return n.forEach((function(e){a[e.name]=e})),t.filter((function(e){if(a[e.name])return!0}))}}}return t},getIncontextPredicateList:function(t,i){var n=this._InContextAdvancedSearch();if(n){var s,o=n["ds6w:type"];if(o&&t){for(let e=0;e<o.length;e++)o[e].uri===t&&(s=o[e].predicates);if(!s)return i;if(e.is(s,"array")){var a=[];return s.forEach((function(e){for(let t=0;t<i.length;t++)if(i[t].uri===e.uri){a.push(i[t]);break}})),a}}}return i},_isIncontextBasicAvailable:function(t){var i={available:!0,showByDefault:t.showByDefault},n=this._InContextAdvancedSearch();if(n){var s=n.basic_predicates;s&&(i.available=s.some((function(n){if(n.uri===t.uri)return e.is(n.showByDefault)&&(i.showByDefault=n.showByDefault),!0})))}return i},_getIncontextSelectedPredicateValue:function(e){var t=this._InContextAdvancedSearch();if(t&&t.selection)return t.selection[e]},_filterCustoExcludedSources:function(e,t){var i=m.getExcludedDataSources(t);return i&&(e=e.filter((function(e){return i.indexOf(e)<0}))),e},_getAdvancedSearchSelection:function(){var t=null,i=this.getOption("collection");if(i)if(i._ctx_options&&i._ctx_options.advanced_search)(t={}).selection=i._ctx_options.advanced_search.selection,t.inContext=!0;else if(i.service_parameters&&i.service_parameters.localFilter){(t={}).selection={};var n=i.service_parameters.localFilter;for(var s in n){var o=s.split("/"),a=o[o.length-1];1===o.length&&(a=a.substring(5)),t.selection[a]||(t.selection[a]=[]),e.is(n[s],"array")&&n[s].forEach((function(e){t.selection[a].push(e.object)}))}}return t},_getServiceName:function(t){return e.is(t,"string")?o.getVocabularyName(t):"3DSpace"},_prepareTypePredicatesFromCusto:function(t){var i=t.toAllowEdit,n=t.vocabId,a=t.source,l=t.typeSelectedByDefault,d=this,u=t.tenantId;if(e.is(n)){var h={vocabId:n};if(d._isInContextSearch())h.onComplete=function(n){var o=[];if(e.is(n)){for(var a=s.getOption("SEARCH_INSTANCES"),l=0;l<n.length;l++){var c=n[l].nlsName,u=n[l].name,h=n[l].uri;e.is(a)&&!0===a&&(h=n[l].uri+":"+n[l].type),e.is(c)||(c=r.get("adv_search.rdfclass."+n[l].uri));var g={value:h,label:c};(e.is(t)&&e.is(t.options)&&e.is(t.options.adv_search_field)&&e.is(t.options.adv_search_field,"string")||e.is(d._adv_search_field)&&e.is(d._adv_search_field,"string"))&&(d._adv_search_field!==u&&t.adv_search_field!==u||(g.predefined=!0)),o.push(g)}var p={dispValue:r.get("adv_search.type"),sixw:d.CORE_BASIC_TYPE,type:i?"string":"enum",multiSelect:!0,options:{multiSelect:!0,disabled:!o.length&&!i,placeholder:o.length?r.get("adv_search.type.message"):r.get("adv_search.type.noTypeMessage"),noResultsMessage:r.get("adv_search.type.noTypeMessage"),onCriterionSelectEvent:!0,allowFreeInput:!1,showSuggestsOnFocus:!0,datasets:{name:"Types",items:o},showByDefault:!0,informOnCriteriaModification:!0}};e.is(t)&&e.is(t.onComplete)&&e.is(t.onComplete,"function")&&t.onComplete.call(d,p),d._dataSetsForType=p}},h.onFailure=function(){e.is(t)&&e.is(t.onFailure)&&e.is(t.onFailure,"function")&&t.onFailure.call(d)},c.getAdvancedSearchCustoTypeList(n,undefined,h);else{var g=d._getServiceName(t.source);o.loadVocabularyClasses({vocabId:g},(function(i){let s=d._prepareTypePredicates({typesList:"3DDrive"===d._getServiceName(t.source)?[]:i.classInfos,vocabId:n,typesListSelected:l||m.getTypesSelectedByDefault(a),preferredPosition:m.getTypePreferredPosition(u,a),exclusiveTaxonomies:m.isExclusiveTaxonomies(),excludedTypes:m.getExcludedTypes(u,a)});e.is(t)&&e.is(t.onComplete)&&e.is(t.onComplete,"function")&&t.onComplete.call(d,s)}))}}return null}})})),define("DS/SNResultUX/utils/SearchDoubleClickHandler",["UWA/Core","UWA/Class","UWA/Class/Debug","DS/SNInfraUX/SearchSettings","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/i3DXCompassServices/i3DXCompassPubSub","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/ServiceDelegationLoader","DS/SNResultUX/utils/ResultsUtils"],(function(e,t,i,n,s,o,a,r,l,c){"use strict";return t.singleton(i,{handle:function(t){let i=null;if(e.is(t)&&e.is(t.compassData)&&(i=t.compassData),e.is(t.skeleton)&&e.is(t.id)){var s=t.skeleton;a.log("double click event received for "+t.id);var l=s.getOption("in_apps_search");if(l&&l.UXOptions&&!1===l.UXOptions.dblClk)return;var d=t.collection?t.collection:s.getCollection();if(e.is(d)){var u=this,h=d.get(t.id);if(null==h&&i.data.items[0].templateModel){let e=0;for(;"SavedSearch"===d._models[e]._previousAttributes["ds6w:type_value"];)e++;h=d.get(d._models[e].id)}if(e.is(h)){var g=function(){u.onDoubleClick({appID:r.getSearchAppId(),model:h,skeleton:s,serviceID:i.data.items[0].serviceId?i.data.items[0].serviceId:void 0,action_id:i.data.items[0].action_id?i.data.items[0].action_id:void 0,onComplete:function(n){e.is(n)&&e.is(n.id,"string")&&e.is(n.sourceJS,"string")?n.sourceJS.length>0&&require([n.sourceJS],(function(a){e.is(i)&&o.publish("setX3DContent",i),a.executeAction({action_id:n.id,actionsHelper:s._getActionsHelper(),object_ids:[t.id],widget_id:s.getOption("widgetId")})})):u._logNoActionOrError({type:"bad JS impl",error:"BAD action information to handle double click",callbackOnFailedToOpen:t.callbackOnFailedToOpen})},onFailure:function(i){e.is(i,"object")&&(i.callbackOnFailedToOpen=t.callbackOnFailedToOpen),u._logNoActionOrError(i)}})},p=s.getOption("in_apps_search"),_=e.is(p),f=c.isAdvSearchRun(p);!0===_&&e.is(t.force)&&!0===t.force&&(_=!1);var m=s.getOption("addinMode"),S=e.is(m,"string")&&m.length>0,v=n.getOption("search_web_in_win"),w="SavedSearch"===h.get("ds6w:type_value")&&"3DSpace"===h.getServiceID()&&!i.data.items[0].templateModel,b=!1,C=h.getSourceID();if(!0===v&&e.is(C)&&("swym"===C||"dashboard"===C||"drive"===C)&&(b=!0),w||b)g();else if(v){var y={objectId:h.get("id")};s._searchcom_socket.dispatchEvent("onDispatchToWin",{notif_name:"onDoubleClick",notif_parameters:JSON.stringify(y)},"search_web_in_win")}else if(!_||f||S){if(_&&!f&&S)(D=s.getOption("observable")).dispatchPowerByInContextSelection(!0);g()}else{var D=s.getOption("observable");e.is(D)&&1===D.getSelectedItemsCount()?D.dispatchInContextSelection(l.app_socket_id,"in_app_ok"):u._logNoActionOrError({message:"no action on double click during in-context mode as the multi-selection is possible",callbackOnFailedToOpen:t.callbackOnFailedToOpen})}}}}},onDoubleClick:function(t){if(e.is(t,"object")){let i=t.model;if(e.is(i)&&e.is(i.getServiceID,"function")&&e.is(i.getPlatformID,"function")){let n=t.serviceID?t.serviceID:i.getServiceID(),o=t.platformID?t.platformID:i.getPlatformID(),a=t.action_id?t.action_id:void 0;s.getServiceUrl({serviceName:n,platformId:o,onComplete:function(s){l.load({serviceID:n,platformID:o,serviceURL:s}).then((function(n){if(e.is(n.getDoubleClickAction,"function")){let o={model:i,appID:t.appID?t.appID:r.getSearchAppId(),skeleton:t.skeleton,serviceURL:s,onComplete:function(i){a&&(i.id=a),e.is(t.onComplete,"function")&&t.onComplete.call(void 0,i)},onFailure:function(i){e.is(t.onFailure,"function")&&t.onFailure.call(void 0,{type:"double_click_action_delegation_failure",error:i})}};n.getDoubleClickAction.call(void 0,o)}}),(function(i){e.is(t.onFailure,"function")&&t.onFailure.call(void 0,{type:"require_failure",error:i})}))}})}}},_logNoActionOrError:function(t){e.is(t.error)?(a.log(t.type),a.log(t.error)):a.log(t.message),e.is(t.callbackOnFailedToOpen,"function")&&t.callbackOnFailedToOpen()}})})),window.dsDefaultWebappsBaseUrl&&require.config({paths:{vuejs:window.dsDefaultWebappsBaseUrl+"vuejs/2.6.10/vue.min","vu-kit":window.dsDefaultWebappsBaseUrl+"vuekit/vu-kit.umd","vuekit-css":window.dsDefaultWebappsBaseUrl+"vuekit/vu-kit"}}),define("DS/SNResultUX/views/utils/SearchLightboxPreview",["vuejs","vu-kit","text!DS/SNResultUX/views/utils/SearchLightboxVue.html","UWA/Class/Debug","UWA/Core","UWA/Controls/Abstract","UWA/Element","UWA/Promise","DS/PubSub/PubSub","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/SNResultUX/utils/SearchServices","DS/SNResultUX/utils/SearchDoubleClickHandler","DS/SNInfraUX/ServiceDelegationLoader","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","css!vuekit-css"],(function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_){"use strict";e.use(t);return o.extend(n,{_informationPanel:null,_rootView:null,_rootContainer:null,_lastSelectedItem:null,_selectedItems:null,_width:420,_widgetId:null,_previewZone:null,_lightboxInformationPanel:null,_informationZone:null,_searchSignatureZone:null,_objectTypeIcon:null,_lightboxTitle:null,_skeleton:null,_lightBoxView:null,_searchPreviewDelegationRenderer:null,_bIsOnIphone:!1,_infoContainer:null,_menuAction:null,_listOfDSEditPropWidget:[],_screenType:"desktop",_informationNopreview:null,_previewContainer:null,_inAppsContext:!1,_collection:null,_lightboxComponent:null,securityContext:null,init:function(e){c.groupCollapsed("SearchPreview.init"),c.log("options:",e);let t=this;if(s.is(e)&&s.is(e.parent)&&s.is(e.parent.options)&&s.is(e.parent.options.in_apps_search)&&(this._inAppsContext=!0),this._parent(e),e&&e.securityContext&&(t.securityContext=e.securityContext),s.is(e.parentContainer)||c.error("No parentContainer given as argument!"),!s.is(e.rootContainer))return c.error("No rootContainer given as argument!"),void c.groupEnd();let i=u.identifyClientInfo(),n="";if(s.is(i)&&(n=i.identifier),"3DDashboard"===n){let e=require("DS/TransientWidget/Tool/Mapping");require("DS/TransientWidget/Tool/TransientMessaging").getInstance().on(e.TransientMessaging.ShowWidget,(function(){c.log("Widget added, need to hide lightbox preview!"),t._exitPreview()})),l.add("dashboard:change",(function(){c.log("Dashboard change, need to hide lightbox preview!"),t._exitPreview()}))}if(l.add("search:addTab",(function(){c.log("Search add tab, need to hide lightbox preview!"),t._exitPreview()})),this._lightBoxView=null,this._searchPreviewDelegationRenderer=null,this._infoContainer=null,this._listOfDSEditPropWidget=[],this._informationNopreview=null,this._previewContainer=null,this._rootView=e.parentContainer,this._rootContainer=e.rootContainer,this._lastSelectedItem=e.lastSelectedItem,s.is(this._lastSelectedItem)||c.warn("No search item given as input in options.lastSelectedItem!"),this._selectedItems=e.selectedItems,this._skeleton=e.parent,s.is(this._skeleton)||c.warn("No parent given as input in options.parent!"),s.is(e.width)){let t=screen.availWidth;this._width=2*e.width/3;let i=u.getDeviceCategory();("iphone"===i||"android"===i||!0===d.getOption("search_compact_mode")&&0===i.length&&t<1279)&&(this._screenType="mobile",this._width=e.width,this._bIsOnIphone=!0),"ipad"!==i&&"android"!==i||s.is(t)&&(t>1023?this._screenType="desktop":(this._screenType="mobile",this._width=e.width,this._bIsOnIphone=!0))}s.is(e.collection)&&(this._collection=e.collection),s.is(e.widgetId)&&(this._widgetId=e.widgetId),this._infoContainer=this.createContainers(),this._updateInformationsPanel(),this.dispatchEvent("onLightBoxPanelCreated"),c.groupEnd()},destroy:function(){if(c.groupCollapsed("SearchPreview.destroy"),this._lightboxComponent.show=!1,s.is(this._informationPanel)&&s.is(this._informationPanel.destroy,"function")&&this._informationPanel.destroy(),s.is(this._listOfDSEditPropWidget)){for(let e=this._listOfDSEditPropWidget.length-1;e>=0;e--){let t=this._listOfDSEditPropWidget[e];s.is(t)&&(t.destroyComponent(),this._listOfDSEditPropWidget[e]=0)}}this._listOfDSEditPropWidget=[],s.is(this._lightBoxView)&&s.is(this._lightBoxView.destroy,"function")&&this._lightBoxView.destroy(),this._lightBoxView=null,s.is(this._searchPreviewDelegationRenderer)&&s.is(this._searchPreviewDelegationRenderer.dispose,"function")&&this._searchPreviewDelegationRenderer.dispose(),this._informationPanel=null,this._searchPreviewDelegationRenderer=null,this._skeleton=null,this._lastSelectedItem=null,this._rootView=null,this.rootContainer=null,this._infoContainer=null,this._previewContainer=null,this._collection=null;let e=document.getElementById("search-lightbox");s.is(e)&&e.remove(),this._parent(),c.groupEnd()},initInformationsPanel:function(){},_updateInformationsPanel:function(){c.groupCollapsed("SearchPreview._updateInformationsPanel"),performance.mark("3DSearch:UpdatePreviewBegin");let e=this;this._informationPanel&&(this._informationPanel.destroy(),this._informationPanel=null),e._lightboxComponent.bLoadingPreview=!0,s.is(this._lightBoxView)&&s.is(this._lightBoxView._LightBoxPanel)&&(this._lightBoxView._LightBoxPanel.visibleFlag=!1);for(let t=e._listOfDSEditPropWidget.length-1;t>=0;t--){let i=e._listOfDSEditPropWidget[t];s.is(i)&&i.destroyComponent()}this._listOfDSEditPropWidget=[];let t=e._lastSelectedItem,i=s.is(t)&&s.is(t.getServiceID,"function")?t.getServiceID():null,n=e._widgetId;s.is(e._skeleton)&&(n=e._skeleton.getOption("widgetId"));let o=e._getCollection();performance.mark("3DSearch:UpdatePreviewEndCleanUp"),performance.measure("3DSearch:UpdatePreviewCleanUp","3DSearch:UpdatePreviewBegin","3DSearch:UpdatePreviewEndCleanUp");let l=r.deferred(),u=r.deferred();Promise.all([l.promise,u.promise]).then((t=>{e._lightboxComponent.bLoadingPreview=!1,this._updateInformationsPanelContents(),s.is(t,"array")&&2===t.length&&(this._bPrimaryZone=t[0],this._bSecondaryZone=t[1],e._lightboxComponent.bPreviewPanelAvailable=t[0],e._lightboxComponent.bInformationPanelAvailable=t[1],e._bIsOnIphone),performance.mark("3DSearch:UpdatePreviewEnd"),performance.measure("3DSearch:UpdatePreview","3DSearch:UpdatePreviewBegin","3DSearch:UpdatePreviewEnd")}));let g=function(i,n){c.log("SearchPreview defaultTreatment");require(["DS/EditPropWidget/EditPropWidget","DS/EditPropWidget/models/EditPropModel","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/models/EditPropAttributeModel","DS/EditPropWidget/constants/ConstantsMapping","DS/SNResultUX/views/utils/PropertiesServices"],(function(o,a,r,l,h,g){g.getOptions({model:t,EditPropConstants:r,informationContext:"3DSearchPreview",securityContext:e.securityContext,onComplete:function(p){if(c.log("PropertiesServices.getOptions->onComplete",p),p.className="searchPreviewProperties",s.is(n)||(p.typeOfDisplay=r.ALL,p.selectionType=r.NO_SELECTION,p.warningOnUnsaved=!1,p.multiselection=r.MULTISEL_NO,p.collapseTabs=!1,s.is(p.facets)&&delete p.facets),s.is(p)&&s.is(p.facets,"array"))for(let e=0,t=p.facets.length;e<t;e++)s.is(p.facets[e],"object")&&(p.facets[e].alwaysVisible=!0);e._informationPanel=new o(p);let _=[r.FACET_VIEWS];s.is(d.getOption("showDerivedOutput"))&&d.getOption("showDerivedOutput")||(_.push(r.FACET_CHANGE),_.push(r.FACET_DERIVEDOUTPUT)),d.getOption("showChangeTab")||_.push(r.FACET_CHANGE),e._informationPanel.removeFacets(_);g.getPropModelFromSearchItem(t,a,l,h,(function(t){s.is(i)&&(i.empty(),e._informationPanel.getContent().getContent().inject(i)),e._informationPanel.initDatas(t)}),n),u.resolve(!0)},onAddFacets:function(t){if(c.log("PropertiesServices.getOptions->onAddFacets"),s.is(e._informationPanel)&&s.is(t,"array")){for(let e=0,i=t.length;e<i;e++)t[e].alwaysVisible=!0;e._informationPanel.addFacets(t)}}})}))},_=function(){c.log("createLightBox");require(["DS/SNResultUX/views/utils/LightBoxView"],(function(i){if(s.is(e._lightBoxView)){if(c.log("lightbox already exists"),null!==e._lightBoxView._LightBoxPanel){let t=e._lightBoxView._LightBoxPanel.elements.wrapper;s.is(t)&&null===t.getParent()&&t.inject(e._previewZone),l.resolve(!0),s.is(e._lightBoxView)&&s.is(e._lightBoxView._LightBoxPanel)&&!1===e._lightBoxView._LightBoxPanel.visibleFlag&&e._lightBoxView.activate_deactivate(e._lastSelectedItem)}}else{c.log("lightbox does not exists yet");let s={parentContainer:e._previewZone,model:t,widget_id:n,collection:o,skeleton:e._skeleton,bottomdocking:!1};e._lightBoxView=new i(s),e._lightBoxView._initPlayer(),l.resolve(!0)}}))};s.is(this._lightboxComponent)&&this._lightboxComponent.updateCurrentItem(),null!==e._previewZone&&(null!==t&&s.is(i)&&(c.log("Calling ServiceDelegationLoader"),c.log("->serviceID:",i),c.log("->platformID:",t.getPlatformID()),p.load({serviceID:i,platformID:t.getPlatformID()}).then((function(i){if(!s.is(i))throw c.error("ServiceDelegation.load returns an invalid serviceDelegation!"),new Error("ServiceDelegation.load returns an invalid serviceDelegation!");if(e._previewZone.empty(),e._bPrimaryZone=!1,s.is(e._informationZone)&&s.is(e._informationZone.empty,"function")&&e._informationZone.empty(),e._bSecondaryZone=!1,s.is(i.getRenderPreview,"function"))c.log("Calling serviceDelegation.getRenderPreview"),c.log("->searchmodel:",t),c.log("->widget_id:",n),i.getRenderPreview({searchmodel:t,widget_id:n,onComplete:function(i){if(c.log("onComplete serviceDelegation.getRenderPreview"),!s.is(i))throw c.error("ServiceDelegation.getRenderPreview returns an invalid previewRenderer!"),new Error("ServiceDelegation.getRenderPreview returns an invalid previewRenderer!");e._searchPreviewDelegationRenderer=i,s.is(i.getPrimaryContent,"function")&&s.is(e._previewZone)&&(e._lightboxComponent.restoreInformationState(),i.getPrimaryContent({searchmodel:t,parentContainer:e._previewZone,widget_id:n,skeleton:e._skeleton,onComplete:function(i){if(c.log("onComplete preview.getPrimaryContent => custom primary content provided by datasource",i),s.is(i)){let n=i;s.is(i.content)&&(n=i.content),e._previewZone.empty();let o=n;s.is(o.inject,"function")||(o=a.extend(n)),o.inject(e._previewZone);let r=e._previewZone;if(s.is(i.onRenderingEnd)){i.onRenderingEnd.then((function(e){s.is(e)&&s.is(e.rootEltForHighlight)&&(r=e.rootEltForHighlight);try{h._highlightTerms(t,r)}catch(e){c.warn("highlighting failed!",e)}}))}else try{h._highlightTerms(t,r)}catch(e){c.warn("highlighting failed!",e)}e._bPrimaryZone=!0}else c.warn("No content returned by getPrimaryContent");l.resolve(!0)},onFailure:function(){c.log("onFailure preview.getPrimaryContent");let t={widgetId:n};!0===h.getpreviewPanel(t)?(e._bPrimaryZone=!0,c.log(" => no custom primary content, using default one"),_()):l.resolve(!1)},onCusto:function(t){c.log("onCusto preview.getPrimaryContent"),c.log("->settings:",t),s.is(t)&&(s.is(t.informationUser)&&"hide"===t.informationUser&&(e._lightboxComponent.hideInformationPanel(!0),e._lightboxComponent.informationButtonHidden(!0)),s.is(t.nopreview)&&"visible"===t.nopreview&&l.resolve(!1))}})),s.is(i.getSecondaryContent,"function")&&s.is(e._informationZone)&&i.getSecondaryContent({searchmodel:t,parentContainer:e._informationZone,widget_id:n,onComplete:function(t){if(c.log("onComplete preview.getSecondaryContent"),s.is(t)){e._informationZone.empty();let i=a.extend(t);if(!s.is(i,"element")||!s.is(i.inject,"function"))return void c.error("Invalid content returned by getSecondaryContent");i.inject(e._informationZone),u.resolve(!0)}else null===t&&(c.log("No secondary area to display:"),u.resolve(!1))},onFailure:function(t){c.log("onFailure preview.getSecondaryContent"),c.log("listValues",t),e._informationZone.empty(),e._bSecondaryZone=!0,g(e._informationZone,t)}})}});else{let t={widgetId:n};!0===h.getpreviewPanel(t)?(_(),l.resolve(!0)):l.resolve(!1),g(e._informationZone)}}),(function(){c.log("ServiceDelegation not found"),g(e._informationZone),l.resolve(!1)}))),c.groupEnd())},setActiveObject:function(e,t){c.groupCollapsed("SearchPreview.setActiveObject"),null===this._lastSelectedItem&&null===e||this._lastSelectedItem===e||(this._lastSelectedItem=e,s.is(this._lightboxComponent)&&this._lightboxComponent.updateCurrentItem(e),this._updateInformationsPanel(t)),c.groupEnd()},switchVisibleFlag:function(){c.groupCollapsed("SearchPreview.switchVisibleFlag"),this.dispatchEvent("onPreviewModeRequest"),this._lightboxComponent.toggleVisibility(),c.groupEnd()},switchViewMode:function(){},getVisibleFlag:function(){c.groupCollapsed("SearchPreview.getVisibleFlag");let e=this._lightboxComponent.show;return c.groupEnd(),e},hideAndclean:function(){c.groupCollapsed("SearchPreview.hideAndclean");let e=this._rootContainer.querySelector(".onesearch_skeleton");s.is(e,"object")&&s.is(e.show,"function")&&e.show(),this._lightboxComponent.show&&(this._lightboxComponent.show=!1,this.dispatchEvent("onExitPreviewMode"),this.setActiveObject(null),s.is(this._lightBoxView)&&s.is(this._lightBoxView._LightBoxPanel)&&(this._lightBoxView._LightBoxPanel.visibleFlag=!1)),c.groupEnd()},createContainers:function(){let t=this;const n="vue-lightbox";let o;return document.getElementById(n)||(o=document.createElement("div"),o.id=n,document.body.prepend(o)),this._lightboxComponent=new e({el:"#"+n,template:i,data:function(){return{show:!0,isWidget:d.getOption("search_web_in_win"),objectType:"https://vdevpril118dsy.dsone.3ds.com:443/3DSpace/snresources/images/icons/small/I_VPMNavProduct.png",availableActions:[],panels:[{name:"information",title:t._bIsOnIphone?_.get("actions.InfoPanel.title"):null,show:!t._bIsOnIphone,showClose:t._bIsOnIphone}],bOpenButtonHidden:!0,bInformationButtonHidden:!1,bInformationButtonActive:!t._bIsOnIphone,bPreviewPanelAvailable:!1,bInformationPanelAvailable:!1,bLoadingPreview:!0,bPreviousEnable:!0,bNextEnable:!0,noPreviewTitle:_.get("previewNotAvailable"),noPreviewDescription:_.get("extensionNotSupported"),typeIcon:null,zIndex:1302,closeLabel:_.get("InfoPanel.Close")}},computed:{sideActions(){return[{name:"previous",label:_.get("InfoPanel.Previous"),fonticon:"chevron-left",disabled:!this.bPreviousEnable,hidden:!1},{name:"next",label:_.get("InfoPanel.Next"),fonticon:"chevron-right",disabled:!this.bNextEnable,hidden:!1}]},primaryActions(){return[{name:"open",fonticon:"open",label:_.get("InfoPanel.Open"),selected:!1,hidden:this.bOpenButtonHidden},{name:"actions",fonticon:"down-open",label:_.get("InfoPanel.ActionsDropDown"),selected:!1,hidden:!1},{name:"information",fonticon:"info",label:_.get("infoPanel.toggle"),selected:this.bInformationButtonActive,hidden:this.bInformationButtonHidden}]},menuActions:()=>[],isLightboxVisible(){return this.show},isInformationPanelVisible(){return this.panels.find((e=>"information"===e.name)).show},stylePreviewImg(){let e={"background-image":"url("+this.typeIcon+")"};return(this.bLoadingPreview||this.bPreviewPanelAvailable)&&(e.display="none"),e},stylePreviewArea(){let e={height:"100%"};return!this.bLoadingPreview&&this.bPreviewPanelAvailable||(e.display="none"),e},styleLoadingPreviewArea(){let e={};return this.bLoadingPreview||(e.display="none"),e},styleInformationArea(){let e={display:"unset"};if(t._bIsOnIphone)this.bInformationButtonActive?e.display="unset":e.display="none";else if(s.is(this.bInformationButtonActive)&&!t._bIsOnIphone){const e=this.panels.find((e=>"information"===e.name));s.is(e)&&(e.show=this.bInformationButtonActive)}return e},styleLightboxContent(){let e={display:"unset"};return t._bIsOnIphone&&(this.bInformationButtonActive?e.display="none":e.display="unset"),e}},methods:{updateCurrentItem(e){if(this.bPreviewPanelAvailable=!1,this.bInformationPanelAvailable=!1,void 0!==e&&(t._lastSelectedItem=e),s.is(t._lastSelectedItem)){if(s.is(t._lightboxTitle)){let e=t._getTreeModel();t._lightboxTitle.setHTML(e._options.label)}let e=t._lastSelectedItem.get("type_icon_url")||"",i=t._lastSelectedItem.get("preview_url")||"";if(-1<i.indexOf("snresources/images/icons/large")?e=i:-1<e.indexOf("snresources/images/icons/small")&&(e=e.replace("snresources/images/icons/small","snresources/images/icons/large"),e=e.replace(".png","108x144.png")),this.typeIcon=e,s.is(t._getCollection())){let e=t._getCollection().getTreeDocument();if(s.is(e)){let i=e.getXSO();if(s.is(i)){let e=i.get();if(s.is(e)&&e.length>1){let i=e.find((function(e){return e.options.id===t._lastSelectedItem.get("id")}));s.is(i)&&i.select(!0)}}}}}},open(){c.log("open requested"),t._open()},contextualMenu(e){e&&(e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault());let i=document.querySelector("#search-lightbox .vu-icon.fonticon.fonticon-down-open"),n=t._skeleton.getCurrentView();if(s.is(n)){let e;"table"===n.id&&s.is(n.getOptionCommon,"function")&&s.is(n.getOptionCommon())||["myContent","what","who","when","where"].includes(n.id)&&u.isFUN109031Active()?e=n.getOptionCommon().onContextualEvent:s.is(n.view)&&(e=n.view.onContextualEvent),s.is(e)&&s.is(e.callback)&&e.callback.call(n,{forcemenu:!0,fromPreview:!0,data:{target:i},cellInfos:{nodeModel:t._getTreeModel(),cellView:{getContent:function(){return i}}}})}},toggleVisibility(e){this.show=void 0!==e?e:!this.show},refreshContent(e){let i,n=t._getCollection();if(s.is(n)){let e=n.getTreeDocument();if(s.is(e)){let t=e.getXSO();s.is(t)&&(i=t.get(),0===i.length&&e.getRoots()[0].select())}}if(s.is(i)&&i.length>0){let o=i[i.length-1],a=e>0?o.getNextVisibleNode():o.getPreviousVisibleNode();if(s.is(a)&&s.is(a.options)){let e=n.get(a.options.id);t.setActiveObject(e,!0),a.select(!0)}}},refreshActions(){},toggleInformationPanel(e){const t=this.panels.find((e=>"information"===e.name));if("boolean"==typeof e)t.show=e,this.bInformationButtonActive=e;else{let e=!t.show;t.show=e,this.bInformationButtonActive=e}},restoreInformationState(){this.informationButtonHidden(!1);const e=this.panels.find((e=>"information"===e.name));s.is(e)&&s.is(this.bInformationButtonActive)&&!t._bIsOnIphone&&(e.show=this.bInformationButtonActive)},hideInformationPanel(e){const t=this.panels.find((e=>"information"===e.name));s.is(t)&&(t.show=!e)},informationButtonHidden(e){this.bInformationButtonHidden=e},closeLightbox(){t.hideAndclean()}},mounted(){c.log("mounted"),this.$nextTick((()=>{t._lightboxContent=s.extendElement(this.$refs.lightboxContent),t._previewZone=s.extendElement(this.$refs.lightboxPreviewArea),t._lightboxInformationPanel=s.extendElement(this.$refs.lightboxInformationPanel),t._informationZone=s.extendElement(this.$refs.informationZone),t._searchSignatureZone=s.extendElement(this.$refs.searchSignatureZone),t._objectTypeIcon=s.extendElement(this.$refs.lightboxTypeIcon),t._lightboxTitle=s.extendElement(this.$refs.lightboxTitle),t._updateInformationsPanel()}))},created(){},beforeCreate(){},beforeMount(){},beforeUpdate(){},updated(){},activated(){},deactivated(){},beforeDestroy(){},destroyed(){},errorCaptured(){}}),o},_updateInformationsPanelContents:function(){c.groupCollapsed("SearchPreview._updateInformationsPanelContents");let e=this,t=e._getTreeModel();if(!s.is(t)||!s.is(e._lastSelectedItem))return void c.groupEnd();if(s.is(this._lightboxComponent)&&this._lightboxComponent.updateCurrentItem(),s.is(e._titleObj)){let i=s.extendElement(e._titleObj);i.empty(),i.setHTML(t._options.label)}let i=e._getCollection();if(s.is(e._searchSignatureZone)){if(s.is(e._skeleton)){let t=i.getSearchRessources();if(s.is(t)){let i=e._lastSelectedItem.get("ds6w:responsibleUid");s.is(i)||(i=e._lastSelectedItem.get("owner"));let n=t.getUserPicture({login:i,format:"mini"});e._searchSignatureZone.querySelector(".e-nopicture").src=n}}let n=e._searchSignatureZone.querySelector(".user-subtitle"),o=s.extendElement(n);o.empty(),o.setHTML(t._options.subLabel)}if(s.is(e._menuAction)&&(e._menuAction.addClassName("menu-access-hidden"),"3dspace"!==e._lastSelectedItem.getSourceID()||this._inAppsContext||e._menuAction.removeClassName("menu-access-hidden")),null!==e._lastSelectedItem&&!0!==d.getOption("search_web_in_win")&&!this._inAppsContext){let t=e._lastSelectedItem.getServiceID();if(s.is(t))if(e._searchPreviewDelegationRenderer&&s.is(e._searchPreviewDelegationRenderer.getAppIdForOpen,"function")){let t={searchmodel:e._lastSelectedItem,widget_id:e._skeleton.getOption("widgetId"),onComplete:function(){e._lightboxComponent.bOpenButtonHidden=!1},onFailure:function(){e._lightboxComponent.bOpenButtonHidden=!0}};e._searchPreviewDelegationRenderer.getAppIdForOpen(t)}else g.onDoubleClick({model:e._lastSelectedItem,skeleton:e._skeleton,onFailure:function(){e._lightboxComponent.bOpenButtonHidden=!0},onComplete:function(){e._lightboxComponent.bOpenButtonHidden=!1}})}c.groupEnd()},_exitPreview:function(){this.hideAndclean()},_getCollection:function(){let e=this,t=e._collection;return s.is(e._skeleton)&&(t=e._skeleton.getCollection()),t},_getTreeModel:function(){let e=this._getCollection();if(!s.is(e))return;this._lightboxComponent.bPreviousEnable=!0,this._lightboxComponent.bNextEnable=!0;let t=e.indexOf(this._lastSelectedItem);if(-1!==t&&(0===t?(this._lightboxComponent.bPreviousEnable=!1,t===e.length-1?this._lightboxComponent.bNextEnable=!1:this._lightboxComponent.bNextEnable=!0):t===e.length-1?(this._lightboxComponent.bPreviousEnable=!0,this._lightboxComponent.bNextEnable=!1):(this._lightboxComponent.bPreviousEnable=!0,this._lightboxComponent.bNextEnable=!0),t>=0)){let i=null,n=e.getTreeDocument().getRoots();if(s.is(n,"array")&&t<n.length)return i=n[t],i}},changeModel:function(e){c.groupCollapsed("SearchPreview.changeModel"),s.is(this._lightBoxView)&&this._lightBoxView.changeModel(e),c.groupEnd()},_open:function(){let e=this,t=e._lastSelectedItem.getServiceID(),i=e._lastSelectedItem.id,n=e._widgetId;if(s.is(e._searchPreviewDelegationRenderer))if(s.is(e._searchPreviewDelegationRenderer.getAppIdForOpen,"function")){let t={searchmodel:e._lastSelectedItem,widget_id:n,cb:function(t){e._exitPreview()}};e._searchPreviewDelegationRenderer.Open(t)}else if(s.is(t)){let o;s.is(e._skeleton)&&(o=e._skeleton._getActionsHelper()),p.load({serviceID:t,platformID:e._lastSelectedItem.getPlatformID()}).then((function(t){s.is(t.executeAction,"function")?t.executeAction({actionsHelper:o,action_id:"view",object_ids:[i],widget_id:n}):g.handle({skeleton:e._skeleton,id:i,force:!0})}),(function(){g.handle({skeleton:e._skeleton,id:i,force:!0})})),e._exitPreview()}}})})),define("DS/SNResultUX/views/utils/SwitcherView6wGrouping",["UWA/Core","UWA/Class/Debug","UWA/Class","UWA/Controls/Abstract","UWA/Promise","DS/MessageBus/MessageBus","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchCom","DS/SNInfraUX/SearchPreferences","DS/WebappsUtils/Performance","DS/SNResultUX/utils/SearchServices","DS/SNResultUX/utils/SearchMultiSort","DS/SNResultUX/utils/SearchCustoServices","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/UIKIT/Iconbar","DS/FedDictionaryAccess/FedDictionaryAccessAPI","UWA/Element","DS/UIKIT/DropdownMenu","DS/UIKIT/Tooltip","DS/SNInfraUX/Logger"],(function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_,f,m,S,v,w,b){"use strict";return n.extend(t,{_menuUIKIT:null,_container:null,_collection:null,_widgetID:null,_icon:null,_tooltip:null,_events:[],init:function(e){this._menuUIKIT=null,this._container=e.container?e.container:null,this._collection=e.collection?e.collection:null,this._widgetID=e.widgetID?e.widgetID:null,this._icon=null,this._tooltip=null,this._events=[],this._initEvents(),this.render()},_initEvents:function(){let e=this;this._events.push(o.subscribe({channel:"3dSearch-switcher-view",topic:"displayContentSetHeader",callback:(t,i)=>{let n=JSON.parse(i.data),s=null,o=null;"tile"===n.view&&(s="view-small-tile")&&(o=_.get("view.tile.title")),"thumbnail"===n.view&&(s="view-small-thb")&&(o=_.get("view.thumbnail.title")),"tilebig"===n.view&&(s="view-big-tile")&&(o=_.get("view.Textual.title")),"table"===n.view&&(s="view-list")&&(o=_.get("view.table.title")),null!==s&&(e._icon.className="fonticon fonticon-"+s)&&e._menuUIKIT.items&&e._menuUIKIT.toggleSelection(e._menuUIKIT.getItem(s)),null!==o&&e._tooltip.setBody(o)}}))},render:function(){if(null===this._container)return void b.log("[SwitcherView6wGrouping - render] : no container given.");var e=this;let t=void 0===d.getItem("LastSearchViewMode")?"tile":d.getItem("LastSearchViewMode"),i="view-small-tile",n=_.get("view.tile.title");"thumbnail"===t&&(i="view-small-thb")&&(n=_.get("view.thumbnail.title")),"tilebig"===t&&(i="view-big-tile")&&(n=_.get("view.Textual.title")),"table"===t&&(i="view-list")&&(n=_.get("view.table.title")),this._icon=S.create("span",{class:"fonticon fonticon-"+i,"data-rec-id":"switcher6wGrouping",events:{click:function(){null!==e._widgetID&&e._widgetID._menuUIKIT.show()}}}).inject(this._container);let s=[{name:"thumbnail",text:_.get("view.thumbnail.title"),fonticon:"view-small-thb",selectable:!0,selected:"thumbnail"===t},{name:"tilebig",text:_.get("view.Textual.title"),fonticon:"view-big-tile",selectable:!0,selected:"tilebig"===t},{name:"tile",text:_.get("view.tile.title"),fonticon:"view-small-tile",selectable:!0,selected:"tile"===t}];!1===l.getOption("search_compact_mode")&&s.push({name:"table",text:_.get("view.table.title"),fonticon:"view-list",selectable:!0,selected:"table"===t}),this._menuUIKIT=new v({target:this._container,items:s,closeOnClick:!0,className:"search",events:{onClick:function(t,i){d.setItem("LastSearchViewMode",i.name),o.publish({channel:"3dSearch-global-view",topic:"reloadViews"});let n="view-small-tile",s=_.get("view.tile.title");"thumbnail"===i.name&&(n="view-small-thb")&&(s=_.get("view.thumbnail.title")),"tilebig"===i.name&&(n="view-big-tile")&&(s=_.get("view.Textual.title")),"table"===i.name&&(n="view-list")&&(s=_.get("view.table.title")),e._icon.className="fonticon fonticon-"+n,e._tooltip.setBody(s),d.commit()}}}),this._tooltip=new w({position:"bottom",target:this._icon,className:"switcher6wGrouping",body:n})},destroy:function(){null!==this._icon&&this._icon.destroy(),null!==this._menuUIKIT&&this._menuUIKIT.destroy(),null!==this._tooltip&&this._tooltip.destroy();for(let e=0;e<this._events;e++)this._events[e].destroy();this.elements&&this.elements.container&&this._parent()},updateMenu:function(){},updateStateInPanel:function(){},reinitMenu:function(){},getDropdown:function(){},addItemExtend:function(){},removeItemExtend:function(){},emptyItemExtend:function(){},setOrderByExt:function(){},setOrderByExtExplicit:function(){},updateRenderByExt:function(){},checkNewColumnForSort:function(){},_setOrder:function(e,t,i){}})})),define("DS/SNResultUX/utils/SearchActions",["UWA/Core","UWA/Promise","UWA/Class","UWA/Utils/Client","UWA/Class/Debug","UWA/Class/Events","UWA/Element","DS/PubSub/PubSub","DS/MessageBus/MessageBus","DS/WAFData/WAFData","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SecurityContextManager","DS/SNInfraUX/SearchPreferences","DS/SNResultUX/utils/SearchServices","DS/SNResultUX/utils/SearchCustoServices","DS/SNSearchResultsCusto/utils/SearchResultsCustomizationPreferences","DS/SNSearchResultsCusto/views/SearchResultsCustomizationPanel","DS/SNResultUX/views/utils/SearchOptionsUI","DS/UIKIT/Autocomplete","DS/UIKIT/Tooltip","DS/UIKIT/Input/Select","DS/Controls/ComboBox","DS/Controls/Button","DS/Windows/Dialog","DS/W3DXComponents/Collections/ActionsCollection","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","i18n!DS/SNInfraUX/assets/nls/SNInfraUX.json","text!DS/SNResultUX/assets/HtmlEncoding.json","DS/SNResultUX/utils/SearchViewOptions","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/SNInfraUX/Logger","DS/Windows/ImmersiveFrame","DS/SNResultUX/utils/ExternalComponentHelpers"],(function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_,f,m,S,v,w,b,C,y,D,I,T,A,x,N,E,O,k,P){"use strict";var M=T.get("loading"),R=function(e){if(isNaN(e))return!1;var t=parseFloat(e);return(0|t)===t};function V(t){const i=function(n){var s;e.is(t.contains,"function")&&!t.contains(n.target)&&n.target.className.indexOf("wux-layouts-treeview")<0&&n.target.className.indexOf("wux-windows-immersive-frame-no-pointerevents")<0&&n.target.className.indexOf("modal-wrap")<0&&n.target.className.indexOf("modal-content")<0&&n.target.className.indexOf("modal-header")<0&&n.target.className.indexOf("modal-body")<0&&n.target.className.indexOf("modal-footer")<0&&n.target.className.indexOf("WarningReloadPage modal modal-root")<0&&n.target.className.indexOf("btn-default btn btn-root")<0&&null!==n.target.parentNode&&n.target.parentNode.className.indexOf("modal-header")<0&&null!==n.target.parentNode&&n.target.parentNode.className.indexOf("modal-body")<0&&(s=t)&&(s.offsetWidth||s.offsetHeight||s.getClientRects().length)&&(t.style.display="none",document.removeEventListener("click",i))};document.addEventListener("click",i)}return i.extend(o,s,{name:"DS_SNResultUX_utils_SearchActions",CSVpromise:t.deferred(),attributeToFilterForExport:["id","type_icon_url","preview_url","actions","resourceid","resourceid_tagger","actions"],globalActions:["exportToCmd","print","save_search","refresh_search","kpi_pcs_action","Grid_Custo","Preview","InfoPanel","Pin"],current_collection:null,current_selected:null,displayMode:null,skeleton:null,snSkeletonMgt:null,initOptionMode:null,searchContentSetDivContainer:null,maskedElement:null,actionCollectionUsedBySkeleton:null,actionCollectionOriginal:null,actionInitDone:!1,_actionTooltips:null,actionOneSearch:null,_isSecurityContextChosenAfterError:!1,init:function(t){let i=this;r.add("SearchPopover:destroy",(function(){i.popover=null})),this.setDebugMode(d.getDebugMode()),e.is(t)&&e.is(t.SNSkeleton)&&(this.snSkeletonMgt=t.SNSkeleton),this._actionTooltips=[]},destroy:function(){this._cleanPopOver(),this.current_collection=null,this.current_selected=null,this.displayMode=null,this.skeleton=null,this.snSkeletonMgt=null,this.searchContentSetDivContainer=null,this.actionCollectionUsedBySkeleton=null,this.actionCollectionOriginal=null,this.actionOneSearch=null,this._actionTooltips.forEach((function(e){e.destroy()})),this._actionTooltips=null},getActiveTenant:function(){var t="";return e.is(this.current_collection)&&e.is(this.current_collection.search_ressources)&&e.is(this.current_collection.search_ressources.getActiveTenant,"function")&&(t=this.current_collection.search_ressources.getActiveTenant()),t},setCollection:function(e){this.current_collection=e},setSelected:function(e){this.current_selected=e},setSkeleton:function(e){this.skeleton=e},setSearchContentSetDivContainer:function(e){this.searchContentSetDivContainer=e},setEmptyViewMessage:function(e){M=e},getEmptyViewMessage:function(){return M},setDisplayMode:function(t){var i=this;if(this.displayMode=t,e.is(this.searchContentSetDivContainer)&&e.is(this.actionCollectionOriginal)){var n=this.getActiveTenant();u.getGrantedRoles((function(s){var o;i.log("Roles:"+s);var a=!1,r=d.getOption("search_compact_mode");e.is(r)?(a=!0,o=i.actionOneSearch):(i.actionCollectionUsedBySkeleton.reset(i.actionCollectionOriginal.toArray()),o=i.actionCollectionUsedBySkeleton);var l=e.extendElement(i.searchContentSetDivContainer).getElements(".content-set-actions");if(e.is(l)&&l.length>0){var c=null;let r=function(t){if(t&&t.id===c){if(e.is(t.platforms))return t.platforms.some((function(e){return e===n}))}else if(t&&"InternalDS"===t.id)return!0;return!1};for(var u=o.size()-1;0<=u;u--){var h=o.at(u),g=h.get("icon"),p=h.get("displayMode"),_=h.get("id"),f=h.get("role"),m=!0;if((m=!e.is(p,"string")||("AllView"===p||p.search(t)>=0))&&e.is(s,"array")&&s.length>0)if(e.is(f,"array")&&0<f.length){m=!1;var S=0,v=f.length;for(S=0;S<v;S++)c=f[S],s.some(r)&&(m=!0)}else e.is(f,"string")&&f.length>0&&(c=f,m=s.some(r));m||(!0===a?h.set({visible:m}):o.remove(h));var b=e.extendElement(l[0]).getElements(".fonticon-"+g);if(e.is(b)&&b.length>0){var C=b[0];if(e.is(C)&&e.is(C.getParent())&&e.is(C.getParent().getParent())){var y=C.getParent().getParent();if(!i.actionInitDone){var D;D=T.get("actions."+_+".toolTip"),i._actionTooltips.push(new w({position:"bottom",target:y,body:D}))}}}}i.actionInitDone=!0}}))}},_shouldBeAvailableIfInContextMode:function(t,i){var n=!0;if(e.is(t)){var s=t.in_apps_search;if(e.is(s))if("saveAsFavorite"===i&&(n=!1),e.is(s.UXOptions,"object")){if(e.is(s.UXOptions.globalToolbarActions,"object")){var o=s.UXOptions.globalToolbarActions[i];e.is(o,"boolean")&&(n=o)}}else"columnCusto"===i&&e.is(s.columnCustoAvailable)&&(n=s.columnCustoAvailable)}return n},getGlobalActions:function(t){var i=this,n=null,s=!1,o=u.identifyClientInfo();function a(e){return i._shouldBeAvailableIfInContextMode(t,e)}this.actionOneSearch=new I,this.actionCollectionUsedBySkeleton=new I,this.actionCollectionUsedBySkeleton["data-rec-id"]=!0;var r=u.isInTheSimpleSearch({tenant:t.tenant}),l=!1;if(e.is(r)){var c=d.getOption("search_compact_mode");e.is(c)&&(l=!0,!1===c&&(r=!1))}if(!0===g.getItem("integratedSearch")){var h=!0;(window&&window.clntlang||!0===d.getOption("search_web_in_win")||e.is(t)&&e.is(t.pinToDashboard)&&!1===t.pinToDashboard)&&(h=!1),!0===h&&a("pinToDashboard")&&(n={id:"Pin",title:T.get("actions.Pin.title"),icon:"publish",overflow:!1,displayMode:"AllView",attributes:{"data-rec-id":"Pin"}},!1===l?this.actionCollectionUsedBySkeleton.add(n):this.actionOneSearch.add(n))}var p=function(){let t=!1;return!1===r&&!0!==d.getOption("enableNewSearchViews")&&e.is(o)&&("3DSwym"!==o.identifier||"3DSwym"===o.identifier&&!1===o.deprecated)&&(t=!0),!0===t&&e.is(i.snSkeletonMgt)&&e.is(i.snSkeletonMgt.informationsAction)&&!1===i.snSkeletonMgt.informationsAction&&(t=!1),t}();a("informations")&&!0===p&&(n={id:"InfoPanel",title:T.get("actions.InfoPanel.title"),icon:"info",overflow:!1,displayMode:"AllView",attributes:{"data-rec-id":"InfoPanel"}},this.actionCollectionUsedBySkeleton.add(n));var _=!0;if(!0===r&&(_=!1,!0===g.getItem("integratedSearch")&&(_=!0)),!0===_){var f="AllView";if(e.is(i.snSkeletonMgt)&&e.is(i.snSkeletonMgt.getSearchWidget,"function")&&e.is(i.snSkeletonMgt.getSearchWidget())&&e.is(i.snSkeletonMgt.getSearchWidget().getValue,"function")){var m=i.snSkeletonMgt.getSearchWidget().getValue("addinmode");if(e.is(m)&&m.length>0){var S=this._listUISettingsToDisplay();e.is(S)&&S.length>0&&(f="table")}}n={id:"Grid_Custo",title:T.get("actions.Grid_Custo.title"),icon:"cog",overflow:!1,displayMode:f,attributes:{"data-rec-id":"Grid_Custo"}},!1===l?this.actionCollectionUsedBySkeleton.add(n):this.actionOneSearch.add(n)}d.getOption("global_action_save_search")&&a("saveAsFavorite")&&"3DSwym"!==o.identifier&&(s=!0,!0===r&&!0===g.getItem("NofavoritesOnBar")&&(s=!1),!0===s&&(n={id:"save_search",title:T.get("actions.save_search.title"),icon:"star",overflow:!1,displayMode:"AllView",role:["CSV","InternalDS"],attributes:{"data-rec-id":"save_search"}},!1===l?this.actionCollectionUsedBySkeleton.add(n):this.actionOneSearch.add(n)));var v=!1;if((d.getOption("global_action_refresh_search")&&d.getOption("search_web_in_win")||g.getItem("integratedSearch")||e.is(d.getOption("search_compact_mode"))&&d.getOption("search_web_in_win")||e.is(i.snSkeletonMgt)&&"3DSpace"===u.identifyClientInfo(i.snSkeletonMgt.getOption("addinMode")).identifier||e.is(i.snSkeletonMgt)&&"3DSwym"===u.identifyClientInfo(i.snSkeletonMgt.getOption("addinMode")).identifier)&&(v=!0),e.is(this.snSkeletonMgt)&&e.is(this.snSkeletonMgt.getSearchWidget,"function")){let t=this.snSkeletonMgt.getSearchWidget();e.is(t)&&e.is(t.data)&&e.is(t.data.launch_mode)&&t.data.launch_mode.contains("from_compass")&&(v=!1)}!0===v&&(n={id:"refresh_search",title:T.get("actions.refresh_search.title"),icon:"cw",overflow:!1,displayMode:"AllView",attributes:{"data-rec-id":"refresh_search"}},!1===l?this.actionCollectionUsedBySkeleton.add(n):this.actionOneSearch.add(n)),(d.getOption("global_action_export_csv")||d.getOption("global_action_export_xml"))&&a("export")&&(s=!0,!0===r&&!0===g.getItem("NoexportOnBar")&&(s=!1),!0===s&&(n={id:"exportToCmd",title:T.get("actions.exportToCmd.title"),icon:"export",overflow:!1,displayMode:"AllView",attributes:{"data-rec-id":"exportToCmd"}},!1===l?this.actionCollectionUsedBySkeleton.add(n):this.actionOneSearch.add(n))),(d.getOption("global_action_default_print")||d.getOption("global_action_print_xsl"))&&a("print")&&(s=!0,!0===r&&!0===g.getItem("NoprintOnBar")&&(s=!1),!0===s&&(n={id:"print",title:T.get("actions.print.title"),icon:"print",overflow:!1,displayMode:"AllView",attributes:{"data-rec-id":"print"}},!1===l?this.actionCollectionUsedBySkeleton.add(n):this.actionOneSearch.add(n))),d.getOption("search_web_in_win")&&(n={id:"BI_Activated",title:T.get("actions.BI_Activated.title"),icon:"chart-pie",overflow:!1,displayMode:"AllView",attributes:{"data-rec-id":"BI_Activated"}},!1===l?this.actionCollectionUsedBySkeleton.add(n):this.actionOneSearch.add(n)),d.getOption("no_kpi_pcs")?this.log("PCS view deactivated"):(n={id:"kpi_pcs_action",title:"PCS",icon:"chart-line",overflow:!1,callback:function(){require(["DS/SNResultUX/views/utils/PCSView"],(function(t){var i=e.extendElement(document.body).getElement(".onesearch_results"),n=e.extendElement(i).getElement(".onesearch_skeleton");n.setStyle("display","none"),new t({renderTo:i,events:{onClose:function(){n.setStyle("display","block")}}})}))},attributes:{"data-rec-id":"kpi_pcs_action"}},!1===l?this.actionCollectionUsedBySkeleton.add(n):this.actionOneSearch.add(n));var w={collection:this.actionCollectionUsedBySkeleton,events:{onActionClick:function(n,s,o){e.is(o)&&e.is(o.stopPropagation,"function")&&o.stopPropagation(),this.dropDown&&this.dropDown.hide(),t.actionItem=s,i.onActionClick(t)},onActionClickDotted:function(){i._cleanPopOver()}}};return this.actionCollectionOriginal=this.actionCollectionUsedBySkeleton.clone(),this.actionCollectionDefault=new I(this.actionCollectionUsedBySkeleton.toJSON()),w},isGlobalActions:function(e){var t=this.globalActions.length,i=0;for(i=0;i<t;i++)if(e===this.globalActions[i])return!0;return this.isNonDefaultGlobalAction(e)},updateGlobalActions:function(){if(e.is(this.actionCollectionOriginal)){var t=new I(this.actionCollectionDefault.toJSON(),{comparator:"index"});this._addNonDefaultGlobalActions(t),this.actionCollectionUsedBySkeleton.reset(),this.actionCollectionUsedBySkeleton.add(t.toArray()),this.actionCollectionOriginal=this.actionCollectionUsedBySkeleton.clone(),t=null,e.is(this.displayMode)&&this.setDisplayMode(this.displayMode)}},_addNonDefaultGlobalActions:function(t){var i=this._getNonDefaultGlobalActions();e.is(i)&&i.forEach((function(i){var n={id:i.id,title:i.title,icon:i.icon,overflow:i.overflow,displayMode:"AllView",index:i.index};e.is(i.displayMode)&&(n.displayMode=i.displayMode),t.add(n)}))},isNonDefaultGlobalAction:function(t){var i=this._getNonDefaultGlobalActions();return!!e.is(i)&&i.some((function(e){if(t===e.id)return!0}))},_runNonDefaultGlobalAction:function(t,i){var n=this;if(!e.is(t))throw new Error("E_INVALIDARG: bad option given to _runNonDefaultGlobalAction method !");var s=this._getNonDefaultGlobalActions();return!!e.is(s)&&s.some((function(e){if(i===e.id){var t=e.command_data;return n.dispatchEvent("onNonDefaultGlobalAction",{id:i,command_data:t}),!0}}))},_getNonDefaultGlobalActions:function(){var t=null,i=N.getViewData();return e.is(i)&&e.is(i.global_actions)&&(t=i.global_actions.actions),t},onActionClick:function(t){var i=this;if(this._cleanPopOver(),!e.is(t)||!e.is(t.actionItem))throw new Error("E_INVALIDARG: bad options given to onActionClick method !");var n=t.actionItem,s=this.current_collection,o=n.model.get("id");switch(o){case"exportToCmd":this.log("exportToCmd in actionbar"),i.exportToCmd(t);break;case"print":this.log("print in actionbar"),i.print(t);break;case"save_search":this.log("save search in actionbar"),i.saveSearchUI(n,s.service_parameters);break;case"refresh_search":this.log("refresh search pressed in global actionbar"),i.dispatchEvent("onRefreshResultRequest");break;case"kpi_pcs_action":n.model.get("callback")();break;case"BI_Activated":this.log("BI is Activated"),this.current_collection._searchcom_socket.dispatchEvent("onDispatchToWin",{notif_name:"BI_Activated",notif_parameters:""},"search_web_in_win");break;case"Grid_Custo":this.log("Grid_Custo"),i.searchSettingsUI(n);break;case"InfoPanel":this.log("InfoPanel"),i.informationPanel(n);break;case"Preview":this.log("Preview"),i.PreviewPanel(n);break;case"Pin":this.log("Pin"),i.PinToDashboard(n);break;default:this._runNonDefaultGlobalAction(t,o)||(this.log("multisel pressed in global actionbar"),i.multisel(t))}},downloadFile:function(t,i,s){if(e.is(t)&&e.is(s)){var o,a=document,r=a.createElement("a"),l=s;if(s=s||"application/octet-stream",s+=";charset=UTF-8,",!i){var c=new Date;i="CSV Export - "+c.getFullYear()+(c.getMonth()+1)+c.getDate()+c.getHours()+c.getMinutes()+c.getSeconds()+".csv"}var d,u="\ufeff";if(navigator.msSaveBlob&&!p.odtMode)return navigator.msSaveBlob(new Blob([u+t],{type:s}),i);"download"in r?(d=new Blob([u+t],{type:s}),o=URL.createObjectURL(d),r.setAttribute("download",i)):(n.Engine.safari&&n.Platform.ios?(d=new Blob([u+t],{type:l}),o=(window.URL?URL:window.webkitURL).createObjectURL(d)):o="data:"+s+u+encodeURIComponent(t),r.setAttribute("target","_blank"),r.setAttribute("download",i)),r.href=o,r.setAttribute("style","display:none;"),a.body.appendChild(r),setTimeout((function(){if(r.click)r.click();else if(document.createEvent){var e=document.createEvent("MouseEvents");e.initEvent("click",!0,!0),r.dispatchEvent(e)}a.body.removeChild(r)}),100)}},exportToCmd:function(t,i){if(l.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:"GlobalAction",persDim:{pd5:"Export"}}}),!e.is(t)||!e.is(t.actionItem))throw new Error("E_INVALIDARG: bad options given to exportToCmd method !");var n=this,s={DoSelection:!1,callback:this.exportToCmdCallback,exportToCmdCallback_options:t,exportToCmdCallback_cb:i,type:"action",subType:"export",context:n};d.getOption("select_all_export_print")&&(!e.is(n.current_selected)||e.is(n.current_selected)&&0===n.current_selected.length)?this.snSkeletonMgt.fetchAll(s):this.exportToCmdCallback(s)},exportToCmdCallback:function(e){d.options.search_settings.global_action_export_csv&&!d.options.search_settings.global_action_export_xml?this.exportToCSV(e.exportToCmdCallback_options,e.exportToCmdCallback_cb):!d.options.search_settings.global_action_export_csv&&d.options.search_settings.global_action_export_xml?this.exportToXML(e.exportToCmdCallback_options):O.warn("Not allowed to activate both export to CSV and export to XML options !!!")},_formatLocalDate:function(){var e=new Date,t=-e.getTimezoneOffset(),i=t>=0?"+":"-",n=function(e){var t=Math.abs(Math.floor(e));return(t<10?"0":"")+t};return e.getFullYear()+"-"+n(e.getMonth()+1)+"-"+n(e.getDate())+"T"+n(e.getHours())+":"+n(e.getMinutes())+":"+n(e.getSeconds())+i+n(t/60)+":"+n(t%60)},exportToCSV:function(t,i){if(!e.is(t))throw new Error("E_INVALIDARG: bad options given to exportToCSV method !");var s=this;function o(o){let r=this.getActiveTenant();var l,c=s.current_collection;e.is(s.current_selected)&&s.current_selected.length>0&&(l=c._models.slice(),c._models=s.current_selected);var h=d.getOption("exportFilename")?d.getOption("exportFilename"):"search_"+s._formatLocalDate().slice(0,19);g.getItemPromise("optionMode",r).then((function(r){s.downloadFile(function(i,o,r){var l,c,h=s.getActiveTenant();e.is(d)&&e.is(d._tenantSettings)&&e.is(d._tenantSettings[h])&&e.is(d._tenantSettings[h].search_settings)&&(l=d._tenantSettings[h].search_settings);c=e.is(l,"object")&&e.is(l.defaultCsvSeparator,"object")&&e.is(l.defaultCsvSeparator.id,"string")?u.getCSVSeparatorValueFromId(h,l.defaultCsvSeparator.id):d.getOption("defaultCsvSeparator");for(var g=e.is(r)&&e.is(r.csvMode)&&""!==r.csvMode.valueItem?r.csvMode.valueItem:c,p="",_=0,f=i.length;_<f;_++)-1===s.attributeToFilterForExport.indexOf(i[_].dataIndex)&&(p=n.Platform.ios?p+'"'+i[_].text+'";':p+'"'+i[_].text+'"'+g);return p+="\r\n",o.forEach((function(o){for(var r=0,l=i.length;r<l;r++)if(-1===s.attributeToFilterForExport.indexOf(i[r].dataIndex)){var c=s._getValueWithMapping(i[r].dataIndex,o,t.itemViewOptions.mapping);if(e.is(c,"array"))for(var d=0,h=c.length;d<h;d++)c[d]=a(c[d]);else c=a(c);c=u.decodeHtml(c),p=n.Platform.ios?p+'"'+c+'";':p+'"'+c+'"'+g}p+="\r\n"})),p}(o,c,r),h+".csv","text/csv"),e.is(i)&&i.call(this),e.is(s.current_selected)&&s.current_selected.length>0&&(c._models=l)}),(function(){e.is(i)&&i.call(this),e.is(s.current_selected)&&s.current_selected.length>0&&(c._models=l)}))}function a(t){return t=(t=t.replaceAll('"','""')).replaceAll("\n"," "),e.is(t,"string")&&t.length>0?t.split("&quot;").join('""'):t}var r=[],l=N.getDataGridViewHeaders();if(e.is(s.snSkeletonMgt)&&e.is(s.snSkeletonMgt.getDataGridView,"function")){var c=s.snSkeletonMgt.getDataGridView();e.is(c)&&e.is(c._columns)&&Object.keys(c._columns).length>0&&(l=c.view.layout.getVisibleOrderedLeafColumns())}for(let e=0,t=(l=this._filterDisplayName(l)).length;e<t;e++)r.push(l[e].dataIndex);var h=this.getActiveTenant();E.getResourcesInfo(r.join(","),{tenantId:h,lang:u.getLanguage(),apiVersion:"R2019x",onComplete:function(t){if(e.is(t,"array")){var i={},n=[];let s,o;for(l.forEach((function(e){var i=e.uri;if(void 0!==i){i.includes("/")?i=i.split("/")[1]:i.includes(":")&&(i=i.split(":")[1]);var s=t.findIndex((function(e){var t=e.curi;return t.includes("/")?t=t.split("/")[1]:t.includes(":")&&(t=t.split(":")[1]),i===t||i.includes(t)||t.includes(i)}));s>-1&&n.push(t[s])}})),e.is(n,"array")&&n.length===t.length&&(t=n),s=0,o=t.length;s<o;s++)e.is(t[s],"object")&&e.is(t[s].curi,"string")&&(i[t[s].curi]=t[s].label);for(s=0,o=l.length;s<o;s++)e.is(l[s],"object")&&e.is(l[s].dataIndex,"string")&&(l[s].text=i[t[s].curi])}t&&o.call(s,l)},onFailure:function(e){O.info(e),e&&o.call(s,l)}})},_filterDisplayName:function(e){var t=[];if(e.length>0)for(let i=0,n=e.length;i<n;i++)"ds6wg:_displayName_"!==e[i].dataIndex&&t.push(e[i]);return t},exportToXML:function(){},print:function(t,i){l.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:"GlobalAction",persDim:{pd5:"Print"}}}),this.log("print");var n=this;if(!e.is(t)||!e.is(t.actionItem))throw new Error("E_INVALIDARG: bad options given to print method !");var s,o=this.current_collection;if(!e.is(o)||!e.is(o.totalCount)||isNaN(o.totalCount))throw new Error("Pb with searchCollection found for print method !");e.is(n.current_selected)&&n.current_selected.length>0&&(s=o._models.slice(),o._models=n.current_selected);var a=o.totalCount;if(!e.is(o._models)||!e.is(o._models.length)||isNaN(o._models.length))throw new Error("No searchCollection._models found for print method !");a!==o._models.length&&O.warn("Not all results are displayed, must refresh the search result, TO DO !!!");var r={DoSelection:!1,callback:this.printCallback,exportToCmdCallback_options:t,exportToCmdCallback_cb:i,type:"action",subType:"print",context:n};d.getOption("select_all_export_print")&&(!e.is(n.current_selected)||e.is(n.current_selected)&&0===n.current_selected.length)?this.snSkeletonMgt.fetchAll(r):this.printCallback(r),e.is(n.current_selected)&&n.current_selected.length>0&&(o._models=s)},printCallback:function(e){d.options.search_settings.global_action_default_print&&!d.options.search_settings.global_action_print_xsl?this._defaultPrint(e.exportToCmdCallback_options,e.exportToCmdCallback_cb):!d.options.search_settings.global_action_default_print&&d.options.search_settings.global_action_print_xsl?this.exportToXML(e.exportToCmdCallback_options,"SearchPrint.xsl"):O.warn("Not allowed to activate both print options !!!")},_printWindowOpen:function(){return void 0!==this.printWindow&&null!==this.printWindow&&!1===this.printWindow.closed},_defaultPrint:function(t,i){if(!e.is(t))throw new Error("E_INVALIDARG: bad options given to _defaultPrint method !");var n=this;function s(){var s=N.getDataGridViewHeaders();e.is(n.snSkeletonMgt)&&e.is(n.snSkeletonMgt._myDatagridView)&&e.is(n.snSkeletonMgt._myDatagridView._columns)&&Object.keys(n.snSkeletonMgt._myDatagridView._columns).length>0&&(s=n.snSkeletonMgt._myDatagridView._columns),function(s){var o,a=n.current_collection,r="";e.is(n.current_selected)&&n.current_selected.length>0&&(o=a._models.slice(),a._models=n.current_selected),e.is(n.snSkeletonMgt)&&(r=n.snSkeletonMgt.getTitle()),!0===t.ODT&&e.is(t.PrintWindow,"object")&&(n.myPrintWindow=t.PrintWindow);var l="";n._printWindowOpen()&&n.myPrintWindow.close(),setTimeout((function(){if(!0===t.ODT&&e.is(t.PrintWindow,"object")||(n.myPrintWindow=window.open("","PrintWindow","width=1024, height=768, scrollbars=yes")),void 0!==n.myPrintWindow){n.snSkeletonMgt.setPrintWindow(n.myPrintWindow),l+="<html><head><title>Print Me</title></head><body>",l+="<h1>"+r+"</h1>",l+='<table style="border:1px solid black; border-collapse:collapse; table-layout:fixed; width: -webkit-fill-available; word-break: break-all; font-size: xx-small; white-space: pre-wrap;"><thead><tr>';for(var i=0,o=s.length;i<o;i++)-1===n.attributeToFilterForExport.indexOf(s[i].dataIndex)&&(l+='<th  style="border:1px solid black; background-color:#A7C942; text-align:left; color:#FFFFFF; font-size:1.1em; padding-top:5px; paddingbottom:4px;"><div style="',e.is(s[i].width)&&R(s[i].width)&&(l+=" width:"+s[i].width+"px; overflow-wrap: break-word"),l+='">'+s[i].text+"</div></th>");l+="</tr></thead><tbody>",a.forEach((function(i){l+="<tr>";for(var o=0,a=s.length;o<a;o++)if(-1===n.attributeToFilterForExport.indexOf(s[o].dataIndex)){var r=n._getValueWithMapping(s[o].dataIndex,i,t.itemViewOptions.mapping);l+='<td style="border:1px solid black;"><div style="',e.is(s[o].width)&&R(s[o].width)&&(l+=" width:"+s[o].width+"px; overflow: hidden"),l+='">'+r+"</div></td>"}l+="</tr>"})),l+="</tbody></table></body></html>",e.is(n.myPrintWindow)?(n.myPrintWindow.document.write(l),n.myPrintWindow.document.close(),n.myPrintWindow.focus(),p.odtMode||n.myPrintWindow.print()):n._displayAlert({message:T.get("actions.print.window.popup.error"),className:"primary"})}else this.log("Unable to open window !")}),0),e.is(i)&&i.call(this),e.is(n.current_selected)&&n.current_selected.length>0&&(a._models=o)}(s)}var o=[],a=N.getDataGridViewHeaders();for(let e=0,t=a.length;e<t;e++)o.push(a[e].dataIndex);var r=this.getActiveTenant();E.getResourcesInfo(o.join(","),{tenantId:r,lang:u.getLanguage(),apiVersion:"R2019x",onComplete:function(t){if(e.is(t,"array")){var i={};let n,s;for(n=0,s=t.length;n<s;n++)e.is(t[n],"object")&&e.is(t[n].curi,"string")&&(i[t[n].curi]=t[n].label);for(n=0,s=a.length;n<s;n++)e.is(a[n],"object")&&e.is(a[n].dataIndex,"string")&&(a[n].text=i[a[n].dataIndex])}t&&s.call(n)},onFailure:function(e){O.info(e),e&&s.call(n)}})},informationPanel:function(){l.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:"GlobalAction",persDim:{pd5:"Information Panel"}}}),this.dispatchEvent("onInformationPanelAction")},PreviewPanel:function(){this.dispatchEvent("onPreviewPanelAction")},PinToDashboard:function(){l.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:"GlobalAction",persDim:{pd5:"PinToDashboard"}}});this.dispatchEvent("onPinToDashboardAction")},_listUISettingsToDisplay:function(){var t=this,i=[];if(!e.is(t.snSkeletonMgt))return i;var n,s=d.getSettingsToDisplayInUI(),o=e.is(t.snSkeletonMgt.getOption("in_apps_search"),"object"),a="true"!==t.snSkeletonMgt.getOption("transient_context")&&!0!==t.snSkeletonMgt.getOption("transient_context"),r=d.getOption("nav_history"),l=d.getOption("integratedSearch");e.is(t.snSkeletonMgt.getSearchWidget,"function")&&e.is(t.snSkeletonMgt.getSearchWidget())&&(n=t.snSkeletonMgt.getSearchWidget().getValue("launch_mode"));var c={addinMode:t.snSkeletonMgt.getOption("addinMode"),inContextSearch:e.is(t.snSkeletonMgt.getOption("in_apps_search"),"object"),isPinnedWidget:"true"!==t.snSkeletonMgt.getOption("transient_context")&&!0!==t.snSkeletonMgt.getOption("transient_context")},h=null,g=u.identifyClientInfo(c.addinMode);e.is(g,"object")&&(h=g.identifier);for(var p=function(t){var i=!0;switch(t){case"search_tabbed_ui":switch(h){case"3DSpace":i=!1;break;case"3DDashboard":a&&(i=!1);break;case"3DEXPERIENCE":o&&(i=!1)}break;case"nav_history":if(!1===r){i=!1;break}switch(h){case"3DSpace":case"3DSwym":case"3DEXPERIENCE":i=!1;break;case"3DDashboard":(o||a)&&(i=!1)}break;case"integratedSearch":switch(e.is(l)&&!1===l?i=!1:n!==u.widgetLaunchMode.COMPASS_TRANSIENT&&n!==u.widgetLaunchMode.COMPASS_PINNED||(i=!1),h){case"3DSpace":case"3DSwym":case"3DEXPERIENCE":i=!1;break;case"3DDashboard":a&&(i=!1)}break;case"search_date_region":i=!1,!0===d.getOption("activate_search_date_region")&&(i=!0);break;case"csvSeparatorUI":i=!0}return i},_=0;_<=s.length;_++)e.is(s[_])&&e.is(s[_].optionID)&&e.is(s[_].optionLabel)&&p(s[_].optionID)&&i.push(s[_]);return i},searchSettingsUI:function(t){if(!e.is(this.immersiveFrame)){this.immersiveFrame=new k({reactToPointerEventsFlag:!1});var i=document.body;this.immersiveFrame.inject(i)}this._fillOptionsPanel(t)},_fillOptionsPanel:function(t){let i=this;if(l.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:"GlobalAction",persDim:{pd5:"Setting"}}}),!e.is(t))throw new Error("E_INVALIDARG: bad custoActionItem given to searchSettingsUI method !");if(e.is(t.isError)&&!0===t.isError)return void(this._isSecurityContextChosenAfterError=!0);let n=this.getActiveTenant();this._cleanPopOver();let s=new S({tenant:n,skeletonMgt:this.snSkeletonMgt});this.popover=s;let o="table"===this.displayMode,a=f.isBETAEnabled();var r=null;d.getOption("global_action_column_custo")&&i._shouldBeAvailableIfInContextMode({in_apps_search:i.snSkeletonMgt.getOption("in_apps_search")},"columnCusto")?u.isRoleAvailable(["CSV","InternalDS"],n,(function(e){!0===e?(a&&!0===d.getOption("search_web_in_win")?r=i._renderNewCustoTab():!a&&o&&(r=i._renderLegacyTableCustoTab()),(a&&!0===d.getOption("search_web_in_win")||!a&&o)&&(!0!==i._isSecurityContextChosenAfterError?s.addTab({label:T.get("actions.Options.custoTab"),content:r,index:0,isSelected:!0}):s.addTab({label:T.get("actions.Options.custoTab"),content:r,index:0}))):s.value(0)})):s.value(0)},_renderLegacyTableCustoTab:function(){let t=this,i=this.getActiveTenant(),n={isPQ:!1,typeName:""};if(e.is(t.current_collection)){let i=t.current_collection.getPQ();e.is(i)&&(n={isPQ:!0,typeName:i})}let s=t.snSkeletonMgt.getDataGridView();e.is(s)&&e.is(s._forcedCustoView,"string")&&(n.forcedCusto=s._forcedCustoView);var o=_.getAvailableColumnCustomization(n,i);e.is(o)&&o.length>0&&o.splice(0,0,{label:T.get("RESTORE_DEFAULT"),value:"The_Default_Columns"});let r=a.create("div",{class:"search-options-tab",id:"search-options-tab-custo"});return new b({className:"search-options-custo-select",nativeSelect:!0,placeholder:T.get("dataGrid.columnCustoPanel.existingCustoComboPlaceHolder"),options:o,events:{onChange:function(){let s=t._getDataGridView(),o=this.getValue(),a=null;if(e.is(o,"array")&&o.length>0&&(a=o[0]),0===a.length)return;"DEFAULT"===a&&(e.is(n)&&(n.forcedCusto="DEFAULT"),a=_.getColumnCustomizationIdToUse(n)),g.removeItem("listColumnsWidth");let r={custoName:a,custoId:a};if(r.custoName.endsWith("-ADMIN")&&(r.custoName=r.custoName.slice(0,-6)),a.startsWith("###")){let e=r.custoName.substring(3,r.custoName.length);r.custoName=T.replace(T.get("custo_PQ"),{PQ:e})}if(e.is(s)&&e.is(_.defineColumnCusto,"function")){let e=_.getColumnCustomizationDefinitionFromCustoId(a,i);s._updateColumns(e,r,!1)}t._cleanPopOver()}}}).inject(r),a.create("a",{id:"show-custo-manager",title:T.get("custo_chooser_manage_custos_tooltip"),href:"#",html:T.get("custo_chooser_manage_custos")}).inject(r).addEvent("click",(function(e){e.preventDefault(),e.stopPropagation(),t._cleanPopOver(),t.columnCustomizationDefinitionUI()})),r},_renderNewCustoTab:function(){let t=this,i=a.create("div",{class:"search-options-tab",id:"search-options-tab-custo"}),n=a.create("div",{class:"search-options-tab"}).inject(i);a.create("div",{class:"label-container-title",text:T.get("Tab.setting.customization")}).inject(n);let s=a.create("div",{class:"search_options_column_tab_div search_options_margin"}).inject(i);a.create("div",{class:"label-container search_options_div_left",text:T.get("Tab.setting.active.customization")}).inject(s);let o=a.create("div",{class:"option-container-custo search_options_div_right"}).inject(s),r=f.buildUserCustomizationList(),c=f.getActiveCustomization();if(e.is(c))var d=c.customizationId||c.getCustomizationId(),h=r.findIndex((e=>e===d));let g=r[h]||"Default",p=new C({elementsList:r,currentValue:g,touchMode:!0,enableSearchFlag:!1}).inject(o);if("mobile"!==u.getDeviceType()&&"tablet"!==u.getDeviceType()){new y({icon:{iconName:"cog",fontIconSize:"1x"}}).inject(o).addEventListener("click",function(){(new m).setup({isSCC:!1})}.bind(this))}return p.addEventListener("change",(function(e){let i=p.elementsList[p.selectedIndex];g!==i&&(f.switchActiveCustomization(i),t.dispatchEvent("onRefreshResultRequest"),t._cleanPopOver())})),l.subscribe({channel:"3dSearch_results_customization",topic:"3dSearch_new_customization_in_localStorage",callback:()=>{e.is(p)&&(p.elementsList=f.buildUserCustomizationList())}}),l.subscribe({channel:"3dSearch_results_customization",topic:"3dSearch_customization_deleted_from_localStorage",callback:()=>{e.is(p)&&(p.elementsList=f.buildUserCustomizationList())}}),i},_getDataGridView:function(){var t=null;if(e.is(this.skeleton)&&e.is(this.skeleton.getViewAt,"function")){var i=this.skeleton.getViewAt(0);if(e.is(i)){var n=i.currentViewId;"table"===n&&e.is(i.contentsViews,"object")&&e.is(i.contentsViews[n])&&(t=i.contentsViews[n].nestedView)}}return t},columnCustomizationDefinitionUI:function(){var t=this,i=t._getDataGridView();e.is(i)&&e.is(_.defineColumnCusto,"function")&&(t.maskedElement=t.snSkeletonMgt.options.renderTo,_.defineColumnCusto(i))},updateDatagridObjInCusto:function(){let t=this._getDataGridView();e.is(t)&&_.updateDatagridTargetObj(t)},removeMask:function(){this.maskedElement=null},logOut:function(){if(this.log("logOut"),e.is(this.current_collection)&&e.is(this.current_collection.getSearchRessources())){var t=this.current_collection.getSearchRessources().getFetchOptions({service_name:"logOut"}),i=t.url,n={onComplete:function(){O.log("SearchAction: logout success")},onFailure:function(){O.warn("SearchAction: logout failure")}};n=e.extend(t,n,!0),c.authenticatedRequest(i,n)}},saveSearchUI:function(t,i){if(l.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:"GlobalAction",persDim:{pd5:"Favorite Search"}}}),!e.is(t))throw new Error("E_INVALIDARG: bad saveActionItem given to saveSearchUI method !");var n,s,o,r,c=this,h=!1;e.is(c.current_collection.service_parameters.query)&&u.SearchTypeEnum.MY_RECENT_CONTENT===c.current_collection.service_parameters.query&&(h=!0),h?(s=a.create("div",{class:"divNewSearch form-group",html:{for:"newSaveSearchName",html:T.get("save_search_not_supported")}}),o=a.create("form",{class:"formSaveSearch form-inline",styles:{width:"180px"}}),s.inject(o),a.create("hr").inject(o)):(s=a.create("div",{class:"divNewSearch form-group",html:{tag:"label",for:"newSaveSearchName",class:"saveSearchEdt",html:T.get("save_search_name")},styles:{width:"100%"}}),o=a.create("form",{class:"formSaveSearch form-inline",styles:{width:"180px"}}),s.inject(o),e.is(i)&&((r=new v({placeholder:T.get("save_search_default_text"),class:"newSaveSearchName",events:{onKeyDown:function(e){13===e.keyCode&&e.preventDefault()},onKeyUp:function(t){let s=this.elements.input.value.trim().length;if(e.is(n)&&e.is(n.buttons))if(s<1)n.buttons.Ok.disabled=!0;else{if(13===t.keyCode)t.preventDefault(),t.stopPropagation(),!1!==c.saveSearch(this.elements.input.value,i)&&c._cleanPopOver();n.buttons.Ok.disabled=!1}}}})).setId("newSaveSearchName").inject(s),r.getSuggestions=function(){})),a.create("a",{id:"show-favorites-searches",title:T.get("my_fav_searches_tooltip"),class:"saveSearchHyperlink",href:"#",html:T.get("my_fav_searches"),styles:{display:"block"}}).inject(o).addEvent("click",(function(e){e.preventDefault(),e.stopPropagation(),c._cleanPopOver(),c.dispatchEvent("onClickFavSearchTopBar"),d.getOption("search_web_in_win")&&c.dispatchEvent("onRefreshResultRequest",{criteria:{search_crit:u.SearchTypeEnum.FAVORITE_SEARCH,originalSearchCriteria:T.get("my_fav_searches"),search_name:T.get("my_fav_searches"),queryType:u.SearchTypeEnum.FAVORITE_SEARCH}})}));var g=t.getContent();if(!1===t.model.get("visible")){var p=e.extendElement(this.searchContentSetDivContainer);if(e.is(p)){var _=p.getElements(".fonticon-dot-3");e.is(_,"array")&&1===_.length&&(g=_[0])}}this.popover=new D({title:T.get("save_search_panel_title"),identifier:"fav-search-popover",position:{at:"bottom",of:g,collision:"fit",offsetX:-200},content:s.getParent(),buttons:{Ok:new y({domId:"okSaveSearch",label:T.get("OKButton"),disabled:!0,onClick:function(){!1!==c.saveSearch(r.elements.input.value,i)&&c._cleanPopOver()}}),Cancel:new y({domId:"cancelSaveSearch",label:T.get("CancelButton"),onClick:function(){c._cleanPopOver()}})}}),n=this.popover,t.savePanel=n,n.elements.container.addClassName("fav-search-popover"),n.elements.container.setStyle("z-index",4e3),n.inject(document.body),n.addEventListener("close",(function(e){e.stopPropagation(),c._cleanPopOver(),n.immersiveFrame.destroy()})),V(this.popover.elements.container),n.show(),e.is(r)&&r.elements.input.focus()},saveSearch:function(t,i){var n=this;if(this.log("saveSearch"),e.is(t,"string")){if(t.indexOf("<")>=0||t.indexOf(">")>=0)return t=(t=t.replace(/</g,"&lt;").replace(/>/g,"&gt;")).replace(/&lt;/g,'<em style="color:red">&lt;</em>').replace(/&gt;/g,'<em style="color:red">&gt;</em>'),o(0,'{"Error": "'+T.get("save_search_invalid_character")+'"}'),!1;if(!n._isValidInput(t))return o(0,'{"Error": "'+T.get("save_search_error_invalid_chars")+'"}'),!1;if(t.length>128)return o(0,'{"Error": "'+T.get("save_search_error_exeeds_maximum_char_limit")+'"}'),!1;var s={query:i.query,originalSearchCriteria:i.originalSearchCriteria,search_criteria_to_display:i.search_criteria_to_display};this.log("searchName="+t),this.log("searchParam.search_criteria="+i.query),this.log("searchParam.tagger_criteria="+i.refine),e.is(this.current_collection)&&e.is(this.current_collection.getSearchRessources())&&h.getSecurityContextPromise(n.current_collection.getSearchRessources()).then((function(){var a={service_name:"saveSearch",service_data:{name:t,searchSpec:s,taggerSpec:i.refine,searchOptions:{source:i.source},originalSearchCriteria:i.originalSearchCriteria}};i.order_by&&i.order_field&&(a.service_data.searchOptions.order_by=i.order_by,a.service_data.searchOptions.order_field=i.order_field);var r=n.current_collection.getSearchRessources().getFetchOptions(a),l=r.url,d={onComplete:function(t){var i=e.Json.decode(t);e.is(i)&&n._displayAlert({message:T.replace(T.get("save_search_successful"),{searchId:i.name}),className:"success saveSearchAlert"})},onFailure:o};d=e.extend(r,d,!0),c.authenticatedRequest(l,d)}))}function o(i,s){var o=T.replace(T.get("save_search_failure"),{searchId:t});if(e.is(s,"string"))try{var a=JSON.parse(s);e.is(a)&&e.is(a.Error)?o+="<br>"+a.Error:e.is(a)&&e.is(a.errorCode)&&(o+="<br>"+T.replace(T.get("save_search_error_"+a.errorCode),{name:t,invalidCharString:a.invalidChar}))}catch(e){O.error("Error parsing errorObject:",e)}n._displayAlert({message:o,className:"error saveSearchAlert"})}},getSavedSearches:function(t,i){var n=this;if(this.log("getSavedSearches"),e.is(this.current_collection)&&e.is(this.current_collection.getSearchRessources())){var s=this.current_collection.getSearchRessources().getFetchOptions({service_name:"getSavedSearches"}),o=s.url,a={type:"json",authentication:{passport_target:"enovia"},onComplete:function(t,s){e.is(t)&&n.log(t),e.is(s)&&n.log(s);var o=[];if(e.is(t.searches)){for(var a=0,r=t.searches.length;a<r;a++){var l=t.searches[a],c={save_object:{}};e.is(l.name)&&(c.save_object.name=l.name),e.is(l.id)&&(c.save_object.id=l.id),e.is(l.searchstring)&&(c.save_object.search_criteria=l.searchstring),e.is(l.taggerstring)&&(c.save_object.tagger_criteria=decodeURIComponent(l.taggerstring)),o.push(c)}e.is(i,"function")&&i(o)}},onFailure:function(e){n._displayAlert({message:T.replace(T.get("save_search_retrieval_failure"),{response:e}),className:"error"})}};e.extend(a,s,!0),(d.getOption("search_web_in_win")||this.jetty_server_activated)&&this.log("Jetty server activated or Search Web in Win context"),c.authenticatedRequest(o,a)}},deleteSearch:function(t,i){var n=this;if(n.log("deleteSearch"),e.is(this.current_collection)&&e.is(this.current_collection.getSearchRessources)){var s=this.current_collection.getSearchRessources().getFetchOptions({service_name:"deleteSearch",service_data:{id:t}}),o={onComplete:function(){i()},onFailure:function(e){n.log("Failed to delete search "+t+" !",e)},onCancel:function(){n.log("Search deletion canceled !")},onTimeout:function(e){n.log("Search deletion timeout !",e)}};o=e.extend(s,o,!0),c.authenticatedRequest(o.url,o)}},_getValueWithMapping:function(t,i,n){var s=null;if(!e.is(t))return s;if(t in n&&e.is(n[t],"function")){var o={model:i};s=n[t].call(o)}else{try{s=i.get(t)}catch(e){O.warn("Exception raised",e)}if(void 0===s){try{s=i.get(t.slice(t.lastIndexOf("/")+1,t.length))}catch(e){O.warn("Exception raised",e)}if(void 0===s)if(s="",e.is(i)&&e.is(i.isAShowOnlyObject,"function")&&i.isAShowOnlyObject())s=T.get("no_access")}}return s=s?this.unescapeHTML(s):s},updatePopoverPosition:function(){var t;e.is(this.popover)&&(e.is(this.popover.options)&&e.is(this.popover.options.target)&&e.is(this.popover.options.target.getPosition,"function")?0!==(t=this.popover.options.target.getPosition(document.body)).x||0!==t.y?this.popover.updatePosition():this.popover.hide():e.is(this.popover._properties)&&e.is(this.popover._properties.position)&&e.is(this.popover._properties.position.value)&&e.is(this.popover._properties.position.value.of)&&e.is(this.popover._properties.position.value.of.container)&&e.is(this.popover._properties.position.value.of.container.getPosition,"function")&&(0===(t=this.popover._properties.position.value.of.container.getPosition(document.body)).x&&0===t.y||(this.popover.updatePosition?this.popover.updatePosition():this.popover.setAbsolutePosition(t))))},_displayAlert:function(e){e.delay=4e3,p._displayAlert(e)},_checkCSVAvailability:function(t){var i=this;return d.getOption("search_web_in_win")?(i.CSVpromise.resolve([]),i.CSVpromise.promise):(u.getGrantedRoles((function(n){for(var s=!1,o=0;o<n.length;o++){var a=n[o];if(e.is(a)&&e.is(a.platforms,"array")&&(0===a.platforms.length||a.platforms.indexOf(t)>=0&&"CSV"===a.id)){s=!0;break}}s?i.CSVpromise.resolve(n):i.CSVpromise.reject(n)})),this.CSVpromise.promise)},_cleanPopOver:function(){e.is(this.popover)&&(e.is(this.popover.destroy,"function")?(this.popover.destroy(),this.popover=null):e.is(this.popover.hide,"function")&&(this.popover.hide(),this.popover=null))},_isValidInput:function(e){let t=d.getOption("favorites_name_not_allowed_chars");return this._match(e,t.join(""))},_match:function(e,t){for(let i=0;i<e.length;i++)if(-1!==t.indexOf(e[i]))return!1;return!0},unescapeHTML(e){let t=JSON.parse(x),i=t.matchString;const n=t.replaceString.split("|").join("|"),s=new RegExp(n,"g");return e.replace(s,(e=>i[e]||e))}})})),define("DS/SNResultUX/utils/OneSearchActions",["UWA/Core","UWA/Class/Debug","UWA/Controls/Abstract","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/UIKIT/DropdownMenu","DS/SNResultUX/utils/SearchViewOptions","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchVersioning"],(function(e,t,i,n,s,o,a,r,l){"use strict";return i.extend(t,{_view:null,_container:null,_searchActions:null,_defaultItem:[],_activation:!1,init:function(e){this._parent(e),this._defaultItem=[],e&&e.container&&(this._container=e.container,this._collection=e.collection,this._searchActions=e.searchActions,this.options=e,"tablet"===r.getDeviceType()&&"portrait"===r.getViewportOrientation()?this.defaultItemsTablet():this.defaultItems(),this.render())},render:function(){let t=this;e.is(t._searchActions)&&e.is(t._container)&&(this._view=new s({className:"one_search_actions",target:t._container,events:{onClick:function(i,n){if(i.stopPropagation(),!e.is(n))return;let s=n.id,a=t._searchActions.snSkeletonMgt;if("select_all"===s||"unselect_all"===s||"preview"===s){if(e.is(a)){let e=[{id:s,sourcejs:"DS/SNResultUX/utils/Select_ActionHandler"}];a._handleAction(0,void 0,e)}}else if("help_search"===s){let e=l.getCurrentRelease().slice(1);window.open("http://help.3ds.com/HelpDS.aspx?P=11&V="+e+"&L="+r.getLanguage()+"&F=EXP3DBasicsUserMap/exp3dbasics-m-Searching-for-content-sb.htm","_blank","popup")}else{let e={actionItem:{model:{get:function(){return s}},getContent:function(){return t._container}},itemViewOptions:o.getItemViewOptions(a.getOption("resources"))};t._searchActions.onActionClick(e)}},onShow:function(){t._activation=!0,t._container.firstChild.addClassName("active");let i=t._searchActions.snSkeletonMgt;if(e.is(i)){let t=i._skeleton.getViewAt(0).currentViewId;e.is(t)&&this.items.forEach((function(n){if(e.is(n)&&e.is(n.id))if("exportToCmd"===n.id)"table"===t?n.elements.container.setStyle("display","inline-block"):n.elements.container.setStyle("display","none");else if("Grid_Custo"===n.id)(void 0!==i.getOption("addinMode")||e.is(i.getOption("in_apps_search"),"object"))&&("table"===t?n.elements.container.setStyle("display","inline-block"):n.elements.container.setStyle("display","none"));else if("select_all"===n.id||"unselect_all"===n.id){let t=i._model.getXSO().get();if(e.is(t)){let s=t.length,o=e.is(i._onesearch_collection)&&e.is(i._onesearch_collection.totalCount)?i._onesearch_collection.totalCount:0;"select_all"===n.id&&(s!==o?n.elements.container.setStyle("display","inline-block"):n.elements.container.setStyle("display","none")),"unselect_all"===n.id&&(0===s?n.elements.container.setStyle("display","none"):n.elements.container.setStyle("display","inline-block"))}}else if("Pin"===n.id){let t=i.getSearchWidget(),s=r.identifyClientInfo();e.is(t)&&0!==t.id.indexOf("preview")||"3DSwym"===s.identifier?n.elements.container.setStyle("display","none"):n.elements.container.setStyle("display","inline-block")}}))}},onHide:function(){t._container.firstChild.removeClassName("active")}},items:t._defaultItem}))},defaultItems:function(){let t=this;if(!e.is(t._searchActions)||!e.is(t._container))return;let i=t._searchActions.actionOneSearch;if(e.is(i)){let s=i._byId;if(e.is(s)){let i=s.refresh_search;if(e.is(i)&&t._defaultItem.push({text:n.get("actions.refresh_search.title"),id:"refresh_search",fonticon:"fonticon fonticon-cw"}),i=s.Grid_Custo,e.is(i)&&t._defaultItem.push({text:n.get("actions.Grid_Custo.title"),id:"Grid_Custo",fonticon:"fonticon fonticon-cog"}),i=s.save_search,e.is(i)){let s=i.get("visible");e.is(s)?!0===s&&t._defaultItem.push({text:n.get("actions.save_search.title"),id:"save_search",fonticon:"fonticon fonticon-star"}):t._defaultItem.push({text:n.get("actions.save_search.title"),id:"save_search",fonticon:"fonticon fonticon-star"})}i=s.exportToCmd,e.is(i)&&t._defaultItem.push({text:n.get("actions.exportToCmd.title"),id:"exportToCmd",fonticon:"fonticon fonticon-export"}),i=s.BI_Activated,e.is(i)&&t._defaultItem.push({text:n.get("actions.BI_Activated.title"),id:"BI_Activated",fonticon:"fonticon fonticon-chart-pie"}),i=s.kpi_pcs_action,e.is(i)&&t._defaultItem.push({text:"PCS",id:"kpi_pcs_action",fonticon:"fonticon fonticon-chart-line"}),i=s.Pin,e.is(i)&&t._defaultItem.push({text:n.get("actions.Pin.title"),id:"Pin",fonticon:"fonticon fonticon-pin"})}}t._defaultItem.push({text:n.get("selectAllTitle"),id:"select_all",fonticon:"fonticon fonticon-select-on"}),t._defaultItem.push({text:n.get("unselectAllTitle"),id:"unselect_all",fonticon:"fonticon fonticon-select-off"}),t._defaultItem.push({text:n.get("help"),id:"help_search",fonticon:"fonticon fonticon-help"})},defaultItemsTablet:function(){this._defaultItem.push({text:n.get("actions.Pin.title"),id:"Pin",fonticon:"fonticon fonticon-pin"})},destroy:function(){e.is(this._view)&&e.is(this._view.destroy,"function")&&(this._view.destroy(),delete this._view),this._parent()}})})),define("DS/SNResultUX/views/helpers/utils/SearchGlobeViewUtils",["UWA/Core","DS/MessageBus/MessageBus","WebappsUtils/WebappsUtils","DS/SNInfraUX/SearchLogin","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/SNResultUX/utils/ContentLocationServices","DS/SNResultUX/views/helpers/utils/SearchMultiViewUtils","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],(function(e,t,i,n,s,o,a,r,l,c){"use strict";function d(t,i,n,s,o,a){if(!e.is(n)||!e.is(s)||!e.is(t))return;if("Emptycountry"===o)return;let r=t;s.clearCountries();let l,c=g(n);var d=n.getTaggerProxy();e.is(d)&&p(i,{onComplete:function(t){e.is(c)&&e.is(c.filters)?(e.is(c.index)&&-1!==c.index&&(c.filters.condition[c.index]=t),l=c.filters):l={condition:[t],operator:"AND",isSimplified:{version:2}},r.mask(),d.setLocalFilter(l,!0),o="Emptycountry"}},a);return o}function u(t,i,n,s,o,a){if(!(e.is(i)&&e.is(n)&&e.is(s)&&e.is(a)&&e.is(t)))return;let r=t,l=g(n),c=n.getTaggerProxy();if(e.is(c)&&e.is(l)&&e.is(l.filters)){let t=l.filters;p(i,{onComplete:function(n){e.is(n)&&(t.condition&&t.condition.push(n),r.mask(),c.setLocalFilter(t,!0),i)}},a)}}function h(t,i,n,s,o,a){if(!(e.is(i)&&e.is(n)&&e.is(o)&&e.is(t)))return;if(s===i)return!0;let r=t,l=n.getTaggerProxy();if(e.is(l)){let t="DS/TagNavigator/simplified/utils/LocationUtils",s=o[i];require([t],(function(t){let o={displayValue:s,type:"string",uri:s,predicate:"ds6w:where/ds6w:location/computedCountryInfo"},c=t.buildCondition(o);if(c.condition=[c.condition],e.is(c)&&e.is(c.condition)){let t=c.condition[0];if(e.is(t)){t.display=s,t.object=[i];let o=a[i];if(e.is(o)){let i=o.countries;if(e.is(i)){let s=Object.keys(i),o=s.length;for(var d=0;d<o;d++){let n=i[s[d]];if(e.is(n)){var u=n.person;e.is(u,"array")&&u.forEach((function(e){t.value.push(e.get("title"))}))}}t.value.forEach((function(){t.predicates.push({type:"string",predicate:"ds6w:who/ds6w:responsible"})}));let a={condition:[{"ds6w:where/ds6w:location/computedCountryInfo":c}],operator:"AND",isSimplified:{version:2}},h=g(n);e.is(h)&&e.is(h.filters)&&(e.is(h.index)&&-1!==h.index&&h.filters.condition.splice(h.index,1),h.filters.condition.push({"ds6w:where/ds6w:location/computedCountryInfo":c}),a=h.filters),r.mask(),l.setLocalFilter(a,!0)}}}}}))}return!1}function g(t){if(e.is(t)){var i=t.getTaggerProxy();if(e.is(i)){let t=i.getCurrentFilter();if(e.is(t)){let i=t.localfilters;if(e.is(i)){for(let t=i.condition.length-1;t>=0;t--){let n=i.condition[t];if(e.is(n)){let e=Object.keys(n);e&&e.length&&"ds6w:where/ds6w:location/computedCountryInfo"!==e[0]&&i.condition.splice(t,1)}}return{filters:i}}}}}}function p(t,i,n){if(!e.is(t))return;require(["DS/TagNavigator/simplified/utils/LocationUtils"],(function(s){let o={displayValue:t,type:"string",uri:t,predicate:"ds6w:where/ds6w:location/computedCountryInfo"},a=s.buildCondition(o);if(a.condition=[a.condition],e.is(a)&&e.is(a.condition)){let o=a.condition[0];if(e.is(o)){let r=n[t];if(e.is(r)){let t=r.person;e.is(t,"array")&&t.forEach((function(e){o.value.push(e.get("title"))}))}else o.value.push(t);if(e.is(r)){let n=s.getCountryInfo(r.countryCode),l=n&&n.continent,c="ds6w:country."+r.countryCode;o.display=t,o.object=[l,c],o.type="string",o.value.forEach((function(){o.predicates.push({type:"string",predicate:"ds6w:who/ds6w:responsible"})})),i&&e.is(i.onComplete,"function")&&i.onComplete.call(this,{"ds6w:where/ds6w:location/computedCountryInfo":a})}}}}))}function _(t,i,n,s,o,a,r,l){if(!e.is(i))return;i.clearMarkers(),i.clearCountries(),v(r);let d=[],u=t;e.is(u)||(u=n);let h=Object.keys(u),g=h.length;for(let t=0;t<g;t++){let n=h[t],g=u[n];if(e.is(g)){let t=s.find((e=>e.countryCode===g.countryCode));if(e.is(t)&&e.is(t.pos)){let s=parseFloat(t.pos.latitude),u=parseFloat(t.pos.longitude);var p={uuid:n,descriptionType:"txt",image:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAGUExURQAAAAAAAKVnuc8AAAACdFJOU/8A5bcwSgAAAAlwSFlzAAAOwwAADsMBx2+oZAAAAz5pVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+DQo8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA2LjAtYzAwMiA3OS4xNjQ0NjAsIDIwMjAvMDUvMTItMTY6MDQ6MTcgICAgICAgICI+DQogIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+DQogICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIxLjIgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjExRDgzOUIwN0MzNzExRUJCQ0VDQTNDMjE3QjdBQjUwIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjExRDgzOUIxN0MzNzExRUJCQ0VDQTNDMjE3QjdBQjUwIj4NCiAgICAgIDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjExRDgzOUFFN0MzNzExRUJCQ0VDQTNDMjE3QjdBQjUwIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjExRDgzOUFGN0MzNzExRUJCQ0VDQTNDMjE3QjdBQjUwIiAvPg0KICAgIDwvcmRmOkRlc2NyaXB0aW9uPg0KICA8L3JkZjpSREY+DQo8L3g6eG1wbWV0YT4NCjw/eHBhY2tldCBlbmQ9InIiPz5CqkeQAAAAJElEQVQ4T2NgJBKMKsQLRhXiBaMK8YJRhXjBqEK8YPArZGQEAAyUBkHVJODYAAAAAElFTkSuQmCC"};let h=g.count,_=c.replace(c.get("SearchGlobe_continent_results"),{nbResult:h});1===h&&(_=c.replace(c.get("SearchGlobe_continent_result"),{nbResult:h})),_=n+": "+_;let m=i.addMarker(s,u,0,"darkblue",h,_,p);e.is(m)&&f(m,d,o,a,i,r,!(!e.is(l)||l.countryCode!==g.countryCode))}}}return d}function f(n,s,o,a,r,l,c){if(e.is(s)&&e.is(n)){var d=new a(o);d.markerPanel.addClassName("Search-MarkerInfo"),d.markerPanel.addEventListener("click",(function(i){!function(i,n){if(!e.is(i)||!e.is(n))return;let s=n,o=(i.lon,i.lat,i.uuid),a=s._globe,r=(s._listOfMarkerInfo,s._collection),l=s._latRefine,c=s._continents,d=s._continentsList,g=(s._continentsPos,s._ClusterSetFromTopbar);s._ClusterSet,s._countries,s._container,s._MarkerInfo;if(!0===s._3DExperienceSelected)return;k(n),e.is(o)&&o.length&&(2===o.length?(h(s,o,r,l,c,d),s._latRefine=o,t.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"clickOnContinentCategory",persDim:{pd1:e.is(c,"object")?c[o]:o,pd2:"Globe View"}}})):(u(s,o,r,a,0,g),s._latRefine=o,t.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"clickOnCountryCategory",persDim:{pd1:o,pd2:"Globe View"}}})))}(n,l)})),d.show=function(t,n,s){let a=O(l),r=P(l),d=o.getDimensions().width+20;if(this.markerPanelDisplayed=t,this.markerPanel.empty(),t&&n&&n.isValidContent()&&s[1]>10&&s[0]<d&&s[0]>0){let t=this.markerPanel.getChildren();t&&0===t.length&&(t=new e.Element("div",{class:"SearchMarkerInfo-count"}),t.setText(n.title),this.markerPanel.title=n.description,this.markerPanel.addContent(t));let o=i.getWebappsAssetUrl("SNResultUX","images/results_cluster.png"),l=n.uuid;e.is(l)&&2===l.length&&(o=i.getWebappsAssetUrl("SNResultUX","images/cluster_clusters.png")),e.is(c)&&!0===c&&(o=i.getWebappsAssetUrl("SNResultUX","images/results_cluster_selected.png")),this.markerPanel.setStyle("backgroundImage","url("+o+")"),this.markerPanel.style.left=r+s[0]-10+"px",this.markerPanel.style.top=s[1]+a+"px",this.markerPanel.style.display="block",this.markerPanel.setStyle("z-index","150")}else this.markerPanel.style.display="none",this.markerPanel.setStyle("resize","none"),this.markerPanel.setStyle("overflow","hidden")},s.push({marker:n,markerinfo:d})}}function m(t,i,n,s){if(!e.is(i))return;for(let o=i.length-1;o>=0;o--){let a=i[o];e.is(a)&&(n.globe.markerBag.renderer.computeMarkerPositionOnScreen(a.marker),e.is(a.marker.screenPosition)||s&&!0===s?a.markerinfo.show(t,a.marker,[e.is(a.marker.screenPosition)?a.marker.screenPosition.x:0,e.is(a.marker.screenPosition)?a.marker.screenPosition.y:0],!0,!1):a.markerinfo.show(!1,a.marker,[e.is(a.marker.screenPosition)?a.marker.screenPosition.x:0,e.is(a.marker.screenPosition)?a.marker.screenPosition.y:0],!0,!1))}}function S(t,i,n,s,o,a,r,l,d){if(!e.is(t)||!e.is(n))return;n.clearMarkers(),n.clearCountries(),v(r);let u=r,h=[],g=Object.keys(t),p=g.length,_=0,S=0,w=0;for(var b=0;b<p;b++){let r=g[b],l=s.find((e=>e.name===r));if(e.is(l)&&e.is(l.pos)){let s=parseFloat(l.pos.latitude),d=parseFloat(l.pos.longitude),g={uuid:r,descriptionType:"txt",image:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAGUExURQAAAAAAAKVnuc8AAAACdFJOU/8A5bcwSgAAAAlwSFlzAAAOwwAADsMBx2+oZAAAAz5pVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+DQo8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA2LjAtYzAwMiA3OS4xNjQ0NjAsIDIwMjAvMDUvMTItMTY6MDQ6MTcgICAgICAgICI+DQogIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+DQogICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIxLjIgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjExRDgzOUIwN0MzNzExRUJCQ0VDQTNDMjE3QjdBQjUwIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjExRDgzOUIxN0MzNzExRUJCQ0VDQTNDMjE3QjdBQjUwIj4NCiAgICAgIDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjExRDgzOUFFN0MzNzExRUJCQ0VDQTNDMjE3QjdBQjUwIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjExRDgzOUFGN0MzNzExRUJCQ0VDQTNDMjE3QjdBQjUwIiAvPg0KICAgIDwvcmRmOkRlc2NyaXB0aW9uPg0KICA8L3JkZjpSREY+DQo8L3g6eG1wbWV0YT4NCjw/eHBhY2tldCBlbmQ9InIiPz5CqkeQAAAAJElEQVQ4T2NgJBKMKsQLRhXiBaMK8YJRhXjBqEK8YPArZGQEAAyUBkHVJODYAAAAAElFTkSuQmCC"},p=t[r].count;if(p>0){var C=c.replace(c.get("SearchGlobe_continent_results"),{nbResult:p});1===p&&(C=c.replace(c.get("SearchGlobe_continent_result"),{nbResult:p})),C=i[r]+": "+C;let t=n.addMarker(s,d,0,"darkblue",p,C,g);e.is(t)&&f(t,h,o,a,0,u,!1),_<p&&(_=p,S=s,w=d)}}}return!0===d&&n.turnGlobeToLatLon(S,w,l),setTimeout((function(){m(!u._3DExperienceSelected,h,n)}),u._delay),h}function v(t,i){if(!e.is(t))return;let n=e.is(i)?i:t._listOfMarkerInfo;if(e.is(n)){for(let t=n.length-1;t>=0;t--){let i=n[t];e.is(i)&&(delete i.marker,e.is(i.markerinfo)&&e.is(i.markerinfo.markerPanel)&&i.markerinfo.markerPanel.remove(),delete i.markerinfo)}}t._listOfMarkerInfo=[],i=[]}function w(t){if(!e.is(t))return;let i,n=t.getTaggerProxy();if(e.is(n)){let t=n.getCurrentFilter();if(e.is(t)){let n=t.localfilters;if(e.is(n)&&e.is(n.condition)){let t;n.condition.findIndex((function(n){let s=Object.keys(n);if(s&&1===s.length){let o=s[0],a=n[s[0]];if(e.is(a)){let n=a.condition;e.is(n,"array")||(n=a);let s=e.is(n,"array")&&n.length;s>0&&(i={predicate:o,display:e.is(n[s-1].display)?n[s-1].display:n[s-1].displayValue,object:n[s-1].object,value:e.is(n[s-1].value,"array")?n[s-1].value[0]:void 0,condition:n,computedCountryInfo:t},"ds6w:where/ds6w:location/computedCountryInfo"===o&&(t=e.clone(i)))}}}))}}}return i}function b(t,i,s,o,a){if(!e.is(t))return;let l=o,c=i,d="3DExperience",u=function(t){if(!e.is(t))return 0;let i=0,s=t._resultMgt&&t._resultMgt.getCollection().getTaggerProxy();if(e.is(s)&&e.is(r)&&e.is(r.NLSNAMEDETAILS)){let a=s.latest_tagValues;if(e.is(a)){let s=a.length;if(s){let l={},c=0;for(c=0;c<s;c++){var o=a[c];if("sixw:ds6w:where/ds6w:source/ds6w:dataSource"===o.sixw||"ds6w:where/ds6w:source/ds6w:dataSource"===o.sixw||"ds6w:where/ds6w:context/ds6w:project"===o.sixw){let t=o.sources;if(e.is(t)&&t.length){let i=t[0],s=l[i];if(!e.is(s)){s=[];let t=r.NLSNAMEDETAILS["ds6w:dataSource"];e.is(t)&&(s.Nls=t[n.getServiceFromSource(i)]),l[i]=s}let a=s.count;e.is(a)?s.count=o.count+a:s.count=o.count}i+=o.count}}t._listOfSources&&delete t._listOfSources,t._listOfSources=l}}}return i}(o),h=c.getDimensions().width-100;if(0===(o._listOfMarker3Dexp&&o._listOfMarker3Dexp.length)&&0!==u&&(C(o,d,o._listOfMarker3Dexp,d,void 0,h,50,"fonticon-3ds",!1),!0===a)){let t=l._resultMgt&&l._resultMgt.embeddedTaggerTags;if(e.is(t)){let e=[];for(let i=0;i<t.groups.length;i++)e.push(t.groups[i].predicate);e.length&&"ds6w:dataSource"===e[0]&&E(o,"3DExperience")}}}function C(t,n,s,o,a,r,l,d,u){if(!e.is(t))return;let h=t,g=h._globe,p=h._container,_=h._MarkerInfo,f={uuid:n,descriptionType:"txt",image:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAGUExURQAAAAAAAKVnuc8AAAACdFJOU/8A5bcwSgAAAAlwSFlzAAAOwwAADsMBx2+oZAAAAz5pVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+DQo8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA2LjAtYzAwMiA3OS4xNjQ0NjAsIDIwMjAvMDUvMTItMTY6MDQ6MTcgICAgICAgICI+DQogIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+DQogICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIxLjIgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjExRDgzOUIwN0MzNzExRUJCQ0VDQTNDMjE3QjdBQjUwIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjExRDgzOUIxN0MzNzExRUJCQ0VDQTNDMjE3QjdBQjUwIj4NCiAgICAgIDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjExRDgzOUFFN0MzNzExRUJCQ0VDQTNDMjE3QjdBQjUwIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjExRDgzOUFGN0MzNzExRUJCQ0VDQTNDMjE3QjdBQjUwIiAvPg0KICAgIDwvcmRmOkRlc2NyaXB0aW9uPg0KICA8L3JkZjpSREY+DQo8L3g6eG1wbWV0YT4NCjw/eHBhY2tldCBlbmQ9InIiPz5CqkeQAAAAJElEQVQ4T2NgJBKMKsQLRhXiBaMK8YJRhXjBqEK8YPArZGQEAAyUBkHVJODYAAAAAElFTkSuQmCC"},m=o,S=g.addMarker(0,0,"","darkblue","",m,f);if(e.is(S)){let n=new _(p);n.markerPanel.addClassName("Search-Marker-3DExp"),n.markerPanel.addEventListener("click",(function(e){I(S,t,n)})),n.markerPanel.addEventListener("mouseover",(function(e){let t=i.getWebappsAssetUrl("SNResultUX","images/3DEXP_Obj_White_Bg_hover.png");this.setStyle("backgroundImage","url("+t+")")})),n.markerPanel.addEventListener("mouseout",(function(t){let n=i.getWebappsAssetUrl("SNResultUX","images/3DEXP_Obj_White_Bg.png");e.is(this.activate)&&!0===this.activate&&(n=i.getWebappsAssetUrl("SNResultUX","images/3DEXP_Obj_White_Bg_Active.png")),this.setStyle("backgroundImage","url("+n+")")})),n.show=function(n,s,o,a){if(this.markerPanelDisplayed=n,n){let n=this.markerPanel.getChildren();n&&0===n.length&&(n=new e.Element("div",{class:"fonticon "+d}),this.markerPanel.title=s.description,this.markerPanel.addContent(n),e.is(u)&&!0===u&&(n=new e.Element("div",{class:"Search-Source-Title"}),n.setText(s.description),this.markerPanel.addContent(n)));let r=i.getWebappsAssetUrl("SNResultUX","images/3DEXP_Obj_White_Bg.png");e.is(this.markerPanel.activate)&&!0===this.markerPanel.activate&&(r=i.getWebappsAssetUrl("SNResultUX","images/3DEXP_Obj_White_Bg_Active.png")),this.markerPanel.setStyle("backgroundImage","url("+r+")");let l=O(t),c=P(t);this.markerPanel.style.left=c+o+"px",this.markerPanel.style.top=a+l+"px",this.markerPanel.style.display="block",this.markerPanel.setStyle("z-index","152")}else this.markerPanel.style.display="none",this.markerPanel.setStyle("resize","none"),this.markerPanel.setStyle("overflow","hidden")},n.show(!0,S,r,l),s&&s.push({marker:S,markerinfo:n})}let v=a;if(!e.is(v))return;f={uuid:n+"_Count",descriptionType:"txt",image:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAGUExURQAAAAAAAKVnuc8AAAACdFJOU/8A5bcwSgAAAAlwSFlzAAAOwwAADsMBx2+oZAAAAz5pVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+DQo8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA2LjAtYzAwMiA3OS4xNjQ0NjAsIDIwMjAvMDUvMTItMTY6MDQ6MTcgICAgICAgICI+DQogIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+DQogICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIxLjIgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjExRDgzOUIwN0MzNzExRUJCQ0VDQTNDMjE3QjdBQjUwIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjExRDgzOUIxN0MzNzExRUJCQ0VDQTNDMjE3QjdBQjUwIj4NCiAgICAgIDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjExRDgzOUFFN0MzNzExRUJCQ0VDQTNDMjE3QjdBQjUwIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjExRDgzOUFGN0MzNzExRUJCQ0VDQTNDMjE3QjdBQjUwIiAvPg0KICAgIDwvcmRmOkRlc2NyaXB0aW9uPg0KICA8L3JkZjpSREY+DQo8L3g6eG1wbWV0YT4NCjw/eHBhY2tldCBlbmQ9InIiPz5CqkeQAAAAJElEQVQ4T2NgJBKMKsQLRhXiBaMK8YJRhXjBqEK8YPArZGQEAAyUBkHVJODYAAAAAElFTkSuQmCC"},m=c.replace(c.get("SearchGlobe_continent_results"),{nbResult:v}),1===v&&(m=c.replace(c.get("SearchGlobe_continent_result"),{nbResult:v})),m=o+": "+m;let w=g.addMarker(0,0,0,"darkblue",v,m,f);if(e.is(w)){let n=new _(p);n.markerPanel.addClassName("Search-MarkerInfo"),n.show=function(n,s,o,a){if(this.markerPanelDisplayed=n,n){let n=this.markerPanel.getChildren();n&&0===n.length&&(n=new e.Element("div",{class:"SearchMarkerInfo-count"}),this.markerPanel.title=s.description,n.setText(s.title),this.markerPanel.addContent(n));let r=i.getWebappsAssetUrl("SNResultUX","images/cluster_clusters.png");this.markerPanel.setStyle("backgroundImage","url("+r+")");let l=O(t),c=P(t);this.markerPanel.style.left=c+o+50+"px",this.markerPanel.style.top=a+l+40+"px",this.markerPanel.style.display="block",this.markerPanel.setStyle("z-index","153")}else this.markerPanel.style.display="none",this.markerPanel.setStyle("resize","none"),this.markerPanel.setStyle("overflow","hidden")},n.show(!0,w,r,l),s&&s.push({marker:w,markerinfo:n})}}function y(t){if(!e.is(t))return;let i=t,n=(i._container,i._container.getParent()),s=n&&n.getDimensions();window.devicePixelRatio,s.width,s.height;if(!e.is(i._listOfSources))return;D(t,!0);let o=x(t),a=Object.keys(i._listOfSources),r=a.length,l=0,c=!0;for(l=0;l<r;l++){let n=a[l],s=i._listOfSources[n];if(e.is(s)){let e=s.Nls,a=s.count;if("3dspace"===n){let s=o["3dspace"].left,r=o["3dspace"].top;C(t,n,i._listOfMarkersSources,e,a,s,r,"fonticon-3dspace",c)}else if("swym"===n){let s=o.swym.left,r=o.swym.top;C(t,n,i._listOfMarkersSources,e,a,s,r,"fonticon-logo-3dswym",c)}else if("drive"===n){let s=o.drive.left,r=o.drive.top;C(t,n,i._listOfMarkersSources,e,a,s,r,"fonticon-component",c)}}}}function D(t,n){let s=t;if(null===s._3DExperienceLogo){s._3DExperienceLogo=new e.Element("div",{class:"Search-Marker-Logo"}).inject(s._container);let t=i.getWebappsAssetUrl("SNResultUX","images/3DEXPERIENCE_bg.png");s._3DExperienceLogo.setStyle("backgroundImage","url("+t+")"),s._3DExperienceLogo.setStyle("z-index","151")}if(n){let e=s._container.getParent(),i=e&&e.getDimensions(),n=O(t),o=P(t),r=(window.devicePixelRatio,574);i.height<r||i.width>=400&&i.width<540?r=350:i.width<=399&&(r=250);let l=o+.5*i.width-.5*r,c=.5*(i.height+n)-.5*r+30;0===["iphone"].indexOf(a.getDeviceCategory())&&(c<249?(r=150,l=o+.5*i.width-.5*r,c=.5*(i.height+n)-.5*r+30):(r=250,l=o+.5*i.width-.5*r,c=.5*(i.height+n)-.5*r));let d=r.toString()+"px";s._3DExperienceLogo.setStyle("min-width",d),s._3DExperienceLogo.setStyle("min-height",d),s._3DExperienceLogo.style.left=l+"px",s._3DExperienceLogo.style.top=c+"px",s._3DExperienceLogo.style.display="block"}else s._3DExperienceLogo.style.display="none",s._3DExperienceLogo.setStyle("resize","none"),s._3DExperienceLogo.setStyle("overflow","hidden")}function I(t,i,n,s,o){if(!e.is(t)||!e.is(i))return;let a=i,r=a._globe,l=a._container,c=t.description,d=l.getParent(),u=d&&d.getDimensions(),h=(u.width,u.height,u.width-100);if("3DExperience"===c){let i=n.markerPanel.activate;if(!e.is(i)||!1===i||e.is(o)){if(n.markerPanel.activate=!0,0===a._listOfMarkersSources.length?y(a):A(a,!0),!e.is(s)){let t=a._collection.getTaggerProxy();if(e.is(t)&&e.is(t._requestGroupingChange,"function")){var g={rootW:"ds6w:where",predicate:"ds6w:dataSource"};t._requestGroupingChange(g)}}a._globe.turnGlobeToLatLon(a._globe.globe.camera.lat,a._globe.globe.camera.lon,6.2),m(!1,a._listOfMarkerInfo,r,!0),m(!1,a._listOfMarker3Dexp,r,!0),l.addClassName("mini"),a._3DExperienceSelected=!0,a._globe.allowZoom(!1),a._globe.globe.overlayDisplayed=!0}else{if(n.markerPanel.activate=!1,!e.is(s)){let t=a._collection.getTaggerProxy();if(e.is(t)&&e.is(t._requestGroupingChange,"function")){g={rootW:"ds6w:where",predicate:"computedCountryInfo"};t._requestGroupingChange(g)}}a._globe.turnGlobeToLatLon(a._globe.globe.camera.lat,a._globe.globe.camera.lon,a._lastZoom),m(!1,a._listOfMarkerInfo,r),A(a,!1),l.removeClassName("mini"),setTimeout((function(){m(!0,a._listOfMarkerInfo,r)}),650),a._3DExperienceSelected=!1,a._globe.allowZoom(!0),a._globe.globe.overlayDisplayed=!1,n.show(!0,t,h,50)}}else N(a,c,!0)}function T(t){if(!e.is(t))return;let i=t,n=(i._globe,i._container,i._container.getParent()),s=n&&n.getDimensions(),o=s.width-100;for(let t=i._listOfMarker3Dexp.length-1;t>=0;t--){let n=i._listOfMarker3Dexp[t];e.is(n)&&e.is(n.markerinfo)&&n.markerinfo.show(!i._3DExperienceSelected,n.marker,o,50)}A(t,i._3DExperienceSelected),setTimeout((function(){if(e.is(i._DockingElement)&&e.is(i._DockingElement.ExCol)){let e=i._DockingElement.ExCol,n=(O(t),P(t)),o=s.width-20;i._DockingElement.style.left="expanded"===e?n+o+"px":n-20+"px"}}),100)}function A(t,i){if(!e.is(t))return;let n=t,s=(n._globe,n._container,n._container.getParent()),o=s&&s.getDimensions(),a=(window.devicePixelRatio,o.width,o.height,x(t));for(let t=n._listOfMarkersSources.length-1;t>=0;t--){let s=n._listOfMarkersSources[t];if(e.is(s)&&e.is(s.markerinfo)){let e=s.marker.uuid,t=0,n=0;-1!==e.indexOf("3dspace")?(t=a["3dspace"].left,n=a["3dspace"].top):-1!==e.indexOf("swym")?(t=a.swym.left,n=a.swym.top):-1!==e.indexOf("drive")&&(t=a.drive.left,n=a.drive.top),s.markerinfo.show(i,s.marker,t,n)}}D(t,i)}function x(t){if(!e.is(t))return;let i=t,n=(i._globe,i._container,i._container.getParent()),s=n&&n.getDimensions(),o=.5*s.width,r=.5*s.height,l=O(t),c=574;s.height<c||s.width>=400&&s.width<540?c=350:s.width<=399&&(c=250),0===["iphone"].indexOf(a.getDeviceCategory())&&(c=r<249?150:250);let d=o-40,u=o-.5*c+60,h=o+.5*c-120,g=.5*(s.height+l),p=r-.5*c+25;return 250===c?(u=.5*o-30,g=.5*s.height,h=.5*o+150,p=r-170):150===c&&(u=.5*o,g=.5*s.height,h=.5*o+130,p=r-120),{"3dspace":{left:u,top:g},swym:{left:d,top:p},drive:{left:h,top:g}}}function N(i,n,s){if(!e.is(i))return;let o=i,a=o._globe,r=o._container,l=o._listOfMarkersSources.length-1,c=l;for(-1===l&&e.is(n)&&0!==n.length&&b(o._globe,o._container,o._MarkerInfo,o,!0),l=o._listOfMarkersSources.length-1,c=l;c>=0;c--){let t=o._listOfMarkersSources[c];e.is(t)&&e.is(t.markerinfo)&&(t.markerinfo.markerPanel.activate=!1)}for(c=l;c>=0;c--){let i=o._listOfMarkersSources[c];if(e.is(i)&&e.is(i.markerinfo)){let a=i.marker.description;a===n&&(i.markerinfo.markerPanel.activate=!0,c=-1,e.is(s)&&!0===s&&o.dispatchEvent("On3DExperienceChange",a),t.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"clickOnSourceCategory",persDim:{pd1:n}}}))}}o._3DExperienceSelected=!0,e.is(s)||(A(o,!0),o._globe.turnGlobeToLatLon(o._globe.globe.camera.lat,o._globe.globe.camera.lon,6.2),m(!1,o._listOfMarkerInfo,a),m(!1,o._listOfMarker3Dexp,a),r.addClassName("mini"),o._globe.allowZoom(!1),o._globe.globe.overlayDisplayed=!0)}function E(t,i){if(!e.is(t))return;let n=t;for(let s=n._listOfMarker3Dexp.length-1;s>=0;s--){let o=n._listOfMarker3Dexp[s];if(e.is(o)){let n=o.marker;e.is(n)&&n.uuid===i&&e.is(o.markerinfo)&&(I(n,t,o.markerinfo,!1,!0),s=-1)}}}function O(t){if(!e.is(t))return 0;return 10}function k(t){if(!e.is(t))return;let i=t;if(e.is(i._globe)){i._globe.clearMarkers(),v(t),v(t,i._listOfMarker3Dexp),v(t,i._listOfMarkersSources),i._listOfMarker3Dexp=[],i._listOfMarkersSources=[],i._3DExperienceSelected=!1,i._globe.allowZoom(!1),i._globe.globe.overlayDisplayed=!0;let n=i._container;e.is(n)&&n.removeClassName("mini"),i._3DExperienceLogo&&(e.is(n)&&n.removeChild(i._3DExperienceLogo),i._3DExperienceLogo=null)}}function P(t){let i=0,n=document.getElementsByClassName("search-globe-view")[0];return e.is(n)&&(i=n.getStyle("margin-left"),e.is(i)&&i.length&&(i=i.replace("px",""),i=parseFloat(i))),i}return{refineEmptyCountry:function(e,t,i,n,s,o){return d(e,t,i,n,s,o)},cleanCountryFilter:function(e){return g(e)},refineCountry:function(e,t,i,n,s,o){return u(e,t,i,n,0,o)},refineCountryList:function(t,i,n,s,o,a){return function(t,i,n,s,o,a){if(!(e.is(i)&&e.is(n)&&e.is(s)&&e.is(a)&&e.is(t)))return;let r=t,l=o,u=Object.keys(i),h=u.length;if(1===h&&u[0]===o)return l;l="countries";let _=n.getTaggerProxy();if(e.is(_)){let t={condition:[],operator:"AND",isSimplified:{version:2}},i=g(n);e.is(i)&&e.is(i.filters)&&(e.is(i.index)&&-1!==i.index&&i.filters.condition.splice(i.index,1),t=i.filters);let m=function(){r.mask(),_.setLocalFilter(t,!0)},S=0;for(var f=0;f<h;f++)p(u[f],{onComplete:function(i){e.is(i)&&(t.condition.push(i),S++,S===h&&m.call(this))}},a);0===h&&(l=d(r,c.get("SearchGlobe_nocountry"),n,s,o,a))}return l}(t,i,n,s,o,a)},refineContinent:function(e,t,i,n,s,o){return h(e,t,i,n,s,o)},buildContinentsCountriesMarkers:function(t,i,n,s,o,a,r,l,c,d){return function(t,i,n,s,o,a,r,l,c,d){if(!e.is(n)||!e.is(i))return;let u=d,h=[],g=n[t];e.is(g)&&g.countries&&(h=_(g.countries,i,o,a,r,l,d));let p=s.find((e=>e.name===t));if(e.is(p)&&e.is(p.pos)){let e=parseFloat(p.pos.latitude),t=parseFloat(p.pos.longitude);d._lastZoom=d._zoomContinent,i.turnGlobeToLatLon(e,t,d._lastZoom),setTimeout((function(){m(!u._3DExperienceSelected,h,i)}),d._delay)}return h}(t,i,n,s,o,a,r,l,0,d)},addMarkersCountries:function(e,t,i,n,s,o,a,r){return _(e,t,i,n,s,o,a,r)},showMarkersinfo:function(e,t,i){return m(e,t,i)},addMarkersCountry:function(t,i,n,s,o,a){return function(t,i,n,s,o,a){if(!e.is(i)||!e.is(t))return;let r=[],l=t.title,d=parseFloat(t.pos.latitude),u=parseFloat(t.pos.longitude),h=n[l];if(e.is(h)){let t={uuid:l,descriptionType:"txt",image:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAGUExURQAAAAAAAKVnuc8AAAACdFJOU/8A5bcwSgAAAAlwSFlzAAAOwwAADsMBx2+oZAAAAz5pVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+DQo8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA2LjAtYzAwMiA3OS4xNjQ0NjAsIDIwMjAvMDUvMTItMTY6MDQ6MTcgICAgICAgICI+DQogIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+DQogICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIxLjIgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjExRDgzOUIwN0MzNzExRUJCQ0VDQTNDMjE3QjdBQjUwIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjExRDgzOUIxN0MzNzExRUJCQ0VDQTNDMjE3QjdBQjUwIj4NCiAgICAgIDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjExRDgzOUFFN0MzNzExRUJCQ0VDQTNDMjE3QjdBQjUwIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjExRDgzOUFGN0MzNzExRUJCQ0VDQTNDMjE3QjdBQjUwIiAvPg0KICAgIDwvcmRmOkRlc2NyaXB0aW9uPg0KICA8L3JkZjpSREY+DQo8L3g6eG1wbWV0YT4NCjw/eHBhY2tldCBlbmQ9InIiPz5CqkeQAAAAJElEQVQ4T2NgJBKMKsQLRhXiBaMK8YJRhXjBqEK8YPArZGQEAAyUBkHVJODYAAAAAElFTkSuQmCC"},n=h.count,g=c.replace(c.get("SearchGlobe_continent_results"),{nbResult:n});1===n&&(g=c.replace(c.get("SearchGlobe_continent_result"),{nbResult:n})),g=l+": "+g;let p=i.addMarker(d,u,0,"darkblue",n,g,t);e.is(p)&&f(p,r,s,o,0,a,!1)}return r}(t,i,n,s,o,a)},buildContinents:function(t,i,n,s,o,a,r,l,c,d,u,h){return function(t,i,n,s,o,a,r,l,c,d,u,h){if(!e.is(n)||!e.is(s))return;let g=u,p={},f=[],v=Object.keys(n),b=v.length;for(var C=0;C<b;C++){let t=v[C],i=n[t];if(e.is(i)){let n=i.countryCode;if(n){i.iso3=a[n];let o=s.find((e=>e.countryCode===n));if(o){o.iso3=i.iso3,o.title=t;let n=o.continent,s=p[n];if(e.is(s)||(s={title:r[n],count:0,countries:{}},p[n]=s),e.is(s)){let n=s.count;e.is(n)?s.count=i.count+n:s.count=i.count,s.countries[t]=i}}}}}v=Object.keys(p),b=v.length;let y=!0;if(1===b){let n=w(g._collection);if(e.is(n)&&e.is(n.predicate)&&e.is(n.object,"array")&&"ds6w:where/ds6w:location/computedCountryInfo"===n.predicate){if(1===n.object.length){let a=p[v[0]];if(e.is(a)){let r=a.countries;f=_(r,t,i,s,c,d,u);let l=o.find((e=>e.name===v[0]));if(e.is(l)&&e.is(l.pos)){let e=parseFloat(l.pos.latitude),i=parseFloat(l.pos.longitude);u._lastZoom=u._zoomContinent,u._latRefine=n.object[0],t.turnGlobeToLatLon(e,i,u._lastZoom),setTimeout((function(){m(!g._3DExperienceSelected,f,t)}),u._delay)}}}y=!1}}return!0===y&&(f=S(p,r,t,o,c,d,u,l,h)),{continentsList:p,listOfMarkerInfo:f,lastZoom:l}}(t,i,n,s,o,a,r,l,c,d,u,h)},turnGlobeToLatLonCountry:function(t,i,n,s){return function(t,i,n,s){if(!e.is(t))return;let o=i.find((e=>e.countryCode===t.countryCode));if(e.is(o)&&e.is(o.pos)){let e=parseFloat(o.pos.latitude),t=parseFloat(o.pos.longitude);s=1.5,n.turnGlobeToLatLon(e,t,s)}return s}(t,i,n,s)},buildContinentsMarkers:function(e,t,i,n,s,o,a,r,l){return S(e,t,i,n,s,o,a,r,l)},removeMarkersinfo:function(e,t){return v(e,t)},refreshFromMultiview:function(t,i,n,s,o,a){return function(t,i,n,s,o,a){if(!e.is(t)||!e.is(t.collections)||!e.is(i))return t;let r=a,l=t.collections,c=l.length,d=0,u=0;d=e.is(n)&&n.length,u=e.is(o)&&o.length;let h=0;for(;h<c;h++){let t=l[h];if(e.is(t)){let i=t.headTitle,s=t.hits;if(e.is(i)){let t=0;for(;t<d;t++){let o=n[t];if(e.is(o)){let n=o.marker;if(e.is(n)){let a=n.description;-1!==a.indexOf(i)&&(n.description=a.replace(n.title,s),n.title=s,e.is(o.markerinfo.markerPanel)&&e.is(o.markerinfo.markerPanel.getChildren())&&e.is(o.markerinfo.markerPanel.getChildren()[0])&&o.markerinfo.markerPanel.getChildren()[0].setText(n.title),t=d)}}}for(t=0;t<u;t++){let n=o[t];if(e.is(n)){let o=n.marker;if(e.is(o)){let a=o.description;-1!==a.indexOf(i+":")&&(o.description=a.replace(o.title,s),o.title=s,e.is(n.markerinfo.markerPanel)&&e.is(n.markerinfo.markerPanel.getChildren())&&e.is(n.markerinfo.markerPanel.getChildren()[0])&&n.markerinfo.markerPanel.getChildren()[0].setText(o.title),t=u)}}}}}}m(!r._3DExperienceSelected,n,s),e.is(o)&&A(r,r._3DExperienceSelected)}(t,i,n,s,o,a)},findCountryByLocalFilters:function(e){return w(e)},zoomOnVIPCountry:function(t,i,n,s){return function(t,i,n,s){if(!e.is(i)||!e.is(t)||!e.is(n))return;let o,a=Object.keys(i),r=a.length,l=0,c=0;for(let t=0;t<r;t++){let n=a[t],s=i[n];e.is(s)&&(l=s.count,l>c&&(c=l,o=n))}if(e.is(o)){let a=i[o],r=n.find((e=>e.countryCode===a.countryCode));if(e.is(r)&&e.is(r.pos)){let e=parseFloat(r.pos.latitude),i=parseFloat(r.pos.longitude);t.turnGlobeToLatLon(e,i,s)}}}(t,i,n,s)},addMarker3DExp:(e,t,i,n,s)=>b(e,t,0,n,s),refresh3DExperienceMarkers:e=>T(e),createMain3DExperienceMarker:e=>y(e),back:function(t,i){if(!e.is(t)||!e.is(i))return;let n=i;if(e.is(t.groups)&&e.is(t.groups[0])){let s,o=[];for(let e=0;e<t.groups.length;e++)o.push(t.groups[e].predicate);if(s=o&&o.length&&o[0],"computedCountryInfo"===s){m(!1,n._listOfMarkerInfo,n._globe),v(i);let s=t.groups[0].object;if(1===s.length){let t=s[0].dispText,i=Object.keys(n._continentsList);if(e.is(i)){let e,s=i.length;for(let o=0;o<s;o++)n._continentsList[i[o]].title===t&&(e=i[o],o=s);h(n,e,n._collection,n._latRefine,n._continents,n._continentsList),n._latRefine=e}}else{let t=n._cleanCountryFilter();if(e.is(t)&&e.is(t.filters)){e.is(t.index)&&-1!==t.index&&t.filters.condition.splice(t.index,1);let i=t.filters,s=n._collection.getTaggerProxy();e.is(s)&&(n.mask(),s.setLocalFilter(i,!0))}n._latRefine="continent"}}else"ds6w:dataSource"===s&&function(t){let i=t,n=i._resultMgt&&i._resultMgt.skeleton.getCurrentView();if(e.is(n)&&e.is(n.On3DExperienceChange,"function")){let t=n._lastRefineSource;if(e.is(t)&&t.length){let s;if("refine"===t)s="lastSource";else{s="global";let t=i._listOfMarkersSources.length-1;for(;t>=0;t--){let n=i._listOfMarkersSources[t];e.is(n)&&e.is(n.markerinfo)&&(n.markerinfo.markerPanel.activate=!1)}A(i,!0)}n.back3DExperience(s)}}}(n)}return!0},hideAndLock:function(t,i){if(!e.is(t))return;let n=t;e.is(n._globe)&&(n._globe.allowZoom(i),n._globe.globe.overlayDisplayed=!i),!1===i&&k(t)},refineCountry:function(t){return function(t){if(!e.is(t))return;let i,n=t,s=w(n._collection);if(e.is(s))if(e.is(s.predicate)&&"ds6w:where/ds6w:location/computedCountryInfo"===s.predicate){let t=n._ClusterSet[s.display];i=e.is(t)?{country:!0,countryId:s.display}:{country:!1,continent:s.display}}else if(e.is(s.predicate)&&"ds6w:where/ds6w:source/ds6w:dataSource"===s.predicate)i={source:!0,display:s.display,object:s.object,condition:s.condition};else{let t=s.computedCountryInfo;if(e.is(t)){let s=n._ClusterSet[t.display];i=e.is(s)?{country:!0,countryId:t.display}:{country:!1,continent:t.display}}}return i}(t)},activate3DExperience:function(e,t){return E(e,t)},manageActivationSourcesMarkers:function(e,t){return N(e,t)},removeallMarkers:function(e){return k(e)},retrieveOwnerFromGroup:function(t){return function(t){if(!e.is(t))return;let i=[],n=t.groups[0].object;if(e.is(n)){let t=n.length;for(let s=0;s<t;s++){let t=n[s];e.is(t.object,"object")&&e.is(t.object.predicates,"array")&&e.is(t.object.value,"array")&&t.object.predicates.length===t.object.value.length&&(i=i.concat(t.object.value))}}return i}(t)},createdockingView:function(t){return function(t){let i=t,n=i._globe,s=i._container.getParent(),o=s&&s.getDimensions(),a=o.width-20,r=.5*o.height-20,l=O(t),d=P();if(null===i._DockingElement){i._DockingElement=new e.Element("div",{class:"Search-docking"}).inject(s),e.Element("span",{class:"fonticon fonticon-chevron-left left"}).inject(i._DockingElement),i._DockingElement.title=c.get("SearchGlobe_collapsed"),i._DockingElement.style.left=d+a+"px",i._DockingElement.style.top=l+r+"px",i._DockingElement.style.display="block",i._DockingElement.ExCol="expanded",i._DockingElement.onclick=()=>{if(i._DockingElement.classList.contains("collapsed"))s.classList.add("expanded"),i._DockingElement.classList.remove("collapsed"),s.classList.remove("collapsed"),i._DockingElement.ExCol="expanded",setTimeout((function(){o=s&&s.getDimensions(),a=o.width-20,d=P(),i._DockingElement.innerHTML='<span class="fonticon fonticon-chevron-left left"></span>',i._DockingElement.style.left=d+a+"px",i._DockingElement.title=c.get("SearchGlobe_collapsed");let e=i._resultMgt&&i._resultMgt.skeleton.getWhereView();e._MaxDisplay=!1,e.manageDisplayChannelView("normal"),(e&&e.nestedView&&e.nestedView.container).getChildren()[0].classList.remove("expanded"),m(!i._3DExperienceSelected,i._listOfMarkerInfo,n),T(i)}),1e3);else{i._DockingElement.ExCol="collapsed",s.classList.remove("expanded"),m(!1,i._listOfMarkerInfo,n),m(!1,i._listOfMarker3Dexp,n),setTimeout((function(){i._DockingElement.classList.add("collapsed"),s.classList.add("collapsed"),i._DockingElement.innerHTML='<span class="fonticon fonticon-globe globe"></span> <span class="fonticon fonticon-chevron-right chevron"></span>',d=P(),i._DockingElement.title=c.get("SearchGlobe_expanded"),i._DockingElement.style.left=d-20+"px"}),900);let e=i._resultMgt&&i._resultMgt.skeleton.getWhereView();e._MaxDisplay=!0;let t=e&&e.nestedView&&e.nestedView.container;e.manageDisplayChannelView("normal"),t.getChildren()[0].classList.add("expanded")}};let u=i._container.querySelector("canvas");e.is(u)&&u.addEventListener("click",(function(){if(!0===i._3DExperienceSelected)for(let n=i._listOfMarker3Dexp.length-1;n>=0;n--){let s=i._listOfMarker3Dexp[n];if(e.is(s)){let i=s.marker;e.is(i)&&"3DExperience"===i.uuid&&e.is(s.markerinfo)&&(I(i,t,s.markerinfo),n=-1)}}}),!1)}}(t)},getGroupForPredicateWho:function(t,i,n){return function(t,i,n){if(!e.is(t)||!e.is(i))return;let s={group:void 0,refine:n},o=w(t.collection);if(e.is(o)&&e.is(o.predicate)&&"ds6w:who/person"===o.predicate){let t=e.is(o.value)?o.value:o.object;if(e.is(t)){let o,a=e.clone(i),r=a.groups[0].object,l=r.length,c=!1;for(let i=0;i<l;i++)if(o=r[i],e.is(o)&&e.is(o.object)){let n=o.object;if(e.is(n)){let s=n.value,r=n.predicates;if(e.is(s)){let e=s.length;for(let d=0;d<e;d++)if(s[d]===t){let s=r[d];n.predicates=[],n.value=[],n.predicates.push(s),n.value.push(t),a.groups[0].object=[],a.groups[0].object.push(o),d=e,i=l,c=!0}}}}if(1==c&&e.is(o)){let i=o.subGroups;if(e.is(i)){l=i.length;for(let n=0;n<l;n++)if(o=i[n],e.is(o)&&e.is(o.object)){let i=o.object;if(e.is(i)){let s=i.value,r=i.predicates;if(e.is(s)){let e=s.length;for(let d=0;d<e;d++)if(s[d]===t){let s=r[d];i.predicates=[],i.value=[],i.predicates.push(s),i.value.push(t),a.groups[0].object[0].subGroups=[],a.groups[0].object[0].subGroups.push(o),d=e,n=l,c=!0}}}}}}e.is(n)&&"continent"!==n&&(a.groups[0].object=[],a.groups[0].object.push(o),s.refine=o.dispText),s.group=a}}return s}(t,i,n)},getPredicateType:function(t,i){let n;if(!e.is(i)){let i=w(t);return e.is(i)&&e.is(i.predicate)&&(n=i.predicate,"ds6w:where/ds6w:location/computedCountryInfo"===n?n="computedCountryInfo":"ds6w:where/ds6w:source/ds6w:dataSource"===n&&(n="ds6w:dataSource")),n}let s=[];if(i.groups)for(let e=0;e<i.groups.length;e++)s.push(i.groups[e].predicate);return n=s&&s.length&&s[0],n}}})),define("DS/SNResultUX/views/helpers/utils/GlobeView",["UWA/Core","UWA/Class/View","DS/Utilities/Utils","DS/PlatformAPI/PlatformAPI","DS/SNInfraUX/SearchDebug","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/Logger","DS/SNResultUX/views/helpers/utils/SearchGlobeViewUtils","DS/SNResultUX/utils/ExternalComponentHelpers","text!DS/SNResultUX/assets/SearchGlobe/countries.json","text!DS/SNResultUX/assets/SearchGlobe/CountriesISO3.json","text!DS/SNResultUX/assets/SearchGlobe/continentsPos.json","text!DS/SNResultUX/assets/nls/continents.json","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],(function(e,t,i,n,s,o,a,r,l,c,d,u,h,g){"use strict";return t.extend(s,{uwaClassName:"SearchGlobeView",name:"search_globe",_globe:null,_collection:null,_ClusterSet:null,_countries:null,_countriesISO3:null,_continents:null,_continentsList:null,_continentsPos:null,_indexSelectedCountry:-1,_latRefine:"",_listOfpersons:null,_container:null,_MarkerInfo:null,_lastZoom:6.72,_ClusterSetFromTopbar:null,_iphone:-1,_resultMgt:null,_lastSelectedCountry:null,_subjectsTagsCloned:null,_tagValuesCloned:null,_listOfMarkerInfo:[],_listOfMarker3Dexp:[],_listOfMarkersSources:[],_zoomContinent:3.05,_zoomCountry:1.5,_zoomContinentGlobe:6.72,_tagDatas:null,_listOfSources:null,_3DExperienceSelected:!1,_3DExperienceLogo:null,_delay:0,_MapView:null,_markersMapView:null,_geolocationHierarchy:!0,_3DEXPERIENCEAsContinent:!0,_geoActivate:!0,_3DEXPERIENCEActivate:!1,_WhereIsActivate:!0,_DockingElement:null,_mustUpdateGroup:!1,init:function(e){return this._ClusterSet=null,this._continentsList=[],this._collection=e.collection,this._countries=JSON.parse(c),this._countriesISO3=JSON.parse(d),this._continents=JSON.parse(h),this._continentsPos=JSON.parse(u),this._listOfpersons=[],this._listOfMarkerInfo=[],this._latRefine="continent",this._resultMgt=null,this._lastSelectedCountry=null,this._subjectsTagsCloned=null,this._tagValuesCloned=null,this._listOfMarker3Dexp=[],this._tagDatas=null,this._listOfSources=null,this._listOfMarkersSources=[],this._3DExperienceSelected=!1,this._3DExperienceLogo=null,this._delay=500,this._geoActivate=!0,this._3DEXPERIENCEActivate=!1,this._WhereIsActivate=!0,this._DockingElement=null,this._mustUpdateGroup=!1,this._iphone=["iphone"].indexOf(o.getDeviceCategory()),0===this._iphone&&(this._delay=250,this._zoomContinentGlobe=8.79,this._lastZoom=this._zoomContinentGlobe),this._geolocationHierarchy=!0,!1===this._geolocationHierarchy&&(this._lastZoom=3,this._zoomContinent=this._lastZoom,this._zoomCountry=this._lastZoom,this._zoomContinentGlobe=this._lastZoom),this._3DEXPERIENCEAsContinent=!0,this._parent(e)},setup:function(t){var i=this;this.listenTo(i._collection,{onAdd:function(){},onRemove:function(){},onSort:function(){},onAnyEvent:function(){},onReset:function(e){},onSync:function(e){},onSetTags:function(t){if("where"===i.getCurrentViewId()){e.is(t)&&e.is(t.service_parameters)&&e.is(t.service_parameters.fromTopbar)&&!0===t.service_parameters.fromTopbar&&(i._subjectsTagsCloned&&delete i._subjectsTagsCloned,i._tagValuesCloned&&delete i._tagValuesCloned,i._subjectsTagsCloned=null,i._tagValuesCloned=null,i._subjectsTagsCloned=e.clone(i.collection.getTaggerProxy().latest_subjectsTags),i._tagValuesCloned=e.clone(i.collection.getTaggerProxy().latest_tagValues),i._lastZoom=i._zoomContinentGlobe,i._mustUpdateGroup=!0)}},onInitTreeDocumentAsyncCB:function(e){!0!==i._mustUpdateGroup&&i._computeRefineDisplay()},OnGroupingChange:function(t){e.is(t)&&e.is(t.forcedUpdate,"boolean")&&!0===t.forcedUpdate&&!1===i._mustUpdateGroup||(i._refreshViewFromOnGrouping(t),i._mustUpdateGroup=!1)}}),i.addEvent("On3DExperienceChange",i.On3DExperienceChange.bind(i)),n.subscribe("sideOnPanelOpen",i._updateUI.bind(i))},destroy:function(){var t=this;t._globe&&t._globe.globe&&(t._globe.clearMarkers(),t._globe.globe.removeEvent("zoomEvent"),t._globe.globe.camera.removeEvent("cameraMoveEnd")),e.is(t._listOfpersons)&&(t._listOfpersons=[]),this._deleteMarkers(),this.stopListening(this._collection),this._globe.destroy(),this._parent()},render:function(t){var n=this;if(n._container=t.parentContainer,n._resultMgt=t.resultMgt,!0===t.globe){require(["DS/SocialGlobe/GlobeItf","DS/SocialGlobe/MarkerInfoManager","DS/SocialGlobe/MarkerInfo"],(function(s,a,l){n._globe=s.create(n._container,t.use2D,!0),n._MarkerInfo=l,n._globe.allowZoom(!0),n._globe.autoTurn(0),n._globe.setCountrySelection(!1),n._globe.setInertia(50),n._globe.setHalo("#40a5de",.3),-1!==["iphone","ipad","android"].indexOf(o.getDeviceCategory())?n._globe.setBackgroundColor("#00163c",1):n._globe.setBackgroundColor("#005686",1),n._globe.setEditMode(!0),n._globe.changeSkin("natural",!0);n._globe.setMouseOverMarkersManager({onMouseMove:function(e,t,i){},onMouseClick:function(e,t,i){},onMouseOut:function(){},onClearMarkers:function(){}});n._globe.setMouseOverCountryManager({onMouseMove:function(e,t,i){},onMouseOut:function(){},onMouseClick:function(e,t,i){},onClearCountries:function(){}});let c=300;0===n._iphone&&(c=150),n._globe.globe.addEvent("zoomEvent",i.debounce(n._onZoom.bind(n),c)),n._globe.globe.camera.addEvent("cameraMoveEnd",n._onZoom.bind(n)),n._globe.globe.camera.addEvent("cameraMoveStart",n._onMoveStart.bind(n)),e.is(n._ClusterSet)||(n._subjectsTagsCloned&&delete n._subjectsTagsCloned,n._tagValuesCloned&&delete n._tagValuesCloned,n._subjectsTagsCloned=null,n._tagValuesCloned=null,n._subjectsTagsCloned=e.clone(n.collection.getTaggerProxy().latest_subjectsTags),n._tagValuesCloned=e.clone(n.collection.getTaggerProxy().latest_tagValues),n._setupCluster(!0)),n._globe.globe.displayHelp=function(){},n._globe.go(),!1===n._geolocationHierarchy&&n._displayAtStart(),n._createDockingElement(),n._resultMgt&&n._resultMgt.addEvent("onToggle6WResizeFullMode",(function(e){r.showMarkersinfo(!1,n._listOfMarkerInfo,n._globe),r.showMarkersinfo(!1,n._listOfMarker3Dexp,n._globe),setTimeout((function(){r.showMarkersinfo(!n._3DExperienceSelected,n._listOfMarkerInfo,n._globe),r.refresh3DExperienceMarkers(n)}),850)}))}))}return n._container.onresize=function(){n._removeMarkersinfo(!1)},this},displayCountryByUser:function(t){let i=this;if(!e.is(i._listOfpersons))return;let n=i._listOfpersons.find((e=>e.get("title")===t));if(e.is(n)){n.getCountry();let t=n.getCountryCode();if(e.is(t,"array")&&1===t.length){let e=t[0].split(".");t=e[1]}let s=i._countries.find((e=>e.countryCode===t));if(e.is(s)){i._globe.clearMarkers(),i._removeMarkersinfo();s.title;i._addMarkersCountry(s);let e=parseFloat(s.pos.latitude),t=parseFloat(s.pos.longitude);i._globe.turnGlobeToLatLon(e,t,1.35),i._lastZoom=1.35,setTimeout((function(){i._showMarkersinfo(!0)}),i._delay)}}},_onZoom:function(t){var i=this;if(!e.is(i._ClusterSet))return;if(i._onMoveStart(),!1===i._geolocationHierarchy)return i._globe.clearMarkers(),i._removeMarkersinfo(),i._addMarkersCountries(i._ClusterSet,i._lastSelectedCountry),void setTimeout((function(){i._showMarkersinfo(!0)}),500);let n=i._globe.globe.getBBox(),s=n.point.lat,o=n.point.lon,a=n.distance,l=(i._globe.globe.camera.level,i._globe.globe.camera.dist);if(l<=i._zoomContinent){let t={},n=s+.45*a,r=s-.45*a,c=o+.7*a,d=o-.7*a;0===i._iphone&&(n=s+1.5*a,r=s-1.5*a),l<=i._zoomCountry&&(n=s+.9*a,r=s-.9*a,c=o+a,d=o-a);let u=Object.keys(i._ClusterSetFromTopbar),h=u.length;for(let s=0;s<h;s++){let o=u[s],a=i._ClusterSetFromTopbar[o];if(e.is(a)){let s=i._countries.find((e=>e.countryCode===a.countryCode));if(e.is(s)&&e.is(s.pos)){let e=parseFloat(s.pos.latitude),i=parseFloat(s.pos.longitude);e<=n&&e>=r&&i<=c&&i>=d&&(t[o]=a)}}}if(i._lastZoom=l,i._zoomContinent>=l){if(Object.keys(t).length)i._buildContinentFromZoom(t);else{let n=i.findContinentFromPos(o,s);if(e.is(n)){let s=e.is(i._continentsList)&&i._continentsList[n];e.is(s)&&i._buildContinentFromZoom(t,n)}}}else i._showMarkersinfo(!0)}else if("continent"!==i._latRefine){r.hideAndLock(i,!1);let t=i._cleanCountryFilter();if(e.is(t)&&e.is(t.filters)){e.is(t.index)&&-1!==t.index&&t.filters.condition.splice(t.index,1),i.mask();let n=t.filters,s=i._collection.getTaggerProxy();e.is(s)&&s.setLocalFilter(n,!0)}i._latRefine="continent"}else i._showMarkersinfo(!0);i._lastZoom=l},_onMoveStart:function(){var e=this;!1!==e._geolocationHierarchy?e._showMarkersinfo(!1):e._removeMarkersinfo(!1)},_setupCluster:function(t,i){let n=this;if(!e.is(n._collection))return;r.removeallMarkers(n),n._deleteMarkers(),e.is(n._ClusterSet)&&(delete n._ClusterSet,n._ClusterSet=null),e.is(n._listOfSources)&&(delete n._listOfSources,n._listOfSources=null),n._lastSelectedCountry=null,n._ClusterSet={},n._listOfpersons=[];let s=t;require(["DS/TagNavigator/simplified/utils/PersonUtils"],(function(t){let i=[],l="OnPremise",c=n._collection.getTaggerProxy();if(e.is(c)){let t=e.is(c.get,"function")?c.get("tenant"):c.tenant;e.is(t)&&t.length&&(l=t)}if(e.is(c)){let t=c.latest_tagValues;if(e.is(t)){let s=[],o=c.getCurrentFilter();if(e.is(o)){let t=o.localfilters;if(e.is(t)&&e.is(t.condition)){t.condition.findIndex((function(t){let i=Object.keys(t);if(i&&i.length&&"ds6w:who/person"===i[0]){let i=t["ds6w:who/person"].condition;if(e.is(i)&&i.length>0){let e=i.length;for(var o=0;o<e;o++)s.push(i[o].object)}}else if(i&&i.length&&"ds6w:where/ds6w:location/computedCountryInfo"===i[0]){let i=t["ds6w:where/ds6w:location/computedCountryInfo"].condition;if(e.is(i)&&i.length>0){let t=i.length;if(1===t)s=i[t-1].value;else{let o=i[0],a=!1;if(e.is(o)){let t=o.object,i=Object.keys(n._continents),s=i.length;for(let o=0;o<s;o++){let r=n._continents[i[o]];e.is(r)&&r===t&&(a=!0,o=s)}}let r=0;!0===a&&(r=1);for(let n=r;n<t;n++)o=i[n],e.is(o)&&(s=s.concat(i[n].value))}}}}))}}if(s.length)for(var d=0;d<t.length;d++){if("ds6w:who/ds6w:responsible"===(u=t[d]).sixw){let e=u.object;-1!==s.indexOf(e)&&i.push(u)}}else for(d=0;d<t.length;d++){var u;"ds6w:who/ds6w:responsible"===(u=t[d]).sixw&&i.push(u)}}}let h={userId:o.getUserId(),platformID:l};t.getUsersInfoFromSummary(i,h,(function(t){var i={},o={};if(e.is(t,"array")&&(n._listOfpersons=t,t.forEach((function(t){var n,s,r=t.getCountry(),l=t.get("count");e.is(r,"array")&&1===r.length?((r=r.filter((function(e){return!!e}))).forEach((function(s){if(!(n=i[s])){let o=t.get("personInfo").get("countryCode");if(e.is(o,"array")&&o.length){let e=o[0].split(".");o=e[1]}(n=[]).person=[],n.city=[],n.countryCode=o,i[s]=n}let o=n.count;e.is(o)?n.count=l+o:n.count=l,n.person.push(t)})),(s=t.getCity())&&(s=s.filter((function(e){return!!e}))).forEach((function(e){var i=o[e];i||(i=[],o[e]=i),i.push(t),n.city[e]=o[e]}))):(a.groupCollapsed("->SNResultUX/views/helpers/utils/GlobeView user have multiple countries or no country"),a.log("Title: ",t._attributes.title),a.log("Countries count: ",t._attributes.personInfo._attributes.country.length),a.groupEnd())})),!0===s&&(n._ClusterSetFromTopbar&&delete n._ClusterSetFromTopbar,n._ClusterSetFromTopbar=i),n._ClusterSet=i,n._tagDatas=e.clone(n._resultMgt.getEmbeddedTaggerTags()),n._globe)){if(n.unmask(),n._lastZoom<=n._zoomContinent)n._addMarkersCountries(n._ClusterSet,n._lastSelectedCountry),r.zoomOnVIPCountry(n._globe,n._ClusterSet,n._countries,n._lastZoom),setTimeout((function(){n._showMarkersinfo(!0)}),n._delay);else{let t=r.findCountryByLocalFilters(n._collection);e.is(t)&&e.is(t.predicate)&&"ds6w:where/ds6w:location/computedCountryInfo"===t.predicate&&e.is(t.object,"array")&&t.object.length>1?n._computeRefineDisplay():n._buildContinents()}!0===n._3DEXPERIENCEAsContinent&&r.addMarker3DExp(n._globe,n._container,n._MarkerInfo,n,!0),!0===n._3DExperienceSelected?(n._globe.turnGlobeToLatLon(n._globe.globe.camera.lat,n._globe.globe.camera.lon,6.2),n._showMarkersinfo(!1),n._globe.allowZoom(!1),n._globe.globe.overlayDisplayed=!0):(n._globe.allowZoom(!0),n._globe.globe.overlayDisplayed=!1),n.refreshFromMultiview(n._resultMgt.skeleton.getWhereView())}}))}))},_addMarkersCountry:function(e){let t=this;t._listOfMarkerInfo=r.addMarkersCountry(e,t._globe,t._ClusterSetFromTopbar,t._container,t._MarkerInfo,t)},_addMarkersCountries:function(e,t){let i=this;i._listOfMarkerInfo=r.addMarkersCountries(e,i._globe,i._ClusterSetFromTopbar,i._countries,i._container,i._MarkerInfo,i,t)},_refineCountry:function(t){let i=this;e.is(list)&&e.is(i._collection)&&(i._latRefine=r.refineCountryList(i,t,i._collection,i._globe,i._latRefine,i._ClusterSetFromTopbar))},_refineEmptyCountry:function(e){let t=this;t._latRefine=r.refineEmptyCountry(t,e,t._collection,t._globe,t._latRefine,t._ClusterSetFromTopbar)},_refineCountryList:function(t){let i=this;if(!e.is(t)||!e.is(i._collection))return;let n=Object.keys(t);1===n.length&&i._latRefine===n[0]||(i._latRefine=r.refineCountryList(i,t,i._collection,i._globe,i._latRefine,i._ClusterSetFromTopbar))},_refineContinent:function(t){let i=this;if(e.is(t)&&e.is(i._collection))return i._latRefine=t,r.refineContinent(i,t,i._collection,i._latRefine,i._continents,i._continentsList)},_cleanCountryFilter:function(){if(e.is(this._collection))return r.cleanCountryFilter(this._collection)},_buildContinents:function(){let t=this;if(!e.is(t._ClusterSet)||!e.is(t._countries))return;let i=r.buildContinents(t._globe,t._ClusterSetFromTopbar,t._ClusterSet,t._countries,t._continentsPos,t._countriesISO3,t._continents,t._lastZoom,t._container,t._MarkerInfo,t,!0);e.is(i)&&(t._continentsList=i.continentsList,t._listOfMarkerInfo=i.listOfMarkerInfo,t._lastZoom=i.lastZoom)},_turnGlobeToLatLonCountry:function(t){let i=this;e.is(i._ClusterSet)&&e.is(i._countries)&&r.turnGlobeToLatLonCountry(t,i._countries,i._globe,i._lastZoom)},_buildContinentsMarkers:function(t){let i=this;e.is(i._continentsList)&&e.is(i._globe)&&(i._listOfMarkerInfo=r.buildContinentsMarkers(i._continentsList,i._continents,i._globe,i._continentsPos,i._container,i._MarkerInfo,i,i._zoomContinentGlobe,t),i._lastZoom=i._zoomContinentGlobe)},_showMarkersinfo:function(t){let i=this;if(!e.is(i._listOfMarkerInfo))return;let n=i._listOfMarkerInfo;!0===i._3DExperienceSelected&&(n=[]),r.showMarkersinfo(t,n,i._globe)},_removeMarkersinfo:function(){e.is(this._listOfMarkerInfo)&&r.removeMarkersinfo(this)},_deleteMarkers:function(){let t=this;t._globe&&t._globe.globe&&t._globe.clearMarkers(),e.is(t._listOfMarkerInfo)&&(r.removeMarkersinfo(t,t._listOfMarkerInfo),t._listOfMarkerInfo=[]),e.is(t._listOfMarker3Dexp)&&(r.removeMarkersinfo(t,t._listOfMarker3Dexp),t._listOfMarker3Dexp=[]),e.is(t._listOfMarkersSources)&&(r.removeMarkersinfo(t,t._listOfMarkersSources),t._listOfMarkersSources=[]),t._3DExperienceSelected=!1},_updateUI:function(t){let i=this;e.is(t)&&e.is(t.position)&&"maximized"===t.position&&(i._showMarkersinfo(!0),r.refresh3DExperienceMarkers(i))},_buildContinentFromZoom:function(t,i){var n=this;if(!e.is(n._ClusterSetFromTopbar))return;let s=e.is(i)?i:void 0;if(!e.is(s)){let i=e.is(t)&&Object.keys(t);if(i.length){let t=i[0],o=n._ClusterSetFromTopbar[t];if(e.is(o)){let e=o.countryCode,t=n._countries.find((t=>t.countryCode===e));t&&(s=t.continent)}}}if(e.is(s)&&0!==s.length){let e=r.refineContinent(n,s,n._collection,n._latRefine,n._continents,n._continentsList);n._latRefine=s,!1===e?r.hideAndLock(n,!1):n._showMarkersinfo(!0)}},back:function(){let t=this;if(e.is(t._globe)){if(!1===this._geolocationHierarchy){let i=t._collection.getTaggerProxy();return e.is(i)&&i.setTags(t._subjectsTagsCloned,t._tagValuesCloned),void t._displayAtStart()}return r.back(t._resultMgt.getEmbeddedTaggerTags(),t)}},clickOnTitleMultiView:function(t){let i=this;if(e.is(i._globe)&&e.is(t)&&e.is(t.element)&&!1===i._geolocationHierarchy){let n=i._countries.find((e=>e.title===t.element));if(e.is(n)){i._globe.clearMarkers(),i._removeMarkersinfo(),i._addMarkersCountry(n);let e=parseFloat(n.pos.latitude),t=parseFloat(n.pos.longitude);i._lastZoom=1.35,i._globe.turnGlobeToLatLon(e,t,i._lastZoom),setTimeout((function(){i._showMarkersinfo(!0)}),500)}}},refreshFromMultiview:function(e){let t=this;r.refreshFromMultiview(e,t._ClusterSetFromTopbar,t._listOfMarkerInfo,t._globe,t._listOfMarkersSources,t)},_refreshViewFromOnGrouping:function(t){if(!e.is(t))return;let i=this,n=!1;if(i._WhereIsActivate=!1,e.is(t)||(n=!0),e.is(t,"object")&&e.is(t.groups,"array")&&0==t.groups.length&&(n=!0),1==n)return;let s,o=[];for(let e=0;e<t.groups.length;e++)o.push(t.groups[e].predicate);s=o&&o.length&&o[0],i._geoActivate=!1,i._3DEXPERIENCEActivate=!1,a.log("->SNResultUX/views/helpers/utils/GlobeView _refreshViewFromOnGrouping"),"computedCountryInfo"===s?(i._WhereIsActivate=!0,!0===i._3DExperienceSelected&&r.activate3DExperience(i,"3DExperience"),i._lastZoom=i._zoomContinentGlobe,i._setupCluster(!0,t),a.log("->SNResultUX/views/helpers/utils/GlobeView _refreshViewFromOnGrouping predicate: ",s),i._globe.allowZoom(!0),i._globe.globe.overlayDisplayed=!1,i._geoActivate=!0):"ds6w:dataSource"===s&&(i._WhereIsActivate=!0,!1===i._3DExperienceSelected&&(r.activate3DExperience(i,"3DExperience"),i._3DEXPERIENCEActivate=!0),a.log("->SNResultUX/views/helpers/utils/GlobeView _refreshViewFromOnGrouping predicate: ",s))},_computeRefineDisplay:function(){let t=this;if(!1===t._WhereIsActivate)return;t.getCurrentViewId();t._lastSelectedCountry=null,t._3DEXPERIENCEActivate=!1,a.log("->SNResultUX/views/helpers/utils/GlobeView _computeRefineDisplay");let i=r.getPredicateType(t._collection),n=r.refineCountry(t);if(e.is(n)){if(!0===n.country){let e=n.countryId;a.log("->SNResultUX/views/helpers/utils/GlobeView _computeDisplay found country: ",e),r.removeallMarkers(t),r.addMarker3DExp(t._globe,t._container,t._MarkerInfo,t,!1),t._globe.allowZoom(!0),t._globe.globe.overlayDisplayed=!1,t._3DEXPERIENCEActivate=!1;let i=t._ClusterSet[e];a.log("->SNResultUX/views/helpers/utils/GlobeView _computeRefineDisplay Country Selected found: ",i),t._lastSelectedCountry=i,t._globe.clearMarkers(),t._removeMarkersinfo(),t._turnGlobeToLatLonCountry(i),t.unmask(),t._addMarkersCountries(t._ClusterSet,i),setTimeout((function(){t._showMarkersinfo(!0)}),t._delay),t._latRefine=e}else if(e.is(n.continent)){r.removeallMarkers(t),t._3DEXPERIENCEActivate=!1,t.unmask(),r.addMarker3DExp(t._globe,t._container,t._MarkerInfo,t,!1),t._globe.allowZoom(!0),t._globe.globe.overlayDisplayed=!1;let i,s=n.continent,o=Object.keys(t._continentsList);if(e.is(o)){let e=o.length;for(let n=0;n<e;n++)t._continentsList[o[n]].title===s&&(i=o[n],n=e)}if(e.is(i)){t._listOfMarkerInfo=r.buildContinentsCountriesMarkers(i,t._globe,t._continentsList,t._continentsPos,t._ClusterSetFromTopbar,t._countries,t._container,t._MarkerInfo,t._lastZoom,t);let n=t._continentsList[i];e.is(n)&&(t._ClusterSet=n.countries),t._latRefine=i,a.log("->SNResultUX/views/helpers/utils/GlobeView _computeRefineDisplay Continent found and explode: ",i)}else t._latRefine="continent",t._buildContinentsMarkers(!0),a.log("->SNResultUX/views/helpers/utils/GlobeView _computeRefineDisplay Global View")}else if(e.is(n.source)&&!0===n.source)if(!1===t._3DEXPERIENCEActivate)t._globe.allowZoom(!0),t._globe.globe.overlayDisplayed=!1,t._setupCluster(!0);else{let e=n.display;a.log("->SNResultUX/views/helpers/utils/GlobeView _computeRefineDisplay Data source: ",e),t._latRefine="continent",t._lastZoom=t._zoomContinentGlobe,t._setupCluster(!0),r.manageActivationSourcesMarkers(t,e)}}else if("ds6w:who/person"===i&&!1===t._3DEXPERIENCEActivate){if("continent"===t._latRefine){"where"!==t.getCurrentViewId()&&e.is(n)||(t._latRefine="continent",t._lastZoom=t._zoomContinentGlobe)}t._globe.allowZoom(!0),t._globe.globe.overlayDisplayed=!1,t._setupCluster(!0)}else{let i=t.getCurrentViewId();"where"!==i&&e.is(n)?e.is(countryName):(t._globe.allowZoom(!0),t._globe.globe.overlayDisplayed=!1,t._latRefine="continent",t._lastZoom=t._zoomContinentGlobe,t._setupCluster(!0),a.log("->SNResultUX/views/helpers/utils/GlobeView _computeRefineDisplay Global View continent"))}},_displayAtStart:function(){let e=this;e._lastSelectedCountry=null,e._lastZoom=3,e._globe.clearMarkers(),e._removeMarkersinfo(),e._globe&&e._globe.turnGlobeToLatLon(42,18,e._lastZoom),e._addMarkersCountries(e._ClusterSet,e._lastSelectedCountry),setTimeout((function(){e._showMarkersinfo(!0)}),e._delay)},On3DExperienceChange:function(t){let i=this._resultMgt&&this._resultMgt.skeleton.getWhereView();e.is(i)&&e.is(i.On3DExperienceChange,"function")&&i.On3DExperienceChange(t)},getCurrentViewId:function(){return this.collection.getSNSkeleton()&&this.collection.getSNSkeleton()._skeleton.getViewAt(0)?this.collection.getSNSkeleton()._skeleton.getViewAt(0).currentViewId:null},_getHeightWidth:function(e,t){return e.getDimensions()[t]},_createDockingElement:function(){r.createdockingView(this)},refresh3DExperienceMarkers:function(){var e=this;setTimeout((function(){!0===e._3DExperienceSelected?0===e._listOfMarkersSources.length?r.createMain3DExperienceMarker(e):r.refresh3DExperienceMarkers(e):r.showMarkersinfo(!e._3DExperienceSelected,e._listOfMarkerInfo,e._globe)}),1100)},mask:function(){0===this._iphone&&l.showOverlayLoader(void 0,this._container)},unmask:function(){0===this._iphone&&l.hideOverlayLoader(this._container)},findContinentFromPos:function(t,i){let n,s=this,o=s._continentsPos.length;for(let a=0;a<o;a++){let r=s._continentsPos[a];if(e.is(r)){let s=r.limit;if(e.is(s)){let e=s.Nord,l=s.Sud;if(i<=e&&i>=l){let e=s.Ouest,i=s.Est;e<=t&&t<=i&&(n=r.name,a=o)}}}}return n}})})),define("DS/SNResultUX/utils/SearchLocalActions",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Model","DS/SNInfraUX/SearchSettings","DS/SNResultUX/utils/SearchServices","UWA/Promise","UWA/Class/Collection","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchUtils","DS/WAFData/WAFData","DS/SNResultUX/utils/PowerBySearchLocalActions","DS/SNInfraUX/ServiceDelegationLoader"],(function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p){"use strict";var _=n.extend({idAttribute:"id"});return t.singleton(i,{_action_Unselect_All:{sourcejs:"DS/SNResultUX/utils/Select_ActionHandler",icon:"select-none",multisel:!0,id:"unselect_all",title:c.get("unselectAllTitle")},_action_Select_All:{sourcejs:"DS/SNResultUX/utils/Select_ActionHandler",icon:"select-all",multisel:!0,id:"select_all",title:c.get("selectAllTitle")},_action_Preview:{sourcejs:"DS/SNResultUX/utils/Select_ActionHandler",icon:"eye",multisel:!0,id:s.getOption("command_id.new_preview"),title:c.get("previewTitle")},_action_AddTag:{sourcejs:"DS/SNResultUX/utils/AddTag_ActionHandler",icon:"tag",multisel:!0,id:s.getOption("command_id.add_tag"),title:c.get("add_tag.add_tag_header")},_action_Information:{sourcejs:"DS/SNResultUX/utils/Select_ActionHandler",icon:"info",multisel:!0,id:s.getOption("command_id.new_information"),title:c.get("infoPanel.toggle")},_3dd_link_to_item:{sourcejs:"DS/SNResultUX/utils/GenerateLink_ActionHandler",icon:"link",multisel:!1,id:s.getOption("command_id.generate_link"),title:c.get("search.widget.share.link.to.item")},_isGoodInput:function(t,i){return!(!e.is(t,"array")||t.length<0)&&!(!e.is(i,"object")||!e.is(i.skeleton))},_isSelectionFromSameSource:function(t){var i=new r([],{model:_});return new a((function(n,s){for(var o="",a="",r=!0,l={appName:u.getSearchAppId(),objects:[]},c=function(e){var t=e.get("ds6w:type_value"),n={id:e.id,type:t,source:e.getSourceID()};l.objects.push(n),i.add(n)},d=t.length,h=0;h<d&&r;h++){var g=t[h];e.is(g)&&(c(g),0===h?(a=g.getSourceID(),o=g.getServiceID(),l.platformId=g.getPlatformID()):o!==g.getServiceID()&&(r=!1))}r?n({data:l,sourceID:a,serviceID:o,objectsToTreat:i,models:t}):s({data:l,sourceID:a,serviceID:o,objectsToTreat:i,models:t})}))},_buildEmptyAction:function(e){return{actions:[],id:e}},_buildEmptyActionsOnFailure:function(e){for(var t={actions:[],status:"failure"},i=0;i<e.data.objects.length;i++)t.actions.push(this._buildEmptyAction(e.data.objects[i].id));return t},_addEmptyActions:function(t,i){if(e.is(t)&&e.is(t.actions,"array")&&i.objectsToTreat.size()!==t.actions.length){for(var n=0;n<t.actions.length;n++){var s=t.actions[n];i.objectsToTreat.remove(i.objectsToTreat.get(s.id))}var o=i.objectsToTreat.toArray();if(e.is(o,"array"))for(var a=0;a<o.length;a++)t.actions.push(this._buildEmptyAction(o[a].get("id")))}},_addSelectUnselect:function(t,i){if(u.isFUNActive("FUN075064")&&e.is(t)&&e.is(t.actions,"array"))for(var n=0;n<t.actions.length;n++)i.add_unselectAll&&t.actions[n].actions.unshift(this._action_Unselect_All),i.add_selectAll&&t.actions[n].actions.unshift(this._action_Select_All)},_addPreview:function(t,i){if(e.is(i)&&e.is(i.skeleton)&&e.is(t)&&e.is(t.actions,"array"))for(var n=0;n<t.actions.length;n++)!0===i.add_preview&&t.actions[n].actions.push(this._action_Preview)},_addTag:function(t){if(e.is(t)&&e.is(t.actions,"array"))for(var i=0;i<t.actions.length;i++)t.actions[i].actions.push(this._action_AddTag)},_addInformation:function(t){if(e.is(t)&&e.is(t.actions,"array"))for(var i=0;i<t.actions.length;i++)t.actions[i].actions.push(this._action_Information)},_add3DDLinkToItem:function(t){if(e.is(t)&&e.is(t.actions,"array"))for(var i=0;i<t.actions.length;i++)t.actions[i].actions.push(this._3dd_link_to_item)},_getLanguage:function(){return u.getLanguage()},_treatActionImages:function(t,i){t&&e.is(t.actions,"array")&&t.actions.forEach((function(t){if(e.is(t.actions,"array"))for(var n=t.actions,s=0;s<n.length;s++)n[s].iconImage&&(n[s].iconImage.indexOf("://")>0?n[s].image=n[s].iconImage:n[s].image=i+n[s].iconImage)}))},executeWSAction:function(t){if(e.is(t)){var i=t.url,n=t.method;if(e.is(i,"string")&&e.is(n,"string")){var s=this,o={};o.method=n,o.headers=t.headers||{},o.headers["Accept-Language"]=this._getLanguage(),o.url=t.url+"/?oid="+t.selected_obj,e.is(t.data,"object")||e.is(t.data,"array")?o.data=JSON.stringify(t.data):e.is(t.data,"string")&&(o.data=t.data);var a=function(i){var n=null,s=null;try{var o=JSON.parse(i);n=o.message,e.is(n,"string")||(n="INVALID response",s="error"),s=o.status,e.is(s)||(s="success")}catch(e){n="INVALID response",s="error"}t.displayAlert({message:n,className:s})};o.onComplete=function(e){s.log("WS execution done, inide onComplete"),a(e)},o.onFailure=function(e){s.log("WS execution done, inide onFailure"),a(e)},h.authenticatedRequest(o.url,o)}else this.log("invalid execute options, url = "+i+", method="+n)}},getActions:function(t){var i=this;if(e.is(t))if(e.is(t.data)&&e.is(t.data.objects)&&0!==t.data.objects.length){var n=function(n){var s={method:"POST"};s.headers=n.headers||{},s.headers.Accept="application/json",s.headers["Accept-Language"]=i._getLanguage(),s.headers["Content-Type"]="application/json",s.url=n.url,s.data=JSON.stringify(t.data),s.onComplete=function(i){var n=e.is(i,"string")?i.length>0?JSON.parse(i):{}:i;e.is(t.onComplete,"function")&&t.onComplete.call(void 0,n)},s.onFailure=function(i){e.is(t.onFailure,"function")&&t.onFailure.call(void 0,{type:"web_service_failure",error:i})},h.authenticatedRequest(s.url,s)};g.getPowerByActions({options:t,server_actions:function(){e.is(t.serviceID,"string")&&t.serviceID.length>0?l.getServiceUrl({serviceName:t.serviceID,platformId:t.data.platformId,onComplete:function(s){p.load({serviceID:t.serviceID,platformID:t.data.platformId,serviceURL:s}).then((function(o){if(e.is(o.getActions,"function")){var a={models:t.models,widget_id:t.widget_id,data:t.data,serviceURL:s,headers:{Accept:"application/json","Accept-Language":i._getLanguage()},onComplete:function(n){e.is(t.onComplete,"function")&&(i._treatActionImages(n,s),t.onComplete.call(void 0,n,t.serviceID))},onFailure:function(i){e.is(t.onFailure,"function")&&t.onFailure.call(void 0,{type:"action_delegation_failure",error:i})}};o.getActions(a)}else e.is(o.getActionsPath,"function")?n({url:s+o.getActionsPath({sourceID:t.sourceID,platformID:t.data.platformId})}):e.is(t.onFailure,"function")&&t.onFailure.call(void 0,{type:"action_delegation_not_impl",error:"service delegation for actions not implemented"})}),(function(i){p.discover({platformID:t.data.platformId,sourceID:t.sourceID}).then((function(t){if(e.is(t,"object")&&e.is(t.APIs,"object")){var i=t.APIs.getActionsPath;e.is(i,"object")&&e.is(i.url,"string")&&n({url:i.url,headers:i.headers})}}),(function(){e.is(t.onFailure,"function")&&t.onFailure.call(void 0,{type:"require_failure",error:i})}))}))}}):p.discover({platformID:t.data.platformId,sourceID:t.sourceID}).then((function(t){if(e.is(t,"object")&&e.is(t.APIs,"object")){var i=t.APIs.getActionsPath;e.is(i,"object")&&e.is(i.url,"string")&&n({url:i.url,headers:i.headers})}}),(function(i){e.is(t.onFailure,"function")&&t.onFailure.call(void 0,{type:"require_failure",error:i})}))}})}else e.is(t.onFailure,"function")&&t.onFailure.call(void 0,{type:"invalid_inputs",error:"invalid inputs"})},computeCtxActions:function(t,i){if(!this._isGoodInput(t,i))throw new Error("input is not in expected format");var n,a=this,r=i.skeleton,l=e.is(t,"array")?t.length:0,h=e.is(r)&&e.is(r._onesearch_collection)&&e.is(r._onesearch_collection.totalCount)?r._onesearch_collection.totalCount:0,g=void 0;s.getOption("search_web_in_win")||!e.is(r)||"oneToOne"===r._selectionMode_techno||e.is(s.getOption("search_compact_mode"))||(g={add_selectAll:l!==h,add_unselectAll:!0});var p=!0;let _=u.identifyClientInfo();(e.is(i)&&e.is(i.fromPreview)&&!0===i.fromPreview||"3DSwym"===_.identifier&&!1===_.deprecated)&&(p=!1);let f=!1,m=!0;("mobile"===u.getDeviceType()||u.isTabletCompactMode())&&(m=!1),e.is(r)&&e.is(r.informationsAction)&&!1===r.informationsAction&&(m=!1),n={add_preview:p,skeleton:r};let S=t[0].getPlatformID();f=u.hasTaggerSubjectURI(t,S),this._isSelectionFromSameSource(t).then((function(o){var l=i.skeleton.getOption("in_apps_search"),c=e.is(l),h=i.skeleton.getOption("addinMode"),p=e.is(h,"string")&&h.length>0;let _=i.skeleton.getOption("powerByOptions"),S=_&&_.hasPowerByActions;var v=c&&"furtive"==l.mode;if(!p&&v||p&&(e.is(S)&&!S||!e.is(S)&&c)){var w=a._buildEmptyActionsOnFailure(o);return e.is(g)&&a._addSelectUnselect(w,g),e.is(n)&&a._addPreview(w,n),m&&a._addInformation(w),void i.skeleton.setCtxMenuForItemViewOptions({actions_data:w,dropdownOptions:i})}o.isAddinMode=p,o.data.applicativeInfo={incontextMode:v,clientAppInfo:u.identifyClientInfo(h)},e.is(r)&&(o.widget_id=r.getOption("widgetId")),o.onComplete=function(r,l){let c=t;if("success"===r.status){let t=!1;if(e.is(r)&&e.is(r.actions,"array"))for(var d=0;d<r.actions.length;d++){var h=r.actions[d].actions;let i=-1;for(let e=0;e<h.length;e++)if(h[e].id==s.getOption("command_id.relations")){if(i=e,0!=i){let e=h.splice(i,1);r.actions[d].actions.splice(0,0,e[0]),i=0}break}e.is(n)&&n.add_preview&&f&&m?r.actions[d].actions.splice(i+1,0,a._action_AddTag,a._action_Preview,a._action_Information):e.is(n)&&n.add_preview&&f&&!m?r.actions[d].actions.splice(i+1,0,a._action_AddTag,a._action_Preview):e.is(n)&&n.add_preview&&!f&&m?r.actions[d].actions.splice(i+1,0,a._action_Preview,a._action_Information):e.is(n)&&n.add_preview&&!f&&!m?r.actions[d].actions.splice(i+1,0,a._action_Preview):m?r.actions[d].actions.splice(i+1,0,a._action_AddTag,a._action_Information):r.actions[d].actions.splice(i+1,0,a._action_AddTag),t=!0}a._addEmptyActions(r,o),e.is(g)&&a._addSelectUnselect(r,g),t||(f&&a._addTag(r),m&&a._addInformation(r),e.is(n)&&a._addPreview(r,n)),1===r.actions.length&&u.identifyClientInfo().identifier&&!1===u.isWebInWin()&&-1===["solidworks","catiav5"].indexOf(s.getOption("addinmode"))&&"3DDashboard"===u.identifyClientInfo().identifier&&"3DSpace"===l&&!0!==r.actions[0].actions.map((e=>"run_saved_search"===e.id&&"SavedSearch.PRIVATE"===c[0]._attributes["ds6w:status_value"])).find((e=>e))&&a._add3DDLinkToItem(r),i.skeleton.setCtxMenuForItemViewOptions({actions_data:r,dropdownOptions:i})}else{var p=a._buildEmptyActionsOnFailure(o);e.is(g)&&a._addSelectUnselect(p,g),f&&a._addTag(p),m&&a._addInformation(r),e.is(n)&&a._addPreview(p,n),i.skeleton.setCtxMenuForItemViewOptions({actions_data:p,dropdownOptions:i})}},o.onFailure=function(t){if(e.is(t)&&e.is(t.error)){var r=null;d.warn("Error during action computation: "+t.error),s.getOption("search_web_in_win")||("invalid_inputs"===t.type?(r={actions:[{actions:[]}]},a._addSelectUnselect(r,{add_selectAll:!0})):(r=a._buildEmptyActionsOnFailure(o),e.is(g)&&a._addSelectUnselect(r,g),f&&a._addTag(r),m&&a._addInformation(r),e.is(n)&&a._addPreview(r,n))),i.skeleton.setCtxMenuForItemViewOptions({actions_data:r,dropdownOptions:i})}},a.getActions(o)}),(function(t){var s=a._buildEmptyActionsOnFailure(t);e.is(g)&&a._addSelectUnselect(s,g),a._addTag(s),e.is(n)&&a._addPreview(s,n),m&&a._addInformation(s),i.skeleton.setCtxMenuForItemViewOptions({actions_data:s,dropdownOptions:i}),o._displayAlert({message:c.replace(c.get("localActions_multiSource")),className:"error"})}))}})})),define("DS/SNResultUX/models/SearchItemModel",["UWA/Core","UWA/Class/Model","DS/W3DXComponents/Collections/ActionsCollection","DS/SNInfraUX/SearchUtils","DS/SNResultUX/utils/ResultUX_customization","DS/SNInfraUX/SearchLogin","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SNVocabAccess","DS/SNInfraUX/Logger"],(function(e,t,i,n,s,o,a,r,l){"use strict";return t.extend({_isRecentSearch:!1,setup:function(t,n){let o=this;this.actions=new i([],{parent:this}),this.action_ids=[],e.is(t)&&(t.hasOwnProperty("session_object")&&(this.session_object=!0,delete t.session_object),t.hasOwnProperty("isRecentSearchResult")&&(this._isRecentSearch=t.isRecentSearchResult,delete t.isRecentSearchResult));let a=!0,r=null;e.is(this.collection)&&(!0===this.collection._isAHelper&&(a=!1),r=this.collection._ctx_options),!0===this.isAShowOnlyObject()&&(a=!1),a&&s.getAvailableActions({attributes:t},(function(e){e.forEach((function(e){-1===o.action_ids.indexOf(e.id)&&(o.action_ids.push(e.id),o.actions.push(e))})),o._attributes.actions&&0!==o._attributes.actions.length||(o._attributes.actions=o.actions.pluck("title"))}),{inCtxOptions:r}),this._computeSnippetInformation(),this._parent(t,n)},getFederatedSource:function(){return e.is(this.collection)?this.collection.search_ressources:null},get:function(e){return this._parent(n.getURIToUse(e))},set:function(t,i,s){let o;if(e.is(t,"object")){let e=Object.keys(t);o={};for(let i=0,s=e.length;i<s;i++)o[n.getURIToUse(e[i])]=t[e[i]];s=i||{}}else o={},o[n.getURIToUse(t)]=i,s=s||{};return this._parent(o,s)},getSourceID:function(){let t=this.get("sourceid_value");return e.is(t,"string")&&t.length>0?t=t.split(":")[0]:l.error("sourceid not found OR not in the expected format:",t),t},getServiceID:function(){return o.getServiceFromSource(this.getSourceID())},getPlatformID:function(){let t="OnPremise",i=this.get("sourceid_value");if(e.is(i,"string")&&i.length>0){let e=i.split(":");e.length>1&&(t=e[1])}else l.error("sourceid not found OR not in the expected format:",i);return t},getDisplayType:function(){return this.get("ds6w:type")},getI3dx:function(){return this.get("ds6w:i3dx")},getDisplayName:function(){return this.get("ds6w:label_value")},getType:function(){return this.get("ds6w:type_value")},getColor:function(){return this.collection.getColor(this)},getContextId:function(){return e.is(this.collection)&&e.is(this.collection.getSNSkeleton())?this.collection.getSNSkeleton().getSecurityContext():null},isARecentSearchResult:function(){return this._isRecentSearch},isAShowOnlyObject:function(){let t=this.get("showonly");return!0===a.getOption("showOnlySupport")&&!(!e.is(t,"string")||"true"!==t)},IsAnInstance:function(){if(!0===a.getOption("SEARCH_INSTANCES",{tenant:this.getPlatformID()})){if("Instance"===this.get("ds6wg:isAnInstance_value"))return!0;if("3DSpace"===this.getServiceID()){var e="ds6wg:"+this.getType();return r.IsClassAnInstance(e)}}return!1},getSnippetInformation:function(){let t={classForHighlight:"highlightedSearchCriteria"},i=Object.keys(this._attributes);if(e.is(i,"array")){let n,s;for(let o=0,a=i.length;o<a;o++)if(n=i[o],n.indexOf(":snippet_value")>-1){try{s="array"===UWA.typeOf(this._attributes[n])?JSON.stringify(s):JSON.parse(this._attributes[n])}catch(e){l.error("Snippet parsing error!",e,this._attributes[n]),s=null}e.is(s)&&(t[n.substring(0,n.indexOf(":snippet_value"))]=s)}}return t},_computeSnippetInformation:function(){let t,i=[],n=this.getSnippetInformation(),s=[];e.is(n,"object")&&(e.is(n["ds6w:description"])&&(s=s.concat(n["ds6w:description"].text)),e.is(n.ds6w)&&(s=s.concat(n.ds6w.text)));for(let n=0,o=s.length;n<o;n++)if(!0===s[n].highlighted||"true"===s[n].highlighted){if(t=s[n].content,e.is(t,"string")){let n=t.split(", ");if(e.is(n,"array")&&1<n.length)for(let e=0,t=n.length;e<t;e++)-1===i.indexOf(n[e])&&i.push(n[e])}-1===i.indexOf(t)&&i.push(t)}this.set("snippetAsStringArray",i)}})})),define("DS/SNResultUX/collections/SearchCollection",["UWA/Core","UWA/Element","UWA/Class/Options","UWA/Class/Events","UWA/Event","UWA/Promise","DS/Utilities/Utils","DS/WebappsUtils/Performance","DS/WebAppsFoundations/Collections/PageableCollection","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/SNResultUX/models/SearchItemModel","DS/SNInfraUX/SearchSettings","DS/SNResultUX/utils/FederatedSearch_parse","DS/SNInfraUX/SearchCom","DS/SNInfraUX/SearchDebug","DS/SNInfraUX/ServiceDelegationLoader","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/utils/SearchNlsUtils","DS/WAFData/WAFData","DS/SNInfraUX/PredefinedQueries","DS/SNResultUX/utils/SearchCustoServices","DS/SNSearchResultsCusto/utils/SearchResultsCustomizationServices","DS/SNSearchResultsCusto/utils/SearchResultsCustomizationPreferences","DS/SNResultUX/utils/SearchServices","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/SNInfraUX/SearchViewServices","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/SearchLogin","DS/SNResultUX/utils/ContentLocationServices","DS/Controls/TooltipModel","DS/SNResultUX/utils/SearchTagsTransformation","DS/SNInfraUX/Api/SearchApi","DS/SNInfraUX/Logger","DS/SNInfraUX/RefineHelper/RefineHelper","DS/MessageBus/MessageBus","DS/PubSub/PubSub","DS/SNInfraUX/SNVocabAccess","text!DS/SNInfraUX/assets/SearchCollectionMappingPredicate.json","text!DS/SNInfraUX/assets/SearchView.json","DS/SNResultUX/utils/ResultsUtils","DS/SNResultUX/utils/DosThumbnailBatchHelper","DS/TagNavigator/simplified/utils/CriteriaUtils","DS/SNResultUX/unitconversion/SNUnitConversionHelper","DS/SNInfraUX/keywords/SNKeywordManager","DS/SNResultUX/utils/ResultColorizationHelper","text!DS/SNResultUX/assets/debug/fedsearch.json"],(function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_,f,m,S,v,w,b,C,y,D,I,T,A,x,N,E,O,k,P,M,R,V,U,L,F,j,W,B,X,H,G,z,q,Q){"use strict";var Z=l.extend(i,n,_,{uwaClassName:"DS/SNResultUX/collections/SearchCollection",name:"DS_SNResultUX_collections_SearchCollection",model:u,totalCount:-1,hits:0,snservices:"",search_ressources:null,service_parameters:null,_searchcom_socket:null,_search_in_progress:!1,_fedSearchLabel:"",_pcs_uuid:0,_ctx_options:null,_tagSearchString:null,_attrToRetrieve:[],_attrDefinition:null,facetsTags:null,_recentCollectionArray:null,_recentCollectionArrayFiltered:null,jetty_server_activated:!1,sessionResponse:null,sessionResponse_received:!1,_lastSubjectsTags:null,_fedsearchResp:null,_fedsearchOptions:null,_predicateIntersection:null,_indexingDate:null,_snSkeleton:null,_treeDocument:null,_NLS_ds6wg:{},_isResponsive:!0,_helperSubjectsTags:null,_helpertagValues:null,getHelperTagValues:function(){return this._helpertagValues},_CBOnComplete:null,_CBOnFailure:null,_failureView:!1,_modelsTab:[],_tagsTransformer:null,_isFirstProxySetTagsDone:!1,_update_security_contextTodo:!1,_searchViewSpec:null,_lastTagValues:null,featureId:null,_snUnitConversionHelper:new G,defaultOptions:{mode:"data",state:{firstPage:0,lastPage:null,currentPage:0,pageSize:40,totalPages:null,totalRecords:null,sortKey:null,order:-1,tagsSet:0},queryParams:{currentPage:null,totalPages:null,totalRecords:null,pageSize:"nresults"}},_source:"",_required_predicates:["ds6w:modified","ds6w:created","ds6w:label","ds6w:identifier","ds6w:responsible","ds6w:type","ds6w:description","owner","ds6w:responsibleUid","ds6wg:filesize","ds6w:i3dx"],_setTagsPromise:null,_setTagsDone:!1,_interruptRequested:!1,_securityContext3DSpace:[],fakeFedSearchResponse:null,setup:function(t,i){R.groupCollapsed("SearchCollection.setup"),R.log("attributes:",t),R.log("options:",i),t&&t.feature&&(this.featureId=t.feature),t&&t.grouping6W?D.disableBETA=!0:D.disableBETA=!1;if(this.setOptions(i),e.is(i.service)&&(this.log("Setup done from the skeleton => set service parameters"),this.setRequestCriteria(i.service,i.service_parameters),this.setSearchRessources(i.federated_source)),this._searchcom_socket=p.createSocket({socket_id:"search_collection_"+Math.floor(1e5*Math.random()+1)}),this._searchcom_socket.addListener("onSetSessionResponse",this.setSessionResponse.bind(this)),i.event&&i.event.onSetup&&i.event.onSetup.call(null,this),this.service_parameters&&!this.service_parameters.order_by||!e.is(this.service_parameters))if(!e.is(this.service_parameters)&&(this.service_parameters={}),m.getItem("search_keepColumnSorting")&&e.is(m.getItem("searchSort"))){let e=m.getItem("searchSort");this.setGlobalOrder(e.order_field,e.order_by,e.order_type,e.selectedIndex)}else if(h.getOption("default_sort")){var n=h.getOption("default_sort");e.is(n,"object")&&e.is(n.order_by,"string")&&e.is(n.order_field,"string")&&this.setGlobalOrder(n.order_field,n.order_by,n.order_type,n.selectedIndex)}else h.getOption("apply_sort_on_modified_by_default")&&this.setGlobalOrder("ds6w:modified","desc","num");else"3DSwym"===S.identifyClientInfo().identifier&&e.is(m.getItem("searchSort"));return this._searchViewSpec=JSON.parse(W),this._dosThumbnailBatchHelper=new X(this),this._colorizationHelper=new q,R.groupEnd(),this.fakeFedSearchResponse=JSON.parse(Q),this._parent(t,i)},onHelperCopy:function(e){this._dosThumbnailBatchHelper.copyFromHelper(e)},getLastFetchOptions:function(){return this._lastFetchOptions},getCloneCollection:function(){var t=this;return new Z(null,{event:{onSetup:function(i){i.setSearchRessources(t.getSearchRessources());var n=e.clone(t.getRequestCriteria(),!0);i.setRequestCriteria(n.service_name,n.service_params),i.setSearchSource(t._getSearchSource()),i.setTaggerProxy(t.getTaggerProxy())}}})},destroy:function(){R.groupCollapsed("SearchCollection.destroy"),this.isDestroyed=!0,e.is(this.timeoutId)&&clearTimeout(this.timeoutId),this._searchcom_socket&&(this._searchcom_socket.removeListener("onSetSessionResponse"),this._searchcom_socket.disconnect(),p.deleteSocket(this._searchcom_socket.id),this._searchcom_socket=null),this._snSkeleton=null,this._recentCollectionArray=null,this._recentCollectionArrayFiltered=null,this.search_ressources=null,this.service_parameters=null,this._ctx_options=null,this._attrToRetrieve=null,this._attrDefinition=null,this.facetsTags=null,this.sessionResponse=null,this._fedsearchResp=null,this._fedsearchOptions=null,this._predicateIntersection=null,this._snSkeleton=null,e.is(this._treeDocument)&&e.is(this._treeDocument.destroy,"function")&&(this._treeDocument.destroy(),this._treeDocument=null),this._NLS_ds6wg=null,this._helperSubjectsTags=null,this._helpertagValues=null,this._indexingDate=null,this._CBOnComplete=null,this._CBOnFailure=null,this.reset(),this._parent(),R.groupEnd()},_getRequiredPredicates:function(){return this._required_predicates},setTagsTransformer:function(e){this._tagsTransformer=e},setAdvancedSearchMsg:function(t,i){e.is(t)&&(i&&"#advancedSearch"==S.getsearchType()&&e.is(t.setInfoMessage)?t.setInfoMessage({type:"info",message:A.get("adv_search_broadQueryWarningMessage")}):e.is(t.clearInfoMessage)&&t.clearInfoMessage())},_setTags:function(t,i){if(R.groupCollapsed("SearchCollection._setTags"),!0===this._isCategoryHelperCollection)return R.log("isCategoryHelperCollection: true"),void R.groupEnd();var n=this,s=0;if(F.setResources({resources:n.search_ressources}),e.is(this.options.tagger_proxy))if(n._setTagsDone=!0,R.log("Set the Tags on the tagger proxy"),!0!==this._isTagSearchCollection&&(this.options.tagger_proxy.latest_subjectsTags=t,this.options.tagger_proxy.latest_tagValues=i),h.getOption("activate_dictionary_NLS_computation"))if(e.is(i)){var o=e.clone(t),a=e.clone(i);if(P.transformPredicateValuesWithMapping(a),e.is(a,"array")&&e.is(this._tagsTransformer))for(s=a.length-1;s>=0;s--)this._tagsTransformer.transformFacets(a,s);e.is(o,"object")&&Object.keys(o).length&&e.is(this._tagsTransformer)&&this._tagsTransformer.transformAddSubjectsToDataSourceFacets(o),v.translateFacets({facets:a,subjectTags:o,tenantId:this.getActiveTenant(),prepareNlsPropertiesValueForServerCb:function(e,t){return n._tagsTransformer.prepareNlsPropertiesValueForServer(e,t)},addSourceCb:function(t){e.is(n._tagsTransformer)&&n._tagsTransformer.addSource(t,n.getActiveTenant())},setNlsNameDetailsCb:function(t){e.is(n._tagsTransformer)&&n._tagsTransformer.setNlsNameDetails(t)},onComplete:function(){e.is(o)&&e.is(n._tagsTransformer)&&(n._setTagsPredicates(a),F.updateRootInPredicateLineage(a).then((function(){n.options.tagger_proxy.setTags(o,a,{count:n.totalCount,hideCounts:n.isSearchRespEstimated()}),n.setAdvancedSearchMsg(n.options.tagger_proxy,n.isSearchRespEstimated()),n.dispatchEvent("onSetTags",n)})),e.is(n._setTagsPromise)&&(n._setTagsPromise.resolve(),n._isFirstProxySetTagsDone=!0,R.log("_setTagsPromise resolved. Nls computation for tags is completed..")))},onFailure:function(){R.error("Failure calling DS/i3DXSNDictionaryAPI/3DXSearchDictionaryAccess.getNlsOfPropertiesValues !",arguments),n._setTagsPredicates(a),F.updateRootInPredicateLineage(a).then((function(){n.options.tagger_proxy.setTags(o,a,{count:n.totalCount,hideCounts:n.isSearchRespEstimated()}),n.setAdvancedSearchMsg(n.options.tagger_proxy,n.isSearchRespEstimated())})),n._isFirstProxySetTagsDone=!0,e.is(n._setTagsPromise)&&(n._setTagsPromise.resolve(),R.log("_setTagsPromise resolved. Nls computation for tags is failed..")),R.groupEnd()}})}else F.updateRootInPredicateLineage(i).then((function(){n.options.tagger_proxy.setTags(t,i,{count:n.totalCount,hideCounts:n.isSearchRespEstimated()}),n.setAdvancedSearchMsg(n.options.tagger_proxy,n.isSearchRespEstimated())})),this._setTagsPromise&&this._setTagsPromise.resolve();else F.updateRootInPredicateLineage(i).then((function(){n.options.tagger_proxy.setTags(t,i,{count:n.totalCount,hideCounts:n.isSearchRespEstimated()}),n.setAdvancedSearchMsg(n.options.tagger_proxy,n.isSearchRespEstimated())}));else R.warn("Tagger proxy not defined");R.groupEnd()},setAllMyContent:function(e){this.allMyContent=e},_addSubjects:function(t){var i=this;e.is(this.options.tagger_proxy)?(R.log("addSubjects on the tagger proxy"),e.is(this._setTagsPromise)&&e.is(this._setTagsPromise.promise)&&e.is(i._tagsTransformer)?this._setTagsPromise.promise.then((function(){R.log("_setTagsPromise resolved. Calling addSubjects on the tagger proxy"),i._tagsTransformer.transformAddSubjectsToDataSourceFacets(t),i.options.tagger_proxy.addSubjects(t),i._lastSubjectsTags={...i._lastSubjectsTags,...t}})):R.warn("_setTagsPromise is null..")):R.log("Tagger proxy not defined")},_mergeOldAndNewTagValues:function(t,i,n){var s=[];if(e.is(n)&&e.is(n.allfilters)){var o=n.allfilters;for(var a in V.isSimplifiedTaggerFilters(o)&&(o=V.getAllFilters(o)),o)for(var r=0;r<t.length;r++){var l=t[r];l.sixw===a&&s.push(l)}}if(s=V.preMergeSimplifiedTagger(t,i,n.allfilters,s,H.getCategorizedPredicates()),e.is(i)||(i=[]),s.length>0){var c,d,u=!1;s.length>i.length?(d=s,c=i):(d=i,c=s,u=!0);for(var h=0;h<c.length;h++){var g=!1,p=c[h],_=p.count;p.count=0,p.pertinencyScore=0;var f=JSON.stringify(p);p.count=_;var m=!1,S=0;for(S=0;S<d.length;S++){var v=d[S],w=v.count;v.count=0,v.pertinencyScore=0;var b=JSON.stringify(v);if(v.count=w,b===f){g=!0,w===_&&(m=!0);break}}!1===g?d.push(c[h]):u||!g||m||(d[S]=c[h])}return d=V.postMergeSimplifiedTagger(n.allfilters,d)}return i=V.postMergeSimplifiedTagger(n.allfilters,i)},setIsAPQSearch:function(t){let i=/[\s\b]*3dexp(\w+):/g;for(;;){let n=i.exec(t);if(!n)break;if(b.isAPQAbbrevation(n[1])&&e.is(this.service_parameters)){this.service_parameters.isAPQSearch=!0;break}}},getPQSortOrder:function(t){var i,n="",s=/[\s\b]*3dexp(\w+):/g.exec(t);if(s){var o=s[1];b.isAPQAbbrevation(o)&&(n=b.getSortOrder(o));var a=null,r=null;if(e.is(n,"array")){if(1<n.length){for(var l in a=[],r=[],n){var c=n[l];for(var d in c){var u=d,h=c[d];a.push(h),r.push(u)}}i={sort_order_by:a,sort_order_field:r}}}else e.is(n,"object")&&(i={sort_order_by:a=String(Object.values(n)),sort_order_field:r=String(Object.keys(n))});return i}},fetch:function(t){e.is(S.trackerData)&&(S.trackerData.timeData.fetchTime=(new Date).getTime()),R.log("SearchCollection fetch"),t=t||{};var i;if(this._taggerDataPromise=o.deferred(),e.is(t.no_fetch)&&!0===t.no_fetch)return R.log("no_fetch options = true ==> No fetch done"),e.is(t.onComplete,"function")&&t.onComplete.call(this),[];if(t.fetchWithOptions)return void this._parent(t.fetchWithOptions);if(!e.is(this.snservices,"string")||""===this.snservices)return R.log("Service name not defined ==> No fetch done"),e.is(t.onComplete,"function")&&t.onComplete.call(this),[];if(this.pcs_uuid=r.now().toString(),r.mark('{"module":"DS/SNResultUX/collections/SearchCollection","name":"OneSearch Query","uuid":"'+this.pcs_uuid+'","drilldown":"OneSearch Query '+this.pcs_uuid+'"}'),r.mark('{"module":"DS/SNResultUX/collections/SearchCollection","name":"fetch preparation","uuid":"'+this.pcs_uuid+'","status":"start","drilldown_serie_id":"OneSearch Query '+this.pcs_uuid+'"}'),i='{"module":"DS/SNResultUX/collections/SearchCollection","name":"fetch preparation","uuid":"'+this.pcs_uuid+'","status":"end","drilldown_serie_id":"OneSearch Query '+this.pcs_uuid+'"}',!e.is(this.search_ressources))return R.log("No search source defined. No fetch done."),r.mark(i),void(e.is(t.onComplete,"function")&&t.onComplete.call(this));let n=this,s=n._parent.bind(n);function a(e){n._getFetchOptions(e),r.mark(i),r.mark('{"module":"DS/SNResultUX/collections/SearchCollection","name":"fedsearch","uuid":"'+n.pcs_uuid+'","status":"start","drilldown_serie_id":"OneSearch Query '+n.pcs_uuid+'"}'),s(e)}z.isKeywordsActivated()?z.getLoggedInUserFromCompassPromise().then((function(){a(t)}),(function(){a(t)})):a(t)},_getFetchOptions:function(t){var i=this.service_parameters,n=!1;if(i.refine&&V.isSimplifiedTaggerFilters(i.refine.allfilters)){i=e.clone(i);var s=V.convertToRefineAndUQL(i.refine.allfilters);i.refine.allfilters=s.refine||{},s.uql&&(i.query="("+i.query+") AND ("+s.uql+")",n=!0),s=V.convertToRefineAndUQL(i.refine.localfilters),i.refine.localfilters=s.refine||{}}let o=!1;var a=[];O.isContentLocationActive()&&(!this._tagsTransformer&&this._isAHelper||this._tagsTransformer&&!0===this._tagsTransformer.isTransientWidget()||this._isPinnedWidget())?o=O.addSourceSpecificParameterToFilterData(i):a.push("ds6w:dataSource"),!this._tagsTransformer||!0!==this._tagsTransformer.isTransientWidget()||e.is(this._snSkeleton)&&e.is(this._snSkeleton.getOption("addinMode"))||!0===i.searchInCurrentTab||(i.searchInCriteria=null),!1===this._is3DSpaceSecurityContextDone&&(this._is3DSpaceSecurityContextDone=!0,this.init3DSpaceSecurityContext()),t=this.search_ressources.getFetchOptions({service_name:this.snservices,service_data:i,featureId:this.featureId,original_options:t,uqlAvailable:n,state:this.state,context_options:this._ctx_options,attributesToRetrieve:this.getAttributesToRetrieve(),source:this._getSearchSource(),select_exclude_synthesis:a,displayNamePredicates:this._getDisplayNamePredicates(),hasfilterToSourceQueryTransformed:o,isPinnedWidget:this._isPinnedWidget(),pinWdgSC:this._isPinnedWidget()&&e.is(this._snSkeleton.getSearchWidget())?this._snSkeleton.getSearchWidget().getValue("securityContext"):void 0}),this._lastFetchOptions=e.clone(t,!0),e.is(this._searchcom_socket)&&e.is(this._searchcom_socket.dispatchEvent,"function")&&e.is(this.service_parameters,"object")&&this.service_parameters.originalSearchCriteria!==S.SearchTypeEnum.ADVANCED_SEARCH&&this.service_parameters.queryType!==S.SearchTypeEnum.FAVORITE_SEARCH&&!this._isCategoryHelperCollection&&this._searchcom_socket.dispatchEvent("Last_Tag_Filter",this.service_parameters.refine),this._fedSearchLabel=this.search_ressources.getFedSearchLabel(),this._search_in_progress=!0;var r=this;this.timeoutId=setTimeout((function(){r._search_in_progress=!1,r.timeoutId=null}),15e3);var l=t.onComplete,c=t.onFailure,d=function(e){e._dosThumbnailBatchHelper.updateThumbnails(),e.dispatchEvent("on_sync",e),l.apply(this,arguments)};if(S.isFUN072117Active()){var u=d;d=r.updateModelsWithPreferredUnits(u)}t.onComplete=function(t){var i=arguments;if(e.is(t)&&e.is(t.parsed_response)&&e.is(t.parsed_response.response_infos)){L.dispatch("errorManager:maximumResults",t.parsed_response.response_infos);var n=t.parsed_response.response_infos;e.is(n.estimated)&&!0===n.estimated&&e.is(n.nhits)?m.setItem("errorManager:limit",t.parsed_response.response_infos.nhits):m.setItem("errorManager:limit",void 0)}let s=()=>{e.is(r.service_parameters)&&e.is(r.service_parameters.query)&&S.SearchTypeEnum.MY_RECENT_CONTENT===r.service_parameters.query&&(r._recentCollectionArray=r.toArray(),r._recentCollectionArrayFiltered=null,r.state.lastPage=0,r.state.totalPage=1,r.state.pageSize=r.totalCount,1e3===r.totalCount&&e.is(r._snSkeleton)&&e.is(r._snSkeleton._searchActions)&&r._snSkeleton._searchActions._displayAlert({message:A.replace(A.get("recent_too_many_results")),className:"warning"}),e.is(r._snSkeleton)&&e.is(r._snSkeleton.options)&&e.is(r._snSkeleton.options.observable,"object")&&e.is(r._snSkeleton.options.observable._originalSearchCriteria,"string")&&r.filterSearch({recent_filter:r._snSkeleton.options.observable.options.search_options.recent_filter}))};if(!h.getOption("activate_dictionary_NLS_computation"))return s(),d.apply(this,arguments);var o=0;if(e.is(r._attrDefinition)||(R.error("Undefined _attrDefinition !"),o=500),!1===r.sessionResponse_received&&!0===h.getOption("search_web_in_win")&&!0!==r._isCategoryHelperCollection)return s(),d.apply(this,arguments);setTimeout((function(){r.getModelNLS(t,d,i),s()}),o)},t.onFailure=function(){return c.apply(this,arguments)},this._addPrepareTaggerDataCallback(t),this._dosThumbnailBatchHelper.startFetch(),this._synthesisPromise=null},_ensureTaggerDataAndSetTags:function(){var e,t=this;e=function(){t._setTagsDone||t._setTags(t._helperSubjectsTags,t._helpertagValues)},t._taggerDataPromise&&t._taggerDataPromise.promise.then((function(){e()}))},_addPrepareTaggerDataCallback:function(t){var i=t.onComplete,n=this;"undefined"==typeof dscef&&n._isPinnedWidget()&&e.is(t.data)&&e.is(t.data.specific_source_parameter)&&e.is(t.data.specific_source_parameter["3dspace"])&&e.is(t.data.specific_source_parameter["3dspace"].option)&&delete t.data.specific_source_parameter["3dspace"].option.with_synthesis_ranged,t.onComplete=function(e,t,s){var o=arguments;n._ensureTaggerDataAndSetTags(),i.apply(n,o)}.bind(this)},fetchAndSetTags:function(){!0===this.options.fetchSynthesisSeparately&&(this._taggerDataPromise=o.deferred(),this._prepareTaggerData(),this._ensureTaggerDataAndSetTags())},_prepareTaggerData:function(t,i){var n,s=this;!0===this._synthesisFetchingCollection||this._isAHelper&&!0===this.options.fetchSynthesisSeparately||(n=function(){var n=s.results,o=s.parsed_response,a=s.parsed_session_response;if(n.length>0){var r=o.getTags(),l=r.tagsData,c={},d={},u=[],g=null;Object.keys(l).forEach((function(e){var t=e.split(":"),i=t[0];g=t.length>1?t[1]:void 0,u.push(i),c[i]||(c[i]=[]),Object.keys(l[e]).forEach((function(t){c[i].push({id:t,source:i,platform:g||"OnPremise"}),d[t]=l[e][t]}))}));var p=u.map((function(e){return E.getServiceFromSource(e)})),_={};f.loadServiceDelegations({services:p,platform:g||"OnPremise"}).then(function(){u.forEach((function(e,t,i){var n=c[e],s=S.getTaggerSubjectURI({subjects:n,source:e,service:p[t]});n.forEach((function(e){var t=s[e.id];t&&(_[t]=d[e.id])}))}));var t=r.summaryData;if(e.is(t)||e.is(this.service_parameters)&&e.is(this.service_parameters.query)&&this.service_parameters.query===S.SearchTypeEnum.MY_RECENT_CONTENT||R.warn('No "facets" property found in Federated Search Response !!!'),e.is(this.service_parameters)&&e.is(this.service_parameters.query)&&this.service_parameters.query===S.SearchTypeEnum.MY_CONTENT&&e.is(t)&&(t=I.handleMyContentTags(t)),h.getOption("FUN137144")||(t=this._correctCountForHierarchicalTags(t)),e.is(a)){var n=a.getTags().summaryData;if(e.is(t)&&0!==t.length){if(e.is(n)){var o=[];n.forEach((function(e){for(var i=!1,n=0;n<t.length;n++)if(t[n].sixw===e.sixw&&t[n].field===e.field&&t[n].object===e.object){t[n].count+=e.count,i=!0;break}i||o.push(e)})),o.forEach((function(e){t.push(e)}))}}else t=n}let l=s.getTaggerProxy();if(e.is(s._isAHelper))s._helperSubjectsTags=_,s._helpertagValues=t;else if(e.is(l))if(h.getOption("search_web_in_win")||(s._isFirstProxySetTagsDone=!0),e.is(i)&&e.is(i.merge)&&!0===i.merge&&!0===s._isFirstProxySetTagsDone)s._addSubjects(_),s._helperSubjectsTags=_,s._helpertagValues=t;else{if(e.is(l.latest_subjectsTags)&&e.is(l.latest_tagValues)&&(_=e.extend(l.latest_subjectsTags,_),e.is(this.service_parameters)&&e.is(this.service_parameters.refineSearch)&&!0===this.service_parameters.refineSearch)){var g=l.latest_tagValues,f=l.getCurrentFilter();t=this._mergeOldAndNewTagValues(g,t,f)}s._helperSubjectsTags=_,s._helpertagValues=t}e.is(this.latest_tagValues)?s.options.tagValues=this.latest_tagValues:s.options.tagValues=r.summaryData,s._taggerDataPromise.resolve()}.bind(s))}else{if(e.is(i)&&e.is(i.merge)&&!0===i.merge)R.log("No result found with merge");else if(R.log("No result found"),e.is(s.options.tagger_proxy)){var m=t?t.subjectsTags:[],v=t?t.tagValues:[];s._helperSubjectsTags=m,s._helpertagValues=v,s._setTags(s._helperSubjectsTags,s._helpertagValues)}s._taggerDataPromise.resolve(),s._setTagsPromise&&s._setTagsPromise.resolve()}},!0!==s.options.fetchSynthesisSeparately||!1!==s.service_parameters.with_synthesis||s._synthesisPromise||(s._synthesisPromise=new o((function(t,i){s.service_parameters.with_synthesis=!0;var n=e.clone(s._lastFetchOptions),o=e.is(n.data,"string")?JSON.parse(n.data):n.data;if(o&&"0"==o.start){var a=s.getTaggerProxy();a&&s._isFirstProxySetTagsDone&&a.unsetTags();var r=new Z(null,{event:{onSetup:function(t){t._synthesisFetchingCollection=!0,t.setSearchRessources(s.getSearchRessources());var i=e.clone(s.getRequestCriteria(),!0);i.service_params.with_synthesis=!0,t.setRequestCriteria(i.service_name,i.service_params),t.setSearchSource(s._getSearchSource())}}});o.label=o.label+"-synthesis",o.with_synthesis=!0,n.data=JSON.stringify(o),n.onComplete=function(e){s.results=e.results,s.parsed_response=e.parsed_response,s.parsed_session_response=e.parsed_session_response,t()},r.fetch({fetchWithOptions:n})}}))),s._synthesisPromise?s._synthesisPromise.then(n):n())},getModelNLS:function(t,i,n){for(var s=/\w+:\w+\.\w+/,o=t._models,a={},r="",l=0,c=o.length;l<c;l++)for(var d=o[l],u=d.pairs(),h=d.getServiceID(),g=0,p=u.length;g<p;g++){let t=u[g][0];if(!e.is(a[t])&&(a[t]=[]),r=u[g][1],e.is(r,"array")&&r.length>0){u[g][1]=u[g][1].slice();for(var _=0,f=r.length;_<f;_++){var m=r[_];if(e.is(m,"array")&&m.length>0)for(var S=0,v=m.length;S<v;S++){var w={value:m[S],source:[h]};a[t].push(w)}else s.test(u[g][1][_])&&(u[g][1][_]=u[g][1][_].slice(u[g][1][_].lastIndexOf(".")+1)),a[t].push({value:u[g][1][_],source:[h]})}}else if(e.is(r,"string")){let e=t;e.endsWith("_value")&&(e=e.slice(0,-6)),s.test(u[g][1])&&u[g][1].startsWith(e)&&(u[g][1]=u[g][1].slice(u[g][1].lastIndexOf(".")+1)),a[t].push({value:u[g][1],source:[h]})}}for(var b={},C=Object.getOwnPropertyNames(a),y={"ds6w:label":!0,"ds6w:identifier":!0,"ds6w:description":!0,preview_url:!0,resourceid:!0,sourceid:!0,type_icon_url:!0,resourceid_tagger:!0,taxonomies:!0},D=0,I=C.length;D<I;D++){var T=C[D];if(e.is(a[C[D]+"_value"])&&!e.is(y[T])&&e.is(this._attrDefinition[C[D]])&&"date"!==this._attrDefinition[C[D]].type){let e=a[C[D]+"_value"];e=e.map((e=>JSON.stringify(e))).filter((function(e,t,i){return t===i.indexOf(e)})),e=e.map((e=>JSON.parse(e))),b[T]=e}}this.getNlsOfPropertiesValuesSearch(t,i,n,b)},getFirstPageOfResults:function(e){var t=this;let i=this.getActiveTenant();t._isFirstProxySetTagsDone=!1,m.getItemPromise("optionMode",i).then((function(i){t._optionMode=i,E.login({resources:t.getSearchRessources(),onComplete:function(){t._dosThumbnailBatchHelper.isReady().then((function(){t.getFirstPage(e)}))},onFailure:function(){t.getFirstPage(e)}})}))},getFirstPage:function(t){if(e.is(this.service_parameters)&&e.is(this.service_parameters.query)&&S.SearchTypeEnum.MY_RECENT_CONTENT!==this.service_parameters.query&&e.is(this._recentCollectionArray)&&(this._recentCollectionArray=null,this._recentCollectionArrayFiltered=null),this.initTreeDocument(),e.is(t)&&e.is(t.fetchAll)){var i={fetchAll:t.fetchAll};this._resetState(i)}else this._resetState();if(h.getOption("search_web_in_win")){this.sessionResponse=null,this.sessionResponse_received=!1;var n=e.is(h.getOption("tabbed_ui_support_level"));this._searchcom_socket.dispatchEvent("onDispatchToWin",{notif_name:"sessionSearch",notif_parameters:n?JSON.stringify({tabID:this._snSkeleton.getOption("observable").getTabID(),searchParams:this.service_parameters}):this.service_parameters},"search_web_in_win")}return this._setTagsPromise=o.deferred(),this._parent(t)},parseResponseForStateUpdate:function(t,i,n){var s={};return"fed_search"===this.snservices?(e.is(t.infos)&&e.is(t.infos.nhits)&&(s.totalRecords=parseInt(t.infos.nhits)),s.totalPages=Math.ceil(s.totalRecords/n.pageSize),s.lastPage=s.totalPages-1):"getSavedSearches"===this.snservices&&(s.totalRecords=parseInt(t.searches.length),s.totalPages=1,s.lastPage=0),this._search_in_progress=!1,s},parseRecords:function(t,i){this.fakeFedSearchResponse&&this.fakeFedSearchResponse.infos&&this.fakeFedSearchResponse.results&&this.fakeFedSearchResponse.facets&&(t=this.fakeFedSearchResponse),R.groupCollapsed("SearchCollection.parseRecords"),R.log("resp:",t),R.log("options:",i),(h.getOption("ODTLogs")||h.getOption("ODTLogs-FederatedSearchAnswer"))&&console.warn("ODTLogs-FederatedSearchAnswer:"+JSON.stringify(t));var n=null,s=this.getActiveTenant();if(e.is(s)&&e.is(t)&&e.is(t.infos)&&e.is(t.infos.sources)){E.updateServiceToSourceMapping(s,t.infos.sources);let i={},n={};t.infos.sources.forEach((function(t,s){t.status&&(i[`pd${s+1}`]=t.name,e.is(t.error)&&(i[`pd${s+1}${s+1}`]=t.error.errorCode),n[`pv${s+1}`]=parseFloat(t.time))})),U.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"IndexTime",action:"Search",persDim:i,persVal:n}})}if(h.getOption("search_web_in_win")){let e=h.getOption("GuidedMode",{tenant:S.getActiveTenant()});this.sessionResponse_received||e&&h.getOption("GuidedSearch")&&"myContentDropdown"!=this.id?(R.log("session_response is received, so parse the results together"),n=this.parseRecords2(t,i),this._fedsearchResp=null,this.sessionResponse=null):!0===this._isCategoryHelperCollection||!0===this._isTagSearchCollection||!0===this._synthesisFetchingCollection?n=this.parseRecords2(t,i):(R.log("session_response is not yet received, so we will wait for session to respond and then parse the results together"),this._fedsearchResp=t)}else n=this.parseRecords2(t,i);this._fedsearchOptions=i;var o="";if(e.is(this._parse_alert,"array")&&this._parse_alert.length>0)for(var a=0;a<this._parse_alert.length;a++)e.is(this._parse_alert[a].messageObj)&&e.is(this._parse_alert[a].messageObj.nlsErrorCode)&&(o+="<li>"+this._parse_alert[a].messageObj.nlsErrorCode+"</li>");var r="";return 0===(e.is(n)?n.length:-1)&&(r=A.replace(S.constructEmptyViewMsg(A.get("no_result")),{errorMessage:o})),e.is(this._snSkeleton)&&e.is(this._snSkeleton._searchActions)&&e.is(this._snSkeleton._searchActions.setEmptyViewMessage,"function")&&this._snSkeleton._searchActions.setEmptyViewMessage(r),R.groupEnd(),n},parseRecords2:function(t,i){if(this.fakeFedSearchResponse&&this.fakeFedSearchResponse.infos&&this.fakeFedSearchResponse.results&&this.fakeFedSearchResponse.facets&&(t=this.fakeFedSearchResponse),R.groupCollapsed("SearchCollection.parseRecords2"),R.log("resp:",t),R.log("options:",i),e.is(i)&&e.is(i.from)&&R.log("Parsing records for Page Number :"+(i.from+1)),r.mark('{"module":"DS/SNResultUX/collections/SearchCollection","name":"fedsearch","uuid":"'+this.pcs_uuid+'","status":"end","drilldown_serie_id":"OneSearch Query '+this.pcs_uuid+'"}'),r.mark('{"module":"DS/SNResultUX/collections/SearchCollection","name":"parseRecords","uuid":"'+this.pcs_uuid+'","status":"start","drilldown_serie_id":"OneSearch Query '+this.pcs_uuid+'"}'),e.is(t.results))for(var n=0;n<t.results.length;n++)"undefined"==typeof dscef&&this._isPinnedWidget()?t.results[n].attributes.forEach((function(e,t,i){"real"===e.type&&i.splice(t,1)})):t.results[n].attributes.forEach((function(e,t,i){"real"===e.type&&e.value&&delete i[t]}));this.setFailureView(!1);var o=null;if(this._parse_alert=[],"fed_search"===this.snservices||"fed_search_odt"===this.snservices){var a=!1;e.is(i.url,"string")&&i.url.indexOf("/recent")>0&&(a=!0);var l=this.getActiveTenant(),c=null,d={federated_response:t,isRecentSearch:a,tenant:l,optionMode:this._optionMode};if(c=new g(d),this._parse_alert=c.getUserLevelAlerts(this),this.state.next_start=c.response_infos?c.response_infos.next_start:null,this.totalCount=c.getMatches(),this.hits=c.getHits(),this._attrDefinition=c.getAttributesDefinition(),this.facetsTags=c.getTags(),this._parse_alert.length>0&&(0===this.totalCount&&this.setFailureView(!0),!this._isAHelper)){var u={service:this.snservices,messages:this._parse_alert};this.dispatchEvent("failure_on_parse",u)}o=c.getResults(),this.proxifyUrlForSwym(o),this._dosThumbnailBatchHelper.batchUpdateDosThumbnailURLs(o),this._retrieveLastIndexingDate(c);var p=null;if(h.getOption("search_web_in_win")&&e.is(this.sessionResponse)){var _={federated_response:this.sessionResponse,tenant:l,optionMode:this._optionMode};p=new g(_);var f=0,m=p.getResults();!0===S.isODTMode()?m.forEach((function(e){++f,e.session_object=!0,o.unshift(e)})):e.is(m)&&e.is(o)&&(R.log("Parsing search_web_in_win sessionResults :",m),Array.prototype.pushUniqueSession=function(e){for(let t=0;t<e.length;t++){let i=e[t],n=i.resourceid,s=this.length,o=!0;for(let e=0;e<s;e++)if(n===this[e].resourceid){o=!1;break}!0===o&&(++f,i.session_object=!0,this.unshift(i),R.log("Parsing search_web_in_win session_result !====",f))}},o.pushUniqueSession(m)),this.totalCount+=f}this.parsed_response=c,this.parsed_session_response=p,this.results=o,this._prepareTaggerData(t,i),o.length>0||s.dispatchEvent(document,"no_result_found")}else"getSavedSearches"===this.snservices&&(this.totalCount=t.searches.length,o=t.searches);return e.is(this.service_parameters)&&e.is(this.service_parameters.query)&&S.SearchTypeEnum.MY_RECENT_CONTENT!==this.service_parameters.query&&this.dispatchEvent("response_treated",{data:o,rawData:!0}),r.mark('{"module":"DS/SNResultUX/collections/SearchCollection","name":"parseRecords","uuid":"'+this.pcs_uuid+'","status":"end","drilldown_serie_id":"OneSearch Query '+this.pcs_uuid+'"}'),R.groupEnd(),o},_resetState:function(t){this.totalCount=-1,this.hits=0;var i=0;if(e.is(t)&&e.is(t.fetchAll)&&!0===e.is(t.fetchAll))i=h.getOption("max_selection_for_selectall",{tenant:this.getActiveTenant()});else{let e=h.getOption("results_perpage");i=e<40?40:e}e.is(i)&&"number"!==e.typeOf(i)&&(i=parseInt(i)),this.state={firstPage:0,lastPage:null,currentPage:0,pageSize:i,totalPages:null,totalRecords:null,sortKey:null,order:-1,tagsSet:0},this._attrDefinition=null,this.facetsTags=null,this._setTagsPromise=null,this._setTagsDone=!1,this._interruptRequested=!1},getFailureView:function(){return this._failureView},setFailureView:function(e){this._failureView=e},setSearchRessources:function(e){R.log("SearchCollection.setSearchRessources",e),this.search_ressources=e},getSearchRessources:function(){return this.search_ressources},getActiveTenant:function(){var t=null;return e.is(this.getSearchRessources())?e.is(this.getSearchRessources().getActiveTenant,"function")?t=this.getSearchRessources().getActiveTenant():R.warn("SearchCollection.getActiveTenant getActiveTenant function on SearchRessources!"):R.warn("SearchCollection.getActiveTenant No SearchRessources!"),e.is(t)||R.warn("No active tenant!"),t},cleanScriptSyntax:function(e){return-1!==e.replace(/ /g,"").indexOf("<script")?e.replace(/</g,"&lt;").replace(/>/g,"&gt;"):e},setRequestCriteria:function(t,i,n){if(this.snservices=t,e.is(i)&&e.is(i.query,"string")){i.query===S.SearchTypeEnum.FAVORITE_SEARCH&&(i.originalSearchCriteria=A.get("my_fav_searches"),i.savedSearch=!0,i.search_name=A.get("my_fav_searches"),i.queryType=S.SearchTypeEnum.FAVORITE_SEARCH),this.service_parameters=i,!0===this.options.fetchSynthesisSeparately&&(this.service_parameters.with_synthesis=!1);var s=this.getPQSortOrder(this.service_parameters.query);e.is(s,"object")&&this.setGlobalOrder(s.sort_order_field,s.sort_order_by),e.is(n)&&!1!==n?this._isInContextMode=!0:this._isInContextMode=!1,this.setIsAPQSearch(this.service_parameters.query),this.service_parameters.query=this.cleanScriptSyntax(this.service_parameters.query)}this._attrToRetrieve=[]},getRequestCriteria:function(){return{service_name:this.snservices,service_params:this.service_parameters}},setTaggerProxy:function(e){this.options.tagger_proxy=e},getTaggerProxy:function(){return this.options.tagger_proxy},setGlobalOrder:function(e,t,i="",n=""){this.service_parameters.order_by=t,this.service_parameters.order_field=e,this.service_parameters.order_type=i,this.service_parameters.order_index=n},setSessionResponse:function(t){if(R.log("SearchCollection setSessionResponse"),this.sessionResponse=t,this.sessionResponse_received=!0,this._search_in_progress)R.log("Fed search has NOT yet answered, so we will parse the session response when fed search response is received");else{R.log("Fed search has already answered, so we will parse the fed search response now together with session response");var i=null;if(this._fedsearchResp&&(i=this.parseRecords2(this._fedsearchResp,this._fedsearchOptions)),e.is(i)){R.log("consolidatedParseRecords = "+i.length);var n=this;i.forEach((function(e){n.unshift(e)})),this.dispatchEvent("onSync",this,this._fedsearchResp,this._fedsearchOptions),this.dispatchEvent("on_sync",this,this._fedsearchResp,this._fedsearchOptions)}this._fedsearchResp=null,this.sessionResponse=null}},hasNextPage:function(){return(!e.is(this.service_parameters)||S.SearchTypeEnum.MY_RECENT_CONTENT!==this.service_parameters.query)&&this._parent()},setPageSize:function(e){this.state.pageSize=e},setAttributesToRetrieve:function(e){this._attrToRetrieve=e},_parseAndFlatCustoPredicates:function(t){let i=[].concat(t.general);return e.is(t.predefinedQuery,"array")&&i.concat(t.predefinedQuery.map((e=>{i=i.concat(e.viewDefinition)}))),e.is(t.type,"array")&&t.type.map((e=>{i=i.concat(e.viewDefinition)})),i},getAttributesToRetrieve:function(t){var i=0,n=0;if(e.is(this._attrToRetrieve)&&0===this._attrToRetrieve.length||e.is(t)&&t.length>0){this._attrToRetrieve=[];var s=[];if(e.is(t)&&t.length>0)s=t;else if(e.is(this.service_parameters)){var o={isPQ:!!this.service_parameters.isAPQSearch,typeName:this.getPQ()},a=this.getActiveTenant();if(D.isBETAEnabled()&&!0!==this.grouping6W){y.setGeneralContext(this),D.loadCustomizationTenantSettings();var r=D.getCustomizationIdToUse(o,a)}else r=C.getColumnCustomizationIdToUse(o,a);if(D.isBETAEnabled()&&!0!==this.grouping6W){var l=m.getItem("3dSearchResultsActiveCustomization");e.is(l)&&e.is(l.views)&&("all views"===l.customizedViews?s=l.views[D.getViewModeForCustomization()]:e.is(l.views)&&e.is(l.customizedViews)&&(s=l.views[l.customizedViews]))}else r.length>0&&(s=D.isBETAEnabled()&&!0!==this.grouping6W?D.getCustomizationDefinitionFromCustoId(r,a):C.getColumnCustomizationDefinitionFromCustoId(r,a))}if(e.is(s))for(s.general&&s.predefinedQuery&&s.type&&(s=this._parseAndFlatCustoPredicates(s)),i=0,n=s.length;i<n;i++)e.is(s[i],"object")&&this._attrToRetrieve.push(s[i].dataIndex.slice(s[i].dataIndex.lastIndexOf("/")+1,s[i].dataIndex.length))}var c=[];if(!e.is(t))if(D.isBETAEnabled()&&!0!==this.grouping6W){l=m.getItem("3dSearchResultsActiveCustomization");if(e.is(l)&&e.is(l.views)&&("all views"===l.customizedViews?s=l.views[D.getViewModeForCustomization()]:e.is(l.views)&&e.is(l.customizedViews)&&(s=l.views[l.customizedViews]),e.is(s)))for(s.general&&s.predefinedQuery&&s.type&&(s=this._parseAndFlatCustoPredicates(s)),i=0,n=s.length;i<n;i++){var d=s[i];c.push(d.dataIndex)}}else{var u,h=m.getItem("DataGridColumnCusto"),g=[];if(e.is(h)&&e.is(h.activeView)){var p=h.activeView;e.is(h.views)&&(g=h.views);for(var _=g.length-1;_>=0;_--){var f=g[_];f.viewId===p&&(u=f.viewDefinition)}if(e.is(u))for(i=0,n=u.length;i<n;i++){d=u[i];c.push(d.dataIndex)}}}let S=[];e.is(this._attrToRetrieve,"array")&&(S=S.concat(this._attrToRetrieve));let v=this._getRequiredPredicates();return e.is(v,"array")&&(S=S.concat(v)),e.is(c,"array")&&(S=S.concat(c)),S.filter((function(e,t,i){return t===i.indexOf(e)}))},setSearchSource:function(e){this._source=e},_getSearchSource:function(){return this._source},setSNSkeleton:function(e){this._snSkeleton=e},getSNSkeleton:function(){return this._snSkeleton},getPQ:function(){if(!e.is(this.service_parameters)||!e.is(this.service_parameters.isAPQSearch)||!1===this.service_parameters.isAPQSearch)return null;var t,i,n,s=this.service_parameters.query,o=/3dexp((\w+):[^ $)]+)/g,a=o.exec(s);if(a){var r=a[1];for(t=b.getPQPrefix(b.isAPQSearch(r)),i=b.getPQName(t);a=o.exec(s);){r=a[1];var l=b.getPQPrefix(b.isAPQSearch(r));if(b.getPQName(l)!==i)return null}}if(e.is(i,"string")&&i.length>0){n=i;var c=b.getPQObjFromPQPrefix(t),d=b.getPQNLS();e.is(d,"object")&&e.is(c,"object")&&e.is(c.pqid,"string")&&c.pqid.length>0&&e.is(d[c.pqid+".Title"],"string")&&d[c.pqid+".Title"].length>0&&(n=d[c.pqid+".Title"])}return{pqName:i,pqUsed:t,pqNLS:n}},getIndexingDate:function(){return this._indexingDate},checkPQExpressionsForWildCardChars:function(){for(var e,t=this.service_parameters.query,i=/[\s\b]*\w+[\s]*:/g;null!==(e=i.exec(t));){var n=e[0].match(/\w+/g);if(null!==n){var s=n[0];if(0===s.indexOf("3dexp"))if(s=s.substring(5,s.length),b.isAPQAbbrevation([s]))if(t.substring(i.lastIndex).trim().match(/^(#all|(\*)+)($|\s)/))return!0}}return!1},filterSearch:function(t){if(!e.is(t))throw new Error("Bad options given to SearchCollection.filterSearch !");if(e.is(this._recentCollectionArray)){var i=this._recentCollectionArray.length,n=t.recent_filter;if(e.is(n)&&n!==S.SearchTypeEnum.MY_CONTENT&&n!==S.SearchTypeEnum.ADVANCED_SEARCH||(n=""),this.service_parameters.recent_filter=n,this.dispatchEvent("update_title",{originalSearchCriteria:n}),0>=this._recentCollectionArray.length)this.dispatchEvent("showAllMyRecent",{isVisible:!1});else{(n=(n=n.replace(/\*/g,"")).toLowerCase()).indexOf("flattenedtaxonomies:types/catmatreference")>=0&&(n="_matref_");if(this._recentCollectionArrayFiltered=null,n.length>0){var s=this._recentCollectionArray.filter((function(t){for(var i=t.values(),s=!1,o=0,a=i.length;o<a&&!s;o++)e.is(i[o],"string")&&i[o].toLowerCase().indexOf(n)>=0&&(s=!0);return s}));if(i=s.length,0===s.length&&this._recentCollectionArray.length>0){var o=A.replace(A.get("recent_no_filtered_result"),{nbResult:""+this._recentCollectionArray.length,filterCriteria:t.recent_filter});e.is(this._snSkeleton)&&e.is(this._snSkeleton._searchActions)&&e.is(this._snSkeleton._searchActions.setEmptyViewMessage,"function")&&this._snSkeleton._searchActions.setEmptyViewMessage(o)}this.reset(s),this._recentCollectionArrayFiltered=s}else this.initTreeDocument(),this.reset(this._recentCollectionArray),n="*";this.state.totalRecords=i,this.state.pageSize=i,this.totalCount=i,i!==this._recentCollectionArray.length?this.dispatchEvent("showAllMyRecent",{isVisible:!0}):this.dispatchEvent("showAllMyRecent",{isVisible:!1}),this.dispatchEvent("onSync",this,this._fedsearchResp,this._fedsearchOptions),this.dispatchEvent("on_sync",this,this._fedsearchResp,this._fedsearchOptions),this.dispatchEvent("response_treated",{data:this._recentCollectionArray,rawData:!1}),this.service_parameters.query===S.SearchTypeEnum.MY_RECENT_CONTENT&&e.is(this._ctx_options)&&i>0&&I._displayAlert({message:A.get("IncontextRecentWarning"),className:"warning"})}}},sortCollection:function(t){if(S.SearchTypeEnum.MY_RECENT_CONTENT!==this.service_parameters.query)throw new Error("SearchCollection.sortCollection must not be called if not in my recent content context !");if(!e.is(t.order_field)||!e.is(t.order_by))throw new Error("Bad options given to SearchCollection.sortCollection !");if(!e.is(this._recentCollectionArray))throw new Error("No _recentCollectionArray in SearchCollection.sortCollection !");var i=t.order_field,n="asc"===t.order_by?1:-1,s=this._recentCollectionArray.comparator;let o=null===this._recentCollectionArrayFiltered?this._recentCollectionArray:this._recentCollectionArrayFiltered;o.comparator=function(e,t){var s=0;return e.get(i)<t.get(i)?s=-1*n:e.get(i)>t.get(i)&&(s=n),s},o.sort(),this.reset(o),this.dispatchEvent("onSync",this,this._fedsearchResp,this._fedsearchOptions),this.dispatchEvent("on_sync",this,this._fedsearchResp,this._fedsearchOptions),this._recentCollectionArray.comparator=s},getFedSearchLabel:function(){return this._fedSearchLabel},initTreeDocument:function(){return e.is(this._treeDocument)&&e.is(this._treeDocument.destroy,"function")&&(this._treeDocument.empty(),this._treeDocument.destroy(),this._treeDocument=null),this._treeDocument=new c({useAsyncPreExpand:!0,shouldAcceptDrag:function(){return!0},shouldAcceptDrop:function(){return!1}}),this.setFailureView(!1),e.is(this.service_parameters)&&S.SearchTypeEnum.MY_RECENT_CONTENT!==this.service_parameters.query&&(this._treeDocument._getTrueRoot().sortChildren=function(){}),this.dispatchEvent("onInitTreeDocument",this._treeDocument),this._treeDocument},getTreeDocument:function(){return this._treeDocument||this.initTreeDocument()},generateTreeModel:function(e,t){this.grouping6W=!1;let i=this;setTimeout((function(){{function a(e){for(var t=e.concat(),i=0;i<t.length;++i)for(var n=i+1;n<t.length;++n)t[i]===t[n]&&t.splice(n--,1);return t}var n=x.getAllSelectClause(true),s=a(i._required_predicates.concat(n)),o=i.getNotLoadedPredicate(s);o.length>0&&v.getResourcesInfo(o.join(","),{tenantId:i.search_ressources.active_tenant,lang:S.getLanguage(),apiVersion:"R2019x",onComplete:function(e){e&&i.saveNLS_ds6wg(e),i.asyncUpdateModels_predicate()},onFailure:function(e){e&&i.saveNLS_ds6wg(e),i.asyncUpdateModels_predicate()}})}i._asyncUpdateModels(),i.generateTreeModelAsync().then((function(){i.dispatchEvent("onInitTreeDocument_SelectFirstElt",i._treeDocument),!0===e&&i.dispatchEvent("onInitTreeDocumentAsyncCB"),t&&t.call(this)}))}),50)},getNotLoadedPredicate:function(t){let i=this,n=[],s=i.getSearchRessources();return e.is(s)&&e.is(i._NLS_ds6wg)?t.forEach((function(e){i._NLS_ds6wg[s.active_tenant+"/"+e]||n.push(e)})):(R.warn("SearchCollection.getNotLoadedPredicate, no SearchRessources"),n=t),n},saveNLS_ds6wg:function(e){var t=this,i=t.getSearchRessources();e.forEach((function(e){t._NLS_ds6wg[i.active_tenant+"/"+e.curi]=e}))},asyncUpdateModels_predicate:function(){var t=this.getTreeDocument(),i=t.getRoots(),n=this,s={},o=0,a=h.getOption("snippet_unsupported_sources");t.prepareUpdate(),i.forEach((function(t){if(e.is(t)&&!e.is(t.nlsAlreadyComputed)){var i=n.getCollectiveViewOptions(t.options,s,n._isResponsive,o,a);t.updateOptions(i),t.nlsAlreadyComputed=!0}o++})),t.pushUpdate()},_treatCommunityTags:function(e){if("string"==typeof e)return(h.getOption("tagSeparatorsToTreat")||[]).forEach(((t,i)=>{var n=new RegExp(t.re,"gi");e=e.replace(n,t.replacement)})),e=e.split("ds6wclassifier:")[0]},_transformAttribute:function(t,i,n){let s=i.viewSpec,o=i.modelToAdd,a=i.isResponsive,r=i.iNode,l=i.odtSelectorData,c=n?s[t][n]:s[t],d="",u="",h="",g=(new Date).getTime();let p=this.getSearchRessources(),_=this;return"subLabel"!==t&&"subLabels"!==t||null===_._tagsTransformer||_._tagsTransformer.displaySourceInSearchView(c,o,_._NLS_ds6wg),c.forEach((function(i){if(u="",h="",void 0!==o.grid[i]&&o.withoutHtmlTag[i]){var n=i;if(N.getNLSValueForPredicate(i)===i?_._NLS_ds6wg[p.active_tenant+"/"+i]&&(n=_._NLS_ds6wg[p.active_tenant+"/"+i].label):n=N.getNLSValueForPredicate(i),"label"===t){let t="search_item_hyperlink",n=_._ctx_options,d=e.is(n),h=B.isAdvSearchRun(n);var s=_._snSkeleton?_._snSkeleton.getOption("addinMode"):void 0,c=e.is(s,"string")&&s.length>0;d&&!h&&!c&&(t="search_item_in_apps"),a?u="ds6w:label"===i||"dcterms:title"===i?_._templateSearchItemSpan(r,i,o.withoutHtmlTag[i],o.grid[i],t,l):_._templateSearchItemSpan(r,i,o.withoutHtmlTag[i],o.grid[i],"onlyDisplayInLargeTileView",l):"ds6w:label"===i&&(u=_._templateSearchItemSpan(r,i,o.withoutHtmlTag[i],o.grid[i],void 0,l))}else{let t="searchItemSpan_hyperlink",a=S.getServiceUrl("swym",S.getActiveTenant()),d=_._ctx_options,p=e.is(d),b=B.isAdvSearchRun(d);s=_._snSkeleton?_._snSkeleton.getOption("addinMode"):void 0,c=e.is(s,"string")&&s.length>0;!p||b||c||(t="search_item_in_apps");let C="";if(e.is(o.grid["ds6w:dataSource"],"string")&&o.grid["ds6w:dataSource"].includes("ds6w:dataSource.3DSwymConv")&&(C="3DSwymConv"),e.is(_._fromDropDown)&&!0===_._fromDropDown?t=void 0:a&&"3DSwymConv"!==C?"ds6w:community"===i||"ds6w:responsible"===i&&e.is(o.grid["ds6w:responsibleUid"])||"ds6w:dataSource"===i&&"3DDrive"===o.grid[i]?u=_._templateSearchItemSpan(r,i,o.withoutHtmlTag[i],o.grid[i],t,l):t=void 0:"ds6w:dataSource"===i&&"3DDrive"===o.grid[i]?u=_._templateSearchItemSpan(r,i,o.withoutHtmlTag[i],o.grid[i],t,l):t=void 0,"ds6wg:revision"!==i&&"ds6w:status"!==i&&"ds6w:community"!==i||(h='<span class="labelOnAttributeString">'+n+":</span>"),"ds6w:modified"===i){var f=o.withoutHtmlTag[i].replace(",","").split(" ");let t=i+"_value";var m=o.withoutHtmlTag[t],v=new Date(m).getTime();e.is(f,"array")&&0<f.length&&g-v<=864e5?(m=f.join(" "),f.length>3?m=f[f.length-1]:(f.splice(0,1),m=f.join(" "))):f.length>3?(f.pop(),m=f.join(" ")):m=f[0],u=_._templateSearchItemSpan(r,i,o.withoutHtmlTag[i],m,void 0,l)}else{var w=o.getSourceID?o.getSourceID():o.sourceID;u="ds6w:identifier"===i&&o.grid["ds6w:snippet"]&&["drive","3dspace"].indexOf(w)>-1?_._templateSearchItemSpan(r,i,o.withoutHtmlTag["ds6w:snippet"],o.grid["ds6w:snippet"],void 0,l):_._templateSearchItemSpan(r,i,o.withoutHtmlTag[i],o.grid[i],t,l)}}d.length>0&&(d+=d.length>0?" | ":""),u.length>0&&(d+=h+u)}})),c.indexOf("ds6w:identifier")<0&&"label"===t&&(d+=_._templateSearchItemSpan(r,"ds6w:identifier",o.withoutHtmlTag["ds6w:identifier"],void 0,"onlyDisplayInLargeTileView",l)),0===d.length&&c.length>0&&e.is(o)&&(e.is(o.isAShowOnlyObject,"function")&&o.isAShowOnlyObject()||void 0!==o.grid.showonly&&"true"===o.grid.showonly)&&(d=A.get("no_access")),d},_findSnippetAttribute:function(t,i){const n=/:snippet_value$/,s=new RegExp(S.INNER_CONCAT_KEY,"i");for(let o in t)if(!e.is(t[o],"array")&&(n.test(o)||"swym:message_text:snippet_value"===o))if(s.test(t[o])){let e=t[o].split(S.INNER_CONCAT_KEY);for(let t in e){let n=JSON.parse(e[t]);for(let e in n.text)if("true"==n.text[e].highlighted){i.push(o.replace("_value",""));break}}}else{let e=JSON.parse(t[o]);for(let t in e.text)if("true"==e.text[t].highlighted){i.push(o.replace("_value",""));break}}},getCollectiveViewOptions:function(t,i,n,s,o){let a=null;!0===S.isODTMode()&&(a={}),n=n||this._isResponsive;var r=t.getServiceID&&t.getServiceID()||t.serviceID||"",l=t.getSourceID?t.getSourceID():t.sourceID,c=t.getType?t.getType():t.type,d=this.getSearchRessources();t.collection.service_parameters.originalSearchCriteria;var u=this;!i[r]&&(i[r]=x.getViewSpecs(r,["label","subLabel","description","specific"]));var g=e.clone(i[r]);e.is(this._searchViewSpec.SearchView[r])&&e.is(this._searchViewSpec.SearchView[r].type)&&e.is(this._searchViewSpec.SearchView[r].type[c])&&(g.subLabel=this._searchViewSpec.SearchView[r].type[c]);let p=!1;if(D.isBETAEnabled()&&!0!==this.grouping6W){this.setIsAPQSearch(this.service_parameters.query);var _=D.buildSubLabs(t,h.getOption("search_web_in_win")?this.service_parameters.originalSearchCriteria:this.service_parameters.search_criteria_to_display,this.service_parameters.isAPQSearch,this._snSkeleton&&this._snSkeleton.getSearchWidget()?this._snSkeleton.getSearchWidget().getValue("resultview_custo"):void 0);for(const e in _.subLabs)0==_.subLabs[e].length&&(_.subLabs[e]=g.subLabel);g.subLabel=_.subLabs[_.currentViewMode],g.subLabels=_.subLabs,p=!0}if(!0===S.isSnippetAvailable(this.getActiveTenant())&&(e.is(o,"array")&&-1===o.indexOf(l)||!e.is(o))){var f="";e.is(t.grid["swym:message_text:snippet"])?f="swym:message_text:snippet":e.is(t.grid["ds6w:snippet"])&&(f="ds6w:snippet"),f.length>0&&t.grid[f].trim().length>0&&(g.description=[f])}var m=[],v="",w=[];for(var b in g)!0===p&&"subLabel"!==b||(w=w.concat(g[b]));var C=h.getOption("webUXTooltip");e.is(t.grid["ds6w:identifier"])&&-1===w.findIndex((e=>"ds6w:identifier"===e))&&w.push("ds6w:identifier"),this._findSnippetAttribute(t.grid,w),w=[...new Set(w)];const y=/:snippet$/;let I=!1;if(w.forEach((function(i){let n=i,s=!1;if(y.test(n))if(I=!0,s=!0,"ds6w:snippet"===i)n="";else{let e=i.replace(":snippet","");e===N.getNLSValueForPredicate(e)?u._NLS_ds6wg[d.active_tenant+"/"+e]&&(n=u._NLS_ds6wg[d.active_tenant+"/"+e].label):n=N.getNLSValueForPredicate(e)}else i===N.getNLSValueForPredicate(i)?e.is(F.getPredicatesLoadedNlsCACHE()[i])?n=F.getPredicatesLoadedNlsCACHE()[i]:u._NLS_ds6wg[d.active_tenant+"/"+i]&&(n=u._NLS_ds6wg[d.active_tenant+"/"+i].label):n=N.getNLSValueForPredicate(i);let o,r=e.is(t.withoutHtmlTag[i])?t.withoutHtmlTag[i]:"";if(r){if(e.is(a,"object")&&(a[i]=e.is(t.withoutHtmlTag[i+"_value"])?t.withoutHtmlTag[i+"_value"]:"",a[i+"-nls"]=r),v.length>0&&(v+=C?"<br>":"&#10;"),"ds6w:label:snippet"==i&&e.is(t.grid[i])&&(o=t.grid[i]),"ds6w:snippet"==i||"swym:message_text:snippet"==i){let n=e.is(t.withoutHtmlTag[i+"_value"])?t.grid[i+"_value"]:t.grid[i],s=n.split(S.INNER_CONCAT_KEY);for(let e in s){try{let t=JSON.parse(s[e]);for(let e in t.text)if("true"==t.text[e].highlighted){o=t.value;break}}catch(e){o=n}if(null!=o)break}if(void 0===o)return}if(void 0===o&&(o=e.is(t.withoutHtmlTag[i])?t.withoutHtmlTag[i]:""),"ds6w:label:snippet"==i&&(o=u._treatCommunityTags(o)),o.length>200&&(o=o.substring(0,200)+"..."),"swym:message_text:snippet"===i){let e=o;if(e.length>2&&"["===e.charAt(0)){let t=e.indexOf("]");if(t>0){let i=e.slice(0,t+1);e=e.replace(i,""),o=e}}}v+=n+": "+o,m.push({predicate:i,predicateNLS:n,predicateValue:i.split("ds6w:")[1],value:o.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">"),isSearchHit:s,bForceAvoid:"ds6w:responsible"===i&&!e.is(t.grid["ds6w:responsibleUid"])}),v=(v=v.replace(//g,"")).replace(//g,"")}})),!I&&m.push({predicateValue:A.get("search_hit_no_available_data"),value:A.get("search_hit_no_available_data"),isSearchHit:!0}),t.grid.toolTip=v,e.is(a)&&t.grid["ds6w:type"]){let e=u._generateAttributesFromODTSelector(a);t.grid["ds6w:type"]=t.grid["ds6w:type"].replace("ODTSELECTOR",e)}let T={viewSpec:g,modelToAdd:t,isResponsive:n,iNode:s,odtSelectorData:a};var E={label:this._transformAttribute("label",T),subLabel:this._transformAttribute("subLabel",T),icons:[t.grid.type_icon_url],description:this._transformAttribute("description",T),contextualMenu:"active ctx menu",serviceID:r,sourceID:l,type:c,useAsyncPreExpand:!0,customTooltip:new k({allowUnsafeHTMLTitle:!0,title:t.grid["ds6w:label"],allowUnsafeHTMLShortHelp:!0,shortHelp:u._buildTooltipWithHyperlink(m,t)})};D.isBETAEnabled()&&!0!==this.grouping6W&&g.subLabels&&(E.subLabels={tile:this._transformAttribute("subLabels",T,"tile"),thumbnail:this._transformAttribute("subLabels",T,"thumbnail"),tilebig:this._transformAttribute("subLabels",T,"tilebig"),table:this._transformAttribute("subLabels",T,"table")}),E.customTooltip._reachableState=!0,t.grid.preview_url_value&&(E.thumbnail=t.grid.preview_url_value);let O=e.is(t.getColor,"function")?t.getColor():void 0;return O&&(E.color=O),!0===n&&(E.multipleTitleLineNumber=!0),E},_generateAttributesFromODTSelector:function(t){let i="";if(e.is(t,"object")){let e=Object.getOwnPropertyNames(t);for(let n=0,s=e.length;n<s;n++)i+="data-"+e[n].replace(/:/g,"")+'="'+t[e[n]]+'" '}return i},_templateSearchItemSpan:function(t,i,n,s,o,a){let r='<span class="searchItemSpan'+(e.is(o,"string")?" "+o:"")+'" search-item-number="'+t+'" search-item-predicate="'+i+'" search-item-predicate-value="'+S.escapeHtml(n)+'" ';return"ds6w:type"===i&&e.is(a,"object")&&(r+=this._generateAttributesFromODTSelector(a)),r+=">"+(void 0!==s?s:"")+"</span>",r},_buildTooltipWithHyperlink:function(i,n){let s,o=this,a=[],r=[],l=S.getServiceUrl("swym",S.getActiveTenant()),c=!1,d=this._ctx_options,u=e.is(d),h=B.isAdvSearchRun(d),g=this._snSkeleton?this._snSkeleton.getOption("addinMode"):void 0,p=e.is(g,"string")&&g.length>0;u&&!h&&!p&&(c=!0);let _="";return e.is(n.grid["ds6w:dataSource"],"string")&&n.grid["ds6w:dataSource"].includes("ds6w:dataSource.3DSwymConv")&&(_="3DSwymConv"),i.forEach((function(i){if(c||(s=e.is(o._fromDropDown)&&!0===o._fromDropDown?void 0:l&&"3DSwymConv"!==_?"community"===i.predicateValue||"responsible"===i.predicateValue&&!1===i.bForceAvoid||"dataSource"===i.predicateValue&&"3DDrive"===i.value?"searchItemSpan_hyperlink":void 0:"dataSource"===i.predicateValue&&"3DDrive"===i.value?"searchItemSpan_hyperlink":void 0),i.isSearchHit)r.push({tag:"span",text:0===r.length?A.get("search_hit")+" : ":"    - "}),r.push({tag:"span",html:S.escapeHtml(i.value)+(i.predicateNLS?" "+A.get("search_hit_in")+" "+i.predicateNLS:"")});else if(a.push({tag:"span",text:i.predicateNLS+" : "}),s){let e=t.create("span",{class:"searchItemSpan_hyperlink",text:i.value.replace(/&amp;/g,"&"),id:"tooltip_hyperlink",events:{mouseenter:function(){document.getElements("#tooltip_hyperlink").forEach((function(e){e.addEventListener("pointerdown",(function(e){e.stopImmediatePropagation(),o._clickOnTooltipHyperlink(n,e)}))}))}}});e.setAttributes({"search-item-predicate":i.predicate}),a.push(e)}else a.push({tag:"span",html:S.escapeHtml(i.value)})})),t.create("div",{class:"searchItemToolTipContent short",html:a.concat(r)})},_clickOnTooltipHyperlink:function(e,t){let i={options:{id:e.id,grid:e.grid}},n={name:t.target.getAttribute("search-item-predicate"),source:"3DDrive"},s=this.getSNSkeleton().getCollection();this._snSkeleton.onItemSignatureClick(i,s,n)},generateTreeModelAsync:function(t,i,n){let s;if(s=void 0!==i?i:this._treeDocument||this.initTreeDocument(),!e.is(s))return void R.warn("!UWACore.is(Treedocument)");let a=this,r=t||this._models,l=s.getRoots().length,c=!0,u=S.isInTheSimpleSearch({tenant:this.getActiveTenant()}),g=0,p=0,_=0,f=0;if(!0!==u&&!1!==u||(c=!1),c=!0,r.length>l){this._dosThumbnailBatchHelper.startViewSync(),s.prepareUpdate();var m={},v=[];S.SearchTypeEnum.MY_RECENT_CONTENT===a.service_parameters.query&&a.service_parameters.recent_filter?"*"!==a.service_parameters.recent_filter&&v.push(a.service_parameters.recent_filter):!0===a.service_parameters.isAPQSearch?v.push(a.service_parameters.query.replace(/3dexp.*:/g,"")):e.is(a.service_parameters.search_criteria_to_display,"string")&&a.service_parameters.search_criteria_to_display.length>0?v.push(a.service_parameters.search_criteria_to_display):e.is(a.service_parameters.originalSearchCriteria,"string")&&a.service_parameters.originalSearchCriteria.length>0&&a.service_parameters.originalSearchCriteria.length<2e3?v.push(a.service_parameters.originalSearchCriteria):e.is(a.service_parameters.query,"string")&&a.service_parameters.query.length>0&&a.service_parameters.query.length<2e3&&v.push(a.service_parameters.query),e.is(a.service_parameters.searchInCriteria,"string")&&0<a.service_parameters.searchInCriteria.length&&(v.push(a.service_parameters.searchInCriteria),e.is(a.service_parameters.query,"string")&&0<a.service_parameters.query.length&&v.push(a.service_parameters.query));var w=[];v.forEach((function(e){w=w.concat(e.split(" "))})),this.updateSwymTypeIcon(r),this.extractAllMatchesFromSnippetInfos(r).forEach((function(e){w=w.concat(e.split(" "))})),!1===h.getOption("HighlightWithUserQuery")&&!0===S.isSnippetAvailable(this.getActiveTenant())&&(w=[]);var b=null;for(_=(v=w.filter((function(e){return"OR"!==e&&"AND"!==e}))).length-1;_>=0;_--){var C=v[_],y=C.split(" OR ");if(C=y.join(""),y=C.split(" AND "),C=y.join(""),y=C.split("flattenedtaxonomies:"),C=y.join(""),(y=C.split('"')).length>1&&y.length%2==1){for(var D=0,I=y.length;D<I;D++)b=y[D],e.is(b,"string")&&(b=b.trim()),b.length>0&&"("!==b&&")"!==b&&v.push(b);v.splice(_,1)}}if(v.length>1){var T={};for(p=v.length,g=0;g<p;g++)b=v[g],e.is(b)&&0<(b=b.trim()).length&&(T[b=(b=b.toUpperCase()).replace(/\*/g,"")]=0);(v=Object.keys(T)).length>1&&v.sort((function(e,t){return t.length-e.length}))}var x=[];for(_=0,f=v.length;_<f;_++){var N=v[_].replace(/\*/g,"");N=(N=S.escapeHtml(N)).replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),x.push(new RegExp(N,"ig"))}!0===h.getOption("noHighlight")&&(x=[]);var E=new RegExp("","ig"),O=new RegExp("","ig"),k=h.getOption("select_snippets"),P=h.getOption("snippet_unsupported_sources");let t=void 0!==n&&n<r.length-l?n:r.length-l;for(g=0;g<t;g++){var M=r[l+g],V=null;if(e.is(M)&&((V=M.clone()).collection=M.collection),e.is(V)){if(S.isFUN096612Active()&&this._addDisplayNameColumn(V),V.grid=e.clone(V._attributes),e.is(V.grid)){var U=Object.keys(V.grid);if(e.is(U,"array")){let t=h.getOption("not_hierarchical_predicates");var L=0,F=0;for(L=0,F=U.length;L<F;L++)if(e.is(V.grid[U[L]],"array")&&V.grid[U[L]].length){let i=!1;if(e.is(V.grid[U[L].trim()+"_value"],"array")){let n=[];for(var j=V.grid[U[L].trim()+"_value"],W=0;W<j.length;W++)if(e.is(j[W],"array")){var B=j[W];let e="";var X,H=0;for(H=0,X=B.length;H<X;H++)0===H?e=B[H]:e+=h.getOption("results_display_hierarchical_separator_for_value")+B[H];n.push(e)}else n.length<1?n=j[W]?[j[W].trim()]:[void 0]:n.push(j[W]?j[W].trim():void 0);V.grid[U[L]]=n.join(A.get("default_predicate_value_concat_link")),t.indexOf(U[L])<0&&(V.set(U[L],V.grid[U[L]]),M.set(U[L],V.grid[U[L]])),i=!0}if(!i){let e=/:snippet_value$/;V.grid[U[L]]=!1===e.test(U[L])?V.grid[U[L]].join(A.get("default_predicate_value_concat_link")):V.grid[U[L]].join(S.INNER_CONCAT_KEY)}}V.withoutHtmlTag=e.clone(V.grid);var G=null,z=null,q=null;for(L=0,F=U.length;L<F;L++){var Q={predicateName:U[L],select_snippets:k},Z=a._getSnippetAttributeCorrespondingToPredicate(Q);if(e.is(Z,"object")&&!0===Z.gotSnippetAttribute&&e.is(Z.snippetAttrName,"string")){var J=a._getValueWithHighlightByConcatenationOfSnippet({searchItemModel:V,SnippetAttr:Z.snippetAttrName});e.is(J)&&e.is(J.valueWithHighlight,"string")&&J.valueWithHighlight.length>0&&(V.grid[U[L]]=J.valueWithHighlight)}else if(!0===h.getOption("HighlightWithUserQuery")&&!0===S.isSnippetAvailable(this.getActiveTenant()))for(z=0,q=x.length;z<q;z++)G=V.grid[U[L]],e.is(G,"string")&&(G=a.highlightRegexInStringJustOnce(G,x[z])),V.grid[U[L]]=G;else if(U[L].lastIndexOf("_value")!==U[L].length-6&&U[L].indexOf(":")>-1||"snippet"===U[L]||"snippet_value"===U[L]){if(G=V.grid[U[L]],"snippet"===U[L]||"snippet_value"===U[L])G=(G=G.replace(//g,'<span class="highlightedSearchCriteria">')).replace(//g,"</span>");else if(e.is(G)){for(z=0,q=x.length;z<q;z++)G=G.replace(x[z],"$&");let e="";S.isODTMode()&&"ds6w:type"===U[L]&&(e="ODTSELECTOR"),G=(G=G.replace(E,'<span class="highlightedSearchCriteria" '+e+">")).replace(O,"</span>"),S.isODTMode()&&"ds6w:type"===U[L]&&G.indexOf("span")<0&&(G="<span "+e+">"+G+"</span>")}V.grid[U[L]]=G}}}}V.clickableTitle=c}if(e.is(V)&&e.is(V.isAShowOnlyObject,"function")&&V.isAShowOnlyObject()){var Y=this.getAttributesToRetrieve();if(Array.isArray(Y)&&Y.length>0)for(var K=0;K<Y.length;K++){var $=Y[K];if(!V.grid.hasOwnProperty($)){var ee=A.get("no_access");V.grid[$]='<span class="NoAccessSearchCriteria">'+ee+"</span>"}}}var te=a.getCollectiveViewOptions(V,m,true,g,P);Object.assign(V,te);var ie=new d(V);s.addRoot(ie)}s.pushUpdate(),this._dosThumbnailBatchHelper.endViewSync(this)}return new o((function(e){e()}))},_getDisplayNamePredicates:function(){var t=[];if(S.isFUN096612Active()&&e.is(this.service_parameters)){this.service_parameters.isAPQSearch,this.getPQ();var i=this.getPQ();if(e.is(i)){var n=C.getDisplayNameObject(i.pqName);e.is(n,"object")&&e.is(n.displayNamePredicates,"array")&&(t=n.displayNamePredicates)}}return t},_addDisplayNameColumn:function(t){var i=C.getDisplayNameCustoObject();if(e.is(i,"object")&&e.is(i.displayNamePredicates,"array")){var n,s=null,o=null,a=0,r=t._attributes;for(o=e.is(i.separator)?i.separator:",",a=0,n=i.displayNamePredicates.length;a<n;a++){var l=r[i.displayNamePredicates[a]];e.is(l)&&(e.is(s)&&e.is(o)&&(s+=o),e.is(s)?s+=l:s=l)}t.set("ds6wg:_displayName_",s)}},_getSnippetAttributeCorrespondingToPredicate:function(t){var i={snippetAttrName:"",gotSnippetAttribute:!1};if(!0===S.isSnippetAvailable(this.getActiveTenant())&&e.is(t,"object")){var n=t.predicateName,s=t.select_snippets;e.is(n,"string")&&(e.is(s,"object")||(s=h.getOption("select_snippets")),e.is(s,"object")&&s.hasOwnProperty(n)&&(i.snippetAttrName=s[n],i.gotSnippetAttribute=!0))}return i},highlightRegexInStringJustOnce:function(t,i){var n=t;if(e.is(t,"string")){var s=t.split(" ");s.forEach((function(e,t){e.indexOf("highlightedSearchCriteria")<0&&(s[t]=e.replace(i,'<span class="highlightedSearchCriteria">$&</span>'))})),n=s.join(" ")}return n},extractAllMatchesFromSnippetInfos:function(t){var i=[];return t.forEach((function(t){var n=t.get("snippet");e.is(n)&&n.split("").forEach((function(e){var t=e.split("");t.length>1&&i.push(t[0])}))})),i},_getValueWithHighlightByConcatenationOfSnippet:function(t){var i=this,n={valueWithHighlight:""},s="";if(e.is(t)&&e.is(t.searchItemModel)&&e.is(t.SnippetAttr)){var o=t.SnippetAttr,a=t.searchItemModel;if(e.is(a)){var r=void 0;e.is(a)&&e.is(a.get,"function")?r=a.get(o+"_value"):e.is(a.grid[o])&&(r=a.grid[o]);let t="ds6w:snippet"==o;if(t&&r.includes('"highlighted":"false"')&&!r.includes('"highlighted":"true"')&&e.is(a)&&e.is(a.get,"function")){let e=a.get("ds6w:description:snippet_value");e&&e.includes('"highlighted":"true"')&&(r=e)}var l=function(n){if(e.is(n,"string")){var a=JSON.parse(n);if(e.is(a,"object")&&e.is(a.text,"array")&&a.text.length>0)for(var r=0;r<a.text.length;r++)if(e.is(a.text[r].content,"string")){var l=a.text[r].content;if((l=l.replace(/(\r\n|\n|\r|\t)/gm,"")).length>2&&0===r&&"swym:message_text:snippet"===o&&"["===l.charAt(0)){var c=l.indexOf("]");if(c>0){var d=l.slice(0,c+1);l=l.replace(d,"")}}if(t&&null!=a.text.find((e=>"true"===e.highlighted))&&"false"===a.text[r].highlighted){let e=!1;r<a.text.length-1&&!e&&"true"===a.text[r+1].highlighted&&l.length>=50?(l="..."+l.slice(-30),e=!0):!e&&l.length>=50&&(l="")}var u=S.escapeHtml(l);t&&(u=i._treatCommunityTags(u)),s+=e.is(a.text[r].highlighted)&&"true"===a.text[r].highlighted?'<span class="highlightedSearchCriteria">'+u+"</span>":u}else"cut"===a.text[r].type&&(s+=S.escapeHtml("..."))}};if(e.is(r))if(e.is(r,"string"))l(r);else if(e.is(r,"array"))for(var c=0;c<r.length;c++)l(r[c])}}return n.valueWithHighlight=s,n},getNlsOfPropertiesValuesSearch:function(t,i,n,s){R.groupCollapsed("SearchCollection: getNlsOfPropertiesValuesSearch"),R.log("->resp:",t),R.log("->onCompleteOrig:",i),R.log("->goodArgsToReturn:",n),R.log("->dataToComputeNlsAUWFormat:",s);var o=this;let a=!0;s=v._sanitizePredicates(s);var r={tenantId:o.getActiveTenant(),lang:S.getLanguage(),onComplete:function(s){R.log("<-onComplete response from SearchDictionaryAccess.getNlsOfPropertiesValues:",s);var o=t._models,r=Object.getOwnPropertyNames(s),l=/\w+:\w+\.\w+/,c="",d=null;let u=Object.keys(JSON.parse(j));for(var h=0,g=o.length;h<g;h++){for(var p=0,_=r.length;p<_;p++){var f=o[h]._attributes[r[p]],m=null;if(e.is(f,"array"))for(var v=0,w=f.length;v<w;v++){if(m=o[h]._attributes[r[p]+"_value"][v],c="",e.is(m,"array")){var b=[],C=0,y=0;for(C=0,y=(d=m).length;C<y;C++)0===C?m=d[C]:m+="/"+d[C],b.push(m);for(C=0,y=b.length;C<y;C++)if(C>0&&(c+="/"),void 0!==s[r[p]][b[C]])c+=s[r[p]][b[C]];else{let e=b[C].split("/");c+=void 0!==s[r[p]][e[e.length-1]]?s[r[p]][e[e.length-1]]:e[e.length-1]}}else l.test(m)&&(m=m.slice(m.lastIndexOf(".")+1)),s[r[p]]&&(c=s[r[p]][m]);e.is(c,"string")?0!==c.indexOf("emxFramework.Range.")&&(o[h]._attributes[r[p]][v]=S.escapeHtml(c)):R.warn("Error, bad response from getNlsOfPropertiesValuesSearch ! (attr=",r[p],", value=",d,")")}else if(e.is(f,"string")){m=o[h]._attributes[r[p]+"_value"];let t=i=>e.is(i,"array")?t(i[i.length-1]):i;m=t(m),l.test(m)&&m.startsWith(r[p])&&(m=m.slice(m.lastIndexOf(".")+1)),s[r[p]]&&(c=s[r[p]][m]),e.is(c,"string")?0!==c.indexOf("emxFramework.Range.")&&(o[h].set(r[p],S.escapeHtml(c)),l.test(r[p])&&o[h].set(r[p]+"_value",S.escapeHtml(c))):R.warn("Error, bad response from getNlsOfPropertiesValuesSearch ! (attr=",r[p],", value=",m,")")}}if(o[h]._attributes&&o[h]._attributes.sourceid){let e=!1,t=0;for(;!e&&t<u.length;)o[h]._attributes.sourceid.startsWith(u[t])&&(e=!0),t++;if(e)for(let e in o[h]._attributes)"actions"!==e&&"implicit"!==e&&"implicit_value"!==e&&Array.isArray(o[h]._attributes[e])&&(o[h]._attributes[e]=o[h]._attributes[e].join(A.get("default_predicate_value_concat_link")))}}e.is(i,"function")&&e.is(n)&&i.apply(this,n),a=!1,R.groupEnd()},onFailure:function(t){if(R.error("[3DXSearchDictionaryAccess.getNlsOfPropertiesValuesSearch - Unable to retrieve NLS]",t),e.is(i,"function")&&e.is(n))return a=!1,i.apply(this,n);R.groupEnd()}};h.getOption("search_web_in_win")&&setTimeout((function(){!0===a&&(e.is(o._snSkeleton)&&e.is(o._snSkeleton.getOption,"function")&&U.publish({channel:o._snSkeleton.getOption("widgetId"),topic:"beforeSearchReload",data:{}}),location.reload(!0))}),16e3),R.log("Calling SearchDictionaryAccess.getNlsOfPropertiesValues"),R.log("->dataToComputeNlsAUWFormat:",s),R.log("->searchDictionaryAccessOptions:",r),v.getNlsOfPropertiesValuesBySource(s,r)},_setTagsPredicates:function(t){if(e.is(t,"array")&&e.is(this.options.tagger_proxy.setPredicates,"function")){var i;if(e.is(this._ctx_options)&&e.is(this._ctx_options.relevant_tags))i=e.clone(this._ctx_options.relevant_tags);else{var n=h.getOption("relevant_tags",{tenant:this.getActiveTenant()});i=e.clone(n),Object.keys(i).forEach((function(t){e.is(i[t],"object")&&i[t].weight<0&&(i[t].weight=0)}))}for(var s=h.getOption("datesAsFreeInputOnly"),o="",a=h.getOption("alwaysEnableFreeInputInTagger"),r=0,l=t.length;r<l;r++)if(e.is(t[r])&&e.is(t[r].sixw)&&(o=S.getURIToUse(t[r].sixw),e.is(o)&&o.length>0&&(e.is(i[o])||(i[o]={}),s&&(i[o].type=t[r].type),e.is(i[o].allowFreeInput)||(i[o].allowFreeInput=!0),!0!==a&&!0===i[o].allowFreeInput&&t[r].dispValue!==t[r].object&&(i[o].allowFreeInput=!1),"real"===t[r].type))){let e=this.getActiveTenant();i[o].freeInputOnly=h.isRangeValuesClassification({tenantId:e}),delete i[o].allowFreeInput}if(s&&this._tagsTransformer&&!0===this._tagsTransformer.isTransientWidget())for(var c in i){var d=i[c];d&&("date"===d.type&&(d.freeInputOnly=!0),delete d.type)}this.options.tagger_proxy.setPredicates(i)}},_retrieveLastIndexingDate:function(t){if(this._indexingDate=null,e.is(t)&&e.is(t.response_infos)&&e.is(t.response_infos.sources,"array")){for(var i={},n=0,s=t.response_infos.sources.length;n<s;n++){var o=t.response_infos.sources[n];e.is(o,"object")&&e.is(o.indexingDate,"object")&&(i[o.name]=o.indexingDate)}if(e.is(i["3dspace"]))this._indexingDate=i["3dspace"];else if(e.is(i.drive))this._indexingDate=i.drive;else{var a=Object.keys(i);a.length>0?(R.log("no indexingDate info found for 3dspace or drive source, taking the info available for "+a[0]),this._indexingDate=i[a[0]]):R.log("no indexingDate info found in the FedSearch response")}}},isSearchRespEstimated:function(){return!(!this.parsed_response||!this.parsed_response.response_infos)&&this.parsed_response.response_infos.estimated},updateModelsWithPreferredUnits:function(e){return this._snUnitConversionHelper.convertValuesToPreferredUnits(e)},getSocketID:function(){var t=null;return e.is(this._searchcom_socket)&&(t=this._searchcom_socket.id),t},proxifyUrlForSwym:function(e){const t=["preview_url","preview_url_value","type_icon_url","type_icon_url_value"];for(const i of e)for(const e of t)i[e]=w.proxifyUrl(i[e],{proxy:"passport"})},updateSwymTypeIcon:function(t){t.forEach((function(t){var i=t._attributes.sourceid_value;if(e.is(i)&&-1!==i.indexOf("swym")){var n=t.get("type_icon_url");if(e.is(n)&&-1===n.lastIndexOf("/large-icons")){var s=n.lastIndexOf("/"),o=n.substring(0,s)+"/large-icons"+n.substring(s);t._attributes.type_icon_url=o}}}))},interruptRequested:function(){return R.log("SearchCollection.interruptRequested"),this._interruptRequested},interrupt:function(e){R.log("SearchCollection.interrupt"),this._filterChangeInterruptSpecification=e,this._interruptRequested=!0},isDestroyed:function(){return R.log("SearchCollection.isDestroyed",!0===this.isDestroyed),!0===this.isDestroyed},updateSecurityContext:function(){this._update_security_contextTodo=!0,this.dispatchEvent("update_security_context",{})},_correctCountForHierarchicalTags:function(t){var i={};if(e.is(t,"array")&&!0===h.getOption("synthesis_hierarchical")){function s(e,t,i){i[e]&&t[e]&&t[e].forEach((function(n){i[n]&&(i[e].count=i[e].count-i[n].count),s(n,t,i)}))}t.forEach((function(t){var n=t.sixw;i[n]||(i[n]={},i[n].roots={},i[n].branches={},i[n].map={});var s=i[n],o=s.roots,a=s.branches,r=s.map;if(e.is(t.object,"array")){o[t.object[0]]||(o[t.object[0]]={});var l=t.object.slice(0,t.object.length-1).join("/"),c=t.object.join("/");a[l]||(a[l]=[]),a[l].push(c),r[c]=t}else r[t.object]=t})),Object.keys(i).forEach((function(e){var t=i[e],n=t.roots,o=t.branches,a=t.map;Object.keys(n).forEach((function(e){s(e,o,a)}))}));var n=[];return t.forEach((function(e){e.count>0&&n.push(e)})),n}return t},_asyncUpdateModels:function(){let e=JSON.parse(j),t={};for(let i in e)t=Object.assign(t,e[i]);for(let e in this.results)for(let i in t)if(this.results[e][i])if(Array.isArray(t[i]))for(let n in t[i])this.results[e][t[i][n]]=this.results[e][i];else this.results[e][t[i]]=this.results[e][i];for(let e in this._models)for(let i in t)if(this._models[e]._attributes&&this._models[e]._attributes[i])if(Array.isArray(t[i]))for(let n in t[i])this._models[e]._attributes[t[i][n]]=this._models[e]._attributes[i];else this._models[e]._attributes[t[i]]=this._models[e]._attributes[i]},_isPinnedWidget:function(){let t,i=!1;e.is(this._snSkeleton)&&(t=this._snSkeleton.getOption("addinMode"));let n=S.identifyClientInfo(t);e.is(this._snSkeleton)&&(n=S.identifyClientInfo(this._snSkeleton.getOption("addinMode")));let s=h.getOption("search_web_in_win");return e.is(this._snSkeleton)&&e.is(this._snSkeleton.getOption,"function")&&"3DSwym"!==n.identifier&&!s&&(i="true"!==this._snSkeleton.getOption("transient_context")&&!0!==this._snSkeleton.getOption("transient_context")),i},_addSynonymCheckCallback:function(e){var t=this.getRequestCriteria();"client"!==h.getOption("Synonyms_impl_type")?"server"!==h.getOption("Synonyms_impl_type")||(t.service_params.with_synonyms=!0):t.service_params.query=SynonymsUtils.getQueryWithSynonyms(t.service_params.query)},setComputedResultCount:function(e){this._computedResultCount=e},getComputedResultCount:function(){return this._computedResultCount},setColorMap:function(e){this._colorizationHelper.setColorMap(e)},unsetColorMap:function(){this._colorizationHelper.unsetColorMap()},getColor:function(e){return this._colorizationHelper.getColor(e)}});return Z})),define("DS/SNResultUX/utils/6WRefineHelpers",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","UWA/Element","DS/SNResultUX/utils/ExternalComponentHelpers","DS/SNInfraUX/SearchDebug","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],(function(e,t,i,n,s,o,a,r,l,c){"use strict";return t.extend(i,n,a,{referer:null,globeViewContainer:null,globeViewContainerContent:null,globeViewContainerObject:null,globeViewContainerSwitch:null,timelineViewContainer:null,timelineViewContainerContent:null,timelineViewContainerObject:null,timelineViewContainerSwitch:null,timelineViewContainerDocking:null,phonebookViewContainer:null,phonebookViewContainerContent:null,phonebookViewContainerObject:null,phonebookViewContainerSwitch:null,phonebookViewContainerDocking:null,tagcloudViewContainer:null,tagcloudViewContainerContent:null,tagcloudViewContainerObject:null,tagcloudViewContainerSwitch:null,tagCloudViewContainerDocking:null,init:function(e){return this.globeViewContainer=null,this.globeViewContainerContent=null,this.globeViewContainerObject=null,this.globeViewContainerSwitch=null,this.timelineViewContainer=null,this.timelineViewContainerContent=null,this.timelineViewContainerObject=null,this.timelineViewContainerSwitch=null,this.phonebookViewContainer=null,this.phonebookViewContainerContent=null,this.phonebookViewContainerObject=null,this.phonebookViewContainerSwitch=null,this.tagcloudViewContainer=null,this.tagcloudViewContainerContent=null,this.tagcloudViewContainerObject=null,this.tagcloudViewContainerSwitch=null,e&&e.referer&&(this.referer=e.referer),this._parent()},create6WRefineHelpers:function(t,i,n,s,o,a,r){!l.isFUN109031Active()||t||e.is(this.globeViewContainer)||i&&(!i||!0!==n.modifysavedsearch)||(this._createGlobeDOM(a,r,o,s),l.isWebInWin()||(this._createTimelineDOM(a,r,o,s),this._createPhoneBookDOM(a,r,o,s),this._createtagCloudDOM(a,r,o,s)))},_createGlobeDOM:function(e,t,i,n){let o=this;this.globeViewContainer=s.create("div",{id:"globe-view-"+e+"-"+t,class:"search-globe-view"}),this.globeViewContainerObject=s.create("div",{class:"search-globe-view-object"}),this.globeViewContainerObject.inject(this.globeViewContainer),this.globeViewContainerSwitch=s.create("div",{class:"search-globe-view-switch"}),this.globeViewContainerSwitch.innerHTML='<span class="fonticon fonticon-chevron-up"></span>',this.globeViewContainerSwitch.onclick=()=>{o.globeViewContainer.classList.contains("tiny")?(o.globeViewContainerSwitch.innerHTML='<span class="fonticon fonticon-chevron-up"></span>',this.globeViewContainer.classList.remove("tiny"),o.globeViewContainerContent&&o.globeViewContainerContent.refresh3DExperienceMarkers()):(o.globeViewContainerSwitch.innerHTML='<span class="fonticon fonticon-chevron-down"></span>',this.globeViewContainer.classList.add("tiny"))},this.globeViewContainerSwitch.inject(this.globeViewContainer),this.globeViewContainerContent=null,this.hideGlobeView(),this.globeViewContainer.inject(null!==i?i:n)},_createTimelineDOM:function(t,i,n,o){let a=this;this.timelineViewContainer=s.create("div",{id:"timeline-view-"+t+"-"+i,class:"search-timeline-view"}),this.timelineViewContainerObject=s.create("div",{class:"search-timeline-view-object"}),this.timelineViewContainerObject.inject(this.timelineViewContainer),this.timelineViewContainerSwitch=s.create("div",{class:"search-timeline-view-switch"}),this.timelineViewContainerSwitch.innerHTML='<span class="fonticon fonticon-chevron-up"></span>',this.timelineViewContainerSwitch.onclick=()=>{a.timelineViewContainer.classList.contains("tiny")?(a.timelineViewContainerSwitch.innerHTML='<span class="fonticon fonticon-chevron-up"></span>',this.timelineViewContainer.classList.remove("tiny")):(a.timelineViewContainerSwitch.innerHTML='<span class="fonticon fonticon-chevron-down"></span>',this.timelineViewContainer.classList.add("tiny"))},this.timelineViewContainerSwitch.inject(this.timelineViewContainer),this.timelineViewContainerDocking=s.create("div",{class:"Search-docking"}),e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-calendar",title:c.get("6wRefineHelper.timeline.collapse")}).inject(this.timelineViewContainerDocking).onclick=()=>{a.timelineViewContainer.removeClassName("collapsed")},e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-calendar",title:c.get("6wRefineHelper.timeline.display")}).inject(this.timelineViewContainerDocking).onclick=()=>{a.timelineViewContainer.addClassName("collapsed")},this.timelineViewContainerDocking.inject(this.timelineViewContainer),this.timelineViewContainerContent=null,this.hideTimelineView(),this.timelineViewContainer.inject(null!==n?n:o)},_createPhoneBookDOM:function(t,i,n,o){let a=this;this.phonebookViewContainer=s.create("div",{id:"phonebook-view-"+t+"-"+i,class:"search-phonebook-view"}),this.phonebookViewContainerObject=s.create("div",{class:"search-phonebook-view-object"}),this.phonebookViewContainerObject.inject(this.phonebookViewContainer),this.phonebookViewContainerSwitch=s.create("div",{class:"search-phonebook-view-switch"}),this.phonebookViewContainerSwitch.innerHTML='<span class="fonticon fonticon-chevron-up"></span>',this.phonebookViewContainerSwitch.onclick=()=>{a.phonebookViewContainer.classList.contains("tiny")?(a.phonebookViewContainerSwitch.innerHTML='<span class="fonticon fonticon-chevron-up"></span>',this.phonebookViewContainer.classList.remove("tiny")):(a.phonebookViewContainerSwitch.innerHTML='<span class="fonticon fonticon-chevron-down"></span>',this.phonebookViewContainer.classList.add("tiny"))},this.phonebookViewContainerSwitch.inject(this.phonebookViewContainer),this.phonebookViewContainerDocking=s.create("div",{class:"Search-docking"}),e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-users",title:c.get("6wRefineHelper.phonebook.collapse")}).inject(this.phonebookViewContainerDocking).onclick=()=>{a.phonebookViewContainer.removeClassName("collapsed")},e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-users",title:c.get("6wRefineHelper.phonebook.display")}).inject(this.phonebookViewContainerDocking).onclick=()=>{a.phonebookViewContainer.addClassName("collapsed")},this.phonebookViewContainerDocking.inject(this.phonebookViewContainer),this.phonebookViewContainerContent=null,this.hidePhonebookView(),this.phonebookViewContainer.inject(null!==n?n:o)},_createtagCloudDOM:function(t,i,n,o){let a=this;this.tagcloudViewContainer=s.create("div",{id:"tagcloud-view-"+t+"-"+i,class:"search-tagcloud-view"}),this.tagcloudViewContainerObject=s.create("div",{class:"search-tagcloud-view-object"}),this.tagcloudViewContainerObject.inject(this.tagcloudViewContainer),this.tagcloudViewContainerSwitch=s.create("div",{class:"search-tagcloud-view-switch"}),this.tagcloudViewContainerSwitch.innerHTML='<span class="fonticon fonticon-chevron-up"></span>',this.tagcloudViewContainerSwitch.onclick=()=>{a.tagcloudViewContainer.classList.contains("tiny")?(a.tagcloudViewContainerSwitch.innerHTML='<span class="fonticon fonticon-chevron-up"></span>',this.tagcloudViewContainer.classList.remove("tiny")):(a.tagcloudViewContainerSwitch.innerHTML='<span class="fonticon fonticon-chevron-down"></span>',this.tagcloudViewContainer.classList.add("tiny"))},this.tagcloudViewContainerSwitch.inject(this.tagcloudViewContainer),this.tagcloudViewContainerDocking=s.create("div",{class:"Search-docking"}),e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-6w-what",title:c.get("6wRefineHelper.tagcloud.collapse")}).inject(this.tagcloudViewContainerDocking).onclick=()=>{a.tagcloudViewContainer.removeClassName("collapsed")},e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-6w-what",title:c.get("6wRefineHelper.tagcloud.display")}).inject(this.tagcloudViewContainerDocking).onclick=()=>{a.tagcloudViewContainer.addClassName("collapsed")},this.tagcloudViewContainerDocking.inject(this.tagcloudViewContainer),this.tagcloudViewContainerContent=null,this.hideTagcloudView(),this.tagcloudViewContainer.inject(null!==n?n:o)},maskAllContainers:function(){this.tagcloudViewContainerObject&&o.mask(this.tagcloudViewContainerObject),this.phonebookViewContainerObject&&o.mask(this.phonebookViewContainerObject),this.timelineViewContainerObject&&o.mask(this.timelineViewContainerObject),this.globeViewContainerObject&&o.mask(this.globeViewContainerObject)},unmaskAllContainers:function(){this.tagcloudViewContainerObject&&o.unmask(this.tagcloudViewContainerObject),this.phonebookViewContainerObject&&o.unmask(this.phonebookViewContainerObject),this.timelineViewContainerObject&&o.unmask(this.timelineViewContainerObject),this.globeViewContainerObject&&o.unmask(this.globeViewContainerObject)},hideGlobeView:function(){this.globeViewContainer&&(this.globeViewContainer.style.display="none")},hideTimelineView:function(){this.timelineViewContainer&&(this.timelineViewContainer.style.display="none")},hidePhonebookView:function(){this.phonebookViewContainer&&(this.phonebookViewContainer.style.display="none")},hideTagcloudView:function(){this.tagcloudViewContainer&&(this.tagcloudViewContainer.style.display="none")},showGlobeView:function(){if(null===this.globeViewContainerContent){let t=this;require(["DS/SNResultUX/views/helpers/utils/GlobeView"],(function(i){let n={parentContainer:t.globeViewContainerObject,use2D:!1,collection:t.referer.getCollection(),globe:!r.getOption("SearchLeaflet"),resultMgt:t.referer};t.globeViewContainerContent=new i(n),t.globeViewContainerContent.render(n);let s=t.referer.getSNSkeleton().getCurrentView();e.is(s)&&e.is(s.id)&&"where"===s.id&&s.addEvent("onMultiView",(function(e){t.globeViewContainerContent.refreshFromMultiview(e)}))}))}this.globeViewContainer&&(this.globeViewContainer.style.display="")},showTimelineView:function(e,t,i,n){if(!l.isWebInWin()){if(void 0===e&&(e=[]),null===this.timelineViewContainerContent){let s=this;require(["DS/SNResultUX/views/helpers/utils/TimeLines/TimeLinePresenter"],(function(o){s.timelineViewContainerContent=new o({data:e,dispayState:!0,container:s.timelineViewContainerObject,getLocalFilters:()=>s.referer.getTaggerProxy().getCurrentFilter(),setLocalFilter:e=>{i&&i.call(s.referer,e)},rerenderMultiView:e=>{n&&n.call(s,e)},aDates:t}),s.timelineViewContainerContent.render()}))}else this.timelineViewContainerContent.parseAndFormatData(e),this.timelineViewContainerContent.render();this.timelineViewContainer&&(this.timelineViewContainer.style.display="")}},showPhonebookView:function(e,t,i){if(!l.isWebInWin()){if(void 0===e&&(e=[]),null===this.phonebookViewContainerContent){let n=this;require(["DS/SNResultUX/views/helpers/utils/PhoneBook"],(function(s){n.phonebookViewContainerContent=new s({data:e,dispayState:!0,container:n.phonebookViewContainerObject,collection:n.referer.getCollection(),getLocalFilters:()=>n.referer.getTaggerProxy().getCurrentFilter(),setLocalFilter:e=>{t&&t.call(n,e)},rerenderMultiView:e=>{i&&i.call(n,e)}}),n.phonebookViewContainerContent.render()}))}else this.phonebookViewContainerContent.setOption("data",e),this.phonebookViewContainerContent.reset(),this.phonebookViewContainerContent.render();this.phonebookViewContainer&&(this.phonebookViewContainer.style.display="")}},showTagcloudView:function(e,t){if(!l.isWebInWin()){if(void 0===e&&(e=[]),null===this.tagcloudViewContainerContent){let e=this;require(["DS/TagNavigator/embeddedTagger/EmbeddedCriteriaListView"],(function(t){e.tagcloudViewContainerContent=new t({}).inject(e.tagcloudViewContainerObject).render().redraw()}))}else this.tagcloudViewContainerContent.redraw();this.tagcloudViewContainer&&(this.tagcloudViewContainer.style.display="")}},getTimelineComponentData:function(){return null!==this.timelineViewContainerContent?this.timelineViewContainerContent.data:[]},reset:function(){this.globeViewContainerContent&&this.globeViewContainerContent.destroy(),this.timelineViewContainerContent&&this.timelineViewContainerContent.destroy(),this.phonebookViewContainerContent&&this.phonebookViewContainerContent.destroy(),this.tagcloudViewContainerContent&&this.tagcloudViewContainerContent.destroy(),this.globeViewContainer=null,this.globeViewContainerContent=null,this.globeViewContainerObject=null,this.globeViewContainerSwitch=null,this.timelineViewContainer=null,this.timelineViewContainerContent=null,this.timelineViewContainerObject=null,this.timelineViewContainerSwitch=null,this.timelineViewContainerDocking=null,this.phonebookViewContainer=null,this.phonebookViewContainerContent=null,this.phonebookViewContainerObject=null,this.phonebookViewContainerSwitch=null,this.phonebookViewContainerDocking=null,this.tagcloudViewContainer=null,this.tagcloudViewContainerContent=null,this.tagcloudViewContainerObject=null,this.tagcloudViewContainerSwitch=null,this.tagCloudViewContainerDocking=null},destroy:function(){this.reset()&&this._parent()}})})),define("DS/SNResultUX/utils/ResultCategoryUXHelper",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Promise","DS/SNInfraUX/Api/SearchApi","DS/SNInfraUX/RefineHelper/RefineHelper","DS/SNInfraUX/SearchRessources","DS/SNInfraUX/SearchLogin","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/Logger","DS/SNResultUX/utils/ResultsUtils","DS/SNInfraUX/utils/WildcardMgr","DS/WebAppsFoundations/Collections/PageableCollection","DS/SNResultUX/collections/SearchCollection","DS/SNInfraUX/SearchResultCategories","DS/SNInfraUX/SearchSettings","DS/SNResultUX/utils/SearchTagsTransformation","DS/SNResultUX/utils/ContentLocationServices","DS/TagNavigator/simplified/utils/CriteriaUtils","text!DS/SNInfraUX/assets/ResultCategoryDefaults.json","text!DS/SNResultUX/assets/CategoryViewMapping.json","DS/SNInfraUX/SearchPreferences"],(function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_,f,m,S,v,w,b){"use strict";let C=t.singleton(i,{init:function(){this._CategoryViewMapping=JSON.parse(w),this._setTagsTransformer()},_setTagsTransformer:function(e){if(!e){e=new f({isTransientWidget:!0})}this._tagsTransformer=e},_getResultPromise:function(t,i){return new n((function(n,o){var a=e.extend(t,{onComplete:function(t){n(e.extend(t,i))},onFailure:function(e){o(e)}});s.search(a)}))},_getResultCollectionPromise:function(e,t){var i=C._getResultCollection(e,t);return new n((function(e,t){i.collection.fetch({onComplete:function(t,n){e(i)},onFailure:function(e){t(e)}})}))},buildSearchParams:function(e){var t,i=this,n=e.search_text;e.search_text&&p.getActiveCategories(this._getTenant(),e.group).forEach((function(s){if(s.id==e.category_id){n=i._buildSearchQuery(s,e);var o=i._getCategoryQuery(s);o&&(n="("+n+")"+o),t=[s.source]}}));return{query:n,source:t}},_buildSearchQuery:function(t,i){let n="";n=e.is(i.search_text,"object")?i.search_text[t.nls]:i.search_text;var s=n,o=u.getInfo(s);if(o.isAnExactCriteria||o.isASpecialCriteria||o.isAdvancedCriteria||o.containsNonLatinChars||o.indexOfwildChar>=0||o.pqAbbrevation);else if("3dspace"===t.source)(s=t.add_wildcard?u.manageWildcardAddtion(n,{addWildCard_inCtx:!0}):n).indexOf(" ")>0&&(s=s.split(" ").join("*"));else if(s.indexOf(" ")>0){for(var a=s.split(" "),r=a.pop();r.length<3;)r=a.pop();a.length>0&&(r+="*"),a.push(r),s="("+(s=a.join(" "))+")"}else s+="*";return t.match_on&&(s=t.match_on.indexOf(":")>0?"["+t.match_on+"]:"+s:t.match_on+":"+s),t.query&&(s=this._mergeQueries(s,t.query,"AND")),s},_buildSearchQueryForResult:function(t,i){let n="";e.is(i.search_text,"object")?n=i.search_text[t.nls]:e.is(i.search_text)&&(n=i.search_text);var s=u.manageWildcardAddtion(n);s===l.SearchTypeEnum.ADVANCED_SEARCH&&(s="");var o="";return e.is(t.query,"string")&&t.query.length>0?o=t.query:t.query&&t.query.query&&(o=t.query.query),s=this._mergeQueries(s,o,"AND")},_createQueryFromTypes:function(t){var i="";if(e.is(t,"array")&&t.length>0){i+=" AND ([ds6w:type]:(";for(var n=0;n<t.length;n++){i+='"'+t[n]+'"',n<t.length-1&&(i+=" OR ")}i+="))"}return i},_createQueryFrom3DSpaceTypes:function(t){var i="";if(e.is(t,"array")&&t.length>0){i+=" AND (flattenedtaxonomies:(";for(var n=0;n<t.length;n++){var s=t[n];s.startsWith("ds6wg:")&&(s=s.substring(6)),i+='"types/'+s+'"',n<t.length-1&&(i+=" OR ")}i+="))"}return i},_getCategoryQuery:function(t){var i=t.criteria;return e.is(t.types,"array")&&(i="3dspace"==t.source?this._createQueryFrom3DSpaceTypes(t.types):this._createQueryFromTypes(t.types)),i},_getQueryFromRefine:function(e,t){return l._getQueryFromRefine(e,t)},_search:function(t){var i={},n=this,s=this._getAvailableSources();if(e.is(t)&&e.is(t.list)){var a={},r=void 0;if(t.refine&&o.isSimplifiedTaggerFilters(t.refine.allfilters)){a=o.convertToRefineAndUQL(t.refine.allfilters);var u=d.from_filters_to_uql(t.refine.allfilters);r=n._mergeQueries(u,a.uql,"AND")}t.list.forEach((function(o,d){if(s[o.source]||t.all_src){if(s[o.source]){var u=n._getCategoryQuery(o);u&&l.addSourceSpecificParameter(o,{sourceIds:e.is(o.source,"array")?o.source:[o.source],param:{id:"additional_query",value:u}})}var h;h=t.build_query_method?t.build_query_method.call(n,o,t):n._buildSearchQuery(o,t),h=n._mergeQueries(h,r,"AND");var g={},p=[];if(o.refine&&o.refine.allfilters&&a.refine){var f=Object.keys(o.refine.allfilters).concat(Object.keys(a.refine)).sort().reduce(((e,t,i,n)=>(i&&n[i]===n[i-1]&&e.push(t),e)),[]);if(f.length){f.forEach(((e,t)=>{var i=n._getQueryFromRefine(e,o.refine.allfilters[e]),s=n._getQueryFromRefine(e,a.refine[e]);i.length<s.length?(delete o.refine.allfilters[e],p.push(i)):(delete a.refine[e],p.push(s))}));var S=p.reduce(((e,t)=>e+" AND "+t));h=n._mergeQueries(h,S,"AND")}g.allfilters=e.extend(o.refine.allfilters,e.clone(a.refine,!0))}else o.refine&&o.refine.allfilters?g=o.refine:a.refine&&(g.allfilters=e.clone(a.refine,!0));var v={};if(g.allfilters&&(g.localfilters||(g.localfilters=g.allfilters),n._preprocessDatasourceUriForTransformation(g),n._tagsTransformer.transformFilterSourceToProject(g),v={refine:g},m.addSourceSpecificParameterToFilterData(v)),e.is(v.source,"array")&&v.source.length>0&&(o.source=v.source),v.specific_source_parameter&&Object.keys(v.specific_source_parameter).forEach((function(e){var t=v.specific_source_parameter[e];t.additional_query&&l.addSourceSpecificParameter(o,{sourceIds:[e],param:{id:"additional_query",value:t.additional_query}})})),-1!==h.indexOf(l.SearchTypeEnum.MY_CONTENT)||-1!==h.indexOf(l.SearchTypeEnum.MY_RECENT_CONTENT))g&&g.localfilters&&g.localfilters.myContent&&delete g.localfilters.myContent,g&&g.allfilters&&g.allfilters.myContent&&delete g.allfilters.myContent,g&&g.localfilters&&g.localfilters.myRecentContent&&delete g.localfilters.myRecentContent,g&&g.allfilters&&g.allfilters.myRecentContent&&delete g.allfilters.myRecentContent,o.with_synthesis=!0;else{v.source&&v.source.length>0&&(o.source=v.source);var w=l.getQueryFromRefines(g.allfilters);if(w){var b=n._mergeQueries(h,w,"AND");b.length<_.getOption("ResultCategoryMaxQueryLength")?(h=b,g={}):o.with_synthesis=!0}}i[o.id]=t.method.call(n,{query:h,refine:g,specific_source_parameter:o.specific_source_parameter,with_synthesis_hierarchical:!1,select_file:o.select_file,nresults:t.nresults?t.nresults:o.nresults,order_by:o.order_by,order_field:o.order_field,source:o.source?e.is(o.source,"array")?o.source:[o.source]:[],select_predicate:e.is(t.select_predicate,"array")?t.select_predicate:o.select_predicate,select_snippets:o.select_snippets,tenant:t.tenant||n._getTenant(),with_synthesis:o.with_synthesis,with_info:!0,feature:t.feature},{id:o.id,nls:o.nls,iconInfo:e.is(o.iconInfo,"object")?o.iconInfo:void 0})}else c.log(o.source," source is not available in current active tenant")}))}return i},_getSearchResources:function(){var e=s.getSearchResources();return e&&new a(e)},_getAvailableSources:function(){var e=this._getSearchResources();return(e&&e.getActiveTenant()&&r.getAvailableSources(e.getActiveTenant())||[]).reduce((function(e,t){return e[t.name]=t,e}),{})},_getTenant:function(){var e=this._getSearchResources();return e&&e.getActiveTenant()},getResultCategoryUXHelper:function(){var e=this;return this._resultCategoryUxHelperPromise||(this._resultCategoryUxHelperPromise=new n((function(t,i){s.getSearchApiPromise().then((function(){var i=e._getTenant();p.getResultCategories(i).then((function(){r.login({tenantID:i,onComplete:function(){t()},onFailure:function(){t()}})}))}))}))),this._resultCategoryUxHelperPromise},getCategoryResultsCollectionPromise:function(t,i){return this._search(e.extend(i,{list:p.getActiveCategories(this._getTenant(),t),method:C._getResultCollectionPromise}))},getCategoryResultsPromise:function(t){return this._search(e.extend(t,{list:p.getActiveCategories(this._getTenant(),"result"),method:C._getResultPromise}))},_isGroupRefinable:function(t){var i={},n=t.object.predicates||[],s=t.object.operator||"OR",o=t.object.value;if("date"===t.type)return!1;for(var a=0;a<n.length;a++){if(e.is(o[a],"object"))return!1;var r=n[a];if(i[r.predicate]){if("AND"===s)return!1}else if(i[r.predicate]=[],Object.keys(i).length>1&&"OR"===s)return!1}return!0},_getGroupRefine:function(t,i){let n={};return!0===t.isComplex?e.is(t.object.predicates,"array")&&e.is(t.object.value,"array")&&t.object.predicates.length==t.object.value.length&&t.object.predicates.forEach((function(i,s){!n[i.predicate]&&(n[i.predicate]=[]),e.is(t.object.value[s],"array")?t.object.value[s].forEach((function(e){n[i.predicate].push({disptext:i.dispValue,field:["implicit"],object:e,type:i.type})})):n[i.predicate].push({disptext:i.dispValue?i.dispValue:t.dispText,field:["implicit"],object:t.object.value[s],type:i.type})})):e.is(t.object,"object")||(!n[i.predicate]&&(n[i.predicate]=[]),n[i.predicate].push({disptext:t.dispText,field:["implicit"],object:t.object,type:t.type})),{allfilters:n,localfilters:n}},_getQueryForDateRefine:function(t,i){var n="";if(e.is(i.from)){var s=new Date(i.from+" 00:00:00");n="["+t+']>="'+(s=new Date(s).toISOString())+'"'}if(e.is(i.to)){var o=new Date(i.to+" 23:59:59");n&&(n+=" AND "),n+="["+t+']<="'+(o=new Date(o).toISOString())+'"'}return n="("+n+")"},_getGroupQuery:function(t,i,n){let s,o=this,a="",r={};if("date"===t.type)if(e.is(t.predicate,"array"))t.predicate.forEach((function(e,i){var r=e.split("/").pop(),l=t.object[i];s=o._buildCountAndLengthFromDs6wModifiedFacets(l,n),a=o._getQueryForDateRefine(r,l)}));else{var l=i.predicate,c=t.object;s=o._buildCountAndLengthFromDs6wModifiedFacets(c,n),a=o._getQueryForDateRefine(l,c)}else{let i=t.object.predicates,n=t.object.value;e.is(i,"array")&&e.is(n,"array")&&i.length==n.length&&i.forEach((function(i,n){var s=i.predicate.split("/").pop(),o=t.object.value[n];r[s]||(r[s]=[]),e.is(o,"array")?o.forEach((e=>r[s].push(e))):r[s].push(o),a&&(a+=" "+t.object.operator+" "),a+=""}))}return Object.keys(r).forEach((function(i){var n=r[i],s="";n.forEach(((t,i)=>{s&&(s+=" OR "),s+='"'+(e.is(t,"array")?t.join("/"):t)+'"'})),n.length>1&&(s="("+s+")"),a&&(a+=" "+t.object.operator+" "),a+="["+i+"]:"+s})),s?(s.query=a,s):a},_getCategoriesFromGroups:function(t){var i=t.categories,n=t.ds6wModifiedFacets,s=this,o=[];return e.is(i.groups,"array")&&i.groups.forEach((function(t){e.is(t.object,"array")&&t.object.forEach((function(i){var a=e.extend({nls:i.dispText,icon:i.iconInfo?i.iconInfo:null,id:(new Date).getTime()+"-"+i.dispText},JSON.parse(v)),r=s._getGroupRefine(i,t);if(s._isGroupRefinable(i))a.refine=r,s._preprocessDatasourceUriForTransformation(r),s._tagsTransformer.transformFilterSourceToProject(r),m.addSourceSpecificParameterToFilterData(a);else{var l=s._getGroupQuery(i,t,n);a.query=l,a.falseRefine=r}o.push(a)}))})),o},_preprocessDatasourceUriForTransformation:function(e){e.allfilters&&e.allfilters["ds6w:dataSource"]&&(e.allfilters["ds6w:where/ds6w:source/ds6w:dataSource"]=e.allfilters["ds6w:dataSource"],delete e.allfilters["ds6w:dataSource"])},_buildSourceMapForWHAT:function(t){var i={};return e.is(t,"array")&&t.forEach((function(e){var t=e.sixw;i[t]=i[t]||{},i[t][e.object]=e.sources})),i},_buildCountAndLengthFromDs6wModifiedFacets:function(e,t){var i={};if(e.from&&e.to){var n=new Date(e.from),s=new Date(e.to);i.count=t?t.reduce(((e,t)=>{var i=new Date(t.object);return i>=n&&i<=s?e+t.count:e}),0):0,i.length=(s-n)/864e5+1,i.length>100&&(new Date).getFullYear()==s.getFullYear()&&(i.length-=100)}else if(e.from){n=new Date(e.from);i.count=t?t.reduce(((e,t)=>new Date(t.object)>=n?e+t.count:e),0):0,i.length=Number.MAX_VALUE}else if(e.to){s=new Date(e.to);i.count=t?t.reduce(((e,t)=>new Date(t.object)<=s?e+t.count:e),0):0,i.length=Number.MAX_VALUE}return i},getResultsCollections:function(t){var i,s=p.getActiveCategories(this._getTenant(),"result"),o=e.is(t.facets,"array")?t.facets.filter((e=>"ds6w:when/ds6w:modified"==e.sixw&&3==e.object.split("/").length)):void 0;if(t.categories){var a=this._getCategoriesFromGroups({categories:t.categories,ds6wModifiedFacets:o});a&&(s=a)}if(i=e.clone(s),t.facets){var r=this._buildSourceMapForWHAT(t.facets);let e=b.getItem("searchSort");s.forEach((function(t){if(UWA.is(e)?(t.order_field=e.order_field,t.order_by=e.order_by):(t.order_field="relevance",t.order_by="desc"),!(t.source&&t.source.length>0)){var i=[],n=t.refine;if(n||(n=t.falseRefine),n){var s=n.allfilters,o=!0;s&&(Object.keys(s).forEach((function(e){s[e].forEach((function(t){var n=t.object;r[e]&&r[e][n]?i=i.concat(r[e][n]):o=!1}))})),o&&(t.source=i.filter((function(e,t,i){return i.indexOf(e)==t}))))}}}))}var l=t,d=h.extend({_catCollections:{},_catCollectionsList:[],_catCollectionsPromiseList:[]},{setup:function(){this.state=this.state||{},this.state.firstPage=0,this.state.currentPage=-1,this.state.pageSize=t.pageSize||5,this.state.totalRecords=s.length,this.state.totalPages=Math.ceil(s.length/this.state.pageSize),this.state.lastPage=this.state.totalPages-1},getFirstPage:function(e){return this._parent(e)},fetch:function(t){var i=this,o=(t.to||this.state.currentPage)*this.state.pageSize,a=o+this.state.pageSize;a=a<s.length?a:s.length;for(var r,d=s.slice(o,a),u=C._search(e.extend(l,{list:d,method:C._getResultCollection,build_query_method:C._buildSearchQueryForResult,all_src:!0})),h=[],g=d.reduce(((e,t)=>(e[t.id]=t,e)),{}),p=0;p<d.length;p++)d[p].query&&d[p].query.query&&d[p].query.count&&(r&&r.query.length>d[p].query.length?r=d[p]:r||(r=d[p]));Object.keys(u).forEach((function(t,s){var a=u[t].collection;let d=u[t].nls;h.push(new n((function(n,u){l.noFetchWHENCountZero&&e.is(g[t].query)&&g[t].query.query&&r&&g[t]!=r?(a.setComputedResultCount(g[t].query.count),i.addCollection(t,a,o+s,d),n(a)):"#myRecentContent"===a.service_parameters.query?(a.setComputedResultCount(0),i.addCollection(t,a,o+s,d),n(a)):a.fetch({onComplete:function(e,a){i.add(e.toArray()),i.addCollection(t,e,o+s,d),n(e)},onFailure:function(e){c.log(e),i.addCollection(t,a,o+s,d),n(a)}})})))})),t.noWaitForCategoryCollections?(i._catCollectionsPromiseList=i._catCollectionsPromiseList.concat(h),t.onComplete.call(i,i)):n.all(h).then((function(){t.onComplete.call(i,i)}))},addCollection:function(t,i,n,o){if(i.headTitle=o,i.id=t,e.is(n)&&e.is(s[n])&&e.is(s[n].icon)&&(i.icon=s[n].icon),s[n].refine&&s[n].refine.allfilters)for(let t in s[n].refine.allfilters)e.is(s[n].refine.allfilters[t],"array")&&s[n].refine.allfilters[t].length>0&&(i.view={id:t,object:s[n].refine.allfilters[t][0].object});this._catCollections[t]=i,this._catCollectionsList[n]=i},getCategoryCollections:function(){return this._catCollections},getCategoryCollectionsList:function(){var e=this.state.currentPage*this.state.pageSize,t=e+this.state.pageSize;return t=t<s.length?t:s.length,this._catCollectionsList.slice(e,t)},getCategoryCollectionsPromiseList:function(){var e=this.state.currentPage*this.state.pageSize,t=e+this.state.pageSize;return t=t<s.length?t:s.length,this._catCollectionsPromiseList.slice(e,t)},getAllCategories:function(){return i}});return new d},_getResultCollection:function(t,i){var n=this,s=new g({feature:t.feature},{event:{onSetup:function(i){i.setOption("deactivateModelNLS",!0),i.setSearchRessources(n._getSearchResources()),t.nresults&&i.setPageSize(t.nresults);var s={query:t.query,refine:t.refine,with_synthesis:t.with_synthesis,with_synthesis_hierarchical:t.with_synthesis_hierarchical,select_predicate:t.select_predicate,select_snippets:t.select_snippets,select_file:t.select_file,source:t.source,ignoreRestrictedSources:!1};t.order_by&&t.order_field&&(s.order_by=t.order_by,s.order_field=t.order_field),e.is(t.source,"array")&&t.source.length>0&&t.specific_source_parameter&&t.specific_source_parameter[t.source[0]]&&l.addSourceSpecificParameter(s,{sourceIds:t.source,param:{id:"additional_query",value:t.specific_source_parameter[t.source[0]].additional_query}}),i.setRequestCriteria("fed_search",s),i._isCategoryHelperCollection=!0}}});return e.extend({collection:s},i)},_getViewAndCount:function(e){let t="tile";return this._CategoryViewMapping.view_mapping.category[e.category]&&(t=this._CategoryViewMapping.view_mapping.category[e.category]),{view:t,item_count:this._CategoryViewMapping.item_count[t]}},getViewMapping:function(t){var i={},n=t;e.is(n,"array")||(n=[t]);var s=this;return n.forEach((function(e){let t=s._getViewAndCount(e);!i[e.nls]&&(i[e.nls]={}),i[e.nls]=t})),i},_mergeQueries:function(e,t,i){var n="";return e&&t?n="("+e+") "+i+" ("+t+")":e?n=e:t&&(n=t),n}});return C})),define("DS/SNResultUX/collections/UXCollection",["UWA/Core","DS/SNResultUX/collections/SearchCollection","UWA/Class/Options","UWA/Class/Events","UWA/Promise","DS/SNInfraUX/SearchDebug","DS/SNInfraUX/SearchViewServices","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/Logger","DS/SNResultUX/utils/ResultCategoryUXHelper","DS/FedDictionaryAccess/FedDictionaryAccessAPI"],(function(e,t,i,n,s,o,a,r,l,c,d){"use strict";return t.extend({_catCollections:{},generateTreeModel:function(){let e=this;setTimeout((function(){{function s(e){for(var t=e.concat(),i=0;i<t.length;++i)for(var n=i+1;n<t.length;++n)t[i]===t[n]&&t.splice(n--,1);return t}var t=a.getAllSelectClause(true),i=s(e._required_predicates.concat(t)),n=e.getNotLoadedPredicate(i);n.length>0&&d.getResourcesInfo(n.join(","),{tenantId:e.search_ressources.active_tenant,lang:r.getLanguage(),apiVersion:"R2019x",onComplete:function(t){t&&e.saveNLS_ds6wg(t),e.asyncUpdateModels_predicate()},onFailure:function(t){t&&e.saveNLS_ds6wg(t),e.asyncUpdateModels_predicate()}})}e._asyncUpdateModels(),e.generateTreeModelAsync().then((function(){e.dispatchEvent("onInitTreeDocument_SelectFirstElt",e._treeDocument),e.dispatchEvent("onInitTreeDocumentAsyncCB")}))}),50)},_getPreviewDefinition:function(i){let n=null;
//!UWACore.is(ResultCategoryUXHelper.ResultPreviewDefinition) &&
c.SearchCollection=t;try{n=c._search(e.extend(i,{list:c.ResultPreviewDefinition.result.list,method:c._getResultCollection}))}catch(e){l.log("[UXCollection 01] - "+e.message)}return n},fetch:function(e){let t=this,i=[];e.search_text=this.service_parameters.query;let n=this._getPreviewDefinition(e);this.resetCollection(),this._fedsearchOptions={},Object.keys(n).forEach((function(e){var o=n[e].collection;i.push(new s((function(i){o.fetch({onComplete:function(n){t.add(n.toArray()),t.addCollection(e,n),i()},onFailure:function(n){l.log(n),t.addCollection(e,o),i()}})})))})),s.all(i).then((function(){e.onComplete.call(t,t)}))},resetCollection:function(){this._catCollections={}},addCollection:function(e,t){this._catCollections[e]=t},getCategoryCollections:function(){return this._catCollections}})})),define("DS/SNResultUX/utils/SearchTagger",["UWA/Core","UWA/Class","UWA/Class/Debug","DS/SNResultUX/collections/SearchCollection","DS/SNInfraUX/SearchSettings"],(function(e,t,i,n,s){"use strict";return t.extend(i,{_snResultMgt:null,init:function(e){this._snResultMgt=e},destroy:function(){},onLoadMoreTags:function(e){this.onLoadMoreData(e)},onLoadMoreData:function(t){var i=this._snResultMgt.getCollection(),n=i.getTaggerProxy();if(n){var o=this;if(t){var a=e.clone(i.getLastFetchOptions(),!0),r=e.is(a.data,"string")?JSON.parse(a.data):a.data,l=i.getCloneCollection();l._isTagSearchCollection=!0,l.setTagsTransformer(i._tagsTransformer),r.label=r.label+"-"+s.getOption("onLoadMoreTags"),r.query=r.query+" AND "+t,a.data=JSON.stringify(r),a.onComplete=function(e){e._taggerDataPromise.promise.then((function(){e._helpertagValues=o._mergeOldAndNewTagValuesSearchInTag(n.latest_tagValues,e._helpertagValues||[]),e._setTags(n.latest_subjectsTags,e._helpertagValues)}))},l.fetch({fetchWithOptions:a})}else i._setTags(n.latest_subjectsTags,n.latest_tagValues)}else console.log("Error: -> Tagger proxy not avalable for Tag Search.")},_mergeOldAndNewTagValuesSearchInTag:function(e,t){const i=[...e,...t];let n=new Set;return i.filter((e=>{let t=JSON.stringify({sixw:e.sixw,field:e.field,object:e.object});return!n.has(t)&&(n.add(t),!0)}))}})})),define("DS/SNResultUX/views/helpers/utils/TimeLines/Abstract",["UWA/Core","UWA/Class/View","DS/SNResultUX/utils/SearchServices","DS/SNInfraUX/SearchDebug","DS/Controls/Slider","DS/Controls/ProgressBar","DS/Controls/Button","DS/Controls/Popup","DS/UIKIT/Alert","DS/MessageBus/MessageBus","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],(function(e,t,i,n,s,o,a,r,l,c,d){"use strict";return t.extend(n,{tagName:"div",className:"search-timeLine",data:[],timeLineApplyIcon:null,data:null,setLocalFilter:null,rerenderMultiView:null,container:null,timeLineScroller:null,collection:null,alert:null,init:function(e){return this.timeLineApplyIcon=null,this.data=null,this.setLocalFilter=null,this.rerenderMultiView=null,this.container=null,this.timeLineScroller=null,this.collection=null,this._parent(e)},existAlready:function(){return null!==this.container.querySelector(".search-timeLine-content")},_getStatistic:function(e,t){let i=e.map((e=>e.count)).reduce(((e,t)=>e+t),0);return e.find((e=>e.label===t)).count/i*100},_clickOnTitle:function(e){},_getTimeLineTitle:function(){},_backAction:function(){},updateScrollerRange:function(e){0!==e.length&&(this.timeLineScroller.maxValue=e.length-1,this.timeLineScroller.value=[0,e.length-1],c.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"refinementWithTimeLineScroller"}}))},setVisibility:function(e){const t=this.container.querySelector(".search-timeLine-container");e?t.classList.remove("hidden"):t.classList.add("hidden")},render:function(){},reset:function(){this.timeLineApplyIcon&&this.timeLineApplyIcon.destroy(),this.timeLineScroller&&this.timeLineScroller.destroy(),this.alert&&this.alert.destroy(),this.container.empty(!0)},destroy:function(){this.reset(),this._parent()}})})),define("DS/SNResultUX/views/helpers/utils/TimeLines/TimeLinePresenter",["UWA/Core","DS/SNResultUX/views/helpers/utils/TimeLines/Abstract","DS/SNResultUX/views/helpers/utils/TimeLines/TimeLineDate","DS/SNInfraUX/SearchDebug","DS/SNInfraUX/SearchUtils","DS/SNResultUX/utils/SearchServices","DS/Controls/Slider","DS/Controls/ProgressBar","DS/Controls/Popup","DS/Controls/DatePicker","DS/Controls/Button","DS/MessageBus/MessageBus","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],(function(e,t,i,n,s,o,a,r,l,c,d,u,h){"use strict";return t.extend(n,{_timeLineDate:null,_aDates:null,_timeLinePresenterContainer:null,_timeLineDateContainer:null,data:null,setLocalFilter:()=>{},rerenderMultiView:()=>{},_aDates:null,getLocalFilters:()=>{},init:function(e){this.reset(),this._parent(e),this.parseAndFormatData(e.data),this.setLocalFilter=e.setLocalFilter,this.rerenderMultiView=e.rerenderMultiView,this._aDates=e.aDates,this.getLocalFilters=e.getLocalFilters},parseAndFormatData:function(e){e.forEach((e=>e.label=e.label.replace("&#x27;","'"))),this.data=e},existAlready:function(){return null!==this.container.querySelector(".search-timeLinePresenter-content-object")},_getStatistic:function(e,t){let i=e.map((e=>e.count)).reduce(((e,t)=>e+t),0);return 0===i?0:e.find((e=>e.label===t)).count/i*100},_retrieveCurrentDateFilters:function(){let t=[],i=this.getLocalFilters();if(i&&i.allfilters&&e.is(i.allfilters.condition,"array"))for(let n=0;n<i.allfilters.condition.length;n++)i.allfilters.condition[n]["sixw:ds6w:when/ds6w:modified"]&&e.is(i.allfilters.condition[n]["sixw:ds6w:when/ds6w:modified"],"array")&&"date"===i.allfilters.condition[n]["sixw:ds6w:when/ds6w:modified"][0].type&&(t=t.concat(i.allfilters.condition[n]["sixw:ds6w:when/ds6w:modified"][0]));return t},_renderTimeLine:function(t,i){let n=this;null!==document.querySelector(".search-timeLine-content")&&document.querySelector(".search-timeLine-content").destroy();let s=e.createElement("div",{class:"search-timeLine-content"}),o=this._retrieveCurrentDateFilters();return t.forEach((i=>{let a=o.filter((e=>e.displayValue===i.label)),c=e.createElement("div",{class:"search-timeLine-content-index"+(a.length>0?" filtered":"")});e.createElement("p",{class:"search-timeLine-content-index-title",content:i.label,"data-context-type":""}).inject(c);let d=n._getStatistic(t,i.label);new l({target:c,trigger:"hover",offset:{x:40,y:20},mouseRelativePosition:!0}).setBody(i.label+" "+Math.round(d)+"%"),c.addEventListener("click",(e=>{let i=t.find((t=>t.label===e.currentTarget.innerText));n._clickOnTitle(i)})),new r({shape:"linear",value:d,gradientAnimationFlag:!1,displayStyle:"lite"}).inject(c).elements.container.classList.add(d),c.inject(s)})),s},_clickOnTitle:function(e){let t=new Date,i=new Date;switch(s.setDateDay(i,1),t.setHours(0,0,0,0),i.setHours(0,0,0,0),e.index){case 0:this.setLocalFilter({dispText:e.label,object:{from:s.formatDate(new Date(e.startDate),"yyyy/MM/dd",{year:"numeric",month:"2-digit",day:"2-digit"}),to:s.formatDate(new Date(e.endDate),"yyyy/MM/dd",{year:"numeric",month:"2-digit",day:"2-digit"})},type:"date"});break;case 1:this.fromDateInput.value=i,this.toDateInput.value=t,this._showTimeLineDate("week");break;case 2:this.fromDateInput.value=new Date(t.getFullYear(),t.getMonth(),1),this.toDateInput.value=t,this._showTimeLineDate("month");break;case 3:this.fromDateInput.value=new Date(t.getFullYear(),0,1),this.toDateInput.value=t,this._showTimeLineDate("year");break;case 4:this.fromDateInput.value=new Date(t.getFullYear()-1,0,1),this.toDateInput.value=new Date(t.getFullYear(),0,0),this._showTimeLineDate("lastYear");break;default:this.fromDateInput.value=new Date(1970,1,1),this.toDateInput.value=new Date(t.getFullYear()-1,0,0),this._showTimeLineDate("older")}},_showTimeLineDate:function(e){let t=this;null!==this._timeLineDate&&this._timeLineDate.destroy(),this._timeLineDate=new i({data:this._aDates,dispayState:this._timelineDisplay,container:this._timeLineDateContainer,type:e,setLocalFilter:e=>{t.setLocalFilter(e)},backActionCB:()=>{t._displayPresenter()}}),this._timeLineDate.render(),this._hidePresenter()},_hidePresenter:function(){this._timeLinePresenterContainer.style.display="none",this._timeLineDateContainer.style.display=""},_displayPresenter:function(){this._timeLinePresenterContainer.style.display="",this._timeLineDateContainer.style.display="none";let e=new Date;this.fromDateInput.value=e,this.toDateInput.value=e},setVisibility:function(e){const t=this.container.querySelector(".search-timeLine-container");e?t.classList.remove("hidden"):t.classList.add("hidden")},_renderFromToForm:function(){let t=this;this.inputDiv=e.createElement("div",{class:"search-fromToInput"}).inject(this.container);let i=e.createElement("div",{id:"from-input-container",class:"search-input-container"}).inject(this.inputDiv);this.fromDateInput=new c({}).inject(i);let n=e.createElement("div",{id:"to-input-container",class:"search-input-container"}).inject(this.inputDiv);this.toDateInput=new c({}).inject(n),this.timeLineApplyIcon=new d({emphasize:"primary",label:h.get("APPLYButton"),disabled:!1}).inject(this.inputDiv),this.timeLineApplyIcon.getContent().addEventListener("buttonclick",(()=>{if(null===t.fromDateInput.value&&null===t.toDateInput.value)o._displayAlert({message:h.get("timeline.error.undefinedInput"),className:"error"});else if(t.fromDateInput.value>t.toDateInput.value)o._displayAlert({className:"error",message:h.get("timeline.error.invalidInput")});else{let e=s.formatDate(t.fromDateInput.value,"en-US"),i=s.formatDate(t.toDateInput.value,"en-US");t.setLocalFilter({dispText:e+" - "+i,object:{from:e,to:i},type:"date"})}}))},render:function(){this.reset(),this._timeLinePresenterContainer=e.createElement("div",{class:"search-timeLinePresenter-content-object"}),this._timeLinePresenterContainer.inject(this.container),this._timeLineDateContainer=e.createElement("div",{class:"search-timeLinePresenter-timeLineDate-content-object"}),this._timeLineDateContainer.style.display="none",this._timeLineDateContainer.inject(this.container);let t=e.createElement("div",{class:"search-timeLinePresenter-content-object-list"}).inject(this._timeLinePresenterContainer);this._renderTimeLine(this.data).inject(t),this._renderFromToForm()},reset:function(){this.fromDateInput&&this.fromDateInput.destroy(),this.toDateInput&&this.toDateInput.destroy(),this.inputDiv&&this.inputDiv.destroy(),this._timeLineDateContainer&&this._timeLineDateContainer.destroy(),this._timeLinePresenterContainer&&this._timeLinePresenterContainer.destroy(),this.container&&this.container.empty(!0)},destroy:function(){this.reset()&&this._parent()}})})),define("DS/SNResultUX/utils/SearchSortView",["UWA/Core","UWA/Class/Debug","UWA/Class","UWA/Controls/Abstract","UWA/Promise","DS/MessageBus/MessageBus","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchCom","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchControlCenterFetchService","DS/SearchControlCenter/scripts/SearchControlCenterServices","DS/WebappsUtils/Performance","DS/SNResultUX/utils/SearchServices","DS/SNResultUX/utils/SearchMultiSort","DS/SNResultUX/utils/SearchCustoServices","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/UIKIT/Iconbar","DS/UIKIT/Dropdown","DS/UIKIT/Input/Button","DS/FedDictionaryAccess/FedDictionaryAccessAPI","UWA/Element","DS/Controls/ComboBox","DS/Controls/Popup"],(function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_,f,m,S,v,w,b,C,y,D){"use strict";return n.extend(t,{_searchcom_socket:null,_view:null,view:null,sortOptionArray:null,_viewTitleBox:null,_container:null,_body:null,_defaultItem:[{dataIndex:"ds6w:modified",type:"num",order:"desc"},{dataIndex:"ds6w:modified",type:"num",order:"asc"},{dataIndex:"ds6w:label",type:"alpha",order:"asc"},{dataIndex:"ds6w:label",typ:"alpha",order:"desc"},{dataIndex:"ds6w:type",type:"type"}],_adminSort:!1,_isSorted:!1,_selectedIndex:0,_selectedValue:null,_updateList:!1,_listItemExtend:[],_activedItem:"",_activedItemId:"",_activedItemOrder:"",_menuIcon:"",_menuText:"",_sortItemExtendNls:"",_subscriptions:null,_nlsPromises:{},_multisortPanel:null,init:function(t){var i=u._searchControlCenterSettingsJSONFromDB;l.getOption("enableMultiSort-FUN096610")&&this._defaultItem.push({dataIndex:"multisort",type:"object",class:_}),this._parent(t),this._subscriptions={};var n=this;if(this._viewTitleBox=null,this._searchcom_socket||(this._searchcom_socket=c.createSocket({socket_id:"sortView_socket_"+g.now(),widgetId:t.widgetId}),this._subscriptions.setOrderInGridView=o.subscribe({channel:n.getOption("messagingChannel"),topic:"setOrderInGridView",callback:this.setOrderByExt.bind(this)}),this._subscriptions.addSortItem=o.subscribe({channel:n.getOption("messagingChannel"),topic:"addSortItem",callback:this.updateRenderByExt.bind(this)}),this._searchcom_socket&&this._searchcom_socket.addListener("checkNewColomnForSort",this.checkNewColumnForSort.bind(this))),t&&t.container){if(this._container=t.container,this._collection=t.collection,this.options=t,!t.defaultSort)if(d.getItem("search_keepColumnSorting")&&e.is(d.getItem("searchSort"))){let e=d.getItem("searchSort");this.options.defaultSort={dataIndex:e.order_field,order:e.order_by,type:e.order_type,label:e.order_label}}else if(e.is(i.search_settings)&&i.search_settings.hasOwnProperty("searchDefaultSort")){var s=i.search_settings.searchDefaultSort;if(this._adminSort=!0,e.is(s,"object")&&e.is(s.value,"string")&&e.is(s.type,"string")){let e="";e="ds6w:relevancy"===s.value?"desc":"ds6w:type"===s.value?"asc":s.order,this.options.defaultSort={dataIndex:s.value,order:e,type:s.type,label:s.label}}}else l.getOption("apply_sort_on_modified_by_default")?this.options.defaultSort={dataIndex:"ds6w:modified",order:"desc",type:"num"}:(this.options.defaultSort={dataIndex:"relevance",order:"desc",type:"pertinency"},this._selectedIndex=0,this._activedItem="relevance");n._setByDefaultSort()}},_getSortOptionsArray:function(){var e=this;e._promiseVocabNLS("ds6w"),s.all(e._getNLSPromises()).then((function(){return e._getBody()}),(function(){return e._getBody()}))},_applyAdminSort:function(){if(this._adminSort){const{dataIndex:e,order:t}=this.options.defaultSort;o.publish({channel:this.getOption("messagingChannel"),topic:"sortForAllView",data:{order_field:e,order_by:t,isRecent:!1,order_label:""}})}},render:function(){var t=this;this._body=t._getBody(),this._selectedIndex=this._body.findIndex((e=>t._getIdByTypeIndexAndOrder(e.type,e.dataIndex,e.order)===t._getIdByTypeIndexAndOrder(t.options.defaultSort.type,t.options.defaultSort.dataIndex,t.options.defaultSort.order))),this._applyAdminSort(),this.view=new y({enableSearchFlag:!1,elementsList:t._body,id:"sortDropdown",selectedIndex:t._selectedIndex,touchMode:!0,popupSizeAdjustPolicy:D.SizeAdjustPolicyEnum.AdjustToVisibleContents,getMainElementCustomization:t.updateSortLabelCallback,mainElementContent:"all"}).inject(this._container),this.view.addEventListener("change",(function(i){if(!t._updateList){var n=i.dsModel,s=n.elementsList[n.selectedIndex],r=s.label,l=this;if(s.id&&t._allowSort(s.dataIndex))if("multisort"===s.dataIndex)t._multisortPanel=new _({_parentContainer:t._container,_availableFields:f.getColumnCustomizationDefinitionFromCustoId("The_Default_Columns"),_order:e.is(t._activedItemOrder,"array")?t._activedItemOrder:[],_dataIndex:e.is(t._activedItem,"array")?t._activedItem:[],sortCallback:function(e,i){t._activedItem=e+"-"+i,t._activedItemOrder=i,t._activedItemId=s.id,t._setTitleBoxContent(r,i),l.options.target.children[0].className=s.querySelector(".item-text.item-icon-group span").className;var c=t._collection.service_parameters.query===a.SearchTypeEnum.MY_RECENT_CONTENT;o.publish({channel:t.getOption("messagingChannel"),topic:"sortForAllView",data:{order_field:e,order_by:i,isRecent:c,order_label:s.textContent,selectedIndex:n.selectedIndex}})}}),t._multisortPanel.addEvent("onCloseMultisortPanel",(function(){e.is(t._multisortPanel)&&e.is(t._multisortPanel.destroy,"function")&&t._multisortPanel.destroy()&&(t._multisortPanel=null)}));else{t._activedItem=s.dataIndex+"-"+s.order,t._activedItemOrder=s.order,t._activedItemId=s.id,t._selectedIndex=n.selectedIndex,t._setTitleBoxContent(r,s.order);var c=t._collection.service_parameters.query===a.SearchTypeEnum.MY_RECENT_CONTENT;o.publish({channel:t.getOption("messagingChannel"),topic:"sortForAllView",data:{order_field:s.dataIndex,order_by:s.order,isRecent:c,order_label:r,order_type:s.type,order_index:n.selectedIndex}}),t._isSorted=!0}}}))},updateSortLabelCallback:function(){const e=this.elementsList[this.selectedIndex];return e&&e.trueLabel?{label:e.trueLabel}:{label:this.currentLabel}},_setTitleBoxContent:function(t,i){this.view&&(this._selectedIndex=this.view.elementsList.findIndex((e=>e.label===t&&e.order===i)),this.view.currentValue=t);let n=this.getOption("collection").getTaggerProxy();n&&e.is(n.setEmbeddedViewProperties,"function")&&n.setEmbeddedViewProperties({rootw:{allw:{subLabel:m.replace(m.get("sortBy"),{criteria:t.toLowerCase(),sortType:"desc"===i?m.get("tooltip_SortDesc").toLowerCase():m.get("tooltip_SortAsc").toLowerCase()})}}})},_promiseVocabNLS:function(t){this._nlsPromises[t]||(this._nlsPromises[t]=new s((function(i,n){r.loadVocabulary(t,(function(t){e.is(t)&&"success"===t.status?i():n()}))})))},_promisePredicateNLS:function(t,i){const n="asc"===i?m.get("order_alpha_SortAsc"):m.get("order_alpha_SortDesc");var o=this;"ds6w"!==r.getVocabId(t)&&(this._nlsPromises[t]=new s((function(i){var s="",r=o.getOption("collection");e.is(r)&&e.is(r.search_ressources)&&e.is(r.search_ressources.getActiveTenant,"function")&&(s=r.search_ressources.getActiveTenant()),b.getResourcesInfo(t,{tenantId:s,lang:a.getLanguage(),apiVersion:"R2019x",onComplete:function(s){if(e.is(s,"array")&&s.length>0)for(var a=0;a<o._listItemExtend.length;a++)o._listItemExtend[a].dataIndex===t&&(o._listItemExtend[a].nlsName=s[0].label+" "+n);i()},onFailure:i})})))},_getItemNlsWithPromisePredicateNLS:function(t,i){const n="asc"===i?m.get("order_alpha_SortAsc"):m.get("order_alpha_SortDesc");let o="";var l=this;return"ds6w"!==r.getVocabId(t)&&(this._nlsPromises[t]=new s((function(i){var s="",r=l.getOption("collection");e.is(r)&&e.is(r.search_ressources)&&e.is(r.search_ressources.getActiveTenant,"function")&&(s=r.search_ressources.getActiveTenant()),b.getResourcesInfo(t,{tenantId:s,lang:a.getLanguage(),apiVersion:"R2019x",onComplete:function(t){e.is(t,"array")&&t.length>0&&(o=t[0].label+" "+n),i()},onFailure:i})}))),o},_getNLSPromises:function(){var e=this;return Object.keys(e._nlsPromises).map((function(t){return e._nlsPromises[t]}))},updateStateInPanel:function(){if(this.getDropdown())for(var e=this.getDropdown().elements.container.children[0].children,t=0;t<e.length;t++)e[t].removeClassName("sortActived"),e[t].removeClassName("selected"),e[t].id===this._activedItemId&&(e[t].addClassName("sortActived"),e[t].addClassName("selected"))},updateMenu:function(){this._i=this._i?this._i+1:1;var e=this;setTimeout((function(){if(0!==e._i){e._i=0;const i=e.getDropdown();if(i){var t=e._selectedIndex;e._updateList=!0,i.elementsList=e._getBody(),e._updateList=!1,e._activedItemId&&(t=i.elementsList.findIndex((t=>e._getIdByTypeIndexAndOrder(t.type,t.dataIndex,t.order)===e._activedItemId))),i.selectedIndex=t,e._selectedIndex=t}else e.render()}}),1e3)},reinitMenu:function(){this._hide(),this.emptyItemExtend(),l.getOption("search_web_in_win")||this._setByDefaultSort(),this.getDropdown()&&(this.getDropdown().elementsList=this._getBody())},getDropdown:function(){return this.view?this.view:void 0},_hide:function(){},_getBody:function(){return this._body=[],this._initDefaultItems(),this._addFromListExtend(),this._selectedIndex=Math.min(this._selectedIndex,this._body.length),this._body},addItemExtend:function(e){var t=this,i=this._listItemExtend.map((function(e){return e.dataIndex+"-"+e.order}));(Array.isArray(e)?e:[e]).forEach((function(e){-1===i.indexOf(e.dataIndex+"-"+e.order)&&(t._listItemExtend.push(e),t._promisePredicateNLS(e.dataIndex,e.order))}))},removeItemExtend:function(e){var t=this._listItemExtend.map((function(e){return e.dataIndex})),i=[];(Array.isArray(e)?e:[e]).forEach((function(e){-1!==t.indexOf(e.dataIndex)&&i.push(e.dataIndex)})),this._listItemExtend=this._listItemExtend.filter((function(e){return-1===i.indexOf(e.dataIndex)}))},emptyItemExtend:function(){this._listItemExtend=[]},_allowSort:function(e){if(this._collection.state.totalRecords<=1e3)return!0;switch(e){case"relevance":case"ds6w:label":case"ds6w:who/ds6w:responsible":case"ds6w:when/ds6w:created":case"ds6w:when/ds6w:modified":case"ds6w:responsible":case"ds6w:created":case"ds6w:modified":return!0;default:return p._displayAlert({message:m.get("sortLimitByLessThen1000Results"),className:"warning"}),!1}},_setByDefaultSort:function(){if(!this.options.defaultSort||!this.options.defaultSort.dataIndex)return;const{type:e,dataIndex:t}=this.options.defaultSort;let i=this.options.defaultSort.order,n="";"num"===e?n="asc"===i?"1-31":"31-1":"alpha"===e&&(n="asc"===i?"a-z":"z-a"),this._activedItemId=this._getIdByTypeIndexAndOrder(e,t,i),this._activedItem=`${t}-${i}`,this._activedItemOrder=i;let s="ds6w:relevancy"===t&&a.isInTheSimpleSearch()?m.get("relevancySort"):this._getTextByDataIndexAndOrder(t,i);this._setTitleBoxContent(s,i)},_setOrder:function(t,i,n){var s=this;if(e.is(t,"array")||e.is(n,"array"))return;let a=n===this._activedItemOrder;this._activedItemId=this._getIdByTypeIndexAndOrder(i,t,n),this._activedItem=`${t}-${n}`,this._activedItemOrder=n,this._selectedValue=`${t}${n}`;const r=this.getDropdown();if(e.is(r)&&(this._selectedIndex=r.elementsList.findIndex((e=>s._getIdByTypeIndexAndOrder(e.type,e.dataIndex,e.order)===s._activedItemId)),this._selectedIndex>=0)){const e=this._selectedIndex===r.selectedIndex;r.selectedIndex=this._selectedIndex,e&&!a&&o.publish({channel:this.getOption("messagingChannel"),topic:"sortForAllView",data:{order_field:t,order_by:n,bForceNotReload:!0}})}},_setMenuButton:function(e,t){},_setMenuIcon:function(e){},setOrderByExt:function(e){this.updateRenderByExt(e),!e.bNoSortRefresh||e.bNoSortRefresh},setOrderByExtExplicit:function(e){this._activedItem=e.order_field+"-"+e.order_by,this._activedItemOrder=e.order_by,this._activedItemId=e.id,this.updateMenu(),o.publish({channel:this.getOption("messagingChannel"),topic:"sortForAllView",data:{order_field:e.order_field,order_by:e.order_by,order_label:e.textContent}})},updateRenderByExt:function(t){var i;(this._hide(),t.order_field&&t.order_by)&&((i="relevance"===t.order_field?{dataIndex:"relevance",type:"pertinency",order_by:t.order_by}:(i=this._defaultItem.filter((function(e){return-1!==e.dataIndex.indexOf("/")?e.dataIndex.split("/")[1]===t.order_field:e.dataIndex===t.order_field})))?i[0]:"")?this._setOrder(i.dataIndex,i.type,t.order_by):(e.is(t.order_field,"array")||e.is(t.order_by,"array")||(t.nlsName?this.addItemExtend({dataIndex:t.order_field,nlsName:t.nlsName,order:t.order_by}):this.addItemExtend({dataIndex:t.order_field,order:t.order_by})),this._setOrder(t.order_field,"",t.order_by),this._selectedValue=t.order_field+t.order_by,this.updateMenu()))},checkNewColumnForSort:function(e){var t=this;if(Array.isArray(e)){if(e.length>0){var i=e.map((function(e){return e.dataIndex})),n=this._defaultItem.concat(this._listItemExtend),s=[];n.forEach((function(e){-1===i.indexOf(e.dataIndex)&&s.push(e.dataIndex)})),t._defaultItem=t._defaultItem.filter((function(e){return-1===s.indexOf(e.dataIndex)})),t._listItemExtend=t._listItemExtend.filter((function(e){return-1===s.indexOf(e.dataIndex)})),-1!==s.indexOf(t._activedItem)&&t._setByDefaultSort()}else this._listItemExtend=[];this.updateMenu()}},_addFromListExtend:function(){var e=this,t=this._defaultItem.map((function(e){return e.dataIndex})),i=t.filter((function(e,i){return t.indexOf(e)===i}));this._listItemExtend.forEach((function(t){-1===i.indexOf(t.dataIndex)&&e._addItem(t.dataIndex,t.type,t.nlsName,t.order)}))},_addItem:function(e,t,i,n){const s="multisort"===e?m.get("multiSort"):i||"",o="asc"===n?"SortAsc":"SortDesc";let a={};switch(a.id=e,a.dataIndex=e,a.order=n,a.type=t,t){case"alpha":a.id+=`-${n}`;const i=m.get(`tooltip_alpha_${o}`);a.label=m.get("sort_by")+" "+(s||m.get(`${e}_${o}`)||r.getNLSValueForPredicate(e)),a.trueLabel=s||m.get(`${e}_${o}`)||r.getNLSValueForPredicate(e),a.icon=this._getIconByTypeAndOrder(t,n),a.description=i;break;case"num":const l="asc"===n?"-asc":"-desc",c="asc"===n?"SortAsc":"SortDesc",d=m.get("tooltip_num_"+c);a.id+=l,a.label=m.get("sort_by")+" "+(s||m.get(`${e}_${o}`)||r.getNLSValueForPredicate(e)),a.trueLabel=s||m.get(`${e}_${o}`)||r.getNLSValueForPredicate(e),a.icon=this._getIconByTypeAndOrder(t,n),a.description=d;break;case"group":a.order="asc",a.id+="-group",a.label=m.get("sort_by")+" "+s,a.trueLabel=s,a.icon=this._getIconByTypeAndOrder(t,orderNum),a.description=m.get("tooltip_SortGroup");break;case"pertinency":a.order="desc",a.id+="-group",a.label=m.get("sort_by")+" "+s,a.trueLabel=s,a.icon=this._getIconByTypeAndOrder(t,"asc"),a.description=m.get("tooltip_relevancy");break;case"type":a.order="asc",a.id+="-group",a.label=m.get("sort_by")+" "+(s||m.get(e)||r.getNLSValueForPredicate(e)),a.trueLabel=s||m.get(e)||r.getNLSValueForPredicate(e),a.icon=this._getIconByTypeAndOrder(t),a.description=m.get("tooltip_type");break;case"object":a.order="asc",a.id+="-group",a.label=s,a.icon=this._getIconByTypeAndOrder(t,"asc"),a.description=m.get("tooltip_SortGroup");break;default:"ds6w:created"!==e||t||(t="num");const u="asc"===n?"-asc":"-desc",h=("asc"===n?m.get("order_alpha_SortAsc"):m.get("order_alpha_SortDesc"),"asc"===n?"SortAsc":"SortDesc");a.id+=u,a.label=m.get("sort_by")+" "+(s||this._getTextByDataIndexAndOrder(e,n)),a.trueLabel=s||this._getTextByDataIndexAndOrder(e,n),a.icon=this._getIconByTypeAndOrder(t,n),a.description=m.replace(m.get("tooltip_"+h),{label:s||r.getNLSValueForPredicate(e)})}this._body&&(a.index=this._body.length,this._body.push(a))},_getIconByTypeAndOrder:function(e,t){const i="asc"===t?"a-z":"z-a";switch(e){case"alpha":return"alpha-sorting-"+i;case"num":return"date-sorting-"+("asc"===t?"1-31":"31-1");case"group":case"type":return"tag-sorting";case"object":return"list";case"pertinency":return"sorting";default:return t?"alpha-sorting-"+i:"alpha-sorting-a-z"}},_getTextByDataIndexAndOrder:function(e,t){this._promiseVocabNLS("ds6w");const i="asc"===t,n=e+(i?"_SortAsc":"_SortDesc"),s=i?m.get("order_alpha_SortAsc"):m.get("order_alpha_SortDesc");let o=this._getNlsKey(e)||this._getNlsKey(n)||this._getItemNlsWithPromisePredicateNLS(e,t);return"relevance"===e?o=m.get("relevancySort"):o&&o!==e||(o=r.getNLSValueForPredicate(e)+" "+s),o},_getNlsKey:function(e){return m.get(e)===e?"":m.get(e)},_getIdByTypeIndexAndOrder:function(e,t,i){switch(e){case"group":case"type":return t+"-group";case"pertinency":return"relevance"===t?t+"-group":t+"-"+i;default:return"ds6w:type"===t?t+"-group":t+"-"+i}},_initDefaultItems:function(){var t=this,i=[];e.is(this._collection)&&e.is(this._collection.service_parameters,"object")&&this._collection.service_parameters.query!==a.SearchTypeEnum.MY_RECENT_CONTENT&&i.push({dataIndex:"relevance",type:"pertinency",nls:a.isInTheSimpleSearch()?m.get("relevancySort"):m.get("defaultSort")}),i.concat(this._defaultItem).forEach((function(e){t._addItem(e.dataIndex,e.type,e.nls,e.order)}))},destroy:function(){this._searchcom_socket.removeListener("checkNewColomnForSort"),this._searchcom_socket.disconnect(),c.deleteSocket(this._searchcom_socket.id),this._searchcom_socket=null,e.is(this._view)&&e.is(this._view.destroy,"function")&&(this._view.destroy(),delete this._view),this._viewTitleBox=null,this._parent()}})})),define("DS/SNResultUX/SearchPQListUX",["UWA/Core","UWA/Class","UWA/Element","DS/UIKIT/Autocomplete","UWA/Promise","DS/SNInfraUX/Logger","DS/SNInfraUX/PredefinedQueries","DS/SNInfraUX/SearchDebug","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/SNResultUX/utils/ExternalComponentHelpers"],(function(e,t,i,n,s,o,a,r,l,c){"use strict";var d=n.extend({getSuggestions:function(e){u.filterPQs(e)},onHideSuggests:function(){""===this.elements.input.value&&u.filterPQs("")},reset:function(e){u.filterPQs(""),this._parent(e)}}),u=t.singleton(r,{abbreviationsList:[],lAbbreviationsList:[],labelList:[],llabelList:[],liList:[],PQs:[],PQUxPC:s.deferred(),init:function(){},showPQSelector:function(t){var n=t.pqSelectionCallback,s=t.pqAccessMap,r=this;this.PQUxBuilding?void 0!==r.pqModalDialog&&c.getModal("search-pq-help-panel").show():(this.PQUxBuilding=!0,a.getPQFetchPromise().then((function(){r.pqSelectionHandler=n,r.pqAccessMap=s;var t=a.getPQs(),l=a.getPQNLS();if(e.is(t)&&e.is(l)){r.load(t,l),r.dialogBody=i.create("div",{class:"search-pq-help-panel-content"});var c=i.create("table",{styles:{height:"100%",width:"100%"}}).inject(r.dialogBody),u=i.create("tbody").inject(c),h=i.create("tr").inject(u),g=i.create("tr",{styles:{height:"100%"}}).inject(u),p=i.create("div",{styles:{height:"100%","padding-top":"10px"},class:"pqListDivP"}).inject(g),_=i.create("div").inject(h);(new d).inject(_);r.createPQList(r.labelList,r.abbreviationsList,p),r.PQUxPC.resolve()}else o.error("No PQ to display !")})),this.PQUxPC.promise.then((function(){r.pqModalDialog=c.modal({id:"search-pq-help-panel",className:"search-pq-help-panel",title:l.get("title_pq_ux_dialog"),autoCloseFlag:!1,content:r.dialogBody})})))},load:function(t,i){if(!e.is(t))throw new Error("Invalid value for PQs in SearchPQListUX.load !");if(!e.is(i))throw new Error("Invalid value for PQsNLS in SearchPQListUX.load !");t.PQ.sort((function(e,t){var n=i[e.pqid+".Title"],s=i[t.pqid+".Title"];return e.custom===t.custom?(n>s)-(s>n):!0===e.custom&&void 0===t.custom?-1:void 0===e.custom&&!0===t.custom?1:void 0}));for(var n=0,s=t.PQ.length;n<s;n++){var o=t.PQ[n];if(e.is(o)){this.abbreviationsList.push(o.abbreviations),this.lAbbreviationsList.push(o.abbreviations.toLowerCase());var a=i[o.pqid+".Title"];this.labelList.push(a),a?this.llabelList.push(a.toLowerCase()):this.llabelList.push(a),this.PQs.push(o)}}},createPQList:function(t,n,s){var o=this,r=function(e){o.setSelectedPrefix(e.target.getAttribute("prfix")+":")};a.getPQNLS();for(var l=i.create("div",{styles:{height:"100%"},class:"pqListDiv"}).inject(s),c=i.create("table",{styles:{}}).inject(l),d=0;d<n.length;d++){var u=!0;if(!e.is(o.PQs[d].custom)&&e.is(o.pqAccessMap)&&e.is(o.pqAccessMap[o.PQs[d].pqid])&&(u=o.pqAccessMap[o.PQs[d].pqid]),u){var h=n[d].split(","),g=t[d],p={};p.background=d%2==0?"#F0F0F0":"#FfFfFf";var _=i.create("tr",{styles:p}).inject(c),f=i.create("table",{styles:{width:"100%","table-layout":"fixed"}}).inject(_);this.liList[d]=_;var m=i.create("tbody").inject(f),S=i.create("tr").inject(m),v=i.create("td",{styles:{"word-wrap":"break-word"},class:"pq-line",id:g}).inject(S);i.create("span",{html:g,class:"pq-label"}).inject(v);for(var w=i.create("span",{styles:{float:"right","text-align":"right","word-break":"break-all"},class:"pq-abreviation-list"}).inject(v),b=h.length-1;b>=0;b--){var C=h[b],y=i.create("span",{styles:{float:"right"}}).inject(w);i.create("span",{html:"&nbsp;&nbsp;",styles:{float:"right"}}).inject(y),i.create("a",{html:C+":",events:{click:r},styles:{},class:"pq-abreviation",id:C+":"}).inject(y).setAttributes({prfix:C})}}}},filterPQs:function(t){var i=this,n=0;if(t&&""!==t.replace(/\s+/g,"")){var s=t.toLowerCase();this.liList.forEach((function(t,o){var a=i.lAbbreviationsList[o],r=i.llabelList[o];e.is(r)&&e.is(a)&&(r.indexOf(s)>-1||a.indexOf(s)>-1?(t.show(),n%2==0?t.setStyle("background","#F0F0F0"):t.setStyle("background","#FfFfFf"),n++):t.hide())}))}else this.liList.forEach((function(t,s){var o=i.abbreviationsList[s];e.is(o)&&(t.show(),n%2==0?t.setStyle("background","#F0F0F0"):t.setStyle("background","#FfFfFf"),n++)}))},setSelectedPrefix:function(e){c.getModal("search-pq-help-panel").hide(),this.pqSelectionHandler.call(void 0,e)}});return u})),define("DS/SNResultUX/layouts/SNSkeletonMgt_v2",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","UWA/Class/Listener","UWA/Element","DS/WAFData/WAFData","DS/PubSub/PubSub","DS/PlatformAPI/PlatformAPI","UWA/Utils/InterCom","DS/WebappsUtils/Performance","DS/MessageBus/MessageBus","DS/W3DXComponents/Skeleton","DS/W3DXComponents/Views/Layout/ListView","DS/UIKIT/Native/Dropdown","DS/UIKIT/DropdownMenu","DS/UIKIT/Spinner","DS/SNInfraUX/RefineHelper/RefineHelper","DS/SNInfraUX/SearchDebug","DS/SNInfraUX/SearchLogin","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchCom","DS/Utilities/Utils","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SecurityContextManager","DS/SNInfraUX/utils/WildcardMgr","DS/SNInfraUX/ServiceDelegationLoader","DS/SNResultUX/utils/SearchActions","DS/SNResultUX/utils/SearchLocalActions","DS/SNResultUX/utils/SearchServices","DS/SNResultUX/utils/SearchViewOptions","DS/SNResultUX/utils/ResultUX_customization","DS/SNResultUX/utils/AdvSearchMgr","DS/SNResultUX/utils/SearchTagsTransformation","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/SNResultUX/views/W3DXComponents/Views/Item/SwitcherView","DS/SNResultUX/views/helpers/SearchDataGridView","DS/SNResultUX/views/helpers/SearchRespTileGridView","DS/SNResultUX/views/helpers/SearchRespTextualTileGridView","DS/SNResultUX/views/helpers/SearchRespThumbnailGridView","DS/SNResultUX/views/helpers/SearchWhatView","DS/SNResultUX/views/helpers/SearchWhereView","DS/SNResultUX/views/helpers/SearchWhenView","DS/SNResultUX/views/helpers/SearchWhoView","DS/SNResultUX/views/helpers/SearchMyContentView","DS/SNResultUX/SearchPQListUX","DS/SNResultUX/views/utils/SearchCounterView","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/i3DXCompassPlatformServices/OpenWith","DS/SNResultUX/utils/SearchDoubleClickHandler","DS/WebRecordEnabler/Adapter","DS/SNInfraUX/Logger","css!DS/UIKIT/UIKIT.css","DS/SNResultUX/utils/ResultsUtils","DS/SNResultUX/utils/ExternalComponentHelpers"],(function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_,f,m,S,v,w,b,C,y,D,I,T,A,x,N,E,O,k,P,M,R,V,U,L,F,j,W,B,X,H,G,z,q,Q,Z,J,Y,K,$,ee,te){"use strict";return t.extend(S,i,n,s,{uwaClassName:"DS/SNResultUX/SNSkeletonMgt_v2",name:"DS_SNResultUX_SNSkeletonMgt_v2",_skeleton:null,getSkeleton:function(){return this._skeleton},_onesearch_collection:null,_panelTitle:null,_searchcom_socket:null,_compass_socket:null,_WebInWinCtxActionSocket:null,_currentItemView:null,_myDatagridView:null,_isStartWithTableView:!1,_isFirstTimeTableViewSwitch:!0,_WidgetTitleObj:null,_advSearchMgr:null,_searchActions:null,_model:null,ctxMenu:null,_currentItemViewCid:null,_BI_Shades:null,_selectionMode_techno:"nullToMany",_neverAction:!1,_informationPanel:null,_informationZone:null,_informationState:!1,_lastSelectedItem:null,_ctxMenuTarget:null,_IsFirstTimeDone:!1,_IsFirstPageOfResultsDone:!1,_lastSearchOptions:null,_firstPage:0,_default_results_perpage:0,_in_app_multiSel:null,_printWindow:null,_subscriptions:null,_previewState:!0,_viewsId:[],_order_field:"",_order_by:"",_order_type:"",_order_index:"",_diplaySecurityContextInfoOnce:!0,_searchWidget:null,_selectionOccurred:!1,limitReachedFUN141960:!1,debounceTimeout:null,init:function(t){K.groupCollapsed("SNSkeletonMgt_v2.init"),K.log("options:"),t&&K.log(t);var i=this;if(this._previewState=!1,this.closePrintWindow=function(){e.is(i._printWindow)&&i._printWindow.close()},window.addEventListener("beforeunload",this.closePrintWindow),window.addEventListener("resize",(function(t){if(i._skeleton&&i._skeleton.getViewAt(0)&&i._skeleton.getViewAt(0).currentViewId&&"tablet"===D.getDeviceType()){let t=[];t.push(i._skeleton.getViewAt(0).currentViewId),window.innerWidth>window.innerHeight?(t.pop(),D.activateCompactOrComfortMode(),setTimeout((()=>{w.getOption("search_compact_mode")||D.isTabletCompactMode()||(i.refreshSortUI("landscape"),i._skeleton.container.getElement(".search-content-set-header .search-content-set-actions").setStyle("display",""),i._skeleton.container.getElement(".onesearch_resizer")&&i._skeleton.container.getElement(".onesearch_resizer").destroy(),"table"===t.pop()&&i.switchOnView("table"))}),500)):window.innerWidth<window.innerHeight&&("table"===i._skeleton.getViewAt(0).currentViewId&&i.switchOnView("tile"),w.setCompactMode(!0),setTimeout((()=>{if(i.refreshSortUI("portrait"),i._skeleton.container.getElement(".search-content-set-header .search-content-set-actions").setStyle("display","none"),null!=i._skeleton.container.getElement(".search-content-set-container.informationPanel_Icon")){i.ActivateDeactivateInformationsPanel();let t=i.options.observable;e.is(t)&&t.manageInformationPanel(!1)}}),500),setTimeout((()=>{null!=i._skeleton.container.getElement(".search-content-set-container.informationPanel_Icon")&&i.ActivateDeactivateInformationsPanel()}),2e3))}})),this._subscriptions={},this._WidgetTitleObj={},e.is(t)&&!e.is(t._selectionMode_techno)&&e.is(t.in_apps_search)&&e.is(t.in_apps_search.multiSel)&&(t._selectionMode_techno=!0===t.in_apps_search.multiSel?"nullToMany":"oneToOne"),e.is(w)&&e.is(w.options.search_settings)&&e.is(w.options.search_settings.multiSel)&&!1===w.options.search_settings.multiSel&&(t._selectionMode_techno="oneToOne"),t._neverAction=!1,e.is(w)&&e.is(w.options.search_settings)&&e.is(w.options.search_settings.neverAction)&&!0===w.options.search_settings.neverAction&&(t._neverAction=!0),!0===D.isInTheSimpleSearch({tenant:t.resources.active_tenant})&&!0===b.getItem("NomultiSelection")){t._selectionMode_techno="oneToOne";let i=w.getOption("search_compact_mode");e.is(i)&&!1===i&&(t._selectionMode_techno="nullToMany")}this._parent(t);var n=this.getOption("in_apps_search");if(n?(O.setContextOptions(n),e.is(n.title,"string")&&(this._WidgetTitleObj.searchTitlePrefix=n.title)):O.setContextOptions(null),this._selectionMode_techno=t._selectionMode_techno||"nullToMany",this._neverAction=t._neverAction,this._skeleton=new h(this._buildSkeletonRenderers()),e.is(this.getOption("renderTo"))){this.render().inject(this.getOption("renderTo"));var s="100%";if(!0===this.getOption("furtive")){var o=document.documentElement.clientWidth/window.innerWidth,a=48;o>1&&(a*=2*o),"ipad"===D.getDeviceCategory()&&(a=85),s="calc(100% - "+a.toString()+"px)",!D.isMobile()||"android"!==D.getDeviceCategory()&&"iphone"!==D.getDeviceCategory()||(s="90%")}this._skeleton.setHeight(s),this._skeleton.container.addClassName("onesearch_skeleton")}e.is(this.getOption("observable"),"object")&&this.listenTo(this.getOption("observable"),{onSearchSkeletonPQ:function(){if(!e.is(i._skeleton))return K.error("No skeleton !"),null;z.showPQSelector({pqSelectionCallback:function(t){!0===w.getOption("search_web_in_win")&&window.hasOwnProperty("sendNotificationWebInWin")&&e.is(sendNotificationWebInWin,"function")&&sendNotificationWebInWin("PQSelector",t)}})},onSearchSkeleton:function(t){if(i._IsFirstTimeDone=!1,i._IsFirstPageOfResultsDone=!1,!e.is(i._skeleton))return K.error("No skeleton !"),null;i._skeleton._alert&&(i._skeleton._alert.destroy(),i._skeleton._alert=null),e.is(i._searchActions)&&e.is(i._searchActions._cleanPopOver,"function")&&i._searchActions._cleanPopOver(),i.getCollection().custoAction&&i.getCollection().custoAction.popover&&i.getCollection().custoAction.popover.hide(),"/onesearch/"!==i._skeleton.getRoute()&&i._skeleton.slideBack(),i._order_by=t.order_by?t.order_by:i._onesearch_collection&&i._onesearch_collection.service_parameters?i._onesearch_collection.service_parameters.order_by:"",i._order_field=t.order_field?t.order_field:i._onesearch_collection&&i._onesearch_collection.service_parameters?i._onesearch_collection.service_parameters.order_field:"",i._order_type=t.order_type?t.order_type:i._onesearch_collection&&i._onesearch_collection.service_parameters?i._onesearch_collection.service_parameters.order_type:"",i._order_index=t.order_index?t.order_index:i._onesearch_collection&&i._onesearch_collection.service_parameters?i._onesearch_collection.service_parameters.order_index:"";var n={query:t.search_criteria,mode:t.search_mode,refine:t.tag_filter,adv_search:t.adv_search,advanced_criteria:t.advanced_criteria,source:t.source,originalSearchCriteria:t.originalSearchCriteria,specific_source_parameter:t.specific_source_parameter,order_field:i._order_field,order_by:i._order_by,order_type:i._order_type,order_index:i._order_index,recent_search:t.recent_search,context:t.context,searchInCriteria:t.searchInCriteria,idWaitLoading:t.idWaitLoading,refineSearch:t.refineSearch,nlq:t.search_criteria_input_string,searchInCurrentTab:t.searchInCurrentTab};w.getOption("search_web_in_win")&&e.is(i.order_field)&&e.is(i.order_by)&&(n.order_field=i._order_field,n.order_by=i._order_by,n.order_type=i._order_type,n.order_index=i._order_index),D.isFUN109031Active()&&(i.resetMultisel(),i._lastSelectedItem=null);var s=i.getCollection(),o=!0;n.query!==D.SearchTypeEnum.ADVANCED_SEARCH||e.is(t.advanced_criteria)||s._ctx_options&&s._ctx_options.advanced_search&&(s._ctx_options.advanced_search.searchOnInit&&e.is(s._ctx_options.precond,"string")&&s._ctx_options.precond.trim().length>0&&(t.advanced_criteria=s._ctx_options.precond),!1===s._ctx_options.advanced_search.showByDefault&&(o=!1));var a=!1;e.is(t.advanced_criteria)&&t.advanced_criteria.length&&n.query!==D.SearchTypeEnum.MY_RECENT_CONTENT?(n.query===D.SearchTypeEnum.ADVANCED_SEARCH?(n.query="",a=!0):e.is(s._ctx_options)&&e.is(s._ctx_options.advanced_search)&&(e.is(s._ctx_options.precond)&&s._ctx_options.precond.length>0?n.query.trim()!==s._ctx_options.precond.trim()&&(n.query.length&&(n.query+=" AND "),n.query+=s._ctx_options.precond):n.query=""),n.query.length&&(n.query+=" AND "),n.query+=t.advanced_criteria):e.is(t.advanced_criteria)&&e.is(t.adv_search)&&!0===t.adv_search&&""===t.advanced_criteria&&(a=!0),e.is(t.localFilter,"object")&&(n.localFilter=t.localFilter),e.is(t.fromTopbar)&&(n.fromTopbar=t.fromTopbar),e.is(t.isTitleOnly)&&(n.isTitleOnly=t.isTitleOnly);var r=null,l=null,c=i.getCollection().getTaggerProxy(),d=c.getCurrentFilter();e.is(d)&&(r=d.localfilters),e.is(t.tag_filter,"object")&&(l=t.tag_filter.localfilters),UWA.equals(r,l)||(!e.is(r)||m.isEmpty(r)||e.is(r,"object")&&!Object.keys(r).length)&&e.is(l)&&!0!==t.refresh&&e.is(c)&&e.is(c.setLocalFilter,"function")&&c.setLocalFilter(l,!1),e.is(t.search_criteria_to_display,"string")&&t.search_criteria_to_display.length>0&&(n.search_criteria_to_display=t.search_criteria_to_display),e.is(l,"object")&&l.hasOwnProperty("sixw:ds6w:where/ds6w:source/ds6w:dataSource")&&1===Object.keys(l).length&&(e.is(c)&&e.is(c.clearLocalFilter,"function")&&c.clearLocalFilter(),e.is(c)&&e.is(c.clearLocalGrouping,"function")&&c.clearLocalGrouping());var u=function(){n.update_incontext_options=t.update_incontext_options;var r=s.getRequestCriteria().service_params;if(s.setRequestCriteria("fed_search",n),s.setSearchSource(t.source),O.setContextOptions(t.in_apps_search),e.is(i._skeleton)){var l=i._skeleton.getViewAt(0);if(l&&l.contentsViews)for(var d in l.contentsViews)l.contentsViews[d].onSearch&&l.contentsViews[d].onSearch(t)}var u=!1,h=s.getRequestCriteria().service_params,g=!0;e.is(c.filters)&&e.is(c.filters.allfilters)&&0!==Object.keys(c.filters.allfilters).length&&(g=!1),e.is(h)&&(h.query===D.SearchTypeEnum.ADVANCED_SEARCH||a)&&h.query!==D.SearchTypeEnum.MY_RECENT_CONTENT&&g&&((!e.is(h.refine,"object")||e.is(h.refine.allfilters,"object")&&Object.keys(h.refine.allfilters).length>0||e.is(h.refine.localfilters,"object")&&Object.keys(h.refine.localfilters).length>0||e.is(h.refine.PLMParameters)&&e.is(h.refine.PLMParameters.plmparam)&&Object.keys(h.refine.PLMParameters.plmparam).length>0)&&e.is(h.refine,"object")||(u=!0));var p=s._ctx_options;if(o&&u)s.getTaggerProxy().clearLocalFilter(),s.getTaggerProxy().clearLocalGrouping&&s.getTaggerProxy().clearLocalGrouping(),e.is(i._advSearchMgr)&&(i._advSearchMgr.clearFilters(),i._advSearchMgr.getAndDisplayAdvancedSearch(!0),s._resetState(),s.reset(),i._updateWidgetTitleWithNbResult(t),i._defineViews(),i._loadFirstPage());else if(e.is(s._ctx_options)&&e.is(s._ctx_options.app_socket_id)&&"socket_id_#saved_search_edit#"===s._ctx_options.app_socket_id&&e.is(s._ctx_options.advanced_search))e.is(i._advSearchMgr)&&(i._advSearchMgr.getAndDisplayAdvancedSearch(!0,t),s._resetState(),s.reset(),i._updateWidgetTitleWithNbResult(t),i._defineViews(),i._loadFirstPage());else if(!p||!r||h.query!==D.SearchTypeEnum.ADVANCED_SEARCH)if(w.getOption("search_web_in_win")){let e=0;i._skeleton.getViewAt(0)&&"table"===i._skeleton.getViewAt(0).currentViewId&&(e=650),setTimeout((function(){s._resetState(),s.reset(),i._updateWidgetTitleWithNbResult(t),i._defineViews(),i._loadFirstPage()}),e)}else s._resetState(),s.reset(),i._updateWidgetTitleWithNbResult(t),i._defineViews(),i._loadFirstPage()},h=D.identifyClientInfo();if(!0!==this.getOption("transient_context")&&"3DDashboard"===h.identifier){require(["DS/Dashboard/PublicAPI"],(function(t){var i=t.getActiveTab();if(e.is(i)&&e.is(i.shouldPropagateSearch)&&!0===i.shouldPropagateSearch&&e.is(i.shouldPropagateSearchArg,"string")&&0<i.shouldPropagateSearchArg.length){let e=T.manageWildcardAddtion(i.shouldPropagateSearchArg);e=D.replacePQsWithCVPrefixes(e),n.searchInCriteria=e}u()}))}else"3DSwym"===h.identifier?(n.query=D.replacePQsWithCVPrefixes(n.query),u()):u()}});var l="com.ds."+this.getOption("widgetId");this._compass_socket=new c.Socket(l),this._compass_socket.subscribeServer("com.ds.compass",window.parent),this._searchcom_socket=C.createSocket({socket_id:"search_skeleton_"+d.now(),widgetId:this.options.widgetId}),e.is(this._WebInWinCtxActionSocket)||(this._WebInWinCtxActionSocket=C.createSocket({socket_id:"_searchcom_socket_CtxAction"+Math.floor(1e5*Math.random()+1)}));var g=this.getOption("messagingChannel");if(this._WebInWinCtxActionSocket.addListener("onSetCtxMenuForItemViewOptions",this.setCtxMenuForItemViewOptions.bind(this)),this._subscriptions.onResetMultisel=u.subscribe({channel:g,topic:"onResetMultisel",callback:this.resetMultisel.bind(this)}),this._subscriptions.onclearWebInWinCSO=u.subscribe({channel:g,topic:"onclearWebInWinCSO",callback:this.resetMultiselWebInWinWithoutFire.bind(this)}),this._WebInWinCtxActionSocket.addListener("onLogout",this.logout.bind(this)),this._searchcom_socket.addListener("onItemSelected",y.debounce(this.onItemSelected.bind(this),100)),this._searchcom_socket.addListener("onItemUnselected",this.onItemUnselected.bind(this)),this._searchcom_socket.addListener("onItemDblClick",this.onItemDblClick.bind(this)),this._subscriptions.onFetchAndSelectAll=u.subscribe({channel:g,topic:"onFetchAndSelectAll",callback:this.onFetchAndSelectAllCallback.bind(this)}),this._searchcom_socket.addListener("widgetResize",function(){this._searchActions&&this._searchActions.updatePopoverPosition()}.bind(this)),this._subscriptions.sortForAllView=u.subscribe({channel:g,topic:"sortForAllView",callback:this.sortForAllView.bind(this)}),this._searchActions=new x({SNSkeleton:this}),this._diplaySecurityContextInfoOnce=!0,r.add("search:advancedSearchEdit",(function(t){e.is(i._advSearchMgr)&&i._advSearchMgr.getAndDisplayAdvancedSearch(!0,t)})),r.add("search:updateWidgetTitle",(function(e){i.setTitle({applicativeTitle:e,updatePinnedWidgetTitle:!0})})),r.add("search:emptyCompassSelection",(function(){i.resetCompassSelection()})),this._subscriptions.showEmbeddedView=u.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"showEmbeddedView",callback:()=>{i.getCollection().getTaggerProxy().showEmbeddedView()}}),this._subscriptions.hideEmbeddedView=u.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"hideEmbeddedView",callback:()=>{i.getCollection().getTaggerProxy().hideEmbeddedView()}}),D.isFUN109031Active()&&!this.inContextSearch()){let t=e.extendElement(document.body).getElement("div#divSearchHead");e.is(t)&&t.addClassName("BETA-FUN109031")}K.groupEnd()},destroy:function(){K.log("destroy"),!0===this._selectionOccurred&&this.resetCompassSelection(),b.commit(),this.stopListening(),window.removeEventListener("beforeunload",this.closePrintWindow),this.closePrintWindow=null,this._currentItemView=null,this._myDatagridView=null,e.is(this.indexedtimeMenu)&&(this.indexedtimeMenu=null),null!==this._informationPanel&&this._informationPanel.destroy(),this._informationPanel=null,e.is(this._informationZone)&&e.is(this._informationZone.destroy,"function")&&this._informationZone.destroy(),this._informationZone=null,this._lastSelectedItem=null,e.is(this._mySpinner)&&(this._mySpinner.destroy(),this._mySpinner=null),e.is(this._advSearchMgr)&&e.is(this._advSearchMgr.destroy,"function")&&(this._advSearchMgr.destroy(),this._advSearchMgr=null),e.is(this._searchcom_socket)&&this._searchcom_socket.dispatchEvent("clearSearch",{destroy:!0,noFocus:!0}),this._onesearch_collection&&this._onesearch_collection.service_parameters&&this._onesearch_collection.setGlobalOrder("","");var t=this.getHelperCollectionId();if(D.getHelperCollection(t)&&D.deleteHelperCollection(t),u.unsubscribe(this._subscriptions.sortForAllView),u.unsubscribe(this._subscriptions.onFetchAndSelectAll),u.unsubscribe(this._subscriptions.onResetMultisel),u.unsubscribe(this._subscriptions.onclearWebInWinCSO),u.unsubscribe(this._subscriptions.showEmbeddedView),u.unsubscribe(this._subscriptions.hideEmbeddedView),e.is(this._skeleton)&&e.is(this._skeleton.getViewAt,"function")&&e.is(this._skeleton.getViewAt(0))&&e.is(this._skeleton.getViewAt(0).contentsViews)&&(this._skeleton.getViewAt(0).contentsViews.tile||this._skeleton.getViewAt(0).contentsViews.thumbnail)){var i=this._skeleton.getViewAt(0).contentsViews.tile?this._skeleton.getViewAt(0).contentsViews.tile:this._skeleton.getViewAt(0).contentsViews.thumbnail;e.is(i)&&(i._searchcom_socket.removeListener("onSelectAll"),i._searchcom_socket.removeListener("onSelectShift"));var n=this._skeleton.getViewAt(0).contentsViews.thumbnail?this._skeleton.getViewAt(0).contentsViews.thumbnail:this._skeleton.getViewAt(0).contentsViews.tile;e.is(n)&&(n._searchcom_socket.removeListener("onSelectAll"),n._searchcom_socket.removeListener("onSelectShift"))}e.is(this._skeleton)&&e.is(this._skeleton.destroy,"function")&&(this._skeleton.destroy(),this._skeleton=null),e.is(this._onesearch_collection)&&e.is(this._onesearch_collection.setSNSkeleton)&&this._onesearch_collection.setSNSkeleton(null),e.is(this._onesearch_collection)&&(this._onesearch_collection.removeEvent("failure_on_parse"),this._onesearch_collection.removeEvent("response_treated"),this._onesearch_collection.removeEvent("update_title"),this._onesearch_collection.removeEvent("update_secutity_context"),this._onesearch_collection.removeEvent("onReset"),this._onesearch_collection.destroy(),this._onesearch_collection=null),e.is(this._searchcom_socket)&&(this._searchcom_socket.removeListener("onItemSelected"),this._searchcom_socket.removeListener("onItemUnselected"),this._searchcom_socket.removeListener("widgetResize"),this._searchcom_socket.removeListener("onItemDblClick"),this._searchcom_socket.disconnect(),C.deleteSocket(this._searchcom_socket.id),this._searchcom_socket=null),e.is(this._compass_socket)&&(this._compass_socket.unsubscribeServer("com.ds.compass"),this._compass_socket.disconnect(),this._compass_socket=null),e.is(this._WebInWinCtxActionSocket)&&(this._WebInWinCtxActionSocket.removeListener("onSetCtxMenuForItemViewOptions"),this._WebInWinCtxActionSocket.removeListener("onLogout"),this._WebInWinCtxActionSocket.disconnect(),C.deleteSocket(this._WebInWinCtxActionSocket.id),this._WebInWinCtxActionSocket=null),this._myDatagridView=null,this._WidgetTitleObj=null,this._dynamicPredicateSetType=null,this._dynamicPredicateSetKind=null,e.is(this._searchActions)&&(this._searchActions.removeEvent(),this._searchActions.destroy(),this._searchActions=null),e.is(this._printWindow)&&(this._printWindow.close(),this._printWindow=null),e.is(this.ctxMenu)&&(this.ctxMenu.destroy(),this.ctxMenu=null),this.options=null,this._parent()},render:function(){return this._skeleton.render()},getCollection:function(){if(null===this._onesearch_collection)throw new Error("Collection is not defined yet");return e.is(this._lastSelectedItem)&&e.is(this._lastSelectedItem.collection)?this._lastSelectedItem.collection:this._onesearch_collection},getContainer:function(){var t,i=this;return this._skeleton&&this._skeleton.container?t=this._skeleton.container:e.is(UWA.Widgets)&&e.is(UWA.Widgets.instances)?UWA.Widgets.instances.forEach((function(n){n.id===i.getOption("widgetId")&&(t=e.extendElement(n.elements.body).getElement(".search-content-set-contents"))})):t=e.extendElement(document.body).getElement(".search-content-set-contents"),t},onSkeletonReady:function(){},onItemDblClick:function(t,i,n){let s=this;(D.trackerData.search.previewItem||D.trackerData.search.selectItem)&&(D.trackerData.search.scenario="Open",u.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:D.trackerData.search.scenario,persVal:{pv13:D.trackerData.search.indexItem}}}));let o=e.is(n)?n:this._onesearch_collection,a=E.buildCompassSelectionData({widgetId:e.is(this.getOption("widgetId"))?this.getOption("widgetId"):"",selectedModels:[o.get(t)]});e.is(n)?this.doubleClickHandler(t,a,n,(function(){K.log("[dbl click] - failed to open, should try preview!"),s._onItemTitleClick(i,null,n)})):this.doubleClickHandler(t,a,void 0,(function(){K.log("[dblClick] - no open possible for object :"+t)}))},doubleClickHandler:function(t,i,n,s){J.handle({skeleton:this,id:t,collection:n,compassData:i,callbackOnFailedToOpen:function(){K.log("Open not possible!"),e.is(s,"function")&&s()}})},getCurrentScrollView:function(){let t=null;if(e.is(this._skeleton)){var i=this._skeleton.getViewAt(0);e.is(i)&&e.is(i.contentsViews)&&e.is(i.currentViewId)&&"table"!==i.currentViewId&&i.contentsViews[i.currentViewId]&&e.is(i.contentsViews[i.currentViewId].nestedView.view)&&(e.is(i.contentsViews[i.currentViewId].nestedView.view.getScroller,"function")?t=i.contentsViews[i.currentViewId].nestedView.view.getScroller():e.is(i.contentsViews[i.currentViewId].nestedView.view._getScroller,"function")&&(t=i.contentsViews[i.currentViewId].nestedView.view._getScroller()))}return t},getCurrentView:function(){return this._skeleton.getViewAt(0)?this._skeleton.getViewAt(0).contentsViews[this._skeleton.getViewAt(0).currentViewId]:null},scrollToCellAt:function(){var t=this,i=this._skeleton.getViewAt(0);if(e.is(i)&&e.is(i.contentsViews)&&e.is(i.currentViewId)&&("tilebig"===i.currentViewId||"thumbnail"===i.currentViewId||"tile"===i.currentViewId)&&i.contentsViews[i.currentViewId]&&e.is(i.contentsViews[i.currentViewId].nestedView.view)&&e.is(t._lastSelectedItem)){var n=t.getCollection().indexOf(t._lastSelectedItem);if(-1===n&&(n=0),n>=0){var s=null,o=t.getCollection().getTreeDocument().getRoots();e.is(o,"array")&&n<o.length&&(s=o[n],e.is(i.contentsViews[i.currentViewId].nestedView.view.scrollToCellAt,"function")?i.contentsViews[i.currentViewId].nestedView.view.scrollToCellAt({cellID:s._getRowID(!0)}):e.is(i.contentsViews[i.currentViewId].nestedView.view._scrollToNode,"function")&&i.contentsViews[i.currentViewId].nestedView.view._scrollToNode(s,s._getRowID(!0)))}}},getHelperCollectionId:function(){var t=null,i=this.getOption("transient_context");if(e.is(i)&&("true"!==i&&!0!==i||(t=D.TRANSIENT_WIDGET_HELPER_ID)),!e.is(t)){var n=this.getOption("use_preexisting_call");!0!==n&&"true"!==n||(t=D.TRANSIENT_WIDGET_HELPER_ID)}return e.is(t)||(t=this.getOption("widgetId")),t},copyDataFromHelperCollection:function(t,i){if(e.is(t)&&e.is(i)){if(t.totalCount=UWA.clone(i.totalCount),0===t.totalCount&&e.is(i.length)&&(t.totalCount=i.length),t.setFailureView(i.getFailureView()),e.is(i._parse_alert)&&(t._parse_alert=UWA.clone(i._parse_alert)),0===t.totalCount){var n=D.constructEmptyViewMsg(R.get("no_result"));e.is(n)&&this._searchActions.setEmptyViewMessage(n)}t._indexingDate=UWA.clone(i._indexingDate),t._fedSearchLabel=UWA.clone(i._fedSearchLabel),t.state=UWA.clone(i.state),t._setTagsPromise=i._setTagsPromise,t._securityContext3DSpace=i._securityContext3DSpace,t._is3DSpaceSecurityContextDone=i._is3DSpaceSecurityContextDone,t._update_security_contextTodo=i._update_security_contextTodo;var s=t._ctx_options;i.forEach((function(i){i.collection=t;var n=!1;e.is(i.isAShowOnlyObject,"function")&&(n=i.isAShowOnlyObject()),!1===n&&k.getAvailableActions({attributes:i._attributes},(function(e){e.forEach((function(e){-1===i.action_ids.indexOf(e.id)&&(i.action_ids.push(e.id),i.actions.push(e))})),i._attributes.actions&&0!==i._attributes.actions.length||(i._attributes.actions=i.actions.pluck("title"))}),{inCtxOptions:s})})),i._fedsearchOptions.parse=!1,i._fedsearchOptions.silent=!1;var o=i.toArray();t.reset(o,i._fedsearchOptions),t.onHelperCopy(i),!0!==i.options.fetchSynthesisSeparately&&i._taggerDataPromise&&i._taggerDataPromise.promise.then((function(){t._setTags(UWA.clone(i._helperSubjectsTags),UWA.clone(i._helpertagValues))})),i._catCollections&&(t._catCollections=i._catCollections),e.is(i.service_parameters)&&e.is(i.service_parameters.order_by)&&e.is(i.service_parameters.order_field)&&t.setGlobalOrder(i.service_parameters.order_field,i.service_parameters.order_by,i.service_parameters.order_type,i.service_parameters.order_index),e.is(i.parsed_response)&&(t.parsed_response=i.parsed_response),t.facetsTags=i.facetsTags}},_isOpenWithMenuAsked:function(t,i){var n=null;if(e.is(t,"array")&&!w.getOption("search_web_in_win"))for(var s=0;s<t.length&&!e.is(n);s++){var o=t[s];if(e.is(o)&&"3DCompass_#OpenWith"===o.id&&e.is(o.internalHelper,"object")){var a=o.internalHelper.getCmdInfo();e.is(a,"object")&&(e.is(a.type,"string")&&a.type.length>0||e.is(a.type,"array")&&a.type.length>0)&&(n={protocol:"3DXContent",version:"2.0",source:D.getSearchAppId(),widgetId:i,data:{items:[{objectId:o.internalHelper.getObjectID(),objectType:o.internalHelper.getType(),envId:o.internalHelper.getPlatformID(),serviceId:o.internalHelper.getServiceID(),displayName:o.internalHelper.getDisplayName(),displayType:o.internalHelper.getDisplayType(),contextId:o.internalHelper.getContextId(),i3dx:o.internalHelper.getI3dx()}]}},e.is(a.type,"string")?n.data.items[0].objectTaxonomies=[a.type]:n.data.items[0].objectTaxonomies=a.type,t.splice(s,1))}}return n},_initDropDown:y.debounce((function(t,i){var n=this,s=t;e.is(s)||(s=[]),0===s.length&&s.push({text:R.get("noActionsAvailable"),id:"noActionsAvailable"});var o=i&&i.skeleton.getOption("widgetId"),a=this._isOpenWithMenuAsked(t,o),r={items:s};e.is(i,"object")&&(r.target=i.target),e.is(r.target)||(r.target=this._ctxMenuTarget),e.is(r.target)||(r.target=document.querySelector(".vu-dropdown-menu__wrap.lightbox-bar-dropdown-wrap .vu-icon-btn.lightbox-bar-menu-item")),e.is(r.target)||!0!==w.getOption("search_web_in_win")&&K.error("_initDropDown : ERROR, target div is not available for dropdown !");var l=void 0;if(e.is(i)&&e.is(i.altPosition)&&(l={pageX:i.altPosition.x-20,pageY:i.altPosition.y-20},r.contextual=!0),r.bound=!1,r.removeOnHide=!0,e.is(this.ctxMenu)&&this.ctxMenu.destroy(),this.ctxMenu=null,w.getOption("search_web_in_win")?(r.target=e.extendElement(document.body),r.id="SearchMenu",this.ctxMenu=new p(r)):(r.events={onHide:function(){e.is(n.ctxMenu)&&this.destroy(),n.ctxMenu=null},onClickOutside:function(){e.is(n.ctxMenu)&&this.destroy(),n.ctxMenu=null}},r.className="search-ctx-actions-dropdown-container",e.is(i,"object")&&e.is(i.fromPreview,"boolean")&&!0===i.fromPreview&&(r.className="search-preview-ctx-actions-dropdown-container"),r.scrollMode=!0,this.ctxMenu=new _(r)),e.is(a,"object")){let e=this.ctxMenu.items,t=this.computeOpenWithIndex(e);(new Z).set3DXContent(a).setIndex(t).render(this.ctxMenu)}try{e.is(l)?this.ctxMenu.show(!1,l):this.ctxMenu.show()}catch(e){K.error("_initDropDown : UIKIT::updatePosition",e)}}),50),computeOpenWithIndex:function(e){let t=-1,i=-1,n=-1,s=-1,o=-1,a=w.getOption("command_id.add_tag"),r=w.getOption("command_id.new_preview"),l=w.getOption("command_id.new_information"),c=w.getOption("command_id.relations");for(let t=0;t<e.length;t++)if(e[t].id==c&&(o=t),e[t].id==a&&(i=t),e[t].id==l&&(s=t),e[t].id==r){n=t;break}return n>-1?t=n:i>-1?t=i:s>-1?t=s:o>-1&&(t=o),t+2},setCtxMenuForItemViewOptions:function(t){if(!e.is(t))return;var i=this;e.is(t.somethingSelected)&&"0"===t.somethingSelected&&E._displayAlert({message:R.get("error_select_command"),className:"error"});var n=t.actions_data,s=t.dropdownOptions;if(!e.is(n)||!e.is(n.actions))return;let o=this.getCollection();e.is(s)&&e.is(s.collection)&&(o=s.collection);var a=n.actions.length;a>w.getOption("max_item_for_contextualPanel")&&w.getOption("search_web_in_win")&&E._displayAlert({message:R.get("warning_max_ctx_panel",{nb1:a}),className:"info"});for(var r=0;r<a;r++){var l=o.get(n.actions[r].id);e.is(l)&&e.is(l.actions)&&(e.is(n.actions[r].actions)||(n.actions[r].actions=[]),l.actions.forEach((function(e){if(e._attributes.multisel&&n.actions.length>1)n.actions[r].actions.push(e);else if(1===n.actions.length)var t=i.chechActionToAddInMenu(e);!0===t&&n.actions[r].actions.push(e)})))}if(n.actions.length>0){var c=i._parseContextualMenu(n.actions,o),d=null,u=c.length;if(d=1===u?c[0]:i._menusIntersection(n.actions,c),e.is(s)&&e.is(s.fromPreview)&&!0===s.fromPreview){function h(e){for(var t=d.length-1;t>=0;t--){var i=d[t];if(i&&i.id===e){d.splice(t,1);break}}}h("unselect_all"),h("select_all")}i._initDropDown(d,s)}},chechActionToAddInMenu:function(t){var i=!0;if(e.is(t)){if(!0===w.getOption("nav_history"))if("config_explore"===t.id||"whereUsed"===t.id)!1===this.getOption("navHistory")&&(i=!1);return i}},fetchAll:function(t){var i=this,n="fetch",s="fetch";if(e.is(t)&&e.is(t.type)&&(n=t.type),e.is(t)&&e.is(t.subType)&&(n=t.subType),e.is(t)&&e.is(t.action_type)&&(s=t.action_type),e.is(t)&&e.is(t.subType)&&(s=t.subType),e.is(i._in_app_multiSel)&&"nullToMany"!==i._in_app_multiSel&&"fetch"===s)E._displayAlert({message:R.get("error_select_all"),className:"info"});else{var o=w.getOption("max_selection_for_selectall",{tenant:this.getActiveTenant()});i.param=t,e.is(i._searchActions.setSelected,"function")&&i._searchActions.setSelected(i._modelSelected);var a=o,r=this._skeleton.getViewAt(0);if(!e.is(r))throw new Error("Error, rootView undefined in SNSkeletonMgt.fetchAll !");var l=r.collection.totalCount;if(!1===r.collection.hasNextPage()||r.collection.length>=o){i.resetMultisel();let a=Math.max(o,r.collection.length);l>a&&(n="msgType_"+s,n=R.replace(R.get(n),{action_type:R.get("msgType_"+s)}),u.publish({channel:this.getOption("messagingChannel"),topic:"updateSelectionNumber",data:{number:r.collection.length}}),E._displayAlert({message:R.get("warning_fetch_all",{nb1:r.collection.length,nb2:r.collection.totalCount,msgType:n}),className:"success"})),e.is(t)&&e.is(t.callback,"function")&&t.callback.call(t.context,t)}else{r.collection.state.pageSize=a;var c=w.serialize(),d=JSON.parse(c);i._default_results_perpage=d.search_settings.results_perpage,d.search_settings.results_perpage=a,w.initialize(d),r.collection.reset();var h=i.getContainer();h&&te.showOverlayLoader(void 0,h),r.collection.getFirstPageOfResults({reset:!0,fetchAll:!0,onComplete:function(){K.log("SNSkeletonMgt_v2.fetchAll->onComplete getFirstPageOfResults"),l=r.collection.totalCount;let a=Math.max(o,r.collection.length);l>a&&(n="msgType_"+s,n=R.replace(R.get(n),{action_type:R.get("msgType_"+s)}),u.publish({channel:i.getOption("messagingChannel"),topic:"updateSelectionNumber",data:{number:r.collection.length}}),E._displayAlert({message:R.get("warning_fetch_all",{nb1:r.collection.length,nb2:r.collection.totalCount,msgType:n}),className:"success"})),r.collection.generateTreeModelAsync().then((function(){let n=w.serialize(),s=JSON.parse(n);s.search_settings.results_perpage=i._default_results_perpage,w.initialize(s),te.hideOverlayLoader(h),e.is(t)&&e.is(t.callback,"function")&&t.callback.call(t.context,t)}))},onFailure:function(){let n=w.serialize(),s=JSON.parse(n);s.search_settings.results_perpage=i._default_results_perpage,w.initialize(s),te.hideOverlayLoader(h),e.is(t)&&e.is(t.callback,"function")&&t.callback.call(t.context,{error:"TOO_MANY_RESULTS"})}})}}},onFetchAndSelectAllCallback:function(t){var i=this;e.is(t)||(t={}),t.callback=function(t){e.is(t.error)||i._selectAll()},i.fetchAll(t)},notifyReset:function(t){if(void 0===t&&(t=!0),this.resetCompassSelection(),!0===t){var i=this.getCollection().getTaggerProxy();e.is(i)&&i.unfocus()}for(var n in this.notifySelectionAddinMode(),this._viewsId)u.publish({channel:"Qchannel-searchgriview-"+this._viewsId[n],topic:"Qtopic-searchgriview-disableMultiSelMode",data:{}})},resetCompassSelection:function(){this._compass_socket&&(this._compass_socket.dispatchEvent("onResetObject",{}),this._compass_socket.dispatchEvent("onResetX3DContent",{}))},clearWebInWinCSO:function(){if(!0===w.getOption("search_web_in_win")){var e={objets_name:[]};this.onDispatchToWin(e,"onAddToCSO")}},resetMultisel:function(e){void 0===e&&(e=!0),this._model.unselectAll(),this.notifyReset(e),this.clearWebInWinCSO()},resetMultiselWebInWinWithoutFire:function(){this._model.unselectAll(),this.notifyReset()},logout:function(){e.is(this._searchActions)&&e.is(this._searchActions.logOut)?this._searchActions.logOut():K.error("!UWACore.is(this._searchActions) && (UWACore.is(this._searchActions.logOut)")},_parseContextualMenu:function(e,t){var i=[],n=0,s=e.length;for(n=0;n<s;n++)i[n]=this._getActionsForOneObject(e[n].id,e[n].actions,"",t);return i},_getActionsForOneObject:function(e,t,i,n){var s=[],o=0,a=t.length;for(o=0;o<a;o++)s[o]=this._getOneActionForOneObject(e,t[o],i,n);return s},_getActionsHelper:function(t){var i=this,n=this.getCollection();return{getModel:function(t){var i=n.get(t.id);if(e.is(i))return i},getValue:function(t){var i,s=n.get(t.id);if(e.is(s)){var o=t.predicate?t.predicate:t.attribute;i=s.get(o+"_value")}return i},getNLSValue:function(t){var i=n.get(t.id);if(e.is(i))return i.get(t.predicate)},getResultWidget:function(){return i.getSearchWidget()},getAllValues:function(t){var i=n.get(t.id);if(e.is(i))return i.toJSON()},setLabel:function(t){var s=n.get(t.id);if(e.is(s)){var o=n.indexOf(s),a=s.get("ds6w:label");s.set("ds6w:label",t.newLabel);var r=n.getTreeDocument().getNthRoot(o)._options.label;n.getTreeDocument().getNthRoot(o)._options.label=r.split(a).join(t.newLabel),n.getTreeDocument().getNthRoot(o)._options.grid["ds6w:label"]=t.newLabel,n.getTreeDocument().getNthRoot(o)._options.grid["ds6w:label_value"]=t.newLabel,i.getCurrentView().updateView()}},getCurrentViewID:function(){return i._skeleton.getViewAt(0).currentViewId},deleteResults:function(t){for(var s=0;s<t.ids.length;s++){var o=n.get(t.ids[s]);if(e.is(o)){var a=n.indexOf(o);n.remove(t.ids[s]),n.totalCount--,n.getTreeDocument().removeRoot(n.getTreeDocument().getNthRoot(a)),n.generateTreeModel(),i.getCurrentView().updateView()}}},displayAlert:function(e){e.widgetId=i.getOption("widgetId");var t=UWA.clone(e,!0);t.level&&(t.className=t.level),E._displayAlert(t)},getServiceID:function(t){var i=n.get(t.id);if(e.is(i))return i.getServiceID()},getPlatformID:function(t){var i=n.get(t.id);if(e.is(i))return i.getPlatformID()},getServiceURL:function(t){var i=n.get(t.id),s=t.service_id,o=t.platform_id;if(e.is(i)&&(s=i.getServiceID(),o=i.getPlatformID()),s&&o)if(w.getOption("search_web_in_win"))if("3DSpace"===s)t.onComplete.call(void 0,n.getSearchRessources().get3DSpaceUrl());else e.is(t.onFailure,"function")&&t.onFailure.call(void 0,"unknown service ID in native context : "+t.serviceID);else Q.getServiceUrl({serviceName:s,platformId:o,onComplete:function(i){e.is(t.onComplete,"function")&&t.onComplete.call(void 0,i)},onFailure:function(){e.is(t.onFailure,"function")&&t.onFailure.call()}})},isMultiSelMode:function(){return!!(t&&t.selectedModels&&t.selectedModels.length>1)},getType:function(e){var i;return e?i=this.getValue({id:e,attribute:"ds6w:type"}):t&&t.id?i=this.getValue({id:t.id,attribute:"ds6w:type"}):t&&t.selectedModels&&t.selectedModels.length>0&&t.selectedModels[0]&&(i=this.getValue({id:t.selectedModels[0].id,attribute:"ds6w:type"})),i},getParentContainer:function(){var t=null;return e.is(i)&&e.is(i._skeleton)&&e.is(i._skeleton.container)&&(t=i._skeleton.container.parentElement),t},getClientInfo:function(){return D.identifyClientInfo(i.getOption("addinMode"))},isAPinnedWidget:function(){var t=i.getOption("widgetId"),n=!1;if(e.is(UWA.Widgets)&&e.is(UWA.Widgets.instances,"array"))for(var s=0;s<UWA.Widgets.instances.length;++s){var o=UWA.Widgets.instances[s];if(o.id===t){e.is(o.getView,"function")&&"windowed"===o.getView().type&&(n=!0);break}}return n},canOpenATab:function(){var t=!1,n=i.getOption("observable").getOption("isTabBarVisible");return e.is(n,"function")&&(t=n()),t},getTarget:function(){return e.is(i._ctxMenuTarget)?i._ctxMenuTarget:null},dispatchEvent:function(e){i.getSearchActions().dispatchEvent(e.event,e.params)},setPopover:function(e){i.popover=e},isInContextMode:function(){var t=i.getOption("in_apps_search");if(e.is(t,"object"))return!0},hidePopover:function(){e.is(i.popover)&&(i.popover.hide(),i.popover=null)},selectAll:function(e){u.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:"GlobalAction",persDim:{pd5:"Select All"}}}),D.trackerData.search.selectItem=!0,i.onFetchAndSelectAllCallback(e)},unselectAll:function(){u.publish({channel:this.getOption("messagingChannel"),topic:"updateSelectionNumber",data:{number:0}}),i.resetMultisel()}.bind(this),preview:function(t){if(!e.is(t))return;i._listSelectedElementsFromSearchBeforeLaunchingPreview=null;let n=i._getTreedocumentFromCollection(i.getCollection());if(e.is(n)&&e.is(n.getXSO,"function")){const t=n.getXSO();e.is(t)&&e.is(t.get,"function")&&(i._listSelectedElementsFromSearchBeforeLaunchingPreview=t.get())}let s=i.getOption("observable"),o=i.ActivateDeactivatePreviewPanel();e.is(s)&&s.managepreviewPanel(o)},getInformation:function(e){e.actionItem={model:{get:function(){return"InfoPanel"}}},i.getSearchActions().onActionClick(e)},get3DSpaceSecurityContext:function(){return i.getSecurityContext3DSpace()}}},_getOneActionForOneObject:function(t,i,n,s){var o,a=this,r=a.getCollection();if(e.is(s)&&(r=s),e.is(i.items))o={text:i.title,fonticon:i.icon},void 0!==i.id&&null!==i.id?(o.actionId=i.id,o.id=i.id):void 0!==i.title&&null!==i.title&&(o.id=i.title),o.items=this._getActionsForOneObject(t,i.items,i.title,s);else{var l=!1,c=!1,d=!1;"action-id-separator"===i.id?o={className:"divider"}:(e.is(i.collection)?l=!0:e.is(i.image)?d=!0:c=!0,o={text:d||c?i.title:i.get("title"),icon:d?i.image:c?i.icon:i.get("icon"),multisel:d||c?i.multisel:i.get("multisel"),sourcejs:d||c?i.sourcejs:i.get("sourcejs")},!c&&!l||w.getOption("search_web_in_win")||(o.fonticon=o.icon,delete o.icon),!0===d&&(o.availabilityMode=i.availabilityMode),void 0!==i.id&&(o.actionId=i.id,o.data=i.id,o.id=i.id),void 0!==i.accelerator&&(o.accelerator=d?i.accelerator:i.get("accelerator")),e.is(i.disabled)&&(o.disabled=d?i.disabled:i.get("disabled")),o.handler=function(){D.trackerData.search.previewItem?(D.trackerData.search.scenario="Open",u.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"SearchAction",action:D.trackerData.search.scenario,persVal:{pv13:D.trackerData.search.indexItem}}})):D.trackerData.search.selectItem&&(D.trackerData.search.scenario="Open",u.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:D.trackerData.search.scenario,persVal:{pv13:D.trackerData.search.indexItem}}})),"goToDashboard"===i.id&&a.getPreviewStatus()&&a.getPreviewPanel().hideAndclean(),r._guidedMode&&u.publish({channel:"ContextualAction",topic:"track",data:{type:r.get(t)&&e.is(r.get(t).getType,"function")?r.get(t).getType():"-",actionId:i.id,tilte:i.title}});var n={action_id:i.id,object_id:t,object_cid:a._currentItemViewCid,collection:r,model:r.get(t),actionsHelper:a._getActionsHelper({id:t}),object_ids:[t],widget_id:a.getOption("widgetId"),nav_history:b.getItem("nav_history")};if(l)i.get("callback")(n,arguments),a.dispatchEvent("onExploreAction",n);else if(c){var s=i.sourcejs;if(e.is(s,"string"))require([s],(function(e){e.executeAction(n,arguments)}),(function(e){K.warn("Cannot load action handler "+e.requireModules),n.actionsHelper.getServiceURL({id:t,onComplete:function(e){var i=A.getRealtivePath({serviceID:n.actionsHelper.getServiceID({id:t})});A.loadModuleFromService(s,{serviceURL:e,relativePath:i}).then((function(e){}),(function(e){K.warn("Cannot load action handler "+e.requireModules)}))}})}));else{K.log("action handler not provided");var o=i.executeOptions;e.is(o,"object")?(o.selected_obj=n.object_id,o.displayAlert=n.actionsHelper.displayAlert,N.executeWSAction(o)):K.warn("no options provided to execute the action")}}else require([i.sourcejs],(function(e){e.executeAction(n,arguments)}))},o.internalHelper={getCmdInfo:function(){return e.is(i.get,"function")?i.get("cmdInfo"):i.cmdInfo},getObjectID:function(){return t},getPlatformID:function(){return r.get(t).getPlatformID()},getServiceID:function(){return r.get(t).getServiceID()},getType:function(){return r.get(t).getType()},getDisplayName:function(){return r.get(t).getDisplayName()},getDisplayType:function(){return r.get(t).getDisplayType()},getI3dx:function(){return r.get(t).getI3dx()},getContextId:function(){let t=a.getSecurityContext3DSpace();return e.is(t)?t:""}}),e.is(n)&&(o.menu=n)}return o},_menusIntersection:function(t,i){var n=i.length;if(0===n)return[];for(var s=i[0],o=[],a=1;a<n;a++){var r=i[a],l=0;e.is(r)&&e.is(r.length)&&(l=r.length);for(var c=0;c<l;c++){for(var d=s.length,u=!1,h=0;h<d;h++)if(e.is(r[c].sourcejs)&&e.is(r[c].actionId)&&e.is(s[h].sourcejs)&&e.is(s[h].actionId)){if(r[c].actionId===s[h].actionId&&r[c].sourcejs===s[h].sourcejs){u=!0;break}}else if(r[c].items&&s[h].items&&r[c].text===s[h].text){u=!0;var g=[];g[0]=r[c].items,g[1]=s[h].items;var p=this._menusIntersection(t,g);r[c].items=p;break}!0===u&&o.push(r[c])}s=o,o=[]}return s=s.filter((function(e){return!(!1===e.multisel&&n>1)})),this._updateHandler(t,s),s},_handleAction:function(t,i,n){var s=this,o={action_id:n[t].id,actionsHelper:s._getActionsHelper({selectedModels:i}),collection:s.getCollection(),object_ids:function(){var t=[];if(e.is(i,"array"))for(var n=0;n<i.length;n++)t.push(i[n].id);return t}(),widget_id:s.getOption("widgetId")};require([n[t].sourcejs],(function(e){e.executeAction(o,arguments)}),(function(e){A.loadModuleFromService(n[t].sourcejs,{serviceID:o.actionsHelper.getServiceID({id:i[0].id}),platformID:o.actionsHelper.getPlatformID({id:i[0].id})}).then((function(e){e.executeAction(o,arguments)}),(function(e){K.warn("Cannot load action handler "+e.requireModules)}))}))},_updateHandler:function(t,i){var n=this,s=t.length;if(0===s)return i;var o=0;if(e.is(i)&&(o=i.length),s>1)for(var a=0;a<o;a++)for(var r=0;r<1;r++)void 0!==i[a].handler&null!==i[a].handler?i[a].handler=n._handleAction.bind(n,a,t,i):void 0!==i[a].items&null!==i[a].items&&n._updateHandler(t,i[a].items)},_buildSkeletonRenderers:function(){var t=this,i={onesearch:{collection:"DS/SNResultUX/collections/SearchCollection",collectionOptions:function(){var i=w.getOption("results_perpage")<40?40:w.getOption("results_perpage");return e.is(i)&&"number"!==e.typeOf(i)&&(i=parseInt(i)),{state:{pageSize:i},event:{onSetup:function(i){try{e.is(t._advSearchMgr)||(t._advSearchMgr=new P({collection:t._onesearch_collection=i,tagger_proxy:t.getOption("tagger_proxy"),resources:t.getOption("resources")})),t._onesearch_collection=i,t.setup(),t._onesearch_collection.setSearchRessources(t.getOption("resources")),t._onesearch_collection.setTaggerProxy(t.getOption("tagger_proxy")),t._onesearch_collection.addEvent("failure_on_parse",(function(e){t._failure(i,e,"failure_on_parse")})),t._onesearch_collection.addEvent("response_treated",(function(e){})),t._onesearch_collection.addEvent("update_title",(function(e){t._updateWidgetTitleWithNbResult(e)})),t._onesearch_collection._ctx_options=t.getOption("in_apps_search"),t._onesearch_collection.setSearchSource(t.getOption("source")),t._searchActions.setCollection(i),t._searchActions.setSkeleton(t._skeleton),i.setSNSkeleton(t);var n={isTransientWidget:!0};"3DDashboard"===D.identifyClientInfo().identifier&&(n.isTransientWidget="true"===t.getOption("transient_context")),i.setTagsTransformer(new M(n)),t.dispatchEvent("onSkeletonReady"),t._model=t._onesearch_collection.getTreeDocument();let s=t.getPreference("informationPanelState");s&&D.isTabletCompactMode()&&(s=!1),e.is(s,"boolean")&&t.setInformationStatus(s)}catch(e){K.log("[3dSearch|buildSR::onSetup]",e)}}},fetchSynthesisSeparately:D.isFetchSynthesisSeparately(),transient_context:t.getOption("transient_context")}},view:"DS/SNResultUX/views/utils/SearchContentSet",viewOptions:t._onesearch_viewOptions.bind(t),fetchMode:"never",swipe:!1,cacheFacets:!1}};return e.merge(i,k.availableviews()),i},_onesearch_viewOptions:function(){var t=this,i=O.getItemViewOptions(this.getOption("resources"));i.request_criteria=t._retrieveRequestCriterias.bind(t),i.request_criteria_without_precond=t._retrieveRequestCriteriasWithoutPrecond.bind(t),i.getCollection=t.getCollection.bind(t);var n=this.getOption("in_apps_search"),s=this.getOption("pinToDashboard");e.is(n)&&e.is(n.multiSel)&&!1===n.multiSel&&(t._selectionMode_techno="oneToOne"),t._in_app_multiSel=t._selectionMode_techno;var o=t._searchActions.getGlobalActions({itemViewOptions:i,XMLViewOptions:O.getXMLViewOptions(),widgetId:t.getOption("widgetId"),in_apps_search:t.getOption("in_apps_search"),pinToDashboard:s,tenant:t.options.resources.active_tenant}),a=[],r=U;if(a=UWA.clone(O.getAvailableViews({activeTenant:this.options.resources.active_tenant}))){this._viewsId=[];for(var l=0;l<a.length;l++)switch(a[l].id){case"thumbnail":a[l].view=j,this._viewsId.push("RespThumbnailGridView");break;case"tilebig":a[l].view=F,this._viewsId.push("RespTextualTileGridView");break;case"tile":a[l].view=L,this._viewsId.push("RespTileGridView");break;case"table":a[l].view=r,w.getOption("enableDataGridView")?this._viewsId.push("DataGridView"):this._viewsId.push("TreeListView")}}D.isFUN109031Active()&&!this.inContextSearch()&&(a.push({id:"what",title:R.get("view.what.title"),nlsKeys:"view.what.title",view:W,actived:!1}),this._viewsId=["WhatView"],a.push({id:"who",title:R.get("view.who.title"),nlsKeys:"view.who.title",view:H,actived:!1}),this._viewsId=["WhoView"],a.push({id:"when",title:R.get("view.when.title"),nlsKeys:"view.when.title",view:X,actived:!1}),this._viewsId=["WhenView"],a.push({id:"where",title:R.get("view.where.title"),nlsKeys:"view.where.title",view:B,actived:!1}),this._viewsId=["WhereView"]);for(var c=0,d=a.length;c<d;c++)e.is(a[c])&&(a[c].itemViewOptions=i,a[c].widgetId=t.getOption("widgetId"),a[c].advSearchMgr=function(){return t.getAdvSearchMgr()});e.is(a)&&a.push({id:"list",view:g,itemViewOptions:i,selectionMode:"oneToOne"});var h={name:"onesearch",lazyRender:!0,detail:{title:R.get("TitleSkeleton"),view:q},actions:e.is(o)?o:{},contents:{useInfiniteScroll:!0,usePullToRefresh:!1,selectionMode:"oneToOne",selectionMode_techno:t._selectionMode_techno,neverAction:t._neverAction,views:a,itemViewOptions:{getCurrentView:function(){var i=null,n=t._skeleton.getViewAt(0);return e.is(n)&&e.is(n.currentViewId)&&e.is(n.contentsViews)&&(i=n.contentsViews[n.currentViewId].nestedView),i},getWidgetId:function(){return t.getOption("widgetId")}}},events:{onSwitch:function(){t._defineViews();var i=t.getOption("in_apps_search"),n="LastSearchViewMode";e.is(i)&&(n="LastInAppsSearchViewMode"),"what"!==arguments[2]&&"who"!==arguments[2]&&"when"!==arguments[2]&&"where"!==arguments[2]&&"myContent"!==arguments[2]&&(b.setItem(n,arguments[2]),b.commit());var s=t._skeleton.getViewAt(0);if(s)for(var o in s.contentsViews)e.is(s.contentsViews[o])&&e.is(s.contentsViews[o].onSwitch,"function")&&s.contentsViews[o].onSwitch(s.currentViewId);var a=arguments[2];u.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:"InvestigateDisplay",persDim:{pd4:a}}}),t._searchActions.setDisplayMode(a),e.is(t.options)&&e.is(t.options.observable)&&e.is(t.options.observable.options)&&e.is(t.options.observable.options.update_preference,"function")&&t.options.observable.options.update_preference("searchViewMode",a),null!==t.getPreviewPanel()&&t.getPreviewPanel().switchViewMode(t.getCurrentView()),null!==t.getInformationPanel()&&t.getInformationPanel().switchViewMode(t.getCurrentView()),t._searchActions&&t._searchActions.updatePopoverPosition(),e.is(t._myDatagridView)&&e.is(t._myDatagridView._deleteCustoPanel,"function")&&t._myDatagridView._deleteCustoPanel(),t.popover&&t.popover.hide(),t.getCollection().custoAction&&t.getCollection().custoAction.popover&&t.getCollection().custoAction.popover.hide(),setTimeout((function(){t._BI_Shades&&t.setShadings(t._BI_Shades)}),500);let r=t._skeleton.getViewAt(0);if(r){let e=t.getCollection().getTreeDocument();e.prepareUpdate(),e.getRoots().forEach((function(e){e._options.subLabels&&e._options.subLabels[r.currentViewId]&&(e._options.subLabel=e._options.subLabels[r.currentViewId])})),e.pushUpdate()}}},switcher:{view:V}},p=null;e.is(UWA.Widgets)&&e.is(UWA.Widgets.instances)&&UWA.Widgets.instances.forEach((function(i){i.id===t.getOption("widgetId")&&e.is(i.data)&&e.is(i.data.searchViewMode,"string")&&(p=i.data.searchViewMode)}));var _=t.getOption("in_apps_search");e.is(_)&&e.is(_.UXOptions)&&e.is(_.UXOptions.viewMode,"string")&&_.UXOptions.viewMode.length>0&&(p=_.UXOptions.viewMode),!e.is(_)||e.is(p)&&e.is(p,"string")&&0!==p.length||(p=b.getItem("LastInAppsSearchViewMode")),!e.is(_)||"what"!==p&&"where"!==p&&"who"!==p&&"when"!==p||(p=b.getItem("LastInAppsSearchViewMode")),e.is(p)&&e.is(p,"string")&&0!==p.length||(p=b.getItem("LastSearchViewMode")),e.is(p)&&e.is(p,"string")&&0!==p.length||(p=w.getOption("defaultViewModeAfterCacheCleaning",{tenant:this.getOption("resources").getActiveTenant()}));for(var f=h.contents.views,m=0,S=f.length;m<S;m++)delete f[m].default,f[m].id===p&&(f[m].default=!0,u.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:"InvestigateDisplay",persDim:{pd3:p}}}));return h.tempSingleIconOnMobile=!0,h["data-rec-id"]=!0,h.isInApps=this.inContextSearch(),h},_failure:function(t,i){if(!e.is(this._skeleton))throw new Error("Error, this._skeleton undefined in SNSkeletonMgt._failure!");if(!(e.is(t)&&e.is(t.state)&&e.is(t.state.currentPage,"number")&&0!==t.state.currentPage)){var n="";e.is(i)&&e.is(i.error)&&e.is(i.error.errorMessage)&&e.is(i.error.errorCode)?(""!==(n=R.get(i.error.errorCode))&&n!==i.error.errorCode||(n=i.error.errorMessage),this._searchActions.setEmptyViewMessage(n)):e.is(i,"string")&&this._searchActions.setEmptyViewMessage(i),r.dispatch("errorManager:tooltip",[])}},_retrieveRequestCriterias:function(){var t={};return e.is(this.getCollection())&&(t=this.getCollection().getRequestCriteria()),t},_retrieveRequestCriteriasWithoutPrecond:function(){var t={};e.is(this.getCollection())&&(t=this.getCollection().getRequestCriteria());var i=O.getContextOptions();if(e.is(i)&&e.is(i.precond)&&e.is(i.default_with_precond)&&e.is(i.show_precond)&&!0===i.default_with_precond&&!1===i.show_precond){var n=" AND "+i.precond;e.is(t.service_params)&&e.is(t.service_params.query)&&-1!==t.service_params.query.indexOf(n,t.service_params.query.length-n.length)&&(t.without_precond=t.service_params.query.replace(new RegExp(n+"$"),""))}return t},_getAndDisplayLastIndexTime:function(){if(w.getOption("show_last_indexation_time")&&!(e.is(this._onesearch_collection)&&e.is(this._onesearch_collection.service_parameters)&&e.is(this._onesearch_collection.service_parameters.query)&&D.SearchTypeEnum.MY_RECENT_CONTENT===this._onesearch_collection.service_parameters.query)){var t=this.getCollection();if(e.is(t)){var i=t.getIndexingDate();if(e.is(i,"object")){var n=null,s="",o=null;for(var a in i)if(e.is(i[a])&&-1!==i[a]){var r=(o=new Date(1e3*i[a])).toLocaleString();s.length>0&&(s+="<br>"),s+=R.replace(R.get("lastVaultIndexedTime"),{vault:a,time:r}),n?i[a]<n&&(n=i[a]):n=i[a]}var l=null;if(n){var c=new Date(1e3*n),d=new Date;l=(d-c)/1e3/3600>24||c.getDay()!==d.getDay()?c.toLocaleString():c.toLocaleTimeString()}this.updateLastIndexInfo(o,l)}}}},_defineViews:function(){var t=this,i=t._skeleton.getViewAt(0);i&&"table"===i.currentViewId?e.is(t._myDatagridView)||(t._myDatagridView=i.contentsViews.table):i&&"tile"===i.currentViewId?e.is(t._myTileGridView)||(t._myTileGridView=i.contentsViews.tile):i&&"thumbnail"===i.currentViewId&&(e.is(t._myThumbnailGridView)||(t._myThumbnailGridView=i.contentsViews.thumbnail))},updateLastIndexInfo:function(e,t){if(this.indexedtimeIcon){let i;this.indexedtimeIcon.className="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-clock";let n=this;if(e){let s=w.getOption("Recent_Content_Delta_Time",{tenant:this.getActiveTenant()});i=R.replace(R.get("lastIndexedTime"),{indexTime:t,recentDelta:s}),this.indexedtimeMenu.items[0].elements.container.setAttribute("timestampIndex",e.getTime()),this.indexedtimeMenu.updateItem({id:this.indexedtimeMenu.items[0].id,text:i}),this.indexedtimeMenu.elements.container.setStyles({"max-width":"434px"}),this.indexedtimeMenu.items[0].elements.container.setStyles({"text-transform":"none"}),this.indexedtimeMenu.items[1].elements.container.setStyles({"text-transform":"none","font-weight":"bold"}),setTimeout((function(){n.updateByUXOptions(t)}),200)}else setTimeout((function(){n.updateLastIndexInfo(e,t)}),200)}else if(D.isFUN109031Active()&&this.errorManagerTooltip)if(e)this.errorManagerTooltip.getBody()&&this.errorManagerTooltip.getBody().getChildren()[0]&&this.errorManagerTooltip.getBody().getChildren()[0].setHTML(R.replace(R.get("lastIndexedTime6w"),{indexTime:t,recentDelta:w.getOption("Recent_Content_Delta_Time",{tenant:this.getActiveTenant()})}));else{var i=this;setTimeout((function(){i.updateLastIndexInfo(e,t)}),200)}},updateByUXOptions:function(t){if(e.is(this.options))if(e.is(this.options.observable))if(e.is(this.options.observable.onesearch_indexedtimeIcon))if(e.is(this.options.observable.onesearch_indexedtimeIcon.tooltip))if(e.is(this.options.observable.onesearch_indexedtimeIcon.tooltip.setBody,"function")){var i=this.getCollection().getSNSkeleton()&&this.getCollection().getSNSkeleton().getOption("in_apps_search"),n=i&&i.UXOptions&&!i.UXOptions.searchRecentContent,s=i&&i.UXOptions&&!i.UXOptions.lastIndexationTime,o=w.getOption("Recent_Content_Delta_Time",{tenant:this.getActiveTenant()});this.options.observable.indexedtimeMenu.enabled=!n,n&&!s?(this.options.observable.onesearch_indexedtimeIcon.style.cursor="default",this.options.observable.onesearch_indexedtimeIcon.tooltip.setBody(R.replace(R.get("lastIndexedTimeTooltip"),{indexTime:t}))):!n&&s?this.options.observable.onesearch_indexedtimeIcon.tooltip.setBody(R.replace(R.get("switchToRecentContent"),{recentDelta:o})):n&&s?this.options.observable.onesearch_indexedtimeIcon.remove():this.options.observable.onesearch_indexedtimeIcon.tooltip.setBody(R.replace(R.get("switchToRecentContent"),{recentDelta:o})+"<br>"+R.replace(R.get("lastIndexedTimeTooltip"),{indexTime:t}))}else K.warn("SNSkeletonMgt_v2.updateByUXOptions no this.options.observable.onesearch_indexedtimeIcon.tooltip.setBody!");else K.warn("SNSkeletonMgt_v2.updateByUXOptions no this.options.observable.onesearch_indexedtimeIcon.tooltip!");else K.warn("SNSkeletonMgt_v2.updateByUXOptions no this.options.observable.onesearch_indexedtimeIcon!");else K.warn("SNSkeletonMgt_v2.updateByUXOptions no this.options.observable!");else K.warn("SNSkeletonMgt_v2.updateByUXOptions no this.options!")},_updateWidgetTitleWithNbResult:function(t){e.is(this._WidgetTitleObj)&&(e.is(t)&&(e.is(t.originalSearchCriteria)&&(this._WidgetTitleObj.search_criteria=t.originalSearchCriteria),e.is(t.search_criteria_to_display,"string")&&(this._WidgetTitleObj.search_criteria=t.search_criteria_to_display),e.is(t.search_criteria,"string")&&t.search_mode,t.search_name?this._WidgetTitleObj.replacingString={search_name:t.search_name,search_criteria:this._WidgetTitleObj.search_criteria}:t.in_apps_search&&t.in_apps_search.search_name?this._WidgetTitleObj.replacingString={search_name:t.in_apps_search.search_name,search_criteria:this._WidgetTitleObj.search_criteria}:this._WidgetTitleObj.replacingString=void 0,e.is(t.applicativeTitle)?(this._WidgetTitleObj.applicativeTitle=t.applicativeTitle,e.is(t.applicativeTitleWithResults)&&(this._WidgetTitleObj.applicativeTitleWithResults=t.applicativeTitleWithResults)):e.is(this.options)&&e.is(this.options.in_apps_search)&&e.is(this.options.in_apps_search.applicativeTitle)?(this._WidgetTitleObj.applicativeTitle=this.options.in_apps_search.applicativeTitle,this._WidgetTitleObj.applicativeTitleWithResults=e.is(this.options.in_apps_search.applicativeTitleWithResults,"string")?this.options.in_apps_search.applicativeTitleWithResults:this.options.in_apps_search.applicativeTitle):(this._WidgetTitleObj.applicativeTitle="",this._WidgetTitleObj.applicativeTitleWithResults="")),this._WidgetTitleObj.nb_results=e.is(this._onesearch_collection)&&e.is(this._onesearch_collection.state)&&e.is(this._onesearch_collection.state.totalRecords)?this._onesearch_collection.state.totalRecords:this._WidgetTitleObj.nb_results=null,this.setTitle(this._WidgetTitleObj))},setTitle:function(t){if(!e.is(t,"object"))throw K.error("Invalid Arg in SNSkeleton.setTitle:",t),new Error("Invalid Arg in SNSkeleton.setTitle!");var i=this.getCustomTitle();if(e.is(i)&&""!==i)return void(_=this.getOption("observable")).dispatchOnTitleUpdate({panelTitle:i});var n=new Date,s=new Date(n.getTime()-6e4*w.getOption("Recent_Content_Delta_Time",{tenant:this.getActiveTenant()})),o=(n-s)/1e3/3600,a=s.toLocaleTimeString();(o>24||s.getDay()!==n.getDay())&&(a=s.toLocaleString()),!e.is(t.nb_results)&&e.is(this._onesearch_collection)&&e.is(this._onesearch_collection.state)&&e.is(this._onesearch_collection.state.totalRecords)&&(t.nb_results=this._onesearch_collection.state.totalRecords),this._WidgetTitleObj=t;var c=this;e.is(c._onesearch_collection)&&e.is(c._onesearch_collection.service_parameters)&&(D.SearchTypeEnum.ADVANCED_SEARCH===c._onesearch_collection.service_parameters.query||e.is(c._onesearch_collection.service_parameters.adv_search)&&!0===c._onesearch_collection.service_parameters.adv_search?t.specialSearchKey="adv_search_launch":D.SearchTypeEnum.FAVORITE_SEARCH===c._onesearch_collection.service_parameters.query||D.SearchTypeEnum.FAVORITE_SEARCH===t.search_criteria?t.specialSearchKey="myContent_searchFav":D.SearchTypeEnum.MY_CONTENT===c._onesearch_collection.service_parameters.query||D.SearchTypeEnum.MY_CONTENT===t.search_criteria?t.specialSearchKey="myContentTitle":D.SearchTypeEnum.MY_RECENT_CONTENT===c._onesearch_collection.service_parameters.query?t.specialSearchKey="*"===this._WidgetTitleObj.search_criteria||this._WidgetTitleObj.search_criteria===D.SearchTypeEnum.MY_RECENT_CONTENT?"AllRecentSearchTitle":"RecentSearchTitle":t.specialSearchKey="SearchTitle");var d,u="",h=e.is(t.searchTitlePrefix,"string")?t.searchTitlePrefix:"";if(!e.is(this._WidgetTitleObj.applicativeTitle)||this._WidgetTitleObj.applicativeTitle.length<=0?(d=e.is(t.specialSearchKey,"string")?t.specialSearchKey:"SearchTitle",e.is(this._WidgetTitleObj.nb_results)&&(d+="WithResults"),e.is(t.search_criteria_to_display,"string")?u=t.search_criteria_to_display:e.is(t.search_criteria,"string")&&t.search_criteria.length>0?u=t.search_criteria:(!e.is(t.search_criteria)||e.is(t.search_criteria,"string")&&0===t.search_criteria.length)&&"adv_search_launch"===t.specialSearchKey&&(u=t.specialSearchKey),u.length>0&&(h+=(h.length>0?" - ":"")+R.replace(R.get(d),e.is(t.replacingString,"object")?t.replacingString:{search_criteria:u,nb_results:t.nb_results,date:a}))):h+=(h.length>0?" - ":"")+R.replace(e.is(this._WidgetTitleObj.nb_results)?this._WidgetTitleObj.applicativeTitleWithResults:this._WidgetTitleObj.applicativeTitle,{search_criteria:e.is(t.search_criteria_to_display,"string")&&t.search_criteria_to_display.length>0?t.search_criteria_to_display:t.search_criteria,nb_results:t.nb_results,date:a}),void 0!==t.replacingString&&e.is(t.replacingString.search_name)){let i=t.replacingString.search_name;void 0!==i&&e.is(t.replacingString.search_criteria)&&""!==t.replacingString.search_criteria&&(h=h.length>0?h.replace(t.replacingString.search_criteria,i):R.replace(R.get(d),{search_criteria:i}))}c._panelTitle!==h&&(c._panelTitle=h);let g="";if((!("false"!==l.getApplicationConfiguration("app.feature.widget-tenant-icon.enabled")||w.getOption("widget-tenant-icon"))||"true"===this.getOption("transient_context"))&&e.is(c._panelTitle,"string")&&c._panelTitle.length>0&&e.is(c.getCollection())){let t=c.getCollection().getSearchRessources();if(e.is(t)&&t.getAvailableTenants().length>1){let i=t.getActiveTenant();e.is(i,"string")&&(g=t.getTenantDisplayName(i),e.is(g,"string")&&g.length>0&&(c._panelTitle+=" ("+g+")"))}}var p=c._panelTitle;if("SearchTitle"===t.specialSearchKey&&u.length>0&&(p=u,e.is(g,"string")&&g.length>0&&(p+=" ("+g+")")),c._panelTitle&&c._panelTitle.length>0){var _=c.getOption("observable");e.is(_)&&e.is(_.dispatchOnTitleUpdate,"function")&&_.dispatchOnTitleUpdate({panelTitle:c._panelTitle,tab_title:p,tab_tooltip:c._panelTitle}),r.dispatch("search:titleUpdate",c._panelTitle)}},getTitle:function(){return e.is(this._panelTitle)||this.setTitle(this._WidgetTitleObj),this._panelTitle},getCustomTitle:function(){var t=this.getSearchWidget();return e.is(t)&&e.is(t.getPreference,"function")&&e.is(t.getPreference("title"))?t.getPreference("title").value:""},getAdvSearchMgr:function(){return this._advSearchMgr},getSearchActions:function(){return this._searchActions},setShadings:function(e){if(this._BI_Shades=e,this.getCollection().length&&this._skeleton){var t=this._skeleton.getViewAt(0);e&&t.setShadings(e)}},getDataGridView:function(){var t=this._myDatagridView;if(!e.is(t)&&e.is(this._skeleton)&&e.is(this._skeleton.getViewAt,"function")){var i=this._skeleton.getViewAt(0);if(e.is(i)){var n=i.currentViewId;"table"===n&&e.is(i.contentsViews,"object")&&e.is(i.contentsViews[n])&&(t=i.contentsViews[n].nestedView)}}return t},computeCtxActions:function(t){if(!e.is(this._onesearch_collection))throw new Error("invalid state: SNSkeletonMgt._onesearch_collection is null !");var n=this;if(e.is(t.data,"array")){for(var s=[],o=t.data.length,r=0;r<o;r++){var l=t.data[r];if(e.is(l)){var c=t.rawData?l["ds6w:what/ds6w:type_value"]:l.get("ds6w:what/ds6w:type_value");e.is(c)||(c=t.rawData?l["ds6w:type_value"]:l.get("ds6w:type_value")),"SavedSearch"===c&&s.push(l.id)}}var d=function(){if(e.is(n._myDatagridView)&&e.is(n._myDatagridView.view))return n._myDatagridView.view.getManager()};if(s.length>0){var u=n._onesearch_collection.getSearchRessources().getFetchOptions({service_name:"actions_for_results",service_data:{ids:s},original_options:{onComplete:function(t){var s={},o=0;if("success"===(s=e.is(t,"string")&&t.length>0?e.Json.decode(t):t).status){var a=UWA.Class.extend(i,{_collection:null,init:function(e){this.setOptions(e),this._collection=e.collection},executeAction:function(){var t=arguments;e.is(t)&&e.is(t.length)&&t.length>0&&(t[0].collection=this._collection);var i=this.getOption("sourcejs");require([i],(function(e){n._onesearch_collection.custoAction=e,e.executeAction.apply(e,t)}))}});for(o=0;o<s.actions.length;o+=1){var r=n._onesearch_collection.get(s.actions[o].id);if(r)for(var l=0;l<s.actions[o].actions.length;l++){var c=s.actions[o].actions[l];c.collection=n._onesearch_collection;var u=new a(c);c.callback=u.executeAction.bind(u),r.actions.push(c)}}d()&&d().updateView()}},onFailure:function(e){K.log("Cannot retrieve the actions"),K.log(e.message)}}});!0===n._onesearch_collection.getSearchRessources().is_odt_source()?K.warn("No action retrieved in ODT mode"):a.authenticatedRequest(u.url,u)}}},getGlobalDownOpen:function(){if(e.is(this._skeleton))return this._skeleton.getViewAt(0).getElement(".fonticon-down-open")},launchGlobalDropdown:function(){var e={target:this.getGlobalDownOpen(),events:{onHide:function(){this.destroy()},onClickOutside:function(){this.destroy()}}};this._model.getSelectedNodes().length>=0&&this.getCurrentView().launchContextMenu(this._model.getSelectedNodes()[0],e)},computeCtxActions2:function(t,i){this.ctxMenu&&this.ctxMenu.isVisible&&(this.ctxMenu.hide(),this.ctxMenu=null),i&&i.collection&&i.collection.hideContextualActions||(e.is(i,"object")?i.skeleton=this:i={skeleton:this},N.computeCtxActions(t,i))},ActivateDeactivateInformationsPanel:function(){var t=this,i=!1;if(null===this._informationZone){require(["DS/SNResultUX/views/utils/InformationsView"],(function(i){let n=t.getSearchWidget(),s=420,o="",a=null,r=null;e.is(n)&&e.is(n.body)?(r=n.body,o=n.id):r=e.extendElement(document.body).getElement(".onesearch_results"),e.is(r)&&(a=r.getDimensions()),e.is(a)&&(s=a.width);var l=null,c=t.getOption("observable");e.is(c)&&(l=c.getOneSearchPreviewAction());var d={parentContainer:t._skeleton.getViewAt(0),lastSelectedItem:t._lastSelectedItem,width:s,widgetId:o,parent:t,oneSearchPreviewAction:l,securityContext:t.getSecurityContext3DSpace()};t._informationZone=new i(d),t._informationZone.initInformationsPanel(),t.breturn=!0})),i=!0}else i=!this._informationZone.getVisibleFlag(),this._lastSelectedItem?(t._informationZone.setActiveObject(t._lastSelectedItem),e.is(t._informationZone.switchVisibleFlag,"function")&&t._informationZone.switchVisibleFlag(),e.is(t._informationZone.activate_deactivateNoPreview,"function")&&t._informationZone.activate_deactivateNoPreview(!1)):(e.is(t._informationZone.activate_deactivateNoPreview,"function")&&t._informationZone.activate_deactivateNoPreview(!0),e.is(t._informationZone.switchVisibleFlag,"function")&&t._informationZone.switchVisibleFlag());return i},ActivateDeactivatePreviewPanel:function(t){var i=this,n=!0,s=function(){setTimeout((function(){i.scrollToCellAt()}),250)};if(null===i.getPreviewPanel()){require(["DS/SNResultUX/views/utils/SearchLightboxPreview"],(function(n){let o,a,r=i.getSearchWidget(),l=420,c="",d=null,u=null,h=null;if(e.is(r)&&e.is(r.body)?(u=r.body,c=r.id,h=e.extendElement(u).getElement(".onesearch_results")):(u=e.extendElement(document.body).getElement(".onesearch_results"),h=u),e.is(u)&&(d=u.getDimensions()),e.is(d)&&(l=d.width),b.getItem("nav_history")){if(e.is(r)){o={parentContainer:e.extendElement(r.elements.body).getElementsByClassName("searchContainer")[0],lastSelectedItem:i._lastSelectedItem,width:l,widgetId:c,parent:i,bNewUI:!1}}}else{let n=!0,s=null;if(!1===E.getinformationPanel())n=!1;else{let t=i.getOption("observable");e.is(t)&&(s=t.getOneSearchPreviewAction())}o={parentContainer:i._skeleton.getViewAt(0),lastSelectedItem:e.is(t)&&e.is(t.clickedItem)?t.clickedItem:i._lastSelectedItem,selectedItems:e.is(t)&&e.is(t.selectedItems)?t.selectedItems:null,width:l,widgetId:c,parent:i,bNewUI:n,oneSearchPreviewAction:s,rootContainer:i._skeleton.placeHolder}}o.securityContext=i.getSecurityContext3DSpace(),i._informationPanel=new n(o),i._informationPanel.initInformationsPanel(),i.breturn=!0,i._informationPanel.addEvent("onExitPreviewMode",(function(){if(e.is(i._listSelectedElementsFromSearchBeforeLaunchingPreview)){K.log("Restoring selection");let t=i._getTreedocumentFromCollection(i.getCollection());e.is(t)&&e.is(t.getXSO,"function")&&(t.getXSO().empty(),t.getXSO().add(i._listSelectedElementsFromSearchBeforeLaunchingPreview))}i._listSelectedElementsFromSearchBeforeLaunchingPreview=null,i.setPreviewStatus(!1),i.dispatchEvent("onExitPreviewMode"),i._managePreviewAndBackshow(a)})),i._informationPanel.addEvent("onPreviewModeRequest",(function(){a=i._managePreviewAndBackhide(),i.setPreviewStatus(!0),i.dispatchEvent("onPreviewModeRequest")})),i.setPreviewStatus(!0),i.dispatchEvent("onPreviewModeRequest"),i._informationPanel.addEvent("onLightBoxPanelCreated",(function(){if(e.is(w.getOption("search_compact_mode"))&&null===i._lastSelectedItem){var t=null;e.is(i.getSearchContentSetHeader,"function")&&(t=i.getSearchContentSetHeader()),!e.is(t)&&e.is(i._skeleton)&&e.is(i._skeleton.container)&&e.is(i._skeleton.container.getElement,"function")&&(t=i._skeleton.container.getElement(".search-content-set-header")),e.is(t)&&!0===t.isHidden()?i._informationPanel.switchVisibleFlag():e.is(i._informationPanel.activate_deactivateNoPreview,"function")&&i._informationPanel.activate_deactivateNoPreview(!0)}else s()})),a=i._managePreviewAndBackhide()}))}else null!==i._informationPanel&&(i._informationPanel.switchVisibleFlag(),!0===(n=i._informationPanel.getVisibleFlag())?i._lastSelectedItem?(i._informationPanel.setActiveObject(i._lastSelectedItem),e.is(i._informationPanel.activate_deactivateNoPreview,"function")&&i._informationPanel.activate_deactivateNoPreview(!1),s()):(e.is(i._informationPanel.activate_deactivateNoPreview,"function")&&i._informationPanel.activate_deactivateNoPreview(!0),i._informationPanel.switchVisibleFlag()):i._informationPanel.switchVisibleFlag());return n&&(D.trackerData.search.previewItem=!0,D.trackerData.search.selectItem&&(D.trackerData.search.scenario="Preview",u.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:D.trackerData.search.scenario,persVal:{pv13:D.trackerData.search.indexItem}}}))),n},sortForAllView:function(t){var i=this;w.getOption("search_web_in_win")&&(i._order_by=t.order_by,i._order_field=t.order_field,i._order_type=t.order_type,i._order_index=t.order_index);var n=this.getOption("observable").getOption("update_preference");if(e.is(n)&&n({order_by:t.order_by,order_field:t.order_field}),!e.is(i._onesearch_collection)||!e.is(i._onesearch_collection.service_parameters))throw new Error("No collection or service_parameters in SNSkeletonMgt.sortForAllView!");if(e.is(i._onesearch_collection.service_parameters.query)&&D.SearchTypeEnum.MY_RECENT_CONTENT===i._onesearch_collection.service_parameters.query)i._onesearch_collection.sortCollection(t);else{var s=i._onesearch_collection;s._resetState(),s.reset(),s.setGlobalOrder(t.order_field,t.order_by,t.order_type,t.order_index);var o=i.getContainer();o&&te.showOverlayLoader(void 0,o),s.getFirstPageOfResults({reset:!0,onComplete:function(){i.getCollection().generateTreeModel(),te.hideOverlayLoader(o)},onFailure:function(){te.hideOverlayLoader(o)}})}switch(t.order_field){case"ds6w:when/ds6w:created":case"ds6w:when/ds6w:modified":case"ds6w:created":case"ds6w:modified":t.order_type="num";break;case"d6w:type":t.order_type="group";break;case"relevance":t.order_type="pertinency";break;default:t.order_type="alpha"}u.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:"GlobalAction",persDim:{pd5:"Sort",pd6:t.order_by,pd7:t.order_type,pd8:t.order_field}}}),b.setItem("searchSort",t),b.commit()},onItemSelected:function(t,i,n,s){let o=this,a=this.getCollection();if(e.is(n)&&(a=n),!e.is(a))return void K.error("No collection in onItemSelect !");let r=null;e.is(t)&&(r=a.get(t)),o._lastSelectedItem=r;let l=a.getTreeDocument();e.is(s)&&(l=s);let c=l.getXSO().get(),d=c.length;u.publish({channel:this.getOption("messagingChannel"),topic:"updateSelectionNumber",data:{number:e.is(d)?d:0,isMultiSelMode:this.getCurrentView()&&this.getCurrentView().isMultiSelMode()}});let h=[];c.forEach((function(e){h.push(a.get(e._options.id))}));let g=h.length;u.publish({channel:this.getOption("messagingChannel"),topic:"onItemSelection",data:{lastItemSelected:g>0?r:null}});let p=a.getTaggerProxy(),_=[];if(0===g)o._lastItemsSelected=[],o._modelSelected=[],e.is(o._searchActions.setSelected,"function")&&o._searchActions.setSelected(o._modelSelected),o.debounceTimeout&&clearTimeout(o.debounceTimeout),o.debounceTimeout=setTimeout((()=>{o.notifyReset()}),1e3);else{o._selectionOccurred=!0,e.is(o._searchActions.setSelected,"function")&&o._searchActions.setSelected(h);let t=[],i=[],n={},s=null,a=null;for(let o=0,r=g;o<r;o++){let r=h[o];if(!e.is(r))throw new Error("Invalid itemModel in SNSkeletonMgt.onItemSelect");if(s=r.get("id"),!e.is(s,"string"))throw new Error("Unable to get id of object in SNSkeletonMgt.onItemSelect");t.push({objectType:r.get("ds6w:type_value"),objectId:s,envId:r.getPlatformID(),contextId:""}),_.push({id:s,session_object:r.hasOwnProperty("session_object")});let l=r.getSourceID(),c=l||"3dspace",d=r.getPlatformID();a=D.getTaggerSubjectURI({subjects:[{id:s,source:c,platform:d}],source:c,platform:d,service:l?r.getServiceID():"3DSpace"})[s],a&&(i.push(a),e.is(l,"string")&&(n[a]=this.getTaggerService(r)))}let r=E.buildCompassSelectionData({widgetId:e.is(o.getOption("widgetId"))?o.getOption("widgetId"):"",selectedModels:h});if(1===g){let i=t[0];e.is(r)&&e.is(r.data)&&e.is(r.data.items,"array")&&1===r.data.items.length&&(i=r.data.items[0]),this._compass_socket.dispatchEvent("onSetObject",i)}this._compass_socket.dispatchEvent("onSetX3DContent",r),this.notifySelectionAddinMode(r),e.is(p)&&p.focusOnSubjects(i,null,n)}if(w.getOption("search_web_in_win")){let i=!0;if(e.is(t),!0===i){let e={objets_name:_};e.tabID=this.getOption("observable").getTabID(),this.onDispatchToWin(e,"onAddToCSO")}}this.dispatchEvent("selected_obj",h),/*!UWACore.is(selectedViewItems) && selectedViewItems === null &&*/
e.is(window.event,"object")&&e.is(window.event.currentTarget)&&(o._currentItemView=window.event.currentTarget,o._currentItemView.container=window.event.currentTarget);let f=!1;g>0&&e.is(o._lastSelectedItem)&&h.forEach((function(e){e.id===o._lastSelectedItem.id&&(f=!0)})),!1===f&&g>0&&(o._lastSelectedItem=h[g-1]);D.isInTheSimpleSearch({tenant:o.getActiveTenant()}),o.isCompactMode();let m=o.getPreviewPanel();m=o.getPreviewPanel(),o._lastSelectedItem=null,g&&(o._lastSelectedItem=h[g-1]),r=o._lastSelectedItem,o.options.events&&o.options.events.onItemViewClick&&o.options.events.onItemViewClick(r)},getTaggerService:function(e){return D.getTaggerService(e)},restoreSelectionOnTabActivation:function(){var t=this.getCollection();let i=this._getTreedocumentFromCollection(t);if(e.is(i)&&e.is(i.getXSO())){var n=i.getXSO().get(),s=[];n.forEach((function(e){s.push(t.get(e._options.id))}));var o=[];if(s.length>=0){for(var a=[],r=null,l=0,c=s.length;l<c;l++){var d=s[l];if(!e.is(d))throw new Error("Invalid itemModel in SNSkeletonMgt.onItemSelect");if(r=d.get("id"),!e.is(r,"string"))throw new Error("Unable to get id of object in SNSkeletonMgt.onItemSelect");a.push({objectType:d.get("ds6w:type_value"),objectId:r,envId:d.getPlatformID(),contextId:""}),o.push({id:r,session_object:d.hasOwnProperty("session_object")})}var u=E.buildCompassSelectionData({widgetId:e.is(this.getOption("widgetId"))?this.getOption("widgetId"):"",selectedModels:s});if(1===s.length){var h=a[0];e.is(u)&&e.is(u.data)&&e.is(u.data.items,"array")&&1===u.data.items.length&&(h=u.data.items[0]),this._compass_socket.dispatchEvent("onSetObject",h)}this._compass_socket.dispatchEvent("onSetX3DContent",u),this.notifySelectionAddinMode(u)}if(w.getOption("search_web_in_win")){let e={objets_name:o};this.onDispatchToWin(e,"onAddToCSO")}}},onItemUnselected:function(e){return this.onItemUnselectedUpdate(),K.log("onItemUnselected:",e),this.onItemSelected(null)},onItemUnselectedUpdate:function(){this.getOption("observable").updateUnselectedResults()},onItemTitleClick:function(t,i,n,s){var o=this.getOption("in_apps_search"),a=e.is(o),r=ee.isAdvSearchRun(o),l=this.getOption("addinMode"),c=e.is(l,"string")&&l.length>0;if(a&&!r&&!c)return;const d=e.is(t,"object")&&e.is(t._options,"object")&&e.is(t._options.id,"string")?t._options.id:null;let u=this,h=u.getCurrentView().id;if("what"===h||"who"===h||"when"===h||"where"===h){let e=this._getTreedocumentFromCollection(n);u.getPreviewPanel()&&u.getPreviewPanel().changeModel(e)}if(!0===w.getOption("search_web_in_win")||!0===u.inContextSearch()&&!r)(!0!==u.isCompactMode()||!0!==this.inContextSearch()||e.is(i)&&e.is(i.realTitleClick,"boolean")&&!0===i.realTitleClick)&&u._onItemTitleClick(t,i,n);else{let s=e.is(n)?n:this._onesearch_collection,o=s.get(d);if(e.is(o)){let o=E.buildCompassSelectionData({widgetId:e.is(u.getOption("widgetId"))?u.getOption("widgetId"):"",selectedModels:[s.get(d)]});this.doubleClickHandler(d,o,s,(function(){K.log("failed to open, should try preview!"),u._onItemTitleClick(t,i,n)}))}}},_onItemTitleClick:function(t,i,n){const s=e.is(t,"object")&&e.is(t._options,"object")&&e.is(t._options.id,"string")?t._options.id:null,o=e.is(n)?n:this.getCollection();if(e.is(o)||K.error("SNSkeletonMgt_v2.onItemTitleClick: No collection!"),this._listSelectedElementsFromSearchBeforeLaunchingPreview=null,e.is(t._getID,"function")){let i=this._getTreedocumentFromCollection(n);if(e.is(i)&&e.is(i.getXSO,"function")){const n=i.getXSO();e.is(n)&&e.is(n.get,"function")&&(this._listSelectedElementsFromSearchBeforeLaunchingPreview=n.get(),n.empty(),n.add(t))}}let a;e.is(i)&&e.is(i.model)?a=i.model:e.is(s)?a=o.get(s):e.is(i.object_ids)&&i.object_ids.length>0&&(a=o.get(i.object_ids[i.object_ids.length-1])),null===this.getPreviewPanel()?this.ActivateDeactivatePreviewPanel({clickedItem:a,selectedItems:e.is(this._listSelectedElementsFromSearchBeforeLaunchingPreview)&&this._listSelectedElementsFromSearchBeforeLaunchingPreview.length>1?this._listSelectedElementsFromSearchBeforeLaunchingPreview:null}):!1===this.getPreviewPanel().getVisibleFlag()&&void 0!==a&&this.getPreviewPanel().switchVisibleFlag(),e.is(this.getPreviewPanel())&&(e.is(a)?a&&this.getPreviewPanel().setActiveObject(a):this.getPreviewPanel().setActiveObject(null))},onItemSignatureClick:function(t,i,n){let s=null;switch(n.name){case"ds6w:community":s=null!=t.options.grid["ds6w:containerUid"]?t.options.grid["ds6w:containerUid"]:t.options.id;break;case"ds6w:responsible":s="iam:"+t.options.grid["ds6w:responsibleUid"];break;case"ds6w:dataSource":"3DDrive"===n.source&&(s=t.options.id);break;case"ds6w:project":s=t.options.id;break;default:K.log("[dbl click] - failed to recover item ID")}let o=E.buildCompassSelectionData({widgetId:e.is(this.getOption("widgetId"))?this.getOption("widgetId"):"",selectedModels:[i.get(t.options.id)]});"ds6w:responsible"!==n.name&&"ds6w:community"!==n.name||(o.data.items[0].templateModel=!0,o.data.items[0].objectId=s,o.data.items[0].serviceId="3DSwym",o.data.items[0].objectType="ds6w:responsible"===n.name?"pno:Person":"swym:Community"),"3DDrive"===n.source&&"ds6w:dataSource"===n.name&&(o.data.items[0].templateModel=!0,o.data.items[0].serviceId=n.source,o.data.items[0].action_id="folder"),s&&o&&this.doubleClickHandler(s,o,i,(()=>{K.log("[dbl click] - failed to open, should try preview!")}))},_selectAll:function(){"oneToOne"!==this._selectionMode_techno&&this._model.getXSO().get().length!==this._model.getRoots().length&&this._model.selectAll()},_toggleLoader:function(){let t,i=this.getCurrentView();if(e.is(i)&&(t=i.container),e.is(this._mySpinner)&&e.is(this._mySpinner.elements)){let i=this._mySpinner.elements.container.getParent().getParent();e.is(i)&&i!==t&&this._mySpinner.elements.container.getParent().inject(t),this._mySpinner.toggle()}else{var n=o.create("div",{class:"datagrid-loader"});n.setStyle("text-align","center"),n.setStyle("position","absolute"),n.setStyle("left","calc(50% - 15px)"),n.setStyle("bottom","8px"),n.inject(t),this._mySpinner=new f({className:"search-spinner"}).inject(n).show()}},loadMoreData:function(t,i){K.log("Infinite scroll : loading more models..."),u.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"SearchResult",action:"Scroll"}});var n=this,s=this.getCollection();e.is(s)&&s.hasNextPage()&&(!e.is(this._mySpinner)||e.is(this._mySpinner)&&!this._mySpinner.isVisible)&&this._toggleLoader(),!1===s._search_in_progress&&!1===s.interruptRequested()&&s.hasNextPage()?(D.isFetchSynthesisSeparately()&&(s.service_parameters.with_synthesis=!1),s.getNextPage({remove:!1,onComplete:function(){s.generateTreeModel(),n._toggleLoader(),n._updateWidgetTitleWithNbResult(),n._getAndDisplayLastIndexTime(),t&&t()},onFailure:function(){n.dispatchEvent("on_search_failure",R.get("on_search_failure")),i&&i()}})):t&&t()},_loadFirstPage:function(t){var i=this,n=this.getCollection(),s=this.getContainer();n.service_parameters&&!n.service_parameters.adv_search&&!s&&i._skeleton.container&&te.showOverlayLoader(void 0,i._skeleton.container);var o,a=!1;if(n._ctx_options&&n._ctx_options.advanced_search&&n._ctx_options.advanced_search.searchOnInit&&(a=!0),i._informationPanel&&!0===i._informationPanel.getVisibleFlag()&&(e.is(i._informationPanel.activate_deactivateNoPreview,"function")&&i._informationPanel.activate_deactivateNoPreview(!0),i._informationPanel.setActiveObject(null)),!e.is(n.getRequestCriteria().service_params)||n.getRequestCriteria().service_params.query!==D.SearchTypeEnum.ADVANCED_SEARCH&&""!==n.getRequestCriteria().service_params.query||!e.is(n.getRequestCriteria().service_params.adv_search)||e.is(n.getRequestCriteria().service_params.refine)&&e.is(n.getRequestCriteria().service_params.refine.PLMParameters)&&e.is(n.getRequestCriteria().service_params.refine.PLMParameters.plmparam)&&Object.keys(n.getRequestCriteria().service_params.refine.PLMParameters.plmparam).length>0||a){s&&te.showOverlayLoader(void 0,s);var l=this;if(e.is(l)){var c=l.getHelperCollectionId(),d=function(o){e.is(o)&&!0===o._isAHelper&&(l.copyDataFromHelperCollection(n,o),n._lastFetchOptions=o._lastFetchOptions,n.fetchAndSetTags(),n.dispatchAsEventListener("on_sync")(),e.is(o._parse_alert,"array")&&o._parse_alert.length>0&&l._failure(o,{service:o.snservices,messages:o._parse_alert}),n._setTagsPromise&&n._setTagsPromise.promise.then((()=>{K.log("onFedComplete - delete : "+c),D.deleteHelperCollection(c)}))),e.is(o)&&!0===o._failureView&&D.deleteHelperCollection(c),n.generateTreeModel(!0),l._updateWidgetTitleWithNbResult(),l._getAndDisplayLastIndexTime(),l.getContainer()&&te.hideOverlayLoader(l.getContainer()),t&&e.is(t.onComplete,"function")&&t.onComplete.call(this);var a=null;try{a=l.inContextSearch()}catch(e){K.log(" FedSearch callback in context state fail",e)}if(D.isFUN109031Active()&&!1===a&&e.is(n.service_parameters)&&e.is(n.service_parameters.query)&&/^#myContent/.test(n.service_parameters.query)&&(e.is(n.allMyContent)&&!0===n.allMyContent?r.dispatch("fedsearch:myContent",[{groups:[],allMyContent:!0}]):r.dispatch("fedsearch:myContent",[])),i._refreshLimitReachedStatusFUN141960(n),b.getItem("nav_history")&&i.dispatchEvent("onFedSearchComplete",n.totalCount),o.getRequestCriteria()&&o.getRequestCriteria().service_params&&u.publish({channel:i.getOption("messagingChannel"),topic:"addSortItem",data:{order_by:o.getRequestCriteria().service_params.order_by,order_field:o.getRequestCriteria().service_params.order_field,nlsName:void 0}}),e.is(o)&&e.is(o._collabSpaceError)&&!0===o._collabSpaceError){var d={model:{get:function(){return"Grid_Custo"}},getContent:function(){return i.elements.onesearchactions},isError:!0};i._searchActions.searchSettingsUI(d),!0===i._diplaySecurityContextInfoOnce&&(i._diplaySecurityContextInfoOnce=!1)}u.publish({channel:"3dSearch-back-arrow-view",topic:"update",data:{number:n.totalCount}}),s&&te.hideOverlayLoader(s)},h=function(t,n){var o="";e.is(i._searchActions)&&e.is(i._searchActions.setEmptyViewMessage,"function")&&(e.is(n,"object")&&e.is(n.error,"object")&&e.is(n.error.errorMessage,"string")&&(o=n.error.errorMessage),i._searchActions.setEmptyViewMessage(o)),t.dispatchAsEventListener("onError")();var a=i.getCurrentView();e.is(a)&&e.is(a.checkToDisplayEmptyView,"function")&&a.checkToDisplayEmptyView(),l.getContainer()&&te.hideOverlayLoader(l.getContainer());var r=D.getHelperCollection(c);e.is(r)&&(t._fedSearchLabel=UWA.clone(r._fedSearchLabel)),l._failure(t,n),D.deleteHelperCollection(c),s&&te.hideOverlayLoader(s)},g=D.getHelperCollection(c);e.is(g)?g._currentState===D.HelperCollectionStatus.SEARCH_IN_PROGRESS?(K.log("helper search_in_progress"),g._CBOnComplete=d,g._CBOnFailure=h):g._currentState===D.HelperCollectionStatus.SEARCH_SUCCEEDED?(K.log("helper search_succeeded"),d(g)):g._currentState===D.HelperCollectionStatus.SEARCH_FAILED&&(K.log("helper search_failed"),e.is(g.fedSearch_error)&&h(g,g.fedSearch_error)):n.getFirstPageOfResults({reset:!0,onComplete:d,onFailure:h})}}else{var p=this._advSearchMgr;!e.is(p)||e.is(p._dataSetsForSource)&&e.is(p._dataSetsForSource.options)&&e.is(p._dataSetsForSource.options.datasets)&&e.is(p._dataSetsForSource.options.datasets.items)&&Object.keys(p._dataSetsForSource.options.datasets.items).length>0||p.clearFilters()}e.is(n.getRequestCriteria())&&e.is(n.getRequestCriteria().service_params)&&e.is(n.getRequestCriteria().service_params.idWaitLoading)&&(o=n.getRequestCriteria().service_params.idWaitLoading,Y.WaitManager.removeWaitCondition(o));var _=+new Date-D.trackerData.timeData.searchDataTime;u.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:"InvestigateDisplay",persDim:{pd6:"Search display Time"},persVal:{pv6:_}}})},_updateResultsToNative:function(t){var i=this.getContainer();if(w.getOption("search_web_in_win")){e.is(t)||(t=this.getCollection());var n=e.is(w.getOption("tabbed_ui_support_level"));if(e.is(t)){for(var s=[],o=t.pluck("id"),a=0;a<o.length;a++)n?s.push({id:o[a]}):s.push(o[a]);var r={notif_name:"onResultsUpdate",notif_parameters:{tabID:this.getTabID(),objects:s}};n||(r.notif_parameters=s),setTimeout((function(){window.hasOwnProperty("sendNotificationWebInWin")&&e.is(sendNotificationWebInWin,"function")&&sendNotificationWebInWin("QueryEnd",JSON.stringify({nb_results:t.hits,collection:t})),i&&te.hideOverlayLoader(i)}),1e3),this._searchcom_socket.dispatchEvent("onDispatchToWin",r,"search_web_in_win")}}else i&&te.hideOverlayLoader(i)},setup:function(){var e=this;this.listenTo(this.getCollection(),{onAdd:function(){},onRemove:function(){},onSort:function(){},onAnyEvent:function(){},onReset:function(){e.getCollection()&&e.getCollection().service_parameters&&e.getCollection().service_parameters.adv_search&&!e.getCollection().advanced_criteria&&e.getCollection().initTreeDocument(),null!==e.getInformationPanel()&&e.getInformationPanel().updateSelection(null)},on_sync:function(t){t&&t.generateTreeModel(),e._updateResultsToNative(t)},onInitTreeDocument:function(t){e._model=t,e.getPreviewPanel()&&e.getPreviewPanel().changeModel(t)}})},notifySelectionAddinMode:function(t){if(e.is(this.getOption("addinMode"),"string")){e.is(t)||(t=E.buildCompassSelectionData({widgetId:this.getOption("widgetId"),selectedModels:[]}));let i=JSON.stringify({event:"selection",source:t.source,version:t.version,content:t});K.log("publishing webinwin:web:notification SELECTION event, data:"+i),l.publish("webinwin:web:notification",i)}},getSearchWidget:function(){var t=null,i=this.getOption("observable");return e.is(i)&&e.is(i.getSearchWidget,"function")&&(t=i.getSearchWidget()),t},getTabID:function(){var t=null,i=this.getOption("observable");return e.is(i)&&e.is(i.getTabID,"function")&&(t=i.getTabID()),t},setPrintWindow:function(e){this._printWindow=e},getSocketID:function(t){var i=e.is(t)?this._WebInWinCtxActionSocket:this._searchcom_socket;if(i)return i.id},handleKeyboardEvent:function(e){var t=UWA.Event.whichKey(e);"ctrl+a"===t||"ctrl+shift+a"===t?(this.onFetchAndSelectAllCallback({DoSelection:!0}),"ctrl+a"===t&&(e.preventDefault(),e.stopPropagation())):D.isFUN109031Active()&&!this.inContextSearch()&&"ctrl+g"===t&&this.switchOnView("map")},getActiveTenant:function(){if(this.getCollection()&&this.getCollection().getSearchRessources())return this.getCollection().getSearchRessources().getActiveTenant()},ActivatePreviewByClick:function(){let t=!0;!0===this.inContextSearch()&&(t=!1);let i=this.getOption("addinMode");return e.is(i,"string")&&i.length>0&&(t=!1),t},inContextSearch:function(){return w.getOption("debug")&&K.log("Skeleton in apps mode:",e.is(this.getOption("in_apps_search"),"object")),e.is(this.getOption("in_apps_search"),"object")},isCompactMode:function(){let t=w.getOption("search_compact_mode");return e.is(t)&&!0===t},refreshSortUI:function(e){b.getLocalStorageItem("3dSearch-sidePanelPositionBack");e||(e="mobile"===D.getDeviceType()?"mobile":D.getViewportOrientation()),"mobile"===e||"portrait"===e?this._skeleton.container.getElement(".onesearch_sortcontent").addClassName("mobile"):"landscape"===e&&this._skeleton.container.getElement(".onesearch_sortcontent").removeClassName("mobile")},refreshUIAfterRender:function(){let t=this;this.refreshSortUI(),D.isTabletCompactMode()?this._skeleton.container.getElement(".search-content-set-header .search-content-set-actions").setStyle("display","none"):this._skeleton.container.getElement(".search-content-set-header .search-content-set-actions").setStyle("display",""),e.extendElement(this._skeleton.container).getElement("#switch-view-button").addEventListener("click",(function(e){D.isTabletCompactMode()&&setTimeout((()=>{t._skeleton.container.getElement(".search-content-set-header .search-content-set-actions").setStyle("display","none")}),1100),D.isTabletCompactMode()&&document.querySelectorAll('[name="table"]')[0]?document.querySelectorAll('[name="table"]')[0].setStyle("display","none"):document.querySelectorAll('[name="table"]')[0]&&document.querySelectorAll('[name="table"]')[0].setStyle("display","")})),e.extendElement(this._skeleton.container).getElement("#switch-view-button").addEventListener("touchstart",(function(e){D.isTabletCompactMode()&&setTimeout((()=>{t._skeleton.container.getElement(".search-content-set-header .search-content-set-actions").setStyle("display","none")}),1100),setTimeout((()=>{document.querySelectorAll('[name="table"]')[document.querySelectorAll('[name="table"]').length-1];D.isTabletCompactMode()?document.querySelectorAll('[name="table"]')[document.querySelectorAll('[name="table"]').length-1].setStyle("display","none"):document.querySelectorAll('[name="table"]')[0]&&document.querySelectorAll('[name="table"]')[document.querySelectorAll('[name="table"]').length-1].setStyle("display","")}),450)}));var i=null,n=w.getOption("search_compact_mode");if(e.is(n)&&!0!==n){var s=!1;if(e.is(this.getInformationStatus()))!0===this.getInformationStatus()&&(s=!0);else{s=!1;var o=this.getPreference("informationPanelState");e.is(o,"boolean")&&(s=o)}!0===s&&null===this.getInformationPanel()&&(i=this.getOption("observable"),e.is(i)&&(this.ActivateDeactivateInformationsPanel(),i.manageInformationPanel(!0)))}},getSecurityContext:function(){var t,i,n;return i=e.is(this.getSearchWidget,"function")&&e.is(this.getSearchWidget())&&e.is(this.getSearchWidget().getValue,"function")?this.getSearchWidget().getValue("securityContext"):b.getItem("securityContext"+this.getActiveTenant()+D.getUserId()),e.is(i)&&(n=JSON.parse(i)),""===(t=e.is(n)&&e.is(n.csName)?n.csName:"")&&(t=this.getSecurityContext3DSpace()),t},getSecurityContext3DSpace:function(){this.getCollection();let t=this._onesearch_collection,i={isPinnedWidget:t._isPinnedWidget(),pinWdgSC:t._isPinnedWidget()&&e.is(t._snSkeleton.getSearchWidget())?t._snSkeleton.getSearchWidget().getValue("securityContext"):void 0};return I.get3DSpaceLoginSC(i)},getInformationStatus:function(){return this._informationState},setInformationStatus:function(e){this._informationState=e,this.setPreference("informationPanelState",e)},getInformationPanel:function(){return this._informationZone},getPreviewStatus:function(){return this._previewState},setPreviewStatus:function(e){this._previewState=e},getPreviewPanel:function(){return this._informationPanel},getMessagingChannel:function(){return this.getOption("messagingChannel")},setCurrentTabId:function(e){this._currentTabId=e},getCurrentTabId:function(){return this._currentTabId},getPreference:function(t){var i=null,n=this.getSearchWidget();return e.is(n)&&0!==n.id.indexOf("preview")&&(i=n.getValue(t)),e.is(i)||(i=b.getItem(t+this.getTabID())),e.is(i)||(i=b.getItem(t)),e.is(i)||(i=w.getOption(t)),i},setPreference:function(t,i){var n=this.getSearchWidget();e.is(n)&&0!==n.id.indexOf("preview")?n.setValue(t,i):(b.setItem(t+this.getTabID(),i),b.setItem(t,i),b.commit())},switchOnView:function(t){e.is(this._skeleton.getViewAt(0))&&this._skeleton.getViewAt(0).switcherView.switchView(t);let i=this._skeleton.container.getElement(".search-content-set-header");e.is(i)&&("where"===t||D.isFUN127551Active()&&("when"===t||"who"===t||"what"===t)?i.addClassName("forceMarginWHERE"):i.removeClassName("forceMarginWHERE")&&this.getOption("observable").getRefineHelpers().hideGlobeView())},maskContainer:function(){this.getOption("observable").maskContainer()},unmaskContainer:function(){this.getOption("observable").unmaskContainer()},_getTreedocumentFromCollection:function(t){return e.is(t)&&t.getTreeDocument()},_managePreviewAndBackshow:function(t){t.back;let i=t.globe,n=this.getOption("observable");"where"!==this.getCurrentView().id&&!0!==i||e.is(n)&&n.getRefineHelpers().showGlobeView()},_managePreviewAndBackhide:function(){let t=this,i=!1,n=(t.getCurrentView()&&t.getCurrentView().id,t.getOption("observable"));if(e.is(n)){let t=n.getEmbeddedTaggerTags();if(e.is(t)&&e.is(t.groups)){let e=t.groups[0];"computedCountryInfo"===(e?e.predicate:"")&&(n.getRefineHelpers().hideGlobeView(),i=!0)}}return{back:!1,globe:i}},updateCounterView:function(t,i){let n=this,s=n._skeleton&&n._skeleton.getContent()&&n._skeleton.getContent().querySelector(".set-detail-view-count");e.is(s)&&(s.textContent=t,s.title="",e.is(i)&&(s.title=i))},_updateNLQSearchString:function(){let t=this,i=this.getCollection().service_parameters.search_criteria_input_string,n=t._skeleton&&t._skeleton.getContent()&&t._skeleton.getContent().querySelector(".container-nlqString");e.is(n)&&(i?(n.textContent=i,n.show()):n.hide())},getWhereView:function(){let t;if(e.is(this._skeleton)&&e.is(this._skeleton.getViewAt,"function")){let i=this._skeleton.getViewAt(0);if(e.is(i)){let n="where";e.is(i.contentsViews,"object")&&e.is(i.contentsViews[n])&&(t=i.contentsViews[n].nestedView)}}return t},onDispatchToWin:function(t,i){!0===w.getOption("search_web_in_win")&&(e.is(t)?this._searchcom_socket.dispatchEvent("onDispatchToWin",{notif_name:i,notif_parameters:JSON.stringify(t)},"search_web_in_win"):this._searchcom_socket.dispatchEvent("onDispatchToWin",{notif_name:i},"search_web_in_win"))},_refreshLimitReachedStatusFUN141960:function(t){var i=this.getOption("observable");if(i.elements.searchResultWarningMessage){i.elements.searchResultWarningMessage.show();var n=i.elements.searchResultWarningMessage.getElement(".notification-link"),s=i.elements.searchResultWarningMessage.getElement(".notification-span");t._ctx_options||i._getSearchType()===D.SearchTypeEnum.ADVANCED_SEARCH||e.is(w.getOption("search_compact_mode"))&&!0===w.getOption("search_compact_mode")?(n.hide(),s.show()):(n.show(),s.hide()),t?(this.limitReachedFUN141960=t.isSearchRespEstimated(),i.elements.searchResultWarningMessage&&this._toggleSearchResultWarningMessage(this.limitReachedFUN141960,i)):this._hideSearchResultWarningMessage(i)}},_hideSearchResultWarningMessage:function(e){e.elements.searchResultWarningMessage&&e.elements.searchResultWarningMessage.hide()},_toggleSearchResultWarningMessage:function(e,t){e?t.elements.searchResultWarningMessage.show():t.elements.searchResultWarningMessage.hide()},setWidgetResultViewCusto:function(t){this.getOption("observable").set3DDWidgetOption("resultview_custo",e.clone(t))},getWidgetResultViewCusto:function(){return this.getOption("observable").get3DDWidgetOption("resultview_custo")}})})),define("DS/SNResultUX/SNResultMgt",["UWA/Core","UWA/Utils","UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","UWA/Class/Collection","UWA/Element","UWA/Utils/InterCom","DS/WebappsUtils/Performance","DS/PlatformAPI/PlatformAPI","DS/MessageBus/MessageBus","DS/SNInfraUX/SearchRessources","DS/SNInfraUX/SearchDebug","DS/SNInfraUX/SearchCom","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","css!DS/SNResultUX/SNResultUX","DS/SNResultUX/layouts/SNSkeletonMgt_v2","DS/TagNavigatorProxy/TagNavigatorProxy","DS/SNResultUX/utils/ResultUX_customization","DS/SNResultUX/utils/ResultsUtils","DS/SNResultUX/utils/SearchServices","DS/SNResultUX/utils/SearchViewOptions","text!DS/SNResultUX/assets/SNResultUX_custo.json","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/SNInfraUX/PredefinedQueries","DS/SNInfraUX/SNUnitConversion","DS/SNInfraUX/Logger","DS/SNInfraUX/RefineHelper/RefineHelper","DS/SNInfraUX/utils/WildcardMgr","DS/SNResultUX/utils/AdvSearchMgr","DS/SNResultUX/utils/SNResultTypeCustoHelper","DS/SNResultUX/utils/SearchSortView","DS/SNResultUX/views/utils/SwitcherView6wGrouping","DS/UIKIT/DropdownMenu","DS/UIKIT/Tooltip","DS/SNResultUX/views/utils/SearchHistoryTree","DS/i3DXCompassServices/i3DXCompassPubSub","DS/PubSub/PubSub","DS/SNInfraUX/SearchPreferences","DS/WebRecordEnabler/Adapter","DS/SNResultUX/utils/OneSearchActions","DS/SNResultUX/unitconversion/SNUnitConversionHelper","DS/SNResultUX/utils/6WRefineHelpers","DS/SNResultUX/utils/SearchTagger","DS/SNInfraUX/SearchLogin","DS/SNResultUX/utils/ExternalComponentHelpers","DS/SNSearchResultsCusto/utils/SearchResultsCustomizationPreferences","DS/Controls/ComboBox","DS/SNInfraUX/SearchControlCenterFetchService"],(function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_,f,m,S,v,w,b,C,y,D,I,T,A,x,N,E,O,k,P,M,R,V,U,L,F,j,W,B,X,H,G,z,q,Q,Z){"use strict";return i.extend(n,s,h,{uwaClassName:"DS/SNResultUX/SNResultMgt",name:"onesearch_results",_resources:null,_taggerProxy:null,_search_in_title:!1,getTaggerProxy:function(){return this._taggerProxy},_searchcom_socket:null,_search_criteria:"",_originalSearchCriteria:"",_search_tag_filter:{},_selected_objects:null,_adv_search:!1,_advanced_criteria:"",_ok_Button:null,_apply_Button:null,_adv_search_field:null,onesearch_indexedtimeIcon:null,indexedtimeMenu:null,_isMultiSelModeOnTouch:!1,_historySearch:null,_headersSearch:null,_idWaitLoading:null,_compass_socket:null,_subscriptions:null,_keydownEventHandler:null,_minimizedSidePanel:!1,_forceOnSearch:!1,_oneSearchActions:null,_detailsviewSelected:null,oRefineHelpers:null,getRefineHelpers:function(){return this.oRefineHelpers},embeddedTaggerContainer:null,searchLayoutContainer:null,embeddedTaggerTags:null,getEmbeddedTaggerTags:function(){return this.embeddedTaggerTags},_DockingElement:null,_collapser:null,_icon:null,_snUnitConversionHelper:null,_searchBackViewContainer:null,_searchBackViewContainerContent:null,_searchBackViewContainerContent:null,_searchTaggerHelper:null,updateSNtabbedContainerClass:null,embeddedTaggerContent:null,_BroadcastchannelManager:null,_BroadcastsearchDropDownManager:null,_options:null,getOptions:function(){return this._options},init:function(t){if(this._options=t,this.embeddedTaggerContainer=null,this.searchLayoutContainer=null,this.embeddedTaggerTags=null,this.oRefineHelpers=new X({referer:this}),this._searchTaggerHelper=new H(this),this._DockingElement=null,this._collapser=null,this._icon=null,this._searchBackViewContainer=null,this._searchBackViewContainerContent=null,this.updateSNtabbedContainerClass=null,this._snUnitConversionHelper=new B,this.embeddedTaggerContent=null,this._BroadcastchannelManager=null,this._BroadcastsearchDropDownManager=null,A.groupCollapsed("SNResultMgt.init"),A.log("options:"),t){let e="";try{e=JSON.parse(JSON.stringify(t))}catch(i){e=t}A.log(e)}this._subscriptions={},this._detailsviewSelected=null,t.viewData||(t.viewData={},t.viewData.global_actions=t.incontext_global_actions),_.isODTMode()&&!document.body.hasClassName("isInSearchODTMode")&&document.body.addClassName("isInSearchODTMode"),this._parent(t),e.is(t)&&e.is(t.search_settings)&&p.initialize({search_settings:t.search_settings}),window.addEventListener("resize",this.updateDimension.bind(this)),!0===p.getOption("isSearchActionConfigured")&&_.checkCustomerConfigs({resources:new u(this.getOption("resources"))}).then((function(e){A.log("checkCustomerConfigs SUCCESS : "+e)}),(function(e){A.log("checkCustomerConfigs FAILURE : "+e)})),this._initSearchComSocket(),t.updateContainerClass&&(this.updateSNtabbedContainerClass=t.updateContainerClass),this._createDispatchers(),this._initSearchRessources(t),p.getOption("load_PQs")&&I.fetchPQsFromServer(this._resources),A.groupEnd()},onLoadMoreTags:function(e){var t=e&&e.searchString;this._searchTaggerHelper.onLoadMoreTags(t)},_initSearchComSocket:function(){let e=this;this._searchcom_socket=g.createSocket({socket_id:this.getSocketID(),widgetId:this.getOption("widget_id")}),this._searchcom_socket&&(this._searchcom_socket.addListener("toggleProxyFocus",this._toggleProxyFocus.bind(this)),this._searchcom_socket.addListener("clearfilterbyclosesidepanel",this.clearfilterbyclosesidepanel.bind(this)),this._searchcom_socket.addListener("manageActionIconOnSidePanel",this.manageActionIconOnSidePanel.bind(this)),this._searchcom_socket.addListener("UpdateInContextSearch",this._updateInContextSearch.bind(this)),this._searchcom_socket.addListener("widgetResize",this.updateDimension.bind(this)),this._searchcom_socket.addListener("hide6Wcomponents",(()=>{e.getRefineHelpers().hideGlobeView(),e.getRefineHelpers().hideTimelineView(),e.getRefineHelpers().hidePhonebookView(),e.getRefineHelpers().hideTagcloudView()})),this._searchcom_socket.addListener("setTaggerContextOn3DDActiveTab",this._setTaggerContextOn3DDActiveTab.bind(this)))},_initSearchRessources:function(e){let t=this;if(e.resources instanceof u){this._resources=e.resources;let i=t.getActiveTenant();0===i.length?p.getTenantSettings(i).then(t._ready_to_customized(e)):p.getTenantSettings(i).then((()=>t._ready_to_customized(e)))}else try{t._resources=new u(e.resources,(function(){t._resources=this instanceof u?this:t._resources;let i=t.getActiveTenant();0===i.length?p.getTenantSettings(i).then(t._ready_to_customized(e)):p.getTenantSettings(i).then((()=>t._ready_to_customized(e)))}))}catch(e){console.log(e),A.log("SearchRessources not initialized!")}},_createDispatchers:function(){var t=this;L.add("Search:updateSearchCriteria",(function(t){if(""===t)try{let t=options.resetOriginalOptions;e.is(t,"function")&&t(["search_criteria","search_criteria_to_display"])}catch(e){A.log("Update search criteria error",e)}})),L.add("search:onSearch",(function(e){t.getTabID()===e.tabID&&t.getOption("widget_id")===e.widgetID&&t.onSearch(e)})),L.add("errorManager:maximumResults",(function(i){e.is(t.onesearch_errorManagerIcon)&&(e.is(i)&&e.is(i.estimated)&&e.is(i.nhits)&&!0===i.estimated?t._setErrorManagerMaximumResultsTooltip(i.nhits):t._setErrorManagerMaximumResultsTooltip())})),L.add("errorManager:clear",(function(){e.is(t.onesearch_errorManagerIcon)&&t.onesearch_errorManagerIcon.tooltip.getBody().getChildren()[2].setHTML(""),t._manageErrorManagerDisplay()})),L.add("fedsearch:myContent",(function(e){t.OnGroupingChange(e)})),this._subscriptions.updateSelectionNumber=d.subscribe({channel:this.getMessagingChannel(),topic:"updateSelectionNumber",callback:this.updateSelectionNumber.bind(this)}),this._subscriptions.displayContentSetHeader=d.subscribe({channel:"3dSearch-switcher-view",topic:"displayContentSetHeader",callback:e=>{let i=e.view?e.view:null;!0===e.displayed?t.showSearchContentSetHeader(i):t.hideSearchContentSetHeader(i)}}),this._subscriptions.sidePanelClosed=d.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"sidePanelClosed",callback:()=>{let e=_.getCurrentSearchWidget().id;this.getOption("widget_id")===e&&this._taggerProxy&&this._taggerProxy.clearLocalFilter()}}),this._subscriptions.hide6wComponents=d.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"hide6wComponents",callback:()=>{t.getRefineHelpers().hideGlobeView(),t.getRefineHelpers().hideTimelineView(),t.getRefineHelpers().hidePhonebookView(),t.getRefineHelpers().hideTagcloudView()}}),this._subscriptions.show6wComponent=d.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"show6wComponent",callback:()=>{let e=t.skeleton.getCurrentView().id;t.getRefineHelpers().hideGlobeView(),t.getRefineHelpers().hideTimelineView(),t.getRefineHelpers().hidePhonebookView(),t.getRefineHelpers().hideTagcloudView(),"what"===e&&t.getRefineHelpers().showTagcloudView(),"who"===e&&t.getRefineHelpers().showPhonebookView(),"when"===e&&t.getRefineHelpers().showTimelineView(),"where"===e&&t.getRefineHelpers().showGlobeView()}}),this._subscriptions.mask6wComponents=d.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"mask6wComponents",callback:()=>{t.getRefineHelpers().maskAllContainers()}}),this._subscriptions.unmask6wComponents=d.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"unmask6wComponents",callback:()=>{t.getRefineHelpers().unmaskAllContainers()}}),e.is(this.getOption("getTabID"),"function")||this._subscribeToKeyboardEvents()},_ready_to_customized:function(t){let i=JSON.parse(y),n=this;v.setAddinMode(this.getOption("addinMode")),v.addCustomization(i,(function(){e.is(t.result_ux_customization)?v.addCustomization(t.result_ux_customization,(function(){n._ready_to_initialize(t)})):n._ready_to_initialize(t)}))},_ready_to_initialize:function(t){var i=this;this._createTaggerProxy(t,(function(){let n=i.getOption("search_options");i._searchcom_socket&&e.is(n)&&e.is(n.tag_filter)&&i._searchcom_socket.dispatchEvent("Last_Tag_Filter",i.options.search_options.tag_filter),i._selected_objects=new o;var s={source:i.options.source,events:{selected_obj:function(){if(i._selected_objects.reset(),e.is(arguments))for(var t=0,n=arguments.length;t<n;t++)i._selected_objects.add(arguments[t]);if(i._ok_Button){let e=i.getInContextMinSelect();i._ok_Button.setDisabled(i._selected_objects.size()<e)}i._apply_Button&&i._apply_Button.setDisabled(0===i._selected_objects.size())},onItemViewClick:function(t){var n=i.options.itemViewClickHandler;e.is(n)&&require([n],(function(e){e.executeAction({model:t})}))},onSkeletonReady:function(){e.is(i.getOption("renderTo"))&&i.render().inject(i.getOption("renderTo"));var n=i.getOption("search_options");if(e.is(n)?(!e.is(n.viewData)&&(n.viewData=i.getOption("viewData")),i._forceOnSearch=!0):!e.is(i.options.donotshowlastsearch)&&e.is(i.options)&&e.is(i.options._lastSearchOptions)&&i.dispatchEvent("onSearchSkeleton",i.options._lastSearchOptions),e.is(i.elements)&&e.is(i.skeleton)&&e.is(i.skeleton.getSearchActions)&&e.is(i.skeleton.getSearchActions())){let n=i.skeleton.getSearchActions();n.addEvent("onRefreshResultRequest",(function(t){let n;if(e.is(t))n={},e.is(t.criteria)&&(e.is(t.criteria.search_crit)&&(n.search_criteria=t.criteria.search_crit),e.is(t.criteria.originalSearchCriteria)&&(n.originalSearchCriteria=t.criteria.originalSearchCriteria),e.is(t.criteria.tagger_crit)&&(n.tag_filter=t.criteria.tagger_crit),e.is(t.criteria.search_name)&&(n.search_name=t.criteria.search_name),e.is(t.criteria.source)&&(n.source=t.criteria.source),e.is(t.criteria.queryType)&&(n.queryType=t.criteria.queryType)),n.savedSearch=!0,window.hasOwnProperty("sendNotificationWebInWin")&&e.is(sendNotificationWebInWin,"function")&&sendNotificationWebInWin("SaveSearch",JSON.stringify(n));else if(n=e.clone(i.options.search_options),e.is(n)){if(n.refresh=!0,F.getItem("search_keepColumnSorting")&&e.is(F.getItem("searchSort"))){let e=F.getItem("searchSort");n.order_field=e.order_field,n.order_by=e.order_by}else{let t=Z._searchControlCenterSettingsJSONFromDB;if(e.is(t.search_settings)&&t.search_settings.hasOwnProperty("searchDefaultSort")&&e.is(t.search_settings.searchDefaultSort,"object")&&e.is(t.search_settings.searchDefaultSort.value,"string")&&e.is(t.search_settings.searchDefaultSort.type,"string")){let e=t.search_settings.searchDefaultSort,i="";i="ds6w:relevancy"===e.value?"desc":"ds6w:type"===e.value?"asc":e.order,n.order_field=e.value,n.order_by=i}else p.getOption("apply_sort_on_modified_by_default")?(n.order_field="ds6w:modified",n.order_by="desc"):(n.order_field="relevance",n.order_by="desc")}if(e.is(n.tag_filter,"object")){var s=i._taggerProxy.getCurrentFilter();e.is(s,"object")&&e.is(s.allfilters,"object")&&0<Object.keys(s.allfilters).length?A.log("refreshSearchResult with tagg filter"):n.tag_filter=null}}e.is(n)&&(i._historySearch&&(e.is(i.elements.containerProduct)&&i.elements.containerProduct.empty(),e.is(i.elements.containerRelational)&&i.elements.containerRelational.empty(),i._historySearch.cleanAll()),i.onSearch(n))})),n.addEvent("onClickFavSearchTopBar",(function(){i._searchcom_socket.dispatchEvent("clickOnChoiceFavoriteSearch")})),n.addEvent("onRunSavedSearch",(function(t){if(A.log("onRunSavedSearch"),e.is(t)){var n={};if(n.tag_filter=t.tag_filter,n.search_criteria=t.search_criteria,n.search_criteria_to_display=t.search_criteria_to_display,n.originalSearchCriteria=t.originalSearchCriteria,n.saved_search=!0,n.search_name=t.search_name,e.is(t.originalSearchCriteria,"string")&&t.originalSearchCriteria===_.SearchTypeEnum.ADVANCED_SEARCH&&(n.adv_search=!0),i._updateWdgPreferences(n),e.is(t.search_criteria)&&e.is(t.tag_filter.allfilters)&&e.is(t.tag_filter.allfilters.condition)&&t.tag_filter.allfilters.condition.length>0){var s=i._extractFTSFromFilter(t.tag_filter);if(x.isSimplifiedTaggerFilters(t.tag_filter.allfilters)&&(s.source=x.extractSourceInSimplifiedTagger(t.tag_filter.allfilters)),e.is(s))var o=!1;o=e.is(s.source,"array")&&s.source.indexOf("other")>-1;var a=i._getSearchCriteriaForAdvancedFilters(s.new_filter,i._search_criteria,o);t.advanced_criteria=a}t.resetLocalFilter=!0,i.onSearch(t)}})),n.addEvent("onRunSavedSearchOnNewTab",(function(n){if(e.is(n.search_criteria)&&e.is(n.tag_filter.allfilters)&&e.is(n.tag_filter.allfilters.condition)&&n.tag_filter.allfilters.condition.length>0){var s=i._extractFTSFromFilter(n.tag_filter);if(x.isSimplifiedTaggerFilters(n.tag_filter.allfilters)&&(s.source=x.extractSourceInSimplifiedTagger(n.tag_filter.allfilters)),e.is(s))var o=!1;o=e.is(s.source,"array")&&s.source.indexOf("other")>-1;var a=i._getSearchCriteriaForAdvancedFilters(s.new_filter,i._search_criteria,o);n.advanced_criteria=a}d.publish({channel:"3DSearch-TabManager-"+t.widget_id,topic:"addTab",data:{search_ux_options:{search_options:n,events:{onReady:function(){alert("Ready")}}}}})})),!0===F.getItem("nav_history")&&n.addEvent("onDisplayRelations",(function(t){if(A.log("onDisplayRelations"),e.is(t,"object")&&e.is(t.relation,"string")&&e.is(t.ids,"array")){let o,a="";if(e.is(i._taggerProxy.clearLocalFilter,"function")&&i._taggerProxy.clearLocalFilter(),e.is(i._taggerProxy.clearLocalGrouping,"function")&&i._taggerProxy.clearLocalGrouping(),e.is(t.searchParam))o=t.searchParam,o.fromSearchHistory=!0,o.refresh=!1;else{for(var n=0;n<t.ids.length;n++)a+="physicalid:"+t.ids[n],n<t.ids.length-1&&(a+=" OR ");var s="";switch(t.relation){case"parents":s=D.get("parents.box");break;case"children":s=D.get("children.box");break;case"drawings":s=D.get("drawings.box");break;case"simulations":s=D.get("simulations.box");break;case"configurations":s=D.get("configurations.box")}o={search_criteria:a,originalSearchCriteria:s,tag_filter:{},source:["3dspace"],fromSearchHistory:!0};let e={};e.tag_filter=o.tag_filter,e.search_criteria=o.search_criteria,e.search_criteria_to_display=o.originalSearchCriteria,e.originalSearchCriteria=o.originalSearchCriteria,e.saved_search=!1,i._updateWdgPreferences(e)}i.onSearch(o)}})),n.addEvent("onNonDefaultGlobalAction",(function(t){if(A.log("onNonDefaultGlobalAction"),e.is(t)&&e.is(t.id)&&i._searchcom_socket){var n,s,o=C.getViewData();e.is(o)&&(n=o.global_actions),n&&(s=n.app_socket_id),s&&i._searchcom_socket.dispatchEvent("Selected_global_action",{selected_objects:i._selected_objects.toArray(),id:t.id,command_data:t.command_data},s)}})),n.addEvent("onInformationPanelAction",(function(){A.log("onInformationPanelAction");var e;e=i.getSNSkeleton().ActivateDeactivateInformationsPanel(),i.manageInformationPanel(e)})),n.addEvent("onPreviewPanelAction",(function(){A.log("onPreviewPanelAction");var e;e=i.getSNSkeleton().ActivateDeactivatePreviewPanel(),i.managepreviewPanel(e)})),n.addEvent("onPinToDashboardAction",(function(){A.log("onPinToDashboardAction"),i.onPinToDashboardAction()}))}else A.error("Unable to retrieve skeleton !");i.elements.container.addEventListener("dragover",(function(e){e.preventDefault()}),!1),i.elements.container.addEventListener("drop",(function(e){e.preventDefault()}),!1),i.elements.container.addClassName(i.getOption("css_view_class")),!0===i.getOption("swymContext")&&i.elements.container.addClassName("swym"),i.elements.container.addClassName(i.getOption("css_view_class")),_.isFUN109031Active()&&!i._isInAppsSearch()&&i.elements.container.addClassName("BETA-FUN109031"),!0===F.getItem("search_resizeFullMode")&&i.elements.container.addClassName("withoutMargin"),_.isFUN109031Active()&&i.embeddedTaggerContent&&i.embeddedTaggerContainer&&i.embeddedTaggerContent.inject(i.embeddedTaggerContainer),i.dispatchEvent("onReady"),i.updateDimension()}}};i.opts_skeleton=s,i._buildSkeleton(s)}))},_createTaggerProxy:function(t,i){var n=this;let s,o=p.getOption("enablePLM",{tenant:n._resources.getActiveTenant()});if(t.in_apps_search&&t.in_apps_search.advanced_search&&!1===t.in_apps_search.advanced_search.showPLMParameter&&(o=!1),e.is(n._resources)&&e.is(n._resources.getActiveTenant())&&(s=n._resources.getActiveTenant()),p.getOption("ENO_BI_ON_TAGGER")){require(["DS/ENOFilterBIUX/FilterBIComponentProxy"],(function(t){let a={enablePLM:o,tenant:s,processingMode:"appProcessing",colorize:!0,events:{addFilterChangeListener:n.onFilterChange.bind(n),addCriteriaChangeListener:n.onCriteriaChange.bind(n),addPLMUpdateListener:n.onPLMUpdate.bind(n),addOpenTaggerListener:n.onOpenTagger.bind(n),addCloseTaggerListener:n.onCloseTagger.bind(n),addRequestSuggestsListener:n.OnSuggestUpdate.bind(n),addLoadMoreTagsListener:n.onLoadMoreTags.bind(n),addCriteriaModifiedListener:n.onCriteriaModified.bind(n)},searchMoreTagsOnDemand:!0,customCountOnHierarchicalTags:p.getOption("FUN137144")};if(e.is(n.getOption("tagger_context_id")))a.contextId=n.getOption("tagger_context_id");else if(F.getItem("integratedSearch")){var r=_.getSearchWidget(n.getOption("widget_id"));e.is(r)&&(a.contextId=r.context)}else a.widgetId=n.getOption("widget_id");n._taggerProxy=new t(a),n._taggerProxy.addEvent("FilterBIColorize",n.onTaggerColorization.bind(n)),n._taggerProxy.addEvent("FilterBIUnColorize",n.onTaggerUnColorization.bind(n)),n._buildDOM()&&i.call()}))}else{var r={enablePLM:o,tenant:s,filteringMode:"FilteringOnServer",disableAutoComplete:!0,events:{addFilterChangeListener:n.onFilterChange.bind(n),addCriteriaChangeListener:n.onCriteriaChange.bind(n),addPLMUpdateListener:n.onPLMUpdate.bind(n),addCloseTaggerListener:n.onCloseTagger.bind(n),addOpenTaggerListener:n.onOpenTagger.bind(n),addRequestSuggestsListener:n.OnSuggestUpdate.bind(n),addGroupingChangeListener:n.OnGroupingChange.bind(n),addLoadMoreTagsListener:n.onLoadMoreTags.bind(n),addCriteriaModifiedListener:n.onCriteriaModified.bind(n)},searchMoreTagsOnDemand:!0,freeInput:!1,defaultDatePicker:!0,preciseCount:p.getOption("preciseCount",{tenant:n.getActiveTenant()}),customCountOnHierarchicalTags:p.getOption("FUN137144")};let t=this.isPinnedWidget();(1==p.getOption("SearchExclude")||p.getOption("editTagsRelationships")&&!t)&&(r.exclude=!0),1==p.getOption("colorizeResults")&&(r.colorize=!0);let c=!1,d=n.getOption("search_options");if(e.is(d)&&e.is(d.tag_filter)&&x.isSimplifiedTaggerFilters(d.tag_filter.localfilters)&&(c=!0),"3DDashboard"!==_.identifyClientInfo().identifier||("true"===n.getOption("transient_context")||c)){r.simplified={data_location:!0,type_categorization:!0,person_data:!0,editTagsRelationships:p.getOption("editTagsRelationships")};let e=n.getOption("pinToDashboard");_.isFUN109031Active()&&!1!==e&&!n._isInAppsSearch()&&(n.embeddedTaggerContent=a.create("div",{id:"embedded-tagger-"+this.getOption("widget_id")+"-"+this.getTabID()+"_content"}),n.embeddedTaggerContent.inject(document.body),r.embeddedTagger={target:"#embedded-tagger-"+n.getOption("widget_id")+"-"+n.getTabID()+"_content",rootw:{allw:{label:D.get("All"),subLabel:D.replace(D.get("sortBy"),{criteria:D.get("relevancySort").toLowerCase(),sortType:D.get("tooltip_SortDesc").toLowerCase()})},"ds6w:what":{},"ds6w:who":{},"ds6w:why":{},"ds6w:when":{},"ds6w:where":{subLabel:D.get("Location")}},multiselect:!1,zIndexForMenu:-1==["iphone","android"].indexOf(_.getDeviceCategory())?200:1301},!0===_.is6WInWebInWinActive()&&(r.embeddedTagger.is6WInWebInWinActive=!0,r.embeddedTagger.broadcastId=n.getTabID()),r.enableGrouping={maxLevels:1,withIconInfo:!0})}if(p.options.search_settings.taggerClosed=_.isFUN109031Active()&&!n._isInAppsSearch()&&!1!==n.getOption("pinToDashboard"),e.is(n.getOption("tagger_context_id")))r.contextId=n.getOption("tagger_context_id");else if(F.getItem("integratedSearch")){let t=_.getSearchWidget(n.getOption("widget_id")),i=!0;if(e.is(t)){var l=t.getValue("launch_mode");e.is(t.data)&&!e.is(t.data.pinToDashboard)&&l!==_.widgetLaunchMode.PINNED&&(r.contextId="RightPanelContext"),l!==_.widgetLaunchMode.COMPASS_TRANSIENT&&l!==_.widgetLaunchMode.COMPASS_PINNED&&l!==_.widgetLaunchMode.INCONTEXT_TRANSIENT||(r.contextId=""),r.widgetId=n.getOption("widget_id"),i=!1}!0===i&&(r.widgetId=n.getOption("widget_id"))}else r.widgetId=n.getOption("widget_id");if(!0===p.getOption("search_web_in_win"))require(["DS/SNResultUX/webinwin/WebInWinTaggerProxy"],(function(t){r.proxyId=n.getTabID(),r.contextId=_.TAGGERPROXY_CONTEXTID_WEB_IN_WIN,n._listenBroadcast(r.proxyId),n._taggerProxy=new t(r),e.is(p.getOption("tabbed_ui_support_level"))||(n._taggerProxy.clearLocalFilter(),n._taggerProxy.clearLocalGrouping&&n._taggerProxy.clearLocalGrouping()),1==p.getOption("colorizeResults")&&(n._taggerProxy.addEvent("colorize",n.onTaggerColorization.bind(n)),n._taggerProxy.addEvent("unColorize",n.onTaggerUnColorization.bind(n))),n._buildDOM()&&i.call()}));else{n._buildDOM(),n._taggerProxy=S.createProxy(r),1==p.getOption("colorizeResults")&&(n._taggerProxy.addEvent("colorize",n.onTaggerColorization.bind(n)),n._taggerProxy.addEvent("unColorize",n.onTaggerUnColorization.bind(n)));let t=_.getSearchWidget(n.getOption("widget_id"));if(_.isFUN109031Active()&&!n._isInAppsSearch()&&e.is(t)){t.getValue("launch_mode")===_.widgetLaunchMode.COMPASS_TRANSIENT&&n._taggerProxy.showEmbeddedView()}i.call()}}},unSetTags:function(){this._taggerProxy&&this._taggerProxy.unsetTags()},isPinnedWidget:function(){let e=!1;this.getOption("addinMode");return"3DSwym"!==_.identifyClientInfo(this.getOption("addinMode")).identifier&&(e="false"===this.getOption("transient_context")||!1===this.getOption("transient_context")),e},destroy:function(){if(A.groupCollapsed("SNResultMgt.destroy"),_.trackerData.search.selectItem&&d.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:"NoSelection",persVal:{pv13:0}}}),window.removeEventListener("resize",this.updateDimension.bind(this)),this.onesearch_selectionNumberDiv&&this.onesearch_selectionNumberDiv.removeEvents(),this.onesearch_globalDropdownIcon&&this.onesearch_globalDropdownIcon.removeEvents(),this.indexedtimeMenu&&this.indexedtimeMenu.removeEvents(),this._beingDestroyed=!0,this._contentSetHeader){try{this._contentSetHeader.removeEvent("contextmenu")}catch(e){}this._contentSetHeader=null}if(this._resources&&(delete this._resources,this._resources=null),this.sortPanelView&&this.sortPanelView._view&&(d.unsubscribe(this.sortPanelView._subscriptions.setOrderInGridView),this.sortPanelView.destroy(),this.sortPanelView=null),this.switch6WView&&this.switch6WView.destroy(),this._oneSearchActions&&this._oneSearchActions._view&&(this._oneSearchActions.tooltip&&(this._oneSearchActions.tooltip.destroy(),this._oneSearchActions.tooltip=null),this._oneSearchActions.destroy(),this._oneSearchActions=null),e.is(this.elements)&&e.is(this.elements.onesearchactionspreview)&&(e.is(this.elements.onesearchactionspreview.tooltipActionspreview)&&(this.elements.onesearchactionspreview.tooltipActionspreview.destroy(),this.elements.onesearchactionspreview.tooltipActionspreview=null),e.is(this.elements.onesearchactionspreview.tooltipActionsnext)&&(this.elements.onesearchactionspreview.tooltipActionsnext.destroy(),this.elements.onesearchactionspreview.tooltipActionsnext=null),e.is(this.elements.onesearchbacksearch.tooltipActionsback)&&(this.elements.onesearchbacksearch.tooltipActionsback.destroy(),this.elements.onesearchbacksearch.tooltipActionsback=null)),this._searchcom_socket){this._searchcom_socket.removeListener("OnRefreshWebInWin"),this._searchcom_socket.removeListener("toggleProxyFocus"),this._searchcom_socket.removeListener("clearfilterbyclosesidepanel"),this._searchcom_socket.removeListener("manageActionIconOnSidePanel"),this._searchcom_socket.removeListener("UpdateInContextSearch"),this._searchcom_socket.removeListener("widgetResize");for(let e in this._subscriptions)d.unsubscribe(this._subscriptions[e]);if(g.deleteSocket(this.getSocketID()),!1===_._isSearchWidgetTransientAvailable(this.getOption("widget_id")))if(!e.is(this.getOption("getTabID"),"function")){var t="windowed"===this.getOption("css_view_class");(!0===_.isTaggerOpenedByCode()&&!1===t||"3DSpace"===_.identifyClientInfo().identifier)&&this._searchcom_socket.dispatchEvent("closeTagger");var i=this.getOption("in_apps_search");this._searchcom_socket.dispatchEvent("onCloseTransient",{in_apps_search:i})}A.log("Disconnect the socket from the server"),this._searchcom_socket.disconnect(),delete this._searchcom_socket}this._compass_socket&&(this._compass_socket.removeListener("onSetX3DContent"),this._compass_socket.disconnect(),delete this._compass_socket),e.is(this._BroadcastchannelManager)&&this._BroadcastchannelManager.destroy(),e.is(this._BroadcastchannelSearchManager)&&delete this._BroadcastchannelSearchManager,this._BroadcastchannelManager=null,e.is(this._BroadcastsearchDropDownManager)&&this._BroadcastsearchDropDownManager.destroy(),e.is(this._BroadcastsearchDropDownManager)&&delete this._BroadcastsearchDropDownManager,this._BroadcastsearchDropDownManager=null;try{e.is(this._taggerProxy)&&e.is(this._taggerProxy.die,"function")&&(console.log('Calling "die" on tagger proxy'),this._taggerProxy.die(),delete this._taggerProxy,this._taggerProxy=null)}catch(e){console.log('[SNRes::destroy] - Calling "die" on tagger proxy failed due to error',e)}e.is(this.indexedtimeMenu)&&(e.is(this.indexedtimeMenu.destroy,"function")&&this.indexedtimeMenu.destroy(),this.indexedtimeMenu=null),this.onesearch_selectionNumberDiv=null,this.onesearch_globalDropdownIcon=null,this.onesearch_indexedtimeIcon&&this.onesearch_indexedtimeIcon.tooltip&&(this.onesearch_indexedtimeIcon.tooltip.destroy(),this.onesearch_indexedtimeIcon.tooltip=null),this._selected_objects=null,e.is(this._keydownEventHandler,"function")&&UWA.Element.removeEvent.call(document,"keydown",this._keydownEventHandler),e.is(this.skeleton)&&e.is(this.skeleton.destroy)&&(this.skeleton.destroy(),this.skeleton=null),this.options={},this.opts_skeleton=null,this._subscriptions={},this._DockingElement&&this._DockingElement.destroy(),this._searchBackViewContainerContent&&this._searchBackViewContainerContent.destroy(),this.elements.resizerContent&&this.elements.resizerContent.destroy(),this.resizerContentSpan&&this.resizerContentSpan.destroy(),this._parent(),A.groupEnd()},_isInAppsSearch:function(){let t=this.getOption("in_apps_search");return e.is(t,"object")},updateDimension:function(t){var i=this;clearTimeout(i.resizeEventId),i.resizeEventId=setTimeout((function(){if(e.is(i.skeleton)){var n=null,s=i.skeleton.getSearchWidget();e.is(s)&&e.is(s.body)?(n=s.body,e.is(i.getOption("addinMode"),"string")||!0===i.getOption("swymContext")?0:(e.is(s.getView,"function")&&e.is(s.getView().type)&&"windowed"===s.getView().type||"sidepanel"===s.getView().type)&&(24,e.is(t)&&-1)):n=e.extendElement(document.body).getElement(".onesearch_results");let o=i.skeleton.getCurrentView();o&&e.is(o.manageDisplayChannelView,"function")&&o.manageDisplayChannelView(n.getDimensions())}}),100)},_updateInContextSearch:function(e){this.setOption("update_incontext_options",void 0),this.setOption("update_incontext_options",e),!1!==e.refresh&&this.refreshSearch()},getInContextMinSelect:function(){var t=1,i=this.getOption("in_apps_search");return i&&i.furtive_options&&e.is(i.furtive_options.min_select)&&(t=i.furtive_options.min_select),t},getMessagingChannel:function(){var e=this.getTabID();return this.getOption("widget_id")+"-#-"+e},getSocketID:function(){var t="result_socket_"+this.getOption("widget_id"),i=this.getTabID();return e.is(i,"string")?t+"-"+i:t},getTabID:function(){return e.is(this.getOption("getTabID"),"function")?this.getOption("getTabID").call():"3DSearch-non-tabbed-ui"},_getSearchType:function(){let t=_.SearchTypeEnum.SEARCH,i=this.getOption("search_options");if(e.is(i,"object")){let n=i.search_criteria;n===_.SearchTypeEnum.MY_CONTENT||n===_.SearchTypeEnum.ADVANCED_SEARCH||n===_.SearchTypeEnum.FAVORITE_SEARCH?t=n:""===n&&e.is(i.adv_search,"boolean")&&!0===i.adv_search&&(t=_.SearchTypeEnum.ADVANCED_SEARCH)}return t},getTabIcon:function(){var e={iconName:"search",fontIconFamily:1};switch(this._getSearchType()){case _.SearchTypeEnum.MY_CONTENT:e.iconName="user";break;case _.SearchTypeEnum.ADVANCED_SEARCH:e.iconName="search-cog";break;case _.SearchTypeEnum.FAVORITE_SEARCH:e.iconName="favorite-on"}return e},_updateWdgPreferences:function(t){let i=this.getOption("update_preference");if(e.is(i,"function")){let e=["tag_filter","search_criteria","search_criteria_to_display","originalSearchCriteria","search_mode","adv_search","advanced_criteria","source","searchViewMode","search_mode","order_by","order_field","saved_search","search_name"],n={};for(let i in t)-1!==e.indexOf(i)&&(n[i]=t[i]);i(n)}},OnTabActivated:function(){let t=this;var i=p.getOption("search_web_in_win"),n=this.getOption("search_options");if(e.is(n))if(i&&window.hasOwnProperty("sendNotificationWebInWin")&&e.is(sendNotificationWebInWin,"function")){if(e.is(p.getOption("tabbed_ui_support_level"))){var s=e.is(n.originalSearchCriteria)?n.originalSearchCriteria:"";sendNotificationWebInWin("UpdateSearchField",JSON.stringify({search_criteria:s}))}}else this._searchcom_socket.dispatchEvent("onSearch",{parameters:{search_criteria:e.is(n.search_criteria)?n.search_criteria:"",originalSearchCriteria:n.originalSearchCriteria,search_criteria_to_display:n.search_criteria_to_display,adv_search:n.adv_search},transient_widget:"true"===this.getOption("transient_context"),widget_id:this.getOption("widget_id"),in_apps_search:this.getOption("in_apps_search"),tabInfo:{tenant:this._resources.getActiveTenant(),client_identifier:_.identifyClientInfo().identifier}});if(this._taggerProxy)if(i&&!0===F.getItem("search_tabbed_ui")){let i=t.getOption("getBroadcastWebInWinProxyManager"),n=e.is(i,"function")?i.call():void 0;if(e.is(n)){let e={type:"activate",proxyId:t._taggerProxy._proxyId,contextId:t._taggerProxy._contextId,value:void 0};A.log("BroadcastChannel postMessage activate ",e),n.postMessage(e);let i={type:"toggleProxyFocus",proxyId:t._taggerProxy._proxyId,contextId:t._taggerProxy._contextId,value:!0};if(A.log("BroadcastChannel postMessage toggleProxyFocus ",i),n.postMessage(i),this._getSearchType()!==_.SearchTypeEnum.ADVANCED_SEARCH){let e={type:"setTaggerMode",proxyId:t._taggerProxy._proxyId,contextId:t._taggerProxy._contextId,value:"tags"};A.log("BroadcastChannel postMessage setTaggerMode ",e),n.postMessage(e)}}}else this._taggerProxy.activate(),i&&!0===p.getOption("proxy_button_available")&&this._taggerProxy.toggleProxyFocus(!0),this._getSearchType()!==_.SearchTypeEnum.ADVANCED_SEARCH&&this.setTaggerMode("tags");var o=this.getSNSkeleton();e.is(o)&&(o.restoreSelectionOnTabActivation(),o.setCurrentTabId(this.getTabID()),e.is(p.getOption("tabbed_ui_support_level"))?this._searchcom_socket.dispatchEvent("onDispatchToWin",{notif_name:"onTabActivated",notif_parameters:{tabID:this.getTabID(),useTabs:F.getItem("search_tabbed_ui")}},"search_web_in_win"):o._updateResultsToNative(),this.managehistoryPanel(!1),this.manageInformationPanel(),this.manageActionIconOnSidePanel()),e.is(n)&&this._updateWdgPreferences(n),_.SearchTypeEnum.ADVANCED_SEARCH===this._getSearchType()&&this.setTaggerMode("criteria"),_.SearchTypeEnum.MY_RECENT_CONTENT===this._search_criteria&&e.is(this._taggerProxy)&&e.is(this._taggerProxy.deactivate,"function")&&this._taggerProxy.deactivate(),e.is(this.getSNSkeleton())&&this.getSNSkeleton().getSearchActions().updateDatagridObjInCusto()},OnTabDeactivated:function(){let t=this,i=p.getOption("search_web_in_win");if(this._taggerProxy)if(i&&!0===F.getItem("search_tabbed_ui")){let i=t.getOption("getBroadcastWebInWinProxyManager"),n=e.is(i,"function")?i.call():void 0;if(e.is(n)){let e={type:"deactivate",proxyId:t._taggerProxy._proxyId,contextId:t._taggerProxy._contextId,value:void 0};A.log("BroadcastChannel postMessage deactivate ",e),n.postMessage(e)}}else this._taggerProxy.deactivate();var n=this.getSNSkeleton();if(e.is(n)&&(n.resetCompassSelection(),n.clearWebInWinCSO(),e.is(n._searchActions)&&e.is(n._searchActions._cleanPopOver,"function")&&n._searchActions._cleanPopOver(),e.is(n.getPreviewPanel())&&e.is(n.getPreviewStatus()))){F.setItem("LastSearchPreview",n.getPreviewStatus()),F.commit()}},OnTabRemoved:function(){this._searchcom_socket.dispatchEvent("onDispatchToWin",{notif_name:"onTabRemoved",notif_parameters:{tabID:this.getTabID()}},"search_web_in_win")},onKeyboardEvent:function(t){var i=this.getSNSkeleton();e.is(i)&&i.handleKeyboardEvent(t)},_subscribeToKeyboardEvents:function(){var e=this;this._keydownEventHandler=function(t){e.onKeyboardEvent(t)},UWA.Element.addEvent.call(document,"keydown",this._keydownEventHandler)},onTaggerColorization:function(t){let i=this.getCollection();if(i&&e.is(t)&&i.setColorMap(t.tagColors),e.is(t)&&e.is(t.coloredSubjects)){this.setShadings([{criteria:function(e){return this.color=e.getColor(),!0}}])}else A.error("Invalid colorMap input in onTaggerColorization")},onTaggerUnColorization:function(){let e=this.getCollection();e&&e.unsetColorMap();this.setShadings([{color:"initial",criteria:function(){return!0}}])},onReady:function(){},onRefresh:function(){var e={};e.search_criteria=this._search_criteria,e.originalSearchCriteria=this._originalSearchCriteria,e.tag_filter=this._search_tag_filter,e.adv_search=this._adv_search,e.advanced_criteria=this._advanced_criteria,e.source=this.options.source,this.onSearch(e)},onSearchPQ:function(e){A.log("onSearchPQ");var t=this;I.fetchPQsFromServer(t._resources).then((function(){t.dispatchEvent("onSearchSkeletonPQ",e)}))},onSearch:function(i){var n=Object.keys(t.parseQuery(window.location.search||"")).some((function(e){return"searchProto"===e}))?"beta":"";if(_.trackerData.search.selectItem&&!_.trackerData.search.firstSearch&&d.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:"NoSelection",persVal:{pv13:0}}}),_.trackerData.search.firstSearch&&(_.trackerData.search.firstSearch=!1),this._contentSetHeader&&this._contentSetHeader.getElement(".recent-content-label")){let t=e.is(this.getOption("addinMode"),"string")&&this.getOption("addinMode").length>0;var s=this.getOption("in_apps_search");"#myContent"!==(i.search_criteria||i.value)||!(this.options.search_options&&(UWA.equals(this.options.search_options.search_criteria,"")||"#myContent"===this.options.search_options.search_criteria)||p.getOption("search_web_in_win")||this.options.searchWidget&&this.options.searchWidget.widget&&this.options.searchWidget.widget.data&&"#myContent"===this.options.searchWidget.widget.data.search_myContent)||t||e.is(s,"object")?this._contentSetHeader.getElement(".recent-content-label").setStyle("display","none"):this._contentSetHeader.getElement(".recent-content-label").setStyle("display","flex")}e.is(this.getCollection())&&(this.getTagsTransformer()&&this.getTagsTransformer().getAvblSource(this._resources.getActiveTenant(),this.getCollection()._isPinnedWidget()),(this.getCollection()._isPinnedWidget()||e.is(this.getOption("addinMode"),"string"))&&e.is(i.newActiveTenant,"string")&&this._resources.setActiveTenant(i.newActiveTenant)),_.isFUN109031Active()&&!this._isInAppsSearch()&&e.is(this.getCollection())&&(e.is(i.allMyContent)&&!0===i.allMyContent?this.getCollection().setAllMyContent(!0):this.getCollection().setAllMyContent(!1)),_.trackerData.search.scenario="",_.trackerData.search.selectItem=!1,_.trackerData.search.previewItem=!1,_.trackerData.search.openItem=!1,_.trackerData.search.indexItem=null,e.is(_)&&(_.trackerData.searchData.context=_.identifyClientInfo().identifier,_.trackerData.searchData.searchType=this._getSearchType().replace("#",""),_.trackerData.searchData.searchString=i.search_criteria_to_display),d.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:"Search",persDim:{pd1:e.is(_)?_.trackerData.searchData.context:"",pd2:e.is(_)?_.trackerData.searchData.searchType:"",pd9:_.trackerData.searchData.searchString,pd15:n}}});var o=this;if((!e.is(i.search_criteria)||!e.is(i.search_criteria_to_display)||e.is(i.queryType)&&Object.values(_.SearchTypeEnum).includes(i.queryType)||L.dispatch("search:showLastSearchResult",[i.search_criteria,i.search_criteria_to_display]),i.in_apps_search)&&!o.getOption("in_apps_search")){o.setOption("in_apps_search",i.in_apps_search);var a={search_criteria:i.search_criteria,originalSearchCriteria:i.originalSearchCriteria,search_criteria_to_display:i.search_criteria_to_display,source:i.source?i.source:this.source,search_mode:"index",tag_filter:i.tag_filter,adv_search:!!i.adv_search&&i.adv_search,savedSearch:i.savedSearch};return this.setOption("search_options",void 0),o.setOption("search_options",a),o._search_tag_filter=i.tag_filter,void o._rebuildSkeleton(o.opts_skeleton)}e.is(this.getCollection())?i&&i.search_criteria&&e.is(i.search_criteria,"string")&&i.search_criteria.indexOf(":")>0&&!e.is(o.getOption("in_apps_search"),"object")?I.fetchPQsFromServer(o._resources).then((function(){i.search_criteria=N.manageWildcardAddtion(i.search_criteria),i.search_criteria=_.replacePQsWithCVPrefixes(i.search_criteria),o.onSearchAsyncPQ(i)})):this.onSearchAsyncPQ(i):A.log("Skeleton Not Ready..")},set3DDWidgetOption:function(t,i){var n=this.getOption("update_preference");e.is(n,"function")&&n(t,i)},get3DDWidgetOption:function(t){var i=this.getOption("get_preference");if(e.is(i,"function"))return i(t)},_transformFilter:function(t){var i=this;this.getTagsTransformer()&&this.getTagsTransformer().transformFilterSourceToProject(t),this.getTagsTransformer()&&x.applyTransformation(t.allfilters,(function(t){i.getTagsTransformer().transformFilterSourceToProject({allfilters:t,localfilters:e.clone(t)})}))},onSearchAsyncPQ:function(t){if(A.groupCollapsed("SNResultMgt.onSearchAsyncPQ"),!e.is(t))return A.error("no options provided in SNResultMgt.onSearch !"),void A.groupEnd();if(A.log("options:",JSON.parse(JSON.stringify(t))),e.is(t.removeHistory)&&!0===t.removeHistory&&this._historySearch&&(e.is(this.elements.containerProduct)&&this.elements.containerProduct.empty(),e.is(this.elements.containerRelational)&&this.elements.containerRelational.empty(),this._historySearch.cleanAll()),this.elements.searchResultWarningMessage&&this.elements.searchResultWarningMessage.hide(),!e.is(t.recent_filter)&&!e.is(t.search_criteria===_.SearchTypeEnum.MY_RECENT_CONTENT)&&e.is(this._taggerProxy)&&e.is(this._taggerProxy.activate,"function")&&this._taggerProxy.activate(),e.is(t.adv_search)&&!0===t.adv_search){if(t.search_criteria===_.SearchTypeEnum.ADVANCED_SEARCH){if(this.setTaggerMode("criteria"),void 0===t.displayValue&&void 0===t.in_apps_search&&void 0===t.source&&void 0===t.search_mode){var i={widgetId:this.getOption("widget_id")};return void this.showAdvancedSearch(i)}if(!0===_.isFUN109031Active()&&!0===p.getOption("search_web_in_win")&&void 0===t.displayValue&&void 0===t.in_apps_search&&void 0===t.search_mode&&!e.is(t.dontcallAgain)){let e={objets_name:[]};return void this.getSNSkeleton().onDispatchToWin(e,"showAdvancedSearch")}}}else!0!==p.getOption("search_web_in_win")&&this.setTaggerMode("tags");var n=this.getOption("in_apps_search");t.in_apps_search=e.is(t.in_apps_search)?t.in_apps_search:n,!e.is(n)||e.is(t.search_criteria_to_display)||p.getOption("search_web_in_win")||(t.search_criteria_to_display=""),!t.viewData&&n||C.setViewData(t.viewData),this.skeleton._searchActions.setEmptyViewMessage(D.get("loading"));let s=p.getOption("search_web_in_win");if(p.getOption("search_web_in_win")||e.is(t.originalSearchCriteria)&&0!==t.originalSearchCriteria.length||(t.originalSearchCriteria=t.search_criteria),this._search_criteria===_.SearchTypeEnum.MY_RECENT_CONTENT&&(""===t.search_criteria&&(t.search_criteria=_.SearchTypeEnum.MY_RECENT_CONTENT),t.search_criteria!==_.SearchTypeEnum.MY_RECENT_CONTENT&&this._taggerProxy&&this._taggerProxy.activate()),e.is(t)&&e.is(t.search_mode)&&e.is(t.search_criteria)&&_.SearchTypeEnum.MY_RECENT_CONTENT===t.search_criteria&&e.is(this.skeleton)&&e.is(this.skeleton._onesearch_collection)&&e.is(this.skeleton._onesearch_collection.service_parameters)&&e.is(this.skeleton._onesearch_collection.service_parameters.mode)&&_.SearchTypeEnum.MY_RECENT_CONTENT===this.skeleton._onesearch_collection.service_parameters.query&&(!e.is(t.refresh)||!0!==t.refresh))return A.log("Working on recent cache"),void this.skeleton._onesearch_collection.filterSearch(t);if(e.is(t.search_criteria)&&""!==t.search_criteria||_.SearchTypeEnum.MY_RECENT_CONTENT===t.search_criteria||!0===t.adv_search){var o=e.is(t.resetLocalFilter),a=!1;if(e.is(t)&&e.is(t.savedSearch)&&t.savedSearch&&(a=t.savedSearch),_.SearchTypeEnum.FAVORITE_SEARCH===t.search_criteria)t={search_criteria:t.search_criteria,originalSearchCriteria:t.originalSearchCriteria,search_criteria_to_display:t.search_criteria_to_display,adv_search:!1,advanced_criteria:null};e.is(this._searchcom_socket)&&this._searchcom_socket.dispatchEvent("onSearch",{parameters:t,transient_widget:"true"===this.getOption("transient_context"),widget_id:this.getOption("widget_id"),in_apps_search:this.getOption("in_apps_search")}),e.is(n)||(t.search_criteria=N.manageWildcardAddtion(t.search_criteria));var r=!1;if(n&&e.is(n.searchable_types)&&(r=n.searchable_types),!n||r){var l=O.getGlobalSearchTypeCustoQuery(t.search_criteria);e.is(l)&&_.addSourceSpecificParameter(t,{sourceIds:["3dspace"],param:{id:"additional_query",value:l}})}if(t.widget_search_criteria&&t.search_criteria!==_.SearchTypeEnum.MY_RECENT_CONTENT){var c=N.manageWildcardAddtion(t.widget_search_criteria);t.search_criteria=c}if(t.update_incontext_options=this.getOption("update_incontext_options"),this.setOption("search_options",t),e.is(this._taggerProxy)&&e.is(this._search_criteria)){p.getOption("search_web_in_win")&&!0===p.getOption("proxy_button_available")&&this._taggerProxy.toggleProxyFocus(!0);var d="";if(e.is(this._taggerProxy.options)&&e.is(this._taggerProxy.options.widgetId,"string")?d=this._taggerProxy.options.widgetId:e.is(this._taggerProxy.widgetId,"string")&&(d=this._taggerProxy.widgetId),e.is(t.tag_filter,"object")&&e.is(t.tag_filter.allfilters,"object")&&0<Object.keys(t.tag_filter.allfilters).length&&"IsNotInWidget"!==d&&(t.localFilter=e.clone(t.tag_filter.allfilters)),!0!==a&&!0!==o||1==t.refresh){if((t.search_criteria===_.SearchTypeEnum.ADVANCED_SEARCH||e.is(this._adv_search)&&e.is(t.adv_search)&&this._adv_search!==t.adv_search)&&(!e.is(t.tag_filter,"object")||e.is(t.tag_filter.PLMParameters)&&e.is(t.tag_filter.PLMParameters.plmparam)&&e.is(t.tag_filter.PLMParameters.plmparam.length>0))&&e.is(this._taggerProxy.clearLocalFilter,"function")){var u=!1;if(e.is(n)&&"socket_id_#saved_search_edit#"===n.app_socket_id&&e.is(n.advanced_search)&&(u=!0),!u){this._taggerProxy.clearLocalFilter(),this._taggerProxy.clearLocalGrouping&&this._taggerProxy.clearLocalGrouping(),this._taggerProxy.unsetTags();let e=this.getSNSkeleton();e&&(e.getCollection()._resetState(),e.getCollection().reset(),e.getCollection().initTreeDocument(),e._updateWidgetTitleWithNbResult())}}if(e.is(t.tag_filter,"object"))e.is(t.tag_filter,"object")&&(t.advanced_criteria=this._getSearchCriteriaForAdvancedFilters(t.tag_filter,t._search_criteria),e.is(t.reSearch)&&!0===t.reSearch&&(this._taggerProxy.clearLocalFilter(),this._taggerProxy.clearLocalGrouping&&this._taggerProxy.clearLocalGrouping()));else if(e.is(this._taggerProxy)){this._adv_search&&!t.adv_search&&t.adv_search!==this._adv_search&&(this._taggerProxy.clearLocalFilter(),this._taggerProxy.clearLocalGrouping());var h=this._taggerProxy.getCurrentFilter();e.is(h)&&(e.is(h.allfilters)&&e.is(h.localfilters)&&this._transformFilter(h),t.tag_filter=this._removeAdvancedFiltersFromTagFilter(h),t.advanced_criteria=this._getSearchCriteriaForAdvancedFilters(h,t._search_criteria),this._taggerProxy.filters=t.tag_filter)}}else!0===p.getOption("search_web_in_win")&&!0!==o||(this._taggerProxy.clearLocalFilter(),this._taggerProxy.clearLocalGrouping&&this._taggerProxy.clearLocalGrouping(),this.getSNSkeleton()&&this.getSNSkeleton().switchOnView(F.getItem("LastSearchViewMode")),this.getRefineHelpers().hideTagcloudView(),this.getRefineHelpers().hideGlobeView(),this.getRefineHelpers().hideTimelineView(),this.getRefineHelpers().hidePhonebookView())}if(this._search_criteria=t.search_criteria,this._originalSearchCriteria=t.originalSearchCriteria,this._adv_search=t.adv_search,this._context=t.context,this._advanced_criteria=e.is(t.adv_search)&&!1===t.adv_search&&e.is(this._advanced_criteria)?"":t.advanced_criteria,this.options.source=t.source,e.is(n)&&(t.recent_search=n.recent_search,e.is(n.specific_source_parameter))){var g={specific_source_parameter:n.specific_source_parameter};t.context=g}if(this._idWaitLoading=j.WaitManager.addWaitCondition(1e5,"Wait loading search model"),t.idWaitLoading=this._idWaitLoading,(!this.getCollection()||this.getCollection().totalCount<0)&&e.is(n)&&e.is(n.order_field)&&e.is(n.order_by)&&(t.order_field=n.order_field,t.order_by=n.order_by),this.dispatchEvent("onSearchSkeleton",t),window.hasOwnProperty("sendNotificationWebInWin")&&e.is(sendNotificationWebInWin,"function")){var f=this.getSNSkeleton();e.is(f)&&A.log("SNSkeleton title: "+f.getTitle());var m=t.originalSearchCriteria,S=t.search_name;e.is(t.panelTitle)&&(S=t.panelTitle,m=t.search_criteria),sendNotificationWebInWin("SaveSearch",JSON.stringify({search_name:S,search_criteria:S,originalSearchCriteria:m}))}{let t=this.getSNSkeleton();if(e.is(t)){var v=t.getSearchActions();e.is(v)&&v.updateGlobalActions()}}this.HideInformationLightboxPanel(),this.sortPanelView&&(e.is(this.getSNSkeleton())&&e.is(this.getSNSkeleton()._order_field)&&""!==this.getSNSkeleton()._order_field&&this.sortPanelView.updateRenderByExt({order_field:this.getSNSkeleton()._order_field,order_by:this.getSNSkeleton()._order_by,order_type:this.getSNSkeleton().order_type,order_index:this.getSNSkeleton().order_index}),this.sortPanelView.updateMenu()),A.groupEnd()}else if(!0===s&&""===t.search_criteria&&p.getOption("search_web_in_win")&&!0!==this._noCSOEventForWebInWin){let t=this.getSNSkeleton(),i=t&&t.getCollection(),n=t&&t._getTreedocumentFromCollection(i);if(e.is(n)&&e.is(n.getXSO())){let t=n.getXSO().get(),s=[];t.forEach((function(e){s.push(i.get(e._options.id))}));let o=[];if(s.length>=0){let t=null;for(var w=0,b=s.length;w<b;w++){let i=s[w];if(!e.is(i))throw new Error("Invalid itemModel in SNSkeletonMgt.onItemSelect");if(t=i.get("id"),!e.is(t,"string"))throw new Error("Unable to get id of object in SNSkeletonMgt.onItemSelect");o.push({id:t,session_object:i.hasOwnProperty("session_object")})}let i={objets_name:o};this._searchcom_socket.dispatchEvent("onDispatchToWin",{notif_name:"onAddToCSO",notif_parameters:JSON.stringify(i)},"search_web_in_win")}}}},onViewChange:function(t){e.is(this.elements.container)&&(e.is(t.previous)&&e.is(t.previous.type)&&this.elements.container.removeClassName(t.previous.type),this.elements.container.addClassName(t.type))},openTagger:function(){window.hasOwnProperty("sendNotificationWebInWin")&&e.is(sendNotificationWebInWin,"function")?sendNotificationWebInWin("openTagger",JSON.stringify({})):e.is(this._searchcom_socket)&&this._searchcom_socket.dispatchEvent("openTagger","")},closeTagger:function(){window.hasOwnProperty("sendNotificationWebInWin")&&e.is(sendNotificationWebInWin,"function")?sendNotificationWebInWin("closeTagger",JSON.stringify({})):e.is(this._searchcom_socket)&&this._searchcom_socket.dispatchEvent("closeTagger","")},setTaggerMode:function(t){window.hasOwnProperty("sendNotificationWebInWin")&&e.is(sendNotificationWebInWin,"function")?sendNotificationWebInWin("setTaggerMode",JSON.stringify({mode:t,useTabs:F.getItem("search_tabbed_ui")})):e.is(this._searchcom_socket)&&this._searchcom_socket.dispatchEvent("setTaggerMode",t)},launchAdvancedSearch:function(t){window.hasOwnProperty("sendNotificationWebInWin")&&e.is(sendNotificationWebInWin,"function")?sendNotificationWebInWin("showAdvancedSearch",JSON.stringify(t)):e.is(this._searchcom_socket)&&this._searchcom_socket.dispatchEvent("advancedSearch",t)},render:function(){return this},getActiveTenant:function(){return this._resources.getActiveTenant()},getTagsTransformer:function(){return this.getCollection()._tagsTransformer},onFilterChange:function(t){A.groupCollapsed("onFilterChange");var i=e.clone(t,!0);if(A.log("filters:",i),!0===this._beingDestroyed)return A.log("Being destroyed => exit"),void A.groupEnd();d.publish({channel:"3dSearch-global-view",topic:"emptyViews"});let n=this.getCollection();if(e.is(n)){if(n.isDestroyed())return void A.wxarn("Collection destroyed => don't take onFilterChange event into account!");n.interrupt(i)}this._isInAppsSearch()?this._onFilterChangeF(i):this.managePreferredUnitForAdvancedFilters(i),A.groupEnd()},_onFilterChangeF:function(t,i){var n=void 0!==i?i:this;if(n.getTagsTransformer()&&n.getTagsTransformer().getAvblSource(n._resources.getActiveTenant()),n._transformFilter(t),!e.is(n.options)||!e.is(n.options.search_options))return null;var s=n.getOption("search_options")||{};n.options.search_options.tag_filter=e.clone(t);var o,a,r,l,c=n._removeAdvancedFiltersFromTagFilter(t),d=null,u=!1,h="",g=[];if(e.is(s)&&(d=n._extractFTSFromFilter(t),x.isSimplifiedTaggerFilters(t.allfilters)&&(d.source=x.extractSourceInSimplifiedTagger(t.allfilters)),e.is(d))){var f=d.search_criteria;u=!0===d.search;var m;if(m=e.is(d.source,"array")&&d.source.indexOf("other")>-1,h=n._getSearchCriteriaForAdvancedFilters(d.new_filter,n._search_criteria,m),s.adv_search){if(e.is(n.getSNSkeleton,"function")&&e.is(n.getSNSkeleton().getAdvSearchMgr,"function")&&(o=n.getSNSkeleton().getAdvSearchMgr(),a=!(t.localfilters["sixw:ds6w:what/ds6w:type"]&&t.localfilters["sixw:ds6w:what/ds6w:type"].some((function(e){return e.object.split(":").pop()===o._adv_search_field}))),e.is(o)&&(r=o._dataSetsForType&&o._dataSetsForType.options&&o._dataSetsForType.options.datasets&&o._dataSetsForType.options.datasets.items,a&&r)))for(o._adv_search_field=null,l=0;l<o._dataSetsForType.options.datasets.items.length;l++)!0===o._dataSetsForType.options.datasets.items[l].predefined&&delete o._dataSetsForType.options.datasets.items[l].predefined;g=d.source,e.is(f)&&f.length?n._search_criteria=f:e.is(h)&&h.length?n._search_criteria="":n._search_criteria=_.SearchTypeEnum.ADVANCED_SEARCH}}if(!n._adv_search&&"#myContent"!==n._search_criteria&&n._searchcom_socket&&n._searchcom_socket.dispatchEvent("Last_Tag_Filter",n.options.search_options.tag_filter),s.adv_search){let t=n.getOption("in_apps_search");t&&t.advanced_search&&e.is(t.precond,"string")&&t.precond.trim().length>0&&(e.is(h,"string")&&h.trim().length>0?h="("+h+") AND ("+t.precond+")":t.advanced_search&&!0===t.advanced_search.searchOnInit&&(h=t.precond))}n._search_tag_filter=c;var S={search_criteria:n._search_criteria,advanced_criteria:h,adv_search:u,tag_filter:n._search_tag_filter,source:g,originalSearchCriteria:n._originalSearchCriteria,fromSearchHistory:!0,refineSearch:!0,viewData:C.getViewData()};e.is(n.options.search_options.search_criteria_to_display)&&(S.search_criteria_to_display=n.options.search_options.search_criteria_to_display);var v={};v.tag_filter=n._search_tag_filter,u&&(v.search_criteria=n._search_criteria,v.originalSearchCriteria=n._originalSearchCriteria,v.adv_search=!0,v.advanced_criteria=h,e.is(d)&&e.is(d.source)&&(v.source=d.source)),n._updateWdgPreferences(v);let w=n.getCollection();if(e.is(w)){let t=w.getRequestCriteria();e.is(t)&&e.is(t.service_params)&&(S.adv_search=t.service_params.adv_search)}if(e.is(w)){if(w.dispatchEvent("onFilterChange",t),e.is(n.options.search_options.applicativeTitle)&&(S.applicativeTitle=n.options.search_options.applicativeTitle),e.is(n.options.search_options.applicativeTitleWithResults)&&(S.applicativeTitleWithResults=n.options.search_options.applicativeTitleWithResults),p.getOption("enablePLM",{tenant:n.getActiveTenant()})){var b=n.options.search_options.tag_filter.PLMParameters;if(e.is(b)&&e.is(b.plmparam)&&e.is(b.plmparam.double)){if(e.is(n.getSNSkeleton,"function")&&e.is(n.getSNSkeleton().getAdvSearchMgr,"function")){var y=n.getSNSkeleton().getAdvSearchMgr();e.is(y)&&y.convertPLMParamUnits(b,(function(e){c.PLMParameters=e,n.onSearch(S)}))}}else c.PLMParameters=b,n.onSearch(S)}else n.onSearch(S);e.is(n.options.search_options.tag_filter)&&n.displayAllForTypeAttribut(n.options.search_options.tag_filter.allfilters)}if(e.is(t)&&e.is(t.localfilters)&&(e.is(t.localfilters["sixw:ds6w:where/ds6w:source/ds6w:dataSource"])||e.is(t.localfilters["ds6w:where/ds6w:source/ds6w:dataSource"]))){let i=t.localfilters["sixw:ds6w:what/ds6w:type"],s={sixw:"ds6w:what/ds6w:type",value:[]};e.is(i)&&i.length>0&&i.forEach((function(e){s.value.push(e.object)})),n.onCriteriaChange(s)}},_isIncontextSourceHidden:function(){var t=this.getOption("in_apps_search");return t&&t.advanced_search&&e.is(t.advanced_search.showSource)&&!1===t.advanced_search.showSource},managePreferredUnitForAdvancedFilters:function(t){var i=this,n=e.clone(t,!0);if(t.localfilters=x.getAllAdvanceFilters(t.localfilters),t.allfilters=x.getAllAdvanceFilters(t.allfilters),this._snUnitConversionHelper.getTypeListFromFilters(t.localfilters).length>0){var s={data:{},predicate2Type:{}};this._snUnitConversionHelper.prepareRequestDataF(t.allfilters,s),this._snUnitConversionHelper.prepareRequestDataF(t.localfilters,s),T.setResources(i._resources),T.convertValues({data:s.data,predicate2Type:s.predicate2Type,callback:function(e){Object.keys(e).length>0&&(i._snUnitConversionHelper.modifyFilterData(t.allfilters,e),i._snUnitConversionHelper.modifyFilterData(t.localfilters,e),x.applyTransformationAdvancedFilter(n.allfilters,(function(e){i._snUnitConversionHelper.copyConvertedValuesToOriginalFilter(e,t.allfilters)})),x.applyTransformationAdvancedFilter(n.localfilters,(function(e){i._snUnitConversionHelper.copyConvertedValuesToOriginalFilter(e,t.localfilters)}))),i._onFilterChangeF(n)}})}else this._onFilterChangeF(n)},displayAllForTypeAttribut:function(t){if(e.is(t)&&e.is(t["ds6w:what/ds6w:type"])){var i=this.getCollection().getTaggerProxy();null!==i&&i.toggleDisplayAll(!0)}},onOpenTagger:function(){p.options.search_settings.taggerClosed=!1},onCloseTagger:function(){p.options.search_settings.taggerClosed=!0},onCriteriaChange:function(t){if(this.skeleton){var i=this.skeleton.getAdvSearchMgr();e.is(i)&&i.handleCriteriaChange(t)}},onCriteriaModified:function(t){let i=this;if(this.skeleton){var n=this.skeleton.getAdvSearchMgr();let o=i._createCriteriaFilterData(t);if(t={allfilters:t},e.is(n)){let a=i._extractFTSFromFilter(t);x.isSimplifiedTaggerFilters(t.allfilters)&&(a.source=x.extractSourceInSimplifiedTagger(filters.allfilters));let r="";if(e.is(a)){var s;s=e.is(a.source,"array")&&a.source.indexOf("other")>-1,r=this._getSearchCriteriaForAdvancedFilters(t,"#advancedSearch",s);let l=this._getSearchCriteriaForAdvancedFilters(o,"#advancedSearch",s),c=i.getOption("in_apps_search");c&&c.advanced_search&&e.is(c.precond,"string")&&c.precond.trim().length>0&&(e.is(r,"string")&&r.trim().length>0?r="("+r+") AND ("+c.precond+")":c.advanced_search&&!0===c.advanced_search.searchOnInit&&(r=c.precond)),n.handleCriteriaModified(r,l,o)}else n.handleCriteriaModified("","",null)}else n.handleCriteriaModified("","",null)}else n.handleCriteriaModified("","",null)},_createCriteriaFilterData:function(t){let i={};if(!e.is(t)||e.is(t,"object")&&0==Object.keys(t).length)return i=null,i;if(i.allfilters={},t["sixw:ds6w:where/ds6w:source/ds6w:dataSource"]){let e=t["sixw:ds6w:where/ds6w:source/ds6w:dataSource"];i.allfilters["sixw:ds6w:where/ds6w:source/ds6w:dataSource"]=e}if(t["sixw:ds6w:what/ds6w:type"]){let e=t["sixw:ds6w:what/ds6w:type"];i.allfilters["sixw:ds6w:what/ds6w:type"]=e}if(t["sixw:vpmextension"]){let e=t["sixw:vpmextension"];i.allfilters["sixw:vpmextension"]=e}return i},onPLMUpdate:function(t){if(this.skeleton){var i=this.skeleton.getAdvSearchMgr();e.is(i)&&i.handlePLMCriteriaChange(t)}},OnSuggestUpdate:function(t){if(this.elements&&this.skeleton){var i=this.skeleton.getAdvSearchMgr();e.is(i)&&i.handleTypeSuggestListChange(t)}},OnGroupingChange:function(t){A.log("Grounping cb",t);let i=F.getItem("LastSearchViewMode"),n=!!this.getCollection()&&this.getCollection()._isPinnedWidget();if(e.is(t)&&(!e.is(t.groups,"array")||0!==t.groups.length)||e.is(t)&&(!e.is(t.allMyContent)||!0===t.allMyContent)||e.is(this._taggerProxy)&&(!e.is(this._taggerProxy)||e.is(this._taggerProxy.getCurrentFilter()))&&0!==Object.keys(this._taggerProxy.getCurrentFilter()).length&&(e.is(this._taggerProxy.getCurrentFilter().allfilters)&&(!e.is(this._taggerProxy.getCurrentFilter().allfilters.condition)||0!==this._taggerProxy.getCurrentFilter().allfilters.condition.length)||e.is(this._taggerProxy.getCurrentFilter().localfilters)&&0!==this._taggerProxy.getCurrentFilter().localfilters.condition.length)||this._search_criteria!==_.SearchTypeEnum.MY_CONTENT||n||(i="myContent",t=this._onGroupingOnMyRecent()),e.is(t,"object")){let n=this.getCollection();this.embeddedTaggerTags=t;let s=[];for(let e=0;e<t.groups.length;e++)s.push(t.groups[e].predicate);this.getRefineHelpers().hideTagcloudView(),this.getRefineHelpers().hideGlobeView(),this.getRefineHelpers().hideTimelineView(),this.getRefineHelpers().hidePhonebookView(),1===s.length&&("type_categorization"===s[0]&&(i="what"),"person"===s[0]&&(i="who"),"ds6w:modified"===s[0]&&(i="when"),("computedCountryInfo"===s[0]||"ds6w:dataSource"===s[0])&&(i="where")&&this.getRefineHelpers().showGlobeView()),e.is(this.skeleton)&&this.skeleton.switchOnView(i),"myContent"===i&&this._taggerProxy&&this._taggerProxy.clearLocalGrouping(),n&&n.dispatchEvent("OnGroupingChange",t)}else"#myContent"===this._search_criteria&&!e.is(t)&&e.is(this._taggerProxy)&&e.is(this._taggerProxy.getCurrentFilter())&&e.is(this._taggerProxy.getCurrentFilter().allfilters)&&e.is(this._taggerProxy.getCurrentFilter().allfilters.condition)&&this._taggerProxy.getCurrentFilter().allfilters.condition.length>0&&e.is(this._taggerProxy.getCurrentFilter().localfilters)&&e.is(this._taggerProxy.getCurrentFilter().localfilters.condition)&&this._taggerProxy.getCurrentFilter().localfilters.condition.length>0?console.log("Nothing to do."):e.is(this.skeleton)&&i!==this.skeleton.getCurrentView().id&&this.skeleton.switchOnView(i);e.is(this._taggerProxy)&&this._taggerProxy.setStatus({action:"grouping",status:!0,message:"Grouping sucessful"})},_onGroupingOnMyRecent:function(){let e=[],t=[],i={},n={iconInfo:{classes:"fonticon fonticon-clock"}};return n.dispText=D.get("myRecentContentTitle"),n.object=[],n.predicate=[],n.type="string",e.push(n),i.iconInfo={classes:"fonticon fonticon-user"},i.dispText=D.get("myContentTitle"),i.object=[],i.predicate=[],i.type="string",e.push(i),t.push({object:e,predLevel:!0,predicate:"myContent"}),{groups:t}},_extractFTSFromFilter:function(t){if(e.is(t)&&e.is(t.allfilters)){var i={new_filter:{allfilters:{}},search_criteria:"",search:t.search,source:[]};if(!1===this._isIncontextSourceHidden()&&this._adv_search&&!t.localfilters.hasOwnProperty("sixw:ds6w:where/ds6w:source/ds6w:dataSource")&&!t.allfilters.hasOwnProperty("sixw:ds6w:where/ds6w:source/ds6w:dataSource"))return i;for(var n in t.allfilters)if(0!==n.indexOf("sixw:fts_value"))if("sixw:ds6w:where/ds6w:source/ds6w:dataSource"===n){let e=t.allfilters[n];for(let t=0;t<e.length;t++)0===t&&(i.source=[]),i.source.push(e[t].object)}else"ds6w:where/ds6w:source/ds6w:dataSource"===n?i.source=t.allfilters["ds6w:where/ds6w:source/ds6w:dataSource"][0].object:i.new_filter.allfilters[n]=t.allfilters[n];else{let e=t.allfilters[n];for(let t=0;t<e.length;t++)0===t&&1<e.length&&(i.search_criteria="("),0<t&&(i.search_criteria+=" OR "),i.search_criteria+=e[t].object,e.length===t+1&&1<e.length&&(i.search_criteria+=")")}return i}},getCollection:function(){if(this.skeleton)return this.skeleton.getCollection()},setShadings:function(e){this.getSNSkeleton().setShadings(e)},getItemsId:function(){var e=this.getCollection();if(e)return e.pluck("id")},dispatchInContextSelection:function(t,i){var n=this,s=this.getOption("in_apps_search");!0===p.getOption("search_web_in_win")?n._searchcom_socket.dispatchEvent("onDispatchToWin",{notif_name:"onInContextAction",notif_parameters:JSON.stringify({action:i,selected_ids:n._selected_objects.pluck("id")})},t):(n._searchcom_socket&&(t&&n._selected_objects&&(n._selected_objects.size()?n._searchcom_socket.dispatchEvent("Selected_Objects_search",n._selected_objects.toArray(),[t],["SearchComServer"]):A.log("No object selected")),n._searchcom_socket.dispatchEvent("clearSearch",{destroy:!0,noFocus:!0}),d.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"deactivateInContextSearch",data:{bCloseSidePanel:!e.is(s.closeTransient)||!0===s.closeTransient,bPinnedWidget:!(e.is(s)&&e.is(s.fromPinnedWidget,"boolean")&&!0===s.fromPinnedWidget),bEditSavedSearchSocket:"socket_id_#saved_search_edit#"===t}}),e.is(s.closeTransient)&&!0!==s.closeTransient||n._searchcom_socket.dispatchEvent("closeTransient",{command_id:i})),this.dispatchPowerByInContextSelection()),n._searchcom_socket&&t&&n._searchcom_socket.dispatchEvent("InContextSearch_Response",{selected_data:b.buildCompassSelectionData({selectedModels:n._selected_objects.toArray()}),selected_objects:n._selected_objects?n._selected_objects.toArray():[],search_params:n.getCollection().service_parameters,selected_command:i},[t]),"in_app_apply"!=i&&this._taggerClearLocalFilter(!0),this.hideAdvancedSearch()},dispatchPowerByInContextSelection:function(t){var i=this;if(e.is(i.getOption("addinMode"),"string")&&i._selected_objects)if(i._selected_objects.size()>=i.getInContextMinSelect()){var n=b.buildCompassSelectionData({widgetId:i.getOption("widget_id"),selectedModels:i._selected_objects.toArray()}),s=JSON.stringify({event:"search_in_context_OK",source:n.source,version:n.version,content:n});A.log("publishing webinwin:web:notification SELECTION event, data:"+s),c.publish("webinwin:web:notification",s)}else if(!t)throw new Error("OK event fired without a selection !")},_rebuildSkeleton:function(t){A.log("_rebuildSkeleton"),this.skeleton&&(this.skeleton.stopListening(),this.skeleton.destroy(),delete this.skeleton),this._search_criteria="",this._originalSearchCriteria="",this._selected_objects=new o,this._adv_search=!1,this._advanced_criteria="",this._ok_Button=null,this._apply_Button=null,this._adv_search_field=null,this.onesearch_indexedtimeIcon=null,e.is(this.indexedtimeMenu)&&(e.is(this.indexedtimeMenu.destroy,"function")&&this.indexedtimeMenu.destroy(),this.indexedtimeMenu=null),this._isMultiSelModeOnTouch=!1,this._historySearch=null,this._headersSearch=null,this._idWaitLoading=null,this.elements.container&&this.elements.container.remove(),this.elements.container=null,this.embeddedTaggerTags=null,this.oRefineHelpers.reset(),this._searchBackViewContainer=null,this._searchBackViewContainerContent=null,this.searchLayoutContainer=null,this._buildDOM(),this._buildSkeleton(t)},_buildDOM:function(){var t=this.getOption("in_apps_search"),i=!1;if(e.is(t,"object")&&"furtive"===t.mode&&(i=!0),!e.is(this.elements.container)){var n=this.getClassNames();n.replace(" ","_"),this.elements.container=a.create("div",{class:this.getClassNames(),"data-rec-id":n})}var s=this.elements.container;let o=this.getOption("pinToDashboard");return _.isFUN109031Active()&&!this._isInAppsSearch()&&!1!==o&&(!i||i&&!0===t.modifysavedsearch)&&(e.is(this.embeddedTaggerContainer)||(this.embeddedTaggerContainer=a.create("div",{id:"embedded-tagger-"+this.getOption("widget_id")+"-"+this.getTabID()})),this.embeddedTaggerContainer.inject(s),e.is(this.searchLayoutContainer)||(this.searchLayoutContainer=a.create("div",{id:"3dsearch-layout-"+this.getOption("widget_id")+"-"+this.getTabID()})),this.searchLayoutContainer.inject(s)),this.getRefineHelpers().create6WRefineHelpers(this._isInAppsSearch(),i,t,s,this.searchLayoutContainer,this.getOption("widget_id"),this.getTabID()),F.getItem("nav_history")&&!0===bOkTonav_history&&(!F.getItem("integratedSearch")&&searchWidget&&(searchWidget.context="transient"),this.elements.containerContent=a.create("div",{class:"searchContainer","data-rec-id":"searchContainer"}),this.elements.containerContent.inject(this.elements.container),null===this._historySearch&&(this.elements.containerHistory=a.create("div",{class:"history-div","data-rec-id":"history-div",styles:{display:"none"}}),this.elements.containerHistory.inject(this.elements.containerContent,"bottom"),this._historySearch=new V,this._historySearch.addEvent("onSelected",this.onhistorySearchSelect.bind(this))),this.elements.containerProduct=a.create("div",{class:"product-div","data-rec-id":"product-div",styles:{display:"none",height:"100%"}}),this.elements.containerProduct.inject(this.elements.containerContent),this.elements.containerRelational=a.create("div",{class:"relational-div","data-rec-id":"relational-div",styles:{display:"none",height:"100%"}}),this.elements.containerRelational.inject(this.elements.containerContent),s=this.elements.containerContent),!0},_buildSkeleton:function(t){var i=this,n=this.getOption("in_apps_search"),s=!1,o=i.elements.container;e.is(n,"object")&&"furtive"===n.mode&&(s=!0);var a=!1,r=_.getSearchWidget(i.getOption("widget_id"));r&&e.is(r.getView,"function")&&(e.is(r.getView().previous)&&e.is(r.getView().previous.type)&&"windowed"===r.getView().previous.type||e.is(r.getView().type)&&"sidepanel"===r.getView().type)&&(a=!0),e.is(n)&&(a=!1);var l=!1;F.getItem("nav_history")&&!0===a&&(l=!0);let c=!1;if(F.getItem("integratedSearch")&&o&&(o.addClassName("sideSearch"),c=this.getOption("pinToDashboard"),r&&void 0===this.getOption("pinToDashboard"))){var d=r.getValue("launch_mode");d!==_.widgetLaunchMode.COMPASS_TRANSIENT&&d!==_.widgetLaunchMode.COMPASS_PINNED&&d!==_.widgetLaunchMode.INCONTEXT_TRANSIENT||(c=!1)}e.is(this.skeleton)&&e.is(this.skeleton.destroy)&&this.skeleton.destroy(),this.skeleton=new m({messagingChannel:i.getMessagingChannel(),renderTo:null!=i.searchLayoutContainer&&null!=i.searchLayoutContainer?i.searchLayoutContainer:o,observable:this,resources:this._resources,tagger_proxy:this._taggerProxy,powerByOptions:this.getOption("powerByOptions"),in_apps_search:n,furtive:s,events:t.events,source:t.source,widgetId:this.getOption("widget_id"),transient_context:this.getOption("transient_context"),use_preexisting_call:this.getOption("use_preexisting_call"),viewData:this.getOption("viewData"),pinToDashboard:c,navHistory:l,addinMode:this.getOption("addinMode"),idWaitLoading:this._idWaitLoading}),s&&this._createFurtiveControls(),F.getItem("nav_history")&&(i.getSNSkeleton().addEvent("onExploreAction",i.onExploreAction.bind(i)),i.getSNSkeleton().addEvent("onFedSearchComplete",i.onAddSearchBox.bind(i)),i.getSNSkeleton().addEvent("selected_obj",i.onSelected_obj.bind(i))),i.getSNSkeleton().addEvent("onPreviewModeRequest",(function(){A.log("onPreviewModeRequest"),i._onPreviewModeRequest()})),i.getSNSkeleton().addEvent("onExitPreviewMode",(function(){A.log("onExitPreviewMode"),i._onExitPreviewModeRequest()}))},_setPreviewMode:function(e){this._previewMode=e},_getPreviewMode:function(){return this._previewMode},_onPreviewModeRequest:function(){this._setPreviewMode(!0);let t=this;t.dispatchEvent("onPreviewModeRequest"),this._bTaggerClosedForPreview=!1;let i=_.getWidth()<=1920;p.getOption("search_web_in_win")&&(t._bWidgetMaximizedForPreview=!1,i&&e.is(t.isTaggerVisible,"function")&&t.isTaggerVisible((function(e){!0===e&&(t.closeTagger(),t._bTaggerClosedForPreview=!0)})),t.requestView({type:"fullscreen"}),t._bWidgetMaximizedForPreview=!0,window.hasOwnProperty("sendNotificationWebInWin")&&e.is(sendNotificationWebInWin,"function")&&sendNotificationWebInWin("PreviewModeRequest"))},_onExitPreviewModeRequest:function(){this._setPreviewMode(!1),this.dispatchEvent("onExitPreviewMode"),p.getOption("search_web_in_win")&&(e.is(this.requestView,"function"),!0===this._bTaggerClosedForPreview&&e.is(this.openTagger,"function")&&this.openTagger(),window.hasOwnProperty("sendNotificationWebInWin")&&e.is(sendNotificationWebInWin,"function")&&sendNotificationWebInWin("ExitPreviewModeRequest"))},isTaggerVisible:function(t){let i=!0,n=this.getCollection();if(e.is(n,"object")&&e.is(n.getTaggerProxy,"function")){let t=this.getCollection().getTaggerProxy();e.is(t,"object")&&e.is(t.getDisplayStatus,"function")&&(i=t.getDisplayStatus())}t(i)},requestView:function(){A.log("SNResultMgt.requestView TO IMPLEMENT")},_createFurtiveControls:function(){A.log("furtive mode activated");var t=this,i=this.getOption("in_apps_search"),n=i.app_socket_id,s=!1,o="Apply";e.is(i,"object")&&!0===i.showApplyButton&&(s=!0),e.is(i,"object")&&i.applyButton_Nls&&(o=i.applyButton_Nls);var r=D.get("OKButton"),l=D.get("APPLYButton");if(e.is(i)&&e.is(i.nls)){var u=i.nls;e.is(u.button_ok_label,"string")&&u.button_ok_label.length>0&&(r=u.button_ok_label),e.is(u.button_apply_label,"string")&&u.button_apply_label.length>0&&(l=u.button_apply_label)}require(["DS/UIKIT/Input/ButtonGroup","DS/UIKIT/Input/Button"],(function(u,h){var g="bottom",f=t.elements.container;if(-1!==["iphone","android"].indexOf(_.getDeviceCategory())){f=a.create("div",{class:"buttonContainer",styles:{order:"1",position:"absolute",height:"10%",bottom:"0",right:"0"}}).inject(t.elements.container),t.elements.container.setStyle("flex-direction","column");var m=t.elements.container.getElement(".onesearch_skeleton");e.is(m)&&m.setStyle("order","2")}else f=a.create("div",{class:"buttonContainer footer_button"}).inject(t.elements.container);new h({id:"id_in_app_cancel",value:D.get("CancelButton"),className:"default in_app_search_btn",events:{onClick:function(){!0===_.isTaggerOpenedByCode()&&!0===_.isFUN109031Active()&&t._searchcom_socket.dispatchEvent("closeTagger"),function(s){if(!0===p.getOption("search_web_in_win"))t._searchcom_socket.dispatchEvent("onDispatchToWin",{notif_name:"onInContextAction",notif_parameters:JSON.stringify({action:"in_app_cancel"})},s);else if(t._searchcom_socket&&(t._searchcom_socket.dispatchEvent("clearSearch",{destroy:!0,noFocus:!0}),e.is(i.closeTransient)&&!0!==i.closeTransient||t._searchcom_socket.dispatchEvent("closeTransient",{command_id:"in_app_cancel"}),d.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"deactivateInContextSearch",data:{bCloseSidePanel:!e.is(i.closeTransient)||!0===i.closeTransient,bPinnedWidget:!(e.is(i)&&e.is(i.fromPinnedWidget,"boolean")&&!0===i.fromPinnedWidget),bEditSavedSearchSocket:"socket_id_#saved_search_edit#"===s}})),e.is(t.getOption("addinMode"),"string")){var o=JSON.stringify({event:"search_in_context_CANCEL",source:_.getSearchAppId(),version:"1.0",content:{}});A.log("publishing webinwin:web:notification search_in_context_CANCEL event, data:"+o),c.publish("webinwin:web:notification",o)}n&&t._searchcom_socket.dispatchEvent("InContextSearch_Response",{selected_objects:t._selected_objects.toArray(),search_params:t.getCollection().service_parameters,selected_command:"in_app_cancel"},[n],["SearchComServer"]),e.is(t._taggerProxy)&&(e.is(t._taggerProxy.clearLocalFilter,"function")&&t._taggerProxy.clearLocalFilter(),e.is(t._taggerProxy.clearLocalGrouping,"function")&&t._taggerProxy.clearLocalGrouping(),t._taggerProxy.unsetTags()),t.hideAdvancedSearch()}(n)}}}).inject(f,g);let S=null;s&&(S=new h({id:"id_in_app_apply",value:l,className:"default in_app_search_btn",disabled:!0,events:{onClick:function(){!0===_.isTaggerOpenedByCode()&&!0===_.isFUN109031Active()&&t._searchcom_socket.dispatchEvent("closeTagger"),t.dispatchInContextSelection(n,"in_app_apply")}}}).inject(f,g),new R({position:"top",target:S.getContent(),body:o}));var v=!0;i.furtive_options&&0===i.furtive_options.min_select&&(v=!1);var w=new h({id:"id_in_app_ok",value:r,className:"default in_app_search_btn primary",disabled:v,events:{onClick:function(){!0===_.isTaggerOpenedByCode()&&!0===_.isFUN109031Active()&&t._searchcom_socket.dispatchEvent("closeTagger"),t.dispatchInContextSelection(n,"in_app_ok")}}}).inject(f,g);t._ok_Button=w,e.is(S)&&(t._apply_Button=S,S.disable()),w.setDisabled(v)}))},_removeAdvancedFiltersFromTagFilter:function(t){var i=this;if(!e.is(t))return t;if(!e.is(t.allfilters))return t;let n=x.isSimplifiedTaggerFilters(t.allfilters),s={allfilters:{}},o=null;for(o in t.allfilters)s.allfilters[o]=t.allfilters[o];if(e.is(t.localfilters))for(o in t.localfilters)e.is(s.localfilters)||(s.localfilters={}),s.localfilters[o]=t.localfilters[o];return n&&(t.allfilters=i._getAllFilters(t.allfilters),t.localfilters=i._getAllFilters(t.localfilters)),i._adv_search&&e.is(t.localfilters)&&(e.is(i.getSNSkeleton())&&e.is(i.getSNSkeleton().getAdvSearchMgr())&&i.getSNSkeleton().getAdvSearchMgr().showSourceField()&&t.localfilters.hasOwnProperty("sixw:ds6w:what/ds6w:type")&&1===Object.keys(t.localfilters).length||t.localfilters.hasOwnProperty("sixw:ds6w:where/ds6w:source/ds6w:dataSource")&&1===Object.keys(t.localfilters).length||0===Object.keys(t.localfilters).length)?(e.is(i._taggerProxy)&&e.is(i._taggerProxy.clearLocalFilter,"function")&&i._taggerProxy.clearLocalFilter(),e.is(i._taggerProxy)&&e.is(i._taggerProxy.clearLocalGrouping,"function")&&i._taggerProxy.clearLocalGrouping(),i._taggerProxy.unsetTags(),{allfilters:{}}):s},_getAllFilters:function(e){var t={};return((e=e||{}).condition||[]).forEach((function(e){Object.keys(e).forEach((function(i){0==i.indexOf("sixw:")?(t[i]=t[i]||[],(e[i]||[]).forEach((function(e){t[i].push(e)}))):(e[i].condition||[]).forEach((function(e){var i=e.predicates||[],n=e.value||[],s=e.field;i.forEach((function(i,o){t[i.predicate]||(t[i.predicate]=[]);var a={disptext:e.display,object:n[o],type:i.type,field:s?[s[o]]:["implicit"]};t[i.predicate].push(a)}))}))}))})),t},_getSearchCriteriaForAdvancedFilters:function(t,i,n){if(!e.is(t))return i;if(!e.is(t.allfilters))return i;var s=p.getOption("SEARCH_INSTANCES",{tenant:this.getActiveTenant()});return w.from_filters_to_uql(t.allfilters,i,n,s)},_toggleProxyFocus:function(t){e.is(this._taggerProxy)&&!0===p.getOption("proxy_button_available")&&(this._taggerProxy._attributes.widgetId===t.widgetId&&-1===["iphone","ipad","android"].indexOf(_.getDeviceCategory())&&!0!==p.options.search_settings.taggerClosed&&this._taggerProxy.toggleProxyFocus(t.maximized))},setTitle:function(t){var i=this.getSNSkeleton();e.is(i)&&i.setTitle(t)},getSNSkeleton:function(){var t;return e.is(this.skeleton)&&(t=this.skeleton),t},updateSelectionNumber:function(t){var i=this.getSNSkeleton();if(!e.is(i))throw new Error("No skeleton in SNResultMgt.updateSelectionNumber !");if(e.is(this.onesearch_selectionNumber)){this.onesearch_selectionNumber.style.display=this._isMultiSelModeOnTouch||t.number>0&&"nullToMany"===i._selectionMode_techno?"inline":"none",this.onesearch_selectionNumber.innerHTML=t.number,!t.isMultiSelMode&&t.number<=1&&!this._isMultiSelModeOnTouch?this.onesearch_selectionNumberDiv.style.color="rgb(180, 182, 186)":this._isMultiSelModeOnTouch&&(this.onesearch_selectionNumberDiv.style.color="#368ec4");var n=i.getOption("in_apps_search"),s=n&&n.UXOptions&&!n.UXOptions.localActions;!t.isMultiSelMode&&"nullToMany"!==i._selectionMode_techno||s?this.onesearch_globalDropdownIcon.style.display="none":this.onesearch_globalDropdownIcon.style.display="inline"}else{var o=p.getOption("search_compact_mode");if(e.is(o)&&!1===o&&e.is(this._detailsviewSelected))if(t.number>0){this._detailsviewSelected.setStyle("display","flex");var a=this._detailsviewSelected.getElement(".set-detail-view-select");e.is(a)&&a.setText(t.number)}else this._detailsviewSelected.setStyle("display","none")}},updateUnselectedResults:function(){var t=this.getSNSkeleton();if(!e.is(t))throw new Error("No skeleton in SNResultMgt.updateSelectionNumber !");if(e.is(this._detailsviewSelected)&&"none"!==this._detailsviewSelected.getStyle("display"))if(e.is(this.onesearch_selectionNumber))e.is(this.onesearch_selectionNumber)&&"none"!==this.onesearch_selectionNumber.getStyle("display")&&(this.onesearch_selectionNumber.style.display="none");else{var i=p.getOption("search_compact_mode");e.is(i)&&!1===i&&e.is(this._detailsviewSelected)&&this._detailsviewSelected.setStyle("display","none")}},getSearchContentSetHeader:function(){return this._contentSetHeader},showSearchContentSetHeader:function(e){this._contentSetHeader.getElement(".onesearch_sortcontent")&&this._contentSetHeader.getElement(".onesearch_sortcontent").setStyle("display",""),this._contentSetHeader.getElement(".onesearch_action")&&this._contentSetHeader.getElement(".onesearch_action").setStyle("display",""),this._contentSetHeader.getElement(".search-content-set-switcher.content-set-switcher.set-switcher")&&this._contentSetHeader.getElement(".search-content-set-switcher.content-set-switcher.set-switcher").setStyle("display",""),this._contentSetHeader.getElement(".onesearch_resizer_6w")&&this._contentSetHeader.getElement(".onesearch_resizer_6w").setStyle("display","none"),this._contentSetHeader.getElement(".search-content-set-actions")&&(_.isTabletCompactMode()&&"portrait"===_.getViewportOrientation()?this._contentSetHeader.getElement(".search-content-set-actions").setStyle("display","none"):this._contentSetHeader.getElement(".search-content-set-actions").setStyle("display",""))},hideSearchContentSetHeader:function(e){this._contentSetHeader.getElement(".onesearch_sortcontent")&&this._contentSetHeader.getElement(".onesearch_sortcontent").setStyle("display","none"),this._contentSetHeader.getElement(".onesearch_action")&&this._contentSetHeader.getElement(".onesearch_action").setStyle("display","none"),this._contentSetHeader.getElement(".search-content-set-switcher.content-set-switcher.set-switcher")&&this._contentSetHeader.getElement(".search-content-set-switcher.content-set-switcher.set-switcher").setStyle("display","none"),this._contentSetHeader.getElement(".onesearch_resizer_6w")&&this._contentSetHeader.getElement(".onesearch_resizer_6w").setStyle("display","block"),this._contentSetHeader.getElement(".search-content-set-actions")&&("where"===e||_.isTabletCompactMode()&&"portrait"===_.getViewportOrientation()?this._contentSetHeader.getElement(".search-content-set-actions").setStyle("display","none"):this._contentSetHeader.getElement(".search-content-set-actions").setStyle("display",""))},_injectRecentStuff:function(t){var i=this,n=this.getSNSkeleton();if(!0===p.getOption("show_last_indexation_time")){this.elements.recentcontent=a.create("div",{class:"onesearch_recentcontent","data-rec-id":"onesearch_recentcontent"}),this.elements.recentcontent.inject(t),this.onesearch_indexedtimeIcon=a.create("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-clock","data-rec-id":"SNResultMgt_wux-ui-3ds_wux-ui-3ds-1x_wux-ui-3ds-clock",styles:{fontSize:"24px"}}).inject(this.elements.recentcontent);var s=p.getOption("Recent_Content_Delta_Time",{tenant:this.getActiveTenant()}),o=D.replace(D.get("switchToRecentContent"),{recentDelta:s});this.onesearch_indexedtimeIcon.tooltip=new R({position:"bottom",target:this.onesearch_indexedtimeIcon,body:o});var r,l,c={},d={},u={};_.isODTMode()&&(c={"data-rec-id":"recentMenu"},d={"data-rec-id":"recent"},u={"data-rec-id":"allRecent"}),c.style="max-width: 600px;",d.style="white-space: normal;";var h=this.getOption("in_apps_search");e.is(h)&&e.is(h.recent_search)&&e.is(h.recent_search.types)&&h.recent_search.types.length>0?(r=D.get("searchInMyRecentContentInContext"),l=D.get("displayAllMyRecentContentInContext")):(r=D.get("searchInMyRecentContent"),l=D.get("displayAllMyRecentContent")),this.indexedtimeMenu=n.indexedtimeMenu=new M({className:"search_recent_container",target:this.elements.recentcontent,items:[{id:"last_index",text:D.replace(D.get("lastIndexedTimeTooltip"),{indexTime:D.get("indexTimeNotAvailable")}),className:"header",attributes:{style:"text-transform: none;"}},{id:"warning",name:"warning",className:"header",text:D.get("warningIndexed"),attributes:{style:"text-transform: none; display: none;"}},{id:"divider",className:"divider"},{id:"my_recent",name:"my_recent",text:r,fonticon:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-search",selectable:!0,attributes:d},{id:"all_my_recent",name:"all_my_recent",text:l,fonticon:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-search",selectable:!0,attributes:u}],attributes:c,events:{onClick:function(t,s){i._taggerProxy&&(i._taggerProxy.deactivate(),i._taggerProxy.unsetTags());var o=i.getOption("search_options")||{};if(!0===i._adv_search){var a=n.getAdvSearchMgr();e.is(a)&&e.is(a.hideAdvancedSearchTab,"function")&&a.hideAdvancedSearchTab()}o.search_criteria_to_display&&(this.last_search_criteria=o.search_criteria_to_display),"my_recent"===s.name?(n._myDatagridView&&n._myDatagridView._model&&n._myDatagridView._model.getXSO().empty(),n.getCollection().reset(),i._searchcom_socket.dispatchEvent("onSearchModeSwitch",{new_mode:_.SearchTypeEnum.MY_RECENT_CONTENT,paramsFilter:o.search_criteria_to_display?o.search_criteria_to_display:this.last_search_criteria,widgetId:n.options.widgetId}),!0===p.getOption("search_web_in_win")&&(o.search_criteria=_.SearchTypeEnum.MY_RECENT_CONTENT,o.recent_filter=o.originalSearchCriteria,n._searchActions.dispatchEvent("onRefreshResultRequest"))):"all_my_recent"===s.name&&(_.SearchTypeEnum.MY_RECENT_CONTENT===o.search_criteria?(window.hasOwnProperty("sendNotificationWebInWin")&&e.is(sendNotificationWebInWin,"function")?sendNotificationWebInWin("UpdateSearchField",JSON.stringify({search_criteria:_.SearchTypeEnum.MY_RECENT_CONTENT,search_mode:"index"})):i._searchcom_socket.dispatchEvent("onRefreshSearchField",""),n.getCollection().filterSearch({recent_filter:"*"}),o.recent_filter="*"):(n._myDatagridView&&n._myDatagridView._model&&n._myDatagridView._model.getXSO().empty(),n.getCollection().reset(),i._searchcom_socket.dispatchEvent("onSearchModeSwitch",{new_mode:_.SearchTypeEnum.MY_RECENT_CONTENT,paramsFilter:"*",widgetId:n.options.widgetId}),!0===p.getOption("search_web_in_win")&&(o.search_criteria=_.SearchTypeEnum.MY_RECENT_CONTENT,o.recent_filter="*",o.adv_search=!1,o.advanced_criteria="",n._searchActions.dispatchEvent("onRefreshResultRequest"),window.hasOwnProperty("sendNotificationWebInWin")&&e.is(sendNotificationWebInWin,"function")&&sendNotificationWebInWin("UpdateSearchField",JSON.stringify({search_criteria:"#myRecentContent"}))))),i.onesearch_indexedtimeIcon.className=s.fonticon},onShow:function(){if(-1!==i.onesearch_indexedtimeIcon.className.indexOf("wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-clock")){var t=!0;switch(i._getSearchType()){case _.SearchTypeEnum.MY_CONTENT:case _.SearchTypeEnum.ADVANCED_SEARCH:case _.SearchTypeEnum.FAVORITE_SEARCH:t=!1}this.items.forEach((function(n){if(n.selected=!1,n.elements.container.removeClassName("selected"),e.is(n)&&"my_recent"===n.name)if(n.elements.container.setStyle("display","inline-block"),!1===t)n.elements.container.setStyle("display","none");else{var s="",o=i.options.search_options.originalSearchCriteria;s=e.is(h)&&e.is(h.recent_search)&&e.is(h.recent_search.types)&&h.recent_search.types.length>0?D.replace(D.get("searchInMyRecentContentInContext"),{searchCriteria:o}):D.replace(D.get("searchInMyRecentContent"),{searchCriteria:o}),i.indexedtimeMenu.updateItem({id:i.indexedtimeMenu.items[3].id,text:s})}}))}}}}),n.indexedtimeIcon=this.onesearch_indexedtimeIcon}this.getSNSkeleton()&&this.getSNSkeleton().updateByUXOptions&&this.getSNSkeleton().updateByUXOptions(D.get("indexTimeNotAvailable"))},_setErrorManagerMaximumResultsTooltip:function(t){for(var i=this.onesearch_errorManagerIcon.tooltip.getBody().getElementsByTagName("div"),n="",s="",o=0;o<i.length;o++)i[o].className.contains("sourceErrorTooltipContent")&&(n=i[o].outerHTML);e.is(t)&&(s='<div class="maximumResultsTooltipContent">'+D.replace(D.get("maximum_results"),{count:t})+"</div>");var a=s+n;this.onesearch_errorManagerIcon.tooltip.getBody().getChildren()[2].setHTML(a),this._manageErrorManagerDisplay()},_setErrorManagerSourceErrorsTooltip:function(e){for(var t=this.onesearch_errorManagerIcon.tooltip.getBody().getElementsByTagName("div"),i="",n="",s=0;s<t.length;s++)t[s].className.contains("maximumResultsTooltipContent")&&(n=t[s].outerHTML);""===e?this.onesearch_errorManagerIcon.tooltip.getBody().getChildren()[2].setHTML(n):(i="<div class='sourceErrorTooltipContent'>"+e+"</div>",this.onesearch_errorManagerIcon.tooltip.getBody().getChildren()[2].setHTML(n+i)),this._manageErrorManagerDisplay()},_manageErrorManagerDisplay:function(){for(var e=this.onesearch_errorManagerIcon.tooltip.getBody().getElementsByTagName("div"),t=!1,i=!1,n=0;n<e.length;n++)e[n].className.contains("sourceErrorTooltipContent")&&(t=!0),e[n].className.contains("maximumResultsTooltipContent")&&(i=!0);_.isFUN109031Active()||(!0===t||!0===i?this.onesearch_errorManagerIcon.show():this.onesearch_errorManagerIcon.hide())},setSearchContentSetHeader:function(t){let i=this.getSNSkeleton();if(!e.is(i))throw new Error("No skeleton in SNResultMgt.setSearchContentSetHeader !");e.is(t)||A.error("Unexpected error in setSearchContentSetHeader invalid iContentSetHeader !");let n=_.isInTheSimpleSearch({tenant:this._resources.active_tenant}),s=this.getOption("swymContext");this._contentSetHeader=t;try{return!0===n||!0===s?this._setSearchContentSetHeaderForPreviewSwym():this._setSearchContentSetHeaderForStandardCase()}catch(e){console.log("Init content set header failed",e)}},_setSearchContentSetHeaderForPreviewSwym:function(){let t=p.getOption("search_compact_mode"),i=_.isInTheSimpleSearch({tenant:this._resources.active_tenant}),n=F.getItem("NoindexOnBar"),s=F.getItem("NomultiSelection"),o=F.getItem("NoSort"),r=this.getOption("swymContext"),l=this._contentSetHeader;var c=this;if(this._setOneSearchLimitMessage(l,this.getCollection()),!0===s&&l.setStyle("height","0px"),!0!==n&&!0!==r||!e.is(l.getElement(".set-multiselHeader"))||l.getElement(".set-multiselHeader").setStyle("height","0px"),this.elements.label=a.create("div",{class:"recent-content-label"}),this.elements.label.addEventListener("click",(function(){c.onSearch({adv_search:!1,recent_filter:"*",refresh:!0,search_criteria:"#myRecentContent",search_mode:"index",tag_filter:""})})),this.elements.icon=a.create("div",{class:"recent-content-icon fonticon fonticon fonticon-clock tn-clock"}),this.elements.icon.inject(this.elements.label),this.elements.encart=a.create("div",{class:"recent-content-encart"}),this.elements.recentp=a.create("p",{text:"My Recent Content"}),this.elements.recentchev=a.create("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-chevron-right recent-content-chevron"}),this.elements.recentp.inject(this.elements.encart),this.elements.recentchev.inject(this.elements.encart),this.elements.encart.inject(this.elements.label),this.elements.label.inject(l),!1===o){var d=6;e.is(t)&&!0===t&&(d=4),this.elements.sortcontent=a.create("div",{class:"onesearch_sortcontent","data-rec-id":"onesearch_sortcontent",styles:{order:d}}),this.elements.sortcontent.inject(l),this.sortPanelView=new k({container:this.elements.sortcontent,collection:this.getCollection(),widgetId:this.getOption("widget_id"),messagingChannel:this.getMessagingChannel()})}if(!0!==r){var u=!0;!0===i&&(u=!1),e.is(t)&&(u=!0,!0===t&&(u=!1)),!0!==u||!1!==_.isFUN109031Active()&&!this._isInAppsSearch()||this._injectRecentStuff(l)}this._setErrorManager(l);let h=c.getOption("search_options");if(this._forceOnSearch&&e.is(h)){var g=this.getOption("in_apps_search");e.is(g)&&e.is(g.displayValue)&&(h.search_criteria_to_display=g.displayValue),this._forceOnSearch=!1,this.onSearch(h)}l.removeClassName("search_compact_mode");var f="";if("ipad"===_.getDeviceCategory()&&(f="ipad",t=!1),e.is(t)&&!1===t){c.elements.onesearchactions=a.create("div",{class:"onesearch_action"}),c.elements.onesearchactions.inject(l),a.create("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-chevron-down ",styles:{fontSize:"22px","align-self":"center","margin-left":"-5px"}}).inject(c.elements.onesearchactions);var m=new R({position:"bottom",target:c.elements.onesearchactions,body:D.get("OneSeachActions")});if(c._oneSearchActions=new W({container:c.elements.onesearchactions,collection:c.getCollection(),searchActions:c.skeleton.getSearchActions(),messagingChannel:c.getMessagingChannel(),mode:f}),c._oneSearchActions.tooltip=m,l.addClassName("search_compact_mode"),c._detailsviewSelected=a.create("div",{class:"container-selectCount",styles:{order:0,display:"none"}}),c._detailsviewSelected.inject(l),a.create("span",{class:"set-detail-view-select",id:"search-multisel-count"}).inject(c._detailsviewSelected),a.create("span",{class:"set-detail-view-of"}).inject(c._detailsviewSelected).setText(D.get("setdetailviewof")),p.getOption("NLQMode")){a.create("div",{class:"container-nlqString",styles:{order:2}}).inject(l)}}_.isFUN109031Active()&&!this._isInAppsSearch()&&(this.elements.resizerContent=a.create("div",{class:"onesearch_resizer","data-rec-id":"onesearch_resizer"}),this.elements.resizerContent.tooltip=new R({position:"bottom",target:this.elements.resizerContent,className:"resizeTooltip",body:D.get("relation.maxminTooltip")}),this.resizerContentSpan=a.create("span",{class:"wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-width-"+(!0===F.getItem("search_resizeFullMode")?"small":"full"),"data-rec-id":"SNResultMgt_onesearch_resizer",id:"onesearch_resizer_span",events:{click:function(){c._toggle6WResizeFullMode()}}}).inject(this.elements.resizerContent),this.elements.resizerContent.inject(l),this.elements.switcher6w=a.create("div",{class:"onesearch_resizer_6w","data-rec-id":"onesearch_resizer_6w"}),this.switch6WView=new P({container:this.elements.switcher6w,collection:this.getCollection(),widgetId:this.getOption("widget_id")}),this.elements.switcher6w.inject(l)),this._setOneSearchLimitMessage(l,this.getCollection())},_setSearchContentSetHeaderForStandardCase:function(){let t=this._contentSetHeader,i=p.getOption("neverCheckbox");var n=this,s=this.getSNSkeleton();if(UWA.Element.addEvent.call(this._contentSetHeader,"contextmenu",(function(e){if("undefined"!=typeof dscef){0===dscef.getEnv("CATCEF_DEVTOOLS").length&&e.preventDefault()}})),(!1===_.isFUN109031Active()||this._isInAppsSearch())&&this._injectRecentStuff(t),this._setErrorManager(t),!e.is(i)||!0!==i){this.onesearch_selectionNumberDiv=a.create("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-select-on","data-rec-id":"SNResultMgt_wux-ui-3ds_wux-ui-3ds-1x_wux-ui-3ds-select-on",styles:{fontSize:"22px",color:"#b4b6ba",marginRight:"0.1em",lineHeight:"40px"},events:{touchstart:function(){this.isTouchable=!0},click:function(){(document.querySelector("html .touch")||this.isTouchable)&&(n._isMultiSelModeOnTouch=!n._isMultiSelModeOnTouch,n._isMultiSelModeOnTouch?n._searchcom_socket.dispatchEvent("toggleMultiSelMode",!0):n._searchcom_socket.dispatchEvent("toggleMultiSelMode",!1))}}}).inject(t.getElement(".set-multiselHeader")),this.onesearch_selectionNumber=a.create("span",{id:"search-multisel-count","data-rec-id":"search-multisel-count",styles:{fontSize:"15px",padding:"0 5px",color:"currentColor",display:"none"}}).inject(this.onesearch_selectionNumberDiv);let i=s.getOption("in_apps_search"),o=i&&i.UXOptions&&!i.UXOptions.localActions;this.onesearch_globalDropdownIcon=a.create("span",{class:"fonticon fonticon-2x fonticon-down-open","data-rec-id":"SNResultMgt_fonticon_fonticon-2x_fonticon-down-open",id:"search-multisel-dropdown",styles:{color:"#b4b6ba",display:o||"oneToOne"===s._selectionMode_techno?"none":"inline",margin:"0",cursor:"pointer"},events:{click:function(){e.is(s)&&s.launchGlobalDropdown()}}}).inject(t.getElement(".set-multiselHeader"))}this.elements.sortcontent=a.create("div",{class:"onesearch_sortcontent","data-rec-id":"onesearch_sortcontent"}),this.elements.sortcontent.inject(t),this.sortPanelView=new k({container:this.elements.sortcontent,collection:this.getCollection(),widgetId:this.getOption("widget_id"),messagingChannel:this.getMessagingChannel()});let o=this.getOption("search_options");this._forceOnSearch&&e.is(o)&&(this._forceOnSearch=!1,this.onSearch(o)),_.isFUN109031Active()&&!this._isInAppsSearch()&&(this.elements.resizerContent=a.create("div",{class:"onesearch_resizer","data-rec-id":"onesearch_resizer"}),this.elements.resizerContent.tooltip=new R({position:"bottom",target:this.elements.resizerContent,className:"resizeTooltip",body:D.get("relation.maxminTooltip")}),this.resizerContentSpan=a.create("span",{class:"wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-width-"+(!0===F.getItem("search_resizeFullMode")?"small":"full"),"data-rec-id":"SNResultMgt_onesearch_resizer",id:"onesearch_resizer_span",events:{click:function(){n._toggle6WResizeFullMode()}}}).inject(this.elements.resizerContent),this.elements.resizerContent.inject(t),this.elements.switcher6w=a.create("div",{class:"onesearch_resizer_6w","data-rec-id":"onesearch_resizer_6w"}),this.switch6WView=new P({container:this.elements.switcher6w,collection:this.getCollection(),widgetId:this.getOption("widget_id"),messagingChannel:this.getMessagingChannel()}),this.elements.switcher6w.inject(t)),this._setOneSearchLimitMessage(t,this.getCollection())},_setOneSearchLimitMessage:function(e,t){var i=this;if(p.getOption("FUN141960")){var n=e.getParent(),s=this.elements;if(s.searchResultWarningMessage&&0!==s.searchResultWarningMessage.children.length)return;s.searchResultWarningMessage=a.create("div",{class:"oneSearch-warning-message search-warning-message"}).inject(n).hide(),_.buildNotification(s.searchResultWarningMessage,(function(){if(t._isPinnedWidget()&&!p.getOption("search_web_in_win")){var e=_.getSearchWidget(i.getOption("widget_id"));return L.dispatch("onSearchLimitExceed",""),void e.dispatchEvent("onLoadSearchInWidget",{value:i._search_criteria})}i.launchAdvancedSearch({value:_.SearchTypeEnum.ADVANCED_SEARCH,adv_search:!0,source:[]})}),t)}},_toggle6WResizeFullMode:function(){let t;!0===F.getItem("search_resizeFullMode")?(t=!1,e.is(this.elements)&&e.is(this.elements.container)&&this.elements.container.removeClassName("withoutMargin"),this.resizerContentSpan.className="wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-width-full",p.options.search_settings.search_resizeFullMode=!1,F.setItem("search_resizeFullMode",!1)):(t=!0,e.is(this.elements)&&e.is(this.elements.container)&&this.elements.container.addClassName("withoutMargin"),this.resizerContentSpan.className="wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-width-small",p.options.search_settings.search_resizeFullMode=!0,F.setItem("search_resizeFullMode",!0)),this.dispatchEvent("onToggle6WResizeFullMode",t),F.commit(),d.publish({channel:"Qchannel-searchgriview-all",topic:"Qtopic-searchgriview-refreshMargins",data:{}})},_setErrorManager:function(t){var i=this;let n=this.getSNSkeleton();L.add("errorManager:tooltip",(t=>{if(e.is(t)&&t.length>0){var n="",s="";if(p.getOption("debug"))for(var o=0;o<t.length;o++)e.is(t[o].name)&&e.is(t[o].error)&&e.is(t[o].error.errorCode)&&(o>0&&(n+="<br>"),""===(s=D.get(t[o].error.errorCode))&&(s=t[o].error.errorCode),n+="<b>"+t[o].name+"</b>: "+s);else n=D.get("errorManager_basicMessage");i._setErrorManagerSourceErrorsTooltip(n)}else i._manageErrorManagerDisplay()})),this.elements.errorManager=a.create("div",{class:"onesearch_errorManager","data-rec-id":"onesearch_errorManager"}).inject(t),this.onesearch_errorManagerIcon=a.create("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-help","data-rec-id":"SNResultMgt_wux-ui-3ds_wux-ui-3ds-1x_wux-ui-3ds-help",styles:{fontSize:"18px","max-width":"500px"}}).inject(this.elements.errorManager),!0===this.getOption("swymContext")&&this.onesearch_errorManagerIcon.addClassName("searchErrorManagerSwym");let s=F.getItem("errorManager:limit"),o="";e.is(s)?(o=D.replace(D.get("maximum_results"),{count:s}),this.onesearch_errorManagerIcon.show()):_.isFUN109031Active()?this.onesearch_errorManagerIcon.show():this.onesearch_errorManagerIcon.hide(),this.onesearch_errorManagerIcon.tooltip=n.errorManagerTooltip=new R({position:"bottom",target:this.onesearch_errorManagerIcon,className:"maximumResultsTooltip search-ui-tooltip",body:'<div class="Search-errorManager-freeText"></div><div class="Search-errorManager-findLink">'+(void 0!==G.getServiceErrorFromSource("3dspace")?"<div></div>"+D.get("userLogoutLoginError")+"<div></div>":"<div></div>")+(_.isFUN109031Active()&&!_.isODTMode()?D.get("lastIndexedTimeFindLink")+"<div></div>":"")+'</div><div class="Search-errorManager-errors">'+(""!==o?'<div class="maximumResultsTooltipContent">'+o+"</div>":"")+"</div>"})},refreshSearch:function(){var t=e.clone(this.options.search_options);if(F.getItem("search_keepColumnSorting")&&e.is(F.getItem("searchSort"))){let e=F.getItem("searchSort");t.order_field=e.order_field,t.order_by=e.order_by}else this.sortPanelView&&this.sortPanelView.options&&this.sortPanelView.options.defaultSort?(t.order_field=this.sortPanelView.options.defaultSort.dataIndex,this.sortPanelView.options.defaultSort.order&&(t.order_by=this.sortPanelView.options.defaultSort.order)):(t.order_field="relevance",t.order_by="desc");e.is(t)&&(this._historySearch&&(e.is(i.elements.containerProduct)&&i.elements.containerProduct.empty(),e.is(i.elements.containerRelational)&&i.elements.containerRelational.empty(),this._historySearch.cleanAll()),t.refresh=!0,this.onSearch(t));var i=this;i.HideInformationLightboxPanel()},hideAdvancedSearch:function(){this.skeleton&&this.skeleton.getAdvSearchMgr().hideAdvancedSearchTab()},showAdvancedSearch:function(t){if(e.is(t)&&e.is(t.widgetId)){var i=this.getOption("widget_id");if((!e.is(i)||i===t.widgetId)&&(this._adv_search_field=null,this.skeleton)){var n=this.skeleton.getAdvSearchMgr();if(!e.is(n)||!e.is(n.getAndDisplayAdvancedSearch,"function"))throw new Error("Error in showAdvancedSearch !");var s=!0,o=!0,a=null,r=this.getCollection().getTaggerProxy(),l=r.getCurrentFilter(),c=this.getOption("in_apps_search");if(e.is(l)&&(a=l.allfilters),e.is(r)&&e.is(l)&&e.is(a)&&0!==Object.keys(a).length&&(e.is(t)&&e.is(t.adv_search_field)&&e.is(t.adv_search_field,"string")||1===Object.keys(a).length&&(a.hasOwnProperty("sixw:ds6w:where/ds6w:source/ds6w:dataSource")||a.hasOwnProperty("ds6w:where/ds6w:source/ds6w:dataSource"))?(n.clearFilters(),n.getAndDisplayAdvancedSearch(!0)):e.is(c)&&!n._fieldsToSet||(o=!1)),this._originalSearchCriteria===_.SearchTypeEnum.ADVANCED_SEARCH&&(o||t.sidePanelStatus===_.SidePanelStatus.SIDE_PANEL_CLOSED||(s=!1)),o||t.sidePanelStatus===_.SidePanelStatus.SIDE_PANEL_CLOSED?(n._adv_search_field=null,e.is(t)&&e.is(t.adv_search_field)&&e.is(t.adv_search_field,"string")&&(this._adv_search_field=t.adv_search_field,n._adv_search_field=t.adv_search_field),n.getAndDisplayAdvancedSearch(!0,t)):e.is(c)&&e.is(c.title)&&!n._fieldsToSet?n.getAndDisplayAdvancedSearch(!0,t):n.getAndDisplayAdvancedSearchWithProxyFilterSettings(),s){if(!c){e.is(r)&&e.is(r.clearLocalFilter,"function")&&this._taggerProxy.clearLocalFilter();var d=this.getSNSkeleton();d&&(d.getCollection()._resetState(),d.getCollection().reset(),d.getCollection().initTreeDocument(),d._updateWidgetTitleWithNbResult())}var u={search_criteria:"#advancedSearch",originalSearchCriteria:"#advancedSearch",adv_search:!0,recent_filter:"*",source:[],search_mode:"index",tag_filter:"",refresh:!1};!0===p.getOption("search_web_in_win")&&(u.dontcallAgain=!0),this.onSearch(u)}}}},manageInformationPanel:function(t){var i=this,n=null;if(n=e.is(this.getOption("getContainer"),"function")?this.getOption("getContainer").call():e.extendElement(document.body),e.is(n)){var s=null;if(F.getItem("nav_history")?n.parentElement&&(s=n.parentElement.getElement(".searchHeaderCmd_content")):s=n.getElement(".search-content-set-container"),null!==s){var o=i.getSNSkeleton();if(e.is(o)){var a=t,r=_.getSearchWidget(i.getOption("widget_id"));e.is(r)&&!e.is(a)&&(a=r.getValue("informationPanelState"+i.getTabID())),!0===a?(s.addClassName("informationPanel_Icon"),e.is(r)&&r.setValue("informationPanelState"+i.getTabID(),!0)):(s.removeClassName("informationPanel_Icon"),e.is(r)&&r.setValue("informationPanelState"+i.getTabID(),!1)),o.setInformationStatus(a,a)}}}},managepreviewPanel:function(t){var i=null;if(i=e.is(this.getOption("getContainer"),"function")?this.getOption("getContainer").call():e.extendElement(document.body),e.is(i)){var n=null;if(F.getItem("nav_history")?i.parentElement&&(n=i.parentElement.getElement(".searchHeaderCmd_content")):n=i.getElement(".search-content-set-container"),null!==n){var s=this.getSNSkeleton();e.is(s)&&(t!==s.getPreviewStatus()&&(s.setPreference("previewDefautActivateState",t),F.commit()),s.setPreviewStatus(t)),!0===t?n.addClassName("previewPanel_Icon"):n.removeClassName("previewPanel_Icon")}}},managehistoryPanel:function(t){var i,n=this,s=null,o=_.getSearchWidget(n.getOption("widget_id"));if(e.is(o)){if(s=e.extendElement(o.elements.body).getElement(".searchHeaderCmd_content"),i=e.extendElement(o.elements.body).getElement(".history-div"),null===s){var a=null;a=e.is(this.getOption("getContainer"),"function")?this.getOption("getContainer").call():a=e.extendElement(document.body),e.is(a)&&a.parentElement&&(s=a.parentElement.getElement(".searchHeaderCmd_content"))}var r;r=o.getValue("navigationHistoryState"+n.getTabID()),null!==s&&(!0===t?!1===r||void 0===r?(s.addClassName("navigationHistory_Icon"),!0===t&&o.setValue("navigationHistoryState"+n.getTabID(),!0),e.is(i)&&i.setStyle("display","inline-block"),void 0===r&&n._historySearch&&n._historySearch.render(i)):(s.removeClassName("navigationHistory_Icon"),!0===t&&o.setValue("navigationHistoryState"+n.getTabID(),!1),e.is(i)&&i.setStyle("display","none")):!0===r?(n._historySearch&&n._historySearch.render(i),s.addClassName("navigationHistory_Icon"),e.is(i)&&i.setStyle("display","inline-block")):(s.removeClassName("navigationHistory_Icon"),e.is(i)&&i.setStyle("display","none")))}},HideInformationLightboxPanel:function(){var t=this.getSNSkeleton();if(e.is(t)&&e.is(t.getPreviewPanel,"function")){var i=t.getPreviewPanel();e.is(i)&&!0===i.getVisibleFlag()&&(e.is(i.hideAndclean,"function")&&i.hideAndclean(),i.setActiveObject(null)),e.is(t._lightBoxView)&&!0===t._lightBoxView._LightBoxPanel.visibleFlag&&this.managepreviewPanel(t.ActivateDeactivatePreviewPanel())}},getSearchWidget:function(){return _.getSearchWidget(this.getOption("widget_id"))},onhistorySearchSelect:function(t){var i=this;if(e.is(t)&&e.is(t.SNtype)&&e.is(i._historySearch)){"Children"===t.SNtype&&(i.getSNSkeleton()._searchActions.dispatchEvent("onDisplayRelations",t),_.setContentVisibility(t));var n=function(){_.setContentVisibility("Search");var t=i.getSNSkeleton();t&&(t.getCollection()._resetState(),t.getCollection().reset(),t.getCollection().initTreeDocument(),t._updateWidgetTitleWithNbResult()),e.is(i._taggerProxy.clearLocalFilter,"function")&&i._taggerProxy.clearLocalFilter(),e.is(i._taggerProxy.clearLocalGrouping,"function")&&i._taggerProxy.clearLocalGrouping(),i._taggerProxy.unsetTags()};"Search"===t.SNtype&&e.is(t.searchParam)?(_.setContentVisibility(t),t.searchParam.fromSearchHistory=!0,i.onSearch(t.searchParam)):"Explore"===t.SNtype||"Relational"===t.SNtype?(_.setContentVisibility(t),i._historySearch.ShowContainers(t)):"Select"===t.SNtype?(n(),b.getRelations({model:t.model,onComplete:function(e){e.contextid=t.contextid,e.widgetAppId=t.widgetAppId,i._historySearch.stopCreation(!1),i._historySearch.addRelationsModel(e)},onFailure:function(){i._historySearch.stopCreation(!1)}})):""===t.SNtype&&n()}},onAddSearchBox:function(t){if(e.is(t)){var i=this;if(e.is(i.options)&&e.is(i.options.search_options)&&e.is(i._historySearch)){var n=i.options.search_options,s=!0,o=!1,a=!1;e.is(n.fromSearchHistory)&&!0===n.fromSearchHistory&&(s=!1,i.options.search_options.fromSearchHistory=!1,e.is(n.refineSearch)&&!0===n.refineSearch&&(o=!0,s=!0,i.options.search_options.refineSearch=!1));var r=i._taggerProxy.getCurrentFilter();if(e.is(r,"object")&&e.is(r.allfilters,"object")&&0<Object.keys(r.allfilters).length&&(a=!0),!0===s){var l,c=_.getSearchWidget(i.getOption("widget_id"));if(e.is(c)&&(l=c.context,F.getItem("integratedSearch"))){var d=c.getValue("launch_mode");e.is(c.data)&&!e.is(c.data.pinToDashboard)&&d!==_.widgetLaunchMode.PINNED&&(l="RightPanelContext"),d!==_.widgetLaunchMode.COMPASS_TRANSIENT&&d!==_.widgetLaunchMode.COMPASS_PINNED&&d!==_.widgetLaunchMode.INCONTEXT_TRANSIENT||(l="")}var u=n.search_criteria_to_display;void 0===u&&(u="#myContent"===n.search_criteria?D.get("myContentTitle"):"#myRecentContent"===n.search_criteria?D.get("searchInMyRecentContent"):"#advancedSearch"===n.originalSearchCriteria?D.get("adv_search_launch"):"#favoriteSearches"===n.search_criteria?D.get("my_fav_searches"):n.search_criteria);var h={description:u+" "+t+" results",searchParam:e.clone(n),widgetAppId:i.getOption("widget_id"),contextid:l,refine:o,count:t,filter:a};i._historySearch.addSearchModel(h)}}}},onExploreAction:function(t){if(e.is(this._historySearch)&&e.is(t)&&e.is(t.model)){var i,n=_.getSearchWidget(this.getOption("widget_id"));e.is(n)&&(i=n.context),{description:t.model._attributes["ds6w:label"],widgetAppId:t.widgetAppId,contextid:i};var s=null;"whereUsed"===t.action_id?s=this._historySearch.addRelationalModel(null):"config_explore"===t.action_id&&(s=this._historySearch.addExploreModel(null)),e.is(s)&&(t.historyNode=s)}},onSelected_obj:function(){if(e.is(this._historySearch)){var t={},i=0,n=null;e.is(arguments)&&1===(i=arguments.length)&&(n=arguments[0]),t.size=i,t.itemModel={},null!==n&&(t.itemModel.label=n.get("ds6w:label"),t.itemModel.id=n.id,t.itemModel.model=n),this._addNavHistorySelectBox(t)}},_addNavHistorySelectBox:function(t){var i=this;if(e.is(i._historySearch)&&e.is(t)){var n,s=_.getSearchWidget(i.getOption("widget_id"));e.is(s)&&(n=s.context);var o=null,a=0;if(e.is(t.size)&&1===(a=t.size)&&e.is(t.itemModel)&&(o=t.itemModel),null!==o){var r=o.label,l={description:r,contextid:n,id:o.id,model:o.model,widgetAppId:i.getOption("widget_id")};void 0!==i._historySearch.addSearchSelectModel(l)&&(i._historySearch.stopCreation(!0),b.getRelations({model:o.model,onComplete:function(e){e.contextid=n,e.widgetAppId=i.getOption("widget_id"),e.model.fromApp=!0,e.model.displayName=r,i._historySearch.stopCreation(!1),i._historySearch.addRelationsModel(e)},onFailure:function(){i._historySearch.stopCreation(!1)}}))}else a>1?i._historySearch.addSearchSelectModel(a):i._historySearch.removeLastSelectNode()}},onPinToDashboardAction:function(){var t=this,i=this.getSNSkeleton();if(!e.is(i))return;var n=_.getSearchWidget(this.getOption("widget_id"));if(!e.is(n))return;let s=q.getActiveCustomization();n.setValue("resultview_custo",s?{customizationId:s.customizationId,views:s.views,customizedViews:s.customizedViews[0],isDynamicCustomedByUser:!1}:null),_.pinToDashboard({widgetIdOrUrl:n.uwaUrl,widgetAppId:_.getSearchAppId(),widgetTitle:i.getTitle(),widgetId:this.getOption("widget_id"),widgetData:n.data,success:function(){t._searchcom_socket&&t._searchcom_socket.dispatchEvent("hideSidePanel")}})},setActiveTenant:function(t){if(e.is(this._resources)&&e.is(this._resources.setActiveTenant,"function"))try{this._resources.setActiveTenant(t)}catch(e){A.log("SearchRessources.setActiveTenant throw !")}},clearfilterbyclosesidepanel:function(t){if(t&&!0===t.bOnlyCurrentTab&&this.getTabID()!==this.getOption("getParent").call().getParent()._valueOfCurrentTab)return;let i=this.getSNSkeleton();if(i){let t=i.getCurrentView();t&&e.is(t.CloseSidePanel,"function")&&t.CloseSidePanel()}e.is(this._taggerProxy)&&e.is(this._taggerProxy.clearLocalFilter,"function")&&this._taggerProxy.clearLocalFilter(),e.is(this._taggerProxy)&&e.is(this._taggerProxy.clearLocalGrouping,"function")&&this._taggerProxy.clearLocalGrouping(),this.embeddedTaggerTags=null,this.getRefineHelpers().hideGlobeView(),this.getRefineHelpers().hideTagcloudView(),this.getRefineHelpers().hideTimelineView(),this.getRefineHelpers().hidePhonebookView(),this.getSNSkeleton().switchOnView(F.getItem(this._isInAppsSearch()?"LastInAppsSearchViewMode":"LastSearchViewMode"))},manageActionIconOnSidePanel:function(t){var i=this;if(e.is(i.elements)&&e.is(i.elements.container)){var n=!1;if(e.is(i.skeleton)&&(n="true"!==i.skeleton.getOption("transient_context")&&!0!==i.skeleton.getOption("transient_context")),!0!==n){var s=_.getSearchWidget(i.getOption("widget_id"));if(e.is(s)&&e.is(s.getView,"function")&&(!e.is(s.getView().type)||"sidepanel"===s.getView().type)&&e.is(t)&&e.is(t.position)){var o=t.position;"fitted"===o||"maximized"===o?i.updateDimension(-1):i.updateDimension();let n=i.getSNSkeleton();if(n){let t=n.getCurrentView();t&&e.is(t.manageDisplayChannelView,"function")&&t.manageDisplayChannelView(o)}}}}},navhistorycontextifcreateaNewTab:function(){var t=!1;return e.is(this._historySearch)&&(t=this._historySearch.navhistorycontextifcreateaNewTab()),t},getOneSearchPreviewAction:function(){var t=null;return e.is(this.elements)&&e.is(this.elements.onesearchactionspreview)&&(t=this.elements.onesearchactionspreview),t},_taggerClearLocalFilter:function(t){return!!e.is(this._taggerProxy)&&(e.is(this._taggerProxy.clearLocalFilter,"function")&&this._taggerProxy.clearLocalFilter(),e.is(this._taggerProxy.clearLocalGrouping,"function")&&this._taggerProxy.clearLocalGrouping(),!0===t&&this._taggerProxy.unsetTags(),!0)},dispatchOnTitleUpdate:function(t){if(e.is(this.getOption("getTabID"),"function"))this.dispatchEvent("onTitleUpdate",t);else{let i=e.extendElement(document.body).getElement("span#divSearchHeadDescription");e.is(i)&&i.setText(D.get("AppName")+" - "+t.panelTitle)}},maskContainer:function(){e.is(this.elements.container)&&z.showOverlayLoader(void 0,this.elements.container)},unmaskContainer:function(){this.elements.container&&z.hideOverlayLoader(this.elements.container)},backToMultiView:function(t){let i,n=this,s=n.getSNSkeleton();if(!s||t===s.getCurrentView().id){if(s.updateCounterView(s.getCurrentView()&&s.getCurrentView()._totalCount),"where"===t&&e.is(n.getRefineHelpers().globeViewContainerContent))i=n.oRefineHelpers.getRefineHelpers().globeViewContainerContent.back();else{let t=s.getCurrentView();t&&e.is(t.clickOnBack,"function")&&t.clickOnBack()}return i}},clickOnTitleMultiView:function(t,i){let n=this;"where"===t&&e.is(n.oRefineHelpers.getRefineHelpers().globeViewContainerContent)&&n.getRefineHelpers().globeViewContainerContent.clickOnTitleMultiView(i)},getSelectedItems:function(){return this._selected_objects},getSelectedItemsCount:function(){return this.getSelectedItems().length},_listenBroadcast:function(t){let i=this;!0!==_.is6WInWebInWinActive()||i._isInAppsSearch()||(e.is(this._BroadcastchannelManager)&&this._BroadcastchannelManager.destroy(),e.is(this._BroadcastchannelManager)&&delete this._BroadcastchannelManager,this._BroadcastchannelManager=null,require(["DS/SNResultUX/utils/BroadcastchannelManager"],(function(e){let n={embeddedTaggerContent:i.embeddedTaggerContent,embeddedTaggerContainer:i.embeddedTaggerContainer,resultMgt:i,broadcastId:t};i._BroadcastchannelManager=new e,i._BroadcastchannelManager.setup(n),i._BroadcastchannelManager.listenBroadcast(n)}))),!0===_.isSearchDropDownActive()&&(e.is(this._BroadcastsearchDropDownManager)&&this._BroadcastsearchDropDownManager.destroy(),e.is(this._BroadcastsearchDropDownManager)&&delete this._BroadcastsearchDropDownManager,this._BroadcastsearchDropDownManager=null,require(["DS/SNResultUX/utils/BroadcastsearchDropDownManager"],(function(e){let t={resultMgt:i};i._BroadcastsearchDropDownManager=new e,i._BroadcastsearchDropDownManager.setup(t),i._BroadcastsearchDropDownManager.listenBroadcast(t)})))},_manageEmbeddedTaggerView:function(t){if(e.is(this.embeddedTaggerContainer))if(t)this.embeddedTaggerContainer.setStyle("display","none");else{this.embeddedTaggerContainer.setStyle("display","block");let t=e.extendElement(this.embeddedTaggerContainer.querySelector(".embedded-tagger-view"));e.is(t)&&t.setStyle("display","block")}},_setTaggerContextOn3DDActiveTab:function(){require(["DS/Dashboard/PublicAPI","DS/TagNavigator/TagNavigator"],(function(e,t){let i=e.getActiveTab();i&&i.id&&t.get6WTagger(i.id).setAsCurrent()}))}})})),define("DS/SNResultUX/SearchTab",["UWA/Core","UWA/Controls/Abstract","DS/SNInfraUX/SearchDebug","DS/Controls/TooltipModel","DS/SNResultUX/SNResultMgt","DS/SNResultUX/utils/ExternalComponentHelpers"],(function(e,t,i,n,s,o){"use strict";return t.extend(i,{uwaClassName:"DS/SNResultUX/SearchTab",name:"onesearch_results_tab",_snResultMgt:null,_onActivateEvents:null,init:function(e){this._parent(e),this._onActivateEvents={}},destroy:function(){this._snResultMgt=null,this._onActivateEvents=null,this._parent(),this.options=null},render:function(t){var i=this;if(e.is(t,"object")){var n=null;e.is(t.events)&&e.is(t.events.onReady,"function")&&(n=e.clone(t.events.onReady));let o={};for(let i in t.events)o[i]=e.clone(t.events[i]);t.getParent=function(){return i},t.getTabID=function(){return i.getTabID()},t.isTabBarVisible=function(){return i.getOption("wuxTabBar").visibleFlag},t.getTabOption=function(e){return i.getOption(e)},t.setTabOption=function(e,t){i.setOption(e,t)},t.getContainer=function(){return i.getOption("renderTo")};for(let n in t.events)"onReady"!==n&&(o[n]=e.clone(t.events[n]),t.events[n]=function(){i._snResultMgt=this,e.is(o[n])&&o[n].call(this)});t.events.onReady=function(){i._snResultMgt=this,i.onActivate(),i.setIcon(i._snResultMgt.getTabIcon()),e.is(n)&&n.call(this),i.dispatchEvent("onTabReady")},t.events.onTitleUpdate=function(e){i.setTitle(e.tab_title),i.setTooltip(e.tab_tooltip),i.dispatchEvent("updateWidgetTitle",e.panelTitle),i.setOption("panelTitle",e.panelTitle)},this.elements.container=new s(t)}return this},setTitle:function(e){var t=this.getOption("wuxTab");this.getOption("wuxTabBar").updateTab(t.value,{label:e})},getTabID:function(){var t=this.getOption("wuxTab");if(e.is(t))return t.value},setTooltip:function(e){var t=this.getOption("wuxTab"),i=this.getOption("wuxTabBar");t.tooltipInfos?t.tooltipInfos.shortHelp=e:t.tooltipInfos=new n({shortHelp:"",mouseRelativePosition:!0,isEmpty:function(){return this.shortHelp.length>0},allowUnsafeHTMLTitle:i.allowUnsafeHTMLOnTabButton,allowUnsafeHTMLShortHelp:i.allowUnsafeHTMLOnTabButton,allowUnsafeHTMLLongHelp:i.allowUnsafeHTMLOnTabButton})},setIcon:function(e){this.getOption("wuxTabBar").updateTab(this.getOption("wuxTab").value,{icon:e})},setActiveTenant:function(e){this._snResultMgt&&this._snResultMgt.setActiveTenant(e)},getActiveTenant:function(){if(this._snResultMgt)return this._snResultMgt.getActiveTenant()},getTabType:function(){},getTabView:function(){return this._snResultMgt},getTaggerProxy:function(){if(e.is(this._snResultMgt))return this._snResultMgt._taggerProxy},getAdvSearchMgr:function(){if(e.is(this._snResultMgt)&&e.is(this._snResultMgt.getSNSkeleton,"function")&&e.is(this._snResultMgt.getSNSkeleton().getAdvSearchMgr,"function"))return this._snResultMgt.getSNSkeleton().getAdvSearchMgr()},showAdvancedSearch:function(t){if(e.is(this._snResultMgt))return this._snResultMgt.showAdvancedSearch(t)},hideAdvancedSearch:function(){if(e.is(this._snResultMgt))return this._snResultMgt.hideAdvancedSearch()},onActivate:function(){if(this._snResultMgt){for(var t in this.getOption("renderTo").setContent(this._snResultMgt),this._snResultMgt.OnTabActivated(),this._onActivateEvents)switch(t){case"unsetShading":this._snResultMgt.setShadings([{color:"initial",criteria:function(){return!0}}]);break;case"refresh":this.onRefresh()}delete this._onActivateEvents,this._onActivateEvents={}}var i=this.getOption("panelTitle");e.is(i,"string")||(i=this.getOption("wuxTab").label),this.dispatchEvent("updateWidgetTitle",i),this.dispatchEvent("onTabActivated")},onDeactivate:function(){this._snResultMgt&&this._snResultMgt.OnTabDeactivated()},onRemoval:function(){this._snResultMgt&&this._snResultMgt.OnTabRemoved()},updateOnActivate:function(t){if(e.is(t,"object"))for(var i in t)this._onActivateEvents[i]=t[i]},setSensitivity:function(e){this.getOption("wuxTab").disabled=!e},onSearch:function(t){e.is(this._snResultMgt)&&(this._snResultMgt.onSearch(t),this.setIcon(this._snResultMgt.getTabIcon()))},onRefresh:function(){e.is(this._snResultMgt)&&this._snResultMgt.refreshSearch()},onKeyboardEvent:function(t){e.is(this._snResultMgt)&&this._snResultMgt.onKeyboardEvent(t)},navhistorycontextifcreateaNewTab:function(){var t=!1;return e.is(this._snResultMgt)&&(t=this._snResultMgt.navhistorycontextifcreateaNewTab()),t},getParent:function(){return this.getOption("parent")}})})),define("DS/SNResultUX/SNTabbedResultMgt",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","UWA/Class/Collection","UWA/Class/Model","UWA/Element","DS/UIKIT/Tooltip","DS/PubSub/PubSub","DS/MessageBus/MessageBus","DS/SNInfraUX/SearchCom","DS/SNInfraUX/SearchDebug","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","css!DS/SNResultUX/SNResultUX","DS/SNResultUX/SearchTab","DS/SNResultUX/views/utils/SearchHeaderCmd","DS/SNInfraUX/SearchRessources","DS/SNInfraUX/PredicatesNLS","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/Controls/TabBar","DS/SNInfraUX/SearchPreferences","DS/SNResultUX/utils/ExternalComponentHelpers","DS/SNInfraUX/Logger"],(function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_,f,m,S,v,w,b,C,y){"use strict";let D=o.extend({idAttribute:"tabID"});return t.extend(i,n,u,{uwaClassName:"DS/SNResultUX/SNTabbedResultMgt",name:"onesearch_tabbed_results",_tabContainer:null,_disableTabbedUI:!1,_currentTabContent:null,_searchcom_socket:null,_tabs:null,_valueOfCurrentTab:null,_tabIDCounter:null,_first_search_COMPASS_TRANSIENT:null,_messagingChannel:null,_subscriptions:null,_keydownEventHandler:null,_headersSearch:null,_originalEvts:{},init:function(t){this._parent(t),this._tabIDCounter=0,this._first_search_COMPASS_TRANSIENT=!1,this._messagingChannel="3DSearch-TabManager-"+t.widget_id,this._subscriptions={},this._keyboardEventsSubscription=!1;let i=this;this._searchcom_socket=d.createSocket({socket_id:"widget_tabMgt_"+this.getOption("widget_id"),widgetId:this.getOption("widget_id")}),S.setResources({resources:new m(this.getOption("resources"))});let n=this.getOption("launch_mode");if(this._disableTabbedUI=!0!==b.getItem("search_tabbed_ui")||e.is(n,"string")&&(n===g.widgetLaunchMode.COMPASS_PINNED||n===g.widgetLaunchMode.PINNED||n===g.widgetLaunchMode.COMPASS_TRANSIENT||n===g.widgetLaunchMode.INCONTEXT_TRANSIENT),n!==g.widgetLaunchMode.PINNED&&n!==g.widgetLaunchMode.COMPASS_PINNED&&this._subscribeToKeyboardEvents(),!e.is(this.elements.container)){let e=this.getClassNames();e.replace(" ","_"),this.elements.container=a.create("div",{class:this.getClassNames(),"data-rec-id":e,styles:{position:"relative",height:"100%"}}),this.elements.container.addClassName(this.getOption("css_view_class"))}C.initImmersiveFrame(this.elements.container);let o=g.identifyClientInfo();if(h.getOption("ShowSearchTitleHeader")&&"3DSwym"===o.identifier){this._titleBar=a.create("div",{class:"searchHeader"}),this._titleArea=a.create("span",{class:"searchHeader__title"}),this._titleTextArea=a.create("span",{class:"searchHeader__title__text"}),this._titleBar.inject(this.elements.container),this._titleArea.inject(this._titleBar),this._titleTextArea.inject(this._titleArea),l.add("search:titleUpdate",(function(e){i._titleTextArea.setText(e)})),this._closeArea=a.create("span",{class:"close fonticon fonticon-cancel",styles:{right:"0px",position:"absolute"},events:{click:function(){l.dispatch("search:closeRequested")}}});new r({position:"left",target:this._closeArea,body:v.get("closeButton")});this._closeArea.inject(this._titleArea)}if(this._tabContainer=new w({displayStyle:["strip"],centeredFlag:!1,newTabButtonFlag:!0,editableFlag:!1,multiSelFlag:!1,reorderFlag:!1,touchMode:!0,closeButtonFlag:!0,showComboBoxFlag:!0,allowUnsafeHTMLOnTabButton:!1}),this._tabContainer._endEditTab=function(){},this._tabContainer._editTab=function(e){let t=this,i=t.getButtonFromValue(e);t.closeButtonFlag&&i.elements._closeButton&&i.elements._closeButton.hide(),t.modelEvent.publish({event:"editTab",data:{value:e}}),this.fire("edit",{value:e})},this._subscribeToGlobal3DSearchMessageChannel(),this._tabContainer.inject(this.elements.container),this._tabs=new s([],{model:D}),this._currentTabContent=a.create("div",{styles:{position:"relative",height:"100%",width:"100%"}}),this._currentTabContent.inject(this.elements.container),!0===this._disableTabbedUI?this.hideTabBar():this.showTabBar(),!0===b.getItem("nav_history")){let e=this._tabContainer.getContent();if(e){let t=e.getElementsByClassName("wux-controls-tabBar-buttonsContainer");null!==t&&(i._headersSearch=new f,i._headersSearch.render(t[0]),i._headersSearch.addEvent("onInformationPanelAction",(function(){let e=i.getActiveTab();if(e&&null!==e._snResultMgt){let t=!1;t=e._snResultMgt.getSNSkeleton().ActivateDeactivateInformationsPanel(),e._snResultMgt.manageInformationPanel(t)}})),i._headersSearch.addEvent("onHistoryAction",(function(){let e=i.getActiveTab();e&&null!==e._snResultMgt&&e._snResultMgt.managehistoryPanel(!0)})))}}this._registerTabEventHandlers()},_subscribeToGlobal3DSearchMessageChannel:function(){let t=!1;t="true"!==this.getOption("transient_context")&&!0!==this.getOption("transient_context");let i=e.is(this.getOption("swymContext"))&&this.getOption("swymContext"),n=this;this.isTabBarVisible()&&(this._subscriptions.addTab=c.subscribe({channel:this.getMessagingChannel(),topic:"addTab",callback:this.addTab.bind(this)})),this._subscriptions.activateInContextSearch=c.subscribe({channel:this.getMessagingChannel(),topic:"activateInContextSearch",callback:this._onActivateInContextSearch.bind(this)}),this._subscriptions.deactivateInContextSearch=c.subscribe({channel:this.getMessagingChannel(),topic:"deactivateInContextSearch",callback:this._onDeactivateInContextSearch.bind(this)}),t&&!i||(this._subscriptions["GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID:activateInContextSearch"]=c.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"activateInContextSearch",callback:this._onActivateInContextSearch.bind(this)}),this._subscriptions["GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID:deactivateInContextSearch"]=c.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"deactivateInContextSearch",callback:this._onDeactivateInContextSearch.bind(this)}),this._subscriptions["GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID:sidePanelClosed"]=c.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"sidePanelClosed",callback:this._onDeactivateInContextSearch.bind(this)})),this._subscriptions.manualSwitchToView=c.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"manualSwitchToView",callback:function(e){n.getActiveTab().getTabView().getSNSkeleton().switchOnView(e.view)}})},destroy:function(){let t,i=this._getTabView();e.is(i)&&(t=i.getOption("in_apps_search")),this._searchcom_socket.dispatchEvent("onCloseTransient",{in_apps_search:t});for(let e=0;e<this._tabs.length;e++){this._tabs.at(e).get("tab").destroy()}this._tabs.reset(),this._tab=null;for(let e in this._subscriptions)c.unsubscribe(this._subscriptions[e]);if(this._unsubscribeToKeyboardEvents(),!1===g._isSearchWidgetTransientAvailable(this.getOption("widget_id"))){let e="windowed"===this.getOption("css_view_class");!0===g.isTaggerOpenedByCode()&&!1===e&&this._searchcom_socket.dispatchEvent("closeTagger")}this._searchcom_socket.disconnect(),d.deleteSocket(this._searchcom_socket.id),this._tabContainer.destroy(),this._tabContainer=null,this.options=null,this._parent()},getMessagingChannel:function(){return this._messagingChannel},addTab:function(t){if(e.is(t)&&e.is(t.search_ux_options)&&e.is(t.search_ux_options.events))for(let i in t.search_ux_options.events)this._originalEvts[i]&&(this._originalEvts[i+"BACKUP"]=e.clone(this._originalEvts[i])),this._originalEvts[i]=e.clone(t.search_ux_options.events[i]);let i=this._tabContainer.getTabCount();!0===this._disableTabbedUI&&i>1&&this.removeTab(this.getActiveTab().getTabID());let n=this,s=this._generateTabID();0===i&&(this._valueOfCurrentTab=s);let o=this._tabContainer.add({label:e.is(t.tabTitle,"string")?t.tabTitle:"",isSelected:!0,icon:{iconName:"search",fontIconFamily:1},allowClosableFlag:0!==i,value:s});return this._setMinmumTabWidth(o),this._addCommonOptions(t.search_ux_options),t.search_ux_options.updateContainerClass=(e,t)=>{g.isFUN109031Active()&&(!0===t?this.elements.container.removeClassName(e):this.elements.container.addClassName(e))},t.search_ux_options.getBroadcastWebInWinProxyManager=function(){let t=n.getOption("getBroadcastWebInWinProxyManager");return e.is(t,"function")?t.call():void 0},this._tabs.add(new D({tabID:s,tab:new _({wuxTab:o,wuxTabBar:n._tabContainer,renderTo:this._currentTabContent,parent:this,events:{updateWidgetTitle:function(t){let i=n.getOption("updateTitle");e.is(i,"function")&&i(t)}}}).render(t.search_ux_options)})),l.dispatch("search:addTab"),this.getTabByID(s)},_addCommonOptions:function(t){e.is(t.widget_id)||(t.widget_id=this.getOption("widget_id")),t.css_view_class=e.is(t.css_view_class)?t.css_view_class:this.getOption("css_view_class"),t.pinToDashboard=this.getOption("pinToDashboard"),e.is(t.resources)||(t.resources=this.getOption("resources")),e.is(t.source)||(t.source=this.getOption("source")),e.is(t.itemViewClickHandler)||(t.itemViewClickHandler=this.getOption("itemViewClickHandler")),e.is(t.update_preference)||(t.update_preference=this.getOption("update_preference")),e.is(t.get_preference)||(t.get_preference=this.getOption("get_preference")),e.is(t.tagger_context_id)||(t.tagger_context_id=this.getOption("tagger_context_id")),e.is(t.resetOriginalOptions)||(t.resetOriginalOptions=this.getOption("resetOriginalOptions")),t.addinMode=this.getOption("addinMode"),t.transient_context=this.getOption("transient_context"),t.use_preexisting_call=this.getOption("use_preexisting_call"),t.events=e.clone(this._originalEvts)},onSearch:function(t){if(g.widgetLaunchMode.COMPASS_TRANSIENT===this.getOption("launch_mode")&&!1===this._first_search_COMPASS_TRANSIENT&&(this._first_search_COMPASS_TRANSIENT=!0,!0===b.getItem("search_tabbed_ui")&&(this._disableTabbedUI=!1,this.showTabBar(),e.is(this._subscriptions.addTab)||(this._subscriptions.addTab=c.subscribe({channel:this.getMessagingChannel(),topic:"addTab",callback:this.addTab.bind(this)})))),t.fromTopbar=!0,e.is(t)&&e.is(t.addNewTab)&&!0===t.addNewTab){let e=this;e.addTab({search_ux_options:{events:{onReady:function(){e.getActiveTab().onSearch(t)}}}})}else this.getActiveTab().onSearch(t)},onRefresh:function(){this.getActiveTab().onRefresh()},_onViewChange:function(t){e.is(t.previous)&&e.is(t.previous.type)&&this.elements.container.removeClassName(t.previous.type),this.elements.container.addClassName(t.type),"maximized"===t.type?this._subscribeToKeyboardEvents():this._unsubscribeToKeyboardEvents()},getActiveTab:function(){if(e.is(this._tabContainer))return this.getTabByID(this._valueOfCurrentTab?this._valueOfCurrentTab:"3DSearch-tab-1")},getTabByID:function(t){let i=this._tabs.get(t);if(e.is(i))return i.get("tab")},_generateTabID:function(){return++this._tabIDCounter,"3DSearch-tab-"+this._tabIDCounter},isTabBarVisible:function(){return this._tabContainer.visibleFlag},hideTabBar:function(){this._tabContainer.visibleFlag=!1,this._tabContainer.elements.container.addClassName("hidden"),e.is(this._currentTabContent)&&this._currentTabContent.setStyle("height","100%")},showTabBar:function(){if(!1===this._disableTabbedUI&&(this._tabContainer.visibleFlag=!0,this._tabContainer.elements.container.removeClassName("hidden")),-1!==["iphone","ipad","android"].indexOf(g.getDeviceCategory())){let t=e.extendElement(this._tabContainer.getContent()).getBoundingClientRect(),i=44;e.is(t,"object")&&t.height>15&&(i=t.height),e.is(this._currentTabContent)&&this._currentTabContent.setStyle("height","calc(100% - "+i+"px)")}},removeTab:function(e){this._onRemoveTabHandler({value:e}),this._tabContainer.removeTab(e)},_getTabView:function(t){let i=null;if(i=e.is(t,"string")?this.getTabByID(t):this.getActiveTab(),e.is(i))return i.getTabView()},_getAllTabs:function(){if(e.is(this._tabs))return this._tabs.toArray()},_setMinmumTabWidth:function(t){let i=h.getOption("miminumTabWith");(!e.is(i,"number")||i>300)&&(i=100),t.minWidth=i},_onPreNewTabHandler:function(e){let t=this._tabContainer.getButtonFromValue(e.value);this._setMinmumTabWidth(t);let i=this._generateTabID();t.value=i,t.label=v.get("newTabTitle"),this._tabContainer.newTabButtonFlag=!1},_onNewTabHandler:function(t){let i=this,n=this._tabContainer.getValueByIndex(t.index),s=this._tabContainer.getButtonFromValue(n);this._tabContainer.updateTab(n,{allowClosableFlag:!0});for(let t in this._originalEvts)this._originalEvts[t+"BACKUP"]&&(this._originalEvts[t]=e.clone(this._originalEvts[t+"BACKUP"]),delete this._originalEvts[t+"BACKUP"]);let o={search_ux_options:{search_options:{search_mode:"index",refresh:!1},events:{}}};this._addCommonOptions(o.search_ux_options),o.search_ux_options.getBroadcastWebInWinProxyManager=function(){let t=i.getOption("getBroadcastWebInWinProxyManager");return e.is(t,"function")?t.call():void 0},g.setsearchType(g.SearchTypeEnum.SEARCH),h.options.search_settings.taggerClosed||this._searchcom_socket.dispatchEvent("closeTagger"),this._tabs.add(new D({tabID:n,tab:new _({wuxTab:s,wuxTabBar:i._tabContainer,isNewTab:!0,renderTo:this._currentTabContent,parent:this,events:{updateWidgetTitle:function(t){let n=i.getOption("updateTitle");e.is(n,"function")&&n(t)},onTabReady:function(){i._tabContainer.newTabButtonFlag=!0}}}).render(o.search_ux_options)}))},_onRemoveTabHandler:function(t){let i=this.getTabByID(t.value);e.is(i)&&(i.onRemoval(),i.destroy()),this._tabs.remove(t.value)},_onSelectTabHandler:function(t){let i=this._tabContainer.getValueByIndex(t.index),n=this._valueOfCurrentTab,s=this.getTabByID(i),o=this.getTabByID(n);if(this._valueOfCurrentTab=i,e.is(o)&&e.is(o._snResultMgt,"object")&&e.is(o._snResultMgt.getSNSkeleton,"function")){let t=o._snResultMgt.getSNSkeleton();if(e.is(t)&&e.is(t.getPreviewStatus,"function")&&t.getPreviewStatus()&&e.is(t.getPreviewPanel,"function")){let i=t.getPreviewPanel();e.is(i)&&e.is(i._exitPreview,"function")&&e.is(o._snResultMgt._onExitPreviewModeRequest,"function")&&o._snResultMgt._onExitPreviewModeRequest()}}e.is(o)&&o.onDeactivate(),e.is(s)&&s.onActivate(),1===this._tabContainer.getTabCount()?this._tabContainer.updateTab(i,{allowClosableFlag:!1}):this._tabContainer.updateTab(n,{allowClosableFlag:!0})},_onContextualMenuEventHandler:function(e){let t=this;e.menu.push({type:"PushItem",title:v.get("closeOtherTabs"),action:{callback:function(){t._closeOtherTabs(t._valueOfCurrentTab)}}})},_registerTabEventHandlers:function(){this._tabContainer.onPreNewTab(this._onPreNewTabHandler.bind(this)),this._tabContainer.onNewTab(this._onNewTabHandler.bind(this)),this._tabContainer.onRemoveTabEvent(this._onRemoveTabHandler.bind(this)),this._tabContainer.onSelectTab(this._onSelectTabHandler.bind(this)),this._tabContainer.onContextualMenuEvent(this._onContextualMenuEventHandler.bind(this))},_closeOtherTabs:function(e){let t=[];for(let i=0;i<this._tabs.length;i++){let n=this._tabs.at(i).get("tabID");e!==n&&(t.push(n),this._tabContainer.removeTab(n))}for(let e=0;e<t.length;e++)this._onRemoveTabHandler({value:t[e]});1===this._tabContainer.getTabCount()&&this._tabContainer.updateTab(e,{allowClosableFlag:!1})},setActiveTenant:function(t){let i=this.getOption("resources");if(e.is(i)&&(i.active_tenant=t.value),!1!==t.update_tab){let i=this.getActiveTab();e.is(i)&&i.setActiveTenant(t.value)}},getActiveTaggerProxy:function(){let t=this.getActiveTab();if(e.is(t))return t.getTaggerProxy()},getActiveAdvSearchMgr:function(){let t=this.getActiveTab();if(e.is(t))return t.getAdvSearchMgr()},_isCV5OpenUsage:function(){return"catiav5"===this.getOption("addinMode")&&!0===h.getOption("lockedapp")},_subscribeToKeyboardEvents:function(){if(!e.is(this._keydownEventHandler,"function")){let t=this;this._keydownEventHandler=function(i){let n=t.getActiveTab();e.is(n)&&n.onKeyboardEvent(i)},UWA.Element.addEvent.call(document,"keydown",this._keydownEventHandler)}},_unsubscribeToKeyboardEvents:function(){e.is(this._keydownEventHandler,"function")&&(UWA.Element.removeEvent.call(document,"keydown",this._keydownEventHandler),delete this._keydownEventHandler)},_onActivateInContextSearch:function(t){let i,n=this,s=function(){c.publish({channel:n.getMessagingChannel(),topic:"InContextInit",data:{}}),c.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"InContextInit",data:{}})},o=e.is(this.getOption("addinMode"),"string")&&this.getOption("addinMode").length>0,a=e.is(t)&&"furtive"!==t.mode&&"socket_id_#saved_search_edit#"===t.app_socket_id;return o?s():i=this.addTab({tabTitle:e.is(t)&&e.is(t.title,"string")?t.title:"",search_ux_options:{widget_id:this.getOption("widget_id"),resources:this.getOption("resources"),css_view_class:"maximized",in_apps_search:t,search_widget:this.getOption("search_widget"),events:{onReady:function(){s()}}}}),!a&&this.hideTabBar(),i},_onDeactivateInContextSearch:function(t){let i=this.getActiveTab();if(e.is(i)){let n=i.getTabView();if(e.is(n)&&n.getOption("in_apps_search")){c.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"deactivateIncontextSearchStarted",data:{closeSidePanel:!0===t.bCloseSidePanel||null==t.bCloseSidePanel}});let s=n.getOption("in_apps_search");this._searchcom_socket.dispatchEvent("onInContextSearchDeactivated",{in_apps_search:s});let o=i.getTabID();!0===t.bComeFromSidePanelCloseEvent&&this._closeOtherTabs(o),this.removeTab(o),c.publish({channel:"searchView",topic:"deactivateInContextSearch",data:{in_apps_search:s}});for(let t in this._tabs._models)e.is(this._tabs._models[t]._attributes.tab.elements.container.options.in_apps_search)&&this._tabs._models[t]._attributes.tab.elements.container.options.in_apps_search.app_socket_id===s.app_socket_id&&this.removeTab(this._tabs._models[t].id);!0===b.getItem("search_tabbed_ui")&&(this._disableTabbedUI=!1),this.showTabBar()}c.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"deactivateIncontextSearchEnded"})}h.getOption("isx2a")&&require(["DS/PlatformAPI/PlatformAPI"],(function(e){let t={type:"X2AEvent",category:"3DSearch",event:{name:"InContextSearch",data:{action:"deactivate"}}};y.log("Publishing deactivate event for in-ctx in XApp :-",t),e.publish("webinwin:web:notification",t)}))},navhistorycontextifcreateaNewTab:function(){let t=!1;!1===b.getItem("integratedSearch")&&(t=!1);let i=this.getActiveTab();return e.is(i)&&(t=i.navhistorycontextifcreateaNewTab()),t}})}));