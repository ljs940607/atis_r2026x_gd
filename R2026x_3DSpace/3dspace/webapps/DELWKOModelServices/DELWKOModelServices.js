define("DS/DELWKOModelServices/DELWKOAbstractCollectionUtils",["UWA/Core","UWA/Class","UWA/Class/Promise","DS/DELPPWModelServices_FD02/AbstractCollectionUtils","DS/DELPPWWebServices_FD02/WebserviceUtils","DS/DELPPWLoggerModel_FD02/LoggerUtils"],(function(e,t,n,o,i,r){"use strict";return o.extend({name:"DELWKOAbstractCollectionUtils",_init:function(e){this._parent(e)},init:function(e){e=e||{},this._parent(e),this._init(e)},federatedSearch:function(t,n,o){var r=e.merge(e.clone({}),{label:"federatedSearch"+Date.now(),with_indexing_date:!0,with_synthesis:!0,with_nls:!1,locale:"en",select_predicate:t,refine:{},order_by:"desc",start:0,nresults:200,order_field:"relevance",source:["3dspace"],tenant:window.widget.getValue("x3dPlatformId")?window.widget.getValue("x3dPlatformId"):"OnPremise",login:{"3dspace":{SecurityContext:i.getSecurityContext()}}});e.extend(r,{query:n});var s={url:i.get3DSearchUrl()+"/search",method:"POST",data:JSON.stringify(r),headers:i.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0,serviceName:""}),onComplete:function(t){e.is(o)&&o.onComplete.call(null,t)},onFailure:function(t){e.is(o)&&o.onFailure.call(null,t)}};s.headers.Accept="application/json",s.headers["Content-Type"]="application/json",i.webServiceRequest(s)},getAttributes:function(t,n){Array.isArray(t)||n.onFailure(null);var o={url:i.get3DSpaceUrl()+"resources/dsmfg/V0/getAttributes",method:"POST",data:e.Json.encode(t),headers:i.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0}),onComplete:function(t){e.is(n)&&e.is(n.onComplete,"function")&&n.onComplete(t)},onFailure:function(t){e.is(n)&&e.is(n.onFailure,"function")&&n.onFailure(t)}};i.webServiceRequest(o)},getInstances:function(t,n){Array.isArray(t)||n.onFailure(null);var o={url:i.get3DSpaceUrl()+"resources/dsmfg/V0/whereUsed",method:"POST",data:e.Json.encode(t),headers:i.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0}),onComplete:function(t){e.is(n)&&e.is(n.onComplete,"function")&&n.onComplete(t)},onFailure:function(t){e.is(n)&&e.is(n.onFailure,"function")&&n.onFailure(t)}};i.webServiceRequest(o)},getInstancesWithPromise:function(e){var t=this;return new n((function(n,o){t.getInstances(e,{onComplete:function(e){n(e)},onFailure:function(e){o(e)}})}))},getUnitDetails:function(t,n){var o=this,s=n||{},a=(!!e.is(s.silent,"boolean")&&s.silent,i.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0}));e.is(s.securityContextOverride,"string")&&(a.SecurityContext=s.securityContextOverride);var l={url:i.get3DSpaceUrl()+"resources/v1/modeler/dspfl/dspfl:Unit/"+t,method:"GET",headers:a,onComplete:function(t){e.is(n.onComplete,"function")&&n.onComplete.call(null,t)},onFailure:function(t,n){var i=e.is(n)?e.Json.isJson(n)?e.Json.decode(n):n:{};r.debug(o.name,"Get Unit details failed: %o",t),e.is(s.onFailure,"function")&&s.onFailure.call(null,t,i.error)}};i.webServiceRequest(l)},fetchRef_v2:function(e,t){var o=this;return new n((function(n,i){o.fetchRef(e,{silent:t,onComplete:function(e){n(e)},onFailure:function(e){i(e)}})}))},fetchInst_v2:function(e){var t=this;return new n((function(n,o){t.fetchInst(e,{silent:!0,onComplete:function(e){n(e)},onFailure:function(e){o(e)}})}))},addExecTimeConstraintRelationFromPID:function(e,t,n){null!=n?this.addConn({PID:this.getExecTimeConstraintRelationPID(e,t),from:[e],to:[t],type:"DELLmiExecTimeConstraintRelation",kind:n}):this.addConn({PID:this.getExecTimeConstraintRelationPID(e,t),from:[e],to:[t],type:"DELLmiExecTimeConstraintRelation"})},addExecTimeConstraintRelation:function(e){var t=e["from.physicalid"].value,n=e["to.physicalid"].value;null!=e.interfaceforkind?this.addConn({PID:e.physicalid.value,from:[t],to:[n],type:"DELLmiExecTimeConstraintRelation",kind:e.interfaceforkind.value},{silent:!0}):this.addConn({PID:e.physicalid.value,from:[t],to:[n],type:"DELLmiExecTimeConstraintRelation"},{silent:!0})},getProductionPlanRefRelationPID:function(e,t){return"ProductionPlanLink|"+e+"|"+t},addProductionPlanRefRelationFromPID:function(e,t){this.addConn({PID:this.getProductionPlanRefRelationPID(e,t),from:[e],to:[t],type:"ProductionPlanLink"},{silent:!0})},getAssignedWorkCenterRelationPID:function(e,t){return"AssignedWorkCenterLink|"+e+"|"+t},addAssignedWorkCenterRelationFromPID:function(e,t){this.addConn({PID:this.getAssignedWorkCenterRelationPID(e,t),from:[e],to:[t],type:"AssignedWorkCenterLink"},{silent:!0})},getItemRefRelationPID:function(e,t){return"PartialProductImplementLink|"+e+"|"+t},addItemRefRelationFromPID:function(e,t){this.addConn({PID:this.getItemRefRelationPID(e,t),from:[e],to:[t],type:"PartialProductImplementLink"},{silent:!0})},getAssetContextRelationPID:function(e,t){return"AssetContextLink|"+e+"|"+t},addAssetContextRelationFromPID:function(e,t){this.addConn({PID:this.getAssetContextRelationPID(e,t),from:[e],to:[t],type:"AssetContextLink"},{silent:!0})},getSerializedRelationOpPID:function(e,t){return"DELIsSerializedFromOp|"+e+"|"+t},addSerializedRelationOpFromPID:function(e,t){this.addConn({PID:this.getSerializedRelationOpPID(e,t),from:[e],to:[t],type:"DELIsSerializedFromOp"},{silent:!0})},getSerializedRelationPID:function(e,t){return"DELIsSerializedFrom|"+e+"|"+t},addSerializedRelationFromPID:function(e,t){this.addConn({PID:this.getSerializedRelationPID(e,t),from:[e],to:[t],type:"DELIsSerializedFrom"},{silent:!0})},getExecTimeConstraintRelationPID:function(e,t){return"DELLmiExecTimeConstraintRelation|"+e+"|"+t}})})),define("DS/DELWKOModelServices/DELWKOSocketServices",["UWA/Core","UWA/Class","DS/Logger/Logger","DS/DELPPWWebServices_FD02/WebserviceUtils"],(function(e,t,n,o){"use strict";var i=t.singleton({_name:"DELWKOSocketServices",_logger:n.getLogger(i),_socket:null,init:function(e,t){var n=widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise",i=o.getServiceUrl("3dmfgworkplan"),r=(i=i.replace("https","wss"))+"wom/live/"+n;this.socket=new WebSocket(r)},getSocket:function(e){return this.socket.onmessage=e.onMessage,this.socket.onerror=e.onerror,this.socket}});return i})),define("DS/DELWKOModelServices/DELWKOCollectionUtils",["UWA/Core","UWA/Class","UWA/Class/Promise","DS/DELWKOModelServices/DELWKOAbstractCollectionUtils","DS/DELPPWModelServices_FD02/ModelUtils","DS/DELPPWIRPCModel_FD02/Collections/ReferenceCollection","DS/DELPPWIRPCModel_FD02/Collections/InstanceCollection","DS/DELPPWIRPCModel_FD02/Collections/ConnectionCollection","DS/DELPPWDocumentModel_FD02/DocumentCollection","DS/DELPPWIRPCModel_FD02/Model/ReferenceModel","DS/DELPPWIRPCModel_FD02/Model/InstanceModel","DS/DELPPWWebServices_FD02/WebserviceUtils","DS/DELPPWLoggerModel_FD02/LoggerUtils","DS/PlatformAPI/PlatformAPI","DS/DELPPWModelServices_FD02/BehaviorUtil","DS/DELWKONavigationServices/DELWKONavigateUtil","text!DS/DELWKOModelServices/assets/json/DELWKOPayloads.json"],(function(e,t,n,o,i,r,s,a,l,c,d,u,f,m,g,p,P){"use strict";return o.singleton({name:"DELWKOCollectionUtils",_init:function(e){this._parent(e)},init:function(t){t=t||{},e.is(this.references)||this._parent(t)},createWorkOrderFromProcess:function(t,n){var o=this,i=n||{},r=(!!e.is(i.silent,"boolean")&&i.silent,u.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0}));e.is(i.securityContextOverride,"string")&&(r.SecurityContext=i.securityContextOverride);var s=e.Json.decode(P).createWorkOrderFromProcess;void 0===t["PLMEntity.V_Name"]||""===t["PLMEntity.V_Name"]?delete s.items[0].title:s.items[0].title=t["PLMEntity.V_Name"],s.items[0].productionPlanId=t["DELLmiProductionPlanReference.ProductionPlan"],s.items[0]["dsprcs:MfgProcess"].source=u.get3DSpaceUrl().replace("3DSpace",""),s.items[0]["dsprcs:MfgProcess"].identifier=t["DELLmiWorkPlanSystemReference.MfgProcess"],s.items[0]["dsprcs:MfgProcess"].relativePath="/resources/v1/modeler/dsprcs/dsprcs:Process/"+t["DELLmiWorkPlanSystemReference.MfgProcess"],s.items[0]["dsmfg:MfgItem"].source=u.get3DSpaceUrl().replace("3DSpace",""),s.items[0]["dsmfg:MfgItem"].identifier=t["DELFmiFunctionReference.MfgItem"],s.items[0]["dsmfg:MfgItem"].relativePath="/resources/v1/modeler/dsmfg/dsmfg:MfgItem/"+t["DELFmiFunctionReference.MfgItem"],void 0===t["Builds.Builds"]||""===t["Builds.Builds"]?delete s.items[0].build:(s.items[0].build.source=u.get3DSpaceUrl().replace("3DSpace",""),s.items[0].build.identifier=t["Builds.Builds"],s.items[0].build.relativePath=t["Builds.Builds"]),"EACH"===t.Magnitude?s.items[0].orderQuantity.value=parseInt(t.OrderQuantity):s.items[0].orderQuantity.value=parseFloat(t.OrderQuantity),s.items[0].orderQuantity.magnitude=t.Magnitude;var a=JSON.stringify(s),l={url:u.get3DSpaceUrl()+"resources/v1/modeler/dswo/invoke/dswo:CreateWorkOrderFromProcess?$mask=dsmvwo:WorkOrderMask.DetailedStructure",method:"POST",headers:r,data:a,onComplete:function(t){for(var n=[],o=t.member,r=o.length,s=0;s<r;s++){var a=o[s];null!=a&&n.push(a["dswo:WorkOrder"].identifier)}var l={forceDBMode:!0,expandLevel:0},c=n;p.getDescendantsFromServer_v2(c,(function(t){var n={};n.data=t,e.is(i.onComplete,"function")&&i.onComplete.call(null,n.data)}),l)},onFailure:function(t,n){var r=e.is(n)?e.Json.isJson(n)?e.Json.decode(n):n:{};f.debug(o.name,"Creation failed: %o",t),e.is(i.onFailure,"function")&&i.onFailure.call(null,t,r.error)}};u.webServiceRequest(l)},fetchRefList:function(t,n){var o,i=this,r=[];o={url:"dsmfg/private/V0/MfgElement/reference/getReferences",method:"POST",data:e.Json.encode(t),options:n,onComplete:function(e){r=e.references.map((function(e){return e.attributesValue})),o={stackedReferences:r,onComplete:n.onComplete,onFailure:n.onFailure},i.addToCollections(o)},onFailure:function(t){e.is(n.onFailure,"function")&&n.onFailure.call(t)}},u.webServiceRequest(o)}})})),define("DS/DELWKOModelServices/DELWKOCollectionUtilsCloud",["UWA/Core","UWA/Class","UWA/Class/Promise","DS/DELPPWNavigationServices_FD02/SwitchDBModeManager","DS/DELWKOModelServices/DELWKOAbstractCollectionUtils","DS/DELPPWModelServices_FD02/ModelUtils","DS/DELWKOIRPCCollections/DELWKOReferenceCollection","DS/DELWKOIRPCCollections/DELWKOInstanceCollection","DS/DELWKOIRPCCollections/DELWKOConnectionCollection","DS/DELPPWDocumentModel_FD02/DocumentCollection","DS/DELPPWIRPCModel_FD02/Model/ReferenceModel","DS/DELPPWIRPCModel_FD02/Model/InstanceModel","DS/DELPPWWebServices_FD02/WebserviceUtils","DS/DELPPWLoggerModel_FD02/LoggerUtils","DS/PlatformAPI/PlatformAPI","DS/DELPPWModelServices_FD02/BehaviorUtil","DS/DELWKONavigationServices/DELWKONavigateUtil","DS/DELWKOIRPCModels/DELWKOWorkOrderReferenceModel","DS/DELWKOIRPCModels/DELWKOExecHeaderOperationReferenceModel","DS/DELWKOIRPCModels/DELWKOProductionPlanReferenceModel","text!DS/DELWKOModelServices/assets/json/DELWKOPayloads.json"],(function(e,t,n,o,i,r,s,a,l,c,d,u,f,m,g,p,P,D,h,C,v){"use strict";return i.singleton({name:"DELWKOCollectionUtilsCloud",_init:function(e){this._parent(e)},init:function(t){(t=t||{}).references=new s,t.instances=new a,t.connections=new l,e.is(this.references)||this._parent(t)},createRandomPID:function(){for(var e=new RegExp("[0-9A-F]"),t="",n=0;n<32;){var o=String.fromCharCode(47+Math.floor(27*Math.random()+0));e.test(o)&&(n=(t+=o).length)}return t},updateModel:function(t,n){var o=this;(n=n||{}).onCompleteMsg=e.is(n.onCompleteMsg)?n.onCompleteMsg:"Updated Model succesfully",n.onFailureMsg=e.is(n.onFailureMsg)?n.onFailureMsg:"Updating Model failed",e.is(n.forceUpdate)||(n.data.revision=t.get("revision")),t.save(null,{proxy:"passport",headers:f.getHeaders(),data:e.Json.encode(n.data),forceUpdate:n.forceUpdate,onComplete:function(t,i){m.debug(o.name,n.onCompleteMsg+" : %s",JSON.stringify(t)),e.is(n.isFacet)&&n.isFacet&&g.publish("DS/PADUtils/PADCommandProxy/refresh",{data:{authored:{modified:[t.id]}}}),e.is(n.onComplete,"function")&&n.onComplete.call(null,t,i)},onFailure:function(i,r){e.is(r)&&e.is(r.message)&&r.message.includes("revision")?(m.debug(o.name,r.message),e.is(n.onRevisionFailure,"function")&&n.onRevisionFailure.call(null,r)):(m.debug(o.name,n.onFailureMsg+" : %s",JSON.stringify(t)),e.is(n.onFailure,"function")&&n.onFailure.call(null,r.message))},wait:!0,parse:!0})},updateModel_v2:function(t,n){(n=n||{}).onCompleteMsg=e.is(n.onCompleteMsg)?n.onCompleteMsg:"Updated Model succesfully",n.onFailureMsg=e.is(n.onFailureMsg)?n.onFailureMsg:"Updating Model failed",e.is(n.forceUpdate)||(n.data.revision=t.get("revision")),Object.keys(n.data).forEach((e=>{var o=e,i=n.data[o];t.set(o,i,{silent:!1})}))},getProductionPlanAttributesOnCloud:function(e,t){return Array.isArray(e)||t.onFailure(null),new n((function(n,o){var i={url:f.getServiceUrl("orderdatamgmt")+"resources/v1/modeler/dswo/productionplan/"+e[0],method:"GET",headers:{},onComplete:function(e){t.onComplete(e),n()},onFailure:function(e){t.onFailure(e),o()}};f.webServiceRequest(i)}))},getProductionPlanFromWorkOrderOnCloud:function(t){var n=this.getReferenceModel(t);if(e.is(n)){var o=new C({id:n.productionPlanId});if(e.is(o)){var i=this.getReferenceModel(o.get("PID"));if(e.is(i))return i}}},getMfgItemFromWorkOrderOnCloud:function(t){var n=this.getReferenceModel(t);if(e.is(n)){var o=this.getImpactedConnections(t,null,{relationTypes:["PartialProductImplementLink"]});if(e.is(o)&&o.length>0){var i=void 0;return o.forEach((t=>{if(e.is(t)&&"PartialProductImplementLink"===t._attributes.type){var n=t._attributes.to;if(i=this.getReferenceModel(n),e.is(i))return i}})),i}}},getAttributesFromReference:function(t,n){var o={url:t.url(),method:"GET",headers:t.getHeaders(),onComplete:function(t){e.is(n)&&e.is(n.onComplete,"function")&&n.onComplete(t)},onFailure:function(t){e.is(n)&&e.is(n.onFailure,"function")&&n.onFailure(t)}};f.webServiceRequest(o)},getAttributesOnCloud:function(t,o){return Array.isArray(t)||o.onFailure(null),new n((function(n,i){var r={url:f.get3DSpaceUrl()+"resources/dsmfg/V0/WKO/getAttributes",method:"POST",data:e.Json.encode(t),headers:f.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0}),onComplete:function(t){e.is(o)&&e.is(o.onComplete,"function")&&o.onComplete(t),n()},onFailure:function(t){e.is(o)&&e.is(o.onFailure,"function")&&o.onFailure(t),i()}};f.webServiceRequest(r)}))},getAttributesOnIndex:function(t,o){return Array.isArray(t)||o.onFailure(null),new n((function(n,i){P.fetchOnIndex(t,{onComplete:function(t){e.is(o)&&e.is(o.onComplete,"function")&&o.onComplete(t),n()},onFailure:function(t){e.is(o)&&e.is(o.onFailure,"function")&&o.onFailure(t),i()},type:e.is(o.type)?o.type:void 0})}))},getWorkOrderFromProductionPlan:function(t,o){var i=this;return new n((function(r,s){var a=[];t.forEach((e=>{var t=[],r=new n((function(n,r){i.getWorkOrderFromProductionPlanOnCloud(e,o,0,n,r,t)}));a.push(r)})),e.Promise.all(a).then((function(e){r(e)}))}))},getWorkOrderOnCloud_v2:function(t,o){var i=this;return new n((function(o,r){var s=[];t.forEach((e=>{var t=[],o=new n((function(n,o){i.getWorkOrderOnCloud(e,n,o,t)}));s.push(o)})),e.Promise.all(s).then((function(e){o(e)}))}))},getWorkOrderOnCloud:function(e,t,n,o){var i={url:f.getServiceUrl("orderdatamgmt")+"resources/v1/modeler/dswo/"+e+"?mask=detailed_structure",method:"GET",headers:{},onComplete:function(e){o.push(e),t(o)},onFailure:function(e){t([])}};f.webServiceRequest(i)},getWorkOrderFromProductionPlanOnCloud:function(t,n,o,i,r,s){var a=this,l={url:e.is(n)?f.getServiceUrl("orderdatamgmt")+"resources/v1/modeler/dswo/workorder?productionPlanId="+t+"&state="+n+"&$skip="+o+"&mask=detailed_structure":f.getServiceUrl("orderdatamgmt")+"resources/v1/modeler/dswo/workorder?productionPlanId="+t+"&$skip="+o+"&mask=detailed_structure",method:"GET",headers:{},onComplete:function(e){s.push(e),!0===e.last?i(s):(o=parseInt(o),o+=50,a.getWorkOrderFromProductionPlanOnCloud(t,n,o,i,r,s))},onFailure:function(e){r()}};f.webServiceRequest(l)},getProductionPlan:function(e){var t=this;return new n((function(e,n){t.getProductionPlanOnCloud(0,e,n,[])}))},getProductionPlanOnCloud:function(e,t,n,o){var i=this,r={url:f.getServiceUrl("orderdatamgmt")+"resources/v1/modeler/dswo/productionplan?page="+e,method:"GET",headers:{},onComplete:function(r){o.push(r),!0===r.last?t(o):(e=parseInt(e),e++,i.getProductionPlanOnCloud(e,t,n,o))},onFailure:function(e){n()}};f.webServiceRequest(r)},createExecCanUseResourceLink:function(t,n){var o=this,i=n||{},r=(!!e.is(i.silent,"boolean")&&i.silent,{SecurityContext:f.getSecurityContext(),"Content-Type":"application/json","x-requested-with":"XMLHttpRequest"}),s=e.Json.decode(v).createExecCanUseResourceLink;s[0].workOrderOperationId=t.workOrderOperationId,s[0].resource.source="3DSpace",s[0].resource.identifier=t.resourceId,s[0].resource.relativePath="/resources/v1/modeler/dsrsc/dsrsc:Resource/"+t.resourceId;var a=JSON.stringify(s),l={url:f.getServiceUrl("orderdatamgmt")+"resources/v1/modeler/dswo/primarycapableresource",method:"POST",headers:r,data:a,onComplete:function(e){o.data=e;for(var n=[],r=o.data,s=r.length,a=0;a<s;a++){var l=r[a];null!=l&&(l.from=t.resourceId,l.to=t.workOrderOperationPID,l.type="DELLmiExecAsmProcessCanUseCnx",n.push(l))}var c={stackedReferences:[],stackedInstances:[],stackedConnections:n,onComplete:i.onComplete,onFailure:i.onFailure,silentMode:!1};o.addToCollections(c)},onFailure:function(t,n){var r=e.is(n)?e.Json.isJson(n)?e.Json.decode(n):n:{};m.debug(o.name,"Creation failed: %o",t),e.is(i.onFailure,"function")&&i.onFailure.call(null,t,r.error)}};f.webServiceRequest(l)},getProductionPlan_v2:function(e){var t=this;return new n((function(e,n){t.getProductionPlanOnCloud_v2(0,e,n,[])}))},getProductionPlanOnCloud_v2:function(e,t,n,o){var i=this,r={url:f.getServiceUrl("orderdatamgmt")+"resources/v1/modeler/dswo/productionplan?$skip="+e,method:"GET",headers:{},onComplete:function(r){o.push(r),!0===r.last?t(o):(e=parseInt(e),e+=50,i.getProductionPlanOnCloud_v2(e,t,n,o))},onFailure:function(e){n()}};f.webServiceRequest(r)},createWorkOrderFromProcessOnCloud:function(t,n){var o,i,r,s,a=this,l=n||{},c=(!!e.is(l.silent,"boolean")&&l.silent,{SecurityContext:f.getSecurityContext(),"Content-Type":"application/json","x-requested-with":"XMLHttpRequest"}),d=e.Json.decode(v).createWorkOrderFromProcessOnCloud;if(void 0===t["PLMEntity.V_Name"]||""===t["PLMEntity.V_Name"]?delete d[0].name:d[0].name=t["PLMEntity.V_Name"],d[0].productionPlanId=t["DELLmiProductionPlanReference.ProductionPlan"],d[0]["dsprcs:MfgProcess"].source="3DSpace",d[0]["dsprcs:MfgProcess"].identifier=t["DELLmiWorkPlanSystemReference.MfgProcess"],d[0]["dsprcs:MfgProcess"].relativePath="/resources/v1/modeler/dsprcs/dsprcs:MfgProcess/"+t["DELLmiWorkPlanSystemReference.MfgProcess"],d[0]["dsmfg:MfgItem"].source="3DSpace",d[0]["dsmfg:MfgItem"].identifier=t["DELFmiFunctionReference.MfgItem"],d[0]["dsmfg:MfgItem"].relativePath="/resources/v1/modeler/dsmfg/dsmfg:MfgItem/"+t["DELFmiFunctionReference.MfgItem"],void 0===t["Builds.Builds"]||""===t["Builds.Builds"]?delete d[0].build:(d[0].build.identifier=t["Builds.Builds"],d[0].build.relativePath=t["Builds.Builds"],d[0].build.source="3DSpace"),"EACH"===t.Magnitude)d[0].orderQuantity=parseInt(t.OrderQuantity);else{d[0].orderQuantity=(o=t.OrderQuantity,i=widget.lang,r=Intl.NumberFormat(i).format(11111).replace(/\p{Number}/gu,""),s=Intl.NumberFormat(i).format(1.1).replace(/\p{Number}/gu,""),parseFloat(o.replace(new RegExp("\\"+r,"g"),"").replace(new RegExp("\\"+s),".")))}d[0].magnitude=t.Magnitude,"EACH"!=t.Magnitude&&(d[0].unit=t.UoM),d[0].dueDate=t["DELLmiUPRSystemReference.V_DueDate"];var u=JSON.stringify(d),g={url:f.getServiceUrl("orderdatamgmt")+"resources/v1/modeler/dswo/workorder/fromprocess?$mask=detailed_structure",method:"POST",headers:c,data:u,onComplete:function(t){a.data=t;var n={stackedReferences:[],stackedInstances:[],stackedConnections:[],documentIdMap:{},silentMode:!1},o=[],i=[];if(a.data.forEach((t=>{t.type="DELLmiWorkOrderReference",n.stackedReferences.push(t);var r=new D({id:t.id});if(e.is(t.productionPlanId)){var s=a.getProductionPlanAttributesOnCloud([t.productionPlanId],{onComplete:function(o){var i=new C({id:t.productionPlanId});e.is(t.productionPlanId)&&n.stackedConnections.push({PID:a.createRandomPID(),from:i.get("PID"),to:r.get("PID"),type:"ProductionPlanLink"});var s=o;s.type="DELLmiProductionPlanReference",n.stackedReferences.push(s)}});o.push(s)}e.is(t.build)&&e.is(t.build.identifier)&&(n.stackedConnections.push({PID:a.createRandomPID(),from:r.get("PID"),to:t.build.identifier,type:"DELIsGeneratedFromProcessFilteredBy"}),i.push(t.build.identifier)),e.is(t.serializedFrom)&&e.is(t.serializedFrom.identifier)&&(n.stackedConnections.push({PID:a.createRandomPID(),from:r.get("PID"),to:t.serializedFrom.identifier,type:"DELIsSerializedFrom"}),i.push(t.serializedFrom.identifier)),e.is(t.itemRef)&&e.is(t.itemRef.identifier)&&(n.stackedConnections.push({PID:a.createRandomPID(),from:r.get("PID"),to:t.itemRef.identifier,type:"PartialProductImplementLink"}),i.push(t.itemRef.identifier)),e.is(t.assetContext)&&e.is(t.assetContext.identifier)&&(n.stackedConnections.push({PID:a.createRandomPID(),from:r.get("PID"),to:t.assetContext.identifier,type:"AssetContextLink"}),i.push(t.assetContext.identifier))})),e.is(i)&&i.length>0){var r=a.getAttributesOnIndex(i,{onComplete:function(t){if(e.is(t)&&Array.isArray(t))t.forEach((e=>{var t=e.attributes;t.physicalid=e.attributes.PID,t.type=e.attributes.type,n.stackedReferences.push(t)}));else{var o=t.attributes;o.physicalid=t.attributes.PID,o.type=t.attributes.type,n.stackedReferences.push(o)}},onFailure:function(e){},type:"entity"});o.push(r)}e.Promise.all(o).then((function(e){a._addToCollections(n,l)}))},onFailure:function(t,n){var o=e.is(n)?e.Json.isJson(n)?e.Json.decode(n):n:{};m.debug(a.name,"Creation failed: %o",t),e.is(l.onFailure,"function")&&l.onFailure.call(null,t,o)}};f.webServiceRequest(g)},_addToCollections:function(t,n){var o=this,i=[];n=n||{},t.onComplete=function(t){t.instancesAndReferences.forEach((function(e){var t=[];if(("WORKORDER"===e.get("PPRTYPE")||"EXECHEADER"===e.get("PPRTYPE")||"STEP"===e.get("PPRTYPE"))&&(t.push(e.get("PID")),e.setAdditionalInfo({queriedForConnections:!0}),!e.getAdditionalInfo("queriedForChildren"))){n.expandLevel=0,n.silentMode=!1;var r=o.getDescendantsFromServer(t,n);i.push(r)}})),e.is(i)&&i.length>0?e.Promise.all(i).then((function(e){n.onComplete(t)})):n.onComplete(t)},this.addToCollections(t)},getRootReferenceFromInstance:function(t){if(e.is(t)){var n=this.getInstanceFromCollection(t);if(e.is(n)){var o=n.get("isAggregatedBy");if(e.is(o))for(var i=this.getParentInstancesFromCollection(o);e.is(i)&&i.length>0;)i.forEach((t=>{o=t.get("isAggregatedBy"),e.is(o)&&(i=this.getParentInstancesFromCollection(o))}));return this.getReferenceModel(o)}}},addChildInfo:function(e,t){this.instances.addChildInfo(e,t)},addRefInfo:function(e,t){this.instances.addRefInfo(e,t)},getDescendantsOnCloud:function(t,o){var i=this;return new n((function(n,r){e.is(t)&&0===t.length&&n();var s=[],a=[],l=i.fetchRefFromInstOnCloud(t,o);a.push(l),e.Promise.all(a).then((function(t){if(Array.isArray(t)&&t.length>0){var o={forceDBMode:!1,expandLevel:0,withLinks:!0},r=[];if(t.forEach((e=>{e.instance.forEach((e=>{i.instances.add(new u(e),{silent:!0,merge:!0})})),e.reference.forEach((e=>{i.references.add(new d(e),{silent:!0,merge:!0})})),e.reference.forEach((e=>{r.push(e.physicalid)}))})),e.is(o.forceDBMode)&&!0===o.forceDBMode||!0===p.ODTCloud){o.forceDBMode,t.forEach((e=>{e.instance.forEach((e=>{r.push(e.physicalid)}))}));var a=i.getDescendantsFromServer(r,o);s.push(a)}else{a=i.getDescendantsFromServer(r,o);s.push(a)}e.Promise.all(s).then((function(e){n()}))}}))}))},getDescendantsFromServer:function(e,t){return new n((function(n,o){P.getDescendantsFromServer(e,(function(e){n(e)}),t)}))},fetchRefFromInstOnCloud:function(t,o){var i=this;return new n((function(n,o){i.getAttributesOnCloud(t,{onComplete:function(t){var r=[],s=[];t.items.forEach((e=>{var t=e.attributes;t.isAggregatedBy=e.isAggregatedBy,t.isInstanceOf=e.isInstanceOf,r.push(t.isInstanceOf),t.type=e.type,t.physicalid=e.physicalid,s.push(t)})),e.is(r)&&r.length>0&&i.getAttributesOnCloud(r,{onComplete:function(e){var t=[];e.items.forEach((e=>{var n=e.attributes;n.isAggregatedBy=e.isAggregatedBy,n.isInstanceOf=e.isInstanceOf,n.type=e.type,n.physicalid=e.physicalid,t.push(n)})),n({instance:s,reference:t})},onFailure:function(){o()}})},onFailure:function(){o()}})}))},fetchRefOnCloud:function(t,o){var i=this,r=void 0,s=t.type;return e.is(s)&&"DELLmiWorkOrderReference"===s?r=new D(t):e.is(s)&&"DELLmiExecHeaderOperationReference"===s?r=new h(t):e.is(s)&&"DELLmiProductionPlanReference"===s?r=new C(t):null!=e.is(s)&&(r=new d(t)),new n((function(e,n){r.fetch({proxy:"passport",headers:f.getHeaders(),onComplete:function(n){n._attributes.type=t.type,m.debug(i.name,"Fetch completed: %o",n),i.references.add(n,{silent:!0,merge:!0}),e(n)},onFailure:function(e){m.debug(i.name,"Fetch failed: %o",e),n()},wait:!0,parse:!0})}))},fetchRefList:function(t,n){var o=this,i=[],r=[];if(t.forEach((e=>{new RegExp("[0-9A-F]{32}").test(e)?i.push(e):r.push(e)})),i.length>0){var s,a=[];s={url:"dsmfg/private/V0/MfgElement/reference/getReferences",method:"POST",data:e.Json.encode(i),options:n,onComplete:function(e){a=e.references.map((function(e){return e.attributesValue})),s={stackedReferences:a,onComplete:n.onComplete,onFailure:n.onFailure},o.addToCollections(s)},onFailure:function(t){e.is(n.onFailure,"function")&&n.onFailure.call(t)}},f.webServiceRequest(s)}if(r.length>0){!!e.is(n.silent)&&n.silent;var l=[];l.push(o.getWorkOrderOnCloud_v2(r)),e.Promise.all(l).then((function(e){var t=[];e.forEach((e=>{e.forEach((e=>{e.forEach((e=>{var n=new D({id:e.id});r.includes(n.get("PID"))&&(e.type="DELLmiWorkOrderReference",t.push(e))}))}))}));var i={stackedReferences:t,stackedInstances:[],stackedConnections:[],silentMode:!0,onComplete:n.onComplete,onFailure:n.onFailure};o._addToCollections(i,n)}))}},updateRef_v2:function(t,n){var o=this.references.get(t);e.is(o)&&((n=n||{}).onCompleteMsg="Updated Reference succesfully",n.onFailureMsg="Updating Reference failed",this.updateModel_v2(o,n))}})}));