define("DS/ClassificationsCompareUI/utils/platformservices",["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","UWA/Class/Debug"],(function(t,e){"use strict";return UWA.Class.singleton(e,{_platforms:[],urlsLoaded:!1,init:function(){this._platforms=[]},getServiceURL:function(t){return this._platforms[t]?this._platforms[t]:null},getPlatformId:function(){let t=this;if(t._platformId)return t._platformId;try{return widget&&(t._platformId=widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise"),t._platformId}catch(t){return"OnPremise"}},getPlatformServices:function(e){let i=this;return new Promise((function(e,n){if(i.urlsLoaded)e(i._platforms);else{let a={platformId:i.getPlatformId(),onComplete:function(t){let n=t.hasOwnProperty("length")?t[0]:t;i._platforms=n,i.urlsLoaded=!0,e(n)},onFailure:function(t){n(t)}};t.getPlatformServices(a)}})).catch((t=>{e.logger.error(t)}))}})})),define("DS/ClassificationsCompareUI/service/classificationscomparewebservices",["DS/WAFData/WAFData"],(function(t){"use strict";return{getAllClassesAndAttributesOfObject:function(e){var i=e.serverURL+"/resources/IPClassificationReuse/classifiedItem/"+e.objectId+"/getAllClassesAndAttributes";e.method="GET";var n={Accept:"application/json",SecurityContext:encodeURIComponent(e.securityContext),"Accept-Language":widget.lang?widget.lang:widget.getValue("lang")};return new Promise((function(a,s){e.onComplete=function(t){a(JSON.parse(t))},e.onFailure=function(t,e){s(t)},e.onTimeout=function(t,e){s({type:"timeout",error:t,data:e})},e.headers=n,t.authenticatedRequest(i,e)}))}}})),define("DS/ClassificationsCompareUI/dataprovider/classificationsdisplaypanel",["DS/CompareWidget2/plugins/ATTRIBUTE/ViewPanel/propsComparePanel","i18n!DS/ClassificationsCompareUI/assets/nls/ClassificationsCompare"],(function(t,e){return t.extend({init:function(t,e,i){this._parent(t,e,i)},getLabel:function(){return e.ClassificationsTitle},getName:function(){return"CLASSIFICATION_VIEW"},getDomId:function(){return"classattr"}})})),define("DS/ClassificationsCompareUI/plugins/classificationsdisplayplugin",["DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin","DS/ClassificationsCompareUI/dataprovider/classificationsdisplaypanel","DS/CompareWidget2/ViewDefModules/DSColors","i18n!DS/ClassificationsCompareUI/assets/nls/ClassificationsCompare"],(function(t,e,i,n){return t.extend({onEnabled:function(){var t=this;return{classAttrProps:[{eventName:"CLASS_ATTR_UPDATE_IN_PROGRESS_EVENT",fn:t.onUpdateInProgress},{eventName:"CLASS_ATTR_FETCH_FAILED",fn:t.onAttrFetchFailure},{eventName:"NO_CURRENT_SELECTION_EVENT",fn:function(){t.showMessage(n.PROPS_UNAVAILABLE_NO_SELECTION)}},{eventName:"CLASS_ATTR_OFF_NONE_AVAILABLE",fn:function(){t.showMessageAndSignalOK("CLASS_ATTR_OFF_NONE_AVAILABLE_MSG")}},{eventName:"CLASS_ATTR_OFF_DURING_LIST_COMPARE",fn:function(){t.showMessageAndSignalOK("CLASS_ATTR_OFF_DURING_LIST_COMPARE_MSG")}},{eventName:"CLASS_ATTR_OFF_TOO_MANY_SELECTED",fn:function(){t.showMessageAndSignalOK("CLASS_ATTR_OFF_TOO_MANY_SELECTED_MSG")}},{eventName:"GROUP_PLACEHOLDER_SELECTED",fn:function(){t.showMessageAndSignalOK("GROUP_PLACEHOLDER_SELECTED_MSG")}}]}.classAttrProps.forEach((function(e){t.subscribeEvent(e.eventName,e.fn.bind(t))})),t._parent()},showMessageAndSignalOK:function(t){this.showMessage(n[t]),this.reportOK()},createViewPanelObject:function(t,i){return new e(t,this._plugSvcs,i)}})})),define("DS/ClassificationsCompareUI/dataprovider/classificationsattributesdata",["DS/CompareWidget2/plugins/DATA/attrValObjSet","DS/CompareWidget2/support/tenantServiceContext_IDList","UWA/Class/Debug","DS/ClassificationsCompareUI/service/classificationscomparewebservices","DS/ClassificationsCompareUI/utils/platformservices"],(function(t,e,i,n,a){"use strict";return UWA.Class.extend(i,{_classificationAttributesData:{},_platformServiceObj:null,urlsLoaded:!1,init:function(){this.platformServiceObj=a,this._classificationAttributesData={}},flushCache:function(){this._classificationAttributesData={},this._platformServiceObj=null,this.urlsLoaded=!1},getServiceURL:function(t,e){return this._classificationAttributesData[t]&&this._classificationAttributesData[t][e]?this._classificationAttributesData[e]:null},getClassificationAttrData:function(t){var i=this,n=[],a=new e;return t.forEach((function(t){n.push(t.getPhysID()),t.getSecurityContext(),a.addObjIDSpec(t)})),new Promise((function(e,n){i._getClassificationAttributesValues(a).then((function(n){var a=[];t.forEach((function(t){var e=i._getFromCache(t);e&&(void 0===e.objType||null===e.objType&&""===e.objType)&&(e.objType=t.getObjType()),a.push(e)})),i._cacheIsLoaded=!0,e(a)}),(function(t){var e=i._cacheType+" fetch data failed:: "+t;n(e)}))}))},_getFromCache:function(e){let i=e;var n=i.getTenant(),a=i.getServiceName(),s=i.getSecurityContext(),r=i.getPhysID(),o=i.getObjType(),l=new t(r,o,"","");return l.setDBContext(s,a,n),l.objType=o,this._classificationAttributesData[n][a][s][r].forEach((function(t){var e=t.name,i=t.nls,n=t.value,a=t.type,s=t.UIPosition;l.add(e,i,n,a,s)})),l},_getClassificationAttributesValues:function(t,e){var i=this;return new Promise((function(e,n){var a=[];Object.keys(t._data).forEach((function(e){null==i._classificationAttributesData[e]&&(i._classificationAttributesData[e]={}),Object.keys(t._data[e]).forEach((function(n){null==i._classificationAttributesData[e][n]&&(i._classificationAttributesData[e][n]={}),Object.keys(t._data[e][n]).forEach((function(s){null==i._classificationAttributesData[e][n][s]&&(i._classificationAttributesData[e][n][s]={});var r=Object.keys(t._data[e][n][s]),o=[];r.forEach((function(t){if(void 0===i._classificationAttributesData[e][n][s][t]||null===i._classificationAttributesData[e][n][s][t]){o.push(t),i._classificationAttributesData[e][n][s][t]=null;var r={reqTenant:e,reqServiceName:n,reqSecurityContext:s,reqIDArray:o};a.push(r),o=[]}}))}))}))})),0==a.length?e(!1):i.platformServiceObj.getPlatformServices().then((function(t){i._doBigFetch(a).then((function(t){e(t)}),(function(t){e(t)}))}),(function(t){console.log("Error: "+error)}))}))},_doBigFetch:function(t){var e=this,i=[];return new Promise((function(n,a){var s=0,r=t.length;for(s=0;s<r;s++){var o=t[s];i.push(e._fetchReqSet(o))}Promise.all(i).then((function(t){n(t)}),(function(t){a(t)}))}))},_fetchReqSet:function(t){var e=this;return new Promise((function(i,n){var a=0,s=(t.reqIDArray.length,t.reqServiceName),r=t.reqTenant,o=t.reqSecurityContext,l=[];function c(t,i,n){0;let a=[],l=[];t.forEach((function(t,e){let i=t.label;l.push(i)})),a.push({name:"Classes",nls:"Classes",value:l,type:"string",UIPosition:1,_reqModforODT:"DS/CompareWidget2/plugins/DATA/attrValObj"}),t.forEach((function(t,e){let i=t.label,n=t.id,s=t.attribute;if(s&&s.length>0)for(const o in s){let l="["+i+"] "+s[o].nls_label,c="["+n+"]"+s[o].nls_label;var r=s[o].default;try{if(s[o].dimension){let p=s[o].dimensionUnits,A=s[o].manipulationUnit;if(p){let S="";S=A?" "+p[A]:" "+p.defaultUnit,r+=S}}}catch(g){console.log("Exception while getting unit name of the attribute ",s[o].nls_label)}let u=s[o].range,f=s[o].rangeNLS;if(u&&f&&u.length>0&&f.length>0){function h(t){try{const e=u.findIndex((e=>e.value===t)),i=-1!==e?f[e].value:t;return""==i&&(i=t),i}catch(e){return console.log("Exception while getting nls of range value ",t),t}}if(Array.isArray(r)){let d=[];r.forEach((t=>{d.push(h(t))})),r=d}else r=h(r)}let _={name:c,nls:l,value:r,type:"string",UIPosition:void 0,_reqModforODT:"DS/CompareWidget2/plugins/DATA/attrValObj"};a.push(_)}})),e._classificationAttributesData[r][s][o][i]=a}for(a=0;a<t.reqIDArray.length;a++){let i=t.reqIDArray[a];l.push(e._getAttrs(i,t.reqServiceName,t.reqTenant,t.reqSecurityContext))}Promise.all(l).then((function(e){for(let i=0;i<e.length;i++)c(e[i],t.reqIDArray[i]);i(e)}),(function(t){n(t)}))}))},_getAttrs:function(t,e,i,a){var s=this;return new Promise((function(i,r){n.getAllClassesAndAttributesOfObject({securityContext:a,objectId:t,serverURL:s.platformServiceObj.getServiceURL(e)}).then((function(t){i(t)}),(function(t){r(t)}))}))}})})),define("DS/ClassificationsCompareUI/plugins/classificationsfetchplugin",["DS/CompareWidget2/plugins/plugin","DS/ClassificationsCompareUI/dataprovider/classificationsattributesdata"],(function(t,e){function i(t){var e=this,i="CLASSIFICATION";let n={type:i};e._plugSvcs.postEvent("PROPERTIES_LOAD_IN_PROGRESS_EVENT",n);let a=this._isInstance||this._isEffectivity?t.data.loadPropIDS_INST:t.data.loadPropIDS_REF;me._classficationsAttributeData.getClassificationAttrData(a).then((function(t){let n={type:i,props:t};e._plugSvcs.postEvent("PROPERTIES_CACHE_LOADED_EVENT",n)}),(function(t){this._plugSvcs.errout("FAILED to load props: "+t)}))}function n(t){this._classficationsAttributeData.flushCache()}function a(t){var e=this,i=t.data.selectedData;e._plugSvcs.dbgout("A new row has been selected..."),e._attrUpdateStartMS=e._plugSvcs.nowMS();var n=[];if(t.data.selectedData){var a=i[0].length>i[1].length?i[0]:i[1];if(0===a.length)return;var s=!0;if("LIST"!=t.data.structDisplayMode)1!=a.length&&(s=!1);else{var r=a[0].ObjIDSpec.getPhysID();a.forEach((function(t){t.ObjIDSpec.getPhysID()!=r&&(s=!1)}))}if(!s)return void e.postEvent("REF_PROPS_OFF_TOO_MANY_SELECTED",{id:"attrFetch"});i.forEach((function(t){if(null!=t&&t.length>0){var e=t[0].ObjIDSpec;null!=e&&n.push(e)}}));let o=0;for(let t of n){let e=t.getPhysID();null!=e&&""!==e&&++o}if(0==o)e._plugSvcs.postEvent("CLASS_ATTR_OFF_NONE_AVAILABLE_MSG",{id:"attrFetch"});else{if("relations"===n[0].getObjType())return void e.postEvent("GROUP_PLACEHOLDER_SELECTED",{id:"attrFetch"});e._plugSvcs.postEvent("REF_PROPS_UPDATE_IN_PROGRESS_EVENT",null),e._classficationsAttributeData.getClassificationAttrData(n).then((function(t){if(null!=t){var i=0;if(t)for(let e=0;e<t.length;e++)t[e].byName.Classes.value.length>0||i++;i===t.length?e._plugSvcs.postEvent("CLASS_ATTR_OFF_NONE_AVAILABLE",{id:"attrFetch"}):e.updateOutput(t)}}),(function(t){var i="getAttrData() failed:: "+t;e._plugSvcs.dbgout("ATTR_CACHE",e._DEBUG_isInstTxt+i)}))}}}return t.extend({init:function(t,i,n,a){this._parent(t,i,n,a),this._classficationsAttributeData=new e,this._comparisonInProgress=!1},onEnabled:function(){var t=this;return t.subscribeEvent("NEW_CURRENT_SELECTION_EVENT",a.bind(this)),t.subscribeEvent("LOAD_PROPS_FOR_EXPORT",i.bind(this)),t.subscribeEvent("EVENT_FLUSH_DATA_CACHES",n.bind(t)),t._parent()},onDestroy:function(){return this._parent()},execute:function(t,e){var i=this;i._parent(t,e),this._comparisonInProgress=!0;let n=t;i._plugSvcs.postEvent("CLASS_ATTR_UPDATE_IN_PROGRESS_EVENT",null),i._plugSvcs.dbgout("Performing initial CLASSIFICATION_ATTR_FETCH"),i._classficationsAttributeData.getClassificationAttrData(n).then((function(t){var e=0;if(t)for(let i=0;i<t.length;i++)t[i].byName.Classes.value.length>0||e++;e===t.length?i._plugSvcs.postEvent("CLASS_ATTR_OFF_NONE_AVAILABLE"):null!=t&&i.reportOK(t)}),(function(t){i._plugSvcs.showAlertBox("Failed to retrieve classification attributes",null,"error"),i._plugSvcs.postEvent("CLASS_ATTR_FETCH_FAILED"),i.reportKO(t)}))}})}));