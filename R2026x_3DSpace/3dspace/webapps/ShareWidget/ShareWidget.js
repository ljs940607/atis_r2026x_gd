define("DS/ShareWidget/ShareModel",["UWA/Controls/Abstract"],(function(e){return e.extend({init:function(e){this._RightList=[],this._DataList=[],this._ObjectId=e,this._ownerId="",this._projId="",this._orgId="",this._userGrpId="",this._objectType=""},setPOV:function(e,t,n,a){this._ownerId=e,this._projId=t,this._orgId=n,this._userGrpId=a},getObjectType:function(){return this._objectType},setRightList:function(e){this._RightList=e},setObjectType:function(e){this._objectType=e},getRightList:function(){return this._RightList},getDataList:function(){return this._DataList},getObjectId:function(){return this._ObjectId}})})),define("DS/ShareWidget/ShareController",["UWA/Controls/Abstract","UWA/Json","DS/ShareWidget/ShareModel","DS/WidgetServices/WidgetServices","DS/WidgetServices/CollabPerfTimer","DS/WAFData/WAFData","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/ENOCollabToolsUI/tracker/ENOCollabTrackerBackEnd","i18n!DS/ShareWidget/assets/nls/langAR"],(function(e,t,n,a,r,i,o,s,c){var l=a.getProdLevel();return e.extend({defaultOptions:{uniqueRightList:!1,wintop:!1,serverName:"",serverUri:"",isReadOnly:!1,odtMode:!1,parent:null},init:function(e,t){l=a.getProdLevel(),this.widget=e,this.AccessRightModelList=[],this.ECToParentMap=JSON.parse("[]"),this.IdToECMap=JSON.parse("[]"),this.SelectedItemsMap=JSON.parse("[]"),this.ExistingECItemsMap=JSON.parse("[]"),this.AggrItemsMap=JSON.parse("[]"),this.ErrorExistingECAndAggrItemsMap=JSON.parse("[]"),this.SelectedItems=[],this.SelectedItemsTypeMap=JSON.parse("[]"),this.NonEmbeddedComponentList=[],this._bInitDatas=!1,this._options=t,this._parent(t),this.accessLogicalNlsMap={},this.listOfValidIDs=[],this.listOfInvalidIDs=[],this.listOfIDs=[],this.InvalidSelectedItemsMap=JSON.parse("[]"),this.LifecycleConfidentialityEnabled=!1,this._perfTimer=r,this.widgetSecurityContext="",this.fullServerURL="";var n="";if(null!=e)if(e.hasOwnProperty("pad_security_ctx"))0!=(n=e.pad_security_ctx).indexOf("ctx::")&&(n="ctx::"+n);else if("function"==typeof e.hasPreference&&null!=e.getPreference("pad_security_ctx"))n=e.getPreference("pad_security_ctx").value;else if("function"==typeof e.hasPreference&&e.hasPreference("xPref_CREDENTIAL")){var i=e.getPreference("xPref_CREDENTIAL");void 0!==i.value&&null!==i.value&&i.hasOwnProperty("value")&&(n="ctx::"+i.value)}else"function"==typeof e.hasPreference&&null!=e.getPreference("securityContext")&&(n=e.getPreference("securityContext").value);this.widgetSecurityContext=n},getRightList:function(e){var t=[];return 1==this.options.uniqueRightList?this.AccessRightModelList.length>0&&(t=this.AccessRightModelList[0].getRightList()):this.AccessRightModelList.every((function(n){return n.getObjectId()!=e||(t=n.getRightList(),!1)})),t},getFormattedRightList:function(e){var t=this.getRightList(e),n=[];return t.forEach((function(e,t){var a={label:e.nls,value:e.logical};n.push(a)})),n},getOwnership:function(e){var t=[];return this.AccessRightModelList.every((function(n){return n.getObjectId()!=e||(t=n.getDataList(),!1)})),t},isInherited:function(e,t){var n=this.getOwnershipFromOwner(e,t),a=!1;return null!=n&&n.hasOwnProperty("inheritedPath")&&n.inheritedPath.length>0&&(a=!0),a},getOwnershipFromOwner:function(e,t){this.getOwnership(e);return null},_accessListContainsAccess:function(e,t){var n=!1;0==e.length&&(n=!0);for(var a=0;a<e.length;a++)if(e[a].logical==t.logical){n=!0;break}return n},_accessListSame:function(e,t){if(returnedValue=!0,e.length!=t.length)returnedValue=!1;else{var n=t.slice(),a=!0;e.every((function(e){var t=!1;return n.every((function(a,r){return e.logical!=a.logical||(t=!0,n.splice(r,1),!1)})),0!=t||(a=!1,!1)})),0==a&&(returnedValue=!1)}return returnedValue},onLoad:function(){this.AccessRightModelList=[],this.widget=widget,this.AccessRightModelList=[],this.ECToParentMap=JSON.parse("[]"),this.IdToECMap=JSON.parse("[]"),this.SelectedItemsMap=JSON.parse("[]"),this.ExistingECItemsMap=JSON.parse("[]"),this.AggrItemsMap=JSON.parse("[]"),this.ErrorExistingECAndAggrItemsMap=JSON.parse("[]"),this.SelectedItems=[],this.SelectedItemsTypeMap=JSON.parse("[]"),this.NonEmbeddedComponentList=[],this._bInitDatas=!1},getCurrentSelectedItems:function(){var e=[];return this.AccessRightModelList.forEach((function(t){e.push({objectID:t.getObjectId()})})),e},_getModel:function(e){for(var t=0;t<this.AccessRightModelList.length;t++){var a=this.AccessRightModelList[t];if(a.getObjectId()==e)return a}var r=new n(e);return this.AccessRightModelList.push(r),r},flatten:function(e){var t=this;return e.reduce((function(e,n){return e.concat(Array.isArray(n)?t.flatten(n):n)}),[])},parseResponse:function(e){let t=[];if(!UWA.is(e.collabspaces,"array"))return t;let n=[...new Set(this.flatten(e.collabspaces.map((e=>e.couples.map((e=>e.organization.name))))))].length>1;return e.collabspaces.forEach((e=>{e.couples.forEach((a=>{var r=null==a.role.nls||""==a.role.nls?a.role.name:a.role.nls,i=a.role.name,o=a.organization.name,s=a.organization.title,c=e.name,l=e.title?e.title:e.name;let d=n?l+" ● "+s+" ● "+r:l+" ● "+r,h="ctx::"+i+"."+o+"."+c;t.push({displayName:d,ctx:h})}))})),t.sort(((e,t)=>e.displayName.localeCompare(t.displayName,void 0,{numeric:!0,sensitivity:"base"})))},_fillAttributesOfSelectedItems:function(e,t,n){for(var a=this,r=[],i=e.length,o=[],s=[],c=0;c<i;c++){var l="";null!=e[c].type&&(l=e[c].type),null==e[c].type&&null!=e[c].typeDisplayName&&(l=e[c].typeDisplayName),o.push(l),s.push(e[c].physicalId)}for(var d=s.length,h=0;h<d;h++){var p=s[h];r.push({objectID:p,type:o[h]})}var m=r;a._perfTimer.start("Share: isTypeSupportedToCommand"),this._post2("/resources/accessRightServices/ar/isTypeSupportedToCommand",m,(function(e,n){a._perfTimer.stop("Share: isTypeSupportedToCommand"),t(e,n)}),(function(e){n(e)}))},_setValidInvalidIdList(e,t){var n=this;if(n.listOfValidIDs=e,0==n.listOfInvalidIDs.length)n.listOfInvalidIDs=t;else{n.listOfInvalidIDs.concat(t),n.listOfInvalidIDs=n.listOfInvalidIDs.filter(((e,t,n)=>t===n.findIndex((t=>t===e))))}},_fillModels:function(e){for(var t=this,n=e.length,a=0;a<n;a++){var r=e[a];if(null!==r){t.listOfIDs.push(r.physicalId);var i=t._getModel(r.physicalId);null!=i&&(t.IdToECMap[r.physicalId]=r.v_IsEmbeddedComponent,t.SelectedItemsMap[r.physicalId]=r,t.SelectedItemsTypeMap[r.type]=r,i.setPOV(r.owner+"_PRJ",r.project,r.organization),i.setObjectType(r.type))}}if(t.SelectedItems=e.splice(0),0==t._bInitDatas){var o=[];t._bInitDatas=!0,t.AccessRightModelList.forEach((function(e){t.NonEmbeddedComponentList.push(e.getObjectId()),o.push({objectID:e.getObjectId()})})),t._getAccessListForIds(o)}},_getSecurityContext:function(e,t){var n=this;o.getInstance().getSecurityContext({onSuccess:function(t){var a="";null!=t&&null!=t.SecurityContext&&0!=(a=t.SecurityContext).indexOf("ctx::")&&(a="ctx::"+a),""!=n.widgetSecurityContext?e(n.widgetSecurityContext):e(a)},onFailure:function(a){""!=n.widgetSecurityContext?e(n.widgetSecurityContext):t(a)}})},_post2:function(e,n,r,i){var o=this;datasString=t.encode({requests:n}),this._getSecurityContext((function(t){a.get3DSpaceUrlAsync({onComplete:function(n){o.fullServerURL=n;var s=n+e,l={Accept:"application/json","Content-Type":"application/json"};l.SecurityContext=encodeURIComponent(t),l["Accept-Language"]=widget.lang;var d=a.getTenantID();d&&0!=d.length?s+="?tenant="+d:s+="?tenant=OnPremise",a.partitionedAuthenticatedRequest(s,{method:"POST",headers:l,timeout:864e5,cancelCallback:function(){return!1},partisionedProgressLabel:c.get(""),progressBarContext:o.options.contextArea1,progressBarWaitContext:o.options.progressBarWaitContext,data:datasString,type:"json",onComplete:function(e){r(e,n)},onFailure:function(e){i(e)},onTimeout:function(){i("timeout")}})},serverUrl:o.options.serverUrl,wintop:o.options.wintop})}),(function(e){i(e)}))},_post3:function(e,t,n,r){var i=this;this._getSecurityContext((function(o){a.get3DSpaceUrlAsync({onComplete:function(s){var l=s+e,d={Accept:"application/json","Content-Type":"application/json"};d.SecurityContext=encodeURIComponent(o);var h=a.getTenantID();h&&0!=h.length?l+="?tenant="+h:l+="?tenant=OnPremise",a.partitionedAuthenticatedRequest(l,{method:"POST",headers:d,timeout:864e5,cancelCallback:function(){return!1},partisionedProgressLabel:c.get(""),progressBarContext:i.options.contextArea1,progressBarWaitContext:i.options.progressBarWaitContext,data:t,type:"json",onComplete:function(e){n(e)},onFailure:function(e){r(e)},onTimeout:function(){r("timeout")}})},serverUrl:i.options.serverUrl,wintop:i.options.wintop})}),(function(e){r(e)}))},_get:function(e,t,n,r){var o=this;this._getSecurityContext((function(r){a.get3DSpaceUrlAsync({onComplete:function(s){var c=s+e,d={Accept:"application/json","Content-Type":"application/json"};d.SecurityContext=encodeURIComponent(r);var h=a.getTenantID();h&&0!=h.length?c+="?tenant="+h:c+="?tenant=OnPremise",t.hasOwnProperty("current")&&t.hasOwnProperty("select")&&(c+="&current="+t.current+"&select="+t.select);var p="";2==l&&(p="passport"),i.authenticatedRequest(c,{type:"json",method:"GET",headers:d,proxy:p,data:"",onComplete:function(e){n(e)},onFailure:function(e,t,n){o._onFailureAvailability(e,t,n)},onTimeout:function(){o._onTimeoutAvailability(items)}})},serverUrl:o.options.serverUrl,wintop:o.options.wintop})}),(function(e){r(e)}))},_onFailure2:function(e){this.dispatchEvent("onError2",e)},_onFailure:function(e,t,n){var a={};a=null!=t&&t.hasOwnProperty("error")?t.error:{message:UWA.i18n("UnknownError"),code:"ERROR"},this.dispatchEvent("onError",a)},_onTimeout:function(){var e={message:UWA.i18n("ErrorTimeOut"),code:"TO"};this.dispatchEvent("onError",e)},_getAccessListForIds:function(e){var n=this,r=[];if(null!=n.SelectedItemsTypeMap){Object.keys(n.SelectedItemsTypeMap).map((function(e){return n.SelectedItemsTypeMap[e]})).forEach((function(e){null!=e&&r.push({objectID:e.physicalId})}))}this.options.serverName,this.options.serverUri;this._getSecurityContext((function(i){a.get3DSpaceUrlAsync({onComplete:function(o){var s="",d=a.getRealPath("assets/dataRightList.json",n.widget),h="GET",p="";2==l&&(p="passport");var m="";2==l&&(s='{ "businessObject": '+t.encode(r)+"}",n.options.hasOwnProperty("odtmode")&&n.options.odtmode?(d=o+"/resources/pno/ownership/logicalaccess",m="Share: pno logicalaccess"):r.length>0&&0===r[0].objectID.indexOf("cid:")?(d=o+"/resources/lifecycle/ownership/logicalaccess",m="Share: lifecycle logicalaccess"):(d=o+"/resources/pno/ownership/logicalaccess",m="Share: pno logicalaccess"),h="POST"),headers={Accept:"application/json"},headers["Content-Type"]="application/json",headers["Accept-Language"]=widget.lang,headers.SecurityContext=encodeURIComponent(i),n.RightList=[];var u=a.getTenantID();u&&0!=u.length?d+="?tenant="+u:d+="?tenant=OnPremise",n._perfTimer.start(m),a.partitionedAuthenticatedRequest(d,{type:"json",method:h,headers:headers,proxy:p,cancelCallback:function(){return!1},partisionedProgressLabel:c.get(""),progressBarContext:n.options.contextArea1,progressBarWaitContext:n.options.progressBarWaitContext,data:s,timeout:864e5,onComplete:function(t){n._perfTimer.stop(m),n._onCompleteGetAccessListForIds(t,e)},onFailure:function(e,t,a){n._perfTimer.stop(m),n._onFailure(e,t,a)},onTimeout:function(){n._perfTimer.stop(m),n._onTimeout()}})},serverUrl:n.options.serverUrl,wintop:n.options.wintop})}),(function(e){onError(e)}))},_onCompleteGetAccessListForIds:function(e,t){var n=this,a=e.accessList,r=null,i=[],o=-1,s=-1;a.every((function(e,t){e.access.forEach((function(e){n.accessLogicalNlsMap[e.logical]=e.nls}));var a=e.objectID,c=n.SelectedItemsMap[a],l=null;if(null!=c&&(l=c.type),n.AccessRightModelList.every((function(t,n){return s=n,t.getObjectType()!=l||(t.setRightList(e.access),itemFound=!0,!1)})),3==e.access.length&&n.LifecycleConfidentialityEnabled?(n._options.parent.container.parentElement.getParent().getParent().getParent().setStyle("height","400px"),n._options.parent.container.parentElement.setStyle("height","72.5%")):e.access.length>3&&(n._options.parent.container.parentElement.getParent().getParent().getParent().setStyle("height","450px"),n._options.parent.container.parentElement.setStyle("height","76%")),1==itemFound&&1==n.options.uniqueRightList){var d=!0;if(0==n.AccessRightModelList.length&&t>0&&o>=0?d=n._accessListSame(i[o].getRightList(),e.access):n.AccessRightModelList.length>0&&(d=n._accessListSame(n.AccessRightModelList[0].getRightList(),e.access)),0==d){for(var h=!0,p={logical:"Reader",nls:"Can Read"},m={logical:"Read",nls:"Read"},u=n._accessListContainsAccess(n.AccessRightModelList[0].getRightList(),p),g=n._accessListContainsAccess(n.AccessRightModelList[0].getRightList(),m),S=0;S<n.AccessRightModelList.length;S++)u?0==n._accessListContainsAccess(n.AccessRightModelList[S].getRightList(),p)&&(h=!1):g&&0==n._accessListContainsAccess(n.AccessRightModelList[S].getRightList(),m)&&(h=!1);return r={message:UWA.i18n("ErrorDismatchAccessList"),code:""},h?(r.type="warning",n.dispatchEvent("onWarning",r)):n.dispatchEvent("onError",r),n.dispatchEvent("onDataLoaded"),!1}o=s}return n.dispatchEvent("onDataLoaded"),!0}))},modifyDataWithSC:function(e,n,r){var i=this,o={Accept:"application/json","Content-Type":"application/json"};if(null!=r&&""!=r&&r.hasOwnProperty("SecurityContext")){0!=r.SecurityContext.indexOf("ctx::")&&"ctx::",o.SecurityContext=encodeURIComponent(r.SecurityContext);var c=i.getAggrItemList();if(e.length>0&&null!=c){var d=[],h=Object.keys(c);e.length>0&&h.forEach((function(t){var n={objectID:t,ownership:e[0].ownership};d.push(n),e.push(n)}))}this.options.serverName,this.options.serverUri;for(var p=[],m=0;m<n.length;m++)p.indexOf(n[m])<0&&p.push(n[m]);a.get3DSpaceUrlAsync({onComplete:function(n){var c="POST",d="",h=a.getRealPath("assets/validModification.json",i.widget),m={requests:p};s.enrichRequestWithMetrics(m,{UXName:"Share"});var u=t.encode(m);2==l&&(d="passport");2==l&&(h=n+"/resources/accessRightServices/ar/getCompletedData",c="POST"),o["Accept-Language"]=widget.lang;var g=a.getTenantID();g&&0!=g.length?h+="?tenant="+g:h+="?tenant=OnPremise",i._perfTimer.start("Share: getCompletedData"),a.partitionedAuthenticatedRequest(h,{type:"json",method:c,proxy:d,headers:o,cancelCallback:function(){return!1},data:u,timeout:36e5,onComplete:function(t){i._perfTimer.stop("Share: getCompletedData");for(var n=0;n<t.results.length;n++)if(null!=t.results[n].invalidList&&t.results[n].invalidList.length>0){t.results[n].invalidList.forEach((function(t){void 0!==i.SelectedItemsMap[t]&&null!==i.SelectedItemsMap[t]&&(i.ErrorExistingECAndAggrItemsMap[t]=i.SelectedItemsMap[t]);for(var n=0;n<e.length;n++)e[n].objectID===t&&e.splice(n,1)}))}else if(null!=t.results[n].validList&&t.results[n].validList.length>0){var a=[];a=t.results[n].validList,expandedOwnershipItems=[],a.forEach((function(t){null!=i.SelectedItemsMap[t]&&null!==i.SelectedItemsMap[t]||null!=i.AggrItemsMap[t]&&null!==i.AggrItemsMap[t]||e.length>0&&expandedOwnershipItems.push({objectID:t,ownership:e[0].ownership})})),expandedOwnershipItems.forEach((function(t){e.push(t)}))}if(e.length<1)i._onFailure2(UWA.i18n("ShareNotValid"));else{for(var o=!1,s=0;s<e.length;s++){for(var c=0;c<e[s].ownership.length;c++)if(e[s].ownership[c].hasOwnProperty("access")&&"ReaderR"===e[s].ownership[c].access.logical){o=!0;break}if(o)break}o?i.targetAlreadyHasAccess(e,r):i.commitWithSCPCS(e,r)}},onFailure:function(e,t,n){i._perfTimer.stop("Share: getCompletedData"),i._onFailure(e,t,n),i._perfTimer.stop("CommandExecutionDurationShare"),i._perfTimer.printTime("CommandUIDurationShare"),i._perfTimer.printTime("CommandExecutionDurationShare"),i._perfTimer.printTime("Share: getCompletedData")},onTimeout:function(){i._perfTimer.stop("Share: getCompletedData"),i._onTimeout(),i._perfTimer.stop("CommandExecutionDurationShare"),i._perfTimer.printTime("CommandUIDurationShare"),i._perfTimer.printTime("CommandExecutionDurationShare"),i._perfTimer.printTime("Share: getCompletedData")}})},serverUrl:i.options.serverUrl,wintop:i.options.wintop})}else{var u={message:UWA.i18n("ErrorSecurityContextEmpty"),code:"ERROR"};i.dispatchEvent("onError",u)}},targetAlreadyHasAccess:function(e,t){for(var n=this,a=[],r=0;r<e.length;r++){for(var i=[],o=0;o<e[r].ownership.length;o++)if(e[r].ownership[o].owner.hasOwnProperty("person")){var s=e[r].ownership[o].owner.person.personID;"_PRJ"===s.substring(s.length-4,s.length)&&(s=s.substring(0,s.length-4)),i.push(s)}var c="",l="";null!=n.SelectedItemsMap[e[r].objectID]&&(c=n.SelectedItemsMap[e[r].objectID].organization,l=n.SelectedItemsMap[e[r].objectID].project);var d={objectid:e[r].objectID,organization:c,project:l,users:i};a.push(d)}this._post2("/resources/accessRightServices/ar/alreadyHasAccess",a,(function(a,r){for(var i=[],o=0;o<e.length;o++)if(a.results.hasOwnProperty(e[o].objectID)){i=a.results[e[o].objectID];for(var s=0;s<e[o].ownership.length;s++)if(e[o].ownership[s].owner.hasOwnProperty("person"))for(var c=0;c<i.length;c++){i[c]+"_PRJ"==e[o].ownership[s].owner.person.personID&&"ADD"==e[o].ownership[s].operation&&"ReaderR"==e[o].ownership[s].access.logical&&n.LifecycleConfidentialityEnabled&&(e[o].ownership[s].access.logical="Reader")}}n.commitWithSCPCS(e,t)}),(function(e){onError(e)}))},commitWithSCPCS:function(e,n){var r=this,i={Accept:"application/json","Content-Type":"application/json"};if(null!=n&&""!=n&&n.hasOwnProperty("SecurityContext")){0!=n.SecurityContext.indexOf("ctx::")&&"ctx::",i.SecurityContext=encodeURIComponent(n.SecurityContext);this.options.serverName,this.options.serverUri;this._getSecurityContext((function(n){a.get3DSpaceUrlAsync({onComplete:function(o){var s="",c=a.getRealPath("assets/validModification.json",r.widget),d="Share: pno update";2==l&&(s="passport"),2==l&&(r.options.hasOwnProperty("odtmode")&&r.options.odtmode?c=o+"/resources/pno/ownership/update":e.length>0&&0===e[0].objectID.indexOf("cid:")?(c=o+"/resources/lifecycle/ownership/update",d="Share: lifecycle update"):c=o+"/resources/pno/ownership/update");var h='{ "ownershipVector": '+t.encode(e)+"}";console.log("<<<<<<<<<<< Data to send = "+h);i["Accept-Language"]=widget.lang,i.SecurityContext=encodeURIComponent(n);var p=a.getTenantID();p&&0!=p.length?c+="?tenant="+p:c+="?tenant=OnPremise",r._perfTimer.start(d),a.partitionedAuthenticatedRequest(c,{type:"json",method:"POST",proxy:s,headers:i,cancelCallback:function(){return!1},data:h,timeout:864e5,onComplete:function(t){r._perfTimer.stop(d),r.dispatchEvent("onModificationComplete",t);var n={ov:e};r.dispatchEvent("fireWintopNotif",n)},onFailure:function(e,t,n){r._perfTimer.stop(d),r._onFailure(e,t,n),r._perfTimer.stop("CommandExecutionDurationShare"),r._perfTimer.printTime("CommandUIDurationShare"),r._perfTimer.printTime("CommandExecutionDurationShare"),r._perftime.printTime(d)},onTimeout:function(){r._perfTimer.stop(d),r._onTimeout(),r._perfTimer.stop("CommandExecutionDurationShare"),r._perfTimer.printTime("CommandUIDurationShare"),r._perfTimer.printTime("CommandExecutionDurationShare"),r._perfTimer.printTime(d)}})},serverUrl:r.options.serverUrl,wintop:r.options.wintop})}),(function(e){onError(e)}))}else{var o={message:UWA.i18n("ErrorSecurityContextEmpty"),code:"ERROR"};this.setError(o)}},getSelectedItemList:function(){return this.SelectedItems},getErrorSelectedItemList:function(){return this.ErrorExistingECAndAggrItemsMap},getAggrItemList:function(){return this.AggrItemsMap},fillInvalidList:function(e){for(var t=e.length,n=0;n<t;n++){var a=e[n];this.listOfInvalidIDs[n]=a}},getInvalidList:function(){return this.listOfInvalidIDs},getNLSAccessNameFromLogicalAccess:function(e){return this.accessLogicalNlsMap[e]},send3DNotification:function(e,n){var r=this;r._perfTimer.start("Share: send3DNotification");var o={Accept:"application/json","Content-Type":"application/json"};if(null!=n&&""!=n&&n.hasOwnProperty("SecurityContext")){0!=n.SecurityContext.indexOf("ctx::")&&"ctx::",o.SecurityContext=encodeURIComponent(n.SecurityContext),a.get3DSpaceUrlAsync({onComplete:function(n){var s=a.getRealPath("assets/transferOwnership.json",widget),c="",d="PUT",h="",p=r.parseDataFor3DNotification(e);if(2==l){s=n+"/resources/lifecycle/3dnotification/notifymoveshare";s+="?command=share&",h="passport",d="PUT",c=t.encode({requests:p})}var m=a.getTenantID();m&&(s+="tenant="+m),o["Accept-Language"]=widget.lang,i.authenticatedRequest(s,{method:d,proxy:h,type:"json",timeout:108e5,data:c,headers:o,onComplete:function(e){},onFailure:function(e,t,n){},onTimeout:function(){}})}})}else{var s={message:UWA.i18n("ErrorSecurityContextEmpty"),code:"ERROR"};this.setError(s)}},parseDataFor3DNotification:function(e){for(var t=[],n=0;n<e.length;n++)t.push({objectID:e[n].objectID,objectName:e[n].objectName,userID:e[n].userID,CSID:e[n].csID,OrgID:e[n].orgID,CSTitle:e[n].csTitle,OrgTitle:e[n].orgTitle,GrpID:e[n].grpID,GrpTitle:e[n].grpTitle,nlsAccess:e[n].nlsAccess,cestamp:e[n].cestamp});return t}})})),define("DS/ShareWidget/ShareWidget",["UWA/Core","UWA/Controls/Input","DS/UIKIT/Image","UWA/Controls/Abstract","UWA/Json","DS/WAFData/WAFData","DS/SearchWidget/SearchWidget","DS/SearchWidget/SearchWidgetConstant","DS/ErrorWidget/ErrorWidget","DS/DataGridWidget/DataGridWidget","DS/WidgetServices/WidgetServices","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/WidgetServices/CollabPerfTimer","DS/WarningWidget/WarningWidget","DS/ShareWidget/ShareController","DS/UIKIT/Input/Button","DS/UIKIT/Input/Select","DS/UIKIT/Spinner","DS/UIKIT/Input/ButtonGroup","DS/Logger/Logger","DS/WebToWinInfra/WebToWinCom","DS/Controls/Toggle","DS/UIKIT/Input/Text","UWA/Event","DS/ReportingPanel/ReportingPanel","DS/ENOCollabToolsUI/tracker/ENOCollabTracker","DS/ManageSharing/ManageSharing","css!DS/ShareWidget/ShareWidget.css","i18n!DS/ShareWidget/assets/nls/langAR"],(function(e,t,n,a,r,i,o,s,c,l,d,h,p,m,u,g,S,f,y,v,C,A,_,b,I,w,R,E,D){"use strict";UWA.debug=!0;var W=d.getProdLevel(),T="SH_MasterContain";return a.extend({defaultOptions:{className:"",ForbiddenChar:'"#$@%*,?\\<>[]|:',setValidButton:!0,setCloseButton:!0,showTopBar:!0,wintop:!1,topClassHeight:T,readOnly:"auto",displayWarningForAutoRO:!1,serverName:"",serverUri:"",activeMultisel:!0,activeComment:!1,serverUrl:""},init:function(e,t,n){if(this._parent(n),this.widget=e,this.mngSharingWidget=null,1==this.options.wintop&&(this.webToWinCom_Socket=C.createSocket({socket_id:"webinwinAccessRights_socket_"+Math.floor(1e5*Math.random()+1)}),void 0!==this.options.serverUrl&&this.options.serverUrl.length>0&&void 0!==this.options.serverUrl[0].platformId)){var a=this.options.serverUrl[0].platformId;d.setTenantID(a)}this.widgetSecurityContext={},this._perfTimer=p,this._perfTimer.init("Share"),this._perfTimer.start("CommandUIDurationShare");var r="";if(null!=e){if(e.hasOwnProperty("pad_security_ctx"))0!=(r=e.pad_security_ctx).indexOf("ctx::")&&(r="ctx::"+r);else if("function"==typeof e.hasPreference&&null!=e.getPreference("pad_security_ctx"))r=e.getPreference("pad_security_ctx").value;else if("function"==typeof e.hasPreference&&e.hasPreference("xPref_CREDENTIAL")){var i=e.getPreference("xPref_CREDENTIAL");void 0!==i.value&&null!==i.value&&i.hasOwnProperty("value")&&(r="ctx::"+i.value)}else"function"==typeof e.hasPreference&&null!=e.getPreference("securityContext")&&(r=e.getPreference("securityContext").value);r.length>0&&(this.widgetSecurityContext={SecurityContext:r})}this.isODT=!1,void 0!==typeof this.options&&null!==this.options&&this.options.hasOwnProperty("odtmode")&&(this.isODT=this.options.odtmode),W=d.getProdLevel(),this.options.activeMultisel=this.options.activeMultisel||d.isMultiSelODT(),this.options.activeComment=this.options.activeComment||d.isCommentODT(),this._initDataStructures(),this.isReadOnly=!1,this.listID=[],this.listOfIds=[],this.listOfAddedMembers=[],this.listOfValidIDs=[],this.listOfInvalidIDs=[],this.LifecycleConfidentialityEnabled=!1,this.timeStamp=this._create_UUID(),this.arDone=!1,!0===this.options.readOnly&&(this.isReadOnly=!0),this.widget=e,this.parentWidget=t,this.SearchWidget_View=[];var o=UWA.i18n("AR_Status"),s=UWA.i18n("AR_Title"),c=UWA.i18n("AR_Sum_Type"),l=UWA.i18n("AR_Revision"),h=UWA.i18n("AR_Sum_Org"),m=UWA.i18n("AR_Sum_Collab"),u=UWA.i18n("AR_Sum_Resp"),g=UWA.i18n("AR_Result");this.cols=[{text:"ID",dataIndex:"ID",isHidden:!0},{text:"StatusToolTipColumn",dataIndex:"statusTooltip",isHidden:!0,tooltipColumn:"Status"},{text:o,dataIndex:"Status",typeRepresentation:"icon"},{text:s,dataIndex:s},{text:c,dataIndex:c},{text:l,dataIndex:l},{text:h,dataIndex:h},{text:m,dataIndex:m},{text:u,dataIndex:u},{text:g,dataIndex:g}],this.initUI(),this._perfTimer.stop("CommandUIDurationShare"),this.trackerEventBeginTime=Date.now()},_initDataStructures:function(){this.objectIds={},this.listOfError=[],this.SelectedItemsWithEC=[],this.ctxObjectIds=[],this.SelectedItems=[],this.dumpSection=null,this.firstInit=!0,this.arDone=!1,this._bAddUserError=!1,this.listInputErrors=[],this.listInvalidPovOwnerErrorMsg=[],this.listInvalidPovCollabSpaceErrorMsg=[],this.containsInheritedAccess=!1,this.csoTableLines=[],void 0===this.commentBox&&(this.commentBox=null),void 0===this.textArea&&(this.textArea=null)},createWebInWinSocket:function(e){return C.createSocket({socket_id:e+Math.floor(1e5*Math.random()+1)})},fireWintopCommand:function(e,t,n){var a=[],r=n+"\n",i=[];if("onModificationAccessRights"===n){var o=null;t.hasOwnProperty("ov")&&(o=t.ov),o.forEach((function(e,t){e.hasOwnProperty("ownership")&&(i.indexOf(e.objectID)<0&&(i.push(e.objectID),e.ownership.forEach((function(e,t){var n,a=e.operation,i=e.access.logical;e.owner.hasOwnProperty("person")?n=e.owner.person.personID:e.owner.hasOwnProperty("collabSpace")&&(n=e.owner.collabSpace.collabSpaceID),r=r+" "+a+" "+i+" "+n+"\n"})),a.push(r)))}))}var s={severity:"warning",ID:i,message:a},c=C.createJSONArrayMessage(n,s);c.length>0&&e.dispatchEvent("onDispatchToWin",{notif_name:"onDisplayMessageODT",notif_parameters:c},"lf_web_in_win")},initData:function(e){this.trackAppContent(e),this.SelectedItems=[],this._initDataStructures(),this.ShareController.onLoad(),this.addDataPCS(e)},initDatafromWin:function(e){this.initData(e)},addDataPCS:function(e){var t=this;null==e&&(e=this.SelectedItems),"auto"==this.options.readOnly?h.getInstance().getSecurityContext({onSuccess:function(n){t.SelectedItemsList=e,0===e[0].physicalId.toString().indexOf("cid:")?t.widgetSecurityContext.hasOwnProperty("SecurityContext")?t._testAvailability(e,t.widgetSecurityContext):t._testAvailability(e,n):t.widgetSecurityContext.hasOwnProperty("SecurityContext")?t._doShareChecker(e,t.widgetSecurityContext):t._doShareChecker(e,n)},onFailure:function(n){t.SelectedItemsList=e,t.widgetSecurityContext.hasOwnProperty("SecurityContext")?0===e[0].physicalId.toString().indexOf("cid:")?t._testAvailability(e,t.widgetSecurityContext):t._doShareChecker(e,t.widgetSecurityContext):t.setError(n)}}):this._addDataPCS(e)},_addDataPCS:function(e){this._ManageValidButton(!1),this.hideMainErrorArea();var t=[],n=this;if(1==this.options.activeMultisel?(null!=e&&(t=e.slice()),d.removeDuplicate(t,(function(e){return e.physicalId})),t.forEach((function(e){d.arrayContains(n.SelectedItems,e,(function(e){return e.physicalId}))<0&&n.SelectedItems.push(e)}))):null!=e&&e.length>0&&(n.SelectedItems=[],n.SelectedItems.push(e[0]),t.push(e[0])),n.SelectedItems.length<=0)return 1==this.options.wintop?this.showMainErrorArea(UWA.i18n("NoItemToDisplay")):this.showMainErrorArea(UWA.i18n("NoItemSelected")),this.hideMainLoadingArea(),this.hideMainComponent(),void n.dispatchEvent("onChangeSize");this.displayLoadingArea();n.SelectedItems.length>0&&(this.options.hasOwnProperty("odtmode")&&(this.ShareController.options.odtmode=this.options.odtmode),this.ShareController._fillAttributesOfSelectedItems(n.SelectedItems,(function(e,t){e.hasOwnProperty("LifecycleConfidentialityEnabled")&&(n.LifecycleConfidentialityEnabled=e.LifecycleConfidentialityEnabled,n.ShareController.LifecycleConfidentialityEnabled=e.LifecycleConfidentialityEnabled),e.hasOwnProperty("ManageSharingEnabled")&&(0==e.ManageSharingEnabled?n.manageSharing.hide():e.ManageSharingEnabled&&n.manageSharing.show());for(var a=0;a<e.results.length;a++)e.results[a].validList.length>0&&(n.listOfValidIDs=n.listOfValidIDs.concat(e.results[a].validList)),e.results[a].invalidList.length>0&&(n.listOfInvalidIDs=n.listOfInvalidIDs.concat(e.results[a].validList));if(e.hasOwnProperty("CommandAvailability")&&!1===e.CommandAvailability)n.isReadOnly=!0,n.addError(UWA.i18n("SH_PLM_SecurityDenied")),n._updateReadOnlyDisplay();else if(0==n.listOfValidIDs.length)n.isReadOnly=!0,n.addError(UWA.i18n("ShareNotSupported")),n._updateReadOnlyDisplay();else if(n.listOfInvalidIDs.length>0){for(var r="",i=0;i<n.listOfInvalidIDs.length;i++)for(var o=0;o<n.SelectedItems.length;o++)n.listOfInvalidIDs[i]===n.SelectedItems[o].physicalId&&(null==n.SelectedItems[o].name&&null==n.SelectedItems[o].name||(r=n.SelectedItems[o].name),n.SelectedItems.splice(o,1));1==n.listOfInvalidIDs.length?0!=r.length?n.addError(UWA.i18n("ShareNotSupportedFor{0}").format(r)):n.addError(UWA.i18n("ShareNotSupportedForSomeObjects{0}").format(n.listOfInvalidIDs.length)):n.listOfInvalidIDs.length>1&&n.addError(UWA.i18n("ShareNotSupportedForSomeObjects{0}").format(n.listOfInvalidIDs.length))}n.ShareController._setValidInvalidIdList(n.listOfValidIDs,n.listOfInvalidIDs),n.ShareController._fillModels(n.SelectedItems)}),(function(e){})))},destroy:function(){this.searchWidget&&this.searchWidget.destroy(),this._parent()},addSearchBox:function(e,t){var n=this,a=n.listOfAddedMembers.length;e="  "+e;var r=UWA.createElement("span",{id:"addedItem"+a,class:"SH_AddedItemContainer"}),i=UWA.createElement("span",{class:"SH_TextForItemContainer",text:e}).inject(r);UWA.createElement("span",{id:a,class:"SH_TextForItemContainer",text:"x"}).inject(i).addEventListener("click",(function(){r.setStyle("display","none"),n.DeleteUser(this.id)})),"Viewer"===t?(n.showMember_CanView.show(),r.inject(n.showMember_CanView)):"Reader"===t?(n.showMember_CanRead.show(),r.inject(n.showMember_CanRead)):"Owner"===t?(n.showMember_CanManage.show(),r.inject(n.showMember_CanManage)):"Author"===t?(n.showMember_CanEdit.show(),r.inject(n.showMember_CanEdit)):"CanAddRemoveAttachments"===t?(n.showMember_CanAddRemoveAttachment.show(),r.inject(n.showMember_CanAddRemoveAttachment)):"Read"===t?(n.showMember_Read.show(),r.inject(n.showMember_Read)):"Add"===t?(n.showMember_Add.show(),r.inject(n.showMember_Add)):"Basic"===t?(n.showMember_Basic.show(),r.inject(n.showMember_Basic)):"ReadWrite"===t?(n.showMember_ReadWrite.show(),r.inject(n.showMember_ReadWrite)):"Remove"===t?(n.showMember_Remove.show(),r.inject(n.showMember_Remove)):"AddRemove"===t?(n.showMember_AddRemove.show(),r.inject(n.showMember_AddRemove)):"Full"===t?(n.showMember_Full.show(),r.inject(n.showMember_Full)):"Leader"===t?(n.showMember_Leader.show(),r.inject(n.showMember_Leader)):"Project Member"===t?(n.showMember_Member.show(),r.inject(n.showMember_Member)):"Project Lead"===t?(n.showMember_ProjectLead.show(),r.inject(n.showMember_ProjectLead)):"ReaderR"===t&&(n.showMember_CanReadRestriction.show(),r.inject(n.showMember_CanReadRestriction))},getSearchInput:function(e){var t=this;return o.getSearchWidget(o.RESTRICTED,{className:"share-item-view-wrapper",id:e,ForbiddenChar:this.options.ForbiddenChar,MaxNumber:"5",MaxSize:"300",topClassHeight:this.options.topClassHeight,position:"auto",serverName:this.options.serverName,serverUri:this.options.serverUri,serverUrl:this.options.serverUrl,exttype:s.EXTTYPE_USERGRP,showEmptyCategory:!1,hint:UWA.i18n("SearchPlaceHolder"),odtmode:this.options.odtmode,events:{onValid:function(){t.AddUser(e)&&(t._ManageValidButton(!0),1==t.options.activeComment&&t.searchComment.show(),t.addSearchBox(this.searchInput.getValue(),this.options.id),t.dispatchEvent("onChangeSize")),this.searchInput.setValue("")},onUnvalid:function(){1==t.options.activeComment&&t.searchComment.hide(),t.dispatchEvent("onChangeSize")},onError:function(e){t.setError(e)}}})},initUI:function(){var e=this,t=this.container=UWA.createElement("div",{name:T,"data-rec-id":T,class:T+" "+e.options.className});this.globalDiv=UWA.createElement("div",{class:"SH_GlobalContain","data-rec-id":"datarecGlobalContain"}).inject(t);var n="SH_ManageButtonDiv";this.options.wintop&&(n="SH_ManageButtonDivWintop"),this.ManageButtonDiv=UWA.createElement("table",{class:n,"data-rec-id":"datarecManageButtonDiv",html:{}}),e.ManageButtonRight=UWA.createElement("td",{class:"SH_ManageButtonRight","data-rec-id":"datarecManageButtonRight"}),e.ManageButtonLeft=UWA.createElement("td",{class:"SH_ManageButtonLeft","data-rec-id":"datarecManageButtonLeft"}),e.loadingArea=new f({visible:!1});var a=null;e.boutonValid=new g({attributes:{title:UWA.i18n("")},name:"TopButtonValid",value:UWA.i18n("AR_mainTile"),className:"default medium AR_buttonTop primary",disabled:!0});var r=e.boutonValid.getContent();null!=r&&r.setAttribute("data-rec-id","boutonValid"),a=new g({attributes:{title:UWA.i18n(""),"data-rec-id":"datarecButtonCancel"},name:"TopButtonCancel",value:UWA.i18n("AR_CloseOverlay"),className:"default medium AR_buttonTop"}),e.boutonValid.addEvents({onClick:function(){e._perfTimer.start("CommandExecutionDurationShare"),e._ManageValidButton(!1),e.displayLoadingArea(),e.modifyDataPCS(),a.setValue(UWA.i18n("AR_Close"))}}),a.addEvents({onClick:function(){e._ManageValidButton(!1),e.dispatchEvent("onCancel"),e._perfTimer.printTime("CommandUIDurationShare")}}),e.loadingArea.inject(e.ManageButtonRight),e.mainInterface=UWA.createElement("div",{class:"SH_MainInterface","data-rec-id":"datarecMainInterface"}).inject(this.globalDiv).hide(),0==this.isReadOnly&&1==e.options.setValidButton&&e.boutonValid.inject(e.ManageButtonRight),1==e.options.setCloseButton&&a.inject(e.ManageButtonRight),e.ManageButtonLeft.inject(this.ManageButtonDiv),e.ManageButtonRight.inject(this.ManageButtonDiv),e.options.showTopBar&&this.ManageButtonDiv.inject(e.globalDiv),e.mainInterface=UWA.createElement("div",{class:"SH_MainInterface","data-rec-id":"datarecMainInterface"}).inject(this.globalDiv).hide(),e.mainLoading=UWA.createElement("div",{class:"SH_MainLoading","data-rec-id":"datarecMainLoading"}).inject(this.globalDiv),e.mainError=UWA.createElement("div",{class:"SH_MainError","data-rec-id":"datarecMainError"}).inject(this.globalDiv).hide(),e.copyLink=new _({placeholder:"link",rows:1}),e.copyLink.inject(this.globalDiv).hide(),e.addMemberPanel=UWA.createElement("div",{class:"shareaddmember-item-view-container expanded"}).inject(e.mainLoading),e.manageSharingContent=UWA.createElement("div",{class:"MNG_SH-content",id:"enolcm-sharing-simple-content"}).inject(e.mainLoading),e.manageSharingContent.hide(),e.manageSharing=UWA.createElement("div",{class:"MNG_SH-expander",id:"enolcm-dup-simple-expander",text:"Manage Sharing >"}).inject(e.mainLoading),e.manageSharing.setStyle("padding-left","80%"),e.manageSharing.hide(),e.manageSharing.addEventListener("click",(function(){e.addMemberPanel.hide(),e.manageSharing.setStyle("display","none"),e.manageSharingContent.show(),a.setValue(UWA.i18n("AR_Close")),e.boutonValid.hide(),e.ManageButtonRight.setStyle("display","inline"),e.globalDiv.setStyle("overflow","hidden");var t=e.widget.body.getSize().height-25,n=e.widget.getElement(".SHP_PopupDial").getSize().height<=470?t:470;e.widget.getElement(".SHP_PopupDial").setStyle("height",n),e.widget.getElement(".SHP_PopupDial").setStyle("top","5px");var r=e.widget.getElement(".modal-content").getSize().height-e.widget.getElement(".modal-header").getSize().height-e.widget.getElement(".modal-footer").getSize().height-20;if(e.widget.getElement(".SH_MainLoading").setStyle("height",r),null==e.mngSharingWidget){var i={};i.appId=e.widget.data.appId,i.className="MNG_SH-content";var o="";e.widgetSecurityContext.hasOwnProperty("SecurityContext")&&(o=e.widgetSecurityContext.SecurityContext),i.context={},i.context.securityContextFromAppPreference=o,i.securityContextFromAppPreference=o,i.sourceAppId=e.widget.id,i.tenant=d.getTenantID(),i.flagShareDialogLaunch=!0,e.mngSharingWidget=new R(i),e.mngSharingWidget.inject(e.manageSharingContent),e.mngSharingWidget.shareInfo=e.ShareController,e.mngSharingWidget.updateFacet()}})),e.memberPanel=UWA.createElement("div",{class:"shareaddmember-item-view-body","data-rec-id":"datarecMemberPanel"}).inject(e.addMemberPanel),e.addMemberPanel=UWA.createElement("div",{class:"share-item-view-container highlighted","data-rec-id":"c10"}).inject(e.memberPanel),e.tableAddMember=UWA.createElement("table").inject(e.addMemberPanel),e.addMEmberContainer=UWA.createElement("tbody").inject(e.tableAddMember);e.options.ForbiddenChar;this.searchIconArr=[],e.canReadRestriction=UWA.createElement("tr",{class:"tr-canReadRestriction"}).inject(e.addMEmberContainer),e.canReadRestrictionTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.canReadRestriction),e.canReadRestrictionLabel=UWA.createElement("span",{id:"canReadRestriction-label",text:D.get("CanReadRestriction")}).inject(e.canReadRestrictionTD),e.canReadRestrictionHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:D.get("CanReadRestrictionHelp")}).inject(e.canReadRestrictionTD),e.canReadRestrictionLabel.setStyle("text-align","left"),e.canReadRestrictionLabel.setStyle("font-family","arial"),e.canReadRestrictionLabel.setStyle("font-size","12px"),e.canReadRestrictionSearchTD=UWA.createElement("td").inject(e.canReadRestriction),e.showMember_CanReadRestriction=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_ReadeRestrictionr"}).inject(e.canReadRestrictionSearchTD).hide(),e.searchWidget_CanReadRestriction=e.getSearchInput("ReaderR").inject(e.canReadRestrictionSearchTD),e.searchWidget_CanReadRestriction.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.canView=UWA.createElement("tr",{class:"tr-canView"}).inject(e.addMEmberContainer),e.canViewTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.canView),e.canViewLabel=UWA.createElement("span",{id:"canView-label",text:D.get("CanView")}).inject(e.canViewTD),e.canViewHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:D.get("CanViewHelp")}).inject(e.canViewTD),e.canViewLabel.setStyle("text-align","left"),e.canViewLabel.setStyle("font-family","arial"),e.canViewLabel.setStyle("font-size","12px"),e.canViewSearchTD=UWA.createElement("td").inject(e.canView),e.showMember_CanView=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_Viewer"}).inject(e.canViewSearchTD).hide(),e.searchWidget_CanView=e.getSearchInput("Viewer").inject(e.canViewSearchTD),e.searchWidget_CanView.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.canRead=UWA.createElement("tr",{class:"tr-canRead"}).inject(e.addMEmberContainer),e.canReadTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.canRead),e.canReadLabel=UWA.createElement("span",{id:"canRead-label",text:D.get("CanRead")}).inject(e.canReadTD),e.canReadHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:D.get("CanReadHelp")}).inject(e.canReadTD),e.canReadLabel.setStyle("text-align","left"),e.canReadLabel.setStyle("font-family","arial"),e.canReadLabel.setStyle("font-size","12px"),e.canReadSearchTD=UWA.createElement("td").inject(e.canRead),e.showMember_CanRead=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_Reader"}).inject(e.canReadSearchTD).hide(),e.searchWidget_CanRead=e.getSearchInput("Reader").inject(e.canReadSearchTD),e.searchWidget_CanRead.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.canEdit=UWA.createElement("tr",{class:"tr-canEdit"}).inject(e.addMEmberContainer),e.canEditTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.canEdit),e.canEditLabel=UWA.createElement("span",{id:"canEdit-label",text:D.get("CanEdit")}).inject(e.canEditTD),e.canEditHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:D.get("CanEditHelp")}).inject(e.canEditTD),e.canEditLabel.setStyle("text-align","left"),e.canEditLabel.setStyle("font-family","arial"),e.canEditLabel.setStyle("font-size","12px"),e.canEditSearchTD=UWA.createElement("td").inject(e.canEdit),e.showMember_CanEdit=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_Author"}).inject(e.canEditSearchTD).hide(),e.searchWidget_CanEdit=e.getSearchInput("Author").inject(e.canEditSearchTD),e.searchWidget_CanEdit.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.canManage=UWA.createElement("tr",{class:"tr-canManage"}).inject(e.addMEmberContainer),e.canManageTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.canManage),e.canManageLabel=UWA.createElement("span",{id:"canManage-label",text:D.get("CanManage")}).inject(e.canManageTD),e.canManageHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:D.get("CanManageHelp")}).inject(e.canManageTD),e.canManageLabel.setStyle("text-align","left"),e.canManageLabel.setStyle("font-family","arial"),e.canManageLabel.setStyle("font-size","12px"),e.canManageSearchTD=UWA.createElement("td").inject(e.canManage),e.showMember_CanManage=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_Owner"}).inject(e.canManageSearchTD).hide(),e.searchWidget_CanManage=e.getSearchInput("Owner").inject(e.canManageSearchTD),e.searchWidget_CanManage.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.leader=UWA.createElement("tr",{class:"tr-leader"}).inject(e.addMEmberContainer),e.leaderTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.leader),e.leaderLabel=UWA.createElement("span",{id:"leader-label",text:D.get("Leader")}).inject(e.leaderTD),e.leaderHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:D.get("LeaderHelp")}).inject(e.leaderTD),e.leaderLabel.setStyle("text-align","left"),e.leaderLabel.setStyle("font-family","arial"),e.leaderLabel.setStyle("font-size","12px"),e.leaderSearchTD=UWA.createElement("td").inject(e.leader),e.showMember_Leader=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_Leader"}).inject(e.leaderSearchTD).hide(),e.searchWidget_Leader=e.getSearchInput("Leader").inject(e.leaderSearchTD),e.searchWidget_Leader.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.projectLead=UWA.createElement("tr",{class:"tr-projectLead"}).inject(e.addMEmberContainer),e.projectLeadTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.projectLead),e.projectLeadLabel=UWA.createElement("span",{id:"projectLead-label",text:D.get("ProjectLead")}).inject(e.projectLeadTD),e.projectLeadHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:D.get("ProjectLeadHelp")}).inject(e.projectLeadTD),e.projectLeadLabel.setStyle("text-align","left"),e.projectLeadLabel.setStyle("font-family","arial"),e.projectLeadLabel.setStyle("font-size","12px"),e.projectLeadSearchTD=UWA.createElement("td").inject(e.projectLead),e.showMember_ProjectLead=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_ProjectLead"}).inject(e.projectLeadSearchTD).hide(),e.searchWidget_ProjectLead=e.getSearchInput("Project Lead").inject(e.projectLeadSearchTD),e.searchWidget_ProjectLead.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.member=UWA.createElement("tr",{class:"tr-member"}).inject(e.addMEmberContainer),e.memberTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.member),e.memberLabel=UWA.createElement("span",{id:"member-label",text:D.get("Member")}).inject(e.memberTD),e.memberHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:D.get("MemberHelp")}).inject(e.memberTD),e.memberLabel.setStyle("text-align","left"),e.memberLabel.setStyle("font-family","arial"),e.memberLabel.setStyle("font-size","12px"),e.memberSearchTD=UWA.createElement("td").inject(e.member),e.showMember_Member=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_Member"}).inject(e.memberSearchTD).hide(),e.searchWidget_Member=e.getSearchInput("Project Member").inject(e.memberSearchTD),e.searchWidget_Member.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.canAddRemoveAttachment=UWA.createElement("tr",{class:"tr-canAddRemoveAttachment"}).inject(e.addMEmberContainer),e.canAddRemoveAttachmentTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.canAddRemoveAttachment),e.canAddRemoveAttachmentLabel=UWA.createElement("span",{id:"canAddRemoveAttachment-label",text:D.get("CanAddRemoveAttachments")}).inject(e.canAddRemoveAttachmentTD),e.canAddRemoveAttachmentHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:D.get("CanAddRemoveAttachmentHelp")}).inject(e.canAddRemoveAttachmentTD),e.canAddRemoveAttachmentLabel.setStyle("text-align","left"),e.canAddRemoveAttachmentLabel.setStyle("font-family","arial"),e.canAddRemoveAttachmentLabel.setStyle("font-size","12px"),e.canAddRemoveAttachmentSearchTD=UWA.createElement("td").inject(e.canAddRemoveAttachment),e.showMember_CanAddRemoveAttachment=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_CanAddRemoveAttachments"}).inject(e.canAddRemoveAttachmentSearchTD).hide(),e.searchWidget_CanAddRemoveAttachment=e.getSearchInput("CanAddRemoveAttachments").inject(e.canAddRemoveAttachmentSearchTD),e.searchWidget_CanAddRemoveAttachment.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.read=UWA.createElement("tr",{class:"tr-read"}).inject(e.addMEmberContainer),e.readTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.read),e.readLabel=UWA.createElement("span",{id:"read-label",text:D.get("Read")}).inject(e.readTD),e.readHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:D.get("ReadHelp")}).inject(e.readTD),e.readLabel.setStyle("text-align","left"),e.readLabel.setStyle("font-family","arial"),e.readLabel.setStyle("font-size","12px"),e.readSearchTD=UWA.createElement("td").inject(e.read),e.showMember_Read=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_Viewer"}).inject(e.readSearchTD).hide(),e.searchWidget_Read=e.getSearchInput("Read").inject(e.readSearchTD),e.searchWidget_Read.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.add=UWA.createElement("tr",{class:"tr-add"}).inject(e.addMEmberContainer),e.addTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.add),e.addLabel=UWA.createElement("span",{id:"add-label",text:D.get("Add")}).inject(e.addTD),e.addHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:D.get("AddHelp")}).inject(e.addTD),e.addLabel.setStyle("text-align","left"),e.addLabel.setStyle("font-family","arial"),e.addLabel.setStyle("font-size","12px"),e.addSearchTD=UWA.createElement("td").inject(e.add),e.showMember_Add=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_Viewer"}).inject(e.addSearchTD).hide(),e.searchWidget_Add=e.getSearchInput("Add").inject(e.addSearchTD),e.searchWidget_Add.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.basic=UWA.createElement("tr",{class:"tr-basic"}).inject(e.addMEmberContainer),e.basicTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.basic),e.basicLabel=UWA.createElement("span",{id:"basic-label",text:D.get("Basic")}).inject(e.basicTD),e.basicHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:D.get("BasicHelp")}).inject(e.basicTD),e.basicLabel.setStyle("text-align","left"),e.basicLabel.setStyle("font-family","arial"),e.basicLabel.setStyle("font-size","12px"),e.basicSearchTD=UWA.createElement("td").inject(e.basic),e.showMember_Basic=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_Viewer"}).inject(e.basicSearchTD).hide(),e.searchWidget_Basic=e.getSearchInput("Basic").inject(e.basicSearchTD),e.searchWidget_Basic.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.readWrite=UWA.createElement("tr",{class:"tr-readWrite"}).inject(e.addMEmberContainer),e.readWriteTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.readWrite),e.readWriteLabel=UWA.createElement("span",{id:"readWrite-label",text:D.get("ReadWrite")}).inject(e.readWriteTD),e.readWriteHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:D.get("ReadWriteHelp")}).inject(e.readWriteTD),e.readWriteLabel.setStyle("text-align","left"),e.readWriteLabel.setStyle("font-family","arial"),e.readWriteLabel.setStyle("font-size","12px"),e.readWriteSearchTD=UWA.createElement("td").inject(e.readWrite),e.showMember_ReadWrite=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_Viewer"}).inject(e.readWriteSearchTD).hide(),e.searchWidget_ReadWrite=e.getSearchInput("ReadWrite").inject(e.readWriteSearchTD),e.searchWidget_ReadWrite.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.remove=UWA.createElement("tr",{class:"tr-remove"}).inject(e.addMEmberContainer),e.removeTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.remove),e.removeLabel=UWA.createElement("span",{id:"remove-label",text:D.get("Remove")}).inject(e.removeTD),e.removeHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:D.get("RemoveHelp")}).inject(e.removeTD),e.removeLabel.setStyle("text-align","left"),e.removeLabel.setStyle("font-family","arial"),e.removeLabel.setStyle("font-size","12px"),e.removeSearchTD=UWA.createElement("td").inject(e.remove),e.showMember_Remove=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_Viewer"}).inject(e.removeSearchTD).hide(),e.searchWidget_Remove=e.getSearchInput("Remove").inject(e.removeSearchTD),e.searchWidget_Remove.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.addRemove=UWA.createElement("tr",{class:"tr-addRemove"}).inject(e.addMEmberContainer),e.addRemoveTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.addRemove),e.addRemoveLabel=UWA.createElement("span",{id:"addRemove-label",text:D.get("AddRemove")}).inject(e.addRemoveTD),e.addRemoveHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:D.get("addRemoveHelp")}).inject(e.addRemoveTD),e.addRemoveLabel.setStyle("text-align","left"),e.addRemoveLabel.setStyle("font-family","arial"),e.addRemoveLabel.setStyle("font-size","12px"),e.addRemoveSearchTD=UWA.createElement("td").inject(e.addRemove),e.showMember_AddRemove=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_Viewer"}).inject(e.addRemoveSearchTD).hide(),e.searchWidget_AddRemove=e.getSearchInput("AddRemove").inject(e.addRemoveSearchTD),e.searchWidget_AddRemove.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.full=UWA.createElement("tr",{class:"tr-full"}).inject(e.addMEmberContainer),e.fullTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.full),e.fullLabel=UWA.createElement("span",{id:"full-label",text:D.get("Full")}).inject(e.fullTD),e.fullHelp=UWA.createElement("span",{class:"SH_HelpIcon fonticon fonticon-help ",title:D.get("FullHelp")}).inject(e.fullTD),e.fullLabel.setStyle("text-align","left"),e.fullLabel.setStyle("font-family","arial"),e.fullLabel.setStyle("font-size","12px"),e.fullSearchTD=UWA.createElement("td").inject(e.full),e.showMember_Full=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_Viewer"}).inject(e.fullSearchTD).hide(),e.searchWidget_Full=e.getSearchInput("Full").inject(e.fullSearchTD),e.searchWidget_Full.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none"),e.canEditSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.canReadSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.canViewSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.canManageSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.canAddRemoveAttachmentSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.readSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.addSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.basicSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.readWriteSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.removeSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.addRemoveSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.fullSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.leaderSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.memberSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.projectLeadSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.canReadRestrictionSearchTD.getElementsByClassName("SW_SearchInput form-control form-control-root")[0].setStyle("font-size","12px"),e.canRead.hide(),e.canManage.hide(),e.canEdit.hide(),e.canView.hide(),e.leader.hide(),e.canAddRemoveAttachment.hide(),e.read.hide(),e.add.hide(),e.basic.hide(),e.readWrite.hide(),e.remove.hide(),e.addRemove.hide(),e.full.hide(),e.member.hide(),e.projectLead.hide(),e.canReadRestriction.hide();e.selectRightNewUser=new S({nativeSelect:!0,placeholder:!1}),e.selectRightNewUser.elements.container.setAttribute("data-rec-id","dataRecselectRightNewUserContainer"),e.selectRightNewUser.elements.content.setAttribute("data-rec-id","dataRecselectRightNewUser"),e.errorOverlay=new c(e.widget,e.container,{className:"errorComponent_AccessRight","data-rec-id":"datarecErrorComponentAccessRight"}),this.ShareController=new u(e.widget,{uniqueRightList:!this.isReadOnly,serverName:this.options.serverName,wintop:this.options.wintop,serverUri:this.options.serverUri,serverUrl:this.options.serverUrl,isReadOnly:this.isReadOnly,odtMode:this.isODT,parent:this,contextArea2:this.ManageButtonLeft,progressBarWaitContext:e.container,events:{onError:function(t){e.hideFailMainLoadingArea(),e.addError(t)},onError2:function(t){e.hideFailMainLoadingArea(),e.hideMainLoadingArea(),e.addError(t)},onWarning:function(t){e.addError(t)},onDataLoaded:function(){if(null!=e.container.getParent()){e.hideMainLoadingArea();var t=e.ShareController.getFormattedRightList();e.selectRightNewUser.add(t,!0),t.length>0&&(e.selectRightNewUser.setValue(t[0]),t.forEach((function(t){"Reader"===t.value?e.canRead.show():"Owner"===t.value?e.canManage.show():"Author"===t.value?e.canEdit.show():"Viewer"===t.value?e.canView.show():"Read"===t.value?e.read.show():"Add"===t.value?e.add.show():"Basic"===t.value?e.basic.show():"Read Write"===t.value?e.readWrite.show():"Remove"===t.value?e.remove.show():"Add Remove"===t.value?e.addRemove.show():"Full"===t.value?e.full.show():"CanAddRemoveAttachments"===t.value?e.canAddRemoveAttachment.show():"Leader"===t.value?e.leader.show():"Project Member"===t.value?e.member.show():"Project Lead"===t.value?e.projectLead.show():"ReaderR"===t.value&&e.LifecycleConfidentialityEnabled&&e.canReadRestriction.show()})));var n=e.selectRightNewUser.elements.container.childNodes[0].childNodes;if(n.forEach)n.forEach((function(e,t){e.setAttribute("data-rec-id","dataRecComboRightsValue"+t)}));else Array.prototype.slice.call(n).forEach((function(e,t){e.setAttribute("data-rec-id","dataRecComboRightsValue"+t)}));e.searchWidget_CanView.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),e.searchWidget_CanRead.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),e.searchWidget_CanManage.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),e.searchWidget_CanEdit.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),e.searchWidget_CanAddRemoveAttachment.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),e.searchWidget_Read.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),e.searchWidget_Add.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),e.searchWidget_Basic.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),e.searchWidget_ReadWrite.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),e.searchWidget_Remove.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),e.searchWidget_AddRemove.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),e.searchWidget_Full.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),e.searchWidget_Leader.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),e.searchWidget_Member.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),e.searchWidget_ProjectLead.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),e.searchWidget_CanReadRestriction.setSelectedItemList(e.ShareController.getCurrentSelectedItems()),!0===e.firstInit&&(e.dispatchEvent("onFirstBuild"),e.firstInit=!1)}},onModificationComplete:function(t){e.hideLoadingArea(),e.showErrorReporting(t,this.SelectedItems),e._ManageValidButton(!1),e._perfTimer.stop("CommandExecutionDurationShare");var n="";null!=e.widgetSecurityContext&&""!=e.widgetSecurityContext&&e.widgetSecurityContext.SecurityContext&&(n=e.widgetSecurityContext.SecurityContext);e._perfTimer.printTimeShowDialogAndProcess(["CommandUIDurationShare","CommandExecutionDurationShare","Share: isTypeSupportedToCommand","Share: filterValidSCs","Share: pno logicalaccess","Share: lifecycle logicalaccess","Share: getCompletedData","Share: pno update","Share: lifecycle update","Share: pno checkaccess","Share: lifecycle checkaccess","Share: ar shareChecker","Share: lifecycle shareChecker","Share: person"],n)},fireWintopNotif:function(t){!0===e.options.wintop&&e.fireWintopCommand(e.webToWinCom_Socket,t,"onModificationAccessRights")}}}),this._ManageValidButton()},_updateReadOnlyDisplay:function(){1==this.isReadOnly?(null!=this.boutonValid&&this.boutonValid.hide(),null!=this.memberPanel&&this.memberPanel.hide(),null!=this.manageSharing&&this.manageSharing.hide(),this.hideLoadingArea(),this.ManageButtonRight.setStyle("display","block")):null!=this.boutonValid&&this.boutonValid.show()},_ManageValidButton:function(e){var t=this.createJSONArrayModif(),n=e;null!=e&&void 0!==typeof e||(n=t.length>0),n?this.boutonValid.setDisabled(!1):this.boutonValid.setDisabled(!0)},getTopBar:function(){return this.ManageButtonDiv},showErrorReporting:function(e,t){var n=this,a=[],r=[];if(e&&e.ownershipVector)for(var i=e.ownershipVector.length,o=0;o<i;o++){var s=[],c=e.ownershipVector[o];if(c){var l=c.ownership,d="access right success",h=!1;0==n.isODT&&(d=UWA.i18n("accessRightSuccess"));for(var p=0;p<l.length;p++){var m=l[p];if(m.hasOwnProperty("result")){d="access right failure",0==n.isODT&&(d=m.result.message),h=!0;break}}for(var u=0;u<t.length;u++){var g="",S="";if(n.options.odtmode?(g=t[u].physicalId,S=t[u].name):(g=t[u].getID(),S=t[u].getName()),g===e.ownershipVector[o].objectID){t[u].status=d,s.push(g),h?(s.push(UWA.i18n("Share_Fail_Status")),s.push("Failed")):(s.push(UWA.i18n("Share_Success_Status")),s.push("Success")),s.push(S),s.push(t[u].typeDisplayName),s.push(t[u].Revision),s.push(t[u].organizationTitle),s.push(t[u].collabSpaceTitle),s.push(t[u].responsibleName),s.push(d),a.push(s);for(var f=e.ownershipVector[o].objectID,y=c.ownership,v=0;v<y.length;v++){var C=l[v],A={},_="",b="",w="",R="";if(C.access&&C.access.logical){var E=C.access.logical;R=n.ShareController.getNLSAccessNameFromLogicalAccess(E)}var W=n.timeStamp;C.owner.person&&(_=(_=C.owner.person.personID).replace("_PRJ",""));var T="",x="";C.owner.collabSpace&&(b=C.owner.collabSpace.collabSpaceID,w=C.owner.collabSpace.collabSpaceTitle,C.owner.organization&&(T=C.owner.organization.orgID,x=C.owner.organization.orgTitle));var L="",M="";C.owner.group&&(L=C.owner.group.groupURI,M=C.owner.group.groupTitle);var O="";O=n.options.odtmode?t[u].name:t[u].getName(),A.objectID=f,A.objectName=O,A.userID=_,A.csID=b,A.csTitle=w,A.orgID=T,A.orgTitle=x,A.grpID=L,A.grpTitle=M,A.nlsAccess=R,A.cestamp=W,r.push(A)}}}}}var j=n.ShareController.getInvalidList();if(j.length>0)for(u=0;u<t.length;u++){s=[],g="",S="";if(n.options.odtmode?(g=t[u].physicalId,S=t[u].name):(g=t[u].getID(),S=t[u].getName()),-1!=j.indexOf(g)){d=D.get("ShareCheckerBlockedMessage");t[u].status=d,s.push(g),s.push(UWA.i18n("Share_Fail_Status")),s.push("Failed"),s.push(S),s.push(t[u].typeDisplayName),s.push(t[u].Revision),s.push(t[u].organizationTitle),s.push(t[u].collabSpaceTitle),s.push(t[u].responsibleName),s.push(d),a.push(s)}}n.send3DNotification(r),I.launchReportingPanel(a,n.cols,null),n.dispatchEvent("onCancel")},setError:function(e){var t={};"object"==typeof e?"1500028"===e.code?(e.message=UWA.i18n("ErrorNotAccessRight"),t=e):e.hasOwnProperty("errorCode")&&"FS_INVALID_QUERY__NOT_AUTHORIZED_QUERY__WILDCARD"===e.errorCode?(t.code=e.errorCode,t.message=D.get("FS_INVALID_QUERY__NOT_AUTHORIZED_QUERY__WILDCARD")):t=e:t=e,this.addError(t)},addError:function(e){this.errorOverlay.displayJSONError(r.encode(e))},displayLoadingArea:function(){this.loadingArea.show(),this.loadingArea.elements.container.setStyle("display","flex")},hideLoadingArea:function(){this.loadingArea.hide()},hideMainComponent:function(){this.hideLoadingArea(),this.mainInterface.hide(),this.boutonValid.hide()},hideMainLoadingArea:function(){this.loadingArea.hide()},hideFailMainLoadingArea:function(){this.mainLoading.hide()},hideMainErrorArea:function(){this.mainError.hide()},showMainErrorArea:function(e){null!=e&&""!=e&&(this.clearAllMainError(),this.addMainError(e)),this.mainError.show()},addMainError:function(e){new UWA.createElement("div",{text:e}).inject(this.mainError)},clearAllMainError:function(){this.mainError.setContent("")},ownerAlreadyExist:function(e){var t=[],n=!1;return this.listOfAddedMembers.every((function(a,r){var i=a.ownership.owner;if(i.hasOwnProperty("person")||e.hasOwnProperty("person")){if(!i.hasOwnProperty("person")||!e.hasOwnProperty("person"))return!0;if(i.person.personID!=e.person.personID)return!0}if(i.hasOwnProperty("collabSpace")||e.hasOwnProperty("collabSpace")){if(!i.hasOwnProperty("collabSpace")||!e.hasOwnProperty("collabSpace"))return!0;if(i.collabSpace.collabSpaceID!=e.collabSpace.collabSpaceID)return!0}if(i.hasOwnProperty("organization")||e.hasOwnProperty("organization")){if(!i.hasOwnProperty("organization")||!e.hasOwnProperty("organization"))return!0;if(i.organization.orgID!=e.organization.orgID)return!0}if(i.hasOwnProperty("group")||e.hasOwnProperty("group")){if(!i.hasOwnProperty("group")||!e.hasOwnProperty("group"))return!0;if(i.group.groupURI!=e.group.groupURI)return!0}return(i.hasOwnProperty("comment")||e.hasOwnProperty("comment"))&&i.hasOwnProperty("comment")&&e.hasOwnProperty("comment")&&i.comment==e.comment&&(n=!0),t.push({Index:r,IsSame:n}),!0})),t},modifyDataPCS:function(){var e=this,t=e.createJSONArrayModif(),n=[],a=new Array,r=e.ShareController.getSelectedItemList(),i=e.ShareController.getErrorSelectedItemList(),o=e.ShareController.getInvalidList();if(i.length!==r.length){var s=[];r.forEach((function(t){if(null==i[t]){-1==(e.options.odtmode?o.indexOf(t.physicalId):o.indexOf(t.getID()))&&s.push(t)}})),s.forEach((function(r,i){var o=new Array;r.hasOwnProperty("embeddedComp")&&!0===r.embeddedComp||(t.forEach((function(t){var n=t.operation;e.ShareController.isInherited(r.physicalId,n.owner)||o.push(n)})),a.push(r.physicalId),n.push({objectID:r.physicalId,ownership:o}))})),h.getInstance().getSecurityContext({onSuccess:function(t){e.widgetSecurityContext.hasOwnProperty("SecurityContext")?e.ShareController.modifyDataWithSC(n,a,e.widgetSecurityContext):e.ShareController.modifyDataWithSC(n,a,t)},onFailure:function(t){e.widgetSecurityContext.hasOwnProperty("SecurityContext")?e.ShareController.modifyDataWithSC(n,a,e.widgetSecurityContext):e.setError(t)}})}},_onFailure:function(e,t,n,a,i,o){this.hideLoadingArea(),r.isJson(t)&&(t=r.decode(t));var s={};s=null!=t&&t.hasOwnProperty("error")?t.error:{message:UWA.i18n("AR_ErrorModification"),code:"ERROR"},this.setError(s)},_onTimeout:function(){this.hideLoadingArea();var e={message:UWA.i18n("ErrorTimeOut"),code:"TO"};this.setError(e)},_testAvailability:function(e,t){var n=this,a={Accept:"application/json","Content-Type":"application/json"};if(null==t||""==t||!t.hasOwnProperty("SecurityContext")){var i={message:UWA.i18n("ErrorSecurityContextEmpty"),code:"ERROR"};return this.setError(i),this.isReadOnly=!0,this._updateReadOnlyDisplay(),void this._addDataPCS(e)}t.SecurityContext.indexOf("ctx::"),a.SecurityContext=encodeURIComponent(t.SecurityContext);var o=[],s=e.length;s>10&&(s=10);for(var c=n.ShareController.getInvalidList(),l=0;l<s;l++){var h=e[l];-1==c.indexOf(h.physicalId)&&o.push({objectID:h.physicalId,accessRight:[{access:{physical:"changesov"}}]})}this.options.serverName,this.options.serverUri;d.get3DSpaceUrlAsync({onComplete:function(t){var i="",s="GET",c="",l=d.getRealPath("assets/availability.json",n.widget);2==W&&(c="passport");var h="Share: pno checkaccess";2==W&&(n.options.hasOwnProperty("odtmode")&&n.options.odtmode?l=t+"/resources/pno/ownership/checkaccess":0===o[0].objectID.indexOf("cid:")?(l=t+"/resources/lifecycle/ownership/checkaccess",h="Share: lifecycle checkaccess"):l=t+"/resources/pno/ownership/checkaccess",s="POST",i='{ "boAccessRights": '+r.encode(o)+"}"),a["Accept-Language"]=widget.lang;var p=d.getTenantID();p&&0!=p.length?l+="?tenant="+p:l+="?tenant=OnPremise",n._perfTimer.start(h);d.partitionedAuthenticatedRequest(l,{type:"json",method:s,proxy:c,progressBarWaitContext:n.container,data:i,headers:a,onComplete:function(t){n._perfTimer.stop(h),n.reponse=t,n._onCompleteAvailability(t,e)},onFailure:function(t,a,r){n._perfTimer.stop(perftType),n._onFailureAvailability(t,a,r,e)},onTimeout:function(){n._perfTimer.stop(h),n._onTimeoutAvailability(e)}})},serverUrl:n.options.serverUrl,wintop:n.options.wintop})},_doShareChecker:function(e,t){var n=this,a=e,i={Accept:"application/json","Content-Type":"application/json"};if(null==t||""==t||!t.hasOwnProperty("SecurityContext")){var o={message:UWA.i18n("ErrorSecurityContextEmpty"),code:"ERROR"};return this.setError(o),this.isReadOnly=!0,this._updateReadOnlyDisplay(),void this._addDataPCS(e)}t.SecurityContext.indexOf("ctx::"),i.SecurityContext=encodeURIComponent(t.SecurityContext);var s=[],c=e.length;c>10&&(c=10);for(var l=0;l<c;l++){var h=e[l];s.push({objectID:h.physicalId})}this.options.serverName,this.options.serverUri;d.get3DSpaceUrlAsync({onComplete:function(o){var c="",l="GET",h="",p=d.getRealPath("assets/availability.json",n.widget);2==W&&(h="passport");var m="Share: ar shareChecker";2==W&&(n.options.hasOwnProperty("odtmode")&&n.options.odtmode?p=o+"/resources/accessRightServices/ar/shareChecker":0===s[0].objectID.indexOf("cid:")?(p=o+"/resources/lifecycle/ownership/checkaccess",m="Share: lifecycle shareChecker"):p=o+"/resources/accessRightServices/ar/shareChecker",l="POST",c=r.encode({requests:s})),i["Accept-Language"]=widget.lang;var u=d.getTenantID();u&&0!=u.length?p+="?tenant="+u:p+="?tenant=OnPremise",n._perfTimer.start(m);d.partitionedAuthenticatedRequest(p,{type:"json",method:l,proxy:h,progressBarWaitContext:n.container,data:c,headers:i,onComplete:function(r){if(n._perfTimer.stop(m),null!=r.results[0].invalidList&&r.results[0].invalidList.length>0){var i;if((i=r.results[0].invalidList).length==e.length){n.isReadOnly=!0,n.hideLoadingArea();var o={message:UWA.i18n("ShareCheckerBlockedMessage"),code:"TO"};return n.setError(o),void n._updateReadOnlyDisplay()}n.ShareController.fillInvalidList(i),n._testAvailability(a,t)}else n._testAvailability(a,t)},onFailure:function(t,a,r){n._perfTimer.stop(m),n._onFailureAvailability(t,a,r,e)},onTimeout:function(){n._perfTimer.stop(m),n._onTimeoutAvailability(e)}})},serverUrl:n.options.serverUrl,wintop:n.options.wintop})},_onTimeoutAvailability:function(e){this.isReadOnly=!0,this.hideLoadingArea();var t={message:UWA.i18n("ErrorTimeOut"),code:"TO"};this.setError(t),this._updateReadOnlyDisplay(),this._addDataPCS(e)},_onFailureAvailability:function(e,t,n,a){this.isReadOnly=!0,this.hideLoadingArea();var i={};r.isJson(t)&&(t=r.decode(t)),i=null!=t&&t.hasOwnProperty("error")?t.error:{message:UWA.i18n("UnknownError"),code:"ERROR"},this.setError(i),this._updateReadOnlyDisplay(),this._addDataPCS(a)},_onCompleteAvailability:function(e,t){var n=this;if(1==e.success){this.isReadOnly=!1;var a=0;if(e.hasOwnProperty("boAccessRights")){var r=e.boAccessRights,i={};r.forEach((function(e){e.hasOwnProperty("accessRight")&&e.accessRight.forEach((function(r){if(r.hasOwnProperty("error")){a++;var o=r.error;o.type="warning";var s=UWA.i18n("an object");t.every((function(t){t.physicalId==e.objectID&&t.hasOwnProperty("name")&&(s=t.name)}));var c="";switch(n.widgetSecurityContext.hasOwnProperty("SecurityContext")&&(c=n.widgetSecurityContext.SecurityContext.replace("ctx::","")),o.code+""){case"1501603":o.message=UWA.i18n("Bad credential for {0}").format(s);break;case"1501601":o.message=UWA.i18n("SH_PLM_SecurityDenied");break;case"1501602":o.message=UWA.i18n("NoCredentialAccess{0}").format(c);break;case"0000000":o.message=UWA.i18n("ShareNotSupported")}i[e.objectID]=o.message,!0===n.options.displayWarningForAutoRO&&n.addError(o),v.warn("Access right : "+o.message)}}))}));var o=r.length;o==a?(n.isReadOnly=!0,1==o?null!=i[r[0].objectID]&&n.addError(i[r[0].objectID]):n.addError(UWA.i18n("ErrorNoAccessToSelectedObjects")),t.length>o&&(n.isReadOnly=!1,n.addError(UWA.i18n("ErrorNoAccessToAtLeast10")))):a>0&&n.addError(UWA.i18n("ErrorNoAccessToSomeObjects{0}").format(a))}n._updateReadOnlyDisplay(),n._addDataPCS(t)}else{if(this.isReadOnly=!0,e.hasOwnProperty("error")){var s=e.error;n.addError(s)}this.hideMainLoadingArea()}},_manageTableHeader:function(){var e=this.tableContainer.getElement(".SH_mainTableHeader");null!==e&&(this.table.allIsHidden()?e.hide():e.show())},AddUser:function(e){var t=this,n=!1;if(!d.isProgressBusy()){var a="";if("Reader"==e)a=t.searchWidget_CanRead.getNewOwner();else if("Author"==e)a=t.searchWidget_CanEdit.getNewOwner();else if("Owner"==e)a=t.searchWidget_CanManage.getNewOwner();else if("Viewer"==e)a=t.searchWidget_CanView.getNewOwner();else if("CanAddRemoveAttachments"==e)a=t.searchWidget_CanAddRemoveAttachment.getNewOwner();else if("Read"==e)a=t.searchWidget_Read.getNewOwner();else if("Add"==e)a=t.searchWidget_Add.getNewOwner();else if("Basic"==e)a=t.searchWidget_Basic.getNewOwner();else if("ReadWrite"==e){a=t.searchWidget_ReadWrite.getNewOwner();e="Read Write"}else if("Remove"==e)a=t.searchWidget_Remove.getNewOwner();else if("AddRemove"==e){a=t.searchWidget_AddRemove.getNewOwner();e="Add Remove"}else if("Full"==e)a=t.searchWidget_Full.getNewOwner();else if("Leader"==e)a=t.searchWidget_Leader.getNewOwner();else if("Project Member"==e)a=t.searchWidget_Member.getNewOwner();else if("Project Lead"==e)a=t.searchWidget_ProjectLead.getNewOwner();if("ReaderR"==e)a=t.searchWidget_CanReadRestriction.getNewOwner();else""==e&&(a=t.searchWidget.getNewOwner());if(null===a||""===a)return n;a.hasOwnProperty("userGrp")&&(a.group={groupURI:a.userGrp.id,groupTitle:a.userGrp.label},delete a.userGrp);var r=e,i=!0,o=this.ownerAlreadyExist(a);if(o.length>0){var s=o[0],c=s.Index;1==s.IsSame?t.listOfAddedMembers[c].ownership.access.logical===r?i=!1:t.listOfAddedMembers[c].ownership.access.logical!=r&&(c+=1,t.container.getElement("#addedItem"+c).hide(),t.DeleteUser(c)):(c+=1,t.container.getElement("#addedItem"+c).hide(),t.DeleteUser(c))}if(i){var l={InitRights:"",operation:"ADD",owner:a,access:{logical:r}};if("ReaderR"===r&&a.hasOwnProperty("organization")&&a.hasOwnProperty("collabSpace")){n=!1;var h={message:UWA.i18n("ReaderRAccessToGrpsCSORG"),code:"warning"};t.setError(h)}else{var p={ownership:l,isTrueComment:!0,isTrueInheritedPath:!0};t.listOfAddedMembers.push(p),n=!0}}return n}},DeleteUser:function(e){if(!d.isProgressBusy()){var t=parseInt(e)-1;this.listOfAddedMembers.splice(t,1),this._ManageValidButton()}},createJSONArrayModif:function(){var e=[];if(1==this.isReadOnly)return e;for(var t=this,n=t.listOfAddedMembers.length,a=0;a<n;a++){var i=null,o=t.listOfAddedMembers[a];i=o.ownership.owner;var s=!0,c=!0;o.hasOwnProperty("isTrueComment")&&(s=o.isTrueComment),o.hasOwnProperty("isTrueInheritedPath")&&(c=o.isTrueInheritedPath);var l="";1==t.options.activeComment&&(l=t.table.getCellValue(lines[a],"Comments"));var d=o.ownership.InitRights,h="Reader";o.hasOwnProperty("ownership")&&(h=o.ownership.access.logical);var p=!1;null!=h&&""!=h||(p=!0);var m=!1;null!=d&&""!=d||(m=!0);var u=!1;if(""!=l&&l!=i.comment&&(u=!0),1==m&&0==p&&(1==u&&(i.comment=l),e.push({operation:{operation:"ADD",owner:i,access:{logical:h}},isTrueComment:!0,isTrueInheritedPath:!0,action:"ADD"})),0==m&&1==p&&e.push({operation:{operation:"REMOVE",owner:i,access:{logical:"Empty"}},isTrueComment:s,isTrueInheritedPath:c,action:"REMOVE"}),0==m&&0==p)if(1==u){var g=r.decode(r.encode(i));g.comment=l,e.push({operation:{operation:"ADD",owner:g,access:{logical:h}},isTrueComment:!0,isTrueInheritedPath:!0,action:"ADD"})}else h!=d&&e.push({operation:{operation:"ADD",owner:i,access:{logical:h}},isTrueComment:s,isTrueInheritedPath:c,action:"MODIFY"})}return e},ODTGetListOfItemsInTable:function(){return this.ShareController.getSelectedItemList().length},trackAppContent:function(e){var t=this,n={UXName:"Share",models:e};t.trackerEvent=w.createInitActionEvent(n,t.trackerEvent),w.checkAndTrackPageEvent(t.trackerEvent)},send3DNotification:function(e){var t=this;h.getInstance().getSecurityContext({onSuccess:function(n){t.widgetSecurityContext.hasOwnProperty("SecurityContext")?t.ShareController.send3DNotification(e,t.widgetSecurityContext):t.ShareController.send3DNotification(e,n)},onFailure:function(n){t.widgetSecurityContext.hasOwnProperty("SecurityContext")?t.ShareController.send3DNotification(e,t.widgetSecurityContext):t.setError(n)}})},_create_UUID:function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:3&n|8).toString(16)}))}})}));