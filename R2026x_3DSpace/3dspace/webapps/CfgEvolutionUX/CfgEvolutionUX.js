define("DS/CfgEvolutionUX/CfgVariants",["UWA/Class/View","DS/CfgBaseUX/scripts/CfgData","DS/CfgBaseUX/scripts/CfgUtility","UWA/Class/Promise","DS/CfgBaseUX/scripts/CfgXMLServices","DS/UIKIT/Tooltip","DS/UIKIT/Spinner","DS/UIKIT/Mask","DS/CfgFilterUX/CfgVariantEditor","DS/CfgFilterUX/CfgPCChooser","DS/CfgBaseUX/scripts/CfgData","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","DS/WebappsUtils/WebappsUtils","DS/CfgBaseUX/scripts/CfgSearchConfiguration","DS/CfgBaseUX/scripts/CfgUXEnvVariables","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX","text!DS/CfgBaseUX/assets/CfgUXEnvVariables.json","css!DS/CfgEvolutionUX/CfgEvolutionUX.css"],(function(e,t,i,o,n,s,a,l,r,d,c,p,u,m,h,g,f,C){"use strict";return e.extend({textBox:null,textdiv:null,buttondiv:null,xml:null,json:null,displayExpression:"",currentModel:null,xmlExpression:"",xmlDisplayExpression:"",configuratorButton:null,binaryExpression:"",selectedPCPID:"",selectedPCType:"",selectedPCDisplayName:"",selectedPCRevision:"",selectedPCMode:"",selectedPCPName:"",BasedOnMVID:"",BasedOnModelID:"",BasedOnModelName:"",displayCompactMode:!1,setup:function(e){this._parent(e)},render:function(){let e=this;this.cfgUXEnvVariables=g.getCfgUXEnvVariables(),this.PCChooser=new d({parentDiv:this.options.pcParent,modelID:this.options.modelID,PCID:this.options.variantJSON.selectedPCPID,PCType:this.options.variantJSON.selectedPCType,PCLabel:this.options.variantJSON.selectedPCDisplayName,PCRev:this.options.variantJSON.selectedPCRevision,tenant:e.options.tenant,processPCCallback:()=>{this.processProductConfiguration()},clearProductConfLabelInfo:()=>{this.clearProductConfLabelInfo()}}),this.PCChooser.render(),this.displayCompactMode=this.options.displayCompactMode,this.rootrevisionarray=[],this.options.parentElement.addClassName("variant-decidesActionButtonPosition");let o=UWA.createElement("div",{class:"CFGConfiguratorSection",styles:{display:"flex",float:"right","margin-top":"0px","margin-bottom":"5px"}}).inject(this.options.parentElement),n=UWA.createElement("div",{styles:{float:"left",width:"100%","margin-bottom":"10px"}}).inject(this.options.parentElement);this.textBox=UWA.createElement("div",{styles:{"overflow-wrap":"break-word"}}).inject(n),this.textBox.addClassName("CfgEditorVariants"),this.textBox.innerHTML=i.escapeSpecialCharacters(this.options.variantJSON.displayExpression)||"",this.displayExpression=this.options.variantJSON.displayExpression||"",this.xmlExpression=this.options.variantJSON.xmlExpression||"",this.selectedPCPID=i.isParamDefined(this.options.variantJSON.selectedPCPID)?this.options.variantJSON.selectedPCPID:"",this.selectedPCDisplayName=i.isParamDefined(this.options.variantJSON.selectedPCDisplayName)?this.options.variantJSON.selectedPCDisplayName:"",this.selectedPCRevision=this.options.variantJSON.selectedPCRevision?this.options.variantJSON.selectedPCRevision:"",this.selectedPCMode=i.isParamDefined(this.options.variantJSON.selectedPCMode)?this.options.variantJSON.selectedPCMode:"",this.selectedPCType=this.options.variantJSON.selectedPCType?this.options.variantJSON.selectedPCType:"",this.configuratorOptions=this.options.variantJSON.configuratorOptions,this.xmlDesc=this.options.variantJSON.xmlDesc,null==this.options.variantJSON.binaryExpression?this.binaryExpression="":this.binaryExpression=this.options.variantJSON.binaryExpression,this.variant=this.options.variantJSON.variant,this.status=this.options.status,this.getDefaultIcon(),this.probesData=[],1==this.options.userGrantedRoles.isCFGRoleAvail&&(this.configuratorButton=UWA.createElement("span",{id:"edit"}).inject(o),this.configuratorButton.addClassName("fonticon"),this.configuratorButton.addClassName("fonticon-2.0x"),this.configuratorButton.addClassName("wux-ui-3ds-pencil"),this.configuratorButton.addClassName("configuratorPencil"),this.configuratorButton.addClassName("configuratorButton"),new s({target:this.configuratorButton,className:"configuratorbuttontooltip",body:f.Filter_Variant_Configurator_Button}),e.options.status?e.configuratorButton.addClassName("disableButton"):e.configuratorButton.removeClassName("disableButton"),this.configuratorButton.set({events:{click:function(o){if(i.isParamDefined(c.singleProductId)||c.ModelEvents.publish({event:"NoSingleProductId"}),1!=e.configuratorButton.hasClassName("disableButton")&&1!=e.configuratorButton.hasClassName("cfgWaitCursor"))if(e.probesData.push("Configurator_Pencil_Click"),"Filter"==e.options.invokeFrom&&(l.mask(e.options.filterParentContainer),l.mask(e.options.filterParent)),e.currentDictionary=t.getDictionary(e.currentDictionaryId.replace("pid:","")),console.log(c.singleProductId),""!=e.displayExpression?e.selectedOptionsforConfigurator=c.selectedOptionsforConfigurator:e.selectedOptionsforConfigurator="",""==c.singleProductId?e.options.status=!1:e.options.status=!0,e.options={parentContainer:document.body,model_id:e.currentModel.model.valueItem,tenant:e.options.tenant,invokeFrom:e.options.invokeFrom,status:e.options.status,filterParent:e.options.filterParent,filterParentContainer:e.options.filterParentContainer,variantEditorOnOK:function(t){e.dataFromPC=void 0,e.data=t,e.configuratorOptions=e.data.configuratorOptions,console.log(t),console.log(t.xml),e.variantSpinner=new a({className:"variantSpinner"}).inject(e.textBox),e.variantSpinner.spin(),e.calculateVariantSpinnerPosition(),e.clearButton.addClassName("disableButton"),e.divider.addClassName("disableButton"),""==t.xml?e.configuratorButton.addClassName("configuratorButton"):e.configuratorButton.addClassName("configuratorButtonresize"),e.clearProductConfLabelInfo(),l.mask(e.textBox),""!==t.xml?(e.variant={},e.variant.pcid=t.PCId,e.variant.configuration=t.configuration,e.processProductConfiguration(t,e)):(e.variant||(e.variant={},e.variant.pcid=t.PCId,e.variant.configuration=[]),e.getNoConfAlert())},variantEditorOnCancel:function(t){e.dataFromPC=void 0,console.log("cancelled")}},""==e.selectedPCPID){var n=new r({displayCompactMode:e.displayCompactMode,parentContainer:document.body,productId:c.singleProductId,modelId:e.currentModel.model.valueItem,configuration:e.selectedOptionsforConfigurator,configuratorOptions:e.configuratorOptions,tenant:e.options.tenant,invokeFrom:e.options.invokeFrom,status:e.options.status,filterParent:e.options.filterParent,filterParentContainer:e.options.filterParentContainer,onOK:function(t){console.log("On OK Data : "+t.xml),e.options.variantEditorOnOK(t)},onCancel:function(t){console.log("On Cancel Data : "+t.xml),e.options.variantEditorOnCancel(t)}});setTimeout((function(){n.render()}),1e3)}else e.launchVariantEditorfrompcId()}}})),c.ModelEvents.subscribe({event:"ProductStateDialogClosed"},(function(i){""!=i.xml&&null!=i.xml||"PRODUCTS"!=i.mode&&"XREVISION"!=i.mode||(c.singleProductId=""),e.xml=i.xml,e.options.psJson=i.json,e.xml=i.xml,e.cfgUXEnvVariables.CFGClearVariantsOnMVSelect&&(e.textBox.innerText="",e.displayExpression="",e.xmlExpression=""),e.binaryExpression="",e.PCChooser.updateAutoCompleteModel(),e.variant={},e.textBox.innerText||(e.clearButton.hide(),e.divider.hide()),e.configuratorButton&&e.configuratorButton.removeClassName("configuratorButtonresize"),"PRODUCTS"!=i.mode&&"XREVISION"!=i.mode||(""==c.singleProductId?e.options.status=!1:e.options.status=!0),e.enableDisableEditVariantfromProductEvolution(),e.clearProductConfLabelInfo(),"Native"!=window.enoviaServerFilterWidget.mode||"PRODUCTS"!=i.mode||e.cfgUXEnvVariables.CFGClearVariantsOnMVSelect||t.selectedOptionsforConfigurator||c.ModelEvents.publish({event:"PrepareConfiguratorDataFromXML"})})),this.divider=UWA.createElement("div",{id:"dividerid"}).inject(o),this.divider.addClassName("cfgdivider"),null==this.displayCompactMode||!1===this.displayCompactMode?this.divider.setAttributeNode(document.createAttribute("touch-mode")):this.divider.removeAttribute("touch-mode"),this.clearButton=UWA.createElement("span",{id:"clearbuttonid"}).inject(o),this.clearButton.addClassName("fonticon"),this.clearButton.addClassName("fonticon-2.0x"),this.clearButton.addClassName("wux-ui-3ds-trash"),this.clearButton.set({events:{click:function(t){e.onClearButtonClick()}}}),new s({target:this.clearButton,body:f.Filter_Variant_ClearButton}),this.textBox&&this.textBox.innerText&&"undefined"!==this.textBox.innerText?(this.clearButton.show(),this.divider.show(),this.configuratorButton&&this.configuratorButton.addClassName("configuratorButtonresize")):(this.clearButton.hide(),this.divider.hide()),c.ModelEvents.subscribe({event:"ProductStatecheckbox"},(function(t){e.checkboxStatus=t.model,e.PCChooser.updateAutoCompleteModel(),0!=t.isRoot&&null!=t.isRoot||1!=t.psJsonLength?(null!=e.configuratorButton&&e.configuratorButton.addClassName("disableButton"),e.options.status=!1,e.clearProductConfLabelInfo()):1==e.checkboxStatus?(null!=e.configuratorButton&&e.configuratorButton.removeClassName("disableButton"),e.options.status=!0):(null!=e.configuratorButton&&e.configuratorButton.addClassName("disableButton"),e.options.status=!1,e.clearProductConfLabelInfo())})),c.ModelEvents.subscribe({event:"modelUpdated"},(function(t){e.currentModel=t;var i="";i=t.model.valueItem.constructor==Array?t.model.value[0]:t.model.valueItem,e.currentDictionaryId=i,e.PCChooser.setModelID(i),e.PCChooser.updateAutoCompleteModel(),""!=e.options.variantJSON&&null!=e.options.variantJSON?(e.options.variantJSON.selectedPCDisplayName&&(e.PCChooser.model.set("ID",e.options.variantJSON.selectedPCPID),e.PCChooser.model.set("revision",e.options.variantJSON.selectedPCRevision),e.PCChooser.model.set("label",e.options.variantJSON.selectedPCDisplayName),e.PCChooser.model.set("type",e.options.variantJSON.selectedPCType)),e.options.variantJSON=""):(e.textBox.innerText="",e.xmlExpression="",e.displayExpression="",e.clearButton.hide(),e.divider.hide(),e.configuratorButton&&e.configuratorButton.removeClassName("configuratorButtonresize")),null!=t.noEvolutionUpdate&&1==t.noEvolutionUpdate||(e.options.status=!1,e.enableDisableEditVariantfromProductEvolution(),e.clearProductConfLabelInfo())}))},initialize:function(e){this.currentDictionaryId="",e.model&&(this.currentModel=e,Array.isArray(e.model.valueItem)?this.currentDictionaryId=e.model.valueItem[0]:this.currentDictionaryId=e.model.valueItem),this.PCChooser.setModelID(this.currentDictionaryId),this.PCChooser.updateAutoCompleteModel(),this.options.variantJSON?(this.options.variantJSON.selectedPCDisplayName&&(this.PCChooser.model.set("ID",this.options.variantJSON.selectedPCPID),this.PCChooser.model.set("revision",this.options.variantJSON.selectedPCRevision),this.PCChooser.model.set("label",this.options.variantJSON.selectedPCDisplayName),this.PCChooser.model.set("type",this.options.variantJSON.selectedPCType)),this.options.variantJSON=""):(this.textBox.innerText="",this.xmlExpression="",this.displayExpression="",this.clearButton.hide(),this.divider.hide(),this.configuratorButton&&this.configuratorButton.removeClassName("configuratorButtonresize")),null!=e.noEvolutionUpdate&&1==e.noEvolutionUpdate||(this.options.status=!1,this.enableDisableEditVariantfromProductEvolution(),this.clearProductConfLabelInfo())},onClearButtonClick:function(){1!=this.clearButton.hasClassName("disableButton")&&(this.textBox.innerText="",this.displayExpression="",this.xmlExpression="",this.binaryExpression="",this.variant={},this.clearButton.hide(),this.divider.hide(),this.configuratorButton&&(this.configuratorButton.removeClassName("configuratorButtonresize"),this.configuratorButton.removeClassName("cfgWaitCursor")),this.clearProductConfLabelInfo(),c.productstateCheckbox&&0==c.productstateCheckbox.checkFlag||c.xRevCheckBox&&0==c.xRevCheckBox.checkFlag||""==c.singleProductId?this.configuratorButton.addClassName("disableButton"):this.configuratorButton.removeClassName("disableButton"))},launchVariantEditorfrompcId:function(){var e=this,t=new r({displayCompactMode:e.displayCompactMode,parentContainer:document.body,modelId:this.options.model_id,PCId:this.selectedPCPID,dataFromPC:this.dataFromPC,tenant:e.options.tenant,invokeFrom:this.options.invokeFrom,status:this.options.status,filterParent:this.options.filterParent,filterParentContainer:this.options.filterParentContainer,onOK:function(t){console.log("On OK Data : "+t.xml),e.options.variantEditorOnOK(t)},onCancel:function(t){console.log("On Cancel Data : "+t.xml),e.options.variantEditorOnCancel(t)}});this.modelView=t,setTimeout((function(){t.render()}),1e3)},getDefaultIcon:function(){this.iconProductConfiguration22=enoviaServerFilterWidget.baseURL+"/snresources/images/icons/small/ProductConfiguration22.png",this.iconActionConfigurator=m.getWebappsAssetUrl("CfgBaseUX","icons/32/iconActionConfigurator.png"),this.iconTrash=m.getWebappsAssetUrl("CfgBaseUX","icons/32/SWXMbUiDeleteObjects.png")},enableDisableEditVariantfromProductEvolution:function(){null!=this.configuratorButton&&(1==this.options.status?this.configuratorButton.removeClassName("disableButton"):this.configuratorButton.addClassName("disableButton"))},show:function(){this.visibleFlag=!0,this.textBox.show(),this.configuratorButton.show(),""!=this.textBox.innerText&&(this.clearButton.show(),this.divider.show()),document.getElementsByClassName("filter-dialog-variantslabel")[0]&&(document.getElementsByClassName("filter-dialog-variantslabel")[0].style.display=""),document.getElementsByClassName("filter-dialog-150-checkbox")[0]&&(document.getElementsByClassName("filter-dialog-150-checkbox")[0].style.display="")},hide:function(){this.visibleFlag=!1,this.textBox.hide(),this.configuratorButton.hide(),this.clearButton.hide(),this.divider.hide(),document.getElementsByClassName("filter-dialog-variantslabel")[0]&&(document.getElementsByClassName("filter-dialog-variantslabel")[0].style.display="none"),document.getElementsByClassName("filter-dialog-150-checkbox")[0]&&(document.getElementsByClassName("filter-dialog-150-checkbox")[0].style.display="none")},getBinaryExpression:function(e){if(null!=e.results[0]&&e.results[0].attributes.length>0)for(var t=0;t<e.results[0].attributes.length;t++)"FILTER_COMPILED_FORM"==e.results[0].attributes[t].name&&(this.binaryExpression=e.results[0].attributes[t].value);return this.binaryExpression},getAssociatedMV:function(e){var t="";if(null!=e.results[0]&&e.results[0].attributes.length>0)for(var i=0;i<e.results[0].attributes.length;i++)"ds6w:where/ds6w:context/ds6w:product"==e.results[0].attributes[i].name&&(t=e.results[0].attributes[i].value);return t},getBasedOnMVID:function(e){var t="";if(null!=e.results[0]&&e.results[0].attributes.length>0)for(var i=0;i<e.results[0].attributes.length;i++)"BASED_ON_MODEL_VERSION_PID"==e.results[0].attributes[i].name&&(t=e.results[0].attributes[i].value);return t},getBasedOnModelID:function(e){var t="";if(null!=e.results[0]&&e.results[0].attributes.length>0)for(var i=0;i<e.results[0].attributes.length;i++)"BASED_ON_MODEL_PID"==e.results[0].attributes[i].name&&(t=e.results[0].attributes[i].value);return t},getAttrValue:function(e,t){var i="";if(null!=e.results[0]&&e.results[0].attributes.length>0)for(var o=0;o<e.results[0].attributes.length;o++)if(e.results[0].attributes[o].name==t)i=e.results[0].attributes[o].value;return i},getDisplayXMLExpressionFromPCCriteria:function(e){var t={},o="";if(e.seletedoptionsexist=!1,!Array.isArray(e))return;return e.forEach((i=>{if(i.title&&(i.displayName=i.title),!i.displayName||!i.parentDisplayName)return;null==t[i.parentDisplayName]&&(t[i.parentDisplayName]={values:[]});let o={};o.selectionState=i.status,o.displayName=[i.displayName],t[i.parentDisplayName].values.push(o),e.seletedoptionsexist=!0})),Object.keys(t).forEach(((e,s)=>{let a="",l="",r=t[e].values;for(let e=0;e<r.length;e++){let t=i.escapeSpecialCharacters(r[e].displayName[0]);"Not Available"==r[e].selectionState||"Incompatible"==r[e].selectionState&&this.selectedBCID||("Dismissed"==r[e].selectionState||"Incompatible"==r[e].selectionState&&this.selectedPCPID?l+=n.buildOption(t):a+=n.buildOption(t))}if(0!=r.length){var d=i.escapeSpecialCharacters(e);""!=a&&(o+=n.buildFeature(d,a)),""!=l&&(o+=n.buildNot(),o+=n.buildFeature(d,l),o+=n.endNot())}})),o},getXMLExpressionFromPCCriteria:function(e){var t={},o="";if(e.seletedoptionsexist=!1,!Array.isArray(e))return;e.forEach((i=>{if(i.title&&(i.displayName=i.title),!(i.name&&i.parentName&&i.displayName&&i.parentDisplayName))return;null==t[i.parentName]&&(t[i.parentName]={values:[],displayName:i.parentDisplayName});let o={};o.selectionState=i.status,o.name=[i.name],o.displayName=[i.displayName],t[i.parentName].values.push(o),e.seletedoptionsexist=!0}));let s=[];return Object.keys(t).forEach(((e,a)=>{let l="",r="",d=t[e].values;window.DescriptionCount++;for(var c=0;c<d.length;c++)"Not Available"==d[c].selectionState||"Incompatible"==d[c].selectionState&&this.selectedBCID||("Dismissed"==d[c].selectionState||"Incompatible"==d[c].selectionState&&this.selectedPCPID?r+=n.buildOption(d[c].name[0],window.DescriptionCount):l+=n.buildOption(d[c].name[0],window.DescriptionCount),s.push(`<Option DescId = "${window.DescriptionCount}" DisplayName="${i.escapeSpecialCharacters(d[c].displayName)}" SequenceOrder="${window.DescriptionCount}"></Option>`),window.DescriptionCount++);0!=d.length&&(window.DescriptionCount++,""!=l&&(o+=n.buildFeature(e,l,window.DescriptionCount)),""!=r&&(o+=n.buildNot(),o+=n.buildFeature(e,r,window.DescriptionCount),o+=n.endNot())),s.push(`<Feature DescId = "${window.DescriptionCount}" DisplayName="${i.escapeSpecialCharacters(t[e].displayName)}" SequenceOrder="${window.DescriptionCount}"></Feature>`)})),{variantsXML:o,variantXMLDesc:s}},getNoConfAlert:function(){var e=this;l.unmask(e.textBox),e.textBox.innerText="",e.displayExpression="",e.xmlExpression="",e.binaryExpression="",e.variant={},""!==e.textBox.innerText?e.clearButton.isHidden()?e.clearButton.show():(e.clearButton.removeClassName("disableButton"),e.divider.removeClassName("disableButton")):(e.clearButton.isHidden()||e.clearButton.hide(),e.divider.hide(),e.configuratorButton&&e.configuratorButton.removeClassName("configuratorButtonresize")),null!=e.data&&"selectionMode_Refine"===e.data.selectionmode?c.filter150Checkbox.checkFlag=!0:null!=e.data&&"selectionMode_Build"===e.data.selectionmode&&(JSON.parse(C).ConfiguratorInDefaultBuildMode||(c.filter150Checkbox.checkFlag=!1))},checkRefineMode:function(e){"selectionMode_Refine"===e||"Refine"===e?c.filter150Checkbox.checkFlag=!0:"selectionMode_Build"===e||"Build"===e?JSON.parse(C).ConfiguratorInDefaultBuildMode&&"Build"!==e||(c.filter150Checkbox.checkFlag=!1):null==e&&c.filter150Checkbox.checkFlag&&(c.filter150Checkbox.checkFlag=!1)},processProductConfiguration:function(e){let t=this;window.notifs=p,u.setNotificationManager(window.notifs),e&&e.selectionmode&&this.checkRefineMode(e.selectionmode);var s=new o((async function(o,n){if(e&&e.xml)o();else{t.selectedPCPID="Product Configuration"===t.PCChooser.model.get("type")?t.PCChooser.model.get("ID"):"",t.selectedBCID="Model Type"===t.PCChooser.model.get("type")?t.PCChooser.model.get("ID"):"",t.configuratorButton&&t.configuratorButton.addClassName("cfgWaitCursor"),t.selectedPCPID&&i.setDefaultConfigurations(t.selectedPCPID).then((e=>{t.configuratorButton&&t.configuratorButton.removeClassName("cfgWaitCursor"),t.configuratorButton&&t.configuratorButton.hasClassName("disableButton")&&c.singleProductId&&t.configuratorButton.removeClassName("disableButton"),console.log("Config UX: data from PC: ",e),c.selectedOptionsforConfigurator=e.configurationData.configurationCriteria,e.configurationData.appRuleParam&&(t.configuratorOptions={initialRuleLevel:e.configurationData.appRuleParam.rulesMode,rulesActivation:e.configurationData.appRuleParam.rulesActivation}),t.dataFromPC=e}),(e=>{t.configuratorButton&&t.configuratorButton.removeClassName("cfgWaitCursor"),t.configuratorButton&&t.configuratorButton.addClassName("disableButton"),console.error(e),console.error("Config UX: Can not load configurator, so it is disabled.")}));let e="";if(t.selectedPCPID)e="/resources/v1/modeler/dspfl/invoke/dspfl:getCriteriaConfigurationInstances?xrequestedwith=xmlhttprequest";else if(t.selectedBCID){let o=c.singleProductId||"";if(!o)try{let e=await i.getDataUsingSearch(`flattenedtaxonomies:(types/Model Type) AND ( physicalid:${t.selectedBCID})`,["bc_based_on_model_version_pid"]);if(e&&e.results&&e.results[0]&&e.results[0].attributes){let t=e.results[0].attributes.find((e=>{if("bc_based_on_model_version_pid"==e.name)return e}));t&&(o=t.value)}}catch(e){t.configuratorButton&&t.configuratorButton.removeClassName("cfgWaitCursor"),t.configuratorButton&&t.configuratorButton.addClassName("disableButton"),o="",console.log("search webservise failed on Bace configuration to fetch bc_based_on_model_version_pid")}e=`/resources/v1/modeler/dspfl/dspfl:ModelVersion/${o}/dspfl:BaseConfiguration/${t.selectedBCID}?$mask=dsmvpfl:BaseConfigurationCriteriaUIMask`}let n="";t.selectedPCPID&&(n=JSON.stringify({id:t.selectedPCPID}));var s=function(e){let n="";if(t.selectedPCPID){if(!i.isDefined(e.member)||!Array.isArray(e.member))return void t.getNoConfAlert();n=e.member,t.selectedPCMode=e.selectionMode,t.checkRefineMode(e.selectionMode),t.selectedPCDisplayName=e.title,t.selectedPCPName=e.name,t.selectedPCRevision=e.revision,t.selectedPCType=t.PCChooser.model.get("type")}else t.selectedBCID&&(e&&e.member&&Array.isArray(e.member)&&e.member[0]&&e.member[0].selectedCriteria&&e.member[0].selectedCriteria.member&&Array.isArray(e.member[0].selectedCriteria.member)?(n=e.member[0].selectedCriteria.member,t.configuratorButton&&t.configuratorButton.removeClassName("cfgWaitCursor"),t.configuratorButton&&t.configuratorButton.hasClassName("disableButton")&&c.singleProductId&&t.configuratorButton.removeClassName("disableButton"),c.selectedOptionsforConfigurator=n.filter((e=>"Selected"==e.status||"Default"==e.status||"Available"==e.status)).map((e=>({State:"Chosen",Id:e.id})))):(t.configuratorButton&&t.configuratorButton.removeClassName("cfgWaitCursor"),t.configuratorButton&&t.configuratorButton.addClassName("disableButton")));var{variantsXML:s,variantXMLDesc:a}=t.getXMLExpressionFromPCCriteria(n);"Native"==window.enoviaServerFilterWidget.mode&&(t.selectedPCPID&&(t.PCChooser.model.set("revision",e.revision),t.PCChooser.model.set("label",e.title)),null!=t.configuratorButton&&t.configuratorButton.removeClassName("disableButton"),t.clearButton.addClassName("disableButton"),t.configuratorButton&&t.configuratorButton.addClassName("configuratorButtonresize")),1==n.seletedoptionsexist?o(n):t.getNoConfAlert()},a=function(e){t.selectedBCID&&(t.configuratorButton&&t.configuratorButton.removeClassName("cfgWaitCursor"),t.configuratorButton&&t.configuratorButton.addClassName("disableButton")),l.unmask(t.textBox),t.variantSpinner&&t.variantSpinner.hide(),t.textBox.innerText="",""!==t.textBox.innerText?t.clearButton.isHidden()?(t.clearButton.show(),t.divider.show()):(t.clearButton.removeClassName("disableButton"),t.divider.removeClassName("disableButton")):(t.clearButton.isHidden()||t.clearButton.hide(),t.divider.hide(),t.configuratorButton&&t.configuratorButton.addClassName("configuratorButtonresize"))};t.selectedPCPID?i.makeWSCall(e,"POST","enovia","application/json",n,s,a,!0,null):t.selectedBCID&&i.makeWSCall(e,"GET","enovia","json","",s,a,!0,null)}}));return s.then((function(o){let s="",a="";e||({variantsXML:s,variantXMLDesc:a}=t.getXMLExpressionFromPCCriteria(o)),t.xmlExpression=e&&e.xml?e.xml:s,t.xmlDesc=e&&e.xmlDesc?e.xmlDesc:a;n.startFilterXML(),t.xmlExpression,n.endFilterXML();if(t.currentModel.model.valueItem.constructor==Array&&(t.currentModel.model.valueItem=t.currentModel.model.valueItem),e&&e.xml){t.xmlDisplayExpression=e&&e.displayXml?e.displayXml:t.xmlExpression;var r=n.startFilterXML()+t.xmlDisplayExpression+n.endFilterXML();t.displayExpression=i.getDisplayExpressionUsingXSLT(r)}else{t.xmlDisplayExpression=t.getDisplayXMLExpressionFromPCCriteria(o);r=n.startFilterXML()+t.xmlDisplayExpression+n.endFilterXML();t.displayExpression=i.getDisplayExpressionUsingXSLT(r)}t.clearButton.removeClassName("disableButton"),t.divider.removeClassName("disableButton"),l.unmask(t.textBox),t.textBox.innerHTML=i.escapeSpecialCharacters(t.displayExpression),""!==t.textBox.innerText&&(t.clearButton.show(),t.divider.show())})),s},calculateVariantSpinnerPosition:function(){var e=this,t=e.textBox.getPosition(),i=e.textBox.getDimensions().width,o=e.textBox.getDimensions().height,n=t.x+i/2,s=t.y+o/2;e.variantSpinner.elements.container.setStyles({top:s+"px",left:n+"px"})},getJson:function(){return this.displayExpression},getXml:function(){return this.xmlExpression},getDisplayExpression:function(){return this.displayExpression},getSelectedVariant:function(){return this.variant},getConfiguratorOptions:function(){return this.configuratorOptions},clearProductConfLabelInfo:function(){let e=this;e.selectedPCPID="",e.dataFromPC=void 0,e.selectedPCMode="",e.PCChooser.model.set("ID",""),e.PCChooser.model.set("revision",""),e.PCChooser.model.set("label",""),1==e.options.status?null!=e.configuratorButton&&e.configuratorButton.removeClassName("disableButton"):null!=e.configuratorButton&&e.configuratorButton.addClassName("disableButton")}})})),define("DS/CfgEvolutionUX/CfgEvolutionViewSelector",["UWA/Class/View","DS/Controls/ComboBox"],(function(e,t){"use strict";return e.extend({init:function(e){this._parent(e)},render:function(){var e=this;return null!=e.options.elementsList||null!=e.options.elementsList&&e.options.elementsList.length>0?this.viewCombobox=new t({selectedIndex:0,enableSearchFlag:!1,elementsList:e.options.elementsList,touchMode:!e.options.displayCompactMode}).inject(this.container):this.viewCombobox=new t({selectedIndex:0,enableSearchFlag:!1,elementsList:[{labelItem:e.options.officialViewLabel,valueItem:"Official"},{labelItem:e.options.projectedViewLabel,valueItem:"Projected"}],touchMode:!e.options.displayCompactMode}).inject(this.container),this.viewCombobox.addEventListener("change",(function(t){var i=e.viewCombobox.currentValue;"Official"==i&&e.options.officialViewHandler?e.options.officialViewHandler():"Projected"==i&&e.options.projectedViewHandler?e.options.projectedViewHandler():"Change"==i&&e.options.changeViewHandler&&e.options.changeViewHandler()})),this.viewCombobox.addEventListener("click",(function(e){e.stopPropagation()})),this.viewCombobox.addEventListener("show",(function(e){document.getElementsByClassName("wux-controls-combobox-popup")[0].setStyle("zIndex","99999")})),this.container},set:function(e){"Official"==e.view?this.viewCombobox.selectedIndex=0:"Projected"==e.view?this.viewCombobox.selectedIndex=1:"Change"!=e.view&&"Source"!=e.view||(this.viewCombobox.selectedIndex=2)},get:function(){var e={view:""};return"Official"==this.viewCombobox.currentValue?e.view="Official":"Projected"==this.viewCombobox.currentValue?e.view="Projected":"Change"==this.viewCombobox.currentValue&&(e.view="Source"),e},enable:function(){this.viewCombobox.disabled=!1},disable:function(){this.viewCombobox.disabled=!0}})})),define("DS/CfgEvolutionUX/CfgUnitLayout",["DS/UIKIT/Iconbar","DS/UIKIT/Modal","DS/UIKIT/Input/Button","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX","i18n!DS/CfgBaseUX/assets/nls/CfgBaseUXNLS","DS/CfgBaseUX/scripts/CfgData","DS/UIKIT/Tooltip","DS/CfgFilterUX/CfgFilterSlideInComponent","text!DS/CfgFilterUX/CfgFilterslideInDialogTemplate.html","DS/UIKIT/Mask","DS/CfgBaseUX/scripts/CfgContainerView","DS/CfgBaseUX/scripts/CfgToggle","DS/Controls/LineEditor","DS/CfgBaseUX/scripts/CfgEffectivityExpressionContainer","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/DataGridView/DataGridView","DS/TreeModel/DataModelSet","css!DS/CfgEvolutionUX/CfgEvolutionUX.css"],(function(e,t,i,o,n,s,a,l,r,d,c,p,u,m,h,g,f,C){"use strict";return{CfgExpressionBox:!1,create:function(t,i,s,l){var r=this;this.fields=i,this.ExpressionMode=!1,this.selectedNodes=[],this.currentModel=s,this.existingEffectivityArray=[],this.frozenArray=[],this.buildExistingEffectivityArray(this.fields.split(","),t.builds),this.buildFrozenArray(t.builds),this.MainContainer=new UWA.Element("div",{class:" maincontainer-class"}),this.opts=l,this.CfgUnitToolbarContainer=UWA.createElement("div",{class:"unitToolbarContainer"});const c={displayCompactMode:r.opts.displayCompactMode,toggleID:"cfgUnitInfiniteToggle",toggleLabel:o.Filter_InfinitySelectionMode,toggleTooltip:o.Infinitytooltip,width:"auto"};this.unitInfiniteToggle=new p(c);const m=this.unitInfiniteToggle.render();!0===this.opts.isReadOnly&&m.hide(),l.rangeEnable&&this.unitInfiniteToggle.setToggleState(!0),this.expressionToolbarContainer=UWA.createElement("div",{class:"expressionToolbarContainer"}),this.expressionToolbar=new e({renderTo:r.expressionToolbarContainer,items:[{className:"divider"},{fonticon:"book-open",text:n.CfgExpressionView,handler:function(){!1===r.CfgExpressionBox?(r.expressionToolbarContainer.getElement("span.fonticon-book-open").setStyle("color","#b4b6ba"),r.CfgExpressionBox=!0,r.cfgExpressionViewObj.hideShowExpressionContainer()):(r.expressionToolbarContainer.getElement("span.fonticon-book-open").setStyle("color","#42a2da"),r.CfgExpressionBox=!1,r.cfgExpressionViewObj.hideShowExpressionContainer())}}]}),m.appendChild(this.expressionToolbarContainer),m.inject(this.CfgUnitToolbarContainer),this.applyCompactComfortableModeViewExpressionIcon();const h=new UWA.Element("div",{class:"cfgSearchUnitInputContainer"}).inject(this.CfgUnitToolbarContainer);this.CfgUnitToolbarContainer.appendChild(m),new a({className:"mytooltip",target:h,body:o.TypeFilter_Number,position:"left"}),this.unitSearchEditor=new u({placeholder:o.Filter_Dialod_Unit_Search_Placeholder,selectAllOnFocus:!0,displayClearFieldButtonFlag:!0}).inject(h),null==this.opts.displayCompactMode||!1===this.opts.displayCompactMode?this.unitSearchEditor.touchMode=!0:this.unitSearchEditor.touchMode=!1,this.unitSearchEditor.addEventListener("uncommittedChange",(()=>{this.filterBuilds()})),this.MainContainer.addClassName("mainContainerFilterUnit");let g=[];this.convertBuildsDataToArrey(t.builds,g);let C=this.prepareModel(g);const v=[{text:o.Filter_Name,dataIndex:"label",isSortable:!1,isDraggable:!1,getCellClassName:function(e){return e.nodeModel?"Complete"==e.nodeModel.getAttributeValue("status")||"Release"==e.nodeModel.getAttributeValue("status")||"Obsolete"==e.nodeModel.getAttributeValue("status")?"disablerow ":void 0:"headerClass"}},{text:o.Filter_Number,dataIndex:"buildnumber",isSortable:!1,isDraggable:!1,getCellClassName:function(e){return e.nodeModel?"Complete"==e.nodeModel.getAttributeValue("status")||"Release"==e.nodeModel.getAttributeValue("status")||"Obsolete"==e.nodeModel.getAttributeValue("status")?"disablerow":void 0:"headerClass"}},{text:o.Filter_Status,dataIndex:"status",isSortable:!1,isDraggable:!1,getCellClassName:function(e){return e.nodeModel?"Complete"==e.nodeModel.getAttributeValue("status")||"Release"==e.nodeModel.getAttributeValue("status")||"Obsolete"==e.nodeModel.getAttributeValue("status")?"disablerow":void 0:"headerClass"}},{text:o.UnitDescription,dataIndex:"description",isSortable:!1,isDraggable:!1,getCellClassName:function(e){return e.nodeModel?"Complete"==e.nodeModel.getAttributeValue("status")||"Release"==e.nodeModel.getAttributeValue("status")||"Obsolete"==e.nodeModel.getAttributeValue("status")?"disablerow":void 0:"headerClass"}}];let x=new f({rowSelection:"multiple",columnSelection:"none",cellSelection:"none",treeDocument:C,columns:v,showModelChangesFlag:!0,showRowIndexFlag:!1,defaultColumnDef:{width:"auto",height:"30px",position:"relative",typeRepresentation:"string",editableFlag:!1},selectionBehavior:{toggle:!0}});C.setUseChangeTransactionMode(!0),null==this.opts.displayCompactMode||this.opts.displayCompactMode,this.unitGraphContainer=new UWA.Element("div",{class:"unitLayoutTreeListViewContainer"}),x.inject(this.unitGraphContainer),x.elements.container.addClassName("dgv"),x.elements.container.addClassName("unitalternaterow"),x.elements.container.addClassName("unitheader"),x.elements.container.addClassName("unithighlighted"),this.programaticUnSel=1,x.getTreeDocument().getRoots()[0].hide(),this.programaticUnSel=0,this.unitLayoutExpressionDiv=new UWA.Element("div",{class:"unitLayoutExpressionDiv"}),this.unitLayoutExpressionDiv.inject(this.MainContainer),r.initialiseExpressionContainer(),r.tree=x,UWA.Element.addEvent.call(document,"keyup",(e=>{this.shiftKey=e.shiftKey})),UWA.Element.addEvent.call(document,"keydown",(e=>{this.shiftKey=e.shiftKey})),r.tree.getNodesXSO().onPostAdd((e=>{!0===this.opts.isReadOnly||this.programaticSel||1!=this.isFrozen(e[0])&&(e.forEach((e=>{const t=e.getAttributeValue("buildnumber");this.selectedNodes.includes(t)||this.selectedNodes.push(t)})),1==e.length?this.manageInteractiveSelections(e[0]):(1==this.shiftKey&&0==this.unitInfiniteToggle.cfgToggle.checkFlag&&this.tree.getNodesXSO().length,this.CfgUnit.textBox.value=this.CfgUnit.selectionBuilds({model:this.selectedNodes})))})),r.tree.getNodesXSO().onPostRemove((e=>{if(!0!==this.opts.isReadOnly&&!this.programaticUnSel){if(1==this.isFrozen(e[0]))return this.unselect(e[0]),void this.select(e[0]);e.forEach((e=>{const t=e.getAttributeValue("buildnumber");this.selectedNodes.indexOf(t)>-1&&this.selectedNodes.erase(t)})),1==e.length?this.manageInteractiveSelections(e[0]):(1==this.shiftKey&&0==this.unitInfiniteToggle.cfgToggle.checkFlag&&this.tree.getNodesXSO().length,this.CfgUnit.textBox.value=this.CfgUnit.selectionBuilds({model:this.selectedNodes}))}})),this.parseTextInputAndSelect(this.fields.split(",")),"Filter"!=this.opts.invokeFrom||"Native"==window.enoviaServerFilterWidget.mode?this.getLayout():this.getPanel(),require(["DS/CfgEvolutionUX/CfgUnit"],(function(e){r.CfgUnit=new e({displayCompactMode:r.opts.displayCompactMode,parentElement:r.unitLayoutExpressionDiv}),r.CfgUnit.ExpressionMode=!0,r.CfgUnit.allRoots=r.tree.getTreeDocument().getRoots(),r.CfgUnit.selectedNodes=r.selectedNodes,r.CfgUnit.currentDictionary=t,r.CfgUnit.currentModel=r.currentModel,r.CfgUnit.fields=r.fields,r.CfgUnit.render(),r.CfgUnit.editButton.hide(),r.CfgUnit.textBox.value=r.CfgUnit.fields,r.CfgUnit.filecheck=!0,r.CfgUnit.existingUnitsExpr=r.fields,!0===r.opts.isReadOnly&&(r.CfgUnit.textBox.disabled=!0),"Filter"==r.opts.invokeFrom&&d.unmask(r.opts.filterParent)}));new ResizeObserver((e=>{e[0].target.getDimensions().width<530&&o.Filter_InfinitySelectionMode.length>25||e[0].target.getDimensions().width<460&&o.Filter_InfinitySelectionMode.length>20||e[0].target.getDimensions().width<370?this.unitInfiniteToggle.hideToggleLabel("UNIT"):(e[0].target.getDimensions().width>=420&&o.Filter_InfinitySelectionMode.length<=20||e[0].target.getDimensions().width>=475&&o.Filter_InfinitySelectionMode.length<=25||e[0].target.getDimensions().width>=530)&&this.unitInfiniteToggle.showToggleLabel("UNIT")})).observe(this.CfgUnitToolbarContainer),this.CfgUnitToolbarContainer.getDimensions().width<420&&o.Filter_InfinitySelectionMode.length>25&&this.unitInfiniteToggle.hideToggleLabel("UNIT")},applyCompactComfortableModeViewExpressionIcon:function(){null==this.opts.displayCompactMode||0==this.opts.displayCompactMode?(this.expressionToolbarContainer.getElement(".divider").setAttributeNode(document.createAttribute("touch-mode")),this.expressionToolbarContainer.getElement("span.fonticon-book-open").setAttributeNode(document.createAttribute("touch-mode")),this.expressionToolbarContainer.getElement(".item").setAttributeNode(document.createAttribute("touch-mode"))):(this.expressionToolbarContainer.getElement(".divider").removeAttribute("touch-mode"),this.expressionToolbarContainer.getElementsByClassName("fonticon-book-open")[0].removeAttribute("touch-mode"),this.expressionToolbarContainer.getElement(".item").removeAttribute("touch-mode"))},initialiseExpressionContainer:function(){UWA.createElement("div",{styles:{height:"100%"},html:[this.CfgUnitToolbarContainer,this.unitGraphContainer]}).inject(this.MainContainer);var e={viewContainer:this.MainContainer,effExpHeaderTitle:o.Filter_UnitExpression,expressionContainer:this.unitLayoutExpressionDiv,defaultExpressionContainerHeight:70,displayCompactMode:this.opts.displayCompactMode,inputData:"",minimizeTooltip:n.CfgLabelMinimize,maximizeTooltip:n.CfgLabelMaximize};this.cfgExpressionViewObj=new m(e),this.cfgExpressionViewObj.render()},manageInteractiveSelections:function(e){if(1==this.unitInfiniteToggle.cfgToggle.checkFlag)if(e.isSelected()){const t=this.tree.getTreeDocument().getAllDescendants();let i=0;for(let o=0;o<t.length;o++){const n=t[o],s=n.isRoot();0==i&&1==s&&(this.select(n),-1==this.selectedNodes.indexOf(n.getAttributeValue("buildnumber"))&&this.selectedNodes.push(n.getAttributeValue("buildnumber"))),e.getAttributeValue("buildnumber")==n.getAttributeValue("buildnumber")&&(i=1)}}else{const t=this.tree.getTreeDocument().getAllDescendants();let i=0;for(let o=0;o<t.length;o++){const n=t[o],s=n.isRoot();0==i&&1==s&&(0==this.isFrozen(n)&&this.unselect(n),this.selectedNodes.indexOf(n.getAttributeValue("buildnumber"))>-1&&0==this.isFrozen(n)&&this.selectedNodes.erase(n.getAttributeValue("buildnumber"))),e.getAttributeValue("buildnumber")==n.getAttributeValue("buildnumber")&&(i=1)}}else{const t=this.tree.getTreeDocument();e.isSelected()||-1==this.selectedNodes.indexOf(t.getRoots()[1].getAttributeValue("buildnumber"))&&this.selectedNodes.indexOf(o.unitInfinity)>-1&&(this.selectedNodes.erase(o.unitInfinity),this.unselect(t.getRoots()[0]))}this.CfgUnit.textBox.value=this.CfgUnit.selectionBuilds({model:this.selectedNodes})},convertBuildsDataToArrey:function(e,t){const i={label:" ",buildnumber:o.unitInfinity,status:" ",grid:{label:" ",buildnumber:o.unitInfinity,status:" ",description:""}};if(t.push(i),e&&(0!==Object.keys(e).length||e.constructor!==Object)){for(let i=0;i<e.length;i++){const o={label:e[i].name,buildnumber:e[i].buildOrder,id:e[i].id,status:e[i].current,grid:{label:e[i].name,buildnumber:e[i].buildOrder,status:e[i].current_NLS,description:e[i].description?e[i].description.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"):""}};t.push(o)}t.sort((function(e,t){return parseInt(t.buildnumber)-parseInt(e.buildnumber)}))}},getModal:function(){var e=this;e.dialog=new t({className:"site-reset",closable:!0,header:"<h4>"+o.Filter_Dialog_Unit_Header+"</h4>",body:this.MainContainer,footer:this.createActionsPresenter(),events:{onHide:function(){s.ModelEvents.publish({event:"UnitsDialogClosed",data:{model:null}}),e.dialog.destroy()}}}).inject(s.renderTo=document.body),e.dialog.elements.body.addClassName("unitbody-modal-body"),e.dialog.elements.content.addClassName("unit-modal-content"),e.dialog.show(),e.dialog.getContent().getElements(".btn-primary").forEach((function(t){t.addEvent("click",(function(){s.ModelEvents.publish({event:"UnitsDialogClosed",data:{model:e.selectedNodes}}),e.dialog.destroy()}))})),e.dialog.getContent().getElements(".btn-default").forEach((function(t){t.addEvent("click",(function(){e.selectedNodes=[],s.ModelEvents.publish({event:"UnitsDialogClosed",data:{model:null}}),e.dialog.destroy()}))}))},getLayout:function(){var e=this,t={isHeader:!0,isFooter:!0,firstButtonText:o.CFG_Apply,secondButtonText:o.CFG_Back,headerText:o.Filter_Dialog_Unit_Header,onButtonClickCB:function(t){if("firstButton"==t.buttonId){if(0==e.CfgUnit.validate()||e.CfgUnit.fields.length>0&&e.CfgUnit.fields[0].includes("NOT"))return void e.CfgUnit.showAlert();s.ModelEvents.publish({event:"UnitsDialogClosed",data:{model:e.selectedNodes}})}else"secondButton"==t.buttonId&&s.ModelEvents.publish({event:"UnitsDialogClosed",data:{model:null}});e.containerView.destroy()}};this.containerView=new c(t).render(),this.containerView.getContent().addClassName("CfgContainerView-EditEvolution-SelectEvolutionData"),this.containerView.inject(s.renderTo),this.MainContainer.inject(this.containerView._body)},getPanel:function(){var e=this,t={dialogue:{buttonArray:[{label:o.Filter_Cancel,handler:function(){e.selectedNodes=[],s.ModelEvents.publish({event:"UnitsDialogClosed",data:{model:null}}),require(["DS/CfgFilterUX/CfgFilterFactory"],(function(e){s.renderToApp&&s.renderToApp.empty(),e.showFilter()}))},className:"default"},{label:o.Filter_Apply,handler:function(t){s.ModelEvents.publish({event:"UnitsDialogClosed",data:{model:e.selectedNodes}}),require(["DS/CfgFilterUX/CfgFilterFactory"],(function(e){s.renderToApp&&s.renderToApp.empty(),e.showFilter()}))},className:"primary"}],showHeader:!0,showButton:!0},HeaderLabel:o.Filter_Dialog_Unit_Header,displayCompactMode:this.opts.displayCompactMode};l.init(s.renderToApp,this.MainContainer,t,r)},createActionsPresenter:function(){var e=UWA.createElement("div",{});new i({value:o.Filter_Apply,className:"primary btn btn-primary okBtn"}).inject(e),new i({value:o.Filter_Cancel}).inject(e);return e},selectNodesByBuildNumber:function(e){this.selectedNodes=[];const t=this.tree.getTreeDocument().getRoots();for(let i=0;i<e.length;i++)if(-1!=e[i].indexOf("+")){let n=e[i].split("+").slice(0,-1);t.forEach((e=>{(parseInt(e.getAttributeValue("buildnumber"))>=parseInt(n)||e.getAttributeValue("buildnumber")==o.unitInfinity)&&(this.select(e),-1==this.selectedNodes.indexOf(e.getAttributeValue("buildnumber"))&&this.selectedNodes.push(e.getAttributeValue("buildnumber")))}))}else t.forEach((t=>{t.getAttributeValue("buildnumber")==e[i]&&(this.select(t),-1==this.selectedNodes.indexOf(t.getAttributeValue("buildnumber"))&&0==this.isFrozen(t)&&this.selectedNodes.push(t.getAttributeValue("buildnumber")),-1==this.selectedNodes.indexOf(t.getAttributeValue("buildnumber"))&&this.selectedNodes.push(t.getAttributeValue("buildnumber")))}));t.forEach((e=>{this.selectedNodes.includes(e.getAttributeValue("buildnumber"))||0!=this.isFrozen(e)||this.unselect(e)}))},parseTextInputAndSelect:function(e){const t=[];for(let i=0;i<e.length;i++){if(-1!==e[i].indexOf("-")){let o=e[i].split("-");for(;parseInt(o[0])<=parseInt(o[1]);){t.push(o[0]);let e=o[0];e++,o[0]=e.toString()}}else t.push(e[i])}this.frozenArray.forEach((e=>{t.includes(e)||t.push(e)})),this.selectNodesByBuildNumber(t)},filterBuilds:function(){const e=[],t=this.unitSearchEditor.valueToCommit.split(",");for(let i=0;i<t.length;i++)e.push(t[i]);let i=[];this.selectedNodes&&this.selectedNodes.length>0&&(i=[...this.selectedNodes]);let n=this.tree.getTreeDocument();const s=n.getRoots();n.prepareUpdate();for(let t=0;t<e.length;t++){let n=e[t];s.forEach((e=>{let t=e.getAttributeValue("buildnumber"),s=e.getAttributeValue("label");if(t.indexOf(n)>-1||s.toUpperCase().indexOf(n.toUpperCase())>-1){for(var a=0;a<i.length;a++)if(t==i[a]){this.select(e);break}t==o.unitInfinity?(this.programaticUnSel=1,e.hide(),this.programaticUnSel=0):(this.programaticSel=1,e.show(),this.programaticSel=0)}else this.programaticUnSel=1,e.hide(),this.programaticUnSel=0}))}n.pushUpdate()},select:function(e){this.programaticSel=1,e.select(),console.log(`selected ${e.getAttributeValue("buildnumber")}`),this.programaticSel=0},unselect:function(e){this.programaticUnSel=1,0==this.isFrozen(e)&&(e.unselect(),console.log(`unselected ${e.getAttributeValue("buildnumber")}`)),this.programaticUnSel=0},prepareModel:function(e){if(!Array.isArray(e)&&e.length<=0)return;let t=new h;return t.prepareUpdate(),e.forEach((e=>{(this.existingEffectivityArray.includes(e.buildnumber)||"Complete"!=e.status)&&t.addRoot(e)})),t.pushUpdate(),t},isFrozen:function(e){return"Complete"==e.getAttributeValue("status")||"Release"==e.getAttributeValue("status")||"Obsolete"==e.getAttributeValue("status")},buildExistingEffectivityArray:function(e,t){for(let i=0;i<e.length;i++){if(-1!==e[i].indexOf("-")){let t=e[i].split("-");for(;parseInt(t[0])<=parseInt(t[1]);){this.existingEffectivityArray.push(t[0]);let e=t[0];e++,t[0]=e.toString()}}else for(let i=0;i<e.length;i++)if(-1!=e[i].indexOf("+")){let o=e[i].split("+").slice(0,-1);for(let e=0;e<t.length;e++)-1==this.existingEffectivityArray.indexOf(t[e].buildOrder)&&t[e].buildOrder>=parseInt(o)&&this.existingEffectivityArray.push(t[e].buildOrder)}else this.existingEffectivityArray.push(e[i])}},buildFrozenArray:function(e){for(let t=0;t<e.length;t++)this.existingEffectivityArray.includes(e[t].buildOrder)&&"Complete"==e[t].current&&this.frozenArray.push(e[t].buildOrder)}}})),define("DS/CfgEvolutionUX/CfgConfigurationRevisionPicker",["DS/UIKIT/Input/Text","DS/Controls/TooltipModel","UWA/Class/View","DS/CfgBaseUX/scripts/CfgData","DS/CfgBaseUX/scripts/CfgConfigurationRevisionFactory","DS/CfgFilterUX/CfgFilterSlideInComponent","DS/CfgBaseUX/scripts/CfgContainerView","text!DS/CfgFilterUX/CfgFilterslideInDialogTemplate.html","i18n!DS/CfgBaseUX/assets/nls/CfgBaseUXNLS","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX","css!DS/CfgEvolutionUX/CfgEvolutionUX.css"],(function(e,t,i,o,n,s,a,l,r,d){"use strict";return i.extend({editButton:null,textdiv:null,xml:null,xmlDesc:[],selectedNode:null,displayExpression:"",setup:function(e){this._parent(e)},render:function(){var e=this;this.textBox=UWA.createElement("div").inject(this.options.parentElement),this.textBox.addClassName("CfgEditor"),this.textBox.setStyle("marginBottom","10px"),this.textBox.set({events:{click:function(t){e.onCriteriaClickHandler(t)}}}),this.textBox.setAttributeNode(document.createAttribute("edit-mode")),this.editButton=UWA.createElement("span").inject(this.options.parentElement),this.editButton.set({events:{click:function(t){e.onCriteriaClickHandler(t)}}}),this.editButton.addClassName("fonticon"),this.editButton.addClassName("fonticon-1.5x"),this.editButton.addClassName("fonticon-search"),this.editButton.addClassName("searchbutton"),this.options.iSelectedId&&(this.selectedNode=this.options.iSelectedId),this.selectedNode&&this.textBox.setText(this.selectedNode.displayName+"-"+this.selectedNode.revision),this.applyCompactComfortableMode()},applyCompactComfortableMode:function(){null==this.options.displayCompactMode||!1===this.options.displayCompactMode?(this.textBox.setAttributeNode(document.createAttribute("touch-mode")),this.editButton&&this.editButton.setAttributeNode(document.createAttribute("touch-mode"))):(this.textBox.removeAttribute("touch-mode"),this.editButton&&this.editButton.removeAttribute("touch-mode"))},onCriteriaClickHandler:function(e){var t=this;t.editButton&&1==t.editButton.hasClassName("disableButton")||1==t.textBox.hasClassName("disableButton")||(t.editButton&&t.editButton.addClassName("disableButton"),t.textBox.addClassName("disableButton"),t.createContainer(),t.createVersionExplorer(),t.editButton&&t.editButton.removeClassName("disableButton"),t.textBox.removeClassName("disableButton"))},buildDisplayExpression:function(){return this.displayExpression},buildFilterJson:function(){return this.options.psJson},buildFilterXML:function(){return this.xml},buildDescription:function(){return this.xmlDesc},show:function(){this.textBox.show(),this.editButton&&this.editButton.show()},hide:function(){this.textBox.hide(),this.editButton&&this.editButton.hide()},createVersionExplorer:function(){this.cfgConfigurationRevisionPicker=new n;this.cfgConfigurationRevisionPicker.create(this.options.iRootId,(()=>{}),enoviaServerFilterWidget.tenant,enoviaServerFilterWidget.baseURL,enoviaServerFilterWidget.getSecurityContext(),this.MainContainer,this.selectedNode,this.cfgConfigurationRevisionPicker.vEObject)},onOK:function(){var e=this.cfgConfigurationRevisionPicker.getVEObject().getSelectedNodes();0!=e.length?(this.selectedNode=e[0]._options.data,this.textBox.setText(e[0]._options.data.displayName+"-"+e[0]._options.data.revision),o.ModelEvents.publish({event:"CRSelected"})):(this.textBox.setText(""),this.selectedNode=null,o.ModelEvents.publish({event:"CRDelected"}))},createContainer:function(){this.MainContainer=new UWA.createElement("div",{styles:{height:"100%",width:"100%"}}),this.MainContainer.setAttribute("id","MainPrdContainer");var e=this;if("Native"==window.enoviaServerFilterWidget.mode){o.ModelEvents.publish({event:"LaunchingDictionarySelection",data:{}});var t={isHeader:!0,isFooter:!0,firstButtonText:d.CFG_Apply,secondButtonText:d.CFG_Back,headerText:r.SelectConfiguredRevision,onButtonClickCB:function(t){"firstButton"==t.buttonId?(e.onOK(),o.ModelEvents.publish({event:"ConfigRevisionDialogClosed",data:{}})):"secondButton"==t.buttonId&&o.ModelEvents.publish({event:"ConfigRevisionDialogClosed",data:{model:null}}),e.containerView.destroy()}};this.containerView=new a(t).render(),this.containerView.inject(o.renderToApp),this.MainContainer.inject(this.containerView._body)}else{t={dialogue:{buttonArray:[{label:r.CfgLabelCancel,handler:function(){require(["DS/CfgFilterUX/CfgFilterFactory"],(function(e){o.renderToApp&&o.renderToApp.empty(),e.showFilter()}))},className:"default"},{label:r.CfgLabelOK,handler:function(t){e.onOK(),require(["DS/CfgFilterUX/CfgFilterFactory"],(function(e){o.renderToApp&&o.renderToApp.empty(),e.showFilter()}))},className:"primary"}],showHeader:!0,showButton:!0},HeaderLabel:r.SelectConfiguredRevision,displayCompactMode:this.options.displayCompactMode};s.init(o.renderToApp,this.MainContainer,t,l)}}})})),define("DS/CfgEvolutionUX/CfgModelSelection",["UWA/Drivers/Alone","DS/Core/Core","DS/Controls/ComboBox","UWA/Class/View","DS/CfgBaseUX/scripts/CfgData","UWA/Class/Promise","DS/CfgBaseUX/scripts/CfgUtility"],(function(e,t,i,o,n,s,a){"use strict";return o.extend({combobox:null,setup:function(e){this._parent(e),this.probesData=[]},render:function(){var e=this;if(this.options.Data.length>1)e.combobox=new i({elementsList:this.options.Data,selectedIndex:this.options.currentindex}).inject(this.options.parentElement),e.combobox.addEventListener("change",(function(){e.probesData.push("Configuration_Context_Dropdown_Click"),e.getcriteriasAvailable(e).then((function(t){n.criteriasAvailable=t.criteria[0],console.log(n.criteriasAvailable);var i={valueItem:e.combobox.currentValue,labelItem:e.combobox.currentLabel,name:e.getSelectedModelName(),criteriasAvailable:n.criteriasAvailable};n.CurrentFilterModel={model:i},n.ModelEvents.publish({event:"modelUpdated",data:{model:i}})}))}));else{var t=new UWA.Element("div",{class:"wux-control-inline-container modelNameFilter",text:this.options.Data[0].labelItem});if(this.options&&this.options.Data&&this.options.Data[0]&&this.options.Data[0].icon){UWA.createElement("img",{src:this.options.Data[0].icon}).inject(this.options.parentElement)}t.inject(this.options.parentElement)}},getcriteriasAvailable:function(e){var t=e;return new s((function(e,i){var o={version:"1.0.0",modelIds:[{id:"pid:"+t.get()}]};o=JSON.stringify(o);a.makeWSCall("/resources/modeler/browsing/model/getcriteria","POST","enovia","application/json",o,(function(t){e(t)}),(function(e){console.log("fail to get last product evolution")}),!0)}))},get:function(){return this.options.Data.length>1?this.combobox.currentValue:this.options.Data[0].valueItem},getSelectedModelLabel:function(){const e=this.get();for(let t=0;t<this.options.Data.length;t++)if(this.options.Data[t].valueItem==e)return this.options.Data[t].labelItem},getSelectedModelName:function(){for(var e=this.get(),t=0;t<this.options.Data.length;t++)if(this.options.Data[t].valueItem==e)return this.options.Data[t].name},setModel:function(e){this.combobox.selectedIndex=this.options.Data.findIndex((function(t){return t.valueItem==e}))}})})),define("DS/CfgEvolutionUX/CfgWUXUnitLayout",["UWA/Drivers/Alone","DS/Core/Core","DS/UIKIT/Iconbar","DS/UIKIT/Modal","DS/UIKIT/Input","DS/UIKIT/Input/Button","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX","i18n!DS/CfgBaseUX/assets/nls/CfgBaseUXNLS","DS/Tree/TreeListView","DS/CfgBaseUX/scripts/CfgData","DS/UIKIT/Tooltip","DS/CfgFilterUX/CfgFilterSlideInComponent","text!DS/CfgFilterUX/CfgFilterslideInDialogTemplate.html","DS/UIKIT/Mask","DS/CfgBaseUX/scripts/CfgContainerView","DS/CfgBaseUX/scripts/CfgToggle","DS/Controls/LineEditor","DS/CfgBaseUX/scripts/CfgEffectivityExpressionContainer","css!DS/CfgEvolutionUX/CfgEvolutionUX.css"],(function(e,t,i,o,n,s,a,l,r,d,c,p,u,m,h,g,f,C){"use strict";return{CfgExpressionBox:!1,listViewClickCount:0,create:function(e,t,o,n){var s=this;s.listViewClickCount=0,this.fields=t,this.event1,this.ExpressionMode=!1,this.selectedNodes=[],this.currentModel=o,this.MainContainer=new UWA.Element("div",{class:" maincontainer-class"}),this.opts=n,this.CfgUnitToolbarContainer=UWA.createElement("div",{class:"unitToolbarContainer"});var d={toggleID:"cfgUnitInfiniteToggle",toggleLabel:a.Filter_InfinitySelectionMode,toggleTooltip:a.Infinitytooltip,width:"auto"};this.unitInfiniteToggle=new g(d),this.unitInfiniteToggleContainer=this.unitInfiniteToggle.render(),!0===this.opts.isReadOnly&&this.unitInfiniteToggleContainer.hide(),n.rangeEnable&&this.unitInfiniteToggle.setToggleState(!0),this.expressionToolbarContainer=UWA.createElement("div",{class:"expressionToolbarContainer"}),this.expressionToolbar=new i({renderTo:s.expressionToolbarContainer,items:[{className:"divider"},{fonticon:"book-open",text:l.CfgExpressionView,handler:function(){!1===s.CfgExpressionBox?(s.expressionToolbarContainer.getElement("span.fonticon-book-open").setStyle("color","#b4b6ba"),s.CfgExpressionBox=!0,s.cfgExpressionViewObj.hideShowExpressionContainer()):(s.expressionToolbarContainer.getElement("span.fonticon-book-open").setStyle("color","#42a2da"),s.CfgExpressionBox=!1,s.cfgExpressionViewObj.hideShowExpressionContainer())}}]}),this.unitInfiniteToggleContainer.appendChild(this.expressionToolbarContainer),this.unitInfiniteToggleContainer.inject(this.CfgUnitToolbarContainer),this.applyCompactComfortableModeViewExpressionIcon(),this.inputContainer=new UWA.Element("div",{class:"cfgSearchUnitInputContainer"}).inject(this.CfgUnitToolbarContainer),this.CfgUnitToolbarContainer.appendChild(this.unitInfiniteToggleContainer),this.tooltipForFilter=new c({className:"mytooltip",target:this.inputContainer,body:a.TypeFilter_Number,position:"left"}),this.lineEditor=new f({placeholder:a.Filter_Dialod_Unit_Search_Placeholder,selectAllOnFocus:!0,displayClearFieldButtonFlag:!0}).inject(this.inputContainer),this.lineEditor.addEventListener("uncommittedChange",(function(){s.buildSequenceInsideTable()})),this.MainContainer.addClassName("mainContainerFilterUnit");var p=[];this.selectedRow=[],this.textboxinput=this.fields.split(",");var u=e.builds;this.rootBuildsData(p,u);var h={apiVersion:2,margin:"2px",padding:"2px",changeColorOnFocus:!1,selection:{canMultiSelect:!0,isDraggable:!1,unselectAllOnEmptyArea:!1,nodes:!s.opts.isReadOnly},resize:{rows:!1,columns:!0},columns:[{text:"",dataIndex:"tree",isHidden:!0,enableDragAndDrop:!1,isSortable:!1,isDraggable:!1},{text:a.Filter_Name,dataIndex:"label",enableDragAndDrop:!1,isSortable:!1,isDraggable:!1,width:120},{text:a.Filter_Number,dataIndex:"buidnumber",enableDragAndDrop:!1,isSortable:!1,isDraggable:!1},{text:a.Filter_Status,dataIndex:"status",enableDragAndDrop:!1,isSortable:!1,isDraggable:!1,width:"auto"},{text:a.UnitDescription,dataIndex:"description",enableDragAndDrop:!1,isSortable:!1,isDraggable:!1,width:"auto"}],roots:p,alternateRowColor:!0};h.columns.splice(0,0,{text:"",dataIndex:"selection",type:"selection",width:45,isDraggable:!1,isHidden:!!s.opts.isReadOnly});var C=new r(h);C.getManager().forceMultiSelection(!0),C.getDocument().options.shouldAcceptDrag=function(){return!1},C.getDocument().options.shouldAcceptDrop=function(){return!1},this.unitLayoutTreeListViewContainer=new UWA.Element("div",{class:"unitLayoutTreeListViewContainer"}),C.inject(this.unitLayoutTreeListViewContainer),C.elements.container.addClassName("unitalternaterow"),C.elements.container.addClassName("unitheader"),C.elements.container.addClassName("unithighlighted"),C.getNthRoot(0).hide(),this.unitLayoutExpressionDiv=new UWA.Element("div",{class:"unitLayoutExpressionDiv"}),s.initialiseExpressionContainer(),s.tree=C,UWA.Element.addEvent.call(document,"keyup",(function(e){s.event1=e.shiftKey,s.tree.getManager().forceMultiSelection(!0)})),UWA.Element.addEvent.call(document,"keydown",(function(e){s.event1=e.shiftKey,s.tree.getManager().forceMultiSelection(!0)})),s.tree.onNodeClick((function(e){s.listViewClickCount++,!0!==s.opts.isReadOnly&&("label"!=e.dataIndex&&"buidnumber"!=e.dataIndex&&"status"!=e.dataIndex&&"description"!=e.dataIndex||""!=e.nodeModel)&&("selection"==e.dataIndex&&""==e.nodeModel?s.selectionNodeData(e):1==s.event1&&0==s.unitInfiniteToggle.cfgToggle.checkFlag&&s.tree.getManager().getDocument().getXSO().get().length>=1?s.selectionNodewithShiftKey(e):s.selectionNodeData(e))})),this.buildOrderSequence(this.textboxinput),"Filter"!=this.opts.invokeFrom||"Native"==window.enoviaServerFilterWidget.mode?this.getLayout():this.getPanel(),require(["DS/CfgEvolutionUX/CfgUnit"],(function(t){s.CfgUnit=new t({parentElement:s.unitLayoutExpressionDiv}),s.CfgUnit.ExpressionMode=!0,s.CfgUnit.allRoots=s.tree.getRoots(),s.CfgUnit.selectedNodes=s.selectedNodes,s.CfgUnit.currentDictionary=e,s.CfgUnit.currentModel=s.currentModel,s.CfgUnit.fields=s.fields,s.CfgUnit.render(),s.CfgUnit.editButton.hide(),s.CfgUnit.textBox.value=s.CfgUnit.fields,!0===s.opts.isReadOnly&&(s.CfgUnit.textBox.disabled=!0),"Filter"==s.opts.invokeFrom&&m.unmask(s.opts.filterParent)}));new ResizeObserver((e=>{e[0].target.getDimensions().width<530&&a.Filter_InfinitySelectionMode.length>25||e[0].target.getDimensions().width<460&&a.Filter_InfinitySelectionMode.length>20||e[0].target.getDimensions().width<370?this.unitInfiniteToggle.hideToggleLabel("UNIT"):(e[0].target.getDimensions().width>=420&&a.Filter_InfinitySelectionMode.length<=20||e[0].target.getDimensions().width>=475&&a.Filter_InfinitySelectionMode.length<=25||e[0].target.getDimensions().width>=530)&&this.unitInfiniteToggle.showToggleLabel("UNIT")})).observe(this.CfgUnitToolbarContainer),this.CfgUnitToolbarContainer.getDimensions().width<420&&a.Filter_InfinitySelectionMode.length>25&&this.unitInfiniteToggle.hideToggleLabel("UNIT")},applyCompactComfortableModeViewExpressionIcon:function(){null==this.opts.displayCompactMode||0==this.opts.displayCompactMode?(this.expressionToolbarContainer.getElement(".divider").setAttributeNode(document.createAttribute("touch-mode")),this.expressionToolbarContainer.getElement("span.fonticon-book-open").setAttributeNode(document.createAttribute("touch-mode")),this.expressionToolbarContainer.getElement(".item").setAttributeNode(document.createAttribute("touch-mode"))):(this.expressionToolbarContainer.getElement(".divider").removeAttribute("touch-mode"),this.expressionToolbarContainer.getElementsByClassName("fonticon-book-open")[0].removeAttribute("touch-mode"),this.expressionToolbarContainer.getElement(".item").removeAttribute("touch-mode"))},initialiseExpressionContainer:function(){UWA.createElement("div",{styles:{height:"100%"},html:[this.CfgUnitToolbarContainer,this.unitLayoutTreeListViewContainer]}).inject(this.MainContainer);var e={viewContainer:this.MainContainer,effExpHeaderTitle:a.Filter_UnitExpression,expressionContainer:this.unitLayoutExpressionDiv,defaultExpressionContainerHeight:60,displayCompactMode:this.opts.displayCompactMode,inputData:"",minimizeTooltip:l.CfgLabelMinimize,maximizeTooltip:l.CfgLabelMaximize};this.cfgExpressionViewObj=new C(e),this.cfgExpressionViewObj.render()},selectionNodewithShiftKey:function(e){var t=this,i=this.tree.getManager().getDocument().getAllDescendants();i.splice(0,1);var o=t.tree.getManager().getDocument().getXSO().get().length;"selection"==e.dataIndex?this.lastselectedNode=t.tree.getManager().getDocument().getXSO().get()[o-1]:this.lastselectedNode=t.tree.getManager().getDocument().getXSO().get()[o-2];var n=i.length;if(parseInt(this.lastselectedNode.options.buildnumber)>parseInt(e.nodeModel.options.buildnumber))for(var s=0;s<n;s++){(a=i[s]).options.buildnumber==this.lastselectedNode.options.buildnumber&&(l=0),0==l&&(a.select(),-1==this.selectedNodes.indexOf(a.options.buildnumber)&&this.selectedNodes.push(a.options.buildnumber)),e.nodeModel.options.buildnumber==a.options.buildnumber&&(l=1)}else for(s=0;s<n;s++){var a,l;(a=i[s]).options.buildnumber==e.nodeModel.options.buildnumber&&(l=0),0==l&&(a.select(),-1==this.selectedNodes.indexOf(a.options.buildnumber)&&this.selectedNodes.push(a.options.buildnumber)),a.options.buildnumber==this.lastselectedNode.options.buildnumber&&(l=1)}var r={model:t.selectedNodes};t.CfgUnit.selectionBuilds(r)},selectionNodeData:function(e){var t=this;if(""!=e.nodeModel){if(1!=this.unitInfiniteToggle.cfgToggle.checkFlag||e.isHeader)this.selectionCheck=e.nodeModel.isSelected(),this.selectionCheck?-1==t.selectedNodes.indexOf(e.nodeModel.options.buildnumber)&&t.selectedNodes.push(e.nodeModel.options.buildnumber):(t.selectedNodes.indexOf(e.nodeModel.options.buildnumber)>-1&&(t.selectedNodes.erase(e.nodeModel.options.buildnumber),e.nodeModel.unselect()),-1==t.selectedNodes.indexOf(t.tree.getNthRoot(1).options.buildnumber)&&t.selectedNodes.indexOf(a.unitInfinity)>-1&&(t.selectedNodes.erase(a.unitInfinity),t.tree.getNthRoot(0).unselect()));else if(this.selectionCheck=e.nodeModel.isSelected(),this.selectionCheck)for(var i=(l=this.tree.getManager().getDocument().getAllDescendants()).length,o=0,n=0;n<i;n++){var s=(r=l[n]).isRoot();0==o&&1==s&&(r.select(),-1==this.selectedNodes.indexOf(r.options.buildnumber)&&this.selectedNodes.push(r.options.buildnumber)),e.nodeModel.options.buildnumber==r.options.buildnumber&&(o=1)}else{var l;for(i=(l=this.tree.getManager().getDocument().getAllDescendants()).length,o=0,n=0;n<i;n++){var r;s=(r=l[n]).isRoot();0==o&&1==s&&(r.unselect(),this.selectedNodes.indexOf(r.options.buildnumber)>-1&&this.selectedNodes.erase(r.options.buildnumber)),e.nodeModel.options.buildnumber==r.options.buildnumber&&(o=1)}}c={model:t.selectedNodes},p=t.CfgUnit.selectionBuilds(c);t.CfgUnit.textBox.value=p}else{if(0!=t.tree.getManager().getDocument().getXSO().get().length){t.tree.getRoots().forEach((function(e){e.select()}));var d=t.tree.getManager().getDocument().getSelectedNodes();t.selectedNodes=[],d.forEach((function(e){t.selectedNodes.push(e.options.buildnumber)}))}else t.tree.getRoots().forEach((function(e){e.unselect(),t.selectedNodes=[]}));var c={model:t.selectedNodes},p=t.CfgUnit.selectionBuilds(c);t.CfgUnit.textBox.value=p}},rootBuildsData:function(e,t){var i={label:" ",buildnumber:a.unitInfinity,status:" ",grid:{label:" ",buidnumber:a.unitInfinity,status:" ",description:""}};if(e.push(i),null!=t&&(0!==Object.keys(t).length||t.constructor!==Object)){for(var o=0;o<t.length;o++){var n={label:t[o].name,buildnumber:t[o].buildOrder,id:t[o].id,status:t[o].current,grid:{label:t[o].name,buidnumber:t[o].buildOrder,status:t[o].current_NLS,description:t[o].description?t[o].description.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"):""}};e.push(n)}e.sort((function(e,t){return parseInt(t.buildnumber)-parseInt(e.buildnumber)}))}},getModal:function(){var e=this;e.dialog=new o({className:"site-reset",closable:!0,header:"<h4>"+a.Filter_Dialog_Unit_Header+"</h4>",body:this.MainContainer,footer:this.createActionsPresenter(),events:{onHide:function(){d.ModelEvents.publish({event:"UnitsDialogClosed",data:{model:null}}),e.dialog.destroy()}}}).inject(d.renderTo=document.body),e.dialog.elements.body.addClassName("unitbody-modal-body"),e.dialog.elements.content.addClassName("unit-modal-content"),e.dialog.show(),e.dialog.getContent().getElements(".btn-primary").forEach((function(t){t.addEvent("click",(function(){d.ModelEvents.publish({event:"UnitsDialogClosed",data:{model:e.selectedNodes}}),e.dialog.destroy()}))})),e.dialog.getContent().getElements(".btn-default").forEach((function(t){t.addEvent("click",(function(){e.selectedNodes=[],d.ModelEvents.publish({event:"UnitsDialogClosed",data:{model:null}}),e.dialog.destroy()}))}))},getLayout:function(){var e=this,t={isHeader:!0,isFooter:!0,firstButtonText:a.CFG_Apply,secondButtonText:a.CFG_Back,headerText:a.Filter_Dialog_Unit_Header,onButtonClickCB:function(t){if("firstButton"==t.buttonId){if(0==e.CfgUnit.validate()||e.CfgUnit.fields.length>0&&e.CfgUnit.fields[0].includes("NOT"))return void e.CfgUnit.showAlert();let t={type:"UNITS",listViewClickCount:e.listViewClickCount,toggleClickCount:e.unitInfiniteToggle.toggleClickCount-1};d.ModelEvents.publish({event:"UnitsDialogClosed",data:{model:e.selectedNodes,probesData:t}})}else"secondButton"==t.buttonId&&d.ModelEvents.publish({event:"UnitsDialogClosed",data:{model:null}});e.containerView.destroy()}};this.containerView=new h(t).render(),this.containerView.getContent().addClassName("CfgContainerView-EditEvolution-SelectEvolutionData"),this.containerView.inject(d.renderTo),this.MainContainer.inject(this.containerView._body)},getPanel:function(){var e=this,t={dialogue:{buttonArray:[{label:a.Filter_Cancel,handler:function(){e.selectedNodes=[],d.ModelEvents.publish({event:"UnitsDialogClosed",data:{model:null}}),require(["DS/CfgFilterUX/CfgFilterFactory"],(function(e){d.renderToApp&&d.renderToApp.empty(),e.showFilter()}))},className:"default"},{label:a.Filter_Apply,handler:function(t){let i={type:"UNITS",listViewClickCount:e.listViewClickCount,toggleClickCount:e.unitInfiniteToggle.toggleClickCount-1};d.ModelEvents.publish({event:"UnitsDialogClosed",data:{model:e.selectedNodes,probesData:i}}),require(["DS/CfgFilterUX/CfgFilterFactory"],(function(e){d.renderToApp&&d.renderToApp.empty(),e.showFilter()}))},className:"primary"}],showHeader:!0,showButton:!0},HeaderLabel:a.Filter_Dialog_Unit_Header,displayCompactMode:this.opts.displayCompactMode};p.init(d.renderToApp,this.MainContainer,t,u)},createActionsPresenter:function(){var e=UWA.createElement("div",{});new s({value:a.Filter_Apply,className:"primary btn btn-primary okBtn"}).inject(e),new s({value:a.Filter_Cancel}).inject(e);return e},selectNodesByBuildNumber:function(e){var t=this;t.selectedNodes=[];for(var i=this.tree.getManager().getDocument().getAllDescendants(),o=0;o<e.length;o++)if(-1!=e[o].indexOf("+")){var n=e[o].split("+").slice(0,-1);i.forEach((function(e){(parseInt(e.options.buildnumber)>=parseInt(n)||e.options.buildnumber==a.unitInfinity)&&(e.select(),-1==t.selectedNodes.indexOf(e.options.buildnumber)&&t.selectedNodes.push(e.options.buildnumber))}))}else i.forEach((function(i){i.options.buildnumber==e[o]&&(i.select(),-1==t.selectedNodes.indexOf(i.options.buildnumber)&&t.selectedNodes.push(i.options.buildnumber))}))},unitsFilterFromTable:function(e){var t=this;if(this.selectedRow=[],this.filterStatus=!1,void 0!==this.selectedNodes)for(var i=0;i<this.selectedNodes.length;i++)this.selectedRow.push(this.selectedNodes[i]);this.roots=this.tree.getRoots(),this.roots.length>0&&this.roots[0].prepareUpdate();for(i=0;i<e.length;i++)t.buildorder=e[i],this.roots.forEach((function(e){if(e.options.buildnumber.indexOf(t.buildorder)>-1||e.options.label.toUpperCase().indexOf(t.buildorder.toUpperCase())>-1){for(var i=0;i<t.selectedRow.length;i++)e.options.buildnumber==t.selectedRow[i]&&e.select();e.options.buildnumber==a.unitInfinity?e.hide():e.show()}else e.hide()}));this.roots[0].pushUpdate()},buildOrderSequence:function(e){this.sequenceNumber=[];for(var t=0;t<e.length;t++){if(-1!==e[t].indexOf("-"))for(var i=e[t].split("-");parseInt(i[0])<=parseInt(i[1]);){this.sequenceNumber.push(i[0]);var o=i[0];o++,i[0]=o.toString()}else this.sequenceNumber.push(e[t])}this.selectNodesByBuildNumber(this.sequenceNumber)},buildSequenceInsideTable:function(){this.sequenceNumber=[];for(var e=this.lineEditor.valueToCommit.split(","),t=0;t<e.length;t++)this.sequenceNumber.push(e[t]);this.unitsFilterFromTable(this.sequenceNumber)}}})),define("DS/CfgEvolutionUX/CfgEvolutionUtils",["UWA/Core","DS/CfgBaseUX/scripts/CfgEvolutionRange","DS/CfgBaseUX/scripts/CfgData","DS/CfgBaseUX/scripts/CfgXMLServices","DS/CfgBaseUX/scripts/CfgUtility"],(function(e,t,i,o,n){return{getEvolutionDisplayExpression:function(e,t,i){var s=i.xml,a="";-1==s.search("TreeSeries")&&-1==s.search("MilestonesTrack")?"PRODUCTS"==t?a=o.buildTreeSeries("ProductState",e,s):"MANUFACTURINGPLAN"==t?a=o.buildTreeSeries("ManufPlan",e,s):"XREVISION"==t&&(a=o.buildXRevision(s)):a=s;var l="";return l="XREVISION"===t?o.startxRevisionXML()+a+o.endxRevisionXML():i.description?o.startEvolutionXML()+a+"</Expression><Description>"+i.description+"</Description></CfgEffectivityExpression>":o.startFilterXML()+a+o.endFilterXML(),n.getDisplayExpressionUsingXSLT(l)},GetEvolutionExpressionAndJson:function(e,i){var o={xml:"",json:[]};if(e){var n=e.getRoots()[0];if(n){var s=[],a=e.getAllDescendants(),l=[];if(e.getSelectedNodes().forEach((function(e){l.push(e.options.id)})),l.indexOf(n.options.id)>=0&&""==n.__LISTVIEWCOPY__.options.grid.range){var r=n.options.name,d=n.options.revision,c=n.options.displayname?n.options.displayname:n.options.label,p=t.getRange(r,d,c);s.push(p)}this.parseEffectivity(null,n,s,a,l);var u=this.buildFilterXML(s,i);o.xml=u.xml,o.json=s,o.description=u.descTag}}return o},buildFilterXML:function(e,t){var i="";null==window.DescriptionCount&&(window.DescriptionCount=1);for(var o={iCount:window.DescriptionCount,iDescriptionTag:[]},n=0;n<e.length;n++)i+="XREVISION"===t?e[n].buildxRevisionXML(o):e[n].buildXML(o),o.iCount++,window.DescriptionCount++;return{xml:i,descTag:o.iDescriptionTag}},parseEffectivity:function(e,i,o,n,s){if(i){if(s.indexOf(i.options.id)>=0&&""!=i.__LISTVIEWCOPY__.options.grid.range&&null==e){var a=i.options.name,l=i.options.revision,r=i.options.displayname?i.options.displayname:i.options.label;e=t.getRange(a,l,r,!0),o.push(e)}var d=i.getChildren();null==d&&(d=[]);var c=null;if(1==(g=i.isRoot()))for(var p=n.length,u=0,m=0;m<p;m++){var h=n[m],g=h.isRoot();if(1==u&&1==g){c=h;break}1==g&&i.options.name==h.options.name&&i.options.revision==h.options.revision&&(u=1)}for(p=d.length,m=0;m<=p;m++){var f=null;if(m==p){if(null==c)continue;f=c}if(null==f&&(f=d[m]),f.options.label||1!=f.options.isEmpty){var C="";if(s.indexOf(f.options.id)>=0&&""!=f.__LISTVIEWCOPY__.options.grid.range?C="infinity":-1==s.indexOf(f.options.id)?C="unselected":s.indexOf(f.options.id)>=0&&""==f.__LISTVIEWCOPY__.options.grid.range&&(C="selected"),"unselected"!=C&&"selected"!=C||null==e){if("infinity"==C&&null!=e)this.parseEffectivity(e,f,o,n,s);else if("unselected"==C&&null==e){E=null;this.parseEffectivity(E,f,o,n,s)}else if("infinity"==C&&null==e){E=null;this.parseEffectivity(E,f,o,n,s)}else if("selected"==C&&null==e){b=f.options.name,D=f.options.revision,r=f.options.displayname?f.options.displayname:f.options.label;var v=t.getRange(b,D,r,!1);o.push(v);v=null;this.parseEffectivity(v,f,o,n,s)}}else{var x=!0;"selected"==C&&(x=!1);var b=f.options.name,D=f.options.revision,r=f.options.displayname?f.options.displayname:f.options.label;e.addLeaves(b,D,r,x);var E=null;this.parseEffectivity(E,f,o,n,s)}}}}},parseRootBranches:function(e,t){var i=[],o=!1;this.isFrozen(e.current)&&"FILTER"!=t&&(o=!0);var s=n.escapeSpecialCharacters(e.displayValue);null!=s&&null!=s&&0!=s.length||(s=e.name);var a={label:s,image:e.image,name:e.name,displayname:s,originated:e.originated,description:e.description,data:{frozen:o},icons:[],revision:e.revision,current:e.current_NLS,grid:{revision:e.revision},id:e.id,parentid:null,input:"Revision"};return i.push(a),e.Derived&&this.addChildren(a,e.Derived,e.id,"Derivation",t),this.mainderived(i,e["Main Derived"],e.id,"Revision",t),i},mainderived:function(e,t,i,o,s){if(null!=t&&(0!==Object.keys(t).length||t.constructor!==Object)){var a=!1;this.isFrozen(t.current)&&"FILTER"!=s&&(a=!0);var l=n.escapeSpecialCharacters(t.displayValue);null!=l&&null!=l&&0!=l.length||(l=t.name);var r={label:l,image:t.image,name:t.name,displayname:l,originated:t.originated,description:t.description,data:{frozen:a},icons:[],revision:t.revision,current:t.current_NLS,grid:{revision:t.revision},id:t.id,parentid:i,input:o};e.push(r),this.addChildren(r,t.Derived,t.id,"Derivation",s),this.mainderived(e,t["Main Derived"],t.id,"Revision",s)}},addChildren:function(e,t,i,o,s){null!=e.children&&0!=e.children.length||(e.children=[]);for(var a=0;a<t.length;a++){var l=!1;this.isFrozen(t[a].current)&&"FILTER"!=s&&(l=!0);var r=n.escapeSpecialCharacters(t[a].displayValue);null!=r&&null!=r&&0!=r.length||(r=t[a].name);var d={label:r,image:t[a].image,name:t[a].name,displayname:r,originated:t[a].originated,description:t[a].description,data:{frozen:l},revision:t[a].revision,current:t[a].current_NLS,grid:{revision:t[a].revision},id:t[a].id,parentid:i,input:o};e.children.push(d),this.addChildren(d,t[a].Derived,d.id,"Derivation",s);var c=t[a]["Main Derived"];0!=Object.keys(c).length&&c.constructor===Object&&this.addChildren(e.children[e.children.length-1],[c],e.children[e.children.length-1].id,"Revision",s)}},parseRevisionList:function(e,t){let i=[],o=[],n=new Map;return this.versionList=e.graphs[0].versions,this.versionList.forEach((e=>{if(e.ancestors&&e.ancestors[0]&&(n.has(e.ancestors[0].id)||n.set(e.ancestors[0].id,[]),n.get(e.ancestors[0].id).push(e.id)),!e.ancestors||!e.ancestors[0]||"D"!==e.ancestors[0].semantic){if(e.ancestors&&e.ancestors[0]&&"E"===e.ancestors[0].semantic){if(this.isDerived(e.ancestors[0].id))return}o.push(e.id)}})),o.forEach((e=>{i.push(this.buildVersionTree(e,n,o,t))})),i},isDerived:function(e){let t=this.versionList.find((t=>t.id===e));return!(!t||!t.ancestors||"D"!==t.ancestors[0].semantic)||!!(t&&t.ancestors&&t.ancestors[0].id)&&this.isDerived(t.ancestors[0].id)},buildVersionTree:function(e,t,i,o){let n,s=this.versionList.find((t=>t.id===e)),a=t.get(e)||[];n=s.ancestors&&s.ancestors[0]&&"D"===s.ancestors[0].semantic?this.buildVersion(s,"Derivation",o):this.buildVersion(s,"Revision",o);for(let e of a)i.includes(e)||n.children.push(this.buildVersionTree(e,t,i,o));return n},buildVersion:function(e,t,i){let o=!1;return this.isFrozen(e.maturity)&&"FILTER"!=i&&(o=!0),{label:e.label,image:e.image,name:"",displayname:e.label,originated:e.creation,description:e.description,data:{frozen:o},icons:[],revision:e.code,current:e.maturity_nls,grid:{revision:e.code},id:e.id,parentid:e.ancestors?e.ancestors[0].id:null,input:t,children:[]}},isFrozen:function(e){return!!["Obsolete","Release","Review","Archived","Frozen"].includes(e)}}})),define("DS/CfgEvolutionUX/CfgDateModel",["UWA/Core","UWA/Class/Model","DS/CfgBaseUX/scripts/CfgXMLServices","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX"],(function(e,t,i,o){return t.extend({urlRoot:"/Date",id:"",type:"",fromDate:"",fromDateMilliSec:"",fromDateMinValue:"",toDate:"",toDateMilliSec:"",toDateMinValue:"",isThisOnlyModelInCollection:!1,defaults:function(){return{id:"",type:"",fromDate:"",fromDateMilliSec:"",fromDateMinValue:"",toDate:o.CfgDateInf,toDateMilliSec:"",toDateMinValue:"",isThisOnlyModelInCollection:!1}},isEmpty:function(){return"single"==this.get("type")?""==this.get("fromDateMilliSec"):"range"==this.get("type")?""==this.get("fromDateMilliSec")&&""==this.get("toDateMilliSec"):void 0}})})),define("DS/CfgEvolutionUX/CfgVersionGraphLayout",["DS/UIKIT/Modal","DS/CfgBaseUX/scripts/CfgContainerView","DS/CfgBaseUX/scripts/CfgData","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgEvolutionUX/CfgEvolutionUtils","DS/CfgVersionGraphUX/scripts/CfgVersionGraph","DS/CfgVersionGraphUX/scripts/CfgVersionExplorer","DS/CfgFilterUX/CfgFilterSlideInComponent","DS/CfgBaseUX/scripts/CfgUXEnvVariables","text!DS/CfgFilterUX/CfgFilterslideInDialogTemplate.html","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX","css!DS/CfgEvolutionUX/CfgEvolutionUX.css"],(function(e,t,i,o,n,s,a,l,r,d,c){"use strict";return UWA.Class.extend({_options:null,init:function(e){this._parent(e)},create:async function(e){var t=this;if(t._options=e,t.MainContainer=new UWA.createElement("div",{styles:{height:"100%",width:"100%"}}),t.MainContainer.setAttribute("id","MainPrdContainer"),this.cfgUXEnvVariablesJS=r.getCfgUXEnvVariables(),this.cfgUXEnvVariablesJS.isVersionExplorer){t.versionGraph=new a(t._options),(await t.versionGraph.render()).inject(t.MainContainer)}else t.versionGraph=new s(t._options),t.versionGraph.getVersionGraph().inject(t.MainContainer);return t.buildContainers(),this},render:function(e){if(!this.cfgUXEnvVariablesJS.isVersionExplorer){this._options.data.rootBranches=e;var t=[];if(this._options.data.rootBranches.constructor===Array)for(var i=0;i<this._options.data.rootBranches.length;i++){if(this._options.data.rootBranches[i]&&Object.keys(this._options.data.rootBranches[i]).length>0&&this._options.data.rootBranches[i].constructor===Object)var o=n.parseRootBranches(this._options.data.rootBranches[i],this._options.use);o&&o.length>0&&o.forEach((function(e){t.push(e)}))}else n.mainderived(t,this._options.data.rootBranches,this._options.data.rootBranches.id,"Revision",this._options.use);this.versionGraph.render(t)}},buildContainers:function(){var o=this,n="";if("PRODUCTS"==o._options.mode?n=c.Filter_Dialog_Product:"MANUFACTURINGPLAN"==o._options.mode&&(n=c.Filter_Dialog_ManufacturingPlan),"EFF_VIEW"!=o._options.use)if(""==o._options.use||"Native"==window.enoviaServerFilterWidget.mode){var s={isHeader:!0,isFooter:!0,firstButtonText:o._options.firstButtonText||c.CFG_Apply,secondButtonText:o._options.secondButtonText||c.CFG_Back,headerText:n,toggleSessionEffectivity:o._options.propagateSessionEffectivity,onButtonClickCB:function(e){if("firstButton"==e.buttonId){var t=o.versionGraph.get();let n=1;n=null!=o.versionGraph.toggleClickCount?o.versionGraph.toggleClickCount:o.versionGraph.infiniteToggle.toggleClickCount-1,t.probesData={type:o._options.mode,listViewClickCount:o.versionGraph.listViewClickCount,toggleClickCount:n},"Native"==window.enoviaServerFilterWidget.mode&&o.setSingleProductId(t),i.ModelEvents.publish({event:"ProductStateDialogClosed",data:{model:null,xml:t.xml,json:t.json,xmlDesc:t.description,probesData:t.probesData,mode:o._options.mode,event:e}})}else"secondButton"==e.buttonId&&i.ModelEvents.publish({event:"ProductStateDialogClosed",data:{mode:"",event:e}});"singlePageTransition"!=o._options.transition&&o.containerView.destroy()}};o.containerView=new t(s).render(),o.containerView.getContent().addClassName("CfgContainerView-EditEvolution-SelectEvolutionData"),o.containerView.inject(i.renderTo),o.MainContainer.inject(o.containerView._body)}else if("FILTER"==o._options.use){s={dialogue:{buttonArray:[{label:c.Filter_Cancel,handler:function(){i.renderToApp&&i.renderToApp.empty(),require(["DS/CfgFilterUX/CfgFilterFactory"],(function(e){e.showFilter()}))},className:"default"},{label:c.Filter_Apply,handler:function(e){var t=o.versionGraph.get();let n=0;n=null!=o.versionGraph.toggleClickCount?o.versionGraph.toggleClickCount:o.versionGraph.infiniteToggle.toggleClickCount,t.probesData={type:o._options.mode,listViewClickCount:o.versionGraph.listViewClickCount,toggleClickCount:n},o.setSingleProductId(t),i.ModelEvents.publish({event:"ProductStateDialogClosed",data:{model:null,xml:t.xml,json:t.json,xmlDesc:t.description,probesData:t.probesData,mode:o._options.mode}}),require(["DS/CfgFilterUX/CfgFilterFactory"],(function(e){i.renderToApp&&i.renderToApp.empty(),e.showFilter()}))},className:"primary"}],showHeader:!0,showButton:!0},HeaderLabel:n,displayCompactMode:this._options.displayCompactMode};l.init(i.renderToApp,o.MainContainer,s,d)}else"EFFECTIVITY"==o._options.use&&(o.dialog=new e({className:"cfg-site-reset",closable:!0,header:"<h4>"+n+"</h4>",body:o.MainContainer,footer:'<button type="button" class="btn btn-primary">'+c.Filter_Apply+'</button> <button type="button" class="btn btn-default">'+c.Filter_Cancel+"</button>",events:{onHide:function(){o.dialog.destroy()}}}).inject(i.renderTo),o.dialog.show(),o.dialog.getContent().getElements(".btn-primary").forEach((function(e){e.addEvent("click",(function(){var e=o.versionGraph.get();i.ModelEvents.publish({event:"ProductStateDialogClosed",data:{model:null,xml:e.xml,json:e.json,xmlDesc:e.description,mode:o._options.mode}}),o.dialog.destroy()})),o.dialog.getContent().getElements(".btn-default").forEach((function(e){e.addEvent("click",(function(){o.dialog.destroy()}))}))})));else o.MainContainer.inject(o._options.parentGraphElement)},setSingleProductId:function(e){if("PRODUCTS"==this._options.mode&&(0!=e.json.length&&(i.singleProductId=""),1==e.json.length&&-1==e.xml.indexOf("<Tree>"))){var t=this.versionGraph.CfgSelectedNode[0].options.id;t&&(i.singleProductId=t.replace("pid:",""))}}})})),define("DS/CfgEvolutionUX/CfgXRevisionEvolutionLayout",["DS/CfgBaseUX/scripts/CfgUtility","DS/CfgBaseUX/scripts/CfgXRevisionUtility","DS/CfgBaseUX/scripts/CfgData","DS/CfgBaseUX/scripts/CfgContainerView","DS/CfgVersionGraphUX/scripts/CfgVersionGraph","DS/CfgVersionGraphUX/scripts/CfgVersionExplorer","DS/CfgBaseUX/scripts/CfgUXEnvVariables","DS/CfgEvolutionUX/CfgEvolutionUtils","text!DS/CfgFilterUX/CfgFilterslideInDialogTemplate.html","DS/CfgFilterUX/CfgFilterSlideInComponent","DS/CfgBaseUX/scripts/CfgCollection","DS/CfgBaseUX/scripts/CfgXMLServices","DS/CoreEvents/ModelEvents","i18n!DS/CfgBaseUX/assets/nls/CfgBaseUX","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX"],(function(e,t,i,o,n,s,a,l,r,d,c,p,u,m,h){"use strict";return UWA.Class.extend({init:function(e){this._parent(e)},create:async function(t){try{this.options=t;let i=this,o=i.options.xRevisionContent.referencePID,r=null!=this.options.displayCompactMode&&this.options.displayCompactMode;this.isExpressionModified=!1,this.probesData=[],this.cfgUXEnvVariablesJS=a.getCfgUXEnvVariables(),await e.populateDisplayExpressionXSLT(),t.hasEffectivity&&i.parseEffectivity();let d={mode:this.options.mode||"XREVISION",psJson:this.options.psJson,use:this.options.use,propagateSessionEffectivity:!0,displayexpression:this.options.displayexpression,xmlExpression:this.options.xmlExpression,xmlDesc:this.optionsxmlDesc,displayCompactMode:r,xRevGraphID:o};if(i.versionGraphOptions=d,i.MainContainer=new UWA.createElement("div",{styles:{height:"100%",width:"100%"}}),i.MainContainer.setAttribute("id","MainPrdContainer"),this.cfgUXEnvVariablesJS.isVersionExplorer){i.versionGraph=new s(d),(await i.versionGraph.render()).inject(i.MainContainer)}else{i.versionGraph=new n(d),i.versionGraph.getVersionGraph().inject(i.MainContainer);let t=await e.getversionGraph(o),s=l.parseRevisionList(t,i.versionGraphOptions.use);i.versionGraph.render(s)}i.buildContainers()}catch(e){console.error(e)}},buildContainers:function(){let e="CONFIGRECORD"==this.options.mode?h.Select_Record:h.Select_XRevision;if(i.xRevisionEvents=new u,"FILTER"==this.options.use&&enoviaServerFilterWidget&&"Native"!=enoviaServerFilterWidget.mode){const t=async e=>{let t={};if("cfgOKid"===e.dsModel.value&&(t=this.versionGraph.get(),"CONFIGRECORD"==this.options.mode&&this.setSingleConfigurationRecord(t),"XREVISION"==this.options.mode&&await this.setSingleProductId(t)),this.options.onButtonClickCB&&"function"==typeof this.options.onButtonClickCB){let i=0;i=null!=this.versionGraph.toggleClickCount?this.versionGraph.toggleClickCount:this.versionGraph.infiniteToggle.toggleClickCount;let o={listViewClickCount:this.versionGraph.listViewClickCount,toggleClickCount:i,type:"Effectivity_Based",mode:"Single_Context_Single_Criteria_"};this.options.onButtonClickCB({ExpAndJson:t,mode:"cfgOKid"===e.dsModel.value?this.options.mode:"",event:e,probesData:o})}i.renderToApp&&i.renderToApp.empty()},o={dialogue:{buttonArray:[{label:m.CFG_Cancel,handler:t,className:"default"},{label:m.CFG_Ok,handler:t,className:"primary"}],showHeader:!0,showButton:!0},HeaderLabel:e,displayCompactMode:this.options.displayCompactMode};d.init(i.renderToApp,this.MainContainer,o,r)}else{let t=async e=>{if("firstButton"==e.buttonId&&1==this.containerView._firstButton.disabled)return;let t={};if("firstButton"==e.buttonId&&(t=this.versionGraph.get(),"FILTER"==this.options.use&&("CONFIGRECORD"==this.options.mode&&this.setSingleConfigurationRecord(t),"XREVISION"==this.options.mode&&await this.setSingleProductId(t))),this.options.onButtonClickCB&&"function"==typeof this.options.onButtonClickCB){let i=1;i=null!=this.versionGraph.toggleClickCount?this.versionGraph.toggleClickCount:this.versionGraph.infiniteToggle.toggleClickCount-1;let o={listViewClickCount:this.versionGraph.listViewClickCount,toggleClickCount:i,type:"Effectivity_Based",mode:"Single_Context_Single_Criteria_"};this.options.onButtonClickCB({ExpAndJson:t,mode:"firstButton"===e.buttonId?this.options.mode:"",event:e,isExpressionModified:this.isExpressionModified,probesData:o})}"EditEvolution"==this.options.use&&enoviaServerFilterWidget&&"Native"==enoviaServerFilterWidget.mode||this.containerView.destroy()},n=e=>{e.propagateSessionEffectivity&&(this.containerView._firstButton.disabled=!1)},s=m.CFG_Ok,a=m.CFG_Cancel,l=this.versionGraphOptions.propagateSessionEffectivity;"Applicability"==this.options.use||"SessionEffectivity"==this.options.use?(s=this.options.firstButtonText,a=this.options.secondButtonText,l=!1):"FILTER"===this.options.use&&(l=!1);let r={isHeader:!0,isFooter:!0,firstButtonText:s,secondButtonText:a,headerText:e,toggleSessionEffectivity:l,onButtonClickCB:t,onCheckBoxClick:n};this.containerView=new o(r).render(),this.containerView.getContent().addClassName("CfgContainerView-XRevisionEvolution"),this.containerView.inject(this.options.parentElement),this.MainContainer.inject(this.containerView._body),this.containerView._firstButton.disabled=!0,i.xRevisionEvents.subscribe({event:"EvolutionExpressionUpdate"},(()=>{this.isExpressionModified=!0,this.containerView._firstButton.disabled=!1}))}},parseEffectivity:function(){let e=p.xRevisionXMLTOJsonConverter(this.options.effExpressionXml);e&&e[0]&&(this.options.displayexpression=e[0].displayexpression,this.options.psJson=e[0].expression.xRevJson,this.options.xmlExpression=e[0].expression.xRevXml)},setSingleProductId:async function(e){try{if(i.singleProductId="",1==e.json.length&&-1==e.xml.indexOf("<Tree>")){let e=this.versionGraph.CfgSelectedNode[0].options.id;if(e&&(e=e.replace("pid:","")),this.options.xRevScopeDefined){const o=await t.getRevisionVariantManagementInformation(e);o&&o.revision&&o.revision.identifier&&(i.singleProductId=o.revision.identifier)}}}catch(e){throw e}},setSingleConfigurationRecord:function(e){i.singleConfigurationRecordId=null,1==this.versionGraph.CfgSelectedNode.length&&(i.singleConfigurationRecordId=this.versionGraph.CfgSelectedNode[0].options.id)}})})),define("DS/CfgEvolutionUX/CfgUnit",["UWA/Drivers/Alone","DS/Core/Core","DS/UIKIT/Input/Text","DS/Controls/TooltipModel","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX","UWA/Class/View","UWA/Controls/Input","DS/CfgBaseUX/scripts/CfgData","DS/CfgBaseUX/scripts/CfgUtility","DS/UIKIT/Alert","DS/CfgBaseUX/scripts/CfgXMLServices","DS/CfgEvolutionUX/CfgWUXUnitLayout","DS/Controls/LineEditor","DS/UIKIT/Mask","DS/CfgEvolutionUX/CfgUnitLayout","DS/CfgBaseUX/scripts/CfgUXEnvVariables","css!DS/CfgEvolutionUX/CfgEvolutionUX.css"],(function(e,t,i,o,n,s,a,l,r,d,c,p,u,m,h,g){"use strict";return s.extend({textBox:null,textdiv:null,currentDictionary:null,atLeastOneUnitAllocated:!1,currentModel:null,setup:function(e){this._parent(e)},render:function(){var e=this;if(this.existingEffFrozenBuildsArr=[],this.textdiv=UWA.createElement("div",{id:"textDiv",class:"unitTextDiv",styles:{width:"100%","font-weight":"normal"}}).inject(this.options.parentElement),"EFF_VIEW"!=e.options.use)return this.textBox=new u({}).inject(this.textdiv),null==this.options.displayCompactMode||0==this.options.displayCompactMode?(this.textBox.touchMode=!0,this.textBox.elements.container.getElement("input").setAttributeNode(document.createAttribute("touch-mode"))):(this.textBox.touchMode=!1,this.textBox.elements.container.getElement("input").removeAttribute("touch-mode")),this.textBox.addEventListener("uncommittedChange",(function(t){t.keyCode;8!=t.keyCode&&46!=t.keyCode&&e.textBox.valueToCommit.endsWith(",")&&(e.textBox.value=e.textBox.valueToCommit+" ");var i=e.validate();e.ExpressionMode&&1==i&&(e.fields=e.textBox.valueToCommit.replace(/\s*,\s*/g,",").split(","),g.getCfgUXEnvVariables().isDGVUnitLayout?h.parseTextInputAndSelect(e.fields):(e.allRoots.forEach((function(e){e.unselect()})),p.buildOrderSequence(e.fields))),e&&e.textBox&&e.textBox.tooltipInfos&&e.textBox.tooltipInfos.shortHelp&&(e.textBox.tooltipInfos.shortHelp=e.textBox.valueToCommit)})),this.label=UWA.createElement("Label",{html:n.Filter_UnitLabel,styles:{"font-weight":"normal"}}).inject(this.textdiv),this.editButton=UWA.createElement("span",{class:"fonticon fonticon-search "}).inject(this.options.parentElement),this.editButton.set({events:{click:function(t){1!=e.editButton.hasClassName("disableButton")&&e.validate()&&("Filter"==e.options.invokeFrom&&m.mask(e.options.filterParent),e.onUnitSelectionDialogLaunched(t,e))}}}),this.editButton.addClassName("fonticon"),this.editButton.addClassName("fonticon-1.5x"),this.editButton.addClassName("fonticon-search"),this.editButton.addClassName("searchbutton"),"UnitFiring"==e.options.usage&&e.editButton.hide(),!0===e.options.isReadOnly&&(this.textBox.disabled=!0),l.ModelEvents.subscribe({event:"UnitsDialogClosed"},(function(t){e.selectionBuilds(t)})),l.ModelEvents.subscribe({event:"modelUpdated"},(function(t){e.atLeastOneUnitAllocated=!1,null==t.noEvolutionUpdate&&e.updateDictionary(t)})),this.label.addClassName("CfgUnitTextBoxLabel"),this.applyCompactComfortableMode(),this},applyCompactComfortableMode:function(){null==this.options.displayCompactMode||!1===this.options.displayCompactMode?(this.label.setAttributeNode(document.createAttribute("touch-mode")),this.editButton.setAttributeNode(document.createAttribute("touch-mode"))):(this.label.removeAttribute("touch-mode"),this.editButton.removeAttribute("touch-mode"))},updateDictionary:function(e){var t=this;return new Promise((function(i,o){m.mask(l.renderTo);var n=e;t.currentModel=n;var s="";s=n.model.valueItem.constructor==Array?n.model.value[0]:n.model.valueItem;var a=l.getDictionaryByCriteria(s,"builds");if(null==a.builds){var d=r.getDictionaryFromServer(s,"builds"),c=t;d.then((function(e){l.addDictionaryByCriteria(s,e,"builds"),c.currentDictionary=l.getDictionaryByCriteria(s,"builds"),c.checkingcurrentDictionary(),m.unmask(l.renderTo),i()}))}else t.currentDictionary=a,t.checkingcurrentDictionary(),m.unmask(l.renderTo),i()}))},checkingcurrentDictionary:function(){const e=[];var t=this.currentDictionary.builds;if(g.getCfgUXEnvVariables().isDGVUnitLayout?h.convertBuildsDataToArrey(this.currentDictionary.builds,e):p.rootBuildsData(e,t),null==t||0==t.length?(this.textBox.value="",this.editButton.addClassName("disableButton"),this.textBox.disabled=!0):(!0===this.options.isReadOnly?this.textBox.disabled=!0:this.textBox.disabled=!1,this.editButton.removeClassName("disableButton")),r.isParamDefined(this.existingUnitsExpr)){let e=this.existingUnitsExpr.replace(/\s*,\s*/g,",").split(",");e.length>0&&(this.existingEffFrozenBuildsArr=this.frozenUnitCheck(e))}},checkUnitsAllocation:function(){for(var e=0;e<this.currentDictionary.builds.length;e++)if(""!=this.currentDictionary.builds[e].allocated){this.atLeastOneUnitAllocated=!0,l.ModelEvents.publish({event:"showOrHideComponentsExceptUnit",data:{unitAllocation:this.atLeastOneUnitAllocated}});break}},selectionBuilds:function(e){if(null!==e.model){var t=this;this.arr=[],this.Final="";var i=!1,o=!1;e.model.forEach((function(e){var i=parseInt(e);t.arr.push(i),t.arr.sort((function(e,t){return isFinite(e-t)?e-t:isFinite(e)?-1:1}))}));for(var n=0;n<this.arr.length;n++){if(0==isFinite(this.arr[n])||i&&0==isFinite(this.arr[n+1])&&n+1<this.arr.length){o=!0;break}i||(this.Final=this.Final+this.arr[n]),parseInt(this.arr[n])+1==parseInt(this.arr[n+1])?i||(this.Final=this.Final+"-",i=!0):i?(this.Final=this.Final+this.arr[n]+",",i=!1):this.Final=this.Final+","}return this.Final=this.Final.slice(0,-1),o&&(this.Final=this.Final+"+"),this.textBox.value=this.Final.replace(/\s*,\s*/g,", "),this.Final.replace(/\s*,\s*/g,", ")}},onUnitSelectionDialogLaunched:function(e,t){var i={},o=this;o.fields=t.textBox.valueToCommit.replace(/\s*,\s*/g,",");var n,s="";s=t.currentModel.model.valueItem.constructor==Array?t.currentModel.model.value[0]:t.currentModel.model.valueItem;var a=l.renderTo.getElements(".cfgEvoCritModalVariableHeight");n=void 0!==a&&a.length>0?a[0].parentElement:void 0!==l.renderTo&&null!=l.renderTo?l.renderTo:l.renderTo.getElements(".modal-content")[0],m.mask(n),t.currentDictionary=l.getDictionaryByCriteria(s,"builds"),i.mode=t.options.mode,i.invokeFrom=t.options.invokeFrom,i.filterParent=t.options.filterParent,i.rangeEnable="",i.displayCompactMode=t.options.displayCompactMode,i.isReadOnly=t.options.isReadOnly,m.unmask(n),0!=t.options.parentElement.className.indexOf("filter")&&(i.rangeEnable=!0),l.ModelEvents.publish({event:"LaunchingDictionarySelection",data:{}}),g.getCfgUXEnvVariables().isDGVUnitLayout?h.create(this.currentDictionary,o.fields,this.currentModel,i):p.create(this.currentDictionary,o.fields,this.currentModel,i)},show:function(){this.textBox.show(),this.label.show(),this.editButton.show()},hide:function(){this.textBox.hide(),this.label.hide(),this.editButton.hide()},getJson:function(){if(""==this.textBox.valueToCommit){var e={builds:[]};return JSON.stringify(e)}if(0!=this.validate()){for(var t=this.textBox.valueToCommit.replace(/\s*,\s*/g,",").split(","),i=(e={builds:[]},0),o=t.length;i<o;i++){var n=t[i].indexOf("-"),s=t[i].indexOf("+");if(-1!==n||-1!==s){if(-1!==n)var a=t[i].split("-");if(-1!==s)a=t[i].split("+");if(""==a[1]){var l={start:{buildOrder:a[0]},end:{buildOrder:"INF"}};e.builds.push(l)}else{l={start:{buildOrder:a[0]},end:{buildOrder:a[1]}};e.builds.push(l)}}else{var r={start:{buildOrder:t[i]},end:null};e.builds.push(r)}}return JSON.stringify(e)}},SetJson:function(e){if(void 0!==e&&null!=e&&0!=e.length){for(var t=JSON.parse(e).builds,i=[],n=0;n<t.length;n++){var s=t[n].start.buildOrder,a=t[n].end;if(null!=a)var l=a.buildOrder;null==a?i.push(s):"INF"==l?i.push(s+"+"):i.push(s+"-"+l)}var d="";for(n=0;n<i.length;n++)d=0==n?i[0]:d+","+i[n];if("EFF_VIEW"==this.options.use){if(this.options.expression&&this.options.expression.impXml&&this.options.expression.impXml.indexOf('IsExcluded="true"')>=0){let e=c.startFilterXML()+this.options.expression.impXml+c.endFilterXML();d=r.getDisplayExpressionUsingXSLT(e)}this.textdiv.innerHTML=d,this.textdiv.tooltipInfos=new o({shortHelp:d})}else""==d&&null!=this.options.expression&&r.isParamDefined(this.options.expression.notUnitDesc)&&(d=this.options.expression.notUnitDesc.toString().trim()),this.textBox.value=d,this.textBox.tooltipInfos=new o({shortHelp:d}),this.existingUnitsExpr=this.textBox.value;return d}},buildUnitXML:function(e,t){let i=this;if(0==this.validate())return this.showAlert(),null;this.textBox.value=this.textBox.valueToCommit.replace(/(\s*,\s*)+/g,","),this.textBox.valueToCommit.endsWith(", ")&&(this.textBox.value=this.textBox.valueToCommit.substr(0,this.textBox.valueToCommit.length-2)),this.textBox.valueToCommit.startsWith(",")&&(this.textBox.value=this.textBox.valueToCommit.substr(1,this.textBox.valueToCommit.length)),this.textBox.valueToCommit.endsWith(",")&&(this.textBox.value=this.textBox.valueToCommit.substr(0,this.textBox.valueToCommit.length-1));var o="";if(o=r.isDefined(t)&&0==t?"":this.textBox.valueToCommit.replace(/\s*,\s*/g,",").split(","),"Filter"!=this.options.invokeFrom){let e=[];if(e=this.frozenUnitCheck(o),e.length>0&&("SessionEffectivity"===this.options.invokeFrom||"Applicability"===this.options.invokeFrom||"EditEvolution"===this.options.invokeFrom&&0==this.existingEffFrozenBuildsArr.length))return this.showAlert(n.CfgFrozenUnitErrorInEditEvol),null;if("EditEvolution"===this.options.invokeFrom&&this.existingEffFrozenBuildsArr.length>0){if(e.filter((function(e){return i.existingEffFrozenBuildsArr.includes(e)})).length<this.existingEffFrozenBuildsArr.length)return this.showAlert(n.CfgFrozenUnitRemovedFromExisting),null;if(e.length>this.existingEffFrozenBuildsArr.length)return this.showAlert(n.CfgNewFrozenUnits),null}}if(""==o)return"";for(var s="",a=0,l=o.length;a<l;a++){var d=o[a].indexOf("-"),p=o[a].indexOf("+");if(-1!==d||-1!==p){if(-1!==d)var u=o[a].split("-");if(-1!==p)u=o[a].split("+");var m=u[0],h=u[1],g=c.buildFrom(m),f=c.buildTo(h),C=c.buildRange(g,f);0==a?s=C:s+=C}else{var v=o[a],x=c.buildSingleValue(v);0==a?s=x:s+=x}}return c.buildSeries("Unit",e,s)},frozenUnitCheck:function(e){let t=[];for(let i=0;i<e.length;i++){let o=!1,n=!1;if(-1!==e[i].indexOf("-")){let n=e[i].split("-");for(;parseInt(n[0])<=parseInt(n[1]);){t.push(n[0]);let e=n[0];e++,n[0]=e.toString()}o=!0}if(-1!==e[i].indexOf("+")){let o=e[i].split("+");o=o.slice(0,-1),o=parseInt(o),this.currentDictionary.builds.forEach((function(e){parseInt(e.buildOrder)>=o&&-1==t.indexOf(e.buildOrder)&&t.push(e.buildOrder)})),n=!0}o||n||t.push(e[i])}if(0==t.length)return t;let i=[];for(let e=0;e<t.length;e++)this.isFrozen(t[e])&&i.push(t[e]);return i},isFrozen:function(e){let t=!1;for(let i=0;i<this.currentDictionary.builds.length;i++){let o=this.currentDictionary.builds[i];if(o.buildOrder==e&&("Complete"==o.current||"Release"==o.current||"Obsolete"==o.current)){t=!0;break}}return t},validate:function(){var e="";if(null!=this.currentModel){e=this.currentModel.model.valueItem.constructor==Array?this.currentModel.model.value[0]:this.currentModel.model.valueItem,this.currentDictionary=l.getDictionaryByCriteria(e,"builds"),this.checkingcurrentDictionary();var t=!0;if(""==this.textBox.valueToCommit)return this.alertStatus(t),t;if(", "==this.textBox.valueToCommit){t=!1;return this.alertStatus(t),t}var i=this.textBox.valueToCommit.replace(/\s*,\s*/g,",").split(",");if(-1!=this.textBox.valueToCommit.indexOf("."))t=!1;else if(this.textBox.valueToCommit.indexOf("NOT")>=0)t=!0;else{for(var o=0,n=(i=this.textBox.valueToCommit.replace(/\s*,\s*/g,",").split(",")).length;o<n&&0!=t;o++){if(-1!==i[o].indexOf("-")&&"-"!=i[o]){if((r=(a=i[o].split("-")).length)>2){t=!1;break}var s=parseInt(a[0]);if((d=parseInt(a[1]))!=a[1]){t=!1;break}if(i[o].indexOf("-")&&isNaN(d)||isNaN(s)){t=!1;break}if(!isNaN(s)&&!isNaN(d)&&s<d&&null!=d&&2==r)t=1==this.isPresent(s,this.currentDictionary)&&this.isPresent(d,this.currentDictionary);else if(isNaN(s)||isNaN(d)){if(!isFinite(s)&&isFinite(s))t=""==a[1]}else if(s==d||s>d){t=!1;break}}else{if(-1!==i[o].indexOf("+")&&"+"!=i[o]){var a,r=(a=i[o].split("+")).length,d=(s=parseInt(a[0]),parseInt(a[1]));if(isNaN(s)||!isNaN(d)){t=!1;break}if(1!=this.isPresent(s,this.currentDictionary)){t=!1;break}t=!0}else if(0==(t=this.isPresent(i[o],this.currentDictionary)))break}}if(g.getCfgUXEnvVariables().isDGVUnitLayout){let e=[];e=this.frozenUnitCheck(i);var c=this;if(this.existingEffFrozenBuildsArr.length>0){(e.filter((function(e){return c.existingEffFrozenBuildsArr.includes(e)})).length<this.existingEffFrozenBuildsArr.length||e.length>this.existingEffFrozenBuildsArr.length)&&(t=!1)}}}return this.alertStatus(t),t}},alertStatus:function(e){e?e&&this.textBox.elements.container.getElement("input").removeClassName("AlertStyles"):(null!=this.alert&&this.alert.hide(),this.textBox.elements.container.getElement("input").addClassName("AlertStyles"))},showAlert:function(e){this.alert=new d({visible:!0,autoHide:!0,hideDelay:3500}).inject(this.options.parentElement,"top"),this.alert.elements.container.addClassName("CfgAlert");let t=r.isParamDefined(e)?e:n.Filter_UnitAlert+this.buildUnitNumbers();this.alert.add({className:"error",style:{position:"absolute"},message:t})},buildUnitNumbers:function(){for(var e=new Array(this.currentDictionary.builds.length),t=0;t<this.currentDictionary.builds.length;t++)e[t]=parseInt(this.currentDictionary.builds[t].buildOrder,10);e.sort((function(e,t){return e-t}));var i="",o=null,n=null,s=null,a=null;for(t=0;t<e.length;t++)o=e[t],0!=t?o-(n=e[t-1])>1?(s==(a=n)?i=s+",":i+=s+"-"+a+",",s=o):a=o:s=o;return null!=s&&(i+=s),null!=a&&(i+="-"+a),i},initialiseComponent:function(){if("EFF_VIEW"!=this.options.use){this.currentModel={model:{labelItem:[this.options.expression.name],valueItem:this.options.expression.modelId}};var e="";e=this.currentModel.model.valueItem.constructor==Array?this.currentModel.model.value[0]:this.currentModel.model.valueItem;var t=l.getDictionaryByCriteria(e,"builds");if(null==t.builds){var i=r.getDictionaryFromServer(e,"builds"),o=this;i.then((function(t){l.addDictionaryByCriteria(e,t,"builds"),o.currentDictionary=l.getDictionaryByCriteria(e,"builds"),o.checkingcurrentDictionary()}))}else this.currentDictionary=t,this.checkingcurrentDictionary()}},isPresent:function(e,t){for(var i=!1,o=0;o<this.currentDictionary.builds.length;o++){this.currentDictionary.builds[o].buildOrder!=e&&""!=e||(i=!0)}return i}})})),define("DS/CfgEvolutionUX/CfgProductState",["UWA/Drivers/Alone","DS/Core/Core","DS/UIKIT/Input/Text","DS/UIKIT/Input/Button","DS/Controls/TooltipModel","UWA/Class/View","DS/CfgBaseUX/scripts/CfgData","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgBaseUX/scripts/CfgUXEnvVariables","UWA/Class/Promise","DS/CfgEvolutionUX/CfgVersionGraphLayout","DS/CfgEvolutionUX/CfgXRevisionEvolutionLayout","DS/CfgBaseUX/scripts/CfgXMLServices","DS/CfgBaseUX/scripts/CfgEvolutionRange","DS/UIKIT/Mask","css!DS/CfgEvolutionUX/CfgEvolutionUX.css"],(function(e,t,i,o,n,s,a,l,r,d,c,p,u,m,h){"use strict";return s.extend({editButton:null,textdiv:null,xml:null,xmlDesc:[],json:null,displayExpression:"",setup:function(e){this._parent(e)},render:function(){var e=this;this.cfgUXEnvVariablesJS=r.getCfgUXEnvVariables(),this.CfgVersionGraphLayoutInstance=new c,this.textBox=UWA.createElement("div").inject(this.options.parentElement),this.textBox.addClassName("CfgEditor"),this.textBox.set({events:{click:function(t){"EFF_VIEW"!=e.options.use&&e.onCriteriaClickHandler(t)}}}),this.textBox.tooltipInfos=new n({shortHelp:""}),"EFF_VIEW"!=e.options.use&&(this.editButton=UWA.createElement("span").inject(this.options.parentElement),this.editButton.set({events:{click:function(t){e.onCriteriaClickHandler(t)}}}),this.editButton.addClassName("fonticon"),this.editButton.addClassName("fonticon-1.5x"),this.editButton.addClassName("fonticon-search"),this.editButton.addClassName("searchbutton"),a.ModelEvents.subscribe({event:"modelUpdated"},(function(t){e.setLastMainEvolution(t),e.editButton.removeClassName("disableButton"),e.textBox.removeClassName("disableButton")})),a.ModelEvents.subscribe({event:"ProductStateDialogClosed"},(function(t){e.editButton.removeClassName("disableButton"),e.textBox.removeClassName("disableButton"),t.mode==e.options.mode&&(e.xml=t.xml,e.xmlDesc=t.xmlDesc,e.options.psJson=t.json,t.xml&&("PRODUCTS"==e.options.mode?(e.options.expression.xmlExpression=t.xml,e.options.expression.psXmlDesc=t.xmlDesc,e.options.expression.psJson=t.json):"MANUFACTURINGPLAN"==e.options.mode?(e.options.expression.impXml=t.xml,e.options.expression.mpXmlDesc=t.xmlDesc,e.options.expression.mpJson=t.json):"XREVISION"==e.options.mode?(e.options.expression.xRevXml=t.xml,e.options.expression.xRevJson=t.json):"CONFIGRECORD"==e.options.mode&&(e.options.expression.configRecordXML=t.xml,e.options.expression.configRecordJSON=t.json)),e.updateDisplayExpression())}))),this.applyCompactComfortableMode()},applyCompactComfortableMode:function(){null==this.options.displayCompactMode||!1===this.options.displayCompactMode?(this.textBox.setAttributeNode(document.createAttribute("touch-mode")),this.editButton&&this.editButton.setAttributeNode(document.createAttribute("touch-mode"))):(this.textBox.removeAttribute("touch-mode"),this.editButton&&this.editButton.removeAttribute("touch-mode")),"EFF_VIEW"==this.options.use?this.textBox.setAttributeNode(document.createAttribute("readOnly-mode")):(this.textBox.setAttributeNode(document.createAttribute("edit-mode")),this.textBox.removeAttribute("readOnly-mode"))},onCriteriaClickHandler:function(e){var t=this;if(!(t.editButton&&1==t.editButton.hasClassName("disableButton")||1==t.textBox.hasClassName("disableButton"))){var i="";"PRODUCTS"==t.options.mode?i="products":"MANUFACTURINGPLAN"==t.options.mode?i="manufacturingPlans":"MILESTONES"==t.options.mode?i="milestones":"XREVISION"==t.options.mode?i="xrevision":"CONFIGRECORD"==t.options.mode&&(i="configrecord"),t.editButton&&t.editButton.addClassName("disableButton"),t.textBox.addClassName("disableButton");var o={};if(o.psJson=this.options.psJson,o.mode=this.options.mode,o.use=this.options.use,o.appUse=this.options.appUse,o.appEnv=this.options.appEnv,o.propagateSessionEffectivity=this.options.propagateSessionEffectivity,this.ModalLabel&&(o.ModelLabel=this.ModalLabel.constructor==Array?this.ModalLabel[0]:this.ModalLabel),this.ModalId?o.modelID=this.ModalId:o.modelID=this.options.expression.modelId?this.options.expression.modelId:"",o.displayexpression=this.options.expression.displayexpression?this.options.expression.displayexpression:"","products"==i?(o.xmlExpression=this.options.expression.xmlExpression?this.options.expression.xmlExpression:"",o.xmlDesc=this.options.expression.psXmlDesc?this.options.expression.psXmlDesc:""):"manufacturingPlans"==i?(o.xmlExpression=this.options.expression.impXml?this.options.expression.impXml:"",o.xmlDesc=this.options.expression.mpXmlDesc?this.options.expression.mpXmlDesc:""):"xrevision"==i?(o.xmlExpression=this.options.expression.xRevXml?this.options.expression.xRevXml:"",o.xmlDesc=this.options.expression.xRevXmlDesc?this.options.expression.xRevXmlDesc:""):"configrecord"==i&&(o.xmlExpression=this.options.expression.configRecordXML?this.options.expression.configRecordXML:""),o.displayCompactMode=this.options.displayCompactMode,"EFF_VIEW"==this.options.use?(o.isReadOnly=!0,o.parentGraphElement=this.options.parentGraphElement):(o.isReadOnly=!1,a.ModelEvents.publish({event:"LaunchingDictionarySelection",data:{}})),"products"==i||"manufacturingPlans"==i)t.CfgVersionGraphLayoutInstance.create(o);else if("xrevision"==i||"configrecord"==i)return o.xRevisionContent=this.options.xRevisionContent,o.xRevScopeDefined=this.options.xRevScopeDefined,o.parentElement=enoviaServerFilterWidget&&"Native"==enoviaServerFilterWidget.mode?a.renderTo:this.options.parentElement,o.onButtonClickCB=this.options.onButtonClickCB,this.xRevLayoutInst=new p,this.xRevLayoutInst.create(o),t.editButton&&t.editButton.removeClassName("disableButton"),void t.textBox.removeClassName("disableButton");if(this.cfgUXEnvVariablesJS.isVersionExplorer)t.editButton&&t.editButton.removeClassName("disableButton"),t.textBox.removeClassName("disableButton");else if(null==a.getDictionaryByCriteria(t.ModalId,i)[i]){var n;if("products"!=i&&"manufacturingPlans"!=i||"FILTER"==t.options.use)n=l.getDictionaryFromServer(t.ModalId,i);else{var s="",r="",d='<?xml version="1.0" encoding="UTF-8"?><CfgFilterExpression xmlns="urn:com:dassault_systemes:config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="urn:com:dassault_systemes:config CfgFilterExpression.xsd"><FilterSelection SelectionMode="Strict">',c="</FilterSelection></CfgFilterExpression>";"products"==i?r=d+'<Context xmlns="urn:com:dassault_systemes:config" HolderType="Model" HolderName="'+t.options.expression.name+'" >'+t.options.expression.xmlExpression+"</Context>"+c:"manufacturingPlans"==i&&(r=d+'<Context xmlns="urn:com:dassault_systemes:config" HolderType="Model" HolderName="'+t.options.expression.name+'" >'+t.options.expression.impXml+"</Context>"+c),""!==r&&(s={evolutionExpression:JSON.stringify({filterExpression:u.getValidXmlWithoutDescId(r)})},console.log("CfgProductState evoExpression = "+r+" wParam after descId removed = "+s.evolutionExpression)),n=l.getDictionaryFromServer(t.ModalId,"onlyUnfrozenNodes=1&"+i,null,s)}n.then((function(e){a.addDictionaryByCriteria(t.ModalId,e,i),o.data=a.getDictionaryByCriteria(t.ModalId,i),setTimeout((function(){"products"==i?t.CfgVersionGraphLayoutInstance.render(o.data.products):"manufacturingPlans"==i?t.CfgVersionGraphLayoutInstance.render(o.data.manufacturingPlans):"milestones"==i&&CfgProductStateSelectionDialog.create(o)}),100),t.editButton&&t.editButton.removeClassName("disableButton"),t.textBox.removeClassName("disableButton")}))}else o.data=a.getDictionaryByCriteria(t.ModalId,i),setTimeout((function(){"products"==i?t.CfgVersionGraphLayoutInstance.render(o.data.products):"manufacturingPlans"==i?t.CfgVersionGraphLayoutInstance.render(o.data.manufacturingPlans):"milestones"==i&&CfgProductStateSelectionDialog.create(o)}),100),t.editButton&&t.editButton.removeClassName("disableButton"),t.textBox.removeClassName("disableButton")}},updateDisplayExpression:function(){var e=this,t=this.buildFilterXML();if(null!=t){var i="",o=this.buildDescription();-1==t.search("TreeSeries")&&-1==t.search("MilestonesTrack")?"PRODUCTS"==this.options.mode?i=u.buildTreeSeries("ProductState",this.ModalLabel,t):"MANUFACTURINGPLAN"==this.options.mode?i=u.buildTreeSeries("ManufPlan",this.ModalLabel,t):"MILESTONES"==this.options.mode?i=u.buildmilestonetrack(t):"XREVISION"!=this.options.mode&&"CONFIGRECORD"!=this.options.mode||(i=u.buildXRevision(t)):i=t;var n="";n=null==o||0==o.length?u.startFilterXML()+i+u.endFilterXML():u.startEvolutionXML()+i+"</Expression><Description>"+o+"</Description></CfgEffectivityExpression>",this.displayExpression=l.getDisplayExpressionUsingXSLT(n),null!=e.CfgVersionGraphLayoutInstance.versionGraph&&1==e.CfgVersionGraphLayoutInstance.versionGraph.IsExpressionModified&&(this.options.notExpression=""),""==this.displayExpression&&l.isParamDefined(this.options.notExpression)&&(this.displayExpression=this.options.notExpression),this.textBox.innerText=this.displayExpression,this.textBox.tooltipInfos.shortHelp=e.displayExpression,this.options.expression.displayexpression=this.displayExpression}},buildDisplayExpression:function(){return this.displayExpression},buildFilterJson:function(){return this.options.psJson},buildFilterXML:function(){return this.xml},buildDescription:function(){return this.xmlDesc},setMVAssociatedWithPC:function(e,t){var i=this;this.iData=e,this.basedOnMVID=t;var o,n="";n={with_indexing_date:!0,with_nls:!1,label:"yus-1515078503005",locale:"en",select_predicate:["ds6w:label","ds6wg:revision","revision","ds6w:type","ds6w:description","ds6w:identifier","ds6w:modified","ds6w:created","ds6w:responsible","ds6w:lastModifiedBy","ds6wg:marketing_Name"],select_file:["icon","thumbnail_2d"],query:"flattenedtaxonomies:(types/Products) AND ( physicalid:("+i.basedOnMVID+") ) ",order_by:"desc",order_field:"relevance",nresults:1e3,start:"0",source:[],tenant:enoviaServerFilterWidget.tenant},o={isfederated:"true"};n=JSON.stringify(n);l.makeWSCall("/search?xrequestedwith=xmlhttprequest","POST","enovia","application/json",n,(function(e){var t="",o="",n="";if(null!=e.results[0]&&e.results[0].attributes.length>0)for(var s=0;s<e.results[0].attributes.length;s++)"ds6wg:revision"==e.results[0].attributes[s].name&&(t=e.results[0].attributes[s].value),"ds6w:label"==e.results[0].attributes[s].name&&(n=e.results[0].attributes[s].value),"ds6w:identifier"==e.results[0].attributes[s].name&&(o=e.results[0].attributes[s].value);if(""!=t&&""!=o&&""!=n){null==window.DescriptionCount&&(window.DescriptionCount=1),i.xml='<Single Name = "'+o+'" Revision = "'+t+'" DescId = "'+window.DescriptionCount+'"/>',i.modelName=i.iData.model.name[0];var r=u.buildTreeSeries("ProductState",i.modelName,i.xml),d=n;i.xmlDesc='<TreeSeries DescId = "'+window.DescriptionCount+'" Revision = "'+t+'" DisplayName="'+l.escapeSpecialCharacters(d)+'"/>',window.DescriptionCount++,r=u.startEvolutionXML()+r+"</Expression><Description>"+i.xmlDesc+"</Description></CfgEffectivityExpression>",i.displayExpression=l.getDisplayExpressionUsingXSLT(r),i.options.psJson=[m.getRange(o,t,d)],i.options.expression&&(i.options.expression.xmlExpression=i.xml,i.options.expression.psXmlDesc=i.xmlDesc,i.options.expression.displayexpression=i.displayExpression,i.options.expression.psJson=i.options.psJson),i.editButton&&i.editButton.removeClassName("disableButton"),a.singleProductId=i.basedOnMVID,1!=i.textBox.isHidden()&&null!=i.options.psJson&&1==i.options.psJson.length&&1!=i.options.psJson[0].start.isRoot&&null!=document.getElementById("edit")&&document.getElementById("edit").removeClassName("disableButton"),a.ProductStateComponent.textBox.innerText=i.displayExpression,a.ProductStateComponent.textBox.tooltipInfos.shortHelp=i.displayExpression}}),(function(){}),!0,o)},setLastMainEvolution:function(e){if((i=this).criteriasAvailable=a.CurrentFilterModel.model.criteriasAvailable,null!=i.criteriasAvailable&&(null!=i.criteriasAvailable&&"False"==i.criteriasAvailable.manufacturingPlans&&null!=a.manufacturingplanComponent?(a.manufacturingplanCheckbox.hide(),a.manufacturingplanComponent.hide(),a.manufacturingplanComponent.textBox.setText("")):1==a.manufacturingplanCheckbox.checkFlag?(a.manufacturingplanComponent.show(),a.manufacturingplanCheckbox.show(),a.manufacturingplanCheckbox.checkFlag=!1):(a.manufacturingplanComponent.hide(),a.manufacturingplanComponent.textBox.setText(""),a.manufacturingplanCheckbox.show()),null!=i.criteriasAvailable&&"FALSE"==i.criteriasAvailable.products&&null!=a.ProductStateComponent?(a.productstateCheckbox.hide(),a.ProductStateComponent.hide(),a.ProductStateComponent.textBox.setText("")):(a.ProductStateComponent.show(),a.productstateCheckbox.show(),a.productstateCheckbox.checkFlag=!0,a.ProductStateComponent.textBox.setText("")),null!=a.UnitComponent&&(null!=i.criteriasAvailable&&"FALSE"==i.criteriasAvailable.builds?(a.UnitCheckbox.hide(),a.UnitComponent.hide(),a.UnitComponent.textBox.value=""):1==a.UnitCheckbox.checkFlag?(a.UnitComponent.show(),a.UnitCheckbox.show(),a.UnitCheckbox.checkFlag=!1):(a.UnitComponent.hide(),a.UnitComponent.textBox.value="",a.UnitCheckbox.show())),null!=a.DateCheckbox&&1==a.DateCheckbox.checkFlag&&(a.DateCheckbox.checkFlag=!1,a.DatePicker.hide())),e.model.valueItem.constructor==Array?(this.ModalId=e.model.value[0],this.ModalLabel=e.model.label[0].label):(this.ModalId=e.model.valueItem,this.ModalLabel=e.model.name),null==e.noEvolutionUpdate||1!=e.noEvolutionUpdate){var t=new d((function(t,i){var o="/resources/modeler/browsing/browseservice/pid:"+e.model.valueItem+"/configurationdictionary?latestMainProductNode=1";l.makeWSCall(o,"POST","enovia","application/x-www-form-urlencoded","productstates",(function(e){t(e)}),(function(e){console.log("fail to get last product evolution")}),!0)}));this.iData=e;var i=this;t.then((function(e){var t=e;if(0==Object.keys(t.products).length)i.displayExpression="",i.xml="",i.options.psJson=null,i.editButton&&i.editButton.addClassName("disableButton"),null!=document.getElementById("edit")&&document.getElementById("edit").addClassName("disableButton"),a.singleProductId="";else{null==window.DescriptionCount&&(window.DescriptionCount=1),i.xml='<Single Name = "'+t.products.name+'" Revision = "'+t.products.revision+'" DescId = "'+window.DescriptionCount+'"/>',i.modelName=i.iData.model.name[0];var o=u.buildTreeSeries("ProductState",i.modelName,i.xml),n=l.escapeSpecialCharacters(t.products.displayValue);null!=n&&" "!=n||(n=t.products.name),i.xmlDesc='<TreeSeries DescId = "'+window.DescriptionCount+'" Revision = "'+t.products.revision+'" DisplayName="'+n+'"/>',window.DescriptionCount++,o=u.startEvolutionXML()+o+"</Expression><Description>"+i.xmlDesc+"</Description></CfgEffectivityExpression>",i.displayExpression=l.getDisplayExpressionUsingXSLT(o),i.options.psJson=[m.getRange(t.products.name,t.products.revision,n)],i.options.expression&&(i.options.expression.xmlExpression=i.xml,i.options.expression.psXmlDesc=i.xmlDesc,i.options.expression.displayexpression=i.displayExpression,i.options.expression.psJson=i.options.psJson),i.editButton&&i.editButton.removeClassName("disableButton"),a.singleProductId=t.products.id.replace("pid:",""),1!=i.textBox.isHidden()&&null!=i.options.psJson&&1==i.options.psJson.length&&1!=i.options.psJson[0].start.isRoot&&null!=document.getElementById("edit")&&document.getElementById("edit").removeClassName("disableButton")}a.ProductStateComponent.textBox.innerText=i.displayExpression,a.ProductStateComponent.textBox.tooltipInfos.shortHelp=i.displayExpression}))}},updateCompWithMV:function(e){if(e.id){window.DescriptionCount||(window.DescriptionCount=1),this.xml='<Single Name = "'+e.name+'" Revision = "'+e.revision+'" DescId = "'+window.DescriptionCount+'"/>',this.modelName=e.modelName||e.name;let t=u.buildTreeSeries("ProductState",this.modelName,this.xml),i=l.escapeSpecialCharacters(e.displyName||e.name);i||(i=e.name),this.xmlDesc='<TreeSeries DescId = "'+window.DescriptionCount+'" Revision = "'+e.revision+'" DisplayName="'+i+'"/>',window.DescriptionCount++,t=u.startEvolutionXML()+t+"</Expression><Description>"+this.xmlDesc+"</Description></CfgEffectivityExpression>",this.displayExpression=l.getDisplayExpressionUsingXSLT(t),this.options.psJson=[m.getRange(e.name,e.revision,i)],this.options.expression&&(this.options.expression.xmlExpression=this.xml,this.options.expression.psXmlDesc=this.xmlDesc,this.options.expression.displayexpression=this.displayExpression,this.options.expression.psJson=this.options.psJson),this.editButton&&this.editButton.removeClassName("disableButton"),a.singleProductId=e.id,1!=this.textBox.isHidden()&&null!=this.options.psJson&&1==this.options.psJson.length&&1!=this.options.psJson[0].start.isRoot&&null!=document.getElementById("edit")&&document.getElementById("edit").removeClassName("disableButton")}else this.displayExpression="",this.xml="",this.options.psJson=null,this.editButton&&this.editButton.addClassName("disableButton"),null!=document.getElementById("edit")&&document.getElementById("edit").addClassName("disableButton"),a.singleProductId="";a.ProductStateComponent.textBox.innerText=this.displayExpression,a.ProductStateComponent.textBox.tooltipInfos.shortHelp=this.displayExpression},setExpression:function(e){"XREVISION"===this.options.mode?0!=Object.keys(this.options.expression).length&&(this.xml=this.options.expression.xRevXml,this.xmlDesc=this.options.expression.xRevJson):"CONFIGRECORD"===this.options.mode?0!=Object.keys(this.options.expression).length&&(this.xml=this.options.expression.configRecordXML,this.xmlDesc=this.options.expression.configRecordJSON):(e.model.valueItem.constructor==Array?(this.ModalId=e.model.value[0],this.ModalLabel=e.model.label[0].label):(this.ModalId=e.model.valueItem,this.ModalLabel=e.model.name),"PRODUCTS"==this.options.mode&&(this.xml=this.options.expression.xmlExpression,this.xmlDesc=this.options.expression.psXmlDesc),"MANUFACTURINGPLAN"==this.options.mode&&0!=Object.keys(this.options.expression).length&&(this.xml=this.options.expression.impXml,this.xmlDesc=this.options.expression.mpXmlDesc)),this.updateDisplayExpression()},show:function(){this.textBox.show(),this.editButton&&this.editButton.show()},hide:function(){this.textBox.hide(),this.editButton&&this.editButton.hide()},onProductStateSelectionDialogLaunched:function(e){var t="";"PRODUCTS"==this.options.mode?t="products":"MANUFACTURINGPLAN"==this.options.mode?t="manufacturingPlans":"MILESTONES"==this.options.mode&&(t="milestones"),a.ModelEvents.publish({event:"LaunchingDictionarySelection",data:{}});var i={};i.psJson=this.options.psJson,i.data=a.getDictionaryByCriteria(this.ModalId,t),i.mode=this.options.mode,i.use=this.options.use,i.appUse=this.options.appUse,i.appEnv=this.options.appEnv,i.propagateSessionEffectivity=this.options.propagateSessionEffectivity,i.ModelLabel=this.ModalLabel.constructor==Array?this.ModalLabel[0]:this.ModalLabel,CfgProductStateSelectionDialog.create(i)},getSelectedModelId:function(){return this.ModalId},initialiseComponent:function(){null==this.ModalId&&null==this.ModalLabel&&(this.ModalId=this.options.expression.modelId,this.ModalLabel=this.options.expression.name),"PRODUCTS"==this.options.mode?(this.xml=this.options.expression.xmlExpression,this.psJson=this.options.expression.psJson,this.xmlDesc=this.options.expression.psXmlDesc):"MANUFACTURINGPLAN"==this.options.mode?(this.xml=this.options.expression.impXml,this.psJson=this.options.expression.mpJson,this.xmlDesc=this.options.expression.mpXmlDesc):"MILESTONES"==this.options.mode&&(this.xml=this.options.expression.milestoneXml,this.psJson=this.options.expression.milestoneJson,this.options.psJson=this.options.expression.milestoneJson),this.updateDisplayExpression(this)}})})),define("DS/CfgEvolutionUX/CfgEvolutionLayoutFactory",["UWA/Class/Model","DS/CoreEvents/ModelEvents","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgWebinWinInterop/scripts/CfgWIWUtility","DS/CfgBaseUX/scripts/CfgController","DS/CfgEvolutionUX/CfgVersionGraphLayout","DS/CfgEvolutionUX/CfgXRevisionEvolutionLayout","DS/CfgBaseUX/scripts/CfgXMLServices","DS/CfgBaseUX/scripts/CfgData","DS/CfgBaseUX/scripts/CfgCollection","DS/CfgBaseUX/scripts/CfgModelView","DS/CfgBaseUX/scripts/CfgContainerView","DS/PlatformAPI/PlatformAPI","i18n!DS/CfgBaseUX/assets/nls/CfgBaseUX","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX","DS/UIKIT/Spinner","DS/UIKIT/Mask","DS/CfgBaseUX/scripts/CfgAutoComplete","DS/CfgBaseUX/scripts/CfgUXEnvVariables","DS/Utilities/TouchUtils","DS/Tweakers/GeneratedToolbar","css!DS/CfgEvolutionUX/CfgEvolutionUX.css"],(function(e,t,i,o,n,s,a,l,r,d,c,p,u,m,h,g,f,C,v,x,b){"use strict";var D={modelListView:null,empty_models:null,showImportAppIcon:!1,enableImportButton:!1,addedDataType:"",applicabilityCO:"",descriptionMap:{},XrevisionAlreadySelected:!1,createNative:function(e){var o=this;this.CfgVersionGraphLayoutInstance=new s,e.isxRevisionEffectivity&&(o.collection=void 0);var n={isHeader:!1,isFooter:!0,firstButtonText:m.CFG_Ok,secondButtonText:m.CFG_Cancel,headerText:m.Header_SessionEffectivity,toggleSessionEffectivity:!1,onButtonClickCB:function(e){if("Native"==window.enoviaServerFilterWidget.mode){var t={xRevGraphIdsWithEffectivity:[],xRevReferenceIdsWithEffectivity:[],modelIdsWithEffectivity:o.collection.getEffectivityModelsIDs(),globalEffectivityExpression:o.collection.getGlobalSessionExpression()};let s=o.collection.getGlobalSessiondata()["Evolution Expression"];s&&s.indexOf("</XRevision>")>=0&&(t.xRevGraphIdsWithEffectivity=o.collection.getEffectivityModelsIDs(),t.xRevReferenceIdsWithEffectivity=o.collection.getEffectivityxRevReferenceIDs(),t.modelIdsWithEffectivity=[],t.globalEffectivityExpression=s);var n={eventName:"cfgEditEvolutionEffectivity",operation:"firstButton"==e.buttonId?"OK":"Cancel",operationVersion:"1.0",content:JSON.stringify(t)};i.sendNotificationWebInWin(n)}}};e.dialogue={},e.dialogue.modelViewContainer=new p(n).render(),e.dialogue.modelViewContainer.inject(e.parent),e.parentElement=e.parent,e.dialogue.object={resizeDialog:function(){},container:e.parent},e.displayCompactMode=!(null!=x.getTouchMode()&&0!=x.getTouchMode()),this.options=e;o=this;r.clear(),r.ModelEvents=new t,r.Models=[],o.evolutionSpinner=new g({className:"evolutionSpinner"}).inject(o.options.parent),o.evolutionSpinner.spin(),o.evolutionSpinner.show(),i.populateDisplayExpressionXSLT().then((function(e){i.checkDecouplingActivation().then((function(e){if(console.log(e),r.configurationCriteria=e,"TRUE"==o.options.isAutoProposed)o.fillWithAttachedContextNative(o.options);else if(1==o.options.isxRevisionEffectivity){let e=o.options.xRevisionContent.referencePID,t={modelName:o.options.xRevisionContent.name,selectedDataType:o.options.xRevisionContent.type,selectedReferenceId:e,isPostProcessRequired:!0};o.addXRevisionInfo(t)}else o.options.expressionJson=l.EvolutionXMLtoJSONConvertor(o.options.iXml),o.populateModels(o)}))})),o.subscribeModelEvents()},create:function(e){return new Promise(((o,a)=>{e.displayCompactMode=!(null!=x.getTouchMode()&&0!=x.getTouchMode()),this.options=e;var l=this;l.toggleHidden=!1,r.clear(),r.ModelEvents=new t,r.Models=[],e.isxRevisionEffectivity&&(l.collection=void 0),this.CfgVersionGraphLayoutInstance=new s,l.evolutionSpinner=new g({className:"evolutionSpinner"}).inject(l.options.parent),l.evolutionSpinner.spin(),l.evolutionSpinner.show(),n.init(),enoviaServerFilterWidget.mode=this.options.environment,enoviaServerFilterWidget.tenant=this.options.tenant,i.populate3DSpaceURL().then((function(){var e=i.populateSecurityContext();e.then((function(){i.populateDisplayExpressionXSLT().then((function(){i.checkDecouplingActivation().then((function(e){var t;console.log(e),r.configurationCriteria=e,i.rolesAvailable((e=>{if(l.userGrantedRoles=e,"Applicability"==l.options.mode){enoviaServerFilterWidget.fromCaller="Applicability";let e=new Promise((function(e,t){var o="/resources/v2/e6w/service/ApplicabilityTypeInfo/"+l.options.objectid;i.makeWSCall(o,"GET","enovia","application/json","",(function(t){e(t)}),t,!0)}));e.then((function(e){let n;null!=e.data&&"Change Action"==e.data[0].dataelements.applicabilityType&&(r.type="Change Action"),null!=e.data&&"Decision"==e.data[0].dataelements.applicabilityType&&(r.type="Decision"),null==e.data||"Change Order"!=e.data[0].dataelements.applicabilityType&&"Change Request"!=e.data[0].dataelements.applicabilityType||(r.type="Change Order"),null!=e.data&&"Change Order"==e.data[0].dataelements.applicabilityType&&(n="Change Order"),null!=e.data&&"Change Request"==e.data[0].dataelements.applicabilityType&&(n="Change Request");var s=document.querySelector("#FacetDivForApplicabilityContext");s&&(s.setStyle("margin-top","5px"),s.setStyle("overflow","auto")),1==l.options.readOnly?l.onSecurityContext(t,l):"Change Action"==r.type?i.populateChangeActionAccess(l.options.objectid).then((function(){!1===l.userGrantedRoles.isCFGRoleAvail&&(r.ChangeAccessDetails.SetApplicability="false"),l.onSecurityContext(t,l)})):"Change Order"==r.type?i.populateChangeOrderOrChangeRequestAccess(l.options.objectid,n).then((function(){!1===l.userGrantedRoles.isCFGRoleAvail&&(r.ChangeAccessDetails.SetApplicability="false"),l.onSecurityContext(t,l)})):l.onSecurityContext(t,l),o()}),(function(e){a(e)}))}else"SessionEffectivity"==l.options.mode&&(enoviaServerFilterWidget.fromCaller="SessionEffectivity",l.onSecurityContext(t,l),o())}))}))}))})),l.subscribeModelEvents()})).catch((e=>{a(e)}))}))},onSecurityContext:function(e,t){if("Applicability"==t.options.mode)new Promise((function(e,o){var n=i.getChangeUrl(t.options.objectid,"GET");i.makeWSCall(n,"GET","enovia","application/json","",(function(t){e(t)}),(function(e){o(e)}),!0)})).then((async function(e){if(t.showImportAppIcon=!1,t.options.isxRevisionEffectivity=!1,"Change Action"==r.type||"Change Order"==r.type){"Change Action"==r.type?t.expressionXml=e.changeaction.applicability.expressionXML:t.expressionXml=e.applicability.expressionXML?e.applicability.expressionXML:e.applicability.xml;try{let e=(await i.fetchApplicabilityFrom(t.options.objectid)).data[0].copyAppIds;if(!e||e.length>1||0===e.length)t.showImportAppIcon=!1;else{let o=e[0];t.showImportAppIcon=!0;let n="/resources/ecm/modeler/changeorder/pid:"+o+"/getapplicability",s=await i.getChangeApplicability(n);t.appToBeCopied=s.applicability.expressionXML?s.applicability.expressionXML:s.applicability.xml,t.enableImportButton=""!==t.appToBeCopied}t.options.expressionJson=l.EvolutionXMLtoJSONConvertor(t.expressionXml),t.expressionXml&&t.expressionXml.indexOf("</XGraph>")>=0&&(t.options.isxRevisionEffectivity=!0,t.options.expressionJson[0].expression.effExpressionXml=t.expressionXml),t.populateModels(t)}catch(e){console.log("Error fetchApplicabilityFrom web service call"),console.log(e),t.showImportAppIcon=!1,t.options.expressionJson=l.EvolutionXMLtoJSONConvertor(t.expressionXml),t.populateModels(t)}}else t.expressionXml=e.applicability.expressionXML?e.applicability.expressionXML:e.applicability.xml,"Decision"===r.type&&(r.ChangeAccessDetails={},r.ChangeAccessDetails.SetApplicability=e.hasEditAccess),t.preValidateApplicabilityXMLForReadability(),t.options.expressionJson=l.EvolutionXMLtoJSONConvertor(t.expressionXml),t.expressionXml&&t.expressionXml.indexOf("</XGraph>")>=0&&(t.options.isxRevisionEffectivity=!0),t.populateModels(t)}),(function(e){if("Change Action"!=r.type)return t.expressionXml="",r.ChangeAccessDetails={},r.ChangeAccessDetails.SetApplicability="false",t.options.expressionJson=l.EvolutionXMLtoJSONConvertor(t.expressionXml),void t.populateModels(t);t.evolutionSpinner.hide(),i.showwarning(h.Get_Applicability_Failed,"error")}));else if("SessionEffectivity"==t.options.mode)if(null!=t.options.isxRevisionEffectivity&&1==t.options.isxRevisionEffectivity){if(null!=t.options.modelList&&t.options.modelList.length>0){t.options.objectSelectionType="SessionxRevision";let e={selectedReferenceId:t.options.modelList[0],isPostProcessRequired:!0,referenceRevision:" ",selectedDataType:t.options.selectedDataType};t.options.modelName&&(e.modelName=t.options.modelName),t.addXRevisionInfo(e)}}else t.options.expressionJson=l.EvolutionXMLtoJSONConvertor(t.options.iXml),t.populateModels(t)},isInaccessibleNodesInXml:function(e){let t=!1;let i={iExpression:(new DOMParser).parseFromString(e,"text/xml").getElementsByTagName("Expression")[0],iTagName:"Context",iAttributeName:"HolderName"};return t=this.checkForInaccessibleNodesInXml(i),i.iTagName="Root",i.iAttributeName="Name",0==t&&(t=this.checkForInaccessibleNodesInXml(i),1==t)?t:(i.iTagName="Leaf",i.iAttributeName="Name",0==t&&(t=this.checkForInaccessibleNodesInXml(i),1==t)||(i.iTagName="Single",i.iAttributeName="Name",0==t&&(t=this.checkForInaccessibleNodesInXml(i))),t)},preValidateApplicabilityXMLForReadability:function(){null!=this.expressionXml&&null!=this.expressionXml||(this.expressionXml="");var e=(new DOMParser).parseFromString(this.expressionXml,"text/xml").getElementsByTagName("Expression");if(e.length>0){var t={iExpression:e[0],iTagName:"Context",iAttributeName:"HolderName"};let i=!1;i=this.checkForInaccessibleNodesInXml(t),t.iTagName="Root",t.iAttributeName="Name",0==i&&(i=this.checkForInaccessibleNodesInXml(t)),t.iTagName="Leaf",t.iAttributeName="Name",0==i&&(i=this.checkForInaccessibleNodesInXml(t)),t.iTagName="Single",t.iAttributeName="Name",0==i&&(i=this.checkForInaccessibleNodesInXml(t)),1==i&&(r.ChangeAccessDetails.SetApplicability="false",this.expressionXml="")}},checkForInaccessibleNodesInXml:function(e){var t=e.iExpression.getElementsByTagName(e.iTagName);if(t.length>0)for(var i=0;i<t.length;i++){if("###"===t[i].attributes[e.iAttributeName].value)return!0}return!1},onUpdate:function(e){if(r.evolutionModelItemClickCount=0,!e||"firstButton"!=e.buttonId)return D.criteriaViewContainer&&D.criteriaViewContainer.destroy(),null!=D.options.dialogue&&"undefined"!=D.options.dialogue&&null!=D.options.dialogue.object&&"undefined"!=D.options.dialogue.object&&D.options.dialogue.modelViewContainer.show(),D.modelListView.modelSetView.show(),D.modelListView.adjustResponsiveView(),void D.autocompleteParent.show();var t=!0,i=null;if(null!=D.CfgEvolutionCriteriaView&&(t=null!=(i=D.CfgEvolutionCriteriaView.buildData())),null!=D.CfgEvolutionCriteriaView&&null!=i&&0!=t&&D.updateCollection(i),"Applicability"==D.options.mode){if(0==t)return;""==D.options.selectedcollection.getGlobalEvolutionExpression()&&(D.criteriaViewContainer&&D.criteriaViewContainer.destroy(),D.modelListView.modelSetView.show(),D.modelListView.adjustResponsiveView(),D.autocompleteParent.show()),D.showSpinnerforSaveApplicability("mask"),D.onSaveApplicability(e)}else if("SessionEffectivity"==D.options.mode){if(0==t)return;D.criteriaViewContainer&&D.criteriaViewContainer.destroy(),null!=D.options.dialogue&&"undefined"!=D.options.dialogue&&null!=D.options.dialogue.object&&"undefined"!=D.options.dialogue.object&&D.options.dialogue.modelViewContainer.show(),D.modelListView.modelSetView.show(),D.modelListView.adjustResponsiveView(),D.autocompleteParent.show()}},onUpdatexRevTileView:function(e){if(e&&"firstButton"==e.event.buttonId){if(e.ExpAndJson&&null!=e.ExpAndJson.xml){D.options.expression.xmlExpression=e.ExpAndJson.xml,D.options.expression.effExpressionXml=l.getxRevisionEvolutionExpression(e);let t="";if(""!=e.ExpAndJson.xml?t=i.getDisplayExpressionUsingXSLT(D.options.expression.effExpressionXml):"SessionEffectivity"==D.options.mode?(D.options.emptyContextText=m.emptyContextText_xRevision_SessionEffectivity,t=D.options.emptyContextText):"Applicability"==D.options.mode&&(D.options.emptyContextText=m.emptyContextText_xRevision_Applicability,t=D.options.emptyContextText),D.options.selectedmodel.set("displayexpression",t),"Applicability"==D.options.mode){let t="",i="",o="";D.options.selectedmodel&&D.options.selectedmodel.collection.length>0&&(t=D.options.selectedmodel.get("selectedDataType"),i=D.options.selectedmodel.get("name"),o=D.options.selectedmodel.get("referenceRevision"));let n={typeValue:t,nameValue:i,revisionValue:o};D.globalexpression=l.getxRevisionApplicabilityExpression(e,n),D.options.expression.effExpressionXml=D.globalexpression,D.onSaveApplicability(e)}}D.onUpdate(e)}else r.evolutionModelItemClickCount=0,D.criteriaViewContainer&&D.criteriaViewContainer.destroy(),null!=D.options.dialogue&&"undefined"!=D.options.dialogue&&null!=D.options.dialogue.object&&"undefined"!=D.options.dialogue.object&&D.options.dialogue.modelViewContainer.show(),D.modelListView.modelSetView.show(),D.modelListView.adjustResponsiveView(),D.autocompleteParent.show()},subscribeModelEvents:function(){r.ModelEvents.subscribe({event:"LaunchingDictionarySelection"},(function(e){D.criteriaViewContainer&&D.criteriaViewContainer.hide()})),r.ModelEvents.subscribe({event:"ProductStateDialogClosed"},(function(e){D.criteriaViewContainer&&D.criteriaViewContainer.show()})),r.ModelEvents.subscribe({event:"UnitsDialogClosed"},(function(e){D.criteriaViewContainer&&D.criteriaViewContainer.show()}))},updateCollection:function(e){D.options.selectedmodel.set("expression",e);var t="",o="";"SessionEffectivity"==D.options.mode?(t=D.options.selectedcollection.getGlobalSessionExpression(),o=D.options.selectedmodel.getContextSessionExpression()):"Applicability"==D.options.mode&&(t=D.options.selectedcollection.getGlobalChangeExpression(),o=D.options.selectedmodel.getContextEvolutionExpression()),D.globalexpression=t;var n=i.getDisplayExpressionUsingXSLT(o);e.displayexpression=n||"",null!=n&&null!=n&&""!=n||(n=D.options.emptyContextText),D.options.selectedmodel.set("displayexpression",n)},sendApplicabilityChangeEvent:function(){let e=D.collection.getGlobalChangeExpression(!0),t="";e&&(t=i.getDisplayExpressionUsingXSLT(e));var o={operation:"applicability_update",operationVersion:"1.0",content:{id:D.options.objectid,applicability_DisplayValue:t,applicability_XML:e}};u.publish("applicability:update:notification",JSON.stringify(o)),console.log(o)},showSpinnerforSaveApplicability:function(e){"mask"==e?null!=document.querySelector("#FacetDivForApplicabilityContext")?f.mask(document.querySelector("#FacetDivForApplicabilityContext")," "):null!=document.querySelector("#contentAppdiv")&&f.mask(document.querySelector("#contentAppdiv")," "):"unmask"==e&&(null!=document.querySelector("#FacetDivForApplicabilityContext")?f.unmask(document.querySelector("#FacetDivForApplicabilityContext")):null!=document.querySelector("#contentAppdiv")&&f.unmask(document.querySelector("#contentAppdiv")))},onSaveApplicability:function(e){var t=this;new Promise((function(e,t){var o=i.getChangeUrl(D.options.objectid,"PUT"),n={};n="Change Action"==r.type?{version:"v0",changeaction:{modify:{applicability:{xml:D.globalexpression}}}}:{version:"1.0",applicability:{xml:D.globalexpression}};n=JSON.stringify(n);i.makeWSCall(o,"PUT","enovia","application/json",n,(function(t){e(t)}),(function(e,i){D.showSpinnerforSaveApplicability("unmask"),t(i)}),!0)})).then((function(e){D.criteriaViewContainer&&D.criteriaViewContainer.destroy(),D.modelListView.modelSetView.show(),D.modelListView.adjustResponsiveView(),D.autocompleteParent.show(),null!=D.options.dialogue&&"undefined"!=D.options.dialogue&&null!=D.options.dialogue.object&&"undefined"!=D.options.dialogue.object&&D.options.dialogue.modelViewContainer.show(),i.showwarning(h.Save_Successful_Applicability,"success","Fast",t.warningMsgContainer),D.sendApplicabilityChangeEvent(),D.showSpinnerforSaveApplicability("unmask")}),(function(e){D.criteriaViewContainer&&D.criteriaViewContainer.destroy(),D.modelListView.modelSetView.show(),D.modelListView.adjustResponsiveView(),D.autocompleteParent.show(),null!=D.options.dialogue&&"undefined"!=D.options.dialogue&&null!=D.options.dialogue.object&&"undefined"!=D.options.dialogue.object&&D.options.dialogue.modelViewContainer.show(),e?i.showwarning(e.errorMessage,"error"):i.showwarning(h.Set_Fail_Applicability,"error")}))},isOneCriteriaCondition:function(e){var t=e.products,i=e.manufacturingPlans,o=e.builds;null==o&&(o="False");var n="False";return 1==r.configurationCriteria.contextualDate&&(n="TRUE"),0==r.configurationCriteria.unit&&(o="False"),"TRUE"==t.toUpperCase()&&"FALSE"==i.toUpperCase()&&"FALSE"==n.toUpperCase()&&"FALSE"==o.toUpperCase()?"products":"FALSE"==t.toUpperCase()&&"TRUE"==i.toUpperCase()&&"FALSE"==n.toUpperCase()&&"FALSE"==o.toUpperCase()?"manufacturingPlans":""},getModelsFromServer:function(e){var t,o=this;let n=0,s=this.options.expressionJson.length;if(this.options.expressionJson=this.options.expressionJson.filter((e=>{if("###"!==e.expression.name)return"###"!==e.expression.name;n++})),n==s)return Promise.reject();0!=n&&n<s&&(o.evolutionSpinner&&o.evolutionSpinner.hide(),i.showwarning(h.Partial_Accessible_Error,"error"));let a='(flattenedtaxonomies:"types/Model") AND ('+(t=this.options.expressionJson.map((function(e){return'(([name]:("'+e.expression.name+'")))'})).join(" OR "))+")";o.options.isxRevisionEffectivity&&(a='(revisionmode:"EffectivityBased") AND ('+t+")");return new Promise((function(t,o){enoviaServerFilterWidget.contextUser;var n={};n=e?{with_indexing_date:!0,with_nls:!0,label:"cfgLabel",locale:"en",select_predicate:["ds6w:label","ds6w:type","ds6wg:revision","ds6w:description","ds6w:identifier","ds6w:modified","ds6w:created","ds6w:responsible","ds6w:lastModifiedBy","ds6wg:marketing_Name"],select_file:["icon","thumbnail_2d"],query:a,order_by:"desc",order_field:"relevance",nresults:1e3,next_start:e,source:[],tenant:enoviaServerFilterWidget.tenant}:{with_indexing_date:!0,with_nls:!0,label:"cfgLabel",locale:"en",select_predicate:["ds6w:label","ds6w:type","ds6wg:revision","ds6w:description","ds6w:identifier","ds6w:modified","ds6w:created","ds6w:responsible","ds6w:lastModifiedBy","ds6wg:marketing_Name"],select_file:["icon","thumbnail_2d"],query:a,order_by:"desc",order_field:"relevance",nresults:1e3,start:"0",source:[],tenant:enoviaServerFilterWidget.tenant},n=JSON.stringify(n);i.makeWSCall("/search?xrequestedwith=xmlhttprequest","POST","enovia","application/json",n,(function(e){t(e)}),(function(){o()}),!0,{isfederated:"true"})}))},addModelsFromServer:function(e){var t=this;this.options.expressionJson.length>0?t.getModelsFromServer(e).then((function(e){0==e.infos.nhits?r.Models=[]:r.Models=r.Models.concat(e.results),t.postModelProcessing()}),(e=>{t.evolutionSpinner&&t.evolutionSpinner.hide(),i.showwarning(h.Not_Accessible_Eff_Error,"error")})):(r.Models=[],t.postModelProcessing())},addXRevisionInfo:function(e){let t=this;return new Promise(((o,n)=>{t.collection||(t.collection=new d(t.options),t.collection.reset(),t.options.expressionJson=l.EvolutionXMLtoJSONConvertor(""));let s={referenceIds:[e.selectedReferenceId]};i.getMultipleConfigurationContextInfo(s).then((i=>{let n="",s="",a="",r=" ",d=enoviaServerFilterWidget.baseURL,c=d+"/snresources/images/icons/large/I_ENOVIA_Baseline.png",p=d+"/snresources/images/icons/small/I_ENOVIA_Baseline.png";i.xRevisionContent&&1===i.xRevisionContent.length&&i.xRevisionContent[0].xRevisionGraph&&i.xRevisionContent[0].xRevisionGraph.name&&(n=i.xRevisionContent[0].xRevisionGraph.name,s=i.xRevisionContent[0].referencePID,a=i.xRevisionContent[0].xRevisionGraph.physicalid);let u,m="";t.options.iXml&&(u=t.options.iXml,m=l.getxRevXMLFromGlobalXML(u));let h={};h.value=s,h.graphId=a,h.image=c,h.icon=p,h.marketingName=n,h.name=n,e.modelName&&(h.name=e.modelName),h.xmlExpression=m,h.effExpressionXml=u,h.selectedDataType=e.selectedDataType?e.selectedDataType:"xRevision",e.referenceRevision&&" "!==e.referenceRevision&&(r=e.referenceRevision),h.referenceRevision=r,""!==s&&t.addModel(h),e.isPostProcessRequired&&t.postModelProcessing(),o()})).catch((e=>{n(e)}))}))},postModelProcessing:function(){1==(n=this).options.isxRevisionEffectivity&&"Applicability"!=n.options.mode||n.processexpressionJsonForIds(n),"Applicability"==n.options.mode?(n.options.noModelsErrorMessage=h.Empty_Applicability,n.options.editActionLabel=h.Edit_Applicability,n.options.clearActionLabel=h.Clear_Expression,n.options.removeActionLabel=h.Remove,n.options.emptyContextText=h.emptyContextText_Applicability,n.options.objectSelectionType="ApplicabilityModel",1==n.options.isxRevisionEffectivity&&(n.options.objectSelectionType="ApplicabilityxRevision",n.options.emptyContextText=m.emptyContextText_xRevision_Applicability),n.options.parentElement=n.options.parent,n.options.expressionArray=n.options.expressionJson,n.options.Models=r.Models,n.options.Access=r.ChangeAccessDetails):"SessionEffectivity"==n.options.mode&&(n.options.noModelsErrorMessage=h.Empty_SessionEffectivity,n.options.editActionLabel=h.Edit_SessionEffectivity,n.options.clearActionLabel=h.Clear_SessionEffectivity,n.options.removeActionLabel=h.Remove,n.options.emptyContextText=h.emptyContextText_SessionEffectivity,n.options.objectSelectionType="SessionModel",1==n.options.isxRevisionEffectivity&&(n.options.objectSelectionType="SessionxRevision"),n.options.parentElement=n.options.parent,n.options.expressionArray=n.options.expressionJson,n.options.Models=r.Models),n.options.editActionCallback=function(e){if("Applicability"==n.options.mode||"SessionEffectivity"==n.options.mode){if(null!=n.options.Access&&(n.options.Access.SetApplicability&&"false"==n.options.Access.SetApplicability||n.options.Access.SetSessionEffectvity&&"false"==n.options.Access.SetSessionEffectvity||n.options.Access.SetEvolutionEffectvity&&"false"==n.options.Access.SetEvolutionEffectvity)||1==n.options.readOnly)return;if(n.options.expression=e.get("expression"),n.options.selectedmodel=e,n.options.selectedcollection=n.collection,"SessionxRevision"==n.options.objectSelectionType||"ApplicabilityxRevision"==n.options.objectSelectionType){let e,t={};t.firstButtonText=m.CFG_Apply,t.secondButtonText=m.CFG_Back,t.parentElement=n.options.parent,t.use=n.options.mode,t.onButtonClickCB=n.onUpdatexRevTileView,D.CfgEvolutionCriteriaView=void 0,n.modelListView.modelSetView.hide(),n.autocompleteParent.hide(),null!=D.options.dialogue&&"undefined"!=D.options.dialogue&&null!=D.options.dialogue.object&&"undefined"!=D.options.dialogue.object&&D.options.dialogue.modelViewContainer.hide(),n.options.expression.xmlExpression&&""!=n.options.expression.xmlExpression?(t.psJson=n.options.expression.psJson,t.xml=n.options.expression.xmlExpression,t.xmlDesc=n.options.expression.psXmlDesc,t.hasEffectivity=!0,t.effExpressionXml=n.options.expression.effExpressionXml,t.xRevisionContent={referencePID:n.options.expression.modelId},e=new a,e.create(t)):(t.xRevisionContent={referencePID:n.options.expression.modelId},e=new a,e.create(t))}else{new Promise((function(e,t){var o={version:"1.0.0",modelIds:[{id:"pid:"+n.options.expression.modelId}]};o=JSON.stringify(o);i.makeWSCall("/resources/modeler/browsing/model/getcriteria","POST","enovia","application/json",o,(function(t){e(t)}),(function(e){console.log("fail to get last product evolution")}),!0)})).then((function(e){if(null!=e.criteria[0].products&&"FALSE"==e.criteria[0].products.toUpperCase()&&null!=e.criteria[0].manufacturingPlans&&"FALSE"==e.criteria[0].manufacturingPlans.toUpperCase()&&null!=e.criteria[0].builds&&"FALSE"==e.criteria[0].builds.toUpperCase()&&r.configurationCriteria&&null!=r.configurationCriteria.contextualDate&&"FALSE"==r.configurationCriteria.contextualDate.toString().toUpperCase())i.showwarning(h.Not_Accessible_Eff_Error,"error");else{n.options.criteriasAvailable=e.criteria[0],n.options.parentElement=n.options.parent,n.modelListView.modelSetView.hide(),n.autocompleteParent.hide(),null!=D.options.dialogue&&"undefined"!=D.options.dialogue&&null!=D.options.dialogue.object&&"undefined"!=D.options.dialogue.object&&D.options.dialogue.modelViewContainer.hide();var t=n.isOneCriteriaCondition(n.options.criteriasAvailable);if(""!=t){n.createDictionarySelectionView(t,n.options.expression),D.CfgEvolutionCriteriaView=void 0;var o=r.ModelEvents.subscribe({event:"ProductStateDialogClosed"},(function(e){null!=e.xml&&("products"==t?(n.options.expression.xmlExpression=e.xml,n.options.expression.psXmlDesc=e.xmlDesc,n.options.expression.psJson=e.json):"manufacturingPlans"==t&&(n.options.expression.impXml=e.xml,n.options.expression.mpXmlDesc=e.xmlDesc,n.options.expression.mpJson=e.json)),null!=e.xml&&n.updateCollection(n.options.expression);var i={buttonId:""};null!=e.xml&&(i.buttonId="firstButton"),n.onUpdate(i),r.ModelEvents.unsubscribe(o)}))}else require(["DS/CfgEvolutionUX/CfgEvolutionCriteriaView"],(function(e){n.options.parentElement=n.options.parent;var t,i=m.CFG_Ok,o=m.CFG_Cancel;"SessionEffectivity"==n.options.mode&&(i=m.CFG_Apply,o=m.CFG_Back);t=n.onUpdate;var s={isHeader:!0,isFooter:!0,firstButtonText:i,secondButtonText:o,headerText:n.options.selectedmodel.get("marketingName")?n.options.selectedmodel.get("marketingName"):n.options.selectedmodel.get("name"),toggleSessionEffectivity:!1,onButtonClickCB:t};n.criteriaViewContainer=new p(s).render(),n.criteriaViewContainer.getContent().addClassName("CfgContainerView-EditEvolution"),n.options.parent=n.criteriaViewContainer._body,n.CfgEvolutionCriteriaView=new e(n.options),n.CfgEvolutionCriteriaView.render(),n.criteriaViewContainer.inject(n.options.parentElement),n.options.parent=n.options.parentElement}))}}))}}},n.options.removeModelCallback=function(e){let t=!0;if("Model"!=e.get("selectedDataType")&&(t=!1),n.collection.removeModel(e),n.CfgAutocompleteControlEvolutionObj){let e=n.collection.getselectedModelsIDs(),t="Model",i='(revisionmode:"EffectivityBased")';0==n.collection.length?(n.cfgAutocompleteObj.searchString="",n.cfgAutocompleteObj.setQuery([{type:t,condition:"",excludedArray:e},{type:"",condition:i,excludedArray:e}]),n.cfgAutocompleteObj.updateAutoCompleteModel(),n.options.iXml=""):n.collection.length>=0&&("Model"!==n.collection.at(0).get("selectedDataType")?t="":(t=n.collection.at(0).get("selectedDataType"),i=""),n.cfgAutocompleteObj.setQuery([{type:t,condition:i,excludedArray:e}]),n.cfgAutocompleteObj.updateAutoCompleteModel())}if("Applicability"==n.options.mode){n.collection.getselectedModelsIDs();var o=n.collection.getGlobalChangeExpression();new Promise((function(e,t){var s=i.getChangeUrl(n.options.objectid,"PUT"),a={};a="Change Action"==r.type?{version:"v0",changeaction:{modify:{applicability:{xml:o}}}}:{version:"1.0",applicability:{xml:o}};a=JSON.stringify(a);i.makeWSCall(s,"PUT","enovia","application/json",a,(function(t){e(t)}),(function(e){t(e)}),!0)})).then((function(e){t?i.showwarning(h.model_Successful_Removal,"success"):i.showwarning(h.xRevision_Successful_Removal,"success"),D.sendApplicabilityChangeEvent()}),(function(e){i.showwarning(h.Save_Fail_Applicability,"error")}))}else if("SessionEffectivity"==n.options.mode)n.collection.getselectedModelsIDs()};var e=n.options.parentElement;"SessionEffectivity"==n.options.mode&&null!=D.options.dialogue&&"undefined"!=D.options.dialogue&&null!=D.options.dialogue.object&&"undefined"!=D.options.dialogue.object&&(n.options.parentElement=D.options.dialogue.modelViewContainer._body,n.options.parent=D.options.dialogue.modelViewContainer._body),n.warningMsgContainer=UWA.createElement("div",{class:"cfg-warning-msg-container"}),n.warningMsgContainer.inject(n.options.parent),n.autocompleteParent=UWA.createElement("div",{class:"Cfg-autocompleteParentClass",styles:{display:"flex",float:"right",padding:"0 5px"}}),n.autocompleteParent.inject(n.options.parent),(null!=n.options.Access&&"false"==n.options.Access.SetApplicability||1==n.options.readOnly)&&(n.autocompleteParent.hide(),n.options.noModelsErrorMessage=h.Empty_Applicability_beyond_active_state);var t=new DOMParser;null!==n.expressionXml&&void 0!==n.expressionXml||(n.expressionXml="");var o=t.parseFromString(n.expressionXml,"text/xml").getElementsByTagName("Description");1==n.options.isxRevisionEffectivity&&"Applicability"!=n.options.mode||(n.collection=new d(n.options),n.collection.reset(),n.collection.initialising(n.options)),"Applicability"==n.options.mode&&D.sendApplicabilityChangeEvent();var n;n.options.mode&&n.options.mode,n.autocompletecontainer=UWA.createElement("div",{class:"Cfg-autocompletecontainerClass"}),n.autocompletecontainer.inject(n.autocompleteParent),n.autocompletecontainer.hide();(n=this).collection.getselectedModelsIDs();n.CfgAutocompleteControlEvolutionObj=this.createAutocompleteWithSearch(n.autocompletecontainer,h.Autocomplete_Placeholder);const s={entries:[{id:"cfgAddModel",tooltip:m.Add_Model,dataElements:{typeRepresentation:"functionIcon",value:e=>this.plusIconCB(e)},icon:{iconName:"plus wux-ui-3ds",fontIconFamily:1,className:""},position:"far",domId:"cfgPlusIcon"},{id:"cfgImport",tooltip:m.Copy_Applicability,dataElements:{typeRepresentation:"functionIcon",value:e=>this.importIconCB(e),visibleFlag:n.showImportAppIcon},icon:{iconName:"import wux-ui-3ds",fontIconFamily:1},position:"far",domId:"cfgImportIcon"}]};var l=b.prototype.createTreeDocument(s);n.toolBar=new b({direction:"horizontal",items:l}),n.toolBar.inject(n.autocompleteParent),null!=n.showImportAppIcon&&1==n.showImportAppIcon&&this.toolBar.updateNodeModel("cfgImport",{dataElements:{visibleFlag:!0}}),n.enableDisableIcons(),"Applicability"!=n.options.mode||0!=o.length||""==n.expressionXml?(n.modelListView=new c(n.options),n.modelListView.render(n.collection),r.ModelEvents.subscribe({event:"ModelSelected"},(function(e){n.addModel(e)})),n.options.parentElement=e,n.options.parent=e,n.evolutionSpinner.hide()):n.processexpressionsForDescriptionForApplicability()},plusIconCB:function(e){this.toggleHidden?(this.autocompletecontainer.hide(),this.toolBar.updateNodeModel("cfgAddModel",{icon:{className:""}})):(this.autocompletecontainer.show(),this.toolBar.updateNodeModel("cfgAddModel",{icon:{className:"cfg-active-plus"}})),this.toggleHidden=!this.toggleHidden},importIconCB:function(e){null!=this&&null!=this&&null!=this.enableImportButton&&0==this.enableImportButton||(this.copyApplicability(),this.enableImportButton=!1,this.toolBar.updateNodeModel("cfgImport",{icon:{className:"disableButton"}}),null!=this.toolBar._toolbar._elementsArray[1].element&&this.toolBar.updateNodeModel("cfgImport",{icon:{className:"disableButton"}}))},populateModels:function(e){e.addModelsFromServer()},createDictionarySelectionView:function(e,t){var o=this;r.ModelEvents.publish({event:"LaunchingDictionarySelection",data:{}});var n={};if("products"==e?(n.mode="PRODUCTS",n.psJson=t.psJson):"manufacturingPlans"==e&&(n.mode="MANUFACTURINGPLAN",n.psJson=t.mpJson),n.use="","SessionEffectivity"==o.options.mode?(n.firstButtonText=m.CFG_Apply,n.secondButtonText=m.CFG_Back):(n.firstButtonText=m.CFG_Ok,n.secondButtonText=m.CFG_Cancel),r.renderTo=n.parentElement=o.options.parentElement,n.ModelLabel=o.options.selectedmodel.get("name"),n.modelID=o.options.selectedmodel.get("id"),n.displayexpression=t.displayexpression?t.displayexpression:"",n.displayexpression=n.displayexpression.substring(n.displayexpression.indexOf(":")+1),n.displayexpression.trim(),n.displayCompactMode=o.options.displayCompactMode,"PRODUCTS"==n.mode?(n.xmlExpression=t.xmlExpression?t.xmlExpression:"",n.xmlDesc=t.psXmlDesc?t.psXmlDesc:""):"MANUFACTURINGPLAN"==n.mode&&(n.xmlExpression=t.impXml?t.impXml:"",n.xmlDesc=t.mpXmlDesc?t.mpXmlDesc:""),o.options.evolutionSpinner&&o.options.evolutionSpinner.hide(),"PRODUCTS"!=n.mode&&"MANUFACTURINGPLAN"!=n.mode||o.CfgVersionGraphLayoutInstance.create(n),null==r.getDictionaryByCriteria(t.modelId,e)[e]){var s="",a="",d='<?xml version="1.0" encoding="UTF-8"?><CfgFilterExpression xmlns="urn:com:dassault_systemes:config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="urn:com:dassault_systemes:config CfgFilterExpression.xsd"><FilterSelection SelectionMode="Strict">',c="</FilterSelection></CfgFilterExpression>";"products"==e?a=d+'<Context xmlns="urn:com:dassault_systemes:config" HolderType="Model" HolderName="'+t.name+'" >'+t.xmlExpression+"</Context>"+c:"manufacturingPlans"==e&&(a=d+'<Context xmlns="urn:com:dassault_systemes:config" HolderType="Model" HolderName="'+t.name+'" >'+t.impXml+"</Context>"+c),""!==a&&(s={evolutionExpression:JSON.stringify({filterExpression:l.getValidXmlWithoutDescId(a)})},console.log("CfgEvolutionLayoutFactory evoExpression = "+a+" wParam after descId removed = "+s.evolutionExpression)),("products"==e||"manufacturingPlans"==e?i.getDictionaryFromServer(t.modelId,"onlyUnfrozenNodes=1&"+e,null,s):i.getDictionaryFromServer(t.modelId,e)).then((function(i){r.addDictionaryByCriteria(t.modelId,i,e),n.data=r.getDictionaryByCriteria(t.modelId,e),"PRODUCTS"==n.mode?o.CfgVersionGraphLayoutInstance.render(n.data.products):"MANUFACTURINGPLAN"==n.mode&&o.CfgVersionGraphLayoutInstance.render(n.data.manufacturingPlans)}))}else n.data=r.getDictionaryByCriteria(t.modelId,e),setTimeout((function(){"PRODUCTS"==n.mode?o.CfgVersionGraphLayoutInstance.render(n.data.products):"MANUFACTURINGPLAN"==n.mode&&o.CfgVersionGraphLayoutInstance.render(n.data.manufacturingPlans)}),100)},addModelFromNative:function(e){var t=this;v.getCfgUXEnvVariables();if(e.length>0){let o="Model",n="",s="",a=" ";e.forEach((function(e){var l={};e.basicData.forEach((function(e){"resourceid"==e.name&&(l.value=e.value,s=e.value),"preview_url"==e.name&&(l.image=e.value),"type_icon_url"==e.name&&(l.icon=e.value),"ds6w:label"==e.name&&(l.marketingName=e.value),"ds6w:identifier"==e.name&&(l.name=e.value,n=e.value),"ds6w:who/ds6w:responsible/ds6w:originator"==e.name&&(l.owner=e.value),"ds6w:what/ds6w:status"==e.name&&-1!=e.value.indexOf("Model.")&&(l.state=e.value.split("Model.").pop()),"ds6w:what/ds6w:type"==e.name&&(o=e.value,l.selectedDataType=o),"ds6wg:revision"==e.name&&(l.referenceRevision=e.value,e.value&&(a=e.value))}));let r=[];if("Model"!=o&&""!=s){if("SessionEffectivity"==t.options.mode&&(t.options.emptyContextText=m.emptyContextText_xRevision_SessionEffectivity),0!=t.collection.length){let e=!1;for(let i=0;i<t.collection.length;i++)if("Model"==t.collection.at(i).get("selectedDataType")){e=!0;break}return void(0==e&&i.showwarning(h.CFG_Work_Under_Evolution_Only_SingleRevisionGraph_Suported_Error,"error"))}{r.push({selectedDataType:o,modelName:n,referenceRevision:a});let e={selectedReferenceId:s,isPostProcessRequired:!1,referenceRevision:a,selectedDataType:o,modelName:l.name};t.addXRevisionInfo(e),t.cfgAutocompleteObj.searchString="",t.cfgAutocompleteObj.setQuery([{type:"",condition:'(revisionmode:"EffectivityBased")',excludedArray:[]}]),t.cfgAutocompleteObj.updateAutoCompleteModel()}}else if("SessionEffectivity"==t.options.mode&&(t.options.emptyContextText=h.emptyContextText_Evo_Effectivity),0==t.collection.length)t.addModel(l);else if(t.collection.length>0){let e=!1;for(let i=0;i<t.collection.length;i++)if("Model"!=t.collection.at(i).get("selectedDataType")){e=!0;break}0==e&&t.addModel(l)}})),"Applicability"==t.options.mode&&(t.options.objectSelectionType="ApplicabilityModel","Model"!=o?(t.options.objectSelectionType="ApplicabilityxRevision",t.getCAApplicability(addedObjectInfo)):t.getCAApplicability()),"SessionEffectivity"==t.options.mode&&(t.options.objectSelectionType="SessionModel","Model"!=o&&(t.options.objectSelectionType="SessionxRevision"));let l="",r="",d=t.collection.getselectedModelsIDs();"Model"!==o?(l="",r='(revisionmode:"EffectivityBased")'):(l=t.collection.at(0).get("selectedDataType"),r=""),t.collection.length>=1&&(t.cfgAutocompleteObj.searchString="",t.cfgAutocompleteObj.setQuery([{type:l,condition:r,excludedArray:d}]),t.cfgAutocompleteObj.updateAutoCompleteModel())}},addModel:function(e){var t=this,o=e,n=[];n=JSON.stringify({builds:n});var s={modelId:o.value?o.value:o.id,psJson:[],mpJson:[],viewJson:null,iDateJson:{DateRanges:[]},iUnitJson:n,xmlExpression:"",iDateXml:"",iUnitXml:"",impXml:"",productstatecheckbox:!0,unitcheckbox:!0,datestatecheckbox:!0,manufacturingplanstatecheckbox:!0,milestoneJson:[],milestoneXml:"",milestoneCheckbox:!0},a={};a.selectedDataType=o.selectedDataType,t.addedDataType=o.selectedDataType,o.referenceRevision?a.referenceRevision=o.referenceRevision:a.referenceRevision=" ",a.expression=s,a.image=o.image,a.icon=o.icon,a.expression.modelId=a.modelId=o.value?o.value:o.id,a.expression.id=a.id=o.value?o.value:o.id,o.selectedDataType&&"Model"!=o.selectedDataType&&(a.expression.id=a.id=o.graphId,a.expression.xmlExpression=o.xmlExpression,a.expression.effExpressionXml=o.effExpressionXml,o.effExpressionXml&&(a.displayexpression=i.getDisplayExpressionUsingXSLT(o.effExpressionXml))),a.marketingName=a.expression.marketingName=o.marketingName,a.expression.name=a.name=o.name,a.expression.owner=a.owner=o.owner,a.expression.state=a.state=o.state,t.collection.addModel(a),null!=t.CfgAutocompleteControlEvolutionObj&&null!=t.modelListView&&("Model"!==o.selectedDataType?(t.CfgAutocompleteControlEvolutionObj.autoComplete.options.typeOfObject="",t.CfgAutocompleteControlEvolutionObj.autoComplete.options.xRevQuery='(revisionmode:"EffectivityBased")'):(t.CfgAutocompleteControlEvolutionObj.autoComplete.options.typeOfObject=o.selectedDataType,t.CfgAutocompleteControlEvolutionObj.autoComplete.options.xRevQuery=""),t.modelListView.adjustTileFlexStyles(),t.modelListView.adjustResponsiveView())},getCAApplicability:function(e){var t=this,o="";if(e&&1==e.length){let t={ExpAndJson:{xml:""}},i={typeValue:e[0].selectedDataType,nameValue:e[0].modelName,revisionValue:e[0].referenceRevision};o=l.getxRevisionApplicabilityExpression(t,i)}else o=t.collection.getGlobalChangeExpression();new Promise((function(e,n){var s=i.getChangeUrl(t.options.objectid,"PUT"),a={};a="Change Action"==r.type?{version:"v0",changeaction:{modify:{applicability:{xml:o}}}}:{version:"1.0",applicability:{xml:o}};a=JSON.stringify(a);i.makeWSCall(s,"PUT","enovia","application/json",a,(function(i){if(e(i),"ApplicabilityxRevision"===t.options.objectSelectionType&&t.collection.at(0)){let e=t.collection.at(0).get("expression");e.effExpressionXml=i.changeaction.applicability.expressionXML,t.collection.at(0).set("expression",e)}D.sendApplicabilityChangeEvent()}),(function(e){n(e)}),!0)}))},oniconbar:function(e,t){},processexpressionJsonForIds:function(e){for(var t=e.options.expressionJson.length,i=0;i<t;i++)for(var o=e.options.expressionJson[i],n=0;n<r.Models.length;n++)for(var s=r.Models[n].attributes.length,a=0;a<s;a++)"ds6w:identifier"==r.Models[n].attributes[a].name&&r.Models[n].attributes[a].value==o.expression.name&&(o.expression.modelId=o.modelId=r.Models[n].attributes[0].value,o.id=r.Models[n].attributes[0].value);for(var l=0;l<t;l++)for(o=e.options.expressionJson[l],n=0;n<r.Models.length;n++)for(s=r.Models[n].attributes.length,a=0;a<s;a++)if(r.Models[n].attributes[0].value==o.id&&"ds6w:label"==r.Models[n].attributes[a].name&&(o.expression.marketingName=o.marketingName=r.Models[n].attributes[a].value),r.Models[n].attributes[0].value==o.id&&"ds6w:identifier"==r.Models[n].attributes[a].name&&(o.name=r.Models[n].attributes[a].value),r.Models[n].attributes[0].value==o.id&&"ds6w:who/ds6w:responsible/ds6w:originator"==r.Models[n].attributes[a].name&&(o.owner=r.Models[n].attributes[a].value),r.Models[n].attributes[0].value==o.id&&"ds6w:what/ds6w:status"==r.Models[n].attributes[a].name&&(r.Models[n].attributes[a].dispValue?o.state=r.Models[n].attributes[a].dispValue:o.state=r.Models[n].attributes[a].value.replace("Model.","")),r.Models[n].attributes[0].value==o.id&&"preview_url"==r.Models[n].attributes[a].name&&(o.image=r.Models[n].attributes[a].value),r.Models[n].attributes[0].value==o.id&&"ds6w:what/ds6w:type"==r.Models[n].attributes[a].name&&(o.selectedDataType=r.Models[n].attributes[a].value),r.Models[n].attributes[0].value==o.id&&"ds6wg:revision"==r.Models[n].attributes[a].name&&(o.referenceRevision=r.Models[n].attributes[a].value?r.Models[n].attributes[a].value:" "),r.Models[n].attributes[0].value==o.id&&"type_icon_url"==r.Models[n].attributes[a].name&&(o.icon=r.Models[n].attributes[a].value,1==e.options.isxRevisionEffectivity)){let e=enoviaServerFilterWidget.baseURL+"/snresources/images/icons/small/I_ENOVIA_Baseline.png";o.icon=e}},AddModelsFromNative:function(e){var t=this,o=e.split(",");v.getCfgUXEnvVariables();t.getConfigurationContext(o).then((function(e){var o=e.results;if(o&&o.length>0){let e="Model",n="",s="",a=" ",l=[],r=!1;if(o.forEach((function(o){var d={};if(o.attributes.forEach((function(t){"resourceid"==t.name&&(d.value=t.value,s=t.value),"preview_url"==t.name&&(d.image=t.value),"type_icon_url"==t.name&&(d.icon=t.value),"ds6w:label"==t.name&&(d.marketingName=t.value),"ds6w:identifier"==t.name&&(d.name=t.value,n=t.value),"ds6w:who/ds6w:responsible/ds6w:originator"==t.name&&(d.owner=t.value),"ds6w:what/ds6w:status"==t.name&&-1!=t.value.indexOf("Model.")&&(d.state=t.value.split("Model.").pop()),"ds6w:what/ds6w:type"==t.name&&(e=t.value,d.selectedDataType=e),"ds6wg:revision"==t.name&&(d.referenceRevision=t.value,t.value&&(a=t.value))})),"Model"!=e&&""!=s)if(0==t.collection.length){l.push({selectedDataType:e,modelName:n,referenceRevision:a});let i={selectedReferenceId:s,isPostProcessRequired:!1,referenceRevision:a,selectedDataType:e,modelName:d.name};t.addXRevisionInfo(i),t.cfgAutocompleteObj.searchString="",t.cfgAutocompleteObj.setQuery([{type:"",condition:'(revisionmode:"EffectivityBased")',excludedArray:[]}]),t.cfgAutocompleteObj.updateAutoCompleteModel()}else{let e=!1;for(let i=0;i<t.collection.length;i++)if("Model"==t.collection.at(i).get("selectedDataType")){e=!0;break}0==e&&i.showwarning(h.CFG_Work_Under_Change_Only_SingleRevisionGraph_Suported_Error,"error"),r=!0}else if(0==t.collection.length)t.addModel(d);else if(t.collection.length>0){let e=!1;for(let i=0;i<t.collection.length;i++)if("Model"!=t.collection.at(i).get("selectedDataType")){e=!0;break}0==e&&t.addModel(d)}})),r)return;"Applicability"==t.options.mode&&(t.options.objectSelectionType="ApplicabilityModel","Model"!=e?(t.options.objectSelectionType="ApplicabilityxRevision",t.getCAApplicability(l)):t.getCAApplicability()),"SessionEffectivity"==t.options.mode&&(t.options.objectSelectionType="SessionModel","Model"!=e&&(t.options.objectSelectionType="SessionxRevision"));let d="",c="",p=t.collection.getselectedModelsIDs();"Model"!==e?(d="",c='(revisionmode:"EffectivityBased")'):(d=t.collection.at(0).get("selectedDataType"),c=""),t.collection.length>=1&&(t.cfgAutocompleteObj.searchString="",t.cfgAutocompleteObj.setQuery([{type:d,condition:c,excludedArray:p}]),t.cfgAutocompleteObj.updateAutoCompleteModel())}}))},getGlobalSessiondata:function(){return this.collection.getGlobalSessiondata()},copyApplicability:function(){var e=this;new Promise((function(t,o){var n=i.getChangeUrl(e.options.objectid,"PUT"),s={};"Change Action"==r.type&&(s={version:"v0",changeaction:{modify:{applicability:{xml:e.appToBeCopied}}}}),"Change Order"==r.type&&(s={version:"1.0",applicability:{xml:e.appToBeCopied}});s=JSON.stringify(s);i.makeWSCall(n,"PUT","enovia","application/json",s,(function(o){console.log("import successful");var n=document.querySelector("#FacetDivForApplicabilityContext");for("3DSpace"==enoviaServerFilterWidget.mode&&(n=document.querySelector("#contentAppdiv"));n&&n.hasChildNodes();)n.removeChild(n.lastChild);e.create(e.options),i.showNotifs("success","",h.Import_Applicability_FromCO_Successful,"",n),t(o)}),(function(e){console.log("import failed"),i.showNotifs("error",h.Import_Applicability_FromCO_Failed_Title,h.Import_Applicability_FromCO_Failed_SubTitle),o(e)}),!0)}))},processexpressionsForDescriptionForApplicability:function(){var e=this;console.log(e.options.expressionJson);e=this;for(var t=[],o=0;o<e.options.expressionJson.length;o++){var n="products";null==r.getDictionaryByCriteria(e.options.expressionJson[o].id,n)[n]&&(n="products=1&manufacturingPlans",t.push(i.getDictionaryFromServer(e.options.expressionJson[o].id,n)))}if(0==e.options.expressionJson.length)return e.collection=new d(e.options),e.collection.reset(),e.collection.initialising(e.options),e.modelListView=new c(e.options),e.modelListView.render(e.collection),r.ModelEvents.subscribe({event:"ModelSelected"},(function(t){e.addModel(t)})),void e.evolutionSpinner.hide();Promise.all(t).then((function(t){t.forEach((function(t){var i="products";r.addDictionaryByCriteria(t.id,t,i);i="manufacturingPlans";r.addDictionaryByCriteria(t.id,t,i),e.populateDisplayNames(t),null==window.DescriptionCount&&(window.DescriptionCount=1);for(var o=0;o<e.options.expressionJson.length;o++){var n=e.options.expressionJson[o].expression;if(e.options.expressionJson[o].id==t.id.replace("pid:","")){var s=n.psJson,a=[],l=[];if(0!=s.length)for(var d=0;d<s.length;d++){window.DescriptionCount++;var c=window.DescriptionCount;s[d].start.displayname=e.descriptionMap[t.id]["products"+s[d].start.name+"_"+s[d].start.revision],l.push('<TreeSeries DescId = "'+c+'" DisplayName="'+s[d].start.displayname+'"></TreeSeries>'),n.xmlExpression=n.xmlExpression.replace("products"+s[d].start.name+"_"+s[d].start.revision,c);for(var p=0;p<s[d].end.length;p++)window.DescriptionCount++,c=window.DescriptionCount,s[d].end[p].displayname=e.descriptionMap[t.id]["products"+s[d].end[p].name+"_"+s[d].end[p].revision],l.push('<TreeSeries DescId = "'+c+'" DisplayName="'+s[d].end[p].displayname+'"></TreeSeries>'),n.xmlExpression=n.xmlExpression.replace("products"+s[d].end[p].name+"_"+s[d].end[p].revision,c)}var u=n.mpJson;if(0!=u.length)for(var m=0;m<u.length;m++){window.DescriptionCount++;c=window.DescriptionCount;u[m].start.displayname=e.descriptionMap[t.id]["manufacturingPlans"+u[m].start.name+"_"+u[m].start.revision],a.push('<TreeSeries DescId = "'+c+'" DisplayName="'+u[m].start.displayname+'"></TreeSeries>'),n.impXml=n.impXml.replace("manufacturingPlans"+u[m].start.name+"_"+u[m].start.revision,c);for(var h=0;h<u[m].end.length;h++)window.DescriptionCount++,c=window.DescriptionCount,u[m].end[h].displayname=e.descriptionMap[t.id]["manufacturingPlans"+u[m].end[h].name+"_"+u[m].end[h].revision],a.push('<TreeSeries DescId = "'+c+'" DisplayName="'+u[m].end[h].displayname+'"></TreeSeries>'),n.impXml=n.impXml.replace("manufacturingPlans"+u[m].end[h].name+"_"+u[m].end[h].revision,c)}n.psXmlDesc=l,n.mpXmlDesc=a}}})),e.collection=new d(e.options),e.collection.reset(),e.collection.initialising(e.options),e.collection.updatedisplayExpressionsAsPerDisplayNames(),e.modelListView=new c(e.options),e.modelListView.render(e.collection),r.ModelEvents.subscribe({event:"ModelSelected"},(function(t){e.addModel(t)})),e.evolutionSpinner.hide()}))},populateDisplayNames:function(e){this.tnrArray={},this.tnrArray.type="products",this.rootrevisionarray=[];var t=e.products;this.mainderived(this.rootrevisionarray,t),this.descriptionMap[e.id]={},this.tnrArray.type="manufacturingPlans",this.rootrevisionarray=[];t=e.manufacturingPlans;this.mainderived(this.rootrevisionarray,t),this.descriptionMap[e.id]=this.tnrArray},mainderived:function(e,t){if(null!=t&&(0!==Object.keys(t).length||t.constructor!==Object)){var i={name:t.name,displayname:t.displayValue,revision:t.revision};this.tnrArray[this.tnrArray.type+t.name+"_"+t.revision]=t.displayValue,e.push(i),this.addChildren(i,t.Derived),this.mainderived(e,t["Main Derived"])}},addChildren:function(e,t){if(""!=t&&null!=t){null!=e.children&&0!=e.children.length||(e.children=[]);for(var i=0;i<t.length;i++){var o={name:t[i].name,displayname:t[i].displayValue,revision:t[i].revision};this.tnrArray[this.tnrArray.type+o.name+"_"+o.revision]=o.displayname,e.children.push(o),this.lastrevision=o,this.addChildren(o,t[i].Derived);var n=t[i]["Main Derived"];0!=Object.keys(n).length&&n.constructor===Object&&this.addChildren(e.children[e.children.length-1],[n])}}},getConfigurationContext:function(e){var t=e.map((function(e){return"physicalid : "+e})).join(" OR ");return new Promise((function(e,o){var n={};n={with_indexing_date:!0,with_nls:!0,label:"cfgLabel",locale:"en",select_predicate:["ds6w:label","ds6w:type","ds6wg:revision","ds6w:description","ds6w:identifier","ds6w:modified","ds6w:created","ds6w:responsible","ds6w:lastModifiedBy","ds6wg:marketing_Name"],select_file:["icon","thumbnail_2d"],query:'((flattenedtaxonomies:"types/Model") OR (revisionmode:"EffectivityBased")) AND '+t,order_by:"desc",order_field:"relevance",nresults:1e3,start:"0",source:[],tenant:enoviaServerFilterWidget.tenant},n=JSON.stringify(n);i.makeWSCall("/search?xrequestedwith=xmlhttprequest","POST","enovia","application/json",n,(function(t){e(t)}),(function(){o()}),!0,{isfederated:"true"})}))},enableDisableIcons:function(){null!=this.toolBar._toolbar._elementsArray[1]&&null!=this.toolBar._toolbar._elementsArray[1].element&&(null!=this.enableImportButton&&1==this.enableImportButton?this.toolBar.updateNodeModel("cfgImport",{icon:{className:""}}):null!=this.enableImportButton&&0==this.enableImportButton&&this.toolBar.updateNodeModel("cfgImport",{icon:{className:"disableButton"}}))},createAutocompleteWithSearch:function(e,t){let i={},o={},n=[],s=this.collection.getselectedModelsIDs();if(v.getCfgUXEnvVariables().xRevisionActivation){if(0==this.collection.length)i={type:"Model",condition:"",excludedArray:s},o={type:"",condition:'(revisionmode:"EffectivityBased")',excludedArray:[]},n.push(i),n.push(o);else if(this.collection.length>0)if("Model"!==this.collection.at(0).get("selectedDataType")){let e=[];for(const t of this.collection._models)e.push(t.get("expression").modelId);s=e,o={type:"",condition:'(revisionmode:"EffectivityBased")',excludedArray:s},n.push(o)}else i={type:this.collection.at(0).get("selectedDataType"),condition:"",excludedArray:s},n.push(i)}else 0==this.collection.length?(i={type:"Model",condition:"",excludedArray:[]},n.push(i)):this.collection.length>0&&(i={type:this.collection.at(0).get("selectedDataType"),condition:"",excludedArray:s},n.push(i));let a={query:n,searchTitle:t,showValue:!1,multiSelection:!0,placeholder:h.Search_PlaceHolder,minLengthBeforeSearch:0,parentElement:e,showRevision:!1,mode:this.options.mode,callBackFunction:e=>this.webUxautocompleteCallback(e),clearInfo:()=>{}};this.cfgAutocompleteObj=new C(a),this.cfgAutocompleteObj.setSelectedlist(s);const{autoComplete:l,searchBtn:r}=this.cfgAutocompleteObj.render();return{autoComplete:l,searchBtn:r}},webUxautocompleteCallback:async function(e){let t="Model",o="",n=[];for(let t=0;t<e.length;t++){if(e.at(0).get("type")!==e.at(t).get("type"))return void i.showwarning(h.CfgSession_MixSelection_Error,"error")}if("Model"!==e.at(0).get("type"))if(t=e.at(0).get("type"),0==this.collection.length){"SessionEffectivity"==this.options.mode?this.options.emptyContextText=m.emptyContextText_xRevision_SessionEffectivity:"Applicability"==this.options.mode&&(this.options.emptyContextText=m.emptyContextText_xRevision_Applicability),n.push({selectedDataType:e.at(0).get("type"),modelName:e.at(0).get("name"),referenceRevision:" "});let i={selectedReferenceId:e.at(0).get("ID"),isPostProcessRequired:!1,referenceRevision:" ",selectedDataType:t,modelName:e.at(0).get("name")};await this.addXRevisionInfo(i);let o=[i.selectedReferenceId];this.cfgAutocompleteObj.searchString="",this.cfgAutocompleteObj.setQuery([{type:"",condition:'(revisionmode:"EffectivityBased")',excludedArray:o}]),this.cfgAutocompleteObj.updateAutoCompleteModel(),console.log("Xrevision addded")}else{let e=!1;for(let t=0;t<this.collection.length;t++)if("Model"==this.collection.at(t).get("selectedDataType")){e=!0;break}if(0==e)return void("SessionEffectivity"==this.options.mode?i.showwarning(h.CFG_Work_Under_Evolution_Only_SingleRevisionGraph_Suported_Error,"error"):"Applicability"==this.options.mode&&i.showwarning(h.CFG_Work_Under_Change_Only_SingleRevisionGraph_Suported_Error,"error"))}else if(e&&e._models)for(const n of e._models){if(n.marketingName=n._attributes.label,n.name=n.get("name"),n.owner=n.get("owner"),n.state=n.get("dispvalue"),n.state){const e=[n.state],t=await i.readNLSvaluesOfAttributes(e);t["ds6w:status"]&&t["ds6w:status"][e]&&(n.state=t["ds6w:status"][e])}if(n.selectedDataType=n.get("type"),o=n.get("ID"),n.id=n.get("ID"),n.modelId=n.get("ID"),n.icon=n.get("icon"),t=n.get("type"),"SessionEffectivity"==this.options.mode?this.options.emptyContextText=h.emptyContextText_SessionEffectivity:"Applicability"==this.options.mode&&(this.options.emptyContextText=h.emptyContextText_Applicability),0==this.collection.length)this.addModel(n);else if(this.collection.length>0){let e=!1;for(let t=0;t<this.collection.length;t++)if("Model"!=this.collection.at(t).get("selectedDataType")){e=!0;break}0==e&&this.addModel(n)}}"Applicability"==this.options.mode&&(this.options.objectSelectionType="ApplicabilityModel","Model"!=t?(this.options.objectSelectionType="ApplicabilityxRevision",this.getCAApplicability(n)):this.getCAApplicability()),"SessionEffectivity"==this.options.mode&&(this.options.objectSelectionType="SessionModel","Model"!=t&&(this.options.objectSelectionType="SessionxRevision"));let s="",a="",l=this.collection.getselectedModelsIDs();"Model"!==t?(s="",a='(revisionmode:"EffectivityBased")'):(s=this.collection.at(0).get("selectedDataType"),a="",this.collection.length>=1&&(this.cfgAutocompleteObj.searchString="",this.cfgAutocompleteObj.setQuery([{type:s,condition:a,excludedArray:l}]),this.cfgAutocompleteObj.updateAutoCompleteModel()))},prefillWithAttachesContext:async function(t){if(t&&t.referencesInfo&&t.referencesInfo[0]&&"YES"===t.referencesInfo[0].hasXRevisionGraph){let e={selectedReferenceId:t.referencesInfo[0].pid||"",isPostProcessRequired:!1,referenceRevision:t.contextInfo&&t.contextInfo[0]&&t.contextInfo[0].evolutionRevision||" ",selectedDataType:"VPMReference",modelName:t.xRevisionContent&&t.xRevisionContent[0]&&t.xRevisionContent[0].xRevisionGraph&&t.xRevisionContent[0].xRevisionGraph.name||""};"SessionEffectivity"==this.options.mode&&(this.options.objectSelectionType="SessionModel",this.options.emptyContextText=m.emptyContextText_xRevision_SessionEffectivity,"Model"!=e.selectedDataType&&(this.options.objectSelectionType="SessionxRevision"));let o=[],n=await i.getAllowedSemantics(e.selectedReferenceId);n&&n.allowedSemantics&&n.allowedSemantics[0]&&n.allowedSemantics[0].graphProprietary&&n.allowedSemantics[0].graphProprietary.id&&(o.push(n.allowedSemantics[0].graphProprietary.id),await i.getObjectInfo(n.allowedSemantics[0].graphProprietary.id).then((t=>{e.modelName=t.data[0].dataelements.name}))),this.addXRevisionInfo(e),this.cfgAutocompleteObj.searchString="",this.cfgAutocompleteObj.setQuery([{type:"",condition:'(revisionmode:"EffectivityBased")',excludedArray:o}]),this.cfgAutocompleteObj.updateAutoCompleteModel()}if(!t||!t.contextInfo||0===t.contextInfo.length)return;t.contextInfo.forEach((t=>{t.content&&t.content.results&&t.content.results.forEach((t=>{let i=this.getAttrValue(t,"type");if("Model"===i){let o=new e,n=t.physicalID||"";o.set("ID",n),o.set("modelId",n),o.set("id",n),o.modelId=n,o.id=n;let s=t.computed&&t.computed.label&&t.computed.label.value&&t.computed.label.value[0]||"";o.set("marketingName",s),o.marketingName=s;let a=enoviaServerFilterWidget.baseURL,l=t.type_icon_url?a+t.type_icon_url:a+"/snresources/images/icons/small/default_icon.png";o.set("icon",l),o.icon=l;let r=this.getAttrValue(t,"current");o.set("state",r),o.state=r;let d=this.getAttrValue(t,"owner");o.set("owner",d),o.owner=d,o.set("selectedDataType",i),o.selectedDataType=i;let c=this.getAttrValue(t,"name");o.set("name",c),o.name=c,this.addModel(o)}}))}));let o=this.collection.getselectedModelsIDs(),n="",s=this.collection.length>0?this.collection.at(0).get("selectedDataType"):"";""!==s&&("Model"!==s&&(s="",n='(revisionmode:"EffectivityBased")'),this.cfgAutocompleteObj.searchString="",this.cfgAutocompleteObj.setQuery([{type:s,condition:n,excludedArray:o}]),this.cfgAutocompleteObj.updateAutoCompleteModel())},fillWithAttachedContextNative:function(e){let t=this;if(1==e.isxRevisionEffectivity){let i=e.xRevisionContent.referencePID,o={modelName:e.xRevisionContent.name,selectedDataType:e.xRevisionContent.type,selectedReferenceId:i,isPostProcessRequired:!0};"TRUE"==e.isAutoProposed&&("SessionEffectivity"==e.mode?t.options.emptyContextText=m.emptyContextText_xRevision_SessionEffectivity:"Applicability"==e.mode&&(t.options.emptyContextText=m.emptyContextText_xRevision_Applicability)),t.addXRevisionInfo(o)}else{let i=e.modelIds;if("TRUE"==e.isAutoProposed&&i){let e=[];o.retrieveModeldetails(i).then((i=>{i.length>0&&i.forEach((function(t){let i="";t.basicData.forEach((function(e){"ds6w:identifier"==e.name&&(i=e.value)}));const o={displayexpression:"",expression:{name:i,label:"",xmlExpression:"",impXml:"",iUnitXml:"",iDateXml:"",milestoneXml:"",modelId:"",psJson:[],mpJson:[],iUnitJson:[],iDateJson:{DateRanges:[]},milestoneJson:[],productstatecheckbox:!0,manufacturingplanstatecheckbox:!0,unitcheckbox:!0,datestatecheckbox:!0,milestoneCheckbox:!0,psXmlDesc:[],mpXmlDesc:[],displayexpression:""}};e.push(o)})),t.options.expressionJson=e,t.populateModels(t)}))}}},getAttrValue:function(e,t){if(!e.basicData)return"";let i=e.basicData.find((e=>e.name===t));return i&&i.value?i.value[0]:""}};return D})),define("DS/CfgEvolutionUX/CfgDateView",["UWA/Core","UWA/Class/View","UWA/Class/Model","DS/Handlebars/Handlebars","DS/CfgEvolutionUX/CfgDateModel","text!DS/CfgEvolutionUX/CfgDateTemplate.html","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX","DS/Controls/DatePicker","DS/CfgBaseUX/scripts/CfgUtility","UWA/Date","css!DS/CfgEvolutionUX/CfgEvolutionUX.css"],(function(e,t,i,o,n,s,a,l,r,d){"use strict";var c=o.compile(s),p=t.extend({className:"CfgDateView",model:null,tagName:"div",name:"CfgDateView",setup:function(){},hideORShowDeleteForfirstDate:function(){1==this.model.get("isThisOnlyModelInCollection")?this._dateDiv.getElement(".cfgDeleteDateDiv").hide():this._dateDiv.getElement(".cfgDeleteDateDiv").show()},updateMinValOfFromDP:function(){""==this.model.get("fromDateMinValue")?this._fromDatePicker.minValue=void 0:this._fromDatePicker.minValue=new Date(r.convertMillisectoDate(this.model.get("fromDateMinValue")))},updateMinValOfToDP:function(){""==this.model.get("toDateMinValue")?this._toDatePicker.minValue=void 0:this._toDatePicker.minValue=new Date(r.convertMillisectoDate(this.model.get("toDateMinValue")))},updatetoDate:function(){this._toDatePicker.value=r.convertMillisectoDate(this.model.get("toDateMilliSec"))},init:function(e){this.model=e.model,this.isReadOnly=e.isReadOnly,this.listenTo(this.model,"onChange:toDateMilliSec",this.updatetoDate),this.listenTo(this.model,"onChange:isThisOnlyModelInCollection",this.hideORShowDeleteForfirstDate),this.listenTo(this.model,"onChange:fromDateMinValue",this.updateMinValOfFromDP),this.listenTo(this.model,"onChange:toDateMinValue",this.updateMinValOfToDP)},render:function(){if(!0===this.isReadOnly)var e=this.addDateReadOnly();else{e=this.addDate();this.applyCompactComfortableMode()}return e},applyCompactComfortableMode:function(){null==this.displayCompactMode||!1===this.displayCompactMode?(this._dateDiv.getElement(".cfgFromLabelDiv").setAttributeNode(document.createAttribute("touch-mode")),this._dateDiv.getElement(".cfgToLabelDiv").setAttributeNode(document.createAttribute("touch-mode")),this._dateDiv.getElement(".cfgSwitchDateDiv").setAttributeNode(document.createAttribute("touch-mode")),this._dateDiv.getElement(".cfgWUXDate").setAttributeNode(document.createAttribute("touch-mode"))):(this._dateDiv.getElement(".cfgFromLabelDiv").removeAttribute("touch-mode"),this._dateDiv.getElement(".cfgToLabelDiv").removeAttribute("touch-mode"),this._dateDiv.getElement(".cfgSwitchDateDiv").removeAttribute("touch-mode"),this._dateDiv.getElement(".cfgWUXDate").removeAttribute("touch-mode"))},convertMillisectoDateReadMode:function(e){var t=parseInt(e);if(isNaN(t))return null;var i=new Date(t);return d.strftime(i,"%b %d %Y")},addDateReadOnly:function(){this._dateDiv=new e.createElement("div",{id:this.model.id,class:"dateDiv"}),this._dateDiv.setHTML(c()),this.dateViewToolTip="";var t=this._dateDiv.getElement(".cfgFromLabelDiv");t.setHTML(a.Filter_Date_From),t.setStyle("display","none");var i=this._dateDiv.getElement(".cfgFromDateDiv");i.addClassName("cfgFromDateDivReadOnly"),i.removeClassName("cfgFromDateDiv"),e.is(this.model.get("fromDateMilliSec"))&&""!=this.model.get("fromDateMilliSec")?i.innerHTML=this.convertMillisectoDateReadMode(this.model.get("fromDateMilliSec")):"-INF"==this.model.get("fromDate")&&(i.innerHTML=a.CfgDateMinusInf);var o=this._dateDiv.getElement(".cfgToLabelDiv");o.setHTML(a.Filter_Date_To),o.addClassName("cfgToLabelDivReadOnly");var n=this._dateDiv.getElement(".cfgToDateDiv");return n.addClassName("cfgToDateDivReadOnly"),n.removeClassName("cfgToDateDiv"),e.is(this.model.get("toDateMilliSec"))&&""!=this.model.get("toDateMilliSec")?n.innerHTML=this.convertMillisectoDateReadMode(this.model.get("toDateMilliSec")):"INF"==this.model.get("toDate")&&(n.innerHTML=a.CfgDateInf),this._dateDiv.getElement(".fromGroup").addClassName("fromGroupReadOnly"),"single"==this.model.get("type")?(this._dateDiv.getElement(".toGroup").addClassName("cfgDateDisplayNone"),this._dateDiv.getElement(".cfgFromLabelDiv").addClassName("cfgDateDisplayNone"),this.dateViewToolTip=this.dateViewToolTip.concat(i.innerHTML),this.dateViewToolTip=this.dateViewToolTip.concat("\n")):"range"==this.model.get("type")&&(this._dateDiv.getElement(".cfgFromLabelDiv").removeClassName("cfgDateDisplayNone"),this._dateDiv.getElement(".toGroup").removeClassName("cfgDateDisplayNone"),this.dateViewToolTip=this.dateViewToolTip.concat(i.innerHTML),this.dateViewToolTip=this.dateViewToolTip.concat(" "),this.dateViewToolTip=this.dateViewToolTip.concat(o.innerHTML),this.dateViewToolTip=this.dateViewToolTip.concat(" "),this.dateViewToolTip=this.dateViewToolTip.concat(n.innerHTML),this.dateViewToolTip=this.dateViewToolTip.concat("\n")),null==this.displayCompactMode||!1===this.displayCompactMode?(this._dateDiv.getElement(".cfgToLabelDiv").setAttributeNode(document.createAttribute("touch-mode")),this._dateDiv.getElement(".cfgFromDateDivReadOnly").setAttributeNode(document.createAttribute("touch-mode")),this._dateDiv.getElement(".cfgToDateDivReadOnly").setAttributeNode(document.createAttribute("touch-mode")),this._dateDiv.getElement(".cfgWUXDate").setAttributeNode(document.createAttribute("touch-mode"))):(this._dateDiv.getElement(".cfgToLabelDiv").removeAttribute("touch-mode"),this._dateDiv.getElement(".cfgFromDateDivReadOnly").removeAttribute("touch-mode"),this._dateDiv.getElement(".cfgToDateDivReadOnly").removeAttribute("touch-mode"),this._dateDiv.getElement(".cfgWUXDate").removeAttribute("touch-mode")),this._dateDiv},addDate:function(){var t=this;this._fromDatePickerChangeEventActive=!1,this._dateDiv=new e.createElement("div",{id:this.model.id,class:"dateDiv"}),this._dateDiv.setHTML(c()),this._dateDiv.getElement(".cfgFromLabelDiv").setHTML(a.Filter_Date_From);var i=this._dateDiv.getElement(".cfgFromDateDiv");this._fromDatePicker=new l({value:void 0,minValue:void 0,maxValue:void 0,allowUndefinedFlag:!0}).inject(i),e.is(this.model.get("fromDateMilliSec"))&&""!=this.model.get("fromDateMilliSec")?this._fromDatePicker.value=r.convertMillisectoDate(this.model.get("fromDateMilliSec")):"-INF"==this.model.get("fromDate")&&(this._fromDatePicker.elements.inputField.placeholder=a.CfgDateMinusInf),""!=this.model.get("fromDateMinValue")&&(this._fromDatePicker.minValue=new Date(r.convertMillisectoDate(this.model.get("fromDateMinValue")))),this._fromDatePicker.addEventListener("change",(function(e){null==t._fromDatePicker.value?(t.model.set("fromDateMilliSec",""),t.model.set("fromDate","-INF"),t.model.set("toDateMinValue",t.model.get("fromDateMilliSec")),"INF"==t.model.get("toDate")&&"range"==t.model.get("type")&&(this.getElement(".wux-ui-state-undefined").addClassName("cfgWUXDateInvalid"),t._dateDiv.getElement(".cfgDeleteDateDiv").addClassName("cfgWUXDateCrossInvalid")),t.dispatchEvent("onChangeDate",arguments),t.validate(e)):(t.model.set("fromDateMilliSec",e.dsModel.value.getTime()),t.model.set("fromDate",e.dsModel.value.toDateString()),t.model.set("toDateMinValue",t.model.get("fromDateMilliSec")),t.dispatchEvent("onChangeDate",arguments),t.validate(e))})),this._fromDatePicker.addEventListener("blur",(function(e){null==t._fromDatePicker.value&&(t.model.set("fromDateMilliSec",""),t.model.set("fromDate","-INF"),"INF"==t.model.get("toDate")&&"range"==t.model.get("type")&&(this.getElement(".wux-ui-state-undefined").addClassName("cfgWUXDateInvalid"),t._dateDiv.getElement(".cfgDeleteDateDiv").addClassName("cfgWUXDateCrossInvalid")),t.validate(e))})),this._dateDiv.getElement(".cfgToLabelDiv").setHTML(a.Filter_Date_To);var o=this._dateDiv.getElement(".cfgToDateDiv");this._toDatePicker=new l({value:void 0,minValue:this._fromDatePicker.value?this._fromDatePicker.value:this._fromDatePicker.minValue,maxValue:void 0,allowUndefinedFlag:!0}).inject(o),e.is(this.model.get("toDateMilliSec"))&&""!=this.model.get("toDateMilliSec")?this._toDatePicker.value=r.convertMillisectoDate(this.model.get("toDateMilliSec")):"INF"==this.model.get("toDate")&&(this._toDatePicker.elements.inputField.placeholder=a.CfgDateInf),this._toDatePicker.addEventListener("change",(function(e){null==t._toDatePicker.value?(t.model.set("toDateMilliSec",""),t.model.set("toDate","INF"),"-INF"==t.model.get("fromDate")&&"range"==t.model.get("type")&&(this.getElement(".wux-ui-state-undefined").addClassName("cfgWUXDateInvalid"),t._dateDiv.getElement(".cfgDeleteDateDiv").addClassName("cfgWUXDateCrossInvalid")),t.dispatchEvent("onChangeDate",arguments),t.validate(e)):(t.model.set("toDateMilliSec",e.dsModel.value.getTime()),t.model.set("toDate",e.dsModel.value.toDateString()),t.dispatchEvent("onChangeDate",arguments),t.validate(e))})),this._toDatePicker.addEventListener("blur",(function(e){null==t._toDatePicker.value&&(t.model.set("toDateMilliSec",""),t.model.set("toDate","INF"),"-INF"==t.model.get("fromDate")&&"range"==t.model.get("type")&&(this.getElement(".wux-ui-state-undefined").addClassName("cfgWUXDateInvalid"),t._dateDiv.getElement(".cfgDeleteDateDiv").addClassName("cfgWUXDateCrossInvalid")),t.validate(e))}));var n=this._dateDiv.getElement(".cfgSwitchDateDiv");e.createElement("Label",{html:"single"==this.model.get("type")?a.Filter_Date_DateRange:a.Filter_Date_SingleDate,class:"cfgDateSingleOrRange"}).inject(n);n.addEventListener("click",(function(e){"range"==t.model.get("type")?(t.model.set("type","single"),t.singleOrRangeDisplay()):"single"==t.model.get("type")&&(t.model.set("toDateMilliSec",t.model.get("fromDateMilliSec")),t.model.set("type","range"),t.singleOrRangeDisplay()),t.dispatchEvent("onChangeDate",arguments),t.validate()})),n.addEventListener("mouseover",t.onHyperLink);var s=this._dateDiv.getElement(".cfgDeleteDateDiv");return s.addClassName("wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-clear "),1==this.model.get("isThisOnlyModelInCollection")&&s.hide(),s.addEventListener("click",(function(e){this.parentElement.parentElement.remove(),t.dispatchEvent("onDeleteDate",arguments),t.dispatchEvent("onChangeDate",arguments)})),this.singleOrRangeDisplay(),this._dateDiv},singleOrRangeDisplay:function(){var e=this._dateDiv.getElement(".cfgWUXDate");"single"==this.model.get("type")?(e.getElement(".toGroup").addClassName("cfgDateDisplayNone"),e.getElement(".cfgFromLabelDiv").addClassName("cfgDateDisplayNone"),e.getElement(".cfgSwitchDateDiv").innerText=a.Filter_Date_DateRange):"range"==this.model.get("type")&&(e.getElement(".cfgFromLabelDiv").removeClassName("cfgDateDisplayNone"),e.getElement(".toGroup").removeClassName("cfgDateDisplayNone"),e.getElement(".cfgSwitchDateDiv").innerText=a.Filter_Date_SingleDate)},onHyperLink:function(){this.style.cursor="pointer"},validate:function(e){var t=this.model.get("fromDate"),i=this.model.get("toDate");"single"==this.model.get("type")?(this._fromDatePicker.getContent().getElement(".wux-ui-state-undefined").removeClassName("cfgWUXDateInvalid"),this._toDatePicker.getContent().getElement(".wux-ui-state-undefined").removeClassName("cfgWUXDateInvalid"),this._dateDiv.getElement(".cfgDeleteDateDiv").removeClassName("cfgWUXDateCrossInvalid"),"-INF"==t&&this.model.set("fromDate",""),this._fromDatePicker.elements.inputField.placeholder=""):("-INF"==t&&(this._fromDatePicker.elements.inputField.placeholder=a.CfgDateMinusInf),"INF"==i&&(this._toDatePicker.elements.inputField.placeholder=a.CfgDateInf),"-INF"==t&&"INF"==i?(this._fromDatePicker.getContent().getElement(".wux-ui-state-undefined").addClassName("cfgWUXDateInvalid"),this._toDatePicker.getContent().getElement(".wux-ui-state-undefined").addClassName("cfgWUXDateInvalid"),this._dateDiv.getElement(".cfgDeleteDateDiv").addClassName("cfgWUXDateCrossInvalid")):(this._fromDatePicker.getContent().getElement(".wux-ui-state-undefined").removeClassName("cfgWUXDateInvalid"),this._toDatePicker.getContent().getElement(".wux-ui-state-undefined").removeClassName("cfgWUXDateInvalid"),this._dateDiv.getElement(".cfgDeleteDateDiv").removeClassName("cfgWUXDateCrossInvalid")))},adjustResponsiveViewDate:function(e){null==this._dateDiv.getElement(".cfgWUXDate")||e<=0||(!0===this.isReadOnly?e<210&&e>130?(this._dateDiv.getElement(".cfgWUXDate").removeClassName("flexColumn"),this._dateDiv.getElement(".fromToGroup").addClassName("flexColumn"),this._dateDiv.getElement(".toGroup").addClassName("toGroupSmallDisplay")):e>=210?(this._dateDiv.getElement(".cfgWUXDate").removeClassName("flexColumn"),this._dateDiv.getElement(".fromToGroup").removeClassName("flexColumn"),this._dateDiv.getElement(".toGroup").removeClassName("toGroupSmallDisplay")):e<=130&&(this._dateDiv.getElement(".cfgWUXDate").addClassName("flexColumn"),this._dateDiv.getElement(".fromToGroup").addClassName("flexColumn"),this._dateDiv.getElement(".toGroup").addClassName("toGroupSmallDisplay")):e<=520&&e>282?(this._dateDiv.getElement(".cfgWUXDate").removeClassName("flexColumn"),this._dateDiv.getElement(".fromToGroup").addClassName("flexColumn"),this._dateDiv.getElement(".toGroup").addClassName("toGroupSmallDisplay"),this._dateDiv.getElement(".cfgToLabelDiv").addClassName("cfgToLabelDivSmallDisplay")):e>520?(this._dateDiv.getElement(".cfgWUXDate").removeClassName("flexColumn"),this._dateDiv.getElement(".fromToGroup").removeClassName("flexColumn"),this._dateDiv.getElement(".toGroup").removeClassName("toGroupSmallDisplay"),this._dateDiv.getElement(".cfgToLabelDiv").removeClassName("cfgToLabelDivSmallDisplay")):e<=282&&(this._dateDiv.getElement(".cfgWUXDate").addClassName("flexColumn"),this._dateDiv.getElement(".fromToGroup").addClassName("flexColumn"),this._dateDiv.getElement(".toGroup").addClassName("toGroupSmallDisplay"),this._dateDiv.getElement(".cfgToLabelDiv").addClassName("cfgToLabelDivSmallDisplay")))}});return p})),define("DS/CfgEvolutionUX/CfgWUXDatePicker",["UWA/Class/View","UWA/Class/Model","UWA/Class/Collection","DS/Controls/TooltipModel","DS/CfgEvolutionUX/CfgDateView","DS/CfgEvolutionUX/CfgDateModel","DS/CfgBaseUX/scripts/CfgXMLServices","DS/CfgBaseUX/scripts/CfgUtility","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX","css!DS/CfgEvolutionUX/CfgEvolutionUX.css"],(function(e,t,i,o,n,s,a,l,r){"use strict";return e.extend({className:"CfgWUXDatePicker",collection:null,viewCollection:[],singleDateClickCount:0,rangeDateClickCount:0,init:function(e,t,o,n){this.singleDateClickCount=0,this.rangeDateClickCount=0,this.options=o;var a=this,l=[];if(UWA.is(t)&&(l=t.DateRanges),this.count=0,this.disableAddDate=!1,this.dateToolTip="",this.collection=new i,this.collection.addEvent("onRemove",(function(e,t,i){1==this.length&&this.last().set("isThisOnlyModelInCollection",!0)})),this.collection.addEvent("onAdd",(function(e,t,i){1==this.length?this.first().set("isThisOnlyModelInCollection",!0):this.length>1&&this.first().set("isThisOnlyModelInCollection",!1)})),this.evolutionDlgDateDiv=e,this.cfgDateDiv=UWA.createElement("div",{id:"cfgDateDiv"}),this.datesParentDiv=UWA.createElement("div",{id:"datesParentDiv"}),this.datesParentDiv.inject(this.cfgDateDiv),null==this.evolutionDlgDateDiv)return null;if(this.cfgDateDiv.inject(this.evolutionDlgDateDiv),this.viewCollection=[],this.cfgDateDiv.addEvent&&this.cfgDateDiv.addEvent("resize",(function(){a.viewCollection.forEach((function(e,t){e.adjustResponsiveViewDate(a.cfgDateDiv.getDimensions().width)}))})),0==l.length){this.count++;let e="range";"SingleDate"==o.defaultDateBehavior&&(e="single");var d=new s({id:this.count,type:e,fromDate:"",fromDateMilliSec:"",fromDateMinValue:"",toDate:r.CfgDateInf,toDateMilliSec:"",toDateMinValue:"",isThisOnlyModelInCollection:!0});this.collection.add(d)}else{for(var c=0;c<l.length;c++)"null"==l[c].Start&&(l[c].Start=""),"null"==l[c].End&&(l[c].End=""),"null"==l[c].millisecStart&&(l[c].millisecStart=""),"null"==l[c].millisecEnd&&(l[c].millisecEnd="");for(c=0;c<l.length;c++){this.count++;d=null;var p="";l[c].Start==l[c].End?(0!=c&&(p=l[c-1].millisecStart),d=new s({id:this.count,type:"single",fromDate:l[c].Start,fromDateMilliSec:l[c].millisecStart,fromDateMinValue:p,toDate:r.CfgDateInf,toDateMilliSec:"",toDateMinValue:l[c].millisecStart,isThisOnlyModelInCollection:!1})):(0!=c&&(p=l[c-1].millisecEnd),d=new s({id:this.count,type:"range",fromDate:l[c].Start,fromDateMilliSec:l[c].millisecStart,fromDateMinValue:p,toDate:l[c].End,toDateMilliSec:l[c].millisecEnd,toDateMinValue:l[c].millisecStart,isThisOnlyModelInCollection:!1})),this.collection.add(d)}}return this},isToDisableAddDate:function(){this.disableAddDate=!1;for(var e=0;e<this.collection.length;e++){var t=this.collection.at(e);if("single"==t.get("type")&&e==this.collection.length-1&&""==t.get("fromDateMilliSec")||"range"==t.get("type")&&"INF"==t.get("toDate"))return this.addRangeLabel.addClassName("cfgLabelAddDateDisabled"),void(this.disableAddDate=!0)}this.disableAddDate||this.addRangeLabel.removeClassName("cfgLabelAddDateDisabled")},createExistingDate:function(){var e=this;e.count++,this.collection.forEach((function(t,i){e.renderCfgDateView(t)}))},render:function(){var e=this;this.createExistingDate(),this.datesParentDiv.tooltipInfos=new o({shortHelp:this.dateToolTip}),this.addRangeLabel=UWA.createElement("div",{class:"cfgLabelAddDate",html:r.Filter_Date_AddDateRange}),this.isToDisableAddDate(),this.addRangeLabel.inject(this.cfgDateDiv),!0===this.options.isReadOnly&&this.addRangeLabel.hide(),this.addRangeLabel.addEventListener("mouseover",(function(){e.disableAddDate?this.style.cursor="":this.style.cursor="pointer"})),this.addRangeLabel.addEventListener("click",(function(){if(!e.disableAddDate){e.count++;var t="",i="",o="";e.collection.length>0&&("range"==e.collection.last().get("type")&&""!=e.collection.last().get("toDateMilliSec")?(o=t=e.collection.last().get("toDateMilliSec"),t+=864e5,i=l.convertMillisectoDate(t)):"single"==e.collection.last().get("type")&&(o=e.collection.last().get("fromDateMilliSec")));var n=new s({id:e.count,type:e.collection.last().get("type"),fromDate:i,fromDateMilliSec:t,fromDateMinValue:o,toDate:r.CfgDateInf,toDateMilliSec:"",toDateMinValue:t,isThisOnlyModelInCollection:!1});e.collection.add(n),e.renderCfgDateView(n),e.isToDisableAddDate()}})),null==this.options.displayCompactMode||!1===this.options.displayCompactMode?this.addRangeLabel.setAttributeNode(document.createAttribute("touch-mode")):this.addRangeLabel.removeAttribute("touch-mode")},show:function(){this.cfgDateDiv.show()},hide:function(){this.cfgDateDiv.hide()},renderCfgDateView:function(e){var t=this,i=new n({model:e,id:this.count,isReadOnly:this.options.isReadOnly,displayCompactMode:this.options.displayCompactMode}),o=i.render();return i.adjustResponsiveViewDate(this.cfgDateDiv.getDimensions().width),o.inject(this.datesParentDiv),this.viewCollection.push(i),!0===this.options.isReadOnly&&(this.dateToolTip=this.dateToolTip.concat(i.dateViewToolTip)),i.listenTo(i,"onChangeDate",(function(e){t.isToDisableAddDate(),"change"==e.type&&("single"==this.model.get("type")&&t.singleDateClickCount++,"range"==this.model.get("type")&&t.rangeDateClickCount++);var i=t.collection.indexOf(this.model);-1!=i&&i!=t.collection.length-1&&("single"==this.model.get("type")?t.collection.at(i+1).set("fromDateMinValue",t.collection.at(i).get("fromDateMilliSec")):t.collection.at(i+1).set("fromDateMinValue",t.collection.at(i).get("toDateMilliSec")))})),i.listenTo(i,"onDeleteDate",(function(e){var i=t.collection.indexOf(this.model);-1!=i&&i!=t.collection.length-1&&(0==i?t.collection.at(i+1).set("fromDateMinValue",""):"single"==t.collection.at(i-1).get("type")?t.collection.at(i+1).set("fromDateMinValue",t.collection.at(i-1).get("fromDateMilliSec")):t.collection.at(i+1).set("fromDateMinValue",t.collection.at(i-1).get("toDateMilliSec"))),this.model.destroy()})),i},validateCollection:function(){for(var e=0;e<this.collection.length;e++){var t=this.collection.at(e);if("single"!=t.get("type")&&("range"==t.get("type")&&"-INF"==t.get("fromDate")&&"INF"==t.get("toDate")))return!1}return!0},getXML:function(){var e="",t="",i="";return this.validateCollection()?(this.collection.forEach((function(o,n){if(!o.isEmpty()){if("single"==o.get("type")){var s=l.convertMillisectoDateOnly(o.get("fromDateMilliSec"));e+=a.buildSingleDateValue(s)}else{var r="";if(""==o.get("fromDateMilliSec")||"-INF"==o.get("fromDate"))r="-INF";else{s=l.convertMillisectoDateOnly(o.get("fromDateMilliSec"));r=a.buildFromDate(s)}var d="";if(""==o.get("toDateMilliSec")||"INF"==o.get("toDate"))d="INF";else{s=l.convertMillisectoDateOnly(o.get("toDateMilliSec"));d=a.buildToDate(s)}i="-INF"==r?d:"INF"==d?r:r+d,e+=a.buildInterval(i)}t=a.buildDate(e)}})),t):null},getJSON:function(){if(!this.validateCollection())return null;var e={DateRanges:[]};this.collection.forEach((function(t,i){if(t.isEmpty())return null;var o={};"single"==t.get("type")?(o.Start=t.get("fromDate"),o.millisecStart=t.get("fromDateMilliSec"),o.End=t.get("fromDate"),o.millisecEnd=t.get("fromDateMilliSec")):(""==t.get("fromDateMilliSec")?(o.Start="-INF",o.millisecStart=""):(o.Start=t.get("fromDate"),o.millisecStart=t.get("fromDateMilliSec")),""==t.get("toDateMilliSec")?(o.End="INF",o.millisecEnd=""):(o.End=t.get("toDate"),o.millisecEnd=t.get("toDateMilliSec"))),e.DateRanges.push(o)}));var t=JSON.stringify(e.DateRanges);return"[]"==t||"{}"==t?null:e}})})),define("DS/CfgEvolutionUX/CfgEvolutionCriteriaBaseView",["UWA/Class/View","DS/Handlebars/Handlebars4","DS/Controls/Toggle","DS/CfgEvolutionUX/CfgProductState","DS/CfgEvolutionUX/CfgUnit","DS/CfgEvolutionUX/CfgWUXDatePicker","text!DS/CfgEvolutionUX/CfgEvolutionCriteriaTemplate.html","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX","css!DS/CfgEvolutionUX/CfgEvolutionUX.css"],(function(e,t,i,o,n,s,a,l){"use strict";return e.extend({tagName:"div",className:"evolution-criteria-base-view",init:function(e){this._parent(e),this.panelTemplate=t.compile(a)},setup:function(){this.criteriaViewMode=this.options.mode,this.modelLabel=this.options.modelLabel,this.modelName=this.options.modelName,this.modelID=this.options.modelID,this.displayCompactMode=null==this.options.displayCompactMode||null==this.options.displayCompactMode||0!=this.options.displayCompactMode,"Official"==this.options.evolutionView&&this.options.criteria?this.configureCriteria(this.options.criteria):"Projected"==this.options.evolutionView&&this.options.projectedCriteria&&this.configureCriteria(this.options.projectedCriteria)},configureCriteria:function(e){var t=this;e.forEach((function(e){"MV"==e.name.toUpperCase()?t.mv_criteria={isCheckboxRequired:!(!e.isCheckboxRequired||1!=e.isCheckboxRequired),isReadOnly:!(!e.isReadOnly||1!=e.isReadOnly),expression:e.value?e.value:"",expressionJson:e.valueJson&&0!==Object.keys(e.valueJson).length?e.valueJson:null,displayExpression:e.displayExpression?e.displayExpression:"",xmlDesc:e.xmlDesc?e.xmlDesc:"",cb:null,component:null}:"MP"==e.name.toUpperCase()?t.mp_criteria={isCheckboxRequired:!(!e.isCheckboxRequired||1!=e.isCheckboxRequired),isReadOnly:!(!e.isReadOnly||1!=e.isReadOnly),expression:e.value?e.value:"",expressionJson:e.valueJson&&0!==Object.keys(e.valueJson).length?e.valueJson:null,xmlDesc:e.xmlDesc?e.xmlDesc:"",cb:null,component:null}:"UNIT"==e.name.toUpperCase()?t.unit_criteria={isCheckboxRequired:!(!e.isCheckboxRequired||1!=e.isCheckboxRequired),isReadOnly:!(!e.isReadOnly||1!=e.isReadOnly),expression:e.value?e.value:"",expressionJson:e.valueJson&&0!==Object.keys(e.valueJson).length?e.valueJson:null,cb:null,component:null}:"DATE"==e.name.toUpperCase()&&(t.date_criteria={isCheckboxRequired:!(!e.isCheckboxRequired||1!=e.isCheckboxRequired),isReadOnly:!(!e.isReadOnly||1!=e.isReadOnly),expression:e.value?e.value:"",expressionJson:e.valueJson&&0!==Object.keys(e.valueJson).length?e.valueJson:null,cb:null,component:null})}))},clickCriteriaComponent:function(e){"MV"==e?this.mv_criteria.component.onCriteriaClickHandler():"MP"==e&&this.mp_criteria.component.onCriteriaClickHandler()},render:function(){var e=this;if(this.container.setHTML(this.panelTemplate({mv_criteria:e.mv_criteria,mp_criteria:e.mp_criteria,unit_criteria:e.unit_criteria,date_criteria:e.date_criteria})),this.mv_criteria){var t={};t.parentElement=this.container.getElement(".mv-component"),t.parentGraphElement=this.container.getElement(".mv-graph-component"),t.psJson=this.mv_criteria.expressionJson,t.expression={name:e.modelName,modelId:e.modelID,xmlExpression:e.mv_criteria.expression,displayexpression:e.mv_criteria.displayExpression,psXmlDesc:e.mv_criteria.xmlDesc,psJson:e.mv_criteria.expressionJson},t.mode="PRODUCTS",t.displayCompactMode=e.displayCompactMode,t.use=e.criteriaViewMode,t.propagateSessionEffectivity=this.options.propagateSessionEffectivity,!0===this.mv_criteria.isCheckboxRequired?(this.mv_criteria.cb=new i({type:"checkbox",checkFlag:!0,value:"mv_cb",label:l.Product_State,touchMode:!e.displayCompactMode}).inject(this.container.getElement(".mv-checkbox-label")),this.mv_criteria.cb.addEventListener("change",(function(i){!0===e.mv_criteria.cb.checkFlag?(e.mv_criteria.component.show(),t.parentElement.setStyles({border:"1px solid lightgray"})):(e.mv_criteria.component.hide(),t.parentElement.setStyles({border:"none"}))}))):(this.container.getElement(".mv-checkbox-label").setHTML(l.Product_State),this.container.getElement(".mv-checkbox-label").addClassName("evo-crit-label")),this.mv_criteria.component=new o(t),this.mv_criteria.component.render(),this.mv_criteria.component.initialiseComponent()}if(this.mp_criteria){var a={};a.parentElement=this.container.getElement(".mp-component"),a.parentGraphElement=this.container.getElement(".mp-graph-component"),a.psJson=this.mp_criteria.expressionJson,a.expression={name:e.modelName,modelId:e.modelID,impXml:e.mp_criteria.expression,displayexpression:e.mp_criteria.displayExpression,mpXmlDesc:e.mp_criteria.xmlDesc,mpJson:e.mp_criteria.expressionJson},a.mode="MANUFACTURINGPLAN",a.displayCompactMode=e.displayCompactMode,a.use=e.criteriaViewMode,!0===this.mp_criteria.isCheckboxRequired?(this.mp_criteria.cb=new i({type:"checkbox",checkFlag:!0,value:"mp_cb",label:l.Manufacturing_Plan,touchMode:!e.displayCompactMode}).inject(this.container.getElement(".mp-checkbox-label")),this.mp_criteria.cb.addEventListener("change",(function(t){!0===e.mp_criteria.cb.checkFlag?(e.mp_criteria.component.show(),a.parentElement.setStyles({border:"1px solid lightgray"})):(e.mp_criteria.component.hide(),a.parentElement.setStyles({border:"none"}))}))):(this.container.getElement(".mp-checkbox-label").setHTML(l.Manufacturing_Plan),this.container.getElement(".mp-checkbox-label").addClassName("evo-crit-label")),this.mp_criteria.component=new o(a),this.mp_criteria.component.render(),this.mp_criteria.component.initialiseComponent()}if(this.unit_criteria){var r={};r.parentElement=this.container.getElement(".unit-component"),r.iUnitJson=this.unit_criteria.expressionJson,r.expression={name:e.modelName,modelId:e.modelID,impXml:e.unit_criteria.expression,displayexpression:e.unit_criteria.displayExpression,mpXmlDesc:e.unit_criteria.xmlDesc,iUnitJson:e.unit_criteria.expressionJson},r.mode="UNIT",r.displayCompactMode=e.displayCompactMode,r.use=e.criteriaViewMode,r.invokeFrom="",!0===this.unit_criteria.isCheckboxRequired?(this.unit_criteria.cb=new i({type:"checkbox",checkFlag:!0,value:"unit_cb",label:l.Unit,touchMode:!e.displayCompactMode}).inject(this.container.getElement(".unit-checkbox-label")),this.unit_criteria.cb.addEventListener("change",(function(t){!0===e.unit_criteria.cb.checkFlag?(e.unit_criteria.component.show(),r.parentElement.getElement("#textDiv").setStyles({border:"1px solid lightgray"})):(e.unit_criteria.component.hide(),r.parentElement.getElement("#textDiv").setStyles({border:"none"}))}))):(this.container.getElement(".unit-checkbox-label").setHTML(l.Unit),this.container.getElement(".unit-checkbox-label").addClassName("evo-crit-label")),this.unit_criteria.component=new n(r),this.unit_criteria.component.render(),this.unit_criteria.component.SetJson(r.iUnitJson),this.unit_criteria.component.initialiseComponent()}if(this.date_criteria){var d={};d.parentElement=this.container.getElement(".date-component"),d.dateJson=this.date_criteria.expressionJson,!0===this.date_criteria.isCheckboxRequired?(this.date_criteria.cb=new i({type:"checkbox",checkFlag:!0,value:"date_cb",label:l.Date,touchMode:!e.displayCompactMode}).inject(this.container.getElement(".date-checkbox-label")),this.date_criteria.cb.addEventListener("change",(function(t){!0===e.date_criteria.cb.checkFlag?e.date_criteria.component.show():e.date_criteria.component.hide()}))):(this.container.getElement(".date-checkbox-label").setHTML(l.Date),this.container.getElement(".date-checkbox-label").addClassName("evo-crit-label")),this.date_criteria.component=new s(d.parentElement,d.dateJson,{isReadOnly:e.date_criteria.isReadOnly,view:"show",defaultDateBehavior:"DateRange"}),this.date_criteria.component.render()}this.applyCompactComfortableMode(),this.container.inject(this.options.parentElement)},applyCompactComfortableMode:function(){0==this.displayCompactMode?(this.container.getElements(".evo-crit-in-filler").forEach((function(e){e.setAttributeNode(document.createAttribute("touch-mode"))})),this.container.getElements(".evo-crit-out-filler").forEach((function(e){e.setAttributeNode(document.createAttribute("touch-mode"))})),this.container.getElements(".evo-crit-label").forEach((function(e){e.setAttributeNode(document.createAttribute("touch-mode"))}))):(this.container.getElements(".evo-crit-in-filler").forEach((function(e){e.removeAttribute("touch-mode")})),this.container.getElements(".evo-crit-out-filler").forEach((function(e){e.removeAttribute("touch-mode")})),this.container.getElements(".evo-crit-label").forEach((function(e){e.removeAttribute("touch-mode")})))},get:function(){}})})),define("DS/CfgEvolutionUX/CfgEvolutionCriteriaView",["DS/UIKIT/Spinner","UWA/Drivers/Alone","DS/CfgBaseUX/scripts/CfgUtility","DS/Core/Core","UWA/Class/View","DS/UIKIT/Modal","DS/Controls/Toggle","DS/Handlebars/Handlebars4","text!DS/CfgEvolutionUX/CfgEvolutionCriteriasDialogTemplate.html","DS/CfgEvolutionUX/CfgProductState","DS/CfgEvolutionUX/CfgWUXDatePicker","DS/CfgEvolutionUX/CfgUnit","DS/CfgBaseUX/scripts/CfgData","DS/CfgBaseUX/scripts/CfgXMLServices","text!DS/CfgBaseUX/assets/CfgUXEnvVariables.json","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX","css!DS/CfgEvolutionUX/CfgEvolutionUX.css"],(function(e,t,i,o,n,s,a,l,r,d,c,p,u,m,h,g){"use strict";var f=l.compile(r);return n.extend({name:"evolution-criteria-dialog-view",tagName:"div",init:function(e){this._parent(e),e},setup:function(e){},render:function(){var t=this;u.renderTo=t.options.parentElement,this.container.setHTML(f(this.options));"EditEvolution"==t.options.mode&&g.Header_EditEvolution;var o=null,n=null,s=!0,l=!1,r=!1,m=!1;0!=Object.keys(t.options.expression).length&&(t.options.expression.modelId,o=t.options.expression.psJson,n=t.options.expression.mpJson,s=t.options.expression.productstatecheckbox,l=t.options.expression.unitcheckbox,r=t.options.expression.datestatecheckbox,m=t.options.expression.manufacturingplanstatecheckbox,t.options.expression.milestoneJson,t.options.expression.milestoneXml,t.options.expression.milestoneCheckbox);var h=t.options.criteriasAvailable,C={};C.parentElement=this.container.getElement(".evolution-dialog-productstates"),C.psJson=o,C.expression=t.options.expression,C.notExpression=t.options.expression.notPSDesc,C.mode="PRODUCTS",C.use="",C.propagateSessionEffectivity=t.options.propagateSessionEffectivity,C.displayCompactMode=t.options.displayCompactMode,this.productstateCheckbox=new a({type:"checkbox",value:"PSComponent",className:"primary",label:g.Product_State}).inject(this.container.getElement(".evolution-dialog-productstates-checkbox")),this.productstateCheckbox.addEventListener("click",(()=>{this.productstateCheckbox.checkFlag?this.ProductStateComponent.show():this.ProductStateComponent.hide()})),this.ProductStateComponent=new d(C),this.ProductStateComponent.render(),1==s?(this.productstateCheckbox.checkFlag=!0,this.ProductStateComponent.show()):this.ProductStateComponent.hide(),this.ProductStateComponent.initialiseComponent(),("False"==h.products||null!=t.options.enabledCritData&&"undefined"!=t.options.enabledCritData&&"false"==t.options.enabledCritData.productState)&&(this.productstateCheckbox.checkFlag=!1,this.productstateCheckbox.hide(),this.ProductStateComponent.hide());var v={};v.parentElement=this.container.getElement(".evolution-dialog-manufacturingplans"),v.psJson=n,v.expression=t.options.expression,v.notExpression=t.options.expression.notMPDesc,v.mode="MANUFACTURINGPLAN",v.use="",v.displayCompactMode=t.options.displayCompactMode,this.manufacturingplanCheckbox=new a({type:"checkbox",value:"PSComponent",className:"primary",label:g.Manufacturing_Plan}).inject(this.container.getElement(".evolution-dialog-manufacturingplans-checkbox")),this.manufacturingplanCheckbox.addEventListener("click",(()=>{this.manufacturingplanCheckbox.checkFlag?this.manufacturingplanComponent.show():this.manufacturingplanComponent.hide()})),this.manufacturingplanComponent=new d(v),this.manufacturingplanComponent.render(),1==m?(this.manufacturingplanCheckbox.checkFlag=!0,this.manufacturingplanComponent.show()):this.manufacturingplanComponent.hide(),this.manufacturingplanComponent.initialiseComponent(),("False"==h.manufacturingPlans||null!=t.options.enabledCritData&&"undefined"!=t.options.enabledCritData&&"false"==t.options.enabledCritData.manufacturingPlan)&&(this.manufacturingplanCheckbox.checkFlag=!1,this.manufacturingplanCheckbox.hide(),this.manufacturingplanComponent.hide()),this.UnitCheckbox=new a({type:"checkbox",value:"UnitComponent",className:"primary",label:g.Unit}).inject(this.container.getElement(".evolution-dialog-unit-checkbox")),this.UnitCheckbox.addEventListener("click",(()=>{this.UnitCheckbox.checkFlag?this.UnitComponent.show():this.UnitComponent.hide()}));var x=null;0!=Object.keys(t.options.expression).length&&(x=t.options.expression.iUnitJson).length>0&&JSON.parse(t.options.expression.iUnitJson).builds.length;var b=this.container.getElement(".evolution-dialog-unit");(this.UnitComponent=new p({parentElement:b,mode:"UNIT",expression:t.options.expression,invokeFrom:t.options.mode,displayCompactMode:t.options.displayCompactMode}),this.UnitComponent.render(),this.UnitComponent.SetJson(x),1==l?(this.UnitComponent.show(),this.UnitCheckbox.checkFlag=!0):this.UnitComponent.hide(),null!=u.configurationCriteria&&0==u.configurationCriteria.unit||"FALSE"==h.builds||null!=t.options.enabledCritData&&"undefined"!=t.options.enabledCritData&&"false"==t.options.enabledCritData.unit?(this.UnitCheckbox.checkFlag=!1,this.UnitCheckbox.hide(),this.UnitComponent.hide()):this.UnitComponent.initialiseComponent(),null==t.options.enabledCritData&&(t.options.enabledCritData={milestone:"true"}),"False"!=h.milestones)&&i.checkMilestoneActivation().then((function(o){(t.milestoneActivationStatus=o,"Enabled"==o&&null!=t.options.enabledCritData&&null!=t.options.enabledCritData&&"true"==t.options.enabledCritData.milestone)&&(t.milestoneCheckbox=new a({type:"checkbox",value:"MSComponent",className:"primary",label:g.Milestone}).inject(t.container.getElement(".evolution-dialog-milestones-checkbox")),t.milestoneCheckbox.addEventListener("click",(()=>{t.milestoneCheckbox.checkFlag?t.milestoneComponent.show():t.milestoneComponent.hide()})),t.milestoneCheckbox.checkFlag=!0,t.DateCheckbox.hide(),t.DatePicker.hide(),t.evolutionSpinner=new e({className:"evolutionSpinner"}).inject(t.container.getElement(".evolution-dialog-milestones")),t.evolutionSpinner.spin(),t.evolutionSpinner.show(),null==u.getDictionaryByCriteria(t.options.expression.modelId,"milestones").milestones?i.getDictionaryFromServer(t.options.expression.modelId,"milestones=1&attributes").then((function(e){u.addDictionaryByCriteria(t.options.expression.modelId,e,"milestones"),t.processmilestones()})):t.processmilestones())}),(function(e){}));this.DateCheckbox=new a({type:"checkbox",value:"DateComponent",className:"primary",label:g.Date,checked:!1}).inject(this.container.getElement(".evolution-dialog-date-checkbox")),this.DateCheckbox.addEventListener("click",(()=>{this.DateCheckbox.checkFlag?this.DatePicker.show():this.DatePicker.hide()}));var D=null;0!=Object.keys(t.options.expression).length&&(D=t.options.expression.iDateJson);var E=this.container.getElement(".evolution-dialog-date");t.options.displayCompactMode;this.DatePicker=new c(E,D,{view:"show",defaultDateBehavior:"DateRange",displayCompactMode:t.options.displayCompactMode}),this.DatePicker.render(),1==r?(t.DatePicker.show(),this.DateCheckbox.checkFlag=!0):this.DatePicker.hide(),(null!=u.configurationCriteria&&0==u.configurationCriteria.contextualDate||null!=t.options.enabledCritData&&null!=t.options.enabledCritData&&"false"==t.options.enabledCritData.contextualDate||"Enabled"==t.milestoneActivationStatus)&&(this.DatePicker.hide(),this.DateCheckbox.hide()),this.toggles=this.container.getElements(".toggle-primary"),this.inject(this.options.parent),this.options.evolutionSpinner&&this.options.evolutionSpinner.hide()},processmilestones:function(){var e=u.getDictionaryByCriteria(this.options.expression.modelId,"milestones"),t={};if(t.parentElement=this.container.getElement(".evolution-dialog-milestones"),0!=Object.keys(e.milestones).length&&Object.keys(this.options.expression.milestoneJson).length)for(var i=this.options.expression.milestoneJson,o=i.length,n=0;n<o;n++){for(var s=e.milestones[0].sequence,a=0;a<s.length;a++)s[a].name==i[n].start.name&&(i[n].start.revision=s[a].date);for(var l=i[n],r=0;r<=l.length;r++)for(a=0;a<s.length;a++)s[a].name==l[r].name&&(l[r].revision=s[a].date)}t.milestoneJson=this.options.expression.milestoneJson,t.milestoneXml=this.options.expression.xmlExpression,t.modelId=this.options.expression.modelId,t.mode="MILESTONES",t.expression=this.options.expression,t.use="",t.displayCompactMode=this.options.displayCompactMode,this.milestoneComponent=new d(t),this.milestoneComponent.render(),1==this.options.expression.milestoneCheckbox?(this.milestoneCheckbox.checkFlag=!0,this.milestoneComponent.show()):this.milestoneComponent.hide(),this.milestoneComponent.initialiseComponent(),this.evolutionSpinner.hide()},buildData:function(){var e=this.ProductStateComponent.buildFilterXML(),t=this.ProductStateComponent.buildDescription();0==this.productstateCheckbox.checkFlag&&(e="",t=[]),""==this.ProductStateComponent.displayExpression&&(this.options.expression.notPSDesc="");var i=this.UnitComponent.buildUnitXML(this.options.expression.name,this.UnitCheckbox.checkFlag);if(null==i)return null;var o=this.DatePicker.getXML();if(0==this.DateCheckbox.checkFlag&&(o=""),null==o)return null;var n=this.manufacturingplanComponent.buildFilterXML(),s=this.manufacturingplanComponent.buildDescription();0==this.manufacturingplanCheckbox.checkFlag&&(n="",s=[]),""==this.manufacturingplanComponent.displayExpression&&(this.options.expression.notMPDesc="");var a="";null!=this.milestoneComponent&&(a=this.milestoneComponent.buildFilterXML(),0==this.milestoneCheckbox.checkFlag&&(a=""));var l=this.ProductStateComponent.buildFilterJson();0==this.productstateCheckbox.checkFlag&&(l=[]);var r=this.DatePicker.getJSON();null!=o&&0!=this.DateCheckbox.checkFlag||(r={DateRanges:[]});var d=this.UnitComponent.getJson();0==this.UnitCheckbox.checkFlag&&(d=JSON.stringify({builds:[]}));var c=this.manufacturingplanComponent.buildFilterJson();0==this.manufacturingplanCheckbox.checkFlag&&(c=[]);var p=p=[];return null!=this.milestoneComponent&&(this.milestoneComponent.buildFilterJson(),0==this.milestoneCheckbox.checkFlag&&(p=[])),this.options.expression.psJson=l,this.options.expression.viewJson=null,this.options.expression.iDateJson=r,this.options.expression.mpJson=c,this.options.expression.iUnitJson=d,this.options.expression.milestoneJson=p,this.options.expression.xmlExpression=e,this.options.expression.psXmlDesc=t,this.options.expression.iDateXml=o,this.options.expression.iUnitXml=i,this.options.expression.impXml=n,this.options.expression.mpXmlDesc=s,this.options.expression.milestoneXml=a,this.options.expression.productstatecheckbox=this.productstateCheckbox.checkFlag,this.options.expression.unitcheckbox=this.UnitCheckbox.checkFlag,this.options.expression.datestatecheckbox=this.DateCheckbox.checkFlag,this.options.expression.manufacturingplanstatecheckbox=this.manufacturingplanCheckbox.checkFlag,this.options.expression}})})),define("DS/CfgEvolutionUX/CfgEvolutionController",["DS/CfgBaseUX/scripts/CfgModelView","DS/CfgBaseUX/scripts/CfgContainerView","DS/CfgBaseUX/scripts/CfgData","DS/CoreEvents/ModelEvents","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgBaseUX/scripts/CfgUXEnvVariables","DS/CfgEvolutionUX/CfgVersionGraphLayout","DS/CfgFilterUX/CfgFilterSlideInComponent","text!DS/CfgFilterUX/CfgFilterslideInDialogTemplate.html","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/CfgEvolutionUX/CfgEvolutionLayoutFactory","DS/CfgBaseUX/scripts/CfgXMLServices","DS/CfgTracker/CfgTracker","DS/CfgTracker/CfgDimension","DS/CfgTracker/CfgValue","i18n!DS/CfgBaseUX/assets/nls/CfgBaseUX","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX","css!DS/CfgBaseUX/styles/CfgDialog.css"],(function(e,t,i,o,n,s,a,l,r,d,c,p,u,m,h,g,f){"use strict";var C={probesData:[],render:function(e){if(this.probesData=[],this.options=e,this.parent=this.options.parent,this.propagateSessionEffectivity=!0,this.criteriaViewValidate=!0,this.notExpressionValidate=!0,i.clear(),i.ModelEvents=new o,this.cfgUXEnvVariablesJS=s.getCfgUXEnvVariables(),this.CfgVersionGraphLayoutInstance=new a,1==this.options.collection.length){var t=this.options.collection.at(0);C.options.expression=t.get("expression");var l=this;new Promise((function(e,t){var i={version:"1.0.0",modelIds:[{id:"pid:"+l.options.expression.modelId}]};i=JSON.stringify(i);n.makeWSCall("/resources/modeler/browsing/model/getcriteria","POST","enovia","application/json",i,(function(t){e(t)}),(function(e){console.log("fail to get criterias")}),!0)})).then((function(e){if(null!=e.criteria[0].products&&"FALSE"==e.criteria[0].products.toUpperCase()&&null!=e.criteria[0].manufacturingPlans&&"FALSE"==e.criteria[0].manufacturingPlans.toUpperCase()&&null!=e.criteria[0].builds&&"FALSE"==e.criteria[0].builds.toUpperCase()&&i.configurationCriteria&&null!=i.configurationCriteria.contextualDate&&"FALSE"==i.configurationCriteria.contextualDate.toString().toUpperCase())return l.options.evolutionSpinner&&l.options.evolutionSpinner.hide(),void n.showwarning(f.Not_Accessible_Eff_Error,"error");C.options.criteriasAvailable=e.criteria[0],C.options.selectedmodel=t,C.options.selectedcollection=C.options.collection;var o=l.isOneModelOneCriteriaCondition(C.options.criteriasAvailable,C.options.enabledCritData);""!=o?l.manageTransitionForSingleModelSingleCriteria(o,l.options.expression):(C.createCriteriasView(C.options.collection.at(0)),C.subscribeModelEvents(),C.evolModel="Single_Context_Multiple_Criteria_")}))}else{if(null!=this.options.expressionJson)for(var r=0;r<this.options.expressionJson.length;r++){let e=this.options.expressionJson[r].expression;(n.isDefined(e.notPSDesc)&&e.notPSDesc.length>0||n.isDefined(e.notMPDesc)&&e.notMPDesc.length>0||n.isDefined(e.notUnitDesc)&&e.notUnitDesc.length>0)&&(this.notExpressionValidate=!1)}this.createModelListView(),this.subscribeModelEvents(),C.evolModel="Multiple_Context_Multiple_Criteria_"}C.globalexpression=this.options.dialogue.effExpressionXml,null==C.globalexpression&&(C.globalexpression="")},getMagicProbesData:function(e,t){if(t.probesData){if(t.probesData.listViewClickCount>0){let i=t.probesData.type;for(let o=0;o<t.probesData.listViewClickCount;o++)C.probesData.push(e+i+"_Version_Graph_Click")}if(t.probesData.toggleClickCount>0){let i=t.probesData.type;for(let o=0;o<t.probesData.toggleClickCount;o++)C.probesData.push(e+i+"_Toggle_Click")}if(t.probesData.singleDateClickCount>0)for(let i=0;i<t.probesData.singleDateClickCount;i++)C.probesData.push(e+"DATE_Single_Click");if(t.probesData.rangeDateClickCount>0)for(let i=0;i<t.probesData.rangeDateClickCount;i++)C.probesData.push(e+"DATE_Range_Click")}},isOneModelOneCriteriaCondition:function(e,t){var i=e.products,o=e.manufacturingPlans,n=e.builds,s=e.contextualDate,a=t.productState,l=t.manufacturingPlan,r=t.unit,d=t.contextualDate;return"TRUE"==i&&"true"==a&&"false"==l&&"false"==r&&"false"==d?"products":"TRUE"==o&&"false"==a&&"true"==l&&"false"==r&&"false"==d?"manufacturingPlans":"TRUE"==i&&"False"==o&&"False"==n&&"False"==s&&"true"==a?"products":"False"==i&&"TRUE"==o&&"False"==n&&"False"==s&&"true"==l?"manufacturingPlans":""},manageTransitionForSingleModelSingleCriteria:function(e,t){this.createDictionarySelectionView(e,t,"singlePageTransition"),i.ModelEvents.subscribe({event:"ProductStateDialogClosed"},(function(i){var o={buttonId:"firstButton",propagateSessionEffectivity:i.event.propagateSessionEffectivity};null==i.xml?o.buttonId="secondButton":(C.notExpressionValidate=!0,"products"==e?(t.xmlExpression=i.xml,t.psXmlDesc=i.xmlDesc,t.psJson=i.json,0==t.psJson.length&&null!=t.notPSDesc&&t.notPSDesc.length>0&&(C.notExpressionValidate=!1,C.CfgVersionGraphLayoutInstance&&C.CfgVersionGraphLayoutInstance.versionGraph&&1==C.CfgVersionGraphLayoutInstance.versionGraph.IsExpressionModified&&(C.notExpressionValidate=!0))):"manufacturingPlans"==e&&(t.impXml=i.xml,t.mpXmlDesc=i.xmlDesc,t.mpJson=i.json,0==t.mpJson.length&&null!=t.notMPDesc&&t.notMPDesc.length>0&&(C.notExpressionValidate=!1,C.CfgVersionGraphLayoutInstance&&C.CfgVersionGraphLayoutInstance.versionGraph&&1==C.CfgVersionGraphLayoutInstance.versionGraph.IsExpressionModified&&(C.notExpressionValidate=!0))),1==C.notExpressionValidate&&C.updateCollection(t),C.evolModel="Single_Context_Single_Criteria_",C.getMagicProbesData(C.evolModel,i)),C.onSaveEffectivity(o)}))},createDictionarySelectionView:function(e,t,o){var s=this;i.ModelEvents.publish({event:"LaunchingDictionarySelection",data:{}});var a={};if(a.displayCompactMode=s.options.displayCompactMode,"products"==e?(a.mode="PRODUCTS",a.psJson=t.psJson):"manufacturingPlans"==e&&(a.mode="MANUFACTURINGPLAN",a.psJson=t.mpJson),a.use="",a.transition=UWA.is(o)?o:"","intermidiateTransition"==o?(a.firstButtonText=g.CFG_Apply,a.secondButtonText=g.CFG_Back):(a.firstButtonText=g.CFG_Ok,a.secondButtonText=g.CFG_Cancel,a.propagateSessionEffectivity=s.propagateSessionEffectivity),i.renderTo=a.parentElement=C.options.parentElement,a.ModelLabel=C.options.selectedmodel.get("name"),a.displayexpression=t.displayexpression?t.displayexpression:"",a.modelID=t.modelId,"PRODUCTS"==a.mode?(a.xmlExpression=t.xmlExpression?t.xmlExpression:"",a.xmlDesc=t.psXmlDesc?t.psXmlDesc:""):"MANUFACTURINGPLAN"==a.mode&&(a.xmlExpression=t.impXml?t.impXml:"",a.xmlDesc=t.mpXmlDesc?t.mpXmlDesc:""),s.options.evolutionSpinner&&s.options.evolutionSpinner.hide(),"PRODUCTS"!=a.mode&&"MANUFACTURINGPLAN"!=a.mode||s.CfgVersionGraphLayoutInstance.create(a),!this.cfgUXEnvVariablesJS.isVersionExplorer)if(null==i.getDictionaryByCriteria(t.modelId,e)[e]){var l="",r="",d='<?xml version="1.0" encoding="UTF-8"?><CfgFilterExpression xmlns="urn:com:dassault_systemes:config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="urn:com:dassault_systemes:config CfgFilterExpression.xsd"><FilterSelection SelectionMode="Strict">',c="</FilterSelection></CfgFilterExpression>";"products"==e?r=d+'<Context xmlns="urn:com:dassault_systemes:config" HolderType="Model" HolderName="'+t.name+'" >'+t.xmlExpression+"</Context>"+c:"manufacturingPlans"==e&&(r=d+'<Context xmlns="urn:com:dassault_systemes:config" HolderType="Model" HolderName="'+t.name+'" >'+t.impXml+"</Context>"+c),""!==r&&(l={evolutionExpression:JSON.stringify({filterExpression:p.getValidXmlWithoutDescId(r)})},console.log("CfgEvolutionController evoExpression = "+r+" wParam after descId removed = "+l.evolutionExpression)),("products"==e||"manufacturingPlans"==e?n.getDictionaryFromServer(t.modelId,"onlyUnfrozenNodes=1&"+e,null,l):n.getDictionaryFromServer(t.modelId,e)).then((function(o){i.addDictionaryByCriteria(t.modelId,o,e),a.data=i.getDictionaryByCriteria(t.modelId,e),"PRODUCTS"==a.mode?s.CfgVersionGraphLayoutInstance.render(a.data.products):"MANUFACTURINGPLAN"==a.mode&&s.CfgVersionGraphLayoutInstance.render(a.data.manufacturingPlans)}))}else a.data=i.getDictionaryByCriteria(t.modelId,e),setTimeout((function(){"PRODUCTS"==a.mode?s.CfgVersionGraphLayoutInstance.render(a.data.products):"MANUFACTURINGPLAN"==a.mode&&s.CfgVersionGraphLayoutInstance.render(a.data.manufacturingPlans)}),100)},manageTransitionForSingleModelMultipleCriteria:function(){this.createCriteriasView(this.options.collection.at(0)),this.subscribeModelEvents()},createModelListView:function(){this.options.editActionCallback=this.onEditActionCallback,this.createModelViewContainer(),this.modelListView=new e(this.options),this.modelListView.render(this.options.collection)},createCriteriasView:function(e){C.options.expression=e.get("expression");var o=this;new Promise((function(e,t){var i={version:"1.0.0",modelIds:[{id:"pid:"+o.options.expression.modelId}]};i=JSON.stringify(i);n.makeWSCall("/resources/modeler/browsing/model/getcriteria","POST","enovia","application/json",i,(function(t){e(t)}),(function(e){console.log("fail to get criterias")}),!0)})).then((function(n){C.options.criteriasAvailable=n.criteria[0],C.options.selectedmodel=e,C.options.selectedcollection=C.options.collection,o.options.parentElement=C.options.parent,o.options.parentElement.innerHTML="";var s=o.isOneModelOneCriteriaCondition(C.options.criteriasAvailable,C.options.enabledCritData);if(""!=s){o.createDictionarySelectionView(s,C.options.expression,"intermidiateTransition");var a=i.ModelEvents.subscribe({event:"ProductStateDialogClosed"},(function(e){null!=e.xml&&(C.notExpressionValidate=!0,"products"==s?(C.options.expression.xmlExpression=e.xml,C.options.expression.psXmlDesc=e.xmlDesc,C.options.expression.psJson=e.json,0==C.options.expression.psJson.length&&null!=C.options.expression.notPSDesc&&C.options.expression.notPSDesc.length>0&&(C.notExpressionValidate=!1)):"manufacturingPlans"==s&&(C.options.expression.impXml=e.xml,C.options.expression.mpXmlDesc=e.xmlDesc,C.options.expression.mpJson=e.json,0==C.options.expression.mpJson.length&&null!=C.options.expression.notMPDesc&&C.options.expression.notMPDesc.length>0&&(C.notExpressionValidate=!1))),null!=e.xml&&1==C.notExpressionValidate&&C.updateCollection(C.options.expression),C.onUpdateEffectivity(),i.ModelEvents.unsubscribe(a)}))}else require(["DS/CfgEvolutionUX/CfgEvolutionCriteriaView"],(function(i){o.options.parentElement=C.options.parent,o.options.parentElement.innerHTML="";var n="",s=g.CFG_Apply,a=g.CFG_Back,l=!1;1==o.options.collection.length?(n=o.onUpdateAndSaveEffectivity,s=g.CFG_Ok,a=g.CFG_Cancel,l=o.propagateSessionEffectivity):n=o.onUpdateEffectivity;var r={isHeader:!0,isFooter:!0,firstButtonText:s,secondButtonText:a,headerText:e.get("marketingName")?e.get("marketingName"):e.get("name"),toggleSessionEffectivity:l,onButtonClickCB:n};C.criteriaViewContainer=new t(r).render(),C.criteriaViewContainer.getContent().addClassName("CfgContainerView-EditEvolution"),C.options.parent=C.criteriaViewContainer._body,C.options.propagateSessionEffectivity=!1,C.CfgEvolutionCriteriaView=new i(C.options),C.CfgEvolutionCriteriaView.render(),C.criteriaViewContainer.inject(o.options.parentElement)}))}))},onUpdateAndSaveEffectivity:function(e){if(e&&"firstButton"==e.buttonId){C.notExpressionValidate=!0;var t=null;if(null!=C.CfgEvolutionCriteriaView&&(t=C.CfgEvolutionCriteriaView.buildData(),C.criteriaViewValidate=null!=t,(t.productstatecheckbox&&0==t.psJson.length&&null!=t.notPSDesc&&t.notPSDesc.length>0||t.manufacturingplanstatecheckbox&&0==t.mpJson.length&&null!=t.notMPDesc&&t.notMPDesc.length>0||t.unitcheckbox&&t.iUnitJson.indexOf("NOT")>=0&&null!=t.notUnitDesc&&t.notUnitDesc.length>0)&&(C.notExpressionValidate=!1),null!=C.CfgEvolutionCriteriaView.DatePicker)){t.probesData={type:"DATE",singleDateClickCount:C.CfgEvolutionCriteriaView.DatePicker.singleDateClickCount,rangeDateClickCount:C.CfgEvolutionCriteriaView.DatePicker.rangeDateClickCount};let e=C.evolModel;e&&(e=e.replace("Multiple_Criteria_",""),C.getMagicProbesData(e,t))}null!=C.CfgEvolutionCriteriaView&&null!=t&&0!=C.criteriaViewValidate&&0!=C.notExpressionValidate&&C.updateCollection(t)}C.onSaveEffectivity(e)},onEditActionCallback:function(e){C.createCriteriasView(e)},checkBoxClicked:function(e){C.propagateSessionEffectivity=e.propagateSessionEffectivity?"checked":"unchecked"},sendEditEvolutionTrackerEvent:function(e){let t="",i="",o=e.noOfContext,n=e.totalProductRangeLength,s=e.totalProductSingleLength,a=e.totalManuPlanRangeLength,l=e.totalManuPlanSingleLength,r=e.totalUnitRangeLength,d=e.totalUnitSingleLength,c=e.totalDateRangeLength,p=e.totalDateSingleLength;"Native"==e.mode?(t="Native",i="Web In Win"):(t=widget.data.appId,i=null!=widget.options?widget.options.title:"ODT Environment");let g=u.getDeviceUsedForOperation(),f=u.ConfigOperationMode.CREATE;"Edit"==e.evolutionMode&&(f=u.ConfigOperationMode.EDIT);let C=u.ConfigCriteriaSelected.NONE;"NONE"!=e.modelVersionCriteria&&(C=u.ConfigCriteriaSelected[e.modelVersionCriteria]);let v=u.ConfigCriteriaSelected.NONE;"NONE"!=e.manufacturingPlanCriteria&&(v=u.ConfigCriteriaSelected[e.manufacturingPlanCriteria]);let x=u.ConfigCriteriaSelected.NONE;"NONE"!=e.unitCriteria&&(x=u.ConfigCriteriaSelected[e.unitCriteria]);let b=u.ConfigCriteriaSelected.NONE;"NONE"!=e.dateCriteria&&(b=u.ConfigCriteriaSelected[e.dateCriteria]);var D=u.KeepSessionEffectivity.FALSE;"checked"==e.keepSessionEffectivity&&(D=u.KeepSessionEffectivity.TRUE),u.createEventBuilder({category:u.Category.USAGE,action:u.Events.CLICK,tenant:enoviaServerFilterWidget.tenant}).setLabel(u.Labels.EDIT_EVOLUTION_EFFECTIVITY).setAppId(t).addDimension(m.EDIT_EVOLUTION_EFFECTIVITY.EDIT_EVOLUTION_EFFECTIVITY_WIDGET,i).addDimension(m.EDIT_EVOLUTION_EFFECTIVITY.EDIT_EVOLUTION_EFFECTIVITY_MEDIA,g).addDimension(m.EDIT_EVOLUTION_EFFECTIVITY.EDIT_EVOLUTION_EFFECTIVITY_MODE,f).addDimension(m.EDIT_EVOLUTION_EFFECTIVITY.EDIT_EVOLUTION_CRITERIA_MODEL_VERSION,C).addDimension(m.EDIT_EVOLUTION_EFFECTIVITY.EDIT_EVOLUTION_CRITERIA_MANUFACTURING_PLAN,v).addDimension(m.EDIT_EVOLUTION_EFFECTIVITY.EDIT_EVOLUTION_CRITERIA_UNIT,x).addDimension(m.EDIT_EVOLUTION_EFFECTIVITY.EDIT_EVOLUTION_CRITERIA_DATE,b).addDimension(m.EDIT_EVOLUTION_EFFECTIVITY.EDIT_EVOLUTION_KEEP_SESSION_EFFECTIVITY,D).addPersonalValue(h.EDIT_EVOLUTION_EFFECTIVITY.EDIT_EVOLUTION_NO_OF_MODEL,o).addPersonalValue(h.EDIT_EVOLUTION_EFFECTIVITY.EDIT_EVOLUTION_TOTAL_NO_OF_PRODUCT_RANGE,n).addPersonalValue(h.EDIT_EVOLUTION_EFFECTIVITY.EDIT_EVOLUTION_TOTAL_NO_OF_PRODUCT_SINGLE,s).addPersonalValue(h.EDIT_EVOLUTION_EFFECTIVITY.EDIT_EVOLUTION_TOTAL_NO_OF_MANUFACTURING_PLAN_RANGE,a).addPersonalValue(h.EDIT_EVOLUTION_EFFECTIVITY.EDIT_EVOLUTION_TOTAL_NO_OF_MANUFACTURING_PLAN_SINGLE,l).addPersonalValue(h.EDIT_EVOLUTION_EFFECTIVITY.EDIT_EVOLUTION_TOTAL_NO_OF_UNIT_RANGE,r).addPersonalValue(h.EDIT_EVOLUTION_EFFECTIVITY.EDIT_EVOLUTION_TOTAL_NO_OF_UNIT_SINGLE,d).addPersonalValue(h.EDIT_EVOLUTION_EFFECTIVITY.EDIT_EVOLUTION_TOTAL_NO_OF_DATE_RANGE,c).addPersonalValue(h.EDIT_EVOLUTION_EFFECTIVITY.EDIT_EVOLUTION_TOTAL_NO_OF_DATE_SINGLE,p).send()},onSaveEffectivity:function(e){if("firstButton"==e.buttonId){if(C.options.collection.length>0)for(var t=0;t<C.options.collection.length;t++){let e=C.options.collection._models[t]._changed;null!=e&&null!=e.expression&&(null!=e.expression.notPSDesc&&e.expression.notPSDesc.length>0||null!=e.expression.notMPDesc&&e.expression.notMPDesc.length>0||null!=e.expression.notUnitDesc&&e.expression.notUnitDesc.length>0)&&(C.notExpressionValidate=!1)}if(0==C.notExpressionValidate)return void n.showwarning(f.Not_Effectivity_Error,"error")}if(C.propagateSessionEffectivity=e.propagateSessionEffectivity?"checked":"unchecked","Native"==window.enoviaServerFilterWidget.mode){var o={modelIdsWithEffectivity:C.options.collection.getEffectivityModelsIDs(),globalEffectivityExpression:C.options.collection.getGlobalEvolutionExpression(),propagateSessionEffectivity:e.propagateSessionEffectivity,hasFrozenNodeInExpression:i._hasFrozenNodeInExpression},s={eventName:"cfgEditEvolutionEffectivity",operation:"firstButton"==e.buttonId?"OK":"Cancel",operationVersion:"1.0",content:JSON.stringify(o)};if("firstButton"==e.buttonId){if(0==C.criteriaViewValidate)return;n.sendNotificationWebInWin(s)}else n.sendNotificationWebInWin(s)}else if("firstButton"==e.buttonId){if(0==C.criteriaViewValidate)return;C.saveEffectivity(),C.options.dialogue.object.closeDialog()}else C.options.dialogue.object.closeDialog();let a="Native",l="Rich Client Applications",r="NATIVEWIW";if(widget&&widget.data&&widget.data.appId&&(a=widget.data.appId),widget&&widget.options&&widget.options.title&&(l=widget.options.title),"firstButton"==e.buttonId){let e={noOfContext:C.options.collection.length,mode:"Dashboard"};"Native"==window.enoviaServerFilterWidget.mode&&(e.mode="Native"),e.evolutionMode="Create",1==C.options.dialogue.hasEffectivity&&(e.evolutionMode="Edit"),e.keepSessionEffectivity="unchecked","checked"==C.propagateSessionEffectivity&&(e.keepSessionEffectivity="checked");let t=p.getProbesEvolutionCriteria(C.globalexpression);if(e.totalProductRangeLength=t.totalProductRangeLength,e.totalProductSingleLength=t.totalProductSingleLength,e.totalManuPlanRangeLength=t.totalManuPlanRangeLength,e.totalManuPlanSingleLength=t.totalManuPlanSingleLength,e.totalUnitRangeLength=t.totalUnitRangeLength,e.totalUnitSingleLength=t.totalUnitSingleLength,e.totalDateRangeLength=t.totalDateRangeLength,e.totalDateSingleLength=t.totalDateSingleLength,e.modelVersionCriteria="NONE","NONE"!=t.mvCriteria&&(e.modelVersionCriteria=t.mvCriteria),e.manufacturingPlanCriteria="NONE","NONE"!=t.mpCriteria&&(e.manufacturingPlanCriteria=t.mpCriteria),e.unitCriteria="NONE","NONE"!=t.unitCriteria&&(e.unitCriteria=t.unitCriteria),e.dateCriteria="NONE","NONE"!=t.dateCriteria&&(e.dateCriteria=t.dateCriteria),C.sendEditEvolutionTrackerEvent(e),"Dashboard"==e.mode&&(r="DASHBOARD"),C.probesData&&C.probesData.length>0){let e="Edit_Evolution_OK_";"checked"==C.propagateSessionEffectivity&&(e="SaveAs_Session_Evolution_OK_");for(let t=0;t<C.probesData.length;t++){let i={AppId:a,AppName:l,CommandOperation:e+C.probesData[t],CommandName:u.Labels.EDIT_EVOLUTION_EFFECTIVITY,ConfigMode:u.ConfigMode.CONTEXTUAL,ApplicationMode:r};n.sendConfgurationCommandsClickEventForMagicProbes(i)}}}else{let e={AppId:a,AppName:l,CommandOperation:"Edit_Evolution_Cancel",CommandName:u.Labels.EDIT_EVOLUTION_EFFECTIVITY,ConfigMode:u.ConfigMode.CONTEXTUAL,ApplicationMode:r};n.sendConfgurationCommandsClickEventForMagicProbes(e)}},onUpdateEffectivity:function(e){if(C.criteriaViewValidate=!0,e&&"firstButton"==e.buttonId){C.notExpressionValidate=!0;var t=null;if(null!=C.CfgEvolutionCriteriaView&&(t=C.CfgEvolutionCriteriaView.buildData(),C.criteriaViewValidate=null!=t,(t.productstatecheckbox&&0==t.psJson.length&&null!=t.notPSDesc&&t.notPSDesc.length>0||t.manufacturingplanstatecheckbox&&0==t.mpJson.length&&null!=t.notMPDesc&&t.notMPDesc.length>0||t.unitcheckbox&&t.iUnitJson.indexOf("NOT")>=0&&null!=t.notUnitDesc&&t.notUnitDesc.length>0)&&(C.notExpressionValidate=!1,n.showwarning(f.Not_Effectivity_Error,"error")),null!=C.CfgEvolutionCriteriaView.DatePicker)){t.probesData={type:"DATE",singleDateClickCount:C.CfgEvolutionCriteriaView.DatePicker.singleDateClickCount,rangeDateClickCount:C.CfgEvolutionCriteriaView.DatePicker.rangeDateClickCount};let e=C.evolModel;e&&(e=e.replace("Multiple_Criteria_",""),C.getMagicProbesData(e,t))}if(null!=C.CfgEvolutionCriteriaView&&null!=t&&0!=C.criteriaViewValidate&&0!=C.notExpressionValidate&&C.updateCollection(t),0==C.criteriaViewValidate||0==C.notExpressionValidate)return}C.createModelListView(),C.criteriaViewContainer&&C.criteriaViewContainer.hide()},subscribeModelEvents:function(){i.ModelEvents.subscribe({event:"LaunchingDictionarySelection"},(function(e){C.criteriaViewContainer&&C.criteriaViewContainer.hide()})),i.ModelEvents.subscribe({event:"ProductStateDialogClosed"},(function(e){C.criteriaViewContainer&&C.criteriaViewContainer.show();let t=C.evolModel;t&&C.getMagicProbesData(t,e)})),i.ModelEvents.subscribe({event:"UnitsDialogClosed"},(function(e){C.criteriaViewContainer&&C.criteriaViewContainer.show();let t=C.evolModel;t&&(t=t.replace("Multiple_Criteria_",""),C.getMagicProbesData(t,e))}))},createModelViewContainer:function(){var e=this;e.options.parent=e.parent;var i={isHeader:!1,isFooter:!0,firstButtonText:g.CFG_Ok,secondButtonText:g.CFG_Cancel,headerText:"",toggleSessionEffectivity:e.propagateSessionEffectivity,onCheckBoxClick:e.checkBoxClicked,onButtonClickCB:e.onSaveEffectivity};C.modelListViewContainer&&C.modelListViewContainer.destroy(),C.modelListViewContainer=new t(i).render(),C.modelListViewContainer.getContent().addClassName("CfgContainerView-EditEvolution-CustomTile"),C.modelListViewContainer.inject(this.parent),C.options.parentElement=C.modelListViewContainer._body},updateCollection:function(e){C.options.selectedmodel.set("expression",e);var t,i;t=C.options.selectedcollection.getGlobalEvolutionExpression(),i=C.options.selectedmodel.getContextEvolutionExpression(),C.globalexpression=t;var o=n.getDisplayExpressionUsingXSLT(i);e.displayexpression=o||"",null!=o&&null!=o&&""!=o||(o=C.options.emptyContextText),C.options.selectedmodel.set("displayexpression",o)},saveEffectivity:function(){var e,t=function(e){for(var t in"checked"==C.propagateSessionEffectivity&&(n.isDefined(i._hasFrozenNodeInExpression)&&!1===i._hasFrozenNodeInExpression?(C.options.selectedcollection?c.collection=C.options.selectedcollection:c.collection=C.options.collection,d.saveAsSessionEvolution(c.getGlobalSessiondata())):n.showwarning(f.Frozen_Ref,"warning")),e.expressions)if(e.expressions.hasOwnProperty(t)&&null!=e.expressions[t].content&&null!=e.expressions[t].content.Evolution){if(null!=e.expressions[t].content.Evolution.Current){var o=e.expressions[t].content.Evolution.Current;e.expressions[t].content.Evolution.currentDisplayExpression=n.getDisplayExpressionUsingXSLT(o)}if(null!=e.expressions[t].content.Evolution.Projected){var s=e.expressions[t].content.Evolution.Projected;e.expressions[t].content.Evolution.projectedDisplayExpression=n.getDisplayExpressionUsingXSLT(s)}}if(null!=e.GlobalStatus&&"SUCCESS"==e.GlobalStatus){var a=e.results[0].existing;if(null!=a&&null!=a.content&&null!=a.content.Evolution){if(null!=a.content.Evolution.Current){o=a.content.Evolution.Current;e.results[0].existing.content.Evolution.currentDisplayExpression=n.getDisplayExpressionUsingXSLT(o)}if(null!=a.content.Evolution.Projected){s=a.content.Evolution.Projected;e.results[0].existing.content.Evolution.projectedDisplayExpression=n.getDisplayExpressionUsingXSLT(s)}}}if(C.options.postCloseHandler&&C.options.postCloseHandler(e),null!=e.GlobalStatus&&"SUCCESS"==e.GlobalStatus||C.options.PADContext){var l={commandName:"cfgEditEvolution",widgetId:widget.id,response:n.getEventResponse(e),data:{}};n.publishPostProcessingEventForApplications(l)}void 0!==e.GlobalStatus&&"SUCCESS"==e.GlobalStatus||void 0!==e.unset&&("SUCCESS"===e.unset.Evolution.status.toUpperCase()||"WARNING"===e.unset.Evolution.status.toUpperCase())?n.showwarning(f.Save_Successful_Evo_Effectivity,"success"):void 0!==e.GlobalStatus&&"ERROR"==e.GlobalStatus&&e.results[0].message&&""!=e.results[0].message?n.showwarning(e.results[0].message,"error"):n.showwarning(f.Save_Fail_Evo_Effectivity,"error")},o=function(e){n.isDefined(e)&&n.isDefined(e.errorMessage)?n.showwarning(f.Save_Fail_Evo_Effectivity+"\n"+e.errorMessage,"error"):n.showwarning(f.Save_Fail_Evo_Effectivity,"error")},s=null;C.options.dialogue.ca.headers.length>0&&(s={operationheader:{key:C.options.dialogue.ca.headers[0].key,value:C.options.dialogue.ca.headers[0].value}}),""==C.globalexpression?(e={wsOptions:s,instanceID:C.options.objectid},n.unsetEvolutionEffectivities(e).then((function(e){t(e)}),(function(e){o(e)}))):(e={version:"1.1",domain:"Evolution",view:"All",expressionList:[{pid:C.options.objectid,EvolutionContent:C.globalexpression}],wsOptions:s},n.setEvolutionEffectivities(e).then((function(e){t(e)}),(function(e){o(e)})))}};return C})),define("DS/CfgEvolutionUX/CfgEditEvolutionLayout",["DS/CoreEvents/ModelEvents","DS/CfgEvolutionUX/CfgEvolutionController","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgBaseUX/scripts/CfgXMLServices","DS/CfgBaseUX/scripts/CfgData","DS/CfgBaseUX/scripts/CfgCollection","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX","i18n!DS/CfgBaseUX/assets/nls/CfgBaseUX","DS/UIKIT/Spinner","DS/UIKIT/Mask","DS/Utilities/TouchUtils","css!DS/CfgEvolutionUX/CfgEvolutionUX.css"],(function(e,t,i,o,n,s,a,l,r,d,c){"use strict";return{modelListView:null,empty_models:null,updateModelEffectivity:function(){var e=this;e.options.expressionJson=o.EvolutionXMLtoJSONConvertor(e.options.dialogue.effExpressionXml);for(var t=e.options.expressionJson.length,i=0;i<t;i++){var n=e.options.expressionJson[i];e.collection.forEach((function(t){if(t.get("name")==n.expression.name){n.expression.modelId=n.modelId=t.get("id");var i=e.options.emptyContextText;"TRUE"==(i=null==n.displayexpression||null==n.displayexpression||""==n.displayexpression?e.options.emptyContextText:n.displayexpression)?i=l.TRUE:"FALSE"==i&&(i=l.FALSE),t.set("displayexpression",i),t.set("expression",n.expression)}}))}},getAttributeValue:function(e,t){for(var i="",o=0;o<e.length;o++)if(e[o].name==t){null!=(i=e[o].value)&&"undefined"!=i||(i="");break}return i},initModelsWithNoEffectivity:function(){var e=this;e.expressionXml="",e.options.expressionArray=[],this.empty_models=new Array;for(var t=0;t<e.options.modelList.length;t++){var i=e.options.modelList[t],o={marketingName:e.getAttributeValue(i.data,"Marketing Name"),name:e.getAttributeValue(i.basicData,"name"),image:i.preview_url,icon:"",id:i.physicalID,state:e.getAttributeValue(i.basicData,"current"),owner:e.getAttributeValue(i.basicData,"owner"),expression:"",displayexpression:"",selectedDataType:i.type};null!=i.type_icon_large_url&&(o.image=i.type_icon_large_url),null!=i.type_icon_url?o.icon=i.type_icon_url:null!=e.getAttributeValue(i.basicData,"type_icon_url")&&(o.icon=e.getAttributeValue(i.basicData,"type_icon_url"));var n=[];n=JSON.stringify({builds:n});var a={modelId:o.id,psJson:[],mpJson:[],viewJson:null,iDateJson:{DateRanges:[]},iUnitJson:n,xmlExpression:"",iDateXml:"",iUnitXml:"",impXml:"",productstatecheckbox:!0,unitcheckbox:!0,datestatecheckbox:!0,manufacturingplanstatecheckbox:!0,milestoneJson:[],milestoneXml:"",milestoneCheckbox:!0,name:o.name,marketingName:o.marketingName};o.expression=a,e.empty_models.push(o)}e.collection=new s(e.options),e.collection.reset();for(t=0;t<e.empty_models.length;t++)e.collection.addModel(e.empty_models[t])},initEditEvolution:function(){enoviaServerFilterWidget.mode=this.options.environment,enoviaServerFilterWidget.tenant=this.options.tenant;var e=this;i.populateDisplayExpressionXSLT().then((function(i){n.Models=e.options.modelList,e.options.Models=n.Models,e.options.noModelsErrorMessage="",e.options.editActionLabel=a.Edit_Evo_Effectivity,e.options.emptyContextText=a.emptyContextText_Evo_Effectivity,e.initModelsWithNoEffectivity(),1==e.options.dialogue.hasEffectivity&&e.updateModelEffectivity(),e.options.collection=e.collection,t.render(e.options)}))},create:function(t){this.options=t,this.options.displayCompactMode=!(null!=c.getTouchMode()&&0!=c.getTouchMode());var o=this;n.clear(),n._hasFrozenNodeInExpression=!1,n.ModelEvents=new e,o.options.evolutionSpinner=new r({className:"evolutionSpinner"}).inject(o.options.parent),o.options.evolutionSpinner.spin(),o.options.evolutionSpinner.show(),i.checkDecouplingActivation().then((function(e){console.log(e),n.configurationCriteria=e,o.initEditEvolution()}))}}}));