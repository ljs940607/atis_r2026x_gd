define("DS/DMUMeasurable/DMUToolsMaths",["DS/Visualization/ThreeJS_DS"],(function(e){"use strict";var t=.001,i={isZero:function(e){return Math.abs(e)<t},areEqual:function(e,i,n,o){var r=void 0!==o?o:t,a=!0,s=void 0!==n?n:"float";switch(s){case"float":a=Math.abs(e-i)<r;break;case"Vector3":a=Math.abs(e.x-i.x)<r&&Math.abs(e.y-i.y)<r&&Math.abs(e.z-i.z)<r;break;case"Matrix4":for(var l=0;l<16&&a;l++)a=Math.abs(e.elements[l]-i.elements[l])<r;break;default:window.console.log("areEqual used with unknown type: "+s)}return a},isLessOrEqual:function(e,i,n){return e<=i+(void 0!==n?n:t)},isLessThan:function(e,i,n){return e<i+(void 0!==n?n:t)},computeMatrixFromLines:function(t,n,o,r){var a,s,l=n.clone().normalize();return void 0!==o?(s=(new e.Vector3).crossVectors(l,o),a=(new e.Vector3).crossVectors(s,l)):void 0!==r?(a=(new e.Vector3).crossVectors(l,r),s=(new e.Vector3).crossVectors(l,a)):(a=(new e.Vector3).crossVectors(l,new e.Vector3(0,0,1)),i.isZero(a.length())&&(a=(new e.Vector3).crossVectors(l,new e.Vector3(0,1,0))),s=(new e.Vector3).crossVectors(l,a)),new e.Matrix4(l.x,a.x,s.x,t.x,l.y,a.y,s.y,t.y,l.z,a.z,s.z,t.z,0,0,0,1)},computeTransformationBetweenTwoLines:function(t,n,o,r){var a={returnCode:1};if(t&&n&&o&&r){var s=n.clone().normalize(),l=r.clone().normalize(),c=(new e.Matrix4).makeTranslation(-t.x,-t.y,-t.z),u=(new e.Vector3).crossVectors(s,l);i.isZero(u.length())&&(u=(new e.Vector3).crossVectors(s,new e.Vector3(1,0,0)),i.isZero(u.length())&&(u=(new e.Vector3).crossVectors(s,new e.Vector3(0,1,0))));var p=Math.acos(l.dot(s)),d=(new e.Matrix4).makeRotationAxis(u.normalize(),p),m=(new e.Matrix4).makeTranslation(o.x,o.y,o.z).clone().multiply(d).multiply(c);a.returnCode=0,a.transformation=m}return a},quaternionToAxisSystem:function(t){var i={},n=(new e.Matrix4).setRotationFromQuaternion(t.clone()).elements;return i.X=new e.Vector3(n[0],n[1],n[2]),i.Y=new e.Vector3(n[4],n[5],n[6]),i.Z=new e.Vector3(n[8],n[9],n[10]),i.Origin=new e.Vector3(n[12],n[13],n[14]),i}};return i})),define("DS/DMUMeasurable/DMUManipulablePlane",[],(function(){"use strict";var e={State:{STANDARD:0,INEDITION:1},DisplayMode:{PLANE:0,GRID:1},ManipulationAction:{ENABLE:0,BEGIN:1,DO:2,END:3,LONG_HOLD:4},ManipulationType:{TRANSLATION:0,ROTATION:1,RESIZE:2,CENTER:3}};return e})),define("DS/DMUMeasurable/DMUToolsMaterial",["DS/Visualization/ThreeJS_DS","DS/Mesh/Mesh","DS/Visualization/MaterialManager"],(function(e,t,i){"use strict";var n,o={createBasicMaterial:function(t){return new e.MeshBasicMaterial({color:!t.color||isNaN(t.color.r)||isNaN(t.color.g)||isNaN(t.color.b)?t.color?new e.Color(t.color):new e.Color:t.color,side:e.DoubleSide,transparent:!0,opacity:t.opacity||0===t.opacity?t.opacity:1,force:!0})},getDashType:function(e){var i=e;return isNaN(i)&&i.toUpperCase?(i=i.toUpperCase(),i={SOLID:t.LinePatternEnum.SOLID,DOTTED:t.LinePatternEnum.DOTTED,DASHED:t.LinePatternEnum.DASHED,DOT_DASHED:t.LinePatternEnum.DOTDASHED,PHANTOM:t.LinePatternEnum.PHANTOM,SMALL_DOT:t.LinePatternEnum.SMALLDOTTED,JIS_AXIS:t.LinePatternEnum.JISAXIS}[i]):i=parseFloat(i),i},createLineMaterial:function(t){return new e.LineBasicMaterial({color:!t.color||isNaN(t.color.r)||isNaN(t.color.g)||isNaN(t.color.b)?t.color?new e.Color(t.color):new e.Color:t.color,lineWidth:isNaN(t.lineWidth)?1:t.lineWidth,opacity:"number"==typeof t.opacity?t.opacity:1,transparent:!0,force:!0,dashType:o.getDashType(t.pattern),isCPUPattern:!0,polygonBorderMode:!0})},retrieveMaterialFromGAS:function(e){if(n||(n=new i),e.lineWidth||e.pattern)return o.createLineMaterial(e);if(e.symbol)return n.createPointMaterial(e);var t=n.getMaterialFromGAS({color:e.color,opacity:"number"==typeof e.opacity?e.opacity:1,transparent:!0,pattern:e.pattern,isCPUPattern:!0,polygonBorderMode:!0,size:e.size});return t&&(t.force=!0),t}};return o})),define("DS/DMUMeasurable/DMUMeshCreation",["DS/Visualization/ThreeJS_DS","DS/Mesh/MeshUtils"],(function(e,t){"use strict";var i={createPolylines:function(e,i,n,o){var r,a,s,l,c=new t.PrimitiveGroup,u=new t.Color(i[0].r,i[0].g,i[0].b,1);c.fillAttr=new t.FillAttributes,c.lineAttr=new t.LineAttributes(u,n,o),c.pointAttr=new t.PointAttributes;var p=0,d=e.length;for(a=0;a<d;a++)for(s=(r=e[a]).length,l=0;l<s;l++)p+=r[l].length;var m,y=new t.Buffer;y.size=3*p,y.component=t.VertexComponentEnum.POSITION,y.format=t.DataTypeEnum.FLOAT,y.dimension=3,y.data=new Float32Array(y.size);var h=y.data,g=0;for(a=0;a<d;a++)for(s=(r=e[a]).length,l=0;l<s;l++){p=(m=r[l]).length;for(var P=0;P<p;P++){var f=m[P];h[g]=f[0],h[g+1]=f[1],h[g+2]=f[2],g+=3}}c.addBuffer(0,y);var T=0;for(a=0;a<d;a++)for(r=e[a],u=new t.Color(i[a].r,i[a].g,i[a].b,1),s=r.length,l=0;l<s;l++){p=(m=r[l]).length;var v=new t.Primitive;v.nbIndices=p,v.connectivity=t.ConnectivityTypeEnum.LINE_STRIP,v.attr={fill:new t.FillAttributes(u),line:new t.LineAttributes(u,n,o),point:new t.PointAttributes};var C=new t.VertexComponent;C.component=t.VertexComponentEnum.POSITION,C.nbVertices=p,C.nbValuesPerVertex=3,C.format=t.DataTypeEnum.FLOAT,C.cardinality=0,C.bufferId=0,C.offset=T,T+=p,v.addVertexComponent(C),c.addPrimitive(v)}return c},createRectangle:function(e,t,n,o,r,a){var s=[],l=0;s[l++]=0,s[l++]=0,s[l++]=0,s[l++]=e,s[l++]=0,s[l++]=0,s[l++]=e,s[l++]=t,s[l++]=0,s[l++]=0,s[l++]=t,s[l++]=0;var c=[];c[0]=0,c[1]=0,c[2]=1;var u=[];return u[l++]=0,u[l++]=1,u[l++]=1,u[l++]=0,i.createPlanarPolygon(s,c,u,!1,n,o,r,a)},createPlanarPolygon:function(e,i,n,o,r,a,s,l){var c=e.length/3,u=r?c+1:0,p=s?c:0,d=o?t.ConnectivityTypeEnum.TRIANGLE_STRIP:t.ConnectivityTypeEnum.TRIANGLE_FAN,m=void 0!==l?l:new t.Color(.5,.5,.5,1),y=void 0!==a?a:new t.Color(.5,.5,.5,1),h=new t.PrimitiveGroup;h.fillAttr=new t.FillAttributes,h.lineAttr=new t.LineAttributes,h.pointAttr=new t.PointAttributes;var g=new t.Buffer;g.size=3*c,g.component=t.VertexComponentEnum.POSITION,g.format=t.DataTypeEnum.FLOAT,g.dimension=3,g.data=new Float32Array(g.size);var P=new t.Buffer;P.size=3,P.component=t.VertexComponentEnum.NORMAL,P.format=t.DataTypeEnum.FLOAT,P.dimension=3,P.data=new Float32Array(P.size);var f=new t.Buffer;f.size=6,f.component=t.VertexComponentEnum.TEX_COORD_0,f.format=t.DataTypeEnum.FLOAT,f.dimension=3,f.data=new Float32Array(f.size);var T=new t.Buffer;T.indexBuffer=!0,T.size=u+p,T.format=t.DataTypeEnum.UINT,T.dimension=1,T.data=new Uint16Array(T.size);var v=new t.Buffer;v.indexBuffer=!0,v.size=p,v.format=t.DataTypeEnum.UINT,v.dimension=1,v.data=new Uint16Array(v.size);var C=new t.Buffer;C.indexBuffer=!0,C.size=u+p,C.format=t.DataTypeEnum.UINT,C.dimension=1,C.data=new Uint16Array(C.size);h.addBuffer(0,g),h.addBuffer(1,P),h.addBuffer(2,T),h.addBuffer(3,v),h.addBuffer(4,f),h.addBuffer(5,C);var M=T.data,D=0,E=0;if(r){for(E=0;E<c;E++)M[D++]=E;M[D++]=0}if(s)for(E=0;E<c;E++)M[D++]=E;if(M=v.data,D=0,s)for(E=0;E<c;E++)M[D++]=0;if(M=C.data,D=0,s)for(E=0;E<c;E++)M[D++]=n[E];for(M=g.data,D=0;D<3*c;D++)M[D]=e[D];if(D=0,(M=P.data)[D++]=i[0],M[D++]=i[1],M[D++]=i[2],D=0,(M=f.data)[D++]=0,M[D++]=0,M[D++]=0,M[D++]=1,M[D++]=0,M[D++]=0,r){var A=new t.Primitive;A.nbIndices=c+1,A.connectivity=t.ConnectivityTypeEnum.LINE_STRIP,A.attr={fill:new t.FillAttributes(y),line:new t.LineAttributes(y),point:new t.PointAttributes};var _=new t.VertexComponent;_.component=t.VertexComponentEnum.POSITION,_.nbVertices=c,_.nbValuesPerVertex=3,_.format=t.DataTypeEnum.FLOAT,_.cardinality=0,_.bufferId=0,_.indices=new t.IndexArray,_.indices.format=t.DataTypeEnum.UINT,_.indices.bufferId=2,_.indices.offset=0,A.addVertexComponent(_),h.addPrimitive(A)}if(s){var S=new t.Primitive;S.nbIndices=c,S.connectivity=d,S.attr={fill:new t.FillAttributes(m),line:new t.LineAttributes,point:new t.PointAttributes};var b=new t.VertexComponent;b.component=t.VertexComponentEnum.POSITION,b.nbVertices=c,b.nbValuesPerVertex=3,b.format=t.DataTypeEnum.FLOAT,b.cardinality=0,b.bufferId=0,b.indices=new t.IndexArray,b.indices.format=t.DataTypeEnum.UINT,b.indices.bufferId=2,b.indices.offset=u;var N=new t.VertexComponent;N.component=t.VertexComponentEnum.NORMAL,N.nbVertices=1,N.nbValuesPerVertex=3,N.format=t.DataTypeEnum.FLOAT,N.cardinality=0,N.bufferId=1,N.indices=new t.IndexArray,N.indices.format=t.DataTypeEnum.UINT,N.indices.bufferId=3,N.indices.offset=0;var I=new t.VertexComponent;I.component=t.VertexComponentEnum.TEX_COORD_0,I.nbVertices=2,I.nbValuesPerVertex=3,I.format=t.DataTypeEnum.FLOAT,I.cardinality=0,I.bufferId=4,I.indices=new t.IndexArray,I.indices.format=t.DataTypeEnum.UINT,I.indices.bufferId=5,I.indices.offset=0,S.addVertexComponent(b),S.addVertexComponent(N),S.addVertexComponent(I),h.addPrimitive(S)}return h},_computeTotalLength:function(e){var t=[];if(e.length>0){t.push(0);for(var i=0,n=1;n<e.length;n++)i+=e[n-1].distanceTo(e[n]),t.push(i)}return t},_intersection:function(t,i,n){var o=((t.x-n.x)*i.x-(n.y-t.y)*i.y)/(-i.x*i.x-i.y*i.y);return new e.Vector2(t.x+o*i.x,t.y+o*i.y)},boundingBoxCompute:function(t){var i,n=Number.MAX_VALUE,o=[],r=[],a=0,s=0,l=0,c=0;for(i=0;i<t.length;i++)r.push(t[(i+1)%t.length].clone().sub(t[i]).normalize()),t[i].x<t[a].x&&(a=i),t[i].x>t[s].x&&(s=i),t[i].y<t[c].y&&(c=i),t[i].y>t[l].y&&(l=i);var u=new e.Vector2(-1,0),p=new e.Vector2(0,-1);for(i=0;i<t.length;i++){var d=[p.dot(r[a]),-p.dot(r[s]),u.dot(r[l]),-u.dot(r[c])];switch(d.indexOf(Math.max.apply(Math,d))){case 0:(u=r[a].clone()).set(u.y,-u.x),a=(a+1)%t.length;break;case 1:(u=r[s].clone().negate()).set(u.y,-u.x),s=(s+1)%t.length;break;case 2:u=r[l].clone(),l=(l+1)%t.length;break;case 3:u=r[c].clone().negate(),c=(c+1)%t.length}(p=u.clone().negate()).set(p.y,-p.x);var m=this._intersection(t[a],p,t[l]),y=this._intersection(t[s],p,t[l]),h=this._intersection(t[c],u,t[a]),g=this._intersection(t[c],u,t[s]),P=m.distanceTo(h),f=m.distanceTo(y),T=f*P;T<n&&(o=[m,h,g,y,f,P],n=T)}return o}};return i})),define("DS/DMUMeasurable/DMUMeasureEnums",[],(function(){"use strict";var e={REVISION:"1",ResultType:{POINT:0,PICKINGPT:1,CENTER:2,CURVE:3,LINE:4,AXIS:5,CIRCLE:6,SURFACE:7,PLANE:8,CYLINDER:9,CONE:10,SPHERE:11,PRODUCT:12},ViewedType:{POINT:0,CENTER:1,AXIS:2,CURVE:3,INFPLANE:4,SURFACE:5,PRODUCT:6,CIRCLE:7,CYCOSP:8},RadiusResultDisplayType:{CENTER:0,TANGENT:1}};return e})),define("DS/DMUMeasurable/DMUGeometryEnums",[],(function(){"use strict";var e={REVISION:"1",GeometryType:{POINT:0,PICKINGPT:1,CURVE:2,LINE:3,CIRCLE:4,SURFACE:5,PLANE:6,CYLINDER:7,CONE:8,SPHERE:9,PRODUCT:10,AXISSYSTEM:11},Relationship:{NONE:0,COINCIDENT:1,PARRALLEL:2,INTERSECTING:3},Mode:{EXACT:0,FACETTED:1}};return e})),define("DS/DMUMeasurable/DMUMathsVector3D",[],(function(){"use strict";var e=.001,t=1e-6;return{modifyEpsilon:function(i){var n=e;return i>0&&(e=i,t=i*i),n},isNull:function(t){return Math.abs(t[0])<e&&Math.abs(t[1])<e&&Math.abs(t[2])<e},clone:function(e){var t=[];return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},length:function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])},squaredLength:function(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]},normalize:function(e,i){var n,o=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(Math.abs(o-1)<t)(n=i||[0,0,0])[0]=e[0],n[1]=e[1],n[2]=e[2];else if(o>t){var r=Math.sqrt(o);(n=i||[0,0,0])[0]=e[0]/r,n[1]=e[1]/r,n[2]=e[2]/r}return n},multiply:function(e,t,i){var n=i||[0,0,0];return n[0]=t*e[0],n[1]=t*e[1],n[2]=t*e[2],n},areEqual:function(t,i){return Math.abs(i[0]-t[0])<e&&Math.abs(i[1]-t[1])<e&&Math.abs(i[2]-t[2])<e},add:function(e,t,i){var n=i||[0,0,0];return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n},sub:function(e,t,i){var n=i||[0,0,0];return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n},angle:function(t,i){var n,o=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),r=Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);if(o>e&&r>e){var a=(t[0]*i[0]+t[1]*i[1]+t[2]*i[2])/(o*r);n=Math.acos(Math.min(Math.max(a,-1),1))}return n},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},cross:function(e,t,i){var n=i||[0,0,0],o=e[0],r=e[1],a=e[2],s=t[0],l=t[1],c=t[2];return n[0]=r*c-a*l,n[1]=a*s-o*c,n[2]=o*l-r*s,n},subAndLength:function(e,t,i){var n=i||[0,0,0];return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2])},subAndSquaredLength:function(e,t,i){var n=i||[0,0,0];return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n[0]*n[0]+n[1]*n[1]+n[2]*n[2]},multiplyAndAdd:function(e,t,i,n){var o=n||[0,0,0];return o[0]=e[0]*t+i[0],o[1]=e[1]*t+i[1],o[2]=e[2]*t+i[2],o},isIdentity:function(t){return Math.abs(t[0]-1)<e&&Math.abs(t[1])<e&&Math.abs(t[2])<e&&Math.abs(t[3])<e&&Math.abs(t[4])<e&&Math.abs(t[5]-1)<e&&Math.abs(t[6])<e&&Math.abs(t[7])<e&&Math.abs(t[8])<e&&Math.abs(t[9])<e&&Math.abs(t[10]-1)<e&&Math.abs(t[11])<e&&Math.abs(t[12])<e&&Math.abs(t[13])<e&&Math.abs(t[14])<e&&Math.abs(t[15]-1)<e},areMatrixEqual:function(t,i){return Math.abs(t[0]-i[0])<e&&Math.abs(t[1]-i[1])<e&&Math.abs(t[2]-i[2])<e&&Math.abs(t[3]-i[3])<e&&Math.abs(t[4]-i[4])<e&&Math.abs(t[5]-i[5])<e&&Math.abs(t[6]-i[6])<e&&Math.abs(t[7]-i[7])<e&&Math.abs(t[8]-i[8])<e&&Math.abs(t[9]-i[9])<e&&Math.abs(t[10]-i[10])<e&&Math.abs(t[11]-i[11])<e&&Math.abs(t[12]-i[12])<e&&Math.abs(t[13]-i[13])<e&&Math.abs(t[14]-i[14])<e&&Math.abs(t[15]-i[15])<e},transformVector:function(e,t,i){var n=i||[0,0,0],o=e[0],r=e[1],a=e[2];return n[0]=t[0]*o+t[4]*r+t[8]*a,n[1]=t[1]*o+t[5]*r+t[9]*a,n[2]=t[2]*o+t[6]*r+t[10]*a,n},transformPoint:function(e,t,i){var n=i||[0,0,0],o=e[0],r=e[1],a=e[2];return n[0]=t[0]*o+t[4]*r+t[8]*a+t[12],n[1]=t[1]*o+t[5]*r+t[9]*a+t[13],n[2]=t[2]*o+t[6]*r+t[10]*a+t[14],n}}})),define("DS/DMUMeasurable/DMUManipulableClippingPlane",["DS/Visualization/Node3D","DS/DMUMeasurable/DMUMeshCreation","DS/Visualization/ThreeJS_DS","DS/Visualization/SceneGraphFactory","DS/Mesh/MeshUtils","DS/Manipulators/LineTranslationManipulator"],(function(e,t,i,n,o,r){"use strict";var a=e.extend({init:function(t){return this._parent(),this._viewer=t.viewer,this._frameWindow=t.frameWindow,this._bTranslationManipulator=!!t.bTranslationManipulator&&t.bTranslationManipulator,this._sType=t.sType,this._CBGetState=t.getState?t.getState:this.getState,this._CBGetShowState=t.getState?t.getShowState:this.getShowState,this._CBGetGeometry=t.getGeometry?t.getGeometry:this.getGeometry,this.updateClippingRep=t.setGeometry?t.setGeometry:this.setGeometry,this._CBGetDisplayInformation=t.getDisplayInformation?t.getDisplayInformation:this.getDisplayInformation,this._CBManipulationInformation=t.getManipulationInformation?t.getManipulationInformation:this.getManipulationInformation,this._appType=t.appType,this._context=t.context,this.initRobot=t.initRobotCB,this.getRobot=t.getRobotCB,this._ruler=t.ruler,this.storeyMode=t.storeyMode,this._mMaterial=new i.MeshBasicMaterial({side:i.DoubleSide,enableClipPlanes:!1,depthWrite:!1}),this._mMaterial.force=!0,this._nCenterPlaneNode=new e,this._nCenterPlaneNode._getExcludeFromCSO=function(){return!0},this.addChild(this._nCenterPlaneNode),this._bVisuNotBuild=!0,this._addManipulators(),this._fPreviousPlaneUSize=0,this._fPreviousPlaneVSize=0,this._cPreviousColor=0,this._fPreviousOpacitUSide=0,this._sPreviousDisplayPlaneMode=0,this.update(),this},setName:function(e){this._nCenterPlaneNode.name=e,this._nCenterPlaneSubNode.name=e},clean:function(){},clearRuler:function(){this._ruler&&this._ruler.clear()},setRobot:function(e){this._robotWihtRuler=e},setPickingInManipulationModeForLineTraslation:function(e){this._nCenterPlaneNode&&this._nCenterPlaneNode.manipulator&&(this._nCenterPlaneNode.manipulator.getPickingInManipulation()!==e&&this._nCenterPlaneNode.manipulator.setPickingInManipulation(e))},update:function(){var e=this._CBGetDisplayInformation();return this._mMaterial.color=e.fillColor,this._mMaterial.opacity=e.opacity,this._mMaterial.ambient=e.fillColor,this._rebuildPlaneSubNodes(),this._updateManipulators(),this._bVisuNotBuild=!1,this},_updateManipulators:function(){this._bTranslationManipulator&&(this._nCenterPlaneNode.manipulator.axis=this._getNormal())},getState:function(){return a.State.STANDARD},getShowState:function(){return!0},getGeometry:function(){return{referential:new i.Matrix4,uSize:1e3,vSize:1e3}},setGeometry:function(){},getDisplayInformation:function(){return{mode:a.DisplayMode.PLANE,fillColor:new i.Color(7979230),opacity:.2}},getManipulationInformation:function(){return!0},_getNormal:function(){var e=this._CBGetGeometry(this._sType).referential.decompose();return new i.Vector3(0,0,1).applyQuaternion(e[1])},_getUDirection:function(){var e=this._CBGetGeometry(this._sType).referential.decompose();return new i.Vector3(1,0,0).applyQuaternion(e[1])},_getVDirection:function(){var e=this._CBGetGeometry(this._sType).referential.decompose();return new i.Vector3(0,1,0).applyQuaternion(e[1])},_isPlaneSubNodesNeedRebuild:function(){var e=!this._bVisuNotBuild;if(e){var t=this._CBGetGeometry(this._sType);e=(e=e&&this._fPreviousPlaneUSize===t.uSize)&&this._fPreviousPlaneVSize===t.vSize;var i=this._CBGetDisplayInformation();e=(e=(e=e&&this._cPreviousColor===i.fillColor)&&this._fPreviousOpacity===i.opacity)&&this._sPreviousDisplayPlaneMode===i.mode}return!e},_recordPlaneData:function(){var e=this._CBGetGeometry(this._sType);this._fPreviousPlaneUSize=e.uSize,this._fPreviousPlaneVSize=e.vSize;var t=this._CBGetDisplayInformation();this._cPreviousColor=t.fillColor,this._fPreviousOpacity=t.opacity,this._sPreviousDisplayPlaneMode=t.mode},_setPlaneVisibility:function(e){0===this._viewer.getVisibleSpace()&&(e=!e),this._nCenterPlaneNode.setVisibility(e)},_rebuildPlaneSubNodes:function(){var e=!1;return this._isPlaneSubNodesNeedRebuild()&&(this._recordPlaneData(),this._rebuildCenterSubNode(),e=!0),e},_rebuildCenterSubNode:function(){var r,s,l=this._CBGetDisplayInformation(),c=this._CBGetGeometry(this._sType),u=c.uSize,p=c.vSize,d=u/2,m=p/2;if(this._nCenterPlaneNode.manipulator&&this._nCenterPlaneNode.manipulator.deactivate(this._nCenterPlaneNode.token),null!==this._nCenterPlaneSubNode&&this._nCenterPlaneNode.remove(this._nCenterPlaneSubNode),l.mode===a.DisplayMode.PLANE)r=t.createRectangle(u,p,!1,void 0,!0,l.fillColor),this._nCenterPlaneSubNode=n.createMeshNode(r,this._mMaterial),this._nCenterPlaneSubNode.excludeFromCSO(!0),this._nCenterPlaneSubNode.excludeFromHighlight(!0,!1),this._nCenterPlaneSubNode.setShadow(!1),this._nCenterPlaneSubNode.setMatrix((new i.Matrix4).translate(new i.Vector3(-d,-m,0)));else if(l.mode===a.DisplayMode.GRID){this._nCenterPlaneSubNode=new e;var y=c.uStep,h=c.vStep;y||(y=u/10),h||(h=p/10);for(var g,P=Math.floor(d/y),f=Math.floor(m/h),T=new o.Color(l.fillColor.r,l.fillColor.g,l.fillColor.b,1),v=-P;v<=P;v++){g=y*v;var C=[new i.Vector3(g,m),new i.Vector3(g,-m)];(s=n.createLineNode({points:C,color:T})).excludeFromHighlight(!0,!1),s.setShadow(!1),this._nCenterPlaneSubNode.addChild(s)}for(var M=-f;M<=f;M++){g=h*M;var D=[new i.Vector3(d,g),new i.Vector3(-d,g)];(s=n.createLineNode({points:D,color:T})).excludeFromHighlight(!0,!1),s.setShadow(!1),this._nCenterPlaneSubNode.addChild(s)}}this._nCenterPlaneNode.addChild(this._nCenterPlaneSubNode),this._nCenterPlaneNode.manipulator&&this._nCenterPlaneNode.manipulator.activate(this._nCenterPlaneNode.token)},_addManipulators:function(){this._bTranslationManipulator&&this._addTranslator()},_onTranslatorManipulationBeginCB:function(e){if(this._CBManipulationInformation({action:a.ManipulationAction.ENABLE,type:a.ManipulationType.TRANSLATION,evt:e.event})){var t=this._CBGetGeometry(this._sType);this._vInitialCenter=(new i.Vector3).getPositionFromMatrix(t.referential);var n=this._ruler;n||(this._robotWihtRuler||this._sType||(this.initRobot(),this.getRobot&&(this._robotWihtRuler=this.getRobot())),n=this._robotWihtRuler),n&&n.updateOnTranslationBegin(e),this._CBManipulationInformation({action:a.ManipulationAction.BEGIN,type:a.ManipulationType.TRANSLATION,evt:e.event})}},_onTranslatorManipulationCB:function(e){if(this._CBManipulationInformation({action:a.ManipulationAction.ENABLE,type:a.ManipulationType.TRANSLATION,evt:e.event})){var t=e.translationVector,n=this._ruler;if(n||(this._robotWihtRuler||this._sType||(this.initRobot(),this.getRobot&&(this._robotWihtRuler=this.getRobot())),n=this._robotWihtRuler),n&&n.snapTranslationCallback){var o=n.snapTranslationCallback({translationVector:e.translationVector});o&&(t=o)}else this._ruler&&this._ruler.updateOnTranslationBegin(e);if(!this._vInitialCenter){var r=this._CBGetGeometry(this._sType);this._vInitialCenter=(new i.Vector3).getPositionFromMatrix(r.referential)}var s=this._vInitialCenter.clone().add(t).clone();this.updateClippingRep({newCenter:s,from:this._sType,UpdateRobotpos:!0}),n&&n.updateOnTranslation({translationVector:t,manipulator:e.manipulator,intersection:e.intersection}),this._CBManipulationInformation({action:a.ManipulationAction.DO,type:a.ManipulationType.TRANSLATION,evt:e.event})}},_onTranslatorManipulationEndCB:function(e){if(this._CBManipulationInformation({action:a.ManipulationAction.ENABLE,type:a.ManipulationType.TRANSLATION,evt:e.event})){this._vInitialCenter=void 0;var t=this._robotWihtRuler;t||(t=this._ruler),t&&t.updateOnTranslationEnd(e)}this._CBManipulationInformation({action:a.ManipulationAction.END,type:a.ManipulationType.TRANSLATION,evt:e.event})},_onTranslatorManipulationLongHoldCB:function(e){this._CBManipulationInformation({action:a.ManipulationAction.LONG_HOLD,type:a.ManipulationType.TRANSLATION,evt:e.event})},_addTranslator:function(){this._nCenterPlaneNode.manipulator=new r({axis:this._getNormal()}),this._nCenterPlaneNode.manipulator.setExclusive(!0),this._nCenterPlaneNode.manipulator.setPickingPriority(!1),this._nCenterPlaneNode.manipulator.setPickingDuringManipulation(!1),this._nCenterPlaneNode.manipulator.setPrePickingDuringManipulation(!1),this._nCenterPlaneNode.manipulator.setPreActivationDuringManipulation(!1),this._nCenterPlaneNode.manipulator.setPickingInManipulation(!0),this._nCenterPlaneNode.token=this._nCenterPlaneNode.manipulator.linkToNode(this._nCenterPlaneNode);var e=this;this._nCenterPlaneNode.manipulator.subscribe("BeginManipulate",(function(t){e._onTranslatorManipulationBeginCB(t)})),this._nCenterPlaneNode.manipulator.subscribe("Manipulate",(function(t){e._onTranslatorManipulationCB(t)})),this._nCenterPlaneNode.manipulator.subscribe("EndManipulate",(function(t){e._onTranslatorManipulationEndCB(t)})),this._nCenterPlaneNode.manipulator.HandleLongHold=function(t){e._onTranslatorManipulationLongHoldCB(t)}},updateRobotPos:function(e){this._robotWihtRuler&&this._robotWihtRuler.updateRobotPos(e)},setRulerOrigin:function(e){this._ruler&&this._ruler.setOrigin&&this._ruler.setOrigin(e)}});return a.State={STANDARD:0,INEDITION:1},a.DisplayMode={PLANE:0,GRID:1},a.ManipulationAction={ENABLE:0,BEGIN:1,DO:2,END:3,LONG_HOLD:4},a.ManipulationType={TRANSLATION:0,ROTATION:1,RESIZE:2,CENTER:3},a})),define("DS/DMUMeasurable/DMUToolsSceneGraph",["DS/Visualization/PathElement","DS/SceneGraphOverrides/SceneGraphOverrideSet","DS/Visualization/IdPath","DS/Visualization/IdPathMatcher","DS/Visualization/SceneGraphUtils","DS/Visualization/ThreeJS_DS","DS/DMUMeasurable/DMUToolsMaths"],(function(e,t,i,n,o,r,a){"use strict";var s=void 0,l={callPad3DViewerModelServices:function(e,t){return s||(s=require("DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices")),s&&e&&s[e]?s[e](t):void 0},isReference:function(e){var t=!1;return e&&((t=l.callPad3DViewerModelServices("isReference",e))||(t=void 0!==e.productType?"Reference3D"===e.productType||"ReferenceRep"===e.productType:t),t||(t=void 0!==e.isPLMReference?e.isPLMReference():t)),t},isRepReference:function(e){var t=!1;return e&&((t=l.callPad3DViewerModelServices("isRepReference",e))||(t=void 0!==e.productType?"RepReference3D"===e.productType||"ReferenceRep"===e.productType:t),t||(t=void 0!==e.isPLMRepReference?e.isPLMRepReference():t)),t},isRepInstance:function(e){var t=!1;return e&&((t=l.callPad3DViewerModelServices("isRepInstance",e))||(t=void 0!==e.productType?"RepInstance3D"===e.productType||"InstanceRep"===e.productType:t),t||(t=void 0!==e.isPLMRepInstance?e.isPLMRepInstance():t)),t},isInstance:function(e){var t=!1;return e&&((t=l.callPad3DViewerModelServices("isInstance",e))||(t=void 0!==e.productType?"Instance3D"===e.productType||"InstanceRep"===e.productType:t),t||(t=void 0!==e.isPLMInstance?e.isPLMInstance():t)),t},isReferenceOrInstance:function(e,t){var i=l.isReference(e);return i||(i=l.isInstance(e)),i||(i=l.isRepInstance(e)),!i&&t&&(i=l.isRepReference(e)),i},isLeaf:function(e,t){var i=!0;if(t&&l.isPLMNode(e))(i=l.is3DLeaf(e))||(i=l.isRepReference(e));else if(e){for(var n=!1,o=0;o<e.children.length;o++)if(l.isReferenceOrInstance(e.children[o],t)){n=!0;break}i=!n}return i},is3DLeaf:function(e){var t=l.callPad3DViewerModelServices("is3DLeaf",e);return!t&&e&&e.is3DLeaf&&(t=e.is3DLeaf()),t},isPLMNode:function(e,t){var i=l.callPad3DViewerModelServices("isPLMNode",e);return i||t||(i=l.isReferenceOrInstance(e,!0)),i},isAModelPath:function(e){return l.callPad3DViewerModelServices("isAModelPath",e)},isAPOIPath:function(e){return l.callPad3DViewerModelServices("isAPOIPath",e)},getPOILayerId:function(e){return l.callPad3DViewerModelServices("getPOILayerId",e)},getNodeType:function(e){var t=l.callPad3DViewerModelServices("getNodeType",e);return!t&&e&&e.getType&&(t=e.getType()),t},getI3DXPath:function(e){var t=[];return e&&e.externalPath.forEach((function(e){if("RootBag"!==e.name){var i=l.getNodeI3DX(e);t.push(i)}})),t},getNodeI3DX:function(e){var t=l.callPad3DViewerModelServices("getNodeI3DX",e);return!t&&e&&e.getNodeI3DX&&(t=e.getNodeI3DX()),t},getNodeID:function(e){var t=l.callPad3DViewerModelServices("getNodeID",e);return t||(t=e&&"string"==typeof e.persistentId?e.persistentId:t),t||(t=e&&e.getID?e.getID():t),"string"==typeof t?t:""},isVisible:function(e,t){var i=!1;if(t&&e){var n=e.getSceneGraphOverrideSetManager().getCurrentVisibility(t);i=null==n||n}return i},getMaterialsFromPath:function(e,t){e.getRootNode()._tryOverridesUpdate(e);var i=t._getUniqueOccurrence(),n=null,r=null,a=null;return i&&(r=[],o._traversePathMaterials(i,(function(e){r.indexOf(e)<0&&r.push(e)}),(function(){}),null,!1),i.overrideLink&&(a={color:i.overrideLink.getColor(),opacity:i.overrideLink.getOpacity(3),material:i.overrideLink.getFullMaterial()}),n={materials:r,overrides:a}),n},parseForLeafNodes:function(e,t,i,n,o){if(e&&t){var r=e.clone(),a=r.getChildrenPathes(),s=r.getLastElement(!0);if(l.isLeaf(s,!0)||l.isOOCTileSetNode(s,!0)||0===a.length)if(l.isVisible(t,r)){if(i){let n=!0;if(o){var c=l.getMaterialsFromPath(t,e);c&&c.overrides&&0===c.overrides.opacity&&(n=!1)}n&&i.push(r)}}else n&&n.push(r);else for(var u=0;u<a.length;u++)l.isReferenceOrInstance(a[u].getLastElement(!0),!0)&&(l.isVisible(t,a[u])?l.parseForLeafNodes(a[u],t,i,n,o):n&&n.push(a[u].clone()))}},parseForLeafNodesOfScene:function(e,t,i,n){for(var o=e?e.getRootBagPath().getChildrenPathes():[],r=0;r<o.length;r++)l.parseForLeafNodes(o[r],e.getViewer(),t,i,n)},getName:function(e,t,i,n){var o=n||"";if(e&&t){var r,a=[],s=[],c=!0,u=e.length;for(r=0;r<u;r++){var p=e[r],d=l.callPad3DViewerModelServices("getNodeID",p);d?(c=!1,(l.isInstance(p)||l.isRepInstance(p))&&(p=p.children[0]),s.push(d),a.push(o)):a.push(p.name)}if(t(a),!c){var m=[];for(r=0;r<s.length;r++){for(var y=!1,h=0;!y&&h<r;h++)y=s[r]===s[h];y||m.push(s[r])}var g=i.getController(),P="ds6w:label";g.getAttributes({ids:m,attributes:[P],callbacks:{onComplete:function(e){for(a=[],r=0;r<s.length;r++){var i=e[s[r]];a.push(i[P])}t(a)},onFailure:function(){return null}}})}}},getNameWithInstances:function(e,t,i,n){return l.getRefInstNames({path:e,callback:t,context:i,pathNum:n,fromNode:!1})},getRefInstNames:function(e){var t=e.pathNum;if(e.path&&e.callback){var i,n=[],o={},r=e.path;if(r){var a=l.getLastReference(r),s=a.getLastElement(!0);if(l.isPLMNode(s)&&(l.isReference(s)||l.is3DLeaf(s))){i={pathElement:r,idRef:l.getNodeID(s)},n.push(i.idRef),o[i.idRef]=s;var c=l.getLastInstance(a).getLastElement(!0);l.isPLMNode(c)&&l.isInstance(c)&&(n.push(i.idInst=l.getNodeID(c)),o[i.idInst]=c)}}if(!n.length)return;if(e.context&&!e.fromNode){e.context.getController().getAttributes({ids:n,attributes:["ds6w:label"],callbacks:{onComplete:function(n){var o=n[i.idRef]?n[i.idRef]["ds6w:label"]:"";i.idInst&&n[i.idInst]&&n[i.idInst]["ds6w:label"]&&(o+=" ("+n[i.idInst]["ds6w:label"]+")"),e.callback({name:o,forPathNum:t})},onFailure:function(){return null}}})}else if(e.fromNode){var u=o[i.idRef]&&o[i.idRef].getName?o[i.idRef].getName():"";i.idInst&&o[i.idInst]&&o[i.idInst].getName&&(u+=" ("+o[i.idInst].getName()+")"),e.callback({name:u,forPathNum:t})}}},getRoots:function(e){var t=l.callPad3DViewerModelServices("getRoots",e);return void 0===t&&e.getRoots&&(t=e.getRoots()),t},getRootReferences:function(e,t){var i=[];return function e(t,i,n){if(l.isReference(t)||l.isRepReference(t))i.push(t);else if(!n&&l.isOOCTileSetNode(t))i.includes(t)||i.push(t);else for(var o=t.children,r=o.length,a=0;a<r;a++)e(o[a],i,n)}(e.getRootNode(),i,t),i},getSceneRoot:function(e){return e.getRootNode()},getRootBag:function(e){var t=require("DS/PADUtils/PADContext").get();return t&&t.getViewer()===e?t.getRootBagPath().getElement(0):e.getRootNode().getChildByName("RootBag")},getFirstReference:function(t){for(var i=new e,n=t.getLength(),o=0;o<n;o++){var r=t.getElement(o);if(l.isReference(r)||l.isRepReference(r)){i.addElement(r);break}}return i},getLastReference:function(t){return t.getLength()>1?l.isReference(t.getLastElement(!0))?t.clone():l.getLastReference(t.getParentPath()):new e},getLastRepReference:function(t){return t.getLength()>1?l.isRepReference(t.getLastElement(!0))?t.clone():l.getLastRepReference(t.getParentPath()):new e},getLastInstance:function(t){return t.getLength()>1?l.isInstance(t.getLastElement(!0))||l.isRepInstance(t.getLastElement(!0))?t.clone():l.getLastInstance(t.getParentPath()):new e},truncatePathElement:function(t,i){for(var n=new e,o=Math.min(t.getLength(),i),r=0;r<o;r++)n.addElement(t.getElement(r));return n},buildPathElement:function(t){for(var i=[],n=t;n&&!n.notAllowedInPathElement;)i.unshift(n),n=n.parents[0];return new e(i)},isDescendant:function(e,t){var i=!1,n=e.getLength();if(t.getLength()>=n){i=!0;for(var o=0;i&&o<n;o++)i=t.getElement(o)===e.getElement(o)}return i},getRenderables:function(e){return e._getRenderableOccurrences()},getRootBagId:function(){var e=require("DS/PADUtils/PADContext").get();return e&&e.getController()&&e.getController().getRootBagId?e.getController().getRootBagId():"rootBag"},getContextViewer:function(e){var t=require("DS/PADUtils/PADContext").get();return t&&t.getViewer()===e.viewer?t:null},initIdPathMatcher:function(e){var t=function(e,i){if(l.getNodeID(i)===e)return i;var n,o=i.children;if(o&&o.length)for(var r=0;r<o.length;r++)if(n=t(e,o[r]))return n};e.setIdPathMatcher(new n({idToNodeCB:function(i){var n=require("DS/PADUtils/PADContext").get();if(n)return i===l.getRootBagId()?l.getRootBag(e):n&&n.getController().getNode({id:i})?n.getController().getNode({id:i}):t(i,l.getRootBag(e))},nodeToIdCB:function(t){return t===l.getRootBag(e)?l.getRootBagId():l.getNodeID(t)},isNodeRepRefCB:function(t){return t!==l.getRootBag(e)&&l.isRepReference(t)}}))},createSceneGraphOverrideSet:function(e,i){e.getIdPathMatcher()||l.initIdPathMatcher(e);var n,o=e.getSceneGraphOverrideSetManager(),r=l.getRootBag(e);return r&&o&&(n=new t(r,l.getRootBagId(),void 0,void 0,void 0,i?{mode:t.forceShow}:void 0),o.pushSceneGraphOverrideSet(n)),n},ensurePriorityOfSceneGraphOverrideSet:function(e,t){if(e&&t){var i=e.getSceneGraphOverrideSetManager();i&&i.getSceneGraphOverrideSetIndex(t)!==i.getNumberOfSceneGraphOverrideSets()-1&&(i.removeSceneGraphOverrideSet(t),i.pushSceneGraphOverrideSet(t))}},removeSceneGraphOverrideSet:function(e,t){if(e&&t){var i=e.getSceneGraphOverrideSetManager();i&&i.removeSceneGraphOverrideSet(t)}},getIdPath:function(e){var t=[];return e&&e.externalPath.forEach((function(e){if("RootBag"!==e.name){var i=l.getNodeID(e);i&&l.isPLMNode(e)&&t.push(i)}})),t},getOverrides:function(e,t,n){var o,r,a,s=[];if(e&&t)if(t.pathElements&&t.pathElements.length)t.pathElements.forEach((function(t){if(r=t.clone(),e._viewers[0]){var i=l.getRootBag(e._viewers[0].viewer);r.getElement(0).id!==i.id&&r.externalPath.unshift(i)}(o=e.getUniqueOverrideFromPathElement(r))||n||(o=e.createOverride({pathes:[r]})),o&&s.push(o)}));else if(t.idPaths&&t.idPaths.length){var c=l.getRootBagId();t.idPaths.forEach((function(l){a=null,Array.isArray(l)?((r=l.slice())[0]!==c&&r.unshift(c),a=new i(r)):l&&l.ids&&(l.ids[0]!==c&&l.ids.unshift(c),a=l),a&&((o=e.getUniqueOverrideFromIdPath(a))||n||(o=e.createIdPathOverride({idPathes:[a],propagateUntilRepRefs:t.propagateUntilRepRefs,propagateToParents:t.propagateToParents})),o&&s.push(o))}))}return s},removeOverride:function(e,t){if(e&&t){var n;if(t.pathElement){var o=t.pathElement.clone();if(e._viewers[0]){var r=l.getRootBag(e._viewers[0].viewer);o.getElement(0).id!==r.id&&o.externalPath.unshift(r)}n=e.getUniqueOverrideFromPathElement(o)}else if(t.idPath){var a=t.idPath.slice(),s=l.getRootBagId();a[0]!==s&&a.unshift(s),n=e.getUniqueOverrideFromIdPath(new i(a))}n&&e.deleteOverride(n)}},computeBoundingBox:function(t,i){var n,o,r,a,s,c=0,u=t.getVisibleSpace();if(i&&(c=i.length)>0){var p;for(r=0;r<c;r++)(p=i[r])&&(l.getLastReference(p).getLastElement()||(p=l.getLastOOCTileNode(p))&&p.getLastElement())&&(a=null,o=p.getBoundingBox(a,t,u?"visibleSpace":"invisibleSpace"),(s=a||p.getWorldMatrix())&&o.applyMatrix4(s),o&&!o.isNaN()&&(n?n.mergeWithBox(o):n=o));n&&!n.isNaN()||(n=l.computeBoundingBox(t))}else{var d=l.getRootReferences(t);for(c=d.length,r=0;r<c;r++){var m=new e;m.addElement(d[r]),o=m.getBoundingBox(a,t,u?"visibleSpace":"invisibleSpace"),(s=a||m.getWorldMatrix())&&o.applyMatrix4(s),o&&!o.isNaN()&&(n?n.mergeWithBox(o):n=o)}}return n},computeBoundingSphere:function(t){var i,n,o,r,a=l.getRootReferences(t);for(o=a.length,r=0;r<o;r++){var s=new e;s.addElement(a[r]),n=s.getBoundingSphere(),i?n&&n.radius&&i.mergeWithSphere(n,i):i=n}return i},computeBoundingSphereofObjects:function(e,t){var i,n,o,r=0;if(t&&(r=t.length)>0){var a;for(o=0;o<r;o++)(a=t[o])&&(l.getLastReference(a).getLastElement()||(a=l.getLastOOCTileNode(a))&&a.getLastElement())&&(n=a.getBoundingSphere(),i?i.mergeWithSphere(n,i):i=n);i&&i.radius&&i.center||(i=l.computeBoundingSphere(e))}else i=l.computeBoundingSphere(e);return i},getXYAxisDirFromZ:function(e){if(e){var t,i;e.normalize();var n=(t=new r.Vector3(1,0,0).projectOnPlane(e)).length(),o=(i=new r.Vector3(0,1,0).projectOnPlane(e)).length(),s=(new r.Vector3).crossVectors(new r.Vector3(0,0,1),e),l=new r.Vector3(0,0,1).dot(e);return a.areEqual(Math.abs(l),1,"float")?a.areEqual(n,o,"float")?(t.normalize(),i=(new r.Vector3).crossVectors(e,t).normalize()):n<o?(i.normalize(),t=(new r.Vector3).crossVectors(i,e).normalize()):(t.normalize(),i=(new r.Vector3).crossVectors(e,t).normalize()):(t=s.normalize(),i=(new r.Vector3).crossVectors(e,t).normalize()),{xDir:t,yDir:i}}},getMatFromNormWithPos:function(e,t,i){if(e&&t){var n=e.clone().negate().normalize(),o=l.getXYAxisDirFromZ(n),a=o.xDir,s=o.yDir,c=(new r.Matrix4).makeBasis(a,s,i?n:n.negate()),u=(new r.Vector3).copy(t);return c.setPosition(u),c}},isPathToAxisSystem:function(e){if(!e||!e.externalPath)return!1;for(var t=e.externalPath.length-1;t>=0;--t){var i=e.externalPath[t];if(l.isPLMNode(i))break;if("AxisSystems"===i.name)return t}return 0},findClosestLocalAxis:function(e,t,i,n){if(e||t&&i&&n){var o,r=t,a=void 0,s=e.clone();return s=s.negate(),t&&(a=o=s.angleTo(t),r=t),i&&(o=s.angleTo(i))<a&&(a=o,r=i),n&&(o=s.angleTo(n))<a&&(a=o,r=n),r}},isOOCTileSetNode:function(e,t){if(!e)return!1;var i=!1;if(!t){var n=e.children;if(n.length)for(var o=0;o<n.length&&((i=l.callPad3DViewerModelServices("isTileSetNode",n[o]))||(i=void 0!==n[o].isOOCTileSetNode?n[o].isOOCTileSetNode():i),!i);o++);}return i||(i=l.callPad3DViewerModelServices("isTileSetNode",e))||(i=void 0!==e.isOOCTileSetNode?e.isOOCTileSetNode():i),i},isOOCTileSetNodeInPath:function(e){if(e)return e.getLength()>1&&(!!l.isOOCTileSetNode(e.getLastElement(!0),!0)||l.isOOCTileSetNodeInPath(e.getParentPath()))},getLastOOCTileNode:function(t){return t.getLength()>1?l.isOOCTileSetNode(t.getLastElement(!0))?t.clone():l.getLastOOCTileNode(t.getParentPath()):new e},isCompletlyHidden:function(e){let t=!1;return e&&e.visibilityFree&&!e.visible&&(t=!0),t},setPickability:function(e,t){if(e&&e.getNode){let i=e.getNode();i&&i.updateNonManipulableNodePickability&&i.updateNonManipulableNodePickability(t)}},isOOC:function(e,t){var i=!1;if(e&&e.getSetting("enopad3dviewer_lightNodeModel")){for(var n=l.getRootReferences(t),o=0,r=0,a=0;a<n.length;a++){let e=1===n.length?l.getNodeType(n[a]):null;l.isPLMNode(n[a],!0)&&"DesignSight"!==e&&o++,l.isOOCTileSetNode(n[a],!0)&&"DesignSight"!==e&&r++}o+r===n.length&&(0===o&&(i=!1),i=!0)}return i},getNodeFromID:function(e){if(!e)return;var t=require("DS/PADUtils/PADContext").get();if(!t)return;let i=t.getViewer();return e===l.getRootBagId()?l.getRootBag(i):t&&t.getController().getNode({id:e})?t.getController().getNode({id:e}):function(e,t){for(var i=0;i<t.length;i++)if(t[i]){let n=t[i];if(l.getNodeID(n)===e)return n}}(e,l.getRootReferences(i))}};return l})),define("DS/DMUMeasurable/DMUMathsBoundingGeometry",["DS/DMUMeasurable/DMUMathsVector3D"],(function(e){"use strict";var t=.001,i={areEqualAABB:function(e,i){return Math.abs(i[0]-e[0])<t&&Math.abs(i[1]-e[1])<t&&Math.abs(i[2]-e[2])<t&&Math.abs(i[3]-e[3])<t&&Math.abs(i[4]-e[4])<t&&Math.abs(i[5]-e[5])<t},computeAABBDistance:function(e,t){return Math.sqrt(i.computeAABBSquaredDistance(e,t))},computeAABBSquaredDistance:function(e,t){var i=0,n=0,o=0,r=0;return e[3]<t[0]?n=t[0]-e[3]:e[0]>t[3]&&(n=e[0]-t[3]),e[4]<t[1]?o=t[1]-e[4]:e[1]>t[4]&&(o=e[1]-t[4]),e[5]<t[2]?r=t[2]-e[5]:e[2]>t[5]&&(r=e[2]-t[5]),0===n&&0===o&&0===r||(i=n*n+o*o+r*r),i},computeAABBSquaredMaxDistance:function(e,t){var i=Math.max(Math.abs(t[0]-e[3]),Math.abs(t[3]-e[0])),n=Math.max(Math.abs(t[1]-e[4]),Math.abs(t[4]-e[1])),o=Math.max(Math.abs(t[2]-e[5]),Math.abs(t[5]-e[2]));return i*i+n*n+o*o},computeAABBForPoint:function(e){var t=[];return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[0],t[4]=e[1],t[5]=e[2],t},computeAABBForPoints:function(e){var t,i,n,o=[],r=e.length;o[0]=e[0][0],o[1]=e[0][1],o[2]=e[0][2],o[3]=o[0],o[4]=o[1],o[5]=o[2];for(var a=1;a<r;a++)t=e[a][0],i=e[a][1],n=e[a][2],t<o[0]?o[0]=t:t>o[3]&&(o[3]=t),i<o[1]?o[1]=i:i>o[4]&&(o[4]=i),n<o[2]?o[2]=n:n>o[5]&&(o[5]=n);return o},computeAABBForUnsortedPoints:function(t,i,n,o,r){var a,s,l,c,u,p=[];if(n)if(r&&!e.isIdentity(r))for(a=3*n[i],(p=e.transformPoint([o[a],o[a+1],o[a+2]],r))[3]=p[0],p[4]=p[1],p[5]=p[2],u=1;u<t;u++){a=3*n[i+u];var d=e.transformPoint([o[a],o[a+1],o[a+2]],r);s=d[0],l=d[1],c=d[2],s<p[0]?p[0]=s:s>p[3]&&(p[3]=s),l<p[1]?p[1]=l:l>p[4]&&(p[4]=l),c<p[2]?p[2]=c:c>p[5]&&(p[5]=c)}else for(a=3*n[i],p[0]=o[a],p[1]=o[a+1],p[2]=o[a+2],p[3]=p[0],p[4]=p[1],p[5]=p[2],u=1;u<t;u++)s=o[a=3*n[i+u]],l=o[a+1],c=o[a+2],s<p[0]?p[0]=s:s>p[3]&&(p[3]=s),l<p[1]?p[1]=l:l>p[4]&&(p[4]=l),c<p[2]?p[2]=c:c>p[5]&&(p[5]=c);return p},computeAABBForSegment:function(e,t){var i=[];return i[0]=Math.min(e[0],t[0]),i[1]=Math.min(e[1],t[1]),i[2]=Math.min(e[2],t[2]),i[3]=Math.max(e[0],t[0]),i[4]=Math.max(e[1],t[1]),i[5]=Math.max(e[2],t[2]),i},computeAABBForTriangle:function(e,t,i){var n=[];return n[0]=Math.min(e[0],t[0],i[0]),n[1]=Math.min(e[1],t[1],i[1]),n[2]=Math.min(e[2],t[2],i[2]),n[3]=Math.max(e[0],t[0],i[0]),n[4]=Math.max(e[1],t[1],i[1]),n[5]=Math.max(e[2],t[2],i[2]),n},intersectAABBWithRay:function(e,i,n){var o,r,a,s,l,c=!1;(Math.abs(n[0])>t||i[0]>e[0]&&i[0]<e[3])&&(Math.abs(n[1])>t||i[1]>e[1]&&i[1]<e[4])&&(Math.abs(n[2])>t||i[2]>e[2]&&i[2]<e[5])&&(Math.abs(n[0])<t?(o=-Number.MAX_VALUE,r=Number.MAX_VALUE):(l=1/n[0])>=0?(o=(e[0]-i[0])*l,r=(e[3]-i[0])*l):(o=(e[3]-i[0])*l,r=(e[0]-i[0])*l),Math.abs(n[1])<t?(a=-Number.MAX_VALUE,s=Number.MAX_VALUE):(l=1/n[1])>=0?(a=(e[1]-i[1])*l,s=(e[4]-i[1])*l):(a=(e[4]-i[1])*l,s=(e[1]-i[1])*l),o<s&&a<r&&(a>o&&(o=a),s<r&&(r=s),Math.abs(n[2])<t?(a=-Number.MAX_VALUE,s=Number.MAX_VALUE):(l=1/n[2])>=0?(a=(e[2]-i[2])*l,s=(e[5]-i[2])*l):(a=(e[5]-i[2])*l,s=(e[2]-i[2])*l),o<s&&a<r&&(a>o&&(o=a),s<r&&(r=s),r>0&&(c=!0))));return c},areEqualBoundingSpheres:function(e,i){return Math.abs(i[0]-e[0])<t&&Math.abs(i[1]-e[1])<t&&Math.abs(i[2]-e[2])<t&&Math.abs(i[3]-e[3])<t},computeBoundingSpheresDistance:function(t,i){return Math.max(0,e.subAndLength(t,i)-t[3]-i[3])},computeBoundingSpheresSquaredDistance:function(e,t){var n=i.computeBoundingSpheresDistance(e,t);return n*n},computeBoundingSphereForPoint:function(e){var t=[];return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=0,t},computeBoundingSphereForPoints:function(e){var t=i.computeAABBForPoints(e),n=[t[3],t[4],t[5]];return i.computeBoundingSphereForSegment(t,n)},computeBoundingSphereForSegment:function(t,i){var n=[];return n[0]=(t[0]+i[0])/2,n[1]=(t[1]+i[1])/2,n[2]=(t[2]+i[2])/2,n[3]=e.subAndLength(t,i)/2,n},computeBoundingSphereForTriangle:function(t,n,o){var r,a=[],s=e.sub(t,n),l=e.sub(t,o),c=e.squaredLength(s),u=e.squaredLength(l),p=e.dot(s,l),d=2*(c*u-p*p);if(Math.abs(d)<=1e-6){var m=i.computeAABBForTriangle(t,n,o);r=[m[3],m[4],m[5]],a=i.computeBoundingSphereForSegment(m,r)}else{var y=(c*u-u*p)/d,h=(u*c-c*p)/d;y<=0?(r=e.add(t,o),a=e.multiply(r,.5)):h<=0?(r=e.add(t,n),a=e.multiply(r,.5)):y+h>=1?(r=e.add(n,o),a=e.multiply(r,.5)):(r=e.multiplyAndAdd(s,y,t),a=e.multiplyAndAdd(l,h,r)),a[3]=e.subAndLength(a,t)}return a}};return i})),define("DS/DMUMeasurable/DMUMathsInfiniteGeometry",["DS/DMUMeasurable/DMUMathsVector3D","DS/DMUMeasurable/DMUGeometryEnums","DS/DMUMeasurable/DMUMeasureEnums","DS/DMUMeasurable/DMUToolsMaths"],(function(e,t,i,n){"use strict";var o=.001,r=1e-6,a={computeTwoPointsDistance:function(i,n){var r={returnCode:1};return i&&n&&(r.returnCode=0,r.distance=e.subAndLength(i,n),r.relationship=r.distance<o?t.Relationship.COINCIDENT:t.Relationship.NONE),r},computePointLineDistance:function(i,n,a){var s={returnCode:1};if(i&&n&&a){var l=e.squaredLength(a);if(l>r){s.returnCode=0;var c=e.dot(e.sub(n,i),a)/l;s.aPosition=e.multiplyAndAdd(a,c,n),s.distance=e.subAndLength(i,s.aPosition),s.relationship=s.distance<o?t.Relationship.COINCIDENT:t.Relationship.NONE}}return s},computePointPlaneDistance:function(i,n,a){var s={returnCode:1};if(i&&n&&a){var l=e.squaredLength(a);if(l>r){s.returnCode=0;var c=e.dot(e.sub(i,n),a)/l;s.aPosition=e.multiplyAndAdd(a,c,i),s.distance=e.subAndLength(i,s.aPosition),s.relationship=s.distance<o?t.Relationship.COINCIDENT:t.Relationship.NONE}}return s},computeTwoLinesDistance:function(i,r,a,s){var l={returnCode:1};if(i&&r&&a&&s){l.returnCode=0;var c=e.sub(a,i),u=e.squaredLength(r),p=e.dot(r,s),d=e.squaredLength(s),m=e.dot(r,c),y=e.dot(s,c),h=u*d-p*p,g=0,P=0,f=e.angle(r,s);n.isZero(0-f)||n.isZero(Math.PI-f)?(g=0,P=p>d?m/p:y/d,l.aPosition1=e.clone(i),l.aPosition2=e.multiplyAndAdd(s,P,a),l.distance=e.subAndLength(l.aPosition1,l.aPosition2),l.relationship=l.distance<o?t.Relationship.COINCIDENT:t.Relationship.PARRALLEL,l.angle=0):(g=(p*y-d*m)/h,P=(u*y-p*m)/h,l.aPosition1=e.multiplyAndAdd(r,g,i),l.aPosition2=e.multiplyAndAdd(s,P,a),l.distance=e.subAndLength(l.aPosition1,l.aPosition2),l.relationship=l.distance<o?t.Relationship.INTERSECTING:t.Relationship.NONE,l.angle=e.angle(r,s))}return l},computeLinePlaneDistance:function(i,n,r,s){var l={returnCode:1};if(i&&n&&r&&s){l.returnCode=0;var c=e.normalize(n),u=e.normalize(s),p=e.dot(c,u);if(Math.abs(p)<o){l.angle=0;var d=a.computePointPlaneDistance(i,r,u);0===d.returnCode&&d.distance<o?(l.distance=0,l.aPosition=e.clone(i),l.relationship=t.Relationship.COINCIDENT):(l.distance=d.distance,l.aPosition=d.aPosition,l.relationship=t.Relationship.PARRALLEL)}else{l.distance=0,l.angle=Math.asin(p);var m=e.dot(e.sub(i,r),u)/p;l.aPosition=e.multiplyAndAdd(c,m,i),l.relationship=t.Relationship.INTERSECTING}}return l},computeTwoPlanesDistance:function(i,n,r,s){var l={returnCode:1};if(i&&n&&r&&s){l.returnCode=0;var c=e.normalize(n),u=e.normalize(s);if(e.areEqual(c,u)||e.isNull(e.add(c,u))){l.angle=0;var p=e.areEqual(c,u)?1:-1,d=e.dot(i,c),m=e.dot(r,u);l.distance=Math.abs(d-p*m),l.aPosition1=i;var y=a.computePointPlaneDistance(i,r,u);l.aPosition2=y.aPosition,l.relationship=l.distance<o?t.Relationship.COINCIDENT:t.Relationship.PARRALLEL}else{l.distance=0,l.angle=Math.acos(e.dot(c,u));var h=e.cross(c,u),g=e.cross(c,h),P=e.cross(u,h),f=a.computeLinePlaneDistance(r,P,i,c);l.aPosition1=f.aPosition;var T=a.computeLinePlaneDistance(i,g,r,u);l.aPosition2=T.aPosition,l.relationship=t.Relationship.INTERSECTING}}return l},measureBetweenInfinite:function(n,r,s,l){var c,u={},p=[],d=[],m=[n,s],y=[{_selectedType:r},{_selectedType:l}],h=y[0],g=y[1],P=!1;switch(function(){for(var e=0;e<2;e++){var n,o=m[e].getType();if(y[e].realType=o,y[e]._selectedType===i.ViewedType.POINT)y[e].type=t.GeometryType.POINT,y[e].position=m[e].getSelPoint(),o===t.GeometryType.CIRCLE||o===t.GeometryType.PLANE?y[e].normal=m[e]._normal:o!==t.GeometryType.CYLINDER&&o!==t.GeometryType.SPHERE&&o!==t.GeometryType.CONE&&o!==t.GeometryType.SURFACE||m[e].getSelNormal&&m[e]._selNormal&&(y[e].normal=m[e].getSelNormal());else if(o===t.GeometryType.POINT||o===t.GeometryType.PICKINGPT)y[e].type=t.GeometryType.POINT,y[e].position=m[e].getPoint();else if(o===t.GeometryType.LINE)y[e].type=t.GeometryType.LINE,n=m[e].getPoints(),y[e].position=m[e].getSelPoint(),y[e].direction=n.endPoint.sub(n.beginPoint);else if(o===t.GeometryType.CIRCLE)y[e]._selectedType===i.ViewedType.CENTER?(y[e].type=t.GeometryType.POINT,y[e].position=m[e].getCenter()):(y[e].type=t.GeometryType.LINE,y[e].position=m[e].getCenter(),y[e].direction=m[e].getAxis()),m[e]._normal&&(y[e].normal=m[e]._normal);else if(o===t.GeometryType.CYLINDER)y[e].type=t.GeometryType.LINE,n=m[e].getPoints(),y[e].position=n.beginPoint,y[e].direction=n.endPoint.sub(n.beginPoint);else if(o===t.GeometryType.CONE)y[e].type=t.GeometryType.LINE,n=m[e].getPoints(),y[e].position=n.beginPoint,y[e].direction=n.endPoint.sub(n.beginPoint);else if(o===t.GeometryType.SPHERE)y[e].type=t.GeometryType.POINT,y[e].position=m[e].getCenter();else if(o===t.GeometryType.PLANE){y[e].type=t.GeometryType.PLANE;var r=m[e].getPlane();y[e].origin=m[e].getSelPoint(),y[e].normal=r.normal}}(y[0].type===t.GeometryType.LINE&&y[1].type===t.GeometryType.PLANE||y[0].type===t.GeometryType.POINT||y[0].type===t.GeometryType.PICKINGPT)&&(h=y[1],g=y[0],P=!0)}(),h.type){case t.GeometryType.PLANE:d[0]=i.ViewedType.INFPLANE,g.type===t.GeometryType.PLANE?(d[1]=i.ViewedType.INFPLANE,(c=a.computeTwoPlanesDistance(h.origin.toArray(),h.normal.toArray(),g.origin.toArray(),g.normal.toArray()))&&0===c.returnCode&&(u.distance=c.distance,u.angle=c.angle>Math.PI/2?Math.PI-c.angle:c.angle,u.relationship=c.relationship,c.relationship===t.Relationship.INTERSECTING?(p[0]=e.clone(c.aPosition1),p[1]=e.clone(c.aPosition2)):(p[0]=h.origin.toArray(),p[1]=c.aPosition2))):g.type===t.GeometryType.LINE?(d[1]=i.ViewedType.AXIS,(c=a.computeLinePlaneDistance(g.position.toArray(),g.direction.toArray(),h.origin.toArray(),h.normal.toArray()))&&0===c.returnCode&&(u.distance=c.distance,u.angle=c.angle>Math.PI/2?Math.PI-c.angle:c.angle,u.relationship=c.relationship,c.relationship===t.Relationship.INTERSECTING?(p[0]=c.aPosition,p[1]=c.aPosition):(p[0]=c.aPosition,p[1]=g.position.toArray()),u.aExtension=g.direction.toArray())):(d[1]=i.ViewedType.POINT,(c=a.computePointPlaneDistance(g.position.toArray(),h.origin.toArray(),h.normal.toArray()))&&0===c.returnCode&&(u.distance=c.distance,u.relationship=c.relationship,p[0]=c.aPosition,p[1]=g.position.toArray()));break;case t.GeometryType.LINE:d[0]=i.ViewedType.AXIS,g.type===t.GeometryType.LINE?(d[1]=i.ViewedType.AXIS,(c=a.computeTwoLinesDistance(h.position.toArray(),h.direction.toArray(),g.position.toArray(),g.direction.toArray()))&&0===c.returnCode&&(u.distance=c.distance,u.angle=c.angle>Math.PI/2?Math.PI-c.angle:c.angle,u.relationship=c.relationship,c.relationship===t.Relationship.INTERSECTING||c.relationship===t.Relationship.NONE?(p[0]=c.aPosition1,p[1]=c.aPosition2,u.aExtension=e.sub(h.position.toArray(),c.aPosition1)):(p[0]=h.position.toArray(),p[1]=c.aPosition2,h.realType===t.GeometryType.CIRCLE||h.realType===t.GeometryType.CYLINDER||h.realType===t.GeometryType.CONE||(h.realType,t.GeometryType.SPHERE)))):(d[1]=i.ViewedType.POINT,(c=a.computePointLineDistance(g.position.toArray(),h.position.toArray(),h.direction.toArray()))&&0===c.returnCode&&(u.distance=c.distance,u.relationship=c.relationship,p[0]=c.aPosition,p[1]=g.position.toArray())),u.aExtension=h.direction.toArray();break;default:!function(){if(d[0]=i.ViewedType.POINT,d[1]=i.ViewedType.POINT,p[0]=h.position.toArray(),p[1]=g.position.toArray(),(c=a.computeTwoPointsDistance(p[0],p[1]))&&0===c.returnCode&&(u.distance=c.distance,u.relationship=c.relationship,g.normal&&h.normal)){var e=g.position.clone().sub(h.position),t=h.normal.angleTo(e),n=g.normal.angleTo(e);Math.abs(t-n)<o&&Math.abs(t-Math.PI/2)<o&&(u.aExtension=h.normal.toArray())}}()}return P?(u.aPosition1=p[1],u.aPosition2=p[0],u.type1=d[1],u.type2=d[0]):(u.aPosition1=p[0],u.aPosition2=p[1],u.type1=d[0],u.type2=d[1]),u}};return a})),define("DS/DMUMeasurable/DMUMeshServices",["DS/DMUMeasurable/DMUToolsMaths","DS/DMUMeasurable/DMUMathsVector3D","DS/DMUMeasurable/DMUMathsBoundingGeometry"],(function(e,t,i){"use strict";var n=5e5,o={verifyMesh:function(e){var t=void 0!==e&&void 0!==e.getGroup()&&void 0!==e.getGroup().glType&&void 0!==e.getGroup().geometry;return t=t&&void 0!==e.getCount()&&e.getCount()>0&&void 0!==e.getGroup().geometry.vertexIndexArray},extractMeshVertices:function(e,i,r,a){var s=[];if(e.getCount()>n&&isNaN(r)&&!a){s=o.extractMeshVertices(e,i,50);var l=e;let t=l.getGroup().geometry;var c;return new Proxy(s,{get:function(e,n){let r;if("length"===n)r=l.getCount();else{if(e[n])return e[n];c||(c={start:l.getStart(),vertexIndexArray:t.vertexIndexArray,vertexPositionArray:t.vertexPositionArray,transfo:i});let a=parseInt(n);r=isNaN(a)?void 0:o.extractMeshVerticeAtIndex(c,a)}return r},set:function(e,t,i){return e[t]=i,!0}})}var u=e.getCount();r&&r<u&&(u=r);var p=a||!1,d=e.getStart(),m=e.getGroup().geometry;if(m&&m.vertexIndexArray&&m.vertexPositionArray){var y,h=m.vertexIndexArray,g=m.vertexPositionArray,P=0,f=0;if(i&&!t.isIdentity(i))if(p){var T=[];for(P=0;P<u;P++){y=3*h[d+P];var v=!1;for(f=0;!v&&f<T.length;f++)v=y===T[f];v||(s.push(t.transformPoint([g[y],g[y+1],g[y+2]],i)),T.push(y))}}else for(P=0;P<u;P++)y=3*h[d+P],s[P]=t.transformPoint([g[y],g[y+1],g[y+2]],i);else if(p){var C=[];for(P=0;P<u;P++){y=3*h[d+P];var M=!1;for(f=0;!M&&f<C.length;f++)M=y===C[f];M||(s.push([g[y],g[y+1],g[y+2]]),C.push(y))}}else for(f=0;f<u;f++)y=3*h[d+f],s[f]=[g[y],g[y+1],g[y+2]]}return s},extractMeshNormals:function(e,i,r,a){var s=[];if(e.getCount()>n&&isNaN(r)&&!a){s=o.extractMeshNormals(e,i,50);var l=e;let t=l.getGroup().geometry;var c;return new Proxy(s,{get:function(e,n){let r;if("length"===n)r=l.getCount();else{if(e[n])return e[n];c||(c={start:l.getStart(),vertexIndexArray:t.vertexIndexArray,vertexNormalArray:t.vertexNormalArray,iTransfo:i});let a=parseInt(n);r=isNaN(a)?void 0:o.extractMeshNormalAtIndex(c,a)}return r},set:function(e,t,i){return e[t]=i,!0}})}if(o.verifyMesh(e)){var u=e.getCount();r&&r<u&&(u=r);var p,d=a||!1,m=e.getStart(),y=e.getGroup().geometry,h=y.vertexIndexArray,g=y.vertexNormalArray,P=0,f=0;if(h)if(i&&!t.isIdentity(i))if(d){var T=[];for(P=0;P<u;P++){p=3*h[m+P];var v=!1;for(f=0;!v&&f<T.length;f++)v=p===T[f];v||(s.push(t.transformVector([g[p],g[p+1],g[p+2]],i)),T.push(p))}}else for(P=0;P<u;P++)p=3*h[m+P],s[P]=t.transformVector([g[p],g[p+1],g[p+2]],i);else if(d){var C=[];for(P=0;P<u;P++){p=3*h[m+P];var M=!1;for(f=0;!M&&f<C.length;f++)M=p===C[f];M||(s.push([g[p],g[p+1],g[p+2]]),C.push(p))}}else for(f=0;f<u;f++)p=3*h[m+f],s[f]=[g[p],g[p+1],g[p+2]]}return s},extractMeshVerticeAtIndex:function(e,i){let n,o,r=e.start,a=e.vertexIndexArray,s=e.vertexPositionArray,l=e.transfo;return a&&(o=3*a[r+i],n=[s[o],s[o+1],s[o+2]],l&&!t.isIdentity(l)&&(n=t.transformPoint(n,l))),n},extractMeshNormalAtIndex:function(e,i){let n,o,r=e.start,a=e.vertexIndexArray,s=e.vertexNormalArray,l=e.transfo;return a&&(o=3*a[r+i],n=[s[o],s[o+1],s[o+2]],l&&!t.isIdentity(l)&&(n=t.transformVector(n,l))),n},computeAABB:function(e,t){var n=e.getCount(),o=e.getStart(),r=e.getGroup().geometry,a=r.vertexIndexArray,s=r.vertexPositionArray;return i.computeAABBForUnsortedPoints(n,o,a,s,t)},computeBoundingSphere:function(e,t){var n=o.extractMeshVertices(e,t);return i.computeBoundingSphereForPoints(n)},_computeVolume:function(i,n){var r={returnCode:1};if(4===i.getGroup().glType){for(var a=o.extractMeshVertices(i),s=a.length/3,l=0,c=[0,0,0],u=[0,0,0],p=[0,0,0],d=[0,0,0],m=[0,0,0],y=[0,0,0],h=0;h<s;h++){u=t.sub(n,a[3*h],u),p=t.sub(n,a[3*h+1],p);var g=-(d=t.sub(n,a[3*h+2],d))[0]*p[1]*u[2]+p[0]*d[1]*u[2]+d[0]*u[1]*p[2]-u[0]*d[1]*p[2]-p[0]*u[1]*d[2]+u[0]*p[1]*d[2];m=t.add(u,t.add(p,d,m),m),l+=g,c=t.multiplyAndAdd(m,g,c,y)}r.returnCode=0,r.volume=l/6,r.aCog=e.isZero(l)?[0,0,0]:t.multiplyAndAdd(c,1/(4*l),n)}return r}};return o})),define("DS/DMUMeasurable/DMUMeshRecognition",["DS/DMUMeasurable/DMUToolsMaths","DS/DMUMeasurable/DMUGeometryEnums","DS/DMUMeasurable/DMUMathsVector3D","DS/DMUMeasurable/DMUMathsInfiniteGeometry","DS/DMUMeasurable/DMUMeshServices","DS/Visualization/ThreeJS_DS","DS/WebPolyMaths/WebMeshRecognition","DS/Visualization/Measurable"],(function(e,t,i,n,o,r,a,s){"use strict";var l=.1,c=.02,u={recognizeCanonicGeometry:function(e,i,n){var r,l,c={};if(c.returnCode=1,e.getDecoration()&&(!function(){var a=new s(e);switch(a.getType()){case s.TYPEUNKNOWN:1===(r=o.extractMeshVertices(e)).length&&(c.returnCode=0,c.type=t.GeometryType.POINT,c.position=u._buildVector3(r[0]).applyMatrix4(i));break;case s.TYPEPLANE:var p=a.getPlane();p&&(c.returnCode=0,c.type=t.GeometryType.PLANE,c.origin=u._buildVector3(p.position).applyMatrix4(i),c.normal=u._buildVector3(p.normal).transformDirection(i));break;case s.TYPECYLINDER:var d=a.getCylinder();if(d)if(c.returnCode=0,c.type=t.GeometryType.CYLINDER,c.radius=d.radius,n){r=o.extractMeshVertices(e);var m=u._computeMinMaxProjection(r,d.axis,d.center);0===m.returnCode&&(c.point1=u._buildVector3(m.aPoint1).applyMatrix4(i),c.point2=u._buildVector3(m.aPoint2).applyMatrix4(i))}else c.point1=u._buildVector3(d.center).applyMatrix4(i),c.point2=c.point1.clone().sub(u._buildVector3(d.axis)).applyMatrix4(i);break;case s.TYPECONE:var y=a.getCone();if(y){if(c.returnCode=0,c.type=t.GeometryType.CONE,c.semiAngle=y.semiAngle>Math.PI/2?y.semiAngle*Math.PI/180:y.semiAngle,c.apex=u._buildVector3(y.center).applyMatrix4(i),c.axis=u._buildVector3(y.axis).transformDirection(i),n){r=o.extractMeshVertices(e);var h=!0;c.semiAngle>Math.PI/2&&(h=!1),0===(l=u._computeMinMaxProjection(r,y.axis,y.center,h)).returnCode&&(c.point1=u._buildVector3(l.aPoint1).applyMatrix4(i),c.point2=u._buildVector3(l.aPoint2).applyMatrix4(i))}else c.point1=u._buildVector3(y.center).applyMatrix4(i),c.point2=c.point1.clone().sub(u._buildVector3(y.axis)).applyMatrix4(i);if(l&&l.baseRadius){var g=l.baseRadius/Math.tan(c.semiAngle),P=c.axis.clone().normalize().negate().multiplyScalar(g);c.apex=c.point2.clone().add(P),c.baseRadius=l.baseRadius,l.topRadius&&(c.topRadius=l.topRadius)}}break;case s.TYPESPHERE:var f=a.getSphere();f&&(c.returnCode=0,c.type=t.GeometryType.SPHERE,c.radius=f.radius,c.center=u._buildVector3(f.center).applyMatrix4(i));break;case s.TYPELINE:var T=a.getLine();T&&(c.returnCode=0,c.type=t.GeometryType.LINE,c.point1=u._buildVector3(T.startPosition).applyMatrix4(i),c.point2=u._buildVector3(T.endPosition).applyMatrix4(i));break;case s.TYPECIRCLE:var v=a.getCircle();v&&(c.returnCode=0,c.type=t.GeometryType.CIRCLE,c.radius=v.radius,c.center=u._buildVector3(v.center).applyMatrix4(i),c.normal=u._buildVector3(v.axis).transformDirection(i))}}(),c.exact=0===c.returnCode),1===c.returnCode){if(void 0===e._bNotRecognized){if(o.verifyMesh(e)){r=o.extractMeshVertices(e);var p=e.getGroup().glType,d=r.length;if(1===d)c.returnCode=0,c.type=t.GeometryType.POINT,c.position=u._buildVector3(r[0]).applyMatrix4(i);else if(2===d)0===(c=a._recognizeLine(r)).returnCode&&(c.point1=u._buildVector3(c.aPoint1).applyMatrix4(i),c.point2=u._buildVector3(c.aPoint2).applyMatrix4(i));else if(1===p)0===(l=a._recognizeCircle(r)).returnCode?((c=l).center=u._buildVector3(c.aCenter).applyMatrix4(i),c.normal=u._buildVector3(c.aNormal).transformDirection(i)):0===(c=a._recognizeLine(r)).returnCode&&(c.point1=u._buildVector3(c.aPoint1).applyMatrix4(i),c.point2=u._buildVector3(c.aPoint2).applyMatrix4(i));else if(4===p)if(0===(l=u._recognizePlane(r)).returnCode)(c=l).origin=u._buildVector3(c.aOrigin).applyMatrix4(i),c.normal=u._buildVector3(c.aNormal).transformDirection(i);else{var m=o.extractMeshNormals(e);0===(c=u._recognizeCylinder(r,m)).returnCode?(c.point1=u._buildVector3(c.aPoint1).applyMatrix4(i),c.point2=u._buildVector3(c.aPoint2).applyMatrix4(i)):0===(c=u._recognizeSphere(r,m)).returnCode?c.center=u._buildVector3(c.aCenter).applyMatrix4(i):0===(c=u._recognizeCone(r,m)).returnCode&&(c.apex=u._buildVector3(c.aApex).applyMatrix4(i),c.axis=u._buildVector3(c.aAxis).applyMatrix4(i),c.point1=u._buildVector3(c.aPoint1).applyMatrix4(i),c.point2=u._buildVector3(c.aPoint2).applyMatrix4(i))}}1===c.returnCode&&(e._bNotRecognized=!0)}c.exact=!1}return c},recognizeNonCanonicGeometry:function(e,t,i){var n={returnCode:1};if(o.verifyMesh(e)){var r=o.extractMeshVertices(e,t.elements),a=e.getGroup().glType;if(1===a){var s=u._recognizeCircle(r,i);0===s.returnCode&&i?((n=s).center=u._buildVector3(n.aCenter).applyMatrix4(t),n.normal=u._buildVector3(n.aNormal).transformDirection(t)):0===(n=u._recognizeCurve(r,i)).returnCode&&i&&(n.point1=u._buildVector3(n.aPoint1),n.point2=u._buildVector3(n.aPoint2))}else 4===a&&0===(n=u._recognizeSurface(r,i)).returnCode&&i&&(n.cog=u._buildVector3(n.aCog))}return n},_recognizeLine:function(n){var o={returnCode:1},r=n.length;if(2===r)o.returnCode=0,o.type=t.GeometryType.LINE,o.aPoint1=n[0],o.aPoint2=n[1];else if(r>2){for(var a,s=i.sub(n[1],n[0]),l=!0,c=1;l&&c<r;c++)a=i.sub(n[c],n[0]),l=e.isZero(i.length(i.cross(s,a)));if(l){for(var u=0,p=1,d=0,m=i.dot(s,s),y=2;y<r;y++){a=i.sub(n[y],n[0]);var h=i.dot(s,a);h<d?(u=y,d=h):h>m&&(p=y,m=h)}o.returnCode=0,o.type=t.GeometryType.LINE,o.aPoint1=n[u],o.aPoint2=n[p]}}return o},_recognizePlane:function(n){for(var o,r,a={returnCode:1},s=n.length,u=0,p=0,d=1;d<s&&0===p;d++)if(0===u)o=i.sub(n[0],n[d]),i.length(o)>l&&(u=d);else if(0===p&&(r=i.sub(n[0],n[d]),i.length(r)>l)){var m=i.angle(o,r);m>c&&m<Math.PI-c&&(p=d)}if(0!==u&&0!==p){for(var y=i.cross(o,r),h=!0,g=0;h&&g<s;g++)if(0!==g&&g!==u&&g!==p){var P=i.sub(n[0],n[g]),f=i.cross(o,P);if(!e.isZero(i.length(f))){var T=i.angle(y,f);h=!(T>c&&T<Math.PI-c)}}h&&(a.returnCode=0,a.type=t.GeometryType.PLANE,a.aOrigin=n[0],a.aNormal=i.normalize(y))}return a},_recognizeCircle:function(n){var o={returnCode:1},r=n.length;if(r>6){var a=u._recognizePlane(n);if(a&&a.type===t.GeometryType.PLANE){var s=a.aNormal,l=Math.floor(2*r/3),c=Math.floor(r/3),p=u._computeCircleThru3Points(n[0],n[c],n[l]);if(0===p.returnCode){for(var d=p.radius,m=p.aCenter,y=!0,h=0;y&&h<r;h++){var g=i.length(i.sub(n[h],m));y=e.areEqual(d,g,"float",.0017)}if(y){o.returnCode=0,o.type=t.GeometryType.CIRCLE,o.radius=p.radius,o.aCenter=p.aCenter,o.aNormal=s,o.length=2*Math.PI*p.radius;var P=i.sub(n[0],p.aCenter),f=Math.ceil(r/2),T=i.sub(n[f-1],p.aCenter),v=i.sub(n[r-1],p.aCenter),C=i.angle(P,T)+i.angle(T,v);o.arcLength=o.length*(C/(2*Math.PI))}}}}return o},_recognizeCylinder:function(e,n,o){var r,a,s,p={},d=!1,m=!0;p.returnCode=1;var y=o&&o<=e.length?o:e.length,h=!0;if(y>50){var g=u._recognizeCylinder(e,n,50);h=void 0!==g&&void 0!==g.type&&g.type===t.GeometryType.CYLINDER}if(h){if(y>7)for(var P=0;P<y;P++)for(var f=P+1;f<y;f++)if(a=i.cross(n[P],n[f]),d){var T=i.dot(s,a);r=i.add(r,i.multiply(a,T))}else i.length(a)>l&&(d=!0,s=a,r=a);if(r){s=i.normalize(r),r=[0,0,0];for(var v=0,C=[],M=0;M<y;M++)a=i.cross(n[M],s),i.length(a)/i.length(n[M])>.7?(v++,C[M]=1):C[M]=0;if(v>1?function(e,t){for(var o=0;o<e&&1===t[o];o++)for(var u=o+1;u<e&&1===t[u];u++)if(a=i.cross(n[o],n[u]),d){var p=i.dot(s,a);r=i.add(r,i.multiply(a,p))}else i.length(a)>l&&(d=!0,s=a,r=a);r=i.normalize(r);for(var y=0;y<e&&1===t[y]&&m;y++)a=i.cross(n[y],r),1-i.length(a)/i.length(n[y])>c&&(m=!1)}(y,C):m=!1,l>=i.length(r)&&(m=!1),m){for(var D,E=0,A=[],_=0,S=0,b=0,N=0,I=0;I<y;I++){D=i.dot(i.sub(e[0],e[I]),r);for(var w=i.sub(i.multiply(r,D),e[I]),R=!1,x=0;x<E&&!R;x++){R=i.subAndLength(A[x],w)<l}R||(A[E]=w,E++),D>b&&(b=D,N=I),D<_&&(_=D,S=I)}var V=u._recognizeCircle(A);if(V&&V.type===t.GeometryType.CIRCLE){D=i.dot(i.sub(V.aCenter,e[S]),r);var L=i.add(i.multiply(r,D),V.aCenter);D=i.dot(i.sub(V.aCenter,e[N]),r);var G=i.add(i.multiply(r,D),V.aCenter);p.returnCode=0,p.type=t.GeometryType.CYLINDER,p.radius=V.radius,p.aPoint1=L,p.aPoint2=G}}}}return p},_recognizeCone:function(o,r,a,s){var l,p,d,m={};m.returnCode=1;var y=a&&a<=o.length?a:o.length,h=s&&s<=r.length?s:r.length,g=!0;if(y>50){var P=u._recognizeCone(o,r,50,50);g=void 0!==P&&void 0!==P.type&&P.type===t.GeometryType.CONE}if(g){if(3<y){for(var f=[],T=1;T<y;T++)i.areEqual(o[0],o[T])||f.push(o[T]);var v=u._recognizeCircle(f);v&&v.type===t.GeometryType.CIRCLE&&(l=i.sub(v.aCenter,o[0]),i.areEqual(i.normalize(l),v.aNormal)&&(m.returnCode=0,m.type=t.GeometryType.CONE,m.aApex=o[0],m.aPoint1=o[0],m.aPoint2=v.aCenter,m.aAxis=v.aNormal,m.semiAngle=i.angle(i.sub(o[1],o[0]),l)))}0!==m.returnCode&&y===h&&function(){for(var a=!1,s=-1,g=-1,P=-1,f=-1,T=0;T<h&&!a;T++)for(var v=T+1;v<h&&!a;v++)i.areEqual(r[T],r[v])&&!i.areEqual(o[T],o[v])&&(0>s?(s=T,P=v):i.areEqual(r[s],r[T])||(g=T,f=v,a=!0));if(0<=s&&0<=P&&0<=g&&0<=f){var C=i.sub(o[s],o[P]),M=i.cross(C,r[s]),D=i.sub(o[g],o[f]),E=i.cross(D,r[g]),A=!1,_=i.angle(M,E);if(_>c&&_<Math.PI-c?0===(p=n.computeLinePlaneDistance(o[s],C,o[g],E)).returnCode&&p.relationship===t.Relationship.INTERSECTING&&0===(d=n.computeLinePlaneDistance(o[s],r[s],o[g],E)).returnCode&&d.relationship===t.Relationship.INTERSECTING&&(A=!0,m.aApex=p.aPosition,m.aAxis=i.normalize(i.sub(p.aPosition,d.aPosition))):0===(p=n.computeTwoLinesDistance(o[s],C,o[g],D)).returnCode&&p.relationship===t.Relationship.INTERSECTING&&0===(d=n.computeTwoLinesDistance(o[s],r[s],o[g],r[g])).returnCode&&d.relationship===t.Relationship.INTERSECTING&&(A=!0,m.aApex=p.aPosition1,m.aAxis=i.normalize(i.sub(p.aPosition1,d.aPosition1))),A&&m.aAxis){m.semiAngle=i.angle(C,m.aAxis);for(var S=0;S<y&&A;S++)l=i.sub(m.aApex,o[S]),_=i.angle(l,m.aAxis),A=e.areEqual(m.semiAngle,_);if(A){m.returnCode=0,m.type=t.GeometryType.CONE;var b=u._computeMinMaxProjection(o,m.aAxis,m.aApex);m.aPoint1=b.aPoint1,m.aPoint2=b.aPoint2}}}}()}return m},_recognizeSphere:function(n,o){var r={returnCode:1},a=n.length;if(a===o.length){for(var s,p,d,m,y,h=0,g=0,P=0,f=1;f<a&&0===P;f++)0===h?(s=i.sub(n[0],n[f]),i.length(s)>l&&(h=f)):0===g?(p=i.sub(n[0],n[f]),i.length(p)>l&&(y=i.angle(s,p))>c&&y<Math.PI-c&&(g=f,m=i.cross(s,p))):0===P&&(d=i.sub(n[0],n[f]),i.length(d)>l&&(y=i.angle(m,i.cross(s,d)))>c&&y<Math.PI-c&&(P=f));if(0!==h&&0!==g&&0!==P){var T=u._computeSphereThru4Points(n[0],n[h],n[g],n[P]);if(0===T.returnCode){for(var v,C,M=!0,D=0;D<a&&M;D++)C=i.sub(n[D],T.aCenter),v=i.length(C),M=e.areEqual(T.radius,v)&&i.areEqual(i.normalize(C),i.normalize(o[D]));M&&(r.returnCode=0,r.type=t.GeometryType.SPHERE,r.aCenter=T.aCenter,r.radius=T.radius)}}}return r},_recognizeCurve:function(e,n){var o={returnCode:0};if(o.type=t.GeometryType.CURVE,o.length=0,n){for(var r=e.length,a=0,s=0;s<r;s+=2)a+=i.length(i.sub(e[s],e[s+1]));o.length=a,o.aPoint1=e[0],o.aPoint2=e[r-1]}return o},_recognizeSurface:function(n,o){var r={returnCode:1};if(r.type=t.GeometryType.SURFACE,r.area=0,o){for(var a=n.length/3,s=0,l=[0,0,0],c=0;c<a;c++){var u=i.sub(n[3*c],n[3*c+1]),p=i.sub(n[3*c],n[3*c+2]),d=i.length(i.cross(u,p)),m=i.add(n[3*c],i.add(n[3*c+1],n[3*c+2]));s+=d,l=i.multiplyAndAdd(m,d,l)}r.returnCode=0,r.area=s/2,r.aCog=e.isZero(s)?[0,0,0]:i.multiply(l,1/(3*s))}return r},_computeMinMaxProjection:function(e,t,o,r){for(var a,s={returnCode:0},l=e.length,c=i.normalize(t),u=Number.MAX_VALUE,p=-Number.MAX_VALUE,d=[0,0,0],m=0,y=-1,h=0;h<l;h++)if((a=i.dot(i.sub(o,e[h],d),c))>p&&(p=a),a<u&&(u=a),r){var g=n.computePointLineDistance(e[h],o,t);g.distance>m&&(m=g.distance),(-1===y||g.distance<y)&&(y=g.distance)}return s.aPoint1=i.multiplyAndAdd(c,u,o),s.aPoint2=i.multiplyAndAdd(c,p,o),r&&(s.baseRadius=m,s.topRadius=y),s},_computeCircleThru3Points:function(e,n,o){var r={returnCode:1},a=i.sub(e,n),s=i.sub(n,o),l=i.cross(a,s);if(i.areEqual(e,n))r.aCenter=i.multiply(i.add(e,o),.5),l=i.cross([0,0,1],s);else if(i.areEqual(e,o))r.aCenter=i.multiply(i.add(e,n),.5),l=i.cross([0,0,1],a);else if(i.areEqual(n,o))r.aCenter=i.multiply(i.add(e,n),.5),l=i.cross([0,0,1],a);else{var c=i.squaredLength(l);if(c>1e-6){var u=(.5*i.squaredLength(s)+.5*i.dot(a,s))/c,p=i.multiplyAndAdd(a,.5,e);r.aCenter=i.multiplyAndAdd(i.cross(a,l),-u,p)}}return void 0!==r.aCenter&&(r.returnCode=0,r.type=t.GeometryType.CIRCLE,r.radius=i.subAndLength(r.aCenter,e),r.aNormal=i.normalize(l)),r},_computeSphereThru4Points:function(e,o,r,a){var s={returnCode:1},l=u._computeCircleThru3Points(e,o,r);if(0===l.returnCode){var c=u._computeCircleThru3Points(o,r,a);if(0===c.returnCode){var p=n.computeTwoLinesDistance(l.aCenter,l.aNormal,c.aCenter,c.aNormal);0===p.returnCode&&p.relationship===t.Relationship.INTERSECTING&&(s.returnCode=0,s.type=t.GeometryType.SPHERE,s.aCenter=p.aPosition1,s.radius=i.subAndLength(s.aCenter,e))}}return s},_buildVector3:function(e){return new r.Vector3(e[0],e[1],e[2])},verifyMesh:function(e){return window.console.log("DEPRECATED: use DMUMeshServices.verifyMesh"),o.verifyMesh(e)},extractMeshVertices:function(e,t){return window.console.log("DEPRECATED: use DMUMeshServices.extractMeshVertices"),o.extractMeshVertices(e,t)},extractMeshNormals:function(e,t){return window.console.log("DEPRECATED: use DMUMeshServices.extractMeshNormals"),o.extractMeshNormals(e,t)}};return u})),define("DS/DMUMeasurable/DMUSwitchRepService",["UWA/Core","DS/DMUMeasurable/DMUToolsSceneGraph"],(function(e,t){"use strict";return e.Class.extend({init:function(e){var i;if(e.viewerController)i=e.viewerController;else if(e.viewer){var n=t.getContextViewer({viewer:e.viewer});n.getController&&(i=n.getController())}this.retriveNodesFromPath=function(e,i){if(i||(i=[]),e){var n=t.getLastRepReference(e);if(n&&0===n.externalPath.length||!n){var o=(n=t.getLastReference(e)).getLastElement();if(o){var r=function(e){if(e)if(t.isRepReference(e))i.push(e);else{var n=[];try{n=e.getChildren()}catch(e){window.console.log("")}n.length>0&&n.forEach((function(e){r(e)}))}};r(o)}}var a=n.getLastElement(!0);a&&i.push(a)}},this.switchToAV1=function(e){var n=this;if(i){var o=e.timeoutDuration?e.timeoutDuration:500,r=e.path,a=[];if(e.nodes&&(a=e.nodes),r&&this.retriveNodesFromPath(r,a),a&&a.length){var s,l=!1,c=[],u=[],p=[],d=[];return a.forEach((function(n){e.doNotCheckforLoadStream||"cgr"!==i.getLoadedStream(n)?t.isReference(n)||(d.push({node:n,stream:"cgr"}),l=!0,c.push(t.getNodeID(n)),u.push(t.getNodeID(n))):p.push(t.getNodeID(n))})),l&&(s=setTimeout((function(){i.switchNodeVisuStreamOnDemand({data:d,autoLock:!1,callbacks:{onComplete:function(){(e.lockNodesAfterSwitch||e.lockMeshInRAMAfterSwitch)&&n.lockNodes({nodeIDsTolock:e.lockNodesAfterSwitch?c:void 0,nodeIDsTolockMeshInRAM:e.lockMeshInRAMAfterSwitch?u:void 0}),e.onCompleteCB&&e.onCompleteCB({nodeIDsOfLockedNodes:c,nodeIDsOflockedMeshInRAM:u})},onFailure:function(){e.onFailureCB&&e.onFailureCB({nodeIDsOfLockedNodes:c,nodeIDsOflockedMeshInRAM:u})}}})}),o)),{clearTimeout:function(){s&&clearTimeout(s)},nodeIDsOfAlreadyLoadedNode:p}}}},this.unlockNodes=function(e){var t=e.nodeIDsToUnlockMeshInRAM,n=e.nodeIDsToUnlock;i&&(t&&t.length&&t.forEach((function(e){i.unlockRepresentationMeshInRAM(e)})),n&&n.length&&i.unlockNodes({ids:n}))},this.lockNodes=function(e){var t=e.nodeIDsTolockMeshInRAM,n=e.nodeIDsTolock;i&&(t&&t.length&&t.forEach((function(e){i.lockRepresentationMeshInRAM(e)})),n&&n.length&&i.lockNodes({ids:n}))}}})})),define("DS/DMUMeasurable/DMUMeasurableElementAgent",["UWA/Core","DS/StateCommandEngine/PathElementAgent","DS/DMUMeasurable/DMUMeshRecognition","DS/DMUMeasurable/DMUGeometryEnums","DS/DMUMeasurable/DMUMeasureEnums","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUMeasurable/DMUSwitchRepService"],(function(e,t,i,n,o,r,a){"use strict";return t.extend({init:function(t){var i={pickingFilter:this._pickingFilter,prePickingFilter:this._prePickingFilter,activatePrePicking:!1,thisAgent:this};t.timeoutDurationForRepLoading&&(this.timeoutDurationForRepLoading=t.timeoutDurationForRepLoading),t.appli&&(this._appli=t.appli),t.checkAppli&&(this._checkAppli=t.checkAppli),t.displayAppli&&(this._displayAppli=t.displayAppli);var n=e.extend(i,t);t.switchRepOnPreSelection&&(this._switchRepOnPreSelection=t.switchRepOnPreSelection,this._switchRepOnPreSelection&&(this._switchRep={clearTimeout:null,lockedNodeIds:[]})),t.viewerController&&(this._viewerController=t.viewerController,this._switchService=new a({viewerController:this._viewerController})),this._parent(n)},_pickingFilter:function(e){var t=this.thisAgent._filter(e);return this.thisAgent._checkAppli&&(t=t&&this.thisAgent._checkAppli(e,this.thisAgent._appli)),this.thisAgent._condition=t,t&&this.thisAgent._clearTimeout(),t},_prePickingFilter:function(e){var t=!0,i=this;if(i.thisAgent.options.activatePrePicking){if(t=i.thisAgent._filter(e),i.thisAgent._checkAppli&&(t=t&&i.thisAgent._checkAppli(e,i.thisAgent._appli),i.thisAgent._switchRepOnPreSelection&&i.thisAgent._switchService)){i.thisAgent._clearTimeout();var n=[],o=!1;i.thisAgent._switchService.retriveNodesFromPath(e,n);for(var a=0;a<n.length;a++){var s=r.getNodeID(n[a]);if(-1===i.thisAgent._switchRep.lockedNodeIds.indexOf(s)){o=!0;break}}if(o){var l=i.thisAgent._switchService.switchToAV1({nodes:n,lockNodesAfterSwitch:!0,lockMeshInRAMAfterSwitch:!0,doNotCheckforLoadStream:!0,timeoutDuration:i.timeoutDurationForRepLoading,onCompleteCB:function(e){var t=e.nodeIDsOfLockedNodes;i.thisAgent._switchRep.clearTimeout=void 0,t&&t.length>0&&(i.thisAgent._switchRep.lockedNodeIds||(i.thisAgent._switchRep.lockedNodeIds=[]),t.forEach((function(e){-1===i.thisAgent._switchRep.lockedNodeIds.indexOf(e)&&i.thisAgent._switchRep.lockedNodeIds.push(e)})))},onFailureCB:function(){i.thisAgent._switchRep.clearTimeout=void 0}});if(l&&l.clearTimeout&&(i.thisAgent._switchRep.clearTimeout=l.clearTimeout),l&&l.nodeIDsOfAlreadyLoadedNode&&l.nodeIDsOfAlreadyLoadedNode.length){var c=[];l.nodeIDsOfAlreadyLoadedNode.forEach((function(e){-1===i.thisAgent._switchRep.lockedNodeIds.indexOf(e)&&(c.push(e),i.thisAgent._switchRep.lockedNodeIds.push(e)),c&&c.length&&(i.thisAgent._switchService.lockNodes({nodeIDsTolock:c,nodeIDsTolockMeshInRAM:c}),c=[])}))}}}}else t=!1;return i.thisAgent._condition=t,t},agentActionOnTheScene:function(e){this._parent(e),this._switchRepOnPreSelection&&0===this.currentPSO.length&&this._clearTimeout();var t=e.pickingResult;if(t&&e&&e.event){var i=this._viewer.getMousePosition(e.event.getCurrentPosition(this._viewer.canvas));t.mousePos=i}this._displayAppli&&(this._condition&&t&&t.position?(t.pathElement=this.currentPSO&&this.currentPSO.length?this.currentPSO[0].pathElement:void 0,this._displayAppli(t,this._appli)):this._appli&&this._appli._removePreVisuNode&&this._appli._removePreVisuNode())},deactivate:function(){this._activated&&(this._unlockNodes(),this._parent())},_filter:function(e,t){var a=this,s=e.getLastElement().sgNode,l=void 0!==s||void 0!==e.instanceId;if(a._appli&&a._appli._checkForSelection&&"2D"===a._appli._measureOnGeometryType){var c=[];if(c.push({pathElement:e}),!(l=a._appli._checkForSelection(c)))return l}if(l){if(void 0!==s){a.geometry=i.recognizeCanonicGeometry(s,e.getWorldMatrix(),!0);let t=-1;for(let i=e.externalPath.length-1;i>=0;--i){let n=e.externalPath[i];if(n&&"AxisSystems"===n.name){t=i;break}}if(t>=0&&t+1<e.externalPath.length&&(a.geometry={type:n.GeometryType.AXISSYSTEM}),0!==a.geometry.returnCode&&-1===t)switch(a.geometry={},s.getGroup().glType){case 1:a.geometry.type=n.GeometryType.CURVE;break;case 4:a.geometry.type=n.GeometryType.SURFACE;break;default:a.geometry.type=n.GeometryType.PICKINGPT}}else r.isAPOIPath(e)?a.geometry={type:n.GeometryType.POINT}:a.geometry={type:n.GeometryType.PICKINGPT};let c=t||a.options.acceptedGeometries;var u=c.length;if(l&&u>0){l=!1;for(var p=0;!l&&p<u;p++)l=a.geometry.type===c[p]}if(l&&0===u&&a.options.viewedGeometries&&a.options.viewedGeometries.length>0&&a.options.viewedGeometries.indexOf(o.ViewedType.PRODUCT)>=0){var d=r.getLastReference(e);e.externalPath=d.externalPath,e.internalPath=d.internalPath,l=!0}if(!l&&a._switchRepOnPreSelection&&a._viewerController){var m=r.getLastRepReference(e),y=m.getLastElement(!0);y&&"cgr"!==a._viewerController.getLoadedStream(y)&&(e.externalPath=m.externalPath,e.internalPath=m.internalPath,l=!0)}}else!function(){var t=a.cso.get();if(t){if(t.length>0){for(var i=!1,o=0;!i&&o<t.length;)t[o].pathElement.isEqual(e)&&(i=!0),o++;i||(l=!0)}else l=!0;l?a.geometry={type:n.GeometryType.PICKINGPT}:a._appli&&a._appli._objAction&&(a.geometry={type:n.GeometryType.PRODUCT},l=!0)}}();return l},_unlockNodes:function(){this._switchService&&this._switchRep&&(this._switchService.unlockNodes({nodeIDsToUnlock:this._switchRep.lockedNodeIds,nodeIDsToUnlockMeshInRAM:this._switchRep.lockedNodeIds}),this._switchRep.lockedNodeIds=[])},_clearTimeout:function(){this._switchRep&&this._switchRep.clearTimeout&&(this._switchRep.clearTimeout(),this._switchRep.clearTimeout=null)}})})),define("DS/DMUMeasurable/DMUToolsAvatars",["DS/DMUMeasurable/DMUToolsMaths","DS/Visualization/ThreeJS_DS","DS/Visualization/SceneGraphFactory","DS/SceneGraphNodes/FixedSizeNode3D","DS/Visualization/Node3D","DS/Robot/LineTranslationNode"],(function(e,t,i,n,o,r){"use strict";return{createCrossNode:function(o,r,a,s){var l=new t.Vector3(o,0,0),c=new t.Vector3(0,o,0),u=new t.Vector3,p=u.clone().add(l).add(c),d=u.clone().sub(l).add(c),m=u.clone().add(l).sub(c),y=[p,u.clone().sub(l).sub(c),u,d,m],h=i.createLineNode({points:y,material:s});h.setShadow(!1);var g=new n({name:"myFixedSizeNode",ratio:1});g.add(h);var P=e.computeTransformationBetweenTwoLines(new t.Vector3,new t.Vector3(0,0,1),r,a);return g.setMatrix(P.transformation),g},createLineNode:function(e,t,n){var o=[e.clone(),t.clone()],r=i.createLineNode({points:o,material:n});return r.setShadow(!1),r},createRectangleNode:function(n,o,r,a,s,l){var c=!1;l&&(c=l);var u=i.createRectangleNode({width:n,height:o,material:s,fill:c});u.setShadow(!1);var p=e.computeTransformationBetweenTwoLines(new t.Vector3(n/2,o/2,0),new t.Vector3(0,0,1),r,a);return u.setMatrix(p.transformation),u.setNoHighlightNoZ(!0),u},createCircleNode:function(n,o,r,a){var s=Math.round(2*Math.PI/Math.acos(1-.2/n)),l=i.createCircleNode({radius:n,segments:s,material:a});l.setShadow(!1);var c=e.computeTransformationBetweenTwoLines(new t.Vector3,new t.Vector3(0,0,1),o,r);return l.setMatrix(c.transformation),l},createArcNode:function(e,n,o,r,a,s){var l=Math.round(2*Math.PI/Math.acos(1-.2/e)),c=o.angleTo(r),u=0;void 0!==s&&!0===s&&(u=c,c=2*Math.PI);var p=i.createCircleNode({radius:e,segments:l,startAngle:u,endAngle:c,material:a});p.setShadow(!1);var d=o.clone().normalize(),m=o.clone().cross(r).normalize(),y=m.clone().cross(o).normalize(),h=new t.Matrix4(d.x,y.x,m.x,0,d.y,y.y,m.y,0,d.z,y.z,m.z,0,0,0,0,1);return p.setMatrix(h.setPosition(n)),p},createSurfaceNode:function(e,t,n){var r,a=!1;n&&(a=n);var s=new o,l=e/2,c=Math.round(2*Math.PI/Math.acos(1-.2/l));return(r=i.createCircleNode({radius:l,segments:c,material:t,fill:a})).setShadow(!1),s.addChild(r),s},createArrowNormalNode:function(){var e,i={position:new t.Vector3(0,0,0),touchMode:!1},a=new o,s=new n({name:"fixedSizeNode3D",ratio:7});return(e=new r(i)).name="normalArrowTranslationNode",e.mat.color=new t.Color(15096832),e.mat.opacity=1,e.setNoHighlightNoZ(!0),s.addChild(e),a.addChild(s),a}}})),define("DS/DMUMeasurable/DMUPreVisuNode3D",["DS/DMUMeasurable/DMUMeasureEnums","DS/DMUMeasurable/DMUGeometryEnums","DS/DMUMeasurable/DMUToolsAvatars","DS/Visualization/ThreeJS_DS","DS/Visualization/SceneGraphFactory","DS/Visualization/Node3D","DS/Mesh/Mesh","DS/DMUMeasurable/DMUMathsInfiniteGeometry","DS/DMUMeasurable/DMUToolsMaterial","DS/DMUMeasurable/DMUToolsMaths","DS/SceneGraphNodes/AxisSystemNode","DS/Mesh/MeshUtils","DS/DMUMeasurable/DMUToolsSceneGraph"],(function(e,t,i,n,o,r,a,s,l,c,u,p,d){"use strict";return r.extend({init:function(m){this._parent();var y,h,g=m;function P(e,t){t.setPickParent(!0),t.setVisibilityInTree(!1),e.addChild(t)}function f(e){if(e){var t=(new n.Matrix4).lookAt(new n.Vector3,e.getSightDirection(),e.getUpDirection()),i=(new n.Quaternion).setFromRotationMatrix(t),o=c.quaternionToAxisSystem(i);return{position:e.getEyePosition(),sight:e.getSightDirection(),right:o.X,up:e.getUpDirection(),distance:e.getTargetDistance(),angle:e.getAngle(),projectionType:e.getProjectionType()}}}function T(e,t,i){var o=function(e,t){var i=(new n.Projector).projectVector(t.clone(),e.viewpoints[0].getCamera()),o=Math.round((0-i.y)*(e.canvas.offsetHeight/2)+e.canvas.offsetHeight/2),r=Math.round(i.x*(e.canvas.offsetWidth/2)+e.canvas.offsetWidth/2);return{top:o,left:r,bottom:e.canvas.offsetHeight-o,right:e.canvas.offsetWidth-r,inWindow:o>0&&o<e.canvas.offsetHeight&&r>0&&r<e.canvas.offsetWidth}}(e,t),r=function(e,t,i){var o=new n.Vector3((t-window.pageXOffset)/e.canvas.offsetWidth*2-1,-(i-window.pageYOffset)/e.canvas.offsetHeight*2+1,.5),r=(new n.Projector).pickingRay(o,e.currentViewpoint.camera);return{position:r.ray.origin,direction:r.ray.direction}}(e,o.left+i,o.top);return s.computePointLineDistance(t.toArray(),r.position.toArray(),r.direction.toArray()).distance}var v={};v.preSolidLine=l.retrieveMaterialFromGAS({color:new n.Color(16753920),lineWidth:window.devicePixelRatio,pattern:a.LinePatternEnum.SOLID}),v.dotDashedLine=l.retrieveMaterialFromGAS({color:new n.Color(16753920),lineWidth:window.devicePixelRatio+1,pattern:a.LinePatternEnum.DOTDASHED}),v.concentricPoint=l.retrieveMaterialFromGAS({symbol:3,size:10,color:new n.Color(15096832)}),v.crossPointPreHighlight=l.retrieveMaterialFromGAS({symbol:1,size:10,color:new n.Color(15096832)}),v.fullCirclePoint=l.retrieveMaterialFromGAS({symbol:5,size:10,color:new n.Color(15096832)}),v.preFaceMaterial=l.retrieveMaterialFromGAS({color:new n.Color(16753920),opacity:.5}),v.preFaceMaterial.force=!0,v.preSolidLine.force=!0,v.preFaceMaterial.line=v.preSolidLine;var C=new r;P(this,C),this.buildPreVisuNode=function(r){if(r&&r.data&&(r.data.getType||r.data.resultType)){r.data.onlyUpdatePos||C.removeChildren();var a,s,l,m,M,D,E,A,_,S,b,N,I,w,R,x,V=r.point||(r.data.getSelPoint?r.data.getSelPoint():null);if(void 0===r.data.resultType){var L=r.data.getType();if(void 0===L)return;switch(L){case t.GeometryType.POINT:case t.GeometryType.PICKINGPT:a=e.ResultType.POINT;break;case t.GeometryType.CURVE:a=e.ResultType.CURVE;break;case t.GeometryType.LINE:a=e.ResultType.LINE;break;case t.GeometryType.CIRCLE:a=e.ResultType.CIRCLE;break;case t.GeometryType.SURFACE:a=e.ResultType.SURFACE;break;case t.GeometryType.PLANE:a=e.ResultType.PLANE;break;case t.GeometryType.CYLINDER:a=e.ResultType.CYLINDER;break;case t.GeometryType.CONE:a=e.ResultType.CONE;break;case t.GeometryType.SPHERE:a=e.ResultType.SPHERE;break;case t.GeometryType.PRODUCT:a=e.ResultType.PRODUCT;break;default:return}}else a=r.resultType?r.resultType:r.data.resultType;var G="Default";switch(r.data.drawMode&&(G=r.data.drawMode),a){case e.ResultType.POINT:case e.ResultType.CENTER:if(!(s=a===e.ResultType.POINT?V?V.toArray():r.data.getPoint?r.data.getPoint().toArray():void 0:r.data.getCenter().toArray()))return;r.data.getType()!==t.GeometryType.POINT&&(v.concentricPoint.force=!0,v.crossPointPreHighlight.force=!0,D=o.createPointsNode({positions:s,material:a!==e.ResultType.POINT?v.crossPointPreHighlight:v.concentricPoint}),P(C,D));break;case e.ResultType.LINE:case e.ResultType.CURVE:s=(l=r.data.getPoints()).beginPoint.toArray(),v.fullCirclePoint.force=!0,D=o.createPointsNode({positions:s,material:v.fullCirclePoint}),P(C,D),s=l.endPoint.toArray(),D=o.createPointsNode({positions:s,material:v.fullCirclePoint}),P(C,D);break;case e.ResultType.AXIS:A=(l=r.data.getPoints()).beginPoint.clone().sub(l.endPoint),_=30,S=T(g,l.beginPoint,_),A.normalize().multiplyScalar(S),b=l.beginPoint.clone().add(A),N=l.endPoint.clone().sub(A);var O=i.createLineNode(b,N,v.dotDashedLine);P(C,O);break;case e.ResultType.CIRCLE:var B=r.data.getRadius();r.data.scale2D&&(B*=r.data.get2DScale()),E=i.createCircleNode(B,r.data.getCenter(),r.data.getAxis(),v.preSolidLine),P(C,E);break;case e.ResultType.PLANE:if("Measure"!==G){if(!(s=V||(r.data.getCOG?r.data.getCOG():void 0)))return;x=T(g,s,50);var U=i.createRectangleNode(x,x,s,r.data.getPlane().normal,v.preFaceMaterial,!0);P(C,U)}break;case e.ResultType.CYLINDER:if(l=r.data.getPoints(),"Measure"===G){m=l.beginPoint,V&&(M=V.clone().sub(l.beginPoint),V.clone().sub(l.endPoint).length()<M.length()&&(m=l.endPoint));var q=l.endPoint.clone().sub(l.beginPoint);E=i.createCircleNode(r.data.getRadius(),m,q,v.preSolidLine),P(C,E)}A=l.beginPoint.clone().sub(l.endPoint),_=30,S=T(g,l.beginPoint,_),A.normalize().multiplyScalar(S),b=l.beginPoint.clone().add(A),N=l.endPoint.clone().sub(A);var z=i.createLineNode(b,N,v.dotDashedLine);P(C,z);break;case e.ResultType.CONE:l=r.data.getPoints();var F=r.data.getAxis();if("Measure"===G){var k=r.data.getApex(),H=r.data.getSemiAngle();m=l.endPoint;var W=l.beginPoint,Y=k.clone(),X=k.clone().sub(l.beginPoint).length()*Math.tan(H),j=k.clone().sub(m).length()*Math.tan(H),Z=i.createCircleNode(j,m,F,v.preSolidLine);P(C,Z),I=f(g.currentViewpoint);var J=(new n.Vector3).crossVectors(F.clone().negate(),I.sight.clone().negate());J.length()>.001?J.normalize().multiplyScalar(j):J=I.right.clone().normalize().multiplyScalar(j);var K=m.clone().add(J),Q=m.clone().sub(J),$=(new n.Vector3).crossVectors(F,J),ee=(new n.Plane).setFromNormalAndCoplanarPoint($,m);if(w=Math.PI/4,V){var te=ee.projectPoint(V);M=K.clone().sub(te),Q.clone().sub(te).length()<M.length()&&(w*=3)}R=(new n.Matrix4).makeRotationAxis(F,w);var ie=J.clone().normalize().applyMatrix4(R);if(ie=ie.clone().normalize().multiplyScalar(j),K=m.clone().add(ie),X>.001){var ne=ie.clone().normalize().multiplyScalar(X);Y=W.clone().add(ne)}P(C,i.createLineNode(K,Y.clone(),v.preSolidLine))}_=30,S=T(g,l.beginPoint,_),F.normalize().multiplyScalar(S),b=l.beginPoint.clone().sub(F),N=l.endPoint.clone().add(F);var oe=i.createLineNode(b,N,v.dotDashedLine);P(C,oe);break;case e.ResultType.SPHERE:var re=r.data.getRadius();m=r.data.getCenter();var ae=(I=f(g.currentViewpoint)).up.clone();ae=ae.negate();var se=I.right.clone().normalize().multiplyScalar(re);w=Math.PI/4,R=(new n.Matrix4).makeRotationAxis(ae.clone().normalize(),w);var le=se.clone().applyMatrix4(R),ce=(new n.Vector3).crossVectors(ae,le.clone().normalize());P(C,i.createCircleNode(re,m,ce,v.preSolidLine));break;case e.ResultType.SURFACE:s=V||(r.data.getCOG?r.data.getCOG():void 0);var ue=r.normal?r.normal:r.data.getNormal?r.data.getNormal():r.data.normal;if(!s||!ue)return;x=T(g,s,50);var pe=g.currentViewpoint;if(r.data.onlyUpdatePos&&y||(C.removeChildren(),h=void 0,y=i.createSurfaceNode(x,v.preFaceMaterial,!0),P(C,y)),r.data.onlyUpdatePos&&h||(h=i.createArrowNormalNode(pe),P(C,h)),h&&h.setMatrix(d.getMatFromNormWithPos(ue,s)),y){var de=c.computeTransformationBetweenTwoLines(new n.Vector3,new n.Vector3(0,0,1),s,ue);y.setMatrix(de.transformation)}break;case e.ResultType.PRODUCT:var me=r.data.worldMatrix?r.data.worldMatrix:void 0;if(me){var ye=new u({headLength:10,arrowLength:50,arrowWidth:2,head:u.types.ARROW,colors:{colorX:new p.Color(1,0,0,0),colorY:new p.Color(0,1,0,0),colorZ:new p.Color(0,0,1,0)}});ye.setMatrix(me),P(C,ye)}}}},this.remove=function(){C&&(C.removeChildren(),C.remove(),C=void 0),y&&(y.removeChildren(),y.remove(),y=void 0),h&&(h.removeChildren(),h.remove(),h=void 0)}}})})),define("DS/DMUMeasurable/DMUMathsFiniteGeometry",["DS/DMUMeasurable/DMUMathsVector3D","DS/DMUMeasurable/DMUMathsInfiniteGeometry","DS/DMUMeasurable/DMUGeometryEnums"],(function(e,t,i){"use strict";var n=1e-6,o={computePointSegmentDistance:function(t,o,r,a){var s={returnCode:1};if(t&&o&&r){s.returnCode=2;var l=void 0!==a?a:Number.MAX_VALUE;if(l>n){var c=e.sub(t,o),u=e.sub(o,r),p=-e.dot(c,u);if(p<=0)s.aPosition=e.clone(o),l=e.squaredLength(c);else{var d=e.squaredLength(u);d<n?(s.aPosition=e.clone(o),l=e.squaredLength(c)):(p/=d)>=1?(s.aPosition=e.clone(r),l=e.subAndSquaredLength(r,t)):(s.aPosition=e.multiplyAndAdd(u,p,o),l=e.subAndSquaredLength(s.aPosition,t))}(void 0===a||a>l)&&(s.returnCode=0,s.squaredDistance=l,s.distance=Math.sqrt(l),s.relationship=l<n?i.Relationship.COINCIDENT:i.Relationship.NONE)}}return s},computePointTriangleDistance:function(t,r,a,s,l){var c={};if(c.returnCode=1,t&&r&&a&&s){c.returnCode=2;var u=e.sub(r,a),p=e.squaredLength(u),d=e.sub(r,s),m=e.squaredLength(d),y=e.sub(a,s),h=e.squaredLength(y);p<n?c=o.computePointSegmentDistance(t,r,s):m<n||h<n?c=o.computePointSegmentDistance(t,r,a):function(o,a,s,u){var p=e.sub(t,r),d=e.dot(o,a),m=e.dot(o,p),y=e.dot(a,p),h=s*u-d*d,g=d*y-u*m,P=d*m-s*y;if(g+P<=h)g<0?P<0?m<0?(P=0,g=-m>=s?1:-m/s):(g=0,P=y>=0?0:-y>=u?1:P=-y/u):(g=0,P=y>=0?0:-y>=u?1:-y/u):P<0?(P=0,g=m>=0?0:-m>=s?1:-m/s):(g*=h=1/h,P*=h);else{var f=0,T=0,v=0,C=0;g<0||P<0?(T=u+y)>(f=d+m)?P=1-(g=(v=T-f)>=(C=s-2*d+u)?1:v/C):(g=0,P=T<=0?1:y>=0?0:-y/u):P=1-(g=(v=u+y-d-m)<=0?0:v>=(C=s-2*d+u)?1:v/C)}c.aPosition=e.multiplyAndAdd(a,P,e.multiplyAndAdd(o,g,r)),c.squaredDistance=e.subAndSquaredLength(c.aPosition,t),(void 0===l||c.squaredDistance<l)&&(c.relationship=c.squaredDistance<n?i.Relationship.COINCIDENT:i.Relationship.NONE,c.returnCode=0)}(u,d,p,m)}return c},computeTwoSegmentsDistance:function(t,r,a,s,l){var c={returnCode:1};if(t&&r&&a&&s){if(c.returnCode=2,e.areEqual(t,r))return(c=o.computePointSegmentDistance(t,a,s,l)).angle=0,c.aPosition1=e.clone(t),c.aPosition2=c.aPosition,c;if(e.areEqual(a,s))return(c=o.computePointSegmentDistance(a,t,r,l)).angle=0,c.aPosition1=c.aPosition,c.aPosition2=e.clone(a),c;var u=!1,p=e.sub(t,r),d=e.sub(a,s),m=e.cross(p,d),y=e.squaredLength(m),h=0,g=0,P=0,f=0,T=0,v=0,C=0,M=0,D=0,E=0;if(y>n*e.squaredLength(p)*e.squaredLength(d)){if(P=e.sub(t,a),E=e.dot(P,m),E*=E,void 0!==l&&E>l*y)return c;var A=e.cross(m,P);v=e.dot(A,p),C=e.dot(A,d);var _=!1;v<=0?T=e.clone(a):v>=y?T=e.clone(s):_=1;var S=!1;if(C<=0?f=e.clone(t):C>=y?f=e.clone(r):S=1,_||S)if(M=0,_&&S){var b=1/y;v*=b,C*=b,T=e.multiplyAndAdd(d,v,a),f=e.multiplyAndAdd(p,C,t),E*=b}else if(_){if(h=e.sub(a,f),M=e.squaredLength(d),m=e.cross(d,h),E=e.squaredLength(m),void 0!==l&&E>l*M)return c;if((D=e.dot(d,h))<=0){if(T=e.clone(a),E=e.squaredLength(e.sub(T,f)),void 0!==l&&E>l*M)return c}else if(D>=M){if(T=e.clone(s),E=e.squaredLength(e.sub(T,f)),void 0!==l&&E>l*M)return c}else E*=M=1/M,D*=M,T=e.multiplyAndAdd(d,D,a)}else{if(g=e.sub(T,t),M=e.squaredLength(p),m=e.cross(p,g),E=e.squaredLength(m),void 0!==l&&E>l*M)return c;if((D=-(D=e.dot(p,g)))<=0){if(f=e.clone(t),E=e.squaredLength(e.sub(T,f)),void 0!==l&&E>l*M)return c}else if(D>=M){if(f=e.clone(r),E=e.squaredLength(e.sub(T,f)),void 0!==l&&E>l*M)return c}else E*=M=1/M,D*=M,f=e.multiplyAndAdd(p,D,t)}else{var N;g=e.sub(T,t),C=-e.dot(g,p),M=e.squaredLength(p),C<=0?N=e.clone(t):C>=M?N=e.clone(r):(C/=M,N=e.multiplyAndAdd(p,C,t));var I,w=e.subAndSquaredLength(T,N);h=e.sub(a,f),v=e.dot(h,d),D=e.squaredLength(d),v<=0?I=e.clone(a):v>=D?I=e.clone(s):(v/=D,I=e.multiplyAndAdd(d,v,a));var R=e.subAndSquaredLength(f,I);if(w<=R){if(void 0!==l&&w>l)return c;E=w,f=N}else{if(void 0!==l&&R>l)return c;E=R,T=I}}}else{u=!0,M=e.squaredLength(d),P=e.sub(a,t),v=e.dot(P,d);var x=e.sub(a,r);if(C=e.dot(x,d),M<n||Math.abs(v-C)<n)return c;if(v>M?C>M?(T=e.clone(s),f=C>=v?e.clone(t):e.clone(r)):C>=0?(f=e.clone(r),C/=M,T=e.multiplyAndAdd(d,C,a)):(T=e.clone(a),C=v/(v-C),f=e.multiplyAndAdd(p,C,t)):v<0?C<0?(T=e.clone(a),f=C<v?e.clone(t):e.clone(r)):C<=M?(f=e.clone(r),C/=M,T=e.multiplyAndAdd(d,C,a)):(T=e.clone(a),C=v/(v-C),f=e.multiplyAndAdd(p,C,t)):(f=e.clone(t),v/=M,T=e.multiplyAndAdd(d,v,a)),E=e.squaredLength(e.sub(T,f)),void 0!==l&&E>l)return c}(void 0===l||E<l)&&(c.squaredDistance=E,c.distance=Math.sqrt(E),u?(c.relationship=c.distance<.001?i.Relationship.COINCIDENT:i.Relationship.PARRALLEL,c.angle=0):(c.relationship=c.distance<.001?i.Relationship.INTERSECTING:i.Relationship.NONE,c.angle=e.angle(p,d)),c.aPosition1=f,c.aPosition2=T,c.returnCode=0)}return c},computeSegmentTriangleSquaredDistance:function(r,a,s,l,c,u){var p,d={};if(d.returnCode=1,r&&a&&s&&l&&c){d.returnCode=2;var m=void 0!==u?u:Number.MAX_VALUE;if(m>n){var y,h,g=!1,P=e.sub(s,l),f=e.sub(s,c),T=e.cross(P,f);e.normalize(T)||(T=e.multiply(T,1e3));var v=e.sub(s,r),C=e.sub(s,a),M=e.dot(T,v),D=e.dot(T,C);if(M>0&&D<0||M<0&&D>0){var E=e.sub(r,a);0===(p=t.computeLinePlaneDistance(r,E,s,T)).returnCode&&p.aPosition&&2!==(p=o.computePointTriangleDistance(p.aPosition,s,l,c,m)).returnCode&&p.relationship===i.Relationship.COINCIDENT&&(m=p.squaredDistance,y=e.clone(p.aPosition),h=e.clone(p.aPosition),g=!0)}if(!g){for(var A=[r,a],_=[s,l,c,s],S=0;S<3&&m>n;S++)2!==(p=o.computeTwoSegmentsDistance(r,a,_[S],_[S+1],m)).returnCode&&(m=p.squaredDistance,y=e.clone(p.aPosition1),h=e.clone(p.aPosition2),g=!0);for(var b=0;b<2&&m>n;b++)2!==(p=o.computePointTriangleDistance(A[b],s,l,c,m)).returnCode&&(m=p.squaredDistance,y=e.clone(A[b]),h=e.clone(p.aPosition),g=!0)}g&&(d.returnCode=0,d.squaredDistance=m,d.aPosition1=y,d.aPosition2=h,d.angle=0,d.relationship=d.squaredDistance<n?i.Relationship.INTERSECTING:i.Relationship.NONE)}}return d},computeTwoTrianglesSquaredDistance:function(t,r,a,s,l,c,u){var p={returnCode:1};if(t&&r&&s&&l&&c){p.returnCode=2;var d=void 0!==u?u:Number.MAX_VALUE;if(d>n){for(var m,y,h,g=[t,r,a,t],P=[s,l,c,s],f=!1,T=0;T<3&&d>n;T++)2!==(h=o.computeSegmentTriangleSquaredDistance(g[T],g[T+1],s,l,c,d)).returnCode&&(d=h.squaredDistance,m=e.clone(h.aPosition1),y=e.clone(h.aPosition2),f=!0);for(var v=0;v<3&&d>n;v++)2!==(h=o.computeSegmentTriangleSquaredDistance(P[v],P[v+1],t,r,a,d)).returnCode&&(d=h.squaredDistance,m=e.clone(h.aPosition2),y=e.clone(h.aPosition1),f=!0);f&&(p.returnCode=0,p.squaredDistance=d,p.aPosition1=m,p.aPosition2=y,p.angle=0,p.relationship=i.Relationship.NONE)}}return p}};return o})),define("DS/DMUMeasurable/DMUMeshMeasure",["DS/DMUMeasurable/DMUMathsVector3D","DS/DMUMeasurable/DMUMathsFiniteGeometry","DS/DMUMeasurable/DMUMathsBoundingGeometry","DS/DMUMeasurable/DMUMeshServices"],(function(e,t,i,n){"use strict";var o=1e-6,r={computePointMeshSquaredDistance:function(e,t,i,o){var a={returnCode:1};if(t&&t.getGroup()&&t.getGroup().geometry&&void 0!==t.getStart()&&void 0!==t.getCount()&&t.getCount()>0){var s=t.getCount(),l=t.getGroup().glType,c=n.extractMeshVertices(t,i.elements),u=1===l?s/2:s/3;1===l?a=r._computePointCurveSquaredDistance(e,u,c,o):4===l&&(a=r._computePointSurfaceSquaredDistance(e,u,c,o))}return a},_computePointMeshSquaredMaxDistance:function(t,o,r,a){var s={returnCode:1};if(o&&o.getGroup()&&o.getGroup().geometry&&void 0!==o.getStart()&&void 0!==o.getCount()&&o.getCount()>0){s.returnCode=2;var l,c=n.extractMeshVertices(o,r.elements,void 0,!0),u=c.length,p=a||0,d=[0,0,0],m=i.computeAABBForPoint(t),y=i.computeAABBForPoints(c),h=i.computeAABBSquaredMaxDistance(m,y);if(h>p){for(var g=0;g<u;g++)(h=e.subAndSquaredLength(t,c[g],d))>p&&(p=h,l=e.clone(c[g]),s.returnCode=0);0===s.returnCode&&(s.squaredMaxDistance=p,s.aPosition1=t,s.aPosition2=l)}}return s},computeTwoMeshesSquaredDistance:function(e,t,i,o,a){var s={returnCode:1},l=e&&e.getGroup()&&e.getGroup().geometry&&void 0!==e.getStart()&&void 0!==e.getCount()&&e.getCount()>0,c=i&&i.getGroup()&&i.getGroup().geometry&&void 0!==i.getStart()&&void 0!==i.getCount()&&i.getCount()>0;if(l&&c){var u=e.getCount(),p=e.getGroup().glType,d=n.extractMeshVertices(e,t.elements),m=1===p?u/2:u/3,y=i.getCount(),h=i.getGroup().glType,g=n.extractMeshVertices(i,o.elements),P=1===h?y/2:y/3;if(1===p)1===h?s=r._computeTwoCurvesSquaredDistance(m,d,P,g,a):4===h&&(s=r._computeCurveSurfaceSquaredDistance(m,d,P,g,a));else if(4===p)if(1===h){var f=(s=r._computeCurveSurfaceSquaredDistance(P,g,m,d,a)).aPosition1;s.aPosition1=s.aPosition2,s.aPosition2=f}else 4===h&&(s=r._computeSurfaceSurfaceSquaredDistance(m,d,P,g,a))}return s},_computeTwoMeshesSquaredMaxDistance:function(t,o,r,a,s){var l={returnCode:1},c=t&&t.getGroup()&&t.getGroup().geometry&&void 0!==t.getStart()&&void 0!==t.getCount()&&t.getCount()>0,u=r&&r.getGroup()&&r.getGroup().geometry&&void 0!==r.getStart()&&void 0!==r.getCount()&&r.getCount()>0;if(c&&u){l.returnCode=2;var p,d,m=n.extractMeshVertices(t,o.elements),y=m.length,h=n.extractMeshVertices(r,a.elements),g=h.length,P=s||0,f=[0,0,0],T=i.computeAABBForPoints(m),v=i.computeAABBForPoints(h),C=i.computeAABBSquaredMaxDistance(T,v);if(C>P){for(var M=0;M<y;M++)for(var D=0;D<g;D++)(C=e.subAndSquaredLength(m[M],h[D],f))>P&&(P=C,p=e.clone(m[M]),d=e.clone(h[D]),l.returnCode=0);0===l.returnCode&&(l.squaredMaxDistance=P,l.aPosition1=p,l.aPosition2=d)}}return l},_computePointCurveSquaredDistance:function(n,r,a,s){var l={returnCode:1};if(void 0!==r&&a){l.returnCode=2;for(var c,u=s||Number.MAX_VALUE,p=i.computeAABBForPoint(n),d=0;d<r&&u>o;d++){var m=i.computeAABBForSegment(a[2*d],a[2*d+1]);if(i.computeAABBSquaredDistance(p,m)<u){var y=t.computePointSegmentDistance(n,a[2*d],a[2*d+1],u);2!==y.returnCode&&(l.returnCode=0,u=y.squaredDistance,c=e.clone(y.aPosition))}}0===l.returnCode&&(l.squaredDistance=u,l.aPosition1=n,l.aPosition2=c)}return l},_computePointSurfaceSquaredDistance:function(n,r,a,s){var l={returnCode:1};if(void 0!==r&&a){l.returnCode=2;for(var c,u=s||Number.MAX_VALUE,p=i.computeAABBForPoint(n),d=0;d<r&&u>o;d++){var m=i.computeAABBForTriangle(a[3*d],a[3*d+1],a[3*d+2]);if(i.computeAABBSquaredDistance(p,m)<u){var y=t.computePointTriangleDistance(n,a[3*d],a[3*d+1],a[3*d+2],u);2!==y.returnCode&&(l.returnCode=0,u=y.squaredDistance,c=e.clone(y.aPosition))}}0===l.returnCode&&(l.squaredDistance=u,l.aPosition1=n,l.aPosition2=c)}return l},_computeTwoCurvesSquaredDistance:function(n,r,a,s,l){var c={returnCode:1};if(void 0!==n&&r&&void 0!==a&&s){c.returnCode=2;for(var u,p,d=l||Number.MAX_VALUE,m=0;m<n&&d>o;m++)for(var y=i.computeAABBForSegment(r[2*m],r[2*m+1]),h=0;h<a&&d>o;h++){var g=i.computeAABBForSegment(s[2*h],s[2*h+1]);if(i.computeAABBSquaredDistance(y,g)<d){var P=t.computeTwoSegmentsDistance(r[2*m],r[2*m+1],s[2*h],s[2*h+1],d);2!==P.returnCode&&(c.returnCode=0,d=P.squaredDistance,u=e.clone(P.aPosition1),p=e.clone(P.aPosition2))}}0===c.returnCode&&(c.squaredDistance=d,c.aPosition1=u,c.aPosition2=p)}return c},_computeCurveSurfaceSquaredDistance:function(n,r,a,s,l){var c={returnCode:1};if(void 0!==n&&r&&void 0!==a&&s){c.returnCode=2;for(var u,p,d=l||Number.MAX_VALUE,m=0;m<n&&d>o;m++)for(var y=i.computeAABBForSegment(r[2*m],r[2*m+1]),h=0;h<a&&d>o;h++){var g=i.computeAABBForTriangle(s[3*h],s[3*h+1],s[3*h+2]);if(i.computeAABBSquaredDistance(y,g)<d){var P=t.computeSegmentTriangleSquaredDistance(r[2*m],r[2*m+1],s[3*h],s[3*h+1],s[3*h+2],d);2!==P.returnCode&&(c.returnCode=0,d=P.squaredDistance,u=e.clone(P.aPosition1),p=e.clone(P.aPosition2))}}0===c.returnCode&&(c.squaredDistance=d,c.aPosition1=u,c.aPosition2=p)}return c},_computeSurfaceSurfaceSquaredDistance:function(n,r,a,s,l){var c={returnCode:1};if(void 0!==n&&r&&void 0!==a&&s){c.returnCode=2;var u,p,d,m,y,h,g=l||Number.MAX_VALUE,P=[];n>a?(u=n,p=a,d=r,m=s):(u=a,p=n,d=s,m=r);for(var f=0;f<u&&g>o;f++)for(var T=i.computeAABBForTriangle(d[3*f],d[3*f+1],d[3*f+2]),v=0;v<p&&g>o;v++){if(void 0===P[v]&&(P[v]=i.computeAABBForTriangle(m[3*v],m[3*v+1],m[3*v+2])),i.computeAABBSquaredDistance(T,P[v])<g){var C=t.computeTwoTrianglesSquaredDistance(d[3*f],d[3*f+1],d[3*f+2],m[3*v],m[3*v+1],m[3*v+2],g);2!==C.returnCode&&(c.returnCode=0,g=C.squaredDistance,y=e.clone(C.aPosition1),h=e.clone(C.aPosition2))}}0===c.returnCode&&(c.squaredDistance=g,n>a?(c.aPosition1=y,c.aPosition2=h):(c.aPosition1=h,c.aPosition2=y))}return c},_computePointCurveSquaredMaxDistance:function(n,r,a,s){var l={returnCode:1};if(void 0!==r&&a){l.returnCode=2;for(var c,u=s||Number.MAX_VALUE,p=i.computeAABBForPoint(n),d=0;d<r&&u>o;d++){var m=i.computeAABBForSegment(a[2*d],a[2*d+1]);if(i.computeAABBSquaredMaxDistance(p,m)<u){var y=t.computePointSegmentDistance(n,a[2*d],a[2*d+1],u);2!==y.returnCode&&(l.returnCode=0,u=y.squaredDistance,c=e.clone(y.aPosition))}}0===l.returnCode&&(l.squaredMaxDistance=u,l.aPosition1=n,l.aPosition2=c)}return l}};return r})),define("DS/DMUMeasurable/DMUToolsMeasure",["DS/DMUMeasurable/DMUMathsInfiniteGeometry","DS/DMUMeasurable/DMUMathsBoundingGeometry","DS/DMUMeasurable/DMUGeometryEnums","DS/DMUMeasurable/DMUMathsVector3D","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUMeasurable/DMUMeshServices","DS/DMUMeasurable/DMUMeshMeasure","DS/DMUMeasurable/DMUToolsMaths","DS/DMUMeasurable/DMUMeasureEnums","DS/Visualization/ThreeJS_DS","DS/Visualization/SubElement","DS/DMUMeasurable/DMUMeshRecognition","DS/Mesh/MeshUtils"],(function(e,t,i,n,o,r,a,s,l,c,u,p,d){"use strict";var m=1e-6,y=function(e){var t=o.getLastReference(e);return t&&t.getLastElement(!0)||(t=o.getLastRepReference(e))&&t.getLastElement(!0)?t:e.clone()},h=function(t,n,o,r,a){var s={};if("Distance"!==a||t._type!==i.GeometryType.POINT&&n!==l.ViewedType.POINT)return s;n=l.ViewedType.POINT;var u,p=t.getSelPoint().toArray(),d=!1,m=o._type;if(m===i.GeometryType.POINT||r===l.ViewedType.POINT)u=o.getSelPoint().toArray(),r=l.ViewedType.POINT,d=!0;else if(m===i.GeometryType.CIRCLE)u=o.getCenter().toArray(),r=l.ViewedType.CIRCLE,d=!0;else if(m===i.GeometryType.SPHERE)u=o.getCenter().toArray(),r=l.ViewedType.CYCOSP,d=!0;else if(m===i.GeometryType.PLANE)r=l.ViewedType.INFPLANE,s=e.measureBetweenInfinite(t,n,o,r);else if(m===i.GeometryType.CYLINDER||m===i.GeometryType.CONE||m===i.GeometryType.LINE){r=l.ViewedType.CYCOSP;var y=o.getPoints(),h=y.beginPoint.clone().sub(y.endPoint);(s=e.computePointLineDistance(p,y.beginPoint.clone().toArray(),h.toArray())).type2=r,s.type1=n,s.aPosition1=p,s.aPosition2=s.aPosition,m===i.GeometryType.LINE&&(r=l.ViewedType.AXIS)}return d&&((s=e.computeTwoPointsDistance(p,u)).type2=r,s.type1=n,s.aPosition1=p,s.aPosition2=u),s.aPosition1&&(s.position1=new c.Vector3(s.aPosition1[0],s.aPosition1[1],s.aPosition1[2])),s.aPosition2&&(s.position2=new c.Vector3(s.aPosition2[0],s.aPosition2[1],s.aPosition2[2])),s.aExtension&&(s.extensionDirection=new c.Vector3(s.aExtension[0],s.aExtension[1],s.aExtension[2])),s},g=function(t,n,o,r,a){var s={};if("Distance"!==a||t._type!==i.GeometryType.LINE)return s;n=l.ViewedType.CURVE;var u,p=t.getPoints(),d=p.beginPoint.clone(),m=p.beginPoint.clone().toArray(),y=d.clone().sub(p.endPoint.clone()),h=o._type;if(h===i.GeometryType.LINE){r=l.ViewedType.CURVE;var g=o.getPoints(),P=g.beginPoint.clone().sub(g.endPoint);u=g.beginPoint.clone().toArray(),(s=e.computeTwoLinesDistance(m,y.clone().toArray(),u,P.clone().toArray())).type2=r,s.type1=n,s.extensionDirection=y.clone().normalize()}else if(h===i.GeometryType.SPHERE||h===i.GeometryType.CIRCLE)r=l.ViewedType.CYCOSP,h===i.GeometryType.CIRCLE&&(r=l.ViewedType.CIRCLE),u=o.getCenter().toArray(),(s=e.computePointLineDistance(u,p.beginPoint.clone().toArray(),y.clone().toArray())).type2=r,s.type1=n,s.aPosition1=s.aPosition,s.aPosition2=u;else if(h===i.GeometryType.PLANE){r=l.ViewedType.INFPLANE;var f=o.getPlane();(s=e.computeLinePlaneDistance(m,y.clone().toArray(),f.origin.clone().toArray(),f.normal.clone().toArray())).type2=r,s.type1=n,s.aPosition1=m,s.aPosition2=s.aPosition}else if(h===i.GeometryType.CYLINDER||h===i.GeometryType.CONE){r=l.ViewedType.CYCOSP;var T=o.getPoints(),v=T.beginPoint.clone().sub(T.endPoint);(s=e.computePointLineDistance(m,T.beginPoint.clone().toArray(),v.toArray())).type2=r,s.type1=n,s.aPosition1=m,s.aPosition2=s.aPosition}return s.aPosition1&&(s.position1=new c.Vector3(s.aPosition1[0],s.aPosition1[1],s.aPosition1[2])),s.aPosition2&&(s.position2=new c.Vector3(s.aPosition2[0],s.aPosition2[1],s.aPosition2[2])),s.aExtension?s.extensionDirection=new c.Vector3(s.aExtension[0],s.aExtension[1],s.aExtension[2]):y&&(s.extensionDirection=y.clone().normalize()),s},P=function(t,n,o,s,u){var p,d={};if("Distance"!==u||t._type!==i.GeometryType.CURVE)return d;n=l.ViewedType.CURVE;var m=o._type;if(m===i.GeometryType.CIRCLE||m===i.GeometryType.SPHERE)s=l.ViewedType.CIRCLE,m===i.GeometryType.SPHERE&&(s=l.ViewedType.CYCOSP),p=o.getCenter().toArray(),d=a.computePointMeshSquaredDistance(p,t.getPrimitive(),t.getReferentialPosition()),s=l.ViewedType.CIRCLE,d.type1=n,d.type2=s,m===i.GeometryType.SPHERE&&(d.type2=l.ViewedType.CYCOSP),d.distance=Math.sqrt(d.squaredDistance),d.aPosition2&&(d.aPosition1=d.aPosition2,d.aPosition2=p);else if(m===i.GeometryType.CYLINDER||m===i.GeometryType.CONE){var y,h,g,P=-1,f=t.getPrimitive(),T=t.getReferentialPosition(),v=r.extractMeshVertices(f,T.elements),C=v.length,M=o.getPoints();p=M.beginPoint.clone().clone().toArray();for(var D=M.beginPoint.clone().sub(M.endPoint),E=0;E<C;E++){var A=e.computePointLineDistance(v[E],p,D.toArray());(P<0||P>A.distance)&&(P=A.distance,y=A.aPosition,g=A.relationship,h=v[E])}s=l.ViewedType.CYCOSP,d.type2=s,d.type1=n,d.distance=P,d.aPosition1=y,d.aPosition2=h,d.relationship=g}return d.aPosition1&&(d.position1=new c.Vector3(d.aPosition1[0],d.aPosition1[1],d.aPosition1[2])),d.aPosition2&&(d.position2=new c.Vector3(d.aPosition2[0],d.aPosition2[1],d.aPosition2[2])),d.aExtension&&(d.extensionDirection=new c.Vector3(d.aExtension[0],d.aExtension[1],d.aExtension[2])),d},f=function(t,n,o,r,s){var u={};if("Distance"!==s||t._type!==i.GeometryType.CIRCLE)return u;var p,d,m=!1;p=t.getCenter().clone().toArray();var y=o._type;if(n=l.ViewedType.CIRCLE,y===i.GeometryType.POINT)d=o.getSelPoint().toArray(),r=l.ViewedType.POINT,m=!0;else if(y===i.GeometryType.PLANE){var h=o.getPlane();(u=e.computeLinePlaneDistance(p,t._normal.toArray(),h.origin.clone().toArray(),h.normal.clone().toArray())).type1=n,u.type2=l.ViewedType.INFPLANE,u.aPosition1=p,u.aPosition2=u.aPosition}else if(y===i.GeometryType.CYLINDER||y===i.GeometryType.CONE||y===i.GeometryType.LINE||y===i.GeometryType.CIRCLE||y===i.GeometryType.SPHERE){var g,P,f=o.getPoints();y===i.GeometryType.LINE?(P=f.beginPoint.clone().sub(f.endPoint),g=f.beginPoint.clone(),r=l.ViewedType.AXIS):y===i.GeometryType.CIRCLE?(r=l.ViewedType.CIRCLE,g=o.getCenter(),d=o.getCenter().toArray(),m=!0,P=o._normal):y===i.GeometryType.SPHERE?(r=l.ViewedType.CYCOSP,g=o.getCenter(),d=o.getCenter().toArray(),P=t._normal,m=!0):(P=f.beginPoint.clone().sub(f.endPoint),g=f.beginPoint.clone(),r=l.ViewedType.CYCOSP),m||((u=e.computePointLineDistance(p,g.clone().toArray(),P.clone().toArray())).type2=r,u.type1=n,u.aPosition1=p,u.aPosition2=u.aPosition,u.aExtension=P.clone().toArray())}else y===i.GeometryType.SURFACE&&((u=a.computePointMeshSquaredDistance(p,o.getPrimitive(),o.getReferentialPosition())).type1=n,u.type2=l.ViewedType.SURFACE,u.distance=Math.sqrt(u.squaredDistance));return m&&((u=e.computeTwoPointsDistance(p,d)).type2=r,u.type1=n,u.aPosition1=p,u.aPosition2=d),u.aPosition1&&(u.position1=new c.Vector3(u.aPosition1[0],u.aPosition1[1],u.aPosition1[2])),u.aPosition2&&(u.position2=new c.Vector3(u.aPosition2[0],u.aPosition2[1],u.aPosition2[2])),u.aExtension&&(u.extensionDirection=new c.Vector3(u.aExtension[0],u.aExtension[1],u.aExtension[2])),u},T=function(t,n,o,r){var a={};if("Distance"!==r||t._type!==i.GeometryType.PLANE)return a;var s=o._type,u=t.getPlane(),p=u.origin.clone().clone().toArray();if(n=l.ViewedType.INFPLANE,s===i.GeometryType.PLANE){var d=o.getPlane();(a=e.computeTwoPlanesDistance(u.origin.clone().toArray(),u.normal.clone().toArray(),d.origin.clone().toArray(),d.normal.clone().toArray())).type1=n,a.type2=l.ViewedType.INFPLANE}else if(s===i.GeometryType.CYLINDER||s===i.GeometryType.CONE){var m=o.getPoints(),y=m.beginPoint.clone().sub(m.endPoint);(a=e.computeLinePlaneDistance(m.beginPoint.clone().toArray(),y.toArray(),p,u.normal.toArray())).type1=n,a.type2=l.ViewedType.CYCOSP,a.aPosition1=a.aPosition,a.aPosition2=m.beginPoint.clone().toArray(),a.aExtension=y.clone().toArray()}else s===i.GeometryType.SPHERE&&((a=e.computePointPlaneDistance(o.getCenter().clone().toArray(),p,u.normal.clone().toArray())).type1=n,a.type2=l.ViewedType.CYCOSP,a.aPosition1=o.getCenter().clone().toArray(),a.aPosition2=a.aPosition);return a.aPosition1&&(a.position1=new c.Vector3(a.aPosition1[0],a.aPosition1[1],a.aPosition1[2])),a.aPosition2&&(a.position2=new c.Vector3(a.aPosition2[0],a.aPosition2[1],a.aPosition2[2])),a.aExtension&&(a.extensionDirection=new c.Vector3(a.aExtension[0],a.aExtension[1],a.aExtension[2])),a},v=function(t,n,o,s,u){var p={};if(t._type!==i.GeometryType.CYLINDER&&t._type!==i.GeometryType.CONE)return p;var d=o._type,m=t.getPoints(),y=m.beginPoint.clone().sub(m.endPoint);if(n=l.ViewedType.CYCOSP,d===i.GeometryType.CYLINDER||d===i.GeometryType.CONE||d===i.GeometryType.SPHERE||d===i.GeometryType.LINE||d===i.GeometryType.PLANE||d===i.GeometryType.POINT||d===i.GeometryType.CIRCLE){var h,g=o.getPoints(),P=o.getAxis();if(s=l.ViewedType.CYCOSP,d===i.GeometryType.LINE?(P=g.beginPoint.clone().sub(g.endPoint),h=g.beginPoint.clone(),s=l.ViewedType.Axis):d===i.GeometryType.SPHERE?(h=o.getCenter(),P=y):d===i.GeometryType.CIRCLE?(h=o.getCenter(),s=l.ViewedType.Axis):d===i.GeometryType.POINT?(h=o.getPoint(),P=y):g&&(h=g.beginPoint.clone()),d===i.GeometryType.PLANE){s=l.ViewedType.INFPLANE;var f=[m.beginPoint.clone().toArray(),m.endPoint.clone().toArray()],T=o.getPrimitive(),v=o.getReferentialPosition(),C=T.getCount(),M=r.extractMeshVertices(T,v.elements),D=C/3;"MaximumDistance"===u?(p=a._computeTwoMeshesSquaredMaxDistance(t.getPrimitive(),t.getReferentialPosition(),o.getPrimitive(),o.getReferentialPosition())).bDoNotApplyRadiusOffset=!0:p=a._computeCurveSurfaceSquaredDistance(1,f,D,M)}else p=e.computeTwoLinesDistance(m.beginPoint.clone().toArray(),y.clone().toArray(),h.clone().toArray(),P.clone().toArray());p.type2=s,p.type1=n}else if(d===i.GeometryType.SURFACE){for(var E,A,_,S=o.getPrimitive(),b=o.getReferentialPosition(),N=r.extractMeshVertices(S,b.elements),I=N.length,w=-1,R=0;R<I;R++){var x=e.computePointLineDistance(N[R],m.beginPoint.clone().toArray(),y.toArray());(w<0||w>x.distance)&&(w=x.distance,E=x.aPosition,_=x.relationship,A=N[R])}s=l.ViewedType.SURFACE,p.type2=s,p.type1=n,p.distance=w,p.aPosition1=E,p.aPosition2=A,p.relationship=_}else i.GeometryType.PRODUCT;return p.aPosition1&&(p.position1=new c.Vector3(p.aPosition1[0],p.aPosition1[1],p.aPosition1[2])),p.aPosition2&&(p.position2=new c.Vector3(p.aPosition2[0],p.aPosition2[1],p.aPosition2[2])),p.aExtension?p.extensionDirection=new c.Vector3(p.aExtension[0],p.aExtension[1],p.aExtension[2]):p.extensionDirection=m.beginPoint.clone().sub(m.endPoint).clone(),p},C=function(t,n,o,r,s){var u={};if("Distance"!==s||t._type!==i.GeometryType.SPHERE)return u;var p,d=!1,m=o._type,y=t.getCenter().clone().toArray();return n=l.ViewedType.CYCOSP,m===i.GeometryType.SPHERE?(p=o.getCenter().clone().clone().toArray(),r=l.ViewedType.CYCOSP,d=!0):m===i.GeometryType.SURFACE&&((u=a.computePointMeshSquaredDistance(y,o.getPrimitive(),o.getReferentialPosition())).type1=n,u.type2=l.ViewedType.SURFACE,u.distance=Math.sqrt(u.squaredDistance)),d&&((u=e.computeTwoPointsDistance(y,p)).type2=r,u.type1=n,u.aPosition1=y,u.aPosition2=p),u.aPosition1&&(u.position1=new c.Vector3(u.aPosition1[0],u.aPosition1[1],u.aPosition1[2])),u.aPosition2&&(u.position2=new c.Vector3(u.aPosition2[0],u.aPosition2[1],u.aPosition2[2])),u.aExtension&&(u.extensionDirection=new c.Vector3(u.aExtension[0],u.aExtension[1],u.aExtension[2])),u},M={measureItem:function(e,t,n,r){var a,s={};n&&!0===n&&(a=(new Date).getTime());var c,u=e.getPathElement(),p=e.getLevel();p?(s.product=u.getElement(p-1),c=o.truncatePathElement(u,p)):(c=y(u))&&c.getLastElement(!0)&&(s.product=c.getLastElement(!0));var d=e.getType();if(void 0!==t&&t===l.ViewedType.PRODUCT){let t;if(e.updateProductMeasurable(),s.type=i.GeometryType.PRODUCT,s.position=e.getSelPoint(),r){let e=r(c);t=M.makeAABBFromBox(e)}s.aabb=t||M.retrieveProductAABB(s.product,c.getWorldMatrix()),s.volume=e.getVolume(),s.area=e.getArea(),s.cog=e.getCoG(),s.length=e.getLength();var m=e.getPoints();m&&m.beginPoint&&m.endPoint&&(s.startpoint=m.beginPoint,s.endpoint=m.endPoint),s.originPoint=e.getOriginPoint()}else if(void 0!==t&&t===l.ViewedType.POINT||d===i.GeometryType.POINT||d===i.GeometryType.PICKINGPT)s.type=i.GeometryType.POINT,s.position=e.getPoint(),s.position||(s.position=e.getSelPoint());else if(d===i.GeometryType.LINE){s.type=d,s.length=e.getLength();var h=e.getPoints();s.point1=h.beginPoint,s.point2=h.endPoint,s.position=s.point1.clone().add(s.point2).multiplyScalar(.5)}else if(d===i.GeometryType.CIRCLE)s.type=d,s.length=e.getLength(),s.position=e.getSelPoint(),s.radius=e.getRadius(),s.center=e.getCenter(),s.normal=e.getAxis(),s.arcLength=e.getArcLength(),s.arcMidPoint=e.getArcMidPoint();else if(d===i.GeometryType.CYLINDER){s.type=d,s.area=e.getArea(),s.cog=e.getCoG(),s.position=e.getSelPoint(),s.radius=e.getRadius();var g=e.getPoints();s.point1=g.beginPoint,s.point2=g.endPoint,s.height=e.getHeight()}else if(d===i.GeometryType.CONE){s.type=d,s.area=e.getArea(),s.cog=e.getCoG(),s.position=e.getSelPoint(),s.apex=e.getApex(),s.semiAngle=e.getSemiAngle(),s.axis=e.getAxis();var P=e.getPoints();s.point1=P.beginPoint,s.point2=P.endPoint,s.height=e.getHeight(),s.minRadius=e.getMinRadius(),s.maxRadius=e.getMaxRadius()}else if(d===i.GeometryType.SPHERE)s.type=d,s.area=e.getArea(),s.cog=e.getCoG(),s.position=e.getSelPoint(),s.radius=e.getRadius(),s.center=e.getCenter();else if(d===i.GeometryType.PLANE){s.type=d,s.area=e.getArea(),s.cog=e.getCoG(),s.position=e.getSelPoint();var f=e.getPlane();s.origin=f.origin,s.normal=f.normal}else d===i.GeometryType.CURVE?(s.type=d,s.length=e.getLength(),s.position=e.getSelPoint()):d===i.GeometryType.SURFACE&&(s.type=d,s.area=e.getArea(),s.cog=e.getCoG(),s.position=e.getSelPoint());return n&&!0===n&&window.console.log("PCS measureItem="+((new Date).getTime()-a)),s},measureProduct:function(e){var t,i={},a=e.getPathElement(),l=e.getLevel();t=l?o.truncatePathElement(a,l):y(a);var m,h=o.getRenderables(t),g=0,P=0,f=0,T=[0,0,0],v=[0,0,0],C=0,M=[0,0,0],D=[0,0,0],E=[0,0,0],A=0,_=0,S=!1,b=!1,N=h.length;return a&&(i.originPoint=a.getMatrix().getPosition()),function(){for(var e=0;e<N;e++)if(!o.isCompletlyHidden(h[e]))for(var t=h[e].matrix.elements,i=h[e].geometry,a=i.length,s=0;s<a;s++){i[s].startIteration();for(var l=i[s].drawingGroups,y=l.length,I=0;I<y;I++)if(l[I]._geomType&&("FACE"===d.GeomTypeString[l[I]._geomType]||"EDGE"===d.GeomTypeString[l[I]._geomType]||"WIRE_EDGE"===d.GeomTypeString[l[I]._geomType]||"FREE_POINT"===d.GeomTypeString[l[I]._geomType]))for(var w=l[I].getPrimitivesCount(),R=0;R<w;R++){var x=new d.SGPrimitiveHelper;x.set(l[I],R);var V=u.getFromSGNode(x),L=p.recognizeNonCanonicGeometry(x,new c.Matrix4,!0);if("FACE"===d.GeomTypeString[l[I]._geomType]){S=!0;var G=V.getBodyDimension();if(3===G){P+=L.area;var O=r._computeVolume(x,E);g+=O.volume;var B=n.transformPoint(O.aCog,t);T=n.multiplyAndAdd(B,O.volume,T)}else if(2===G){f+=L.area;var U=n.transformPoint(L.aCog,t);v=n.multiplyAndAdd(U,L.area,v)}}else if(S||"EDGE"!==d.GeomTypeString[l[I]._geomType]&&"WIRE_EDGE"!==d.GeomTypeString[l[I]._geomType]){if(!S&&!b&&"FREE_POINT"===d.GeomTypeString[l[I]._geomType]&&1===++_&&r.verifyMesh(x)){var q=new c.Matrix4;m=r.extractMeshVertices(x,q.elements)}}else if(b=!0,A++,L.length&&L.length>0&&(C+=L.length,1===A)){if(void 0===L.point1&&void 0===L.point2&&r.verifyMesh(x)){var z=new c.Matrix4,F=r.extractMeshVertices(x,z.elements),k=p._recognizeCurve(F,!0);0===k.returnCode&&(L.point1=p._buildVector3(k.aPoint1),L.point2=p._buildVector3(k.aPoint2))}if(L.point1&&L.point2){var H=[L.point1.x,L.point1.y,L.point1.z],W=[L.point2.x,L.point2.y,L.point2.z];M=n.transformPoint(H,t),D=n.transformPoint(W,t)}}}i[s].endIteration()}}(),S?(g>0&&(i.volume=g),(P>0||f>0)&&(i.area=g>0?P>0?P:0:f>0?f:0),(g>0||P>0||f>0)&&(T=s.isZero(g)?s.isZero(f)?[0,0,0]:n.multiply(v,1/f):n.multiply(T,1/g),i.cog=new c.Vector3(T[0],T[1],T[2]))):!S&&b&&C>0?(i.length=C,1===A&&(i.startpoint=new c.Vector3(M[0],M[1],M[2]),i.endpoint=new c.Vector3(D[0],D[1],D[2]))):S||b||1!==_||(i.cog=new c.Vector3(m[0][0],m[0][1],m[0][2])),i},measureBetween2DGeometries:function(t,n,o,r,s){var u,p,d={},m=n.getType(),h=r.getType();if("Angle"===t?d=M.measureBetween(n,l.ViewedType.AXIS,r,l.ViewedType.AXIS):"Distance"===t?function(){if(o===l.ViewedType.POINT&&s===l.ViewedType.POINT&&m!==i.GeometryType.POINT&&m!==i.GeometryType.POINT&&(m=i.GeometryType.POINT,h=i.GeometryType.POINT),u=n.getSelPoint().toArray(),p=r.getSelPoint().toArray(),m===i.GeometryType.CIRCLE&&(u=n.getCenter().toArray(),o=l.ViewedType.CENTER),h===i.GeometryType.CIRCLE&&(p=r.getCenter().toArray(),s=l.ViewedType.CENTER),m!==i.GeometryType.CIRCLE&&m!==i.GeometryType.POINT||h!==i.GeometryType.CIRCLE&&h!==i.GeometryType.POINT){if(m===i.GeometryType.CIRCLE)(d=a.computePointMeshSquaredDistance(u,r.getPrimitive(),r.getReferentialPosition())).type1=l.ViewedType.POINT,d.type2=M.MeasuredType.CURVE,d.distance=Math.sqrt(d.squaredDistance);else if(h===i.GeometryType.CIRCLE){(d=a.computePointMeshSquaredDistance(p,n.getPrimitive(),n.getReferentialPosition())).type1=M.MeasuredType.CURVE,d.type2=l.ViewedType.POINT;var t=d.aPosition1;d.aPosition1=d.aPosition2,d.aPosition2=t,d.distance=Math.sqrt(d.squaredDistance)}else if(m===i.GeometryType.LINE&&h===i.GeometryType.LINE){var y={};if((y=M.measureBetween(n,o,r,s)).position1&&y.position2){var g=r.getPoints().endPoint,P=g.clone().sub(r.getPoints().beginPoint),f=y.position1.clone(),T=e.computePointLineDistance(f.toArray(),g.toArray(),P.toArray());0===T.returnCode&&(y.position2=new c.Vector3(T.aPosition[0],T.aPosition[1],T.aPosition[2]),y.distance=T.distance)}d=y}}else(d=e.computeTwoPointsDistance(u,p)).type2=s,d.type1=o,d.aPosition1=u,d.aPosition2=p}():"MinimumDistance"!==t&&"MaximumDistance"!==t||function(){if(m===i.GeometryType.CIRCLE&&(o=l.ViewedType.CURVE),h===i.GeometryType.CIRCLE&&(s=l.ViewedType.CURVE),m===i.GeometryType.POINT)u=n.getSelPoint().toArray(),(d="MaximumDistance"===t?a._computePointMeshSquaredMaxDistance(u,r.getPrimitive(),r.getReferentialPosition()):a.computePointMeshSquaredDistance(u,r.getPrimitive(),r.getReferentialPosition())).type1=l.ViewedType.POINT,d.type2=M.MeasuredType.CURVE;else if(h===i.GeometryType.POINT){p=r.getSelPoint().toArray(),(d="MaximumDistance"===t?a._computePointMeshSquaredMaxDistance(p,n.getPrimitive(),n.getReferentialPosition()):a.computePointMeshSquaredDistance(p,n.getPrimitive(),n.getReferentialPosition())).type1=M.MeasuredType.CURVE,d.type2=l.ViewedType.POINT;var e=d.aPosition1;d.aPosition1=d.aPosition2,d.aPosition2=e}else{if(d="MaximumDistance"===t?a._computeTwoMeshesSquaredMaxDistance(n.getPrimitive(),n.getReferentialPosition(),r.getPrimitive(),r.getReferentialPosition()):a.computeTwoMeshesSquaredDistance(n.getPrimitive(),n.getReferentialPosition(),r.getPrimitive(),r.getReferentialPosition()),n._normal&&r._normal){var y=new c.Vector3(d.aPosition1[0],d.aPosition1[1],d.aPosition1[2]),g=new c.Vector3(d.aPosition2[0],d.aPosition2[1],d.aPosition2[2]);Math.abs(n._normal.angleTo(g.clone().sub(y))-Math.PI/2)<.001&&(d.aExtension=n._normal.clone().toArray())}if(d.type1=l.ViewedType.CURVE,d.type2=l.ViewedType.CURVE,m===i.GeometryType.LINE&&h===i.GeometryType.LINE){var P=n.getPoints().endPoint.clone().sub(n.getPoints().beginPoint),f=r.getPoints().endPoint.clone().sub(r.getPoints().beginPoint),T=P.normalize().dot(f.normalize());1!==Math.abs(T)&&(d.angle=1)}}d.distance="MaximumDistance"===t?Math.sqrt(d.squaredMaxDistance):Math.sqrt(d.squaredDistance)}(),!d.product1){var g=n.getPathElement();g&&(d.product1=y(g).getLastElement())}if(!d.product2){var P=r.getPathElement();P&&(d.product2=y(P).getLastElement())}return d.aPosition1&&!d.position1&&(d.position1=new c.Vector3(d.aPosition1[0],d.aPosition1[1],d.aPosition1[2])),d.aPosition2&&!d.position2&&(d.position2=new c.Vector3(d.aPosition2[0],d.aPosition2[1],d.aPosition2[2])),d.aExtension&&!d.extensionDirection&&(d.extensionDirection=new c.Vector3(d.aExtension[0],d.aExtension[1],d.aExtension[2])),n.get2DScale&&d.distance&&(d.distance=d.distance/n.get2DScale()),d},_buildNewPointsForDimension:function(t,n,o,r,a){let s=r.clone();var l=a.clone();let u=(new c.Vector3).crossVectors(s.normalize(),l.normalize());var p,d;return d||(d=e.computeLinePlaneDistance(n.toArray(),t.toArray(),o.toArray(),u.toArray()))&&0===d.returnCode&&d.relationship===i.Relationship.INTERSECTING&&(p=new c.Vector3(d.aPosition[0],d.aPosition[1],d.aPosition[2])),p},_distanceBetweenIntersectionPtandExtLine:function(t,i,n){var o=e.computePointLineDistance(n.toArray(),t.toArray(),i.toArray());let r=new c.Vector3(o.aPosition[0],o.aPosition[1],o.aPosition[2]),a=n.clone(),l=s.isZero(o.distance)?0:o.distance;return{distance:l,dir:l?a.clone().sub(r):void 0}},measureBetween:function(t,n,o,r,s,u,p){var d,m={},D=t._type,E=o._type,A=Number.MAX_VALUE,_=!1,S=.001;function b(e){return e===i.GeometryType.CIRCLE||e===i.GeometryType.CYLINDER||e===i.GeometryType.CONE||e===i.GeometryType.SPHERE||e===i.GeometryType.LINE||e===i.GeometryType.PLANE||e===i.GeometryType.POINT}function N(e,t){var n=!1,o=t._type,r=e.getAxis(),a=t.getAxis();if(o===i.GeometryType.SPHERE||o===i.GeometryType.POINT)a=r;else if(o===i.GeometryType.PLANE)a=t._normal;else if(o===i.GeometryType.CIRCLE)a=t.getAxis();else if(o===i.GeometryType.LINE){var s=t.getPoints();a=s.beginPoint.clone().sub(s.endPoint.clone())}var l=r.normalize().dot(a.normalize());return o===i.GeometryType.PLANE?S>Math.abs(l)&&(n=!0):1-Math.abs(l)<S&&(n=!0),n}function I(t,n){var o,r=!1,a=n._type,s=t.getAxis(),l=n.getAxis(),c=t.getCenter();if(a===i.GeometryType.LINE){var u=n.getPoints();l=u.beginPoint.clone().sub(u.endPoint.clone()),o=e.computeLinePlaneDistance(u.beginPoint.clone().toArray(),l.toArray(),c.toArray(),s.toArray())}else if(a===i.GeometryType.PLANE||a===i.GeometryType.CIRCLE){var p=n.getCenter();a===i.GeometryType.PLANE&&(l=n.getPlane().normal,p=n.getPlane().origin),o=e.computeTwoPlanesDistance(c.toArray(),s.toArray(),p.toArray(),l.toArray())}else a===i.GeometryType.POINT&&(o=e.computePointPlaneDistance(n.getPoint().toArray(),c.toArray(),s.toArray()));return o&&o.relationship===i.Relationship.COINCIDENT&&(r=!0),r}function w(){if(t.extraPolateGeom){if(function(){if(p||!t.extraPolateGeom)return 0;var a,s;if(D===i.GeometryType.SPHERE&&E===i.GeometryType.SPHERE)m.position1=t.getCenter(),m.position2=o.getCenter(),m.distance=m.position1.clone().distanceTo(m.position2.clone()),a=m.position1.clone(),s=m.position2.clone();else if(D===i.GeometryType.CYLINDER||D===i.GeometryType.CONE)a=(m=v(t,n,o,r,u)).position1.clone(),s=m.position2.clone();else{if(E!==i.GeometryType.CYLINDER&&E!==i.GeometryType.CONE)return 0;a=(m=v(o,r,t,n,u)).position2.clone(),s=m.position1.clone()}if(m){var l,d,y,h=D===i.GeometryType.CONE?t.getMaxRadius():t.getRadius(),g=E===i.GeometryType.CONE?o.getMaxRadius():o.getRadius();if("MinimumDistance"===u?(l=s.clone().sub(a).normalize(),d=a.clone().sub(s).normalize()):(l=a.clone().sub(s).normalize(),d=s.clone().sub(a).normalize()),m.bDoNotApplyRadiusOffset||(h&&(y=l.multiplyScalar(h),a.add(y)),g&&(y=d.multiplyScalar(g),s.add(y))),m.distance=a.distanceTo(s),D===i.GeometryType.CYLINDER&&E===i.GeometryType.CYLINDER){var P=t.getAxis(),f=o.getAxis(),T=o.getPoints(),C=e.computePointLineDistance(o.getSelPoint().toArray(),T.beginPoint.toArray(),f.clone().toArray());if(C.aPosition){var M=C.aPosition;(C=e.computePointLineDistance(M,s.clone().toArray(),f.clone().normalize().toArray())).aPosition&&3===C.aPosition.length&&(s=new c.Vector3(C.aPosition[0],C.aPosition[1],C.aPosition[2]),(C=e.computePointLineDistance(C.aPosition,a.clone().toArray(),P.clone().normalize().toArray())).aPosition&&3===C.aPosition.length&&(a=new c.Vector3(C.aPosition[0],C.aPosition[1],C.aPosition[2])))}}return m.position1=a,m.position2=s,m.aPosition1=a.toArray(),m.aPosition2=s.toArray(),m.squaredMaxDistance&&(m.distance=Math.sqrt(m.squaredMaxDistance)),1}return 0}())return 1;var a,s,l,d,y,h=t.getRadius(),g=o.getRadius();if(D===i.GeometryType.CIRCLE)a=(m=f(t,n,o,r,"Distance")).position1.clone(),s=m.position2.clone();else{if(E!==i.GeometryType.CIRCLE)return 0;a=(m=f(o,r,t,n,"Distance")).position2.clone(),s=m.position1.clone()}if(m)return"MinimumDistance"===u?(l=s.clone().sub(a).normalize(),d=a.clone().sub(s).normalize()):(l=a.clone().sub(s).normalize(),d=s.clone().sub(a).normalize()),h&&(y=l.multiplyScalar(h),a.add(y)),g&&(y=d.multiplyScalar(g),s.add(y)),m.distance=a.distanceTo(s),m.position1=a,m.position2=s,m.aPosition1=a.toArray(),m.aPosition2=s.toArray(),m.squaredMaxDistance&&(m.distance=Math.sqrt(m.squaredMaxDistance)),1}return 0}function R(){D===i.GeometryType.POINT||n===l.ViewedType.POINT?m=h(t,n,o,r,u):E===i.GeometryType.POINT||r===l.ViewedType.POINT?(m=h(o,r,t,n,u),_=!0):D===i.GeometryType.LINE?m=g(t,n,o,r,u):E===i.GeometryType.LINE?(m=g(o,r,t,n,u),_=!0):D===i.GeometryType.CURVE?m=P(t,n,o,r,u):E===i.GeometryType.CURVE?(m=P(o,r,t,n,u),_=!0):D===i.GeometryType.CIRCLE?E===i.GeometryType.PRODUCT?((m=M.measureBetweenWithProducts(M.MeasuredType.CENTER,t,o,A)).squaredDistance&&(m.distance=Math.sqrt(m.squaredDistance)),m.type1=l.ViewedType.CIRCLE,m.type2=l.ViewedType.PRODUCT,m.aPosition1&&(m.position1=new c.Vector3(m.aPosition1[0],m.aPosition1[1],m.aPosition1[2])),m.aPosition2&&(m.position2=new c.Vector3(m.aPosition2[0],m.aPosition2[1],m.aPosition2[2])),m.aExtension&&(m.extensionDirection=new c.Vector3(m.aExtension[0],m.aExtension[1],m.aExtension[2]))):m=f(t,n,o,r,u):E===i.GeometryType.CIRCLE?(D===i.GeometryType.PRODUCT?((m=M.measureBetweenWithProducts(M.MeasuredType.CENTER,o,t,A)).squaredDistance&&(m.distance=Math.sqrt(m.squaredDistance)),m.type2=l.ViewedType.CIRCLE,m.type1=l.ViewedType.PRODUCT,m.aPosition1&&(m.position1=new c.Vector3(m.aPosition1[0],m.aPosition1[1],m.aPosition1[2])),m.aPosition2&&(m.position2=new c.Vector3(m.aPosition2[0],m.aPosition2[1],m.aPosition2[2])),m.aExtension&&(m.extensionDirection=new c.Vector3(m.aExtension[0],m.aExtension[1],m.aExtension[2]))):m=f(o,r,t,n,u),_=!0):D===i.GeometryType.PLANE?m=T(t,n,o,u):E===i.GeometryType.PLANE?(m=T(o,r,t,u),_=!0):D===i.GeometryType.CYLINDER||D===i.GeometryType.CONE?m=v(t,n,o,r,u):E===i.GeometryType.CYLINDER||E===i.GeometryType.CONE?(m=v(o,r,t,n,u),_=!0):D===i.GeometryType.SPHERE?E===i.GeometryType.PRODUCT?((m=M.measureBetweenWithProducts(M.MeasuredType.CENTER,t,o,A)).squaredDistance&&(m.distance=Math.sqrt(m.squaredDistance)),m.type1=l.ViewedType.SPHERE,m.type2=l.ViewedType.PRODUCT,m.aPosition1&&(m.position1=new c.Vector3(m.aPosition1[0],m.aPosition1[1],m.aPosition1[2])),m.aPosition2&&(m.position2=new c.Vector3(m.aPosition2[0],m.aPosition2[1],m.aPosition2[2])),m.aExtension&&(m.extensionDirection=new c.Vector3(m.aExtension[0],m.aExtension[1],m.aExtension[2]))):m=C(t,n,o,r,u):E===i.GeometryType.SPHERE&&(D===i.GeometryType.PRODUCT?((m=M.measureBetweenWithProducts(M.MeasuredType.CENTER,o,t,A)).squaredDistance&&(m.distance=Math.sqrt(m.squaredDistance)),m.type2=l.ViewedType.SPHERE,m.type1=l.ViewedType.PRODUCT,m.aPosition1&&(m.position1=new c.Vector3(m.aPosition1[0],m.aPosition1[1],m.aPosition1[2])),m.aPosition2&&(m.position2=new c.Vector3(m.aPosition2[0],m.aPosition2[1],m.aPosition2[2])),m.aExtension&&(m.extensionDirection=new c.Vector3(m.aExtension[0],m.aExtension[1],m.aExtension[2]))):m=C(o,r,t,n,u),_=!0)}n===l.ViewedType.POINT&&r===l.ViewedType.POINT||b(D)&&b(E)&&(d=!1,D===i.GeometryType.SPHERE||E===i.GeometryType.SPHERE?d=!0:D===i.GeometryType.CYLINDER||D===i.GeometryType.CONE?d=N(t,o):E===i.GeometryType.CYLINDER||E===i.GeometryType.CONE?d=N(o,t):D===i.GeometryType.CIRCLE?d=I(t,o):E===i.GeometryType.CIRCLE&&(d=I(o,t)),d&&(t.extraPolateGeom=d)),"Distance"===u?function(){if(R(),void 0===m.product1){var i=t.getPathElement();i&&(m.product1=y(i).getLastElement())}if(void 0===m.product2){var a=o.getPathElement();a&&(m.product2=y(a).getLastElement())}var s;_&&m&&(m.aPosition1&&m.aPosition2&&(s=m.aPosition1,m.aPosition1=m.aPosition2,m.aPosition2=s),m.position1&&m.aPosition2&&(s=m.position1,m.position1=m.position2,m.position2=s)),void 0===m.distance&&(n!==l.ViewedType.POINT&&n!==l.ViewedType.AXIS&&n!==l.ViewedType.CENTER&&n!==l.ViewedType.INFPLANE||r!==l.ViewedType.POINT&&r!==l.ViewedType.AXIS&&r!==l.ViewedType.CENTER&&r!==l.ViewedType.INFPLANE||(m=e.measureBetweenInfinite(t,n,o,r)))}():"Angle"===u?m=e.measureBetweenInfinite(t,l.ViewedType.AXIS,o,l.ViewedType.AXIS):"MaximumDistance"===u||"LocalMaximumDistance"===u?function(){if("LocalMaximumDistance"===u||!w()){if(D===i.GeometryType.POINT||n===l.ViewedType.POINT){var e=t.getSelPoint().toArray();m=a._computePointMeshSquaredMaxDistance(e,o.getPrimitive(),o.getReferentialPosition(),0)}else if(E===i.GeometryType.POINT||r===l.ViewedType.POINT){var c=o.getSelPoint().toArray();m=a._computePointMeshSquaredMaxDistance(c,t.getPrimitive(),t.getReferentialPosition(),0)}else if(D===i.GeometryType.PRODUCT){A=0;var p=M.MeasuredType.MESH;E===i.GeometryType.PRODUCT&&(p=M.MeasuredType.PRODUCT),m=M.measureBetweenWithProducts(p,o,t,A,s,!0)}else E===i.GeometryType.PRODUCT?(A=0,m=M.measureBetweenWithProducts(M.MeasuredType.MESH,t,o,A,s,!0)):((m=a._computeTwoMeshesSquaredMaxDistance(t.getPrimitive(),t.getReferentialPosition(),o.getPrimitive(),o.getReferentialPosition())).type1=M.MeasuredType.MESH,m.type2=M.MeasuredType.MESH);m.squaredMaxDistance&&(m.distance=Math.sqrt(m.squaredMaxDistance))}}():function(){if("LocalMinimumDistance"===u||!w())if(n===l.ViewedType.AXIS&&(r===l.ViewedType.AXIS||r===l.ViewedType.POINT||r===l.ViewedType.CENTER||r===l.ViewedType.INFPLANE)||(n===l.ViewedType.POINT||n===l.ViewedType.CENTER)&&(r===l.ViewedType.AXIS||r===l.ViewedType.POINT||r===l.ViewedType.CENTER)||n===l.ViewedType.INFPLANE&&r===l.ViewedType.AXIS)m=e.measureBetweenInfinite(t,n,o,r);else if(n===l.ViewedType.PRODUCT||r===l.ViewedType.PRODUCT)!function(){if(t.getSelPoint()&&o.getSelPoint()){var a=e.computeTwoPointsDistance(t.getSelPoint().toArray(),o.getSelPoint().toArray());A=a.distance*a.distance}if(n===l.ViewedType.PRODUCT&&r===l.ViewedType.PRODUCT)(m=M.measureBetweenWithProducts(M.MeasuredType.PRODUCT,t,o,A,s)).type1=n,m.type2=r;else if(n!==l.ViewedType.PRODUCT||r!==i.GeometryType.POINT&&r!==l.ViewedType.CENTER)if(r!==l.ViewedType.PRODUCT||n!==i.GeometryType.POINT&&n!==l.ViewedType.CENTER)if(n===l.ViewedType.PRODUCT){(m=M.measureBetweenWithProducts(M.MeasuredType.MESH,o,t,A,s)).type1=M.MeasuredType.MESH,m.type2=M.MeasuredType.MESH;var c=m.aPosition1;m.aPosition1=m.aPosition2,m.aPosition2=c;var u=m.product1;m.product1=m.product2,m.product2=u}else(m=M.measureBetweenWithProducts(M.MeasuredType.MESH,t,o,A,s)).type1=M.MeasuredType.MESH,m.type2=M.MeasuredType.MESH;else(m=M.measureBetweenWithProducts(M.MeasuredType.POINT,t,o,A,s)).type1=l.ViewedType.POINT,m.type2=r;else{(m=M.measureBetweenWithProducts(M.MeasuredType.POINT,o,t,A,s)).type1=n,m.type2=l.ViewedType.POINT;var p=m.aPosition1;m.aPosition1=m.aPosition2,m.aPosition2=p;var d=m.product1;m.product1=m.product2,m.product2=d}m.distance=Math.sqrt(m.squaredDistance)}();else{if(n!==l.ViewedType.POINT&&n!==l.ViewedType.CENTER||r!==l.ViewedType.CURVE&&r!==l.ViewedType.SURFACE&&r!==l.ViewedType.CIRCLE&&r!==l.ViewedType.CYCOSP&&r!==l.ViewedType.INFPLANE)if(r!==l.ViewedType.POINT&&r!==l.ViewedType.CENTER||n!==l.ViewedType.CURVE&&n!==l.ViewedType.SURFACE&&n!==l.ViewedType.CIRCLE&&n!==l.ViewedType.CYCOSP&&n!==l.ViewedType.INFPLANE){if(m=a.computeTwoMeshesSquaredDistance(t.getPrimitive(),t.getReferentialPosition(),o.getPrimitive(),o.getReferentialPosition()),t._normal&&o._normal){var p=new c.Vector3(m.aPosition1[0],m.aPosition1[1],m.aPosition1[2]),d=new c.Vector3(m.aPosition2[0],m.aPosition2[1],m.aPosition2[2]);Math.abs(t._normal.angleTo(d.clone().sub(p))-Math.PI/2)<.001&&(m.aExtension=t._normal.clone().toArray())}m.type1=M.MeasuredType.MESH,m.type2=M.MeasuredType.MESH}else{var y=r===l.ViewedType.CENTER?o.getCenter().toArray():o.getSelPoint().toArray();(m=a.computePointMeshSquaredDistance(y,t.getPrimitive(),t.getReferentialPosition())).type1=M.MeasuredType.MESH,m.type2=l.ViewedType.POINT;var h=m.aPosition1;m.aPosition1=m.aPosition2,m.aPosition2=h}else{var g=n===l.ViewedType.CENTER?t.getCenter().toArray():t.getSelPoint().toArray();(m=a.computePointMeshSquaredDistance(g,o.getPrimitive(),o.getReferentialPosition())).type1=l.ViewedType.POINT,m.type2=M.MeasuredType.MESH}m.distance=Math.sqrt(m.squaredDistance)}}(),"MaximumDistance"!==u&&"MinimumDistance"!==u||function(){if(!m.angle){var a=!1;if(n===l.ViewedType.POINT||D!==i.GeometryType.LINE&&D!==i.GeometryType.PLANE&&D!==i.GeometryType.CYLINDER&&D!==i.GeometryType.CONE||(a=!0),a=!(!a||r===l.ViewedType.POINT||E!==i.GeometryType.LINE&&E!==i.GeometryType.PLANE&&E!==i.GeometryType.CYLINDER&&E!==i.GeometryType.CONE)){var s=n,c=r;D===i.GeometryType.LINE&&(s=l.ViewedType.AXIS),E===i.GeometryType.LINE&&(c=l.ViewedType.AXIS);var u=e.measureBetweenInfinite(t,s,o,c);u.angle&&(m.angle=u.angle)}}}();for(var x=[D,E],V=1;V<=x.length;V++){var L="type"+V;switch(x[V-1]){case i.GeometryType.POINT:m[L]=l.ViewedType.POINT;break;case i.GeometryType.CURVE:case i.GeometryType.LINE:m[L]=l.ViewedType.CURVE;break;case i.GeometryType.CIRCLE:m[L]=l.ViewedType.CIRCLE;break;case i.GeometryType.SURFACE:m[L]=l.ViewedType.SURFACE;break;case i.GeometryType.PLANE:m[L]=l.ViewedType.INFPLANE;break;case i.GeometryType.CYLINDER:case i.GeometryType.CONE:case i.GeometryType.SPHERE:m[L]=l.ViewedType.CYCOSP;break;case i.GeometryType.PRODUCT:m[L]=l.ViewedType.PRODUCT}}if(n!==l.ViewedType.POINT&&n!==l.ViewedType.CENTER||(m.type1=n),r!==l.ViewedType.POINT&&r!==l.ViewedType.CENTER||(m.type2=r),void 0===m.product1){var G=t.getPathElement();G&&(m.product1=y(G).getLastElement())}if(void 0===m.product2){var O=o.getPathElement();O&&(m.product2=y(O).getLastElement())}return m.aPosition1&&(m.position1=new c.Vector3(m.aPosition1[0],m.aPosition1[1],m.aPosition1[2])),m.aPosition2&&(m.position2=new c.Vector3(m.aPosition2[0],m.aPosition2[1],m.aPosition2[2])),m.aExtension&&(m.extensionDirection=new c.Vector3(m.aExtension[0],m.aExtension[1],m.aExtension[2])),m},measureThreepoints:function(e,t,i){var o={},r=e.getSelPoint(),a=t.getSelPoint(),s=i.getSelPoint();if(r&&a&&s){var l=r.toArray(),u=a.toArray(),p=s.toArray(),d=n.sub(l,u),y=n.sub(u,p);o.angle=Math.PI-n.angle(d,y);var h,g=n.cross(d,y);if(o.normal=new c.Vector3(g[0],g[1],g[2]),n.areEqual(l,u))h=n.multiply(n.add(l,p),.5);else if(n.areEqual(l,p))h=n.multiply(n.add(l,u),.5);else if(n.areEqual(u,p))h=n.multiply(n.add(l,u),.5);else{var P=n.squaredLength(g);if(P>m){var f=(.5*n.squaredLength(y)+.5*n.dot(d,y))/P,T=n.multiplyAndAdd(d,.5,l);h=n.multiplyAndAdd(n.cross(d,g),-f,T)}}void 0!==h&&(o.radius=n.subAndLength(h,l),o.center=new c.Vector3(h[0],h[1],h[2]))}return o},measureBetweenWithProducts:function(e,n,r,a,s,l){var c,u={};s&&!0===s&&(c=(new Date).getTime());var p=a||Number.MAX_VALUE;l&&(p=0),u.squaredDistance=p;var d,m,h,g=e===M.MeasuredType.PRODUCT,P=n.getPathElement(),f=n.getLevel();f?(d=P.getElement(f-1),m=o.truncatePathElement(P,f)):(m=y(P),d=m.getLastElement());var T,v=r.getPathElement(),C=r.getLevel();C?(h=v.getElement(C-1),T=o.truncatePathElement(v,C)):(T=y(v),h=T.getLastElement());var D,E,A=!1;if(g){var _,S,b,N=m.externalPath.length,I=T.externalPath.length;N<I?(_=N,S=T,b=m):(_=I,S=m,b=T),A=!0;for(var w=0;A&&w<_;w++)A=S.externalPath[w]===b.externalPath[w]}var R=[],x=[];function V(e,i,r){var a,s,c,u,d=!g;if(g&&(D=M.retrieveProductAABB(e[r].getLastElement(!0),e[r].getWorldMatrix().clone())),E=M.retrieveProductAABB(i[r].getLastElement(!0),i[r].getWorldMatrix().clone()),D.AABB&&D.AABB[0]&&(D=D.AABB[0]),s=l?t.computeAABBSquaredMaxDistance(D,E):t.computeAABBSquaredDistance(D,E),!l&&s<p||l&&s>p)if(g&&(d=o.isLeaf(e[r].getLastElement(!0))),a=o.isLeaf(i[r].getLastElement(!0)),d&&a)g?R.push(e[r]):R.push(n),x.push(i[r]);else if(d||!a&&e[r].getLastElement(!0).bSphere.radius<i[r].getLastElement(!0).bSphere.radius){u=(c=i[r].getChildrenPathes()).length;for(var m=0;m<u;m++)o.isReferenceOrInstance(c[m].getLastElement())&&(g?e.push(e[r]):e.push(n),i.push(c[m]))}else{u=(c=e[r].getChildrenPathes()).length;for(var y=0;y<u;y++)o.isReferenceOrInstance(c[y].getLastElement())&&(e.push(c[y]),i.push(i[r]))}}return A?(u.squaredDistance=0,u.aPosition1=n.getSelPoint().toArray(),u.aPosition2=u.aPosition1,u.product1=d,u.product2=h):function(){s&&!0===s&&(g?window.console.log("Measure Products: "+d.name+" / "+h.name):window.console.log("Measure Products: "+e+" / "+h.name));var o=[],a=[],y=[],P=[],v=0;if(n.isPartial())for(v=0;v<n._partialPaths.length;v++)o.push(n._partialPaths[v]);else g||n.getType()===i.GeometryType.PRODUCT?o.push(m):o.push(n);if(r.isPartial())for(v=0;v<r._partialPaths.length;v++)a.push(r._partialPaths[v]);else a.push(T);for(v=0;v<o.length;v++)for(var E=0;E<a.length;E++)y.push(o[v]),P.push(a[E]);for(g||(D=e===M.MeasuredType.MESH?M.retrieveMeshPrimitivesAndAABB(n):M.MeasuredType.CENTER===e?t.computeAABBForPoint(n.getCenter().toArray()):t.computeAABBForPoint(n.getSelPoint().toArray())),v=0;v<y.length;v++)V(y,P,v);for(var A=R.length,_=(new Date).getTime()-c,S=0;S<A;S++){var b;b=R[S];var N=x[S],I=M.measureBetweenWithParts(e,b,N,p,s,l);(!l&&I.squaredDistance<p||l&&I.squaredMaxDistance>p)&&(I.squaredDistance?p=I.squaredDistance:I.squaredMaxDistance&&(p=I.squaredMaxDistance),(u=I).product1=R[S],u.product2=x[S])}!f&&g||(u.product1=d),C&&(u.product2=h),s&&!0===s&&window.console.log("Measure Products: Parts Couples="+A+" Scan duration="+_+" Duration="+((new Date).getTime()-c))}(),u},measureBetweenWithParts:function(e,i,n,o,r,a){var s={},l=null;switch(e){case M.MeasuredType.PRODUCT:s=M.retrievePartPrimitivesAndAABB(i),l=i.getWorldMatrix();break;case M.MeasuredType.MESH:s=M.retrieveMeshPrimitivesAndAABB(i),l=i.getReferentialPosition();break;case M.MeasuredType.POINT:s.primitives=[],s.primitives[0]=i.getSelPoint().toArray(),s.AABB=[],s.AABB[0]=t.computeAABBForPoint(s.primitives[0]),l=null;break;case M.MeasuredType.CENTER:s.primitives=[],s.primitives[0]=i.getCenter().toArray(),s.AABB=[],s.AABB[0]=t.computeAABBForPoint(s.primitives[0]),l=null}var c=M.retrievePartPrimitivesAndAABB(n),u=n.getWorldMatrix();return M.measureBetweenPrimitivesAABB(e,s,l,c,u,o,r,a)},retrieveProductAABB:function(e,t){var i=[],n=e.bBox.clone().applyMatrix4(t);return i[0]=n.min.x,i[1]=n.min.y,i[2]=n.min.z,i[3]=n.max.x,i[4]=n.max.y,i[5]=n.max.z,i},makeAABBFromBox:function(e){if(e&&e.min&&e.max){var t=[];return t[0]=e.min.x,t[1]=e.min.y,t[2]=e.min.z,t[3]=e.max.x,t[4]=e.max.y,t[5]=e.max.z,t}},retrievePartPrimitivesAndAABB:function(e){for(var t={primitives:[]},i=o.getRenderables(e),n=i.length,a=0;a<n;a++)if(!o.isCompletlyHidden(i[a]))for(var s=i[a].geometry,l=s.length,u=0;u<l;u++){s[u].startIteration();for(var p=s[u].drawingGroups,m=p.length,y=0;y<m;y++)if(p[y]._geomType&&"FACE"===d.GeomTypeString[p[y]._geomType])for(var h=p[y].getPrimitivesCount(),g=0;g<h;g++){var P=new d.SGPrimitiveHelper;P.set(p[y],g),t.primitives.push(P)}s[u].endIteration()}if(0<t.primitives.length){var f=r.extractMeshVertices(t.primitives[0],void 0,1);0<f.length&&(t.vertice=new c.Vector3(f[0][0],f[0][1],f[0][2]));var T=r.extractMeshNormals(t.primitives[0],void 0,1);0<T.length&&(t.normal=new c.Vector3(T[0][0],T[0][1],T[0][2]))}t.AABB=[];for(var v=e.getWorldMatrix().elements,C=t.primitives.length,M=0;M<C;M++)t.AABB[M]=r.computeAABB(t.primitives[M],v);return t},retrieveMeshPrimitivesAndAABB:function(e){var t={primitives:[]};return t.primitives.push(e.getPrimitive()),t.AABB=[],t.AABB[0]=r.computeAABB(e.getPrimitive(),e.getReferentialPosition().elements),t},measureBetweenPrimitivesAABB:function(e,i,n,o,r,s,l,c){var u={},p=(new Date).getTime(),d=s||Number.MAX_VALUE;c&&(d=0),u.squaredDistance=d;var y,h=[],g=0,P=i.primitives.length,f=o.primitives.length,T=0;!function(){for(T=0;T<P;T++)for(var e=0;e<f;e++)y=c?t.computeAABBSquaredMaxDistance(i.AABB[T],o.AABB[e]):t.computeAABBSquaredDistance(i.AABB[T],o.AABB[e]),(!c&&y<d||c&&y>d)&&(h[g]=[T,e,y],g++)}();var v=h.length,C=0;if(e===M.MeasuredType.POINT||e===M.MeasuredType.CENTER){for(T=0;T<v&&d>m;T++)if(h[T][2]<d){var D=a.computePointMeshSquaredDistance(i.primitives[h[T][0]],o.primitives[h[T][1]],r,d);D.squaredDistance<d&&(d=D.squaredDistance,u=D),C++}}else{var E=m;for(c&&(E=0),T=0;T<v&&d>=E;T++){var A;if(!c&&h[T][2]<d||c&&h[T][2]>d)c?(d=0,A=a._computeTwoMeshesSquaredMaxDistance(i.primitives[h[T][0]],n,o.primitives[h[T][1]],r,d)):A=a.computeTwoMeshesSquaredDistance(i.primitives[h[T][0]],n,o.primitives[h[T][1]],r,d),(!c&&A.squaredDistance<d||c&&A.squaredMaxDistance>d)&&(A.squaredDistance?d=A.squaredDistance:A.squaredMaxDistance&&(d=A.squaredMaxDistance),u=A),C++}}return l&&!0===l&&window.console.log("Measure Parts: Primitives Couples="+P*f+" ("+P+"-"+f+")  Candidates="+h.length+"  MeasuredCandidates="+C+"  duration="+((new Date).getTime()-p)),u},getSightDirfor3DPoint:function(e,t){var i;if(!e||!e.currentViewpoint||!t)return;let n=(new c.Projector).projectVector(t.clone(),e.currentViewpoint.getCamera()),o=Math.round((0-n.y)*(e.canvas.offsetHeight/2)+e.canvas.offsetHeight/2),r=Math.round(n.x*(e.canvas.offsetWidth/2)+e.canvas.offsetWidth/2);if(o&&r){var a=e.devicePixelRatio;if(a){let t=new c.Vector2(o,r),n=e.getMousePosition(t),s=new c.Vector2(n.xPix/a,n.yPix/a),l=e.currentViewpoint.create3DRayFrom2DPoint(s);l&&l.direction&&(i=l.direction)}}return i&&e.currentViewpoint&&(i=e.currentViewpoint.getSightDirection()),i},isMeasurableParallel:function(e,t){var n,o;let r=!1,a=e.getType(),l=t.getType();var c;let u=e=>{var t;switch(e.getType()){case i.GeometryType.LINE:case i.GeometryType.CYLINDER:case i.GeometryType.CONE:t=e.getAxis();break;case i.GeometryType.PLANE:t=e.getPlane().normal}return t};return n=u(e),o=u(t),c=n.angleTo(o),a===i.GeometryType.PLANE&&l!==i.GeometryType.PLANE||l===i.GeometryType.PLANE&&a!==i.GeometryType.PLANE?(s.isZero(.5*Math.PI-c)||s.isZero(1.5*Math.PI-c))&&(r=!0):(s.isZero(0-c)||s.isZero(Math.PI-c)||s.isZero(2*Math.PI-c))&&(r=!0),r},MeasuredType:{POINT:0,MESH:1,PRODUCT:2,CENTER:3}};return M})),define("DS/DMUMeasurable/DMUMeshIntersection",["DS/DMUMeasurable/DMUMathsVector3D","DS/DMUMeasurable/DMUMathsBoundingGeometry","DS/DMUMeasurable/DMUMeshServices","DS/DMUMeasurable/DMUMeshMeasure","DS/Visualization/ThreeJS_DS"],(function(e,t,i,n,o){"use strict";var r=.001,a=1e-6,s={computeSectionCurves:function(t,i,n){for(var o,r,a,l,c,u={returnCode:2,nbIntersections:0,nbTotTriangles:0},p=[n[12],n[13],n[14]],d=[n[8],n[9],n[10]],m=-e.dot(p,d),y=t.getCount(),h=t.getStart(),g=t.getGroup().geometry,P=g.vertexIndexArray,f=g.vertexPositionArray,T=[0,0,0],v=[0,0,0],C=[0,0,0],M=[],D=[0,0,0,0,0,0],E=y/3,A=0;A<E;A++){u.nbTotTriangles++,c=3*P[l=h+3*A],T[0]=f[c],T[1]=f[c+1],T[2]=f[c+2],c=3*P[l+1],v[0]=f[c],v[1]=f[c+1],v[2]=f[c+2],c=3*P[l+2],C[0]=f[c],C[1]=f[c+1],C[2]=f[c+2],o=T[0]*d[0]+T[1]*d[1]+T[2]*d[2]+m,r=v[0]*d[0]+v[1]*d[1]+v[2]*d[2]+m,a=C[0]*d[0]+C[1]*d[1]+C[2]*d[2]+m;var _=0,S=0;if(o>0?r>0?a<=0&&(_=1):a>0?_=2:(_=1,S=2):r>0?(a>0&&(_=1),S=2):a>0&&(_=1),0!==_||0!==S){u.nbIntersections++;var b,N=3-_-S;(b=0===N?s._computeIntersectionTrianglePlane(T,v,C,p,d,D):1===N?s._computeIntersectionTrianglePlane(v,C,T,p,d,D):s._computeIntersectionTrianglePlane(C,T,v,p,d,D))&&2===b.length&&M.push([b[0],b[1]])}}if(M.length>0){u.returnCode=0,s._mergePolylines(M);for(var I=0;I<M.length;I++)s._simplifyPolylinePerpendicularDistance(M[I],4e-4,D);for(var w=M.length,R=0;R<w;R++)for(var x=M[R].length,V=0;V<x;V++)M[R][V]=e.transformPoint(M[R][V],i,M[R][V]);u.aPolylines=M}return u},_computeIntersectionTrianglePlane:function(e,t,i,n,o,a){var s,l=a||[0,0,0,0,0,0];l[0]=e[0]-t[0],l[1]=e[1]-t[1],l[2]=e[2]-t[2],l[3]=e[0]-i[0],l[4]=e[1]-i[1],l[5]=e[2]-i[2];var c=l[0]*o[0]+l[1]*o[1]+l[2]*o[2],u=l[3]*o[0]+l[4]*o[1]+l[5]*o[2];if(Math.abs(c)>r&&Math.abs(u)>r){var p=(n[0]-e[0])*o[0]+(n[1]-e[1])*o[1]+(n[2]-e[2])*o[2],d=p/c,m=p/u,y=l[0]*d,h=l[1]*d,g=l[2]*d,P=l[3]*m,f=l[4]*m,T=l[5]*m;(Math.abs(y-P)>r||Math.abs(h-f)>r||Math.abs(g-T)>r)&&((s=[])[0]=[y+e[0],h+e[1],g+e[2]],s[1]=[P+e[0],f+e[1],T+e[2]])}return s},_mergePolylines:function(e){for(var t,i,n,o,r,s,l=!0;l;){l=!1;for(var c=0;c<e.length;c++){t=e[c][0],i=e[c][e[c].length-1];for(var u=c+1;u<e.length;u++)if(n=e[u][0],o=e[u][e[u].length-1],(t[0]-n[0])*(t[0]-n[0])+(t[1]-n[1])*(t[1]-n[1])+(t[2]-n[2])*(t[2]-n[2])<a){for(r=1,s=e[u].length;r<s;r++)e[c].unshift(e[u][r]);t=e[c][0],e.splice(u,1),l=!0,u--}else if((t[0]-o[0])*(t[0]-o[0])+(t[1]-o[1])*(t[1]-o[1])+(t[2]-o[2])*(t[2]-o[2])<a){for(r=e[u].length-2;0<=r;r--)e[c].unshift(e[u][r]);t=e[c][0],e.splice(u,1),l=!0,u--}else if((i[0]-n[0])*(i[0]-n[0])+(i[1]-n[1])*(i[1]-n[1])+(i[2]-n[2])*(i[2]-n[2])<a){for(r=1,s=e[u].length;r<s;r++)e[c].push(e[u][r]);i=e[c][e[c].length-1],e.splice(u,1),l=!0,u--}else if((i[0]-o[0])*(i[0]-o[0])+(i[1]-o[1])*(i[1]-o[1])+(i[2]-o[2])*(i[2]-o[2])<a){for(r=e[u].length-2;0<=r;r--)e[c].push(e[u][r]);i=e[c][e[c].length-1],e.splice(u,1),l=!0,u--}}}},_simplifyPolylinePerpendicularDistance:function(e,t,i){for(var n,o,r,s,l,c=i||[0,0,0,0,0,0],u=1;u<e.length-1;u++)if(n=e[u-1],o=e[u],r=e[u+1],c[0]=r[0]-n[0],c[1]=r[1]-n[1],c[2]=r[2]-n[2],(s=c[0]*c[0]+c[1]*c[1]+c[2]*c[2])>a&&(l=((o[0]-n[0])*c[0]+(o[1]-n[1])*c[1]+(o[2]-n[2])*c[2])/s,c[3]=c[0]*l+n[0]-o[0],c[4]=c[1]*l+n[1]-o[1],c[5]=c[2]*l+n[2]-o[2],c[3]*c[3]+c[4]*c[4]+c[5]*c[5]<t)){for(var p=u+1;p<e.length;p++)e[p-1]=e[p];e.length=e.length-1,u--}},detectTwoMeshesInterference:function(e,t,o,r,s){var l=1,c=e&&e.getGroup()&&e.getGroup().geometry&&void 0!==e.getStart()&&void 0!==e.getCount()&&e.getCount()>0,u=o&&o.getGroup()&&o.getGroup().geometry&&void 0!==o.getStart()&&void 0!==o.getCount()&&o.getCount()>0;if(c&&u){l=0;var p=e.getGroup().glType,d=o.getGroup().glType;if(4===p&&4===d){var m=e.getCount(),y=i.extractMeshVertices(e,t.elements),h=m/3,g=o.getCount(),P=i.extractMeshVertices(o,r.elements),f=g/3,T=n._computeSurfaceSurfaceSquaredDistance(h,y,f,P,s);l=0===T.returnCode&&T.squaredDistance<a?2:0}}return l},computeRayMeshIntersection:function(i,n,o){var a,s,l,c,u,p,d={returnCode:1,aParameters:[]};function m(t,o,m){if(t){for(a=e.dot(n,o),s=e.dot(e.sub(i,m[0]),o)/a,l&&(s=-s),c=d.aParameters.length,u=!0,p=0;u&&p<c;p++)u=Math.abs(d.aParameters[p]-s)>r;u&&d.aParameters.push(s)}}if(i&&n&&o&&o.getGroup()&&o.getGroup().glType&&4===o.getGroup().glType){d.returnCode=0;var y=o.getCount(),h=o.getStart(),g=o.getGroup().geometry,P=g.vertexIndexArray,f=g.vertexPositionArray,T=t.computeAABBForUnsortedPoints(y,h,P,f);if(t.intersectAABBWithRay(T,i,n)){var v,C,M,D,E,A,_,S,b,N,I,w,R,x,V=y/3,L=[],G=[0,0,0],O=[!0,!0,!0],B=[!0,!0,!0];for(v=0;v<V;v++)if(D=3*P[M=h+3*v],L[0]=[f[D],f[D+1],f[D+2]],D=3*P[M+1],L[1]=[f[D],f[D+1],f[D+2]],D=3*P[M+2],L[2]=[f[D],f[D+1],f[D+2]],L[3]=L[0],E=L[1][0]-L[0][0],A=L[1][1]-L[0][1],_=L[1][2]-L[0][2],S=L[2][0]-L[0][0],b=L[2][1]-L[0][1],N=L[2][2]-L[0][2],N=L[2][2]-L[0][2],G[0]=A*N-_*b,G[1]=_*S-E*N,G[2]=E*b-A*S,I=G[0]*n[0]+G[1]*n[1]+G[2]*n[2],Math.abs(I)>r&&(w=G[0]*(i[0]-L[0][0])+G[1]*(i[1]-L[0][1])+G[2]*(i[2]-L[0][2]),I>0&&w<0||I<0&&w>0)){for(C=0;C<3;C++)E=L[C][0]-i[0],A=L[C][1]-i[1],_=L[C][2]-i[2],S=L[C+1][0]-i[0],b=L[C+1][1]-i[1],R=(A*(N=L[C+1][2]-i[2])-_*b)*n[0]+(_*S-E*N)*n[1]+(E*b-A*S)*n[2],O[C]=Math.abs(R)<r,B[C]=R>0;x=!1,O[0]?(x=!0,l=O[1]?B[2]:O[2]?B[1]:B[1]&&B[2]):O[1]?(x=!0,l=(O[2]||B[2])&&B[0]):O[2]?(x=!0,l=B[0]&&B[1]):B[0]&&B[1]&&B[2]?(x=!0,l=!0):B[0]||B[1]||B[2]||(x=!0,l=!1),m(x,G,L)}}}return d},computeRayIntersection:function(e,t,i,n,r){for(var a=new o.Ray(e,t),s=a.intersectMeshInstances({object:i},n,a.origin,1),l=s[0].object.id,c=[],u=0;u<s.length;u++)l===s[u].object.id&&c.push(s[u]);return r?c:c[0]}};return s})),define("DS/DMUMeasurable/DMUToolsInterference",["DS/DMUMeasurable/DMUMathsBoundingGeometry","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUMeasurable/DMUMeshIntersection","DS/DMUMeasurable/DMUToolsMeasure","DS/DMUMeasurable/DMUMathsVector3D","DS/Visualization/ThreeJS_DS","DS/Mesh/MeshUtils"],(function(e,t,i,n,o,r,a){"use strict";var s=1e-6,l={detectInterference:function(i,o,r,a){var s,c={returnCode:0,interfering1:[],interfering2:[]},u=2e-6;a&&!0===a&&(window.console.log("Clash Products: "+i.length+" / "+o.length),s=(new Date).getTime());for(var p=[],d=[],m=0;m<i.length;m++)for(var y=0;y<o.length;y++)p.push(i[m]),d.push(o[y]);for(var h,g,P,f,T=[],v=[],C=[],M=[],D=0;D<p.length;D++){var E=p[D].getLastElement(),A=d[D].getLastElement();if(h=n.retrieveProductAABB(E,p[D].getWorldMatrix()),g=n.retrieveProductAABB(A,d[D].getWorldMatrix()),e.computeAABBSquaredDistance(h,g)<u)if(P=t.isLeaf(E),f=t.isLeaf(A),P&&f)T.push(E),v.push(A),C.push(p[D]),M.push(d[D]);else if(P||!f&&E.bSphere.radius<A.bSphere.radius){for(var _=A.children.length,S=0;S<_;S++)if(t.isReferenceOrInstance(A.children[S])){p.push(p[D]);var b=d[D].clone();b.addElement(A.children[S]),d.push(b)}}else for(var N=E.children,I=N.length,w=0;w<I;w++){var R=N[w];if(t.isReferenceOrInstance(R)){var x=p[D].clone();x.addElement(R),p.push(x),d.push(d[D])}}}for(var V=T.length,L=(new Date).getTime()-s,G=0;0===c.returnCode&&G<V;G++){var O=n.retrievePartPrimitivesAndAABB(C[G]),B=C[G].getWorldMatrix(),U=n.retrievePartPrimitivesAndAABB(M[G]),q=M[G].getWorldMatrix();if(2===l._detectInterferenceBetweenPrimitivesAABB(O,B,U,q,u,a))c.returnCode=2,r&&(c.interfering1.push(C[G]),c.interfering2.push(M[G]));else if(O.vertice&&U.vertice){var z=l.computeRayProductInterferences(O.vertice.toArray(),[0,0,1],[M[G]]);(0===z.returnCode&&z.iSide<0||0===(z=l.computeRayProductInterferences(U.vertice.toArray(),[0,0,1],[C[G]])).returnCode&&z.iSide<0)&&(c.returnCode=2,r&&(c.interfering1.push(C[G]),c.interfering2.push(M[G])))}}return a&&!0===a&&window.console.log("Clash Products: Parts Couples="+V+" Scan duration="+L+" Duration="+((new Date).getTime()-s)),c},_detectInterferenceBetweenPrimitivesAABB:function(t,n,o,r,a,l){var c=0,u=(new Date).getTime(),p=[],d=0,m=t.primitives.length,y=o.primitives.length,h=0;for(h=0;h<m;h++)for(var g=0;g<y;g++)e.computeAABBSquaredDistance(t.AABB[h],o.AABB[g])<s&&(p[d]=[h,g],d++);var P=p.length,f=0;for(h=0;0===c&&h<P;h++)c=i.detectTwoMeshesInterference(t.primitives[p[h][0]],n,o.primitives[p[h][1]],r,a),f++;return l&&!0===l&&window.console.log("Clash Parts: Primitives Couples="+m*y+" ("+m+"-"+y+")  Candidates="+p.length+"  TestedCandidates="+f+"  duration="+((new Date).getTime()-u)),c},computeRayProductInterferences:function(n,s,l){for(var c={returnCode:0,iSide:0,aIntersections:[]},u=0;u<l.length;u++){var p=t.getRenderables(l[u]),d=[n[0],n[1],n[2]],m=[s[0],s[1],s[2]],y=l[u].getWorldMatrix();if(y&&!o.isIdentity(y.elements)){var h=(new r.Matrix4).getInverse(y).elements;d=o.transformPoint(n,h,d),m=o.transformVector(s,h,m)}for(var g=[],P=p.length,f=0;f<P;f++)if(!t.isCompletlyHidden(p[u])){var T=p[f].boundingBox.clone().applyMatrix4(y),v=[T.min.x,T.min.y,T.min.z,T.max.x,T.max.y,T.max.z];if(e.intersectAABBWithRay(v,n,s))for(var C=p[f].geometry,M=C.length,D=0;D<M;D++){C[D].startIteration();for(var E=C[D].drawingGroups,A=E.length,_=0;_<A;_++)if(E[_]._geomType&&"FACE"===a.GeomTypeString[E[_]._geomType])for(var S=E[_].getPrimitivesCount(),b=0;b<S;b++){var N=new a.SGPrimitiveHelper;N.set(E[_],b);var I=i.computeRayMeshIntersection(d,m,N);if(0===I.returnCode)for(var w=0;w<I.aParameters.length;w++){for(var R=g.length,x=!0,V=0;x&&V<R;V++)x=Math.abs(g[V]-I.aParameters[w])>.001;if(x){g.push(I.aParameters[w]),c.iSide+=I.aParameters[w]>0?1:-1;var L=o.multiplyAndAdd(s,Math.abs(I.aParameters[w]),n),G=new r.Vector3(L[0],L[1],L[2]);c.aIntersections.push({primitive:N,point:G,normal:null,distance:o.subAndLength(L,n),geometry:C[D],object:p[f]})}}}C[D].endIteration()}}}return c.aIntersections.sort((function(e,t){return e.distance-t.distance})),c}};return l})),define("DS/DMUMeasurable/DMUMeasurable",["UWA/Core","DS/DMUMeasurable/DMUGeometryEnums","DS/DMUMeasurable/DMUMeshServices","DS/DMUMeasurable/DMUMeshRecognition","DS/DMUMeasurable/DMUToolsMeasure","DS/DMUMeasurable/DMUMeasureEnums","DS/Visualization/ThreeJS_DS","DS/WebPolyMaths/WebMeshIntersection","DS/WebPolyMaths/WebToolsMaths","DS/Visualization/PathElement","DS/DMUMeasurable/DMUToolsMaths"],(function(e,t,i,n,o,r,a,s,l,c,u){"use strict";var p=e.Class.extend({init:function(e,o){var s=this;if(!o){s._bRealPathElement=!1;var l=function(e){var t;if(e&&(s._rayDir=e.rayDir),e.pathElement?(s._pathElement=e.pathElement.clone(),s._bRealPathElement=!0,s._matrix=s._pathElement.getWorldMatrix()):s._matrix=e.position?e.position.clone():new a.Matrix4,e.selpoint){var i=(new a.Matrix4).getInverse(s._getMatrix());s._selPosition=e.selpoint.clone().applyMatrix4(i)}if(e.selnormal){var o=(new a.Matrix4).getInverse(s._getMatrix());s._selNormal=e.selnormal.clone().transformDirection(o)}return e.canonic?((t=e.canonic).exact=!e.isApprox,t.returnCode=0,s._length=e.canonic.length,s._cog=e.canonic.cog,s._area=e.canonic.area,s._SGPrimitive=e.canonic.primitive):e.primitive&&(s._SGPrimitive=e.primitive,t=e.bAvoidRecognition?{returnCode:1}:n.recognizeCanonicGeometry(s._SGPrimitive,new a.Matrix4,!0)),t}(e);if(0===l.returnCode)!function(n){switch(s._type=n.type,n.type){case t.GeometryType.POINT:case t.GeometryType.PICKINGPT:s._selectedType=r.ViewedType.POINT,s._position=n.position,s._selPosition||(s._selPosition=n.position.clone()),void 0!==e.bIsPOISelection&&(s._bIsPOISelection=e.bIsPOISelection);break;case t.GeometryType.LINE:s._selectedType=r.ViewedType.AXIS,s._point1=n.point1,s._point2=n.point2,s._selPosition||(s._selPosition=s._point1.clone());break;case t.GeometryType.CIRCLE:s._selectedType=r.ViewedType.CIRCLE,s._center=n.center,s._radius=n.radius,s._normal=n.normal;var o=i.extractMeshVertices(s._SGPrimitive),l=o.length-1;s._point1=new a.Vector3(o[0][0],o[0][1],o[0][2]),s._point2=new a.Vector3(o[l][0],o[l][1],o[l][2]);var c,u,p=0;o.length%2?(p=(o.length-1)/2-1,c=new a.Vector3(o[p][0],o[p][1],o[p][2]),u=new a.Vector3(o[p+2][0],o[p+2][1],o[p+2][2])):(p=o.length/2-1,c=new a.Vector3(o[p][0],o[p][1],o[p][2]),u=new a.Vector3(o[p+1][0],o[p+1][1],o[p+1][2]));var d=c.clone().add(u.clone()).multiplyScalar(.5).clone().sub(n.center.clone()).normalize().multiplyScalar(n.radius).clone().add(n.center.clone());s._arcMidPoint=new a.Vector3(d.x,d.y,d.z);var m=s._point1.clone().sub(s._center),y=s._point2.clone().sub(s._center),h=s._arcMidPoint.clone().sub(s._center);s._arcAngle=m.angleTo(h)+y.angleTo(h),n.arcLength||(n.arcLength=s._arcAngle*s._radius),n.length||(n.length=2*Math.PI*s._radius),s._arcLength=n.arcLength,s._length=n.length;break;case t.GeometryType.PLANE:s._selectedType=r.ViewedType.INFPLANE,s._origin=n.origin,s._normal=n.normal,s._selPosition||(s._selPosition=s._origin.clone()),void 0!==e.bIsPOISelection&&(s._bIsPOISelection=e.bIsPOISelection);break;case t.GeometryType.CYLINDER:s._selectedType=r.ViewedType.CYCOSP,s._radius=n.radius,s._point1=n.point1,s._point2=n.point2,void 0!==e.bIsPOISelection&&(s._bIsPOISelection=e.bIsPOISelection);break;case t.GeometryType.CONE:s._selectedType=r.ViewedType.CYCOSP,s._apex=n.apex,s._semiAngle=n.semiAngle,s._axis=n.axis,s._point1=n.point1,s._point2=n.point2,n.topRadius&&n.topRadius>.001&&(s._minRadius=n.topRadius),n.baseRadius&&(s._maxRadius=n.baseRadius),void 0!==e.bIsPOISelection&&(s._bIsPOISelection=e.bIsPOISelection);break;case t.GeometryType.SPHERE:s._selectedType=r.ViewedType.CYCOSP,s._radius=n.radius,s._center=n.center,void 0!==e.bIsPOISelection&&(s._bIsPOISelection=e.bIsPOISelection);break;case t.GeometryType.PRODUCT:s._selectedType=r.ViewedType.PRODUCT,s._position=n.position,!s._selPosition&&n.position&&(s._selPosition=n.position.clone())}s._mode=n.exact?t.Mode.EXACT:t.Mode.FACETTED}(l);else{switch(s._SGPrimitive.getGroup().glType){case 1:s._type=t.GeometryType.CURVE,s._selectedType=r.ViewedType.CURVE;var c=i.extractMeshVertices(s._SGPrimitive),u=c.length-1;s._point1=new a.Vector3(c[0][0],c[0][1],c[0][2]),s._point2=new a.Vector3(c[u][0],c[u][1],c[u][2]),s._selPosition||(s._selPosition=s._point1.clone());break;case 4:if(s._type=t.GeometryType.SURFACE,s._selectedType=r.ViewedType.SURFACE,!s._selPosition){var p=i.extractMeshVertices(s._SGPrimitive,void 0,1);s._selPosition=new a.Vector3(p[0][0],p[0][1],p[0][2])}void 0!==e.bIsPOISelection&&(s._bIsPOISelection=e.bIsPOISelection)}s._mode=t.Mode.FACETTED}s._isPartial=!1,s._partialPaths=[]}return this},clone:function(){var e=new p({},!0);if(e._type=this._type,e._mode=this._mode,this._SGPrimitive&&(e._SGPrimitive=this._SGPrimitive),this._pathElement&&(e._pathElement=this._pathElement.clone()),this._bRealPathElement&&(e._bRealPathElement=this._bRealPathElement),this._selPosition&&(e._selPosition=this._selPosition),this._selNormal&&(e._selNormal=this._selNormal),this._position&&(e._position=this._position),this._point1&&(e._point1=this._point1.clone()),this._point2&&(e._point2=this._point2.clone()),this._origin&&(e._origin=this._origin.clone()),this._normal&&(e._normal=this._normal.clone()),this._center&&(e._center=this._center.clone()),this._apex&&(e._apex=this._apex.clone()),this._axis&&(e._axis=this._axis.clone()),this._radius&&(e._radius=this._radius),this._semiAngle&&(e._semiAngle=this._semiAngle),this._length&&(e._length=this._length),this._area&&(e._area=this._area),this._cog&&(e._cog=this._cog),this._selectedType&&(e._selectedType=this._selectedType),this._isPartial&&(e._isPartial=this._isPartial),this._matrix&&(e._matrix=this._matrix),this._partialPaths&&(e._partialPaths=[],this._partialPaths.length>0))for(var t=0;t<this._partialPaths.length;t++)e._partialPaths.push(this._partialPaths[t].clone());return this._arcMidPoint&&(e._arcMidPoint=this._arcMidPoint.clone()),this._arcAngle&&(e._arcAngle=this._arcAngle),this._selectedTypeWithFilter&&(e._selectedTypeWithFilter=this._selectedTypeWithFilter),this.vSlat&&(e.vSlat=this.vSlat.clone()),this._bIsPOISelection&&(e._bIsPOISelection=this._bIsPOISelection),e},getType:function(){return this._type},setType:function(e){this._type=e},getTypeWithSelFilter:function(){return this._selectedTypeWithFilter},setTypeWithSelFilter:function(e){this._selectedTypeWithFilter=e},getMode:function(){return this._mode},getPrimitive:function(){return this._SGPrimitive},getPathElement:function(){return this._bRealPathElement?this._pathElement.clone():new c},setLevel:function(e){this._level=e},getLevel:function(){return this._level},setPartial:function(e){this._isPartial=e},isPartial:function(){return this._isPartial},setPartialPathElements:function(e){this._partialPaths=[],this._partialPaths=e},setReferentialPosition:function(e){!this._bRealPathElement&&e&&e instanceof a.Matrix4&&(this._matrix=e.clone())},getReferentialPosition:function(){return this._getMatrix().clone()},getPoint:function(){var e=null;return this._type===t.GeometryType.POINT&&this._position&&(e=this._position.clone().applyMatrix4(this._getMatrix())),e},getPoints:function(){var e=null;return this._type!==t.GeometryType.LINE&&this._type!==t.GeometryType.CURVE&&this._type!==t.GeometryType.CYLINDER&&this._type!==t.GeometryType.CONE&&this._type!==t.GeometryType.CIRCLE&&this._type!==t.GeometryType.PRODUCT||(e={},this._point1&&this._point2&&(e.beginPoint=this._point1.clone().applyMatrix4(this._getMatrix()),e.endPoint=this._point2.clone().applyMatrix4(this._getMatrix()))),e},getPlane:function(){var e=null;return this._type===t.GeometryType.PLANE&&((e={}).origin=this._origin.clone().applyMatrix4(this._getMatrix()),e.normal=this._normal.clone().transformDirection(this._getMatrix())),e},get2DScale:function(){return this._getMatrix().getScaleOnAxisX()},getRadius:function(){var e=null;return this._type!==t.GeometryType.CIRCLE&&this._type!==t.GeometryType.CYLINDER&&this._type!==t.GeometryType.SPHERE||(e=this._radius),e},getMaxRadius:function(){var e=null;return this._type===t.GeometryType.CONE&&(e=this._maxRadius),e},getMinRadius:function(){var e=null;return this._type===t.GeometryType.CONE&&(e=this._minRadius),e},getCenter:function(){var e=null;return this._type!==t.GeometryType.CIRCLE&&this._type!==t.GeometryType.SPHERE||(e=this._center.clone().applyMatrix4(this._getMatrix())),e},getAxis:function(){var e=null;return this._type===t.GeometryType.CIRCLE?e=this._normal.clone().transformDirection(this._getMatrix()):this._type!==t.GeometryType.LINE&&this._type!==t.GeometryType.CYLINDER&&this._type!==t.GeometryType.CONE||(e=this._point2.clone().sub(this._point1).normalize().transformDirection(this._getMatrix())),e},getAngle:function(){var e=null;return this._type===t.GeometryType.CIRCLE&&(e=2*Math.PI),e},getArcMidPoint:function(){var e=null;return this._type===t.GeometryType.CIRCLE&&(e=this._arcMidPoint.clone().applyMatrix4(this._getMatrix())),e},getArcAngle:function(){var e=null;return this._type===t.GeometryType.CIRCLE&&(e=this._arcAngle),e},getSemiAngle:function(){var e=null;return this._type===t.GeometryType.CONE&&(e=this._semiAngle),e},getApex:function(){var e=null;return this._type===t.GeometryType.CONE&&(e=this._apex.clone().applyMatrix4(this._getMatrix())),e},getLength:function(){var e=null;return this._type===t.GeometryType.LINE||this._type===t.GeometryType.CIRCLE||this._type===t.GeometryType.CURVE?(this._length||this._complete(),e=this._length):this._type===t.GeometryType.PRODUCT&&this._length&&(e=this._length),e},getArcLength:function(){var e=null;return this._type===t.GeometryType.CIRCLE&&(this._arcLength||this._complete(),e=this._arcLength),e},getCoG:function(){var e=null;return this._type!==t.GeometryType.SURFACE&&this._type!==t.GeometryType.CYLINDER&&this._type!==t.GeometryType.SPHERE&&this._type!==t.GeometryType.CONE&&this._type!==t.GeometryType.PLANE&&this._type!==t.GeometryType.PRODUCT||(this._cog||this._complete(),this._cog&&(e=this._cog.clone().applyMatrix4(this._getMatrix()))),e},getArea:function(){var e=null;return this._type!==t.GeometryType.SURFACE&&this._type!==t.GeometryType.CYLINDER&&this._type!==t.GeometryType.SPHERE&&this._type!==t.GeometryType.CONE&&this._type!==t.GeometryType.PLANE&&this._type!==t.GeometryType.PRODUCT||(this._area||this._complete(),this._area&&(e=this._area)),e},getVolume:function(){var e=null;return this.volume||this._complete(),this.volume&&(e=this.volume),e},getSelPoint:function(){var e;return this._type===t.GeometryType.POINT&&void 0!==this._position?e=this._position.clone().applyMatrix4(this._getMatrix()):void 0!==this._selPosition?e=this._selPosition.clone().applyMatrix4(this._getMatrix()):void 0!==this._point1&&(e=this._point1.clone().applyMatrix4(this._getMatrix())),e},getSelNormal:function(){return this._selNormal?this._selNormal.clone().transformDirection(this._getMatrix()):void 0},getOriginPoint:function(){var e=null;return this._originPoint&&this._type===t.GeometryType.PRODUCT&&(e=this._originPoint.clone().applyMatrix4(this._getMatrix())),e},getHeight:function(){var e=null;if((this._type===t.GeometryType.CYLINDER||this._type===t.GeometryType.CONE)&&this._point1&&this._point2){var i=this._point1.clone().applyMatrix4(this._getMatrix()),n=this._point2.clone().applyMatrix4(this._getMatrix());e=i.distanceTo(n)}return e},computeMinimumDistance:function(e){var t={returnCode:1};if(e){var i=o.measureBetween(this,this._selectedType,e,e._selectedType);i.position1&&(t.distance=i.distance,t.relationship=i.relationship,t.position1=i.position1,t.position2=i.position2,t.returnCode=0)}return t},computeAngle:function(e){var t={returnCode:1};if(e){var i=o.measureBetween(this,this._selectedType,e,e._selectedType);i.position1&&(t.angle=i.angle,t.returnCode=0)}return t},exportData:function(e){var i={canonic:{}};switch(i.canonic.type=e(this._type,"int"),i.canonic.mode=e(this._mode,"int"),i.canonic.selectedType=e(this._selectedType,"int"),i.canonic.matrix=e(this._getMatrix(),"Matrix4"),this._type){case t.GeometryType.POINT:case t.GeometryType.PICKINGPT:i.canonic.position=e(this._position,"Vector3");break;case t.GeometryType.LINE:i.canonic.point1=e(this._point1,"Vector3"),i.canonic.point2=e(this._point2,"Vector3"),this._length||this._complete(),i.canonic.length=e(this._length,"float");break;case t.GeometryType.CIRCLE:i.canonic.center=e(this._center,"Vector3"),i.canonic.radius=e(this._radius,"float"),i.canonic.normal=e(this._normal,"Vector3"),this._length&&this._arcLength||this._complete(),i.canonic.length=e(this._length,"float"),i.canonic.arcLength=e(this._arcLength,"float"),i.canonic.arcMidPoint=e(this._arcMidPoint,"Vector3"),i.canonic.point1=e(this._point1,"Vector3"),i.canonic.point2=e(this._point2,"Vector3"),i.canonic.arcAngle=e(this._arcAngle,"float");break;case t.GeometryType.PLANE:i.canonic.origin=e(this._origin,"Vector3"),i.canonic.normal=e(this._normal,"Vector3"),this._cog&&this._area||this._complete(),i.canonic.cog=e(this._cog,"Vector3"),i.canonic.area=e(this._area,"float");break;case t.GeometryType.CYLINDER:i.canonic.radius=e(this._radius,"float"),i.canonic.point1=e(this._point1,"Vector3"),i.canonic.point2=e(this._point2,"Vector3"),this._cog&&this._area||this._complete(),i.canonic.cog=e(this._cog,"Vector3"),i.canonic.area=e(this._area,"float");break;case t.GeometryType.CONE:i.canonic.apex=e(this._apex,"Vector3"),i.canonic.semiAngle=e(this._semiAngle,"float"),i.canonic.axis=e(this._axis,"Vector3"),i.canonic.point1=e(this._point1,"Vector3"),i.canonic.point2=e(this._point2,"Vector3"),this._cog&&this._area||this._complete(),i.canonic.cog=e(this._cog,"Vector3"),i.canonic.area=e(this._area,"float"),this.vSlat&&(i.canonic.slant=e(this.vSlat,"Vector3"));break;case t.GeometryType.SPHERE:i.canonic.radius=e(this._radius,"float"),i.canonic.center=e(this._center,"Vector3"),this._cog&&this._area||this._complete(),i.canonic.cog=e(this._cog,"Vector3"),i.canonic.area=e(this._area,"float");break;case t.GeometryType.SURFACE:this._cog&&this._area||this._complete(),i.canonic.cog=e(this._cog,"Vector3"),i.canonic.area=e(this._area,"float");break;case t.GeometryType.CURVE:this._length||this._complete(),i.canonic.length=e(this._length,"float"),i.canonic.point1=e(this._point1,"Vector3"),i.canonic.point2=e(this._point2,"Vector3")}return i.selpoint=e(this._selPosition,"Vector3"),this._selNormal&&(i.selnormal=e(this._selNormal,"Vector3")),this._bIsPOISelection&&(i.bIsPOISelection=e(this._bIsPOISelection,"bool")),i},importData:function(e,t){return this._type=t(e.canonic.type,"int"),this._mode=t(e.canonic.mode,"int"),this._bRealPathElement=!1,this._pathElement={},this._matrix=e.canonic.matrix?t(e.canonic.matrix,"Matrix4"):new a.Matrix4,e.selpoint&&(this._selPosition=t(e.selpoint,"Vector3")),e.selnormal&&(this._selNormal=t(e.selnormal,"Vector3")),e.bIsPOISelection&&(this._bIsPOISelection=t(e.bIsPOISelection,"bool")),e.canonic.position&&(this._position=t(e.canonic.position,"Vector3")),e.canonic.point1&&(this._point1=t(e.canonic.point1,"Vector3")),e.canonic.point2&&(this._point2=t(e.canonic.point2,"Vector3")),e.canonic.origin&&(this._origin=t(e.canonic.origin,"Vector3")),e.canonic.normal&&(this._normal=t(e.canonic.normal,"Vector3")),e.canonic.center&&(this._center=t(e.canonic.center,"Vector3")),e.canonic.apex&&(this._apex=t(e.canonic.apex,"Vector3")),e.canonic.axis&&(this._axis=t(e.canonic.axis,"Vector3")),e.canonic.radius&&(this._radius=t(e.canonic.radius,"float")),e.canonic.semiAngle&&(this._semiAngle=t(e.canonic.semiAngle,"float")),e.canonic.length&&(this._length=t(e.canonic.length,"float")),e.canonic.area&&(this._area=t(e.canonic.area,"float")),e.canonic.cog&&(this._cog=t(e.canonic.cog,"Vector3")),e.canonic.selectedType&&(this._selectedType=t(e.canonic.selectedType,"int")),e.canonic.arcMidPoint&&(this._arcMidPoint=t(e.canonic.arcMidPoint,"Vector3")),e.canonic.arcLength&&(this._arcLength=t(e.canonic.arcLength,"float")),e.canonic.arcAngle&&(this._arcAngle=t(e.canonic.arcAngle,"float")),e.canonic.slant&&(this.vSlat=t(e.canonic.slant,"Vector3")),this},print:function(e){var i=void 0!==e?e:"Measurable";switch(window.console.log(i),this._type){case t.GeometryType.POINT:window.console.log("    type=POINT point=("+this._position.x+", "+this._position.y+", "+this._position.z+")");break;case t.GeometryType.CURVE:window.console.log("    type=CURVE point1=("+this._point1.x+", "+this._point1.y+", "+this._point1.z+") point2=("+this._point2.x+", "+this._point2.y+", "+this._point2.z+")");break;case t.GeometryType.LINE:window.console.log("    type=LINE point1=("+this._point1.x+", "+this._point1.y+", "+this._point1.z+") point2=("+this._point2.x+", "+this._point2.y+", "+this._point2.z+")");break;case t.GeometryType.CIRCLE:window.console.log("    type=CIRCLE radius="+this._radius+" center=("+this._center.x+", "+this._center.y+", "+this._center.z+") normal=("+this._normal.x+", "+this._normal.y+", "+this._normal.z+")");break;case t.GeometryType.SURFACE:window.console.log("    type=SURFACE area="+this._area+" cog=("+this._cog.x+", "+this._cog.y+", "+this._cog.z+")");break;case t.GeometryType.PLANE:window.console.log("    type=PLANE origin=("+this._origin.x+", "+this._origin.y+", "+this._origin.z+") normal=("+this._normal.x+", "+this._normal.y+", "+this._normal.z+")");break;case t.GeometryType.CYLINDER:window.console.log("    type=CYLINDER point1=("+this._point1.x+", "+this._point1.y+", "+this._point1.z+") point2=("+this._point2.x+", "+this._point2.y+", "+this._point2.z+")");break;case t.GeometryType.CONE:window.console.log("    type=CONE point1=("+this._point1.x+", "+this._point1.y+", "+this._point1.z+") point2=("+this._point2.x+", "+this._point2.y+", "+this._point2.z+")");break;case t.GeometryType.SPHERE:window.console.log("    type=SPHERE center=("+this._center.x+", "+this._center.y+", "+this._center.z+")")}var n=this._getMatrix().elements;window.console.log("    transformation=("+n[0]+", "+n[4]+", "+n[8]+"), ("+n[1]+", "+n[5]+", "+n[9]+"), ("+n[2]+", "+n[6]+", "+n[10]+"), ("+n[3]+", "+n[7]+", "+n[11]+")")},_complete:function(){if(this._type===t.GeometryType.PRODUCT)this.updateProductMeasurable();else{var e=n.recognizeNonCanonicGeometry(this._SGPrimitive,new a.Matrix4,!0);this._type===t.GeometryType.CIRCLE?(this._arcLength=e.arcLength,this._length=e.length):this._type===t.GeometryType.LINE?this._length=e.length:this._type===t.GeometryType.PLANE||this._type===t.GeometryType.CYLINDER||this._type===t.GeometryType.CONE||this._type===t.GeometryType.SPHERE?(this._area=e.area,this._cog=e.cog):this._type===t.GeometryType.CURVE?this._length=e.length:(this._area=e.area,this._cog=e.cog)}},_getMatrix:function(){var e=this._matrix?this._matrix:this._pathElement&&this._pathElement.getWorldMatrix?this._pathElement.getWorldMatrix():void 0;return e||(e=new a.Matrix4),e},getMatrix:function(){return this._getMatrix()},getSightRay:function(){return this._rayDir},getLimitGeometryPointsLocatedOnLine:function(e,t){for(var n,o,r=this.getReferentialPosition(),s=i.extractMeshVertices(this._SGPrimitive,r.elements),l=s.length,c=void 0,p=void 0,d=0;d<l;d++){var m,y=new a.Vector3(s[d][0],s[d][1],s[d][2]),h=t.clone().sub(y.clone()),g=e.angleTo(h);if(u.isZero(0-g)||u.isZero(Math.PI-g))if(void 0===n&&void 0===o)n=y,o=y;else u.isZero(0-g)?(m=t.clone().sub(n.clone()),h.length()>m.length()&&(c=n,n=y)):(m=t.clone().sub(o.clone()),h.length()>m.length()&&(p=o,o=y))}return c&&void 0===p&&n.clone().distanceTo(o.clone())<n.clone().distanceTo(c.clone())?o=c:void 0===c&&p&&o.clone().distanceTo(n.clone())<o.clone().distanceTo(p.clone())&&(n=p),{firstLimit:n,secondLimit:o}},getExtremityProjPointsOnPlane:function(e){for(var t,n,o,r,s=this.getReferentialPosition(),l=i.extractMeshVertices(this._SGPrimitive,s.elements),c=l.length,u=0;u<c;u++){var p=new a.Vector3(l[u][0],l[u][1],l[u][2]),d=e.projectPoint(p);if(0===u)t=p,o=p,n=d,r=d;else{var m=d.clone().sub(n.clone()),y=d.clone().sub(r.clone());0===m.length()?p.clone().distanceTo(n)<t.clone().distanceTo(n)&&(t=p,n=d):0===y.length()?p.clone().distanceTo(r)<o.clone().distanceTo(r)&&(o=p,r=d):d.clone().distanceTo(r)>n.clone().distanceTo(r)||d.clone().distanceTo(r)===n.clone().distanceTo(r)&&p.clone().distanceTo(d)<=t.clone().distanceTo(n)?(t=p,n=d):(d.clone().distanceTo(n)>r.clone().distanceTo(n)||d.clone().distanceTo(n)===r.clone().distanceTo(n)&&p.clone().distanceTo(d)<=o.clone().distanceTo(r))&&(o=p,r=d)}}return{firstLimit:t,secondLimit:o}},getLimitPoints:function(e,t){var i={};if(this.getPoints())i.returnCode=0,i.firstLimit=this.getPoints().beginPoint,i.secondLimit=this.getPoints().endPoint;else{var n=e.clone(),o=function(e){if(e){var t,i;e.normalize();var n=(t=new a.Vector3(1,0,0).projectOnPlane(e)).length(),o=(i=new a.Vector3(0,1,0).projectOnPlane(e)).length(),r=(new a.Vector3).crossVectors(new a.Vector3(0,0,1),e),s=new a.Vector3(0,0,1).dot(e);return l.areEqual(Math.abs(s),1,"float")?l.areEqual(n,o,"float")?(t.normalize(),i=(new a.Vector3).crossVectors(e,t).normalize()):n<o?(i.normalize(),t=(new a.Vector3).crossVectors(i,e).normalize()):(t.normalize(),i=(new a.Vector3).crossVectors(e,t).normalize()):(t=r.normalize(),i=(new a.Vector3).crossVectors(e,t).normalize()),{xDir:t,yDir:i}}}(n),r=o.xDir,c=o.yDir,u=t.clone(),p=(new a.Matrix4).makeBasis(r,c,n).setPosition(u),d=(new a.Matrix4).getInverse(p).clone().multiply(this.getMatrix()).elements,m=(new a.Matrix4).getInverse(this.getMatrix()).multiply(p).elements;if(0===(i=s.computeSectionCurves(this.getPrimitive(),d,m)).returnCode){for(var y=0;y<i.aPolylines.length;y++){var h=i.aPolylines[y],g=new a.Vector3(h[0][0],h[0][1],h[0][2]),P=new a.Vector3(h[h.length-1][0],h[h.length-1][1],h[h.length-1][2]);if(0===y)i.firstLimit=g.clone(),i.secondLimit=P.clone();else{var f=i.firstLimit.clone().distanceTo(i.secondLimit),T=g.clone().distanceTo(i.firstLimit);T>g.clone().distanceTo(i.secondLimit)&&T>f?i.secondLimit=g.clone():g.clone().distanceTo(i.secondLimit)>f&&(i.firstLimit=g.clone());var v=P.clone().distanceTo(i.firstLimit);f=i.firstLimit.clone().distanceTo(i.secondLimit),v>P.clone().distanceTo(i.secondLimit)&&v>f?i.secondLimit=P.clone():P.clone().distanceTo(i.secondLimit)>f&&(i.firstLimit=P.clone())}}i.firstLimit.applyMatrix4(p),i.secondLimit.applyMatrix4(p)}}return i},updateProductMeasurable:function(){var e=o.measureProduct(this);this.volume=void 0,this._area=void 0,this._cog=void 0,this._length=void 0,this._point1=void 0,this._point2=void 0,this._originPoint=void 0,void 0!==e.volume&&(this.volume=e.volume),void 0!==e.area&&(this._area=e.area),void 0!==e.length&&(this._length=e.length);var t=(new a.Matrix4).getInverse(this._getMatrix());void 0!==e.startpoint&&void 0!==e.endpoint&&(this._point1=e.startpoint.clone().applyMatrix4(t),this._point2=e.endpoint.clone().applyMatrix4(t)),void 0!==e.cog&&(this._cog=e.cog.clone().applyMatrix4(t),this._selPosition||(this._selPosition=this._cog.clone())),void 0!==e.originPoint&&(this._originPoint=e.originPoint)}});return p})),define("DS/DMUMeasurable/DMUSectionPosService",["DS/Visualization/ThreeJS_DS","DS/DMUMeasurable/DMUGeometryEnums","DS/DMUMeasurable/DMUMathsInfiniteGeometry","DS/DMUMeasurable/DMUMathsVector3D","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUMeasurable/DMUToolsMaths","DS/Visualization/PathElement","DS/DMUMeasurable/DMUMeasurable"],(function(e,t,i,n,o,r,a,s){"use strict";var l,c,u,p=function(t,i){var n;t.negate(),t.normalize();var r=o.getXYAxisDirFromZ(t.clone());return r.xDir&&r.yDir&&t&&i&&(n=(new e.Matrix4).makeBasis(r.xDir,r.yDir,t)).setPosition(i),n},d=function(t,i){if(t&&i.getSelPoint()){var n=new e.Vector3,o=new e.Vector3,r=new e.Vector3;t.extractBasis(n,o,r);var a=(new e.Vector3).getPositionFromMatrix(t),s=(new e.Plane).setFromNormalAndCoplanarPoint(r.clone(),a.clone());a=s.projectPoint(i.getSelPoint())}},m=function(e,t){var i=t.dot(e);return t.multiplyScalar(i>0?1:-1).negate()},y=function(i){if(i){var n=i.pathElement;if(n){var r;u=i.position?i.position:n.position;var a=i.isOOCTileSetNodeInPath?i.isOOCTileSetNodeInPath:o.isOOCTileSetNodeInPath(n);if(n.getLastElement().sgNode||a){if(a){var l=(new e.Matrix4).getInverse(n.getWorldMatrix()),c=u.clone().applyMatrix4(l);r=new s({canonic:{type:t.GeometryType.POINT,position:c},pathElement:n,selpoint:u})}else r=new s({primitive:n.getLastElement().sgNode,pathElement:n,selpoint:u,selnormal:i.normal?i.normal:n.normal});return r}}}},h=function(t,o,a,s,d,y){if(!(r.areEqual(t,o,"Vector3")||r.areEqual(o,a,"Vector3")||r.areEqual(a,t,"Vector3"))){(l=new e.Vector3).subVectors(o.clone(),a.clone()).normalize();var h=i.computePointLineDistance(t.clone().toArray(),o.clone().toArray(),l.clone().toArray());if(h&&0===h.returnCode&&h.distance>.001){if(c=(new e.Plane).setFromCoplanarPoints(t,o,a),d){var g=c.projectPoint(d);y(g)&&(u=g)}if(u||(u=n.add(t,o,a)),c&&c.normal)return{planeDef:p(m(s.sight,c.normal.clone()),u)}}}},g=function(n,o,r,a,s,l,d){if(n&&o&&r&&a){var y=i.computeTwoLinesDistance(n.beginPoint.clone().toArray(),o.clone().toArray(),r.clone().toArray(),a.clone().toArray());if(y&&0===y.returnCode)if(y.angle<.001){if(y.relationship!==t.Relationship.COINCIDENT)return h(r.clone(),n.beginPoint.clone(),n.endPoint.clone(),s,l,d)}else if(y.relationship===t.Relationship.INTERSECTING)return function(t,i,n,o,r){if(t&&i){if(c=(new e.Plane).setFromNormalAndCoplanarPoint(t,i),o){var a=c.projectPoint(o);r(a)&&(u=a)}if(u||(u=i),c&&c.normal)return{planeDef:p(m(n.sight,c.normal.clone()),u)}}}(o.clone().cross(a.clone()).normalize().clone(),r.clone(),s,l,d)}},P=function(i,n,o,r){var a;if(i.getType()===t.GeometryType.PLANE){if(c=i.getPlane(),l=c.normal.clone().normalize(),(a=i.getSelPoint())||(a=c.origin.clone()),c=(new e.Plane).setFromNormalAndCoplanarPoint(l,a),o){var s=c.projectPoint(o);r(s)&&(u=s)}return u||(u=a),{planeDef:p(m(n.sight,l),c.projectPoint(u)),treatOnlyPlane:!0}}},f={getSelMapName:function(e,i){if(null==e)return"";switch(e){case t.GeometryType.POINT:case t.GeometryType.SPHERE:return"Point";case t.GeometryType.LINE:return"Line";case t.GeometryType.PLANE:return"Normal";case t.GeometryType.CYLINDER:case t.GeometryType.CONE:case t.GeometryType.CIRCLE:return i&&e===t.GeometryType.CIRCLE?"Line":"Axis";default:return""}},getMeasurable:function(e){return y(e)},computePlaneDim:function(n,o,a,s,l){var c=[],u=o,p=n,d=Math.max(p.max.x-p.min.x,p.max.y-p.min.y,p.max.z-p.min.z),m=d,y=new e.Vector3(p.min.x,p.min.y,p.min.z),h=new e.Vector3(p.max.x,p.min.y,p.min.z),g=new e.Vector3(p.min.x,p.max.y,p.min.z),P=new e.Vector3(p.max.x,p.max.y,p.min.z),f=new e.Vector3(p.min.x,p.min.y,p.max.z),T=new e.Vector3(p.max.x,p.min.y,p.max.z),v=new e.Vector3(p.min.x,p.max.y,p.max.z),C=new e.Vector3(p.max.x,p.max.y,p.max.z),M=new e.Vector3,D=new e.Vector3,E=new e.Vector3;u.extractBasis(M,D,E);var A,_,S=(new e.Vector3).getPositionFromMatrix(u),b=[];A=(new e.Vector3).subVectors(h.clone(),y.clone()),_=(new e.Vector3).subVectors(f.clone(),y.clone()),b.push({normal:(new e.Vector3).crossVectors(_,A).normalize(),origin:y.clone()}),A=(new e.Vector3).subVectors(g.clone(),y.clone()),_=(new e.Vector3).subVectors(h.clone(),y.clone()),b.push({normal:(new e.Vector3).crossVectors(_,A).normalize(),origin:y.clone()}),A=(new e.Vector3).subVectors(g.clone(),y.clone()),_=(new e.Vector3).subVectors(f.clone(),y.clone()),b.push({normal:(new e.Vector3).crossVectors(_,A).normalize(),origin:y.clone()}),A=(new e.Vector3).subVectors(v.clone(),C.clone()),_=(new e.Vector3).subVectors(P.clone(),C.clone()),b.push({normal:(new e.Vector3).crossVectors(_,A).normalize(),origin:C.clone()}),A=(new e.Vector3).subVectors(T.clone(),C.clone()),_=(new e.Vector3).subVectors(P.clone(),C.clone()),b.push({normal:(new e.Vector3).crossVectors(_,A).normalize(),origin:C.clone()}),A=(new e.Vector3).subVectors(T.clone(),C.clone()),_=(new e.Vector3).subVectors(v.clone(),C.clone()),b.push({normal:(new e.Vector3).crossVectors(_,A).normalize(),origin:C.clone()});let N=S.clone();var I,w,R,x,V,L,G=M.normalize(),O=D.normalize(),B=E.normalize(),U=[],q=[],z=[],F=[],k=[];b.forEach((function(n){(R=i.computeLinePlaneDistance(N.toArray(),G.toArray(),n.origin.toArray(),n.normal.toArray()))&&R.aPosition&&R.aPosition.length>2&&(V=new e.Vector3(R.aPosition[0],R.aPosition[1],R.aPosition[2]),R.relationship===t.Relationship.INTERSECTING&&(p.containsPoint(V)||p.distanceToPoint(V)<.001||l)&&(x=N.distanceTo(V),z.push(V),q.push(x),(void 0===w||w<x)&&(w=x))),s&&(R=i.computeLinePlaneDistance(N.toArray(),B.toArray(),n.origin.toArray(),n.normal.toArray()))&&R.aPosition&&R.aPosition.length>2&&(V=new e.Vector3(R.aPosition[0],R.aPosition[1],R.aPosition[2]),R.relationship===t.Relationship.INTERSECTING&&(p.containsPoint(V)||p.distanceToPoint(V)<.001)&&(x=N.distanceTo(V),z.push(V),k.push(x),(void 0===L||L<x)&&(L=x))),(R=i.computeLinePlaneDistance(N.toArray(),O.toArray(),n.origin.toArray(),n.normal.toArray()))&&R.aPosition&&R.aPosition.length>2&&(V=new e.Vector3(R.aPosition[0],R.aPosition[1],R.aPosition[2]),R.relationship===t.Relationship.INTERSECTING&&(p.containsPoint(V)||p.distanceToPoint(V)<.001||l)&&(x=N.distanceTo(V),F.push(V),U.push(x),(void 0===I||I<x)&&(I=x)))}));var H,W,Y,X,j=S.clone();a&&(q&&2===q.length&&q[0]!==q[1]&&(w=(q[0]+q[1])/2,Y=(H=z[0].clone().add(z[1].clone()).multiplyScalar(.5)).clone().sub(S),j=H),U&&2===U.length&&U[0]!==U[1]&&(I=(U[0]+U[1])/2,X=(W=F[0].clone().add(F[1].clone()).multiplyScalar(.5)).clone().sub(S),j=W),X&&Y&&(j=X.add(Y).add(S.clone())));return I&&(m=2*I),w&&(d=2*w),c.fPlaneSizeV=m,c.fPlaneSizeU=d,isNaN(L)||(c.fSliceOffset=L),r.areEqual(j,S,"Vector3")||(u.setPosition(j),c.plane=u),c},sectionPosMap:{SingleSel:{getPos:function(n){return function(n){var r,s,d,h,g,P=n.info,f=n.measurable,T=n.selectedObject,v=n.viewer,C=T.pathElement,M=!0;if(C){var D=function(t){if(T&&T.event){var i=T.event.currentPosition?T.event.currentPosition:T.event.from?T.event.from[0].currentPosition:new e.Vector2(0,0);return(u=i?t.getMousePosition(i):void 0)?t.pick(u,"primHybrid",!0):void 0}};if(function(){var n,r=o.isOOCTileSetNodeInPath(C),a=C.getLastElement().sgNode;if(a||r)switch((g=f||y({pathElement:C,position:T.position,normal:T.normal,isOOCTileSetNodeInPath:r,primitive:a})).getType()){case t.GeometryType.POINT:M=!1,s=g.getSelPoint(),P&&P.sight&&(d=P.sight.clone().negate().normalize());break;case t.GeometryType.LINE:M=!1;var u=g.getPoints();(l=new e.Vector3).subVectors(u.beginPoint,u.endPoint).normalize(),d=m(P.sight,l),s=g.getSelPoint();break;case t.GeometryType.CURVE:var p;M=!1,s=g.getSelPoint(),p=T&&!T.tangent?(h=D(v))&&h.tangent?h.tangent.clone().transformDirection(g.getMatrix()).normalize():P.sight():T.tangent.clone().normalize(),d=m(P.sight,p);break;case t.GeometryType.CIRCLE:M=!1;var E=g.getAxis();s=g.getSelPoint();var A=(new e.Vector3).subVectors(s,g.getCenter()).normalize();E=E.cross(A).normalize(),d=m(P.sight,E);break;case t.GeometryType.SPHERE:P&&P.sight&&(d=P.sight.clone().negate().normalize()),s=g.getCenter();break;case t.GeometryType.SURFACE:var _=g.getSelNormal().clone().normalize();_||(_=(h=D(v))&&h.normal?h.normal.clone().transformDirection(g.getMatrix()).normalize():g.getNormal().clone().normalize()),d=_?m(P.sight,_):P.sight.clone().negate().normalize(),n=g.getSelPoint(),s=n||(T.position?T.position:g.getCoG());break;case t.GeometryType.PLANE:(c=g.getPlane())&&(d=c.normal?m(P.sight,c.normal.clone().normalize()):P.sight.clone().negate().normalize(),n=g.getSelPoint(),s=n||(T.position?T.position:c.origin));break;case t.GeometryType.CYLINDER:case t.GeometryType.CONE:!function(){var t=g.getPoints();n=g.getSelPoint();var o=g.getAxis().clone().toArray();if(!(d=g.getSelNormal()))if((h=D(v))&&h.normal)d=h.normal.clone().transformDirection(g.getMatrix()).normalize();else{var r=i.computePointLineDistance(n.clone().toArray(),t.beginPoint.clone().toArray(),o),a=new e.Vector3(r.aPosition[0],r.aPosition[1],r.aPosition[2]);d=a.clone().sub(n).normalize().negate()}var l=n.clone().toArray(),c=t.beginPoint.toArray(),u=d.toArray(),p=i.computeTwoLinesDistance(l,u,c,o).aPosition2;s=new e.Vector3(p[0],p[1],p[2])}();break;default:d=void 0,s=void 0}}(),d||s){if(c=(new e.Plane).setFromNormalAndCoplanarPoint(d.clone(),s.clone()),u=s,M&&n.boxCenterCB){var E=n.boxCenterCB();if(E){var A=c.projectPoint(E);n.isInBox(A)&&(u=A)}}r=p(d,u)}else{var _=C,S=o.isPathToAxisSystem(C);if(S){var b,N,I;C&&C.getWorldMatrix?b=C.getWorldMatrix():(b=(new e.Matrix4).makeBasis(new e.Vector3(1,0,0),new e.Vector3(0,1,0),new e.Vector3(0,0,1))).setPosition(new e.Vector3(0,0,0));var w=C.externalPath[S+1];if(Boolean(w)&&Boolean(w.getMatrixWorld())){for(var R=new a,x=0;x<=S+1;x++)R.addElement(_.externalPath[x]);var V=R.getWorldMatrix();V&&(b=V)}var L=b.clone(),G=new e.Vector3,O=new e.Vector3,B=new e.Vector3;L.extractBasis(G,O,B),s=(new e.Vector3).getPositionFromMatrix(L),(d=o.findClosestLocalAxis(P.sight,G,O,B))&&(d.equals(G.clone())||d.equals(G.clone().negate())?(N=O,I=B):d.equals(O.clone())||d.equals(O.clone().negate())?(N=G,I=B):(d.equals(B.clone())||d.equals(B.clone().negate()))&&(N=O,I=G)),d.negate(),d.normalize(),N&&I&&d&&s&&(r=(new e.Matrix4).makeBasis(N,I,d)).setPosition(s)}}return n.retriveMeasureble?{plane:r,measurable:g}:r}}(n)}},PointLine:{getPos:function(e){if(e.measurables&&!(e.measurables.length<2)){var i=e.measurables[0],n=e.measurables[1],o=i.getType()===t.GeometryType.SPHERE?i.getCenter():i.getSelPoint(),r=n.getPoints(),a=r.beginPoint,s=r.endPoint,c=e.info;l=n.getAxis();var u=h(o,a,s,c,e.boxCenterCB(),e.isInBox);return u&&u.planeDef&&u.planeDef.setPosition&&u.planeDef.setPosition(o),u}}},PointAxis:{getPos:function(e){if(e.measurables&&!(e.measurables.length<2)){var i,n,o=e.measurables[0],r=e.measurables[1],a=o.getType(),s=r.getType(),c=e.info,u=a===t.GeometryType.SPHERE?o.getCenter():o.getSelPoint();if(l=r.getAxis(),s===t.GeometryType.CYLINDER||s===t.GeometryType.CONE){var p=r.getPoints();i=p.beginPoint,n=p.endPoint}else i=r.getCenter(),n=l.clone().multiplyScalar(r.getRadius()).add(i);var d=h(u,i,n,c,e.boxCenterCB(),e.isInBox);return d&&d.planeDef&&d.planeDef.setPosition&&d.planeDef.setPosition(u),d}}},PointNormal:{getPos:function(e){if(e.measurables&&!(e.measurables.length<2)){var i=e.measurables[0],n=e.measurables[1],o=i.getType()===t.GeometryType.SPHERE?i.getCenter():i.getSelPoint();n.getSelPoint=function(){return o.clone()};var r=P(n,e.info,e.boxCenterCB(),e.isInBox);return r&&r.planeDef&&r.planeDef.setPosition&&r.planeDef.setPosition(o),r}}},LineLine:{getPos:function(e){if(e.measurables&&!(e.measurables.length<2)){var t=e.measurables[0],i=e.measurables[1],n=e.info,o=t.getAxis(),r=t.getPoints(),a=i.getAxis(),s=i.getPoints().beginPoint,l=g(r,o,s,a,n,e.boxCenterCB(),e.isInBox);return l&&l.planeDef&&l.planeDef.setPosition&&l.planeDef.setPosition(t.getSelPoint()),l}}},LinePoint:{getPos:function(i){if(i.measurables&&!(i.measurables.length<2)){var n=i.measurables[0],o=i.measurables[1],r=o.getType()===t.GeometryType.SPHERE?o.getCenter():o.getSelPoint(),a=n.getPoints(),s=a.beginPoint,c=a.endPoint,u=i.info;(l=new e.Vector3).subVectors(s.clone(),c.clone()).normalize();var p=h(r,s,c,u,i.boxCenterCB(),i.isInBox);return p&&p.planeDef&&p.planeDef.setPosition&&p.planeDef.setPosition(n.getSelPoint()),p}}},LineAxis:{getPos:function(e){if(e.measurables&&!(e.measurables.length<2)){var i,n=e.measurables[0],o=e.measurables[1],r=o.getType(),a=e.info,s=n.getAxis(),l=n.getPoints(),c=o.getAxis();i=r===t.GeometryType.CYLINDER||r===t.GeometryType.CONE?o.getPoints().beginPoint:o.getCenter();var u=g(l,s,i,c,a,e.boxCenterCB(),e.isInBox);return u&&u.planeDef&&u.planeDef.setPosition&&u.planeDef.setPosition(n.getSelPoint()),u}}},AxisPoint:{getPos:function(e){if(e.measurables&&!(e.measurables.length<2)){var i,n,o=e.measurables[0],r=e.measurables[1],a=r.getType(),s=o.getType(),c=e.info,u=!1,p=a===t.GeometryType.SPHERE?r.getCenter():r.getSelPoint();if(l=o.getAxis(),s===t.GeometryType.CYLINDER||s===t.GeometryType.CONE){var m=o.getPoints();i=m.beginPoint,n=m.endPoint}else u=!0,i=o.getCenter(),n=l.clone().multiplyScalar(o.getRadius()).add(i);var y=h(p,i,n,c,e.boxCenterCB(),e.isInBox);if(y&&y.planeDef&&y.planeDef.setPosition){var g=u?o.getCenter().clone():d(y.planeDef,o);g&&y.planeDef.setPosition(g)}return y}}},AxisLine:{getPos:function(e){if(e.measurables&&!(e.measurables.length<2)){var i,n=e.measurables[1],o=e.measurables[0],r=o.getType(),a=e.info,s=n.getAxis(),l=n.getPoints(),c=o.getAxis(),u=!1;r===t.GeometryType.CYLINDER||r===t.GeometryType.CONE?i=o.getPoints().beginPoint:(u=!0,i=o.getCenter());var p=g(l,s,i,c,a,e.boxCenterCB(),e.isInBox);if(p&&p.planeDef&&p.planeDef.setPosition){var m=u?o.getCenter().clone():d(p.planeDef,o);m&&p.planeDef.setPosition(m)}return p}}},AxisNormal:{getPos:function(e){if(e.objectAction&&e.measurables&&!(e.measurables.length<2)){var i=e.measurables[1],n=e.measurables[0],o=!1;n.getType()===t.GeometryType.CIRCLE&&(o=!0);var r=P(i,e.info,e.boxCenterCB(),e.isInBox);if(r&&r.planeDef&&r.planeDef.setPosition){var a=o?n.getCenter().clone():d(r.planeDef,n);a&&r.planeDef.setPosition(a)}return r}}},AxisAxis:{getPos:function(e){if(e.measurables&&!(e.measurables.length<2)){var i,n,o=e.measurables[0],r=e.measurables[1],a=o.getType(),s=r.getType(),l=e.info,c=o.getAxis(),u=r.getAxis(),p=!1;a===t.GeometryType.CYLINDER||a===t.GeometryType.CONE?i=o.getPoints():(p=!0,(i=[]).beginPoint=o.getCenter(),i.endPoint=c.clone().multiplyScalar(o.getRadius()).add(i.beginPoint.clone())),n=s===t.GeometryType.CYLINDER||s===t.GeometryType.CONE?r.getPoints().beginPoint:r.getCenter();var m=g(i,c,n,u,l,e.boxCenterCB(),e.isInBox);if(m&&m.planeDef&&m.planeDef.setPosition){var y=p?o.getCenter().clone():d(m.planeDef,o);y&&m.planeDef.setPosition(y)}return m}}},NormalPoint:{getPos:function(e){if(e.measurables&&!(e.measurables.length<2)){var i=e.measurables[0],n=e.measurables[1],o=n.getType()===t.GeometryType.SPHERE?n.getCenter():n.getSelPoint();i.getSelPoint=function(){return o.clone()};var r=P(i,e.info,e.boxCenterCB(),e.isInBox);return r&&r.planeDef&&r.planeDef.setPosition&&r.planeDef.setPosition(i.getSelPoint()),r}}},NormalLine:{getPos:function(e){if(e.objectAction&&e.measurables&&e.measurables.length){var t=e.measurables[0],i=P(t,e.info,e.boxCenterCB(),e.isInBox);return i&&i.planeDef&&i.planeDef.setPosition&&i.planeDef.setPosition(t.getSelPoint()),i}}},LineNormal:{getPos:function(e){if(e.objectAction&&e.measurables&&!(e.measurables.length<2)){var t=e.measurables[1],i=e.measurables[0],n=P(t,e.info,e.boxCenterCB(),e.isInBox);return n&&n.planeDef&&n.planeDef.setPosition&&n.planeDef.setPosition(i.getSelPoint()),n}}},NormalAxis:{getPos:function(e){if(e.objectAction&&e.measurables&&e.measurables.length){var t=e.measurables[0],i=P(t,e.info,e.boxCenterCB(),e.isInBox);return i&&i.planeDef&&i.planeDef.setPosition&&i.planeDef.setPosition(t.getSelPoint()),i}}},Normal:{getPos2:function(e){if(e.objectAction&&e.measurable){var t=e.measurable,i=P(t,e.info,e.boxCenterCB(),e.isInBox);return i&&i.planeDef&&i.planeDef.setPosition&&i.planeDef.setPosition(t.getSelPoint()),i}}},PointPointPoint:{getPos:function(e){if(e.measurables&&!(e.measurables.length<3)){var i=e.measurables[0],n=e.measurables[1],o=e.measurables[2],r=i.getType(),a=n.getType(),s=o.getType(),l=e.info,c=r===t.GeometryType.SPHERE?i.getCenter():i.getSelPoint(),u=a===t.GeometryType.SPHERE?n.getCenter():n.getSelPoint(),p=s===t.GeometryType.SPHERE?o.getCenter():o.getSelPoint(),d=h(c,u,p,l,e.boxCenterCB(),e.isInBox);return d&&d.planeDef&&d.planeDef.setPosition&&d.planeDef.setPosition(c),d}}},PointPointLine:{getPos:function(i){if(i.measurables&&!(i.measurables.length<3)){var n,o=i.measurables[0],a=i.measurables[1],s=i.measurables[2],l=o.getType(),c=a.getType(),u=l===t.GeometryType.SPHERE?o.getCenter():o.getSelPoint(),p=c===t.GeometryType.SPHERE?a.getCenter():a.getSelPoint(),d=i.info,m=s.getPoints();if(r.areEqual(u,p,"Vector3"))n=h(u,m.beginPoint.clone(),m.endPoint.clone(),d,i.boxCenterCB(),i.isInBox);else{var y=s.getAxis(),P=new e.Vector3;P.subVectors(u.clone(),p.clone()).normalize();var f=u.clone();n=g(m,y,f,P,d,i.boxCenterCB(),i.isInBox)}return n&&n.planeDef&&n.planeDef.setPosition&&n.planeDef.setPosition(u),n}}},PointPointAxis:{getPos:function(i){if(i.measurables&&!(i.measurables.length<3)){var n,o=i.measurables[0],a=i.measurables[1],s=i.measurables[2],l=o.getType(),c=a.getType(),u=s.getType(),p=l===t.GeometryType.SPHERE?o.getCenter():o.getSelPoint(),d=c===t.GeometryType.SPHERE?a.getCenter():a.getSelPoint(),m=i.info,y=s.getAxis();u===t.GeometryType.CYLINDER||u===t.GeometryType.CONE?n=s.getPoints():((n=[]).beginPoint=s.getCenter(),n.endPoint=y.clone().multiplyScalar(s.getRadius()).add(n.beginPoint.clone()));var P=new e.Vector3;P.subVectors(p.clone(),d.clone()).normalize();var f,T=p.clone();return(f=r.areEqual(p,d,"Vector3")?h(p,n.beginPoint.clone(),n.endPoint.clone(),m,i.boxCenterCB(),i.isInBox):g(n,y,T,P,m,i.boxCenterCB(),i.isInBox))&&f.planeDef&&f.planeDef.setPosition&&f.planeDef.setPosition(p),f}}}}};return Object.freeze(f)}));