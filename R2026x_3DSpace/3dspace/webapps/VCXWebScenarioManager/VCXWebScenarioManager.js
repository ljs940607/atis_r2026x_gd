var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebScenarioManager/VCXScenarioManager",["require","exports","DS/CoreEvents/Events","UWA/Utils","DS/Visualization/ThreeJS_DS","DS/VCXWebComponents/VCXWebComponentBaseExperience","DS/VCXKeyFramer/VCXKeyFramer","DS/VCXKeyFramer/VCXScenario","DS/VCXWebVisibility/VCXIVisibility","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyMap","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyValueMap","DS/VCXWebModifiables/VCXModifiableServer"],(function(e,t,i,r,a,s,n,o,l,u,h,p,c,S){"use strict";s=__importDefault(s),n=__importDefault(n),o=__importDefault(o),l=__importDefault(l),u=__importDefault(u),h=__importDefault(h),p=__importDefault(p),c=__importDefault(c),S=__importDefault(S);class y extends s.default{getUpdatePriority(){return-10}constructor(){super(),this._keyframer=null,this._CurrentScenarioID="",this._Scenarios={},this._FPS=0,this._interFramesMax=0,this._startScenarioId="",this._startFrame=0,this._timeDelay=0,this._bIsPlaying=!1,this._bAutoKey=!1,this._bCameraAutoKey=!1,this._maxIndex=0,this._scenariosToPlay={},this._bIsBouncing=!1,this._speed=0,this._TransitionTime=0,this._WUXEventTokens={},this._privateModifiableServer=null,this._callback=null,this._parameter=null,this._autoThumbnailUpdate=!(window&&window.localStorage&&"false"===window.localStorage.getItem("VCXAutoThumbnailUpdate"))}initialize(){let e=this._experienceBase.getManager("VCXContextManager");this._keyframer?.SetContextMngr(e),this._privateModifiableServer=new S.default,this._keyframer=new n.default(this._privateModifiableServer),this._CurrentScenarioID="",this._Scenarios={},this._FPS=30,this._interFramesMax=-1,this._startScenarioId="",this._startFrame=0,this._timeDelay=0,this._bIsPlaying=!1,this._bAutoKey=!1,this._bCameraAutoKey=!1,this._maxIndex=0,this._scenariosToPlay={},this._bIsBouncing=!1,this._speed=1,this._TransitionTime=1e3,this._WUXEventTokens={}}unInitialize(){for(let e in this._WUXEventTokens)this._WUXEventTokens.hasOwnProperty(e)&&this._WUXEventTokens[e]&&(i.unsubscribe(this._WUXEventTokens[e]),delete this._WUXEventTokens[e]);this._CurrentScenarioID="",this.unInitializeScenario(),this._Scenarios={},this._FPS=30,this._startScenarioId="",this._bIsPlaying=!1,this._bAutoKey=!1,this._bCameraAutoKey=!1,this._maxIndex=0,this._scenariosToPlay={},this._keyframer?.unInitialize(),this._keyframer=null,this._privateModifiableServer&&(this._privateModifiableServer.unInitialize(),this._privateModifiableServer=null)}_getKeyFramer(){if(!this._keyframer)throw new Error("No KeyFramer");return this._keyframer}unInitializeScenario(){for(let e in this._Scenarios)this._Scenarios.hasOwnProperty(e)&&this._Scenarios[e].unInitialize()}postInitialize(){this._WUXEventTokens.VCX_VOLATILE_PERSISTENT_POST=i.subscribe({event:"VCX_VOLATILE_PERSISTENT_POST"},(e=>{let t=this.GetScenarios();for(let i in t)if(t.hasOwnProperty(i)){const r=t[i];if(r){let t=r.GetVisibility();t&&t.TransfertVisibilityFromID(e.component.getPreviousComponentID(),e.component.GetID())}}}))}SetAutoKey(e){this._bAutoKey!=e&&(this._bAutoKey=e,i.publish({event:"VCX_Timeline_AutoKey",data:this._bAutoKey}))}GetAutoKey(){return this._bAutoKey}SetCameraAutoKey(e){this._bCameraAutoKey!=e&&(this._bCameraAutoKey=e,i.publish({event:"VCX_Timeline_CameraAutoKey",data:this._bCameraAutoKey}))}GetCameraAutoKey(){return this._bCameraAutoKey}GetIsPlayingCurrentScenario(){return this._bIsPlaying}SetIsPlayingCurrentScenario(e){let t=this._Scenarios[this._CurrentScenarioID];if(t){let i=this._experienceBase.getManager("VCXVisuManager");if(e){let e=0;e=t.GetIsBounce()?t.GetIsReverse()?-t.GetCurrentFrame():2*this.GetMaxFrame(this._CurrentScenarioID)-t.GetCurrentFrame():t.GetCurrentFrame(),0===e&&t.ResetRangeCache(),i&&(i.CameraControlsViewpoint=!0),this.InitRestoreSetforPlay(),this.PlayScenario(t,e)}else i&&(i.CameraControlsViewpoint=!1),this.StopPlayingScenario(this._CurrentScenarioID);this._bIsPlaying=e}}SetIsBouncing(e){for(let t in this._scenariosToPlay)if(this._scenariosToPlay.hasOwnProperty(t)){this._scenariosToPlay[t].scenario.SetIsBouncing(e)}}PlayScenario(e,t,i,s,n,o){if(e){let l=e.GetID();l||(l=r.getUUID());let u={scenario:e,clockMesure:new a.Clock,timeDelay:0,lastRealElapsedTime:0,startFrame:t,_fpsHistory:{}};return u.clockMesure.start(),this._scenariosToPlay[l]=u,void 0!==s&&u.scenario.SetIsBounce(s),void 0!==i&&u.scenario.SetIsLoop(i),void 0!==n&&u.scenario.SetIsReverse(n),void 0!==o&&u.scenario.SetSpeed(o),u.scenario.GetIsReverse()?u.startFrame=this.GetMaxFrame(l)-t:(e.InitForPlay(this._getKeyFramer()),this.UpdateProperties2(e,u.startFrame)),l}}StopPlayingScenario(e){if(this._scenariosToPlay[e]){let t=this._scenariosToPlay[e]._fpsHistory,i=0,r=0,a=-1;for(let e in t)t.hasOwnProperty(e)&&(a=e,r+=t[e],i++);if(-1!=a&&(r-=t[a],i--,delete t[a]),i>1){r/=i,console.log("[PERFO] fpsMoyenne "+r);let e=0;for(let i in t)t.hasOwnProperty(i)&&(e+=(t[i]-r)*(t[i]-r));e=Math.sqrt(e/(i-1)),console.log("[PERFO] fpsEcartType "+e)}delete this._scenariosToPlay[e]}let t=this._Scenarios[e];void 0!==t&&t.ClearVolatileKeys()}GetScenarios(){return this._Scenarios}GetScenariosFromType(e){let t={};for(let i in this._Scenarios)if(this._Scenarios.hasOwnProperty(i)){let r=this._Scenarios[i];r.GetScenarioType()===e&&(t[i]=r)}return t}SetDefaultInterpolator(e,t){this._getKeyFramer().SetDefaultInterpolator(e,t)}GetDefaultInterpolator(e){return this._getKeyFramer().GetDefaultInterpolator(e)}SetStartingScenarioId(e){this._startScenarioId=e}GetStartingScenarioId(){return this._startScenarioId}GetFPS(){return this._FPS}SetFPS(e){this._FPS=e}SetInterFramesMax(e){this._interFramesMax=e}GetInterFramesMax(){return this._interFramesMax}SetTransitionTime(e){this._TransitionTime=e}GetTransitionTime(){return this._TransitionTime}SetCurrentFrame(e){let t=this._Scenarios[this._CurrentScenarioID];t&&t.SetCurrentFrame(e)}GetCurrentFrame(){let e=this._Scenarios[this._CurrentScenarioID];return e?e.GetCurrentFrame():0}GetCurrentTime(){let e=this._Scenarios[this._CurrentScenarioID];if(e){return e.GetCurrentFrame()/this.GetFPS()}return 0}AddScenario(e,t){t.SetID(e),this.AddScenario2(t)}AddScenario2(e){let t=e.GetID();t||(this._experienceBase.ComponentsMap.AddComponent(e),t=e.GetID());let i=e.GetPersistency();this._Scenarios[t]||0===i&&this._maxIndex++,this._Scenarios[t]=e;let r=e.QueryInterface("VCXIModifiable");r&&this.ModifiableServer?.AddModifiable(r)}RemoveScenario(e){this._CurrentScenarioID===e&&(this._CurrentScenarioID=""),delete this._Scenarios[e]}_deleteScenario(e){if(e){this._experienceBase.getManager("VCXDocManager").RemoveDocument(e.GetDocId());const t=e.GetPIPDocId();t&&this._experienceBase.getManager("VCXDocManager").RemoveDocument(t.docID)}return e.CallDispose()}async DeleteScenarios(e){if(e&&e.length)for(let t=0;t<e.length;t++){const i=e[t];this.RemoveScenario(i.GetID()),await this._deleteScenario(i)}}SetCurrentScenario(e){this._Scenarios[e]&&(this._CurrentScenarioID=e)}GetCurrentScenario(){return this._CurrentScenarioID}AddObjectAnimation(e,t,i){this.ModifiableServer?.AddModifiable(e);let r=e.GetHashing();t.AddObjectAnimation(r,i)}RemoveObjectAnimation(e,t){t.RemoveObjectAnimation(e)}AddNeutrals(e,t){this._getKeyFramer().AddNeutrals(e,t)}RemoveNeutrals(e){this._getKeyFramer().RemoveNeutrals(e)}GetNeutrals(e){return this._getKeyFramer().GetNeutrals(e)}RestoreNeutralPropertiesOneModifiable(e){this._getKeyFramer().RestoreNeutralPropertiesOneModifiable(e)}RestoreNeutralProperties(){this._getKeyFramer().RestoreNeutralProperties(null)}AddPropertyToRestoreSet(e,t){this._bIsPlaying||this._getKeyFramer().AddPropertyToRestoreSet(e,t)}RemoveModifiableFromRestoreSet(e){let t=this.ModifiableServer?.GetModifiableFromHashing(e);t&&this._getKeyFramer().EmptyRestoreSetOneModifiable(t)}InitRestoreSetFromNeutrals(e){this._getKeyFramer().InitRestoreSetFromNeutrals(e)}InitRestoreSetforPlay(){let e=this._Scenarios[this._CurrentScenarioID];e&&e.InitRestoreSetforPlay(this._getKeyFramer())}GetNewFrame(e){let t=e.clockMesure.getElapsedTime(),i=t-e.lastRealElapsedTime;e.lastRealElapsedTime=t;let r=0;if(!("true"==this._experienceBase.getManager("VCXContextManager").odtPerfo)&&-1!=this._interFramesMax){let t=this._interFramesMax/(this.GetFPS()*e.scenario.GetSpeed());i>t&&(r=i-t,e.timeDelay+=r)}let a=e.clockMesure.getElapsedTime()-e.timeDelay,s=e.startFrame+a*this.GetFPS()*(e.scenario.GetSpeed()?e.scenario.GetSpeed():1),n=Math.floor(t);return void 0===e._fpsHistory[n]?e._fpsHistory[n]=1:e._fpsHistory[n]++,s}update(e){for(let e in this._scenariosToPlay)if(this._scenariosToPlay.hasOwnProperty(e)){let t=this._scenariosToPlay[e],r=this.GetNewFrame(t),a=t.scenario,s=a.GetMaxFrame(),n=a.GetSequenceMaxFrame();null!==n&&(s=n),a.GetIsLoop()?(a.GetIsBounce()&&a.GetIsReverse()&&t.startFrame>=s&&!a.GetIsBouncing()&&(r-=s),r>=s&&(a.GetIsBounce()?a.GetIsBouncing()?(s-r%s>a.GetPreviousFrame()?(r%=s,a.SetIsBouncing(!1)):r=s-r%s,i.publish({event:"VCX_SCENARIO_PLAY_LOOP_START_REACHED",data:e})):(r%s<a.GetPreviousFrame()?(r=s-r%s,a.SetIsBouncing(!0)):r%=s,i.publish({event:"VCX_SCENARIO_PLAY_LOOP_END_REACHED",data:e})):(r%=s,i.publish({event:"VCX_SCENARIO_PLAY_LOOP_END_REACHED",data:e}),i.publish({event:"VCX_SCENARIO_PLAY_LOOP_START_REACHED",data:e}))),a.SetPreviousFrame(r),a.GetIsReverse()&&(r=s-r%s),a.SetCurrentFrame(r),this.UpdateProperties2(a,r)):a.GetIsBounce()?(a.GetIsReverse()&&t.startFrame>=s&&!a.GetIsBouncing()&&(r-=s),r>=s?r>2*s-this._startFrame?(a.GetIsReverse()?(a.SetCurrentFrame(s),this.UpdateProperties2(a,s),a.SetIsBouncing(!1)):(a.SetCurrentFrame(0),this.UpdateProperties2(a,0),a.SetIsBouncing(!1)),this.StopPlayingScenario(e),a.SetIsBouncing(!1),a.SetSequenceMaxFrame(null),a.SetPreviousFrame(0),e===this._CurrentScenarioID&&(this._bIsPlaying=!1,i.publish({event:"VCX_SCENARIO_END_REACHED"}),this._callback&&(this._callback(this._parameter),this._callback=null,this._parameter=null)),i.publish({event:"VCX_SCENARIO_PLAY_END_REACHED",data:e})):(r=s-r%s,a.SetIsBouncing(!0),a.GetIsReverse()&&(r=s-r%s),a.SetCurrentFrame(r),this.UpdateProperties2(a,r)):(a.GetIsReverse()&&(r=s-r%s),a.SetCurrentFrame(r),this.UpdateProperties2(a,r))):a.GetIsReverse()&&t.startFrame>=s&&r>=2*s||a.GetIsReverse()&&t.startFrame<s&&r>=s||!a.GetIsReverse()&&r>=s?(a.GetIsReverse()?(a.SetCurrentFrame(0),this.UpdateProperties2(a,0)):(a.SetCurrentFrame(s),this.UpdateProperties2(a,s)),this.StopPlayingScenario(e),a.SetIsBouncing(!1),a.SetSequenceMaxFrame(null),a.SetPreviousFrame(0),e===this._CurrentScenarioID&&(this._bIsPlaying=!1,i.publish({event:"VCX_SCENARIO_END_REACHED"}),this._callback&&(this._callback(this._parameter),this._callback=null,this._parameter=null)),i.publish({event:"VCX_SCENARIO_PLAY_END_REACHED",data:e})):(a.GetIsReverse()&&(r=s-r%s),a.SetCurrentFrame(r),this.UpdateProperties2(a,r))}}SetCallback(e,t){this._callback=e,this._parameter=t}UpdateProperties2(e,t){this._getKeyFramer().UpdateProperties(e,t)}UpdateProperties(e,t){let i=this._Scenarios[this._CurrentScenarioID];i&&this._getKeyFramer().UpdateProperties(i,this.GetCurrentFrame(),e,t)}UpdateProperty(e,t){let i=this._Scenarios[this._CurrentScenarioID];i&&this._getKeyFramer().UpdateProperty(i,this.GetCurrentFrame(),e,t)}ApplyScenarioVisibility(e){let t=this._Scenarios[e];t&&this.ApplyVisibility(t)}ApplyVisibility(e){let t=e.GetVisibility();if(t){let r=[],a=[],s=t.GetMode(),n=this._experienceBase.ComponentsMap.GetComponentTable();for(let i in n)if(n.hasOwnProperty(i)){let o=n[i];if(o){if(!o.IsKindOf("VCXWebComponentOccurrence"))continue;let i=o.QueryInterface("VCXIVisibility");if(i){let n=null,h=t.IsVisibleWithParents(o);if(0!==s&&1!==s&&2!==s||(1===h?n=!0:0===h&&(n=!1)),null!==n)if(n)i.SetVisibility(l.default.EVisState.Visible),r.push(o);else{i.SetVisibility(l.default.EVisState.Hidden);let t=o.QueryInterface("VCXIModifiable");if(t&&!e.GetIsTransition()){let e=new u.default;e.SetValue(1),t.OnChangeProperty("Actor.Visibility.Opacity",e),t.OnChangePropertiesEnd()}a.push(o)}}}}let o=this._experienceBase.getManager("VCXDressupManager");if(o){let i=o.getDressups();for(let s in i)if(i.hasOwnProperty(s)){let n=i[s];if(n){let i=n.QueryInterface("VCXIVisibility");if(i)if(t.FindVisibleCollab(n.GetID())>=0){i.SetVisibility(l.default.EVisState.Visible);let t=n.QueryInterface("VCXIModifiable");if(t&&!e.GetIsTransition()){let e=new u.default;e.SetValue(1),t.OnChangeProperty("Actor.Visibility.Opacity",e),t.OnChangePropertiesEnd()}r.push(n)}else(e.GetApplyNeutralAtGoToScenario()||e.GetIsTransition())&&(i.SetVisibility(l.default.EVisState.Hidden),a.push(n))}}}r.length&&i.publish({event:"VCX_VISIBILITY_CHANGED",data:{components:r,visibility:l.default.EVisState.Visible}}),a.length&&i.publish({event:"VCX_VISIBILITY_CHANGED",data:{components:a,visibility:l.default.EVisState.Hidden}});let h=this._experienceBase.getManager("VCXContextManager");h&&(h.traverseGraphMustBePerformed=!0)}}CaptureDiffOfNeutrals(e,t){null===e&&(e=new h.default);for(let i of this._getKeyFramer().GetHashModifiablePresentInRestoreSet()){let r=this.ModifiableServer?.GetModifiableFromHashing(i);if(!r)continue;if(t&&!1===r.IsLiving())continue;let a=r.GetRequiredPropertiesForTransition();if(a)for(let t in a)if(a.hasOwnProperty(t)){let a=r.GetProperty(t);a&&e.AddOrModifyProperty(i,a)}let s=this.GetNeutrals(i);if(s){let t=this._getKeyFramer().GetPropertiesNamePresentInRestoreSet(i);for(let a of t){let t=s.GetProperty(a);if(t){let s=r.GetProperty(a);s&&s.GetPropertyInfo().GetBehaviorType()!==p.default.EBehaviorType.Singleton&&(s.GetPropertyValue().IsEqualTo(t.GetPropertyValue())||e.AddOrModifyProperty(i,s))}}}}}GetMaxFrame(e){let t=0,i=this._Scenarios[e];return i&&(t=i.GetMaxFrame()),t}ConsiderNewComponent(e){let t=this.GetScenarios();for(let i in t)if(t.hasOwnProperty(i)){const r=t[i];if(r){let t=r.GetVisibility();if(t){let i=t.GetMode(),a=e.QueryInterface("VCXIVisibility");if(a){let r=a.GetVisibility();0===i?r!==l.default.EVisState.Hidden?t.AddVisible(e):t.AddInvisible(e):1===i?r!==l.default.EVisState.Hidden&&t.AddVisible(e):2===i&&r===l.default.EVisState.Hidden&&t.AddInvisible(e)}r.SetVisibility(t)}r.SetBoostDirty()}}}CaptureCurrentVisibility(e){if(e){let t=e.GetVisibility();if(t){t.Empty();let i=t.GetMode(),r=this._experienceBase.ComponentsMap.GetComponentFromType("VCXWebComponentOccurrence");for(let e=0;e<r.length;e++){let a=r[e];if(a){let e=a.QueryInterface("VCXIVisibility");if(e){let r=e.GetVisibility();0===i?r!==l.default.EVisState.Hidden?t.AddVisible(a):t.AddInvisible(a):1===i?r!==l.default.EVisState.Hidden&&t.AddVisible(a):2===i&&r===l.default.EVisState.Hidden&&t.AddInvisible(a)}}}let a=[],s=this._experienceBase.getManager("VCXDressupManager");s&&(a=s.getDressups());for(let e in a)if(a.hasOwnProperty(e)){let i=a[e];if(i){let e=i.QueryInterface("VCXIVisibility");if(e){e.GetVisibility()!==l.default.EVisState.Hidden&&t.AddVisibleCollab(i)}}}e.SetVisibility(t)}}}ApplyView(e,t=!1){t||this.ApplyVisibility(e),e.GetApplyNeutralAtGoToScenario()&&this._getKeyFramer().RestoreNeutralProperties(e),this.UpdateProperties2(e,0)}CaptureCurrentView(e){let t=this._experienceBase.Factory?.BuildComponent("VCXScenario")??null;if(!t)throw new Error("Issue with factory");let i=o.default.EScenarioType.Scenario;e&&void 0!==e.scenarioType&&(i=e.scenarioType),t.SetScenarioType(i);let r=1;e&&void 0!==e.visibilityMode&&(r=e.visibilityMode),t.GetVisibility()?.SetMode(r);let a=2;e&&void 0!==e.persistency&&(a=e.persistency),t.SetPersistency(a);let s,n=!1;return e&&void 0!==e.bIsPartialView&&(n=e.bIsPartialView),n&&t.SetApplyNeutralAtGoToScenario(!1),this.CaptureCurrentVisibility(t),e&&void 0!==e.propMapDiffNeutrals&&(s=e.propMapDiffNeutrals),s||(s=new h.default),this.CaptureDiffOfNeutrals(s,!0),t.SetPropertyMapAtFrame(s,0),t}IsCurrentPropertyDifferentFromNeutral(e,t){if(!e)return!1;let i=e.GetHashing(),r=this._getKeyFramer().GetNeutrals(i);if(!r)return!1;let a=r.GetProperty(t);if(!a)return!1;let s=a.GetPropertyValue();if(!s)return!1;let n=e.GetProperty(t);return!!n&&!n.GetPropertyValue().IsEqualTo(s)}SearchAllValuesForOneProperty(e,t){const i=this._getKeyFramer().GetNeutralsHash();for(let r of i){const i=this.ModifiableServer?.GetModifiableFromHashing(r);let a=i?.GetObject();if(i&&a){if(e&&e.objects&&-1===e.objects.indexOf(i.GetObject()))continue;let a=this._getKeyFramer().GetNeutrals(r);if(a&&a.map.hasOwnProperty(e.propertyName)){let r=a.GetProperty(e.propertyName).GetPropertyValue();if(e&&null!==e.oldValue&&void 0!==e.oldValue&&r.GetValue()!==e.oldValue)continue;t&&t({type:"Neutrals",modifiable:i,propSet:a,propValue:r})}}}const r=this.GetScenarios();for(let i in r)if(r.hasOwnProperty(i)){let a=r[i],s=a.GetVisibility(),n=[];a.GetListModifiables(n);for(let i=0;i<n.length;i++){let r=n[i];const o=this.ModifiableServer?.GetModifiableFromHashing(r);let l=o?.GetObject();if(o&&l){if(e&&e.objects&&-1===e.objects.indexOf(l))continue;let i=!1;s&&s.IsVisibleWithParents(l);let n=a.GetObjectAnimation(r);if(n){let r=n.GetTrack(e.propertyName);if(r){let s=r.GetIterator(),n=s.next();for(;null!==n;){let r=n.GetValue();e&&null!==e.oldValue&&void 0!==e&&r.GetValue()!==e.oldValue?n=s.next():(t&&t({type:"Track",modifiable:o,Frame:n.GetFrame(),Scenario:a,Easing:n.GetEasing(),visible:i}),n=s.next())}}}}}}}SearchForImpactedProperty(e,t){const i=this.GetScenarios();for(let r in i)if(i.hasOwnProperty(r)){let a=i[r],s=a.GetVisibility(),n=[];a.GetListModifiables(n),n.forEach((i=>{const r=this.ModifiableServer?.GetModifiableFromHashing(i);let n=r?.GetObject();if(r&&n&&s&&s.IsVisibleWithParents(n)>0){let i=!0,s=this._getKeyFramer().GetPropertiesOneModifiableAtTimeZero(a,r);s||(i=!1);const n={scenario:a,property:s.GetProperty(e)};n.property||(i=!1),i&&t&&t(n)}}))}}SearchForVisibleComponent(e,t,i){let r=e?.GetObject();if(e&&r){const a=this.GetScenarios();for(let s in a)if(a.hasOwnProperty(s)){let n=a[s],o=n.GetVisibility();if(o&&o.IsVisibleWithParents(r)>0){let r=!0;const a={scenario:n};if(t){let i=this._getKeyFramer().GetPropertiesOneModifiableAtTimeZero(n,e);i||(r=!1),a.property=i.GetProperty(t),a.property||(r=!1)}r&&i&&i(a)}}}}ResetLinksInPropertyValuetree(e,t,i,r,a){let s=!1;if("VCXPropertyValueLink"===e.GetType()){let n=e.GetValue();!0===t[n]&&(r?console.log("LINK FOUND : "+n):a?(e.SetValue(a),console.log("LINK REPLACED : ["+n+"] by ["+a+"]")):(e.SetValue(""),console.log("LINK REMOVED : "+n)),s=!0,i[n]=!0)}else if(e instanceof c.default)for(let n=0;n<e.GetValue().length;n++){let o=e.GetValue()[n];o&&this.ResetLinksInPropertyValuetree(o,t,i,r,a)&&(s=!0)}return s}HasLinksCleaned(){return this._getKeyFramer().HasLinksCleaned()}ResetLinksTo(e,t,i,r,a){let s=this._getKeyFramer().GetNeutralsHash();for(let n of s){let s=this._getKeyFramer().GetNeutrals(n);if(s)for(let o in s.map)if(s.map.hasOwnProperty(o)){let l=s.GetProperty(o).GetPropertyValue(),u={};if(this.ResetLinksInPropertyValuetree(l,e,u,r,a)){r||this._getKeyFramer().SetLinksCleaned(!0);let e=this.ModifiableServer?.GetModifiableFromHashing(n),a=e?.GetObject();if(e&&a){let e=a.GetID();void 0===t[e]&&(t[e]={}),t[e].neutral=u;for(let t in u)u.hasOwnProperty(t)&&(void 0===i[t]&&(i[t]={}),void 0===i[t].neutral&&(i[t].neutral={}),i[t].neutral[e]=!0)}}}}let n=this.GetScenarios();for(let s in n)if(n.hasOwnProperty(s)){let o=n[s],l=[];o.GetListModifiables(l);for(let n=0;n<l.length;n++){let u=l[n],h=o.GetObjectAnimation(u);if(h){let n=[];h.GetListTrackNames(n);for(let l=0;l<n.length;l++){let p=n[l],c=h.GetTrack(p),S=c?.GetIterator(),y=S.next();for(;null!==y;){let n=y.GetValue(),l={};if(this.ResetLinksInPropertyValuetree(n,e,l,r,a)){r||o.SetBoostDirty();let e=this.ModifiableServer?.GetModifiableFromHashing(u);if(e){let r=e.GetObject().GetID();void 0===t[r]&&(t[r]={}),t[r][s]=l;for(let e in l)l.hasOwnProperty(e)&&(void 0===i[e]&&(i[e]={}),void 0===i[e][s]&&(i[e][s]={}),i[e][s][r]=!0)}}y=S.next()}}}}let u=o.GetVisibility();if(u)for(let t in e)e.hasOwnProperty(t)&&(u.TransfertVisibilityFromID(t,a,r)&&(r?console.log("LINK FOUND in visibilityMap: "+t):(a?console.log("LINK REPLACED in visible : ["+t+"] by ["+a+"]"):console.log("LINK REMOVED from visible : "+t),o.SetBoostDirty())),u.TransfertVisibilityCollabFromID(t,a,r)&&(r?console.log("LINK FOUND in visibilityMapCollab: "+t):(a?console.log("LINK REPLACED in visibilityMapCollab : ["+t+"] by ["+a+"]"):console.log("LINK REMOVED from visibilityMapCollab : "+t),o.SetBoostDirty())))}}get AutoThumbnailUpdate(){return this._autoThumbnailUpdate}set AutoThumbnailUpdate(e){this._autoThumbnailUpdate=e,window&&window.localStorage&&window.localStorage.setItem("VCXAutoThumbnailUpdate",String(this._autoThumbnailUpdate))}get ModifiableServer(){return this._privateModifiableServer}}return Object.defineProperty(y.prototype,"componentType",{enumerable:!0,get:()=>"VCXScenarioManager"}),y})),define("DS/VCXWebScenarioManager/VCXModifiableScenarioManager",["DS/VCXWebModifiables/VCXModifiable","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueInt"],(function(e,t,i,r,a,s,n){"use strict";return e.extend({init:function(){this._parent()},OnChangeProperty:function(e,t){if("ScenarioManager.InterFramesMax"===e)this.GetObject().SetInterFramesMax(t.GetValue());else if("ScenarioManager.FPS"===e)this.GetObject().SetFPS(t.GetValue());else if("ScenarioManager.TransitionTime"===e)this.GetObject().SetTransitionTime(t.GetValue());else{if("ScenarioManager.startScenarioId"!==e)return console.log("property not found!"),!1;this.GetObject().SetStartingScenarioId(t.GetValue())}return!0},GetProperty:function(e){var t=null;if("ScenarioManager.FPS"===e)(u=new a).SetValue(this.GetObject().GetFPS()),t=new i(new r(e,2),u);else if("ScenarioManager.InterFramesMax"===e){var o=new n;o.SetValue(this.GetObject().GetInterFramesMax()),t=new i(new r(e,2),o)}else if("ScenarioManager.startScenarioId"===e){var l=new s;l.SetValue(this.GetObject().GetStartingScenarioId()),t=new i(new r(e,2),l)}else if("ScenarioManager.TransitionTime"===e){var u;(u=new a).SetValue(this.GetObject().GetTransitionTime()),t=new i(new r(e,2),u)}return t},GetProperties:function(){var e=new t;return e.AddOrModifyProperty(this.GetProperty("ScenarioManager.FPS")),e.AddOrModifyProperty(this.GetProperty("ScenarioManager.InterFramesMax")),e.AddOrModifyProperty(this.GetProperty("ScenarioManager.startScenarioId")),e.AddOrModifyProperty(this.GetProperty("ScenarioManager.TransitionTime")),e}})}));