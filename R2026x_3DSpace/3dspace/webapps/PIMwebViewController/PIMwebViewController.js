/*!  Copyright 2018 Dassault Systemes. All rights reserved. */
define("DS/PIMwebViewController/PIMWebViewTools",["DS/WebPolyMaths/WebMathsBoundingGeometry","DS/WebPolyMaths/WebGeometryEnums","DS/WebPolyMaths/WebToolsMeasure","DS/WebPolyMaths/WebMathsVector3D","DS/WebPolyMaths/WebMathsFiniteGeometry","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/Visualization/PrimitiveIterator"],(function(e,t,n,i,r,a,o){"use strict";var s,l,c=1e-6,u=1024,f=200,d=4,p=.001,h=p*p,m=.001,g=function(){this.clash=[],this.contact=[],this.clearance1=[],this.clearance2=[],this.isClash=!1,this.status="OK"};function C(e){if(e&&e.mesh3js)return e;for(let t=0;t<e.children.length;++t){let n=C(e.children[t]);if(n)return n}}function I(e,t){if(e.internalPath.length)return new o(e,t);let n=C(e.getLastElement());return n?new o(n,t):void 0}function b(e,t){let n=[],r=e?e.getNbPrimitives():0;for(let a=0;a<r;++a){if("FACE"!==e.getGeomType(a)||e.getConnectivityType(a)!==o.TRIANGLES)continue;let r,s,l,c,u=e.getLength(a),f=e.getOffset(a),d=e.getIndexArray(a),p=e.getPositionArray(a),h=[],m=[];if(d&&p){if(t&&!i.isIdentity(t))for(let e=0;e<u;++e)r=3*d[f+e],h[e]=i.transformPoint([p[r],p[r+1],p[r+2]],t);else for(let e=0;e<u;++e)r=3*d[f+e],h[e]=[p[r],p[r+1],p[r+2]];m[0]=m[3]=h[0][0],m[1]=m[4]=h[0][1],m[2]=m[5]=h[0][2];for(let e=1;e<u;++e)s=h[e][0],l=h[e][1],c=h[e][2],s<m[0]?m[0]=s:s>m[3]&&(m[3]=s),l<m[1]?m[1]=l:l>m[4]&&(m[4]=l),c<m[2]?m[2]=c:c>m[5]&&(m[5]=c);n.push({vertices:h,aabb:m})}else window.console.log("No info for primitive index: "+a)}return n}function y(e,t){for(var n,r=0,a=t.length;r<a;++r)if(n=t[r],i.areEqual(e,n.item||n))return!0;return!1}function P(e,n){for(var i,r=0,a=n.length;r<a;++r)if((i=n[r]).type===t.GeometryType.LINE&&y(i.item[0],e.item)&&y(i.item[1],e.item))return!0;return!1}function v(e,n){for(var r,a,o,s,l,u,f,d,p,h,m=[],g=0,C=e.length;g<C;++g)r=e[g],a=r,o=n,s=void 0,l=void 0,u=void 0,f=void 0,d=void 0,p=void 0,h=void 0,s=i.sub(o[2],o[0]),l=i.sub(o[1],o[0]),u=i.sub(a,o[0]),f=[i.dot(s,s),i.dot(s,l),i.dot(s,u),i.dot(l,l),i.dot(l,u)],h=(f[0]*f[4]-f[1]*f[2])*(d=1/(f[0]*f[3]-f[1]*f[1])),(p=(f[3]*f[2]-f[1]*f[4])*d)>=0&&h>=0&&p+h<=1+c&&m.push({type:t.GeometryType.POINT,item:r});return m}function S(e,t){let n=i.sub(e,t[0]),r=i.sub(e,t[1]),a=i.squaredLength(n),o=i.squaredLength(r);return a<c||o<c||!(i.squaredLength(i.cross(n,r))>a*o*m)&&i.dot(n,r)<0}function D(e,n,r){var a,o={},s=i.sub(e[1],e[0]),l=i.dot(r,s);return 0!==l?(a=(i.dot(r,n)-i.dot(r,e[0]))/l,Math.abs(a)>=0&&Math.abs(a)<=1&&(o={type:t.GeometryType.POINT,item:i.multiplyAndAdd(s,a,e[0])})):o={type:t.GeometryType.LINE,item:e},o}function w(e,n,r){var a=[],o=[];if(S(e[0],n)&&S(e[1],n))a.push({type:t.GeometryType.LINE,item:e});else if(S(n[0],e)&&S(n[1],e))a.push({type:t.GeometryType.LINE,item:n});else if(S(e[0],n)?o.push(e[0]):S(e[1],n)&&o.push(e[1]),S(n[0],e)?o.push(n[0]):S(n[1],e)&&o.push(n[1]),2===o.length)i.areEqual(o[0],o[1])?a.push({type:t.GeometryType.POINT,item:o[0]}):a.push({type:t.GeometryType.LINE,item:o});else if(1===o.length)r&&a.push({type:t.GeometryType.POINT,item:o[0]});else{var s=i.sub(e[1],e[0]),l=i.sub(n[1],n[0]),c=i.sub(n[0],e[0]),u=i.dot(s,s),f=i.dot(s,l),d=i.dot(l,l),p=i.dot(s,c),h=i.dot(l,c),m=u*d-f*f;if(0===m);else{var g=(f*h-d*p)/m,C=(u*h-f*p)/m;if(Math.abs(g)>=0&&Math.abs(g)<=1&&Math.abs(C)>=0&&Math.abs(C)<=1){var I=i.multiplyAndAdd(s,g,e[0]),b=i.multiplyAndAdd(l,C,n[0]);i.areEqual(I,b)&&S(I,e)&&S(I,n)&&a.push({type:t.GeometryType.POINT,item:I})}}}return a}function x(e,t){var n=[];return Array.prototype.push.apply(n,w([e[0],e[1]],t)),Array.prototype.push.apply(n,w([e[0],e[2]],t)),Array.prototype.push.apply(n,w([e[1],e[2]],t)),n}function M(e,n){var r=new g;return e.type===t.GeometryType.LINE&&e.type===n.type?r.clash=w(e.item,n.item):e.type===t.GeometryType.LINE&&n.type===t.GeometryType.SURFACE?r.clash=x(n.item,e.item):e.type===t.GeometryType.SURFACE&&n.type===t.GeometryType.LINE?r.clash=x(e.item,n.item):e.type===t.GeometryType.SURFACE&&n.type===t.GeometryType.SURFACE?r.clash=function(e,n){var r,a=[],o=v(e,n);if(3===o.length)return[{type:t.GeometryType.SURFACE,item:e}];var s=v(n,e);if(3===s.length)return[{type:t.GeometryType.SURFACE,item:n}];s.forEach((function(e){y(e.item,o)||o.push(e)}));for(var l=[],c=[],u=[[e[0],e[1]],[e[1],e[2]],[e[2],e[0]]],f=[[n[0],n[1]],[n[1],n[2]],[n[2],n[0]]],d=function(e){if(!i.areEqual(e,s.item)&&y(e,o)){var n={type:t.GeometryType.LINE,item:[e,s.item]};P(n,a)||a.push(n)}},p=0;p<u.length;p++){c=[];for(var h=0;h<f.length;h++)0!==(s=w(u[p],f[h],!0)).length&&((s=s[0]).type===t.GeometryType.LINE?(c=[s],l.push({type:t.GeometryType.POINT,item:s.item[0]}),l.push({type:t.GeometryType.POINT,item:s.item[1]}),P(c[0],a)||a.push(c[0]),h=f.length):y(s.item,l)||(l.push(s),c.push(s),0!==o.length&&([u[p][0],f[h][0]].forEach(d),[u[p][1],f[h][1]].forEach(d))),2===c.length&&(r=[c[0].item,c[1].item],i.subAndSquaredLength(u[p][0],c[1].item)<i.subAndSquaredLength(u[p][0],c[0].item)&&(r=[c[1].item,c[0].item]),P((c=[{type:t.GeometryType.LINE,item:r}])[0],a)||a.push(c[0]),h=f.length))}2===o.length?P(r={type:t.GeometryType.LINE,item:[o[0].item,o[1].item]},a)||a.push(r):1===o.length&&0===a.length&&(a=[{type:t.GeometryType.POINT,item:o[0]}]);var m,g=[];if(l=[],a.length>1){var C,I=a.splice(0,1)[0];for(l.push(I.item[0],I.item[1]),m=I.item[1];!i.areEqual(l[0],m);){for(C=null,p=0;p<a.length&&!C;p++)i.areEqual(a[p].item[0],m)?C=a.splice(p,1)[0].item[1]:i.areEqual(a[p].item[1],m)&&(C=a.splice(p,1)[0].item[0]);C||(C=0!==a.length?a[0].item[0]:l[0]),m=C,l.push(m)}l.length>=3&&(g=[{type:t.GeometryType.SURFACE,item:l}])}else g=a;return g}(e.item,n.item):e.type===t.GeometryType.LINE&&n.type===t.GeometryType.POINT?S(n.item[0],e.item)&&(r.clash=[n]):e.type===t.GeometryType.POINT&&n.type===t.GeometryType.LINE&&S(e.item[0],n.item)&&(r.clash=[e]),r}function A(e,n,r,a,o){var s,l,c,u=[],f=[],d=[],h=[e,n,r];return c=i.dot(o,a),h.forEach((function(e){(l=i.dot(o,e)-c)>p?u.push(e):l<-p?f.push(e):d.push(e)})),3===d.length?s={type:t.GeometryType.SURFACE,item:[e,n,r],overThePlane:3}:2===d.length?s={type:t.GeometryType.LINE,item:d,overThePlane:2}:1===d.length&&1===u.length&&1===f.length?s={type:t.GeometryType.LINE,item:[d[0],D([u[0],f[0]],a,o).item],overThePlane:1}:1!==d.length||2!==u.length&&2!==f.length?1===u.length&&2===f.length?s={type:t.GeometryType.LINE,item:[D([u[0],f[0]],a,o).item,D([u[0],f[1]],a,o).item]}:2===u.length&&1===f.length&&(s={type:t.GeometryType.LINE,item:[D([f[0],u[0]],a,o).item,D([f[0],u[1]],a,o).item]}):s={type:t.GeometryType.POINT,item:[d[0]],overThePlane:1},s}function T(e,t){let n,i=[];for(n=0;n<3;n++)i[n]=e[n]>t[n]?e[n]:t[n];for(n=3;n<6;n++)i[n]=e[n]<t[n]?e[n]:t[n];return i}function O(e){let t;for(t=0;t<3;t++)if(e[t]>e[t+3])return 0;return 1}function L(e,t){if(1==(i=t,(n=e)[0]>=i[0]&&n[1]>=i[1]&&n[2]>=i[2]&&n[3]<=i[3]&&n[4]<=i[4]&&n[5]<=i[5]?1:0))return 2;var n,i;return O(T(e,t))}function E(e,t){let n=t.front;return n<3?e[n+3]<t[n]?0:e[n]>t[n]?2:1:e[n-3]>t[n]?0:e[n]<t[n]?2:1}function R(e,n,r,a,o,c,p,h){let m,C,I,b,y,P,v,S,D,w=new g,x=[];if(p+="  ",a.length*o.length<f||a.length<=d||o.length<=d||e.depth>=u)for(y=0;y<a.length&&"OK"===w.status;y++)for(S=a[y].index,I=i.cross(i.sub(n[S].vertices[1],n[S].vertices[0]),i.sub(n[S].vertices[2],n[S].vertices[0])),P=0;P<o.length&&"OK"===w.status;P++){if(++s>1e6&&(s=0,performance.now()-l>c)){w.status="maxTime";break}D=o[P].index,a[y].borderProp>0&&a[y].borderProp&o[P].borderProp||(b=i.cross(i.sub(r[D].vertices[1],r[D].vertices[0]),i.sub(r[D].vertices[2],r[D].vertices[0])),m=A(n[S].vertices[0],n[S].vertices[1],n[S].vertices[2],r[D].vertices[0],b),C=A(r[D].vertices[0],r[D].vertices[1],r[D].vertices[2],n[S].vertices[0],I),m&&C&&(v=M(m,C),v&&v.clash.length&&(("Contact"===h||m.overThePlane>1||C.overThePlane>1||1===v.clash.length&&v.clash[0].type===t.GeometryType.POINT)&&(v.contact=[{type:t.GeometryType.SURFACE,item:n[S].vertices},{type:t.GeometryType.SURFACE,item:r[D].vertices}]),!w.isClash&&v.clash.length&&0===v.contact.length&&(w.isClash=!0),w.concat(v))))}else for(x=function(e){let t,n,i,r,a,o=[],s=[],l=[],c=[];for(t=0;t<6;t++)s[t]=e[t],l[t]=e[t];for(t=0;t<3;t++)c[t]=e[t+3]-e[t];return c[0]>c[1]&&c[0]>c[2]?(n=(e[0]+e[3])/2,s[3]=n,r=3,l[0]=n,a=0):c[1]>c[0]&&c[1]>c[2]?(n=(e[1]+e[4])/2,s[4]=n,r=4,l[1]=n,a=1):(n=(e[2]+e[5])/2,s[5]=n,r=5,l[2]=n,a=2),i=e.depth,i<<=1,s.depth=i,s.front=r,l.depth=i,l.front=a,o[0]=s,o[1]=l,o}(e),y=0;y<2&&"OK"===w.status;y++){let e,t,i,s=[],l=[];for(P=0;P<a.length;P++)S=a[P].index,i=a[P].borderProp,t=E(n[S].aabb,x[y]),t>0&&(1===y&&1===t&&(i|=x[y].depth),s.push({index:S,borderProp:i}));if(s.length){for(P=0;P<o.length;P++)D=o[P].index,i=o[P].borderProp,t=E(r[D].aabb,x[y]),t>0&&(1===y&&1===t&&(i|=x[y].depth),l.push({index:D,borderProp:i}));l.length&&(e=R(x[y],n,r,s,l,c,p,h),w.concat(e))}}return w}function k(t,n,i,r){let a,o,s=new g,l=[],c=[],u=t.vertices.length,f=n.vertices.length;if(l=T(t.aabb,n.aabb),!O(l))return s;!function(e){let t;for(t=0;t<3;t++)e[t]-=.001,e[t+3]+=.001}(l);let d=[],p=[],h=[],m=[];for(a=0;a<u;){let n=[t.vertices[a++],t.vertices[a++],t.vertices[a++]];c=e.computeAABBForTriangle(n[0],n[1],n[2]),L(c,l)>0&&(d.push({vertices:n,aabb:c}),h.push({index:d.length-1,borderProp:0}))}for(a=0;a<f;){let t=[n.vertices[a++],n.vertices[a++],n.vertices[a++]];c=e.computeAABBForTriangle(t[0],t[1],t[2]),L(c,l)>0&&(p.push({vertices:t,aabb:c}),m.push({index:p.length-1,borderProp:0}))}return l.depth=1,l.front=-1,o=" ",R(l,d,p,h,m,r," ",i)}function N(i,r,s,c,u){let f,d,p,m,C,P=new g,v=n.retrieveProductAABB;for(let e=i.externalPath.length-1;e>=0;--e){let t=i.externalPath[e];a.isRepReference(t)&&(f=t)}for(let e=r.externalPath.length-1;e>=0;--e){let t=r.externalPath[e];a.isRepReference(t)&&(d=t)}if(!f||!d)return;if(m=i.getWorldMatrix(),C=r.getWorldMatrix(),e.computeAABBSquaredDistance(v(f,m),v(d,C))>=h)return;let S=o._authorizedTeamsOnly_getKey(),D=b(I(i,S),m.elements),w=D.length,x=b(I(r,S),C.elements),M=x.length;for(let t=0;t<w&&"OK"===P.status;++t)for(let n=0;n<M&&"OK"===P.status;++n)if(p=e.computeAABBSquaredDistance(D[t].aabb,x[n].aabb),p<h){let e=k(D[t],x[n],s,u);P.concat(e)}return P.time=performance.now()-l,"Clash"===c?P.contact.length=0:"Contact"===c&&(P.clash.length=0),P.clash.Segment=[],P.contact.Segment=[],P.clash.Surface=[],P.contact.Surface=[],P.clash.forEach((function(e){e.type===t.GeometryType.LINE?P.clash.Segment.push(e.item):e.type===t.GeometryType.SURFACE&&P.clash.Surface.push(e.item)})),P.contact.forEach((function(e){e.type===t.GeometryType.LINE?P.contact.Segment.push(e.item):e.type===t.GeometryType.SURFACE&&P.contact.Surface.push(e.item)})),function(e){for(var t,n,i,r=0;r<e.length;++r)for(n=e[r],t=r+1;t<e.length;++t)y((i=e[t])[0],n)&&y(i[1],n)&&y(i[2],n)&&(e.splice(t,1),--t)}(P.contact.Surface),P}function V(t,n,i,a){let o=new g;if(!(t.vertices&&t.vertices.length&&n.vertices&&n.vertices.length))return;let c=t.vertices.length/3,u=n.vertices.length/3;t.addedTriangles||(t.triangleAdded=[],t.triangleAABB=[],t.triangleAdded.length=t.triangleAABB.length=c),n.addedTriangles||(n.triangleAdded=[],n.triangleAABB=[],n.triangleAdded.length=n.triangleAABB.length=u);let f=t.vertices,d=n.vertices;for(let p=0;p<c;++p){t.triangleAABB[p]||(t.triangleAABB[p]=e.computeAABBForTriangle(f[3*p],f[3*p+1],f[3*p+2]));for(let c=0;c<u;++c){if(++s>1e6&&(s=0,performance.now()-l>a)){o.status="maxTime";break}n.triangleAABB[c]||(n.triangleAABB[c]=e.computeAABBForTriangle(d[3*c],d[3*c+1],d[3*c+2])),e.computeAABBSquaredDistance(t.triangleAABB[p],n.triangleAABB[c])<=i&&0===r.computeTwoTrianglesSquaredDistance(f[3*p],f[3*p+1],f[3*p+2],d[3*c],d[3*c+1],d[3*c+2],i).returnCode&&(t.triangleAdded[p]||(t.triangleAdded[p]=1,o.clearance1.push([f[3*p],f[3*p+1],f[3*p+2]])),n.triangleAdded[c]||(n.triangleAdded[c]=1,o.clearance2.push([d[3*c],d[3*c+1],d[3*c+2]])))}if("OK"!==o.status)break}return o}return g.prototype={constructor:g,concat:function(e){if(!e)return;let t,n;if("OK"!==e.status&&(this.status=e.status),0===this.clash.length)this.clash=e.clash;else if(e.clash.length>0)for(t=e.clash.length,n=0;n<t;++n)this.clash.push(e.clash[n]);if(0===this.contact.length)this.contact=e.contact;else if(e.contact.length>0)for(t=e.contact.length,n=0;n<t;++n)this.contact.push(e.contact[n]);if(0===this.clearance1.length)this.clearance1=e.clearance1;else if(this.clearance1.length>0)for(t=e.clearance1.length,n=0;n<t;++n)this.clearance1.push(e.clearance1[n]);if(0===this.clearance2.length)this.clearance2=e.clearance2;else if(this.clearance2.length>0)for(t=e.clearance2.length,n=0;n<t;++n)this.clearance2.push(e.clearance2[n])}},Object.freeze({computeGeometries:function(t){if(s=0,l=performance.now(),!(t&&t.path1&&t.path2&&t.itfType&&t.maxTime))return;let i;return p=t.metricTol||.001,h=p*p,"Clash"===t.itfType||"Contact"===t.itfType?i=N(t.path1,t.path2,t.itfSystemType,t.itfType,t.maxTime):"Clearance"===t.itfType&&(i=function(t){if(!t.clearanceValue||t.clearanceValue<=0)return;let i,r,s=t.clearanceValue*t.clearanceValue,c=new g,u=t.path1,f=t.path2;for(let e=u.externalPath.length-1;e>=0&&!i;--e){let t=u.externalPath[e];a.isRepReference(t)&&(i=t)}for(let e=f.externalPath.length-1;e>=0&&!r;--e){let t=f.externalPath[e];a.isRepReference(t)&&(r=t)}if(!i||!r)return;let d=u.getWorldMatrix(),p=f.getWorldMatrix(),h=n.retrieveProductAABB;if(e.computeAABBSquaredDistance(h(i,d),h(r,p))>s)return;let m=o._authorizedTeamsOnly_getKey(),C=b(I(u,m),d.elements),y=C.length,P=b(I(f,m),p.elements),v=P.length,S=[];for(let t=0;t<y;++t)for(let n=0;n<v;++n)e.computeAABBSquaredDistance(C[t].aabb,P[n].aabb)<=s&&S.push([t,n]);for(let e=0;e<S.length&&(c.concat(V(C[S[e][0]],P[S[e][1]],s,t.maxTime)),"OK"===c.status);++e);return c.time=performance.now()-l,c}(t)),i&&(i.time=performance.now()-l),i},computeMinDist:function(e){let t=n.measureBetweenWithParts(n.MeasuredType.PRODUCT,e.path1,e.path2);return t&&0===t.returnCode?{minDist:Math.sqrt(t.squaredDistance),pos1:t.aPosition1,pos2:t.aPosition2}:{minDist:0}}})})),define("DS/PIMwebViewController/PIMwebInteferenceListCmd",["DS/CATWebUXComponents/DMUCommandCheckHeader","DS/PADUtils/PADContext"],(function(e,t){"use strict";let n,i,r,a;var o=e.extend({init:function(e){this._parent(e);var r=this;require(["DS/PIMwebViewController/PIMwebItfCtrl"],(function(e){n=e.getItfCtrl({pad3DViewer:t.get()}),i=n.subscribe("onItfListClosed",(function(){r&&r.setState(!1)})),r&&r.setState("1"===localStorage.getItem("PIMwebItfListVisPref"))})),this.onStateChange((function(){r.getState()?o.ShowCommandsList():o.HideCommandsList()})),this._destroy=function(){n&&n.subscribe(i),n=r=i=null;var e=Object.getPrototypeOf(this);e._destroy&&e._destroy.apply(this,arguments)}}});return o.ShowCommandsList=function(e,s){s?r=s.executionContext.getComponent("Viewer"):r||s||(r=t.get()),s&&(a=s.executionContext.getComponent(WAfrStandardComponentKey.HandlerComponent)),s?require(["DS/PIMwebViewController/PIMwebItfCtrl"],(function(t){n=t.getItfCtrl({pad3DViewer:r}),i=n.subscribe("onItfListClosed",(function(){o&&o.HideCommandsList(e,s),a&&a.setCheckState({id:"PIMInteferenceListHdr",state:"1"===localStorage.getItem("PIMwebItfListVisPref")})})),n.showGUX()})):setTimeout((function(){i=n.subscribe("onItfListClosed",(function(){o&&o.HideCommandsList(e,s),a&&a.setCheckState({id:"PIMInteferenceListHdr",state:"1"===localStorage.getItem("PIMwebItfListVisPref")})})),n.showGUX(),e&&e()})),localStorage.setItem("PIMwebItfListVisPref","1")},o.HideCommandsList=function(e,i){!r&&i?r=i.executionContext.getComponent("Viewer"):r||i||(r=t.get()),n&&n.hideGUX(),localStorage.setItem("PIMwebItfListVisPref","0"),e&&e()},o})),define("DS/PIMwebViewController/PIMwebItfCtrl",["UWA/Class","UWA/Core","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/PIMwebViewModel/PIMwebUtils","DS/CATWebUXSlideShow/CATWebUXSlideShowController","DS/PIMwebUX/PIMwebDetailedItfListUI","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/PADUtils/PADSettingsMgt","DS/PIMwebViewModel/PIMwebIsrMgr","DS/PIMwebUX/PIMwebOpacitySlider","DS/PADUtils/PADUtilsServices","DS/CATWebUXComponents/CATWebUXUtils","DS/CATWebUXComponents/CATWebUXPanel","DS/Windows/Dialog","DS/Controls/Button","DS/Visualization/IdPath","DS/Visualization/IdPathMatcher","DS/PIMwebPreferences/PIMwebPreferences","DS/WebappsUtils/WebappsUtils","DS/CoreEvents/ModelEvents","DS/CATWebUXPreferences/CATWebUXPreferencesManager","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","i18n!DS/PIMwebViewController/assets/nls/PIMwebItfCtrl","i18n!DS/PIMwebUX/assets/nls/PIMwebItfListUI","i18n!DS/PIMwebViewController/assets/nls/PIMwebGenerateTICCmd","DS/CATWebUXSlideDrop/CATWebUXSlideDropServices","DS/CATWebUXPreferences/CATWebUXPreferencesUtils","DS/CATWebUXSelectionManager/CATWebUXSelectionManager"],(function(e,t,n,i,r,a,o,s,l,c,u,f,d,p,h,m,g,C,I,b,y,P,v,S,D,w,x,M,A){"use strict";function T(e,t){return!(!t||!t.length)&&e.isReferenceComplete(t[t.length-1].physicalid)}function O(e,t){return!(!t||!t.length)&&!1!==e.hasMeshInRAM(t[t.length-1].physicalid)}function L(e,t){return!!t&&t.every(e.isRegistered,e)}function E(e,t){var n,i,r,a;if(e&&e.length)for(r=t.getRootBagPath(),n=0,i=e.length;n<i;++n){if(!(a=t.getNode({id:e[n].physicalid}))){r=null;break}r.addElement(a)}return r&&r.checkExternalPath()?r:null}function R(e,t){function n(e,t){var n=0;e.itfLblSlide=0,Object.keys(t).forEach((function(i){t[i].row.itfLblSlide&&(e.itfLblSlide=(e.itfLblSlide?e.itfLblSlide:0)+t[i].row.itfLblSlide,t[i].row.itfNonUniqueSlide&&!n&&t[i].row.itfNonUniqueSlide.forEach((function(t){t&&e.ctxChilds.every((e=>t.includes(e)))&&(e.itfLblSlide=e.itfLblSlide-e.childIds.length+1)})),++n)}))}var i,r=(i="mID",e.reduce((function(e,t){var n=t[i]?i:"itfuid";return void 0===t[n]?e:Object.assign(e,{[t[n]]:(e[t[n]]||[]).concat(t)})}),{})),a=[];return Object.keys(r).forEach((function(e){var i=r[e];e||(e=i[0].itfuid);var o=Object.assign({row:{},children:{}},t[e]?t[e]:{}),s=function(e){var n=Object.assign({},e,{itfLblSlide:t[e.mID]&&t[e.mID].row?t[e.mID].row.itfLblSlide:""});return n.icons=e.isNonPersistentPIM?[]:["I_PIMInterference.png"],n.itfuid=e.mID?e.mID:e.itfuid,n.itfName=n.tree=e.itfMetricName?e.itfMetricName:e.itfCtxName,delete n.itfCtxName,delete n.itfLblInst1Path,delete n.itfLblInst2Path,delete n.itfLblRef1Path,delete n.itfLblRef2Path,n}(i[0]);s.childIds=o.row.childIds?o.row.childIds:[],s.ctxChilds=o.row.ctxChilds?o.row.ctxChilds:[],Object.keys(i).forEach((function(e){var n=function(e){var t={itfuid:e.itfuid,tree:e.tree?e.tree:e.itfCtxName,itfName:e.itfCtxName,childOf:e.mID,itfCtxName:e.itfCtxName,itfLblSlide:e.itfLblSlide};return["itfLblInst1Path","itfLblInst2Path","itfLblRef1Path","itfLblRef2Path","itfNonUniqueSlide"].reduce((function(n,i){return t[i]=e[i],n}),{}),t}(i[e]);-1===s.childIds.indexOf(i[e].itfuid)&&(s.childIds.push(i[e].itfuid),s.ctxChilds.push(i[e].itfuid)),o.children[n.itfuid]=t[n.itfuid]={row:n}})),o.children&&n(s,o.children),o.row=s;var l=function(e){if(!e.itfFeat1&&!e.itfFeat2||!e.itfPath1||!e.itfPath2)return null;var n=e.itfPath1[e.itfPath1.length-1].physicalid+e.itfPath2[e.itfPath2.length-1].physicalid,i=e.itfPath2[e.itfPath2.length-1].physicalid+e.itfPath1[e.itfPath1.length-1].physicalid;e.isNonPersistentPIM&&(n=e.itfFeat1+e.itfFeat2,i=e.itfFeat2+e.itfFeat1);var r=t[n]?t[n].row:t[i]?t[i].row:null,a=r?r.itfuid:n,o=r?r.icons:[];e.itfFeat1&&!o.find((e=>"I_PIMGeoBundle.png"===e))&&Boolean(e.itfPath1.find((e=>"ElectricalBranchGeometry"===e.type)))&&o.push("I_PIMGeoBundle.png"),e.itfFeat1&&!o.find((e=>"I_PIMPathwayGeometry.png"===e))&&Boolean(e.itfPath1.find((e=>"Sys3D_PathwayGeometry"===e.type)))&&o.push("I_PIMPathwayGeometry.png"),e.itfFeat2&&!o.find((e=>"I_PIMGeoBundle.png"===e))&&Boolean(e.itfPath2.find((e=>"ElectricalBranchGeometry"===e.type)))&&o.push("I_PIMGeoBundle.png"),e.itfFeat2&&!o.find((e=>"I_PIMPathwayGeometry.png"===e))&&Boolean(e.itfPath2.find((e=>"Sys3D_PathwayGeometry"===e.type)))&&o.push("I_PIMPathwayGeometry.png"),e.isNonPersistentPIM&&!o.find((e=>"I_PIMGeoBundle.png"===e))&&(e.ittEleFeat1Supported||e.ittEleFeat2Supported)&&o.push("I_PIMGeoBundle.png"),e.isNonPersistentPIM&&!o.find((e=>"I_PIMPathwayGeometry.png"===e))&&(e.ittPathway1Supported||e.ittPathway2Supported)&&o.push("I_PIMPathwayGeometry.png");var s={itfuid:a,icons:o,isNonEditable:!0,childIds:[],ctxChilds:[]};return s.itfName=s.tree=e.itfLblRef1+" / "+e.itfLblRef2,["itfLblRef1","itfLblRef2","itfLblRef1Owner","itfLblRef2Owner","itfLblRef1OwnerID","itfLblRef2OwnerID"].reduce((function(t,n){return s[n]=e[n],t}),{}),s}(s);l&&(l.childIds=t[l.itfuid]&&t[l.itfuid].row?t[l.itfuid].row.childIds:[],l.ctxChilds=t[l.itfuid]&&t[l.itfuid].row?t[l.itfuid].row.ctxChilds:[],-1===l.childIds.indexOf(o.row.itfuid)&&l.childIds.push(o.row.itfuid),o.row.childIds&&(l.ctxChilds=l.ctxChilds.concat(o.row.ctxChilds).filter(((e,t,n)=>n.indexOf(e)===t))),o.row.childOf=l.itfuid,a[l.itfuid]={row:l,children:t[l.itfuid]?t[l.itfuid].children:{}}),t[s.itfuid]=Object.assign({},o),o.children&&1===Object.keys(o.children).length?(Object.assign(o.row,o.children[Object.keys(o.children)[0]].row,{itfuid:s.itfuid,childOf:s.childOf}),o.row.itfName=o.row.tree=s.itfMetricName?s.itfMetricName:s.tree?s.tree:s.itfCtxName,delete o.children):o.row.itfCtxName=o.row.itfLblInst1Path=o.row.itfLblInst2Path=o.row.itfLblRef1Path=o.row.itfLblRef2Path=void 0,l?(a[l.itfuid].children[o.row.itfuid]=o,a[l.itfuid].children&&n(a[l.itfuid].row,a[l.itfuid].children),t[l.itfuid]=a[l.itfuid],function(e){function t(e,t){return"Undefined"===e||"Clash"===e||e===t||"Contact"===e&&"Clash"!==t||"Clearance"===e&&"Clash"!==t&&"Contact"!==t||"NoInterference"===e&&"Clash"!==t&&"Contact"!==t&&"Clearance"!==t?e:t}function n(e,t){return"NotAnalyzed"===e||"KO"===e||e===t||"OK"===e&&"KO"!==t?e:t}e.row.itfSystemType=e.row.itfUserType=e.row.itfAnalysis=e.row.itfPrevAnalysis=void 0,Object.keys(e.children).forEach((function(i){var r=e.children[i].row,a=e.row;e.row.itfSystemType=a.itfSystemType&&"Undefined"!==r.itfSystemType?t(a.itfSystemType,r.itfSystemType):r.itfSystemType,e.row.itfUserType=a.itfUserType&&"Undefined"!==r.itfUserType?t(a.itfUserType,r.itfUserType):r.itfUserType,e.row.itfAnalysis=a.itfAnalysis&&"NotAnalyzed"!==r.itfAnalysis?n(a.itfAnalysis,r.itfAnalysis):r.itfAnalysis,e.row.itfPrevAnalysis=a.itfPrevAnalysis&&"NotAnalyzed"!==r.itfPrevAnalysis?n(a.itfPrevAnalysis,r.itfPrevAnalysis):r.itfPrevAnalysis}))}(a[l.itfuid])):a[o.row.itfuid]=o})),a}var k=[["itfLblShape1","itfLblShape1Owner","itfLblShape1OwnerID","itfLblInst1","itfLblInst1Owner","itfLblInst1OwnerID","itfLblRef1","itfLblRef1Owner","itfLblRef1OwnerID","itfLblInst1Path","itfLblInst1Path","itfLblRef1Path"],["itfLblShape2","itfLblShape2Owner","itfLblShape2OwnerID","itfLblInst2","itfLblInst2Owner","itfLblInst2OwnerID","itfLblRef2","itfLblRef2Owner","itfLblRef2OwnerID","itfLblInst2Path","itfLblInst2Path","itfLblRef2Path"]];function N(e,t){return t.forEach((function(t,n){!0===t&&k[n].forEach((function(t){e[t]=void 0}))})),e}var V=e.extend({init:function(e){var t,n,i=this,r=null,a=e.readOnly,s=e.readOnlyForCSICompute,l=e.cbDnD,c=e.prefUnitValues,u=e.pad3DViewer.getFrameWindow().getImmersiveFrame(),f=e.deforder,d=e.defCols,h=e.isListRefreshNeeded,m=e.isCSIExecuteUrlAvailable;this.getTreeListViewer=function(){return r},this.show=function(){t&&(t.setPanelVisibilityFlag(!0),t.ensureVisible())},this.hide=function(){t&&t.setPanelVisibilityFlag(!1)},this.destroy=function(){t&&t.destroy()},this.updatePanelTitle=function(e){t&&(t.title=e)},this.onClose=null,this.toggleReadOnly=function(){r&&r.toggleReadOnly()},this.ensureSelectedLineVisibility=function(){r&&r.ensureSelectedLineVisibility()},n=b.getWebappsAssetUrl("PIMwebUX","icons/22/"),(t=new p({title:D.noItf,identifier:"PIMwebItfListPanel",icon:n+"I_ExamineInterference.png",immersiveFrame:u,viewerFrame:e.pad3DViewer.getFrameWindow().getViewerFrame(),resizableFlag:!0,height:200,width:500,collapsibleFlag:!0,floatableFlag:!0,maximizeButtonFlag:!0,horizontallyStretchableFlag:!0,verticallyStretchableFlag:!0,currentDockArea:WUXDockAreaEnum.BottomDockArea})).elements.container.addClassName(t.identifier),r=new o({parent:t,readOnly:a,readOnlyForCSICompute:s,cbDnD:l,units:{length:c.Length,volume:c.Volume},deforder:f,defCols:d,suffix:f&&f.length>0?"NonPersistent":"",filterCols:{addColsWithSet:f&&f.length>0?["label"]:void 0},isListRefreshNeeded:h,isCSIExecuteUrlAvailable:m}),l=null,t.close=function(){i.onClose?i.onClose():window.console.log("onClose function must be provided")}}}),F=e.extend({init:function(o){var p,v,k,F,U,_,j,G,W,B,H,X,q,Q,z,K,J,Z,Y,$,ee,te,ne,ie,re=this,ae={},oe={},se=[],le=new y,ce=!1,ue=!1,fe={},de={},pe=[],he={},me={},ge=[],Ce=o.pad3DViewer,Ie=Ce.getController(),be=!0,ye=!0,Pe=!1,ve="",Se="",De=[],we=[],xe=!0,Me={Length:{unit:"Millimeter",decimalPlaceRW:3,decimalPlaceRO:3},Volume:{unit:"CubMm",decimalPlaceRW:3,decimalPlaceRO:3}},Ae=Ie.getRootBagId(),Te={version:1,useStoredResults:1,itfAutoLoad:1,geometries:{mode:1,clash:1,contact:1,clearance:1},quantifiers:{minDist:!0},partsOverload:{type:0,parts:["#0000FF","#FFFF00"],itfType:["#CC092F","#FF8A2E","#6FBC48"],transparency:128},custAttr:{objectType:[],attrName:[]},customDefaultView:"M:Name, M:V_Itf_Type, M:V_Itf_User_Type, M:V_Itf_Analysis, M:V_Itf_Previous_Analysis, R1:V_Name, R2:V_Name, R1:owner, R2:owner, M:V_Quantifier, M:description, M:V_Itf_Real_Tolerance_Used_For_Computation, M:responsible",CSICompute:{linksAutomaticReroot:!1,trackPreviousAnalysisStatus:!1}},Oe=["ObjectType1","ObjectType2","ObjectType3","ObjectType4","ObjectType5","ObjectType6","ObjectType7","ObjectType8","ObjectType9","ObjectType10","ObjectType11","ObjectType12","ObjectType13","ObjectType14","ObjectType15","ObjectType16","ObjectType17","ObjectType18","ObjectType19","ObjectType20","AttrName1","AttrName2","AttrName3","AttrName4","AttrName5","AttrName6","AttrName7","AttrName8","AttrName9","AttrName10","AttrName11","AttrName12","AttrName13","AttrName14","AttrName15","AttrName16","AttrName17","AttrName18","AttrName19","AttrName20"],Le="0",Ee=!1,Re=!1,ke=!1,Ne={clash:1,contact:1,clearance:1,quantifiers:1,zoom:0,colorsState:1,transparencyState:0},Ve=!1,Fe=!1,Ue={},_e={},je=void 0,Ge=0,We=100;function Be(e,t){return le.publish({event:e,data:t})}function He(e){return ae[e]?e:oe[e]&&oe[e].row&&oe[e].row.childIds?oe[e].row.childIds[0]:e}function Xe(e){return e?p?p.getSelectedInterferences(e):[]:(p?p.getSelectedInterferences(e):[]).map((function(e){return He(e)})).filter(((e,t,n)=>n.indexOf(e)===t))}function qe(e){return function(e,t){return R(e.map((function(e){var t,n={};for(t in e)if(e.hasOwnProperty(t))switch(t){case"itfPenVec":case"itfMinDist":case"itfTolerance":case"itfPenVol":"number"==typeof e[t]&&(n[t]=e[t]);break;case"itfPrevAnalysis":n[t]="OK"===e[t]||"KO"===e[t]||"NotAnalyzed"===e[t]?e[t]:"";break;case"ifcLen1":case"ifcLen2":break;default:n[t]=e[t]}return n})),t)}(e,oe)}function Qe(){if(xe){var e,t=Ce.getViewer(),n=1===t.getVisibleSpace()?"visibleSpace":"invisibleSpace";Object.keys(de).forEach((function(i){if(de[i][0]||de[i][1])if(Ne.zoom&&me[i]){let t=me[i];if(!t)return;t.children.forEach((t=>t.children.forEach((t=>{var i=t.children[0].getBoundingSphere(n);i.applyMatrix4(t.children[0].getMatrix()),i&&!i.empty()&&(e?e.mergeWithSphere(i,e):e=i)}))))}else{let r=ae[i];if(!r)return;[E(r.itfPath1,Ie),E(r.itfPath2,Ie)].forEach((function(i){if(i&&i.checkExternalPath()){var r=i.getBoundingSphere(t,n);e?e.mergeWithSphere(r,e):e=r}}))}})),e&&!e.isNaN()&&(e.radius=e.radius/1.1*1.05,Ce.getFrameWindow().getViewpoint().reframe(void 0,void 0,e))}}function ze(e){e&&(e.itfManipData&&(e.itfManipData.manipTks.forEach(e.itfManipData.manip.unsubscribe,e.itfManipData.manip),e.itfManipData.manip.unlink(e.itfManipData.manipTk),e.itfManipData=null),e.removeChildren())}function Ke(e){e&&(e.children.forEach((e=>ze(e.children[1]))),e.removeChildren())}function Je(e){let t=me[e];t&&(t.children.forEach((e=>e.children.forEach((e=>ze(e.children[1]))))),q.removeChild(t),delete me[e])}localStorage.setItem("PIMCSIInputI3S","PIM_CSI_I3S_Trace"),c.isCSIExecuteUrlAvailable().then((function(e){je=e}));let Ze=function(){let e,t,a,o,s,l,c,u,f,d,p,h,m,g=Te.partsOverload||Te.colors,C=new n.Color(g.itfType[0]),I=new n.Color(g.itfType[1]),b=new n.Color(g.itfType[2]),y=new n.LineBasicMaterial({color:C,side:n.DoubleSide,force:!0,lineWidth:3}),P=new n.MeshBasicMaterial({color:C,side:n.DoubleSide,opacity:.3,force:!0}),v=new n.MeshBasicMaterial({color:C,side:n.DoubleSide,force:!0}),D=new n.LineBasicMaterial({color:I,side:n.DoubleSide,force:!0,lineWidth:1}),w=new n.LineBasicMaterial({color:b,side:n.DoubleSide,force:!0,lineWidth:1}),x=new n.MeshBasicMaterial({color:b,side:n.DoubleSide,force:!0}),A=new n.MeshBasicMaterial({color:b,side:n.DoubleSide,force:!0}),L="Clash",R="Contact",k="Clearance",N="sans-serif",V=String(16)+"px "+N;function F(e,n){if(n.name===L&&n.children.length)return n.children[0];if(n.name===R&&n.children.length)return n.children[0];if(n.name===k&&e<n.children.length)return n.children[e];let r=new i(e);n.add(r);let a=new i("PIMwebItfGeom");a.setPickable(t.PICKTHROUGH),r.add(a);let o=n.name,s=Ne,l=o===L&&!s.clash||o===R&&!s.contact||o===k&&!s.clearance;return a.setVisibility(!l),a=new i("PIMwebItfQuantifier"),a.setVisibility(s.quantifiers),r.add(a),r}y.color=P.color=v.color=C,D.color=I,w.color=x.color=A.color=b;let U=function(){function r(e,t,n,r){return new Promise((function(a){n||a(),m=new p,m.setFileType("cgr");let o=e.children[0];o.setMatrix(t);let s=new i;var l,c,u;o.add(s),m.setOnLoadedCallback((()=>{Ce.getViewer().render(),a()})),m.loadModelFromBuffer((l=n,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",u=new ArrayBuffer(l.length/4*3),function(e,t){var n=c.indexOf(e.charAt(e.length-1)),i=c.indexOf(e.charAt(e.length-2)),r=e.length/4*3;64===n&&r--,64===i&&r--;var a,o,s,l,u,f,d,p=0,h=0;for(a=t?new Uint8Array(t):new Uint8Array(r),e=e.replace(/[^A-Za-z0-9+/=]/g,""),p=0;p<r;p+=3)o=c.indexOf(e.charAt(h++))<<2|(u=c.indexOf(e.charAt(h++)))>>4,s=(15&u)<<4|(f=c.indexOf(e.charAt(h++)))>>2,l=(3&f)<<6|(d=c.indexOf(e.charAt(h++))),a[p]=o,64!==f&&(a[p+1]=s),64!==d&&(a[p+2]=l)}(l,u),u),s),function(e,t){if(!e||!t)return;let n=e.createOverrideSetManager(),i=n.createSceneGraphOverrideSet();n.pushSceneGraphOverrideSet(i);let r=i.createOverride(new h([e]));r&&r.setMaterial(t,!0)}(s,r)}))}return function(i,o,s,l){return new Promise((function(c){let u=ae[i],f=me[i],d=!1;u&&f&&f.children&&3===f.children.length||c();let p=l.useStoredResults&&fe[u.mRepRef];if(f.__pimGeomDone&&(p||null===p)&&c(),null===p)f.__pimGeomDone=!0,f.removeChildren(),c();else if(p){d=!0;let e=new n.Matrix4,t=new n.Matrix4;if(p.r2scaInvMatrix){let t=p.r2scaInvMatrix;e=new n.Matrix4(t[0],t[3],t[6],t[9],t[1],t[4],t[7],t[10],t[2],t[5],t[8],t[11],0,0,0,1)}if(u.msca){let e=E(u.itfPath1.slice(0,u.itfPath1.findIndex((e=>e.physicalid===u.msca))+1),Ie);e&&(t=e.getWorldMatrix())}t.multiplyMatrices(t,e);var h=[];if(p.clearanceArea)h.push(r(F(0,f.children[0]),t,p.clearanceArea,x));else if(p.clearanceTriangle){(Array.isArray(p.clearanceTriangle)?p.clearanceTriangle:[p.clearanceTriangle]).forEach(((e,n)=>h.push(r(F(n,f.children[0]),t,e,w))))}p.contactTriangle&&h.push(r(F(0,f.children[1]),t,p.contactTriangle,D)),p.clashVolume&&h.push(r(F(0,f.children[2]),t,p.clashVolume,P)),p.clashCurve&&h.push(r(F(0,f.children[2]),t,p.clashCurve,y)),Promise.all(h).then((function(){f.__pimGeomDone=!0,c()}))}let m=[{t:k,b:!1},{t:R,b:!1},{t:L,b:!1}];if(!d){if([[f.children[0],l.geometries.clearance],[f.children[1],l.geometries.contact],[f.children[2],l.geometries.clash]].forEach((function(e){let t=e[0];e[1]||t.children.forEach((e=>e&&e.children.length&&e.children[0].removeChildren()))})),!l.geometries.clearance&&!l.geometries.contact&&!l.geometries.clash)return c();if(2===l.geometries.mode)!l.geometries.clearance||f.children[0].children.length&&f.children[0].children.some((e=>e.children[0].children.length))||(m[0].b=!0),!l.geometries.contact||f.children[1].children.length&&f.children[1].children.some((e=>e.children[0].children.length))||u.itfSystemType===k||(m[1].b=!0),!l.geometries.clash||f.children[2].children.length&&f.children[2].children.some((e=>e.children[0].children.length))||u.itfSystemType===k||u.itfSystemType===R||(m[2].b=!0);else{if(u.itfSystemType===k){if(Ke(f.children[1]),Ke(f.children[2]),!l.geometries.clearance||f.children[0].children.length&&f.children[0].children.some((e=>e.children[0].children.length)))return c()}else if(u.itfSystemType===R){if(Ke(f.children[0]),Ke(f.children[2]),!l.geometries.contact||f.children[1].children.length&&f.children[1].children.some((e=>e.children[0].children.length)))return c()}else if(u.itfSystemType===L&&(Ke(f.children[0]),Ke(f.children[1]),!l.geometries.clash||f.children[2].children.length&&f.children[2].children.some((e=>e.children[0].children.length))))return c();u.itfSystemType===k?m[0].b=!0:u.itfSystemType===R?m[1].b=!0:u.itfSystemType===L&&(m[2].b=!0)}}let g=m.map((e=>e.b&&o&&s&&a.computeGeometries({path1:o,path2:s,itfSystemType:u.itfSystemType,itfType:e.t,clearanceValue:u.itfClearVal,metricTol:u.itfTolerance,maxTime:5e3})));if(g[0]&&g[0].clearance1&&g[0].clearance1.length&&g[0].clearance2&&g[0].clearance2.length&&["clearance1","clearance2"].forEach((function(i){let r,a=g[0][i].length,o=0,s=0,l=[],c=[];l.length=3*a,c.length=6*a;for(let e=0;e<a;++e)r=g[0][i][e],3===r.length&&(l[o++]=new n.Vector3(r[0][0],r[0][1],r[0][2]),l[o++]=new n.Vector3(r[1][0],r[1][1],r[1][2]),l[o++]=new n.Vector3(r[2][0],r[2][1],r[2][2]),c[s++]=o-3,c[s++]=o-2,c[s++]=o-2,c[s++]=o-1,c[s++]=o-1,c[s++]=o-3);F(0,f.children[0]).children[0].add(e.createLineNode({points:l,idx:c,material:w,drawMode:t.ConnectivityTypeEnum.LINES}))})),g[1]&&g[1].contact&&g[1].contact.Surface&&g[1].contact.Surface.length){let i,r=g[1].contact.Surface.length,a=0,o=0,s=[],l=[];s.length=3*r,l.length=6*r;for(let e=0;e<r;++e)i=g[1].contact.Surface[e],3===i.length&&(s[a++]=new n.Vector3(i[0][0],i[0][1],i[0][2]),s[a++]=new n.Vector3(i[1][0],i[1][1],i[1][2]),s[a++]=new n.Vector3(i[2][0],i[2][1],i[2][2]),l[o++]=a-3,l[o++]=a-2,l[o++]=a-2,l[o++]=a-1,l[o++]=a-1,l[o++]=a-3);F(0,f.children[1]).children[0].add(e.createLineNode({points:s,idx:l,material:D,drawMode:t.ConnectivityTypeEnum.LINES}))}if(g[2]&&g[2].clash&&g[2].clash.Segment&&g[2].clash.Segment.length){let i,r=g[2].clash.Segment.length,a=[],o=0;a.length=2*r;let s=[];s.length=a.length;for(let e=0;e<r;++e)i=g[2].clash.Segment[e],s[o]=o,a[o++]=new n.Vector3(i[0][0],i[0][1],i[0][2]),s[o]=o,a[o++]=new n.Vector3(i[1][0],i[1][1],i[1][2]);let l=e.createLineNode({points:a,idx:s,material:y,drawMode:t.ConnectivityTypeEnum.LINES});l.setNoZ(!0),F(0,f.children[2]).children[0].add(l)}g.some((e=>e&&"maxTime"===e.status))&&Ce.displayNotification({msg:S.maxTime,eventID:"info"}),d||c()}))}}(),_=function(){function i(e,i,r){var a=new n.Vector3(e[0],e[1],e[2]),s=new n.Vector3(i[0],i[1],i[2]),l=new o({arrowWidth:2,headLength:10,initialPoint:a,finalPoint:s,color:r,head:1});return l.setPickable(t.PICKTHROUGH),l.updateColor(r),l}function r(i,r,a,o,p,h,m){if(r.length){var g=[],C=0,I=0;r.map((function(i){var r=function(t){var i,r=document.createElement("div"),a=document.createElement("span"),o=document.createTextNode(t.text);r.setAttribute("style","font-family:"+N+";font-size:16px;"),a.setAttribute("style","white-space:nowrap;"),a.appendChild(o),r.appendChild(a),document.body.appendChild(r),i={width:a.offsetWidth,height:a.offsetHeight},document.body.removeChild(r);var s=i.width,l=i.height,c=new u({width:s,height:l,drawCB:function(e,n){try{n.fillStyle="#FFFFFF",n.font=V,n.textAlign="left",n.textBaseline="top",n.fillText(t.text,0,l-16)}catch(e){window.console.log("error")}},rectangleTexture:!0,materialParams:{depthTest:!1}});return new f({name:t.text,bottomLeftcorner:new n.Vector3(0,0,0),widthVector:new n.Vector3(s,0,0),heightVector:new n.Vector3(0,l,0),canvasNodeTexture:c},e)}({text:i}),a=r.getBoundingBox();r.setPickable(t.PICKTHROUGH),g.push(r),I+=a.max.y,C=Math.max(C,a.max.x)})),C=8+C+8,I=5+I+2*(r.length-1)+5;var b=function(e,i,r,a,o,u,f){let p,h=new c({type:"Spherical"});h.name="Texts",h.setMatrix((new n.Matrix4).setPosition(new n.Vector3(r[a+0],r[a+1],r[a+2]))),h.setPickParent(!0),h.setNoZ(!0),e.addChild(h);var m=new l({ratio:1});m.setPickParent(!0),h.addChild(m);var g=new n.Vector3(i[0],i[1],i[2]),C=new s({fixPt:g,width:o,height:u,color:f,viewpoint:Ce.getFrameWindow().getViewpoint()});return C.setPickable(t.PICKTHROUGH),C.setNoZ(!0),C.updateLeader(h.getMatrix().multiply(m.getMatrix())),e.addChild(C),e.itfManipData={manipTks:[]},e.itfManipData.manip=p=new d,p.setDynamic(!0),p.setPrePickingDuringManipulation(!0),p.setPreActivationDuringManipulation(!0),p.setPickingDuringManipulation(!0),p.setExclusive(!0),e.itfManipData.manipTk=p.linkToNode(h),e.itfManipData.manipTks.push(p.subscribe("BeginManipulate",(function(t){e.itfManipData.parentMatInv=(new n.Matrix4).getInverse(e.getMatrix());var i=(new n.Vector3).copy(t.manipulator.initial3dIntersectionPoint).applyMatrix4(e.itfManipData.parentMatInv);e.itfManipData.translation=(new n.Vector3).getPositionFromMatrix(h.getMatrix()).sub(i)}))),e.itfManipData.manipTks.push(p.subscribe("Manipulate",(function(t){var i=e.itfManipData,o=(new n.Vector3).copy(t.manipulator.initial3dIntersectionPoint).add(t.translationVector).applyMatrix4(i.parentMatInv).add(i.translation);r[a+0]=o.x,r[a+1]=o.y,r[a+2]=o.z,h.setMatrix(h.getMatrix().setPosition(o)),C.updateLeader(h.getMatrix().multiply(m.getMatrix())),Ce.getViewer().render()}))),e.itfManipData.manipTks.push(p.subscribe("EndManipulate",(function(){delete e.itfManipData.translation,delete e.itfManipData.parentMatInv}))),h.cbChange=function(e,t){e.call(this,t),C.updateLeader(this.getMatrix().multiply(m.getMatrix()))}.bind(h,h.cbChange),m}(i,a,o,p,C,I,m),y=function(t,i,r){var a=new n.Shape;a.moveTo(0,5),a.lineTo(0,i-5),a.absarc(5,i-5,5,Math.PI,.5*Math.PI,!0),a.lineTo(t-5,i),a.absarc(t-5,i-5,5,.5*Math.PI,0,!0),a.lineTo(t,5),a.absarc(t-5,5,5,2*Math.PI,1.5*Math.PI,!0),a.lineTo(5,0),a.absarc(5,5,5,1.5*Math.PI,Math.PI,!0);var o=new n.ShapeGeometry(a),s=new n.Mesh(o,r),l=e.createNodeFromTHREEMesh(s);return l.setShadow(!1),l.setFrustumCulled(!1),l}(C,I,h);y.excludeFromCSO(!0),y.excludeFromHSO(!0),y.setPickParent(!0),b.addChild(y),I-=5,g.forEach((function(e){var t=e.getBoundingBox();I-=t.max.y,e.setMatrix((new n.Matrix4).setPosition(new n.Vector3(.5*(C-t.max.x),I,0))),b.addChild(e),I-=2}))}}function p(e,t){if(e>0)return t?M.convertUnitValueToString(e,"Volume",Z.Volume.unit,Z.Volume.decimalPlaceRW,Ee,{displaySymbol:!0,displaySpace:!0}):M.convertUnitValueToString(.001*e,"Length",Z.Length.unit,Z.Length.decimalPlaceRW,Ee,{displaySymbol:!0,displaySpace:!0})}return function(e,t,o,s){let l=ae[e],c=me[e],u=new n.Matrix4;if(!l||!c||!c.children||3!==c.children.length)return;if(l.itfSystemType===k&&!l.itfMinDist&&!s.quantifiers.minDist){let e=c.children[0].children.length&&c.children[0].children[0];return void(e&&ze(e.children[1]))}if(c.__pimQuantifierDone)return;if(c.children.forEach((e=>e.children.forEach((e=>e&&e.children.length&&ze(e.children[1]))))),l.msca){let e=E(l.itfPath1.slice(0,l.itfPath1.findIndex((e=>e.physicalid===l.msca))+1),Ie);e&&(u=e.getWorldMatrix())}if(l.itfSystemType===k&&!l.itfMinDist&&s.quantifiers.minDist&&"number"!=typeof l.itfMinDistComputed&&t&&o){let e=a.computeMinDist({path1:t,path2:o});l.itfMinDistComputed=e.minDist;let i=(new n.Matrix4).getInverse(u);l.itfQtfPt1=new n.Vector3(e.pos1[0],e.pos1[1],e.pos1[2]).applyMatrix4(i),l.itfQtfPt2=new n.Vector3(e.pos2[0],e.pos2[1],e.pos2[2]).applyMatrix4(i),l.itfQtfPt1=[l.itfQtfPt1.x,l.itfQtfPt1.y,l.itfQtfPt1.z],l.itfQtfPt2=[l.itfQtfPt2.x,l.itfQtfPt2.y,l.itfQtfPt2.z]}let f,d=s.useStoredResults&&fe[l.mRepRef],h=[],m=new n.Matrix4,g=new n.Matrix4;if(l.pos3D||(l.pos3D=h),(l.itfSystemType===k||l.itfSystemType===L)&&(l.itfSystemType!==L||l.itfPenVec||l.itfPenVol)&&(l.itfSystemType!==k||l.itfMinDist||l.itfMinDistComputed)){if(l.isNonPersistentPIM&&(!l.itfQtfPt1||!l.itfQtfPt2)){let e=function(){var e=null,t=1===Ce.getViewer().getVisibleSpace()?"visibleSpace":"invisibleSpace";if(Object.keys(de).forEach((function(n){if((de[n][0]||de[n][1])&&me[n]){let i=me[n];if(!i)return;i.children.forEach((n=>n.children.forEach((n=>{var i=n.children[0].getBoundingSphere(t);i.applyMatrix4(n.children[0].getMatrix()),i&&!i.empty()&&(e?e.mergeWithSphere(i,e):e=i)}))))}})),e&&!e.isNaN())return e}();null!==e&&(l.itfQtfPt1=[e.center.x,e.center.y,e.center.z],l.itfQtfPt2=[e.center.x,e.center.y,e.center.z])}if(l.itfQtfPt1&&3===l.itfQtfPt1.length&&l.itfQtfPt2&&3===l.itfQtfPt2.length){if(d){if(d.r2scaInvMatrix){let e=d.r2scaInvMatrix;m=new n.Matrix4(e[0],e[3],e[6],e[9],e[1],e[4],e[7],e[10],e[2],e[5],e[8],e[11],0,0,0,1)}g.multiplyMatrices(u,m)}else g.multiplyMatrices(u,(new n.Matrix4).getInverse(u));if(s.useStoredResults&&d&&d.multiClearVectors&&d.multiClearVectors.length%6==0){let e,t,n,a=d.multiClearVectors;for(let o=0;o<d.multiClearVectors.length/6;++o){n=6*o,e=[a[n++],a[n++],a[n++]],t=[a[n++],a[n++],a[n++]],f=[.5*(e[0]+t[0]),.5*(e[1]+t[1]),.5*(e[2]+t[2])],Array.prototype.push.apply(h,f);let s=F(o,c.children[0]).children[1];s.setMatrix(g),s.addChild(i(f,e,b)),s.addChild(i(f,t,b));let u=p(Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])+(t[2]-e[2])*(t[2]-e[2])),!1);u&&r(s,[u],f,l.pos3D,3*o,A,b)}c.__pimQuantifierDone=!0}if((l.isNonPersistentPIM||s.useStoredResults)&&l.itfSystemType===L){let e=F(0,c.children[2]).children[1];e.setMatrix(g);let t=p(l.itfPenVol,!0),a=p(l.itfPenVec,!1),o=[];if(t&&o.push(t),a&&o.push(a),d&&d.clashOnlyPenVector&&6===d.clashOnlyPenVector.length){let t,n;n=[d.clashOnlyPenVector[0],d.clashOnlyPenVector[1],d.clashOnlyPenVector[2]],t=[n[0]+d.clashOnlyPenVector[3],n[1]+d.clashOnlyPenVector[4],n[2]+d.clashOnlyPenVector[5]],f=[.5*(t[0]+n[0]),.5*(t[1]+n[1]),.5*(t[2]+n[2])],Array.prototype.push.apply(h,f),e.addChild(i(t,n,C)),r(e,o,f,l.pos3D,3*(l.pos3D.length/3-1),v,C)}else if(l.itfPenVec||l.itfPenVol){let t=d&&d.r2scaInvMatrix?(new n.Matrix4).getInverse(m):u,a=new n.Vector3(l.itfQtfPt1[0],l.itfQtfPt1[1],l.itfQtfPt1[2]).applyMatrix4(t),s=new n.Vector3(l.itfQtfPt2[0],l.itfQtfPt2[1],l.itfQtfPt2[2]).applyMatrix4(t);f=[.5*(s.x+a.x),.5*(s.y+a.y),.5*(s.z+a.z)],Array.prototype.push.apply(h,f),a=[a.x,a.y,a.z],s=[s.x,s.y,s.z],e.addChild(i(s,a,C)),r(e,o,f,l.pos3D,3*(l.pos3D.length/3-1),v,C)}}else if(l.itfSystemType===k&&!c.__pimQuantifierDone){let e=F(0,c.children[0]).children[1];e.setMatrix(g);let t=d&&d.r2scaInvMatrix?(new n.Matrix4).getInverse(m):u,a=new n.Vector3(l.itfQtfPt1[0],l.itfQtfPt1[1],l.itfQtfPt1[2]).applyMatrix4(t),o=new n.Vector3(l.itfQtfPt2[0],l.itfQtfPt2[1],l.itfQtfPt2[2]).applyMatrix4(t);f=[.5*(o.x+a.x),.5*(o.y+a.y),.5*(o.z+a.z)],Array.prototype.push.apply(h,f),a=[a.x,a.y,a.z],o=[o.x,o.y,o.z],e.addChild(i(f,a,b)),e.addChild(i(f,o,b));let s=p(l.itfMinDist||l.itfMinDistComputed,!1);s&&r(e,[s],f,l.pos3D,3*(l.pos3D.length/3-1),A,b)}c.__pimQuantifierDone=!0,s.useStoredResults||l.itfSystemType!==k||Object.keys(me).forEach((e=>me[e].children.forEach((e=>e.children.forEach((e=>e.children[1].setVisibility(s.quantifiers.minDist)))))))}}}}(),j=function(n,m,g){Array.isArray(n)&&Ce&&(e?(Object.keys(me).forEach((function(e){-1===n.indexOf(e)&&Je(e)})),n.reduce((function(e,t){return e.then((function(){return new Promise((function(e){var n,a,o=ae[t],s=Boolean(o&&(o.ifcLen1&&o.ifcLen1>0||o.ifcLen2&&o.ifcLen2>0));if(!(s||o&&T(Ie,o.itfPath1)&&O(Ie,o.itfPath1)&&T(Ie,o.itfPath2)&&O(Ie,o.itfPath2)))return;if(n=E(o.itfPath1,Ie),o.featPath1&&(n.externalPath=n.externalPath.concat(o.featPath1.externalPath),n.internalPath=o.featPath1.internalPath),a=E(o.itfPath2,Ie),o.featPath2&&(a.externalPath=a.externalPath.concat(o.featPath2.externalPath),a.internalPath=o.featPath2.internalPath),!(n&&n.checkExternalPath()&&a&&a.checkExternalPath())){if(!s)return;n=void 0,a=void 0}let l=me[t];l||(l=me[t]=new i(t),q.add(l),l.add(new i(k)),l.add(new i(R)),l.add(new i(L))),setTimeout((function(){(o.mRepRef?new Promise((e=>{fe[o.mRepRef]=null,r._readMetricGeomStream({repRefID:o.mRepRef,onComplete:function(t){t&&t.infos&&"OK"===t.infos.status&&t.buffer&&(fe[o.mRepRef]=JSON.parse(t.buffer)),e()}})})):Promise.resolve()).then((()=>{U(t,n,a,m).then((()=>{_(t,n,a,m),delete fe[o.mRepRef],Ce.getViewer().render(),e()}))}))}),0)}))}))}),Promise.resolve()).then((()=>{!g&&Ne.zoom&&Qe()}))):require(["DS/Visualization/SceneGraphFactory","DS/Mesh/Mesh","DS/PIMwebViewController/PIMWebViewTools","DS/SceneGraphNodes/ArrowNode","DS/Manipulators/ScreenPlaneManipulator","DS/SceneGraphNodes/FixedSizeNode3D","DS/SceneGraphNodes/BillBoardNode3D","DS/SceneGraphNodes/CanvasNodeTexture","DS/Visualization/PathElement","DS/SceneGraphNodes/CanvasNode","DS/PIMwebViewController/PIMwebLeaderNode","DS/Visualization/ModelLoader"],(function(i,r,C,I,b,y,P,v,S,D,w,x){e=i,t=r,o=I,l=y,c=P,a=C,u=v,f=D,d=b,s=w,p=x,h=S,Ze(n,m,g)})))};return j.updateColors=function(){C.set((Te.partsOverload||Te.colors).itfType[0]),I.set((Te.partsOverload||Te.colors).itfType[1]),b.set((Te.partsOverload||Te.colors).itfType[2])},j}();function Ye(){let e=Object.keys(de).length;pe[0].enable(e>0),pe[1].enable(e>0),100===k?(pe[0].enable(!1),pe[1].enable(!1)):pe[0].setOpacity(k/100,!1),Object.keys(de).forEach((function(e){de[e][4]&&(de[e][4].enable(100!==k),100!==k&&de[e][4].setOpacity(.8,!0))}))}function $e(){Object.keys(de).forEach((function(e){var t=ae[e];if(!t)return;let n=de[e][0],i=de[e][1];var r;Ne.colorsState?0===(Te.partsOverload||Te.colors).type?Ne.colorsState&&(n&&n.setColor((Te.partsOverload||Te.colors).parts[0],!1),i&&i.setColor((Te.partsOverload||Te.colors).parts[1],!1)):("Clash"===t.itfSystemType?r=(Te.partsOverload||Te.colors).itfType[0]:"Contact"===t.itfSystemType?r=(Te.partsOverload||Te.colors).itfType[1]:"Clearance"===t.itfSystemType&&(r=(Te.partsOverload||Te.colors).itfType[2]),r&&(n&&n.setColor(r,!1),i&&i.setColor(r,!1))):(n&&n.setColor(null,!1),i&&i.setColor(null,!1));if(Ne.transparencyState)if(255===Te.partsOverload.transparency)n&&(n.setVisibility(!1,!1),n.setVisibilityFree(!0,!1)),i&&(i.setVisibility(!1,!1),i.setVisibilityFree(!0,!1));else{n&&(n.setVisibility(null,!1),n.setVisibilityFree(null,!1)),i&&(i.setVisibility(null,!1),i.setVisibilityFree(null,!1));let e=(255-Te.partsOverload.transparency)/255;n&&n.setOpacity(e,!0),i&&i.setOpacity(e,!0)}else n&&n.resetOpacity(),i&&i.resetOpacity()}))}function et(e){let t=de[e];t&&t.forEach((e=>e&&B.deleteOverride(e))),delete de[e]}let tt=function(){let e,t=function(e,n,i){if("1"===i.getAttributeCategory())return i.getAnnotationUuid()===n?e.feat=i:i.children.some(t.bind(null,e,n))},n=(n,i)=>{let r=[],a=[];n.forEach((t=>(e.hasAlreadyBeenLoaded(t.repRefID)?r:a).push(t))),(a.length?new Promise((function(t){let i=[],o=function(a){r.push(a.partNode),(r.length===n.length||Ve)&&(i.forEach(e.unsubscribe,e),t())};i.push(e.subscribe("onAnnotationSetLoadingFailed",o)),i.push(e.subscribe("onNoAnnotationSetLoaded",o)),i.push(e.subscribe("onAnnotationSetLoaded",o)),i.push(e.subscribe("onAnnotationSetLoadingCanceled",o)),Ve&&i.push(e.subscribe("onAnnotationSetRemoved",o)),e.setActiveState(2),a.forEach((t=>e.loadFTAModel({idPath:[t.repRefID]})))})):Promise.resolve()).then((function(){!function(e,n){n(e.map((e=>{let n=Ie.getNode({id:e.repRefID});return(n&&n.getChildren()||[]).some((function(i){if(!i.getRootAnnotationNode)return;let r={};if(i.getRootAnnotationNode("RootAttributes").children.some(t.bind(null,r,e.featID)),r.feat){let t=r.feat.getAnnotationTTRS();return(t.length&&i.getTTRSs()||[]).some((function(t){if(t.tpsID!==this)return;let i;if(n.children.some((e=>i=e.getPathElement&&e.setInternalSceneGraph&&e)),i){let n=i.getPathElement(t.geoP,{externalPath:[i]});e.repRepPath=n&&n.length&&n[0]}return!0}),t[0]),!0}})),e})))}(n,i)}))};return function(t){return t.length?new Promise((function(i){e?n(t,i):require(["DS/CAT3DAnnotationModelLoader/CAT3DAnnotationModelLoader"].concat([]),(function(r){e=r.getAnnotationModelLoader({context:Ce}),n(t,i)}))})):Promise.resolve()}}();function nt(e){return new Promise((t=>{if(e=ae[e]?e:He(e),!ae.hasOwnProperty(e)||de.hasOwnProperty(e))return void t();let n=ae[e],i=[null,null,null,null,null],r=[!1,!1],a=[[],[]],o=[[],[]],s=[];if(n){delete n.featPath1,delete n.featPath2,[{itfPath:n.itfPath1,ifcLen:n.ifcLen1},{itfPath:n.itfPath2,ifcLen:n.ifcLen2}].forEach((function(e,t){if(e.itfPath&&e.itfPath.length){var n=e.itfPath.map((function(e){return e.physicalid}));L(Ie,n)?r[t]=n[n.length-1]:e.ifcLen&&e.ifcLen>0&&L(Ie,n.slice(0,n.length-e.ifcLen))?r[t]=n[n.length-e.ifcLen-1]:r[t]=n;var l,c=n.slice(),u=function(e){if(!e)return null;var t,n,i;if(e.some((function(e,t){return e.isBundleFst&&(n=t),e.isBundleFst}))&&n+2<e.length)for(i=[],n+=3,t=0;t<n;++t)i.push(e[t].physicalid);return i}(e.itfPath);c.unshift(Ae),l=[new g(c)],u&&(u.unshift(Ae),l.push(new g(u)),s.push(l[1])),i[t]=B.createIdPathOverride({idPathes:l}),a[t].push(l[0]),o[t].push(new g(c))}})),(i[0]||i[1])&&(de[e]=i,s.length&&(i[4]=B.createIdPathOverride({idPathes:s})),i[0]&&(i[2]=B.createIdPathOverride({idPathes:o[0]}),i[2].setPickability("PICKABLE")),i[1]&&(i[3]=B.createIdPathOverride({idPathes:o[1]}),i[3].setPickability("PICKABLE")));var l=r.map((function(e){return e?new Promise("string"==typeof e?function(t){Ie.lockNodes({ids:[e]}),t(e)}:function(t){Ie.expand({paths:[e],withFrustumFilter:!1,onComplete:function(){if(L(Ie,e)){var n=e[e.length-1];Ie.lockNodes({ids:[n]}),t(n)}else t(!0)},onFailure:function(){t(!0)}},!1,!1,!1)}):Promise.resolve(!1)}));Promise.all(l).then((function(e){!0!==e[0]&&!0!==e[1]||p.updateInterferences(qe([N(n,e)]));let i=[],r=[];var a;"string"==typeof e[0]&&(n.itfFeat1?i.push({repRefID:e[0],featID:n.itfFeat1}):r.push(e[0])),"string"==typeof e[1]&&(n.itfFeat2?i.push({repRefID:e[1],featID:n.itfFeat2}):r.push(e[1])),(r.length||i.length)&&(r.forEach(Ie.lockRepresentationMeshInRAM,Ie),Promise.all([(a=r,a.length?new Promise((e=>{Ie.setForceReferencesLoad({data:a.map((e=>({id:e,state:!0}))),callback:e})})):Promise.resolve()),tt(i)]).then((e=>{(e[1]||[]).forEach((e=>{e.repRepPath&&(n.itfFeat1&&n.itfFeat1===e.featID?n.featPath1=e.repRepPath:n.itfFeat2&&n.itfFeat2===e.featID&&(n.featPath2=e.repRepPath))})),r.length&&Ie.setForceReferencesLoad({data:r.map((e=>({id:e,state:!1})))}),t(!0)})),$e(),Ye(),Ce.getViewer().render())}))}else t()}))}function it(e){F&&(e?F.hide():F.show())}function rt(e){if(e){if(F&&F.show(),U&&"itfLblSlide"===e.cellClickedIdx&&oe[e.idCellClicked].row.itfLblSlide)return e.idCellClicked=oe[e.idCellClicked].row.ctxChilds?oe[e.idCellClicked].row.ctxChilds:e.idCellClicked,void Be("onApplicativeContextRequested",{id:"ITF",data:e.idCellClicked,forceDisplay:!0});Promise.all(e.idsSelected.map(nt)).then((e=>{e.some((e=>e))&&(Ne.zoom||Qe(),Ze(Xe(),J||Te))})),U&&!G&&Be("onApplicativeContextChanged",{id:"ITF"}),j=!1}}function at(e,t){if(e){var n=[];e.forEach((function(e){var t=(e=ae[e]?e:He(e))?ae[e]:null;t&&[t.itfPath1,t.itfPath2].forEach((function(e){e&&e.length&&n.push(e[e.length-1].physicalid)})),et(e)})),n.length&&Ie.unlockNodes({ids:n}),n.forEach(Ie.unlockRepresentationMeshInRAM,Ie),t||(Ye(),Ce.getViewer().render(),Qe(),Ze(Xe(),J||Te)),U&&!G&&Be("onApplicativeContextChanged",{id:"ITF"}),j=!1}}function ot(){if(v){var e,t=0,n=0,i=0;Object.keys(ae).forEach((function(e){var r=ae[e],a=r.itfUserType,o=r.itfSystemType;"Clash"===a?t++:"Contact"===a?n++:"Clearance"===a?i++:"Undefined"!==a&&a||("Clash"===o?t++:"Contact"===o?n++:"Clearance"===o&&i++)})),(t||n||i)&&(e=t?t+" "+D["Clash"+(t>1?"es":"")]:"",e+=e&&n?" ":"",e+=n?n+" "+D["Contact"+(n>1?"s":"")]:"",e+=e&&i?" ":"",e+=i?i+" "+D["Clearance"+(i>1?"s":"")]:""),e=e||D.noItf;var r=Object.keys(he);if(r.length){r.length>1&&window.console.error("More than one simulation in session???");var a=c.getIsr(r[0]),o=a?a.getAttributes().label:void 0;e+=o?" - "+o:""}v.updatePanelTitle(e)}}function st(e){if(!be&&!ye){e.id=ae[e.id]?e.id:He(e.id);var n=ae[e.id].itfModelId,i=c.getIsr(n),r=[],a="",o=function(n){if(n.some((function(t){return t.id===e.id}))){r.forEach((function(e){i.unsubscribe(e)})),r.length=0;var o=n.map((function(n){var r=i.getInterferences(n.id)[0],o=ae[n.id];return t.extend(o,r,!1),a.startsWith("M:",0)&&(o[e.param]=e.newValue),o}));p&&(p.updateInterferences(qe(o)),ot())}};r.push(i.subscribe("itfUpdateSuccess",o)),r.push(i.subscribe("itfUpdateFailed",o)),a=e.param,i.updateInterference({id:e.id,param:e.param,newValue:e.newValue}),"itfUserType"===e.param&&(ae[e.id].itfUserType=e.newValue,ot())}}function lt(){var e=[];let t,n,i,r,a,o;return t={type:"PushItem",title:D.itfCopyLink,callback:function(){},submenu:[{title:D.itfSimulation,type:"RadioItem",action:{callback:function(){require("DS/CATWebUXComponents/DMUCommandsManager").getCommand("PIMwebCopyLinkSimulationHdr",Ce.getCommandContext()).begin()}}},{title:D.itfSelectedInterference,type:"RadioItem",action:{callback:function(){require("DS/CATWebUXComponents/DMUCommandsManager").getCommand("PIMwebCopyLinkSelectedItfHdr",Ce.getCommandContext()).begin()}},state:Xe().length>1?"disabled":"enabled"}]},n={title:D.taskTitle,type:"PushItem",icon:b.getWebappsAssetUrl("PIMwebUX","icons/22/")+"I_CollaborativeTask.png",action:{callback:function(){require("DS/CATWebUXComponents/DMUCommandsManager").getCommand("CATWebUXGenerateTaskHdr",Ce.getCommandContext()).begin()}}},i={title:D.issueTitle,type:"PushItem",icon:b.getWebappsAssetUrl("PIMwebUX","icons/22/")+"I_DMUIssue.png",action:{callback:function(){require("DS/CATWebUXComponents/DMUCommandsManager").getCommand("CATWebUXGenerateIssueHdr",Ce.getCommandContext()).begin()}}},r={title:D.issueTemplateTitle,type:"PushItem",icon:b.getWebappsAssetUrl("PIMwebUX","icons/22/")+"I_DMUIssueTemplate.png",action:{callback:function(){require("DS/CATWebUXComponents/DMUCommandsManager").getCommand("CATWebUXGenerateIssueTemplateHdr",Ce.getCommandContext()).begin()}}},a={title:D.caTitle,type:"PushItem",icon:b.getWebappsAssetUrl("PIMwebUX","icons/22/")+"I_VALCA.png",action:{callback:function(){require("DS/CATWebUXComponents/DMUCommandsManager").getCommand("CATWebUXGenerateCAHdr",Ce.getCommandContext()).begin()}}},o={type:"PushItem",title:D.itfExportToCSV,callback:function(){},submenu:[{title:D.itfAllVisible,type:"RadioItem",action:{callback:function(){require("DS/CATWebUXComponents/DMUCommandsManager").getCommand("PIMwebExportFilteredHdr",Ce.getCommandContext()).begin()}}},{title:D.itfSelected,type:"RadioItem",action:{callback:function(){require("DS/CATWebUXComponents/DMUCommandsManager").getCommand("PIMwebExportSelectedHdr",Ce.getCommandContext()).begin()}}}]},e.push(n),ke||e.push(i),e.push(r),e.push(a),e.push(o),e.push(t),be&&"X3DPLAW_AP"===window.widget.getValue("appId")?[t]:U||be||ye?[]:e}function ct(){if(F){var e=Ce.getFrameWindow().getImmersiveFrame(),t=[WUXDockAreaEnum.TopDockArea,WUXDockAreaEnum.LeftDockArea,WUXDockAreaEnum.RightDockArea].map((function(t){var n=0,i=e.getDockingElement(t);return(i.getContainedVisibleWindows().length>0||i.interactiveDockAreaVisibleFlag)&&(n=i._collapserSize,i.collapseDockingZoneFlag||(n+=i.dockingZoneSize)),n}));F.setPosition({top:String(t[0])+"px",left:String(.5*(e.getFreeZone().getSize().width-F.getSize().width)+t[1])+"px"})}}function ut(e){return function(e,t,n){var i,a,o,s,l=[],u={},f={};if(!t||0===t.length||!e)return Promise.resolve(l);if(c.getIsr(t[0].itfModelId)){if(0===(o=c.getIsr(t[0].itfModelId).getIsrContexts().map((function(e){return e.prd.physicalid}))).length)return Promise.resolve(l);if(o.filter((function(e){return-1===n.indexOf(e)})).length)return Promise.resolve(l)}for(i=0,a=t.length;i<a;++i){var d=t[i];if(d&&(d.itfPath1||d.itfPath2)&&!d.isNonPersistentPIM){var p,h;if(d.itfPath1&&d.itfPath1.length>=3){p=!0,d.itfLblShape1=d.itfPath1[d.itfPath1.length-1].label,d.itfLblShape1Name=d.itfPath1[d.itfPath1.length-1].identifier?d.itfPath1[d.itfPath1.length-1].identifier:"",d.itfLblShape1Owner=d.itfPath1[d.itfPath1.length-1].owner,d.itfLblShape1OwnerID=d.itfPath1[d.itfPath1.length-1].ownerID,d.itfLblMaturity1Shape=d.itfPath1[d.itfPath1.length-1].current,d.itfLblOrganization1Shape=d.itfPath1[d.itfPath1.length-1].organization,d.itfLblCollabSpace1Shape=d.itfPath1[d.itfPath1.length-1].project,d.itfLblRevision1Shape=d.itfPath1[d.itfPath1.length-1].revision,d.itfPath1.length>=4&&(d.itfLblInst1=d.itfPath1[d.itfPath1.length-4].label,d.itfLblInst1Owner=d.itfPath1[d.itfPath1.length-4].owner,d.itfLblInst1OwnerID=d.itfPath1[d.itfPath1.length-4].ownerID),d.itfLblRef1=d.itfPath1[d.itfPath1.length-3].pn?d.itfPath1[d.itfPath1.length-3].pn:d.itfPath1[d.itfPath1.length-3].label,d.itfLblReference1Title=d.itfPath1[d.itfPath1.length-3].label?d.itfPath1[d.itfPath1.length-3].label:"",d.itfLblReference1EnterpriseNum=d.itfPath1[d.itfPath1.length-3].pn?d.itfPath1[d.itfPath1.length-3].pn:"",d.itfLblReference1Name=d.itfPath1[d.itfPath1.length-3].identifier?d.itfPath1[d.itfPath1.length-3].identifier:"",d.itfLblRef1Owner=d.itfPath1[d.itfPath1.length-3].owner,d.itfLblRef1OwnerID=d.itfPath1[d.itfPath1.length-3].ownerID,d.itfLblMaturity1Ref=d.itfPath1[d.itfPath1.length-3].current,d.itfLblRevision1Ref=d.itfPath1[d.itfPath1.length-3].revision,d.itfLblOrganization1Ref=d.itfPath1[d.itfPath1.length-3].organization,d.itfLblCollabSpace1Ref=d.itfPath1[d.itfPath1.length-3].project,d.itfLblInst1Path=d.itfLblRef1Path="",d.itfLblInst1Path=d.itfPath1[0].pn?d.itfPath1[0].pn:d.itfPath1[0].label;for(var m=0;m<=d.itfPath1.length-3;m++)m%2?d.itfLblInst1Path+="\\"+d.itfPath1[m].label:(0!==m&&(d.itfLblRef1Path+="\\"),d.itfLblRef1Path+=d.itfPath1[m].pn?d.itfPath1[m].pn:d.itfPath1[m].label,d.itfPath1[m].isBundleFst&&m+2<d.itfPath1.length&&(d.itfLblFstInst1=d.itfPath1[m+1].label,d.itfLblFstRef1=d.itfPath1[m+2].label,s=d.itfLblFstType1=d.itfPath1[m+2].type,u[s]||(u[s]=[]),u[s].push(d)))}if(d.itfPath2&&d.itfPath2.length>=3){h=!0,d.itfLblShape2=d.itfPath2[d.itfPath2.length-1].label,d.itfLblShape2Name=d.itfPath2[d.itfPath2.length-1].identifier?d.itfPath2[d.itfPath2.length-1].identifier:"",d.itfLblShape2Owner=d.itfPath2[d.itfPath2.length-1].owner,d.itfLblShape2OwnerID=d.itfPath2[d.itfPath2.length-1].ownerID,d.itfLblMaturity2Shape=d.itfPath2[d.itfPath2.length-1].current,d.itfLblOrganization2Shape=d.itfPath2[d.itfPath2.length-1].organization,d.itfLblCollabSpace2Shape=d.itfPath2[d.itfPath2.length-1].project,d.itfLblRevision2Shape=d.itfPath2[d.itfPath2.length-1].revision,d.itfPath2.length>=4&&(d.itfLblInst2=d.itfPath2[d.itfPath2.length-4].label,d.itfLblInst2Owner=d.itfPath2[d.itfPath2.length-4].owner,d.itfLblInst2OwnerID=d.itfPath2[d.itfPath2.length-4].ownerID),d.itfLblRef2=d.itfPath2[d.itfPath2.length-3].pn?d.itfPath2[d.itfPath2.length-3].pn:d.itfPath2[d.itfPath2.length-3].label,d.itfLblReference2Title=d.itfPath2[d.itfPath2.length-3].label?d.itfPath2[d.itfPath2.length-3].label:"",d.itfLblReference2EnterpriseNum=d.itfPath2[d.itfPath2.length-3].pn?d.itfPath2[d.itfPath2.length-3].pn:"",d.itfLblReference2Name=d.itfPath2[d.itfPath2.length-3].identifier?d.itfPath2[d.itfPath2.length-3].identifier:"",d.itfLblRef2Owner=d.itfPath2[d.itfPath2.length-3].owner,d.itfLblRef2OwnerID=d.itfPath2[d.itfPath2.length-3].ownerID,d.itfLblMaturity2Ref=d.itfPath2[d.itfPath2.length-3].current,d.itfLblRevision2Ref=d.itfPath2[d.itfPath2.length-3].revision,d.itfLblOrganization2Ref=d.itfPath2[d.itfPath2.length-3].organization,d.itfLblCollabSpace2Ref=d.itfPath2[d.itfPath2.length-3].project,d.itfLblInst2Path=d.itfLblRef2Path="",d.itfLblInst2Path=d.itfPath2[0].pn?d.itfPath2[0].pn:d.itfPath2[0].label;for(var g=0;g<=d.itfPath2.length-3;g++)g%2?d.itfLblInst2Path+="\\"+d.itfPath2[g].label:(0!==g&&(d.itfLblRef2Path+="\\"),d.itfLblRef2Path+=d.itfPath2[g].pn?d.itfPath2[g].pn:d.itfPath2[g].label,d.itfPath2[g].isBundleFst&&g+2<d.itfPath2.length&&(d.itfLblFstInst2=d.itfPath2[g+1].label,d.itfLblFstRef2=d.itfPath2[g+2].label,s=d.itfLblFstType2=d.itfPath1[g+2].type,f[s]||(f[s]=[]),f[s].push(d)))}(p||h)&&l.push(d)}}return Object.keys(u).length||Object.keys(f).length?new Promise((function(e){r._getTypeNLS(Object.keys(u).concat(Object.keys(f))).then((function(t){Object.keys(t).forEach((function(e){u[e]&&u[e].forEach((function(n){n.itfLblFstType1=t[e]})),f[e]&&f[e].forEach((function(n){n.itfLblFstType2=t[e]}))})),e(l)}))})):Promise.resolve(l)}(Ie,e,Q).then((function(){p&&p.updateInterferences(qe(e))}))}function ft(e){if(e&&e.item&&e.strType&&e.itf&&e.customAttributes){var t=[];e.customAttributes.forEach((n=>{e.item.attributes.slice(1).some((e=>e.name===n.curi))||t.push(n)})),t.length>0&&t.forEach((function(t){let n=t.curi.substring(t.curi.lastIndexOf(":")+1);e.itf[e.strType.concat(n)]=""})),e.item.attributes.slice(1).forEach((function(t){let n=t.name.substring(t.name.lastIndexOf(":")+1);e.itf[e.strType.concat(n)]=t.value,e.units&&Object.keys(e.units).forEach((i=>{t.name===e.units[i].Name&&(n=t.name.substring(t.name.lastIndexOf(":")+1),e.itf[e.strType.concat(n)]=t.value+" "+e.units[i].unit)})),p&&p.addCustomAttrKeyAndName(e.strType.concat(n))}))}}var dt,pt,ht,mt,gt=(dt=[],pt=0,ht=function(e,t){pt--,gt(),t(e)},mt=function(e){var n,i=t.clone(e,!1);i.onComplete=function(t){ht(t,e.onComplete)},i.onFailure=function(t){ht(t,e.onFailure)},i.onTimeout=function(t){ht(t,e.onTimeout||e.onFailure)},n=i,require("DS/WAFData/WAFData").authenticatedRequest(require("DS/PADUtils/PADUtilsServices").get3DSpaceUrl()+"/cvservlet/fetch/v2?tenant="+require("DS/PADUtils/PADUtilsServices").getPlatformId(),{method:"POST",timeout:6e4,headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:require("DS/PADUtils/PADSettingsMgt").getSetting("pad_security_ctx")},data:JSON.stringify({physicalid:n.ctxIDs,label:"ITFCustomAtttrFetch"+Date.now(),select_predicate:n.attrCuris,select_file:[],select_unit:n.unitSelectObj}),onComplete:n.onComplete,onFailure:n.onFailure})},function(e){e&&dt.push(e),dt.length&&pt<5&&(pt++,mt(dt.shift()))});function Ct(e){return new Promise((function(t){if(e&&0===e.length)t();else{var n=[],i=[],a=[];e.forEach((function(e){if(e&&e.mID&&e.itfPath1&&e.itfPath1.length>=3){e.isQueryValueFetched=!1,n.push(e.mID);let t=e.ifcLen1?e.ifcLen1:0;e.itfPath1&&e.itfPath1.length-t>=4&&(a.push(e.itfPath1[e.itfPath1.length-t-4].physicalid),i.push(e.itfPath1[e.itfPath1.length-t-3].physicalid));let r=e.ifcLen2?e.ifcLen2:0;e.itfPath2&&e.itfPath2.length-r>=4&&(a.push(e.itfPath2[e.itfPath2.length-r-4].physicalid),i.push(e.itfPath2[e.itfPath2.length-r-3].physicalid))}})),n.length>0||i.length>0||a.length>0?Promise.all([new Promise((function(e){ee?e(ee):r._getCustomAttributesFromType({data:["ds6wg:PLMPIMMetricReference","ds6wg:VPMReference","ds6wg:VPMInstance"]}).then((function(t){ee=void 0!==t&&Object.keys(t).length?t:void 0,e()}))})),new Promise((function(e,t){if(te)e(te);else{let n=require("DS/PADUtils/PADUtilsServices").get3DSpaceUrl()+"/resources/dictionary/dimensions?tenant="+require("DS/PADUtils/PADUtilsServices").getPlatformId(),i=require("DS/PADUtils/PADSettingsMgt").getSetting("pad_security_ctx");require("DS/WAFData/WAFData").authenticatedRequest(n+"&SecurityContext="+i,{method:"GET",type:"json",timeout:6e4,headers:{Accept:"application/json","content-type":"application/json","Accept-Language":window.widget.lang?window.widget.lang:window.widget.getValue("lang"),SecurityContext:i},onComplete:function(t){te=void 0!==t&&Object.keys(t).length?t:void 0,e()},onFailure:function(e){t(e)},onTimeout:function(e){t(e)}})}}))]).then((function(){var r={},o={},s=[],l=[];if(void 0!==ee&&Object.keys(ee).length){Object.keys(ee).forEach((e=>{ee[e].length>0&&(ee[e].forEach((function(e){""!==e.dimension&&te&&te.results&&te.results.forEach((function(t){t&&t.Name===e.dimension&&""!==e.manipulationUnit&&t.Units&&t.Units.length>0&&t.Units.forEach((function(t){if(e.manipulationUnit===t.Name){var n={Name:"",unitLabel:"",unit:""};n.Name=e.curi,""!==t.label&&(n.unitLabel=t.label),""!==t.NLSName&&(n.unit=t.NLSName),r[e.curi]=n}}))})),l.includes(e.curi)||l.push(e.curi)})),"PLMPIMMetricReference"===e?s=s.concat(n):"VPMReference"===e?s=s.concat(i):"VPMInstance"===e&&(s=s.concat(a)))})),r&&Object.keys(r).forEach((e=>{o[e]=r[e].unitLabel}));var c=Math.floor((s.length-1)/500)+1,u=0,f=0;for(0===c&&t();u<c;)gt({ctxIDs:s.slice(500*u,500*(u+1)),attrCuris:l,unitSelectObj:o,type:"CustomAttributeQuery",onComplete:function(n){f++;var i=JSON.parse(n);e.forEach((function(e){i.results&&i.results.forEach((function(t){if(t&&t.attributes&&t.attributes.length>0){"isQueryValueFetched"in e&&(e.isQueryValueFetched=!0);let n=t.ifcLen1?t.ifcLen1:0,i=t.ifcLen2?t.ifcLen2:0;t.attributes[0].value===e.mID?ft({item:t,strType:"M:",itf:e,units:r,customAttributes:ee.PLMPIMMetricReference}):e.itfPath1&&e.itfPath1.length-n>=4&&t.attributes[0].value===e.itfPath1[e.itfPath1.length-n-4].physicalid?ft({item:t,strType:"I1:",itf:e,units:r,customAttributes:ee.VPMInstance}):e.itfPath2&&e.itfPath2.length-i>=4&&t.attributes[0].value===e.itfPath2[e.itfPath2.length-i-4].physicalid?ft({item:t,strType:"I2:",itf:e,units:r,customAttributes:ee.VPMInstance}):e.itfPath1&&e.itfPath1.length-n>=4&&t.attributes[0].value===e.itfPath1[e.itfPath1.length-n-3].physicalid?ft({item:t,strType:"R1:",itf:e,units:r,customAttributes:ee.VPMReference}):e.itfPath2&&e.itfPath2.length-i>=4&&t.attributes[0].value===e.itfPath2[e.itfPath2.length-i-3].physicalid&&ft({item:t,strType:"R2:",itf:e,units:r,customAttributes:ee.VPMReference})}}))})),u===f&&t()},onFailure:function(){f++,u===f&&t()}}),u++}else t()})):t()}}))}function It(e){if(_&&(!Ve||0!==Object.keys(he).length)){var t=[],n=e?e.map((function(e){return e.itfuid})):Object.keys(ae),i=!0;n.forEach((function(e){ae[e].itfLblSlide&&(ae[e].itfLblSlide=0,t.push(e),ae[e].itfNonUniqueSlide&&(ae[e].itfNonUniqueSlide.length=0))}));var r=Object.keys(he);return r=r.length?r[0]:null,_.forEach((function(e){var a=e.state?e.state.context:null;if(!(a&&a.data&&a.data.length&&a.data[0].isr===r&&a.data[0].itfs))return window.console.error("Unexpected!"),void(_=null);a.data[0].itfs.forEach((function(e){ae[e]&&n.indexOf(e)>-1?(ae[e].itfLblSlide||(ae[e].itfLblSlide=0),++ae[e].itfLblSlide,ae[e].itfNonUniqueSlide||(ae[e].itfNonUniqueSlide=[]),ae[e].itfNonUniqueSlide.push(a.data[0].itfs),-1===t.indexOf(e)&&t.push(e)):i=!1}))})),i&&(_=null),t}}function bt(e){H&&W&&-1===H.getSceneGraphOverrideSetIndex(W)&&H.pushSceneGraphOverrideSet(W),H&&B&&-1===H.getSceneGraphOverrideSetIndex(B)&&H.pushSceneGraphOverrideSet(B),e.forEach((function(e){var t=ae[e.itfuid];t&&t.itfLblSlide&&(e.itfLblSlide=t.itfLblSlide),ae[e.itfuid]=e})),Ct(e).then((function(){ut(e),It(e),ot()}))}function yt(){p&&p.removeInterferences(),ae={},oe={},ot(),Object.keys(de).forEach(et),Ye(),Ze([]),z&&z.setActiveState(!1),Ce.getViewer().render(),F&&F.hide()}function Pt(e){var t=window.widget.getValue("xsceneStoredObjects"),n=[];t&&"string"==typeof t||(t='{"products":{},"filters":{}}'),t=JSON.parse(t),"boolean"==typeof e?(window.widget.setValue("ItfSimuInSession",JSON.stringify(he)),Object.keys(he).forEach((function(e){var i=he[e];i.length?(t.itf||(t.itf={}),i.forEach((function(n){t.itf[n]=e})),n=n.concat(i)):(t.isr||(t.isr={}),t.isr[e]={},n.push(e),t.itf&&(n=n.concat(Object.keys(t.itf))))})),window.widget.setValue("xsceneStoredObjects",JSON.stringify(t))):(window.widget.deleteValue("ItfSimuInSession"),t.itf&&Object.keys(t.itf).forEach((function(i){t.itf[i]===e&&-1===n.indexOf(i)&&n.push(i)})),t.isr&&Object.keys(t.isr).indexOf(e)>=0&&n.push(e)),require(["DS/PADServices/utils/GlobalModelEvents"],(function(e){e.publish({event:"ENXViews/LandingPage/refreshCustom",data:n})}))}function vt(e){e&&he[e]&&(p&&at(Xe(),!0),c.unlockIsr(e),delete he[e],yt(),p&&p.showListRefreshWarning(!1),Pt(e),Be("onIsrRemoved",{isrLog:t.clone(he,!0),removedIsr:e}),Be("onDMUCtxtRemoved"))}function St(){var e=[],t=c.getLoadedIsr();Object.keys(he).forEach((function(n){e=e.concat(t[n].getIsrContexts()).map((e=>e.prd.physicalid)),vt(n)})),e.length&&Ce.removeRoots({pids:e})}function Dt(){let e=require("DS/CATWebUXComponents/DMUCommandsManager").getCommand(Ce.getExecutionContext?"PIMWebUXGenerateIssueHdr":"CATWebUXGenerateIssueHdr",Ce.getCommandContext());e&&(ke?e.disable():(re.getLoadedIsr().length||re.isPIMDataLoaded())&&e.enable())}function wt(e){e&&p&&p.addCustoColumn(e)}function xt(){if(p){var e=Te.custAttr,n=t.clone(ee,!0);new Promise((function(e){if(void 0===n){r._getCustomAttributesFromType({data:["ds6wg:PLMPIMMetricReference","ds6wg:VPMReference","ds6wg:VPMInstance"]}).then((function(t){e(t)}))}else e(n)})).then((function(t){if(e&&t&&Object.keys(t).length>0){p&&p.removeCustoColoumn();var n=[e.attrName,e.objectType];if(n.slice(1).every((e=>e.length===n[0].length)))for(let n=0;n<e.attrName.length;n++){if(""===e.attrName[n].value)continue;let i=!1;Object.keys(t).forEach((r=>{if(t[r].length>0){var a,o=0;if("PLMPIMMetricReference"===r&&"Metric"===e.objectType[n].value){for(o=0;o<t[r].length;o++)if((a=t[r][o])&&a.curi){let t,r,o=a.curi.lastIndexOf(".")>-1?a.curi.lastIndexOf("."):a.curi.lastIndexOf(":"),s=a.dataType.substring(a.dataType.lastIndexOf("#")+1),l=a.curi.substring(o+1),c=a.curi.substring(a.curi.lastIndexOf(":")+1);if(l===e.attrName[n].value?(i=!0,t="M:".concat(c),r=a.label?a.label:l):c===e.attrName[n].value&&(i=!0,t="M:".concat(c),r=a.label?a.label:c),void 0!==t&&void 0!==r){wt({dataIndex:t,text:r,editableFlag:"string"===s&&"ReadWrite"===a.userAccess&&void 0===a.rangeValues?1:0});break}}}else if("VPMReference"===r&&"Reference"===e.objectType[n].value){for(o=0;o<t[r].length;o++)if((a=t[r][o])&&a.curi){let t=a.curi.lastIndexOf(".")>-1?a.curi.lastIndexOf("."):a.curi.lastIndexOf(":"),r=a.curi.substring(t+1);if([{suffix:D.itfLblRef1,prefix:"R1:"},{suffix:D.itfLblRef2,prefix:"R2:"}].forEach((t=>{let o,s,l=a.curi.substring(a.curi.lastIndexOf(":")+1);r===e.attrName[n].value?(i=!0,o=t.prefix.concat(l),s=a.label?a.label.concat(" ".concat(t.suffix)):r.concat(" ".concat(t.suffix))):l===e.attrName[n].value&&(i=!0,o=t.prefix.concat(l),s=a.label?a.label.concat(" ".concat(t.suffix)):l.concat(" ".concat(t.suffix))),void 0!==o&&void 0!==s&&wt({dataIndex:o,text:s,editableFlag:!1})})),i)break}}else if("VPMInstance"===r&&"Instance"===e.objectType[n].value)for(o=0;o<t[r].length;o++)if((a=t[r][o])&&a.curi){let t=a.curi.lastIndexOf(".")>-1?a.curi.lastIndexOf("."):a.curi.lastIndexOf(":"),r=a.curi.substring(t+1);if([{suffix:D.itfLblInst1,prefix:"I1:"},{suffix:D.itfLblInst2,prefix:"I2:"}].forEach((t=>{let o,s,l=a.curi.substring(a.curi.lastIndexOf(":")+1);r===e.attrName[n].value?(i=!0,o=t.prefix.concat(l),s=a.label?a.label.concat(" ".concat(t.suffix)):r.concat(" ".concat(t.suffix))):l===e.attrName[n].value&&(i=!0,o=t.prefix.concat(l),s=a.label?a.label.concat(" ".concat(t.suffix)):l.concat(" ".concat(t.suffix))),void 0!==o&&void 0!==s&&wt({dataIndex:o,text:s,editableFlag:!1})})),i)break}}})),i||("Metric"===e.objectType[n].value?wt({dataIndex:e.attrName[n].value,text:e.attrName[n].value,editableFlag:!1}):"Reference"===e.objectType[n].value?(wt({dataIndex:"R1".concat(e.attrName[n].value),text:e.attrName[n].value.concat(" ").concat(D.itfLblRef1),editableFlag:!1}),wt({dataIndex:"R2".concat(e.attrName[n].value),text:e.attrName[n].value.concat(" ").concat(D.itfLblRef2),editableFlag:!1})):"Instance"===e.objectType[n].value&&(wt({dataIndex:"I1".concat(e.attrName[n].value),text:e.attrName[n].value.concat(" ").concat(D.itfLblInst1),editableFlag:!1}),wt({dataIndex:"I2".concat(e.attrName[n].value),text:e.attrName[n].value.concat(" ").concat(D.itfLblInst2),editableFlag:!1})))}}}))}}function Mt(e,t){var n=!1,i=!1,r=!1,a=!1,o=!1;if(e.forEach((function(e){"PIMwebPref"===e.name?e.preferences.forEach((function(e){if("PIMwebItfAutoLoad"===e.name)Te.itfAutoLoad="true"===e.value||"1"===e.value?1:0;else if("IDStoredResults"===e.name)Te.useStoredResults="true"===e.value||"1"===e.value?1:0,n=!0,Object.keys(me).forEach(Je),Object.keys(ae).forEach((e=>delete ae[e].pos3D));else if("IDQMinDist"===e.name)Te.quantifiers.minDist="idMinDist"===e.value,n=!0,Te.useStoredResults||Object.keys(me).forEach((e=>me[e].children.forEach((e=>e.children.forEach((e=>e.children[1].setVisibility(Te.quantifiers.minDist)))))));else if("IDGeometries"===e.name)Te.geometries.mode="idType"===e.value?1:2,n=!0;else if("IDGClash"===e.name)Te.geometries.clash="idCurve"===e.value?1:0,n=!0;else if("IDGContact"===e.name)Te.geometries.contact="idTriangle"===e.value?1:0,n=!0;else if("IDGClearance"===e.name)Te.geometries.clearance="idTriangle"===e.value?1:0,n=!0;else if("IDColorOverLoading"===e.name)Te.partsOverload.type="colorInstance"===e.value?0:1,i=!0;else if("IDColorInstance1"===e.name)Te.partsOverload.parts[0]=e.value,i=!0;else if("IDColorInstance2"===e.name)Te.partsOverload.parts[1]=e.value,i=!0;else if("IDColorItfClash"===e.name)Te.partsOverload.itfType[0]=e.value,i=!0;else if("IDColorItfContact"===e.name)Te.partsOverload.itfType[1]=e.value,i=!0;else if("IDColorItfClearance"===e.name)Te.partsOverload.itfType[2]=e.value,i=!0;else if("IDItfPartsTranspPercent"===e.name){let t=parseFloat(e.value);t<0?t=0:t>100&&(t=100),Te.partsOverload.transparency=Math.round(2.55*t),a=!0,i=!0}else if("PIMwebLoad"===e.name)Le="pimAllParts"===e.value?"0":"1",a=!0;else if("ObjectType"===e.name.replace(/[0-9]/g,"")||"AttrName"===e.name.replace(/[0-9]/g,"")){o=!0;var t={name:e.name,value:e.value};"ObjectType"===e.name.replace(/[0-9]/g,"")?Te.custAttr.objectType.some((t=>t.name===e.name))?Te.custAttr.objectType.some((function(t){t.name===e.name&&(t.value=e.value)})):Te.custAttr.objectType.push(t):"AttrName"===e.name.replace(/[0-9]/g,"")&&(Te.custAttr.attrName.some((t=>t.name===e.name))?Te.custAttr.attrName.some((function(t){t.name===e.name&&(t.value=e.value)})):Te.custAttr.attrName.push(t))}else"IDLinksAutomaticReroot"===e.name?Te.CSICompute.linksAutomaticReroot="true"===e.value:"IDTrackPreviousAnalysisStatus"===e.name&&(Te.CSICompute.trackPreviousAnalysisStatus="true"===e.value)})):"FrameGeneral"===e.name?e.preferences.forEach((function(e){if("ProjectionType"===e.name){a=!0;var t="Perspective"===e.value?0:1;let n=Ce?Ce.getViewer():null;n&&n.currentViewpoint&&n.currentViewpoint.setProjectionType(t)}})):"VisualizationRepository"===e.name?e.preferences.forEach((function(e){if("Gravity"===e.name){a=!0;var t="true"===e.value;let n=Ce?Ce.getViewer():null;n&&n.currentViewpoint&&n.currentViewpoint.control&&(n.currentViewpoint.getControl().setRotationRolling(!t),n.currentViewpoint.getControl().setRollingForTouchAvailable(!t))}})):ie&&"SelectionRepository"===e.name?e.preferences.forEach((function(e){"Select3DGeometry"===e.name?(a=!0,ie.setPicking("true"===e.value?0:1)):"SelectParentReferenceOr3DShape"===e.name&&(a=!0,ie.selectParentReference("select3DShape"!==e.value))})):"cke"===e.name?e.preferences.forEach((function(e){"Length"===e.name||"LengthCalcDisplay"===e.name||"Volume"===e.name||"VolumeCalcDisplay"===e.name?(n=!0,r=!0,"Length"===e.name?Z.Length.unit=e.value:"LengthCalcDisplay"===e.name?Z.Length.decimalPlaceRW=parseInt(e.value):"Volume"===e.name?Z.Volume.unit=e.value:"VolumeCalcDisplay"===e.name&&(Z.Volume.decimalPlaceRW=parseInt(e.value))):"TrailingZeros"===e.name&&(Ee="true"===e.value,n=!0,Object.keys(me).forEach((e=>{delete me[e].__pimQuantifierDone,delete me[e].__pimGeomDone})))})):"TICSection"===e.name&&e.preferences.forEach((function(e){"TICTemplateIssue"===e.name&&(ke="true"===e.value,Dt())}))})),i&&($e(),Ze.updateColors(),Ce.getViewer().render()),o&&xt(),r){if(p){p.setUnits({length:Z.Length,volume:Z.Volume});let e=Object.keys(ae).map((e=>ae[e]));e.length&&p.updateInterferences(qe(e))}Object.keys(me).forEach((e=>delete me[e].__pimQuantifierDone))}if((a||i||r||n)&&((n||j)&&Ze(Xe(),Te),j=!1,t)){var s=require("DS/DMUBaseUIControllers/DMUSlidesController").giveDMUSlidesController({context:Ce.getFrameWindow()});if(s){var l=s.getActiveSlide();l&&(l.getSlideApplicativeContext().ITF.content.prefs=Te,l.getSlideApplicativeContext().ITF.content.prefs.displayOptions=Ne,s.setActiveSlide(l))}}}let At=async function(){let e,t=Ce&&Ce.getExecutionContext?Ce.getExecutionContext():void 0;if(t){e=t.getComponent(WAfrStandardComponentKey.HandlerComponent);const n=[];n.push(e.setCheckState({id:"PIMInteferenceListHdr",state:"1"===localStorage.getItem("PIMwebItfListVisPref")}));let i=localStorage.getItem("PIMwebApplyDisplayPref")?JSON.parse(localStorage.getItem("PIMwebApplyDisplayPref")):{};n.push(e.setCheckState({id:"PIMDisplayClashCurveHdr",state:!("clash"in i)||1===i.clash})),re.applyDisplay("clash","clash"in i?i.clash:1,!0),n.push(e.setCheckState({id:"PIMDisplayContactCurveHdr",state:!("contact"in i)||1===i.contact})),re.applyDisplay("contact","contact"in i?i.contact:1,!0),n.push(e.setCheckState({id:"PIMDisplayClearanceCurveHdr",state:!("clearance"in i)||1===i.clearance})),re.applyDisplay("clearance","clearance"in i?i.clearance:1,!0),n.push(e.setCheckState({id:"PIMDisplayQuantifiersHdr",state:!("quantifiers"in i)||1===i.quantifiers})),re.applyDisplay("quantifiers","quantifiers"in i?i.quantifiers:1,!0),n.push(e.setCheckState({id:"PIMZoomOnInterferenceHdr",state:"zoom"in i&&1===i.zoom})),re.applyDisplay("zoom","zoom"in i?i.zoom:0,!0),n.push(e.setCheckState({id:"PIMColorOverloadHdr",state:!("colorsState"in i)||1===i.colorsState})),re.applyDisplay("colorsState","colorsState"in i?i.colorsState:1,!0),n.push(e.setCheckState({id:"PIMApplyTransparencyHdr",state:"transparencyState"in i&&1===i.transparencyState})),re.applyDisplay("transparencyState","transparencyState"in i?i.transparencyState:0,!0),await Promise.all(n),localStorage.setItem("PIMwebApplyDisplayPref",JSON.stringify(i))}};function Tt(){return new Promise((function(e){if(Re)return e();ie||(ie=A.getSelectionManager({context:Ce}));let n=[{Repository:"PIMwebPref",PreferenceNames:["PIMwebLoad","IDStoredResults","PIMwebItfAutoLoad","IDQMinDist","IDGeometries","IDGClash","IDGContact","IDGClearance","IDColorOverLoading","IDColorInstance1","IDColorInstance2","IDColorItfClash","IDColorItfContact","IDColorItfClearance","IDItfPartsTranspPercent","DefaultView","IDLinksAutomaticReroot","IDTrackPreviousAnalysisStatus"].concat(Oe)},{Repository:"FrameGeneral",PreferenceNames:["ProjectionType"]},{Repository:"VisualizationRepository",PreferenceNames:["Gravity"]},{Repository:"SelectionRepository",PreferenceNames:["Select3DGeometry","SelectParentReferenceOr3DShape"]},{Repository:"cke",PreferenceNames:["Length","LengthCalcDisplay","Volume","VolumeCalcDisplay","TrailingZeros"]},{Repository:"TICSection",PreferenceNames:["TICTemplateIssue"]}];Z=t.clone(Me,!0),M.readPreferences(n).then((function(t){Mt(t.repositories),Re=!0,e()})).catch((function(t){window.console.warn("Error Preferences ",t),e()}))}))}function Ot(){if(!F){var e=function(){var e={userValue:10,checkedButton:0},t=localStorage.getItem("PIMwebOpacityPref");if("string"==typeof t){var n=t.split("-"),i=Number(n[1]),r=Number(n[2]);"number"==typeof i&&(e.userValue=0<=i&&i<=100?i:e.userValue),"number"==typeof r&&(e.checkedButton=0<=r&&r<=2?r:e.checkedButton)}return e}();e.parent=Ce.getFrameWindow().getUIFrame(),k=2===e.checkedButton?100:1===e.checkedButton?0:e.userValue,(F=new u(e)).onOpacityChange=function(e){!function(e){var t="0-"+String(e.userValue)+"-"+String(e.checkedButton);localStorage.setItem("PIMwebOpacityPref",t)}(e),k=e.newValue,Ye(),Ce.getViewer().render(),Be("onOpacityChange",{id:"ITF",data:e})},Ce.getFrameWindow().getImmersiveFrame().addEventListener("freeZoneResize",ct)}}function Lt(){if(!p){var e=["dragenter","dragover","drop"],t=!1;ye="pending"===ve||"running"===ve;var n=[],i={};(_e.columns?_e.columns:[]).forEach((function(e){i[e.dataIndex]={dataIndex:e.dataIndex,text:e.text,editableFlag:e.editableFlag,visibleFlag:!0},n.push(e.dataIndex)})),(v=new V({pad3DViewer:Ce,readOnly:be,readOnlyForCSICompute:ye,isCSIExecuteUrlAvailable:je,isListRefreshNeeded:Fe,cbDnD:{onDragStartCell:d,onDragOverCell:o,onDragEndCell:u,onDragEnterBlank:o,onDragLeaveBlank:o,onDragOverBlank:o,onDragStartColumnHeader:s,onDragOverColumnHeader:function(e){return e.stopPropagation(),t||e.preventDefault(),!t},onDragEndColumnHeader:u,onDragStartRowHeader:d,onDragOverRowHeader:o,onDragEndRowHeader:u},prefUnitValues:Z,deforder:n.length>0?n:void 0,defCols:Object.keys(i).length>0?i:void 0})).onClose=function(){re.hideGUX(),Be("onItfListClosed")},(p=v.getTreeListViewer()).onSelect=rt,p.onHideShowOpaSlider=it,p.onUnselect=at,p.onCellEdit=st,p.onContextualEvent=lt,p.onItfListRefresh=function(){var e,t=c.getLoadedIsr(),n=Object.keys(t)[0];n?(e={isrID:n,onComplete:function(){var e={onComplete:function(t){for(var i=t.list.length,a=0,o=!1,s=Date.now()-864e5,l=void 0;a<i&&(!o||void 0===l);){var u=t.list[a++];if(!(1e3*u.startingTime>=s)){o=!0;break}if(u.internalID===n){l=u;break}}void 0!==l||o||100!==i||(Ge+=100,c.getIsrJobsListByPage({onComplete:e.onComplete,onFailure:e.onFailure,data:{offset:Ge,limit:We}})),p.setIsItfListRefreshRunning(!1),l&&(ve=l.status,"succeeded"===l.status&&l.completionTime&&(ye=!1,p.setListUIReadyOnlyFlagForCSICompute(l.status),r._getIndexingTimestamp({onComplete:function(e){const t=JSON.parse(e);let n="";if(t.FTS&&t.FTS.allvaultsacl&&(n=t.FTS.allvaultsacl),l.completionTime<=n){if(Fe=!1,p&&(p.showListRefreshWarning(Fe),ae&&Object.keys(ae).length>0)){let e=Object.keys(ae).map((e=>ae[e]));e.length&&p.updateInterferences(qe(e))}}else Fe=!0,p&&p.showListRefreshWarning(Fe)},onFailure:function(){window.console.log("getIndexingTimeStamp failed")}})))},onFailure:function(e){window.console.log("Error Occured during contextual reload"+e)},data:{offset:Ge=0,limit:We}};c.getIsrJobsListByPage(e)},onFailure:function(){p.setIsItfListRefreshRunning(!1),ot()}},yt(),c.reloadContextuals({isrID:e.isrID,onProgress:function(e){var t,n=e.isrID?c.getIsr(e.isrID):null,i=n&&e.itfIDs?n.getInterferences(e.itfIDs):null,r=[];for(i.forEach((function(e){e.itfPath1&&r.push(e.itfPath1.map((function(e){return e.physicalid}))),e.itfPath2&&r.push(e.itfPath2.map((function(e){return e.physicalid})))})),t=r.length-1;t>=0;--t)r[t].every((function(e){return Ie.getNode({id:e})}))&&r.splice(t,1);i&&bt(i)},onComplete:e.onComplete,onFailure:e.onFailure})):p.setIsItfListRefreshRunning(!1)},p.showSlideColumn(U);var a=Object.keys(ae).map((function(e){return ae[e]}));a.length&&ut(a),ot(),Te.custAttr&&p&&xt()}function o(e){e.stopPropagation()}function s(){var t=Ce.getViewer().canvas,n=Ce.getFrameWindow().getImmersiveFrame();return e.forEach((function(e){t.addEventListener(e,o),n.addEventListener(e,o)})),!0}function u(){var n=Ce.getViewer().canvas,i=Ce.getFrameWindow().getImmersiveFrame();return t=!1,e.forEach((function(e){n.removeEventListener(e,o),i.addEventListener(e,o)})),!0}function d(e,n){if(!p||!n)return!1;t=!0;var i={protocol:"3DXContent",version:"1.1",data:{items:[]},source:window.widget&&window.widget.getValue("x3dAppId")?window.widget.getValue("x3dAppId"):"ENOI3D_AP",widgetId:window.widget?window.widget.id:void 0},r=[];return Xe().forEach((function(e){var t=ae[e];-1===r.indexOf(t.mID)&&(r.push(t.mID),i.data.items.push({envId:f.getPlatformId(),serviceId:"3DSpace",contextId:l.getSetting("pad_security_ctx")?l.getSetting("pad_security_ctx"):void 0,objectId:t.mID,objectType:t.mType,displayName:t.itfMetricName}))})),e.dataTransfer.setData("Text",JSON.stringify(i)),s(),!1}}function Et(e){Te.itfAutoLoad&&setTimeout((function(){new Promise((function(e){p?e():(Lt(),Ot(),setTimeout(e,100))})).then((function(){if(v.show(),F.show(),p.selectRowsByUID(e),Ce.getExecutionContext)require(["DS/CATWebUXComponents/DMUCommandsManager"],(function(e){e.getCommandCheckHeader("PIMInteferenceListHdr",Ce.getCommandContext()).setState(!0)}));else{let e=setInterval((function(){let t=require("DS/CATWebUXComponents/DMUCommandsManager").getCommandCheckHeader("PIMInteferenceListHdr",Ce.getCommandContext());t&&(t.setState(!0),clearInterval(e))}),100)}}))}),0)}function Rt(e){X||(X={isrID:[],metricID:[]},z&&z.setActiveState(!1),setTimeout((function(){let n,i,a,o,s,l=!1,u=Object.keys(he),f=0,d=!0,g=!1,C=!e.noNotif;if(u.length>1&&window.console.log("More than 1 interference simulation loaded. This must not be possible!!"),X.isrID.length>0){X.isrID.length>1&&C&&Ce.displayNotification({msg:S.pimSingleIsr,eventID:"info"}),o=X.isrID[0];var I=X.metricID.length;if(he[o]?0===he[o].length&&(d=!1):(l=!0,St(),(he={})[o]=[]),d)n=function(e){e&&(g=!0,l&&c.lockIsr(e.isrID),ot()),0===f&&g&&(Ce.unsubscribe(i),Ce.unsubscribe(a),C&&Ce.displayNotification({msg:S.itfCtrlMsgSuccess,eventID:"success"}),I&&C&&Ce.displayNotification({msg:S[I>1?"pimMetricsIgnored":"pimMetricIgnored"],eventID:"info"}),Pt(!0),X=null,Be("onIsrAdded",{isrLog:t.clone(he,!0),loadedIsr:o}),Be("onDMUCtxtLoadingSuccess"))},setTimeout(At,1500),ne||(ne=Tt()),ne.then((function(){var t="1"===(1===e.loadMode?"1":0===e.loadMode?"0":Le)?"InterferingPartsOnly":"AllParts";c.loadIsr({isrID:o,onProgress:function(e){if("AllParts"===t&&e.context)if(e.context.length){var l=e.context;if(he[o]&&he[o].length?he[o].length=0:l=e.context.filter((function(e){return-1===Q.indexOf(e.prd.physicalid)})),l.length>0){f+=l.length,i||a||(i=Ce.subscribe({event:"onRootAdded"},(function(){f=0,n()})),a=Ce.subscribe({event:"onRootAlreadyExisting"},(function(){f=0,n()})));var u=[],d=[];l.forEach((function(e){e.filter&&e.filter.physicalid&&"ENOStrRefinementSpecification"===e.filter.type?d.push({objectId:e.filter.physicalid}):e.prd&&e.prd.physicalid&&u.push({path:[e.prd.physicalid]})})),u.length&&Ce.addRoots({objects:u},!0,!1),d.length&&Ce.addFilter(d)}else C&&Ce.displayNotification({msg:S.itfCtrlMsgCtxAlreadyLoaded,eventID:"info"})}else C&&Ce.displayNotification({msg:S.itfCtrlMsgNoContext,eventID:"info"});var h,m=e.isrID?c.getIsr(e.isrID):null,g=m&&e.itfIDs?m.getInterferences(e.itfIDs):null;if("InterferingPartsOnly"===t&&e.interferingPathsReady&&g){Ce.getAutomaticReframePolicy()&&(Ce.setAutomaticReframePolicy(!1),h=1);var I=[];for(g.forEach((function(e){e.itfPath1&&I.push(e.itfPath1.map((function(e){return e.physicalid}))),e.itfPath2&&I.push(e.itfPath2.map((function(e){return e.physicalid})))})),s=I.length-1;s>=0;--s)I[s].every((function(e){return Ie.getNode({id:e})}))&&I.splice(s,1);f+=I.length,!f||i||a||(i=Ce.subscribe({event:"onRootAdded"},(function(){f--,1===h&&(Ce.reframe(),h=2),0===f&&(2===h&&Ce.setAutomaticReframePolicy(!0),n())})),a=Ce.subscribe({event:"onRootAlreadyExisting"},(function(){f--,0===f&&n()}))),f&&Ce.addRoots({objects:I.map((function(e){return{path:e}}))},!0,!1)}if(je){let t;ve="",Se="",p&&p.setListUIReadyOnlyFlagForCSICompute("pending"),ye=!0;var b=require("DS/CATWebUXComponents/DMUCommandsManager");t=b.getCommand("PIMwebUpdateItfHdr",Ce.getCommandContext()),t&&t.disable();var y={onComplete:function(n){var i=n.list.length,a=0,o=!1,s=Date.now()-864e5,l=void 0;if(i>0){for(;a<i&&(!o||void 0===l);){var u=n.list[a++];if(!(1e3*u.startingTime>=s)){o=!0;break}if(u.internalID===e.isrID){l=u;break}}void 0!==l||o||100!==i||(Ge+=100,c.getIsrJobsListByPage({onComplete:y.onComplete,onFailure:y.onFailure,data:{offset:Ge,limit:We}})),l?(ve=l.status,Se=""!==l.jobConfiguration&&void 0!==l.jobConfiguration?l.jobConfiguration:"8","succeeded"===l.status||"cancelled"===l.status||"failed"===l.status?(t=b.getCommand("PIMwebUpdateItfHdr",Ce.getCommandContext()),t&&t.enable(),p&&p.setListUIReadyOnlyFlagForCSICompute(ve),require(["DS/CoreEvents/Events"],(function(e){e.publish({event:"onEnableContextSpecTab",data:l.status})})),ye=!1):"pending"!==l.status&&"running"!==l.status||(t=b.getCommand("PIMwebUpdateItfHdr",Ce.getCommandContext()),t&&t.disable(),p&&p.setListUIReadyOnlyFlagForCSICompute(ve),require(["DS/CoreEvents/Events"],(function(e){e.publish({event:"onEnableContextSpecTab",data:l.status})})),ye=!0),"succeeded"===l.status&&l.completionTime&&r._getIndexingTimestamp({onComplete:function(e){const t=JSON.parse(e);let n="";if(t.FTS&&t.FTS.allvaultsacl&&(n=t.FTS.allvaultsacl),l.completionTime<=n){if(Fe=!1,p&&(p.showListRefreshWarning(Fe),ae&&Object.keys(ae).length>0)){let e=Object.keys(ae).map((e=>ae[e]));e.length&&p.updateInterferences(qe(e))}}else Fe=!0,p&&p.showListRefreshWarning(Fe)},onFailure:function(){}})):(ve="",t=b.getCommand("PIMwebUpdateItfHdr",Ce.getCommandContext()),t&&t.enable(),p&&p.setListUIReadyOnlyFlagForCSICompute(ve),require(["DS/CoreEvents/Events"],(function(e){e.publish({event:"onEnableContextSpecTab",data:""})})),ye=!1),g&&bt(g)}else g&&bt(g)},onFailure:function(){ve="queryFailed",p&&p.setListUIReadyOnlyFlagForCSICompute(ve),window.console.log("Compute Job Status: Failure Message : ")},data:{offset:Ge=0,limit:We}};c.getIsrJobsListByPage(y)}else g&&bt(g)},onComplete:n,onFailure:function(e){Ce.unsubscribe(i),Ce.unsubscribe(a),he={},"Simulation"===e.step?C&&Ce.displayNotification({msg:S.itfCtrlMsgNotFound,eventID:"warning"}):C&&Ce.displayNotification({msg:S.itfCtrlMsgError,eventID:"warning"}),ot();var t={};t[o]=[],X=null,Be("onIsrAddFailed",t),Be("onDMUCtxtLoadingFailure")}})}));else{C&&Ce.displayNotification({msg:S.itfCtrlMsgSimuAlreadyLoaded,eventID:"info"});var b={};b[o]=[],X=null,Be("onIsrAlreadyLoaded",b),Be("onDMUCtxtAlreadyLoaded")}}else if(X.metricID.length>0){var y=0,P=[],v=0,D=X.metricID.length;u.length&&(d=!X.metricID.every((function(e){return u.some((function(t){return he[t].indexOf(e)>-1}))}))),d?(ne||(ne=Tt()),ne.then((function(){n=function(e){if(e)l&&c.lockIsr(e.isrID),ot();else{if(0!==f)return;Ce.unsubscribe(i),Ce.unsubscribe(a),P.length?(C&&Ce.displayNotification({msg:S[P.length>1?"pimMetricsLoadOK":"pimMetricLoadOK"],eventID:"success"}),Pt(!0),Be("onItfAdded",{isrLog:t.clone(he,!0),loadedIsr:Object.keys(he)[0],loadedMetrics:P}),Be("onDMUCtxtLoadingSuccess")):D?(C&&Ce.displayNotification({msg:S[D>1?"pimMetricsAlreadyLoaded":"pimMetricAlreadyLoaded"],eventID:"info"}),Be("onItfAlreadyLoaded"),Be("onDMUCtxtAlreadyLoaded")):(Be("onIsrItfNothingAdded"),Be("onDMUCtxtNotAdded")),v&&C&&Ce.displayNotification({msg:S[v>1?"pimIgnoredMetrics":"pimIgnoredMetric"],eventID:"info"}),y&&C&&Ce.displayNotification({msg:S[y>1?"pimMetricsNoIsr":"pimMetricNoIsr"],eventID:"info"}),Et(X.metricID),X=null}},c.loadIsrFromMetrics({metrics:X.metricID,onFilterIsr:function(e){function n(t){e.onComplete(t)}var i=Object.keys(e.isrIDs);if(0===i.length)return y=e.metricsWithoutIsr.length,D=0,void n([]);if(u.length&&i.indexOf(u[0])>-1){for(o=u[0],D=e.isrIDs[o].itfM.length,s=1;s<i.length;++s)i[s]!==o&&(v+=e.isrIDs[i[s]].itfM.length);if(0===he[o].length)return void n([]);if(e.isrIDs[o].itfM.every((function(e){return he[o].indexOf(e)>-1})))return void n([])}else{for(o=i[0],D=e.isrIDs[o].itfM.length,s=1;s<i.length;++s)D<e.isrIDs[i[s]].itfM.length?(o=i[s],v+=D,D=e.isrIDs[i[s]].itfM.length):v+=e.isrIDs[i[s]].itfM.length;if(u.length){var r,a=new m({onClick:function(){r.destroy(),St(),n([o]),l=!0,he[o]=[]}}),c=new m({onClick:function(){r.close()}});return void(r=new h({identifier:"PIMwebIsrRemovePanel",modalFlag:!0,title:S.pimIsrRemoveTitle,content:new t.Element("div",{html:"<p>"+(v?S.pimIsrRemoveMsg2:S.pimIsrRemoveMsg1)+"</p><p><b>"+e.isrIDs[o].label+"</b></p>"}),width:350,immersiveFrame:Ce.getFrameWindow().getImmersiveFrame(),buttons:{Ok:a,Cancel:c}})).addEventListener("close",(function(){v=D=0,n([])}))}l=!0,he[o]=[]}n([o])},onProgress:function(e){var t=e.isrID?c.getIsr(e.isrID):null,r=t&&e.itfIDs?t.getInterferences(e.itfIDs):null;if(e.interferingPathsReady){var o=[];for(r.forEach((function(e){e.itfPath1&&o.push(e.itfPath1.map((function(e){return e.physicalid}))),e.itfPath2&&o.push(e.itfPath2.map((function(e){return e.physicalid})))})),s=o.length-1;s>=0;--s)o[s].every((function(e){return Ie.getNode({id:e})}))&&o.splice(s,1);f+=o.length,!f||i||a||(i=Ce.subscribe({event:"onRootAdded"},(function(){f--,0===f&&n()})),a=Ce.subscribe({event:"onRootAlreadyExisting"},(function(){f--,0===f&&n()}))),f&&Ce.addRoots({objects:o.map((function(e){return{path:e}}))},!0,!1)}r&&bt(r),e.metrics&&e.metrics.forEach((function(t){-1===he[e.isrID].indexOf(t)&&he[e.isrID].push(t),-1===P.indexOf(t)&&P.push(t)}))},onComplete:n,onFailure:function(e){Ce.unsubscribe(i),Ce.unsubscribe(a),e&&e.isrID&&he[e.isrID]&&0===he[e.isrID].length&&(he={}),ot(),C&&Ce.displayNotification({msg:S[D>1?"pimMetricsLoadKO":"pimMetricLoadKO"],eventID:"warning"}),X=null,Be("onItfAddFailed"),Be("onDMUCtxtLoadingFailure")}})}))):(C&&Ce.displayNotification({msg:S[X.metricID.length>1?"pimMetricsAlreadyLoaded":"pimMetricAlreadyLoaded"],eventID:"info"}),Be("onItfAlreadyLoaded"),Be("onDMUCtxtAlreadyLoaded"),Et(X.metricID),X=null)}}),0)),e.isrID&&(X.isrID=X.isrID.concat(e.isrID)),e.metricID&&(X.metricID=X.metricID.concat(e.metricID))}function kt(){v&&v.hide(),F&&F.hide()}function Nt(e,t){var n="";return e.forEach((function(e){n&&(n+=", "),"Issue"===t&&e.filter&&(n+=e.filter.label,n+=" ("),n+=e.prd.label,"Issue"===t&&e.filter&&(n+=")")})),n}function Vt(e){return new Promise((function(n){var i=c.getIsr(e.isr);let a=[];var o={reportedAgainst:[],contexts:[],assignees:[],attachments:[]};if(e.itf.length){var l,u=ae[e.itf[0]];o.title=u.itfMetricName,o.priority="Low",o.description=u.itfDescription?u.itfDescription:Nt(i.getIsrContexts(),e.cmdType),i.getIsrContexts().forEach((function(t){o.serviceID||(o.serviceID=Ie?Ie.getRootStats(t.prd.physicalid).serviceId:"3DSpace"),"CA"===e.cmdType?o.contexts.push(t.prd.physicalid):(o.serviceID=Ie?Ie.getRootStats(t.prd.physicalid).serviceId:"3DSpace",o.contexts.push({physicalId:t.prd.physicalid,serviceId:o.serviceID,objectType:t.prd.type}),t.filter&&o.contexts.push({physicalId:t.filter.physicalid,serviceId:o.serviceID,objectType:t.filter.type}))})),e.itf.forEach((function(t){[ae[t].itfPath1,ae[t].itfPath2].forEach((function(t){var n,i;t&&t.length>2&&((n=t.some((function(e,t){return e.isBundleFst&&(i=t),e.isBundleFst}))&&i+2<t.length?t[i+2]:t.some((function(e,t){return e.isIfcElt&&(i=t),e.isIfcElt}))&&i>2?t[i-3]:t[t.length-3]).physicalid&&-1===a.indexOf(n.physicalid)&&(!0===require("DS/PADUtils/PADSettingsMgt").getSetting("activateSGI")?"CA"!==e.cmdType&&o.reportedAgainst.push({physicalId:s.getNodeI3DX(n),serviceId:o.serviceID,objectType:s.getNodeType(n)}):"CA"===e.cmdType?o.reportedAgainst.push(n.physicalid):o.reportedAgainst.push({physicalId:n.physicalid,serviceId:o.serviceID,objectType:n.type}),a.push(n.physicalid)),n.ownerID&&-1===o.assignees.indexOf(n.ownerID)&&o.assignees.push(n.ownerID))})),ae[t].mID&&-1===o.attachments.indexOf(ae[t].mID)&&o.attachments.push(ae[t].mID)})),l="Task"===e.cmdType?"GenerateTask":"Issue"===e.cmdType?"GenerateIssue":"IssueTemplate"===e.cmdType?"GenerateIssueTemplate":"GenerateCA",r._sendUsageProbe(l,"NbMetric"+o.attachments.length),n(o)}else{var f,d,p,g,C,I,b,y,P;f=w.issueTitle,d=w.caTitle,p=w.taskTitle,g=w.issueOnIsr,C=w.caOnIsr,I=w.taskOnIsr,b=w.yes,y=w.no;var v,S=t.createElement("div");"Issue"===e.cmdType||"IssueTemplate"===e.cmdType?(P=f,v=g):"Task"===e.cmdType?(P=p,v=I):(P=d,v=C),t.createElement("label",{text:v,styles:{"margin-bottom":"0px",padding:"10px 0px"}}).inject(S);var D=new h({modalFlag:!0,ensureHeightDefinitionOnHierarchy:!0,title:P,immersiveFrame:Ce.getFrameWindow().getImmersiveFrame(),content:S,closeButtonFlag:!0,buttons:{Ok:new m({label:b,onClick:function(){var t=i.getAttributes();o.title=t.label,o.priority="Low",o.description=t.description?t.description:Nt(i.getIsrContexts(),e.cmdType),i.getIsrContexts().forEach((function(t){if("CA"===e.cmdType)!1===require("DS/PADUtils/PADSettingsMgt").getSetting("activateSGI")&&-1===o.reportedAgainst.indexOf(t.prd.physicalid)&&o.reportedAgainst.push(t.prd.physicalid),-1===o.contexts.indexOf(t.prd.physicalid)&&o.contexts.push(t.prd.physicalid),o.assignees.indexOf(-1===t.prd.ownerID)&&o.assignees.push(t.prd.ownerID);else{if(o.serviceID=Ie?Ie.getRootStats(t.prd.physicalid).serviceId:"3DSpace",!0===require("DS/PADUtils/PADSettingsMgt").getSetting("activateSGI")){var n=s.getNodeI3DX(t.prd);o.reportedAgainst.some((e=>e.physicalId===n))||o.reportedAgainst.push({physicalId:n,serviceId:o.serviceID,objectType:s.getNodeType(t.prd)});var i=s.getNodeI3DX(t.filter);t.filter&&!o.reportedAgainst.some((e=>e.physicalId===i))&&o.reportedAgainst.push({physicalId:i,serviceId:o.serviceID,objectType:s.getNodeType(t.filter)})}else o.reportedAgainst.some((e=>e.physicalId===t.prd.physicalid))||o.reportedAgainst.push({physicalId:t.prd.physicalid,serviceId:o.serviceID,objectType:t.prd.type}),t.filter&&!o.reportedAgainst.some((e=>e.physicalId===t.filter.physicalid))&&o.reportedAgainst.push({physicalId:t.filter.physicalid,serviceId:o.serviceID,objectType:t.filter.type});o.contexts.some((e=>e.physicalId===t.prd.physicalid))||o.contexts.push({physicalId:t.prd.physicalid,serviceId:o.serviceID,objectType:t.prd.type}),t.filter&&!o.contexts.some((e=>e.physicalId===t.filter.physicalid))&&o.contexts.push({physicalId:t.filter.physicalid,serviceId:o.serviceID,objectType:t.filter.type}),o.assignees.indexOf(-1===t.prd.ownerID)&&o.assignees.push(t.prd.ownerID),t.filter&&o.assignees.indexOf(-1===t.filter.ownerID)&&o.assignees.push(t.filter.ownerID)}})),-1===o.attachments.indexOf(i.getAttributes().physicalid)&&o.attachments.push(i.getAttributes().physicalid),D.destroy(),n(o)}}),Cancel:new m({label:y,emphasize:"primary",onClick:function(){D.destroy(),o.status="ticCancel",n(o)}})}});D.addEventListener("close",(function(){D.destroy(),n()}))}}))}Ce.getViewer().addNode(q=new i("PIMwebDecoration")),Ce.getViewer().getIdPathMatcher()||Ce.getViewer().setIdPathMatcher(new C({idToNodeCB:function(e){return Ie.getNode({id:e})},nodeToIdCB:function(e){return e===Ie.getRootBag()?Ae:s.getNodeID(e)},isNodeRepRefCB:function(e){return s.isRepReference(e)}})),H=Ce.getViewer().getSceneGraphOverrideSetManager(),W=H.createSceneGraphOverrideSet({rootNode:Ie.getRootBag(),rootId:Ae,name:"pimSgos"}),B=H.createSceneGraphOverrideSet({rootNode:Ie.getRootBag(),rootId:Ae,name:"pimSgos",mode:"forceShow"}),H.pushSceneGraphOverrideSet(W),H.pushSceneGraphOverrideSet(B);var Ft=new g([Ae]);pe.push(W.createIdPathOverride({idPathes:[Ft]})),pe.push(W.createIdPathOverride({idPathes:[Ft]})),pe[1].setPickability("IGNORED"),Ye(),se.push(Ce.subscribe({event:"onRefreshBegin"},(function(){ge=t.clone(he,!0)}))),se.push(Ce.subscribe({event:"onRefreshCompleted"},(function(){var e=Object.keys(ge);if(1===e.length){var t={},n=e[0];Array.isArray(ge[n])&&ge[n].length?t.metricID=ge[n]:t.isrID=n,Rt(t)}}))),se.push(Ce.subscribe({event:"onBeginFilterApplied"},(function(){$=!0}))),se.push(Ce.subscribe({event:"onFilterApplied"},(function(){$=!1}))),se.push(Ce.subscribe({event:"onBeginFilterRemoved"},(function(){$=!0}))),se.push(Ce.subscribe({event:"onFilterRemoved"},(function(){$=!1}))),Q=Ce.getRoots().map((function(e){return s.getNodeID(e)})),Array.prototype.push.apply(Q,Ie.getHiddenRootIds()),se.push(Ce.subscribe({event:"onRootAdded"},(function(e){-1===Q.indexOf(e.id)&&Q.push(e.id);var t=Object.keys(ae).map((function(e){return ae[e]}));Ct(t).then((function(){ut(t),ot(),function(){var e=0;Ce.getRoots().forEach((function(t){t.userData&&"R2V_FeatureState"===t.userData.type&&e++}));var t=require("DS/CATWebUXComponents/DMUCommandsManager");let n;e===Ce.getRoots().length?(n=t.getCommandCheckHeader("PIMInteferenceListHdr",Ce.getCommandContext()),n&&n.disable(),n=t.getCommandCheckHeader("PIMDisplayClashCurveHdr",Ce.getCommandContext()),n&&n.disable(),n=t.getCommandCheckHeader("PIMDisplayContactCurveHdr",Ce.getCommandContext()),n&&n.disable(),n=t.getCommandCheckHeader("PIMDisplayClearanceCurveHdr",Ce.getCommandContext()),n&&n.disable(),n=t.getCommandCheckHeader("PIMDisplayQuantifiersHdr",Ce.getCommandContext()),n&&n.disable(),n=t.getCommandCheckHeader("PIMZoomOnInterferenceHdr",Ce.getCommandContext()),n&&n.disable(),n=t.getCommandCheckHeader("PIMApplyTransparencyHdr",Ce.getCommandContext()),n&&n.disable(),n=t.getCommandCheckHeader("PIMColorOverloadHdr",Ce.getCommandContext()),n&&n.disable(),n=t.getCommand("PIMwebCreateItfHdr",Ce.getCommandContext()),n&&n.disable(),n=t.getCommand("PIMwebEditItfHdr",Ce.getCommandContext()),n&&n.disable()):e>=1&&(n=t.getCommandCheckHeader("PIMInteferenceListHdr",Ce.getCommandContext()),n&&n.enable(),n=t.getCommandCheckHeader("PIMDisplayClashCurveHdr",Ce.getCommandContext()),n&&n.enable(),n=t.getCommandCheckHeader("PIMDisplayContactCurveHdr",Ce.getCommandContext()),n&&n.enable(),n=t.getCommandCheckHeader("PIMDisplayClearanceCurveHdr",Ce.getCommandContext()),n&&n.enable(),n=t.getCommandCheckHeader("PIMDisplayQuantifiersHdr",Ce.getCommandContext()),n&&n.enable(),n=t.getCommandCheckHeader("PIMZoomOnInterferenceHdr",Ce.getCommandContext()),n&&n.enable(),n=t.getCommandCheckHeader("PIMApplyTransparencyHdr",Ce.getCommandContext()),n&&n.enable(),n=t.getCommandCheckHeader("PIMColorOverloadHdr",Ce.getCommandContext()),n&&n.enable(),n=t.getCommand("PIMwebCreateItfHdr",Ce.getCommandContext()),n&&n.enable())}()}))}))),se.push(Ce.subscribe({event:"onRootRemoved"},(function(e){if(!$){var t=Q.indexOf(e.id);-1!==t&&Q.splice(t,1);var n=c.getLoadedIsr();Object.keys(n).forEach((function(t){n[t].getIsrContexts().map((function(e){return e.prd.physicalid})).indexOf(e.id)>-1&&vt(t)}))}}))),se.push(Ce.subscribe({event:"onEndDelete"},function(){function e(e,t){if(!e||!t)return!1;for(var n=1;n<t.length;n+=2)if(e===t[n].physicalid)return!0;return!1}return function(t){var n=[],i=t.pathToReparent?"string"==typeof t.pathToReparent?t.pathToReparent:s.getNodeID(t.pathToReparent):null;i&&(Object.keys(ae).forEach((function(t){var r=ae[t],a=!1;e(i,r.itfPath1)&&(r.itfLblInst1=r.itfLblInst1Owner=r.itfLblInst1OwnerID=r.itfLblInst1Path=r.itfLblRef1=r.itfLblRef1Owner=r.itfLblRef1OwnerID=void 0,r.itfLblRef1Path=r.itfLblShape1=r.itfLblShape1Owner=r.itfLblShape1OwnerID=void 0,a=!0),e(i,r.itfPath2)&&(r.itfLblInst2=r.itfLblInst2Owner=r.itfLblInst2OwnerID=r.itfLblInst2Path=r.itfLblRef2=r.itfLblRef2Owner=r.itfLblRef2OwnerID=void 0,r.itfLblRef2Path=r.itfLblShape2=r.itfLblShape2Owner=r.itfLblShape2OwnerID=void 0,a=!0),a&&(Je(t),n.push(r))})),n.forEach((function(e){ae[e.itfuid]=e})),p&&(p.updateInterferences(qe(n)),ot()))}}())),Ce.getApplicativeData().getLoadedItfData=function(){var e,t,n,i={loadMode:"1"===Le?1:0,data:[]},r=Object.keys(he||{});return 1!==r.length||(r=r[0],t=((t=(e=c.getIsr(r))?e.getIsrContexts():[])||[]).map((function(e){return e.prd?e.prd.physicalid:null})).filter((function(e){return e})),n=e?e.getAttributes():{},i.data.push({isrID:r,metricID:[].concat(he[r]),label:n.label,prd:t,type:n.type})),i},Ce.getApplicativeData().removeIsrKeepContext=vt,this.load=Rt,this.clearIsr=St,this.loadApplicativeContext=function(e){return Ve=!0,new Promise((function(n){setTimeout(At,1500),ne||(ne=Tt()),ne.then((()=>{!function(e){var t=e.PIM?e.PIM:e;(t.contextuals?t.contextuals:[]).forEach((function(e){e.itfPath1=[],e.itfPath2=[],e.path1Ids&&e.path1Ids.forEach((function(t){e.itfPath1.push({physicalid:t})})),e.path2Ids&&e.path2Ids.forEach((function(t){e.itfPath2.push({physicalid:t})})),delete e.path1Ids,delete e.path2Ids,Be("onDMUCtxtLoadingSuccess")}))}(_e=t.clone(e.PIM?e.PIM:e));var i=_e.contextuals?_e.contextuals:[];setTimeout((function(){i&&bt(i),Be("onDMUCtxtLoadingSuccess"),n()}),1e3)}))}))},this.cleanApplicativeContext=function(e,t){if((0===Object.keys(he).length||t)&&(p&&at(Xe(),!0),yt(),v&&v.destroy(),v=null,t&&(he={}),(p=null)&&p.removeInterferences(),_e={},ae={},oe={},e)){let e=require("DS/CATWebUXComponents/DMUCommandsManager").getCommandCheckHeader("PIMInteferenceListHdr",Ce.getCommandContext());e&&e.setState(!1)}Ve=!1},this.removeIsr=vt,this.showGUX=function(){Pe=!0,ce&&(Ot(),Lt(),v.show(),ct())},this.hideGUX=function(){Pe&&(Pe=!1,kt())},this.isUIVisible=function(){return Pe},this.applyDisplay=function(e,t,n){-1!==Object.keys(Ne).indexOf(e)&&"number"==typeof t&&(Ne[e]=t?1:0,n||("clash"===e?Object.keys(me).forEach((e=>me[e].children[2].children.forEach((e=>e.children[0].setVisibility(t))))):"contact"===e?Object.keys(me).forEach((e=>me[e].children[1].children.forEach((e=>e.children[0].setVisibility(t))))):"clearance"===e?Object.keys(me).forEach((e=>me[e].children[0].children.forEach((e=>e.children[0].setVisibility(t))))):"quantifiers"===e?Object.keys(me).forEach((e=>me[e].children.forEach((e=>e.children.forEach((e=>e.children[1].setVisibility(t))))))):"zoom"===e?(xe=!0,Qe()):"colorsState"!==e&&"transparencyState"!==e||$e(),Ce.getViewer().render()))},this.exportAsCSV=function(e){return p.exportAsCSV(e)},this.getIsrContext=function(e){return new Promise((function(t){if(Ce.getApplicativeData().getLoadedItfData){var n=Ce.getApplicativeData().getLoadedItfData();if((n=n.data.length?n.data[0]:null)&&n.isrID===e){var i=[];return n.prd&&n.prd.length&&i.push(n.prd[0]),void t(i)}}r._navigateFromIsrToContext({isrID:e,onComplete:function(e){var n,i=JSON.parse(e);i&&i.result&&1===i.result.length?(n=i.result[0].outputs&&i.result[0].outputs.prd,t(n&&n.physicalid?[n.physicalid]:[])):t([])},onFailure:function(){t([])}})}))},this.getLoadedIsr=function(){return Object.keys(he).map((function(e){return{isrID:e,isr:c.getIsr(e)}}))},this.getSelectedMetric=function(){var e=[];return Xe().forEach((function(t){e.push(ae[t])})),e},this.getLengthUnit=function(){return{unit:Z.Length.unit,decimalPlace:Z.Length.decimalPlaceRW,TrailingZero:Ee}},this.getSpecAndContextInfoFromCtrl=function(){let e=Ce.getRoots().map((function(e){return s.getNodeID(e)}))[0];var t=_e.spec;return t.context={prd:{}},t.context.prd=Ue[e],t.isEditable=!Ve,t},this.getIsrComputationStatus=function(){return ve},this.getIsrPreviousComputationConfig=function(){return Se},this.isCSIExecuteUrlAvailable=function(){return je},this.getCSIComputePref=function(){return Te.CSICompute},this.getLoadedData=function(){return t.clone(he,!0)},this.isPIMDataLoaded=function(){return Ve},this.activateUI=function(){ue||(ue=!0,q&&(q.setVisibility(!0),q.setVisibilityFree(!1)),H&&W&&-1===H.getSceneGraphOverrideSetIndex(W)&&H.pushSceneGraphOverrideSet(W),H&&B&&-1===H.getSceneGraphOverrideSetIndex(B)&&H.pushSceneGraphOverrideSet(B),Ce.getViewer().render(),Pe&&re.showGUX())},this.deactivateUI=function(){ue&&(ue=!1,q&&(q.setVisibility(!1),q.setVisibilityFree(!0)),H&&W&&H.removeSceneGraphOverrideSet(W),H&&B&&H.removeSceneGraphOverrideSet(B),Ce.getViewer().render(),kt())},this.isActivatedUI=()=>ue,this.activate=function(e){ce||(ce=!0,setTimeout(At,1500),ne||(ne=Tt()),U=e.mkpCtx||!1,_=null,re.readOnly(e.readOnly),U||r._getIsrTypes().then((function(e){var t=function(e){f.multiTenantMgt([e],s.getRoots(Ce),(function(t){!t.isMultiTenant&&ce&&Rt({isrID:[e.objectId]})}))},n={_PLMPIMMetricReference:function(e){f.multiTenantMgt([e],s.getRoots(Ce),(function(t){!t.isMultiTenant&&ce&&Rt({metricID:[e.objectId]})}))},...x.getDelegation(Ce)};e.forEach((function(e){n["_"+e]=t})),Ce.setLoadingDelegations(n)})),ne.then((()=>{if(re.activateUI(),U||function(){var e,t,n;function i(e){if("number"!=typeof e)return!1;var t,n,i,r,a=p.getNumberOfRows(),o=e<0?a-1:e>=a?0:e;if(o<0||o>=a)return window.console.log("No interference in list for slide show"),!1;p.selectRows([o]);var s=Xe(!0);return 1===s.length&&(i="Undefined"===(n="Undefined"===(t=ae[s[0]]?ae[s[0]]:p?p.getRowInternalData(o):{}).itfUserType?t.itfSystemType:t.itfUserType)?"I_InterferenceCheck":"I_PIM_"+n,r=D.itfAnalysis+": ",r+=D["NotAnalyzed"===t.itfAnalysis?"NotAnalyzed"!==t.itfPrevAnalysis?"itfToReAnalyze":"itfToAnalyze":"itf"+t.itfAnalysis]+"\n",r+=D.itfPrevAnalysis+": "+(D["itf"+t.itfPrevAnalysis]||"-")+"\n",r+=D.itfDescription+": "+(t.itfDescription||"-"),z.displaySlideInformation({primary:(t.itfCtxName?t.itfCtxName:t.itfName)+" ("+(o+1)+" / "+a+") ",secondary:D[n],hidden:r,icon:b.getWebappsAssetUrl("PIMwebUX","icons/32/")+i+".png"})),!0}z||(z=a.getSlideShowController({context:Ce.getFrameWindow(),id:"PIMwebSlideShow",params:{activateRotation:!0}}),De.push(z.subscribe("onPreviousSlideCB",(function(){var e=p.getSelectedRows();i(e&&e.length?e.length>1?e[0]:e[0]-1:0)}))),De.push(z.subscribe("onNextSlideCB",(function(){var e=p.getSelectedRows();i(e&&e.length?e.length>1?e[0]:e[0]+1:0)}))),De.push(z.subscribe("onFirstSlideCB",(function(){i(0)}))),De.push(z.subscribe("onLastSlideCB",(function(){i(p.getNumberOfRows()-1)}))),De.push(z.subscribe("onActiveStateModified",(function(r){if(r.state&&0===Object.keys(he).length)r.onBeginSlideShow(!1);else{r.state&&r.onBeginSlideShow(!0);var a=Ce.getViewer();if(r.state?(e=Ce.isDefaultContextualMenuVisible(),t=Ce.isDefaultContextualBarVisible(),n=Ce.isOpenWithMenuAvailable(),Ce.setDefaultContextualBarVisibility(!1),Ce.setDefaultContextualMenuVisibility(!1),Ce.setOpenWithMenuAvailability(!1)):(Ce.setDefaultContextualBarVisibility(e),Ce.setDefaultContextualMenuVisibility(t),Ce.setOpenWithMenuAvailability(n)),r.state){var o,s=Boolean(v);Pe?v.hide():(Lt(),v.hide(),Ot(),a.render()),a.setPicking({activated:!1,trapSelection:!1}),require("DS/CATWebUXComponents/DMUCommandsManager").getCommandCheckHeader("PIMInteferenceListHdr",Ce.getCommandContext()).disable(),s?i((o=p.getSelectedRows())&&0!==o.length?1===o.length?o[0]:null:0):setTimeout((function(){i((o=p.getSelectedRows())&&0!==o.length?1===o.length?o[0]:null:0)}),100)}else Pe?v.show():(F&&F.hide(),a.render()),v&&v.ensureSelectedLineVisibility(),a.setPicking({activated:!0,trapSelection:!0}),require("DS/CATWebUXComponents/DMUCommandsManager").getCommandCheckHeader("PIMInteferenceListHdr",Ce.getCommandContext()).enable()}}))))}(),p&&p.showSlideColumn(U),e.noStatusBarCmd){var n=l.getLayout_options("frmWindow_opts").contextualMenuContent;Ce.getFrameWindow().getContextualUIManager().register({subscriberId:"PIMweb3DPlayExperience",workbenchName:n.workbenchName,module:n.module,cmdPrefix:"",context:Ce.getCommandContext(),merge:!0,onContextualMenuReady:function(e,t){if(!z||!z.getActiveState()){var i=require("DS/CATWebUXComponents/DMUCommandsManager").getCommand("FlyWalkCmd",Ce.getCommandContext());if((!i||!i.isRunning())&&"number"==typeof t.XmousePosition&&"number"==typeof t.YmousePosition&&Ce.getViewer()){var r=Ce.getViewer().pick({xPix:t.XmousePosition,yPix:t.YmousePosition},"mesh",!0).path,a=[],o=[];if(Ce.getExecutionContext){0===r.length&&(d.isMobile()||o.push("VisuQMCommand"),n.emptiness.ambiences&&n.emptiness.ambiences.length&&o.push(...n.emptiness.ambiences));for(let e=0;e<o.length;e++)a.push({type:"WAfrDefaultHandlerItem",handlerId:o[e]});return a}return 0===r.length&&(d.isMobile()||a.push({name:"PIMwebDisplaySection",line:1,resourceFile:"PIMwebViewController/PIMwebViewController",hdr_list:["VisuQMCommand"]}),n.emptiness.ambiences&&n.emptiness.ambiences.length&&a.push({name:"PIMwebAmbiencesSection",line:1,resourceFile:"PIMwebViewController/PIMwebViewController",hdr_list:n.emptiness.ambiences})),{cmdList:a}}}}})}K||(K=P.givePreferenceManager({context:Ce.getFrameWindow()}))&&(K.addPreferences(I.getPreferencesDefinition()),we.push(K.subscribe("com.ds.mep:onPrefUpdate",(function(e){var n=Le;if(Mt(JSON.parse(e[1].preferences).repositories,!0),n!==Le){var i=t.clone(he),r=Object.keys(i);r&&1===r.length&&0===i[r[0]].length&&(St(),Rt({isrID:r[0]}))}}))))})),Ce.getExecutionContext||(Y=Ce.getFrameWindow().getActionBar().onActionBarReady(Dt)))},this.deactivate=function(){if(ce){ce=!1,U||Ce.setLoadingDelegations({}),U=!1,Re=!1,_=null,xe=!0,re.deactivateUI(),z&&De.forEach(z.unsubscribe,z),De=[],ie&&(A.unreferenceSelectionManager({context:Ce}),ie=null),a.unreferenceSlideShowController({context:Ce.getFrameWindow(),id:"PIMwebSlideShow"}),z=ne=null,K&&(K.removePreferences(["PIMwebPreferences"]),we.forEach(K.unsubscribe,K),we=[],K=null),Ce.getExecutionContext||(Ce.getFrameWindow().getActionBar().removeCallback(Y),Y=null);var e=[];Object.keys(ae).forEach((function(t){ae[t].itfLblSlide&&(ae[t].itfLblSlide=0,e.push(ae[t]))})),p&&(p.updateInterferences(qe(e)),p.showSlideColumn(!1)),Ce.getFrameWindow().getContextualUIManager().unregister("PIMweb3DPlayExperience")}},this.isActivated=()=>ce,this.readOnly=function(e){be!==Boolean(e)&&(be=!be,v&&v.toggleReadOnly())},this.appInitFromTransition=function(t){return new e.Promise((function(e,n){var i,a,o=t.x3dContent,s=Q,l=[];if(t.issues)a=require("DS/PADUtils/PADUtilsServices").getPlatformId(),o=null,l=t.issues.map((function(e){return{issueID:e.physicalid,attachments:e.attachments}}));else if(o&&o.data&&o.data.items&&!s.length)for(i=0;i<o.data.items.length;++i){if("Issue"!==o.data.items[i].objectType){l=[];break}a||(a=o.data.items[i].envId),l.push({issueID:o.data.items[i].objectId})}l.length?require(["DS/IssueServices/services/PlatformServices","DS/IssueAttachmentManager/services/AttachmentServices","DS/IssueServices/Contexts"].concat([]),(function(t,i,s){s.add("widget",window.widget),t.getSecurityContext=function(){return require("DS/PADUtils/PADSettingsMgt").getSetting("pad_security_ctx").replace("ctx::","")},t.getTenant=function(){return a},Promise.all([r._getIsrTypes(),t.initPlatformServices()]).then((function(t){r._sendUsageProbe("loadFromIssue",o?"x3dContent":"transition"),r._sendUsageProbe("loadFromIssue",o?"x3dContent":"transition"+l.length);var a=l.map((function(e){return new Promise((function(n){(e.attachments?new Promise((function(e){e({attachments:undefined})})):i.getDocumentsFrom(e.issueID)).then((function(e){var i={isr:[],metric:[]};(e&&Array.isArray(e.attachments)&&e.attachments||[]).forEach((function(e){e&&("PLMPIMMetricReference"===e.type?i.metric.push(e.id):t[0].indexOf(e.type)>-1&&i.isr.push(e.id))})),n(i)})).catch((function(){n({})}))}))}));Promise.all(a).then((function(t){new Promise((function(e){var n,i,a=[];function s(e){return o?Promise.resolve(e):new Promise((function(t){r._navigateFromIsrToContext({isrID:e,onComplete:function(n){var i=JSON.parse(n),r=[];i&&i.result&&0!==i.result.length?(i.result.forEach((function(t){var n=e.indexOf(t.input_object.physicalid);if(-1!==n){r[n]=e[n];var i=t.outputs.prd&&t.outputs.prd.physicalid;i&&Q&&-1!==Q.indexOf(i)||(r[n]=null)}})),t(r)):t(r)},onFailure:function(){t([])}})}))}!function o(l){l?l.isr&&l.metric&&(l.isr.length||l.metric.length)?!i&&l.isr.length?s(l.isr).then((function(t){t.some((function(e){return n=e})),n?e({isrIDToLoad:n,metricsToLoad:a}):(l.isr=[],o(l))})):l.metric.length?r._navigateFromMetricToIsr({metricIDs:l.metric,onComplete:function(e){var n=JSON.parse(e);if(n&&n.infos&&"OK"===n.infos.status&&n.result)if((n=n.result)&&Array.isArray(n)){for(var r={},l=0;l<n.length;l++)n[l].outputs.isr&&n[l].outputs.isr.length&&(r[n[l].outputs.isr[0].physicalid]||(r[n[l].outputs.isr[0].physicalid]=[]),r[n[l].outputs.isr[0].physicalid].push(n[l].input_object.physicalid));i?(r[i]&&(a=a.concat(r[i])),o(t.shift())):s(Object.keys(r)).then((function(e){e.some((function(e){return i=e})),i&&(a=a.concat(r[i])),o(t.shift())}))}else o(t.shift());else o(t.shift())},onFailure:function(){o(t.shift())}}):o(t.shift()):o(t.shift()):e({isrIDToLoad:n,metricsToLoad:a})}(t.shift())})).then((function(t){var n,i=Object.keys(he);t.isrIDToLoad?(n="_Isr",i.indexOf(t.isrIDToLoad)>-1&&i.forEach(vt),Rt({isrID:t.isrIDToLoad})):t.metricsToLoad&&t.metricsToLoad.length&&(n="_Metric"+t.metricsToLoad.length,i.forEach(vt),Rt({metricID:t.metricsToLoad})),r._sendUsageProbe("loadFromIssue",(o?"x3dContent":"transition")+(n||"_NoData")),e(n)}))})).catch(n)})).catch(n)}),n):e()})).then((function(e){e||t.onNoActionDone()})).catch(t.onNoActionDone).finally((function(){}))},this.subscribe=function(e,t){return e&&t?le.subscribe({event:e},t):null},this.unsubscribe=function(e){if(null!=e)return le.unsubscribe(e)},this.destroy=function(){F&&F.destroy(),F=null,Array.isArray(se)&&se.length>0&&se.forEach((function(e){Ce.unsubscribe(e)})),A.unreferenceSelectionManager({context:Ce}),Ce=he=null},this.applySlide=function(){var e;function n(e){if(ce&&e){if(e.state||!Ve){if(!e.state)return p&&p.selectRowsByUID([]),Pe&&kt(),void e.callback();if(Pe&&v&&v.show(),e.state.context&&e.state.context.data&&e.state.content){if(1!==e.state.context.data.length)return window.console.error("Invalid data stored in slide"),void e.callback();if(void 0===e.state.content.prefs.useStoredResults){let n=e.state.content.prefs.geometries,i=e.state.content.prefs.quantifiers;Number.isInteger(Te.geometries)?J=t.extend(t.clone(Te,!0),e.state.content.prefs):((J=t.clone(Te,!0)).useStoredResults=1,J.geometries={mode:1,clash:n,contact:n,clearance:n},J.quantifiers={minDist:!!i.minDist&&i.minDist}),Ne.clash=Ne.contact=Ne.clearance=0===n?0:1,Ne.quantifiers=!0===i.minDist?1:0}else if((J=t.extend(t.clone(Te,!0),e.state.content.prefs)).useStoredResults=void 0!==e.state.content.prefs.useStoredResults?e.state.content.prefs.useStoredResults:1,!Number.isInteger(Te.geometries)){let t=void 0!==e.state.content.prefs.geometriesDef?e.state.content.prefs.geometriesDef:e.state.content.prefs.geometries;J.geometries={mode:t.mode,clash:t.clash,contact:t.contact,clearance:t.clearance},J.quantifiers={minDist:!!e.state.content.prefs.quantifiers.minDist&&e.state.content.prefs.quantifiers.minDist}}var n=e.state.context.data[0],i=n.isr,r=n.itfs.filter((function(e){return ae[e]}));if(!he[i]&&!Ve)return window.console.error("Isr id stored in slide does not match currently loaded one"),void e.callback();e.state.content.itfs.forEach((function(e){if(r.indexOf(e.id)>-1)if(Array.isArray(e.pos3D)&&3===e.pos3D.length)ae[e.id].pos3D=[].concat(e.pos3D);else if(Array.isArray(e.pos3Drel)&&3===e.pos3Drel.length){let t=ae[e.id];if(t.itfQtfPt1&&t.itfQtfPt2){let n=[.5*(t.itfQtfPt2[0]+t.itfQtfPt1[0]),.5*(t.itfQtfPt2[1]+t.itfQtfPt1[1]),.5*(t.itfQtfPt2[2]+t.itfQtfPt1[2])];"Clash"===t.itfSystemType&&(n=[t.itfQtfPt1[0],t.itfQtfPt1[1],t.itfQtfPt1[2]]),ae[e.id].pos3D=[n[0]+e.pos3Drel[0],n[1]+e.pos3Drel[1],n[2]+e.pos3Drel[2]]}}})),G=e.noCtxChangedEvt,new Promise((function(e){p?e():(Lt(),v.hide(),Ot(),F.hide(),setTimeout(e,100))})).then((function(){if(e.state.content.prefs.displayOptions){let n=t.clone(Ne.zoom,!0);(Ne=t.clone(e.state.content.prefs.displayOptions,!0)).zoom=n}let n=require("DS/CATWebUXComponents/DMUCommandsManager").getCommandCheckHeader("PIMDisplayClashCurveHdr",Ce.getCommandContext());n&&(n.setState(1===Ne.clash),require("DS/CATWebUXComponents/DMUCommandsManager").getCommandCheckHeader("PIMDisplayContactCurveHdr",Ce.getCommandContext()).setState(1===Ne.contact),require("DS/CATWebUXComponents/DMUCommandsManager").getCommandCheckHeader("PIMDisplayClearanceCurveHdr",Ce.getCommandContext()).setState(1===Ne.clearance),require("DS/CATWebUXComponents/DMUCommandsManager").getCommandCheckHeader("PIMDisplayQuantifiersHdr",Ce.getCommandContext()).setState(1===Ne.quantifiers),require("DS/CATWebUXComponents/DMUCommandsManager").getCommandCheckHeader("PIMApplyTransparencyHdr",Ce.getCommandContext()).setState(1===Ne.transparencyState),require("DS/CATWebUXComponents/DMUCommandsManager").getCommandCheckHeader("PIMColorOverloadHdr",Ce.getCommandContext()).setState(1===Ne.colorsState)),p.selectRowsByUID(r)&&Ze(r,J,!0),setTimeout((function(){G=!1,j=!0,J=null,e.callback&&e.callback()}),100)}))}else e.callback()}}else e.callback()}return function(t){clearInterval(e),X?e=setInterval((function(){X||(clearInterval(e),n(t))}),100):n(t)}}(),this.getDataForSlide=function(){let e,n=Xe(),i=Object.keys(he),r=Te,a=t.clone,o=a(Ne);if(e={version:1,context:{data:[]},content:{prefs:{useStoredResults:r.useStoredResults,quantifiers:a(r.quantifiers),geometries:a(r.geometries),displayOptions:a(o)},itfs:[]}},void 0!==e.content.prefs.displayOptions.zoom&&delete e.content.prefs.displayOptions.zoom,i=i.length?i[0]:Ve?"1":null,i||Ve)return e.context.data=[{isr:i,itfs:n.map((function(t){return ae[t].pos3D&&e.content.itfs.push({id:t,pos3D:ae[t].pos3D}),t}))}],e;window.console.error("No loaded isr in session")},this.getContextForMarkup=function(){let e=Object.keys(he);if(e=e.length?e[0]:null,!e)return;let t=c.getIsr(e).getIsrContexts();return t&&1===t.length&&t[0].prd?t[0].prd.physicalid:void 0},this.getTitleForSlide=function(){var e=Xe();if(e&&e.length&&e[0]&&ae[e[0]])return ae[e[0]].itfCtxName},this.updateSlideCount=function({slidesAppData:e}){if(!Ve||0!==Object.keys(he).length){_=e;var t=It();t.length&&p&&p.updateInterferences(qe(t.map((function(e){return ae[e]}))))}},this.getOrderedSlides=function(e,t){if(e&&t)return e.filter((function(e){return e.context.data.some((function(e){return e.itfs.some((function(e){return t.indexOf(e)>-1}))}))}))},this.allowReframe=function(e){return"boolean"==typeof e&&(xe=e),xe},this.getPimTicInfo=function(e,t){var n=Object.keys(he);if(n=1===n.length?n[0]:null)return Vt({cmdType:e,itf:t?Xe():[],isr:n});window.console.error("No  isr in session")},this.onIssueOrTaskSuccess=function(e){!p||"Issue"!==e.type&&"Task"!==e.type||e.attachmentIDs.forEach((function(t){p.onIssueOrTaskSuccess({itfuid:t},e.ticID,e.type)}))},this.getMkpTicInfo=function(e,t,n){var i=Object.keys(he),r={cmdType:e,itf:[]};if(!(i=1===i.length?i[0]:null))return window.console.error("No  isr in session"),void n();t.forEach((function(e){var t=e.state.context;t&&t.data&&1===t.data.length&&t.data[0].isr===i&&t.data[0].itfs.forEach((function(e){-1===r.itf.indexOf(e)&&r.itf.push(e)}))})),r.isr=i,Vt(r).then(n)},this.getIsrPointingToMetric=function(e){var t={};if(!e||!e.length||!Array.isArray(e))return Promise.resolve(t);var n=Object.keys(he),i=[].concat(e);return n.forEach((function(e){var n;for(n=i.length-1;n>=0;--n)he[e].indexOf(i[n])>-1&&(t[i[n]]=[e],i.splice(n,1))})),i.length?new Promise((function(e){r._navigateFromMetricToIsr({metricIDs:i,onComplete:function(n){var r=JSON.parse(n);(r&&r.result||[]).forEach((function(e){-1!==i.indexOf(e.input_object.physicalid)&&(t[e.input_object.physicalid]=e.outputs.isr&&e.outputs.isr[0].physicalid?[e.outputs.isr[0].physicalid]:[])})),e(t)},onFailure:function(){e(t)}})})):Promise.resolve(t)}}}),U=[],_=function(e){var t;return U.some((function(n){return n.pad3DViewer===e&&(t=n)})),t},j=function(e){e&&U.some((function(t,n){var i;return t.itfCtrl===e?(i=!0,t.itfCtrl=null):t.mkpCtrl===e?(i=!0,t.mkpCtrl=null):t.loaderMkp===e&&(i=!0,t.loaderMkp=null),i&&t.ctrl.deactivate(),t.itfCtrl||t.mkpCtrl||t.loaderMkp||(t.ctrl.destroy(),t.pad3DViewer=t.ctrl=null,t=null,U.splice(n,1)),i}))},G=function(e,t,n){t||(t={pad3DViewer:e,ctrl:new F({pad3DViewer:e})},U.push(t));var i=t.ctrl;return"itf"!==n||t.itfCtrl?"mkpUI"!==n||t.mkpCtrl?"loaderMkp"!==n||t.loaderMkp||(t.loaderMkp={load:function(e){if(i&&e&&e.data){var t={loadMode:e.data.loadMode};(e.data.metricID||e.data.isrID)&&(e.data.metricID?t.metricID=e.data.metricID:t.isrID=e.data.isrID,i.cleanApplicativeContext&&i.cleanApplicativeContext(!1,!1,!0),i.load(t))}},getIsrPointingToMetric:function(){return t.loaderMkp&&i?i.getIsrPointingToMetric.apply(null,arguments):void 0},getIsrContext:function(){return t.loaderMkp&&i?i.getIsrContext.apply(null,arguments):void 0},remove:function(){return t.loaderMkp&&i?i.removeIsr():void 0},subscribe:function(){return t.loaderMkp&&i?i.subscribe.apply(null,arguments):void 0},unsubscribe:function(e){return t.loaderMkp&&i?i.unsubscribe(e):void 0},dereference:function(){j(t.loaderMkp)}},Object.freeze(t.loaderMkp)):(t.mkpCtrl={setActiveState:function(e){return t.mkpCtrl&&i?i[e?"activateUI":"deactivateUI"]():void 0},getActiveState:function(){return t.mkpCtrl&&i?i.isActivatedUI():void 0},subscribe:function(){return t.mkpCtrl&&i?i.subscribe.apply(null,arguments):void 0},unsubscribe:function(e){return t.mkpCtrl&&i?i.unsubscribe(e):void 0},initializeAppContainer:function(e){if(!i||!t.mkpCtrl)return null;i.activate({readOnly:!0,mkpCtx:!0}),e.options&&e.options.authoring&&v.getGrantedRoles((function(e){i.readOnly(!e.some((function(e){return("RED"===e.id||"InternalDS"===e.id||"DMRMH"===e.id)&&("InternalDS"===e.id||(e.platforms||[]).indexOf(require("DS/PADUtils/PADUtilsServices").getPlatformId())>-1)})))})),e.onApplicativeControllerInitialized()},onLeavingApp:function(){return t.mkpCtrl&&i?i.deactivate():void 0},getApplicativeContainerID:function(){return"ITF"},displayAppContainerState:function(){return t.mkpCtrl&&i?i.applySlide.apply(null,arguments):void 0},getCurrentAppContainerState:function(){return t.mkpCtrl&&i?i.getDataForSlide():void 0},getCurrentAppContainerStateTitle:function(){return t.mkpCtrl&&i?i.getTitleForSlide():void 0},updateAppContainer:function(e){return t.mkpCtrl&&i?i.updateSlideCount(e):void 0},getOrderedAppContainerStates:function(){return t.mkpCtrl&&i?i.getOrderedSlides.apply(null,arguments):void 0},setMinimalUIFlag:function(e){return t.mkpCtrl&&i?i[e?"hideGUX":"showGUX"]():void 0},getMinimalUIFlag:function(){return t.mkpCtrl&&i?!i.isUIVisible():void 0},setAppViewpointManipFlag:function(e){return t.mkpCtrl&&i?i.allowReframe(Boolean(e)):void 0},getAppViewpointManipFlag:function(){return t.mkpCtrl&&i?i.allowReframe():void 0},getAppContainerTICInfo:function(){return t.mkpCtrl&&i?i.getMkpTicInfo.apply(null,arguments):void 0},dereference:function(){j(t.mkpCtrl)},getContextRootID:function(){return t.mkpCtrl&&i?i.getContextForMarkup():void 0}},Object.freeze(t.mkpCtrl)):(t.itfCtrl={load:function(){return t.itfCtrl&&i?i.load.apply(null,arguments):void 0},activate:function(){return t.itfCtrl&&i?i.activate.apply(null,arguments):void 0},deactivate:function(){return t.itfCtrl&&i?i.deactivate.apply(null,arguments):void 0},showGUX:function(){return t.itfCtrl&&i?i.showGUX.apply(null,arguments):void 0},hideGUX:function(){return t.itfCtrl&&i?i.hideGUX.apply(null,arguments):void 0},clearIsr:function(){return t.itfCtrl&&i?i.clearIsr.apply(null,arguments):void 0},removeIsr:function(){return t.itfCtrl&&i?i.removeIsr.apply(null,arguments):void 0},subscribe:function(){return t.itfCtrl&&i?i.subscribe.apply(null,arguments):void 0},unsubscribe:function(){return t.itfCtrl&&i?i.unsubscribe.apply(null,arguments):void 0},applyDisplay:function(){return t.itfCtrl&&i?i.applyDisplay.apply(null,arguments):void 0},exportAsCSV:function(){return t.itfCtrl&&i?i.exportAsCSV.apply(null,arguments):void 0},getLoadedIsr:function(){return t.itfCtrl&&i?i.getLoadedIsr.apply(null,arguments):void 0},getSelectedMetric:function(){return t.itfCtrl&&i?i.getSelectedMetric.apply(null,arguments):void 0},getLengthUnit:function(){return t.itfCtrl&&i?i.getLengthUnit.apply(null,arguments):void 0},getSpecAndContextInfoFromCtrl:function(){return t.itfCtrl&&i?i.getSpecAndContextInfoFromCtrl.apply(null,arguments):void 0},getIsrComputationStatus:function(){return t.itfCtrl&&i?i.getIsrComputationStatus.apply(null,arguments):void 0},getIsrPreviousComputationConfig:function(){return t.itfCtrl&&i?i.getIsrPreviousComputationConfig.apply(null,arguments):void 0},isCSIExecuteUrlAvailable:function(){return t.itfCtrl&&i?i.isCSIExecuteUrlAvailable.apply(null,arguments):void 0},getCSIComputePref:function(){return t.itfCtrl&&i?i.getCSIComputePref.apply(null,arguments):void 0},getLoadedData:function(){return t.itfCtrl&&i?i.getLoadedData.apply(null,arguments):void 0},isPIMDataLoaded:function(){return t.itfCtrl&&i?i.isPIMDataLoaded.apply(null,arguments):void 0},appInitFromTransition:function(){return t.itfCtrl&&i?i.appInitFromTransition.apply(null,arguments):void 0},getTICInfo:function(){return t.itfCtrl&&i?i.getPimTicInfo.apply(null,arguments):void 0},onIssueOrTaskSuccess:function(){return t.itfCtrl&&i?i.onIssueOrTaskSuccess.apply(null,arguments):void 0},dereference:function(){j(t.itfCtrl)}},Object.freeze(t.itfCtrl)),t},W=Object.create({}),B=Object.getPrototypeOf(W);return B.giveItfCtrl=function(e){var t=_(e?e.pad3DViewer:null);return t&&t.itfCtrl?t.itfCtrl:null},B.getItfCtrl=function(e){if(!e||!e.pad3DViewer)return null;var t=_(e.pad3DViewer);return t&&t.itfCtrl||(t=G(e.pad3DViewer,t,"itf")),t.itfCtrl},B.unreferenceApplicativeController=function(e){if(!e||!e.context)return null;var t=_(e.context);t&&t.mkpCtrl&&t.mkpCtrl.dereference()},B.giveApplicativeController=function(e){if(!e||!e.context)return null;var t=_(e.context);return t&&t.mkpCtrl?t.mkpCtrl:null},B.getApplicativeController=function(e){if(!e||!e.context)return null;var t=_(e.context);return t&&t.mkpCtrl||(t=G(e.context,t,"mkpUI")),t.mkpCtrl},B.giveLoaderForMarkup=function(e){if(!e||!e.context)return null;var t=_(e.context);return t&&t.loaderMkp?t.loaderMkp:null},B.getLoaderForMarkup=function(e){if(!e||!e.context)return null;var t=_(e.context);return t&&t.loaderMkp||(t=G(e.context,t,"loaderMkp")),t.loaderMkp},B.loadApplicativeContext=function(e,t){return new Promise((function(n){var i=_(t);i||(i&&i.itfCtrl||(i=G(t,i,"itf")),i=G(t,i,"mkpUI"));var r=i.ctrl;r&&(r.cleanApplicativeContext(!1,!0),r.loadApplicativeContext(e).then((()=>{r.activate({readOnly:!0,mkpCtx:!0});let e=require("DS/CATWebUXComponents/DMUCommandsManager").getCommandCheckHeader("PIMInteferenceListHdr",t.getCommandContext());e?e.setState(!0):localStorage.setItem("PIMwebItfListVisPref","1"),n()})))}))},B.cleanApplicativeContext=function(){return new Promise((function(e){U.some((function(e,t){e.ctrl.cleanApplicativeContext(!0);let n=e.ctrl.getLoadedData();0===Object.keys(n).length&&(e.ctrl.deactivate(),e.itfCtrl||e.mkpCtrl||e.loaderMkp||(e.ctrl.destroy(),e.ctrl=null,e=null,U.splice(t,1)))})),e()}))},Object.freeze(W)})),define("DS/PIMwebViewController/PIMwebDefaultCmdV2",["DS/PADUtils/PADContext","DS/CATWebUXPreferences/CATWebUXPreferencesManager","DS/CATWebUXSelectionManager/CATWebUXSelectionManager"],(function(e,t,n){"use strict";var i,r;return class{constructor(){i=e.get(),(r=t.givePreferenceManager({context:i.getFrameWindow()}))&&(r.setUnitsPreferencesDisplayFlag(!0),r.setDisplayPreferencesDisplayFlag(!0),r.set3DSelectionPreferencesDisplayFlag(!0),r.setMeasurePreferencesDisplayFlag(!0),r.setClippingPreferencesDisplayFlag(!0),r.setPreferredPreferenceContainersOrder(["PIMwebPrefLoad","PIMwebPrefDisplay","TICSection","MeasurePreferences","SectionPreferences"])),this.beginExecute=function(){if(!i)return;let e=n.giveSelectionManager({context:i});e&&e.setActiveState(!0),i.getViewer().setPicking({trapSelection:!0,trapPrimitive:!1,trapGPU:!0})},this.resumeExecute=function(){if(!i)return;let e=n.giveSelectionManager({context:i});e&&e.setActiveState(!0),i.getViewer().setPicking({trapSelection:!0,trapPrimitive:!1,trapGPU:!0}),this.done()},this.pauseExecute=function(){if(!i)return;let e=n.giveSelectionManager({context:i});e&&e.setActiveState(!1),this.done()},this.destroy=function(){if(!i)return;let e=n.giveSelectionManager({context:i});e&&e.setActiveState(!1),i=r=null}}}})),define("DS/PIMwebViewController/PIMwebLeaderNode",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/CoreEvents/Events","DS/SceneGraphNodes/BillBoardNode3D","DS/Visualization/SceneGraphFactory"],(function(e,t,n,i,r){"use strict";var a=new e.Matrix4;return t.extend({init:function(t){this._parent(),this.name="LeaderNode";var o,s=t.viewpoint,l=s.viewer.canvas,c=new e.Projector,u=t.fixPt,f=t.width,d=t.height,p=new e.Vector3(1,0,0),h=1,m=new e.Vector3(1,0,0),g=1,C=new e.LineBasicMaterial({side:e.DoubleSide,color:t.color,transparent:!0,opacity:1,force:!0,lineWidth:1});C.color=t.color;var I=r.createLineNode({points:[new e.Vector3(0,0,0),new e.Vector3(0,0,1)],material:C}),b=new i({constraintAxis:p,type:"Cylindrical",viewpoint:s});b.setMatrix((new e.Matrix4).setPosition(u)),b.addChild(I),this.addChild(b);var y=r.createLineNode({points:[new e.Vector3(0,0,0),new e.Vector3(0,0,1)],material:C}),P=new i({constraintAxis:m,type:"Cylindrical",viewpoint:s});function v(e){a.makeScale(1,1,h),I.setMatrix(a),b.cbChange(e),a.makeScale(1,1,g),y.setMatrix(a),P.cbChange(e)}function S(e){s===e.viewpoint&&"@onViewpointChange"===e.eventType&&v(e)}function D(e){var t=c.projectVector(e,s.getCamera());return{top:Math.round((0-t.y)*(l.offsetHeight/2)+l.offsetHeight/2),left:Math.round(t.x*(l.offsetWidth/2)+l.offsetWidth/2)}}P.addChild(y),this.addChild(P),this._onLinkedToSceneGraph=function(){o=n.subscribe({event:"/VISU/"},S)},this._onUnlinkedToSceneGraph=function(){n.unsubscribe(o)},this._getDynamicMatrix=function(e,t,n){return v(t),this.getMatrix()},this.updateLeader=function(t){var n,i=Number.MAX_VALUE,r=new e.Vector3(.5*f,.5*d,0),a=[new e.Vector3(.5*f,0,0),new e.Vector3(.5*f,d,0),new e.Vector3(-15,.5*d,0),new e.Vector3(f+15,.5*d,0)];a.forEach((function(e){e.applyMatrix4(t);var r=e.distanceTo(u);r<i&&(i=r,n=e)})),function(t,n){p.subVectors(t,u),h=p.length(),p.normalize(),b.setConstraintAxis(p),P.setMatrix((new e.Matrix4).setPosition(t)),m.subVectors(n,t),g=m.length(),m.normalize(),P.setConstraintAxis(m)}(n,r.applyMatrix4(t)),v({viewpoint:s});var o=D(u.clone());a.push(new e.Vector3(0,.5*d,0).applyMatrix4(t)),a.push(new e.Vector3(f,.5*d,0).applyMatrix4(t)),a.push(new e.Vector3(0,0,0).applyMatrix4(t)),a.push(new e.Vector3(f,0,0).applyMatrix4(t)),a.push(new e.Vector3(f,d,0).applyMatrix4(t)),a.push(new e.Vector3(0,d,0).applyMatrix4(t));var l=a.some((function(e){return e=D(e),Math.abs(e.top-o.top)<=15&&Math.abs(e.left-o.left)<=15}));this.setVisibility(!l),this.setVisibilityFree(l)}}})})),define("DS/PIMwebViewController/PIMwebDefaultCmd",["DS/CATWebUXComponents/DMUCommand","DS/PADUtils/PADContext","DS/CATWebUXPreferences/CATWebUXPreferencesManager","DS/CATWebUXSelectionManager/CATWebUXSelectionManager"],(function(e,t,n,i){"use strict";return e.extend({init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!0});var r=t.get(),a=n.givePreferenceManager({context:r.getFrameWindow()});a&&(a.setUnitsPreferencesDisplayFlag(!0),a.setDisplayPreferencesDisplayFlag(!0),a.set3DSelectionPreferencesDisplayFlag(!0),a.setMeasurePreferencesDisplayFlag(!0),a.setClippingPreferencesDisplayFlag(!0),a.setPreferredPreferenceContainersOrder(["PIMwebPrefLoad","PIMwebPrefDisplay","TICSection","MeasurePreferences","SectionPreferences"])),this.beginExecute=this.resumeExecute=function(){if(!r)return;let e=i.giveSelectionManager({context:r});e&&e.setActiveState(!0),r.getViewer().setPicking({trapSelection:!0,trapPrimitive:!1,trapGPU:!0})},this.endExecute=this.pauseExecute=function(){if(!r)return;let e=i.giveSelectionManager({context:r});e&&e.setActiveState(!1)},this._destroy=function(){r&&(r=a=null,Object.getPrototypeOf(this)._destroy.apply(this,arguments))}}})})),define("DS/PIMwebViewController/PIMwebDisplayCmd",["DS/CATWebUXComponents/DMUCommandCheckHeader","DS/PADUtils/PADContext","DS/PIMwebViewController/PIMwebItfCtrl"],(function(e,t,n){"use strict";let i,r="colorsState";function a(e){let t=localStorage.getItem("PIMwebApplyDisplayPref");t=t?JSON.parse(t):{},t[r]=e?1:0,localStorage.setItem("PIMwebApplyDisplayPref",JSON.stringify(t))}let o=e.extend({init:function(e){this._parent(e);var o=this,s=r,l=1;"PIMDisplayClashCurveHdr"===o._id?(s="clash",l=1):"PIMDisplayContactCurveHdr"===o._id?(s="contact",l=1):"PIMDisplayClearanceCurveHdr"===o._id?(s="clearance",l=1):"PIMDisplayQuantifiersHdr"===o._id?(s="quantifiers",l=1):"PIMZoomOnInterferenceHdr"===o._id?(s="zoom",l=0):"PIMApplyTransparencyHdr"===o._id&&(s="transparencyState",l=0),this.setState(function(){let e=localStorage.getItem("PIMwebApplyDisplayPref");return e=e?JSON.parse(e):{},Boolean(e&&s in e?e[s]:l)}()),i=n.getItfCtrl({pad3DViewer:t.get()}),o&&i.applyDisplay(s,o.getState()?1:0,!0),require(["DS/PIMwebViewModel/PIMwebUtils"],(function(e){e._sendUsageProbe("commandCheck","ColorOverloadOff")})),this.onStateChange((function(){if(!i||!o)return;let e=o.getState();i.applyDisplay(s,e?1:0,!1),a(e)})),this._destroy=function(){i=o=null;var e=Object.getPrototypeOf(this);e._destroy&&e._destroy.apply(this,arguments)}}}),s=function(e,t,s){r=s,i=n.getItfCtrl({pad3DViewer:t.executionContext.getComponent("Viewer")}),i&&o&&(i.applyDisplay(r,1,!1),a(!0),require(["DS/PIMwebViewModel/PIMwebUtils"],(function(e){e._sendUsageProbe("commandCheck","ColorOverloadOff")})),e())},l=function(e,t,s){r=s,i=n.getItfCtrl({pad3DViewer:t.executionContext.getComponent("Viewer")}),i&&o&&(i.applyDisplay(r,0,!1),a(!1),require(["DS/PIMwebViewModel/PIMwebUtils"],(function(e){e._sendUsageProbe("commandCheck","ColorOverloadOff")})),o.clean(),e())};return o.DisplayColor=function(e,t){s(e,t,"colorsState")},o.ApplyTransparency=function(e,t){s(e,t,"transparencyState")},o.DisplayContactCurve=function(e,t){s(e,t,"contact")},o.DisplayClashCurve=function(e,t){s(e,t,"clash")},o.DisplayClearanceCurve=function(e,t){s(e,t,"clearance")},o.DisplayQuantifiers=function(e,t){s(e,t,"quantifiers")},o.ZoomOnInterference=function(e,t){s(e,t,"zoom")},o.ResetColor=function(e,t){l(e,t,"colorsState")},o.ResetTransparency=function(e,t){l(e,t,"transparencyState")},o.ResetContactCurve=function(e,t){l(e,t,"contact")},o.ResetClashCurve=function(e,t){l(e,t,"clash")},o.ResetClearanceCurve=function(e,t){l(e,t,"clearance")},o.ResetQuantifiers=function(e,t){l(e,t,"quantifiers")},o.ZoomOutInterference=function(e,t){l(e,t,"zoom")},o.clean=function(){i=null},o})),define("DS/PIMwebViewController/PIMwebCopyLinkCmd",["DS/CATWebUXCopyLink/CATWebUXCopyLinkCmdAdapt","DS/PIMwebViewController/PIMwebItfCtrl","DS/PADUtils/PADContext"],(function(e,t,n){"use strict";var i;function r(e){var t={data:{items:[]}};if(e&&e.selectedNode){var n={};"PIMwebCopyLinkSelectedItfHdr"===e.cmdType?(i=e.selectedNode.itfCtxName?e.selectedNode.itfCtxName:"",n.objectId=e.selectedNode.mID?e.selectedNode.mID:void 0,n.objectType=e.selectedNode.mType?e.selectedNode.mType:void 0):(i=e.selectedNode.isr&&e.selectedNode.isr.getAttributes()&&e.selectedNode.isr.getAttributes().label?e.selectedNode.isr.getAttributes().label:"",n.objectId=e.selectedNode.isrID?e.selectedNode.isrID:void 0,n.objectType=e.selectedNode.isr&&e.selectedNode.isr.getAttributes()&&e.selectedNode.isr.getAttributes().type?e.selectedNode.isr.getAttributes().type:void 0),t.data.items.push(n)}return t}return e.extend({init:function(e){var a=n.get();e.pad3DViewer=a,this._parent(e),this.getParameters=function(e){var n=t.getItfCtrl({pad3DViewer:a}),o="PIMwebCopyLinkSelectedItfHdr"===e.cmdType?n.getSelectedMetric():n.getLoadedIsr();o&&1===o.length?e.onComplete({content:r({selectedNode:o[0],cmdType:e.cmdType}),label:i}):e.onFailure()}}})})),define("DS/PIMwebViewController/PIMwebExportAsCSVCmd",["DS/CATWebUXComponents/DMUCommand","DS/PADUtils/PADContext","DS/PIMwebViewController/PIMwebItfCtrl","DS/PIMwebViewModel/PIMwebUtils"],(function(e,t,n,i){"use strict";return e.extend({init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1});var r="Visible";let a=e.args;if(a){let t=Object.keys(a),n=Object.values(a);e.arguments=[];for(let i=0;i<t.length-1;i++)e.arguments.push({ID:t[i],Value:n[i]})}e&&e.arguments&&e.arguments[0]&&e.arguments[0]&&(r=e.executionContext?"Type"===e.arguments[0].ID?e.arguments[0].Value:r:e.arguments[0].type);this.beginExecute=function(){var e,a,o,s,l,c=n.getItfCtrl({pad3DViewer:t.get()}),u=c.getLoadedIsr(),f=u[0]&&u[0].isr?u[0].isr.getAttributes().label:"",d=new Date;d=new Date(d.getTime()-60*d.getTimezoneOffset()*1e3).toISOString().slice(0,23),e=c.exportAsCSV({onlySelectedRows:"Selected"===r}),a=f+"_"+d+".csv",o=new Blob([e],{type:"text/csv"}),s=window.URL.createObjectURL(o),(l=document.createElement("a")).style.display="none",l.download=a,l.href=s,document.body.appendChild(l),l.click(),window.URL.revokeObjectURL(s),document.body.removeChild(l),i._sendUsageProbe("command","Visible"===r?"ExportVisibleItfToCSV":"ExportSelectedItfToCSV"),this.done()}}})})),define("DS/PIMwebViewController/PIMwebCreateEditIsrCmd",["UWA/Core","DS/CATWebUXComponents/DMUCommand","DS/PADUtils/PADContext","DS/PIMwebViewController/PIMwebItfCtrl","DS/PIMwebViewModel/PIMwebUtils","DS/PIMwebUX/PIMwebIsrPanelView","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/ComboBox","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/Selection/PSOManager","DS/LevelSelector/LevelSelector","DS/PIMwebUX/PIMwebGroupDefinitionPanelView","DS/PADUtils/PADUtilsServices","DS/PIMwebViewModel/PIMwebIsrMgr","DS/Visualization/PathElement","DS/CoreEvents/Events","i18n!DS/PIMwebViewController/assets/nls/PIMwebCreateEditIsrCmd","css!DS/PIMwebViewController/assets/css/PIMwebIsrCreateEditUpdateCmd"],(function(e,t,n,i,r,a,o,s,l,c,u,f,d,p,h,m,g,C,I,b){"use strict";return t.extend({init:function(t){let y=t;var P,v,S,D,w,x,M=this,A=!0,T=!0,O=!0,L=!0,E=!0;this._parent(t,{mode:"exclusive",isAsynchronous:!0});let R,k="Create",N="I3S",V=!1,F="Blab";var U,_,j,G,W,B,H,X,q,Q,z,K,J,Z,Y=n.get(),$={},ee=[],te=0,ne=null,ie=null,re=null,ae=null,oe=!0,se=!1,le=!1,ce=null;function ue(){u.unsubscribe($.onAdd),u.unsubscribe($.onRemove),u.unsubscribe($.onEmpty),$={}}function fe(){ue(),P&&(I.unsubscribe(G),I.unsubscribe(W),I.unsubscribe(B),I.unsubscribe(H),I.unsubscribe(q),I.unsubscribe(X),I.unsubscribe(Q),Z&&I.unsubscribe(Z),Z=void 0,P.destroy(),P=null,Y&&Y.getFrameWindow()&&Y.getFrameWindow().getContextualUIManager()&&Y.getFrameWindow().getContextualUIManager().activateContextualBarOnLeftClic()),ie&&(ie.destroy(),ie=null),ne&&(ne.destroy(),ne=null),M.done()}function de(){P&&D&&("Create"!==k&&"Edit"!==k||P&&P.buttons&&P.buttons.Ok&&(P.buttons.Ok.disabled=!0),D.disableAllTabs())}function pe(e,t,n,i){var r={context:{}};"Create"===k&&(r.title=e.isrTitle,r.name=e.isrName,Object.keys(R).forEach((function(t){R[t]===e.isrType&&(r.type=t)})),r.description=e.isrDesc,r.context.rootRefID=t.ProductContext.id),r.context.filterID=t.FilterContext&&t.FilterContext.id||"",r.groupMode=t.Config;for(var a=t.Groups.length,o=[],s=0;s<a;s++){var l={};if(l.mode=t.Groups[s].isFilter?"filter":"occurrence","filter"===l.mode)l.content=t.Groups[s].Elements[0].id;else{for(var c=[],u=t.Groups[s].Elements,f=0;f<u.length;f++){for(var d=[],p=u[f].pathElement.externalPath.length,h=u[f].pathElement.externalPath,m=1;m<p;m++)d.push(h[m].modelIdentification);c.push(d)}l.content=c}o.push(l)}r.groups=o,r.appendInterRep=n.CheckInterRep,r.computeInterRep=n.CompBetweenIntermediateReps;var g=[];!0===n.EngineeringCnx.EnggCnxChecked?g.push("on"):g.push("off"),!0===n.EngineeringCnx.CheckNoClash&&g.push("MCX_Check_NoClash"),!0===n.EngineeringCnx.CheckContact&&g.push("MCX_Check_Contact"),!0===n.EngineeringCnx.CheckClearance&&g.push("MCX_Check_Clearance"),!0===n.EngineeringCnx.NoCheck&&g.push("MCX_Ignore"),r.specMCX=g.join("|"),r.specStd="",!0===n.ComputationMode.Clash&&!1===n.ComputationMode.Contact&&!1===n.ComputationMode.Clearance?r.specStd="Clash":!0===n.ComputationMode.Clash&&!0===n.ComputationMode.Contact&&!1===n.ComputationMode.Clearance?r.specStd="ClashContact":!0===n.ComputationMode.Clash&&!0===n.ComputationMode.Contact&&!0===n.ComputationMode.Clearance&&(r.specStd="ClashContactClearance");var C=!0===n.KnowledgeRule.KnwRulesChecked?"on":"off";return n.KnowledgeRule.RuleSet&&(C+="|"+n.KnowledgeRule.RuleSet.id),r.specRule=C,r.electricalItfs=n.CheckElec,r.pathwayItfs=n.checkPathways,r.value_of_clearance=n.ComputationMode.ClearanceValMeter,n.ComputeQuantifer?(r.clashQuantifier=n.ComputeQuantifer.PenVector,r.clearQuantifier=n.ComputeQuantifer.MinDist,r.volumeQuantifier=n.ComputeQuantifer.PenVolume):n.StoredResults&&!se&&function(e,t){t.clashQuantifier=1===e.StoredResults.ClashQuantifier||3===e.StoredResults.ClashQuantifier,t.clearQuantifier=1===e.StoredResults.ClearanceQuantifier,t.volumeQuantifier=2===e.StoredResults.ClashQuantifier||3===e.StoredResults.ClashQuantifier,t.clashGeometryStorage=e.StoredResults.ClashGeometry,t.contactGeometryStorage=e.StoredResults.ContactGeometry,t.clearanceGeometryStorage=e.StoredResults.ClearanceGeometry,t.clearanceAreaGeometryAccuracy=parseFloat(e.StoredResults.Accuracy.valMeter),t.geometryDetail=e.StoredResults.GeometryDetail}(n,r),r.checkFasteners=n.Fasteners.FstChecked,r.checkFasteneds=n.Fasteners.CheckItfWithFastenedParts,r.destroyOutOfScope=n.ReuseExistingItf.DeleteOutOfScopeItf,r.compare=n.ReuseExistingItf.RecomputeOnlyModItf,null!==i&&(r.cadOrigin=i?"ifc":"prd"),r}function he(t){if(le){var n=e.Promise.deferred();g.get3DSpaceUrlAndLoginTicket().then((function(e){var i=F.getCSIComputePref(),a=!(!i||!i.linksAutomaticReroot)&&i.linksAutomaticReroot,o=!(!i||!i.trackPreviousAnalysisStatus)&&i.trackPreviousAnalysisStatus,s=localStorage.getItem("PIMCSIInputI3S")?localStorage.getItem("PIMCSIInputI3S"):"",l=e.securityContext?e.securityContext:"",c=N||"I3S",u=t.isrID+"_"+Date.now().toString()+".txt",f=new Date,d=("0"+f.getUTCDate()).substr(-2)+"/"+("0"+(f.getUTCMonth()+1)).substr(-2)+"/"+("0"+f.getUTCFullYear()).substr(-4)+" "+("0"+f.getUTCHours()).substr(-2)+":"+("0"+f.getUTCMinutes()).substr(-2)+":"+("0"+f.getUTCSeconds()).substr(-2),p={version:1,type:"Parameters",content:{sSecurityCtxt:{type:"string",value:l},sIsrObjId:{type:"string",value:t.isrID},sWApp:{type:"string",value:c},sDbgVal:{type:"string",value:s},bReroot:{type:"bool",value:a},bTrackStat:{type:"bool",value:o},jobConfiguration:{type:"int32",value:parseInt(t.isrJobConfig)},sReportName:{type:"string",value:u},sSubmitDate:{type:"string",value:d}}},h={data:{items:[{objectId:t.isrID,objectType:"SIMItfSimulation"}]}};h.source=window.widget&&window.widget.getValue("x3dAppId")?window.widget.getValue("x3dAppId"):"ENOI3S_AP",h.widgetId=window.widget?window.widget.id:void 0,h.data.items[0].envId=require("DS/PADUtils/PADUtilsServices").getPlatformId(),h.data.items[0].serviceId="3DSpace",h.data.items[0].contextId=require("DS/PADUtils/PADSettingsMgt").getSetting("pad_security_ctx").replace("ctx::","");var m="content:X3DContentId="+encodeURIComponent(JSON.stringify(h)),C=g.getIsr(t.isrID),I=C&&C.getAttributes()&&C.getAttributes().label?C.getAttributes().label:t.isrTitle?t.isrTitle:"",y={data:{title:(b.computeIsrNotifPrefix?b.computeIsrNotifPrefix:"Compute Interference Simulation: ")+I,internalID:t.isrID,jobConfiguration:t.isrJobConfig,reportName:u,inputs:JSON.stringify(p),app:{appContent:m}},onComplete:function(){n.resolve()},onFailure:function(e){n.reject(e)}};g.computeIsr(y),r._sendUsageProbeNew({eventAction:"ComputeIsr",eventLabel:"sWApp",eventValue:c}),r._sendUsageProbeNew({eventAction:"ComputeIsr",eventLabel:"jobConfiguration",eventValue:t.isrJobConfig}),r._sendUsageProbeNew({eventAction:"ComputeIsr",eventLabel:"LinksAutomaticReroot",eventValue:!0===a?"true":"false"}),r._sendUsageProbeNew({eventAction:"ComputeIsr",eventLabel:"TrackPreviousAnalysisStatus",eventValue:!0===o?"true":"false"});var P=0;new Promise((function(e){if(Y&&ce&&(ce.FilterContext||ce.ProductContext)){var t=ce.FilterContext&&void 0!==ce.FilterContext.id?ce.FilterContext.id:ce.ProductContext&&ce.ProductContext.id?ce.ProductContext.id:null;t&&(Y.getController().getRootStats(t)?Y.getController().getRootStats(t).size&&Y.getController().getRootStats(t).size.leaf&&(P=Y.getController().getRootStats(t).size.leaf,e(P)):r.getI3SRootStats({rootPhID:t}).then((function(t){t&&t.results&&t.results.length>=2&&t.results[1].synthesis&&t.results[1].synthesis.value&&(P=t.results[1].synthesis.value),e(P)})))}else e(P)})).then((function(e){r._sendUsageProbeNew({eventAction:"ComputeIsr",eventLabel:"nbParts",eventValue:e})}))}))}}function me(e){return!(!e||!F)&&!("pending"===F.getIsrComputationStatus()||"running"===F.getIsrComputationStatus())}function ge(e){("Create"===k||oe&&"I3D"!==N&&!se)&&P&&P.buttons&&P.buttons.Ok&&(""===e?(P.buttons.Ok.disabled=!0,w=!1,D&&(D.setIsrTabValidity(!1),D.setIsrTitleValidity(!1))):(w=!0,!0===A&&!0===T&&!0===O&&!0===L&&!0===E&&(P.buttons.Ok.disabled=!!le&&("Create"!==k&&!me(le))),D&&(D.setIsrTabValidity(!0),D.setIsrTitleValidity(!0))))}function Ce(e){P&&P.buttons&&P.buttons.Ok&&("Create"!==k&&!oe||"I3D"===N||se?de():"GroupInfoSufficient"===e?(A=!0,!0===w&&!0===T&&!0===O&&!0===L&&!0===E&&(P.buttons.Ok.disabled=!!le&&("Create"!==k&&!me(le))),D&&D.setContextTabValidity(L)):"GroupInfoInsufficient"===e&&(A=!1,P.buttons.Ok.disabled=!0,D&&D.setContextTabValidity(!1)))}function Ie(e){("Create"===k||oe&&"I3D"!==N&&!se)&&P&&P.buttons&&P.buttons.Ok&&("KnwRuleInfoSufficient"===e?(T=!0,!0===w&&!0===A&&!0===O&&!0===L&&!0===E&&(P.buttons.Ok.disabled=!!le&&("Create"!==k&&!me(le))),D&&D.setSpecTabValidity(O&&E)):"KnwRuleInfoInsufficient"===e&&(T=!1,P.buttons.Ok.disabled=!0,D&&D.setSpecTabValidity(!1)))}function be(e){("Create"===k||oe&&"I3D"!==N&&!se)&&P&&P.buttons&&P.buttons.Ok&&("EngCnxInfoSufficient"===e?(O=!0,!0===w&&!0===A&&!0===T&&!0===L&&!0===E&&(P.buttons.Ok.disabled=!!le&&("Create"!==k&&!me(le))),D&&D.setSpecTabValidity(T&&E)):"EngCnxInfoInsufficient"===e&&(O=!1,P.buttons.Ok.disabled=!0,D&&D.setSpecTabValidity(!1)))}function ye(e){("Create"===k||oe&&"I3D"!==N&&!se)&&P&&P.buttons&&P.buttons.Ok&&("SpecInfoSufficient"===e?(E=!0,!0===w&&!0===A&&!0===T&&!0===L&&!0===O&&(P.buttons.Ok.disabled=!!le&&("Create"!==k&&!me(le))),D&&D.setSpecTabValidity(T&&O)):"SpecInfoInsufficient"===e&&(E=!1,P.buttons.Ok.disabled=!0,D&&D.setSpecTabValidity(!1)))}function Pe(e){("Create"===k||oe&&"I3D"!==N&&!se)&&P&&P.buttons&&P.buttons.Ok&&("ContextInfoSufficient"===e?(L=!0,!0===w&&!0===A&&!0===T&&!0===O&&(P.buttons.Ok.disabled=!!le&&("Create"!==k&&!me(le))),D&&D.setContextTabValidity(A)):"ContextInfoInsufficient"===e&&(L=!1,P.buttons.Ok.disabled=!0,D&&D.setContextTabValidity(!1)))}function ve(e){("Create"===k||oe&&"I3D"!==N&&!se)&&P&&P.buttons&&P.buttons.Ok&&""!==e&&D&&D.setIsrTabTitle(e)}function Se(){("Create"!==k&&!oe||"I3D"===N||se)&&de(),I.unsubscribe(z)}function De(){("Create"!==k&&!oe||"I3D"===N||se)&&de(),I.unsubscribe(K)}function we(e){"succeeded"===e||""===e?P&&D&&("Create"!==k&&"Edit"!==k||P&&P.buttons&&P.buttons.Ok&&(P.buttons.Ok.disabled=!1),D.enableAllTabs()):de(),I.unsubscribe(J)}function xe(){return new Promise((function(e){v=new s({emphasize:"primary",label:"Create"!==k?b.editButton:b.createButton,onClick:function(e){e&&e.dsModel&&!e.dsModel.disabled&&(P&&P.buttons&&P.buttons.Ok&&(P.buttons.Ok.disabled=!0),"Create"===k?function(){D.writePIMwebIsrPrefs(),D.setIsrConfiguration(),P&&P.destroy();var e=D.getIsrInfo(),t=D.getContextInfo(),n=D.getSpecInfo();ce=t,new Promise((function(e){if(!1===require("DS/PADUtils/PADSettingsMgt").getSetting("activateSGI"))return e(!1);r._getSGIAvailable({onComplete:function(t){let n=JSON.parse(t);e(n&&n.status&&"alive"===n.status)},onFailure:function(){e()},onTimeout:function(){e()}})})).then((i=>{var r={data:pe(e,t,n,i),onComplete:function(e){Y.displayNotification({msg:b.isrCreated,eventID:"success"}),F.load({isrID:e.isrID,noNotif:!0});var t={};localStorage.getItem("PIMwebIsrSpecs")&&(t=JSON.parse(localStorage.getItem("PIMwebIsrSpecs"))),!!t.ExecuteIsr&&t.ExecuteIsr&&(le?(e.isrJobConfig=D.getIsrJobConfig(),he(e)):Y.displayNotification({msg:b.isrUpdateNotAllowed,eventID:"info"})),Y.getExecutionContext&&fe(),M.cancel()},onFailure:function(){Y.displayNotification({msg:b.isrCreationFailed,eventID:"error"}),Y.getExecutionContext&&fe(),M.cancel()}};g.createIsr(r)}))}():function(){D.writePIMwebIsrPrefs(),D.setIsrConfiguration(),P&&P.destroy();var e={data:pe({isrPid:j},D.getContextInfo(),D.getSpecInfo()),onComplete:function(){Y.displayNotification({msg:b.isrEdited,eventID:"success"});var e={};localStorage.getItem("PIMwebIsrSpecs")&&(e=JSON.parse(localStorage.getItem("PIMwebIsrSpecs"))),!!e.ExecuteIsr&&e.ExecuteIsr&&(le?he({isrID:j,isrJobConfig:D.getIsrJobConfig()}):Y.displayNotification({msg:b.isrUpdateNotAllowed,eventID:"info"})),Y.getExecutionContext&&fe(),M.cancel()},onFailure:function(){Y.displayNotification({msg:b.isrEditionFailed,eventID:"error"}),Y.getExecutionContext&&fe(),M.cancel()}};ae.setSpecAndContextInfo(e),Y.getExecutionContext&&fe(),M.cancel()}())}}),S=new s({label:!oe||"I3D"===N||se?b.closeButton:b.cancelButton,onClick:function(){Y.getExecutionContext&&fe(),M.cancel()}}),(P=new o({modalFlag:!0,ensureHeightDefinitionOnHierarchy:!0,title:"Create"!==k?b.editIsrPanelTitle:b.createIsrPanelTitle,resizableFlag:!0,immersiveFrame:Y.getFrameWindow().getImmersiveFrame(),buttons:!oe||"I3D"===N||se?{Cancel:S}:{Ok:v,Cancel:S},width:530,minWidth:530,height:350,minHeight:350})).elements.container.getElementsByClassName("wux-windows-window-content")[0].setStyles({overflow:"hidden"}),P.elements.container.getElementsByClassName("wux-windows-window-maincontent wux-element-contentbox")[0].setStyles({"margin-bottom":"0px"}),V=!1,"Create"===k&&Object.keys(g.getLoadedIsr()).length&&(V=!0,v.emphasize="medium-attention",v.icon={iconName:"attention",fontIconFamily:WUXManagedFontIcons.Font3DS}),P.addEventListener("close",(function(){Y.getExecutionContext&&fe(),M.cancel()})),G=I.subscribe({event:"onTitleChange"},ge),W=I.subscribe({event:"onGroupInfoChange"},Ce),B=I.subscribe({event:"onKnwInfoChange"},Ie),H=I.subscribe({event:"onEngCnxInfoChange"},be),X=I.subscribe({event:"onSpecInfoChange"},ye),q=I.subscribe({event:"onContextInfoChange"},Pe),Q=I.subscribe({event:"onIsrTypeChange"},ve),z=I.subscribe({event:"onSpecTabComplete"},Se),K=I.subscribe({event:"onContextTabComplete"},De),J=I.subscribe({event:"onEnableContextSpecTab"},we),g.isCSIExecuteUrlAvailable().then((function(t){var n={parent:P,isWeb:!0,type:k,pad3DViewer:Y,ctrl:M,isrAlreadyLoaded:V,lengthUnit:F.getLengthUnit(),isCSICompute:t};e(n)}))}))}function Me(e,t){xe().then((function(n){n.isNonPersistIsr=se,n.isUpdateSimulationAllowed=le,n.configArr=e,n.configArrUnitNls=b.isrConfigGB,n.readOnly=le?"Create"!==k&&!me(le):!oe||"I3D"===N||se,n.specInfo=t[0],n.contextInfo=t[1],D=new a(n),w=A=T=O=L=E=!0}))}function Ae(e){xe().then((function(t){t.isUpdateSimulationAllowed=le,t.configArr=e,t.configArrUnitNls=b.isrConfigGB,le&&(t.readOnly=!1),D=new a(t),P&&P.buttons&&P.buttons.Ok&&(P.buttons.Ok.disabled=!0),D&&(D.setSpecTabValidity(E&&T&&O),D.checkContextInfoValidity()),P&&P.buttons&&P.buttons.Ok&&(P.buttons.Ok.disabled=!0!==E||!0!==w||!0!==A||!0!==T||!0!==L||!0!==O)}))}function Te(e){if(e.error)return Y.displayNotification({msg:e.error,eventID:"error"}),Y.getExecutionContext&&fe(),void M.cancel();var t=new Promise((function(t){(function(e){return new Promise((function(t){e||(Y.getExecutionContext&&fe(),M.cancel());var n={Groups:[]};if(!se){e.context&&e.context.prd||(Y.displayNotification({msg:b.noIsrContext,eventID:"error"}),Y.getExecutionContext&&fe(),M.cancel());var i=e.context.prd;if(n.ProductContext={id:i.physicalid,alias:i.label,type:i.type},e.context.filter){var r=e.context.filter;n.FilterContext={id:r.physicalid,alias:r.label,type:r.type}}}n.Config=e.groupMode,ce=n;var a=e.groups.length;if(0===a)t(n);else{for(var o=[],s=Y.getRootBagPath().getLastElement(),l=0;l<a;l++){var c={};c.isFilter="filter"===e.groups[l].mode,c.Elements=[];var u={};if(c.isFilter)u.id=e.groups[l].content,o.push(u.id),c.Elements.push(u);else for(var f=e.groups[l].content,d=e.groups[l].content.length,p=0;p<d;p++){u={};var h=f[p].length;u.id=f[p][h-1],o.push(u.id);var m=[];m.push(s);for(var g=0;g<h;g++)Y.getController().getNode({id:f[p][g]})&&m.push(Y.getController().getNode({id:f[p][g]}));var I=new C;I.setFromArray(m),u.pathElement=I,c.Elements.push(u)}n.Groups.push(c)}M.getLoadedVPMRefRootData(o).then((function(e){for(var i=e.map((function(e){return e.id})),r=0;r<a;r++)for(var o=n.Groups[r].Elements,s=o.length,l=0;l<s;l++){var c=i.indexOf(o[l].id);-1!==c&&(o[l].label=e[c].alias,o[l].icons=[e[c].icon])}t(n)}))}}))})(e).then((function(e){t(e)}))})),n=new Promise((function(t){(function(e){return new Promise((function(t){var n={ComputationMode:{},Fasteners:{},EngineeringCnx:{},KnowledgeRule:{},ReuseExistingItf:{},ComputeQuantifer:{}};"Clash"===e.specStd?(n.ComputationMode.Clash=!0,n.ComputationMode.Contact=!1,n.ComputationMode.Clearance=!1):"ClashContact"===e.specStd?(n.ComputationMode.Clash=!0,n.ComputationMode.Contact=!0,n.ComputationMode.Clearance=!1):"ClashContactClearance"===e.specStd&&(n.ComputationMode.Clash=!0,n.ComputationMode.Contact=!0,n.ComputationMode.Clearance=!0),n.CheckInterRep=e.appendInterRep,n.CompBetweenIntermediateReps=e.computeInterRep,n.ComputationMode.ClearanceValMeter=parseFloat(e.value_of_clearance),n.Fasteners.FstChecked=e.checkFasteners,n.Fasteners.CheckItfWithFastenedParts=e.checkFasteneds,n.checkElec=!!e.electricalItfs&&e.electricalItfs,n.checkPathways=!!e.pathwayItfs&&e.pathwayItfs;var i=[];i=e.specMCX.split("|"),n.EngineeringCnx.EnggCnxChecked=-1!==i.indexOf("on"),n.EngineeringCnx.CheckNoClash=-1!==i.indexOf("MCX_Check_NoClash"),n.EngineeringCnx.CheckContact=-1!==i.indexOf("MCX_Check_Contact"),n.EngineeringCnx.CheckClearance=-1!==i.indexOf("MCX_Check_Clearance"),n.EngineeringCnx.NoCheck=-1!==i.indexOf("MCX_Ignore"),n.ReuseExistingItf.DeleteOutOfScopeItf=e.destroyOutOfScope,n.ReuseExistingItf.RecomputeOnlyModItf=e.compare,se?(n.ComputeQuantifer.PenVector=e.clashQuantifier,n.ComputeQuantifer.MinDist=e.clearQuantifier,n.ComputeQuantifer.PenVolume=e.volumeQuantifier):(n.StoredResults={},e.clashQuantifier||e.volumeQuantifier?e.clashQuantifier&&!e.volumeQuantifier?n.StoredResults.ClashQuantifier=1:!e.clashQuantifier&&e.volumeQuantifier?n.StoredResults.ClashQuantifier=2:n.StoredResults.ClashQuantifier=3:n.StoredResults.ClashQuantifier=0,n.StoredResults.ClearanceQuantifier=e.clearQuantifier?1:0,n.StoredResults.ClashGeometry=e.clashGeometryStorage,n.StoredResults.ContactGeometry=e.contactGeometryStorage,n.StoredResults.ClearanceGeometry=e.clearanceGeometryStorage,n.StoredResults.Accuracy={},n.StoredResults.Accuracy.valMeter=parseFloat(e.clearanceAreaGeometryAccuracy),n.StoredResults.Accuracy.units="m",n.StoredResults.GeometryDetail=e.geometryDetail);var r=[];r=e.specRule.split("|"),n.KnowledgeRule.KnwRulesChecked=-1!==r.indexOf("on"),r.length>1?(n.KnowledgeRule.RuleSet={},M.getLoadedVPMRefRootData([r[1]]).then((function(e){n.KnowledgeRule.RuleSet=e[0],t(n)}))):t(n)}))})(e).then((function(e){t(e)}))}));Promise.all([n,t]).then((function(t){oe=e.isEditable,g.isUpdateSimulationAllowed().then((function(e){let n=[];(le=e)?g.getMaxTokensForIsrCompute({onComplete:function(e){if(e)if(0===e.countAll)n.push(8..toString());else{var i=8*((e.countAll>15?15:e.countAll)+1),r=0;for(i=i>=128?128:i;i>=8<<r;)n.push((8<<r).toString()),r++}Me(n,t)}}):Me(n,t)}))}))}function Oe(){($={}).onAdd=u.onAdd(_),$.onRemove=u.onRemove(_),$.onEmpty=u.onEmpty(_)}function Le(e){if(e&&0!==e.length){var t,n=e[0].pathElement;return(t=n,new Promise((function(e){if(!1===require("DS/PADUtils/PADSettingsMgt").getSetting("activateSGI"))return e(t);for(var n=[],i=[],a=t.externalPath.length,o=t.externalPath,s=1;s<a;s++)n.push(o[s].modelIdentification);r._getLabelAndIconAttr({ids:n,onComplete:function(t,r){if(JSON.parse(r).results.forEach((function(e){e.attributes&&e.attributes.forEach((function(e){"resourceid"===e.name&&i.push(e.value)}))})),i.length===n.length)return e(t);for(var a=t.externalPath.length,o=t.externalPath,s=new C,l=0;l<a;l++){let e=o[l].modelIdentification;if(null!==e&&!i.find((t=>t===e)))break;s.addElement(t.getElement(l))}return e(s)}.bind(this,t),onFailure:function(){return e(t)}})}))).then((function(t){var i=e[0].event;if(i){n.isEqual(t)||(f.empty(),f.add({pathElement:t,event:i})),M._levelSelectorContext=t.clone();var r=[],a={positionX:i.currentPosition.x,positionY:i.currentPosition.y,uiFrame:Y.getFrameWindow().getUIFrame(),getLevels:function(e){for(var n=[],a=t;a;){if(c.isPLMNode(a.externalPath[a.externalPath.length-1])&&c.isReference(a.externalPath[a.externalPath.length-1])){var o=a.getLastElement(!0),s=c.getBIColor(o);null!==s?r.push({pathElement:a,canvasColor:s,event:i}):r.push({pathElement:a,event:i}),n.push(c.getNodeID(a.getLastElement(!0)))}a=a.getParentPath()}var l=["ds6w:label","type_icon_url"],u="";Y.getController().isColorizeActivated()&&Y.getController().isStandalone()&&(u=Y.getController().getBIColorMap().predicate,l.push(u)),Y.getController().getAttributes({ids:n,attributes:l,callbacks:{onComplete:function(t,n){for(var i=0;i<r.length;++i){var a=r[i],o=c.getNodeID(a.pathElement.getLastElement(!0));if(n[o]&&(a.name=n[o]["ds6w:label"],a.icon=n[o].type_icon_url,Y.getController().isColorizeActivated()&&Y.getController().isStandalone()&&""!==t)){var s=n[o][t];a.canvasColor=Y.getController().getColorValueForPredicate(s)}}e(r)}.bind(this,u),onFailure:function(){e(r)}}});for(var f=0;f<r.length;++f){var d=r[f],p=c.getNodeID(d.pathElement.getLastElement(!0));U===p&&(d.selection="notSelectable")}return r},onHover:function(e){f.empty(),d.empty(),e.event=i,f.add(e)},onLeave:function(){f.empty(),d.empty(),f.add({pathElement:M._levelSelectorContext,event:i})},onSelect:function(e){ue(),f.empty(),u.empty(),e.event=i,f.add(e),u.add(e),p.destroyView();var t,n,a=r.filter((function(t){return t.pathElement===e.pathElement})),o=!1;if(re){var s=re.model.getRoots();for(t=0;t<s.length;t++)if(e.pathElement.isEqual(s[t].options.pathElement)){Y.displayNotification({msg:b.isrCtxGroupElementAlreadyAdded,eventID:"info"}),o=!0;break}}if(!o)for(n=0;n<ee.length;n++)if(e.pathElement.isEqual(ee[n].pathElement)){Y.displayNotification({msg:b.isrCtxGroupElementAlreadyAdded,eventID:"info"}),o=!0;break}o||(ee.push({id:c.getNodeID(e.pathElement.getLastElement(!0)),label:a[0].name,icons:[a[0].icon],pathElement:e.pathElement}),te++,ie.setEditorText(te>0?te.toString().concat(" ",te>1?b.isrCtxGroupProductsSelected:b.isrCtxGroupProductSelected):b.isrCtxGroupNoSelection)),Oe()}};p.createView(a)}}))}}function Ee(e){var t=new s({emphasize:"primary",label:b.okButton,onClick:e.onOK}),n=new s({label:b.cancelButton,onClick:e.onCancel}),i=new o({modalFlag:!1,ensureHeightDefinitionOnHierarchy:!0,title:b.groupDefinitionPanelTitle,resizableFlag:!0,immersiveFrame:Y.getFrameWindow().getImmersiveFrame(),position:{my:"down right",at:"down right"},buttons:{Ok:t,Cancel:n},width:300,minWidth:300,height:100});return i.addEventListener("close",e.onClose),i}function Re(){p.destroyView(),ne.destroy(),ne=null,U=null,f.empty(),u.empty(),ue(),P.show()}function ke(){for(var e=0;e<ee.length;e++)D.createGroupViewWithInfo([ee[e]]);Re()}function Ne(){D.addInfoInGroup(re,ee),Re()}this.beginExecute=function(){Y.getExecutionContext&&(Z=I.subscribe({event:M.getId()+"/DISABLED"},fe)),F=i.getItfCtrl({pad3DViewer:Y}),Y.getExecutionContext?k=y.args.type:y&&y.arguments&&y.arguments[0]&&y.arguments[0].type&&(k=y.arguments[0].type),"Create"!==k&&(N=Y.getExecutionContext?Y.getExecutionContext().getComponent("Widget").getSessionWidget().data.appId.includes("I3D")?"I3D":"I3S":y.arguments[0].app),r._sendUsageProbe("command","Create"===k?"CreateItf":"Edit"===k?"EditItf":"UpdateItf"),A=T=O=L=E=!0,se=F.isPIMDataLoaded(),"Update"===k?g.isUpdateSimulationAllowed().then((function(t){var n,i;le=t,t&&(n=g.getLoadedIsr(),i=Object.keys(n)[0],g.getMaxTokensForIsrCompute({onComplete:function(t){if(t)if(0===t.countAll)he({isrID:i,isrJobConfig:"8"}),M.cancel();else if(t.countAll>0){let u=[];var n=8*((t.countAll>15?15:t.countAll)+1),r=0;for(n=n>=128?128:n;n>=8<<r;)u.push((8<<r).toString()),r++;let f=e.createElement("div",{class:"pimCsiCompute"}),d=b.isrUpdateSimuConfig;e.createElement("label",{text:d,styles:{"margin-bottom":"0px",padding:"25px 10px"}}).inject(f);var a=""===F.getIsrPreviousComputationConfig()?"8":F.getIsrPreviousComputationConfig();let p=u.map((function(e){return e.concat(b.isrConfigGB)}));(x=new l({elementsList:p,enableSearchFlag:!1,value:a.concat(b.isrConfigGB),displayStyle:"normal"})).inject(f),x.elements.container.setStyles({width:"5%"});var c=new o({immersiveFrame:Y.getFrameWindow().getImmersiveFrame(),modalFlag:!0,title:b.isrUpdateSimulation,content:f,activeFlag:!1,buttons:{Ok:new s({label:b.okButton,onClick:function(){c.destroy(),he({isrID:i,isrJobConfig:p[x.selectedIndex].toString().replace(b.isrConfigGB,"")}),M.cancel()}}),Cancel:new s({label:b.cancelButton,onClick:function(){c.destroy(),M.cancel()}})}});c.addEventListener("close",(function(){M.cancel()}))}}}))})):function(){if("Create"!==k){var e={};if(se)F&&(e=F.getSpecAndContextInfoFromCtrl()),Te(e);else{var t=g.getLoadedIsr();if(!Object.keys(g.getLoadedIsr()).length)return Y.displayNotification({msg:b.noIsrInSession,eventID:"info"}),Y.getExecutionContext&&fe(),M.cancel();if(Object.keys(g.getLoadedIsr()).length>1)return Y.displayNotification({msg:b.onlySingleIsrInSessionAllowed,eventID:"info"}),Y.getExecutionContext&&fe(),M.cancel();if(!(j=Object.keys(t)[0]))return Y.getExecutionContext&&fe(),M.cancel();if("Update"!==k){var n={pid:j,onComplete:function(e){Te(e)},onFailure:function(e){Y.displayNotification({msg:b["No stream retrieved"===e?"isrCannotAccessIsrDefinition":"isrInfoRetrievalFailed"],eventID:"error"}),Y.getExecutionContext&&fe(),M.cancel()}};(ae=g.getIsr(j))&&ae.getSpecAndContextInfo(n)}else{var i=F.getIsrPreviousComputationConfig();he({isrID:j,isrJobConfig:i}),M.cancel()}}}else w=!1,g.isUpdateSimulationAllowed().then((function(e){let t=[];(le=e)?g.getMaxTokensForIsrCompute({onComplete:function(e){if(0===e.countAll)t.push(8..toString());else{var n=8*((e.countAll>15?15:e.countAll)+1),i=0;for(n=n>=128?128:n;n>=8<<i;)t.push((8<<i).toString()),i++}Ae(t)}}):Ae(t)}));"Create"===k||oe&&"I3D"!==N&&!se||de()}()},this.pauseExecute=function(){this.cancel()},this.cancelExecute=function(){fe()},this._destroy=function(){F=null,Y&&Y.getFrameWindow()&&Y.getFrameWindow().getContextualUIManager()&&Y.getFrameWindow().getContextualUIManager().activateContextualBarOnLeftClic(),M=null,Y=null;var e=Object.getPrototypeOf(this);e._destroy&&e._destroy.apply(this,arguments)},this.searchProducts=function(){return new Promise((function(e){require("DS/PADServices/views/LandingPage").launchSearch({title:b.isrProductSearchPageTitle,precondition:'flattenedtaxonomies:"types/VPMReference"',showApplyButton:!0,ok:function(t){e(t.map((function(e){return{id:e.resourceid,type:e["ds6w:type_value"],alias:e["ds6w:label"]}})))}})}))},this.getLoadedRoots=function(){return Y.getRoots().map((function(e){return c.getNodeID(e)}))},this.getAddedVPMRefRoots=function(){return new Promise((function(e){var t=[];let n=[],i=Y.getRoots();i.forEach((function(e){var t=c.getNodeType(e);n.push(r._checkParentType({typeToCheck:t,parentType:"VPMReference"}))})),Promise.all(n).then((function(n){i.forEach((function(e,i){n[i]&&t.push(c.getNodeID(e))})),e(t)}))}))},this.getLoadedVPMRefRootData=function(e){return new Promise((function(t){for(var n={},i=[].concat(e),r=Y.getController(),a=0;a<e.length;a++){var o=r.isFiltered(e[a]);o&&o.hasFilter&&o.filterId&&(n[e[a]]={filterId:o.filterId},i.push(o.filterId))}var s=[];r.getAttributes({ids:i,attributes:["ds6w:label","ds6w:type","type_icon_url","ds6w:identifier","ds6wg:revision"],callbacks:{onComplete:function(i){for(var r=0;r<e.length;r++)if(i[e[r]]){var a=i[e[r]]["ds6w:label"],o=i[e[r]]["ds6w:type"],l=i[e[r]]["ds6w:identifier"],c=i[e[r]]["ds6wg:revision"],u=i[e[r]].type_icon_url,f={id:e[r],type:o,alias:a,icon:u,identifier:l,revision:c};n[e[r]]&&n[e[r]].filterId&&i[n[e[r]].filterId]&&(f.filterId=n[e[r]].filterId,f.filterAlias=i[f.filterId]["ds6w:label"],f.filterType=i[f.filterId]["ds6w:type"],f.filterIcon=i[f.filterId].type_icon_url),s.push(f)}t(s)},onFailure:function(){Y.displayNotification({msg:b.attrRetrievalFailed,eventID:"info"}),t(s)}}})}))},this.getIsrPreviousComputationConfig=function(){var e="8";return F&&(e=F.getIsrPreviousComputationConfig()),e},this.searchFilters=function(e){return new Promise((function(t){require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/ENONextGenFilterUX/utils/FilterPersistencyServices"],(function(n,i){n.getPlatformServices({onComplete:function(){i.retrieveAllFilters([e]).then((function(e){if(e.length){var n=[];e.forEach((function(e){n.push(e.filterId)}));var i=n.join(" OR physicalid:");i="(physicalid:"+i+")",m.inAppsSearch({precond:i,title:b.isrFilterSearchPageTitle,callback:function(e){t(e.selected_objects.map((function(e){return{id:e.resourceid,type:e["ds6w:type_value"],alias:e["ds6w:label"],icons:[e.type_icon_url]}})))},cancel:function(){t()}})}else Y.displayNotification({msg:b.noFilterFound,eventID:"info"}),t()}))},onFailure:function(){t()}})}))}))},_=function(){var e=u.get();if(e.length){for(var t=!0,n=0;n<e.length;n++)if(e[n].pathElement.externalPath[1].modelIdentification!==U){t=!1,Y.displayNotification({msg:b.noContextMatch,eventID:"info"});break}t&&Le(e)}else p.destroyView()},this.addMoreGroups=function(e){!function(e){U=e,ee=[],re=null,te=0,P.hide();var t={onOK:ke,onCancel:Re,onClose:Re};ne&&(ne.destroy(),ne=null);var n={parent:ne=Ee(t),editorText:b.isrCtxGroupNoSelection};ie=new h(n),ne.show(),Y.getFrameWindow().getContextualUIManager().deactivateContextualBarOnLeftClic(),Oe()}(e)},this.addElementsInGroup=function(e,t){!function(e,t){U=e,re=t,ee=[],te=t.isFilter?0:t.model.getRoots().length,P.hide();var n={onOK:Ne,onCancel:Re,onClose:Re};ne&&(ne.destroy(),ne=null),ne=Ee(n);var i=t.isFilter?b.isrCtxGroupFilterSelected:te>0?te.toString().concat(" ",te>1?b.isrCtxGroupProductsSelected:b.isrCtxGroupProductSelected):b.isrCtxGroupNoSelection;ie=new h({parent:ne,editorText:i}),ne.show(),Y.getFrameWindow().getContextualUIManager().deactivateContextualBarOnLeftClic(),Oe()}(e,t)},this.onPostRowSelect=function(e){for(var t=0;t<e.length;t++)e[t]._options&&e[t]._options.pathElement&&(f.add({pathElement:e[t]._options.pathElement}),u.add({pathElement:e[t]._options.pathElement}))},this.onPostRowUnselect=function(e){for(var t=0;t<e.length;t++)e[t]._options&&e[t]._options.pathElement&&(f.remove({pathElement:e[t]._options.pathElement}),u.remove({pathElement:e[t]._options.pathElement}))},this.getCreationParams=function(){return new Promise((function(e){g.getCreationParams({type:"SIMItfSimulation",onComplete:function(t){e(t)},onFailure:function(){Y.displayNotification({msg:b.isrCreateParamInfoRetrievalFailed,eventID:"error"}),e()}})}))},this.setAllNlsType=function(e){R=e},this.areAllTabsDisabled=function(){if(D)return D.areAllTabsDisabled()}}})})),define("DS/PIMwebViewController/PIMwebGenerateTICCmd",["DS/CATWebUXTIC/CATWebUXTICCmdAdapt","DS/CATWebUXComponents/DMUCommandsManager","DS/PADUtils/PADContext","DS/PIMwebViewController/PIMwebItfCtrl"],(function(e,t,n,i){"use strict";var r=e.extend({init:function(e){var r=[],a=n.get();e.pad3DViewer=a,this._parent(e);var o=i.getItfCtrl({pad3DViewer:a});this.getParameters=function(e){var n=o.getLoadedIsr();if(0!==n.length)if(n.length>1)e.onFailure("More than one isr. Specifications to rework!");else{var i=t.getCommandCheckHeader("PIMInteferenceListHdr",a.getCommandContext()),r=t.getCommandCheckHeader("CATWebUXSlideShowHdr",a.getCommandContext());o.getTICInfo(e.cmdType,i&&i.getState()||r&&r.getState()).then((function(t){t.onComplete=function(e){o.onIssueOrTaskSuccess(e)},t?e.onComplete(t):e.onCancel()}))}else e.onFailure("No isr. Execution of command must not be possible")},this._destroy=function(){r.forEach(o.unsubscribe,o),o=r=null;var e=Object.getPrototypeOf(this);e._destroy&&e._destroy.apply(this,arguments)}}});return r})),define("DS/PIMwebViewController/PIMwebRightSidePanelCmdV2",["DS/InformationWebAfrCmd/cmd/InformationCmd","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/utils/EditPropUtils","DS/PADUtils/PADSettingsMgt","DS/PIMwebViewController/PIMwebItfCtrl","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/Selection/CSOManager","DS/Utilities/Utils","i18n!DS/PADUtils/assets/nls/PADUtils.json"].concat([]),(function(e,t,n,i,r,a,o,s,l){"use strict";let c,u,f,d,p,h=[],m=[],g=!1;function C(e){let t=!1,n=e.pathElement;for(;n&&!a.isPLMNode(n.getLastElement(!0));)n=n.getParentPath();if(n){const e=n.getLastElement(!0);t=a.isInternalJSONObject(e)}return t}function I(){let e,t,n=o.get(),i=n.length&&n.some((function(e){return a.isAModelPath(e.pathElement)}));if(u&&u.getApplicativeData().getLoadedItfData&&(e=u.getApplicativeData().getLoadedItfData(),e=e&&e.data&&e.data[0]),n.length)for(let e=n[0].pathElement.externalPath.length-1;e>=0;--e)if(t=n[0].pathElement.externalPath[e],!t||a.isPLMNode(t))return n.map((({pathElement:e})=>({getID:()=>e?a.getNodeID(e.getLastElement(!0)):""})));return i?n:e?[{getID:function(){return e&&e.isrID?e.isrID:""},getType:function(){return e&&e.isrID?e.type:""},getRelationID:function(){return e&&e.isrID?void 0:""}}]:[]}function b(){return{SecurityContext:i.getSetting("pad_security_ctx"),tenant:i.getSetting("x3dPlatformId")}}function y(e,n){let i=I();if(i=i.filter((e=>!("function"==typeof e.getNodeSource&&1===e.getNodeSource()))),i.length)for(let r=0;r<i.length;++r){const a=i[r];if(!0===C(a)){const t=e.getPropertiesFacet();for(let e=0;e<t.length;++e){const i=t[e];if(i.facet){if(i.facet.text||(i.facet.text=l[`${i.facet.name}_cmd_title`]),i.actions&&i.actions.length>0)for(let e=0;e<i.actions.length;++e)i.actions[e].text=l[i.facet.name+i.actions[e].text];n.removeFacets([i.facet.name])}}}else if(!0!==C(a)){n.removeFacets([t.FACET_VIEWS]),n.removeFacets([t.FACET_DERIVEDOUTPUT]);const i=e.getPropertiesFacet();for(let e=0;e<i.length;++e){const t=i[e];if(t.facet){if(t.facet.text||(t.facet.text=l[`${t.facet.name}_cmd_title`]),t.actions&&t.actions.length>0)for(let e=0;e<t.actions.length;++e)t.actions[e].text=l[t.facet.name+t.actions[e].text];n.addFacets([t])}}}}}function P(){let e=s.debounce((()=>{let e=I();if(0!==e.length){y(u,c);let t=[];e.forEach((e=>{let i=new Promise((t=>{let i={ID:"",relation:"",type:"",i3dx:"",getID:function(){return this.ID},getRelationID:function(){return this.relation},getType:function(){return this.type},getI3DX:function(){return e.options&&e.options.grid?e.getI3DX():function(e){let t,n=e.pathElement;for(;n&&!a.isPLMNode(n.getLastElement(!0))&&!a.isTileSetNode(n.getLastElement(!0));)n=n.getParentPath();if(n){const e=n.getLastElement(!0);t=a.getNodeI3DX(e)}return t}(e)}};"function"!=typeof e.getID&&(e.getID=function(){return function(e,t){let n,i=t.pathElement;for(;i&&!a.isPLMNode(i.getLastElement(!0))&&!a.isTileSetNode(i.getLastElement(!0));)i=i.getParentPath();if(!i&&e.isSelectiveLoadingActivated())n=e.getController().getOOCSelectedReferenceID();else{let e=i.getLastElement(!0);n=a.getNodeID(e)}return n}(u,e)}),"function"!=typeof e.getRelationID&&(e.getRelationID=function(){return function(e){let t,n=e.pathElement;for(;n&&!a.isPLMNode(n.getLastElement(!0))&&!a.isTileSetNode(n.getLastElement(!0));)n=n.getParentPath();if(n){let e=n.getLastElement(!0);if(a.isInstance(e))t=a.getNodeID(e);else{let e=n.getParentPath().getLastElement(!0);t=a.getNodeID(e)}}return t}(e)}),void 0===e.type&&(e.options&&e.options.type?e.type=e.options.type:e.type=function(e){let t,n=e.pathElement;for(;n&&!a.isPLMNode(n.getLastElement(!0))&&!a.isTileSetNode(n.getLastElement(!0));)n=n.getParentPath();if(n){let e=n.getLastElement(!0);t=a.getNodeType(e)}return t}(e)),i.ID=e.getID(),!0===C(e)?i.relation=void 0:i.relation=e.getRelationID(),i.type=e.type,t(n.getModelFromSelectedNode(i))}));t.push(i)})),Promise.all(t).then((e=>{c.initDatas(e)})).catch((e=>new Error(e)))}else c.initDatas([])}),100);h.push(o.onPostAdd(e)),h.push(o.onPostRemove(e)),h.push(o.onEmpty(e))}let v={};return v.showPanel=function(n,i){f=i.executionContext,u=f.getComponent("Viewer"),d=f.getComponent("AFR_ModelEvents"),p=d.subscribe({event:"onWillLoadApp"},(()=>{v.hidePanel(n,i)})),g=!1,c=new e({executionContext:i.executionContext,args:{appId:"undefined"!=typeof widget&&null!==widget?widget.getValue("appId"):"",className:"enxpropertiestab",multiselection:t.MULTISEL_NO,setEditButton:!1,readOnly:!0,typeOfDisplay:t.ALL,selectionType:t.NO_SELECTION,actions:[{name:"action_close_panel",text:"SUPER TEST",icon:"close",handler:()=>{g||(g=!0,v.hidePanel())}}],events:{onCancel:()=>{i.executionContext.getComponent(WAfrStandardComponentKey.HandlerComponent).setCheckState({id:"PIMRightSidePanel",state:!1})}},context:{getSelectedNodes:I,getSecurityContext:b}}}),c.done=n,function(e,n){n.removeFacets([t.FACET_VIEWS]),n.removeFacets([t.FACET_DERIVEDOUTPUT]);let i=e.getPropertiesFacet(),r=[];for(let e=0;e<i.length;++e){let t=new Promise((t=>{const r=i[e];if(r.facet){if(r.facet.text||(r.facet.text=l[`${r.facet.name}_cmd_title`]),r.actions&&r.actions.length>0)for(let e=0;e<r.actions.length;++e)r.actions[e].text=l[r.facet.name+r.actions[e].text];n.addFacets([r])}t()}));r.push(t)}}(u,c),y(u,c),P();let a=r.giveItfCtrl({pad3DViewer:u});m.push(a.subscribe("onIsrAdded",y)),m.push(a.subscribe("onItfAdded",y)),m.push(a.subscribe("onIsrRemoved",y)),c.beginExecute()},v.hidePanel=function(e,t){f=t.executionContext,u=f.getComponent("Viewer"),d=f.getComponent("AFR_ModelEvents"),c.done=e,g=!0,h.forEach(o.unsubscribe,o),h=[];let n=r.giveItfCtrl({pad3DViewer:u});n&&m.forEach(n.unsubscribe,n),m=[],n=null,p&&d.unsubscribe(p),p=void 0,c&&c.closePanel()},v})),define("DS/PIMwebViewController/PIMwebRightSidePanelCmd",["DS/ENOPAD3DViewer/commands/PAD3DViewerRightSidePanel","DS/PADUtils/PADContext","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/Selection/CSOManager","DS/PIMwebViewController/PIMwebItfCtrl"],(function(e,t,n,i,r){"use strict";return e.extend({init:function(e){var a,o,s,l=[],c=[],u=t.get(),f=r.getItfCtrl({pad3DViewer:u}),d={get:function(){var e,t=i.get();return t.length&&t.some((function(e){return n.isAModelPath(e.pathElement)}))?t:l.length?(u&&u.getApplicativeData().getLoadedItfData&&(e=(e=u.getApplicativeData().getLoadedItfData())&&e.data),e||[]):[]},onPostAdd:function(e){return a=e,1},onPostRemove:function(e){return o=e,2},onEmpty:function(e){return s=e,3},unsubscribe:function(e){1===e?a=null:2===e?o=null:3===e&&(s=null)}};function p(e){1===e&&a?a():2===e&&o?o():3===e&&s&&s()}l.push(i.onPostAdd(p.bind(this,1))),l.push(i.onPostRemove(p.bind(this,2))),l.push(i.onEmpty(p.bind(this,3))),c.push(f.subscribe("onIsrAdded",p.bind(this,1))),c.push(f.subscribe("onItfAdded",p.bind(this,1))),c.push(f.subscribe("onIsrRemoved",p.bind(this,1))),this.getXSO=function(){return d},this.getID=function(e){return e&&e.isrID?e.isrID:Object.getPrototypeOf(this).getID.apply(this,arguments)},this.getRelationID=function(e){return e&&e.isrID?void 0:Object.getPrototypeOf(this).getRelationID.apply(this,arguments)},this.getType=function(e){return e&&e.isrID?e.type:Object.getPrototypeOf(this).getType.apply(this,arguments)},this.destroy=function(){p(3),l.forEach(i.unsubscribe,i),l=[],f&&c.forEach(f.unsubscribe,f),c=[],f=null,a=o=s=null,Object.getPrototypeOf(this).destroy.apply(this,arguments)},this._parent(e),p(1)},isNodeValid:function(e){var t=this._parent(e);return!t&&e&&e.isrID&&(t=!0),t},getServiceId:function(e){var t="";return e&&!e.isrID&&(t=this._parent(e)),t}})}));