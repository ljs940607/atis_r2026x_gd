define("DS/IPTableMePreferences/views/Mask",["i18n!DS/IPTableMePreferences/assets/nls/IPTableMePreferences","DS/Controls/ModalContainer","DS/Controls/Loader"],(function(e,t,o){"use strict";function i(){return"object"==typeof i.instance?i.instance:(i.instance=this,this.elements={},this.currentTarget=null,this)}return i.prototype.mask=function(i){null!==this.currentTarget&&this.currentTarget!==i&&this.unmask(this.currentTarget),this.currentTarget=i,void 0===this.elements.loader&&(this.elements.loader=new o),this.elements.loader.on(e.loading.default),this.elements.loader.update(0),t.createModal(i,this.elements.loader.getContent())},i.prototype.unmask=function(e){this.currentTarget===e&&(this.currentTarget=null,this.elements.loader.update(0),this.elements.loader.off(),t.removeModal(e))},i.prototype.update=function(e){this.elements.loader.update(e)},new i})),define("DS/IPTableMePreferences/utils/GridUtils",["DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen"],(function(e,t){"use strict";var o="en",i=null;function n(){return"object"==typeof n.instance?n.instance:(n.instance=this,this.mdlEvts=null,this)}return n.prototype.setLang=function(e){o=e},n.prototype.getLang=function(){return o},n.prototype.wait=async function(e){return new Promise((t=>{setTimeout(t,e)}))},n.prototype.displayNotif=function(o){null===i&&(i=e,t.setNotificationManager(i),t.setStackingPolicy(5));o=UWA.extend({level:"info",sticky:!1},o),i.addNotif(o)},n.prototype.loadAMD=async function(e){return new Promise((t=>{require([e],(e=>{t(e)}))}))},n.prototype.getURLParameter=function(e){if(location.search.length){let t=(new RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)").exec(location.search)||[null,""])[1].replace(/\+/g,"%20");return decodeURIComponent(t)}return null},new n})),define("DS/IPTableMePreferences/services/PlatformURL",["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],(function(e){"use strict";var t=null;function o(e){return"object"==typeof o.instance?o.instance:(o.instance=this,this)}return o.prototype.initialize=async function(o){return new Promise((function(i,n){null===t?e.getPlatformServices({config:o,onComplete:function(e){t=e,i()},onFailure:n}):i()}))},o.prototype.getPlatformId=function(){return null!=widget&&widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise"},o.prototype.getTenantInfo=function(e){for(var o={},i=0;i<t.length;i++)if(t[i].platformId===e){o=t[i];break}return o},o.prototype.getPlatformURL=function(e){if(!1===Array.isArray(t))throw new Error("Platform services not initialize yet");var o=this.getPlatformId(),i=this.getTenantInfo(o);return void 0===i[e]?(console.error("No "+e+" URL available for the tenant ["+o+"]"),null):i[e]},new o})),define("DS/IPTableMePreferences/services/WSAdmin",["DS/IPTableMePreferences/services/PlatformURL","DS/IPTableMePreferences/utils/GridUtils","DS/MePreferencesClientAPI/MePreferencesClientAPI"],(function(e,t,o){"use strict";function i(){}return i.prototype.interfaces=async function(o){var i=e.getPlatformURL("3DSpace")+"/resources/dictionary/class/interfaces?tenant="+e.getPlatformId(),n={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()}};return n.data=JSON.stringify(o.data),this.executeRequest(i,n,"gridcusto/getexts")},i.prototype.isAdmin=async function(){const t=`${e.getPlatformURL("3DSpace")}/resources/vplmte/getadmctx`;return(await this.executeRequest(t,{method:"GET",headers:{"Content-Type":"application/json"}},"gridcusto/admin_profile")).credentials.some((e=>"VPLMAdmin"===e.rolename))},i.prototype.getPreferences=async function(e=!1,t){const i=await o.readPreferences([{Repository:"BookmarkEditorRepository",PreferenceNames:[`${t}_TABLE_CUSTO`]}]);let n=[];i.repositories&&i.repositories[0]&&i.repositories[0].preferences&&(n=i.repositories[0].preferences);const s=n.find((e=>e.name===`${t}_TABLE_CUSTO`)),a=s.value?JSON.parse(s.value):JSON.parse(s.default);return{MP_VIEWS:{...a?a.MP_VIEWS:{}}}},i.prototype.getFullDictionary=async function(o){var i=e.getPlatformURL("3DSpace")+"/resources/dictionary/Dictionary?tenant="+e.getPlatformId();o&&o.getNLS&&(i+="&lang="+t.getLang());var n={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()}};return await this.executeRequest(i,n,"gridcusto/getFullDictionary")},i.prototype.getTypeInfo=function(o){var i=e.getPlatformURL("3DSpace")+"/resources/dictionary/getTypeInfo?tenant="+e.getPlatformId(),n={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()},timeout:3e5};if(o.url_parameters){for(var s=Object.getOwnPropertyNames(o.url_parameters),a=0;a<s.length;a++)i=i+"&"+s[a]+"="+o.url_parameters[s[a]];delete o.url_parameters}return n.data=JSON.stringify(o.body),delete n.body,this.executeRequest(i,n,"gridcusto/gettype")},i.prototype.getAdminViews=async function(){var t=`${e.getPlatformURL("3DSpace")}/resources/v1/FolderManagement/Folder/page/adminView?tenant=${e.getPlatformId()}`;return await this.executeRequest(t,{method:"GET",type:"json",headers:{"content-type":"application/json"}},"adminView")},i.prototype.setAdminViews=async function(t){var o=`${e.getPlatformURL("3DSpace")}/resources/v1/FolderManagement/Folder/page/adminView?data=test&tenant=${e.getPlatformId()}`,i={method:"POST",type:"json",headers:{"content-type":"application/json",SecurityContext:widget.options.credential||widget.getValue("pad_security_ctx")},data:UWA.Json.encode({appID:widget.data.x3dAppId,data:t})};return await this.executeRequest(o,i,"create-adminView")},i.prototype.getAllTypes=async function({restrictedTypes:t}={}){let o=t?"&"+t.map((e=>`authorizedTypes=${e}`)).join("&"):"";var i=e.getPlatformURL("3DSpace")+"/resources/v1/FolderManagement/Folder/getAllTypes?tenant="+e.getPlatformId()+o;let n=await this.executeRequest(i,{method:"GET",header:{"content-type":"application/json"}},"getAllTypes");return n=n.type.map((t=>({...t,iconUrl:t.iconUrl?`${e.getPlatformURL("3DSpace")}/snresources/images/icons/small/${t.iconUrl}`:""}))),n},i})),define("DS/IPTableMePreferences/services/WSAccess",["i18n!DS/IPTableMePreferences/assets/nls/IPTableMePreferences","DS/WAFData/WAFData","DS/IPTableMePreferences/utils/GridUtils","DS/IPTableMePreferences/services/WSAdmin"],(function(e,t,o,i){"use strict";function n(){return"object"==typeof n.instance?n.instance:(n.instance=this,this)}function s(e){return"string"==typeof e&&"{"===e.charAt(0)?JSON.parse(e):e}return n.prototype=Object.assign(n.prototype,i.prototype),n.prototype.__executeRequest=function(e,o,i,n,s,a){return t.authenticatedRequest(e,o)},n.prototype.executeRequest=async function(e,t,o,i){return new Promise(((n,a)=>{t.onComplete=function(e){var t={success:!0};e&&(t=s(e)),n(t)},t.onFailure=function(e,t){t&&(t=s(t)),a(t)},t.onTimeout=function(e,t){t&&(t=s(t)),a(t)},"POST"!==t.method||"string"==typeof t.data||t.data instanceof Blob||t.data instanceof FormData||(t.data=JSON.stringify(t.data)),this.__executeRequest(e,t,o,i)}))},new n})),define("DS/IPTableMePreferences/services/DictionaryAccessAPI",["i18n!DS/IPTableMePreferences/assets/nls/IPTableMePreferences","DS/SearchDictionaryAccess/SearchDictionaryAccessAPI","DS/IPTableMePreferences/services/PlatformURL","DS/IPTableMePreferences/services/WSAccess","DS/IPTableMePreferences/utils/GridUtils","DS/WAFData/WAFData"],(function(e,t,o,i,n,s){"use strict";const a="R2019x";var l={},r=null;function d(e){return"object"==typeof d.instance?d.instance:(d.instance=this,this)}return d.prototype.convertToR421ClassProperties=function(e){if(!e)return e;var t=[];return e.forEach((function(e){e.classPredicates&&e.classPredicates.forEach((function(e){var o={classInfo:{},properties:[]};e.className&&(o.classInfo={curi:e.className,uri:"http://www.3ds.com/vocabularies/"+e.className.replace(":","/")}),e.vocabularyPredicateInfo&&e.vocabularyPredicateInfo.forEach((function(e){var t={curi:e.uri,uri:e.uri?"http://www.3ds.com/vocabularies/"+e.uri.replace(":","/"):"",label:e.nlsName,description:e.nlsName,dataType:e.range.dataTypes[0],dimension:e.dimension,manipulationUnit:e.manipulationUnit,originCuri:"ds6wg:"+e.name,valuetype:e.valuetype,multiline:e.multiline};e.rangeValues&&e.rangeValues.literalInfo&&(t.rangeValues=e.rangeValues.literalInfo),e.nature&&(t.nature=e.nature),e.selectable&&(t.selectable=e.selectable),e.userAccess&&(t.userAccess=e.userAccess),o.properties.push(t)})),t.push(o)}))})),t},d.prototype.getPropertiesForClass=async function(e){const t=e.classURIs.split("\n"),o=[];for(let e=0;e<t.length;e+=25)o.push(t.slice(e,e+25).join("\n"));let i=[];for(let e=0;e<o.length;e+=5){const t=o.slice(e,e+5).map((e=>this.__splittedPropertiesForClass(e)));(await Promise.allSettled(t)).forEach((e=>{"fulfilled"===e.status&&e.value&&(i=i.concat(e.value))}))}return i},d.prototype.executeRequest=function(e,t,o,i,n,a){return s.authenticatedRequest(e,t)},d.prototype.getClassificationAttributes=async function(){var e=this;return new Promise((function(t){var i={};UWA.extend(i,{apiVersion:a,lang:n.getLang(),headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":n.getLang()},onComplete:function(o){var i=UWA.is(o,"string")?JSON.parse(o):o;i=e.convertToR421ClassProperties([i]),t(i)},onFailure:e=>t});var s=o.getPlatformURL("3DSpace")+"/resources/IPClassificationReuse/ClassAttribute/fetchDefinition";return i.method="GET",e.executeRequest(s,i,"fetchClassPredicates")}))},d.prototype.__splittedPropertiesForClass=async function(e){return new Promise((async function(t,i){(await n.loadAMD("DS/FedDictionaryAccess/FedDictionaryAccessAPI")).getPropertiesForClass(e,{tenantId:o.getPlatformId(),lang:n.getLang(),apiVersion:a,onComplete:function(e){var o="string"==typeof e?JSON.parse(e):e;t(o)},onFailure:function(e){console.warn("FedDictionaryAccessAPI.getPropertiesForClass failed"),i()}})}))},d.prototype.updateColumnNodes=async function(t){const o=e=>{let t=e.label;if(e.curi){if(t===e.curi.replace("ds6wg:","")){const e=t.indexOf(".");e>0&&(t=t.substring(e+1))}}return t},i=(()=>{const e=[ATT_TYPE.REFERENCE,ATT_TYPE.INSTANCE,ATT_TYPE.CLASSIFICATION];return t.getAllDescendants().filter((t=>!0!==t.getReferenceValue("localnls")&&e.includes(t.getReferenceValue("attType"))))})().map((e=>e.options.curi||e.options.ds6w||e.getLabel().replace("-Instance",""))),s=await this.getResourcesInfo(i),a={};if(Array.isArray(s))for(const e of s)a[e.curi]={nlsName:o(e),lang:n.getLang(),kind:e.dataType};t.prepareUpdate();for(const o of t.getAllDescendants()){const t=o.options.curi||o.options.ds6w||o.getLabel();if(!0===o.getReferenceValue("localnls")&&e.columns[t]){o.setLabel(e.columns[t]);continue}if(a[t]){o.setLabel(a[t].nlsName);continue}const i=t.replace("-Instance","");a[i]&&o.setLabel(a[i].nlsName)}t.pushUpdate()},d.prototype.getResourcesInfo=async function(e){return new Promise((async function(t,i){let s=e;var l={tenantId:o.getPlatformId(),lang:n.getLang(),apiVersion:a,onComplete:function(e){t(e)},onFailure:function(e){console.warn("DictionaryAccess## SearchDictionaryAccessAPI.get6wResourcesInfo failed for "+s.join(",")),e&&e.length?t(e):t()}};(await n.loadAMD("DS/FedDictionaryAccess/FedDictionaryAccessAPI")).getResourcesInfo(e.join(","),l)}))},d.prototype.getTypesInfo=async function(e){return new Promise((async t=>{let n=await i.getTypeInfo({url_parameters:{parentInfo:!0,$select:"IconName"},body:e.baseTypes});n="string"==typeof n?JSON.parse(n):n;for(var s=Object.getOwnPropertyNames(n),a=0;a<s.length;a++)n[s[a]]&&0===Object.keys(n[s[a]]).length&&delete n[s[a]];var d=Object.getOwnPropertyNames(n),c={"ds6w:type":d.map((e=>({value:e,source:["3DSpace"]})))};let p;!0!==e.noNls&&(p=await this.retrieveNLS({nlsData:c}));for(var u=0;u<d.length;u++)p&&(p["ds6w:type"]&&p["ds6w:type"][d[u]]?n[d[u]].displayName=p["ds6w:type"][d[u]]:n[d[u]].displayName=d[u]),n[d[u]].iconUrl=(h=n[d[u]].IconName,null===r&&(r=o.getPlatformURL("3DSpace")+"/snresources/images/icons/small/"),h?r+h+".png":"");var h;t(n),l.typesInfo=n}))},d.prototype.getExtensions=async function(e){return new Promise((async t=>{let o=await i.interfaces({data:{classes:e.selectedTypes}});o="string"==typeof response?JSON.parse(o):o;for(var n={},s={},a=o.results,r=0;r<a.length;r++)for(var d=a[r].name,c=0;c<a[r].interfaces.length;c++)a[r].interfaces[c].automatic&&"yes"===a[r].interfaces[c].automatic.toLowerCase()||a[r].interfaces[c].name.startsWith("XP_")&&a[r].interfaces[c].name.endsWith("_Ext")?(void 0===s[a[r].interfaces[c].name]&&(s[a[r].interfaces[c].name]=a[r].interfaces[c],s[a[r].interfaces[c].name].declareIn=[]),s[a[r].interfaces[c].name].declareIn.push(d)):(void 0===n[a[r].interfaces[c].name]&&(n[a[r].interfaces[c].name]=a[r].interfaces[c],n[a[r].interfaces[c].name].declareIn=[]),n[a[r].interfaces[c].name].declareIn.push(d));t({extensions:n,automaticExtensions:s}),l.extensions=n,l.automaticExtensions=s}))},d.prototype.retrieveNLS=async function(e){return new Promise((function(i,s){t.getNlsOfSearchValuesBySource(e.nlsData,{tenantId:o.getPlatformId(),lang:n.getLang(),apiVersion:a,onFailure:function(e){i({})},onComplete:function(e){var t=UWA.is(e,"string")?JSON.parse(e):e;i(t)}})}))},new d}));var nlsManagerPath="DS/SNNavigationMap/utils/NlsManager";define("DS/IPTableMePreferences/views/SelectedAttributes",["UWA/Core",nlsManagerPath,"css!DS/IPTableMePreferences/IPTableMePreferences","i18n!DS/IPTableMePreferences/assets/nls/IPTableMePreferences","text!DS/IPTableMePreferences/assets/conf/IPTableMePreferences.json","DS/IPTableMePreferences/services/DictionaryAccessAPI","DS/IPTableMePreferences/utils/GridUtils","DS/Controls/TooltipModel","DS/Utilities/Dom","DS/Tweakers/GeneratedToolbar","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/TreeModel/ModelUtils","DS/DataGridView/DataGridView","DS/Controls/SelectionChips"],(function(e,t,o,i,n,s,a,l,r,d,c,p,u,h,m){"use strict";const f="att-selected";var g=JSON.parse(n);function E(e){let t=this.options.defaultConf.attributesParams[e.dataIndex?e.dataIndex:e.ds6w],o=t?t.newPredicate:null;return o&&(t=this.options.defaultConf.attributesParams[t.newPredicate],delete e.dataIndex,e.ds6w=o),t}function w(e){this.options=e||{};e.locked;this.options=Object.assign({toolbarDef:{entries:[{id:"moveUp",dataElements:{typeRepresentation:TOOLBAR_RENDERING,tooltip:new l({title:i.tooltip.title.moveUp,mouseRelativePosition:!1,shortHelp:i.tooltip.moveUp}),icon:{iconName:"up",fontIconFamily:1},value:()=>{this.__move("moveUp")},position:"far",category:"move",disabled:!0}},{id:"moveDown",dataElements:{typeRepresentation:TOOLBAR_RENDERING,tooltip:new l({title:i.tooltip.title.moveDown,mouseRelativePosition:!1,shortHelp:i.tooltip.moveDown}),icon:{iconName:"down",fontIconFamily:1},value:()=>{this.__move("moveDown")},position:"far",category:"move",disabled:!0}},{id:"moveTop",dataElements:{typeRepresentation:TOOLBAR_RENDERING,tooltip:new l({title:i.tooltip.title.moveTop,mouseRelativePosition:!1,shortHelp:i.tooltip.moveTop}),icon:{iconName:"move-to-top",fontIconFamily:1},value:()=>{this.__move("moveTop")},position:"far",category:"move",disabled:!0}},{id:"moveBottom",dataElements:{typeRepresentation:TOOLBAR_RENDERING,tooltip:new l({title:i.tooltip.title.moveBottom,mouseRelativePosition:!1,shortHelp:i.tooltip.moveBottom}),icon:{iconName:"move-to-bottom",fontIconFamily:1},value:()=>{this.__move("moveBottom")},position:"far",category:"move",disabled:!0}}]},columns:[{dataIndex:"visibleFlag",typeRepresentation:"boolean",sortableFlag:!1,resizableFlag:!1,icon:{iconName:"eye",fontIconFamily:1},width:40,editionPolicy:"EditionInPlace",getCellEditableState:function(e){const{options:t}=e.nodeModel,{grid:o,pinColumn:i}=t;return!i&&(!o||void 0===o.removableFromView||o.removableFromView)},getCellTypeRepresentation:function(e){return e.nodeModel&&!0===e.nodeModel.options.pinColumn?"string":"boolean"}},{dataIndex:"tree",text:i.columns.colName,width:"auto",visibleFlag:!0,resizableFlag:!1,sortableFlag:!1,getCellTooltip:function(e){if(!e.nodeModel)return;const{options:t}=e.nodeModel,{grid:o}=t;return o.attrDBName?{shortHelp:o.attrDBName.join(", ")}:{shortHelp:t.label}}},{dataIndex:"pinCol",icon:{iconName:"pin",fontIconFamily:1},typeRepresentation:"customEnumMember",text:i.columns.pin,visibleFlag:!0,alignmentValue:"center",width:75,minWidth:75,maxWidth:75,editionPolicy:"EditionOnOver",sortableFlag:!1,resizableFlag:!1,getCellEditableState:function(){return!this.options.locked}.bind(this),getCellSemantics:function(e){return{possibleValues:[{value:"left",label:i.attSelection.pinLeft},{value:"right",label:i.attSelection.pinRight},{value:"unpinned",label:""}]}}}]},this.options),this.options.exportEnabled&&this.options.columns.push({icon:{iconName:"export",fontIconFamily:1},dataIndex:"exportFlag",typeRepresentation:"boolean",alignmentValue:"center",alwaysVisibleFlag:!0,width:40,editableFlag:!0,editionPolicy:"EditionInPlace",sortableFlag:!1,resizableFlag:!1,getCellEditableState:function(e){const{options:t}=e.nodeModel,{grid:o}=t;return!this.options.locked&&(null==o.blockExport||!o.blockExport)}.bind(this)}),this.elements={},this.elements.container=r.createElement("div",{class:f});var t={shouldAcceptDrag:function(e){return!0},shouldAcceptDrop:function(e){this.options.onSelectedAttributeChange(this.getSelectedColumns());let t=e.dropNode&&e.draggedTreeNodeModel&&e.dropNode.getReferenceValue("pinCol")===e.draggedTreeNodeModel.getReferenceValue("pinCol");return"middle"!==e.dropPosition&&t}.bind(this)};return this.options.attModel=new c(t),this.options.attModel.getXSO().onPostAdd(this.__selectionChange.bind(this)),this.options.attModel.getXSO().onPostRemove(this.__selectionChange.bind(this)),this.options.attModel.getXSO().onEmpty(this.__selectionChange.bind(this)),this.options.attModel.onNodeModelUpdate(this.__modelChange.bind(this)),this.__buildView(),this}function v({attributes:e,treeNodeModel:t,lastLeft:o}){let i=1;o||(i=-1,(o=e[0]).options.id===t.options.id&&e.length>1&&(o=e[1])),u.moveNodes([t],o,{direction:i})}function P({attributes:e,treeNodeModel:t,firstRight:o}){let i=-1;o||(i=1,(o=e[e.length-1]).options.id===t.options.id&&e.length>1&&(o=e[e.length-2])),u.moveNodes([t],o,{direction:i})}return e.merge(i,t.getNls()),w.prototype.getContent=function(){return this.elements.container},w.prototype.updateAttList=async function(e){const{attModel:t}=this.options,{MP_SELECTED_COLS:o}=e,n=this.options.locked;t.removeRoots(),t.prepareUpdate();const a=(e,t)=>"boolean"==typeof e?e:t,l="_defaultView"===e.MP_UUID;o.forEach((e=>{const o={[ATT_TYPE.INSTANCE]:ICON_TYPE.INSTANCE,[ATT_TYPE.COMPUTED]:ICON_TYPE.COMPUTED,[ATT_TYPE.CLASSIFICATION]:ICON_TYPE.CLASSIFICATION,[ATT_TYPE.COMMAND]:ICON_TYPE.COMMAND},s=e.attType?e.attType:ATT_TYPE.REFERENCE,r=E.call(this,e);let d,c,u,h=o[s]?o[s]:ICON_TYPE.REFERENCE;r&&r.customisation&&(r.customisation.layout&&(d=!r.customisation.layout.removableFromView||r.customisation.layout.removableFromView),r.customisation.exportable&&(c=!!r.customisation.exportable.lock&&r.customisation.exportable.lock)),r&&r.icon&&(h=r.icon),u=e.mandatory?e.mandatory:!!(r&&r.customisation&&r.customisation.layout)&&!r.customisation.layout.removable;const m=r?r.nls:void 0;null!=e.forceHidden&&["favoriteTitle","bookmarkLocation"].includes(e.dataIndex)&&(!0===e.forceHidden?e.visibleFlag=!1:e.visibleFlag=!0);const f={id:e.dataIndex?e.dataIndex:e.ds6w,ds6w:e.ds6w,label:i[m]?i[m]:e.text?e.text:e.ds6w?e.ds6w:i.get(e.dataIndex),icons:[e.icon?e.icon:h],grid:{attrDBName:Array.from(new Set(e.attrDBName)),multiValue:r?r.multiValue:void 0,kind:e.kind,width:e.width,classif:e.classif,removableFromView:!n&&(d??!0),mandatory:u,visibleFlag:a(e.visibleFlag,!0),forceHidden:e.forceHidden,blockExport:c,exportFlag:!!l||a(e.exportFlag,!1),attType:s,pinCol:e.pinned?e.pinned:"unpinned"}};t.addRoot(new p(f))})),this.options.locked?(this.elements.dgv.cellDragEnabledFlag=!1,this.elements.dgv.rowDragEnabledFlag=!1,this.elements.dgv.rowReorderEnabledFlag=!1,this.elements.dgv.layoutOptions.rowsHeader=!1):(this.elements.dgv.cellDragEnabledFlag=!0,this.elements.dgv.rowDragEnabledFlag=!0,this.elements.dgv.rowReorderEnabledFlag=!0,this.elements.dgv.layoutOptions.rowsHeader=!0),await s.updateColumnNodes(t),t.pushUpdate()},w.prototype.removeSelectedNodes=function(){let e=this.options.attModel.getSelectedNodes();for(let t=0;t<e.length;t++)e[t].remove();return this.options.onSelectedAttributeChange(this.getSelectedColumns()),e},w.prototype.addSelectedNodes=function(e,t){let o=[];e.reverse().forEach((e=>{const i=this.getSelectedColumns(),n=i.findIndex((t=>t.dataIndex===(e.options.curi||e.options.id)));-1!==n?this.updateExistingNode(e,i,n,t):o.push(this.createNewNode(e,t))})),this.options.onSelectedAttributeChange(this.getSelectedColumns()),o.forEach((e=>e.select()))},w.prototype.updateExistingNode=function(e,t,o,i){const n=t[o].dataIndex||t[o].label,s=this.options.attModel.getAllDescendants().find((e=>e._options.id===n)),a=s.options.grid.attrDBName,l=[`attribute[${e.options.selectable}]`];let r=s.options;e.options.selectable&&(r={...s.options,grid:{...s.options.grid,attrDBName:Array.from(new Set(a?[...a,...l]:l))}}),s.prepareUpdate(),s.updateOptions(r),this.options.attModel.addRoot([s],i),s.pushUpdate()},w.prototype.createNewNode=function(e,t){e.options.grid.declaredIn||(e.options.grid.declaredIn=[]);let o=[`attribute[${e.options.selectable||e.options.id}]`];"Classif"!==e.options.grid.attType||o.length||(e.options.ds6w=e.options.id,o=[`attribute[${e.options.selectable||e.options.id}]`]);let i=this.options.defaultConf.attributesParams[e.options.curi||e.options.id],n=i?i.newPredicate:null;n&&(i=this.options.defaultConf.attributesParams[i.newPredicate],e.options.curi=n);let s={id:e.options.curi||e.options.id,ds6w:e.options.ds6w||e.options.curi||(e.options.selectable?`ds6wg:${e.options.selectable}`:void 0),curi:e.options.curi,selectable:e.options.selectable,label:e.getLabel(),icons:e.getIcons(),grid:{multiValue:i?i.multiValue:void 0,attrDBName:o?Array.from(new Set(o)):void 0,class:e.options.classif,mandatory:!1,visibleFlag:!0,classif:"Classif"===e.options.grid.attType,icons:e.getIcons(),kind:e.getReferenceValue("dataType"),blockExportedFlag:!0===e.getReferenceValue("blockExportedFlag"),pinCol:e.getReferenceValue("pinCol")?e.getReferenceValue("pinCol"):"unpinned"}},a=new p(s);const l=this.__locateFirstAndLastPin(),r=l.first._getLocalID(),d=l.last?l.last._getLocalID():this.options.attModel.getRoots().length-1;return t<r&&(t=r),(void 0===t||t>d)&&(t=d),this.options.attModel.addRoot(a,t),this.options.attModel.unselectAll(),this.elements.dgv.ensureNodeModelVisible(a,!1,!0,.2),a},w.prototype.getSelectedColumns=function(){let e={properties:[function(){return{property:"dataIndex",value:this.options.id}},function(){return{property:"ds6w",value:this.options.ds6w}},function(){return{property:"visibleFlag",value:this.getReferenceValue("visibleFlag")}},function(){return{property:"multiValue",value:this.getReferenceValue("multiValue")}},function(){let e=this.getReferenceValue("kind");return this.getReferenceValue("kind")&&this.getReferenceValue("kind").includes("#")&&(e=this.getReferenceValue("kind").split("#")[1]),{property:"kind",value:e}},function(){var e=void 0;return["favoriteTitle","bookmarkLocation"].includes(this.options.id)&&(e=!this.getReferenceValue("visibleFlag")),{property:"forceHidden",value:e}},function(){return{property:"attrDBName",value:this.getReferenceValue("attrDBName")}},function(){return{property:"width",value:this.getReferenceValue("width")}},function(){return{property:"classif",value:this.getReferenceValue("classif")}},function(){return{property:"pinned",value:"unpinned"===this.getReferenceValue("pinCol")?"":this.getReferenceValue("pinCol")}}]};return this.options.exportEnabled&&e.properties.push((function(){return{property:"exportFlag",value:this.getReferenceValue("exportFlag")}})),this.options.attModel.dump(e).children},w.prototype.__buildView=function(){this.elements.hdr=r.createElement("div",{class:f+"-hdr"}),this.elements.content=r.createElement("div",{class:f+"-content"}),this.elements.container.appendChild(this.elements.hdr),this.elements.container.appendChild(this.elements.content);let e=r.createElement("div",{class:f+"-title"});e.innerText=i.selectedAtt.title,this.elements.hdr.appendChild(e);let t=d.prototype.createTreeDocument(this.options.toolbarDef);this.elements.toolbar=new d({overflowManagement:"dropdown",direction:"horizontal",items:t}),this.elements.toolbar.getContent().addClassName(f+"-toolbar"),this.elements.hdr.appendChild(this.elements.toolbar.getContent());let o=JSON.parse(JSON.stringify(g.defaultDGVOpts));function n(e){return e.preventDefault(),!0}function s(e,t){e.preventDefault();return e.dataTransfer.getData("Text")?t.droppedNodes.reverse().forEach((e=>{const o=this.__locateFirstAndLastPin(e.getReferenceValue("pinCol")),i=o.first._getLocalID(),n=o.last?o.last._getLocalID():this.options.attModel.getRoots().length-1;var s=t.nodeModel?t.nodeModel._getLocalID():void 0;s<i&&(s=i),(void 0===s||s>n)&&(s=n),this.addSelectedNodes([e],s),this.options.onSelectedAttributeChange(this.getSelectedColumns()),e.select()})):t.nodeModel?this.options.parent.__addToSelectedAtt(t.nodeModel._getLocalID()):this.options.parent.__addToSelectedAtt(),!1}o.columns=this.options.columns,o.treeDocument=this.options.attModel,o.onContextualEvent=this._onCtxMenuEvent.bind(this),o.onDragOverCell=n.bind(this),o.onDragOverBlank=n.bind(this),o.onDropCell=s.bind(this),o.onDropBlank=s.bind(this),this.elements.dgv=new h(o),this.elements.dgv.getContent().addClassName(f+"-dgv"),this.elements.content.appendChild(this.elements.dgv.getContent())},w.prototype._onCtxMenuEvent=async function(e){return Promise.resolve([])},w.prototype.__selectionChange=function(){let e=this.options.attModel.getSelectedNodes();this.options.onSelectionChange(e);const t=(e,t)=>{this.options.locked?this.elements.toolbar.updateNodeModel(e,{disabled:!0,grid:{disabled:!0}}):this.elements.toolbar.updateNodeModel(e,{disabled:t,grid:{disabled:t}})};if(1===e.length){const o=this.options.attModel.getRoots().filter((e=>"unpinned"===e.options.grid.pinCol)).length,i=this.options.attModel.getRoots().filter((e=>"left"===e.options.grid.pinCol)).length;let n=-1,s=-1;this.options.attModel.search({match:t=>{s++,t.nodeModel.options.id===e[0].options.id&&(n=s)},shouldStop:()=>-1!==n});const a=n===i,l=n===o,r="unpinned"!==e[0].options.grid.pinCol;t("moveUp",a||r),t("moveTop",a||r),t("moveDown",l||r),t("moveBottom",l||r)}else["moveUp","moveDown","moveTop","moveBottom"].forEach((e=>t(e,!0)))},w.prototype.__move=function(e,t=void 0){this.options.attModel.getSelectedNodes().forEach((o=>{const i=o.getReferenceValue("pinCol"),n=o._getLocalID(),s=this.__locateFirstAndLastPin(i),a=s.first._getLocalID(),l=s.last?s.last._getLocalID():this.options.attModel.getRoots().length-1;switch(e){case"moveTop":t=a;break;case"moveUp":t=a<=n-1?n-1:n;break;case"moveDown":t=l>=n+1?n+1:n;break;case"moveBottom":t=l;break;default:t=a<=n-1?n-1:a,t=l>=n+1?n+1:l}this.options.attModel.addChild(o,t),o.select(),this.options.onSelectedAttributeChange(this.getSelectedColumns())}))},w.prototype.__locateFirstAndLastPin=function(e){e||(e="unpinned");const t=this.options.attModel.getRoots(),o=t.filter((t=>t.getReferenceValue("pinCol")===e));let i,n=o[0];return 0===o.length&&(n=t.findLast((e=>"left"===e.getReferenceValue("pinCol"))),i=t.find((e=>"right"===e.getReferenceValue("pinCol")))),i="left"===e&&o.length>1?o[o.length-1]:"left"!==e&&1===o.length?t[t.length-1]:o[o.length-1],{first:n,last:i}},w.prototype.__modelChange=async function(e){if(e&&e.data.nodeModel&&e.data.attributes.pinCol){const t=e.data.nodeModel,o=t.getReferenceValue("pinCol"),i=this.options.attModel.getRoots();if(i.length>1){let n=null,s=null;for(let e=0;e<i.length;e++){const o=i[e];if(o.options.id!==t.options.id&&("left"===o.getReferenceValue("pinCol")&&(n=o),s||"right"!==o.getReferenceValue("pinCol")||(s=o),n&&s))break}switch(o){case"left":v({attributes:i,treeNodeModel:t,lastLeft:n});break;case"right":P({attributes:i,treeNodeModel:t,firstRight:s});break;default:"left"===e.data.previousAttributes.pinCol?v({attributes:i,treeNodeModel:t,lastLeft:n}):P({attributes:i,treeNodeModel:t,firstRight:s})}t.unselect(),t.select()}}e&&e.data.nodeModel&&(e.data.attributes.pinCol||void 0!==e.data.attributes.visibleFlag)&&this.options.onSelectedAttributeChange(this.getSelectedColumns())},w})),define("DS/IPTableMePreferences/views/TypeNExtChooser",["css!DS/IPTableMePreferences/IPTableMePreferences.css","i18n!DS/IPTableMePreferences/assets/nls/IPTableMePreferences","text!DS/IPTableMePreferences/assets/conf/IPTableMePreferences.json","DS/IPTableMePreferences/services/DictionaryAccessAPI","DS/Utilities/Dom","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/Tab","DS/TreeModel/TreeDocument","DS/DataGridView/DataGridView","DS/IPTableMePreferences/views/Mask","DS/Windows/ImmersiveFrame","DS/IPTableMePreferences/services/WSAccess"],(function(e,t,o,i,n,s,a,l,r,d,c,p,u){"use strict";const h="type-n-ext-chooser",m=JSON.parse(o);function f(e){return this.elements={},this.options=e||{},this.options=Object.assign({allExtForTypes:[]},this.options),this}return f.prototype.choose=async function(){return new Promise((async e=>{this.elements.container=n.createElement("div",{class:h}),this.__buildView();var o={domId:"IPTypeChooser",immersiveFrame:widget.immersiveFrame,resizableFlag:!0,title:t.typeNext.title,content:this.elements.container,modalFlag:!0,usePaddingFlag:!0,position:{my:"center",at:"center"},width:350,minWidth:250,height:320,buttons:{Ok:new a({domId:h+"-ok-btn",label:t.typeNext.okBtn,onClick:t=>{if(this.elements.creationModal.close(),this.options.MP_SELECTED_TYPES=this.options.typesModel.getRoots().filter((e=>e.getReferenceValue("selectedIdx"))).map((e=>e.getReferenceValue("type"))),!0===this.options.extensionsSet){this.options.MP_SELECTED_EXTS=this.options.extsModel.getRoots().filter((e=>e.getReferenceValue("selectedIdx"))).map((e=>e.getReferenceValue("extension")));let e=Object.values(this.options.automaticExt);e.length>0&&(this.options.MP_SELECTED_EXTS=this.options.MP_SELECTED_EXTS.concat(e))}e({MP_SELECTED_TYPES:this.options.MP_SELECTED_TYPES,MP_SELECTED_EXTS:this.options.MP_SELECTED_EXTS,cancel:!1})}}),Cancel:new a({domId:h+"-cancel-btn",label:t.typeNext.cancelBtn,onClick:t=>{this.elements.creationModal.close(),e({cancel:!0})}})}};this.elements.creationModal=new s(o),await this.__fillTypes()}))},f.prototype.__buildView=async function(){const e=(e,t,o,i,n="")=>{const s={...JSON.parse(JSON.stringify(m.defaultDGVOpts)),layoutOptions:{useLastColumnWidthAutoFlag:!1},columns:t,placeholder:n,treeDocument:e,onContextualEvent:o,sortModel:i},a=new d(s);return a.treeDocument.setFilterModel({label:{filterId:"stringRegexp",filterModel:{}}}),a},o=(e,t,o)=>{const i=((e,t)=>e.setToolbar({entries:[{id:`findDialogId${t}`,position:"far",dataElements:{typeRepresentation:"functionIcon",icon:{iconName:"filter",fontIconFamily:1},value:()=>{e.getFilterViewManager().getFilterPopups().label.showPopup()}}}]}))(t,o);e.appendChild(i.getContent());const s=n.createElement("div",{class:`${h}-dgv`});s.appendChild(t.getContent()),e.appendChild(s)};this.elements.tab=new l({displayStyle:"strip"}),this.elements.tab.addEventListener("change",(async e=>{const t=e.dsModel;t.value&&1===t.value[0]&&await this.__fillExts()})),this.elements.tab.getContent().addClassName(`${h}-tab`),this.elements.typesDiv=n.createElement("div",{class:`${h}-types`}),this.options.typesModel=new r,this.elements.typesDgv=e(this.options.typesModel,[{dataIndex:"selectedIdx",typeRepresentation:"boolean",visibleFlag:!0,width:40,resizableFlag:!1,sortableFlag:!0,editableFlag:!0,editionPolicy:"EditionInPlace"},{dataIndex:"tree",width:"auto",text:t.columns.typeName,visibleFlag:!0}],this._onCtxMenuEvent.bind(this),[{dataIndex:"selectedIdx",sort:"desc"}]),o(this.elements.typesDiv,this.elements.typesDgv,"Types"),this.elements.extsDiv=n.createElement("div",{class:`${h}-exts`}),this.options.extsModel=new r,this.elements.extsDgv=e(this.options.extsModel,[{dataIndex:"selectedIdx",typeRepresentation:"boolean",visibleFlag:!0,width:40,resizableFlag:!1,sortableFlag:!0,editableFlag:!0,editionPolicy:"EditionInPlace"},{dataIndex:"tree",width:"auto",text:t.columns.extName,visibleFlag:!0}],this._onCtxMenuEvent.bind(this),[{dataIndex:"selectedIdx",sort:"desc"}],t.typeNext.extension.placeholder),o(this.elements.extsDiv,this.elements.extsDgv,"Exts"),this.elements.tab.add({label:t.typeNext.selectionTypeTitle,icon:{iconName:"3d-object",fontIconFamily:WUXManagedFontIcons.Font3DS},content:this.elements.typesDiv,isSelected:!0}),this.elements.tab.add({label:t.typeNext.selectionExtTitle,icon:{iconName:"3dproduct-add",fontIconFamily:WUXManagedFontIcons.Font3DS},content:this.elements.extsDiv}),this.elements.container.appendChild(this.elements.tab.getContent())},f.prototype.__fillTypes=async function(){c.mask(this.elements.container,t.loading.gridCusto),this.options.typesModel.removeRoots();let e=await u.getAllTypes({restrictedTypes:this.options.restrictedTypes});const o=Object.values(e);this.options.typesModel.prepareUpdate();for(let t=0;t<o.length;t++){let i=o[t],n=-1!==this.options.MP_SELECTED_TYPES.indexOf(i.name),s={label:e[t].nameNls,icons:[e[t].iconUrl],grid:{type:e[t].name,iconName:e[t].iconUrl,selectedIdx:n},children:null};this.options.typesModel.addRoot(s)}this.options.typesModel.pushUpdate(),this.elements.typesDgv.reapplySortModel(),c.unmask(this.elements.container)},f.prototype._onCtxMenuEvent=async function(e){return new Promise((function(e){e([])}))},f.prototype.__fillExts=async function(){const{options:e,elements:o}=this;c.mask(o.container),e.MP_SELECTED_TYPES=e.typesModel.getRoots().filter((e=>e.getReferenceValue("selectedIdx"))).map((e=>e.getReferenceValue("type"))),e.extensionsSet=!0,e.allExtForTypes=e.MP_SELECTED_TYPES,e.extsModel.removeRoots();const n=Array.from({length:Math.ceil(e.allExtForTypes.length/75)},((t,o)=>e.allExtForTypes.slice(75*o,75*(o+1)))),s=n.length;let a=0;const l=this.options.MP_SELECTED_EXTS.reduce(((e,t)=>(e[t]={nlsName:this.options.typesTranslation[t].label},e)),{}),r=[...n],d=new Set;async function p(e){try{const{extensions:t,automaticExtensions:o}=await i.getExtensions({selectedTypes:e});Object.assign(l,{...t,...o})}catch(e){console.error("Error to retrieve extensions :",e)}finally{if(a++,c.update(a/s*100),d.delete(this),r.length>0){const e=p(r.shift());d.add(e),await e}}}for(;d.size<5&&r.length>0;){const e=p(r.shift());d.add(e)}await Promise.allSettled(d),e.extsModel.prepareUpdate(),Object.entries(l).forEach((([o,i])=>{const n=e.MP_SELECTED_EXTS.includes(o)||this.options.MP_SELECTED_TYPES.map((e=>`XP_${e}_Ext`)).includes(o);if(i.nlsName.includes("XP_","_Ext")){const e=i.nlsName.replace(/^XP_|_Ext$/g,"");i.nlsName=t.replace(t.attSelection.extension,{typeName:e})}e.extsModel.addRoot({label:i.nlsName,grid:{extension:o,iconName:i.iconName,selectedIdx:n},children:null})})),e.extsModel.pushUpdate(),e.automaticExt=Object.values(l).filter((e=>l[e]&&l[e].automatic)),o.extsDgv.reapplySortModel(),c.unmask(o.container)},f}));nlsManagerPath="DS/SNNavigationMap/utils/NlsManager";define("DS/IPTableMePreferences/views/AttributesSelection",["UWA/Core",nlsManagerPath,"css!DS/IPTableMePreferences/IPTableMePreferences","i18n!DS/IPTableMePreferences/assets/nls/IPTableMePreferences","text!DS/IPTableMePreferences/assets/conf/IPTableMePreferences.json","DS/IPTableMePreferences/services/DictionaryAccessAPI","DS/IPTableMePreferences/views/TypeNExtChooser","DS/Controls/TooltipModel","DS/Utilities/Dom","DS/Tweakers/GeneratedToolbar","DS/Controls/Loader","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/DataGridView/DataGridView","DS/FindEx/FindDialog"],(function(e,t,o,i,n,s,a,l,r,d,c,p,u,h,m){"use strict";const f="att-selection",g="-Instance";e.merge(i,t.getNls());var E=(e,t)=>{if(e&&!e.hasChildren())e.addRoot(t);else{let o,i=e.getChildren(),n=t.getLabel();for(let e=0;e<i.length;e++)if(i[e].getLabel()>n){o=i[e];break}void 0===o?e.addRoot(t):e.insertBefore(t,o)}},w=JSON.parse(n);function v(e){this.options=e||{},this.options=Object.assign({toolbarDef:{entries:[{id:"addTypesAndExt",dataElements:{typeRepresentation:TOOLBAR_RENDERING,visibleFlag:this.options.enableTypes,tooltip:new l({title:i.tooltip.title.addTypesAndExt,mouseRelativePosition:!1,shortHelp:i.tooltip.addTypesAndExt}),icon:{iconName:"attributes-add",fontIconFamily:1},value:this.__launchTypeAndExtChooser.bind(this),position:"far",category:"addAtt"}},{id:"findInAtt",dataElements:{typeRepresentation:TOOLBAR_RENDERING,tooltip:new l({title:i.tooltip.title.findInAtt,mouseRelativePosition:!1,shortHelp:i.tooltip.findInAtt}),icon:{iconName:"search",fontIconFamily:1},value:()=>{this.elements.dgv.findDialog.visibleFlag=!this.elements.dgv.findDialog.visibleFlag},position:"far",category:"find"}}]},columns:[{dataIndex:"tree",text:i.columns.attName,width:"auto",visibleFlag:!0}]},this.options),this.elements={},this.elements.container=r.createElement("div",{class:f});return this.options.attModel=new p({shouldBeSelected:function(e){return void 0===e.getReferenceValue("shouldBeSelected")||e.getReferenceValue("shouldBeSelected")}}),this.options.attModel.getXSO().onPostAdd(this.__selectionChange.bind(this)),this.options.attModel.getXSO().onPostRemove(this.__selectionChange.bind(this)),this.options.attModel.getXSO().onEmpty(this.__selectionChange.bind(this)),this.__buildView(),this.attrMap=new Map,this}return v.prototype.getContent=function(){return this.elements.container},v.prototype.updateAttList=async function(e){this.options={...this.options,...e};const t=this.options.MP_SELECTED_COLS.map((e=>e.dataIndex&&"tree"!==e.dataIndex?e.dataIndex:e.ds6w));this.options.attModel.removeRoots(),this.options.attModel.prepareUpdate(),this.attrMap.clear(),this.options.MP_SELECTED_TYPES=this.options.MP_SELECTED_TYPES?this.options.MP_SELECTED_TYPES:[],this.options.MP_SELECTED_EXTS=this.options.MP_SELECTED_EXTS?this.options.MP_SELECTED_EXTS:[],this.options.automaticExt=this.options.MP_SELECTED_TYPES.map((e=>`XP_${e}_Ext`));const o=[...this.options.MP_SELECTED_TYPES,...this.options.automaticExt,...this.options.MP_SELECTED_EXTS];let n=[s.getPropertiesForClass({classURIs:[...new Set(o)].join("\n")}),s.getTypesInfo({noNls:!1,baseTypes:[...this.options.MP_SELECTED_TYPES,...this.options.MP_SELECTED_EXTS]})];!1!==this.options.defaultConf.withClassif&&n.push(s.getClassificationAttributes());const[a,l,r]=await Promise.all(n);var d=await s.getResourcesInfo(a?a.map((e=>e.classInfo.curi)):[],!0),c=await s.getResourcesInfo(r?r.flatMap((e=>e.properties.map((e=>e.curi)))):[],!0);"string"==typeof d&&(d=[]),this.options.typesTranslation=d.reduce(((e,t)=>(e[t.curi.split(":")[1]]=t,e)),{}),void 0===c&&(c=[]),function(e,t){t.forEach((({curi:t,label:o})=>{const i=t.replace("ds6wg:","");e[i]={...e[i]||{},displayName:o}}))}(l,d);const[p,h,m]=function(e){let{attModel:t,enableTypes:o}=e;const n=[{label:i.attSelection.commonAttributes,iconName:"attributes"},{label:i.attSelection.typesAttributes,iconName:"attributes",visibleFlag:o},{label:i.attSelection.extsAttributes,iconName:"attributes",visibleFlag:o}].map((({label:e,iconName:t,visibleFlag:o})=>{const i=new u({icons:[{iconName:t,fontIconFamily:1}],label:e,grid:{shouldBeSelected:!1}});return!1===o&&i.hide(),i}));0===t.getRoots().length&&n.forEach((e=>t.addRoot(e)));return n}(this.options);!function(e,t,o,n,s){e.forEach((({classInfo:e,properties:s})=>{const a=e.curi.replace("ds6wg:",""),l=["ds6wg:VPMInstance","ds6wg:VPMRepInstance"].includes(e.curi),r=n.MP_SELECTED_TYPES.includes(a)?"FromType":"FromExt";s.forEach((e=>{const n=e.originCuri||e.curi;if(["ds6wg:PLMReference.V_isLastVersion",i.notDisplayedAtt].includes(e.label||n))return;const s=`${n}${l?g:""}`;if(o.has(s)){const e=o.get(s);e.grid.declaredIn.push(a),o.set(s,e)}else{const i=l?ATT_TYPE.INSTANCE:ATT_TYPE.REFERENCE,d=l?ICON_TYPE.INSTANCE:ICON_TYPE.REFERENCE;o.set(e.curi,{id:s,label:e.label||n,curi:e.curi,originCuri:e.originCuri,icons:[d],selectable:e.selectable,nature:e.nature,grid:{dataType:e.dataType,dimension:e.dimension,attType:i,kind:r,exportableFlag:!0,declaredIn:[a],selectedAtt:t.includes(s)||t.includes(e.curi),width:e.width,alignment:e.alignment},children:null})}}))}))}(a,t,this.attrMap,this.options),this.updateAttributeNodes(t,this.attrMap,l,p,h,m),!1!==this.options.defaultConf.withClassif&&function(e,t,o,n,s){const a=new u({icons:[ICON_TYPE.CLASSIFICATION],label:i.attSelection.classifAttributes,grid:{shouldBeSelected:!1},id:"classif-id",children:[]});0===s.getRoots().filter((e=>"classif-id"===e.options.id)).length&&s.addRoot(a);e.forEach((({properties:e})=>{e.forEach((e=>{if(!n.has(e.curi)){const i=t.find((t=>t.curi===e.curi)),s={id:e.curi,label:i?i.label:e.label,icons:[ICON_TYPE.CLASSIFICATION],selectable:e.selectable,grid:{dataType:e.dataType,dimension:e.dimension,attType:ATT_TYPE.CLASSIFICATION,kind:ATT_TYPE.CLASSIFICATION,exportableFlag:!0,selectedAtt:o.includes(e.curi)},children:null},l=new u(s);E(a,l),l.getReferenceValue("selectedAtt")&&l.hide(),n.set(s.id,s)}}))}))}(r||[],c,t,this.attrMap,this.options.attModel);this.options.defaultConf.additionalColumns.forEach((e=>{const t=this.options.defaultConf.attributesParams[e],o=t.nls,n=this.options.parent.elements.selectedAttributes.getSelectedColumns().map((e=>e.dataIndex||e.ds6w)),s=this.options.attModel.search({match:o=>(o.nodeModel.options.curi||o.nodeModel.options.id)===(t.newPredicate||e)}),a={id:e,label:i.get(o)||e,icons:t.icon?[t.icon]:[ICON_TYPE.REFERENCE],grid:{curi:e,ds6w:e,attType:ATT_TYPE.REFERENCE,removableFromView:t.removableFromView||!0,mandatory:t.removable||!0,visibleFlag:!0}};n.includes(e)||0!==s.length||this.addSelectedNodes([new u(a)],!1)})),this.options.additionalColumns.forEach((e=>{const t={id:e.dataIndex,label:i.get(e.dataIndex),icons:[ICON_TYPE.REFERENCE],grid:{width:e.width,removableFromView:!0,mandatory:!1,visibleFlag:!0}};this.addSelectedNodes([new u(t)],!1)})),this.options.attModel.pushUpdate(),await s.updateColumnNodes(this.options.attModel)},v.prototype.updateAttributeNodes=function(e,t,o,n,s,a){var l={};this.options.MP_SELECTED_TYPES.forEach((e=>{const t=e,i=o[t]||{},n=new u({id:t,label:i.displayName||t,icons:i.iconUrl?[i.iconUrl]:[],grid:{shouldBeSelected:!1}});l[t]=n,E(s,n)})),this.options.MP_SELECTED_EXTS.forEach((e=>{const t=e,i=o[t]||{},n=new u({id:t,label:i.displayName||t,icons:i.iconUrl?[i.iconUrl]:[],grid:{shouldBeSelected:!1}});l[t]=n,E(a,n)})),this.options.defaultConf.additionalColumns.forEach((o=>{const n=this.options.defaultConf.attributesParams[o],s=n?n.nls:void 0;t.set(o,{id:o,label:i[s]||o,nature:"basic",grid:{selectedAtt:e.includes(o),exportableFlag:!1},icons:[{iconName:"object-reference",fontIconFamily:1}]})})),t.forEach((e=>{if("basic"===e.nature||this.options.defaultConf.computedAttrCommon&&this.options.defaultConf.computedAttrCommon.includes(e.curi)){const t=new u(e);E(n,t),t.getReferenceValue("selectedAtt")&&t.hide()}else("attribute"===e.nature||this.options.defaultConf.computedAttr&&this.options.defaultConf.computedAttr.includes(e.curi))&&e.grid.declaredIn.forEach((t=>{const n=new u(e);var s=l[t];if(s)e.selectable.includes("XP_","_Ext")&&!t.match("XP_","_Ext")||E(s,n);else{const e=t,s=o[e]||{};var r=s.displayName||e;if(r.includes("XP_","_Ext")){const e=o[t.replace(/^XP_|_Ext$/g,"")];r=i.replace(i.attSelection.extension,{typeName:e.displayName})}const d=new u({id:e,label:r,icons:s.iconUrl?[s.iconUrl]:[],grid:{shouldBeSelected:!1}});l[e]=d,E(a,d),E(d,n)}n.getReferenceValue("selectedAtt")&&n.hide()}))}))},v.prototype.removeSelectedNodes=function(){let e=this.options.attModel.getSelectedNodes();for(let t=0;t<e.length;t++)e[t].hide();return e},v.prototype.addSelectedNodes=async function(e,t=!0,o=0){for(const i of e){const n=i.options.id;let s=[...this.options.attModel.search({match:e=>e.nodeModel.options.id===n||e.nodeModel.options.curi===n})];if(0!==s.length||this.options.attModel.getChildren()[0]){if(0===s.length&&this.options.attModel.getChildren()[0]){const e=this.options.attModel.getChildren()[0].addChild(i);e&&s.push(e)}for(const e of s)t&&(e.show(),e.select(),this.elements.dgv.ensureNodeModelVisible(e,!1,!0,.2))}else if(o<10)return await new Promise((e=>setTimeout(e,100))),this.addSelectedNodes(e,t,o+1)}},v.prototype.__buildView=function(){this.elements.hdr=r.createElement("div",{class:f+"-hdr"}),this.elements.content=r.createElement("div",{class:f+"-content"}),this.elements.container.appendChild(this.elements.hdr),this.elements.container.appendChild(this.elements.content);let e=r.createElement("div",{class:f+"-title"});e.innerText=i.attSelection.title,this.elements.hdr.appendChild(e);let t=d.prototype.createTreeDocument(this.options.toolbarDef);this.elements.toolbar=new d({overflowManagement:"dropdown",direction:"horizontal",items:t}),this.elements.toolbar.getContent().addClassName(f+"-toolbar"),this.elements.hdr.appendChild(this.elements.toolbar.getContent());let o=JSON.parse(JSON.stringify(w.defaultDGVOpts));o.columns=this.options.columns,o.treeDocument=this.options.attModel,o.onContextualEvent=this._onCtxMenuEvent.bind(this);let n=new c({});function s(e){return e.preventDefault(),!0}function a(e,t){e.preventDefault();return e.dataTransfer.getData("Text")&&this.options.parent.__removeFromSelectedAtt(),!0}n.on(),o.placeholder=n.getContent(),o.treeNodeCellOptions={expanderStyle:"triangle",buildLinks:!1},o.onDragOverCell=s.bind(this),o.onDragOverBlank=s.bind(this),o.onDropCell=a.bind(this),o.onDropBlank=a.bind(this),this.elements.dgv=new h(o),this.elements.dgv.getContent().addClassName(f+"-dgv"),this.elements.content.appendChild(this.elements.dgv.getContent()),this.elements.dgv.findDialog=new m({visibleFlag:!1,findWidgetOptions:{relatedWidget:this.elements.dgv,inputValidationThreshold:1,showAdditionnalOptions:!1}})},v.prototype.__launchTypeAndExtChooser=async function(){let e=new a({typesTranslation:this.options.typesTranslation,defaultTypes:this.options.defaultTypes,automaticExt:this.options.automaticExt,defaultExts:this.options.defaultExts,MP_SELECTED_TYPES:this.options.MP_SELECTED_TYPES,MP_SELECTED_EXTS:this.options.MP_SELECTED_EXTS,restrictedTypes:this.options.defaultConf.restrictedTypes,cancel:!1});const t=(e,t)=>e.length!==t.length||!([...e].sort().join()===[...t].sort().join());let o=await e.choose();if(o&&o.cancel)return;o||(o={MP_SELECTED_TYPES:[],MP_SELECTED_EXTS:[]});const i=t(this.options.MP_SELECTED_TYPES,o.MP_SELECTED_TYPES)||t(this.options.MP_SELECTED_EXTS,o.MP_SELECTED_EXTS);(void 0===o||i)&&(this.options.onTypesAndExtsChange(o),await this.updateAttList(o))},v.prototype._onCtxMenuEvent=async function(e){return Promise.resolve([])},v.prototype.__selectionChange=function(){this.options.onSelectionChange(this.options.attModel.getSelectedNodes())},v}));const ATT_TYPE={REFERENCE:"Ref",INSTANCE:"Inst",CLASSIFICATION:"Classif",COMPUTED:"Computed",COMMAND:"Cmd"},ICON_TYPE={REFERENCE:{iconName:"object-reference",fontIconFamily:1},INSTANCE:{iconName:"object-instance",fontIconFamily:1},CLASSIFICATION:{iconName:"library-class",fontIconFamily:1},COMPUTED:{iconName:"compute",fontIconFamily:1},COMMAND:{iconName:"run",fontIconFamily:1}},TOOLBAR_RENDERING="functionIcon",MAX_SELECTED_PER_VIEW=30,MAX_VIEW=4,toCopyFromLocal=["MP_SELECTED_COLS","MP_VERSION"],columnsToKeep=["classif","dataIndex","curi","ds6w","visibleFlag","forceHidden","pinned","attrDBName","kind","width"];if(!widget)var widget;define("DS/IPTableMePreferences/IPTableMePreferences",["css!DS/IPTableMePreferences/IPTableMePreferences.css","i18n!DS/IPTableMePreferences/assets/nls/IPTableMePreferences","DS/Controls/TooltipModel","DS/IPTableMePreferences/views/AttributesSelection","DS/IPTableMePreferences/views/SelectedAttributes","DS/IPTableMePreferences/views/Mask","DS/IPTableMePreferences/services/PlatformURL","DS/IPTableMePreferences/services/WSAccess","DS/IPTableMePreferences/utils/GridUtils","DS/Utilities/Dom","DS/Utilities/Utils","DS/Controls/ComboBox","DS/Controls/LineEditor","DS/Tweakers/GeneratedToolbar","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","UWA/Widget"],(function(e,t,o,i,n,s,a,l,r,d,c,p,u,h,m,f,g){"use strict";const E="IPTableMePreferences";var w,v,P,b=[],_=void 0;function M({reset:e}={}){this.options.activePref._upgradeVersion=!e,this.elements.toolbar.updateNodeModel("reset",{visibleFlag:!e})}function S(){return!!this.options.activePref._upgradeVersion}const y=e=>{e.elements.toolbar.updateNodeModel("cancel",{visibleFlag:!1});const i=e.elements.toolbar.getNodeModelByID("editView"),n=e.elements.toolbar.getNodeModelByID("addView");"_defaultView"!==e.options.activeView?(["addView","editView","removeView"].forEach((t=>e.elements.toolbar.updateNodeModel(t,{visibleFlag:!0}))),i.options.icon&&"check"===i.options.icon.iconName?e.elements.toolbar.updateNodeModel("editView",{icon:{iconName:"pencil",fontIconFamily:WUXManagedFontIcons.Font3DS},tooltip:new o({title:t.tooltip.title.editView,mouseRelativePosition:!1,shortHelp:t.tooltip.editView})}):n.options.icon&&"check"===n.options.icon.iconName&&e.elements.toolbar.updateNodeModel("addView",{icon:{iconName:"plus",fontIconFamily:WUXManagedFontIcons.Font3DS},tooltip:new o({title:t.tooltip.title.newView,mouseRelativePosition:!1,shortHelp:t.tooltip.newView})})):(e.elements.toolbar.updateNodeModel("addView",{visibleFlag:!0}),n.options.icon&&"check"===n.options.icon.iconName&&e.elements.toolbar.updateNodeModel("addView",{icon:{iconName:"plus",fontIconFamily:WUXManagedFontIcons.Font3DS},tooltip:new o({title:t.tooltip.title.newView,mouseRelativePosition:!1,shortHelp:t.tooltip.newView})})),e.elements.toolbar.updateNodeModel("reset",{visibleFlag:S.call(e)}),D(e.elements.hdrCombo,!0),D(e.elements.hdrEditor,!1),e.__addInProgress=!1,e.__editInProgress=!1,e.elements.content.removeAttribute("disabled")},I=(e,i)=>{["addView","editView","removeView"].forEach((t=>i.elements.toolbar.updateNodeModel(t,{visibleFlag:e===t}))),i.elements.toolbar.updateNodeModel("cancel",{visibleFlag:!0}),i.elements.toolbar.updateNodeModel(e,{icon:{iconName:"check",fontIconFamily:WUXManagedFontIcons.Font3DS},tooltip:new o({title:t.tooltip.title.check,mouseRelativePosition:!1,shortHelp:t.tooltip.check})}),i.elements.toolbar.updateNodeModel("reset",{visibleFlag:!1}),D(i.elements.hdrCombo,!1),D(i.elements.hdrEditor,!0);const n=i.options.viewModel.getSelectedNodes()[0];i.elements.hdrEditor.value="addView"===e?t.replace(t.views.copyOf,{MP_VIEW_NAME:n.getLabel()}):n.getLabel(),i.elements.content.setAttribute("disabled","")},T=()=>{let e=Date.now().toString(16)+Math.random().toString(16)+"0".repeat(16);return[e.substr(0,8),e.substr(8,4),"4000-8"+e.substr(13,3),e.substr(16,12)].join("-")},C=(e,t,o=null,i=null,n=[])=>new f({label:e,comboBoxSemantics:t,value:o,uuid:i,icons:n,children:[]}),D=(e,t)=>{e.getContent().toggleClassName("hidden",!t)},N=(e,o=!1)=>{const i=t.views[e.MP_VIEW_NAME]||e.MP_VIEW_NAME,n=e.MP_UUID||T();return{MP_ADMIN:o,MP_SELECTED_COLS:e.MP_SELECTED_COLS,MP_SELECTED_EXTS:e.MP_SELECTED_EXTS,MP_SELECTED_TYPES:e.MP_SELECTED_TYPES,MP_UUID:n,MP_VIEW_NAME:i}},A=e=>{if("localView"!==e.MP_UUID&&!e.MP_UUID.startsWith("_")){var o=w&&e.MP_ADMIN?w:_;const i=t.views[e.MP_VIEW_NAME]||e.MP_VIEW_NAME;o&&o.addChild(C(i,"subsection",i,e.MP_UUID))}},V=function(e){Array.isArray(e.MP_SELECTED_COLS)&&(e.MP_SELECTED_COLS=e.MP_SELECTED_COLS.map((e=>{const t={};for(const o of columnsToKeep){if(!(o in e))continue;const i=e[o];"visibleFlag"===o&&!0===i||"forceHidden"===o&&!1===i||"pinned"===o&&(""===i||"unpinned"===i)||"kind"===o&&"string"===i||""===i||void 0===i||(t[o]=i)}return t})))};function R(e){var o,i,n;if(this.elements={},this.options=e||{},this.options=Object.assign({},this.options),this.options.preferenceName=r.getURLParameter("prefName"),this.options.appId=e.appId?e.appId.replace(/_AP$/,""):"ENOFOL3",this.options.jsonPref={views:{}},0===Object.keys(this.options.defaultJSON).length&&(this.options.defaultJSON={MP_VIEWS:{}}),this.options.defaultConf&&(this.options.jsonPref.views._defaultView={MP_SELECTED_COLS:this.options.defaultConf.MP_SELECTED_COLS,MP_SELECTED_EXTS:this.options.defaultConf.MP_SELECTED_EXTS,MP_SELECTED_TYPES:this.options.defaultConf.MP_SELECTED_TYPES,MP_VIEW_NAME:t.views.MP_DEFAULT,MP_UUID:"_defaultView"},this.options.defaultJSON.MP_VIEWS||(this.options.defaultJSON.MP_VIEWS={}),this.options.defaultJSON.MP_VIEWS._defaultView=this.options.jsonPref.views._defaultView),e.frameCntWindow.postMessage({message:"com.ds.mep:InWidget"},e.mepOrigin),widget||((widget=new g).setValue("x3dAppId",e.appId),widget.setValue("x3dPlatformId",e.tenantID)),w=C(t.commandMenu.admin,"section",null,"admin-section",[{iconName:"building-office",fontIconFamily:WUXManagedFontIcons.Font3DS}]),_=C(t.commandMenu.user,"section",null,"user-section",[{iconName:"user",fontIconFamily:WUXManagedFontIcons.Font3DS}]),o=this.options.appId,i=this.options.preferenceName,n=this.options.lockState,v=[`${o}_TABLE_DEFAULT`].includes(i)?!P:"true"===n,this.options.preferenceName===`${this.options.appId}_TABLE_CUSTO`)for(const e in this.options.defaultJSON.MP_VIEWS){const t=this.options.defaultJSON.MP_VIEWS[e],o=N(t,t.MP_ADMIN);this.options.jsonPref.views[o.MP_UUID]=o}else for(const e in this.options.defaultJSON.MP_VIEWS){const t=this.options.defaultJSON.MP_VIEWS[e],o=N(t,t.MP_ADMIN);this.options.jsonPref.views[o.MP_UUID]=o}for(const e in this.options.jsonPref.views){const t=this.options.jsonPref.views[e];A(t)}return this.options.activeView=this.options.activeViewInDGV||Object.values(this.options.jsonPref.views)[0].MP_UUID,this.options.localWindow.addEventListener("message",(e=>{let t=e.data,o="";if(t.message&&(o=t.message),"com.ds.mep:OnOKBtnClicked_msg"===o){let e={message:"com.ds.mep:OnPrefUpdated_msg"};if(this.options.preferenceName===`${this.options.appId}_TABLE_DEFAULT`){(i={}).MP_UUID=this.options.activeView}else{var i={MP_VIEWS:{},MP_ACTIVE_VIEW:this.options.activeView};this.options.jsonPref.views[this.options.activePref.MP_UUID]=this.options.activePref,i.MP_VIEWS=Object.fromEntries(Object.entries(this.options.jsonPref.views).filter((([e,t])=>!t.MP_ADMIN&&!["_defaultView","localView"].includes(e))));for(let e in i.MP_VIEWS){let t=this.options.jsonPref.views[e];V(t),t._upgradeVersion&&(t.MP_VERSION||(t.MP_VERSION=0),t.MP_VERSION+=1);for(let e in t)e.startsWith("MP_")||delete t[e];delete t.MP_ADMIN}}e.jsonData=JSON.stringify(i),this.options.frameCntWindow.postMessage(e,this.options.mepOrigin),this.options.frameCntWindow.postMessage({message:"com.ds.mep:UpdateLocalView",activeView:this.options.activeView,views:this.options.jsonPref.views,originLocal:this.options.jsonPref.originLocal},this.options.mepOrigin)}if("com.ds.mep:InWidgetOK"===o&&(widget.options={title:t.title,credential:t.credential},P=widget.options.credential.contains("VPLMAdmin")),"com.ds.mep:setLocalView"===o){let e=this.options.jsonPref.views[t.view.UUID_RELATED_VIEW];e&&(this.options.jsonPref.originLocal={view:UWA.clone(e)},toCopyFromLocal.forEach((o=>{e[o]=t.view[o]}))),this.options.activeView=t.view.UUID_RELATED_VIEW||t.view.MP_UUID,"localView"===t.view.MP_UUID&&(this.options.jsonPref.views.localView=t.view,this.options.jsonPref.localView=t.view.MP_UUID)}"com.ds.mep:setDefaultView"===o&&(this.options.jsonPref.views._defaultView=t.view),"com.ds.mep:setActiveView"===o&&this.options.withUserView&&(this.options.activeView=t.viewId)})),this}return R.prototype.initialize=async function(){if(r.setLang(this.options.compassConfig.lang),await a.initialize(this.options.compassConfig),await async function(e){if(e.options.withAdminView)try{const t=await l.getAdminViews(),o=JSON.parse(t.views||"{}");for(const[t,i]of Object.entries(o))e.options.jsonPref.views[t]=N(i,!0),e.options.defaultJSON.MP_VIEWS[t]=e.options.jsonPref.views[t],A(e.options.jsonPref.views[t])}catch(e){console.error("Error during admin views fetch:",e)}let t;if(e.options.isOdt)t=!0;else try{t=await l.isAdmin()}catch(e){t=!1}return t}(this),this.options.jsonPref.views.localView){((e,t)=>{const o=e.filter((e=>!e.notInPreference));b=e.filter((e=>e.notInPreference)),e.splice(0,e.length,...o)})(this.options.jsonPref.views.localView.MP_SELECTED_COLS)}Promise.all([this.__buildUX(),this.__updateView()])},R.prototype.__buildUX=async function(){this.elements.container=d.createElement("div",{class:E+"-frame "+E+"-locked"}),this.elements.hdr=d.createElement("div",{class:E+"-hdr"}),this.elements.container.appendChild(this.elements.hdr),this.__buildToolbarUX(),this.elements.content=d.createElement("div",{class:E+"-content "+E+" content-locked"}),this.elements.container.appendChild(this.elements.content);const e=E+"-frame "+E,t=E+"-content "+E;this.elements.container.className=v?e+"-locked":e,this.elements.content.className=v?t+" content-locked":t,document.getElementById(this.options.targetId)?this.elements.targetDiv=document.getElementById(this.options.targetId):this.elements.targetDiv=document.getElementsByClassName(this.options.targetId)[0],this.options.creationModal?(this.options.creationModal.innerHTML="",this.options.creationModal.appendChild(this.elements.container)):(this.elements.targetDiv.innerHTML="",this.elements.targetDiv.appendChild(this.elements.container))},R.prototype.__selectAttChange=function(e){const i=this.elements.selectedAttributes.getSelectedColumns().length,n=e.length+i;let s=!(e.length>0&&n<=30);this.elements.toolbarArrow.updateNodeModel("arrowRight",{disabled:s,tooltip:new o({title:t.tooltip.title.addColumn,mouseRelativePosition:!1,shortHelp:s?t.tooltip.addColumn+t.tooltip.maximumColumn:t.tooltip.addColumn}),grid:{disabled:s}})},R.prototype.__addSelectedAttChange=function(e){let i=e.some((e=>!0===e.getReferenceValue("mandatory")));e.length<1?this.elements.toolbarArrow.updateNodeModel("arrowLeft",{icon:{iconName:"left",fontIconFamily:WUXManagedFontIcons.Font3DS},disabled:!0,tooltip:new o({title:t.tooltip.title.removeColumn,mouseRelativePosition:!1,shortHelp:t.tooltip.removeColumn}),grid:{disabled:!0}}):i?this.elements.toolbarArrow.updateNodeModel("arrowLeft",{icon:{iconName:"block",fontIconFamily:WUXManagedFontIcons.Font3DS},disabled:!0,tooltip:new o({title:t.tooltip.title.lockedColumn,mouseRelativePosition:!1,shortHelp:t.tooltip.lockedColumn}),grid:{disabled:!0}}):this.elements.toolbarArrow&&this.elements.toolbarArrow.updateNodeModel("arrowLeft",{icon:{iconName:"left",fontIconFamily:WUXManagedFontIcons.Font3DS},disabled:!1,tooltip:new o({title:t.tooltip.title.removeColumn,mouseRelativePosition:!1,shortHelp:t.tooltip.removeColumn}),grid:{disabled:!1}})},R.prototype.__addToSelectedAtt=function(e=void 0){let t=this.elements.attSelection.removeSelectedNodes();delete t[0].options.grid.notInPreference,this.elements.selectedAttributes.addSelectedNodes(t,e)},R.prototype.__removeFromSelectedAtt=function(){let e=this.elements.selectedAttributes.removeSelectedNodes();this.elements.attSelection.addSelectedNodes(e)},R.prototype.__typesAndExtsChange=function(e){this.options.activePref=Object.assign(this.options.activePref,e),M.call(this)},R.prototype.__selectedAttChange=function(e){this.options.activePref=this.options.jsonPref.views[this.options.activeView],this.options.activePref.MP_SELECTED_COLS=e,M.call(this)},R.prototype.updateToolbarState=function(){const e=P?"admin":"user",i=this.options.viewModel.getRoots().find((t=>t.options.uuid===`${e}-section`)).getChildren().length;this.elements.toolbar.updateNodeModel("addView",{icon:{iconName:"plus",fontIconFamily:WUXManagedFontIcons.Font3DS},disabled:i>=4,grid:{disabled:i>=4},tooltip:new o({title:t.tooltip.title.newView,mouseRelativePosition:!1,shortHelp:i>=4?t.tooltip.newView+t.tooltip.maximumView:t.tooltip.newView})}),this.elements.toolbarArrow.updateNodeModel("arrowRight",{tooltip:new o({title:t.tooltip.title.addColumn,mouseRelativePosition:!1,shortHelp:this.options.activePref.MP_SELECTED_COLS.length<30?t.tooltip.addColumn:t.tooltip.addColumn+t.tooltip.maximumColumn})})},R.prototype.__manageView=async function(e){const{jsonPref:o}=this.options,{hdrEditor:i}=this.elements,n=(e,t,o)=>{r.displayNotif({level:"warning",title:e,message:t,sticky:!1,key:o})},s=e=>this.options.viewModel.search({match:t=>t.nodeModel.getLabel()===e}).length>0;switch(e){case"addView":if(this.__addInProgress){const e=i.value;if(e.length<=0)n(t.warning.emptyName.title,t.warning.emptyName.msg,"emptyName");else if(s(e))n(t.warning.viewAlreadyExistsAdd.title,t.replace(t.warning.viewAlreadyExistsAdd.msg,{MP_VIEW_NAME:this.options.activePref.MP_VIEW_NAME}),"viewAlreadyExistsAdd");else{["editView","removeView"].forEach((e=>this.elements.toolbar.updateNodeModel(e,{disabled:!1}))),delete this.__addInProgress;let t=UWA.clone(this.options.activePref);delete t._upgradeVersion;var a=P?w:_;t.MP_UUID=T(),t.MP_VIEW_NAME=e,t.MP_VERSION=1,this.options.viewModel.prepareUpdate(),this.options.jsonPref.views[t.MP_UUID]=N(t,!!P||void 0),this.options.defaultJSON.MP_VIEWS[t.MP_UUID]=N(t,!!P||void 0),A(this.options.jsonPref.views[t.MP_UUID]),this.options.viewModel.pushUpdate(),this.options.activePref=o.views[t.MP_UUID],this.options.activePref.MP_VIEW_NAME=e,this.options.activeView=t.MP_UUID,this.elements.hdrCombo.elements.expander.click(),await new Promise((e=>setTimeout(e,0))),this.elements.hdrCombo.elements.expander.click(),a.getLastChild().select(!0),y(this),this.updateToolbarState()}}else I("addView",this),this.__addInProgress=!0;break;case"editView":if(this.__editInProgress){const e=i.value;if(e.length<=0)n(t.warning.emptyName.title,t.warning.emptyName.msg,"emptyName");else if(s(e))n(t.warning.viewAlreadyExistsMod.title,t.replace(t.warning.viewAlreadyExistsMod.msg,{MP_VIEW_NAME:e}),"viewAlreadyExistsMod");else{["addView","removeView"].forEach((e=>this.elements.toolbar.updateNodeModel(e,{disabled:!1}))),delete this.__editInProgress;const t=this.options.viewModel.getSelectedNodes()[0],o=this.options.jsonPref.views[t.options.uuid];t.prepareUpdate(),t.updateOptions({label:e,value:e}),t.pushUpdate(),o.MP_VIEW_NAME=e,this.options.jsonPref.views[t.options.uuid]=o,this.elements.hdrCombo.elements.expander.click(),this.elements.hdrCombo.elements.expander.click(),y(this)}}else I("editView",this),this.__editInProgress=!0;break;case"removeView":{const e=this.options.viewModel.getSelectedNodes()[0];a=P?w:_;delete o.views[e.options.uuid],this.options.viewModel.prepareUpdate(),this.options.viewModel.getRoots().forEach((t=>{const o=t.getChildren();if(!o)return;const i=o.find((t=>t.options.uuid===e.options.uuid));i&&i.remove()})),this.options.viewModel.pushUpdate();const t=a.getLastChild();this.options.activeView=t?t.options.uuid:"_defaultView",this.options.activePref=o.views[this.options.activeView],this.updateToolbarState(),t?t.select():this.options.viewModel.getChildren()[0].select();break}case"resetView":{const e=this.options.viewModel.getSelectedNodes()[0],t=e.options.icons.findIndex((e=>"IP_Warning"===e.className));-1!==t&&(e.options.icons.splice(t,1),this.elements.hdrCombo._selectedIndexModified()),this.options.jsonPref.views[e.options.uuid]=UWA.clone(this.options.defaultJSON.MP_VIEWS[e.options.uuid]),this.options.jsonPref.originLocal&&e.options.uuid===this.options.jsonPref.originLocal.view.MP_UUID&&delete this.options.jsonPref.originLocal,M.call(this,{reset:!0}),this.__updateView();break}}},R.prototype.__buildArrowUX=function(){let e=d.createElement("div",{class:E+"-arrows"});this.elements.content.appendChild(e);let i={entries:[{id:"arrowRight",dataElements:{typeRepresentation:TOOLBAR_RENDERING,tooltip:new o({title:t.tooltip.title.addColumn,mouseRelativePosition:!1,shortHelp:t.tooltip.addColumn}),icon:{iconName:"right",fontIconFamily:WUXManagedFontIcons.Font3DS},value:()=>{this.__addToSelectedAtt()},position:"center",category:"hdrArrow",disabled:!0}},{id:"arrowLeft",dataElements:{typeRepresentation:TOOLBAR_RENDERING,tooltip:new o({title:t.tooltip.title.removeColumn,mouseRelativePosition:!1,shortHelp:t.tooltip.removeColumn}),icon:{iconName:"left",fontIconFamily:WUXManagedFontIcons.Font3DS},value:this.__removeFromSelectedAtt.bind(this),position:"center",category:"hdrArrow",disabled:!0}}]},n=h.prototype.createTreeDocument(i);this.elements.toolbarArrow=new h({overflowManagement:"dropdown",direction:"vertical",items:n}),this.elements.toolbarArrow.getContent().addClassName(E+"-toolbar-arrow"),e.appendChild(this.elements.toolbarArrow.getContent())},R.prototype.__buildSelectedAttributesUX=function(){var e=this.options.activePref=this.options.jsonPref.views[this.options.activeView];e||this.options.jsonPref.views.localView.UUID_RELATED_VIEW!==this.options.activeView||(e=this.options.activePref=this.options.jsonPref.views.localView,this.options.activeView="localView");const t=v||!P&&e&&e.MP_ADMIN;this.elements.selectedAttributes=new n({locked:t||e&&"_defaultView"===e.MP_UUID&&this.options.withUserView,defaultConf:this.options.defaultConf,parent:this,exportEnabled:!1,onSelectionChange:this.__addSelectedAttChange.bind(this),onSelectedAttributeChange:this.__selectedAttChange.bind(this)}),this.elements.content.appendChild(this.elements.selectedAttributes.getContent())},R.prototype.__buildAttributesSelectionUX=function(){this.elements.attSelection=new i({onSelectionChange:this.__selectAttChange.bind(this),onTypesAndExtsChange:this.__typesAndExtsChange.bind(this),defaultConf:this.options.defaultConf,parent:this,enableTypes:this.options.withUserView,additionalColumns:b}),this.elements.content.appendChild(this.elements.attSelection.getContent())},R.prototype.__buildToolbarUX=async function(){let e=d.createElement("div",{class:E+"-hdr-label"});e.innerText=t.views.viewLabel,this.elements.hdr.appendChild(e),this.options.viewModel=new m({shouldBeSelected:e=>"section"!==e.options.comboBoxSemantics});const i=C(t.commandMenu.default,"subsection",null,"_defaultView");this.options.defaultConf&&this.options.viewModel.addRoot(i);let n=null;if(widget.options&&widget.options.title){let e=this.options.jsonPref.views[this.options.jsonPref.localView];if(e){let o=this.options.jsonPref.views[e.UUID_RELATED_VIEW];if(n=o&&e.MP_VERSION?e.UUID_RELATED_VIEW:null,!o&&!this.options.withUserView){const e=o?` (${o.MP_VIEW_NAME})`:"",i=`${this.options.jsonPref.views.localView.MP_VIEW_NAME||t.commandMenu.widget}${e}`,n=C(i,"subsection",null,"localView");this.options.viewModel.addRoot(n)}}}this.options.viewModel.addRoot(w),this.options.viewModel.addRoot(_);let s=!1;if(n){let e=this.options.viewModel.getAllDescendants().find((e=>e.options.uuid===n));e&&(s=!0,e.updateOptions({icons:[{iconName:"attention",fontIconFamily:WUXManagedFontIcons.Font3DS,className:"IP_Warning",tooltip:t.tooltip.modificationNotStored}]}))}this.options.viewModel.expandAll();let a={entries:[{id:"addView",dataElements:{typeRepresentation:TOOLBAR_RENDERING,tooltip:new o({title:t.tooltip.title.newView,mouseRelativePosition:!1,shortHelp:t.tooltip.newView}),icon:{iconName:"plus",fontIconFamily:WUXManagedFontIcons.Font3DS},value:()=>{this.__manageView("addView")},position:"near",category:"hdrcmd",disabled:Object.values(this.options.jsonPref.views).filter((e=>!e.MP_ADMIN)).length>=4}},{id:"editView",dataElements:{typeRepresentation:TOOLBAR_RENDERING,tooltip:new o({title:t.tooltip.title.editView,mouseRelativePosition:!1,shortHelp:t.tooltip.editView}),icon:{iconName:"pencil",fontIconFamily:WUXManagedFontIcons.Font3DS},value:()=>{this.__manageView("editView")},position:"near",category:"hdrcmd"}},{id:"removeView",dataElements:{typeRepresentation:TOOLBAR_RENDERING,tooltip:new o({title:t.tooltip.title.removeView,mouseRelativePosition:!1,shortHelp:t.tooltip.removeView}),icon:{iconName:"trash",fontIconFamily:WUXManagedFontIcons.Font3DS},value:e=>{this.__manageView("removeView")},position:"near",category:"hdrcmd",disabled:!1}},{id:"cancel",dataElements:{typeRepresentation:TOOLBAR_RENDERING,tooltip:new o({title:t.tooltip.title.cancel,mouseRelativePosition:!1,shortHelp:t.tooltip.cancel}),icon:{iconName:"close",fontIconFamily:WUXManagedFontIcons.Font3DS},value:()=>{y(this)},position:"near",category:"hdrcmd",visibleFlag:!1,disabled:!1}},{id:"reset",label:t.tooltip.title.reset,dataElements:{typeRepresentation:"function",tooltip:new o({title:t.tooltip.title.reset,mouseRelativePosition:!1,shortHelp:t.tooltip.reset}),icon:{iconName:"reset",fontIconFamily:WUXManagedFontIcons.Font3DS},value:()=>{this.__manageView("resetView")},position:"far",category:"hdrcmd",visibleFlag:s,disabled:!1}}]},l=h.prototype.createTreeDocument(a),r=d.createElement("div",{class:E+"-hdr-view"});this.elements.hdr.appendChild(r);var c=-1;const f=this.options.viewModel,g=f.getRoots(),b=f.getAllDescendants().map((e=>e.options.uuid));-1==b.indexOf(this.options.activeView)&&this.options.jsonPref.views.localView&&this.options.jsonPref.views.localView.UUID_RELATED_VIEW===this.options.activeView&&(this.options.activeView="localView"),g.length&&(c=b.indexOf(this.options.activeView));let M=this.elements.hdrCombo=new p({disabled:!this.options.withUserView,enableSearchFlag:!1,elementsTree:this.options.viewModel,selectedIndex:c});if(M.getContent().addEventListener("change",(e=>{if(e.dsModel.elementsTree.getSelectedNodes().length){let t=e.dsModel.elementsTree.getSelectedNodes()[0],o=t.options.uuid;if(o||(o=t.options.label),this.options.activeView=o,this.options.activePref=this.options.jsonPref.views[this.options.activeView],!this.options.activePref)return;const i=v||this.options.activePref&&!P&&this.options.activePref&&this.options.activePref.MP_ADMIN;this.elements.selectedAttributes.options.locked=i||"_defaultView"===this.options.activePref.MP_UUID&&this.options.withUserView,this.__updateView(),this.elements.toolbar.updateNodeModel("reset",{visibleFlag:S.call(this)})}})),M.getContent().addClassName(E+"-hdr-combo"),r.appendChild(M.getContent()),this.elements.toolbar=new h({overflowManagement:"dropdown",direction:"horizontal",items:l}),this.elements.toolbar.getContent().addClassName(E+"-toolbar"),!(P&&v||this.options.preferenceName===`${this.options.appId}_TABLE_DEFAULT`)){let e=this.elements.hdrEditor=new u({requiredFlag:!0,displayClearFieldButtonFlag:!0,maxLength:50});e.getContent().addClassName(E+"-hdr-editor hidden"),r.appendChild(e.getContent());let t=d.createElement("div",{class:E+"-hdr-toolbar"});this.elements.hdr.appendChild(t),t.appendChild(this.elements.toolbar.getContent())}},R.prototype.__updateView=async function(){await new Promise((e=>setTimeout(e))),s.mask(this.options.creationModal||this.elements.targetDiv,t.loading.gridCusto),this.elements.content.style.display="none";const{options:e,elements:o}=this,{activeView:i,jsonPref:n,preferenceName:a,lockState:l,viewModel:r}=e,d=e=>{o.container.className=`${E}-frame${e?` ${E}-locked`:""}`,o.content.className=`${E}-content${e?` ${E} content-locked`:""}`,e?(o.content.children[0].classList.add("hidden"),o.content.children[1].classList.add("hidden")):(o.content.children[0].classList.remove("hidden"),o.content.children[1].classList.remove("hidden")),o.content.children[0].hidden=e,o.content.children[1].hidden=e};this.elements.content.style.display="";let c=e.activePref=n.views[i];!c&&n.views.localView&&n.views.localView.UUID_RELATED_VIEW===i&&(c=this.options.activePref=n.views.localView),c&&(o.content.children[0]||this.__buildAttributesSelectionUX(),o.content.children[1]||this.__buildArrowUX(),o.content.children[2]||this.__buildSelectedAttributesUX(),a===`${this.options.appId}_TABLE_DEFAULT`?(d(!0),r.getChildren().forEach((e=>{if(e.getChildren()){const t=e.getChildren().find((e=>e.options.uuid===this.options.activeView));t&&t.select()}}))):c&&c.MP_ADMIN&&!P||c&&[c.MP_UUID,c.UUID_RELATED_VIEW].includes("_defaultView")&&this.options.withUserView?(d(!0),["editView","removeView"].forEach((e=>o.toolbar.updateNodeModel(e,{visibleFlag:!1}))),this.elements.selectedAttributes.elements.toolbar.hide()):(d(!1),c&&["localView"].includes(c.MP_UUID)?(["editView","removeView"].forEach((e=>o.toolbar.updateNodeModel(e,{visibleFlag:!1}))),this.elements.selectedAttributes.elements.toolbar.hide()):(o.toolbar.updateNodeModel("editView",{visibleFlag:!0}),o.toolbar.updateNodeModel("removeView",{visibleFlag:!0}),this.elements.selectedAttributes.elements.toolbar.show())),this.options.withUserView&&!v||(["editView","removeView"].forEach((e=>o.toolbar.updateNodeModel(e,{visibleFlag:!1}))),this.elements.selectedAttributes.elements.toolbar.hide()),this.options.withUserView||(["addView"].forEach((e=>o.toolbar.updateNodeModel(e,{visibleFlag:!1}))),this.elements.selectedAttributes.elements.toolbar.show()),o.selectedAttributes.updateAttList(c),o.attSelection.updateAttList(c),this.updateToolbarState()),s.unmask(this.options.creationModal||this.elements.targetDiv)},R}));