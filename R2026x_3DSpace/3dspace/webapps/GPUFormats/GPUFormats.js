define("DS/GPUFormats/TextureLODPool",["DS/Mesh/ThreeJS_Base"],(function(e){"use strict";var t=function(){this.totalSize=0,this.textures=[]};return t.prototype.removeUnusedTextures=function(){for(var t=[],r=0;r<this.textures.length;r++){var a=this.textures[r];if(a.textureLOD.usedTexture!==a.lod){var i=a.textureLOD.textures[a.lod],s=a.textureLOD.textures[a.textureLOD.usedTexture];s&&s.loadEndStatus!==e.AssetLoadingStatus.READY?t.push(a):(i.dispose(),a.textureLOD.textures[a.lod]=null,this.totalSize-=a.size)}else t.push(a)}this.textures=t},t.prototype.add=function(e){this.totalSize+=e.size,this.textures.push(e)},t})),define("DS/GPUFormats/WebGLUniformUtils",["DS/Mesh/ThreeJS_Base"],(function(e){"use strict";const t={loadObjectUniforms(t,r,a,i,s,o,n){let l=t.gl;if(r.quantizedVector&&l.uniform3f(r.quantizedVector,i.quantizedVector.x,i.quantizedVector.y,i.quantizedVector.z),r.offsetVector&&l.uniform3f(r.offsetVector,i.offsetVector.x,i.offsetVector.y,i.offsetVector.z),r.compressionContext&&(t.loadTexture(l,r.compressionContext,i.compressionContext),l.uniform1f(r.ccSize,i.compressionContext.image.width)),r.lightMap&&(n&&n._lightMap?(t.loadTexture(l,r.lightMap,n._lightMap.texture),l.uniformMatrix3fv(r.lightMapUvTransform,!1,t.float32Matrix3x3Temp.setDoubles(n._lightMap.uvTransform.elements)),l.uniform1i(r.lightMapUvSlot,n._lightMap.uvSlot?n._lightMap.uvSlot:1)):(t.loadTexture(l,r.lightMap,i.lightMap),l.uniformMatrix3fv(r.lightMapUvTransform,!1,t.float32Matrix3x3Temp.setDoubles((a.lightMapData.lightMapUvTransform?a.lightMapData.lightMapUvTransform:t._dummyMat3).elements)),l.uniform1i(r.lightMapUvSlot,a.lightMapData.lightMapUvSlot?a.lightMapData.lightMapUvSlot:1))),r.displacementRadius&&l.uniform1f(r.displacementRadius,a.boundingSphere.radius),r.billboardType){var u=a._billboardData;l.uniform1i(r.billboardType,u.type),u.type>1&&(u.axis?l.uniform3f(r.billboardAxis,u.axis.x,u.axis.y,u.axis.z):l.uniform3f(r.billboardAxis,0,0,1)),u.rotation?(l.uniform1i(r.billboardRotationEnabled,1),l.uniformMatrix4fv(r.billboardRotation,!1,t.float32Matrix4x3Temp.setDoubles(u.rotation.elements))):l.uniform1i(r.billboardRotationEnabled,0)}let m=a.matrixWorld,d=a._mElements;if(r.belowInstancingModelMatrix){let t=a._occurrence;for(;t&&!t.node._instancingInfos;)t=t.parent;if(t){m=t.matrix;let i=new e._Float32Matrix4;i._fromMatrix4WithLowPartTranslation(m),d=i.elements,l.uniformMatrix4fv(r.belowInstancingModelMatrix,!1,a.matrixWorld.elements)}else console.warn("No InstancingNode found for this instanced object"),l.uniformMatrix4fv(r.belowInstancingModelMatrix,!1,(new e.Matrix4).identity())}if(r.skinningMap?t.loadTexture(l,r.skinningMap,a._skinningData.skinning.skinningMap):r.skinningInstancingMaps&&t.loadTextureArray(l,r.skinningInstancingMaps,a._skinningData.skinningInstancing.skinningInstancingMaps),r.fixedSizeCenterRatio&&l.uniform4f(r.fixedSizeCenterRatio,a._ratioData.center.x,a._ratioData.center.y,a._ratioData.center.z,a._ratioData.ratio),r.decalStencilValue&&a._decalData&&(l.uniform1f(r.decalStencilValue,a._decalData.stencilID),l.uniform1i(r.decalExplicitUv,a._decalData.explicitUv),l.uniform1f(r.decalDepthOffset,a._decalData.depthOffset)),r.objectColorBufferType&&l.uniform1f(r.objectColorBufferType,a._vertexColors),t.currentModelMatrix!==m){if(r.modelViewMatrix&&(a._modelViewMatrix||(a._modelViewMatrix=new e._Float32Matrix4,a._modelViewMatrix._multiplyMatricesMV(o.matrixWorldInverse,m)),l.uniformMatrix4fv(r.modelViewMatrix,!1,a._modelViewMatrix.elements)),r.modelMatrix&&l.uniformMatrix4fv(r.modelMatrix,!1,d),r.modelInvRotMatrix){if(!a._modelInvRotMatrix){var c=(new e.Matrix4).getInverse(m);a._modelInvRotMatrix=(new e.Matrix4).extractRotation(c)}l.uniformMatrix4fv(r.modelInvRotMatrix,!1,t.float32Matrix4x3Temp.setDoubles(a._modelInvRotMatrix.elements))}if(s._PDSFXData&&s._PDSFXData.PDSFX&&(r.modelInvTranspMatrix&&(null===a.modelInvTranspMatrix&&(a.modelInvTranspMatrix=(new e.Matrix4).getInverse(m).transpose()),l.uniformMatrix4fv(r.modelInvTranspMatrix,!1,t.float32Matrix4x3Temp.setDoubles(a.modelInvTranspMatrix.elements))),r.modelViewInvTranspMatrix&&(null===a.modelViewInvTranspMatrix&&(a.modelViewInvTranspMatrix=(new e._Float32Matrix4).multiplyMatricesAndInverse(o.matrixWorldInverse,m).transpose()),l.uniformMatrix4fv(r.modelViewInvTranspMatrix,!1,a.modelViewInvTranspMatrix.elements)),r._instancingData)){const e=a._pdsfxInstancingData,i=e.getSizes();t.loadTexture(l,r._instancingData,e),l.uniform2f(r._instancingDataSize,i.width,i.height)}r.modelViewInvMatrix&&(null===a.modelViewInvMatrix&&(a.modelViewInvMatrix=(new e._Float32Matrix4).multiplyMatricesAndInverse(o.matrixWorldInverse,m)),l.uniformMatrix4fv(r.modelViewInvMatrix,!1,a.modelViewInvMatrix.elements)),r.normalMatrix&&l.uniformMatrix3fv(r.normalMatrix,!1,t.float32Matrix3x3Temp.setDoubles(a._normalMatrix.elements)),t.currentModelMatrix=m}if(r.backgroundViewModeControl){const e=t._backgroundColor?t._backgroundColor.r:0,i=t._backgroundColor?t._backgroundColor.g:0,s=t._backgroundColor?t._backgroundColor.b:0;l.uniform4f(r.backgroundViewModeControl,e,i,s,a.applyBackgroundViewMode?1:0)}r.backgroundViewModeNearFar&&l.uniform2f(r.backgroundViewModeNearFar,o.near,o.far),t.currentRenderInfo.objectUniformCalls++},_load_MM(e,t,r,a,i,s,o){e.currentModelMatrix!==r.matrixWorld&&(e.gl.uniformMatrix4fv(t.modelMatrix,!1,r._mElements),e.currentModelMatrix=r.matrixWorld,e.currentRenderInfo.objectUniformCalls++)},_load_MM_NM(e,t,r,a,i,s,o){e.currentModelMatrix!==r.matrixWorld&&(e.gl.uniformMatrix4fv(t.modelMatrix,!1,r._mElements),e.gl.uniformMatrix3fv(t.normalMatrix,!1,e.float32Matrix3x3Temp.setDoubles(r._normalMatrix.elements)),e.currentModelMatrix=r.matrixWorld,e.currentRenderInfo.objectUniformCalls++)},_load_MVM(t,r,a,i,s,o,n){t.currentModelMatrix!==a.matrixWorld&&(a._modelViewMatrix||(a._modelViewMatrix=new e._Float32Matrix4,a._modelViewMatrix._multiplyMatricesMV(o.matrixWorldInverse,a.matrixWorld)),t.gl.uniformMatrix4fv(r.modelViewMatrix,!1,a._modelViewMatrix.elements),t.currentModelMatrix=a.matrixWorld,t.currentRenderInfo.objectUniformCalls++)},_load_MVM_NM(t,r,a,i,s,o,n){t.currentModelMatrix!==a.matrixWorld&&(a._modelViewMatrix||(a._modelViewMatrix=new e._Float32Matrix4,a._modelViewMatrix._multiplyMatricesMV(o.matrixWorldInverse,a.matrixWorld)),t.gl.uniformMatrix4fv(r.modelViewMatrix,!1,a._modelViewMatrix.elements),t.gl.uniformMatrix3fv(r.normalMatrix,!1,t.float32Matrix3x3Temp.setDoubles(a._normalMatrix.elements)),t.currentModelMatrix=a.matrixWorld,t.currentRenderInfo.objectUniformCalls++)},_load_MM_MVM(t,r,a,i,s,o,n){t.currentModelMatrix!==a.matrixWorld&&(a._modelViewMatrix||(a._modelViewMatrix=new e._Float32Matrix4,a._modelViewMatrix._multiplyMatricesMV(o.matrixWorldInverse,a.matrixWorld)),t.gl.uniformMatrix4fv(r.modelViewMatrix,!1,a._modelViewMatrix.elements),t.gl.uniformMatrix4fv(r.modelMatrix,!1,a._matrixWorldForDoubleGPU.elements),t.currentModelMatrix=a.matrixWorld,t.currentRenderInfo.objectUniformCalls++)},_load_MM_MVM_NM(t,r,a,i,s,o,n){if(t.currentModelMatrix!==a.matrixWorld){a._modelViewMatrix||(a._modelViewMatrix=new e._Float32Matrix4,a._modelViewMatrix._multiplyMatricesMV(o.matrixWorldInverse,a.matrixWorld));let i=t.gl;i.uniformMatrix4fv(r.modelViewMatrix,!1,a._modelViewMatrix.elements),i.uniformMatrix4fv(r.modelMatrix,!1,a._matrixWorldForDoubleGPU.elements),i.uniformMatrix3fv(r.normalMatrix,!1,t.float32Matrix3x3Temp.setDoubles(a._normalMatrix.elements)),t.currentModelMatrix=a.matrixWorld,t.currentRenderInfo.objectUniformCalls++}}},r={loadGlobalUniforms(t,r,a,i){let s=t.gl;if(1===e.WebGLVersion&&(s.uniformMatrix4fv(r.projectionMatrix,!1,t.float32Matrix4x4Temp.setDoubles(i.projectionMatrix.elements)),r.viewMatrix&&s.uniformMatrix4fv(r.viewMatrix,!1,t.float32Matrix4x4Temp.setDoubles(i.matrixWorldInverse.elements)),r.cameraPosition)){let e=t.cameraPosition,a=t.lowPartCameraPosition;s.uniform3f(r.cameraPosition,e.x,e.y,e.z),s.uniform3f(r.lowPartCameraPosition,a.x,a.y,a.z)}let o=t.viewportData;if(a.isPDSFX()){if(r.projectionInvMatrix&&s.uniformMatrix4fv(r.projectionInvMatrix,!1,t.float32Matrix4x4Temp.setDoubles(i.projectionMatrixInverse.elements)),r.viewInvMatrix&&s.uniformMatrix4fv(r.viewInvMatrix,!1,t.float32Matrix4x4Temp.setDoubles(i.matrixWorld.elements)),r.viewInvTranspMatrix&&(s.uniformMatrix4fv(r.viewInvTranspMatrix,!1,t.float32Matrix4x4Temp.setDoubles(i.matrixWorld.transpose().elements)),i.matrixWorld.transpose()),r.lowlightColor){var n=e._getColorMap(t)[e.COLORMAP_INDEX.LOWLIGHT];t.gammaInput&&(n=_tmpColorPickingColor.copyToLinear(n,t.simpleGamma)),s.uniform3f(r.lowlightColor,n.r,n.g,n.b)}r.nearFarLogFactor&&s.uniform3f(r.nearFarLogFactor,i.near,i.far,1/Math.log(i.far/i.near)),r.viewportSize&&s.uniform2f(r.viewportSize,o.viewportWidth,o.viewportHeight)}if(r.pixelToWorldSizeCst&&s.uniform1f(r.pixelToWorldSizeCst,i._pixelToWorldSizeCst),r.billCameraPos||r.billCameraLookAt){s.uniform3f(r.billCameraPos,i.position.x,i.position.y,i.position.z);var l=i.getLookAt();s.uniform3f(r.billCameraLookAt,l.x,l.y,l.z),s.uniform3f(r.billCameraUp,i.up.x,i.up.y,i.up.z),s.uniformMatrix4fv(r.invViewMatrix,!1,t.float32Matrix4x4Temp.setDoubles(i.matrixWorld.elements)),s.uniformMatrix4fv(r.invProjectionMatrix,!1,t.float32Matrix4x4Temp.setDoubles(i.projectionMatrixInverse.elements))}r.viewInfo&&(s.uniform2f(r.viewInfo,i.near,i.far),t.loadTexture(s,r.currentNormalStencilDepth,t.decalBuffers.currentNormalStencilDepthBuffer),t.loadTexture(s,r.currentTexCoord,t.decalBuffers.currentTexCoordBuffer),r.currentRGBADepth&&t.loadTexture(s,r.currentRGBADepth,t.decalBuffers.currentRGBADepthBuffer))},_load_PM(e,t,r,a){e.gl.uniformMatrix4fv(t.projectionMatrix,!1,e.float32Matrix4x4Temp.setDoubles(a.projectionMatrix.elements))},_load_VM(e,t,r,a){e.gl.uniformMatrix4fv(t.viewMatrix,!1,e.float32Matrix4x4Temp.setDoubles(a.matrixWorldInverse.elements))},_load_CP(e,t,r,a){let i=e.gl,s=e.cameraPosition,o=e.lowPartCameraPosition;i.uniform3f(t.cameraPosition,s.x,s.y,s.z),i.uniform3f(t.lowPartCameraPosition,o.x,o.y,o.z)},_load_PM_VM(e,t,r,a){let i=e.gl;i.uniformMatrix4fv(t.projectionMatrix,!1,e.float32Matrix4x4Temp.setDoubles(a.projectionMatrix.elements)),i.uniformMatrix4fv(t.viewMatrix,!1,e.float32Matrix4x4Temp.setDoubles(a.matrixWorldInverse.elements))},_load_PM_CP(e,t,r,a){let i=e.gl;i.uniformMatrix4fv(t.projectionMatrix,!1,e.float32Matrix4x4Temp.setDoubles(a.projectionMatrix.elements));let s=e.cameraPosition,o=e.lowPartCameraPosition;i.uniform3f(t.cameraPosition,s.x,s.y,s.z),i.uniform3f(t.lowPartCameraPosition,o.x,o.y,o.z)},_load_VM_CP(e,t,r,a){let i=e.gl;i.uniformMatrix4fv(t.viewMatrix,!1,e.float32Matrix4x4Temp.setDoubles(a.matrixWorldInverse.elements));let s=e.cameraPosition,o=e.lowPartCameraPosition;i.uniform3f(t.cameraPosition,s.x,s.y,s.z),i.uniform3f(t.lowPartCameraPosition,o.x,o.y,o.z)},_load_PM_VM_CP(e,t,r,a){let i=e.gl;i.uniformMatrix4fv(t.projectionMatrix,!1,e.float32Matrix4x4Temp.setDoubles(a.projectionMatrix.elements)),i.uniformMatrix4fv(t.viewMatrix,!1,e.float32Matrix4x4Temp.setDoubles(a.matrixWorldInverse.elements));let s=e.cameraPosition,o=e.lowPartCameraPosition;i.uniform3f(t.cameraPosition,s.x,s.y,s.z),i.uniform3f(t.lowPartCameraPosition,o.x,o.y,o.z)}};return{__computeGlobalFunc:function(e,t){let a,i=0;for(var s in e)t[s]&&(i|=e[s]);switch(i&~e._IgnoreForFunction){case e.projectionMatrix:a="_load_PM";break;case e.projectionMatrix|e.viewMatrix:a="_load_PM_VM";break;case e.projectionMatrix|e.cameraPosition:a="_load_PM_CP";break;case e.viewMatrix:a="_load_VM";break;case e.cameraPosition|e.viewMatrix:a="_load_VM_CP";break;case e.cameraPosition:a="_load_CP";break;case e.viewMatrix|e.cameraPosition|e.projectionMatrix:a="_load_PM_VM_CP";break;default:a="loadGlobalUniforms"}return r[a]},__computeObjectFunc:function(e,r){let a=0;for(var i in e)r[i]&&(a|=e[i]);let s="";switch(a&~e._IgnoreForFunction){case e.modelMatrix:s="_load_MM";break;case e.modelMatrix|e.normalMatrix:s="_load_MM_NM";break;case e.modelViewMatrix:s="_load_MVM";break;case e.modelViewMatrix|e.normalMatrix:s="_load_MVM_NM";break;case e.modelMatrix|e.modelViewMatrix:s="_load_MM_MVM";break;case e.modelMatrix|e.modelViewMatrix|e.normalMatrix:s="_load_MM_MVM_NM";break;default:s="loadObjectUniforms"}return t[s]}}})),define("DS/GPUFormats/FormatEnums",["DS/Mesh/ThreeJS_Base"],(function(e){"use strict";var t={UVMapping:function(){},CubeReflectionMapping:function(){},CubeRefractionMapping:function(){},SphericalReflectionMapping:function(){},SphericalRefractionMapping:function(){},LatLongReflectionMapping:function(){},LatLongRefractionMapping:function(){},SimpleEnvMapping:function(){},SimpleEnvMappingPreserveRatio:function(){},SimpleEnvMappingFit:function(){},SimpleEnvMappingFitWidth:function(){},SimpleEnvMappingFitHeight:function(){},SimpleEnvMappingCustom:function(){},CubeEnvMapping:function(){},LightProbeEnvMapping:function(){},LatLongEnvMapping:function(){},RepeatWrapping:1e3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002,_ClampToBorderWrapping:1025,NearestFilter:1003,NearestMipMapNearestFilter:1004,NearestMipMapLinearFilter:1005,LinearFilter:1006,LinearMipMapNearestFilter:1007,LinearMipMapLinearFilter:1008,UnsignedByteType:1009,ByteType:1010,ShortType:1011,UnsignedShortType:1012,IntType:1013,UnsignedIntType:1014,FloatType:1015,HalfFloatType:1024,UnsignedShort4444Type:1016,UnsignedShort5551Type:1017,UnsignedShort565Type:1018,AlphaFormat:1019,RGBFormat:1020,RGBAFormat:1021,LuminanceFormat:1022,LuminanceAlphaFormat:1023,RGFormat:1026,RGBAIntegerFormat:1027,RFormat:1028,CompressedFormats:2e3,MaxDDSFormats:2013,RGB_S3TC_DXT1_Format:2001,RGBA_S3TC_DXT1_Format:2002,RGBA_S3TC_DXT3_Format:2003,RGBA_S3TC_DXT5_Format:2004,RED_RGTC1_Format:2005,RED_RGTC1_S_Format:2006,REDGREEN_RGTC2_Format:2007,REDGREEN_RGTC2_S_Format:2008,RGBA_BPTC_UNORM_Format:2009,SRGB_ALPHA_BPTC_UNORM_Format:2010,RGB_BPTC_SIGNED_FLOAT_Format:2011,RGB_BPTC_UNSIGNED_FLOAT_Format:2012,RGB_ETC1_Format:2201,RGB_PVRTC_2BPPV1_Format:2301,RGB_PVRTC_4BPPV1_Format:2302,RGBA_PVRTC_2BPPV1_Format:2303,RGBA_PVRTC_4BPPV1_Format:2304,R11_EAC_Format:2401,SIGNED_R11_EAC_Format:2402,RG11_ETC2_EAC_Format:2403,SIGNED_RG11_ETC2_EAC_Format:2404,RGB8_ETC2_Format:2405,RGBA8_ETC2_EAC_Format:2406,SRGB8_ETC2_Format:2407,SRGB8_ALPHA8_ETC2_EAC_Format:2408,RGB8_PUNCHTHROUGH_ALPHA1_ETC2_Format:2409,SRGB8_PUNCHTHROUGH_ALPHA1_ETC2_Format:2410,RGBA_Encoding:1,RGBE_Encoding:2,LogLUV_Encoding:3,RGBM_Encoding:4},r=["4x4","5x4","5x5","6x5","6x6","8x5","8x6","8x8","10x5","10x6","10x8","10x10","12x10","12x12"];return function(){for(var e=0;e<r.length;e++){var a=r[e],i=2*e;t["RGBA_ASTC_"+a+"_Format"]=2100+i+1,t["SRGB8_ALPHA8_ASTC_"+a+"_Format"]=2100+i+2}}(),t})),define("DS/GPUFormats/WebGPUFormatEnums",["DS/Mesh/ThreeJS_Base"],(function(e){"use strict";const t={filterable:{type:"filtering"},comparison:{type:"comparison"},nonFilterable:{type:"non-filtering"}},r={"unfilterable-float":{sampleType:"unfilterable-float"},float:{sampleType:"float"},uint:{sampleType:"uint"},sint:{sampleType:"sint"},depth:{sampleType:"depth"}};class a{constructor(e){this.feature=e.feature||null,this.bindings=e.bindings}}const i=new a({bindings:["read-only","write-only"]}),s=new a({bindings:["read-only","write-only","read-write"]});let o=0;class n{constructor(e){this.id=o++,this.sampleType=e.sampleType,this.texelBlockBytes=e.texelBlockBytes,this.texelBlockWidth=1,this.texelBlockHeight=1,this.feature=e.feature?e.feature:null}isFilterable(e=1){return!(e>1)&&"unfilterable-float"!==this.sampleType}sampler(e={}){const r=this.isFilterable(e.multisampled?4:1)?"filterable":"nonFilterable";let a=r;if(!t[a]){let i={};Object.assign(i,t[r]),Object.assign(i,e),t[a]=i}return t[a]}texture(e={}){const t=this.sampleType;let a=t;if(e.viewDimension&&(a=e.viewDimension+"-"+a),e.multisampled&&(a+="-m"),!r[a]){let i={};Object.assign(i,r[t]),Object.assign(i,e),e.multisampled&&"float"===i.sampleType&&(i.sampleType="unfilterable-float"),r[a]=i}return r[a]}}class l extends n{constructor(e){super(e),this.copySrc=!0,this.copyDst=!0,this.renderable=!!e.renderable,this.blendable=!!e.blendable,this.multisample=!!e.multisample,this.resolve=!!e.resolve,this.storage=e.storage||null,this.renderTargetPixelBytes=e.renderTargetPixelBytes||0,this.convert=e.convert||null}}class u extends n{constructor(e){super(e),this.renderable=!0,this.copySrc=!!e.copySrc,this.copyDst=!!e.copyDst,this.texelBlockCostMin=e.texelBlockCostMin,this.texelBlockCostMax=e.texelBlockCostMax?e.texelBlockCostMax:this.texelBlockCostMin,this.aspect=e.aspect?e.aspect:null}}class m extends n{constructor(e){super(e),this.renderable=!1,this.multisample=!1,this.copySrc=!0,this.copyDst=!0,this.texelBlockWidth=e.texelBlockWidth,this.texelBlockHeight=e.texelBlockHeight,this.threeD=e.threeD||null}}function d(e,t,r){return 3===r?e[t]:0}function c(e){return function(t,r,a){return a<3?t[r]:e}}function p(e,t,r){return r<3?e[t]:e[t+1]}function f(e){return function(t,r,a){return a<3?t[r+a]:e}}const h={r8unorm:new l({sampleType:"float",renderable:!0,blendable:!0,multisample:!0,resolve:!0,texelBlockBytes:1,renderTargetPixelBytes:1}),r8snorm:new l({sampleType:"float",texelBlockBytes:1}),r8uint:new l({sampleType:"uint",renderable:!0,multisample:!0,texelBlockBytes:1,renderTargetPixelBytes:1}),r8sint:new l({sampleType:"sint",renderable:!0,multisample:!0,texelBlockBytes:1,renderTargetPixelBytes:1}),rg8unorm:new l({sampleType:"float",renderable:!0,blendable:!0,multisample:!0,resolve:!0,texelBlockBytes:2,renderTargetPixelBytes:2}),rg8snorm:new l({sampleType:"float",texelBlockBytes:2}),rg8uint:new l({sampleType:"uint",renderable:!0,multisample:!0,texelBlockBytes:2,renderTargetPixelBytes:2}),rg8sint:new l({sampleType:"sint",renderable:!0,multisample:!0,texelBlockBytes:2,renderTargetPixelBytes:2}),a8unorm:new l({sampleType:"float",renderable:!0,blendable:!0,multisample:!0,resolve:!0,storage:i,texelBlockBytes:4,renderTargetPixelBytes:8,convert:{src:1,dst:4,format:"rgba8unorm",defaultValue:d}}),"a8unorm-srgb":new l({sampleType:"float",renderable:!0,blendable:!0,multisample:!0,resolve:!0,texelBlockBytes:4,renderTargetPixelBytes:8,convert:{src:1,dst:4,format:"rgba8unorm-srgb",defaultValue:d}}),a8snorm:new l({sampleType:"float",storage:i,texelBlockBytes:4,convert:{src:1,dst:4,format:"rgba8snorm",defaultValue:d}}),a8uint:new l({sampleType:"uint",renderable:!0,multisample:!0,storage:i,texelBlockBytes:4,renderTargetPixelBytes:4,convert:{src:1,dst:4,format:"rgba8uint",defaultValue:d}}),a8sint:new l({sampleType:"sint",renderable:!0,multisample:!0,storage:i,texelBlockBytes:4,renderTargetPixelBytes:4,convert:{src:1,dst:4,format:"rgba8sint",defaultValue:d}}),l8unorm:new l({sampleType:"float",renderable:!0,blendable:!0,multisample:!0,resolve:!0,storage:i,texelBlockBytes:4,renderTargetPixelBytes:8,convert:{src:1,dst:4,format:"rgba8unorm",defaultValue:c(255)}}),"l8unorm-srgb":new l({sampleType:"float",renderable:!0,blendable:!0,multisample:!0,resolve:!0,texelBlockBytes:4,renderTargetPixelBytes:8,convert:{src:1,dst:4,format:"rgba8unorm-srgb",defaultValue:c(255)}}),l8snorm:new l({sampleType:"float",storage:i,texelBlockBytes:4,convert:{src:1,dst:4,format:"rgba8snorm",defaultValue:c(127)}}),l8uint:new l({sampleType:"uint",renderable:!0,multisample:!0,storage:i,texelBlockBytes:4,renderTargetPixelBytes:4,convert:{src:1,dst:4,format:"rgba8uint",defaultValue:c(255)}}),l8sint:new l({sampleType:"sint",renderable:!0,multisample:!0,storage:i,texelBlockBytes:4,renderTargetPixelBytes:4,convert:{src:1,dst:4,format:"rgba8sint",defaultValue:c(127)}}),la8unorm:new l({sampleType:"float",renderable:!0,blendable:!0,multisample:!0,resolve:!0,storage:i,texelBlockBytes:4,renderTargetPixelBytes:8,convert:{src:2,dst:4,format:"rgba8unorm",defaultValue:p}}),"la8unorm-srgb":new l({sampleType:"float",renderable:!0,blendable:!0,multisample:!0,resolve:!0,texelBlockBytes:4,renderTargetPixelBytes:8,convert:{src:2,dst:4,format:"rgba8unorm-srgb",defaultValue:p}}),la8snorm:new l({sampleType:"float",storage:i,texelBlockBytes:4,convert:{src:2,dst:4,format:"rgba8snorm",defaultValue:p}}),la8uint:new l({sampleType:"uint",renderable:!0,multisample:!0,storage:i,texelBlockBytes:4,renderTargetPixelBytes:4,convert:{src:2,dst:4,format:"rgba8uint",defaultValue:p}}),la8sint:new l({sampleType:"sint",renderable:!0,multisample:!0,storage:i,texelBlockBytes:4,renderTargetPixelBytes:4,convert:{src:2,dst:4,format:"rgba8sint",defaultValue:p}}),rgb8unorm:new l({sampleType:"float",renderable:!0,blendable:!0,multisample:!0,resolve:!0,storage:i,texelBlockBytes:4,renderTargetPixelBytes:8,convert:{src:3,dst:4,format:"rgba8unorm",defaultValue:f(255)}}),"rgb8unorm-srgb":new l({sampleType:"float",renderable:!0,blendable:!0,multisample:!0,resolve:!0,texelBlockBytes:4,renderTargetPixelBytes:8,convert:{src:3,dst:4,format:"rgba8unorm-srgb",defaultValue:f(255)}}),rgb8snorm:new l({sampleType:"float",storage:i,texelBlockBytes:4,convert:{src:3,dst:4,format:"rgba8snorm",defaultValue:f(127)}}),rgb8uint:new l({sampleType:"uint",renderable:!0,multisample:!0,storage:i,texelBlockBytes:4,renderTargetPixelBytes:4,convert:{src:3,dst:4,format:"rgba8uint",defaultValue:f(255)}}),rgb8sint:new l({sampleType:"sint",renderable:!0,multisample:!0,storage:i,texelBlockBytes:4,renderTargetPixelBytes:4,convert:{src:3,dst:4,format:"rgba8sint",defaultValue:f(127)}}),rgba8unorm:new l({sampleType:"float",renderable:!0,blendable:!0,multisample:!0,resolve:!0,storage:i,texelBlockBytes:4,renderTargetPixelBytes:8}),"rgba8unorm-srgb":new l({sampleType:"float",renderable:!0,blendable:!0,multisample:!0,resolve:!0,texelBlockBytes:4,renderTargetPixelBytes:8}),rgba8snorm:new l({sampleType:"float",storage:i,texelBlockBytes:4}),rgba8uint:new l({sampleType:"uint",renderable:!0,multisample:!0,storage:i,texelBlockBytes:4,renderTargetPixelBytes:4}),rgba8sint:new l({sampleType:"sint",renderable:!0,multisample:!0,storage:i,texelBlockBytes:4,renderTargetPixelBytes:4}),bgra8unorm:new l({sampleType:"float",renderable:!0,blendable:!0,multisample:!0,resolve:!0,storage:new a({feature:"bgra8unorm-storage",bindings:["write-only"]}),texelBlockBytes:4,renderTargetPixelBytes:8}),"bgra8unorm-srgb":new l({sampleType:"float",renderable:!0,blendable:!0,multisample:!0,resolve:!0,texelBlockBytes:4,renderTargetPixelBytes:8})},x={r16uint:new l({sampleType:"uint",renderable:!0,multisample:!0,texelBlockBytes:2,renderTargetPixelBytes:2}),r16sint:new l({sampleType:"sint",renderable:!0,multisample:!0,texelBlockBytes:2,renderTargetPixelBytes:2}),r16float:new l({sampleType:"float",renderable:!0,blendable:!0,multisample:!0,resolve:!0,texelBlockBytes:2,renderTargetPixelBytes:2}),rg16uint:new l({sampleType:"uint",renderable:!0,multisample:!0,texelBlockBytes:4,renderTargetPixelBytes:4}),rg16sint:new l({sampleType:"sint",renderable:!0,multisample:!0,texelBlockBytes:4,renderTargetPixelBytes:4}),rg16float:new l({sampleType:"float",renderable:!0,blendable:!0,multisample:!0,resolve:!0,texelBlockBytes:4,renderTargetPixelBytes:4}),a16uint:new l({sampleType:"uint",renderable:!0,multisample:!0,storage:i,texelBlockBytes:8,renderTargetPixelBytes:8,convert:{src:1,dst:4,format:"rgba16uint",defaultValue:d}}),a16sint:new l({sampleType:"sint",renderable:!0,multisample:!0,storage:i,texelBlockBytes:8,renderTargetPixelBytes:8,convert:{src:1,dst:4,format:"rgba16sint",defaultValue:d}}),a16float:new l({sampleType:"float",renderable:!0,blendable:!0,multisample:!0,resolve:!0,storage:i,texelBlockBytes:8,renderTargetPixelBytes:8,convert:{src:1,dst:4,format:"rgba16float",defaultValue:d}}),l16uint:new l({sampleType:"uint",renderable:!0,multisample:!0,storage:i,texelBlockBytes:8,renderTargetPixelBytes:8,convert:{src:1,dst:4,format:"rgba16uint",defaultValue:c(65535)}}),l16sint:new l({sampleType:"sint",renderable:!0,multisample:!0,storage:i,texelBlockBytes:8,renderTargetPixelBytes:8,convert:{src:1,dst:4,format:"rgba16sint",defaultValue:c(32767)}}),l16float:new l({sampleType:"float",renderable:!0,blendable:!0,multisample:!0,resolve:!0,storage:i,texelBlockBytes:8,renderTargetPixelBytes:8,convert:{src:1,dst:4,format:"rgba16float",defaultValue:c(1)}}),la16uint:new l({sampleType:"uint",renderable:!0,multisample:!0,storage:i,texelBlockBytes:8,renderTargetPixelBytes:8,convert:{src:2,dst:4,format:"rgba16uint",defaultValue:p}}),la16sint:new l({sampleType:"sint",renderable:!0,multisample:!0,storage:i,texelBlockBytes:8,renderTargetPixelBytes:8,convert:{src:2,dst:4,format:"rgba16sint",defaultValue:p}}),la16float:new l({sampleType:"float",renderable:!0,blendable:!0,multisample:!0,resolve:!0,storage:i,texelBlockBytes:8,renderTargetPixelBytes:8,convert:{src:2,dst:4,format:"rgba16float",defaultValue:p}}),rgb16uint:new l({sampleType:"uint",renderable:!0,multisample:!0,storage:i,texelBlockBytes:8,renderTargetPixelBytes:8,convert:{src:3,dst:4,format:"rgba16uint",defaultValue:f(65535)}}),rgb16sint:new l({sampleType:"sint",renderable:!0,multisample:!0,storage:i,texelBlockBytes:8,renderTargetPixelBytes:8,convert:{src:3,dst:4,format:"rgba16sint",defaultValue:f(32767)}}),rgb16float:new l({sampleType:"float",renderable:!0,blendable:!0,multisample:!0,resolve:!0,storage:i,texelBlockBytes:8,renderTargetPixelBytes:8,convert:{src:3,dst:4,format:"rgba16float",defaultValue:f(1)}}),rgba16uint:new l({sampleType:"uint",renderable:!0,multisample:!0,storage:i,texelBlockBytes:8,renderTargetPixelBytes:8}),rgba16sint:new l({sampleType:"sint",renderable:!0,multisample:!0,storage:i,texelBlockBytes:8,renderTargetPixelBytes:8}),rgba16float:new l({sampleType:"float",renderable:!0,blendable:!0,multisample:!0,resolve:!0,storage:i,texelBlockBytes:8,renderTargetPixelBytes:8})},g={r32uint:new l({sampleType:"uint",renderable:!0,storage:s,texelBlockBytes:4,renderTargetPixelBytes:4}),r32sint:new l({sampleType:"sint",renderable:!0,storage:s,texelBlockBytes:4,renderTargetPixelBytes:4}),r32float:new l({sampleType:"unfilterable-float",renderable:!0,multisample:!0,storage:s,texelBlockBytes:4,renderTargetPixelBytes:4}),rg32uint:new l({sampleType:"uint",renderable:!0,storage:i,texelBlockBytes:8,renderTargetPixelBytes:8}),rg32sint:new l({sampleType:"sint",renderable:!0,storage:i,texelBlockBytes:8,renderTargetPixelBytes:8}),rg32float:new l({sampleType:"unfilterable-float",renderable:!0,storage:i,texelBlockBytes:8,renderTargetPixelBytes:8}),a32uint:new l({sampleType:"uint",renderable:!0,storage:i,texelBlockBytes:16,renderTargetPixelBytes:16,convert:{src:1,dst:4,format:"rgba32uint",defaultValue:d}}),a32sint:new l({sampleType:"sint",renderable:!0,storage:i,texelBlockBytes:16,renderTargetPixelBytes:16,convert:{src:1,dst:4,format:"rgba32sint",defaultValue:d}}),a32float:new l({sampleType:"unfilterable-float",renderable:!0,storage:i,texelBlockBytes:16,renderTargetPixelBytes:16,convert:{src:1,dst:4,format:"rgba32float",defaultValue:d}}),l32uint:new l({sampleType:"uint",renderable:!0,storage:i,texelBlockBytes:16,renderTargetPixelBytes:16,convert:{src:1,dst:4,format:"rgba32uint",defaultValue:c(4294967295)}}),l32sint:new l({sampleType:"sint",renderable:!0,storage:i,texelBlockBytes:16,renderTargetPixelBytes:16,convert:{src:1,dst:4,format:"rgba32sint",defaultValue:c(2147483647)}}),l32float:new l({sampleType:"unfilterable-float",renderable:!0,storage:i,texelBlockBytes:16,renderTargetPixelBytes:16,convert:{src:1,dst:4,format:"rgba32float",defaultValue:c(1)}}),la32uint:new l({sampleType:"uint",renderable:!0,storage:i,texelBlockBytes:16,renderTargetPixelBytes:16,convert:{src:2,dst:4,format:"rgba32uint",defaultValue:p}}),la32sint:new l({sampleType:"sint",renderable:!0,storage:i,texelBlockBytes:16,renderTargetPixelBytes:16,convert:{src:2,dst:4,format:"rgba32sint",defaultValue:p}}),la32float:new l({sampleType:"unfilterable-float",renderable:!0,storage:i,texelBlockBytes:16,renderTargetPixelBytes:16,convert:{src:2,dst:4,format:"rgba32float",defaultValue:p}}),rgb32uint:new l({sampleType:"uint",renderable:!0,storage:i,texelBlockBytes:16,renderTargetPixelBytes:16,convert:{src:3,dst:4,format:"rgba32uint",defaultValue:f(4294967295)}}),rgb32sint:new l({sampleType:"sint",renderable:!0,storage:i,texelBlockBytes:16,renderTargetPixelBytes:16,convert:{src:3,dst:4,format:"rgba32sint",defaultValue:f(2147483647)}}),rgb32float:new l({sampleType:"unfilterable-float",renderable:!0,storage:i,texelBlockBytes:16,renderTargetPixelBytes:16,convert:{src:3,dst:4,format:"rgba32float",defaultValue:f(1)}}),rgba32uint:new l({sampleType:"uint",renderable:!0,storage:i,texelBlockBytes:16,renderTargetPixelBytes:16}),rgba32sint:new l({sampleType:"sint",renderable:!0,storage:i,texelBlockBytes:16,renderTargetPixelBytes:16}),rgba32float:new l({sampleType:"unfilterable-float",renderable:!0,storage:i,texelBlockBytes:16,renderTargetPixelBytes:16})},b={rgb10a2uint:new l({sampleType:"uint",renderable:!0,multisample:!0,texelBlockBytes:4,renderTargetPixelBytes:8}),rgb10a2unorm:new l({sampleType:"float",renderable:!0,blendable:!0,multisample:!0,resolve:!0,texelBlockBytes:4,renderTargetPixelBytes:8}),rg11b10ufloat:new l({sampleType:"float",texelBlockBytes:4,renderTargetPixelBytes:8})},M={stencil8:new u({sampleType:"uint",copyDst:!0,copySrc:!0,texelBlockBytes:1,texelBlockCostMin:1,texelBlockCostMax:4}),depth16unorm:new u({sampleType:"depth",copyDst:!0,copySrc:!0,texelBlockBytes:2,texelBlockCostMin:2}),depth24plus:new n({sampleType:"depth",texelBlockBytes:0,texelBlockCostMin:4}),"depth24plus-stencil8":new n({sampleType:"depth",texelBlockBytes:0,texelBlockCostMin:4,aspect:new u({sampleType:"uint",copyDst:!0,copySrc:!0,texelBlockBytes:1,texelBlockCostMin:0,texelBlockCostMax:4})}),depth32float:new n({sampleType:"depth",copySrc:!0,texelBlockBytes:4,texelBlockCostMin:4}),"depth32float-stencil8":new n({sampleType:"depth",copySrc:!0,texelBlockBytes:4,texelBlockCostMin:4,aspect:new u({sampleType:"uint",copyDst:!0,copySrc:!0,texelBlockBytes:1,texelBlockCostMin:1,texelBlockCostMax:4}),feature:"depth32float-stencil8"})},y={rgb9e5ufloat:new m({sampleType:"float",texelBlockBytes:4,texelBlockHeight:1,texelBlockWidth:1})},_="texture-compression-bc",T="texture-compression-bc-sliced-3d",B={"bc1-rgba-unorm":new m({sampleType:"float",texelBlockBytes:8,texelBlockHeight:4,texelBlockWidth:4,feature:_,threeD:T}),"bc1-rgba-unorm-srgb":new m({sampleType:"float",texelBlockBytes:8,texelBlockHeight:4,texelBlockWidth:4,feature:_,threeD:T}),"bc2-rgba-unorm":new m({sampleType:"float",texelBlockBytes:16,texelBlockHeight:4,texelBlockWidth:4,feature:_,threeD:T}),"bc2-rgba-unorm-srgb":new m({sampleType:"float",texelBlockBytes:16,texelBlockHeight:4,texelBlockWidth:4,feature:_,threeD:T}),"bc3-rgba-unorm":new m({sampleType:"float",texelBlockBytes:16,texelBlockHeight:4,texelBlockWidth:4,feature:_,threeD:T}),"bc3-rgba-unorm-srgb":new m({sampleType:"float",texelBlockBytes:16,texelBlockHeight:4,texelBlockWidth:4,feature:_,threeD:T}),"bc4-r-unorm":new m({sampleType:"float",texelBlockBytes:8,texelBlockHeight:4,texelBlockWidth:4,feature:_,threeD:T}),"bc4-r-snorm":new m({sampleType:"float",texelBlockBytes:8,texelBlockHeight:4,texelBlockWidth:4,feature:_,threeD:T}),"bc5-rg-unorm":new m({sampleType:"float",texelBlockBytes:16,texelBlockHeight:4,texelBlockWidth:4,feature:_,threeD:T}),"bc5-rg-snorm":new m({sampleType:"float",texelBlockBytes:16,texelBlockHeight:4,texelBlockWidth:4,feature:_,threeD:T}),"bc6h-rgb-ufloat":new m({sampleType:"float",texelBlockBytes:16,texelBlockHeight:4,texelBlockWidth:4,feature:_,threeD:T}),"bc6h-rgb-float":new m({sampleType:"float",texelBlockBytes:16,texelBlockHeight:4,texelBlockWidth:4,feature:_,threeD:T}),"bc7-rgba-unorm":new m({sampleType:"float",texelBlockBytes:8,texelBlockHeight:4,texelBlockWidth:4,feature:_,threeD:T}),"bc7-rgba-unorm-srgb":new m({sampleType:"float",texelBlockBytes:8,texelBlockHeight:4,texelBlockWidth:4,feature:_,threeD:T})},v="texture-compression-etc2",w={"etc2-rgb8unorm":new m({sampleType:"float",texelBlockBytes:8,texelBlockHeight:4,texelBlockWidth:4,feature:v,threeD:!1}),"etc2-rgb8unorm-srgb":new m({sampleType:"float",texelBlockBytes:8,texelBlockHeight:4,texelBlockWidth:4,feature:v,threeD:!1}),"etc2-rgb8a1unorm":new m({sampleType:"float",texelBlockBytes:8,texelBlockHeight:4,texelBlockWidth:4,feature:v,threeD:!1}),"etc2-rgb8a1unorm-srgb":new m({sampleType:"float",texelBlockBytes:8,texelBlockHeight:4,texelBlockWidth:4,feature:v,threeD:!1}),"etc2-rgba8unorm":new m({sampleType:"float",texelBlockBytes:16,texelBlockHeight:4,texelBlockWidth:4,feature:v,threeD:!1}),"etc2-rgba8unorm-srgb":new m({sampleType:"float",texelBlockBytes:16,texelBlockHeight:4,texelBlockWidth:4,feature:v,threeD:!1}),"eac-r11unorm":new m({sampleType:"float",texelBlockBytes:8,texelBlockHeight:4,texelBlockWidth:4,feature:v,threeD:!1}),"eac-r11snorm":new m({sampleType:"float",texelBlockBytes:8,texelBlockHeight:4,texelBlockWidth:4,feature:v,threeD:!1}),"eac-rg11unorm":new m({sampleType:"float",texelBlockBytes:16,texelBlockHeight:4,texelBlockWidth:4,feature:v,threeD:!1}),"eac-rg11snorm":new m({sampleType:"float",texelBlockBytes:16,texelBlockHeight:4,texelBlockWidth:4,feature:v,threeD:!1})},F="texture-compression-astc",P={};{const e=["4x4","5x4","5x5","6x5","6x6","8x5","8x6","8x8","10x5","10x6","10x8","10x10","12x10","12x12"];(function(){for(let t=0;t<e.length;t++){let r=e[t],a=parseInt(r.split("x")[0]),i=parseInt(r.split("x")[1]);P["astc-"+r+"-unorm"]=new m({sampleType:"float",texelBlockBytes:16,texelBlockHeight:i,texelBlockWidth:a,feature:F}),P["astc-"+r+"-unorm-srgb"]=new m({sampleType:"float",texelBlockBytes:16,texelBlockHeight:i,texelBlockWidth:a,feature:F})}})()}Object.assign(y,B),Object.assign(y,w),Object.assign(y,P);const U={};return Object.assign(U,h),Object.assign(U,x),Object.assign(U,g),Object.assign(U,b),Object.assign(U,M),Object.assign(U,y),e._WebGPUFormatShift=Math.ceil(Math.log2(o))+1,U})),define("DS/GPUFormats/WebGPUBindGroupUtils",["DS/Mesh/ThreeJS_Base"],(function(e){"use strict";const t=0,r=1,a=2;class i{constructor(e,t,a=null){this.lastUsedFrameIndex=-1,this.destroyed=!1,this.uniformBuffer=e,this.uniformBufferHighFrequency=a,this.bindGroup=null,this.layout=null,this.baseLabel=t,this.entries=[],this.entriesHighFrequency=[],this._needsUpdate=r}get needsUpdate(){return this._needsUpdate}flagAsContentChanged(){this._needsUpdate=a}createBindGroup(e){let r=this.entries,a=this.entriesHighFrequency;const i=e.webGPUDevice;let s=0,o=[{binding:s++,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{type:"uniform"},resource:{buffer:this.uniformBuffer}}];if(r.length>0)for(let e=0;e<r.length;e++)r[e].binding=s++,o.push(r[e]);if(this.uniformBufferHighFrequency?o.push({binding:s++,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{type:"uniform"},resource:{buffer:this.uniformBufferHighFrequency}}):s++,a.length>0)for(let e=0;e<a.length;e++)a[e].binding=s++,o.push(a[e]);let n=this.baseLabel+" #bindEntries="+(s-2);e.currentRenderInfo.bindGroupsCreated++,this.layout=i.createBindGroupLayout({label:n+" Layout",entries:o}),this.bindGroup=i.createBindGroup({label:n+" Group",layout:this.layout,entries:o}),this._needsUpdate=t}}class s extends i{constructor(e,t){super(e,t,null),this.revision=-1}}class o extends i{constructor(e,t,r){super(e,t,r),this.globalRevision=-1}}class n{constructor(e){this.usedByObject=new Set,this.bindingGroup=e}isUsed(){return this.usedByObject.size>0}}return{WebGPUBindingGroup:i,WebGPUBindingGroupLight:class extends i{constructor(e,t){super(e,t,null),this.gammaInput=!1}},WebGPUBindingGroupRevision:s,WebGPUBindingGroupSharedRevision:class extends o{constructor(e,t,r){super(e,t,r),this._shared={revision:-1,bgRevision:0},this.bgRevision=0}set revision(e){this._shared.revision=e}get revision(){return this._shared.revision}flagAsContentChanged(){super.flagAsContentChanged(),this._shared.bgRevision++}get needsUpdate(){return this._shared.bgRevision!==this.bgRevision?a:this._needsUpdate}createBindGroup(e){super.createBindGroup(e),this.bgRevision=this._shared.bgRevision}shareFrom(e){this._shared=e._shared,this.entries=e.entries}},WebGPUBindingGroupGlobalRevision:o,WebGPUBindingGroupObject:class extends s{constructor(e,t){super(e,t),this.camera=null,this.matrixRevision=null}noNeedsFrameUpdate(e,t){return e===this.lastUsedFrameIndex&&t===this.camera}},WebGPUGenericBindingGroupCache:class{constructor(){this.cache=new Map}get(e){return this.cache.get(e)}set(e,t){const r=t;this.cache.set(e,r)}size(){return this.cache.size()}clean(){this.cache.forEach(((e,t)=>{e.destroyed=!0,e.uniformBuffer.destroy(),e.uniformBufferHighFrequency&&e.uniformBufferHighFrequency.destroy()})),this.cache.clear()}cleanUnused(e){var t=[];this.cache.forEach(((r,a)=>{e-r.lastUsedFrameIndex>1e3&&(r.destroyed=!0,r.uniformBuffer.destroy(),r.uniformBufferHighFrequency&&r.uniformBufferHighFrequency.destroy(),t.push(a))}));for(let e=0;e<t.length;e++)this.cache.delete(t[e])}},WebGPUMaterialBindingGroupCache:class{constructor(){this.cache=new Map,this.lowFrequencyUBOCache=new Map}getID(e,t,r,a,i,s){let o=e.id;return t&&(o+="g"+t.id),i&&i._mappingOperator&&(o+="mp"+i.id),(a||e.enableClipPlanes&&e._hasClippingUniform)&&(o+="o"+r.id,a&&(o+="mo"+a.id)),e._hasDGUniform&&(o+="dg"+r.id+"-"+s.start+"-"+s.count),o+="m",o}_isVeryHighFrequency(e,t,r,a,i,s){return e.enableClipPlanes&&e._hasClippingUniform}size(){return this.cache.size+this.lowFrequencyUBOCache.size}get(e,t,r,a,i,s){const o=this.getID(e,r,t,a,i,s),n=this.cache.get(o);return n?(n.usedByObject.add(t),n.bindingGroup):null}getMaterialUBO(e){return this.lowFrequencyUBOCache.get(e.id)}set(e,t,r,a,i,s,o){const l=this.getID(e,r,t,a,i,o),u=new n(s);u.usedByObject.add(t),this.cache.set(l,u)}setMaterialUBO(e,t){this.lowFrequencyUBOCache.set(e.id,t)}cleanObject(e){let t=[];this.cache.forEach(((r,a,i)=>{if(r.usedByObject.has(e)&&(r.usedByObject.delete(e),!r.isUsed())){const e=r.bindingGroup;e.uniformBufferHighFrequency&&(t.push(a),e.destroyed=!0,e.uniformBufferHighFrequency.destroy())}}));for(let e=0;e<t.length;e++)this.cache.delete(t[e])}_getFirstUpdateBindingGroupForMaterial(e){let t=null;return this.cache.forEach(((r,a,i)=>{t||!a.startsWith(e.id)||r.bindingGroup._needsUpdate||(t=r.bindingGroup)})),t}clean(e){let t=[];this.cache.forEach(((r,a,i)=>{if(a.startsWith(e.id)||a.includes("g"+e.id)){t.push(a);const e=r.bindingGroup;e.destroyed=!0,e.uniformBufferHighFrequency&&e.uniformBufferHighFrequency.destroy()}}));for(let e=0;e<t.length;e++)this.cache.delete(t[e]);let r=this.lowFrequencyUBOCache.get(e.id);r&&r.destroy(),this.lowFrequencyUBOCache.delete(e.id)}cleanAll(){this.cache.forEach(((e,t,r)=>{const a=e.bindingGroup;a.destroyed=!0,a.uniformBufferHighFrequency&&a.uniformBufferHighFrequency.destroy()})),this.cache.clear(),this.lowFrequencyUBOCache.forEach(((e,t,r)=>{e&&e.destroy()})),this.lowFrequencyUBOCache.clear()}}}})),define("DS/GPUFormats/VertexAttribute",[],(function(){"use strict";return{float16:{base:"float16",className:Uint16Array,components:1,normalized:!1,size:2,native:void 0},float16x1:{base:"float16",className:Uint16Array,components:1,normalized:!1,size:2,native:void 0},float16x2:{base:"float16",className:Uint16Array,components:2,normalized:!1,size:4,native:void 0},float16x3:{base:"float16",className:Uint16Array,components:3,normalized:!1,size:6,native:void 0},float16x4:{base:"float16",className:Uint16Array,components:4,normalized:!1,size:8,native:void 0},float32:{base:"float32",className:Float32Array,components:1,normalized:!1,size:4,native:void 0},float32x1:{base:"float32",className:Float32Array,components:1,normalized:!1,size:4,native:void 0},float32x2:{base:"float32",className:Float32Array,components:2,normalized:!1,size:8,native:void 0},float32x3:{base:"float32",className:Float32Array,components:3,normalized:!1,size:12,native:void 0},float32x4:{base:"float32",className:Float32Array,components:4,normalized:!1,size:16,native:void 0},sint8:{base:"sint8",className:Int8Array,components:1,normalized:!1,size:1,native:void 0},sint8x1:{base:"sint8",className:Int8Array,components:1,normalized:!1,size:1,native:void 0},sint8x2:{base:"sint8",className:Int8Array,components:2,normalized:!1,size:2,native:void 0},sint8x3:{base:"sint8",className:Int8Array,components:3,normalized:!1,size:3,native:void 0},sint8x4:{base:"sint8",className:Int8Array,components:4,normalized:!1,size:4,native:void 0},sint16:{base:"sint16",className:Int16Array,components:1,normalized:!1,size:2,native:void 0},sint16x1:{base:"sint16",className:Int16Array,components:1,normalized:!1,size:2,native:void 0},sint16x2:{base:"sint16",className:Int16Array,components:2,normalized:!1,size:4,native:void 0},sint16x3:{base:"sint16",className:Int16Array,components:3,normalized:!1,size:6,native:void 0},sint16x4:{base:"sint16",className:Int16Array,components:4,normalized:!1,size:8,native:void 0},sint32:{base:"sint32",className:Int32Array,components:1,normalized:!1,size:4,native:void 0},sint32x1:{base:"sint32",className:Int32Array,components:1,normalized:!1,size:4,native:void 0},sint32x2:{base:"sint32",className:Int32Array,components:2,normalized:!1,size:8,native:void 0},sint32x3:{base:"sint32",className:Int32Array,components:3,normalized:!1,size:12,native:void 0},sint32x4:{base:"sint32",className:Int32Array,components:4,normalized:!1,size:16,native:void 0},snorm8:{base:"sint8",className:Int8Array,components:1,normalized:!0,size:1,native:void 0},snorm8x1:{base:"sint8",className:Int8Array,components:1,normalized:!0,size:1,native:void 0},snorm8x2:{base:"sint8",className:Int8Array,components:2,normalized:!0,size:2,native:void 0},snorm8x3:{base:"sint8",className:Int8Array,components:3,normalized:!0,size:3,native:void 0},snorm8x4:{base:"sint8",className:Int8Array,components:4,normalized:!0,size:4,native:void 0},snorm16:{base:"sint16",className:Int16Array,components:1,normalized:!0,size:2,native:void 0},snorm16x1:{base:"sint16",className:Int16Array,components:1,normalized:!0,size:2,native:void 0},snorm16x2:{base:"sint16",className:Int16Array,components:2,normalized:!0,size:4,native:void 0},snorm16x3:{base:"sint16",className:Int16Array,components:3,normalized:!0,size:6,native:void 0},snorm16x4:{base:"sint16",className:Int16Array,components:4,normalized:!0,size:8,native:void 0},uint8:{base:"uint8",className:Uint8Array,components:1,normalized:!1,size:1,native:void 0},uint8x1:{base:"uint8",className:Uint8Array,components:1,normalized:!1,size:1,native:void 0},uint8x2:{base:"uint8",className:Uint8Array,components:2,normalized:!1,size:2,native:void 0},uint8x3:{base:"uint8",className:Uint8Array,components:3,normalized:!1,size:3,native:void 0},uint8x4:{base:"uint8",className:Uint8Array,components:4,normalized:!1,size:4,native:void 0},uint16:{base:"uint16",className:Uint16Array,components:1,normalized:!1,size:2,native:void 0},uint16x1:{base:"uint16",className:Uint16Array,components:1,normalized:!1,size:2,native:void 0},uint16x2:{base:"uint16",className:Uint16Array,components:2,normalized:!1,size:4,native:void 0},uint16x3:{base:"uint16",className:Uint16Array,components:3,normalized:!1,size:6,native:void 0},uint16x4:{base:"uint16",className:Uint16Array,components:4,normalized:!1,size:8,native:void 0},uint32:{base:"uint32",className:Uint32Array,components:1,normalized:!1,size:4,native:void 0},uint32x1:{base:"uint32",className:Uint32Array,components:1,normalized:!1,size:4,native:void 0},uint32x2:{base:"uint32",className:Uint32Array,components:2,normalized:!1,size:8,native:void 0},uint32x3:{base:"uint32",className:Uint32Array,components:3,normalized:!1,size:12,native:void 0},uint32x4:{base:"uint32",className:Uint32Array,components:4,normalized:!1,size:16,native:void 0},unorm8:{base:"uint8",className:Uint8ClampedArray,components:1,normalized:!0,size:1,native:void 0},unorm8x1:{base:"uint8",className:Uint8ClampedArray,components:1,normalized:!0,size:1,native:void 0},unorm8x2:{base:"uint8",className:Uint8ClampedArray,components:2,normalized:!0,size:2,native:void 0},unorm8x3:{base:"uint8",className:Uint8ClampedArray,components:3,normalized:!0,size:3,native:void 0},unorm8x4:{base:"uint8",className:Uint8ClampedArray,components:4,normalized:!0,size:4,native:void 0},unorm16:{base:"uint16",className:Uint16Array,components:1,normalized:!0,size:2,native:void 0},unorm16x1:{base:"uint16",className:Uint16Array,components:1,normalized:!0,size:2,native:void 0},unorm16x2:{base:"uint16",className:Uint16Array,components:2,normalized:!0,size:4,native:void 0},unorm16x3:{base:"uint16",className:Uint16Array,components:3,normalized:!0,size:6,native:void 0},unorm16x4:{base:"uint16",className:Uint16Array,components:4,normalized:!0,size:8,native:void 0}}})),define("DS/GPUFormats/WebGPUUBOUtils",["DS/Mesh/ThreeJS_Base"],(function(e){"use strict";var t=new e.Color;const r=new e.Vector3(0,0,1),a=new e.Color(0),i={fillGlobalUBO(t,r,a){const i=t.renderer,s=t.layout;if(s.projectionMatrix&&t.setM4(s.projectionMatrix,r.projectionMatrix),s.viewMatrix&&t.setM4(s.viewMatrix,r.matrixWorldInverse),s.cameraPosition){let e=i.cameraPosition,r=i.lowPartCameraPosition;t.setV3(s.cameraPosition,e),t.setV3(s.lowPartCameraPosition,r)}const o=i.viewportData;if(a.isPDSFX()){if(s.projectionInvMatrix&&t.setM4(s.projectionInvMatrix,r.projectionMatrixInverse),s.viewInvMatrix&&t.setM4(s.viewInvMatrix,r.matrixWorld),s.viewInvTranspMatrix&&(t.setM4(s.viewInvTranspMatrix,r.matrixWorld.transpose()),r.matrixWorld.transpose()),s.lowlightColor){let r=e._getColorMap(i)[e.COLORMAP_INDEX.LOWLIGHT];t.setColor(s.lowlightColor,r,i.gammaInput,i.simpleGamma)}s.nearFarLogFactor&&t.setFlatV3(s.nearFarLogFactor,r.near,r.far,1/Math.log(r.far/r.near)),s.viewportSize&&t.setFlatV2(s.viewportSize,o.viewportWidth,o.viewportHeight)}if(s.pixelToWorldSizeCst&&t.setF(s.pixelToWorldSizeCst,r._pixelToWorldSizeCst),s.billCameraPos||s.billCameraLookAt){t.setV3(s.billCameraPos,r.position);let e=r.getLookAt();t.setV3(s.billCameraLookAt,e),s.billCameraUp&&t.setV3(s.billCameraUp,r.up),s.invViewMatrix&&t.setM4(s.invViewMatrix,r.matrixWorld),t.setM4(s.invProjectionMatrix,r.projectionMatrixInverse)}s.viewInfo&&(t.setFlatV2(s.viewInfo,r.near,r.far),t.setTexture(s.currentNormalStencilDepth,i.decalBuffers.currentNormalStencilDepthBuffer),t.setTexture(s.currentTexCoord,i.decalBuffers.currentTexCoordBuffer),s.currentRGBADepth&&t.setTexture(s.currentRGBADepth,i.decalBuffers.currentRGBADepthBuffer))},_fill_PM(e,t,r){const a=e.layout;e.setM4(a.projectionMatrix,t.projectionMatrix)},_fill_PM_VM(e,t,r){const a=e.layout;e.setM4(a.projectionMatrix,t.projectionMatrix),e.setM4(a.viewMatrix,t.matrixWorldInverse)},_fill_PM_CP(e,t,r){const a=e.renderer,i=e.layout;e.setM4(i.projectionMatrix,t.projectionMatrix);let s=a.cameraPosition,o=a.lowPartCameraPosition;e.setV3(i.cameraPosition,s),e.setV3(i.lowPartCameraPosition,o)},_fill_VM(e,t,r){const a=e.layout;e.setM4(a.viewMatrix,t.matrixWorldInverse)},_fill_VM_CP(e,t,r){const a=e.renderer,i=e.layout;e.setM4(i.viewMatrix,t.matrixWorldInverse);let s=a.cameraPosition,o=a.lowPartCameraPosition;e.setV3(i.cameraPosition,s),e.setV3(i.lowPartCameraPosition,o)},_fill_CP(e,t,r){const a=e.renderer,i=e.layout;let s=a.cameraPosition,o=a.lowPartCameraPosition;e.setV3(i.cameraPosition,s),e.setV3(i.lowPartCameraPosition,o)},_fill_PM_VM_CP(e,t,r){const a=e.renderer,i=e.layout;e.setM4(i.projectionMatrix,t.projectionMatrix),e.setM4(i.viewMatrix,t.matrixWorldInverse);let s=a.cameraPosition,o=a.lowPartCameraPosition;e.setV3(i.cameraPosition,s),e.setV3(i.lowPartCameraPosition,o)}},s={fillObjectUBO_Update:(e,t,r,a,i,s)=>r._revision!==e.revision||!e.noNeedsFrameUpdate(t.currentFrameIndex,i),fillObjectUBO(t,i,s,o,n){const l=t.renderer;l.currentModelMatrix=null;const u=t.layout,m=!!u._Stride0,d=t.bindingGroup;if(d.revision=i._revision,d.camera=o,u.quantizedVector&&(t.setV3(u.quantizedVector,s.quantizedVector),t.setV3(u.offsetVector,s.offsetVector)),u.compressionContext&&(t.setTexture(u.compressionContext,s.compressionContext),t.setF(u.ccSize,s.compressionContext.image.width)),u.lightMap&&(n&&n._lightMap?(t.setTexture(u.lightMap,n._lightMap.texture),t.setM3(u.lightMapUvTransform,n._lightMap.uvTransform),t.setI(u.lightMapUvSlot,n._lightMap.uvSlot?n._lightMap.uvSlot:1)):(t.setTexture(u.lightMap,s.lightMap),t.setM3(u.lightMapUvTransform,i.lightMapData.lightMapUvTransform?i.lightMapData.lightMapUvTransform:l._dummyMat3),t.setI(u.lightMapUvSlot,i.lightMapData.lightMapUvSlot?i.lightMapData.lightMapUvSlot:1))),u.displacementRadius&&t.setF(u.displacementRadius,i.boundingSphere.radius),u.billboardType){const e=i._billboardData;t.setI(u.billboardType,e.type),e.type>1&&t.setV3(u.billboardAxis,e.axis?e.axis:r),e.rotation?(t.setI(u.billboardRotationEnabled,1),t.setM4(u.billboardRotation,e.rotation)):t.setI(u.billboardRotationEnabled,0)}let c=i.matrixWorld,p=i._mElements;if(u.belowInstancingModelMatrix){let r=i._occurrence;for(;r&&!r.node._instancingInfos;)r=r.parent;if(r){c=r.matrix;let a=new e._Float32Matrix4;a._fromMatrix4WithLowPartTranslation(c),p=a.elements,t.setM4(u.belowInstancingModelMatrix,i.matrixWorld)}else console.warn("No InstancingNode found for this instanced object"),t.setM4(u.belowInstancingModelMatrix,(new e.Matrix4).identity())}if(u.skinningMap?t.setTexture(u.skinningMap,i._skinningData.skinning.skinningMap):u.skinningInstancingMaps&&t.setTextureArray(u.skinningInstancingMaps,i._skinningData.skinningInstancing.skinningInstancingMaps),u.fixedSizeCenterRatio){const e=i._ratioData;t.setV3PlusF(u.fixedSizeCenterRatio,e.center,e.ratio)}if(u.decalStencilValue&&i._decalData){const e=i._decalData;t.setF(u.decalStencilValue,e.stencilID),u.decalExplicitUv&&(t.setI(u.decalExplicitUv,e.explicitUv),t.setF(u.decalDepthOffset,e.depthOffset))}if(u.objectColorBufferType&&t.setF(u.objectColorBufferType,i._vertexColors),u.modelViewMatrix&&(i._modelViewMatrix||(i._modelViewMatrix=new e._Float32Matrix4,i._modelViewMatrix._multiplyMatricesMV(o.matrixWorldInverse,c)),t.setM4(u.modelViewMatrix,i._modelViewMatrix)),u.modelMatrix&&t.setFlatM4(u.modelMatrix,p),u.modelInvRotMatrix){if(!i._modelInvRotMatrix){var f=(new e.Matrix4).getInverse(c);i._modelInvRotMatrix=(new e.Matrix4).extractRotation(f)}t.setM4(u.modelInvRotMatrix,i._modelInvRotMatrix)}if(m){let e=0,r=s.vertexBufferGPU.layout.getFullInterleaving();if(r)e=r.stride/Float32Array.BYTES_PER_ELEMENT;else for(const[t,r]of s.layout._attributes.entries())e+=r.stride/Float32Array.BYTES_PER_ELEMENT;t.setI(u.haveIndexBuffer,null!==s.indexBufferGPU.buffer?1:0),t.setI(u.isIndexBuffer32Bits,s.indexBufferGPU.use32bitIndexBuffer?1:0),t.setStorageBuffer(u.IndexBuffer,s.indexBufferGPU.buffer),t.setI(u._Stride0,e),t.setStorageBuffer(u.AttributeBuffer0,s.vertexBufferGPU.buffer)}let h=1;for(;u[`AttributeBuffer${h}`];)t.setStorageBuffer(u[`AttributeBuffer${h}`],s.vertexBufferGPU.buffer),t.setI(u[`_Stride${h}`],1),h+=1;if(u.modelInvTranspMatrix&&(null===i.modelInvTranspMatrix&&(i.modelInvTranspMatrix=(new e.Matrix4).getInverse(c).transpose()),t.setM4(u.modelInvTranspMatrix,i.modelInvTranspMatrix)),u.modelViewInvTranspMatrix&&(null===i.modelViewInvTranspMatrix&&(i.modelViewInvTranspMatrix=(new e._Float32Matrix4).multiplyMatricesAndInverse(o.matrixWorldInverse,c).transpose()),t.setM4(u.modelViewInvTranspMatrix,i.modelViewInvTranspMatrix)),u._instancingData){const e=i._pdsfxInstancingData,r=e.getSizes();t.setTexture(u._instancingData,e),t.setFlatV2(u._instancingDataSize,r.width,r.height)}u.modelViewInvMatrix&&(null===i.modelViewInvMatrix&&(i.modelViewInvMatrix=(new e._Float32Matrix4).multiplyMatricesAndInverse(o.matrixWorldInverse,c)),t.setM4(u.modelViewInvMatrix,i.modelViewInvMatrix)),u.normalMatrix&&t.setM3(u.normalMatrix,i._normalMatrix),u.backgroundViewModeControl&&t.setColorPlusF(u.backgroundViewModeControl,l._backgroundColor?l._backgroundColor:a,i.applyBackgroundViewMode?1:0,!1),u.backgroundViewModeNearFar&&t.setFlatV2(u.backgroundViewModeNearFar,o.near,o.far)},_fill_MM_Update:(e,t,r,a,i,s)=>r.matrixWorld!==e.matrixRevision,_fill_MM(e,t,r,a,i){e.bindingGroup.matrixRevision=t.matrixWorld;const s=e.layout;e.setFlatM4(s.modelMatrix,t._mElements)},_fill_MM_NM_Update:(e,t,r,a,i,s)=>r.matrixWorld!==e.matrixRevision||!e.noNeedsFrameUpdate(t.currentFrameIndex,i),_fill_MM_NM(e,t,r,a,i){const s=e.bindingGroup;s.matrixRevision=t.matrixWorld,s.camera=a;const o=e.layout;e.setFlatM4(o.modelMatrix,t._mElements),e.setM3(o.normalMatrix,t._normalMatrix)},_fill_MVM_Update:(e,t,r,a,i,s)=>r.matrixWorld!==e.matrixRevision||!e.noNeedsFrameUpdate(t.currentFrameIndex,i),_fill_MVM(t,r,a,i,s){const o=t.bindingGroup;o.matrixRevision=r.matrixWorld,o.camera=i;const n=t.layout;r._modelViewMatrix||(r._modelViewMatrix=new e._Float32Matrix4,r._modelViewMatrix._multiplyMatricesMV(i.matrixWorldInverse,r.matrixWorld)),t.setM4(n.modelViewMatrix,r._modelViewMatrix)},_fill_MVM_NM_Update:(e,t,r,a,i,s)=>r.matrixWorld!==e.matrixRevision||!e.noNeedsFrameUpdate(t.currentFrameIndex,i),_fill_MVM_NM(t,r,a,i,s){const o=t.bindingGroup;o.matrixRevision=r.matrixWorld,o.camera=i;const n=t.layout;r._modelViewMatrix||(r._modelViewMatrix=new e._Float32Matrix4,r._modelViewMatrix._multiplyMatricesMV(i.matrixWorldInverse,r.matrixWorld)),t.setM4(n.modelViewMatrix,r._modelViewMatrix),t.setM3(n.normalMatrix,r._normalMatrix)},_fill_MM_MVM_Update:(e,t,r,a,i,s)=>r.matrixWorld!==e.matrixRevision||!e.noNeedsFrameUpdate(t.currentFrameIndex,i),_fill_MM_MVM(t,r,a,i,s){const o=t.bindingGroup;o.matrixRevision=r.matrixWorld,o.camera=i;const n=t.layout;r._modelViewMatrix||(r._modelViewMatrix=new e._Float32Matrix4,r._modelViewMatrix._multiplyMatricesMV(i.matrixWorldInverse,r.matrixWorld)),t.setM4(n.modelViewMatrix,r._modelViewMatrix),t.setFlatM4(n.modelMatrix,r._mElements)},_fill_MM_MVM_NM_Update:(e,t,r,a,i,s)=>r.matrixWorld!==e.matrixRevision||!e.noNeedsFrameUpdate(t.currentFrameIndex,i),_fill_MM_MVM_NM(t,r,a,i,s){const o=t.bindingGroup;o.matrixRevision=r.matrixWorld,o.camera=i;const n=t.layout;r._modelViewMatrix||(r._modelViewMatrix=new e._Float32Matrix4,r._modelViewMatrix._multiplyMatricesMV(i.matrixWorldInverse,r.matrixWorld)),t.setM4(n.modelViewMatrix,r._modelViewMatrix),t.setFlatM4(n.modelMatrix,r._mElements),t.setM3(n.normalMatrix,r._normalMatrix)}};return{UBOFiller:new class{constructor(){this.layout=null,this.buffer=null,this.uint32Buffer=null,this.renderer=null,this.bindingGroup=null,this.entries=null,this._dummyTexture=null,this._dummyStorageBuffer=null,this.revisionable=null,this.object=null,this.dg=null,this.token=null}setContext(e,t,r,a,i,s,o,n,l){return this.layout=e,t._ab=r.uboArray,this.buffer=t._ab,this.uint32Buffer=null,this.ubo=t,this.renderer=r,this.bindingGroup=a,this.entries=i,this._dummyTexture=r._dummyTexture,this._dummyStorageBuffer=r._dummyStorageBuffer,this.revisionable=s,this.object=o,this.dg=n,this.token=l,this}setI(e,t){var r=e.offset/4;this.uint32Buffer||(this.uint32Buffer=new Uint32Array(this.buffer.buffer)),this.uint32Buffer[r]=t}setIArray(e,t){var r=e.offset/4;this.uint32Buffer||(this.uint32Buffer=new Uint32Array(this.buffer.buffer));for(let e=0;e<t.length;e++)this.uint32Buffer[r++]=t[e]}setI2(e,t){this.setFlatI2(e,t.x,t.y)}setFlatI2(e,t){var r=e.offset/4;this.uint32Buffer||(this.uint32Buffer=new Uint32Array(this.buffer.buffer)),this.uint32Buffer[r]=t.x,this.uint32Buffer[r+1]=t.y}setFlatI2Array(e,t){var r=e.offset/4;this.uint32Buffer||(this.uint32Buffer=new Uint32Array(this.buffer.buffer));for(let e=0;e<t.length/2;e++)this.uint32Buffer[r++]=t[2*e],this.uint32Buffer[r++]=t[2*e+1]}setI3(e,t){this.setFlatI3(e,t.x,t.y,t.z)}setFlatI3(e,t){var r=e.offset/4;this.uint32Buffer||(this.uint32Buffer=new Uint32Array(this.buffer.buffer)),this.uint32Buffer[r]=t.x,this.uint32Buffer[r+1]=t.y,this.uint32Buffer[r+2]=t.z}setFlatI3Array(e,t){var r=e.offset/4;this.uint32Buffer||(this.uint32Buffer=new Uint32Array(this.buffer.buffer));for(let e=0;e<t.length/3;e++)this.uint32Buffer[r++]=t[3*e],this.uint32Buffer[r++]=t[3*e+1],this.uint32Buffer[r++]=t[3*e+2],r++}setFlatI3ArrayForI4(e,t){var r=e.offset/4;this.uint32Buffer||(this.uint32Buffer=new Uint32Array(this.buffer.buffer));for(let e=0;e<t.length/3;e++)this.uint32Buffer[r++]=t[3*e],this.uint32Buffer[r++]=t[3*e+1],this.uint32Buffer[r++]=t[3*e+2],this.uint32Buffer[r++]=0}setI4(e,t){this.setFlatI4(e,t.x,t.y,t.z,t.w)}setFlatI4(e,t){var r=e.offset/4;this.uint32Buffer||(this.uint32Buffer=new Uint32Array(this.buffer.buffer)),this.uint32Buffer[r]=t.x,this.uint32Buffer[r+1]=t.y,this.uint32Buffer[r+2]=t.z,this.uint32Buffer[r+3]=t.w}setFlatI4Array(e,t){var r=e.offset/4;this.uint32Buffer||(this.uint32Buffer=new Uint32Array(this.buffer.buffer));for(let e=0;e<t.length/4;e++)this.uint32Buffer[r++]=t[4*e],this.uint32Buffer[r++]=t[4*e+1],this.uint32Buffer[r++]=t[4*e+2],this.uint32Buffer[r++]=t[4*e+3]}setF(e,t){var r=e.offset/4;this.buffer[r]=t}setFArray(e,t){var r=e.offset/4;for(let e=0;e<t.length;e++)this.buffer[r++]=t[e]}setV2(e,t){this.setFlatV2(e,t.x,t.y)}setFlatV2(e,t,r){var a=e.offset/4;this.buffer[a]=t,this.buffer[a+1]=r}setV2Array(e,t){var r=e.offset/4;for(let e=0;e<t.length;e++)this.buffer[r++]=t[e].x,this.buffer[r++]=t[e].y}setFlatV2Array(e,t){var r=e.offset/4;for(let e=0;e<t.length/2;e++)this.buffer[r]=t[2*e],this.buffer[r]=t[2*e+1]}setV3(e,t){this.setFlatV3(e,t.x,t.y,t.z)}setFlatV3(e,t,r,a){var i=e.offset/4;this.buffer[i]=t,this.buffer[i+1]=r,this.buffer[i+2]=a}setV3Array(e,t){var r=e.offset/4;for(let e=0;e<t.length;e++)this.buffer[r++]=t[e].x,this.buffer[r++]=t[e].y,this.buffer[r++]=t[e].z,r++}setV3ArrayForV4(e,t){var r=e.offset/4;for(let e=0;e<t.length;e++)this.buffer[r++]=t[e].x,this.buffer[r++]=t[e].y,this.buffer[r++]=t[e].z,this.buffer[r++]=0}setFlatV3Array(e,t){var r=e.offset/4;for(let e=0;e<t.length/3;e++)this.buffer[r++]=t[3*e],this.buffer[r++]=t[3*e+1],this.buffer[r++]=t[3*e+2],r++}setFlatV3ArrayForV4(e,t){var r=e.offset/4;for(let e=0;e<t.length/3;e++)this.buffer[r++]=t[3*e],this.buffer[r++]=t[3*e+1],this.buffer[r++]=t[3*e+2],this.buffer[r++]=0}setColor(e,r,a,i=!1){var s=r;a&&(s=t.copyToLinear(s,i)),this.setFlatV3(e,s.r,s.g,s.b)}setV3PlusF(e,t,r){this.setFlatV4(e,t.x,t.y,t.z,r)}setColorPlusF(e,r,a,i,s=!1){var o=r;i&&(o=t.copyToLinear(o,s)),this.setFlatV4(e,o.r,o.g,o.b,a)}setV4(e,t){this.setFlatV4(e,t.x,t.y,t.z,t.w)}setFlatV4(e,t,r,a,i){var s=e.offset/4;this.buffer[s]=t,this.buffer[s+1]=r,this.buffer[s+2]=a,this.buffer[s+3]=i}setV4Array(e,t){var r=e.offset/4;for(let e=0;e<t.length;e++)this.buffer[r++]=t[e].x,this.buffer[r++]=t[e].y,this.buffer[r++]=t[e].z,this.buffer[r++]=t[e].w}setFlatV4Array(e,t){var r=e.offset/4;for(let e=0;e<t.length/4;e++)this.buffer[r++]=t[4*e],this.buffer[r++]=t[4*e+1],this.buffer[r++]=t[4*e+2],this.buffer[r++]=t[4*e+3]}setM3(e,t){this.setFlatM3(e,t.elements)}setM3Array(e,t){var r=e.offset/4;for(let e=0;e<t.length;e++){var a=t[e].elements;this.buffer[r++]=a[0],this.buffer[r++]=a[1],this.buffer[r++]=a[2],r++,this.buffer[r++]=a[3],this.buffer[r++]=a[4],this.buffer[r++]=a[5],r++,this.buffer[r++]=a[6],this.buffer[r++]=a[7],this.buffer[r++]=a[8],r++}}setFlatM3(e,t){var r=e.offset/4;this.buffer[r++]=t[0],this.buffer[r++]=t[1],this.buffer[r++]=t[2],r++,this.buffer[r++]=t[3],this.buffer[r++]=t[4],this.buffer[r++]=t[5],r++,this.buffer[r++]=t[6],this.buffer[r++]=t[7],this.buffer[r++]=t[8]}setM4(e,t){this.setFlatM4(e,t.elements)}setM4Array(e,t){var r=e.offset/4;for(let e=0;e<t.length;e++){var a=t[e].elements;for(let e=0;e<a.length;e++)this.buffer[r++]=a[e]}}setFlatM4(e,t){var r=e.offset/4;for(let e=0;e<t.length;e++)this.buffer[r++]=t[e]}validateSamplerBinding(e,t){e.visibility===t.visibility&&e.sampler===t.sampler&&e.resource===t.resource||this.bindingGroup.flagAsContentChanged()}validateTextureBinding(e,t){e.visibility===t.visibility&&e.texture===t.texture&&e._internalResource===t._internalResource||this.bindingGroup.flagAsContentChanged()}_setTexture(e,t,r){r=r||this._dummyTexture;const a=this.renderer,i="td2"===e||"td2ms"===e,s=r===this._dummyTexture?"dummy":"texture",o=r._loadWebGPU(s,a,this.revisionable,i),n=this.entries,l=t,u=t+1,m=o._wgpuTexture?o._wgpuTexture:a._getTempTexture(),d={visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,sampler:m._sampler,resource:o._wgpuSampler},c={visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,texture:m._texture,resource:m.textureView,_internalResource:m};if(!this.bindingGroup.needsUpdate){const e=n[l]||{};this.validateSamplerBinding(e,d)}if(!this.bindingGroup.needsUpdate){const e=n[u]||{};this.validateTextureBinding(e,c)}n[l]=d,n[u]=c}setTexture(e,t){this._setTexture(e.type,e.offset,t)}setTextureArray(e,t){for(let r=0;r<t.length;r++)this._setTexture(e.type,e.offsets[r],t[r])}validateBufferBinding(e,t){e.visibility===t.visibility&&e.buffer.type===t.buffer.type&&e.resource.buffer===t.resource.buffer||this.bindingGroup.flagAsContentChanged()}setStorageBuffer(e,t){t=t||this._dummyStorageBuffer;const r=this.entries,a=e.offset,i=e.readOnly?"read-only-storage":"storage",s={visibility:e.readOnly?GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT:GPUShaderStage.FRAGMENT,buffer:{type:i},resource:{buffer:t,label:e.name}};if(!this.bindingGroup.needsUpdate){const e=r[a]||{};this.validateBufferBinding(e,s)}r[a]=s}},__computeGlobalKeyAndFunc:function(e,t){let r=0;for(var a in e)t[a]&&(r|=e[a]);var s;switch(r&~e._IgnoreForFunction){case e.projectionMatrix:s="_fill_PM";break;case e.projectionMatrix|e.viewMatrix:s="_fill_PM_VM";break;case e.projectionMatrix|e.cameraPosition:s="_fill_PM_CP";break;case e.viewMatrix:s="_fill_VM";break;case e.cameraPosition|e.viewMatrix:s="_fill_VM_CP";break;case e.cameraPosition:s="_fill_CP";break;case e.viewMatrix|e.cameraPosition|e.projectionMatrix:s="_fill_PM_VM_CP";break;default:s="fillGlobalUBO"}return[r,i[s]]},__computeObjectKeyAndFunc:function(e,t){let r,a=0;for(var i in e)t[i]&&(a|=e[i]);switch(a&~e._IgnoreForFunction){case e.modelMatrix:r="_fill_MM";break;case e.modelMatrix|e.normalMatrix:r="_fill_MM_NM";break;case e.modelViewMatrix:r="_fill_MVM";break;case e.modelViewMatrix|e.normalMatrix:r="_fill_MVM_NM";break;case e.modelMatrix|e.modelViewMatrix:r="_fill_MM_MVM";break;case e.modelMatrix|e.modelViewMatrix|e.normalMatrix:r="_fill_MM_MVM_NM";break;default:r="fillObjectUBO"}return[a,s[r],s[r+"_Update"]]}}})),define("DS/GPUFormats/WebGPURenderPipelines",["DS/GPUFormats/WebGPUUBOUtils","DS/Mesh/ThreeJS_Base"],(function(e,t){"use strict";var r=1,a=0;const i=["N/A","never","less","equal","less-equal","greater","not-equal","greater-equal","always"],s=["N/A","keep","zero","replace","invert","increment-clamp","decrement-clamp","increment-wrap","decrement-wrap"],o=["N/A","none","back","front"],n=["N/A","add","substract","reverse-substract","min","max"],l=["N/A","zero","one","src","one-minus-src","src-alpha","one-minus-src-alpha","dst-alpha","one-minus-dst-alpha","dst","one-minus-dst","src-alpha-saturated"],u=(new t.Color).setRGB(.26,.4,.33);class m{constructor(e,t,i,s,o,n,l){this.gpuDevice=t,this.renderState=n,this.glType=l,this.key=e;const u=s.program;this.bufferLayouts=u.bufferLayouts,this.shaderModuleVertex=u.wgslShaderModuleVertex,this.shaderModuleFragment=u.wgslShaderModuleFragment,this.topologyType=this.glType===a?"point-list":this.glType===r?"line-list":"triangle-list",this.material=s,this.layoutOrder={Global:-1,Material:-1,Light:-1,Object:-1};let m=[],d=0;const c=u.bindingGroups;for(let e=0;e<o.length;e++){const t=o[e];c[t]&&(this.layoutOrder[t]=d++,m.push(c[t].layout))}var p={bindGroupLayouts:m};this.pipelineLayout=t.createPipelineLayout(p),this.pipelineDescriptor=this.getPipelineDescriptor(i),this.wgpuPipeline=t.createRenderPipeline(this.pipelineDescriptor)}getPipeline(){return this.wgpuPipeline}getPipelineDescriptor(e){let r=this.renderState.passInfo.renderTarget,a=r.depthStencilFormat,u=[],m=this.renderState.pipelineInfo.blendingState,d=null;d=m.eq2?{color:{srcFactor:l[m.src1],dstFactor:l[m.dst1],operation:n[m.eq1]},alpha:{srcFactor:l[m.src2],dstFactor:l[m.dst2],operation:n[m.eq2]}}:{color:{srcFactor:l[m.src1],dstFactor:l[m.dst1],operation:n[m.eq1]},alpha:{srcFactor:l[m.src1],dstFactor:l[m.dst1],operation:n[m.eq1]}};for(let e=0;e<r.colorCount;e++){var c="rgba32float"!==r.format&&m.enable,p={format:r.format,writeMask:this.renderState.pipelineInfo.colorWriteMask};c&&(p.blend=d),u.push(p)}let f={compare:i[this.renderState.pipelineInfo.stencilCompare],failOp:s[this.renderState.pipelineInfo.stencilOpFront[0]],depthFailOp:s[this.renderState.pipelineInfo.stencilOpFront[1]],passOp:s[this.renderState.pipelineInfo.stencilOpFront[2]]},h={compare:i[this.renderState.pipelineInfo.stencilCompare],failOp:s[this.renderState.pipelineInfo.stencilOpBack[0]],depthFailOp:s[this.renderState.pipelineInfo.stencilOpBack[1]],passOp:s[this.renderState.pipelineInfo.stencilOpBack[2]]},x={label:"renderPipeline "+this.key,layout:this.pipelineLayout,depthStencil:{format:a,depthWriteEnabled:this.renderState.pipelineInfo.depthWriteEnabled,depthCompare:i[this.renderState.pipelineInfo.depthCompare],stencilFront:f,stencilBack:h,stencilWriteMask:this.renderState.pipelineInfo.stencilWriteMask,stencilReadMask:this.renderState.pipelineInfo.stencilReadMask,depthBiasSlopeScale:e.polygonOffset&&0!==e.polygonOffsetFactor?e.polygonOffsetUnits:0,depthBias:e.polygonOffset&&0!==e.polygonOffsetUnits?2*e.polygonOffsetUnits:0},multisample:{count:r.multisample?4:1},vertex:{module:this.shaderModuleVertex,entryPoint:"vertex_main",buffers:this.bufferLayouts},fragment:{module:this.shaderModuleFragment,entryPoint:"fragment_main",targets:u}};return"triangle-list"===this.topologyType?(x.primitive={topology:this.topologyType,frontFace:this.renderState.pipelineInfo.frontFace===t.FrontFaceDirectionCW?"cw":"ccw",cullMode:o[this.renderState.pipelineInfo.cullMode]},this.bufferLayouts[0].stepMode="vertex"):"line-list"===this.topologyType?(x.primitive={topology:this.topologyType},x.depthStencil.depthBias=0,x.depthStencil.depthBiasSlopeScale=0,this.bufferLayouts[0].stepMode="vertex"):this.bufferLayouts[0].stepMode="vertex",x}}const d=e.UBOFiller;let c=null;return class{constructor(e){this.pipelines=new Map,this.renderer=e,c||(c=t.__pickingColor)}getPipeline(e,t,r,a,i,s,o){if(s.pipelineInfo.needsHardUpdate){console.info("Pipeline cache cleared"),this.pipelines=new Map,this.renderer.memoryInfo.pipelines=0,s.pipelineInfo.needsHardUpdate=!1;var n=new m(e,t,r,a,i,s,o);return this.renderer.memoryInfo.pipelines++,this.pipelines.set(e,n),n}return(n=this.pipelines.get(e))||(n=new m(e,t,r,a,i,s,o),this.renderer.memoryInfo.pipelines++,this.pipelines.set(e,n)),n}static createBufferLayouts(e,t,r){let a=[];var i={arrayStride:0,stepMode:"vertex",attributes:[]};a.push(i);for(var s=e.getBufferAttributes(),o=0,n={position:"aPosition",normal:"aNormal",uv:"aUv",uv2:"aUv2",tangent:"aTangent",binormal:"aBinormal",color:"aColor",instanceId:"aInstanceId",defaultInstancingMatrix:"aDefaultInstancingMatrix",lineDistance:"aLineDistance",linePixelDistance:"aLinePixelDistance",patternStartEnd:"aPatternStartEnd",previousPos:"aPreviousPos",followingPos:"aFollowingPos",sideExtrusion:"aSideExtrusion",skinIndex:"aSkinIndex",skinWeight:"aSkinWeight",morphTarget0:"aMorphTarget0",morphTarget1:"aMorphTarget1",morphTarget2:"aMorphTarget2",morphTarget3:"aMorphTarget3",morphNormals0:"aMorphNormals0",morphNormals1:"aMorphNormals1",morphNormals2:"aMorphNormals2",morphNormals3:"aMorphNormals3",morphTarget4:"aMorphTarget4",morphTarget5:"aMorphTarget5",morphTarget6:"aMorphTarget6",morphTarget7:"aMorphTarget7"},l=0,u=0;u<s.length;u++){if(!s[u])continue;var m=s[u][0];"tangent"!==m&&"binormal"!==m||!0;var d=n[m]||m;if(t&&!t[d])break;var c=t&&t[d].location?t[d].location:o++;let r=e._attributes.get(m).stride,a=e._attributes.get(m).type;i.attributes.push({format:a,offset:l,shaderLocation:c}),l+=r}if(i.arrayStride=l,r){var p=r.instanceAttribArrays;for(var f in p){const e=p[f];d=n[f]||f;if(t&&!t[d])continue;let r=e.itemSize,i={arrayStride:4*r,stepMode:"instance",attributes:[]};a.push(i);let s="float32";r>1&&(s+="x"+r),i.attributes.push({format:s,offset:0,shaderLocation:t?t[d].location:o++}),"m4"===e.type&&(i.arrayStride*=4,i.attributes.push({format:s,offset:16,shaderLocation:t?t[d].location+1:o++}),i.attributes.push({format:s,offset:32,shaderLocation:t?t[d].location+2:o++}),i.attributes.push({format:s,offset:48,shaderLocation:t?t[d].location+3:o++}))}}return a}static fillObjectPickingBuffer(e,t,r,a,i,s,o){const n=a.program.shaderIO;let l=s.currentCamera;return s.currentModelMatrix=null,!!n.objectUBOUpdateFunc(o,s,e,t,l,i)&&(d.setContext(n.uniformLayouts.object,o.uniformBuffer,s,o,o.entries,e,e,null,null),n.objectUBOFillFunc(d,e,t,l,i),d.layout.pickingColor&&(s.setupPickingMaterial(a,r,e),d.setFlatV3(d.layout.pickingColor,c.r,c.g,c.b)),s.currentRenderInfo.objectUniformCalls++,!0)}static fillObjectBuffer(e,t,r,a,i,s,o){const n=a.program.shaderIO;let l=s.currentCamera;return s.currentModelMatrix=e.matrixWorld,!!n.objectUBOUpdateFunc(o,s,e,t,l,i)&&(d.setContext(n.uniformLayouts.object,o.uniformBuffer,s,o,o.entries,e,e,null,null),n.objectUBOFillFunc(d,e,t,l,i),s.currentRenderInfo.objectUniformCalls++,!0)}static fillGlobalBuffer(e,t,r){const a=r.uniformBuffer;if(r.globalRevision===t.frameConstantUBOsResetIndex)return!1;r.globalRevision=t.frameConstantUBOsResetIndex;const i=e.program.shaderIO;d.setContext(i.uniformLayouts.global,a,t,r,r.entries,null,null,null,null);let s=t.currentCamera;const o=t.materialToUseList;return o.highlightMaterial&&t.scene.highlightData._fillUBO(d,t),o.oitLinkedListMaterial&&t.fillOITLinkedListUBO(d),i.globalUBOFillFunc(d,s,e),e.fillGlobalUBO(d,t),t.fillPostProcessUBO(d),t.currentRenderInfo.globalUniformCalls++,!0}static fillLightBuffer(e,t,r,a){if(a.lastUsedFrameIndex===r.currentFrameIndex&&a.gammaInput===r.gammaInput)return!1;a.gammaInput=r.gammaInput;const i=r.materialToUseList,s=t.program.shaderIO;return d.setContext(s.uniformLayouts.light,a.uniformBuffer,r,a,a.entries,null,e,null,null),t.fillLightsUBO(d,r),!e.receiveShadow||i.shadowMaterial||i.transparentShadowMaterial||r.fillShadowsUBO(d),r.currentRenderInfo.lightUniformCalls++,!0}static fillMaterialBuffer(e,t,r,a,i,s){if(t._revision===a.revision)return!1;a.revision=t._revision;const o=t.program.shaderIO;return d.setContext(o.uniformLayouts.material,a.uniformBuffer,r,a,a.entries,t,e,i,s),t.fillUBO(d,r),t.fillUBOHigh(d,r,null,null,null),t.isPDSFX()&&t._fillPDSFXUBO(d,r,e),e._applyPlaneViewModeColor&&d.layout.diffuse&&d.setColorPlusF(d.layout.diffuse,u,0),r.currentRenderInfo.materialUniformCalls++,!0}static fillMaterialHighBuffer(e,t,r,a,i,s,o,n,l,m){if(!m&&i.globalRevision===a.frameConstantUBOsResetIndex)return!1;i.globalRevision=a.frameConstantUBOsResetIndex;const c=e.program.shaderIO;return d.setContext(c.uniformLayouts.materialhigh,i.uniformBufferHighFrequency,a,i,i.entriesHighFrequency,e,o,n,l),e.fillUBOHigh(d,a,t,r,s),r&&r._mappingOperator&&r._fillMappingOperatorUBO(d,e,a),e.enableClipPlanes&&a.fillClippingUBO(d),o._applyPlaneViewModeColor&&d.layout.diffuse&&d.setColorPlusF(d.layout.diffuse,u,0),!0}}})),define("DS/GPUFormats/AbstractGPUFormat",["DS/Mesh/ThreeJS_Base","DS/GPUFormats/FormatEnums","DS/GPUFormats/WebGPUFormatEnums"],(function(e,t,r){class a{constructor(){e.EventDispatcher.call(this)}clone(){throw"Abstract method called"}isCubeMap(){return!1}_isReady(){return!1}_canBeUsed(){return!1}_loadWebGL(){throw"Abstract method called"}_loadWebGPU(e,t,r,a){throw"Abstract method called"}getSizes(){throw"Abstract method called"}dispose(){this.dispatchEvent({type:"dispose"})}}return e._AbstractGPUFormat=a,a})),define("DS/GPUFormats/Texture",["DS/Mesh/ThreeJS_Base","DS/GPUFormats/AbstractGPUFormat","DS/GPUFormats/FormatEnums","DS/GPUFormats/WebGPUFormatEnums"],(function(e,t,r,a){"use strict";var i=new Map;function s(e,t,r){var a=r?e.mipmaps[0]:e.image;if(a.width<=t&&a.height<=t)return e;var i=Math.max(a.width,a.height),s=Math.floor(a.width*t/i),o=Math.floor(a.height*t/i),n=document.createElement("canvas");return n.width=s,n.height=o,n.getContext("2d").drawImage(a,0,0,a.width,a.height,0,0,s,o),r?e.mipmaps[0]=n:e.image=n,e}function o(e,t,r){var a=new e.constructor(r.dst*(e.length/r.src));const i=t.width,s=t.height;for(let t=0;t<i;t++)for(let o=0;o<s;o++){const s=t+i*o;for(let t=0;t<r.dst;t++)a[r.dst*s+t]=r.defaultValue(e,r.src*s,t)}return a}function n(e,t,r,a){let i=e;if(1==a.texelBlockHeight){let a=e.length/(t*r);i=new e.constructor(e.length);for(let s=0;s<t;s++)for(let o=0;o<r;o++)for(let n=0;n<a;n++)i[a*(s+t*o)+n]=e[a*(s+t*(r-1-o))+n]}return i}function l(e){return e instanceof ImageBitmap||e instanceof ImageData||e instanceof HTMLImageElement||e instanceof HTMLVideoElement||e instanceof VideoFrame||e instanceof OffscreenCanvas||e instanceof HTMLCanvasElement}var u=0;class m extends t{constructor(t,a,i,s,o,n,l,m,d){super(),this.id=u++,this.name="",this._useCount=0,this._source=e.AssetSource.MANUAL,this.forceUpdate=!1,this.hdr=!1,this.hasDiffuse=!1,this.sRGB=!0,this.image=t,this.mipmaps=[],this.extraFaces=null,this.mapping=void 0!==a?a:new r.UVMapping,this.wrapS=void 0!==i?i:r.ClampToEdgeWrapping,this.wrapT=void 0!==s?s:r.ClampToEdgeWrapping,this.magFilter=void 0!==o?o:r.LinearFilter,this.minFilter=void 0!==n?n:r.LinearMipMapLinearFilter,this.anisotropy=void 0!==d?d:1,this.format=void 0!==l?l:r.RGBAFormat,this.type=void 0!==m?m:r.UnsignedByteType,this.encoding=e.RGBA_Encoding,this.offset=new e.Vector2(0,0),this.repeat=new e.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this._needsUpdate=!1,this.onUpdate=null,this.onRequest=null,this._substituteTexture=null,this.borderColor=null,this.loadEndStatus=e.AssetLoadingStatus.INIT,this.onLoadCallbacks=[],this._initialized=!1,this.__webglTexture=null,this._wgpuSampler=null,this._wgpuTexture=null,this._revisionablesToIncreaseRevision=null}clone(t){return void 0===t&&(t=new m),t.hdr=this.hdr,t.sRGB=this.sRGB,t.image=this.image,t.mipmaps=this.mipmaps.slice(0),t.mapping=this.mapping,t.wrapS=this.wrapS,t.wrapT=this.wrapT,t.magFilter=this.magFilter,t.minFilter=this.minFilter,t.anisotropy=this.anisotropy,t.format=this.format,t.type=this.type,t.encoding=this.encoding,t.offset.copy(this.offset),t.repeat.copy(this.repeat),t.generateMipmaps=this.generateMipmaps,t.premultiplyAlpha=this.premultiplyAlpha,t.flipY=this.flipY,t.unpackAlignment=this.unpackAlignment,t._needsUpdate=!0,t._substituteTexture=this._substituteTexture,t.loadEndStatus=this.loadEndStatus,t.loadEndStatus===e.AssetLoadingStatus.LOADING&&this.onLoadCallbacks.push((function(e){t.loadEndStatus=e.loadEndStatus,t.image=e.image,t.mipmaps=e.mipmaps.slice(0),t.extraFaces=e.extraFaces,t.generateMipmaps=e.generateMipmaps,t.format=e.format,e.width&&(t.width=e.width,t.height=e.height)})),this.borderColor&&(t.borderColor=new e.Vector4,t.borderColor.copy(this.borderColor)),t}_isReady(){return this.loadEndStatus===e.AssetLoadingStatus.READY||this.loadEndStatus===e.AssetLoadingStatus.INIT}_canBeUsed(){return null!==this._substituteTexture||this._isReady()}getSizes(){return this.image?{width:this.image.width,height:this.image.height}:this.mipmaps&&this.mipmaps.length?{width:this.mipmaps[0].width,height:this.mipmaps[0].height}:{width:1,height:1}}_sendTextureToWebGL(e,t,r,a,i,s,o,n){r?console.error("Error: Texture can't be a compressed format"):e.texImage2D(t,a,i,o,n,s)}_useBorderColor(){var e={u:!1,v:!1};return this.borderColor&&(this.wrapS===r._ClampToBorderWrapping&&(e.u=!0),this.wrapT===r._ClampToBorderWrapping&&(e.v=!0)),e}isCubeMap(){return!!this.extraFaces&&5===this.extraFaces.length}_correctInternals(e,t,a){let i=this.flipY;return e&&(i&&(i=!1),a&&(a=!1)),a&&(this.minFilter!==r.NearestFilter&&this.minFilter!==r.LinearFilter||(a=!1)),t||a||(this.minFilter!==r.NearestMipMapNearestFilter&&this.minFilter!==r.LinearMipMapNearestFilter||(this.minFilter=r.NearestFilter),this.minFilter!==r.NearestMipMapLinearFilter&&this.minFilter!==r.LinearMipMapLinearFilter||(this.minFilter=r.LinearFilter)),this.magFilter!==r.NearestMipMapNearestFilter&&this.magFilter!==r.LinearMipMapNearestFilter||(this.magFilter=r.NearestFilter),this.magFilter!==r.NearestMipMapLinearFilter&&this.magFilter!==r.LinearMipMapLinearFilter||(this.magFilter=r.LinearFilter),[i,a]}_setupTextureWebGL(t,a,i,o,n,l,u,d,c){if(!this._needsUpdate&&!this.forceUpdate)return;this._initialized||(this._initialized=!0,this.addEventListener("dispose",u),this.__webglTexture=[],this.__webglTexture[0]=t.createTexture(),a.info.memory.textures++,a.__glResources__.texture.push(this));let p=o.bind(a),f=n.bind(a),h=l.bind(a);const x=e.__AllowMipsForTextures,g=this.format>r.CompressedFormats,b=this.isCubeMap(),M=this.mipmaps.length>0,y=this.mipmaps.length>1,_=b?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D,T=b?t.TEXTURE_CUBE_MAP_POSITIVE_X:t.TEXTURE_2D;let B=[new m.Face(this.image,this.mipmaps)];if(b&&(B=B.concat(this.extraFaces),!g&&c))for(let e=0;e<B.length;e++)B[e]=s(B[e],c,M);const v=M?B[0].mipmaps[0]:B[0].image,w=i(v.width)&&i(v.height);if(!w&&!this.nPot&&!b){let e=!1;if(!(g&&this.format<r.MaxDDSFormats)||this.wrapS===r.ClampToEdgeWrapping&&this.wrapT===r.ClampToEdgeWrapping||(e=!0),e)return void a._texturesToResize.add(this)}let[F,P]=this._correctInternals(g,x&&y,x&&this.generateMipmaps&&!y);const U=p(this.format),C=p(this.type),S=f(U,C,P);null!=d&&t.activeTexture(t.TEXTURE0+d),t.bindTexture(_,this.__webglTexture[0]),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,F),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,this.unpackAlignment),h(_,this,w);for(let e=0;e<B.length;e++){const r=B[e];if(M){const a=x?r.mipmaps.length:Math.min(1,r.mipmaps.length);for(let i=0;i<a;i++){const a=r.mipmaps[i];this._sendTextureToWebGL(t,T+e,g,i,S,a,U,C)}}else this._sendTextureToWebGL(t,T+e,g,0,S,r.image,U,C)}P&&w&&t.generateMipmap(_),this._needsUpdate=!1,this.onUpdate&&this.onUpdate()}_setupTextureWebGPU(t,i){if(!this._needsUpdate&&!this.forceUpdate)return!0;this._initialized||(this._initialized=!0,this.addEventListener("dispose",i.onTextureDispose),i.info.memory.textures++),this._revisionablesToIncreaseRevision=this._revisionablesToIncreaseRevision||new Set;const u=e.__AllowMipsForTextures,d=this.format>r.CompressedFormats,c=this.isCubeMap(),p=this.mipmaps.length>0,f=this.mipmaps.length>1;let h="2d",[x,g]=this._correctInternals(d,u&&f,u&&this.generateMipmaps&&!f),b=[new m.Face(this.image,this.mipmaps)];if(c){if(b=b.concat(this.extraFaces),!d)for(let e=0;e<b.length;e++)b[e]=s(b[e],8192,p);h="cube"}let M=i._getTextureFormat(this);const y=a[M];if(!y)return console.error("Unsupported format class "+M),!1;const _=y.convert;_&&(M=_.format);let T,B=b[0],v=0;if(p){T=B.mipmaps[0];const e=u?B.mipmaps.length:Math.min(1,B.mipmaps.length);for(let t=0;t<e;t++){let e=B.mipmaps[t],r={width:e.width,height:e.height};if(r.width<y.texelBlockWidth||r.height<y.texelBlockWidth)break;v++}}else T=B.image,v=g?Math.floor(Math.log2(Math.max(T.width,T.height)))+1:1;let w=GPUTextureUsage.TEXTURE_BINDING;y.renderable&&(w|=GPUTextureUsage.RENDER_ATTACHMENT),y.copyDst&&(w|=GPUTextureUsage.COPY_DST),y.copySrc&&(w|=GPUTextureUsage.COPY_SRC);const F={width:T.width,height:T.height,depthOrArrayLayers:c?6:1},P={width:T.width,height:T.height};let U={label:t,size:F,format:M,usage:w,mipLevelCount:v,dimension:"2d"};this._wgpuTexture&&this._wgpuTexture.destroy(),this._wgpuTexture=i.webGPUDevice.createTexture(U);const C=this._wgpuTexture;C.textureView=C.createView({label:t,dimension:h}),C.formatClass=y,C._texture=y.texture({viewDimension:h,multisampled:C.sampleCount>1}),C._sampler=y.sampler({multisampled:C.sampleCount>1}),this._wgpuSampler=i._createTextureSampler(this,y,C.sampleCount);for(let e=0;e<b.length;e++){B=b[e],T=p?B.mipmaps[0]:B.image;let t=null;if(l(T)&&(t=T),t){if(_)return console.error("Unsupported format class "+M),!1;i.webGPUDevice.queue.copyExternalImageToTexture({source:t,flipY:x},{texture:C,origin:{x:0,y:0,z:e},premultipliedAlpha:!1},P),v>1&&i.generateMipmap(C,U)}else if(T&&T.data)if(p)for(let t=0;t<v;t++){let r=B.mipmaps[t],a=r.data,s={width:r.width,height:r.height};_&&(a=o(a,s,_)),s.width%y.texelBlockWidth==0&&s.height%y.texelBlockHeight==0||(s.width=s.width+(y.texelBlockWidth-s.width%y.texelBlockWidth),s.height=s.height+(y.texelBlockHeight-s.height%y.texelBlockHeight),console.warn("Warning: badly formed mip detected, expect visual artefacts")),i.webGPUDevice.queue.writeTexture({texture:C,origin:{x:0,y:0,z:e},mipLevel:t},x?n(a,s.width,s.height,y):a,{bytesPerRow:y.texelBlockBytes*s.width/y.texelBlockWidth},s)}else{let t=T.data;_&&(t=o(t,F,_)),i.webGPUDevice.queue.writeTexture({texture:C,origin:{x:0,y:0,z:e}},x?n(t,F.width,F.height,y):t,{bytesPerRow:y.texelBlockBytes*F.width/y.texelBlockWidth},P),v>1&&i.generateMipmap(C,U)}}return this._needsUpdate=!1,this.onUpdate&&this.onUpdate(),!0}dispose(){super.dispose(),this._substituteTexture&&this._substituteTexture.dispose()}setAsLOD(e){this.lods=[],this.textures=[],this.usedTexture=-1,this.lastUsedTexture=-1,this.switchLODTextureCB=e}withSubstituteTexture(t=0,r=0,a=0,s=255){return this._initialized||(t<=1&&(t*=255),r<=1&&(r*=255),a<=1&&(a*=255),s<=1&&(s*=255),this._substituteTexture=function(t,r,a,s){t=Math.floor(t),r=Math.floor(r),a=Math.floor(a);var o=256*(256*(256*(s=Math.floor(s))+a)+r)+t;if(i.has(o))return i.get(o);for(var n=new Uint8Array(16),l=0;l<4;l++)n[4*l]=t,n[4*l+1]=r,n[4*l+2]=a,n[4*l+3]=s;var u=new e.DataTexture(n,2,2,e.RGBAFormat,e.UnsignedByteType,new e.LatLongReflectionMapping,e.ClampToEdgeWrapping,e.ClampToEdgeWrapping,e.LinearFilter,e.LinearFilter);return u.generateMipmaps=!1,u.needsUpdate=!0,i.set(o,u),u}(t,r,a,s)),this}chooseTexture(e,t){var r=this.usedTexture;if(this.switchLODTextureCB?this.usedTexture=this.switchLODTextureCB({camera:e,object:t,texture:this,lods:this.lods,bSphere:t.geometry.boundingSphere,bBox:t.geometry.boundingBox,matrix:t.matrixWorld}):this.usedTexture=-1,-1!==this.usedTexture){var a=this.lods[this.usedTexture];!this.textures[this.usedTexture]&&a.loadCB&&(this.textures[this.usedTexture]=a.loadCB(this))}return r!==this.usedTexture}set needsUpdate(e){this._needsUpdate=e,this._needsUpdate&&this._revisionablesToIncreaseRevision&&(this._revisionablesToIncreaseRevision.forEach((e=>e._revision++)),this._revisionablesToIncreaseRevision=new Set)}get needsUpdate(){return this._needsUpdate}_loadWebGPU(e,t,r,a){let i=this;i.onRequest&&i.onRequest(),!i._isReady()&&i._substituteTexture&&(i=i._substituteTexture,r&&r._revision++),i._isReady()||(i=t._dummyTexture,e="dummy",r&&r._revision++);if(!(i.isCubeMap&&i.isCubeMap())&&i.lods&&i.lods.length){var s=i.usedTexture;if(-1===s)i.lastUsedTexture=-1;else{var o=i.textures[s];o&&o._isReady()?(i.lastUsedTexture=s,i=o):o&&!o._isReady()?o.onLoadCallbacks.push((e=>{i._revisionablesToIncreaseRevision.forEach((e=>e._revision++))})):-1!==i.lastUsedTexture&&(i=i.textures[i.lastUsedTexture])}}return i._setupTextureWebGPU(e,t)?r&&i._revisionablesToIncreaseRevision.add(r):(i=t._dummyTexture,e="dummy",i._setupTextureWebGPU(e,t)),i}}return m.Face=function(e,t){this.image=e,this.mipmaps=t},m})),define("DS/GPUFormats/AbstractRenderTarget",["DS/Mesh/ThreeJS_Base","DS/GPUFormats/AbstractGPUFormat","DS/GPUFormats/FormatEnums","DS/GPUFormats/WebGPUFormatEnums"],(function(e,t,r,a){var i=0;class s extends t{constructor(t,r,a,s){super(),this.uniqueID=i++,this.id=this.uniqueID,this.width=t,this.height=r,this.colorCount=void 0!==s?s:1,this._disposed=!1,this.loadEndStatus=e.AssetLoadingStatus.READY,this.multisample=!1,this.depthSampled=!1,this.reset(a)}reset(e){throw"Abstract method called"}_isReady(){return!0}_canBeUsed(){return!0}getSizes(){return{width:this.width,height:this.height}}dispose(){super.dispose(),this._disposed=!0}_dump(){throw"Abstract method called"}_loadWebGPU(e,t,r,a){let i=this,s=i.options;return i=a?i.getDepthTexture(this):i.getTexture(this),i._wgpuTexture||(i=t._dummyTexture,s=i,"dummy",i._setupTextureWebGPU("dummy",t),r&&r._revision++),i._wgpuSampler=t._createTextureSampler(s,i._wgpuTexture.formatClass,i._wgpuTexture.sampleCount),i}}return e._AbstractRenderTarget=s,s})),define("DS/GPUFormats/CompressedTexture",["DS/Mesh/ThreeJS_Base","DS/GPUFormats/Texture"],(function(e,t){"use strict";class r extends t{constructor(e,t,r,a,i,s,o,n,l,u,m){super({width:t,height:r,data:null},s,o,n,l,u,a,i,m),this.mipmaps=e||[]}clone(){var e=new r;return super.clone(e),e}_sendTextureToWebGL(e,t,r,a,i,s,o,n){s.data?r?e.compressedTexImage2D(t,a,o,s.width,s.height,0,s.data):e.texImage2D(t,a,i,s.width,s.height,0,o,n,s.data):console.error("Error: wrong CompressedTexture usage, no data found")}}return r})),define("DS/GPUFormats/WebGPURenderTarget",["DS/Mesh/ThreeJS_Base","DS/GPUFormats/AbstractRenderTarget","DS/GPUFormats/FormatEnums","DS/GPUFormats/WebGPUFormatEnums"],(function(e,t,r,a){"use strict";return class extends t{constructor(e,t,r,i,s,o){if(super(e,t,r,i),this.multisample=s&&"rgba32float"!==r.format,this.format=r.format,this.depthSampled=o,this.formatClass=a[this.format],!this.formatClass||this.formatClass.convert)throw"Unsupported format class "+this.format;if(this.depthStencilFormat="depth24plus-stencil8",this.depthStencilFormatClass=a[this.depthStencilFormat],!this.depthStencilFormatClass||this.depthStencilFormat.convert)throw"Unsupported format class "+this.depthStencilFormat;this.optionId=null,this.canvasTarget=null,this.__colorTextures=[],this.__depthTexture=null,this.resolveTarget=null,this.__init=!1,this.passIsLastMultisampled=!1}init(e){let t=this.__colorTextures.length!=this.colorCount;if(!this.canvasTarget&&t){let t=GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC|GPUTextureUsage.COPY_DST|GPUTextureUsage.TEXTURE_BINDING,r={size:{width:this.width,height:this.height},format:this.format,usage:t};for(let t=0;t<this.colorCount;t++){if(r.label=`renderTarget ${this.uniqueID} colorTexture${t}`,this.multisample){r.sampleCount=4,r.label+="Multisampled",this.__colorTextures[t]=e.createTexture(r),this.__colorTextures[t].colorAttachmentsView=this.__colorTextures[t].createView(),r.sampleCount=1,r.label=`renderTarget ${this.uniqueID} resolve color Texture`,this.lastPassResolveTarget=e.createTexture(r),this.lastPassResolveTarget.colorAttachmentsView=this.lastPassResolveTarget.createView({label:r.label+" view"});const a=this.lastPassResolveTarget;a.textureView=a.createView({label:"rt 2d",dimension:a.dimension}),a.formatClass=this.formatClass,a._texture=this.formatClass.texture({viewDimension:a.dimension,multisampled:a.sampleCount>1}),a._sampler=this.formatClass.sampler({multisampled:a.sampleCount>1})}else r.sampleCount=1,this.__colorTextures[t]=e.createTexture(r),this.__colorTextures[t].colorAttachmentsView=this.__colorTextures[t].createView({label:r.label+" View"});const a=this.__colorTextures[t];a.textureView=a.createView({label:"rt 2d",dimension:a.dimension}),a.formatClass=this.formatClass,a._texture=this.formatClass.texture({viewDimension:a.dimension,multisampled:a.sampleCount>1}),a._sampler=this.formatClass.sampler({multisampled:a.sampleCount>1})}}if(!this.__depthTexture){let t=GPUTextureUsage.RENDER_ATTACHMENT|(this.depthSampled?GPUTextureUsage.TEXTURE_BINDING:0),r={size:{width:this.width,height:this.height},format:this.depthStencilFormat,usage:t};r.label=`renderTarget ${this.uniqueID} depthTexture`,this.multisample?(r.sampleCount=4,r.label+="Multisampled",this.__depthTexture=e.createTexture(r),this.__depthTexture.view=this.__depthTexture.createView({label:r.label+" View"})):(r.sampleCount=1,this.__depthTexture=e.createTexture(r),this.__depthTexture.view=this.__depthTexture.createView({label:r.label+" View"}));const a=this.__depthTexture;a.textureView=a.createView({label:"depth rt 2d",aspect:"depth-only",dimension:a.dimension}),a.formatClass=this.depthStencilFormatClass,a._texture=this.depthStencilFormatClass.texture({viewDimension:a.dimension,multisampled:a.sampleCount>1}),a._sampler=this.depthStencilFormatClass.sampler({multisampled:a.sampleCount>1})}}getRenderPassDescriptor(e,t){let r={label:"RenderPassDesc : "+(t||this.currentPassName),colorAttachments:[],depthStencilAttachment:{view:this.shareDepthFrom?this.shareDepthFrom.__depthTexture.view:this.__depthTexture.view,depthClearValue:e.clearDepth,depthLoadOp:e.depthLoadOp,depthStoreOp:e.depthStoreOp,stencilClearValue:e.clearStencil,stencilLoadOp:e.stencilLoadOp,stencilStoreOp:e.stencilStoreOp,depthReadOnlyValue:!1,stencilReadOnlyValue:!1}};for(let t=0;t<this.colorCount;t++)if(this.resolveTarget){let a=this.resolveTarget.createTextureView(),i={view:this.__colorTextures[t].colorAttachmentsView,resolveTarget:a,clearValue:e.clearColor,loadOp:e.colorLoadOp,storeOp:e.colorStoreOp};r.colorAttachments.push(i)}else{let a=this.__colorTextures[t],i={view:this.canvasTarget?this.canvasTarget.createTextureView():a.colorAttachmentsView,clearValue:e.clearColor,loadOp:e.colorLoadOp,storeOp:e.colorStoreOp};0===this.materialToUse&&this.multisample&&this.passIsLastMultisampled&&(i.resolveTarget=this.lastPassResolveTarget.colorAttachmentsView),r.colorAttachments.push(i)}return r}getTexture(e,t=0){let r={_wgpuSampler:null,_wgpuTexture:this.__colorTextures[t]};return this.passIsLastMultisampled&&(r._wgpuTexture=this.lastPassResolveTarget),r}getDepthTexture(){let e={_wgpuSampler:null,_wgpuTexture:this.__depthTexture};return this.depthSampled||console.warn("depth texture was not created with shader binding enabled (see depthSampled flag)"),e}setResolveTarget(e){this.resolveTarget=e}setCanvas(e){this.canvasTarget=e}reset(e){this.options=e,void 0===this.options.wrapS&&(this.options.wrapS=r.ClampToEdgeWrapping),void 0===this.options.wrapT&&(this.options.wrapT=r.ClampToEdgeWrapping)}dispose(){super.dispose();for(let e=0;e<this.__colorTextures.length;e++)this.__colorTextures[e].destroy();this.__depthTexture&&this.__depthTexture.destroy()}getBufferSize(e){e=e||{};let t=Math.floor(e.width||this.width),r=Math.floor(e.height||this.height),a=this.formatClass.texelBlockBytes,i=256*Math.ceil(t*a/256);return[r*i,i,i/a,t,r]}_fillDataBuffer(e,t,r,a,i){t=t||{};let s=this.__colorTextures[a||0],[o,n,l,u,m]=this.getBufferSize(t);r||(r=e.createBuffer({label:"Dump Buffer",size:o,usage:i}));let d=e.createCommandEncoder();return d.copyTextureToBuffer({texture:s,origin:{x:t.x||0,y:t.y||0,z:t.z||0}},{buffer:r,bytesPerRow:n,rowsPerImage:m},{width:u,height:m,depthOrArrayLayers:1}),e.queue.submit([d.finish()]),[r,l,u,m]}fillDataBufferSync(e,t,r,a){let i=GPUBufferUsage.MAP_READ_SYNC|GPUBufferUsage.COPY_DST,[s,o,n,l]=this._fillDataBuffer(e,t,r,a,i);return s.mapSync(GPUMapMode.READ),{buffer:s,bufferWidth:o,usefulWidth:n,height:l}}async fillDataBufferAsync(e,t,r,a){let i=GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST,[s,o,n,l]=this._fillDataBuffer(e,t,r,a,i);return await s.mapAsync(GPUMapMode.READ),{buffer:s,bufferWidth:o,usefulWidth:n,height:l}}_dump(e,t,r,a){let i=this;t=t||"RenderTarget_dump",this.fillDataBufferAsync(e,r,null,a).then((function(e){let r=e.usefulWidth,a=e.height,s=e.buffer.getMappedRange(),o=null,n=null,l=function(e){return Math.floor(255*e)};if(i.format.includes("float")?i.format.includes("16")?(n=new Uint16Array(s),l=function(e){var t=(31744&e)>>10,r=1023&e,a=(e>>15?-1:1)*(t?31===t?r?NaN:1/0:Math.pow(2,t-15)*(1+r/1024):r/1024*6103515625e-14);return Math.floor(255*a)}):i.format.includes("32")&&(n=new Float32Array(s)):i.format.includes("8")?(n=new Uint8ClampedArray(s),l=function(e){return e}):i.format.includes("16")?n=new Uint16Array(s):i.format.includes("32")?n=new Uint32Array(s):console.log("renderTarget dump unsupported format :"+i.format),!i.format.includes("rgba"))return console.log(" renderTarget dump other than rgba not supported yet, here is the content though:"),void console.log(n);o=new Uint8ClampedArray(4*r*a);for(let t=0;t<a;t++)for(let a=0;a<r;a++)for(let i=0;i<4;i++)o[i+4*(a+t*r)]=l(n[i+4*(a+t*e.bufferWidth)]);let u=document.createElement("a"),m=document.createElement("canvas");document.body.appendChild(m);let d=m.getContext("2d");m.height=a,m.width=r;let c=d.createImageData(r,a);c.data.set(o),d.putImageData(c,0,0);let p=m.toDataURL("image/png");u.download=t,u.href=p,u.click()}))}}})),define("DS/GPUFormats/WebGLRenderTarget",["DS/Mesh/ThreeJS_Base","DS/GPUFormats/AbstractRenderTarget","DS/GPUFormats/FormatEnums"],(function(e,t,r){"use strict";class a extends t{constructor(e,t,r,a,i,s){super(e,t,r,a),this.__webglTexture=null,this.__webglFramebuffer=null,this.__webglRenderbuffer=null,this.__webglMRTFramebuffers=null,r&&(this.originalMagFilter=r.magFilter,this.originalMinFilter=r.minFilter)}clone(){var e=new a(this.width,this.height);return e.colorCount=this.colorCount,e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.format=this.format,e.type=this.type,e.encoding=this.encoding,e.depthBuffer=this.depthBuffer,e.stencilBuffer=this.stencilBuffer,e.generateMipmaps=this.generateMipmaps,e.mapping=this.mapping,e.shareDepthFrom=this.shareDepthFrom,this.originalMagFilter&&(e.originalMagFilter=this.originalMagFilter),this.originalMinFilter&&(e.originalMinFilter=this.originalMinFilter),e}reset(t){t=t||{},this.wrapS=void 0!==t.wrapS?t.wrapS:r.ClampToEdgeWrapping,this.wrapT=void 0!==t.wrapT?t.wrapT:r.ClampToEdgeWrapping,this.magFilter=void 0!==t.magFilter?t.magFilter:r.LinearFilter,this.minFilter=void 0!==t.minFilter?t.minFilter:r.LinearMipMapLinearFilter,this.anisotropy=void 0!==t.anisotropy?t.anisotropy:1,this.offset=new e.Vector2(0,0),this.repeat=new e.Vector2(1,1),this.format=void 0!==t.format?t.format:r.RGBAFormat,this.type=void 0!==t.type?t.type:r.UnsignedByteType,this.encoding=void 0!==t.encoding?t.encoding:r.RGBA_Encoding,this.depthBuffer=void 0===t.depthBuffer||t.depthBuffer,this.stencilBuffer=void 0===t.stencilBuffer||t.stencilBuffer,this.generateMipmaps=!0,this.mapping=new r.UVMapping,this.shareDepthFrom=null,this.hdr=!1,this.hasDiffuse=!1,this.sRGB=!1,this.useCount=0}_dump(t,a,i,s){let o=s||0,n=0==o?this.__webglFramebuffer:this.__webglMRTFramebuffers[o-1];n.length&&(n=n[i]);var l=Math.floor(this.width),u=Math.floor(this.height);var m=null;let d=this.type==r.FloatType||this.type==r.HalfFloatType;m=d?new Float32Array(l*u*4):new Uint8ClampedArray(l*u*4),t.bindFramebuffer(t.FRAMEBUFFER,n),t.readPixels(0,0,l,u,t.RGBA,d?t.FLOAT:t.UNSIGNED_BYTE,m),t.bindFramebuffer(t.FRAMEBUFFER,e.glStates.currentFramebuffer);let c=function(e){return e};d&&(c=function(e){return Math.floor(255*e)});let p=new Uint8ClampedArray(l*u*4);for(var f=function(e,t,r,a,i){return i?(t=a-t,r*Math.floor(t-1)+Math.floor(e)):r*Math.floor(t)+Math.floor(e)},h=0;h<u;h++)for(var x=0;x<l;x++){var g=f(x,h,l,u,!1),b=f(x,h,l,u,!0);for(let e=0;e<4;e++)p[4*g+e]=c(m[4*b+e])}var M=document.createElement("a"),y=document.createElement("canvas");document.body.appendChild(y);var _=y.getContext("2d");y.height=u,y.width=l;var T=_.createImageData(l,u);T.data.set(p),_.putImageData(T,0,0);var B=y.toDataURL("image/png");M.download=a||"renderTarget_dump",M.href=B,M.click()}}return a})),define("DS/GPUFormats/WebGPURenderTargetCube",["DS/Mesh/ThreeJS_Base","DS/GPUFormats/FormatEnums","DS/GPUFormats/WebGPUFormatEnums","DS/GPUFormats/WebGPURenderTarget"],(function(e,t,r,a){"use strict";return class extends a{constructor(e,t,r,a,i){super(e,t,r,a,i),this.activeCubeFace=0}init(e){if(!this.canvasTarget&&this.__colorTextures.length!=this.colorCount){let t=GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC|GPUTextureUsage.COPY_DST|GPUTextureUsage.TEXTURE_BINDING,r={size:{width:this.width,height:this.height,depthOrArrayLayers:6},format:this.format,usage:t,dimension:"2d"};for(let t=0;t<this.colorCount;t++){this.__colorTextures[t]=e.createTexture(r);const a=this.__colorTextures[t];a.textureView=a.createView({label:"rt cube",dimension:"cube"}),a.formatClass=this.formatClass,a._texture=this.formatClass.texture({viewDimension:"cube",multisampled:a.sampleCount>1}),a._sampler=this.formatClass.sampler({multisampled:a.sampleCount>1})}}if(!this.__depthTexture){this.__depthTexture=e.createTexture({size:{width:this.width,height:this.height,depthOrArrayLayers:6},sampleCount:1,format:this.depthStencilFormat,usage:GPUTextureUsage.RENDER_ATTACHMENT}),this.__depthTexture.formatClass=this.depthStencilFormatClass;const t=this.__depthTexture;t.formatClass=this.depthStencilFormatClass,t.textureView=t.createView({label:"depth rt cube",dimension:"cube"}),t._texture=this.depthStencilFormatClass.texture({viewDimension:"cube",multisampled:t.sampleCount>1}),t._sampler=this.depthStencilFormatClass.sampler({multisampled:t.sampleCount>1})}}getRenderPassDescriptor(e){let t={colorAttachments:[],depthStencilAttachment:{view:(this.shareDepthFrom?this.shareDepthFrom.__depthTexture:this.__depthTexture).createView({dimension:"2d",baseArrayLayer:this.activeCubeFace,arrayLayerCount:1}),depthClearValue:e.clearDepth,depthLoadOp:e.depthLoadOp,depthStoreOp:e.depthStoreOp,stencilClearValue:e.clearStencil,stencilLoadOp:e.stencilLoadOp,stencilStoreOp:e.stencilStoreOp,depthReadOnlyValue:!1,stencilReadOnlyValue:!1}};for(let r=0;r<this.colorCount;r++)this.resolveTarget?t.colorAttachments.push({view:this.__colorTextures[r].createView({dimension:"2d",baseArrayLayer:this.activeCubeFace,arrayLayerCount:1}),resolveTarget:resolveTarget.createTextureView({dimension:"2d",baseArrayLayer:this.activeCubeFace,arrayLayerCount:1}),clearValue:e.clearColor,loadOp:e.colorLoadOp,storeOp:e.colorStoreOp}):t.colorAttachments.push({view:this.canvasTarget?this.canvasTarget.createTextureView({dimension:"2d",baseArrayLayer:this.activeCubeFace,arrayLayerCount:1}):this.__colorTextures[r].createView({dimension:"2d",baseArrayLayer:this.activeCubeFace,arrayLayerCount:1}),clearValue:e.clearColor,loadOp:e.colorLoadOp,storeOp:e.colorStoreOp});return t}isCubeMap(){return!0}_dump(e,t,r){for(let a=0;a<6;a++){let i=(t||"renderTargetCube_dump")+"_"+a;super._dump(e,i,{z:a},r)}}}})),define("DS/GPUFormats/NonPowerOfTwoTexture",["DS/Mesh/ThreeJS_Base","DS/GPUFormats/CompressedTexture"],(function(e,t){"use strict";return class extends t{constructor(t,r,a,i,s,o,n,l,u,m,d,c){super({width:a,height:i,data:null},n,l,u,m,d,s,o,c),this.image=t.image,this.mapping=t.mapping,this.wrapS=e.ClampToEdgeWrapping,this.wrapT=e.ClampToEdgeWrapping,this.magFilter=e.LinearFilter,this.minFilter=e.LinearFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.type=t.type,this.needsUpdate=!0,this.generateMipmaps=!1,r.length&&(this.image=r[0]),this.nPot=!0}clone(){var e=new t;return super.clone(e),e}}})),define("DS/GPUFormats/WebGLRenderTargetCube",["DS/GPUFormats/WebGLRenderTarget"],(function(e){"use strict";return class extends e{constructor(e,t,r){super(e,t,r),this.activeCubeFace=0}isCubeMap(){return!0}_dump(e,t,r){for(let a=0;a<6;a++){let i=(t||"renderTargetCube_dump")+"_"+a;super._dump(e,i,a,r)}}}})),define("DS/GPUFormats/DataTexture",["DS/Mesh/ThreeJS_Base","DS/GPUFormats/Texture"],(function(e,t){"use strict";class r extends t{constructor(e,t,r,a,i,s,o,n,l,u,m){super({data:e,width:t,height:r},s,o,n,l,u,a,i,m)}clone(){var e=new r;return super.clone(e),e}_sendTextureToWebGL(e,t,r,a,i,s,o,n){s.data?r?console.error("Error: DataTexture can't be a compressed format"):e.texImage2D(t,a,i,s.width,s.height,0,o,n,s.data):console.error("Error: wrong DataTexture usage, no data found")}}return r})),define("DS/GPUFormats/GPUFormats",["DS/GPUFormats/FormatEnums","DS/GPUFormats/WebGPUFormatEnums","DS/GPUFormats/Texture","DS/GPUFormats/CompressedTexture","DS/GPUFormats/DataTexture","DS/GPUFormats/TextureLODPool","DS/GPUFormats/WebGLRenderTarget","DS/GPUFormats/WebGLRenderTargetCube","DS/GPUFormats/WebGPURenderTarget","DS/GPUFormats/WebGPURenderTargetCube","DS/GPUFormats/NonPowerOfTwoTexture","DS/GPUFormats/VertexAttribute"],(function(e,t,r,a,i,s,o,n,l,u,m,d){"use strict";var c={VertexAttribute:d,Texture:r,AssetLoadingStatus:{INIT:null,PAUSED:"pause",LOADING:"loading",ERROR:"error",READY:"complete"},CompressedTexture:a,DataTexture:i,TextureLODPool:s,NonPowerOfTwoTexture:m,WebGLRenderTargetProperties:function(e,t,r,a){this.width=e,this.height=t,this.options=r,this.targetCount=a||1},WebGLRenderTarget:o,WebGLRenderTargetCube:n,WebGPURenderTarget:l,WebGPURenderTargetCube:u,WebGPUFormatEnums:t,WebGPUBufferCPUAccess:{None:0,Stage:1,MapRead:2,MapWrite:3}};return Object.assign(c,e),c}));