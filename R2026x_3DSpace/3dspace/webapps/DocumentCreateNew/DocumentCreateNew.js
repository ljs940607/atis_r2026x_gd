define("DS/DocumentCreateNew/PLMNewFilesTab/ContextMenu",["UWA/Core","UWA/Class","DS/DocumentCreateNew/PLMNewFilesTab/Commands","DS/Menu/Menu"],(function(e,t,n,i){"use strict";return t.extend({init:function(t){var o=this;o.ctrl=t,i.hide();var a=o.options={fetchSecurityContext:function(){return o.ctrl.options.fetchSecurityContext()||widget.getValue("credentials")},getWorkUnderHeaders:function(){return{}},getSelectedNodes:function(){return o.ctrl.controller.files.treeDocument.getSelectedNodes()},getOrigin:function(){return{source:e.is(widget.data.appId)?widget.data.appId:widget.environment.data._data._x_appId,widgetId:widget.id,component:"contextmenu"}},platformUrls:o.ctrl.options.platformServices,events:o.ctrl.events,isFromContextMenu:!0,ctrl:o.ctrl,uaSource:"PLMNewFilesTab"};o.commands=new n(a);var s=o.commands.commands;o.rawItems=[s.RemoveFile]},rawItems:[],selectionChanged:function(){var e=this;e.promise=e.commands.getWebUXContextMenuItemsForCurrentSelection(e.rawItems,!0)}})})),define("DS/DocumentCreateNew/PLMNewFilesTab/views/Toolbar",["UWA/Core","UWA/Class","DS/Tweakers/GeneratedToolbar","DS/DocumentCreateNew/PLMNewFilesTab/Commands","DS/Utilities/Utils"],(function(e,t,n,i,o){"use strict";return t.extend({init:function(e){var t=this;t.ctrl=e,e.toolbar=this,t.selectionChanged=o.debounce((function(){t.commands.selectionChangedForWebUXToolbar(t.GeneratedToolbar)}),10),t.ctrl.events.subscribe({event:"selection-add"},(function(){t.selectionChanged()})),t.ctrl.events.subscribe({event:"selection-remove"},(function(){t.selectionChanged()}))},build:function(t){var o=this;let a,s={entries:[]};var r={fetchSecurityContext:function(){return o.ctrl.options.fetchSecurityContext()||widget.getValue("credentials")},getWorkUnderHeaders:function(){return{}},getSelectedNodes:function(){return o.ctrl.controller.files.treeDocument.getSelectedNodes()},getOrigin:function(){return{source:e.is(widget.data.appId)?widget.data.appId:widget.environment.data._data._x_appId,widgetId:widget.id,component:"toolbar"}},platformUrls:o.ctrl.options.platformServices,events:o.ctrl.events,ctrl:o.ctrl,uaSource:"PLMNewFilesTab"};o.commands=new i(r);var l=o.commands.commands;s.entries=[l.RemoveFile,l.UploadFile,l.ViewSwitcher],a=o.ToolbarTreeDocument=n.prototype.createTreeDocument(s);let c=o.GeneratedToolbar=new n({items:a,direction:"horizontal",overflowManagement:"dropdown",executionContext:{}});return o.commands.connectToWebUXToolbar(c),c.inject(t),c},selectionChanged:void 0})})),define("DS/DocumentCreateNew/PLMNewFilesTab/actions/UploadFile",["i18n!DS/DocumentCreateNew/assets/nls/DocumentCreateNew"],(function(e){"use strict";var t=function(n){return{id:"UploadFile",dataElements:{docV2Private:!0,typeRepresentation:"functionIcon",icon:{iconName:"upload",fontIconFamily:1},label:e.get("Upload"),tooltip:e.get("Upload"),position:"far",category:"fileAction",value:function(e){e.options=n,t.execute(e)},visibleFlag:!0,priority:10},updateForSelection:function(e,t){return!0},execute:function(){t.execute({options:n})}}};return t.execute=function(e){e.options.events.publish({event:"user-wants-filePicker-for-upload",data:void 0})},t})),define("DS/DocumentCreateNew/PLMNewFilesTab/utils/ExtensionUtils",["DS/DocumentFiles/utils/ExtensionUtils"],(function(e){"use strict";return{getThumbnail:function(t){return e.getThumbnail(t)},getIcon:function(t){return e.getIcon(t)}}})),define("DS/DocumentCreateNew/PLMNewFilesTab/actions/RemoveFile",["UWA/Core","i18n!DS/DocumentCreateNew/assets/nls/DocumentCreateNew"],(function(e,t){"use strict";var n=function(i){return{id:"RemoveFile",dataElements:{docV2Private:!0,typeRepresentation:"functionIcon",icon:{iconName:"remove",fontIconFamily:1},label:t.get("Remove"),tooltip:t.get("Remove"),position:"far",category:"fileAction",value:function(e){e.options=i,n.execute(e)},visibleFlag:!1,priority:10},updateForSelection:function(t,n){return new e.Promise((function(e){t({visibleFlag:i.getSelectedNodes().length>0}),e(!0)}))},execute:function(){n.execute({options:i})}}};return n.execute=function(e){e.options.getSelectedNodes().forEach((t=>{e.options.ctrl.controller.files.treeDocument.removeRoot(t)}))},n})),define("DS/DocumentCreateNew/Utils/TypesUtils",["UWA/Class","UWA/Promise","DS/WAFData/WAFData","i18n!DS/DocumentCreateNew/assets/nls/DocumentCreateNew"],(function(e,t,n,i){"use strict";return e.singleton({init:function(){},Dictionarys:{},getTypeInfos:function(e){var o=this;return o.Dictionarys[e.tenantUrl]||(o.Dictionarys[e.tenantUrl]={ready:t.deferred()},n.authenticatedRequest(e.tenantUrl+"/resources/dictionary/Dictionary?lang="+widget.lang,{method:"GET",headers:{Accept:"application/json","content-type":"application/json","Accept-Language":widget.lang,SecurityContext:encodeURIComponent(e.securityContext)},timeout:18e4,type:"json",onComplete:function(t){try{o.Dictionarys[e.tenantUrl]._typeInfos=o.formatResult(t.Dictionary.Types,t.Dictionary.Interfaces,t.DictionaryNLS),o.Dictionarys[e.tenantUrl].ready.resolve(o.Dictionarys[e.tenantUrl]._typeInfos),console.info("Dictionary loaded")}catch(t){console.error("Unexpected error when fetching types infos"),console.error(t),o.Dictionarys[e.tenantUrl].ready.reject({subtitle:i.get("TYPE_INFORMATION_IS_INVALID"),message:i.get("PLEASE_TRY_AGAIN_OR_CONTACT_SYSTEM_ADMINSTRATOR")}),delete o.Dictionarys[e.tenantUrl]}},onFailure:function(t){console.error("Unable to get types infos : "),console.error(t),o.Dictionarys[e.tenantUrl].ready.reject({subtitle:i.get("FAILED_TO_FETCH_TYPE_INFORMATION"),message:(t.message||t)+" \n"+i.get("PLEASE_TRY_AGAIN_OR_CONTACT_SYSTEM_ADMINSTRATOR"),error:t}),delete o.Dictionarys[e.tenantUrl]}})),o.Dictionarys[e.tenantUrl].ready},formatResult:function(e,t,n){console.time("formatResult");var i=this,o={},a=[];for(var s in e){var r=e[s];if("Document"==r.FirstOOTB&&"Yes"==r.Specialization&&null==r.Deprecated){o[s]||(o[s]={nls:n["Type."+s]||r.Name,icon:r.IconName,parent:r.Parent,childs:[],abstract:r.Abstract,attributes:[],interfaces:{}},a.includes(s)||a.push(s));let t=r.Parent;t&&t.trim().length>0&&(o[t]?o[t].childs.push(s):(o[t]={nls:n["Type."+t]||e[t].Name,icon:e[t].IconName,parent:e[t].Parent,childs:[s],abstract:e[t].Abstract,attributes:[],interfaces:{}},a.includes(t)||a.push(t)));var l=r.Attributes?r.Attributes:{};o[s].attributes=i.extractAttributeDef(l,n,null)}}for(var c in null==o.Document&&(o.Document={nls:n["Type.Document"]||e.Document.Name,icon:e.Document.IconName,parent:e.Document.Parent,childs:[],abstract:e.Document.Abstract,attributes:[],interfaces:{}},a.includes("Document")||a.push("Document")),o.Document.attributes=[],t){var d=n["Interface."+c];"Yes"==t[c].Automatic&&t[c].ScopeTypes&&a.forEach((e=>{t[c].ScopeTypes.includes(e)&&(console.log(e,c),o[e].interfaces[d]=i.extractAttributeDef(t[c].Attributes,n,c))}))}return console.timeEnd("formatResult"),o},extractAttributeDef:function(e,t,n){var i=[];for(var o in e){var a=e[o],s={Name:o,nls_Name:null==n?t["Attribute."+o]:t["Attribute."+n+"."+o]||t["Attribute."+o],Type:a.Type,MaxLength:a.MaxLength,MultiValuated:a.MultiValuated,MultiLine:a.MultiLine,Default:a.Default};a.Dimension&&(s.Dimension=a.Dimension),"Yes"==a.HasRangeDefined&&(s.AuthorizedValues=a.AuthorizedValues.map((e=>({label:t["Range."+o+"."+e]?t["Range."+o+"."+e]:e,value:e})))),i.push(s)}return i}})})),define("DS/DocumentCreateNew/PLMNewFilesTab/data/Data",["UWA/Class"],(function(e){"use strict";return e.extend({init:function(e){this.ctrl=e}})})),define("DS/DocumentCreateNew/PLMNewFilesTab/views/TilePane",["UWA/Core","DS/CollectionView/ResponsiveTilesCollectionView","DS/CollectionView/modelProviders/CollectionViewTreeDocumentModelProvider"],(function(e,t,n){"use strict";return e.Controls.Abstract.extend({name:"enox-plmNewFilesTab-tilepane",options:{className:""},_options:{},init:function(e){this.ctrl=e,this.events=e.events,this.ctrl.tilePane=this,this._parent({})},build:function(i){var o=this;o.elements.container=e.createElement("div",{class:this.getClassNames(),styles:{display:"none"}});let a=n.inherit({name:"FileTileViewTreeDocumentModelProvider",getPropertyValue:function(e,t){return"subLabel"===t?e.options.subLabel.cloneNode(!0):this._parent(e,t)}});o.rcv=this.ctrl.tilesRCV=new t({model:o.ctrl.controller.files.treeDocument,useDragAndDrop:!1,shouldCellAllowUnsafeHTMLContentAt:function(e,t){return["subtitle","description"].includes(t)},displayedOptionalCellProperties:["contextualMenu","description","activeFlag"],onDropBlank:function(e,t){e.preventDefault(),e.stopPropagation(),o.ctrl.dndManager.handleDrop(e),this.onDropBlankDefault(e,t)},displayPropertiesTooltip:!1}).inject(o.elements.container),o.rcv.modelProvider=new a,o.rcv.getContextualMenu=function(e,t,n){return[""]},o.rcv.onContextualEvent={callback:function(e){return e&&e.cellInfos?(o.ctrl.contextMenu.selectionChanged(),o.ctrl.contextMenu.promise):(e.cellCtxMenuRequired,[])}},o.rcv.onSelectionAdd((function(e,t){o.ctrl.events.publish({event:"enox-plmNewFilesTab-node-selection-add",data:e}),o.ctrl.events.publish({event:"enox-plmNewFilesTab-node-selection-changed",data:e})})),o.rcv.onSelectionRemove((function(e,t){o.ctrl.events.publish({event:"enox-plmNewFilesTab-node-selection-remove",data:e}),o.ctrl.events.publish({event:"enox-plmNewFilesTab-node-selection-changed",data:e})})),o.inject(i)}})})),define("DS/DocumentCreateNew/Utils/DimensionUtils",["UWA/Class","UWA/Promise","DS/WAFData/WAFData","i18n!DS/DocumentCreateNew/assets/nls/DocumentCreateNew"],(function(e,t,n,i){"use strict";return e.singleton({init:function(){},Dimensions:{},getDimensions:function(e){var o=this;return o.Dimensions[e.tenantUrl]||(o.Dimensions[e.tenantUrl]={ready:t.deferred()},n.authenticatedRequest(e.tenantUrl+"/resources/dictionary/dimensions",{method:"GET",headers:{Accept:"application/json","content-type":"application/json","Accept-Language":widget.lang?widget.lang:widget.getValue("lang"),SecurityContext:encodeURIComponent(e.securityContext)},timeout:18e4,type:"json",onComplete:function(t){try{var n={};t.results.forEach((function(e){e.Units.forEach((function(t){e.MKSUnit==t.Name&&(n[e.Name]=t.NLSName)}))})),o.Dimensions[e.tenantUrl]._dimensions=n,o.Dimensions[e.tenantUrl].ready.resolve(o.Dimensions[e.tenantUrl]._dimensions),console.info("Dimensions loaded")}catch(t){console.error("Unexpected error when fetching dimensions"),console.error(t),o.Dimensions[e.tenantUrl].ready.reject({subtitle:i.get("DIMENSIONAL_ATTRIBUTES_ARE_INVALID"),message:i.get("PLEASE_TRY_AGAIN_OR_CONTACT_SYSTEM_ADMINSTRATOR")}),delete o.Dimensions[e.tenantUrl]}},onFailure:function(t){console.error("Unable to get dimensions : "),console.error(t),o.Dimensions[e.tenantUrl].ready.reject({subtitle:i.get("FAILED_TO_FETCH_DIMENSIONAL_ATTRIBUTES"),message:(t.message||t)+" \n"+i.get("PLEASE_TRY_AGAIN_OR_CONTACT_SYSTEM_ADMINSTRATOR"),error:t}),delete o.Dimensions[e.tenantUrl]}})),o.Dimensions[e.tenantUrl].ready}})})),define("DS/DocumentCreateNew/Utils/Credentials",["UWA/Core","UWA/Class","UWA/Promise","DS/WAFData/WAFData","i18n!DS/DocumentCreateNew/assets/nls/DocumentCreateNew"],(function(e,t,n,i,o){"use strict";return t.singleton({init:function(){},credentials:{},getCredentialsList:function(e){var t=this;if(t.credentials[e.tenantUrl+e.tenant])return t.credentials[e.tenantUrl+e.tenant].ready;t.credentials[e.tenantUrl+e.tenant]={ready:n.deferred()};var a=[],s=e.tenantUrl+"/resources/modeler/pno/person?current=true";return s+="&select=preferredcredentials&select=collabspaces",s+="&tenant="+e.tenant,i.authenticatedRequest(s,{method:"GET",type:"json",headers:{"Accept-Language":widget.lang},onComplete:function(n){a=[],[];var i=!1;if(n.collabspaces&&n.collabspaces.length>0)for(var o=void 0,s=0;s<n.collabspaces.length;s++)for(var r=0;r<n.collabspaces[s].couples.length;r++){var l=n.collabspaces[s].couples[r];null==o&&(o=l.organization.name),o!=l.organization.name&&(i=!0);var c=l.role.name+"."+l.organization.name+"."+n.collabspaces[s].name;n.collabspaces[s].title||(n.collabspaces[s].title=n.collabspaces[s].name),l.organization.title||(l.organization.title=l.organization.name),l.role.nls||(l.role.nls=l.role.name);var d=n.collabspaces[s].title+" ● "+l.organization.title+" ● "+l.role.nls,u=n.collabspaces[s].title+" ● "+l.role.nls;a.push({value:c,withorg_nls:d,withoutorg_nls:u,collabspaceTitle:n.collabspaces[s].title})}t.credentials[e.tenantUrl+e.tenant].ready.resolve(a.sort((function(e,t){return i?e.withorg_nls<t.withorg_nls?-1:e.withorg_nls>t.withorg_nls?1:0:e.withoutorg_nls<t.withoutorg_nls?-1:e.withoutorg_nls>t.withoutorg_nls?1:0})).map((function(e){return{label:i?e.withorg_nls:e.withoutorg_nls,value:e.value}}))),console.info("Credentials loaded")},onFailure:function(n){console.error("Failed to get credentials:",n),t.credentials[e.tenantUrl+e.tenant].ready.reject({subtitle:o.get("FAILED_TO_FETCH_CREDENTIALS"),message:err.message||err,error:err})}}),t.credentials[e.tenantUrl+e.tenant].ready},addCredentialList:function(e,t){this.credentials[e.tenantUrl+e.tenant]={ready:n.deferred()},this.credentials[e.tenantUrl+e.tenant].ready.resolve(t)}})})),define("DS/DocumentCreateNew/PLMNewFilesTab/EventHandler",["UWA/Core","UWA/Class"],(function(e,t){"use strict";return t.extend({init:function(e){this.ctrl=e},connect:function(e,t,n,i){var o=this;this.ctrl.events.addEventListener("user-dropped-files",(function(e){for(var n=e.files.length>0?e.files:[],i=[],o=0;o<n.length;o++)i.push(n[o]);t.files.addFiles(i,"PLMNewFilesTab")})),this.ctrl.events.addEventListener("user-selects-files-for-upload",(function(e){t.files.addFiles(e.files,"PLMNewFilesTab"),"Enabled"==o.ctrl.options.mandatoryCommentConfigSetting&&o.ctrl.options.tabAccess.updateCreateButtonDisability(!0)})),this.ctrl.events.addEventListener("user-wants-filePicker-for-upload",(function(t){require(["DS/DocumentCommands/V2/FileActions/UploadFile"],(function(t){(new t).filesProvider(e,(e=>{for(var t=e.target.files.length>0?e.target.files:e.dataTransfer.files,n=[],i=0;i<t.length;i++)n.push(t[i]);o.ctrl.events.publish({event:"user-selects-files-for-upload",data:{cancelled:!1,files:n}})}))}))})),this.ctrl.events.addEventListener("docv2-show-notification",(function(e){t.helper.showNotification(e.level,e.title,e.subtitle,e.message,e.sticky,e.allowUnsafeHTML)})),this.ctrl.events.addEventListener("enox-plmNewFilesTab-collection-count-changed",(function(e){if(t.switchView(t.view),"Enabled"==o.ctrl.options.mandatoryCommentConfigSetting){var n=o.ctrl.controller.files.validateComments();o.ctrl.options.tabAccess.updateCreateButtonDisability(!n)}})),this.ctrl.events.addEventListener("enox-plmNewFilesTab-node-selection-changed",(function(e){n.selectionChanged()})),this.ctrl.events.addEventListener("enox-plmNewFilesTab-switch-view",(function(e){t.switchView(e)}))}})})),define("DS/DocumentCreateNew/PLMNewFilesTab/utils/DnDManager",["DS/DataDragAndDrop/DataDragAndDrop"],(function(e){"use strict";return function(t){var n={init:function(t){this.ctrl=t;var i=t.uploadPane.elements.container,o=t.gridPane.elements.container,a=t.getClassNames("-drag-over"),s={drop:function(e,i,o){t.options.readonly||(t.elements.content.removeClassName(a),n.handleDrop(o))},enter:function(e,n){t.options.readonly||t.elements.content.addClassName(a)},over:function(e,n){t.options.readonly||t.elements.content.addClassName(a)},leave:function(e,n){t.options.readonly||t.elements.content.removeClassName(a)}};e.droppable(i,s),e.droppable(o,s),t.dndManager=this},handleDrop:function(e){t.options.readonly||e.dataTransfer.files&&e.dataTransfer.files.length>0&&t.events.publish({event:"user-dropped-files",data:{cancelled:!1,files:e.dataTransfer.files}})}};return n.init(t),n}})),define("DS/DocumentCreateNew/PLMNewDocumentCmd",["UWA/Core","DS/ENONewWidget/command/NewContentCommandBase","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","i18n!DS/DocumentCreateNew/assets/nls/DocumentCreateNew","DS/DocumentCommands/Helper","DS/ENONewWidget/ENONew/Events"],(function(e,t,n,i,o,a){"use strict";return t.extend({defaults:{type:"Document"},init:function(e){this._parent(e)},getType(){return this.defaults.type},execute:function(){o.startLoading(),a.addEvent("onCreationDialogAction",(function(e){e&&"ready"===e.action&&o.finishLoading()})),this.launchCreationDialog()},launchCreationDialog:function(){var e=this.getCreateOptions({});e.notification=!0,this.launchCreateNew(e)},getHeaders:function(t){let i={},o=n.get();var a=e.is(o)&&e.is(o.change.id)?o.change.id:null;return i=""!=a?{SecurityContext:t,"DS-Change-Authoring-Context":"pid:"+a}:{SecurityContext:t},i},getOptions:function(e){var t=this;return console.log(e),{options:{typeName:"Document",preferedType:t.options.preferedType},context:{serviceBaseUrl:t.options.serviceBaseUrl,tenant:t.options.tenant,header:t.getHeaders(t.options.securityContext),getENONewContext:function(){return{}}},events:t.options.callbacks,viewType:"tabView",labelTopBar:i.get("NewDocument"),facets:[{name:"filesFacet",facetoptions:{}},{name:"classificationFacet",facetoptions:{isBookmark:!0,isLibrary:!0,isExportControl:!0}}],notification:!1}}})})),define("DS/DocumentCreateNew/PLMNewFilesTab/views/InformationPane",["UWA/Core","DS/Utilities/Dom"],(function(e,t){"use strict";return e.Controls.Abstract.extend({name:"enox-plmNewFilesTab-information-pane",options:{className:""},_options:{},init:function(e){this.ctrl=e,e.informationPane=this,this.iconMap={warning:"attention",info:"info"},this.values={emphasis:void 0,title:void 0,subTitle:void 0},this._parent({})},build:function(n){this.elements.container=e.createElement("div",{class:this.getClassNames(),styles:{display:"none"}}),this.elements.informationContainer={},this.elements.informationContainer.container=e.createElement("div",{class:this.getClassNames("-container")}),this.elements.informationContainer.container.inject(this.elements.container),this.elements.informationContainer.band=e.createElement("div",{class:this.getClassNames("-band"),emphasis:"info"}),this.elements.informationContainer.band.inject(this.elements.informationContainer.container),this.elements.informationContainer.iconSpan=t.generateIcon({iconName:"info"}),this.elements.informationContainer.iconSpan.addClassName(this.getClassNames("-iconSpan")),this.elements.informationContainer.iconSpan.setAttribute("emphasis","info"),this.elements.informationContainer.iconSpan.inject(this.elements.informationContainer.band),this.elements.informationContainer.messageContainer=e.createElement("div",{class:this.getClassNames("-message-container")}),this.elements.informationContainer.messageContainer.inject(this.elements.informationContainer.container),this.elements.informationContainer.title=e.createElement("div",{class:this.getClassNames("-title")}),this.elements.informationContainer.title.inject(this.elements.informationContainer.messageContainer),this.elements.informationContainer.subTitle=e.createElement("div",{class:this.getClassNames("-subTitle")}),this.elements.informationContainer.subTitle.inject(this.elements.informationContainer.messageContainer),this.inject(n)},updateInformationContent:function(e){this.values.title=e.title?e.title:this.values.title,this.values.subTitle=e.subTitle?e.subTitle:this.values.subTitle,e.emphasis&&("info"!=e.emphasis&&"warning"!=e.emphasis&&"error"!=e.emphasis&&"success"!=e.emphasis||(this.values.emphasis=e.emphasis)),this.refreshDom()},refreshDom:function(){var e=this;e.values.title&&this.elements.informationContainer.title.setText(e.values.title),e.values.subTitle&&this.elements.informationContainer.subTitle.setText(e.values.subTitle);var n=e.iconMap[e.values.emphasis],i=t.generateIcon({iconName:n});i.setAttribute("emphasis",e.values.emphasis),i.addClassName(this.getClassNames("-iconSpan")),this.elements.informationContainer.iconSpan.replaceWith(i),this.elements.informationContainer.band.setAttribute("emphasis",e.values.emphasis)}})})),define("DS/DocumentCreateNew/PLMNewFilesTab/data/Columns",["UWA/Core","UWA/Class","i18n!DS/DocumentCreateNew/assets/nls/DocumentCreateNew"],(function(e,t,n){"use strict";return t.extend({ready:void 0,predefinedColumns:[{name:"title",includeAlways:!0,typeRepresentation:"string",dataIndex:"tree",pinned:"left"},{name:"comments",typeRepresentation:"string",includeAlways:!0,readonly:"false",editableFlag:!0}],customizedColumns:{mandatoryComment:{name:"comments",dataIndex:"comments",includeAlways:!0,readonly:"false",editableFlag:!0,text:n.get("e6wFileField.comments"),customHeader:{buildContent:function(t){const i=e.createElement("div",{styles:{display:"flex","align-items":"center"}}),o=e.createElement("span",{styles:{"margin-left":"7px"}});o.textContent=n.get("e6wFileField.comments");const a=e.createElement("div",{styles:{color:"red"}}),s=e.createElement("i");return s.textContent="*",a.appendChild(s),i.appendChild(o),i.appendChild(a),i}}}},predefinedColumnsDictionary:{},init:function(t){var i=this;i.ready=e.Promise.deferred(),i.predefinedColumns.forEach((e=>{e.text=n.get("e6wFileField."+e.name),e.typeRepresentation&&(null==e.dataIndex&&(e.dataIndex=e.name),i.predefinedColumnsDictionary[e.name]=e)})),"Enabled"==t.options.mandatoryCommentConfigSetting&&(i.predefinedColumnsDictionary.comments=i.customizedColumns.mandatoryComment)},getColumns:function(){var e=this;return Object.keys(e.predefinedColumnsDictionary).map((t=>e.predefinedColumnsDictionary[t]))}})})),define("DS/DocumentCreateNew/Utils/DocmDictionaryHandler",["UWA/Class","UWA/Promise","DS/WAFData/WAFData","i18n!DS/DocumentCreateNew/assets/nls/DocumentCreateNew"],(function(e,t,n,i){"use strict";return e.singleton({init:function(){},Dictionaries:{},PromiseStatus:{PENDING:"Pending",RESOLVED:"Resolved",REJECTED:"Rejected"},getTypeInfos:function(e,o={}){var a=this;o.preferredType||(o.preferredType="Document"),o.subtypes||(o.subtypes="false");var s={tenant:e.tenantUrl,type:o.preferredType},r=a.getResponsePromise(s);if(r&&r.ready&&r.status!=a.PromiseStatus.REJECTED)return r.ready;var l=a.addResponsePromise(s,t.deferred());return n.authenticatedRequest(e.tenantUrl+"/resources/v1/modeler/documents/typeInfo/?xrequestedwith=xmlhttprequest",{method:"POST",headers:{Accept:"application/json","content-type":"application/json","Accept-Language":widget.lang,SecurityContext:encodeURIComponent(e.securityContext)},timeout:18e4,type:"json",data:JSON.stringify(o),onComplete:function(e){e.subTypes&&(a.subTypes=e.subTypes),e={subTypes:a.subTypes,...e},l.ready.resolve(e),l.status=a.PromiseStatus.RESOLVED,console.info("Dictionary loaded")},onFailure:function(e){console.error("Unable to get types infos : "),console.error(e),l.ready.reject({title:i.get("FAILED_TO_FETCH_TYPE_INFORMATION")}),l.status=a.PromiseStatus.REJECTED}}),l.ready},addResponsePromise:function(e,t){var n=this;return n.Dictionaries[e.tenant]||(n.Dictionaries[e.tenant]={}),n.Dictionaries[e.tenant][e.type]||(n.Dictionaries[e.tenant][e.type]={}),n.Dictionaries[e.tenant][e.type]={ready:t,status:n.PromiseStatus.PENDING},n.Dictionaries[e.tenant][e.type]},getResponsePromise:function(e){var t=this;return t.Dictionaries[e.tenant]&&t.Dictionaries[e.tenant][e.type]&&t.Dictionaries[e.tenant][e.type]&&t.Dictionaries[e.tenant][e.type]||null}})})),define("DS/DocumentCreateNew/PLMNewFilesTab/views/UploadPane",["UWA/Core","UWA/Controls/Abstract","DS/Utilities/Dom","DS/Controls/Button","i18n!DS/DocumentCreateNew/assets/nls/DocumentCreateNew"],(function(e,t,n,i,o){"use strict";return t.extend({name:"enox-plmNewFilesTab-upload-pane",options:{className:""},_options:{},init:function(e){this.ctrl=e,this.events=e.events,this.ctrl.uploadPane=this,this._parent({})},build:function(t){var a=this;this.elements.container=e.createElement("div",{class:a.ctrl.getClassNames("-uploadpane")});var s=e.createElement("div",{class:a.ctrl.getClassNames("-uploadpane-center")});(s.inject(this.elements.container),a.ctrl.options.readonly)?e.createElement("span",{class:a.ctrl.getClassNames("-uploadpane-center-msg"),text:o.get("NO_FILES_ATTACHED")}).inject(s):(n.generateIcon({iconName:"drag-drop",fontIconSize:"2x"}).inject(s),e.createElement("span",{class:a.ctrl.getClassNames("-uploadpane-center-msg"),text:o.get("DROP_A_FILE_OR")}).inject(s),a.uploadButton=new i({label:o.get("UPLOAD_FILE"),emphasize:"primary"}),a.uploadButton.addEventListener("buttonclick",(function(){a.ctrl.events.publish({event:"user-wants-filePicker-for-upload",data:void 0})})),a.uploadButton.inject(s));a.inject(t)},show:function(){this.elements.container.show()},hide:function(){this.elements.container.hide()}})})),define("DS/DocumentCreateNew/PLMNewFilesTab/utils/Helper",["UWA/Core","DS/Notifications/NotificationsManagerViewOnScreen","DS/Notifications/NotificationsManagerUXMessages","i18n!DS/DocumentCreateNew/assets/nls/DocumentCreateNew"],(function(e,t,n,i){"use strict";return function(o){var a={showNotification:function(e,i,a,s,r,l){var c={level:e,title:i,subtitle:a,message:s,sticky:r,allowUnsafeHTML:l||!1};o.notifs||(o.notifs=n,t.setNotificationManager(o.notifs),t.setStackingPolicy(5)),o.notifs.addNotif(c)},debounce:function(e,t,n){var i=null,o=[];return function(){if(n){for(var a=[],s=0;s<arguments.length;++s)a.push(arguments[s]);o.push(a)}i&&clearTimeout(i);var r=arguments;i=setTimeout((function(){t.apply(n?{data:o}:null,r),o=[],i=null}),e)}},getUniqueToken:function(){return(new Date).getTime()+Math.random().toString(36).substring(2,10)},ensureUploadCompletion:function(e,t,n){return t&&0!=t.length?0==(t=t.filter((e=>e.name!=n.dataelements.title))).length&&e.resolve():e.resolve(),t},ensureUniqueFiles:function(e,t){return e.filter((e=>{const n=t.some((t=>t.options.grid.title==e.name));return n&&o.alert.add({className:"error",message:i.get("File_Exist_Error",{fileName:e.name})}),!n}))},saveViewMode:function(t){var n=localStorage.getItem("ENOXPLMNewFilesUXViewMode");(n=e.Json.isJson(n)?JSON.parse(n):{})["PLMNewFilesTab_"+(e.is(widget.data.appId)?widget.data.appId:widget.environment.data._data._x_appId)]=t,localStorage.setItem("ENOXPLMNewFilesUXViewMode",JSON.stringify(n))},loadViewMode:function(){var t=localStorage.getItem("ENOXPLMNewFilesUXViewMode");if(e.Json.isJson(t)){var n=(t=JSON.parse(t))["PLMNewFilesTab_"+(e.is(widget.data.appId)?widget.data.appId:widget.environment.data._data._x_appId)];return"tile"==n||"grid"==n?n:"tile"}return"tile"}};return a.ctrl=o,o.helper=a,a}})),define("DS/DocumentCreateNew/PLMNewFilesTab/actions/ViewSwitcher",["DS/Tweakers/TypeEnums","i18n!DS/DocumentCreateNew/assets/nls/DocumentCreateNew"],(function(e,t){"use strict";var n=function(n){var i=n.ctrl.controller.view,o=e.Layout.SmallTile;return"grid"==i?o=e.Layout.DataGridView:"tile"==i&&(o=e.Layout.SmallTile),{id:"ViewSwitcher",dataElements:{docV2Private:!0,typeRepresentation:"layout",tooltip:t.get("SwitchView"),value:o,possibleValues:[e.Layout.DataGridView,e.Layout.SmallTile],position:"far",category:"stable area",visibleFlag:!0,priority:10},updateForSelection:function(e,t){return!0},onNodeUpdate:function(t){var i="",o=t.getAttributeValue("data"),a="object"==typeof o?o.value:o;a===e.Layout.DataGridView.value?i="grid":a===e.Layout.SmallTile.value&&(i="tile"),n.events.publish({event:"enox-plmNewFilesTab-switch-view",data:i})},extend:function(e,t){}}};return n.execute=function(e,t){},n})),define("DS/DocumentCreateNew/Views/CreateForm",["UWA/Core","DS/Controls/Editor","DS/Controls/LineEditor","DS/Controls/ComboBox","DS/Controls/FilePicker","DS/Controls/Accordeon","DS/DataGridView/DataGridView","DS/Tweakers/TweakerArray","DS/Tweakers/TweakerNumber","DS/Tweakers/TweakerDate","DS/Tweakers/TweakerBoolean","DS/Tweakers/TweakerString","DS/Controls/TooltipModel","DS/Controls/SelectionChipsEditor","DS/Controls/Popup","DS/Windows/ImmersiveFrame","i18n!DS/DocumentCreateNew/assets/nls/DocumentCreateNew","css!DS/DocumentCreateNew/DocumentCreateNew"],(function(e,t,n,i,o,a,s,r,l,c,d,u,m,p,g,f,h,b){"use strict";var v=e.Controls.Abstract.extend({init:function(e){this._parent(e),this.buildSkeleton()},buildSkeleton:function(){var e=this,t=this.options.fields;v.doctypesList=this.options.doctypes,v.dimensions=this.options.dimensions,v.typeInfo=this.options.typeInfo,v.commentAsMandatoryValue=this.options.commentAsMandatoryValue,v.elements={},v.events=this.options.events,t.forEach((function(t){"header"==t.type?e.buildHeader(t):"accordeon"==t.type?e.buildAccordeon(t):"grid"==t.type?e.buildGrid(t):e.createInputField(t,e.options.container)}))},createInputField:function(a,s){var g=e.createElement("div",{class:"form-group",id:a.settings.domId,styles:{display:a.display}}).inject(s),f=e.createElement("label",{text:a.label,attributes:{for:a.settings.domId},styles:{display:a.display}}).inject(g);a.settings.requiredFlag&&e.createElement("span",{class:"label-field-required"}).inject(f).setHTML(' <i class="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-required "></i>');var h=null;if("block"==a.display){switch(a.type){case"text":(h=new n(a.settings).inject(g)).setOptions({requiredFlag:!!a.settings.requiredFlag,label:a.label,multiValued:!1});break;case"combobox":(h=new i({...a.settings,generateRegexpString:function(e){return e}}).inject(g)).setOptions({requiredFlag:!!a.settings.requiredFlag,label:a.label,multiValued:!1,fieldFor:a.settings.fieldFor});break;case"textarea":var b={...a.settings};delete b.requiredFlag,(h=new t(b).inject(g)).setOptions({requiredFlag:!!a.settings.requiredFlag,label:a.label,multiValued:!1});break;case"file":(h=new o(a.settings).inject(g)).setOptions({requiredFlag:!!a.settings.requiredFlag,label:a.label,multiValued:!1});break;case"multi":a.settings&&"string"==a.settings.valueType?(h=new p({value:[],placeholder:"Type a unique value",uniqueValue:!0,maxLength:a.settings.maxLength}).inject(g)).setOptions({requiredFlag:!!a.settings.requiredFlag,label:a.label,multiValued:!0}):a.settings&&"date"==a.settings.valueType?(a.settings.allowMultipleValuesFlag=!0,(h=new c(a.settings).inject(g)).setOptions({requiredFlag:!!a.settings.requiredFlag,label:a.label,multiValued:!0}),h.getContent().setAttribute("id",a.settings.domId)):((h=new r(a.settings).inject(g)).setOptions({requiredFlag:!!a.settings.requiredFlag,label:a.label,multiValued:!0}),h.getContent().setAttribute("id",a.settings.domId));break;case"multirange":a.settings&&(h=new u({value:[],allowMultipleValuesFlag:!0,possibleValues:a.settings.possibleValues}).inject(g)).setOptions({requiredFlag:!!a.settings.requiredFlag,label:a.label,multiValued:!0});break;case"number":(h=new l(a.settings).inject(g)).setOptions({requiredFlag:!!a.settings.requiredFlag,label:a.label,multiValued:!1});break;case"date":(h=new c(a.settings).inject(g)).setOptions({requiredFlag:!!a.settings.requiredFlag,label:a.label,multiValued:!1,type:"Date"});break;case"boolean":(h=new d(a.settings).inject(g)).setOptions({requiredFlag:!!a.settings.requiredFlag,label:a.label,multiValued:!1})}if(null!=h){var w=h.elements.container.dsModel.value;if(e.is(h.elements.container.dsModel.selectedIndex,"number")&&(w=h.elements.container.dsModel.currentLabel),h.tooltipInfos=new m({shortHelp:w}),v.elements[a.settings.domId]=h.elements.container.dsModel,a.additionalAttributes)for(var D in a.additionalAttributes)"combobox"==a.type||"text"==a.type||"multirange"==a.type?h.getContent().setAttribute(D,a.additionalAttributes[D]):h.getContent().children&&h.getContent().children[0]&&h.getContent().children[0].setAttribute(D,a.additionalAttributes[D]);if(a.events){for(var D in a.events)h.addEventListener(D,a.events[D]);"file"==a.type&&(h.value=a.settings.blob)}}}},buildHeader:function(t){e.createElement("p",t).inject(this.options.container)},buildAccordeon:function(t){var n=this,i={style:t.styles,exclusive:t.exclusive,domId:t.domId},o=[];t.items.forEach((function(e){o.push(n.buildItem(e.id,e.header,e.content))})),i.items=o;var s=e.createElement("div",{class:"attribute-accordeon",styles:{display:t.display}}).inject(this.options.container),r=new a(i).inject(s);r.addEventListener("expand",(function(e){e.dsModel.updateItem(0,{header:h.get("Show_less")})})),r.addEventListener("collapse",(function(e){e.dsModel.updateItem(0,{header:h.get("Show_more")})})),v.elements[t.domId]=r,this.appendDynamicAttributes(v.elements.ENOX_Document_Type.value,r)},buildGrid:function(t){let n=t.treeDocument.getRoots().length;n>9&&(n=9);var i=e.createElement("div",{class:"multifile-grid",styles:{display:t.display,height:24*n+"px"}}).inject(this.options.container);"Enabled"==v.commentAsMandatoryValue&&(t.columns[1]={...t.columns[1],customHeader:{buildContent:function(t){const n=e.createElement("div");n.className="docm-dgView-columnContainer";const i=e.createElement("span");i.className="docm-dgView-columnContainer-text",i.textContent=h.get("e6wFileField.comments");const o=e.createElement("div");o.className="icon-container docm-mandatory";const a=e.createElement("i");return a.className="icon",a.textContent="*",o.appendChild(a),n.appendChild(i),n.appendChild(o),n}},updateContent(e){}});var o=new s(t);o.onContextualEvent=function(e){var t=[];if(e&&e.collectionView&&-1===e.cellInfos.rowID){t=e.collectionView.buildDefaultContextualMenu(e,{pin:!1,firstColumnsVisibility:!1,columnsManagement:!1,sizeColumnToFit:!0,insertRow:!1})}return t};var a=new f;a.setContentInBackgroundLayer(o.getContent()),a.reactToPointerEventsFlag=!1,a.inject(i)},buildItem:function(t,n,i){var o=this,a=e.createElement("div",{class:"item-sections",id:t}),s={header:n};return i.forEach((function(e){o.createInputField(e,a)})),s.content=a,s},getFielfDef:function(t){var n={settings:{},additionalAttributes:{},events:{}};return n.label=t.attributeNls,""!=t.unit&&(n.label+=" (in "+t.unit+")"),n.display="block",n.settings.domId=t.attribute.replace(" ","_"),t.value&&(n.settings.value=t.value),n.additionalAttributes.Style="width:100%;",n.events=v.events,"true"==t.mandatory&&(n.settings.requiredFlag=!0),"true"==t.readOnly&&(n.settings.disabled=!0,n.settings.readOnly=!0),t.pattern&&(n.settings.pattern=t.pattern),t.range&&"true"!=t.multivaluated&&"boolean"==t.dataType&&delete t.range,t.range&&"true"!=t.multivaluated?(n.type="combobox",t.rangeNLS||(t.rangeNLS=[]),n.settings.elementsList=t.range.map(((e,n)=>({label:t.rangeNLS[n]||e,value:e}))),n.settings.enableSearchFlag=!0,n.settings.popupSizeAdjustPolicy=g.SizeAdjustPolicyEnum.AdjustToVisibleContents):t.range&&"true"==t.multivaluated?(n.type="multirange",n.settings.valueType=t.dataType.toLowerCase(),t.rangeNLS||(t.rangeNLS=[]),n.settings.possibleValues=t.range.map(((e,n)=>({label:t.rangeNLS[n]||e,value:e})))):"true"==t.multivaluated?(n.type="multi",n.settings.itemEditionTrigger="in place","timestamp"==t.dataType?n.settings.valueType="date":"real"==t.dataType?n.settings.valueType="number":n.settings.valueType=t.dataType.toLowerCase(),isNaN(parseInt(t.maxlength))||(n.settings.maxLength=parseInt(t.maxlength))):"integer"==t.dataType.toLowerCase()||"double"==t.dataType.toLowerCase()||"real"==t.dataType.toLowerCase()?(n.type="number","Integer"==t.dataType&&(n.settings.stepValue=1),""!=t.unit&&(n.settings.units=t.unit)):"timestamp"==t.dataType?(n.type="date",e.is(t.value,"string")&&""!=t.value?n.settings.value=new Date(t.value):""==t.value&&(n.settings.value=void 0)):"boolean"==t.dataType?(n.type="boolean",null!=n.settings.value&&""!=n.settings.value||(n.settings.value=!1)):t.multiline&&"true"==t.multiline?(n.type="textarea",n.settings.nbRows=5,n.settings.maxLength=t.maxlength):(n.type="text",n.settings.selectAllOnFocus=!0,n.settings.displayClearFieldButtonFlag=!0,isNaN(parseInt(t.maxlength))||(n.settings.maxLength=parseInt(t.maxlength))),n}});return v.prototype.appendInheritedAttributes=function(t,n){var i=e.clone(v.typeInfo.attributes,!0);i.publicAttributes.forEach((e=>{n.attributes.push(e)})),i.interfaceAttributes.forEach((e=>{n.attributes.push(e)}))},v.prototype.appendDynamicAttributes=function(t,n){var i=this,o={attributes:[]};n.updateItem(0,{header:h.get("Show_more")}),i.appendInheritedAttributes(t,o);var a=n.items[n.items.length-1];if(v.customAttributes=[],o.attributes.length>0){var s=e.createElement("div",{class:"item-sections",id:"DCN_CustomAttributes"}).inject(a.content);v.elements.DCN_CustomAttributes=s,o.attributes.forEach((function(e){var t=i.getFielfDef(e);t.settings&&v.customAttributes.push(t.settings.domId),i.createInputField(t,s)}))}n.clear(),n.addItem(a)},v})),define("DS/DocumentCreateNew/PLMNewFilesTab/views/Topbar",["UWA/Core","DS/DocumentCreateNew/PLMNewFilesTab/views/Toolbar"],(function(e,t){"use strict";return e.Controls.Abstract.extend({name:"enox-plmNewFilesTab-topbar",options:{className:""},_options:{},init:function(e){this.ctrl=e,this.events=e.events,this._parent({})},build:function(n){var i=this;i.elements.container=e.createElement("div",{class:this.getClassNames()}),i.elements.toolbar=new t(i.ctrl),i.elements.toolbar.build(i.elements.container),i.elements.container.inject(n)},updateToolbar:function(){this.elements.toolbar.selectionChanged()}})})),define("DS/DocumentCreateNew/PLMNewFilesTab/Commands",["UWA/Core","UWA/Class","DS/DocumentCreateNew/PLMNewFilesTab/actions/RemoveFile","DS/DocumentCreateNew/PLMNewFilesTab/actions/UploadFile","DS/DocumentCreateNew/PLMNewFilesTab/actions/ViewSwitcher","DS/DocumentCommands/V2/ConvertCmdToWebUX"],(function(e,t,n,i,o,a){"use strict";return t.extend({init:function(e){this.commands={RemoveFile:new n(e),UploadFile:new i(e),ViewSwitcher:new o(e)}},commands:[],connectToWebUXToolbar:function(e){e.items.prepareUpdate(),e.items.getRoots().forEach((e=>{e.options.docV2Private&&e.options.extend&&e.options.extend(e)})),e.items.pushUpdate()},selectionChangedForWebUXToolbar:function(e){e.items.getRoots().forEach((e=>{e.options.docV2Private&&(e.options.grid.action=e,e.options.updateForSelection&&e.options.updateForSelection((function(t){e.updateOptions(t)})))}))},getWebUXContextMenuItemsForCurrentSelection:function(t,n){return new e.Promise((function(i,o){var s=[],r=t[0].dataElements.category,l=[!0];t.forEach((t=>{if(t.updateForSelection){var n=t.updateForSelection((function(n){t.dataElements=e.extend(t.dataElements,n,!0)}));l.push(n)}else l.push(!0)})),e.Promise.all(l).then((function(e){t.forEach((e=>{e.dataElements.visibleFlag&&(n&&r!=e.dataElements.category&&s.push({type:"SeparatorItem"}),s.push(a([e])[0]),r=e.dataElements.category)})),i(s)}))}))}})})),define("DS/DocumentCreateNew/CreateNew",["UWA/Core","DS/UIKIT/Mask","DS/DocumentManagement/DocumentManagement","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","i18n!DS/DocumentCreateNew/assets/nls/DocumentCreateNew","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/TooltipModel","DS/DocumentCreateNew/Views/CreateForm","DS/DocumentCreateNew/Utils/DocmDictionaryHandler","DS/DocumentCreateNew/Utils/TypesUtils","DS/DocumentCreateNew/Utils/DimensionUtils","DS/DocumentCreateNew/Utils/Credentials","DS/Controls/Loader","DS/Controls/ModalContainer","UWA/Promise","DS/DocumentCommonInfra/TrackerAPI","DS/DocumentFiles/data/Model","DS/DocumentCommonInfra/Utils/GetWidgetConfiguration","DS/UIKIT/Alert","DS/DocumentCommonInfra/Utils/GetCollabOrgConfiguration","DS/DocumentCreateNew/PLMNewFilesTab/utils/Helper","DS/Notifications/NotificationsManagerViewOnScreen","DS/Notifications/NotificationsManagerUXMessages","css!DS/DocumentCreateNew/DocumentCreateNew"],(function(e,t,n,i,o,a,s,r,l,c,d,u,m,p,g,f,h,b,v,w,D,C,y,N,S){"use strict";var T={},F=e.Controls.Abstract.extend({name:"doco-create-new2",options:{className:""},init:function(t){var n=this;this._parent(t),widget&&widget.app&&widget.app.jobs&&"doco-jobs"==widget.app.jobs.name&&widget.app.progressPane&&"doco-progress"==widget.app.progressPane.name?(T=widget.app).jobs.MAX_PARALLEL_JOBS=1:(null==T.jobs&&require(["DS/DocumentCommands/Jobs"],(function(e){null==T.jobs&&(T.jobs=new e(T),T.jobs.MAX_PARALLEL_JOBS=1)})),null==T.progressPane&&require(["DS/DocumentCommands/ProgressPane"],(function(e){null==T.progressPane&&(T.progressPane=new e(T),T.progressPane.inject(widget.body))}))),F.selectedFiles=[],null==t.credentialsPrefName&&(t.credentialsPrefName="credentials"),null==this.options.containerToOverlay&&(this.options.containerToOverlay=widget.body),t.securityContext&&t.securityContext.startsWith("ctx::")&&(this.options.securityContext=t.securityContext.replace("ctx::","")),F.selectedCollabSpace={organizations:[]};var i=widget.getPreference(t.credentialsPrefName);i?(F.credentials=i.options.map((function(e){return{label:e.label,value:e.value.startsWith("ctx::")?e.value.replace("ctx::",""):e.value}})),p.addCredentialList(t,F.credentials)):p.getCredentialsList(t).promise.then((function(e){F.credentials=e})),window.documentDictionaryLoadStart=new Date,this.elements.container=e.createElement("div",{class:this.getClassNames()}),this.alert=new D({closable:!0,visible:!0,maximumVisibleMessages:1,closeOnClick:!0,autoHide:!0,hideDelay:4e3}),n.loader=new g({text:a.get("LOADING"),showButtonFlag:!0}),n.loader.canceller=h.deferred(),n.loader.elements.stopButton.addEventListener("buttonclick",(function(e){n.loader.canceller.reject("usercancelled")}))},fetchTypeInfo:function(e){var t=this;return t.configurations=e||{preferredType:t.getPreferences("docm-upload-lastSelected-type").typeName,subtypes:"true"},d.getTypeInfos(t.options,t.configurations).promise.then((function(e){return console.log(e),F.docmDictionaryHandler=e,e}))},generateForm:function(){var e=this;this.startLoading();var t=F.selectedFiles.length>1,n=function(t){e.valueChanged(t,e)};e.fixedFormFields=[{type:"header",class:"header1",text:a.get("Head_Info_1").replace("{nbFiles}",F.selectedFiles.length),styles:{display:t?"block":"none"}},{type:"header",class:"header2",text:a.get("Head_Info_2"),styles:{display:t?"block":"none"}},{type:"text",label:a.get("Title"),display:t?"none":"block",settings:{domId:"Title",selectAllOnFocus:!0,displayClearFieldButtonFlag:!1,requiredFlag:!0,pattern:".*\\S+.*"},additionalAttributes:{Style:"width:100%;"},events:{change:n,uncommittedChange:n}},{type:"combobox",label:a.get("Document_Type"),display:"block",settings:{domId:"ENOX_Document_Type",elementsList:e.filteredTypes,selectedIndex:e.getPreferences("docm-upload-lastSelected-type").index,enableSearchFlag:!0,requiredFlag:!0},additionalAttributes:{Style:"width:100%;"},events:{change:function(t){e.docTypeChanged(t,e)}}},{type:"combobox",label:a.get("Collaborative_Space"),display:"block",settings:{domId:"collabSpace",elementsList:Object.values(F.credData),placeholder:a.get("Select_Collaborative_Space"),value:F?.defaultPreference?.collabSpace??"",disabled:1==Object.values(F.credData).length,enableSearchFlag:!0,requiredFlag:!0},additionalAttributes:{Style:"width:100%;"},events:{change:function(t){e.collabSpaceChanged(e),e.valueChanged(t,e)}}},{type:"combobox",label:a.get("Organization"),display:"block",settings:{domId:"organizations",elementsList:F.selectedCollabSpace.organizations,placeholder:a.get("Select_Organization"),value:F?.defaultPreference?.organization??"",disabled:!c?.elements?.collabSpace?.value,enableSearchFlag:!0,fieldFor:"Organization",requiredFlag:!0},additionalAttributes:{Style:"width:100%;"},events:{change:n}},{type:"file",label:a.get("File"),display:t?"none":"block",settings:{domId:"file",blob:F.selectedFiles[0],width:"100%",requiredFlag:!0},events:{change:e.fileChanged}},{type:"textarea",label:a.get("e6wFileField.filecomments"),display:t?"none":"block",settings:{domId:"FileComment",selectAllOnFocus:!0,displayClearFieldButtonFlag:!1,requiredFlag:"Enabled"==F.GetWidgetConfiguration,nbRows:5},additionalAttributes:{Style:"width:100%;"},events:{change:n,uncommittedChange:n}},{type:"accordeon",items:[{doctypeDefault:"Document",id:"ShowMore",header:a.get("Show_more"),content:[{type:"textarea",display:t?"none":"block",label:a.get("Description"),settings:{domId:"Description",newLineMode:"enter",nbRows:5},additionalAttributes:{Style:"width:100%;"},events:{change:n}},{type:"text",display:t?"none":"block",label:a.get("Collaborative_Policy"),settings:{domId:"Policy",value:a.get("Policy_Name"),disabled:!0},additionalAttributes:{Style:"width:100%;"}}]}],styles:"simple",exclusive:!1,domId:"accordeon",display:t?"none":"block"},{type:"grid",display:t?"block":"none",identifier:"selectedFilesListId",treeDocument:e.generategridTree(F.selectedFiles),columns:[{text:a.get("Title"),dataIndex:"name",typeRepresentation:"string",alignment:"near",width:"50%",minWidth:"30",height:"150",includeAlways:!0,editableFlag:!1},{text:a.get("e6wFileField.comments"),dataIndex:"comment",typeRepresentation:"string",alignment:"near",width:"50%",minWidth:"30",height:"150",includeAlways:!0,editableFlag:!0}],cellSelection:"none",rowSelection:"none",selectionBehavior:{selectNodeModelOnCellSelection:!1},showBackgroundFlag:!0,columnDragEnabledFlag:!1,showSelectionCheckBoxesFlag:!1,defaultColumnDef:{minWidth:30,width:"auto",sortableFlag:!0},layoutOptions:{columnsHeader:!0,useLastColumnWidthAutoFlag:!0,rowsHeader:!1}}],new c({commentAsMandatoryValue:F.GetWidgetConfiguration,typeInfo:F.docmDictionaryHandler,container:this.elements.container,events:{change:n},fields:e.fixedFormFields}),e.handleFormLoad(),e.finishLoading()},startLoading:function(){this.webUXloader=new g({text:a.get("LOADING")}),this.webUXloader.on(),f.createModal(this.elements.container,this.webUXloader.elements.container)},finishLoading:function(){this.webUXloader.off(),f.removeModal(this.elements.container)},handleFormLoad:function(){var e=this;if(F.credData[F?.defaultPreference?.collabSpace??""]){e.collabSpaceChanged(e);const t=F.credData[F.defaultPreference.collabSpace]?.organizations?.find((e=>e.value===F.defaultPreference.org))?.value??"";c.elements.organizations.elementsList.length>1&&t&&(c.elements.organizations.value=t,F.ctxName=c.elements.organizations.value)}else 1===Object.keys(widget.convertedResCtxObj).length?(c.elements.collabSpace.value=Object.values(widget.convertedResCtxObj)[0]?.value??"",e.collabSpaceChanged(e)):(c.elements.collabSpace.value="",F.selectedCollabSpace={value:"",label:"",organizations:[]},F.hasSingleOrg?e.elements.container.getElement("#organizations").hide():c.elements.organizations.disabled=!0)},docTypeChanged:function(e,t){var n={preferredType:e.dsModel.value,subtypes:"false"};t.startLoading(),t.fetchTypeInfo(n).then((n=>{t.valueChanged(e,t),widget.setValue("docm-upload-lastSelected-type",JSON.stringify({index:e.dsModel.selectedIndex,typeName:e.dsModel.value}));var i=c.elements.DCN_CustomAttributes;i&&i.remove(),c.typeInfo={...n,subTypes:c.typeInfo.subTypes},c.prototype.appendDynamicAttributes(e.dsModel.value,c.elements.accordeon),t.finishLoading()}),(n=>{t.alert.add({className:"error",message:a.get("FAILED_TO_FETCH_TYPE_INFORMATION")}),e.dsModel.selectedIndex=widget.getPreference("lastSelected")&&widget.getPreference("lastSelected").defaultValue?widget.getPreference("lastSelected").defaultValue.index:0,t.finishLoading()}))},collabSpaceChanged:function(e){e.startLoading(),console.log(c.elements.collabSpace.value,F.credData[c.elements.collabSpace.value]),F.selectedCollabSpace=F.credData[c.elements.collabSpace.value],c.elements.collabSpace.value?(c.elements.organizations.elementsList=c.elements.collabSpace.value?F.credData[c.elements.collabSpace.value].organizations:[],F.hasSingleOrg?(e.elements.container.getElement("#organizations").hide(),F.ctxName=c.elements.organizations.elementsList[0].value,c.elements.organizations.value=F.ctxName):c.elements.organizations.elementsList.length<2?(e.elements.container.getElement("#organizations").show(),F.ctxName=c.elements.organizations.elementsList[0].value,c.elements.organizations.value=F.ctxName,c.elements.organizations.disabled=!0):(c.elements.organizations.selectedIndex=-1,F.ctxName="",e.elements.container.getElement("#organizations").show(),c.elements.organizations.disabled=!1)):(F.ctxName="",c.elements.organizations.value="",c.elements.organizations.disabled=!0),e.finishLoading()},getSecurityContext:function(e){var t="";return t=e.options.securityContext?e?.options?.securityContext??"":widget.getPreference(e?.options?.credentialsPrefName??"")?.value??"",t?.includes("ctx::")?t.replace("ctx::",""):t},fileChanged:function(e){let t=e.dsModel.value,n=t.name;F.selectedFiles.length=0,F.selectedFiles.push(t),n=-1==n.indexOf(".")?n:n.substring(0,n.lastIndexOf(".")),c.elements.Title&&(c.elements.Title.value.length>0?c.elements.Title.value=n:(c.elements.Title.value=n,c.elements.Title._giveFocus()))},generategridTree:function(){F.model=new i,F.model.prepareUpdate();for(var e=0;e<F.selectedFiles.length;e++){var t=F.selectedFiles[e];F.model.addRoot(new o({label:t.name,data:{file:t},grid:{name:t.name,comment:""}}))}return F.model.expandAll(),F.model.pushUpdate(),F.model},filterTypes:function(){var e=[],t=this.options.supportedTypes;return t&&(t.includedTypes||t.excludedTypes)?F.docmDictionaryHandler.subTypes.forEach((n=>{!t.includedTypes.includes("*")&&!t.includedTypes.includes(n.type)||t.excludedTypes.includes(n.type)||e.push({label:n.typeNLS,value:n.type})})):F.docmDictionaryHandler.subTypes.forEach((function(t){e.push({label:t.typeNLS,value:t.type})})),e},appendInheritedAttributes:function(t,n){if(F.docTypesList[t]){var i=F.docTypesList[t].attributes;i&&i.length>0&&i.forEach((function(e){n.attributes.unshift(e)}));var o=F.docTypesList[t].interfaces;o&&e.merge(n.deploy_interfaces,o),this.appendInheritedAttributes(F.docTypesList[t].parent,n)}},formatInputValues:function(e){var t=void 0;if(Array.isArray(e)){var n=[];e.forEach((function(e){n.push(e instanceof Date?e:e.toString())})),n.length>0&&(t=n)}else null!=e&&(t=e instanceof Date?e:e.toString());return t},createUpload:function(e){var t=this;t.options.connector?(t.options.parentObject.parentId&&(e.relInfo={parentId:t.options.parentObject.parentId,parentRelName:t.options.parentRelName,parentDirection:"from"}),t.options.connector.uploadAttachment(e,t.options.parentObject,F.ctxName)):(t.options.parentId&&(e.relInfo={parentId:t.options.parentId,parentRelName:t.options.parentRelName,parentDirection:"from"}),t.uploadDocument(e,{tenant:t.options.tenant,securityContext:F.ctxName,documentType:c.elements.ENOX_Document_Type.value,tenantUrl:t.options.tenantUrl,getWorkUnderHeaders:t.options.getWorkUnderHeaders}))},createAndUpload:function(e){var t=this,n=F.selectedFiles.length>1;if(n||!n&&c.elements.Title&&c.elements.FileComment&&c.elements.Title.value.trim().length>0){var i=c.elements.ENOX_Document_Type.value,o={},a={attributes:[]};c.prototype.appendInheritedAttributes(i,a),a.attributes.forEach((function(e){var n=t.formatInputValues(c.elements[e.attribute.replace(" ","_")].value);n&&(o[e.attribute]=n)})),1==F.selectedFiles.length?F.selectedFiles.forEach((e=>{var a={title:n?-1==e.name.indexOf(".")?e.name:e.name.substring(0,e.name.lastIndexOf(".")):c.elements.Title.value,type:i,description:n?"":c.elements.Description.value,custom_attributes:o,fileInfo:{comments:n?"":c.elements.FileComment.value,file:e}};t.createUpload(a)})):1<F.selectedFiles.length&&F.model.getAllDescendants().forEach((e=>{var o=e.options.data.file,a={title:-1==o.name.indexOf(".")?o.name:o.name.substring(0,o.name.lastIndexOf(".")),type:i,fileInfo:{comments:n?e.options.grid.comment:"",file:o}};t.createUpload(a)}))}else this.uploadDocument({title:n?"":c.elements.Title.value,description:n?"":c.elements.Description.value,comments:n?"":c.elements.FileComment.value},{tenant:t.options.tenant,securityContext:F.ctxName,tenantUrl:t.options.tenantUrl,getWorkUnderHeaders:t.options.getWorkUnderHeaders});e.close(),e.destroy(),t.options.onUploadStart?t.options.onUploadStart():(n||0!=c.elements.Title.value.trim().length||c.elements.Title.getContent().getParent().addClassName("has-error"),0==F.selectedFiles.length&&widget.getElement("#DCN_uploadBtn").dsModel.getContent().addClassName("has-error"))},showNotification:function(e,t,n,i,o,a){var s={level:e,title:t,subtitle:n,message:i,sticky:o,allowUnsafeHTML:a||!1};window.notifs||(window.notifs=S,N.setNotificationManager(window.notifs),N.setStackingPolicy(5)),window.notifs.addNotif(s)},updateResCtx:function(e){var t={};for(let i=0;i<e.length;i++){var n=e[i];n.prjname&&(t[n.prjname]?t[n.prjname].organizations.push({ctxname:n.ctxname,ctxtitle:n.ctxtitle,value:n.ctxname,label:n.orgtitle}):t[n.prjname]={label:n.prjtitle,value:n.prjname,organizations:[{ctxname:n.ctxname,ctxtitle:n.ctxtitle,value:n.ctxname,label:n.orgtitle}]})}return t},create:async function(t){var n=this,i={securityContext:this.options.securityContext,tenantUrl:this.options.tenantUrl},o="";try{o=await C.getcreateCtxValue(i).promise}catch(e){return void n.showNotification("error",a.Upload_Document_Error_Title,"",a.Upload_Document_Error_Message)}if(o[0]?.minimalroles)n.showNotification("error",a.Upload_Document_Error_Title,"",a.Upload_Document_Error_Message);else{var c=o.findIndex((e=>e.minimalroles));c>0&&o.splice(c,1),F.hasSingleOrg=o.every((e=>e?.orgname===o[0].orgname));const i=o.find((e=>e.ctxname===n.getSecurityContext(n)));i&&(F.defaultPreference={collabSpace:i.prjname,org:i.ctxname}),widget.convertedResCtxObj=this.updateResCtx(o),F.credData=widget.convertedResCtxObj,f.createModal(n.options.containerToOverlay,this.loader.elements.container),n.loader.on(a.get("LOADING"));for(var u=0;u<t.length;u++)F.selectedFiles.push(t[u]);n.configurations={preferredType:n.getPreferences("docm-upload-lastSelected-type").typeName,subtypes:"true"};var m=new e.Promise((function(t,i){var o={securityContext:n.options.securityContext,platformUrls:{"3DSpace":n.options.tenantUrl}};e.Promise.all([p.getCredentialsList(n.options).promise,d.getTypeInfos(n.options,n.configurations).promise,w.getcommentAsMandtoryConfigValue(o).promise]).then((function(e){t(e)}),(function(e){i(e)}))})),g=this.loader.canceller.promise;e.Promise.race([m,g]).then((function(e){var i,o,c=new Date-window.documentDictionaryLoadStart;if(n.options.connector?n.options.parentObject.parentId&&(i=n.options.parentObject.parentId,o=n.options.parentRelName):n.options.parentId&&(i=n.options.parentId,o=n.options.parentRelName),b.sendTrackerPageEvent({category:"docm.document.upload.ready",action:"click/drop",label:"Document Upload Ready",pd:{parentId:i,parentRelName:o},pv:{totalTimeTaken:c,success:1}}),n.loader.on(a.get("LOADING")),f.removeModal(n.options.containerToOverlay),F.credentials=e[0],F.docmDictionaryHandler=e[1],F.GetWidgetConfiguration=e[2],n.filteredTypes=n.filterTypes(),0==n.filteredTypes.length)n.options.onError&&n.options.onError({subtitle:a.get("INVALID_CONFIGURATION"),message:a.get("NO_DOCUMENT_TYPES_ALLOWED")});else{var d=!1;n.generateForm(),n.dialog=new s({title:a.get("Upload")+(t.length>1?" "+t.length+" - "+a.get("files"):""),content:n.getContent(),immersiveFrame:n.options.immersiveFrame,resizableFlag:!0,width:"500",modalFlag:!0,buttons:{Cancel:new r({label:a.get("Cancel"),onClick:function(e){e.dsModel.dialog.close(),e.dsModel.dialog.destroy(),n.options.onCancel&&n.options.onCancel()},tooltipInfos:new l({title:a.get("Cancel"),mouseRelativePosition:!1})}),Ok:new r({label:a.get("Upload"),emphasize:"primary",domId:"DCN_uploadBtn",onClick:function(e){d=!0,n.validateInputs()&&n.createAndUpload(e.dsModel.dialog)},tooltipInfos:new l({title:a.get("Upload"),mouseRelativePosition:!1})})}}),n.alert.inject(n.dialog.getContent(),"top"),0!=n.options.isFromPopup&&n.dialog.elements._modalDiv.addClassName("document-createNew-modal"),n.dialog.addEventListener("close",(function(){d||n.options.onCancel()}))}}),(function(e){var t,i,o=new Date-window.documentDictionaryLoadStart;n.options.connector?n.options.parentObject.parentId&&(t=n.options.parentObject.parentId,i=n.options.parentRelName):n.options.parentId&&(t=n.options.parentId,i=n.options.parentRelName),b.sendTrackerPageEvent({category:"docm.document.upload.ready",action:"click/drop",label:"Document Upload Ready",pd:{parentId:t,parentRelName:i},pv:{totalTimeTaken:o,failure:0}}),n.options.onError&&"usercancelled"!=e&&n.options.onError(e),n.options.onCancel&&"usercancelled"==e&&n.options.onCancel(),f.removeModal(n.options.containerToOverlay)}))}},selectFilesAndCreate:async function(){var t=this,n={securityContext:this.options.securityContext,tenantUrl:this.options.tenantUrl},i="";try{i=await C.getcreateCtxValue(n).promise}catch(e){return void t.showNotification("error",a.Upload_Document_Error_Title,"",a.Upload_Document_Error_Message)}if(i[0]?.minimalroles)t.showNotification("error",a.Upload_Document_Error_Title,"",a.Upload_Document_Error_Message);else{var o=e.createElement("input",{attributes:{type:"file",multiple:!0},styles:{display:"none"},events:{change:function(e){var n=e.target&&e.target.files&&e.target.files.length>0?e.target.files:e.dataTransfer.files;t.create(n),o.destroy()}}}).inject(document.body);o.click()}},valueChanged:function(t,n){var i=t.dsModel.value;e.is(t.dsModel.selectedIndex,"number")&&(i=t.dsModel.currentLabel),"Organization"==t.dsModel.options.fieldFor&&(F.ctxName=t.dsModel.value),t.dsModel.tooltipInfos.shortHelp=i,console.log(F.ctxName)},validateInputs:function(e){var t=this,n=!0,i=Object.keys(c.elements),o=[];t.fixedFormFields.forEach((e=>{e&&e.settings&&e.settings.domId&&o.push(e.settings.domId),"accordeon"==e.type&&Array.isArray(e.items)&&e.items.length>0&&e.items.forEach((e=>{Array.isArray(e.content)&&e.content.length>0&&e.content.forEach((e=>{e&&e.settings&&e.settings.domId&&o.push(e.settings.domId)}))}))})),Array.isArray(c.customAttributes)&&c.customAttributes.length>0&&1===F.selectedFiles.length&&(o=[...o,...c.customAttributes]);for(var s=0;s<i.length&&1==F.selectedFiles.length;s++){var r=c.elements[i[s]];if(o.includes(i[s]))if(r.options)if(r.options.requiredFlag)if(null==(l=r.value)&&(l=""),"number"!=typeof l&&"boolean"!=typeof l&&"Date"!=r.options.type||(l=l.toString()),!(r.options.multiValued?Array.isArray(l)&&l.length>0:"string"==typeof l&&l.trim().length>0||"object"==typeof l&&l.name&&l.name.trim().length>0)){n=!1,t.alert.add({className:"warning",message:a.get("Field_Required",{attribute:r.options.label})});break}}if(0==n)return n;if(F.selectedFiles.length>1){for(s=0;s<i.length;s++){var l;r=c.elements[i[s]];if(o.includes(i[s]))if(r.options)if(r.options.requiredFlag)if(null==(l=r.value)&&(l=""),"number"!=typeof l&&"boolean"!=typeof l&&"Date"!=r.options.type||(l=l.toString()),!(r.options.multiValued?Array.isArray(l)&&l.length>0:"string"==typeof l&&l.trim().length>0||"object"==typeof l&&l.name&&l.name.trim().length>0)){n=!1,t.alert.add({className:"warning",message:a.get("Field_Required",{attribute:r.options.label})});break}}for(s=0;s<F.model.getAllDescendants().length&&"Enabled"==c.commentAsMandatoryValue&&n;s++)if(!F.model.getAllDescendants()[s].options.grid.comment){n=!1,t.alert.add({className:"warning",message:a.get("Field_Required",{attribute:a.get("e6wFileField.comments")})});break}}return n},getPreferences:function(e){var t=void 0;if("docm-upload-lastSelected-type"===e)if(t={index:0,typeName:"Document"},widget.data["docm-upload-lastSelected-type"]){var n=JSON.parse(widget.data["docm-upload-lastSelected-type"]);t.index=n.index||t.index,t.typeName=n.typeName||t.typeName}return t}});return F.prototype.uploadDocument=function(t,i){var o=this,s=e.is(i.getWorkUnderHeaders,"function")?i.getWorkUnderHeaders():{};i.securityContext&&(s.SecurityContext=encodeURIComponent(i.securityContext));var r={tenant:i.tenantId,securityContext:i.securityContext,//! check if there is no need to send this, does Document Management API consider this.
tenantUrl:i.tenantUrl,additionalHeaders:s,onFailure:function(e){var n=new Date-c.documentUploadStart;b.sendTrackerPageEvent({category:"docm.document.upload.complete",action:"click",label:"Document Upload Done",pd:{parentId:void 0,parentRelName:void 0,securityContext:i.securityContext,docType:t.type,fileType:v.getFileExtension(t.fileInfo.file.name),filesize:t.fileInfo.file.size},pv:{totalTimeTaken:n,failure:0}}),T.jobs.finishJob(c,"failed"),o.options.onError&&(e.internalError&&e.internalError.contains("No create access")?o.options.onError({title:a.get("DOCUMENT_CANNOT_BE_CREATED_X",{type:i.documentType}),subtitle:a.get("Document_Create_Error_Subtitle"),message:a.get("Document_Create_Error_Message")}):o.options.onError({title:a.get("DOCUMENT_CANNOT_BE_CREATED"),message:e&&e.error||a.get("X_CANNOT_BE_CREATED",{title:t.title})}))},onProgress:function(e){c.update(e)},onComplete:function(e){var n=new Date-c.documentUploadStart;b.sendTrackerPageEvent({category:"docm.document.upload.complete",action:"click",label:"Document Upload Done",pd:{parentId:void 0,parentRelName:void 0,securityContext:i.securityContext,docType:t.type,fileType:v.getFileExtension(t.fileInfo.file.name),filesize:t.fileInfo.file.size},pv:{totalTimeTaken:n,success:1}});e.data;if(T.jobs.finishJob(c),o.options.onDocumentUpload){var s={notification:{title:a.get("DOCUMENT_CREATED"),subtitle:a.get("X_HAS_BEEN_CREATED_SUCCESSFULLY",{title:t.title})},documents:e.data};t.relInfo&&(s.relInfo=t.relInfo),o.options.onDocumentUpload(s)}},customDocumentObject:t.custom_attributes?{dataelements:t.custom_attributes}:void 0,preProcess:function(e){console.log("docJson"),console.log(e)}},l=t.title;t.fileInfo&&(l=t.fileInfo.file.name);var c={title:a.get("UPLOADING_X",{title:l}),ui:!!t.fileInfo,process:function(){c.documentUploadStart=new Date,c.xhr=n.createDocument(t,r)}};T.jobs.addJob(c)},F})),define("DS/DocumentCreateNew/PLMNewFilesTab/data/Model",["UWA/Core","DS/TreeModel/TreeNodeModel","DS/Tweakers/TypeRepresentationFactory","DS/DocumentCreateNew/PLMNewFilesTab/utils/ExtensionUtils"],(function(e,t,n,i){"use strict";var o=new n;function a(e,t,n){var o={data:e,grid:{name:e.name,tree:e.name,label:e.name,title:e.name,comments:e.comments?e.comments:"",fileExtension:r(e.name)},name:e.name,label:e.name,title:e.name,lowercase:{label:e.name.toLowerCase()}};return e.file?o.file=e.file:o.file=e,e.grid&&e.grid.comments&&(o.grid.comments=e.grid.comments),e.icons?o.icons=e.icons:o.icons=[t.platformServices["3DSpace"]+"/"+i.getIcon(r(e.name))],e.thumbnail?o.thumbnail=e.thumbnail:o.thumbnail=t.platformServices["3DSpace"]+"/"+i.getThumbnail(r(e.name)),e.user?(o.user=e.user,o.grid.owner=e.grid.owner):t.user&&(o.user=t.user,o.grid.owner={label:o.user.firstname+" "+o.user.lastname,username:o.user.id},t.platformServices&&t.platformServices["3DSwym"]&&(o.grid.owner.icon=t.platformServices["3DSwym"]+"/api/user/getpicture/login/"+o.user.id+"/format/mini")),o.subLabel=s(o),o.description=o.grid.comments,o}function s(t){var n=e.createElement("div",{class:"NameAndComment"});return o.generateView(t.grid.owner,{readOnly:!0,typePath:"user",onViewCreated:function(e){e.inject(n)}}),n}function r(e){return e.substring(e.lastIndexOf(".")+1,e.length)||e}var l=function(e,n){var i=a(e,n);i.updateData=function(e){o.updateOptions(a(e,n))},i.updateNameAndComment=function(e){e.updateOptions({subLabel:s({grid:{owner:e.options.grid.owner,comments:e.options.grid.comments}}),description:e.options.grid.comments})};var o=new t(i);return i.getAttributeValue=o.getAttributeValue.bind(o),o};return l.getFileExtension=r,l})),define("DS/DocumentCreateNew/PLMNewFilesTab/views/GridPane",["UWA/Core","DS/DataGridView/DataGridView","DS/Tweakers/TypeRepresentationFactory","DS/DocumentCreateNew/PLMNewFilesTab/data/Columns","DS/Utilities/Utils"],(function(e,t,n,i,o){"use strict";new n;return e.Controls.Abstract.extend({name:"enox-plmNewFilesTab-gridpane",options:{className:""},_options:{},init:function(e){this.ctrl=e,this.events=e.events,this.ctrl.gridPane=this,this._parent({})},build:function(n){var a=this;a.elements.container=e.createElement("div",{class:this.getClassNames(),styles:{display:"none"}});var s=new i(a.ctrl).getColumns(),r="enox-plmNewFilesTab-"+(e.is(widget.data.appId)?widget.data.appId:widget.environment.data._data._x_appId)+"-gridview",l=window.localStorage.getItem("wux-collectionView-dataGridView");null!=l&&(l=JSON.parse(l))[r]&&(delete l[r].columnsSortModel,window.localStorage.setItem("wux-collectionView-dataGridView",JSON.stringify(l))),a.datagridview=new t({identifier:r,treeDocument:a.ctrl.controller.files.treeDocument,columns:s,autoRowHeightFlag:!0,rowDragEnabledFlag:!1,cellDragEnabledFlag:!1,rowGroupingEnabledFlag:!1,defaultColumnDef:{editableFlag:!1,resizableFlag:!0,sortableFlag:!0,typeRepresentation:"string"},selectionMode:"row",showContextualMenuColumnFlag:!0,rowSelection:"multiple",cellSelection:"none",showSelectionCheckBoxesFlag:!0,showRowIndexFlag:!1,sortModel:[a.ctrl.controller.files.sortModel],layoutOptions:{useLastColumnWidthAutoFlag:!0},onContextualEvent:function(e){if(e&&e.collectionView)return e.cellInfos&&e.cellInfos.nodeModel?(a.ctrl.contextMenu.selectionChanged(),a.ctrl.contextMenu.promise):e.collectionView.buildDefaultContextualMenu(e,{pin:!0,firstColumnsVisibility:!0,columnsManagement:!0,sizeColumnToFit:!0})},onDragStartCell:function(e,t){}}).inject(a.elements.container),a.datagridview.getTreeDocument().onNodeModelUpdate((e=>{if(e.data.previousAttributes&&e.data.previousAttributes.hasOwnProperty("comments")){var t=e.data.nodeModel;t.options.updateNameAndComment(t)}})),a.datagridview.addEventListener("liveChange",((e,t)=>{if("Enabled"==a.ctrl.options.mandatoryCommentConfigSetting){var n={nodeID:t.nodeModel._getID(),value:{}};t&&a.datagridview.getColumnOrGroup(t.columnID)&&"comments"==a.datagridview.getColumnOrGroup(t.columnID).dataIndex&&(n.value.comments=e.options.value,a.debouncedMethod||(a.debouncedMethod=o.debounce((e=>{console.log(e.value.comments);var t=a.ctrl.controller.files.validateComments(e);a.ctrl.options.tabAccess.updateCreateButtonDisability(!t)}),300)),a.ctrl.options.tabAccess.updateCreateButtonDisability(!0),a.debouncedMethod(n))}})),this.ctrl.events.addEventListener("applySortModel",(function(e){a.datagridview.sortModel=e})),this.ctrl.events.addEventListener("enox-plmNewFilesTab-data-needs-sorting",(function(e){a.datagridview.reapplySortModel()})),a.ctrl.events.subscribe({event:"enox-plmNewFilesTab-flash-row-added"},(function(e){e.forEach((e=>{var t=e._getRowID();a.datagridview._flashEffectOnRow("ui-modified",t)}))})),console.log(a.datagridview.getCustomViewsManager().getCurrentCustomView()),a.datagridview.getCustomViewsManager().onCustomViewsSave=function(e,t){console.log(e),console.log(t)},a.inject(n)}})})),define("DS/DocumentCreateNew/PLMNewFilesTab/data/Collection",["DS/TreeModel/TreeDocument","DS/DocumentCreateNew/PLMNewFilesTab/data/Model"],(function(e,t){"use strict";return function(n){var i={ctrl:n,options:n.options,count:0,treeDocument:new e({useAsyncPreExpand:!0,shouldAcceptDrag:function(e,t){return!1},shouldAcceptDrop:function(e,t){return!0}}),sortModel:{sortAttribute:"modified",sort:"desc",dataIndex:"modified"},clear:function(){return i.treeDocument.removeRoots(),n.options.requestId=(new Date).getTime()},addFiles:function(e,o){i.treeDocument.getAllDescendants().length>0&&(e=n.helper.ensureUniqueFiles(e,i.treeDocument.getAllDescendants())),i.treeDocument.prepareUpdate(),console.log(o+" Prepare Update");var a=[];return e.forEach((function(e){a.push(i.treeDocument.addRoot(new t(e,n.options)))})),i.treeDocument.pushUpdate(),console.log(o+" PushUpdate"),n.options.events.publish({event:"enox-plmNewFilesTab-data-needs-sorting"}),a},removeFilesByIds:function(e){i.treeDocument.getRoots().forEach((t=>{e.includes(t.options.data.id)&&setTimeout((()=>{t.remove()}),1)}))},getFilesFromNodes:function(){var e=[];return i.treeDocument.getAllDescendants().forEach((t=>{t.options.file.comment=t.options.grid.comments?t.options.grid.comments:"",e.push(t.options.file)})),e},validateComments:function(e){var t=!0,n=i.treeDocument.getAllDescendants();if(0==n.length)return t;for(let i=0;i<n.length;i++){var o=n[i],a=o.options.grid.comments;if(e&&e.nodeID==o._getID()&&(a=e.value.comments.trim()),!a){t=!1;break}}return t}};return i.treeDocument.getModelEvents().subscribe({event:"addChild"},(function(e,t,o){i.count++,n.events.publish({event:"enox-plmNewFilesTab-collection-count-changed",data:{count:i.count,action:"Addition"}})})),i.treeDocument.getModelEvents().subscribe({event:"removeChild"},(function(e,t,o){i.count--,n.events.publish({event:"enox-plmNewFilesTab-collection-count-changed",data:{count:i.count,action:"Removed"}})})),n.options.events.subscribe({event:"enox-files-node-selection-add"},(function(e){var t=i.treeDocument.getSelectedNodes();n.options.events.publish({event:"enox-plmNewFilesTab-node-selection-changed",data:t})})),n.options.events.subscribe({event:"enox-plmNewFilesTab-node-selection-remove"},(function(e){i.treeDocument.getSelectedNodes();n.options.events.publish({event:"enox-plmNewFilesTab-node-selection-changed",data:i.treeDocument.getSelectedNodes()})})),i}})),define("DS/DocumentCreateNew/PLMNewFilesTab/data/Controller",["UWA/Core","UWA/Class","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/DocumentCreateNew/PLMNewFilesTab/data/Collection","DS/DocumentCreateNew/PLMNewFilesTab/data/Data","DS/DocumentCreateNew/PLMNewFilesTab/utils/Helper","DS/DocumentCommonInfra/Utils/GetWidgetConfiguration","i18n!DS/DocumentCreateNew/assets/nls/DocumentCreateNew"],(function(e,t,n,i,o,a,s,r){"use strict";return t.extend({init:function(t){var r=this;t.controller=this,this.ctrl=t,this.controller=this,this.files=new i(t),this.data=new o(t),this.helper=new a(t),this.ready=e.Promise.deferred(),this.getPlatformServicesPromise=new e.Promise((function(e,i){n.getPlatformServices({platformId:t.options.tenant,onComplete:function(n){console.log(n),n.length&&(console.error("getPlatformServices returned an array"),n=n[0]),t.options.platformServices=n,console.log("getPlatformServices resolved"),e(n)},onFailure:function(e){console.error("Failed to get platform services",e),i(e)}})})),this.getCurrentUserPromise=new e.Promise((function(e,i){n.getUser({platformId:t.options.tenant,onComplete:function(n){t.options.user=n,e(n)},onFailure:function(e){console.error("Failed to get current user for files",e),i(e)}})})),this.getJobsProcessorPromise=t.options.getJobsProcessorPromise||new e.Promise((function(e,t){var n={};window.widget&&window.widget.app&&window.widget.app.jobs&&"doco-jobs"==window.widget.app.jobs.name&&window.widget.app.progressPane&&"doco-progress"==window.widget.app.progressPane.name?(n=window.widget.app,e(n.jobs)):(console.warn("FileController had to initialize jobs and progressPane"),require(["DS/DocumentCommands/Jobs","DS/DocumentCommands/ProgressPane"],(function(t,i){null==n.jobs&&(n.jobs=new t(n)),null==n.progressPane&&(n.progressPane=new i(n),window.widget&&window.widget.body?n.progressPane.inject(window.widget.body):n.progressPane.inject(document.body)),e(n.jobs)})))})),e.Promise.all([this.getPlatformServicesPromise,this.getCurrentUserPromise,this.getJobsProcessorPromise]).then((function(e){var n={securityContext:t.options.PlmNewOptions.securityContext,platformUrls:t.options.platformServices};return s.getcommentAsMandtoryConfigValue(n).promise})).then((e=>{t.options.mandatoryCommentConfigSetting=e,"Enabled"==e&&(r.view="grid"),r.ready.resolve(!0)})),this.view=this.helper.loadViewMode()},loadFiles:function(){new Date;this.ready.promise.then((function(){}))},clearAll:function(){this.files.clear()},switchView:function(e){var t=this;this.files.count>0?"grid"==e?(this.ctrl.tilePane.hide(),this.ctrl.uploadPane.hide(),this.ctrl.gridPane.show(),t.ctrl.informationPane.hide(),this.view=e,this.helper.saveViewMode(e)):"tile"!=e&&null!=e||("Enabled"==t.ctrl.options.mandatoryCommentConfigSetting&&(t.controller.files.validateComments()?t.ctrl.informationPane.hide():(t.ctrl.informationPane.show(),t.ctrl.informationPane.updateInformationContent({subTitle:r.get("CommentMandatoryWarning"),emphasis:"warning"}))),this.ctrl.uploadPane.hide(),this.ctrl.gridPane.hide(),this.ctrl.tilePane.show(),this.view="tile",this.helper.saveViewMode(this.view)):("grid"!=e&&"tile"!=e||(this.view=e,this.helper.saveViewMode(this.view)),this.ctrl.gridPane.hide(),this.ctrl.tilePane.hide(),t.ctrl.informationPane.hide(),this.ctrl.uploadPane.show())}})})),define("DS/DocumentCreateNew/PLMNewFilesTab/PLMNewFilesPane",["UWA/Core","UWA/Controls/Abstract","DS/CoreEvents/ModelEvents","DS/DocumentCreateNew/PLMNewFilesTab/data/Controller","DS/DocumentCreateNew/PLMNewFilesTab/views/InformationPane","DS/DocumentCreateNew/PLMNewFilesTab/views/Topbar","DS/DocumentCreateNew/PLMNewFilesTab/views/UploadPane","DS/DocumentCreateNew/PLMNewFilesTab/views/GridPane","DS/DocumentCreateNew/PLMNewFilesTab/views/TilePane","DS/DocumentCreateNew/PLMNewFilesTab/ContextMenu","DS/DocumentCreateNew/PLMNewFilesTab/EventHandler","DS/DocumentCreateNew/PLMNewFilesTab/utils/DnDManager","DS/UIKIT/Alert","DS/Controls/Loader","DS/Controls/ModalContainer","css!DS/DocumentCreateNew/PLMNewFilesTab/PLMNewFilesTab"],(function(e,t,n,i,o,a,s,r,l,c,d,u,m,p,g){"use strict";return t.extend({name:"enox-plmNewFilesTab",options:{className:""},_options:{},modelEvents:void 0,init:function(e){e.plmNewFilesPane=this,this.events=e.events||new n,delete e.events,this._parent(e),this.options.events=this.events,e.events=this.events,this.options.tenant=this.options.PlmNewOptions?this.options.PlmNewOptions.tenant:void 0,this.events._pubsub._spyEvents=function(e,t){console.log("PLMNewFilesTab:",e,t,this)},this.buildSkeleton()},buildSkeleton:function(){var t=this;this.elements.container=e.createElement("div",{class:this.getClassNames()}),this.elements.container.addEvent("resize",(function(e,t,n){console.log(e),console.log(e.target.clientWidth),console.log(e.target.clientHeight)})),this.elements.container.dsModel=this,this.elements.content=e.createElement("div",{class:this.getClassNames("-content")}),this.elements.content.inject(this.elements.container),this.loader=new p,this.alert=new m({closable:!0,visible:!0,maximumVisibleMessages:1,closeOnClick:!0}).inject(this.elements.content),this.startLoading(),new i(this),this.controller.ready.promise.then((function(){new o(t).build(t.elements.content),new a(t).build(t.elements.content),t.buildContentPanes(),t.contextMenu=new c(t),new d(t).connect(t.elements.content,t.controller,t.toolbar,t.contextMenu)}))},buildContentPanes:function(){this.elements.panes=e.createElement("div",{class:this.getClassNames("-panes")}),this.elements.panes.inject(this.elements.content),new s(this).build(this.elements.panes),new r(this).build(this.elements.panes),new l(this).build(this.elements.panes),new u(this),this.finishLoading()},getUI:function(){return this.elements.container},startLoading:function(){this.isLoadingInProgress=!0,this.loader.on(),g.createModal(this.elements.container,this.loader.elements.container)},finishLoading:function(){this.isLoadingInProgress=!1,this.loader.off(),g.removeModal(this.elements.container)}})})),define("DS/DocumentCreateNew/PLMNewFilesTab/PLMNewFilesTab",["UWA/Core","DS/ENONewWidget/ENONew/View/Facet/ENONewFacetBase","UWA/Class/Options","UWA/Class/Events","DS/DocumentCreateNew/PLMNewFilesTab/PLMNewFilesPane"],(function(e,t,n,i,o){return t.extend(n,i,{name:"PLMNewFilesTab",securityContext:null,init:function(e){var t=this;this._parent(e),t.paneOptions=t.getOptions(e),this.plmNewFilesPane=new o(t.paneOptions),this.elements.container=this.plmNewFilesPane.getUI(),e.ODT||this.listenToPublishedInfo((function(e,n){if("currentSecurityContext"===e){let e=n.value;t.options.securityContext=e}}))},getOptions:function(t){return{PlmNewOptions:e.clone(t,!0),tabAccess:this}},plmNewContextProvider:function(){return this.options.securityContext},getUI:function(e){return this.elements.container},updateCreateButtonDisability:function(e){this.setFacetValidation(!e)},postCreation:function(t){var n=this;if(n.uploadCompletionPromise=e.Promise.deferred(),n.filesArray=void 0,n.filesArray=n.plmNewFilesPane.controller.files.getFilesFromNodes(),n.filesArray.length>0){n.filesArrayCopy=n.filesArray,n.token=void 0,n.token=n.plmNewFilesPane.controller.helper.getUniqueToken();var i={getParentDocument:function(){return t[0].identifier},fetchSecurityContext:function(){return n.plmNewContextProvider()},token:n.token,getJobsProcessorPromise:n.plmNewFilesPane.controller.getJobsProcessorPromise._promise,files:n.plmNewFilesPane.controller.files.getFilesFromNodes(),platformUrls:n.plmNewFilesPane.options.platformServices,events:n.plmNewFilesPane.events,source:"PLMNewFilesTab"};n.fileUploadEventInstance&&(n.plmNewFilesPane.events.unsubscribe(n.attachUrlCompleteEventToken),n.fileUploadEventInstance=void 0),require(["DS/DocumentCommands/V2/FileActions/UploadFile"],(function(e){new e(i).execute(n.filesArray),n.uploadCompletionPromise.resolve()}))}else n.uploadCompletionPromise.resolve();return new Promise((e=>{n.uploadCompletionPromise.promise.then((()=>{e({level:"success",title:"Files Upload.",subtitle:"Files Upload Started...",allowUnsafeHTML:!1,code:"200"})}))}))},destroy:function(){this.options.onDestroyCallback(this.options.tabId),this._parent()}})}));