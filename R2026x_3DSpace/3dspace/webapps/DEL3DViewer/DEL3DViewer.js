define("DS/DEL3DViewer/CGRHelper",["DS/Formats/CGRFile"],(function(e){"use strict";let t={decodeArrayBuffer:function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let r=new ArrayBuffer(e.length/4*3);return function(e,r){var n=t.indexOf(e.charAt(e.length-1)),i=t.indexOf(e.charAt(e.length-2)),o=e.length/4*3;let a,s,l,d,u,g,c,h;64===n&&o--,64===i&&o--;let p=0,f=0;for(a=r?new Uint8Array(r):new Uint8Array(o),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,""),p=0;p<o;p+=3)u=t.indexOf(e.charAt(f++)),g=t.indexOf(e.charAt(f++)),c=t.indexOf(e.charAt(f++)),h=t.indexOf(e.charAt(f++)),s=u<<2|g>>4,l=(15&g)<<4|c>>2,d=(3&c)<<6|h,a[p]=s,64!==c&&(a[p+1]=l),64!==h&&(a[p+2]=d)}(e,r),r},decodeRep:function(r,n){return new e(void 0,void 0,void 0,!0).openSceneGraph(new Uint8Array(t.decodeArrayBuffer(r)),(function(){}),n)}};return t})),define("DS/DEL3DViewer/commands/DELWebViewerLevelSelectorCmd",["DS/Logger/Logger","DS/Selection/HSOManager","DS/ENOPAD3DViewer/commands/PAD3DViewerLevelSelectorCmd","DS/DELWebViewerUtils/Utils","DS/DELWebViewerUtils/DELWebViewerSettingsMgt"],(function(e,t,r,n,i){"use strict";return r.extend({logger:e.getLogger("DS/DEL3DViewer/commands/DELWebViewerLevelSelectorCmd"),init:function(e){this._parent(e)},onDragStart:function(e){let r=t.get().map((function(e={}){let t={contextId:i.getSetting("pad_security_ctx"),envId:n.getPlatformId(),serviceId:"3DSpace",path:[]};if(e.pathElement){let r=e.pathElement.externalPath;if(UWA.is(r,"array"))for(let e=1;e<r.length;e++){let n=r[e],i=n.getModelIdentification(),o=(n.getUserData()||{}).type;if(!i)break;t.path.push({resourceid:i,type:o}),t.objectId=i,t.objectType=o}else this.logger.warn("Unable to build drag object, as externalPath property is not available in the path element")}return t})),o={biProxyCtx:{appId:n.getAppId(),widgetId:n.getWidgetId()},data:{items:r},protocol:"3DXContent",source:n.getAppId(),version:"1.1",widgetId:n.getWidgetId()};if(!(UWA.is(r,"array")&&r.length>0))return e.preventDefault(),!1;e.dataTransfer.setData("text/plain",JSON.stringify(o))},setLevelDraggable:function(e){let t=widget.getElement("#LevelSelector");if(t){let r=t.getElements(".levels .level canvas");if(r){for(let t=0;t<r.length;t++){let n=r[t];n.setAttribute("draggable",e),n.style.cursor=e?"grab":"pointer"}!0===e?t.addEventListener("dragstart",this.onDragStart):t.removeEventListener("dragstart",this.onDragStart)}else this.logger.error("No levels container available, please check the selector")}else this.logger.error("No level selector container available, please check the selector")},execute:function(){this._parent(),this.setLevelDraggable(!0)},endExecute:function(){this.setLevelDraggable(!1),this._parent()}})})),define("DS/DEL3DViewer/ToolBar",["UWA/Core","DS/DELWebUXControls/DELGeneratedToolbar","DS/DELWebUiComponent/CommonUtils"],(function(e,t,r){"use strict";return function(n){var i,o,a,s=n.getOption("executionContext"),l=n.getOption("eventCollection").getViewerCtrlEventHnd();return l.subscribe(l.events.onCommandClose,(function(e){e&&e.commandId&&o.getNodeModelByID(e.commandId)&&o.updateNodeModel(e.commandId,e)})),{create:function(n){let l=r.getImmersiveFrame(s),d=r.getUIFrame(s);n&&(a=e.clone(n),i=t.prototype.createTreeDocument({entries:n}),(o=new t({overflowManagement:"dropdown",direction:"horizontal",items:i,domId:"DEL3DViewerToolbar",immersiveFrame:l})).elements.container.inject(d))},show:function(){o&&(o.visibleFlag=!0)},hide:function(){o&&(o.visibleFlag=!1)},getNodeModel:function(e){let t;return o&&e&&(t=o.getNodeModelByID(e.commandId)),t},updateNodeModel:function(e){e&&e.commandId&&o.updateNodeModel(e.commandId,e)},reset:function(){a.forEach((function(t){e.is(t.dataElements.value,"boolean")&&o.updateNodeModel(t.id,{grid:{data:t.dataElements.value}})}))}}}})),define("DS/DEL3DViewer/DELOrientationViewer",["UWA/Core","DS/WebappsUtils/WebappsUtils","DS/Visualization/ThreeJS_DS","DS/SceneGraphNodes/FixedSizeNode3D","DS/Visualization/Node3D","DS/Mesh/MeshUtils","DS/DELWebViewerUtils/DELWebViewerSettingsMgt"],(function(e,t,r,n,i,o,a){"use strict";return function(s,l){var d,u,g,c,h,p,f,m=l.getOption("viewerOptions").orientationViewer.options,v=s.getWebGLViewer(),w=v.internalSceneGraph,P=l.getOption("eventCollection").getViewerCtrlEventHnd(),E=l.getOption("mappingKeys"),D=a.getDELViewerSetting("orientationViewer"),S=E.ORIENTATIONVIEWER.NAME;return m=Object.assign({},D,m),p=function(e,t,r){var n,i,o=Math.max(100*r/t-1,-.85),a=2*(e-60*r)/e-1,s=Math.max(200*r/t-1,-.85);switch(m.position){case"top-left":n=-a,i=-o;break;case"top-right":default:n=a,i=-o;break;case"bottom-left":n=-a,i=s;break;case"bottom-right":n=a,i=s}return{x:n,y:i}},f=function(e,t){var n=v.currentViewpoint.robotCameraOrtho,i=new r.Vector3(e,t,0);return(new r.Projector).unprojectVector(i,n),(new r.Matrix4).setPosition(i)},h=function(){var e,t;w.onViewpointChange(),e=p(v.canvas.width,v.canvas.height,v.devicePixelRatio),t=f(e.x,e.y),d.setMatrix(t)},d=new n({name:S}),u=new i("ModelNode"),d.setVisibility(m.defaultDisplay),d.setPickable(o.PICKTHROUGH),d.setCameraName("robotCameraOrtho"),d.setRenderPasses(["robotOrtho"]),d.addChild(u),w.robotRoot.addChild(d),g=P.subscribe(P.events.onViewPointMove,(function(){h()})),{setNodeVisibility:function(e){d.setVisibility(e),d.setRatio(c),v.render()},loadModel:function(){var n=t.getWebappsAssetUrl(m.model.module,m.model.assetsPath);if(!e.is(n,"string"))throw"Asset URL not found for model"+m.model;s.getEnoPadviewer().getFrameWindow().onViewerModelLoaded((function(){var e=u.getBoundingSphere().center;u.setMatrix((new r.Matrix4).setPosition(new r.Vector3(-e.x,-e.y,-e.z))),c=64/u.getBoundingSphere().radius*m.ratio,d.setRatio(c)})),s.getEnoPadviewer().getFrameWindow().getModelLoader().loadModel(n,u)},destroy:function(){g&&P.unSubscribe(g),w&&w.robotRoot&&w.robotRoot.removeChild(d),m=v=w=d=u=P=E=S=g=null}}}})),define("DS/DEL3DViewer/NodeUtil",["UWA/Core","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/DELWebViewerWorkInstructionCommon/Utils/WKINodeUtils"],(function(e,t,r){"use strict";const n=Object.freeze({PROCESS:"PROCESS",RESOURCE:"RESOURCE",PRODUCT:"PRODUCT",MBOM:"MBOM"});let i=Object.assign({},t,r);return i.getPathsFromNode=function(e){var t,r,n,i=this,o=[],a=[],s=function(e){return(e=e||[]).filter((function(e){return!(!e||!i.getNodeID(e))&&(e.getNotAllowedInPathElement?!e.getNotAllowedInPathElement():!e.notAllowedInPathElement)}))};if(e)for(o.push([e]);o.length>0;)(n=(t=o.shift())[0]?t[0].getParents():null)&&(0===n.length&&a.push(s(t).map((function(e){return i.getNodeID(e)}))),n.forEach((function(e){(r=t.slice()).unshift(e),o.push(r)})));return a},i.getLeafID=function(e){var t,r,n=null;if(e){for(t=e;t&&!this.isPLMNode(t.getLastElement(!0));)t=t.getParentPath();r=t.getLastElement(!0),n=this.getNodeID(r)}return n},i.isRootMBOM=function(e){let t=this.getRootReferences(e.getLastElement())[0],r=t&&t.getUserData?t.getUserData():null;return!(!r||!r.pprType||r.pprType!==n.MBOM)},i.updateUserData=function(e,t){if(e){let r=e.getUserData()||{};Object.assign(r,t),e.setUserData(r)}},i.collect3DShapePaths=function(e,t=[],r){if(e){let n=e.getChildren()||[];t.push(e.getReferenceId()),e.isRepRef()?r.push([...t]):n.forEach((function(e){let n=e.getReferenceIterator();i.collect3DShapePaths(n,[...t,e.getInstanceId()],r)}))}},i.getLeafIdsFromPaths=function(t){let r=[];return e.is(t,"array")&&(r=t.map((e=>e[e.length-1])).filter(((e,t,r)=>r.indexOf(e)===t))),r},i.isCustomNode=function(e){let t=e.getUserData(),r=!1;return t&&t.custom&&(r=!0),r},i.nodeHasCustomNode=function(e){let t,r=!1;return e&&(t=e.getChildren(),t&&t.length>0&&(r=t.some(i.isCustomNode))),r},i.getPathFromPathElement=function(e){let t=[];if(e.externalPath&&e.externalPath.length)for(let r=0;r<e.externalPath.length;r++){let n=e.externalPath[r].getModelIdentification();n&&t.push(n)}return t},i})),define("DS/DEL3DViewer/commands/DELViewerRightSidePanel",["DS/ENOPAD3DViewer/commands/PAD3DViewerRightSidePanel","DS/DEL3DViewer/NodeUtil"],(function(e,t){"use strict";const r="DELFmiProcessImplementCnx",n="DELFmiProcessOutputPrereqMaterializationCnx",i="VPMReference",o="Requirement",a="GeometricalRequirement_Inst";return e.extend({getParentNodeType:function(e){return t.getNodeType(e.pathElement.getParentPath().getLastElement())},getRelationID:function(e){var s,l,d,u=e.pathElement;if(e.type!==i||this.getParentNodeType(e)!==r&&this.getParentNodeType(e)!==n)if(e.type===o||e.type===a)s=t.getNodeID(e.pathElement.getLastElement());else{for(;u&&!t.isPLMNode(u.getLastElement(!0));)u=u.getParentPath();u&&(l=u.getLastElement(!0),t.isInstance(l)?s=t.getNodeID(l):(d=u.getParentPath().getLastElement(!0),s=t.getNodeID(d)))}else s=t.getNodeID(e.pathElement.getLastElement());return s}})})),define("DS/DEL3DViewer/ColoringBehavior",["UWA/Core","DS/Visualization/ThreeJS_DS","DS/SceneGraphOverrides/SceneGraphOverrideSet","DS/ENOPAD3DViewer/utils/PAD3DViewerVisuServices","DS/DEL3DViewer/NodeUtil","DS/Visualization/IdPath"],(function(e,t,r,n,i,o){"use strict";return function(a,s){let l;var d,u,g,c,h,p,f,m,v,w,P=s.getOption("logger"),E=a.getWebGLViewer(),D={},S=s.getOption("mappingKeys");return P.info("ColoringBehavior initialized"),u=function(e,t){var n=E.getSceneGraphOverrideSetManager();d=a.getEnoPadController().getRootBag(),D[e]=t?new r(d,a.getEnoPadController().getRootBagId(),!0,void 0,void 0,{mode:r.forceShow}):new r(d,a.getEnoPadController().getRootBagId(),!0),D[e].name=e,n.pushSceneGraphOverrideSet(D[e])},w=function(e){let t=E.getSceneGraphOverrideSetManager(),r=D[e];r&&(t.removeSceneGraphOverrideSet(r),t.pushSceneGraphOverrideSet(r))},h=function(e){var r,n,i=[];return e&&(12===(r=e.split(",")).length?(n=[parseFloat(r[0]),parseFloat(r[3]),parseFloat(r[6]),parseFloat(r[1]),parseFloat(r[4]),parseFloat(r[7]),parseFloat(r[2]),parseFloat(r[5]),parseFloat(r[8])],i=(new t.Matrix4).setRotation(n).setPosition(new t.Vector3(parseFloat(r[9]),parseFloat(r[10]),parseFloat(r[11])))):P.info("Postion elements length is not equal to 12")),i},v=function(e){var r,n=new t.Vector3(0,0,0),i=new t.Vector3(0,0,0),o=new t.Vector3(0,0,0),s=0,l=[];return e&&(l=a.getPathsFromInput(e))&&l.length>0&&(l.forEach((function(e,t){var r,o,s,l,d=a.getPathElement(e);d&&(r=d.getLastElement(!0).getBoundingBox().clone(),o=d.getWorldMatrix(),r&&(o&&r.applyMatrix4(o),s=r.min,l=r.max,0===t?(n.x=Math.min(s.x,l.x),n.y=Math.min(s.y,l.y),n.z=Math.min(s.z,l.z),i.x=Math.max(s.x,l.x),i.y=Math.max(s.y,l.y),i.z=Math.max(s.z,l.z)):(n.x=Math.min(Math.min(s.x,l.x),n.x),n.y=Math.min(Math.min(s.y,l.y),n.y),n.z=Math.min(Math.min(s.z,l.z),n.z),i.x=Math.max(Math.max(s.x,l.x),i.x),i.y=Math.max(Math.max(s.y,l.y),i.y),i.z=Math.max(Math.max(s.z,l.z),i.z))))})),s=Math.sqrt(Math.pow(i.x-n.x,2)+Math.pow(i.y-n.y,2)+Math.pow(i.z-n.z,2))/2,o.add(n).add(i),o.divideScalar(2),r=new t.Sphere(o,s)),r},p=function(t,r,n=!1,i){var s,l=t.path,d=function(t){var r,n=a.getEnoPadController().getRootBagId()||"rootBag";return e.is(t,"array")&&((r=t.slice())[0]!==n&&r.unshift(n),r=new o(r)),r};if(e.is(l,"array"))if(D[r]||u(r,i||!1),!0===n){let e=a.getPathElementV2(l);e&&((s=D[r].getUniqueOverrideFromPathElement(e))||(s=D[r].createOverride(e)))}else(s=D[r].getUniqueOverrideFromIdPath(d(l)))||(s=D[r].createIdPathOverride({idPathes:[d(l)]}));return s},g=function(r,n){var i,o=r.color;if(e.is(n,"object")){if(!o)return void(null===o&&n.setColor(o,!0));(i=new t.Color).setRGB(parseInt(o.R)/255,parseInt(o.G)/255,parseInt(o.B)/255),n.setColor("#"+i.getHexString(),!0)}},c=function(t,r){var n,i=t.position;if(e.is(r,"object")&&t.path){if(!i)return void(null===i&&r.setPosition(i));n=h(t.position),e.is(n,"object")&&r.setPosition(n)}},f=function(t,r,n){var i,o;e.is(t,"object")&&t.path&&(o=m(t.path),(i=p({path:o},r,t.usePathElement,n))?(g({color:t.color},i),null===t.opacity?i.resetOpacity():e.is(t.opacity,"number")&&i.setOpacity(parseInt(t.opacity)/255,!0),null===t.visibility?i.setVisibility(null):e.is(t.visibility,"boolean")&&i.setVisibility(t.visibility),null===t.visibilityFree?i.setVisibilityFree(null):e.is(t.visibilityFree,"boolean")&&i.setVisibilityFree(t.visibilityFree),c({path:o,position:t.position},i)):P.error(`No override found for the path ${o}`))},m=function(t){return e.is(t,"array")&&t.length>1&&t.length%2==1?t.slice(0,-1):t},a.getEnoPadviewer().subscribe({event:"onEndRootRemoved"},(function(t={}){if(P.debug(`Event:onEndRootRemoved event received with ids ${JSON.stringify(t.ids)}`),D&&e.is(t.ids,"array")&&t.ids.length>0){let e=t.ids;Object.keys(D).forEach((t=>{let r,n=D[t],i=function(t,r){r&&e.includes(r)&&n.deleteOverride(t)};n&&(r=n.getOverrides()||[],r.forEach((e=>{!function(e){(e.getIdPathes()||[]).forEach((t=>{i(e,t.getElement(1))}))}(e),function(e){(e.getPathes()||[]).forEach((t=>{let r=t.getElement(1,!0);r&&i(e,r.getModelIdentification())}))}(e)})))}))}})),l={setGraphicProperties:function(t,r,n){var o=[];return P.info("ColoringBehavior::setGraphicProperties API invoked with parameters : %o",t),new e.Promise((function(l,d){new e.Promise((function(l,d){try{t&&e.is(t.graphicProperties,"array")&&t.graphicProperties.length>0&&r?(t.graphicProperties.forEach((function(t){var s;e.is(t.path,"array")&&t.path.length>0?f(t,r,n):t.id&&(s=i.getPathsFromNode(a.getNode({id:t.id})))&&s.length>0?s.forEach((function(n){f(e.merge({path:n},t),r)})):o.push(t)})),t&&t.force&&w(r),o.length>0?d(s.getNLSValue("Error.PathFormatInvalid.Message")):l()):d(s.getNLSValue("Error.InvalidInput.Message"))}catch(e){d(e)}})).then(l).fail(d)}))},removeGraphicProperties:function(t,r){var n,o=[],l=function(){var l=function(t){var i;e.is(t.properties,"array")&&t.properties.length>0&&(i=m(t.path),n=p({path:i},r,t.usePathElement),t.properties.forEach((function(e){switch(e){case S.GRAPHICPROPERTIES.COLOR:n.setColor(null);break;case S.GRAPHICPROPERTIES.OPACITY:n.resetOpacity();break;case S.GRAPHICPROPERTIES.POSITION:n.setPosition(null);break;case S.GRAPHICPROPERTIES.VISIBILITY:n.setVisibility(null);break;case S.GRAPHICPROPERTIES.VISIBILITYFREE:n.setVisibilityFree(null);break;case S.GRAPHICPROPERTIES.ALL:D[r].deleteOverride(n)}})))};return new e.Promise((function(n,d){try{t&&e.is(t.graphicProperties,"array")&&t.graphicProperties.length>0&&r?(t.graphicProperties.forEach((function(t){var r;e.is(t.path,"array")&&t.path.length>0?l(t):t.id&&(r=i.getPathsFromNode(a.getNode({id:t.id})))&&r.length>0?r.forEach((function(r){l(e.merge({path:r},t))})):o.push(t)})),o.length>0?d("Invalid Paths"):n()):d(s.getNLSValue("Error.InvalidInput.Message"))}catch(e){d(e)}}))};return P.info("ColoringBehavior::removeGraphic API invoked with parameters : %o",t),new e.Promise((function(t,n){new e.Promise((function(t,n){e.is(D[r])?t():n(s.getNLSValue("Error.SceneGraphOverrideSetNotFound.Message"))})).then(l).then(t).fail(n)}))},removeSceneGraphOverrideSet:function(t){var r=E.getSceneGraphOverrideSetManager();e.is(D[t])&&(r.removeSceneGraphOverrideSet(D[t]),D[t]=null)},getGraphicPropertiesEnum:function(){return S.GRAPHICPROPERTIES},setReframe:function(t){var r;return new e.Promise((function(e,n){if(P.debug("ColoringBehavior::setReframe method invoked with parameters : ",t),P.log("setReframe is deprecated, please use reframeOn instead"),t&&!(r=t.BS?t.BS:v(t)))return P.error("ColoringBehavior::reframe method failed due to invalid input "),void n(s.getNLSValue("Error.InvalidInput.Message"));a.reframe(r),e()}))},reframeOn:async function(t){let r,o,l,d=a.getEnoPadviewer(),u=a.getEnoPadController();if(P.debug(`ColoringBehavior::reframeOn method invoked with parameters : ${JSON.stringify(t)}`),t){if(!(t.path||t.BS||t.id))throw P.error("ColoringBehavior::reframeOn method failed due to invalid input, please check the input params"),new Error(s.getNLSValue("Error.InvalidInput.Message"));o={viewpoint:d.getViewpoint(),context:d},t.BS?n.reframeOnCandidates({BS:t.BS,...o}):(l=await async function(t){let n=[],o=[];return e.is(t)&&(t.forEach((e=>{let t=a.getPathElement(e);t?n.push(t):o.push(e)})),o.length>0&&await new Promise((function(e,t){u.expand({paths:o,withFrustumFilter:!1,expand_tier:"0",singleAdd:!1,onComplete:function(){r={ids:i.getLeafIdsFromPaths(o)},u.lockNodes(r),o.forEach((function(e){let t=a.getPathElement(e);t&&n.push(t)})),e()},onFailure:t},!0,!1)}))),n}(a.getPathsFromInputV2(t)),e.is(l,"array")&&l.length>0?n.reframeOnCandidates({paths:l,...o}):P.log("No path element found to reframe"),r&&u.unlockNodes(r))}else a.reframe()},setViewPoint:function(t){var r={};return P.debug("ColoringBehavior::setViewPoint event received with parameters :",t),new e.Promise((function(e,n){t?(t.eyePosition&&(r.eyePosition=t.eyePosition),t.orientation&&(r.orientation=t.orientation),t.targetDistance&&(r.distanceToTarget=t.targetDistance),r.duration=t.duration?t.duration:100,a.getEnoPadviewer().getViewpoint().moveTo(r),e()):(P.error("ColoringBehavior::setViewPoint method failed due to invalid input "),n(s.getNLSValue("Error.InvalidInput.Message")))}))},getViewPoint:function(){return P.debug("ColoringBehavior::getViewPoint event received with parameters :"),new e.Promise((function(e,t){var r={},n=a.getEnoPadviewer().getViewpoint();n?(r.eyePosition=n.getEyePosition(),r.orientation=n.control.orientation,r.targetDistance=n.getTargetDistance(),e({viewpoint:r})):(P.error("ColoringBehavior::getViewPoint method failed due to camera view point is not found"),t(s.getNLSValue("Error.ViewPointNotFound.Message")))}))},getBoundingBox:function(t){return P.debug("ColoringBehavior::getBoundingBox event received with parameters :",t),new e.Promise((function(e,r){var n,i,o,l,d=a.getPathsFromInput(t),u=[];if(d&&d.length>0)for(n of d){if(!(i=a.getPathElement(n))){P.error("ColoringBehavior::getBoundingBox method failed due to - unable to get pathElement from path",n),l="Error.InvalidInput.Message";break}if(!(o=i.getLastElement(!0).getBoundingBox())){P.error("ColoringBehavior::getBoundingBox method failed due to - unable to get bounding box from pathElement",i),l="Error.InvalidInput.Message";break}u.push({path:n,boundingBox:o.clone()})}else P.error("ColoringBehavior::getBoundingBox method failed due to invalid input "),l="Error.InvalidInput.Message";l?r(s.getNLSValue(l)):e(u)}))},getOverrides:function(e){let t=D[e],r=[];return t&&(r=t.getOverrides()),r},deleteOverrides:function(e){let t=D[e];t&&t.deleteOverrides(l.getOverrides(e))},getOverride:function(e,t,r=!1){return p({path:m(e)},t,r)},destroy:function(){for(let e in D)D.hasOwnProperty(e)&&this.removeSceneGraphOverrideSet(e);D={},d=P=E=d=u=g=c=h=p=f=null,m=v=S=null}},l}})),define("DS/DEL3DViewer/ToggleBehavior",["UWA/Core","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/Selection/PSOManager","DS/DELWebViewerPerformaceLogger/PerformaceLogger","DS/DEL3DViewer/NodeUtil"],(function(e,t,r,n,i,o){"use strict";return function(i,a){a.getOption("mappingKeys");var s,l=a.getOption("logger"),d=a.getOption("eventCollection").getViewerCtrlEventHnd(),u=function(t){var r=[],n=i.getPathsFromInput(t);return e.is(n,"array")&&n.forEach((function(e){var t=i.getPathElement(e);t?r.push({pathElement:t}):l.debug("Unable to get the pathElement for the path ",e)})),r},g=function(t,r){return new e.Promise((function(n,i){var o=!(!r||!e.is(r.clear,"boolean"))&&r.clear,s=r&&e.is(r.highlight,"boolean")?r.highlight:null,l=r.pathElements?r.pathElements:u(r);null!==s?(t.options.fromAPI=!0,o&&s&&t.empty(),e.is(l,"array")&&l.length>0&&(s?t.add(l):t.remove(l)),delete t.options.fromAPI,n()):i(a.getNLSValue("Error.InvalidInput.Message"))}))};return l.info("ToggleBehavior initialized"),{removeRoots:function(t){var r,n,s=[];return t=t||{},l.info("ToggleBehavior::removeRoots API invoked with parameters : %o",t),new e.Promise((function(u,g){if(e.is(t.pids,"array")){if(0===(s=t.pids.slice()).length&&(r=i.getRootBag(),e.is(r)&&(r.getChildren().forEach((function(e){s.push(o.getNodeID(e))})),0===s.length)))return void u();n=i.getEnoPadController().getModelEvents().subscribe({event:"onEndRootRemoved"},(function(t){e.equals(t.ids,s)&&(d.publish(d.events.onRemoveRootsComplete,t),i.getEnoPadController().getModelEvents().unsubscribe(n),u())})),i.getEnoPadviewer().removeRoots({pids:s})}else l.error("ToggleBehavior::removeRoots API input is invalid"),g(a.getNLSValue("Error.InvalidInput.Message"))}))},selectNode:function(n){return new e.Promise((function(i,o){var s=!(!n||!e.is(n.clear,"boolean"))&&n.clear,l=n&&e.is(n.select,"boolean")?n.select:null,d=n.pathElements?n.pathElements:u(n);null!==l?(t.options.fromAPI=!0,s&&l&&(t.empty(),r.empty()),e.is(d,"array")&&d.length>0&&(l?t.add(d):t.remove(d),l?r.add(d):r.remove(d)),delete t.options.fromAPI,i()):o(a.getNLSValue("Error.InvalidInput.Message"))}))},highlightNode:function(e){return g(r,e).then((function(){d.publish(d.events.onHighlightComplete,e)}))},preHighlightNode:function(e){return g(n,e)},destroy:function(){s&&(i.getEnoPadviewer().unsubscribe(s),s=null),l=d=null}}}})),define("DS/DEL3DViewer/HideShowBehavior",["DS/DELWebViewerUtils/DELWebViewerSettingsMgt","DS/DEL3DViewer/NodeUtil"],(function(e,t){"use strict";return function(r,n,i){const o=i.getOption("mappingKeys");let a;var s=i.getOption("logger"),l=i.getOption("eventCollection").getViewerCtrlEventHnd(),d=async function(e,t,r=!1){let i=n.getGraphicPropertiesEnum().VISIBILITY,a=[];e&&e.length>0&&(e.forEach((e=>{a.push({path:e,[i]:t,usePathElement:r})})),await n.setGraphicProperties({graphicProperties:a,force:!0},o.SCENEGRAPHKEYS.PUBLIC))},u=function(e){let t={total:0,hidden:0};return r.getShapePaths(e).forEach((e=>{let r=n.getOverride(e,o.SCENEGRAPHKEYS.PUBLIC);t.total++,r&&!1===r.getVisibility()&&t.hidden++})),t.hidden>0&&t.total!==t.hidden},g=async function(n,i){let a=r.getPathsFromInput(n),g=r.getPickability(),c=[],h=[],p=[],f={},m=[],v=function(e,t){e.find((e=>e===t))||e.push(t)};a&&a.length>0?(g!==o.PICKABILITY.ITEM&&g!==o.PICKABILITY.BUILDUP?a.forEach((n=>{let i=function(n){let i=function(t){return e.getDELViewerSetting("itemProductConnectionTypes").includes(r.getType(t.getInstanceId()))},o=[];for(let e=0;e<n.length;e+=2){let a=r.createRefIterator(n[e]);if(!a)break;if(a.getChildren().some(i)||t.nodeHasCustomNode(a.getNode())){o=n.slice(0,e+1);break}}return o}(n);if(n.length>=i.length&&0!==i.length){let e=r.getShapePaths(n);0===e.length&&c.push(n),c=[...c,...e],n.length>i.length?(h.push(i),0===e.length?(m.push(n),f[n[n.length-1]]={isCustom:!0}):v(p,i)):(f[i[i.length-1]]={isPartial:!1},v(p,i))}else c.push(n)})):c=a,await d(c,i),h.forEach((e=>{let t=u(e);f[e[e.length-1]]={isPartial:t}})),p.forEach((e=>{if(!u(e)){let n=function(e){let n=r.getNodeFromPath(e),i=[];n&&t.nodeHasCustomNode(n)&&n.getChildren().filter(t.isCustomNode).forEach((r=>{let n=[...e,r.getModelIdentification()];r.getChildren().forEach((e=>{t.isCustomNode(e)&&e.getModelIdentification()&&i.push([...n,e.getModelIdentification()])}))}));return i}(e);m=[...m,...n]}})),await d(m,i,!0),r.getWebGLViewer().render(),l.publish(!1===i?l.events.onHideNode:l.events.onShowNode,[{paths:a,attributes:f}])):s.warn("No paths found to update")};return a={hideNode:async function(e){g(e,!1)},showNode:async function(e){g(e,null)},updateRootsVisibility:function(e){r.getEnoPadviewer().getRoots().forEach((t=>t.setVisibility(e)))},toggleNodeVisibility:async function(e){let t=r.getPathsFromInput(e),n=[],i=[];t.forEach((e=>{let t=a.getCurrentVisibility(e);null===t||t?n.push(e):i.push(e)})),i.length>0&&a.showNode({path:i}),n.length>0&&a.hideNode({path:n})},reset:function(){let e=n.getOverrides(o.SCENEGRAPHKEYS.PUBLIC);e&&e.forEach((e=>{e.setVisibility(null)}))},getCurrentVisibility:function(e){let t=n.getOverride(e,o.SCENEGRAPHKEYS.PUBLIC),r=!0;return t&&!1===t.getVisibility()&&(r=!1),r},destroy:function(){s=l=null}},a}})),define("DS/DEL3DViewer/BaseViewer",["UWA/Core","DS/ENOPAD3DViewer/PAD3DViewer","DS/Visualization/ThreeJS_DS","DS/Mesh/MeshUtils","DS/Visualization/Node3D","DS/SceneGraphNodes/FixedSizeArrowNode","DS/Visualization/LoaderUtils","DS/DEL3DViewer/NodeUtil","DS/DEL3DViewer/CGRHelper"],(function(e,t,r,n,i,o,a,s,l){"use strict";return function(d,u){const g=u.getOption("mappingKeys");var c,h,p=u.getOption("logger"),f=d||{},m=new e.Element("div",{id:"delmia_3d_viewer",class:"delmia-3d-viewer"});try{c=new t(f,u)}catch(e){p.error("DELPAD3DViewer initialization failed due to : %o",e)}return h={getViewerElement:function(){return m},render:function(){return c.render().inject(m)},getEnoPadController:function(){return c.getController()},getEnoPadviewer:function(){return c},getEnoPadModelEvents:function(){return this.getEnoPadController().getModelEvents()},getRootBag:function(){var e,t;return c&&(t=c.getRootBagPath())&&(e=t.getLastElement()),e},getNode:function(e){return this.getEnoPadController().getNode(e)},getWebGLViewer:function(){return c.getViewer()},reframe:function(e){return c.reframe(e)},isRegistered:function(t){var r,n,i=!1;if(e.is(t,"array")&&t.length>=1)for(n=t.length,i=!0,r=0;r<n;r=0===r?1:r+2)if(!this.getEnoPadController().isRegistered(t[r])){i=!1;break}return i},getPathElement:function(t){var r;return p.debug("BaseViewer::getPathElement API is invoked with parameters : %o",t),e.is(t,"array")&&t.length>=1&&(r=c.unstreamPath(t)),r},getPath:function(e){var t=[];return e&&(t=c.streamPath(e)),t},getPathWithType:function(e){var t=[],r={};return e&&c.streamPathWithType(e,t,r),{paths:t,attributes:r}},search:function(e){c.search(e)},refresh:function(){c.refresh()},destroy:function(){[c,m].forEach((e=>{e&&e.destroy()})),p=f=c=m=null},createNode:function(e){var t,n,o,a,s=new i(e.id);return s.setModelIdentification(e.id),s.setUserData({type:e.type,custom:!0}),s.setMatrix((t=e.matrix,a=null,t&&12===(n=t.split(",")).length&&(o=[parseFloat(n[0]),parseFloat(n[3]),parseFloat(n[6]),parseFloat(n[1]),parseFloat(n[4]),parseFloat(n[7]),parseFloat(n[2]),parseFloat(n[5]),parseFloat(n[8])],a=(new r.Matrix4).setRotation(o).setPosition(new r.Vector3(parseFloat(n[9]),parseFloat(n[10]),parseFloat(n[11])))),a)),s.setNodeUsage(e.usage),s},createArrowNode:function(t){return t.color&&e.is(t.color.R,"number")&&e.is(t.color.G,"number")&&e.is(t.color.B,"number")&&(t.color=new n.Color(t.color.R,t.color.G,t.color.B)),new o(t)},addVisualizationToNode:function(e,t,r){e&&t&&a.processData([e],l.decodeRep(t,{processText:!1,withBlankingRep:!0}),null,!0,r)},getRoots:function(){return h.getEnoPadviewer().getRoots()},getNodeFromPath:function(e){let t=h.getRoots().find((t=>t.getModelIdentification()===e[0]));if(t)for(let r=1;r<e.length;r++)t&&(t=t.getChildren().find((t=>t.getModelIdentification()===e[r])));return t},getPathsFromInput:function(e){var t=[];return e&&(t=e.path&&e.path.length>0?Array.isArray(e.path[0])?e.path:[e.path]:e.id?s.getPathsFromNode(h.getNode({id:e.id})):[]),t},createRefIterator:function(e){return h.getEnoPadController().createReferenceIterator(e)},getIdPathesLeadingToReference:function(e){return h.getEnoPadController().getIdPathesLeadingToReference(e)},getShapePaths:function(e){let t=e.length-1,r=h.createRefIterator(e[t]),n=[];return s.collect3DShapePaths(r,e.slice(0,t),n),n},getType:function(e){return(h.getEnoPadController().getUserData({id:e})||{}).type},getPathElementV2:function(t){let r=c.getRootBagPath();if(e.is(t,"array"))for(let e=0;e<t.length;e++){let n=h.getNodeFromPath(t.slice(0,e+1));if(!n){p.debug(`Unable to find the node for the id ${t[e]}`),p.warn(`Unable to find the path element for path ${t}`),r=null;break}r.addElement(n)}return r},setPickability:function(e){!function(e){return Object.values(g.PICKABILITY).some((t=>t===e))}(e)?p.error("Invalid pickability value, please check MAPPINGKEYS.PICKABILITY"):u.setOption(g.OPTIONS.CURRENTPICKABILITY,e===g.PICKABILITY.DEFAULT?u.getOption(g.OPTIONS.DEFAULTPICKABILITY):e)},getPickability:function(){let e=u.getOption(g.OPTIONS.CURRENTPICKABILITY);return e||(e=u.getOption(g.OPTIONS.DEFAULTPICKABILITY)),e},getPathsFromInputV2:function(t){var r=[];if(t)if(t.path&&t.path.length>0)r=Array.isArray(t.path[0])?t.path:[t.path];else if(t.id){let n=h.getIdPathesLeadingToReference(t.id);e.is(n,"array")&&(r=n.map((e=>e.ids)))}return r}}}})),define("DS/DEL3DViewer/Viewer",["UWA/Core","DS/ApplicationFrame/CommandsManager","DS/DEL3DViewer/BaseViewer","DS/DEL3DViewer/ToggleBehavior","DS/DEL3DViewer/ColoringBehavior","DS/DEL3DViewer/HideShowBehavior","DS/DEL3DViewer/ToolBar","DS/DELWebUiComponent/ControlFactory","DS/DELWebViewerUtils/DELWebViewerSettingsMgt","css!DS/DEL3DViewer/assets/css/DEL3DViewer.css"],(function(e,t,r,n,i,o,a,s,l){"use strict";return function(d,u){var g,c,h,p,f,m,v,w,P,E,D,S,b=d.getOption("logger"),I=d.getOption("loggerSeverity"),V=d.getOption("showLevelSelectorLabel"),y=d.getOption("eventCollection").getViewerCtrlEventHnd(),O=d.getOption("mappingKeys"),C=l.getSetting("padViewerSettings");if(h=-1!==["debug"].indexOf(I.toLowerCase())?C.actionBarWkb.debugViewer:2===d.getOption("viewerType")?C.actionBarWkb.workInstructionViewer:C.actionBarWkb.standard,C.enopad3dviewer.layout_options.frmWindow_opts.workbench=h.file,C.enopad3dviewer.layout_options.frmWindow_opts.workbenchModule=h.module,E=d.getOption("viewerOptions"),e.is(E)){if(E.delviewer&&E.delviewer.run_options&&E.delviewer.run_options.propertiesFacet&&e.is(E.delviewer.run_options.propertiesFacet.value,"array")){let e=C.enopad3dviewer.run_options.propertiesFacet,t=E.delviewer.run_options.propertiesFacet;t.value=t.value.concat(e.value)}e.extend(C.enopad3dviewer,E.delviewer,!0)}l.setApp(C,"enopad3dviewer"),e.is(d.getOption("sharedSettings"),"array")&&(l.addSharedSettings(d.getOption("sharedSettings")),widget.addEvent("endEdit",l.updateWidgetPreferences()),l.updateWidgetPreferences()()),f=l.getSetting("enopad3dviewer_selectiveLoading"),D=e.clone(l.getSetting("propertiesFacet")),p=Object.assign({},{widget:window.widget,windowOptions:C.enopad3dviewer.layout_options.frmWindow_opts,binaryPrimitives:!0,allowAuthoring:!1,authorizeSet3DStructure:!0,selectiveLoading:e.is(f,"boolean")?f:"true"===f,enableSidePanel:!0,propertiesFacet:D,visuProgressiveTileModel:!0},C.enopad3dviewer.options);try{g=new r(p,d),b.debug("BaseViewer initialized with options : %o",p)}catch(e){throw b.error("BaseViewer Initialization failed due to : %o",e),new Error("BaseViewer Initialization failed due to : %o",e)}return d.getOption("quickToolBar")&&(w=new a(d,g.getViewerElement())),E&&E.orientationViewer&&E.orientationViewer.enable&&require(["DS/DEL3DViewer/DELOrientationViewer"],(function(e){g&&(v=new e(g,d))})),P=function(t){return new e.Promise((function(r,n){e.is(t,"boolean")?e.is(v)?(v.setNodeVisibility(t),r()):n(d.getNLSValue("Error.OVNotInitialized.Message")):n(d.getNLSValue("Error.InvalidInput.Message"))}))},S=g.getWebGLViewer().currentViewpoint.onMove((function(){y.publish(y.events.onViewPointMove,this.orientation)})),m=g.getEnoPadviewer().subscribe({event:O.PADEVENTS.ONACTIONBARREADY},(function(r){if(g.getEnoPadviewer().unsubscribe(m),e.is(v))try{v.loadModel()}catch(e){b.error(e)}if(e.is(V,"boolean")&&V){let e=t.getCommand("LevelSelectorHdr");e?e.displayLabels(!0):g.getEnoPadviewer().getLevelSelectorCommand?(b.warn("Deprecated, No Level Selector Command is available in the xml, using ENOPAD Level Selector, this support will be removed in future"),g.getEnoPadviewer().getLevelSelectorCommand((function(e){e&&e.displayLabels(!0)}))):b.log("No Level Selector Command is available to display labels")}g.render(),u&&u(r)})),c=new i(g,d),{baseViewer:g,displayOrientationViewer:P,toolbar:w,toggleBehavior:new n(g,d),coloringBehavior:c,hideShowBehavior:new o(g,c,d),controlFactory:new s(g),destroy:function(){m&&g&&g.getEnoPadviewer().unsubscribe(m),S&&g&&g.getWebGLViewer().currentViewpoint.unsubscribe(S),this.coloringBehavior.destroy(),this.toggleBehavior.destroy(),this.controlFactory.destroy(),[v,g].forEach((e=>{e&&e.destroy()})),v=g=b=p=y=O=D=null,E=f=null,l.dispose()}}}})),define("DS/DEL3DViewer/ViewerInterface",["UWA/Core","DS/DEL3DViewer/Viewer"],(function(e,t){"use strict";return function(e,r,n){var i,o=e.getOption("logger"),a=e.getOption("mappingKeys");try{i=new t(e,r,n)}catch(e){o.error("Viewer initialization failed due to : %o",e)}return{getViewerElement:function(){return i.baseViewer.getViewerElement()},addRoots:function(e,t,r){return i.baseViewer.getEnoPadviewer().addRoots(e,t,r)},selectNode:function(e){return i.toggleBehavior.selectNode(e)},highlightNode:function(e){return i.toggleBehavior.highlightNode(e)},preHighlightNode:function(e){return i.toggleBehavior.preHighlightNode(e)},removeRoots:function(e){return i.toggleBehavior.removeRoots(e)},setGraphicProperties:function(e,t){return i.coloringBehavior.setGraphicProperties(e,t)},removeGraphicProperties:function(e,t){return i.coloringBehavior.removeGraphicProperties(e,t)},resetGraphicProperties:function(){Object.values(a.SCENEGRAPHKEYS).forEach((function(e){i.coloringBehavior.removeSceneGraphOverrideSet(e)}))},removeSceneGraphOverrideSet:function(e){i.coloringBehavior.removeSceneGraphOverrideSet(e)},render:function(){i.baseViewer.getWebGLViewer().render()},getGraphicPropertiesEnum:function(){return i.coloringBehavior.getGraphicPropertiesEnum()},getHideShowBehavior:function(){return i.hideShowBehavior},deleteOverrides:function(e){i.coloringBehavior.deleteOverrides(e)},getContext:function(){return i.baseViewer.getEnoPadviewer()},setAutomaticReframePolicy:function(e){this.getContext().setAutomaticReframePolicy(e)},getFrameWindow:function(){return i.baseViewer.getEnoPadviewer().getFrameWindow()},resetCameraOrientation:function(){i.baseViewer.getEnoPadviewer().getFrameWindow().getViewpoint().resetCameraOrientation()},isRegistered:function(e){return i.baseViewer.isRegistered(e)},getComponentPromise:function(e,t){return i.controlFactory.getComponentPromise(e,t)},setReframe:function(e){return i.coloringBehavior.setReframe(e)},setViewPoint:function(e){return i.coloringBehavior.setViewPoint(e)},getViewPoint:function(){return i.coloringBehavior.getViewPoint()},getBoundingBox:function(e){return i.coloringBehavior.getBoundingBox(e)},displayOrientationViewer:function(e){return i.displayOrientationViewer(e)},subscribe:function(e,t){return i.baseViewer.getEnoPadModelEvents().subscribe({event:e},t)},unSubscribe:function(e){i.baseViewer.getEnoPadModelEvents().unsubscribe(e)},getMode:function(){var t=e.getOption(a.OPTIONS.DEFAULTVIEWERMODE)?e.getOption(a.OPTIONS.DEFAULTVIEWERMODE):a.VIWERDEFAULTMODE;return e.getOption(a.OPTIONS.VIEWERMODE)?e.getOption(a.OPTIONS.VIEWERMODE):t},search:function(e){i.baseViewer.search(e)},getToolBar:function(){return i.toolbar},getRoots:function(){return i.baseViewer.getRoots()},refresh:function(){this.resetGraphicProperties(),i.baseViewer.refresh()},destroy:function(){i&&i.destroy(),i=o=a=null},createNode:function(e){return i.baseViewer.createNode(e)},addVisualizationToNode:function(e,t,r){i.baseViewer.addVisualizationToNode(e,t,r)},createArrowNode:function(e){return i.baseViewer.createArrowNode(e)},getNodeFromPath:function(e){return i.baseViewer.getNodeFromPath(e)},getNode:function(e){return i.baseViewer.getNode(e)},getPathElement:function(e){return i.baseViewer.getPathElement(e)},getRIRPath:function(e){return i.baseViewer.getPath(e)},getShapePaths:function(e){return i.baseViewer.getShapePaths(e)},getPathElementV2:function(e){return i.baseViewer.getPathElementV2(e)},getFilterSpec:function(e){return i.baseViewer.getEnoPadController().getBIProxy().getFilterSpec(e.id,{V2:{}})},getIdPathesLeadingToReference:function(e){return i.baseViewer.getIdPathesLeadingToReference(e)},setPickability:function(e){return i.baseViewer.setPickability(e)},getPickability:function(){return i.baseViewer.getPickability()},reframeOn:function(e){return i.coloringBehavior.reframeOn(e)},getPathWithType:function(e){return i.baseViewer.getPathWithType(e)},streamPathWithType:function(e,t,r){this.getContext().streamPathWithType(e,t,r)},streamPOI:function(e,t,r){this.getContext().streamPOI(e,t,r)},streamPOIGroup:function(e,t){this.getContext().streamPOIGroup(e,t)},streamZOI:function(e,t){this.getContext().streamZOI(e,t)}}}}));