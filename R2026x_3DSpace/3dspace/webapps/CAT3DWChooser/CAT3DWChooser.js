define("DS/CAT3DWChooser/CAT3DWLoadServices",["UWA/Class"],(function(e){"use strict";var t=e.extend({init:function(e){t.prototype._onOpenFile=null,this._inputId="CAT3DWChooser-fileinput",document.getElementById(this._inputId)||this.createInputFile(),this._acceptAttributes="image/*",e&&e.acceptAttributes&&(this._acceptAttributes=e.acceptAttributes)},createInputFile:function(){var e=document.getElementsByClassName(this._inputId+"-class");if(e)for(var t=0;t<e.length;t++)e[t].parentElement.remove();new UWA.Element("div",{html:[{tag:"input",id:this._inputId,class:this._inputId+"-class",type:"file",styles:{visibility:"hidden",position:"absolute",left:"0px",top:"0px"},events:{change:this.openFile.bind(this)}}]}).inject(document.body)},openFileSelector:function(e){var i=document.getElementById(this._inputId);i.setAttribute("accept",this._acceptAttributes),t.prototype._onOpenFile=e,i.value=null,i.click()},openFile:function(e){if(e){var i=e.target.files;if(i&&i.length){var n=window.URL.createObjectURL(i[0]);t.prototype._onOpenFile(n,i[0])}else t.prototype._onOpenFile(null)}}});return t})),define("DS/CAT3DWChooser/CAT3DWImageGallery",["UWA/Core","UWA/Controls/Abstract","UWA/Json","WebappsUtils/WebappsUtils","text!DS/CAT3DWChooser/assets/gallerySettings.json","i18n!DS/CAT3DWChooser/assets/nls/CAT3DWImageGallery"],(function(e,t,i,n,a,s){"use strict";var o="variable";return t.singleton({init:function(){this._currentSection={},this._maxLength=8,this._settingsURL=null,this._initialPath="",this._currentPath=""},initProperties:function(){var t=JSON.parse(a),s=i.path(t,"$");s[0].sections.map((function(e){return e.thumbnails.forEach((function(t){t.sectionName=e.name,t.url=t.url?n.getWebappsAssetUrl("CAT3DWChooser",t.url):t.url})),e})),this._initialPath+=e.Json.encode(s),this._currentPath+=this._initialPath},getIDs:function(e){var t=i.decode(this._currentPath);return i.path(t[0],'$.sections[?(@.name=="'+e+'")].thumbnails..id')},getThumbnails:function(e){var t=i.decode(this._currentPath);return i.path(t[0],'$.sections[?(@.name=="'+e+'")].thumbnails..url')},addThumbnail:function(e,t){var n=i.decode(this._currentPath);if(this._currentSection=i.path(n[0],'$.sections[?(@.name=="'+e+'")]')[0],this._currentSection&&this._currentSection.type===o){var a=this._genId();return this._currentSection.thumbnails||(this._currentSection.thumbnails=[]),this._currentSection.thumbnails.unshift({id:a,url:t}),this._currentSection.thumbnails.length>this._maxLength&&this._currentSection.thumbnails.pop(),this._currentPath=i.encode(n),a}return!1},getThumbnailPropertiesByID:function(e){var t=i.decode(this._currentPath);return i.path(t[0],'$..properties[?(@.id=="'+e+'")]')[0]},getSectionTitle:function(e){return s.get(e)},isSectionSelected:function(e){var t=i.decode(this._currentPath);return i.path(t[0],'$.sections[?(@.name=="'+e+'")].selected')[0]},setSectionVisible:function(e,t){var n=i.decode(this._currentPath);this._currentSection=i.path(n[0],'$.sections[?(@.name=="'+e+'")]')[0],this._currentSection&&(this._currentSection.visible=t,this._currentPath=i.encode(n))},countVisibleSections:function(){if(""!==this._currentPath){var e=i.decode(this._currentPath);return i.path(e[0],"$.sections[?(@.visible==true)]").length}return 0},isSectionVisible:function(e){var t=i.decode(this._currentPath);return i.path(t[0],'$.sections[?(@.name=="'+e+'")].visible')[0]},getOnClickCB:function(e){var t=i.decode(this._currentPath);return i.path(t[0],'$.sections[?(@.name=="'+e+'")].onClick')[0]},getSectionsNames:function(){var e=i.decode(this._currentPath);return i.path(e[0],"$.sections..name")},reset:function(){this._currentPath="",this._currentPath+=this._initialPath},_genId:function(){var e=Date.now();return e+=Math.floor(10*Math.random())}})})),define("DS/CAT3DWChooser/CAT3DWCreateWBChoosePage",["UWA/Core","UWA/Promise","DS/CAT3DWInfra/CAT3DW3DSwymMediaServices","DS/CAT3DWLoaderLight/CAT3DWLoaderLight","DS/CAT3DWInfra/CAT3DWPlateformServices","DS/CAT3DWInfra/CAT3DWPreferenceManager","DS/CAT3DWInfraUI/CAT3DWPointerEvents","DS/UIKIT/Input/Button","DS/UIKIT/Mask","i18n!DS/CAT3DWChooser/assets/nls/CAT3DWDisplayUserMedia","i18n!DS/CAT3DWInfra/assets/nls/CAT3DWTooltip","DS/CAT3DWInfraUI/CAT3DWHandleErrors","text!DS/CAT3DWInfra/assets/rsc/MoodBoardTemplates.json","text!DS/CAT3DWInfra/assets/rsc/WhiteboardTemplates.json","DS/WebappsUtils/WebappsUtils","DS/CAT3DWInfra/CAT3DWFileServices"],(function(e,t,i,n,a,s,o,r,l,c,h,d,u,m,p,C){"use strict";var g=e.Class.extend({init:function(e){this.titleText=e.titleText||c.get("defaultTitle"),this.onChooseCallback=e.onChooseCallback||null,this.onDestroyCallback=e.onDestroyCallback||null,this.isCPTB=e.isCPTB||!1,this.isSketch=e.isSketch||!1,this.isWhiteboard=e.isWhiteboard||!1,this.isForwardPage=e.isForwardPage||!1,this.platformUrl=null,this.csrfToken=null,this.currentUser=null,this._communitiesList=[],this._conversationsList=[],this._communitiesCellUIMap=new Map,this._conversationsCellUIMap=new Map,this._personalSpace=null,this._selectionData=null,this.UIObject={mainContainer:e.body},this.platformId=s.getPreferenceValue("swymTenant"),this.moodBoardTemplates=JSON.parse(u).moodBoardTemplates,this.whiteboardTemplates=JSON.parse(m).whiteboardTemplates,this.whatToCreateData=null,this._fileServices=new C,this.registerMutationObserver(),this.startComponent()},registerMutationObserver:function(){const e=new MutationObserver((t=>{for(const i of t)for(const t of i.addedNodes)1===t.nodeType&&"CAT3DWCreateWBChoosePage"===t.getAttribute("id")&&(this.setMainContainerHeight(),e.disconnect())}));e.observe(document.body,{childList:!0,subtree:!0})},startComponent:function(){this.UIObject.mainContainer.setAttribute("id","CAT3DWCreateWBChoosePage"),!1===this.isSketch&&!1===this.isForwardPage&&this.createTemplatesPage(),this.createWhereToSavePage()},createTemplatesPage:function(){let e=document.createElement("div");e.setAttribute("id","templatesPage");let t=document.createElement("div");t.classList.add("fromScratchPart");let i=document.createElement("div");i.classList.add("templatePart"),e.append(t,i),this.createFromScratchComponent(),t.append(this.UIObject.fromScratchComponent),this.isWhiteboard?this.createTemplateComponentForWhiteboard():this.isCPTB&&this.createTemplateComponentForCPTB(),i.append(this.UIObject.templateComponent),this.UIObject.templatesPage=e,this.UIObject.mainContainer.append(this.UIObject.templatesPage)},setMainContainerHeight:function(){let e=document.getElementById("CAT3DWCreateWBChoosePage"),t=e.parentElement;e.style.height=window.innerHeight-t.getBoundingClientRect().top+"px"},createWhereToSavePage:function(){let e=document.createElement("div");if(e.setAttribute("id","whereToSavePage"),!1===this.isSketch&&!1===this.isForwardPage){e.style.display="none";let t=document.createElement("div");t.classList.add("whatToCreatePart"),e.append(t)}let t=document.createElement("div");t.classList.add("whereToSavePart"),e.append(t),this.createWhereToSaveComponent(),t.append(this.UIObject.whereToSaveComponent),this.UIObject.whereToSavePage=e,this.UIObject.mainContainer.append(this.UIObject.whereToSavePage)},createContentBox:function(e,t=null){let i=document.createElement("div");i.setAttribute("data-uid_po",`WB-ChoosePageTemplate-${e}`),i.setAttribute("title",e),i.classList.add("contentBox");let n=document.createElement("div");if(t){let e=document.createElement("img");e.setAttribute("src",t),n.append(e)}let a=document.createElement("div");return a.innerText=e,i.append(n,a),i},createTitleContainer:function(e){let t=document.createElement("div");return t.classList.add("title-container"),t.append(e),t},createComponent:function(e){let t=document.createElement("div");t.classList.add("component");let i=this.createTitleContainer(e.titleText);t.append(i);let n=document.createElement("div");return t.append(n),e.callbackToFillComponent(n),t},createFromScratchComponent:function(){let e=this.createComponent({titleText:c.get("titleForNonTemplatesSectionHomePage"),callbackToFillComponent:e=>{e.classList.add("gridContentContainer");let t=this.createContentBox("Start from scratch");if(e.append(t),t.addEventListener(o.POINTERHIT,(()=>{this.whatToCreateData={type:"blankCanvas"},this.whatToCreateContentBoxSelected=t.cloneNode(!0),this.onWhatToCreateSelected()})),localStorage.getItem("homePageR2VUnderVariableForLA")){let t=p.getWebappsAssetUrl("CAT3DWInfra","/placeholders/R2V_HomePage_Icon.png"),i=this.createContentBox("Transfer physical whiteboard",t);e.append(i),i.addEventListener(o.POINTERHIT,(()=>{this.whatToCreateData={type:"r2v"},this.whatToCreateContentBoxSelected=i.cloneNode(!0),this.onWhatToCreateSelected()}))}}});this.UIObject.fromScratchComponent=e},createTemplateComponentForWhiteboard:function(){let e=this.createComponent({titleText:c.get("titleForTemplatesSectionHomePage"),callbackToFillComponent:e=>{e.classList.add("gridContentContainer");for(let t of this.whiteboardTemplates){let i=p.getWebappsAssetUrl(t.templatePathModule,t.templateThumbnailPath),n=this.createContentBox(t.whiteboardTemplateName,i);e.append(n),n.addEventListener(o.POINTERHIT,(()=>{this.whatToCreateData={type:"template",data:p.getWebappsAssetUrl(t.templatePathModule,t.templatePath)},this.whatToCreateContentBoxSelected=n.cloneNode(!0),this.onWhatToCreateSelected()}))}}});this.UIObject.templateComponent=e},createTemplateComponentForCPTB:function(){let e=this.createComponent({titleText:c.get("titleForTemplatesSectionHomePage"),callbackToFillComponent:e=>{this.createTabsUI({container:e,tabs:[{title:c.get("moodboardTemplatesTabTitle"),tooltip:h.get("choosePageMoodboardTemplates"),dataUIDPO:"WB-ChoosePage-MoodboardTemplatesTabOption",isActive:!0,callback:e=>{i.style.display="none",t.removeAttribute("style")}},{title:c.get("whiteboardTemplatesTabTitle"),tooltip:h.get("choosePageWhiteboardTemplates"),dataUIDPO:"WB-ChoosePage-WhiteboardTemplatesTabOption",callback:e=>{t.style.display="none",i.removeAttribute("style")}}]});let t=document.createElement("div"),i=document.createElement("div");t.classList.add("gridContentContainer","isCPTBTemplateContainer"),i.classList.add("gridContentContainer","isCPTBTemplateContainer"),e.append(t,i),i.style.display="none";for(let e of this.moodBoardTemplates.concat(this.whiteboardTemplates)){let n=p.getWebappsAssetUrl(e.templatePathModule,e.templateThumbnailPath),a=this.createContentBox(e.whiteboardTemplateName||e.moodBoardtemplateName,n);e.whiteboardTemplateName?i.append(a):t.append(a),a.addEventListener(o.POINTERHIT,(()=>{this.whatToCreateData={type:"template",data:p.getWebappsAssetUrl(e.templatePathModule,e.templatePath)},this.whatToCreateContentBoxSelected=a.cloneNode(!0),this.onWhatToCreateSelected()}))}}});this.UIObject.templateComponent=e},onWhatToCreateSelected:function(){this.createWhatToCreateComponent(),this.UIObject.whereToSavePage.firstChild.append(this.UIObject.whatToCreateComponent),this.UIObject.templatesPage.style.display="none",this.UIObject.whereToSavePage.style.display="block",this.setCommConvContainerHeight()},createWhatToCreateComponent:function(){let e=this.createComponent({titleText:c.get("titleForSelectedTemplateHomePage"),callbackToFillComponent:e=>{e.classList.add("gridContentContainer"),e.append(this.whatToCreateContentBoxSelected)}});this.UIObject.whatToCreateComponent=e},createWhereToSaveComponent:function(){let e={titleText:c.get("titleForSaveSectionHomepage"),callbackToFillComponent:e=>{this._getPlateformData().then(this._getCurrentUser.bind(this)).then((()=>{this.createTabsUI({container:e,tabs:[{title:c.get("communityTabTitle"),tooltip:h.get("choosepageCommunity"),dataUIDPO:"WB-ChoosePage-CommunityTabOption",isActive:!0,callback:e=>{this.UIObject.communitiesContainer.classList.add("active"),this.UIObject.conversationsContainer.classList.remove("active"),this.UIObject.searchInput.setAttribute("placeholder",c.get("searchBarPlaceHolderForCommunity")),this.setCommConvContainerHeight(),this.UIObject.searchInput.value="",this._onSearchInput()}},{title:c.get("conversationTabTitle"),tooltip:h.get("choosepageConversation"),dataUIDPO:"WB-ChoosePage-ConversationTabOption",callback:e=>{this.UIObject.communitiesContainer.classList.remove("active"),this.UIObject.conversationsContainer.classList.add("active"),this.UIObject.searchInput.setAttribute("placeholder",c.get("searchBarPlaceHolderForConversation")),this.setCommConvContainerHeight(),this.UIObject.searchInput.value="",this._onSearchInput()}}]}),this.createSearchBarUI(e),this.createCommunityConversationDataContainers(e),this.createOkCancelButtonsContainer(e),this.subscribeToResizeEvent(),this.setCommConvContainerHeight(),this.showLoadingMask("communities"),this.showLoadingMask("conversations"),this.fetchAndFillCommunitiesData(),this.fetchAndFillConversationsData()}))}},t=this.createComponent(e);this.UIObject.whereToSaveComponent=t},createTabsUI:function(e){let t=document.createElement("div");t.classList.add("tabs-container"),e.container.append(t);for(let i of e.tabs){let{title:e="",tooltip:n="",callback:a=null,dataUIDPO:s="",isActive:r=!1}=i,l=document.createElement("div");l.innerText=e,l.classList.add("tab"),r&&l.classList.add("active"),l.setAttribute("data-uid_po",s),l.setAttribute("title",n),l.addEventListener(o.POINTERHIT,(e=>{t.childNodes.forEach((e=>e.classList.remove("active"))),l.classList.add("active"),a.prototype?a.bind(this)(e):a(e)})),t.append(l)}},showLoader:function(){n.show()},hideLoader:function(){n.hide()},showLoadingMask:function(e){this.UIObject&&("communities"===e&&this.UIObject.communitiesContainer?l.mask(this.UIObject.communitiesContainer,c.get("loadingMessageCommunities")):"conversations"===e&&this.UIObject.conversationsContainer&&l.mask(this.UIObject.conversationsContainer,c.get("loadingMessageConversations")))},hideLoadingMask:function(e){this.UIObject&&("communities"===e&&this.UIObject.communitiesContainer?l.unmask(this.UIObject.communitiesContainer):"conversations"===e&&this.UIObject.conversationsContainer&&l.unmask(this.UIObject.conversationsContainer))},fetchAndFillCommunitiesData:async function(){this._personalSpace=await this._getPersonalSpace(),this._communitiesList=await this._getCommunities(1),this.hideLoadingMask("communities"),this.fillPersonalSpaceInCommunitiesContainer(),this.fillCommunitiesContainer()},fetchAndFillConversationsData:async function(){this._conversationsList=await this._getConversations(),this.hideLoadingMask("conversations"),this.fillConversationsContainer()},_getPlateformData:function(){return new t(function(e){i.getPlatformUrl().then(a.getCsrfToken).then(function(t){this.platformUrl=t.url,this.csrfToken=t.token,e(t)}.bind(this)).catch((function(e){console.log(e)}))}.bind(this))},_getCurrentUser:function(){return new t(function(e){this.currentUser&&e(this.currentUser),a.getCurrentUser({url:this.platformUrl,token:this.csrfToken}).then(function(t){this.currentUser=t,e(this.currentUser)}.bind(this)).catch((function(e){console.log(e)}))}.bind(this))},_getCommunities:function(e,t=[]){return new Promise((i=>{(function e(t,n){this.platformId||this.platformUrl?a.getCommunities({url:this.platformUrl,token:this.csrfToken,limit:50,page:t}).then((a=>{for(var s=0;s<a.length;s++)n.push({label:a[s].title,id:a[s].id,subject6wuri:a[s].subject6wuri,logoUrl:`${this.platformUrl}/api/media/streammedia/model/community/model_id/${a[s].subject6wuri}/type/thumb/key/s_thumb`});if(50===n.length)t++,e.bind(this)(t,n);else{n.sort(((e,t)=>e.label>t.label?1:t.label>e.label?-1:0));let e=[];for(let t=0;t<n.length;t++)(0===t||e[e.length-1].id!==n[t].id)&&e.push(n[t]);i(e)}})).catch((function(){i([])})):i([])}).bind(this)(e,t)}))},_getConversations:function(){return new Promise((e=>{this.platformId||this.platformUrl?a.getConversations({url:this.platformUrl,token:this.csrfToken}).then(function(t){if(!t.length)return void e([]);let i=[];for(var n=0;n<t.length;n++){let a=this._getConversationName(t[n]),s=this._getConversationUsersUrl(t[n]);a&&i.push({label:a,subject6wuri:t[n].subject_uri,usersUrl:s}),i.length===t.length&&(i.sort(((e,t)=>e.label-t.label)),e(i))}}.bind(this)).catch((function(){e([])})):e([])}))},_getConversationName:function(e){var t=this.currentUser.login,i=e.topic;if(!i){i="";for(var n=0;n<e.users.length;n++)t.toLowerCase()!==e.users[n].login.toLowerCase()&&(i+=e.users[n].first_name+" "+e.users[n].last_name,n!==e.users.length-1&&(n===e.users.length-2&&t.toLowerCase()===e.users[n+1].login.toLowerCase()||(i+=", ")))}return i},_getConversationUsersUrl:function(e){var t=this.currentUser.login;return e.users.filter((e=>e.login!==t)).map((e=>`${this.platformUrl}/api/user/getpicture/login/${e.login}`))},_getPersonalSpace:function(){return new Promise((e=>{this.platformId||this.platformUrl?a.getPersonalSpace({url:this.platformUrl,token:this.csrfToken}).then((function(t){let{subject6wuri:i,id:n}=t.result;e({subject6wuri:i,id:n})})).catch((function(t){t&&e(null)})):e(null)}))},createSearchBarUI:function(e){let t=document.createElement("div");t.classList.add("search-bar");let i=document.createElement("input");i.setAttribute("data-uid_po","WB-ChoosePage-SearchInput"),i.setAttribute("placeholder",c.get("searchBarPlaceHolderForCommunity")),t.append(i),e.append(t);let n=this._debounce(this._onSearchInput,850);i.addEventListener("input",n),this.UIObject.searchInput=i},createCommunityConversationDataContainers:function(t){let i=e.createElement("div",{class:"data-container active"}).inject(t),n=e.createElement("div",{class:"data-container"}).inject(t);this.UIObject.communitiesContainer=i,this.UIObject.conversationsContainer=n},createOkCancelButtonsContainer:function(e){if(!0===this.isForwardPage){let i=document.createElement("div");i.classList.add("ok-cancel-btn-container"),this._okButton=new r({value:"Ok",className:"primary"}).inject(i),i.firstElementChild.setAttribute("data-uid_po","WB-ChoosePage-Ok-Btn"),i.firstElementChild.setAttribute("title",h.get("choosepageOkButton")),this._okButton.addEvent("onClick",(()=>{this.handleOkButtonClick()})),this._okButton.disable();var t=new r({value:"Cancel"}).inject(i);i.lastElementChild.setAttribute("data-uid_po","WB-ChoosePage-Cancel-Btn"),i.lastElementChild.setAttribute("title",h.get("choosepageCancelButton")),t.addEvent("onClick",(()=>{this.destroyUI()})),e.append(i),this.UIObject.okCancelButtonsContainer=i}},_onSearchInput:function(){let e=this.UIObject.communitiesContainer.classList.contains("active")?this._communitiesCellUIMap:this._conversationsCellUIMap,t=this.UIObject.communitiesContainer.classList.contains("active")?this.UIObject.communitiesContainer:this.UIObject.conversationsContainer,i=this.UIObject.communitiesContainer.classList.contains("active")?"community":"conversation",n=Array.from(e.entries()).map((e=>e[1])).filter((e=>{let t=e.innerText,i=this.UIObject.searchInput.value;return t.toLowerCase().includes(i.toLowerCase())||""===i}));0===n.length?""!==this.UIObject.searchInput.value&&(this.noResultsView(i),d.setGeneralErrorMessage(c.get("searchWhiteboardsNoResults"),"","",d.INFORMATION)):(t.innerText="",n.map((e=>{t.append(e)})))},noResultsView:function(e){let t=document.createElement("div");"conversation"===e?(t.setAttribute("title",c.get("noConversationFound")),t.innerText=c.get("noConversationFound"),t.classList.add("no-display-cell"),this.UIObject.conversationsContainer.innerText="",this.UIObject.conversationsContainer.appendChild(t)):"community"===e&&(t.setAttribute("title",c.get("noCommunityFound")),t.innerText=c.get("noCommunityFound"),t.classList.add("no-display-cell"),this.UIObject.communitiesContainer.innerText="",this.UIObject.communitiesContainer.appendChild(t))},fillPersonalSpaceInCommunitiesContainer:function(){if(!this.UIObject||!this.UIObject.communitiesContainer)return;this.UIObject.communitiesContainer.innerText="";let e=document.createElement("div");e.setAttribute("data-uid_po","WB-ChoosePage-PersonalSpace-Btn"),e.setAttribute("title","Personal Space"),e.classList.add("data-item");let t=document.createElement("span");t.classList.add("wux-ui-3ds","wux-ui-3ds-2x","wux-ui-3ds-user-feather","personal-space-logo"),e.appendChild(t);let i=document.createElement("span");i.innerText="Personal Space",e.appendChild(i),e.addEventListener(o.POINTERHIT,(()=>{this._setSelectionData({threadType:"personalSpace",threadId:this._personalSpace.id,threadTitle:"Personal Space",cellUI:e,subject6wuri:this._personalSpace.subject6wuri})})),this.UIObject.communitiesContainer.append(e),this._communitiesCellUIMap.set(this._personalSpace.id,e)},fillCommunitiesContainer:function(){if(this.UIObject&&this.UIObject.communitiesContainer)for(let e=0;e<this._communitiesList.length;e++){let t=document.createElement("div");t.setAttribute("data-uid_po",`WB-ChoosePage-Community-Btn-${this._communitiesList[e].label}`),t.setAttribute("title",this._communitiesList[e].label),t.classList.add("data-item");let i=document.createElement("span");i.style.backgroundImage=`url(${this._communitiesList[e].logoUrl})`,t.appendChild(i);let n=document.createElement("span");n.innerText=this._communitiesList[e].label,t.appendChild(n),t.addEventListener(o.POINTERHIT,(()=>{this._setSelectionData({threadType:"community",threadId:this._communitiesList[e].id,threadTitle:this._communitiesList[e].label,cellUI:t,subject6wuri:this._communitiesList[e].subject6wuri})})),this.UIObject.communitiesContainer.append(t),this._communitiesCellUIMap.set(this._communitiesList[e].id,t)}},fillConversationsContainer:function(){if(this.UIObject&&this.UIObject.conversationsContainer){this.UIObject.conversationsContainer.innerText="";for(let e=0;e<this._conversationsList.length;e++){let t=document.createElement("div");t.setAttribute("data-uid_po",`WB-ChoosePage-Conversation-Btn-${this._conversationsList[e].label}`),t.setAttribute("title",this._conversationsList[e].label),t.classList.add("data-item");let i=document.createElement("span");if(1===this._conversationsList[e].usersUrl.length)i.style.backgroundImage=`url(${this._conversationsList[e].usersUrl[0]})`;else{i.classList.add("group-logo");for(let t=0;t<this._conversationsList[e].usersUrl.length;t++){if(!(t<=2)){let n=document.createElement("span");n.innerText="+"+(this._conversationsList[e].usersUrl.length-t),i.append(n);break}{let n=document.createElement("span");n.style.backgroundImage=`url(${this._conversationsList[e].usersUrl[t]})`,i.append(n)}}}t.appendChild(i);let n=document.createElement("span");n.innerText=this._conversationsList[e].label,t.appendChild(n),t.addEventListener(o.POINTERHIT,(()=>{this._setSelectionData({threadType:"dm",threadId:this._conversationsList[e].subject6wuri,threadTitle:"Conversation",cellUI:t,subject6wuri:this._conversationsList[e].subject6wuri})})),this.UIObject.conversationsContainer.append(t),this._conversationsCellUIMap.set(this._conversationsList[e].subject6wuri,t)}0===this._conversationsList.length&&this.noResultsView("conversation")}},setCommConvContainerHeight:function(){let e=this.UIObject.communitiesContainer.classList.contains("active")?this.UIObject.communitiesContainer:this.UIObject.conversationsContainer,t=null;t=this.UIObject.okCancelButtonsContainer?this.UIObject.mainContainer.getBoundingClientRect().height+this.UIObject.mainContainer.getBoundingClientRect().top-e.getBoundingClientRect().top-(this.UIObject.okCancelButtonsContainer.getBoundingClientRect().height+Number(getComputedStyle(this.UIObject.okCancelButtonsContainer).marginTop.split("px")[0])+20):this.UIObject.mainContainer.getBoundingClientRect().height+this.UIObject.mainContainer.getBoundingClientRect().top-e.getBoundingClientRect().top-20,e.style.height=t+"px"},_setSelectionData:function(e){this.UIObject.prevSelectedCellUI&&this.UIObject.prevSelectedCellUI.classList.remove("selected"),e.cellUI.classList.add("selected"),this.UIObject.prevSelectedCellUI=e.cellUI,this._selectionData=e,!0===this.isForwardPage?this._okButton.enable():this.handleOkButtonClick()},handleOkButtonClick:async function(){if(!this._selectionData)return;"r2v"===this?.whatToCreateData?.type&&await this.triggerFileSelectorUI();let{threadType:e,threadId:t,threadTitle:i,subject6wuri:n}=this._selectionData;this.onChooseCallback&&this.onChooseCallback({threadType:e,threadId:t,threadTitle:i,subject6wuri:n,whatToCreateData:this.whatToCreateData})},triggerFileSelectorUI:function(){return new Promise(((e,t)=>{const i=document.createElement("input");let n=this._fileServices.getSupportedExtensions(C.TYPE_IMAGE).reduce(((e,t)=>(e&&(e+=", "),e+=`image/${t}`)),"");i.setAttribute("accept",n),i.setAttribute("type","file"),i.addEventListener("change",(()=>{this.whatToCreateData.data=i.files,e()})),i.addEventListener("cancel",(()=>{this.whatToCreateData.data=null,e()})),i.click()}))},destroyUI:function(){this.UIObject.mainContainer.remove(),this.UIObject=null,this.unsubscribeToResizeEvent(),this.onDestroyCallback&&this.onDestroyCallback()},_debounce:function(e,t=200){let i;return(...n)=>{clearTimeout(i),i=setTimeout((()=>{e.bind(this)(...n)}),t)}},subscribeToResizeEvent:function(){this.onResizeCB=this._debounce((function(){this.setMainContainerHeight(),this.setCommConvContainerHeight()})),window.addEventListener("resize",this.onResizeCB)},unsubscribeToResizeEvent:function(){window.removeEventListener("resize",this.onResizeCB)}});return e.namespace("DS/CAT3DWChooser/CAT3DWCreateWBChoosePage",g)})),define("DS/CAT3DWChooser/CAT3DWChoose3DModel",["UWA/Class","DS/UIKIT/Modal","DS/UIKIT/SuperModal","DS/CAT3DWChooser/CAT3DWLoadServices","DS/CAT3DWInfra/CAT3DWPlateformServices","DS/CAT3DWInfra/CAT3DWPreferenceManager","i18n!DS/CAT3DWChooser/assets/nls/CAT3DSKChoose3DModel","css!DS/CAT3DWChooser/CAT3DWChooser"],(function(e,t,i,n,a,s,o){"use strict";var r=UWA.Class.extend({init:function(){this._onOpenFile=null,this._url=null,this._loadServices=new n({acceptAttributes:".3dxml,.cgr"}),this._drivePanelAnchor="sidepanel:X3PDRIV_AP"},open:function(e){this._onOpenFile=e;var t=new i({className:"choose-picture-modal"});t.onHide=this.onHide.bind(this,t),this._chooseProviderContent(t)},onHide:function(e){this._url=null,e.destroy()},_chooseProviderContent:function(e){if(a.cacheUrl3DDrive||s.getPreferenceValue("ODTMode")){var t=[];if(s.getPreferenceValue("ODTMode")){var i=this._createProviderObject(o.get("odtBtnLabel"),this._onODTClick.bind(this,e),"fonticon-cog",null);t.push(i);new UWA.Element("input",{type:"hidden",id:"x3DPhoto-ODT-modelUrl"}).inject(document.body)}var n=this._createProviderObject(o.get("deviceBtnLabel"),this._onComputerClick.bind(this,e),"fonticon-install",null);if(t.push(n),a.cacheUrl3DDrive){var r=this._getDrivePanelUrl(),l=this._createProviderObject(o.get("driveBtnLabel"),this._on3DDriveClick.bind(this,e),"fonticon-component",r);t.push(l)}var c=new UWA.Element("div",{html:t});e.dialog({body:c,title:o.get("title"),buttons:[{value:o.get("cancelBtnLabel"),action:function(e){e.hide()}}]})}else this._onComputerClick(e)},_onComputerClick:function(e){this._loadServices.openFileSelector(function(t){e.next(),this._onOpenFile(t)}.bind(this))},_onODTClick:function(e){var t=document.getElementById("x3DPhoto-ODT-modelUrl");e.next(),this._onOpenFile(t.value)},_on3DDriveClick:function(e){},_createProviderObject:function(e,t,i,n){return{tag:"a",href:n||"javascript:void(0)",target:"_parent",html:{tag:"div",class:"provider",html:[{tag:"span",class:"fonticon "+i+" fonticon-2x"},{tag:"span",class:"name",text:e}],events:{click:t}}}},_getDrivePanelUrl:function(){return parent.document.location.hash="","/#"+this._drivePanelAnchor}});return UWA.namespace("DS/CAT3DWChooser/CAT3DWChoose3DModel",r)})),define("DS/CAT3DWChooser/CAT3DWDisplayUserMedia",["UWA/Core","UWA/Promise","DS/CAT3DWInfra/CAT3DW3DSwymMediaServices","DS/CAT3DWLoaderLight/CAT3DWLoaderLight","DS/CoreEvents/Events","DS/CAT3DWInfra/CAT3DWPlateformServices","DS/CAT3DWInfra/CAT3DWPreferenceManager","i18n!DS/CAT3DWChooser/assets/nls/CAT3DWDisplayUserMedia","DS/UIKIT/SuperModal","DS/CAT3DWPanoply/CAT3DWDropMenu","DS/CAT3DWInfraUI/CAT3DWHandleErrors","DS/RTConvAPI/RTConvAPI","DS/CAT3DWChooser/CAT3DWCreateWBChoosePage","i18n!DS/CAT3DWInfra/assets/nls/CAT3DWTooltip","css!DS/CAT3DWChooser/CAT3DWChooser"],(function(e,t,i,n,a,s,o,r,l,c,h,d,u,m){"use strict";var p=e.Class.extend({init:function(e){this.mediaContainer=e.body,this.showLoader(),this._currentUser=o.getPreferenceValue("currentUserInfo"),this.platformId=o.getPreferenceValue("swymTenant"),this._isWhiteboard="whiteboard"===o.getPreferenceValue("appMode"),this.isSearchFeatureTurnedOff=!0,this.getAllData()},showLoader:function(){n.show()},searchInUserMedia:async function(e){var t=this._globalState.getActiveTabState().boxContainer.isInjected();this.isSearchFeatureTurnedOff=!e;var i=[],n=[];if(t&&!this.isSearchFeatureTurnedOff){let{_processedMediaInfo:t}=this._globalState.getActiveTabState();for(let a of t)!0===a.label.toLowerCase().includes(e.toLowerCase())&&(Object.hasOwn(a,"isMediaDeleted")?!1===a.isMediaDeleted&&i.push(a):n.push(a));for(let e of n)try{let t=await s.checkIfMediaExists({url:this.platformUrl,token:this.csrfToken,mediaId:e.id,returnPromise:!0});t instanceof Error?e.isMediaDeleted=!0:(this.retrievedMediaMap.set(e.id,t),i.push(e),e.isMediaDeleted=!1)}catch(e){console.warn(e)}if(i.sort(((e,t)=>e.modified<t.modified?1:t.modified<e.modified?-1:0)),0!==i.length){this.clearActiveTabContainer();let{boxContainer:e}=this._globalState.getActiveTabState();for(let t of i)this.mediaCardView(t,e)}else{let{boxContainer:e}=this._globalState.getActiveTabState();this.noMediaView(e),h.setGeneralErrorMessage(r.get("searchWhiteboardsNoResults"),"","",h.INFORMATION)}}else if(this.isSearchFeatureTurnedOff){this.clearActiveTabContainer();let{mediaList:e,boxContainer:t}=this._globalState.getActiveTabState();for(let i of e)this.mediaCardView(i,t);let{isScrollBarActive:i}=this._getScrollBarInfo();!1===i&&this._startFillingUI()}else t||h.setGeneralErrorMessage(r.get("MyWhiteboardsButtonNotClickedError"),"","",h.INFORMATION)},_debounce:function(e,t=200){let i;return(...n)=>{clearTimeout(i),i=setTimeout((()=>{e.bind(this)(...n)}),t)}},_onSearchCallback:function(e){let t=e.target.value;this.searchInUserMedia(t)},_onResizeCallback:function(e){this.setActiveBoxContainerHeight();let{isScrollBarActive:t}=this._getScrollBarInfo();!1===t&&this._startFillingUI()},_onScrollCallback:function(e){e.target.scrollHeight-e.target.scrollTop-e.target.clientHeight==0&&this.isSearchFeatureTurnedOff&&this._startFillingUI()},_getScrollBarInfo:function(){let e=this._globalState.getActiveTabState().boxContainer,t=e.scrollHeight>e.clientHeight,i=null;return t&&(i=e.scrollHeight-e.scrollTop-e.clientHeight==0),{isScrollBarActive:t,isScrollBarAtEnd:i,containerWithScrollBar:e}},_startFillingUI:function(e){let{_fillEndIndex:t,_fillStartIndex:i,_processedMediaInfo:n,mediaList:a,boxContainer:s}=this._globalState.getActiveTabState();if(e&&e.fillIfActiveBoxContainer&&e.fillIfActiveBoxContainer!==s)return;let{isScrollBarActive:o,isScrollBarAtEnd:r}=this._getScrollBarInfo();if(!0===o){let e=n.slice(i,t);0!==e.length&&r&&this._displayUserMedia(e,s,a,t,i)}else if(!1===o){let e=n.slice(i,t);0!==e.length?this._displayUserMedia(e,s,a,t,i):0===a.length&&this.noMediaView(s)}},_getConversationName:function(e){var t=this._currentUser.login,i=e.topic;if(!i){i="";for(var n=0;n<e.users.length;n++)t.toLowerCase()!==e.users[n].login.toLowerCase()&&(i+=e.users[n].first_name+" "+e.users[n].last_name,n!==e.users.length-1&&(n===e.users.length-2&&t.toLowerCase()===e.users[n+1].login.toLowerCase()||(i+=", ")))}return i},_onFetchComplete:async function(e,t){let i=new Set,n=o.getPreferenceValue("swymTenant"),a=await d.listConv({platformId:n}),s=new Map;a.forEach((e=>{s.set(e.id,e)}));for(let n=0;n<e+t;n++){let t=this._fetchedRawMediaInfo[n],a={};if(t.attributes.map((e=>{let t=e.name;t=t.replace("ds6w:","").replace("swym:",""),t.contains("resourceid")&&e.value.contains("media:")&&(t="id",e.value=e.value.split("media:")[1]),t.contains("containerUid")&&e.value.contains("community:")&&(e.value=e.value.split("community:")[1],e.value.contains("rt:")&&(e.value=e.value.split("rt:")[1])),t.contains("community")&&(t="community"),t.contains("dataSource")&&(t="conversation","string"==typeof e.value&&e.value.contains("3DSwymPSpace")&&(t="personalSpace")),t.contains("modified")&&(t="modified",e.value=this.formatDate(new Date(e.value))),a[t]="conversation"===!t?"My Conversation":"personalSpace"===t?r.get("personalSpace"):e.value})),!a.community){let e=s.get(a.containerUid);e&&(a.conversation=this._getConversationName(e))}a.isDraft="Draft"===a.publicationState,!1===i.has(a.id)&&(i.add(a.id),n<e?a.personalSpace?this._globalState.personalSpaceContent._processedMediaInfo.push(a):this._globalState.recentPublishedContent._processedMediaInfo.push(a):this._globalState.editRightsContent._processedMediaInfo.push(a))}},startFetchAndFill:async function(){this.page=0,this.page_size=500,await this._getMedias({user:this._currentUser.login,media_type:this._isWhiteboard?"whiteboard":"sketch"});let e=this._fetchedRawMediaInfo.length;this.page=0,this.page_size=500,await this._getMedias({media_type:this._isWhiteboard?"whiteboard":"sketch",rightsOfUser:{userlogin:this._currentUser.login,userfullname:this._currentUser.first_name+" "+this._currentUser.last_name,edit:!0,owner:!1}});let t=this._fetchedRawMediaInfo.length-e;await this._onFetchComplete(e,t),n.hide(),this._startFillingUI()},getAllData:function(){this._onResizeCallbackBind&&window.removeEventListener("resize",this._onResizeCallbackBind),this._getPlateformData().then(this._getCurrentUser.bind(this)).then(this._get3DSearchUrl.bind(this)).then(function(){this._fetchedRawMediaInfo=[],this.retrievedMediaMap=new Map,this.destroyPreviousWhiteboardDataModel(),this.setActiveBoxContainerHeight(),this.forwardingPage&&this.forwardingPage.destroyUI()&&(this.forwardingPage=null),this._onResizeCallbackBind=this._debounce(this._onResizeCallback),window.addEventListener("resize",this._onResizeCallbackBind),this.startFetchAndFill()}.bind(this))},displayRecentUserMedia:function(){let t=e.createElement,i=t("div",{class:"home-page-title-container",html:[t("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-app-whiteboard"}),t("span",{text:r.get("previousWhiteboardsTitle")})]}),n=t("div",{class:"home-page-tabs-container",events:{click:e=>{if(e.target===e.currentTarget)return;s.value="",this._onSearchCallback({target:{value:s.value}});let t=Array.from(e.target.parentElement.children);t[0].classList.remove("active"),t[1].classList.remove("active"),t[2].classList.remove("active"),c.classList.remove("active"),h.classList.remove("active"),l.classList.remove("active"),e.target.innerText===r.get("recentPublishedContent")?(t[0].classList.add("active"),c.classList.add("active"),this._globalState.activeTab="recentPublishedContent"):e.target.innerText===r.get("personalSpaceContent")?(t[1].classList.add("active"),h.classList.add("active"),this._globalState.activeTab="personalSpaceContent"):e.target.innerText===r.get("editRightsContent")&&(t[2].classList.add("active"),l.classList.add("active"),this._globalState.activeTab="editRightsContent"),this.setActiveBoxContainerHeight(),this._startFillingUI()}},html:[t("div",{class:"active","data-uid_po":"WB-MyWhiteboardsPage-RecentPublishedContent",title:m.get("recentPublishedContent"),text:r.get("recentPublishedContent")}),t("div",{"data-uid_po":"WB-MyWhiteboardsPage-PersonalSpaceContent",title:m.get("personalSpaceContent"),text:r.get("personalSpaceContent")}),t("div",{"data-uid_po":"WB-MyWhiteboardsPage-CommonAccessContent",title:m.get("editRightsContent"),text:r.get("editRightsContent")})]}),a=document.createElement("div");a.classList.add("home-page-search-bar-container");let s=document.createElement("input");s.setAttribute("placeholder",r.get("searchBarPlaceHolder")),a.append(s);let o=this._debounce(this._onSearchCallback,850);s.addEventListener("input",o);let l,c=t("div",{class:"active box-container"}),h=t("div",{class:"box-container"});l=t("div",{class:"box-container"});let d=this._debounce(this._onScrollCallback,100);c.addEventListener("scroll",d),h.addEventListener("scroll",d),l.addEventListener("scroll",d);let u=document.getElementsByClassName("afr-welcome-screen-content")[0];u.style.width="78%",u.style.overflow="hidden",document.getElementsByClassName("afr-custom-panel")[0].style.overflow="hidden",this.mediaContainer.className="media-container",this.mediaContainer.appendChild(i),this.mediaContainer.appendChild(n),this.mediaContainer.appendChild(a),this.mediaContainer.appendChild(c),this.mediaContainer.appendChild(h),this.mediaContainer.appendChild(l),this._globalState={activeTab:"recentPublishedContent",recentPublishedContent:{_fillStartIndex:0,_fillEndIndex:5,boxContainer:c,_processedMediaInfo:[],mediaList:[]},personalSpaceContent:{_fillStartIndex:0,_fillEndIndex:5,boxContainer:h,_processedMediaInfo:[],mediaList:[]},editRightsContent:{_fillStartIndex:0,_fillEndIndex:5,boxContainer:l,_processedMediaInfo:[],mediaList:[]},getTitleContainer:function(){return i},getTabsContainer:function(){return n},getSearchBarContainer:function(){return a},getActiveTabState:function(){return this[this.activeTab]},setTabState:function(e,t){let i=null;if(this.recentPublishedContent.boxContainer===e?i=this.recentPublishedContent:this.personalSpaceContent.boxContainer===e?i=this.personalSpaceContent:this.editRightsContent.boxContainer===e&&(i=this.editRightsContent),i)for(let e in t)Object.hasOwnProperty.call(t,e)&&(i[e]=t[e])}},this.setActiveBoxContainerHeight()},clearActiveTabContainer:function(){this._globalState.getActiveTabState().boxContainer.innerText=""},hideTitleTabSearchBarAndBoxContainer:function(){let e=this._globalState.getTitleContainer(),t=this._globalState.getTabsContainer(),i=this._globalState.getSearchBarContainer();e.style.display="none",t.style.display="none",i.style.display="none",this._globalState.getActiveTabState().boxContainer.style.display="none"},showTitleTabSearchBarAndBoxContainer:function(){let e=this._globalState.getTitleContainer(),t=this._globalState.getTabsContainer(),i=this._globalState.getSearchBarContainer();e.style.removeProperty("display"),t.style.removeProperty("display"),i.style.removeProperty("display"),this._globalState.getActiveTabState().boxContainer.style.removeProperty("display")},destroyPreviousWhiteboardDataModel:function(){let e=this._globalState.getTitleContainer(),t=this._globalState.getTabsContainer(),i=this._globalState.getSearchBarContainer();e.style.removeProperty("display"),t.style.removeProperty("display"),i.style.removeProperty("display"),this._globalState.recentPublishedContent.boxContainer.style.removeProperty("display"),this._globalState.recentPublishedContent.boxContainer.innerText="",this._globalState.recentPublishedContent._processedMediaInfo=[],this._globalState.recentPublishedContent.mediaList=[],this._globalState.recentPublishedContent._fillStartIndex=0,this._globalState.recentPublishedContent._fillEndIndex=5,this._globalState.personalSpaceContent.boxContainer.style.removeProperty("display"),this._globalState.personalSpaceContent.boxContainer.innerText="",this._globalState.personalSpaceContent._processedMediaInfo=[],this._globalState.personalSpaceContent.mediaList=[],this._globalState.personalSpaceContent._fillStartIndex=0,this._globalState.personalSpaceContent._fillEndIndex=5,this._globalState.editRightsContent.boxContainer.style.removeProperty("display"),this._globalState.editRightsContent.boxContainer.innerText="",this._globalState.editRightsContent._processedMediaInfo=[],this._globalState.editRightsContent.mediaList=[],this._globalState.editRightsContent._fillStartIndex=0,this._globalState.editRightsContent._fillEndIndex=5},setActiveBoxContainerHeight:function(){let e=this._globalState.getActiveTabState().boxContainer.getBoundingClientRect().top,t=window.innerHeight;this._globalState.getActiveTabState().boxContainer.style.height=t-e+"px"},_getPlateformData:function(){return new t(function(e){i.getPlatformUrl().then(s.getCsrfToken).then(function(t){this.platformUrl=t.url,this.csrfToken=t.token,e(t)}.bind(this)).catch((function(e){console.log(e)}))}.bind(this))},_getCurrentUser:function(){return new t(function(e){this._currentUser&&e(this._currentUser),s.getCurrentUser({url:this.platformUrl,token:this.csrfToken}).then(function(t){this._currentUser=t,e(this._currentUser)}.bind(this)).catch((function(e){console.log(e)}))}.bind(this))},_get3DSearchUrl:function(){return new t(function(e){this._federatedSearchUrl&&e(this._federatedSearchUrl),s.get3DSearch(this.platformId).then(function(t){this._federatedSearchUrl=t,e(this._federatedSearchUrl)}.bind(this)).catch((function(e){console.log(e)}))}.bind(this))},_getMedias:function(e){return new Promise(((t,i)=>{let n=()=>{s.searchMedia({url:this._federatedSearchUrl,platform_id:this.platformId,current_user:this._currentUser.login,search_data:e,include_draft:!0,source:"swym",page_size:this.page_size,page:this.page*this.page_size,order_field:"ds6w:modified",order_by:"desc"}).then((e=>{e.results?(this._fetchedRawMediaInfo.push(...e.results),e.infos.nmatches>(this.page+1)*this.page_size?(this.page=this.page+1,n()):t("data-found")):t("data-not-found")}))};n()}))},_deleteProjectFromSwym:function(e){var t=e&&e.subject6wuri;return t?new Promise((e=>{i.deleteMedia({subject6wuri:t}).then((()=>e(!0))).catch((()=>e(!1)))})):Promise.resolve(!1)},_displayUserMedia:function(e,t,i,a,o){let r=[],l=i.length;for(let t of e)r.push(s.checkIfMediaExists({url:this.platformUrl,token:this.csrfToken,mediaId:t.id,returnPromise:!0}).then(function(e){let n=e instanceof Error,a=!0,s=!0,o=!0;a=e._acl&&!0===e._acl.update.access,s=e._acl&&!0===e._acl.delete.access,o=e._acl&&!0===e._acl.forward.access,!n&&a?!1===this.retrievedMediaMap.has(t.id)&&(this.retrievedMediaMap.set(t.id,e),t.isRenderedOnDom=!1,i.push(t),t.isMediaDeleted=!1,t.canMediaBeDeleted=!!s,t.canMediaBeForwarded=!!o):t.isMediaDeleted=!0}.bind(this)));Promise.all(r).then((()=>{n.hide(),i.sort(((e,t)=>new Date(e.modified)-new Date(t.modified))).reverse();for(let e=l;e<i.length;e++)!1===i[e].isRenderedOnDom&&(i[e].isRenderedOnDom=!0,this.mediaCardView(i[e],t));a+=5,o+=5,this._globalState.setTabState(t,{_fillEndIndex:a,_fillStartIndex:o}),this._startFillingUI({fillIfActiveBoxContainer:t},!0)}))},mediaCardView:function(t,i){let o=e.createElement;var d,p=function(e){e.stopPropagation();let i=this.retrievedMediaMap.get(t.id);i?a.publish({event:"mediaClicked",data:i}):s.getMedia({url:this.platformUrl,token:this.csrfToken,mediaId:t.id,returnPromise:!0}).then((e=>{a.publish({event:"mediaClicked",data:e})}))}.bind(this),C=function(e){e.stopPropagation(),new l({className:"CAT3DSK-onHomeModal"}).dialog({body:r.get("deleteConfirmationModalBody"),title:r.get("deleteConfirmationModalTitle"),buttons:[{className:"primary",value:r.get("deleteConfirmationModalConfirmButton"),action:function(e){e.hide();let{mediaList:i}=this._globalState.getActiveTabState(),a=i.length,s=this.retrievedMediaMap.get(t.id),o=-1;for(let e=0;e<a;e++)if(i[e].id===t.id){o=e;break}this._deleteProjectFromSwym(s).then((e=>{if(e){if(b.remove(),t.isMediaDeleted=!0,this.retrievedMediaMap.has(t.id)&&this.retrievedMediaMap.delete(t.id),-1!==o&&i.splice(o,1),this.isSearchFeatureTurnedOff){let{isScrollBarActive:e}=this._getScrollBarInfo();!1===e&&this._startFillingUI()}}else n.hide()}))}.bind(this)},{className:"default",value:r.get("deleteConfirmationModalRejectButton"),action:function(e){e.hide()}}]})}.bind(this),g=async function(e){e.stopPropagation(),this.hideTitleTabSearchBarAndBoxContainer();let i=document.createElement("div");i.style.width="100%",i.style.height="100%",this.mediaContainer.append(i),this.forwardingPage=new u({titleText:r.get("forwardWhiteboardPageTitle"),body:i,isForwardPage:!0,onChooseCallback:async e=>{this.forwardingPage.destroyUI(),this.forwardingPage=null;let i={platformUrl:this.platformUrl,token:this.csrfToken,community_uri:e.subject6wuri,content_uri:e.subject6wuri.split(":").slice(0,3).join(":")+":media:"+t.id};await s.forwardMediaSwym(i)instanceof Error?h.setGeneralErrorMessage(r.get("mediaForwardedMessageFailure"),"","",h.INFORMATION):h.setGeneralErrorMessage(r.get("mediaForwardedMessageSuccess"),"","",h.INFORMATION)},onDestroyCallback:()=>{this.showTitleTabSearchBarAndBoxContainer(),this.forwardingPage=null}})}.bind(this),b=o("div",{class:"box",events:{click:p}}),f=[{id:"SHARELINK",text:r.get("dropmenuShareableLinkOption"),icon:"fonticon fonticon-wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-link",selectable:!1,tooltip:m.get("copyLinkToWhiteboard"),handler:function(e){e.stopPropagation(),window.navigator.clipboard.writeText(t.ResourceURL),h.setGeneralErrorMessage(r.get("shareableLinkCopyMessage"),"","",h.INFORMATION)}},{id:"EDIT",text:r.get("dropmenuEditOption"),icon:"fonticon fonticon-wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-pencil",selectable:!1,tooltip:m.get("editWhiteboard"),handler:p},{id:"DELETE",text:r.get("dropmenuDeleteOption"),icon:"fonticon fonticon-wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-trash",selectable:!1,tooltip:m.get("deleteWhiteboard"),handler:C},{id:"FORWARD",text:r.get("dropmenuForwardOption"),icon:"fonticon fonticon-wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-import",selectable:!1,tooltip:m.get("forwardWhiteboard"),handler:g}];if(!1===t.canMediaBeDeleted&&f.splice(2,1),!1===t.canMediaBeForwarded){let e;for(e=0;e<f.length&&"FORWARD"!==f[e].id;e++);f.splice(e,1)}var v=o("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-chevron-down",styles:{position:"absolute",bottom:"0px",right:"3px",fontSize:"2rem",color:"#77797C",display:"block"},events:{click:function(e){e.stopPropagation(),d||(d=new c({target:v,renderTo:b,items:f,multiSelect:!1,closeOnClick:!1,menuClassList:["HomepageDropmenu"],onShowCallback:function(){}}),t.isDraft&&d.menu.disableItem("FORWARD")),d.onHide((()=>{d&&d.remove(),d=null})),d.toggle()}}});b.append(v);var _=o("div",{class:"image-container"}),T=o("img",{class:"media-image",src:t.preview_url}),S=o("div",{class:"details-container"}),I=o("div",{class:"header-container"}),D=o("div",{class:"draft-label-container",html:o("div",{class:"draft-label",text:r.get("draft")})});t.isDraft&&b.appendChild(D);var U=o("div",{class:"title-text",text:t.label});I.appendChild(U);var A=o("div",{class:"date-container",text:t.modified}),w=o("div",{class:"community-container"});let P=t.community?'<span class="fonticon fonticon-users-alt"></span>':'<span class="fonticon fonticon-chat-alt"></span>';P=t.personalSpace?'<span class="fonticon fonticon-user-feather"></span>':P;var y=o("div",{class:"community-icon",html:P});let W=t.community?t.community:t.conversation;t.personalSpace&&(W=t.personalSpace);var O=o("div",{class:"community-text",text:W||""});w.appendChild(y),w.appendChild(O),b.setAttribute("href",this.platformUrl+"/#community:"+t.containerUid+"/media:"+t.id+"/edit"),_.appendChild(T),b.appendChild(_),S.appendChild(I),S.appendChild(A),S.appendChild(w),b.appendChild(S),i.appendChild(b)},noMediaView:function(t){t.innerText="";var i=e.createElement("div",{class:"empty-container",text:this._isWhiteboard?r.get("noWhiteboard"):r.get("noSketch")});t.appendChild(i)},formatDate:function(e){let t=e.getHours()>=12?"PM":"AM",i=e.getHours();return i>12?i-=12:0===i&&(i=12),["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()]+"  "+e.getDate().toString().padStart(2,"0")+", "+e.getFullYear().toString()+", "+i.toString().padStart(2,"0")+":"+e.getMinutes().toString().padStart(2,"0")+"  "+t}});return e.namespace("DS/CAT3DWChooser/CAT3DWDisplayUserMedia",p)})),define("DS/CAT3DWChooser/CAT3DWChoosePicture",["UWA/Class","UWA/Controls/Scroller","DS/UIKIT/Accordion","DS/UIKIT/Modal","DS/UIKIT/SuperModal","DS/CAT3DWChooser/CAT3DWLoadServices","DS/CAT3DWInfra/CAT3DWPlateformServices","DS/CAT3DWInfraUI/CAT3DWCanvasServices","DS/CAT3DWChooser/CAT3DWImageGallery","DS/i3DXCompassServices/i3DXCompassPubSub","WebappsUtils/WebappsUtils","DS/WAFData/WAFData","DS/CAT3DWInfra/CAT3DWPreferenceManager","i18n!DS/CAT3DWChooser/assets/nls/CAT3DWChoosePicture","css!DS/CAT3DWChooser/CAT3DWChooser"],(function(e,t,i,n,a,s,o,r,l,c,h,d,u,m){"use strict";var p=UWA.Class.extend({init:function(){this._onOpenFile=null,this._url=null,this._loadServices=new s,this._canvasServices=new r,this._drivePanelAnchor="sidepanel:X3PDRIV_AP",this._maxWidth=2e3,this._maxHeight=1500,this._widget=null},setWidget:function(e){this._widget=e},open:function(e){this._onOpenFile=e;var t=new a({className:"choose-picture-modal"});t.onHide=this.onHide.bind(this,t),this._chooseProviderContent(t)},dropImage:function(e,t){this._onOpenFile=t,this._canvasServices.loadImage(e,!1,function(e){this._computeImageUrl(e,function(e){this._url=e,this._onOpenFile(this._url)}.bind(this))}.bind(this))},onHide:function(e){this._url=null,e.destroy(),c.unsubscribe("setX3DContent")},_chooseProviderContent:function(e){if(!o.cacheUrl3DDrive&&!u.getPreferenceValue("ODTMode")&&l.countVisibleSections()<=0)this._onComputerClick(e);else{var t=[];if(u.getPreferenceValue("ODTMode")){var i=this._createProviderObject(m.get("odtBtnLabel"),this._onODTClick.bind(this,e),"fonticon-cog",null);t.push(i);new UWA.Element("input",{type:"hidden",id:"x3DPhoto-ODT-imageUrl"}).inject(document.body)}var n=this._createProviderObject(m.get("deviceBtnLabel"),this._onComputerClick.bind(this,e),"fonticon-install",null);if(t.push(n),o.cacheUrl3DDrive){var a=this._getDrivePanelUrl(),s=this._createProviderObject(m.get("driveBtnLabel"),this._on3DDriveClick.bind(this,e),"fonticon-component",a);t.push(s)}var r=null;l.countVisibleSections()>1?r=this._createAccordionContainer("divided",e):1==l.countVisibleSections()&&(r=this._createSectionContainer(e)),r&&t.push(r);var c=new UWA.Element("div",{html:t});e.dialog({body:c,title:m.get("title"),buttons:[{value:m.get("cancelBtnLabel"),action:function(e){e.hide()}}]});var h=document.getElementById("toScroll");h&&this._addToScroller(h)}},_onComputerClick:function(e){this._loadServices.openFileSelector(function(t,i){this._loadLocalImage(e,t,i)}.bind(this))},_onODTClick:function(e){var t=document.getElementById("x3DPhoto-ODT-imageUrl");this._loadLocalImage(e,t.value)},_loadLocalImage:function(e,t,i){this._canvasServices.loadImage(t,!1,function(t){e.next(),this._computeImageUrl(t,function(e){this._url=e,this._onOpenFile(this._url,i?i.name:"")}.bind(this))}.bind(this))},_on3DDriveClick:function(e){var t=this._selectPictureContent(e);e.next(),c.subscribe("setX3DContent",this._on3DXContentSelection.bind(this,t))},_onRecentContentClick:function(e){this._canvasServices.getBlobUrlFromImg(this._url,function(t){this._url=t,this._onOpenFile(this._url),e.next()}.bind(this))},_onRecentTextureClick:function(e){this._canvasServices.getBlobUrlFromImg(this._url,function(t){this._url=t,this._onOpenFile(this._url),e.next()}.bind(this))},_onSampleClick:function(e,t){if(this._url=l.getThumbnailPropertiesByID(t),!this._url.type)return this._onOpenFile(this._url),void e.next();if("side"==this._url.type){for(var i in this._url.set){var n=this._url.set[i];n&&"string"==typeof n&&(this._url.set[i]=n?n.match("http")?n:h.getWebappsAssetUrl("CAT3DWChooser",n):null)}this._canvasServices.getBlobUrlFromImg(this._url.set.front,function(t){this._url.set.front=t,this._canvasServices.getBlobUrlFromImg(this._url.set.left,function(t){this._url.set.left=t,this._canvasServices.getBlobUrlFromImg(this._url.set.top,function(t){this._url.set.top=t,this._onOpenFile(this._url),e.next()}.bind(this))}.bind(this))}.bind(this))}else"scene"==this._url.type?(this._url.background=h.getWebappsAssetUrl("CAT3DWChooser",this._url.background),this._canvasServices.getBlobUrlFromImg(this._url.background,function(t){u.setPreferenceValue("SampleMode",{base:this._url.manhattanBase,floorParams:this._url.floorParams,camParams:this._url.camParams}),this._onOpenFile(t),e.next()}.bind(this))):(this._onOpenFile(this._url),e.next())},_selectPictureContent:function(e){var t=h.getWebappsAssetUrl("CAT3DWChooser","graphics/G_NXGAddImageWhite.png"),i=new UWA.Element("div",{html:[{tag:"div",class:"thumbnail",styles:{backgroundImage:"url("+t+")"},html:{tag:"img",src:t,class:"hide"}}]});return e.dialog({body:i,title:m.get("title"),buttons:[{className:"primary",value:m.get("validateBtnLabel"),action:function(e){this._url&&(this._onOpenFile(this._url),e.hide())}.bind(this)},{value:m.get("cancelBtnLabel"),action:function(e){e.hide()}}]}),i.getElementsByTagName("img")[0]},_on3DXContentSelection:function(e,t){if(t&&null!=t.data.items[0]){var i=o.cacheUrl3DDrive+"/resources/3ddrive/v1/bos/"+t.data.items[0].objectId+"/download";d.authenticatedRequest(i,{method:"GET",type:"json",onComplete:function(t){this._canvasServices.loadImage(t.url,!1,function(t){this._computeImageUrl(t,function(t){e.parentNode.setStyle("backgroundImage","url("+t+")"),this._url=t}.bind(this))}.bind(this))}.bind(this),onFailure:function(e){}})}},_createProviderObject:function(e,t,i,n){return{tag:"a",href:n||"javascript:void(0)",target:"_parent",html:{tag:"div",class:"provider",html:[{tag:"span",class:"fonticon "+i+" fonticon-2x"},{tag:"span",class:"name",text:e}],events:{click:t}}}},_createPictureContainer:function(e,t,i){var n=new UWA.Element("div",{class:"section-thumbnail",events:{click:function(){this._url=e,t?i(t):i()}.bind(this)}});return this._canvasServices.loadImage(e,!1,(function(e){e.naturalWidth>e.naturalHeight?n.addClassName("landscape"):n.addClassName("portrait"),n.appendChild(e)})),n},_createSectionContent:function(e,t,i){if(n=null,e&&e.length>0){var n=new UWA.Element("div",{class:"section-thumbnail-container",id:"toScroll"});e.forEach(function(e,a){this._createPictureContainer(e,t?t[a]:null,i).inject(n,"bottom")}.bind(this)),new UWA.Element("div",{class:"section-padding-trick"}).inject(n)}return n},_createAccordionContainer:function(e,t){var n=new UWA.Element("div",{class:"section-container"}),a=new i({className:e||"",exclusive:!1,items:[]});return l.getSectionsNames().forEach(function(e){l.isSectionVisible(e)&&(a.addItem({title:l.getSectionTitle(e),name:e,content:this._createSectionContent(l.getThumbnails(e),l.getIDs(e),this[l.getOnClickCB(e)].bind(this,t)),selected:l.isSectionSelected(e)}),a.inject(n))}.bind(this)),n},_createSectionContainer:function(e){var t=new UWA.Element("div",{class:"section-container"});return l.getSectionsNames().forEach(function(i){if(l.isSectionVisible(i)){var n=this._createSectionContent(l.getThumbnails(i),l.getIDs(i),this[l.getOnClickCB(i)].bind(this,e));if(n)new UWA.Element("div",{class:"section-title",text:l.getSectionTitle(i)}).inject(t),n.inject(t)}}.bind(this)),t},_addToScroller:function(e){new t(e,{scrollbarV:!1,scrollableY:!1})},_getDrivePanelUrl:function(){return parent.document.location.hash="","/#"+this._drivePanelAnchor},_computeImageUrl:function(e,t){var i=null,n=this._widget?this._widget.getValue("ImageOptimization"):"1";"-1"===n&&(e.width>this._maxWidth||e.height>this._maxHeight)?this._openImageOtimizationModal(function(n){i=this._optimizeImage(e,n),t(i)}.bind(this)):(i=this._optimizeImage(e,n),t(i))},_openImageOtimizationModal:function(e){var t=new n({className:"image-optimization",overlay:!0,closable:!1,header:"<h4>"+m.get("optimTitle")+"</h4>",body:"<p>"+m.get("optimMessage1")+"</p><p>"+m.get("optimMessage2")+'</p><br /><p><font size="2">'+m.get("optimTip")+"</font></p>",footer:'<button type="button" class="btn btn-primary" value="1">'+m.get("optimYesBtnLabel")+'</button> <button type="button" class="btn btn-default" value="0">'+m.get("optimNoBtnLabel")+"</button>"}).inject(document.body);t.onHide=this._onImageOptimizationHide.bind(this,t),t.getContent().getElements(".btn").forEach(function(i){i.addEvent("click",function(){t.hide(),this._widget&&this._widget.setValue("ImageOptimization",i.value),e(i.value)}.bind(this))}.bind(this)),t.show()},_optimizeImage:function(e,t){var i=e.width,n=e.height;"1"===t?(i=this._maxWidth,n=this._maxHeight):"0"===t&&(i=4e3,n=4e3);var a=this._canvasServices.getOptimizedDataUrlFromImg(e,i,n);return this._canvasServices.getBlobUrlFromDataUrl(a)},_onImageOptimizationHide:function(e){e.destroy()}});return UWA.namespace("DS/CAT3DWChooser/CAT3DWChoosePicture",p)}));