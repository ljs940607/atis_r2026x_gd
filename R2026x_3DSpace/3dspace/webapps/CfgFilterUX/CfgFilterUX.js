define("DS/CfgFilterUX/CfgFilterSlideInComponent",["UWA/Class/View","DS/Controls/Button","DS/Handlebars/Handlebars4","DS/UIKIT/Tooltip","DS/CfgBaseUX/scripts/CfgData","i18n!DS/CfgFilterUX/assets/nls/CfgFilterUX","DS/UIKIT/Mask","css!DS/CfgFilterUX/CfgFilterUX.css"],(function(e,t,i,n,o,s,a,r){return{init:function(e,r,l,c,d,p){var h=UWA.createElement("div",{class:"operations-main-container",id:"operations-container"});l.filterTitle=s.CFG_Filter_Title;var C=i.compile(c);h.innerHTML=C(l),e.appendChild(h);var u=h.getElement("#cfgslideInBody");d&&u.appendChild(d),r&&u.appendChild(r),p&&u.appendChild(p);var g=[],f=this;f.options=l,l.dialogue.buttonArray.forEach((function(e){var i=new t({label:e.label,value:"cfg"+e.label+"id",emphasize:e.className});i.addEventListener("buttonclick",(function(t){e.handler(t)})),1==f.options.displayCompactMode?i.touchMode=!1:i.touchMode=!0,g.push(i)}));var m=h.getElement("#cfgslideInFooter");if(0!=g.length)for(k=g.length-1;k>=0;k--)m.appendChild(g[k].getContent()),g[k].getContent().setStyle("margin-right","5px");var v=document.querySelector("#checkCfgfilterBtn");if(v&&new n({className:"filterValidate",id:"filterValidateId",position:"top",target:v,body:s.CFG_Configuration_Validate_Filter,trigger:"touch"}),l.dialogue.showButton){document.querySelector("#cfgfilterBackBtn").addEventListener("click",(function(e){o.renderToApp&&o.renderToApp.empty();require(["DS/CfgFilterUX/CfgFilterFactory"],(function(e){e.showFilter()}))}),!1),require(["DS/CfgFilterUX/CfgFilterFactory"],(function(e){e.hideFilter()}))}else a.unmask(e)}}})),define("DS/CfgFilterUX/CfgChangeActionCriteria",["UWA/Drivers/Alone","DS/Core/Core","DS/Controls/TooltipModel","UWA/Class/View","DS/CfgBaseUX/scripts/CfgData","DS/CfgBaseUX/scripts/CfgUtility","UWA/Class/Promise","DS/CfgBaseUX/scripts/CfgXMLServices","DS/UIKIT/Mask","DS/CfgBaseUX/scripts/CfgSearchConfiguration","i18n!DS/CfgFilterUX/assets/nls/CfgFilterUX","css!DS/CfgEvolutionUX/CfgEvolutionUX.css","css!DS/CfgFilterUX/CfgFilterUX.css"],(function(e,t,i,n,o,s,a,r,l,c,d){"use strict";return n.extend({editButton:null,textdiv:null,xml:"",xmlDesc:[],caLabelIdentifierMap:null,excludeCAList:[],json:null,displayExpression:"",currentSelectedFilterView:"",setup:function(e){this._parent(e),this.caLabelIdentifierMap=new Map,this.excludeCAList=[],this.xmlDesc=[]},render:function(){var e=this;e.currentSelectedFilterView=e.options.currentSelectedFilterView,this.textBox=UWA.createElement("div").inject(this.options.parentElement),this.textBox.addClassName("CfgEditor"),this.textBox.set({events:{click:function(t){""==this.innerHTML&&e.onCriteriaClickHandler(t)}}}),this.editButton=UWA.createElement("span").inject(this.options.parentElement),this.editButton.set({events:{click:function(t){e.onCriteriaClickHandler(t)}}}),this.editButton.addClassName("fonticon"),this.editButton.addClassName("fonticon-1.5x"),this.editButton.addClassName("fonticon-search"),this.editButton.addClassName("searchbutton"),o.ModelEvents.subscribe({event:"FilterViewChanged"},(function(t){e.currentSelectedFilterView=t.currentSelectedView})),this.applyCompactComfortableMode()},applyCompactComfortableMode:function(){null==this.options.displayCompactMode||!1===this.options.displayCompactMode?(this.textBox.setAttributeNode(document.createAttribute("touch-mode")),this.editButton&&this.editButton.setAttributeNode(document.createAttribute("touch-mode"))):(this.textBox.removeAttribute("touch-mode"),this.editButton&&this.editButton.removeAttribute("touch-mode"))},getAttrValue:function(e,t){var i="";return null!=e&&(i=e.get(t)),i},onCriteriaClickHandler:function(e){var t=this,i=d.selectChangeActionForFilter,n=enoviaServerFilterWidget.myRole,o='(current:"In Work" OR current:"In Approval" OR current:"Approved"';"Source"==this.currentSelectedFilterView.view&&(o+=' OR current:"Complete"'),o+=")";var a=t.excludeCAList;if("Native"==window.enoviaServerFilterWidget.mode){for(var r="",l=0;l<a.length;l++)r=r+"NOT (physicalid:"+a[l]+")";""!=a&&(o+=r);var p={precondition:o},h={eventName:"cfgConfigurationFilter",operation:"ActivateSearchCA",operationVersion:"1.0",content:JSON.stringify(p)};s.sendNotificationWebInWin(h)}else{new c(!0,i).activate(i,"Change Action",n,(function(e){t.xml="",e.forEach((function(e,i){var n=t.getAttrValue(e,"ds6w:label"),o=t.getAttrValue(e,"ds6w:identifier"),s=t.getAttrValue(e,"id");t.createCADiv(n),t.caLabelIdentifierMap.set(n,{identifier:o,physicalID:s}),t.excludeCAList.push(s)})),t.buildFilterXML()}),"",a,o)}},createCADiv:function(e){var t=this;this.caDiv=new UWA.createElement("span",{class:"caDiv"}).inject(this.textBox),UWA.createElement("span",{class:"caLabelSpan"}).inject(this.caDiv).innerHTML=e,UWA.createElement("span",{class:"fonticon fonticon-cancel"}).inject(this.caDiv).set({events:{click:function(e){e.cancelBubble=!0;var i=this.getParent(),n=this.getParent().getElementsByClassName("caLabelSpan")[0].innerHTML,o=t.caLabelIdentifierMap.get(n);t.caLabelIdentifierMap.delete(n);var s=t.excludeCAList.indexOf(o.physicalID);t.excludeCAList.splice(s,1),i.destroy(),t.buildFilterXML()}}})},clearCAComponent:function(){this.textBox.innerHTML="",this.displayExpression="",this.xml="",this.caLabelIdentifierMap.clear(),this.excludeCAList=[]},updateDisplayExpression:function(e){this.displayExpression=e},buildDisplayExpression:function(){return this.displayExpression},buildFilterJson:function(){return this.options.psJson},getFilterXML:function(){return this.xml},buildFilterXML:function(){var e=this;e.xml="";var t=0,i="";return window.DescriptionCount||(window.DescriptionCount=1),window.DescriptionCount++,this.caLabelIdentifierMap.forEach((function(n,o){e.xml+=`<OperationHandler Name="${n.identifier}" Type="Change" OperationHandlerId="${t}" DescId="${window.DescriptionCount}"/>`,0==t?i+=o:i=i+", "+o,e.xmlDesc.push(`<OperationHandler DescId = "${window.DescriptionCount}" DisplayName="${o}"/>`),t++,window.DescriptionCount++})),e.updateDisplayExpression(i),this.xml},setFilterXML:function(e){this.xml=e},buildDescription:function(){return this.xmlDesc},show:function(){this.textBox.show(),this.editButton&&this.editButton.show()},hide:function(){this.textBox.hide(),this.editButton&&this.editButton.hide()},initialiseComponent:function(e){var t,i=this,n="",o="",a="";null==e.caNameArray&&null==e.caNameArray||e.caNameArray.forEach((function(e,t){0==t?a+="([ds6w:identifier]:("+e+"))":a=a+" OR ([ds6w:identifier]:("+e+"))"})),null==e.caIDArray&&null==e.caIDArray||e.caIDArray.forEach((function(e,t){a=0==t?"physicalid:"+e:a+" OR physicalid:"+e}));n={with_indexing_date:!0,with_nls:!1,label:"yus-1515078503005",locale:"en",select_predicate:["ds6w:label","ds6w:description","ds6w:identifier"],select_file:["icon","thumbnail_2d"],query:"flattenedtaxonomies:(types/Change Action) AND ("+a+")",order_by:"desc",order_field:"relevance",nresults:1e3,start:"0",source:[],tenant:enoviaServerFilterWidget.tenant};t={isfederated:"true"};n=JSON.stringify(n);s.makeWSCall("/search?xrequestedwith=xmlhttprequest","POST","enovia","application/json",n,(function(e){e.results.forEach((function(e,t){if(null!=e&&e.attributes.length>0){for(var n="",s="",a="",r=0;r<e.attributes.length;r++)"ds6w:label"==e.attributes[r].name?(n=e.attributes[r].value,0==t?o+=e.attributes[r].value:o=o+", "+e.attributes[r].value):"ds6w:identifier"==e.attributes[r].name?s=e.attributes[r].value:"resourceid"==e.attributes[r].name&&(a=e.attributes[r].value);i.createCADiv(n),i.caLabelIdentifierMap.set(n,{identifier:s,physicalID:a}),i.excludeCAList.push(a)}})),i.buildFilterXML()}),(function(e){reject(e)}),!0,t)}})})),define("DS/CfgFilterUX/CfgPCChooser",["UWA/Class/View","UWA/Class/Model","DS/WUXAutoComplete/AutoComplete","DS/CfgBaseUX/scripts/CfgSearchConfiguration","DS/CfgBaseUX/scripts/CfgData","DS/CfgBaseUX/scripts/CfgUtility","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","text!DS/CfgBaseUX/assets/CfgUXEnvVariables.json","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX","css!DS/CfgFilterUX/CfgFilterUX.css"],(function(e,t,i,n,o,s,a,r,l,c){"use strict";return e.extend({model:t.extend({ID:"",type:"",label:"",revision:""}),className:"CFGPCAutoComplete",init:function(e){this._parent(e),this.model=new t,this.listenTo(this.model,"onChange:label",this.updateView),this.modelID=e.modelID},updateView:function(){let e=this.model.get("label")||"",t=this.model.get("revision")||"";this.pcAutoComplete.value=t?`${e}-${t}`:e},launchAsyncPCSearch:function(){let e=this;return new Promise(((t,i)=>{let n={"3dspace":{SecurityContext:enoviaServerFilterWidget.mySecurityContext}},o={with_indexing_date:!0,with_nls:!1,label:"yus-1515078503005",locale:"en",select_predicate:["ds6w:label","ds6w:identifier","ds6wg:revision"],select_file:["icon","thumbnail_2d"],query:this.getQuery(),order_by:"desc",order_field:"relevance",nresults:1e3,start:"0",source:[],tenant:e.options.tenant};""!=enoviaServerFilterWidget.mySecurityContext&&(o.login=n);o=JSON.stringify(o),s.makeWSCall("/search?xrequestedwith=xmlhttprequest","POST","enovia","application/json",o,(function(i){if(!i.results||!Array.isArray(i.results))return void t([]);let n=e.prepareTreeForAutoComplete(i.results);t(n)}),(function(){i()}),!0,{isfederated:"true"})}))},prepareTreeForAutoComplete:function(e){let t=new a;return t.prepareUpdate(),e.forEach((e=>{let i=this.getAttrValue(e,"ds6wg:revision"),n=this.getAttrValue(e,"ds6w:label"),o=this.getAttrValue(e,"ds6w:identifier"),s=new r({label:`${n}-${i}`,value:o,icon:this.getAttrValue(e,"type_icon_url"),grid:{ID:this.getAttrValue(e,"resourceid"),type:this.getAttrValue(e,"ds6w:what/ds6w:type"),pclabel:n,revision:i,tags:n+i+o}});t.addRoot(s)})),t.pushUpdate(),t},getAttrValue:function(e,t){let i="";return e.attributes.length<=0||e.attributes.forEach((e=>{e.name==t&&(i=e.value)})),i},updateAutoCompleteModel:function(){this.pcAutoComplete.elementsTree&&(this.pcAutoComplete.value="",this.pcAutoComplete.elementsTree=void 0,this.pcAutoComplete.elementsTree=()=>this.launchAsyncPCSearch())},render:function(){let e=this;this.isBCFilterEnabled=!1,s.getSupportedFeatures().then((e=>{e&&e.features&&e.features.enableBaseConfigurationFilter&&(this.isBCFilterEnabled=e.features.enableBaseConfigurationFilter)})),this.pcAutoComplete=new i({elementsTree:()=>e.launchAsyncPCSearch(),multiSearchMode:!1,minLengthBeforeSearch:0,allowFreeInputFlag:!1,filterCB:function(e){this.filterItems(e,{property:"tags"})}}),this.pcAutoComplete.inject(e.options.parentDiv),this.pcAutoComplete.addEventListener("uncommittedChange",(e=>{e&&e.options&&e.options.uncommittedValue?this.pcSearchBtn&&this.pcSearchBtn.hide():this.pcSearchBtn&&(this.pcSearchBtn.show(),this.options.clearProductConfLabelInfo())})),this.pcAutoComplete.addEventListener("change",(t=>{if(t&&t.dsModel&&t.dsModel.selectedItems){this.pcSearchBtn&&this.pcSearchBtn.hide();let i=t.dsModel.selectedItems.getAttributeValue("ID");i&&(e.model.set("ID",i),e.model.set("revision",t.dsModel.selectedItems.getAttributeValue("revision")),e.model.set("label",t.dsModel.selectedItems.getAttributeValue("pclabel")),e.model.set("type",t.dsModel.selectedItems.getAttributeValue("type"))),e.options.processPCCallback()}else this.pcSearchBtn&&(this.pcSearchBtn.show(),this.options.clearProductConfLabelInfo())})),this.pcSearchBtn=UWA.createElement("span").inject(e.options.parentDiv),this.pcSearchBtn.set({events:{click:function(t){e.launchInContextPCSearch(t)}}}),this.pcSearchBtn.addClassName("fonticon"),this.pcSearchBtn.addClassName("fonticon-1.5x"),this.pcSearchBtn.addClassName("fonticon-search"),this.pcSearchBtn.addClassName("searchbutton"),e.options.PCID&&e.model.set("ID",e.options.PCID),e.options.PCRev&&e.model.set("revision",e.options.PCRev),e.options.PCLabel&&e.model.set("label",e.options.PCLabel),e.options.PCType&&e.model.set("type",e.options.PCType)},setModelID:function(e){this.modelID=e},launchInContextPCSearch:function(){let e=this,t=c.selectProductConfigurationForFilter,i=enoviaServerFilterWidget.myRole;if("Native"==window.enoviaServerFilterWidget.mode){var o={precondition:additionalPrecond},a={eventName:"cfgConfigurationFilter",operation:"ActivateSearchPC",operationVersion:"1.0",content:JSON.stringify(o)};s.sendNotificationWebInWin(a)}else{new n(!1,t).activate(t,"",i,(function(t){t=t[0];var i=["id","ds6w:label","ds6wg:revision","ds6w:type_value"];let n="";Object.keys(t._attributes).forEach((function(o){-1!==i.indexOf(o)&&("ds6wg:revision"==o?e.model.set("revision",t.get(o)):"ds6w:label"==o?n=t.get(o):"ds6w:type_value"==o?e.model.set("type",t.get(o)):e.model.set("ID",t.get(o)))})),e.model.set("label",n)}),"","",this.getQuery())}},show:function(){this.pcAutoComplete.show(),this.pcSearchBtn&&!this.pcAutoComplete.value&&this.pcSearchBtn.show()},hide:function(){this.pcAutoComplete.hide(),this.pcSearchBtn&&this.pcSearchBtn.hide()},getQuery:function(){let e="",t="",i=o.singleProductId;(o.productstateCheckbox&&0==o.productstateCheckbox.checkFlag||o.xRevCheckBox&&!1===o.xRevCheckBox.checkFlag)&&(i=""),i?(e=`(based_95_on_95_model_95_version_95_pid: ${i})`,t=`(bc_95_based_95_on_95_model_95_version_95_pid: ${i})`):(e=`(based_95_on_95_model_95_pid: ${this.modelID})`,t=`(bc_95_based_95_on_95_model_95_pid: ${this.modelID})`);const n=t?`(flattenedtaxonomies:"types/Model Type" AND ${t})`:'(flattenedtaxonomies:"types/Model Type")',s=e?`(flattenedtaxonomies:"types/Product Configuration" AND ${e})`:'(flattenedtaxonomies:"types/Product Configuration")';let a="";return a=this.isBCFilterEnabled?`${s} OR ${n}`:`${s}`,a}})})),define("DS/CfgFilterUX/CfgVariantEditor",["UWA/Core","UWA/Controls/Abstract","DS/UIKIT/Input/Button","DS/ConfiguratorPanel/scripts/Presenters/PCPanel","DS/ConfiguratorPanel/scripts/ConfiguratorSolverFunctions","DS/CoreEvents/ModelEvents","DS/UIKIT/Modal","DS/UIKIT/Spinner","DS/UIKIT/Mask","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgBaseUX/scripts/CfgContainerView","DS/CfgFilterUX/CfgFilterSlideInComponent","text!DS/CfgFilterUX/CfgFilterslideInDialogTemplate.html","DS/CfgBaseUX/scripts/CfgData","i18n!DS/CfgFilterUX/assets/nls/CfgFilterUX","text!DS/CfgBaseUX/assets/CfgUXEnvVariables.json","css!DS/CfgFilterUX/CfgFilterUX.css"],(function(e,t,i,n,o,s,a,r,l,c,d,p,h,C,u,g){"use strict";return t.extend({init:function(t){C.selectedOptionsforConfigurator="",this.options=t?e.clone(t,!1):{};var i={useSolver:!0,configData:{xml:"",displayXml:"",xmlDesc:""},parentContainer:document.body};e.merge(this.options,i),"Filter"==this.options.invokeFrom||this.getModal(),this.modelEvent=new s,e.is(this.options.onOK,"function")&&this.modelEvent.subscribe({event:"onCfgDataChange"},this.options.onOK)},render:function(){this.options.dataFromPC&&(this.options.configuration=this.options.dataFromPC.configurationData.configurationCriteria,this.options.cfgCriteria="{}",this.options.dataFromPC.startDate&&(this.options.cfgCriteria='{"date":{"startDate":"'+this.options.startDate+'","endDate":""}, "milestone":{"id":""}, "productState":{"productRev":""}}')),this.buildSkeleton()},buildSkeleton:function(){this.configModelEvents=new s,this.ws_pcModel=this.options.configuration,this.VariantsConfigPanelContainer=e.createElement("div",{class:"VariantsConfigPanelContainer"}),this.initializePanel()},initializePanel:function(){var e=this;this.ws_dictionary,this.modal?(this.modal.setBody(this.VariantsConfigPanelContainer),l.unmask(this.modal.elements.body)):window.enoviaServerFilterWidget&&"Native"==window.enoviaServerFilterWidget.mode?this.getLayoutForConfigurator():this.getPanelForConfigurator(),c.isParamDefined(e.options.configuratorOptions)||(e.options.configuratorOptions={initialRuleLevel:"RulesMode_EnforceRequiredOptions",rulesActivation:"true"});let t="selectionMode_Build";JSON.parse(g).ConfiguratorInDefaultBuildMode||C.filter150Checkbox&&C.filter150Checkbox.checkFlag&&(t="selectionMode_Refine");var i={version:"V5",realistic:!1,tenant:enoviaServerFilterWidget.tenant,isWebInWin:!0,enableTableView:!0,"3DSpaceUrl":enoviaServerFilterWidget.baseURL,mvId:C.singleProductId,ruleLevels:{RulesMode_ProposeOptimizedConfiguration:!1,RulesMode_SelectCompleteConfiguration:!1,RulesMode_EnforceRequiredOptions:!0,RulesMode_DisableIncompatibleOptions:!0},initalOptions:{initialRuleLevel:e.options.configuratorOptions.initialRuleLevel,initialMode:t},rulesActivation:e.options.configuratorOptions.rulesActivation,configCriteria:e.options.cfgCriteria,securityContext:enoviaServerFilterWidget.mySecurityContext};console.log("Config UX: options to launch PCPanel: ",i),this.PCPanel1=new n(e.ws_pcModel,null,e.configModelEvents,i),e.configModelEvents.subscribe({event:"pc-loaded"},(function(){e.PCPanel1.inject(e.VariantsConfigPanelContainer),e.VariantsConfigPanelContainer.getElement("#PC-panel-container").addClassName("variants-configuratorPanel");var t=document.getElementsByClassName("topbar-MidMenu-Container").item(0);null!=t&&t.addClassName("variants-topbarMidMenuContainer"),l.unmask(e.VariantsConfigPanelContainer),"Filter"==e.options.invokeFrom&&(l.unmask(e.options.filterParentContainer),l.unmask(e.options.filterParent))}))},publishPanelData:function(){this.formattedInnerXML=void 0===this.formattedInnerXML?"":this.formattedInnerXML,this.modelEvent.publish({event:"onCfgDataChange",data:{displayXml:this.formattedInnerDisplayXML,xml:this.formattedInnerXML,PCId:this.options.PCId,configuration:this.options.configuration,selectionmode:this.PCPanel1.getConfigmodel().getAppRulesParam().selectionMode,xmlDesc:this.options.configData.xmlDesc,configuratorOptions:this.options.configuratorOptions}})},createActionsPresenter:function(){var t=e.createElement("div",{class:"actionsContainer"});if(e.is(this.options.onBack,"function")&&new i({value:u.Filter_VariantEditor_Back}).inject(t).elements.container.addClassName("variant-editor-backBtn"),!n){var n=e.createElement("div",{class:"OKCancelContainer"}).inject(t);new i({value:u.Filter_VariantEditor_Ok,className:"primary btn btn-primary variant-editor-okBtn"}).inject(n);new i({value:u.Filter_VariantEditor_Cancel}).inject(n).elements.container.addClassName("variant-editor-cancelBtn")}return t},destroy:function(){o.releaseSolver(),delete this.configModel,delete this.options.modelEvents,delete this.VariantsConfigPanelContainer},getModal:function(){var t=this;this.modal=new a({className:"site-reset",closable:!0,overlay:!0,escapeToClose:!1,header:"<h4>"+u.Filter_VariantEditor_Header+"</h4>",body:this.VariantsConfigPanelContainer,footer:this.createActionsPresenter(),events:{onShow:function(){l.mask(t.modal.elements.body)}}}).inject(this.options.parentContainer),this.modal.getContent().getElements(".btn").forEach((function(i){i.addEvent("click",(function(){if(this.hasClassName("variant-editor-backBtn")||this.hasClassName("variant-editor-cancelBtn")){t.formattedInnerXML="",t.options.configData.xml="";var i={xml:"",PCId:""};e.is(t.options.onCancel,"function")&&(this.hasClassName("variant-editor-backBtn")?t.options.onBack(i):t.options.onCancel(i))}this.hasClassName("variant-editor-okBtn")&&(t.PCPanel1._configModel.getXMLExpression?t.options.configData.xml=t.PCPanel1._configModel.getXMLExpression():t.PCPanel1.getXMLProductConfigurationDefinition&&(t.options.configData.xml=t.PCPanel1.getXMLProductConfigurationDefinition()),t.options.configData.displayXml=t.getDisplayXML(t.options.configData.xml),C.selectedOptionsforConfigurator=t.PCPanel1._configModel.getConfigurationCriteria(),console.log(t.options.configData.xml),t.options.configuration=t.PCPanel1._configurations,t.formattedInnerXML=t.getInnerXML(),t.publishPanelData()),t.destroy(),t.modal.destroy(),console.log("Modal destroyed with all references")}))})),this.modal.elements.close.onclick=function(){t.destroy(),t.modal.destroy()},this.modal.elements.body.addClassName("variant-modal-body"),this.modal.elements.content.addClassName("variant-modal-content"),this.modal.show()},getDisplayXML:function(e){for(var t=(new DOMParser).parseFromString(e,"text/xml"),i=t.getElementsByTagName("Feature").length,n=0;n<i;n++)t.getElementsByTagName("Feature")[n].setAttribute("Name",t.getElementsByTagName("Feature")[n].getAttribute("DisplayName")),t.getElementsByTagName("Feature")[n].removeAttribute("DisplayName");return(new XMLSerializer).serializeToString(t)},convertVariantXMLToXMLWithDescIDs:function(e){let t=[],i=(new DOMParser).parseFromString(e,"text/xml"),n=i.getElementsByTagName("FilterSelection");if(n&&n.length>0){let e=[],i=n[0].children;e=i&&1==i.length&&"Context"==i[0].tagName?i[0].children:n[0].children;let o=e.length;for(let i=0;i<o;i++)if("NOT"==e[i].tagName){let n=e[i].children.length,o=e[i].children;for(let e=0;e<n;e++)this.addAttributes(o[e],t)}else this.addAttributes(e[i],t)}let o=(new XMLSerializer).serializeToString(i);this.options.configData.xml=o,this.options.configData.xmlDesc=t},addAttributes:function(e,t){window.DescriptionCount++,e.setAttribute("DescId",window.DescriptionCount);var i='<Feature DescId = "'+window.DescriptionCount+'" DisplayName="'+c.escapeSpecialCharacters(e.getAttribute("DisplayName"))+'"></Feature>';t.push(i),e.removeAttribute("DisplayName");for(var n=e.children.length,o=e.children,s=0;s<n;s++){window.DescriptionCount++,o[s].setAttribute("DescId",window.DescriptionCount);i='<Option DescId = "'+window.DescriptionCount+'" DisplayName="'+c.escapeSpecialCharacters(o[s].getAttribute("DisplayName"))+'" SequenceOrder="'+window.DescriptionCount+'"></Option>';t.push(i),o[s].removeAttribute("DisplayName"),o[s].removeAttribute("SelectedBy")}},getLayoutForConfigurator:function(){var e=this;C.ModelEvents.publish({event:"ConfiguratorLaunched"});var t={isHeader:!0,isFooter:!0,firstButtonText:u.Filter_VariantEditor_Ok,secondButtonText:u.Filter_VariantEditor_Cancel,headerText:u.Filter_VariantEditor_Header,onButtonClickCB:function(t){if(l.unmask(e.VariantsConfigPanelContainer),"Filter"==e.options.invokeFrom&&(l.unmask(e.options.filterParentContainer),l.unmask(e.options.filterParent)),"firstButton"==t.buttonId)e.PCPanel1._configModel.getXMLExpression?e.options.configData.xml=e.PCPanel1._configModel.getXMLExpression():e.PCPanel1.getXMLProductConfigurationDefinition&&(e.options.configData.xml=e.PCPanel1.getXMLProductConfigurationDefinition()),e.options.configData.displayXml=e.getDisplayXML(e.options.configData.xml),e.convertVariantXMLToXMLWithDescIDs(e.options.configData.xml),C.selectedOptionsforConfigurator=e.PCPanel1._configModel.getConfigurationCriteria(),e.options.configuratorOptions={initialRuleLevel:e.PCPanel1.getConfigmodel().getRulesMode(),rulesActivation:e.PCPanel1.getConfigmodel().getRulesActivation()},console.log(e.options.configData.xml),e.options.configuration=e.PCPanel1._configurations,e.formattedInnerXML=e.getInnerXML(),e.formattedInnerDisplayXML=e.getInnerDisplayXML(),e.publishPanelData(),e.destroy();else if("secondButton"==t.buttonId){e.formattedInnerXML="",e.formattedInnerDisplayXML="",e.options.configData.xml="",e.options.configData.displayXml="";C.selectedOptionsforConfigurator=e.options.configuration}e.containerView.destroy(),C.ModelEvents.publish({event:"ConfiguratorClosed"})}};this.containerView=new d(t).render(),this.containerView.inject(C.renderTo),this.VariantsConfigPanelContainer.inject(this.containerView._body)},getPanelForConfigurator:function(){var e=this,t={dialogue:{buttonArray:[{label:u.Filter_VariantEditor_Cancel,handler:function(){e.formattedInnerXML="",e.formattedInnerDisplayXML="",e.options.configData.xml="",e.options.configData.displayXml="";C.selectedOptionsforConfigurator=e.options.configuration,require(["DS/CfgFilterUX/CfgFilterFactory"],(function(e){C.renderToApp&&C.renderToApp.empty(),e.showFilter()}))},className:"default"},{label:u.Filter_VariantEditor_Ok,handler:function(t){e.PCPanel1._configModel.getXMLExpression?e.options.configData.xml=e.PCPanel1._configModel.getXMLExpression():e.PCPanel1.getXMLProductConfigurationDefinition&&(e.options.configData.xml=e.PCPanel1.getXMLProductConfigurationDefinition()),e.options.configData.displayXml=e.getDisplayXML(e.options.configData.xml),e.convertVariantXMLToXMLWithDescIDs(e.options.configData.xml),C.selectedOptionsforConfigurator=e.PCPanel1._configModel.getConfigurationCriteria(),e.options.configuratorOptions={initialRuleLevel:e.PCPanel1.getConfigmodel().getRulesMode(),rulesActivation:e.PCPanel1.getConfigmodel().getRulesActivation()},console.log(e.options.configData.xml),e.options.configuration=e.PCPanel1._configurations,e.formattedInnerXML=e.getInnerXML(),e.formattedInnerDisplayXML=e.getInnerDisplayXML(),""==e.formattedInnerXML&&""==e.formattedInnerDisplayXML&&(e.options.configData.displayXml="",e.options.configData.xml=""),e.publishPanelData(),e.destroy(),require(["DS/CfgFilterUX/CfgFilterFactory"],(function(e){C.renderToApp&&C.renderToApp.empty(),e.showFilter()}))},className:"primary"}],showHeader:!0,showButton:!0},HeaderLabel:u.Filter_VariantEditor_Header,displayCompactMode:this.options.displayCompactMode};p.init(C.renderToApp,this.VariantsConfigPanelContainer,t,h)},getInnerXML:function(){var e,t,i,n,o,s,a="";return(e=this.options.configData.xml)&&(t=e.indexOf("<Feature"),i=e.indexOf("</FilterSelection>"),-1!==(s=e.indexOf("<NOT"))&&s<t&&(t=s),n=e.slice(t,i),o=function(e){var t,i,n;t=e.indexOf("SelectedBy"),i=e.indexOf("/",t),-1===(n=e.substr(0,t)+e.substr(i,e.length+1)).indexOf("SelectedBy")?a=n:o(n)},-1!=n.indexOf("SelectedBy")?(o(n),console.log(a)):a=n),a},getInnerDisplayXML:function(){var e,t,i,n,o,s,a="";return(e=this.options.configData.displayXml)&&(t=e.indexOf("<Feature"),i=e.indexOf("</FilterSelection>"),-1!==(s=e.indexOf("<NOT"))&&s<t&&(t=s),n=e.slice(t,i),o=function(e){var t,i,n;t=e.indexOf("SelectedBy"),i=e.indexOf("/",t),-1===(n=e.substr(0,t)+e.substr(i,e.length+1)).indexOf("SelectedBy")?a=n:o(n)},-1!=n.indexOf("SelectedBy")&&(o(n),console.log(a))),a}})})),define("DS/CfgFilterUX/CfgFilterEditor",["UWA/Drivers/Alone","DS/Core/Core","UWA/Class/View","DS/Handlebars/Handlebars4","text!DS/CfgBaseUX/scripts/CfgDialogTemplate.html","DS/UIKIT/Alert","DS/UIKIT/Modal","DS/Controls/Toggle","DS/Controls/TooltipModel","DS/CfgEvolutionUX/CfgModelSelection","DS/CfgEvolutionUX/CfgProductState","DS/CfgFilterUX/CfgChangeActionCriteria","DS/CfgBaseUX/scripts/CfgData","UWA/Class/Promise","DS/CfgBaseUX/scripts/CfgXMLServices","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgBaseUX/scripts/CfgXRevisionUtility","DS/CfgEvolutionUX/CfgWUXDatePicker","DS/CfgEvolutionUX/CfgUnit","DS/CfgEvolutionUX/CfgVariants","DS/CfgEvolutionUX/CfgConfigurationRevisionPicker","DS/CfgFilterUX/CfgFilterSlideInComponent","DS/UIKIT/Mask","DS/CfgEvolutionUX/CfgEvolutionViewSelector","DS/CfgBaseUX/scripts/CfgSearchConfiguration","DS/CfgBaseUX/scripts/CfgDialog","DS/CfgBaseUX/scripts/CfgCacheManager","DS/CfgBaseUX/scripts/CfgEvolutionRange","DS/CfgTracker/CfgTracker","DS/CfgTracker/CfgDimension","DS/CfgTracker/CfgValue","DS/CfgBaseUX/scripts/CfgUXEnvVariables","text!DS/CfgFilterUX/CfgFilterslideInTemplate.html","i18n!DS/CfgFilterUX/assets/nls/CfgFilterUX","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX","i18n!DS/CfgEffectivityViewUX/assets/nls/CfgEffectivityView","css!DS/UIKIT/UIKIT.css","css!DS/CfgFilterUX/CfgFilterUX.css"],(function(e,t,i,n,o,s,a,r,l,c,d,p,h,C,u,g,f,m,v,b,x,D,F,k,y,I,S,P,R,E,M,A,w,N,_,O){"use strict";var L=n.compile(o);return i.extend({name:"filter-dialog-view",globalDisplayExpression:"",globalDisplayExpressionNative:"",tagName:"div",ModelSelectionComponent:null,alertDiv:null,productstateCheckbox:null,ProductStateComponent:null,currentSelectedView:{view:""},DateCheckbox:null,DatePicker:null,UnitCheckbox:null,UnitComponent:null,VariantsCheckbox:null,VariantsComponent:null,filter150Checkbox:null,manufacturingplanComponent:null,manufacturingplanCheckbox:null,configurationRevisionCheckbox:null,cfgConfigurationRevisionPicker:null,probesData:[],init:function(e){this.probesData=[],this.editFilterCase=!!(e.expression&&Object.keys(e.expression).length>0),this.cfgUXEnvVariables=A.getCfgUXEnvVariables(),"xRevision"===e.filterBasedOn&&(this.isXRev=!0),this.singleProductEvolutionStatus=!0,e.EvolutionLabel=N.Filter_Evolution,e.ModelLabel=N.Filter_Model,(this.isXRev&&!e.xRevScopeDefined||"ModelVersion"==e.filterBasedOn)&&(e.ModelLabel=""),e.VariantsLabel=N.Filter_Variants,"ModelVersion"!=e.filterBasedOn&&(e.ChangeLabel=N.Filter_Change);var t="";e.expression.filterXML?(t=u.FilterXMLtoJSONConvertor(e.expression.filterXML),u.RetrieveVariantXMLFromFilterXML(e.expression),g.isDefined(e.expression.variants)&&(t[0].expression.iVariantsJson=e.expression.variants),t[0].expression.viewJson={view:e.expression.view},t[0].expression.modelId=e.expression.modelId,this.isXRev&&(t[0].expression.singleProductId=e.expression.singleProductId||""),e.expression=t[0].expression):g.isDefined(e.expression.variants)&&(e.expression.iVariantsJson=e.expression.variants),0!=Object.keys(e.expression).length&&this.checkSingleProductID(e.expression),this._parent(e),h.clear();var i="Native"==enoviaServerFilterWidget.mode?document.body.querySelector(".wiwFilterAlertDiv"):document.body.querySelector(".f-globalFilter-container");this.NotifsParentContainer=i,this.alertDiv=new s({visible:!1,autoHide:!0,hideDelay:3e3,closeOnClick:!0,maximumVisibleMessages:3,className:"error"}),this.alertDiv.inject(i,"top")},getDataFromID:function(e){window&&!window.DescriptionCount&&(window.DescriptionCount=1);var t=this;return new C((function(i,n){if(!g.isParamDefined(e.physical_id))return void i();let o={id:e.physical_id},s=JSON.stringify(o);g.makeWSCall("/resources/v1/modeler/dspfl/invoke/dspfl:getCriteriaConfigurationInstances?xrequestedwith=xmlhttprequest","POST","enovia","application/json",s,(function(n){if(g.isParamDefined(n.modelVersion)||(g.showNotifs("error",N.Filter_MVNotFound,N.Filter_RefreshWidget,"",that.NotifsParentContainer),t.options.expression={},n.modelVersion=!1),!g.isDefined(n.member)||!Array.isArray(n.member))return t.alertDiv.add({message:N.Filter_Error_FetchDataUsing_ConfigID,style:{position:"absolute"},className:"error"}),t.alertDiv.show(),t.options.expression={},n.modelVersion=!1,void i();var o=new b({});o.selectedPCPID=e.physical_id;let{variantsXML:s,variantXMLDesc:a}=o.getXMLExpressionFromPCCriteria(n.member);var r=o.getDisplayXMLExpressionFromPCCriteria(n.member),l=u.startFilterXML()+r+u.endFilterXML(),c={displayExpression:g.getDisplayExpressionUsingXSLT(l),xmlExpression:s,basedOnMVID:n.modelVersion,selectedPCPID:e.physical_id,selectedPCDisplayName:n.title,selectedPCRevision:n.revision,selectedPCMode:n.selectionMode,selectedPCType:"Product Configuration"};0!=Object.keys(t.options.expression).length&&g.isParamDefined(c)&&(t.options.expression.iVariantsJson=c,t.options.expression.pcCheckFlag=!0,"Refine"===n.selectionMode&&(t.options.expression.refineModecheckbox=!0)),i()}),(function(e){t.alertDiv.add({message:N.Filter_Error_FetchDataUsing_ConfigID,style:{position:"absolute"},className:"error"}),t.alertDiv.show()}),!0,null)}))},checkSingleProductID:function(e){return this.promiseSingleMVID=new C((function(t,i){let n=e.xmlExpression||e.xRevXml,o=e.psJson||e.xRevJson;if(n){if(-1!=n.indexOf("<Tree>")||o.length>1)return h.singleProductId="",void t();var s=(new DOMParser).parseFromString(n,"text/xml").getElementsByTagName("Single");if(0!=s.length){if(e.xRevXml)return h.singleProductId=e.singleProductId||"",void t();var a=s[0].attributes.Name.value,r=s[0].attributes.Revision.value,l=(s[0].attributes.DescId.value,{with_indexing_date:!0,with_nls:!1,label:"yus-1515078503005",locale:"en",select_predicate:["ds6w:label","ds6wg:revision","revision","ds6w:type","ds6w:description","ds6w:identifier","ds6w:modified","ds6w:created","ds6w:responsible","ds6w:lastModifiedBy","ds6wg:marketing_Name"],select_file:["icon","thumbnail_2d"],query:"flattenedtaxonomies:(types/Products) AND ("+("(([name]:("+a+")) AND ([ds6wg:revision]:("+r+")))")+")",order_by:"desc",order_field:"relevance",nresults:1e3,start:"0",source:[],tenant:enoviaServerFilterWidget.tenant});l=JSON.stringify(l);g.makeWSCall("/search?xrequestedwith=xmlhttprequest","POST","enovia","application/json",l,(function(e){var n="";if(g.isDefined(e.results)&&g.isDefined(e.results[0])&&g.isDefined(e.results[0].attributes)){if(e.results[0].attributes.length>0)for(var o=0;o<e.results[0].attributes.length;o++)"resourceid"==e.results[0].attributes[o].name&&(n=e.results[0].attributes[o].value);h.singleProductId=n,t()}else i("Filter_MVNotFound")}),(function(){i("Filter_MVSearchFailed")}),!0,{isfederated:"true"})}else t()}else t()})),this.promiseSingleMVID},getModelMarketingName:function(e){for(var t=0;t<e.length;t++)if("Marketing Name"==e[t].name)return e[t].value},getModelName:function(e){for(var t=0;t<e.length;t++)if("name"==e[t].name){if(Array.isArray(e[t].value))return e[t].value;var i=[];return i.push(e[t].value),i}},getCRNodeInfo:function(e){var t="",i="",n="";if(null!=e.data[0]&&0!=Object.keys(e.data[0].dataelements).length&&(t=e.data[0].dataelements.revision,n=e.data[0].dataelements.title,i=e.data[0].dataelements.title),""!=t&&""!=i&&""!=n)return{id:this.options.expression.configurationRevision,physicalid:this.options.expression.configurationRevision,type:"ConfiguredBaseline",displayName:n,revision:t,name:i}},publishFilterViewChangeEvent:function(){h.ModelEvents.publish({event:"FilterViewChanged",data:{currentSelectedView:this.currentSelectedView}})},clearCAComponent:function(){g.isDefined(this.changeActionComponent)&&this.changeActionComponent.clearCAComponent(),g.isDefined(this.changeActionCheckbox)&&(this.changeActionCheckbox.checkFlag=!1,this.changeActionComponent.hide())},handleConfiguratorBasedOnPromise:function(e){this.VariantsComponent&&this.VariantsComponent.configuratorButton&&e.then((()=>{this.VariantsComponent.configuratorButton.removeClassName("cfgWaitCursor")}),(e=>{this.VariantsComponent.configuratorButton.removeClassName("cfgWaitCursor"),this.VariantsComponent.configuratorButton.addClassName("disableButton");let t="";"Filter_MVSearchFailed"==e?t=N.Filter_MVSearchFailed:"Filter_MVNotFound"==e&&(t=N.Filter_MVNotFound),t&&g.showNotifs("error",t,N.Filter_RefreshWidget,"",this.NotifsParentContainer)}))},render:function(){var e=this;g.rolesAvailable((async t=>{h.ModelEvents.subscribe({event:"PrepareConfiguratorDataFromXML"},(async()=>{try{this.VariantsComponent&&this.VariantsComponent.configuratorButton&&this.VariantsComponent.configuratorButton.addClassName("cfgWaitCursor"),this.options.expression.filterXML=this.buildFilterXML(),this.options.expression.variants||(this.options.expression.variants={});let e=u.RetrieveConfiguratorDataFromFilterXML(this.options.expression);this.handleConfiguratorBasedOnPromise(e)}catch(e){console.error(`PrepareConfiguratorDataFromXML failed :  ${e}`)}})),e.userGrantedRoles=t,h.renderTo=e.options.renderTo,h.renderToApp=e.options.renderToApp,this.container.setHTML(L(this.options));var i={dialogue:{buttonArray:[],showHeader:!1}};i.displayCompactMode=this.options.displayCompactMode,document.querySelector(".operations-main-container")&&document.querySelector(".operations-main-container").destroy(),D.init(h.renderTo,this.container,i,w);var n=document.querySelector("#checkCfgfilterBtn");n.addEventListener("click",(function(t){if(e.probesData.push("Validate_Button_Click"),null!=e.UnitComponent&&0==e.UnitComponent.validate())return;""==e.VariantsComponent.textBox.getText()&&(e.VariantsComponent.xmlExpression="",e.VariantsComponent.displayExpression="");null!=e.manufacturingplanComponent&&""==e.manufacturingplanComponent.textBox.getText()&&(e.manufacturingplanComponent.xml="",e.manufacturingplanComponent.displayExpression="");e.onApplyFilter(t,e)}),!1),"Native"==enoviaServerFilterWidget.mode&&n.hide(),"ModelVersion"!=this.options.filterBasedOn&&e.createFilterSettingsComponent();var o=[],s=-1,a=null,c=null,p=!0,C=!1,f=!1,x=!1;if(0!=Object.keys(e.options.expression).length&&(a=e.options.expression.psJson,c=e.options.expression.mpJson,p=e.options.expression.productstatecheckbox,C=e.options.expression.unitcheckbox,f=e.options.expression.datestatecheckbox,x=e.options.expression.manufacturingplanCheckbox),({Models:o,currentindex:s}=this.createModelSelectionComponent()),this.createViewSelectionComponent(),e.userGrantedRoles.isCSVRoleAvail&&(e.isLicenseValid=!1),this.isXRev){let e=this.editFilterCase?this.options.expression.xRevJson:[],t=this.editFilterCase?this.options.expression.xRevXml:"",i=[],n="";if(this.options.expression.configurationRecord){h.singleConfigurationRecordId=this.options.expression.configurationRecord;let e=await g.getObjectInfo(this.options.expression.configurationRecord),t=this.getCRNodeInfo(e);this.options.expression.configRecordXML='<Single Revision = "'+t.revision+'"/>',this.options.expression.configRecordJSON=[P.getRange("",t.revision,t.title)],i=this.editFilterCase?this.options.expression.configRecordJSON:[],n=this.editFilterCase?this.options.expression.configRecordXML:""}return 1==h.configurationCriteria.xRevisionCFGRecordActivation&&(({checkBox:this.configRecordCheckBox,psComponent:this.configRecordComp}=this.buildRevSelectionComponent("CONFIGRECORD",i,n)),h.configRecordCheckBox=this.configRecordCheckBox,h.configRecordComp=this.configRecordComp),({checkBox:this.xRevCheckBox,psComponent:this.xRevComp}=this.buildRevSelectionComponent("XREVISION",e,t)),h.xRevCheckBox=this.xRevCheckBox,h.xRevComp=this.xRevComp,this.buildVariantsComponent({model:o[s]}),this.pubSubEvents(),this.applyCompactComfortableMode(this.options.displayCompactMode),this.createChangeComponent(),void(this.editFilterCase&&h.singleConfigurationRecordId&&this.manageRevisionDisplay(!1))}if("ModelVersion"==this.options.filterBasedOn){if(!this.options.modelVersionList||0==this.options.modelVersionList.length)return;o.push({valueItem:this.options.modelVersionList[0].modelID,labelItem:this.options.modelVersionList[0].modelName,name:this.options.modelVersionList[0].modelName});let e=this.editFilterCase?this.options.expression.psJson:[],t=this.editFilterCase?this.options.expression.xmlExpression:"";return({checkBox:this.productstateCheckbox,psComponent:this.ProductStateComponent}=this.buildRevSelectionComponent("PRODUCTS",e,t,{model:o[0]})),this.ProductStateComponent.editButton&&this.ProductStateComponent.editButton.addClassName("disableButton"),this.ProductStateComponent.textBox.addClassName("disableButton"),this.productstateCheckbox.disabled=!0,h.productstateCheckbox=this.productstateCheckbox,h.ProductStateComponent=this.ProductStateComponent,this.buildVariantsComponent({model:o[0]}),this.ProductStateComponent.updateCompWithMV(this.options.modelVersionList[0]),this.pubSubEvents(),void this.applyCompactComfortableMode(this.options.displayCompactMode)}if(null!=a&&(1!=a.length||1==a.length&&g.isDefined(a[0].start)&&1==a[0].start.isRoot)&&(e.singleProductEvolutionStatus=!1),this.ModelSelectionComponent.getcriteriasAvailable(this.ModelSelectionComponent).then((function(t){h.criteriasAvailable=t.criteria[0],console.log(h.criteriasAvailable);var i={};i.parentElement=e.container.getElement(".filter-dialog-productstates"),i.psJson=a,null!=a&&a.length>1&&(e.singleProductEvolutionStatus=!1),i.expression=e.options.expression,i.mode="PRODUCTS",i.use="FILTER",i.displayCompactMode=e.options.displayCompactMode,e.productstateCheckbox=new r({type:"checkbox",value:"PSComponent",className:"primary",label:N.Filter_Product_State}).inject(e.container.getElement(".filter-dialog-productstates-checkbox")),e.productstateCheckbox.addEventListener("buttonclick",(function(){!0===e.productstateCheckbox.checkFlag?e.ProductStateComponent.show():(e.ProductStateComponent.hide(),null!=e.VariantsComponent.configuratorButton&&e.VariantsComponent.configuratorButton.addClassName("disableButton")),null!=e.ProductStateComponent.options.psJson&&null!=e.ProductStateComponent.options.psJson&&Array.isArray(e.ProductStateComponent.options.psJson)&&e.ProductStateComponent.options.psJson.length>0&&(e.isRoot=e.ProductStateComponent.options.psJson[0].start.isRoot,e.length=e.ProductStateComponent.options.psJson.length),h.ModelEvents.publish({event:"ProductStatecheckbox",data:{model:e.productstateCheckbox.checkFlag,isRoot:e.isRoot,psJsonLength:e.ProductStateComponent.options.psJson.length}}),e.probesData.push("PRODUCTS_Checkbox_Click")})),e.ProductStateComponent=new d(i),e.ProductStateComponent.render(),h.productstateCheckbox=e.productstateCheckbox,h.ProductStateComponent=e.ProductStateComponent;var n=h.CurrentFilterModel={model:o[s]};0!=Object.keys(i.expression).length&&i.expression.iVariantsJson.basedOnMVID?(e.ProductStateComponent.setExpression(n),e.ProductStateComponent.setMVAssociatedWithPC(n,i.expression.iVariantsJson.basedOnMVID)):0!=Object.keys(i.expression).length?e.ProductStateComponent.setExpression(n):e.ProductStateComponent.setLastMainEvolution(n),null!=h.criteriasAvailable&&"FALSE"==h.criteriasAvailable.products&&(h.productstateCheckbox.hide(),h.ProductStateComponent.hide(),p=!1),1==p?(e.productstateCheckbox.checkFlag=!0,e.ProductStateComponent.show()):(e.ProductStateComponent.hide(),e.productstateCheckbox.checkFlag=!1,e.singleProductEvolutionStatus=!0,null!=e.VariantsComponent.configuratorButton&&e.VariantsComponent.configuratorButton.addClassName("disableButton")),0!=Object.keys(i.expression).length&&i.expression.iVariantsJson.basedOnMVID&&(e.productstateCheckbox.checkFlag=!0,e.ProductStateComponent.show());var l={};l.parentElement=e.container.getElement(".filter-dialog-manufacturingplans"),l.psJson=c,l.expression=e.options.expression,l.mode="MANUFACTURINGPLAN",l.use="FILTER",l.displayCompactMode=e.options.displayCompactMode,e.manufacturingplanCheckbox=new r({type:"checkbox",value:"PSComponent",className:"primary",label:_.Manufacturing_Plan}).inject(e.container.getElement(".filter-dialog-manufacturingplans-checkbox")),e.manufacturingplanCheckbox.addEventListener("buttonclick",(function(){!0===e.manufacturingplanCheckbox.checkFlag?e.manufacturingplanComponent.show():e.manufacturingplanComponent.hide(),e.probesData.push("ManufPlan_Checkbox_Click")})),e.manufacturingplanComponent=new d(l),e.manufacturingplanComponent.render(),h.manufacturingplanComponent=e.manufacturingplanComponent,h.manufacturingplanCheckbox=e.manufacturingplanCheckbox;n=h.CurrentFilterModel={model:o[s]};if(e.manufacturingplanComponent.setExpression(n),null!=h.criteriasAvailable&&"False"==h.criteriasAvailable.manufacturingPlans&&(h.manufacturingplanCheckbox.hide(),h.manufacturingplanComponent.hide(),x=!1),1==x?(e.manufacturingplanCheckbox.checkFlag=!0,e.manufacturingplanComponent.show()):(e.manufacturingplanComponent.hide(),e.manufacturingplanCheckbox.checkFlag=!1),1==e.userGrantedRoles.isCFGRoleAvail&&1==h.configurationCriteria.unit){e.UnitCheckbox=new r({type:"checkbox",value:"UnitComponent",className:"primary",label:N.Filter_Unit,events:{onChange:function(){}}}).inject(e.container.getElement(".filter-dialog-unit-checkbox")),e.UnitCheckbox.addEventListener("buttonclick",(function(){!0===e.UnitCheckbox.checkFlag?(e.UnitComponent.show(),e.UnitComponent.updateDictionary(h.CurrentFilterModel).then((function(){e.UnitComponent.checkUnitsAllocation()}))):(e.UnitComponent.hide(),g.isDefined(e.UnitComponent.atLeastOneUnitAllocated)&&1==e.UnitComponent.atLeastOneUnitAllocated&&e.showOrHideComponentsExceptUnit({unitAllocation:!1}));e.probesData.push("Unit_Checkbox_Click")})),h.ModelEvents.subscribe({event:"showOrHideComponentsExceptUnit"},(function(t){!0===e.UnitCheckbox.checkFlag&&(null==S.get("bShowFilterUnitAllocWarning")||1==S.get("bShowFilterUnitAllocWarning")?e.showWarning(t):e.showOrHideComponentsExceptUnit(t))})),h.ModelEvents.subscribe({event:"modelUpdated"},(function(t){e.showOrHideComponentsExceptUnit({unitAllocation:!1})}));var u=null;0!=Object.keys(e.options.expression).length&&(u=e.options.expression.iUnitJson);var f=e.container.getElement(".filter-dialog-unit");if(e.UnitComponent=new v({displayCompactMode:e.options.displayCompactMode,parentElement:f,mode:"UNIT",invokeFrom:"Filter",filterParent:e.options.renderToApp}),e.UnitComponent.render(),h.UnitComponent=e.UnitComponent,h.UnitCheckbox=e.UnitCheckbox,e.UnitComponent.SetJson(u),null!=h.criteriasAvailable&&"FALSE"==h.criteriasAvailable.builds&&(h.UnitCheckbox.hide(),h.UnitComponent.hide(),C=!1),1==C)e.UnitComponent.show(),e.UnitCheckbox.checkFlag=!0,e.UnitComponent.updateDictionary({model:o[s]}).then((function(){e.UnitComponent.checkUnitsAllocation()}));else e.UnitComponent.hide()}null!=e.options.FilterType&&"Volatile"!=e.options.FilterType||g.getAllowedSemantics(e.options.rootId).then((function(t){if(g.isBaselineMode(e.options.rootId,t)&&0==g.isFirstSemantic(e.options.rootId,t)){var i=null;if(Object.keys(e.options.expression).length&&""!=e.options.expression.configurationRevision&&null!=e.options.expression.configurationRevision&&null!=e.options.expression.configurationRevision)g.getObjectInfo(e.options.expression.configurationRevision).then((function(t){i=e.getCRNodeInfo(t),e.updateConfigurationRevision(i)}));else e.updateConfigurationRevision(i)}})),e.applyCompactComfortableMode(e.options.displayCompactMode)})),1==this.userGrantedRoles.isCFGRoleAvail&&1==h.configurationCriteria.contextualDate){this.DateCheckbox=new r({type:"checkbox",value:"DateComponent",className:"primary",label:N.Filter_Date,checkFlag:!1}).inject(this.container.getElement(".filter-dialog-date-checkbox"));var F=null;e.DateCheckbox.addEventListener("buttonclick",(function(){!0===e.DateCheckbox.checkFlag?e.DatePicker.show():e.DatePicker.hide(),e.probesData.push("Date_Checkbox_Click")})),0!=Object.keys(e.options.expression).length&&(F=e.options.expression.iDateJson);var k=this.container.getElement(".filter-dialog-date");this.DatePicker=new m(k,F,{view:"show",defaultDateBehavior:"SingleDate",displayCompactMode:e.options.displayCompactMode}),this.DatePicker.render(),h.DateCheckbox=this.DateCheckbox,h.DatePicker=this.DatePicker,1==f?(e.DatePicker.show(),this.DateCheckbox.checkFlag=!0):(this.DatePicker.hide(),this.DateCheckbox.checkFlag=!1)}e.PCCheckbox=new r({type:"checkbox",value:"PCComponent",className:"primary",label:N.Filter_ProductConfiguration}).inject(e.container.getElement(".filter-dialog-PC-checkbox"));var y="";0!=Object.keys(e.options.expression).length&&(y=e.options.expression.iVariantsJson);var I=this.singleProductEvolutionStatus;y&&y.selectedOptionsforConfigurator?h.selectedOptionsforConfigurator=y.selectedOptionsforConfigurator:h.selectedOptionsforConfigurator="";let R={};R.status=I,R.variantJSON=y,R.pcParent=this.container.getElement(".filter-dialog-PC"),R.parentElement=this.container.getElement(".filter-dialog-variants"),R.invokeFrom="Filter",R.modelID=this.ModelSelectionComponent.get(),R.filterParent=this.options.renderToApp,R.filterParentContainer=this.options.renderTo,R.userGrantedRoles=this.userGrantedRoles,R.tenant=this.options.tenant,R.displayCompactMode=e.options.displayCompactMode,this.VariantsComponent=new b(R),this.VariantsComponent.render(),this.VariantsComponent.PCChooser.hide(),e.PCCheckbox.addEventListener("change",(function(){!0===e.PCCheckbox.checkFlag?e.VariantsComponent.PCChooser.show():e.VariantsComponent.PCChooser.hide(),e.probesData.push("Configurations_Checkbox_Click")})),e.PCCheckbox.checkFlag=!!e.options.expression.pcCheckFlag&&e.options.expression.pcCheckFlag,this.updateVariantsComponent(),this.filter150Checkbox=new r({type:"checkbox",value:"filter150Component",className:"primary",label:N.filter150,checkFlag:!1,tooltipInfos:new l({shortHelp:N.filter150})}).inject(this.container.getElement(".filter-dialog-150-checkbox")),this.filter150Checkbox.addEventListener("change",(t=>{g.isParamDefined(e.VariantsComponent.selectedPCPID)||e.VariantsComponent.clearProductConfLabelInfo(),S.set({bFilterMode150:t.dsModel.checkFlag},!0),1==t.dsModel.checkFlag?g.isParamDefined(e.VariantsComponent.selectedPCPID)&&"Refine"!==e.VariantsComponent.selectedPCMode&&e.VariantsComponent.clearProductConfLabelInfo():g.isParamDefined(e.VariantsComponent.selectedPCPID)&&"Refine"===e.VariantsComponent.selectedPCMode&&e.VariantsComponent.clearProductConfLabelInfo()})),h.filter150Checkbox=this.filter150Checkbox,0==Object.keys(this.options.expression).length?("CfgFilter150"==this.options.filterMode||S.get("bFilterMode150"))&&(h.filter150Checkbox.checkFlag=!0):this.options.expression&&this.options.expression.viewJson&&"Source"!==this.options.expression.viewJson.view&&"Change"!==this.options.expression.viewJson.view&&(S.set({bFilterMode150:this.options.expression.refineModecheckbox},!1),this.options.expression.refineModecheckbox&&(h.filter150Checkbox.checkFlag=!0)),h.ModelEvents.publish({event:"modelUpdated",data:{noEvolutionUpdate:!0,model:o[s]}}),this.createChangeComponent(),"Native"==enoviaServerFilterWidget.mode&&e.options.PCID&&(e.PCCheckbox.checkFlag=!!e.options.PCID,e.onPCSearchOKFilter({id:e.options.PCID})),null!=this.options.expression.psJson&&Array.isArray(this.options.expression.psJson)&&this.options.expression.psJson.length>0&&1==this.options.expression.psJson[0].start.isRoot&&document.getElementById("edit").addClassName("disableButton"),g.isParamDefined(e.VariantsComponent)&&g.isParamDefined(e.VariantsComponent.configuratorButton)&&0!=Object.keys(e.options.expression).length&&(e.VariantsComponent.configuratorButton.addClassName("cfgWaitCursor"),e.handleConfiguratorBasedOnPromise(e.promiseSingleMVID)),h.ModelEvents.subscribe({event:"NoSingleProductId"},(function(t){e.VariantsComponent.configuratorButton.hasClassName("cfgWaitCursor")&&(e.alertDiv.add({message:N.Filter_WaitingToComputeSingleMVID,style:{position:"absolute"},className:"error"}),e.alertDiv.show())})),h.ModelEvents.subscribe({event:"ProductStateDialogClosed"},(e=>{this.probesData=[...this.probesData,...g.getMagicProbesData(e)]})),h.ModelEvents.subscribe({event:"UnitsDialogClosed"},(e=>{this.probesData=[...this.probesData,...g.getMagicProbesData(e)]}))}))},sendMagicProbesData:function(){if(this.DatePicker){let e={probesData:{type:"DATE",singleDateClickCount:this.DatePicker.singleDateClickCount,rangeDateClickCount:this.DatePicker.rangeDateClickCount}};this.probesData=[...this.probesData,...g.getMagicProbesData(e)]}if(this.VariantsComponent&&this.VariantsComponent.probesData.length>0&&(this.probesData=[...this.probesData,...this.VariantsComponent.probesData]),this.ModelSelectionComponent&&this.ModelSelectionComponent.probesData.length>0&&(this.probesData=[...this.probesData,...this.ModelSelectionComponent.probesData]),!this.probesData||0==this.probesData.length)return;let e="Native",t="Rich Client Applications",i="Native"==window.enoviaServerFilterWidget.mode?"NATIVEWIW":"DASHBOARD";widget&&widget.data&&widget.data.appId&&(e=widget.data.appId),widget&&widget.options&&widget.options.title&&(t=widget.options.title);for(let n=0;n<this.probesData.length;n++){let o={AppId:e,AppName:t,CommandOperation:"Configuration_Filter_Apply_"+this.probesData[n],CommandName:R.Labels.CONFIGURATION_FILTER,ConfigMode:R.ConfigMode.CONTEXTUAL,ApplicationMode:i};g.sendConfgurationCommandsClickEventForMagicProbes(o)}},createModelSelectionComponent:function(){let e=this.options.iModelsList.length,t="",i=[],n=-1;if(0!=Object.keys(this.options.expression).length&&(t=this.options.expression.modelId),e>0){for(let o=0;o<e;o++){let e=this.getModelMarketingName(this.options.iModelsList[o].data),s=this.getModelName(this.options.iModelsList[o].basicData);e||(e=s);let a={valueItem:this.options.iModelsList[o].physicalID,labelItem:e,name:s};this.options.iModelsList[o].physicalID==t&&(n=o,a.selected=!0),i.push(a)}if(-1==n&&""!=t)return this.alertDiv.add({message:N.Filter_Error_Models_in_filter,style:{position:"absolute"},className:"error"}),this.alertDiv.elements.container.addClassName("CfgAlertstyle"),this.alertDiv.show(),void this.options.callback([]);-1==n&&""==t&&(n=0);let o={};o.Data=i,o.currentindex=n,o.parentElement=this.container.getElement(".filter-dialog-models"),this.ModelSelectionComponent=new c(o),this.ModelSelectionComponent.render()}return{Models:i,currentindex:n}},createFilterSettingsComponent:function(){let e=this.container.getElement(".filter-dialog-Settings");if(1==this.userGrantedRoles.isCFGRoleAvail&&1==h.configurationCriteria.contextualDate&&!this.isXRev){if(this.configFilterSettings=this.container.getElement(".filter-dialog-SettingsIcon"),this.configFilterSettings.addClassName("fonticon"),this.configFilterSettings.addClassName("fonticon-1.5x"),this.configFilterSettings.addClassName("fonticon-cog"),this.configFilterSettings.tooltipInfos=new l({shortHelp:N.CFG_FilterSettings_Tooltip}),!this.contextDateToggle){let t=!0;0==S.get("configFilterContextualDate")&&(t=!1),0!=Object.keys(this.options.expression).length&&(t=this.options.expression.contextualDate),this.contextDateToggle=new r({type:"switch",touchMode:!this.options.displayCompactMode,id:"cfgContextDateToggle",checkFlag:t,value:"0",label:N.CFG_ContextualDate_Label,tooltipInfos:new l({shortHelp:N.CFG_ContextualDate_Tooltip})}),this.contextDateToggle.inject(e),e.hide(),this.contextDateToggle.addEventListener("click",(function(e){S.set({configFilterContextualDate:this.dsModel.checkFlag},!0),this.probesData.push("ContextualDate_Toggle_Click")}))}this.configFilterSettings.set({events:{click:t=>{this.probesData.push("Configuration_Settings_Click"),e.isHidden()?(this.configFilterSettings.addClassName("cfgFilterActiveCog"),e.show()):(this.configFilterSettings.removeClassName("cfgFilterActiveCog"),e.hide())}}})}},createViewSelectionComponent:function(){let e={elementsList:[{labelItem:O.OFFICIAL_LABEL,valueItem:"Official"}],officialViewHandler:()=>{this.officialProjViewHandling()},projectedViewHandler:()=>{this.officialProjViewHandling()},changeViewHandler:()=>{if(this.cfgConfigurationRevisionPicker&&this.cfgConfigurationRevisionPicker.selectedNode&&this.configurationRevisionCheckbox&&1==this.configurationRevisionCheckbox.checkFlag)return this.viewPanelCombo.set(this.currentSelectedView),void g.showwarning(N.Change_view_not_selectable,"info");this.currentSelectedView=this.viewPanelCombo.get(),this.publishFilterViewChangeEvent(),this.changeActionCheckbox&&(this.changeActionCheckbox.checkFlag=!0,this.changeActionCheckbox.visibleFlag=!0),this.changeActionComponent&&this.changeActionComponent.show(),g.isDefined(document.getElementsByClassName("filter-dialog-Changelabel")[0])&&document.getElementsByClassName("filter-dialog-Changelabel")[0].setAttribute("style","display:block"),this.container.getElement(".filter-dialog-model-criteria").hide(),this.container.getElement(".filter-dialog-viewpanel2").setContent(this.viewPanelCombo),this.container.getElement(".filter-dialog-viewpanel2").setStyle("display","flex")},displayCompactMode:this.options.displayCompactMode};"ModelVersion"!=this.options.filterBasedOn&&(e.elementsList=[...e.elementsList,{labelItem:O.PROJECTED_LABEL,valueItem:"Projected"},{labelItem:O.CHANGE_LABEL,valueItem:"Change"}]),this.isLicenseValid=!0,this.viewPanelCombo=new k(e),this.container.getElement(".filter-dialog-viewpanel").setContent(this.viewPanelCombo.render()),0!=Object.keys(this.options.expression).length&&this.options.expression.viewJson&&this.viewPanelCombo.set(this.options.expression.viewJson),this.currentSelectedView=this.viewPanelCombo.get()},createChangeComponent:function(){this.changeActionCheckbox=new r({type:"checkbox",value:"ChangeActionComponent",className:"primary",label:N.Filter_ChangeAction,checkFlag:!1}).inject(this.container.getElement(".filter-dialog-changeaction-checkbox"));let e={displayCompactMode:this.options.displayCompactMode,currentSelectedFilterView:this.currentSelectedView};e.parentElement=this.container.getElement(".filter-dialog-changeaction"),this.changeActionComponent=new p(e),this.changeActionComponent.render(),Object.keys(this.options.expression).length>0&&this.options.expression.caxml&&this.changeActionComponent.setFilterXML(this.options.expression.caxml),this.changeActionComponent.hide(),this.options.expression.configurationRevision&&this.container.getElement(".filter-dialog-Change").hide(),Object.keys(this.options.expression).length>0&&this.options.expression.caNameArray&&this.options.expression.caNameArray.length>0&&(this.changeActionComponent.initialiseComponent(this.options.expression),this.changeActionCheckbox.checkFlag=!0,this.changeActionComponent.show()),this.changeActionCheckbox.addEventListener("buttonclick",(()=>{!0===this.changeActionCheckbox.checkFlag?this.changeActionComponent.show():this.changeActionComponent.hide(),this.probesData.push("ChangeAction_Checkbox_Click")})),h.ModelEvents.subscribe({event:"CRSelected"},(e=>{this.container.getElement(".filter-dialog-Change").hide()})),h.ModelEvents.subscribe({event:"CRDelected"},(e=>{this.container.getElement(".filter-dialog-Change").show()}))},updateConfigurationRevision:function(e){var t=this;t.configurationRevisionCheckbox=new r({type:"checkbox",value:"ConfigurationRevision",className:"primary",label:_.ConfigurationRevision}).inject(t.container.getElement(".filter-dialog-ConfiguredRevision-checkbox"));var i={parentElement:t.container.getElement(".filter-dialog-ConfiguredRevision"),iSelectedId:e,iRootId:t.options.rootId,displayCompactMode:t.options.displayCompactMode};t.cfgConfigurationRevisionPicker=new x(i),t.cfgConfigurationRevisionPicker.render(),Object.keys(t.options.expression).length&&null!=t.options.expression.configurationRevision?t.configurationRevisionCheckbox.checkFlag=!0:(t.configurationRevisionCheckbox.checkFlag=!1,t.cfgConfigurationRevisionPicker.hide()),0==Object.keys(t.options.expression).length&&(t.configurationRevisionCheckbox.checkFlag=!0,t.cfgConfigurationRevisionPicker.show()),t.configurationRevisionCheckbox.addEventListener("buttonclick",(function(){!0===t.configurationRevisionCheckbox.checkFlag?(t.cfgConfigurationRevisionPicker.show(),g.isDefined(t.cfgConfigurationRevisionPicker.selectedNode)&&t.container.getElement(".filter-dialog-Change").hide()):(t.cfgConfigurationRevisionPicker.hide(),t.container.getElement(".filter-dialog-Change").show()),t.probesData.push("ConfigRevision_Checkbox_Click")}))},validateCFFilter:function(){return null==this.UnitComponent||0!=this.UnitComponent.validate()},updateVariantsComponent:function(){this.VariantsComponent.enableDisableEditVariantfromProductEvolution()},buildFilterXML:function(){let e=!1;this.contextDateToggle&&this.contextDateToggle.checkFlag&&(e=!0);let t=this.ModelSelectionComponent?this.ModelSelectionComponent.getSelectedModelName():"",i=this.ModelSelectionComponent?this.ModelSelectionComponent.getSelectedModelLabel():"";"ModelVersion"==this.options.filterBasedOn&&(t=[this.options.modelVersionList[0].modelName],i=[this.options.modelVersionList[0].modelDisplayName||this.options.modelVersionList[0].modelName]);var n=null==this.ProductStateComponent?null:this.ProductStateComponent.buildFilterXML();null==this.productstateCheckbox||0!=this.productstateCheckbox.checkFlag&&0!=this.productstateCheckbox.visibleFlag||(n="");var o=null==this.manufacturingplanComponent?null:this.manufacturingplanComponent.buildFilterXML();null==this.manufacturingplanCheckbox||0!=this.manufacturingplanCheckbox.checkFlag&&0!=this.manufacturingplanCheckbox.visibleFlag||(o="");var s=null==this.UnitComponent?null:this.UnitComponent.buildUnitXML(t[0]);null==this.UnitCheckbox||0!=this.UnitCheckbox.checkFlag&&0!=this.UnitCheckbox.visibleFlag||(s="");var a=this.VariantsComponent.getXml();a=u.getValidXmlWithoutDisplayName(a),0==this.VariantsComponent.visibleFlag&&(a="");var r="",l="";g.isDefined(this.viewPanelCombo)&&"Official"===(r=this.viewPanelCombo.get().view)&&(r="Current"),l=1==this.filter150Checkbox.checkFlag||"Source"===r?"150%":"Strict";var c=null==this.DatePicker?null:this.DatePicker.getXML();if(null!=c&&(null==this.DateCheckbox||0!=this.DateCheckbox.checkFlag&&0!=this.DateCheckbox.visibleFlag)||(c=""),n&&-1==n.search("TreeSeries"))var d=u.buildTreeSeries("ProductState",t[0],n);else d=n;if(o&&-1==o.search("TreeSeries"))var p=u.buildTreeSeries("ManufPlan",t[0],o);else p=o;var C="";g.isDefined(this.changeActionComponent)&&g.isDefined(this.changeActionCheckbox)&&!0===this.changeActionCheckbox.checkFlag&&0!=this.changeActionCheckbox.visibleFlag&&(C=this.changeActionComponent.getFilterXML()),""!=n&&null!=n||(d=""),""!=o&&null!=o||(p=""),""!=c&&null!=c||(c=""),""!=s&&null!=s||(s=""),""!=a&&null!=a||(a=""),""!=C&&null!=C||(C="");let f="",m=null;this.isXRev&&(m=h.singleConfigurationRecordId,f=this.xRevComp?this.xRevComp.buildFilterXML():"",f&&(f=u.buildXRevision(f)),f||(f=""),a||C||(t="",i=""),!this.xRevCheckBox||0!=this.xRevCheckBox.checkFlag&&0!=this.xRevCheckBox.visibleFlag||(f=""),!this.configRecordCheckBox||0!=this.configRecordCheckBox.checkFlag&&0!=this.configRecordCheckBox.visibleFlag||(m=null));var v=""==d&&""==p&&""==c&&""==s&&""==a&&""==C&&""==f,b=!1,x="";null!=this.cfgConfigurationRevisionPicker&&null!=this.cfgConfigurationRevisionPicker.selectedNode&&1==this.configurationRevisionCheckbox.checkFlag&&(x=this.cfgConfigurationRevisionPicker.selectedNode.id,C="",b=!0),"Source"!==r||b||(d="",p="",c="",s="",a="",f=""),this.crFilter=!1,"Native"==enoviaServerFilterWidget.mode&&""==d&&""==p&&""==c&&""==s&&""==a&&""==C&&1==b&&(this.crFilter=!0);let D=Array.isArray(i)&&i[0]?i[0]:t[0],F={desc:"",name:t[0],label:D};if("ModelVersion"==this.options.filterBasedOn&&(F={desc:"",name:"",label:""}),this.finalXML=u.startFilterXML(r,l,x,v,F,e,f,m)+d+p+c+s+a+C,v||(F.name&&(this.finalXML+="</Context>"),this.finalXML+="</FilterSelection>"),""!=d||""!=p||""!=a||""!=F.desc||""!=C){var k=this;this.finalXML+="<Description>",""!=d&&(Array.isArray(this.ProductStateComponent.xmlDesc)?this.ProductStateComponent.xmlDesc.forEach((function(e){k.finalXML+=e})):this.finalXML+=this.ProductStateComponent.xmlDesc),""!=p&&(Array.isArray(this.manufacturingplanComponent.xmlDesc)?this.manufacturingplanComponent.xmlDesc.forEach((function(e){k.finalXML+=e})):this.finalXML+=this.manufacturingplanComponent.xmlDesc),""!=a&&this.VariantsComponent.xmlDesc&&(Array.isArray(this.VariantsComponent.xmlDesc)?this.VariantsComponent.xmlDesc.forEach((function(e){k.finalXML+=e})):this.finalXML+=this.VariantsComponent.xmlDesc),""!=C&&this.changeActionComponent.xmlDesc&&(Array.isArray(this.changeActionComponent.xmlDesc)?this.changeActionComponent.xmlDesc.forEach((function(e){k.finalXML+=e})):this.finalXML+=this.changeActionComponent.xmlDesc),F.desc&&(this.finalXML+=F.desc),this.finalXML=this.finalXML+"</Description>"}return this.finalXML=this.finalXML+"</CfgFilterExpression>",console.log(this.finalXML),this.finalXML},officialProjViewHandling:function(){"Source"==this.currentSelectedView.view&&this.clearCAComponent(),g.isDefined(this.UnitCheckbox)&&1==this.UnitCheckbox.checkFlag&&g.isDefined(this.UnitComponent.atLeastOneUnitAllocated)&&1==this.UnitComponent.atLeastOneUnitAllocated&&this.showOrHideComponentsExceptUnit({unitAllocation:!0}),this.currentSelectedView=this.viewPanelCombo.get(),this.publishFilterViewChangeEvent(),S.get("bFilterMode150")&&(this.filter150Checkbox.checkFlag=!0),this.container.getElement(".filter-dialog-model-criteria").show(),this.container.getElement(".filter-dialog-model-criteria").setStyle("display","flex"),this.container.getElement(".filter-dialog-viewpanel2").setStyle("display","none"),this.container.getElement(".filter-dialog-viewpanel").setContent(this.viewPanelCombo)},applyCompactComfortableMode:function(e){!0===e?this.container.getElements("*").forEach((function(e){e.removeAttribute("touch-mode")})):this.container.getElements("*").forEach((function(e){e.setAttributeNode(document.createAttribute("touch-mode"))})),null!=this.UnitComponent&&(this.UnitComponent.options.displayCompactMode=e),null!=this.manufacturingplanComponent&&(this.manufacturingplanComponent.options.displayCompactMode=e),null!=this.ProductStateComponent&&(this.ProductStateComponent.options.displayCompactMode=e),null!=this.DatePicker&&(this.DatePicker.options.displayCompactMode=e),null!=this.cfgConfigurationRevisionPicker&&(this.cfgConfigurationRevisionPicker.options.displayCompactMode=e)},onApplyFilter:function(e){var t=this,i="";if(g.isDefined(this.viewPanelCombo)&&"Official"===(i=this.viewPanelCombo.get().view)&&(i="Current"),!t.isXRev&&(0==t.filter150Checkbox.checkFlag||1==t.filter150Checkbox.checkFlag&&"Refine"===t.VariantsComponent.selectedPCMode)&&h.singleProductId&&(t.productstateCheckbox&&1==t.productstateCheckbox.checkFlag||t.xRevCheckBox&&1==t.xRevCheckBox.checkFlag)&&(null==t.manufacturingplanCheckbox||0==t.manufacturingplanCheckbox.checkFlag)&&(null==t.UnitComponent||0==t.UnitCheckbox.checkFlag)&&(null==t.DateCheckbox||0==t.DateCheckbox.checkFlag)&&t.PCCheckbox&&t.PCCheckbox.checkFlag&&""!=t.VariantsComponent.selectedPCPID&&"Projected"!=i&&(null==t.configurationRevisionCheckbox||0==t.configurationRevisionCheckbox.checkFlag)){var n=g.getDisplayExpressionUsingXSLT(t.buildFilterXML()),o=t.options.rootId;let e=t.VariantsComponent.selectedPCDisplayName||"";e=g.escapeSpecialCharacters(e);let a=t.VariantsComponent.selectedPCRevision||"",r="";r=a?`${e}-${a}`:e;var s={};return s[o]={displayExpression:r||n,config_filter_id:{physical_id:t.VariantsComponent.selectedPCPID},expression:{modelId:t.ModelSelectionComponent?t.ModelSelectionComponent.get():"",view:i}},t.isXRev&&(s[o].expression.xRevXml=t.xRevComp?t.xRevComp.buildFilterXML():"",s[o].expression.xRevJson=t.xRevComp?t.xRevComp.buildFilterJson():[]),t.options.callback([s]),document.querySelector(".operations-main-container").destroy(),t.sendConfigurationFilterTrackerEvent(),h.singleProductId="",h.singleConfigurationRecordId="",t.sendMagicProbesData(),null}var a=new C((function(e,n){var o=t.buildFilterXML(),s=u.removeDescFromXML(o);let a="";a=t.isXRev?t.options.xRevisionContent[0].xRevisionGraph.physicalid:"ModelVersion"==t.options.filterBasedOn?t.options.modelVersionList[0].modelID:t.ModelSelectionComponent.get();var r={version:"1.2",output:{targetFormat:"TXT"},expression:{version:"0.1",format:"xml",content:s},dictionary:{version:"0.1",id:{pid:a}}};r=JSON.stringify(r);g.makeWSCall("/resources/modeler/configuration/filteringServices/createVolatileFilter","POST","enovia","application/json",r,(async function(n){var s=t.options.rootId,a=g.getDisplayExpressionUsingXSLT(o),r=null==t.configurationRevisionCheckbox?null:t.configurationRevisionCheckbox.checkFlag,l=null==t.cfgConfigurationRevisionPicker||null==t.cfgConfigurationRevisionPicker.selectedNode?null:{id:t.cfgConfigurationRevisionPicker.selectedNode.id};t.configurationRevisionCheckbox&&0==r&&(l=null),t.configurationRevisionCheckbox&&1==r&&null!=l&&(a=t.cfgConfigurationRevisionPicker.selectedNode.displayName+"-"+t.cfgConfigurationRevisionPicker.selectedNode.revision+" "+a),t.configRecordCheckBox&&1==t.configRecordCheckBox.checkFlag&&h.singleConfigurationRecordId&&(a=`${t.configRecordComp.displayExpression} ${a}`);var c={};if(c[s]={displayExpression:g.escapeSpecialCharacters(a),compiledBinary:n.filterBinaryForExpand,expression:{configurationRevision:l,modelId:t.ModelSelectionComponent?t.ModelSelectionComponent.get():"",filterXML:o,view:i,variants:{variant:t.VariantsComponent.getSelectedVariant(),displayExpression:t.VariantsComponent.getJson(),selectedOptionsforConfigurator:h.selectedOptionsforConfigurator,configuratorOptions:t.VariantsComponent.getConfiguratorOptions()}}},t.isXRev)if(c[s].expression.singleProductId=h.singleProductId,"No"===t.options.xRevisionContent[0].primaryReferenceForGraph){let e=await g.getAllowedSemantics(t.options.rootId);if(e&&e.allowedSemantics&&Array.isArray(e.allowedSemantics)&&e.allowedSemantics[0]&&e.allowedSemantics[0].graphProprietary&&e.allowedSemantics[0].graphProprietary.id){let t=e.allowedSemantics[0].graphProprietary.id;c[s].expression.useRef=!1,c[s].expression.itemID=t}}else"Yes"===t.options.xRevisionContent[0].primaryReferenceForGraph&&(c[s].expression.useRef=!0,c[s].expression.itemID=null);t.options.callback([c]),null!=document.querySelector(".operations-main-container")&&document.querySelector(".operations-main-container").destroy(),e(!0),t.sendConfigurationFilterTrackerEvent(o),h.singleProductId="",h.singleConfigurationRecordId="",t.sendMagicProbesData()}),(function(){t.alertDiv.add({message:N.Filter_Error_CompiledBinary,style:{position:"absolute"},className:"error"}),t.alertDiv.show(),e(!0)}),!0)}));return a},applyFilterFromFiringProcess:function(e){var t=this,i=!1;if(t.options.configData.PCID&&(i=!0),!i){var n=t.options.configData.filterXML;if(!g.isParamDefined(n))return;var o=u.removeDescFromXML(t.options.configData.filterXML);if(null==o||""==o)return}return new C((async function(e,s){var a="";a=i?"/search?xrequestedwith=xmlhttprequest":"/resources/modeler/configuration/filteringServices/createVolatileFilter";let r="";r=t.options.configData.xRev&&t.options.configData.xRev.graph&&t.options.configData.xRev.graph.valueItem?t.options.configData.xRev.graph.valueItem:t.options.configData.context.model.valueItem;var l="",c={};i?(l={with_indexing_date:!0,with_nls:!1,label:"yus-1515078503005",locale:"en",select_predicate:["ds6w:label","ds6w:type","ds6wg:marketing_Name"],select_file:["icon","thumbnail_2d"],query:"flattenedtaxonomies:(types/Product Configuration) AND ( physicalid:("+t.options.configData.PCID+") ) ",order_by:"desc",order_field:"relevance",nresults:1e3,start:"0",source:[],tenant:t.options.tenant},c={isfederated:"true"}):l={version:"1.2",output:{targetFormat:"TXT"},expression:{version:"0.1",format:"xml",content:o},dictionary:{version:"0.1",id:{pid:r}}};l=JSON.stringify(l);try{await g.populate3DSpaceURL(),g.isParamDefined(enoviaServerFilterWidget.mySecurityContext)||await g.populateSecurityContext(),await g.populateDisplayExpressionXSLT(),await g.makeWSCall(a,"POST","enovia","application/json",l,(async function(o){let s="",a=t.options.rootId,r={};if(i)s=new b({}).getAttrValue(o,"ds6w:label"),r[a]={displayExpression:g.escapeSpecialCharacters(s),config_filter_id:{physical_id:t.options.configData.PCID},expression:{modelId:t.options.configData.context.model.valueItem}},t.options.callback([r]),e(!0),t.sendConfigurationFilterTrackerEvent(n),h.singleProductId="",t.sendMagicProbesData();else{let i="";if(i=o.filterBinaryForExpand,s=g.getDisplayExpressionUsingXSLT(n),r[a]={filterName:"Configuration Filter ",displayExpression:s,compiledBinary:i,expression:{modelId:t.options.configData.context.model.valueItem,filterXML:n,variants:{}}},t.options.configData.xRev&&t.options.configData.xRev.xRevElementID)try{let e="";const i=await f.getAllocation(t.options.configData.xRev.xRevElementID);if(i&&i.result&&Array.isArray(i.result)){const[{allocationPIDs:t}]=i.result;t.length>0?([e]=t,r[a].expression.singleProductId=e||""):console.log("xRevElement is not allocated to Model version.")}}catch(e){console.log("Model version id allocated to xRevElement is not retrieved. Configurator might be KO while editing filter."),console.error(e)}t.options.callback([r]),e(!0),t.sendConfigurationFilterTrackerEvent(n),h.singleProductId="",t.sendMagicProbesData()}}),(function(){t.alertDiv.add({message:N.Filter_Error_CompiledBinary,style:{position:"absolute"},className:"error"}),t.alertDiv.show(),e(!0)}),!0,c)}catch(e){console.log(e),s(e)}}))},getDataForWIWFilter:function(){var e=this,t="",i="";g.isDefined(this.viewPanelCombo)&&"Official"===(i=this.viewPanelCombo.get().view)&&(i="Current"),e.isXRev||(0==e.filter150Checkbox.checkFlag||1==e.filter150Checkbox.checkFlag&&"Refine"===e.VariantsComponent.selectedPCMode)&&(!h.singleProductId||!(e.productstateCheckbox&&1==e.productstateCheckbox.checkFlag||e.xRevCheckBox&&1==e.xRevCheckBox.checkFlag)||null!=e.manufacturingplanCheckbox&&0!=e.manufacturingplanCheckbox.checkFlag||null!=e.UnitComponent&&0!=e.UnitCheckbox.checkFlag||null!=e.DateCheckbox&&0!=e.DateCheckbox.checkFlag||!e.PCCheckbox||!e.PCCheckbox.checkFlag||""==e.VariantsComponent.selectedPCPID||"Projected"==i||null!=e.configurationRevisionCheckbox&&0!=e.configurationRevisionCheckbox.checkFlag||(t=e.VariantsComponent.selectedPCPID));var n="";null==e.configurationRevisionCheckbox||1!=e.configurationRevisionCheckbox.checkFlag||null==e.cfgConfigurationRevisionPicker.selectedNode&&null==e.cfgConfigurationRevisionPicker.selectedNode||(e.cfgConfigurationRevisionPicker.selectedNode.id,n=_.ConfigurationRevision+" "+e.cfgConfigurationRevisionPicker.selectedNode.displayName+"-"+e.cfgConfigurationRevisionPicker.selectedNode.revision+"\n");var o=e.buildFilterXML(),s=g.getDisplayExpressionUsingXSLT(o),a={variants:{variant:e.VariantsComponent.getSelectedVariant(),displayExpression:e.VariantsComponent.getJson(),selectedOptionsforConfigurator:h.selectedOptionsforConfigurator,configuratorOptions:e.VariantsComponent.getConfiguratorOptions()},PC:{PCID:t},Tooltip:n+s};1==e.cfgUXEnvVariables.filterXMLWithoutDescriptionInSetInfo&&(a.filterXMLWithoutDesc=u.removeDescFromXML(o));var r=e.ModelSelectionComponent?e.ModelSelectionComponent.get():"";if("ModelVersion"==e.options.filterBasedOn&&(r=e.options.modelVersionList[0].modelID),1==this.crFilter){var l={crFilter:"true",crID:this.cfgConfigurationRevisionPicker.selectedNode.id};r=""}var c={filterName:"",filterDescription:"",filterXML:o,filterXMLWithoutDesc:u.removeDescFromXML(o),modelId:r,view:i,filterUXData:a,crData:l};return this.isXRev&&(c.xRevData={xRevFilter:"true",xRevisionGraphId:this.options.xRevisionContent[0].xRevisionGraph.physicalid},c.filterUXData.singleProductId=h.singleProductId),c},onPCSearchOKFilter:function(e){return this.VariantsComponent.selectedPCPID=e.id,this.VariantsComponent.PCChooser.model.set("ID",e.id),this.VariantsComponent.PCChooser.model.set("type","Product Configuration"),this.VariantsComponent.processProductConfiguration({})},onCASearchOKFilter:function(e){this.changeActionComponent.initialiseComponent(e)},showOrHideComponentsExceptUnit:function(e){var t=this;1==e.unitAllocation?(t.productstateCheckbox&&t.productstateCheckbox.hide(),t.manufacturingplanCheckbox&&t.manufacturingplanCheckbox.hide(),t.DateCheckbox&&t.DateCheckbox.hide(),t.changeActionCheckbox&&t.changeActionCheckbox.hide(),t.PCCheckbox&&t.PCCheckbox.hide(),t.ProductStateComponent&&t.ProductStateComponent.hide(),t.manufacturingplanComponent&&t.manufacturingplanComponent.hide(),t.DatePicker&&t.DatePicker.hide(),t.changeActionComponent&&t.changeActionComponent.hide(),t.VariantsComponent&&(t.VariantsComponent.hide(),t.VariantsComponent.PCChooser&&t.VariantsComponent.PCChooser.hide()),g.isDefined(document.getElementsByClassName("filter-dialog-Changelabel")[0])&&document.getElementsByClassName("filter-dialog-Changelabel")[0].setAttribute("style","display:none")):(t.productstateCheckbox&&(t.productstateCheckbox.show(),t.ProductStateComponent&&1==t.productstateCheckbox.checkFlag&&t.ProductStateComponent.show()),t.manufacturingplanCheckbox&&(t.manufacturingplanCheckbox.show(),t.manufacturingplanComponent&&1==t.manufacturingplanCheckbox.checkFlag&&t.manufacturingplanComponent.show()),t.DateCheckbox&&(t.DateCheckbox.show(),t.DatePicker&&1==t.DateCheckbox.checkFlag&&t.DatePicker.show()),t.changeActionCheckbox&&(t.changeActionCheckbox.show(),t.changeActionComponent&&1==t.changeActionCheckbox.checkFlag&&t.changeActionComponent.show()),t.PCCheckbox&&t.PCCheckbox.show(),t.VariantsComponent&&(t.VariantsComponent.show(),t.VariantsComponent.PCChooser&&1==t.PCCheckbox.checkFlag&&t.VariantsComponent.PCChooser.show()),g.isDefined(document.getElementsByClassName("filter-dialog-Changelabel")[0])&&document.getElementsByClassName("filter-dialog-Changelabel")[0].setAttribute("style","display:block"))},showWarning:function(e){var t=this,i=function(){t.UnitCheckbox.checkFlag=!1,t.UnitComponent.hide(),t.showOrHideComponentsExceptUnit({unitAllocation:!1}),o.closeDialog()},n={width:539,height:210,isResizable:!1,dialogue:{header:N.warning,buttonArray:[{label:N.Filter_Apply,labelValue:"OK",handler:function(){t.showOrHideComponentsExceptUnit(e),o.closeDialog()},className:"primary"},{label:N.Filter_Cancel,labelValue:"Cancel",handler:i,className:"default"}],target:document.getElementById("cfgslideInBody"),object:null,postCrossHandler:i}},o=new I(n);o.render(),o.container.setStyle("overflow","auto"),o.container.setHTML(N.Cfg_Unit_allocation_warning+"<br><br>"+N.Want_To_Continue+"<br>");var s=new r({label:N.Do_not_show_again});s.addEventListener("change",(function(e){1==e.dsModel.checkFlag?S.set({bShowFilterUnitAllocWarning:!1},!0):S.set({bShowFilterUnitAllocWarning:!0},!0)})),s.inject(o.container)},sendConfigurationFilterTrackerEvent:function(e){var t="";t=g.isDefined(enoviaServerFilterWidget)&&"Native"==enoviaServerFilterWidget.mode?"Web In Win":"Dashboard";var i=R.getDeviceUsedForOperation(),n="";n=0!=Object.keys(this.options.expression).length?R.ConfigOperationMode.EDIT:R.ConfigOperationMode.CREATE;var o="Official";let s="";g.isDefined(this.viewPanelCombo)&&(o=this.viewPanelCombo.get().view,s=this.viewPanelCombo.get().view);var a=R.Availability.FALSE;this.filter150Checkbox&&(0==this.filter150Checkbox.checkFlag||1==this.filter150Checkbox.checkFlag&&"Refine"===this.VariantsComponent.selectedPCMode)&&(""==h.singleProductId||null==this.productstateCheckbox||1!=this.productstateCheckbox.checkFlag||null!=this.manufacturingplanCheckbox&&0!=this.manufacturingplanCheckbox.checkFlag||null!=this.UnitComponent&&0!=this.UnitCheckbox.checkFlag||null!=this.DateCheckbox&&0!=this.DateCheckbox.checkFlag||!this.PCCheckbox||!this.PCCheckbox.checkFlag||""==this.VariantsComponent.selectedPCPID||"Projected"==s||null!=this.configurationRevisionCheckbox&&0!=this.configurationRevisionCheckbox.checkFlag||(a=R.Availability.TRUE));var r=R.Availability.FALSE,l=R.ConfigCriteriaSelected.NONE,c=R.ConfigCriteriaSelected.NONE,d=R.ConfigCriteriaSelected.NONE,p=R.ConfigCriteriaSelected.NONE,C=R.Availability.FALSE,f=R.ConfigCriteriaSelected.NONE,m=R.Availability.FALSE,v=R.Availability.FALSE,b=R.Availability.FALSE,x=1,D=0,F=0,k=0,y=0,I=0,S=0,P=0,A=0,w=0;if(g.isDefined(e)){let t=u.FilterXMLtoJSONConvertor(e)[0].expression;t.filterXML=e,u.RetrieveVariantXMLFromFilterXML(t),g.isDefined(t.refineModecheckbox)&&(r=t.refineModecheckbox?R.Availability.TRUE:R.Availability.FALSE);var N=!1,_=!1;if(t.psJson.length>0&&(t.psJson.forEach((e=>{1==e.start.isRoot?(_=!0,D++):0==e.start.isRoot&&(N=!0,F++)})),N&&_?l=R.ConfigCriteriaSelected.BOTH:N&&!_?l=R.ConfigCriteriaSelected.SINGLE:!N&&_&&(l=R.ConfigCriteriaSelected.RANGE)),N=!1,_=!1,t.mpJson.length>0&&(t.mpJson.forEach((e=>{1==e.start.isRoot?(_=!0,k++):0==e.start.isRoot&&(N=!0,y++)})),N&&_?c=R.ConfigCriteriaSelected.BOTH:N&&!_?c=R.ConfigCriteriaSelected.SINGLE:!N&&_&&(c=R.ConfigCriteriaSelected.RANGE)),N=!1,_=!1,g.isDefined(t.iUnitJson)){let e=JSON.parse(t.iUnitJson);e.builds.length>0&&(e.builds.forEach((e=>{g.isDefined(e.end)?(_=!0,I++):(N=!0,S++)})),N&&_?d=R.ConfigCriteriaSelected.BOTH:N&&!_?d=R.ConfigCriteriaSelected.SINGLE:!N&&_&&(d=R.ConfigCriteriaSelected.RANGE))}N=!1,_=!1,t.iDateJson.DateRanges.length>0&&(t.iDateJson.DateRanges.forEach((e=>{e.Start==e.End?(N=!0,A++):(_=!0,P++)})),N&&_?p=R.ConfigCriteriaSelected.BOTH:N&&!_?p=R.ConfigCriteriaSelected.SINGLE:!N&&_&&(p=R.ConfigCriteriaSelected.RANGE)),"FALSE"===a&&g.isDefined(t.variants)&&g.isParamDefined(t.variants.xmlExpression)&&(C=R.Availability.TRUE),g.isDefined(t.caNameArray)&&(1==t.caNameArray.length?(f=R.ConfigCriteriaSelected.SINGLE,w=1):t.caNameArray.length>1&&(f=R.ConfigCriteriaSelected.MULTIPLE,w=t.caNameArray.length)),g.isParamDefined(t.configurationRevision)&&(m=R.Availability.TRUE)}if(g.isDefined(this.UnitCheckbox)&&1==this.UnitCheckbox.checkFlag&&g.isDefined(this.UnitComponent)&&1==this.UnitComponent.atLeastOneUnitAllocated&&(v=R.Availability.TRUE),g.isDefined(this.options.configData))b=R.Availability.TRUE;g.isDefined(this.ModelSelectionComponent)&&(x=null==this.ModelSelectionComponent.combobox?1:this.ModelSelectionComponent.combobox.getModel()._allDescendants.length),R.createEventBuilder({category:R.Category.USAGE,action:R.Events.CLICK,tenant:enoviaServerFilterWidget.tenant}).setLabel(R.Labels.CONFIGURATION_FILTER).addDimension(E.CONFIGURATION_FILTER.CONFIGURATION_FILTER_WIDGET,t).addDimension(E.CONFIGURATION_FILTER.CONFIGURATION_FILTER_MEDIA,i).addDimension(E.CONFIGURATION_FILTER.CONFIGURATION_FILTER_MODE,n).addDimension(E.CONFIGURATION_FILTER.CONFIGURATION_FILTER_VIEW,o).addDimension(E.CONFIGURATION_FILTER.CONFIGURATION_FILTER_PRODUCTCONFIGURATION,a).addDimension(E.CONFIGURATION_FILTER.CONFIGURATION_FILTER_150MODE,r).addDimension(E.CONFIGURATION_FILTER.CONFIGURATION_FILTER_MODELVERSION,l).addDimension(E.CONFIGURATION_FILTER.CONFIGURATION_FILTER_MANUFACTURINGPLAN,c).addDimension(E.CONFIGURATION_FILTER.CONFIGURATION_FILTER_UNIT,d).addDimension(E.CONFIGURATION_FILTER.CONFIGURATION_FILTER_DATE,p).addDimension(E.CONFIGURATION_FILTER.CONFIGURATION_FILTER_VARIANTS,C).addDimension(E.CONFIGURATION_FILTER.CONFIGURATION_FILTER_CHANGE,f).addDimension(E.CONFIGURATION_FILTER.CONFIGURATION_FILTER_CONFIGURATIONREVISION,m).addDimension(E.CONFIGURATION_FILTER.CONFIGURATION_FILTER_UNITFIRING,v).addDimension(E.CONFIGURATION_FILTER.CONFIGURATION_FILTER_FIRINGPROCESS,b).addPersonalValue(M.CONFIGURATION_FILTER.CONFIGURATION_FILTER_NO_OF_MODEL,x).addPersonalValue(M.CONFIGURATION_FILTER.CONFIGURATION_FILTER_TOTAL_NO_OF_PRODUCT_RANGE,D).addPersonalValue(M.CONFIGURATION_FILTER.CONFIGURATION_FILTER_TOTAL_NO_OF_PRODUCT_SINGLE,F).addPersonalValue(M.CONFIGURATION_FILTER.CONFIGURATION_FILTER_TOTAL_NO_OF_MANUFACTURING_PLAN_RANGE,k).addPersonalValue(M.CONFIGURATION_FILTER.CONFIGURATION_FILTER_TOTAL_NO_OF_MANUFACTURING_PLAN_SINGLE,y).addPersonalValue(M.CONFIGURATION_FILTER.CONFIGURATION_FILTER_TOTAL_NO_OF_UNIT_RANGE,I).addPersonalValue(M.CONFIGURATION_FILTER.CONFIGURATION_FILTER_TOTAL_NO_OF_UNIT_SINGLE,S).addPersonalValue(M.CONFIGURATION_FILTER.CONFIGURATION_FILTER_TOTAL_NO_OF_DATE_RANGE,P).addPersonalValue(M.CONFIGURATION_FILTER.CONFIGURATION_FILTER_TOTAL_NO_OF_DATE_SINGLE,A).addPersonalValue(M.CONFIGURATION_FILTER.CONFIGURATION_FILTER_TOTAL_NO_OF_CHANGEACTIONS,w).send()},buildRevSelectionComponent:function(e,t,i,n){const o={};o.parentElement="CONFIGRECORD"==e?this.container.getElement(".filter-dialog-ConfiguredRevision"):this.container.getElement(".filter-dialog-productstates");let s="CONFIGRECORD"==e?this.container.getElement(".filter-dialog-ConfiguredRevision-checkbox"):this.container.getElement(".filter-dialog-productstates-checkbox"),a=[],l=!1;t&&t.length>0&&(a=t,l=!0),o.psJson=a,o.xRevisionContent={referencePID:this.options.xRevisionContent&&this.options.xRevisionContent[0]?this.options.xRevisionContent[0].referencePID:""},o.expression=this.options.expression,o.mode=e,o.use="FILTER",o.onButtonClickCB=e=>this.callBackFromXRevLayout(e),o.xRevScopeDefined=this.options.xRevScopeDefined,o.displayCompactMode=this.options.displayCompactMode;let c="XREVISION"==e?N.Filter_xRevision:N.Filter_Product_State;"CONFIGRECORD"==e&&(c=N.Filter_ConfigurationRecord);let p=new r({type:"checkbox",value:"xRevComponent",className:"primary",label:c}).inject(s);p.addEventListener("buttonclick",(()=>{let t,i;!0===p.checkFlag?(C.show(),"CONFIGRECORD"==e&&this.manageRevisionDisplay(!1)):(C.hide(),"CONFIGRECORD"!=e&&this.VariantsComponent.configuratorButton&&this.VariantsComponent.configuratorButton.addClassName("disableButton"),"CONFIGRECORD"==e&&this.manageRevisionDisplay(!0)),C.options.psJson&&Array.isArray(C.options.psJson)&&C.options.psJson.length>0&&(t=C.options.psJson[0].start.isRoot,i=C.options.psJson.length),"CONFIGRECORD"!=e&&h.ModelEvents.publish({event:"ProductStatecheckbox",data:{model:p.checkFlag,isRoot:t,psJsonLength:i}}),this.probesData.push(`${e}_Checkbox_Click`)}));let C=new d(o);return C.render(),this.editFilterCase?(C.setExpression(n),o.expression.iVariantsJson.basedOnMVID&&(h.singleProductId=o.expression.iVariantsJson.basedOnMVID,p.checkFlag=!0,C.show(),l=!0)):"XREVISION"!=e&&"ModelVersion"!=this.options.filterBasedOn||(l=!0),"CONFIGRECORD"!=e&&(!h.singleProductId||!a||a&&1!=a.length||i&&-1!=i.indexOf("<Tree>"))&&(this.singleProductEvolutionStatus=!1),1==l?(p.checkFlag=!0,C.show()):(p.checkFlag=!1,C.hide()),{checkBox:p,psComponent:C}},manageRevisionDisplay:function(e){let t=document.getElementsByClassName("filter-dialog-Change")[0],i=document.getElementById("filter-dialog-evolutionlabel-view-container"),n=document.getElementById("filter-dialog-model-container");!0===e?(n&&n.setAttribute("style","display:flex;margin-top: 13px"),i&&i.setAttribute("style","display:flex;margin-top: 13px"),this.xRevCheckBox&&this.xRevCheckBox.show(),this.xRevCheckBox&&this.xRevCheckBox.checkFlag&&this.xRevComp&&this.xRevComp.show(),h.singleProductId&&this.showVariants(),t&&t.setAttribute("style","display:flex;flex-direction:column")):!1===e&&(n&&n.setAttribute("style","display:none"),i&&i.setAttribute("style","display:none;"),this.xRevCheckBox&&this.xRevCheckBox.hide(),this.xRevComp&&this.xRevComp.hide(),this.hideVariants(),t&&t.setAttribute("style","display:none"))},callBackFromXRevLayout:function(e){e.mode&&h.ModelEvents.publish({event:"ProductStateDialogClosed",data:{xml:e.ExpAndJson.xml,json:e.ExpAndJson.json,xmlDesc:e.ExpAndJson.description,mode:e.mode,probesData:e.probesData}}),"Native"==enoviaServerFilterWidget.mode?h.ModelEvents.publish({event:"showWIWFilterContainer"}):require(["DS/CfgFilterUX/CfgFilterFactory"],(function(e){e.showFilter()})),h.singleProductId&&1==this.xRevCheckBox.checkFlag&&1==this.xRevCheckBox.visibleFlag?this.showVariants():this.hideVariants()},buildVariantsComponent:function(e){this.PCCheckbox=new r({type:"checkbox",value:"PCComponent",className:"primary",label:N.Filter_ProductConfiguration}).inject(this.container.getElement(".filter-dialog-PC-checkbox"));let t="";0!=Object.keys(this.options.expression).length&&(t=this.options.expression.iVariantsJson),t&&t.selectedOptionsforConfigurator?h.selectedOptionsforConfigurator=t.selectedOptionsforConfigurator:h.selectedOptionsforConfigurator="";const i={};i.status=this.singleProductEvolutionStatus,i.variantJSON=t,i.pcParent=this.container.getElement(".filter-dialog-PC"),i.parentElement=this.container.getElement(".filter-dialog-variants"),i.invokeFrom="Filter",i.mode="XREVISION",i.filterParent=this.options.renderToApp,i.filterParentContainer=this.options.renderTo,i.userGrantedRoles=this.userGrantedRoles,i.tenant=this.options.tenant,i.displayCompactMode=this.options.displayCompactMode,this.VariantsComponent=new b(i),this.VariantsComponent.render(),this.VariantsComponent.PCChooser.hide(),this.PCCheckbox.addEventListener("change",(()=>{!0===this.PCCheckbox.checkFlag?this.VariantsComponent.PCChooser.show():this.VariantsComponent.PCChooser.hide(),this.probesData.push("Configurations_Checkbox_Click")})),this.PCCheckbox.checkFlag=!!this.options.expression.pcCheckFlag&&this.options.expression.pcCheckFlag,this.updateVariantsComponent(),this.filter150Checkbox=new r({type:"checkbox",value:"filter150Component",className:"primary",label:N.filter150,checkFlag:!1,tooltipInfos:new l({shortHelp:N.filter150})}).inject(this.container.getElement(".filter-dialog-150-checkbox")),this.filter150Checkbox.addEventListener("change",(e=>{this.VariantsComponent.selectedPCPID||this.VariantsComponent.clearProductConfLabelInfo(),S.set({bFilterMode150:e.dsModel.checkFlag},!1),1==e.dsModel.checkFlag?this.VariantsComponent.selectedPCPID&&"Refine"!==this.VariantsComponent.selectedPCMode&&this.VariantsComponent.clearProductConfLabelInfo():this.VariantsComponent.selectedPCPID&&"Refine"===this.VariantsComponent.selectedPCMode&&this.VariantsComponent.clearProductConfLabelInfo()})),h.filter150Checkbox=this.filter150Checkbox,0==Object.keys(this.options.expression).length?("CfgFilter150"==this.options.filterMode||S.get("bFilterMode150"))&&(h.filter150Checkbox.checkFlag=!0):(S.set({bFilterMode150:this.options.expression.refineModecheckbox},!1),this.options.expression.refineModecheckbox&&(h.filter150Checkbox.checkFlag=!0)),e.noEvolutionUpdate=!0,this.VariantsComponent.initialize(e),this.isXRev&&(0==Object.keys(this.options.expression).length?h.singleProductId||this.hideVariants():(t.displayExpression||this.hideVariants(),h.singleProductId&&this.showVariants()))},hideVariants:function(){this.PCCheckbox&&this.PCCheckbox.hide(),this.VariantsComponent&&(this.VariantsComponent.hide(),this.VariantsComponent.PCChooser&&this.VariantsComponent.PCChooser.hide())},showVariants:function(){this.PCCheckbox&&this.PCCheckbox.show(),this.VariantsComponent&&(this.VariantsComponent.show(),this.VariantsComponent.PCChooser&&this.PCCheckbox.checkFlag&&this.VariantsComponent.PCChooser.show())},pubSubEvents:function(){this.VariantsComponent&&this.VariantsComponent.configuratorButton&&0!=Object.keys(this.options.expression).length&&(this.VariantsComponent.configuratorButton.addClassName("cfgWaitCursor"),this.handleConfiguratorBasedOnPromise(this.promiseSingleMVID)),h.ModelEvents.subscribe({event:"NoSingleProductId"},(e=>{this.VariantsComponent&&this.VariantsComponent.configuratorButton&&this.VariantsComponent.configuratorButton.hasClassName("cfgWaitCursor")&&(this.alertDiv.add({message:N.Filter_WaitingToComputeSingleMVID,style:{position:"absolute"},className:"error"}),this.alertDiv.show())})),h.ModelEvents.subscribe({event:"ProductStateDialogClosed"},(e=>{this.probesData=[...this.probesData,...g.getMagicProbesData(e)]})),h.ModelEvents.subscribe({event:"UnitsDialogClosed"},(e=>{this.probesData=[...this.probesData,...g.getMagicProbesData(e)]}))}})})),define("DS/CfgFilterUX/CfgFilterFactory",["DS/UIKIT/Alert","DS/CfgFilterUX/CfgFilterEditor","DS/CfgBaseUX/scripts/CfgController","DS/CfgBaseUX/scripts/CfgUtility","UWA/Class/Promise","i18n!DS/CfgFilterUX/assets/nls/CfgFilterUX","DS/CoreEvents/ModelEvents","DS/CfgBaseUX/scripts/CfgData","DS/UIKIT/Mask","i18n!DS/CfgFilterUX/assets/nls/CfgFilterUX"],(function(e,t,i,n,o,s,a,r,l,c){"use strict";return{_parameters:null,_callbackAdd:null,alertDiv:null,CfgFilterDialog:null,begin:function(o){if(this._parameters=o,"1"==this._parameters.displayCompactMode?this._parameters.displayCompactMode=!0:this._parameters.displayCompactMode=!1,this._callbackAdd=o.callback,this.alertDiv=new e({visible:!1,autoHide:!0,hideDelay:3e3,closeOnClick:!0,maximumVisibleMessages:3,className:"error"}),this.alertDiv.inject(document.body.querySelector(".f-globalFilter-container"),"top"),l.mask(o.renderTo),null==o.configData)this.filterMode="",this.execute();else{if(this.filterMode="FiringProcess",i.init(),r.ModelEvents=new a,enoviaServerFilterWidget.tenant=this._parameters.tenant,this._parameters&&this._parameters.securityContext){let e={};e.SecurityContext=this._parameters.securityContext,n.setCfgSecurityContext(e)}this.CfgFilterEditor=new t(this._parameters)}},onSecurityContext:function(e,t){var i=null;if(t._parameters&&t._parameters.rootId&&t._parameters.renderTo&&t._callbackAdd&&(console.log(t._parameters.rootId),i=t._parameters.rootId,t._callbackAdd,document.body),null!=i){const e={referenceIds:[i]};n.getMultipleConfigurationContextInfo(e).then((e=>this.createDialog(e)),(e=>{console.error("getMultipleConfigurationContextInfo call failed"),console.log(e),this.showAlert(s.Filter_Error_Models)}))}},showAlert:function(e){this.alertDiv.add({message:e,style:{position:"absolute"},className:"error"}),this.alertDiv.show(),this._callbackAdd&&this._callbackAdd([])},execute:async function(){var e,t=this;if(i.init(),r.ModelEvents=new a,enoviaServerFilterWidget.tenant=t._parameters.tenant,this._parameters&&this._parameters.securityContext){let e={};e.SecurityContext=this._parameters.securityContext,n.setCfgSecurityContext(e)}try{await n.populate3DSpaceURL(),n.isParamDefined(enoviaServerFilterWidget.mySecurityContext)||(console.log("If we dont receive SecurityContext in parameter of begin we will call populateSecurityContext service"),await n.populateSecurityContext());r.configurationCriteria=await n.checkDecouplingActivation(),!0===r.configurationCriteria.xRevisionActivation&&await n.getConfigurationSettings(),console.log(r.configurationCriteria),n.populateDisplayExpressionXSLT(),t.onSecurityContext(e,t),l.unmask(t._parameters.renderTo)}catch(e){console.log(e);let t="Native"==enoviaServerFilterWidget.mode?document.body.querySelector(".wiwFilterAlertDiv"):document.body.querySelector(".f-globalFilter-container");n.showNotifs("error",c.CFG_Filter_Failed,c.Filter_RefreshWidget,"",t)}},applyCompactComfortableMode:function(e){e="1"===e,null!=this.CfgFilterEditor&&this.CfgFilterEditor.applyCompactComfortableMode(e)},hideFilter:function(){this._parameters&&this._parameters.hideFilter()},showFilter:function(){this._parameters.showFilter()},validateConfigurationFilter:function(){var e=this;if(!1===e.CfgFilterEditor.validateCFFilter())return new o((function(e,t){e(!1)}));var t={},i="";return null===(i=null!=this.filterMode&&"FiringProcess"==this.filterMode?e.CfgFilterEditor.applyFilterFromFiringProcess(t):e.CfgFilterEditor.onApplyFilter(t))?new o((function(e,t){e(!0)})):null!=i?i:void 0},createDialog:async function(e){this._parameters=this._parameters||{};let{refBasedOn:i,modelsList:o,...a}=await n.parseGetMultipleConfigurationContextResponse(e);if(this._parameters={...this._parameters,...a,filterBasedOn:i,iModelsList:o},this._parameters.filterBasedOn){if("Model"===this._parameters.filterBasedOn){if(this._parameters.unaccessibleModelList.length>0)return void this.showAlert(s.Filter_unaccessiblecode_Error);if(0==this._parameters.iModelsList.length)return void this.showAlert(s.Filter_Error_No_Model)}this.CfgFilterEditor=new t(this._parameters),this._parameters.config_filter_id?this.CfgFilterEditor.getDataFromID(this._parameters.config_filter_id).then((()=>{this.CfgFilterEditor.render()})):this.CfgFilterEditor.render()}else this.showAlert(s.Filter_Root_Unconfigured)},areConfigurationFiltersCompatible:function(e,t,o){var s=this;i.init(),enoviaServerFilterWidget.tenant=e.tenant,enoviaServerFilterWidget.baseURL=e.url3DSpace;var a="";0!=e.securitycontext.indexOf("ctx::")&&(a="ctx::"),enoviaServerFilterWidget.mySecurityContext=a+e.securitycontext;const r={referenceIds:[e.rootid]};n.getMultipleConfigurationContextInfo(r).then((e=>{const{contextInfo:i,xRevisionContent:n}=e;let a="";if(i&&Array.isArray(i)&&i.length>0?a="Model":n&&Array.isArray(n)&&n.length>0&&(a="xRevision"),!a)return void o({code:"noAttachedModels",type:"ERROR"});const r=[];if("Model"===a){if(i.forEach((e=>{if(e&&e.content&&e.content.results&&Array.isArray(e.content.results)&&e.content.results.length>0){const t=e.content.results[0];if(t.notification&&"unaccessible"===t.notification.code&&"ERROR"===t.notification.type)return void o(t.notification.notification);r.push(t)}})),0==r.length)return void o({code:"noAttachedModels",type:"ERROR"});s.processInputFiltersCompatibility(r,t,o)}}),(()=>o({code:"failedToGetAttachedModels",type:"ERROR"})))},processInputFiltersCompatibility:function(e,t,i){var n=[],o=[];if(Array.isArray(e)){for(var s=0;s<e.length;s++)n.push(e[s].physicalID);for(Array.isArray(t),s=0;s<t.length;s++){var a=t[s];a.expression&&a.expression.modelId?-1==n.indexOf(a.expression.modelId)&&o.push(s):o.push(s)}}i(o)}}}));