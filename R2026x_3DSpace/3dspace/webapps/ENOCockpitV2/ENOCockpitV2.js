define("DS/ENOCockpitV2/ENOCockpitV2",["i18n!DS/ENOPAD3DViewer/assets/nls/PAD3DViewer.json","i18n!DS/ENOCockpitV2/assets/nls/ENOCockpitV2.json","DS/WAfrAppManager/App","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","DS/PADServices/utils/GlobalModelEvents","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/CATWebUXPreferences/CATWebUXPreferencesManager","DS/UIKIT/Mask","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/PADServices/views/ENXMePreferenceMigrationPanel","DS/PADServices/utils/GlobalUtils"],(function(e,t,i,n,o,s,r,a,c,l,g,h){"use strict";return class extends i{constructor(e){super(e),this._blockUX=null,this._isSwitchInitated=!1,this._r2vLoadedCB=[],this._eno3dviewTokens=[],this.blockWidgetUX(),this._events()}_events(){s.subscribe({event:"ENO3DView/BlockUX"},(e=>{this.blockWidgetUX(e)})),s.subscribe({event:"ENO3DView/UnblockUX"},(()=>{this.unblockWidgetUX()}))}setUp(e){return require(["DS/PADServices/utils/PADTrackerManager"],(e=>{const t=e.getPADTracker({eventCategory:"usage",eventAction:"ENXDISC_AP_version"});t.setEventData({eventLabel:"WAFR"}),t.trackPageEvent()})),new Promise((t=>{if(this.widget=widget,this.addChangeCtx(),this.widget.setMetas({helpPath:"ENOCockpitV2/assets/help"}),e.sourceApp){this.view=e.sourceApp.view;var i=n.getLayout_options("frmWindow_opts");i&&i.viewerOptions&&i.viewerOptions.viewPanelConfig&&i.viewerOptions.viewPanelConfig.uiConfig&&this.view.getViewer().updateViewPanelUIConfiguration(i);var o=e.sourceApp.appMainDiv;e.sourceApp.appMainDiv||(o=widget.body.firstChild),e.sourceApp.dispose(),n.setSetting("enopad_webapis",!1),this.restoreENOCockpitApp(o),this.view&&this.view.getController&&this.view.getController()._enableElasticLoadingForTransition();const a=this.getExecutionContext().getTargetApp();"ENXDISC_AP"===a.options.id?(this._switchInProgress=!1,this._eno3dviewTokens.push(this.view.subscribe({event:"onRealAssetLoaded"},(e=>{if(this._switchInProgress)e.callback();else{var t=this.getExecutionContext().switchApp("ENXDISC_AP","ENXDISC_RealAssets");this._switchInProgress=!0,t?t.then((()=>{e.callback()})).catch((t=>{console.error(t),e.callback()})):e.callback()}})))):"ENXDISC_RealAssets"===a.options.id&&(this._eno3dviewTokens.push(this.view.subscribe({event:"onRealAssetLoaded"},(e=>{e.callback()}))),this._eno3dviewTokens.push(this.view.subscribe({event:"onEndRootRemoved"},(e=>{if(!e.fromTimeline&&!e.fromRefresh&&!e.fromWidgetLink){const e=this.view.getRoots();let t=!1;for(let i=0;i<e.length;++i)if(r.isTileSetNode(e[i])){t=!0;break}t||this.getExecutionContext().switchApp("ENXDISC_AP").catch((e=>{console.error(e)}))}})))),e.done(),s.publish({event:"ENO3DView/UnblockUX"}),t()}else{this.view=this._executionContext.getComponent("Viewer");var a=this.widget.getValue("X3DContentId");this.widget.deleteValue("X3DContentId"),a&&setTimeout(function(){this.view.addRootNodesFromContent({json3DXContent:JSON.parse(a),dispatch:!1})}.bind(this),0),e.sourceApp&&"ENXDISC_AP"!==e.sourceApp.appId||(this._switchInProgress=!1,this._eno3dviewTokens.push(this.view.subscribe({event:"onRealAssetLoaded"},(e=>{if(this._switchInProgress)e.callback();else{var t=this.getExecutionContext().switchApp("ENXDISC_AP","ENXDISC_RealAssets");this._switchInProgress=!0,t?t.then((()=>{e.callback()})).catch((t=>{console.error(t),e.callback()})):e.callback()}})))),"undefined"==typeof widget||"true"===n.getSetting("showWelcomePanel")||s.publish({event:"ENO3DView/UnblockUX"}),null!==widget.getValue("ENO3DView_initMePref_lockZ")&&void 0!==widget.getValue("ENO3DView_initMePref_lockZ")&&(this.view.getViewer().currentViewpoint.control.lockZ=widget.getValue("ENO3DView_initMePref_lockZ")),null!==widget.getValue("ENO3DView_initMePref_projectionType")&&void 0!==widget.getValue("ENO3DView_initMePref_projectionType")&&this.view.getViewer().currentViewpoint.setProjectionType(widget.getValue("ENO3DView_initMePref_projectionType")),e.done(),t()}this.view.enableHybridDatasetLoading(),require(["DS/WebUAUtils/WebUAUtils"],(e=>{e.setPanelHelpMode({immersiveFrame:this.view.getFrameWindow().getImmersiveFrame()})}))}))}dispose(e){return new Promise((e=>{e()}))}onWillEnter(e){return new Promise(((i,n)=>{-1!==["ENXDISC_AP","ENXDISC_RealAssets"].indexOf(e.options.id)?(require(["DS/PADServices/utils/PADTrackerManager"],(t=>{var i=t.getPADTracker({eventCategory:"usage",eventAction:"transition-from"});i.setEventData({eventLabel:e.options.id}),i.trackPageEvent()})),i()):(s.publish({event:"ENO3DView/UnblockUX"}),n(new Error(` ${t.transitionRejectedInV2}`)))}))}onWillLeave(e){return new Promise(((i,n)=>{if(-1!==["ENXDISC_AP","ENXDISC_RealAssets"].indexOf(e.options.id)){require(["DS/PADServices/utils/PADTrackerManager"],(t=>{var i=t.getPADTracker({eventCategory:"usage",eventAction:"transition-to"});i.setEventData({eventLabel:e.options.id}),i.trackPageEvent()}));for(let e=0;e<this._eno3dviewTokens.length;++e)this.view.unsubscribe(this._eno3dviewTokens[e]);i()}else s.publish({event:"ENO3DView/UnblockUX"}),n(new Error(` ${t.transitionRejectedInV2}`))}))}onDestroy(){}restoreENOCockpitApp(){this.resetCommands(),this._setupPreferences(),this._setupCallbacks()}resetCommands(){}_setupPreferences(){}_setupCallbacks(){}_declineTransition(){return!1}addChangeCtx(){!0===n.getSetting("authorizeChangeControl")&&require(["DS/PADUtils/PADCommandProxy"],function(e){var t=this.view.getDOMElement("container");l._ENOCockpitAlreadyInitilized||(l._ENOCockpitAlreadyInitilized=!0,l.initialize2(t,e.appId(),"hide",n.getSetting("changeControlPosition"),function(t){this.debouncePrefSynchro=!1,this._proxy=e.create({events:{onPreferenceModification:function(e){"changeControlActivation"===e.name&&(this.debouncePrefSynchro=!0,this.widget.setValue(e.name,e.value),n.setSetting(e.name,e.value))}.bind(this)}});var i=n.getSetting("changeControlActivation");i=void 0!==this.widget.getValue("changeControlActivation")?this.widget.getBool("changeControlActivation"):t.isAuthoringContextVisible;var o="top-right";o=sessionStorage.getItem("changeControlPosition3DNavigation")?sessionStorage.getItem("changeControlPosition3DNavigation"):n.getSetting("changeControlPosition"),l.setPosition(o),!0===i?l.show():l.hide(),n.setSetting("changeControlActivation",i,!0),n.addEvent("onChangeControlActivation",this._onChangeControlActivation.bind(this)),l.addEvent&&l.addEvent("onAuthoringCtxVisible",function(e){n.setSetting("changeControlActivation",e.showAuthoringContext,!0),this._onChangeControlActivation(e.showAuthoringContext)}.bind(this)),n.addEvent("onChangeControlPosition",(function(e){l.setPosition(e),sessionStorage.setItem("changeControlPosition3DNavigation",e)})),this.widget.addEvent("onChangeControlUpdate",function(e,t){sessionStorage.getItem("changeControlPosition3DNavigation")?sessionStorage.getItem("changeControlPosition3DNavigation"):n.getSetting("changeControlPosition"),!1===t?l.hide():l.show(),this.widget.dispatchEvent("onEdit")}.bind(this))}.bind(this)))}.bind(this))}_onChangeControlActivation(e){this.debouncePrefSynchro?this.debouncePrefSynchro=!1:this._proxy.preferenceModification({name:"changeControlActivation",value:e});sessionStorage.getItem("changeControlPosition3DNavigation")?sessionStorage.getItem("changeControlPosition3DNavigation"):n.getSetting("changeControlPosition"),!0===e?l.show():l.hide()}blockWidgetUX(e){return new Promise(((i,n)=>{try{c.mask(document.body,void 0!==e?e:t.maskApplicationLoading),i()}catch(e){n(e)}}))}unblockWidgetUX(){return new Promise((e=>{c.unmask(document.body),e()}))}}}));