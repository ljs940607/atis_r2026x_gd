define("DS/ENOCustomAttributeUtils/scripts/CustomAttributeUtils",["DS/PlatformAPI/PlatformAPI","DS/WAFData/WAFData","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/UIKIT/Alert","DS/UIKIT/Mask","i18n!DS/ENOCustomAttributeUtils/assets/nls/ENOCustomAttribute"],(function(e,t,i,n,a,s){"use strict";var r={getFilterModel:function(e){var t={};for(let n in e){var i=e[n].dataIndex;e[n].filterId?t[i]={filterId:e[n].filterId,filterModel:e[n].filterModel}:"boolean"==e[n].dataType?t[i]={filterId:"set",filterModel:[]}:"number"==e[n].dataType||"integer"==e[n].dataType||"real"==e[n].dataType?t[i]={filterId:"number",filterModel:""}:"datetime"==e[n].dataType?t[i]={filterId:"date",filterModel:""}:"string"==e[n].dataType&&(e[n].range?t[i]={filterId:"set",filterModel:[]}:t[i]={filterId:"stringRegexp",filterModel:""})}return t},fetchNLSForClassifiedInterface:function(e,t){var i={};return new Promise((function(n,a){var s="/resources/v1/modeler/dslib/dslib:Class/"+e+"?$mask=dslib:ClassMask";r.makeWSCallWithCSRF(t.settings.url+s,"GET","enovia","application/json","",(function(t){Array.isArray(t.member)&&1==t.member.length?(i.id=t.member[0].id,i.type=t.member[0].name,i.typeNLS=t.member[0].title):(i.id=e,i.type=e,i.typeNLS=e),n(i)}),(function(t){i.id=e,i.type=e,i.typeNLS=e,n(i)}),t)}))},isColumnAlreadyExist:function(e,t){let i=!1;for(let n=0;n<e.length;n++){if(e[n].dataIndex===t){i=!0;break}if(e[n].children)for(let a=0;a<e[n].children.length;a++)if(e[n].children[a].dataIndex===t){i=!0;break}}return i},isTypeAlreadyExist:function(e,t){let i=!1;for(let n=0;n<e.length;n++)if(e[n].curi==="ds6wg:"+t){i=!0;break}return i},isExtensionAlreadyExist:function(e,t){let i=!1;for(let n=0;n<e.length;n++)if(e[n].curi==="ds6wg:"+t){i=!0;break}return i},isClassifiedExtensionAlreadyExist:function(e,t){let i=!1;for(let n=0;n<e.length;n++)if(e[n].curi===t){i=!0;break}return i},uniqueBy:function(e,t){return[...new Map(e.map((e=>[t(e),e]))).values()]},getCustoColsDef:function(e,t){let i=new Array;for(let n=0;n<e.columns.length;n++){let a=e.columns[n];if(t.includes(a.dataIndex))i.push(a);else if(a.children)for(let e=0;e<a.children.length;e++){let n=a.children[e];t.includes(n.dataIndex)&&i.push(n)}}return i},getCustoColDef:function(e,t){for(let i=0;i<e.length;i++){let n=e[i];if(n.dataIndex===t)return n}},booleanAggregation:function(e,t){let i="";for(var n=0;n<e.length;n++){let a=e[n].options.grid[""+t];if(!0!==a){if(!1===a){i=!1;break}i="";break}i=!0}return i},rangeAggregation:function(e,t){let i=0,n=0,a=0;for(var s=0;s<e.length;s++)isNaN(e[s].options.grid[""+t])||(i+=Number(e[s].options.grid[""+t]),a++);return n=Math.round(i/a),n},sumAvgAggregation:function(e,t){let i=0,n=0,a=0;for(var s=0;s<e.length;s++)isNaN(e[s].options.grid[""+t])||(i+=Number(e[s].options.grid[""+t]),a++);return n=i/a,`&#x2211; ${i} | x&#772; ${n} `},addAggregrationOnPredicate:function(e,t){let i=e.dataIndex,n=e.dataType,a=e.range;e.getCellClassName=function(e){if(e.rowID>=0&&e.nodeModel.options.grid.id==t.settings.aggregationRowID)return t.settings.aggregationRowClass},e.getCellValue=function(e){if(e.nodeModel.getAttributeValue("isLastNode")){var s=e.nodeModel.getBrothers();return s=s.filter((e=>"Cancelled"!=e.options.grid.maturity&&e.options.grid.id!=t.settings.aggregationRowID)),"boolean"===n?r.booleanAggregation(s,i):"number"===n?a?r.rangeAggregation(s,i):r.sumAvgAggregation(s,i):""}return e.nodeModel.getAttributeValue(i)}},applyCustomAttributes:async function(e,t,i){i.settings.tenant||(i.settings.tenant=widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise"),i.settings.ENO_CSRF_TOKEN=await r.getCSRFToken(i),t=t||"Default View";let n=i.dgvHandle,s=i.ootb_columns,o=[],l=[],d=[],g=this,u=[];s.filter((e=>{if(e.ds6wIndexMapping)return e.ds6wIndexMapping}));if(n.treeDocument.getAllDescendants().length>0){e.forEach((e=>{if(e.identifier==t){let t=e.columnsVisibleFlag;t&&(u=Object.keys(t).filter((e=>t[e])))}})),u.forEach((e=>{g.isColumnAlreadyExist(s,e)||"ContextualMenuColumn"===e||o.push(e)}));for(let e=0;e<n.model.length;e++){let t=n.model[e];UWA.is(i.settings.aggregationRowRequired)&&!0===i.settings.aggregationRowRequired&&t.options.grid.id===i.settings.aggregationRowID||UWA.is(t.options.grid.isCategory)&&!0===t.options.grid.isCategory||!UWA.is(t.options.grid.id)||(l.push(t.options.grid.id),d.push(t))}if(o.length>0&&l.length>0){if(UWA.is(i.settings.refRequired)&&!0===i.settings.refRequired){let e=[];n.columns.forEach((t=>{!0===t.isAppDataFetched&&(t.children?e=e.concat(t.children.filter((e=>!0===e.visibleFlag))):t.visibleFlag&&(e=e.concat(t)))}));let t=e.map((e=>e.dataIndex));o=o.filter((e=>!t.includes(e)))}let e=r.getCustoColsDef(n,o);r.updateAsynAttributeColumn(o,l,d,i,e);let t=n.treeDocument.getFilterManager().filterModel,a=r.getFilterModel(e);Object.keys(a).forEach((e=>{t[e]=a[e]})),n.treeDocument.setFilterModel(t),n.treeDocument.reapplyFilterModel()}}i.dgvDiv&&a.unmask(i.dgvDiv)},applyCustomAttributes_V2:async function(e,t){e.settings.tenant||(e.settings.tenant=widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise"),e.settings.ENO_CSRF_TOKEN=await r.getCSRFToken(e);let i=e.dgvHandle,n=[],a=[],s=[];if(t.forEach((e=>{s.push(i.customColInfoURI&&i.customColInfoURI[e]?i.customColInfoURI[e]:e)})),i.treeDocument.getAllDescendants().length>0){for(let t=0;t<i.model.length;t++){let s=i.model[t];UWA.is(e.settings.aggregationRowRequired)&&!0===e.settings.aggregationRowRequired&&s.options.grid.id===e.settings.aggregationRowID||UWA.is(s.options.grid.isCategory)&&!0===s.options.grid.isCategory||!UWA.is(s.options.grid.id)||(n.push(s.options.grid.id),a.push(s))}if(s.length>0&&n.length>0){if(UWA.is(e.settings.refRequired)&&!0===e.settings.refRequired){let e=[];i.columns.forEach((t=>{!0===t.isAppDataFetched&&(t.children?e=e.concat(t.children.filter((e=>!0===e.visibleFlag))):t.visibleFlag&&(e=e.concat(t)))}));let t=e.map((e=>e.dataIndex));s=s.filter((e=>!t.includes(e)))}let t=r.getCustoColsDef(i,s);await r.updateAsynAttributeColumn(s,n,a,e,t);let o=i.treeDocument.getFilterManager().filterModel,l=r.getFilterModel(t);Object.keys(l).forEach((e=>{o[e]=l[e]})),i.treeDocument.setFilterModel(o),i.treeDocument.reapplyFilterModel()}}},launchCustomViewManager:async function(e){e.dgvDiv&&a.mask(e.dgvDiv),await this.updateColumnDefinition(e),e.dgvHandle.getCustomViewsManager().showCustomViewsDialog(),e.dgvDiv&&a.unmask(e.dgvDiv)},launchCustomViewManager_V2:async function(e){await this.updateColumnDefinition_V2(e),e.dgvHandle.getCustomViewsManager().showCustomViewsDialog(),a.unmask(widget.body)},processSizeAllColumnsToFitCustomData:function(e,t,i,n){let a=new Array;Array.isArray(n)&&n.forEach((e=>{for(let t=0;t<i.dgvHandle.columns.length;t++){let n=i.dgvHandle.columns[t];n.dataIndex!==e&&n.dataIndex!==i.dgvHandle.layout.getDataIndexFromColumnIndex(e)||a.push({di:n.dataIndex,width:n.width})}})),e.forEach((e=>{e.identifier===t&&Array.isArray(n)&&a.length>0&&(UWA.is(e.columnsWidth)||(e.columnsWidth={}),a.forEach((t=>{e.columnsWidth[t.di]=t.width})))})),i.dgvHandle.getCustomViewsManager().setCustomViews(e)},processCustomViews:function(e,t,i,n){let a,s;i.dgvHandle.identifier;(UWA.is(n.columnWidthChange)||UWA.is(n.columnVisibleStateChange))&&i.dgvHandle.columns.forEach((e=>{!UWA.is(n.columnWidthChange)||n.columnWidthChange!==e.dataIndex&&i.dgvHandle.layout.getDataIndexFromColumnIndex(n.columnWidthChange)!==e.dataIndex||(a={di:e.dataIndex,width:e.width}),!UWA.is(n.columnVisibleStateChange)||n.columnVisibleStateChange!==e.dataIndex&&i.dgvHandle.layout.getDataIndexFromColumnIndex(n.columnVisibleStateChange)!==e.dataIndex||(s={di:e.dataIndex,visibleFlag:e.visibleFlag})})),e.forEach((e=>{e.identifier===t&&(UWA.is(n.columnWidthChange)&&UWA.is(a)&&(UWA.is(e.columnsWidth)||(e.columnsWidth={}),e.columnsWidth[a.di]=a.width),UWA.is(n.columnVisibleStateChange)&&UWA.is(s)&&(UWA.is(e.columnsVisibleFlag)||(e.columnsVisibleFlag={}),e.columnsVisibleFlag[s.di]=s.visibleFlag))})),i.dgvHandle.getCustomViewsManager().setCustomViews(e)},restoreCustomViews:async function(e,t,i){i?await r.updateColumnDefinition_V2(t):await r.updateColumnDefinition(t);let n=e.customViews,a=e.currentCustomViewIdentifier;t.dgvHandle.getCustomViewsManager().setCustomViews(n),t.dgvHandle.getCustomViewsManager().setCurrentCustomView(a),UWA.is(t.dgvHandle.getCustomViewsManager().getCurrentCustomView())&&Array.isArray(t.dgvHandle.getCustomViewsManager().getCurrentCustomView().sortModel)&&t.dgvHandle.getCustomViewsManager().getCurrentCustomView().sortModel.length>0&&(t.dgvHandle.sortModel=t.dgvHandle.getCustomViewsManager().getCurrentCustomView().sortModel,t.dgvHandle.reapplySortModel()),r.applyCustomAttributes(n,a,t)},updateColumnDefinition:async function(e){let t=this;e.settings.tenant||(e.settings.tenant=widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise"),e.settings.ENO_CSRF_TOKEN=await r.getCSRFToken(e);let i=e.dgvHandle,n=e.ootb_columns,o=[],l=[],d=[],g=[];i.columns;let u=[];if(u=UWA.is(e.settings.iterateRootNodesOnly)&&!0===e.settings.iterateRootNodesOnly?i.treeDocument.getRoots():i.treeDocument.getAllDescendants(),u.forEach((i=>{if(!i.options.grid.sourceType||"CSD"!=i.options.grid.sourceType){if(i.options.grid.isInstanceOperation&&"TRUE"===i.options.grid.isInstanceOperation&&i.options.grid.after_details&&i.options.grid.after_details.dataelements["ds6w:type"]?!1===t.isTypeAlreadyExist(o,i.options.grid.after_details.dataelements["ds6w:type"])&&(i.options.grid.type_instance_NLS?o.push({curi:"ds6wg:"+i.options.grid.after_details.dataelements["ds6w:type"],NLS:i.options.grid.type_instance_NLS,isCustom:!0}):o.push({curi:"ds6wg:"+i.options.grid.after_details.dataelements["ds6w:type"],NLS:i.options.grid.after_details.dataelements["ds6w:type"],isCustom:!0})):i.options.grid.type&&!1===t.isTypeAlreadyExist(o,i.options.grid.type)&&o.push({curi:"ds6wg:"+i.options.grid.type,NLS:i.options.grid.typeNLS,isCustom:!0}),UWA.is(e.settings.refRequired)&&!0===e.settings.refRequired&&i.options.grid.refType&&!1===t.isTypeAlreadyExist(o,i.options.grid.refType)&&o.push({curi:"ds6wg:"+i.options.grid.refType,NLS:i.options.grid.refTypeNLS,isCustom:!0,isAppDataFetched:!0}),i.options.grid.interfaces)for(let n of i.options.grid.interfaces)!1===t.isExtensionAlreadyExist(l,n)&&(UWA.is(e.settings.refRequired)&&!0===e.settings.refRequired?l.push({curi:"ds6wg:"+n,NLS:n,isCustom:!0,isAppDataFetched:!0}):l.push({curi:"ds6wg:"+n,NLS:n,isCustom:!0}));if(i.options.grid.classes)for(let e of i.options.grid.classes)!1===t.isClassifiedExtensionAlreadyExist(d,e.name)&&d.push({id:e.id,curi:e.name,NLS:e.NLS,isCustom:!0,attrs:e.attrs})}})),l.length>0){let t=await r.getExtensionsForClass(o.map((e=>e.curi.substring(6))).filter((e=>{if(""!=e)return e})),e);for(let e=0;e<l.length;e++)l[e].NLS=r.getExtensionNLS(t,l[e].curi)}if(o=[...o,...l],i.columns.forEach((e=>{for(let t=0;t<o.length;t++)if(UWA.is(o[t].isCustom)&&!1===o[t].isCustom&&o[t].curi===e.dataIndex){o.splice(t,1);break}})),o.length>0){var c=[];for(var f of o){var p=f.curi.substring(6);p&&"MSFDocumentInterface"!=p&&"Change Update Stamps"!=p&&c.push(p)}var m=await r.getPropertyForClassGrid(c,e.settings);if(m&&"[object Error]"!==Object.prototype.toString.call(m)){var h=m.classPredicates;i.customColInfoURI={};for(var C=0;C<o.length;C++)for(var y=0;y<h.length;y++){var w=h[y];if(o[C].curi===w.className){for(var A=[],b=w.vocabularyPredicateInfo,I=0;I<b.length;I++){var v=b[I];let t="";switch(v.range.dataTypes[0].substring(v.range.dataTypes[0].indexOf("#")+1)){case"string":default:t="string";break;case"boolean":t="boolean";break;case"integer":case"real":case"number":t="number";break;case"dateTime":case"timestamp":t="datetime"}let n=v.hasOwnProperty("rangeValues"),a=!1;"number"===t&&1!=n&&(a=!0);let s={dataIndex:v.uri,text:v.nlsName,editableFlag:!1,allowUnsafeHTMLContent:a,range:n,visibleFlag:!(!i||!i.customColInfo||void 0===i.customColInfo[v.selectable])&&i.customColInfo[v.selectable],typeRepresentation:t,dataType:t};v.selectable&&(i.customColInfoURI[v.selectable]=v.uri),UWA.is(o[C].isAppDataFetched)&&!0===o[C].isAppDataFetched&&(s.isAppDataFetched=o[C].isAppDataFetched),UWA.is(e.settings.aggregationRowRequired)&&!0===e.settings.aggregationRowRequired&&(s.compareFunction=function(t,i,n,a,s){if(n.options.grid.id!=e.settings.aggregationRowID&&a.options.grid.id!=e.settings.aggregationRowID){if(t>i)return 1;if(t==i)return 0;if(t<i)return-1}return!1},r.addAggregrationOnPredicate(s,e)),A.push(s),s=null}var x={dataIndex:o[C].curi,text:o[C].NLS,visibleFlag:!1,children:A};UWA.is(o[C].isAppDataFetched)&&!0===o[C].isAppDataFetched&&(x.isAppDataFetched=o[C].isAppDataFetched),g.push(x),x=null;break}}let a=t.removeAndGetcommonPredicatesFromAllTypes(g,n),s=[];for(let e=0;e<n.length;e++){let t=n[e];t.children&&t.children.forEach((e=>{e.ds6wIndexMapping&&s.push(e)})),t.ds6wIndexMapping&&s.push(t)}let l=s.map((e=>e.ds6wIndexMapping));for(let e of a)l.includes(e.dataIndex)||r.isColumnAlreadyExist(i.columns,e.dataIndex)||i.addColumnOrGroup(e);for(let e of l){let t=!1;for(let i=0;i<g.length;i++){for(let n=0;n<g[i].children.length;n++)if(g[i].children[n].dataIndex===e){g[i].children.splice(n,1),t=!0;break}if(!0===t)break}}for(let t of d){for(A=[],I=0;I<t.attrs.length;I++){var S=t.attrs[I],D="";switch(S.type){case"string":default:D="string";break;case"boolean":D="boolean";break;case"integer":case"real":case"number":D="number";break;case"dateTime":case"timestamp":D="datetime"}let n=v.hasOwnProperty("rangeValues"),a=!1;"number"===D&&1!=n&&(a=!0);let s={dataIndex:S.curi,text:S.NLS,visibleFlag:!(!i||!i.customColInfo||void 0===i.customColInfo[S.curi])&&i.customColInfo[S.curi],typeRepresentation:D,dataType:D,editableFlag:!1,allowUnsafeHTMLContent:a,range:n};UWA.is(e.settings.aggregationRowRequired)&&!0===e.settings.aggregationRowRequired&&(s.compareFunction=function(t,i,n,a,s){if(n.options.grid.id!=e.settings.aggregationRowID&&a.options.grid.id!=e.settings.aggregationRowID){if(t>i)return 1;if(t==i)return 0;if(t<i)return-1}return!1},r.addAggregrationOnPredicate(s,e)),A.push(s),s=null}x={dataIndex:t.curi,text:t.NLS,visibleFlag:!1,children:A};g.push(x),x=null}for(let e of g)r.isColumnAlreadyExist(i.columns,e.dataIndex)||i.addColumnOrGroup(e)}else console.log(s.CUSTOM_ATTR_FED_SERVICE_DOWN),e.dgvDiv&&a.unmask(e.dgvDiv)}},updateColumnDefinition_V2:async function(e){let t=this;e.settings.tenant||(e.settings.tenant=widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise"),e.settings.ENO_CSRF_TOKEN=await r.getCSRFToken(e);let i=e.dgvHandle,n=e.ootb_columns,o=[],l=[],d=[],g=[],u=[];i.columns;let c=[];if(c=UWA.is(e.settings.iterateRootNodesOnly)&&!0===e.settings.iterateRootNodesOnly?i.treeDocument.getRoots():i.treeDocument.getAllDescendants(),c.forEach((i=>{if(!i.options.grid.sourceType||"CSD"!=i.options.grid.sourceType){if(i.options.grid.isInstanceOperation&&"TRUE"===i.options.grid.isInstanceOperation&&i.options.grid.after_details&&i.options.grid.after_details.dataelements["ds6w:type"]?!1===t.isTypeAlreadyExist(o,i.options.grid.after_details.dataelements["ds6w:type"])&&(i.options.grid.type_instance_NLS?o.push({curi:"ds6wg:"+i.options.grid.after_details.dataelements["ds6w:type"],NLS:i.options.grid.type_instance_NLS,isCustom:!0}):o.push({curi:"ds6wg:"+i.options.grid.after_details.dataelements["ds6w:type"],NLS:i.options.grid.after_details.dataelements["ds6w:type"],isCustom:!0})):i.options.grid.type&&!1===t.isTypeAlreadyExist(o,i.options.grid.type)&&o.push({curi:"ds6wg:"+i.options.grid.type,NLS:i.options.grid.typeNLS,isCustom:!0}),UWA.is(e.settings.refRequired)&&!0===e.settings.refRequired&&i.options.grid.refType&&!1===t.isTypeAlreadyExist(o,i.options.grid.refType)&&o.push({curi:"ds6wg:"+i.options.grid.refType,NLS:i.options.grid.refTypeNLS,isCustom:!0,isAppDataFetched:!0}),i.options.grid.interfaces)for(let n of i.options.grid.interfaces)!1===t.isExtensionAlreadyExist(l,n)&&(UWA.is(e.settings.refRequired)&&!0===e.settings.refRequired?l.push({curi:"ds6wg:"+n,NLS:n,isCustom:!0,isAppDataFetched:!0}):l.push({curi:"ds6wg:"+n,NLS:n,isCustom:!0}));if(i.options.grid.classes)for(let e of i.options.grid.classes)!1===t.isClassifiedExtensionAlreadyExist(d,e.name)&&(d.push({id:e.id,curi:e.name,NLS:e.NLS,isCustom:!0,attrs:e.attrs}),e.attrs.forEach((e=>{g.push(e.curi)})))}})),g.length>0)try{var f,p=await r.getNLSNames({data:g.toString(),settings:e.settings});if(p&&p.vocabularyElementNLSInfo&&Array.isArray(p.vocabularyElementNLSInfo)){let e=p.vocabularyElementNLSInfo;f=new Map(e.map((e=>[e.uri,e.nlsName])))}f&&d.forEach((e=>{e.attrs.forEach((e=>{f.has(e.curi)&&(e.NLS=f.get(e.curi))}))}))}catch(e){}if(l.length>0){let t=await r.getExtensionsForClass(o.map((e=>e.curi.substring(6))).filter((e=>{if(""!=e)return e})),e);for(let e=0;e<l.length;e++)l[e].NLS=r.getExtensionNLS(t,l[e].curi)}o.length;if(o=[...o,...l],i.columns.forEach((e=>{for(let t=0;t<o.length;t++)if(UWA.is(o[t].isCustom)&&!1===o[t].isCustom&&o[t].curi===e.dataIndex){o.splice(t,1);break}})),o.length>0){var m=[];for(var h of o){var C=h.curi.substring(6);C&&"MSFDocumentInterface"!=C&&"Change Update Stamps"!=C&&m.push(C)}var y=await r.getPropertyForClassGrid(m,e.settings);if(y&&"[object Error]"!==Object.prototype.toString.call(y)){var w=y.classPredicates;i.customColInfoURI={};for(var A=0;A<o.length;A++)for(var b=0;b<w.length;b++){var I=w[b];if(o[A].curi===I.className){for(var v=[],x=I.vocabularyPredicateInfo,S=0;S<x.length;S++){var D=x[S];let t="";switch(D.range.dataTypes[0].substring(D.range.dataTypes[0].indexOf("#")+1)){case"string":default:t="string";break;case"boolean":t="boolean";break;case"integer":case"real":case"number":t="number";break;case"dateTime":case"timestamp":t="datetime"}let n=D.hasOwnProperty("rangeValues"),a=!1;"number"===t&&1!=n&&(a=!0);let s={dataIndex:D.uri,text:D.nlsName,editableFlag:!1,allowUnsafeHTMLContent:a,range:n,visibleFlag:!(!i||!i.customColInfo||void 0===i.customColInfo[D.selectable])&&i.customColInfo[D.selectable],typeRepresentation:t,dataType:t};D.selectable&&(i.customColInfoURI[D.selectable]=D.uri),UWA.is(o[A].isAppDataFetched)&&!0===o[A].isAppDataFetched&&(s.isAppDataFetched=o[A].isAppDataFetched),UWA.is(e.settings.aggregationRowRequired)&&!0===e.settings.aggregationRowRequired&&(s.compareFunction=function(t,i,n,a,s){if(n.options.grid.id!=e.settings.aggregationRowID&&a.options.grid.id!=e.settings.aggregationRowID){if(t>i)return 1;if(t==i)return 0;if(t<i)return-1}return!1},r.addAggregrationOnPredicate(s,e)),v.push(s),s=null}var F={dataIndex:o[A].curi,text:o[A].NLS,visibleFlag:!1,children:v};UWA.is(o[A].isAppDataFetched)&&!0===o[A].isAppDataFetched&&(F.isAppDataFetched=o[A].isAppDataFetched),u.push(F),F=null;break}}for(let t of d){for(v=[],S=0;S<t.attrs.length;S++){var N=t.attrs[S],E="";switch(N.type){case"string":default:E="string";break;case"boolean":E="boolean";break;case"integer":case"real":case"number":E="number";break;case"dateTime":case"timestamp":E="datetime"}let n=D.hasOwnProperty("rangeValues"),a=!1;"number"===E&&1!=n&&(a=!0);let s={dataIndex:N.curi,text:N.NLS,visibleFlag:!(!i||!i.customColInfo||void 0===i.customColInfo[N.curi])&&i.customColInfo[N.curi],typeRepresentation:E,dataType:E,editableFlag:!1,allowUnsafeHTMLContent:a,range:n};UWA.is(e.settings.aggregationRowRequired)&&!0===e.settings.aggregationRowRequired&&(s.compareFunction=function(t,i,n,a,s){if(n.options.grid.id!=e.settings.aggregationRowID&&a.options.grid.id!=e.settings.aggregationRowID){if(t>i)return 1;if(t==i)return 0;if(t<i)return-1}return!1},r.addAggregrationOnPredicate(s,e)),v.push(s),s=null}F={dataIndex:t.curi,text:t.NLS,visibleFlag:!1,children:v};u.push(F),F=null}let t=[];for(let e=0;e<n.length;e++){let i=n[e];i.children&&i.children.forEach((e=>{e.ds6wIndexMapping&&t.push(e)})),i.ds6wIndexMapping&&t.push(i)}let a=t.map((e=>e.ds6wIndexMapping));for(let e of a)for(let t=0;t<u.length;t++){let i=u[t].children;for(let t=i.length-1;t>=0;t--)i[t].dataIndex===e&&i.splice(t,1)}const s=["ds6w:groupCoordinator","ds6w:groupAssignee","ds6w:groupContributor","ds6w:groupChangeFollower"];for(let e of u)if(e.children)for(let t=0;t<e.children.length;t++)r.isColumnAlreadyExist(i.columns,e.children[t].dataIndex)||s.includes(e.children[t].dataIndex)||i.addColumnOrGroup(e.children[t]);else r.isColumnAlreadyExist(i.columns,e.dataIndex)||s.includes(e.dataIndex)||i.addColumnOrGroup(e)}else console.log(s.CUSTOM_ATTR_FED_SERVICE_DOWN),e.dgvDiv&&a.unmask(e.dgvDiv)}},getExtensionNLS:function(e,t){let i=t.substring(6),n=i;for(let t=0;t<e.results.length;t++){let a=e.results[t];if(a.interfaces)for(let e=0;e<a.interfaces.length;e++)if(i===a.interfaces[e].name){n=a.interfaces[e].nlsName;break}}return n},getExtensionsForClass:function(e,t){return new Promise((function(i,n){var a={classes:e},s=JSON.stringify(a);r.makeWSCallWithCSRF(t.settings.url+"/resources/dictionary/class/interfaces","POST","enovia","application/json",s,(function(e){i(e)}),n,t)}))},getPropertyForClassGrid:function(e,t){return new Promise((function(n,a){let s=t.tenant;var r="en";widget&&widget.getValue("lang")&&(r=widget.getValue("lang")),widget&&widget.lang&&(r=widget.lang);let o={tenantId:s,lang:r,onComplete:function(e){n(e)},onFailure:function(e){n(e)}};i.getPropertiesForClass(e,o)}))},removeAndGetcommonPredicatesFromAllTypes:function(e,t,i){let n=this;for(let t of e)t.children=n.uniqueBy(t.children,(e=>e.dataIndex));let a=[];for(let t=0;t<e.length;t++){for(let i=0;i<e[t].children.length;i++){let n=e[t].children[i],s=!1;for(let i=0;i<e.length;i++)if(i!==t)for(let t=0;t<e[i].children.length;t++)if(n.dataIndex===e[i].children[t].dataIndex||UWA.is(e[i].children[t].ds6wIndexMapping)&&n.dataIndex===e[i].children[t].ds6wIndexMapping){s=!0,e[i].children.splice(t,1);break}!0===s?(a.push(n),e[t].children[i].isCommon=!0):e[t].children[i].isCommon=!1}let i=[];for(let n=0;n<e[t].children.length;n++)!1===e[t].children[n].isCommon&&i.push(e[t].children[n]);for(let e of i)delete e.isCommon;for(let e of a)delete e.isCommon;e[t].children=i}i&&1===i&&(e[0].children.forEach((e=>{a.push(e)})),e[0].children.length=0);for(let i of t){for(let e=0;e<a.length;e++)if(i.dataIndex===a[e].dataIndex){a.splice(e,1);break}for(let t=0;t<e.length;t++)for(let n=0;n<e[t].children.length;n++)if(i.dataIndex===e[t].children[n].dataIndex){e[t].children.splice(n,1);break}}return a},updateAsynAttributeColumn:async function(e,t,i,n,s){window.performance.now();return r.getCustomAttributesWithUXService(e,t,n).then((async function(t){let o=t.data;const l={};o.forEach((e=>{for(let t in e)("id"!==t||t.includes("ds6w:"))&&(l[t]||(l[t]=[]),Array.isArray(e[t])&&e[t].forEach((e=>{l[t].push({value:e,source:["3DSpace"]})})))}));const d=await r.getNLSValuesPromiseForSource(l,n.settings);if(console.log(d),null!=o){Array.isArray(i)&&i.length>0&&i[0].getTreeDocument().prepareUpdate();const t=new Map;for(const e of o)t.set(e.id,e);for(let n=0;n<i.length;n++){let a=i[n],o=[...e],l=t.get(a.options.grid.id);for(let e=0;e<o.length;e++){let t=r.getCustoColDef(s,o[e]),i=l[o[e]],n="";if(UWA.is(i)&&""!==i){if(t&&t.dataType)switch(t.dataType.toLowerCase()){case"integer":case"real":case"number":Array.isArray(i)&&(i=i.length>0?i.map(Number):""),""!==i&&(n=i);break;case"datetime":case"timestamp":Array.isArray(i)&&(i=i.length>0?i[0]:""),""!==i&&(n=new Date(i));break;case"string":if(Array.isArray(i))if("ds6w:type"===t.dataIndex)n=a.options.grid.typeNLS;else for(let e=0;e<i.length;e++)n+=d&&d[t.dataIndex]&&d[t.dataIndex][i[e]]?d[t.dataIndex][i[e]]:i[e],e<=i.length-2&&(n+=",");else n=i;break;case"boolean":Array.isArray(i)&&(i=i.length>0?i[0]:""),n="TRUE"==i||"True"==i||"true"==i||"FALSE"!=i&&"False"!=i&&"false"!=i&&i;break;default:n=i}else console.log("Either Column Def or its Data type is undefined!");a.setAttribute(o[e],n)}}}Array.isArray(i)&&i.length>0&&i[0].getTreeDocument().pushUpdate(),e.length>0&&n.dgvDiv&&a.unmask(n.dgvDiv)}}))},getNLSAttributeValue:function(e,t){var i=[];return Array.isArray(e)||e.split(","),e.forEach((e=>{t.literalInfo.forEach((t=>{e.trim()==t.value.trim()&&i.push(t.nlsValue)}))})),i},getCustomAttributesWithUXService:function(e,t,i){return new Promise((function(n,a){let s=[...e],o={data:[{physicalid:t,label:"custo attr fetch",select_predicate:s}]},l=JSON.stringify(o);r.makeWSCallWithCSRF(i.settings.url+"/resources/v1/chguxservices/connectedChange/genericResourceFetch","POST","enovia","application/json",l,(function(e){let t={};t=e,n(t)}),(function(e){a(e)}),i)}))},makeWSCallWithCSRF:function(e,i,n,s,o,l,d,g){var u="application/json",c=(new Date).getTime();e=-1==e.indexOf("?")?e+"?tenant="+g.settings.tenant+"&timestamp="+c:e+"&tenant="+g.settings.tenant+"&timestamp="+c;var f=encodeURIComponent(g.settings.securityContext),p=g.settings.ENO_CSRF_TOKEN;l=l||function(){},d=d||function(){};var m=widget.getValue("lang");widget.lang&&(m=widget.lang);var h={};h.method=i,h.timeout=12e6,null!=g&&null!=g.isSwymUrl&&0!=g.isSwymUrl||(h.type="json"),g.settings.isNative||(n&&(h.auth={passport_target:n}),h.proxy=window.UWA.Data.proxies.passport?"passport":"ajax"),h.headers=f?{Accept:u,"Content-Type":s,SecurityContext:f,"Accept-Language":m,ENO_CSRF_TOKEN:p}:{Accept:u,"Content-Type":s,"Accept-Language":m},null!=g&&null!=g.issueVersion&&""!=g.issueVersion&&(h.headers[g.issueVersion]=g.version),o&&(h.data=o),h.onComplete=function(e){var t=void 0;if(e.data&&Array.isArray(e.data)&&e.data[0]&&e.data[0]["error report"]&&Array.isArray(e.data[0]["error report"])){var i=e.data[0]["error report"],n="";t=[];for(var a=0;a<i.length;a++){var s=i[a];s&&s.message&&(n=n+s.message+"<br>"),s&&s.id&&t.push(s.id)}r.message("error",n),e.data.splice(0,1)}l(e,t)},h.onFailure=function(t,o){console.log("Error in calling url: "+e),console.log("Additional Details:: httpMethod: "+i+" authentication: "+n+" securityContext: "+f+" ContentType: "+s),console.log("Error Detail: "+t),console.log("Error Data: "+JSON.stringify(o)),o&&o.errorMessage?r.message("error",o.errorMessage):o&&o.error&&o.error.message?r.message("error",o.error.message):o&&o.internalError?r.message("error",o.internalError):o&&o.error?r.message("error",o.error):t&&t.message?t.message.includes("Elements6WNLSNames")||r.message("error",t.message):r.message("error","Something went wrong, please check logs for more details"),d(t,o),widget.body&&a.unmask(widget.body)},h.onTimeout=function(){console.log("Timedout for url: "+e),r.message("error","Webservice Timedout, please refresh and try again"),widget.body&&a.unmask(widget.body)},t.authenticatedRequest(e,h)},getCSRFToken:function(e){return new Promise((function(t,i){r.makeWSCallWithCSRF(e.settings.url+"/resources/v1/application/CSRF","GET","enovia","application/json","",(function(e){t(e.csrf.value)}),i,e)}))},message:function(e,t){this.alertCA=new n({closable:!0,visible:!0,autoHide:"error"!==e,hideDelay:5e3,className:"wp-alert"}).inject(document.body,"top"),this.alertCA.add({className:e,message:t})},getNLSNames:function(e){return new Promise((function(t,i){var n=e.data;r.makeWSCallWithCSRF(e.settings.url+"/resources/6WVocab2/access/Elements6WNLSNames","POST","enovia","application/json",n,(function(e){t(e)}),i,e)}))},getNLSValuesPromiseForSource:function(e,t){return new Promise((function(n,a){if(null!=e){let r=t.tenant;var s="en";widget&&widget.getValue("lang")&&(s=widget.getValue("lang")),widget&&widget.lang&&(s=widget.lang),i.getNlsOfPropertiesValuesBySource(e,{tenantId:r,lang:s,onComplete:function(e){n(e)},onFailure:function(e){a(e)}})}else n(e)}))}};return r}));