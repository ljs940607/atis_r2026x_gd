define("DS/VCXWebSystem/VCXEnums",["UWA/Class","DS/Visualization/ThreeJS_DS"],(function(e,t){"use strict";var r=e.singleton({init:function(){}});return r.Color={White:(new t.Color).setRGB(1,1,1),Black:(new t.Color).setRGB(0,0,0),GreyDark:(new t.Color).setRGB(.1,.1,.1),Grey:(new t.Color).setRGB(.5,.5,.5),Gold:(new t.Color).setRGB(1,.766744,.334458),Aluminium:(new t.Color).setRGB(111/255,114/255,115/255),Satin:(new t.Color).setRGB(235/255,129/255,177/255)},r.TextureMapping={None:0,Planar:1,Spherical:2,Cubic:3,CylindricalFinite:4,CylindricalInfinite:5},r.EnvironmentalId={None:0,Chromic:1,Metal:2,MetalBrushed:3,Plastic:4,Glass:5,GlassPlastic:6,ChromicWithColor:7,Gold:8,Unknown:9,Aluminium:10,Satin:11,PLM:99},r.PrimitiveType={None:0,Line:1,Disc:4,Square:5,Cube:6,Sphere:7,Cylinder:8,Cone:9},r})),define("DS/VCXWebSystem/VCXTimeOutPromise",["require","exports"],(function(e,t){"use strict";return class extends Promise{constructor(e,t){const r="number"==typeof e,n=r?t:e;super(((t,i)=>{if(r){const r=setTimeout((()=>{i(new Error(`Promise timed out after ${e}ms`))}),e);n((e=>{clearTimeout(r),t(e)}),(e=>{clearTimeout(r),i(e)}))}else n(t,i)}))}static resolveWithTimeout(e,t){return t&&"function"==typeof t.then?new this(e,t.then.bind(t)):this.resolve(t)}}})),define("DS/VCXWebSystem/VCXAdvancedEventService",["require","exports","DS/CoreEvents/Events"],(function(e,t,r){"use strict";class n{static subscribe(e,t,i=n.Priority.NORMAL){return r.subscribe({event:e.event+this._getEventSuffix(i)},t)}static publish(e){let t=[n.Priority.HIGHEST,n.Priority.HIGH,n.Priority.NORMAL,n.Priority.LOW,n.Priority.LOWEST];for(let i of t)r.publish({event:e.event+n._getEventSuffix(i),data:e.data})}static unsubscribe(e){r.unsubscribe(e)}static _getEventSuffix(e){return e===n.Priority.NORMAL?"":"/"+n.Priority[e]}}return function(e){let t;!function(e){e[e.LOWEST=0]="LOWEST",e[e.LOW=1]="LOW",e[e.NORMAL=2]="NORMAL",e[e.HIGH=3]="HIGH",e[e.HIGHEST=4]="HIGHEST"}(t=e.Priority||(e.Priority={}))}(n||(n={})),n})),define("DS/VCXWebSystem/VCXGridHelper",["require","exports"],(function(e,t){"use strict";return class{constructor(e){this._step=e,this._head=null,this._tail=null}set step(e){this._step=e}get head(){return this._head}get tail(){return this._tail}set head(e){this._head=e}set tail(e){this._tail=e}addNewLine(e,t){t?this._head=e:this._tail=e}popLine(){this._tail&&(this._tail=this._tail-this._step)}shiftLine(){this._head&&(this._head=this._head+this._step)}displayGrid(e){let t="[";t+=e,t+="] : ",t+=this._head+" -> ",t+=this._tail,t+=" : "+this._step,console.log(t)}}})),define("DS/VCXWebSystem/VCXMathTools",["require","exports","DS/Intersection/IntersectionUtils","DS/Visualization/ThreeJS_DS"],(function(e,t,r,n){"use strict";class i{static getLocalMatrixFromRefMatrix(e,t){const r=(new n.Matrix4).getInverse(t);return(new n.Matrix4).multiplyMatrices(r,e)}static getLocalVectorInReferential(e,t){const r=(new n.Matrix4).getInverse(t);return e.clone().applyMatrix4(r)}static getWorldVectorInReferential(e,t){return e.clone().applyMatrix4(t)}static getOFromMatrix(e){return e?new n.Vector3(e.elements[12],e.elements[13],e.elements[14]):new n.Vector3(0,0,0)}static getVxFromMatrix(e){return e?new n.Vector3(e.elements[0],e.elements[1],e.elements[2]):new n.Vector3(1,0,0)}static getVyFromMatrix(e){return e?new n.Vector3(e.elements[4],e.elements[5],e.elements[6]):new n.Vector3(0,1,0)}static getVzFromMatrix(e){return e?new n.Vector3(e.elements[8],e.elements[9],e.elements[10]):new n.Vector3(0,0,1)}static normalizeMatrix(e){var t=i.getVxFromMatrix(e).normalize(),r=i.getVyFromMatrix(e).normalize(),n=i.getVzFromMatrix(e).normalize();return e.clone().makeBasis(t,r,n)}static rotateMatrixAroundX(e,t){var r=(new n.Matrix4).extractRotation(e);return r.multiply((new n.Matrix4).makeRotationX(t)),r.setPosition(i.getOFromMatrix(e))}static rotateMatrixAroundY(e,t){var r=(new n.Matrix4).extractRotation(e);return r.multiply((new n.Matrix4).makeRotationY(t)),r.setPosition(i.getOFromMatrix(e))}static rotateMatrixAroundZ(e,t){var r=(new n.Matrix4).extractRotation(e);return r.multiply((new n.Matrix4).makeRotationZ(t)),r.setPosition(i.getOFromMatrix(e))}static getEulerFromQuaternion(e){var t=new n.Vector3,r=2*(e.w*e.x+e.y*e.z),i=1-2*(e.x*e.x+e.y*e.y);t.x=Math.atan2(r,i);var a=2*(e.w*e.y-e.z*e.x);Math.abs(a)>=1?t.y=Math.PI/2*Math.sign(a):t.y=Math.asin(a);var o=2*(e.w*e.z+e.x*e.y),s=1-2*(e.y*e.y+e.z*e.z);return t.z=Math.atan2(o,s),t}static getQuaternionFromEuler(e){var t=Math.cos(.5*e.z),r=Math.sin(.5*e.z),i=Math.cos(.5*e.y),a=Math.sin(.5*e.y),o=Math.cos(.5*e.x),s=Math.sin(.5*e.x),l=new n.Quaternion;return l.w=o*i*t+s*a*r,l.x=s*i*t-o*a*r,l.y=o*a*t+s*i*r,l.z=o*i*r-s*a*t,l}static getEulerFromMatrix(e,t="XYZ"){let r,n,a,o=e.elements,s=o[0],l=o[4],c=o[8],u=o[1],d=o[5],f=o[9],h=o[2],m=o[6],v=o[10];switch(t){case"XYZ":n=Math.asin(i.clamp(c,-1,1)),Math.abs(c)<.9999999?(r=Math.atan2(-f,v),a=Math.atan2(-l,s)):(r=Math.atan2(m,d),a=0);break;case"YXZ":r=Math.asin(-i.clamp(f,-1,1)),Math.abs(f)<.9999999?(n=Math.atan2(c,v),a=Math.atan2(u,d)):(n=Math.atan2(-h,s),a=0);break;case"ZXY":r=Math.asin(i.clamp(m,-1,1)),Math.abs(m)<.9999999?(n=Math.atan2(-h,v),a=Math.atan2(-l,d)):(n=0,a=Math.atan2(u,s));break;case"ZYX":n=Math.asin(-i.clamp(h,-1,1)),Math.abs(h)<.9999999?(r=Math.atan2(m,v),a=Math.atan2(u,s)):(r=0,a=Math.atan2(-l,d));break;case"YZX":a=Math.asin(i.clamp(u,-1,1)),Math.abs(u)<.9999999?(r=Math.atan2(-f,d),n=Math.atan2(-h,s)):(r=0,n=Math.atan2(c,v));break;case"XZY":a=Math.asin(-i.clamp(l,-1,1)),Math.abs(l)<.9999999?(r=Math.atan2(m,d),n=Math.atan2(c,s)):(r=Math.atan2(-f,v),n=0)}return{x:r,y:n,z:a,order:t}}static makeRotationFromEuler(e,t){var r=e.elements,n=t.x,i=t.y,a=t.z,o=Math.cos(n),s=Math.sin(n),l=Math.cos(i),c=Math.sin(i),u=Math.cos(a),d=Math.sin(a);switch(t.order){case"XYZ":{let e=o*u,t=o*d,n=s*u,i=s*d;r[0]=l*u,r[4]=-l*d,r[8]=c,r[1]=t+n*c,r[5]=e-i*c,r[9]=-s*l,r[2]=i-e*c,r[6]=n+t*c,r[10]=o*l}break;case"YXZ":{let e=l*u,t=l*d,n=c*u,i=c*d;r[0]=e+i*s,r[4]=n*s-t,r[8]=o*c,r[1]=o*d,r[5]=o*u,r[9]=-s,r[2]=t*s-n,r[6]=i+e*s,r[10]=o*l}break;case"ZXY":{let e=l*u,t=l*d,n=c*u,i=c*d;r[0]=e-i*s,r[4]=-o*d,r[8]=n+t*s,r[1]=t+n*s,r[5]=o*u,r[9]=i-e*s,r[2]=-o*c,r[6]=s,r[10]=o*l}break;case"ZYX":{let e=o*u,t=o*d,n=s*u,i=s*d;r[0]=l*u,r[4]=n*c-t,r[8]=e*c+i,r[1]=l*d,r[5]=i*c+e,r[9]=t*c-n,r[2]=-c,r[6]=s*l,r[10]=o*l}break;case"YZX":{let e=o*l,t=o*c,n=s*l,i=s*c;r[0]=l*u,r[4]=i-e*d,r[8]=n*d+t,r[1]=d,r[5]=o*u,r[9]=-s*u,r[2]=-c*u,r[6]=t*d+n,r[10]=e-i*d}break;case"XZY":{let e=o*l,t=o*c,n=s*l,i=s*c;r[0]=l*u,r[4]=-d,r[8]=c*u,r[1]=e*d+i,r[5]=o*u,r[9]=t*d-n,r[2]=n*d-t,r[6]=s*u,r[10]=i*d+e}}return r[3]=0,r[7]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,e}static getMatrixFromOVxVy(e,t,r){var i=t.clone(),a=(new n.Vector3).crossVectors(t,r).normalize();i.normalize();var o=(new n.Vector3).crossVectors(a,i).normalize();return(new n.Matrix4).makeBasis(i,o,a).setPosition(e)}static getMatrixFromOVxVz(e,t,r){var i=(new n.Vector3).crossVectors(r,t);return i.lengthSq()<1e-4?this.getMatrixFromOVx(e,t):this.getMatrixFromOVxVy(e,t,i)}static getMatrixFromOVyVz(e,t,r){var i=(new n.Vector3).crossVectors(t,r);return i.lengthSq()<1e-4?this.getMatrixFromOVy(e,t):this.getMatrixFromOVxVy(e,i,t)}static getMatrixFromOVzVx(e,t,r){var i=(new n.Vector3).crossVectors(t,r).normalize();return i.lengthSq()<1e-4?this.getMatrixFromOVz(e,t):this.getMatrixFromOVyVz(e,i,t)}static getMatrixFromOVzVy(e,t,r){var i=(new n.Vector3).crossVectors(r,t);return i.lengthSq()<1e-4?this.getMatrixFromOVz(e,t):this.getMatrixFromOVzVx(e,t,i)}static getMatrixFromOVx(e,t){var r=t.clone().normalize(),i=(new n.Vector3).crossVectors(new n.Vector3(0,0,1),r);return i.lengthSq()<1e-4&&(i=new n.Vector3(0,1,0)),this.getMatrixFromOVxVy(e,r,i)}static getMatrixFromOVy(e,t){var r=t.clone().normalize(),i=(new n.Vector3).crossVectors(r,new n.Vector3(0,0,1));return i.lengthSq()<1e-4&&(i=new n.Vector3(1,0,0)),this.getMatrixFromOVxVy(e,i,r)}static getMatrixFromOVz(e,t){var r=t.clone().normalize(),i=(new n.Vector3).crossVectors(new n.Vector3(0,0,1),r);return i.lengthSq()<1e-4&&(i=new n.Vector3(1,0,0)),this.getMatrixFromOVxVz(e,i,r)}static isOrthonormal(e){var t=new n.Vector3,r=new n.Vector3,i=new n.Vector3;if(e.extractBasis(t,r,i),Math.abs(t.dot(r))<.001&&Math.abs(t.dot(i))<.001&&Math.abs(r.dot(i))<.001){if(Math.abs(1-t.length())<.001&&Math.abs(1-r.length())<.001&&Math.abs(1-i.length())<.001)return!0;console.warn("Not normal")}else console.warn("Not orthogonal");return!1}static getNearestPointsBetween2Lines(e,t,r,i){let a={};var o=t.clone().normalize(),s=i.clone().normalize();if(Math.abs(o.dot(s))>.99999){var l=(r.x-e.x)*o.x+(r.y-e.y)*o.y+(r.z-e.z)*o.z;a.p1=e.clone().add(o.clone().multiplyScalar(l)),a.p2=r.clone()}else{var c=o.dot(s),u=1-c*c;if(u<1e-5)return null;var d=(new n.Vector3).subVectors(r,e),f=d.dot(o),h=-d.dot(s),m=(f+c*h)/u,v=h+c*m;a.p1=e.clone().add(o.clone().multiplyScalar(m)),a.p2=r.clone().add(s.clone().multiplyScalar(v))}return a}static getNearestDistanceBetween2Lines(e,t,r,n){var a=i.getNearestPointsBetween2Lines(e,t,r,n);return a.d=a.p1.distanceTo(a.p2),a}static getNearestDistanceSquaredBetween2Lines(e,t,r,n){var a=i.getNearestPointsBetween2Lines(e,t,r,n);return a.d=a.p1.distanceToSquared(a.p2),a}static IsMat1EqualsToMat2(e,t,r=1e-5){if(!e&&!t)return!0;if(e&&t){var n=0;for(n=0;n<16;n++)if(Math.abs(e.elements[n]-t.elements[n])>r)return!1;return!0}return!1}static isLineIntersectCircle(e,t,r,i,a,o){var s=new n.Plane;s.setFromNormalAndCoplanarPoint(a,r);var l=s.intersectLine(new n.Line3(e,t));if(!l)return!1;var c=i-o,u=i+o,d=l.distanceToSquared(r);return d>c*c&&d<u*u}static getPointProjectionOnLine(e,t,r){var i=(new n.Vector3).subVectors(r,e),a=t;return(new n.Vector3).addVectors(e,a.clone().multiplyScalar(i.dot(a)/a.dot(a)))}static isLineIntersectPoint(e,t,r,i){var a=(new n.Vector3).subVectors(r,e),o=(new n.Vector3).subVectors(t,e);return(new n.Vector3).addVectors(e,o.clone().multiplyScalar(a.dot(o)/o.dot(o))).distanceToSquared(r)<i*i}static pointOnTriangle(e,t,n,a,o){if(i.planeTemp.setFromCoplanarPoints(t.origin,n.origin,a.origin),i.planeTemp.projectPoint(e,i.h),e.distanceToSquared(i.h)<1e-5&&r.pointInFace3(i.h,t.origin,n.origin,a.origin)){const e=i.h.barycentricCoordinates(t.origin,n.origin,a.origin),r=t.direction.clone().multiplyScalar(e.alpha),s=n.direction.clone().multiplyScalar(e.beta),l=a.direction.clone().multiplyScalar(e.gamma);return o.direction.addVectors(r,s).add(l).multiplyScalar(e.normalisationFactor),o.direction.normalize(),o.origin.copy(i.h),!0}}static rayIntersectTriangle(e,t,r,n,a){const o=.01;i.edge1.subVectors(r.origin,t.origin),i.edge2.subVectors(n.origin,t.origin),i.h.crossVectors(e.direction,i.edge2);const s=i.edge1.dot(i.h);if(s>-.01&&s<o)return!1;const l=1/s;i.s.subVectors(e.origin,t.origin);const c=l*i.s.dot(i.h);if(c<0||c>1)return!1;i.q.crossVectors(i.s,i.edge1);const u=l*e.direction.dot(i.q);if(u<0||c+u>1)return!1;const d=l*i.edge2.dot(i.q);return d>o&&(a&&(a.origin.copy(e.direction).multiplyScalar(d).add(e.origin),i.lerpVectors(t.direction,r.direction,c,i.temp1),i.lerpVectors(t.direction,n.direction,u,i.temp2),a.direction.addVectors(i.temp1,i.temp2).sub(t.direction)),!0)}static isOnPlane(e,t,r,i){var a=(new n.Vector3).subVectors(e,t);return Math.abs(a.dot(r))<i}static isCylinder(e,t,r,a){var o=e[t].point,s=e[t].normal,l=e[t+1].point,c=e[t+1].normal,u=s.clone().cross(c),d=i.getNearestPointsBetween2Lines(o,s,l,c),f=(new n.Vector3).addVectors(d.p1,d.p2).multiplyScalar(.5),h=o.distanceTo(d.p1),m=new n.Vector3;let v;for(v=t;v<e.length-1&&v<=r-1;++v){var g=e[v].point,x=e[v].normal,p=e[v+1].point,y=e[v+1].normal;u.add(x.clone().cross(y));var w=i.getNearestPointsBetween2Lines(g,x,p,y);h+=g.distanceTo(w.p1),f.add(m.addVectors(w.p1,w.p2).multiplyScalar(.5))}f.divideScalar(v),h/=v,u.normalize();var b=i.getPointProjectionOnLine(f,u,o),V=b.clone(),I=h-a,S=h+a,A=I*I,C=S*S,_=new n.Vector3,M=new n.Vector3,T=new n.Vector3;m=new n.Vector3;for(v=t;v<e.length&&v<=r;++v){let t=i.getPointProjectionOnLine(f,u,e[v].point);if(m.x=_.x-t.x,m.y=_.y-t.y,m.z=_.z-t.z,m.normalize(),Math.abs(m.dot(u))>.001)return null;var E=_.distanceToSquared(t);if(E<A||E>C)return null;if(M.subVectors(b,t),T.subVectors(V,t),!(M.dot(T)<0)){var P=t.distanceToSquared(b),O=t.distanceToSquared(V);P>=O?V=t:O>=P&&(b=t)}}return b.distanceToSquared(V)<1e-4?null:{center:f=(new n.Vector3).addVectors(b,V).multiplyScalar(.5),radius:h,normal:u,point1:b,point2:V}}static isOnCylinder(e,t,r,a,o,s){var l=new n.Vector3(.5*r*o.x,.5*r*o.y,.5*r*o.z),c=new n.Vector3(t.x-l.x,t.y-l.y,t.z-l.z),u=new n.Vector3(t.x+l.x,t.y+l.y,t.z+l.z),d=i.getPointProjectionOnLine(c,l,e),f=(new n.Vector3).subVectors(c,d),h=(new n.Vector3).subVectors(u,d);if(f.dot(h)>0)return!1;var m=d.distanceToSquared(e),v=a-s,g=a+s;return m>v*v&&m<g*g}static isOnCone(e,t,r,a,o,s){var l=t,c=new n.Vector3(t.x+a*o.x,t.y+a*o.y,t.z+a*o.z),u=i.getPointProjectionOnLine(l,o,e),d=(new n.Vector3).subVectors(l,u),f=(new n.Vector3).subVectors(c,u);if(d.dot(f)>0)return!1;var h=e.distanceTo(u)/Math.tan(r),m=u.distanceToSquared(t),v=h-s,g=h+s;return m>v*v&&m<g*g}static isOnSphere(e,t,r,n){var i=e.distanceToSquared(t),a=r-n,o=r+n;return i>a*a&&i<o*o}static clamp(e,t,r){return Math.max(Math.min(e,r),t)}static lerpVectors(e,t,r,n){return n.x=e.x*(1-r)+t.x*r,n.y=e.y*(1-r)+t.y*r,n.z=e.z*(1-r)+t.z*r,n}static getPluckerCoordinates(e,t){let r=[];return r[0]=e.x*t.y-t.x*e.y,r[1]=e.x*t.z-t.x*e.z,r[2]=e.x-t.x,r[3]=e.y*t.z-t.y*e.z,r[4]=e.z-t.z,r[5]=t.y-e.y,r}static sideOperatorFromPluckerCoordinates(e,t){return"object"==typeof e&&"object"==typeof t&&6===e.length&&6===t.length?e[0]*t[4]+e[1]*t[5]+e[2]*t[3]+e[3]*t[2]+e[4]*t[0]+e[5]*t[1]:-1}static sideOperatorFromPoints(e,t,r,n){let a=i.getPluckerCoordinates(e,t),o=i.getPluckerCoordinates(r,n);return i.sideOperatorFromPluckerCoordinates(a,o)}static sideOperatorFromPointsNormal(e,t,r,n){return i.sideOperatorFromPoints(e,e.clone().add(t),r,r.clone().add(n))}static calculatePrimes(e,t){for(var r=[],n=0;n<e;n++){for(var i=n*(t*Math.random()),a=!0,o=2;o<=Math.sqrt(i);++o)if(i%o==0){a=!1;break}a&&r.push(i)}return r}static getSnailArray(e){const t=e=>{switch(e){case"right":return"down";case"down":return"left";case"left":return"up";case"up":return"right"}return"right"},r=(e,t)=>{switch(t){case"right":return{x:e.x+1,y:e.y};case"down":return{x:e.x,y:e.y-1};case"left":return{x:e.x-1,y:e.y};case"up":return{x:e.x,y:e.y+1}}return{x:0,y:0}},n=[];let i,a={x:0,y:0},o=0,s=0;for(;!e.length||e.length&&o<e.length;){for(let t=0;t<s&&(!e.length||e.length&&o<e.length);t++){if(e&&e.radius&&(Math.abs(a.x)>e.radius||Math.abs(a.y)>e.radius))return n;o++,n.push(a),a=r(a,i)}s++,i=t(i)}return n}static formatFileSize(e){if(e<0)throw new Error("File size cannot be negative");const t=["Ko","Mo","Go","To"];let r=e/1024;for(let e=0;e<t.length;e++){if(r<1024)return`${r.toFixed(2)} ${t[e]}`;r/=1024}return`${r.toFixed(2)} Po`}static formatTime(e){const t=Math.floor(e/3600),r=Math.floor(e%3600/60),n=e%60,i=Math.round(e%1*1e3);let a="";return t&&(a+=t+"h"),r&&(a+=r+"m"),n&&(a+=Math.trunc(n)+"s"+i+"ms"),a}}return i.edge1=new n.Vector3,i.edge2=new n.Vector3,i.h=new n.Vector3,i.s=new n.Vector3,i.q=new n.Vector3,i.temp1=new n.Vector3,i.temp2=new n.Vector3,i.planeTemp=new n.Plane,i})),define("DS/VCXWebSystem/VCXLinkedList",["require","exports"],(function(e,t){"use strict";class r{constructor(e){this.next=null,this.value=e}}return class{constructor(){this.head=null}push(e){const t=new r(e);if(!this.head)return void(this.head=t);let n=this.head;for(;n.next;)n=n.next;n.next=t}removeAt(e){if(!this.head||e<0)return;if(0===e)return void(this.head=this.head.next);let t=this.head,r=null,n=0;for(;t&&n<e;)r=t,t=t.next,n++;r&&t&&(r.next=t.next)}iterate(e){let t=this.head;for(;t;)e(t),t=t.next}toString(){let e="",t=this.head;for(;t;)e+=t.value+(t.next?" -> ":""),t=t.next;return e}}})),define("DS/VCXWebSystem/VCXSemaphore",["require","exports"],(function(e,t){"use strict";return class{constructor(e=1){this.currentRequests=[],this.runningRequests=0,this.maxConcurrentRequests=e}callFunction(e,...t){return new Promise(((r,n)=>{this.currentRequests.push({resolve:r,reject:n,fnToCall:e,args:t}),this.tryNext()}))}tryNext(){if(this.currentRequests.length&&this.runningRequests<this.maxConcurrentRequests){let e=this.currentRequests.shift();if(!e)return;this.runningRequests++,e.fnToCall(...e.args).then((t=>e?.resolve(t))).catch((t=>e?.reject(t))).finally((()=>{this.runningRequests--,this.tryNext()}))}}}})),define("DS/VCXWebSystem/VCXScreenFullTools",["UWA/Class"],(function(e){"use strict";let t="undefined"!=typeof window&&void 0!==window.document?window.document:{},r="undefined"!=typeof Element&&"ALLOW_KEYBOARD_INPUT"in Element,n=function(){for(var e,r=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],n=0,i=r.length,a={};n<i;n++)if((e=r[n])&&e[1]in t){for(n=0;n<e.length;n++)a[r[0][n]]=e[n];return a}return!1}();var i=e.singleton({init:function(){this.eventsRef={change:n.fullscreenchange,error:n.fullscreenerror}},request:function(e){return new Promise(function(i){var a=n.requestFullscreen,o=function(){this.off("change",o),i()}.bind(this);e=e||t.documentElement,/ Version\/5\.1(?:\.\d+)? Safari\//.test(navigator.userAgent)?e[a]():e[a](r?Element.ALLOW_KEYBOARD_INPUT:{}),this.on("change",o)}.bind(this))},exit:function(){return new Promise(function(e){if(this.isFullscreen){var r=function(){this.off("change",r),e()}.bind(this);t[n.exitFullscreen](),this.on("change",r)}else e()}.bind(this))},toggle:function(e){return this.isFullscreen?this.exit():this.request(e)},onchange:function(e){this.on("change",e)},onerror:function(e){this.on("error",e)},on:function(e,r){var n=this.eventsRef[e];n&&t.addEventListener(n,r,!1)},off:function(e,r){var n=this.eventsRef[e];n&&t.removeEventListener(n,r,!1)}});return Object.defineProperties(i,{isFullscreen:{get:function(){return Boolean(t[n.fullscreenElement])}},element:{enumerable:!0,get:function(){return t[n.fullscreenElement]}},enabled:{enumerable:!0,get:function(){return Boolean(t[n.fullscreenEnabled])}}}),i})),define("DS/VCXWebSystem/VCXTextTools",["require","exports"],(function(e,t){"use strict";class r{static computeFontDimension(e,t){let r={spaceSize:e.measureText(" "),size:e.measureText("MHgfd"),height:t,maxHeight:0};return void 0===r.size.actualBoundingBoxAscent&&(r.size.actualBoundingBoxAscent=.7*r.height),void 0===r.size.actualBoundingBoxDescent&&(r.size.actualBoundingBoxDescent=.3*r.height),"number"==typeof r.size.actualBoundingBoxAscent&&"number"==typeof r.size.actualBoundingBoxDescent?r.maxHeight=r.size.actualBoundingBoxAscent+r.size.actualBoundingBoxDescent:r.maxHeight=r.height,r}static analyseText(e,t,n,i,a,o,s){t||(t={fontInfo:r.computeFontDimension(n,a),paragraphs:[],maxHeight:0,maxWidth:0},e.split("\n").forEach((e=>{let r={words:[],lines:[]};t?.paragraphs.push(r),r.words=[],e.split(" ").forEach((e=>{var t={word:e,size:n.measureText(e)};r.words.push(t)}))})));if(!t)throw new Error("Not supported");var l=0;l+=t.fontInfo.size.actualBoundingBoxAscent;for(var c=0,u=0;u<t.paragraphs.length;u++){var d=t.fontInfo.spaceSize.width,f=t.paragraphs[u],h=0,m=0;0!==u&&(l+=t.fontInfo.maxHeight*s),f.lines=[{width:0,words:[],textY:l}];for(var v=0;v<f.words.length;v++){var g=f.words[v],x=0===h;h+g.size.width>i&&0!==v&&i>=0&&(x=!0,h=0,l+=t.fontInfo.maxHeight*o,m++,f.lines.push({width:0,words:[],textY:l})),x?g.size.actualBoundingBoxLeft&&(h+=g.size.actualBoundingBoxLeft):h+=d,g.size.actualBoundingBoxRight&&v===f.words.length-1?h+=g.size.actualBoundingBoxRight:h+=g.size.width,f.lines[m].words.push(g),f.lines[m].width=h,c<h&&(c=h)}}return e.length<10&&!isNaN(Number(e))||(l+=t.fontInfo.size.actualBoundingBoxDescent),t.maxWidth=c,t.maxHeight=l,t}static drawText(e,t,r,n,i,a){e.paragraphs.forEach((function(o){var s=o.lines.length-1;o.lines.forEach((function(o,l){var c=o.textY+n,u=r,d=e.fontInfo.spaceSize.width;if(2===a)u+=i-o.width;else if(1===a)u+=.5*(i-o.width);else if(3===a){var f=i-o.width;(f/=o.words.length-1)>0&&(s===l?f<3*d&&(d+=f):d+=f)}var h=!0;o.words.forEach((function(e){h?(h=!1,e.size.actualBoundingBoxLeft&&(u+=e.size.actualBoundingBoxLeft)):u+=d,t&&t.fillText(e.word,u,c),u+=e.size.width}))}))}))}static htmlEncode(e){return e?e.replace(/\n|\r/gm,"</br>"):""}static htmlDecode(e){if(!e)return"";let t=e.replace(/<br>/g,"");return t=t.replace(/<[^>/]*>/g,"\n"),t=t.replace(/<\/.*>/g,""),t}static getUrlVars(){var e,t={},r={};return window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,((e,r,n)=>{t[r]=decodeURIComponent(n)})),t.widgetDomain?e=t.widgetDomain:t.uwaUrl&&(e=t.uwaUrl),e?e.replace(/[?&]+([^=&]+)=([^&]*)/gi,(function(e,t,n){r[t]=n})):r=t,r}}return r})),define("DS/VCXWebSystem/VCXMutex",["require","exports"],(function(e,t){"use strict";class r{constructor(e={keepOnlyLast:!1}){this._queue=[],this._isLocked=!1,this.keepOnlyLast=e.keepOnlyLast,this.resolveToCall=[]}acquire(){return new Promise((e=>{this._queue.push({resolve:e}),this._dispatch()}))}async runExclusive(e){const t=await this.acquire();try{if(!t.allowExecute){let e=this._generateDeferredPromise();return this.resolveToCall.push(e.resolve),e.promise}let r=await e();return this.keepOnlyLast&&this.resolveToCall.forEach((e=>e(r))),this.resolveToCall=[],r}finally{t.callbackEnd()}}_generateDeferredPromise(){let e,t;return{promise:new Promise(((r,n)=>{[e,t]=[r,n]})),reject:t,resolve:e}}_dispatch(){if(this._isLocked)return;let e=this._queue.shift(),t=!0;this.keepOnlyLast&&(t=0===this._queue.length),e&&(this._isLocked=!0,e.resolve({allowExecute:t,callbackEnd:this._buildRelease()}))}_buildRelease(){return()=>{this._isLocked=!1,this._dispatch()}}}return function(e){e.RunExclusive=function(t,r,n){const i=n.value;return n.value=function(...t){let n="_mutex_"+r,a=this[n];return a||(a=new e,this[n]=a),a.runExclusive((()=>i.apply(this,t)))},n},e.RunExclusiveKeepOnlyLast=function(t,r,n){const i=n.value;return n.value=function(...t){let n="_mutex_"+r,a=this[n];return a||(a=new e({keepOnlyLast:!0}),this[n]=a),a.runExclusive((()=>i.apply(this,t)))},n}}(r||(r={})),r})),define("DS/VCXWebSystem/VCXObjectTools",["UWA/Class"],(function(e){"use strict";var t=e.singleton({init:function(){}});return t.generateDeferredPromise=function(){let e,t;return{promise:new Promise(((r,n)=>{[e,t]=[r,n]})),reject:t,resolve:e}},t.pRequire=function(e){var t=UWA.Promise.deferred();return requirejs([e],(function(e){t.resolve(e)}),(function(e){t.reject(e)})),t.promise},t.deepCompare=function(e,t,r,n,i){function a(e,t){var r=[];return(a=function(e,t){var n=r.length;for(;n--;)if(r[n--]===t)return r[n]===e;return r.push(e,t),null})(e,t)}return e===t&&0!==e||function e(t,o){var s,l,c,u,d;if((s=toString.call(t))!==toString.call(o))return i&&console.warn("____ deepCompare ____ Case 1 : toString diff "+toString.call(t)+"!=="+toString.call(o)),!1;switch(s){default:return t.valueOf()===o.valueOf();case"[object Number]":return(t=+t)===(o=+o)||(Math.abs(t-o)<1e-5||(i&&console.warn("____ deepCompare ____ Case 1.1 : number diff "+t+"!=="+o),!1));case"[object RegExp]":return t.source==o.source&&t.global==o.global&&t.ignoreCase==o.ignoreCase&&t.multiline==o.multiline&&t.lastIndex==o.lastIndex;case"[object Function]":return i&&console.warn("____ deepCompare ____ Case 2 : functions should be strictly equal because of closure context"),!1;case"[object Array]":if(n&&null!==(u=a(t,o)))return u;if((l=t.length)!=o.length)return i&&console.warn("____ deepCompare ____ Case 3 : length diff "+t.length+"!=="+o.length),!1;for(;l--;)if(!((u=t[l])===(d=o[l])&&0!==u||e(u,d)))return i&&(console.warn("____ deepCompare ____ Case 4 : array element diff "+u+"!=="+d),console.warn(u),console.warn(d)),!1;return!0;case"[object Object]":if(n&&null!==(u=a(t,o)))return u;if(l=0,r){var f=[];for(c in t)if(t.hasOwnProperty(c)){if(f.push(c),(u=t[c])===(d=o[c])&&0!==u||e(u,d))continue;return i&&(console.warn("____ deepCompare ____ Case 5 : object element diff "+u+"!=="+d),console.warn(u),console.warn(d)),!1}for(c in o)if(o.hasOwnProperty(c)&&f[l++]!=c)return i&&console.warn("____ deepCompare ____ Case 6.0 : property diff "+c),!1}else{for(c in t)if(t.hasOwnProperty(c)){if(++l,(u=t[c])===(d=o[c])&&0!==u||e(u,d))continue;return i&&(console.warn("____ deepCompare ____ Case 6.1 : property diff "+c+" "+u+"!=="+d),console.warn(u),console.warn(d)),!1}for(c in o)if(o.hasOwnProperty(c)&&--l<0)return i&&console.warn("____ deepCompare ____ Case 7 : missing property "+c),!1}return!0}}(e,t)},t})),define("DS/VCXWebSystem/VCXCommandHelperEnum",["require","exports"],(function(e,t){"use strict";var r;return function(e){let t,r;!function(e){e[e.START=0]="START",e[e.END=1]="END",e[e.NEXT=2]="NEXT",e[e.PREVIOUS=3]="PREVIOUS",e[e.WARN=4]="WARN"}(t=e.Step||(e.Step={})),function(e){e[e.DEFAULT=0]="DEFAULT",e[e.OPTIONS=1]="OPTIONS"}(r=e.Type||(e.Type={}))}(r||(r={})),r})),define("DS/VCXWebSystem/VCXLockTable",["require","exports"],(function(e,t){"use strict";return class{constructor(){this._lockTable={}}lock(e,t){if(void 0!==t)return t?this.lock(e):this.unlock(e);this._lockTable[e]=!0}unlock(e){this._lockTable[e]=!1}isLock(){return 0!==this.getLockLength()}getLockLength(){return Object.keys(this._lockTable).filter((e=>this._lockTable[e])).length}isLockBy(e){return this._lockTable[e]??!1}getLockBy(){return Object.keys(this._lockTable).filter((e=>this._lockTable[e]))}}}));var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebSystem/VCXHardwareServices",["require","exports","DS/VCXWebSystem/VCXTextTools"],(function(e,t,r){"use strict";r=__importDefault(r);class n{static IsFirefox(){return navigator.userAgent.toLowerCase().indexOf("firefox")>-1}static IsChrome(){return navigator.userAgent.toLowerCase().indexOf("firefox")>-1}static isMobileDevice(){var e=navigator&&"Win32"===navigator.platform;return n.isTouchCompliantDevice()&&!e}static isLowEndGraphicDevice(){var e=!!localStorage&&localStorage.getItem("DS_COMPOSER_LOW_GRAPHIC_CARD_DETECTED");return n.isMobileDevice()||"1"===r.default.getUrlVars().ipad||"true"===e}static isIE11(){return void 0!==document.body.style.msTextCombineHorizontal}static isTouchCompliantDevice(){var e=navigator.userAgent.toLowerCase();return!!("ontouchstart"in document.documentElement||navigator.maxTouchPoints>1&&"MacIntel"===navigator.platform||navigator.msMaxTouchPoints>0||e.match(/(iphone|ipod|ipad)/)||e.match(/(android)/)||e.match(/(iemobile)/)||e.match(/iphone/i)||e.match(/ipad/i)||e.match(/ipod/i)||e.match(/blackberry/i)||e.match(/bada/i))}static isIOSDevice(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}static GetGraphicCard(){let e=document.createElement("canvas").getContext("experimental-webgl",{stencil:!0}),t=e?.getExtension("WEBGL_debug_renderer_info");return t?e.getParameter(t.UNMASKED_RENDERER_WEBGL):null}static isLowGraphicPresent(e){return null!==e&&(e.indexOf("Intel(R) HD Graphics")>=0||e.indexOf("Intel(R) Iris(R)")>=0)}static retreiveJSCD(){let e="";if(screen.width){e+=(screen.width?screen.width:"")+" x "+(screen.height?screen.height:"")}let t=window.devicePixelRatio;var r,n,i,a=navigator.appVersion,o=navigator.userAgent,s=navigator.appName,l=""+parseFloat(navigator.appVersion),c=parseInt(navigator.appVersion,10);-1!=(n=o.indexOf("Opera"))&&(s="Opera",l=o.substring(n+6),-1!=(n=o.indexOf("Version"))&&(l=o.substring(n+8))),-1!=(n=o.indexOf("OPR"))?(s="Opera",l=o.substring(n+4)):-1!=(n=o.indexOf("Edge"))?(s="Microsoft Legacy Edge",l=o.substring(n+5)):-1!=(n=o.indexOf("Edg"))?(s="Microsoft Edge",l=o.substring(n+4)):-1!=(n=o.indexOf("MSIE"))?(s="Microsoft Internet Explorer",l=o.substring(n+5)):-1!=(n=o.indexOf("Chrome"))?(s="Chrome",l=o.substring(n+7)):-1!=(n=o.indexOf("Safari"))?(s="Safari",l=o.substring(n+7),-1!=(n=o.indexOf("Version"))&&(l=o.substring(n+8))):-1!=(n=o.indexOf("Firefox"))?(s="Firefox",l=o.substring(n+8)):-1!=o.indexOf("Trident/")?(s="Microsoft Internet Explorer",l=o.substring(o.indexOf("rv:")+3)):(r=o.lastIndexOf(" ")+1)<(n=o.lastIndexOf("/"))&&(s=o.substring(r,n),l=o.substring(n+1),s.toLowerCase()==s.toUpperCase()&&(s=navigator.appName)),-1!=(i=l.indexOf(";"))&&(l=l.substring(0,i)),-1!=(i=l.indexOf(" "))&&(l=l.substring(0,i)),-1!=(i=l.indexOf(")"))&&(l=l.substring(0,i)),c=parseInt(""+l,10),isNaN(c)&&(l=""+parseFloat(navigator.appVersion),c=parseInt(navigator.appVersion,10));var u=/Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(a),d=!!navigator.cookieEnabled;void 0!==navigator.cookieEnabled||d||(document.cookie="testcookie",d=-1!=document.cookie.indexOf("testcookie"));var f="-",h=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Chrome OS",r:/CrOS/},{s:"Linux",r:/(Linux|X11(?!.*CrOS))/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(Mac OS|MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(var m in h){var v=h[m];if(v.r.test(o)){f=v.s;break}}var g="-";let x=null;switch(/Windows/.test(f)&&(x=/Windows (.*)/.exec(f),x&&(g=x[1]),f="Windows"),f){case"Mac OS":case"Mac OS X":case"Android":x=/(?:Android|Mac OS|Mac OS X|MacPPC|MacIntel|Mac_PowerPC|Macintosh) ([\.\_\d]+)/.exec(o),x&&(g=x[1]);break;case"iOS":x=/OS (\d+)_(\d+)_?(\d+)?/.exec(a),g=g[1]+"."+g[2]+"."+(g[3]?g[3]:"0")}return{screen:e,browser:s,devicePixelRatio:t,browserVersion:l,browserMajorVersion:c,mobile:u,os:f,osVersion:g,cookies:d}}}return n})),define("DS/VCXWebSystem/VCXMeshServices",["UWA/Class","DS/Visualization/ThreeJS_DS","DS/Visualization/SceneGraphFactory","DS/Mesh/MeshUtils","DS/VCXWebSystem/VCXEnums"],(function(e,t,r,n,i){"use strict";var a=e.singleton({init:function(){this.sharing=!1,this.optimized=!1,this._primitives=[null,null,null,null,null,null,null,null,null,null]},allocIndexationArray:function(e,t){return t&&t<65536?new Uint16Array(e):new Uint32Array(e)},getPrimitiveMeshNode:function(e){var n=null;switch(e){case i.PrimitiveType.Line:null===this._primitives[e]&&(this._primitives[e]=r.createLineNode({points:[new t.Vector3(0,0,0),new t.Vector3(0,0,1)]})),n=this._primitives[e];break;case i.PrimitiveType.Disc:null===this._primitives[e]&&(this._primitives[e]=r.createCircleNode({radius:1,segments:32,fill:!0,startAngle:0,endAngle:2*Math.PI})),n=this._primitives[e];break;case i.PrimitiveType.Square:if(null===this._primitives[e]){this._primitives[e]=r.createRectangleNode({width:1,height:1,fill:!0});var a=this._primitives[e].getMatrix();a.setPosition({x:-.5,y:-.5,z:0}),this._primitives[e].setMatrix(a)}n=this._primitives[e];break;case i.PrimitiveType.Cube:null===this._primitives[e]&&(this._primitives[e]=r.createCuboidNode({cornerPoint:new t.Vector3(-.5,-.5,-.5),firstAxis:new t.Vector3(1,0,0),secondAxis:new t.Vector3(0,1,0),thirdAxis:new t.Vector3(0,0,1)})),n=this._primitives[e];break;case i.PrimitiveType.Sphere:null===this._primitives[e]&&(this._primitives[e]=r.createSphereNode({radius:1})),n=this._primitives[e];break;case i.PrimitiveType.Cylinder:null===this._primitives[e]&&(this._primitives[e]=r.createCylinderNode({bottomCenterPoint:new t.Vector3(0,0,-1),topCenterPoint:new t.Vector3(0,0,1),radius:1})),n=this._primitives[e];break;case i.PrimitiveType.Cone:null===this._primitives[e]&&(this._primitives[e]=r.createConeNode({bottomCenterPoint:new t.Vector3(0,0,-1),topCenterPoint:new t.Vector3(0,0,1),bottomRadius:1,topRadius:0})),n=this._primitives[e];break;default:n=null}return n},computeSmoothNormalsTrianglesSet:function(e,t){if(!e||!t)return null;t.length%3!=0&&console.error("VCXMeshServices : Invalid data for mesh set node");var r=new Float32Array(e.length);r.fill&&r.fill(0,0,e.length);for(var n=t.length/3,i=0;i<n;++i){var a=3*t[3*i],o=3*t[3*i+1],s=3*t[3*i+2],l={x:e[a],y:e[a+1],z:e[a+2]},c={x:e[o],y:e[o+1],z:e[o+2]},u={x:e[s],y:e[s+1],z:e[s+2]},d={x:c.x-l.x,y:c.y-l.y,z:c.z-l.z},f={x:u.x-l.x,y:u.y-l.y,z:u.z-l.z},h={x:d.y*f.z-d.z*f.y,y:d.z*f.x-d.x*f.z,z:d.x*f.y-d.y*f.x};r[a]+=h.x,r[a+1]+=h.y,r[a+2]+=h.z,r[o]+=h.x,r[o+1]+=h.y,r[o+2]+=h.z,r[s]+=h.x,r[s+1]+=h.y,r[s+2]+=h.z}for(i=0;i<e.length;i+=3){h={x:r[i],y:r[i+1],z:r[i+2]};var m=Math.sqrt(h.x*h.x+h.y*h.y+h.z*h.z);r[i]=h.x/m,r[i+1]=h.y/m,r[i+2]=h.z/m}return r},computeSmoothNormalsStripSet:function(e,t,r){if(!e||!t)return null;var n=new Float32Array(e.length);n.fill&&n.fill(0,0,e.length);for(var i=0,a=r.length,o=0;o<a;++o){for(var s=r[o],l=0;l<s-2;++l){var c=3*t[i+l],u=3*t[i+l+1],d=3*t[i+l+2],f={x:e[c],y:e[c+1],z:e[c+2]};if(1&l)var h={x:e[u],y:e[u+1],z:e[u+2]},m={x:e[d],y:e[d+1],z:e[d+2]};else m={x:e[u],y:e[u+1],z:e[u+2]},h={x:e[d],y:e[d+1],z:e[d+2]};var v={x:m.x-f.x,y:m.y-f.y,z:m.z-f.z},g={x:h.x-f.x,y:h.y-f.y,z:h.z-f.z},x={x:v.y*g.z-v.z*g.y,y:v.z*g.x-v.x*g.z,z:v.x*g.y-v.y*g.x};n[c]+=x.x,n[c+1]+=x.y,n[c+2]+=x.z,n[u]+=x.x,n[u+1]+=x.y,n[u+2]+=x.z,n[d]+=x.x,n[d+1]+=x.y,n[d+2]+=x.z}i+=s}e.length%3!=0&&console.error("VCXMeshServices : Invalid data for mesh set node");for(l=0;l<e.length;l+=3){x={x:n[l],y:n[l+1],z:n[l+2]};var p=Math.sqrt(x.x*x.x+x.y*x.y+x.z*x.z);n[l]=x.x/p,n[l+1]=x.y/p,n[l+2]=x.z/p}return n},buildIndexationFromStripSet:function(e,t,r,i,a){var o=null;switch(e){case n.ConnectivityTypeEnum.TRIANGLE_STRIP:for(var s=0,l=0;l<t;++l)s+=i[l]-2;o=this.allocIndexationArray(3*s,a.length/3);var c=0,u=0;for(l=0;l<t;++l){for(var d=i[l],f=0;f<d-2;++f)o[c++]=r[u+f],1&f?(o[c++]=r[u+f+2],o[c++]=r[u+f+1]):(o[c++]=r[u+f+1],o[c++]=r[u+f+2]);u+=d}break;case n.ConnectivityTypeEnum.LINE_STRIP:var h=0;for(l=0;l<t;++l)h+=i[l]-1;o=new Uint32Array(2*h);for(c=0,u=0,l=0;l<t;++l){for(d=i[l],f=0;f<d-1;++f)o[c++]=r[u+f],o[c++]=r[u+f+1];u+=d}break;default:console.warn("Unknown strip set, can't build indexation")}return o},buildIndexedTriangleSet:function(e,t,i,a,o,s,l,c,u,d,f){if(null===t||null===i||null===o||null===s)return console.error("VCXMeshServices : Invalid data for mesh node"),null;if(t.length%3!=0)return console.error("VCXMeshServices : Invalid data for mesh set node"),null;var h=a?a.length/2:null;if(o.length!==s.length)return console.error("VCXMeshServices : Invalid data for mesh node"),null;var m=null===c?new n.PrimitiveGroup:new n.PrimitiveGroup({fillGAS:new n.FillAttributes(c,d?1:0)});this.sharing&&(m.sharing=!0),this.optimized&&(m.optimized=!0);var v,g,x=0,p=new n.Buffer({component:n.VertexComponentEnum.POSITION,dimension:3,data:t});m.addBuffer(v=x++,p);var y,w,b=new n.Buffer({component:n.VertexComponentEnum.NORMAL,dimension:3,data:i});if(m.addBuffer(g=x++,b),a&&3*a.length==2*t.length){var V=new n.Buffer({component:n.VertexComponentEnum.TEX_COORD_0,dimension:2,data:new Float32Array(3*h)});V.data[0]=a[0];for(var I=1,S=1;S<a.length;S++)V.data[I++]=a[S],S%2&&(V.data[I++]=0);m.addBuffer(y=x++,V)}var A=null;if(o instanceof Uint8Array||o instanceof Uint16Array||o instanceof Uint32Array)A=o;else{console.warn("Buffer indexation should be Uint8Array, Uint16Array or Uint32Array"),A=this.allocIndexationArray(o.length,t.length/3);for(var C=0;C<o.length;C++)A[C]=o[C]}var _,M,T=new n.Buffer({indexBuffer:!0,dimension:1,data:A});if(m.addBuffer(w=x++,T),f)_=w;else{var E=null;if(s instanceof Uint8Array||s instanceof Uint16Array||s instanceof Uint32Array)E=s;else{console.warn("Buffer indexation should be Uint8Array, Uint16Array or Uint32Array"),E=this.allocIndexationArray(s.length,i.length/3);for(C=0;C<s.length;C++)E[C]=s[C]}var P=new n.Buffer({indexBuffer:!0,dimension:1,data:E});m.addBuffer(_=x++,P)}if(f)M=w;else if(l){var O=null;if(l instanceof Uint8Array||l instanceof Uint16Array||l instanceof Uint32Array)O=l;else{console.warn("Buffer indexation should be Uint8Array, Uint16Array or Uint32Array"),O=this.allocIndexationArray(l.length,a.length/2);for(C=0;C<l.length;C++)O[C]=l[C]}var z=new n.Buffer({indexBuffer:!0,dimension:1,data:l});m.addBuffer(M=x++,z)}var B=null===c?new n.Primitive:new n.Primitive({fillGAS:new n.FillAttributes(c,d?1:0)});B.geomType="FACE",B.nbIndices=o.length,B.connectivity=n.ConnectivityTypeEnum.TRIANGLES;var N=new n.VertexComponent;N.nbVertices=t.length,N.bufferId=v,N.indices=new n.IndexArray,N.indices.bufferId=w,N.indices.offset=0,B.addVertexComponent(N);var k=new n.VertexComponent;if(k.nbVertices=i.length,k.bufferId=g,k.indices=new n.IndexArray,k.indices.bufferId=_,k.indices.offset=0,B.addVertexComponent(k),a){var L=new n.VertexComponent;L.nbVertices=a.length,L.bufferId=y,L.indices=new n.IndexArray,L.indices.bufferId=M,L.indices.offset=0}return m.addPrimitive(B),r.createMeshNode(m,u,0,"mono")},buildMonoIndexedTriangleStripSet:function(e,t,i,a,o,s,l,c,u){if(null===t||null===i||null===o)return console.error("VCXMeshServices : Invalid data for mesh node"),null;if(t.length%3!=0)return console.error("VCXMeshServices : Invalid data for mesh set node"),null;var d=t.length/3,f=null===l?new n.PrimitiveGroup:new n.PrimitiveGroup({fillGAS:new n.FillAttributes(l,u?1:0)});this.sharing&&(f.sharing=!0),this.optimized&&(f.optimized=!0);var h=new n.Buffer({component:n.VertexComponentEnum.POSITION,data:t});f.addBuffer(0,h);var m=new n.Buffer({component:n.VertexComponentEnum.NORMAL,data:i});f.addBuffer(1,m);if(a&&3*a.length==2*t.length){var v=new n.Buffer({component:n.VertexComponentEnum.TEX_COORD_0,data:new Float32Array(3*d)}),g=0;v.data[0]=a[0];for(var x=0;x<a.length;x++)v.data[g++]=a[x],x%2&&(v.data[g++]=0);f.addBuffer(2,v)}var p=new n.Buffer({indexBuffer:!0,data:o});f.addBuffer(3,p);for(var y=0,w=0;w<e;w++){var b=new n.Primitive;b.nbIndices=s[w],b.connectivity=n.ConnectivityTypeEnum.TRIANGLE_STRIP;var V=new n.VertexComponent;V.nbVertices=s[w],V.bufferId=0,V.indices=new n.IndexArray,V.indices.bufferId=3,V.indices.offset=y,b.addVertexComponent(V);var I=new n.VertexComponent;if(I.nbVertices=s[w],I.bufferId=1,I.indices=new n.IndexArray,I.indices.bufferId=3,I.indices.offset=y,b.addVertexComponent(I),a){var S=new n.VertexComponent;S.nbVertices=s[w],S.bufferId=2,S.indices=new n.IndexArray,S.indices.bufferId=3,S.indices.offset=y,b.addVertexComponent(S)}f.addPrimitive(b),y+=s[w]}return null===c?r.createMeshNode(f):r.createMeshNode(f,c)},buildIndexedLineSet:function(e,t,i,a,o,s){var l=new n.PrimitiveGroup({lineGAS:new n.LineAttributes(i||new n.Color(1,1,1,1),a||1)});this.sharing&&(l.sharing=!0),this.optimized&&(l.optimized=!0);var c=new n.Primitive;c.nbIndices=t.length,c.connectivity=n.ConnectivityTypeEnum.LINES,c.geomType=o;var u=new n.Buffer({component:n.VertexComponentEnum.POSITION,data:e});l.addBuffer(0,u);var d=new n.Buffer({indexBuffer:!0,data:t});l.addBuffer(1,d);var f=new n.VertexComponent;return f.nbVertices=e.length,f.bufferId=0,f.indices=new n.IndexArray,f.indices.bufferId=1,f.indices.offset=0,c.addVertexComponent(f),l.addPrimitive(c),null===s?r.createMeshNode(l):r.createMeshNode(l,s)},buildLineStripSet:function(e,t,i,a,o,s,l){if(null===e||null===t.length||null===i)return console.error("VCXMeshServices : Invalid data for line set node"),null;var c=new n.PrimitiveGroup({lineGAS:new n.LineAttributes(a||new n.Color(1,1,1,1),o||1)});this.sharing&&(c.sharing=!0);var u=new n.Buffer({component:n.VertexComponentEnum.POSITION,data:e});c.addBuffer(0,u);var d=new n.Buffer({indexBuffer:!0,data:i});c.addBuffer(1,d);for(var f=0,h=0;h<t.length;h++){var m=new n.Primitive;m.nbIndices=t[h],m.connectivity=n.ConnectivityTypeEnum.LINE_STRIP,s&&(m.geomType=s);var v=new n.VertexComponent;v.nbVertices=t[h],v.bufferId=0,v.indices=new n.IndexArray,v.indices.bufferId=1,v.indices.offset=f,m.addVertexComponent(v),c.addPrimitive(m),f+=t[h]}return null===l?r.createMeshNode(c):r.createMeshNode(c,l)},buildLine:function(e,t,r,n,i){if(null===e)return console.error("VCXMeshServices : Invalid data for line set node"),null;if(e.length%3!=0)return console.error("VCXMeshServices : Invalid data for line set node"),null;for(var a=e.length/3,o=[],s=0;s<a;s++)o[s]=s;return this.buildLineStripSet(e,[a],o,i,n)},buildPointSet:function(e,t,i,a,o){if(null===e||null===t)return console.error("VCXMeshServices : Invalid data for point set node"),null;if(e.length%3!=0)return console.error("VCXMeshServices : Invalid data for point set node"),null;var s=e.length/3,l=new n.PrimitiveGroup({pointGAS:new n.PointAttributes(i||new n.Color(1,1,1,1),a||1)});this.sharing&&(l.sharing=!0);var c=new n.Buffer({component:n.VertexComponentEnum.POSITION,data:e});l.addBuffer(0,c);var u=new n.Buffer({indexBuffer:!0,data:t});l.addBuffer(1,u);for(var d=0;d<s;d++){var f=new n.Primitive;f.nbIndices=1,f.connectivity=n.ConnectivityTypeEnum.POINTS;var h=new n.VertexComponent;h.nbVertices=1,h.bufferId=0,h.indices=new n.IndexArray,h.indices.bufferId=1,h.indices.offset=d,f.addVertexComponent(h),l.addPrimitive(f)}return null===o?r.createMeshNode(l):r.createMeshNode(l,o)},buildPoint:function(e,t,r,n){var i=new Float32Array(3);i[0]=e[0],i[1]=e[1],i[2]=e[2];var a=new Uint8Array(1);return a[0]=0,this.buildPointSet(i,a,t,r,n)},buildIndexation:function(e,t,r,n){if(!(e&&t&&r&&n))return null;for(var i=[],o=0,s=0,l=0;l<t.length;l++){if(r[l]===a.IndexationType.TrianglesSet)for(var c=s+t[l],u=s;u<c;u++)i[o++]=n[u];else if(r[l]===a.IndexationType.TrianglesStripSet){c=s+t[l]-2;var d=!0;for(u=s;u<c;u++)i[o++]=n[u],d?(i[o++]=n[u+1],i[o++]=n[u+2],d=!1):(i[o++]=n[u+2],i[o++]=n[u+1],d=!0)}else if(r[l]===a.IndexationType.FanSet){c=s+t[l]-1;var f=n[s];for(u=s+1;u<c;u++)i[o++]=f,i[o++]=n[u],i[o++]=n[u+1]}s+=t[l]}for(var h=this.allocIndexationArray(i.length,e.length/3),m=0;m<i.length;++m)h[m]=i[m];return h},packIndexation:function(e,t){if(null===t||null===e||0===t.length)return null;for(var r=new Map,n=this.allocIndexationArray(t.length,e.length/3),i=0,a=0;a<t.length;a++){i<t[a]&&(i=t[a]);var o=e[m=3*t[a]]+"_"+e[m+1]+"_"+e[m+2],s=r.get(o);void 0!==s?n[a]=s:(r.set(o,t[a]),n[a]=t[a])}r=null,i+=1;for(var l=this.allocIndexationArray(i,e.length/3),c=0;c<i;++c)l[c]=!1;for(c=0;c<n.length;c++)l[n[c]]=!0;for(var u=0,d=new Map,f=0;f<i;f++)l[f]&&d.set(f,u++);var h=new Float32Array(3*d.size);u=0;for(var m=0;m<i;m++)if(l[m]){var v=3*m;h[u++]=e[v],h[u++]=e[v+1],h[u++]=e[v+2]}l=null;for(var g=this.allocIndexationArray(n.length,e.length/3),x=0;x<n.length;x++){v=d.get(n[x]);g[x]=v}return d=null,n=null,{pIndexation:g,pCoord:h}},packIndexationUv:function(e,t){if(null===t||null===e||0===t.length)return null;for(var r=new Map,n=[],i=0,a=0;a<t.length;a++){i<t[a]&&(i=t[a]);var o=e[m=2*t[a]]+"_"+e[m+1],s=r.get(o);void 0!==s?n[a]=s:(r.set(o,t[a]),n[a]=t[a])}i+=1;for(var l=[],c=0;c<i;++c)l[c]=!1;for(c=0;c<n.length;c++)l[n[c]]=!0;for(var u=0,d=new Map,f=0;f<i;f++)l[f]&&d.set(f,u++);var h=[];u=0;for(var m=0;m<i;m++)if(l[m]){var v=2*m;h[u++]=e[v],h[u++]=e[v+1]}for(var g=[],x=0;x<n.length;x++){v=d.get(n[x]);g[x]=v}return{pIndexation:g,pCoord:h}},packIndexationMono:function(e,t,r,n){if(null===n||null===e||0===n.length)return null;for(var i=new Map,a=Math.max(Math.max(e.length/3,t.length/3),r?r.length/2:0),o=this.allocIndexationArray(n.length,a),s=0,l=0;l<n.length;l++){s<n[l]&&(s=n[l]);var c=e[w=3*n[l]]+"_"+e[w+1]+"_"+e[w+2];if(t&&t.length&&(c+=t[w]+"_"+t[w+1]+"_"+t[w+2]),r&&r.length){var u=2*n[l];c+=r[u]+"_"+r[u+1]}var d=i.get(c);void 0!==d?o[l]=d:(i.set(c,n[l]),o[l]=n[l])}i=null,s+=1;for(var f=this.allocIndexationArray(s,a),h=0;h<s;++h)f[h]=!1;for(h=0;h<o.length;h++)f[o[h]]=!0;for(var m=0,v=new Map,g=0;g<s;g++)f[g]&&v.set(g,m++);for(var x=new Float32Array(3*v.size),p=new Float32Array(t&&t.length?3*v.size:0),y=new Float32Array(r&&r.length?3*v.size:0),w=(m=0,0);w<s;w++)if(f[w]){var b=3*w;x[m++]=e[b],x[m++]=e[b+1],x[m++]=e[b+2]}if(t&&t.length){m=0;for(w=0;w<s;w++)if(f[w]){b=3*w;p[m++]=t[b],p[m++]=t[b+1],p[m++]=t[b+2]}}if(r&&r.length){m=0;for(w=0;w<s;w++)if(f[w]){b=2*w;y[m++]=r[b],y[m++]=r[b+1]}}f=null;for(var V=this.allocIndexationArray(o.length,a),I=0;I<o.length;I++){b=v.get(o[I]);V[I]=b}return i=null,o=null,{pIndexation:V,pCoord:x,pNormals:p,pUv:y}},mergeGeosets:function(e){if(!e||0===e.length)return null;var t,i,a,o,s,l,c=null;if(1===e.length&&null!==e[0]){var u=e[0];switch(u.meshType){case n.ConnectivityTypeEnum.TRIANGLES:c=this.buildIndexedTriangleSet(u.nTriangles,u.vertexArray,u.normalsArray,u.uvArray,u.vertexIndexArray,u.normalsIndexArray,u.uvIndexArray,u.colorRGBA,u.material,u.isSolid,u.uniqueIndexation);break;case n.ConnectivityTypeEnum.TRIANGLE_STRIP:!0===u.uniqueIndexation&&(c=this.buildMonoIndexedTriangleStripSet(u.nStrips,u.vertexArray,u.normalsArray,u.uvArray,u.vertexIndexArray,u.lengthsArray,u.colorRGBA,u.material,u.isSolid));break;case n.ConnectivityTypeEnum.LINES:c=this.buildIndexedLineSet(u.vertexArray,u.vertexIndexArray,u.colorRGBA,u.thickness,u.edgeType,u.material);break;case n.ConnectivityTypeEnum.LINE_STRIP:c=this.buildLineStripSet(u.vertexArray,u.lengthsArray,u.vertexIndexArray,u.colorRGBA,u.thickness,u.edgeType,u.material)}if(c)return c}t=i=a=o=s=l=0;for(var d=0;d<e.length;++d){(te=e[d]).vertexArray&&(t+=te.vertexArray.length),te.normalsArray&&(i+=te.normalsArray.length),te.uvArray&&(a+=te.uvArray.length),te.vertexIndexArray&&(o+=te.vertexIndexArray.length),te.normalsIndexArray?s+=te.normalsIndexArray.length:s+=te.vertexIndexArray.length,te.uvIndexArray?l+=te.uvIndexArray.length:l+=te.vertexIndexArray.length}var f,h,m,v,g,x,p=new Float32Array(t),y=new Float32Array(i),w=a?new Float32Array(a):null,b=this.allocIndexationArray(o,t/3),V=this.allocIndexationArray(s,i/3),I=a?this.allocIndexationArray(l,a/2):null,S=!0,A=!0;f=h=m=v=g=x=0;for(d=0;d<e.length;++d){var C=f/3,_=h/3,M=m/3;if((te=e[d]).vertexArray)for(var T=0;T<te.vertexArray.length;++T)p[f++]=te.vertexArray[T];if(te.normalsArray)for(T=0;T<te.normalsArray.length;++T)y[h++]=te.normalsArray[T];if(te.uvArray&&w)for(T=0;T<te.uvArray.length;++T)w[m++]=te.uvArray[T];if(null!==te.vertexIndexArray)for(T=0;T<te.vertexIndexArray.length;++T)b[v++]=te.vertexIndexArray[T]+C;if(null!==te.normalsIndexArray)for(var E=0;E<te.normalsIndexArray.length;++E)V[g++]=te.normalsIndexArray[E]+_;else for(E=0;E<te.vertexIndexArray.length;++E)V[g++]=te.vertexIndexArray[E]+_;if(null!==te.uvIndexArray)for(var P=0;P<te.uvIndexArray.length;++P)I[x++]=te.uvIndexArray[P]+M;else if(I)for(P=0;P<te.vertexIndexArray.length;++P)I[x++]=te.vertexIndexArray[P]+M;!1===te.isSolid&&(S=!1),!1===te.uniqueIndexation&&(A=!1)}if(!0===A){var O=this.packIndexationMono(p,y,w,b);O&&(b=O.pIndexation,p=O.pCoord,y=O.pNormals,w&&(w=O.pUv),O=null,y.length&&(V=b),w&&w.length&&(I=b))}else{var z=this.packIndexation(p,b);if(z&&(p=z.pCoord,b=z.pIndexation,z=null),V.length){var B=this.packIndexation(y,V);B&&(y=B.pCoord,V=B.pIndexation,B=null)}if(I&&I.length&&w){var N=this.packIndexationUv(w,I);N&&(w=N.pCoord,I=N.pIndexation,N=null)}}var k=0,L=new n.PrimitiveGroup;this.sharing&&(L.sharing=!0),this.optimized&&(L.optimized=!0);var F,R=0;L.fillAttr=new n.FillAttributes,L.fillAttr.solid=S?1:0;var D,W,X,G,q,U=new n.Buffer({component:n.VertexComponentEnum.POSITION,dimension:3,data:p});if(L.addBuffer(F=R++,U),y.length&&V.length){var H=new n.Buffer({component:n.VertexComponentEnum.NORMAL,dimension:3,data:y});L.addBuffer(D=R++,H)}if(w&&w.length&&I.length){var j=new n.Buffer({component:n.VertexComponentEnum.TEX_COORD_0,dimension:2,data:new Float32Array(3*w.length/2)}),Y=0;j.data[0]=w[0];for(P=0;P<w.length;P++)j.data[Y++]=w[P],P%2&&(j.data[Y++]=0);L.addBuffer(W=R++,j)}if(b.length>0){var Z=new n.Buffer({indexBuffer:!0,dimension:1,data:b});L.addBuffer(X=R++,Z)}if(A)G=X;else if(V.length>0){var J=new n.Buffer({indexBuffer:!0,dimension:1,data:V});L.addBuffer(G=R++,J)}if(A)q=X;else if(I&&I.length>0){var K=new n.Buffer({indexBuffer:!0,dimension:1,data:I});L.addBuffer(q=R++,K)}var Q=0,$=0,ee=0;for(d=0;d<e.length;++d){var te;switch((te=e[d]).meshType){case n.ConnectivityTypeEnum.TRIANGLES:var re=null===te.colorRGBA?new n.Primitive:new n.Primitive({fillGAS:new n.FillAttributes(te.colorRGBA,S?1:0)});if(re.geomType="FACE",re.nbIndices=te.vertexIndexArray.length,re.connectivity=n.ConnectivityTypeEnum.TRIANGLES,(le=new n.VertexComponent).nbVertices=p.length,le.bufferId=F,le.indices=new n.IndexArray,le.indices.bufferId=X,le.indices.offset=Q,re.addVertexComponent(le),y.length)(ie=new n.VertexComponent).nbVertices=y.length,ie.bufferId=D,ie.indices=new n.IndexArray,ie.indices.bufferId=G,ie.indices.offset=$,re.addVertexComponent(ie);if(w&&w.length)(ae=new n.VertexComponent).nbVertices=w.length,ae.bufferId=W,ae.indices=new n.IndexArray,ae.indices.bufferId=q,ae.indices.offset=ee,re.addVertexComponent(ae);L.addPrimitive(re);break;case n.ConnectivityTypeEnum.TRIANGLE_STRIP:k=0;for(var ne=0;ne<te.lengthsArray.length;ne++){var ie,ae,oe=null===te.colorRGBA?new n.Primitive:new n.Primitive({fillGAS:new n.FillAttributes(te.colorRGBA,S?1:0)});if(oe.geomType="FACE",oe.nbIndices=te.lengthsArray[ne],oe.connectivity=n.ConnectivityTypeEnum.TRIANGLE_STRIP,(le=new n.VertexComponent).nbVertices=te.lengthsArray[ne],le.bufferId=F,le.indices=new n.IndexArray,le.indices.bufferId=X,le.indices.offset=Q+k,oe.addVertexComponent(le),null!==te.normalsIndexArray&&te.normalsIndexArray.length)(ie=new n.VertexComponent).nbVertices=te.lengthsArray[ne],ie.bufferId=D,ie.indices=new n.IndexArray,ie.indices.bufferId=G,ie.indices.offset=$+k,oe.addVertexComponent(ie);if(te.uvIndexArray&&te.uvIndexArray.length)(ae=new n.VertexComponent).nbVertices=te.lengthsArray[ne],ae.bufferId=W,ae.indices=new n.IndexArray,ae.indices.bufferId=q,ae.indices.offset=ee+k,oe.addVertexComponent(ae);L.addPrimitive(oe),k+=te.lengthsArray[ne]}break;case n.ConnectivityTypeEnum.LINES:(se=new n.Primitive({lineGAS:new n.LineAttributes(te.colorRGBA?te.colorRGBA:new n.Color(1,1,1,1),te.thickness?te.thickness:1)})).nbIndices=te.vertexIndexArray.length,se.connectivity=n.ConnectivityTypeEnum.LINES,se.geomType=te.edgeType,(le=new n.VertexComponent).nbVertices=p.length,le.bufferId=F,le.indices=new n.IndexArray,le.indices.bufferId=X,le.indices.offset=Q,se.addVertexComponent(le),L.addPrimitive(se);break;case n.ConnectivityTypeEnum.LINE_STRIP:for(k=0,ne=0;ne<te.lengthsArray.length;ne++){var se,le;(se=new n.Primitive({lineGAS:new n.LineAttributes(te.colorRGBA?te.colorRGBA:new n.Color(1,1,1,1),te.thickness?te.thickness:1)})).nbIndices=te.lengthsArray[ne],se.connectivity=n.ConnectivityTypeEnum.LINE_STRIP,se.geomType=te.edgeType,(le=new n.VertexComponent).nbVertices=te.lengthsArray[ne],le.bufferId=F,le.indices=new n.IndexArray,le.indices.bufferId=X,le.indices.offset=Q+k,se.addVertexComponent(le),L.addPrimitive(se),k+=te.lengthsArray[ne]}break;case n.ConnectivityTypeEnum.POINTS:console.log("Merge geosets error : Point geometry type - to be implemented");break;default:console.log("Merge geosets error : unknown geometry type")}null!==te.vertexIndexArray&&(Q+=te.vertexIndexArray.length),null!==te.normalsIndexArray&&($+=te.normalsIndexArray.length),te.uvIndexArray&&(ee+=te.uvIndexArray.length)}return A?r.createMeshNode(L,void 0,0,"mono"):r.createMeshNode(L)}});return a.IndexationType={TrianglesSet:0,TrianglesStripSet:1,FanSet:2},a}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebSystem/VCXEvent",["require","exports","DS/VCXWebSystem/VCXAdvancedEventService"],(function(e,t,r){"use strict";var n;return r=__importDefault(r),function(e){e.Handler=(e,t=r.default.Priority.NORMAL)=>{let n=Array.isArray(e)?e:[e];return function(e,r,i){const a=i.value;return e.__EventHandlers||(e.__EventHandlers=[]),e.__EventHandlers.push(...n.map((e=>({auto:!0,eventName:e,method:a,priority:t,registerID:null})))),i}},e.subscribe=function(e,t,n,i=r.default.Priority.NORMAL){t=Array.isArray(t)?t:[t],e.__EventHandlers||(e.__EventHandlers=[]);let a=e.__EventHandlers,o=[];for(let s of t)o.push({auto:!1,eventName:s,method:n,priority:i,registerID:r.default.subscribe({event:s},n.bind(e),i)}),a.push(...o);return o.map((e=>e.registerID))},e.unsubscribe=function(e,t){if(t=Array.isArray(t)?t:[t],!e.__EventHandlers)return;e.__EventHandlers.filter((e=>t.includes(e.registerID))).forEach((e=>{r.default.unsubscribe(e.registerID),e.registerID=null}))},e.unsubscribeMethod=function(e,t,n){if(t=Array.isArray(t)?t:[t],!e.__EventHandlers)return;e.__EventHandlers.filter((e=>t.includes(e.eventName)&&n===e.method)).forEach((e=>{r.default.unsubscribe(e.registerID),e.registerID=null}))},e.subscribeAll=function(e,t,n){const i=n.value;return n.value=function(...t){let n=e.__EventHandlers;n&&(n.filter((e=>null===e.registerID&&e.auto)).forEach((e=>{e.registerID=r.default.subscribe({event:e.eventName},e.method.bind(this),e.priority)})),i.apply(this,t))},n},e.unsubscribeAll=function(e,t,n){const i=n.value;return n.value=function(...t){let n=e.__EventHandlers;n&&(n.filter((e=>null!==e.registerID)).forEach((e=>{r.default.unsubscribe(e.registerID),e.registerID=null})),i.apply(this,t))},n}}(n||(n={})),n}));