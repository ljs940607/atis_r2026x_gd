define("DS/ENODOTitleRules/Views/DOTitleRuleCreate",["UWA/Class/View","DS/Handlebars/Handlebars","DS/UIKIT/SuperModal","DS/ENODOTitleRules/Models/DOTitleRule","text!DS/ENODOTitleRules/assets/templates/edfm.titlecreate.form.html","DS/ENODerivedFormatEssentials/Utils/DerivedFormatUtil","DS/Controls/TooltipModel","DS/Controls/Toggle"],(function(e,t,a,n,i,r,l,d){var m;return e.extend({className:"nameRuleformview",viewMe:this,disableFields:!1,id:function(){return"nameRuleformview"},setup:function(e){var t=this;t.selection=e.selection,t.superModal=new a,t.superModal.dialog({closable:!0,body:t.getForm(),title:t.selection?derivedformatmanagementinfra.getNLSData().label.editNameRuleTitle:derivedformatmanagementinfra.getNLSData().label.createNameRuleTitle}),t.setupEvent()},setupEvent:function(){var e=this;viewMe=this,m.getDocument().getElementById("namerulefield-type").addEventListener("change",e.switchContentTypeForm.bind(null,e)),m.getDocument().getElementById("namerulefield-attr1").addEventListener("change",e.switchAttribute1Form.bind(null,e)),m.getDocument().getElementById("namerulefield-attr2").addEventListener("change",e.switchAttribute2Form.bind(null,e)),m.getDocument().getElementById("namerulefield-attr3").addEventListener("change",e.switchAttribute3Form.bind(null,e)),m.getDocument().getElementById("btnActionSubmit").addEventListener("click",e.save.bind(null,e)),m.getDocument().getElementById("btnActionCancel").addEventListener("click",e.cancel.bind(null,e)),viewMe.disableSelected(),e.selection?(m.getDocument().getElementById("namerulefield-type").disabled=!0,null!=e.selection.get("attributes")[1]&&""!=e.selection.get("attributes")[1]&&null!=e.selection.get("attributes")[1]||(m.getDocument().getElementById("namerulefield-attr3").disabled=!0)):m.getDocument().getElementById("namerulefield-attr3").disabled=!0},populateData:function(e,t){for(var a in e.innerText=null,t){var n=new Option(t[a].label,t[a].value);n.setAttribute("dbName",t[a].dbName),t[a].selected&&(n.selected=!0),e.add(n)}},refresh:function(){},getForm:function(){var e,a,n,r,l,d,s=this;m=UWA.createElement("div",{id:"divCreateTFormContainer"}),s.selection&&(e=s.selection.get("type"),n=(a=s.selection.get("attributes"))[0],r=a[1],l=a[2],d=s.selection.get("separator"));var o=t.compile(i),u=(s=this,derivedformatmanagementinfra.getNLSData().label),c=`\${${u.attr1}}_\${${u.attr2}}_\${${u.attr3}}`,f=s.getContentTypes();e||(e=f.find((e=>e.selected)).value);var g=s.getAttributesList(e,"namerulefield-attr1");null!=n&&null!=n||(n=g.find((e=>e.selected)).value);var b=s.getAttributesList(e,"namerulefield-attr2");null!=r&&null!=r||(r=b.find((e=>e.selected)).value);var p=s.getAttributesList(e,"namerulefield-attr3");null!=l&&null!=l||(l=p.find((e=>e.selected)).value);var v=s.getSeparators();return d||(d=v.find((e=>e.selected)).value),m.setHTML(o({labels:derivedformatmanagementinfra.getNLSData().label,buttons:derivedformatmanagementinfra.getNLSData().button,formula:c,type:f,attribute1:g,attribute2:b,attribute3:p,separator:v})),m},cancel:function(e){e.superModal.modals.current.hide()},switchContentTypeForm:function(e){var t=m.getDocument().getElementById("namerulefield-type").selectedOptions[0].value,a=m.getDocument().getElementById("namerulefield-attr1"),n=viewMe.getAttributesList(t,"namerulefield-attr1",true);viewMe.populateData(a,n),viewMe.switchAttribute1Form(e,true)},switchAttribute1Form:function(e,t){var a=m.getDocument().getElementById("namerulefield-type").selectedOptions[0].value,n=m.getDocument().getElementById("namerulefield-attr2"),i=viewMe.getAttributesList(a,"namerulefield-attr2",t);viewMe.populateData(n,i),viewMe.disableSelected(),viewMe.switchAttribute2Form(e,t)},switchAttribute2Form:function(e,t){var a=m.getDocument().getElementById("namerulefield-type").selectedOptions[0].value,n=m.getDocument().getElementById("namerulefield-attr3");""==m.getDocument().getElementById("namerulefield-attr2").selectedOptions[0].getAttribute("dbName")?n.disabled=!0:n.disabled=!1;var i=viewMe.getAttributesList(a,"namerulefield-attr3",t);viewMe.populateData(n,i),viewMe.disableSelected(),viewMe.switchAttribute3Form(e)},switchAttribute3Form:function(e){viewMe.disableSelected()},disableSelected:function(){var e=this;if(e.resetFormFields(),e.collection){var t=m.getDocument().getElementById("namerulefield-type"),a=e.collection._models;for(var n in a)if(attrType=a[n]._attributes.type,attrType)for(var i=0;i<t.options.length;i++)attrType===t.options[i].value&&(t.options[i].disabled=!0)}var r={attrField1:m.getDocument().getElementById("namerulefield-attr1"),attrField2:m.getDocument().getElementById("namerulefield-attr2"),attrField3:m.getDocument().getElementById("namerulefield-attr3")};Object.keys(r).forEach((function(e){var t=r[e],a=(t.options,t.value);Object.keys(r).forEach((function(t){if(e!==t&&""!==a&&"No Attribute"!==a)for(var n=r[t].options,i=0;i<n.length;i++)a===n[i].value&&(n[i].disabled=!0)}))}))},resetFormFields:function(){for(var e=m.getDocument().getElementById("namerulefield-type"),t={"namerulefield-attr1":m.getDocument().getElementById("namerulefield-attr1"),"namerulefield-attr2":m.getDocument().getElementById("namerulefield-attr2"),"namerulefield-attr3":m.getDocument().getElementById("namerulefield-attr3")},a=0;a<e.options.length;a++)e.options[a].disabled=!1;Object.keys(t).forEach((function(e){for(var a=t[e].options,n=0;n<a.length;n++)a[n].disabled=!1}))},save:function(e){var t,a=e.getData(),i={};e.selection?((i=e.selection).set(a),t=i._previousAttributes):i=new n(a),i.get("deployed")&&!i.hasChanged()||(i.get("deployed")&&i.hasChanged()||"updated"==i.get("action")?i.set("action","updated"):i.set("action","created"));var l=e.isDuplicateRule(e,i);l&&i.isNew()?(i.set(t),e.superModal.modals.current.hide(),r.alert().add({className:"warning",message:derivedformatmanagementinfra.getNLSData().label.titleRuleExists})):!l&&a&&i.isValid()?(e.collection.add(i),e.superModal.modals.current.hide()):i.isNew()||(i.set(t),e.cancel(e),r.alert().add({className:"warning",message:derivedformatmanagementinfra.getNLSData().label.titleRuleExists}))},isDuplicateRule:function(e,t){var a=e.collection._models;for(var n in refModelAttr=t._attributes,a)if(modelAttr=a[n]._attributes,t.cid!=a[n].cid&&refModelAttr.type===modelAttr.type)return console.log(),!0;return!1},getData:function(){var e=m.getDocument().getElementById("namerulefield-attr1").selectedOptions[0].getAttribute("dbName"),t=m.getDocument().getElementById("namerulefield-attr2").selectedOptions[0].getAttribute("dbName"),a=m.getDocument().getElementById("namerulefield-attr3").selectedOptions[0].getAttribute("dbName"),n={};return n.type=m.getDocument().getElementById("namerulefield-type").value,n.attributes=[e,t,a],n.separator=m.getDocument().getElementById("namerulefield-separator").value,n},getContentTypes:function(){var e=new Array,t="Document";return this.selection&&(t=this.selection.get("type")),[{displayName:derivedformatmanagementinfra.getNLSData().label.typeDocument,name:"Document"},{displayName:derivedformatmanagementinfra.getNLSData().label.typeDrawing,name:"Drawing"},{displayName:derivedformatmanagementinfra.getNLSData().label.typePart,name:"Part"}].forEach((function(a,n){e.push({label:a.displayName,value:a.name,selected:a.name==t})})),e},getAttributesList:function(e,t,a){var n,i=this,r=new Array;"namerulefield-attr1"==t?n="current":"namerulefield-attr2"!=t&&"namerulefield-attr3"!=t||(n="");var l={current:derivedformatmanagementinfra.getNLSData().label.attrMaturity,revision:derivedformatmanagementinfra.getNLSData().label.attrRevision,name:derivedformatmanagementinfra.getNLSData().label.attrName,"attribute[PLMEntity.V_Name]":derivedformatmanagementinfra.getNLSData().label.attrTitle,"relationship[VPMRepInstance].from.attribute[EnterpriseExtension.V_PartNumber]":derivedformatmanagementinfra.getNLSData().label.attrEIN,"attribute[PLMEntity.V_description]":derivedformatmanagementinfra.getNLSData().label.attrDescription,"":derivedformatmanagementinfra.getNLSData().label.noAttribute};if(i.selection){for(var d=[],s=i.selection.get("attributes"),o=0;o<s.length;o++){var u=l[s[o]];d.push(u)}"namerulefield-attr1"===t?n=s[0]:"namerulefield-attr2"===t?n=s[1]:"namerulefield-attr3"===t&&(n=s[2])}d=[{displayName:derivedformatmanagementinfra.getNLSData().label.attrMaturity,name:"Maturity",dbName:"current"},{displayName:derivedformatmanagementinfra.getNLSData().label.attrName,name:"Name",dbName:"name"},{displayName:derivedformatmanagementinfra.getNLSData().label.attrRevision,name:"Revision",dbName:"revision"},{displayName:derivedformatmanagementinfra.getNLSData().label.attrTitle,name:"Title",dbName:"attribute[PLMEntity.V_Name]"},{displayName:derivedformatmanagementinfra.getNLSData().label.attrDescription,name:"Description",dbName:"attribute[PLMEntity.V_description]"}];if("Part"==e){var c={displayName:derivedformatmanagementinfra.getNLSData().label.attrEIN,name:"Enterprise Item Number",dbName:"relationship[VPMRepInstance].from.attribute[EnterpriseExtension.V_PartNumber]"};d.splice(0,0,c),i.selection||(n="relationship[VPMRepInstance].from.attribute[EnterpriseExtension.V_PartNumber]")}if("namerulefield-attr1"!==t){field2=m.getDocument().getElementById("namerulefield-attr2"),field3=m.getDocument().getElementById("namerulefield-attr3");var f={displayName:derivedformatmanagementinfra.getNLSData().label.noAttribute,name:"No Attribute",dbName:""};d.splice(d.length,0,f),field2&&"namerulefield-attr2"==t&&field2.selectedOptions&&field2.selectedOptions[0]?n=field2.selectedOptions[0].getAttribute("dbName"):field3&&"namerulefield-attr3"==t&&field3.selectedOptions&&field3.selectedOptions[0]&&(n=field3.selectedOptions[0].getAttribute("dbName")),field3&&field3.disabled&&(n="")}return 1==a&&t&&(n="Part"==e?"namerulefield-attr1"==t?"relationship[VPMRepInstance].from.attribute[EnterpriseExtension.V_PartNumber]":"":"namerulefield-attr1"==t?"current":"",m.getDocument().getElementById("namerulefield-separator").options[2].selected=!0),d.forEach((function(e,t){r.push({label:e.displayName,value:e.name,dbName:e.dbName,selected:e.dbName==n})})),r},getSeparators:function(){var e=new Array,t="_";return this.selection&&(t=this.selection.get("separator")),[{displayName:"+",name:"+"},{displayName:"-",name:"-"},{displayName:"_",name:"_"},{displayName:derivedformatmanagementinfra.getNLSData().label.noSeparator,name:""}].forEach((function(a,n){e.push({label:a.displayName,value:a.name,selected:a.name==t})})),e}})}));