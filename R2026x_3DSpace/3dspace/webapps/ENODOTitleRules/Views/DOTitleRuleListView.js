define("DS/ENODOTitleRules/Views/DOTitleRuleListView",["UWA/Class/View","DS/Utilities/Dom","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/TreeModel/DataModelSet","DS/DataGridView/DataGridView","DS/ENODOTitleRules/Views/DOTitleTbar","DS/ENODOTitleRules/Views/DOTitleRuleCreate","DS/UIKIT/Input/Button","DS/ENODerivedFormatEssentials/Utils/DerivedFormatUtil","css!DS/ENODOTitleRules/ENODOTitleRuleView"],(function(e,t,a,n,i,r,o,l,d,s){var c,u,m,g;return e.extend({tagName:"div",className:"edfm-namerule-listview",tapedTwice:!1,setup:function(e){var t=this;derivedformatmanagementinfra.servererror||(t.setupTbar(),t.setupListView(),t.setupApplyResetToolbar(),widget.addEvent("onResize",t.adjust)),this.listenTo(t.collection,"onAdd",t.doTitleRuleCreatePostProcess.bind(null,t)),this.listenTo(t.collection,"onChange",t.doTitleRuleEditPostProcess.bind(null,t)),this.listenTo(t.collection,"onRemove",t.doTitleRuleDeletePostProcess.bind(null,t))},render:function(e){return e&&e.container&&this.container.inject(e.container),this},setupApplyResetToolbar:function(){var e,t,a,n,i,r=this;return e=UWA.createElement("div",{class:"nametab-list-applyResetDiv",styles:{bottom:"0",right:"0",position:"fixed"}}).inject(r.container),t=UWA.createElement("table",{class:"",id:"",width:"100%"}).inject(e),a=UWA.createElement("tr").inject(t),n=UWA.createElement("td",{width:"45%",Align:"left"}).inject(a),new d({className:"primary",id:"buttonExportNameTab",icon:"export",attributes:{disabled:!1,title:derivedformatmanagementinfra.getNLSData().button.applyTitle,text:derivedformatmanagementinfra.getNLSData().button.apply},events:{onClick:function(){r.applyRules(r)}}}).inject(n).getContent().setStyle("width",130),i=UWA.createElement("td",{width:"45%",Align:"right"}).inject(a),new d({className:"warning",icon:"loop",attributes:{disabled:!1,title:derivedformatmanagementinfra.getNLSData().button.resetTitle,text:derivedformatmanagementinfra.getNLSData().button.reset},events:{onClick:function(){r.resetButton(r)}}}).inject(i).getContent().setStyle("width",130),e},applyRules:function(e){e.collection.length&&e.collection.applyRules()},resetButton:function(e){var t=g.getChildren(),a=new Array;if(t){for(idx=0;idx<t.length;idx++)node=t[idx].options.grid,a.push(node);e.collection.remove(a)}e.collection.fetch()},setupTbar:function(){var e=this;new o({actions:[{icon:"plus",label:derivedformatmanagementinfra.getNLSData().button.addRule,hasAccess:!0,handler:e.createDOTitleRule.bind(null,e)},{icon:"trash",label:derivedformatmanagementinfra.getNLSData().button.deleteRule,hasAccess:!0,handler:e.deleteDOTitleRule.bind(null,e)}]}).render({container:e.container})},createDOTitleRule:function(e){new l({collection:e.collection,event:e.event}).render({container:m})},deleteDOTitleRule:function(e){var t=g.getSelectedNodes(),a=new Array,n=new Array,i=!1;if(t)for(var r=t.length,o=0;o<r;o++){var l=t[o],d=e.collection.get(l.options.grid);"deleted"!=d.get("action")&&(d.id?(i=!0,n.push(d)):a.push(d))}i?s.confimationModal((function(t){e.collection.setToBeDeleted(n),e.collection.remove(a),t.hide()}),"delete"):e.collection.remove(a)},setupListView:function(){var e=this;u=new i,g=new a({dataModelSet:u}),_doTitleListViewDiv=UWA.createElement("div",{class:"dfm-nameruleslist-view",styles:{}}).inject(e.container),(c=new r({scrollable:!0,treeDocument:g,cellSelection:"none",height:widget.body.clientHeight-130,rowSelection:"multiple",columns:[{text:derivedformatmanagementinfra.getNLSData().label.contentType,dataIndex:"type",width:"30%"},{text:derivedformatmanagementinfra.getNLSData().label.titleRule,dataIndex:"doTitle",width:"40%"},{text:derivedformatmanagementinfra.getNLSData().label.deployStatus,dataIndex:"status",width:"20%",typeRepresentation:"icon"}],defaultColumnDef:{width:"auto",typeRepresentation:"string",editableFlag:!1,resizableFlag:!0,sortableFlag:!0}}).inject(_doTitleListViewDiv)).getContent().addClassName("dotitle-datagridview"),t.addEventOnElement(c,c,"click",(function(t,a){if(!e.tapedTwice)return e.tapedTwice=!0,setTimeout((function(){e.tapedTwice=!1}),600),!1;var n=a.nodeModel.options.grid,i=e.collection.get(n);"deleted"!=i.get("action")&&new l({event:e.event,collection:e.collection,container:m,selection:i}).render()})),e.customizeLayout()},customizeLayout:function(){c.layout.columnHeaderHeight=40,c.layout.cellHeight=35,c.layout.collectionView.showRowBorderFlag=!0},getDeployStatusIcon:function(e){var t,a=this,n=e.get("action");switch(n){case"deployed":t=a.buildImgSpan("check","green",n);break;case"notdeployed":t=a.buildImgSpan("cog","orange",n);break;case"created":t=a.buildImgSpan("cog","black",n);break;case"updated":t=a.buildImgSpan("pencil","orange",n);break;case"deleted":t=a.buildImgSpan("trash","red",n)}return t},buildImgSpan:function(e,t,a){return"fonticon fonticon-1x fonticon-"+e+" dfm-action-icon-"+t},doTitleRuleCreatePostProcess:function(e,t){var a={current:derivedformatmanagementinfra.getNLSData().label.attrMaturity,revision:derivedformatmanagementinfra.getNLSData().label.attrRevision,name:derivedformatmanagementinfra.getNLSData().label.attrName,"attribute[PLMEntity.V_Name]":derivedformatmanagementinfra.getNLSData().label.attrTitle,"relationship[VPMRepInstance].from.attribute[EnterpriseExtension.V_PartNumber]":derivedformatmanagementinfra.getNLSData().label.attrEIN,"attribute[PLMEntity.V_description]":derivedformatmanagementinfra.getNLSData().label.attrDescription,"":derivedformatmanagementinfra.getNLSData().label.noAttribute},i={Document:derivedformatmanagementinfra.getNLSData().label.typeDocument,Drawing:derivedformatmanagementinfra.getNLSData().label.typeDrawing,Part:derivedformatmanagementinfra.getNLSData().label.typePart},r=t.get("attributes");if(r){for(var o=[],l=0;l<r.length;l++){var d=a[r[l]];o.push(d)}g.prepareUpdate();var s=i[t.get("type")],c=t.get("separator"),m="";if(o){for(l=0;l<o.length;l++)""!==o[l]&&o[l]!==derivedformatmanagementinfra.getNLSData().label.noAttribute&&(m+=`\${${o[l]}}${c}`);m.endsWith(c)&&""!=c&&(m=m.slice(0,-c.length))}var f=e.getDeployStatusIcon(t),p={id:t.id,cid:t.cid,type:s,attributes1:o?[o[0]]:"",attributes2:o?[o[1]]:"",attributes3:o?[o[2]]:"",separator:c,doTitle:m,status:f},b=n.createTreeNodeDataModel(u,{label:p.text,grid:p});g.addChild(b),g.pushUpdate(),e.updateIconSpan()}},doTitleRuleEditPostProcess:function(e,t){var a={current:derivedformatmanagementinfra.getNLSData().label.attrMaturity,revision:derivedformatmanagementinfra.getNLSData().label.attrRevision,name:derivedformatmanagementinfra.getNLSData().label.attrName,"attribute[PLMEntity.V_Name]":derivedformatmanagementinfra.getNLSData().label.attrTitle,"relationship[VPMRepInstance].from.attribute[EnterpriseExtension.V_PartNumber]":derivedformatmanagementinfra.getNLSData().label.attrEIN,"attribute[PLMEntity.V_description]":derivedformatmanagementinfra.getNLSData().label.attrDescription,"":derivedformatmanagementinfra.getNLSData().label.noAttribute};g.prepareUpdate();for(var n=g.getChildren(),i=n.length,r=0;r<i;r++){var o=n[r];if(o.options.grid.cid==t.cid){for(var l=t.get("separator"),d=t.get("attributes"),s=[],c=0;c<d.length;c++){var u=a[d[c]];s.push(u)}var m="";if(s){for(c=0;c<s.length;c++)""!==s[c]&&s[c]!==derivedformatmanagementinfra.getNLSData().label.noAttribute&&(m+=`\${${s[c]}}${l}`);m.endsWith(l)&&""!=l&&(m=m.slice(0,-l.length))}var f=e.getDeployStatusIcon(t);o.updateOptions({grid:{status:f,attribute1:s[0]?s[0]:"",attribute2:s[1]?s[1]:"",attribute3:s[2]?s[2]:"",doTitle:m,separator:l}});break}}g.pushUpdate()},doTitleRuleDeletePostProcess:function(e,t){g.prepareUpdate();for(var a=g.getChildren(),n=a.length,i=0;i<n;i++){var r=a[i],o=r.options.grid.id,l=r.options.grid.cid;if(o&&o==t.id){r.remove();break}if(l&&l==t.cid){r.remove();break}}g.pushUpdate(),e.updateIconSpan()},updateIconSpan:function(){var e=document.getElementById("title-tbar-icon-plus");e&&(3==g.getChildren().length?(e.setAttribute("disabled",!0),e.style.pointerEvents="none",e.style.opacity="0.5",e.style.cursor="default"):(e.removeAttribute("disabled"),e.style.pointerEvents="",e.style.opacity="",e.style.cursor="pointer"))},adjust:function(){c.height=document.getElementsByClassName("facetviews")[1].clientHeight-90}})}));