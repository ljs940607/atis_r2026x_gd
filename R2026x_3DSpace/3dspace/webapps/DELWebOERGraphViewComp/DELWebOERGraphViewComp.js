define("DS/DELWebOERGraphViewComp/actions/StandardActions",["DS/Logger/Logger"],(function(e){"use strict";const t=e.getLogger("DS/DELWebOERGraphViewComp/actions/StandardActions");let i={};function r(e={}){if(!e.executionContext)throw new Error("Invalid Input, execution context is not available");return e.executionContext.getComponent("DELGraphViewer")}return i.activateGraphView=async function(e,i={}){try{const e=r(i);await e.activateGraphView(i.args)}catch(e){t.error(e)}finally{e()}},i.deactivateGraphView=async function(e,i={}){try{const e=r(i);await e.deactivateGraphView(i.args)}catch(e){t.error(e)}finally{e()}},i})),define("DS/DELWebOERGraphViewComp/mixins/GraphNodeMixin",["DS/Visualization/ThreeJS_DS","DS/Visualization/SceneGraphFactory"],(function(e,t){"use strict";return{createNode:async function(i={}){let r,n,a,o=i.image,s=this.getCanvasProperties()||{},c=i.nodeProperties||{},h=s.width,d=s.height,l=o.getAttribute("width"),p=o.getAttribute("height"),g=this.getViewpoint(),w=g.unProject(new e.Vector3(0,0,0)),u=g.unProject(new e.Vector3(h,d,0)),f=g.unProject(new e.Vector3(0,d,0)),m=Math.abs(u.x-w.x),V=Math.abs(u.y-w.y),b=function(t){return new e.Vector2(t.x,-t.y)},v=function(t){return new e.Vector3(t.x,-t.y,0)};if(i.clean){this.getRootBag().removeChildren()}r=function(t){let i,r,n,a=b(w),o=b(new e.Vector2(0,0));return i=document.createElement("canvas"),i.width=h,i.height=d,r=i.getContext("2d"),r.drawImage(t,a.x-o.x,a.y-o.y,m,V,0,0,h,d),n=new e.Texture(i),n.needsUpdate=!0,n}(o),n=function(t){return new e.MeshBasicMaterial({force:!0,transparent:!0,map:t})}(r),a=t.createRectangleNode({width:m,height:V,cornerPoint:f,fill:!0,noEdge:!0,material:n});let E=v(new e.Vector3(0,0,0)),y=v(new e.Vector3(l,0,0)),D=v(new e.Vector3(l,p,0)),S=v(new e.Vector3(0,p,0)),C=new e.Box3;return C.setFromPoints([E,y,S,D]),a.forceBoundingBox(C),c&&(a.setPickable(c.pickable),a.setModelIdentification(c.id),a.setUserData({type:c.type})),this.addNodeToViewer(a),i.reframe&&g.reframe(),i.render&&this.getWebglViewer().render(),a},getNode:function(e={}){let t,i=e.path||[],r=this.getRootBag(),n=i[i.length-1];return n&&(t=r.getChildren().find((e=>e.getModelIdentification()===n))),t},removeNode:function(e){this.getRootBag().removeChild(e)},getEnopadViewer:function(){return this.getComponentFromIdentifier(this.enopadViewerIdentifier)},getWebglViewer:function(){return this.getEnopadViewer().getViewer()},getRootBag:function(){return this.getEnopadViewer().getController().getRootBag()},addNodeToViewer:function(e){this.getRootBag().addChild(e)},getViewpoint:function(){return this.getWebglViewer().currentViewpoint},getCanvasProperties:function(){let e=this.getWebglViewer();return{width:e.canvas.offsetWidth,height:e.canvas.offsetHeight}}}})),define("DS/DELWebOERGraphViewComp/mixins/SvgHelperMixin",[],(function(){"use strict";const e=["iframe.css","wux.css","Menu.css","wux-3ds-fonticons.css","wuxautocompleteloader.css","UIKIT.css","W3DXComponents.css","Ruler.css","PinView.css","egraph","GraphListView","etree","DELWebOERGraphViewComp","DELPPWProductFlowFacet","WidgetServicesUI","DELPPWViewPlugins"];return{createSvg:async function(e){if(!e)throw new Error("No container found to create svg from");let{width:t,height:i}=this.getCanvasProperties(),r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttribute("xmlns","http://www.w3.org/2000/svg"),r.setAttribute("width",t),r.setAttribute("height",i);let n=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");return n.setAttribute("width","100%"),n.setAttribute("height","100%"),n.setAttribute("externalResourcesRequired","true"),n.appendChild(e),await this.addStyles(r),r.appendChild(n),await this.fetchAndUpdateImages(r),r},addStyles:async function(t){let i=[],r=this,n="";if(t){for(const t of document.styleSheets){let a=t.href;if(a&&e.some((e=>a.includes(e))))try{for(const e of t.cssRules)n+=e.cssText+"\n"}catch(e){r.logger.log(e),r.logger.log("Access to stylesheet %s is denied. fetch from the url",a),i.push(a)}}if(i.length>0)try{let e=i.map((async e=>{let t=new URL(e);t.searchParams.set("NoCache_forGraphView",!0);let i=await fetch(`${t.toString()}`,{headers:{"Content-Type":"text/css",Accept:"text/css,*/*;q=0.1"}});return await i.text()}));(await Promise.allSettled(e)).forEach((e=>{if("fulfilled"===e.status){let t=e.value;n+=t+"\n"}else r.logger.error("Unable to fetch the css style sheets ",e)}))}catch(e){r.logger.log(e),r.logger.error("Error occurred while fetching style sheets ",e.message)}!function(e){if(e){let i=document.createElementNS("http://www.w3.org/2000/svg","style");i.appendChild(document.createTextNode(e)),t.appendChild(i)}}(n)}},fetchAndUpdateImages:async function(e){if(e){let t=e.querySelectorAll("img");t.length&&await new Promise((e=>{let i=0;const r=n=>{if(n instanceof ErrorEvent&&window.console.error("Some images on element: were not correctly loaded"),i++,i===t.length){for(let e=0;e<t.length;e++){const i=t[e];i.removeEventListener("load",r),i.removeEventListener("error",r)}e()}};for(let e=0;e<t.length;e++){const i=t[e];i.src&&i.src.startsWith("http")?fetch(i.src).then((e=>e.blob())).then((e=>{const t=new FileReader;t.onload=function(e){i.addEventListener("load",r),i.addEventListener("error",r),i.src=e.target&&e.target.result},t.onerror=r,t.readAsDataURL(e)})).catch(r):i.complete?r():(i.addEventListener("load",r),i.addEventListener("error",r))}}))}},createImage:async function(e){let t=(new XMLSerializer).serializeToString(e),i=new Image;return i.setAttribute("width",e.getAttribute("width")),i.setAttribute("height",e.getAttribute("height")),i.src=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(t)}`,await i.decode(),i}}})),define("DS/DELWebOERGraphViewComp/GraphViewComp",["UWA/Core","DS/PlatformAPI/PlatformAPI","DS/Mesh/MeshUtils","DS/CoreEvents/Events","DS/egraph/utils","DS/DELPPWProductFlowFacet/facets/ProductFlowSequenceFacet","DS/DELWebOERCommonUtils/DELWebBaseComponent","DS/DELWebOERCommonUtils/mixins/RootActionHandlerExtMixin","DS/DELWebOERGraphViewComp/mixins/GraphNodeMixin","DS/DELWebOERGraphViewComp/mixins/SvgHelperMixin","css!DS/DELWebOERGraphViewComp/assets/css/GraphViewStyles.css"],(function(e,t,i,r,n,a,o,s,c,h){"use strict";const d=n.reframeViewpoint;class l extends o{constructor(e){if(super(e),!e.enopadViewerIdentifier)throw new Error("invalid input, property enopadViewerIdentifier is mandatory to create graph view component ");this.enopadViewerIdentifier=e.enopadViewerIdentifier,this.graphs=[]}async initialize(){await super.initialize({eventHandlers:[{eventName:{event:"onModelChange:roots"},callback:this.onRootsChange}]}),this.wuxToken=r.subscribe({event:"/VISU/"},async function(e){try{if("@onViewpointEndMove"===e.eventType){let e=this.getGraphs();e&&e.forEach(async function(e){await this.createNode({image:e.image,nodeProperties:{...e,pickable:i.PICKTHROUGH,id:e.path.at(-1)},reframe:!1,render:!0,clean:!0})}.bind(this))}}catch(e){this.logger.error(e)}}.bind(this))}async activateGraphView(t={}){let r,a,o,s=this,c={...t};try{if(t){this.publish({event:"DS/DELGraphViewer/onActivateGraphViewStart",data:t}),await this.empty({intent:"addRoots",from:t.from}),n.reframeViewpoint=function(e,t,i){let r=e;if(r&&r.length>1&&0===r[0]&&0===r[1]){let{width:e,height:t}=s.getCanvasProperties()||{};i&&i.padding&&(e-=i.padding),r=[e,t]}return d.call(this,r,t,i)};this.getWebglViewer(t).set2DMode(!0,"DELMIA"),r=await this.getGraphContent(t),a=await this.createSvg(r),o=await this.createImage(a),c.image=o,await this.createNode({image:o,nodeProperties:{...t,pickable:i.PICKTHROUGH,id:t.path.at(-1)},reframe:!e.is(t.reframe,"boolean")||t.reframe,render:!0}),this.graphs.push(c),this.publish({event:"DS/DELGraphViewer/onActivateGraphViewCompleted",data:t})}}catch(e){throw this.logger.error(e),this.publish({event:"DS/DELGraphViewer/onActivateGraphViewFailed",data:{...t,reason:e}}),e}}async deactivateGraphView(t={}){const i=this.getWebglViewer(t);let r=this.getNode(t);try{r&&(this.publish({event:"DS/DELGraphViewer/onDeactivateGraphViewStart",data:t}),this.removeNode(r),this.graphs=this.graphs.filter((i=>!e.Array.equals(t.path,i.path))),this.publish({event:"DS/DELGraphViewer/onDeactivateGraphViewCompleted",data:t}),i.set2DMode(!1,"DELMIA"),n.reframeViewpoint=d)}catch(e){throw this.logger.error(e),this.publish({event:"DS/DELGraphViewer/onDeactivateGraphViewFailed",data:{...t,reason:e}}),e}}async empty(e={}){await Promise.all(this.graphs.map(function(t){return this.deactivateGraphView({...t,...e})}.bind(this)))}async getGraphContent(i={}){let r,n=i.path||[];if(n){r=e.createElement("DIV",{class:"pert-view-container"});let i=new a({});i.inject(r),i.updateFacet({objectId:n.at(-1)}),await new Promise((e=>{let i=t.subscribe("ProductFlowSequenceCreated",(function(){t.unsubscribe(i),e()}))}))}return r}getGraphs(){return this.graphs}async addRoots(){}async removeRoots(){}getRoots(){return[]}async clean(){await super.clean(),r.unsubscribe(this.wuxToken)}async destroy(){this.empty(),await super.destroy()}getExposedComponent(){return this.publicAPI=super.getExposedComponent(),this.publicAPI.activateGraphView=this.activateGraphView.bind(this),this.publicAPI.deactivateGraphView=this.deactivateGraphView.bind(this),this.publicAPI.getGraphs=this.getGraphs.bind(this),this.publicAPI.empty=this.empty.bind(this),this.publicAPI}}return l.prototype.mixinProperties(l,s),l.prototype.mixinProperties(l,c),l.prototype.mixinProperties(l,h),l}));