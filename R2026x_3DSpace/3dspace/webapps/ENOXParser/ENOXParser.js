/*!  COPYRIGHT DASSAULT SYSTEMES 2021   */
define("DS/ENOXParser/modules/common/OfwBuilder",[],(function(){function e(e){e.children||(e.children=[])}function t(e){this.options=e,this._referenceMap=new Map}return t.prototype={addReference:function(e){this._referenceMap.set(e.resourceid,e)},addInstance:function(t){t.isInstance=!0;var n=this._referenceMap.get(t.from);e(n),n.children.push(t);var i=this._referenceMap.get(t.resourceid);e(t),t.children.push(i)},getReference:function(e){return this._referenceMap.get(e)},correct:function(){}},t})),define("DS/ENOXParser/modules/Numbers",[],(function(){const e=[1,0,0,0,1,0,0,0,1,0,0,0],t=6;function n(e,t){let n=parseFloat(e);if(void 0!==t){let e=n.toFixed(t);n=parseFloat(e)}return n}return{int:parseInt,float:n,checkNotIdentity:function(i){let r=function(e){let i=[];for(let r=0;r<e.length;r++){let s=e[r];i.push(n(s,t))}return i}(i.split(",")),s=!1;for(let t=0;t<r.length&&!s;t++)r[t]!==e[t]&&(s=!0);return s}}})),define("DS/ENOXParser/modules/common/Constants",[],(function(){return{NODE_STATES:{COLLAPSED:{state:"collapsed"},EXPANDED:{state:"expanded"},NOCHILDREN:{state:"noChildren"},EXPANDING:{state:"expanding"},PARTIALLY_EXPANDED:{state:"partiallyExpanded"}},GLOBALTYPE_DOC:"ds6w:Document",MATRIX_IDENTITY:[1,0,0,0,1,0,0,0,1,0,0,0]}})),define("DS/ENOXParser/modules/mixins/parser/OfwOcc",[],(function(){"use strict";function e(e,t){e.children||(e.children=[]),e.children.push(t)}function t(e,t){return window.structuredClone(e.get(t))}function n(e,t){return!e.children||!e.children.includes(t)}function i(i,r,s){let o=r.length,a=r[0],d=i.get(a);d||(d=t(s,a),i.set(a,d));let l=d;for(let a=1;a<o;a++){let o=r[a],d=r.slice(0,a+1).join("/"),c=a%2==1,p=i.get(d),u=!0;p?u=!1:p=t(s,o),c&&(p.isInstance=!0),u&&i.set(d,p),n(l,p)&&e(l,p),l=p}}function r(){}return r.prototype={parseOfw:function(e){let t=this;return new Promise(((n,r)=>{let s=t.__parseResp(e.wsResponse,!1,void 0),o=s.mapNodes,a=s.paths,d=(s.pathsToSelect,new Map);for(let e=0;e<a.length;e++){i(d,a[e],o)}let l=[];for(let t=0;t<e.rootIds.length;t++){let n=d.get(e.rootIds[t]);l.push(n)}n(l)}))}},r})),define("DS/ENOXParser/modules/GenericMePrefParser",[],(function(){"use strict";function e(e){let t=new Map;for(let n=0;n<e.length;n++){let i,r=e[n];switch(r.datatype){case"boolean":i="true"===r.value;break;case"json":i={};try{i=JSON.parse(r.value)}catch(e){console.log("pref JSON did not parse",e,r)}break;case"enum":i=r.value}t.set(r.name,{type:r.datatype,value:i})}return t}function t(e){this.options=e,this._data=new Map,this._parse()}return t.prototype={_parse:function(){for(let t=0;t<this.options.repositories.length;t++){let n=this.options.repositories[t];this._data.set(n.name,e(n.preferences))}},hasRepo:function(e){return this._data.has(e)},getSetting:function(e,t){let n=this._data.get(e);return n?n.get(t):null}},t})),define("DS/ENOXParser/modules/mixins/parser/MergeObj",["DS/PADServices/utils/Iterator"],(function(e){const t=["grid","icons"];function n(t,r){let s={},o=0,a=0;var d=[],l=[];return Array.isArray(r)?i(t,r):(e.iterateObj(r,(function(e,t){var n;o++,Array.isArray(e)?d.push(t):null!=(n=e)&&!0!==n&&!1!==n&&!n.toPrecision&&n&&n.isPrototypeOf&&n.hasOwnProperty&&!n.trim?l.push(t):a++})),a===o?s=Object.assign({},r):(s=Object.assign({},r),e.iterate(d,(function(e){s[e]=i(t,r[e])})),e.iterate(l,(function(e){s[e]=n(t,r[e])}))),s)}function i(t,i){var r=[];return e.iterate(i,(function(e){r.push(n(t,e))})),r}function r(){}return r.prototype={smartAssign:function(n,i){var r=Object.assign({},n,i);return e.iterate(t,(function(e){i[e]&&(r[e]=Object.assign({},n[e],i[e]))})),r},assignClone:function(e){return n(this,e)}},r})),define("DS/ENOXParser/modules/ClientDataParser",[],(function(){const e=/(\{|\}|\,|\\|"|\w+|\.|:|\[|\])/g,t="#FSMP#";function n(e){this._data=e,this.final=[],this.pids=[],this._parse(),this._extractPids()}return n.prototype={_parse:function(){for(let n=0;n<this._data.length;n++){let i=this._data[n],r=i.indexOf(t),s=i;if(-1!==r&&(s=s.substring(r+6)),e.test(s))try{let e=JSON.parse(s);this.final.push(e)}catch(e){console.error("Not JSON",e,s)}}},_extractPids:function(){for(let e=0;e<this.final.length;e++){let t=this.final[e].data.filter((function(e){return"bo"===e.kind})).map((function(e){return e.pid}));this.pids=this.pids.concat(t)}},appendPids:function(e){for(let t=0;t<this.pids.length;t++){let n=this.pids[t];e.includes(n)||e.push(n)}},appendPaths:function(e){let t=this.pids.map((function(e){return[e]}));for(let n=0;n<t.length;n++){let i=t[n];e.includes(i)||e.push(i)}}},n})),define("DS/ENOXParser/modules/ColorMapParser",["DS/PADServices/utils/Iterator"],(function(e){function t(t){this.data={predicateKind:"",colorMap:{map:{},predicate:void 0}};let n=this;this.data.predicateKind=t.tagColors&&t.tagColors.length?t.tagColors[0].type:null,e.iterate(t.tagColors,(function(e){if(void 0===n.data.colorMap.predicate){var t=e.predicate.split("/"),i=t[t.length-1];n.data.colorMap.predicate=i}var r=e.object;Array.isArray(r)&&(r=r.join("/"),this.predicateKind="arrayPredicates"),n.data.colorMap.map[r]=e.color,n.data.colorMap.map[e.dispValue]=e.color}))}return t.prototype={interpret:function(e){}},t})),define("DS/ENOXParser/modules/common/Timeout",[],(function(){const e={parseTimeout:!0};function t(e){this.timeout=e,this.start=Date.now()}return t.prototype={check:function(){if(void 0!==this.timeout&&Date.now()-this.start>this.timeout)throw e}},t})),define("DS/ENOXParser/modules/common/Helpers",["UWA/Core","DS/PADServices/utils/Iterator","DS/PADServices/utils/GlobalUtils"],(function(e,t,n){const i={EXPANDV2:{instances:function(e){return void 0!==e.to},references:function(e){return void 0===e.to&&void 0!==e.resourceid},pgpOutputs:function(e){return void 0!==e.pgp_output},paths:function(e){return void 0!==e.Path}},OFW:{instances:function(e){return void 0!==e.to},references:function(e){return void 0===e.to&&void 0!==e.resourceid},pgpOutputs:function(e){return void 0!==e.pgp_output}}};function r(e,t){if(e instanceof Array&&t instanceof Array){var n=e.length;if(n===t.length){for(var i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}return!1}return!1}var s={divideAndConquer:function(e,t,n){var i={},r=t.timeoutObj,s=Object.keys(n),o=s.length;for(let a=0;a<o;a++){let o=s[a],d=n[o];i[o]=e.filter(d,t),r&&r.check()}return i},node:{setFilterBadge:function(t){let n=e.clone(t.options.icons[0]);n.badges={bottomRight:{iconName:"filter",fontIconSize:"1x",className:"dgv-badge"}};let i={icons:[n]};t.updateOptions(i)},clearBadges:function(t){if(t.options&&t.options.icons){const n=e.clone(t.options.icons[0]);n.badges={bottomRight:null},t.updateOptions({icons:[n]})}},hasFilterBadges:function(e){return e.options&&e.options.icons&&e.options.icons[0].badges},clearChildComputed:function(e){let n=e.getAllDescendants();t.iterate(n,(function(e){e.isRelationsObjectGroupingNode||(delete e.options.childComputed,delete e.childComputed)}))},updateSpecificColumnViews:function(e,t,n){let i=Object.keys(t);for(let r=0;r<i.length;r++)t[i[r]].updateAttributesDelayed(e,n,this)},extractResAndRel:function(e){let t=e.getID(),n=e.getRelationID();return e.isRoot()&&(n=void 0),{resid:t,relid:n}},exactNodeByPath:function(e,t){let i=e.search({match:function(e){let i=e.nodeModel;if(n.isFakeTreeNodeModel(i))return!1;return r(i.getOccurencePath(),t)},shouldStop:function(){return!1},useTransaction:!1});return i.length?i[0]:null}},data:{jsonParse:function(e){return"string"==typeof e?JSON.parse(e):e}},array:{compare:r,unique:function(e,t){-1===e.indexOf(t)&&e.push(t)}}};return Object.defineProperties(s,{MAPS:{get:function(){return i}}}),s})),define("DS/ENOXParser/modules/BsdTree",["DS/ENOXParser/modules/common/Helpers"],(function(e){"use strict";function t(e){this.options=e,this.children=[]}function n(e){this.options=e,this._parse()}return t.prototype={addChild:function(e){let n=new t(e);return n.parent=this,this.children.push(n),n},buildLabelPath:function(){let e=[],t=this.options["ds6w:label"];e.push(t);let n=this.parent;for(;n&&"Terminology"!==n.options["ds6w:type"];){let t=n.options["ds6w:label"];e.push(t),n=n.parent}return e.reverse(),e}},n.prototype={_parse:function(){let n,i=this.options.wsResponse.results,r=e.divideAndConquer(i,{},{references:function(e){return void 0!==e.resourceid&&void 0===e.to},instances:function(e){return void 0!==e.to&&void 0!==e.from},paths:function(e){return void 0!==e.Path}});this._finalRoot={root:{},flatMap:new Map};let s=r.references.map((e=>("Terminology"===e["ds6w:type"]&&(this._finalRoot.root=new t(e),n=e.resourceid),[e.resourceid,e])));this._mapReferences=new Map(s);for(let e=0;e<r.instances.length;e++){let t=r.instances[e],i=(this._mapReferences.get(t.from),window.structuredClone(this._mapReferences.get(t.to)));i.relationid=t.resourceid;let s=this._finalRoot.flatMap.get(t.from);t.from===n&&(s=this._finalRoot.root);let o=s.addChild(i);this._finalRoot.flatMap.set(i.resourceid,o)}},getFinalRoot:function(){return this._finalRoot}},n})),define("DS/ENOXParser/modules/BsdParser",["DS/PADServices/utils/Iterator","DS/ENOXParser/modules/common/Helpers"],(function(e,t){function n(e){for(let t=0;t<e.length;t++){let n=e[t];n.revpathTitle=n.pathTitle.slice(0),n.revpathTitle.reverse()}}function i(e){this.options=e,this.dataTree={},this.hasNodeAdds=!1,this.hasNodeRemoves=!1,this._parse()}return i.prototype={_parse:function(){let e=this.options.data;e.browsingStructures.referencesID.length&&(this.residsAffected=e.browsingStructures.referencesID.slice()),e.browsingStructures.add.length&&(this.addStructures=e.browsingStructures.add.slice()),e.browsingStructures.remove.length&&(this.removeStructures=e.browsingStructures.remove.slice()),e.browsingNodes.relationsID.length?this.relidsAffected=e.browsingNodes.relationsID.slice():this.relidsAffected=[],e.browsingNodes.add.length&&(this.addNodes=e.browsingNodes.add.slice(),n(this.addNodes),this.hasNodeAdds=!0),e.browsingNodes.remove.length&&(this.removeNodes=e.browsingNodes.remove.slice(),n(this.removeNodes),this.hasNodeRemoves=!0),this._linkData()},_linkData:function(){}},i})),define("DS/ENOXParser/modules/mixins/parser/ParseAttributes",["DS/PADServices/settings/AppSettings","DS/PADServices/utils/AttributesMgtV2","DS/ENOXParser/modules/common/Constants","DS/ENOXParser/modules/Numbers","DS/PADServices/utils/Meas","DS/PADServices/utils/Iterator","DS/PADServices/utils/SGIUtils"],(function(e,t,n,i,r,s,o){"use strict";function a(e){return UWA.is(e,"string")?"true"===e.toLowerCase():UWA.is(e,"boolean")?e:void 0}function d(e,t){e.padgrid||(e.padgrid={}),e.padgrid["ds6w:globalType"]=t}function l(e,t,n){let i=e.grid[t];if(void 0!==i){let r=[i];r.push(n),e.grid[t]=r}else Array.isArray(i)?i.push(n):e.grid[t]=n}function c(){}return c.prototype={checkNotIdentity:i.checkNotIdentity,parseAttributes:function(n){var i=r.buildOrGetSection("parser.parseAttributes"),c=i.create("overall",{stats:!0}),p=t.getTreeColumn(),u=t.getColumnsOrder();let h={};if(!0===e.getSetting("activateUnits")){n.filter((e=>"uom"===e.type)).forEach((e=>{let t=e.value.split("||");h[e.name]={value:t[0],inputUnit:t[1],inputValue:t[2]}})),console.log("== UOM map"+JSON.stringify(h))}for(var f={resourceid:"",ensureNLS:!0,grid:{}},g=void 0,D=0;void 0===g&&D<n.length;D++)"ds6w:globaltype"===n[D].name.toLowerCase()&&(g=n[D].value);if(void 0===g){let e=n.find((e=>"ds6w:type"===e.name&&("ENOExpDesignExperience"===e.value||"ENOStrRefinementSpecification"===e.value)));g=e?e.value:void 0}if(void 0===g&&(g=""),"ds6w:Instance"!==g&&""!==g){let e=i.create("ref",{stats:!0});s.iterate(n,(function(e){if("type"===e.name)e.name="ds6w:type";else{var t=e.name.split("/");e.name=t[t.length-1]}switch(UWA.is(e.value)&&UWA.is(e.value.replace,"function")&&(e.value=e.value.replace(/\n/g," "),"FALSE"!==e.value.toUpperCase()&&"TRUE"!==e.value.toUpperCase()||(e.value="TRUE"===e.value.toUpperCase())),e.name.toLowerCase()){case p:f.label=e.value,f.display=f.label;break;case"ds6w:type":f.grid||(f.grid={}),f.grid[e.name]=e.value,f.type=e.value;break;case"resourceid":case"physicalid":f.resourceid=e.value;break;case"ds6w:i3dx":f.i3dx=e.value;break;case"ds6w:cpid":f.cpid=e.value,f.serviceId=o.getServiceIdFromCpid(f.cpid);break;case"isinternaljsonobj":f.isInternalJSONObj=e.value;break;case"did":f.did=e.value;break;case"type_icon_url":f.icons||(f.icons=[]),f.icons.push({iconPath:"url("+e.value+")",className:"dgv-icons"}),!1===f.composed&&(f.icons[0].badges={topLeft:{iconName:"forward",fontIconSize:"1x",className:"dgv-badge-composed"}});break;case"ds6w:composed":f.composed="boolean"==typeof e.value?e.value:"true"===e.value.toLowerCase(),!1===f.composed&&f.icons&&(f.icons[0].badges={topLeft:{iconName:"forward",fontIconSize:"1x",className:"dgv-badge-composed"}});break;case"preview_url":case"thumbnail_2d":f.thumbnail=e.value,f.grid||(f.grid={}),f.grid.thumbnail=e.value;break;case"ds6w:globaltype":f.grid||(f.grid={}),f.grid.globaltype=e.value,d(f,e.value);break;case"ispivotobject":f.isPivotObject=e.value;break;default:h[e.name]?(f.grid||(f.grid={}),f.grid[e.name]=h[e.name]):u&&-1!==u.indexOf(e.name)?(f.grid||(f.grid={}),l(f,e.name,e.value)):(f.padgrid||(f.padgrid={}),"bo.pgpshowextension.v_pgp_show"===e.name.toLowerCase()?(f.isPADHidden=!a(e.value),f.isPADHidden&&(f.isHiddenStateFrom=30,f.isPADHiddenReference=!0)):(f.grid||(f.grid={}),f.padgrid[e.name]=e.dispValue?e.dispValue:e.value,l(f,e.name,e.dispValue?e.dispValue:e.value)))}})),e.end()}else{let e=i.create("inst",{stats:!0});s.iterate(n,(function(e){switch(e.name.toLowerCase()){case"ds6w:type":f.grid||(f.grid={}),f.grid[e.name+"-Instance"]=e.value,f.type=e.value;break;case"resourceid":case"physicalid":f.resourceid=e.value;break;case"ds6w:i3dx":f.i3dx=e.value;break;case"ds6w:cpid":f.cpid=e.value,f.serviceId=o.getServiceIdFromCpid(f.cpid);break;case"isinternaljsonobj":f.isInternalJSONObj=e.value;break;case"treeOrder":case"ro.plminstance.v_treeorder":f.relationOrder=parseFloat(e.value),isNaN(f.relationOrder)&&(f.relationOrder=-1);break;case"matrixtxt":this.checkNotIdentity(e.value)&&(f.grid||(f.grid={}),f.grid["positionMatrix-Instance"]=e.value);break;case"ds6w:globaltype":f.grid||(f.grid={}),f.grid.globaltypeInstance=e.value,d(f,e.value);break;default:h[e.name]?(f.grid||(f.grid={}),f.grid[e.name+"-Instance"]=h[e.name]):u&&-1!==u.indexOf(e.name+"-Instance")?(f.grid||(f.grid={}),f.grid[e.name+"-Instance"]=e.value):(f.padgrid||(f.padgrid={}),"ro.pgpshowextension.v_pgp_show"===e.name.toLowerCase()?(f.isPADHidden=!a(e.value),f.isPADHidden&&(f.isHiddenStateFrom=30,f.isPADHiddenInstance=!0)):(f.grid||(f.grid={}),f.padgrid[e.name+"-Instance"]=e.dispValue?e.dispValue:e.value,f.grid[e.name+"-Instance"]=e.dispValue?e.dispValue:e.value))}})),e.end()}return f.relationOrder||(f.relationOrder=-1),f.grid||(f.grid={}),c.end(),f},parseNodeOptions_V2:function(e,i){var r=t.getTreeColumn(),l=t.getColumnsOrder(),c={resourceid:"",ensureNLS:!0,grid:{}},p=this;return s.iterateObj(e.node,(function(e,t){if(i)switch(t.toLowerCase()){case"resourceid":c.relationid=e;break;case"ds6w:i3dx":c.i3dx=e;break;case"ds6w:cpid":c.cpid=e,c.serviceId=o.getServiceIdFromCpid(c.cpid);break;case"from":c.from=e;break;case"to":c.resourceid=e;break;case"matrixtxt":p.checkNotIdentity(e)?c.grid["positionMatrix-Instance"]=e:c.grid["positionMatrix-Instance"]=void 0;break;case"ds6w:type":c.relationtype=e,c.grid[t+"-Instance"]=e;break;case"ro.plminstance.v_treeorder":c.relationOrder=parseFloat(e),isNaN(c.relationOrder)&&(c.relationOrder=-1);break;case"ro.pgpshowextension.v_pgp_show":c.isPADHiddenInstance=!a(e);break;case"ds6w:islastrevisionperstate":case"ds6wg:plmreference.v_islastversion":c.grid[t]=a(e);break;case"ds6w:reservedby":c.grid[t+"-Instance"]=e;break;case"svg":e&&e.length>0&&(c.grid||(c.grid={}),c.grid.svg||(c.grid.svg=[]),c.grid.svg.push({format:t,id:e}));break;case"relcount":c.relcount=parseInt(e),0===c.relcount&&(c.children=null);break;default:let n=t+"-Instance";(l&&l.includes(n)||l&&l.includes(t))&&(c.grid[n]=e)}else switch(t.toLowerCase()){case"resourceid":c.resourceid=e;break;case"ds6w:i3dx":c.i3dx=e;break;case"ds6w:cpid":c.cpid=e,c.serviceId=o.getServiceIdFromCpid(c.cpid);break;case"isinternaljsonobj":c.isInternalJSONObj=e;break;case r:c.label=e;break;case"ds6w:type":c.type=e,c.grid[t]=e;break;case"icon":case"type_icon_url":void 0===c.icons&&(c.icons=[]);let n=e;c.icons.push({iconPath:"url("+n+")",className:"dgv-icons"}),!1===c.composed&&(c.icons[0].badges={topLeft:{iconName:"forward",fontIconSize:"1x",className:"dgv-badge-composed"}});break;case"ds6w:composed":c.composed="boolean"==typeof e?e:"true"===e.toLowerCase(),!1===c.composed&&c.icons&&(c.icons[0].badges={topLeft:{iconName:"forward",fontIconSize:"1x",className:"dgv-badge-composed"}});break;case"thumbnail":case"thumbnail_2d":c.thumbnail=e,c.grid.thumbnail=e;break;case"ds6w:globaltype":c.globaltype=e,d(c,e);break;case"bo.pgpshowextension.v_pgp_show":c.isPADHiddenReference=!a(e);break;case"ds6w:islastrevisionperstate":case"ds6wg:plmreference.v_islastversion":c.grid[t]=a(e);break;case"ds6w:reservedby":case"ds6w:identifier":c.grid[t]=e;break;default:"ds6w:cadmaster"===t&&(t="ds6w:cadMaster"),l&&l.includes(t)&&(c.grid[t]=e)}})),i||(c.children=[],void 0===c.icons||void 0===c.thumbnail&&(c.thumbnail=c.icons[0].iconPath.replace("fileType=ICON","fileType=THUMBNAIL_2D"),c.thumbnail=c.thumbnail.substring(4,c.thumbnail.length-1),c.grid.thumbnail=c.thumbnail)),n.GLOBALTYPE_DOC===c.globaltype&&(c.children=null),c},parseNodeOptions:function(i,r){var l=t.getTreeColumn(),c=t.getColumnsOrder(),p={resourceid:"",ensureNLS:!0,grid:{}},u=this;return s.iterateObj(i.node,(function(t,n){if(r)switch(n.toLowerCase()){case"resourceid":p.relationid=t;break;case"ds6w:i3dx":p.i3dx=t;break;case"ds6w:cpid":p.cpid=t,p.serviceId=o.getServiceIdFromCpid(p.cpid);break;case"from":p.from=t;break;case"to":p.resourceid=t;break;case"matrixtxt":u.checkNotIdentity(t)?p.grid["positionMatrix-Instance"]=t:p.grid["positionMatrix-Instance"]=void 0;break;case"ds6w:type":p.relationtype=t,p.grid[n+"-Instance"]=t;break;case"ro.plminstance.v_treeorder":p.relationOrder=parseFloat(t),isNaN(p.relationOrder)&&(p.relationOrder=-1);break;case"ro.pgpshowextension.v_pgp_show":p.isPADHiddenInstance=!a(t);break;case"ds6w:islastrevisionperstate":case"ds6wg:plmreference.v_islastversion":p.grid[n]=a(t);break;case"ds6w:reservedby":p.grid[n+"-Instance"]=t;break;default:let i=n+"-Instance";if(!0===e.getSetting("activateUnits")){let e=t.split("||");3===e.length&&(t={value:e[0],inputUnit:e[1],inputValue:e[2]})}(c&&c.includes(i)||c&&c.includes(n))&&(p.grid[i]=t)}else switch(n.toLowerCase()){case"resourceid":p.resourceid=t;break;case"ds6w:i3dx":p.i3dx=t;break;case"ds6w:cpid":p.cpid=t,p.serviceId=o.getServiceIdFromCpid(p.cpid);break;case"isinternaljsonobj":p.isInternalJSONObj=t;break;case l:p.label=t;break;case"ds6w:type":p.type=t,p.grid[n]=t;break;case"icon":case"type_icon_url":void 0===p.icons&&(p.icons=[]);let i=t;p.icons.push({iconPath:"url("+i+")",className:"dgv-icons"}),!1===p.composed&&(p.icons[0].badges={topLeft:{iconName:"forward",fontIconSize:"1x",className:"dgv-badge-composed"}});break;case"ds6w:composed":p.composed="boolean"==typeof t?t:"true"===t.toLowerCase(),!1===p.composed&&p.icons&&(p.icons[0].badges={topLeft:{iconName:"forward",fontIconSize:"1x",className:"dgv-badge-composed"}});break;case"thumbnail":case"thumbnail_2d":p.thumbnail=t,p.grid.thumbnail=t;break;case"ds6w:globaltype":p.globaltype=t,d(p,t);break;case"bo.pgpshowextension.v_pgp_show":p.isPADHiddenReference=!a(t);break;case"ds6w:islastrevisionperstate":case"ds6wg:plmreference.v_islastversion":p.grid[n]=a(t);break;case"ds6w:reservedby":case"ds6w:identifier":p.grid[n]=t;break;case"ispivotobject":case"isPivotObject":p.isPivotObject=t;break;default:if("ds6w:cadmaster"===n&&(n="ds6w:cadMaster"),!0===e.getSetting("activateUnits")){let e=t.split("||");3===e.length&&(t={value:e[0],inputUnit:e[1],inputValue:e[2]})}c&&c.includes(n)&&(p.grid[n]=t)}})),r||(p.children=[],void 0===p.icons||void 0===p.thumbnail&&(p.thumbnail=p.icons[0].iconPath.replace("fileType=ICON","fileType=THUMBNAIL_2D"),p.thumbnail=p.thumbnail.substring(4,p.thumbnail.length-1),p.grid.thumbnail=p.thumbnail)),n.GLOBALTYPE_DOC===p.globaltype&&(p.children=null),p},parseGroupingNodeOptions:function(e,n){t.getTreeColumn();var i={resourceid:"",ensureNLS:!0,grid:{}};i.icons=e.icons,i.children=[],i.thumbnail="";return s.iterateObj(e,(function(e,t){switch(t.toLowerCase()){case"resourceid":i.resourceid=e;break;case"ds6w:i3dx":i.i3dx=e;break;case"ds6w:cpid":i.cpid=e,i.serviceId=o.getServiceIdFromCpid(i.cpid);break;case"label":i.label=e;break;case"icon":void 0===i.icons&&(i.icons=[]),i.icons.push({iconPath:"url("+e+")",className:"dgv-icons"});break;case"thumbnail":i.grid.thumbnail=e;break;case"ds6w":i.ds6w=e;break;case"disptext":i.dispText=e;break;case"grid":i.grid=e;break;case"grp":i.grp=e;break;case"grpselected":i.grpSelected=e;break;case"kind":i.kind=e;break;case"isother":i.isOther=e}})),i}},c})),define("DS/ENOXParser/modules/mixins/parser/ParseFetch",["DS/ENOXParser/modules/common/Constants","DS/PADServices/utils/HideShowController","DS/PADServices/utils/DictionaryAccess","DS/PADServices/utils/Iterator","DS/PADServices/utils/Meas","DS/ENOXParser/modules/common/Helpers","DS/PADUtils/PADSession","DS/PADUtils/PADSettingsMgt"],(function(e,t,n,i,r,s,o,a){"use strict";function d(e,t,n,i){let r=n;return i&&(r=e.filterAttributesForUpdate({node:t,opts:r})),r&&0===r.relcount&&(r.children=null),r}function l(){}return l.prototype={parseFetch:function(e){var i=r.addOrGetSection("parser");return i.start("parseFetch",{stats:!0}),new Promise(function(r,s){var o=e.treeDoc;o.withTransactionUpdate(function(){for(var s=0;s<e.results.length;s++){let i=this.parseAttributes(e.results[s].attributes);t.defaultHiddenState(i);let r=new e.nodeModelClass(i);o.addRoot(r);let a=o.getRoots().length;o.getModelEvents().publish({event:"onRootAdded",data:{nb_root:a,added_node:r}}),n.updateNLS(r)}i.end("parseFetch"),r()}.bind(this))}.bind(this))},parseMultiFetch:function(e){let t=this;return new Promise((function(r,s){var o=e.treeDoc;o.withTransactionUpdate((function(){i.iterate(e.results,(function(e){var r=t.parseAttributes(e.attributes),s=o.getNodesById(r.resourceid);if(s.length)i.iterate(s,(function(e){e.updateOptions(r),n.updateNLS(e)}));else{var a=o.getNodesByRelId(r.resourceid);a.length&&(delete r.resourceid,i.iterate(a,(function(e){e.updateOptions(r),n.updateNLS(e)})))}}))})),r()}))},refreshFetch:function(n){let r=this;return new Promise((function(a,d){let l=n.roots,c=n.wsResponse.results;c?(i.iterate(c,(function(t){let i=r.parseAttributes(t.attributes),a=function(e){let t=l.filter((function(t){return t.getID()===e}));return t.length?t[0]:null}(i.resourceid);if(a){a.setState(e.NODE_STATES.COLLAPSED),a.options.childComputed=!1,a.options.children||(a.options.children=[],i.children=[]),!0!==n.FBIProxy.HasFilter(a.getID()).hasFilter||o.isAuthoring()&&!a.keepFilterBadge?s.node.clearBadges(a):s.node.setFilterBadge(a),r.options.modules.NodeUtils.refreshForRoot(a,i),a.queueNls()}})),t.clearHiddenState(l),a()):a()}))},refreshNodes:function(t){let n=this;return new Promise((function(r,s){let o=!1;t.treeDoc.filterAttributesForUpdate&&(o=!0);let a=[],l=[],c=(t.wsResponse.results,new Map);i.iterate(t.wsResponse.results,(function(e){let t=function(e){let t="";return i.iterateControl(e.attributes,(function(e){if("resourceid"===e.name)return t=e.value,{break:!0}})),t}(e),r=n.parseAttributes(e.attributes);c.set(t,r)})),i.iterateMap(c,(function(n,r){if(t.refreshParameters.created&&-1!==t.refreshParameters.created.indexOf(r)){var s=t.treeDoc.createNodeModel(n);t.treeDoc.addRoot(s),s.queueNls(),t.treeDoc.getModelEvents().publish({event:"onRootAdded",data:{nb_root:t.treeDoc.getRoots().length,added_node:s}}),a.push(s),l.push(s.getID())}else if(t.refreshParameters.modified&&-1!==t.refreshParameters.modified.indexOf(r)){let s=t.treeDoc.getRoots();i.iterate(s,(function(s){let o=s.getNodesById(r);if(o.length)i.iterate(o,(function(i){i.updateOptions(d(t.treeDoc,i,n)),i.queueNls(),null===i.options.children&&i.setState(e.NODE_STATES.NO_CHILDREN),a.push(i)}));else{let e=s.getNodesByRelId(r);i.iterate(e,(function(e){var i=d(t.treeDoc,e,n);delete i.resourceid,e.updateOptions(i),e.queueNls(),a.push(e)}))}var l=t.treeDoc.searchRootById(r);if(l)l.updateOptions(d(t.treeDoc,l,n)),l.queueNls(),0===l.options.relcount&&l.setState(e.NODE_STATES.NO_CHILDREN),t.treeDoc.getModelEvents().publish({event:"onRootAdded",data:{nb_root:t.treeDoc.getRoots().length,added_node:l}}),a.push(l);else if(t.refreshParameters.relationids&&-1!==t.refreshParameters.relationids.indexOf(r)){let e=t.treeDoc.getRoots();i.iterate(e,(function(e){let t=e.getNodesByRelId(r);i.iterate(t,(function(e){e.updateOptions({relationOrder:n.relationOrder}),e.queueNls();let t=e.getParent(),r=e.getBrothers(),s=t.getChildren();s.length>1&&i.iterate(r,(function(n){if(n.options.relationOrder>relid.options.relationOrder){let i=s.indexOf(e);if(s.indexOf(n)<i){let e=t.removeChild(relid);t.insertBefore(e,n)}}})),a.push(e)}))}))}}))}})),a.length&&t.treeDoc.fillAttributesAsync(a),r()}))}},l})),define("DS/ENOXParser/modules/common/LoadModelBuilder",["UWA/Core","DS/ENOXParser/modules/common/Constants","DS/PADServices/utils/Iterator","DS/PADServices/utils/Meas","DS/PADServices/utils/HideShowController"],(function(e,t,n,i,r){const s=i.addOrGetSection("parser");function o(e,t){return e.relationOrder-t.relationOrder}function a(e){for(var t=[],n=[],i=[],r=[],s=0;s<e.length;s++){var a=e[s];switch(a.globaltype){case"ds6w:Instance":case"ds6w:Document":n.push(a);break;case"ds6w:Part":t.push(a);break;default:i.push(a)}}return n.sort(o),t.sort(o),i.sort(o),r=(r=(r=r.concat(n)).concat(t)).concat(i)}function d(e,n){if(e.isGroupingNode)return void(e.expandedState=t.NODE_STATES.EXPANDED.state);let i=n.findInCtx,r=(n.filter,n.expandAll),s=!!n.isRefresh;if(e.children&&e.children.length)if(1===e.children.length){let n=e.children[0];n.globaltype===t.GLOBALTYPE_DOC?e.expandedState=t.NODE_STATES.COLLAPSED.state:i?(e.expandedState=t.NODE_STATES.PARTIALLY_EXPANDED.state,n.expandedState=t.NODE_STATES.PARTIALLY_EXPANDED.state):e.expandedState=t.NODE_STATES.EXPANDED.state}else e.expandedState=i?t.NODE_STATES.PARTIALLY_EXPANDED.state:t.NODE_STATES.EXPANDED.state;else s?(e.expandedState=t.NODE_STATES.COLLAPSED.state,delete e.childComputed):r&&(e.children=null,e.expandedState=t.NODE_STATES.NOCHILDREN.state)}function l(e,t){d(e,t),e.children&&n.iterate(e.children,(function(e){l(e,t)}))}function c(e){let t=new Map,i=e.filter((e=>e.children&&e.children.length));for(let e=0;e<i.length;e++){let n=i[e];if(n.children&&n.children.length)for(let e=0;e<n.children.length;e++){let i=n.children[e],r=i.resourceid+"_"+i.relationid;t.has(r)||t.set(r,i)}}let r=[];return n.iterateMap(t,(function(e,t){r.push(e)})),r.length?r:[]}function p(e,t,n){result=-1,found=!1;let i=e+1;if(n){if(n.resourceid===t&&(found=!0),found)return i;{recurseFound=!1;let e=n.children;if(e&&e.length)for(let n=0;n<e.length;n++){let r=p(i,t,e[n]);if(-1!==r){result=r,recurseFound=!0;break}}return result}}return result}function u(e,t,n){const i=n;let r=e.map((function(e){return i.get(e)?i.get(e):[]})).map((function(e){let t=e.resourceid;return[t,p(0,t,e)]}));const s=new Map(r);t.sort((function(e,t){let n,i,r=s.get(e),o=s.get(t);return-1!==r&&(n=r),-1!==o&&(i=o),n>i?-1:n<i?1:0}))}function h(e){this.options=e,this._parentLookup=new Map,this._arraysOfReferences=new Map,this._correctionList=[],this._orderList=[]}return h.prototype={addChild:function(t,n,i){var r=this._parentLookup.get(t);if(r){var s;(s=r).children||(s.children=[]),this.options.addPaths||i&&"noChildComputed"===i.mode||(r.childComputed=!0);var o=e.clone(n);r.children.push(o),this.options.expandAll&&(o.childComputed=!0);var a,d,l=this._arraysOfReferences.get(o.resourceid);l||(l=[]),l.push(o),l.length>1?this._correctionList.push(o.resourceid):(a=this._orderList,d=r,-1===a.indexOf(d)&&a.push(d)),this._arraysOfReferences.set(o.resourceid,l),this._parentLookup.set(o.resourceid,o)}else console.warn("LoadModelBuilder.addChild unknown parent")},addReference:function(e){this._parentLookup.set(e.resourceid,e)},getReference:function(e){return this._parentLookup.get(e)},getOptions:function(t,n){if(t&&n){let i=this._arraysOfReferences.get(t);if(!i)return e.clone(this._parentLookup.get(t));{let e=i.filter((function(e){return e.relationid===n}));if(e.length)return e[0]}}else if(t)return this._parentLookup.get(t)},correct:function(e){i.addOrGetSection("parser");if(!this.options.isRefresh)for(let e=0;e<this._orderList.length;e++){var r=this._orderList[e];r.children.length>1&&(r.children=a(r.children))}if(this.options.expandIds){let e=s.create("sortHierarchy",{stats:!0});u(this.options.expandIds,this._correctionList,this._parentLookup),e.end()}let o=s.create("copyInstances",{stats:!0}),p=[];for(let t=0;t<this._correctionList.length;t++){let n=this._correctionList[t],i=this._arraysOfReferences.get(n),r=c(i);for(var h=0;h<i.length;h++){let t=i[h];r&&(t.children=e.assignClone(r),p.push(t))}}o.end();let f=s.create("correctThumbnail",{stats:!0}),g=this.options;n.iterateMap(this._arraysOfReferences,(function(e){n.iterate(e,(function(e){if(d(e,g),e.children&&1===e.children.length){var n=e.children[0];n.globaltype===t.GLOBALTYPE_DOC&&(e.grid.thumbnail=n.grid.thumbnail)}}))})),f.end();let D=s.create("recheck",{stats:!0});n.iterate(p,(function(e){l(e,g)})),D.end()},correctPgpOcc:function(e,t){for(let s of t.keys()){let o=this._parentLookup.get(s[0]);for(var n=0;n<s.length;n+=2)if(o.children)for(var i=0;i<o.children.length;i++)if(o.children[i].relationid===s[n+1]){o=o.children[i];break}o.isPADHidden&&o.isHiddenStateFrom===r.FROMS.PGP||(o.isPADHidden=t.get(s),r.defaultHiddenState(o)),o.isHiddenState===r.STATES.HIDDEN&&(e.isHiddenState=!0)}}},h})),define("DS/ENOXParser/ParserCV",["DS/ENOXParser/modules/mixins/parser/ParseAttributes","DS/ENOXParser/modules/mixins/parser/MergeObj","DS/ENOXParser/modules/mixins/parser/OfwOcc","DS/PADServices/utils/Meas","DS/PADServices/utils/HideShowCtrl","DS/WebappsUtils/WebappsUtils","DS/PADServices/utils/DictionaryAccess","DS/PADServices/settings/AppSettings","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/SGIUtils","DS/PADServices/utils/HideShowInhUtils"],(function(e,t,n,i,r,s,o,a,d,l,c){"use strict";const p="ds6w:Document",u="3DShape";function h(){return"object"==typeof h.instance?h.instance:(h.instance=this,this)}function f(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function g(e,t){const n=e.options.occPath.join("/"),i=t.join("/");return n.startsWith(i)}h.prototype=Object.assign(h.prototype,e.prototype),h.prototype=Object.assign(h.prototype,t.prototype),h.prototype=Object.assign(h.prototype,n.prototype);const D={COLLAPSED:{state:"collapsed"},EXPANDED:{state:"expanded"},PARTIALLY_EXPANDED:{state:"partiallyExpanded"}};function S(e,t,n){n.has(e)&&e.setState(t)}function P(e,t,n,i){if(e.hasChildren()){let r=-1===t||t>n+1;if(function(e){let t=e.getChildren();return t&&1===t.length&&t[0].options.globaltype===b&&t[0].options.type===u}(e))i.has(e.getChildren()[0])&&e.setState(D.COLLAPSED);else if(S(e,D.EXPANDED,i),-1===t&&(e.getState()===D.PARTIALLY_EXPANDED.state||e.hasChildren()&&!e.isRelationsObjectNode)&&e.setState(D.EXPANDED),r){let r=n+1,s=e.getChildren();for(let e=0;e<s.length;e++){P(s[e],t,r,i)}}}else S(e,D.COLLAPSED,i)}function m(e,t,n){const s=i.addOrGetSection("processPGP");if(e[n].length){const i=n.charAt(0).toUpperCase()+n.slice(1),o=`processPGP-${i}`,a=window.performance.now();s.start(o,{stats:!0}),r.setPGPs(t,e[n]);const d=window.performance.now(),l=Math.trunc(100*(d-a))/100;console.log(` -- Process PGP ${i} with ${e[n].length} paths in : ${l} ms -- ${l/1e3} s -- ${l/6e4} m`),s.end(o),s.dump(o)}}h.prototype.specOptIFCShape=function(e,t=!1){let n=e.globaltype,i=!1;return n||(n=e.grid.globaltype),l.isSGIEnv()&&!0===e.isPivotObject?(e.children||(e.children=[]),e.icons||(e.icons=[]),i=!0):n===p&&e.type===u&&(e.children&&(e.children=void 0),t&&!e.padstate&&(e.padstate="noChildren")),i},h.prototype.applyPGP=function(e,t){for(let t of["others","hide","show"])e[t].length>0?e[t+"_AvgLength"]=e[t].reduce(((e,t)=>e+t.length),0)/e[t].length:e[t+"_AvgLength"]=0;const n=["others","hide","show"].sort(((t,n)=>e[`${n}_AvgLength`]-e[`${t}_AvgLength`]));for(let i of n)m(e,t,i)},h.prototype.parseExpandOcc=async function(e){return new Promise((t=>{const n=i.addOrGetSection("parseExpandOcc"),s=a.getSetting("grpBSD"),o=e.expandedNodes.filter((e=>e.hasChildren())),l=new Set;let h=e.treeDoc,D=e.wsResponse,S=e.state||"expanded",m=e.nodeModelClass,b=this.__parseResp(D,e.isFindInCtx,e.selectPaths),N=b.mapNodes,O=b.paths,A=b.pathsToSelect,E={show:[],hide:[],others:[],hasPGP:!!b.pgp};h.prepareUpdate(),console.groupCollapsed(`ParserCV::parseExpandOcc# Nb Nodes: ${N.size} nbPaths: ${O.length}`),n.start("parseExpOcc-buildModel",{stats:!0});let _=(t,n)=>{let i=t[n],s=this.assignClone(N.get(i)),o=s;if(n-1>0){let e=t[n-1],i=this.assignClone(N.get(e));o=this.smartAssign(s,i)}return o.occPath=t,this.__managePGP(o,b.pgp,E),!function(e,t){let n=!1;const i=r.getHiddenPathsAsArray();for(let r=0;r<i.length;r++){let s=i[r];if(-1!==t&&(s=i[r].slice(0,e.length)),f(s,e)){n=!0;break}}return n}(t,e.expandLevel)?r.defaultHiddenState(o):(o.isPADHidden=!0,o.isHiddenPathFromWidgetLink=!0),this.specOptIFCShape(o),o};function w(t,n){if(t.isRoot()||s&&!0===t.getReferenceValue("groupApplied")){let i=h.getGroupForNode({node:t,child:n,state:!0===e.isFindInCtx?"partiallyExpanded":"expanded"});i&&(t=i)}if(function(e,t){if(e.hasChildren()){let n=e.getChildren();if(-1===t.options.relationOrder){let i=1,r=n[0];for(;!0===r.options.isGroupingNode&&i<n.length;)r=n[i],i++;i===n.length?e.addChild(t):e.insertBefore(t,r)}else for(let i=n.length-1;i>=0;i--){if(n[i].options.relationOrder>t.options.relationOrder){if(i-1>=0&&n[i-1].options.relationOrder>t.options.relationOrder)continue;e.insertBefore(t,n[i])}else e.addChild(t);break}}else e.addChild(t)}(t,n),t.setState({state:S}),"expanded"===S&&!0!==t.isRoot()&&(t.hasChildren()?t.getChildren().filter((e=>"partiallyExpanded"===e.getState())).length>0&&t.getParent().setState({state:"partiallyExpanded"}):t.getParent().setState({state:"expanded"})),c.isHideShowInheritActive()){const e=t.options.isHiddenState===r.STATES.HIDDEN,i=n.options.isHiddenState===r.STATES.HIDDEN,s=t.options.isHiddenState;if(e){if(t.isLockNodeDuePGP())n.updateOptions({isLockNode:!0,isHiddenState:s});else if(s===r.STATES.HIDDEN&&!t.isLockNodeDuePGP()&&!n.isLockNodeDuePGP()&&(n.updateOptions({isHiddenState:r.STATES.HIDDEN,isPADHidden:!0}),n.hasChildren())){const e=t=>{if(t&&t.options.isHiddenState!==r.STATES.HIDDEN&&(t.updateOptions({isHiddenState:r.STATES.HIDDEN,isPADHidden:!0}),t.hasChildren())){const n=t.getChildren();for(let t=0;t<n.length;t++)e(n[t])}},t=n.getChildren();for(let n=0;n<t.length;n++)e(t[n])}}else if(i&&!e&&!t.isLockNodeDuePGP()){r._determineMixedOnShow(t)?t.updateOptions({isHiddenState:r.STATES.MIXED}):t.updateOptions({isHiddenState:r.STATES.HIDDEN,isPADHidden:!0})}}t.options.padstate=S,"expanded"===S&&(t.options.childComputed=!0)}let x=[],C=!1;const I=Date.now();for(let t=0;t<O.length;t++){let n,i=O[t];for(let t=i.length-1;t>=0;t-=2){let s=i.slice(0,t+1),o=h.getNodeFromPath(s);if(o){if(!0===o.options.waiting4validation||!0===e.isFindInCtx){let i=_(s,t);if(i.waiting4validation=void 0,delete i.children,o.isRoot()&&o.options.filtered&&(i.icons[0].badges={bottomRight:{iconName:"filter",fontIconSize:"1x",className:"dgv-badge"}}),o.updateOptions(i),i.isHiddenPathFromWidgetLink&&(delete i.isHiddenPathFromWidgetLink,v([s],h)),!0!==o.isRoot()){const e=o.options.occPath.join("/");-1===x.indexOf(e)&&x.push(e)}if(!1===o.isVisible()&&!0===e.isFindInCtx){let e=o;for(;e&&!e.isRoot();)e=e.getParent(),e.isExpanded()||e.setState({state:"partiallyExpanded"})}if(n&&g(n,s)){w(o,n),n=o;continue}}else if(n)w(o,n);else if(o.hasChildren()&&"collapsed"===o.getState()&&o.getDepth()>o.getDepth()+e.expandLevel)o.setState({state:S}),o.options.padstate=S;else if("partiallyExpanded"!==e.state&&!1===o.isRoot()){let t=o.getParent();(-1===e.expandLevel||(t.getDepth?.()??t.getNodeDepth?.())>(t.getDepth?.()??t.getNodeDepth?.())+e.expandLevel)&&t.setState({state:S})}if(c.isHideShowInheritActive()){let e;if(e=o.isRoot()?o.options.isHiddenState:o.getParent()?o.getParent().options.isHiddenState:r.STATES.SHOWN,o&&c.isOneParentNodeLockedDuePGP(o))o.updateOptions({isLockNode:!0,isHiddenState:e});else if(e===r.STATES.HIDDEN&&!o.isLockNodeDuePGP()){r._determineMixedOnShow(o)?o.updateOptions({isHiddenState:r.STATES.MIXED}):o.updateOptions({isHiddenState:r.STATES.HIDDEN,isPADHidden:!0})}}break}{const i=new m(_(s,t));l.add(i),n&&(w(i,n),n.options.globaltype!==p||!0===e.isFindInCtx||!0===n.options.isPivotObject?(i.setState({state:S}),i.options.padstate=S):n.options.globaltype===p&&i.options.children&&1===i.options.children.length&&e.expandLevel&&1!==e.expandLevel&&(n.options.type===u?(i.setState({state:"collapsed"}),i.options.padstate="collapsed"):(i.setState({state:"expanded"}),i.options.padstate="expanded")),"expanded"===S&&(i.options.childComputed=!0)),-1!==e.expandLevel||i.hasChildren()||i.options.globaltype===p||(i.options.childComputed=!0),i.isInternalJSONObject()&&(C=!0),n=i}}}if(!0===C&&O.length>0){h.searchRootById(O[0][0]).options.hasInternalJSONObject=!0}const y=Date.now()-I;console.log(` -- Duration loop on path: ${y}`),function(e,t,n){if(e.length){t.start("parseExpOcc-reorder",{stats:!0});for(let t=0;t<e.length;t++){const i=n.getNodeFromPath(e[t].split("/")),r=i.options.relationOrder;let s,o=i.getPreviousBrother(),a=!1;for(;o&&o.options.relationOrder>r;)s=o,o=s.getPreviousBrother();if(!s){let e=i.getNextBrother();for(;e&&e.options.relationOrder<r;)s=e.getNextBrother(),s||(a=!0),e=e.getNextBrother()}let d=!1;if(!s&&!a){const e=i.getParent();e&&e.options.relationOrder>r&&(d=!0)}s?(console.log(`Node: ${i.getLabel()} should be inserted before ${s.getLabel()}`),i.getParent().insertBefore(i,s)):!0===a?(console.log(`Node: ${i.getLabel()} added at the end`),i.getParent().addChild(i)):!0===d?console.log(`Node: ${i.getLabel()} `):console.log("No modification for "+i.getLabel())}t.end("parseExpOcc-reorder")}}(x,n,h),function(e,t,n){if(e&&e.length>0){console.group(` -- Select the ${e.length} paths during find in ctx`);for(let i=0;i<e.length;i++){let r=t.getNodeFromPath(e[i]);r?(r.select(),r.hasChildren()&&r.setState({state:n})):console.log("Unknown path:"+e[i].join("/"))}console.groupEnd()}}(A,h,S),E.hasPGP&&this.applyPGP(E,h),e.isFindInCtx||function(e,t,n){if(e.length)for(let i=0;i<e.length;i++)P(e[i],t,0,n)}(o,e.expandLevel,l),h.pushUpdate(),n.end("parseExpOcc-buildModel"),n.dump("parseExpOcc-buildModel"),console.groupEnd(),d.publish({event:"ENXModel/Expand/parseDone"}),t()}))};const b="ds6w:Document";function v(e,t){for(const n of e){const e=t.getNodeFromPath(n);if(!e)continue;const i=r.__gatherParentList(e);if(i)for(const e of i)r.__calculateParentState(e)}}function N(e,t){let n=[];if(Array.isArray(e[t]))for(let i=0;i<e[t].length;i++)n.push(e[t][i].join("/"));return n}function O(e,t){if(0!==e.others.length)for(let n=0;n<e.others.length;n++)if(e.others[n].join("/")===t.occPath.join("/")){e.others.splice(n,1);break}}function A(e,t,n,i){let s;s=i?n.hide:n.show;for(let o=0;o<e.length;o++)if(-1!==t.occPath.join("/").indexOf(e[o])){const a=e[o].split("/");if(a[a.length-1]===t.resourceid){t.isPADHiddenOccurrence=i,i||(t.isPADHiddenInstance=!1,t.isPADHiddenReference=!1),t.isHiddenStateFrom=r.FROM.PGP,s.push(t.occPath),O(n,t);break}}}h.prototype.parsePathsOcc=async function(e){var t=i.addOrGetSection("parsePathsOcc");let n=e.treeDoc,r=e.wsResponse,s=e.state?e.state:"partiallyExpanded",d=e.nodeModelClass,l=this.__parseResp(r),c={show:[],hide:[],others:[],hasPGP:!!l.pgp};console.groupCollapsed(`ParserCV::parseExpandOcc# Nb Nodes: ${l.mapNodes.size} nbPaths: ${l.paths.length}`),n.prepareUpdate(),t.start("parsePathsOcc-buildModel",{stats:!0});let p=(e,t)=>{let n=e[t],i=this.assignClone(l.mapNodes.get(n)),r=i;if(t-1>0){let n=e[t-1],s=this.assignClone(l.mapNodes.get(n));r=this.smartAssign(i,s)}return r.occPath=e,this.__managePGP(r,l.pgp,c),r},u=[],h=[];const f=a.getSetting("grpBSD"),g=Date.now();for(let e=0;e<l.paths.length;e++){let t,i=l.paths[e],r=!1;for(let e=i.length-1;e>=0;e-=2){let a=i.slice(0,e+1),l=n.getNodeFromPath(a);if(l){if(!0!==l.options.waiting4validation){if(t){let e=new d(t);if((l.isRoot()||f&&!0===l.getReferenceValue("groupApplied"))&&n.isGroupingApplied()){let t=n.getGroupForNode({node:l,child:e});t&&(l=t)}if(l.hasChildren()){let n=l.getChildren();if(-1===t.relationOrder)l.insertBefore(e,n[0]);else for(let i=n.length-1;i>=0;i--){if(n[i].options.relationOrder>t.relationOrder){if(i-1>=0&&n[i-1].options.relationOrder>t.relationOrder)continue;l.insertBefore(e,n[i])}else l.addChild(e);break}}else l.addChild(e);r=!0}else if(l.hasChildren()&&l.isRoot()||f&&!0===l.getReferenceValue("groupApplied")&&n.isGroupingApplied()){let e=l.getChildren();for(let t of e){let e=n.getGroupForNode({node:l,child:t});e&&(l=e,l.addChild(t))}}else l.hasChildren()&&"collapsed"===l.getState()&&(l.setState({state:s}),l.updateOptions({padstate:s}));break}{let t=p(a,e);if(t.waiting4validation=void 0,t.icons||(t.icons=[]),delete t.children,l.updateOptions(t),!0!==l.isRoot()){let e=l.options.occPath.join("/");-1===u.indexOf(e)&&u.push(e)}l.options.globaltype===b&&(l.options.children=null,l.setState({state:"noChildren"})),o.updateNLS(l)}}else{let n=p(a,e);if(t){if(n.expandedState=s,n.padstate=s,0===n.children.length||-1!==t.relationOrder||n.children[n.children.length-1].relationOrder<t.relationOrder)n.children.push(t);else for(let e=n.children.length-1;e>=0;e--)if(n.children[e].relationOrder<t.relationOrder){n.children.splice(e+1,0,t);break}"expanded"===s&&(n.childComputed=!0)}t=n}}!1===r&&t&&(n.addRoot(t),h.push(t.resourceid))}const D=Date.now()-g;if(console.log(` -- Duration loop on path: ${D}`),c.hasPGP&&this.applyPGP(c,n),u.length){t.start("parseExpOcc-reorder",{stats:!0});for(let e=0;e<u.length;e++){let t,i=n.getNodeFromPath(u[e].split("/")),r=i.options.relationOrder,s=i.getPreviousBrother(),o=!1;for(;s&&s.options.relationOrder>r;)t=s,s=t.getPreviousBrother();if(!t){let e=i.getNextBrother();for(;e&&e.options.relationOrder<r;)t=e.getNextBrother(),t||(o=!0),e=e.getNextBrother()}t?i.getParent().insertBefore(i,t):!0===o&&i.getParent().addChild(i)}t.end("parseExpOcc-reorder")}return t.end("parsePathsOcc-buildModel"),t.dump("parsePathsOcc-buildModel"),n.pushUpdate(),console.groupEnd(),{rootIds:h,treatedPaths:l.paths}},h.prototype.parseRefreshOcc=async function(e){let t=i.addOrGetSection("parseRefreshOcc"),n=e.treeDoc,s=e.wsResponse;t.start("parseRefreshOcc-buildModel",{stats:!0});let a=this.__parseResp(s),l=a.mapNodes,p=a.paths,u=[],h=n.createUpdateCollection(),f={show:[],hide:[],others:[],hasPGP:!!a.pgp};if(console.groupCollapsed("ParserCV::parseRefreshOcc# Nb Nodes: "+a.mapNodes.size),n.prepareUpdate(),p.length){let e=Date.now(),t=[];console.log(" -- Nb Nodes: "+a.mapNodes.size),console.log(" -- Nb Paths: "+a.paths.length);for(let e=0;e<a.paths.length;e++){let i=a.paths[e];for(let e=i.length-1;e>=0;e-=2){let s=i.slice(0,e+1);u.push(s.join("/"));let d=n.getNodeFromPath(s);if(d){let i=d.options.occPath?d.options.occPath:d.getOccurencePath();if(-1===t.indexOf(i.join("/"))){t.push(i.join("/"));let l=s[e],p=this.assignClone(a.mapNodes.get(l)),u=p;if(e-1>0){let t=s[e-1],n=this.assignClone(a.mapNodes.get(t));u=this.smartAssign(p,n)}u.icons||(u.icons=[]),u.occPath=s,this.__managePGP(u,a.pgp,f),c.isHideShowInheritActive()?(c.isOneParentNodeLockedDuePGP(d)&&(c.isPGPFromServerDisabled()?u.isLockNode=!1:(u.isLockNode=!0,u.isHiddenState=d.getParent().options.isHiddenState)),d.isLockNodeDuePGP()&&c.isPGPFromServerDisabled()&&(u.isLockNode=!1)):u.isLockNode=!1,r.defaultHiddenState(u),delete u.children,d.isRoot()&&d.options.filtered&&(u.icons[0].badges={bottomRight:{iconName:"filter",fontIconSize:"1x",className:"dgv-badge"}});let g=!1;"ds6w:Part"===u.globaltype&&null===d.options.children&&(u.children=[],g=!0);let D=this.specOptIFCShape(u,!0);n.smartUpdate(d,u,h),(g||D)&&(delete d.options.childComputed,d.setState({state:"collapsed"})),o.updateNLS(d)}}}r.__clearHiddenState()}const i=Date.now()-e;console.log(" -- Treated Occs: "+t.length),console.log(" -- Duration loop on path: "+i)}else for(let e of l.values()){let t=n.getNodeFromPath([e.resourceid]);t?(t.isRoot()&&t.options.filtered&&(e.icons[0].badges={bottomRight:{iconName:"filter",fontIconSize:"1x",className:"dgv-badge"}}),r.defaultHiddenState(e),this.specOptIFCShape(e,!0),t.updateOptions(e),u.push(t.getID())):console.log("Unknown root "+e.label)}return h.end(),f.hasPGP&&this.applyPGP(f,n),n.pushUpdate(),t.end("parseRefreshOcc-buildModel"),d.publish({event:"ENXModel/Expand/parseDone"}),console.groupEnd(),{refreshPaths:u}},h.prototype.parseAddOcc=async function(e){let t=i.addOrGetSection("parseAddOcc"),n=e.treeDoc,r=e.wsResponse;t.start("parseAddOcc-buildModel",{stats:!0});let s=this.__parseResp(r),o=s.mapNodes;console.groupCollapsed("ParserCV::parseAddOcc# Nb Nodes: "+s.mapNodes.size);for(let e of o.values())e.children=[],this.specOptIFCShape(e),n.addRoot(e);n.prepareUpdate(),t.end("parseAddOcc-buildModel"),console.log(s),n.pushUpdate(),console.groupEnd()},h.prototype.insertTempPaths=async function(e){let t=i.addOrGetSection("insertTempPaths");const n=a.getSetting("grpBSD");let r=e.treeDoc,s=e.paths,o=e.nls,d=e.state,l=e.nodeModelClass,c=[];r.prepareUpdate(),t.start("insertTempPaths-buildModel",{stats:!0});const p={resourceid:null,relationid:null,label:o.loadingText,icons:[{iconPath:E.loadingicon}],thumbnail:E.loadingthumbnail,alternText:o.loadingText,waiting4validation:!0,children:[]},u=Date.now();for(let e=0;e<s.length;e++){let t,i=s[e],o=!1;for(let e=i.length-1;e>=0;e-=2){let s=i.slice(0,e+1),a=r.getNodeFromPath(s);if(a){if(t){if(a.isRoot()||!0===n&&!0===a.getReferenceValue("groupApplied")){let e=r.getGroupForNode({node:a,child:t,state:d});e&&(a=e)}const e=a.getState();a.addChild(t),e===D.PARTIALLY_EXPANDED.state?(a.setState({state:D.PARTIALLY_EXPANDED.state}),a.updateOptions({padstate:D.PARTIALLY_EXPANDED.state})):d!==D.COLLAPSED.state&&(a.setState({state:d}),a.updateOptions({padstate:d}))}o=!0;break}{let n=s[e],i=this.assignClone(p);if(i.resourceid=n,e-1>0){let t=s[e-1];i.relationid=t}i.occPath=s;let r=new l(i);t&&(r.addChild(t),"collapsed"!==d&&(r.setState({state:d}),r.updateOptions({padstate:d}))),t=r}}!1===o&&t&&(r.addRoot(t),c.push(t.resourceid))}const h=Date.now()-u;return console.log(" -- Duration loop on path: "+h),t.end("insertTempPaths-buildModel"),r.pushUpdate(),console.groupEnd(),{rootIds:c}},h.prototype.__parseResp=function(e,t,n){let s=i.addOrGetSection("parsePathsOcc");var o=new Map,a=[],d=[],l=!1,c=[],p=[],u=[];s.start("parseExpOcc-parseResp",{stats:!0});let h=null;for(let i=0;i<e.results.length;i++){let s=e.results[i];if(s.Path){if(h=null,a.push(s.Path),(!0===t||!0===n)&&(d.push(s.Path),s.matching_lengths))for(let e=0;e<s.matching_lengths.length;e++){const t=s.Path.slice(0,s.matching_lengths[e]);d.push(t)}}else if(s.Delta){let e=parseInt(s.Delta[0],10),i=s.Delta.slice(1);if(e>0&&h){i=h.slice(0,e).concat(i)}if(h=i,a.push(i),(!0===t||!0===n)&&(d.push(i),s.matching_lengths))for(let e=0;e<s.matching_lengths.length;e++){let t=i.slice(0,s.matching_lengths[e]);d.push(t)}}else if(s.attributes){h=null;let e=this.parseAttributes(s.attributes);e.isPADHidden&&30===e.isHiddenStateFrom&&(e.isHiddenState=r.STATES.HIDDEN,l=!0,console.log(" -- PGP in response")),o.set(e.resourceid,e)}else if(s.pgp_output)h=null,l=!0,console.log(" -- PGP in response"),c=N(s.pgp_output,"pgp_hide"),p=N(s.pgp_output,"pgp_show");else{if(s.synthesis)continue;{h=null;const e=!(!s.from||!s.to)||void 0,t=this.parseNodeOptions({node:s},e);!0===e?o.set(t.relationid,t):t.resourceid&&o.set(t.resourceid,t),void 0===s["bo.pgpshowextension.V_PGP_Show"]&&void 0===s["ro.pgpshowextension.V_PGP_Show"]||(u.push(t.resourceid),console.log(" -- PGP in response"),l||(l=!0))}}}return s.end("parseExpOcc-parseResp"),{mapNodes:o,paths:a,pathsToSelect:d,pgp:!0===l?{pgpHide:c,pgpShow:p,pgpInVPMReference:u}:void 0}},h.prototype.__managePGP=function(e,t,n){e&&n?(void 0!==e.isPADHiddenInstance||void 0!==e.isPADHiddenReference?(e.isHiddenStateFrom=r.FROM.PGP,e.isPADHidden=!1,(e.isPADHiddenInstance||e.isPADHiddenReference||e.isPADHiddenOccurrence)&&(e.isPADHidden=!0),c.isHideShowInheritActive()&&(e.isHiddenState=e.isPADHidden?r.STATES.HIDDEN:r.STATES.SHOWN,e.isLockNode=!0),e.isPADHidden?n.hide.push(e.occPath):n.show.push(e.occPath),n.hasPGP=!0):c.isHideShowInheritActive()&&t&&t.pgpInVPMReference.length>0?function(e,t){const n=new Set(t);return e.some((e=>n.has(e)))}(t.pgpInVPMReference,e.occPath)&&(e.isLockNode=!0,e.isHiddenState=e.isPADHidden?r.STATES.HIDDEN:r.STATES.SHOWN):(e.isPADHidden=!1,e.isPADHiddenReference=!1,e.isPADHiddenInstance=!1),t&&(t.pgpHide&&t.pgpHide.length&&A(t.pgpHide,e,n,!0),t.pgpShow&&t.pgpShow.length&&A(t.pgpShow,e,n,!1))):console.warn("Invalid parameters passed to __managePGP")};const E={loadingicon:`url(${s.getWebappsAssetUrl("ENOXParser","icons/32/loading22x22.gif")})`,loadingthumbnail:s.getWebappsAssetUrl("ENOXParser","icons/32/loading.gif")};return new h})),define("DS/ENOXParser/modules/PADParserOcc",["DS/ENOXParser/ParserCV","DS/PADServices/utils/Meas","DS/PADServices/utils/HideShowCtrl","DS/PADServices/utils/Iterator","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/DictionaryAccess","DS/ENOXParser/modules/common/Constants","DS/TreeModel/TreeNodeModel","DS/PADUtils/PADPredicatesNls"],(function(e,t,n,i,r,s,o,a,d){"use strict";const l={COLLAPSED:{state:"collapsed"},NO_CHILDREN:{state:"noChildren"},PARTIALLY_EXPANDED:{state:"partiallyExpanded"},EXPANDED:{state:"expanded"}},c="positionMatrix-Instance";function p(e,t){let n=e.options;n.grid&&n.grid[c]&&t.grid&&!t.grid[c]&&(t.grid[c]=null)}const u=function(e,t){return e.relationOrder-t.relationOrder};function h(e){if(e.getNodeSource()===a.NODE_SOURCE.GROUPING)return!1;if(e.hasChildren()){let t=e.getChildren();if(t.length>1){let e=t.map((e=>e.options.globaltype));return!(!e.includes("ds6w:Document")||!e.includes("ds6w:Part"))}return!1}return!1}function f(e,t){let n=t.length;if(n===e.length){for(let i=0;i<n;i++){if(e[i]!==t[i])return!0}return!1}}function g(){}let D;return g.prototype={expandWithSort:function(t){let n=this;return new Promise(((i,r)=>{e.parseExpandOcc(t).then((()=>{n._postSortSameAsNative({treeDoc:t.treeDoc,expandedNodes:t.expandedNodes}),i()}))}))},_postSortSameAsNative:function(e){let t=e.expandedNodes,n=[];for(let i=0;i<t.length;i++){let r=t[i];h(r)&&n.push(r),r.processDescendants({processNode:function(e){h(this)&&n.push(this)}}),n.length&&n.sort(((e,t)=>t.getDepth()-e.getDepth()));for(let t=0;t<n.length;t++){let i=n[t],r=i.getChildren(),s=r.map((e=>{let t=e.options;return{globalType:t.globaltype,relationOrder:t.relationOrder,child:e}})),o=s.filter((e=>"ds6w:Document"===e.globalType||"ds6w:Instance"===e.globalType)),a=s.filter((e=>"ds6w:Part"===e.globalType)),d=s.filter((e=>!a.includes(e)&&!o.includes(e)));o.length>1&&o.sort(u),a.length>1&&a.sort(u),d.length>1&&d.sort(u);let l=[];if(l=l.concat(o),l=l.concat(a),l=l.concat(d),l.length){let t=l.map((e=>e.child));if(f(t,r)){e.treeDoc.prepareUpdate();let n=i.getState();for(let e=0,n=t.length;e<n;e++)i.moveChild(t[e],e);i.setState({state:n}),e.treeDoc.pushUpdate()}}}}},parseUpdateInstance:function(e){var t=[];e.treeDoc.withTransactionUpdate((function(){e.results.forEach((function(n){var i=n.relationid;e.newRelIds&&-1!==e.newRelIds.indexOf(i)&&e.treeDoc.getRoots().forEach((function(e){var r=e.getNodesByRelId(i);r.length&&r.forEach((function(e){var i=n,r=e.getLabel();i&&"VPMInstance"===i.type&&delete i.type,i.display=r,i.label=r,i.instanceMatrix&&(i.relationid=resourceid,i.grid.instanceMatrix=i.instanceMatrix);var s=e.getState();e.updateOptions(i),d.updateNLS(e),s===l.EXPANDED&&e.setState({state:l.PARTIALLY_EXPANDED}),t.push(e)}))}))}))})),e.editCfg?e.treeDoc.refreshCfgValues({relids:e.newRelIds}):t.length&&e.treeDoc.fillAttributesAsync4VisibleNodes(t)},refreshWithInserts:async function(i){let a=t.addOrGetSection("parseRefreshOcc"),d=i.treeDoc,l=i.wsResponse;a.start("refreshWithInserts-buildModel",{stats:!0}),d.prepareUpdate();let c=e.__parseResp(l),u=c.mapNodes,h=c.paths,f=[],g=d.createUpdateCollection(),D={show:[],hide:[],others:[],hasPGP:!!c.pgp};if(console.groupCollapsed("PADParserOcc::refreshWithInserts# Nb Nodes: "+c.mapNodes.size),h.length){let t=Date.now(),r=[];for(let t=0;t<c.paths.length;t++){let a=c.paths[t];for(let t=a.length-1;t>=0;t-=2){let l=a.slice(0,t+1);f.push(l.join("/"));let u=d.getNodeFromPath(l);if(u){let i=u.options.occPath?u.options.occPath:u.getOccurencePath();if(-1===r.indexOf(i.join("/"))){r.push(i.join("/"));let o=l[t],a=e.assignClone(c.mapNodes.get(o)),h=a;if(t-1>0){let n=l[t-1],i=e.assignClone(c.mapNodes.get(n));h=e.smartAssign(a,i)}h.icons||(h.icons=[]),h.occPath=l,e.__managePGP(h,c.pgp,D),n.defaultHiddenState(h),delete h.children,u.isRoot()&&u.options.filtered&&(h.icons[0].badges={bottomRight:{iconName:"filter",fontIconSize:"1x",className:"dgv-badge"}});let f=!1;"ds6w:Part"===h.globaltype&&null===u.options.children&&(h.children=[],f=!0),p(u,h),d.smartUpdate(u,h,g),f&&(delete u.options.childComputed,u.setState({state:"collapsed"})),s.updateNLS(u)}}else{if(i.isBsdApplied)continue;let t=l.length,n=t-1,r=l.slice(0,t-2),s=d.getNodeFromPath(r);if(s&&!s.isExpanded())continue;if(s){let t=l[n],i=e.assignClone(c.mapNodes.get(t)),r=i;if(n-1>0){let t=l[n-1],s=e.assignClone(c.mapNodes.get(t));r=e.smartAssign(i,s)}s.addChild(r)}else{let t=[],n=l;for(t.push(n);1!==n.length;){let e=n.slice(0,n.length-2);t.push(e),n=e}t.sort(((e,t)=>e.length<t.length?-1:e.length>t.length?1:void 0));let i,r=t.map((t=>{let n=d.getNodeFromPath(t),i=t[t.length-1],r=e.assignClone(c.mapNodes.get(i)),s=r;if(1!==t.length){let n=t[t.length-2],i=e.assignClone(c.mapNodes.get(n));s=e.smartAssign(r,i)}return{node:n,mergedOpts:s,hasNode:void 0!==n,path:t}})),s=[],a=r.length,p=a-1;for(let e=0;e<a;e++){let t=r[e];t.hasNode?(i=t.node,delete t.mergedOpts.children,i.updateOptions(t.mergedOpts)):i&&i.isExpanded()&&(delete t.mergedOpts.children,t.mergedOpts.expandedState=o.NODE_STATES.COLLAPSED.state,e===p&&(t.mergedOpts.children=[]),s.push(i),i=i.addChild(t.mergedOpts))}s.map((e=>{e.isExpanded()||e.setState(o.NODE_STATES.COLLAPSED)}))}}}n.__clearHiddenState()}const a=Date.now()-t;console.log(" -- Duration loop on path: "+a)}else for(let e of u.values()){let t=d.getNodeFromPath([e.resourceid]);t?(t.isRoot()&&t.options.filtered&&(e.icons[0].badges={bottomRight:{iconName:"filter",fontIconSize:"1x",className:"dgv-badge"}}),t.updateOptions(e),f.push(t.getID())):console.log("Unknown root "+e.label)}return g.end(),D.hasPGP&&e.applyPGP(D,d),d.pushUpdate(),a.end("refreshWithInserts-buildModel"),r.publish({event:"ENXModel/Expand/parseDone"}),console.groupEnd(),{refreshPaths:f}}},g.prototype=Object.assign(g.prototype,e),D||(D=new g)})),define("DS/ENOXParser/modules/mixins/parser/ExpandV2LoadModel",["DS/ENOXParser/modules/common/LoadModelBuilder","DS/ENOXParser/modules/common/OfwBuilder","DS/ENOXParser/modules/common/Constants","DS/PADServices/utils/HideShowController","DS/WebappsUtils/WebappsUtils","DS/ENOXParser/modules/common/Helpers","DS/ENOXParser/modules/common/Timeout","DS/PADServices/utils/DictionaryAccess","DS/PADServices/settings/AppSettings","DS/PADServices/utils/Iterator","DS/PADServices/utils/Generics","DS/PADServices/utils/Meas","DS/PADServices/utils/GlobalModelEvents","DS/PADUtils/PADSession","DS/PADUtils/PADSettingsMgt"],(function(e,t,n,i,r,s,o,a,d,l,c,p,u,h,f){const g={loadingicon:"url("+r.getWebappsAssetUrl("ENXNav","icons/32/loading22x22.gif")+")",loadingthumbnail:r.getWebappsAssetUrl("ENXNav","icons/32/loading.gif")},D={timeoutObj:new o(void 0)};function S(e,t,n){var i=e.getNodesById(t.resourceid);if(i){for(let e=0;e<i.length;e++){let n=i[e],r=s.node.extractResAndRel(n);t.resourceid===r.resid&&t.relationid===r.relid&&(n.updateOptions(t),a.updateNLS(n),delete n.options.waiting4validation)}return i}if(n){let e=n.addChild(t);a.updateNLS(e)}else console.error("we could not find node and we are supposed to create child.")}function P(e,t,n){for(let r=0;r<n.length;r++){let s=n[r];var i=s.children;delete s.children,S(e,s,t),i&&P(e,t,i)}}function m(e){let t=e.getParent();for(;t&&!t.isRoot();)t.setState(n.NODE_STATES.PARTIALLY_EXPANDED),t=t.getParent()}function b(e,t){-1===e.indexOf(t)&&e.push(t)}function v(e,t){let n=t.getChildren();n||(n=[]);let i=n.map((function(e){let t=e.getID(),n=e.getRelationID();return n||(n=void 0),{resid:t,relid:n,node:e}}));l.iterate(e.children,(function(e){let n=function(e,t){let n=null;for(let i=0;i<e.length;i++){let r=e[i];if(r.resid===t.resourceid&&r.relid===t.relationid){n=r;break}}return n}(i,e);n?v(e,n.node):t.addChild(e)}))}function N(e,t,i){let r=function(e,t,i){let r=t.getDepth(),s=e.search({match:function(e){let t=e.nodeModel,s=t.getState(),o=t.getDepth(),a=o>=r&&o-r<=i;return s===n.NODE_STATES.PARTIALLY_EXPANDED.state&&a},useTransaction:!1});return{startDepth:r,matched:s}}(e,t,i);l.iterate(r.matched,(function(e){(e.getDepth()-r.startDepth!==i||e.hasChildren())&&e.hasChildren()?e.setState(n.NODE_STATES.EXPANDED):e.setState(n.NODE_STATES.COLLAPSED)}))}const O=function(e,t){return e.originalIndex-t.originalIndex};function A(){this._list=[],this._dict={},this._cleanup=[]}function E(e,t){l.iterate(e.children,(function(e){let n=t-1;0===n?e.children&&(e.children.length=0):E(e,n)}))}function _(e,t){let i=e.getTreeDocument(),r=e.getChildren(),s=r?r.filter((function(e,t){return!0!==e.isRelationsObjectGroupingNode})):[],o=s.slice();if(o.length){let r=s.filter((function(e){return-1===o.indexOf(e)})),a=[],d=new A;l.iterate(o,(function(e){let i=e.getID(),r=e.getRelationID()?e.getRelationID():void 0;t.children&&l.iterate(t.children,(function(t,s){t.resourceid===i&&t.relationid===r?(a.push(s),t.children&&t.children.length&&(e.hasChildren()?v(t,e):(e.addChild(t.children),e.setState(n.NODE_STATES.EXPANDED)))):a.length?d.addAfter(t,e.getParent(),e,s):d.addBefore(t,e.getParent(),e,s)})),d.cleanup(t.children,a),l.iterate(a,(function(e){t.children.splice(e,1)})),a.length=0})),l.iterate(r,(function(t){e.removeChild(t)})),d.dispatch(i)}else for(var a=0;a<s.length;a++){let t=s[a];e.removeChild(t)}}function w(e,t){let i=e.getState();if(!0===e.options.retrievedFromFocus?(delete e.options.retrievedFromFocus,"expanding"===e.getState()&&e.setState(n.NODE_STATES.EXPANDED)):void 0!==t.expandedState?i!==t.expandedState&&e.setState({state:t.expandedState}):"expanding"===i?e.setState(n.NODE_STATES.EXPANDED):"collapsed"===i&&e.setState(n.NODE_STATES.COLLAPSED),e.hasChildren()){let n=e.getChildren();n&&l.iterate(n,(function(e){let n=e.getID(),i=e.getRelationID();i||(i=void 0);let r=function(e,t,n){let i;return l.iterate(e.children,(function(e){e.resourceid===t&&e.relationid===n&&(i=e)})),i}(t,n,i);r&&w(e,r)}))}}function x(e,t,i){e.expandedState=t>i?n.NODE_STATES.EXPANDED.state:n.NODE_STATES.COLLAPSED.state,e.children&&l.iterate(e.children,(function(e){x(e,t,i+1)}))}function C(e,t){let n=function(e){let t=e.getChildren();return t||(t=[]),t.filter((function(e,t){return!0!==e.isRelationsObjectGroupingNode}))}(e).map((function(e,t){let n=e.getID(),i=e.getRelationID();return i||(i=void 0),{resid:n,relid:i,node:e,nodeIndex:t}})),i=[];t.children&&t.children.length&&(i=t.children.map((function(e,t){let i={childOpts:e,childIndex:t},r=n.filter((function(t){return t.resid===e.resourceid&&t.relid===e.relationid}));return r.length&&(i.finders=r),i}))),l.iterate(i,(function(t){if(t.finders){if(1===t.finders.length){let e=t.finders[0],n=c.clone(t.childOpts);delete n.children,e.node.updateOptions(n),C(e.node,t.childOpts)}}else e.addChild(t.childOpts,t.childIndex)}))}function I(e){var t=e.getChildren();for(t=t||[];t.length;){let n=t[0];e.removeChild(n)}}function y(e,t){let n;for(let i=0;i<e.length;i++){if(n=e[i].getNodeByPath(t,void 0,void 0,!0),n)return n}return n}function T(e){return{typeMap:[],typeMapThumbs:[],sampleRscId:[],thumbsRscId:[],timeoutObj:e}}function R(e){let t=e.getChildren();return(t?t.filter((function(e,t){return!0!==e.isRelationsObjectGroupingNode})):[]).length>0}function L(e,t,n){let i;for(let r=0;r<e.length;r++){let s=e[r];if(s.getID()===t&&s.getRelationID()===n){i=s;break}}return i?{isFound:!0,node:i,index:e.indexOf(i)}:{isFound:!1}}function k(){}return A.prototype={_add:function(e,t,n,i,r){let s=this._getKeyFromData(e);if(void 0!==this._dict[s]){let e=this._dict[s],t=this._list[e];"before"===r&&(t.goal=r,t.originalIndex=i,t.siblingChild=n)}else{let o={goal:r,originalIndex:i,parentNode:t,siblingChild:n,childData:e};this._list.push(o),this._dict[s]=this._list.length-1}},_getKeyFromData:function(e){let t,n=e.resourceid,i=e.relationid;return i?t=n+"_"+i:(i=void 0,t=n),t},addBefore:function(e,t,n,i){this._add(e,t,n,i,"before")},addAfter:function(e,t,n,i){this._add(e,t,n,i,"after")},cleanup:function(e,t){let n=t.map((function(t){return e[t]})),i=this;this._cleanup=this._cleanup.concat(n.map((function(e){let t=i._getKeyFromData(e),n=i._dict[t];return void 0!==n?{found:!0,index:n,key:t}:{found:!1}})))},dispatch:function(e){let t=this._cleanup.filter((function(e){return e.found}));if(t.length){let e=this;t.sort((function(e,t){return t.index-e.index})),l.iterate(t,(function(t){e._list.splice(t.index,1),delete e._dict[t.key]}))}if(this._list.length){let t=s.divideAndConquer(this._list,D,{befores:function(e){return"before"===e.goal},afters:function(e){return"after"===e.goal}});t.befores.sort(O),t.afters.sort(O),l.iterate(t.befores,(function(t){let n=t.childData,i=t.siblingChild._getLocalID();e.withTransactionUpdate((function(){t.parentNode.addChild(n,i)}))})),l.iterate(t.afters,(function(t){let n=t.childData;e.withTransactionUpdate((function(){t.parentNode.addChild(n)}))}))}}},k.prototype={parseExpandLoadModel:function(t){let r=p.buildOrGetSection("parser.expandLoadModel"),c="parseExpandLoadModel_"+(-1===t.expandLevel?"expandAll":"expand"+t.expandLevel),g=r.create(c,{stats:!0}),D=this;return new Promise((function(c,p){let S=new Map,P=new Map,b=t.expandedNode,v=t.wsResponse.results,O=t.treeDoc.isGroupingApplied(),A=[];A=b?[b]:t.expandedNodes;let k,H=A.filter((function(e){return!e.isGroupingNode}));H.length&&(k=H.map((function(e){return e.getID()})));let M=new e({expandIds:k,expandAll:-1===t.expandLevel,findInCtx:!0===t.findInCtx||!0===t.selectFromTagger,filter:!0===t.filter}),F=d.getSetting("parse_timeout"),G=parseInt(F),X=new o(G),U=T(X);if(v){let e=s.divideAndConquer(v,U,s.MAPS.EXPANDV2),o=new Map;Promise.resolve().then((function(){f.getSetting("pgpFromServer")&&l.iterate(e.pgpOutputs,(function(e){X.check(),e.pgp_output.pgp_hide&&l.iterate(e.pgp_output.pgp_hide,(function(e){o.set(e,!0)})),e.pgp_output.pgp_show&&l.iterate(e.pgp_output.pgp_show,(function(e){o.set(e,!1)}))})),l.iterate(e.references,(function(e){if(X.check(),D.__processReference({node:e,nodesMap:S,builder:M}),O){var n=t.treeDoc.getGroupingNodesList(e.resourceid);l.iterate(n,(function(e){D.__processGroupingNode({node:e,parent:e.getParent().getID(),nodesMap:S,builder:M})}))}})),l.iterate(e.instances,(function(e){X.check(),D.__processInstance({node:e,nodesMap:S,builder:M,expandLevel:t.expandLevel,mode:t.mode,pgpHideOccurrencesMap:o,treeDoc:t.treeDoc,expandedNodes:A,nodesHiddenMap:P})})),t.treeDoc.clearCachedHiddenNodes();var d=r.create("builder_Correct",{stats:!0});if(M.correct(D),M.correctPgpOcc(D,o),d.end(),l.iterate(A,(function(e){let o=s.node.extractResAndRel(e);var d=M.getOptions(o.resid,o.relid);let c=!1,p=!0;d&&t.filter&&t.expandLevelRequest!==t.expandLevel?(x(d,t.expandLevelRequest,0),R(e)?(w(e,d),c=!0,_(e,d),N(t.treeDoc,e,t.expandLevel)):0!==t.expandLevelRequest&&(c=!0,E(d,t.expandLevelRequest),e.addChild(d.children))):R(e)&&t.filter&&d&&(w(e,d),c=!0,_(e,d),N(t.treeDoc,e,t.expandLevel));let u=!1;if(d&&e.hasChildren()&&R(e)&&0!==t.expandLevel&&(!t.findInCtx&&!t.selectFromTagger&&!t.filter||O)){var f=r.create("treenodemodel_removeChildren",{stats:!0});-1!==t.expandLevel||O?(u=!0,c=!0,_(e,d),function(e,t,i){let r=function(e,t,n){let i=t.getDepth(),r=t.search({match:function(e){let t=e.nodeModel.getDepth();return t>=i&&t-i<=n},useTransaction:!1});return{startDepth:i,matched:r}}(0,t,i);l.iterate(r.matched,(function(e){let t=e.getDepth()-r.startDepth;(t!==i||e.hasChildren())&&e.hasChildren()?t===i?e.setState(n.NODE_STATES.COLLAPSED):e.setState(n.NODE_STATES.EXPANDED):e.setState(n.NODE_STATES.COLLAPSED)}))}(t.treeDoc,e,t.expandLevel)):(!function(e,t){let n=e.getChildren(),i=n?n.filter((function(e,t){return!0!==e.isRelationsObjectGroupingNode})):[];t.children.sort((function(e,n){let r=L(i,e.resourceid,e.relationid),s=L(i,n.resourceid,n.relationid);return r.isFound&&s.isFound?(r.dataIndex=t.children.indexOf(e),s.dataIndex=t.children.indexOf(n),r.dataIndex===r.index&&s.dataIndex===s.index?0:r.index>s.index?1:r.index<s.index?-1:void 0):0}))}(e,d),I(e)),f.end()}if(e.hasChildren()&&(t.findInCtx&&t.isFindDialog||t.selectFromTagger)&&(C(e,d),c=!0),d){let r;if(c||(-1!==t.expandLevel&&t.filter&&(I(e),x(d,t.expandLevelRequest,0)),d.children&&(r=d.children,delete d.children),i.cleanupOptions(e,d),null===d.children&&function(e){let t=e.getChildren();return(t?t.filter((function(e,t){return!0===e.isRelationsObjectGroupingNode})):[]).length>0}(e)&&(p=!1,delete d.children),e.updateOptions(d)),a.updateNLS(e),e.isRoot()){!0!==t.FBIProxy.HasFilter(e.getID()).hasFilter||h.isAuthoring()&&!e.keepFilterBadge?s.node.clearBadges(e):s.node.setFilterBadge(e)}if(c){let t=e.getRoot();t&&t.cleanUpPathes()}else if(r){t.treeDoc.withTransactionUpdate((function(){t.treeDoc.loadModel(r,e),u&&N(t.treeDoc,e,t.expandLevel);let n=e.getRoot();n&&n.cleanUpPathes()}))}else p&&(e.updateOptions({children:null}),e.setState(n.NODE_STATES.NOCHILDREN));if(P.size>0)for(const[e,n]of P){let i=t.treeDoc.getNodesById(e);for(let e=0;e<i.length;e++){let t=i[e];for(let e=0;e<n.length;e++)s.array.compare(t.getOccurencePath(),n[e].occurencePath)&&t.options.isHiddenState!==n[e].isHiddenState&&(t.options.isHiddenState=n[e].isHiddenState)}}if(D.isHiddenState||i.shouldeRecalculate(e)){delete D.isHiddenState;let e=[];t.treeDoc.processDescendants({processNode:function(){i.gatherParentsIfHidden(e,this)}}),i.calculateParents(e,!0)}}})),!0===t.selectPaths){var p=r.create("selectPaths",{stats:!0});l.iterate(e.paths,(function(e){if(e.matching_lengths)for(let n=0;n<e.matching_lengths.length;n++){var i=e.Path.slice(0,e.matching_lengths[n]);(r=y(A,i))?(r.select(),r.isRoot()||!t.findInCtx&&!t.selectFromTagger||m(r)):console.warn("Unknown path "+JSON.stringify(i))}var r;(r=y(A,e.Path))?(r.select(),(t.findInCtx||t.selectFromTagger)&&(r.hasChildren()&&r.setState(n.NODE_STATES.PARTIALLY_EXPANDED),r.isRoot()||m(r))):console.warn("Unknown path "+JSON.stringify(e))})),p.end()}g.end(),u.publish({event:"ENXModel/Expand/parseDone"}),c()})).catch((function(e){p(e)}))}}))},addPathsUpdateTempNodes:function(t){let n=p.addOrGetSection("parser"),r=n.create("parseExpandLoadModel",{stats:!0}),a=this;return new Promise((function(d,c){let p=new Map,u=t.wsResponse.results,h=new e({expandAll:-1===t.expandLevel,addPaths:!0});if(t.wsResponse.timeoutOccurs)console.warn("Timeout occurs on popluating temp nodes....failure path...");else{let e=T(new o(void 0)),c=s.divideAndConquer(u,e,s.MAPS.EXPANDV2),f=new Map;Promise.resolve().then((function(){l.iterate(c.references,(function(e){a.__processReference({node:e,nodesMap:p,builder:h})})),l.iterate(c.instances,(function(e){a.__processInstance({node:e,nodesMap:p,builder:h,expandLevel:t.expandLevel})})),n.start("builder_Correct",{stats:!0}),h.correct(a),h.correctPgpOcc(a,f),n.end("builder_Correct");let e=[],o=[];t.treeDoc.withTransactionUpdate((function(){l.iterate(t.idsToFetch,(function(n){var r=n;let a=t.treeDoc.getNodesById(r);l.iterate(a,(function(n){let a=s.node.extractResAndRel(n),d=h.getOptions(a.resid,a.relid);if(d){let n=d.children;delete d.children,S(t.treeDoc,d),e.push(r),n&&n.length&&l.iterate(n,(function(e){let n=e.children;delete e.children;let r=S(t.treeDoc,e);l.iterate(r,(function(e){i.gatherParentsIfHidden(o,e)})),n&&n.length&&l.iterate(r,(function(e){P(t.treeDoc,e,n)}))}))}}))})),i.calculateParents(o,!1,!0),!0===t.selectPaths&&l.iterate(c.paths,(function(e){t.treeDoc.getNodeByOccurencePath(e)?e.select():console.warn("Unknown path "+JSON.stringify(e))}))})),r.end(),d({nodesId:e})}))}}))},buildTemporaryBranches:function(e){if(!UWA.is(e.treeDoc,"object")||!UWA.is(e.paths,"array"))throw new Error("Invalid input parameters");var t=[],n=[],i=[],r=[],s=[],o=e.treeDoc,a=e.state?e.state:"partiallyExpanded",d=e.paths;let l=this;return o.withTransactionUpdate((function(){d.forEach((function(d){var c,p=null,u=o.getRoots(),h=0;for(c=0;c<u.length&&null===p;c++)if(d[0]===u[c].getID()){r.push(d[0]);var f=(p=u[c]).getNodeByPath(d,void 0,void 0,!0);f&&(p=f,h=d.indexOf(p.getID()))}if(!0===e.temporaryRoot&&null===p){var D={resourceid:d[0],label:l.options.nls.loadingText,icons:[{iconPath:g.loadingicon}],thumbnail:g.loadingthumbnail,alternText:l.options.nls.loadingText,waiting4validation:!0,parseV2:!0};p=new e.nodeModelClass(D),o.addRoot(p),-1===t.indexOf(d[0])&&t.push(d[0]);var S=o.getRoots().length;o.getModelEvents().publish({event:"onRootAdded",data:{nb_root:S,added_node:p}})}if(p)if(p.getID()===d[d.length-1]){if(!0!==e.forceCollapsed&&null!==p.getRoot()){var P=p.reverseExpand({state:a});P.ids.length&&(t=t.concat(P.ids)),P.relids.length&&(s=s.concat(P.relids))}}else for(var m=h+1;m<d.length;m+=2){var v=d[m],N=d[m+1],O={resourceid:N,relationid:v,label:l.options.nls.loadingText,icons:[{iconPath:g.loadingicon}],thumbnail:g.loadingthumbnail,alternText:l.options.nls.loadingText,waiting4validation:!0},A=new e.nodeModelClass(O),E=p.getState();p.addChild(A),"collapsed"===E?(a!==E&&(p.setState({state:a}),p.options.padstate=a),p.childValidationChecker()):"partiallyExpanded"===E&&(p.setState({state:E}),p.options.padstate=E,b(n,N),b(i,v)),p=A,b(t,N),b(s,v)}}))})),{ids_to_fetch:t,relationids:s,rootsAlreadyLoaded:r,visibleNodesIds:n,visibleNodesRelIds:i}},ofwPrep:function(e){let n=this;return new Promise((function(i,r){let o=new Map,a=e.wsResponse.results,d=new t({expandAll:-1===e.expandLevel}),c=s.divideAndConquer(a,{},s.MAPS.OFW);l.iterate(c.references,(function(e){n.__processReference({node:e,nodesMap:o,builder:d})})),l.iterate(c.instances,(function(t){n.__processInstanceOfw({node:t,nodesMap:o,builder:d,expandLevel:e.expandLevel})})),d.correct(n);let p=[];for(let t=0;t<e.rootIds.length;t++){let n=d.getReference(e.rootIds[t]);p.push(n)}i(p)}))},refresh:function(t){let n=p.addOrGetSection("parser");n.start("refresh",{stats:!0});let r=this,a=t.roots;t.visibles;return new Promise((function(d,c){let p=new Map,u=t.wsResponse.results,g=new e({expandIds:a.map((function(e){return e.getID()})),expandAll:-1===t.expandLevel,isRefresh:!0});if(!u)return r.processErrors(t.wsResponse.errors,"refresh"),void d();let D=T(new o(void 0)),S=s.divideAndConquer(u,D,s.MAPS.EXPANDV2),P=new Map,m=[];Promise.resolve().then((function(){f.getSetting("pgpFromServer")&&l.iterate(S.pgpOutputs,(function(e){e.pgp_output.pgp_hide&&l.iterate(e.pgp_output.pgp_hide,(function(e){P.set(e,!0)})),e.pgp_output.pgp_show&&l.iterate(e.pgp_output.pgp_show,(function(e){P.set(e,!1)}))})),l.iterate(S.references,(function(e){r.__processReference({node:e,nodesMap:p,builder:g})})),l.iterate(S.instances,(function(e){r.__processInstance({node:e,nodesMap:p,builder:g,doNotCalcByChildren:m,expandLevel:t.expandLevel})})),n.start("builder_Correct",{stats:!0}),g.correct(r),g.correctPgpOcc(r,P);for(let n=0;n<a.length;n++){let d=a[n];r.options.modules.NodeUtils.recursiveUpdateForRefresh(t.treeDoc,d,g.getReference(d.getID())),!0!==t.FBIProxy.HasFilter(d.getID()).hasFilter||h.isAuthoring()&&!d.keepFilterBadge?s.node.clearBadges(d):s.node.setFilterBadge(d);var e=[],o=[];for(let t of P.keys()){let n=d.getNodesById(t[0])[0];if(n){let i=n.getNodeByPath(t);i&&(P.get(t)?e.push(i):o.push(i))}}if(r.isHiddenState||f.getSetting("pgpFromServer")){delete r.isHiddenState,i.updateHideShowStatus(e,o);const n=function(e){return{resid:e.options.resourceid,relid:e.options.relationid}};m=m.concat(e.map(n)).concat(o.map(n));let s=[];t.treeDoc.processDescendants({processNode:function(){i.gatherParentsIfHiddenOrShown(s,this)}}),s.sort((function(e,t){return t.getDepth()-e.getDepth()}));for(let e=0;e<m.length;e++){let t=m[e],n=s.filter((function(e){return e.options.resourceid===t.resid&&e.options.relationid===t.relid}));n.length&&s.splice(s.indexOf(n[0]),1)}t.treeDoc.withTransactionUpdate((()=>{t.treeDoc.withTransactionUpdate((()=>{i.calculateParents(s,!0)}))}))}}t.treeDoc.withTransactionUpdate((()=>{t.treeDoc.withTransactionUpdate((()=>{i.calculateParents(a,!0)}))})),n.end("builder_Correct"),n.end("refresh"),d()}))}))},__processReference:function(e){var t=this.parseNodeOptions(e);t.isPADHidden=t.isPADHiddenReference,e.builder.addReference(t),e.nodesMap.set(t.resourceid,t)},__processGroupingNode:function(e){var t=this.parseGroupingNodeOptions(e.node.options);t.isGroupingNode=!0,e.builder.addReference(t),e.nodesMap.set(t.resourceid,t),e.builder.addChild(e.parent,t,{mode:"noChildComputed"})},__processInstance:function(e){var t=this.parseNodeOptions(e,!0);delete t.type;var r=e.nodesMap.get(t.resourceid),o=this.smartAssign(r,t);if(o.children&&o.children.length&&(o.childComputed=!0),"noChildComputed"===e.mode&&delete o.childComputed,void 0!==e.pgpHideOccurrencesMap){var a=e.pgpHideOccurrencesMap;for(const[e,n]of a.entries()){e[e.length-1]===t.resourceid&&(o.isPADHiddenOccurrence=n)}}void 0!==o.isPADHiddenOccurrence?(o.isPADHidden=o.isPADHiddenOccurrence,o.isHiddenStateFrom=i.FROMS.PGP):void 0!==o.isPADHiddenInstance?(o.isPADHidden=o.isPADHiddenInstance,o.isHiddenStateFrom=i.FROMS.PGP):void 0!==o.isPADHiddenReference&&(o.isPADHidden=o.isPADHiddenReference,o.isHiddenStateFrom=i.FROMS.PGP);let d=!0;if(e.treeDoc){var l=e.treeDoc.getNodesByRelId(e.node.resourceid);if(l.length>0){if(l.length>1)for(let t=0;t<l.length;t++){let n=l[t].getID();if(l[t].options.isHiddenState!==i.STATES.HIDDEN){let i={isHiddenState:l[t].options.isHiddenState,occurencePath:l[t].getOccurencePath()};if(e.nodesHiddenMap.get(n)){const t=e.nodesHiddenMap.get(n);e.nodesHiddenMap.set(n,[...t,i])}else e.nodesHiddenMap.set(n,[i])}}for(let e=0;e<l.length;e++){var c=l[e].options.isHiddenState;c!==i.STATES.HIDDEN&&c!==i.STATES.MIXED||(d=!1,o.isHiddenState=c)}}let t=e.treeDoc.options.hiddenNodes;if(t&&t.size>0){let n=e.expandedNodes;for(let r=0;r<n.length;r++){let s=n[r].isRoot()?n[r]:n[r].getRoot(),a=t.get(s);if(a&&a.length>0)for(let t=0;t<a.length;t++)e.node.resourceid===a[t].options.relationid&&(d=!1,o.isHiddenState=i.STATES.HIDDEN)}}const n=e.treeDoc.getNodesByRelId(e.node.resourceid);n.length>0&&n.at(0).options.isHiddenState===i.STATES.SHOWN&&(d=!1,o.isHiddenState=i.STATES.SHOWN)}d&&i.defaultHiddenState(o),void 0!==o.isPADHidden&&(e.doNotCalcByChildren&&e.doNotCalcByChildren.push({resid:o.resourceid,relid:o.relationid}),this.isHiddenState=!0);var p=void 0;if(e.treeDoc){if(e.treeDoc.isGroupingApplied()){let t=e.treeDoc.getGroupingNodeV2(e.node.from,o);p=t.groupNode,t.shouldBeNewGroup&&(o._shouldBeNewGroup=!0,o._actualGroupKey=t.actualGroupKey)}}p?(e.nodesMap.get(p.options.resourceid)||(p.options.contentRetrieved=!0,p.options.expandedState=n.NODE_STATES.EXPANDED.state,this.__processGroupingNode({node:p,parent:o.from,nodesMap:e.nodesMap,builder:e.builder})),s.array.unique(e.expandedNodes,p),e.builder.addChild(p.options.resourceid,o)):e.builder.addChild(o.from,o),-1===e.expandLevel&&(o.childComputed=!0)},__processInstanceOfw:function(e){var t=this.parseNodeOptions(e,!0);e.builder.addInstance(t)},processErrors:function(e,t){t||console.warn("please pass context"),l.iterate(e,(function(e){e.code}))}},k})),define("DS/ENOXParser/modules/TwoDParser",["DS/ENOXParser/modules/mixins/parser/ParseAttributes","DS/ENOXParser/modules/mixins/parser/ParseFetch","DS/ENOXParser/modules/mixins/parser/ExpandV2LoadModel","DS/ENOXParser/modules/mixins/parser/MergeObj"],(function(e,t,n,i){"use strict";function r(){}var s;return r.prototype={setup:function(e){return this.options=e,new Promise((function(e,t){e()}))}},r.prototype=Object.assign(r.prototype,e.prototype),r.prototype=Object.assign(r.prototype,t.prototype),r.prototype=Object.assign(r.prototype,n.prototype),r.prototype=Object.assign(r.prototype,i.prototype),s||(s=new r),s})),define("DS/ENOXParser/modules/PADParser",["UWA/Core","DS/PADServices/utils/Iterator","DS/ENOXParser/modules/TwoDParser","DS/ENOXParser/modules/common/Constants","DS/PADServices/utils/AttributesMgt","DS/PADServices/utils/DictionaryAccess"],(function(e,t,n,i,r,s){const o="ds6w:label-Instance";function a(t,i,r){let s,a,d=t.relationid;if(s=i[t.resourceid],s&&(a=n.parseAttributes(s.attributes),a.relationid=d,r&&d)){let e=n.parseAttributes(s.attributes);a.grid[o]=e.label}return e.clone(a,!1)}function d(e,t,n,i,r,s){let o,a,d,l,c,p,u,h,f=function(e,t){for(var n={beforeNodes:[],afterNodes:[],afterPosition:-1},i=e.length;i--;){child=e[i];var r=child._options.relationid;if(r===t.after){n.afterNodes=[child],n.afterPosition=i;break}if(r===t.before){n.beforeNodes=[child];break}}return n};for(let i=e.length;i--;){o=e[i],d=t[o];for(let e=d.length;e--&&(l=d[e],a=l.getChildren(),a&&0!==a.length);){u=n[o],p=a[0];for(var g=u.length;g--&&(h=u[g],c=h.resourceid,h.ordering);){var D,S=h.ordering.before,P=h.ordering.after,m=!(!S||""===S),b=!(!P||""===P),v=f(a,h.ordering),N=v.beforeNodes.length>0,O=-1!==v.afterPosition;m&&b?(N&&(r[c]={before:v.beforeNodes}),O&&(D=v.afterPosition+2,r[c]={after:[D]})):m?N?r[c]={before:v.beforeNodes}:p&&(r[c]={before:[p]}):b&&O&&(D=v.afterPosition+2,r[c]={after:[D]})}}}}function l(){}let c;return l.prototype={insertNodes:function(t){let n={transactions:[]},l=-1!==r.getAvailableColumns().indexOf(o),c=t.treedocument,p=c.getRoots(),u=t.response.results,h=e.clone(t.insert_parameters,!1),f=Object.keys(h),g={},D={},S={};!function(e,t){for(var n,i,r,s=e.length;s--;)for(var o=(i=(n=e[s]).attributes).length;o--;)if("resourceid"===(r=i[o]).name){t[r.value]=n;break}}(u,D),function(e,t,n){let i,r;for(let s=e.length;s--;){r=e[s];for(let e=t.length;e--;)if(i=t[e].getNodesById(r),i.length>0){n[r]=i;break}}}(f,p,g),d(f,g,h,0,S);Date.now();for(var P,m=f.length;m--;){P=f[m];var b=[],v={insertExisting:{modified:[],inserted:[],created:[]}},N=g[P],O=h[P];if(c.withTransactionUpdate((function(){for(var e,t,n=O.length;n--;){node_2_insert=O[n],t=node_2_insert.resourceid,e=a(node_2_insert,D,l);for(var r=N.length;r--;){let n=N[r];var o=new c.options.nodeModelClass(e);if(node_2_insert.ordering){var p=S[t];p?p.before?n.insertBefore(o,p.before[0]):p.after?n.addChild(o,p.after[0]):n.addChild(o):n.addChild(o)}else n.addChild(o);n.options.padstate!==i.NODE_STATES.EXPANDED.state&&(n.setState(i.NODE_STATES.PARTIALLY_EXPANDED),n.options.padstate=i.NODE_STATES.PARTIALLY_EXPANDED.state),n.options.padstate===i.NODE_STATES.NOCHILDREN.state&&(n.setState(i.NODE_STATES.EXPANDED),n.options.padstate=i.NODE_STATES.EXPANDED.state),(n._isExpanded||n._expandState===i.NODE_STATES.EXPANDING.state)&&(n.options.padstate=i.NODE_STATES.EXPANDED.state,n.setState(i.NODE_STATES.EXPANDED)),v.insertExisting.modified.push(n.getID()),v.insertExisting.inserted.push(o.getID()),b.push(o.getRelationID()),v.insertExisting.created.push(o.getRelationID()),v.insertExisting.withContext=!1,s.updateNLS(o),d(f,g,h,0,S)}}})),b.length){var A=[];b.forEach((function(e){var t=c.getNodesByRelId(e);t&&A.push(t[0].getOccurencePath())})),v.insertExisting.inserted=A}n.transactions.push(v)}return n},insertNodes_old:function(t){var i={transactions:[]},o=r.getAvailableColumns(),a=t.treedocument,d=a.getRoots(),l=t.response.results;console.log("replace insert response_results",l);var c,p,u,h=e.clone(t.insert_parameters,!1),f=Object.keys(h),g={},D={},S={};Date.now();function P(){for(var e,t,n,i,r,s,o,a=function(e,t){for(var n={beforeNodes:[],afterNodes:[],afterPosition:-1},i=e.length;i--;){var r=(p=e[i])._options.relationid;if(r===t.after){n.afterNodes=[p],n.afterPosition=i;break}if(r===t.before){n.beforeNodes=[p];break}}return n},d=f.length;d--;){e=f[d];for(var l=(n=g[e]).length;l--&&((t=n[l].getChildren())&&0!==t.length);){s=h[e],r=t[0];for(var c=s.length;c--&&(i=(o=s[c]).resourceid,o.ordering);){var u,D=o.ordering.before,P=o.ordering.after,m=!(!D||""===D),b=!(!P||""===P),v=a(t,o.ordering),N=v.beforeNodes.length>0,O=-1!==v.afterPosition;m&&b?(N&&(S[i]={before:v.beforeNodes}),O&&(u=v.afterPosition+2,S[i]={after:[u]})):m?N?S[i]={before:v.beforeNodes}:r&&(S[i]={before:[r]}):b&&O&&(u=v.afterPosition+2,S[i]={after:[u]})}}}}function m(t){var i,r,s=t.relationid;if((i=D[t.resourceid])&&((r=n.parseAttributes(i.attributes)).relationid=s,-1!==o.indexOf("instanceName")&&s&&D[s])){var a=n.parseAttributes(D[s].attributes);r.grid.instanceName=a.label}return e.clone(r,!1)}!function(){for(var e,t,n=f.length;n--;){t=f[n];for(var i=d.length;i--;)if((e=d[i].getNodesById(t)).length>0){g[t]=e;break}}}(),function(){for(var e,t,n,i,r=l.length;r--;){e=l[r],console.log("insert result",e);for(var s=(t=e.attributes).length;s--;)if("resourceid"===(n=t[s]).name){i=n.value,D[i]=e;break}}}(),P();Date.now();for(var b,v=f.length;v--;){b=f[v];var N=[],O={insertExisting:{modified:[],inserted:[],created:[]}},A=g[b],E=h[b];if(a.withTransactionUpdate((function(){for(var e,t,n=E.length;n--;){t=(u=E[n]).resourceid,e=m(u);for(var i=A.length;i--;){c=A[i];var r=new a.options.nodeModelClass(e);if(u.ordering){var o=S[t];o?o.before?c.insertBefore(r,o.before[0]):o.after?c.addChild(r,o.after[0]):c.addChild(r):c.addChild(r)}else c.addChild(r);"expanded"!==c.options.padstate&&(c.setState({state:"partiallyExpanded"}),c.options.padstate="partiallyExpanded"),"noChildren"===c.options.padstate&&(c.setState({state:"expanded"}),c.options.padstate="expanded"),(c._isExpanded||"expandState"===c._expandState)&&(c.options.padstate="expanded",c.setState({state:"expanded"})),O.insertExisting.modified.push(c.getID()),O.insertExisting.inserted.push(r.getID()),N.push(r.getRelationID()),O.insertExisting.created.push(r.getRelationID()),O.insertExisting.withContext=!1,s.updateNLS(r),P()}}})),i.transactions.push(O),N.length){var _=[];N.forEach((function(e){var t=a.getNodesByRelId(e);t&&_.push(t[0].getOccurencePath())})),i.transactions[0].insertExisting.inserted=_}}return i},insertNodesExpand:function(e){return new Promise((function(r,s){let o=[];t.iterate(e.expandedNodes,(function(e){let t=e.getChildren();t&&t.length&&(o=o.concat(t))})),n.parseExpandLoadModel(e).then((function(){t.iterate(e.expandedNodes,(function(e){t.iterate(e.getChildren(),(function(e){-1===o.indexOf(e)&&e.select()})),e.setState(i.NODE_STATES.PARTIALLY_EXPANDED),delete e.options.childComputed})),r()}))}))},updateInstances:function(e){var i=[];e.treedocument.withTransactionUpdate((function(){t.iterate(e.response.results,(function(r){if(r.attributes){var s="";let o=r.attributes.filter((function(e){return"resourceid"==e.name}));o.length&&(s=o[0].value);e.newRelIds&&-1!==e.newRelIds.indexOf(s)&&t.iterate(e.treedocument.getRoots(),(function(o){var a=o.getNodesByRelId(s);a.length&&t.iterate(a,(function(t){var o=function(t,i){var r=n.parseAttributes(i.attributes);return Generics.checks.function(e.treedocument.filterAttributesForUpdate)&&(r=e.treedocument.filterAttributesForUpdate({node:t,node_opts:r})),r&&0===r.relcount&&(r.children=null),r}(t,r),a=t.getLabel();delete o.resourceid,o.display=a,o.label=a,o.instanceMatrix&&(o.relationid=s,o.grid.instanceMatrix=o.instanceMatrix);var d=t.getState();t.updateOptions(o),PADPredicatesNls.updateNLS(t),d===NODE_STATE.EXPANDED&&t.setState({state:NODE_STATE.PARTIALLY_EXPANDED}),i.push(t)}))}))}}))})),e.editCfg?e.treedocument.refreshCfgValues({relids:e.newRelIds}):i.length&&e.treedocument.fillAttributesAsync(i)}},l.prototype=Object.assign(l.prototype,n),c||(c=new l)}));