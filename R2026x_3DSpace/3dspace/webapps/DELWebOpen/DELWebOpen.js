define("DS/DELWebOpen/ContextHelper",[],(function(){"use strict";const e={getMfgContext:function(t,n,i){var o={context:[],ids:[]},r={},l=e.getProcessContext(t,n);if(l&&l.context)for(let e of l.context)if(e.scope===i&&e.implementedScope){o.context=e.implementedScope,e.implementedScope.forEach((e=>{r[e.id]||(r[e.id]=!0,o.ids.push(e.id))}));break}return o},getMfgInstallContext:function(t,n,i,o){var r={context:[],ids:[]},l=e.getMfgContext(t,n,i);if(l&&l.context)for(let e of l.context)o===e.id&&UWA.is(e.context,"array")&&(r.context=e.context,e.context.forEach((e=>{-1===r.ids.indexOf(e.parent)&&r.ids.push(e.parent)})));return r},getMfgInstallOccurrences:function(t,n,i,o){var r={context:[],ids:[]},l=e.getMfgContext(t,n,i);if(l)for(let e of l.context)o===e.id&&e.context&&(r.context=e.context,r.ids=r.ids.concat(e.context.map((e=>`${e.parent}_${e.instance}_${o}`))));return r},getMfgInstallOccurrencesForContext:function(t,n,i,o,r){var l=e.getMfgInstallOccurrences(t,n,i,o);return l.context=l.context.filter((e=>e.parent===r)),l.ids=l.ids.filter((e=>e.includes(r))),l},getProcessContext:function(t,n){var i={context:[],ids:[]},o=e.getContextScope(t,n);return o&&(i.context=o,i.ids=o.map((e=>e.scope))),i},getProcessContextOccurrences:function(t,n,i){var o={context:[],ids:[]},r=e.getProcessContext(t,n);if(r&&r.context)for(let e of r.context)if(e.scope===i){o.context=r.context,o.ids=e.contextOccurrence.slice();break}return o},getContextScope:function(e,t){var n,i;return e&&UWA.is(e.member,"array")&&t&&e.member.forEach((e=>{(i=e.find((function(e){return e.refid===t})))&&(n=i.contextScope)})),n},getAllPhysicalIds:function(t,n){var i=n?[n]:[],o=e.getContextScope(t,n);return o&&o.forEach((e=>{i.push(e.scope),e.contextOccurrence&&e.contextOccurrence.forEach((e=>{i=i.concat(e.split("_"))})),e.implementedScope&&e.implementedScope.forEach((e=>{i.push(e.id),e.context&&e.context.forEach((e=>{i.push(e.parent),i.push(e.instance)}))}))})),i},getInstallInstanceIds:function(t,n){var i=[],o=e.getContextScope(t,n);return o&&o.forEach((e=>{e.implementedScope&&e.implementedScope.forEach((e=>{e.context&&e.context.forEach((e=>{i.push(e.instance)}))}))})),i}};return e})),define("DS/DELWebOpen/Helper",["DS/DELWebComponentManager/DELWebComponentManager","text!DS/DELWebOpen/assets/json/ServicePayloads.json","text!DS/DELWebOpen/assets/json/Constants.json","i18n!DS/DELWebOpen/assets/nls/OpenControl"],(function(e,t,n,i){"use strict";const o=JSON.parse(n).EffectivityAttribute;let r={computeVolumeFilter:async function(n,o,l={}){let s,a,c,p,d=JSON.parse(t),u=e.getComponent("Utils");return n&&o&&(s=await async function(e){let t,n,i=d.expandV2;return i.batch.expands[0].root.physical_id=e,t=await u.getProgressiveExpand(i),t&&t.results&&t.results.length>0&&(n=t.results[0]),n}(o),s&&s.boundingbox&&(a=d.publicVolumeFilterSpec,c=u.getValue(a,"specification"),p=u.getValue(c,"allVolumes"),a.rootID=n,a.rootAlias=s["ds6w:label"],!0===l.withFilter?(a.applyFilter=0,a.displayFilter=1):(a.applyFilter=1,a.displayFilter=0),c.title=i.get(c.title),c.referencedObject.identifier=n,p[0].allVolumes=[r.getVolumeFilter(n,s.boundingbox,l.installVolumeOffSet)])),a},getVolumeFilter:function(e,n,o=0){let r,l=JSON.parse(t).volumeFilter,s=function(e,t){return e.map((e=>`${e+t}`))},a=function(e,t){return s(e,-t/2)},c=Number.isNaN(Number(o))?0:10*Number(o);var p,d;return n&&n.max&&n.min&&(r=s(n.max,c),l.displayName=i.get(l.displayName),l.parameters.root_path_physicalid=[[e]],l.parameters.corner_max=(p=r,d=n.min,p.map(((e,t)=>""+(e-d[t])))),l.parameters.transformation_matrix=[1,0,0,0,1,0,0,0,1,...a(n.min,c)]),l},getInstallOccurrencesForFilter:async function(n){let i,o=JSON.parse(t).expandV2,r=[],l=e.getComponent("Utils");return o.batch.expands[0].root.physical_id=n.filterRootIds[0],o.batch.expands[0].filter=function(e){let t=[],n=[];return(e=e||{}).filter&&t.push(e.filter),e.paths.length>0&&e.paths.forEach((e=>function(e){let t;e&&e.length>0&&(t=UWA.is(e[0],"string")?[e]:e,n=n.concat(t.map((e=>({physical_id_path:e})))))}(e))),n.length>0&&t.push({prefix_filter:{prefix_path:n}}),{and:{filters:t}}}(n),o.batch.expands[0].graph={descending_condition_relation:{uql:"((taxonomies:*DELFmiFunctionIdentifiedInstance*))"}},o.batch.expands[0].aggregation_processors=[{truncate:{max_distance_from_prefix:1,match_only_refs:1,prefix_filter:{prefix_path:[{physical_id_path:[n.filterRootIds[0]]}]}}}],i=await l.getProgressiveExpand(o),i&&i.results&&i.results.length>0&&i.results.forEach((e=>{e.Path&&r.push(e.Path)})),r},getEffectivityContent:async function(t){let n,i=e.getComponent("Utils"),r={ids:t,domain:"ALL",view:"ALL",format:"TXT"},l={};return n=await i.executeRequestPromise(i.get3DSpaceUrl()+"/resources/v1/modeler/dscfg/invoke/dscfg:getEffectivityContent",{method:"POST",payload:r}),n&&UWA.is(n.effectivitiesContent,"array")&&n.effectivitiesContent.forEach((e=>{l[e.id]={},Object.keys(o).forEach((t=>{l[e.id][t]=e[o[t]]?e[o[t]]:""}))})),l},getUnitId:async function(t){let n,i,o,r=e.getComponent("Utils"),l=r.getValue(t,"model"),s=r.getValue(r.getValue(t,"unit"),"single");return s&&l&&(n=`[plc_build_unit_number]:${s} AND [plc_model_pid]:${l.identifier}`,i=await r.searchUnits(n),i&&UWA.is(i.member,"array")&&i.member.length>0&&(o=i.member[0].identifier)),o},getPublishedRep:async function(t={}){let n,i,o=e.getComponent("Utils"),r=t.processId,l=t.unitId;if(r&&l&&(i=await o.getFilteredRep(r),i&&UWA.is(i.result))){let e=i.result.find((e=>!(!e||!e.input_object)&&e.input_object.physicalid===r));if(e&&e.outputs&&UWA.is(e.outputs.Connection,"array")){let t;t=e.outputs.Connection.find((e=>e.pathsr.contains(l))),t&&(n=t.physicalid)}}return n},getPublicFilterSpecification:async function(t={}){let n=e.getComponent("Utils");if(!(t&&t.proxy&&t.NGFUXId&&t.rootId))throw new Error("Invalid Input, please check input params");const i=`onGetPublicFilter_OpenControl_${(t=t||{}).NGFUXId}_${t.rootId}`;return await new Promise((e=>{t.proxy.addEvent(i,function(n={}){t.proxy.removeEvent(i),e(n)}.bind(this)),t.proxy.getPublicFilterSpecification({rootId:t.rootId,widgetId:n.getWidgetId(),NGFUXId:t.NGFUXId,eventName:i})}))},mergeFilterSpecification:function(e={},t={},n){let i,o=function(e){return e&&e.specification&&e.specification.filter&&e.specification.filter.filterSpecifications};if(o(e)&&o(t)){i={...e};let o=[...e.specification.filter.filterSpecifications,...t.specification.filter.filterSpecifications];i.specification.filter.combinationOfSpecification=n,i.specification.filter.keepChildren=!0,i.specification.filter.filterSpecifications=o}return i},getUnitInfo:async function(t){let n,i=e.getComponent("Utils");return t&&(n=await i.executeRequestPromise(`${i.get3DSpaceUrl()}/resources/v1/modeler/dspfl/dspfl:Unit/${t}?$mask=dsmvpfl:UnitBaseMask`,{dataType:"json",method:"GET"})),n},getUnitFilterExpression:async function(e,n){let o,l=function(e){let t;return e&&e.member&&e.member.length>0&&(t=e.member[0]),t};if(e&&n){let s=l(await r.getUnitInfo(n));if(s){let n=l(s.model)||{},r=n.name,a={name:r,identifier:n.id},c=[{unit:{name:r,selections:[{single:Number(s.unitNumber)}]}}];o=JSON.parse(t).publicUnitFilterSpec,o.rootID=e,o.specification.title=i.get(o.specification.title),o.specification.referencedObject.identifier=e,o.specification.filter.filterSpecifications[0].filterCriteria[0].configurationFilterDefinition.volatileFilter.filterSelection={model:a,criteria:c}}}return o}};return r})),define("DS/DELWebOpen/Model",[],(function(){"use strict";return function(){var e={};return{set:function(t,n){e[t]=n},get:function(t){return e[t]?e[t]:null},remove:function(t){delete e[t]},clear:function(){e={}}}}})),define("DS/DELWebOpen/FormColumns",[],(function(){"use strict";return[{dataIndex:"tree",typeRepresentation:"string",alignment:"near",width:"175",minWidth:"15",alwaysVisibleFlag:!0,editableFlag:!1,getCellClassName:function(e){return e.nodeModel?e.nodeModel.getAttributeValue("className"):""}},{dataIndex:"value",getCellTypeRepresentation:function(e){return e.nodeModel?e.nodeModel.getAttributeValue("typeRepresentation"):"string"},getCellSemantics:function(e){return e.nodeModel?e.nodeModel.getAttributeValue("semantics"):void 0},getCellEditableState:function(e){return!e.nodeModel||!e.nodeModel.getAttributeValue("readOnly")},allowUnsafeHTMLContent:!1,width:"250",minWidth:"10",alwaysVisibleFlag:!0,editableFlag:!0,editionPolicy:"EditionInPlace"},{dataIndex:"withFilter",width:"5",typeRepresentation:"functionIcon",hasCellValue:function(e){return e.nodeModel&&!0===e.nodeModel.getAttributeValue("withFilter")},getCellSemantics:function(e){if(e.nodeModel&&!0===e.nodeModel.getAttributeValue("withFilter"))return{icon:{iconName:"filter",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"1x"},disabled:!0}}}]})),define("DS/DELWebOpen/FormDocument",["DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel"],(function(e,t){"use strict";var n=function(...t){e.apply(this,t)};return(n.prototype=Object.create(e.prototype)).constructor=n,n.prototype.removeRootNode=function(e){let t,n=this.getRoots();n&&n.length>0&&(t=n.find((function(t){return t.options.fieldId===e})),t&&this.removeRoot(t))},n.prototype.createRootNode=function(e,n){var i=new t({label:n?n.label:null,fieldId:e,grid:{className:"oer-form-expander"}});return this.removeRootNode(e),this.addRoot(i),i},n.prototype.getFieldNode=function(e){let t,n=this.search({match:function(t){if(e&&t.nodeModel.options.fieldId===e)return!0}});return n&&n.length>0&&(t=n.find((t=>t.options.fieldId===e))),t},n.prototype.createFieldNode=function(e,n,i){var o,r,l={label:n?n.label:null,fieldId:e,grid:{value:void 0,fieldValue:"",typeRepresentation:"string",semantics:{}}},s=n?n.possibleValues:[];return s&&(1===s.length&&UWA.merge(l.grid,s[0]),l.grid.semantics=function(e){return e&&e.length>1?{possibleValues:e,displayStyle:"combo",allowResetToUndefinedByUIFlag:!0}:{possibleValues:e,displayStyle:"combo",disabled:!0}}(s)),this.removeFieldNode(e),r=new t(l),i&&((o=this.getRoots().find((e=>e&&e.options&&e.options.fieldId===i))).addChild(r),o.expandAll()),r},n.prototype.removeFieldNode=function(e){var t,n=this.getFieldNode(e);n&&(t=n.getParent())&&t.removeChild(n)},n.prototype.updateAttribute=function(e,t,n){let i=this.getFieldNode(e);i&&i.setAttribute(t,n)},n.prototype.disableField=function(e){let t=this.getFieldNode(e);if(t){let e=t.getAttributeValue("semantics");e&&(e.disabled=!0,t.setAttribute("semantics",e))}},n})),define("DS/DELWebOpen/ProcessForm",["DS/Controls/Button","DS/DELWebComponentManager/DELWebComponentManager","DS/DELWebCommonControls/Form","DS/DELWebOpen/FormDocument","DS/DELWebOpen/FormColumns","text!DS/DELWebOpen/assets/json/Constants.json","text!DS/DELWebOpen/assets/json/FormFieldsConfig.json","i18n!DS/DELWebOpen/assets/nls/OpenControl.json"],((e,t,n,i,o,r,l,s)=>{"use strict";const a=JSON.parse(r),c=JSON.parse(l);function p(t,n){this._options=n||{},this._tokens=[],this._model=t,this._openButton=new e({onClick:(...e)=>{n.onOpen&&n.onOpen.apply(n,e)}}),this._cancelButton=new e({onClick:(...e)=>{n.onCancel&&n.onCancel.apply(n,e)}}),this._formOptions={identifier:"oer-process-form",formOptions:{maxVisibleRowCount:Object.keys(c).length,treeDocument:new i,columns:o},dialogOptions:{title:s.get("Dialog.Process.Title"),position:{my:"bottom",at:"center",offsetY:-100},buttons:{Open:this._openButton,Cancel:this._cancelButton}},frameContainer:n.container},this._subscribeEvents()}return p.prototype._subscribeEvents=function(){let e=this;[{event:"onGetFieldValue",handler:e._onGetFieldValue},{event:"onFilterApplied",handler:e._onFilterApplied},{event:"onFilterCancelled",handler:e._onFilterCancelled},{event:"onFormComplete",handler:()=>{e._openButton.disabled=!1}},{event:"onFormClean",handler:e.destroy}].forEach((n=>{e._tokens.push(t.getComponent("ModelEvents").subscribe({event:n.event},n.handler.bind(e)))}))},p.prototype._addFormListener=function(){let e=this;e.getTreeDocument().onNodeModelUpdate((function(n){var i=n.data?n.data.nodeModel:{};if(e.getTreeDocument().prepareUpdate(),i&&i.options&&i.options.fieldId){let e=i.options.grid.semantics;if(e&&e.possibleValues){let t=e.possibleValues.find((function(e){return i.getAttributeValue("value")===e.value}));i.setAttribute(a.Context.fieldValue,t[a.Context.fieldValue])}n.data.attributes.value&&t.getComponent("ModelEvents").publish({event:`on${i.options.fieldId}Select`,data:{data:i.getAttributeValue(a.Context.fieldValue),origin:"FormHelper"}})}e.getTreeDocument().pushUpdate()})),e._processForm.addEventListener("onClose",e._options.onCancel)},p.prototype._removeFormListener=function(){this._processForm&&this._processForm.removeEventListener("onClose",this._options.onCancel)},p.prototype._getPossibleValues=function(e,t){var n=[],i=(e,t)=>{let n="",i="",o=t?t.split(a.Context.delimeter):[];switch(e){case a.Fields.MfgInstallOccurrence:o.length>2&&(n=`${this._getAttributeValue(o[2],a.Attributes.label)} (${this._getAttributeValue(o[1],a.Attributes.label)})`,Object.keys(a.EffectivityAttribute).forEach((e=>{i+=`${s.get("Form."+e+".Title")}: ${this._getAttributeValue(o[1],e)?this._getAttributeValue(o[1],e):""}\n`})));break;case a.Fields.ProcessContextOccurrence:o.forEach((e=>{""!==n?n+=`, ${this._getAttributeValue(e,a.Attributes.label)}`:n=`${this._getAttributeValue(e,a.Attributes.label)}`})),i=n;break;default:n=`${this._getAttributeValue(o[0],a.Attributes.label)}`,i=n}return{label:n,description:i}},o=e=>{let t=e?e.split(a.Context.delimeter):[""];return this._getAttributeValue(t[t.length-1],a.Attributes.iconUrl)};return t&&t.length>0&&(n=t.map((t=>{let n=i(e,t);return{[a.Context.fieldValue]:t,value:n.label,label:n.label,withFilter:void 0,icon:{iconPath:o(t)},description:n.description}}))),n},p.prototype._getParentFieldId=function(e){return e&&c[e]?c[e].parent:null},p.prototype.getPopulatedFields=function(e){var t=[],n=0;return c[e]&&(n=c[e].position,t=Object.keys(c).filter((e=>c[e].position<=n))),t.sort(((e,t)=>c[e].position-c[t].position))},p.prototype._disablePopulatedFields=function(e){let t=this.getPopulatedFields(e),n=this;UWA.is(t,"array")&&t.forEach((function(e){n.disableField(e)}))},p.prototype._onFilterApplied=function(e){let{fieldId:t}=e&&e.data?e.data:{};this.isVisible()&&this._disablePopulatedFields(t)},p.prototype._onFilterCancelled=function(e){let{fieldId:t}=e&&e.data?e.data:{};this._updateAttribute({fieldId:t,attribute:"withFilter",value:!1})},p.prototype._updateAttribute=function(e){let t=this.getTreeDocument();t&&t.updateAttribute(e)},p.prototype._getAttributeValue=function(e,t){var n=this._model.get("attributesMap");return n&&n[e]?n[e][t]:{}},p.prototype._onGetFieldValue=function(e){let t,i,o=this,{fieldId:r,ids:l}=e&&e.data?e.data:{},a=this._model.get("fieldToValuesMap"),p=[],d=function(e){let t=o.getTreeDocument();var n,i;o._openButton.disabled=!0,t.prepareUpdate(),n=t,(i=e)&&i.forEach((e=>{var t=o._getParentFieldId(e);e&&(t?n.createFieldNode(e,{label:s.get(c[e].label),possibleValues:o._model.get("fieldToValuesMap")[e]},t):n.createRootNode(e,{label:s.get(c[e].label)}))})),t.pushUpdate()};a||(a={},o._model.set("fieldToValuesMap",a)),l&&l.length>0&&(a[r]=o._getPossibleValues(r,l),o._processForm?(i=o._getParentFieldId(r),t=o.getTreeDocument().getFieldNode(i),t||p.push(i),p.push(r),d(p)):l.length>1&&(o._processForm=new n(o._formOptions),o._addFormListener(),p=o.getPopulatedFields(r),d(p)))},p.prototype.isVisible=function(){return!!this._processForm},p.prototype.disableField=function(e){let t=this.getTreeDocument();t&&t.disableField(e)},p.prototype.getTreeDocument=function(){if(this._processForm)return this._processForm.getDataGridView().getTreeDocument()},p.prototype.destroy=function(){let e=t.getComponent("ModelEvents");this._removeFormListener(),this._tokens.forEach(e.unsubscribe),this._processForm&&this._processForm.destroy()},p})),define("DS/DELWebOpen/OpenControl",["DS/Logger/Logger","DS/UIKIT/Mask","DS/PlatformAPI/PlatformAPI","DS/DELWebCommonCmds/DELWeb3DFilterCmd","DS/ApplicationFrame/CommandsManager","DS/DELWebComponentManager/DELWebComponentManager","DS/DELWebComponentManager/DELWebTypesUtil","DS/DELWebComponentManager/DELWebComponent","DS/DELWebOpen/Model","DS/DELWebOpen/ContextHelper","DS/DELWebOpen/ProcessForm","DS/DELWebOpen/Helper","text!DS/DELWebOpen/assets/json/Constants.json","i18n!DS/DELWebOpen/assets/nls/OpenControl"],((e,t,n,i,o,r,l,s,a,c,p,d,u,f)=>{"use strict";const m=JSON.parse(u);var g=function(...t){s.apply(this,t),this.logger=e.getLogger("DS/DELWebOpen/OpenControl")};return(g.prototype=Object.create(s.prototype)).constructor=g,g.prototype._onFailure=function(e,t="DELOP_E00",n){let i=n?m.ErrorCodes[t].replace({}):m.ErrorCodes[t];this.logger.debug(e),this._initOptions.onError&&this._initOptions.onError({results:[],error:{code:t,message:f.replace(f.get(i),n)}})},g.prototype._showMask=function(){t.mask(widget.body,f.get("WaitingPage.Title"))},g.prototype._removeMask=function(){t.unmask(widget.body)},g.prototype._onOpen=function(e){this._initOptions.onOpen&&this._initOptions.onOpen(e)},g.prototype._onCancel=function(e){this._initOptions.onCancel&&this._initOptions.onCancel(e)},g.prototype._updateFilterIfPresent=function(e){let t=e.occurrence?e.occurrence[0]:e.id,n=this._filterCmd.getProxy().getFilterSpec(t,{V2:{}}),i={...e};return n&&(i.withFilter=!0,i.filter=n.filter),i},g.prototype._open=async function(e={}){let t=this,n=e.items||[],i=n.filter((e=>!0===e.withFilter||e.publicFilterSpec||e.filterSpec)),o=function(e=[]){return n.forEach(((t,i)=>{let o=e.find((e=>e.id===t.id));o?n[i]=o:t.withFilter=!1})),n};t._utils.markStart("openItem"),i.length>0?t.publish("onOpenFilter",{items:i,onApply:(e=[])=>{UWA.is(e,"array")?(e.forEach(((e={})=>{if(UWA.is(e,"object")){let t=UWA.is(e.filterRootIds,"array")?e.filterRootIds[0]:null;t&&i.forEach((function(n){n.id===t&&(n.withFilter=!0,n.filter=e.CVQueryV2.filter)}))}else t.logger.error("filterParam is not valid, filterParam should be an object")})),t._onOpen({results:o(i)})):t.logger.error("Callback is not valid, results should be an array")},onCancel:e=>{e&&e.result&&e.filterData?(e.filterData.forEach((function(e){e.withFilter=!1})),t._onOpen({results:o(i)})):t._onCancel()},showConfirmationDialog:!0}):(t._utils.markEnd("openItem","Item opened in"),t._onOpen({results:n}))},g.prototype._openProcess=async function(e){let t,n,i=this,o=[],s=()=>{let e=r.getComponent("ModelEvents");i.publish("onFormClean"),o.forEach(e.unsubscribe),i._model.remove("attributes"),i._model.remove("formData"),i._model.remove("publicFilterSpec")},a=async function(){var t=[],n=i._model.get("formData");i._showMask();try{t.push(async function(){let e=i._model.get("formData"),t=await i._utils.getCapableResource(e.process.context);UWA.is(t,"array")&&t.length>0&&(e.rsc={context:t[0].physicalid,pprType:l.PPRTYPES.RESOURCE})}()),t.push(async function(){let e,t=i._model.get("formData");t.mfg&&(e=t.mfg.contextOccurrence,e&&e.length>1&&(t.mfg.predecessors=await i._utils.getInstallPredecessors(t.mfg.context,e[e.length-2])))}()),!0===e.usePublication&&t.push(async function(){let t,n,o,r=i._model.get("formData"),l=r.mfg?r.mfg.context:null,s=r.process?r.process.context:null,a=i._filterCmd.getProxy(),c=i._filterCmd.getNGFUXId();s&&l&&!0===e.withFilter&&(n=await d.getPublicFilterSpecification({proxy:a,NGFUXId:c,rootId:l}),o=await d.getUnitId(n),o&&(t=await d.getPublishedRep({processId:s,unitId:o}),t&&(r.publishedRep={context:t})))}()),await Promise.all(t),i._removeMask(),i._onOpen({results:[function(){let e=function(e){var t,n;return e&&(n=e.contextOccurrence&&e.contextOccurrence.length>0?e.contextOccurrence[e.contextOccurrence.length-1]:e.context,Object.assign(e,{id:n,occurrence:e.contextOccurrence?1===e.contextOccurrence.length?[]:e.contextOccurrence:[]}),delete e.context,delete e.contextOccurrence,delete e.scopedMfg,t=e),t};var t=e(n.process),i=e(n.mfg),o=e(n.rsc),r=e(n.publishedRep);return t.scopedMfg=i,t.resource=o,t.publishedRep=r,t}()]})}catch(e){i._removeMask(),i.logger.log(e),i._onFailure(`Error occurred while fetching resource/predecessors for mfg ${n.mfg.context}`,"DELOP_E00")}finally{s()}},u=()=>{s(),i._filterCmd.resetFilterUI(),i._onCancel()},f=async()=>{if(!0===e.showForm){let i=await this._utils.getAttributeForIds(c.getAllPhysicalIds(t,e.id),Object.values(m.Attributes),Object.values(m.FileAttributes)),o=c.getInstallInstanceIds(t,e.id);if(o&&o.length>0){let e=await d.getEffectivityContent(o);UWA.extend(i,e,!0)}this._model.set("attributesMap",i);let r=Object.assign({},this._initOptions,{onOpen:a,onCancel:u});n=new p(this._model,r)}else r.getComponent("ModelEvents").subscribe({event:"onGetFieldValue"},(e=>{let{fieldId:t,ids:n}=e&&e.data||{};n&&n.length>1&&this._onFailure(`Multiple ids found for ${t}`,"DELOP_E02",{fieldId:t})}))},g=function(){n&&n.isVisible()?i.publish("onFormComplete"):a()},h=async t=>{let o=i._model.get("formData");if(e.buildId&&!0===e.withFilter){i.logger.debug(`Apply filter for the unit ${e.buildId}`);let t=e.buildId,n=await d.getUnitFilterExpression(o.mfg.context,t),r=i._model.get("publicFilterSpec"),l=r?d.mergeFilterSpecification(r,n,"intersection"):n;i._model.set("publicFilterSpec",l)}i.publish("onOpenFilter",{items:[{id:o.mfg.context,type:o.mfg.type,pprType:o.mfg.pprType,withFilter:!0,filterSpec:i._model.get("filterSpec"),publicFilterSpec:i._model.get("publicFilterSpec")}],onApply:(e=[])=>{UWA.is(e,"array")?e.forEach((e=>{if(UWA.is(e,"object")){let n;e.filterRootIds&&1===e.filterRootIds.length&&(n=e.filterRootIds[0],o.mfg.context===n&&(o.mfg.filter=e.CVQueryV2.filter,o.mfg.withFilter=!0,o.process.filter=e.CVQueryV2.filter,i.publish("onFilterApplied",{fieldId:t.fieldId}),t.onFilterApplied&&t.onFilterApplied(e)))}else i.logger.error("filterData is not valid, filterData should be an object")})):i.logger.error("Callback is not valid, results should be an array")},onCancel:e=>{o.mfg.filter=null,o.mfg.withFilter=!1,o.process.filter=null,o.process.withFilter=!1,i.publish("onFilterCancelled",{fieldId:t.fieldId}),t.onFilterCancelled&&t.onFilterCancelled(e)},showConfirmationDialog:!n||!n.isVisible()})},b=function(e,t){t&&t.ids&&t.ids.length>0&&(i.publish("onGetFieldValue",{fieldId:e,ids:t.ids}),1===t.ids.length&&i.publish(`on${e}Select`,t.ids[0]))},_=async function(e){let t=i._model.get("formData"),n=(r=[],(o=[e])&&(r=o.map((e=>e.split(m.Context.delimeter)[0]))),r);var o,r;n&&1===n.length&&(t.mfg.contextOccurrence=e.split(m.Context.delimeter),g())},y=function(){let n=i._model.get("formData");var o=c.getMfgInstallOccurrencesForContext(t,e.id,n.process.context,n.mfg.scopedMfg,n.mfg.context);b(m.Fields.MfgInstallOccurrence,o)},F=async function(o){let r=i._model.get("formData");r.mfg.context=o;let l,s={fieldId:m.Fields.MfgInstallContext,onFilterApplied:async function(n){let i=c.getMfgInstallOccurrencesForContext(t,e.id,r.process.context,r.mfg.scopedMfg,r.mfg.context),o=[];i&&UWA.is(i.ids,"array")&&i.ids.forEach((e=>o.push(e.split(m.Context.delimeter)))),n.filter=n.CVQueryV2.filter,n.paths=o;let l=await d.getInstallOccurrencesForFilter(n);UWA.is(l,"array")&&l.length>0?(l=l.map((e=>e.join(m.Context.delimeter))),b(m.Fields.MfgInstallOccurrence,{ids:l})):g()},onFilterCancelled:function(e){e&&!0===e.result||n&&n.isVisible()?y():u()}};!0===e.installAutoApplyVolume?(l=await d.computeVolumeFilter(r.mfg.context,r.mfg.scopedMfg,{installVolumeOffSet:e.installVolumeOffSet,withFilter:e.withFilter}),i._model.set("publicFilterSpec",l),h(s)):!0===e.withFilter?h(s):y()},C=function(o){let r=i._model.get("formData"),s={fieldId:m.Fields.MfgScopedItem,onFilterApplied:function(){g()},onFilterCancelled:function(e){e&&!0===e.result||n&&n.isVisible()?g():u()}};r.mfg={context:o,scopedMfg:o,pprType:l.PPRTYPES.MBOM},c.getMfgInstallOccurrences(t,e.id,r.process.context,o).ids.length>0?function(){let n=i._model.get("formData");var o=c.getMfgInstallContext(t,e.id,n.process.context,n.mfg.context);b(m.Fields.MfgInstallContext,o)}():!0===e.withFilter?h(s):g()},x=function(n){let o=i._model.get("formData");var r;o.process.contextOccurrence=n.split(m.Context.delimeter),o.process.context,r=c.getMfgContext(t,e.id,i._model.get("formData").process.context),b(m.Fields.MfgScopedItem,r)},O=function(n){var o;i._model.get("formData").process={context:n,pprType:l.PPRTYPES.PROCESS,withFilter:e.withFilter},o=c.getProcessContextOccurrences(t,e.id,i._model.get("formData").process.context),b(m.Fields.ProcessContextOccurrence,o)};e.scopedMfg?(e.scopedMfg=i._updateFilterIfPresent(e.scopedMfg),i._onOpen({results:[e]})):(i._showMask(),(()=>{const e={ProcessContext:O,ProcessContextOccurrence:x,MfgScopedItem:C,MfgInstallContext:F,MfgInstallOccurrence:_};for(let t in e)Object.prototype.hasOwnProperty.call(e,t)&&o.push(r.getComponent("ModelEvents").subscribe({event:`on${t}Select`},(function(n){let o=n?n.data:null;i.logger.debug(`Value of the ${t} is ${o}`),e[t](o)})))})(),t=await i._utils.getContextScope(e.id),i._model.set("context",t),await f(),i._removeMask(),(()=>{let n;n=c.getProcessContext(t,e.id),n&&n.ids.length>0?(i._model.set("formData",{}),b(m.Fields.ProcessContext,n)):(i._model.set("formData",{process:{context:e.id,type:e.type,pprType:l.PPRTYPES.PROCESS,withFilter:e.withFilter}}),g())})())},g.prototype.initialize=async function(e){this._filterCmd=o.getCommand("DELWeb3DFilterCmd"),this._filterCmd||(this._filterCmd=new i({context:null,ID:"DELWeb3DFilterCmd",isEnabled:!0,arguments:[]})),this._initOptions=e||{},this._filterCmd.initProxy(this._initOptions),this._utils=r.getComponent("Utils"),this._model=new a},g.prototype.publish=function(e,t){r.getComponent("ModelEvents").publish({event:e,data:{data:t,origin:"OpenController"}})},g.prototype.open=async function(e){let t;if(this.logger.debug("OpenControl open invoked with params",e),e&&e.id)if(t=await l.getTaxonomies([e.id]),e.pprType=l.getPPRType(t[e.id]),e.pprType===l.PPRTYPES.PROCESS)this._openProcess(e);else this._open({items:[e]});else this._onFailure("id property is missing","DELOP_E01")},g.prototype.openMultiRoots=async function(e){let t;this.logger.debug("OpenControl open invoked with params",e),e&&e.items&&e.items.length>0?(t=await l.getTaxonomies(e.items.map((e=>e.id))),e.items.forEach((function(e){e.pprType=l.getPPRType(t[e.id])})),-1!==e.items.map((e=>e.pprType)).indexOf(l.PPRTYPES.PROCESS)?this._onFailure(`${l.PPRTYPES.PROCESS} type not supported in MultiRoots Scenarios`,"DELOP_E04",{type:l.PPRTYPES.PROCESS}):this._open(e)):this._onFailure("items property is missing","DELOP_E01")},g.prototype.clean=async function(){this._filterCmd&&this._filterCmd.cleanProxy(),this._initOptions={},this._utils=null,this._model&&this._model.clear(),this._model=null},g.prototype.getProxy=function(){return this._filterCmd?this._filterCmd.getProxy():null},g}));