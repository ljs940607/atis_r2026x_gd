define("DS/DELPPWLinksModule/UsagePointsManagerUI",["UWA/Core"],(function(e){"use strict";return function(t,n,i){var s,o,a,r,c,l,d,g,u=i.getComponent("Button"),f=[];return c=function(o){l(),e.is(i)?(s=i.create("Dialog",{title:n.getNLSValue("LinksUI.CreateUsagePoints"),domId:"UsagePoints-UI",content:a,modalFlag:!1,resizableFlag:!0,width:400,minWidth:300,height:300,minHeight:200,buttons:{Cancel:new u({onClick:function(){s.close()}}),Ok:new u({emphasize:"primary",onClick:function(){e.is(o,"function")&&e.is(r.getSelectedItemsIds())&&r.getSelectedItemsIds().length>0?(s.close(),o(r.getSelectedItemsIds())):g(n.getNLSValue("UsagePointsManagerUI.SubmitWithoutSelection.Error"),"error")}})}})).close=function(){e.is(a)&&a.destroy(),this.destroy(),s=null}:t.debug("uxFactoryBehavior is not available.")},l=function(){a=i.createElement("div",{class:"UsagePointsManagerUI-Dialog"}),o=i.createElement("div",{class:"objects-section"}).inject(a),r=i.create("SelectionControl",{message:n.getNLSValue("UsagePointsManagerUI.SelectServiceItems"),renderTo:o,multiSelection:!0,displayMultiSelection:!0,itemsWithOptions:!0})},d=function(t){e.is(t)&&r.updateLabel(t)},g=function(n,i){e.is(n)&&e.is(i)&&("info"===i?s.info(n):"warning"===i?s.warning(n):"error"===i?s.error(n):t.debug("type of message is invalid"))},{prepareParamObj:function(e){f.push({instId:e.instanceId,path:e.path})},buildSkeleton:function(t){e.is(s)||c((function(n){var i,s,o=[];for(i=0;i<n.length;i++)s=f.find((e=>e.instId===n[i])),e.is(s)&&e.is(s.path)&&o.push(s.path);e.is(t,"function")&&e.is(o)&&o.length>0&&t(o)}))},updateLabels:function(e){d(e)},isVisible:function(){return!!e.is(s)&&s.visibleFlag},showMessages:function(e,t){g(e,t)},clearMessages:function(){s.clearMessages()},destroyDialog:function(){e.is(s)&&(s.destroy(),s=null)}}}})),define("DS/DELPPWLinksModule/LinksUI",["UWA/Core","DS/DELPPWLinksModule/UsagePointsManagerUI"],(function(e,t){"use strict";return function(n,i,s,o,a,r,c,l){const d="DELLmiServiceWorkPlanSystemReference",g="PLMInstance.PLM_ExternalID",u=["DELLmiServiceWorkPlanOperationalReference","DELLmiServiceWorkPlanRectifyingReference","DELLmiServiceWorkPlanSupportingTaskReference"],f=["OPERATION","SYSTEM"];var h,p,I,P,m,y,L,S,R,b,D,v,C,E,k,U,T,O,A,N,M,w,V,F,W,x,j,K,_,B,Y={className:"Links MGA-linksUIContainer disableContentselection"},H=new t(n,s,i),z=s.getNLSValue("LinksUI.PanelTitle"),Q={},X=null,G={title:"",reference:{model:null},instance:{model:null,absPath:""},whereUsed:{isFetched:!1,references:[],instances:[]},children:{areFetched:!1,references:[],instance:[]}};return U=function(){e.is(X)&&(X.title=z+G.title)},T=function(){var t,s,o,a,r=i.getComponent("WUXFrameWindowsManager").getFrameWindow(n.getAppContext());(X=i.create("Panel",{position:{my:"center",at:"center"},domId:"RelationsPanel",immersiveFrame:r.getImmersiveFrame(),resizableFlag:!0,visibleFlag:!1})).close=function(){e.is(I)?n.notify("toggleCmdCheckHeaderState",{cmdName:I,cmdState:!1}):w()},S=i.create("Element","div",{class:Y.className}),t=i.create("Element","div",{class:"linksPanel-Container"}),s=i.create("Element","div",{class:"module-messages"}),o=O(),a=A(),s.inject(t),o.inject(t),a.inject(t),t.inject(S)},O=function(){var e;return e=i.create("Element","div",{class:"linkView-toolbar"}),(R=i.create("Filter",{filterToolbarSections:y})).inject(e),R.addEvent("onChange",(function(e,t){t&&"PARENT"===e&&!1===G.whereUsed.isFetched&&V(),t&&Q[e].pprTypeDiv.getChildren().length>0?Q[e].pprTypeDiv.show():Q[e].pprTypeDiv.hide()})),e},A=function(){var t,n;for(n in t=i.create("Element","div",{class:"LinksUI-menuDiv"}),(L=i.create("WUXLoader")).inject(t),Q)Object.hasOwnProperty.call(Q,n)&&(Q[n].pprTypeDiv=new e.Element("div",{class:"pprTypeDiv"}).inject(t));return t},N=function(t,n,a,r,c,l){var d,g=s.getNLSValue("LinksUI.ConfirmationDialog.Header"),u=s.getNLSValue("LinksUI.ConfirmationDialog.Text");d=function(i){e.is(i,"boolean")&&i&&o.switchScope(t,n,a,r,c,l)},i.showConfirmation(g,u,null,d)},M=function(t,n){var o,a,r,c=i.createElement("div",{class:"selectInstance-dialog-container"}),l=[],d=i.getComponent("ComboBox"),u=i.getComponent("Button"),f=s.getNLSValue("LinksUI.SelectInstanceDialog.Header");for(o=0;o<t.length;o++)l.push({label:t[o].get(g),value:t[o]});(r=new d({elementsList:l,enableSearchFlag:!1,actionOnClickFlag:!1})).inject(c),(a=i.create("Dialog",{domId:"selectInstance-dialog",title:f,content:c,resizableFlag:!0,modalFlag:!0,width:400,minWidth:290,buttons:{Cancel:new u({onClick:function(){a.close()}}),Ok:new u({disabled:!1,emphasize:"primary",onClick:function(){a.close(),e.is(n,"function")&&n(r.currentValue)}})}})).close=function(){this.destroy()}},w=function(){X.hide()},V=function(){var t,i=!1,s=!1,r=!1,c=[],l=[],d=[],g=[],u=[],h=G.reference.model,p=G.instance.model,I=!1,P=null,m=[],y=function(){var t,o,f,m,y,S,R,b;i&&s&&r&&(t=c,o=l,f=d,m=g,y=u,S={},R=[],b=function(){S=W(t,h,p,S),S=x(o,f,h,p,S),S=j(m,y,h,p,S),F(S),L.hide(),n.notify("RelationsPanelLoaded")},Object.keys(Q).forEach((e=>{S[e]=[]})),B(),a.isNavigateOnDemand()||t.forEach((function(t){var n=e.is(t.get("usagePoint"))?t.get("usagePoint"):null;e.is(n)&&n.length>0&&!e.is(a.getInstance(n[0][n[0].length-1]))&&a.isInstance(n[0][n[0].length-1])&&R.push(...t.get("usagePoint").map((e=>e[e.length-1])))})),R.length>0?a.fetchInstancesAndTheirReferences(R,{onComplete:function(){b()},silentMode:"true"}):b()),I&&n.notify("updateRelationsColumn",P)},S=function(e){i=!0,c=e,y()};if(t=R.getSelectedItems(),!0!==G.whereUsed.isFetched?e.is(h)&&-1!==t.indexOf("PARENT")?(a.getWhereUsedReferences(h,(function(t,n){s=!0,e.is(G.whereUsed)&&(G.whereUsed.isFetched=!0,G.whereUsed.references=t,G.whereUsed.instances=n),l=t,d=n,y()})),G.whereUsed.isFetched=!0):s=!0:(e.is(h)&&-1!==t.indexOf("PARENT")&&(l=G.whereUsed.references||[],d=G.whereUsed.instances||[]),s=!0),!0!==G.children.areFetched)if(e.is(h)&&f.includes(h.get("PPRTYPE"))&&-1!==t.indexOf("CHILDREN_WORKINSTRUCTION")){let t=h.get("PID");a.getDescendantsFromServer(t,(function(t){var n;r=!0,e.is(t.instancesAndReferences,"array")&&(n=t.instancesAndReferences.filter((e=>e.get("PID")!==h.get("PID")))),e.is(G.children)&&(G.children.areFetched=!0,G.children.instances=n.filter((e=>e.isInstance()&&e.get("isAggregatedBy")===h.get("PID"))),G.children.references=n.filter((e=>e.isReference()&&G.children.instances.some((t=>t.get("isInstanceOf")===e.get("PID")))))),g=G.children.references,u=G.children.instances,y()})),G.children.areFetched=!0}else r=!0;else e.is(h)&&-1!==t.indexOf("CHILDREN_WORKINSTRUCTION")&&(g=G.children.references||[],u=G.children.instances||[]),r=!0;B(),e.is(p)&&(I=I||a.needToQueryForConnections(p),e.is(P)||(P=p.get("PID"))),e.is(h)&&(I=I||a.needToQueryForConnections(h),e.is(P)||(P=h.get("PID"))),L.show(),a.isNavigateOnDemand()?(e.is(p)?m.push({id:p.get("PID"),path:G.instance.absPath}):e.is(h)&&m.push({id:h.get("PID"),path:[]}),m.length>0&&o.getRelations(m).then((function(){var t,n;n=e.is(p)?p.get("PID"):h.get("PID"),t=o.getImpactedConnections(n),S(t)}))):o.getConnectionsByModel(h,p,{silentMode:!0,onComplete:S})},F=function(t){var n,o,r,c,l,d,g,u,f,h,p,I,P;for(r in p=R.getSelectedItems(),t)if(Object.hasOwnProperty.call(t,r)){if(c=t[r],o=Q[r].pprTypeDiv,0===c.length){o.setStyle("display","none");continue}for(p.indexOf(r)>-1?o.show():o.hide(),o.addClassName("pprTypeMarg"),new e.Element("div",{class:"pprTypeTitleDiv",text:Q[r].title}).inject(o),n=0;n<t[r].length;n++){if(g=i.create("Element","div",{class:"connectionDiv default"}),h=(l=t[r][n]).type,e.is(h)&&("SecondaryCandidateResourceLink"===h&&(g.className="connectionDiv secondaryRecource"),f=l.iconDirection,e.is(f)&&(-1!==h.indexOf("_inverse")?f.tooltipInfos=i.create("TooltipModel",{shortHelp:s.getNLSValue("LinksUI.BackwardIcon")}):f.tooltipInfos=i.create("TooltipModel",{shortHelp:s.getNLSValue("LinksUI.ForwardIcon")}),f.inject(g)),u=l.icon,e.is(u)&&(u.tooltipInfos=i.create("TooltipModel",{shortHelp:s.getNLSValue(h)}),u.inject(g))),(d=i.create("Element","div",{class:"connectionLabel",text:l.label,styles:{display:"inline-block"}})).tooltipInfos=i.create("TooltipModel",{shortHelp:l.label}),d.inject(g),e.is(G.reference)&&e.is(G.reference.model)){const e=G.reference.model;I=a.isReferencesHasReadOnlyType(e)}I||((P=i.create("Button",{label:"",icon:"bars",iconSize:"2x",displayStyle:"lite",onClick:K}).inject(g)).getContent().setStyles({float:"right"}),P.getContent().setData("pid",l.pid),P.getContent().setData("linkedReferencePID",l.linkedReferencePID)),g.inject(o),e.is(l.usagePoint)&&l.usagePoint.length>0&&l.usagePoint.forEach((function(e){k(o,e)}))}}},k=function(t,n){var o,a,r,c;o=i.create("Element","div",{class:"connectionDiv default usagePoint"}),a=n.icon,e.is(a)&&(a.tooltipInfos=i.create("TooltipModel",{shortHelp:s.getNLSValue("LinksUI.UsagePoint")}),a.inject(o)),(r=i.create("Element","div",{class:"connectionLabel",text:n.label,styles:{display:"inline-block"}})).tooltipInfos=i.create("TooltipModel",{shortHelp:n.label}),r.inject(o),(c=i.create("Button",{label:"",icon:"close",iconSize:"2x",displayStyle:"lite",onClick:function(){E(n.connPID,n.targetPathInstIds)}})).tooltipInfos=i.create("TooltipModel",{shortHelp:s.getNLSValue("LinksUI.DeleteUsagePoint")}),c.inject(o),c.getContent().setStyles({float:"right"}),o.inject(t)},W=function(t,i,r,d){var u,f,h,I,P,m,y,L,S,R,b,D,v,C,E,k,U,T,O=p,A=e.is(i)?i.id:"",N=e.is(r)?r.id:"";for(u=0;u<t.length;u++){switch(f=(L=t[u]._attributes).type){case"DELLmiTimeConstraintCnx":f=o.getLinkInfo(t[u]).subType;break;case"DELAsmProcessCanUseCnx":o.getSecondaryRscLinksFromPrimaryLink(t[u]).forEach((function(e){(T=e.clone()).set("from",L.from),t.splice(u+1,0,T)}));break;case"SecondaryCandidateResourceLink":if(U=o.getConnection(L.from),e.is(U)){(T=t[u].clone()).set("from",U.get("from")),t.splice(u+1,0,T),(T=t[u].clone()).set("from",U.get("to")),t.splice(u+1,0,T);continue}}if(D=L.to,e.is(L.from,"array")&&e.is(L.to,"array")&&e.is(G.instance.absPath))if("ProcessImplementLinkOcc"===L.type){if(!l.isImplementLinkValidForOccPath(L.from,L.to,G.instance.absPath))continue}else if("DELMBOMContextualImplementCnx"===L.type&&Array.isArray(G.instance.absPath)){if(!c.isProductImplementLinkValidForOccPath(L.from,L.to,G.instance.absPath))continue}if(k=!!e.is(L.to,"array")&&N===L.to[L.to.length-1],A===L.to||N===L.to||k?(D=L.from,f+="_inverse",R=s.getIconElem("LinkInverse")):R=s.getIconElem("Link"),v=a.getReference(D),e.is(v)||((b=e.is(D,"array")?a.getInstance(D[D.length-1]):a.getInstance(D))?v=a.getReference(b.get("isInstanceOf")||b.get("to")):n.debug("No linked instance !!!")),e.is(v)){if(S="OPERATION"===(S=v.get("PPRTYPE"))?"SYSTEM":S,y=v.get("type"),!Object.hasOwnProperty.call(Q,S)){n.debug("Linked object PPRTYPE is not authorized in Relations Panel :"+y);continue}if(e.is(O[y])&&e.is(O[y].Attribute)){C=O[y].Attribute,C=e.is(C,"array")?C:[C];const t=O[y].separator||" ";I=C.map((t=>{var n=e.is(t.dicoType)?t.dicoType+"."+t.name:t.name;return v.get(n)})).join(t)}else I=a.getDisplayName(v);if(e.is(O[f])&&e.is(O[f].Attribute)){C=O[f].Attribute,C=e.is(C,"array")?C:[C];const t=O[f].separator||")(",n=s.getNLSValue("LinksUI.Link.JoinPattern");let i=!1,o=!1;for(P=[],E=0;E<C.length;E++)if(m=e.is(C[E].dicoType)?C[E].dicoType+"."+C[E].name:C[E].name,"ProcessImplementLinkOcc"!==f&&"ProcessImplementLinkOcc_inverse"!==f||"PLMEntity.V_usage"!==m&&"ImplementLinkUsageFamily.V_Action"!==m){if("ProcessImplementLinkOcc"!==f&&"ProcessImplementLinkOcc_inverse"!==f||!m.contains("V_ContQuantity")&&!m.contains("V_UsageQuantityRatio"))"DELAsmProcessCanUseCnx"===f&&"DELAsmProcessCanUseCnx.V_IsPreferred"===m?"TRUE"===L[m]&&P.push("*"):!e.is(b)||"ProcessImplementLink"!==f&&"PartialProcessImplementLink"!==f||!e.is(L.to,"array")&&b.id!==L.to||!m.contains("PLMInstance.PLM_ExternalID")?"ProcessImplementLink"!==f&&"PartialProcessImplementLink"!==f&&P.push(L[m]):P.push(b.get(m));else if(!i){let t=l.getQuantityInfoFromConnection(L.PID);i=!0,e.is(t)?P.push(t):(t=f.contains("inverse")?l.getQuantityInfoFromModel(r.id):l.getQuantityInfoFromModel(b.id),e.is(t)&&P.push(t))}}else if(!o){let e=l.getRoleFromModelOrComputed(L.PID),t=l.getActionsFromConnection(L.PID).map((function(e){return e.nlsText}));t.unshift(e.nlsText),P.push(t.join(n)),o=!0}P.length>0&&(I="("+P.join(t)+")"+I)}if(h=s.getIconElem(f),"ProductImplementLinkOcc"===f||"ProductImplementLinkOcc_inverse"===f){let e,t,n=!1,o="DELMBOMContextualImplementCnx";f.contains("inverse")?(e=v,t=b,o+="_inverse"):(e=i,t=r),n=a.checkForContextualImplementLink(e,t),!0===n&&(h=s.getIconElem(o))}Object.hasOwnProperty.call(d,S)&&(d[S].push({label:I,icon:h,iconDirection:R,pid:L.PID,linkedReferencePID:v.get("PID"),type:f}),("ProcessImplementLink"===f||"ProcessImplementLink_inverse"===f)&&e.is(L.usagePoint)&&L.usagePoint.length>0&&L.usagePoint.forEach((function(t){var i,o=s.getIconElem("UsagePoint"),r=a.getInstance(t[t.length-1]);e.is(r)?(i=r.get(g),e.is(d[S][u].usagePoint)||(d[S][u].usagePoint=[]),d[S][u].usagePoint.push({label:i,icon:o,targetPathInstIds:t,connPID:L.PID})):n.debug("Cannot retrieve the targeted instance of the Usage Point")})))}else n.debug("No linked reference !!!")}return d},x=function(t,i,o,r,c){var l,d,g,u,f,h,I,P,m,y,L,S=p;for(l=0;l<t.length;l++){if(h=(m=t[l]).get("type"),e.is(S[h])&&e.is(S[h].Attribute))for(L=S[h].Attribute,L=e.is(L,"array")?L:[L],P=S[h].separator||" ",u="",d=0;d<L.length;d++)I=e.is(L[d].dicoType)?L[d].dicoType+"."+L[d].name:L[d].name,0!==d&&(u+=P),u+=m.get(I);else u=a.getDisplayName(m);for(g=s.getIconElem(h),f=h,d=0;d<i.length;d++)if(i[d].get("isAggregatedBy")===m.get("PID")){y=i[d];break}e.is(y)?c.PARENT.push({label:u,icon:g,pid:y.get("PID"),linkedReferencePID:m.get("PID"),type:f}):n.debug("Instance of reference id:"+m.get("PID")+" not found.")}return c},j=function(t,i,o,r,c){var l,d,g,u,f,h,p,I;for(i=i.sort(((e,t)=>e.get("V_TreeOrder")-t.get("V_TreeOrder")>0)),l=0;l<t.length;l++){for(h=(p=t[l]).get("type"),u=a.getDisplayName(p),g=s.getIconElem(h),f="Type."+h,d=0;d<i.length;d++)if(i[d].get("isInstanceOf")===p.get("PID")){I=i[d];break}e.is(I)&&"WORKINSTRUCTION"===a.getPPRType(I)?c.CHILDREN_WORKINSTRUCTION[d]={label:u,icon:g,pid:I.get("PID"),linkedReferencePID:p.get("PID"),type:f}:n.debug("Instance of reference id:"+p.get("PID")+" not found.")}return e.is(c.CHILDREN_WORKINSTRUCTION)&&(c.CHILDREN_WORKINSTRUCTION=c.CHILDREN_WORKINSTRUCTION.filter((t=>e.is(t)))),c},b=function(t){var n,i;n=o.getConnection(t),e.is(n)?o.deleteConnection(t):(i=a.getInstance(t),e.is(i)&&a.deleteInstance([i],{askDeleteConfirmation:!1}))},D=function(t){var i,r,c,d,g,u,f,h,p,I=!0,P=[];if(i=o.getConnection(t),e.is(i)){if(f=!!a.isInstance(i.get("to")),g=i.get("type"),r=i.get("from"),f)c=a.getInstance(i.get("to")).get("isInstanceOf"),d=i.get("to");else if(c=i.get("to"),u=a.getParentInstancesFromCollection(c),"PartialProcessImplementLink"===g&&(P=l.findInstanceWhoseParentIsScoped(G.instance.absPath).scopeLinks),0!==u.length)if(u.length>1&&0===P.length)M(u,(function(e){e&&(d=e.get("PID"),c&&d&&!f&&o.switchScope(r,c,d,g,f,i))}));else if(u.length>1&&P.length>0)for(p=0;p<P.length;p++)P[p].get("to").toString()===i.get("to").toString()?M(u,(function(e){if(e&&(d=e.get("PID"),c&&d&&!f))for(o.switchScope(r,c,d,g,f,i),p=0;p<P.length;p++)g=P[p].get("type"),o.switchScope(P[p].get("from"),c,d,g,f,P[p])})):a.isInstance(P[p].get("to"))&&(d=P[p].get("to"));else u[0].get("isInstanceOf")===c&&(d=u[0].get("PID"));else n.warn(s.getNLSValue("LinksUI.SwitchScopeCallback.Warn"));if(c&&d&&f)"ProcessImplementLink"===g&&(h=a.getAllChildrenFromCollection(r),a.getReferencesFromArray(h.referencesPID).forEach((function(e){var t;if("DELLmiHeaderOperationReference"===e.get("type"))for(t=l.getPartialScopeLinks(e.id),p=0;p<t.length;p++)a.isInstance(t[p].get("to"))&&t[p].get("to").toString()===i.get("to").toString()&&(I=!1)}))),I?N(r,c,d,g,f,i):n.warn(s.getNLSValue("LinksUI.SwitchScopeCallback.PreventScope"));else if(c&&d&&!f&&(o.switchScope(r,c,d,g,f,i),P.length>0))for(p=0;p<P.length;p++)P[p].get("to").toString()===i.get("to").toString()&&(g=P[p].get("type"),o.switchScope(P[p].get("from"),c,d,g,f,P[p]))}},C=function(t){var i=o.getConnection(t);e.is(i)&&(h=i.get("to"),H.destroyDialog(),H.buildSkeleton((function(a){e.is(a)&&(e.is(i.get("usagePoint"))&&JSON.stringify(i.get("usagePoint").sort())===JSON.stringify(a.sort())?(n.warn(s.getNLSValue("LinksUI.UsagePointsAlreadyExisting.Warn")),X.close()):(o.setUsagePoints(t,a,null),X.close()))})))},E=function(t,n){var i=[];e.is(n)&&(i.push(n),o.deleteUsagePoint(t,i))},v=function(e){var t=a.getReferenceIdFromInstance(e),i=a.getReference(t),s=i.get("type"),r=a.findAllRIRPaths(i.get("PID")).find((t=>t.includes(e)));if("DELResourceParameterPlanReference"===s){let t=o.isModuleActivated("RPPMOD"),s={iRPPModel:i,instancePID:e,state:!0};t?n.notify("computeResourceParamPlan",s):n.notify("editResourceParameterPlan",s)}else"DELWkiDataCollectPlanReference"===s?n.notify("editDataCollectPlan",{WKIModel:i,instancePID:r,state:!0}):"DELWkiDataCollectChecklistReference"===s?n.notify("editDataCollectChecklist",{WKIModel:i,instancePID:r,state:!0}):n.notify("editWorkInstruction",{WKIModel:i,absolutePath:r})},K=function(t){var c,l,g,f,h,p,I,y,L,S=[],R=this.getData("pid"),E=o.getConnection(R),k=this.getData("linkedReferencePID"),U=a.getReference(k),T=U.get("PPRTYPE"),O=t.currentTarget.getOffsets().x,A=t.currentTarget.getOffsets().y+25;if(l=e.is(E),g={icon:"url("+s.getIconURLFromKey("GeneralDelete")+")",label:E?s.getNLSValue("LinksUI.DeleteLink"):s.getNLSValue("LinksUI.Delete"),sensitivity:l?o.canDeleteRelation(R)?"enabled":"disabled":"enabled",callback:function(){b(R)}},f={icon:"url("+s.getIconURLFromKey("SwitchScope")+")",label:s.getNLSValue("LinksUI.SwitchScope"),sensitivity:"enabled",callback:function(){D(R)}},c={icon:"url("+s.getIconURLFromKey("EditAttribute")+")",label:s.getNLSValue("LinksUI.EditAttribute"),sensitivity:r.hasEditConfiguration(R)?"enabled":"disabled",callback:function(){r.editConfiguredAttributes(R)}},h={icon:"url("+s.getIconURLFromKey("showAuxiliaryView")+")",label:s.getNLSValue("LinksUI.ShowInAuxiliaryView"),sensitivity:"enabled",callback:function(){n.notify("addToAuxiliaryView",U)}},p={icon:"url("+s.getIconURLFromKey("UsagePoint")+")",label:s.getNLSValue("LinksUI.CreateUsagePoints"),sensitivity:"enabled",callback:function(){C(R)}},Object.keys(P).indexOf(T)>-1&&(I={icon:"url("+s.getIconURLFromKey(P[T].icon)+")",label:s.getNLSValue("LinksUI.ShowInNaturalView",{view:s.getNLSValue(P[T].view)}),sensitivity:"enabled",callback:function(){n.notify("referenceAdded",[U,null,{withLinksResolved:!0}])}}),y={icon:"url("+s.getIconURLFromKey("ExploreInWebApp")+")",label:s.getNLSValue("ExploreInWebApp",null,"Cmd","Title"),sensitivity:"enabled",callback:function(){n.notify("ExploreInWebApp",[[{referencePID:k}]])}},"WORKINSTRUCTION"===U.get("PPRTYPE")){let e=U.get("type"),t=a.isAKindOf(e,"DELWkiDataCollectPlanReference")||a.isAKindOf(e,"DELWkiDataCollectChecklistReference")||a.isAKindOf(e,"DELResourceParameterPlanReference");L={icon:"url("+s.getIconURLFromKey(e)+")",label:s.getNLSValue(t?"LinksUI.EditPlan":"LinksUI.EditInstruction"),sensitivity:"enabled",callback:function(){v(R)}}}l?(S.push(g),S.push(c),"ProcessImplementLink"!==E.get("type")||!e.is(G.reference.model)||G.reference.model.get("type")!==d&&U.get("type")!==d&&!u.some((e=>G.reference.model.get("type")===e||U.get("type")===e))||"SERVICE"!==T&&"SYSTEM"!==T||S.push(p)):e.is(G.reference.model)&&"PRODUCT"!==G.reference.model.get("PPRTYPE")&&S.push(g),"Installation"!==U.get("PLMEntity.V_discipline")&&"Transform"!==U.get("PLMEntity.V_discipline")||S.push(f),"WORKINSTRUCTION"===U.get("PPRTYPE")&&S.push(L),S.push(h),e.is(I,"object")&&S.push(I),o.isExploreWebAppEnabled()&&m&&S.push(y),i.getComponent("ContextualMenuManager").show({nodes:S},[O,A])},_=function(){var e;for(e in Q)Object.hasOwnProperty.call(Q,e)&&("PARENT"===e?R.unselectItem(e,!0):R.selectItem(e,!0))},B=function(){Object.values(Q).forEach((function(e){e.pprTypeDiv.empty()}))},{init:function(t){Y=e.extend(Y,t),p=t.relAttributeConfig,I=e.is(t.relatedCmdId)?t.relatedCmdId:null,P=e.is(t.acceptedTypes)?t.acceptedTypes:null,m=!e.is(t.exploreInWebApp)||t.exploreInWebApp,y=e.is(t.filterToolbarSections)?t.filterToolbarSections:null,Array.isArray(y)?y.forEach((function(e){Q[e]={title:s.getNLSValue("PPRTYPE."+e)}})):Q={PART:{title:s.getNLSValue("PPRTYPE.PART")},PRODUCT:{title:s.getNLSValue("PPRTYPE.PRODUCT")},SERVICE:{title:s.getNLSValue("PPRTYPE.SERVICE")},PROCESS:{title:s.getNLSValue("PPRTYPE.PROCESS")},SYSTEM:{title:s.getNLSValue("PPRTYPE.SYSTEM")},RESOURCE:{title:s.getNLSValue("PPRTYPE.RESOURCE")},PARENT:{title:s.getNLSValue("PPRTYPE.PARENT")},ORGANIZATION:{title:s.getNLSValue("PPRTYPE.ORGANIZATION")},CHILDREN_WORKINSTRUCTION:{title:s.getNLSValue("PPRTYPE.CHILDREN_WORKINSTRUCTION")}},T()},destroy:function(){this.isActive()&&w(),e.is(X)&&(X.destroy(),X=void 0)},showModal:function(t){G=e.extend(G,t),V(),X.show(),U(),X.content=S},isActive:function(){return!!e.is(X)&&X.visibleFlag},isUsagePointsDialogVisible:function(){return H.isVisible()},clear:function(){G={title:"",reference:{model:null},instance:{model:null,absPath:""},whereUsed:{isFetched:!1,references:[],instances:[]},children:{areFetched:!1,references:[],instances:[]}},U(),B()},hideUI:function(){X.hide()},updateWhereUsed:function(t){var n,i,s=-1;if(e.is(t)&&(n=t.isInstance()?t.get("isAggregatedBy"):t.get("PID"),e.is(G.whereUsed.references,"array"))){for(i=0;i<G.whereUsed.references.length;++i)if(G.whereUsed.references[i].id===n){s=i;break}-1!==s?G.whereUsed.references.splice(s,1):t.isInstance()&&(G.whereUsed.instances.push(t),G.whereUsed.references.push(a.getReference(n))),V()}},updateChildren:function(t){var n,i;e.is(t)&&(n=t.isInstance()?t.get("isInstanceOf"):t.get("PID"),e.is(G.children.references,"array")&&(-1!==(i=G.children.references.findIndex((e=>e.get("PID")===n)))?G.children.references.splice(i,1):t.isInstance()&&t.get("isAggregatedBy")===G.reference.model.get("PID")&&(G.children.instances.push(t),G.children.references.push(a.getReference(n))),V()))},updateUsagePointsSelectionUI:function(t){var n=[];t.forEach((function(t){var i=a.getReference(t.referenceId),o=a.getInstance(t.instanceId),r=e.is(i)&&e.is(o),c=!1;t.path.forEach((function(e,n){var i,s=a.getInstance(e);return 0===n&&s.get("isAggregatedBy")===h?c=!0:s.get("isInstanceOf")===h?e===t.instanceId?c=!1:-1!==(i=t.path.indexOf(s.id))?(t.path.splice(i,1),c=!0):c=!1:void 0})),r?a.isAKindOf(i,"DELServicePartReference")||a.isAKindOf(i,"DELServiceAssemblyReference")||a.isAKindOf(i,"DELServiceKitReference")?e.is(c)&&c?(n.push(o),H.prepareParamObj(t),H.clearMessages()):H.showMessages(s.getNLSValue("UsagePointsManagerUI.SelectionNotSupported.Warn"),"warning"):H.showMessages(s.getNLSValue("UsagePointsManagerUI.ServiceItemNotSupported.Warn"),"warning"):H.showMessages(s.getNLSValue("UsagePointsManagerUI.SelectionNotSupported.Warn"),"warning")})),n.length>0&&H.updateLabels(n)},getCurrentModel:function(){return G},updateTitle:function(e){G.title=e,U()},resetFilter:function(){_()}}}})),define("DS/DELPPWLinksModule/LinksModule",["UWA/Core","DS/DELPPWLinksModule/LinksUI"],(function(e,t){"use strict";return{behaviors:["UXFactoryBehavior","ResourceBehavior","SelectionBehavior","LinkBehavior","ModelBehavior","EditAttributeBehavior","ProductImplementBehavior","ProcessImplementBehavior","ProductFlowLinkBehavior"],creator:function(n,i,s,o,a,r,c,l,d,g){var u,f,h,p,I,P,m,y,L=null;return p=function(t,n){a.getXMLValues(u.relationsDialogDisplayAttributeConfigXML,(function(n){var i=n.convert("DisplayAttributeDescriptionList.Type","name")||{},s=n.convert("DisplayAttributeDescriptionList.Relation","linkName")||{};f=e.merge(i,s),t()}),(function(e){n(e)}))},I=function(t){var n,i,s,o=[];return e.is(t,"array")&&t.forEach((function(t){n=r.getInstance(t.id),s=e.is(n)?n.get("isInstanceOf"):t.id,i=e.is(n)?n.get("PID"):null,o.push({referenceId:s,instanceId:i,path:t.path})})),o},P=function(t,n){var i=!1,s=L.getCurrentModel(),o=e.is(s.reference.model)?s.reference.model.id:"",a=e.is(s.instance.model)?s.instance.model.id:"";return t!==o&&t!==a||(i=!0),!e.is(n)||n!==o&&n!==a||(i=!0),i},m=function(t){var i={instModel:{},refModel:{},absPath:""},s=t.id?t.id:t.instancePID,o=t.id?t.id:t.referencePID;return i.instModel=r.getInstance(s),e.is(i.instModel)?(i.absPath=t.path?t.path:t.absPath,i.refModel=r.getReferenceModelFromInstance(i.instModel)):(i.refModel=r.getReference(o),e.is(i.refModel)||n.debug("Object with reference PID:"+s+" and instance PID:"+o+" not found.")),i},h=function(t){var n,i,s,a,c={title:"",reference:{model:null},instance:{model:null,absPath:""},whereUsed:{isFetched:!1,references:[],instances:[]},children:{areFeteched:!1,references:[],instances:[]}};return e.is(t)?(n=m(t),i=n.refModel,s=n.instModel,a=n.absPath):1===o.getSelectedNodesCount()&&o.getSelectionsWithPaths().forEach((function(t){e.is(t)&&1===t.length&&t.forEach((function(e){n=m(e),i=n.refModel,s=n.instModel,a=n.absPath}))})),c.title=e.is(i)?r.getDisplayName(i):"",c.reference.model=i,c.instance.model=s,c.instance.absPath=a,c},y=function(){L.isActive()&&(L.resetFilter(),L.showModal(h()))},{name:"LinksModule",listenTo:function(){return{select:this.onSelect,Relations:this.onShowRelations,instanceAdded:this.onAddInstance,connectionAdded:this.onAddConnections,connectionRemoved:this.onRemoveConnections,referenceRemoved:this.onRemoveRefOrInst,referenceChanged:this.onChangeRefOrInst,instanceRemoved:this.onRemoveRefOrInst,instanceChanged:this.reloadUI,refreshImpacted:this.reloadUI,connectionChanged:this.reloadUI}},onStart:function(o,g){if(u=o||{},!e.is(u.relationsDialogDisplayAttributeConfigXML))return n.debug("LinksModule loading failed : relationsDialogDisplayAttributeConfigXML options are undefined"),void g();Promise.all([new Promise(p.bind(this))]).then((function(){(L=new t(n,i,s,a,r,c,l,d)).init({relAttributeConfig:f,relatedCmdId:u.relatedCmdId,acceptedTypes:u.pprTypes,exploreInWebApp:u.exploreInWebApp,filterToolbarSections:u.filterToolbarSections}),L.showModal(h(u.node)),g()}),(function(e){n.debug("LinksModule loading failed :"+e),g()}))},onStop:function(){L.destroy(),L=void 0},onRemoveRefOrInst:function(t){(t=Array.isArray(t)?t:[t]).forEach((function(t){e.is(t)&&L.isActive()&&(P(t.id)?L.clear():(L.updateWhereUsed(t),L.updateChildren(t)))}))},onChangeRefOrInst:function(t){(t=Array.isArray(t)?t:[t]).forEach((function(t){L.isActive()&&e.is(t)&&t.isReference()&&P(t.id)&&L.updateTitle(r.getDisplayName(t))}))},onShowRelations:function(t){var n;n=e.is(t)?e.is(t,"array")?t[0]:t:null,e.is(n)&&L.isActive()&&L.showModal(h(n))},onSelect:function(e){var t={},n=[];e&&L.isUsagePointsDialogVisible()&&!0===e.changed.isSelected?(n.push({id:e.changed.nodeId,path:e.changed.absPath}),(t=I(n))&&L.updateUsagePointsSelectionUI(t)):L.isUsagePointsDialogVisible()||y()},onAddConnections:function(t){var n,i,s;L.isActive()&&(s=function(t){return!!(e.is(t)&&(n=t.getAttribute("from"),i=t.getAttribute("to"),P(n)&&P(i)))},(e.is(t,"array")?t.some(s):s(t))&&L.showModal(L.getCurrentModel()))},onRemoveConnections:function(t){var n,i,s;L.isActive()&&(s=function(t){var s,o,r,c;if(e.is(t))if(n=t.getAttribute("from"),i=t.getAttribute("to"),"SecondaryCandidateResourceLink"===t.get("type")){if(s=a.getConnection(n),!e.is(s))return!1;if(o=s.getAttribute("from"),r=s.getAttribute("to"),c=i,P(o)||P(r)||P(c))return!0}else if(P(n)||P(i))return!0;return!1},(e.is(t,"array")?t.some(s):s(t))&&L.showModal(L.getCurrentModel()))},onAddInstance:function(t){e.is(t)&&L.isActive()&&P(t.get("isInstanceOf"),t.get("isAggregatedBy"))&&(L.updateWhereUsed(t),L.updateChildren(t))},reloadUI:function(){y()}}}}}));