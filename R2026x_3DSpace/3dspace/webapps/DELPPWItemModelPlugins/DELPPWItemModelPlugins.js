define("DS/DELPPWItemModelPlugins/MfgItem/MfgItemPlugin",["UWA/Core","DS/DELPPWModelServices/CollectionUtils","DS/DELPPWWebServices/WebserviceUtils","DS/DELPPWNavigationServices/NavigateUtil","DS/DELPPWModelServices/BehaviorUtil"],(function(e,t,n,o,i){"use strict";return function(r){const s="dsmfg/private/V0/scal/createMBOM",a="dsmfg/private/V0/scal/updateMBOM";return{name:"MfgItemPlugin",webserviceAndProcessing:function(i,s,a){var c,l,u,g=[],d={instancesAndReferences:[],connections:[]},m=JSON.parse(s),p=function(t,n){e.is(a)&&e.is(a.onFailure)&&a.onFailure(n)};m.rootMfgItemID&&(c=m.rootMfgItemID),u=n.getServerConfigurationRawXML("DELWebMfgAssetsLinkAuthoring.xml"),e.is(u,"string")&&(m.xmlLinkAuthoringConfig=u,s=e.Json.encode(m)),n.webServiceRequest({url:e.is(a.appenedURL)?"dsmfg/private/V0/invoke/MfgItem/"+a.appenedURL:"dsmfg/private/V0/invoke/MfgItem",method:i,logMessage:e.is(a.logMessage)?a.logMessage:null,headers:n.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0}),data:s,context:this,onFailure:p,onTimeout:p,onCancel:p,onComplete:function(n){var i,s={stackedReferences:[],stackedInstances:[],stackedConnections:[],deletedObjects:[]},u=[],m=[],p=null,f=!1,h=o.getConnectionParser(),P=function(n){e.is(n.revisedObjects)&&n.revisedObjects.forEach((function(e){e.revisedFrom===c&&(p=e.revisedTo),u.push(e.revisedTo)})),n.instancesAndReferences.forEach((function(t){var n=t.attributesValue;e.owns(n,"isInstanceOf")?(t.queriedForConnections=!0,s.stackedInstances.push(t)):(-1===u.indexOf(n.PID)&&(t.queriedForConnections=!0,t.queriedForDocuments=!0),m.push(n.PID),s.stackedReferences.push(t))})),n.connections.forEach((function(t){h.parse(t,s),d.connections.push(t),e.is(t["from.attributesValue"])&&t["from.attributesValue"].PID===c&&(f=!0)})),e.is(n.reusedReferences)&&(g=n.reusedReferences.filter((function(n){var o=e.is(t.getReferenceFromCollection(n)),i=-1!==m.indexOf(n);return!(o||i)}))),s.deletedObjects=s.deletedObjects.concat(n.deletedObjects);const o=s.stackedInstances.reduce((function(e,t){return"PROCESS"===t.attributesValue.PPRTYPE&&e.push(t.attributesValue),e}),[]);d.instancesAndReferences=d.instancesAndReferences.concat(o),r.getMediator().notify("createManufacturingItemStructure",d)};"RerouteMfgItem"===a.appenedURL?(i=n.succeeded,Object.keys(i).forEach((function(e){var t=i[e];Object.keys(t).forEach((function(e){P(t[e])}))}))):P(n),0!==s.deletedObjects.length||0!==s.stackedReferences.length||0!==s.stackedInstances.length||0!==s.stackedConnections.length||null!==p?(l=function(){var o=[];e.is(s.deletedObjects)&&s.deletedObjects.forEach((function(n){var i=t.getInstanceFromCollection(n);e.is(i)&&o.push(i)})),s.onComplete=function(){o.length>0&&(r.getMediator().notify("updateBIModelFromServerResponse",{deletedObjects:s.deletedObjects}),r.getMediator().notify("instanceRemoved",[o])),e.is(a)&&e.is(a.onComplete)&&a.onComplete(c,p,n,f)},t.addToCollections(s)},e.is(g,"array")&&g.length>0?o.getDescendantsFromServer(g,l,{expandLevel:0,silentMode:!0}):l()):e.is(a)&&e.is(a.onComplete)&&a.onComplete(null,null,n)}})},callScalUpdateMBOM:function(t){return new Promise(((o,r)=>{const s=i.isCloud()?n.getAppCloudServiceName():n.get3DSpaceServiceName();n.webServiceRequest({url:a,method:"POST",serviceName:s,headers:n.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0}),data:e.Json.encode(t),onFailure:(e,t)=>r(t),onTimeout:(e,t)=>r(t),onCancel:(e,t)=>r(t),onComplete:e=>o(e)})}))},callScalCreateMBOM:function(t){return new Promise(((o,r)=>{const a=i.isCloud()?n.getAppCloudServiceName():n.get3DSpaceServiceName();n.webServiceRequest({url:s,method:"POST",serviceName:a,headers:n.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0}),data:e.Json.encode(t),onFailure:(e,t)=>r(t),onTimeout:(e,t)=>r(t),onCancel:(e,t)=>r(t),onComplete:e=>o(e)})}))},getJobStatuses:function(){return new Promise(((e,t)=>{const o=i.isCloud()?n.getAppCloudServiceName():n.get3DSpaceServiceName();n.webServiceRequest({url:"dsmfg/private/V0/scal/getAllStatus",method:"GET",serviceName:o,headers:n.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0}),onComplete:function(t){e(t)},onFailure:function(e){t(e)}})}))},createMBOMOnResubmit:function(t,o){return new Promise(((r,a)=>{const c=i.isCloud()?n.getAppCloudServiceName():n.get3DSpaceServiceName();n.webServiceRequest({url:`${s}?correlationId=${o}`,method:"POST",serviceName:c,headers:n.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0}),data:e.Json.encode(t),onFailure:(e,t)=>a(t),onTimeout:(e,t)=>a(t),onCancel:(e,t)=>a(t),onComplete:function(e){r(e)}})}))},updateMBOMOnResubmit:function(t,o){return new Promise(((r,s)=>{const c=i.isCloud()?n.getAppCloudServiceName():n.get3DSpaceServiceName();n.webServiceRequest({url:`${a}?correlationId=${o}`,method:"POST",serviceName:c,headers:n.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0}),data:e.Json.encode(t),onFailure:(e,t)=>s(t),onTimeout:(e,t)=>s(t),onCancel:(e,t)=>s(t),onComplete:function(e){r(e)}})}))},refreshMBOMJob:function(e){return new Promise(((t,o)=>{const r=i.isCloud()?n.getAppCloudServiceName():n.get3DSpaceServiceName();n.webServiceRequest({url:`dsmfg/private/V0/scal/jobLatestStatus?correlationId=${e}`,method:"GET",serviceName:r,headers:n.getHeaders({isAuthoringCtx:!1,isJsonOnly:!0}),onFailure:(e,t)=>o(t),onTimeout:(e,t)=>o(t),onCancel:(e,t)=>o(t),onComplete:function(e){t(e)}})}))},getReferenceTypes:function(t){return new Promise(((o,i)=>{const r=n.get3DSpaceServiceName();n.webServiceRequest({url:"dsmfg/private/V0/invoke/delmodeler/getReferenceTypes",method:"POST",serviceName:r,headers:n.getHeaders({isAuthoringCtx:!1,isJsonOnly:!0}),data:e.Json.encode(t),onFailure:(e,t)=>i(t),onTimeout:(e,t)=>i(t),onCancel:(e,t)=>i(t),onComplete:function(e){o(e)}})}))}}}})),define("DS/DELPPWItemModelPlugins/BI/BIMakeBuyUtils",["UWA/Core","UWA/Class","DS/DELPPWIRPCModel/Collections/BIModelCollection","DS/DELPPWResourceServices/ResourceUtils","DS/DELPPWWebServices/WebserviceUtils"],(function(e,t,n,o,i){"use strict";return t.singleton({name:"BIMakeBuyUtils",init:function(e){this._parent(e),this.biModelCollection=new n},fetchBIMakeBuyStatus:function(t,n){const o=this;t=t||{};const r=function(n){e.is(t.onFailure,"function")&&t.onFailure.call(n)},s=e.is(t.rootEBOM)?t.rootEBOM:[],a=e.is(t.requiredItemType)?t.requiredItemType:"";if(s.length<=0&&""===a)return void r();const c={expandLevel:-1,requiredItemType:a,ebomIds:s,engConfigFilter:e.is(t.rootEBOMConfigFilter)?t.rootEBOMConfigFilter:{},isAuthoringMode:!!e.is(t.isAuthoringMode,"boolean")&&t.isAuthoringMode};i.webServiceRequest({url:"dsmfg/private/V0/invoke/BI/ProductMakeBuyStatus",method:"POST",onComplete:function(e){const t=o._addBIModelCollection(e);n instanceof Function&&n(t)},onFailure:r,onTimeout:r,data:e.Json.encode(c),headers:{Accept:"application/json",SecurityContext:i.getSecurityContext(),"Content-Type":"application/ds-json"}})},_addBIModelCollection:function(t){const n=this,i={silent:!0,merge:!0};let r=[];for(const s of Object.keys(t))for(const[a,c]of Object.entries(t[s])){let t="",s=[],l=[],u=[];const g=c.scopedItems,d=o.getNLSValue("BI.MakeBuy.None");Array.isArray(g)&&g.length>0?(g.forEach((t=>{const n=e.is(t.pid)?t.pid:"";u.push(n);const o=e.is(t.status)?t.status:d;s.push(o);const i=e.is(t.attributesValue)&&e.is(t.attributesValue.organization)?t.attributesValue.organization:"";l.push(i)})),g.length>1?t=o.getNLSValue("BI.MakeBuy.Multiple"):(t=e.is(g[0].status)?g[0].status:d,"Make"===t?t=o.getNLSValue("BI.MakeBuy.Make"):"Buy"===t&&(t=o.getNLSValue("BI.MakeBuy.Buy")))):t=d;let m={};m.id=a,m.organization=l,m.MakeOrBuy=s,m.scopedItemIDs=u,m.status=t,m.type="ProductMakeBuyStatus",r.push(n.biModelCollection.add(m,i))}return r},isBIMakeBuyComputed:function(){return this.biModelCollection.size()>0},resetBIModelCollection:function(){!0===this.isBIMakeBuyComputed()&&this.biModelCollection.reset()},setBIModelEvents:function(e){this.biModelCollection.addEvents(e)},removeBIModelEvents:function(){this.biModelCollection.removeEvents()},getBIModelCollection:function(){return this.biModelCollection},getBIModel:function(e){return this.biModelCollection.get(e)}})})),define("DS/DELPPWItemModelPlugins/ImplementPlugin/ImplementBase",["UWA/Core","DS/DELPPWModelServices/CollectionUtils"],(function(e,t){"use strict";return function(n,o,i,r,s,a,c){var l,u,g,d,m,p,f,h="ImplementBase",P=i,I=r,S=s,C="DELMBOMContextualImplementCnx",M=a;if(c=!e.is(c)||c,!e.is(P))throw new Error("Error: scope link name is not defined!");if(!e.is(S))throw new Error("Error: implment link name is not defined!");return p=function(t){var n=!1;return e.is(t)&&e.is(t.type,"string")&&("BL Error"===t.type||"Specific Error"===t.type)&&e.is(t.message,"string")&&t.message.length>0&&(n=!0),n},l=function(n,o,i){var r=[P];return e.is(o,"string")&&(r=[o]),t.getImpactedConnections(n,null,{isRefRefOnly:!0,relationTypes:r,fromXEN:i})},u=function(n,o,i){var r=[I];return e.is(o,"string")&&(r=[o]),t.getImpactedConnections(n,null,{isRefRefOnly:!0,relationTypes:r,fromXEN:i})},g=function(n,o,i){var r=[M];return e.is(o,"string")&&(r=[o]),t.getImpactedConnections(n,null,{isRefRefOnly:!0,relationTypes:r,fromXEN:i})},d=function(e){var n,i=e;return Array.isArray(e)&&((n=e).length>0?i=t.getInstanceFromCollection(n[n.length-1]).get("isInstanceOf"):(i=null,o.debug(h,"Error: expected reference id for root node"))),i},m=function(n){var i=[];return e.is(n,"function")?i=t.findSomeConnection((function(e){var t=S===e.get("type")||C===e.get("type"),o=!1;return t&&(o=n(e.get("from"),e.get("to"))),t&&o})):o.debug(h,'Error: _getImplementLinks: expected a predicate method "funcHasImplement"'),i},f=function(i,r){var s=r||{},a={onComplete:function(t){e.is(s.onComplete)&&s.onComplete("ImplementPlugin.DeleteImpl.Success",t),e.is(t)&&n.getMediator().notify("updateBIModelFromServerResponse",t)},onFailure:function(t,n){e.is(s.onFailure)&&(p(n)?r.onFailure("ImplementPlugin.DeleteImpl.Failed",n.message):r.onFailure("ImplementPlugin.DeleteImpl.Failed"))}};e.is(i)?t.deleteConn(i,a):(o.debug(h,"Input connection ID is invalid."),s.onFailure("ImplementPlugin.DeleteImpl.Failed"))},{getReferencePID:function(e){return d(e)},filterImplementLinks:function(e){return m(e)},findInstanceWhoseParentIsScoped:function(n){var o,i,r,s,a=null;for(o=n.length-1;o>=0;o--)if(i=t.getInstanceFromCollection(n[o]),e.is(i)&&(s=i.get("isAggregatedBy"),(r=l(s)).length>0)){a={absPathIndex:o,instanceModel:i,scopeLinks:r};break}return a},findInstanceWhoseParentIsPartialScoped:function(n){var o,i,r,s,a=null;for(o=n.length-1;o>=0;o--)if(i=t.getInstanceFromCollection(n[o]),e.is(i)&&(s=i.get("isAggregatedBy"),(r=u(s)).length>0)){a={absPathIndex:o,instanceModel:i,scopeLinks:r};break}return a},getScopedParent:function(t){var n,o=null;return e.is(t,"array")&&t.length>0&&(n=this.findInstanceWhoseParentIsScoped(t),e.is(n)&&(o=n.instanceModel.get("isAggregatedBy"))),o},getPartialScopedParent:function(t){var n,o=null;return e.is(t,"array")&&t.length>0&&(n=this.findInstanceWhoseParentIsPartialScoped(t),e.is(n)&&(o=n.instanceModel.get("isAggregatedBy"))),o},isUnderScope:function(t){var n,i=!1;return e.is(t,"array")?t.length>0&&(n=this.findInstanceWhoseParentIsScoped(t),e.is(n)&&(i=!0)):(o.debug(h,"Error: isUnderScope: expected absolute path"),i=null),i},isUnderPartialScope:function(t){var n,i=!1;return e.is(t,"array")?t.length>0&&(n=this.findInstanceWhoseParentIsPartialScoped(t),e.is(n)&&(i=!0)):(o.debug(h,"Error: isUnderScope: expected absolute path"),i=null),i},isPartialOrFullScoped:function(e){let t=!1;if(this.getScopeLinks(e).length>0)t=!0;else{this.getPartialScopeLinks(e).length>0&&(t=!0)}return t},isScoped:function(e){return this.getScopeLinks(e).length>0},getScopedEBOMFromMBOM:function(t){const n=this.getScopeLinks(t);let o=null;return e.is(n)&&n.length>0&&(o=n[0].getAttribute("to")),o},isPartialScoped:function(e){return this.getPartialScopeLinks(e).length>0},getPartialScopedEBOMFromMBOM:function(t){const n=this.getPartialScopeLinks(t);let o=null;return e.is(n)&&n.length>0&&(o=n[0].getAttribute("to")),o},isResultingLinked:function(e){return this.getResultingProductLinks(e).length>0},getScopeLinks:function(e,t,n){var o=d(e),i=[];return o&&(i=l(o,t,n)),i},getPartialScopeLinks:function(e,t,n){var o=d(e),i=[];return o&&(i=u(o,t,n)),i},getResultingProductLinks:function(e){var t=d(e),n=[];return t&&(n=g(t)),n},getResultingProductLinksOfImplementing:function(e,t){var n,i=d(e),r=[];return i&&(n=g(i,M,t),Array.isArray(n)&&(1===n.length&&n[0].getAttribute("to")!==i?r=n:n.length>1&&o.debug(h,"ERROR: getResultingProductsLinksOfImplementing found more than one scope link for MfgItem: "+e))),r},getResultingProductLinksOfImplemented:function(e){var t,n=d(e),i=[];return n&&(t=g(n,M),Array.isArray(t)&&(1===t.length?i=t:t.length>1&&o.debug(h,"ERROR: getResultingProductsLinksOfImplementing found more than one scope link for MfgItem: "+e))),i},getScopeLinksOfImplemented:function(e){var t,n=d(e),o=[];return n&&(t=l(n,P),Array.isArray(t)&&(o=t)),o},getPathToScope:function(t){var n,o=[];return n=this.findInstanceWhoseParentIsScoped(t),e.is(n)&&(o=t.slice(n.absPathIndex)),o},getPathToPartialScope:function(t){var n,o=[];return n=this.findInstanceWhoseParentIsPartialScoped(t),e.is(n)&&(o=t.slice(n.absPathIndex)),o},getPathToPartialOrFullScope:function(t,o){const i=this.getPathsTillUpperScope(t,o),r=((t,o)=>{let i=null;const r=n.getPlugins("DatabasePlugin").instance,s=this.isUnderPartialScope(t);let a=!1;if(Array.isArray(t)&&t.length>0){let e=t[t.length-1];const n=r.getReferenceIdFromInstance(e);u(n).length>0&&(a=!0)}return(e.is(s)&&s||e.is(a)&&a)&&(i=this.getPathsTillUpperPartialScope(t,o)),i})(t,o);let s=i;return Array.isArray(r)&&Array.isArray(i)?s=((...e)=>{let t=e[0];const n=e.length;for(let o=1;o<n;o++)e[o].length<t.length&&(t=e[o]);return t})(r,i):Array.isArray(r)&&(s=r),s},getPathsTillUpperScope:function(t,n){let o=[],i=!1,r=[];return e.is(t)&&(r=this.getListOfImplementingParentPID(t,!0)),e.is(n)&&(n.reverse().forEach((t=>{if(!i){const n=this.findInstanceWhoseParentIsScoped([t]);if(e.is(n)&&e.is(n.scopeLinks)){n.scopeLinks.forEach((e=>{const t=e.getAttribute("from");r.includes(t)&&(i=!0)}))}o.push(t)}})),n.reverse()),o.reverse()},getPathsTillUpperPartialScope:function(t,n){let o=[],i=!1,r=[];return e.is(t)&&(r=this.getListOfImplementingParentPID(t,!0)),e.is(n)&&(n.reverse().forEach((t=>{if(!i){const n=this.findInstanceWhoseParentIsPartialScoped([t]);if(e.is(n)&&e.is(n.scopeLinks)){n.scopeLinks.forEach((e=>{const t=e.getAttribute("from");r.includes(t)&&(i=!0)}))}o.push(t)}})),n.reverse()),o.reverse()},getListOfImplementingParentPID:function(t,o){let i=[];const r=n.getPlugins("DatabasePlugin").instance;if(Array.isArray(t)){if(t.forEach((e=>{const t=r.getParentReferenceIdFromInstance(e);i.push(t)})),e.is(o)&&!0===o){const e=t[t.length-1],n=r.getReferenceIdFromInstance(e);i.push(n)}}else e.is(t)&&i.push(t);return i},getPathsToScope:function(e,t){return{implementingPathToScope:this.getPathToScope(e),implementedPathToScope:this.getPathToPartialOrFullScope(e,t)}},getImplLinks:function(t){var n,o,i;return e.is(t,"array")?(n=t[t.length-1],o=this.getPathToScope(t),i=m((function(t,i){return n===t||e.Json.encode(o)===e.Json.encode(i)}))):i=null,i},getImplLinksOfImplemented:function(t){var n,o;return Array.isArray(t)?(n=this.getPathToScope(t),o=m((function(t,o){return e.equals(n,o)}))):o=null,o},hasCrossScope:function(n,o,i,r){var s,a,c,g,d,m=[],p=[],f=[],h=[],P=null,I=!1,S=null,C=null,M=!1,y=!1;return d=function(e,t){var n=null;return e.some((function(e){var o=l(e);return(o=o.concat(u(e))).some((function(e){var o=!1,i=e.get("to");return t.indexOf(i)>-1&&(o=!0,n=e),o}))})),n},e.is(r,"array")&&r.length>0&&r.forEach((function(n,i){var s=t.getInstanceFromCollection(n);0===i&&f.push(s.get("isAggregatedBy")),r.length-1!==i?f.push(s.get("isInstanceOf")):e.is(o)||(o=s.get("isInstanceOf"))})),e.is(i,"array")&&i.length>0&&i.forEach((function(o,r){var s=t.getInstanceFromCollection(o);0===r&&m.push(s.get("isAggregatedBy")),i.length-1!==r?m.push(s.get("isInstanceOf")):e.is(n)||(n=s.get("isInstanceOf"))})),e.is(o)&&m.length>0&&t.expandOnBackbone(o,{referencesPID:h,instancesPID:[]}),e.is(n)&&f.length>0&&t.expandOnBackbone(n,{referencesPID:p,instancesPID:[]}),!e.is(P)&&m.length>0&&h.length>0&&(P=d(m,h),e.is(P)&&(M=!0)),!e.is(P)&&p.length>0&&f.length>0&&(P=d(p,f),e.is(P)&&(y=!0)),e.is(P)&&(I=!0,s=P.getAttribute("from"),c=t.getReferenceFromCollection(s),e.is(c)&&(S=c.get("PLMEntity.V_Name")),a=P.getAttribute("to"),g=t.getReferenceFromCollection(a),e.is(g)&&(C=g.get("PLMEntity.V_Name"))),{hasCrossScope:I,implementingName:S,implementedName:C,isParentCrossScope:M,isChildCrossScope:y}},getScopeLinkType:function(){return P},getPartialScopeLinkType:function(){return I},getResultingProductLinkType:function(){return M},getImplementLinkType:function(){return S},getContextualImplementLinkType:function(){return C},deleteImplementLink:function(e,t){f(e,t)},deleteScopeLink:function(n,i){var r;r={onComplete:function(){e.is(i)&&e.is(i.onComplete)&&i.onComplete("ImplementPlugin.DeleteScope.Success")},onFailure:function(t,n){e.is(i)&&e.is(i.onFailure)&&(p(n)?i.onFailure("ImplementPlugin.DeleteScope.Failed",n.message):i.onFailure("ImplementPlugin.DeleteScope.Failed"))}},e.is(n)?t.deleteConn(n,r):(o.debug(h,"Input connection ID is invalid."),r.onFailure("ImplementPlugin.DeleteScope.Failed"))},createImplementLink:function(o,i,r){var s,a,l;r=r||{},l=function(t,n){e.is(r.onFailure,"function")&&(p(n)?r.onFailure("ImplementPlugin.CreateImpl.Failed",n.message):r.onFailure("ImplementPlugin.CreateImpl.Failed"))},c?(o=o.toString(),i=i.toString()):(o=e.Json.encode(o),i=e.Json.encode(i)),s={type:S,IDFrom:o,IDTo:i},e.is(r.connectionParams)&&(s.connectionParams=r.connectionParams),a={onFailure:l,onTimeout:l,onCancel:l,onComplete:function(t){if(e.is(r.onComplete,"function")&&r.onComplete("ImplementPlugin.CreateImpl.Success",t),e.is(t)&&e.is(t.id)){const e={connections:[{PID:t.id}]};n.getMediator().notify("updateBIModelFromServerResponse",e)}},securityContextOverride:r.securityContextOverride},t.createConn(s,a)},createScopeLink:function(o,i,r){var s,a,c=function(t,n){e.is(r.onFailure,"function")&&(p(n)?r.onFailure("ImplementPlugin.CreateScope.Failed",n.message):r.onFailure("ImplementPlugin.CreateScope.Failed"))};r=r||{};const l=e.is(r.copyModelProductToItemUponSL)?r.copyModelProductToItemUponSL:"DoNotCopyModel";s={type:P,IDFrom:o,IDTo:i,copyModelProductToItemUponSL:l},a={onFailure:c,onTimeout:c,onCancel:c,onComplete:function(t){if(e.is(r.onComplete,"function")&&r.onComplete("ImplementPlugin.CreateScope.Success"),e.is(t)&&e.is(t.id)){let e=[];const o={PID:t.id};e.push(o);const i=r.implementLinks;Array.isArray(i)&&i.length>0&&e.push(...i);let s={connections:e};n.getMediator().notify("updateBIModelFromServerResponse",s)}}},t.createConn(s,a)}}}})),define("DS/DELPPWItemModelPlugins/BI/BIUtils",["UWA/Core","UWA/Class","DS/DELPPWIRPCModel/Collections/BIModelCollection","DS/DELPPWWebServices/WebserviceUtils"],(function(e,t,n,o){"use strict";const i="MfgItemsUpdateStatus";return t.singleton({name:"BIUtils",init:function(e){this._parent(e),this.biModelCollection=new n,this._mbomArray=[],this._embomArray=[],this._mbomConfigFilter={},this._ebomConfigFilter={},this._pseudoBIStatusIdSet=new Set},getBrokenMfgItemStatus:function(t,n){var o;(t=t||{}).silent=!0,this._fetchStatus(t,(function(t){e.is(t)&&(Array.isArray(t)?(o=t.filter((t=>{const n=t._attributes;let o=!1;return e.is(n.type)&&n.type===i&&e.is(n.isBroken,"boolean")&&!0===n.isBroken&&(o=!0),o})),n(o)):(o=t.where({type:i,isBroken:!0}),n(o)))}))},getPhantomNodeItems:function(){return this.biModelCollection.filter((t=>{const n=t.get("status");let o=!1;return e.is(n,"string")&&(o=n.toLowerCase().includes("intermediate")),o}))},getProductAssignmentStatus:function(){var t;return e.is(this.biModelCollection)&&(t=this.biModelCollection.where({type:"ProductsAssignmentStatus"})),t},getMfgItemUpdateStatus:function(){var t;return e.is(this.biModelCollection)&&(t=this.biModelCollection.where({type:i})),t},_fetchStatus:function(t,n){const o=this;let i=t||{};(function(t){const n=!!e.is(t.forceBIComputation,"boolean")&&t.forceBIComputation;return new Promise((e=>{n||!o.isBIComputed()?o.fetchBIComputation(t,(function(t){e(t)})):e([])}))})(i).then((function(t){const r=!!e.is(i.areRootsBroken,"boolean")&&i.areRootsBroken;n(r?t:o.biModelCollection)})).catch((function(){n([])}))},fetchBIComputation:function(t,n){var i,r,s,a,c=this,l=function(n){e.is(t.onFailure,"function")&&t.onFailure.call(n)};if(t=t||{},r=!e.is(t.silent,"boolean")||t.silent,c._mbomArray=e.is(t.rootMBOM)?t.rootMBOM:c._mbomArray,c._embomArray=e.is(t.rootEBOM)?t.rootEBOM:c._embomArray,c._mbomConfigFilter=e.is(t.rootMBOMConfigFilter)?t.rootMBOMConfigFilter:{},c._ebomConfigFilter=e.is(t.rootEBOMConfigFilter)?t.rootEBOMConfigFilter:{},s=!!e.is(t.areRootsBroken,"boolean")&&t.areRootsBroken,a=e.is(t.prefix)?t.prefix:null,c._mbomArray.length<=0||c._embomArray.length<=0)return void l();const u=!!e.is(t.isAuthoringMode,"boolean")&&t.isAuthoringMode;i={expandLevel:-1,ordered:!0,mbomIds:c._mbomArray,ebomIds:c._embomArray,engConfigFilter:c._ebomConfigFilter,mfgConfigFilter:c._mbomConfigFilter,areRootsBroken:s,isAuthoringMode:u},o.webServiceRequest({url:"dsmfg/private/V0/invoke/BI",method:"POST",onComplete:function(e){const t=c._addToBIModelCollection(a,e,{silent:r,merge:!0});n instanceof Function&&n(t)},onFailure:l,onTimeout:l,data:e.Json.encode(i),headers:{Accept:"application/json",SecurityContext:o.getSecurityContext(),"Content-Type":"application/ds-json"}})},_addToBIModelCollection:function(t,n,o){const r=e=>(...t)=>t.join(e),s=r(","),a=r("/"),c=t=>e.is(t.isRef)&&!0===t.isRef,l=(e,t=null)=>{const n=e.length;return n>0?e[n-1]:t},u=this;let g,d,m;e.is(t)&&({mfgAggByPath:g,mfgOccPath:d,mfgInstanceLID:m}=t);let p=[];for(const r of Object.keys(n))for(const[f,h]of Object.entries(n[r])){let n=f,P=e.clone(h);if(e.is(t)&&r===i){if(e.is(P.aggregatedByPath)){const e=l(d.split(","));P.aggregatedByPathTillRoot=s(g,a(e,m),P.aggregatedByPath)}c(P)||(n=s(d,f))}P.id=n,P.type=r,e.is(t)&&u._pseudoBIStatusIdSet.add(P.id),p.push(u.biModelCollection.add(P,o))}return p},isBIComputed:function(){return this.biModelCollection.size()>0},resetBIModelCollection:function(){!0===this.isBIComputed()&&(this.clearPseudoBIStatus(),this.biModelCollection.reset())},clearPseudoBIStatus:function(){if(this.isBIComputed()&&this._pseudoBIStatusIdSet.size>0){const e={silent:!0};for(const t of this._pseudoBIStatusIdSet)this.biModelCollection.remove(t,e);this._pseudoBIStatusIdSet.clear()}},getProductStatus:function(e,t){if("ProductImplementLinkOcc"===t){if(0===e.length)return"NotAssigned";if(1===e.length)return"AssignedDirectly";if(1<e.length)return"AssignedMoreThanOnce"}else if("ProductImplementLink"===t||"PartialProductImplementLink"===t){if(0===e.length)return"NotAssigned";if(1===e.length)return"AssociatedWithScope";if(1<e.length)return"AssignedMoreThanOnce"}},getProcessStatus:function(t,n){if(e.is(n)){if("ProductImplementLinkOcc"===t)return"ImplGood";if("ProductImplementLink"===t||"PartialProductImplementLink"===t)return"ScopeGood"}return"NotApplicable"},setBIModelEvents:function(e){this.biModelCollection.addEvents(e)},removeBIModelEvents:function(){this.biModelCollection.removeEvents()},getBIModelCollection:function(){return this.biModelCollection},getBIModel:function(e){return this.biModelCollection.get(e)}})})),define("DS/DELPPWItemModelPlugins/ImplementPlugin/ProductImplementPlugin",["UWA/Core","DS/DELPPWModelServices/ModelUtils","DS/DELPPWModelServices/CollectionUtils","DS/DELPPWWebServices/WebserviceUtils","DS/DELPPWNavigationServices/NavigateUtil","DS/DELPPWModelServices/BehaviorUtil","DS/DELPPWItemModelPlugins/ImplementPlugin/ImplementBase"],(function(e,t,n,o,i,r,s){"use strict";return function(a){var c,l,u,g,d="ProductImplementPlugin",m="ProductImplementLink",p="ProductImplementLinkOcc",f="ResultingProductLink",h="PartialProductImplementLink",P=function(t,n,o,i){var r,s=i||{};e.is(o)&&(c.debug(d,t+"failed with error: %s ",JSON.stringify(o)),e.is(o.message,"string")&&(r=o.message)),e.is(s.onFailure,"function")&&s.onFailure(n,r)};return l=new s(a,a.getLogger(),m,h,p,f,!1),function(t,n){e.is(t,"array")&&t.length>0&&e.is(n)&&e.is(t[0].getAttribute("to"),"string")&&(n.rootEBOM=t[0].getAttribute("to"),n.rootMBOM=t[0].getAttribute("from"))},g=function(t,o){var i=o||{},r={onComplete:function(t){e.is(i)&&e.is(i.onComplete)&&(i.onComplete("ImplementPlugin.DeleteScope.Success",t),a.getMediator().notify("updateBIModelFromServerResponse",t))},onFailure:function(n,o){e.is(i.onFailure)&&P("Delete scope link for id:"+t,"ImplementPlugin.DeleteScope.Failed",o,i)}};e.is(t)?n.deleteConn(t,r):i.onFailure("Connection ID is not valid.")},u=function(){o.webServiceRequest({url:"delmia/param/configuration/getParameters?domainID=DigitalManufacturing&familyID=MfgItemsBehavior&paramID=LifecycleSyncBetweenProvideAnd3DPartCheckbox&argID=LifecycleSyncBetweenProvideAnd3DPartArg",method:"GET",onComplete:function(n){var o=1===n.length&&"Enabled"===n[0].value,i=a.getService("ConfigService"),r=widget.getValue("fromXen");if(e.is(i))if(r)i.setPreference("isReleaseSyncXENEnabled",o);else switch(t.getWidgetTrigram()){case"MFN":case"CST":case"SIE":i.setPreference("isReleaseMaturitySynced",o)}},onFailure:function(e){console.log("Failure to fetch parameter LifecycleSyncBetweenProvideAnd3DPart")},onTimeout:function(e){console.log("Timeout when fetching LifecycleSyncBetweenProvideAnd3DPart")}})},e.extend(l,{onStart:function(){c=a.getLogger(),u()},getImplLinksOfImplemented:function(t){var o,i,r=Object.create(null),s=t.length,a=null;if(Array.isArray(t)){for(o=1;o<=s;o++)i=t.slice(s-o),r[i.length.toString()]=i;a=l.filterImplementLinks((function(t,n){var o=r[n.length.toString()],i=!1;return e.is(o)&&(i=e.equals(o,n)),i})).filter((function(t){var o=t.get("from"),i=!1;return e.is(o,"string")&&(i=n.isInstance(o)),i}))}return a},getScopeLinksOfImplementing:function(e,t){var n,o=l.getReferencePID(e),i=[];return o&&(n=l.getScopeLinks(o,m,t),Array.isArray(n)&&(1===n.length&&n[0].getAttribute("to")!==o?i=n:n.length>1&&c.debug(d,"ERROR: getScopeLinksOfImplementing found more than one scope link for MfgItem: "+e))),i},getConsumptionInfoFromOccurence:function(t,n){const{implementingPathToScope:o,implementedPathToScope:i}=this.getPathsToScope(t,n);let r=l.getReferencePID(t);this.isScoped(r)||(r=o.length>0?l.getScopedParent(o):r);let s=l.getPartialScopedEBOMFromMBOM(r);e.is(s)||(s=l.getScopedEBOMFromMBOM(r)),e.is(s)||(s=l.getReferencePID(n));return{ebomRootPID:s,ebomPathToScope:i,mbomRootPID:r}},getPartialScopeLinksOfImplementing:function(e,t){var n,o=l.getReferencePID(e),i=[];return o&&(n=l.getPartialScopeLinks(o,h,t),Array.isArray(n)&&(1===n.length&&n[0].getAttribute("to")!==o?i=n:n.length>1&&c.debug(d,"ERROR: getPartialScopeLinksOfImplementing found more than one scope link for MfgItem: "+e))),i},deleteScopeLink:function(e,t){g(e,t)},consumeImplementedItems:function(r,s,c,l,u,g){var d,m=g||{},p={rootProductID:r,productOccPaths:s,rootMfgItemID:c,targetMfgItemID:l,targetItemUpperScopePath:u,expandBy:t.getNavigateOnIndex()?"index":"database",computeResultReport:!!e.is(g.computeResultReport)&&g.computeResultReport},f=function(e,t){P("Create mbom from ebom","ImplementPlugin.Consumption.Failed",t,m)},h=o.getServerConfigurationRawXML("DELWebMfgAssetsPhantomNodeConfig.xml"),I=o.getServerConfigurationRawXML("DELWebMfgAssetsLinkAuthoring.xml");e.is(h,"string")&&(p.xmlPhantomNodeConfig=h),e.is(I,"string")&&(p.xmlLinkAuthoringConfig=I),e.is(g.insertSpareItemOnAssign)&&(p.insertSpareItemOnAssign=g.insertSpareItemOnAssign);const S=e.is(g.copyModelProductToItemUponSL)?g.copyModelProductToItemUponSL:"DoNotCopyModel";p.copyModelProductToItemUponSL=S;const C=!!e.is(g.copyModelParentToChild)&&g.copyModelParentToChild;p.copyModelParentToChild=C,d={url:"dsmfg/private/V0/invoke/MfgItem/CreateMBOMFromEBOM",method:"POST",context:this,headers:o.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0}),data:e.Json.encode(p),onComplete:function(t){var o,r,s=[],c=i.getConnectionParser(),l={stackedReferences:[],stackedInstances:[],stackedConnections:[],onComplete:function(n){var o=[],i=[];if(e.is(n.instancesAndReferences,"array")&&n.instancesAndReferences.length>0){if(n.instancesAndReferences.forEach((function(e){e.isInstance()?o.push(e):i.push(e)})),o.length>0){const e=o.filter((function(e){return"VPMInstance"!==e.get("type")}));a.getMediator().notify("instanceAdded",[e])}i.length>0&&a.getMediator().notify("referenceChanged",[i])}e.is(m.onComplete,"function")&&(m.onComplete("ImplementPlugin.Consumption.Success",n,t),a.getMediator().notify("consumeProductOnDragAndDrop")),a.getMediator().notify("updateBIModelFromServerResponse",t)},onFailure:f};e.is(t)&&e.is(t.instancesAndReferences,"array")&&e.is(t.connections,"array")&&t.connections.length>0?(t.instancesAndReferences.forEach((function(t){var n=e.is(t.attributesValue)?t.attributesValue:t;Object.prototype.hasOwnProperty.call(n,"isInstanceOf")?l.stackedInstances.push(t):(l.stackedReferences.push(t),s.push(n.PID))})),t.connections.forEach((function(e){c.parse(e,l)})),e.is(t.reusedReferences)&&(o=t.reusedReferences.filter((function(t){var o=e.is(n.getReferenceFromCollection(t)),i=-1!==s.indexOf(t);return!(o||i)}))),r=function(){n.addToCollections(l)},e.is(o,"array")&&o.length>0?i.getDescendantsFromServer(o,r,{expandLevel:0,silentMode:!0}):r()):e.is(m.onComplete,"function")&&m.onComplete("ImplementPlugin.Consumption.Failed",null,t)},onFailure:f,onTimeout:f,onCancel:f},o.webServiceRequest(d)},createScopeAndImplementLink:function(t,r,s,c,l){var u,g=l||{},d={productID:s,processID:t,processUpperScopePath:e.Json.encode(r),productPath:e.Json.encode(c)},m=function(e,t){P("Create scope and implement link","ImplementPlugin.CreateScope.Failed",t,g)},p=o.getServerConfigurationRawXML("DELWebMfgAssetsLinkAuthoring.xml");e.is(p,"string")&&(d.xmlLinkAuthoringConfig=p);const f=e.is(l.copyModelProductToItemUponSL)?l.copyModelProductToItemUponSL:"DoNotCopyModel";d.copyModelProductToItemUponSL=f,u={url:"dsmfg/private/V0/invoke/createscopeandimplementlink",method:"POST",headers:o.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0}),data:e.Json.encode(d),onFailure:m,onTimeout:m,onCancel:m,onComplete:function(t){var o=i.getConnectionParser(),r={stackedReferences:[],stackedInstances:[],stackedConnections:[],onComplete:function(n){var o=[];e.is(n.instancesAndReferences,"array")&&n.instancesAndReferences.length>0&&(n.instancesAndReferences.forEach((function(e){e.isReference()&&o.push(e)})),o.length>0&&a.getMediator().notify("referenceChanged",[o])),e.is(n.connections,"array")&&n.connections.length>0&&(a.getMediator().notify("connectionAdded",[n.connections]),e.is(g.onComplete,"function")&&(g.onComplete("ImplementPlugin.CreateScope.Success",n),a.getMediator().notify("updateBIModelFromServerResponse",t)))}};e.is(t)&&e.is(t.instancesAndReferences,"array")&&e.is(t.connections,"array")&&t.connections.length>0?(t.instancesAndReferences.forEach((function(t){var n=e.is(t.attributesValue)?t.attributesValue:t;Object.prototype.hasOwnProperty.call(n,"isInstanceOf")?r.stackedInstances.push(t):r.stackedReferences.push(t)})),t.connections.forEach((function(e){o.parse(e,r)})),n.addToCollections(r)):m()}},o.webServiceRequest(u)},canCreateScopeLink:function(t){var o,i,r,s,c,l,u,g,d,p=m,f=!0,h=a.getPlugins("ResourcePlugin").instance,P={};return o=t.fromSideRefPID,i=t.toSideRefPID,r=t.fromSideAbsPath,s=t.toSideAbsPath,g=n.getReferenceModel(o),this.isScoped(o)&&(f=!1,d=h.getNLSValue("ImplementBehavior.Validation.ScopeLinkExists",{objectName:g.get("PLMEntity.V_Name")})),f&&!0===this.isPartialScoped(o)&&(f=!1,d=h.getNLSValue("ImplementBehavior.Validation.PartialScopeLinkExists",{objectName:g.get("PLMEntity.V_Name")})),(f&&e.is(r,"array")&&r.length>0||e.is(s,"array")&&s.length>0)&&(u=this.hasCrossScope(o,i,r,s),e.is(u)&&u.hasCrossScope&&(u.isParentCrossScope?d=h.getNLSValue("ImplementBehavior.Validation.ParentCrossScopeExists",{implementingRef:u.implementingName,implementedRef:u.implementedName}):u.isChildCrossScope&&(d=h.getNLSValue("ImplementBehavior.Validation.ChildCrossScopeExists",{implementingRef:u.implementingName,implementedRef:u.implementedName})),f=!1)),e.is(t.fromSideInstPID)&&e.is(t.toSideInstPID)?(c=t.fromSideInstPID,l=t.toSideInstPID):(c=t.fromSideRefPID,l=t.toSideRefPID),P={canCreateLink:f,data:{type:p,implementingPID:c,implementedPID:l,implementingAbsPath:t.fromSideAbsPath,implementedAbsPath:t.toSideAbsPath,displayText:h.getNLSValue(p,null,"CreateLink"),buttonIdentifier:h.getNLSValue(p,null,"CreateLink")}},f||(P.errorMessage=d),P},canCreatePartialScopeLink:function(t){var o,i,r,s,c,l,u,g,d,m=h,p=!0,f=a.getPlugins("ResourcePlugin").instance,P={};return o=t.fromSideRefPID,i=t.toSideRefPID,r=t.fromSideAbsPath,s=t.toSideAbsPath,g=n.getReferenceModel(o),!0===this.isPartialScoped(o)&&(p=!1,d=f.getNLSValue("ImplementBehavior.Validation.PartialScopeLinkExists",{objectName:g.get("V_Name")})),p&&!0===this.isScoped(o)&&(p=!1,d=f.getNLSValue("ImplementBehavior.Validation.ScopeLinkExists",{objectName:g.get("V_Name")})),(p&&e.is(r,"array")&&r.length>0||e.is(s,"array")&&s.length>0)&&(u=this.hasCrossScope(o,i,r,s),e.is(u)&&u.hasCrossScope&&(u.isParentCrossScope?d=f.getNLSValue("ImplementBehavior.Validation.ParentCrossScopeExists",{implementingRef:u.implementingName,implementedRef:u.implementedName}):u.isChildCrossScope&&(d=f.getNLSValue("ImplementBehavior.Validation.ChildCrossScopeExists",{implementingRef:u.implementingName,implementedRef:u.implementedName})),p=!1)),e.is(t.fromSideInstPID)&&e.is(t.toSideInstPID)?(c=t.fromSideInstPID,l=t.toSideInstPID):(c=t.fromSideRefPID,l=t.toSideRefPID),P={canCreateLink:p,data:{type:m,implementingPID:c,implementedPID:l,implementingAbsPath:t.fromSideAbsPath,implementedAbsPath:t.toSideAbsPath,displayText:f.getNLSValue(m,null,"CreateLink"),buttonIdentifier:f.getNLSValue(m,null,"CreateLink")}},p||(P.errorMessage=d),P},canCreateResultingProductLink:function(t){var n,o=f,i=t.fromSideRefPID,r=t.toSideRefPID,s=a.getPlugins("ResourcePlugin").instance,c=!0,l={};return n=i,!0===this.isResultingLinked(n)&&(c=!1),l={canCreateLink:c},c&&(l.data=e.merge({type:o,IDFrom:i,IDTo:r,displayText:s.getNLSValue(o,null,"CreateLink"),buttonIdentifier:s.getNLSValue(o,null,"CreateLink")},e.clone(t))),l},getImplLinksOfImplementing:function(e){var t,n,o,i=[];return Array.isArray(e)&&e.length>0?(t=e[e.length-1],n=this.filterImplementLinks((function(e){return o=Array.isArray(e)?e[e.length-1]:e,t===o})),Array.isArray(n)&&(1===n.length?i=n:n.length>1&&(c.debug(d,"ERROR: getImplLinksOfImplementing found more than one implement link for MfgItem: "+e),i=null))):i=null,i},canCreateImplementLink:function(t){var n,o,i,r=p,s=a.getPlugins("ResourcePlugin").instance,c={};return n=t.fromSideAbsPath,o=t.toSideAbsPath,c={canCreateLink:i=this.isImplementLinkPossible(n,o)},i&&(c.data=e.merge({type:r,implementingAbsPath:n,implementedAbsPath:o,displayText:s.getNLSValue(r,null,"CreateLink"),buttonIdentifier:s.getNLSValue(r,null,"CreateLink")},e.clone(t))),c},isImplementLinkPossible:function(t,o){var i,r,s=!1,a=null;return e.is(t,"array")&&t.length>0&&e.is(o,"array")&&o.length>0&&(i=this.getScopedParent(t),r=this.getScopedParent(o),e.is(i)&&e.is(r)&&!0===(s=n.hasConnection({to:r,from:i,type:m}))&&(a=this.getImplLinksOfImplementing(t),Array.isArray(a)&&a.length>0&&(s=!1))),s},isDeleteOfProductImplementLinkAllowed:function(){return r.isDeleteOfProductImplementLinkAllowed()},validateIfScoped:function(t,o){var i,r,s,a,c,l,u,g=!1,d=function(e,t){return e.some((function(e){return t(e.get("from"))}))};if(e.is(t,"array")&&t.length>0?(r=n.getInstanceFromCollection(t[t.length-1]),s=r.get("isInstanceOf"),a=this.getScopeLinks(s),e.is(a,"array")&&0===a.length&&(s=this.getScopedParent(t))):n.isReference(t)&&(s=t),l=new Set,n.traverseInstanceModels(s,(function(e){l.add(e.get("isInstanceOf"))})),e.is(o,"array")&&o.length>0)for(i=o.length-1;i>=0;i--)if(u=n.getInstanceFromCollection(o[i]),e.is(u)&&(c=u.get("isAggregatedBy"),d(this.getScopeLinksOfImplemented(c),(function(e){return e===s})))){g=!0;break}return g},createEngMadeFromItem:function(t,n){return new Promise(((i,r)=>{let s=a.getPlugins("DatabasePlugin"),c=a.getPlugins("DicoPlugin"),l=o.getServerConfigurationRawXML("DELWebMfgAssetsLinkAuthoring.xml");e.is(s)&&e.is(s.instance)||(a.getLogger().debug("DatabasePlugin is not available."),r()),e.is(c)&&e.is(c.instance)||(a.getLogger().debug("DicoPlugin is not available."),r()),s=s.instance,c=c.instance;const u={mfgRefID:n,prdRefID:t};e.is(l,"string")&&(u.xmlLinkAuthoringConfig=l);const g=()=>{r()},d={url:"dsmfg/private/V0/invoke/createEngMadeFromItem",method:"POST",context:this,headers:o.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0}),data:e.Json.encode(u),onComplete:t=>{const n={stackedReferences:[],stackedInstances:[],stackedConnections:[],onComplete:i},o={queriedForChildren:!0,queriedForConnections:!0,queriedForDocuments:!1},a=s.getConnectionParser();e.is(t)?(e.is(t.instancesAndReferences,"array")&&t.instancesAndReferences.forEach((t=>{const i=e.is(t["to.attributesValue"])?t["to.attributesValue"]:t.attributesValue;Object.prototype.hasOwnProperty.call(i,"isInstanceOf")?n.stackedInstances.push(e.merge(i,{queriedForConnections:!0})):n.stackedReferences.push(e.merge(i,o))})),e.is(t.connections,"array")&&t.connections.forEach((e=>{a.parse(e,n)})),s.addToCollections(n)):r()},onFailure:g,onTimeout:g,onCancel:g};o.webServiceRequest(d)}))},consumeReferenceWithScopeLink:function(t,n,i,r,s){return new Promise(((c,l)=>{let u=a.getPlugins("DatabasePlugin"),g=a.getPlugins("DicoPlugin"),d=o.getServerConfigurationRawXML("DELWebMfgAssetsLinkAuthoring.xml");e.is(u)&&e.is(u.instance)||(a.getLogger().debug("DatabasePlugin is not available."),l()),e.is(g)&&e.is(g.instance)||(a.getLogger().debug("DicoPlugin is not available."),l()),u=u.instance,g=g.instance;const m={scopeIntent:t,implementingParentRefPID:i,implementedRefPID:n,mfgInstanceId:r,attributes:s};e.is(d,"string")&&(m.xmlLinkAuthoringConfig=d);const p=()=>{l()},f={url:"dsmfg/private/V0/invoke/consumeReferenceWithScopeLink",method:"POST",context:this,headers:o.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0}),data:e.Json.encode(m),onComplete:t=>{const n={stackedReferences:[],stackedInstances:[],stackedConnections:[],onComplete:c},o={queriedForChildren:!0,queriedForConnections:!0,queriedForDocuments:!1},i=u.getConnectionParser();e.is(t)?(e.is(t.instancesAndReferences,"array")&&t.instancesAndReferences.forEach((t=>{const i=e.is(t["to.attributesValue"])?t["to.attributesValue"]:t.attributesValue;Object.prototype.hasOwnProperty.call(i,"isInstanceOf")?n.stackedInstances.push(e.merge(i,{queriedForConnections:!0})):n.stackedReferences.push(e.merge(i,o))})),e.is(t.connections,"array")&&t.connections.forEach((e=>{i.parse(e,n)})),u.addToCollections(n)):l()},onFailure:p,onTimeout:p,onCancel:p};o.webServiceRequest(f)}))},manageScopeAndImplementLink:function(t,r,s,c,l,u){var g,d=l||{},m={productPID:s,processPID:t,processUpperScopePath:e.Json.encode(u),partialScopeAction:d.cmdAction},p=o.getServerConfigurationRawXML("DELWebMfgAssetsLinkAuthoring.xml"),f=function(t,n){e.is(d.isCreatePartialScopeLink)&&d.isCreatePartialScopeLink?P("Create scope and implement link","ImplementPlugin.CreatePartialScope.Failed",n,d):e.is(d.isDeletePartialScopeLink)&&d.isDeletePartialScopeLink?P("Delete Partial scope and implement link","ImplementPlugin.DeletePartialScope.Failed",n,d):e.is(d.isStretchPartialScopeLink)&&d.isStretchPartialScopeLink?P("Stretch scope and implement link","ImplementPlugin.StretchPartialScope.Failed",n,d):e.is(d.isSwitchToPartialScopeLink)&&d.isSwitchToPartialScopeLink?P("Swtich To Full scope link","ImplementPlugin.SwitchPartialScope.Failed",n,d):e.is(d.onFail,"function")&&d.onFail(null,n)};e.is(d.isStretchPartialScopeLink)&&d.isStretchPartialScopeLink?(m.targetPrdOccPath=d.targetPrdOccPath,m.targetProductPID=d.targetProductID,m.prdOccPath=c):e.is(d.isDeletePartialScopeLink)&&d.isDeletePartialScopeLink?m.targetPrdOccPath=d.targetPrdOccPath:(e.is(d.isCreatePartialScopeLink)&&d.isCreatePartialScopeLink||e.is(d.isSwitchToPartialScopeLink)&&d.isSwitchToPartialScopeLink)&&(m.prdOccPath=c),e.is(p,"string")&&(m.xmlLinkAuthoringConfig=p);const h=e.is(l.copyModelProductToItemUponSL)?l.copyModelProductToItemUponSL:"DoNotCopyModel";m.copyModelProductToItemUponSL=h,g={url:"dsmfg/private/V0/invoke/MfgItem/managePartialScopeAndImplementLink",method:"POST",headers:o.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0}),data:e.Json.encode(m),onFailure:f,onTimeout:f,onCancel:f,onComplete:function(t){var o=i.getConnectionParser(),r={stackedReferences:[],stackedInstances:[],stackedConnections:[],deletedObjects:[],deletedConnections:[],onComplete:function(n){var o=[];e.is(n.instancesAndReferences,"array")&&n.instancesAndReferences.length>0&&(n.instancesAndReferences.forEach((function(e){e.isReference()&&o.push(e)})),o.length>0&&a.getMediator().notify("referenceChanged",[o])),e.is(n.connections,"array")&&n.connections.length>0&&a.getMediator().notify("connectionAdded",[n.connections]),e.is(d.onComplete,"function")&&(e.is(d.isCreatePartialScopeLink)&&d.isCreatePartialScopeLink?d.onComplete("ImplementPlugin.CreatePartialScope.Success",n):e.is(d.isDeletePartialScopeLink)&&d.isDeletePartialScopeLink?d.onComplete("ImplementPlugin.DeletePartialScope.Success",n):e.is(d.isStretchPartialScopeLink)&&d.isStretchPartialScopeLink?d.onComplete("ImplementPlugin.StretchPartialScope.Success",n):e.is(d.isSwitchToPartialScopeLink)&&d.isSwitchToPartialScopeLink?d.onComplete("ImplementPlugin.SwitchPartialScope.Success",n):d.onComplete(),a.getMediator().notify("updateBIModelFromServerResponse",t))}};e.is(t)?(e.is(t.instancesAndReferences,"array")&&t.instancesAndReferences.length>0&&t.instancesAndReferences.forEach((function(t){var n=e.is(t.attributesValue)?t.attributesValue:t;Object.prototype.hasOwnProperty.call(n,"isInstanceOf")?r.stackedInstances.push(t):r.stackedReferences.push(t)})),e.is(t.connections,"array")&&t.connections.length>0&&t.connections.forEach((function(e){o.parse(e,r)})),e.is(t.deletedObjects,"array")&&t.deletedObjects.length>0&&(r.deletedObjects=r.deletedObjects.concat(t.deletedObjects)),e.is(t.deletedConnections,"array")&&t.deletedConnections.length>0&&(r.deletedConnections=r.deletedConnections.concat(t.deletedConnections)),n.addToCollections(r)):f()}},o.webServiceRequest(g)},getImplementingPathsToPartialOrFullScope:function(t){var n;return e.is(t)&&(n=this.isUnderPartialScope(t)?this.getPathToPartialScope(t):this.getPathsToScope(t).implementingPathToScope),n},isProductImplementLinkValidForOccPath:function(t,n,o){var i,r,s=!1,a=!1;return i=this.getPathToScope(o),(e.equals(t,i)||e.equals(n,i))&&(s=!0),r=this.getPathToPartialScope(o),(e.equals(t,r)||e.equals(n,r))&&(a=!0),s||a},getAllScopedOrImplementingProducts:function(t){let n=[],o=[],i=a.getPlugins("DatabasePlugin");return i=i.instance,e.is(t.getInstancePID())&&(n=i.getImpacted(t.getInstancePID(),!0,{relationTypes:["ProductImplementLinkOcc"]}),0!==n.length&&n.forEach((function(e){let t=i.transformToRIROccurrencePath(e);o.push(t)}))),0===o.length&&e.is(t.getReferencePID())&&(n=i.getImpacted(t.getReferencePID(),!0,{relationTypes:["ProductImplementLink"]}),0!==n.length&&n.forEach((function(e){let t=i.transformToRIROccurrencePath(e);o.push(t)}))),o}})}})),define("DS/DELPPWItemModelPlugins/BI/BIPlugin",["UWA/Core","DS/DELPPWWebServices/WebserviceUtils","DS/DELPPWItemModelPlugins/BI/BIUtils","DS/DELPPWResourceServices/ResourceUtils"],(function(e,t,n,o){"use strict";return function(t){var i="BIPlugin",r=!1,s=[],a=function(){var s,a={noTimeout:!0},c=function(e){return Array.isArray(e)&&e.length>0};!1!==r&&(s=t.getLogger().log(i,o.getNLSValue("BI.LogMessage"))),n.resetBIModelCollection();const{rootProducts:l,rootProcesses:u}=function(){let n=null,o=null,r=t.getPlugins("RootsPlugin");if(e.is(r)){r=r.instance;const e=r.getRoots(i);2===e.length&&(n=e[0],o=e[1])}else t.getLogger().debug(i,"Roots Plugin unavailble");return{rootProducts:n,rootProcesses:o}}();if(function(e,t){return c(e)&&c(t)}(l,u)){let c=t.getPlugins("RootsPlugin");if(e.is(c)){c=c.instance;const g=c.getAllCompatibleFilters(u),d=c.getAllCompatibleFilters(l);let m=t.getPlugins("DatabasePlugin");m=m.instance;const p=m.isAuthoringMode();!function(n,r){var s,a,c,l=[];for(s=0;s<n.length;s++)c=r.getReferenceModel(n[s]),e.is(c)&&e.is(c._attributes)&&(a=c._attributes.type+".V_ContextualImplementLink",e.is(c._attributes[a])&&"TRUE"===c._attributes[a]&&(l.push(c._attributes["PLMEntity.V_Name"]),n.splice(s,1),s--));l.length>0&&t.getLogger().warn(i,o.getNLSValue("BI.Computation.HasOccOccLink",{object:l}))}(u,m),e.is(g)&&e.is(d)?(t.getMediator().notify("startProgress",a),n.fetchBIComputation({rootEBOM:l,rootMBOM:u,rootMBOMConfigFilter:g,rootEBOMConfigFilter:d,onFailure:function(){t.getMediator().notify("stopProgress",a),t.getMediator().notify("toggleCmdCheckHeaderState",{cmdName:"BIEssentialsCmd",cmdState:!1}),t.getLogger().warn(i,o.getNLSValue("BI.Computation.Failure"),s)},isAuthoringMode:p},(function(){var e=n.getProductAssignmentStatus(),c=n.getMfgItemUpdateStatus();t.getMediator().notify("stopProgress",a),!1!==r&&(t.getLogger().info(i,o.getNLSValue("BI.Computation.Success"),s),t.getMediator().notify("updateBIStatus",{ProductStatus:e,ProcessStatus:c}))}))):t.getLogger().warn(i,o.getNLSValue("BI.Computation.IncompatibleFilter"))}else t.getLogger().debug(i,"Roots Plugin unavailble")}else t.getLogger().warn(i,o.getNLSValue("BI.Computation.NoMBOMorEBOM"),s)},c=function(e){!0===e.state?(r=!0,a()):(r=!1,n.isBIComputed()&&n.resetBIModelCollection())};return n.init({core:t}),{name:"BIPlugin",onStart:function(){n.setBIModelEvents({onAdd:function(e,n,o){t.getMediator().notify("addBIModel",[e,n,o])},onChange:function(e,n,o){t.getMediator().notify("changeBIModel",[e,n,o])},onReset:function(e,n,o){t.getMediator().notify("resetBIModel",[e,n,o],{sourceModuleId:i})}}),s.push(t.addExternalListener("BIEssentialsCmd",c))},onStop:function(){var e,o;for(n.removeBIModelEvents(),e=0,o=s.length;e<o;e++)t.removeExternalListener(s[e]);s=[]},computeBI:function(){a()},getBrokenMfgItemStatus:function(o,i){let r=!1,s=t.getPlugins("DatabasePlugin");e.is(s)&&e.is(s.instance)&&(s=s.instance,r=s.isAuthoringMode()),n.getBrokenMfgItemStatus({rootEBOM:o.rootEBOM,rootMBOM:o.rootMBOM,rootMBOMConfigFilter:o.rootMBOMConfigFilter,rootEBOMConfigFilter:o.rootEBOMConfigFilter,areRootsBroken:!!e.is(o.areRootsBroken,"boolean")&&o.areRootsBroken,prefix:o.prefix,forceBIComputation:!!e.is(o.forceBIComputation,"boolean")&&o.forceBIComputation,isAuthoringMode:r},i)},getPhantomNodeItems:function(){return n.getPhantomNodeItems()},getBIModel:function(e){return n.getBIModel(e)},getBICmdState:function(){return r},resetBIModelCollection:function(){return n.resetBIModelCollection()},clearPseudoBIStatus:function(){n.clearPseudoBIStatus()},isBIComputed:function(){return n.isBIComputed()},fetchBIComputation:function(e,t){n.fetchBIComputation(e,t)},getProductStatus:function(e,t){return n.getProductStatus(e,t)},getProcessStatus:function(e,t){return n.getProcessStatus(e,t)},getBIModelCollection:function(){return n.getBIModelCollection()}}}})),define("DS/DELPPWItemModelPlugins/BI/BIMakeBuyPlugin",["UWA/Core","DS/DELPPWItemModelPlugins/BI/BIMakeBuyUtils","DS/DELPPWResourceServices/ResourceUtils"],(function(e,t,n){"use strict";return function(o){let i="BIMakeBuyPlugin",r=!1,s=[];const a=function(){let s,a={noTimeout:!0},c=o.getPlugins("RootsPlugin");if(!e.is(c))return void o.getLogger().debug(i,"Roots Plugin unavailble");c=c.instance;const l=function(e){o.getMediator().notify("stopProgress",a),!1!==r&&(o.getLogger().info(i,n.getNLSValue("BI.MakeBuy.Success"),s),o.getMediator().notify("updateBIMakeBuyStatus",[e]))},u=function(){o.getMediator().notify("stopProgress",a),o.getMediator().notify("toggleCmdCheckHeaderState",{cmdName:"BIEssentialsCmd",cmdState:!1}),o.getLogger().warn(i,n.getNLSValue("BI.MakeBuy.Failure"),s)};!1!==r&&(s=o.getLogger().log(i,n.getNLSValue("BI.LogMessage"))),t.resetBIModelCollection();const g=function(){const e=c.getRoots(i);let t=null;return 1===e.length&&(t=e[0]),t}();if(Array.isArray(g)&&g.length>0){const r=c.getAllCompatibleFilters(g),s=o.getPlugins("DatabasePlugin").instance.isAuthoringMode();if(e.is(r)){const n=e.is(o.getConfig())&&e.is(o.getConfig().widgetTrigram,"string")?o.getConfig().widgetTrigram:"",i="MFN"===n?"onlyMbom":"SIE"===n?"onlySbom":"onlyCbom";o.getMediator().notify("startProgress",a);const c={requiredItemType:i,rootEBOM:g,rootEBOMConfigFilter:r,onFailure:u,isAuthoringMode:s};t.fetchBIMakeBuyStatus(c,l)}else o.getLogger().warn(i,n.getNLSValue("BI.Computation.IncompatibleFilter"))}else o.getLogger().warn(i,n.getNLSValue("BI.MakeBuy.NoEBOM"),s)},c=function(e){!0===e.state?(r=!0,a()):(r=!1,t.isBIMakeBuyComputed()&&t.resetBIModelCollection())};return t.init({core:o}),{name:"BIMakeBuyPlugin",onStart:function(){t.setBIModelEvents({onAdd:function(e,t,n){o.getMediator().notify("addMakeBuyBIModel",[e,t,n])},onChange:function(e,t,n){o.getMediator().notify("changeMakeBuyBIModel",[e,t,n])},onReset:function(e,t,n){o.getMediator().notify("resetMakeBuyBIModel",[e,t,n],{sourceModuleId:i})}}),s.push(o.addExternalListener("BIMakeBuyStatus",c))},onStop:function(){t.removeBIModelEvents();for(let e=0,t=s.length;e<t;e++)o.removeExternalListener(s[e]);s=[]},computeBIMakeBuyStatus:function(){a()},getBIMakeBuyCmdState:function(){return r},resetBIModelCollection:function(){return t.resetBIModelCollection()},isBIMakeBuyComputed:function(){return t.isBIMakeBuyComputed()},getBIModelCollection:function(){return t.getBIModelCollection()}}}}));