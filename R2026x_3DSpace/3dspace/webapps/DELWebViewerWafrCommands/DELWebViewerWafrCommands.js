define("DS/DELWebViewerWafrCommands/actions/StandardActions",["DS/Selection/CSOManager","DS/DELWeb3DViewerV2/NodeUtil","DS/DELWebOERCommonUtils/mixins/TypesUtilsMixin"],(function(e,t,i){"use strict";const n=function(e){const t=e.executionContext.getComponent("DELWebViewer");if(!t||!t.getViewerBehavior)throw new Error("DELWebViewer Component is not available");return t.getViewerBehavior()},a={toggleHideShow:async function(i,n){const a=n.executionContext.getComponent("DELWebViewer");let o=e.get()||[],r=a.getViewerBehavior();r&&await r.toggleNodeVisibility({path:o.map((e=>t.getPathFromPathElement(e.pathElement)))}),i()},activateBuildUp:function(e,t){const i=t.executionContext,n=i.getComponent("DELWebViewer"),a=i.getComponent(WAfrStandardComponentKey.ModelEvents);n.getViewerBehavior().setOperation({...t.args,clear:!0}).then((()=>{a.publish({event:"onBuildUpActivated",data:{data:t.args,origin:name}})})).fail((e=>{a.publish({event:"onBuildUpActivateFailed",data:{data:e.input,error:e.error,origin:name}}),e&&e.error&&"DELVIEWER_E003"===e.error.code&&a.publish({event:"onBuildupConnectionFailed",data:{data:t.args,error:e.error,origin:name}})}))},deactivateBuildUp:function(e,t){const i=t.executionContext,n=i.getComponent("DELWebViewer"),a=i.getComponent(WAfrStandardComponentKey.ModelEvents);n.getViewerBehavior().removeOperation().then((()=>{a.publish({event:"onBuildUpDeactivated",data:{data:t.args}}),e()})).catch((t=>{a.publish({event:"onBuildUpDeactivateFailed",data:{data:t.input,error:t.error,origin:name}}),e()}))},showMaterial:function(e,t){const i=t.executionContext,n=i.getComponent("DELWebViewer"),a=i.getComponent(WAfrStandardComponentKey.ModelEvents);n.getViewerBehavior().showMaterial({...t.args}),a.publish({event:"onShowMaterialComplete",data:{data:t.args}}),e()},hideMaterial:function(e,t){const i=t.executionContext,n=i.getComponent("DELWebViewer"),a=i.getComponent(WAfrStandardComponentKey.ModelEvents);n.getViewerBehavior().hideMaterial({...t.args}),a.publish({event:"onHideMaterialComplete",data:{data:t.args}}),e()},initializeBuildup:function(e,t){const i=t.executionContext,n=i.getComponent("DELWebViewer"),a=i.getComponent(WAfrStandardComponentKey.ModelEvents);n.getViewerBehavior().initializeBuildupV2(t.args).then((()=>{a.publish({event:"onBuildupInitializeComplete",data:{data:t.args}}),e()})).fail((function(e){a.publish({event:"onBuildupInitializeFailed",data:{data:t,error:e.error}})}))},enrich3D:function(e,t){const i=t.executionContext,n=i.getComponent("DELWebViewer"),a=i.getComponent(WAfrStandardComponentKey.ModelEvents);n.getViewerBehavior().enrich3D({...t.args}).then((()=>{a.publish({event:"onEnrich3DComplete",data:{data:t.args}}),e()})).catch((function(i){a.publish({event:"onEnrich3DFailed",data:{data:t,error:i}}),e()}))},hideNode:async function(e,t={}){let i=n(t);await i.hideNode(t.args),e()},showNode:async function(e,t={}){let i=n(t);await i.showNode(t.args),e()},reframe:async function(e,t={}){let i=n(t);await i.setReframe(t.args),e()},loadFTA:async function(e,t={}){let i=n(t);await i.loadFTA(t.args),e()},removeFTA:async function(e,t={}){let i=n(t);await i.removeFTA(t.args),e()},addRoots:async function(e,t={}){let o=n(t),r=t&&t.args&&t.args.results?t.args.results:[],s=!(!t.args||!UWA.is(t.args.forceStop,"boolean"))&&t.args.forceStop,l=!(!t.args||!UWA.is(t.args.defaultShow,"boolean"))&&t.args.defaultShow,c=!(!t.args||!UWA.is(t.args.displayNotif,"boolean"))&&t.args.displayNotif,h=t.executionContext,d=t.executionContext.getComponent(WAfrStandardComponentKey.ModelEvents),p=async function(e){let t=!UWA.is(e.reframe,"boolean")||e.reframe,i=!!UWA.is(e.outofScope,"boolean")&&e.outofScope,n=e.publicFilterSpec?e.publicFilterSpec:null;await o.addRoots({objects:[{path:[e.id],publicFilterSpec:n}],reframe:t,outofScope:i})};await Promise.all(r.map(async function(e){let t=async function(e){let t=function(e){return{...e,defaultShow:l,displayNotif:c}}(e);return o.setProcessV2(t).then((async function(){d.publish({event:"onProcessLoadCompleted",data:{data:t}}),!s&&t.operation&&UWA.is(t.operation.occurrence,"array")&&t.operation.occurrence.length>0&&await a.activateBuildUp((function(){}),{args:{path:t.operation.occurrence},executionContext:h})})).catch((function(e){d.publish({event:"onProcessLoadFailed",data:{data:t}})}))};switch(e.pprType){case i.PPRTYPES.PROCESS:case i.PPRTYPES.SERVICEPROCESS:await t(e);break;default:await p(e)}}.bind(this))),e()},removeRoots:async function(e,t={}){let a=n(t);(t&&t.args&&UWA.is(t.args.items,"array")?t.args.items:[]).forEach((async e=>{switch(e.pprType){case i.PPRTYPES.PROCESS:case i.PPRTYPES.SERVICEPROCESS:await a.empty({filterUpdated:e.filterUpdated});break;default:await a.removeRoots({pids:[e.id],filterUpdated:e.filterUpdated})}})),e()}};return a})),define("DS/DELWebViewerWafrCommands/DELWeb3DViewerLevelSelector",["DS/DELWebViewerLogger/Logger","DS/LevelSelector/LevelSelector","DS/Selection/HSOManager","DS/Selection/CSOManager","DS/Selection/PSOManager","DS/DELWeb3DViewerV2/NodeUtil"],(function(e,t,i,n,a,o){"use strict";const r=new e;return class{constructor(e){this.ec=e.executionContext,this._onDragStart=this._onDragStart.bind(this),this._viewer=this.ec.getComponent("Viewer"),this._context=this.ec.getComponent("Context"),this._labelsVisibility=e.args.labelVisibility||!1,this._emptyCSOToken="",this._levelSelectorContext=null,this._path=null,this._levels=[],this._event=null}_onDragStart(e){let t=this.ec.getComponent("DELCommonUtilsServices"),n=i.get().map((function(e={}){let i={contextId:t.getCurrentSecurityContext(),envId:t.getPlatformId(),serviceId:"3DSpace",path:[]};if(e.pathElement){let t=e.pathElement.externalPath;if(UWA.is(t,"array"))for(let e=1;e<t.length;e++){let n=t[e],a=n.getModelIdentification(),o=(n.getUserData()||{}).type;if(!a)break;i.path.push({resourceid:a,type:o}),i.objectId=a,i.objectType=o}else r.warn("Unable to build drag object, as externalPath property is not available in the path element")}return i})),a={biProxyCtx:{appId:t.getAppId(),widgetId:t.getWidgetId()},data:{items:n},protocol:"3DXContent",source:t.getAppId(),version:"1.1",widgetId:t.getWidgetId()};if(!(UWA.is(n,"array")&&n.length>0))return e.preventDefault(),!1;e.dataTransfer.setData("text/plain",JSON.stringify(a))}_setLevelDraggable(e){let t=widget.getElement("#LevelSelector");if(t){let i=t.getElements(".levels .level canvas");if(i){for(let t=0;t<i.length;t++){let n=i[t];n.setAttribute("draggable",e),n.style.cursor=e?"grab":"pointer"}!0===e?t.addEventListener("dragstart",this._onDragStart):t.removeEventListener("dragstart",this._onDragStart)}else r.error("No levels container available, please check the selector")}else r.error("No level selector container available, please check the selector")}beginExecute(){let e=this,i=this.ec.getComponent(WAfrStandardComponentKey.CommandsManagerComponent);i&&i.subscribeOnceToCmdState("DELWeb3DViewerLevelSelector","end",(function(){e._setLevelDraggable(!0)})),this._emptyCSOToken=n.onEmpty((()=>{this.endExecute()}));const a=n.get();if(1===a.length){this._event=a[0].event,this._path=a[0].pathElement,this._path.selectedPathBeforeBuildupPickability&&(this._implementedPath=a[0].pathElement,this._path=this._viewer.unstreamPath(this._path.selectedPathBeforeBuildupPickability.split(","))),this._levelSelectorContext=a[0].pathElement.clone();let e=this._viewer.getDOMElement("container"),i=this._event?this._event.event.pageX+75:e.offsetWidth/2,n=this._event?this._event.event.pageY-75:e.offsetHeight/2;this._event&&"Touch"===this._event.type&&(i=this._event.currentPosition.x+75,n=this._event.currentPosition.y-75),t.createView({positionX:i,positionY:n,uiFrame:e,getLevels:this.getLevels.bind(this),onHover:this.onHover.bind(this),onLeave:this.onLeave.bind(this),onSelect:this.onSelect.bind(this)})}else this.endExecute()}endExecute(){this._setLevelDraggable(!1),n.unsubscribe(this._emptyCSOToken),t.destroyView(),delete this._labelsVisibility,delete this._viewer,delete this._emptyCSOToken,delete this._levelSelectorContext,delete this._levels,delete this._path,delete this._event,this.done()}getLevels(e){let t=this;for(var a=this._path,r=[];a;){let e=a.externalPath[a.externalPath.length-1];if(o.isPLMNode(e)&&(o.isReference(e)||o.is3DLeaf(e))){const e=a.getLastElement(!0),t=o.getBIColor(e);null!==t?this._levels.push({pathElement:a,canvasColor:t,event:this._event}):this._levels.push({pathElement:a,event:this._event}),r.push(o.getNodeID(a.getLastElement(!0)))}a=a.getParentPath()}if(this._labelsVisibility&&r.length){let t=["ds6w:label","type_icon_url"],i="";if(this._viewer.getController().is3DLeafColorizeActivated()){let e=this._viewer.getController().getBIColorMap().predicate;t.push(e)}this._viewer.getController().getAttributes({ids:r,attributes:t,callbacks:{onComplete:n=>{for(let e=0;e<this._levels.length;++e){let a=o.getNodeID(this._levels[e].pathElement.getLastElement(!0));if(n[a]&&(this._levels[e].name=n[a][t[0]],this._levels[e].icon=n[a][t[1]],this._viewer.getController().is3DLeafColorizeActivated()&&""!==i)){let t=n[a][i];this._levels[e].canvasColor=this._viewer.getController().getColorValueForPredicate(t,this._viewer.getController().getBIColorMap().predicateKind)}}e(this._levels),this._context.setContextBarVisibility(!1),this.done()},onFailure:t=>{console.error("Levele selector command: The getAttributes call failed.",t),e(this._levels),this._context.setContextBarVisibility(!1),this.done()}}})}else i.empty(),n.empty(),this.done();return{levels:this._levels,currentLevel:function(e){let i,n;return UWA.is(e,"array")&&e.length>0&&t._implementedPath&&(n=t._viewer.streamPath(t._implementedPath).toString(),e.forEach((function(e,a){e&&e.pathElement&&t._viewer.streamPath(e.pathElement).toString()===n&&(i=a)}))),i}(this._levels)}}onHover(e){i.empty(),a.empty(),e.event=this._event,i.add(e)}onLeave(){i.empty(),a.empty(),i.add({pathElement:this._levelSelectorContext,event:this._event})}onSelect(e){i.empty(),n.empty(),e.event=this._event,i.add(e),n.add(e),this.endExecute()}}}));