define("DS/XSRCommonComponents/utils/XSRSearch",["UWA/Core","UWA/Utils/InterCom","DS/XSRCommonComponents/utils/RequestUtil","DS/Controls/LineEditor","DS/Controls/Button","DS/Controls/ComboBox","DS/Windows/Dialog","DS/XSRCommonComponents/utils/Notification","css!DS/XSRCommonComponents/SearchCriteria.css","i18n!DS/XSRCommonComponents/assets/nls/XSRCommonComponents"],(function(e,t,i,o,n,s,r,c,a,l){"use strict";var d=function(i){this.socketName="search_socket_"+(new Date).getTime(),this.socket=new t.Socket(this.socketName,{dispatchRetryInterval:5}),this.socket.subscribeServer("SearchComServer"),this.listener=this.objectsSelected.bind(this),this.socket.addListener("Selected_Objects_search",this.listener),this.defaultOptions=i,this.defaultOptions={multiSel:!0,source:["3dspace"]},e.extend(this.defaultOptions,i||{})};return d.prototype.options=function(e,t,o,n,s,r,c,a){let l=this;var d={};if(d.title=e,d.mode="furtive",d.app_socket_id=this.socketName,d.widget_id=widget.id,d.default_with_precond=!0,d.multiSel=s,d.source=this.defaultOptions.source||[],d.tenant=i.getPlatformId(),d.excludeMEI=void 0!==l.defaultOptions.excludeMEI&&null!==l.defaultOptions.excludeMEI&&l.defaultOptions.excludeMEI,d.role=o,a&&(d.columns=a),l.defaultOptions.rdf?Array.isArray(t)&&(d.precond="",t.forEach((function(e,t){0!==t&&(d.precond+=" OR "),d.precond+=e}))):Array.isArray(t)&&(d.precond="",t.forEach((function(e,t){0!==t&&(d.precond+=" OR "),d.precond+='flattenedtaxonomies:"types/'+e.trim()+'"'}))),d.precond&&""!==d.precond&&(d.precond="("+d.precond+")"),(r||c&&c.length>0||d.excludeMEI)&&d.precond){d.precond="("+d.precond,r&&(d.precond=d.precond+" AND "+r);var u="";if(c&&c.length>0){var h="";const e="NOT physicalid:";for(var p=0;p<c.length;p++)h+=0===p?e:" AND "+e,h+=c[p];u=" AND ("+h+")",d.precond+=u}d.excludeMEI&&(d.precond=d.precond+' AND NOT([ds6w:kind]:"ManufacturerEquivalentItemExtension")'),d.precond+=")"}n&&""!==n.trim()&&(d.default_search_criteria=n);return d.advanced_search={showByDefault:!1,searchOnInit:!1},d},d.prototype.optionsWithQuery=function(e,t,o,n,s){let r=this;var c={};c.title=e,c.mode="furtive",c.app_socket_id=this.socketName,c.widget_id=widget.id,c.default_with_precond=!0,c.multiSel=n,c.source=this.defaultOptions.source||[],c.tenant=i.getPlatformId(),c.excludeMEI=void 0!==r.defaultOptions.excludeMEI&&null!==r.defaultOptions.excludeMEI&&r.defaultOptions.excludeMEI,c.role=t,c.precond=s,o&&""!==o.trim()&&(c.default_search_criteria=o);return c.advanced_search={showByDefault:!1,searchOnInit:!1},c},d.prototype.destroy=function(){var e={};e.widget_id=widget.id,this.socket.dispatchEvent("unregisterSearchContext",e),this.socket.unsubscribeServer("SearchComServer"),this.socket.removeListener("Selected_Objects_search",this.listener),this.socket.disconnect(),delete this.socket},d.prototype.activatewithQuery=function(e,t,i,o,n,s){var r=this.optionsWithQuery(e,t,i,o,n);UWA.is(s,"function")||(r.mode="default"),this.callback=s,this.socket.dispatchEvent("unregisterSearchContext",{widget_id:widget.id}),this.socket.dispatchEvent("RegisterContext",r),this.socket.dispatchEvent("InContextSearch",r)},d.prototype.activate=function(e,t,i,o,n,s,r,c,a){var l=this.options(e,t,i,o,n,s,r,c);UWA.is(a,"function")||(l.mode="default"),this.callback=a,this.socket.dispatchEvent("unregisterSearchContext",{widget_id:widget.id}),this.socket.dispatchEvent("RegisterContext",l),this.socket.dispatchEvent("InContextSearch",l)},d.prototype.isAvailable=function(){return UWA.is(this.socket)},d.prototype.launchSearch=function(e){var t=this;if(t.isAvailable()){if("ODT"==widget.getValue("mode")){var i=widget.searchresult;e.in_apps_callback(i)}else void 0!==e.multiSel&&null!==e.multiSel||(e.multiSel=this.defaultOptions.multiSel||!0);t.activate("Specification Management ",e.allowedTypes,e.role||"",t.getAugmenttedQueryForSearch(e.criteria),e.multiSel,e.precondition,e.excludeList,e.columns,(function(t){e.in_apps_callback(t)}))}},d.prototype.launchSearchWithQuery=function(e){var t=this;if(t.isAvailable()){if("ODT"==widget.getValue("mode")){var i=widget.searchresult;e.in_apps_callback(i)}else void 0!==e.multiSel&&null!==e.multiSel||(e.multiSel=this.defaultOptions.multiSel||!0);t.activatewithQuery("Specification Management ",e.role||"",t.getAugmenttedQueryForSearch(e.criteria),e.multiSel,e.fullcondition,(function(t){e.in_apps_callback(t)}))}},d.prototype.getAugmenttedQueryForSearch=function(t){if(e.is(t,"string")&&t.trim().length>0){var i=t;return"*"!==t.charAt(0)&&(i="*"+t),"*"!==t.charAt(t.length-1)&&(i+="*"),i}return null},d.prototype.objectsSelected=function(e){this.callback&&this.callback(e)},d._getSearchCriteria=function(e,t){if(e&&e.elements.container.getDocument().getElementById("xsr-input-search-dialog"))throw new Error("Dialog Box is already open");return new Promise((function(i,s){let a,d,u;var h=UWA.createElement("div",{class:"xsr-search-editor-content-container"}),p=new n({displayStyle:"lite",label:"proceed",icon:{iconName:"search",fontIconFamily:WUXManagedFontIcons.Font3DS},showLabelFlag:!1,onClick:function(e){d=a.value,d.length<3?c.displayNotification({eventID:"info",msg:l.query_is_short}):(u.close(),i(d))}});p.getContent().addClassName("xsr-search-icon-button"),a=new o({placeholder:l.label_Search,value:"",displayClearFieldButtonFlag:!0,sizeInCharNumber:30}),a.inject(h),p.inject(h),u=new r({domId:"xsr-input-search-dialog",identifier:"xsr-search-dialog",title:l.label_Search_Criteria,showTitleFlag:!1,content:h,activeFlag:!0,modalFlag:!0,position:{my:"right",at:"right",of:t||e,offsetX:0,offsetY:50},buttons:{Ok:new n({onClick:function(e){d=a.value,d.length<3?c.displayNotification({eventID:"info",msg:l.query_is_short}):(u.close(),i(d))}})}})}))},d}));