define("DS/XSRCommonComponents/utils/IndexServiceProvider",["UWA/Class","UWA/Promise","DS/WAFData/WAFData","DS/XSRCommonComponents/utils/RequestUtil","DS/XSRCommonComponents/utils/Constants"],(function(e,t,n,a,i){"use strict";var r=["resourceid","physicalid","ds6w:label","type_icon_url","ds6w:description","ds6w:globalType","ds6w:reserved","ds6w:cadMaster","ds6wg:EnterpriseExtension.V_PartNumber","ds6w:isLastRevision","ds6w:reservedBy","ds6w:type","ds6w:responsible","ds6w:identifier","ds6wg:MaterialUsageExtension.DeclaredQuantity","ds6wg:revision","ds6w:kind","thumbnail_2d","ds6w:modified","ds6w:created","ds6w:status","ds6w:library"];const s=["ds6w:label","ds6w:type","physicalid","ro.plminstance.V_treeorder"];return e.extend({init:function(e){this._parent(e),this.platFormId=a.getPlatformId()},getSearchResults:function(e,i,r,s,o,d){var l=this,c=a.getSecurityContext()?a.getSecurityContext():d;return new t((function(t,a){var d=e,u={label:"Recent",version:2,order_field:"ds6w:modified",order_by:"desc",nresults:200,tenant:l.platFormId,locale:widget.lang,select_predicate:r,with_synthesis:!0,with_nls:!0,source:["3dspace"],login:{"3dspace":{SecurityContext:c}},specific_source_parameter:{drive:{additional_query:' AND NOT ([policy]:"Version")'}},resourceid_in:o||void 0};u[i.key]=i.value,s&&(u.next_start=s),n.authenticatedRequest(d,{method:"POST",headers:{"content-type":"application/json",SecurityContext:c},data:JSON.stringify(u),onComplete:function(e){t(e)},onFailure:a})}))},searchSpecifications:function(e,t,n,i,r){var s=a.get3DSearchURL()+"/search?tenant:"+this.platFormId;return this.getSearchResults(s,e,t,n,i,r)},recentSpecifications:function(e,t,n){var i=a.get3DSearchURL()+"/recent?tenant:"+this.platFormId;return this.getSearchResults(i,e,t,n)},fetchItemData:function(e,n){var i=this,s={label:"XSR-"+a.getloginUser().id+"-"+(new Date).getTime(),physicalid:e,select_file:["icon","thumbnail_2d"],tenant:i.platFormId,select_predicate:n&&null!=n?n:r};return new t((function(e,t){a.send3DSpaceRequest("resources/enoauthoring/fetch/v1?tenant="+i.platFormId,"POST",{type:"json",headers:{"Content-type":"application/json"},data:JSON.stringify(s)},e,t)}))},fetchItemDataByFederatedQuery:function(e){var i=this,r="XSR-"+a.getloginUser().id+"-"+(new Date).getTime(),s={with_indexing_date:!1,with_synthesis:!1,with_synthesis_attribute:!1,with_nls:!1,nresults:1,locale:widget.lang,query:e,tenant:i.platFormId,start:0,label:r,select_file:["icon","thumbnail_2d"]};return new t((function(e,t){var r=a.get3DSearchURL()+"/search?tenant:"+i.platFormId;n.authenticatedRequest(r,{method:"POST",headers:{"content-type":"application/json",SecurityContext:a.getSecurityContext()},data:JSON.stringify(s),onComplete:function(t){e(t)},onFailure:t})}))},fetchItemDataByFederated:function(e){return this.fetchItemDataByFederatedQuery("physicalid:"+e)},expandV2:function(e){var n=this;let i="XSR-"+a.getloginUser().id+"-"+(new Date).getTime(),r={descending_condition_relation:{uql:'NOT (flattenedtaxonomies:"reltypes/XCADBaseDependency") AND ((flattenedtaxonomies:"reltypes/PLMInstance") OR (flattenedtaxonomies:"reltypes/MustBeMadeFrom"))'},descending_condition_object:{uql:'ds6w_58_globaltype:"ds6w:Document" OR ds6w_58_globaltype:"ds6w:Part" OR (flattenedtaxonomies:"types/Document") OR (flattenedtaxonomies:"types/Raw_Material")'}};e.isFormulaBOM&&(r={descending_condition_relation:{uql:'NOT (flattenedtaxonomies:"reltypes/XCADBaseDependency") AND ((flattenedtaxonomies:"reltypes/Formula_Ingredient"))'},descending_condition_object:{uql:'ds6w_58_globaltype:"ds6w:Part" OR (flattenedtaxonomies:"types/Raw_Material")'}});let s={physical_id:e.pid},o=[{prefix_filter:{prefix_path:[{physical_id_path:[e.pid]}]}}];e.filter?o.push({and:{filters:[e.filter]}}):e.isFormulaBOM?o.push({and:{filters:[{sequence_filter:{sequence:[{uql:'((flattenedtaxonomies:"reltypes/Formula_Ingredient")) AND (NOT (ds6wg_58_synchroebomext_46_v_95_inebomuser:"FALSE" ))'}]}}]}}):o.push({and:{filters:[{sequence_filter:{sequence:[{uql:'((flattenedtaxonomies:"reltypes/PLMInstance") OR (flattenedtaxonomies:"reltypes/MustBeMadeFrom")) AND (NOT (ds6wg_58_synchroebomext_46_v_95_inebomuser:"FALSE" ))'}]}}]}});let d={hits:{predefined_computation:["icons","urlstream|thumbnail_2d|2dthb"]},select_object:["ds6w:label","ds6w:modified","ds6w:created","ds6w:description","ds6wg:revision","ds6w:cadMaster","ds6w:responsible","ds6w:status","ds6w:type","ds6wg:EnterpriseExtension.V_PartNumber","ds6wg:MaterialUsageExtension.DeclaredQuantity","ds6wg:DELFmiContQuantity_Mass.V_ContQuantity","ds6wg:DELFmiContQuantity_Volume.V_ContQuantity","ds6wg:raw_material.v_dimensiontype","ds6wg:formulated_product.v_dimensiontype","type","physicalid","ds6w:policy","ds6w:reservedBy","ds6w:globalType","ds6w:manufacturable","pathsr","ds6w:isLastRevision","ds6w:reserved","ds6w:identifier","ds6w:docextension","islastrevision","type","policy","current","ds6wg:plmcorereference.v_isterminal","ds6w:library"],select_relation:["ds6w:label","ds6w:type","ds6wg:SynchroEBOMExt.V_InEBOMUser","physicalid","ro.plminstance.V_treeorder","ds6wg:raw_material.v_dimensiontype","ro.madefromquantity_length.V_ContQuantity","ro.madefromquantity_mass.V_ContQuantity","ro.madefromquantity_area.V_ContQuantity","ro.madefromquantity_volume.V_ContQuantity","ro.madefromquantity_AsRequired.AsRequired","ro.MadeFromQuantity_Rectangular.Length","ro.MadeFromQuantity_Rectangular.Width","ro.VPMInstanceQuantity_Area.V_ContQuantity","ro.VPMInstanceQuantity_Rectangular.Length","ro.VPMInstanceQuantity_Rectangular.Width","ro.VPMInstanceQuantity_Mass.V_ContQuantity","ro.VPMInstanceQuantity_Volume.V_ContQuantity","ro.VPMInstanceQuantity_Length.V_ContQuantity","ro.VPMInstanceQuantity_AsRequired.AsRequired","ds6wg:madefrom_referencedescription.iscomputed","ds6wg:madefrom_referencedescription.referencename","type"],format:"entity_relation_occurrence"};e.isFormulaBOM&&d.select_relation.push("ro.Formula_Ingredient.V_TreeOrder","ro.Formula_Ingredient.V_Name","ro.FormulaIngredientPercent.Loss","ro.FormulaIngredientPercent.Loss","ro.FormulaIngredientPercent.Max","ro.FormulaIngredientPercent.Min","ro.FormulaIngredientPercent.Target","ro.FormulaIngredientQuantityRange_Mass.Max","ro.FormulaIngredientQuantityRange_Mass.Min"),e.instanceAttributes&&(d.select_relation=e.selRelations,d.select_object=e.selObject);let l={batch:{expands:[{graph:r,label:i,root:s,filter:{and:{filters:o}}}]},outputs:d};e.level&&(l.batch.expands[0].aggregation_processors=[{truncate:{max_distance_from_prefix:e.level,prefix_filter:{prefix_path:[{physical_id_path:[e.pid]}]}}}]);var c=a.getSecurityContext()?a.getSecurityContext():extApp_SC,u=a.getSecurityToken();return new t((function(e,t){a.send3DSpaceRequest("cvservlet/progressiveexpand/v2?tenant="+n.platFormId+"&output_format=cvjson","POST",{type:"json",headers:{"Content-type":"application/json;",Securitycontext:c,Securitytoken:u},data:JSON.stringify(l)},e,t)}))},dbExpand:function(e){let n=this,i="XSR-"+a.getloginUser().id+"-"+(new Date).getTime(),o=Object.assign(["ds6w:status","ds6w:policy",...r]),d={no_type_filter_rel:["XCADBaseDependency"],expand_iter:void 0===e.level?"1":e.level,select_bo:o,select_rel:s,label:i,tenant:n.platFormId,root_path_physicalid:[e.pids]};return new t((function(e,t){a.send3DSpaceRequest("resources/enoauthoring/expand/v1?tenant="+n.platFormId,"POST",{type:"json",headers:{"Content-type":"application/json;"},data:JSON.stringify(d)},e,t)}))},expand:function(e,n,o,d){var l=this;i.TYPE_DOCUMENT;let c="XSR-"+a.getloginUser().id+"-"+(new Date).getTime();var u={no_type_filter_rel:["XCADBaseDependency"],expand_iter:void 0===d?"1":d,select_bo:r,select_rel:s,label:c,tenant:l.platFormId,root_path_physicalid:[e]};return new t((function(e,t){a.send3DSpaceRequest("resources/enoauthoring/expand/v1?tenant="+l.platFormId,"POST",{type:"json",headers:{"Content-type":"application/json;"},data:JSON.stringify(u)},e,t)}))},searchGlobal:function(e,t,n){var i=a.get3DSearchURL()+"/search";return this.getSearchResults(i,t,e,n)}})}));