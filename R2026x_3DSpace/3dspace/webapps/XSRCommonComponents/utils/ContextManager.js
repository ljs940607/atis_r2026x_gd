define("DS/XSRCommonComponents/utils/ContextManager",["UWA/Class","DS/XSRCommonComponents/utils/Notification","DS/XSRCommonComponents/utils/RequestUtil","DS/XSRCommonComponents/utils/XSRSearch","DS/ENOjquery/ENOjquery","DS/XSRCommonComponents/utils/Constants","DS/XSRCommonComponents/utils/XSRMask","i18n!DS/XSRCommonComponents/assets/nls/XSRCommonComponents"],(function(e,t,n,i,r,o,s,a){"use strict";return e.singleton({_selectedItems:[],init:function(e){this._parent(e),this.contextId=null,this.contextTitle=void 0,this.gridNodeModels=void 0,this.options={widget:"undefined"!=typeof widget?widget:null}},setBOMTabOptions:function(e){this.appCore=e.appCore,this.maskContainer=e.maskContainer,this.gridView=e.gridView},getSelectedNodes:function(){return this._selectedItems},setContextItemId:function(e){this.contextId=e},setContextItemTitle:function(e){this.contextTitle=e},setGridChildNodes:function(e){this.gridNodeModels=e},resetSelection:function(){this._selectedItems=[]},addSelection:function(e,t){this._selectedItems=[];var n=this;UWA.is(e,"array")?e.forEach((function(e){n._selectedItems.push(e)})):this._selectedItems.push(e)},getSecurityContext:function(){return{SecurityContext:n.getSecurityContext(),tenant:n.getPlatformId()}},getContext:function(){return this},getInstanceName:function(e){if(this.gridView.currentTabKey===o.FORMULABOM_TAB)return e.getTitle();return!1===widget.getValue(o.PERSISTENCY_BOM_VIEW)?e.getInstanceName():e.getTitle()},getName:function(e){return e.getTitle()},get:function(){return this},getEditMode:function(){return!0},displayNotification:function(e){e.eventID="primary"===e.eventID?"success":e.eventID,t.displayNotification(e),"error"!==e.eventID&&this.appCore&&(this.appCore.specViewerModelEvents.publish({event:"xsr-toolbar-switch-fetch-mode-to-author"}),this.appCore.specViewerModelEvents.publish({event:"xsr-reorder-event-update"}))},beginBlockingTransaction:function(e){this.maskContainer&&s.maskLoader(this.maskContainer,e)},endBlockingTransaction:function(){this.maskContainer&&s.unmaskLoader(this.maskContainer)},modalChooser:function(e){var t;t="UPSAuthCmdInsertExisting"==this.currentCmd?{allowedTypes:["Drawing"],role:"",criteria:"",precondition:"",in_apps_callback:e.in_apps_callback}:{allowedTypes:["VPMReference"],role:"",criteria:"VPMReference",precondition:'(latestrevision=="TRUE") AND NOT [current]:"OBSOLETE"',in_apps_callback:e.in_apps_callback},new i(t).launchSearch(t)},isThereARootSelected:function(){var e=this.getSelectedNodes();return!(e&&e.length>0)},getOrdering:function(){return{}},getParent:function(e){return e.parentNodeModel},getSelectedRoots:function(){return[this.getRoots()]},getParentWithChild:function(e){return[]},getRelationID:function(e){return"function"==typeof e.getParentInstanceIds?e.getParentInstanceIds()[0]:""},getType:function(e){return e.getTypeActualName()},getReference:function(e){return e.getID()},getName:function(e){return e?e.getLabel():null},author:function(e){return!0},getNodesById:function(e){return this&&this.contextId&&this.contextId===e?[this.gridView.parentModel]:this.gridView&&"function"==typeof this.gridView.getTreeDocument&&this.gridView.getTreeDocument()?this.gridView.getTreeDocument().getAllDescendants().filter((function(t){return"function"==typeof t.getID&&t.getID()===e})):[]},getSetting:function(e){var t=null;switch(e){case"tenant":t=n.getPlatformId();break;case"lang":t=n.getLanguage();break;case"securityContext":t=n.getSecurityContext()}return t},canInstantiate:function(e,n,i){let r=this.getSelectedNodes();for(let e in r){let s=r[e].getCurrentPath().split("/");for(var o=0;o<n.length;o++)if(s.some((e=>n.includes(e)))){if(i&&""!=i)t.displayNotification({eventID:"error",msg:i});else if(n[o]===r[e].getID())return!0;return!1}}return!0},getChildren:function(e){let t=widget.getValue(o.PERSISTENCY_BOM_VIEW);if(e&&e.getID){if(e.getID()==this.contextId&&this.gridNodeModels){if(t){var n=[];return this.gridNodeModels.forEach((function(e){var t=e.getParentInstanceIds();if(t&&t.length>1)for(var i=0;i<t.length;i++){let o=t[i],s={};s=r.extend(!0,{},e),s.options.grid.instanceIds=[],s.options.grid.instanceIds.push(o),n.push(s)}else n.push(e)})),n}return this.gridNodeModels}var i=e.getChildren();return Array.isArray(i)?i.filter((function(e){return!!e.getID})):[]}if(e&&e.getChildren){i=e.getChildren();return Array.isArray(i)?i.filter((function(e){return!!e.getID})):[]}return[]},addRoot:function(e,t,n){},refresh:function(e){if(e)if("unparent"===e.action)this.appCore.specViewerModelEvents.publish({event:"grid-list-unparent-node-successful-"+this.gridView.currentTabKey,data:e.instances});else if("replace"===e.action){let i=this;var t=Array.isArray(e.operations)?e.operations:[],n=this.getRestructuredData(t);i.appCore.specViewerModelEvents.publish({event:"replaced-eng-item",data:n})}else if("insert"===e.action){for(var i=[],r=0;r<e.instances.length;r++)i.push({fromId:e.parent,instanceId:e.instances[r],id:e.references[r]});this.appCore.specViewerModelEvents.publish({event:"grid-list-addInst-node-successful-bom",data:i})}},getRestructuredData(e){const t=new Map;return e.forEach((e=>{const n=e.new.reference,i=e.new.instance,r=e.parent,o=e.old;t.set(o,{reference:n,old:o,instance:i,parent:r})})),t},isPartiallyExpanded:function(e,t){return t?t(!1):null},getPADDGVView:function(){return null},getRoots:function(){return this.gridView?this.gridView.model.getSelectedNodes().length>0?this.gridView.model.getRoots():[this.gridView._parentView.parentModel]:[]},getNodesByIdForSpecTreeModel:function(){return[this.gridView.model._getTrueRoot()]},getChildrenOfTrueRoot:function(){return this.gridView?.model?._getTrueRoot()?.getChildren()??[]}})}));