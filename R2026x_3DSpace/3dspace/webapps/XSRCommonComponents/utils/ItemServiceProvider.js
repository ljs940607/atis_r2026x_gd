define("DS/XSRCommonComponents/utils/ItemServiceProvider",["UWA/Class","UWA/Promise","DS/XSRCommonComponents/utils/IndexServiceProvider","DS/XSRCommonComponents/utils/RequestUtil","DS/XSRCommonComponents/utils/Constants","DS/XSRCommonComponents/utils/Utils"],(function(e,t,n,a,s,r){"use strict";var i;return e.extend({init:function(e){i=a.getPlatformId(),this.isChangeControlled=!(!e||!e.isChangeControlled),this.securityToken=a.getSecurityToken(),this.tenantID=a.getPlatformId(),this.SC=a.getSecurityContext()},fetchItemData:function(e,a){const s=new Set,i=new Set;return new t((function(t,o){(new n).fetchItemData(e,a).then((async function(e){e.results.reduce(((e,t)=>{t.attributes.forEach((e=>{"ds6w:status"===e.name?s.add(e.value):"ds6w:type"===e.name&&i.add(e.value)}))}),null);let n=await r.getNlsOfPropertiesValues({"ds6w:type":Array.from(i),"ds6w:status":Array.from(s)});e.results.forEach((e=>{let t=e.attributes.find((e=>"ds6w:status"===e.name));t&&(e.attributes.push({name:"ds6w:status_value",value:t.value}),t.value=n["ds6w:status"][t.value]||t.value);let a=e.attributes.find((e=>"ds6w:type"===e.name));a&&(e.attributes.push({name:"ds6w:type_value",value:a.value}),a.value=n["ds6w:type"][a.value]||a.value)})),t(e)}))})).catch((function(e){console.log(e)}))},gateMaturityNPolicy:function(e){let n=this,s={prodIDS:e};return new t((function(e,t){a.send3DSpaceRequest("resources/formulatedproduct/v1/formulatedproduct/policy-state","POST",{type:"json",headers:n.getHeaders({ENO_CSRF_TOKEN:n.CSRFToken,SecurityContext:n.SC}),data:UWA.Json.encode(s)},e,t)}))},getStatesNLS:function(e){let n=this,s="resources/lifecycle/maturity/getStatesAttributes?xrequestedwith=xmlhttprequest&tenant="+i;return new t((function(t,r){a.send3DSpaceRequest(s,"POST",{type:"json",headers:n.getHeaders(),data:JSON.stringify(e)},t,r)}))},getMBMF:function(e){let n=this;return new t((function(t,s){a.send3DSpaceRequest("resources/v1/modeler/dsspec/invoke/dsspec:mbmf","POST",{type:"json",headers:n.getHeaders({ENO_CSRF_TOKEN:a.get3DSpaceCSRFToken(),SecurityContext:n.SC,"Accept-Language":a.getLanguage()}),data:JSON.stringify(e)},t,s)}))},getRefBatchSize:function(e){return new t((function(t,n){a.send3DSpaceRequest("resources/formulatedproduct/v1/formulatedproduct/"+e+"/batchsize","GET",{type:"json",headers:{Accept:"application/json; charset=UTF-8"}},t,n)}))},fetchPhysicalPrdAttributes:function(e){let n=this,s=(new Date).getTime(),r="resources/v1/collabServices/authoring/op/getJSProxyNew";return r=r+"?tenant="+i+"&Type=assembly&objType="+e+"&timestamp"+s+"="+s,new t((function(e,t){a.send3DSpaceRequest(r,"GET",{type:"json",headers:n.getHeaders(),data:void 0},e,t)}))},fetchSpecificationsData:function(e){return new t((function(t,n){a.send3DSpaceRequest("resources/v1/modeler/characteristics/product/"+e+"/performancespec","GET",{type:"json",headers:{"Content-type":"application/json;"}},t,n)}))},getMeasurementCharacteristicLimitsConfiguration:function(){return new t((function(e,t){a.send3DSpaceRequest("resources/v1/modeler/characteristics/config/mc/limits","GET",{headers:{"Content-type":"application/json; charset=UTF-8"}},e,t)}))},createPhysicalPrd:function(e){var n={type:"assembly",preferredCAD:null,cadOriginType:"V6"};e&&e.data&&(n.title=e.data.title,n.filename=e.data.filename,e.data.parentId&&(n.aggregating_context=[e.data.parentId]),e.data.Templates&&e.data.Templates.length>0&&(n.CheckfilenameDisplay=e.data.CheckfilenameDisplay,n.filenameStatus=e.data.filenameStatus,n.Templates=e.data.Templates,n.Specializedtypes=e.data.Specializedtypes,n.cadOriginType=e.data.cadOriginType),e.data.type!==s.TYPE_VPMREFERENCE&&(n.specializedtype=e.data.type),e.data.attributes&&(n.attributes=e.data.attributes));var r=this,o=JSON.stringify(n);return new t((function(e,t){a.send3DSpaceRequest("resources/v1/collabServices/authoring/op/createContent?select=type&select=physicalid&select=cestamp&tenant="+i,"POST",{type:"json",headers:r.getHeaders(),data:o},e,t)}))},getCADData:function(e){var n;if(e&&e.data){var s=e.data instanceof FormData;n=s||"fetchCADTemplates"===e.calledFrom?e.data:JSON.stringify(e.data)}else n='{"dummy" : "dummy"}',"fetchCADInsertables"===e.calledFrom&&(n="");var r=this,i="resources/v1/collabServices/authoring/op";return i="fetchCADTemplates"===e.calledFrom?i.concat("/getTemplatesNames"):i.concat("/getInsertableCADS"),new t((function(e,t){a.send3DSpaceRequest(i,"GET",{type:"json",headers:r.getHeaders(),data:n},e,t)}))},dbExpand:function(e){return(new n).dbExpand(e)},expand:function(e,t,a){return(new n).expand(e,t,!0,a)},expandV2:function(e){return(new n).expandV2(e)},authoringExpandOfItem:function(e,n){var r=this;let o=(new Date).getTime();var c={label:a.getCVRequestLabel(o),no_type_filter_rel:["XCADBaseDependency"],"q.iterative_filter_query_bo":s.TYPE_DOCUMENT===n?'[ds6w:globalType]:"ds6w:Document"':'[ds6w:globalType]:"ds6w:Document" OR [ds6w:globalType]:"ds6w:Part"',expand_iter:"0",fcs_url_mode:"REDIRECT",compute_select_bo:["thumbnail_2d","icon"],paths:[e],types:["VPMReference","VPMRepReference","VPMInstance"],root_path_physicalid:[e],select_bo:["ds6w:label","ds6w:modified","ds6w:created","ds6w:description","ds6wg:revision","ds6w:responsible","ds6w:status","ds6w:type","ds6wg:EnterpriseExtension.V_PartNumber","ds6wg:MaterialUsageExtension.DeclaredQuantity","physicalid","ds6w:reservedBy","ds6w:globalType","ds6w:isLastRevision","ds6w:reserved","ds6w:identifier"],select_rel:["ds6w:label","ds6w:type","physicalid"],tenant:i,locale:widget.lang};return new t((function(e,t){let n=encodeURIComponent(a.getSecurityToken());a.send3DSpaceRequest("resources/enoauthoring/expand/v1?tenant="+i+"&_="+o,"POST",{type:"json",headers:r.getHeaders({SecurityToken:n}),data:JSON.stringify(c)},e,t)}))},updateAttributes:function(e){var n={requests:[]};let s=(new Date).getTime(),r=e.nodeModel?e.nodeModel:void 0;var o={method:"PATCH",body:[],queryParams:{select:["physicalid","modified"]}},c=e.request;let u=e.isRelorBus;u&&"bus"!==u?o.path="model/"+u+"/"+e.relId:(u="bus",o.path="model/"+u+"/"+e.itemid),o.body=[];for(var d=0;d<c.length;d++){var l={},p=c[d];l.op="replace",p.extension&&(l.facet=p.extension),l.path=p.attribute,l.value=p.value,e.customAttribute&&void 0!==e.customAttribute?r&&r.getCustomDimensionType&&r.getCustomDimensionType()&&(l.unitName=r.getCustomUnit&&r.getCustomUnit()?r.getCustomUnit():void 0,l.dimensionType=r.getCustomDimensionType()):r&&r.getDimensionType&&r.getDimensionType()&&(l.unitName=r.getUnitName&&r.getUnitName()?r.getUnitName():void 0,l.dimensionType=r.getDimensionType()),o.body.push(l),p.attrSelectable?o.queryParams.select.push(p.attrSelectable):o.queryParams.select.push("attribute["+p.attribute+"]")}n.requests.push(o);var f=this;return new t((function(e,t){a.send3DSpaceRequest("resources/v1/collabServices/attributes/op/update?tenant="+i+"&_="+s,"PUT",{type:"json",headers:f.getHeaders(),data:JSON.stringify(n)},e,t)}))},getAlternateInfo:function(e){var n=this;let s=(new Date).getTime(),r=encodeURIComponent(a.getSecurityToken());return new t((function(t,o){a.send3DSpaceRequest("resources/v1/alternateManagement/getAlternateInfo?tenant="+i+"&_="+s,"POST",{type:"json",headers:n.getHeaders({SecurityToken:r}),data:JSON.stringify(e)},t,o)}))},addInstance:function(e){var n={version:"1.0",bAllOrNothing:!0,operations:[]},s={};s.parent={isInstanceOf:e.parentId,children:e.instanceIDs,cacheId:0},s.child={isInstanceOf:e.itemId,cacheId:0},n.operations.push(s);for(var r=0;r<e.quantity-1;r++){n.operations.push({parent:{cacheId:0},child:{cacheId:0}})}var o=this;return new t((function(e,t){a.send3DSpaceRequest("resources/product/instances?tenant="+i,"POST",{type:"json",headers:o.getHeaders(),data:JSON.stringify(n)},e,t)}))},removeInstance:function(e){var n={version:"1.0",bAllOrNothing:!0};n.instances=e.instances;var s=this;return new t((function(e,t){a.send3DSpaceRequest("resources/product/authoring/unparent?tenant="+i+"&securityContext="+a.getSecurityContext(),"POST",{type:"json",headers:s.getHeaders(),data:JSON.stringify(n)},e,t)}))},deleteItem:function(e){var n=!!e.isWholeStructure,s={};s.data=[{physicalid:e.itemId}],s.options=[{nlsKey:"Whole Structure",type:"checkbox",value:n,key:"wholeStructure"}];var r=this;return new t((function(e,t){a.send3DSpaceRequest("resources/lifecycle/Delete/structure?tenant="+i,"POST",{type:"json",headers:r.getHeaders(),data:JSON.stringify(s)},e,t)}))},getCoreMatInfo:function(e){var n=this;return new t((function(t,s){a.send3DSpaceRequest("resources/v1/engineeringItem/getAppliedCoreMaterial?tenant="+n.tenantID,"POST",{type:"json",headers:n.getHeaders({SecurityToken:n.securityToken,SecurityContext:n.SC}),data:UWA.Json.encode(e)},t,s)}))},fetchCoreMatDetails:function(e){var n=this;return new t((function(t,a){n.getCoreMatInfo(e).then((function(e){if(e&&e.references&&e.references_infos){for(var n=e.references,a=e.references_infos,s=new Map,r=0;r<n.length;r++)for(var i=n[r].physicalid,o=n[r].corematerial[0].physicalid,c=0;c<a.length;c++)o===a[c].physicalid&&s.set(i,a[c]);return t(s)}return t(null)})).catch((function(e){return a(e)}))}))},fetchCoveringMatDetails:function(e){var n=this;return new t((function(t,a){n.getCoveringMatInfo(e).then((function(e){if(e&&e.references&&e.references_infos){for(var n=e.references,a=e.references_infos,s=new Map,r=0;r<n.length;r++)for(var i=n[r].physicalid,o=n[r].coveringmaterial[0].physicalid,c=0;c<a.length;c++)o===a[c].physicalid&&s.set(i,a[c]);return t(s)}return t(null)})).catch((function(e){return a(e)}))}))},getCoveringMatInfo:function(e){var n=this;return new t((function(t,s){a.send3DSpaceRequest("resources/v1/engineeringItem/getAppliedCoveringMaterial?tenant="+n.tenantID,"POST",{type:"json",headers:n.getHeaders({SecurityToken:n.securityToken,SecurityContext:n.SC}),data:UWA.Json.encode(e)},t,s)}))},getMaterialDetails:function(e){let n=this;return new t((function(t,s){a.sendMaterialRequest("materials","matmgmt/api/v2/materials/list","POST",{type:"json",headers:n.getHeaders({"Content-type":"text/plain","X-Requested-With":"xmlhttprequest"}),data:e},t,s)}))},getmaterialFormulaDetails:function(e){let n=this,s="formuladesign/formulation/api/v1/formula/"+e+"/specification";return new t((function(e,t){a.sendBioExperiementRequest("bioexperiment",s,"GET",{type:"json",headers:n.getHeaders()},e,t)}))},getRecipe:function(e){let n=this,s="resources/formulatedproduct/v1/formulatedproduct/"+e.id+"/recipe",r=e.formula,i=e.processed,o=e.bom;return r?s+="?formula=true":o?s+="?bom=true":i&&(s+="?processed=true"),new t((function(e,t){a.send3DSpaceRequest(s,"GET",{type:"json",headers:n.getHeaders()},e,t)}))},checkMaterialMismatch:function(e){var n=this;return new t((function(t,s){a.send3DSpaceRequest("resources/v1/dsxmaterial/validate/"+e,"GET",{type:"json",headers:n.getHeaders({ENO_CSRF_TOKEN:n.CSRFToken,SecurityContext:n.SC,"Accept-Language":n.lang})},t,s)}))},listMaterials:function(e){var n=this;return new t((function(t,s){a.send3DSpaceRequest("resources/v1/dsxmaterial/"+e+"/materials","GET",{type:"json",headers:n.getHeaders({ENO_CSRF_TOKEN:n.CSRFToken,SecurityContext:n.SC,"Accept-Language":n.lang})},t,s)}))},getHeaders:function(e){var t={"Content-type":"application/json"};return this.isChangeControlled&&Object.assign(t,a.getWorkUnderHeaders()),e&&Object.keys(e).forEach((function(n){t[n]=e[n]})),t},disconnectFormulaIngredient:function(e,n){var s=this;return new t((function(t,r){a.send3DSpaceRequest("resources/formulatedproduct/v1/formulatedproduct/"+e+"/ingredeints","POST",{type:"json",headers:s.getHeaders({ENO_CSRF_TOKEN:s.CSRFToken,SecurityContext:s.SC}),data:JSON.stringify(n)},t,r)}))},formulaProductExpand:function(e){var n=this;return new t((function(t,s){a.send3DSpaceRequest("resources/formulatedproduct/v1/formulatedproduct/expand","POST",{type:"json",headers:n.getHeaders({ENO_CSRF_TOKEN:n.CSRFToken,SecurityContext:n.SC}),data:UWA.Json.encode(e)},t,s)}))},processIngredients:function(e,n){var s=this;return new t((function(t,r){a.send3DSpaceRequest("resources/formulatedproduct/v1/formulatedproduct/"+e+"/processIngredients","POST",{type:"json",headers:s.getHeaders({ENO_CSRF_TOKEN:s.CSRFToken,SecurityContext:s.SC}),data:JSON.stringify(n)},t,r)}))}})}));