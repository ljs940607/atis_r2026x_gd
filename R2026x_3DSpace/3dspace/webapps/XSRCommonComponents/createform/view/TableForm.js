define("DS/XSRCommonComponents/createform/view/TableForm",["UWA/Core","UWA/Controls/Abstract","DS/XSRCommonComponents/createform/view/NewDialog","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/TreeModel/DataModelSet","DS/DataGridView/DataGridView","DS/XSRCommonComponents/utils/Constants","DS/XSRCommonComponents/createform/util/TableFormGridCol","i18n!DS/XSRCommonComponents/assets/nls/XSRCommonComponents","css!DS/XSRCommonComponents/createform/view/TableForm.css"],(function(e,t,o,a,i,n,r,s,l,d){"use strict";return t.extend(e,{init(e){var t=this;return t.appCore=e.appCore,t.modelEvents=t.appCore.specViewerModelEvents,t.target=e.container,t.createCloseAction=e.createCloseAction,t.parentTitle=e.parentTitle,t.parentId=e.parentId,t.container=widget.body,t.bomGridCombos=e.bomGridCombos||[],t.dialog=null,t.dataGridView=null,t.model=null,t.refrence_possibleValues=new Set,t.subsList=[],t},loadData(e){let t=this;t.subscribeEvents(),t.createUI(),t.createDataGridView(e),t.bomGridCombos.forEach((e=>{e.split("_")[1]&&t.refrence_possibleValues.add(e.split("_")[1])}));let a={Title:d.connect+t.parentTitle,Content:t.tableFormContent,renderTo:t.target,width:800,height:300,RemoveApplyButton:!0,MakeFromProduct:e[0]._isMBMF};t.dialog=new o(a),t.dialog.destroyPrevDialog(),t.dialog.render(),t.dialog.listenTo(t.dialog,"EVENT_CLICK_SPEC_OK",t.formSubmit.bind(t)),t.dialog.listenTo(t.dialog,"EVENT_CLICK_SPEC_CANCEL",(()=>{}))},createUI(){let e=this;e.tableFormContent=this.createElement("div",{class:"xsr-tableForm-content"}),e.formMessage=this.createElement("div",{class:"xsr-tableForm-message",html:[{tag:"span",class:"wux-ui-3ds-required wux-ui-3ds span-icon",styles:{color:"#CC092F"}},{tag:"span",class:"span-text",text:d.message_reqQuanUOMAsReq}]}),e.formMessage.inject(e.tableFormContent),e.formToolbar=this.createElement("div",{class:"xsr-tableForm-toolbar"}),e.formToolbar.inject(e.tableFormContent),e.formTable=this.createElement("div",{class:"xsr-tableForm-table"}),e.formTable.inject(e.tableFormContent),e.formNotice=this.createElement("div",{class:"xsr-tableForm-notice"}),e.formNotice.inject(e.tableFormContent),this.createElement("div",{class:"duplicate-row",html:[{tag:"span",class:"wux-ui-3ds-attention wux-ui-3ds span-icon",styles:{color:"#e87b00"}},{tag:"span",class:"span-text",text:d.warning_errorInCol}]}).inject(e.formNotice)},createDataGridView(e){let t=this,o=new n;t.model=new a({dataModelSet:o}),t.model.prepareUpdate(),e.forEach((e=>{let a=e.id+"_"+e.referenceName,n=t.bomGridCombos.includes(a)?"#CC092F":"transparent",r=i.createTreeNodeDataModel(o,{label:e.title,grid:e,color:n});t.parentTitle||(t.parentTitle=e._parentTitle),t.model.addRoot(r)})),t.model.pushUpdate();let s={isMBMF:!0,parentTitle:t.parentTitle,dataCount:e.length},d=new l(s),m=d.getCols();m[4].getCellSemantics=t.getCellSemantics_referenceList.bind(t),t.dataGridView=new r({identifier:"myDataGridViewId",treeDocument:t.model,showContextualMenuColumnFlag:!0,columns:m,onContextualEvent:d.contextualEvent.bind(d)}),t.dataGridView.showNodeKPIColorFlag=!0,t.datGridEvents(),t.model.subscribe({event:"addChild"},t.postDeleteDuplicate.bind({modelEvents:t.modelEvents})),t.model.subscribe({event:"removeChild"},t.postDeleteDuplicate.bind({modelEvents:t.modelEvents}));let c=t.dataGridView.getTypeRepresentationFactory();c.registerTypeTemplates(JSON.stringify({UWAObjectTemplate:{path:"DS/SpecGridView/utils/UWAObjectTemplate",options:{}}}));c.registerTypeRepresentations(JSON.stringify({UWAObject:{stdTemplate:"UWAObjectTemplate"}})),t.dataGridView.inject(t.formTable)},datGridEvents(){let e=this;e.dataGridView.addEventListener("change",((t,o)=>{if(!o)return;let a=o.nodeModel?o.nodeModel.options.grid:null;a&&"connectCM"===e.dataGridView.layout.getDataIndexFromColumnIndex(o.columnID)&&e.dataGridView.treeDocument.getAllDescendants().forEach((e=>{a.connectCM&&o.rowID!==e._rowID&&(e.options.grid.connectCM=!1,e.updateOptions({grid:e.options.grid}))}))})),e.dataGridView.getTreeDocument().onNodeModelUpdate((t=>{if(t.data.attributes){t.data.nodeModel.options.grid;t.data.attributes.hasOwnProperty("referenceName")&&(null==t.data.attributes.referenceName?t.data.nodeModel.options.grid.referenceName="":e.refrence_possibleValues.add(t.data.attributes.referenceName)),e.validateForm()}})),e.dataGridView.onReady((function(){e.validateForm()})),e.dataGridView.addEventListener("allCellsRendered",(function(){e.validateForm()}))},subscribeEvents(){let e=this;e.subsList.push(e.modelEvents.subscribe({event:"add_MBMF_nodes"},(t=>{t.success&&e.destroy()})),e.modelEvents.subscribe({event:"add_MBMF_nodes_failure"},(()=>{e.destroy()})))},deleteFromGrid(){console.log(data)},getCellSemantics_referenceList(e){return{possibleValues:Array.from(this.refrence_possibleValues),allowFreeInputFlag:!0}},postDeleteDuplicate(e){this.modelEvents.publish({event:"postDeleteDuplicate",data:{target:e.target}})},validateForm(){let e=this,t=e.dataGridView.getTreeDocument().getChildren(),o=!1;0===t.length&&(o=!0);let a=new Set,i=new Set,n=!1;t.forEach((t=>{let o=!1,r=t.options.grid;if(r._dimensionDB===s.RECTANGULAR_DIMENSION)o=!(r.quantityLength&&r.quantityWidth&&r.unitDB&&r.asRequired)&&(!(r.quantityLength&&r.quantityWidth&&r.unitDB)&&!(!(r.quantityLength||r.quantityWidth||r.unitDB)&&r.asRequired));else if(r.isMBMF&&"EA"===r.unitDB)o=!1;else if("EA"===r.unitDB)o=!r.quantity>0;else{let e=!r.quantity&&!!r.unitDB||!!r.quantity&&!r.unitDB;r.asRequired||r.unitDB?!r.asRequired&&r.unitDB&&(o=!1):o=!0,e&&(o=!0)}let l=r.id+"_"+r.referenceName;i.has(l)||e.bomGridCombos.includes(l)?(n=!0,t.updateOptions({color:"#CC092F"})):(i.add(l),t.updateOptions({color:"transparent"})),a.add(o)})),n?e.formNotice.getChildren()[0].removeClassName("display-none"):e.formNotice.getChildren()[0].addClassName("display-none"),e.dialog._dialog.buttons.Ok.disabled=n||a.has(!0)||o},formSubmit(){let e=this;e.dialog._dialog.buttons.Ok.disabled=!0,e.createCloseAction(e.model.getChildren())},destroy(){this.dialog.closeDialog()}})}));