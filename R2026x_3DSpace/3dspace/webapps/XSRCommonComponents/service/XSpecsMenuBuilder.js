define("DS/XSRCommonComponents/service/XSpecsMenuBuilder",["UWA/Core","UWA/Class","UWA/Promise","DS/Menu/Menu","DS/XSRCommonComponents/utils/Utils","DS/XSRCommonComponents/utils/TypeUtils","DS/XSRCommonComponents/utils/OpenWithMenuProvider","DS/XSRCommonComponents/service/XSpecsActionsFactory","DS/XSRCommonComponents/utils/XSpecLocalStorage","DS/XSRCommonComponents/utils/RequestUtil","DS/XSRCommonComponents/utils/Constants","text!DS/XSRCommonComponents/assets/config/subscribeActions.json","text!DS/XSRCommonComponents/assets/config/replaceByActions.json","i18n!DS/XSRCommonComponents/assets/nls/XSRCommonComponents"],(function(e,t,n,a,i,o,s,r,u,c,l,d,f,p){"use strict";return t.singleton({init:function(e){this._parent(e)},initialize:function(e){r.setOptions(e)},isTypeOf:function(e){},_nodeMenuBuilder:function(e,t,a){var i=this;return new n((function(n,o){n(i._buildMenu(e,t,a))}))},_drawMenu:async function(e,t,n,a,i,s,c,h,m,A,M,y,_){var g=this;if(i.subCommand){var b=r.getActionMetaData(i.subCommand),I=s>1||i.access&&g.checkAccess(i.access)?"":"disabled";b&&(b.applicableAt.indexOf(atPlace)>=0||b.applicableAt.indexOf("all")>=0)?n.push(g._buildMenuEntry(r.getActionMetaData(a),"PushItem",e,I,a)):t.push(g._buildMenuEntry(r.getActionMetaData(a),"PushItem",e,I,a))}else{var S=s>1||i.access&&g.checkAccess(i.access)?"":"disabled";if("CompareWith"===a)s<=2&&t.push(g._buildMenuEntry(r.getActionMetaData(a),"PushItem",e,S,a));else if("DownloadReport"===a)S=""===S?_?"":"disabled":S,t.push(g._buildMenuEntry(r.getActionMetaData(a),"PushItem",e,S,a));else if("OpenWith"===a)g.appsList&&g.appsList.length>0&&t.push(g._buildMenuGroup(r.getActionMetaData(a),"PushItem",g.appsList,e)),t.push({type:"SeparatorItem"});else if("Subscriptions"===a){var P=[],E=JSON.parse(d).actions;E.forEach((function(t){var n=t.nls_key;P.push({type:"PushItem",title:p[n],fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+t.fonticon,family:WUXManagedFontIcons.Font3DS},action:{this:this,callback:function(n){r.fireAction(t,e)}}})})),E&&E.length>0&&t.push(g._buildMenuGroup(r.getActionMetaData(a),"PushItem",P,e))}else if("UPSAuthReplaceByRevision"!==a||A)if("VersionExplorer"===a||"ActionBar_ChangeOwner"===a||"DeleteItem"===a){if(t.push({type:"SeparatorItem"}),!(e.data instanceof Array)&&o.isPerformanceSpecChar(e.data.getTypeActualName())){let t=o.isPerformanceSpecification(e.data.getTypeActualName())?e.data:e.data.getParent();if("VersionExplorer"===a){S=t.isReleased&&t.isReleased()||t.isObsolete&&t.isObsolete()?"":"disabled"}else"DeleteItem"===a&&(S=t.getParentMaturityState()===l.MATURITY_IN_WORK&&t.isInWork&&t.isInWork()?"":"disabled")}t.push(g._buildMenuEntry(r.getActionMetaData(a),"PushItem",e,S,a))}else if("MultiOwnership"===a)t.push(g._buildMenuEntry(r.getActionMetaData(a),"PushItem",e,S,a)),t.push({type:"SeparatorItem"});else if("UPSAuthPaste"===a)u&&void 0!==u.xSpecData&&!u.xSpecData.hasOwnProperty("clipboard")&&(S="disabled"),t.push(g._buildMenuEntry(r.getActionMetaData(a),"PushItem",e,S,a));else if("UPSAuthReorderProduct"===a){let n=widget.getValue(l.PERSISTENCY_BOM_VIEW);null==n&&(n=!0),n&&(S="disabled"),t.push(g._buildMenuEntry(r.getActionMetaData(a),"PushItem",e,S,a))}else"addPerformanceCharacteristics"===a&&(S=e.data.isInWork()?"":"disabled"),t.push(g._buildMenuEntry(r.getActionMetaData(a),"PushItem",e,S,a));else{var O=[],C=JSON.parse(f).actions;C.forEach((function(t){var n=t.nls_key;O.push({type:"PushItem",title:p[n],fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+t.fonticon,family:WUXManagedFontIcons.Font3DS},action:{this:this,callback:function(n){r.fireAction(t,e)}}})})),C&&C.length>0&&t.push(g._buildMenuGroup(r.getActionMetaData(a),"PushItem",O,e))}}n.length>0&&menuNotPushed&&(t.push(g._buildMenuGroup(r.getActionMetaData(i.subCommand),"PushItem",n,e)),menuNotPushed=!1)},_buildMenu:async function(e,t,n){var a=this,o=function(e,o){var s,r=!1;if(Array.isArray(e.data))s=e.data.length,r=1!=s||!!e.data[0].isReportCheckedIn&&e.data[0].isReportCheckedIn();else{if(s=1,!e.data.getID)return;a.currentAccess=e.data.getCurrentAccess?e.data.getCurrentAccess():[],r=!!e.data.isReportCheckedIn&&e.data.isReportCheckedIn()}var u=[],c=[];return Object.keys(o).forEach((function(d){var f=d,p=o[d],h=p.applicableType;let m=p.excludeType;var A=p.applicableAt,M=a.isApplicableType(e.data,h);if(!a.isExcludeType(e.data,m)&&M&&A&&(A.indexOf(t)>=0||A.indexOf("all")>=0)){var y=!!(n&&n.length>0&&n.indexOf(f)>=0),_=p.isVisibleForMEI,g=i.isMEIItem(e.data);if(e.data.length&&e.data.length>1&&g){if("SetPartNumber"===f||"DownloadReport"===f||"OpenSpecificationView"===f||"UPSAuthReorderProduct"===f)return;a._drawMenu(e,u,c,f,p,s,h,A,M,y,_,g,r)}else if(e.data.length&&1===e.data.length){var b=i.isMEIItem(e.data[0]);y||"undefined"===e.data[0].currentTabKey||e.data[0].currentTabKey===l.MEI_TAB||b?b&&_&&(g||e.data[0].currentTabKey===l.MEI_TAB)&&A&&(A.indexOf(t)>=0||A.indexOf("all")>=0)&&a._drawMenu(e,u,c,f,p,s,h,A,M,y,_,b,r):a._drawMenu(e,u,c,f,p,s,h,A,M,y,_,b,r)}else if(y||"undefined"===e.data.currentTabKey||e.data.currentTabKey===l.MEI_TAB||g)g&&_&&(e.data.currentTabKey===l.MEI_TAB||g)&&A&&(A.indexOf(t)>=0||A.indexOf("all")>=0)&&a._drawMenu(e,u,c,f,p,s,h,A,M,y,_,g,r);else{if("UPSAuthReplaceByRevision"==f){let t;for(t=0;t<e.data.length;t++)if(e.data[t].options.grid.madeFromRelationId)return}a._drawMenu(e,u,c,f,p,s,h,A,M,y,_,g,r)}}})),u};return Array.isArray(e.data)&&e.data.length>1?o(e,r.getMultiSelActions()):(a.appsList=await s.getOpenWithMenu(e),o(e,r.getAllActions()))},isApplicableType:function(e,t){var n=!1,a=function(e){return o.isPhysicalProduct(e)?-1!==t.indexOf("PhysicalProduct")||-1!==t.indexOf("all"):!(!i.isDocument(e)||-1===t.indexOf("Documents")&&-1===t.indexOf("all"))||(!(!o.isDrawing(e)||-1===t.indexOf("Drawing")&&-1===t.indexOf("all"))||(!(!o.isTechnicalSpecification(e)||-1===t.indexOf("TechnicalSpecs")&&-1===t.indexOf("all"))||(!(!i.isCoreMaterial(e)||-1===t.indexOf(l.TYPE_CORE_MATERIAL)&&-1===t.indexOf(l.TYPE_CORE_MATERIAL_NAME)&&-1===t.indexOf("all"))||(!(!i.isCoveringMaterial(e)||-1===t.indexOf(l.TYPE_COVERING_MATERIAL)&&-1===t.indexOf(l.TYPE_COVERING_MATERIAL_NAME)&&-1===t.indexOf("all"))||(!!(i.isPerformanceSpec(e)&&-1!==t.indexOf(l.TYPE_PERFORMANCE_SPEC)||i.isPerformanceChar(e)&&-1!==t.indexOf(l.TYPE_PERFORMANCE_CHAR))||-1!==t.indexOf("all"))))))};if(Array.isArray(e))for(var s=0;s<e.length;s++){var r=e[s].getTypeActualName();if(!(n=a(r=e[s].getAttributeValue("parentType")==l.TYPE_DOCUMENT?e[s].getAttributeValue("parentType"):r)))break}else if(e){var u=e.getTypeActualName()||e.getType();n=a(u=e.getAttributeValue("parentType")==l.TYPE_DOCUMENT?e.getAttributeValue("parentType"):u)}return n},isExcludeType:function(e,t){return!(e instanceof Array)&&(!!t.includes(e.getTypeActualName())||(!(!t.includes(l.TYPE_PERFORMANCE_SPEC)||!o.isPerformanceSpecification(e.getTypeActualName()))||!(!t.includes(l.TYPE_PERFORMANCE_CHAR)||!o.isPerformanceCharacteristics(e.getTypeActualName()))))},_isParentInReleaseOrObsolete:function(e){let t=!1;if(e.data)if(e.data instanceof Array)for(let n=0;n<e.data.length;n++){let a=e.data[n];if(a.parentNodeModel&&"function"==typeof a.parentNodeModel.getMaturityActualName&&("RELEASED"===a.parentNodeModel.getMaturityActualName()||"OBSOLETE"===a.parentNodeModel.getMaturityActualName())){t=!0;break}}else{let n=e.data;!n.parentNodeModel||"function"!=typeof n.parentNodeModel.getMaturityActualName||"RELEASED"!==n.parentNodeModel.getMaturityActualName()&&"OBSOLETE"!==n.parentNodeModel.getMaturityActualName()||(t=!0)}return t},_getMenuState:function(e,t,n){let a=!0;if(t.data&&"RemoveChild"!==n)if(t.data instanceof Array){if("UPSAuthUnparent"!==n&&"DeleteItem"!==n||!this._isParentInReleaseOrObsolete(t)||(a=!1,e="disabled"),a)for(var o=0;o<t.data.length;o++){var s=t.data[o];if(i.isOriginatedInGLS(s)){e="disabled";break}}}else"UPSAuthUnparent"!==n&&"DeleteItem"!==n||!this._isParentInReleaseOrObsolete(t)||(a=!1,e="disabled"),a&&(e=i.isOriginatedInGLS(t.data)?"disabled":e);return e},_buildMenuEntry:function(e,t,n,a,o){var s,u,l=e.nls_key;c.isSafarionIPadorPod()?(u=e.touchFonticon?e.touchFonticon:e.fonticon,l=e.touch_nls_key?e.touch_nls_key:e.nls_key,s=e.touchIcon?i.getIconFormXSR(e.touchIcon):""):(u=e.fonticon,l=e.nls_key,s=e.icon?i.getIconFormPerfSpec(e.icon):""),a=this._getMenuState(a,n,o);var d={title:p[l],type:t,state:a,action:{this:this,callback:function(t){r.fireAction(e,n)}}};return u?d.fonticon={family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-"+u}:d.icon=s,d.fIcon=u,d.cmdID=o,d},_buildMenuGroup:function(e,t,n,a){var o,s=e.nls_key;c.isSafarionIPadorPod()?(o=e.touchFonticon?e.touchFonticon:e.fonticon,s=e.touch_nls_key?e.touch_nls_key:e.nls_key,e.touchIcon&&i.getIconFormXSR(e.touchIcon)):(o=e.fonticon,s=e.nls_key);var r=this._getMenuState("enabled",a,""),u={title:p[s],type:t,submenu:n,state:r};return u.fonticon={family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-"+o},u},checkAccess:function(e){var t=this,n=!0;if(t.currentAccess)for(var a=0;a<e.length;a++){var i=e[a];if(!(n=t.currentAccess.indexOf("all")>=0||-1!==t.currentAccess.indexOf(i)))break}return n},showMenu:function(e,t){e&&Array.isArray(t)&&a.show(t,{position:{x:e.x?e.x:e.left,y:e.y?e.y:e.bottom}})},getIdCardMenu:function(e,t){var n=this,a="ItemIDCard";if(!t)return this._nodeMenuBuilder(e,a);this._nodeMenuBuilder(e,a,["Information"]).then((function(e){n.showMenu(t,e)}))},getSpecListMenuView:function(e,t){var n=t||[];return i.hasAdminDisabledTemplate&&n.push("DownloadReport"),this._nodeMenuBuilder(e,"LandingPageActions",n)},getTabActions:function(e,t,n){var a=n||[];return i.hasAdminDisabledTemplate&&a.push("DownloadReport"),this._build(e,t,"ItemTabActions",a)},getQuickViewMenu:function(e,t,n){return this._build(e,t,"ItemTabQuickView",n)},_build:function(e,t,n,a){var i=this;if(!t)return this._nodeMenuBuilder(e,n);this._nodeMenuBuilder(e,n,a).then((function(e){i.showMenu(t,e)}))}})}));