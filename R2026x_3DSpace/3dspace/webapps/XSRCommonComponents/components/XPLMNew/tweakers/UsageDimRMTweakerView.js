define("DS/XSRCommonComponents/components/XPLMNew/tweakers/UsageDimRMTweakerView",["UWA/Controls/Abstract","DS/Controls/ComboBox","DS/Controls/Toggle","DS/Controls/LineEditor","DS/WUXAutoComplete/AutoComplete","DS/XSRCommonComponents/utils/TypeUtils","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/XSRCommonComponents/utils/Constants","i18n!DS/XSRCommonComponents/assets/nls/XSRCommonComponents","css!DS/XSRCommonComponents/components/XPLMNew/tweakers/xsrTweaker.css"],(function(e,t,a,i,l,s,n,o,r,u){"use strict";const d=e=>"false"!==e&&!!e;return e.extend({init:function(e){this._parent(e),this.tweakerCtx=e.tweakerCtx;var t=this.tweakerCtx.data.value;t&&(this.previousValue=t.split("|"))},_build:function(){var e=UWA.createElement("div",{id:"xsr-usagedim-tweaker-create"});return this._buildDimensionField().inject(e),this._buildUsageField().inject(e),e},_buildDimensionField:function(){var e=this,a=s.getRMDimensions(),i=[];Object.keys(a).forEach((function(t){i.push({labelItem:e.isNonNlsLabel(a[t])?t:a[t],valueItem:t})}));var l=this.previousValue?this.previousValue[0]:"",n=new t({elementsList:i,enableSearchFlag:!1,placeholder:u.placeholder_Dimensions,value:l});return n.elements.container.addClassName("xsr-tweaker-dim"),e.selectedDimension={label:n.label,value:n.value},n.addEventListener("change",(function(t){t.stopPropagation(),t.preventDefault();var a=t.dsModel.value,i=t.dsModel.value;e.selectedDimension={label:i,value:a},e._verifyAndLoadQtyUOM(),e.valueUpdated()})),n},_buildUsageField:function(){var e=this,t=UWA.createElement("div",{id:"xsr-usage-qty-row"});this.usageRow=t,this.qtyField=[];var i=UWA.createElement("div",{id:"xsr-usage-qty-field"}).inject(t),s=this._getNumberField("quantity",u.placeholder_Quantity);if(s.inject(i),s.addEventListener("change",(function(t){t.stopPropagation(),t.preventDefault();var a=t.dsModel.value;!a||parseFloat(a)>0?e.valueUpdated():e.tweakerCtx._dispatchNotification("warning",u.errMsg_basicErrMessageQuantity)})),this.qtyField.push(s),this.isRectangularDim()){s.placeholder=u.placeholder_Length;var o=this._getNumberField("width",u.placeholder_Width);o.inject(i),this.qtyField.push(o),o.addEventListener("change",(function(t){t.stopPropagation(),t.preventDefault();var a=t.dsModel.value;!a||parseFloat(a)>0?e.valueUpdated():e.tweakerCtx._dispatchNotification("warning",u.errMsg_basicErrMessageQuantity)}))}var r=new n,c=new l({domId:"xsr-auto-complete",placeholder:u.placeholder_UOMUnit,multiSearchMode:!1,elementsTree:r,allowFreeInputFlag:!1,allowResetToUndefinedByUIFlag:!0,keepSearchResultsFlag:!1});c.addEventListener("change",(function(t){t.stopPropagation(),t.preventDefault();var a=t.dsModel.value;if(a){var i=t.dsModel.selectedItems.getLabel();e.selectedUOM={label:i,value:a}}else e.selectedUOM={label:void 0,value:void 0};e.valueUpdated()})),this.uomField=c,e._loadUOMs(),c.inject(t);var h=new a({type:"switch",label:u.label_AsNeeded,domId:"xsr-toggle-button",value:void 0,allowUnsafeHTMLLabel:!1});return e.asReqVal=!1,h.addEventListener("change",(function(t){t.stopPropagation(),t.preventDefault();var a=t.dsModel.checkFlag;e.asReqVal=a,e.valueUpdated()})),h.inject(t),this.previousValue&&this.isRectangularDim()?(this.qtyField[0].value=this.previousValue[1],this.qtyField[1].value=this.previousValue[2],this.uomField.value=this.previousValue[3],h.checkFlag=d(this.previousValue[4])):this.previousValue&&(this.qtyField[0].value=this.previousValue[1],this.uomField.value=this.previousValue[2],h.checkFlag=d(this.previousValue[3])),t},valueUpdated:function(){let e=this.selectedDimension.value,t=this.selectedUOM?this.selectedUOM.value:void 0,a=this._getQuantityData(),i=this.asReqVal;var l=!1;if((i&&e&&!t&&!a.hasQuantityValue||i&&e&&t&&a.hasQuantityValue&&a.isQuantityValid||!i&&e&&t&&a.hasQuantityValue&&a.isQuantityValid)&&(l=!0),l){let l=a.quantityTooltip?a.quantityTooltip+" "+this.selectedUOM.label:this.selectedDimension.label;this.tweakerCtx._tooltip=l,t=t||"";var s=e+"|"+a.quantityForServer+"|"+t+"|"+i;this.tweakerCtx._dispatchChange(s,!0)}else this.tweakerCtx._tooltip=void 0,this.tweakerCtx._dispatchChange(void 0,!1)},isRectangularDim:function(){return this.selectedDimension.value===r.RECTANGULAR_DIMENSION},_verifyAndLoadQtyUOM:function(){let e=this.usageRow.parentElement;this.usageRow.destroy(),this.previousValue="",this._buildUsageField().inject(e),this.valueUpdated()},_getQuantityData:function(){let e,t,a={},i=this.qtyField,l=!1,s=!1;if(this.isRectangularDim()){let a=i[0].value,n=i[1].value;e=a&&n?a+"|"+n:"|",t=a&&n?a+"x"+n:"",l=!(!a&&!n),s=!(!a||!n)||!a&&!n}else{let a=i[0].value;e=a||"",t=a||"",s=l=!!a}return a.quantityForServer=e,a.quantityTooltip=t,a.hasQuantityValue=l,a.isQuantityValid=s,a},_resetQuantityUOM:function(){this.uomField.value="",this.qtyField.forEach((e=>e.value=void 0))},_loadUOMs:function(){var e=this,t=this.selectedDimension.value,a=s.getUOMUnits(t),i=[];Object.keys(a).forEach((function(t){i.push({labelItem:e.isNonNlsLabel(a[t])?t:a[t],valueItem:t})})),i.sort((function(e,t){let a=e.labelItem.toLowerCase(),i=t.labelItem.toLowerCase();return a>i?1:a<i?-1:0}));var l=this.uomField.elementsTree;this._resetQuantityUOM(),l.prepareUpdate(),l.empty(),null!=i&&Object.keys(i).forEach((function(t){var a=e.createNode(i[t].labelItem,i[t].valueItem);l.addRoot(a)})),l.pushUpdate()},isNonNlsLabel:function(e){return!!e.includes("emxFramework.")},createNode:function(e,t,a){return new o({label:e,value:t,grid:a||{}})},_getNumberField:function(e,t){var a=new i({value:"",domId:"xsr-line-editor-qty-tweaker",placeholder:t,displayClearFieldButtonFlag:!0,pattern:"(?!0+$)(?![0.]+$)([+]?[0-9]*[0-9,.]+$)"});return a.elements.container.addClassName(e),a}})}));