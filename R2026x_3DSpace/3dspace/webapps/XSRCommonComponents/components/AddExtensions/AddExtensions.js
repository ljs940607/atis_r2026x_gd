define("DS/XSRCommonComponents/components/AddExtensions/AddExtensions",["UWA/Class","DS/Controls/Button","DS/Windows/Dialog","DS/Controls/Expander","DS/Controls/Accordeon","DS/WUXAutoComplete/AutoComplete","DS/Controls/SelectionChipsEditor","DS/Controls/Editor","DS/Controls/LineEditor","DS/Controls/DatePicker","DS/Controls/ComboBox","DS/XSRCommonComponents/utils/Utils","DS/XSRCommonComponents/utils/Notification","i18n!DS/XSRCommonComponents/assets/nls/XSRCommonComponents"],(function(e,t,a,n,l,i,s,o,r,d,c,u,m,p){"use strict";return e.extend({init:function(e){this.itemId=e.itemId,this.type=e.type,this.parentId=e.parentId,this.modelEvents=e.modelEvents,this.applicableExts=e.applicableExtensions,this.attachedExts=e.attachedExtensions.filter((e=>"Change Control"!=e.name))},render:function(){var e=this;let s=e.attachedExts.map((e=>e.nameNLS)),o=e.applicableExts.map((e=>e.nlsName)).filter((e=>!s.includes(e)));e.extensionsNameToObjMap=e.applicableExts.reduce(((e,t)=>(e[t.nlsName]=t,e)),{}),e.extensionsToAdd={},e.extensionsAttribInfo={},e.extensionsToRemove=[];var r=UWA.createElement("div",{class:"add-extensions-container",styles:{height:"inherit"}}),d=UWA.createElement("div",{id:"ext-autocomplete-container",styles:{overflow:"visible"}}).inject(r),c=UWA.createElement("div",{id:"new-extension-container",styles:{overflow:"auto","padding-top":"1em"}}).inject(r),u=UWA.createElement("div",{id:"attachedExtDiv"}).inject(r),f=new i({elementsTree:o,allowFreeInputFlag:!1,placeholder:p.placeholder_enter_extensions}).inject(d);let h={};f.addEventListener("change",(function(t){let a=t.dsModel.value,n=v.items.map((e=>e.header));n.forEach((e=>{if(!a.includes(e)){let t=h[e];v.deleteItem(v.getIndexFromId(t)),delete h[e]}}));for(const t of a)if(!n.includes(t)){let a=v.addItem({header:t,content:e.getAttributesUI(e.extensionsNameToObjMap[t]),selected:!0});h[t]=a,v.expandItem(a)}}));var v=new l({style:"divided",exclusive:!1}).inject(c);let g=UWA.createElement("div",{id:"attachedExtsContainer"});e.attachedExts.forEach((t=>{let a=UWA.createElement("div",{class:"attachedExt",styles:{display:"flex","justify-content":"space-between","background-color":"#f1f1f1",padding:"0.6em","margin-bottom":"1em","border-radius":"1em"}}),n=(UWA.createElement("span",{class:"attachedExt-label",text:t.nameNLS}).inject(a),UWA.createElement("span",{class:"attachedExt-remove wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-exchange-delete",icon:"table",title:p.tooltip_remove_extension}).inject(a));a.inject(g),n.addEventListener("click",(a=>{e.extensionsToRemove.push(t.name),a.target.getParent().destroy()}))}));new n({header:p.label_attached_extensions,body:g}).inject(u);var x=new a({title:p.label_add_extensions,content:r,minHeight:300,width:600,activeFlag:!1,modalFlag:!0,resizableFlag:!0,buttons:{Ok:new t({onClick:function(){let t=v.items.map((e=>e.header)),a=!1;const n=e=>{for(const t of e)if(t.mandatory){let e=!t.value||""===t.value.trim();if("ReadOnly"==t.uiaccess?a=!1:(""==t.default&&(a=e),""!=t.default&&(t.ranges||null==t.value&&(t.value=t.default),t.value||(a=!1,""!==t.value&&void 0!==t.value||(a=!0))),t.ranges&&""!=t.default&&(a=!1),"Date"==t.primitive&&(t.value||(t.value=(new Date).toDateString()),a=!1)),a)return m.clearNotifications(),m.displayNotification({eventID:"warning",msg:p.mandatoryValue}),!1}return!0};if(t.length>0&&((()=>{for(const a of t){let t=e.extensionsNameToObjMap[a].attributes;if(!n(t))return;let l={},i={};t.forEach((e=>{let t=null,a=null;e.ranges&&"false"==e.multiValue?(e.value&&(t=Object.keys(e.ranges).find((t=>e.ranges[t]===e.value))),e.default&&(a=Object.keys(e.ranges).find((t=>e.ranges[t]===e.default)))):e.ranges&&"true"==e.multiValue?e.value&&(t=e.value.map((t=>Object.keys(e.ranges).find((a=>e.ranges[a]===t))))):(e.value&&(t=e.value),e.default&&(a=e.default)),i[e.path]={value:t||a||e.default,type:e.primitive,ranges:e.ranges,hasRange:e.hasRange,readOnly:"ReadOnly"===e.uiaccess,mandatory:e.mandatory},l[e.path]=t||a||e.default})),e.extensionsToAdd[e.extensionsNameToObjMap[a].name]=l,e.extensionsAttribInfo[e.extensionsNameToObjMap[a].name]=i}})(),a))return;let l={extToAdd:e.extensionsToAdd,extToRemove:e.extensionsToRemove,extAttribsInfo:e.extensionsAttribInfo,itemId:e.itemId,type:e.type,parentId:e.parentId};"ODT"==widget.getValue("mode")?(l=widget.extensionvalue,e.modelEvents.publish({event:"handle-modified-extensions",data:l})):e.modelEvents.publish({event:"handle-modified-extensions",data:l}),x.close()}}),Cancel:new t({onClick:function(){x.close()}})}})},getAttributesUI:function(e){var t=this;let a={Double:p.placeholder_enter_number,Boolean:p.placeholder_enter_boolean_values,String:p.placeholder_enter_value,Integer:p.placeholder_enter_integer_number},n=UWA.createElement("div",{class:"ext-attributes-container"});return e.attributes.forEach((l=>{let m=UWA.createElement("div",{class:"attribute-container",styles:{display:"flex","padding-bottom":"0.5em"}}).inject(n),f=UWA.createElement("div",{class:"label-box",styles:{display:"flex","padding-right":"1em",width:"50%"}}).inject(m),h=UWA.Element("span",{class:"errorIcon wux-ui-3ds wux-ui-3ds-error",styles:{color:" #ea4f37","font-size":"1em","padding-right":"0.1em","padding-top":"0.2em",display:"none"}}).inject(f),v=UWA.createElement("div",{class:"attribute-label-container",text:l.nlsName,styles:{"padding-right":"2em"}}).inject(f);if(l.mandatory)new UWA.Element("span",{class:"xsr-mandatory-flag",text:" *"}).inject(v);let g=UWA.createElement("div",{class:"attribute-field-container",id:l.nlsName.split(" ").join("")+"-field",styles:{width:"50%",display:"flex","flex-direction":"column"}}).inject(m),x="";if("ReadOnly"==l.uiaccess){UWA.createElement("div",{class:"attribute-value-read-only",text:l.default}).inject(g)}else{if(l.hasRange&&"true"==l.multiValue&&"Boolean"!=l.primitive){let e=Object.values(l.ranges).sort();"Date"==l.primitive&&(e=e.map((e=>u.formatDate(e))),u.formatAttributeRanges(l)),x=new i({elementsTree:e,allowFreeInputFlag:!1,placeholder:p.placeholder_dropdown}).inject(g)}else if("true"==l.multiValue&&"Date"!=l.primitive)x=new s({uniqueValue:!1,placeholder:a[l.primitive]}).inject(g);else if(l.hasRange){let e=Object.values(l.ranges).sort(),t=l.ranges[l.default];"Date"==l.primitive&&(e=e.map((e=>u.formatDate(e))),t=u.formatDate(t),u.formatAttributeRanges(l)),x=new c({elementsList:e,value:t}).inject(g)}else switch(l.primitive){case"Date":x=new d({placeholder:p.placeholder_enter_value,value:""==l.default?void 0:l.default,displayClearFieldButtonFlag:!0,allowUndefinedFlag:!0,allowMultipleValuesFlag:"true"==l.multiValue,timePickerFlag:!0,timePickerPrecision:"sec"}).inject(g);break;case"String":x=new("true"===l.multiLine.toLowerCase()?o:r)({placeholder:p.placeholder_enter_value,value:l.default,displayClearFieldButtonFlag:!0,maxLength:0!=l.maxLength?l.maxLength:""}).inject(g);break;case"Integer":x=new r({placeholder:p.placeholder_enter_number,value:l.default,pattern:"-?[0-9]+",displayClearFieldButtonFlag:!0}).inject(g);break;case"Double":x=new r({placeholder:p.placeholder_enter_real_number,value:l.default,pattern:"-?[0-9]+(.[0-9]+)?",displayClearFieldButtonFlag:!0}).inject(g);break;case"Boolean":x=new c({elementsList:[p.label_true.toUpperCase(),p.label_false.toUpperCase()],value:l.default.toUpperCase()===p.label_true.toUpperCase()?p.label_true.toUpperCase():p.label_false.toUpperCase()}).inject(g)}let n=UWA.createElement("div",{class:"xsr-invalid-entry-warning-text",text:"Enter a valid value",styles:{display:"flex","font-family":"Arial,sans-serif","font-size":"10px",color:"#77797c","padding-top":"2px","padding-bottom":"2px"}}).inject(g);n.hide(),x.addEventListener("change",(a=>{let i=a.dsModel.value,s=e.nlsName,o=l.name,r=t.extensionsNameToObjMap[s].attributes;if("true"==l.multiValue&&!l.hasRange)switch(l.primitive){case"Double":{let e=i.filter((e=>!/^-?\d+(\.\d+)?$/.test(e)));if(e&&e.length>0){let t=p.replace(p.get("warning_not_number"),{attributeName:l.nlsName,invalidValue:e[e.length-1]});n.textContent=t,h.show(),n.show()}else h.hide(),n.hide();break}case"Integer":{let e=i.filter((e=>!/^[-+]?\d+(\.0+)?$/.test(e)));if(e&&e.length>0){let t=p.replace(p.get("warning_not_integer"),{attributeName:l.nlsName,invalidValue:e[e.length-1]});n.textContent=t,h.show(),n.show()}else h.hide(),n.hide();break}case"Boolean":{let e=i.filter((e=>"true"!=e.toLowerCase()&&"false"!=e.toLowerCase()));if(e&&e.length>0){let t=p.replace(p.get("warning_not_boolean"),{attributeName:l.nlsName,invalidValue:e[e.length-1]});n.textContent=t,h.show(),n.show()}else h.hide(),n.hide();break}}for(let e=0;e<r.length;e++){let t=r[e];if(t.name===o){i instanceof Date?t.value=u.convertDateToStandard(i):"Date"!=l.primitive||"true"!=l.multiValue||l.hasRange?t.value=i:t.value=i.map((e=>u.convertDateToStandard(e)));break}}}))}if(l.unitNLSName&&""!==l.unitNLSName){UWA.createElement("span",{class:"dimension-unit-read-only",text:`(${l.unitNLSName})`,styles:{"margin-left":".5em"}}).inject(v)}})),n}})}));