define("DS/XSRCommonComponents/components/XSpecDnD/DragDropUtil",["UWA/Core","UWA/Class","DS/DataDragAndDrop/DataDragAndDrop","DS/XSRCommonComponents/components/XSpecDnD/DnDInvite","DS/XSRCommonComponents/utils/Constants","DS/XSRCommonComponents/utils/Utils","DS/XSRCommonComponents/utils/RequestUtil","DS/XSRCommonComponents/utils/Notification","DS/XSRCommonComponents/utils/TypeUtils","DS/XSRCommonComponents/utils/TypeServicesUtil","i18n!DS/XSRCommonComponents/assets/nls/XSRCommonComponents"],(function(e,t,o,n,a,i,r,s,d,l,p){"use strict";return t.extend({init:function(e){this.modelEvents=e?e.modelEvents:void 0},makeDragable:function(e,t){var n={data:this.prepareDragData(t),start:function(e,t){console.log("##drag start"),i.dragStartedInXSR=!0},stop:function(e){i.dragStartedInXSR=!1,console.log("###drag end")}};o.draggable(e,n)},_makeDropable:function(t){var n={enter:function(o,n){"function"===e.typeOf(t.onDragEnter)&&t.onDragEnter.apply(t.context,[o,n])},leave:function(o,n){"function"===e.typeOf(t.onDragLeave)&&t.onDragLeave.apply(t.context,[o,n])},over:function(o,n){"function"===e.typeOf(t.onDragOver)&&t.onDragOver.apply(t.context,[o,n])},drop:function(o,n,a){"function"===e.typeOf(t.onDrop)&&t.onDrop.apply(t.context,[o,n,a])}};o.droppable(t.element,n)},makeDroppable:function(e,t){var o=this,r=e,c=new n({renderTo:r});c.hide(),this._makeDropable({element:e,context:this,onDragEnter:function(){if(!0!==i.dragStartedInXSR){if(console.log("On drag Enter"),c.addBorder(),c.show(t),"BOM_insertProducts"===t||"BOM_insertMBMF"===t){let e=document.getElementById("BOM_insertProducts"),t=document.getElementById("BOM_insertMBMF");e.show(),t.show()}r.hasClassName("dragging")||r.addClassName("dragging")}else r.removeClassName("dragging")},onDragLeave:function(){console.log("On drag leave"),c.hide(),r.hasClassName("dragging")&&r.removeClassName("dragging")},onDragOver:function(){console.log("On drag over"),!0!==i.dragStartedInXSR&&(c.show(t),r.hasClassName("dragging")||r.addClassName("dragging"))},onDrop:function(e,n){if(console.log("On drop"),!0!==i.dragStartedInXSR){var m;if(c.hide(),r.removeClassName("dragging"),e)if((m=JSON.parse(e)).data.items||m.data.DataGridView_Row_Options){console.log(m);var g,u=m.data.DataGridView_Row_Options;g=u?1:m.data.items.length;var D=m.data.items||o.getDataFromGrid(u);if(!(D.length<=0))if("insert"===t||"insertMultiGrid"===t||"insertMbmfFacets"===t||"BOM_insertProducts"===t||"BOM_insertMBMF"===t){var v=[];let e=[];for(var y=[],f=0;f<D.length;f++){var I=D[f];if(d.isPhysicalProduct(I.objectType))v.push({id:I.objectId});else if(d.isDrawing(I.objectType))e.push(I);else{var S=p.replace(p.get("CannotAddMaterials"),{Name:I.displayName});y.push(S),s.displayNotification({eventID:"error",msg:S})}}("insert"===t||"BOM_insertProducts"===t)&&e.length>0?o.modelEvents.publish({event:"xsr-add-drawing-on-drop",data:e}):"insertMbmfFacets"===t&&e.length>0?s.displayNotification({eventID:"error",msg:p.UnsupportedDrop}):"insert"===t||"BOM_insertProducts"===t?o.modelEvents.publish({event:"xsr-add-item-on-drop",data:v}):"insertMultiGrid"===t?o.modelEvents.publish({event:"attr-multigrid-item-on-drop",data:{items:v,fromWidget:m.widgetId,src:m.source}}):"insertMbmfFacets"===t||"BOM_insertMBMF"===t?o.modelEvents.publish({event:"xsr-add-item-on-drop-MakeFrom",data:v}):"BOM_insertMBMF"===t&&o.modelEvents.publish({event:"bom-tab-drop-MakeFrom",data:v})}else"drop"===t&&(g>1?s.displayNotification({eventID:"error",msg:p.NoMultipleDrop}):i.isValidItemOnOpen(D[0].objectType)?o.modelEvents.publish({event:a.XSR_ITEM_DROP,data:{itemPid:D[0].objectId,typeActual:D[0].objectType}}):(new l).isValidItemToOpen(D[0].objectType).then((t=>{t.isValidType?(e={objectType:D[0].objectType,displayType:D[0].displayType},t.isRawM?d.addToRawMaterial([e]):d.addToPhysicalProduct([e]),o.modelEvents.publish({event:a.OPEN_SPECIFICATION_VIEW,data:{itemPid:D[0].objectId,typeActual:D[0].objectType}})):s.displayNotification({eventID:"error",msg:p.UnsupportedDrop})})))}else s.displayNotification({eventID:"error",msg:{title:p.Invalidcontent,subtitle:p.DropValidData}});else s.displayNotification({eventID:"error",msg:{title:p.Invalidcontent,subtitle:p.DropValidData}})}}})},cleanDroppable:function(e){o.clean(e)},getDataFromGrid:function(e){var t=e["dswebux/x-datagridview.row.options.grid+json"];if(t){var o={protocol:"3DXContent",version:"1.1",source:"ENOSPEC_AP",widgetId:widget.id,data:{items:[]}},n=[];if(Array.isArray(t))t.forEach((function(e){var t={envId:r.getPlatformId(),serviceId:a.SERVICE_3DSPACE_NAME,contextId:"",objectId:e.physicalId,objectType:e["ds6w:type_value"],displayName:e["ds6w:label"],displayType:e["ds6w:type"]};n.push(t)}));else{var i={envId:r.getPlatformId(),serviceId:a.SERVICE_3DSPACE_NAME,contextId:"",objectId:t.physicalId,objectType:t["ds6w:type_value"],displayName:t["ds6w:label"],displayType:t["ds6w:type"]};n.push(i)}return o.data.items=n,n}},prepareDragData:function(e){var t={protocol:"3DXContent",version:"1.1",source:"ENOSPEC_AP",widgetId:widget.id,data:{items:[]}},o=[];return e.forEach((function(e){var t={envId:r.getPlatformId(),serviceId:a.SERVICE_3DSPACE_NAME,contextId:"",objectId:e.getID?e.getID():e.options.grid.id,objectType:e.getTypeActualName?e.getTypeActualName():e.options.grid.typeDBName,displayName:e.getLabel?e.getLabel():e.options.grid.label,displayType:e.getType?e.getType():e.options.grid.type};o.push(t)})),t.data.items=o,JSON.stringify(t)}})}));