var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebGUI3DComposerPlayer/VCXPropertiesViewPlayer",["require","exports","DS/VCXGUIInfrastructure/VCXAccordeonUIServices","DS/VCXGUIInfrastructure/VCXMainPanel","UWA/Core","i18n!DS/VCXWebGUI3DComposerPlayer/assets/nls/VCXWebGUI3DComposerPlayer"],(function(e,t,n,i,a,r){"use strict";n=__importDefault(n),i=__importDefault(i),r=__importDefault(r);class s extends i.default{constructor(e,t){super(e,t),this.panelAccordeon=n.default.BuildAccordeon(),this.displayedInfo={},this._selectElementMessage={}}buildPanelContent(e,t,i){if(i.length){let i=(0,a.createElement)("div",{class:"vcxPanelContentBody"});this.setPanelContent(i),this.panelAccordeon.getContent().inject(i),console.log(e);let r=[];Object.keys(e).every((n=>{let i=e[n];return r.push(t.createTweakerGroup({group:i,displayedInfo:{}})),!0}));for(let e=0;e<r.length;e++){const t=r[e];t.groupAccordeonItem.disabled=!0,n.default.AddExpander(this.panelAccordeon,t.groupAccordeonItem)}}else{this._selectElementMessage=(0,a.createElement)("div",{html:"",class:"vcxPanelWatermarkContainer"});let e=new a.createElement("div",{html:"",class:"vcxSelectEltNode vcxSelectEltIcon fonticon fonticon-touch"}),t=(0,a.createElement)("div",{html:r.default["VCXProperties.SelectObj"],class:"vcxSelectEltNode vcxSelectEltTxt"});e.inject(this._selectElementMessage),t.inject(this._selectElementMessage),this.setPanelContent(this._selectElementMessage)}}cleanPanelContent(){this.panelAccordeon&&this.panelAccordeon.clear()}}return s})),define("DS/VCXWebGUI3DComposerPlayer/VCXHardwareStatusUIPlayerCtrl",["require","exports","DS/VCXGUIInfrastructure/VCXGUIComponentCtrl","DS/VCXWebSystem/VCXHardwareServices","i18n!DS/VCXWebGUI3DComposerPlayer/assets/nls/VCXWebGUI3DComposerPlayer"],(function(e,t,n,i,a){"use strict";return class extends n{constructor(){super()}postInitialize(){const e=i.GetGraphicCard(),t=null===e,n=!t&&i.isLowGraphicPresent(e);if(this._experienceBase.getManager("VCXAnalyticsTrackerAppManager")&&this._experienceBase.getManager("VCXAnalyticsTrackerAppManager").trackGraphicCards(e),t||n){var r=!!localStorage&&localStorage.getItem("DS_COMPOSER_LOW_GRAPHIC_CARD_DETECTED");"true"!==r&&"1"!==r&&this._experienceBase.getManager("VCXNotificationManager").addNotification({level:"warning",title:a["Notification.LowGraphicCardTitle"],message:a["Notification.LowGraphicCardAction"],action:{label:a["Notification.Confirm"],callback:function(){localStorage&&(localStorage.setItem("DS_COMPOSER_LOW_GRAPHIC_CARD_DETECTED","true"),this.getParent()&&(this.getParent().destroy(),location.reload()))}}})}}}}));var VCXThumbnailDisplayModeEnum={List:0,Small:1,Large:2,Tile:3};define("DS/VCXWebGUI3DComposerPlayer/VCXScenarioCtrlExt",["UWA/Class","DS/VCXGUIInfrastructure/VCXGUIComponentCtrl","DS/CoreEvents/Events","DS/Core/PointerEvents","DS/VCXGUIInfrastructure/VCXUISequence","DS/VCXKeyFramer/VCXScenario","DS/VisuEvents/EventsManager","DS/Controls/ThumbnailView","DS/WebappsUtils/WebappsUtils","DS/VCXGUIInfrastructure/VCXTabPageFrame","DS/Layouts/GridEngine","DS/ApplicationFrame/CommandsManager","DS/VCXWebKernel/VCXCmdChangeSelection","DS/VCXWebKernelCommands/VCXCmdGoToScenarioWithInterpolation","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebVisualization/VCXPublishRasterImage","DS/VCXWebIO/VCXFileServices","DS/VCXWebKernelCommands/VCXCmdChangeScenarioSequence","i18n!DS/VCXWebGUI3DComposerPlayer/assets/nls/VCXWebGUI3DComposerPlayer"],(function(e,t,n,i,a,r,s,o,l,c,u,d,m,h,C,g,p,v,_){"use strict";return t.extend({init:function(){},onresizePanel:function(e,t){var n,i,a=0,r=0;for(n in e._thumbnailsList){var s=e._thumbnailsList[n];s.length>r&&(r=s.length)}if(r>0){var o=e.getItemDisplaySize()[0]+10;a=(i=Math.floor(t/o))*o}if(r>=i)for(var l in e._sequenceContent){var c=e._sequenceContent[l];c&&(c.style.width=a+"px")}e.updateToolbar()},getItemDisplaySize:function(){var e=this.getThumbnailDisplaySize(),t=e[0],n=e[1];switch(this._displayMode){case VCXThumbnailDisplayModeEnum.List:return[t,50];case VCXThumbnailDisplayModeEnum.Small:return[t,n];case VCXThumbnailDisplayModeEnum.Large:return[1.5*t,1.5*n];case VCXThumbnailDisplayModeEnum.Tile:return[1.4*t+10,n]}},getThumbnailDisplaySize:function(){return[165,118]},BuildView:function(e){var t="SequenceFolder.Scenarios",i="Sequence.CADViews",r="Sequence.CADCaptures",s="Sequence.Layers";const o=[t=_[t],(i=_[i])+"|"+(r=_[r]),s=_[s]],l=e.playerMode;var u=this;this.playerMode=Boolean(l),this._displayMode=VCXThumbnailDisplayModeEnum.Small,this._vcxGuiManager=this._experienceBase.getManager("VCXGUIManager"),this._sequenceContent={},this._thumbnailsList=[],this.options={_experienceBase:this._experienceBase,_uiLayer:this._vcxGuiManager._uiLayer,classBaseNameCSS:"vcx-scenarios-",sidePanel:{title:"Scenarios",icon:{iconName:"camera",fontIconFamily:WUXManagedFontIcons.Font3DS},side:"left",minWidth:300,styles:{height:"100%"},controller:this,usecallback:this.onresizePanel,currentDockArea:4},onResizeCb:this.onResize,slidingViews:{displayTabAtStart:1,activateViewOn:1,_vcxuiSequencesMaster:{},views:[]},recId:"scenarioCtrlRec"},this._vcxGuiManager.immersiveFrame&&(this.options.immersiveFrame=this._vcxGuiManager.immersiveFrame);for(var d=1,m=0;m<o.length;++m)this.options.slidingViews._vcxuiSequencesMaster[d]={},this.options.slidingViews._vcxuiSequencesMaster[d][o[m]]=new a(this._experienceBase,this),++d,this.options.slidingViews.views.push({title:o[m],content:{html:u.options.slidingViews._vcxuiSequencesMaster[m+1][o[m]],iframe:!1}});this.options.recId="scenarioCtrlRec";_["VCXScenarios.PanelTitle"],this._vcxGuiManager.immersiveFrame,WUXDockAreaEnum.RightDockArea;this._tabPageFrame=new c(this.options),this._tabPageFrame._header.addClassName("vcxNoMenu"),this.onCreateToolBarButtons(this.getFrame().getPanel()),this.updateToolbar(),this._bSelectionMode=!1,this._updateSceneSymbol=new UWA.Element("div",{class:"wux-ui-3ds fonticon-refresh vcx-updateScene-symbol",html:[]}),this.currentViewpoint={angle:-1,eyePos:null,sightDir:null},this._activeSequence=null,this._currentScenarioId=null,this.options.immersiveFrame?(this.getFrame().getPanel().style.minHeight="100%",this.getFrame().getPanel().style.minWidth="300px"):(this.getFrame().getPanel().elements.content.style.minHeight="100%",this.getFrame().getPanel().elements.panel.style.minWidth="300px"),this.activateDisplayStyle("Small");var h=u._experienceBase;h.getManager("VCXSequenceManager");this.onResizeCB=()=>{var e=h.getManager("VCXScenarioManager").GetScenarios()[u._currentScenarioId];this.ChangeTimelinePosition(e,u._currentScenarioId),this.onResize()},window.attachEvent?this._tokenResize=window.attachEvent("onresize",this.onResizeCB):window.addEventListener&&(this._tokenResize=window.addEventListener("resize",this.onResizeCB,!0)),this._tokenCreateThumb=n.subscribe({event:"VCX_CREATE_THUMBNAIL"},(function(e){u.onCreateThumbnail(u,e)})),this._tokenScChanged=n.subscribe({event:"VCX_SCENARIO_CHANGED"},(function(e){u.onScenarioChanged(u,e)})),this._tokenScMoved=n.subscribe({event:"VCX_SCENARIO_MOVED"},(function(e){u.onScenarioMoved(u,e)})),this._tokenCurrentScenario=n.subscribe({event:"VCX_CURRENT_SCENARIO_CHANGED"},(function(e){u.onCurrentScenarioChanged(e.GetID(),e)})),this._tokenBeginTrans=n.subscribe({event:"VCX_BEGIN_TRANSITION"},(function(e){document.body.addClassName("waiting"),u.onCurrentScenarioChanged(e.scenario._ID,e.scenario),u.hideNeedForUpdate(),u.stopListeningToViewpointChange(),u.onBeginEndTransition(u,e)})),this._tokenBeginEndTrans=n.subscribe({event:"VCX_END_TRANSITION"},(function(e){var t={};t.maxframe="number"==typeof e&&e||0,u.onBeginEndTransition(u,t),document.body.removeClassName("waiting")})),this._tokenSeqNameChanged=n.subscribe({event:"VCX_SEQUENCE_NAME_CHANGED"},(function(e){u.onSequenceNameRefresh(u,e)})),this._tokenScenarioNameChanged=n.subscribe({event:"VCX_SCENARIO_NAME_CHANGED"},(function(e){u.onScenarioNameRefresh(u,e)})),this._tokenScenarioReplaced=n.subscribe({event:"VCX_SCENARIO_REPLACED"},(function(e){u.onScenarioReplaced(e.GetID(),e)})),this._tokenSeqChanged=n.subscribe({event:"VCX_SEQUENCE_CHANGED"},(function(e){u.onSequenceChanged(u,e)})),this._tokenRefreshIcon=n.subscribe({event:"VCX_REFRESH_ICON"},(function(e){u.RefreshAnimIcon(u,e)}))},unInitialize:function(){if(window.focus(),this._sequenceContent){for(var e in this._sequenceContent){(t=this._sequenceContent[e]).cbonPrimaryPointerUpUnique&&s.removeEventFromToken(t.cbonPrimaryPointerUpUnique),t.removeEvent("dragend"),t.removeEvent("dragover"),t.grid&&t.grid.onCellRequest(null)}this._sequenceContent=[]}if(this._thumbnailsList){for(var e in this._thumbnailsList)for(var t=this._thumbnailsList[e],i=0;i<t.length;i++){var a=t[i];a._pointerDownToken&&(s.removeEventFromToken(a._pointerDownToken),a._pointerDownToken=null),a._pointerUpToken&&(s.removeEventFromToken(a._pointerUpToken),a._pointerUpToken=null),a.cbdragstart&&(a.elements.picture.removeEventListener("dragstart",a.cbdragstart),a.cbdragstart=null),a.cbdragenter&&(a.elements.picture.removeEventListener("dragenter",a.cbdragenter),a.cbdragenter=null),a.cbdragend&&(a.elements.picture.removeEventListener("dragend",a.cbdragend),a.cbdragend=null),a.cbdragover&&(a.elements.picture.removeEventListener("dragover",a.cbdragover),a.cbdragover=null),a.cbCheckBoxChange&&(a.elements.checkbox.removeEventListener("change",a.cbCheckBoxChange),a.cbCheckBoxChange=null),a.cbEditScenario&&(a.elements.container.removeEventListener("keydown",a.cbEditScenario,!0),a.elements.picture.removeEventListener("keydown",a.cbEditScenario,!0),a.cbEditScenario=null),a.cbOnClickScenario&&(a.elements.container.removeEventListener("click",a.cbOnClickScenario),a.elements.title.removeEventListener("click",a.cbOnClickScenario),a.cbOnClickScenario=null)}this._thumbnailsList=[]}n.unsubscribe(this._tokenCreateThumb),delete this._tokenCreateThumb,n.unsubscribe(this._tokenScChanged),delete this._tokenScChanged,n.unsubscribe(this._tokenScMoved),delete this._tokenScMoved,n.unsubscribe(this._tokenCurrentScenario),delete this._tokenCurrentScenario,n.unsubscribe(this._tokenScenarioReplaced),delete this._tokenScenarioReplaced,n.unsubscribe(this._tokenBeginTrans),delete this._tokenBeginTrans,n.unsubscribe(this._tokenBeginEndTrans),delete this._tokenBeginEndTrans,n.unsubscribe(this._tokenSeqNameChanged),delete this._tokenSeqNameChanged,n.unsubscribe(this._tokenScenarioNameChanged),delete this._tokenScenarioNameChanged,n.unsubscribe(this._tokenSeqChanged),delete this._tokenSeqChanged,n.unsubscribe(this._tokenRefreshIcon),delete this._tokenRefreshIcon,this.stopListeningToViewpointChange(),this._viewpointWatcher=null,this._vcxGuiManager&&this._vcxGuiManager._vcxTimeline&&(this.getFrame().getFooter().removeChild(this._vcxGuiManager._vcxTimeline.getView().getContainer()),this._vcxGuiManager._vcxTimeline.unInitialize(),this._vcxGuiManager.RemoveTimelineEvents(),this._vcxGuiManager._vcxTimeline=null),this._scenePanelView&&this._scenePanelView.unInitialize(),this._vcxGuiManager&&this._vcxGuiManager._vcxTimelineMain&&(this._vcxGuiManager._vcxTimelineMain.unInitialize(),this._vcxGuiManager._vcxTimelineMain=null),window.attachEvent?(window.detachEvent(this._tokenResize),delete this._tokenResize):window.addEventListener&&(window.removeEventListener("resize",this.onResizeCB,!0),delete this._tokenResize),this.onResizeCB=null,this.getFrame()&&this.getFrame().unInitialize()},getFrame:function(){return this._tabPageFrame},updateToolbar:function(){this.getFrame().getToolbar().updateToolbar()},onCreateToolBarButtons:function(e){var t=this,n=this.getFrame().getToolbar(),i=(s=this._vcxGuiManager._experienceBase.getManager("VCXContextManager")).getContextFromName("ProdHighMode"),a=s.getContextFromName("ExperienceIn3DPlay");if(this.playerMode&&(a||i)&&n.addMainItemFixed("VCXPlayGuidedTourCmd","","vcxToolbarButtonIconChecked","VCXWebProducts",_,null,"I_VCX_AB_PlayGuidedTour.png","VCX_PLAY_GUIDED_TOUR_START","VCX_PLAY_GUIDED_TOUR_END",!0),!this.playerMode){var r=this._experienceBase.getManager("VCXExperience");r.updateLogData&&!0===r.updateLogData.showDialog&&n.addMainItemFixed("VCXShowUpdateViewCmd","","vcxToolbarButton wux-ui-3ds-update","VCXWebInteropSMG/VCXWebGUI3DComposerPlayer",_);var s,o=s&&s.getContext(),l=(d.getCommand("VCXCreateEmptyScenarioCmd",o),[]);if(l[0]=this,l[1]=this.setVisibilityAllChexkBox,l[2]=!0,n.addMainItemFixed(l,"","vcxToolbarButton vcxToolbarButtonSelect","VCXWebInteropSMG/VCXWebGUI3DComposerPlayer",_,null,"VCXSetVisibilityAllChexkBoxCmd"),n.addMainItemFixed("VCXCreateEmptyScenarioCmd","","vcxToolbarButton fonticon-doc-add","VCXWebInteropSMG/VCXWebGUI3DComposerPlayer",_),n.addMainItemFixed("VCXAddCameraKeyCmd","","vcxToolbarButton fonticon-camera-refresh","VCXWebInteropSMG/VCXWebGUI3DComposerPlayer",_),n.addMainItemFixed("VCXCreateScenarioCmd","","vcxToolbarButton fonticon-plus","VCXWebInteropSMG/VCXWebGUI3DComposerPlayer",_),this._scenePanelView){var c=[];c[0]=this,c[1]=function(){this._scenePanelView&&this._scenePanelView.toggleVisibility()},c[2]=!0,n.addMainItemFixed(c,"","vcxToolbarButton vcxToolbarButtonDisplaySimplified","")}(s=this._vcxGuiManager._experienceBase.getManager("VCXContextManager")).isSupported("Timeline")&&!s.getContextFromName("PlayerMode")&&n.addMainItem("VCXDisplayTimelineCmd","","vcxToolbarButton vcxToolbarButtonTimeline","VCXWebAuthoringAppGUICommands/VCXWebAuthoringAppGUICommands","i18n!DS/VCXWebAuthoringAppGUICommands/assets/nls/VCXWebAuthoringAppGUICommands"),n.addMainItemFixed("VCXDeleteSceneSelectionCmd","","vcxToolbarButton vcxToolbarButtonDelete","VCXWebInteropSMG/VCXWebGUI3DComposerPlayer",_,n.getEditToolbar()),n.addMainItemFixed("VCXReplaceScenarioCmd","","vcxToolbarButton vcxToolbarButtonUpdate","VCXWebInteropSMG/VCXWebGUI3DComposerPlayer",_,n.getEditToolbar()),n.addMainItemFixed("VCXApplyToSelectedCmd","","vcxToolbarButton wux-ui-3ds-propagate","VCXWebInteropSMG/VCXWebGUI3DComposerPlayer",_,n.getEditToolbar())}var u=function(e){t.activateDisplayStyle(e)};n.addSubItemFixed(u,"ScenarioViewOptions","vcxToolbarButton vcxToolbarButtonDisplayList","","",_["VCXScenario.Display.List"],"List"),n.addSubItemFixed(u,"ScenarioViewOptions","vcxToolbarButton vcxToolbarButtonDisplaySmall","","",_["VCXScenario.Display.Small"],"Small"),n.addSubItemFixed(u,"ScenarioViewOptions","vcxToolbarButton vcxToolbarButtonDisplayLarge","","",_["VCXScenario.Display.Large"],"Large"),n.addSubItemFixed(u,"ScenarioViewOptions","vcxToolbarButton vcxToolbarButtonDisplayTile","","",_["VCXScenario.Display.Tile"],"Tile"),n.addMenu("","vcxToolbarButtonStarterMenuRight","vcxToolbarButton vcxToolbarButtonLayout","VCXWebGUI/VCXWebGUI3DComposerPlayer",_,"VCXScenarioToolbarDisplayLayout");var m=[];m[0]=this,m[1]=this.setVisibilityAllChexkBox,m[2]=!1,n.addMenu(m,"vcxToolbarButtonStarterMenuRight vcxToolbarButtonStarterMenuRightEdit","vcxToolbarButton vcxToolbarButtonExit","VCXWebGUI/VCXWebGUI3DComposerPlayer",_,"VCXScenarioToolbarExit",n.getEditToolbar()),n.activeSubItemFixed("vcxToolbarButton vcxToolbarButtonDisplaySmall")},activateDisplayStyle:function(e){var t=this;switch(this.getFrame().getToolbar().activeSubItemFixed("vcxToolbarButton vcxToolbarButtonDisplay"+e),this.getFrame().getPanel().removeClassName("vcx-displaySmall"),this.getFrame().getPanel().removeClassName("vcx-displayTile"),this.getFrame().getPanel().removeClassName("vcx-displayList"),this.getFrame().getPanel().removeClassName("vcx-displayLarge"),this.getFrame().getPanel().addClassName("vcx-display"+e),e){case"Tile":t._displayMode=VCXThumbnailDisplayModeEnum.Tile;break;case"List":t._displayMode=VCXThumbnailDisplayModeEnum.List;break;case"Large":t._displayMode=VCXThumbnailDisplayModeEnum.Large;break;case"Small":t._displayMode=VCXThumbnailDisplayModeEnum.Small}t.onResize()},OnEndBuildView:function(){this.loadScenariosFromExperience(),this.onCurrentScenarioChanged(this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario()),this._tabPageFrame&&this._tabPageFrame._panelMaster.windowGroup&&(this._tabPageFrame._panelMaster.windowGroup.multiSelFlag=!1,this._tabPageFrame._panelMaster.windowGroup.currentWindows=[this._tabPageFrame._panelMaster])},RefreshView:function(){var e=this._experienceBase.getManager("VCXContextManager").getPlayerMode(),t=this._experienceBase.getManager("VCXAPIManager").HasAnimation("AnimationSmgID"),n=!1;e?e&&!t&&(n=!0):n=!0,this.onCurrentScenarioChanged(this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario()),n&&1===this._experienceBase.getManager("VCXExperience").GetViewMode()&&this.setSequenceState("Animation",!1)},loadScenariosFromExperience:function(){var e=this,t=e._experienceBase.getManager("VCXSequenceManager").GetListSequences();e.addSequences(e,t)},addSequences:function(e,t){for(var n=0;n<t.length;n++){var i=t[n],a=n-1;e.createSequence(i,a,e),e._scenePanelView&&e._scenePanelView.createSequenceView(i.GetID(),i.GetName(),l.getWebappsAssetUrl("VCXWebGUI","css/img/VCXSequence.png"))}},getUISequenceTarget:function(e){for(var t in this.options.slidingViews._vcxuiSequencesMaster)for(var n in this.options.slidingViews._vcxuiSequencesMaster[t]){if(e===n)return this.options.slidingViews._vcxuiSequencesMaster[t][n];var i=n.split("|");for(var a in i)if(e===i[a])return this.options.slidingViews._vcxuiSequencesMaster[t][n]}return this.options.slidingViews._vcxuiSequencesMaster[1][Object.keys(this.options.slidingViews._vcxuiSequencesMaster[1])[0]]},getUISequenceIndex:function(e,t){var n=0;for(n in e.elements.items){if(e.elements.items[n].childNodes[0].childNodes[1].innerHTML===t)break}return n},createSequence:function(e,t,n){var i=e.GetID(),a=e.GetName();"CAD Captures"!==a&&"CAD Views"!==a||n._tabPageFrame._header.removeClassName("vcxNoMenu");var r=t+1,o=this.getUISequenceTarget(a);0===r&&(r=o.itemLength),o.addItem(r,{text:a});var l=n._sequenceContent[i]=new UWA.Element("div",{class:"VCX container-fluid hidden-print vcx-fluid-content",html:[]});l.sequenceIndex=r,o.setContent(r,l),l.addEvent("dragover",(function(e){if(1!==e.dataTransfer.types.length&&e.dataTransfer.types.includes("text/plain"))e.dataTransfer.dropEffect="none";else if(e.target.hasClassName("VCX container-fluid")){var t="";t=n.amIBefore(n.dragged.elements.container,n.dropTarget)?"afterend":"beforeBegin",n.dropTarget&&n.isThereBrotherAround(e)||(n.dropSequence=n.getSequenceDrop(e),n.dropTarget=n.getLastThumnbailFromSequence(n.dropSequence),t="afterend"),n.dropTarget.elements.container.insertAdjacentElement(t,n.dragged.elements.container),e.preventDefault()}})),l.addEvent("dragend",(e=>{var t=n._vcxGuiManager._experienceBase,i=t.getManager("VCXSequenceManager").GetSequenceFromScenarioId(n.dragged.scenarioID),a="";i&&(a=i.GetID());var r=-1;n.dropTarget&&(n.dropSequence=n.dropTarget.elements.container.parentNode.getAttribute("sequenceid"),r=Array.prototype.indexOf.call(n.dropTarget.elements.container.parentNode.children,n.dragged.elements.container)),n.moveScenarioView(n.dragged.scenarioID,a,n.dropSequence,r);var s=new v(t.getManager("VCXSequenceManager"),t.getManager("VCXCommandManager"),t.ComponentsMap);s.MoveScenario(n.dragged.scenarioID,n.dropSequence,r),t.getManager("VCXCommandManager").Push(s)}));var c=o.elements.items[r];c.sequenceId=i;var d=c.getElementsByClassName("VCXUISequence-title")[0];c.counterThumbs=new UWA.Element("div",{html:"0",class:"VCXcounterThumbs",styles:{}}),c.counterThumbs.inject(d),1===o.itemLength?(o.elements.container.childNodes[0].childNodes[0].style.opacity="0",o.elements.container.childNodes[0].childNodes[0].style.marginBottom="-15px"):(o.elements.container.childNodes[0].childNodes[0].style.opacity="",o.elements.container.childNodes[0].childNodes[0].style.marginBottom=""),n.activeSequence(c),l.cbonPrimaryPointerUpUnique=s.addEvent(l.parentNode,"onPrimaryPointerUpUnique",(function(){n.activeSequence(c)})),l.sequenceID=i,l.setAttribute("SequenceID",i);for(var m=n._vcxGuiManager._experienceBase.getManager("VCXScenarioManager").GetScenarios(),h=e.GetListScenariosId(),C=(n._thumbnailsList[i]=[],0);C<h.length;C++){var g=h[C];n.createScenarioView(m[g],n,e.GetID(),C)}this.setSequenceState(a,!0),l.grid=new u({model:n._thumbnailsList[i],defaultCellWidth:300,defaultCellHeight:200,showRowsHeader:!0,showColumnsHeader:!0,headersDimensions:{width:20,height:20}}),l.grid.onCellRequest((function(e,t){var n=e.virtualColumnID;if(t._thumbnailsList[n]){var i=t._thumbnailsList[n];e.cellView.getContent().setHTML(i)}}))},createScenarioView:function(e,t,n,a){var o=t._vcxGuiManager._experienceBase;o.getManager("VCXSequenceManager");if(n);else{var c=o.getManager("VCXSequenceManager").GetListSequences();n=c[0].GetID()}var u=0;-1!==a&&(u=a);var d=this._thumbnailsList[n][u],m=!1;if(!d||d.scenarioID&&d.scenarioID!==e.GetID()){m||(d=t.createThumbnailView(e,t,n,a)),(t=this).playerMode?d.elements.thumbnail.draggable=!1:d.elements.thumbnail.draggable=!0,d.cbdragstart=function(e){if(!this.draggable)return e.preventDefault(),void e.stopPropagation();t.dropTarget=d,e.dataTransfer.setData("scene",e.target.id),e.dataTransfer.effectAllowed="move",t.dragged=d,t.dragged.elements.container.classList.add("vcxDrag")},d.elements.thumbnail.addEventListener("dragstart",d.cbdragstart,!1),d.cbdragenter=function(e){if(1!==e.dataTransfer.types.length&&e.dataTransfer.types.includes("text/plain"))e.dataTransfer.dropEffect="none";else if(t.dropTarget=d,e.preventDefault(),void 0===t.dragged&&(t.dragged=d),t.dragged.elements.picture!==e.toElement){var n="";n=t.amIBefore(t.dragged.elements.container,d.elements.container)?"afterend":"beforeBegin",d.elements.container.insertAdjacentElement(n,t.dragged.elements.container),t.dropTarget=d}},d.elements.thumbnail.addEventListener("dragenter",d.cbdragenter,!1),d.cbdragover=function(e){if(1!==e.dataTransfer.types.length&&e.dataTransfer.types.includes("text/plain"))e.dataTransfer.dropEffect="none";else{if(!this.draggable)return e.preventDefault(),void e.stopPropagation();e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault()}},d.elements.thumbnail.addEventListener("dragover",d.cbdragover,!1),d.cbdragend=function(e){t.dragged.elements.container.classList.remove("vcxDrag")},d.elements.thumbnail.addEventListener("dragend",d.cbdragend,!1),d.cbdrop=function(e){(e=e||event).preventDefault()},d.elements.thumbnail.addEventListener("drop",d.cbdrop,!1);var h=e.GetName();d.setTitle(h),d.scenarioID=e.GetID(),d.scenarioIndex=u,d.elements.thumbnail._scenarioID=e.GetID(),e.HasAnimation()&&(d.elements.title.style.left="30px !important",d.elements.subtitle.style.left=d.elements.title.style.left,d.elements.icon.addClassName("hasAnimation"));var C=this._experienceBase.getManager("VCXSequenceManager").GetSequenceFromId(n),g=null,p=e.GetDocId(),v=o.getManager("VCXDocManager").GetPropPath(p);if(v)g=v.GetValueURL().GetValue();if("Animation smg"===h)d.setPicture(l.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_Thumbnail_Animation.png")),this._scenePanelView&&this._scenePanelView.updateScenario(e.GetID(),C.GetID(),h,l.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_Thumbnail_Animation.png"),e.GetID()===t._currentScenarioId);else if(g){var _=new XMLHttpRequest;_.open("GET",g,!0),_.responseType="blob",_.onload=function(n){if(200==this.status){var i=this.response,a=new FileReader;a.onload=function(n){d.setPicture(n.target.result),t._scenePanelView&&t._scenePanelView.updateScenario(e.GetID(),C.GetID(),h,n.target.result,e.GetID()===t._currentScenarioId)},a.readAsDataURL(i)}},_.send()}else e.GetScenarioType()===r.EScenarioType.CADView?d.setPicture(l.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_Thumbnail_CADViews.png")):e.GetScenarioType()===r.EScenarioType.CADCapture?d.setPicture(l.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_Thumbnail_CADCaptures.png")):e.GetScenarioType()===r.EScenarioType.Layer?d.setPicture(l.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_Thumbnail_Layer.png")):this.onScenarioReplaced(e.GetID(),e);var b=C.GetName(),S=this.getUISequenceTarget(b);if(this._vcxGuiManager._experienceBase.getManager("VCXContextManager").getContextFromName("ShowRoomMode"));else{t.targetInteraction=null,d._pointerDownToken=s.addEvent(d.elements.container,"onPrimaryPointerDownUnique",(function(e){S.elements.items[t._sequenceContent[n].sequenceIndex];d.elements.checkbox.elements.container.focus()})),d.cbEditScenario=function(n){"F2"===n.key&&(e.GetID()===t._currentScenarioId||d.elements.container.hasClassName("vcxItemSelected"))&&setTimeout((function(){console.log("F2"),d.elements.title.focus()}),0)},d.cbOnClickScenario=a=>{var r=e=>{var n=a.path&&a.path[0]||a.currentTarget;n&&n.hasClassName("vcx-controls-thumbnail-title")||(t.endRenameScenario(),document.removeEventListener(i.POINTERDOWN,r),document.removeEventListener("keydown",s))},s=e=>{"Enter"===e.key?(t.endRenameScenario(),document.removeEventListener(i.POINTERDOWN,r),document.removeEventListener("keydown",s),d.elements.title.contentEditable=!0):"Escape"===e.key&&(t.endRenameScenario(!0),document.removeEventListener(i.POINTERDOWN,r),document.removeEventListener("keydown",s),d.elements.title.contentEditable=!0)};if(!(o=a.path&&a.path[0]||a.currentTarget).hasClassName("vcx-controls-thumbnail-title")||t.playerMode||t.getFrame().getToolbar().isEditMode()){""!==t.startEditScenarioID&&(t.endRenameScenario(),document.removeEventListener(i.POINTERDOWN,r),document.removeEventListener("keydown",s));var o=a.target;if(t.targetInteraction=o,!t.targetInteraction||t.targetInteraction!=o)return void(t.targetInteraction=null);if(a&&a.gesture&&a.gesture.currentEvent[0]&&a.gesture.currentEvent[0].currentPosition.distanceTo(a.gesture.currentEvent[0].startPosition)>8)return void(t.targetInteraction=null);if(o.hasClassName("wux-ui-fa")||o.hasClassName("vcx-controls-checkbox"))return t.targetInteraction=null,!1;t.targetInteraction=null,t.activeSequence(S.elements.items[t._sequenceContent[n].sequenceIndex]);var l=e.GetID();if(t.getFrame().getToolbar().isEditMode())d.elements.checkbox.toggle();else if(t._experienceBase.getManager("VCXExperience").GoToScenarioContext()){if(t.setVisibilityAllChexkBox(!1),t.onCurrentScenarioChanged(l,e),void 0!==t._vcxGuiManager._experienceBase.getManager("VCXContextManager").getUrlVars().DSWebRecord){require(["DS/WebRecordEnabler/Adapter"],(function(e){e.TraceManager.debug("ADD document.waitConditionScenario"),document.waitConditionScenario=e.WaitManager.addWaitCondition(2e4,"Wait go to scenario"),t._vcxGuiManager._experienceBase.getManager("VCXAPIManager").GoToScenario(l,(function(){e.TraceManager.debug("REMOVE document.waitConditionScenario"),e.WaitManager.removeWaitCondition(document.waitConditionScenario),document.waitConditionScenario=null}))}))}else t._vcxGuiManager._experienceBase.getManager("VCXAPIManager").GoToScenario(l);if(t._vcxGuiManager._vcxTimelineExtCtrl&&t._vcxGuiManager._vcxTimelineExtCtrl._mainPanel){var c=t._vcxGuiManager._vcxTimelineExtCtrl._mainPanel.style.display;t._vcxGuiManager._uiLayer.removeChild(t._vcxGuiManager._vcxTimelineExtCtrl._mainPanel),t._vcxGuiManager.InitTimelineExtCtrl(l),t._vcxGuiManager._vcxTimelineExtCtrl._mainPanel.style.display=c}}}else a.stopPropagation(),document.addEventListener(i.POINTERDOWN,r),document.addEventListener("keydown",s),t.startEditScenarioID=e.GetID()},this._vcxGuiManager.isTouchActivated()?(d.elements.container.addEventListener("touchstart",d.cbOnClickScenario),d.elements.title.addEventListener("touchstart",d.cbOnClickScenario)):(d.elements.container.addEventListener("click",d.cbOnClickScenario),d.elements.title.addEventListener("click",d.cbOnClickScenario)),d.elements.container.addEventListener("keydown",d.cbEditScenario,!0),d.elements.picture.addEventListener("keydown",d.cbEditScenario,!0);var V=S.elements.items[t._sequenceContent[n].sequenceIndex];V.counterThumbs.innerHTML=parseInt(V.counterThumbs.innerHTML)+1}}else m=!0},endRenameScenario:function(e){if(e)for(var t in this._thumbnailsList)for(var n=this._thumbnailsList[t],i=0;i<n.length;i++){if((r=n[i]).scenarioID===this.startEditScenarioID){var a=(o=(s=this._experienceBase.getManager("VCXScenarioManager").GetScenarios()[r.scenarioID].QueryInterface("VCXIModifiable")).GetProperty("Actor.Name")).GetPropertyValue().GetValue();return r.elements.title.innerHTML=a,void(this.startEditScenarioID="")}}else for(var t in this._thumbnailsList)for(n=this._thumbnailsList[t],i=0;i<n.length;i++){var r;if((r=n[i]).scenarioID===this.startEditScenarioID){var s,o,l=r.elements.title.innerHTML,c=new C(this._experienceBase.getManager("VCXScenarioManager"),this._experienceBase.getManager("VCXCommandManager"));return(o=(s=this._experienceBase.getManager("VCXScenarioManager").GetScenarios()[r.scenarioID].QueryInterface("VCXIModifiable")).GetProperty("Actor.Name")).GetPropertyValue().SetValue(l),c.ChangeProperty(s,o),this._experienceBase.getManager("VCXCommandManager").Push(c),void(this.startEditScenarioID="")}}},isThereBrotherAround:function(e){var t=20,n=[{x:t,y:t},{x:t,y:-20},{x:-20,y:-20},{x:-20,y:t}],i=e.clientX,a=e.clientY,r=null;for(var s in n){var o=n[s];if(i+=o.x,a+=o.y,(r=document.elementsFromPoint(i,a)[0])&&(r.hasClassName("vcx-controls-thumbnail-picture")||r.hasClassName("vcx-controls-thumbnail-title")))return this.getThumbnailFromDiv(r)}return null},getSequenceDrop:function(e){for(var t in this._sequenceContent)if(this._sequenceContent[t]===e.target)return t},getLastThumnbailFromSequence:function(e){var t=this._experienceBase.getManager("VCXSequenceManager").GetSequenceFromId(e).GetListScenariosId().slice(-1)[0];for(var n in this._thumbnailsList)for(var i=this._thumbnailsList[n],a=0;a<i.length;a++){var r=i[a];if(r.scenarioID===t)return r}return null},getThumbnailFromDiv:function(e){for(var t in this._thumbnailsList)for(var n=this._thumbnailsList[t],i=0;i<n.length;i++){var a=n[i];if(a.elements.picture===e||a.elements.title===e)return a}return null},amIBefore:function(e,t){for(var n=t.previousElementSibling;n;){if(n===e)return!0;n=n.previousElementSibling}return!1},RefreshAnimIcon:function(e,t){var n=e._vcxGuiManager._experienceBase.getManager("VCXSequenceManager").GetSequenceFromScenarioId(t.GetID()),i=n.GetIndexOfScenario(t.GetID()),a=e._thumbnailsList[n.GetID()][i];t.HasAnimation()&&(a.elements.title.style.left="30px !important",a.elements.subtitle.style.left=a.elements.title.style.left,a.elements.icon.addClassName("hasAnimation"))},RefreshTimeline:function(e,t){if(this.playerMode||this._experienceBase.odt||this._experienceBase.getManager("VCXContextManager").isSupported("Timeline")){var n=this._experienceBase.getManager("VCXGUIManager").getUsableArea().clientHeight-54-2;if(this._vcxGuiManager.deleteTimeline(),e&&e.HasAnimation()){this.getFrame().getContent().style.maxHeight=n-61+"px",this.getFrame().getFooter().style.height="50px",this.getFrame().getFooter().style.visibility="visible";var i=this._experienceBase.getManager("VCXScenarioManager").GetCurrentFrame();if(this._vcxGuiManager.InitTimelineCtrl(t,i),this._vcxGuiManager._vcxTimelineCtrl._timelines&&this._vcxGuiManager._vcxTimelineCtrl._timelines[1]){var a=this._vcxGuiManager._vcxTimelineCtrl._timelines[1].timeline.getView().getParentPanel().currentDockArea;this._vcxGuiManager._vcxTimelineCtrl.options.frmWindow.getImmersiveFrame().getDockingElement(a).collapseDockingZoneFlag=!1}this._vcxGuiManager._forceDisplayTimeline=!0}else this.getFrame().getContent().style.maxHeight=n+"px",this.getFrame().getFooter().style.height="0px",this.getFrame().getFooter().style.visibility="hidden"}},ChangeTimelinePosition:function(e,t){var n=this._experienceBase.getManager("VCXGUIManager").getUsableArea().clientHeight-54-2;if(e&&e.HasAnimation()){var i=this._experienceBase.getManager("VCXScenarioManager").GetCurrentFrame();(null===this._vcxGuiManager._vcxTimelineCtrl||null===this._vcxGuiManager._vcxTimelineCtrl.panelCtrl)&&this._vcxGuiManager.InitTimelineCtrl(t,i),this.getFrame().getContent().style.maxHeight=n-61+"px",this.getFrame().getFooter().style.height="50px",this.getFrame().getFooter().style.visibility="visible"}else this.getFrame().getContent().style.maxHeight=n+"px",this.getFrame().getFooter().style.height="0px",this.getFrame().getFooter().style.visibility="hidden"},onCreateThumbnail:function(e,t){var n=e._vcxGuiManager._experienceBase,i=t.scenario,a=t.sequenceId,r=parseInt(t.prevIndex),s=e._thumbnailsList[a],o=s[r+1];e.createThumbnailView(i,e,a,r,o),o=s[r+1],i._name&&"Animation smg"===i._name?o.setPicture(l.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_Thumbnail_Animation.png")):e.capturePixels().then((function(e){var t=p.dataURLToBlob(e),a=window.URL.createObjectURL(t);if(o){o.setPicture(e);var r=a,s=n.getManager("VCXDocManager").BuildPathFromString(r),l=n.getManager("VCXDocManager").AddOrModifyDoc(s),c=i.QueryInterface("VCXIModifiable");i.SetDocId(l._value),n.getManager("VCXScenarioManager").AddNeutrals(c,c.GetProperties())}}))},GetActiveSequenceId:function(){return this._activeSequence?this._activeSequence.sequenceId:null},activeSequence:function(e){e!==this._activeSequence&&(this._activeSequence&&this._activeSequence.removeClassName("vcxActiveSequence"),this._activeSequence=e,this._activeSequence.addClassName("vcxActiveSequence"))},setSequenceState:function(e,t){var n=this.getUISequenceTarget(e);if(n){var i=this.getUISequenceIndex(n,e);i&&n.setSequenceItemOpenedState(i,t)}},setDescription:function(e,t){var n=this._experienceBase;let i=n.getManager("VCXSequenceManager").GetSequenceFromScenarioId(e).GetID();n.getManager("VCXSequenceManager").GetSequenceFromId(i).GetName();var a=this._thumbnailsList[i];for(var r in a){if(a[r].scenarioID===e){var s=a[r];s.elements.container.removeClassName("vcx-no-description"),s.elements.subtitle.innerHTML=t;break}}},editDescription:function(e){},createThumbnailView:function(e,t,n,i,a){if(t._activeSequence){var r=t._activeSequence;t.activeSequence(r)}var s=a;if(s);else{(s=new o({size:"small"}).inject(t._sequenceContent[n])).elements.transition=new UWA.Element("div",{html:"",class:"vcxTransition"}).inject(s.elements.container),s.elements.transitionBack=new UWA.Element("div",{html:"",class:"vcxTransitionBack"}).inject(s.elements.container),s.elements.container.id=e.GetID(),s.elements.container.setAttribute("data-rec-id",e.GetID()),s.elements.container.addClassName("vcx-controls-thumbnail"),s.elements.container.getCheckpointData=this.getThumbnailDataForRecord,t._vcxGuiManager._experienceBase.getManager("VCXContextManager").isSupported("PaperControlV2")&&s.elements.container.addClassName("vcx-ratio-compliant"),s.elements.picture.setAttribute("data-rec-id",e.GetID()+"-picture"),s.elements.picture.addClassName("vcx-controls-thumbnail-picture"),s.elements.cartouche.setAttribute("data-rec-id",e.GetID()+"-cartouche"),s.elements.cartouche.addClassName("vcx-controls-thumbnail-cartouche"),s.elements.cartouche.getChildren()[0].setAttribute("data-rec-id",e.GetID()+"-cartouche-content"),s.elements.title.setAttribute("data-rec-id",e.GetID()+"-title"),s.elements.title.addClassName("vcx-controls-thumbnail-title"),s.elements.subtitle.setAttribute("data-rec-id",e.GetID()+"-subtitle"),s.elements.subtitle.addClassName("vcx-controls-thumbnail-subtitle"),s.elements.subtitle.innerHTML="",s.elements.container.addClassName("vcx-no-description"),s.elements.icon.addClassName("vcx-controls-thumbnail-icon"),s.elements.picture.childNodes[0].addClassName("vcx-controls-checkbox");var l=0;-1!==i&&(l=i,t.insertIndex(s.elements.thumbnail,l)),t._thumbnailsList[n].splice(l,0,s),s.elements.menu.innerHTML="",s.elements.menu.addClassName("vcx-controls-thumbnail-menu");var c=t._vcxGuiManager._experienceBase.getManager("VCXSequenceManager").GetSequenceFromId(n).GetName(),u=this.getUISequenceTarget(c);t.playerMode&&(s.elements.checkbox.elements.container.style.display="none"),s.cbCheckBoxChange=function(i){if(!t.playerMode){t.activeSequence(u.elements.items[t._sequenceContent[n].sequenceIndex]);var a=i.dsModel.checkFlag;a?(t.setVisibilityAllChexkBox(!0),s.elements.container.addClassName("vcxItemSelected")):(s.elements.container.removeClassName("vcxItemSelected"),t.getFrame().getToolbar().activateEditMode());var r=new m(t._vcxGuiManager._experienceBase.getManager("VCXSelectionManager"));a?r.AddToSelection(e):r.RemoveFromSelection(e),t._vcxGuiManager._experienceBase.getManager("VCXCommandManager").Do(r)}},s.elements.checkbox.addEventListener("change",s.cbCheckBoxChange)}return t.options.immersiveFrame?t.onresizePanel(t,Math.max(parseInt(t.getFrame().getPanel().style.minWidth),parseInt(t.getFrame().getPanel().offsetWidth))):t.onresizePanel(t,Math.max(parseInt(t.getFrame().getPanel().elements.panel.style.minWidth),parseInt(t.getFrame().getPanel().elements.panel.offsetWidth))),s},getThumbnailDataForRecord:function(e){var t={};t.value=this.getAttributeNames(),e(t,!0)},onResize:function(e){var t=e||this;t.getFrame()._panelMaster.elements.container.parentNode&&t.onresizePanel(t,Math.max(parseInt(0),parseInt(t.getFrame()._panelMaster.elements.container.parentNode.offsetWidth)))},index:function(e){for(var t=e.parentNode.childNodes,n=0;n<t.length;n++){if(t[n]===e)return n}return 0},insertIndex:function(e,t){var n=e.parentNode.childNodes[t];return this.index(e)>t?e.parentNode.insertBefore(e,n):e.parentNode.insertBefore(e,n.nextSibling),e},checkAllCheckBox:function(){for(var e in this._thumbnailsList)for(var t=this._thumbnailsList[e],n=0;n<t.length;n++){if(t[n].elements.checkbox.checkFlag)return!0}return!1},setVisibilityAllChexkBox:function(e){var t=this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario();this.setThumbnailCheckBox(e,t)},getNbItems:function(){var e=0;for(var t in this._thumbnailsList){e+=this._thumbnailsList[t].length}return e},getNbSelectedItems:function(){var e=0;for(var t in this._thumbnailsList)for(var n=this._thumbnailsList[t],i=0;i<n.length;i++){n[i].elements.checkbox.checkFlag&&e++}return e},setThumbnailCheckBox:function(e,t){var n,i,a,r=this._activeSequence;for(var s in e?(n="VCXCheckBoxOn",i="VCXCheckBoxOff",a=!1):(n="VCXCheckBoxOff",i="VCXCheckBoxOn",a=!0),this._thumbnailsList)for(var o=this._thumbnailsList[s],l=0;l<o.length;l++){var c=o[l];c.elements.container.hasClassName(n)||(c.elements.container.removeClassName(i),c.elements.container.addClassName(n),c.elements.title.contentEditable=!!a,c===t||e||(c.elements.checkbox.checkFlag=!1,c.elements.container.removeClassName("vcxItemSelected")))}e?this.getFrame().getToolbar().activateEditMode():(this.getFrame().getToolbar().exitEditMode(),this.activeSequence(r))},onScenarioMoved:function(e,t){e.moveScenarioView(t.scenarioToAdd.GetID(),t.sequenceIdForRemove,t.sequenceIdForAdd,t.scenarioAddIdx)},onScenarioChanged:function(e,t){var n=e._vcxGuiManager._experienceBase;if(t.scenarioToAdd){var i=n.getManager("VCXSequenceManager").GetSequenceFromId(t.sequenceIdForAdd),a=i.GetIndexOfScenario(t.scenarioToAdd.GetID());e.createScenarioView(t.scenarioToAdd,e,t.sequenceIdForAdd,a);var r=n.getManager("VCXSequenceManager").GetIndexOfSequence(i),s=i.GetName(),o=e.getUISequenceTarget(s);if(!o.isSequenceOpened(r)){var l=e.getUISequenceIndex(o,s);o.sequenceOpenedItem(l)}if(t.bLinked&&e._selectedScenarioIds)for(var c=n.getManager("VCXScenarioManager").GetScenarios(),u=0;u<e._selectedScenarioIds.length;u++){var d=c[e._selectedScenarioIds[u]];if(d){var h=new m(n.getManager("VCXSelectionManager"));h.RemoveFromSelection(d),n.getManager("VCXCommandManager").Do(h)}}}else if(t.scenarioToRemove){e.removeScenarioView(t.scenarioToRemove.GetID(),t.sequenceIdForRemove);var C=n.getManager("VCXSequenceManager").GetSequenceFromId(t.sequenceIdForRemove);if(!n.getManager("VCXCommandManager")._isUnDoRunning&&!t.bLinked){var g=new m(n.getManager("VCXSelectionManager")),p=C.FindScenario(t.scenarioRemovedIdx);p&&g.SetSelection(p),n.getManager("VCXCommandManager").Do(g)}}},removeScenarioView:function(e,t){var n=this._experienceBase.getManager("VCXSequenceManager");t||(t=n.GetSequenceFromScenarioId(e).GetID());var i=n.GetSequenceFromId(t).GetName(),a=this.getUISequenceTarget(i),r=this._thumbnailsList[t];for(var s in r){if(r[s].scenarioID===e){var o=r[s];this._sequenceContent[t].removeChild(o.elements.thumbnail),this._thumbnailsList[t].splice(s,1);var l=a.elements.items[this._sequenceContent[t].sequenceIndex];l.counterThumbs.innerHTML=parseInt(l.counterThumbs.innerHTML)-1;break}}},moveScenarioView:function(e,t,n,i){var a=this._experienceBase.getManager("VCXSequenceManager");if(t);else{var r=a.GetSequenceFromScenarioId(e);if(null===r)return void console.log("error - Scenario "+e+" unknown in Sequence Manager");t=r.GetID()}var s=a.GetSequenceFromId(t).GetName(),o=this.getUISequenceTarget(s),l=a.GetSequenceFromId(n).GetName(),c=this.getUISequenceTarget(l),u=this._thumbnailsList[t];for(var d in u){if(u[d].scenarioID===e){var m=u[d];if(i<0&&(i=this._thumbnailsList[n].length),this._thumbnailsList[n].splice(i,0,this._thumbnailsList[t].splice(d,1)[0]),t!==n){0===this._sequenceContent[n].childNodes.length?this._sequenceContent[n].insertAdjacentElement("afterBegin",m.elements.container):i>=this._sequenceContent[n].childNodes.length?this._sequenceContent[n].insertAdjacentElement("beforeend",m.elements.container):this._sequenceContent[n].childNodes[i].insertAdjacentElement("beforeBegin",m.elements.container)}else{var h;if(this._sequenceContent[n].childNodes[i]._scenarioID!==e)h=this.amIBefore(m.elements.container,this._sequenceContent[n].childNodes[i])?"afterend":"beforeBegin",this._sequenceContent[n].childNodes[i].insertAdjacentElement(h,m.elements.container)}var C=o.elements.items[this._sequenceContent[t].sequenceIndex];C.counterThumbs.innerHTML=parseInt(C.counterThumbs.innerHTML)-1;var g=c.elements.items[this._sequenceContent[n].sequenceIndex];g.counterThumbs.innerHTML=parseInt(g.counterThumbs.innerHTML)+1;break}}},onCurrentScenarioChanged:function(e,t){if("VCX_Scenario_Transition"!==e){this.hideNeedForUpdate();var n=0,i=0;for(var a in this._thumbnailsList)for(var r=this._thumbnailsList[a],s=0;s<r.length;s++){var o=r[s];o.elements.transition.removeClassName("vcxActiveScenario"),o.elements.transitionBack.removeClassName("vcxActiveScenarioBack"),o.elements.transition.style.webkitTransition="",o.elements.transition.style.transition="",o.elements.transition.style.mozTransition="",o.elements.title.contentEditable=!0,o.scenarioID===e&&(n=o,i=a)}if(n){n.elements.transition.addClassName("vcxActiveScenario"),n.elements.transitionBack.addClassName("vcxActiveScenarioBack"),this.playerMode||this.getFrame().getToolbar().isEditMode()||(n.elements.title.contentEditable=!0),this.scrollToThumbnail(n);var l=this._experienceBase,c=l.getManager("VCXSequenceManager").GetSequenceFromId(i),u=(l.getManager("VCXSequenceManager").GetIndexOfSequence(c),c.GetName()),d=this.getUISequenceTarget(u),m=parseInt(this.getUISequenceIndex(d,u));this.activeSequence(d.elements.items[m])}t&&e!==this._currentScenarioId&&"VCX_Scenario_Transition"!==e&&(this._currentScenarioId=e,this.RefreshTimeline(t,e)),this._currentScenarioId=e}},scrollToThumbnail:function(e){var t=this.getFrame().getContent().getElementsByClassName("wux-layouts-slidingviews-page-content");if(4!==t.length)console.error("Scene panel structure has changed. Automatic scroll will not take place.");else{var n=t[1],i=this.getFrame().getContent().scrollHeight,a=e.elements.container.scrollHeight,r=e.elements.container.offsetTop,s=n.scrollTop;if(r+a>s+i)n.scrollBy({top:r+a-(s+i),behavior:"smooth"});else{if(!(r<s))return;n.scrollBy({top:r-s-10,behavior:"smooth"})}}},onBeginEndTransition:function(e,t){if(e._currentScenarioId)for(var n in e._thumbnailsList){var i=e._thumbnailsList[n];for(var a in i){var r=i[a];if(r.scenarioID===e._currentScenarioId){r.elements.transition.removeClassName("vcxActiveScenario");r.elements.transition.offsetTop;r.elements.transition.removeClassName("vcxNOTransition");var s="height "+t.maxframe+"s linear";if(r.elements.transition.style.webkitTransition=s,r.elements.transition.style.transition=s,r.elements.transition.style.mozTransition=s,r.elements.transition.addClassName("vcxActiveScenario"),0===t.maxframe){r.elements.transition.addClassName("vcxNOTransition");r.elements.transition.offsetTop;r.elements.transition.removeClassName("vcxNOTransition")}}}}},onScenarioNameRefresh:function(e,t){var n=e._vcxGuiManager._experienceBase.getManager("VCXSequenceManager").GetSequenceFromScenarioId(t.GetID());if(n)for(var i=t.GetName(),a=this._thumbnailsList[n.GetID()],r=0;r<a.length;r++){var s=a[r];if(s.scenarioID===t.GetID()){s.setTitle(i);break}}},onScenarioReplaced:function(e,t){this.onScenarioNameRefresh(this,t);var n=this,i=this._experienceBase,a=t.GetDocId(),r=i.getManager("VCXDocManager").GetPropPath(a);if(r){var s=r.GetValueURL().GetValue();if(s){var o=new XMLHttpRequest;o.open("GET",s,!0),o.responseType="blob",o.onload=function(a){if(200==this.status){var r=this.response,s=new FileReader;s.onload=function(a){var r=i.getManager("VCXSequenceManager").GetSequenceFromScenarioId(e).GetID(),s=i.getManager("VCXSequenceManager").GetSequenceFromId(r).GetIndexOfScenario(e);n._thumbnailsList[r][s].setPicture(a.target.result),n._scenePanelView&&n._scenePanelView.updateScenario(e,r,t.GetName(),a.target.result,t.GetID()===n._currentScenarioId)},s.readAsDataURL(r)}},o.send()}}},onSequenceNameRefresh:function(e,t){e._vcxGuiManager._experienceBase.getManager("VCXSequenceManager").GetIndexOfSequence(t)},onSequenceChanged:function(e,t){e._vcxGuiManager._experienceBase.getManager("VCXSequenceManager").GetListSequences();if(t&&t.sequenceToRemove){var n=t.sequenceToRemove,i=n.GetName(),a=e._sequenceContent[n.GetID()].sequenceIndex-1,r=e.getUISequenceTarget(i);r.deleteItem(a),e._sequenceContent[n.GetID()]=null,delete e._thumbnailsList[n.GetID()],e.activeSequence(r.elements.items[0])}t&&t.sequenceToAdd&&(e.createSequence(t.sequenceToAdd,t.previousSeqIndex,e),e._scenePanelView&&e._scenePanelView.createSequenceView(t.sequenceToAdd.GetID(),t.sequenceToAdd.GetName(),l.getWebappsAssetUrl("VCXWebGUI","css/img/VCXSequence.png")))},capturePixels:function(){var e=this._experienceBase,t=new g,n=this.getThumbnailDisplaySize(),i=2*n[0],a=2*n[1];return t.doThumbnailToDataUrl(e,i,a)},OpenScenario:async function(e,t){if(""!==e){var n=this._experienceBase.getManager("VCXScenarioManager"),i=new h(n,this._experienceBase.ComponentsMap,this._experienceBase.getManager("VCXCommandManager")),a=n.GetScenarios()[e];return this.onCurrentScenarioChanged(e,a),i.BuildTransitionTo(a),i.SetCallback(t),this._experienceBase.getManager("VCXCommandManager").Push(i)}},displayNeedForUpdate:function(){if(!this.getLockSceneUpdateDisplay()&&!this.playerMode){let e=document.querySelector(".vcxActiveScenario")&&document.querySelector(".vcxActiveScenario").getParent(),t=document.querySelector('[data-rec-id*="VCXAddCameraKeyCmd"]');if(!e||!t)return;e.prepend(this._updateSceneSymbol),t.addClassName("vcx-update-available"),t.addEventListener(i.POINTERDOWN,this.hideNeedForUpdate.bind(this)),this.stopListeningToViewpointChange(),this._vcxGuiManager.SetSceneNeedsUpdate(!0)}},hideNeedForUpdate:function(){if(this.playerMode||this.getLockSceneUpdateDisplay())return;this._updateSceneSymbol.remove();let e=document.querySelector('[data-rec-id*="VCXAddCameraKeyCmd"]');e&&(e.removeClassName("vcx-update-available"),e.removeEventListener(i.POINTERDOWN,this.hideNeedForUpdate.bind(this)),this._vcxGuiManager.SetSceneNeedsUpdate(!1),this.listenToViewpointChange())},listenToViewpointChange:function(){let e=this._experienceBase.getManager("VCXContextManager").getMainViewer().currentViewpoint;this.currentViewpoint.angle=e.getAngle(),this.currentViewpoint.eyePos=e.getEyePosition(),this.currentViewpoint.sightDir=e.getSightDirection(),this._tokenSceneUpdate?console.warn("tried to subscribe to existing event"):this._tokenSceneUpdate=n.subscribe({event:"/VISU/"},(e=>{e&&e.viewpoint&&"@onViewpointChange"===e.eventType&&(this.currentViewpoint.angle!==e.viewpoint.getAngle()||e.viewpoint.getEyePosition().distanceTo(this.currentViewpoint.eyePos)>1e-10||e.viewpoint.getSightDirection().distanceTo(this.currentViewpoint.sightDir)>1e-10)&&this.displayNeedForUpdate()}))},stopListeningToViewpointChange:function(){this._tokenSceneUpdate&&(n.unsubscribe(this._tokenSceneUpdate),delete this._tokenSceneUpdate)},unlockSceneUpdateDisplay:function(){this._lockedSceneUpdateDisplay=!1},lockSceneUpdateDisplay:function(){this._lockedSceneUpdateDisplay=!0},getLockSceneUpdateDisplay:function(){return this._lockedSceneUpdateDisplay}})})),define("DS/VCXWebGUI3DComposerPlayer/VCXTimelineContentPlayerCtrl",["require","exports","DS/VCXGUIInfrastructure/VCXGUIComponentCtrl","DS/VCXWebGUI/VCXTimelineController","DS/ApplicationFrame/CommandsManager"],(function(e,t,n,i,a){"use strict";return class extends n{get panelCtrl(){return this._panelCtrl}get buttonPlay(){return this._panelCtrl?this._panelCtrl._buttonPlay:this._buttonPlay}set buttonPlay(e){this._panelCtrl&&(this._panelCtrl._buttonPlay=e),this._buttonPlay=e}get _timelines(){return this._panelCtrl?this._panelCtrl._timelines:this.timelines}set _timelines(e){this._panelCtrl&&(this._panelCtrl._timelines=e),this.timelines=e}get options(){return this._panelCtrl?this._panelCtrl.options:this._options}set options(e){this._panelCtrl&&(this._panelCtrl.options=e),this._options=e}constructor(){super(),this._buttonPlay=null,this._panelCtrl=null}initialize(){this._panelCtrl=null}postInitialize(){}unInitialize(){this._panelCtrl&&(this._panelCtrl.unInitialize(),this._panelCtrl=null)}update(e){this._panelCtrl&&this._panelCtrl._timelines&&this._panelCtrl.updateTimelineFromModel&&this._panelCtrl.updateTimelineFromModel()}BuildView(){const e=this._experienceBase.getManager("VCXScenarioManager");this.InitTimelineCtrl(e.GetCurrentScenario(),0)}RefreshPourcent(e){}InitTimelineCtrl(e,t){const n=this._experienceBase.getManager("VCXGUIManager"),r=this._experienceBase.getManager("VCXContextManager"),s=this._experienceBase.getManager("VCXScenarioManager"),o=n.GetGUIComponentFromName("VCXScenarioCtrl");if(null===o)return;const l=r.getContext();a.getCommandCheckHeader("VCXAutoKeyCmd",l);this._panelCtrl&&(this._panelCtrl.unInitialize(),this._panelCtrl=null);const c={frmWindow:r.getFrameWindow(),experienceBase:this._experienceBase,scenarioID:e,flattenKeys:!0};if(this._panelCtrl=new i(c),this._panelCtrl._experienceBase=this._experienceBase,this._panelCtrl.BuildView(c),""===e)return;const u=a.getCommandCheckHeader("VCXCameraPlayModeCmd",l),d=a.getCommandCheckHeader("VCXAutoKeyCmd",l);let m=Math.round(s.GetMaxFrame(e));0===m&&(m=500);var h={frmWindow:r.getFrameWindow(),parent:o.getFrame().getFooter(),displayToolbar:!0,displaySlider:!0,displayPlayBack:!1,displayLoop:!0,displayBounce:!0,displayReverse:!0,displayMarkers:!0,displayCamera:!!u,displayCameraMode:this._isCameraPlayMode=!!u&&u.getState(),maxFrame:m,timelineGUI:i.VCXWebTimelineGUIEnum.Light,title:"Light Timeline"};if(this._panelCtrl.createTimeline(h),!this._experienceBase.getManager("VCXContextManager").getContextFromName("PlayerMode")){var C={timelineGUI:i.VCXWebTimelineGUIEnum.Main,maxFrame:m,numberOfTracks:5,step_time_min:.1,scenario:this._experienceBase.getManager("VCXScenarioManager").GetScenarios()[e],propertiesTreeWidth:130},g=h;g.displayAutoKey=!!d,g.displayAutoKeyMode=this._isAutoKeyMode=!!d&&d.getState(),g.displayRemoveTracks=!0,g.parent=null,g.displaySlider=!1,g.displayPlayBack=!1,g.displayFilterOnSelection=!0,g.filterOnSelectionMode=!1,g.customButtons=[],C.toolbar=g,this._vcxTimelineCtrl.createTimeline(C)}for(var p=[],v=s.GetScenarios()[e].QueryInterface("VCXIModifiable").GetProperty("Actor.Scenario.Markers").GetPropertyValue().GetValue(),_=0;_<v.length;_++){var b={},S=v[_];if("VCXPropertyValueLink"===S.GetType()){var V=S.GetValue(),x=this._experienceBase.ComponentsMap.GetComponentFromID(V);if(x&&x.GetName){b.name=x.GetName(),b.id=x.GetID(),b.component=x;var f=x.QueryInterface("VCXIModifiable");b.type=f.GetProperty("Actor.IsMilestone").GetPropertyValue().GetValue()?"milestone":"marker",b.frame=f.GetProperty("Actor.TimePos").GetPropertyValue().GetValue(),p.push(b)}}}this._panelCtrl.addMarkers(p),this._panelCtrl.setIndexValue(t)}deleteTimeline(){const e=this._experienceBase.getManager("VCXContextManager");if(this._panelCtrl){this._panelCtrl._timelines&&this._panelCtrl.unInitialize(),this._panelCtrl=null;const t=e.getContext(),n=a.getCommandCheckHeader("VCXAutoKeyCmd",t);n&&n.setState(!0);const i=a.getCommandCheckHeader("VCXCameraPlayModeCmd",t);i&&i.setState(!0)}}ChangeTimePos(e,t){this._panelCtrl&&this._panelCtrl.ChangeTimePos(e,t)}}})),define("DS/VCXWebGUI3DComposerPlayer/VCXGUIDescription",["UWA/Class"],(function(e){"use strict";return e.singleton({GetDescription:function(e){let t=["VCXWelcomePageCtrl","VCXHardwareStatusUICtrl","VCXDocManagerCtrl","VCXLinkedPropCtrl"];return e.isSupported("Paper")&&t.push("VCXPaperCtrl"),e.isSupported("DisplayUI")&&(e.isSupported("DisplayUIScenariosPanel")&&t.push("VCXScenarioCtrl"),e.isSupported("DisplayUIPropertiesPanel")&&t.push("VCXPropertiesCtrl"),e.isSupported("DisplayUIAssemblyPanel")&&t.push("VCXWebAssemblyTabFrameCtrl","VCXWebAssemblyTreeCtrl","VCXWebSelectionSetsTreeCtrl","VCXWebHotspotsTreeCtrl"),e.isSupported("DisplayUIDressupsPanel")&&t.push("VCXWebDressupTabFrameCtrl","VCXWebDressupTreeCtrl"),t.push("VCXTimelineCtrl"),t.push("VCXWebTreesContentCtrl")),t},GetDynamicConditionsForComponents:e=>({VCXWebDressupTabFrameCtrl:{callback:()=>{const t=e._experienceBase.getManager("VCXDRMManager");return e&&e.isSupported("DisplayUIDressupsPanel")&&"0"!==e.getUrlVars().tree&&t&&t.GetDisplayTree()}},VCXWebDressupTreeCtrl:{callback:()=>{const t=e._experienceBase.getManager("VCXDRMManager");return e&&e.isSupported("DisplayUIDressupsPanel")&&"0"!==e.getUrlVars().tree&&t&&t.GetDisplayTree()}},VCXWebAssemblyTabFrameCtrl:{callback:()=>{const t=e._experienceBase.getManager("VCXDRMManager");return e&&e.isSupported("DisplayUIAssemblyPanel")&&"0"!==e.getUrlVars().tree&&t&&t.GetDisplayTree()}},VCXWebAssemblyTreeCtrl:{callback:()=>{const t=e._experienceBase.getManager("VCXDRMManager");return e&&e.isSupported("DisplayUIAssemblyPanel")&&"0"!==e.getUrlVars().tree&&t&&t.GetDisplayTree()}},VCXWebSelectionSetsTreeCtrl:{callback:()=>{const t=e._experienceBase.getManager("VCXDRMManager");return e&&e.isSupported("DisplayUIAssemblyPanel")&&"0"!==e.getUrlVars().tree&&t&&t.GetDisplayTree()}},VCXWebHotspotsTreeCtrl:{callback:()=>{const t=e._experienceBase.getManager("VCXDRMManager");return e&&e.isSupported("DisplayUIAssemblyPanel")&&"0"!==e.getUrlVars().tree&&t&&t.GetDisplayTree()}}})})})),define("DS/VCXWebGUI3DComposerPlayer/VCXGUIDictionary",[],(function(){"use strict";const e={VCXDocManagerCtrl:{},VCXLinkedPropCtrl:{},VCXPaperCtrl:{},VCXPropertiesCtrl:{},VCXScenarioCtrl:{},VCXTimelineCtrl:{},VCXWebAssemblyTabFrameCtrl:{},VCXWebAssemblyTreeCtrl:{},VCXWebDressupTabFrameCtrl:{},VCXWebDressupTreeCtrl:{},VCXWebHotspotsTreeCtrl:{},VCXWebSelectionSetsTreeCtrl:{},VCXWebTreesContentCtrl:{},VCXWelcomePageCtrl:{},VCXHardwareStatusUICtrl:{}},t={},n={VCXPaperCtrl:"DS/VCXWebGUI3DComposerPlayer/VCXPaperCtrl",VCXPropertiesCtrl:"DS/VCXWebGUI3DComposerPlayer/VCXPropertiesCtrlPlayer",VCXScenarioCtrl:"DS/VCXWebGUI3DComposerPlayer/VCXScenarioCtrlExt",VCXTimelineCtrl:"DS/VCXWebGUI3DComposerPlayer/VCXTimelineContentPlayerCtrl",VCXWebAssemblyTabFrameCtrl:"DS/VCXWebTreeGUI/VCXWebAssemblyTabFrameCtrl",VCXWebAssemblyTreeCtrl:"DS/VCXWebTreeGUI/VCXWebAssemblyTreeCtrl",VCXWebDressupTabFrameCtrl:"DS/VCXWebTreeGUI/VCXWebDressupTabFrameCtrl",VCXWebDressupTreeCtrl:"DS/VCXWebTreeGUI/VCXWebDressupTreeCtrl",VCXWebHotspotsTreeCtrl:"DS/VCXWebTreeGUI/VCXWebHotspotsTreeCtrl",VCXWebSelectionSetsTreeCtrl:"DS/VCXWebTreeGUI/VCXWebSelectionSetsTreeCtrl",VCXWebTreesContentCtrl:"DS/VCXWebGUI3DComposerPlayer/VCXWebTreesContentPlayerCtrl",VCXWelcomePageCtrl:"DS/VCXWebGUI3DComposerPlayer/VCXWelcomePagePlayerCtrl",VCXHardwareStatusUICtrl:"DS/VCXWebGUI3DComposerPlayer/VCXHardwareStatusUIPlayerCtrl"};return{GetDictionary:function(){return{interfaces:t,components:n,extensions:e}}}})),define("DS/VCXWebGUI3DComposerPlayer/VCXWelcomePagePlayerCtrl",["require","exports","DS/VCXWebGUI/VCXWelcomePageCtrl"],(function(e,t,n){"use strict";return class extends n{constructor(){super(),this.backgroundImage="I_VCX_Player_BackgroundLogo_In3DPlay.png",this.strCreateExperience="",this.titleStr="",this.allowEmpty=!1,this.allowDrop=!1,this.localMode=!1}async initialize(){await super.initialize()}unInitiliaze(){super.unInitialize()}getBrandImage(){return this.backgroundImage}}})),define("DS/VCXWebGUI3DComposerPlayer/VCXPaperCtrl",["DS/VCXGUIInfrastructure/VCXGUIComponentCtrl","DS/CoreEvents/Events","DS/Core/PointerEvents","DS/Controls/Timeline","DS/RuntimeView/RSCManager","DS/ApplicationFrame/CommandsManager","i18n!DS/VCXWebGUI3DComposerPlayer/assets/nls/VCXWebGUI3DComposerPlayer"],(function(e,t,n,i,a,r,s){"use strict";return e.extend({init:function(){},postInitialize:function(e){var o=this;this._vcxGuiManager=this._experienceBase.getManager("VCXGUIManager"),this._touchCompliant=o._vcxGuiManager.isTouchActivated(),this._buttonsAvailable={showPaper:!1,zoomFit:!1,pan:!1,zoom:!1,zoomSlider:!1},this._zoomFactorButtons=o._touchCompliant?2:1,this._paneHeight=o._touchCompliant?50:42,this._timelineProgress=50,this._timeoutStartHideAnimation=2e3,this._speedDisplayAnimation=200,this._speedHideAnimation=700,this._iconPaperExpander="",this._iconPaperExpanderOver="",this._iconPaperBackgroundOver="rgb(231, 241, 248)",this._animateUI={},this._zoomChangedToken=null,this._panChangedToken=null;var l=this._experienceBase.getManager("VCXContextManager");if(l){var c=l.getActionBar();c&&(o._actionBar_sectionChangeToken=c._modelEvents.subscribe({event:"EVT_SECTION_CHANGE"},(function(){o.CheckSize(c,o.mainPanel)})),o._actionBar_openToken=c._modelEvents.subscribe({event:"ACTIONBAR_OPEN"},(function(){o.CheckSize(c,o.mainPanel)})),o._actionBar_closeToken=c._modelEvents.subscribe({event:"ACTIONBAR_CLOSE"},(function(){o.CheckSize(c,o.mainPanel)}))),o.mainPanel=new UWA.Element("div",{html:"",class:"VCXPaperCtrl",styles:{height:o._paneHeight},events:{touchstart:function(){o.mainPanel.addClassName("hover")},touchend:function(){o.mainPanel.removeClassName("hover")}}}).inject(this._vcxGuiManager._uiLayer);var u="VCX_UI_Paper_Ctrl_Up",d="VCX_UI_Paper_Ctrl_Bottom";"0px"===document.querySelector('div[data-type="ui-frame-2d"]').style.bottom&&(u+="_3DPlay",d+="_3DPlay"),o.mainPanel._styleUp=u,o.mainPanel._styleBottom=d;var m="";if(m=s["PaperCtrl.DisplayPaperButton"],this.buttonShowPaper=new UWA.Element("div",{html:"",class:"vcxPaperCtrlButton wux-button-icon-fi wux-ui-3ds wux-ui-3ds-discovery-project wux-ui-3ds-lg wux-afr-cmdstarter",title:m,events:{click:function(){var e=!o._experienceBase.getManager("VCXPaperManager").getPaperVisibility();o._experienceBase.getManager("VCXPaperManager").setPaperVisibility(e),e?o.buttonShowPaper.addClassName("wux-ui-state-active"):o.buttonShowPaper.removeClassName("wux-ui-state-active")},mouseover:function(){this.style.backgroundColor=o._iconPaperBackgroundOver},mouseout:function(){this.style.backgroundColor=""}}}).inject(o.mainPanel),o._experienceBase.getManager("VCXPaperManager").getPaperVisibility()||o.buttonShowPaper.addClassName("wux-ui-state-active"),o.buttonShowPaper.addEvent(n.POINTERDOWN,(function(){this.style.backgroundColor=o._iconPaperBackgroundOver})),o.buttonShowPaper.addEvent(n.POINTERUP,(function(){this.style.backgroundColor=""})),this._buttonsAvailable.showPaper=!0,o._touchCompliant){var h=l.getContext(),C=(l.getMainViewer(),r.getCommand("VisuPanViewPaper",h));C&&(l.isSupported("DisplayPaperCtrlBtns")&&(m="",m=s["PaperCtrl.PanPaperButton"],o.buttonPan=new UWA.Element("div",{html:"",class:"vcxPaperCtrlButton wux-button-icon-fi wux-ui-3ds wux-ui-3ds-arrow-double-combo wux-ui-3ds-lg wux-afr-cmdstarter",title:m,events:{click:function(){C&&(C.isRunning()?(C.end(),o.buttonPan.removeClassName("wux-ui-state-active")):(C.begin(),o.buttonPan.addClassName("wux-ui-state-active")))},mouseover:function(){this.style.backgroundColor=o._iconPaperBackgroundOver},mouseout:function(){this.style.backgroundColor=""}}}).inject(o.mainPanel),o.buttonPan.addEvent(n.POINTERDOWN,(function(){this.style.backgroundColor=o._iconPaperBackgroundOver})),o.buttonPan.addEvent(n.POINTERUP,(function(){this.style.backgroundColor=""})),this._buttonsAvailable.pan=!0),C.onBegin((function(){o.buttonPan&&!o.buttonPan.classList.contains("wux-ui-state-active")&&o.buttonPan.addClassName("wux-ui-state-active")})),C.onPause((function(e){C.end()})),C.onEnd((function(){o.buttonPan&&o.buttonPan.removeClassName("wux-ui-state-active")})))}m="",m=s["PaperCtrl.FitPaperButton"],this.buttonZoomFit=new UWA.Element("div",{html:"",class:"vcxPaperCtrlButton wux-button-icon-fi wux-ui-3ds wux-ui-3ds-zoom-fit wux-ui-3ds-lg wux-afr-cmdstarter",title:m,events:{click:function(){o._experienceBase.getManager("VCXPaperManager").ToggleAutoFit()?o.buttonZoomFit.addClassName("wux-ui-state-active"):o.buttonZoomFit.removeClassName("wux-ui-state-active"),o._vcxGuiManager.updateUsableArea()},mouseover:function(){this.style.backgroundColor=o._iconPaperBackgroundOver},mouseout:function(){this.style.backgroundColor=""}}}).inject(o.mainPanel),o._experienceBase.getManager("VCXPaperManager")._autoFit&&o.buttonZoomFit.addClassName("wux-ui-state-active"),o.buttonZoomFit.addEvent(n.POINTERDOWN,(function(){this.style.backgroundColor=o._iconPaperBackgroundOver})),o.buttonZoomFit.addEvent(n.POINTERUP,(function(){this.style.backgroundColor=""})),this._buttonsAvailable.zoomFit=!0,l.isSupported("DisplayPaperCtrlBtns")||(this.buttonZoomFit.style.visibility="hidden"),m="",m=s["PaperCtrl.ZoomMinusButton"],o.buttonZoomMinus=o.createButton("wux-ui-3ds wux-ui-3ds-minus","url("+o._iconPaperZoomMinus+")",m),o.buttonZoomMinus.inject(o.mainPanel),o.AddEvents(o.buttonZoomMinus,"Minus",o,-1),m="",m=s["PaperCtrl.ZoomPlusButton"],o.buttonZoomPlus=o.createButton("wux-ui-3ds wux-ui-3ds-plus","url("+o._iconPaperZoomPlus+")",m),o.buttonZoomPlus.inject(o.mainPanel),o.AddEvents(o.buttonZoomPlus,"Plus",o,1),this._buttonsAvailable.zoom=!0,l.isSupported("DisplayPaperCtrlBtns")||(this.buttonZoomPlus.style.visibility="hidden",this.buttonZoomMinus.style.visibility="hidden"),this._vcxGuiManager.isTouchActivated()||(this._timelineDiv=new UWA.Element("div",{html:"",class:"VCXPaperCtrlTimelineDiv",styles:{}}).inject(o.mainPanel),this._timeline=new i({minValue:0,maxValue:100,value:this._timelineProgress,dynamicGraduations:!1,dynamicGaugeColor:!1,graduationsLabel:!1,graduations:0,eventsList:[{label:"100",value:100,onEvent:function(){}}],activeGraduationsColor:"#3CF",inactiveGraduationsColor:"#CCC"}),this._timeline.elements.container.style.margin="initial",this._timeline.inject(o._timelineDiv),this._buttonExpander=new UWA.Element("div",{html:"",class:"VCXPaperCtrlTimelineArrow",styles:{backgroundImage:"url("+o._iconPaperExpander+")"}}),this._buttonExpander.inject(this.mainPanel),document.querySelectorAll(".wux-Gauge-scale",".VCXPaperCtrlTimelineDiv")[0].style.opacity=0,this.UpdatePercentage(this),this._timeline.addEvent("change",(function(){o._timelineProgress=o._timeline.getValue(),o.UpdatePercentage(o,0)})),this._buttonsAvailable.zoomSlider=!0,l.isSupported("DisplayPaperCtrlBtns")||(this._timelineDiv.style.visibility="hidden",this._buttonExpander.style.visibility="hidden")),this._checkSizeCB=this.checksizeFct.bind(this),window.attachEvent?(window.attachEvent("expand",this._checkSizeCB),window.attachEvent("collapse",this._checkSizeCB),window.attachEvent("dockIsResizing",this._checkSizeCB),window.attachEvent("dockResize",this._checkSizeCB)):window.addEventListener&&(window.addEventListener("expand",this._checkSizeCB,!0),window.addEventListener("collapse",this._checkSizeCB,!0),window.addEventListener("dockIsResizing",this._checkSizeCB,!0),window.addEventListener("dockResize",this._checkSizeCB,!0)),this._buttonsAvailable.zoomSlider&&a.onResourceLoaded({resourceFile:"VCXWebAuthoringApp/VCXWebAuthoringApp"},(function(){o._iconPaperExpander=this.getIcon({key:"VCXPaperExpander",size:"Normal"}),o._buttonExpander.style.backgroundImage="url("+o._iconPaperExpander+")",o._iconPaperExpanderOver=this.getIcon({key:"VCXPaperExpanderOver",size:"Normal"})})),this._zoomChangedToken=t.subscribe({event:"/VCX/Paper/ZoomChanged"},(function(e){e&&o.buttonZoomFit&&(e.autoFit?o.buttonZoomFit.addClassName("wux-ui-state-active"):o.buttonZoomFit.removeClassName("wux-ui-state-active")),e&&!e.updatePaper&&(o._lockupdatePaper=!0),o.SetZoomFactor(e),o._lockupdatePaper=!1})),this._panChangedToken=t.subscribe({event:"/VCX/Paper/PanChanged"},(function(e){e&&o.buttonZoomFit&&(e.autoFit?o.buttonZoomFit.addClassName("wux-ui-state-active"):o.buttonZoomFit.removeClassName("wux-ui-state-active"))}))}else console.log("No ContextManager found, paperCtrl initialization aborted..")},checksizeFct:function(){var e=this._experienceBase&&this._experienceBase.getManager("VCXContextManager").getActionBar();this.CheckSize(e,this.mainPanel)},updateUsableArea:function(){if(this._experienceBase){const e=this._experienceBase.getManager("VCXGUIManager"),t=e._getOptiUsableArea(e.getUsableArea());e._getOptiUsableArea(e.getUsableArea(!0));this.updatePaperArea(t)}},unInitialize:function(){this._zoomChangedToken&&(t.unsubscribe(this._zoomChangedToken),this._zoomChangedToken=null),this._panChangedToken&&(t.unsubscribe(this._panChangedToken),this._panChangedToken=null);var e=this._experienceBase&&this._experienceBase.getManager("VCXContextManager").getActionBar();e&&(this._actionBar_sectionChangeToken&&e._modelEvents.unsubscribe(this._actionBar_sectionChangeToken),this._actionBar_openToken&&(e._modelEvents.unsubscribe(this._actionBar_openToken),this._actionBar_openToken=null),this._actionBar_closeToken&&(e._modelEvents.unsubscribe(this._actionBar_closeToken),this._actionBar_closeToken=null),e=null),this.buttonZoomFit&&(this.buttonZoomFit.removeEvent(n.POINTERDOWN),this.buttonZoomFit.removeEvent(n.POINTERUP)),this.buttonShowPaper&&(this.buttonShowPaper.removeEvent(n.POINTERDOWN),this.buttonShowPaper.removeEvent(n.POINTERUP)),this.buttonPan&&(this.buttonPan.removeEvent(n.POINTERDOWN),this.buttonPan.removeEvent(n.POINTERUP)),this.RemoveEvents(this.buttonZoomMinus),this.RemoveEvents(this.buttonZoomPlus),this._timeline&&this._timeline.removeEvent("change"),window.attachEvent?(window.detachEvent("expand",this._checkSizeCB),window.detachEvent("collapse",this._checkSizeCB),window.detachEvent("dockIsResizing",this._checkSizeCB),window.detachEvent("dockResize",this._checkSizeCB)):window.addEventListener&&(window.removeEventListener("expand",this._checkSizeCB,!0),window.removeEventListener("collapse",this._checkSizeCB,!0),window.removeEventListener("dockIsResizing",this._checkSizeCB,!0),window.removeEventListener("dockResize",this._checkSizeCB,!0)),this._checkSizeCB=null,this.mainPanel&&this.mainPanel.parentNode&&this.mainPanel.parentNode.removeChild(this.mainPanel),this.mainPanel=null},createButton:function(e,t,n){return new UWA.Element("div",{html:"",class:e+" vcxPaperCtrlButton wux-button-icon-fi wux-ui-3ds-lg wux-afr-cmdstarter",title:n})},AddEvents:function(e,t,n,i){var a=this;e._useTouch=!1,e.addEvent("touchstart",(function(){e.style.backgroundColor=a._iconPaperBackgroundOver,e._useTouch=!0;var t=e;return t.delta=5*i,n.UpdateSlider(n,t.delta,!1),t.delta+=5*i,t.waitPressTimer=window.setTimeout((function(){t.pressTimer=window.setInterval((function(){n.UpdateSlider(n,t.delta,!1),t.delta+=5*i}),100)}),300),!1})),e.addEvent("mouseover",(function(){if(e._useTouch)return!1;e.style.backgroundColor=a._iconPaperBackgroundOver})),e.addEvent("mousemove",(function(){})),e.addEvent("mouseup",(function(){if(!0===e._useTouch)return!1;window.clearTimeout(e.waitPressTimer),window.clearInterval(e.pressTimer),e.style.backgroundColor=""})),e.addEvent("mousedown",(function(){if(!0===e._useTouch)return!1;var t=e;return t.delta=5*i,e.style.backgroundColor=a._iconPaperBackgroundOver,n.UpdateSlider(n,t.delta,!1),t.waitPressTimer=window.setTimeout((function(){t.pressTimer=window.setInterval((function(){n.UpdateSlider(n,t.delta,!1),t.delta+=5*i}),100)}),300),!1})),e.addEvent("touchend",(function(){window.clearTimeout(e.waitPressTimer),window.clearInterval(e.pressTimer),e.style.backgroundColor=""})),e.addEvent("mouseout",(function(){e._useTouch=!1,window.clearTimeout(e.waitPressTimer),window.clearInterval(e.pressTimer),e.style.backgroundColor=""}))},RemoveEvents:function(e){e.removeEvent("touchstart"),e.removeEvent("mouseover"),e.removeEvent("mousemove"),e.removeEvent("mouseup"),e.removeEvent("mousedown"),e.removeEvent("touchend"),e.removeEvent("mouseout")},UpdatePercentage:function(e){if("number"==typeof e._timelineProgress){e._timelineProgress;var t=0;t=e._timelineProgress<=49?90/49*e._timelineProgress+10:e._timelineProgress>=51?6*e._timelineProgress-200:100,e.zoomPaper=t/100,null===e._experienceBase||e._lockupdatePaper||(e._experienceBase.getManager("VCXPaperManager").Zoom=e.zoomPaper),e._timeline&&(e._timeline.elements.container.children[2].children[0].children[0].innerHTML=Math.floor(t)+" %")}},UpdateSlider:function(e,t,n){if("number"==typeof e._timelineProgress){var i=0;i=e._timelineProgress<=49?90/49*e._timelineProgress+10:e._timelineProgress>=51?6*e._timelineProgress-200:100,n?i=t:i+=t,e.zoomPaper=i/100,e._timelineProgress=i<=99?(i-10)/(90/49):i>=101?(i+200)/6:50,e._timelineProgress=Math.max(0,Math.min(100,e._timelineProgress)),e._timeline?e._timeline.setValue(e._timelineProgress):e.UpdatePercentage(e)}},CheckSize:function(e,t){if(1!==document.querySelectorAll("div.wux-ui-state-close").length){var n=0;if(e.elements.sectionsBar)n=e.elements.sectionsBar.getDimensions().outerWidth+50;else{var i=e.elements.container.childNodes[0].childNodes[2];i&&(n=i.getBoundingClientRect().left)}var a=t&&t.getBoundingClientRect().width;this._touchCompliant||n-parseInt(a)<0||0==e._isShownWhenLarge&&0==e._isShownWhenSmall?(t.classList.contains(t._styleBottom)&&t.classList.remove(t._styleBottom),!t.classList.contains(t._styleUp)&&t.classList.add(t._styleUp)):(t.classList.contains(t._styleUp)&&t.classList.remove(t._styleUp),!t.classList.contains(t._styleBottom)&&t.classList.add(t._styleBottom))}else t.classList.add(t._styleBottom)},SetZoomFactor:function(e){this.UpdateSlider(this,100*e.value,!0)},updatePaperArea:function(e){this.mainPanel&&(this.mainPanel.style.left=e.left+"px")},hidePaperCtrl:function(){this.hide()},showPaperCtrl(){this.show()},isHiddenPaperCtrl(){return this.isHidden()},hide:function(){this.mainPanel.hide()},show:function(){this.mainPanel.show()},isHidden:function(){return this.mainPanel&&"none"===this.mainPanel.style.display}})})),define("DS/VCXWebGUI3DComposerPlayer/VCXWebTreesContentPlayerCtrl",["require","exports","DS/VCXWebTreeGUI/VCXWebTabFrameCtrl","DS/VCXWebGUI/VCXWebTreesContentCtrl"],(function(e,t,n,i){"use strict";return class extends i{constructor(){super(),this._experienceBase=null}BuildView(e){console.log(e);const t=this._experienceBase.getManager("VCXGUIManager");["VCXWebAssemblyTabFrameCtrl","VCXWebDressupTabFrameCtrl","VCXScenarioCtrl"].forEach((e=>{const n=t.GetGUIComponentFromName(e);n&&this._orderTabs.push(n)})),this._focusedTab=t.GetGUIComponentFromName("VCXScenarioCtrl"),this.reOrderTreesPanel()}setUpTrees(){const e=this._experienceBase.getManager("VCXGUIManager"),t=e.GetGUIComponentFromName("VCXWebAssemblyTabFrameCtrl"),i=e.GetGUIComponentFromName("VCXWebAssemblyTreeCtrl"),a=e.GetGUIComponentFromName("VCXWebSelectionSetsTreeCtrl"),r=e.GetGUIComponentFromName("VCXWebHotspotsTreeCtrl");t&&t instanceof n&&(this._setUpTree(i,t,1),this._setUpTree(a,t,2),this._setUpTree(r,t,3));const s=e.GetGUIComponentFromName("VCXWebDressupTabFrameCtrl"),o=e.GetGUIComponentFromName("VCXWebDressupTreeCtrl");s&&s instanceof n&&this._setUpTree(o,s,1);const l=e.GetGUIComponentFromName("VCXWebStylesTabFrameCtrl"),c=e.GetGUIComponentFromName("VCXWebStylesTreeCtrl");l&&l instanceof n&&this._setUpTree(c,l,1)}}}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWebGUI3DComposerPlayer/VCXPropertiesCtrlPlayer",["require","exports","DS/VCXGUIInfrastructure/VCXGUIComponentCtrl","i18n!DS/VCXWebGUI3DComposerPlayer/assets/nls/VCXWebGUI3DComposerPlayer","DS/VCXWebGUI3DComposerPlayer/VCXPropertiesViewPlayer","DS/VCXGUIInfrastructure/VCXPropertiesGUIService","DS/CoreEvents/Events"],(function(e,t,n,i,a,r,s){"use strict";i=__importDefault(i),a=__importDefault(a),r=__importDefault(r),s=__importDefault(s);return class extends n{constructor(){super(),this.modifiables=[],this.tokens={}}BuildView(){this.propertiesService=new r.default(this._experienceBase);let e={title:i.default["VCXPropertiesPlayer.PanelTitle"],icon:"attributes",immersiveFrame:this._experienceBase.getManager("VCXGUIManager").immersiveFrame,currentDockArea:WUXDockAreaEnum.RightDockArea,identifier:"PropertiesPanelViewPlayer",minWidth:300};this.panelView=new a.default(e,this._experienceBase.getManager("VCXContextManager").getContext()),this.init();let t=this.getPanelView();t&&this.propertiesService.subscribePropertyEvents(t)}OnEndBuildView(){}init(){this.instanciatePanel([]);const e=this._experienceBase.getManager("VCXSelectionManager");this.tokens._COMPONENTSLIST_ADD_Token=s.default.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_ADD"},(()=>{if(e){const t=this.instanciatePanel(e.GetComponentsFromSelection("CSO"));this.propertiesService?.setLastSelection(t)}})),this.tokens._COMPONENTSLIST_REMOVE_Token=s.default.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_REMOVE"},(()=>{if(e){const t=this.instanciatePanel(e.GetComponentsFromSelection("CSO"));this.propertiesService?.setLastSelection(t)}}))}resetPanel(){this.panelView&&this.panelView.cleanPanelContent()}instanciatePanel(e){this.resetPanel(),this.modifiables=e.map((e=>e.QueryInterface("VCXIModifiable")));let t=this.propertiesService?.BuildIntersectionPropertyGroups(e),n=t?.getOrderedPropertyGroupsArray();var i={};for(var a in n){var r=n[a];this.propertiesService?.getGroupUIInformation(r,i,e)}return this.propertiesService&&this.panelView?.buildPanelContent(i,this.propertiesService,e),e}getPanelView(){return this.panelView?.panel??null}unInitialize(){for(const e in this.tokens)this.tokens.hasOwnProperty(e)&&this.tokens[e]&&(s.default.unsubscribe(this.tokens[e]),this.tokens[e]=null);this.panelView&&(this.panelView.unInitialize(),this.panelView=null)}}}));