define("DS/IPTableColumnCusto/IPTableColumnCusto",["css!DS/IPTableColumnCusto/IPTableColumnCusto.css","i18n!DS/IPTableColumnCusto/assets/nls/IPTableColumnCusto","DS/IPClassifyUtil/IPClassifyModelEvents","DS/IPClassifyUXUtil/ProgressPaneExecution","UWA/Core","DS/Windows/Dialog","DS/Controls/Button","UWA/Controls/Abstract","DS/PADServices/utils/PlatformURL","DS/IPTableMePreferences/services/PlatformURL","DS/IPClassifyUtil/IPClassifyUtility","DS/IPClassifyUtil/IPClassifyAlert","DS/IPTableMePreferences/services/WSAccess","DS/IPTableMePreferences/IPTableMePreferences","DS/MePreferencesClientAPI/MePreferencesClientAPI","DS/IPClassifyUXUtil/IPClassifyUXUtilities/IPColumnAttributeMgt","text!DS/IPTableMePreferences/assets/conf/ENOFOL3_IPTableMePreferences_conf.json","DS/WidgetServices/WidgetServices"],(function(e,t,i,s,n,a,l,o,r,d,c,g,u,m,w,p,f,v){"use strict";let I=null;return o.extend({name:"ip-table-customization",columnOrdering:!0,defaultOptions:{moreColumnsBtn:!0,renderTo:null,modelEvents:null,subscribeTokens:[],modelSubscribeTokens:[],compactMode:!1,applyOnlyToThisApp:!1,baseTypes:[],selectedTypes:[],selectedExtensions:[],defaultTypes:[],defaultExtensions:[],defaultAttributes:[],supportedIndexAttrs:[],rowHeaderActivated:!0,thumbnailsActivated:!1,pinModel:{},dgvOptions:{defaultColumnDef:{width:"auto",typeRepresentation:"string"},showRowIndexFlag:!1,showRowBorderFlag:!0,showAlternateBackgroundFlag:!1,rowSelection:"multiple",cellSelection:"none",selectionBehavior:{canInteractiveMultiselectWithCheckboxClick:!0,canMultiSelect:!0,enableFeedbackForActiveCell:!0,enableShiftSelection:!0,toggle:!1,unselectAllOnEmptyArea:!0}},dgvLayoutOptions:{cellHeight:28,columnHeaderHeight:38,rowsHeader:!0}},init:function(e){this._parent(e);var i=this;this._windowEventListener=null;var s=v.isWebInWinEnvironment()?"-immersivePanelWebInWin":"-immersivePanel";i.elements.container=n.createElement("div",{class:i.getClassNames(s)+" ip_columnCustomization"}),d.initialize({lang:widget.lang,userId:c.getUserId(),myAppsBaseUrl:v.get3DSpaceUrl()}),r.retrievePlatformUrl({addDefaults:!0,initWSAcess:!0}).then((async function(){i.options.allowedIndexAttributes=new Set(i.options.allowedIndexAttributes),i._buildBody(),i.elements.panel2small=n.createElement("div",{class:i.getClassNames("-panel2small"),text:t.attributesCustomization.panel2small}).inject(i.elements.container),i.options.modelEvents.publish({event:"IPTableColumnCusto/Views/showInWidgetBody",data:{idView:"customize",title:t.attributesCustomization.apptitle,html:i.elements.container}})}))},_buildBody:async function(){if(this.elements.dgv=n.createElement("div",{class:this.getClassNames("-dgv")}).inject(this.elements.container),"ENOFOL3_AP"===this.options.appId&&this.options.withMePref)w&&w.getMePreferencesDialog&&w.getMePreferencesDialog("3DSApp.ENOFOL3_AP",{startBuildDlg:!0,variation:{preference:{name:"ENOFOL3_TABLE_CUSTO",repoName:"BookmarkEditorRepository"},type:"customview"}}).then((e=>{e&&e.inject(widget.body)}));else{const n={MP_VIEWS:{_defaultView:JSON.parse(JSON.stringify(p.getDefaultView())),localView:JSON.parse(JSON.stringify(p.getLocalView()))}};var e;try{e=await new Promise((e=>{require([`text!DS/IPTableMePreferences/assets/conf/${this.options.appId.replace("_AP","")}_IPTableMePreferences_conf.json`],(t=>{e(t)}))}))}catch(t){console.log(t),e=f}this.options.gridCusto=new m({appId:this.options.appId,activeViewInDGV:"localView",withUserView:!1,withAdminView:!1,localWindow:window,frameCntWindow:window,mepOrigin:v.getServerUrl(),defaultJSON:n,defaultConf:JSON.parse(e),targetId:this.getClassNames("-dgv"),tenantID:c.getTenantId(),lockState:void 0,creationModal:this.elements.dgv,lockCombo:!0,compassConfig:{lang:v.getLanguage(),myAppsBaseUrl:c.get3DSpaceUrl(),userId:c.getUserId()}}),s.execute({title:"Loading Preferences",datas:[this.options.gridCusto.initialize()],query:async e=>await e,loaderInfo:{scope:"global",withPercent:!1}}).then((()=>{widget.immersiveFrame.getContent().appendChild(this.elements.container);let e=new a({immersiveFrame:widget.immersiveFrame,content:this.elements.container,resizableFlag:!0,width:.9*window.innerWidth,height:.9*window.innerHeight,minWidth:.5*window.innerWidth,minHeight:.5*window.innerHeight,modalFlag:!0,buttons:{Yes:new l({label:t.attributesCustomization.save,onClick:function(t){var{activePref:s}=this.options.gridCusto.options;s.MP_SELECTED_COLS.forEach((e=>{["favoriteTitle","bookmarkLocation"].includes(e.dataIndex)?e.forceHidden=!!e.forceHidden&&e.forceHidden:(e.visibleFlag=null==e.visibleFlag||e.visibleFlag,e.pinned=e.pinned?e.pinned:"unpinned")})),s._upgradeVersion&&(s.MP_VERSION||(s.MP_VERSION=0),s.MP_VERSION+=1),p.setLocalView(s),p.setCurrentView("localView"),i.publish({event:"switch_view",data:{viewId:"localView"}}),i.publish({event:"saveViewInWidget"}),e.close()}.bind(this)}),Cancel:new l({label:t.attributesCustomization.cancel,onClick:function(t){e.close()}.bind(this)})}});e.addEventListener("close",(e=>{const t=this.options.gridCusto.elements.attSelection.elements.dgv;t&&t.findDialog&&t.findDialog.close()}))}))}I&&(window.removeEventListener("message",I),I=null);let o=this;I=e=>{let s=e.data,n="";if(s.message&&(n=s.message),"com.ds.mep:InWidget"===n){widget.options||(widget.options={title:"custom"}),e.source.postMessage({message:"com.ds.mep:InWidgetOK",fromWidget:!0,title:widget.options.title,credential:widget.getValue("pad_security_ctx")},e.origin);const t=JSON.parse(JSON.stringify(p.getDefaultView()));e.source.postMessage({message:"com.ds.mep:setDefaultView",fromWidget:!0,view:t},e.origin);let i=JSON.parse(JSON.stringify(p.getLocalView()));i.MP_SELECTED_COLS=JSON.parse(JSON.stringify(o.options.appColumns)),e.source.postMessage({message:"com.ds.mep:setLocalView",fromWidget:!0,view:i},e.origin);let s=p.getView();e.source.postMessage({message:"com.ds.mep:setActiveView",fromWidget:!0,viewId:s.UUID_RELATED_VIEW||s.MP_UUID},e.origin)}if("com.ds.mep:UpdateLocalView"===n){let n=null;e.data.originLocal&&(n=e.data.originLocal.view);let a="_defaultView"===e.data.activeView;"_defaultView"===e.data.activeView&&g.displayNotification({title:t.replace(t.defaultViewWarning.title,{MP_VIEW_NAME:e.data.views._defaultView.MP_VIEW_NAME}),message:t.defaultViewWarning.message,className:"warning"}),Object.keys(s.views).forEach((e=>{s.views[e].MP_SELECTED_COLS.forEach((e=>{["favoriteTitle","bookmarkLocation"].includes(e.dataIndex)?e.forceHidden=!!e.forceHidden&&e.forceHidden:(e.visibleFlag=null==e.visibleFlag||e.visibleFlag,e.pinned=null!=e.pinned?e.pinned:"unpinned")}))}));let l={},o=widget.getValue("pad_security_ctx").contains("VPLMAdmin");for(let e in s.views)if("_defaultView"!==e){let t=s.views[e];t.MP_ADMIN&&"localView"!==e&&(a=a||s.activeView===e,l[e]=t)}o&&u.setAdminViews(l);let r=s.activeView;a&&n&&n.MP_UUID===s.activeView&&(s.views[n.MP_UUID]=n,r="localView"),p.updateViews(s.views),p.setCurrentView(r),i.publish({event:"switch_view",data:{viewId:r}}),i.publish({event:"saveViewInWidget"})}},window.addEventListener("message",I)}})}));