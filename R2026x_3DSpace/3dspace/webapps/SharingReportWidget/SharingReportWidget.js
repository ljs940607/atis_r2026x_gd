define("DS/SharingReportWidget/SharingReportWidget",["UWA/Core","UWA/Controls/Input","DS/UIKIT/Image","UWA/Controls/Abstract","UWA/Json","DS/WAFData/WAFData","DS/SearchWidget/SearchWidget","DS/SearchWidget/SearchWidgetConstant","DS/ErrorWidget/ErrorWidget","DS/DataGridWidget/DataGridWidget","DS/WidgetServices/WidgetServices","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/WidgetServices/CollabPerfTimer","DS/WarningWidget/WarningWidget","DS/ShareWidget/ShareController","DS/UIKIT/Input/Button","DS/UIKIT/Input/Select","DS/UIKIT/Spinner","DS/UIKIT/Input/ButtonGroup","DS/Logger/Logger","DS/WebToWinInfra/WebToWinCom","DS/Controls/Toggle","DS/UIKIT/Input/Text","UWA/Event","DS/ReportingPanel/ReportingPanel","DS/ENOCollabToolsUI/tracker/ENOCollabTracker","css!DS/SharingReportWidget/SharingReportWidget.css","i18n!DS/SharingReportWidget/assets/nls/langSR","UWA/Widget","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Controls/Tab"],(function(e,t,i,n,r,a,o,s,c,d,l,p,u,h,g,m,S,v,f,A,C,R,y,D,b,U,_,T,E,x,W){"use strict";UWA.debug=!0;var w=l.getProdLevel(),I="SHR_MasterContain",O={};return n.extend({defaultOptions:{className:"",ForbiddenChar:'"#$@%*,?\\<>[]|:',setValidButton:!0,setCloseButton:!0,showTopBar:!0,wintop:!1,topClassHeight:I,readOnly:"auto",displayWarningForAutoRO:!1,serverName:"",serverUri:"",activeMultisel:!0,activeComment:!1,serverUrl:""},init:function(e,t,i){if(this._parent(i),1==this.options.wintop&&(this.webToWinCom_Socket=C.createSocket({socket_id:"webinwinAccessRights_socket_"+Math.floor(1e5*Math.random()+1)}),void 0!==this.options.serverUrl&&this.options.serverUrl.length>0&&void 0!==this.options.serverUrl[0].platformId)){var n=this.options.serverUrl[0].platformId;l.setTenantID(n)}this.widgetSecurityContext={},this._perfTimer=u,this._perfTimer.init("Share"),this._perfTimer.start("CommandUIDurationShare");var r="";if(null!=e){if(e.hasOwnProperty("pad_security_ctx"))0!=(r=e.pad_security_ctx).indexOf("ctx::")&&(r="ctx::"+r);else if("function"==typeof e.hasPreference&&null!=e.getPreference("pad_security_ctx"))r=e.getPreference("pad_security_ctx").value;else if("function"==typeof e.hasPreference&&e.hasPreference("xPref_CREDENTIAL")){var a=e.getPreference("xPref_CREDENTIAL");void 0!==a.value&&null!==a.value&&a.hasOwnProperty("value")&&(r="ctx::"+a.value)}else"function"==typeof e.hasPreference&&null!=e.getPreference("securityContext")&&(r=e.getPreference("securityContext").value);r.length>0&&(this.widgetSecurityContext={SecurityContext:r})}this.isODT=!1,void 0!==typeof this.options&&null!==this.options&&this.options.hasOwnProperty("odtmode")&&(this.isODT=this.options.odtmode),w=l.getProdLevel(),this.options.activeMultisel=this.options.activeMultisel||l.isMultiSelODT(),this.options.activeComment=this.options.activeComment||l.isCommentODT(),this.isReadOnly=!1,this.listID=[],this.listOfIds=[],this.listOfAddedMembers=[],this.listOfValidIDs=[],this.listOfInvalidIDs=[],O={},!0===this.options.readOnly&&(this.isReadOnly=!0),this.widget=e,this.parentWidget=t,this.SearchWidget_View=[];var o=UWA.i18n("AR_Status"),s=UWA.i18n("AR_Title"),c=UWA.i18n("AR_Sum_Type"),d=UWA.i18n("AR_Revision"),p=UWA.i18n("AR_Sum_Org"),h=UWA.i18n("AR_Sum_Collab"),g=UWA.i18n("AR_Sum_Resp"),m=UWA.i18n("AR_Result");this.cols=[{text:"ID",dataIndex:"ID",isHidden:!0},{text:"StatusToolTipColumn",dataIndex:"statusTooltip",isHidden:!0,tooltipColumn:"Status"},{text:o,dataIndex:"Status",typeRepresentation:"icon"},{text:s,dataIndex:s},{text:c,dataIndex:c},{text:d,dataIndex:d},{text:p,dataIndex:p},{text:h,dataIndex:h},{text:g,dataIndex:g},{text:m,dataIndex:m}],this.initUI(),this._perfTimer.stop("CommandUIDurationShare"),this.trackerEventBeginTime=Date.now()},initData:function(e){this.SelectedItems=e,this.ShareController.dispatchEvent("onDataLoaded")},addSearchBox:function(e,t){var i=this,n=i.listOfAddedMembers.length;e="  "+e;var r=UWA.createElement("span",{id:"addedItem"+n,class:"SH_AddedItemContainer"}),a=UWA.createElement("span",{class:"SH_TextForItemContainer",text:e}).inject(r);UWA.createElement("span",{id:n,class:"SH_TextForItemContainer",text:"x"}).inject(a).addEventListener("click",(function(){r.setStyle("display","none"),i.DeleteUser(this.id),document.getElementById("searchArea_Recipient").style.display="block"})),"Report"===t&&(i.showMember_Recipient.show(),r.inject(i.showMember_Recipient),document.getElementById("searchArea_Recipient").style.display="none")},getSearchInput:function(e){var t=this;return o.getSearchWidget(o.RESTRICTED,{className:"share-item-view-wrapper",id:e,ForbiddenChar:this.options.ForbiddenChar,MaxNumber:"5",MaxSize:"300",topClassHeight:this.options.topClassHeight,position:"auto",serverName:this.options.serverName,serverUri:this.options.serverUri,serverUrl:this.options.serverUrl,exttype:s.EXTTYPE_USERGRP,showEmptyCategory:!1,hint:UWA.i18n("SearchPlaceHolder"),events:{onValid:function(){t.AddUser(e)&&(t._ManageValidButton(!0),1==t.options.activeComment&&t.searchComment.show(),t.addSearchBox(this.searchInput.getValue(),this.options.id),t.dispatchEvent("onChangeSize")),this.searchInput.setValue("")},onUnvalid:function(){1==t.options.activeComment&&t.searchComment.hide(),t.dispatchEvent("onChangeSize")},onError:function(e){t.setError(e)}}})},initUI:function(){var e=this;this.tabBar=new W({displayStyle:"strip"});var t=this.container=UWA.createElement("div",{name:I,"data-rec-id":I,class:I+" "+e.options.className});this.globalDiv=UWA.createElement("div",{class:"SHR_GlobalContain","data-rec-id":"datarecGlobalContain"}).inject(t),this.tabBar.add({label:UWA.i18n("SHReport_RecipientTab"),isSelected:!0,content:this.createRecipientDivContent()}),this.tabBar.add({label:UWA.i18n("SHReport_SelectionTab"),content:this.createSelectionDivContent()}),this.tabBar.inject(t);e=this;this.tabBar.boutonValid=this.boutonValid,this.tabBar.addEventListener("tabButtonClick",(function(t){1==t.options.value?e.boutonValid.setDisabled(!1):e.boutonValid.setDisabled(!0)}))},createSelectionDivContent:function(){return UWA.createElement("div",{html:"<span>Generate report based on object(s) selections</span>",style:{"font-size":"14px"}})},createRecipientDivContent:function(){var e=this;this.ManageButtonDiv=UWA.createElement("table",{class:"SH_ManageButtonDiv","data-rec-id":"datarecManageButtonDiv",html:{}}),e.ManageButtonRight=UWA.createElement("td",{class:"SH_ManageButtonRight","data-rec-id":"datarecManageButtonRight"}),e.ManageButtonLeft=UWA.createElement("td",{class:"SH_ManageButtonLeft","data-rec-id":"datarecManageButtonLeft"}),e.loadingArea=new v({visible:!1});var t=null;e.boutonValid=new m({attributes:{title:UWA.i18n("")},name:"TopButtonValid",value:UWA.i18n("SHReport_Btn"),className:"default medium AR_buttonTop primary",disabled:!0});var i=e.boutonValid.getContent();null!=i&&i.setAttribute("data-rec-id","boutonValid"),t=new m({attributes:{title:UWA.i18n(""),"data-rec-id":"datarecButtonCancel"},name:"TopButtonCancel",value:UWA.i18n("AR_CloseOverlay"),className:"default medium AR_buttonTop"}),e.boutonValid.addEvents({onClick:function(){e._perfTimer.start("CommandExecutionDurationShare"),e._ManageValidButton(!1),e.displayLoadingArea(),p.getInstance().getSecurityContext({onSuccess:function(t){e.widgetSecurityContext.hasOwnProperty("SecurityContext")?O.hasOwnProperty("name")?e.getDirectSharedObjects(O,e.widgetSecurityContext):e.getSelectionBasedReport(e.widgetSecurityContext):O.hasOwnProperty("name")?e.getDirectSharedObjects(O,t):e.getSelectionBasedReport(e.widgetSecurityContext)},onFailure:function(t){e.widgetSecurityContext.hasOwnProperty("SecurityContext")?O.hasOwnProperty("name")?e.getDirectSharedObjects(O,e.widgetSecurityContext):e.getSelectionBasedReport(e.widgetSecurityContext):e.setError(t)}}),t.setValue(UWA.i18n("AR_Close"))}}),t.addEvents({onClick:function(){e._ManageValidButton(!1),e.dispatchEvent("onCancel"),e._perfTimer.printTime("CommandUIDurationShare")}}),e.loadingArea.inject(e.ManageButtonRight),0==this.isReadOnly&&1==e.options.setValidButton&&e.boutonValid.inject(e.ManageButtonRight),1==e.options.setCloseButton&&t.inject(e.ManageButtonRight),e.ManageButtonLeft.inject(this.ManageButtonDiv),e.ManageButtonRight.inject(this.ManageButtonDiv),e.options.showTopBar&&this.ManageButtonDiv.inject(e.globalDiv),e.mainLoading=UWA.createElement("div",{class:"SHR_MainLoading","data-rec-id":"datarecMainLoading"}).inject(this.globalDiv),e.addMemberPanel=UWA.createElement("div",{class:"shareaddmember-item-view-container expanded"}).inject(e.mainLoading),e.memberPanel=UWA.createElement("div",{class:"shareaddmember-item-view-body","data-rec-id":"datarecMemberPanel"}).inject(e.addMemberPanel),e.addMemberPanel=UWA.createElement("div",{class:"share-item-view-container highlighted","data-rec-id":"c10"}).inject(e.memberPanel),e.tableAddMember=UWA.createElement("table").inject(e.addMemberPanel),e.addMEmberContainer=UWA.createElement("tbody").inject(e.tableAddMember);e.options.ForbiddenChar;this.searchIconArr=[],e.recipient=UWA.createElement("tr",{class:"tr-recipient"}).inject(e.addMEmberContainer),e.recipientTD=UWA.createElement("td",{class:"SH_LabelContainer"}).inject(e.recipient),e.recipientLabel=UWA.createElement("span",{id:"recipient-label",text:T.get("Share Recipient:")}).inject(e.recipientTD),e.recipientLabel.setStyle("text-align","left"),e.recipientLabel.setStyle("font-family","arial"),e.recipientLabel.setStyle("font-size","12px"),e.recipientSearchTD=UWA.createElement("td").inject(e.recipient),e.showMember_Recipient=UWA.createElement("div",{class:"SH_AddedMomberContainer",id:"member_Author"}).inject(e.recipientSearchTD).hide(),e.searchArea_Recipient=UWA.createElement("div",{id:"searchArea_Recipient"}).inject(e.recipientSearchTD),e.searchWidget_Recipient=e.getSearchInput("Report").inject(e.searchArea_Recipient),e.searchWidget_Recipient.container.container.getElementsByClassName("AR_SearchButton").SW_SearchInputButton.setStyle("display","none");return e.selectRightNewUser=new S({nativeSelect:!0,placeholder:!1}),e.selectRightNewUser.elements.container.setAttribute("data-rec-id","dataRecselectRightNewUserContainer"),e.selectRightNewUser.elements.content.setAttribute("data-rec-id","dataRecselectRightNewUser"),e.errorOverlay=new c(e.widget,e.container,{className:"errorComponent_AccessRight","data-rec-id":"datarecErrorComponentAccessRight"}),this.ShareController=new g(e.widget,{uniqueRightList:!this.isReadOnly,serverName:this.options.serverName,wintop:this.options.wintop,serverUri:this.options.serverUri,serverUrl:this.options.serverUrl,isReadOnly:this.isReadOnly,odtMode:this.isODT,parent:this,contextArea2:this.ManageButtonLeft,progressBarWaitContext:e.container,events:{onError:function(t){e.hideFailMainLoadingArea(),e.addError(t)},onError2:function(t){e.hideFailMainLoadingArea(),e.hideMainLoadingArea(),e.addError(t)},onWarning:function(t){e.addError(t)},onDataLoaded:function(){if(null!=e.container.getParent()){e.hideMainLoadingArea();var t=e.selectRightNewUser.elements.container.childNodes[0].childNodes;if(t.forEach)t.forEach((function(e,t){e.setAttribute("data-rec-id","dataRecComboRightsValue"+t)}));else Array.prototype.slice.call(t).forEach((function(e,t){e.setAttribute("data-rec-id","dataRecComboRightsValue"+t)}));const i=[{objectID:"341AB48000006DA065EC009D00010B33"}];e.searchWidget_Recipient.setSelectedItemList(i)}}}}),this._ManageValidButton(),this.globalDiv},getDirectSharedObjects:function(e,t){var i=this,n={Accept:"application/json","Content-Type":"application/json"};if(null!=t&&""!=t&&t.hasOwnProperty("SecurityContext")){0!=t.SecurityContext.indexOf("ctx::")&&"ctx::",n.SecurityContext=encodeURIComponent(t.SecurityContext);this.options.serverName,this.options.serverUri;l.get3DSpaceUrlAsync({onComplete:function(t){var a="POST",o="",s=l.getRealPath("assets/validModification.json",i.widget);console.log("------------------ recipient is ------------------"),console.log(e);var c={requests:[e]},d=JSON.stringify(c);console.log("------------------ dataToSend is ------------------"),console.log(d);T.get("AR_"),r.encode({requests:d});2==w&&(o="passport");c="";2==w&&(s=t+"/resources/accessRightServices/ar/getDirectlySharedObjects",a="POST"),i.displayLoadingArea(),n["Accept-Language"]=widget.lang;var p=l.getTenantID();p&&0!=p.length?s+="?tenant="+p:s+="?tenant=OnPremise",l.partitionedAuthenticatedRequest(s,{type:"json",method:a,proxy:o,headers:n,progressBarWaitContext:i.container,data:d,timeout:36e5,onComplete:function(e){console.log(e),i.dispatchEvent("onCancel")},onFailure:function(e,t,n){i._onFailure(e,t,n),i._perfTimer.stop("CommandExecutionDurationShare"),i._perfTimer.printTime("CommandUIDurationShare"),i._perfTimer.printTime("CommandExecutionDurationShare")},onTimeout:function(){i._onTimeout(),i._perfTimer.stop("CommandExecutionDurationShare"),i._perfTimer.printTime("CommandUIDurationShare"),i._perfTimer.printTime("CommandExecutionDurationShare")}})},serverUrl:i.options.serverUrl,wintop:i.options.wintop})}else{var a={message:UWA.i18n("ErrorSecurityContextEmpty"),code:"ERROR"};this.setError(a)}},getSelectionBasedReport:function(e){var t=this,i={Accept:"application/json","Content-Type":"application/json"};if(null!=e&&""!=e&&e.hasOwnProperty("SecurityContext")){0!=e.SecurityContext.indexOf("ctx::")&&"ctx::",i.SecurityContext=encodeURIComponent(e.SecurityContext);this.options.serverName,this.options.serverUri;l.get3DSpaceUrlAsync({onComplete:function(e){var n="POST",a="",o=l.getRealPath("assets/validModification.json",t.widget),s=[];for(var c in t.SelectedItems){var d={objectid:t.SelectedItems[c].getID()};s.push(d)}T.get("AR_");var p=r.encode({requests:s});2==w&&(a="passport");2==w&&(o=e+"/resources/accessRightServices/ar/getRecipientBasedReport",n="POST"),t.displayLoadingArea(),i["Accept-Language"]=widget.lang;var u=l.getTenantID();u&&0!=u.length?o+="?tenant="+u:o+="?tenant=OnPremise",l.partitionedAuthenticatedRequest(o,{type:"json",method:n,proxy:a,headers:i,progressBarWaitContext:t.container,data:p,timeout:36e5,onComplete:function(e){console.log(e),t.dispatchEvent("onCancel")},onFailure:function(e,i,n){t._onFailure(e,i,n),t._perfTimer.stop("CommandExecutionDurationShare"),t._perfTimer.printTime("CommandUIDurationShare"),t._perfTimer.printTime("CommandExecutionDurationShare")},onTimeout:function(){t._onTimeout(),t._perfTimer.stop("CommandExecutionDurationShare"),t._perfTimer.printTime("CommandUIDurationShare"),t._perfTimer.printTime("CommandExecutionDurationShare")}})},serverUrl:t.options.serverUrl,wintop:t.options.wintop})}else{var n={message:UWA.i18n("ErrorSecurityContextEmpty"),code:"ERROR"};this.setError(n)}},_fedSearch:function(e){return new Promise(((t,i)=>{var n=this;l.get3DSearchUrlAsync({wintop:n.options.wintop,serverUrl:n.options.serverUrl,onComplete:function(r){var o=r+"/search",s=l.getTenantID();s&&(o+="?tenant="+s);var c=l.getLanguage(),d={select_predicate:["groupuri","ds6w:label","identifier"]};d.locale=c,d.nresults=25,d.tenant=s,d.query='([ds6w:type]:"Group" AND [identifier]:('+e.query+')) OR ([ds6w:type]:"foaf:Group" AND [ds6w:label]:('+e.query+"))",d.start=0;var p={Accept:"application/json","content-type":"application/json","Accept-Language":c},u=0==n.options.wintop?"passport":"",h="searchUserGrp-"+(window.top.dsUserLogin?window.top.dsUserLogin:"unknown")+"-"+(new Date).getTime();d.label=h,n.requestObject=a.authenticatedRequest(o,{type:"json",method:"POST",proxy:u,data:UWA.Json.encode(d),headers:p,onComplete:function(e){t(e)},onFailure:function(e,t,n){i(e)},onCancel:function(){i(new Error("Cancelled"))},onTimeout:function(){i(new Error("Timeout"))}})}})}))},_ManageValidButton:function(e){e?this.boutonValid.setDisabled(!1):this.boutonValid.setDisabled(!0)},getTopBar:function(){return this.ManageButtonDiv},setError:function(e){var t={};"object"==typeof e?"1500028"===e.code?(e.message=UWA.i18n("ErrorNotAccessRight"),t=e):e.hasOwnProperty("errorCode")&&"FS_INVALID_QUERY__NOT_AUTHORIZED_QUERY__WILDCARD"===e.errorCode?(t.code=e.errorCode,t.message=T.get("FS_INVALID_QUERY__NOT_AUTHORIZED_QUERY__WILDCARD")):t=e:t=e,this.addError(t)},addError:function(e){this.errorOverlay.displayJSONError(r.encode(e))},displayLoadingArea:function(){this.loadingArea.show(),this.loadingArea.elements.container.setStyle("display","flex")},hideLoadingArea:function(){this.loadingArea.hide()},hideMainComponent:function(){this.hideLoadingArea(),this.boutonValid.hide()},hideMainLoadingArea:function(){this.loadingArea.hide()},hideFailMainLoadingArea:function(){this.mainLoading.hide()},_onFailure:function(e,t,i,n,a,o){this.hideLoadingArea(),r.isJson(t)&&(t=r.decode(t));var s={};s=null!=t&&t.hasOwnProperty("error")?t.error:{message:UWA.i18n("AR_ErrorModification"),code:"ERROR"},this.setError(s)},_onTimeout:function(){this.hideLoadingArea();var e={message:UWA.i18n("ErrorTimeOut"),code:"TO"};this.setError(e)},AddUser:function(e){var t=this,i=!1;if(!l.isProgressBusy()){var n="";if("Report"==e){n=t.searchWidget_Recipient.getNewOwner();if(console.log(n),n.hasOwnProperty("person")){const e=n.person.personID.split("_");O={name:e[0],type:"person"}}else n.hasOwnProperty("collabSpace")&&n.hasOwnProperty("organization")?O={org:n.organization.orgID,cs:n.collabSpace.collabSpaceID,type:"ORG/CS"}:n.hasOwnProperty("userGrp")&&(O={name:n.userGrp.identifier,type:"userGrp"})}else""==e&&(n=t.searchWidget.getNewOwner());if(null===n||""===n)return i;n.hasOwnProperty("userGrp")&&(n.group={groupURI:n.userGrp.id,groupTitle:n.userGrp.label},delete n.userGrp);var r={ownership:{InitRights:"",operation:"ADD",owner:n,access:{logical:e}},isTrueComment:!0,isTrueInheritedPath:!0};return t.listOfAddedMembers.push(r),i=!0}}})}));