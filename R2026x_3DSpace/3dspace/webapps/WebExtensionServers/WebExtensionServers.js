define("DS/WebExtensionServers/WebExtensionServer",["UWA/Class"],(function(e){"use strict";return e.extend({init:function(){this._extensionTable={},this._interfaceTable={},this._componentTable={}},_require:async function(e){return new Promise(((t,n)=>{require([e],(e=>{t(e)}),(e=>{n(e)}))}))},_watchDog:async function(e,t){return new Promise((async n=>{let i=0,o=setInterval((async()=>{let n=await Promise.allSettled(t.map(((t,n)=>((t,n)=>Promise.race([t,Promise.resolve({myTestFunction:!0,index:n})]).catch((t=>{console.error(new Error("Can't load "+e[n]))})))(t,n))));if(++i>10)n.filter((e=>"fulfilled"===e.status)).forEach((t=>{t.value.myTestFunction&&console.warn("Still waiting for "+e[t.value.index])}));else{let e=n.filter((e=>"fulfilled"===e.status&&e.value.myTestFunction)).length;console.warn("Loading completed for "+(t.length-e)+"/"+t.length+" modules")}}),1e3,1e3),s=await Promise.allSettled(t);clearInterval(o),s.forEach((e=>{"fulfilled"!==e.status&&console.warn(new Error("Unable to load "+e.reason))})),n(s)}))},DeclareDictionary:async function(e){let t=Object.keys(e.interfaces);var n=t.map((t=>this._require(e.interfaces[t]).then((e=>(this.AddInterface(t,e),t)))));let i=Object.keys(e.components);var o=i.map((t=>this._require(e.components[t]).then((e=>(this.AddComponent(t,e),t)))));let s={};var r=Object.keys(e.extensions).flatMap((t=>Object.keys(e.extensions[t]).map((n=>{s[t+":"+n]=e.extensions[t][n]}))));let a=Object.keys(s);r=a.map((e=>this._require(s[e]).then((t=>{let n=e.split(":")[0],i=e.split(":")[1];if(t)return t.GetOrigin=()=>t,this.AddExtension(n,i,t),e;console.error("Unable to load extension "+n+":"+i)}))));return await this._watchDog(t.concat(i).concat(a),n.concat(o).concat(r)),this},AddExtension:function(e,t,n){var i=this._extensionTable[e];i?void 0===i[t]?(i[t]=n,this._extensionTable[e]=i):console.warn("trying to override existing extension"):((i={})[t]=n,this._extensionTable[e]=i)},AddInterface:function(e,t){void 0===this._interfaceTable[e]&&(this._interfaceTable[e]=t)},AddComponent:function(e,t){void 0===this._componentTable[e]&&(this._componentTable[e]=t)},GetExtension:function(e,t){var n=this._extensionTable[e];if(n)return n[t]},GetInterface:function(e){return this._interfaceTable[e]},GetComponent:function(e){return this._componentTable[e]}})}));