define("DS/VCXWeb3DMaster/VCXModifiableOccurrenceComposer",["DS/CoreEvents/Events","DS/VCXWebExperienceBase/VCXModifiableOccurrenceExt","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebModifiables/VCXModelChangeListener","DS/VCXWebVisibility/VCXIVisibility","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueLink","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyInfoEnum","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebSystem/VCXEnums","DS/VCXWebComponents/VCXWebComponentOccurrence","DS/Visualization/ThreeJS_DS","DS/VCXWebVisu/VCXVisuTools","i18n!DS/VCXWebModifiables/assets/nls/VCXWebModifiables","i18n!DS/VCXWeb3DMaster/assets/nls/VCXWeb3DMaster","DS/Visualization/IdPath"],(function(e,t,r,i,a,o,n,s,l,p,h,d,c,u,g,y,M,D,P,C){"use strict";return t.extend({init:function(){this._parent()},OnChangeProperty:function(e,t,r){if(r||(r={}),r.fromChildClass);else if(this.OnChangePropertyBegin(e,t))return!0;if(r.fromChildClass=!0,!this._parent(e,t,r)){switch(e){case"Actor.BomId":this._requestedBOMID=t.GetValue();break;case"Actor.PartList.ID":this._requestedPartListID=t.GetValue();break;case"Actor.PartList.Enabled":this._requestedPartListEnabled=t.GetValue();break;case"Actor.PartList.Description":this._requestedPartListDescription=t.GetValue();break;case"Actor.Env.Effect":this._requestedEnvEffect=t.GetValue();break;case"Actor.PLM.Material":this._requestedPLMMaterial=t.GetValue();break;default:if(!e.startsWith("Actor.Highlight."))return!1;var i=e.substring(16);this._requestedHighlightData||(this._requestedHighlightData={}),this._requestedHighlightData[i]=t.GetValue()}}return!0},OnChangePropertiesEnd:function(){this._parent();var t=this.GetObject();if(void 0!==this._requestedBOMID){if(t.bomID!==this._requestedBOMID)(r=t._experienceBase.getManager("VCXModelChangeListener"))&&r.hasChanged(a.FChangeFlag.BomID,!0),t.bomID=this._requestedBOMID;delete this._requestedBOMID}if(void 0!==this._requestedPartListID){if(t.PartListID!==this._requestedPartListID)(r=t._experienceBase.getManager("VCXModelChangeListener"))&&r.hasChanged(a.FChangeFlag.PartListID,!0),t.PartListID=this._requestedPartListID;delete this._requestedPartListID}if(void 0!==this._requestedPartListEnabled){if(t.PartListEnabled!==this._requestedPartListEnabled)(r=t._experienceBase.getManager("VCXModelChangeListener"))&&r.hasChanged(a.FChangeFlag.PartListEnabled,!0),t.PartListEnabled=this._requestedPartListEnabled,e.publish({event:"OnAddToPartList",data:{component:t}});delete this._requestedPartListEnabled}if(void 0!==this._requestedPartListDescription){var r;if(t.PartListDescription!==this._requestedPartListDescription)(r=t._experienceBase.getManager("VCXModelChangeListener"))&&r.hasChanged(a.FChangeFlag.PartListDescription,!0),t.PartListDescription=this._requestedPartListDescription;delete this._requestedPartListDescription}if(void 0!==this._requestedEnvEffect&&(t._envID!==this._requestedEnvEffect&&(t._envID=this._requestedEnvEffect,t.setDirtyFlag(g.FDirty.Material|g.FDirty.EnvID)),t._envID!==u.EnvironmentalId.PLM&&(this._requestedPLMMaterial=null),delete this._requestedEnvEffect),void 0!==this._requestedPLMMaterial){if(t._envID!==u.EnvironmentalId.PLM&&(this._requestedPLMMaterial=null),this._requestedPLMMaterial!==t.PLMMaterialID){var i=t._experienceBase.getManager("VCXCAT3DXModelManager");if(i){var o=this._requestedPLMMaterial,n=null;o&&(n=t._experienceBase.ComponentsMap.GetComponentFromID(o)),i.ApplyMaterial(this.GetObject(),n,!1)}}delete this._requestedPLMMaterial}if(this._requestedHighlightData){for(const e in this._requestedHighlightData)(t=this.GetObject()).HighlightData||(t.HighlightData=t.DefaultHighlightData),t.HighlightData[e]!==this._requestedHighlightData[e]&&(t.HighlightData[e]=this._requestedHighlightData[e],t.setDirtyFlag(g.FDirty.Highlight));delete this._requestedHighlightData}if(t.IsMesh()||this.GetObject()._experienceBase.getManager("VCXContextManager").isSupported("FullFeaturesOnNodes")){var s=!1;t.getDirtyFlag(g.FDirty.Material)&&(t._dirtyMask|=g.FDirty.Color,t._dirtyMask|=g.FDirty.Alpha,s=!0),t.getDirtyFlag(g.FDirty.Color)&&t._textureDocID&&(t._dirtyMask|=g.FDirty.Material),t.getDirtyFlag(g.FDirty.Alpha)&&(null==t._visibilityAlpha&&null==t._alpha||(t._localAlpha=1,null!=t._visibilityAlpha&&(t._localAlpha*=t._visibilityAlpha),null!=t._alpha&&(t._localAlpha*=t._alpha)))}(t._dirtyMask||s)&&this.applyChanges()},applyChanges:function(){var t=this.GetObject(),r=t._experienceBase.getManager("VCXContextManager");if(t._dirtyMask){var i=(s=r.getActiveViewport())&&s.QueryInterface("VCXIModifiable").GetPropertyValue("Render.ChildrenStronger")||!1;if(t.getDirtyFlag(g.FDirty.Position)&&(t.setPosition(t.matrix),t.setDirtyFlag(g.FDirty.Position,!1)),t.getDirtyFlag(g.FDirty.Priority)&&(t.setRenderPriority(t.priority),t.setDirtyFlag(g.FDirty.Priority,!1)),t.getDirtyFlag(g.FDirty.LayerOpacity)&&(t.setRenderOpacity(t.layerOpacity),t.setDirtyFlag(g.FDirty.LayerOpacity,!1)),t.getDirtyFlag(g.FDirty.Alpha)&&(t.OverrideAlpha(t.localOpacityIsDefined?t.localAlpha*t.visibilityAlpha:1!==t.visibilityAlpha?t.visibilityAlpha:null,null,i),t.setDirtyFlag(g.FDirty.Alpha,!1)),t.getDirtyFlag(g.FDirty.Highlight)){if(!t.HighlightData||!t.HighlightData.Enabled)if(t._highlightSet)(o=t._experienceBase.getManager("VCXContextManager").getMainViewer()).removeHighlightSet(t._highlightSet),delete t._highlightSet;if(t.HighlightData&&t.HighlightData.Enabled){var a=t.QueryInterface("W3AISGNodeHolder").getPathElement();if(a){var o=t._experienceBase.getManager("VCXContextManager").getMainViewer();t.HighlightData||(t.HighlightData=t.DefaultHighlightData);var n=t.HighlightData.polite?new y.AdvancedPoliteHighlightData(t.HighlightData):new y.HaloHighlightData(t.HighlightData);t._highlightSet||(t._highlightSet=o.createHighlightSet(n,!1,t.HighlightData.polite,!0),t._highlightSet.add(a,{highlightColor:n},!1)),t._highlightSet.setHighlightData(t.HighlightData.polite,n)}else console.warn("Object "+t.QueryInterface("W3AISGNodeHolder").getPathOfIDs().ids.join(",")+" has no PE yet")}}if((t.getDirtyFlag(g.FDirty.Color)||t.getDirtyFlag(g.FDirty.Material))&&(t.UpdateLocalMaterial(),t.OverrideMaterial(t.localMaterial,null,null,i),t.setDirtyFlag(g.FDirty.Color,!1),t.setDirtyFlag(g.FDirty.Material,!1)),t.getDirtyFlag(g.FDirty.RenderingMode)){var s,l=t.renderingMode;if(s=t._experienceBase.getManager("VCXContextManager").getActiveViewport()){var p=s.QueryInterface("VCXIModifiable").GetPropertyValue("Render.Mode"),h=s.QueryInterface("VCXIModifiable").GetPropertyValue("Render.ShowConstructions");p!==g.ERenderingMode.Custom&&(l=null)}t.OverrideRenderingMode(l,null,i,h),t.setDirtyFlag(g.FDirty.RenderingMode,!1)}t.getDirtyFlag(g.FDirty.Visibility)&&(t.OverrideVisibility(t.localVisibility,null,i),t.setDirtyFlag(g.FDirty.Visibility,!1)),e.publish({event:"VCX_PROPERTIES_CHANGED",data:{component:t,dirtyFlag:t._dirtyMask}})}},GetProperty:function(e){var t=null,a=this.GetObject();a._experienceBase.getManager("VCXContextManager");let o,u;switch(e){case"Actor.Opacity":if(this.GetObject().localOpacityIsDefined)return this._parent(e);o=new l,o.SetValue(1),u=new i(e,0,!0,D),u.SetBounds(0,1,.1),u.SetDefined(!1),t=new r(u,o);break;case"Actor.BomId":o=new n(this.GetObject().bomID),t=new r(new i(e,0,!0,P),o);break;case"Actor.Env.Effect":u=new p(e,0,!0,P),u.Seti18nGroup(D),u.SetGroupId("Group.Appearance"),u.SetVisible(!1),o=new h(a._envID),t=new r(u,o);break;case"Actor.PartList.ID":u=new i(e,2,!0,P),u.Seti18nGroup(D),u.SetGroupId("Group.PartList"),o=new n(a.PartListID),t=new r(u,o);break;case"Actor.PartList.Description":u=new i(e,2,!0,P),u.Seti18nGroup(D),u.SetGroupId("Group.PartList"),o=new n(a.PartListDescription),t=new r(u,o);break;case"Actor.PartList.Enabled":u=new i(e,0,!0,P),u.Seti18nGroup(D),u.SetGroupId("Group.PartList"),u.SetControlsGroupVisibility(!0),o=new d(a.PartListEnabled),t=new r(u,o);break;case"Actor.PLM.Material":var g="";const f=a.GetCurrentMaterial();f&&(g=f.GetID()),o=new s(g),u=new i(e,0,!0,D),u.SetGroupId("Group.Appearance"),u.SetVisible(!1),t=new r(u,o);break;case"Actor.Thumbnail.URL":this.GetObject()._thumbURL&&(o=new n(this.GetObject()._thumbURL),t=new r(new i(e,0,!0,P),o));break;case"Actor.Prop.Area":o=new l,o.SetValue(a._area),u=new i(e,0,!0,P),u.Seti18nGroup(D),u.SetGroupId("Group.Geometry"),t=new r(u,o);break;case"Actor.Prop.Volume":o=new l,o.SetValue(a._volume),u=new i(e,0,!0,P),u.Seti18nGroup(D),u.SetGroupId("Group.Geometry"),t=new r(u,o);break;case"Actor.Color.CAD":var y=M.buildGraphicPropertiesStructure(a,null,a.GetObject()._experienceBase.getManager("VCXContextManager").getMainViewer(),{getColor:!0});o=new c,o.SetValue(y&&y[0].visible&&y[0].visible.ComputedColor),u=new i(e,0,!1,P),u.Seti18nGroup(D),u.SetGroupId("Group.Appearance"),t=new r(u,o);break;case"Actor.Material.CAD":o=new n,o.SetValue(a._MaterialDescription&&a._MaterialDescription.Name),u=new i(e,0,!1,P),u.Seti18nGroup(D),u.SetGroupId("Group.Appearance"),t=new r(u,o);break;default:if(e.startsWith("Actor.Highlight.")){var C=e.substring(16);switch(u=new i(e,0,!0,P),u.Seti18nGroup(D),u.SetGroupId("Group.Highlight"),C){case"Enabled":case"colorEnabled":case"haloEnabled":case"outlineEnabled":case"polite":u.SetControlsGroupVisibility(!0),o=new d;break;case"color":case"haloColor":case"lineicHaloColor":case"outlineColor":case"lineicOutlineColor":o=new c;break;case"intensity":o=new l;break;case"haloIntensity":o=new l,u.SetBounds(0,8,.1);break;case"visibleAlpha":case"occludedAlpha":case"outlineAlpha":case"lineicOutlineAlpha":o=new l,u.SetBounds(0,1,.1);break;case"haloThickness":o=new l,u.SetBounds(0,4,.1);break;case"outlineThickness":o=new l,u.SetBounds(0,16,.1)}a.HighlightData||(a.HighlightData=a.DefaultHighlightData),o.SetValue(a.HighlightData[C]),t=new r(u,o)}else t=this._parent(e)}return t},RequestModification:async function(e,t){if(e){var i=e.GetPropertyInfo().GetPropertyName();if("Actor.Highlight.color"===i){let i=new p("Actor.Highlight.haloColor",0,!0,P);return t.AddOrModifyProperty(this.GetHashing(),new r(i,e.GetPropertyValue().Clone())),i=new p("Actor.Highlight.outlineColor",0,!0,P),t.AddOrModifyProperty(this.GetHashing(),new r(i,e.GetPropertyValue().Clone())),t.AddOrModifyProperty(this.GetHashing(),e),t}if("Actor.PartList.Enabled"===i&&e.GetPropertyValue().Value){var a=this.GetObject()._experienceBase.getManager("VCXComponentPartListManager");a&&(a.turnOnPartListVisibility=!0);var o=this.GetObject();if(""===o.PartListID){var s=o._refid;void 0!==s&&""!==s||(s=d.GetProperty("Actor.Name")&&d.GetProperty("Actor.Name").GetPropertyValue().Value);var l=1,h=1,d=this,c=o._experienceBase.getManager("VCXContextManager").getRootComponent();if(c){var u=c.QueryInterface("VCXIModelNavigable");u&&u.traverse((function(e,t,r){if(e.GetObject().IsKindOf("VCXComponentOccurrenceComposer")){h=parseInt(e.GetObject().PartListID);let t=e.GetObject()._refid;if(void 0===s||""===s){let r=e.GetObject().QueryInterface("VCXIModifiable");r&&(t=r.GetProperty("Actor.Name")&&r.GetProperty("Actor.Name").GetPropertyValue().Value)}s===t?h>=1&&(l=h,r.stop=!0):h>=parseInt(l)&&(l=h+1)}}),null,{})}o.PartListID=l.toString();var g=o.PartListDescription;""===g&&(""===(g=this.GetProperty("Actor.Name.ReferenceTitle")&&this.GetProperty("Actor.Name.ReferenceTitle").GetPropertyValue().Value)&&(g=this.GetProperty("Actor.Name")&&this.GetProperty("Actor.Name").GetPropertyValue().Value),o.PartListDescription=g);let i=this.GetProperty("Actor.PartList.ID").GetPropertyInfo(),a=new n(o.PartListID),p=this.GetProperty("Actor.PartList.Description").GetPropertyInfo(),y=new n(o.PartListDescription);return this._parent(e,t),t.AddOrModifyProperty(this.GetHashing(),new r(i,a)),t.AddOrModifyProperty(this.GetHashing(),new r(p,y)),t}}}return this._parent(e,t)},Dispose:function(){const e=this.GetObject();e._highlightSet&&(e._highlightSet.clearAll(),e._experienceBase.getManager("VCXContextManager").getMainViewer().removeHighlightSet(e._highlightSet),delete e._highlightSet);return this._parent()},GetProperties:function(){var e=this._parent();return(this.GetObject().IsMesh()||this.GetObject()._experienceBase.getManager("VCXContextManager").isSupported("FullFeaturesOnNodes"))&&(e.AddOrModifyProperty(this.GetProperty("Actor.Env.Effect")),e.AddOrModifyProperty(this.GetProperty("Actor.PLM.Material"))),e.AddOrModifyProperty(this.GetProperty("Actor.PartList.Enabled")),e.AddOrModifyProperty(this.GetProperty("Actor.PartList.ID")),e.AddOrModifyProperty(this.GetProperty("Actor.PartList.Description")),e.AddOrModifyProperty(this.GetProperty("Actor.Highlight.Enabled")),e.AddOrModifyProperty(this.GetProperty("Actor.Highlight.polite")),e.AddOrModifyProperty(this.GetProperty("Actor.Highlight.colorEnabled")),e.AddOrModifyProperty(this.GetProperty("Actor.Highlight.color")),e.AddOrModifyProperty(this.GetProperty("Actor.Highlight.intensity")),e.AddOrModifyProperty(this.GetProperty("Actor.Highlight.visibleAlpha")),e.AddOrModifyProperty(this.GetProperty("Actor.Highlight.occludedAlpha")),e.AddOrModifyProperty(this.GetProperty("Actor.Highlight.haloEnabled")),e.AddOrModifyProperty(this.GetProperty("Actor.Highlight.haloColor")),e.AddOrModifyProperty(this.GetProperty("Actor.Highlight.haloThickness")),e.AddOrModifyProperty(this.GetProperty("Actor.Highlight.haloIntensity")),e.AddOrModifyProperty(this.GetProperty("Actor.Highlight.lineicHaloColor")),e.AddOrModifyProperty(this.GetProperty("Actor.Highlight.outlineEnabled")),e.AddOrModifyProperty(this.GetProperty("Actor.Highlight.outlineColor")),e.AddOrModifyProperty(this.GetProperty("Actor.Highlight.outlineThickness")),e.AddOrModifyProperty(this.GetProperty("Actor.Highlight.outlineAlpha")),e.AddOrModifyProperty(this.GetProperty("Actor.Highlight.lineicOutlineColor")),e},IsLiving:function(){var e=this.QueryInterface("VCXIVisibility");return!e||e.GetVisibility()!==o.EVisState.Hidden}})})),define("DS/VCXWeb3DMaster/VCXModifiableViewOccurrenceComposer",["DS/VCXWebExperienceBase/VCXModifiableViewOccurrenceExt","DS/VCXWebVisu/VCXVisuTools","DS/VCXWebProperties/VCXPropertyGroup","DS/VCXWebPlatform/VCXSearchServices","i18n!DS/VCXWebModifiables/assets/nls/VCXWebModifiables","i18n!DS/VCXWeb3DMaster/assets/nls/VCXWeb3DMaster","DS/VCXWebExperienceBase/VCXContextManager"],(function(e,t,r,i,a,o,n){"use strict";return e.extend({init:function(){this._parent()},getPropertyGroups:function(e){e||(e={});var t=this.getGroupPropertiesOrders();(this._parent(e),e["Group.Essentials"]||(e["Group.Essentials"]=new r({groupID:"Group.Essentials"}),e["Group.Essentials"].i18nGroup=a),e["Group.Essentials"].priority=0,e["Group.Essentials"].removeProperty,e["Group.Essentials"].addProperties([{propertyName:"Actor.Name",i18n:a},{propertyName:"Actor.Opacity",i18n:a}]),this.GetObject().IsMesh()||this.GetObject()._experienceBase.getManager("VCXContextManager").isSupported("FullFeaturesOnNodes"))&&(this.GetObject()._experienceBase.getManager("VCXContextManager").getContextFromName("ProdHighMode")&&e["Group.Essentials"].addProperties([{propertyName:"Actor.Position",i18n:a,hiddenFields:["Orientation","Pivot"]}]),e["Group.Appearance"]||(e["Group.Appearance"]=new r({groupID:"Group.Appearance"})),e["Group.Appearance"].priority=10,e["Group.Appearance"].i18nGroup=a,e["Group.Appearance"].setPropertiesOrder(t["Group.Appearance"]),e["Group.Appearance"].addProperties([{propertyName:"Actor.PLM.Material.Choice",i18n:o}]),e["Group.Highlight"]||(e["Group.Highlight"]=new r({groupID:"Group.Highlight"}),e["Group.Highlight"].visibility=!0,e["Group.Highlight"].PropertyControlingGroupVisibility="Actor.Highlight.Enabled"),e["Group.Highlight"].priority=10,e["Group.Highlight"].i18nGroup=a,e["Group.Highlight"].setPropertiesOrder(t["Group.Highlight"]),e["Group.Highlight"].addProperties([{propertyName:"Actor.Highlight.Enabled",i18n:a}]),(i=this.QueryInterface("VCXIModifiable"))&&i.GetProperty("Actor.Highlight.Enabled")&&i.GetProperty("Actor.Highlight.Enabled").GetPropertyValue().Value&&(e["Group.Highlight"].addProperties([{propertyName:"Actor.Highlight.color",i18n:a}]),e["Group.Highlight"].addProperties([{propertyName:"Actor.Highlight.haloEnabled",i18n:a}]),i.GetProperty("Actor.Highlight.haloEnabled").GetPropertyValue().Value&&(e["Group.Highlight"].addProperties([{propertyName:"Actor.Highlight.haloIntensity",i18n:a},{propertyName:"Actor.Highlight.haloThickness",i18n:a}]),i.GetProperty("Actor.Highlight.polite").GetPropertyValue().Value&&e["Group.Highlight"].addProperties([])),e["Group.Highlight"].addProperties([{propertyName:"Actor.Highlight.colorEnabled",i18n:a}]),i.GetProperty("Actor.Highlight.colorEnabled").GetPropertyValue().Value&&(i.GetProperty("Actor.Highlight.polite").GetPropertyValue().Value?e["Group.Highlight"].addProperties([{propertyName:"Actor.Highlight.visibleAlpha",i18n:a},{propertyName:"Actor.Highlight.occludedAlpha",i18n:a}]):e["Group.Highlight"].addProperties([{propertyName:"Actor.Highlight.intensity",i18n:a}]))));if(this.GetObject()._experienceBase.getManager("VCXContextManager").isSupported("PartList")){e["Group.PartList"]||(e["Group.PartList"]=new r({groupID:"Group.PartList"}),e["Group.PartList"].visibility=!0,e["Group.PartList"].PropertyControlingGroupVisibility="Actor.PartList.Enabled"),e["Group.PartList"].priority=300,e["Group.PartList"].i18nGroup=o,e["Group.PartList"].setPropertiesOrder(t["Group.PartList"]),e["Group.PartList"].addProperties([{propertyName:"Actor.PartList.Enabled",i18n:o}]);var i=this.QueryInterface("VCXIModifiable");e["Group.PartList"].addProperties([{propertyName:"Actor.PartList.ID",i18n:o}]),e["Group.PartList"].addProperties([{propertyName:"Actor.PartList.Description",i18n:o}])}return this.GetObject()._experienceBase.ModifiablesAdvancedProperties&&(e["Group.Introspection"]||(e["Group.Introspection"]=new r({groupID:"Group.Introspection"}),e["Group.Introspection"].i18nGroup=a),e["Group.Introspection"].priority=200,e["Group.Introspection"].addProperty({propertyName:"Actor.3DReference",i18n:a})),e},_pushAdditionalPropertyButton:function(e,t,r){e[t]||(e[t]={}),e[t].buttons||(e[t].buttons=[]),e[t].buttons.push(r)},getAdditionalPropertySettings:function(e){let r=this._parent()||{};var a=this.QueryInterface("VCXIModifiable");let o=this.GetObject()._experienceBase.getManager("VCXScenarioManager"),n=this.GetObject()._experienceBase.getManager("VCXSelectionManager");if(this._pushAdditionalPropertyButton(r,"Actor.PartList.ID",{type:"Clear",tooltip:"Clear value",data:{object:e||n.GetComponentsFromCurrentSelection(),propertiesToClear:["Actor.PartList.ID"]},available:!0}),r["Actor.PartList.ID"].overridePropertyList=["Actor.PartList.ID"],this._pushAdditionalPropertyButton(r,"Actor.PartList.Description",{type:"Clear",tooltip:"Clear value",data:{object:e||n.GetComponentsFromCurrentSelection(),propertiesToClear:["Actor.PartList.Description"]},available:!0}),r["Actor.PartList.Description"].overridePropertyList=["Actor.PartList.Description"],a.GetProperty("Actor.Opacity.Defined")&&a.GetProperty("Actor.Opacity.Defined").GetPropertyValue()){let e=!1,t=["Actor.Opacity","Actor.Opacity.Defined"];for(let r=0;r<t.length;r++)if(o.IsCurrentPropertyDifferentFromNeutral(a,t[r])){e=!0;break}this._pushAdditionalPropertyButton(r,"Actor.Opacity",{type:"Restore",data:{object:this.GetObject(),propertiesToRestore:t},tooltip:"Restore default opacity",available:!0,buttonDisabled:!e})}else r["Actor.Opacity"]={};r["Actor.Opacity"].overridePropertyList=["Actor.Opacity","Actor.Opacity.Defined"],r["Actor.PLM.Material.Choice"]={overridePropertyList:["Actor.Env.Effect","Actor.PLM.Material"],disableLiveChange:500};let s=!1,l=["Actor.Env.Effect","Actor.PLM.Material"];for(let e=0;e<l.length;e++)if(o.IsCurrentPropertyDifferentFromNeutral(a,l[e])){s=!0;break}this._pushAdditionalPropertyButton(r,"Actor.PLM.Material.Choice",{type:"Restore",data:{object:this.GetObject(),propertiesToRestore:l},tooltip:"Restore default material",available:!0,buttonDisabled:!s}),this._pushAdditionalPropertyButton(r,"Actor.PLM.Material.Choice",{functionCB:function(e){e&&e.data&&e.data.object&&i.SearchInApp("[ds6w:type]:dsc_matref_ref_Covering",void 0).then((function(t){if(t&&t.id&&t.label)return e.data.object._experienceBase.getManager("VCXCAT3DXModelManager").InsertMaterial(t.label,null,t.id,[e.data.object])}))},type:"materialAdd",iconName:"material-add",tooltip:"Add a new material to the list",location:3,data:{object:this.GetObject()},available:!0});for(var p,h,d=t.buildGraphicPropertiesStructure(this,null,this.GetObject()._experienceBase.getManager("VCXContextManager").getMainViewer(),{getColor:!0,getMaterial:!0,getOpacity:!0}),c=!1,u=1;u<d.length;u++)d&&d[u].override&&(!h&&d[u].override.Material&&(h=d[u].object),!p&&d[u].override.Opacity&&(p=d[u].object)),d&&d[u].cad&&d[u].cad.material&&(c=!0);return c&&(r["Actor.PLM.Material.Choice"].showUndefined=!0),h&&this._pushAdditionalPropertyButton(r,"Actor.PLM.Material.Choice",{type:"NavigateTo",data:{objectToNavigateTo:h},available:!0}),p&&this._pushAdditionalPropertyButton(r,"Actor.Opacity",{type:"NavigateTo",data:{objectToNavigateTo:p},available:!0}),r},getGroupPropertiesOrders:function(){var e={"Group.Appearance":["Actor.Color","Actor.Color.Defined"],"Group.Highlight":[],"Group.PartList":["Actor.PartList.ID","Actor.PartList.Description"]},t=this._parent()||{};for(const r in e)t[r]=e[r];return t}})}));var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWeb3DMaster/VCXNavigableAssetOccurrenceComposer",["require","exports","DS/WebApplicationBase/VCXAModelNavigable"],(function(e,t,r){"use strict";r=__importDefault(r);class i extends r.default{getAssetNavigable(){return this}}return i})),define("DS/VCXWeb3DMaster/VCXSGNodeHolderAssetOccurrenceComposer",["DS/WebApplicationBase/W3AASGNodeHolder","DS/Visualization/Node3D"],(function(e,t){"use strict";return e.extend({init:function(){},buildSGNode:function(){if(!this._sgNode){this._sgNode=new t({name:"LoadedAsset"}),this._sgNode.productType="Instance3D"}var e=this.QueryInterface("VCXIModelNavigable");if(e){var r=e.getParent();if(r){var i=r.QueryInterface("W3AISGNodeHolder");i&&(i.getSGNode().addChild(this._sgNode),this._pathElement=i.getPathElement().clone(),this._pathElement.addElement(this._sgNode))}}return this._sgNode},isSelfManagedPathElement:function(){return!0}})}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWeb3DMaster/VCXCATE3DGeoVisu",["require","exports","DS/VCXWebComponents/WebExtensionBaseExperience"],(function(e,t,r){"use strict";r=__importDefault(r);class i extends r.default{GetBoundingBox(){return null}GetBoundingSphere(){return null}GetLocalNodes(){this.GetNode()}GetNode(){this.QueryInterface("W3AISGNodeHolder")?.getSGNode()}GetOverride(){}GetPathElement(){this.QueryInterface("W3AISGNodeHolder")?.getPathElement()}Is3DNodeAttachedToSceneGraph(){return!0}RequestVisuRefresh(){}Refresh(){this.QueryInterface("W3AISGNodeHolder")?.update(null)}isReady(){return!0}setReady(){}}return i}));var __decorate=this&&this.__decorate||function(e,t,r,i){var a,o=arguments.length,n=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(n=(o<3?a(n):o>3?a(t,r,n):a(t,r))||n);return o>3&&n&&Object.defineProperty(t,r,n),n};__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWeb3DMaster/VCXComponentOccurrenceComposer",["require","exports","DS/VCXWebSystem/VCXEnums","DS/Visualization/IdPath","DS/Visualization/SceneGraphUtils","DS/SceneGraphOverrides/GenericOverride","DS/Visualization/PrimitiveIterator","DS/Visualization/ThreeJS_DS","DS/Visualization/OccurrenceExplorer","DS/Visualization/MaterialApplication","DS/VCXWebExperienceBase/VCXComponentOccurrenceExt","DS/VCXWebComponents/VCXWebComponentOccurrence","DS/VCXWebSystem/VCXMutex"],(function(e,t,r,i,a,o,n,s,l,p,h,d,c){"use strict";h=__importDefault(h),d=__importDefault(d),c=__importDefault(c),d.default.addDirtyFlags(["EnvID","TextureDocID","TextureProjectionType","TextureProjectionMatrix","TextureUVMatrix","TextureUVscale","TextureUVratio","TextureBlending","TextureTransparency","TextureBorderMode","Geometry"]);class u extends h.default{constructor(){super(),this._bomID="",this._PartListEnabled=!1,this._PartListID="",this._PartListDescription="",this._isRenderable=!1,this._isMesh=!1,this._envID=r.EnvironmentalId.None,this._area=-1,this._volume=-1,this.PLMMaterialID=null,this._MiacAppliedTableOrder=new Map,this._currentMiacApplied=null}IsRenderable(){return this._isRenderable}IsMesh(){return this._isMesh}SetIsRenderable(e){this._isRenderable=e}SetIsMesh(e){this._isMesh=e,e&&(this._isRenderable=!0)}getSharedSceneGraphOverride(e=null,t=!0,r=!1){var a=e;if(!e){var o=this.QueryInterface("W3AISGNodeHolder");a=o?.getPathOfIDs(),a=a?new i(["rootBag",...a.ids]):o?.getPathElement()}return this._experienceBase.getManager("VCXContextManager").getSharedSceneGraphOverride(a,t,r)}getPosition(){const e=this._experienceBase.getManager("VCXContextManager"),t=this.QueryInterface("W3AISGNodeHolder");if(t)return t.getPathOfIDs()&&t.getPathElement()?t.getPathElement().getParentPath().getMatrix(e.getMainViewer()):t.getMatrix(e.getMainViewer());console.error("We shouldn't be here");const r=this.getSharedSceneGraphOverride();return r?r.getPosition():null}getMaterial(){var e=this.getSharedSceneGraphOverride();return e?e._values.fullMaterial&&void 0!==e._values.fullMaterial?e._values.fullMaterial:e.getMaterial():null}setMaterial(e){var t=this.getSharedSceneGraphOverride(null,!0);t&&t.setMaterial(e,!0)}addMiacReplacement(e){this._MiacAppliedTableOrder.set(this._countNumberFather(e),e),this._updateMiacReplacement()}_countNumberFather(e){let t=0,r=e.QueryInterface("VCXIMaterialCache")?.GetParent();for(;r;)t+=1,r=r?.QueryInterface("VCXIModelNavigable")?.getParent()?.GetObject();return t}removeMiacReplacement(e){let t=this._countNumberFather(e),r=this._MiacAppliedTableOrder.get(t);e.GetID()===r?.GetID()&&(this._MiacAppliedTableOrder.delete(t),this._updateMiacReplacement())}_updateApplied(e,t){e&&e.QueryInterface("VCXIMaterialCache")&&(this.getPreviousComponentID&&e.QueryInterface("VCXIMaterialCache")?.removeComponentFromWhereApplied(this.getPreviousComponentID()),e.QueryInterface("VCXIMaterialCache")?.removeComponentFromWhereApplied(this.GetID())),t&&t.QueryInterface("VCXIMaterialCache")&&t.QueryInterface("VCXIMaterialCache")?.addComponentFromWhereApplied(this.GetID())}_updateMiacReplacement(){let e=Array.from(this._MiacAppliedTableOrder.keys()).sort();if(e.length){let t=e[e.length-1],r=this._MiacAppliedTableOrder.get(t);if(!r)throw new Error("Unsupported Case");this._applyMaterialOverride(r)}else this._applyMaterialOverride(null)}async _applyMaterialOverride(e){let t=e?.QueryInterface("VCXIModifiable")?.GetProperty("ContextualMaterial.Delegation")?.GetPropertyValue()?.GetValue()??null;this._updateApplied(this._experienceBase.ComponentsMap.GetComponentFromID(this._currentMiacApplied??this.originalMaterial),this._experienceBase.ComponentsMap.GetComponentFromID(t??this.originalMaterial)),this._currentMiacApplied=t;let r=null;e&&(r=await(e?.QueryInterface("VCXIMaterialCache")?.getMaterialVisu())??null),this.setMaterial(r)}getColor(){var e=this.getSharedSceneGraphOverride();return e?e.getColor():null}setColor(e,t=null){var r=this.getSharedSceneGraphOverride(null,!0);r&&r.setColor(e,t)}getOpacity(){var e=this.getSharedSceneGraphOverride();return e?e.getOpacity():null}setOpacity(e,t=null){var r=this.getSharedSceneGraphOverride(null,!0);r&&r.setOpacity(e,t)}getVisibility(){var e=this.getSharedSceneGraphOverride();return e?e.getVisibility():null}setVisibility(e,t=null){var r=this.getSharedSceneGraphOverride(null,!0);r&&r.setVisibility(e,t),this._experienceBase.getManager("VCXContextManager").partHasMoved=!0}setPickability(e){var t=this.getSharedSceneGraphOverride(null,!0);t&&t.setPickability(e)}setPosition(e){var t=this.getSharedSceneGraphOverride(null,!0);t&&t.setPosition(e),this._experienceBase.getManager("VCXContextManager").partHasMoved=!0}getRenderPriority(){return this._priority}setRenderPriority(e,t=null){this._priority=e;const r=this.QueryInterface("W3AISGNodeHolder");if(r&&r.getPathElement()){var i=this._experienceBase.getManager("VCXContextManager");i&&a.setRenderPriority(r.getPathElement(),this._priority,i.getMainViewer())}else console.warn("Object "+(r&&r.getPathOfIDs().ids.join(",")||"")+" has no PE yet")}getRenderOpacity(){return this._layerOpacity}setRenderOpacity(e,t=null){this._layerOpacity=e;const r=this.QueryInterface("W3AISGNodeHolder");if(r&&r.getPathElement()){var i=this._experienceBase.getManager("VCXContextManager");i&&a.setRenderPriorityOpacity(r.getPathElement(),this._layerOpacity,i.getMainViewer())}else console.warn("Object "+(r&&r.getPathOfIDs().ids.join(",")||"")+" has no PE yet")}HasMaterialOverrideToApply(){return!!this.GetObject()._experienceBase.getManager("VCXContextManager").isSupported("FullFeaturesOnNodes")||!!this.IsMesh()&&(this.PLMMaterialID&&this._envID===r.EnvironmentalId.PLM||this._envID||this.renderingMode>2)}HasColorOverrideToApply(){if(this.GetObject()._experienceBase.getManager("VCXContextManager").isSupported("FullFeaturesOnNodes"))return this.localColorIsDefined;if(!this.IsMesh())return!0;var e=!1;switch(this._envID){case r.EnvironmentalId.PLM:e=!1;break;case r.EnvironmentalId.None:e=!0;break;default:e=!1}return e}HasOpacityOverrideToApply(){return!0}UpdateLocalMaterial(){(this.IsMesh()||this.GetObject()._experienceBase.getManager("VCXContextManager").isSupported("FullFeaturesOnNodes"))&&(!1===this.HasMaterialOverrideToApply()?this._localMaterial=null:this._localMaterial=this._PLMMaterial,this._dirtyMask&=~u.maskMaterialParamsDirty)}OverrideAlpha(e,t,r){var i=this.getSharedSceneGraphOverride(t,!0);i&&i.setOpacity(this.HasOpacityOverrideToApply()?e:null,r)}OverrideVisibility(e,t,r){const i=this.getSharedSceneGraphOverride(t,!0);i&&i.setVisibility(e,r);const a=this.getSharedSceneGraphOverride(t,!0,!0);a&&a.setVisibility(e,r),this._experienceBase.getManager("VCXContextManager").partHasMoved=!0}OverrideColor(e,t,r){if(this.HasColorOverrideToApply()){var i=this.getSharedSceneGraphOverride(t,!0);i&&(e?i.setColor(e,r):i.resetColor())}}OverrideMaterial(e,t,r,i){var a=this.getSharedSceneGraphOverride(r,!0);if(a){var n=this.HasMaterialOverrideToApply()?e:null;if(this._experienceBase.getManager("VCXContextManager").isSupported("MaterialManagementV2")&&(i=!0),n?a.setMaterial(new p({faceMaterial:n}),i):a.setMaterial(null,i),this.HasColorOverrideToApply()){var s=null;t?s=t:this.localColor&&(!0===this.localColorIsDefined||this.HasMaterialOverrideToApply()&&e)&&(s=this.localColor),a.setColor(s,i)}else n?a.setColor(o.NO_COLOR,i):a.setColor(null,i)}}GetCurrentMaterial(e=!0){let t=this.PLMMaterialID&&this._experienceBase.ComponentsMap.GetComponentFromID(this.PLMMaterialID);if(t)return t;if(this.originalMaterial&&(this._experienceBase.getManager("VCXContextManager").isSupported("MIAC")||e))return this._experienceBase.ComponentsMap.GetComponentFromID(this._currentMiacApplied??this.originalMaterial);if(!this._experienceBase.getManager("VCXContextManager").isSupported("MaterialManagementV2"))return;let r=this.QueryInterface("VCXIModelNavigable")?.getParent()?.GetObject(),i=(r&&r.GetCurrentMaterial&&r.GetCurrentMaterial())??null;return i||null}OverrideRenderingMode(e,t,r,i){var a=this.getSharedSceneGraphOverride(t,!0);if(a){var o=this._experienceBase.getManager("VCXMaterialManager");if(o){var n=null;switch(e){case d.default.ERenderingMode.Custom:n=o.getRenderStyle(this.renderingMode,d.default.EOutlineType.Smart,i);break;case d.default.ERenderingMode.SmoothOutline:case d.default.ERenderingMode.Technical:case d.default.ERenderingMode.FlatTechnical:case d.default.ERenderingMode.Silhouette:var s=2,l=this._experienceBase.getManager("VCXContextManager").getActiveViewport();l&&(s=l.QueryInterface("VCXIModifiable")?.GetPropertyValue("Render.OutlineType")),n=o.getRenderStyle(e,s,i)}a.setRenderStyle(n,r)}}}debugVisu(){function e(e,t){var r,i,a,o,s=n._authorizedTeamsOnly_getKey();for(r=e.getMesh3D(),o=t.getLastElement(!0)===r?t:r,i=new n(o,s),a=0;a<i.getNbPrimitives();a++)console.log(i.getGas(a)._alpha);return[]}var t=this._experienceBase.getManager("VCXContextManager"),r=new l(t.getMainViewer()),i=this.QueryInterface("W3AISGNodeHolder"),a=i?.getPathElement();r.explore((function(t){var r,i,o=(i=t.getOccurrenceItf(a)).getRenderableDescendants();for(r=0;r<o.length;r++)(i=o[r]).getVisibility()&&e(i,a)}))}get bomID(){return this._bomID}set bomID(e){this._bomID=e}get PartListDescription(){return this._PartListDescription}set PartListDescription(e){this._PartListDescription=e}get PartListID(){return this._PartListID}set PartListID(e){this._PartListID=e}get PartListEnabled(){return this._PartListEnabled}set PartListEnabled(e){this._PartListEnabled=e}get DefaultHighlightData(){return{Enabled:!1,polite:!0,priority:-1,colorEnabled:!0,color:new s.Color(16703488),intensity:1,visibleAlpha:.6,occludedAlpha:.15,haloEnabled:!0,haloColor:new s.Color(16703488),lineicHaloColor:new s.Color(16703488),haloIntensity:2,haloThickness:4,outlineEnabled:!1,outlineColor:new s.Color(16703488),lineicOutlineColor:new s.Color(16703488),outlineAlpha:1,outlineThickness:1}}get HighlightData(){return this._highlightData}set HighlightData(e){let t=this.QueryInterface("VCXIModelNavigable"),r=0;for(;t;)t=t.getParent(),r++;e.priority=-r,this._highlightData=e,this._dirtyMask|=d.default.FDirty.Highlight}get PLMMaterial(){return this._PLMMaterial}set PLMMaterial(e){this._PLMMaterial=e,this._dirtyMask|=d.default.FDirty.Material|d.default.FDirty.Color|d.default.FDirty.Alpha}}return u.mask=d.default.FDirty.Alpha|d.default.FDirty.Color|d.default.FDirty.Material|d.default.FDirty.Visibility|d.default.FDirty.RenderingMode,u.maskMaterialParamsDirty=d.default.FDirty.TextureDocID|d.default.FDirty.TextureProjectionType|d.default.FDirty.TextureProjectionMatrix|d.default.FDirty.TextureUVMatrix|d.default.FDirty.TextureUVscale|d.default.FDirty.TextureUVratio|d.default.FDirty.TextureBlending|d.default.FDirty.TextureTransparency|d.default.FDirty.TextureBorderMode,__decorate([c.default.RunExclusive],u.prototype,"_applyMaterialOverride",null),Object.defineProperty(u.prototype,"componentType",{enumerable:!0,get:()=>"VCXComponentOccurrenceComposer"}),u}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("DS/VCXWeb3DMaster/VCXComponentAssetOccurrenceComposer",["require","exports","DS/VCXWeb3DMaster/VCXComponentOccurrenceComposer"],(function(e,t,r){"use strict";r=__importDefault(r);class i extends r.default{constructor(){super(),this._nodeID=null,this._assetID=null,this._eType=0,this._bIsLoaded=!1}SetAssetID(e){this._assetID=e}GetAssetID(){return this._assetID}SetNodeID(e){this._nodeID=e}GetNodeID(){return this._nodeID}SetAssetType(e){this._eType=e}GetAssetType(){return this._eType}SetIsLoaded(e){this._bIsLoaded=e}IsLoaded(){return this._bIsLoaded}}return Object.defineProperty(i.prototype,"componentType",{enumerable:!0,get:function(){return"VCXComponentAssetOccurrenceComposer"}}),i})),define("DS/VCXWeb3DMaster/VCXModifiableAssetOccurrenceComposer",["DS/VCXWeb3DMaster/VCXModifiableOccurrenceComposer","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyInfoEnum","DS/Visualization/ModelLoader","DS/CoreEvents/Events","UWA/Utils","i18n!DS/VCXWeb3DMaster/assets/nls/VCXWeb3DMaster"],(function(e,t,r,i,a,o,n,s,l,p){"use strict";return e.extend({init:function(){this._parent()},OnChangeProperty:function(e,t,r){if(r||(r={}),r.fromChildClass);else if(this.OnChangePropertyBegin(e,t))return!0;if(r.fromChildClass=!0,!this._parent(e,t,r))switch(e){case"Actor.NodeID":var i=this.GetObject(),a=t.GetValue();i.GetNodeID()!==a&&i.SetNodeID(a);break;case"Actor.AssetID":i=this.GetObject(),a=t.GetValue();i.GetAssetID()!==a&&i.SetAssetID(a);break;case"Actor.AssetType":i=this.GetObject(),a=t.GetValue();i.GetAssetType()!==a&&i.SetAssetType(a);break;default:return!1}return!0},OnChangePropertiesEnd:function(){if(this._parent(),!this.GetObject().IsLoaded()){var e=this.GetObject();e.SetIsLoaded(!0);var t=e.GetAssetID(),r=this.QueryInterface("W3AISGNodeHolder").getSGNode(),i=t.split(".")[0];if(e.GetNodeID());else{var a=i+"-"+l.getUUID().substr(0,18);e.SetNodeID(a)}if(e.name=i,r.setName(e.GetNodeID()),e.name=i,e._experienceBase._mapAssetsBlob){var o=e._experienceBase._mapAssetsBlob[t],p=e.GetAssetType();if(o&&0===p){var h=e._experienceBase.getManager("VCXContextManager").getMainViewer(),d=new n(h.getWebGLContext(),!1);d.setFileType("xmlv43");let t=new Promise((t=>{d.setOnLoadedCallback((()=>{s.publish({event:"VCX_ASSET_LOADED",data:e}),t()})),d.loadModel(o,r)}));this.QueryInterface("VCXIReadiness").registerPromise(t)}else if(o&&1===p){let t=new Promise((t=>{require(["DS/VCXWebInteropSMG/VCXSmgGeomLoader"],(function(i){i&&new i(e._experienceBase).LoadAsModel(o,r,(function(){s.publish({event:"VCX_ASSET_LOADED",data:e}),t()}))}))}));this.QueryInterface("VCXIReadiness").registerPromise(t)}}}},GetProperty:function(e){if("Actor.NodeID"===e)return(n=new t).SetValue(this.GetObject().GetNodeID()),new i(new a(e,0,!0,p),n);if("Actor.AssetID"===e)return(n=new t).SetValue(this.GetObject().GetAssetID()),new i(new a(e,0,!0,p),n);if("Actor.AssetType"===e){var n;(n=new r).SetValue(this.GetObject().GetAssetType());var s=new o(e,1,!0,p);return s.AddOrModifyChoice(0,"AssetType.3dxml"),s.AddOrModifyChoice(1,"AssetType.smgGeom"),new i(s,n)}return this._parent(e)},GetProperties:function(){var e=this._parent();return e.AddOrModifyProperty(this.GetProperty("Actor.NodeID")),e.AddOrModifyProperty(this.GetProperty("Actor.AssetID")),e.AddOrModifyProperty(this.GetProperty("Actor.AssetType")),e}})}));