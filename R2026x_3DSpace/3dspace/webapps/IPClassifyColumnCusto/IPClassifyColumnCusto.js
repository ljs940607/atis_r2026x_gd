define("DS/IPClassifyColumnCusto/WizardSteps",["text!DS/IPClassifyColumnCusto/assets/templates/WizardSteps.html","css!DS/IPClassifyColumnCusto/IPClassifyColumnCusto.css","i18n!DS/IPClassifyColumnCusto/assets/nls/IPClassifyColumnCusto","UWA/Core","UWA/Controls/Abstract","DS/Handlebars/Handlebars","DS/Core/Core","css!DS/UIKIT/UIKIT.css"],(function(e,t,n,o,i,s,a,l){"use strict";var r=s.compile(e);return s.registerHelper("getlabel",(function(e){for(var t=require("i18n!"+this.label.file),n=this.label.key.split("."),o=t,i=0;i<n.length;i++)o=o[n[i]];return o})),i.extend({name:"ip-enx-wizard-container",defaultOptions:{subscribeTokens:[],modelEvents:null,renderTo:null,steps:null,activeStep:null},init:function(e){this._parent(e),this.elements.container=o.createElement("div",{class:this.getClassNames()}),this.options.steps&&this.elements.container.setContent(r(this.options.steps)),this.options.renderTo&&this.elements.container.inject(this.options.renderTo),this.options.rope=this.elements.container.getElement("div.ip-enx-wizard-rope"),this.options.navigator=this.elements.container.getElement("nav.ip-enx-view-navigator");var t=this.elements.container.getElement("a.nav-item.active");if(t){var n=t.id;this._render2ActiveStep(n)}for(var i=this,s=this.options.navigator.getElements("a"),a=0;a<s.length;a++)s[a].addEventListener("click",(function(e){var t=e.currentTarget.id;i.changeStep(t)}));this.options.subscribeTokens.push(this.options.modelEvents.subscribe({event:"IPClassifyColumnCusto/WizardSteps/changeStep"},(function(e){var t=e.stepId;i.changeStep(t)})))},changeStep:function(e){this._render2ActiveStep(e),this.options.modelEvents.publish({event:"IPClassifyColumnCusto/WizardSteps/stepChanged",data:{stepId:e}})},destroy:function(){for(var e=0;e<this.options.subscribeTokens.length;e++)this.options.modelEvents.unsubscribe(this.options.subscribeTokens[e]);this._parent()},_render2ActiveStep:function(e){for(var t,n=this.options.navigator.getElements("a"),o=!1,i=0;i<n.length;i++){var s=n[i];if(!1===o?s.removeClassName("filled").addClassName("filled"):s.removeClassName("filled"),s.id===this.options.activeView&&s.removeClassName("active"),s.id===e){s.addClassName("active");s.getElement(".view-icon.enx-icon");var a="100%";i<n.length-1&&(a=Math.floor(100/(n.length+1))*(i+1)+"%"),this.options.rope.setStyles({width:a,height:"2px"}),t=s.id,o=!0}}this.options.activeView=t}})})),define("DS/IPClassifyColumnCusto/IPClassifyColumnCusto",["css!DS/IPClassifyColumnCusto/IPClassifyColumnCusto.css","i18n!DS/IPClassifyColumnCusto/assets/nls/IPClassifyColumnCusto","DS/PADServices/views/private/Iconbar","DS/PADServices/views/private/ComboSelector","css!DS/UIKIT/UIKIT","UWA/Core","UWA/Controls/Abstract","DS/Controls/Button","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/TreeModel/DataModelSet","DS/Controls/Toggle","DS/DataGridView/DataGridView","DS/DataGridView/DataGridViewLayout","DS/PADServices/utils/PlatformURL","DS/Utilities/Dom","DS/IPClassifyUtil/IPClassifyUtility","DS/IPClassifyUtil/IPClassifyAlert","DS/WidgetServices/WidgetServices"],(function(e,t,n,o,i,s,a,l,r,d,c,u,p,m,h,f,b,v,g){"use strict";var C=["selection","hide_show","ds6w:label-Instance","positionMatrix-Instance","thumbnail"],y=["bi_color","selection","hide_show","thumbnail"],I=!1,w=!0;function x(e){var t=!0;return(-1!==y.indexOf(e)||!1===I&&-1!==["ds6w:label-Instance","positionMatrix-Instance"].indexOf(e))&&(t=!1),t}var M={properties:[function(){return{property:"label",value:this.options.grid.attrTitle}},function(){var e={property:"text",value:void 0};return(void 0===this.options.grid.hasTitle||this.options.grid.hasTitle)&&(e.value=this.options.grid.attrTitle),e},function(){return{property:"dataIndex",value:this.options.grid.attrName}},function(){return{property:"classif",value:this.options.grid.classif}},function(){return{property:"multiline",value:this.options.grid.multiline}},function(){return{property:"attrDBName",value:this.options.grid.attrDBName}},function(){var e;if("positionMatrix-Instance"===this.options.grid.attrName)e="matrixtxt";else e=this.options.grid.attrName;return{property:"ds6w",value:e}},function(){return{property:"hasNLS",value:void 0===this.options.grid.hasTitle||this.options.grid.hasTitle}},function(){return{property:"noTitleColumn",value:void 0!==this.options.grid.hasTitle&&!this.options.grid.hasTitle}},function(){return{property:"kind",value:this.options.kind}},function(){return{property:"ds6wFrom",value:"Instance"===this.options.grid.attrInstRef?"rel":this.options.grid.attrDBName?this.options.grid.attrInstRef:void 0}},function(){return{property:"convertInfos",value:this.options.grid.convertInfos}}]};function A(e,t){for(var n=0;n<e.length;n++){var o=e[n];if(o.dataIndex===t)return o;if(o.xnav_options&&o.xnav_options.name===t)return o}}return a.extend({name:"ip-attr-customization",columnOrdering:!0,defaultOptions:{moreColumnsBtn:!0,renderTo:null,modelEvents:null,subscribeTokens:[],modelSubscribeTokens:[],compactMode:!1,applyOnlyToThisApp:!1,baseTypes:[],selectedTypes:[],selectedExtensions:[],defaultTypes:[],defaultExtensions:[],defaultAttributes:[],supportedIndexAttrs:[],rowHeaderActivated:!0,thumbnailsActivated:!1,pinModel:{},dgvOptions:{defaultColumnDef:{width:"auto",typeRepresentation:"string"},showRowIndexFlag:!1,showRowBorderFlag:!0,showAlternateBackgroundFlag:!1,rowSelection:"multiple",cellSelection:"none",selectionBehavior:{canInteractiveMultiselectWithCheckboxClick:!0,canMultiSelect:!0,enableFeedbackForActiveCell:!0,enableShiftSelection:!0,toggle:!1,unselectAllOnEmptyArea:!0},columns:[{icon:{iconName:"eye",fontIconFamily:1},tooltip:t.attributesCustomization.attrVisible,dataIndex:"attrVisible",typeRepresentation:"boolean",alignmentValue:"center",alwaysVisibleFlag:!0,width:30,editableFlag:!0,editionPolicy:"EditionInPlace",sortableFlag:!1,resizableFlag:!1,getCellEditableState:function(e){var t=!0;return e.nodeModel.options.grid.layout&&void 0!==e.nodeModel.options.grid.layout.removableFromView?t=e.nodeModel.options.grid.layout.removableFromView:!0===e.nodeModel.options.pinColumn&&(t=!1),t},getCellTypeRepresentation:function(e){return e.nodeModel&&!0===e.nodeModel.options.pinColumn?"string":"boolean"}},{dataIndex:"tree",text:t.attributesCustomization.attrTitle,typeRepresentation:"string",editableFlag:!1,editionPolicy:"EditionOnDoubleClick",sortableFlag:!1,resizableFlag:!1,getCellEditableState:function(e){var t=!0;return e.nodeModel?!0===I?-1===y.indexOf(e.nodeModel.options.columnIndex)&&!0!==e.nodeModel.options.pinColumn&&!0!==e.nodeModel.options.grid.isAdditionalColumn||(t=!1):-1===C.indexOf(e.nodeModel.options.columnIndex)&&!0!==e.nodeModel.options.pinColumn&&!0!==e.nodeModel.options.grid.isAdditionalColumn||(t=!1):t=!1,t}},{icon:{iconName:"pin",fontIconFamily:1},dataIndex:"pinContent",typeRepresentation:"pin",alignmentValue:"center",alwaysVisibleFlag:!0,width:100,editableFlag:!0,editionPolicy:"EditionInPlace",sortableFlag:!1,resizableFlag:!1,getCellEditableState:function(e){var t=!0;return e.nodeModel.options.grid.layout&&void 0!==e.nodeModel.options.grid.layout.pinEditable?t=e.nodeModel.options.grid.layout.pinEditable:!0===e.nodeModel.options.pinColumn&&(t=!1),t}},{icon:{iconName:"export",fontIconFamily:1},dataIndex:"exportContent",typeRepresentation:"boolean",alignmentValue:"center",alwaysVisibleFlag:!0,width:30,editableFlag:!0,editionPolicy:"EditionInPlace",sortableFlag:!1,resizableFlag:!1,getCellEditableState:function(e){var t=void 0!==e.nodeModel.options.grid.exportLock&&!e.nodeModel.options.grid.exportLock;return!0===e.nodeModel.options.pinColumn&&(t=!1),t},getCellTypeRepresentation:function(e){return e.nodeModel&&!0===e.nodeModel.options.pinColumn?"string":"boolean"},getCellSemantics:function(e){var t=void 0!==e.nodeModel.options.grid.exportLock&&e.nodeModel.options.grid.exportLock;return!0===e.nodeModel.options.pinColumn&&(t=!0),{disabled:t}}},{icon:{iconName:"trash",fontIconFamily:1},dataIndex:"attrRemove",alignmentValue:"center",alwaysVisibleFlag:!0,width:30,sortableFlag:!1,resizableFlag:!1,editableFlag:!1,getCellTypeRepresentation:function(e){return e.nodeModel&&!0===e.nodeModel.options.pinColumn?"string":e.nodeModel&&(!0===e.nodeModel.options.grid.isAdditionalColumn||e.nodeModel.options.grid.layout&&!1===e.nodeModel.options.grid.layout.removable)?"actionNotRemove":"actionRemove"},getCellSemantics:function(e){if(e.nodeModel&&(!0===e.nodeModel.options.grid.isAdditionalColumn||e.nodeModel.options.grid.layout&&!1===e.nodeModel.options.grid.layout.removable))return{disabled:!0}}}]},dgvLayoutOptions:{cellHeight:28,columnHeaderHeight:38,rowsHeader:!0}},init:function(e){this._parent(e);var n=this,o=g.isWebInWinEnvironment()?"-immersivePanelWebInWin":"-immersivePanel";n.elements.container=s.createElement("div",{class:n.getClassNames(o)+" ip_columnCustomization"}),h.retrievePlatformUrl({addDefaults:!0,initWSAcess:!0}).then((function(){I=!!(n.options.baseInstanceTypes&&n.options.baseInstanceTypes.length>0),n.options.allowedIndexAttributes=new Set(n.options.allowedIndexAttributes),w=n.options.manageAttrFromInstance,n._buildBody(),n._buildFooter(),n.elements.panel2small=s.createElement("div",{class:n.getClassNames("-panel2small"),text:t.attributesCustomization.panel2small}).inject(n.elements.container),n.options.modelEvents.publish({event:"IPClassifyColumnCusto/Views/showInWidgetBody",data:{idView:"customize",title:t.attributesCustomization.apptitle,html:n.elements.container}})}))},destroy:function(){for(var e=0;e<this.options.subscribeTokens.length;e++)this.options.modelEvents.unsubscribe(this.options.subscribeTokens[e]);this.options.toolbar.destroy(),this.options.grid.destroy(),this.options.grid=null,this._parent()},_buildBody:function(){this._buildIconBar(),this.elements.dgv=s.createElement("div",{class:this.getClassNames("-dgv")}).inject(this.elements.container);var e=this.options.dgvOptions;!0!==this.options.withDgv&&e.columns.splice(2,1);var n=s.extend({identifier:"DataGridView-attrCusto-"+(65536*(1+Math.random())|0).toString(16).substring(1)},this.options.dgvOptions);n.layout=new m(this.options.dgvLayoutOptions);var i=this.options.grid=new p(n);i.onContextualEvent=function(){return[]},i.getCellTooltip=function(e){var n=this.options.grid.getColumnOrGroup(e.columnID);if(!n)return null;let o=n.dataIndex;return e.dataIndex=o,-1===e.rowID?{shortHelp:t.attributesCustomization[o],updateModel:!1}:"tree"===o&&e.nodeModel&&!0!==e.nodeModel.getReferenceValue("isAdditionalColumn")?!0===h.instanceMgtActivated?{shortHelp:t.replace(t.attributesCustomization.tooltipColName,{label:e.nodeModel.getLabel(),instRef:t.attributesCustomization[e.nodeModel.getReferenceValue("attrInstRef")]}),updateModel:!1}:{shortHelp:e.nodeModel.getLabel(),updateModel:!1}:void 0}.bind(this);var a={actionRemove:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"trash",fontIconFamily:WUXManagedFontIcons.Font3DS}}},actionNotRemove:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"block",fontIconFamily:WUXManagedFontIcons.Font3DS}}}},l={};l[t.attributesCustomization.pinLeft]="left",l[t.attributesCustomization.pinRight]="right",l[t.attributesCustomization.unpinned]="unpinned";var c={pin:{stdTemplate:"enumCombo",semantics:{possibleValues:l,valueType:"enumCustom"}}};i.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(c)),i.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(a));var h=this;this.options.attrModel=new r({shouldBeSelected:function(e){return!0!==e.options.pinColumn}}),i.treeDocument=this.options.attrModel,i.getContent().addClassName("enxdatagridview"),i.getContent().inject(this.elements.dgv);h=this;i.onReady((function(){i.addEventListener("change",h._cellModified.bind(h)),i.addEventListener("click",h._cellClicked.bind(h)),h.options.toolbar.show()})),this._addColumns(),this.options.attrModel.getXSO().onPostAdd(this._manageAttrSelection.bind(this)),this.options.attrModel.getXSO().onPostRemove(this._manageAttrSelection.bind(this)),this.options.attrModel.getXSO().onEmpty(this._manageAttrSelection.bind(this)),this.options.modelSubscribeTokens.push(this.options.attrModel.getModelEvents().subscribe({event:"addChild"},(function(e){!0!==h._isMoving&&!0!==h._globalUpdate&&h.options.modelEvents.publish({event:"IPClassifyColumnCusto/AttributesCustomization/columnModification",data:{what:"addRemoveColumns",addedColumns:[e.data.nodeModel.dump(M)]}})}))),this.options.modelSubscribeTokens.push(this.options.attrModel.getModelEvents().subscribe({event:"removeChild"},(function(e){if(!0!==h._isMoving&&!0!==h._globalUpdate){var t=e.data.nodeModel.getReferenceValue("attrName");-1!==C.indexOf(t)&&("thumbnail"!==t||b.isTouchDevice()||h.elements.comboCompact.disabled(!1)),h.options.modelEvents.publish({event:"IPClassifyColumnCusto/AttributesCustomization/columnModification",data:{what:"addRemoveColumns",removedColumns:[e.data.nodeModel.dump(M)]}})}}))),this.elements.behavior=s.createElement("div",{class:this.getClassNames("-behavior")}).inject(this.elements.container);var f=new r,v=new d({viewMode:"comfortable",label:t.attributesCustomization.comfortable,subLabel:t.attributesCustomization.comfortableExplanation,children:null,icons:[{iconName:"view-big-tile",fontIconFamily:WUXManagedFontIcons.Font3DS}]});f.addRoot(v);var g=new d({viewMode:"compact",label:t.attributesCustomization.compact,subLabel:t.attributesCustomization.compactExplanation,children:null,icons:[{iconName:"view-list",fontIconFamily:WUXManagedFontIcons.Font3DS}]});f.addRoot(g);var y=1===this.options.attrModel.getRoots().filter((function(e){return"thumbnail"===e.getReferenceValue("attrName")})).length;"compact"!==this.options.viewMode||!1!==y||b.isTouchDevice()?v.select(!0):g.select(!0);var I=y||b.isTouchDevice();this.elements.comboCompact=new o({className:this.getClassNames("-compactmode-selector"),treedocument:f,disabled:I,events:{onSelectionChange:function(){var e=f.getSelectedNodes()[0].options.viewMode;h.options.modelEvents.publish({event:"IPClassifyColumnCusto/AttributesCustomization/columnModification",data:{what:"changeViewMode",viewMode:e}})}}});var w=s.createElement("div",{class:this.getClassNames("-compactmode-global")});s.createElement("div",{class:this.getClassNames("-compactmode-label"),text:t.attributesCustomization.density}).inject(w),this.elements.comboCompact.inject(w),w.inject(this.elements.behavior),this.elements.applyToggle=new u({label:t.attributesCustomization.apply_to_this_app});var x=s.createElement("div",{class:this.getClassNames("-applytothisapp"),content:this.elements.applyToggle});if(this.elements.applyToggle.addEventListener("change",(function(e){var t=e.dsModel;h.options.applyOnlyToThisApp=t.checkFlag,h.options.modelEvents.publish({event:"IPClassifyColumnCusto/AttributesCustomization/applyOnlyToThisApp",data:{applyOnlyToThisApp:h.options.applyOnlyToThisApp}})})),x.inject(this.elements.behavior),this.options.enableDynamicAttributesPos){this.elements.applydynamicAttributesToggle=new u({label:this.options.dynamicAttrCheckBoxName,checkFlag:this.options.dynamicAttrCheckBoxValue});var A=s.createElement("div",{class:this.getClassNames("-dynamicCheckBox"),content:this.elements.applydynamicAttributesToggle});this.elements.applydynamicAttributesToggle.addEventListener("change",(function(e){var t=e.dsModel.checkFlag;h.options.dynamicAttributesTop=t;var n=h.options.attrModel.getRoots().filter((function(e){return e.options.grid.isDynamic}));if(t)for(let e=0;e<n.length;++e)h._moveColumn("moveFirst",[n[e]]);else for(let e=n.length-1;e>=0;--e)h._moveColumn("moveLast",[n[e]])})),A.inject(this.elements.behavior),this.elements.behavior.setStyle("grid-template-columns","50% auto auto auto")}},_buildFooter:function(){var e=this,n=s.createElement("div",{class:e.getClassNames("-footer")}).inject(e.elements.container),o=new l({label:t.attributesCustomization.close,emphasize:"primary",touchMode:!0});o.addEventListener("click",(function(){e._closePanel(),e.destroy()})),o.inject(n);var i=new l({label:t.attributesCustomization.reset,touchMode:!0});i.addEventListener("click",(function(){e._manageThumbnailAttribute("thumbnail",!1),e.options.modelEvents.publish({event:"IPClassifyColumnCusto/AttributesCustomization/columnModification",data:{what:"reset",applyOnlyToThisApp:e.options.applyOnlyToThisApp}}),e.options.modelEvents.publish({event:"IPClassifyColumnCusto/Views/showInWidgetBody",data:{restore:!0}}),e.destroy()})),i.inject(n)},_closePanel:function(){var e=[];this.options.attrModel.getRoots().forEach((function(t){e.push(t.dump(M))}));let t={what:"close",selectedTypes:this.options.selectedTypes,selectedExtensions:this.options.selectedExtensions,selectedAttributes:e,applyOnlyToThisApp:this.options.applyOnlyToThisApp};this.options.enableDynamicAttributesPos&&(t.dynamicAttributesTop=this.options.dynamicAttributesTop),this.options.modelEvents.publish({event:"IPClassifyColumnCusto/AttributesCustomization/columnModification",data:t}),this.options.modelEvents.publish({event:"IPClassifyColumnCusto/Views/showInWidgetBody",data:{restore:!0}})},_addColumns:function(){var e=this;void 0===this.options.appColumns?console.error("AttributesCustomization## Invalid input. Missing property appColumns"):e.options.attrModel.withTransactionUpdate((function(){for(var t=0;t<e.options.appColumns.length;t++){var n=e.options.appColumns[t];if("bi_color"!==n.dataIndex){var o=s.is(n.text,"string")&&n.text.length>0?n.text:e._retrieveColumnName(n.dataIndex),i=!n.customisation||!n.customisation.exportable||n.customisation.exportable.value,a=!(!n.customisation||!n.customisation.exportable)&&n.customisation.exportable.lock,l=n.customisation&&n.customisation.layout?n.customisation.layout:{},r=n.pinned?n.pinned:"unpinned",c=void 0!==n.visibleFlag?n.visibleFlag:!n.isHidden;!0!==e.options.withDgv&&(c=!n.isHidden);var u,p=n.ds6wFrom&&"rel"===n.ds6wFrom?"Instance":n.attrDBName?n.ds6wFrom:"Reference";n.isAdditionalColumn&&(p="AdditionalColumn"),!0===I?"Reference"===p?u=[{iconName:"product"}]:"Instance"===p?u=[{iconName:"flow-cascade"}]:"AdditionalColumn"===p&&(u=[{iconName:"attributes-add"}]):u=n.hasOwnProperty("icon")?[n.icon]:void 0;var m=n.ds6w&&"rel"!==n.ds6wFrom?n.ds6w:n.dataIndex,h=new d({columnIndex:n.dataIndex,label:o,icons:u,grid:{attrTitle:o,attrVisible:c,exportContent:i,exportLock:a,attrName:m,attrDBName:n.attrDBName,isAdditionalColumn:n.isAdditionalColumn,layout:l,pinContent:r,attrRemove:!0,attrInstRef:p,attrAlert:null,isDynamic:!!n.isDynamic},children:null});e.options.attrModel.addChild(h)}}e.options.attrModel.expandAll()}))},_cellModified:function(e,n){if(n&&n.nodeModel&&n.nodeModel.options.grid)switch(this.options.grid.layout.getDataIndexFromColumnIndex(n.columnID)){case"attrVisible":this.options.modelEvents.publish({event:"IPClassifyColumnCusto/AttributesCustomization/columnModification",data:{what:"visibilityColumn",modifiedColumn:n.nodeModel.options.columnIndex,visibilityFlag:n.nodeModel.getReferenceValue("attrVisible")}});break;case"tree":0==n.nodeModel.getLabel().length?(n.nodeModel.options.label=n.nodeModel.options.grid.attrTitle,v.displayNotification({title:t.msg_warning_BlankHeaderNotAllowed.Title,subtitle:t.replace(t.msg_warning_BlankHeaderNotAllowed.Advice),className:"warning"})):this.options.modelEvents.publish({event:"IPClassifyColumnCusto/AttributesCustomization/columnModification",data:{what:"changeTitle",modifiedColumn:n.nodeModel.options.columnIndex,newTitle:n.nodeModel.getLabel()}});break;case"exportContent":this.options.modelEvents.publish({event:"IPClassifyColumnCusto/AttributesCustomization/columnModification",data:{what:"exportColumn",modifiedColumn:n.nodeModel.options.columnIndex,exportFlag:n.nodeModel.getReferenceValue("exportContent")}});break;case"pinContent":var o=this,i=n.nodeModel.getReferenceValue("pinContent"),s=n.nodeModel.options.columnIndex;o.options.attrModel.withTransactionUpdate((()=>{o._globalUpdate=!0,this.options.modelEvents.publish({event:"IPClassifyColumnCusto/AttributesCustomization/columnModification",data:{what:"pinChange",modifiedColumn:s,pin:i}}),this._refreshColumnsList(),n.nodeModel.select(),delete o._globalUpdate}))}},_refreshColumnsList:function(){var e=this.options.attrModel.getRoots(),t={};e.forEach((e=>{t[e.options.columnIndex]=e}));for(var n=this.options.dgvInfo,o=n.options.dgvLayout.getOrderedColumnsIndexes(),i=o.length-1;i>=0;i--){var s=n.options.dgv.getColumnOrGroup(o[i]);if(s){var a=t[s.dataIndex];a&&this.options.attrModel.addChild(a,0)}}},_cellClicked:function(e,n){if(n&&n.nodeModel&&n.nodeModel.options.grid){if(!0===n.nodeModel.options.pinColumn)return;switch(this.options.grid.layout.getDataIndexFromColumnIndex(n.columnID)){case"attrRemove":if(n.nodeModel){if(n.nodeModel.options.grid.layout&&!1===n.nodeModel.options.grid.layout.removable||n.nodeModel.options.grid.isAdditionalColumn&&!0===n.nodeModel.options.grid.isAdditionalColumn)break;if(this.options.attrModel.removeRoot(n.nodeModel),"thumbnail"===n.nodeModel.options.columnIndex){this.options.thumbnailsActivated=!1;var o={id:this.options.toolbar.getItem("thumbnail").id,tile:t.attributesCustomization.activateThumbnails};this.options.toolbar.menu.updateItem(o),this.options.toolbar.select("thumbnail",!1)}}}}},_retrieveColumnName:function(e){return t.attributesCustomization[e]?t.attributesCustomization[e]:e},_buildIconBar:function(){this.elements.toolbar=s.createElement("div",{class:this.getClassNames("-toolbar")}).inject(this.elements.container);var e=(this.options.appColumns?this.options.appColumns:[]).filter((function(e){return!e.isHidden})).map((function(e){return e.dataIndex}));let o=[];!0===this.options.moreColumnsBtn&&(o.push({fonticon:"cog",title:t.attributesCustomization.moreAttributes,name:"moreAttributes",handler:function(e,n){require(["DS/IPClassifyColumnCusto/MoreAttributesWizard"],(function(e){for(var n=i.options.attrModel.getRoots(),o=[],s=0;s<n.length;s++)!0===x(n[s].getReferenceValue("attrName"))&&o.push({name:n[s].getReferenceValue("attrName"),instRef:n[s].getReferenceValue("attrInstRef"),attrDBName:n[s].getReferenceValue("attrDBName")});var a=i.options.modelEvents.subscribe({event:"IPClassifyColumnCusto/MoreAttributesWizard/selectedAttributes"},(function(e){i.options.modelEvents.unsubscribe(a);for(var n=i.options.attrModel.getRoots(),o=new Map,s=0;s<n.length;s++)!0===x(n[s].getReferenceValue("attrName"))&&o.set(n[s].getReferenceValue("attrName"),n[s].getReferenceValue("attrDBName"));i.options.modelEvents.publish({event:"IPClassifyColumnCusto/Views/showInWidgetBody",data:{idView:"customize",html:i.elements.container,title:t.attributesCustomization.apptitle}}),i.options.selectedExtensions=e.selectedExtensions,i.options.selectedTypes=e.selectedTypes,i._globalUpdate=!0;var l=e.selectedAttributes.filter((function(e){return o.has(e.dataIndex)})).map((function(e){return e.dataIndex})),r=Array.from(o.keys()).filter((function(e){return-1===l.indexOf(e)})),c=e.selectedAttributes.filter((function(e){var t=!o.has(e.dataIndex)||o.get(e.dataIndex)&&!b.arrayEquals(o.get(e.dataIndex),e.attrDBName);return t&&-1!==i.options.defaultAttributes.indexOf(e.dataIndex)&&(t=!1),t})),u=[],p=[],m=0;for(m=0;m<r.length;m++){var h=i.options.attrModel.search({match:function(e){var t=!1;return e.nodeModel.options.columnIndex===r[m]&&!0!==e.nodeModel.options.grid.isAdditionalColumn&&!0!==e.nodeModel.options.grid.isDynamic&&"ds6w:type"!==r[m]&&(t=!0,i.options.dbOnlyAttributes&&i.options.allowedIndexAttributes.has(r[m])&&(t=!1)),t}});i.options.attrModel.withTransactionUpdate((function(){for(var e=0;e<h.length;e++)i.options.attrModel.removeRoot(h[e]),u.push(h[e].dump(M))}))}var f=[];for(m=0;m<c.length;m++){var v,g=A(i.options.appColumns,c[m].dataIndex),C=!1;if(g){var y=g.xnav_options;y||(y=g.customisation),y&&(C=!!y.exportable&&y.exportable.lock)}!0===I&&("Reference"===c[m].attrParent?v=[{iconName:"product"}]:"Instance"===c[m].attrParent&&(v=[{iconName:"flow-cascade"}]));var w={attrTitle:c[m].label,attrVisible:!0,exportContent:!0,exportLock:C,attrName:c[m].dataIndex,attrDBName:c[m].attrDBName,classif:c[m].classif,multiline:c[m].multiline,attrRemove:!0,pinContent:"unpinned",attrInstRef:c[m].attrParent,attrAlert:null};c[m].convertInfos&&(w.convertInfos=c[m].convertInfos);var T=new d({label:c[m].label,columnIndex:c[m].dataIndex,icons:v,grid:w,kind:c[m].kind,children:null});if(g){let e=i.options.attrModel.search({match:function(e){return c[m].dataIndex===e.nodeModel.options.columnIndex}});if(e&&1==e.length){let t=e[0].getAttributeValue("attrDBName"),n=c[m].attrDBName,o=!1;if(t)for(let e=0;e<n.length;++e)-1===t.indexOf(n[e])&&(t.push(n[e]),o=!0);o&&(i.options.attrModel.withTransactionUpdate((function(){e[0].setAttribute("attrDBName",t)})),f.push(e[0]),e[0].select())}}else{var S=i.__locateFirstAndLastPin("right");let e=null,t=!0===i.options.dynamicAttrCheckBoxValue;if(!0===i.options.dynamicAttributesTop&&(t=i.options.dynamicAttributesTop),i.options.enableDynamicAttributesPos&&!t){var N=i.options.attrModel.getRoots();for(let t=0;t<N.length;++t){let n=N[t];if(n.options.grid.isDynamic){e=n._getLocalID?n._getLocalID():n._localID;break}}}e?i.options.attrModel.addChild(T,e):S.first?i.options.attrModel.insertBefore(T,S.first):i.options.attrModel.addChild(T),T.select(),f.push(T)}}for(m=0;m<f.length;m++)p.push(f[m].dump(M));(u.length||p.length)&&i.options.modelEvents.publish({event:"IPClassifyColumnCusto/AttributesCustomization/columnModification",data:{what:"addRemoveColumns",selectedTypes:i.options.selectedTypes,selectedExtensions:i.options.selectedExtensions,removedColumns:u,addedColumns:p}}),delete i._globalUpdate})),l=i.options.modelEvents.subscribe({event:"IPClassifyColumnCusto/MoreAttributesWizard/closeWizard"},(function(){i.options.modelEvents.unsubscribe(l),i.options.modelEvents.publish({event:"IPClassifyColumnCusto/Views/showInWidgetBody",data:{idView:"customize",html:i.elements.container,title:t.attributesCustomization.apptitle}})}));i.attributeWizard=new e({dgv:i.options.withDgv,modelEvents:i.options.modelEvents,baseTypes:i.options.baseTypes,baseInstanceTypes:i.options.baseInstanceTypes,selectedTypes:i.options.selectedTypes,selectedExtensions:i.options.selectedExtensions,selectedAttributes:o,defaultTypes:i.options.defaultTypes,defaultExtensions:i.options.defaultExtensions,defaultAttributes:i.options.defaultAttributes,supportedIndexAttrs:i.options.supportedIndexAttrs,fetchTypesFromDictionary:i.options.fetchTypesFromDictionary,dbOnlyAttributes:i.options.dbOnlyAttributes,showNonDBAttributesAsWell:i.options.showNonDBAttributesAsWell,classificationAttributes:i.options.classificationAttributes,addValueInAuthoringColumn:i.options.addValueInAuthoringColumn,preMappedAttriForAuthoring:i.options.preMappedAttriForAuthoring})}))}}),o.push({className:"divider"})),o.push({fonticon:"up",title:t.attributesCustomization.moveUp,name:"moveUp",disabled:!0,handler:function(e,t){!0!==t.disabled&&i._moveColumn(t.name,i.options.attrModel.getSelectedNodes())}}),o.push({fonticon:"down",title:t.attributesCustomization.moveDown,name:"moveDown",disabled:!0,handler:function(e,t){!0!==t.disabled&&i._moveColumn(t.name,i.options.attrModel.getSelectedNodes())}}),o.push({fonticon:"move-to-top",title:t.attributesCustomization.moveFirst,name:"moveFirst",disabled:!0,handler:function(e,t){!0!==t.disabled&&i._moveColumn(t.name,i.options.attrModel.getSelectedNodes())}}),o.push({fonticon:"move-to-bottom",title:t.attributesCustomization.moveLast,name:"moveLast",disabled:!0,handler:function(e,t){!0!==t.disabled&&i._moveColumn(t.name,i.options.attrModel.getSelectedNodes())}}),this.options.moreColumnsBtn&&(o.push({className:"divider"}),o.push({fonticon:"trash",title:t.attributesCustomization.remove,name:"remove",disabled:!0,handler:function(e,t){i._removeSelectedColumn()}}));var i=this,a={renderTo:this.elements.toolbar,multiSelect:!0,items:o};if(!0===this.options.withDgv){this.options.thumbnailsActivated=-1!==e.indexOf("thumbnail");var l=[{fonticon:this.options.rowHeaderActivated?"checkbox-on":"checkbox-off",title:this.options.rowHeaderActivated?t.attributesCustomization.deactivateSelectionBoxes:t.attributesCustomization.activateSelectionBoxes,name:"checkBoxes",handler:function(e,n){i.options.rowHeaderActivated=!i.options.rowHeaderActivated;var o=i.options.rowHeaderActivated?"checkbox-on":"checkbox-off",s=i.options.rowHeaderActivated?t.attributesCustomization.deactivateSelectionBoxes:t.attributesCustomization.activateSelectionBoxes,a={id:i.options.toolbar.getItem("checkBoxes").id,title:s,fonticon:o};i.options.toolbar.menu.updateItem(a),i.options.modelEvents.publish({event:"IPClassifyColumnCusto/AttributesCustomization/columnModification",data:{what:"rowsHeaderModification",rowsHeader:i.options.rowHeaderActivated}})}},{fonticon:"picture",title:this.options.thumbnailsActivated?t.attributesCustomization.deactivateThumbnails:t.attributesCustomization.activateThumbnails,name:"thumbnail",selectable:!0,selected:this.options.thumbnailsActivated,handler:function(e,n){i.options.thumbnailsActivated=!i.options.thumbnailsActivated;var o=i.options.thumbnailsActivated?t.attributesCustomization.deactivateThumbnails:t.attributesCustomization.activateThumbnails,s={id:i.options.toolbar.getItem("thumbnail").id,title:o,selected:i.options.thumbnailsActivated};i.options.toolbar.menu.updateItem(s),i._manageThumbnailAttribute(n.name,n.selected)}},{className:"divider"}];if(!0!==I&&w){var r={fonticon:"list-add",title:t.attributesCustomization.instanceAtt,name:"instanceAttributes",content:{type:"dropdownmenu",options:{multiSelect:!0,items:[{text:t.attributesCustomization.instanceName,name:"ds6w:label-Instance",selectable:!0,selected:-1!==e.indexOf("ds6w:label-Instance")},{text:t.attributesCustomization.instanceMatrix,name:"positionMatrix-Instance",selectable:!0,selected:-1!==e.indexOf("positionMatrix-Instance")}],events:{onClick:function(e,t){i._manageInstanceAttributes(t.name,t.selected)}}}}};l.splice(1,0,r)}a.items.splice.apply(a.items,[2,0].concat(l))}else{var c=[{fonticon:"list-add",title:t.attributesCustomization.specificColumn,name:"specificColumns",id:"specificColumns",content:{type:"dropdownmenu",options:{multiSelect:!0,items:[{fonticon:"checkbox-on",text:t.attributesCustomization.selection,name:"selection",id:"selection",selectable:!0,selected:-1!==e.indexOf("selection")},{fonticon:"eye",text:t.attributesCustomization.hide_show,name:"hide_show",id:"hide_show",selectable:!0,selected:-1!==e.indexOf("hide_show")},{text:t.attributesCustomization.instanceName,name:"ds6w:label-Instance",id:"ds6w:label-Instance",selectable:!0,selected:-1!==e.indexOf("ds6w:label-Instance")},{text:t.attributesCustomization.instanceMatrix,name:"positionMatrix-Instance",id:"positionMatrix-Instance",selectable:!0,selected:-1!==e.indexOf("positionMatrix-Instance")},{fonticon:"picture",text:t.attributesCustomization.thumbnail,name:"thumbnail",id:"thumbnail",selectable:!0,selected:-1!==e.indexOf("thumbnail")}],events:{onClick:function(e,t){i._manageSpecificColumn(t.name,t.selected)}}}}},{className:"divider"}];a.items.splice.apply(a.items,[2,0].concat(c))}!1===this.options.moreAttributes&&(a.items.forEach((function(e,t){"moreAttributes"===e.name&&a.items.splice(t,1)})),"divider"===a.items[0].className&&a.items.splice(0,1)),this.options.toolbar=new n(a),this.options.toolbar.elements.container.setStyle("display",void 0)},_manageAttrSelection:function(){var e=this.options.attrModel.getSelectedNodes(),t=["moveUp","moveDown","moveFirst","moveLast"],n=["remove"],o=e.length,i=!1;let s=!1;var a=0;for(a=0;a<o;a++)!0===e[a].options.grid.isAdditionalColumn||e[a].options.grid.layout&&!1===e[a].options.grid.layout.removable||(i=!0),e[a].options.grid.layout&&!1===e[a].options.grid.layout.movable&&(s=!0);if(0===o){for(a=0;a<t.length;a++)this.options.toolbar.disableItem(t[a]);for(a=0;a<n.length;a++)this.options.toolbar.disableItem(n[a])}else if(1===o){for(a=0;a<t.length;a++)s?this.options.toolbar.disableItem(t[a]):this.options.toolbar.enableItem(t[a]);for(a=0;a<n.length;a++)"remove"===n[a]&&!1===i?this.options.toolbar.disableItem(n[a]):this.options.toolbar.enableItem(n[a])}else if(o>=1){for(a=0;a<t.length;a++)this.options.toolbar.disableItem(t[a]);for(a=0;a<n.length;a++)"remove"===n[a]&&!1===i?this.options.toolbar.disableItem(n[a]):this.options.toolbar.enableItem(n[a])}},_moveColumn:function(e,t){!0===this.options.withDgv?this.__dgvMoveColumn(e,t):this.__treeMoveColumn(e,t)},__dgvMoveColumn:function(e,t){var n=this;1===t.length&&this.options.attrModel.withTransactionUpdate((function(){var o,i=t[0],s=i.getReferenceValue("pinContent"),a=i._getLocalID?i._getLocalID():i._localID,l=n.__locateFirstAndLastPin(s),r=l.first._getLocalID?l.first._getLocalID():l.first._localID,d=l.last?l.last._getLocalID?l.last._getLocalID():l.last._localID:n.options.getRoots().length-1;switch(e){case"moveFirst":o=r;break;case"moveUp":o=r<=a-1?a-1:a;break;case"moveDown":o=d>=a+1?a+1:a;break;case"moveLast":o=d}if(a!==o&&n.options.dgvInfo&&!0===n.options.dgvInfo.columnOrdering){n.options.dgvInfo.columnOrdering=!1;let e=a,t=o,s=n.options.attrModel.getChildren();s&&s.length>0&&s.length>e&&s.length>t&&(e=s[e].options.columnIndex,t=s[t].options.columnIndex);var c={fromID:a,fromIndex:e,toID:o,toIndex:t};n._isMoving=!0,n.options.attrModel.addChild(i,c.toID),i.select(),n._isMoving=!1;let l={what:"moveColumn",move2perform:c};n.options.enableDynamicAttributesPos&&(l.dynamicAttributesTop=n.options.dynamicAttributesTop),n.options.modelEvents.publish({event:"IPClassifyColumnCusto/AttributesCustomization/columnModification",data:l})}}))},__treeMoveColumn:function(e,t){var n=this;1===t.length&&this.options.attrModel.withTransactionUpdate((function(){var o=t[0],i=o._getLocalID?o._getLocalID():o._localID,s={fromID:i,toID:-1};switch(e){case"moveFirst":s.toID=0;break;case"moveUp":s.toID=i-1;break;case"moveDown":s.toID=i+1;break;case"moveLast":s.toID=n.options.attrModel.getRoots().length-1}-1!==s.toID&&i!==s.toID&&s.toID<n.options.attrModel.getRoots().length&&(n._isMoving=!0,n.options.attrModel.addChild(o,s.toID),o.select(),n._isMoving=!1,n.options.modelEvents.publish({event:"IPClassifyColumnCusto/AttributesCustomization/columnModification",data:{what:"moveColumn",move2perform:s}}))}))},_manageSpecificColumn:function(e,n){var o=this,i=!1,s=!0;"ds6w:label-Instance"===e&&(i=!0,s=!1);var a=["hide_show","ds6w:label-Instance","positionMatrix-Instance","thumbnail"],l="ds6w:label-Instance"===e?"instanceName":"positionMatrix-Instance"===e?"instanceMatrix":e,r=t.attributesCustomization[l]?t.attributesCustomization[l]:e;if(!0===n){if("thumbnail"===e)this.elements.comboCompact.options.treedocument.getRoots()[0].select(!0),this.elements.comboCompact.disabled(!0);this.options.attrModel.withTransactionUpdate((function(){var t=-1!==a.indexOf(e),n=new d({columnIndex:e,label:r,grid:{attrTitle:r,attrVisible:!0,exportContent:i,exportLock:s,attrRemove:!0,attrName:e,hasTitle:t},modelEvents:o.options.modelEvents});o.options.attrModel.addChild(n)}))}else{"thumbnail"===e&&this.elements.comboCompact.disabled(!1);var c=this.options.attrModel.search({match:function(t){return t.nodeModel.options.label===e||t.nodeModel.options.columnIndex===e}});this.options.attrModel.withTransactionUpdate((function(){for(var e=0;e<c.length;e++)o.options.attrModel.removeRoot(c[e])}))}},_manageInstanceAttributes:function(e,n){var o=this;if(!0===n)this.options.attrModel.withTransactionUpdate((function(){var n="ds6w:label-Instance"===e?"instanceName":"positionMatrix-Instance"===e?"instanceMatrix":e,i=t.attributesCustomization[n]?t.attributesCustomization[n]:e;switch(e){case"ds6w:label-Instance":var s=new d({columnIndex:e,label:i,grid:{attrTitle:i,attrVisible:!0,exportContent:!0,exportLock:!1,attrRemove:!0,pinContent:"left",attrName:e,hasTitle:!0,attrInstRef:"Instance"},modelEvents:o.options.modelEvents});(a=o.__locateFirstAndLastPin("right")).first?o.options.attrModel.insertBefore(s,a.first):o.options.attrModel.addChild(s);break;case"positionMatrix-Instance":var a,l=new d({columnIndex:e,label:i,grid:{attrTitle:i,attrVisible:!0,exportContent:!0,exportLock:!1,attrRemove:!0,pinContent:"unpinned",attrName:e,hasTitle:!0,attrInstRef:"Instance"},modelEvents:o.options.modelEvents});(a=o.__locateFirstAndLastPin("right")).first?o.options.attrModel.insertBefore(l,a.first):o.options.attrModel.addChild(l)}}));else{var i=this.options.attrModel.search({match:function(t){return t.nodeModel.options.label===e||t.nodeModel.options.columnIndex===e}});this.options.attrModel.withTransactionUpdate((function(){for(var e=0;e<i.length;e++)o.options.attrModel.removeRoot(i[e])}))}},_manageThumbnailAttribute:function(e,n){var o=this;if(!0===n){this.elements.comboCompact.options.treedocument.getRoots()[0].select(!0),o.options.modelEvents.publish({event:"IPClassifyColumnCusto/AttributesCustomization/columnModification",data:{what:"changeViewMode",viewMode:"comfortable"}}),b.isTouchDevice()||this.elements.comboCompact.disabled(!0),this.options.attrModel.withTransactionUpdate((function(){var n=t.attributesCustomization[e]?t.attributesCustomization[e]:e,i=new d({columnIndex:e,label:n,grid:{attrTitle:n,attrVisible:!0,exportContent:!1,exportLock:!0,attrRemove:!0,pinContent:"unpinned",attrName:e,hasTitle:!0},modelEvents:o.options.modelEvents}),s=o.__locateFirstAndLastPin("right");s.first?o.options.attrModel.insertBefore(i,s.first):o.options.attrModel.addChild(i)}))}else{b.isTouchDevice()||this.elements.comboCompact.disabled(!1);var i=this.options.attrModel.search({match:function(t){return t.nodeModel.options.label===e||t.nodeModel.options.columnIndex===e}});this.options.attrModel.withTransactionUpdate((function(){for(var e=0;e<i.length;e++)o.options.attrModel.removeRoot(i[e])}))}},_removeSelectedColumn:function(){var e=this.options.attrModel.getSelectedNodes(),n=this;this.options.attrModel.withTransactionUpdate((function(){for(var o=0;o<e.length;o++)!0===e[o].options.grid.isAdditionalColumn||e[o].options.grid.layout&&!1===e[o].options.grid.layout.removable?(e[o].unselect(),v.displayNotification({message:t.replace(t.attributesCustomization.cannotRemove,{attr:e[o].getReferenceValue("attrTitle")}),className:"warning"})):n.options.attrModel.removeRoot(e[o])}))},__locateFirstAndLastPin:function(e,t){var n,o=this,i=this.options.attrModel.getRoots(),s=null,a=[],l=null,r=null,d=null;i.forEach(((n,i)=>{if(n._tempIndex=i,n.getReferenceValue("pinContent")===e){var c=!0;"unpinned"==e&&o.options.enableDynamicAttributesPos&&(c=c&&!n.options.grid.isDynamic),c&&a.push(n)}if(t&&n.options.columnIndex===t)s=i;else switch(n.getReferenceValue("pinContent")){case"left":l=n;break;case"right":d=d||n;break;default:r=n}})),t&&(a[0].options.columnIndex===t?a.shift():a[a.length-1].options.columnIndex===t&&a.pop()),n=a[0];var c=a.length-1;return{first:n,last:a[c],current:s,left:l,right:d,middle:r}}})})),define("DS/IPClassifyColumnCusto/MoreAttributesWizard",["css!DS/IPClassifyColumnCusto/IPClassifyColumnCusto.css","i18n!DS/IPClassifyColumnCusto/assets/nls/IPClassifyColumnCusto","UWA/Core","UWA/Controls/Abstract","UWA/Class/Promise","DS/IPClassifyColumnCusto/WizardSteps","text!DS/IPClassifyColumnCusto/assets/MoreAttrWizardSteps.json","DS/PADServices/views/private/SearchInput","DS/PADServices/views/private/Iconbar","DS/PADServices/utils/DictionaryMgt","DS/Controls/Button","DS/Controls/Loader","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/DataGridView/DataGridView","DS/DataGridView/DataGridViewLayout","DS/Utilities/Utils","DS/IPClassifyUXUtil/utils/DictionaryAccess","DS/IPClassifyUtil/IPClassifyUtility","DS/IPClassifyUtil/IPClassifyAlert","DS/IPClassifyUtil/service/IPClassifyUtilWebService","DS/ClassificationUtil/ClassificationUtil","DS/Controls/Toggle","DS/IPClassifyUtil/IPClassifyPreference","DS/IPClassifyUtil/DimensionUtils","DS/WidgetServices/WidgetServices"],(function(e,t,n,o,i,s,a,l,r,d,c,u,p,m,h,f,b,v,g,C,y,I,w,x,M,A){"use strict";var T=JSON.parse(a),S={properties:[function(){return{property:"dataIndex",value:this.options.grid.attrName}},function(){return{property:"attrDBName",value:this.options.grid.attrDBName}},function(){return{property:"classif",value:this.options.grid.classif}},function(){return{property:"multiline",value:this.options.grid.multiline}},function(){return{property:"attrParent",value:this.options.grid.attrParent}},function(){return{property:"label",value:this.options.label}},function(){return{property:"kind",value:this.options.grid.attrKind}},function(){return{property:"description",value:this.options.grid.attrDesc}},function(){return{property:"convertInfos",value:this.options.grid.convertInfos}}]},N={"ds6wg:XCADExtension.V_CADOrigin":"ds6w:cadMaster"},D=["ds6w:globalType"];return o.extend({name:"ip-more-attr",defaultOptions:{baseTypes:[],baseInstanceTypes:[],selectedTypes:[],automaticExtensions:[],selectedExtensions:[],selectedAttributes:[],defaultTypes:[],defaultExtensions:[],defaultAttributes:[],supportedIndexAttrs:[],subscribeTokens:[],modelEvents:null,renderTo:null,steps:null,activeView:null,maps:{referenceTypes:[],instanceTypes:[]},views:{typesView:null,extensionsView:null,attributesView:null},toolbar:null,grids:{},models:{},dgvOptions:{defaultColumnDef:{width:"auto",typeRepresentation:"string"},showRowBorderFlag:!0,alternateBackgroundFlag:!1,columns:[{icon:{iconName:"check",fontIconFamily:1},dataIndex:"attrSel",typeRepresentation:"boolean",alwaysVisibleFlag:!0,width:40,resizableFlag:!1,editableFlag:!0,editionPolicy:"EditionInPlace",getCellEditableState:function(e){var t=!0;return e.nodeModel&&(this.mandatorySelected&&-1!==this.mandatorySelected.indexOf(e.nodeModel.getReferenceValue("attrName"))||this.mandatorySelectedWithParent&&this.mandatorySelectedWithParent[e.nodeModel.options.grid.attrParent]&&-1!==this.mandatorySelectedWithParent[e.nodeModel.options.grid.attrParent].indexOf(e.nodeModel.getReferenceValue("attrName")))&&(t=!1),t}},{dataIndex:"attrParent",editableFlag:!1,width:30,sortableFlag:!0,resizableFlag:!1,getCellTypeRepresentation:function(e){return e.nodeModel&&e.nodeModel.options.grid.attrParent?e.nodeModel.options.grid.attrParent:"Unknown"},getCellSemantics:function(e){if(e.nodeModel)return{disabled:!0}}},{dataIndex:"tree",text:t.moreAttributesWizard.attrTitle}]},dgvLayoutOptions:{cellHeight:26,columnHeaderHeight:38,rowsHeader:!1}},init:function(e){this._parent(e),this._realInit(e),this._addValueShownInAuthoringModeColumn=e.dbOnlyAttributes&&e.showNonDBAttributesAsWell&&e.addValueInAuthoringColumn},_realInit:function(){var e=this,t=A.isWebInWinEnvironment()?"-immersivePanelWebInWin":"-immersivePanel";e.elements.container=n.createElement("div",{class:e.getClassNames(t)}),e.instanceMgt=e.options.baseInstanceTypes&&e.options.baseInstanceTypes.length>0,e._buildBody().then(e._buildFooter.bind(e)).done((function(){e.switchView(T.activeStep),e.options.subscribeTokens.push(e.options.modelEvents.subscribe({event:"IPClassifyColumnCusto/WizardSteps/stepChanged"},(function(t){var n=t.stepId;e.switchView(n)}))),e.options.modelEvents.publish({event:"IPClassifyColumnCusto/Views/showInWidgetBody",data:{html:e.elements.container}}),M.getDimensions()}))},destroy:function(){for(var e=0;e<this.options.subscribeTokens.length;e++)this.options.modelEvents.unsubscribe(this.options.subscribeTokens[e]);this.options.toolbar.destroy();var t=this;Object.keys(t.options.grids).forEach((function(e){t.options.grids[e].destroy(),t.options.grids[e]=null})),this._parent()},_buildBody:function(){var e=this;return new i((function(t,o){e.elements.wizard=n.createElement("div",{class:e.getClassNames("-wizard")}).inject(e.elements.container),e.options.wizard=new s({modelEvents:e.options.modelEvents,renderTo:e.elements.wizard,steps:T});var i=n.createElement("div",{class:e.getClassNames("-toolbar-container")}).inject(e.elements.container);e.elements.content=n.createElement("div",{class:e.getClassNames("-content")}).inject(e.elements.container),e._generateToolbar({renderTo:i}),t()}))},_buildFooter:function(){var e=this;return new i((function(o,i){e.elements.footer=n.createElement("div",{class:e.getClassNames("-footer")}).inject(e.elements.container);var s=e.elements.nextButton=new c({label:t.moreAttributesWizard.next,value:"next",emphasize:"primary",touchMode:!0});s.addEventListener("click",(function(){if("typesView"===e.options.activeView)e.options.modelEvents.publish({event:"IPClassifyColumnCusto/WizardSteps/changeStep",data:{stepId:"extensionsView"}});else if("extensionsView"===e.options.activeView)e.options.modelEvents.publish({event:"IPClassifyColumnCusto/WizardSteps/changeStep",data:{stepId:"attributesView"}});else if("attributesView"===e.options.activeView){var t=e.options.models.attributesView.search({match:function(e){return!0===e.nodeModel.options.grid.attrSel||void 0===e.nodeModel.options.grid.attrSel}}).map((function(t){let n=t.dump(S);if(void 0===t.options.grid.attrSel){var o=e.options.selectedAttributes.filter((function(e){return e.name===n.dataIndex}));1===o.length&&(n.attrDBName=o[0].attrDBName)}return n})),n=[].concat(e.options.selectedExtensions);e.options.modelEvents.publish({event:"IPClassifyColumnCusto/MoreAttributesWizard/selectedAttributes",data:{selectedAttributes:t,selectedTypes:e.options.selectedTypes,selectedExtensions:n}}),e.destroy()}})),s.inject(e.elements.footer);var a=e.elements.closeButton=new c({label:t.moreAttributesWizard.cancel,emphasize:"secondary",touchMode:!0});a.addEventListener("click",(function(){e.options.modelEvents.publish({event:"IPClassifyColumnCusto/MoreAttributesWizard/closeWizard"}),e.destroy()})),a.inject(e.elements.footer),o()}))},switchView:function(e){if(this.options.activeView!==e){if(this.elements.toolbarSearch.clear(),this.__setToolbarCmds(e),this.options.previousView=this.options.activeView,this.options.activeView=e,null===this.options.views[e]){(p=this.elements.content.getElement("div.ip-more-attr-chooser-view"))&&this.elements.content.removeChild(p),n.is(this.elements.loader)||(this.elements.loaderDiv=n.createElement("div",{class:this.getClassNames("-loader")}).inject(this.elements.content),this.elements.loader=(new u).inject(this.elements.loaderDiv),this.elements.loader.getContent().addClassName("enx-loader")),this.elements.loaderDiv.removeClassName("hidden"),this.elements.nextButton.disabled=!0,this.options.wizard.getContent().addClassName("disabled"),this.elements.loader.on();var o=this,s=[],a=null,l=0,r=T.steps.length;do{T.steps[l].id===e&&(a=T.steps[l]),l++}while(l<r||null===a);var d=!1;if(a.prerequisiteViews)for(var c=0;c<a.prerequisiteViews.length;c++)null===this.options.views[a.prerequisiteViews[c]]&&(s.push(this["_build"+a.prerequisiteViews[c]](!0)),d=!0);i.all(s).then(function(){if(!0===d){var t=this.elements.content.getElement("div.ip-more-attr-chooser-view");t&&this.elements.content.removeChild(t)}this["_build"+e]().then((function(e){o.elements.loaderDiv.addClassName("hidden"),o.elements.loader.off(),o.elements.nextButton.disabled=!1,o.options.wizard.getContent().removeClassName("disabled"),o.options.modelEvents.publish({event:"IPClassifyColumnCusto/MoreAttributesWizard/viewReady",data:{activeView:o.options.activeView}})}))}.bind(this))}else{var p;(p=this.elements.content.getElement("div.ip-more-attr-chooser-view"))&&this.elements.content.removeChild(p),this.options.views[e].inject(this.elements.content);o=this;!0===this.typesUpdated&&"extensionsView"===this.options.activeView?this.__updateExtensionsView().then((function(){delete o.typesUpdated,o.extensionsUpdated=!0,o.options.modelEvents.publish({event:"IPClassifyColumnCusto/MoreAttributesWizard/viewReady",data:{activeView:o.options.activeView}})})):!0!==this.typesUpdated&&!0!==this.extensionsUpdated||"attributesView"!==this.options.activeView?("attributesView"===this.options.activeView&&o.elements.classificationAttributesToggle&&o.elements.classificationAttributesToggle.show(),this.options.modelEvents.publish({event:"IPClassifyColumnCusto/MoreAttributesWizard/viewReady",data:{activeView:this.options.activeView}})):(o.elements.classificationAttributesToggle&&(o.elements.classificationAttributesToggle.show(),o.elements.classificationAttributesToggle.disabled=!0),this.__updateAttributesView().then((function(){delete o.typesUpdated,delete o.extensionsUpdated,o.options.modelEvents.publish({event:"IPClassifyColumnCusto/MoreAttributesWizard/viewReady",data:{activeView:o.options.activeView}})})))}"attributesView"===this.options.activeView?this.elements.nextButton.label=t.moreAttributesWizard.done:(this.elements.nextButton.label=t.moreAttributesWizard.next,o.elements.classificationAttributesToggle&&o.elements.classificationAttributesToggle.hide())}},_buildtypesView:function(){var e=this;return new i((function(o,i){e.elements.nextButton.label=t.moreAttributesWizard.next,e.elements.nextButton.disabled=!0;var s="typesView";e.options.wizard.getContent().addClassName("disabled"),e.options.views[s]=n.createElement("div",{class:e.getClassNames("-"+s+" ip-more-attr-chooser-view")});var a=n.createElement("div",{class:e.getClassNames("-"+s+"Dgv ip-more-attr-dgv-container")}).inject(e.options.views[s]),l=n.extend({identifier:"MoreAttrWizard-"+(65536*(1+Math.random())|0).toString(16).substring(1)},n.clone(e.options.dgvOptions));!0!==e.instanceMgt&&l.columns.splice(1,1),l.layout=new f(e.options.dgvLayoutOptions);var r=e.options.grids[s]=new h(l);!0===e.instanceMgt&&e._declareInstRefTypeReps(r),r.onContextualEvent=function(){return[]},r.getCellTooltip=function(n){var o=e.options.grids[s].getColumnOrGroup(n.columnID).dataIndex;if(n.dataIndex=o,-1===n.rowID)return{shortHelp:t.moreAttributesWizard[o],updateModel:!1}}.bind(this),r.mandatorySelected=e.options.defaultTypes,e.options.models[s]=new p({}),r.treeDocument=e.options.models[s],r.getContent().addClassName("enxdatagridview loading"),r.getContent().inject(a),e.options.views[s].inject(e.elements.content),r.onReady((function(){e.__updateTypesViewModel().finally((function(){r.getContent().removeClassName("loading"),o()})),r.addEventListener("change",e._changeType.bind(e))}))}))},_changeType:function(e,t){var n=this.options.grids[this.options.activeView];if(t&&t.nodeModel&&t.nodeModel.options.grid&&"attrSel"===n.layout.getDataIndexFromColumnIndex(t.columnID)){var o=t.nodeModel.getReferenceValue("attrName"),i=this.options.selectedTypes.indexOf(o);!0===t.nodeModel.options.grid.attrSel?-1===i&&this.options.selectedTypes.push(o):-1!==i&&this.options.selectedTypes.splice(i,1),this.typesUpdated=!0}},_buildextensionsView:function(){var e=this;return new i((function(o,i){e.elements.nextButton.label=t.moreAttributesWizard.next,e.elements.nextButton.disabled=!0;var s="extensionsView";e.options.wizard.getContent().addClassName("disabled"),e.options.views[s]=n.createElement("div",{class:e.getClassNames("-"+s+" ip-more-attr-chooser-view")});var a=n.createElement("div",{class:e.getClassNames("-"+s+"-Dgv ip-more-attr-dgv-container")}).inject(e.options.views[s]),l=n.extend({identifier:"MoreAttrWizard-"+(65536*(1+Math.random())|0).toString(16).substring(1)},n.clone(e.options.dgvOptions));!0!==e.instanceMgt&&(l.columns.splice(1,1),!0!==e.options.dgv&&l.columns.push({icon:{iconName:"where-used",fontIconFamily:1},dataIndex:"declaredIn",typeRepresentation:"declaredInRepresentation",editableFlag:!1,width:75,sortableFlag:!1,resizableFlag:!1})),l.layout=new f(e.options.dgvLayoutOptions);var r=e.options.grids[s]=new h(l);if(!0===e.instanceMgt)e._declareInstRefTypeReps(r);else if(!0!==e.options.dgv){var d={declaredInRepresentation:{stdTemplate:"functionMenuIcon",semantics:{icon:{iconName:"where-used",fontIconFamily:WUXManagedFontIcons.Font3DS}}}};r.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(d))}r.onContextualEvent=function(){return[]},r.getCellTooltip=function(n){var o=e.options.grids[s].getColumnOrGroup(n.columnID).dataIndex;return n.dataIndex=o,-1===n.rowID?{shortHelp:t.moreAttributesWizard[o],updateModel:!1}:!0===e.instanceMgt&&n.nodeModel?{shortHelp:t.replace(t.moreAttributesWizard.declaredInWithTypes,{types:n.nodeModel.getReferenceValue("attrInTypeNLS").join("\n")}),updateModel:!1}:void 0}.bind(this),r.mandatorySelected=e.options.defaultExtensions,e.options.models[s]=new p({}),r.treeDocument=e.options.models[s],r.getContent().addClassName("enxdatagridview loading"),r.getContent().inject(a),e.options.views[s].inject(e.elements.content),r.onReady((function(){e.__updateExtensionsViewModel(!0).finally((function(){r.getContent().removeClassName("loading"),o({})})),r.addEventListener("change",e._changeExtension.bind(e))}))}))},_changeExtension:function(e,t){var n=this.options.grids[this.options.activeView];if(t&&t.nodeModel&&t.nodeModel.options.grid&&"attrSel"===n.layout.getDataIndexFromColumnIndex(t.columnID)){var o=t.nodeModel.getReferenceValue("attrName"),i=this.options.selectedExtensions.indexOf(o);!0===t.nodeModel.options.grid.attrSel?-1===i&&this.options.selectedExtensions.push(o):-1!==i&&this.options.selectedExtensions.splice(i),this.extensionsUpdated=!0}},_buildattributesView:function(){var e=this;return e.elements.classificationAttributesToggle&&(e.elements.classificationAttributesToggle.show(),e.elements.classificationAttributesToggle.disabled=!0),new i((function(o){e.elements.nextButton.label=t.moreAttributesWizard.done,e.elements.nextButton.disabled=!0;var i="attributesView";e.options.wizard.getContent().addClassName("disabled"),e.options.views[i]=n.createElement("div",{class:e.getClassNames("-"+i+" ip-more-attr-chooser-view")});var s=n.createElement("div",{class:e.getClassNames("-"+i+"-Dgv ip-more-attr-dgv-container")}).inject(e.options.views[i]),a=n.extend({identifier:"MoreAttrWizard-"+(65536*(1+Math.random())|0).toString(16).substring(1)},n.clone(e.options.dgvOptions));e.instanceMgt||(a.columns.splice(1,1),!0!==e.options.dgv&&a.columns.push({text:t.moreAttributesWizard.declaredIn,dataIndex:"declaredIn",typeRepresentation:"declaredInRepresentation",editableFlag:!1,width:75,sortableFlag:!1,resizableFlag:!1})),e._addValueShownInAuthoringModeColumn&&a.columns.push({text:t.moreAttributesWizard.valueInAuthoring,dataIndex:"valueInAuthoring",editableFlag:!1,typeRepresentation:"boolean"}),a.layout=new f(e.options.dgvLayoutOptions);var l=e.options.grids[i]=new h(a);if(!e.instanceMgt&&!0!==e.options.dgv){var r={declaredInRepresentation:{stdTemplate:"functionMenuIcon",semantics:{icon:{iconName:"where-used",fontIconFamily:WUXManagedFontIcons.Font3DS}}}};l.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(r))}l.onContextualEvent=function(){return[]},l.getCellTooltip=function(n){var o=e.options.grids[i].getColumnOrGroup(n.columnID).dataIndex;if(n.dataIndex=o,-1===n.rowID)return{shortHelp:t.moreAttributesWizard[o],updateModel:!1};if(n.nodeModel){var s=n.nodeModel.getReferenceValue("attrInTypeNLS");if(s)return{shortHelp:t.replace(t.moreAttributesWizard.declaredInWithTypes,{types:s.join("\n")}),updateModel:!1}}}.bind(this),e.options.defaultAttributes.length<=0&&(e.options.defaultAttributes=["ds6w:label","ds6w:type","ds6w:modified"]),l.mandatorySelectedWithParent={Reference:e.options.defaultAttributes},l.mandatorySelected=e.options.defaultAttributes,e.options.models[i]=new p({}),l.treeDocument=e.options.models[i],l.getContent().addClassName("enxdatagridview loading"),l.getContent().inject(s),e.options.views[i].inject(e.elements.content),l.onReady((function(){e.__updateAttributesViewModel().then((function(){l.getContent().removeClassName("loading"),e.elements.classificationAttributesToggle&&(e.elements.classificationAttributesToggle.disabled=!1),o()})),l.addEventListener("change",e._changeAttributes.bind(e))}))}))},_changeAttributes:function(e,t){var n=this.options.grids[this.options.activeView];if(t&&t.nodeModel&&t.nodeModel.options.grid&&"attrSel"===n.layout.getDataIndexFromColumnIndex(t.columnID)){for(var o=-1,i=0,s=this.options.selectedAttributes.length;-1===o&&i<s;)this.options.selectedAttributes[i].name===t.nodeModel.getReferenceValue("attrName")&&this.options.selectedAttributes[i].instRef===t.nodeModel.getReferenceValue("attrParent")&&(o=i),i++;!0===t.nodeModel.options.grid.attrSel?-1===o&&this.options.selectedAttributes.push({name:t.nodeModel.getReferenceValue("attrName"),instRef:t.nodeModel.getReferenceValue("attrParent")}):-1!==o&&this.options.selectedAttributes.splice(o)}},_generateToolbar:function(e){var o=this,i=b.debounce((function(e){o.options.models[o.options.activeView]&&(o.options.models[o.options.activeView].withTransactionUpdate((function(){var t=e.searchStr,n=!0;o.options.filterInProgress=!0,o.options.models[o.options.activeView].search({match:function(e){!function(e,t){var n=!1,o=new RegExp(e,"i");return(o.test(t.nodeModel.options.grid.attrTitle)||o.test(t.nodeModel.getLabel()))&&(n=!0),n}(t,e)?(e.nodeModel.unmatchSearch(),e.nodeModel.unselect(),e.nodeModel.hide()):(e.nodeModel.show(),t.length>0&&n?(e.nodeModel.select(!0),e.nodeModel.matchSearch(),n=!1):(e.nodeModel.unmatchSearch(),e.nodeModel.unselect()))}}),o.options.filterInProgress=!1})),o.options.models[o.options.activeView].getXSO().onPostAdd((function(){})),o.options.models[o.options.activeView].getXSO().onPostRemove((function(){})))}),500);this.elements.toolbar=n.createElement("div",{class:this.getClassNames("-toolbar")}).inject(e.renderTo);var s=n.createElement("div",{class:this.getClassNames("-toolbar-input")}).inject(this.elements.toolbar);this.elements.toolbarIconbar=n.createElement("div",{class:this.getClassNames("-toolbar-iconbar")}).inject(this.elements.toolbar);this.elements.toolbarIconbarIcons=n.createElement("div",{class:this.getClassNames("-toolbar-iconbar-icons")}).inject(this.elements.toolbarIconbar),this.elements.toolbarSearch=new l({events:{onSearch:i}}).inject(s),this.options.classificationAttributes&&x.get("classificationCheckBox",(function(e){let i=!1;e&&e.value&&(i=e.value),o.elements.classificationAttributesToggle=new w({label:t.moreAttributesWizard.classificationAttrCheckBox,checkFlag:i});var s=n.createElement("div",{class:o.getClassNames("-classificationCheckBox"),content:o.elements.classificationAttributesToggle});o.elements.classificationAttributesToggle.addEventListener("change",(function(e){let t=e.dsModel;x.set("classificationCheckBox",{value:t.checkFlag}),o.elements.classificationAttributesToggle.disabled=!0,o.__updateAttributesView()})),o.elements.classificationAttributesToggle.hide(),s.inject(o.elements.toolbarIconbar)}))},__setToolbarCmds:function(e){var n,o=this,i="none",s="none",a=function(){o.options.models[o.options.activeView].withTransactionUpdate((function(){for(var e=o.options.models[o.options.activeView].getRoots(),t=i+"-"+s,n=0;n<e.length;n++)switch(t){case"none-none":e[n].show();break;case"selected-none":!0===e[n].getReferenceValue("attrSel")||void 0===e[n].getReferenceValue("attrSel")?e[n].show():e[n].hide();break;case"unselected-none":!1===e[n].getReferenceValue("attrSel")?e[n].show():e[n].hide();break;case"none-reference":"Instance"!==e[n].getReferenceValue("attrParent")?e[n].show():e[n].hide();break;case"none-instance":"Reference"!==e[n].getReferenceValue("attrParent")?e[n].show():e[n].hide();break;case"selected-reference":!0===e[n].getReferenceValue("attrSel")&&"Instance"!==e[n].getReferenceValue("attrParent")?e[n].show():e[n].hide();break;case"selected-instance":!0===e[n].getReferenceValue("attrSel")&&"Reference"!==e[n].getReferenceValue("attrParent")?e[n].show():e[n].hide();break;case"unselected-reference":!1===e[n].getReferenceValue("attrSel")&&"Instance"!==e[n].getReferenceValue("attrParent")?e[n].show():e[n].hide();break;case"unselected-instance":!1===e[n].getReferenceValue("attrSel")&&"Reference"!==e[n].getReferenceValue("attrParent")?e[n].show():e[n].hide()}})),o.options.models[o.options.activeView].getXSO().onPostAdd((function(){})),o.options.models[o.options.activeView].getXSO().onPostRemove((function(){}))},l={fonticon:"reload",text:t.replace(t.moreAttributesWizard.reload,{what:t.moreAttributesWizard.availableTypes}),name:"reload",handler:function(e,t){o.elements.loader.on(),o.elements.loaderDiv.removeClassName("hidden"),o.options.grids.typesView.getContent().addClassName("loading"),o.elements.nextButton.disabled=!0,o.options.wizard.getContent().addClassName("disabled"),o.options.models.typesView.removeRoots(),o.__updateTypesViewModel(!0).finally((function(){o.elements.loader.off(),o.options.grids.typesView.getContent().removeClassName("loading"),o.elements.nextButton.disabled=!1,o.options.wizard.getContent().removeClassName("disabled")}))}},d={fonticon:"reload",text:t.replace(t.moreAttributesWizard.reload,{what:t.moreAttributesWizard.availableExtensions}),name:"reload",handler:function(e,t){o.__updateExtensionsView()}},c={fonticon:"reload",text:t.replace(t.moreAttributesWizard.reload,{what:t.moreAttributesWizard.availableAttributes}),name:"reload",handler:function(e,t){o.__updateAttributesView()}},u={fonticon:"list-filter",text:t.moreAttributesWizard.filterRowsKind,name:"filter-kind",content:{type:"dropdownmenu",options:{items:[{fonticon:"block",text:t.moreAttributesWizard.none,name:"none",selectable:!0,selected:!0},{fonticon:"product",text:t.moreAttributesWizard.filterreference,name:"reference",selectable:!0},{fonticon:"flow-cascade",text:t.moreAttributesWizard.filterinstance,name:"instance",selectable:!0}],events:{onClick:function(e,t){var n;n=t.name,s=n,a()}}}}},p={fonticon:"filter",text:t.moreAttributesWizard.filterRows,name:"filter",content:{type:"dropdownmenu",options:{items:[{fonticon:"block",text:t.moreAttributesWizard.none,name:"none",selectable:!0,selected:!0},{fonticon:"checkbox-on",text:t.moreAttributesWizard.selected,name:"selected",selectable:!0},{fonticon:"checkbox-off",text:t.moreAttributesWizard.unselected,name:"unselected",selectable:!0}],events:{onClick:function(e,t){var n;n=t.name,i=n,a()}}}}},m={className:"divider"};if(!this.options.toolbar||this.options.toolbar.currentView!==e){if(!0===this.instanceMgt)switch(e){case"typesView":n=[l,m,u,p];break;case"extensionsView":n=[d,m,u,p];break;case"attributesView":n=[c,m,u,p]}else n=[m,p];var h={renderTo:this.elements.toolbarIconbarIcons,items:n};this.options.toolbar&&(this.options.toolbar.destroy(),this.options.toolbar=null),this.options.toolbar=new r(h),this.options.toolbar.elements.container.setStyle("display",void 0)}},_declareInstRefTypeReps:function(e){var t={Reference:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"product",fontIconFamily:WUXManagedFontIcons.Font3DS}}},Instance:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"flow-cascade",fontIconFamily:WUXManagedFontIcons.Font3DS}}},Both:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"part-replace",fontIconFamily:WUXManagedFontIcons.Font3DS}}},Extension:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"part-add",fontIconFamily:WUXManagedFontIcons.Font3DS}}},Unknown:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"i-question",fontIconFamily:WUXManagedFontIcons.Font3DS}}}};e.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(t))},_checkSelected:function(e,t,n){var o=this,i=this.options.selectedAttributes.filter((function(n){return n.name===e&&(n.instRef===t||-1!==o.options.defaultAttributes.indexOf(n.name))}));i.length>1&&console.warn("Several attributes found "+JSON.stringify(i));var s=!1;return 1===i.length&&(s=!0,n&&i[0].attrDBName&&!g.arrayEquals(i[0].attrDBName,n)&&(s=void 0)),s},getAllTypes:function(){var e=this,t=e.options.fetchTypesFromDictionary;return void 0===t||t?d.getAllTypes():new i((function(t,n){function o(e,t){var n=e.name,o=t.name;return n.localeCompare(o)}function i(e){for(var t=[],n=0,o=e.length;n<o;++n)t.push(e[n].type);return t}y.fetchTypesInfo({onComplete:function(n){var s=JSON.parse(n),a=[];Object.keys(s).forEach((function(e){a.push({type:e,name:s[e].displayName})})),a.sort(o),e.options.nlsTypesInfo=s,t({res:s,types:i(a)})},onFailure:function(e,t,o){console.log("ERROR:: web service call to fetch types has failed!!"),n()}})}))},getNLSForTypes:function(e){var t=this,n=t.options.fetchTypesFromDictionary;if(void 0===n||n)return d.getNLSForTypes(e);var o=e.replace("ds6wg:","");return t.options.nlsTypesInfo[o]?t.options.nlsTypesInfo[o].displayName:o},__updateTypesViewModel:function(e){var n=this;return new i((function(o){var i="typesView",s=function(e,t){t||(t=Object.getOwnPropertyNames(e)),n.options.models[i].withTransactionUpdate((function(){for(var o=0;o<t.length;o++){var s=t[o],a=e[s],l=-1!==n.options.selectedTypes.indexOf(s),r=a.parent?a.parent:s,d=-1!==n.options.baseTypes.indexOf(r)?"Reference":-1!==n.options.baseInstanceTypes.indexOf(r)?"Instance":"Unknown",c=new m({label:a.displayName,grid:{attrName:s,attrTitle:a.displayName,attrSel:l,attrParent:d},icons:[a.iconUrl]});n.options.models[i].addRoot(c,l?0:void 0),"Reference"===d&&-1===n.options.maps.referenceTypes.indexOf(s)&&n.options.maps.referenceTypes.push(s),"Instance"===d&&-1===n.options.maps.instanceTypes.indexOf(s)&&n.options.maps.instanceTypes.push(s)}})),o({})};if(0==n.options.baseTypes.length)n.getAllTypes().then((function(e){n.options.baseTypes=e.types,s(e.res,e.types)}),(function(){n.options.modelEvents.publish({event:"IPClassifyColumnCusto/MoreAttributesWizard/closeWizard"}),n.destroy(),C.displayNotification({message:t.msg_error_timeout,className:"error"})}));else{var a=n.options.baseInstanceTypes.length?n.options.baseTypes.concat(n.options.baseInstanceTypes):n.options.baseTypes;d.getTypesInfo({baseTypes:a},e).then(s)}}))},__updateExtensionsView:function(){var e=this;return new i((function(t){e.elements.loader.on(),e.elements.loaderDiv.removeClassName("hidden"),e.options.grids.extensionsView.getContent().addClassName("loading"),e.elements.nextButton.disabled=!0,e.options.wizard.getContent().addClassName("disabled"),e.options.models.extensionsView.removeRoots(),e.__updateExtensionsViewModel(!0).finally((function(){e.elements.loader.off(),e.options.grids.extensionsView.getContent().removeClassName("loading"),e.elements.nextButton.disabled=!1,e.options.wizard.getContent().removeClassName("disabled"),t()}))}))},__updateExtensionsViewModel:function(e){var t=this;return new i((function(n){d.interfaces({classes:t.options.selectedTypes},e).then((function(e){for(var o=Object.getOwnPropertyNames(e.extensions),i=0;i<o.length;i++){for(var s=o[i],a=e.extensions[s],l=-1!==t.options.selectedExtensions.indexOf(s),r={menu:[]},d="",c=!1,u=!1,p=[],h=0;h<a.declareIn.length;h++)-1!==t.options.baseTypes.indexOf(a.declareIn[h])?c=!0:-1!==t.options.baseInstanceTypes.indexOf(a.declareIn[h])&&(u=!0),t.instanceMgt||r.menu.push({type:"PushItem",title:t.getNLSForTypes(a.declareIn[h])}),-1===p.indexOf(a.declareIn[h])&&p.push(t.getNLSForTypes(a.declareIn[h]));d=!0===c&&!0===u?"Both":!0===c?"Reference":!0===u?"Instance":"Unknown";var f=new m({label:a.nlsName,grid:{attrName:a.name,attrTitle:a.nlsName,attrSel:l,declaredIn:r,attrInType:a.declareIn,attrInTypeNLS:p,attrParent:d}});t.options.models.extensionsView.addRoot(f,l?0:void 0)}var b=Object.getOwnPropertyNames(e.automaticExtensions);for(i=0;i<b.length;i++)t.options.automaticExtensions.push(b[i]);n({})}))}))},__updateAttributesView:function(){var e=this;return new i((function(t){e.elements.loader.on(),e.elements.loaderDiv.removeClassName("hidden"),e.options.grids.attributesView.getContent().addClassName("loading"),e.elements.nextButton.disabled=!0,e.options.wizard.getContent().addClassName("disabled"),e.options.models.attributesView.removeRoots(),e.__updateAttributesViewModel(!0).finally((function(){e.elements.loader.off(),e.options.grids.attributesView.getContent().removeClassName("loading"),e.elements.nextButton.disabled=!1,e.options.wizard.getContent().removeClassName("disabled"),e.elements.classificationAttributesToggle&&(e.elements.classificationAttributesToggle.disabled=!1),t()}))}))},getPropertiesForClass:function(e,t,o,s){var a=this;return new i((function(l,r){var d=[v.getPropertiesForClass(e)];if(!0===s){var c=I.classificationAttributesPromise({apiVersion:"R2019x"});d.push(c)}i.all(d).then((function(r){var d=r[0];if(!0===s){let e=r[1];e&&e.length>0&&(d=d.concat(e))}for(var c={},u=0;u<d.length;u++)for(var p=d[u],m=0;m<p.properties.length;m++){var h=p.properties[m];if("attribute"==h.nature)h.dbAttrName=["attribute["+h.selectable+"]"];else if("basic"==h.nature)h.dbAttrName=[h.selectable];else if(o)h.dbAttrName=[];else if(a.options.supportedIndexAttrs.indexOf(h.curi)>=0)h.dbAttrName=[h.curi];else if(t)continue;if(void 0===c[h.curi])c[h.curi]=h,c[h.curi].inTypes=[p.classInfo.curi];else{c[h.curi].inTypes.push(p.classInfo.curi);var f=h.dbAttrName;for(var b in f){var g=f[b];-1===c[h.curi].dbAttrName.indexOf(g)&&c[h.curi].dbAttrName.push(g)}}}var C=[];if((void 0===e.queryTypeNLS||!0===e.queryTypeNLS)&&void 0===c["ds6w:type"]){c["ds6w:type"]={curi:"ds6w:type",label:"ds6w:type",dataType:"string"};var y=new i((function(e){v.getResourcesInfo(["ds6w:type"]).then((function(t){n.is(t,"array")&&1===t.length&&(c["ds6w:type"]=n.merge(t[0],c["ds6w:type"])),e()}))}));C.push(y)}i.all(C).then((function(){l({availaibleAttributes:c})}))}))}))},__updateAttributesViewModel:function(e){var o=this;return new i((function(e){for(var i="attributesView",s=n.clone(o.options.selectedTypes.concat(o.options.automaticExtensions).concat(o.options.selectedExtensions)),a=0;a<s.length;a++)s[a]="ds6wg:"+s[a];var l=s.join("\n");let r=!1;o.elements.classificationAttributesToggle&&!0===o.elements.classificationAttributesToggle.checkFlag&&(r=!0),o.getPropertiesForClass({classURIs:l,types:n.clone(o.options.selectedTypes),interfaces:n.clone(o.options.automaticExtensions.concat(o.options.selectedExtensions))},o.options.dbOnlyAttributes,o.options.showNonDBAttributesAsWell,r).then((function(n){for(var a=Object.getOwnPropertyNames(n.availaibleAttributes),l=[],r=[],d=0;d<a.length;d++){var c=a[d],u=n.availaibleAttributes[c],p=N[c]?N[c]:c;if(-1===D.indexOf(p)){var h={menu:[]},f="",b=!1,v=!1,g=!1,C=[],y=[],I=[],w=[],x=u.dbAttrName;"ds6w:cadMaster"===p&&(x=["attribute[XCADAssembly.V_CADOrigin]","attribute[XCADExtension.V_CADOrigin]","attribute[XCADAssembly.V_CADFileOrigin]","attribute[XCADRepExtension.V_CADFileOrigin]"]);var A=!1;if(o._addValueShownInAuthoringModeColumn&&(A=x&&x.length>0||o.options.preMappedAttriForAuthoring&&!0===o.options.preMappedAttriForAuthoring[c]),u.inTypes)for(var T=0;T<u.inTypes.length;T++){var S=u.inTypes[T].substring(u.inTypes[T].indexOf(":")+1,u.inTypes[T].length);if(-1!==o.options.baseTypes.indexOf(S))b=!0;else if(-1!==o.options.baseInstanceTypes.indexOf(S))v=!0;else if(-1!==o.options.selectedExtensions.indexOf(S)||-1!==o.options.automaticExtensions.indexOf(S)){g=!0;var V=o.options.models.extensionsView.search({match:function(e){return e.nodeModel.getReferenceValue("attrName")===S}});if(V.length){var _=V[0].getReferenceValue("attrParent");"Reference"===_?b=!0:"Instance"===_?v=!0:"Both"===_&&(b=!0,v=!0)}}o.instanceMgt||-1===s.indexOf(u.inTypes[T])||h.menu.push({type:"PushItem",title:o.getNLSForTypes(u.inTypes[T])}),-1===o.options.maps.referenceTypes.indexOf(S)&&!b||-1!==C.indexOf(S)||(C.push(S),y.push(o.getNLSForTypes(u.inTypes[T])),b=!0),-1===o.options.maps.instanceTypes.indexOf(S)&&!v||-1!==I.indexOf(S)||(I.push(S),w.push(o.getNLSForTypes(u.inTypes[T])),v=!0)}if("Instance"===(f=!0===b&&!0===v?"Both":!0===b?"Reference":!0===v?"Instance":!0===g?"Extension":"Unknown")&&(p+="-Instance"),-1===r.indexOf(p)){var E={};if("real"==u.dataType.substring(u.dataType.indexOf("#")+1)&&u.dimension&&u.dimension.length>0){E.dimension=u.dimension,u.manipulationUnit&&(E.manipulationUnit=u.manipulationUnit);let e=M.getUnitAndNLS(u.dimension,u.manipulationUnit);e&&(e.unit&&(E.unit=e.unit),e.nls&&(E.nls=e.nls),e.manipulationNls&&(E.manipulationNls=e.manipulationNls))}if("Both"===f){l.push(p);var R=p+"-Instance",z=o._checkSelected(R,"Instance",x),P={attrName:R,attrDBName:x,valueInAuthoring:A,attrTitle:u.label,attrDesc:u.description,attrKind:u.dataType.substring(u.dataType.indexOf("#")+1),attrInType:I,attrInTypeNLS:w,declaredIn:h,attrSel:z,attrParent:"Instance"};E.dimension&&(P.convertInfos=E,P.attrKind=void 0,P.typeRepresentation="string");var F=new m({label:u.label,grid:P});o.options.models[i].addRoot(F,z?0:void 0),r.push(R);var O=o._checkSelected(p,"Reference",x),k={attrName:p,attrDBName:x,valueInAuthoring:A,attrTitle:u.label,attrDesc:u.description,attrKind:u.dataType.substring(u.dataType.indexOf("#")+1),attrInType:C,attrInTypeNLS:y,declaredIn:h,attrSel:O,attrParent:"Reference"};E.dimension&&(k.convertInfos=E,k.attrKind=void 0,k.typeRepresentation="string");var W=new m({label:u.label,grid:k});o.options.models[i].addRoot(W,O?0:void 0),r.push(p)}else{var B,U;if("Reference"===f)B=C,U=y;else if("Instance"===f)B=I,U=w;else if("Unknown"===f&&u.inTypes&&u.inTypes.length>0&&"ds6wg:ClassificationAttributes"===u.inTypes[0]){let e=[t.moreAttributesWizard.classificationAttrTooltip];B=e,U=e}var L=o._checkSelected(p,f,x),j={attrName:p,attrDBName:x,valueInAuthoring:A,attrTitle:u.label,attrDesc:u.description,attrKind:u.dataType.substring(u.dataType.indexOf("#")+1),attrInType:B,attrInTypeNLS:U,classif:!(!B||!B.includes("Classification Attribute"))||void 0,multiline:!(!u.multiline||"true"!==u.multiline.toLowerCase())||void 0,declaredIn:h,attrSel:L,attrParent:f};E.dimension&&(j.convertInfos=E,j.attrKind=void 0,j.typeRepresentation="string");var H=new m({label:u.label,grid:j});o.options.models[i].addRoot(H,L?0:void 0),r.push(p)}}}}if(!0===o.instanceMgt){p="positionMatrix-Instance",L=o._checkSelected(p,"Instance"),H=new m({label:t.attributesCustomization.instanceMatrix,grid:{attrName:p,attrTitle:t.attributesCustomization.instanceMatrix,attrDesc:"",attrKind:"string",attrInType:["VPMInstance"],attrInTypeNLS:[o.getNLSForTypes("VPMInstance")],attrSel:L,attrParent:"Instance"}});o.options.models[i].addRoot(H,L?0:void 0),r.push(p)}e({})}))}))}})}));