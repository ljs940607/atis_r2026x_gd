define("DS/DocumentCommonInfra/Utils/DocmUtilities",["UWA/Utils","DS/ZipJS/deflate","DS/ZipJS/inflate"],(function(e){return{jsonZip:function(t){if(t.length>0&&"{"!==t[0]&&"["!==t[0])return t;for(var n=new ArrayBuffer(t.length),a=new Uint8Array(n),i=0;i<t.length;i++)a[i]=t.charCodeAt(i);var o=new Deflater;o.append(a);var s=o.flush(),r=String.fromCharCode.apply(null,s);return e.base64Encode(r)},jsonUnzip:function(t){if(t.length>0&&("{"===t[0]||"["===t[0]))return t;if(t.length>0&&0===t.indexOf("root,"))return"{}";var n=t;try{n=e.base64Decode(t)}catch(e){}for(var a=new ArrayBuffer(n.length),i=new Uint8Array(a),o=0;o<n.length;o++)i[o]=n.charCodeAt(o);var s=new Inflater,r=s.append(i);return s.flush(),String.fromCharCode.apply(null,r)},makeRequestWithRetry:function(e=1,t){let n=0;const a=i=>{if(n++,n>=e)throw new Error(`Request failed after ${e} attempts.`);return console.log(`Retrying request: attempt ${n}`),t().catch(a)};return t().catch(a)}}})),define("DS/DocumentCommonInfra/Utils/GetCollabOrgConfiguration",["UWA/Core","UWA/Promise","DS/WAFData/WAFData"],(function(e,t,n){"use strict";return e.Class.singleton({init:function(){},configurations:{createCtxConfiguration:{}},fetchgetCreateCtxCongiguration:function(e){var t=this,a=e.tenantUrl+"/resources/vplmte/getcreatectx?policy=Document Release&",i={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},onComplete:function(n){t.configurations.createCtxConfiguration[e.securityContext].resolve(n.credentials)},onFailure:function(n){t.configurations.createCtxConfiguration[e.securityContext].reject(n)},type:"json"};n.authenticatedRequest(a,i)},refreshConfigurations:function(){this.configurations={createCtxConfiguration:{}}},getcreateCtxValue:function(e){var n=this;return n.configurations.createCtxConfiguration[e.securityContext]||(n.configurations.createCtxConfiguration[e.securityContext]=t.deferred(),n.fetchgetCreateCtxCongiguration(e)),n.configurations.createCtxConfiguration[e.securityContext]}})})),define("DS/DocumentCommonInfra/components/DeleteDialog",["UWA/Core","DS/Utilities/Dom","UWA/Controls/Abstract","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Toggle","DS/Controls/Button","DS/Core/WebUXGlobalEnums","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/DataGridView/DataGridView","DS/Controls/Loader","DS/Controls/ModalContainer","i18n!DS/DocumentCommonInfra/assets/nls/DocumentCommonInfra","css!DS/DocumentCommonInfra/css/DeleteDialog.css"],(function(e,t,n,a,i,o,s,r,l,d,c,m,u,p,f){return n.extend({modal:{},name:"docm-delete-dialog",options:{className:""},_options:{},modelEvents:void 0,init:function(e){e.events&&(this.events=e.events,delete e.events),this._parent(e),this.events&&(e.events=this.events),this.loader=new m,this.selectionCount=this.options.getSelectedNodes().length,this.buildSkeleton()},buildSkeleton:function(){var t=this;t.components={},t.immersiveFrame=new a({identifier:"delete_dialog"}),t.components.mainContainer=e.createElement("div",{class:"MainContainer",styles:{display:"flex","flex-direction":"column",height:"100%"}}),t.components.warningMessage=e.createElement("div",{class:"warningMessage",styles:{display:"flex",float:"left","margin-bottom":"5px"}}).inject(t.components.mainContainer),t.components.warningImageSrc=t.options.platformUrls["3DSpace"]+"/webapps/DocumentCommonInfra/assets/images/warning.png",t.components.warningImage=e.createElement("img",{src:t.components.warningImageSrc,class:"Doc-Delete-Dialog-WarningImage",alt:"Image Description",width:"35px",height:"30px"}).inject(t.components.warningMessage),t.components.warningText=e.createElement("div",{class:"warningTextContainer",styles:{color:"#3d3d3d","font-size":"12px","margin-left":"10px","flex-grow":"1"}}).inject(t.components.warningMessage),t.components.warningText1=e.createElement("div",{class:"warningText",text:p.get("Delete_Warning1",{content:t.selectionCount>1?p.get("SelectedObjects"):t.options.getSelectedNodes()[0].options.title}),styles:{"white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}}).inject(t.components.warningText),t.components.warningText2=e.createElement("div",{class:"warningText",text:p.get("Delete_Warning2"),styles:{"white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}}).inject(t.components.warningText),t.components.confirmationToogle=new o({type:"checkbox",label:p.get("Delete_Warning3"),value:0,checkFlag:!1,domId:"confirmationToogle"}).inject(t.components.mainContainer),t.components.confirmationToogle.addEventListener("change",(function(e){var n=e.dsModel;t.components.myDialog.buttons.Yes.disabled=!n.checkFlag})),t.selectionCount>1&&t.prepareGridView();var n=t.selectionCount>1?`- ${t.selectionCount} ${p.get("Objects")}`:" - "+t.options.getSelectedNodes()[0].options.title;t.components.myDialog=new i({immersiveFrame:t.immersiveFrame,domId:"Doc-Delete-Dialog",identifier:"Doc-DeleteDialog-"+t.selectionCount>1?"multi-selection":"single-selection",title:p.get("Delete")+n,content:t.components.mainContainer,activeFlag:!1,resizableFlag:!0,width:500,height:t.selectionCount>1?300:150,modalFlag:!0,buttons:{Yes:new s({label:p.get("Delete"),domId:"DocDialog-DeleteButton",disabled:!0,onClick:function(e){t.events&&t.events.publish({event:"doco-delete-dialog-action",data:{action:"Delete"}}),t.options&&t.options.onDelete&&t.options.onDelete({context:t,dialog:e.dsModel}),e.dsModel.dialog.destroy(),t.immersiveFrame.destroy(),e.dsModel=null},role:r.WUXCustomButtonRoleEnum.Validate}),Cancel:new s({onClick:function(e){t.events&&t.events.publish({event:"doco-delete-dialog-action",data:{action:"Cancel"}}),t.options&&t.options.onCancel&&t.options.onCancel({context:t,dialog:e.dsModel}),e.dsModel.dialog.destroy(),t.immersiveFrame.destroy(),e.dsModel=null}})}}),t.components.myDialog.height=t.selectionCount>1?300:150,t.components.myDialog.width=500,t.components.myDialog.addEventListener("close",(e=>{t.immersiveFrame.destroy()})),t.immersiveFrame.inject(widget.body)},prepareGridView:async function(){var n=this;this.startLoading();var a=[{dataIndex:"title",text:p.get("Title"),editableFlag:!1,width:"50%"},{dataIndex:"preCheckStatus",text:p.get("Access_Check"),editableFlag:!1,alignment:"center",className:"coloured-boolean",typeRepresentation:"boolean",alignment:"center",width:"50%",onCellRequest:function(e){if(null==e.nodeModel.getAttributeValue("preCheckStatus")){var t=n.components.dataGridView.reuseCellContent("warning");e.cellView.setReusableContent(t)}else this.defaultOnCellRequest(e)}}];if(n.options.dialogCustomizations&&n.options.dialogCustomizations.customizeColumns){var i=n.options.dialogCustomizations.customizeColumns(a);i&&(a=i)}var o=n.prepareData();if(n.options.dialogCustomizations&&n.options.dialogCustomizations.customizeData){var s=await n.options.dialogCustomizations.customizeData(o);s&&(o=s)}var r=new l;r.prepareUpdate();for(var m=0,u=o.length;m<u;m++){var f=o[m],g=new d({label:f.title,grid:f.grid});r.addRoot(g)}if(r.expandAll(),r.pushUpdate(),n.options.dialogCustomizations&&n.options.dialogCustomizations.customizeTreeDocument){var w=n.options.dialogCustomizations.customizeTreeDocument(r);w&&(r=w)}n.components.gridView=e.createElement("div",{class:"doc-DeleteDialog-gridview",styles:{position:"relative","flex-grow":"1"}}).inject(n.components.mainContainer);var v={identifier:"doc-DeleteDialog-gridview",showSelectionCheckBoxesFlag:!1,treeDocument:r,columns:a,layoutOptions:{useLastColumnWidthAutoFlag:!0}};o.length>5&&(v.maxVisibleRowCount=5),n.components.dataGridView=new c(v),n.components.dataGridView.onContextualEvent=function(e){var t=[];if(e&&e.collectionView&&-1===e.cellInfos.rowID){t=e.collectionView.buildDefaultContextualMenu(e,{pin:!1,firstColumnsVisibility:!1,columnsManagement:!1,sizeColumnToFit:!0,insertRow:!1})}return t},n.components.dataGridView.registerReusableCellContent({id:"warning",buildContent:function(){return t.generateIcon({iconName:"help"})}}),n.components.dataGridView.inject(n.components.gridView),n.finishLoading()},prepareData:function(){var t=this,n=[];return t.options.getSelectedNodes&&t.options.getSelectedNodes().length&&t.options.getSelectedNodes().forEach((t=>{n.push({title:e.clone(t.options.grid.title),data:e.clone(t.options.data),grid:{...e.clone(t.options.grid),preCheckStatus:!0}})})),n},startLoading:function(){this.isLoadingInProgress=!0,this.loader.on(),u.createModal(this.components.mainContainer,this.loader.elements.container)},finishLoading:function(){this.isLoadingInProgress=!1,this.loader.off(),u.removeModal(this.components.mainContainer)}})})),define("DS/DocumentCommonInfra/Model",["UWA/Core","DS/TreeModel/TreeNodeModel","DS/Tweakers/TypeRepresentationFactory","DS/Controls/Label","i18n!DS/DocumentCommonInfra/assets/nls/DocumentCommonInfra"],(function(e,t,n,a,i){"use strict";var o=new n;function s(t,n){t.dataelements.originated&&(t.dataelements.originated=new Date(t.dataelements.originated)),t.dataelements.modified&&(t.dataelements.modified=new Date(t.dataelements.modified)),o.generateView(t.dataelements.modified,{readOnly:!0,typePath:"datetime",onViewCreated:function(e){t.dataelements.modifiedAsString=e.getContent().getText()}}),""==t.dataelements.reservedby&&(t.dataelements.reservedby=void 0),t.dataelements.type=t.type;var s={data:t,grid:t.dataelements};if(s.label=t.dataelements.title||t.dataelements.secondaryTitle||t.dataelements.name,s.title=t.dataelements.title||t.dataelements.secondaryTitle||t.dataelements.name,s.icons=[{iconName:"doc-text"}],s.grid.tree=s.title,s.thumbnail=t.dataelements.indexedImage||t.dataelements.image,s.taxonomies=[t.type],"TRUE"!=t.dataelements.isDocumentType||s.taxonomies.includes("Document")||s.taxonomies.push("Document"),s.thumbnail.endsWith("snresources/images/icons/small/I_CDM_Document.png")&&(s.thumbnail=s.thumbnail.replace("small/I_CDM_Document.png","large/I_TextDoc200x150.png")),s.icons=[t.dataelements.indexedTypeicon||t.dataelements.typeicon],t.relateddata&&t.relateddata.ownerInfo&&1==t.relateddata.ownerInfo.length&&t.relateddata.ownerInfo[0].dataelements&&(t.dataelements.owner={label:t.relateddata.ownerInfo[0].dataelements.fullname||t.relateddata.ownerInfo[0].dataelements.firstname+" "+t.relateddata.ownerInfo[0].dataelements.lastname,username:t.relateddata.ownerInfo[0].dataelements.name},n&&n["3DSwym"]&&(t.dataelements.owner.icon=n["3DSwym"]+"/api/user/getpicture/login/"+t.relateddata.ownerInfo[0].dataelements.name+"/format/mini")),t.relateddata&&t.relateddata.originatorInfo&&1==t.relateddata.originatorInfo.length&&t.relateddata.originatorInfo[0].dataelements&&(t.dataelements.originator={label:t.relateddata.originatorInfo[0].dataelements.fullname||t.relateddata.originatorInfo[0].dataelements.firstname+" "+t.relateddata.originatorInfo[0].dataelements.lastname,username:t.relateddata.originatorInfo[0].dataelements.name},n&&n["3DSwym"]&&t.relateddata.originatorInfo[0].dataelements.name&&(t.dataelements.originator.icon=n["3DSwym"]+"/api/user/getpicture/login/"+t.relateddata.originatorInfo[0].dataelements.name+"/format/mini")),t.relateddata&&t.relateddata.files&&t.relateddata.files.length>0){var l=[];function c(e){let t=[],n=!0;return e.forEach((e=>{const a=e.relateddata.lockerInfo;if(a&&a[0].dataelements){const e=a[0],n=e.dataelements.firstname+" "+e.dataelements.lastname;t.push(n)}else n=!1})),n||0!==t.length?1===t.length?t[0]:"varies":""}t.relateddata.files.forEach((t=>{var n;t.dataelements&&e.is(t.dataelements.title,"string")&&l.push((n=t.dataelements.title).substring(n.lastIndexOf(".")+1,n.length)||n)})),t.dataelements.fileExtension=l.join(", ");var d=c(t.relateddata.files);t.dataelements.lockStatus=d}return s.subLabel=function(t){var n=e.createElement("div",{class:"NameAndState"});return o.generateView(t.grid.owner,{readOnly:!0,typePath:"user",onViewCreated:function(e){e.inject(n)}}),new a({value:t.grid.stateNLS,emphasize:r.getStateEmphasisClassname(t.data)}).inject(n),n}(s),s.description=function(t){var n=e.createElement("div",{class:"property-description"});return o.generateView(i.get("e6wDocumentField.modified")+":",{readOnly:!0,typePath:"string",onViewCreated:function(e){e.inject(n)}}),o.generateView(t.grid.modified,{readOnly:!0,typePath:"datetime",onViewCreated:function(e){e.inject(n)}}),n}(s),s.customTooltip=`${i.get("e6wDocumentField.title")}: ${s.label}\n${i.get("e6wDocumentField.typeNLS")}: ${t.dataelements.typeNLS}\n${i.get("e6wDocumentField.owner")}: ${t.dataelements.owner?t.dataelements.owner.label:t.responsibleUid}\n${i.get("e6wDocumentField.revision")}: ${t.dataelements.revision} \n${i.get("e6wDocumentField.stateNLS")}: ${t.dataelements.stateNLS}\n${i.get("e6wDocumentField.modified")}: ${t.dataelements.modifiedAsString}\n${i.get("e6wDocumentField.collabSpaceTitle")}: ${t.dataelements.collabSpaceTitle}\n${i.get("e6wDocumentField.name")}: ${t.dataelements.name}`,s.getAttributeValueForFiltering=function(e){switch(console.log(e),e){case"files":return t.relateddata.files.length;case"owner":return t.dataelements.owner.label;case"label":return t.dataelements.title;case"lockStatus":let n=[];if(t&&t.relateddata&&t.relateddata.files&&t.relateddata.files.length>1){let e=0,a=t.relateddata.files.map((t=>{let n="";return t&&t.relateddata&&t.relateddata.lockerInfo&&t.relateddata.lockerInfo[0]&&t.relateddata.lockerInfo[0].dataelements?(n=t.relateddata.lockerInfo[0].dataelements.firstname+" "+t.relateddata.lockerInfo[0].dataelements.lastname,e++,n):void 0}));return e>0&&(n=a.filter((e=>e))),n}if(t&&t.relateddata&&t.relateddata.files&&t.relateddata.files.length<=1){let e="";return t&&t.relateddata&&t.relateddata.files&&t.relateddata.files[0]&&t.relateddata.files[0].relateddata&&t.relateddata.files[0].relateddata.lockerInfo&&t.relateddata.files[0].relateddata.lockerInfo[0]&&t.relateddata.files[0].relateddata.lockerInfo[0].dataelements?(e=t.relateddata.files[0].relateddata.lockerInfo[0].dataelements.firstname+" "+t.relateddata.files[0].relateddata.lockerInfo[0].dataelements.lastname,e):void 0}default:return t.dataelements[e]}},s}var r=function(e,n){var a=s(e,n);a.updateData=function(e){i.updateOptions(s(e,n))};var i=new t(a);return i};return r.getStateEmphasisClassname=function(e){return"class-name-of-no-use doco-state-badge doco-state-"+e.dataelements.policy.replace(/ /g,"_")+"-"+e.dataelements.state.replace(/ /g,"_")},r})),define("DS/DocumentCommonInfra/MaturityColors",["UWA/Core","UWA/Element","DS/WAFData/WAFData"],(function(e,t,n){"use strict";e.createElement("style",{html:" .doco-state-badge {\n        background-color: rgb(117, 117, 117);\n        color: white;\n        font-weight: bold;\n        padding: 0 4px;\n        margin: 1px 3px;\n        width: 80px;\n    }"}).inject(document.body);var a={},i={cachedPolicies:null,cachedPoliciesStatesIdentifier:[],cachedPoliciesStatesInfo:[],setup:function(e){i.options=e,i.load()},fetchPolicies:function(t,o){if(i.cachedPolicies&&i.cachedPolicies[widget.lang]&&t.every(i.hasStateInfoForDoc))o(i.cachedPolicies);else{var s={url:i.options.platformUrls["3DSpace"]+"/resources/lifecycle/maturity/getStateGraph?tenant="+i.options.platformUrls.platformId,type:"json",method:"POST",headers:{Accept:"application/json","Accept-Language":widget.lang,"Content-Type":"application/json",securitycontext:encodeURIComponent(i.options.fetchSecurityContext())??void 0},data:JSON.stringify({data:t.map((function(e){return{physicalid:e.id}}))}),onComplete:function(t){t.status&&null==t.status.errorMsg&&(i.cachedPolicies=i.cachedPolicies||{},i.cachedPolicies[widget.lang]=i.cachedPolicies[widget.lang]||{},t.data.policies.forEach((function(t){i.cachedPolicies[widget.lang][t.name]=i.cachedPolicies[widget.lang][t.name]||{},t.maturityGraph.states.forEach((function(n){i.cachedPolicies[widget.lang][t.name][n.stateSysName]=n;var o=t.name+"---"+n.stateSysName;if(!i.cachedPoliciesStatesIdentifier.includes(o)&&(i.cachedPoliciesStatesIdentifier.push(o),null==a[o])){var s=void 0;s="#FFFFFF"==n.activeColor?e.createElement("style",{html:` .doco-state-${t.name.replace(/ /g,"_")}-${n.stateSysName.replace(/ /g,"_")} {\n                                                            background-color: ${n.activeColor}; \n                                                            color: black;border: 2px solid black;\n                                                        }`}):e.createElement("style",{html:` .doco-state-${t.name.replace(/ /g,"_")}-${n.stateSysName.replace(/ /g,"_")} {\n                                                            background-color: ${n.activeColor}; }`}),a[o]=s,s.inject(document.body)}}))}))),o(i.cachedPolicies)},onFailure:function(e,t){}};n.authenticatedRequest(s.url,s)}},load:function(){var e=null;null!=e&&null!=(e=JSON.parse(e))&&(i.cachedPolicies=e)},hasStateInfoForDoc:function(e){if(i.cachedPolicies&&i.cachedPolicies[widget.lang]&&(null!=i.cachedPolicies[widget.lang][e.dataelements.policy]&&null!=i.cachedPolicies[widget.lang][e.dataelements.policy][e.dataelements.state]))return!0;return!1}};return i})),define("DS/DocumentCommonInfra/TrackerAPI",["DS/Usage/TrackerAPI"],(function(e){"use strict";var t={sendTrackerPageEvent:function({category:n,action:a,label:i,pd:o,pv:s}){e.trackPageEvent({eventCategory:n,eventAction:a,eventLabel:i,appID:"ENXWDOC_AP",tenant:widget.data.x3dPlatformId||widget.tenant,persDim:t.preparePersonalDimensions(o),persVal:t.preparePersonalValues(s)})},getRegion:function(){var e,t;if(widget){var n=widget.uwaUrl;null!=n&&(e=n.split("-")),null!=e&&e.length>0&&(t=e[1])}return t},getClusterId:function(){var e,t;if(widget){var n=widget.uwaUrl;null!=n&&(e=n.split("-")),null!=e&&e.length>0&&(t=e[2])}return t},preparePersonalDimensions:function(e){let n={pd1:t.getRegion(),pd2:t.getClusterId(),pd3:widget.data.appId},a=Object.keys(n).length+1;return Object.keys(e).length>0&&Object.values(e).forEach((e=>{n["pd"+a]=e,a++})),n},preparePersonalValues:function(e){let t={},n=1;return Object.keys(e).length&&Object.values(e).forEach((e=>{t["pv"+n]=e,n++})),t}};return t})),define("DS/DocumentCommonInfra/components/UploadFileDialog",["UWA/Controls/Abstract","DS/Form/Form","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Core/WebUXGlobalEnums","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/DataGridView/DataGridView","DS/Controls/Button","DS/Core/WebUXGlobalEnums","i18n!DS/DocumentCommonInfra/assets/nls/DocumentCommonInfra","css!DS/DocumentCommonInfra/css/UploadFileDialog.css"],(function(e,t,n,a,i,o,s,r,l,d,c,m){return e.extend({modal:{},name:"docm-upload-file-dialog",options:{className:""},_options:{},modelEvents:void 0,init:function(e){e.events&&(this.events=e.events,delete e.events),this._parent(e),this.events&&(e.events=this.events),this.options.dialogCustomizations||(this.options.dialogCustomizations={}),this.buildSkeleton()},buildSkeleton:function(){var e=this;e.immersiveFrame=new n({identifier:"upload_file"}),e.options.files.length>1?e.prepareGridView():e.prepareForm();var t=e.options.files.length>1?`- ${e.options.files.length} ${c.get("Files")}`:" - "+e.options.files[0].name;e.myDialog=new a({immersiveFrame:e.immersiveFrame,domId:"Doc-Upload-file-Dialog",identifier:"Doc-UploadFileDialog-"+e.options.files.length>1?"multi-selection":"single-selection",title:(e.options.dialogCustomizations.defaultPrimaryDialogLabel?e.options.dialogCustomizations.defaultPrimaryDialogLabel:c.get("Upload"))+t,content:e.container,activeFlag:!1,resizableFlag:!0,width:500,height:"100%",height:e.options.files.length>1?300:150,modalFlag:!0,buttons:{Yes:new l({label:e.options.dialogCustomizations.defaultPrimaryButtonLabel?e.options.dialogCustomizations.defaultPrimaryButtonLabel:c.get("Upload"),domId:"DocDialog-UploadButton",disabled:"Enabled"==e.options.mandatoryCommentValueConfiguartionSetting&&!e.options.dialogCustomizations.defaultCommentValue,onClick:function(t){e.events&&e.events.publish({event:"doco-uploadfile-dialog-action",data:{action:"upload"}}),e.options&&e.options.onUploadFile&&e.options.onUploadFile({context:e,dialog:t.dsModel}),t.dsModel.dialog.destroy(),e.immersiveFrame.destroy(),t.dsModel=null},role:d.WUXCustomButtonRoleEnum.Validate}),Cancel:new l({onClick:function(t){e.events&&e.events.publish({event:"doco-uploadfile-dialog-action",data:{action:"Cancel"}}),e.options&&e.options.onCancel&&e.options.onCancel({context:e,dialog:t.dsModel}),t.dsModel.dialog.destroy(),e.immersiveFrame.destroy(),t.dsModel=null}})}}),e.myDialog.height=e.options.files.length>1?350:210,e.myDialog.width=500,e.myDialog.addEventListener("close",(t=>{e.immersiveFrame.destroy()})),this.DialogButtonVisibilityChecker=function(){var e=this,t=e.myForm.invalidState,n=e.myDialog.getCustomButtons()[0];t||1==e.myDialog._isCreateInProgress?n.disabled=!0:(e.myForm.globalInformation=void 0,n.disabled=!1)},e.myDialog._isCreateInProgress=!1,e.immersiveFrame.inject(widget.body)},prepareGridView:function(){var e=this,t=[{dataIndex:"title",text:c.get("Title"),editableFlag:!1,width:"40%"}];"Enabled"==e.options.mandatoryCommentValueConfiguartionSetting?t.push({dataIndex:"comments",editableFlag:!0,width:"60%",customHeader:{buildContent:function(e){const t=UWA.createElement("div");t.className="docm-dgView-columnContainer";const n=UWA.createElement("span");n.className="docm-dgView-columnContainer-text",n.textContent=c.get("e6wDocumentField.comments");const a=UWA.createElement("div");a.className="icon-container docm-mandatory";const i=UWA.createElement("i");return i.className="icon",i.textContent="*",a.appendChild(i),t.appendChild(n),t.appendChild(a),t}},updateContent(e){}}):t.push({dataIndex:"comments",text:c.get("e6wDocumentField.comments"),editableFlag:!0,width:"60%"});var n=new o;n.prepareUpdate();for(var a=0;a<e.options.files.length;a++){var i=e.options.files[a];n.addRoot(new s({label:i.name,data:{file:i},grid:{title:i.name,comments:""}}))}n.expandAll(),n.pushUpdate();var l={identifier:"doc-UploadFileDialog-gridview",showSelectionCheckBoxesFlag:!1,treeDocument:n,columns:t,layoutOptions:{useLastColumnWidthAutoFlag:!0}};e.dataGridView=new r(l),e.dataGridView.onContextualEvent=function(e){var t=[];if(e&&e.collectionView&&-1===e.cellInfos.rowID){t=e.collectionView.buildDefaultContextualMenu(e,{pin:!1,firstColumnsVisibility:!1,columnsManagement:!1,sizeColumnToFit:!0,insertRow:!1})}return t},e.container=e.dataGridView,e.dataGridView.getTreeDocument().onNodeModelUpdate((t=>{e.validateUploadButton(t)}))},prepareForm:function(){var e=this,n=[{id:"file",label:c.get("File"),typeRepresentation:"file",onNodeUpdate:function(t){e.myDialog.setProperties({title:(e.options.dialogCustomizations.defaultPrimaryDialogLabel?e.options.dialogCustomizations.defaultPrimaryDialogLabel:c.get("Upload"))+" - "+t.value.name})},value:e.options.files[0],settings:{domId:"file",width:"100%",requiredFlag:!0},semantics:{disabled:!1}},{id:"comments",value:e.options.dialogCustomizations.defaultCommentValue?e.options.dialogCustomizations.defaultCommentValue:void 0,label:c.get("Comments"),typeRepresentation:"multilineString",requiredFlag:"Enabled"==e.options.mandatoryCommentValueConfiguartionSetting,onNodeLiveUpdate:e=>{this.validateUploadButton(e)},context:"stdTemplate",height:70,settings:{domId:"FileComment",selectAllOnFocus:!0,displayClearFieldButtonFlag:!1,requiredFlag:!0}}];"disabled"==e.options.dialogCustomizations.fileUploader&&n.shift(),e.myForm=new t({invalidDisplayPolicy:d.InvalidDisplayPolicy.OnInput,events:{change:function(t){e.valueChanged(t,e)}},model:n,usePaddingFlag:!0}),e.container=e.myForm},validateUploadButton:function(e){var t=this;if("Enabled"==t.options.mandatoryCommentValueConfiguartionSetting)if(1==t.options.files.length){var n=e.id,a=e.value.trim();a||(a="");var i=a.length<1;t.myForm.updateModelItem(n,{invalidTooltip:{shortHelp:c.get("CanNotBeEmpty",{field:c.get("Comment")})}}),i?(t.myDialog._properties.buttons.value.Yes.disabled=!0,t.myForm.globalInformation={text:c.get("CanNotBeEmpty",{field:c.get("Comment")}),emphasize:"error"}):(t.myDialog._properties.buttons.value.Yes.disabled=!1,t.myForm.globalInformation=void 0)}else for(var o=!0,s=0;s<t.dataGridView.treeDocument.getAllDescendants().length;s++){(i=0==t.dataGridView.treeDocument.getAllDescendants()[s]._options.grid.comments)&&(o=!1),t.myDialog._properties.buttons.value.Yes.disabled=!o}}})})),define("DS/DocumentCommonInfra/Utils/MePreferencesHandler",["UWA/Utils","DS/WAFData/WAFData","DS/MePreferencesClientAPI/MePreferencesClientAPI"],(function(e,t,n){"use strict";function a(e){this.options=e}return a.prototype.getMePreferencesDialog=function(e,t,a,i){return!(!n||!n.getMePreferencesDialog)&&n.getMePreferencesDialog(e,{startBuildDlg:!0,variation:{preference:{name:t,repoName:a},type:i}})},a.prototype.readPreferences=function(e,t){return!(!n||!n.readPreferences)&&n.readPreferences([{Repository:e,PreferenceNames:t}])},a})),define("DS/DocumentCommonInfra/DocDictionary",["UWA/Core","DS/WAFData/WAFData","DS/FedDictionaryAccess/FedDictionaryAccessAPI"],(function(e,t,n){"use strict";return e.Class.extend({ready:e.Promise.deferred(),updateStatusToResolved:function(){this.status="Resolved"},updateStatusToRejected:function(){this.status="Rejected"},init:function(a){var i=this;this.status="Pending";var o={url:a.tenantUrl+"/resources/dictionary/getTypeInfo?$filter=isOOTB+eq+false",type:"json",method:"POST",headers:{Accept:"application/json","Accept-Language":widget.lang,"Content-Type":"application/json"},timeout:18e4,data:JSON.stringify(["Document"]),onComplete:function(o,s){var r=["Document"];Object.keys(o).forEach((e=>{"Document Proxy"!=e&&r.push(e)}));var l={url:a.tenantUrl+"/resources/dictionary/class/interfaces",type:"json",method:"POST",headers:{Accept:"application/json","Accept-Language":widget.lang,"Content-Type":"application/json"},timeout:18e4,data:JSON.stringify({classes:r}),onComplete:function(o,s){var l=[];o.results.forEach((e=>{e.interfaces.forEach((e=>{l.includes(e.name)||l.push(e.name)}))}));var d=new e.Promise((function(e,n){var i={url:a.tenantUrl+"/resources/dictionary/class/properties?$select=name,nlsName,protection",type:"json",method:"POST",headers:{Accept:"application/json","Accept-Language":widget.lang,"Content-Type":"application/json"},timeout:18e4,data:JSON.stringify({classes:[...r,...l]}),onComplete:function(t,n){var a={};t.results.forEach((e=>{e.properties.forEach((e=>a[e.name]=e.nlsName))})),e(a)},onFailure:function(e,t){n()}};t.authenticatedRequest(i.url,i)})),c=new e.Promise((function(t,i){n.getPropertiesForClass([...r,...l].map((e=>"ds6wg:"+e)).join(),{tenantId:a.tenant,lang:widget.lang,apiVersion:"R2019x",onComplete:function(n){n=e.is(n,"string")?JSON.parse(n):n,t(n)},onFailure:function(e){i()}})}));e.Promise.all([d,c]).then((function(e){i.updateStatusToResolved(),i.ready.resolve(e)}),(function(){i.updateStatusToRejected(),i.ready.reject()}))},onFailure:function(e,t){i.updateStatusToRejected(),i.ready.reject()}};t.authenticatedRequest(l.url,l)},onFailure:function(e,t){i.updateStatusToRejected(),i.ready.reject()}};t.authenticatedRequest(o.url,o)}})})),define("DS/DocumentCommonInfra/Utils/GetWidgetConfiguration",["UWA/Core","UWA/Promise","DS/WAFData/WAFData","DS/DocumentCommonInfra/Utils/MePreferencesHandler"],(function(e,t,n,a){"use strict";return e.Class.singleton({init:function(){this.mePreferenceHandler=new a},configurations:{commentConfiguration:{}},fetchCommentMandtatoryConf:function(e){var t=this,a=e.platformUrls["3DSpace"]+"/resources/v1/modeler/documents/commentAsMandatory/";n.authenticatedRequest(a,{method:"GET",type:"json",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:encodeURIComponent(e.securityContext)},onComplete:function(n){t.configurations.commentConfiguration[e.securityContext].resolve(n.data[0].dataelements?n.data[0].dataelements.CommentAsMandatoryValue:"Disabled")},onFailure:function(n){console.error("commentMandatoryEnablement onFailure case","false"),t.configurations.commentConfiguration[e.securityContext].resolve("Disabled")}})},refreshConfigurations:function(){this.configurations={commentConfiguration:{}}},getcommentAsMandtoryConfigValue:function(e){var n=this;return n.configurations.commentConfiguration[e.securityContext]||(n.configurations.commentConfiguration[e.securityContext]=t.deferred(),n.fetchCommentMandtatoryConf(e)),n.configurations.commentConfiguration[e.securityContext]},fetchMePreferences:async function(e){var t="ENXWDOC",n=this;return new Promise((async(a,i)=>{try{const o=this.mePreferenceHandler.readPreferences("DocumentManagementRepository",[`${t}_TABLE_DEFAULT`,`${t}_TABLE_CUSTO`,`${t}_TABLE_DENSITY`]);Promise.all([o,n.fetchAdminViews(e)]).then((e=>{const n=e[0],i=JSON.parse(e[1]),o=n.repositories?.[0]?.preferences||[],s=o.find((e=>e.name===`${t}_TABLE_DEFAULT`)),r=o.find((e=>e.name===`${t}_TABLE_CUSTO`)),l=o.find((e=>e.name===`${t}_TABLE_DENSITY`)),d=s&&JSON.parse(s.value).view||{},c=r&&JSON.parse(r.value).views||{},m=l.value;a({defaultView:d,adminViews:{...i},userViews:{...c},gridDensity:m||"compact"})})).catch((e=>{i("Failed to fetch the preferences.")}))}catch(e){console.error(e),i("Failed to fetch the preferences ")}}))},fetchAdminViews:function(e){const t=`${e.platformUrls["3DSpace"]}/resources/v1/modeler/documents/fetchDocmAdminViews`;return this.executeRequest(t,{method:"GET",headers:{"Content-Type":"application/json"}})},manageAdminViews:function(e){var t={action:e.action,views:e.views};const n=`${e.platformUrls["3DSpace"]}/resources/v1/modeler/documents/manageDocmAdminViews`,a={method:"POST",data:t,headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:encodeURIComponent(e.securityContext)}};return this.executeRequest(n,a)},__executeRequest:function(e,t){return n.authenticatedRequest(e,t)},executeRequest:function(e,t){return new Promise(((n,a)=>{t.onComplete=function(e){n(e)},t.onFailure=function(e){a(e)},t.onTimeout=function(e){a(e)},"POST"===t.method&&"string"!=typeof t.data&&(t.data=JSON.stringify(t.data)),this.__executeRequest(e,t)}))}})})),define("DS/DocumentCommonInfra/Utils/ViewManager",["UWA/Utils","DS/CoreEvents/ModelEvents","DS/DocumentCommonInfra/Utils/DocmUtilities","DS/DocumentCommonInfra/Utils/GetWidgetConfiguration","DS/PlatformAPI/PlatformAPI","text!DS/DocumentCommonInfra/assets/config/ENXWDOC_AP_Table_MePreference_Config.json","i18n!DS/DocumentCommonInfra/assets/nls/DocumentCommonInfra"],(function(e,t,n,a,i,o,s){var r=JSON.parse(o);function l({id:n=e.getUUID(),value:a={},viewName:i="",viewType:o="unknown",modelEvents:s=new t,viewDensity:r="compact",sortModel:l=[{sortAttribute:"modified",sort:"desc",dataIndex:"modified",dataIndex6w:"ds6w:modified"}]}){this.id=n,this.columnMap=new Map(a.columns.map((e=>[e.id,e]))),this.modelEvents=s,this.viewType=o,this.viewName=i,this.viewDensity=r,this.hasUncommittedChanges=!1,this.unCommittedViewValue=void 0,this.sortModel=l}function d(e,t){this.app=e,this.modelEvents=t,this.gridDensity="compact",this.selectedView=void 0,this.views=new Map}return l.prototype.updateView=function(e){this.value=e,this.columnMap=new Map(e.columns.map((e=>[e.id,e])))},l.prototype.getViewValue=function(){return this.hasUncommittedChanges&&this.unCommittedView?this.unCommittedViewValue:this.columnMap},l.prototype.getZippedView=function(e=this.value){return n.jsonZip(JSON.stringify(e))},d.prototype.createView=function(e={}){return new l(e)},d.prototype.getView=function(e){return this.views.get(e)},d.prototype.getSelectedView=function(){return this.views.has(this.selectedView)||this.updateSelectedView("Docm_Default_View"),this.getView(this.selectedView)},d.prototype.updateSelectedView=function(e="Docm_Default_View"){this.views.has(e)&&(this.selectedView=e,this.modelEvents.publish({event:"docm-mepreference-view-manager",data:{name:"view-selected",selectedView:this.views.get(e)}}))},d.prototype.updateGridDensity=function(e){["compact","comfortable"].includes(e)&&this.gridDensity!=e&&(this.gridDensity=e,this.modelEvents.publish({event:"docm-mepreference-view-manager",data:{name:"grid-density-modified",newDensity:e}}))},d.prototype.getViews=function(){return Array.from(this.views.values())},d.prototype.loadPreferences=function(e){var t=this,a=[],i=e.defaultView||{};if("unset"==i||"object"==typeof i&&0==Object.keys(i).length){var o=[...r.defaultColumns,...r.externalColumns].map((e=>({id:e.name,type:"CommonAttribute",nlsKey:e.nlsKey,name:e.name,pinCol:e.pinned||"unpinned",curi:e.curi,visibleFlag:0!=e.visibleFlag})));a.push(new l({id:"Docm_Default_View",value:{columns:o},viewName:"Default",viewType:"default",modelEvents:t.modelEvents})),"object"==typeof i&&0==Object.keys(i).length&&widget&&widget.app&&widget.app.showNotification("error",s.get("FailedToLoadDefaultView"),s.get("FailedToLoadDefaultViewMessage"),"",!1,!1)}else{var d=JSON.parse(n.jsonUnzip(i.Docm_Default_View));a.push(new l({id:d.id,value:d.value,viewName:d.viewName,viewType:d.viewType,modelEvents:t.modelEvents}))}var c={...e.adminViews||{},...e.userViews||{}};for(let e in c)if(c.hasOwnProperty(e)){var m=c[e];d=JSON.parse(n.jsonUnzip(m));a.push(new l({id:d.id,value:d.value,viewName:d.viewName,viewType:d.viewType,modelEvents:t.modelEvents}))}if(a.length>0&&t.loadViews(a),a.length>0){var u=widget.data["view-status"]||"{}",p=JSON.parse(u).viewId;t.views.has(p)?t.updateSelectedView(p):t.updateSelectedView("Docm_Default_View")}t.gridDensity=e.gridDensity},d.prototype.loadViews=function(e=[]){var t=this,n=[];for(let d=0;d<e.length;d++){var a=e[d];if(a instanceof l)a.modelEvents=t.modelEvents,n.push(a);else if("object"==typeof a){var{id:i,viewType:o,value:s}=a,r=new l({id:i,value:s,viewType:o,modelEvents:t.modelEvents});n.push(r)}}t.addViews(n)},d.prototype.addViews=function(e=[]){for(let n=0;n<e.length;n++){var t=e[n];!t instanceof l?console.error("Failed to add View into Collection : unsupported View format!"):this.views.set(t.id,t)}},d.prototype.removeViews=function(e=[]){var t=this,n=[];e.forEach((e=>{var a=t.views.get(e);a&&(t.views.delete(e),n.push(a))}))},d.prototype.getUnCommittedState=function(){var e=widget.data["view-status"]||"{}",t=JSON.parse(e).viewId||"",n=JSON.parse(e).value||"";return{lastViewId:t,unCommittedCurrentView:t==this.selectedView,hasUnCommittedChanges:"unset"!=n}},d.prototype.getLocalView=function(){var e=widget.data["view-status"]?JSON.parse(widget.data["view-status"]):{},t=e.viewId||"",a=e.value||"",i=e.sortModel;return""==t||""==a?{viewId:void 0,value:void 0,columnMap:void 0}:{viewId:t,value:"unset"==a?"unset":JSON.parse(n.jsonUnzip(a)),sortModel:i,isSelectedView:this.getSelectedView().id==t}},d.prototype.reapplyViews=function(){this.modelEvents.publish({event:"docm-mepreference-view-manager",data:{name:"view-reload"}})},d.prototype.notifyViewsUpdate=function(){widget&&i.publish("docm-me-preference-custom-global",{name:"docm-me-preference-widgetviews-updated",tenant:this.app.core.getTenantId(),sourceWidgetId:widget.id,data:{views:this.getViews()}})},d.prototype.notifyAdminViewsUpdate=function(){widget&&i.publish("docm-me-preference-custom-global",{name:"docm-me-preference-widget-adminviews-updated",tenant:this.app.core.getTenantId(),sourceWidgetId:widget.id,data:{views:this.getViews().filter((e=>"admin"==e.viewType))}})},d.prototype.handleUserPreferenceChange=function(e){var t=this;if((Array.isArray(e)||0!=e.filter((e=>e.preferences)).length)&&e.filter((e=>e.preferences))[0].preferences){var n=JSON.parse(e.filter((e=>e.preferences))[0].preferences).repositories.filter((e=>"DocumentManagementRepository"==e.name));if(Array.isArray(n)||n[0]){var a=n[0].preferences;(a||Array.isArray(a))&&(a.forEach((e=>{switch(e.name){case"ENXWDOC_TABLE_DEFAULT":if("object"==typeof(n=JSON.parse(e.value))&&"view"in n){if(!(a=n.views).Docm_Default_View)break;t.updateViews({viewType:"default",views:a})}break;case"ENXWDOC_TABLE_CUSTO":var n;if("object"==typeof(n=JSON.parse(e.value))&&"views"in n){var a=n.views;t.updateViews({viewType:"user",views:a})}break;case"ENXWDOC_TABLE_DENSITY":t.updateGridDensity(e.value)}})),t.reapplyViews())}}},d.prototype.handleAdminViewsPreferenceChange=async function(e){var t=this;if(e.isAdminViewsEditable)try{await a.manageAdminViews({action:"replaceAll",views:e.adminViews,securityContext:t.app.core.fetchSecurityContext(),platformUrls:t.app.core.platformServices});t.updateViews({viewType:"admin",views:e.adminViews}),t.reapplyViews(),t.notifyAdminViewsUpdate()}catch(e){return void t.app.events.publish({event:"docv2-show-notification",data:{level:"error",title:s.get("ViewSaveFailed"),subtitle:s.get("FailedViewUpdateWarning"),message:"",sticky:!1,allowUnsafeHTML:!1}})}},d.prototype.updateViews=async function(e){var t=this,a=e.viewType,i=e.views||e.view;if("default"==a&&i.Docm_Default_View&&t.views.has("Docm_Default_View")){t.getView("Docm_Default_View").updateView(JSON.parse(n.jsonUnzip(i.Docm_Default_View)))}else{for(let[e,o]of t.views)o.viewType!==a||e in i&&JSON.parse(n.jsonUnzip(i[e])).viewType===a||this.removeViews([e]);var o=[];for(let[e,r]of Object.entries(i)){var s=JSON.parse(n.jsonUnzip(r));if(s.viewType===a)if(t.views.has(e)){this.views.get(e).updateView(s.value)}else o.push(new l({id:s.id,value:s.value,viewName:s.viewName,viewType:s.viewType,modelEvents:t.modelEvents}))}o.length>0&&t.loadViews(o)}},d})),define("DS/DocumentCommonInfra/Columns",["UWA/Core","DS/WAFData/WAFData","DS/DocumentCommonInfra/DocDictionary","DS/DocumentCommonInfra/Model","DS/RouteWebAppUX/scripts/RouteWebAppApprovalStatusUX","DS/DocumentCommonInfra/TrackerAPI","DS/DocumentCommonInfra/Utils/ViewManager","DS/DocumentCommonInfra/Utils/GetWidgetConfiguration","DS/DocumentCommonInfra/Utils/DocmUtilities","i18n!DS/DocumentCommonInfra/assets/nls/DocumentCommonInfra"],(function(e,t,n,a,i,o,s,r,l,d){"use strict";return e.Class.extend({ready:void 0,predefinedColumns:[{name:"title",includeAlways:!0,typeRepresentation:"url",dataIndex:"tree",pinned:"left",width:"300",className:"preview-column",curi:"ds6w:label"},{name:"name",typeRepresentation:"string",includeAlways:!0,className:"preview-column",curi:"ds6w:identifier"},{name:"policy",includeAlways:!0,hiddenAlways:!0},{name:"state",includeAlways:!0,hiddenAlways:!0},{name:"typeNLS",typeRepresentation:"string",includeAlways:!0,curi:"ds6w:type"},{name:"policyNLS",typeRepresentation:"string",visibleFlag:!1,curi:"ds6w:policy"},{name:"collabSpaceTitle",typeRepresentation:"string",curi:"ds6w:project"},{name:"revision",typeRepresentation:"url",includeAlways:!0,curi:"ds6wg:revision",needsCustomImplementation:!0},{name:"isLatestRevision",typeRepresentation:"boolean",className:"coloured-boolean",curi:"ds6w:isLastRevision"},{name:"files",typeRepresentation:"url",needsCustomImplementation:!0,compareFunction:function(e,t,n,a){var i=n.options.data.relateddata&&Array.isArray(n.options.data.relateddata.files)?n.options.data.relateddata.files.length:-1,o=a.options.data.relateddata&&Array.isArray(a.options.data.relateddata.files)?a.options.data.relateddata.files.length:-1;return i<o?-1:i>o?1:0}},{name:"lockStatus",typeRepresentation:"string",visibleFlag:!0,needsCustomImplementation:!0,curi:"ds6w:who/ds6w:responsible/ds6w:reservedBy",include:"lockerInfo",fields:["lockerInfo.name","lockerInfo.firstname","lockerInfo.lastname"]},{name:"description",typeRepresentation:"textBlock",visibleFlag:!1,curi:"ds6w:description"},{name:"organizationTitle",typeRepresentation:"string",includeAlways:!0,visibleFlag:!1,curi:"ds6w:organizationResponsible"},{name:"owner",typeRepresentation:"user",includeAlways:!0,needsCustomImplementation:!0,include:"ownerInfo",includeAlways:!0,fields:["ownerInfo.name","ownerInfo.firstname","ownerInfo.lastname"],curi:"ds6w:responsible"},{name:"originator",typeRepresentation:"user",includeAlways:!0,needsCustomImplementation:!0,visibleFlag:!1,include:"originatorInfo",fields:["originatorInfo.name","originatorInfo.firstname","originatorInfo.lastname"],curi:"ds6w:originator"},{name:"stateNLS",typeRepresentation:"tag",includeAlways:!0,needsCustomImplementation:!0,getCellSemantics:function(e){return{emphasize:a.getStateEmphasisClassname(e.nodeModel.options.data)}},curi:"ds6w:status"},{name:"originated",typeRepresentation:"datetime",visibleFlag:!1,curi:"ds6w:created"},{name:"modified",typeRepresentation:"datetime",includeAlways:!0,curi:"ds6w:modified"},{name:"comments",typeRepresentation:"string",visibleFlag:!1},{name:"hasModifyAccess",includeAlways:!0,hiddenAlways:!0},{name:"fileExtension",typeRepresentation:"string",visibleFlag:!1,curi:"ds6w:docExtension",include:"files",includeAlways:!0,fields:["files.name","files.title","files.revision","files.locker","files.image"]},{name:"secondaryTitle",hiddenAlways:!0},{name:"isDocumentType",includeAlways:!0,hiddenAlways:!0},{name:"ownerInfo",conditionalInclude:"owner",include:"ownerInfo",includeAlways:!0,hiddenAlways:!0,fields:["ownerInfo.name","ownerInfo.firstname","ownerInfo.lastname"]},{name:"originatorInfo",conditionalInclude:"originator",include:"originatorInfo",includeAlways:!0,hiddenAlways:!0,fields:["originatorInfo.name","originatorInfo.firstname","originatorInfo.lastname"]}],externalColumns:[{name:"approvalStatus",text:i.getName(),dataIndex:"ApprovalStatus",typeRepresentation:"user",editableFlag:!1,visibleFlag:!1,compareFunction:function(e,t){return i.compareApprovalStatus(e,t)}}],predefinedColumnsDictionary:void 0,customColumnsSelectableDictionary:void 0,customColumnsDictionary:void 0,customColumns:void 0,init:function(t){let n=new Date;var a=this;a.options=t,a.app=t.app,a.ready=e.Promise.deferred(),a.predefinedColumnsDictionary={},a.customColumnsSelectableDictionary={},a.customColumnsDictionary={},a.customColumns=[],a.predefinedColumnsDictionary={},a.predefinedColumns.forEach((e=>{e.text=d.get("e6wDocumentField."+e.name),e.typeRepresentation&&(null==e.dataIndex&&(e.dataIndex=e.name),a.predefinedColumnsDictionary[e.name]=e)}));t.tenantUrl;Promise.allSettled([a.getDefinitions(),r.fetchMePreferences({platformUrls:a.options.app.core.platformServices})]).then((t=>{a.app.preferenceResolved="rejected"!=t[1].status;var i=t[0].value;if(a.app.mepreferences=a.app.preferenceResolved?t[1].value:{defaultView:"unset",adminViews:{},userViews:{},gridDensity:"compact"},a.app.preferenceResolved||(a.app.events.publish({event:"docv2-show-notification",data:{level:"warning",message:d.get("FailedToLoadUserPreference"),sticky:!1,allowUnsafeHTML:!1}}),console.error("FAiled to load user preferences ........")),a.app.viewManager=new s(a.app,a.app.events),a.app.viewManager.loadPreferences(a.app.mepreferences),i.success){for(const t of i.definitions)if("e6w.documents.fields"==t.name){for(const n of t.items)if("document-custom-fields"==n.name){var r=n;r.items.shift();for(const t of r.items){var l=t.label;l&&l.includes("emxFramework")&&(l=t.name);var c={name:t.name,dataIndex:t.name,text:l||t.name,visibleFlag:!1,curi:t.sixw,typeRepresentation:"string",viewConfig:e.Json.isJson(t.viewConfig)?JSON.parse(t.viewConfig):void 0};if(c.viewConfig&&c.viewConfig.attributeType&&!c.viewConfig.multivalue){switch(c.viewConfig.attributeType){case"boolean":c.typeRepresentation="boolean",c.className="coloured-boolean";break;case"date":c.typeRepresentation="datetime";break;case"real":case"double":c.typeRepresentation="number";break;case"integer":c.typeRepresentation="integer";break;default:c.typeRepresentation="string"}"boolean"==c.viewConfig.attributeType?c.typeRepresentation="boolean":"date"==c.viewConfig.attributeType&&(c.typeRepresentation="datetime"),"real"!=c.viewConfig.attributeType&&"double"!=c.viewConfig.attributeType&&"integer"!=c.viewConfig.attributeType||function(e){e.compareFunction=function(e,t){return parseFloat(e)-parseFloat(t)}}(c)}t.units&&e.is(t.units.item,"array")&&t.units.item.forEach((e=>{e.default&&(c.getCellSemantics=function(t){return{units:e.display}})})),t.extension&&(c.selectable=t.extension+"."+t.name,a.customColumnsSelectableDictionary[c.selectable]=c),a.customColumns.push(c),a.customColumnsDictionary[t.name]=c}break}break}a.ready.resolve(a.getRenderableColumns());let t=new Date-n;o.sendTrackerPageEvent({category:"docm.columns.ready",action:"auto",label:"Widget Columns Ready",pd:{},pv:{totalTimeTaken:t,success:1,numberOfShowableCols:a.showableColumns.length}})}else{a.ready.reject();let e=new Date-n;o.sendTrackerPageEvent({category:"docm.columns.ready",action:"auto",label:"Widget Columns Ready",pd:{},pv:{totalTimeTaken:e,failure:0}})}}))},getDefinitions:function(){var e=this;return new Promise(((n,a)=>{var i=e.options.tenantUrl+"/resources/v1/modeler/documents";t.authenticatedRequest(i,{method:"post",type:"json",headers:{"Accept-Language":widget.lang},data:"$definition=true",onComplete:function(e){n(e)},onFailure:function(e){a(e)}})}))},getColumns:function(){var e=this;return[...e.predefinedColumns.filter((e=>e.typeRepresentation)),...e.externalColumns,...e.customColumns]},getRenderableColumns:function(){var e=this,t=[],n=this.getColumns(),a=this.app.viewManager.getSelectedView(),i=this.app.viewManager.getLocalView();function o(e){var t=0;for(const n of a.columnMap.keys()){if(n===e)return t;t++}return-1}return n.forEach((e=>{var n=a.columnMap.get(e.dataIndex)||a.columnMap.get(e.selectable)||a.columnMap.get(e.name);if(n){var s={...e,orderIndex:o(n.id),pinned:n.pinCol,visibleFlag:n.visibleFlag};if(i.viewId==a.id&&"unset"!=i.value){var r=i.value[s.dataIndex]||i.value[s.name];r&&(r.width&&(s.width=r.width),s.pinned=r.pinned?r.pinned:"unpinned",s.orderIndex=r.orderIndex)}t.push(s)}})),t.sort(((e,t)=>e.orderIndex-t.orderIndex)),e.showableColumns=t,e.showableColumnsDataIndexDictionary={},e.showableColumns.forEach((t=>{e.showableColumnsDataIndexDictionary[t.dataIndex]=t})),t},getQueryAsPerVisibleColumns:function(e){var t=this,n={include:["none"],fields:["none"]};t.sortableVisibleColumns=[];for(const a of e)null!=a.visibleFlag&&1!=a.visibleFlag||null==a.name||(n.fields.push(a.name),a.include&&n.include.push(a.include),a.fields&&n.fields.push(...a.fields),t.sortableVisibleColumns.push(a));for(const e of t.predefinedColumns)e.includeAlways&&(n.fields.includes(e.name)||(n.fields.push(e.name),e.include&&n.include.push(e.include),e.fields&&n.fields.push(...e.fields)));return n},isCustomColumn:function(e){if("files"==e)return!0;var t=!0;return this.predefinedColumns.forEach((n=>{!e||n.dataIndex!=e&&n.name!=e||(t=!1)})),t},getSortPredicate:function(e){var t=this;return t.showableColumnsDataIndexDictionary&&t.showableColumnsDataIndexDictionary[e]?t.showableColumnsDataIndexDictionary[e].curi:void 0}})}));