{"version":3,"file":"users-Di-8Btlh.js","sources":["../../../../../../../src/src/vendors/swym/api/users.ts"],"sourcesContent":["/* eslint-disable max-len */\n\nimport { cacheDecorator as cache, invalidateCacheIfSuccessfulDecorator as invalidateCache, invalidateCacheIfSuccessfulDecorator } from '@ds/swymkit/tools'\n\nimport type { SwymResponse } from '~/vendors/swym/interfaces/services/services-dto'\nimport type { IUser, NetworkUser } from '~/vendors/swym/interfaces/user'\nimport { swymFetch } from '~/vendors/swym/services/fetch-swym'\n\n/**\n * Fetch the current logged user.\n * @cache 60s\n * @returns The logged user\n */\nexport function getCurrentUser(): Promise<SwymResponse<IUser>> {\n  return cache(\n    'current-user',\n    () => swymFetch\n      .get('/api/user/getcurrent')\n      .json<SwymResponse<IUser>>(),\n    60000,\n  )\n}\n\n/**\n * Fetch a user using his hash_key.\n * @cache 60s\n * @param uid The hash_key of a user\n * @returns The user\n */\nexport function getUser(hash_key: string) {\n  return cache(\n    `user-${hash_key}`,\n    () => swymFetch\n      .post('/api/user/find', { json: { params: { hash_key } } })\n      .json<SwymResponse<IUser>>(),\n    60000,\n  )\n}\n\n/**\n * Fetch a user using his login.\n * @cache 60s\n * @param login The login of a user\n * @returns The user\n */\nexport function getUserByLogin(login: string) {\n  return cache(\n    `user-login-${login}`,\n    () => swymFetch\n      .post('/api/user/find', { json: { params: { login } } })\n      .json<SwymResponse<IUser>>(),\n    60000,\n  )\n}\n\n/**\n * Fetch the user using the resource uid of a user\n * @cache 60s\n * @param uid The \"ds6w:resourceUid\" of a user\n * @returns The user received\n */\nexport function getUserByUid(uid: string) {\n  return cache(\n    `user-uid-${uid}`,\n    () => swymFetch\n      .post('/api/user/find', { json: { params: { login: uid } } })\n      .json<SwymResponse<IUser>>(),\n    60000,\n  )\n}\n\n/**\n * 3DSwym search users API.\n * @param options - Options.\n * @param options.query - Search query.\n * @param options.communityUri - Community subject URI. (default: undefined)\n *                               If provided will returns the user's community access role\n *                               in each user result.\n * @param options.limit - Number of results per page. (default: 5)\n * @param options.page - Page number to fetch. (default: 0)\n * @param options.locale - (default: 'en')\n * @returns Promise with list matching users.\n */\nexport function searchUser({\n  query,\n  communityUri,\n  limit = 5,\n  page = 0,\n  locale = 'en',\n}: {\n  /** Search query. */\n  query: string\n\n  /**\n   * Community subject URI.\n   * If provided will returns the user's community access role in each user result.\n   * @default undefined\n   */\n  communityUri?: string\n\n  /**\n   * Number of results per page.\n   * @default 5\n   */\n  limit?: number\n\n  /**\n   * Page number to fetch.\n   * @default 0\n   */\n  page?: number\n\n  /**\n   * @default 'en'\n   */\n  locale?: string\n}) {\n  return cache(\n    `search-user-${communityUri ? `${communityUri}-` : ''}${query}`,\n    () => swymFetch\n      .post('/api/user/search', {\n        json: {\n          params: {\n            query,\n            community_id: communityUri,\n            limit,\n            start: page,\n            locale,\n          },\n        },\n      })\n      .json<SwymResponse<IUser[]>>(), // TODO: should parse users results.\n    60000,\n  )\n}\n\n// USER GROUP\n// interface CachedUserGroup {\n//   name: string\n//   isMember: boolean\n//   cacheDate: string\n// }\n// const featureGroupCache: CachedUserGroup[] = []\n// const FEATURE_GROUP_KEY = 'feature-groups'\n// const FEATURE_GROUP_CACHE_DURATION = 6 // in hours\n// export const userGroup = {\n//   async isMember(UID: string, groupName: string) {\n//     const LocalStorageManagerForUserGroup = useLocalStorageManager<CachedUserGroup[]>(\n//       FEATURE_GROUP_KEY,\n//       [],\n//     )\n//     if (useFeatureManager('app.config.is_cloud').value) {\n//       featureGroupCache = LocalStorageManagerForUserGroup.value\n//       const group = featureGroupCache?.find(e => e.name === groupName)\n//       // group is cached\n//       if (group) {\n//         const date: Date = new Date(group.cacheDate)\n\n//         // https://stackoverflow.com/questions/19225414/how-to-get-the-hours-difference-between-two-date-objects\n//         const deltaInHoursFromNow = Math.abs(Date.now() - date.getTime()) / 36e5\n\n//         // if the cached date is older than 6 hours, let's make the call again\n//         if (deltaInHoursFromNow > FEATURE_GROUP_CACHE_DURATION) {\n//           const isUserMember = await SearchService.isUserGroupMember(UID, groupName)\n\n//           // updating cache information\n//           group.isMember = isUserMember\n//           group.cacheDate = new Date()\n//             .toISOString()\n//           LocalStorageManagerForUserGroup.value = featureGroupCache\n\n//           return isUserMember\n//         }\n//         else {\n//           return group.isMember\n//         }\n//       }\n//       else {\n//         // adding information to the cache & evaluate if user is a member of the userGroup\n//         const isUserMember = await SearchService.isUserGroupMember(UID, groupName)\n\n//         const newGroup = {\n//           name: groupName,\n//           isMember: isUserMember,\n//           cacheDate: new Date()\n//             .toISOString(),\n//         }\n//         featureGroupCache.push(newGroup)\n//         LocalStorageManagerForUserGroup.value = featureGroupCache\n//         return isUserMember\n//       }\n//     }\n//     else {\n//       return false\n//     }\n//   },\n//   async isUserGroupAvailable(groupName: string) {\n//     if (useFeatureManager('app.config.is_cloud').value)\n//       return await SearchService.getUserGroup(groupName)\n//     else\n//       return false\n//   },\n// }\n"],"names":["getCurrentUser","cache","swymFetch","searchUser","query","communityUri","limit","page","locale"],"mappings":"yDAaO,SAASA,GAA+C,CACtD,OAAAC,EACL,eACA,IAAMC,EACH,IAAI,sBAAsB,EAC1B,KAA0B,EAC7B,GACF,CACF,CA8DO,SAASC,EAAW,CACzB,MAAAC,EACA,aAAAC,EACA,MAAAC,EAAQ,EACR,KAAAC,EAAO,EACP,OAAAC,EAAS,IACX,EA2BG,CACM,OAAAP,EACL,eAAeI,EAAe,GAAGA,CAAY,IAAM,EAAE,GAAGD,CAAK,GAC7D,IAAMF,EACH,KAAK,mBAAoB,CACxB,KAAM,CACJ,OAAQ,CACN,MAAAE,EACA,aAAcC,EACd,MAAAC,EACA,MAAOC,EACP,OAAAC,CAAA,CACF,CAEH,CAAA,EACA,KAA4B,EAC/B,GACF,CACF"}