import{aq as p}from"./appStandalone-C5Q9Mp7v.js";class s{static removeDotSegments(e){const r=[];function i(t){t==="/.."?r.pop():r.push(t)}return e.replace(/^(\.\.?(\/|$))+/,"").replace(/\/(\.(\/|$))+/g,"/").replace(/\/\.\.$/,"/../").replace(/\/?[^/]*/g,i),r.join("").replace(/^\//,e.charAt(0)==="/"?"/":"")}static buildUrl(e,r){const i=window.location&&window.location.protocol?window.location.protocol:"http:";if(e=String(e),r=String(r),!s.isAbsoluteUrl(e))throw new Error("First argument should be a absolute url.");e.substring(0,2)==="//"&&(e=i+e);let t,a,o="";const n=String(e).split("://"),c=n[0],h=n[1],f=h.split("/"),d=f[0];if(r.substring(0,2)==="//")e=c+":"+r;else if(r.split("://").length>1)e=r;else if(r.substring(0,1)==="/")e=c+"://"+d+r;else{for(t=1,a=f.length-1;t<a;t++)o+="/"+f[t];e=c+"://"+d+s.removeDotSegments(o+"/"+r)}return e}static parseUrl(e){const r=["source","subprotocol","protocol","authority","user","password","domain","port","path","directoryPath","fileName","query","anchor"],i=new RegExp("^(?:(?:(?:([^#.:]+):)?([^#.:]+):)?//)?((?:([^:/]+)(?::([^/]*?))?@)?([^:/?#]*)(?::(\\d*))?)?((/(?:[^?#](?![^?#/]*\\.[^?#/.]+(?:[\\?#]|$)))*/?)?([^?#/]*))?(?:\\?([^#]*))?(?:#(.*))?");let t;const a=i.exec(e),o={};for(t=0;t<r.length;t++)o[r[t]]=a[t]||"";return o.subprotocol&&(o.source=o.source.substr(o.subprotocol.length+1)),o.port||(o.port=o.protocol==="https"?"443":"80"),o.directoryPath&&o.directoryPath.length>0&&(o.directoryPath=o.directoryPath.replace(/\/?$/,"/")),o.domain=o.domain.toLocaleLowerCase(),o.protocol=o.protocol.toLocaleLowerCase(),o}static composeUrl(e){let r="";return e.protocol&&(r=e.protocol+"://",e.subprotocol&&(r=e.subprotocol+":"+r)),e.domain?(r+=e.domain,e.port&&(e.protocol!=="http"||parseInt(e.port,10)!==80)&&(e.protocol!=="https"||parseInt(e.port,10)!==443)&&(r+=":"+e.port)):e.authority&&(r+=e.authority),e.path&&(r+=e.path),e.query&&(r+="?"+e.query),e.anchor&&(r+="#"+e.anchor),r}static matchUrl(e,r){let i,t,a=!1;const o=s.isAbsoluteUrl(e),n=s.isAbsoluteUrl(r);return!o&&!n?a=!0:(o?n||(r=s.buildUrl(e,r)):e=s.buildUrl(r,e),i=s.parseUrl(e),t=s.parseUrl(r),a=["domain","protocol","port"].every(function(c){return i[c]===t[c]||c==="protocol"&&(i[c]===""||t[c]==="")})),a}static isAbsoluteUrl(e){return/^((https?|ftp|file):)?\/\//.test(e)}static toQueryString(e,r){let i,t,a,o;if(s.is(e,"string"))o=e;else if(s.is(e.toQueryString,"function"))o=e.toQueryString();else{o=[];for(i in e)e.hasOwnProperty(i)&&(t=e[i],r&&(i=r+"["+s.capitalize(i)+"]"),s.is(t)&&(s.is(t,"object")||s.is(t,"array")?a=s.toQueryString(t,i):s.is(t,"function")||(a=s.encodeUrl(i)+"="+s.encodeUrl(t))),a&&o.push(a),a=void 0);o=o.join("&")}return o}static is(e,r){return e&&r?typeof e===r:e?typeof e<"u":!1}static encodeUrl(e){return encodeURIComponent(e).replace(/\./g,"%2e")}static capitalize(e,r="-"){const i=e.split(r);for(let t=0;t<i.length;t++)i[t]=i[t][0].toUpperCase()+i[t].substr(1);return i.join(r)}}class l{constructor(){}static get proxies(){const e=p.getNativeAppRequireConfig();if(e&&e.proxies)return e.proxies;const r=window.UWA&&window.UWA.hosts||{},t=r.exposition+"/proxy/",a=r.proxies||{};return Object.assign(Object.assign({},a),{ajax:t+"ajax",resolve:t+"resolve",xml:t+"xml",spreadsheet:t+"spreadsheet",soap:t+"soap",feed:t+"feed",icon:t+"icon",richIcon:t+"richIcon",rss:t+"feed"})}static normalizeRequestHeaders(e){const r={};return e.headers.forEach((i,t)=>{r[t]=i}),r}static checkHasProxyPath(e){if(p.isNativeApp()){const r=p.getNativeAppRequireConfig();if(r&&r.proxies){for(const i in r.proxies)if(e.startsWith(r.proxies[i]))return!0}}return!1}static async request(e,r,i){if(!e)throw new Error("Bad or missing url argument.");if(!p.isNativeApp()||s.matchUrl(e,window.location))return i;r=r||{};let t;const a=window.location,o="ajax",n=r;n.headers&&!n.normalizedHeaders&&(n.normalizedHeaders=l.normalizeRequestHeaders(i)),n.proxy?e=l.proxifyUrl(e,n):s.matchUrl(e,a)===!1&&l.allowCrossOriginRequest===!1&&(e=l.proxifyUrl(e,Object.assign(Object.assign({},n),{proxy:o})));const c=["GET","HEAD"].includes(i.method)?void 0:await i.blob();return n.body=c,t=new Request(e,n),t}static proxifyUrl(e,r){if(!e)throw new Error("Bad or missing url argument.");let i;const t=[],a=r.proxy,o=s.toQueryString,n=l.proxies;if(a&&n[a]){if(!p.isNativeApp()||s.matchUrl(e,window.location)||(i=n[a],e.indexOf(i)===0))return e;if(e.startsWith("https://")&&e.indexOf(":443")>-1&&(e=e.replace(":443","")),r.body&&r.method&&r.method.toUpperCase()==="GET"&&(e+=(e.indexOf("?")>-1?"&":"?")+o(r.body),console.log("DEBUG test proxification handle get",e)),typeof r.proxy=="object"&&t.push(o(r.proxy)),r.normalizedHeaders?t.push(o(r.normalizedHeaders,"headers")):r.headers&&t.push(o(r.headers,"headers")),r.method&&t.push(o({method:r.method})),t.push(o({url:e})),e=i+"?"+t.join("&"),e.length>4096)throw console.log("Error proxify url too long",e),new Error("Proxified url is more than 4096 characters, that is the limit for most of the browsers.")}else throw new Error("Invalid proxy");return e}}l.allowCrossOriginRequest=!1;export{l as CommonRequest};
//# sourceMappingURL=index-D2fNTUcd.js.map
