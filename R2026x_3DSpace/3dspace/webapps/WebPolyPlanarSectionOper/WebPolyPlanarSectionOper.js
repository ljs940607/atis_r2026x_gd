define("DS/WebPolyPlanarSectionOper/WebPolyPolygon2D",["UWA/Class"],(function(e){"use strict";return e.extend({init:function(e){return this._Polylines=e||[],this},AddPolyLine:function(e){this._Polylines.push(e)},GetAllPolyLines:function(){return this._Polylines}})})),define("DS/WebPolyPlanarSectionOper/WebPolyPolyLine2D",["UWA/Class"],(function(e){"use strict";return e.extend({init:function(e){return this._Vertices=e||[],this},AddVertex:function(e){this._Vertices.push(e)},GetAllVertices:function(){return this._Vertices}})})),define("DS/WebPolyPlanarSectionOper/WebPolyPlanarSectionOper",["UWA/Class","DS/WebPolyMaths/WebMathsVector3D","DS/WebPolyMaths/WebMeshIntersection","DS/WebPolyMaths/WebToolsMeasure","DS/Visualization/PathElement","DS/Visualization/ThreeJS_DS","DS/WebPolyMaths/WebToolsSceneGraph","DS/WebPolyPlanarSectionOper/WebPolyPolyLine2D","DS/WebPolyPlanarSectionOper/WebPolyPolygon2D","DS/Mesh/Mesh","DS/Mesh/ThreeJS_Base"],(function(e,t,n,i,r,l,o,a,s,u,c){"use strict";return e.extend({init:function(e){return this._Viewer=e,this._requestArea=!1,this},ComputeSectionArea:function(e){this._requestArea=e},Run:function(e,t){var n={};return void 0!==this._Viewer&&0==(n=this._computeSectionCurves(e,t)).returnCode&&!0===this._requestArea&&(n.Area=this._computeSectionArea(n.aAllPolygons)),n},_computeSectionCurves:function(e,i){var m={},h=1;m.aAllPolygons=[],m.aAllColors=[];var y=[],f=[];if(i.length>0){var P=!1;P;for(var v=[],g=0;g<8;g++)v.push([0,0,0]);for(var S=(new l.Matrix4).getInverse(e),p=[e.elements[12],e.elements[13],e.elements[14]],b=[e.elements[8],e.elements[9],e.elements[10]],x=-t.dot(p,b),d=0;d<i.length;d++){var W=i[d].getWorldMatrix(),A=i[d].getLastElement(!0),_=W.elements,V=A.bBox;v[0][0]=V.min.x,v[0][1]=V.min.y,v[0][2]=V.min.z,v[1][0]=V.max.x,v[1][1]=V.min.y,v[1][2]=V.min.z,v[2][0]=V.min.x,v[2][1]=V.max.y,v[2][2]=V.min.z,v[3][0]=V.max.x,v[3][1]=V.max.y,v[3][2]=V.min.z,v[4][0]=V.min.x,v[4][1]=V.min.y,v[4][2]=V.max.z,v[5][0]=V.max.x,v[5][1]=V.min.y,v[5][2]=V.max.z,v[6][0]=V.min.x,v[6][1]=V.max.y,v[6][2]=V.max.z,v[7][0]=V.max.x,v[7][1]=V.max.y,v[7][2]=V.max.z,v[0]=t.transformPoint(v[0],_,v[0]);for(var D=v[0][0]*b[0]+v[0][1]*b[1]+v[0][2]*b[2]+x,C=!0,M=0;C&&M<8;M++){v[M]=t.transformPoint(v[M],_,v[M]),C=D*(v[M][0]*b[0]+v[M][1]*b[1]+v[M][2]*b[2]+x)>0}var z=this._Viewer.getCurrentSceneGraphState();if(!C)if(o.isLeaf(A)){var w=i[d];if(!1!==o.recursiveGetPathElementVisibility(this._Viewer,w)){var L=o.getRenderables(w);y=y.concat(L);for(var G=0;G<L.length;G++)f.push(W)}}else{var O=A.children,T=O.length;for(G=0;G<T;G++){var E=O[G];if(o.isReferenceOrInstance(E)){var q=new r;q.addElement(E);var I=this._Viewer.getVisibleSpace(),B=o.isVisible(this._Viewer,q);if(0!==I||B||(B=!0),z&&(B=z.getAppliedVisibility(q)),null===B||!0===B)(w=i[d].clone()).addElement(E),i.push(w)}}}}for(var R=0,U=y.length,J=0;J<U;J++){_=S.clone().multiply(f[J]).elements;var F,H=(new l.Matrix4).getInverse(f[J]).multiply(e).elements,j=y[J].geometry,k=y[J].material&&y[J].material.force;k&&(F=y[J].material.color.clone());for(var K=j.length,N=0;N<K;N++)for(var Q=j[N].drawingGroups,X=Q.length,Y=0;Y<X;Y++)if(Q[Y]._geomType&&"FACE"===u.GeomTypeString[Q[Y]._geomType]){var Z;c.getWebVisualizationLevel()>=422&&(Z=new u.SGPrimitiveHelper);for(var $=c.getWebVisualizationLevel()>=422?Q[Y].getPrimitivesCount():Q[Y].primitives.length,ee=0;ee<$;ee++){k||(F=Q[Y].gas.color.clone()),c.getWebVisualizationLevel()>=422?Z.set(Q[Y],ee):Z=Q[Y].primitives[ee];var te=!0,ne=c.getWebVisualizationLevel()>=422?Z.getBoundingSphere():Z.boundingSphere;if(ne){var ie=[ne.center[0],ne.center[1],ne.center[2]];ie=t.transformPoint(ie,_),ne.radius-Math.abs(ie[2])<0&&(te=!1)}if(!0===te){var re=n.computeSectionCurves(Z,_,H,this._requestArea);if(0===re.returnCode){h=0;for(var le=re.aPolylines.length,oe=0;oe<le;oe++)re.aPolylines[oe]=new a(re.aPolylines[oe]);re.aPolygon=new s(re.aPolylines),m.aAllPolygons[R]=re.aPolygon,m.aAllColors[R]=F,R++}}}}}P}return m.returnCode=h,m},_computeSectionArea:function(e){var t=0;for(let n of e){let e=n.GetAllPolyLines();for(let n of e){let e=n.GetAllVertices();for(let n=0,i=e.length-1;n<i;n++)t+=.5*(e[n][0]*e[n+1][1]-e[n][1]*e[n+1][0])}}return Math.abs(t)}})}));