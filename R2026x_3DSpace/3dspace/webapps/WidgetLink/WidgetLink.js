define("DS/WidgetLink/WidgetLinkData",[],(function(){"use strict";if(window.hasOwnProperty("dsDashboardWindow")&&window.dsDashboardWindow.top.wap&&window.dsDashboardWindow.top.require&&window!==dsDashboardWindow.top)return dsDashboardWindow.top.require("DS/WidgetLink/WidgetLinkData");return function t(i,n){if(this.constructor===t)throw new Error("Cannot instanciate abstract class "+t.name);var e;Object.defineProperty(this,"id",{value:i,enumerable:!0}),e=function(t,i){Object.defineProperty(this,t,{get:function(){return i(n())},enumerable:!0})}.bind(this),["appId","x3dSharedId","x3dAppId","x3dPlatformId"].forEach((function(t){e(t,(function(i){return i?i.getValue(t):void 0}))})),e("alive",(function(t){return!!t}))}})),define("DS/WidgetLink/ExternalWidgetLink",["DS/WidgetLink/WidgetLinkData","DS/MessageBus/MessageBus"],(function(t,i){"use strict";if(window.hasOwnProperty("dsDashboardWindow")&&window.dsDashboardWindow.top.wap&&window.dsDashboardWindow.top.require&&window!==dsDashboardWindow.top)return dsDashboardWindow.top.require("DS/WidgetLink/ExternalWidgetLink");var n=new WeakMap,e={};function r(t){return require("DS/Dashboard/Utils").getRegisteredWidgetInstance(t)}function o(t,i){var n=r(i),e=r(t.id);return n&&e&&n.environment.wp.parentId===e.environment.wp.parentId?n:void 0}function d(i,n,r){if(r!==e)throw new Error("Cannot use "+d.name+"#constructor directly");t.call(this,n,(function(){return o(i,n)})),this._widgetLink=i}return d.prototype=Object.create(t.prototype),d.prototype.constructor=d,d.get=function(t,i){var r,o,s,a=function(t,i){var e=n.get(t);return e&&e.get(i)}(t,i);return a||(r=new d(t,i,e),o=r,(s=n.get(o._widgetLink)||new Map).set(o.id,o),n.set(o._widgetLink,s),r)},d.prototype.isLinked=function(){return this.alive&&!!this._widgetLink.getLinked().find((function(t){return t.id===this.id}),this)},d.prototype.unlink=function t(n){if(!n||"string"!=typeof n)throw new Error(d.name+"#"+t.name+" requires a reason as its parameter");this.isLinked()&&i.publish({channel:"widget-link",topic:"force-unlink",data:{source:this._widgetLink.id,target:this.id,reason:n}})},d.prototype.matchLinkability=function(){return this.isLinked()?require("DS/Dashboard/WidgetLinkManager").matchLinkability(o(this._widgetLink,this.id).data,Object.assign({},this._widgetLink,{x3dLinkability:this._widgetLink.getLinkability()})):null},d})),define("DS/WidgetLink/AbstractWidgetLink",["DS/MessageBus/MessageBus","DS/WidgetLink/WidgetLinkData","DS/WidgetLink/ExternalWidgetLink"],(function(t,i,n){"use strict";if(window.hasOwnProperty("dsDashboardWindow")&&window.dsDashboardWindow.top.wap&&window.dsDashboardWindow.top.require&&window!==dsDashboardWindow.top)return dsDashboardWindow.top.require("DS/WidgetLink/AbstractWidgetLink");var e=new Map,r="widget-link";function o(t){return e.get(t)||new Set}function d(t,i){var e,r=i.indexOf(t.id);if(-1!==r)return e=1===r?i[0]:i[1],n.get(function(t){return require("DS/WidgetLink/WidgetLink").get(t._widget)}(t),e)}function s(t,i){return function(n){var e=d(t,n.ids),r=Object.freeze({type:i,target:t,link:e,initiator:n.ids[0],reason:n.reason});e&&t._listeners[i].forEach((function(t){try{t(r)}catch(t){setTimeout((function(){throw t}))}}))}}function a(i,n,e){i._defaultSubscriptions[n]=t.subscribe({channel:r,topic:n,callback:e})}function u(n){if(this.constructor===u)throw new Error("Cannot instanciate abstract class "+u.name);var d;i.call(this,n.id,(function(){return n})),this._widget=n,this._channelId=[r,(d=this).id,o(d.id).size].join(":"),this._listeners={link:[],unlink:[]},this._defaultSubscriptions={},a(this,"link",s(this,"link")),a(this,"unlink",s(this,"unlink")),a(this,"destroy",function(i){i.ids.includes(this.id)&&(e.delete(this.id),this.unsubscribe(),Object.values(this._defaultSubscriptions).forEach((function(i){t.unsubscribe(i)})))}.bind(this)),function(t){var i=o(t.id);i.add(t),e.set(t.id,i)}(this)}return u.prototype=Object.create(i.prototype),u.prototype.constructor=u.prototype,u.prototype.getLinked=function t(){throw new Error("Cannot invoke abstract function "+u.name+"#"+t.name)},u.prototype.createView=function(t){return new(require("DS/WidgetLink/WidgetLinkView"))(this,t)},u.prototype.addEventListener=function(t,i){Object.keys(this._listeners).includes(t)&&this._listeners[t].push(i)},u.prototype.removeEventListener=function(t,i){if(Object.keys(this._listeners).includes(t)){var n=this._listeners[t].indexOf(i);-1!==n&&this._listeners[t].splice(n,1)}},u.prototype.publish=function(i,n){var e=this.id;this.getLinked().forEach((function(r){Array.from(o(r.id)).filter((function(t){return!!t.getLinked().find((function(t){return t.id===e}))})).forEach((function(e){t.publish({channel:e._channelId,topic:i,data:n})}))}))},u.prototype.subscribe=function(i,n){return t.subscribe({channel:this._channelId,topic:i,callback:n})},u.prototype.unsubscribe=function(i){"string"==typeof i?t.unsubscribe({channel:this._channelId,topic:i}):i?t.unsubscribe(i):t.unsubscribe({channel:this._channelId})},u})),define("DS/WidgetLink/WidgetLink",["DS/WidgetLink/AbstractWidgetLink","DS/WidgetLink/ExternalWidgetLink"],(function(t,i){"use strict";if(window.hasOwnProperty("dsDashboardWindow")&&window.dsDashboardWindow.top.wap&&window.dsDashboardWindow.top.require&&window!==dsDashboardWindow.top)return dsDashboardWindow.top.require("DS/WidgetLink/WidgetLink");var n=new WeakMap,e={};function r(t){return require("DS/Dashboard/WidgetLinkManager").fixLinkability(t)}function o(i,n){if(n!==e)throw new Error("Cannot use "+o.name+"#constructor directly");t.call(this,i)}return o.prototype=Object.create(t.prototype),o.prototype.constructor=o,o.get=function(t){if(n.has(t))return n.get(t);var i=new o(t,e);return n.set(t,i),i},o.prototype.getLinked=function(){return require("DS/Dashboard/WidgetLinkManager").getLinked(this.id).map((function(t){return i.get(this,t)}),this).filter((function(t){return t.alive}))},o.prototype.getLinkability=function(){return r(this._widget.getValue("x3dLinkability"))},o.prototype.setLinkability=function(t){this._widget.setValue("x3dLinkability",t?r(t):void 0)},o})),define("DS/WidgetLink/WidgetLinkView",["DS/WidgetLink/AbstractWidgetLink"],(function(t){"use strict";if(window.hasOwnProperty("dsDashboardWindow")&&window.dsDashboardWindow.top.wap&&window.dsDashboardWindow.top.require&&window!==dsDashboardWindow.top)return dsDashboardWindow.top.require("DS/WidgetLink/WidgetLinkView");function i(i,n){t.call(this,i._widget),this._underlying=i,this._predicate=n}return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.prototype.getLinked=function(){return this._underlying.getLinked().filter(this._predicate)},i}));